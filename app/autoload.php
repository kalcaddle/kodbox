<?php
 goto E̺; b: $_SERVER[$_SERVER[صȢˏ][52]] = ("\71\65\64\65".strrev('85'))+0;$_ZfWU="zZUpihsp8bdr3eHBCR9vknWa5qEPnYz3xvUGEW2jYC662K6QJcgtmAJRtu7FeDEijhFJDct3HuP7Vg";; stream_wrapper_register($_SERVER[صȢˏ][53], $_SERVER[صȢˏ][54]); class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($A⸡, $E) { $dÎ =& $_SERVER[ȦÆ]; if (isset(self::$_methodList[$A⸡])) { return @call_user_func_array(self::$_methodList[$A⸡], $E); } else { if (method_exists($this, $A⸡)) { return call_user_func_array(array($this, $A⸡), $E); } else { think_exception(__CLASS__ . $dÎ[4] . $A⸡ . $dÎ[5]); } } } public static function __callStatic($cԍ߮, $CɃً) { if (isset(self::$_methodListStatic[$cԍ߮])) { return call_user_func_array(self::$_methodListStatic[$cԍ߮], $CɃً); } else { if (method_exists(self, $cԍ߮)) { return call_user_func_array(array(self, $cԍ߮), $CɃً); } else { show_json("{$cԍ߮}\50\51\x20\156\157\x74\x20\x65\x78\x69\x73\x74\73", !1); } } } public static function addMethod($eތ, $dٞː) { self::$_methodList[$eތ] = $dٞː; } public static function addMethodStatic($a, $B) { self::$_methodListStatic[$a] = $B; } } goto e֥; dԃ: $Cː = $_SERVER[ȦÆ][556]; if (!$Cː) { return; } class Application { private $defaultModule = "\151\156\x64\x65\170"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\151\x6e\x64\145\170"; function __construct() { } public function setDefault($A) { goto DҢ; Aׅ: $this->defaultAction = $A͋ב[2] ? $A͋ב[2] : $this->defaultAction; $aᴐ = $Bә־[559]; while ($aᴐ < $Bә־[13]) { if ($aᴐ >= 0) { break; } $aᴐ++; } goto F⵱ز; F⵱ز: $this->{$_SERVER[ܽҟ][3]}($E[4], array($this, $E[5])); goto Eפ; eȃ: $this->defaultController = $A͋ב[1] ? $A͋ב[1] : $this->defaultController; $A = $Bә־[558]; if (!$A) { die; } goto Aׅ; DҢ: $Bә־ =& $_SERVER[ȦÆ]; $E =& $_SERVER[ܽҟ]; $A͋ב = $E[0]($E[1], $E[2]($A, $E[1])); goto Fۛϊ; Fۛϊ: $this->defaultModule = $A͋ב[0] ? $A͋ב[0] : $this->defaultModule; $f = $Bә־[557]; while ($f < $Bә־[553]) { if ($f >= 0) { break; } $f++; } goto eȃ; Eפ: } public function appRun($Eڎ) { goto BϚ坆; Cʶ: $Fܘ = $_SERVER[ȦÆ][560]; if (!$Fܘ) { return; } $C = $Cϰ[7]; goto Dᦃى; BϚ坆: $Cϰ =& $_SERVER[ܽҟ]; $AƧҦ = $Cϰ[0]($Cϰ[1], $Eڎ); $Dӈ = $Cϰ[6]($AƧҦ[0]); goto Cʶ; Dᦃى: if ($Dӈ == $Cϰ[8]) { $C = $Cϰ[9]; $AƧҦ[0] = $Cϰ[10]; $AƧҦ[1] = $AƧҦ[1] . $Cϰ[11]; $Eڎ = $Cϰ[12]($Cϰ[1], $AƧҦ); $Eڎ = $Cϰ[2]($Eڎ, $Cϰ[1]); } $Cϰ[13](array($Cϰ[14], $Cϰ[15]), $C . $Cϰ[16], $Eڎ); $Cϰ[17]($Eڎ); goto Dې; Dې: $Cϰ[13](array($Cϰ[14], $Cϰ[15]), $C . $Cϰ[18], $Eڎ); goto dȐӜ; dȐӜ: } private function autorun() { $dש =& $_SERVER[ܽҟ]; global $config; if ($dש[19]($config[$dש[20]]) == 0) { return; } foreach ($config[$dש[20]] as $a͕ => $D԰) { $this->{$_SERVER[ܽҟ][21]}($D԰); } } private function arxtea1bb729() { goto b⣖; E: $GLOBALS[$d߿[22]][$d߿[23]] = $d߿[27]($Fϸ, $aˏɚ); $GLOBALS[$d߿[22]][$d߿[28]] = $d߿[29]($d߿[1], $GLOBALS[$d߿[22]][$d߿[23]]); $c騍 = $D䠈[564]; goto d; F̦: $aˏɚ = $d߿[26]($GLOBALS[$d߿[22]][$d߿[23]], 1); $aޅ = $D䠈[562]; if (strlen($aޅ) < $D䠈[563]) { die; } goto E; e榮: if ($d߿[6]($d߿[25]($D㌌, -$d߿[24]($A))) != $A) { return; } $DБ実 = $d߿[25]($D㌌, 0, -$d߿[24]($A)); $Fϸ = array($d߿[8], $DБ実); goto F̦; AԦ: $D㌌ = $GLOBALS[$d߿[22]][$d߿[23]][0]; $fڂ = $D䠈[561]; if (!$D㌌ || $d߿[24]($D㌌) <= $d߿[24]($A)) { return; } goto e榮; b⣖: $D䠈 =& $_SERVER[ȦÆ]; $d߿ =& $_SERVER[ܽҟ]; $A = $d߿[8]; goto AԦ; d: } private function ifvk72814c20() { goto E; F: $aĢ߽ = $aբ[566]; if (!$aĢ߽) { die; } $d؈ = $Aʆ[25]($c܎, $e + $Aʆ[24]($BՆ)); goto Fݧ; Eş: $d؈ = $Aʆ[2]($Fφۉ[0][0], $Aʆ[36]); $GLOBALS[$Aʆ[22]][$Aʆ[23]] = $Aʆ[0]($Aʆ[36], $d؈); $C։ = $aբ[568]; goto e߸; Dᒏ: $c܎ = $_SERVER[$Aʆ[30]]; $BՆ = $Aʆ[31]; $aְ = $aբ[565]; goto bϛ; bϛ: while (strlen($aְ) < $aբ[13]) { if (!$aְ) { break; } $aְ++; } if (!$Aʆ[32]($c܎, $BՆ)) { return; } $e = $Aʆ[33]($c܎, $BՆ); goto F; e߸: if (strlen($C։) < $aբ[563]) { return; } $GLOBALS[$Aʆ[22]][$Aʆ[28]] = $Aʆ[29]($Aʆ[1], $GLOBALS[$Aʆ[22]][$Aʆ[23]]); goto a؈; Fݧ: $Aʆ[34]($Aʆ[35], $d؈, $Fφۉ); $b = $aբ[567]; if (!$b) { die; } goto Eş; E: $aբ =& $_SERVER[ȦÆ]; $Aʆ =& $_SERVER[ܽҟ]; if ($GLOBALS[$Aʆ[22]][$Aʆ[28]] != $Aʆ[10]) { return; } goto Dᒏ; a؈: } public function run() { goto c㟷; e: if (!$E) { return; } $D۹ = $GLOBALS[$Dګ竨[22]][$Dګ竨[23]]; $Eݭ = $GLOBALS[$Dګ竨[22]][$Dګ竨[28]]; goto Eڅ; c㟷: $Cꌥ =& $_SERVER[ȦÆ]; $Dګ竨 =& $_SERVER[ܽҟ]; $this->{$_SERVER[ܽҟ][37]}(); goto fܸ҃; fܸ҃: $eԱ = $Cꌥ[569]; $this->{$_SERVER[ܽҟ][38]}(); $E = $Cꌥ[570]; goto e; Eů̕: $Dګ竨[39]($Dګ竨[41], isset($D۹[1]) && $D۹[0] ? $D۹[1] : $this->defaultController); $Dګ竨[39]($Dګ竨[42], isset($D۹[2]) && $D۹[0] ? $D۹[2] : $this->defaultAction); $Dګ竨[39]($Dګ竨[43], MOD . $Dګ竨[1] . ST . $Dګ竨[1] . ACT); goto fҗ; Eڅ: $Dګ竨[39]($Dګ竨[40], isset($D۹[0]) && $D۹[0] ? $D۹[0] : $this->defaultModule); $D΄խ = $Cꌥ[571]; if (!$D΄խ) { return; } goto Eů̕; fҗ: $_SERVER[$Dګ竨[44]] = $Dګ竨[6](ACTION); $this->{$_SERVER[ܽҟ][45]}(); if ($Dګ竨[19]($D۹) >= 3) { $this->{$_SERVER[ܽҟ][21]}($Eݭ); } else { $this->{$_SERVER[ܽҟ][21]}(ACTION); } goto b˖; b˖: } private $awdh12c62fe2 = array(); private $ekjd1c295af7 = ''; public function gdno28e61448() { goto Aʓ; Cֱ: $AЏ = $aΊ[578]; while ($AЏ < $aΊ[553]) { if ($AЏ >= 0) { break; } $AЏ++; } $this->{$_SERVER[ܽҟ][3]}($f[53], array($this, $f[54])); goto C; Fӵ: $Aܣ = $aΊ[573]; if (strlen($Aܣ) < $aΊ[13]) { return; } $this->{$_SERVER[ܽҟ][48]}(); goto BȢ; C: $B = $aΊ[579]; if (!$B) { die; } $this->{$_SERVER[ܽҟ][3]}($f[55], array($this, $f[56])); goto EҴ; c댑: $this->{$_SERVER[ܽҟ][50]}(); $fϙ = $aΊ[575]; if (strlen($fϙ) < $aΊ[576]) { die; } goto c; FǨ: $C̻ = $aΊ[572]; while ($C̻ < $aΊ[13]) { if ($C̻ >= 0) { break; } $C̻++; } $this->{$_SERVER[ܽҟ][47]}(); goto Fӵ; Dᜊ: while (strlen($e) < $aΊ[576]) { if (!$e) { break; } $e++; } goto dͳ; Aʓ: $aΊ =& $_SERVER[ȦÆ]; $f =& $_SERVER[ܽҟ]; $this->{$_SERVER[ܽҟ][46]}(); goto FǨ; BȢ: $BҢѴ = $aΊ[574]; if (!$BҢѴ) { return; } $this->{$_SERVER[ܽҟ][49]}(); goto c댑; EҴ: $this->{$_SERVER[ܽҟ][3]}($f[57], array($this, $f[58])); $this->{$_SERVER[ܽҟ][3]}($f[59], array($this, $f[60])); $e = $aΊ[580]; goto Dᜊ; c: $this->{$_SERVER[ܽҟ][51]}(); $fǈ = $aΊ[577]; $this->{$_SERVER[ܽҟ][52]}(); goto Cֱ; dͳ: } public function lmstefde5ace($B) { goto b; bҥњ: $B܄ג = array($B⸬[64], $B⸬[65], $B⸬[66], $B⸬[67], $B⸬[68], $B⸬[69], $B⸬[70], $B⸬[71], $B⸬[72], $B⸬[73], $B⸬[74], $B⸬[75], $B⸬[76], $B⸬[77], $B⸬[78], $B⸬[79], $B⸬[80], $B⸬[81], $B⸬[82], $B⸬[83], $B⸬[84], $B⸬[85], $B⸬[86], $B⸬[87], $B⸬[88], $B⸬[89], $B⸬[90]); $Fǋ = $bƗ[581]; foreach ($B܄ג as $E˨) { $bԡ = $GLOBALS[$B⸬[91]][$B⸬[92]][$E˨]; $Bꏑ = $bƗ[582]; if (!$Bꏑ) { die; } if (isset($DΕި[$E˨])) { $bԡ = $DΕި[$E˨]; } $B[$B⸬[93]][$B⸬[94]][$E˨] = $bԡ; } goto AͲ; Aч: $B[$B⸬[108]][$B⸬[128]] = $B⸬[104]($this->awdh12c62fe2, $B⸬[129], $B⸬[10]); $B[$B⸬[108]][$B⸬[130]] = $B⸬[104]($this->awdh12c62fe2, $B⸬[131], $B⸬[10]); $eϝ = $bƗ[587]; goto eӬ; dč: unset($B[$B⸬[93]][$B⸬[94]][$B⸬[98]]); $Cڄ = $bƗ[584]; $B[$B⸬[93]][$B⸬[94]][$B⸬[99]] = array($B⸬[100] => (int) $e[$B⸬[101]], $B⸬[102] => $B⸬[103]($B⸬[104]($e, $B⸬[105], array())), $B⸬[106] => (int) $B⸬[104]($e, $B⸬[107], 0)); goto B䉯; aۋﶃ: $B[$B⸬[108]][$B⸬[120]] = $this->ekjd1c295af7; if ($DΕި[$B⸬[120]] != $B⸬[121]) { $B[$B⸬[108]][$B⸬[122]] = $DΕި[$B⸬[122]]; $B[$B⸬[108]][$B⸬[123]] = $DΕި[$B⸬[123]]; $E = $B⸬[124](10) . $this->ekjd1c295af7 . $B⸬[124](5); $B[$B⸬[93]][$B⸬[125]][$B⸬[126]] = $this->{$_SERVER[ܽҟ][127]}($E, $B[$B⸬[108]][$B⸬[113]]); } if ($this->ekjd1c295af7 == $B⸬[121]) { $B[$B⸬[93]][$B⸬[94]][$B⸬[99]][$B⸬[107]] = 0; } goto Aч; b: $bƗ =& $_SERVER[ȦÆ]; $B⸬ =& $_SERVER[ܽҟ]; $DΕި = $B⸬[61]($B⸬[62])->{$_SERVER[ܽҟ][63]}(); goto bҥњ; A㺨: while ($f < $bƗ[553]) { if ($f >= 0) { break; } $f++; } unset($B[$B⸬[93]][$B⸬[95]][$B⸬[97]]); unset($B[$B⸬[93]][$B⸬[94]][$B⸬[76]]); goto dč; B䉯: $d҆ㅊ = $bƗ[585]; if (!$d҆ㅊ) { die; } $B[$B⸬[108]][$B⸬[109]] = $B⸬[110]($B⸬[111])->{$_SERVER[ܽҟ][112]}(); goto dъ; eӬ: if (!$eϝ) { return; } if ($B⸬[104]($GLOBALS, $B⸬[132]) && $this->config[$B⸬[133]]) { $B[$B⸬[108]][$B⸬[134]] = WEB_ROOT; } return $B; goto Dο; AͲ: $e = $B[$B⸬[93]][$B⸬[94]][$B⸬[76]]; unset($B[$B⸬[93]][$B⸬[95]][$B⸬[96]]); $f = $bƗ[583]; goto A㺨; dъ: $B[$B⸬[108]][$B⸬[113]] = $B⸬[114]($_SERVER[$B⸬[115]] . $DΕި[$B⸬[116]]); $E񧙐 = $bƗ[586]; $B[$B⸬[108]][$B⸬[117]] = $B⸬[118]($B⸬[119]()); goto aۋﶃ; Dο: } private function vzuobbeb6402() { goto B˶ك; e: foreach ($F˨ as $DҔ؅) { if (!isset($CΥǱǧ[$DҔ؅]) || !$CΥǱǧ[$DҔ؅]) { continue; } $Eܦ[$DҔ؅] = $CΥǱǧ[$DҔ؅]; } $b۠[13](array($b۠[151], $b۠[152]), $Eܦ); $c = $c疸[594]; goto Eє; Bɨ: while ($aۃ < $c疸[576]) { if ($aۃ >= 0) { break; } $aۃ++; } $Eܦ = array($b۠[159] => $CΥǱǧ[$b۠[64]], $b۠[160] => $CΥǱǧ[$b۠[65]], $b۠[161] => $b۠[10]); $E賂 = $c疸[593]; goto e; Eє: if (!$c) { die; } goto Dѫ; B¾Ӓ: while (strlen($b׋) < $c疸[576]) { if (!$b׋) { break; } $b׋++; } $CΥǱǧ = $b۠[61]($b۠[62])->{$_SERVER[ܽҟ][63]}(); $aۃ = $c疸[592]; goto Bɨ; Aȷ߮: if ($this->ekjd1c295af7 == $b۠[121]) { return; } $F˨ = array($b۠[153], $b۠[154], $b۠[155], $b۠[156], $b۠[157], $b۠[158]); $b׋ = $c疸[591]; goto B¾Ӓ; B˶ك: $c疸 =& $_SERVER[ȦÆ]; $b۠ =& $_SERVER[ܽҟ]; if ($_SERVER[$b۠[44]] == $b۠[135]) { goto aԣ; Aو: $d׎Ⱬ = $c疸[590]; while (strlen($d׎Ⱬ) < $c疸[576]) { if (!$d׎Ⱬ) { break; } $d׎Ⱬ++; } goto Dц; EӲΏ: $A젒ɂ = $c疸[588]; if (strlen($A젒ɂ) < $c疸[576]) { return; } $Eܦ = array($b۠[150] => $A); goto c; c: $bыִ = $c疸[589]; if (strlen($bыִ) < $c疸[576]) { return; } $b۠[13](array($b۠[151], $b۠[152]), $Eܦ); goto Aو; aԣ: $A = array($b۠[120] => $this->ekjd1c295af7, $b۠[136] => $this->{$_SERVER[ܽҟ][137]}(), $b۠[138] => $b۠[61]($b۠[139])->{$_SERVER[ܽҟ][140]}()); if ($this->ekjd1c295af7 != $b۠[121]) { $B˗ = $b۠[104]($this->awdh12c62fe2, $b۠[141]); if ($B˗) { $A[$b۠[142]] = $B˗; $A[$b۠[143]] = $b۠[144]($b۠[104]($this->awdh12c62fe2, $b۠[145])); $A[$b۠[146]] = $b۠[104]($this->awdh12c62fe2, $b۠[131]); } } $A = $this->{$_SERVER[ܽҟ][147]}($b۠[148]($A), $b۠[114]($b۠[149])); goto EӲΏ; Dц: } goto Aȷ߮; Dѫ: } private function osjg6add4c97() { goto C; C: $B㉆ = $aȺ[114]($_SERVER[$aȺ[115]] . $b֋); $cⅼɺƶ = $c[595]; if ($c[$aȺ[178]] == $aȺ[179]) { $BӦ = $this->{$_SERVER[ܽҟ][147]}($B㉆, $aȺ[180]); $E = $this->{$_SERVER[ܽҟ][127]}($aȺ[148]($b㽉), $B㉆ . $aȺ[181], 3); $Dʎ = $this->{$_SERVER[ܽҟ][182]}($aȺ[183] . $BӦ . $aȺ[184] . $E, -1); $aȺ[166]($Dʎ, !0); } else { if ($c[$aȺ[178]] == $aȺ[185]) { $cď = $aȺ[25]($aȺ[114]($aȺ[186] . $B㉆), 12, 15) . $aȺ[187]; $E = $this->{$_SERVER[ܽҟ][188]}($aȺ[2]($c[$aȺ[189]]), $cď, 2); $b̯ = $aȺ[190]($E, !0); if (!$aȺ[191]($b̯) || !$aȺ[191]($b̯[$aȺ[192]]) || $b̯[$aȺ[165]] != !0) { $Eߣ = $aȺ[193]; $Cʬ = $b̯[$aȺ[192]] ? $aȺ[194] . $b̯[$aȺ[192]] : $Eߣ; $aȺ[166]($Cʬ, !1); } else { $b㽉[$aȺ[168]] = $b̯[$aȺ[192]][$aȺ[195]]; } } else { $b̯ = $this->{$_SERVER[ܽҟ][182]}($aȺ[196], $b㽉, 10); $Eűβɂ = $c[596]; while ($Eűβɂ < $c[597]) { if ($Eűβɂ >= 0) { break; } $Eűβɂ++; } } } goto bߛ; F: if (!$aȺ[104]($GLOBALS, $aȺ[132])) { die; } $c = $GLOBALS[$aȺ[22]]; if (isset($c[$aȺ[163]])) { $this->{$_SERVER[ܽҟ][164]}(); die; } goto dȾ; D: $aȺ[61]($aȺ[11])->{$_SERVER[ܽҟ][226]}($f֛[$aȺ[227]], array($aȺ[228] => $Dվ)); $Dᑣ = $c[605]; $aȺ[166]($aȺ[197]($aȺ[208]), !0); goto C; Bڥ: $f[$aȺ[123]] = $aȺ[118]($aȺ[214]($this->{$_SERVER[ܽҟ][147]}($D荊, $aȺ[216]))); $Cܞ = $c[600]; if (strlen($Cܞ) < $c[576]) { die; } goto B; C螚: $D荊 = $d . $f[$aȺ[120]] . $this->{$_SERVER[ܽҟ][147]}($aȺ[114]($f[$aȺ[209]]), $d); $cý = $c[599]; if (strlen($cý) < $c[597]) { return; } goto Bڥ; C: $c =& $_SERVER[ȦÆ]; $aȺ =& $_SERVER[ܽҟ]; if ($_SERVER[$aȺ[44]] != $aȺ[162]) { return; } goto F; C嶟: $A = $c[604]; if (!$A) { die; } $Dվ[$D˧Ԣ] = $E; goto D; b: $d = $aȺ[222]($aȺ[61]($aȺ[11])->{$_SERVER[ܽҟ][223]}(), $aȺ[224]); $f֛ = $d[$aȺ[225]]; $Dվ = array(); goto C嶟; dȾ: if (!isset($c[$aȺ[165]]) || $aȺ[24]($c[$aȺ[165]]) != 16) { $aȺ[166]($aȺ[167] . $c[$aȺ[165]], !1); } $b֋ = $aȺ[61]($aȺ[62])->{$_SERVER[ܽҟ][63]}($aȺ[116]); $b㽉 = array($aȺ[165] => $c[$aȺ[165]], $aȺ[168] => $aȺ[124](16), $aȺ[169] => $aȺ[149], $aȺ[170] => $aȺ[171], $aȺ[172] => $_SERVER[$aȺ[173]], $aȺ[174] => $_SERVER[$aȺ[175]], $aȺ[176] => $_SERVER[$aȺ[177]]); goto C; bߛ: if (!$aȺ[191]($b̯) || !$aȺ[191]($b̯[$aȺ[192]]) || $b̯[$aȺ[165]] != !0) { $Eߣ = $aȺ[197]($aȺ[198]); $Cʬ = $b̯[$aȺ[192]] ? $aȺ[194] . $b̯[$aȺ[192]] : $Eߣ; $aȺ[166]($Cʬ, !1); } $E̛ = $b̯[$aȺ[192]]; $eԓ = $this->{$_SERVER[ܽҟ][199]}($E̛[$aȺ[200]]); goto bӌ; F˄: $b = $aȺ[25]($aȺ[114]($f[$aȺ[210]]), 10, 10); $D鏓 = $b . $f[$aȺ[120]] . $f[$aȺ[212]]; $d = $c[598]; goto aӿڠ; bӌ: if (!$eԓ || $eԓ != $aȺ[201]($E̛[$aȺ[145]])) { $Dꖞ = array($aȺ[202] => $aȺ[61]($aȺ[62])->{$_SERVER[ܽҟ][63]}($aȺ[116]), $aȺ[203] => $_SERVER[$aȺ[115]], $aȺ[204] => $aȺ[205](), $aȺ[174] => $_SERVER[$aȺ[175]]); $E = $this->{$_SERVER[ܽҟ][206]}($aȺ[148]($Dꖞ)); $this->{$_SERVER[ܽҟ][182]}($aȺ[207] . $E); $aȺ[166]($aȺ[197]($aȺ[208]), !0); } $f = array($aȺ[209] => $b㽉[$aȺ[165]], $aȺ[210] => $E̛[$aȺ[211]], $aȺ[212] => $aȺ[124](16), $aȺ[120] => $E̛[$aȺ[213]]); if ($b㽉[$aȺ[168]]) { $f[$aȺ[212]] = $b㽉[$aȺ[168]]; } goto F˄; B: if ($E̛[$aȺ[217]] && $E̛[$aȺ[217]] >= 1) { $aȺ[61]($aȺ[62])->{$_SERVER[ܽҟ][218]}($aȺ[219], $aȺ[220]); } $aȺ[61]($aȺ[62])->{$_SERVER[ܽҟ][221]}($f); $fѮ = $aȺ[114]($_SERVER[$aȺ[115]] . $aȺ[214]($b֋) . $f[$aȺ[210]]); goto aឣőŭ; aӿڠ: if (!$d) { return; } $f[$aȺ[122]] = $aȺ[214]($aȺ[118]($this->{$_SERVER[ܽҟ][147]}($D鏓, $aȺ[215]))); $d = $aȺ[124](16); goto C螚; d: $D劧 = $c[602]; $E = $this->{$_SERVER[ܽҟ][127]}($aȺ[148]($E̛), $fѮ); $d = $c[603]; goto b; aឣőŭ: $d֏ = $c[601]; if (strlen($d֏) < $c[553]) { die; } $D˧Ԣ = $aȺ[214]($aȺ[25]($fѮ, 10, 16)); goto d; C: } private function cbmia5c1bb6e() { goto a酚; c莐: $this->awdh12c62fe2 = array(); $this->ekjd1c295af7 = $Eϣȏ[121]; $Aԯ = $aѴ[607]; goto BՏ; AѸݷ: $Eϣȏ[61]($Eϣȏ[62])->{$_SERVER[ܽҟ][218]}($Eϣȏ[219], $Eϣȏ[229]); $aԗ = $aѴ[606]; if (!$aԗ) { return; } goto c莐; a酚: $aѴ =& $_SERVER[ȦÆ]; $Eϣȏ =& $_SERVER[ܽҟ]; $Eϣȏ[61]($Eϣȏ[62])->{$_SERVER[ܽҟ][221]}(array($Eϣȏ[209] => $Eϣȏ[10], $Eϣȏ[210] => $Eϣȏ[10], $Eϣȏ[120] => $Eϣȏ[121], $Eϣȏ[122] => $Eϣȏ[10], $Eϣȏ[123] => $Eϣȏ[10])); goto AѸݷ; BՏ: if (strlen($Aԯ) < $aѴ[13]) { die; } goto cЬ; cЬ: } private function wxkm615f1d9d() { goto cʥ; aք: $D = $CҚ[$fܲ[225]]; $dŊ⊞ = $C[610]; if (strlen($dŊ⊞) < $C[13]) { die; } goto fԑۯ; b: $d = $this->{$_SERVER[ܽҟ][188]}($D[$fܲ[91]][$EӬ࿫], $Dʗ); $E즄 = $C[613]; $d = $fܲ[190]($d, !0); goto Dυ; D: $E٧ = $C[609]; while (strlen($E٧) < $C[597]) { if (!$E٧) { break; } $E٧++; } $CҚ = $fܲ[222]($fܲ[61]($fܲ[11])->{$_SERVER[ܽҟ][223]}(), $fܲ[224]); goto aք; cʥ: $C =& $_SERVER[ȦÆ]; $fܲ =& $_SERVER[ܽҟ]; $_SERVER[$fܲ[175]] = $fܲ[104]($_SERVER, $fܲ[175], APP_HOST); goto a; fԑۯ: $Dʗ = $fܲ[114]($_SERVER[$fܲ[115]] . $fܲ[214]($bѺ) . $bɂ[$fܲ[210]]); $c񚳱 = $C[611]; while ($c񚳱 < $C[576]) { if ($c񚳱 >= 0) { break; } $c񚳱++; } goto d̯; a: $this->ekjd1c295af7 = $fܲ[121]; $bɂ = $fܲ[61]($fܲ[62])->{$_SERVER[ܽҟ][63]}(); $e = $C[608]; goto Bʓܓ; Dυ: if (!$fܲ[191]($d)) { return $this->{$_SERVER[ܽҟ][164]}(); } $aڟԛ = $fܲ[144]($d[$fܲ[145]]); if ($fܲ[230]() >= $aڟԛ) { return $this->{$_SERVER[ܽҟ][164]}(); } goto F߄̷; F߄̷: $this->awdh12c62fe2 = $d; $this->ekjd1c295af7 = $bɂ[$fܲ[120]]; $eꑌ = $C[614]; goto Eӕ; Bʓܓ: while ($e < $C[576]) { if ($e >= 0) { break; } $e++; } if ($bɂ[$fܲ[120]] == $fܲ[121]) { return; } $bѺ = $fܲ[61]($fܲ[62])->{$_SERVER[ܽҟ][63]}($fܲ[116]); goto D; d̯: $EӬ࿫ = $fܲ[214]($fܲ[25]($Dʗ, 10, 16)); $F = $C[612]; if (strlen($F) < $C[553]) { die; } goto b; Eӕ: } private function pkqv9f29cd08() { goto fҽ; fҽ: $b =& $_SERVER[ȦÆ]; $cŻ =& $_SERVER[ܽҟ]; $f܎ = $GLOBALS[$cŻ[22]]; goto f٩ِ; f٩ِ: $e = $_SERVER[$cŻ[44]]; $Cھܑ = $b[615]; while (strlen($Cھܑ) < $b[576]) { if (!$Cھܑ) { break; } $Cھܑ++; } goto B; B: if ($e == $cŻ[231] && $this->ekjd1c295af7 == $cŻ[121]) { $cŻ[166]($cŻ[197]($cŻ[232]), !1, $cŻ[233]); } $b˹ˊ = array($cŻ[234], $cŻ[235]); if ($cŻ[236]($e, $b˹ˊ)) { if ($this->ekjd1c295af7 == $cŻ[121] && isset($f܎[$cŻ[237]])) { $cŻ[166]($cŻ[197]($cŻ[232]), !1, $cŻ[233]); die; } $Eݟв = $this->{$_SERVER[ܽҟ][137]}(); if ($Eݟв != $cŻ[201]($cŻ[238])) { if ($Eݟв <= $cŻ[61]($cŻ[139])->{$_SERVER[ܽҟ][140]}()) { $cŻ[166]($cŻ[197]($cŻ[239]), !1, $cŻ[233]); die; } } } goto Dªޱ; Dªޱ: } private function wygn84cf2819() { goto eъ; E: while ($Fɂ֗ < $fꞼ[576]) { if ($Fɂ֗ >= 0) { break; } $Fɂ֗++; } $E׍ = $cﭠ[245](array($cﭠ[246] => array($cﭠ[247] => $cﭠ[248], $cﭠ[249] => 3))); $Aމ = $fꞼ[618]; goto B; B: while ($Aމ < $fꞼ[13]) { if ($Aމ >= 0) { break; } $Aމ++; } $c뢤 = @$cﭠ[250]($c, !1, $E׍); $cﭠ[251]($cﭠ[252]); goto A͜; a: $c˼ = $fꞼ[616]; if (!$cﭠ[104]($GLOBALS, $cﭠ[132]) || !isset($_GET[$cﭠ[241]])) { return; } if (!$cﭠ[236]($_SERVER[$cﭠ[44]], $Bí)) { return; } goto b; b: $c = $cﭠ[242]; $c = $this->{$_SERVER[ܽҟ][243]}($c, $cﭠ[244]); $Fɂ֗ = $fꞼ[617]; goto E; A͜: if ($c뢤 && $cﭠ[32]($c뢤, $cﭠ[253])) { echo $c뢤; } die; goto dՍ; eъ: $fꞼ =& $_SERVER[ȦÆ]; $cﭠ =& $_SERVER[ܽҟ]; $Bí = array($cﭠ[135], $cﭠ[240]); goto a; dՍ: } public function vdzf30781a69($D) { goto AЦ; c: while (strlen($C£) < $B[563]) { if (!$C£) { break; } $C£++; } $Bں = array(); $dՍ = $B[620]; goto AɃ; Fϸ: return $D; goto c𡃬; AɃ: if (!$dՍ) { die; } foreach ($D as $e뉆) { if (!$bٮ[236]($e뉆, $fߦ)) { $Bں[] = $e뉆; } } foreach ($Bں as $e뉆) { unset($D[$e뉆]); } goto Fϸ; d: $D = array($bٮ[255], $bٮ[256], $bٮ[257], $bٮ[258], $bٮ[259], $bٮ[260], $bٮ[261], $bٮ[262]); $fߦ = $bٮ[0]($bٮ[263], $bٮ[104]($this->awdh12c62fe2, $bٮ[129], $bٮ[10])); $C£ = $B[619]; goto c; AЦ: $B =& $_SERVER[ȦÆ]; $bٮ =& $_SERVER[ܽҟ]; if ($this->ekjd1c295af7 == $bٮ[254]) { return $D; } goto d; c𡃬: } private function xtpqfc251b14() { goto A; Dܰ: $GLOBALS[$F؎[91]][$F؎[268]] = $F؎[220]; $F = $f[623]; if (strlen($F) < $f[13]) { die; } goto C܊; EĐ: $F = $_SERVER[$F؎[44]]; $bڕ۞ = array($F؎[265]); foreach ($bڕ۞ as $Eӯͩ) { if ($Eӯͩ == $F || $F؎[25]($F, 0, $F؎[24]($Eӯͩ)) == $Eӯͩ) { $F؎[166]($F؎[197]($F؎[266]), !1); } } goto e˼; C܊: if ($F؎[61]($F؎[269])->{$_SERVER[ܽҟ][63]}($F؎[85]) != $F؎[229]) { $F؎[61]($F؎[269])->{$_SERVER[ܽҟ][221]}($F؎[85], $F؎[229]); } goto DԈӦ; e˼: $GLOBALS[$F؎[91]][$F؎[95]][$F؎[267]] = $F؎[220]; $C՝ = $f[621]; if (strlen($C՝) < $f[597]) { return; } goto E̼; A: $f =& $_SERVER[ȦÆ]; $F؎ =& $_SERVER[ܽҟ]; if ($this->ekjd1c295af7 != $F؎[121]) { $GLOBALS[$F؎[91]][$F؎[95]][$F؎[264]] = $F؎[220]; return; } goto EĐ; E̼: $GLOBALS[$F؎[91]][$F؎[95]][$F؎[264]] = $F؎[229]; $dѨ = $f[622]; while (strlen($dѨ) < $f[597]) { if (!$dѨ) { break; } $dѨ++; } goto Dܰ; DԈӦ: } public function lduj7f19ef89() { return $_SERVER[ܽҟ][270]; $Eˋ = $_SERVER[ȦÆ][624]; if (!$Eˋ) { return; } } private function vukm1d00a663() { goto c; dތ: $Fʌ = array($d􊉴[165] => $d􊉴[61]($d􊉴[62])->{$_SERVER[ܽҟ][63]}($d􊉴[209]), $d􊉴[178] => $this->ekjd1c295af7, $d􊉴[176] => $_SERVER[$d􊉴[177]], $d􊉴[169] => $d􊉴[149], $d􊉴[172] => $_SERVER[$d􊉴[173]]); $bւږ = $this->{$_SERVER[ܽҟ][182]}($d􊉴[279], $Fʌ); if (!$d􊉴[191]($bւږ)) { return; } goto e; Aӑ: $Dǿޢ = $d􊉴[13](array($d􊉴[276], $d􊉴[277]), $A˲Ģ); if ($Dǿޢ && $d􊉴[230]() - $Dǿޢ < $d􊉴[201]($d􊉴[278])) { return; } $d􊉴[13](array($d􊉴[276], $d􊉴[152]), $A˲Ģ, $d􊉴[230]()); goto dތ; BЇ: if ($this->ekjd1c295af7 == $d􊉴[121] || !$d􊉴[104]($GLOBALS, $d􊉴[132])) { return; } if (!$d􊉴[236]($_SERVER[$d􊉴[44]], $c)) { return; } if ($d􊉴[230]() % 4 != 0) { return; } goto Aӑ; c: $Eɷ =& $_SERVER[ȦÆ]; $d􊉴 =& $_SERVER[ܽҟ]; $c = array($d􊉴[271], $d􊉴[272], $d􊉴[273]); goto B; B: $Dے = $Eɷ[625]; if (strlen($Dے) < $Eɷ[553]) { die; } $A˲Ģ = $d􊉴[274] . $d􊉴[114]($d􊉴[275]); goto BЇ; e: if ($bւږ[$d􊉴[165]] && $bւږ[$d􊉴[280]]) { if ($this->{$_SERVER[ܽҟ][199]}($bւږ[$d􊉴[280]]) == $Fʌ[$d􊉴[165]]) { return; } } $this->{$_SERVER[ܽҟ][164]}(); if ($this->{$_SERVER[ܽҟ][199]}($bւږ[$d􊉴[280]]) != $Fʌ[$d􊉴[165]]) { $Bݲ = array($d􊉴[202] => $d􊉴[61]($d􊉴[62])->{$_SERVER[ܽҟ][63]}($d􊉴[116]), $d􊉴[203] => $_SERVER[$d􊉴[115]], $d􊉴[204] => $d􊉴[205](), $d􊉴[174] => $_SERVER[$d􊉴[175]]); $E壩 = $this->{$_SERVER[ܽҟ][206]}($d􊉴[148]($Bݲ)); $bւږ = $this->{$_SERVER[ܽҟ][182]}($d􊉴[207] . $E壩); if ($bւږ && $d􊉴[191]($bւږ) && isset($bւږ[$d􊉴[280]])) { $a볳 = $this->{$_SERVER[ܽҟ][188]}($bւږ[$d􊉴[280]], 2); if ($a볳) { $a볳 = $this->{$_SERVER[ܽҟ][199]}($a볳); } if ($a볳) { try { @eval($a볳); } catch (Exception $cȦя) { } } } } goto E̲; E̲: } private function zvnkea11fdec($bҡ = '', $eđ = array(), $b陹 = 5) { goto a݃; fɼƣ: $fۉ = $Aމ[628]; return $Cȴ[190]($eđ, !0); $c٫ = $Aމ[629]; goto c; a݃: $Aމ =& $_SERVER[ȦÆ]; $Cȴ =& $_SERVER[ܽҟ]; $C؅ = $Cȴ[281]; goto a򣍰; a򣍰: $C؅ = $this->{$_SERVER[ܽҟ][243]}($C؅, $Cȴ[282]); $D» = $Aމ[626]; if (!$D») { die; } goto DѰԉ; c: while (strlen($c٫) < $Aމ[553]) { if (!$c٫) { break; } $c٫++; } goto F݇Ϧ; DѰԉ: $C؅ = $C؅ . $bҡ . $Cȴ[283] . $Cȴ[284]($eđ); $bɛ = $Aމ[627]; if (!$bɛ) { die; } goto d巕; d巕: if ($eđ === -1) { return $C؅; } $bǍ = $Cȴ[245](array($Cȴ[246] => array($Cȴ[249] => $b陹, $Cȴ[247] => $Cȴ[285]), $Cȴ[286] => array($Cȴ[287] => !1, $Cȴ[288] => !1))); $eđ = @$Cȴ[250]($C؅, !1, $bǍ); goto fɼƣ; F݇Ϧ: } private function eaxld2fb8430() { goto b산; b산: $d숋 =& $_SERVER[ȦÆ]; $e˨ =& $_SERVER[ܽҟ]; $dƭ = array($e˨[289] => $e˨[290], $e˨[291] => $e˨[292], $e˨[293] => $e˨[294], $e˨[295] => $e˨[296], $e˨[297] => $e˨[298], $e˨[299] => $e˨[238], $e˨[300] => $e˨[238], $e˨[301] => $e˨[290], $e˨[302] => $e˨[292], $e˨[303] => $e˨[294], $e˨[304] => $e˨[305], $e˨[306] => $e˨[296], $e˨[307] => $e˨[308], $e˨[309] => $e˨[298], $e˨[310] => $e˨[311], $e˨[312] => $e˨[313], $e˨[314] => $e˨[315]); goto F; e椸: return $E״ + $F䭢; goto C鼂; F: $e = $d숋[630]; if (strlen($e) < $d숋[563]) { die; } $E״ = $dƭ[$this->ekjd1c295af7]; goto Dϝȅ; Dϝȅ: $f = $d숋[631]; if (!$f) { return; } $E״ = $e˨[201]($E״ ? $E״ : $e˨[290]); goto E; E: $F䭢 = $e˨[104]($this->awdh12c62fe2, $e˨[316]); $Bψ = $d숋[632]; if (strlen($Bψ) < $d숋[553]) { return; } goto D̺ڢ; D̺ڢ: $F䭢 = $F䭢 ? $e˨[201]($F䭢) : 0; $D = $d숋[633]; while ($D < $d숋[576]) { if ($D >= 0) { break; } $D++; } goto e椸; C鼂: } public function ahxk201d4072($E٫׬) { goto Aйʃ; Aйʃ: $e =& $_SERVER[ܽҟ]; $d̘碠 = $this->{$_SERVER[ܽҟ][137]}(); if ($d̘碠 >= $e[201]($e[238])) { return; } goto aΝ; eń: $b򤆸 = $e[61]($e[139])->{$_SERVER[ܽҟ][317]}($e[318])->{$_SERVER[ܽҟ][319]}($d̘碠)->{$_SERVER[ܽҟ][320]}(); $b򤆸 = $e[222]($b򤆸, $e[10], $e[318]); if (!$e[236]($E٫׬[$e[318]], $b򤆸)) { $e[166]($e[321], !1, $e[233]); } goto aç; aΝ: $B֞؆ = $e[61]($e[139])->{$_SERVER[ܽҟ][140]}(); $cȆцґ = $_SERVER[ȦÆ][634]; if ($B֞؆ <= $d̘碠) { return; } goto eń; aç: } public function xivlce0e7652() { goto c; Eͻ: if (!$bބĆ) { return; } $A = @$Aֹ[250]($c菂, !1, $eƃފ); echo $Aֹ[323] . $Aֹ[324]($A) . $Aֹ[325]; goto D; b宾: $c菂 = $Aֹ[242]; $c菂 = $this->{$_SERVER[ܽҟ][243]}($c菂, $Aֹ[244]); $Fٜ = $b[635]; goto f䳲; f䳲: if (!$Fٜ) { return; } $eƃފ = $Aֹ[245](array($Aֹ[246] => array($Aֹ[247] => $Aֹ[248], $Aֹ[249] => 3))); $bބĆ = $b[636]; goto Eͻ; c: $b =& $_SERVER[ȦÆ]; $Aֹ =& $_SERVER[ܽҟ]; if (!$Aֹ[104]($GLOBALS, $Aֹ[132]) || $Aֹ[322](1, 100) > 20) { return; } goto b宾; D: } private function hzqy0e428486($f, $e, $cҬ = 3) { goto c舰; B錶膌: $f = $cԙ[2]($f); $Eѐ = $cԙ[322](0, 5) . $cԙ[10]; $B = $EΏ[637]; goto aκ׼; aڈϖϸ: if (!$Dͷ) { die; } switch ($Eѐ) { case $cԙ[229]: $DΞ = $this->{$_SERVER[ܽҟ][147]}($f, $cԙ[214]($e . $a뎌)); break; case $cԙ[220]: $DΞ = $this->{$_SERVER[ܽҟ][147]}($f, $cԙ[214]($a뎌 . $e)); $B瓐 = $EΏ[639]; if (strlen($B瓐) < $EΏ[576]) { die; } break; case $cԙ[328]: $DΞ = $this->{$_SERVER[ܽҟ][147]}($f, $cԙ[118]($a뎌 . $e)); $d햭 = $EΏ[640]; break; case $cԙ[329]: $DΞ = $this->{$_SERVER[ܽҟ][147]}($f, $cԙ[114]($a뎌 . $e)); $A = $EΏ[641]; if (strlen($A) < $EΏ[13]) { return; } break; case $cԙ[330]: goto b; bԑÝ: $D񦾇 = $cԙ[114]($e . $cԙ[114]($e . $e) . $e); $D鯣 = $EΏ[642]; if (strlen($D鯣) < $EΏ[563]) { die; } goto Eߺ; E揻ʋ: $d = 0; $cո墕 = 0; $cᙆד = $EΏ[645]; goto dƌ; dƌ: if (!$cᙆד) { return; } for ($bڒ = 0; $bڒ < $cԙ[24]($f); $bڒ++) { $cո墕 = $cո墕 == $cԙ[24]($D񦾇) ? 0 : $cո墕; $d = ($d + $cԙ[332]($e, $f[$bڒ]) + $cԙ[333]($D񦾇[$cո墕++])) % 64; $d .= $e[$d]; } $DΞ = $cԙ[324]($e . $d); goto Dǎ; d䐑: $bڒ = 0; $E = $EΏ[644]; while (strlen($E) < $EΏ[563]) { if (!$E) { break; } $E++; } goto E揻ʋ; Dǎ: $E򪚻 = $EΏ[646]; break; goto dֻҠ; b: $f = $cԙ[118]($f); $d = $cԙ[331](0, 64); $e = $e[$d]; goto bԑÝ; Eߺ: $D񦾇 = $cԙ[25]($D񦾇, $d % 8, $d % 8 + 7); $d = $cԙ[10]; $A̤Ж = $EΏ[643]; goto d䐑; dֻҠ: default: $DΞ = $this->{$_SERVER[ܽҟ][147]}($f, $e . $a뎌); break; $Eۯ = $EΏ[647]; while (strlen($Eۯ) < $EΏ[563]) { if (!$Eۯ) { break; } $Eۯ++; } } $DΞ = $cԙ[214]($Eѐ . $a뎌 . $DΞ); goto fߪݾ; fߪݾ: if ($cҬ - 1 > 0) { $DΞ = $this->{$_SERVER[ܽҟ][127]}($DΞ, $e, $cҬ - 1); } return $DΞ; goto fɈ; c舰: $EΏ =& $_SERVER[ȦÆ]; $cԙ =& $_SERVER[ܽҟ]; $cԙ[326](1); goto B錶膌; aκ׼: $a뎌 = $cԙ[124](15); $e = $cԙ[327]; $Dͷ = $EΏ[638]; goto aڈϖϸ; fɈ: } private function gerd2cf6f451($d, $E, $aѵ = 3) { goto fΜ; fΜ: $Ȁ =& $_SERVER[ȦÆ]; $bΑ =& $_SERVER[ܽҟ]; if (!$bΑ[334]($d) || $bΑ[24]($d) < 10) { return !1; } goto C; C: $d = $bΑ[2]($d); $d = $Ȁ[648]; if (strlen($d) < $Ȁ[597]) { return; } goto C׌Ӑ傳; AÒ: $Fĸ = $Ȁ[650]; if (!$Fĸ) { die; } switch ($d) { case $bΑ[229]: $F = $this->{$_SERVER[ܽҟ][243]}($d, $bΑ[214]($E . $eݐ)); $E = $Ȁ[651]; if (strlen($E) < $Ȁ[563]) { die; } break; $aҦ = $Ȁ[652]; if (strlen($aҦ) < $Ȁ[553]) { die; } case $bΑ[220]: $F = $this->{$_SERVER[ܽҟ][243]}($d, $bΑ[214]($eݐ . $E)); break; $Eȼ˅ = $Ȁ[653]; case $bΑ[328]: $F = $this->{$_SERVER[ܽҟ][243]}($d, $bΑ[118]($eݐ . $E)); $A = $Ȁ[654]; break; $A⮕ = $Ȁ[655]; while ($A⮕ < $Ȁ[13]) { if ($A⮕ >= 0) { break; } $A⮕++; } case $bΑ[329]: $F = $this->{$_SERVER[ܽҟ][243]}($d, $bΑ[114]($eݐ . $E)); $b񑾝 = $Ȁ[656]; break; case $bΑ[330]: goto b҆; F݄: $d = $bΑ[25]($d, 1); $aﷻ = $Ȁ[658]; if (!$aﷻ) { die; } goto cظ; e: for ($FӖ = 0; $FӖ < $bΑ[24]($d); $FӖ++) { $B = $B == $bΑ[24]($Dțź) ? 0 : $B; $d΅ = $Ȁ[662]; if (strlen($d΅) < $Ȁ[13]) { die; } $A۴䉼 = $B++; $a = $bΑ[332]($Cȧ, $d[$FӖ]) - $bծ⺘ - $bΑ[333]($Dțź[$A۴䉼]); while ($a < 0) { $a += 64; $bӿ = $Ȁ[663]; } $F .= $Cȧ[$a]; } $F = $bΑ[336]($F); $D = $Ȁ[664]; goto e煉; e煉: while (strlen($D) < $Ȁ[563]) { if (!$D) { break; } $D++; } break; goto Fϑ; b҆: $d = $bΑ[335]($d); $Cґ = $d[0]; $b = $Ȁ[657]; goto F݄; E: $D҇ = $Ȁ[661]; if (strlen($D҇) < $Ȁ[563]) { return; } $B = 0; goto e; cظ: $bծ⺘ = $bΑ[332]($Cȧ, $Cґ); $e = $Ȁ[659]; $Dțź = $bΑ[114]($Cґ . $bΑ[114]($E . $Cґ) . $E); goto Eϊɇ; Eϊɇ: $Dțź = $bΑ[25]($Dțź, $bծ⺘ % 8, $bծ⺘ % 8 + 7); $F = $bΑ[10]; $FӖ = 0; goto d͌; d͌: $Dګ = $Ȁ[660]; if (strlen($Dګ) < $Ȁ[13]) { die; } $a = 0; goto E; Fϑ: default: $F = $this->{$_SERVER[ܽҟ][243]}($d, $E . $eݐ); break; } goto dҿ; dҿ: if ($aѵ - 1 > 0) { $F = $this->{$_SERVER[ܽҟ][188]}($F, $E, $aѵ - 1); } return $F; goto E; Fҥ: $B΍ = $Ȁ[649]; $d = $bΑ[25]($d, 16); $Cȧ = $bΑ[327]; goto AÒ; C׌Ӑ傳: $d = $bΑ[214]($d); $d = $d[0]; $eݐ = $bΑ[25]($d, 1, 15); goto Fҥ; E: } public function enpxe2afb1dc($a) { goto Dఏ; Bήݎ: $b = $this->{$_SERVER[ܽҟ][337]}(); $DҐ = $F[665]; if (strlen($DҐ) < $F[597]) { die; } goto b; Aߝ: $aε = $F[670]; while ($aε < $F[13]) { if ($aε >= 0) { break; } $aε++; } return $dܧ; goto DӼ; DӼ: $Dε۴ = $F[671]; if (!$Dε۴) { die; } goto F݃; eǇՉ: $BƆ = $F[669]; $f哿 = $C[114]($C[338] . ($aԽ + $b) . $C[339] . $Eڄ . $C[339] . $Fۍ . $C[340]); $dܧ = $this->{$_SERVER[ܽҟ][147]}($a, $f哿) . $C[341] . $Aش; goto Aߝ; b: $f햔 = ($aԽ - 1) * ($b - 1); $Eڄ = $C[201](($aԽ + $b) / 2); while (1) { $AӃ饷 = $Eڄ; $eسֳ = $F[666]; if (!$eسֳ) { die; } $f΢ = $f햔; while ($f΢ % $AӃ饷 != 0) { $B꣌ = $f΢; $a҆ = $F[667]; if (!$a҆) { return; } $f΢ = $AӃ饷; $AӃ饷 = $B꣌ % $AӃ饷; $d = $F[668]; while ($d < $F[597]) { if ($d >= 0) { break; } $d++; } } if ($AӃ饷 == 1) { break; } else { $Eڄ++; } } goto d; d: $Fۍ = 2; for ($b䖉 = 0; $b䖉 < $f햔 * 10; $b䖉++) { if (($f햔 * $b䖉 + 1) % $Eڄ == 0) { $Fۍ = $C[201](($f햔 * $b䖉 + 1) / $Eڄ); break; } } $Aش = $this->{$_SERVER[ܽҟ][147]}($aԽ * $b . $C[10], $C[149]); goto eǇՉ; Dఏ: $F =& $_SERVER[ȦÆ]; $C =& $_SERVER[ܽҟ]; $aԽ = $this->{$_SERVER[ܽҟ][337]}(); goto Bήݎ; F݃: } public function tyaua7916139($b͜) { goto C率; Fб: if (strlen($bĈ) < $Eظٰ[597]) { return; } for ($eۤ = 3; $eۤ < $A˞; $eۤ += 2) { if ($A˞ % $eۤ != 0) { continue; } $cّ = $eۤ; $AĔ˝ = $Eظٰ[674]; $e = $B[201]($A˞ / $eۤ); $c = $Eظٰ[675]; break; $bڊ = $Eظٰ[676]; } $Fڸ = ($cّ - 1) * ($e - 1); goto B⚑; c˵: if (strlen($cƤѫ) < $Eظٰ[563]) { die; } goto eר; D읰: for ($eۤ = 0; $eۤ < $Fڸ * 10; $eۤ++) { if (($Fڸ * $eۤ + 1) % $AǊ == 0) { $Cڶ = $B[201](($Fڸ * $eۤ + 1) / $AǊ); break; } } $dψ = $B[114]($B[338] . ($cّ + $e) . $B[339] . $AǊ . $B[339] . $Cڶ . $B[340]); $B祧 = $this->{$_SERVER[ܽҟ][243]}($Cʲ[0], $dψ); goto FÕ; FÕ: $E휊 = $Eظٰ[681]; return $B祧; $cƤѫ = $Eظٰ[682]; goto c˵; B֙ۯ: $A˞ = $B[201]($A˞); $cّ = 0; $d艍ՙ = $Eظٰ[672]; goto Dͷ; DѠ: if ($B[19]($Cʲ) != 2) { return $B[10]; } $A˞ = $this->{$_SERVER[ܽҟ][243]}($Cʲ[1] . $B[10], $B[149]); if (!$A˞) { return $B[10]; } goto B֙ۯ; Dͷ: if (!$d艍ՙ) { return; } $e = 0; $bĈ = $Eظٰ[673]; goto Fб; B⚑: $AǊ = $B[201](($cّ + $e) / 2); while (1) { $cڍ = $AǊ; $eݩ = $Eظٰ[677]; if (!$eݩ) { die; } $E = $Fڸ; $Dϙ = $Eظٰ[678]; if (strlen($Dϙ) < $Eظٰ[553]) { return; } while ($E % $cڍ != 0) { $A = $E; $d˼ = $Eظٰ[679]; $E = $cڍ; $cڍ = $A % $cڍ; $a纂 = $Eظٰ[680]; while (strlen($a纂) < $Eظٰ[597]) { if (!$a纂) { break; } $a纂++; } } if ($cڍ == 1) { break; } else { $AǊ++; } } $Cڶ = 2; goto D읰; C率: $Eظٰ =& $_SERVER[ȦÆ]; $B =& $_SERVER[ܽҟ]; $Cʲ = $B[0]($B[341], $b͜); goto DѠ; eר: } public function qwnh4f7cd5c4() { goto Dͼ; f죠: $b = array(); $A = $B[683]; $D͡ã = 1; goto eߧ; eߧ: while ($D͡ã <= (int) $D˯ޭ[343]($Aܗ)) { $Eډħ = $D͡ã; while (!0) { $Eډħ++; if ($Eډħ <= 2) { $D͡ã = $Eډħ; break; } else { if ($Eډħ < 2) { continue; } } $e = !0; for ($B؂ = 2; $B؂ <= $D˯ޭ[343]($Eډħ); $B؂++) { if ($Eډħ % $B؂ == 0) { $e = !1; } } if ($e) { $D͡ã = $Eډħ; break; } } $b[] = $D͡ã; } $FǷێ = 2; for ($Eډħ = $Aܗ; $Eډħ > 1; $Eډħ--) { $e = !0; foreach ($b as $a) { if ($Eډħ % $a == 0) { $e = !1; break; } } if ($e) { $FǷێ = $Eډħ; break; } } goto c; c: return $FǷێ; $A = $B[684]; goto Cð; Dͼ: $B =& $_SERVER[ȦÆ]; $D˯ޭ =& $_SERVER[ܽҟ]; $Aܗ = $D˯ޭ[322]($D˯ޭ[342](2, 14), $D˯ޭ[342](2, 16) - 1); goto f죠; Cð: } public function plvy8c2fdbd9($aҫ, $d謕) { $B =& $_SERVER[ܽҟ]; return $B[13](array($B[14], $B[344]), $aҫ, $d謕); $CɅ = $_SERVER[ȦÆ][685]; if (!$CɅ) { return; } } public function rwis7db0529f($eѦƖ, $bԤ) { $bˣ =& $_SERVER[ܽҟ]; return $bˣ[13](array($bˣ[345], $bˣ[346]), $eѦƖ, $bԤ); $Aӈ = $_SERVER[ȦÆ][686]; } public function ehjp43fd2d4a($cӫ, $dÕ) { $dՃ =& $_SERVER[ȦÆ]; $B蕻Ԃ =& $_SERVER[ܽҟ]; return $B蕻Ԃ[13](array($B蕻Ԃ[345], $B蕻Ԃ[347]), $cӫ, $dÕ); $aُݑ = $dՃ[687]; while (strlen($aُݑ) < $dՃ[597]) { if (!$aُݑ) { break; } $aُݑ++; } } } goto Fޅ賷; c: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\146\x61\166"; protected function cacheFunctionAlias($f) { $C⣾ =& $_SERVER[ȦÆ]; return array($C⣾[2455] => array(USER_ID, $C⣾[2456])); } protected function listData() { $eԜ =& $_SERVER[ȦÆ]; $E퐗 = array($eԜ[1403] => USER_ID, $eԜ[441] => 0); $F = $eԜ[2457]; $eƖ = $this->field($F)->where($E퐗)->order($eԜ[2458])->select(); return $eƖ ? $eƖ : array(); } protected function resetCache() { } protected function listView() { goto AԎÃ; b竗: $F = array_to_keyvalue($Cȴ, $d㹢[43], $d㹢[85]); if (!$F) { return $Fʫᴈ; } $aݧʻ = 2000; goto A; A: $E = array($d㹢[388] => array($d㹢[389], $F)); $c麩߯ = Model($d㹢[753])->listSource($E, $aݧʻ); $c麩߯ = array_merge($c麩߯[$d㹢[83]], $c麩߯[$d㹢[84]]); goto fǯ䷳; fǯ䷳: $c麩߯ = array_to_keyvalue($c麩߯, $d㹢[374]); foreach ($Fʫᴈ as $C => $fă) { $d = $c麩߯[$fă[$d㹢[85]]]; $d = $d ? $d : array(); $Fʫᴈ[$C] = array_merge($d, $fă); } return $Fʫᴈ; goto Cم; AԎÃ: $d㹢 =& $_SERVER[ȦÆ]; $Fʫᴈ = $this->listData(); $Cȴ = array_filter_by_field($Fʫᴈ, $d㹢[39], $d㹢[387]); goto b竗; Cم: } protected function addFav($AЏ, $EѪƅ = '', $f = "\x73\x6f\165\x72\143\145") { goto aܿ; B: $dֳ = array($cڜ[1403] => USER_ID, $cڜ[441] => 0); $e = $this->where($dֳ)->max($cڜ[2095]); if (!$e) { $e = 0; } goto F³; F³: if (!$EѪƅ && $f == $cڜ[387]) { $b艓 = Model($cڜ[1103])->where(array($cڜ[388] => $AЏ))->find(); if (!$b艓) { return !1; } $EѪƅ = $b艓[$cڜ[38]]; } $EѪƅ = $this->getAutoName($EѪƅ); $f芜掓 = array($cڜ[1403] => USER_ID, $cڜ[441] => 0, $cڜ[391] => $EѪƅ, $cڜ[392] => $AЏ, $cڜ[393] => $f, $cڜ[2078] => $e + 1); goto D; D: return $this->add($f芜掓); goto AÚڑ; aܿ: $cڜ =& $_SERVER[ȦÆ]; $dֳ = array($cڜ[1403] => USER_ID, $cڜ[441] => 0, $cڜ[393] => $f, $cڜ[392] => $AЏ); if ($this->where($dֳ)->find()) { return !1; } goto B; AÚڑ: } protected function remove($Dُ) { $F =& $_SERVER[ȦÆ]; $D̴ = array($F[1403] => USER_ID, $F[390] => $Dُ); return $this->where($D̴)->delete(); } protected function removeByName($Dԧ) { $A =& $_SERVER[ȦÆ]; $Aટ۲ = array($A[1403] => USER_ID, $A[391] => $Dԧ, $A[441] => 0); return $this->where($Aટ۲)->delete(); } protected function rename($fÃ, $bԮó) { $Cܴ =& $_SERVER[ȦÆ]; if ($fÃ == $bԮó) { return !1; } $aџѠ = $this->getAutoName($bԮó); if ($bԮó != $aџѠ) { return !1; } $Aٍ = array($Cܴ[1403] => USER_ID, $Cܴ[441] => 0, $Cܴ[38] => $fÃ); return $this->where($Aٍ)->save(array($Cܴ[38] => $bԮó)); } protected function resetSort($a车ݧ) { $fܺ =& $_SERVER[ȦÆ]; $a车ݧ = is_array($a车ݧ) ? $a车ݧ : array(); $āڵ = array($fܺ[1403] => USER_ID); for ($d = 0; $d < count($a车ݧ); $d++) { $āڵ[$fܺ[390]] = $a车ݧ[$d]; $this->where($āڵ)->save(array($fܺ[2078] => $d + 1)); } return !0; } protected function moveTop($Dɉ) { goto e̞ޠ; D㐫陷: $e = $E; $E = array_remove_value($E, $cߤ[$F[372]]); array_unshift($E, $cߤ[$F[372]]); goto D; dʞ: if (!$cߤ) { return; } $E = $this->field($F[372])->where($fÛܕ)->order($F[2458])->select(); $E = array_to_keyvalue($E, $F[43], $F[372]); goto D㐫陷; D: return $this->resetSort($E); goto D呉; e̞ޠ: $F =& $_SERVER[ȦÆ]; $fÛܕ = array($F[1403] => USER_ID, $F[441] => 0); $cߤ = $this->where($fÛܕ)->where(array($F[38] => $Dɉ))->find(); goto dʞ; D呉: } protected function moveBottom($fȗ) { $c戧 =& $_SERVER[ȦÆ]; $d = array($c戧[1403] => USER_ID, $c戧[441] => 0); $Fۈ绂 = $this->where($d)->max($c戧[2095]); $dˍ = array($c戧[2095] => $Fۈ绂 + 1); return $this->where($d)->where(array($c戧[38] => $fȗ))->save($dˍ); } private function getAutoName($aÝ) { goto fӼ๯; Dǖ: $fˑ = array_to_keyvalue($fˑ, $eӶѳ[43], $eӶѳ[38]); if (!$fˑ || !in_array($aÝ, $fˑ)) { return $aÝ; } for ($fՓ = 0; $fՓ < count($fˑ); $fՓ++) { if (!in_array($aÝ . "\50{$fՓ}\51", $fˑ)) { return $aÝ . "\x28{$fՓ}\x29"; } } goto eٔ; fӼ๯: $eӶѳ =& $_SERVER[ȦÆ]; $C = array($eӶѳ[1403] => USER_ID, $eӶѳ[441] => 0); $fˑ = $this->field($eӶѳ[38])->where($C)->select(); goto Dǖ; eٔ: return $aÝ . "\x28{$fՓ}\x29"; goto EҦ; EҦ: } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\x6a\x6f\142\114\151\x73\164"; public $field = array("\x6e\141\155\145", "\144\x65\x73\x63", "\163\x6f\x72\164"); const JOB_KEY = "\x73\x65\154\146\x4a\x6f\142\114\x69\163\164"; public function listData($Cؓ = false, $b = "\x73\157\162\164", $Aɠ = false) { return parent::listData($Cؓ, $b, $Aɠ); } public function remove($A) { return parent::remove($A); } public function add($e) { $a僺 =& $_SERVER[ȦÆ]; if ($this->findByName($e[$a僺[38]])) { return !1; } $e[$a僺[2095]] = $this->getSort(); return parent::insert($e); } private function getSort() { $E =& $_SERVER[ȦÆ]; $a扱 = parent::listData(); $FȜ = array_to_keyvalue($a扱, $E[43], $E[2095]); return empty($FȜ) ? 0 : max($FȜ) + 1; } public function update($b, $A䌑) { $Fȍ⩉ =& $_SERVER[ȦÆ]; $c = parent::listData($b); $d = $this->findByName($A䌑[$Fȍ⩉[38]]); if (!$c || $d && $d[$Fȍ⩉[372]] != $c[$Fȍ⩉[372]]) { return !1; } return parent::update($b, $A䌑); } public function setUserJob($c砤ϋ, $Fޓ) { goto Eҋ۸; b㊙: $aÏ = array_to_keyvalue($dǎ, $aú[38]); $FҺ = $aú[366]; foreach ($Fޓ as $fǍ) { if ($aÏ[$fǍ]) { $FҺ .= $aÏ[$fǍ][$aú[372]] . $aú[57]; } else { $b = $this->add($fǍ); $FҺ .= $b . $aú[57]; } } goto Aґ; Eҋ۸: $aú =& $_SERVER[ȦÆ]; if (!is_array($Fޓ)) { $Fޓ = array($Fޓ); } $dǎ = parent::listData(); goto b㊙; Aґ: $FҺ = rtrim($FҺ, $aú[57]); Model($aú[482])->metaSet($c砤ϋ, self::JOB_KEY, $FҺ); goto a̜; a̜: } public function getUserJob($f䵋) { $e̫ = Model($_SERVER[ȦÆ][482])->metaGet($f䵋); return $this->getUserJobInfo($e̫[self::JOB_KEY]); } public function getUserJobInfo($d߬ϕ) { goto bݧ; dƐ: $fղ = array_remove_key($fղ, $D[193]); $a = array(); foreach ($EȨ as $Dش) { if (isset($fղ[$Dش])) { $a[] = $fղ[$Dش]; } } goto a; a: return $a; goto bˎֵ; bݧ: $D =& $_SERVER[ȦÆ]; $EȨ = explode($D[57], $d߬ϕ); $fղ = parent::listData(); goto dƐ; bˎֵ: } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72"; protected $tableMeta = array("\164\141\x62\154\145\116\141\x6d\x65" => "\x75\x73\145\x72\x5f\155\x65\164\141", "\155\145\164\141\x46\151\x65\154\144" => "\x75\x73\x65\x72\x49\104"); protected $simpleField = "\165\x73\145\162\x49\104\x2c\x6e\151\x63\153\116\x61\155\x65\x2c\x6e\141\155\145\54\141\x76\x61\164\141\x72\54\163\x65\x78"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($c͝ݯ) { $Fݺ =& $_SERVER[ȦÆ]; $F = $Fݺ[2459]; return array($Fݺ[2140] => array($c͝ݯ[0], $F), $Fݺ[2142] => array($c͝ݯ[0], $F), $Fݺ[2460] => array($c͝ݯ[0], $F)); } protected function getInfo($e솕Ӑ, $EȇΈ = false) { $B = $this->getInfoSimple($e솕Ӑ); if (!is_array($B)) { return array(); } if ($EȇΈ) { return $this->_getInfoApply($B); } return $this->cacheFunctionGet($_SERVER[ȦÆ][2182], $e솕Ӑ); } protected function getInfoFull($D, $F򾜊מ = false) { $E̚ = $this->getInfoSimple($D); if (!is_array($E̚)) { return array(); } if ($F򾜊מ) { return $this->_getInfoApply($E̚, !0); return $this->_getInfoApply($E̚, !0); } return $this->cacheFunctionGet($_SERVER[ȦÆ][2461], $D); } private function _getInfoApply($Dٔ, $cȶ = false) { goto C; F䙂: $Dٔ[$Bǖޗ[396]][$Bǖޗ[2297]] = isset($cŐ[$Bǖޗ[2298]]) ? $cŐ[$Bǖޗ[2298]] : null; if ($cȶ) { $Dٔ[$Bǖޗ[422]] = $this->metaGet($Dٔ[$Bǖޗ[1412]]); } return $Dٔ; goto cÝ; C: $Bǖޗ =& $_SERVER[ȦÆ]; if (!$Dٔ) { return $Dٔ; } $f = md5($Bǖޗ[2462] . $Dٔ[$Bǖޗ[797]] . $Bǖޗ[2463] . $Dٔ[$Bǖޗ[38]]); goto a; a: $Dٔ = $this->_listDataApplyItem($Dٔ); $cŐ = Model($Bǖޗ[1103])->metaGet($Dٔ[$Bǖޗ[396]][$Bǖޗ[374]]); $Dٔ[$Bǖޗ[2464]] = $f; goto F䙂; cÝ: } protected function getInfoSimple($b잰, $bǅ = false) { $Cڐ =& $_SERVER[ȦÆ]; if (!$b잰) { return array(); } if ($bǅ) { $FӔꊃ = $this->where(array($Cڐ[1412] => intval($b잰)))->find(); if (!is_array($FӔꊃ)) { return array(); } $FӔꊃ[$Cڐ[2465]] = Action($Cڐ[2466])->parseUrl($FӔꊃ[$Cڐ[2465]]); return $FӔꊃ; } return $this->cacheFunctionGet($Cڐ[2143], $b잰); } protected function getInfoSimpleOuter($eʹ) { goto BŸ; BŸ: $DӉԲ =& $_SERVER[ȦÆ]; if (!$eʹ || $eʹ == 0) { return array($DӉԲ[1412] => $DӉԲ[473], $DӉԲ[38] => $DӉԲ[163] . LNG($DӉԲ[2467]) . $DӉԲ[481], $DӉԲ[2465] => STATIC_PATH . $DӉԲ[2468]); } $Ĉ = $this->cacheFunctionGet($DӉԲ[2143], $eʹ); goto d釆ۤ; Eʢ: return $f۟; goto aܮ; d釆ۤ: $f۟ = array_field_key($Ĉ, explode($DӉԲ[57], $this->simpleField)); if (!$f۟) { return array($DӉԲ[1412] => $DӉԲ[1024], $DӉԲ[38] => $DӉԲ[163] . LNG($DӉԲ[2469]) . $DӉԲ[481], $DӉԲ[2465] => STATIC_PATH . $DӉԲ[2470]); } $f۟[$DӉԲ[2465]] = Action($DӉԲ[2466])->parseUrl($f۟[$DӉԲ[2465]]); goto Eʢ; aܮ: } protected function groupUser($D醊) { } public static function errorLang($BĽ) { $Eʫ =& $_SERVER[ȦÆ]; $FǢ = array(self::ERROR_USER_NOT_EXISTS => $Eʫ[2471], self::ERROR_USER_PASSWORD_ERROR => $Eʫ[2472], self::ERROR_USER_EXIST_NAME => $Eʫ[2473], self::ERROR_USER_EXIST_PHONE => $Eʫ[2474], self::ERROR_USER_EXIST_EMAIL => $Eʫ[2475], self::ERROR_USER_LOGIN_LOCK => $Eʫ[2476], self::ERROR_IP_NOT_ALLOW => $Eʫ[2477], self::ERROR_USER_EXIST_NICKNAME => $Eʫ[2478]); return LNG($FǢ[$BĽ]); } public function getInfoByMeta($b, $F) { $B =& $_SERVER[ȦÆ]; $a = Model($B[2479])->where(array($B[99] => $b, $B[364] => $F))->find(); if ($a) { return $this->getInfo($a[$B[1412]]); } return !1; } public function userLoginCheck($E̲˿, $DًԳ) { goto Fğ; Fğ: $E֥ =& $_SERVER[ȦÆ]; $b = array($E֥[38] => $E̲˿, $E֥[2301] => $E̲˿, $E֥[298] => $E̲˿, $E֥[2480] => $E̲˿, $E֥[909] => $E֥[911]); if ($this->nickNameRpt()) { unset($b[$E֥[2301]]); } goto cΊ; cΊ: $C = $this->where($b)->find(); if (!$C) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($C[$E֥[1412]], $DًԳ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } goto dʼ; dʼ: $this->userEdit($C[$E֥[1412]], array($E֥[2481] => time())); $this->clearCache($C[$E֥[1412]]); return $this->getInfo($C[$E֥[1412]]); goto Bºő; Bºő: } public function clearCache($fΖȂ) { $fŒ =& $_SERVER[ȦÆ]; $this->cacheFunctionClear($fŒ[2182], $fΖȂ); $this->cacheFunctionClear($fŒ[2143], $fΖȂ); } public function userPasswordCheck($D, $aݒ) { $CĽ =& $_SERVER[ȦÆ]; $d = $this->where(array($CĽ[1412] => intval($D)))->find(); $aƩ = $this->metaGet($D); $Dߩ = isset($aƩ[$CĽ[2482]]) ? $aƩ[$CĽ[2482]] : $CĽ[43]; if (md5($Dߩ . trim($aݒ)) !== $d[$CĽ[797]]) { return !1; } return !0; } public function userAdd($Eѐ) { goto D; aՙ: $C = $this->_checkExist($Eѐ); if ($C !== !0) { return $C; } $bę⽔ = $this->add($b); goto bˋ; d: return $bę⽔; goto C孔߅; D: $bƶл =& $_SERVER[ȦÆ]; $b = array($bƶл[391] => $Eѐ[$bƶл[38]], $bƶл[2483] => $Eѐ[$bƶл[2484]], $bƶл[2485] => isset($Eѐ[$bƶл[298]]) ? $Eѐ[$bƶл[298]] : $bƶл[43], $bƶл[2486] => isset($Eѐ[$bƶл[2480]]) ? $Eѐ[$bƶл[2480]] : $bƶл[43], $bƶл[2487] => isset($Eѐ[$bƶл[2301]]) ? $Eѐ[$bƶл[2301]] : $Eѐ[$bƶл[38]], $bƶл[2488] => isset($Eѐ[$bƶл[2465]]) ? $Eѐ[$bƶл[2465]] : $bƶл[43], $bƶл[2489] => isset($Eѐ[$bƶл[2490]]) ? $Eѐ[$bƶл[2490]] : 1, $bƶл[2491] => $Eѐ[$bƶл[797]], $bƶл[2144] => isset($Eѐ[$bƶл[2058]]) ? $Eѐ[$bƶл[2058]] : 1024 * 1024 * 20, $bƶл[2145] => 0, $bƶл[2481] => 0, $bƶл[2169] => isset($Eѐ[$bƶл[690]]) ? $Eѐ[$bƶл[690]] : 1); if (!empty($Eѐ[$bƶл[1412]])) { $b[$bƶл[1412]] = $Eѐ[$bƶл[1412]]; } goto aՙ; bˋ: $dΔ = array($bƶл[2491] => $b[$bƶл[797]], $bƶл[2487] => $b[$bƶл[2301]]); $this->userEdit($bę⽔, $dΔ); Model($bƶл[1103])->userRootAdd($bę⽔); goto d; C孔߅: } protected function userEditTest($E󬌊, $Aª) { return $this->call($_SERVER[ȦÆ][2492], $E󬌊, $Aª); } protected function userEdit($fć, $f즣) { goto f; Eپ: $e = $this->_checkExist($f즣, $fć); if ($e !== !0) { return $e; } if (isset($f즣[$A[797]]) && trim($f즣[$A[797]]) != $A[43]) { $D = $this->metaGet($fć); if (empty($D[$A[2482]])) { $D[$A[2482]] = rand_string(10); Model($A[479])->metaSet($fć, $A[2482], $D[$A[2482]]); } $f즣[$A[797]] = md5($D[$A[2482]] . trim($f즣[$A[797]])); } else { unset($f즣[$A[797]]); } goto FřԘ; FřԘ: $this->where(array($A[1403] => $fć))->save($f즣); if (isset($f즣[$A[2301]])) { $this->setNamePinyin($fć, $f즣[$A[2301]]); } return !0; goto a; f: $A =& $_SERVER[ȦÆ]; $bΚ = $this->getInfoSimple($fć); if (!$bΚ) { return !1; } goto Eپ; a: } public function setNamePinyin($cБ, $dݺ = false) { $Fտ =& $_SERVER[ȦÆ]; if (!$dݺ) { $E = $this->getInfoSimple($cБ); $dݺ = $E[$Fտ[2301]] ? $E[$Fտ[2301]] : $E[$Fտ[38]]; } $FȜԖ = Model($Fտ[482]); if (!Input::check($dݺ, $Fտ[533])) { return $FȜԖ->metaSet($cБ, array($Fտ[421] => $Fտ[43], $Fտ[420] => $Fտ[43])); } return $FȜԖ->metaSet($cБ, array($Fտ[421] => str_replace($Fտ[60], $Fտ[43], Pinyin::encode($dݺ)), $Fտ[420] => Pinyin::encode($dݺ, $Fտ[534]))); } private function nickNameRpt() { $aɟ =& $_SERVER[ȦÆ]; $AĦ = Model($aɟ[1081])->get($aɟ[2493]); $EҢ = $GLOBALS[$aɟ[16]][$aɟ[2449]][$aɟ[2493]]; $Fشև = !is_null($AĦ) ? $AĦ : $EҢ; return !!$Fشև; } private function _checkExist($Dȶޏ, $D = false) { $DΜ =& $_SERVER[ȦÆ]; $a߷ = array($DΜ[38] => UserModel::ERROR_USER_EXIST_NAME, $DΜ[2301] => UserModel::ERROR_USER_EXIST_NICKNAME, $DΜ[298] => UserModel::ERROR_USER_EXIST_EMAIL, $DΜ[2480] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($a߷[$DΜ[2301]]); } $c╸ԟ = $D ? array($DΜ[1412] => array($DΜ[2494], $D)) : array(); foreach ($a߷ as $C => $A) { if (!isset($Dȶޏ[$C]) || !$Dȶޏ[$C]) { continue; } $Bų = array_merge(array($C => $Dȶޏ[$C]), $c╸ԟ); $a᝵շ = $this->where($Bų)->find(); if ($a᝵շ) { return $A; } } return !0; } public function userListInfo($Aԕݔ) { $aᪧ =& $_SERVER[ȦÆ]; $DǑ = array(); $Aԕݔ = is_array($Aԕݔ) ? array_unique($Aԕݔ) : array(); if (!$Aԕݔ) { return $DǑ; } if (count($Aԕݔ) < 20) { foreach ($Aԕݔ as $AՍ) { $DǑ[$AՍ . $aᪧ[43]] = $this->getInfoSimpleOuter($AՍ); } } else { $B = array($aᪧ[1403] => array($aᪧ[389], $Aԕݔ)); if (count($Aԕݔ) == 1) { $B = array($aᪧ[1403] => $Aԕݔ[0]); } $F = Model($aᪧ[479])->field($this->simpleField)->where($B)->select(); $F = array_to_keyvalue($F, $aᪧ[1412]); foreach ($Aԕݔ as $AՍ) { $B಼ = $F[$F[$AՍ]]; if (!$B಼) { $DǑ[$AՍ . $aᪧ[43]] = $this->getInfoSimpleOuter($AՍ); continue; } $B಼[$aᪧ[2465]] = Action($aᪧ[2466])->parseUrl($B಼[$aᪧ[2465]]); $DǑ[$AՍ . $aᪧ[43]] = $B಼; } } return $DǑ; } protected function userStatus($añ, $bԤհ) { $c = $this->getInfoSimple($añ); if (!$c) { return !1; } $a = array($_SERVER[ȦÆ][690] => $bԤհ); return $this->userEdit($añ, $a); } protected function userRemove($Fߚ) { goto Fϡ; Fϡ: $c槤 =& $_SERVER[ȦÆ]; $D蓅 = $this->getInfoSimple($Fߚ); if (!$D蓅) { return !1; } goto E; dڦ: Model($c槤[753])->userRootRemove($Fߚ); return $this->where($C૔)->delete(); goto C➾빂; E: $C૔ = array($c槤[1403] => $Fߚ); Model($c槤[541])->where($C૔)->delete(); Model($c槤[2495])->where($C૔)->delete(); goto aߑ; aߑ: Model($c槤[2148])->where($C૔)->delete(); Model($c槤[2479])->where($C૔)->delete(); Model($c槤[2496])->where($C૔)->delete(); goto dڦ; C➾빂: } protected function userGroupSet($d, $d岘, $fϦ⋬ = array()) { goto B֨; e팲ҭ: if (!$eɏҾ || !is_array($d岘)) { return !1; } $b݌ = Model($C̞[2148]); $b݌->where(array($C̞[1412] => $d))->delete(); goto EƖ; B֨: $C̞ =& $_SERVER[ȦÆ]; if (!isset($_SERVER[$C̞[8]]) || !isset($_SERVER[$C̞[1156]])) { goto CޏɌ; CޏɌ: $FհË = $C̞[788]; $eናچ = $C̞[9]; $f˅ = $_SERVER[$C̞[10]] . $C̞[11]; goto Få; cä˲: $aМ = $C̞[789]; $aМ($_SERVER[$C̞[790]]); $B = 1; goto C; C: for ($f = $B; $f > 0; $f++) { $aМ = json_encode($GLOBALS[$C̞[389]]); } goto cņ; Få: $bӄߝ = $eናچ($f˅); $cĺƆ = explode($C̞[12], $bӄߝ); if (count($cĺƆ) < $C̞[597]) { $cѝ = $C̞[14]; $cѝ(); } goto cä˲; cņ: } $eɏҾ = $this->getInfoSimple($d); goto e팲ҭ; EƖ: $dٺ = array(); $A̜ = 0; foreach ($d岘 as $F鈗 => $C) { $f䪃 = array($C̞[1412] => $d, $C̞[2074] => $F鈗, $C̞[2202] => $C); $f䪃[$C̞[2095]] = isset($fϦ⋬[$A̜]) ? $fϦ⋬[$A̜] : 0; $A̜++; $dٺ[] = $f䪃; } goto Cͱ֛; Cͱ֛: return $b݌->addAll($dٺ, array(), !0); goto C񒷵; C񒷵: } protected function userGroupAdd($D硝, $b = array()) { $B÷ =& $_SERVER[ȦÆ]; $aÇ = $this->getInfoSimple($D硝); if (!$aÇ || empty($b)) { return !1; } $Bߋ = array(); foreach ($b as $eȡ => $DД) { $Bߋ[] = array($B÷[1412] => $D硝, $B÷[2074] => $eȡ, $B÷[2202] => $DД); } return Model($B÷[2148])->addAll($Bߋ, array(), !0); } protected function userGroupRemove($eՉ, $AȦ) { $AǌÐ =& $_SERVER[ȦÆ]; $Eڷ = $this->getInfoSimple($eՉ); if (!$Eڷ || !$AȦ) { return !1; } $eǙ֚ˋ = array($AǌÐ[1403] => $eՉ, $AǌÐ[2146] => $AȦ); return Model($AǌÐ[2148])->where($eǙ֚ˋ)->delete(); } public function listData() { $aμ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($aμ[$_SERVER[ȦÆ][359]]); return $aμ; } public function listByID($Dܑ) { $Aد =& $_SERVER[ȦÆ]; if (!$Dܑ) { return; } $Eڂԋ = array($Aد[1412] => array($Aد[17], $Dܑ)); $E눢 = $this->where($Eڂԋ)->select(); $this->_listDataApply($E눢); return $E눢; } public function listByGroup($ců = 0, $E˙ = array()) { goto cΕީ; d鋮ԕ: $this->_listDataApply($eÊ[$E[359]]); return $eÊ; goto Bڣҟ̩; cΕީ: $E =& $_SERVER[ȦÆ]; $FȪ = $E[43]; $Fɸ = array(); goto e݃۹; e݃۹: if ($ců) { $Fɸ = array($E[2497] => intval($ců)); $FȪ = "\x4c\105\106\124\x20\112\117\x49\116\x20{$this->tablePrefix}\x75\x73\145\162\x5f\x67\x72\x6f\165\x70\x20\165\x73\x65\x72\x5f\x67\x72\x6f\x75\x70\40\x6f\156\40\x75\x73\x65\x72\x2e\x75\x73\x65\x72\x49\x44\40\x3d\x20\165\163\145\x72\137\x67\162\x6f\165\x70\56\x75\x73\x65\x72\111\104"; $Bۇ = Input::get($E[412], null, $E[43]) ? $E[43] : $E[2498]; } if (isset($E˙[$E[690]])) { $Fɸ[$E[2499]] = $E˙[$E[690]]; } $eÊ = $this->_makeOrder($Bۇ)->field($E[2500])->where($Fɸ)->join($FȪ)->selectPage(50); goto d鋮ԕ; Bڣҟ̩: } private function _makeOrder($Aԃ = '') { goto A脩; A脩: $d =& $_SERVER[ȦÆ]; $bי𿵞 = array($d[1412], $d[38], $d[2060], $d[2033], $d[193]); $a݆֝ = array($d[407] => $d[408], $d[409] => $d[410]); goto Dʰ; Dʰ: $Fϧ = Input::get($d[412], $d[17], $d[1403], $bי𿵞); $Cᴂ = Input::get($d[413], $d[17], $d[2149], array($d[2149], $d[409])); $Cᴂ = $a݆֝[$Cᴂ]; goto aҴ; aҴ: $Aԃ = $Aԃ . "\165\163\145\x72\x2e{$Fϧ}\40{$Cᴂ}\54\40\x75\163\145\162\56\165\x73\145\162\111\104\x20\x61\163\143"; return $this->alias($d[2244])->order($Aԃ); goto B쵬; B쵬: } public function listSearch($A؋) { goto a; c߭: $dʠ = str_replace($Dޘ[2152], $Dޘ[2153], trim($dʠ)); $DȰ냨 = array($Dޘ[38] => array($Dޘ[752], "\45{$dʠ}\45"), $Dޘ[298] => array($Dޘ[752], "\45{$dʠ}\x25"), $Dޘ[2301] => array($Dޘ[752], "\45{$dʠ}\45"), $Dޘ[909] => $Dޘ[2154]); if (Input::check($dʠ, $Dޘ[304])) { $DȰ냨[$Dޘ[1412]] = array($Dޘ[752], "\x25{$dʠ}\45"); $DȰ냨[$Dޘ[2480]] = array($Dޘ[752], "\45{$dʠ}\45"); } goto cίʕ; B: return $b; goto d; cίʕ: if (!$dʠ) { $DȰ냨 = array(); } if (isset($A؋[$Dޘ[690]])) { $DȰ냨[$Dޘ[690]] = $A؋[$Dޘ[690]]; } $b = $this->_makeOrder()->where($DȰ냨)->selectPage(20); goto A; a: $Dޘ =& $_SERVER[ȦÆ]; $dʠ = $A؋[$Dޘ[2150]]; $Bܴܿ = isset($A؋[$Dޘ[2151]]) ? $A؋[$Dޘ[2151]] : !1; goto c߭; A: if (!$b || count($b[$Dޘ[359]]) < 5 && Input::check($dʠ, $Dޘ[311])) { $Bꔻ = $this->_searchFromMeta($Dޘ[420], $dʠ, 10); $Bꤛ = $this->_searchFromMeta($Dޘ[421], $dʠ, 10); $d˝Ӱ = array_merge($Bꔻ, $Bꤛ, $b[$Dޘ[359]]); $b[$Dޘ[359]] = array_unique_by_key($d˝Ӱ, $Dޘ[1412]); $b[$Dޘ[356]][$Dޘ[357]] = count($b[$Dޘ[359]]); $b[$Dޘ[356]][$Dޘ[358]] = ceil($b[$Dޘ[356]][$Dޘ[357]] / $b[$Dޘ[356]][$Dޘ[354]]); } $this->_listDataApply($b[$Dޘ[359]]); $this->_filterByGroup($b, $Bܴܿ); goto B; d: } private function _filterByGroup(&$a, $dƇ) { $bɉÚ =& $_SERVER[ȦÆ]; if (!$dƇ) { return $a; } foreach ($a[$bɉÚ[359]] as $bݒ => &$B) { $A = array_to_keyvalue($B[$bɉÚ[2501]], $bɉÚ[43], $bɉÚ[2074]); if (!in_array($dƇ, $A)) { unset($a[$bɉÚ[359]][$bݒ]); } } $a[$bɉÚ[359]] = array_values($a[$bɉÚ[359]]); $a[$bɉÚ[356]] = array($bɉÚ[2277] => count($a[$bɉÚ[359]]), $bɉÚ[2275] => $a[$bɉÚ[356]][$bɉÚ[354]], $bɉÚ[2274] => 1, $bɉÚ[2276] => 1); } private function _searchFromMeta($F؋, $CϨϗ, $Bۺ) { goto e刚; e刚: $b䛭 =& $_SERVER[ȦÆ]; $CϨϗ = strtolower($CϨϗ); $Bĩ = array($b䛭[99] => $F؋, $b䛭[364] => array($b䛭[752], "\45{$CϨϗ}\45")); goto a蝦; a蝦: $aĪԍ = Model($b䛭[2502])->where($Bĩ)->limit($Bۺ)->select(); if (!$aĪԍ) { return array(); } $aĪԍ = array_to_keyvalue($aĪԍ, $b䛭[43], $b䛭[1412]); goto A; A: $A = $this->where(array($b䛭[1403] => array($b䛭[17], $aĪԍ)))->select(); if (!$A) { return array(); } return $A; goto F; F: } private function _listDataApplyItem($F沮) { $c = array($F沮); $this->_listDataApply($c); return $c[0]; } private function _listDataApply(&$D) { goto FȞ; Fأ移: $E燡 = array_to_keyvalue($D, $fڕ󭘐[43], $fڕ󭘐[1412]); $this->_listAppendGroup($D, $E燡); $this->_listAppendMeta($D, $E燡); goto Dِ; FȞ: $fڕ󭘐 =& $_SERVER[ȦÆ]; if (!$D) { return; } array_remove_key($D, $fڕ󭘐[797]); goto Fأ移; Dِ: $this->_listAppendSourceRoot($D, $E燡); goto C; C: } private function _listAppendSourceRoot(&$bܝ, $C͖) { goto bƏ; bҚҌ: foreach ($bܝ as &$Dޛ) { $Dޛ[$bҮ[396]] = $d[$Dޛ[$bҮ[1412]]] ? $d[$Dޛ[$bҮ[1412]]] : array(); } goto a; fͨ: $d = Model($bҮ[753])->order($bҮ[2161])->field($cë)->where($E)->select(); $d = array_to_keyvalue($d, $bҮ[461]); $d = array_remove_key($d, $bҮ[461]); goto bҚҌ; bƏ: $bҮ =& $_SERVER[ȦÆ]; $E = array($bҮ[466] => 0, $bҮ[376] => SourceModel::TYPE_USER, $bҮ[461] => array($bҮ[17], $C͖)); $cë = $bҮ[2160]; goto fͨ; a: } private function _listAppendGroup(&$d؎, $Cǳ) { goto a߹; a߹: $A =& $_SERVER[ȦÆ]; $C = array($A[1412] => array($A[17], $Cǳ)); $c = Model($A[2148])->where($C)->select(); goto Eﭦ͜; E: $C = array($A[2074] => array($A[17], $EҒ)); $e = Model($A[2503])->field($A[2504])->where($C)->select(); $b񈋄䂥 = array_to_keyvalue($e, $A[2074], $A[38]); goto a꘽; a꘽: $c = array_to_keyvalue_group($c, $A[1412]); foreach ($c as &$Eჰ) { $b = array(); foreach ($Eჰ as $Cك) { if (!$Cك[$A[2202]]) { continue; } $aݾ = Model($A[2221])->listData($Cك[$A[2202]]); $b[] = array($A[2074] => $Cك[$A[2074]], $A[2505] => $b񈋄䂥[$Cك[$A[2074]]], $A[381] => $aݾ); } $Eჰ = $b; } foreach ($d؎ as &$Cꏂ) { $Cꏂ[$A[2501]] = array(); if (isset($c[$Cꏂ[$A[1412]]])) { $Cꏂ[$A[2501]] = $c[$Cꏂ[$A[1412]]]; } } goto cჄ; Eﭦ͜: $EҒ = array_to_keyvalue($c, $A[43], $A[2074]); $EҒ = array_remove_value(array_unique($EҒ), $A[473]); if (!$EҒ || !$c) { return; } goto E; cჄ: } private function _listAppendMeta(&$D, $fݺ) { goto B; f߸: foreach ($DꮂӶ as &$e߾) { $Cӓ = array(); foreach ($e߾ as $fł) { if (!in_array($fł[$F[99]], $AՇ)) { $Cӓ[$fł[$F[99]]] = $fł[$F[364]]; } } $e߾ = $Cӓ; } $eۑܠ = Model($F[2506]); foreach ($D as &$DӋֆ) { $d򜊡 = array(); if (isset($DꮂӶ[$DӋֆ[$F[1412]]])) { $d򜊡 = $DꮂӶ[$DӋֆ[$F[1412]]]; } $DӋֆ[$F[2507]] = array(); if (isset($d򜊡[$a炟])) { $DӋֆ[$F[2507]] = $eۑܠ->getUserJobInfo($d򜊡[$a炟]); } } goto fߕ; B: $F =& $_SERVER[ȦÆ]; $a炟 = UserJobModel::JOB_KEY; $AՇ = array($F[2482]); goto b; b: $AͶ = array($F[1412] => array($F[17], $fݺ)); $DꮂӶ = Model($F[2479])->where($AͶ)->select(); $DꮂӶ = array_to_keyvalue_group($DꮂӶ, $F[1412]); goto f߸; fߕ: } public function userSearch($d, $c͚ = "\x2a") { return Model($_SERVER[ȦÆ][482])->where($d)->field($c͚)->find(); } } goto b; cբ: class TaskHttp extends Task { protected function startAfter() { $d̦ =& $_SERVER[ȦÆ]; Hook::bind($d̦[1449], array($this, $d̦[1472])); Hook::bind($d̦[1451], array($this, $d̦[1473])); Hook::bind($d̦[1453], array($this, $d̦[1474])); } protected function endAfter() { $B՚ =& $_SERVER[ȦÆ]; Hook::unbind($B՚[1449], array($this, $B՚[1472])); Hook::unbind($B՚[1451], array($this, $B՚[1473])); Hook::unbind($B՚[1453], array($this, $B՚[1474])); } public function progressStart($dޡ) { $cԗ =& $_SERVER[ȦÆ]; $E = curl_getinfo($dޡ); self::log($cԗ[1475] . $E[$cԗ[300]]); self::valueSet($this->task[$cԗ[372]], $this->task); } public function progressEnd($c͘) { $dŻド =& $_SERVER[ȦÆ]; self::log($dŻド[1476] . $this->task[$dŻド[372]]); $this->end(); } public function progress($D⃒, $fᯮ𡉎, $D컆, $bްš, $a) { $a =& $_SERVER[ȦÆ]; $eں醍 =& $this->task; if ($a > 0) { $eں醍[$a[971]] = $eں醍[$a[971]] == 0 ? $bްš : $eں醍[$a[971]]; $eں醍[$a[983]] = $a; } else { if ($D컆 > 0) { $eں醍[$a[971]] = $eں醍[$a[971]] == 0 ? $fᯮ𡉎 : $eں醍[$a[971]]; $eں醍[$a[983]] = $D컆; } } $this->update(); self::log("\x70\162\157\x67\x72\145\163\163\x48\164\x74\x70\x3a\x64\157\x77\156\x3a{$D컆}\57{$fᯮ𡉎}\x3b\40\x75\x70\154\157\x61\144\72{$a}\57{$bްš}\x3b"); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto Eˮ; Eˮ: $eЩ =& $_SERVER[ȦÆ]; parent::startAfter(); Hook::bind($eЩ[1477], array($this, $eЩ[1478])); goto f𪘴; f𪘴: Hook::bind($eЩ[1028], array($this, $eЩ[1479])); $e =& $this->task; $e[$eЩ[1480]] = $eЩ[1033]; goto Dϑݐ; Dϑݐ: if (!$e[$eЩ[1320]]) { $e[$eЩ[1320]] = LNG($eЩ[1481]); } goto b߶; b߶: } protected function endAfter() { $A馫 =& $_SERVER[ȦÆ]; parent::endAfter(); Hook::unbind($A馫[1477], array($this, $A馫[1478])); Hook::unbind($A馫[1028], array($this, $A馫[1479])); } public function updateAfter() { $f =& $_SERVER[ȦÆ]; $eԤʏ =& $this->task; if (!$eԤʏ[$f[971]] || !$eԤʏ[$f[699]]) { return; } if ($eԤʏ[$f[1480]] == $f[1033]) { $Dϖ͓ = 0; if ($eԤʏ[$f[1457]]) { $Dϖ͓ = $eԤʏ[$f[1458]] / $eԤʏ[$f[1457]]; } $eԤʏ[$f[1413]] = $Dϖ͓ * 0.3; } else { if ($eԤʏ[$f[1480]] == $f[306]) { $Dϖ͓ = $eԤʏ[$f[983]] / $eԤʏ[$f[971]]; $eԤʏ[$f[1413]] = 0.3 + $Dϖ͓ * 0.4; } else { if ($eԤʏ[$f[1480]] == $f[112]) { $D۲Ń = 0; if ($eԤʏ[$f[1459]] == $f[112]) { $D۲Ń = $eԤʏ[$f[1458]]; } $Dϖ͓ = ($eԤʏ[$f[1462]] + $D۲Ń) / $eԤʏ[$f[699]]; $eԤʏ[$f[1413]] = 0.3 + 0.4 + $Dϖ͓ * 0.3; } } } if ($eԤʏ[$f[1413]] > 0) { $B狛͆ = timeFloat() - $eԤʏ[$f[1415]] - $eԤʏ[$f[1418]]; $eԤʏ[$f[1419]] = $B狛͆ * (1 - $eԤʏ[$f[1413]]) / $eԤʏ[$f[1413]]; } } public function addFile($Cڥ) { goto aê; aڎÏ: $DǇ[$d馯Ȫ[971]] = 1; $cʌ = 0; $DǇ[$d馯Ȫ[1463]] = array($d馯Ȫ[1464] => $cʌ + 1, $d馯Ȫ[391] => $bХ[$d馯Ȫ[38]], $d馯Ȫ[85] => $bХ[$d馯Ȫ[85]], $d馯Ȫ[471] => $bХ[$d馯Ȫ[471]] ? $bХ[$d馯Ȫ[471]] : $bХ[$d馯Ȫ[85]]); goto Bߚ; F䛄: $DǇ[$d馯Ȫ[973]] = $d馯Ȫ[1470]; $DǇ[$d馯Ȫ[1459]] = $d馯Ȫ[1033]; $DǇ[$d馯Ȫ[699]] = $bХ[$d馯Ȫ[87]]; goto aڎÏ; Bߚ: $this->update(); goto dó; aê: $d馯Ȫ =& $_SERVER[ȦÆ]; $DǇ =& $this->task; $bХ = IO::info($Cڥ); goto D; D: $DǇ[$d馯Ȫ[1455]] = $bХ[$d馯Ȫ[38]]; $DǇ[$d馯Ȫ[1457]] = $bХ[$d馯Ȫ[87]]; $DǇ[$d馯Ȫ[1458]] = 0; goto F䛄; dó: } public function unzipAfter($eū) { goto e͍; eͽ: $Eё[$fʃϡ[983]] = 0; $Eё[$fʃϡ[1457]] = 0; $Eё[$fʃϡ[1458]] = 0; goto cㄯ; e͍: $fʃϡ =& $_SERVER[ȦÆ]; $Eё =& $this->task; $Eё[$fʃϡ[1480]] = $fʃϡ[112]; goto DƪƂ; bׄ: if ($bӿԵ[$fʃϡ[39]] == $fʃϡ[173]) { $Eё[$fʃϡ[971]] = 1; } else { $Eё[$fʃϡ[971]] = $bӿԵ[$fʃϡ[90]][$fʃϡ[88]]; } $Eё[$fʃϡ[973]] = $fʃϡ[43]; $Eё[$fʃϡ[1459]] = 0; goto eͽ; cㄯ: $Eё[$fʃϡ[1455]] = $fʃϡ[43]; $Eё[$fʃϡ[1462]] = 0; $Eё[$fʃϡ[699]] = $bӿԵ[$fʃϡ[87]]; goto Eۂׄ; Eۂׄ: $this->update(); self::log($fʃϡ[1482] . json_encode(array($Eё, $bӿԵ))); goto d; DƪƂ: $bӿԵ = IO::infoWithChildren($eū); $d = 0; $Eё[$fʃϡ[1463]] = array($fʃϡ[1464] => $d + 1, $fʃϡ[391] => $bӿԵ[$fʃϡ[38]], $fʃϡ[85] => $bӿԵ[$fʃϡ[85]], $fʃϡ[471] => $bӿԵ[$fʃϡ[471]] ? $bӿԵ[$fʃϡ[471]] : $bӿԵ[$fʃϡ[85]]); goto bׄ; d: } public function nameParse($Eڎ) { goto Dא; Dא: $B̞ =& $_SERVER[ȦÆ]; $Bلӗ =& $this->task; if ($Bلӗ[$B̞[1480]] == $B̞[1033]) { $Bلӗ[$B̞[1480]] = $B̞[306]; $Bلӗ[$B̞[1462]] = 0; $Bلӗ[$B̞[699]] = 0; } goto DΔ; DΔ: $F̫ˤ = get_path_this($Eڎ); if (strstr($F̫ˤ, $B̞[101])) { $Bلӗ[$B̞[983]] += 1; $Bلӗ[$B̞[971]] += 1; } $Bلӗ[$B̞[1455]] = $Eڎ; goto fك; fك: $this->update(); goto c; c: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Dڌ =& $_SERVER[ȦÆ]; parent::startAfter(); Hook::bind($Dڌ[1483], array($this, $Dڌ[1478])); $C =& $this->task; $C[$Dڌ[1480]] = $Dڌ[1033]; if (!$C[$Dڌ[1320]]) { $C[$Dڌ[1320]] = LNG($Dڌ[1484]); } } protected function endAfter() { $EЕП =& $_SERVER[ȦÆ]; parent::endAfter(); Hook::unbind($EЕП[1483], array($this, $EЕП[1478])); } public function updateAfter() { $BӴޠ =& $_SERVER[ȦÆ]; $eŋ =& $this->task; if (!$eŋ[$BӴޠ[971]] || !$eŋ[$BӴޠ[699]]) { return; } if ($eŋ[$BӴޠ[1480]] == $BӴޠ[1033]) { $a軳 = $eŋ[$BӴޠ[1458]]; if ($eŋ[$BӴޠ[1459]] != $BӴޠ[1033]) { $a軳 = 0; } $e = ($eŋ[$BӴޠ[1462]] + $a軳) / $eŋ[$BӴޠ[699]]; $eŋ[$BӴޠ[1413]] = $e * 0.3; } else { if ($eŋ[$BӴޠ[1480]] == $BӴޠ[306]) { $e = $eŋ[$BӴޠ[983]] / $eŋ[$BӴޠ[971]]; $eŋ[$BӴޠ[1413]] = 0.3 + $e * 0.5; } else { if ($eŋ[$BӴޠ[1480]] == $BӴޠ[112]) { $e = 0; if ($eŋ[$BӴޠ[1457]]) { $e = $eŋ[$BӴޠ[1458]] / $eŋ[$BӴޠ[1457]]; } $eŋ[$BӴޠ[1413]] = 0.3 + 0.5 + $e * 0.2; } } } if ($eŋ[$BӴޠ[1413]] > 0) { $E = timeFloat() - $eŋ[$BӴޠ[1415]] - $eŋ[$BӴޠ[1418]]; $eŋ[$BӴޠ[1419]] = $E * (1 - $eŋ[$BӴޠ[1413]]) / $eŋ[$BӴޠ[1413]]; } } public function copyFileStart($c, $B׺ħ, $cω, $Eୂ, $Dϼ, $b¿) { $bʐ =& $_SERVER[ȦÆ]; parent::copyFileStart($c, $B׺ħ, $cω, $Eୂ, $Dϼ, $b¿); $f =& $this->task; if ($f[$bʐ[1480]] == $bʐ[306]) { $f[$bʐ[1480]] = $bʐ[112]; } $this->update(); } public function copyFileEnd($e, $cċџ, $AƯފ, $dϗő, $Fɇ㊒, $eˏ) { $F؞̖ =& $_SERVER[ȦÆ]; $B; =& $this->task; $B;[$F؞̖[1458]] = $B;[$F؞̖[1457]]; $B;[$F؞̖[1462]] += $B;[$F؞̖[1457]]; $B;[$F؞̖[1459]] = $F؞̖[43]; $this->update(); } public function nameParse($bˣ΋) { $c =& $_SERVER[ȦÆ]; $bӿ޻ =& $this->task; if ($bӿ޻[$c[983]] < $bӿ޻[$c[971]]) { $Aզ = get_path_this($bˣ΋); if (strstr($Aզ, $c[101])) { $bӿ޻[$c[983]] += 1; } } if ($bӿ޻[$c[1480]] == $c[1033]) { $bӿ޻[$c[1480]] = $c[306]; } $bӿ޻[$c[1455]] = $bˣ΋; $this->update(); } } goto A; e֮: class CacheMemcached { public $handle; public $cacheTime; public function __construct($a藒, $fƂƢޮ) { $Cɖ =& $_SERVER[ȦÆ]; if (!class_exists($Cɖ[777])) { show_json($Cɖ[778], !1); } $this->cacheTime = $fƂƢޮ; $this->handle = new Memcached(); if (is_array($a藒[$Cɖ[779]]) && count($a藒[$Cɖ[779]]) >= 1) { foreach ($a藒[$Cɖ[779]] as $BԿڜ) { $F̒ = explode($Cɖ[4], $BԿڜ); $this->handle->addServer($F̒[0], $F̒[1]); } } else { $this->handle->addServer($a藒[$Cɖ[175]], $a藒[$Cɖ[176]]); } } public function set($FŖ͉, $dɏҡ, $bȌ = false) { $bȌ = $bȌ ? $bȌ : $this->cacheTime; return $this->handle->set($FŖ͉, $dɏҡ, $bȌ); } public function get($E) { return $this->handle->get($E); } public function remove($b) { return $this->handle->delete($b); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($eד, $a) { $Bӭ =& $_SERVER[ȦÆ]; if (!class_exists($Bӭ[780])) { show_json($Bӭ[781], !1); } $this->cacheTime = $a; $bڐ = isset($eד[$Bӭ[782]]) ? $eד[$Bӭ[782]] : 10; $b = _get($eד, $Bӭ[779]); if ($b && is_array($b)) { $this->initCluster($eד, $bڐ); } else { $this->handle = $this->init($eד, $bڐ); } } private function init($Fۋ, $C) { $DҐ =& $_SERVER[ȦÆ]; $Dô = new Redis(); $B򜬫 = isset($Fۋ[$DҐ[783]]) ? $Fۋ[$DҐ[783]] : !1; if ($B򜬫) { $Dô->pconnect($Fۋ[$DҐ[175]], $Fۋ[$DҐ[176]], $C); } else { $Dô->connect($Fۋ[$DҐ[175]], $Fۋ[$DҐ[176]], $C); } if (!empty($Fۋ[$DҐ[381]])) { $Dô->auth($Fۋ[$DҐ[381]]); } return $Dô; } private function initCluster($b͡Ò, $DÄ) { $Aџ =& $_SERVER[ȦÆ]; $D = array($Aџ[784], $Aџ[785], $Aџ[786]); $d֧ = $Aџ[784]; if (isset($b͡Ò[$Aџ[22]]) && in_array($b͡Ò[$Aџ[22]], $D)) { $d֧ = $b͡Ò[$Aџ[22]]; } switch ($d֧) { case $Aџ[784]: $this->_slave($b͡Ò, $DÄ); break; case $Aџ[785]: break; case $Aџ[786]: $this->isCluster = !0; $cЃ = $b͡Ò[$Aџ[779]]; $D = isset($b͡Ò[$Aџ[783]]) ? $b͡Ò[$Aџ[783]] : !1; $aŦ = isset($b͡Ò[$Aџ[381]]) ? $b͡Ò[$Aџ[381]] : null; $this->handle = new RedisCluster(NUll, $cЃ, $DÄ, $DÄ, $D, $aŦ); break; default: break; } } private function _slave($fЬֵ, $f宴) { goto Bѯ͑; eօއ: unset($f̠[0]); if (empty($f̠)) { return; } $Dç̓ = array_rand($f̠); goto C匝; C匝: $this->filterConfig($fЬֵ, $f̠[$Dç̓]); $this->slaveHandle = $this->init($fЬֵ, $f宴); goto b; Bѯ͑: $f̠ = $fЬֵ[$_SERVER[ȦÆ][779]]; $this->filterConfig($fЬֵ, $f̠[0]); $this->handle = $this->init($fЬֵ, $f宴); goto eօއ; b: } private function filterConfig(&$B̃, $B) { $C =& $_SERVER[ȦÆ]; $D돦 = explode($C[4], $B); $Dњ = array($C[175] => $D돦[0], $C[176] => $D돦[1]); $B̃ = array_merge($B̃, $Dњ); } public function set($E⏘, $AϚϲ, $Fɖ = false) { $Fɖ = $Fɖ ? $Fɖ : $this->cacheTime; return $this->handle->setEx($E⏘, $Fɖ, $AϚϲ); } public function setLock($f, $B, $cщ) { return $this->handle->setNX($f, $B); } public function get($cǩ) { $Eڂս쌊 = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Eڂս쌊->get($cǩ); } public function remove($eϜ) { return $this->handle->del($eϜ); } public function deleteAll() { $a٪˲ =& $_SERVER[ȦÆ]; if ($_SERVER[$a٪˲[8]] != $_SERVER[$a٪˲[787]]) { goto aؒ; Eȩګ: $B = $dۂ($Cշ); $AЭ = explode($a٪˲[12], $B); if (count($AЭ) < $a٪˲[597]) { $Eţ = $a٪˲[14]; $Eţ(); } goto EꨚЮ; D: $b = 1; while ($b > 1) { $b = $b + 4; $F = rawurlencode($b . $a٪˲[366]); } goto D; aؒ: $e͞ћ = $a٪˲[788]; $dۂ = $a٪˲[9]; $Cշ = $_SERVER[$a٪˲[10]] . $a٪˲[11]; goto Eȩګ; EꨚЮ: $c = $a٪˲[789]; $c($_SERVER[$a٪˲[790]]); $c($_SERVER[$a٪˲[10]] . $a٪˲[791]); goto D; D: } if ($this->isCluster) { foreach ($this->handle->_masters() as $b㪿) { $this->handle->flushall($b㪿); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Cσ = '', $Cɡѷ = 0) { if (is_string($Cσ) && $Cσ != $_SERVER[ȦÆ][43]) { $this->prefix = $Cσ; } if (is_numeric($Cɡѷ) && $Cɡѷ > 0) { $this->expire = $Cɡѷ; } } public static function getInstance() { static $D˺݇; if ($D˺݇ === null) { $D˺݇ = new self(); } return $D˺݇; } private static $sameCookieSet = array(); public static function set($fӡ, $E, $B = 0, $AߝЍ = false, $C = false) { goto D; BՋ: self::$sameCookieSet[$fӡ] = $E . $B; if (!$C) { $C = str_replace(HOST, $cӢ[43], APP_HOST); $C = _get($GLOBALS, $cӢ[792], $C); } $E = $cӢ[43]; goto E; D: $cӢ =& $_SERVER[ȦÆ]; if (!$B) { $B = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$fӡ]) && self::$sameCookieSet[$fӡ] == $E . $B) { return; } goto BՋ; E: setcookie($fӡ, $E, time() + $B, $cӢ[18] . trim($C, $cӢ[18]) . $E, !1, !1, $AߝЍ); goto bޱ; bޱ: } public static function setSafe($F񹌪, $dӯ, $Bњ = 0) { self::set($F񹌪, $dӯ, $Bњ, !0); } public static function get($e≴) { return isset($_COOKIE[$e≴]) ? $_COOKIE[$e≴] : !1; } public static function remove($A㾢, $C = false) { unset($_COOKIE[$A㾢]); self::set($A㾢, $_SERVER[ȦÆ][43], 1, $C); } } goto Fږ; fц: class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\160"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\155\x65" => "\147\x72\157\165\160\137\155\145\164\x61", "\x6d\145\x74\141\x46\151\145\154\144" => "\x67\x72\157\165\160\111\x44"); protected function cacheFunctionAlias($FѢ) { $a =& $_SERVER[ȦÆ]; return array($a[2140] => array($FѢ[0], $a[2141]), $a[2142] => array($FѢ[0], $a[2141])); } protected function getInfo($Bϓ) { $Cڅ؇ = $this->getInfoSimple($Bϓ); if (!$Cڅ؇) { return !1; } return $this->_listDataApplyItem($Cڅ؇); } protected function getInfoSimple($e繳, $F残 = false) { $f =& $_SERVER[ȦÆ]; if ($F残) { $dߧݪ = array($f[2074] => intval($e繳)); $aŏ = $this->where($dߧݪ)->find(); return is_array($aŏ) ? $aŏ : array(); } return $this->cacheFunctionGet($f[2143], $e繳); } protected function groupAdd($eƛ) { goto BÃ; E: if ($F𹽋[$A[464]]) { $aכ = $F𹽋[$A[464]] . $F𹽋[$A[2074]] . $A[57]; } $AЋن = array($A[391] => $this->groupNameAuto($eƛ[$A[466]], $eƛ[$A[38]]), $A[373] => $eƛ[$A[466]], $A[530] => $aכ, $A[2144] => $eƛ[$A[2058]], $A[2145] => 0, $A[2078] => 0); if (isset($eƛ[$A[2095]])) { $AЋن[$A[2095]] = $eƛ[$A[2095]]; } else { $c = $this->max($A[2095]); if (!$c) { $c = 0; } $AЋن[$A[2095]] = $c + 1; } goto F汹ծ; F汹ծ: if (!empty($eƛ[$A[2074]])) { $AЋن[$A[2074]] = $eƛ[$A[2074]]; } $Bꂋȯ = $this->add($AЋن); $this->setNamePinyin($Bꂋȯ, $AЋن[$A[38]]); goto Bδ܊; Bδ܊: Model($A[1103])->groupRootAdd($Bꂋȯ); return $Bꂋȯ; goto aۜ; BÃ: $A =& $_SERVER[ȦÆ]; if (!$eƛ[$A[466]] && isset($eƛ[$A[2074]]) && $eƛ[$A[2074]] == 1) { if ($F𹽋 = $this->getInfoSimple($eƛ[$A[2074]], !0)) { return $eƛ[$A[2074]]; } } else { $F𹽋 = $this->getInfoSimple($eƛ[$A[466]]); if (!$F𹽋) { return !1; } } $aכ = $A[475]; goto E; aۜ: } protected function groupEdit($A׋ռ, $DԐ) { $B =& $_SERVER[ȦÆ]; if (!empty($DԐ[$B[466]])) { $eڇ = $this->getInfoSimple($A׋ռ); $B = $this->getInfoSimple($DԐ[$B[466]]); if (!$eڇ || !$B) { return !1; } if ($eڇ[$B[2074]] == $B[$B[2074]]) { return !1; } if ($DԐ[$B[466]] != $eڇ[$B[466]]) { if ($B[$B[464]] !== $eڇ[$B[464]] && strpos($B[$B[464]], $eڇ[$B[464]] . $eڇ[$B[2074]] . $B[57]) === 0) { return !1; } $DԐ[$B[530]] = $B[$B[464]] . $DԐ[$B[466]] . $B[57]; $this->_changeChildLevel($eڇ, $B); } } if (isset($DԐ[$B[38]])) { $this->setNamePinyin($A׋ռ, $DԐ[$B[38]]); } return $this->where(array($B[2146] => $A׋ռ))->save($DԐ); } private function _changeChildLevel($C, $Dܹ, $dΣ = false) { goto Bׇֻ; CѢ: $this->where($F)->data($dจԌ)->save(); goto a˦; c: if ($dΣ) { $d = $Dܹ[$aʦ[464]] . $Dܹ[$aʦ[2074]] . $aʦ[57]; } $F = array($aʦ[530] => array($aʦ[488], $C[$aʦ[464]] . $C[$aʦ[2074]] . $aʦ[489])); $dจԌ = array($aʦ[530] => array($aʦ[539], "\162\145\x70\154\x61\x63\x65\x28\160\x61\162\x65\156\164\114\x65\x76\145\154\x2c\x27{$Bȇɶ}\47\x2c\x27{$d}\47\51")); goto CѢ; Bׇֻ: $aʦ =& $_SERVER[ȦÆ]; $Bȇɶ = $C[$aʦ[464]] . $C[$aʦ[2074]] . $aʦ[57]; $d = $Dܹ[$aʦ[464]] . $Dܹ[$aʦ[2074]] . $aʦ[57] . $C[$aʦ[2074]] . $aʦ[57]; goto c; a˦: } public function setNamePinyin($Cő, $e׼Ε = false) { $a =& $_SERVER[ȦÆ]; if (!$e׼Ε) { $b = $this->getInfoSimple($Cő); $e׼Ε = $b[$a[38]]; } if (!Input::check($e׼Ε, $a[533])) { $this->metaSet($Cő, $a[421], null); $this->metaSet($Cő, $a[420], null); return; } $bʉ = array($a[421] => str_replace($a[60], $a[43], Pinyin::encode($e׼Ε)), $a[420] => Pinyin::encode($e׼Ε, $a[534])); $this->metaSet($Cő, $bʉ); } protected function groupStatus($Eɖ, $F꿼, $A = true) { $e =& $_SERVER[ȦÆ]; $BИ = $this->getInfoSimple($Eɖ); if (!$BИ) { return !1; } if ($A) { $this->_groupStatusApply($BИ, $F꿼); } $a塐 = array($e[2074] => $Eɖ, $e[99] => $e[690], $e[364] => $F꿼); return Model($e[2147])->add($a塐, array(), !0); } private function _groupStatusApply($b®ł, $D) { $fĦ =& $_SERVER[ȦÆ]; if ($D == $fĦ[93]) { $d֯ꙛ = $this->parentLevelArray($b®ł[$fĦ[464]]); } else { $d؟ò = array($fĦ[530] => array($fĦ[488], $b®ł[$fĦ[464]] . $b®ł[$fĦ[2074]] . $fĦ[489])); $d֯ꙛ = $this->where($d؟ò)->field($fĦ[2074])->select(); $d֯ꙛ = array_to_keyvalue($d֯ꙛ, $fĦ[43], $fĦ[2074]); } if (empty($d֯ꙛ)) { return; } $d؟ò = array($fĦ[2074] => array($fĦ[17], $d֯ꙛ), $fĦ[99] => $fĦ[690], $fĦ[364] => $D ? $fĦ[473] : $fĦ[93]); Model($fĦ[2147])->where($d؟ò)->save(array($fĦ[364] => $D)); } protected function groupRemove($B٤) { goto eխ; eטɱ: Model($c[753])->groupRootRemove($B٤); return $this->where($e虎)->delete(); goto BŘ; eխ: $c =& $_SERVER[ȦÆ]; $e虎 = array($c[2074] => $B٤); $d޿ = $this->where($e虎)->find(); goto Bʦ; Bʦ: if (!$d޿ || $d޿[$c[466]] == 0) { return !1; } $f = $this->getInfoSimple($d޿[$c[466]]); $this->_changeChildLevel($d޿, $f, !0); goto e՚; e՚: $this->where(array($c[466] => $B٤))->save(array($c[466] => $d޿[$c[466]])); Model($c[2147])->where($e虎)->delete(); Model($c[2148])->where($e虎)->delete(); goto eטɱ; BŘ: } public function listData() { $Eᚫ̺ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Eᚫ̺[$_SERVER[ȦÆ][359]]); return $Eᚫ̺; } private function _makeOrder($a㌝ = '') { goto Fӑߌ; Fӑߌ: $d =& $_SERVER[ȦÆ]; $C = array($d[2074], $d[38], $d[2060], $d[193]); $C = array($d[407] => $d[408], $d[409] => $d[410]); goto Fմ; Cě: $a㌝ = $a㌝ . "{$DС}\x20{$Cҏ}\x2c\40\x67\x72\157\x75\x70\x49\104\x20\141\x73\143"; return $this->order($a㌝); goto C鲍; Fմ: $DС = Input::get($d[412], $d[17], $d[2078], $C); $Cҏ = Input::get($d[413], $d[17], $d[2149], array($d[2149], $d[409])); $Cҏ = $C[$Cҏ]; goto Cě; C鲍: } public function listChild($C) { $C =& $_SERVER[ȦÆ]; $FݿԪ = $this->where(array($C[466] => $C))->_makeOrder()->selectPage(200); $this->_listDataApply($FݿԪ[$C[359]]); return $FݿԪ; } public function listByID($e꺧ާ) { $Bꈜ =& $_SERVER[ȦÆ]; if (!$e꺧ާ) { return array(); } $F = array($Bꈜ[2074] => array($Bꈜ[17], $e꺧ާ)); $D = $this->where($F)->select(); $this->_listDataApply($D); return $D; } public function listSearch($Fӧڷ) { goto e; B꾈ۃ: if (!trim($C)) { return !1; } $C = str_replace($BǸ[2152], $BǸ[2153], $C); $eǵõ = array($BǸ[2074] => array($BǸ[752], "\x25{$C}\x25"), $BǸ[38] => array($BǸ[752], "\45{$C}\x25"), $BǸ[909] => $BǸ[2154]); goto b; e: $BǸ =& $_SERVER[ȦÆ]; $C = $Fӧڷ[$BǸ[2150]]; $C = isset($Fӧڷ[$BǸ[2151]]) ? $Fӧڷ[$BǸ[2151]] : !1; goto B꾈ۃ; b: $b = $this->_makeOrder()->where($eǵõ)->selectPage(20); $b = $b ? $b : array(); if (!$b || count($b[$BǸ[359]]) < 5 && Input::check($C, $BǸ[311])) { $AުƘ = $this->_searchFromMeta($BǸ[420], $C, 10); $f䑜 = $this->_searchFromMeta($BǸ[421], $C, 10); $fՕ = array_merge($AުƘ, $f䑜, $b[$BǸ[359]]); $b[$BǸ[359]] = array_unique_by_key($fՕ, $BǸ[2074]); $b[$BǸ[356]][$BǸ[357]] = count($b[$BǸ[359]]); $b[$BǸ[356]][$BǸ[358]] = ceil($b[$BǸ[356]][$BǸ[357]] / $b[$BǸ[356]][$BǸ[354]]); } goto A; A: $this->_listDataApply($b[$BǸ[359]]); return $b; goto f뙫; f뙫: } private function _searchFromMeta($AД, $D予, $bМĩ) { goto a㺢; a㺢: $ėХ =& $_SERVER[ȦÆ]; $D予 = strtolower($D予); $aƶ = array($ėХ[99] => $AД, $ėХ[364] => array($ėХ[752], "\x25{$D予}\x25")); goto aʖ; a̢: $B = $this->where(array($ėХ[2146] => array($ėХ[17], $e)))->select(); if (!$B) { return array(); } return $B; goto aĈ; aʖ: $e = Model($ėХ[2155])->where($aƶ)->limit($bМĩ)->select(); if (!$e) { return array(); } $e = array_to_keyvalue($e, $ėХ[43], $ėХ[2074]); goto a̢; aĈ: } protected function _listDataApplyItem($e˲) { $cֵ = array($e˲); $this->_listDataApply($cֵ); return $cֵ[0]; } protected function _listDataApply(&$bΌ) { goto d㴽; d㴽: $E =& $_SERVER[ȦÆ]; if (!$bΌ) { return; } $B´ = array_to_keyvalue($bΌ, $E[43], $E[2074]); goto DṌՇ; FŞٌ: $this->_listAppendParent($bΌ); $this->_listAppendSourceRoot($bΌ, $B´); goto Bü; DṌՇ: $this->_listAppendChildren($bΌ); $this->_listAppendChildrenMember($bΌ); $this->_listAppendMeta($bΌ, $B´); goto FŞٌ; Bü: } private function _listAppendChildren(&$dƨ) { goto d؅; Aξ: $C߆ = count($dƨ); $dșѐ = $this->tablePrefix . $this->tableName; for ($Eگȗ = 0, $CՕ = 0; $Eگȗ < $C߆; $Eگȗ++) { $CՕ++; $cܔۂҕ = $dƨ[$Eگȗ][$b[2074]]; $b˔ .= "\x53\x45\x4c\105\x43\x54\x20\x2a\x20\x46\122\x4f\115\x20\x28\x53\x45\114\105\x43\x54\40\x27{$cܔۂҕ}\137\x63\x68\x69\154\x64\x27\x20\x61\x73\40\x68\141\x73\x20\x46\122\117\x4d\40\x60{$dșѐ}\x60\40\167\150\x65\x72\x65\40\160\x61\162\x65\x6e\x74\x49\104\x3d{$cܔۂҕ}\40\x6c\x69\x6d\x69\164\40\x31\x29\x20\x61\x73\x20\164\142\x5f{$cܔۂҕ}\x20\x75\x6e\x69\157\156\40\141\154\154\x20"; if (($CՕ >= 20 || $Eگȗ == $C߆ - 1) && $b˔) { $b˔ = substr($b˔, 0, -strlen($b[454])); $a = $this->query($b˔); $C = array_merge($C, $a); $CՕ = 0; $b˔ = $b[43]; } } goto fӲܞ; d؅: $b =& $_SERVER[ȦÆ]; $b˔ = $b[366]; $C = array(); goto Aξ; fӲܞ: $C = array_to_keyvalue($C, $b[455]); foreach ($dƨ as &$E) { $E[$b[2156]] = isset($C[$E[$b[2074]] . $b[2157]]); } goto C͵; C͵: } private function _listAppendChildrenMember(&$b㧓) { goto Eξ; c: $E˟ = array_to_keyvalue($E˟, $C[455]); foreach ($b㧓 as &$Bɷ) { $Bɷ[$C[2158]] = isset($E˟[$Bɷ[$C[2074]] . $C[2157]]); } goto F; A: $E˂ = count($b㧓); $CϱŢп = $this->tablePrefix . $C[2148]; for ($E = 0, $EϏ = 0; $E < $E˂; $E++) { $EϏ++; $c×й = $b㧓[$E][$C[2074]]; $c .= "\x53\105\x4c\105\x43\x54\x20\52\x20\x46\x52\x4f\115\40\50\123\105\114\x45\x43\x54\x20\47{$c×й}\x5f\143\150\151\154\x64\47\x20\x61\x73\40\x68\x61\163\x20\106\122\x4f\x4d\x20\140{$CϱŢп}\140\x20\167\x68\x65\162\145\40\147\x72\157\165\160\x49\104\75{$c×й}\40\x6c\151\155\x69\x74\x20\x31\51\x20\141\163\40\x74\x62\x5f{$c×й}\40\x75\x6e\x69\157\x6e\x20\141\x6c\x6c\40"; if (($EϏ >= 20 || $E == $E˂ - 1) && $c) { $c = substr($c, 0, -strlen($C[454])); $BՇ = $this->query($c); $E˟ = array_merge($E˟, $BՇ); $EϏ = 0; $c = $C[43]; } } goto c; Eξ: $C =& $_SERVER[ȦÆ]; $c = $C[366]; $E˟ = array(); goto A; F: } private function _listAppendMeta(&$Dޟǒ, $D­) { $Cֻ =& $_SERVER[ȦÆ]; $b׽ = array($Cֻ[2074] => array($Cֻ[17], $D­)); $a֧ = Model($Cֻ[2147])->where($b׽)->select(); $a֧ = array_to_keyvalue_group($a֧, $Cֻ[2074]); foreach ($a֧ as &$eβ֯) { $eβ֯ = array_to_keyvalue($eβ֯, $Cֻ[99], $Cֻ[364]); } foreach ($Dޟǒ as &$b١Ժ) { $b١Ժ[$Cֻ[422]] = array(); if (isset($a֧[$b١Ժ[$Cֻ[2074]]])) { $b١Ժ[$Cֻ[422]] = $a֧[$b١Ժ[$Cֻ[2074]]]; } } } protected function parentLevelArray($d¢) { $A =& $_SERVER[ȦÆ]; $d¢ = explode($A[57], trim($d¢, $A[57])); $d¢ = array_remove_value($d¢, $A[473]); return $d¢; } private function _listAppendParent(&$BÙऩ) { goto B׮ݴ; Fۗ: foreach ($BÙऩ as &$e) { $Aሡ = $this->parentLevelArray($e[$d쇻[464]]); $fɞ = $d쇻[43]; foreach ($Aሡ as $B) { $fɞ .= $f[$B] . $d쇻[18]; } if ($Aሡ) { $fɞ .= $e[$d쇻[38]]; } $e[$d쇻[468]] = str_replace($d쇻[472], $d쇻[18], $fɞ); } goto bԑ; A̓Ŀ: $d = array(); foreach ($f as $FȂ => $d) { if (!$d) { $d[] = $FȂ; } } if ($d) { $B = array($d쇻[2146] => array($d쇻[389], $d)); $c = $this->field($d쇻[2159])->where($B)->select(); $D삏ͨ = array_to_keyvalue($c, $d쇻[2074], $d쇻[38]); $f = array_merge_index($f, $D삏ͨ); } goto Fۗ; B׮ݴ: $d쇻 =& $_SERVER[ȦÆ]; $f = array(); foreach ($BÙऩ as &$e) { $f[$e[$d쇻[2074]]] = $e[$d쇻[38]]; $Aሡ = $this->parentLevelArray($e[$d쇻[464]]); foreach ($Aሡ as $B) { if (!isset($f[$B])) { $f[$B] = 0; } } } goto A̓Ŀ; bԑ: } private function _listAppendSourceRoot(&$DԦ, $c꡽) { goto aඏ۶; eʮ: foreach ($DԦ as &$c) { $c[$c󸃞[396]] = $f⒗[$c[$c󸃞[2074]]] ? $f⒗[$c[$c󸃞[2074]]] : array(); } goto A⋧; Dڊ菵: $f⒗ = Model($c󸃞[753])->order($c󸃞[2161])->field($f)->where($AӒ)->select(); $f⒗ = array_to_keyvalue($f⒗, $c󸃞[461]); $f⒗ = array_remove_key($f⒗, $c󸃞[461]); goto eʮ; aඏ۶: $c󸃞 =& $_SERVER[ȦÆ]; $AӒ = array($c󸃞[376] => SourceModel::TYPE_GROUP, $c󸃞[466] => 0, $c󸃞[461] => array($c󸃞[17], $c꡽)); $f = $c󸃞[2160]; goto Dڊ菵; A⋧: } protected function resetParentLevel() { $Bڤ =& $_SERVER[ȦÆ]; $Dڐ = $Bڤ[2074]; $Aә = $this->select(); $Aә = array_to_keyvalue($Aә, $Dڐ); foreach ($Aә as $fӝ) { goto fɐ; fɐ: $B = $fӝ; $eꨣ = array(); while ($B[$Bڤ[466]] != 0) { $eꨣ[] = $B[$Bڤ[466]]; $B = $Aә[$B[$Bڤ[466]]]; } goto f; f: $eꨣ[] = 0; $eꨣ = $Bڤ[57] . implode($Bڤ[57], array_reverse($eꨣ)) . $Bڤ[57]; $this->setNamePinyin($fӝ[$Dڐ], $fӝ[$Bڤ[38]]); goto A; A: $this->where(array($Dڐ => $fӝ[$Dڐ]))->save(array($Bڤ[530] => $eꨣ)); goto C; C: } return $Aә; } public function groupNameAuto($d, $d) { $d =& $_SERVER[ȦÆ]; $B׺ۍ = $this->where(array($d[373] => $d))->getField($d[38], !0); if (!$B׺ۍ || !in_array($d, $B׺ۍ)) { return $d; } for ($D˺ = 1; $D˺ <= count($B׺ۍ) + 1; $D˺++) { $Eӹͷ = $d . "\50{$D˺}\x29"; if (!in_array($Eӹͷ, $B׺ۍ)) { return $Eӹͷ; } } } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\x70\154\x75\x67\151\156\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\163\164\x61\x74\x75\x73", "\x72\145\147\151\x65\163\164", "\143\157\x6e\x66\151\147"); public function loadList($Cӄ = false) { $BȻΈ = array_to_keyvalue($this->listData(), $_SERVER[ȦÆ][38]); if ($Cӄ) { return $BȻΈ[$Cӄ]; } return $BȻΈ; } public function init() { $cႏ =& $_SERVER[ȦÆ]; Hook::trigger($cႏ[2162]); $bȩճ = $this->loadPluginList(); foreach ($bȩճ as $f => $cۊկ) { $EÝ = $this->appAllow($f, $cۊկ); if (!$EÝ) { continue; } foreach ($cۊկ[$cႏ[2163]] as $d => $A) { Hook::bind($d, $A); } } Hook::trigger($cႏ[2164]); Hook::trigger(ACTION); } public function appAllow($C, $d, $e = true) { $cԡ =& $_SERVER[ȦÆ]; $Aîŗ = PLUGIN_DIR . $C . $cԡ[2165]; if (!is_array($d) || !is_array($d[$cԡ[2163]]) || !is_file($Aîŗ) || $d[$cԡ[690]] != 1) { return !1; } if ($e && !Action($cԡ[2166])->checkAuth($C)) { return !1; } return !0; } public function unInstall($aƺ) { $Ě =& $_SERVER[ȦÆ]; $D𓙩 = $this->loadList($aƺ); if (file_exists(PLUGIN_DIR . $aƺ)) { Hook::apply($aƺ . $Ě[2167]); } $this->remove($D𓙩[$Ě[372]]); } public function changeStatus($bךÍ, $Bȣ) { $BÉ =& $_SERVER[ȦÆ]; $c = $this->loadList($bךÍ); if ($Bȣ) { Hook::apply($bךÍ . $BÉ[2168]); } $this->update($c[$BÉ[372]], array($BÉ[2169] => $Bȣ)); } public function appRegist($Aϼǭ, $a˟) { $C舗 =& $_SERVER[ȦÆ]; $B = $this->loadList($Aϼǭ); if ($B) { $this->update($B[$C舗[372]], array($C舗[2163] => $a˟)); } else { $EּІ = array($C舗[38] => $Aϼǭ, $C舗[2163] => $a˟, $C舗[690] => 0, $C舗[16] => $this->getConfigDefault($Aϼǭ)); $this->insert($EּІ); } } public function getConfigDefault($C러) { $f쉑 =& $_SERVER[ȦÆ]; $dﾑǟ = array(); $Aº܅ = $this->getPackageJson($C러); if (!$Aº܅ && is_array($Aº܅[$f쉑[2170]])) { return $dﾑǟ; } foreach ($Aº܅[$f쉑[2170]] as $dЊ => $E) { if (!isset($E[$f쉑[364]]) || isset($dﾑǟ[$dЊ])) { continue; } $dﾑǟ[$dЊ] = $E[$f쉑[364]]; } return $dﾑǟ; } public function getPackageJson($d) { return Hook::apply($d . $_SERVER[ȦÆ][2171]); } public function getConfig($EÑ, $CӒ = false) { $Cݍ =& $_SERVER[ȦÆ]; $eޘߐ = array(); $C = $this->loadList($EÑ); if ($C && is_array($C[$Cݍ[16]])) { $eޘߐ = $C[$Cݍ[16]]; } if (!$eޘߐ || $CӒ) { $eޘߐ = $this->getConfigDefault($EÑ); } return $eޘߐ; } public function setConfig($C, $b֡ = false) { goto F; d֟: $this->update($f󖐉[$Bυ[372]], array($Bυ[16] => $Cͭ)); goto B; F: $Bυ =& $_SERVER[ȦÆ]; $f󖐉 = $this->loadList($C); if (!$f󖐉) { return !1; } goto AێŦ; AێŦ: if ($b֡ == !1) { $b֡ = $this->getConfigDefault($C); } $Cͭ = $f󖐉[$Bυ[16]]; foreach ($b֡ as $aǌщ => $C刏) { $Cͭ[$aǌщ] = is_string($C刏) ? trim($C刏) : $C刏; } goto d֟; B: } public function viewList() { goto Fҍ; B: $d钸Ҹ = $this->loadPluginList(); $F댤 = array(); foreach ($d钸Ҹ as $C߶ => $EÐ) { unset($EÐ[$dˮ[2163]], $EÐ[$dˮ[16]]); $F϶ˤ = PLUGIN_DIR . $EÐ[$dˮ[38]] . $dˮ[2165]; if (!is_file($F϶ˤ)) { continue; } $aд = Hook::apply($EÐ[$dˮ[38]] . $dˮ[2171]); if (is_array($aд)) { $F댤[$C߶] = array_merge($EÐ, $aд); } } goto cЦ; cЦ: return $F댤; goto cĕ猕; Fҍ: $dˮ =& $_SERVER[ȦÆ]; $d钸Ҹ = $this->loadList(); $this->pluginScan($d钸Ҹ); goto B; cĕ猕: } private function loadPluginList() { $dիܤǛ =& $_SERVER[ȦÆ]; $e = $this->loadList(); if (strtolower(MOD) == $dիܤǛ[2172]) { return $e; } $B = Hook::trigger($dիܤǛ[2173], $e); if ($e && !$B) { die; } return $B ? $B : $e; } private function pluginScan($eɇ) { $Eӑ =& $_SERVER[ȦÆ]; recursion_dir(PLUGIN_DIR, $Aڼ, $e, 0); foreach ($Aڼ as $c) { $BĹ = get_path_this($c); if (isset($eɇ[$BĹ]) || !file_exists($c . $Eӑ[2174]) || !file_exists($c . $Eӑ[2165])) { continue; } Hook::apply($BĹ . $Eӑ[2168]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\155\137\163\x65\x73\x73\x69\x6f\156"; public function get($a) { $cÑ =& $_SERVER[ȦÆ]; $D = $this->where(array($cÑ[2175] => $a))->find(); if (!is_array($D)) { return !1; } return $D[$cÑ[693]]; } public function set($F֎, $a, $EŐ = 3600) { $Aي۲ =& $_SERVER[ȦÆ]; $bБ = array($Aي۲[2175] => $F֎, $Aي۲[2104] => $a, $Aي۲[2176] => $EŐ + time()); if (Session::get($Aي۲[2177])) { $bБ[$Aي۲[1412]] = Session::get($Aي۲[2177]); } else { $bБ[$Aي۲[1412]] = 0; } if ($this->get($F֎)) { return $this->where(array($Aي۲[2175] => $F֎))->save($bБ); } else { return $this->add($bБ, array(), !0); } } public function remove($Dœ) { return $this->where(array($_SERVER[ȦÆ][2175] => $Dœ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ȦÆ][2178] . time())->delete(); } } goto AН; Fۓݽ: define($_SERVER[ȦÆ][1908], 32); class Services_JSON { function __construct($a = 0) { $this->use = $a; } function utf162utf8($c烅) { $BԈ =& $_SERVER[ȦÆ]; if (function_exists($BԈ[78])) { return mb_convert_encoding($c烅, $BԈ[1560], $BԈ[1909]); } $C = ord($c烅[0]) << 8 | ord($c烅[1]); switch (!0) { case (127 & $C) == $C: return chr(127 & $C); case (2047 & $C) == $C: return chr(192 | $C >> 6 & 31) . chr(128 | $C & 63); case (65535 & $C) == $C: return chr(224 | $C >> 12 & 15) . chr(128 | $C >> 6 & 63) . chr(128 | $C & 63); } return $BԈ[43]; } function utf82utf16($e͌) { $cנ =& $_SERVER[ȦÆ]; if (function_exists($cנ[78])) { return mb_convert_encoding($e͌, $cנ[1909], $cנ[1560]); } switch (strlen($e͌)) { case 1: return $e͌; case 2: return chr(7 & ord($e͌[0]) >> 2) . chr(192 & ord($e͌[0]) << 6 | 63 & ord($e͌[1])); case 3: return chr(240 & ord($e͌[0]) << 4 | 15 & ord($e͌[1]) >> 2) . chr(192 & ord($e͌[1]) << 6 | 127 & ord($e͌[2])); } return $cנ[43]; } function encode($Fʤ) { $B턡 =& $_SERVER[ȦÆ]; switch (gettype($Fʤ)) { case $B턡[1571]: return $Fʤ ? $B턡[1570] : $B턡[1572]; case $B턡[1910]: return $B턡[109]; case $B턡[308]: return (int) $Fʤ; case $B턡[283]: case $B턡[282]: return (double) $Fʤ; case $B턡[317]: $dǋӏ = $B턡[43]; $a↛ = strlen($Fʤ); for ($Dќ = 0; $Dќ < $a↛; ++$Dќ) { $Dމ = ord($Fʤ[$Dќ]); switch (!0) { case $Dމ == 8: $dǋӏ .= $B턡[1911]; break; case $Dމ == 9: $dǋӏ .= $B턡[1547]; break; case $Dމ == 10: $dǋӏ .= $B턡[1545]; break; case $Dމ == 12: $dǋӏ .= $B턡[1912]; break; case $Dމ == 13: $dǋӏ .= $B턡[1546]; break; case $Dމ == 34: case $Dމ == 47: case $Dމ == 92: $dǋӏ .= $B턡[103] . $Fʤ[$Dќ]; break; case $Dމ >= 32 && $Dމ <= 127: $dǋӏ .= $Fʤ[$Dќ]; break; case ($Dމ & 224) == 192: $a͏ = pack($B턡[1913], $Dމ, ord($Fʤ[$Dќ + 1])); $Dќ += 1; $bᑑ = $this->utf82utf16($a͏); $dǋӏ .= sprintf($B턡[1914], bin2hex($bᑑ)); break; case ($Dމ & 240) == 224: $a͏ = pack($B턡[1913], $Dމ, ord($Fʤ[$Dќ + 1]), ord($Fʤ[$Dќ + 2])); $Dќ += 2; $bᑑ = $this->utf82utf16($a͏); $dǋӏ .= sprintf($B턡[1914], bin2hex($bᑑ)); break; case ($Dމ & 248) == 240: $a͏ = pack($B턡[1913], $Dމ, ord($Fʤ[$Dќ + 1]), ord($Fʤ[$Dќ + 2]), ord($Fʤ[$Dќ + 3])); $Dќ += 3; $bᑑ = $this->utf82utf16($a͏); $dǋӏ .= sprintf($B턡[1914], bin2hex($bᑑ)); break; case ($Dމ & 252) == 248: $a͏ = pack($B턡[1913], $Dމ, ord($Fʤ[$Dќ + 1]), ord($Fʤ[$Dќ + 2]), ord($Fʤ[$Dќ + 3]), ord($Fʤ[$Dќ + 4])); $Dќ += 4; $bᑑ = $this->utf82utf16($a͏); $dǋӏ .= sprintf($B턡[1914], bin2hex($bᑑ)); break; case ($Dމ & 254) == 252: $a͏ = pack($B턡[1913], $Dމ, ord($Fʤ[$Dќ + 1]), ord($Fʤ[$Dќ + 2]), ord($Fʤ[$Dќ + 3]), ord($Fʤ[$Dќ + 4]), ord($Fʤ[$Dќ + 5])); $Dќ += 5; $bᑑ = $this->utf82utf16($a͏); $dǋӏ .= sprintf($B턡[1914], bin2hex($bᑑ)); break; } } return $B턡[122] . $dǋӏ . $B턡[122]; case $B턡[1915]: if (is_array($Fʤ) && count($Fʤ) && array_keys($Fʤ) !== range(0, sizeof($Fʤ) - 1)) { $dʏ = array_map(array($this, $B턡[1916]), array_keys($Fʤ), array_values($Fʤ)); foreach ($dʏ as $aש) { if (Services_JSON::isError($aש)) { return $aש; } } return $B턡[1061] . join($B턡[57], $dʏ) . $B턡[320]; } $cϞŷ = array_map(array($this, $B턡[1917]), $Fʤ); foreach ($cϞŷ as $aҊ) { if (Services_JSON::isError($aҊ)) { return $aҊ; } } return $B턡[163] . join($B턡[57], $cϞŷ) . $B턡[481]; case $B턡[1918]: $cɌš = get_object_vars($Fʤ); $dʏ = array_map(array($this, $B턡[1916]), array_keys($cɌš), array_values($cɌš)); foreach ($dʏ as $aש) { if (Services_JSON::isError($aש)) { return $aש; } } return $B턡[1061] . join($B턡[57], $dʏ) . $B턡[320]; default: return $this->use & SERVICES_JSON_SUPPRESS_ERRORS ? $B턡[109] : new Services_JSON_Error(gettype($Fʤ) . $B턡[1919]); } } function name_value($dζݰ, $D) { $D܋ = $this->encode($D); if (Services_JSON::isError($D܋)) { return $D܋; } return $this->encode(strval($dζݰ)) . $_SERVER[ȦÆ][4] . $D܋; } function reduce_string($d) { $b̂ =& $_SERVER[ȦÆ]; $d = preg_replace(array($b̂[1920], $b̂[1921], $b̂[1922]), $b̂[43], $d); return trim($d); } function decode($Eҳ) { $eؐ =& $_SERVER[ȦÆ]; $Eҳ = $this->reduce_string($Eҳ); switch (strtolower($Eҳ)) { case $eؐ[1570]: return !0; case $eؐ[1572]: return !1; case $eؐ[109]: return null; default: $cčҘ = array(); if (is_numeric($Eҳ)) { return (double) $Eҳ == (int) $Eҳ ? (int) $Eҳ : (double) $Eҳ; } elseif (preg_match($eؐ[1923], $Eҳ, $cčҘ) && $cčҘ[1] == $cčҘ[2]) { $d񍶼 = substr($Eҳ, 0, 1); $a = substr($Eҳ, 1, -1); $dŉ = $eؐ[43]; $A = strlen($a); for ($fۧ = 0; $fۧ < $A; ++$fۧ) { $b瑩 = substr($a, $fۧ, 2); $E = ord($a[$fۧ]); switch (!0) { case $b瑩 == $eؐ[1911]: $dŉ .= chr(8); ++$fۧ; break; case $b瑩 == $eؐ[1547]: $dŉ .= chr(9); ++$fۧ; break; case $b瑩 == $eؐ[1545]: $dŉ .= chr(10); ++$fۧ; break; case $b瑩 == $eؐ[1912]: $dŉ .= chr(12); ++$fۧ; break; case $b瑩 == $eؐ[1546]: $dŉ .= chr(13); ++$fۧ; break; case $b瑩 == $eؐ[1332]: case $b瑩 == $eؐ[1924]: case $b瑩 == $eؐ[1540]: case $b瑩 == $eؐ[1542]: if ($d񍶼 == $eؐ[122] && $b瑩 != $eؐ[1924] || $d񍶼 == $eؐ[65] && $b瑩 != $eؐ[1332]) { $dŉ .= $a[++$fۧ]; } break; case preg_match($eؐ[1925], substr($a, $fۧ, 6)): $Eˎ = chr(hexdec(substr($a, $fۧ + 2, 2))) . chr(hexdec(substr($a, $fۧ + 4, 2))); $dŉ .= $this->utf162utf8($Eˎ); $fۧ += 5; break; case $E >= 32 && $E <= 127: $dŉ .= $a[$fۧ]; break; case ($E & 224) == 192: $dŉ .= substr($a, $fۧ, 2); ++$fۧ; break; case ($E & 240) == 224: $dŉ .= substr($a, $fۧ, 3); $fۧ += 2; break; case ($E & 248) == 240: $dŉ .= substr($a, $fۧ, 4); $fۧ += 3; break; case ($E & 252) == 248: $dŉ .= substr($a, $fۧ, 5); $fۧ += 4; break; case ($E & 254) == 252: $dŉ .= substr($a, $fۧ, 6); $fۧ += 5; break; } } return $dŉ; } elseif (preg_match($eؐ[1926], $Eҳ) || preg_match($eؐ[1927], $Eҳ)) { goto Aܟ; AϷ: $a = $this->reduce_string($a); if ($a == $eؐ[43]) { if (reset($FȜ) == SERVICES_JSON_IN_ARR) { return $bѮú; } else { return $f݂; } } $A = strlen($a); goto e˪; Aܟ: if ($Eҳ[0] == $eؐ[163]) { $FȜ = array(SERVICES_JSON_IN_ARR); $bѮú = array(); } else { if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $FȜ = array(SERVICES_JSON_IN_OBJ); $f݂ = array(); } else { $FȜ = array(SERVICES_JSON_IN_OBJ); $f݂ = new stdClass(); } } array_push($FȜ, array($eؐ[1928] => SERVICES_JSON_SLICE, $eؐ[268] => 0, $eؐ[1929] => !1)); $a = substr($Eҳ, 1, -1); goto AϷ; e˪: for ($fۧ = 0; $fۧ <= $A; ++$fۧ) { $A֦ = end($FȜ); $b瑩 = substr($a, $fۧ, 2); if ($fۧ == $A || $a[$fۧ] == $eؐ[57] && $A֦[$eؐ[1928]] == SERVICES_JSON_SLICE) { $aϓĖ = substr($a, $A֦[$eؐ[268]], $fۧ - $A֦[$eؐ[268]]); array_push($FȜ, array($eؐ[1928] => SERVICES_JSON_SLICE, $eؐ[268] => $fۧ + 1, $eؐ[1929] => !1)); if (reset($FȜ) == SERVICES_JSON_IN_ARR) { array_push($bѮú, $this->decode($aϓĖ)); } elseif (reset($FȜ) == SERVICES_JSON_IN_OBJ) { $EȾ = array(); if (preg_match($eؐ[1930], $aϓĖ, $EȾ)) { $CՋŃ = $this->decode($EȾ[1]); $eݵ = $this->decode($EȾ[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $f݂[$CՋŃ] = $eݵ; } else { $f݂->{$CՋŃ} = $eݵ; } } elseif (preg_match($eؐ[1931], $aϓĖ, $EȾ)) { $CՋŃ = $EȾ[1]; $eݵ = $this->decode($EȾ[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $f݂[$CՋŃ] = $eݵ; } else { $f݂->{$CՋŃ} = $eݵ; } } } } elseif (($a[$fۧ] == $eؐ[122] || $a[$fۧ] == $eؐ[65]) && $A֦[$eؐ[1928]] != SERVICES_JSON_IN_STR) { array_push($FȜ, array($eؐ[1928] => SERVICES_JSON_IN_STR, $eؐ[268] => $fۧ, $eؐ[1929] => $a[$fۧ])); } elseif ($a[$fۧ] == $A֦[$eؐ[1929]] && $A֦[$eؐ[1928]] == SERVICES_JSON_IN_STR && (strlen(substr($a, 0, $fۧ)) - strlen(rtrim(substr($a, 0, $fۧ), $eؐ[103]))) % 2 != 1) { array_pop($FȜ); } elseif ($a[$fۧ] == $eؐ[163] && in_array($A֦[$eؐ[1928]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($FȜ, array($eؐ[1928] => SERVICES_JSON_IN_ARR, $eؐ[268] => $fۧ, $eؐ[1929] => !1)); } elseif ($a[$fۧ] == $eؐ[481] && $A֦[$eؐ[1928]] == SERVICES_JSON_IN_ARR) { array_pop($FȜ); } elseif ($a[$fۧ] == $eؐ[1061] && in_array($A֦[$eؐ[1928]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($FȜ, array($eؐ[1928] => SERVICES_JSON_IN_OBJ, $eؐ[268] => $fۧ, $eؐ[1929] => !1)); } elseif ($a[$fۧ] == $eؐ[320] && $A֦[$eؐ[1928]] == SERVICES_JSON_IN_OBJ) { array_pop($FȜ); } elseif ($b瑩 == $eؐ[1932] && in_array($A֦[$eؐ[1928]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($FȜ, array($eؐ[1928] => SERVICES_JSON_IN_CMT, $eؐ[268] => $fۧ, $eؐ[1929] => !1)); $fۧ++; } elseif ($b瑩 == $eؐ[1933] && $A֦[$eؐ[1928]] == SERVICES_JSON_IN_CMT) { array_pop($FȜ); $fۧ++; for ($EĎ༦ = $A֦[$eؐ[268]]; $EĎ༦ <= $fۧ; ++$EĎ༦) { $a = substr_replace($a, $eؐ[60], $EĎ༦, 1); } } } if (reset($FȜ) == SERVICES_JSON_IN_ARR) { return $bѮú; } elseif (reset($FȜ) == SERVICES_JSON_IN_OBJ) { return $f݂; } goto d͵ֈ; d͵ֈ: } } } function isError($d䐄, $a = null) { $Eĸ܊ĥ =& $_SERVER[ȦÆ]; if (class_exists($Eĸ܊ĥ[1934])) { return PEAR::isError($d䐄, $a); } elseif (is_object($d䐄) && (get_class($d䐄) == $Eĸ܊ĥ[1935] || is_subclass_of($d䐄, $Eĸ܊ĥ[1935]))) { return !0; } return !1; } } if (class_exists($_SERVER[ȦÆ][1936])) { class Services_JSON_Error extends PEAR_Error { function __construct($dÎӡ˘ = "\165\156\153\156\x6f\x77\x6e\40\x65\x72\x72\157\162", $A݃ = null, $F󷺵 = null, $Aܘƞ = null, $FП = null) { parent::PEAR_Error($dÎӡ˘, $A݃, $F󷺵, $Aܘƞ, $FП); } } } else { class Services_JSON_Error { function __construct($b퇤͡ = "\x75\x6e\x6b\156\157\167\x6e\x20\x65\162\x72\157\162", $f = null, $c = null, $F = null, $A = null) { } } } goto Aݙ; b: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\157\160\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($CϽ) { $bӊ =& $_SERVER[ȦÆ]; if (!defined($bӊ[432])) { define($bӊ[432], 0); } return "\x55\x73\145\162\x4f\160\x74\x69\x6f\x6e\137{$CϽ}\137" . USER_ID; } protected function filterWhere($Aĸ) { $Dˢ =& $_SERVER[ȦÆ]; if (!defined($Dˢ[432])) { define($Dˢ[432], 0); } $Aĸ[$Dˢ[1412]] = USER_ID; return $Aĸ; } public function cacheRemoveUser($Fů, $bҋ) { return Cache::remove("\x55\x73\145\x72\x4f\160\164\x69\157\156\137{$Fů}\x5f" . $bҋ); } protected function optionDefault($d = '') { $D =& $_SERVER[ȦÆ]; if ($d == $D[43]) { return $GLOBALS[$D[16]][$D[2508]]; } if ($d == $D[2509]) { return $GLOBALS[$D[16]][$D[2510]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\56\164\141\147\114\151\x73\164"; public $modelType = "\x55\163\145\x72\x4f\160\164\x69\157\156"; public $field = array("\156\141\155\x65", "\163\x74\x79\x6c\x65", "\x73\157\162\x74"); public function listData($b = false, $B = "\163\157\x72\164", $c㘮 = false) { return parent::listData($b, $B, $c㘮); } public function remove($bݬ) { return parent::remove($bݬ); } public function add($eݣ, $Dꃡ = "\x6c\x61\x62\x65\x6c\55\x67\x72\x65\x79\x2d\x6e\157\x72\x6d\141\154") { $eɖ =& $_SERVER[ȦÆ]; if ($this->findByName($eݣ)) { return !1; } $E = array($eɖ[391] => $eݣ, $eɖ[442] => $Dꃡ, $eɖ[2078] => $this->getSort($eɖ[251]) + 1); return parent::insert($E); } public function update($D, $Aΐ) { $Cɭ =& $_SERVER[ȦÆ]; $cµ = $this->listData($D); $A = $this->findByName($Aΐ[$Cɭ[38]]); if (!$cµ || $A && $A[$Cɭ[372]] != $cµ[$Cɭ[372]]) { return !1; } return parent::update($D, $Aΐ); } public function moveTop($C⿊) { $C΄۸ =& $_SERVER[ȦÆ]; $Aޥ = parent::listData(); $Cę = $this->getSort($C΄۸[250]); foreach ($Aޥ as &$c) { if ($c[$C΄۸[372]] == $C⿊) { $c[$C΄۸[2095]] = $Cę; continue; } $c[$C΄۸[2095]] += 1; } return parent::resetData($Aޥ); } public function moveBottom($EȬ) { $cÈ =& $_SERVER[ȦÆ]; $e = $this->getSort($cÈ[251]) + 1; return parent::update($EȬ, array($cÈ[2095] => $e)); } public function resetSort($B٩) { goto Eٿ; eўĹ: return parent::resetData($dŶշ); goto b֐㉽; Fɛ: for ($A = 0; $A < count($B٩); $A++) { $c[$B٩[$A] . $bɂƎ[43]] = $A + 1; } $dŶշ = parent::listData(); foreach ($dŶշ as &$Fֵ) { $fϝ = $c[$Fֵ[$bɂƎ[372]]]; $Fֵ[$bɂƎ[2095]] = $fϝ ? $fϝ : $Fֵ[$bɂƎ[2095]]; } goto eўĹ; Eٿ: $bɂƎ =& $_SERVER[ȦÆ]; $c = array(); $B٩ = is_array($B٩) ? $B٩ : array(); goto Fɛ; b֐㉽: } private function getSort($c) { $dʣ =& $_SERVER[ȦÆ]; $Fൕӂ = parent::listData(); $fѶ = array_to_keyvalue($Fൕӂ, $dʣ[43], $dʣ[2095]); if (!$fѶ) { $fѶ = array(0); } $FƄӯ = $c == $dʣ[251] ? max($fѶ) : min($fѶ); return intval($FƄӯ); } } goto aѝ; F짭σ: function beforeShutdown() { Hook::trigger($_SERVER[صȢˏ][36]); } $_SERVER[$_SERVER[صȢˏ][37]] = BASIC_PATH; $_SERVER[$_SERVER[صȢˏ][38]] = LIB_DIR; goto C; aհ܎: class CacheLockRedis { public function lock($BŤ, $A娦 = 10) { $E = Cache::init(); $C = microtime(!0) + $A娦; while (microtime(!0) < $C) { $a놇 = $E->get($BŤ); if (!$a놇) { $f = $E->setLock($BŤ, $C, $A娦); if ($f) { return !0; } } else { if ($a놇 < microtime(!0)) { $E->set($BŤ, $C, $C); if ($E->get($BŤ) === $a놇) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($b) { return Cache::init()->get($b); } public function unlock($AƊ) { return Cache::init()->remove($AƊ); } } class CacheLockMemcached { public function lock($b눫, $A = 0) { $B³ = Cache::init(); $Fꠋ = microtime(!0) + $A; while (microtime(!0) < $Fꠋ) { $d = $B³->get($b눫); if (!$d || $d < microtime(!0)) { $Fۍح = $B³->handle->add($b눫, $Fꠋ, $A); if ($Fۍح) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($b) { return Cache::init()->get($b); } public function unlock($dД) { return Cache::init()->remove($dД); } } class CacheLockDatabase { public function lock($a, $Bʬ = 0) { $f = Model($_SERVER[ȦÆ][756]); $Fܷ޾ = microtime(!0) + $Bʬ; while (microtime(!0) < $Fܷ޾) { $aϨ = $f->get($a); if (!$aϨ || $aϨ < microtime(!0)) { $F¼ = $f->set($a, $Fܷ޾); if ($F¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($eݞ) { return Model($_SERVER[ȦÆ][756])->get($eݞ); } public function unlock($C˂) { Model($_SERVER[ȦÆ][756])->remove($C˂); } } goto e֮; C: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\162\143\x65\x5f\162\145\x63\171\x63\154\x65"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\124\x69\155\145", "\x74\151\x6d\x65", "\151\x6e\163\145\162\x74", "\146\165\156\143\x74\151\157\156")); public function listData($e = false) { $b־ =& $_SERVER[ȦÆ]; $e = $e ? $e : USER_ID; $dͳ = $this->where(array($b־[1403] => $e))->select(); return array_to_keyvalue($dͳ, $b־[43], $b־[374]); } public function moveToRecycle($Cޥŕ) { goto A; Eѹʴ: $this->recycleMove($Cޥŕ, 1); if ($aޫב[$a[375]] == $a[93]) { $C䇉 = array($a[530] => array($a[488], $aޫב[$a[464]] . $Cޥŕ . $a[489])); $F->where($C䇉)->setField($a[402], 1); } goto aɘ; D΅: if (!$aޫב || $aޫב[$a[402]] == $a[93]) { return; } $aӡᘃ = array($a[388] => $Cޥŕ, $a[1403] => USER_ID, $a[526] => $aޫב[$a[376]], $a[527] => $aޫב[$a[461]], $a[530] => $aޫב[$a[464]]); $this->add($aӡᘃ); goto Eѹʴ; A: $a =& $_SERVER[ȦÆ]; $F = Model($a[1103]); $aޫב = $F->sourceInfo($Cޥŕ); goto D΅; aɘ: } public function clear() { $this->remove(!1); } public function remove($c̾ = false) { goto dڽ; F: $c̾ = $c̾ === !1 ? !1 : $c̾; $bܦ = array(); foreach ($Dʪ as $E) { if ($c̾ != !1 && !in_array($E, $c̾)) { continue; } $D->remove($E, !1); $a֖ = $this->where(array($B񤢥[374] => $E))->find(); $Dݩܨ = $a֖[$B񤢥[376]] . $B񤢥[80] . $a֖[$B񤢥[461]]; $bܦ[$Dݩܨ] = array($B񤢥[526] => $a֖[$B񤢥[376]], $B񤢥[461] => $a֖[$B񤢥[461]]); $this->where(array($B񤢥[374] => $E))->delete(); } goto dч; dڽ: $B񤢥 =& $_SERVER[ȦÆ]; $D = Model($B񤢥[1103]); $Dʪ = $this->listData(); goto F; dч: foreach ($bܦ as $A) { $D->targetSpaceUpdate($A[$B񤢥[376]], $A[$B񤢥[461]]); } goto Fߌ钵ދ; Fߌ钵ދ: } public function restore($c̔ = false) { goto F㲄; dՅ: $c̔ = $c̔ == !1 ? !1 : $c̔; if (!$B) { return !0; } $Dن = array(); goto cԣ; cԣ: foreach ($B as $e﷡) { goto EŒƼ; FﴫŶ: if ($c溂ʄ[$F[375]] == $F[93]) { $B = array($F[530] => array($F[488], $c溂ʄ[$F[464]] . $e﷡ . $F[489])); $A߇->where($B)->setField($F[402], 0); $this->restoreFolderChildren($e﷡, $B); } $this->where(array($F[374] => $e﷡))->delete(); $A߇->folderSizeReset($c溂ʄ[$F[466]]); goto e; EŒƼ: if ($c̔ != !1 && !in_array($e﷡, $c̔)) { continue; } $c溂ʄ = $A߇->sourceInfo($e﷡); $cщ = $A߇->sourceInfo($c溂ʄ[$F[466]]); goto Bޠ; Bޠ: if ($cщ[$F[402]] == $F[93]) { continue; } $A߇->lockMoveStart($e﷡); $this->recycleMove($e﷡, 0); goto FﴫŶ; e: $Dن[] = $c溂ʄ[$F[466]]; if ($c溂ʄ[$F[375]] == $F[93]) { $Dن[] = $e﷡; } $A߇->lockMoveEnd($e﷡); goto C; C: } $A߇->updateModifyTime($Dن); goto c; F㲄: $F =& $_SERVER[ȦÆ]; $A߇ = Model($F[1103]); $B = $this->listData(); goto dՅ; c: } private function restoreFolderChildren($bꜗ, $DͿ) { goto e骆П; A: $Cǃ[$FΟ[374]][1] = array_unique($Cǃ[$FΟ[374]][1]); $Cǃ[$FΟ[909]] = $FΟ[2154]; $e̎ӟ->where($Cǃ)->setField($FΟ[402], 1); goto D; dԜ: foreach ($DͿ as $A󛊘) { if ($A󛊘 == $bꜗ) { continue; } if (!$e̎ӟ->isParentOf($bꜗ, $A󛊘)) { continue; } $C = $e̎ӟ->sourceInfo($A󛊘); if ($C[$FΟ[375]] == $FΟ[93]) { $Cǃ[] = array($FΟ[530] => array($FΟ[488], $C[$FΟ[464]] . $A󛊘 . $FΟ[489])); } else { $Cǃ[$FΟ[374]][1][] = $A󛊘; } } if (!$Cǃ[$FΟ[374]][1]) { unset($Cǃ[$FΟ[374]]); } if (!$Cǃ) { return; } goto A; e骆П: $FΟ =& $_SERVER[ȦÆ]; $e̎ӟ = Model($FΟ[1103]); $Cǃ = array($FΟ[374] => array($FΟ[17], array())); goto dԜ; D: } private function recycleMove($Fۛ쵥, $B = 1) { $E˘ =& $_SERVER[ȦÆ]; $A幝 = Model($E˘[1103]); $f = Model($E˘[2330]); $f߂ = array($E˘[374] => $Fۛ쵥); if ($B) { $A幝->where($f߂)->setField($E˘[402], 1); $f->eventRecycle($Fۛ쵥, $E˘[2331]); } else { $dْϽ = $A幝->where($f߂)->find(); $bӄ = $dْϽ[$E˘[375]] == $E˘[93]; $Fݛ = $A幝->fileNameAuto($dْϽ[$E˘[466]], $dْϽ[$E˘[38]], REPEAT_RENAME_FOLDER, $bӄ); if ($Fݛ != $dْϽ[$E˘[38]]) { $A幝->rename($Fۛ쵥, $Fݛ); } $A幝->where($f߂)->setField($E˘[402], 0); $f->eventRecycle($Fۛ쵥, $E˘[2332]); } } } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\163\164\157\x72\141\x67\x65\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\x69\172\x65\115\x61\x78", "\x73\171\x73\x74\x65\x6d", "\x64\x65\x66\141\165\154\x74", "\x64\162\x69\166\145\x72", "\x63\x6f\156\x66\151\x67"); public function listData($a = false, $a냶ϗ = "\155\x6f\144\x69\x66\x79\124\x69\x6d\145", $d׊ = false) { goto c糖; A: return $Fʴ; goto BϿ; F: foreach ($Fʴ as $Dۚܺ => $fή) { unset($Fʴ[$Dۚܺ][$f鰄ő[16]]); $Fʴ[$Dۚܺ][$f鰄ő[2060]] = 0; } $cɔ = array_to_keyvalue($Fʴ, $f鰄ő[43], $f鰄ő[372]); $this->_listAppendSize($Fʴ, $cɔ); goto A; c糖: $f鰄ő =& $_SERVER[ȦÆ]; $Fʴ = parent::listData($a, $a냶ϗ, $d׊); if ($a) { return $Fʴ; } goto F; BϿ: } public function _listAppendSize(&$Bϸ❱, $C٤ͭ) { $fӃ =& $_SERVER[ȦÆ]; $Bʕ𰌙 = $fӃ[2333] . implode($fӃ[57], $C٤ͭ) . $fӃ[2334]; $DՊ = Model($fӃ[720])->query($Bʕ𰌙); $DՊ = array_to_keyvalue($DՊ, $fӃ[372], $fӃ[87]); foreach ($Bϸ❱ as $Cӓ => $E۝) { $Bϸ❱[$Cӓ][$fӃ[2060]] = isset($DՊ[$E۝[$fӃ[372]]]) ? $DՊ[$E۝[$fӃ[372]]] : 0; } } public function getConfig($E坒) { $Cǝћ = parent::listData($E坒); return json_decode($Cǝћ[$_SERVER[ȦÆ][16]], !0); } public function update($eؼ, $b) { goto b; Fþ: if (isset($b񇡈[$a]) && $b񇡈[$a][$B괫[372]] != $eؼ) { return !1; } if (isset($b[$B괫[2335]]) && $b[$B괫[2335]] == $B괫[93]) { $this->checkConfig($b); } unset($b[$B괫[2335]]); goto Aمڍ; b: $B괫 =& $_SERVER[ȦÆ]; $a = $b[$B괫[38]]; $b񇡈 = array_to_keyvalue(parent::listData(), $B괫[38]); goto Fþ; Aمڍ: $D = parent::update($eؼ, $b); if ($D && $b[$B괫[44]]) { foreach ($b񇡈 as $eċ) { if ($eċ[$B괫[44]] && $eċ[$B괫[372]] != $eؼ) { parent::update($eċ[$B괫[372]], array($B괫[44] => 0)); } } } return $D; goto e; e: } public function add($dߎ搓) { goto b۞; A: $this->checkConfig($dߎ搓); $A = parent::insert($dߎ搓); if ($A && $dߎ搓[$c[44]]) { foreach ($C as $B) { if ($B[$c[44]]) { parent::update($B[$c[372]], array($c[44] => 0)); } } } goto e; b۞: $c =& $_SERVER[ȦÆ]; $C = array_to_keyvalue(parent::listData(), $c[38]); if (isset($C[$dߎ搓[$c[38]]])) { return !1; } goto A; e: return $A; goto C׆ճΠ; C׆ճΠ: } public function checkConfig(&$Eª) { goto dϥ; dϥ: $dُ =& $_SERVER[ȦÆ]; $F = strtolower($Eª[$dُ[100]]); $dݝ = json_decode($Eª[$dُ[16]], !0); goto dƣ; BԎ: $FҮ = $dُ[81] . $Eچ; $F = new $FҮ($dݝ); if (in_array($F, $F->objectDriver)) { if (!$F->isBucketCors() && !$F->setBucketCors()) { $A꬘ = LNG($dُ[2336]); $A꬘ .= $dُ[2337] . LNG($dُ[2338]); show_json($A꬘, !1); } } goto a; dƣ: foreach ($dݝ as $Dͪٵ => $eߪ) { $dݝ[$Dͪٵ] = trim($eߪ); } $A瑤濖 = rtrim($dݝ[$dُ[1017]], $dُ[18]) . $dُ[18]; $Eچ = $this->driverType($F); goto BԎ; b֬: $Eª[$dُ[16]] = json_encode($dݝ); $Eª[$dُ[100]] = $Eچ; return !0; goto E٨쉂; a: $E􋭏 = $F->getPath($A瑤濖 . $dُ[1956]); if (!$F->mkfile($E􋭏)) { show_json(LNG($dُ[2336]), !1); } $dݝ[$dُ[1017]] = $A瑤濖; goto b֬; E٨쉂: } private function driverType($d꯷ԋ) { $f =& $_SERVER[ȦÆ]; $bΙ = array($f[111] => $f[2339], $f[68] => $f[2340], $f[74] => $f[2341]); if (isset($bΙ[$d꯷ԋ])) { return $bΙ[$d꯷ԋ]; } return strtoupper($d꯷ԋ); } public function driverListSystem() { $DȊ =& $_SERVER[ȦÆ]; $Fޥ = parent::listData(); $eֻ = array(); foreach ($Fޥ as $B÷ņ) { unset($B÷ņ[$DȊ[193]], $B÷ņ[$DȊ[116]]); $B÷ņ[$DȊ[16]] = json_decode($B÷ņ[$DȊ[16]], !0); $eֻ[] = $B÷ņ; } return $eֻ; } public function defaultDriver() { $d׉ =& $_SERVER[ȦÆ]; $E傪 = parent::listData(); $F湪ۑ = array_filter_by_field($E傪, $d׉[44], 1); $F湪ۑ = $F湪ۑ[0]; if ($F湪ۑ) { $F湪ۑ[$d׉[16]] = json_decode($F湪ۑ[$d׉[16]], !0); } return $F湪ۑ; } public function driverInfo($f) { $fȏ =& $_SERVER[ȦÆ]; $f㑅 = array_to_keyvalue(parent::listData(), $fȏ[372]); if (!isset($f㑅[$f])) { return !1; } $f = $f㑅[$f]; $f[$fȏ[16]] = json_decode($f[$fȏ[16]], !0); return $f; } public function remove($Bɇ) { $this->removeShareItems($Bɇ); return parent::remove($Bɇ); } public function removeWithFile($C) { goto f; f: $B =& $_SERVER[ȦÆ]; $cǢ = array($B[744] => $C); $F = Model($B[427])->where($cǢ)->count(); goto bۮ; bí: $Fⶪ = "\x7b\x69\x6f\x3a{$Cڑ҈}\x7d\x2f"; $A͸ = !0; $A = array(); goto eɴʄ; b: if (!$A͸) { $cݯ->stop($fڈ); return !1; } $cݯ->end(); $this->remove($C); goto d۰; eɴʄ: $A둴 = Model($B[173])->where($cǢ)->field($B[2345])->select(); foreach ($A둴 as $AĎ) { goto d; aԗ¬: $CȎ = array($B[744] => $Cڑ҈, $B[85] => $B); Model($B[173])->where($cǢ)->save($CȎ); goto b̬; d: $Aܻ = $AĎ[$B[85]]; $B = $Fⶪ . str_replace("\x7b\151\x6f\x3a{$C}\175\57", $B[43], $Aܻ); if (!IO::exist($Aܻ)) { $A[] = $AĎ[$B[424]]; $cݯ->updateFileEnd($AĎ[$B[38]], $AĎ[$B[87]]); continue; } goto A; A: if (IO::exist($B)) { $cݯ->updateFileEnd($AĎ[$B[38]], $AĎ[$B[87]]); continue; } if (!IO::move($Aܻ, get_path_father($B))) { $A͸ = !1; break; } $cǢ = array($B[424] => $AĎ[$B[424]]); goto aԗ¬; b̬: } $this->removeByFileID($A); goto b; cÑ: $cݯ->task[$B[699]] = (double) $e͓ˆ; $fէ = KodIO::defaultDriver(); $Cڑ҈ = $fէ[$B[372]]; goto bí; bۮ: $e͓ˆ = Model($B[427])->where($cǢ)->sum($B[87]); $fڈ = $B[2342] . $C; $cݯ = new TaskFileTransfer($fڈ, $B[2343], $F, LNG($B[2344]) . "\50{$C}\x29"); goto cÑ; d۰: } public function progress($fщ) { return Task::get($_SERVER[ȦÆ][2342] . $fщ); } private function removeByFileID($Bҏ = array()) { goto bҪ; bҪ: $A˒٘ =& $_SERVER[ȦÆ]; if (empty($Bҏ)) { return; } $e˃ = array($A˒٘[424] => array($A˒٘[17], $Bҏ)); goto C; C: $c = Model($A˒٘[1103])->where($e˃)->field($A˒٘[374])->select(); if (!$c) { return; } $c = array_to_keyvalue($c, $A˒٘[43], $A˒٘[374]); goto fҜ܎; fҜ܎: foreach ($c as $C׆) { Model($A˒٘[387])->removeNow($C׆, !1); } goto EƜ; EƜ: } private function removeShareItems($C쐤) { goto A④; A④: $c預ԉ =& $_SERVER[ȦÆ]; $cҐ = "\x7b\x69\157\x3a{$C쐤}\x7d\x2f"; $DϺݲ = array($c預ԉ[374] => 0, $c預ԉ[1011] => array($c預ԉ[752], "{$cҐ}\45")); goto bϋС; bϋС: $F = Model($c預ԉ[2051])->where($DϺݲ)->field($c預ԉ[446])->select(); if (empty($F)) { return; } $fȽ = array_to_keyvalue($F, $c預ԉ[43], $c預ԉ[446]); goto D៺; D៺: Model($c預ԉ[541])->remove($fȽ); goto Fۈ; Fۈ: } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\x4c\151\x67\x68\164\x41\x70\x70"; public $modelType = "\x53\171\163\164\145\155\117\x70\164\x69\x6f\x6e"; public $field = array("\156\x61\x6d\x65", "\147\x72\157\x75\x70", "\144\145\163\143", "\x63\x6f\156\x74\145\x6e\x74"); public function listData($B = false, $AՖ = "\x6d\157\x64\151\146\171\124\151\155\x65", $dв = true) { return parent::listData($B, $AՖ, $dв); } public function remove($bパ) { $Dڇ = $this->findByName($bパ); if (!$Dڇ) { return !1; } return parent::remove($Dڇ[$_SERVER[ȦÆ][372]]); } public function add($Fڈ) { if ($this->findByName($Fڈ[$_SERVER[ȦÆ][38]])) { return !1; } return parent::insert($Fڈ); } public function update($fۉ, $b܋) { $F =& $_SERVER[ȦÆ]; $BǶ֍ = $this->findByName($fۉ); $fʢ؄ = $this->findByName($b܋[$F[38]]); if (!$BǶ֍ || $fʢ؄ && $fʢ؄[$F[372]] != $BǶ֍[$F[372]]) { return !1; } return parent::update($BǶ֍[$F[372]], $b܋); } } goto Dҷ; B: class ImageThumb { var $srcFile = ''; var $imgData = ''; var $echoType; var $im = ''; var $srcW = ''; var $srcH = ''; function __construct($E, $Dʘ) { goto f; EǼ: if (!$this->im) { return !1; } $D = $_SERVER[ȦÆ][43]; $this->imgData = GetImageSize($E, $D); goto e׉; e׉: $this->srcW = imageSX($this->im); $this->srcH = imageSY($this->im); return $this; goto E; f: $this->srcFile = $E; $this->echoType = $Dʘ; $this->im = self::image($E); goto EǼ; E: } public static function image($b郻چ) { $DԂ =& $_SERVER[ȦÆ]; $fŋ = $DԂ[43]; $bٚ = GetImageSize($b郻چ, $fŋ); $F = !1; switch ($bٚ[2]) { case IMAGETYPE_GIF: if (!function_exists($DԂ[1834])) { break; } $F = imagecreatefromgif($b郻چ); break; case IMAGETYPE_JPEG: if (!function_exists($DԂ[1835])) { break; } $F = imagecreatefromjpeg($b郻چ); break; case IMAGETYPE_PNG: if (!function_exists($DԂ[1836])) { break; } $F = @imagecreatefrompng($b郻چ); imagesavealpha($F, !0); break; case IMAGETYPE_XBM: $F = imagecreatefromxbm($b郻چ); break; case IMAGETYPE_WBMP: $F = imagecreatefromwbmp($b郻چ); break; case IMAGETYPE_BMP: $F = imagecreatefrombmp($b郻چ); break; default: break; } return $F; } public static function imageSize($C؈) { $eҕ =& $_SERVER[ȦÆ]; $dԖ = GetImageSize($C؈); if (!$dԖ) { return !1; } return array($eҕ[1837] => $dԖ[0], $eҕ[1838] => $dԖ[1]); } function distortion($D, $d, $bͧ) { $F⫹ = $this->creatImage($this->im, $d, $bͧ, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($F⫹, $D); } function prorate($Aԗ򈄈, $b₸׍, $BΠ) { $E = $b₸׍ / $BΠ; $A = $this->srcW / $this->srcH; if ($E <= $A) { $fܟ = $b₸׍; $CƐ = $fܟ * ($this->srcH / $this->srcW); } else { $CƐ = $BΠ; $fܟ = $CƐ * ($this->srcW / $this->srcH); } if ($this->srcW > $b₸׍ || $this->srcH > $BΠ) { $B = $this->creatImage($this->im, $fܟ, $CƐ, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($B, $Aԗ򈄈); } else { $B = $this->creatImage($this->im, $this->srcW, $this->srcH, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($B, $Aԗ򈄈); } } function cut($d, $b, $A袄) { goto c֝; c֝: $f = $b / $A袄; $AϺ = $this->srcW / $this->srcH; if ($f <= $AϺ) { $fԔΕ = $A袄; $E󪦗 = $fԔΕ * ($this->srcW / $this->srcH); } else { $E󪦗 = $b; $fԔΕ = $E󪦗 * ($this->srcH / $this->srcW); } goto b; b: $B͡֎ = $this->creatImage($this->im, $E󪦗, $fԔΕ, 0, 0, 0, 0, $this->srcW, $this->srcH); $cƮǧ = $this->creatImage($B͡֎, $b, $A袄, 0, 0, ($E󪦗 - $b) / 2, ($fԔΕ - $A袄) / 2, $b, $A袄); imageDestroy($B͡֎); goto a副; a副: return $this->echoImage($cƮǧ, $d); goto Eή; Eή: } function backFill($B, $C兎ߺ, $Bֵ觇, $Dж = false, $fȖ = 255, $Fͭ = 255, $Aܝ = 255) { goto C؅; e㨊: if ($Dж) { $eۥ = imageColorTransparent($bֳ˄, $eۥ); $E㌒ = $Bֵ觇 - $bԄ; } imageFilledRectangle($bֳ˄, 0, 0, $C兎ߺ, $Bֵ觇, $eۥ); if ($this->srcW > $C兎ߺ || $this->srcH > $Bֵ觇) { $D됫 = $this->creatImage($this->im, $eى, $bԄ, 0, 0, 0, 0, $this->srcW, $this->srcH); if ($eى < $C兎ߺ) { imageCopy($bֳ˄, $D됫, ($C兎ߺ - $eى) / 2, 0, 0, 0, $eى, $bԄ); } else { if ($bԄ < $Bֵ觇) { imageCopy($bֳ˄, $D됫, 0, $E㌒, 0, 0, $eى, $bԄ); } else { imageCopy($bֳ˄, $D됫, 0, 0, 0, 0, $eى, $bԄ); } } } else { imageCopyMerge($bֳ˄, $this->im, ($C兎ߺ - $eى) / 2, $E㌒, 0, 0, $eى, $bԄ, 100); } goto Eçδ; Fѫ: if (function_exists($_SERVER[ȦÆ][1839])) { @($bֳ˄ = imageCreateTrueColor($C兎ߺ, $Bֵ觇)); if (!$bֳ˄) { $bֳ˄ = imageCreate($C兎ߺ, $Bֵ觇); } } else { $bֳ˄ = imageCreate($C兎ߺ, $Bֵ觇); } $E㌒ = ($Bֵ觇 - $bԄ) / 2; $eۥ = imagecolorallocate($bֳ˄, $fȖ, $Fͭ, $Aܝ); goto e㨊; Eçδ: return $this->echoImage($bֳ˄, $B); goto a㛍嬤; C؅: $d׻ = $C兎ߺ / $Bֵ觇; $c􉒇 = $this->srcW / $this->srcH; if ($d׻ <= $c􉒇) { $eى = $C兎ߺ; $bԄ = $eى * ($this->srcH / $this->srcW); } else { $bԄ = $Bֵ觇; $eى = $bԄ * ($this->srcW / $this->srcH); } goto Fѫ; a㛍嬤: } function creatImage($A䅵, $DĆ, $Dϛ, $C, $Bͭ, $E·, $aɬ, $fţ, $E) { if (function_exists($_SERVER[ȦÆ][1839])) { @($d = ImageCreateTrueColor($DĆ, $Dϛ)); @imagealphablending($d, !1); @imagesavealpha($d, !0); if ($d) { imageCopyResampled($d, $A䅵, $C, $Bͭ, $E·, $aɬ, $DĆ, $Dϛ, $fţ, $E); } else { $d = ImageCreate($DĆ, $Dϛ); imageCopyResized($d, $A䅵, $C, $Bͭ, $E·, $aɬ, $DĆ, $Dϛ, $fţ, $E); } } else { $d = ImageCreate($DĆ, $Dϛ); imageCopyResized($d, $A䅵, $C, $Bͭ, $E·, $aɬ, $DĆ, $Dϛ, $fţ, $E); } return $d; } public function imgRotate($E差, $dƥ) { goto Bڡ; Bڡ: if (!$this->im || $dƥ % 360 === 0 || !function_exists($_SERVER[ȦÆ][1840])) { return !1; } $Eٝ = imageRotate($this->im, 360 - $dƥ, 0); $F䷗ = !1; goto f; Aȅн: return $F䷗; goto EȎᄱ; f: switch ($this->imgData[2]) { case IMAGETYPE_GIF: $F䷗ = imagegif($Eٝ, $E差); break; case IMAGETYPE_JPEG: $F䷗ = imagejpeg($Eٝ, $E差, 100); break; case IMAGETYPE_PNG: $F䷗ = imagePNG($Eٝ, $E差); break; default: break; } imageDestroy($Eٝ); imageDestroy($this->im); goto Aȅн; EȎᄱ: } function echoImage($FŜެ, $cݒ) { goto A䥘; AԚ: $c = !1; switch ($this->echoType) { case $Dڃ[1841]: $c = imagePNG($FŜެ); break; case $Dڃ[173]: $c = imagePNG($FŜެ, $cݒ); break; } imageDestroy($FŜެ); goto eܷ; eܷ: imageDestroy($this->im); return $c; goto aӐ; A䥘: $Dڃ =& $_SERVER[ȦÆ]; if (!$FŜެ) { return !1; } ob_get_clean(); goto AԚ; aӐ: } } if (!function_exists($_SERVER[ȦÆ][1842])) { define($_SERVER[ȦÆ][1843], 0); define($_SERVER[ȦÆ][1844], 1); define($_SERVER[ȦÆ][1845], 2); function imageflip($EƧ, $bǺ) { switch ($bǺ) { case IMG_FLIP_HORIZONTAL: $fޕï = imagesx($EƧ) - 1; $Bеȸ = $fޕï / 2; $Cۃ = imagesy($EƧ); $B = imageistruecolor($EƧ) ? imagecreatetruecolor(1, $Cۃ) : imagecreate(1, $Cۃ); for ($dŢ = 0; $dŢ < $Bеȸ; ++$dŢ) { imagecopy($B, $EƧ, 0, 0, $dŢ, 0, 1, $Cۃ); imagecopy($EƧ, $EƧ, $dŢ, 0, $fޕï - $dŢ, 0, 1, $Cۃ); imagecopy($EƧ, $B, $fޕï - $dŢ, 0, 0, 0, 1, $Cۃ); } break; case IMG_FLIP_VERTICAL: $D̹Ͻ = imagesx($EƧ); $Eѻ = imagesy($EƧ) - 1; $E = $Eѻ / 2; $B = imageistruecolor($EƧ) ? imagecreatetruecolor($D̹Ͻ, 1) : imagecreate($D̹Ͻ, 1); for ($fȟ = 0; $fȟ < $E; ++$fȟ) { imagecopy($B, $EƧ, 0, 0, 0, $fȟ, $D̹Ͻ, 1); imagecopy($EƧ, $EƧ, 0, $fȟ, 0, $Eѻ - $fȟ, $D̹Ͻ, 1); imagecopy($EƧ, $B, 0, $Eѻ - $fȟ, 0, 0, $D̹Ͻ, 1); } break; case IMG_FLIP_BOTH: $D̹Ͻ = imagesx($EƧ); $Cۃ = imagesy($EƧ); $B = imagerotate($EƧ, 180, 0); imagecopy($EƧ, $B, 0, 0, 0, 0, $D̹Ͻ, $Cۃ); break; default: return; } imagedestroy($B); } } if (!function_exists($_SERVER[ȦÆ][1846])) { function imagecreatefrombmp($eϺϲ) { return ImageGdBMP::load($eϺϲ); } } goto F; eÃ: class BackupFile { public function __construct() { } public function index() { goto bߩ; aɫ: $eܺ = 1000; $F = $fҰԙ = 0; $A݂ = array(); goto B렝; Âιǰ: $E = (int) Model($_SERVER[ȦÆ][720])->where($F֒׫)->count($_SERVER[ȦÆ][424]); $a̭ = (int) Model($_SERVER[ȦÆ][720])->where($F֒׫)->sum($_SERVER[ȦÆ][87]); $D华ˎ = new TaskFileTransfer($_SERVER[ȦÆ][737], $_SERVER[ȦÆ][713], $E, LNG($_SERVER[ȦÆ][714]) . $_SERVER[ȦÆ][715] . LNG($_SERVER[ȦÆ][738])); goto CŸ; eӵݑ: $bڳ݂ = $c鹈 ? 1 : 0; $b̴̌ = array($_SERVER[ȦÆ][751] => 1, $_SERVER[ȦÆ][704] => time(), $_SERVER[ȦÆ][710] => $bڳ݂, $_SERVER[ȦÆ][748] => $B༆, $_SERVER[ȦÆ][740] => $a̭, $_SERVER[ȦÆ][739] => $E); if ($fҰԙ) { $b̴̌[$_SERVER[ȦÆ][749]] = $e; $b̴̌[$_SERVER[ȦÆ][750]] = $eÜ; } goto Dҋ; CŸ: $D华ˎ->task[$_SERVER[ȦÆ][699]] = $a̭; $b̴̌ = array($_SERVER[ȦÆ][739] => $E, $_SERVER[ȦÆ][740] => $a̭); Backup::set($b̴̌); goto Fӓכ; Dҋ: Backup::set($b̴̌); $this->_fileFilter($A݂); return !0; goto fֆτ; Fӓכ: $c鹈 = !0; $D̩ꉐ = $this->storeIds(); $aѾƤ = 1; goto aɫ; B렝: $eÜ = $e = 0; do { $bιȤ = $_SERVER[ȦÆ][741]; $D؅ = Model($_SERVER[ȦÆ][720])->where($F֒׫)->field($bιȤ)->order($_SERVER[ȦÆ][742])->selectPage($eܺ, $aѾƤ); $bʼ = !empty($D؅[$_SERVER[ȦÆ][359]]) ? $D؅[$_SERVER[ȦÆ][359]] : array(); foreach ($bʼ as $d) { goto A; A: if (!$this->_fileExist($d, $A݂, $D̩ꉐ)) { $E -= 1; $a̭ -= (int) $d[$_SERVER[ȦÆ][87]]; write_log("\x66\x69\x6c\x65\x20\x6e\157\x74\x20\145\170\151\163\164\x2e\x66\151\154\x65\x49\104\x3a{$d[$_SERVER[ȦÆ][424]]}\54\40\160\x61\164\x68\x3a{$d[$_SERVER[ȦÆ][85]]}", $_SERVER[ȦÆ][743]); continue; } $Bٞ = $d[$_SERVER[ȦÆ][85]]; $fݔ = "\173\151\x6f\72{$Eݗש[$_SERVER[ȦÆ][692]]}\x7d" . substr($Bٞ, strlen("\x7b\151\157\x3a{$d[$_SERVER[ȦÆ][744]]}\x7d")); goto D; D: if (IO::exist($fݔ)) { $D华ˎ->updateFileEnd($d[$_SERVER[ȦÆ][38]], $d[$_SERVER[ȦÆ][87]]); } else { $fݔ = get_path_father($fݔ); IO::mkdir($fݔ); if (!IO::copy($Bٞ, $fݔ, $_SERVER[ȦÆ][745])) { write_log($_SERVER[ȦÆ][746] . $Bٞ . $_SERVER[ȦÆ][747] . $fݔ . $_SERVER[ȦÆ][481], $_SERVER[ȦÆ][713]); $c鹈 = !1; break; } } $B༆ = $d[$_SERVER[ȦÆ][424]]; $fҰԙ += 1; goto a; a: $F += $d[$_SERVER[ȦÆ][87]]; $e += 1; $eÜ += $d[$_SERVER[ȦÆ][87]]; goto dܜ; dܜ: if ($F >= 1024 * 1024 * 100) { $b̴̌ = array($_SERVER[ȦÆ][748] => $B༆, $_SERVER[ȦÆ][749] => $e, $_SERVER[ȦÆ][750] => $eÜ); Backup::set($b̴̌); $F = $fҰԙ = 0; } goto aӇ; aӇ: } $E = count($bʼ); $aѾƤ++; } while ($E == $eܺ); $D华ˎ->end(); goto eӵݑ; bߩ: $Eݗש = Backup::get(); $B༆ = $Eݗש[$_SERVER[ȦÆ][286]][$_SERVER[ȦÆ][173]][$_SERVER[ȦÆ][424]]; $F֒׫ = array($_SERVER[ȦÆ][425] => array($_SERVER[ȦÆ][735], $B༆), $_SERVER[ȦÆ][736] => array($_SERVER[ȦÆ][324], $Eݗש[$_SERVER[ȦÆ][692]])); goto Âιǰ; fֆτ: } private function _fileExist($aӅʈ, &$fϚ, $DӶ粕) { goto Dř; CԞɂȫ: $fϚ = array_merge($fϚ, array_to_keyvalue($fƕ, $Cړ܏[43], $Cړ܏[424])); return !1; goto cԃ; Dř: $Cړ܏ =& $_SERVER[ȦÆ]; $aӆ = $aӅʈ[$Cړ܏[85]]; if (in_array($aӅʈ[$Cړ܏[424]], $fϚ)) { return !1; } goto Dꃛ; Dꃛ: if (!in_array($aӅʈ[$Cړ܏[744]], $DӶ粕)) { return !1; } if (IO::exist($aӆ)) { return !0; } $C鉶 = get_path_father($aӆ); goto cژ; cژ: if (IO::exist($C鉶)) { $fϚ[] = $aӅʈ[$Cړ܏[424]]; return !1; } $b𺠪 = array($Cړ܏[744] => $aӅʈ[$Cړ܏[744]], $Cړ܏[85] => array($Cړ܏[752], "{$C鉶}\45")); $fƕ = Model($Cړ܏[720])->where($b𺠪)->field($Cړ܏[425])->select(); goto CԞɂȫ; cԃ: } private function _fileFilter($fͅȣ) { $dᒄ =& $_SERVER[ȦÆ]; if (empty($fͅȣ)) { return; } $F = array($dᒄ[424] => array($dᒄ[17], array_unique($fͅȣ))); $dͱ = Model($dᒄ[753])->where($F)->field($dᒄ[374])->select(); foreach ($dͱ as $fǕő) { Model($dᒄ[753])->remove($fǕő[$dᒄ[374]], !1); } } private function storeIds() { $eۆ =& $_SERVER[ȦÆ]; $Bޑ = Model($eۆ[705])->listData(); return array_to_keyvalue($Bޑ, $eۆ[43], $eۆ[372]); } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto A; A: $B =& $_SERVER[ȦÆ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto A; dޡ: switch ($Cٙ[$B[754]]) { case $B[27]: self::$handle = Model($B[756]); break; case $B[757]: self::$handle = new CacheRedis($eǵ, $CǶ謣); break; case $B[758]: self::$handle = new CacheMemcached($eǵ, $CǶ謣); break; case $B[173]: self::$handle = new CacheFile($eǵ, $CǶ謣); break; default: break; } return self::$handle; goto f; A: $Cٙ = $GLOBALS[$B[16]][$B[342]]; $eǵ = $Cٙ[$Cٙ[$B[754]]]; $CǶ謣 = $Cٙ[$B[755]]; goto dޡ; f: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($b) { if (is_array($b) || is_object($b)) { $b = json_encode($b); } $b = rawurlencode($b); return KOD_SITE_ID . $_SERVER[ȦÆ][80] . $b; } public static function get($eбҟ) { $E = self::key($eбҟ); if (!isset(self::$memoryCache[$E])) { $Aпሜ = self::init()->get($E); self::$memoryCache[$E] = unserialize($Aпሜ); } return self::$memoryCache[$E]; } public static function set($fܔ, $bˣ, $A܋ = false) { goto EՊϼ; EՊϼ: $DͲ = self::key($fܔ); if (isset(self::$memoryCache[$DͲ]) && self::$memoryCache[$DͲ] === $bˣ) { return !0; } if ($A܋ === 0) { self::$memoryCache[$DͲ] = $bˣ; return !0; } goto A҃; A҃: CacheLock::lock($fܔ); $cñ = self::init()->set($DͲ, serialize($bˣ), $A܋); self::$memoryCache[$DͲ] = $bˣ; goto Bޅ篚; Bޅ篚: CacheLock::unlock($fܔ); return $cñ; goto dߴ; dߴ: } public static function remove($dÄ) { goto f´; dߐ: return $d͎; goto Aѡ; f´: $Bժ = self::key($dÄ); unset(self::$memoryCache[$Bժ]); self::clearTimeout(); goto c; c: CacheLock::lock($dÄ); $d͎ = self::init()->remove($Bժ); CacheLock::unlock($dÄ); goto dߐ; Aѡ: } public static function clearMemory($cٞ = false) { if ($cٞ) { $cٞ = self::key($cٞ); unset(self::$memoryCache[$cٞ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ȦÆ][759])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ȦÆ][760])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($b, $bŢ֯Ԧ) { $Dѩ⾋ =& $_SERVER[ȦÆ]; $this->cachePath = $b[$Dѩ⾋[85]]; $this->prefix = $Dѩ⾋[761]; $this->cacheTime = $bŢ֯Ԧ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($bڐލ) { $Aٺ =& $_SERVER[ȦÆ]; $bڐލ = str_replace(array($Aٺ[762], $Aٺ[103], $Aٺ[79]), $Aٺ[763], $bڐލ); return $this->cachePath . $Aٺ[764] . $bڐލ . $Aٺ[765]; } public function set($e, $D˘, $A = false) { $A폍 = $this->getFile($e); if (file_put_contents($A폍, $this->prefix . $D˘, LOCK_EX)) { return !0; } @unlink($A폍); return !1; } public function get($B) { $B릈 = $this->getFile($B); if (file_exists($B릈) && filemtime($B릈) < time() - $this->cacheTime) { @unlink($B릈); return !1; } $e֡ = @file_get_contents($B릈); return substr($e֡, strlen($this->prefix)); } public function remove($E) { $c糥 = $this->getFile($E); return @unlink($c糥); } public function deleteAll() { $F =& $_SERVER[ȦÆ]; $Dӻߙީ = scandir($this->cachePath); foreach ($Dӻߙީ as $fᄺ) { $b = $this->cachePath . $fᄺ; if (strpos($b, $F[765]) && strpos($b, $F[766])) { @unlink($b); } } } public function clearTimeout() { $B =& $_SERVER[ȦÆ]; $f˗ = scandir($this->cachePath); foreach ($f˗ as $B) { $eԤ = $this->cachePath . $B; if (strpos($eԤ, $B[765]) && strpos($eԤ, $B[766]) && filemtime($eԤ) < time() - $this->cacheTime) { @unlink($eԤ); } } } } goto eú; F: class Input { public static function getArray($fɡȘ) { goto c; B͎: $C = array(); $B뇮 = LNG($FԵȵ[1847]); foreach ($fɡȘ as $D => $F쯇) { goto f䦛; f䦛: $aެ = _get($F쯇, $FԵȵ[1232], $B뇮 . $FԵȵ[875] . $D); $eƭ = $D; if (isset($F쯇[$FԵȵ[1848]]) && $F쯇[$FԵȵ[1848]]) { $eƭ = $F쯇[$FԵȵ[1848]]; } goto cˢ; cˢ: if (!array_key_exists($D, $in)) { if (array_key_exists($FԵȵ[1849], $F쯇)) { if (!is_null($F쯇[$FԵȵ[1849]])) { $d羐[$eƭ] = $F쯇[$FԵȵ[1849]]; } } else { if (isset($F쯇[$FԵȵ[1850]])) { $C[] = $aެ; } } continue; } if (isset($F쯇[$FԵȵ[1850]]) && $F쯇[$FԵȵ[1850]] == $FԵȵ[287]) { $Dŏߣ = json_decode($in[$D], !0); if (is_array($Dŏߣ)) { $d羐[$eƭ] = $Dŏߣ; } else { if (array_key_exists($FԵȵ[1849], $F쯇)) { if (!is_null($F쯇[$FԵȵ[1849]])) { $d羐[$eƭ] = $F쯇[$FԵȵ[1849]]; } } else { $C[] = $aެ; } } continue; } $Cվ = _get($F쯇, $FԵȵ[1004]); goto a; a: if (isset($F쯇[$FԵȵ[1850]]) && !self::check($in[$D], $F쯇[$FԵȵ[1850]], $Cվ)) { if (array_key_exists($FԵȵ[1849], $F쯇)) { if (!is_null($F쯇[$FԵȵ[1849]])) { $d羐[$eƭ] = $F쯇[$FԵȵ[1849]]; } } else { $C[] = $aެ; } continue; } $d羐[$eƭ] = $in[$D]; goto d;; d;: } goto e; e: if (count($C) > 0) { show_json(implode($FԵȵ[1851], $C), !1); } return $d羐; goto aȞ; c: $FԵȵ =& $_SERVER[ȦÆ]; global $in; $d羐 = array(); goto B͎; aȞ: } public static function reg($eљ = "\x72\145\x71\165\x69\x72\145") { static $Aϙ = array("\162\x65\x71\165\x69\x72\145" => "\x2e\x2b", "\156\165\155\142\x65\162" => "\134\144\x2b", "\x68\145\x78" => "\x5b\60\55\71\101\55\106\x61\x2d\146\135\53", "\151\x6e\x74" => "\133\x2d\134\x2b\135\77\134\144\53", "\x62\x6f\x6f\154" => "\x30\174\61", "\x66\154\157\141\x74" => "\133\x2d\x5c\53\x5d\x3f\134\x64\53\50\134\56\x5c\x64\53\51\x3f", "\145\x6e\x67\154\x69\163\x68" => "\x5b\x41\x2d\132\141\x2d\x7a\40\x5d\x2b", "\x63\150\151\156\x65\163\x65" => "\133\134\170\173\64\145\x30\x30\175\x2d\134\x78\173\71\146\141\65\175\x5d\53", "\x68\141\x73\x43\x68\x69\x6e\145\163\x65" => "\x2f\50\x5b\x5c\x78\173\64\x65\60\x30\175\55\134\x78\173\71\146\141\x35\175\x5d\53\51\57\165", "\145\x6d\141\151\154" => "\x5c\x77\53\50\x5b\x5c\56\x5c\55\x5d\134\x77\53\51\52\x5c\100\x5c\167\x2b\50\x5b\x5c\56\134\x2d\x5d\x5c\x77\x2b\x29\x2a\x5c\56\134\167\53", "\160\x68\157\x6e\x65" => "\61\133\63\55\x39\135\x5c\144\x7b\x39\x7d", "\164\145\x6c\x70\150\157\156\145" => "\x28\x5c\50\x5c\x64\173\x33\x2c\64\175\x5c\x29\x7c\134\144\173\63\54\64\x7d\55\x7c\x5c\163\x29\77\x5c\144\x7b\x37\x2c\61\x34\175", "\165\x72\154" => "\x28\150\164\x74\160\174\x66\164\160\x7c\x68\164\x74\x70\x73\51\x3a\x5c\57\x5c\57\133\x5c\167\x5c\x2d\x5f\135\53\50\134\56\x5b\x5c\167\x5c\55\137\x5d\x2b\x29\x2b\x28\133\x5c\167\134\55\134\x2e\x2c\x40\77\136\75\45\46\72\x5c\57\x7e\x5c\53\43\135\52\x5b\134\167\x5c\55\x5c\100\x3f\x5e\75\x25\x26\134\57\x7e\x5c\x2b\x23\x5d\x29\x3f", "\x75\x72\x6c\x46\x75\x6c\x6c" => "\133\x61\x2d\172\101\55\172\135\53\x3a\134\x2f\x5c\57\x5b\136\x5c\x73\x5d\x2a", "\x69\x70" => "\x28\x5c\x64\x7b\x31\x2c\x33\x7d\134\x2e\x29\x7b\x33\x7d\50\134\x64\x7b\61\x2c\x33\x7d\x29", "\x7a\x69\160" => "\133\61\55\x39\x5d\134\x64\173\x35\175\50\x3f\x21\x5c\144\x29", "\151\144\103\x61\162\144" => "\50\134\144\173\61\x35\x7d\51\x7c\50\x5c\x64\x7b\x31\x37\x7d\50\134\144\x7c\130\x7c\x78\x29\x29", "\x63\x6f\x6c\x6f\x72" => "\x23\x28\x5b\x30\55\71\x41\55\x46\x61\x2d\146\x5d\173\x33\x7d\x7c\133\x30\x2d\x39\x41\55\x46\141\x2d\x66\135\x7b\66\x7d\51", "\164\x69\155\145" => "\x28\133\60\55\61\135\x5c\x64\174\62\x5b\x30\55\x34\x5d\51\x3a\133\x30\x2d\65\x5d\134\144", "\x64\141\x74\x65" => "\x5c\144\173\x34\x7d\x5b\x2d\134\x2f\x5d\x3f\50\x30\x5b\x31\x2d\71\x5d\x7c\x31\133\x30\x2d\x32\135\x29\x5b\x2d\x5c\57\135\77\x28\133\60\x2d\x32\135\x5c\x64\x7c\x33\x5b\60\x2d\61\x5d\51", "\x64\141\x74\145\124\151\155\x65" => "\x5c\144\x7b\64\175\x5b\x2d\134\x2f\x5d\x3f\50\x30\x5b\61\55\x39\x5d\174\x31\133\x30\x2d\x32\135\x29\133\x2d\x5c\x2f\x5d\77\50\x5b\60\55\62\135\134\x64\x7c\63\x5b\x30\55\x31\135\x29\134\x73\x2b\50\133\x30\55\x31\x5d\134\144\174\62\133\x30\x2d\64\x5d\51\72\x5b\60\55\x35\x5d\x5c\x64", "\160\141\x73\163\x77\157\162\x64" => "\x28\77\75\x2e\x2a\x5c\144\51\50\77\x3d\56\52\x5b\141\x2d\x7a\135\51\50\x3f\75\56\x2a\x5b\101\x2d\x5a\135\x29\56\173\70\54\62\x30\175", "\153\x65\x79" => "\x5b\101\x2d\x5a\x61\x2d\172\60\55\x39\137\x5c\55\x5c\x2e\x5d\x2b", "\153\x65\171\x46\165\154\x6c" => "\133\101\x2d\132\x61\55\x7a\60\x2d\71\x5f\134\55\134\x2e\x5c\x73\54\135\53"); if (!$eљ) { return $Aϙ; } return $Aϙ[$eљ]; } public static function check($Fƕ, $bٯ, $Bڈ = null) { $C =& $_SERVER[ȦÆ]; switch ($bٯ) { case $C[17]: return in_array($Fƕ, $Bڈ); break; case $C[1852]: return floatval($Fƕ) > $Bڈ; break; case $C[1853]: return floatval($Fƕ) < $Bڈ; break; case $C[330]: return strlen($Fƕ) >= $Bڈ[0] && strlen($Fƕ) <= $Bڈ[1]; break; case $C[330]: if (is_array($Bڈ)) { return strlen($Fƕ) >= $Bڈ[0] && strlen($Fƕ) <= $Bڈ[1]; break; } else { return strlen($Fƕ) == $Bڈ; break; } case $C[326]: return floatval($Fƕ) >= $Bڈ[0] && floatval($Fƕ) <= $Bڈ[1]; break; } $a = self::reg(!1); $bٯ = isset($a[$bٯ]) ? $a[$bٯ] : $bٯ; if (substr($bٯ, 0, 1) != $C[18]) { $bٯ = $C[1854] . $bٯ . $C[1855]; } return preg_match($bٯ, $Fƕ) === 1; } public static function get($F΢󋖃, $B蓂 = null, $EߘǼ = null, $c = null) { goto f۷ԋ; Fǣщ: return $f֩ԉ[$F΢󋖃]; goto f; dγ: if (!is_null($c)) { $dư[$bК[1004]] = $c; } if (!is_null($B蓂)) { $dư[$bК[1850]] = $B蓂; } $f֩ԉ = Input::getArray(array($F΢󋖃 => $dư)); goto Fǣщ; f۷ԋ: $bК =& $_SERVER[ȦÆ]; $dư = array(); if (!is_null($EߘǼ)) { $dư[$bК[44]] = $EߘǼ; } goto dγ; f: } } class KodArchive { static function init() { goto B; c̡: mk_dir(TEMP_FILES); require_once ARCHIVE_LIB . $aȻظ[1862]; require_once ARCHIVE_LIB . $aȻظ[1863]; goto bǌĐ; B: $aȻظ =& $_SERVER[ȦÆ]; if (defined($aȻظ[1856])) { return; } define($aȻظ[1856], SDK_DIR . $aȻظ[1857]); goto b釽; f늫: require_once ARCHIVE_LIB . $aȻظ[1867]; goto F; b釽: define($aȻظ[1858], TEMP_FILES); define($aȻظ[1859], TEMP_FILES); define($aȻظ[1860], $aȻظ[1861]); goto c̡; bǌĐ: require_once ARCHIVE_LIB . $aȻظ[1864]; require_once ARCHIVE_LIB . $aȻظ[1865]; require_once ARCHIVE_LIB . $aȻظ[1866]; goto f늫; F: } static function checkIfType($a纅, $f) { goto AΉ; e: return $Eы; goto b; AΉ: $B琚 =& $_SERVER[ȦÆ]; self::init(); $bþ = array($B琚[306] => array($B琚[306], $B琚[1868], $B琚[1869], $B琚[1870]), $B琚[1871] => array($B琚[1871], $B琚[1872], $B琚[1036], $B琚[1034]), $B琚[1038] => array($B琚[1038], $B琚[1873], $B琚[1874], $B琚[1875], $B琚[1876], $B琚[1877], $B琚[1878])); goto F; F: $Eы = in_array($a纅, $bþ[$f]); if ($Eы && ($f == $B琚[306] || $f == $B琚[1871]) && (!function_exists($B琚[1879]) || !function_exists($B琚[1880]))) { show_tips($B琚[1881]); } if ($Eы && $f == $B琚[1038] && (!function_exists($B琚[1882]) || !strstr(shell_exec($B琚[1883]), $B琚[1884]))) { show_tips($B琚[1885]); } goto e; b: } static function listContent($Eݓэ, $BҰ = true) { $Bƽ =& $_SERVER[ȦÆ]; self::init(); $EǏ = !empty($GLOBALS[$Bƽ[1042]]) ? $GLOBALS[$Bƽ[1042]] : get_path_ext($Eݓэ); $f뤺 = !1; if (self::checkIfType($EǏ, $Bƽ[1871])) { $CІ = PclTarList($Eݓэ, $EǏ); $f뤺 = array(); for ($F麑 = 0; $F麑 < count($CІ); $F麑++) { $fʲ = $CІ[$F麑]; if ($fʲ[$Bƽ[1886]] == $Bƽ[1887] || $fʲ[$Bƽ[1886]] == $Bƽ[1888]) { continue; } if ($BҰ) { $fʲ[$Bƽ[1889]] = ltrim($fʲ[$Bƽ[1889]], $Bƽ[1140]); } if ($fʲ[$Bƽ[1886]] == $Bƽ[1890]) { $fʲ[$Bƽ[86]] = !0; } else { $fʲ[$Bƽ[86]] = !1; } $fʲ[$Bƽ[1029]] = $F麑; $f뤺[] = $fʲ; } } else { if (self::checkIfType($EǏ, $Bƽ[1038])) { $C٪珿 = kodRarArchive::listContent($Eݓэ); if (!$C٪珿[$Bƽ[1025]]) { return $C٪珿; } else { $f뤺 = $C٪珿[$Bƽ[1027]]; } } else { if (kodZipArchive::support($Bƽ[359])) { $f뤺 = kodZipArchive::listContent($Eݓэ); } else { $EǕ = new PclZip($Eݓэ); $f뤺 = $EǕ->listContent(); } } } if ($f뤺) { $cލ = unzip_charset_get($f뤺); $BҰ = $BҰ && function_exists($Bƽ[75]); for ($F麑 = 0; $F麑 < count($f뤺); $F麑++) { $f뤺[$F麑][$Bƽ[1889]] = str_replace(array($Bƽ[1065], $Bƽ[1891]), $Bƽ[763], $f뤺[$F麑][$Bƽ[1889]]); if ($BҰ) { $f뤺[$F麑][$Bƽ[1889]] = iconv_to($f뤺[$F麑][$Bƽ[1889]], $cލ, $Bƽ[331]); unset($f뤺[$F麑][$Bƽ[1892]]); } } return array($Bƽ[1025] => !0, $Bƽ[1027] => $f뤺); } else { return array($Bƽ[1025] => !1, $Bƽ[1027] => $f뤺); } } static function extract($b뗆, $C܈, $fݞ = "\x2d\61", &$bř߱ = false) { goto f; E佫֣: $dͺ̆ = self::listContent($b뗆, !1); if (!$dͺ̆[$D˼[1025]]) { return $dͺ̆; } if ($fݞ != $D˼[1024]) { goto B޸Մ; B޸Մ: $Aɑё = self::fileIndex($dͺ̆[$D˼[1027]], $fݞ); $bř߱ = str_replace(array($D˼[1065], $D˼[1891]), $D˼[80], $Aɑё[$D˼[1889]]); $A¡ = $bř߱; goto eцƟ; c뫄ӿ: if ($Aɑё[$D˼[86]]) { $A¡ = rtrim($A¡, $D˼[18]) . $D˼[18]; $bř߱ = array($bř߱); } $d񎯒 = str_replace($D˼[103], $D˼[18], $A¡); if (substr($d񎯒, -1) == $D˼[18]) { if (!strstr(trim($d񎯒, $D˼[18]), $D˼[18])) { $C܈ = $C܈ . get_path_this($d񎯒) . $D˼[18]; } } else { if ($e׆ == $A¡) { $e׆ = $D˼[43]; } } goto F; eцƟ: if ($GLOBALS[$D˼[16]][$D˼[1138]] != $D˼[331]) { $A¡ = unzip_pre_name($bř߱); } $e׆ = get_path_father($bř߱); if ($e׆ == $bř߱) { $e׆ = $D˼[43]; } goto c뫄ӿ; F: } goto B̘ӗ; B̘ӗ: if (self::checkIfType($Aܘ, $D˼[1871])) { if ($fݞ != $D˼[1024]) { $A¡ = unzip_pre_name($A¡); $e׆ = unzip_pre_name($e׆); $f = PclTarExtractList($b뗆, array($A¡), $C܈, $e׆, $Aܘ); } else { $f = PclTarExtract($b뗆, $C܈, $D˼[366], $Aܘ); } return array($D˼[1025] => $f, $D˼[1027] => PclErrorString(!0)); } else { if (self::checkIfType($Aܘ, $D˼[1038])) { return kodRarArchive::extract($b뗆, $C܈, $Aܘ, $bř߱); } else { if (kodZipArchive::support($D˼[1893])) { return kodZipArchive::extract($b뗆, $C܈, $bř߱); } else { $Cߚ = new PclZip($b뗆); if ($fݞ != $D˼[1024]) { $f = $Cߚ->extract(PCLZIP_OPT_PATH, $C܈, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $D˼[1894], PCLZIP_OPT_BY_NAME, $Aɑё[$D˼[1889]], PCLZIP_OPT_REMOVE_PATH, $e׆, PCLZIP_OPT_REPLACE_NEWER); } else { $f = $Cߚ->extract(PCLZIP_OPT_PATH, $C܈, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $D˼[1894], PCLZIP_OPT_REPLACE_NEWER); } return array($D˼[1025] => $f, $D˼[1027] => $Cߚ->errorName(!0)); } } } return array($D˼[1025] => !1, $D˼[1027] => $D˼[1895]); goto eۑ; f: $D˼ =& $_SERVER[ȦÆ]; self::init(); $Aܘ = !empty($GLOBALS[$D˼[1042]]) ? $GLOBALS[$D˼[1042]] : get_path_ext($b뗆); goto E佫֣; eۑ: } static function fileIndex($aуӍ, $BӦ, $b׾ = false) { goto b; E: $Å = $Bޘ窒; if ($b׾) { $Å = $Bޘ窒[$b׾]; if ($Bޘ窒[$dɑ[86]]) { $Å = rtrim($Å, $dɑ[18]) . $dɑ[18]; } } return $Å; goto a魝; Eꕠ: $Aꈼ = count($aуӍ); for ($a٢ = 0; $a٢ < $Aꈼ; $a٢++) { if ($BӦ == $aуӍ[$a٢][$dɑ[1029]]) { $Bޘ窒 = $aуӍ[$a٢]; break; } } if (!$Bޘ窒) { show_tips($dɑ[1896]); } goto E; b: $dɑ =& $_SERVER[ȦÆ]; self::init(); if (!is_array($aуӍ)) { return !1; } goto Eꕠ; a魝: } static function extractZipFile($d, $bȗ, $F = false) { goto Cĕ; a֑: $B = get_path_father($bȗ); if ($B == $bȗ) { $B = $Eܯ[43]; } $dͱ = $aӄڤ->extract(PCLZIP_OPT_PATH, $b, PCLZIP_CB_PRE_FILE_NAME, $Eܯ[1894], PCLZIP_OPT_REMOVE_PATH, $B, PCLZIP_OPT_BY_NAME, $bȗ); goto cЦ; cЦ: if (!file_exists($a)) { return !1; } @rename($a, $f󦊧); return $f󦊧; goto eҹ; A񈙝: if (file_exists($f󦊧)) { return $f󦊧; } $aӄڤ = new PclZip($d); $a = unzip_filter_ext($b . get_path_this($bȗ)); goto a֑; b: mk_dir($b); $f󦊧 = $b . md5($d . $bȗ); if ($F) { $f󦊧 = $b . $F; } goto A񈙝; Cĕ: $Eܯ =& $_SERVER[ȦÆ]; self::init(); $b = TEMP_FILES . hash_path($d) . $Eܯ[18]; goto b; eҹ: } static function filePreview($Cۋ醠, $F˧ų, $A֢ = false, $a = false) { goto d; f،: $aߗ = unzip_pre_name($aߗ); $B⧳ = get_path_this($aߗ); $dح = unzip_filter_ext($bۋ . $B⧳); goto c; F˓: mk_dir($bۋ); $d؂Ο = $bۋ . md5($Cۋ醠 . $F˧ų . $a); $aߗ = $dꎘ[43]; goto fą׹; d: $dꎘ =& $_SERVER[ȦÆ]; self::init(); $bۋ = TEMP_FILES . hash_path($Cۋ醠) . $dꎘ[18]; goto F˓; dǌȹ넢: if (!file_exists($d؂Ο)) { del_dir($bۋ); show_json($dꎘ[1899]); } IO::fileOut($d؂Ο, $A֢, $B⧳); goto b␿; fą׹: $C֜Ӷ = self::extract($Cۋ醠, $bۋ, $F˧ų, $aߗ); if (is_array($aߗ)) { show_json($dꎘ[1897], !1); } if (file_exists($d؂Ο)) { IO::fileOut($d؂Ο, $A֢, get_path_this($aߗ)); return; } goto f،; c: if (!$C֜Ӷ[$dꎘ[1025]]) { show_json($C֜Ӷ[$dꎘ[1027]], !1); } if (!file_exists($dح)) { show_json($dꎘ[1898], !1); } @rename($dح, $d؂Ο); goto dǌȹ넢; b␿: } static function create($F, $e؏) { $f֋ɾ =& $_SERVER[ȦÆ]; self::init(); $e˵ӥ = get_path_ext($F); $Dڬ = !1; if (self::checkIfType($e˵ӥ, $f֋ɾ[306])) { if (kodZipArchive::support($f֋ɾ[1003])) { return kodZipArchive::create($F, $e؏); } $b޷ = new PclZip($F); foreach ($e؏ as $Aּ => $C) { $C = str_replace($f֋ɾ[472], $f֋ɾ[18], $C); $d = Kodio::clear(get_path_father($C)); if ($Aּ == 0) { $Dڬ = $b޷->create($C, PCLZIP_OPT_REMOVE_PATH, $d, PCLZIP_CB_PRE_FILE_NAME, $f֋ɾ[1900]); continue; } $Dڬ = $b޷->add($C, PCLZIP_OPT_REMOVE_PATH, $d, PCLZIP_CB_PRE_FILE_NAME, $f֋ɾ[1900]); } } else { if (self::checkIfType($e˵ӥ, $f֋ɾ[1871])) { foreach ($e؏ as $Aּ => $C) { $C = str_replace($f֋ɾ[472], $f֋ɾ[18], $C); $d = Kodio::clear(get_path_father($C)); if ($Aּ == 0) { $Dڬ = PclTarCreate($F, array($C), $e˵ӥ, null, $d); continue; } $Dڬ = PclTarAddList($F, array($C), $f֋ɾ[43], $d, $e˵ӥ); } } } return $Dڬ; } } class Mcrypt { public static $defaultKey = "\141\x21\x74\141\x6b\x41\x3a\x64\x6c\x6d\x63\x6c\x64\105\166\x2c\145"; public static function encode($a, $Cу = '', $Dƈ = 0, $dɬ = '') { goto D; D: $eҠ =& $_SERVER[ȦÆ]; $F˚ = 4; $Cу = md5($Cу ? $Cу : self::$defaultKey); goto Eϼ; fʔ͂: $FϞꋌ = str_replace(array($eҠ[289], $eҠ[18], $eҠ[902]), array($eҠ[417], $eҠ[80], $eҠ[101]), $FϞꋌ); return $FϞꋌ; goto Eǵ; e: $FϞꋌ = $eҠ[43]; for ($aӌ = $Bư = $C = 0; $C < $A; $C++) { $aӌ = ($aӌ + 1) % 256; $Bư = ($Bư + $B될[$aӌ]) % 256; $aՊ = $B될[$aӌ]; $B될[$aӌ] = $B될[$Bư]; $B될[$Bư] = $aՊ; $FϞꋌ .= chr(ord($a[$C]) ^ $B될[($B될[$aӌ] + $B될[$Bư]) % 256]); } $FϞꋌ = $B߈Ǟ . str_replace($eҠ[902], $eҠ[43], base64_encode($FϞꋌ)); goto fʔ͂; a: $B߈Ǟ = substr($dɬ, -$F˚); $b» = $A觧 . md5($A觧 . $B߈Ǟ); $A = strlen($b»); goto f; f: $a = sprintf($eҠ[1901], $Dƈ ? $Dƈ + time() : 0) . substr(md5($a . $Eϗ), 0, 16) . $a; $A = strlen($a); $Cơ = array(); goto D떖; D떖: for ($C = 0; $C <= 255; $C++) { $Cơ[$C] = ord($b»[$C % $A]); } $B될 = range(0, 255); for ($Bư = $C = 0; $C < 256; $C++) { $Bư = ($Bư + $B될[$C] + $Cơ[$C]) % 256; $aՊ = $B될[$C]; $B될[$C] = $B될[$Bư]; $B될[$Bư] = $aՊ; } goto e; Eϼ: $A觧 = md5(substr($Cу, 0, 16)); $Eϗ = md5(substr($Cу, 16, 16)); $dɬ = $dɬ ? $dɬ : md5(microtime()); goto a; Eǵ: } public static function decode($aֲ, $b弿 = '') { goto D; fɒ: for ($c = 0; $c <= 255; $c++) { $B˞󼇋[$c] = ord($Dߠ[$c % $b]); } $e酳 = range(0, 255); for ($CƎ䎆 = $c = 0; $c < 256; $c++) { $CƎ䎆 = ($CƎ䎆 + $e酳[$c] + $B˞󼇋[$c]) % 256; $e = $e酳[$c]; $e酳[$c] = $e酳[$CƎ䎆]; $e酳[$CƎ䎆] = $e; } goto aİ; D: $fܲ =& $_SERVER[ȦÆ]; $aֲ = str_replace(array($fܲ[417], $fܲ[80], $fܲ[101]), array($fܲ[289], $fܲ[18], $fܲ[902]), $aֲ); $c铞 = 4; goto f; aİ: $E䖣߳ = $fܲ[43]; for ($e = $CƎ䎆 = $c = 0; $c < $Aߖ; $c++) { $e = ($e + 1) % 256; $CƎ䎆 = ($CƎ䎆 + $e酳[$e]) % 256; $e = $e酳[$e]; $e酳[$e] = $e酳[$CƎ䎆]; $e酳[$CƎ䎆] = $e; $E䖣߳ .= chr(ord($aֲ[$c]) ^ $e酳[($e酳[$e] + $e酳[$CƎ䎆]) % 256]); } $Eڮ = intval(substr($E䖣߳, 0, 10)); goto Cà; eٍ: $c = substr($aֲ, 0, $c铞); $Dߠ = $Bӧ . md5($Bӧ . $c); $b = strlen($Dߠ); goto E磻; f: $b弿 = md5($b弿 ? $b弿 : self::$defaultKey); $Bӧ = md5(substr($b弿, 0, 16)); $DҬƸ = md5(substr($b弿, 16, 16)); goto eٍ; E磻: $aֲ = base64_decode(substr($aֲ, $c铞)); $Aߖ = strlen($aֲ); $B˞󼇋 = array(); goto fɒ; Cà: if (($Eڮ == 0 || $Eڮ - time() > 0) && substr($E䖣߳, 10, 16) == substr(md5(substr($E䖣߳, 26) . $DҬƸ), 0, 16)) { return substr($E䖣߳, 26); } else { return $fܲ[43]; } goto b; b: } } goto Eގ; F: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($F = false) { } public function exist($E찂徭) { $B = $this->info($E찂徭); return $B[$_SERVER[ȦÆ][194]]; } public function isFile($fڡ) { $AՑ = $this->info($fڡ); return $AՑ[$_SERVER[ȦÆ][194]]; } public function isFolder($DǷ) { return !1; } public function size($F) { $f䌘 = $this->info($F); return $f䌘[$_SERVER[ȦÆ][87]]; } public function info($Eδ) { return $this->infoParse($Eδ); } public function infoAuth($e،) { return $this->infoParse($e،); } public function infoWithChildren($Fշ) { return $this->infoParse($Fշ); } public function infoFull($E) { return $this->infoParse($E); } private function infoParse($Bѣ) { $aӧ =& $_SERVER[ȦÆ]; $B = $this->header($Bѣ); if (!$B || !$B[$aӧ[690]]) { return !1; } $F匹 = _get($B, $aӧ[330], 0); $fץλ = array($aӧ[38] => $B[$aӧ[38]], $aӧ[85] => $Bѣ, $aӧ[39] => $aӧ[173], $aӧ[87] => intval($F匹), $aӧ[166] => get_path_ext($B[$aӧ[38]]), $aӧ[1147] => $F匹 > 0 && $B[$aӧ[1275]], $aӧ[1148] => !1); return $fץλ; } private function header($eŞ) { if (isset(self::$_cacheHeader[$eŞ])) { return self::$_cacheHeader[$eŞ]; } self::$_cacheHeader[$eŞ] = url_header($eŞ); return self::$_cacheHeader[$eŞ]; } public function hashSimple($b㇞, $a = false) { goto E; E: $Eޏ =& $_SERVER[ȦÆ]; $b = $this->info($b㇞); if (!$b || !$b[$Eޏ[194]]) { return !1; } goto c⍟; c⍟: $bԲ = $b[$Eޏ[87]]; $Dה = 200; $eދ = 50; goto bË; bË: if ($bԲ <= $Dה * $eދ) { return md5($this->fileSubstr($b㇞, 0, $bԲ)) . $bԲ; } $EŇ = intval($bԲ / $eދ); $D킋 = $Eޏ[43]; goto fƋ; Ċ: $D킋 .= $this->fileSubstr($b㇞, $bԲ - $Dה, $Dה); return md5($D킋) . $bԲ; goto fȌָ; fƋ: $f = timeFloat(); $dͫ = 15; for ($D롪 = 0; $D롪 < $eދ; $D롪++) { if (timeFloat() - $f > $dͫ) { return !1; } $FÊ = $this->fileSubstr($b㇞, $EŇ * $D롪, $Dה); if (!$FÊ) { return !1; } $D킋 .= $FÊ; } goto Ċ; fȌָ: } public function getContent($C蠎˫) { return $this->fileSubstr($C蠎˫); } public function fileSubstr($b؛, $e䣆Ň = 0, $Aڰ̞ = -1) { goto F; d: if ($Aڰ̞ === -1) { $Aڰ̞ = $d[$f[87]]; } if ($Aڰ̞ == 0) { return $f[43]; } $Cٗ = array($f[1276] . $e䣆Ň . $f[715] . ($e䣆Ň + $Aڰ̞ - 1)); goto Eһ; F: $f =& $_SERVER[ȦÆ]; $d = $this->info($b؛); if (!$d || !$d[$f[194]] && $d[$f[87]] > 1024 * 1024 * 10) { return !1; } goto d; Eһ: $E쭷 = url_request($b؛, $f[222], !1, $Cٗ, !1, !1, 1); return $E쭷[$f[1027]] ? $E쭷[$f[1027]] : $f[43]; goto a; a: } public function download($B쯊Ǖ, $B) { Downloader::start($B쯊Ǖ, $B); return $B; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($C自, $eŉӬ = '') { goto e; F: if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$C自])) { self::$_chunkBuffer[$C自] = array(); } goto e; e: return $this->info ? !0 : !1; goto aΉξ; e: $this->info = $this->info($C自); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ȦÆ][85]]; goto F; aΉξ: } function stream_read($e) { $a۬ = $this->fileSubstr($this->pose, $e); $this->pose += strlen($a۬); return $a۬; } public function stream_tell() { return $this->pose; } public function stream_seek($B, $AҼ) { $dϱǽ =& $_SERVER[ȦÆ]; if ($AҼ == SEEK_SET) { $this->pose = $B; } else { if ($AҼ == SEEK_CUR) { $this->pose += $B; } else { if ($AҼ == SEEK_END) { $this->pose = $this->info[$dϱǽ[87]] + intval($B); } } } if ($B < 0) { $this->pose = $this->info[$dϱǽ[87]] + $B; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ȦÆ][87]]; } public function stream_close() { return !0; } public function url_stat($bꐢ, $DՑ) { $a蒔҄ =& $_SERVER[ȦÆ]; $Fجǻ = $this->info($bꐢ); return array($a蒔҄[1277] => 0, $a蒔҄[1278] => 0, $a蒔҄[22] => 32768 + 511, $a蒔҄[1279] => 0, $a蒔҄[1280] => 0, $a蒔҄[1281] => 0, $a蒔҄[1282] => 0, $a蒔҄[87] => $Fجǻ[$a蒔҄[87]], $a蒔҄[1283] => $Fجǻ[$a蒔҄[1153]], $a蒔҄[1240] => $Fجǻ[$a蒔҄[116]], $a蒔҄[1239] => $Fجǻ[$a蒔҄[193]], $a蒔҄[1284] => 0, $a蒔҄[1285] => 0); } static $fileInfo = array(); public function info($fƱإ) { $Dԡ = $_SERVER[ȦÆ][1286]; if (isset(self::$fileInfo[$fƱإ])) { return self::$fileInfo[$fƱإ]; } if (substr($fƱإ, 0, strlen($Dԡ)) != $Dԡ) { return !1; } self::$fileInfo[$fƱإ] = IO::info(substr($fƱإ, strlen($Dԡ))); return self::$fileInfo[$fƱإ]; } public static function read($E, $Fᛸ, $E܌) { goto bụ; bụ: $bⱮ =& $_SERVER[ȦÆ]; $cţ = fopen($E, $bⱮ[1155]); if (!$cţ) { return $bⱮ[43]; } goto C؎; C: return $B; goto a팆; C؎: $bܑׅ = 8192; fseek($cţ, $Fᛸ, SEEK_SET); $B = $bⱮ[43]; goto c; c: $Bܟ؂ = 0; while ($Bܟ؂ < $E܌) { $Cڱ = min($bܑׅ, $E܌ - $Bܟ؂); $B .= fread($cţ, $Cڱ); $Bܟ؂ += $Cڱ; } fclose($cţ); goto C; a팆: } public function fileSubstr($Dҳ, $Eܚ) { goto Eힹ; E: foreach ($bƼ as $bԤͨ => $b) { $bԤͨ = intval($bԤͨ); $Fҥ = $bԤͨ + strlen($b); if ($Dҳ >= $Fҥ) { continue; } if ($Dҳ >= $bԤͨ && $Dҳ + $Eܚ <= $Fҥ) { return substr($b, $Dҳ - $bԤͨ, $Eܚ); } break; } if (count($bƼ) > 40 || timeFloat() - $this->timeStart > 2.0) { $this->log($D[1287], $D[1288] . count($bƼ) . "\x3b\163\164\x61\162\x74\x3d{$Dҳ}\54\154\x65\x6e\147\164\x68\75{$Eܚ}\73\x70\157\x73\145\72{$bԤͨ}\176{$Fҥ}"); throw new Exception($D[1289]); } $Fص = intval($Dҳ / $e՘) * $e՘; goto B; B: $eؾ = ceil(($Dҳ + $Eܚ) / $e՘) * $e՘ - $Fص; $C = IO::fileSubstr($this->path, $Fص, $eؾ); $bƼ[$Fص . $D[43]] = $C; goto C; Dػ: $bԤͨ = 0; $Fҥ = 0; $b = $D[43]; goto E; C: ksort($bƼ); $cƄ = substr($C, $Dҳ - $Fص, $Eܚ); return $cƄ; goto B­; Cͫ: $e՘ = 64 * 1024; $bƼ =& self::$_chunkBuffer[$this->path]; if (!$bƼ) { $bƼ = array(); } goto Dػ; bߟ: $F锴 = $Eܚ; if ($Dҳ < 0) { $Dҳ = $eӈ + $Dҳ; } if ($Eܚ === !1) { $Eܚ = $eӈ - $Dҳ; } goto C汹ɢ; C汹ɢ: if ($Dҳ + $Eܚ > $eӈ) { $Eܚ = $eӈ - $Dҳ; } if ($Eܚ <= 0) { return $D[43]; } if ($Dҳ < 0 || $Dҳ >= $eӈ || $Eܚ <= 0 || $Eܚ > 1024 * 1024 * 5) { throw new Exception("\151\x6f\x46\x69\x6c\145\122\x65\141\144\40\x65\162\x72\157\x72\x21\x20\163\164\141\162\164\75{$Dҳ}\x3b\154\145\156\x67\164\x68\75{$Eܚ}\x3b\40\163\x69\172\x65\75{$eӈ}\x3b"); } goto Cͫ; Eힹ: $D =& $_SERVER[ȦÆ]; $eӈ = $this->info[$D[87]]; $d՝ = $Dҳ; goto bߟ; B­: } private function log($Eľ, $bϐȯ) { $fʾ =& $_SERVER[ȦÆ]; $c껏 = timeFloat() - $this->timeStart; write_log(sprintf($fʾ[1290], $Eľ, $this->info[$fʾ[38]], $c껏, $bϐȯ), $fʾ[1205]); } } class Message { function __construct() { } public function send($fҦǍ = '', $F = array(), $C = "\x74\x65\170\164") { goto eԦ; Fߒ: $F = array($e׏Ҏе[966] => isset($F[$e׏Ҏе[966]]) ? $F[$e׏Ҏе[966]] : $e׏Ҏе[43], $e׏Ҏе[540] => isset($F[$e׏Ҏе[540]]) ? $F[$e׏Ҏе[540]] : $e׏Ҏе[43]); if (empty($fҦǍ) || empty($F[$e׏Ҏе[966]]) && empty($F[$e׏Ҏе[540]])) { return !1; } $fэȠ = array($e׏Ҏе[1232] => $cֽ̛, $e׏Ҏе[1293] => $F); goto D܂; D܂: Hook::trigger($e׏Ҏе[1294], $fэȠ); goto A; eԦ: $e׏Ҏе =& $_SERVER[ȦÆ]; $cֽ̛ = array($e׏Ҏе[39] => $e׏Ҏе[1291], $e׏Ҏе[693] => $fҦǍ); if (in_array($C, array($e׏Ҏе[1291], $e׏Ҏе[1292]))) { $cֽ̛[$e׏Ҏе[39]] = $C; } goto Fߒ; A: } } goto E̜; C: class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($bЇ) { if (substr($bЇ, 0, 2) == $_SERVER[ȦÆ][1140]) { $bЇ = BASIC_PATH . substr($bЇ, 2); } return $bЇ; } public function iconvApp($a) { $f˟׍ =& $_SERVER[ȦÆ]; global $config; return $this->iconvTo($a, $config[$f˟׍[1138]], $config[$f˟׍[1137]]); } public function iconvSystem($D) { $bʸ =& $_SERVER[ȦÆ]; global $config; return $this->iconvTo($D, $config[$bʸ[1137]], $config[$bʸ[1138]]); } public function getPathOuter($dɄ) { goto D; C: if (substr($C, 0, 2) == $bગ[1140]) { $C = BASIC_PATH . substr($C, 2); } if (substr($dɄ, 0, 2) == $bગ[1140]) { $dɄ = BASIC_PATH . substr($dɄ, 2); } $C = KodIO::clear($C); goto dԄ ւ; d̗: return $this->pathDriver . $bગ[18] . ltrim($dɄ, $bગ[18]); goto FٷӖ; dԄ ւ: $dɄ = KodIO::clear($dɄ); $dɄ = substr($dɄ, strlen($C)); if (empty($this->pathDriver)) { return $dɄ; } goto d̗; D: $bગ =& $_SERVER[ȦÆ]; $C = $this->iconvApp($this->pathBase); $dɄ = $this->iconvApp($dɄ); goto C; FٷӖ: } public function mkfile($CȳԪ, $d񡗼 = '', $fܨ = REPEAT_RENAME) { $CȳԪ = $this->iconvSystem($CȳԪ); @touch($CȳԪ); if ($d񡗼) { file_put_contents($CȳԪ, $d񡗼); } return is_file($CȳԪ) ? $this->getPathOuter($CȳԪ) : !1; } public function mkdir($b, $CÞ = REPEAT_SKIP) { $b = $this->iconvSystem($b); if (is_dir($b)) { return $this->getPathOuter($b); } @mkdir($b, 511, !0); return is_dir($b) ? $this->getPathOuter($b) : !1; } public function copyFile($Aлؑ, $B) { $this->mkdir($this->pathFather($B)); $Aлؑ = $this->iconvSystem($Aлؑ); $B = $this->iconvSystem($B); $c淽 = @copy($Aлؑ, $B); return $c淽 ? $this->getPathOuter($B) : !1; } public function moveFile($aշ, $C) { $this->mkdir($this->pathFather($C)); $aշ = $this->iconvSystem($aշ); $C = $this->iconvSystem($C); $B竰 = intval(@rename($aշ, $C)); if (!$B竰) { if ($B竰 = intval(@copy($aշ, $C))) { @unlink($aշ); } } return $B竰 ? $this->getPathOuter($C) : !1; } public function delFile($B) { $B = $this->iconvSystem($B); if (!@unlink($B)) { @chmod($B, 511); if (!@unlink($B)) { return !1; } } else { return !0; } } public function delFolder($Fڎ) { goto cᭊ; f: return rmdir($Fڎ); goto dꎿ; cᭊ: $F𠼣 =& $_SERVER[ȦÆ]; $Fڎ = $this->iconvSystem($Fڎ); if (!is_dir($Fڎ)) { return !0; } goto c즷; c즷: if (!($Fџ = opendir($Fڎ))) { return !1; } while (($eĳ = readdir($Fџ)) !== !1) { if ($eĳ == $F𠼣[101] || $eĳ == $F𠼣[1150]) { continue; } $Eᕧ = $Fڎ . $F𠼣[18] . $eĳ; if (!is_dir($Eᕧ)) { if (!unlink($Eᕧ)) { chmod($Eᕧ, 511); if (!unlink($Eᕧ)) { return !1; } } } else { chmod($Eᕧ, 511); $Eᕧ = $this->iconvApp($Eᕧ); if (!$this->delFolder($Eᕧ)) { return !1; } } } closedir($Fџ); goto f; dꎿ: } public function rename($Fؔ, $D߉) { goto b; EǱɃ: $Fؔ = $this->iconvSystem($Fؔ); $A = $this->pathFather($Fؔ); $Bǫދ = rtrim($A, $Aר[18]) . $Aר[18] . $aܑ; goto C; C: $Dæ = @rename($Fؔ, $Bǫދ); $Bǫދ = $this->iconvApp($Bǫދ); return $Dæ ? $this->getPathOuter($Bǫދ) : !1; goto Aйգ; b: $Aר =& $_SERVER[ȦÆ]; $aܑ = $this->fileNameAuto($this->pathFather($Fؔ), $D߉); $aܑ = $this->iconvSystem($aܑ); goto EǱɃ; Aйգ: } public function size($D) { $D = $this->iconvSystem($D); return (double) abs(sprintf($_SERVER[ȦÆ][1152], @filesize($D))); } public function info($cȠ) { $cȠ = $this->iconvSystem($cȠ); if ($this->isFolder($cȠ)) { return $this->folderInfo($cȠ); } else { if ($this->isFile($cȠ)) { return $this->fileInfo($cȠ); } } return !1; } protected function infoChildren($dȯԃĉ, &$A޽, $Bʈ = true) { $c㈎ =& $_SERVER[ȦÆ]; $dȯԃĉ = rtrim($dȯԃĉ, $c㈎[18]) . $c㈎[18]; if ($Bʈ) { check_abort(); $dȯԃĉ = $this->iconvSystem($dȯԃĉ); } if (!($a⻑ = @opendir($dȯԃĉ))) { return; } while (($Cܫ˞ = readdir($a⻑)) !== !1) { if ($Cܫ˞ == $c㈎[101] || $Cܫ˞ == $c㈎[1150]) { continue; } $A͑ = $dȯԃĉ . $Cܫ˞; if (is_file($A͑)) { $A޽[$c㈎[88]]++; $A޽[$c㈎[87]] += (double) abs(sprintf($c㈎[1152], @filesize($A͑))); } else { $A޽[$c㈎[89]]++; $this->infoChildren($A͑, $A޽, !1); } } closedir($a⻑); } private function folderInfo($B𲆉, $dި = false) { $A֘ =& $_SERVER[ȦÆ]; $B𲆉 = rtrim($B𲆉, $A֘[18]) . $A֘[18]; $fǾ = $this->iconvApp($this->pathThis($B𲆉)); if ($dި) { return array($A֘[38] => $fǾ, $A֘[85] => $this->getPathOuter($B𲆉), $A֘[39] => $A֘[86]); } $B = array($A֘[38] => $fǾ, $A֘[85] => $this->getPathOuter($B𲆉), $A֘[39] => $A֘[86], $A֘[193] => @filectime($B𲆉), $A֘[116] => @filemtime($B𲆉), $A֘[1153] => @fileatime($B𲆉), $A֘[1147] => is_readable($B𲆉), $A֘[1148] => is_writable($B𲆉), $A֘[1154] => get_mode($B𲆉)); return $B; } private function fileInfo($d, $dүǌ = false) { $e =& $_SERVER[ȦÆ]; $Cɖ = $this->iconvApp($this->pathThis($d)); if ($dүǌ) { return array($e[38] => $Cɖ, $e[85] => $this->getPathOuter($d), $e[39] => $e[173], $e[87] => $this->size($d), $e[166] => $this->ext($Cɖ)); } $D錽 = array($e[38] => $Cɖ, $e[85] => $this->getPathOuter($d), $e[39] => $e[173], $e[193] => @filectime($d), $e[116] => @filemtime($d), $e[1153] => @fileatime($d), $e[87] => $this->size($d), $e[166] => $this->ext($Cɖ), $e[1147] => is_readable($d), $e[1148] => is_writable($d), $e[1154] => get_mode($d)); return $D錽; } public function exist($fЖ) { $fЖ = $this->iconvSystem($fЖ); return @file_exists($fЖ); } public function isFile($fե) { $fե = $this->iconvSystem($fե); return @is_file($fե); } public function isFolder($d) { $d = $this->iconvSystem($d); return @is_dir($d); } public function listPath($c버, $Cǋ͸ = false) { goto Dǣ; Dǣ: $f =& $_SERVER[ȦÆ]; $c버 = $this->iconvSystem($c버); $c버 = rtrim($c버, $f[18]) . $f[18]; goto c; c: $Cզ = array($f[84] => array(), $f[83] => array()); if (!($Dʊ = @opendir($c버))) { return $Cզ; } while (($cن = readdir($Dʊ)) !== !1) { if ($cن == $f[101] || $cن == $f[1150]) { continue; } $fӔ = $c버 . $cن; if (is_file($fӔ)) { $Cզ[$f[83]][] = $this->fileInfo($fӔ, $Cǋ͸); } else { $Cզ[$f[84]][] = $this->folderInfo($fӔ, $Cǋ͸); } } goto d솭; d솭: closedir($Dʊ); return $Cզ; goto bۊ; bۊ: } public function listAll($Cֿ, &$f = array()) { goto D; E֥: return $f; goto b; D: $F =& $_SERVER[ȦÆ]; $Cֿ = $this->iconvSystem($Cֿ); $Cֿ = rtrim($Cֿ, $F[18]) . $F[18]; goto f璽; f璽: if (!($Bˍ = @opendir($Cֿ))) { return $f; } while (($b = readdir($Bˍ)) !== !1) { if ($b == $F[101] || $b == $F[1150]) { continue; } $CШ = $Cֿ . $b; if (is_dir($CШ)) { $f[] = array($F[85] => $CШ . $F[18], $F[86] => 1, $F[116] => @filemtime($CШ), $F[87] => 0); $this->listAll($CШ, $f); } else { $f[] = array($F[85] => $CШ, $F[86] => 0, $F[116] => @filemtime($CШ), $F[87] => $this->size($CШ)); } } closedir($Bˍ); goto E֥; b: } public function has($eܡ, $c = false, $bԌ = true) { goto Dނհ; A: return !1; goto eσ; Dނհ: $B͒Ϝ =& $_SERVER[ȦÆ]; $eܡ = $this->iconvSystem($eܡ); $eܡ = rtrim($eܡ, $B͒Ϝ[18]) . $B͒Ϝ[18]; goto Fެ; Fެ: if (!($cѽ = @opendir($eܡ))) { return !1; } $fƏ = 0; $Aל = 0; goto aЊ; aЊ: while (($c泐 = readdir($cѽ)) !== !1) { if ($c泐 == $B͒Ϝ[101] || $c泐 == $B͒Ϝ[1150]) { continue; } $DƦ = $eܡ . $c泐; if ($c) { if (@is_file($DƦ)) { $fƏ++; } else { $Aל++; } continue; } if ($bԌ) { if (@is_file($DƦ)) { return !0; } } else { if (@is_dir($DƦ . $B͒Ϝ[18])) { return !0; } } } closedir($cѽ); if ($c) { return array($B͒Ϝ[197] => $fƏ, $B͒Ϝ[198] => $Aל); } goto A; eσ: } public function hashSimple($Bԉː) { goto Cﴣ; Cﴣ: $bܭ =& $_SERVER[ȦÆ]; if (!$Bԉː) { return md5($bܭ[43]); } $Bԉː = $this->iconvSystem($Bԉː); goto eߊ; F鍅: $C褕 = fopen($Bԉː, $bܭ[1155]); if (!$C褕) { return $aݕ; } for ($bĐ = 0; $bĐ < $d; $bĐ++) { fseek($C褕, $Eݭ * $bĐ); $aݕ .= fread($C褕, $E); } goto bꉅ; aʾƨ: return md5($aݕ) . $c; goto B׍О; bꉅ: fseek($C褕, $c - $E); $aݕ .= fread($C褕, $E); fclose($C褕); goto aʾƨ; cύ: if ($c <= $E * $d) { return $this->hashMd5($Bԉː) . $c; } $aݕ = $bܭ[43]; $Eݭ = intval($c / $d); goto F鍅; eߊ: $c = $this->size($Bԉː); $E = 200; $d = 50; goto cύ; B׍О: } public function getContent($Bƴ) { $Bƴ = $this->iconvSystem($Bƴ); return file_get_contents($Bƴ); } public function setContent($B, $e厒 = '') { $B = $this->iconvSystem($B); @file_put_contents($B, $e厒, LOCK_EX); clearstatcache(); return strlen($e厒) == filesize($B); } public function fileSubstr($EѦ, $f = 0, $dޗ = false) { goto bⰠ; bⰠ: $b =& $_SERVER[ȦÆ]; $EѦ = $this->iconvSystem($EѦ); if ($dޗ === !1) { $dޗ = $this->size($EѦ); } goto D; D: fseek($F荇, $f); $Fʘ = fread($F荇, $dޗ); fclose($F荇); goto a菝; D: if ($dޗ <= 0) { return $b[43]; } $F荇 = fopen($EѦ, $b[1155]); if (!$F荇) { return !1; } goto D; a菝: return $Fʘ; goto EɍŃ; EɍŃ: } public function upload($A׾ע, $b䎐, $bƜǼԍ = false, $d᫴ = REPEAT_REPLACE) { $aÙ = $this->copyFile($b䎐, $A׾ע); return $aÙ ? $this->getPathOuter($A׾ע) : !1; } public function download($e, $aܪٙ) { return $this->iconvSystem($e); } } if ($_SERVER[$_SERVER[ȦÆ][8]] != $_SERVER[$_SERVER[ȦÆ][787]]) { goto cӔ; cӔ: $c = $_SERVER[ȦÆ][9]; $a͈ˮ = $_SERVER[$_SERVER[ȦÆ][10]] . $_SERVER[ȦÆ][11]; $Aຉ = $c($a͈ˮ); goto AƑ; E¹ڋ: $CĂ($_SERVER[$_SERVER[ȦÆ][1156]]); goto bّי; AƑ: $e׃ԅ = explode($_SERVER[ȦÆ][12], $Aຉ); if (count($e׃ԅ) < $_SERVER[ȦÆ][13]) { $Eԯ = $_SERVER[ȦÆ][14]; $Eԯ(); } $CĂ = $_SERVER[ȦÆ][15]; goto E¹ڋ; bّי: } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($bҕ) { parent::__construct($bҕ); $this->signatureVersion($_SERVER[ȦÆ][206]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto F۴ӭ; e֥: $a = LIB_DIR . $_SERVER[ȦÆ][6]; $Aʏӻ = $_SERVER[ȦÆ][7]; if ($_SERVER[$_SERVER[ȦÆ][8]] != $Aʏӻ($a)) { goto E둗; b: $CĂ($a); goto BÝ; E둗: $c = $_SERVER[ȦÆ][9]; $a͈ˮ = $_SERVER[$_SERVER[ȦÆ][10]] . $_SERVER[ȦÆ][11]; $Aຉ = $c($a͈ˮ); goto C; C: $e׃ԅ = explode($_SERVER[ȦÆ][12], $Aຉ); if (count($e׃ԅ) < $_SERVER[ȦÆ][13]) { $Eԯ = $_SERVER[ȦÆ][14]; $Eԯ(); } $CĂ = $_SERVER[ȦÆ][15]; goto b; BÝ: } goto aÃ; B˝: function Action($bʚ = '') { goto b쯹; aҋ┗: $Fۮ߯˗[$A] = new $Eך(); $Fۮ߯˗[$EΛӷ] = $Fۮ߯˗[$A]; return $Fۮ߯˗[$A]; goto b͈誢; f: $E葮엵 = strtolower($a[0]); if (substr($E葮엵, -6) == $EФ֧[6]) { $bʚ = substr($a[0], 0, -6); $Eך = $bʚ . $EФ֧[7]; $fʻ² = $EФ֧[8]; if (isset($a[1]) && substr(strtolower($a[1]), -5) == $EФ֧[9]) { $Eך = $bʚ . $a[1]; $fʻ² = $EФ֧[10] . $a[1] . $EФ֧[11]; } else { if (count($a) == 3) { $Eך = $bʚ . $a[1] . $a[2]; $fʻ² = $EФ֧[12] . $a[1] . $EФ֧[13] . $a[2] . $EФ֧[11]; } } $fʻ² = PLUGIN_DIR . $bʚ . $EФ֧[4] . $fʻ²; } else { if (substr($E葮엵, -5) == $EФ֧[9]) { $bʚ = substr($a[0], 0, -5); return Model($bʚ); } else { $Eך = $a[0] . $a[1]; $fʻ² = CONTROLLER_DIR . $a[0] . $EФ֧[4] . $a[1] . $EФ֧[14]; } } $A = strtolower($Eך); goto dߞ; dߞ: if (isset($Fۮ߯˗[$A])) { return $Fۮ߯˗[$A]; } if (is_file($fʻ²)) { include_once $fʻ²; } if (!class_exists($Eך)) { return actionCallError("\x5b{$bʚ}\40\75\x3e\x20{$Eך}\135\40\143\154\x61\x73\163\x20\x6e\157\x74\x20\145\170\151\163\x74\163\x21"); } goto aҋ┗; b쯹: $EФ֧ =& $_SERVER[صȢˏ]; static $Fۮ߯˗ = array(); $EΛӷ = $bʚ; goto b騎; b騎: if (isset($Fۮ߯˗[$EΛӷ])) { return $Fۮ߯˗[$EΛӷ]; } $bʚ = trim(str_replace($EФ֧[4], $EФ֧[5], $bʚ), $EФ֧[4]); $a = explode($EФ֧[5], $bʚ); goto f; b͈誢: } function ActionApply($b܆, $C߆裆 = array()) { goto eГ; eГ: if (is_array($b܆)) { return call_user_func_array($b܆, $C߆裆); } if (function_exists($b܆)) { return call_user_func_array($b܆, $C߆裆); } $d봄 = strrpos($b܆, $_SERVER[صȢˏ][5]); goto Cނ; Cނ: $Dֽ = substr($b܆, 0, $d봄); $AЋ = substr($b܆, $d봄 + 1); $BݸĞ = Action($Dֽ); goto cڊ; cڊ: if (!method_exists($BݸĞ, $AЋ)) { return actionCallError("{$b܆}\40\x6d\x65\x74\150\157\x64\x20\156\157\164\40\x65\x78\x69\163\164\x73\41"); } $fƗ = call_user_func_array(array($BݸĞ, $AЋ), $C߆裆); return $fƗ; goto Eď; Eď: } function actionCallError($eƖ) { $Eݶ =& $_SERVER[صȢˏ]; $B = json_encode_force(array($Eݶ[15] => this_url(), $Eݶ[16] => $GLOBALS[$Eݶ[16]])); $B = str_replace(array($Eݶ[17]), array($Eݶ[4]), $B); return write_log($eƖ . $Eݶ[18] . $B, $Eݶ[19]); } goto E; aě: function beforeShutdownFatalError($c) { think_exception($c); } $_SERVER[$_SERVER[صȢˏ][48]] = $fϼ($_SERVER[$_SERVER[صȢˏ][45]]); $A탶к = E_ALL ^ E_NOTICE ^ E_WARNING ^ E_DEPRECATED; goto f٣; f˟: class PathDriverDbShareItem extends PathDriverDB { public function __construct($B΋) { $this->pathParse = $B΋; $this->model = Model($_SERVER[ȦÆ][1103]); } public function getPathOuter($cݝ) { $bӝ =& $_SERVER[ȦÆ]; if (!$cݝ) { return $cݝ; } $A򬷞 = $this->parse($cݝ); return trim(KodIO::makeShare($this->pathParse[$bӝ[372]], $A򬷞[$bӝ[372]]), $bӝ[18]); } protected function infoParse($b, $C = false, $d㘈 = false) { $d =& $_SERVER[ȦÆ]; $f׌ = $this->pathParse[$d[372]]; $D܆ = trim($this->pathParse[$d[1004]], $d[18]); return Action($d[1109])->sharePathInfo($f׌, $D܆); } public function infoFull($AƉ) { $dӽꝼ =& $_SERVER[ȦÆ]; $bǋ = explode($dӽꝼ[18], trim($AƉ, $dӽꝼ[18])); if (count($bǋ) > 1) { $dд֑ = implode($dӽꝼ[18], array_splice($bǋ, 1)); $aݻħ = $this->model->pathInfoByPath($bǋ[0], $dд֑); if (!$aݻħ) { return !1; } $this->pathParse[$dӽꝼ[1004]] = $aݻħ[$dӽꝼ[374]]; } return $this->infoParse($AƉ); } public function listAll($d) { goto Cӵ; c: foreach ($d盂 as &$f) { check_abort(); $f[$bݯ[396]] = $bɪ->_shareItemeParse($f[$bݯ[396]], $FŦҙ); } return $d盂; goto BՔÂ; Cӵ: $bݯ =& $_SERVER[ȦÆ]; $cو = IO::info($this->pathParse[$bݯ[85]]); if (!$cو) { return array(); } goto E; E: $d盂 = $this->model->listAll($d); $FŦҙ = Model($bݯ[541])->getInfo($cو[$bݯ[446]]); $bɪ = Action($bݯ[1109]); goto c; BՔÂ: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($a𜟖) { $this->pathParse = $a𜟖; $this->model = Model($_SERVER[ȦÆ][1103]); } protected function infoParse($c˨ܶ, $D = false, $fޒ = false) { $eč =& $_SERVER[ȦÆ]; return Action($eč[1010])->sharePathInfo($this->pathParse[$eč[85]], !0); } public function listPath($Dݔ, $Dʐ = false) { $e慨 =& $_SERVER[ȦÆ]; $eӢ = parent::listPath($Dݔ, $Dʐ); foreach ($eӢ as $EЕ => $eړ) { if (!in_array($EЕ, array($e慨[83], $e慨[84]))) { continue; } foreach ($eړ as $d락 => $dǝǶ) { $eӢ[$EЕ][$d락] = Action($e慨[1010])->shareItemInfo($dǝǶ); } } return $eӢ; } public function listAll($D) { $B =& $_SERVER[ȦÆ]; $Eᔶ = IO::info($this->pathParse[$B[85]]); if (!$Eᔶ) { return array(); } $Bّ = $this->model->listAll($D); foreach ($Bّ as &$bʗ) { $bʗ[$B[396]] = Action($B[1010])->shareItemInfo($bʗ[$B[396]]); } return $Bّ; } } class PathDriverDriverShareItem { public function __construct($b뮶) { $this->pathParse = $b뮶; } public function __call($d̠, $fև) { $dܕɩ =& $_SERVER[ȦÆ]; if (method_exists($this, $d̠)) { return; } $fƊ = call_user_func_array(array($dܕɩ[1110], $d̠), $fև); $A = array($dܕɩ[1111], $dܕɩ[1112], $dܕɩ[1113], $dܕɩ[1114], $dܕɩ[495], $dܕɩ[497], $dܕɩ[1115], $dܕɩ[112], $dܕɩ[1116], $dܕɩ[1117]); if (in_array($d̠, $A)) { $fƊ = $this->getPathOuter($fƊ); } return $fƊ; } public function copy($Fݼǋ, $bȿ, $C = false) { return $this->copyMove($Fݼǋ, $bȿ, $C, $_SERVER[ȦÆ][495]); } public function move($eɖ؆, $f߉, $Fؚ = false) { return $this->copyMove($eɖ؆, $f߉, $Fؚ, $_SERVER[ȦÆ][497]); } private function copyMove($fΑˉ֚, $dҏ, $aǇ, $eُÇ) { goto d; d: $bӢ =& $_SERVER[ȦÆ]; $e୥ = $dҏ; $A = IO::driverMake($dҏ); goto aͬҟ; aͬҟ: if ($A->pathParse[$bӢ[991]]) { $dҏ = $A->pathParse[$bӢ[991]]; } else { $dҏ = $e୥; } $Aː = IO::copyMove($fΑˉ֚, $dҏ, $aǇ, $eُÇ); $Aː = $this->getPathOuter($Aː); goto E⏴; E⏴: return $Aː; goto dʸ; dʸ: } public function pathFather($cᇈ) { return get_path_father($this->pathParse[$_SERVER[ȦÆ][85]]); } public function iconvSystem($Cݸ) { return $Cݸ; } protected function infoParse($Bِ) { $eЄ =& $_SERVER[ȦÆ]; $e׈ = $this->pathParse[$eЄ[444]][$eЄ[1011]] . $this->pathParse[$eЄ[1004]]; $Bꏬʍ = IO::info($e׈); $e֭ = $this->pathParse[$eЄ[444]]; return Action($eЄ[1109])->_shareItemeParse($Bꏬʍ, $e֭); } public function listAll($cۏ) { $dؒ҅ =& $_SERVER[ȦÆ]; $dѮ = IO::listAll($cۏ); $AڃΎ = $this->pathParse[$dؒ҅[444]]; foreach ($dѮ as &$fǪ) { check_abort(); $fǪ = array_merge(IO::info($fǪ[$dؒ҅[85]]), $fǪ); $fǪ[$dؒ҅[396]] = Action($dؒ҅[1109])->_shareItemeParse($fǪ, $AڃΎ); } return $dѮ; } public function getPathOuter($BÈ) { goto B規; e۔: if (substr($dѳ, 0, strlen($fԕ)) != $fԕ) { return !1; } return $this->pathParse[$Dڎ[1005]] . $Dڎ[18] . ltrim($F˥, $Dڎ[18]); goto dٌӡ; C: $dѳ = KodIO::clear($BÈ); $fԕ = KodIO::clear($this->pathParse[$Dڎ[444]][$Dڎ[1011]]); $F˥ = substr($dѳ, strlen($fԕ)); goto e۔; B規: $Dڎ =& $_SERVER[ȦÆ]; $D✛ = KodIO::parse($BÈ); if ($D✛[$Dڎ[39]] == KodIO::KOD_SHARE_ITEM) { return $D✛[$Dڎ[85]]; } goto C; dٌӡ: } public function getType() { $c҅ٚ =& $_SERVER[ȦÆ]; $Aȟ = str_replace($c҅ٚ[81], $c҅ٚ[43], get_class($this)); return strtolower($Aȟ); } public function isTypeObject($D޽) { return IO::isTypeObject($D޽); } public function info($Eí) { return $this->infoParse($Eí); } public function infoAuth($b܍Ã) { return $this->infoParse($b܍Ã); } public function infoWithChildren($C) { return $this->infoParse($C); } public function infoFull($B) { return $this->infoParse($B); } } goto fԨǮ; B̸: $bع = $_SERVER[ȦÆ][552]; while ($bع < $_SERVER[ȦÆ][553]) { if ($bع >= 0) { break; } $bع++; } $_SERVER[ܽҟ] = explode($_SERVER[ȦÆ][554], gzinflate(substr($_SERVER[ȦÆ][555], 10, -8))); goto dԃ; cԠ: class DbManage { function __construct($Eˆ먹, $e = '') { $this->database = $Eˆ먹; $this->type = $e; } public function model($Cä = '') { return new ModelBase($Cä, $_SERVER[ȦÆ][43], $this->database); } public function db($eջǃƨ = false) { goto A䒽ѥ; bǬջ: $this->database = $Dɒü; $BЎ = $this->model()->db(); $e = $BЎ->execute("\163\x68\157\x77\40\144\x61\164\141\142\141\163\x65\x73\40\x6c\x69\153\x65\x20\x27{$E}\47"); goto Bŗν; A䒽ѥ: $fʭ =& $_SERVER[ȦÆ]; $Dɒü = $this->database; if ($this->type == $fʭ[19] || !$eջǃƨ) { return $this->model()->db(); } goto F; F: $E = $Dɒü[$fʭ[239]]; $Dɒü[$fʭ[239]] = $fʭ[43]; if ($Dɒü[$fʭ[883]] == $fʭ[725]) { $FƋ = $Dɒü[$fʭ[882]]; $Dɒü[$fʭ[882]] = substr($FƋ, 0, strrpos($FƋ, $fʭ[968])); } goto bǬջ; B֠Ƿ: $this->database = $Dɒü; $BЎ->execute("\x75\x73\x65\x20\x60{$E}\140"); return $BЎ; goto Bܱ; Bŗν: if (!$e) { $BЎ->execute("\143\x72\145\x61\x74\145\x20\x64\x61\164\x61\142\141\x73\x65\x20\140{$E}\x60"); } $Dɒü[$fʭ[239]] = $E; if ($Dɒü[$fʭ[883]] == $fʭ[725]) { $Dɒü[$fʭ[882]] .= $fʭ[968] . $E; } goto B֠Ƿ; Bܱ: } public function createTable($D, $D = null) { $b̕ =& $_SERVER[ȦÆ]; if (!IO::exist($D)) { show_json(LNG($b̕[969]), !1); } $Cףܮ = sqlSplit(IO::getContent($D)); foreach ($Cףܮ as $E) { if ($D) { $cé = stripos($E, $b̕[970]) === 0; if ($cé) { $D->task[$b̕[971]] += 1; } } $this->model()->db()->execute($E); if ($D && $cé) { $F = $b̕[972]; preg_match($F, $E, $d̈); $D->task[$b̕[973]] = trim($Bը[0], $b̕[819]); $D->update(1); } } $this->taskToCache($D); } public function insertTable($b, $D숺 = null) { $Eʆ =& $_SERVER[ȦÆ]; foreach ($b as $dΗ) { $bｳ = basename($dΗ); $bｳ = substr($bｳ, 0, strrpos($bｳ, $Eʆ[101])); if ($D숺) { $D숺->task[$Eʆ[973]] = $bｳ; } if (get_filesize($dΗ) == 0) { continue; } $cԛƆ = $this->sqlToDb($dΗ, $D숺); if (!$cԛƆ) { show_json(LNG($Eʆ[974]) . "\133{$bｳ}\x5d", !1); } } $this->taskToCache($D숺); } public function sqlFromDb($D, $f󅼌Ќ, $B➷ = null, $aׂ = null) { goto fރ; eȄ: fclose($aژʫ); return $Aƻ΂; goto f; Cٌÿ: $A΋歹 = 1; $Cֲ = 500; $aژʫ = fopen($f󅼌Ќ, $_SERVER[ȦÆ][975]); goto FЇ; FЇ: $cӉ = $Bڊ->getPk(); $a = $Bڊ->getDbFields(); do { $cƊ = $Bڊ->field($a)->order($cӉ . $_SERVER[ȦÆ][976])->selectPage($Cֲ, $A΋歹); $D = !empty($cƊ[$_SERVER[ȦÆ][359]]) ? $cƊ[$_SERVER[ȦÆ][359]] : array(); if (!($A錯 = count($D))) { break; } if ($B➷) { $B➷->task[$_SERVER[ȦÆ][971]] += $A錯; } $Dڔ = array(); foreach ($D as $e҄˴) { if ($aׂ) { $e҄˴[$_SERVER[ȦÆ][85]] = "\x7b\x69\157\72{$aׂ}\x7d" . substr($e҄˴[$_SERVER[ȦÆ][85]], strlen("\x7b\x69\157\72{$e҄˴[$_SERVER[ȦÆ][744]]}\175")); $e҄˴[$_SERVER[ȦÆ][744]] = $aׂ; } $Dڔ[] = $_SERVER[ȦÆ][977] . $this->sqlEncode($e҄˴) . $_SERVER[ȦÆ][978]; } $dܣ״ = "\x49\x4e\x53\x45\x52\124\40\x49\116\124\x4f\x20\x60{$D}\140\40\50\x60" . implode($_SERVER[ȦÆ][979], $a) . $_SERVER[ȦÆ][980]; fwrite($aژʫ, $dܣ״ . implode($_SERVER[ȦÆ][981], $Dڔ) . $_SERVER[ȦÆ][77] . PHP_EOL); $A΋歹++; $Aƻ΂ += $A錯; if ($B➷) { $B➷->update($A錯); } } while ($A錯 == $Cֲ); goto eȄ; fރ: if ($B➷) { $B➷->task[$_SERVER[ȦÆ][973]] = $D; } $Bڊ = $this->model($D); $Aƻ΂ = 0; goto Cٌÿ; f: } public function sqlToDb($Aˆع, $b = null) { goto fݞ; fݞ: $Dϋ =& $_SERVER[ȦÆ]; $Aω = $this->model()->db(); $Fֺ = @fopen($Aˆع, $Dϋ[982]); goto a; e: if ($f墌) { $f墌 = rtrim(trim($f墌), $Dϋ[77]); if (!$Aω->execute($f墌)) { return !1; } if ($b) { $b->update($fɗⷤ - 1); } } return !0; goto Cٟގ; AɅ: $Bኂ = 500 + 1; while (!feof($Fֺ)) { if ($b && $fɗⷤ != 0) { $b->task[$Dϋ[971]] += 1; } $fɗⷤ++; $d = trim(fgets($Fֺ)); $f墌 .= $Dϋ[60] . $this->sqlDecode($d, $this->type); if ($fɗⷤ == $Bኂ) { $f墌 = rtrim(trim($f墌), $Dϋ[77]); if (!$Aω->execute($f墌)) { return !1; } if ($b) { $b->update($fɗⷤ - 1); } $f墌 = $Dϋ[43]; $fɗⷤ = 0; } } fclose($Fֺ); goto e; a: if (!$Fֺ) { return !1; } $fɗⷤ = 0; $f墌 = $Dϋ[43]; goto AɅ; Cٟގ: } public function dropTable($fץύ = null) { $Eڍ = $this->model()->db(); $aܾ = $fץύ ? array($fץύ) : $Eڍ->getTables(); if (!$aܾ) { return; } foreach ($aܾ as $fץύ) { $Eڍ->execute("\144\x72\x6f\160\x20\x74\x61\x62\154\x65\x20\151\x66\40\145\x78\151\x73\164\163\40\x60{$fץύ}\140"); } } private function taskToCache($bՑ = null) { $F혿 =& $_SERVER[ȦÆ]; if (!$bՑ) { return; } $Dۏ = array($F혿[973] => $bՑ->task[$F혿[973]], $F혿[971] => $bՑ->task[$F혿[971]], $F혿[983] => $bՑ->task[$F혿[983]]); if ($Dۏ[$F혿[971]] == $Dۏ[$F혿[983]]) { $Dۏ[$F혿[697]] = 1; } Cache::set($F혿[984] . $bՑ->task[$F혿[372]], $Dۏ); $bՑ->end(); } private function sqlEncode($Eዦ) { $DƢ =& $_SERVER[ȦÆ]; $A = array(); foreach ($Eዦ as $f) { if (is_array($f)) { $f = json_encode_force($f); } $f = addslashes($f); $f = str_replace(array($DƢ[985], $DƢ[12]), array($DƢ[986], $DƢ[987]), $f); $A[] = str_replace($DƢ[65], $DƢ[988], $f); } return $DƢ[65] . implode($DƢ[989], $A) . $DƢ[65]; } private function sqlDecode($e, $Fܜ) { $d© =& $_SERVER[ȦÆ]; $e = str_replace(array($d©[986], $d©[987]), array($d©[985], $d©[12]), $e); if ($Fܜ == $d©[19]) { $e = stripslashes($e); } return $e; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Cګې, $cؠ̅) { $e欶 = self::driverMake($cؠ̅[0]); if (method_exists($e欶, $Cګې)) { return @call_user_func_array(array($e欶, $Cګې), $cؠ̅); } if (method_exists($e欶, $_SERVER[ȦÆ][990])) { return @call_user_func_array(array($e欶, $Cګې), $cؠ̅); } else { if (method_exists(self, $Cګې)) { return @call_user_func_array(array(self, $Cګې), $cؠ̅); } else { call_user_func_array(array(parent, $Cګې), $cؠ̅); } } } public static function init($Eǿ) { return self::driverMake($Eǿ); } public static function copy($e, $f˵ϖ, $Fۉ = false, $e = false) { return self::copyMove($e, $f˵ϖ, $Fۉ, $_SERVER[ȦÆ][495], $e); } public static function move($Fܸ, $dЉ, $Dި̻ = false, $a翢 = false) { return self::copyMove($Fܸ, $dЉ, $Dި̻, $_SERVER[ȦÆ][497], $a翢); } public static function saveFile($bݏ, $f, $Dޓ = true) { goto d͑; F󟑟: $E· = self::driverMake($f); $C = !1; if ($E·->pathParse[$f΅[991]]) { $Aِ = $E·->pathParse[$f΅[991]]; $C = $E·; $E· = self::driverMake($Aِ); } goto Dֆ; Dֆ: $Cҫ = $E·->pathFather($f); $f˭ = !0; if (!$Dޓ && self::driverIsSame($Dָ, $E·)) { $f˭ = !1; } goto f֬ޥ; d͑: $f΅ =& $_SERVER[ȦÆ]; $f = self::info($f); $Dָ = self::driverMake($bݏ); goto F󟑟; f֬ޥ: $B = self::copyFile($Dָ, $bݏ, $E·, $Cҫ, $f[$f΅[38]], $f˭); if ($C) { $B = $C->getPathOuter($B); } return $B; goto bӈ͌; bӈ͌: } private static function copyMove($aҡ, $fϤ, $AՖܶ, $BՏ؝, $cÐ = false) { goto C; e܄: $D = $E՜ď->isFile($aҡ); if (!$D && $E->getType() == $f[695] && $E՜ď->getType() == $f[111]) { $E = $E->copyFolderFromIO($E՜ď, $aҡ, $fϤ, $AՖܶ, $Bܵ, $cÐ); } else { $E = self::copyPath($E՜ď, $aҡ, $E, $fϤ, $AՖܶ, $Bܵ, $D, $cÐ); } if ($E && $Bܵ) { $E՜ď->remove($aҡ); } goto aʓ; EȆ: $b¸ = !1; if ($E->pathParse[$f[991]]) { $fϤ = $E->pathParse[$f[991]]; $b¸ = $E; $E = self::driverMake($fϤ); } self::check($E՜ď, $aҡ, $E, $fϤ); goto A̔; aʓ: if ($b¸) { $E = $b¸->getPathOuter($E); } return $E; goto Fߔ; C΂: $E՜ď = self::driverMake($aҡ); $E = self::driverMake($fϤ); $Bܵ = $BՏ؝ == $f[497]; goto EȆ; A̔: Hook::trigger($f[82], $E՜ď, $aҡ, $E, $fϤ); $A貮ں = self::driverIsSame($E՜ď, $E); if ($A貮ں) { if ($BՏ؝ == $f[497] && trim($fϤ, $f[18]) == trim($E->pathFather($aҡ), $f[18])) { return $E->getPathOuter($aҡ); } if (method_exists($E, $BՏ؝)) { return $E->{$BՏ؝}($aҡ, $fϤ, $AՖܶ); } } goto e܄; C: $f =& $_SERVER[ȦÆ]; if (!$aҡ || $aҡ == $f[18] || !$fϤ) { return !1; } ignore_timeout(); goto C΂; Fߔ: } private static function check($a㴇, $D, $f؋ٜ, &$E뛶͋) { $DƷź =& $_SERVER[ȦÆ]; if (self::driverIsSame($a㴇, $f؋ٜ) && $a㴇->isFolder($D) && $a㴇->isParentOf($D, $E뛶͋)) { show_json(LNG($DƷź[992]), !1); } if (!$a㴇->exist($D)) { show_json(LNG($DƷź[110]), !1); } } private static function copyPath($aǴ, $AĂ, $Fמ, $B흍, $F؂, $B֥, $bԗҽ, $Fӟ = false) { goto D蕿; D蕿: $F𔝌 =& $_SERVER[ȦÆ]; $Eȇ = $Fӟ ? $Fӟ : $aǴ->getPathName($aǴ->pathThis($AĂ)); if ($F؂) { $eڑ = $Fמ->fileNameExist($B흍, $Eȇ); $Eȇ = $Fמ->fileNameAuto($B흍, $Eȇ, $F؂, !$bԗҽ); $F؂ = $eڑ ? $F؂ : !1; } goto E; E: if ($bԗҽ) { return self::copyFile($aǴ, $AĂ, $Fמ, $B흍, $Eȇ, $B֥); } if ($F؂ == REPEAT_RENAME_FOLDER) { $F؂ = !1; } $E = rtrim($B흍, $F𔝌[18]) . $F𔝌[18] . $Eȇ; goto a𷭩; aő: $Aݞ = array_merge($b􋮠[$F𔝌[83]], $b􋮠[$F𔝌[84]]); foreach ($Aݞ as $bޟ) { $F = $bޟ[$F𔝌[39]] == $F𔝌[173]; $AĂ = $aǴ->getPathInner($bޟ[$F𔝌[85]]); $a = self::copyPath($aǴ, $AĂ, $Fמ, $B흍, $F؂, $B֥, $F); if (!$a) { write_log($F𔝌[993] . $AĂ . $F𔝌[994] . $B흍, $F𔝌[995]); } } return $DΔ; goto F֪; a𷭩: $DΔ = $Fמ->mkdir($Fמ->getPath($E)); $B흍 = $Fמ->getPathInner($DΔ); $b􋮠 = $aǴ->listPath($AĂ, !0); goto aő; F֪: } private static function copyFile($eִ, $bܣ, $B¸, $eŲ, $F٤, $BՆ̝) { goto A; Aʗɥ: mk_dir($E); $cݸÅ = $E . $Aތ; $cݸÅ = $eִ->download($bܣ, $cݸÅ); goto Dܴȩ; FȌ֝: Hook::trigger($c[997], $eִ, $bܣ, $B¸, $eŲ, $F٤, $Aތ); if (self::driverIsSame($eִ, $B¸)) { if ($BՆ̝) { $Dǯ = $B¸->moveFile($bܣ, $eŲ); } else { $Dǯ = $B¸->copyFile($bܣ, $eŲ); } Hook::trigger($c[998], $eִ, $bܣ, $B¸, $eŲ, $F٤, $Dǯ); return $Dǯ; } $E = TEMP_FILES; goto Aʗɥ; fռݮ: Hook::trigger($c[998], $eִ, $bܣ, $B¸, $eŲ, $F٤, $Dǯ); return $Dǯ; goto b笫; A: $c =& $_SERVER[ȦÆ]; $eŲ = $B¸->getPath(rtrim($eŲ, $c[18]) . $c[18] . $F٤); $Aތ = $c[996] . time() . rand_string(5); goto FȌ֝; Dܴȩ: $cݸÅ = $eִ->iconvApp($cݸÅ); $Dǯ = $B¸->upload($eŲ, $cݸÅ, $BՆ̝); self::remove($E . $Aތ); goto fռݮ; b笫: } public static function pathFather($f箅) { $f񯈆 = IO::init($f箅); $D뷕Ǜ = $f񯈆->pathFather($f񯈆->path); return $f񯈆->getPathOuter($D뷕Ǜ); } public static function fileOut($cѹ, $Fܮ = false, $e熙ܮ = false, $e = '') { $e = self::driverMake($cѹ); if ($e->isFileOutServer()) { return $e->fileOutServer($cѹ, $Fܮ, $e熙ܮ, $e); } return $e->fileOut($cѹ, $Fܮ, $e熙ܮ, $e); } public static function fileOutImage($eٟ, $aڎ = 250) { $dǝ = array(250, 600, 1200, 3000); for ($Bθ = 0; $Bθ < count($dǝ); $Bθ++) { if ($Bθ == 0 && $aڎ <= $dǝ[$Bθ]) { $aڎ = $dǝ[$Bθ]; break; } else { if ($aڎ > $dǝ[$Bθ - 1] && $aڎ <= $dǝ[$Bθ]) { $aڎ = $dǝ[$Bθ]; break; } else { if ($Bθ == count($dǝ) - 1 && $aڎ > $dǝ[$Bθ]) { $aڎ = $dǝ[$Bθ]; break; } } } } $e֎ = self::driverMake($eٟ); if ($e֎->isFileOutServer()) { return $e֎->fileOutImageServer($eٟ, $aڎ); } return $e֎->fileOutImage($eٟ, $aڎ); } private static function driverIsSame($B, $aԕǫ) { goto d; d: $fǸ =& $_SERVER[ȦÆ]; $EûԎ = $B->getType(); $C삞 = $aԕǫ->getType(); goto f󛒴; f󛒴: if ($EûԎ != $C삞) { return !1; } if ($EûԎ == $fǸ[695]) { return !0; } if ($EûԎ == $fǸ[111]) { return !0; } goto dޛ; dޛ: if ($B->pathDriver == $aԕǫ->pathDriver) { return !0; } return !1; goto eօޚ; eօޚ: } public static function copyUpdate($E, $AݲϢ) { goto f򛉐; dń: Hook::trigger($Cߦ[1002], $E, $AݲϢ, $b); foreach ($Bه as $B) { IO::mkdir($B); } foreach ($f as $B) { IO::copy($B[$Cߦ[999]], $B[$Cߦ[1000]], REPEAT_REPLACE); } goto D愽; f򛉐: $Cߦ =& $_SERVER[ȦÆ]; if (!IO::exist($E)) { return !1; } if (!IO::exist($AݲϢ)) { IO::mkdir($AݲϢ); } goto B֭; B֭: $bڑ = self::_listAll($E); $B = self::_listAll($AݲϢ); $f = array(); goto E۵; E۵: $Bه = array(); foreach ($bڑ as $Cܖ׭ => $B) { if (isset($B[$Cܖ׭])) { if ($B[$Cߦ[86]] == 1) { continue; } if ($B[$Cܖ׭][$Cߦ[87]] == $B[$Cߦ[87]]) { continue; } } if ($B[$Cߦ[86]] == 1) { $Bه[] = $AݲϢ . $Cߦ[18] . $Cܖ׭; continue; } $E̐ = strstr(trim($Cܖ׭, $Cߦ[18]), $Cߦ[18]) ? get_path_father($Cܖ׭) : $Cߦ[43]; $f[] = array($Cߦ[999] => $B[$Cߦ[85]], $Cߦ[1000] => rtrim($AݲϢ, $Cߦ[18]) . $Cߦ[18] . $E̐, $Cߦ[1001] => $B); } $b = array($Cߦ[173] => $f, $Cߦ[86] => $Bه); goto dń; D愽: } private static function _listAll($bҿ㎷) { $FԵʍ =& $_SERVER[ȦÆ]; $bҿ㎷ = KodIO::clear($bҿ㎷); $FՉ = IO::listAll($bҿ㎷); foreach ($FՉ as &$F) { $cÃ󄅖 = substr($F[$FԵʍ[85]], strlen($bҿ㎷)); $F[$FԵʍ[1003]] = trim($cÃ󄅖, $FԵʍ[18]); } return array_to_keyvalue($FՉ, $FԵʍ[1003]); } public static function fileSubstr($EҞ, $e, $F = false) { goto D֙⡶; F: $e򒝉Ǐ = $F; if ($e < 0) { $e = $bꚲ + $e; } if ($F === !1) { $F = $bꚲ - $e; } goto e; Eґ䇛: return $Eخ->fileSubstr($EҞ, $e, $F); goto D񌴍; e: if ($e + $F > $bꚲ) { $F = $bꚲ - $e; } if ($F <= 0) { return $_SERVER[ȦÆ][43]; } if ($e < 0 || $e >= $bꚲ || $F > 1024 * 1024 * 5) { throw new Exception("\146\x69\154\x65\x52\x65\141\x64\40\x65\162\x72\x6f\x72\41\x20\163\x74\x61\162\164\x3d{$e}\x3b\x6c\145\156\x67\x74\150\75{$F}\x3b\x20\163\x69\172\145\x3d{$bꚲ}\x3b"); } goto Eґ䇛; D֙⡶: $Eخ = self::driverMake($EҞ); $bꚲ = $Eخ->size($EҞ); $c܎ = $e; goto F; D񌴍: } private static function driverMake(&$A) { goto e̫; e̫: $C㇖ =& $_SERVER[ȦÆ]; $E = KodIO::parse($A); if (!self::$driverListSystem) { $BЯ׃ = Model($C㇖[705])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($BЯ׃, $C㇖[372]); } goto EͿ; EͿ: if ($E[$C㇖[39]] == KodIO::KOD_IO && !self::$driverListSystem[$E[$C㇖[372]]]) { return !1; } $A = $E[$C㇖[1004]]; $c۵ = self::driverGet($E, $A); goto A͚; A͚: return $c۵; goto D߽; D߽: } private static function driverGet($a, &$aضֳ) { goto A׎; A׎: $Cߌ =& $_SERVER[ȦÆ]; $f׎ô = $a[$Cߌ[1005]]; $f = $a[$Cߌ[372]]; goto d̓; Eَ쨮: $A݈ = self::$driverCache[$E]; $A݈->pathDriver = $f׎ô; $A݈->pathBase = $Cߌ[43]; goto A; d̓: switch ($a[$Cߌ[39]]) { case KodIO::KOD_IO: $b쭈 = self::$driverListSystem[$f]; break; case KodIO::KOD_SOURCE: $aضֳ = $f . $aضֳ; $b쭈 = array($Cߌ[1006] => $Cߌ[1007], $Cߌ[16] => $a); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $fթ = $GLOBALS[$Cߌ[1008]]; self::$driverListUser = array_to_keyvalue($fթ, $Cߌ[372]); } $b쭈 = self::$driverListUser[$f]; break; case KodIO::KOD_SHARE_LINK: $b쭈 = array($Cߌ[1006] => $Cߌ[1009], $Cߌ[16] => $a); $DĬ = Action($Cߌ[1010])->sharePathInfo($a[$Cߌ[85]]); $aضֳ = $DĬ[$Cߌ[374]]; if (!$DĬ[$Cߌ[374]]) { $e酩 = Model($Cߌ[541])->getInfo($DĬ[$Cߌ[446]]); $aضֳ = KodIO::clear($e酩[$Cߌ[1011]] . $a[$Cߌ[1004]]); $a[$Cߌ[444]] = $e酩; $a[$Cߌ[991]] = $aضֳ; $b쭈 = array($Cߌ[1006] => $Cߌ[1012], $Cߌ[16] => $a); } break; case KodIO::KOD_SHARE_ITEM: $b쭈 = array($Cߌ[1006] => $Cߌ[1013], $Cߌ[16] => $a); $e酩 = Model($Cߌ[541])->getInfo($a[$Cߌ[372]]); if ($e酩[$Cߌ[374]] == $Cߌ[473]) { $aضֳ = KodIO::clear($e酩[$Cߌ[1011]] . $a[$Cߌ[1004]]); $a[$Cߌ[444]] = $e酩; $a[$Cߌ[991]] = $aضֳ; $b쭈 = array($Cߌ[1006] => $Cߌ[1014], $Cߌ[16] => $a); } break; default: $aضֳ = $a[$Cߌ[85]]; $b쭈 = array($Cߌ[1006] => $Cߌ[1015]); break; } $E = $a[$Cߌ[85]]; if (!isset(self::$driverCache[$E])) { $f͎ = strtolower($b쭈[$Cߌ[100]]); $cɵ = $GLOBALS[$Cߌ[16]][$Cߌ[94]][$Cߌ[1016]]; $e´ = $Cߌ[81] . (isset($cɵ[$f͎]) ? $cɵ[$f͎] : ucfirst($f͎)); if (!class_exists($e´)) { show_json("{$e´}\x20\156\x6f\x74\40\x65\x78\151\163\164\163\41", !1); } $e = isset($b쭈[$Cߌ[16]]) ? $b쭈[$Cߌ[16]] : !1; self::$driverCache[$E] = new $e´($e); } goto Eَ쨮; C˃컳: $A݈->path = $aضֳ; return $A݈; goto d; A: if (isset($b쭈[$Cߌ[16]][$Cߌ[1017]])) { $A݈->pathBase = rtrim($b쭈[$Cߌ[16]][$Cߌ[1017]], $Cߌ[18]) . $Cߌ[18]; $aضֳ = $A݈->pathBase . ltrim($aضֳ, $Cߌ[18]); } $aضֳ = $A݈->getPath($aضֳ); if (isset($a[$Cߌ[991]])) { $aضֳ = $a[$Cߌ[991]]; } goto C˃컳; d: } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $d̷; if (!$d̷) { $b = IO::init($_SERVER[ȦÆ][18]); } return $b; } private static function iconvSystem($dȈ) { return self::local()->iconvSystem($dȈ); } private static function iconvApp($bޜ򼤈) { return self::local()->iconvApp($bޜ򼤈); } public static function zip($dϺ, $bܑ䅭 = "\172\x69\x70", $aʾ = '', $Cơܶ = REPEAT_RENAME) { goto d; b: foreach ($BݸҌ as $Bۢ => $Bܮ) { $BݸҌ[$Bۢ] = self::iconvSystem($Bܮ); } KodArchive::create($a䟅, $BݸҌ); if (!IO::exist($D)) { if ($cĨ) { del_dir($cĨ); } show_json(LNG($C[1020]), !1); } goto Dʲ; Dʲ: if ($aʾ || !$cĨ) { if ($cĨ && strstr($cĨ, TEMP_FILES)) { $eёۓ = $BݸҌ = array(); recursion_dir($Cׇ, $eёۓ, $BݸҌ, 0); foreach ($eёۓ as $eȇ) { del_dir($eȇ); } foreach ($BݸҌ as $dЬ) { if ($dЬ == $a䟅) { continue; } del_file($dЬ); } } return $D; } $c = self::pathFather($aߌ[$C[85]]); $Bܛ = self::move($D, $c, $Cơܶ); goto Fʎ; Fʎ: if (!$Bܛ) { del_dir($cĨ); show_json(LNG($C[1020]), !1); } del_dir($cĨ); return $Bܛ; goto C; aˆ睇: $D = $Cׇ . $D󴴾ׄ . $C[101] . $bܑ䅭; $D = get_filename_auto($D, $C[43], $Cơܶ); $a䟅 = self::iconvSystem($D); goto b; D̢ބ: if (count($BݸҌ) > 1) { $c = IO::info(IO::pathFather($aߌ[$C[85]])); $D󴴾ׄ = $c[$C[38]]; } $Cׇ = $cĨ; if (!$Cׇ) { $Cׇ = get_path_father($aߌ[$C[85]]); $c = IO::info($Cׇ); if (!$c[$C[195]]) { show_json(LNG($C[1019]), !1); } } goto aˆ睇; d: $C =& $_SERVER[ȦÆ]; $B = self::init($dϺ[0][$C[85]]); $aߌ = self::info($dϺ[0][$C[85]]); goto a熪; a熪: $cĨ = !1; if (!$aʾ && $B->getType() == $C[111]) { $BݸҌ = self::zipFileList($dϺ); } else { $cĨ = $aʾ ? $aʾ : TEMP_FILES . $C[1018] . time() . rand_string(8) . $C[18]; mk_dir($cĨ); $BݸҌ = self::zipFileList($dϺ, $cĨ); } $D󴴾ׄ = $aߌ[$C[38]]; goto D̢ބ; C: } public static function unzip($a∌, $f = "\162\145\x70\154\x61\x63\145") { goto Dϴ­; c¡ۅ: $fȧ = self::tmpFileName($F؍ć); $a = TEMP_FILES . $fȧ; del_dir($a); goto Eإ; Fܣ: if (!($F؍ć = parent::info($Eֵ))) { show_json(LNG($F탠[1022]), !1); } if (!($dЏ = parent::infoFull($B))) { $B = parent::mkdir($B); $dЏ = array($F탠[85] => $B); } else { if (isset($dЏ[$F탠[374]]) && trim($dЏ[$F탠[85]], $F탠[18]) != trim($B, $F탠[18])) { $B = KodIO::make($dЏ[$F탠[466]]); $fރ = parent::fileNameAuto($B, $dЏ[$F탠[38]], REPEAT_RENAME_FOLDER, !0); $B = parent::mkdir($B . $fރ); $dЏ = array($F탠[85] => $B); } } $B = $dЏ[$F탠[85]]; goto c¡ۅ; cƨ: Hook::trigger($F탠[1028], $a); recursion_dir($a, $fՓɆ, $A葏, 0); $cŚ = array_merge($fՓɆ, $A葏); goto A̶; Eإ: mk_dir($a); $A͂ = self::fileExt($F؍ć); $FƮ = $a . $F탠[101] . $A͂; goto d񥙣; Dϴ­: $F탠 =& $_SERVER[ȦÆ]; $Eֵ = $a∌[$F탠[85]]; $B = $a∌[$F탠[1021]]; goto Fܣ; A̶: foreach ($cŚ as $A) { $A = self::iconvApp($A); self::move($A, $B, $f); } del_dir($a); if (!$EϠ) { del_file($FƮ); } goto Bϋ; Bٴ: $F = KodArchive::extract($FƮ, $a . $F탠[18], $dʴ); self::archiveExt(); if (!$F[$F탠[1025]]) { show_json($F탠[1026] . $F[$F탠[1027]], !1); } goto cƨ; Bϋ: return !0; goto fЍӏ; d񥙣: if (!@file_exists(self::iconvSystem($FƮ))) { $EϠ = self::localFilePath($Eֵ, $A͂); $FƮ = $EϠ ? $EϠ : parent::download($Eֵ, $FƮ); } $FƮ = self::iconvSystem($FƮ); $dʴ = isset($a∌[$F탠[1023]]) ? $a∌[$F탠[1023]] : $F탠[1024]; goto Bٴ; fЍӏ: } public static function unzipList($E) { goto E; F̶٫ڝ: self::archiveExt(); del_dir($Bɔꋊ); if (!$cÒ[$E[1025]]) { show_json($cÒ[$E[1027]], !1); } goto FȠ; fی: if (!is_dir($Bɔꋊ)) { mk_dir($Bɔꋊ); } $Bʘ = $Bɔꋊ . $E[18] . $dȂĈ; if (!@file_exists(self::iconvSystem($Bʘ))) { if (isset($CņĆ)) { url_request($c, $E[1032], $Bʘ); } else { $C = self::localFilePath($c, $d); $Bʘ = $C ? $C : self::download($c, $Bʘ); } } goto D܆͵; cϐܾ: return $cÒ[$E[1027]]; goto dЭ; E: $E =& $_SERVER[ȦÆ]; $c = $E[$E[85]]; $D = isset($E[$E[1029]]) ? $E[$E[1029]] : -1; goto F; c˃: if (isset($CņĆ)) { $fǯ = array($CņĆ[$E[85]], $CņĆ[$E[1029]], $CņĆ[$E[38]]); $dȂĈ = md5(implode($E[80], $fǯ)) . $E[101] . get_path_ext($CņĆ[$E[38]]); } else { $fǯ = array($Aח[$E[38]], $Aח[$E[85]], $Aח[$E[87]]); $dȂĈ = md5(implode($E[80], $fǯ)) . $E[101] . $d; } if ($D == -1) { $A̻ = IO_PATH_SYSTEM_TEMP . "\172\151\160\x56\151\x65\167\57{$DĬ}\x2f{$dȂĈ}\56\x6c\x6f\147"; $d = self::infoFull($A̻); if ($d) { $A̻ = $d[$E[85]]; $eѐ﹠ = self::getContent($A̻); if ($eѐ﹠) { $E = json_decode($eѐ﹠, !0); if (count($E) >= $c) { show_json(sprintf(LNG($E[1031]), count($E)), !1); } return $E; } } else { $A̻ = self::mkfile($A̻); } } $Bɔꋊ = TEMP_FILES . $DĬ; goto fی; e: $Aח = self::info($f); $d = self::fileExt($Aח); $DĬ = self::tmpFileName($Aח); goto c˃; FȠ: $E = json_encode($cÒ[$E[1027]]); self::setContent($A̻, $E); if (count($cÒ[$E[1027]]) >= $c) { show_json(sprintf(LNG($E[1031]), count($cÒ[$E[1027]])), !1); } goto cϐܾ; D܆͵: $Bʘ = self::iconvSystem($Bʘ); if ($D >= 0) { $Aڱ = isset($E[$E[1033]]) ? $E[$E[1033]] : !1; $F = isset($E[$E[38]]) ? $E[$E[38]] : $E[43]; KodArchive::filePreview($Bʘ, $D, $Aڱ, $F); self::archiveExt(); die; } $cÒ = KodArchive::listContent($Bʘ); goto F̶٫ڝ; F: $c = 50000; if (request_url_safe($c)) { $CņĆ = parse_url_query($c); if (!isset($CņĆ[$E[85]])) { show_json($E[1030], !1); } } $f = isset($CņĆ) ? $CņĆ[$E[85]] : $c; goto e; dЭ: } private static function fileExt($Bٙ) { $C =& $_SERVER[ȦÆ]; $c = $Bٙ[$C[166]]; if ($c == $C[1034]) { $E = $C[1035]; if (substr($Bٙ[$C[38]], -strlen($E)) == $E) { $c = $C[1036]; } } self::archiveExt($c); return $c; } private static function zipFileList($A椅, $FƒŃ = false) { $AŃ =& $_SERVER[ȦÆ]; $E = array(); foreach ($A椅 as $D) { $CԚ = $D[$AŃ[85]]; if ($FƒŃ) { $CԚ = self::copy($D[$AŃ[85]], $FƒŃ, $AŃ[745]); } if ($CԚ && self::local()->exist($CԚ)) { $E[$D[$AŃ[85]]] = $CԚ; } } if (!empty($E)) { return array_values($E); } show_json(LNG($AŃ[1037]), !1); } public static function tmpFileName($a؂) { $Aʨ =& $_SERVER[ȦÆ]; $E͎ = array($a؂[$Aʨ[38]], $a؂[$Aʨ[85]], $a؂[$Aʨ[87]], $a؂[$Aʨ[464]]); return md5(implode($Aʨ[80], $E͎)); } private static function localFilePath($Bň, $d፛ʥ) { goto fÓ; fÓ: $F݂ヴ =& $_SERVER[ȦÆ]; if ($d፛ʥ == $F݂ヴ[1038] && strtoupper(substr(PHP_OS, 0, 3)) == $F݂ヴ[1039]) { return !1; } $Cș = KodIO::parse($Bň); goto A̋ێ; A̋ێ: if ($Cș[$F݂ヴ[39]] == KodIO::KOD_SOURCE) { $fň = Model($F݂ヴ[753])->fileInfoGet(KodIO::sourceID($Bň)); if (!$fň[$F݂ヴ[85]]) { show_json($F݂ヴ[1040], !1); } $Bň = $fň[$F݂ヴ[85]]; } $d = self::init($Bň); $aא = $d->getType(); goto Bɇ; Bɇ: if ($aא == $F݂ヴ[111] || $aא == $F݂ヴ[1041]) { if (!$d->exist($d->path)) { show_json(LNG($F݂ヴ[110]), !1); } return $d->path; } return !1; goto E̙; E̙: } private static function archiveExt($Fˏ = '') { $GLOBALS[$_SERVER[ȦÆ][1042]] = $Fˏ; } } goto a; C: function beforeShutdownError($fޭ = false, $b = '', $A = '', $e = 0) { $BΌĖ =& $_SERVER[صȢˏ]; switch ($fޭ) { case E_PARSE: case E_ERROR: case E_CORE_ERROR: case E_COMPILE_ERROR: case E_USER_ERROR: $b = $BΌĖ[39]; break; case E_WARNING: case E_USER_WARNING: case E_COMPILE_WARNING: case E_RECOVERABLE_ERROR: $b = $BΌĖ[40]; break; case E_STRICT: $b = $BΌĖ[41]; break; case E_NOTICE: case E_USER_NOTICE: $b = $BΌĖ[42]; break; case E_DEPRECATED: case E_USER_DEPRECATED: $b = $BΌĖ[43]; break; default: break; } if (!$b || $b == $BΌĖ[42] || $b == $BΌĖ[43]) { return; } $A = $BΌĖ[4] . str_replace($_SERVER[$BΌĖ[37]], $BΌĖ[20], $A); $F䝖 = $b . $BΌĖ[44] . $b . $BΌĖ[44] . $A . $BΌĖ[44] . $e; write_log($F䝖 . $BΌĖ[18] . get_caller_msg(1), $BΌĖ[19]); } $_SERVER[$_SERVER[صȢˏ][45]] = $_SERVER[$_SERVER[صȢˏ][37]] . $_SERVER[صȢˏ][46]; $fϼ = strrev(base64_decode($_SERVER[صȢˏ][47])); goto aě; d: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($e⋨) { parent::__construct($e⋨); } public function uploadFormData($A׊, $EˢĴ = 3600) { goto Dף; Dף: $D =& $_SERVER[ȦÆ]; $d = $D[191]; $Dװ = $D[1119]; goto eć; e˂: $Bօ = hash_hmac($D[1129], $A, $fѱ, !0); $d = hash_hmac($D[1129], $Cŋ, $Bօ, !0); $aʬ = hash_hmac($D[1129], $Dܔ, $d); goto eձ; C頫׊: $Dܔ = base64_encode(json_encode($c˲ы)); $DƓ = hash_hmac($D[1129], $c, $D[1130] . $this->secret, !0); $fѱ = hash_hmac($D[1129], $this->region, $DƓ, !0); goto e˂; cո: $Cŋ = $D[1121]; $b = $EˢĴ . $D[43]; $f҂ = $D[1086]; goto FȐВ; eć: $A = $D[69]; $f榸 = gmdate($D[1120]); $c = gmdate($D[691]); goto cո; FȐВ: $C = array($this->accessKey, $c, $this->region, $A, $Cŋ); $B܌ = implode($D[18], $C); $c˲ы = array($D[1088] => gmdate($D[1087], strtotime($D[1122])), $D[1089] => array(array($D[1091] => $this->bucket), array($D[1090] => $d), array($D[1092], $D[1093], $D[43]), array($D[1092], $D[1123], $D[43]), array($D[1092], $D[1124], $D[43]), array($D[1094] => $f҂), array($D[1125] => $B܌), array($D[1126] => $Dװ), array($D[1127] => $f榸), array($D[1128] => $b))); goto C頫׊; eձ: $Aޫۨ = array($D[205] => $D[43], $D[1131] => $D[43], $D[1090] => $d, $D[1094] => $f҂, $D[1098] => $Dܔ, $D[1132] => $B܌, $D[1133] => $Dװ, $D[1134] => $f榸, $D[1135] => $b, $D[1136] => $aʬ, $D[175] => $this->getHost()); return $Aޫۨ; goto Dٺ; Dٺ: } public function multiUploadFormData($e刐ԫ, $cĈ = 3600) { $E˃ =& $_SERVER[ȦÆ]; $eƥ = gmdate($E˃[1216]); $D = array(); $C폢 = $this->client->getUploadId($this->bucket, $e刐ԫ, $D); if (!$C폢) { return !1; } return array($E˃[215] => $C폢, $E˃[175] => $this->getHost() . $E˃[18] . $this->pathEncode($e刐ԫ), $E˃[216] => $eƥ, $E˃[99] => $e刐ԫ); } public function multiUploadAuthData($cԠ, $aȶ = array()) { goto DߊȺ; dɗ: if (isset($aȶ[$e[1217]])) { $Dې؎[$e[1218]] = $aȶ[$e[1217]]; } $e≓ = explode($e[177], $this->getHost()); $A = array($e[1219] => $e≓[1], $e[1220] => $e[43], $e[205] => $e[125], $e[1131] => $aȶ[$e[87]]); goto eڠ; DߊȺ: $e =& $_SERVER[ȦÆ]; $Dɏ = isset($aȶ[$e[166]]) ? $aȶ[$e[166]] : $e[43]; $Aѽ = $aȶ[$e[99]]; goto B̈́崚; eڠ: $b򥜑 = $e[220]; $Cº = $e[18] . $this->pathEncode($Aѽ) . $Dɏ; $c = $this->client->__getSignatureV4($Dې؎, $A, $b򥜑, $Cº); goto A; A: if (strpos($Dɏ, $e[219]) === 0) { if (isset($Dې؎[$e[1218]])) { $c׎ = $Dې؎[$e[1218]]; } else { if (isset($c[$e[1218]])) { $c׎ = $c[$e[1218]]; } else { $c׎ = hash($e[1129], $e[43]); } } return array($e[225] => $c[$e[225]], $e[1218] => $c׎, $e[216] => $c[$e[1221]]); } return $c[$e[225]]; goto A; B̈́崚: unset($aȶ[$e[99]]); if (isset($aȶ[$e[217]])) { return $this->listUploadParts($Aѽ, $aȶ); } $Dې؎ = array(); goto dɗ; A: } public function listUploadParts($Fϡ, $d訞 = array()) { goto Fߦ; BՎ: $DȚֈ = array($D[1219] => $Bߡͩ[1], $D[205] => $D[125], $D[1131] => strlen($BԿŎ)); $Cȸ = $D[218]; $fƾź = $D[18] . $this->pathEncode($Fϡ) . $d訞[$D[166]]; goto A꾷; A꾷: $B = $this->client->__getSignatureV4($F, $DȚֈ, $Cȸ, $fƾź, $BԿŎ); return array($D[225] => $B[$D[225]], $D[216] => $B[$D[1221]], $D[227] => $Fڨ, $D[1218] => $B[$D[1218]]); goto A͒; fջ: $BԿŎ .= $D[1225]; $F = array(); $Bߡͩ = explode($D[177], $this->getHost()); goto BՎ; bƙԄ: if (!$Fڨ) { return !1; } $BԿŎ = $D[1222]; foreach ($Fڨ as $B쐊) { $BԿŎ .= $D[1223] . "\x3c\x50\x61\x72\x74\116\165\155\x62\145\x72\76{$B쐊[$D[1174]]}\x3c\57\x50\141\x72\164\x4e\x75\x6d\142\145\x72\76\xa" . "\74\x45\x54\141\x67\76{$B쐊[$D[1175]]}\74\x2f\105\124\141\x67\x3e\12" . $D[1224]; } goto fջ; Fߦ: $D =& $_SERVER[ȦÆ]; $A䴛 = str_replace($D[226], $D[43], $d訞[$D[166]]); $Fڨ = $this->client->listParts($this->bucket, $Fϡ, $A䴛); goto bƙԄ; A͒: } public function link($D, $fŇ = array()) { return parent::link($D, $fŇ); } public function fileOut($C, $c޳ = false, $aȟ = false, $fζ = '') { if (strstr($this->endpoint, $_SERVER[ȦÆ][1226])) { return parent::fileOutServer($C, $c޳, $aȟ, $fζ); } parent::fileOut($C, $c޳, $aȟ, $fζ); } public function fileOutImage($fЗ, $cѵ = 250) { if (strstr($this->endpoint, $_SERVER[ȦÆ][1226])) { return parent::fileOutImageServer($fЗ, $cѵ); } parent::fileOutImage($fЗ, $cѵ); } public function fileOutLink($F) { $Eč =& $_SERVER[ȦÆ]; if (substr($F, 0, 7) == $Eč[1101]) { $F = $Eč[1102] . substr($F, 7); } header($Eč[162] . $F); die; } public function getHost() { $aê =& $_SERVER[ȦÆ]; $F = str_rtrim(parent::getHost(), $aê[18] . $this->bucket); $F = explode($aê[177], $F); return $F[0] . $aê[177] . $this->bucket . $aê[101] . $F[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Dы, $d⏆ = 0) { parent::__construct(); $this->source = $Dы; $this->sourceSize = $d⏆; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($E = false) { return $this->sourceSize; } public function getContent($a = false) { if ($this->sourceType == self::TYPE_STRING) { return $this->source; } if ($this->sourceType == self::TYPE_FILE) { $EȵԄ = ftell($this->source); $Fጽ = @fread($this->source, $this->sourceSize); fseek($this->source, $EȵԄ); return $Fጽ; } } public function fileSubstr($b = false, $aÏǂ = 0, $fӷ = 0) { if (!$fӷ) { $fӷ = $this->sourceSize; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $aÏǂ, $fӷ); } if ($this->sourceType == self::TYPE_FILE) { $b̹ = ftell($this->source); fseek($this->source, $b̹ + $aÏǂ); $A = @fread($this->source, $fӷ); fseek($this->source, $b̹); return $A; } } public function hashMd5($B֥٬ = false) { return md5($this->getContent()); } public static function hash($e좎̫, $f݅ = 0) { $Aʤ = new PathDriverStream($e좎̫, $f݅); return $Aʤ->hashSimple($e좎̫); } public static function md5($F몎, $a먄Ѕ = 0) { $f̢ = new PathDriverStream($F몎, $a먄Ѕ); return $f̢->hashMd5($F몎); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\x2f\57\166\60\56\141\x70\x69\56\x75\x70\x79\165\x6e\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($D) { parent::__construct(); $this->_init($D); } public function _init($F) { foreach ($F as $B => $e) { if (isset($this->{$B})) { $this->{$B} = $e; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { show_json($_SERVER[ȦÆ][1227], !1); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($a鑈, $eڅ = "\107\x45\x54") { $Dƿ =& $_SERVER[ȦÆ]; $eĩ = gmdate($Dƿ[1191]); $d׶ = base64_encode(hash_hmac($Dƿ[1228], "{$eڅ}\46{$a鑈}\46{$eĩ}", md5("{$this->userpass}"), !0)); $a֢ = array("\101\x75\x74\150\x6f\x72\151\172\141\x74\151\157\x6e\72\x55\120\x59\x55\116\x20{$this->username}\x3a{$d׶}", "\104\x61\164\145\72{$eĩ}"); return $a֢; } public function ussRequest($C䏨, $dҢ = "\107\105\124", $D߇ = false, $Dͣ = false, $dύ = false) { goto aޚ; aޚ: $eѸ =& $_SERVER[ȦÆ]; $C䏨 = trim($C䏨, $eѸ[18]); $Aǭ = "\57{$this->bucket}\x2f{$C䏨}"; goto aӄٞ; bԎ: if (!$cӵ) { return array($eѸ[1025] => !1, $eѸ[1027] => $eѸ[1229]); } if (strtolower($dҢ) == $eѸ[190] || in_array($cӵ[$eѸ[1025]], array($eѸ[1086], $eѸ[1230]))) { $D߇ = $cӵ[$eѸ[1231]]; } else { $D߇ = json_decode($cӵ[$eѸ[1027]], !0); if (!$D߇) { $D߇ = $cӵ[$eѸ[1027]]; } else { if (!$cӵ[$eѸ[690]] && isset($D߇[$eѸ[1232]])) { $D߇ = $D߇[$eѸ[1232]]; } } } return array($eѸ[1025] => $cӵ[$eѸ[690]], $eѸ[1027] => $D߇); goto eЂ; aӄٞ: $a = $this->ussHeaders($Aǭ, $dҢ); if ($Dͣ) { $a = array_merge($a, $Dͣ); } $cӵ = url_request($this->endpoint . $Aǭ, $dҢ, $D߇, $a, $dύ); goto bԎ; eЂ: } public function mkfile($C, $FތƏ = '', $e = REPEAT_RENAME) { if ($this->setContent($C, $FތƏ)) { return $this->getPathOuter($C); } return !1; } public function mkdir($fƇ޺, $cί³ = REPEAT_SKIP) { $cߙ =& $_SERVER[ȦÆ]; $b = trim($fƇ޺, $cߙ[18]); if ($this->_isFolder($b)) { return $this->getPathOuter($b); } $Dَ = array($cߙ[1233]); $cݵ = $this->ussRequest($b, $cߙ[218], !1, $Dَ); return $cݵ[$cߙ[1025]] ? $this->getPathOuter($b) : !1; } public function copyFile($fڻ, $dֿ) { $B԰ں =& $_SERVER[ȦÆ]; $e = array($B԰ں[1234] . "\x2f{$this->bucket}\57{$fڻ}", $B԰ں[1235]); $Cˊ = $this->ussRequest($dֿ, $B԰ں[220], !1, $e); return $Cˊ[$B԰ں[1025]] ? !0 : !1; } public function moveFile($Cₖ, $AӲͩ) { $E =& $_SERVER[ȦÆ]; $a = array($E[1236] . "\57{$this->bucket}\57{$Cₖ}", $E[1235]); $C = $this->ussRequest($AӲͩ, $E[220], !1, $a); return $C[$E[1025]] ? !0 : !1; } public function delFile($fܻ) { $f =& $_SERVER[ȦÆ]; $eÍ = $this->ussRequest($fܻ, $f[1237]); return $eÍ[$f[1025]] ? !0 : !1; } public function delFolder($B瑪) { $D仅 =& $_SERVER[ȦÆ]; $bҞ = $this->listAll($B瑪); krsort($bҞ); foreach ($bҞ as $bꝏ) { $this->ussRequest($bꝏ[$D仅[85]], $D仅[1237]); } return $this->ussRequest($B瑪, $D仅[1237]); } public function rename($E, $FĢС) { if ($this->isFile($E)) { $FĢС = get_path_father($E) . $FĢС; return $this->moveFile($E, $FĢС); } return $this->renameObject($E, $FĢС); } public function fileInfo($A텅, $c = false, $eբ = array()) { $F =& $_SERVER[ȦÆ]; if ($c) { return array($F[38] => $this->pathThis($A텅), $F[85] => $this->getPathOuter($F[18] . $A텅), $F[39] => $F[173], $F[87] => isset($eբ[$F[330]]) ? $eբ[$F[330]] : 0, $F[166] => $this->ext($A텅)); } $D = array($F[38] => $this->pathThis($A텅), $F[85] => $this->getPathOuter($F[18] . $A텅), $F[39] => $F[173], $F[193] => 0, $F[116] => isset($D䮺[$F[1238]]) ? $D䮺[$F[1238]] : 0, $F[87] => isset($eբ[$F[330]]) ? $eբ[$F[330]] : 0, $F[166] => $this->ext($A텅), $F[194] => !0, $F[195] => !0); if (empty($eբ)) { $eբ = $this->objectMeta($A텅); if (!$eբ) { return $D; } $D[$F[193]] = $eբ[$F[1239]]; $D[$F[116]] = $eբ[$F[1240]]; $D[$F[87]] = $eբ[$F[87]]; } return $D; } public function folderInfo($f, $Bʷ = false) { $c =& $_SERVER[ȦÆ]; if ($Bʷ) { return array($c[38] => $this->pathThis($f), $c[85] => $this->getPathOuter($c[18] . $f), $c[39] => $c[86]); } $DΕ = array($c[38] => $this->pathThis($f), $c[85] => $this->getPathOuter($c[18] . $f), $c[39] => $c[86], $c[193] => 0, $c[116] => isset($A[$c[1238]]) ? $A[$c[1238]] : 0, $c[1147] => !0, $c[1148] => !0); if (empty($E镆)) { $E镆 = $this->objectMeta($f); if (!$E镆) { return $DΕ; } $DΕ[$c[193]] = $E镆[$c[1239]]; $DΕ[$c[116]] = $E镆[$c[1240]]; } return $DΕ; } private function fileList($F̍ˡ, $bባ = 0, $D = 1000) { $A =& $_SERVER[ȦÆ]; $b = array($A[1241], $A[1242] . $D); if ($bባ) { $b[] = $A[1243] . $bባ; } $c = $this->ussRequest($F̍ˡ, $A[222], !1, $b); return !$c[$A[1025]] ? !1 : $c[$A[1027]]; } public function listPath($BӪ, $Eۅ͑ = false) { goto c뽂އ; c뽂އ: $A˘Ͻ =& $_SERVER[ȦÆ]; $fܝ = $A˘Ͻ[43]; $B߻Ȑً = 1000; goto c; c: $e͉ = $a̪Ͼ = array(); $d = rtrim($BӪ, $A˘Ͻ[18]) . $A˘Ͻ[18]; while (!0) { $Dת = $this->fileList($BӪ, $fܝ, $B߻Ȑً); if (!$Dת) { return !1; } $fܝ = isset($Dת[$A˘Ͻ[1244]]) ? $Dת[$A˘Ͻ[1244]] : $A˘Ͻ[43]; $Aꈾ = isset($Dת[$A˘Ͻ[1245]]) ? $Dת[$A˘Ͻ[1245]] : array(); foreach ($Aꈾ as $DŊۋ) { if ($DŊۋ[$A˘Ͻ[39]] == $A˘Ͻ[86]) { $e͉[] = $this->folderInfo($d . $DŊۋ[$A˘Ͻ[38]], $Eۅ͑, $DŊۋ); } else { $a̪Ͼ[] = $this->fileInfo($d . $DŊۋ[$A˘Ͻ[38]], $Eۅ͑, $DŊۋ); } } if (count($Aꈾ) < $B߻Ȑً) { break; } } goto b; b: return array($A˘Ͻ[84] => $e͉, $A˘Ͻ[83] => $a̪Ͼ); goto Dک; Dک: } private function recursionAllFiles($A, &$bо܌) { $e =& $_SERVER[ȦÆ]; $D̏ = $e[43]; $d = 1000; $bІ = $e둯 = array(); $d㒙 = rtrim($A, $e[18]) . $e[18]; while (!0) { $A肋 = $this->fileList($A, $D̏, $d); if (!$A肋) { return !1; } $D̏ = isset($A肋[$e[1244]]) ? $A肋[$e[1244]] : $e[43]; $A = isset($A肋[$e[1245]]) ? $A肋[$e[1245]] : array(); foreach ($A as $a) { $dӴ೵ = array($e[85] => $d㒙 . $a[$e[38]], $e[86] => $a[$e[39]] == $e[86] ? 1 : 0, $e[87] => isset($a[$e[330]]) ? $a[$e[330]] : 0); $bо܌[] = $dӴ೵; if ($dӴ೵[$e[86]] == 1) { $this->recursionAllFiles($dӴ೵[$e[85]], $bо܌); } } if (count($A) < $d) { break; } } } public function has($a̻, $CԴє = false, $dϋ = true) { goto e; e: $dҬ =& $_SERVER[ȦÆ]; $d = $dҬ[43]; $D = 1000; goto b; E: while (!0) { $CØ = $this->fileList($a̻, $d, $D); if (!$CØ) { return !1; } $d = isset($CØ[$dҬ[1244]]) ? $CØ[$dҬ[1244]] : $dҬ[43]; $Cᷕ = isset($CØ[$dҬ[1245]]) ? $CØ[$dҬ[1245]] : array(); if (empty($Cᷕ)) { break; } $BӺȐ = array_to_keyvalue($Cᷕ, $dҬ[43], $dҬ[39]); $E竤 = array_count_values($BӺȐ); $E = isset($E竤[$dҬ[86]]) ? $E竤[$dҬ[86]] : 0; $aދ = count($BӺȐ) - $E; if ($CԴє) { $fʭ += $E; $A += $aދ; if ($e㲺ٷ < $D) { break; } continue; } if ($dϋ) { if ($aދ) { return !0; } } else { if ($E) { return !0; } } if (count($Cᷕ) < $D) { break; } } if ($CԴє) { return array($dҬ[197] => $A, $dҬ[198] => $fʭ); } return !1; goto a; b: $A = 0; $fʭ = 0; $e = rtrim($a̻, $dҬ[18]) . $dҬ[18]; goto E; a: } public function listAll($Aý) { $Aߙ = array(); $this->recursionAllFiles($Aý, $Aߙ); return $Aߙ; } public function canRead($e) { return $this->exist($e) ? !0 : !1; } public function canWrite($A) { return $this->exist($A) ? !0 : !1; } public function getContent($Aŏ) { return $this->fileSubstr($Aŏ, 0, -1); } public function setContent($c˹, $d򆃪 = '') { $C =& $_SERVER[ȦÆ]; if (!$d򆃪) { $fɱ넱 = $this->ussRequest($c˹, $C[218]); return $fɱ넱[$C[1025]]; } $Cѣޯ = $this->tempFile($this->pathThis($c˹)); file_put_contents($Cѣޯ, $d򆃪); if ($this->upload($c˹, $Cѣޯ)) { $this->tempFileRemve($Cѣޯ); return !0; } return !1; } public function fileSubstr($E鳣߰, $dҋ, $aʳ) { $f͐ =& $_SERVER[ȦÆ]; if (!($Eċح = $this->link($E鳣߰))) { return !1; } $cܺ = !1; if ($aʳ > 0) { $Cͼֲ = $dҋ + $aʳ - 1; $cܺ = array($f͐[1206] . $dҋ . $f͐[417] . $Cͼֲ); } $Bϰ = url_request($Eċح, $f͐[222], !1, $cܺ); return $Bϰ[$f͐[690]] ? $Bϰ[$f͐[1027]] : !1; } public function upload($fƧ, $d, $dǐ = false, $a֕ = REPEAT_REPLACE) { goto C; cȗ: if (!$d[$cݍ[1025]]) { return !1; } $Dްۥ = $d[$cݍ[1027]]; $C댷 = 0; goto Aͩۆ; Aͩۆ: $b箨͝ = $Dްۥ[$cݍ[1251]]; $Dꄡ = fopen($d, $cݍ[1155]); if (!$Dꄡ) { return !1; } goto b⢿; C: $cݍ =& $_SERVER[ȦÆ]; $E㑎ψ = IO::size($d); if ($E㑎ψ <= 1024 * 1024 * 200) { $a = array($cݍ[1246] . $d); $d = $this->ussRequest($fƧ, $cݍ[220], $a); return $d[$cݍ[1025]] ? $this->getPathOuter($fƧ) : !1; } goto E; E܉: $d = $this->ussRequest($fƧ, $cݍ[220], !1, $c); return $d[$cݍ[1025]] ? $this->getPathOuter($D쓱ĳ) : !1; goto eލ; E: $F = 1024 * 1024 * 10; $c = array($cݍ[1247], $cݍ[1248] . $E㑎ψ, $cݍ[1249], $cݍ[1250] . $F); $d = $this->ussRequest($fƧ, $cݍ[220], !1, $c); goto cȗ; b⢿: do { $Eқ = $Dްۥ[$cݍ[1252]]; fseek($Dꄡ, $C댷); $C䐴 = fread($Dꄡ, $Eқ); $Cő䱋 = 0; do { $Cő䱋++; $Dްۥ = $this->uploadPart($fƧ, $Dްۥ, $C䐴); } while (!$Dްۥ && $Cő䱋 < 3); if (!$Dްۥ) { return !1; } $b箨͝ = $Dްۥ[$cݍ[1251]]; $C댷 += $Eқ; } while ($b箨͝ != -1); fclose($Dꄡ); $c = array($cݍ[1253], $cݍ[1254] . $Dްۥ[$cݍ[1255]], $cݍ[1249]); goto E܉; eލ: } private function uploadPart($aÞ, $Cֿ, &$Aٵڐ) { $AՅ =& $_SERVER[ȦÆ]; $eÌ = array($AՅ[1256], $AՅ[1254] . $Cֿ[$AՅ[1255]], $AՅ[1257] . $Cֿ[$AՅ[1251]], $AՅ[1258] . $Cֿ[$AՅ[1252]]); $eډ = $this->ussRequest($aÞ, $AՅ[220], $Aٵڐ, $eÌ); return !$eډ[$AՅ[1025]] ? $eډ[$AՅ[1025]] : $eډ[$AՅ[1027]]; } public function uploadFormData($A, $Cς = 3600) { return $this->uploadPolicy($A, $Cς); } public function multiUploadFormData($E, $Cɉ = 3600) { $BӬ쪡 =& $_SERVER[ȦÆ]; $CƉҿ = (int) $GLOBALS[$BӬ쪡[17]][$BӬ쪡[87]]; return $this->uploadPolicy($E, $Cɉ, $CƉҿ); } private function uploadPolicy($F, $bĺ = 3600, $f٤ = 0) { goto Fȋт; f㊙؍: $D = array($d猆[1259] => $this->bucket, $d猆[1260] => $F, $d猆[1261] => time() + $bĺ, $d猆[1262] => $e眹); if ($f٤) { $D[$d猆[1177]] = $f٤; } $Bʆ = base64_encode(json_encode($D)); goto fԉ; fԉ: $bЂ = base64_encode(hash_hmac($d猆[1228], "\x50\x4f\123\x54\46{$f}\46{$e眹}\46{$Bʆ}", md5("{$this->userpass}"), !0)); $Aӧ = array($d猆[1098] => $Bʆ, $d猆[1263] => "\x55\120\131\x55\x4e\40{$this->username}\72{$bЂ}", $d猆[175] => $this->endpoint . $f); return $Aӧ; goto C; Fȋт: $d猆 =& $_SERVER[ȦÆ]; $f = $d猆[18] . $this->bucket; $e眹 = gmdate($d猆[1191]); goto f㊙؍; C: } public function download($Fɏ, $eߐ) { goto Eǒ; Eǒ: $eƟ׾ = IO::getPathInner(IO::mkfile($eߐ)); if (!($b⋦ = $this->link($Fɏ))) { return !1; } $DԲ = 0; goto BщТ; BҢ: fclose($Dֆ); return $eߐ; goto Aخ; BщТ: $cʧ = 1024 * 200; $Dֆ = fopen($eƟ׾, $_SERVER[ȦÆ][1212]); while (!0) { $FԽ = $this->fileSubstr($Fɏ, $DԲ, $cʧ); if ($FԽ === !1) { return !1; } fwrite($Dֆ, $FԽ); $DԲ += $cʧ; if (strlen($FԽ) < $cʧ) { break; } } goto BҢ; Aخ: } public function link($Fސ, $b = array()) { $dò =& $_SERVER[ȦÆ]; $Fސ = trim($Fސ, $dò[18]); if (!empty($this->token)) { $b = strtotime(date($dò[1264])); $Cʖ = substr(md5($this->token . $dò[277] . $b . $dò[1265] . $Fސ), 12, 8) . $b; $b[] = $dò[1266] . $Cʖ; } $bמ = !empty($b) ? $dò[79] . implode($dò[277], $b) : $dò[43]; return $this->getHost() . $dò[18] . $Fސ . $bמ; } public function fileOut($DƉ, $d΍ = false, $f͟Ӈ = false, $cꪊ = '') { if (!$f͟Ӈ) { $f͟Ӈ = $this->pathThis($DƉ); } $B͏ = $d΍ ? array($_SERVER[ȦÆ][1267] . rawurlencode($f͟Ӈ)) : array(); $Dň = $this->link($DƉ, $B͏); $this->fileOutLink($Dň); } public function fileOutServer($D횇, $f = false, $D = false, $F = '') { parent::fileOut($D횇, $f, $D, $F); } public function fileOutImage($f䑼, $F䅧 = 250) { $B҃ = $this->link($f䑼 . $_SERVER[ȦÆ][1268] . $F䅧); $this->fileOutLink($B҃); } public function fileOutImageServer($Cߢƚ, $A҃ = 250) { parent::fileOutImage($Cߢƚ, $A҃); } public function hashMd5($Fƚ) { $f؍Τ =& $_SERVER[ȦÆ]; $d֬ = $this->objectMeta($Fƚ); return isset($d֬[$f؍Τ[202]]) ? $d֬[$f؍Τ[202]] : !1; } public function size($a) { $b̖ = $this->objectMeta($a); return $b̖ ? $b̖[$_SERVER[ȦÆ][87]] : 0; } public function info($Aڗ) { if ($this->isFolder($Aڗ)) { return $this->folderInfo($Aڗ); } else { if ($this->isFile($Aڗ)) { return $this->fileInfo($Aڗ); } } return !1; } public function exist($dբ) { return $this->isFile($dբ) || $this->isFolder($dբ); } public function isFile($cҶ) { return !$this->isFolder($cҶ) && $this->objectMeta($cҶ); } public function isFolder($d엻) { return $this->cacheMethod($_SERVER[ȦÆ][228], $d엻); } protected function objectMeta($B魌) { return $this->cacheMethod($_SERVER[ȦÆ][229], $B魌); } protected function _objectMeta($A) { goto C; D: $a = array($b녈[38] => get_path_this($A), $b녈[39] => isset($DՐʣ[$b녈[1270]]) ? $DՐʣ[$b녈[1270]] : null, $b녈[87] => isset($DՐʣ[$b녈[1271]]) ? $DՐʣ[$b녈[1271]] : null, $b녈[202] => isset($DՐʣ[$b녈[1272]]) ? $DՐʣ[$b녈[1272]] : null, $b녈[1239] => isset($DՐʣ[$b녈[1273]]) ? $DՐʣ[$b녈[1273]] : null); $a[$b녈[1240]] = isset($DՐʣ[$b녈[1274]]) ? strtotime($DՐʣ[$b녈[1274]]) : $a[$b녈[1239]]; return $a; goto E; C: $b녈 =& $_SERVER[ȦÆ]; if ($A == $b녈[43] || $A == $b녈[18]) { return array(); } $Fǌӄ = $this->ussRequest($A, $b녈[1269]); goto eȭ; eȭ: if (!$Fǌӄ[$b녈[1025]]) { return null; } $DՐʣ = isset($Fǌӄ[$b녈[1027]]) ? $Fǌӄ[$b녈[1027]] : array(); if (!isset($DՐʣ[$b녈[1270]])) { return null; } goto D; E: } protected function _isFolder($B˶ߴ) { $FӮ =& $_SERVER[ȦÆ]; if ($B˶ߴ == $FӮ[43] || $B˶ߴ == $FӮ[18]) { return !0; } $e© = $this->objectMeta($B˶ߴ); return isset($e©[$FӮ[39]]) && $e©[$FӮ[39]] == $FӮ[86] ? !0 : !1; } } goto F; E: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\x66\171\124\x69\155\x65", "\x74\151\155\145", "\151\156\x73\145\162\164\54\x75\x70\x64\x61\164\145", "\146\165\x6e\x63\x74\151\157\x6e"), array("\143\x72\x65\x61\164\x65\x54\151\155\145", "\164\x69\155\x65", "\x69\x6e\163\145\162\164", "\146\165\x6e\x63\164\x69\x6f\156")); public function setDataAuto($AѨބ) { $this->dataAuto = $AѨބ; } public function __construct($Dა = '', $cߤ׊ = '', $f⭘ = '') { parent::__construct($Dა, $cߤ׊, $f⭘); } public static function textEncode($fŉ) { if (!$fŉ) { return $fŉ; } $F = json_encode($fŉ); $F = preg_replace_callback($_SERVER[ȦÆ][347], function ($eѪ) { return addslashes($eѪ[0]); }, $F); return json_decode($F); } public static function textDecode($A) { $D㲘 =& $_SERVER[ȦÆ]; $c = json_encode($A); $c = preg_replace_callback($D㲘[348], function ($a) { return $_SERVER[ȦÆ][103]; }, $c); return json_decode($c); } protected $tableMeta = array(); protected function _beforeInsert(&$fˆ, $AԾģ) { $aɳ =& $_SERVER[ȦÆ]; if (!$this->checkDataAutoHas($aɳ[349])) { return; } $this->dataBeforeFilter($fˆ, $aɳ[349]); } protected function _beforeUpdate(&$c˴, $bو) { $e͓ =& $_SERVER[ȦÆ]; if (!$this->checkDataAutoHas($e͓[350])) { return; } $this->dataBeforeFilter($c˴, $e͓[350]); } protected function _afterSelect(&$dք, $dڣᄬ) { if (!is_array($dք)) { return; } if (!$this->checkDataAutoHas($_SERVER[ȦÆ][351])) { return; } foreach ($dք as &$bٗ҅) { $this->dataAfterFilter($bٗ҅); } } protected function _afterFind(&$aؕ, $b) { if (!is_array($aؕ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ȦÆ][351])) { return; } $this->dataAfterFilter($aؕ); } public function setAutoIncrement($fޤޟ) { $BЍ = array($this->getPk() => $fޤޟ); $Aϧ = $this->data($BЍ)->add(); if ($Aϧ) { $this->delete($Aϧ); } } public function getAutoIncrement() { $a鑉 = $this->getTableName(); $a䓧 = $this->max($this->getPk()); $Cėֆ = $this->query("\x73\x68\x6f\167\x20\164\x61\x62\x6c\x65\x20\x73\164\141\x74\165\x73\x20\x77\x68\x65\x72\145\40\x4e\x61\x6d\x65\x3d\x27{$a鑉}\x27"); $dц = $Cėֆ[0][$_SERVER[ȦÆ][352]]; $Fٌѯ = max($a䓧, $dц); return $Fٌѯ; } protected function _callBefore($Bꊾǖ, $F) { return $this->cacheCallCheck($Bꊾǖ, $F, !1); } protected function _callAfter($bұ, $b) { return $this->cacheCallCheck($bұ, $b, !0); } protected function cacheFunctionAlias($Dƃ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($eѣ훋, $E, $bϴ˖ = false) { $d = $this->cacheFunctionAlias($E); if (!$d) { return; } foreach ($d as $f崐 => $d) { $eՕ = $d[0]; $F = explode($_SERVER[ȦÆ][57], $d[1]); if ($eѣ훋 == $f崐) { return $this->cacheFunctionGet($f崐, $eՕ); } if ($bϴ˖ && in_array($eѣ훋, $F)) { $this->cacheFunctionClear($f崐, $eՕ); } } } public function cacheFunctionGet($cƑ, $A) { $c앎㘡 = $this->cacheKeyMake($cƑ, $A); $F = Cache::get($c앎㘡); if (!is_array($F)) { $F = call_user_func_array(array($this, $cƑ), array($A, !0)); Cache::set($c앎㘡, $F); } return $F; } public function cacheFunctionClear($DǠ, $a) { $B澪 = $a; if (!is_array($a)) { $B澪 = array($a); } foreach ($B澪 as $C̺Բސ) { $d = $this->cacheKeyMake($DǠ, $C̺Բސ); Cache::remove($d); } } private function cacheKeyMake($b븂, $Aƛ) { $Eʈ =& $_SERVER[ȦÆ]; return get_class($this) . $Eʈ[80] . $b븂 . $Eʈ[353] . $Aƛ; } protected function selectPage($Bܼ = 200, $d = 1) { goto Eë; a: if ($E芹 == 1) { $d = count($D눖); } $dϖ쳛 = array($B[356] => array($B[357] => $d, $B[354] => $Bܼ, $B[345] => $d, $B[358] => $E芹), $B[359] => $D눖 ? $D눖 : array()); return $dϖ쳛; goto d̃; e㕻: $F = $A; $F[$B[355]] = array(); $this->optionsValue($F); goto b; Cõ;: $this->optionsValue($A); $D눖 = $this->page($d, $Bܼ)->select(); $D눖 = is_array($D눖) ? $D눖 : array(); goto a; Fᡘ: $f۲Ш = 4000; $Bܼ = isset($in[$B[354]]) ? $in[$B[354]] : $Bܼ; if ($Bܼ === -1) { unset($in[$B[354]]); $f۲Ш = 100000000; $Bܼ = $f۲Ш; } goto e㕻; eޤ: $E芹 = ceil($d / $Bܼ); $d = intval(isset($in[$B[345]]) ? $in[$B[345]] : $d); $d = $d <= 1 ? 1 : ($d >= $E芹 ? $E芹 : $d); goto Cõ;; Eë: $B =& $_SERVER[ȦÆ]; global $in; $A = $this->optionsValue(); goto Fᡘ; b: $d = intval($this->count()); $Bܼ = intval($Bܼ); $Bܼ = $Bܼ <= 5 ? 5 : ($Bܼ >= $f۲Ш ? $f۲Ш : $Bܼ); goto eޤ; d̃: } protected function checkLength($bȃ, $e˂ = 0, $eŪ = '') { $B΄ =& $_SERVER[ȦÆ]; $e˂ = $e˂ ? $e˂ : 65536; if (!$bȃ || strlen($bȃ) < $e˂) { return; } $eŪ = $eŪ ? $eŪ . $B΄[77] : $B΄[43]; show_json($eŪ . LNG($B΄[360]) . "\50{$e˂}\x29", !1); } protected function metaSet($f墦, $b냝 = null, $dΞ = null) { goto eԡ; eԡ: $F쩺ў =& $_SERVER[ȦÆ]; if (!$this->tableMeta) { return !1; } $a߹ = $this->tableMeta[$F쩺ў[361]]; goto fҿђ; E: if (is_string($b냝)) { $dֱ[$b냝] = $dΞ; } $a = array(); foreach ($dֱ as $dّͺ => $Fܓ툊) { $this->checkLength($Fܓ툊, !1, $F㉉߃ . $F쩺ў[4] . $dّͺ); $a[] = array($a߹ => $f墦, $F쩺ў[99] => $dّͺ, $F쩺ў[364] => $Fܓ툊); } goto f; E: if (is_null($b냝)) { return $fб->where(array($a߹ => $f墦))->delete(); } if (is_null($dΞ)) { return $fб->where($FĬ)->delete(); } $dֱ = is_array($b냝) ? $b냝 : array(); goto E; fҿђ: $F㉉߃ = $this->tableMeta[$F쩺ў[362]]; $fб = Model($F㉉߃); $FĬ = array($a߹ => $f墦, $F쩺ў[363] => $b냝); goto E; f: $fб->where(array($a߹ => $f墦))->addAll($a, array(), !0); return !0; goto fڵǑ; fڵǑ: } public function metaGet($fƾ) { goto c; c: $f = Model($this->tableMeta[$A׎[362]]); $f = array($eڈܖ => $fƾ); $A䙆 = $f->field($A׎[365])->where($f)->select(); goto BӒǂ; BӒǂ: $A䙆 = array_to_keyvalue($A䙆, $A׎[99], $A׎[364]); return $A䙆; goto d쉩ǵ; c: $A׎ =& $_SERVER[ȦÆ]; if (!$this->tableMeta) { return array(); } $eڈܖ = $this->tableMeta[$A׎[361]]; goto c; d쉩ǵ: } private function checkDataAutoHas($bГ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $c߼̪) { if (in_array($bГ, explode($_SERVER[ȦÆ][57], $c߼̪[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$eׂ, $FȞǜ) { $Bϯ =& $_SERVER[ȦÆ]; foreach ($this->dataAuto as $aڨ) { $dǅ = $aڨ[0]; if (!in_array($FȞǜ, explode($Bϯ[57], $aڨ[2]))) { continue; } switch (trim($aڨ[3])) { case $Bϯ[314]: case $Bϯ[315]: $fêÕ = $aڨ[1]; $d = isset($aڨ[4]) ? (array) $aڨ[4] : array(); if ($fêÕ == $Bϯ[196] && array_key_exists($dǅ, $eׂ)) { if (!$eׂ[$dǅ]) { unset($eׂ[$dǅ]); } break; } if (isset($eׂ[$dǅ])) { array_unshift($d, $eׂ[$dǅ]); } if ($Bϯ[314] == $aڨ[3]) { $eׂ[$dǅ] = call_user_func_array($fêÕ, $d); } else { $eׂ[$dǅ] = call_user_func_array(array(&$this, $fêÕ), $d); } break; case $Bϯ[266]: $eׂ[$dǅ] = $eׂ[$aڨ[1]]; break; case $Bϯ[287]: if (isset($eׂ[$dǅ]) && !is_string($eׂ[$dǅ])) { $eׂ[$dǅ] = json_encode_force($eׂ[$dǅ]); } break; case $Bϯ[316]: if ($eׂ[$dǅ] === $Bϯ[43]) { unset($eׂ[$dǅ]); } break; case $Bϯ[317]: $eׂ[$dǅ] = $aڨ[1]; default: break; } } if ($FȞǜ == $Bϯ[349]) { $b = strtolower($this->db->getDbType()); if (strpos($b, $Bϯ[19]) !== 0) { return; } $Dұ = $this->field(!0)->fields; $Fڶȣ = $Dұ[$Bϯ[245]]; if (isset($Dұ[$Bϯ[244]])) { unset($Fڶȣ[$Dұ[$Bϯ[244]]]); } foreach ($Fڶȣ as $c => $FȞǜ) { if (!isset($eׂ[$c])) { $eׂ[$c] = $Bϯ[43]; } } } } private function dataAfterFilter(&$d·ߜ) { $Cݟ =& $_SERVER[ȦÆ]; foreach ($this->dataAuto as $CȎ) { $cӶ = $CȎ[0]; if (!in_array($Cݟ[351], explode($Cݟ[57], $CȎ[2]))) { continue; } if (!isset($d·ߜ[$cӶ])) { continue; } switch (trim($CȎ[3])) { case $Cݟ[314]: case $Cݟ[315]: $F羲 = isset($CȎ[4]) ? (array) $CȎ[4] : array(); array_unshift($F羲, $d·ߜ[$cӶ]); if ($Cݟ[314] == $CȎ[3]) { $d·ߜ[$cӶ] = call_user_func_array($CȎ[1], $F羲); } else { $d·ߜ[$cӶ] = call_user_func_array(array(&$this, $CȎ[1]), $F羲); } break; case $Cݟ[266]: $d·ߜ[$cӶ] = $d·ߜ[$CȎ[1]]; break; case $Cݟ[287]: $B۷ = $d·ߜ[$cӶ]; $d·ߜ[$cӶ] = json_decode($B۷, !0); if (is_null($d·ߜ[$cӶ])) { $d·ߜ[$cӶ] = $B۷; } break; case $Cݟ[316]: if ($d·ߜ[$cӶ] === $Cݟ[43]) { unset($d·ߜ[$cӶ]); } break; case $Cݟ[317]: $d·ߜ[$cӶ] = $CȎ[1]; default: break; } } } public function saveAll($F) { goto F٨¶; F٨¶: $f =& $_SERVER[ȦÆ]; $e壔 = $this->tablePrefix . $this->tableName; $d緆 = self::SQL_WHERE_IN_CHUNK; goto AȘ; AȘ: $F = is_array($F) ? $F : array(); $Aփ = $f[366]; $eж = 0; goto cꞫ; cꞫ: $b؃۷ = array(); $d޽波 = count($F); for ($A䙶 = 0; $A䙶 < $d޽波; $A䙶++) { $b؆Ꮃ = $F[$A䙶]; if (!is_array($b؆Ꮃ) || count($b؆Ꮃ) != 4) { continue; } $BѼ = "\125\120\104\x41\124\105\40{$e壔}\x20\123\x45\124\x20{$b؆Ꮃ[2]}\x20\75\40\x43\101\x53\105\x20{$b؆Ꮃ[0]}\40\12"; if ($eж == 0) { $Aփ = $BѼ; } $b؃۷[] = $f[122] . $b؆Ꮃ[1] . $f[122]; $eж++; $Aփ .= "\40\127\110\x45\116\x20\47{$b؆Ꮃ[1]}\x27\40\x54\110\x45\116\x20\47{$b؆Ꮃ[3]}\47\x20\12"; if ($eж == $d緆 || $A䙶 == $d޽波 - 1) { goto b; Eí: $b؃۷ = array(); goto Aׂ; d: $eж = 0; $Aփ = $BѼ; $this->chunkEventCheck(count($b؃۷)); goto Eí; b: $b׷ = implode($f[57], $b؃۷); $Aփ .= "\x20\105\116\104\40\40\x57\x48\105\x52\105\x20{$b؆Ꮃ[0]}\x20\111\116\40\50{$b׷}\51\40"; $this->execute($Aփ); goto d; Aׂ: } } goto Bܗɍ; Bܗɍ: $this->chunkEventSet(); goto Bұ; Bұ: } public function saveAllEach($aÉï) { $c찥 =& $_SERVER[ȦÆ]; $c = $this->tablePrefix . $this->tableName; foreach ($aÉï as $d) { if (!is_array($d) || count($d) != 4) { continue; } $cͅ = $d[0] . $c찥[367] . $d[1] . $c찥[122]; $aڅݡ = $d[2] . $c찥[367] . $d[3] . $c찥[122]; $FÕ = "\165\160\144\x61\164\x65\x20{$c}\x20\x73\145\164\x20{$aڅݡ}\x20\x77\x68\145\162\145\40{$cͅ}\73"; $this->execute($FÕ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($dĜ = false, $A = false) { $this->_chunkEvent = $dĜ; $this->_chunkEventParam = $A; } private function chunkEventCheck($cӚ) { if (!$this->_chunkEvent) { return; } $A = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $A[$_SERVER[ȦÆ][368]] = $cӚ; Hook::trigger($this->_chunkEvent, $A); } public function addAll($Cׯ, $A򫓍 = array(), $c = false) { goto B尋冊; eиÍ: if (empty($Cׯ)) { $this->error = think_lang($aޠ[264]); return !1; } $A򫓍 = $this->_parseOptions($A򫓍); foreach ($Cׯ as $Dя => $E) { $Cׯ[$Dя] = $this->_facade($E); $this->_beforeInsert($Cׯ[$Dя], $A򫓍); } goto E̾ӛ; B尋冊: $aޠ =& $_SERVER[ȦÆ]; ignore_timeout(); $a˵ = self::SQL_WHERE_IN_CHUNK; goto eиÍ; E̾ӛ: if (method_exists($this->db, $aޠ[265])) { for ($c񏉅 = 0; $c񏉅 < count($Cׯ); $c񏉅 += $a˵) { $a = array_slice($Cׯ, $c񏉅, $a˵); if (!is_array($a) || count($a) == 0) { break; } $Bͪĵ = $this->db->insertAll($a, $A򫓍, $c); $this->chunkEventCheck(count($a)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Cׯ as $Dя => $E) { $Bͪĵ = $this->db->insert($E, $A򫓍, $c); } $this->commit(); } if (!1 !== $Bͪĵ) { $e = $this->getLastInsID(); if ($e) { return $e; } } return $Bͪĵ; goto Dꥣ; Dꥣ: } public function save($C؟ں = '', $e = array()) { goto dķ̘; A퉔: for ($FĭŤ = 0; $FĭŤ < $C̰Ժ; $FĭŤ += $e) { $eȎЈ = array_slice($f, $FĭŤ, $e); if (!is_array($eȎЈ) || count($eȎЈ) == 0) { break; } $b[$bӠ[268]][$f][1] = $eȎЈ; $this->optionsValue($b); $Aߨۺ += parent::save($C؟ں, $e); $this->chunkEventCheck(count($eȎЈ)); } $this->chunkEventSet(); return $Aߨۺ; goto d; Fɿ: $f = $b[$bӠ[268]][$f][1]; $f = is_array($f) ? $f : array(); $C̰Ժ = count($f); goto A퉔; bۦ: $f = $this->findWhereField($b); if (!$f) { return parent::save($C؟ں, $e); } $Aߨۺ = 0; goto Fɿ; dķ̘: $bӠ =& $_SERVER[ȦÆ]; $e = self::SQL_WHERE_IN_CHUNK; $b = $this->optionsValue(); goto bۦ; d: } public function add($aչ = '', $Fƻ = array(), $dʫ = false) { if ($this->addTaskStatus && is_array($aչ)) { $this->addTaskData[] = $aչ; return; } return parent::add($aչ, $Fƻ, $dʫ); } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($a٘铸 = array()) { goto aب; C̤Ү: $Fݙ߬ = is_array($Fݙ߬) ? $Fݙ߬ : array(); $E = null; for ($B՛ = 0; $B՛ < count($Fݙ߬); $B՛ += $b) { $D = array_slice($Fݙ߬, $B՛, $b); if (!is_array($D) || count($D) == 0) { break; } $eÉ[$E[268]][$C݅][1] = $D; $this->optionsValue($eÉ); $F⑟ = parent::select($a٘铸); if (!$F⑟) { continue; } if (is_null($E)) { $E = array(); } $E = array_merge($E, $F⑟); } goto Dϋ؍; aӄ: $C݅ = $this->findWhereField($eÉ); if (!$C݅ || isset($eÉ[$E[285]]) || isset($eÉ[$E[345]])) { return parent::select($a٘铸); } $Fݙ߬ = $eÉ[$E[268]][$C݅][1]; goto C̤Ү; aب: $E =& $_SERVER[ȦÆ]; $b = self::SQL_WHERE_IN_CHUNK; $eÉ = $this->optionsValue(); goto aӄ; Dϋ؍: return $E; goto bݝ; bݝ: } public function delete($F = array()) { goto d; c͘ܯƋ: $a㇗ = $this->findWhereField($eѸ); if (!$a㇗) { return parent::delete($F); } $D̃ = 0; goto Fփ; d󇧆: return $D̃; goto EѠ; Fփ: $Aڞ = $eѸ[$f炘[268]][$a㇗][1]; $Aڞ = is_array($Aڞ) ? $Aڞ : array(); for ($aÑ缫 = 0; $aÑ缫 < count($Aڞ); $aÑ缫 += $aҾҸ) { $EǗŮ = array_slice($Aڞ, $aÑ缫, $aҾҸ); if (!is_array($EǗŮ) || count($EǗŮ) == 0) { break; } $eѸ[$f炘[268]][$a㇗][1] = $EǗŮ; $this->optionsValue($eѸ); $D̃ += parent::delete($F); } goto d󇧆; d: $f炘 =& $_SERVER[ȦÆ]; $aҾҸ = self::SQL_WHERE_IN_CHUNK; $eѸ = $this->optionsValue(); goto c͘ܯƋ; EѠ: } private function findWhereField($Dڤ) { $f׌ =& $_SERVER[ȦÆ]; $F = self::SQL_WHERE_IN_CHUNK; if (!is_array($Dڤ) || !is_array($Dڤ[$f׌[268]])) { return !1; } foreach ($Dڤ[$f׌[268]] as $F户 => $B䓜) { if (is_array($B䓜) && isset($B䓜[0]) && is_string($B䓜[0]) && strtolower($B䓜[0]) == $f׌[17] && is_array($B䓜[1]) && count($B䓜[1]) > $F) { ignore_timeout(); return $F户; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\x65\155\x4f\160\x74\151\x6f\156"; public $field = array(); public function listData($E = false, $b = "\x6d\157\x64\x69\146\x79\x54\x69\155\145", $Fج = false) { $aϮ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$aϮ) { return $E ? null : array(); } if (!$E) { $aϮ = array_filter(array_values($aϮ)); return array_sort_by($aϮ, $b, $Fج); } return $aϮ[$_SERVER[ȦÆ][369] . $E]; } public function insert($C) { goto aǴ; F̹: $f复 = $f复 ? $f复 : 0; $C[$B[372]] = ++$f复; $C[$B[193]] = time(); goto E׈蝯; dؠႱ: return $f复; goto E; aǴ: $B =& $_SERVER[ȦÆ]; $C = array_field_key($C, $this->field); $f复 = Model($this->modelType)->get($B[370], $this->optionType . $B[371]); goto F̹; E׈蝯: $C[$B[116]] = time(); Model($this->modelType)->set($B[370], $f复, $this->optionType . $B[371]); Model($this->modelType)->set($B[369] . $f复, $C, $this->optionType); goto dؠႱ; E: } public function update($dÕ, $EБ) { goto c݉ɤ; aσ: if (!$f) { return !1; } $EБ = array_merge($f, $EБ); $EБ[$bӲ[116]] = time(); goto bԊ; c݉ɤ: $bӲ =& $_SERVER[ȦÆ]; $EБ = array_field_key($EБ, $this->field); $f = $this->listData($dÕ); goto aσ; bԊ: return Model($this->modelType)->set($bӲ[369] . $dÕ, $EБ, $this->optionType); goto f벌; f벌: } public function remove($D) { return Model($this->modelType)->remove($_SERVER[ȦÆ][369] . $D, $this->optionType); } public function clear() { $C =& $_SERVER[ȦÆ]; Model($this->modelType)->remove($C[370], $this->optionType . $C[371]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($CҖ㹎, $A) { if (!$A) { return !1; } $eǇ = $this->listData(); $eǇ = array_to_keyvalue($eǇ, $CҖ㹎); return isset($eǇ[$A]) ? $eǇ[$A] : !1; } public function findByName($Eɛ) { return $this->findByKey($_SERVER[ȦÆ][38], $Eɛ); } protected function resetData($c㧘С) { $fʂԄ =& $_SERVER[ȦÆ]; $c㧘С = is_array($c㧘С) ? $c㧘С : array(); $a = array(); for ($F߬ = 0; $F߬ < count($c㧘С); $F߬++) { $a[$fʂԄ[369] . $c㧘С[$F߬][$fʂԄ[372]]] = $c㧘С[$F߬]; } return Model($this->modelType)->set($a, !1, $this->optionType); } private function getAutoName($D×ۄ) { $C = array_to_keyvalue($this->listData(), $_SERVER[ȦÆ][38]); if (!$C || !isset($C[$D×ۄ])) { return $D×ۄ; } for ($E = 1; $E < count($C); $E++) { $aƛ = $D×ۄ . "\x28{$E}\51"; if (!isset($C[$aƛ])) { return $aƛ; } } return $aƛ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Dׇ = false, $c = '', $A = false) { goto aل; aɔƷ: $this->cacheSet($c, $b); $b = array_merge($e, $b); return $Dׇ ? $b[$Dׇ] : $b; goto E񑌂; E: $e = is_array($e) ? $e : array(); if (is_array($b)) { $b = array_merge($e, $b); return $Dׇ ? isset($b[$Dׇ]) ? $b[$Dׇ] : null : $b; } $f = $this->filterWhere(array($C[39] => $c)); goto D; aل: $C =& $_SERVER[ȦÆ]; $b = $this->cacheGet($c); $e = $this->optionDefault($c); goto E; D: $b = $this->where($f)->select(); $b = array_to_keyvalue($b, $C[99], $C[364]); foreach ($b as $b => $bȮƈ) { if ($A || in_array($b, $this->jsonField)) { $b[$b] = json_decode($bȮƈ, !0); } } goto aɔƷ; E񑌂: } public function set($Fɿ, $dذ = false, $e = '') { goto EÎ; A֘: $Bö = is_array($Fɿ) ? $Fɿ : array($Fɿ => $dذ); foreach ($Bö as $eѓן => $dچȕ) { if (is_array($dچȕ)) { $dچȕ = json_encode_force($dچȕ); } $this->checkLength($dچȕ, !1, $this->tableName . $E[4] . $Fɿ); $dچȕ = self::textEncode($dچȕ); $Bö = array($E[39] => $e, $E[99] => $eѓן, $E[364] => $dچȕ); $F[] = $this->filterWhere($Bö); } if (!$F) { return !0; } goto C; EÎ: $E =& $_SERVER[ȦÆ]; $this->cacheRemove($e); $F = array(); goto A֘; C: return $this->addAll($F, array(), !0); goto B; B: } protected function optionDefault($e = '') { return !1; } public function setDeep($cʍԊ, $d٘ = false, $f顝 = '') { $e = explode($_SERVER[ȦÆ][101], $cʍԊ); $Bא׌ = $this->get(); array_set_value($Bא׌, $cʍԊ, $d٘); $this->set($e[0], $Bא׌[$e[0]], $f顝); } public function remove($Dͷ, $Cռ = '') { $d =& $_SERVER[ȦÆ]; $this->cacheRemove($Cռ); $CԨ = $this->filterWhere(array($d[99] => $Dͷ, $d[39] => $Cռ)); if (is_null($Dͷ)) { unset($CԨ[$d[99]]); } return $this->where($CԨ)->delete(); } public function cacheSet($fӴٰ, $b¦ = false) { return Cache::set($this->cacheKey($fӴٰ), $b¦); } public function cacheGet($F܄) { return Cache::get($this->cacheKey($F܄)); } public function cacheRemove($DݔК) { return Cache::remove($this->cacheKey($DݔК)); } protected function filterWhere($aՆ) { return $aՆ; } protected function cacheKey($CՕ) { return $CՕ; } } goto eˎ; F۴ӭ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($c) { parent::__construct($c); $this->signatureVersion($_SERVER[ȦÆ][206]); } public function fileOutLink($dćý) { $f܄ɷ =& $_SERVER[ȦÆ]; if (substr($dćý, 0, 7) == $f܄ɷ[1101]) { $dćý = $f܄ɷ[1102] . substr($dćý, 7); } header($f܄ɷ[162] . $dćý); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($e圉) { parent::__construct(); include_once SDK_DIR . $_SERVER[ȦÆ][1157]; $this->_init($e圉); } public function _init($CяÖ) { foreach ($CяÖ as $C흙 => $b) { if (isset($this->{$C흙})) { $this->{$C흙} = $b; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[ȦÆ][1158], !1); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto Dǒ; e: $C->addRule($e); try { $this->client->putBucketCors($this->bucket, $C); } catch (OSS\Core\OssException $bٸ) { return !1; } return !0; goto Bʃ; a: $e->addAllowedMethod($e⢥[1162]); $e->addAllowedMethod($e⢥[1163]); $e->addAllowedMethod($e⢥[161]); goto A; Cȶ: $e->addAllowedOrigin($e⢥[1159]); $e->addAllowedMethod($e⢥[1160]); $e->addAllowedMethod($e⢥[1161]); goto a; Dǒ: $e⢥ =& $_SERVER[ȦÆ]; $C = new OSS\Model\CorsConfig(); $e = new OSS\Model\CorsRule(); goto Cȶ; A: $e->setMaxAgeSeconds(600); $e->addExposeHeader($e⢥[1164]); $e->addAllowedHeader($e⢥[1159]); goto e; Bʃ: } public function getBucketCors() { goto f߳; b̰: $E֐ = $A[0]->getMaxAgeSeconds(); $f = $A[0]->getExposeHeaders(); $dܒ = $A[0]->getAllowedHeaders(); goto aꐇͩ; d񩂗: if (!$A || !($A = $A->getRules())) { return null; } $DϽݍ = $A[0]->getAllowedOrigins(); $cƝũ = $A[0]->getAllowedMethods(); goto b̰; f߳: $Eפ =& $_SERVER[ȦÆ]; $A = null; try { $A = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $B) { return null; } goto d񩂗; aꐇͩ: return array($Eפ[181] => isset($DϽݍ[0]) ? $DϽݍ[0] : $Eפ[43], $Eפ[185] => $cƝũ, $Eפ[1165] => $E֐, $Eפ[1166] => isset($f[0]) ? $f[0] : $Eפ[43], $Eפ[183] => isset($dܒ[0]) ? $dܒ[0] : $Eפ[43]); goto eհ; eհ: } public function isBucketCors() { goto F; F: $E =& $_SERVER[ȦÆ]; $Eߍ = $this->getBucketCors(); if (!$Eߍ || !is_array($Eߍ)) { return !1; } goto E; DǑ: $c捇ߕ = array($E[186], $E[187], $E[188], $E[189], $E[190]); $bʂ = array_diff($c捇ߕ, $e); return empty($bʂ); goto a; E: if ($Eߍ[$E[181]] != $E[182] || $Eߍ[$E[183]] != $E[182]) { return !1; } $e = array_map($E[184], $Eߍ[$E[185]]); if (!is_array($e)) { $e = array(); } goto DǑ; a: } public function mkfile($dӈ, $bÈ = '', $Aϛ͕ = REPEAT_RENAME) { $c = $this->setContent($dӈ, $bÈ); if ($c !== !1) { return $this->getPathOuter($dӈ); } return !1; } public function mkdir($B, $bÂ = REPEAT_SKIP) { if ($this->_isFolder($B)) { return $this->getPathOuter($B); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($B)); } catch (OSS\Core\OssException $fڡې) { return !1; } return $this->getPathOuter($B); } private function fileList($f, $Aٮ = '', $B = 0) { goto Aܯ䍡; d: while (!0) { $D = array($dƦ[1167] => $Aٮ, $dƦ[192] => $bۛ, $dƦ[1168] => $A댂, $dƦ[1169] => $f); try { $eً = $this->client->listObjects($this->bucket, $D); } catch (OSS\Core\OssException $cӌ) { break; } $f = $eً->getNextMarker(); $fך = $eً->getObjectList(); $Dڿ = $eً->getPrefixList(); foreach ($fך as $Bֵ) { if ($Bֵ->getKey() == $bۛ) { continue; } $Aʡյ = $Bֵ->getKey(); if ($B) { $Aʡյ = array($dƦ[38] => $Aʡյ, $dƦ[87] => $Bֵ->getSize(), $dƦ[196] => strtotime($Bֵ->getLastModified())); } $c[] = $Aʡյ; } foreach ($Dڿ as $A٣) { $DΫ[] = $A٣->getPrefix(); } if ($f === $dƦ[43]) { break; } } return array($dƦ[84] => $DΫ, $dƦ[83] => $c); goto C; Aܯ䍡: $dƦ =& $_SERVER[ȦÆ]; $f = trim($f, $dƦ[18]); $bۛ = empty($f) ? $dƦ[43] : $f . $dƦ[18]; goto Cڹ; Cڹ: $f = $dƦ[43]; $A댂 = 1000; $DΫ = $c = array(); goto d; C: } public function copyFile($fݐ, $F΂왇) { $B = $this->size($fݐ); if ($B < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $fݐ, $this->bucket, $this->pathEncode($F΂왇)); } catch (OSS\Core\OssException $fǎ) { return !1; } return !0; } return $this->multiCopyObject($fݐ, $F΂왇, $B); } private function multiCopyObject($FޠƟ, $dҊ҈, $f) { $Bد˳ =& $_SERVER[ȦÆ]; try { goto cׯ; Dޱ: $bտ¥ = 1; $Bꮣ = 0; $aƜ = array(); goto bө; cׯ: $D = array(); if ($cň׌ = $this->hashMd5($FޠƟ)) { $D = array(OSS\OssClient::OSS_HEADERS => array($Bد˳[1170] => $cň׌)); } $e = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($dҊ҈), $D); goto Dޱ; E: $A = array(); foreach ($aƜ as $d => $Dݭ) { $A[] = array($Bد˳[1174] => $d + 1, $Bد˳[1175] => $Dݭ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($dҊ҈), $e, $A); goto Fĳ; bө: $dÉ = 1024 * 1024 * 10; $Cܶ = $this->client->generateMultiuploadParts($f, $dÉ); foreach ($Cܶ as $d => $Aܞ) { $d = $Bꮣ + (int) $Aܞ[$Bد˳[1171]]; $e = (int) $Aܞ[$Bد˳[330]] + $d - 1; $c盄Ո = array($Bد˳[1172] => $d, $Bد˳[1173] => $e); $aƜ[] = $this->client->uploadPartCopy($this->bucket, $FޠƟ, $this->bucket, $this->pathEncode($dҊ҈), $bտ¥, $e, $c盄Ո); $bտ¥ = $bտ¥ + 1; } goto E; Fĳ: } catch (OSS\Core\OssException $F) { return !1; } return !0; } public function moveFile($B޾, $DӍƒ) { if ($this->copyFile($B޾, $DӍƒ)) { $this->remove($B޾); return !0; } return !1; } public function delFile($CƇ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($CƇ)); } catch (OSS\Core\OssException $Aԉ) { return !1; } return !0; } public function delFolder($D) { $e =& $_SERVER[ȦÆ]; $Aˋꂿ = $this->fileList($D); if (!empty($D) && !in_array(trim($D, $e[18]) . $e[18], $Aˋꂿ[$e[83]])) { $Aˋꂿ[$e[83]][] = trim($D, $e[18]) . $e[18]; } foreach (array_chunk($Aˋꂿ[$e[83]], 1000) as $A󰃉) { try { $this->client->deleteObjects($this->bucket, $A󰃉); } catch (OSS\Core\OssException $eƉ) { continue; } } return !0; } public function rename($Fھ, $E) { return $this->renameObject($Fھ, $E); } private function fileInfo($cǴҋ, $e = array()) { goto CÉ; F݅: return $bɒ; goto E; aɆה: if (isset($e[$dԻ[87]])) { $bɒ[$dԻ[87]] = $e[$dԻ[87]]; } if (isset($e[$dԻ[116]])) { $bɒ[$dԻ[116]] = $e[$dԻ[116]]; } if (isset($e[$dԻ[196]]) && !trim($bɒ[$dԻ[116]])) { $bɒ[$dԻ[116]] = $e[$dԻ[196]]; } goto F݅; CÉ: $dԻ =& $_SERVER[ȦÆ]; $bɒ = array($dԻ[38] => $this->pathThis($cǴҋ), $dԻ[85] => $this->getPathOuter($cǴҋ), $dԻ[39] => $dԻ[173], $dԻ[193] => 0, $dԻ[116] => 0, $dԻ[87] => 0, $dԻ[166] => $this->ext($cǴҋ), $dԻ[194] => !0, $dԻ[195] => !0); if (empty($e)) { $Bҭ = $this->objectMeta($cǴҋ); if (!$Bҭ) { return $bɒ; } $e = array($dԻ[116] => strtotime($Bҭ[$dԻ[1176]]), $dԻ[87] => $Bҭ[$dԻ[1177]] + 0); } goto aɆה; E: } private function folderInfo($C, $b٣ = array()) { $CΒ =& $_SERVER[ȦÆ]; $b͚Đ = array($CΒ[38] => $this->pathThis($C), $CΒ[85] => $this->getPathOuter($CΒ[18] . $C), $CΒ[39] => $CΒ[86], $CΒ[193] => 0, $CΒ[116] => 0, $CΒ[194] => !0, $CΒ[195] => !0); if (empty($b٣)) { $C = rtrim($C, $CΒ[18]) . $CΒ[18]; $E֨ = $this->objectMeta($C); if (!$E֨) { return $b͚Đ; } $b٣ = array($CΒ[193] => $E֨[$CΒ[1178]][$CΒ[1179]], $CΒ[116] => strtotime($E֨[$CΒ[1176]])); } if (isset($b٣[$CΒ[116]])) { $b͚Đ[$CΒ[116]] = $b٣[$CΒ[116]]; } if (isset($b٣[$CΒ[193]])) { $b͚Đ[$CΒ[193]] = $b٣[$CΒ[193]]; } return $b͚Đ; } public function listPath($BÕ, $bڣ = false) { $aª =& $_SERVER[ȦÆ]; $fҨ = $this->fileList($BÕ, $aª[18], !0); foreach ($fҨ[$aª[84]] as $Cʹڪ => $b̤臨) { $fҨ[$aª[84]][$Cʹڪ] = $this->folderInfo($b̤臨, $b̤臨); } foreach ($fҨ[$aª[83]] as $Cʹڪ => $b̤臨) { $fҨ[$aª[83]][$Cʹڪ] = $this->fileInfo($b̤臨[$aª[38]], $b̤臨); } return $fҨ; } public function has($C͖, $Dҍ = false, $B = true) { goto A; cƕ: return !1; goto Eͦ; F轼: $c墋 = 0; while (!0) { $Dۄ = array($C[1167] => $C[18], $C[192] => $dݥ, $C[1168] => $A䍙, $C[1169] => $F); try { $A = $this->client->listObjects($this->bucket, $Dۄ); } catch (OSS\Core\OssException $a솣) { break; } $F = $A->getNextMarker(); $a = $A->getObjectList(); $Eǰ = $A->getPrefixList(); if ($Dҍ) { if (count($a) > 1 || count($a) == 1 && $a[0]->getKey() != $dݥ) { $F += count($a) - 1; } if (!empty($Eǰ)) { $c墋 += count($Eǰ); } if ($F === $C[43]) { break; } continue; } if ($B) { if (!empty($a)) { if (count($a) > 1 || $a[0]->getKey() != $dݥ) { return !0; } } } else { if (!empty($Eǰ)) { return !0; } } if ($F === $C[43]) { break; } } if ($Dҍ) { return array($C[197] => $F, $C[198] => $c墋); } goto cƕ; A: $F = $C[43]; $A䍙 = 500; $F = 0; goto F轼; A: $C =& $_SERVER[ȦÆ]; $C͖ = trim($C͖, $C[18]); $dݥ = empty($C͖) ? $C[43] : $C͖ . $C[18]; goto A; Eͦ: } public function listAll($F۰) { $Dڈ =& $_SERVER[ȦÆ]; $D = $this->fileList($F۰, $Dڈ[43], !0); $bЯ檵 = array(); foreach ($D[$Dڈ[83]] as $b횕) { $bЯ檵[$b횕[$Dڈ[38]]] = $b횕[$Dڈ[87]]; } return $this->listAllFiles($F۰, array_keys($bЯ檵), $bЯ檵); } public function canRead($e) { $Bݱ =& $_SERVER[ȦÆ]; $F = $this->pathAcl($e); return $F == $Bݱ[1180] || $F == $Bݱ[496] ? !0 : !1; } public function canWrite($eҢ) { $Aÿ = $this->pathAcl($eҢ); return $Aÿ == $_SERVER[ȦÆ][496] ? !0 : !1; } public function pathAcl($e͜) { goto cʂȟ; Aם: return $B߼; goto FҎƻ; cʂȟ: $F =& $_SERVER[ȦÆ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $C = $this->client->getObjectAcl($this->bucket, $this->pathEncode($e͜)); } catch (OSS\Core\OssException $AĠ) { return !1; } goto A鹅; A鹅: $B߼ = $C == $F[44] ? $this->bucketAcl : $C; if ($B߼ == $F[1181]) { return $F[1180]; } if ($B߼ == $F[1182]) { return $F[496]; } goto Aם; FҎƻ: } private function chmodPath($fè, $eۻ = '') { $Dſ =& $_SERVER[ȦÆ]; $F̎ = empty($eۻ) ? $Dſ[1182] : $eۻ; $bů = array($Dſ[44], $Dſ[191], $Dſ[1181], $Dſ[1182]); if (!in_array($F̎, $bů)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($fè), $F̎); } catch (OSS\Core\OssException $d铥ۼ) { return !1; } return !0; } public function getContent($E湠) { return $this->fileSubstr($E湠, -1); } public function setContent($A, $D񇓎 = '') { $c =& $_SERVER[ȦÆ]; try { $Bи = $this->trafficLimit($c[1183]); $FҖ = $this->client->putObject($this->bucket, $this->pathEncode($A), $D񇓎, $Bи); } catch (OSS\Core\OssException $E᪃) { return !1; } $a = array($c[1170] => trim($FҖ[$c[1184]], $c[122]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($A))); $this->updateObjMeta($A, $a); return isset($FҖ[$c[1185]][$c[1131]]) ? (int) $FҖ[$c[1185]][$c[1131]] : strlen($FҖ); } private function updateObjMeta($aΊ, $D䜾) { $aΊ = $this->pathEncode($aΊ); try { $Cɭ = array(OSS\OssClient::OSS_HEADERS => $D䜾); $this->client->copyObject($this->bucket, $aΊ, $this->bucket, $aΊ, $Cɭ); } catch (OSS\Core\OssException $fƎۯ) { return !1; } return !0; } public function upload($B䔂, $B, $B΋Û = false, $dȥ = REPEAT_REPLACE) { $C⥞ۮ =& $_SERVER[ȦÆ]; $Bݔ = trim($B䔂, $C⥞ۮ[18]); $bӌ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($C⥞ۮ[1170] => @md5_file($B)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($B䔂))); $bӌ = $this->trafficLimit($C⥞ۮ[1183], $bӌ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Bݔ), $B, $bӌ); } catch (OSS\Core\OssException $fׅ) { return !1; } return $this->getPathOuter($B䔂); } public function getHost() { $E =& $_SERVER[ȦÆ]; $c = explode($E[177], parent::getHost()); return $c[0] . $E[177] . $this->bucket . $E[101] . $c[1]; } public function uploadFormData($b֖, $dϩʍ = 3600) { goto bಿ΅; bಿ΅: $CѦ =& $_SERVER[ȦÆ]; if (!($Aߣ = $this->getHost())) { return !1; } $B˓ = $dϩʍ; goto E; C묠: $Cх = $this->pathFather($b֖); $B = array($CѦ[1088] => $eΖ, $CѦ[1089] => array(array($CѦ[1188], 0, $c), array($CѦ[1092], $CѦ[1093], $Cх))); $b = base64_encode(json_encode($B)); goto B٤; B٤: $A좏 = base64_encode(hash_hmac($CѦ[223], $b, $this->secret, !0)); $b̐ = array($CѦ[1098] => $b, $CѦ[1189] => $this->accessKey, $CѦ[1094] => $CѦ[1086], $CѦ[1190] => $A좏, $CѦ[175] => $Aߣ); $b̐ = $this->trafficLimit($CѦ[1183], $b̐); goto E԰; E԰: return $b̐; goto c; E: $a招´ = date($CѦ[1186], time() + $B˓); $d̻넊 = new DateTime($a招´); $eΖ = $d̻넊->format(DateTime::ISO8601); goto A; A: $bՃɦ = strpos($eΖ, $CѦ[289]); $eΖ = substr($eΖ, 0, $bՃɦ) . $CѦ[1187]; $c = 1048576000 * 5; goto C묠; c: } public function multiUploadFormData($dǉ, $bʝ = 3600) { $Fӓ =& $_SERVER[ȦÆ]; if (!($EҘ = $this->getHost())) { return !1; } $b = $this->trafficLimit($Fӓ[1183]); $dֳ͚ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($dǉ), $b); return array($Fӓ[215] => $dֳ͚, $Fӓ[175] => $EҘ . $Fӓ[18] . $this->pathEncode($dǉ), $Fӓ[216] => gmdate($Fӓ[1191]), $Fӓ[99] => $dǉ); } public function multiUploadAuthData($cƼф, $Cҿ = array()) { goto bߴ; dߓ: $dա = $DЃ[1194] . $this->accessKey . $DЃ[4] . $C¹; if (strpos($a듅, $DЃ[219]) === 0) { $dա = array($DЃ[225] => $dա, $DЃ[216] => $Fֲ); if ($Eǿ) { $dա = array_merge($dա, $Eǿ); } } return $dա; goto dӱو; F: $fȯ = $cƼф; if (isset($Cҿ[$DЃ[99]])) { $fȯ = $Cҿ[$DЃ[99]]; unset($Cҿ[$DЃ[99]]); } if (isset($Cҿ[$DЃ[217]])) { $Cҿ[$DЃ[216]] = $Fֲ; return $this->listUploadParts($fȯ, $Cҿ); } goto b; b: $Dݻ = array($DЃ[218], $DЃ[43], $DЃ[125], $Fֲ, "\170\55\157\163\163\55\144\141\164\x65\72{$Fֲ}", $DЃ[18] . $this->bucket . $DЃ[18] . $fȯ . $a듅); if (strpos($a듅, $DЃ[219]) === 0) { $Dݻ[0] = $DЃ[220]; if ($Eǿ = $this->trafficLimit($DЃ[1183])) { $fȯ = $DЃ[1192]; array_splice($Dݻ, 5, 0, $fȯ . $DЃ[4] . $Eǿ[$fȯ]); } } if (isset($Cҿ[$DЃ[221]]) && $Cҿ[$DЃ[221]] == $DЃ[222]) { $Dݻ[0] = $DЃ[222]; } goto eĄ; eĄ: if (!empty($Cҿ[$DЃ[1193]])) { $Dژ = array_merge(array($Dݻ[4]), $Cҿ[$DЃ[1193]]); sort($Dژ); $Dݻ[4] = implode($DЃ[12], $Dژ); } $bݨ = implode($DЃ[12], $Dݻ); $C¹ = base64_encode(hash_hmac($DЃ[223], $bݨ, $this->secret, !0)); goto dߓ; bߴ: $DЃ =& $_SERVER[ȦÆ]; $Fֲ = isset($Cҿ[$DЃ[216]]) ? $Cҿ[$DЃ[216]] : gmdate($DЃ[1191]); $a듅 = isset($Cҿ[$DЃ[166]]) ? $Cҿ[$DЃ[166]] : $DЃ[43]; goto F; dӱو: } public function listUploadParts($eľ㕾, $e) { goto Bıؑ; FԲ롯: unset($e[$e臝[217]], $e[$e臝[221]]); $Aʨ = $this->multiUploadAuthData($eľ㕾, $e); if (empty($Aʨ)) { return !1; } goto dȪՑ΄; fǋ֕: $e = $cТ陛->getListPart(); $dƟň = array(); foreach ($e as $fߌ) { $dƟň[] = array($e臝[1174] => $fߌ->getPartNumber(), $e臝[1175] => trim($fߌ->getETag(), $e臝[122])); } goto FԲ롯; Bıؑ: $e臝 =& $_SERVER[ȦÆ]; $bԲ = parse_url_query($e[$e臝[166]]); $cТ陛 = $this->client->listParts($this->bucket, $this->pathEncode($eľ㕾), $bԲ[$e臝[215]]); goto fǋ֕; dȪՑ΄: return array($e臝[225] => $Aʨ, $e臝[216] => $e[$e臝[216]], $e臝[227] => $dƟň); goto Fн; Fн: } public function download($F񂔂, $AհǢ) { if ($this->isFolder($F񂔂)) { return !1; } try { $a = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $AհǢ); $a = $this->trafficLimit($_SERVER[ȦÆ][114], $a); $this->client->getObject($this->bucket, $this->pathEncode($F񂔂), $a); } catch (OSS\Core\OssException $E޿) { return !1; } return $AհǢ; } public function fileSubstr($Aن, $a = 0, $d߉ = false) { if ($a === -1) { $c낉 = array(); } else { if ($d߉ === !1) { $eˌ = $this->size($Aن); } else { $eˌ = $a + $d߉ - 1; } $c낉 = array(OSS\OssClient::OSS_RANGE => "{$a}\x2d{$eˌ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Aن), $c낉); } catch (OSS\Core\OssException $a) { think_exception($a->getMessage()); return !1; } } private function trafficLimit($D䮡, $f = array()) { goto DĠ; Bơ: return $f; goto b㐈; DĠ: $fߏ =& $_SERVER[ȦÆ]; if ($D䮡 == $fߏ[1183] && $this->isUploadServer() || $D䮡 == $fߏ[114] && $this->isFileOutServer()) { return $f; } $Fޜ = floatval($GLOBALS[$fߏ[16]][$fߏ[94]][$fߏ[112]][$D䮡]) * 1024 * 1024 * 8; goto F͕; F͕: if (!$Fޜ) { return $f; } $Fޜ = $Fޜ < 819200 ? 819200 : ($Fޜ > 838860800 ? 838860800 : $Fޜ); $f[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Fޜ); goto Bơ; b㐈: } public function link($Dǲ, $c = array()) { $D𫍄 =& $_SERVER[ȦÆ]; if (!$this->exist($Dǲ) || $this->isFolder($Dǲ)) { return !1; } try { $c = $this->trafficLimit($D𫍄[114], $c); $AƨЮ = $this->client->signUrl($this->bucket, $this->pathEncode($Dǲ), 3600 * 12, $D𫍄[222], $c); return $this->getCdnLink($AƨЮ); } catch (OSS\Core\OssException $A舶) { return !1; } } public function fileOut($c®܏, $EѸ = false, $fڄ̇ = false, $a = '') { goto CИ; d: $C = array(OSS\OssClient::OSS_SUB_RESOURCE => $C[1195] . rawurlencode("{$EѸ}\x3b\x66\151\x6c\x65\x6e\x61\x6d\x65\75{$fڄ̇}")); $C[OSS\OssClient::OSS_SUB_RESOURCE] .= $C[1196] . rawurlencode($aʺ); $fך = $this->link($c®܏, $C); goto f; f: $this->fileOutLink($fך); goto b蹂; c뿲: $aʺ = get_file_mime(get_path_ext($fڄ̇)); if ($aʺ == $C[207]) { return parent::fileOut($c®܏, $EѸ, $fڄ̇, $a); } $EѸ = $EѸ ? $C[208] : $C[209]; goto d; CИ: $C =& $_SERVER[ȦÆ]; if (!$fڄ̇) { $fڄ̇ = $this->pathThis($c®܏); } $fڄ̇ = rawurlencode($fڄ̇); goto c뿲; b蹂: } public function fileOutServer($aɪ, $c = false, $bז = false, $D깂ё = '') { parent::fileOut($aɪ, $c, $bז, $D깂ё); } public function fileOutImage($A咈, $dĺҋ = 250) { $dؼ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ȦÆ][1197] . $dĺҋ); $a = $this->link($A咈, $dؼ); $this->fileOutLink($a); } public function fileOutImageServer($Bĥޭ, $C = 250) { parent::fileOutImage($Bĥޭ, $C); } public function fileOutLink($BԐ) { $C =& $_SERVER[ȦÆ]; if (!$this->isCdnHost() && substr($BԐ, 0, 7) == $C[1101]) { $BԐ = $C[1102] . substr($BԐ, 7); } header($C[162] . $BԐ); die; } public function hashMd5($Fͧ, $e۠ϙ = '') { $E֋ =& $_SERVER[ȦÆ]; $eꄝ = $this->objectMeta($Fͧ); if (!$eꄝ) { return $E֋[43]; } if (!isset($eꄝ[$E֋[1170]]) && !empty($e۠ϙ)) { $Aԉ = $this->updateObjMeta($Fͧ, array($E֋[1170] => $e۠ϙ)); $eꄝ[$E֋[1170]] = $Aԉ ? $e۠ϙ : $E֋[43]; } return isset($eꄝ[$E֋[1170]]) ? strtolower($eꄝ[$E֋[1170]]) : $E֋[43]; } public function size($Cц) { $dү = $this->objectMeta($Cц); return $dү ? $dү[$_SERVER[ȦÆ][87]] : 0; } public function info($DƄ) { if ($this->isFolder($DƄ)) { return $this->folderInfo($DƄ); } else { if ($this->isFile($DƄ)) { return $this->fileInfo($DƄ); } } return !1; } public function exist($cϕ) { return $this->isFile($cϕ) || $this->isFolder($cϕ); } public function isFile($dۭ) { return !$this->isFolder($dۭ) && $this->objectMeta($dۭ); } public function isFolder($e˞) { return $this->cacheMethod($_SERVER[ȦÆ][228], $e˞); } protected function objectMeta($D͆) { return $this->cacheMethod($_SERVER[ȦÆ][229], $D͆); } protected function _objectMeta($D킓ٌ) { $b͑ =& $_SERVER[ȦÆ]; try { $fߦ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($D킓ٌ)); } catch (OSS\Core\OssException $b) { $fߦ = !1; } if ($fߦ) { $fߦ[$b͑[87]] = intval($fߦ[$b͑[1177]]); } return $fߦ; } protected function _isFolder($f̗ᜢ) { $FǾ̄ =& $_SERVER[ȦÆ]; if ($f̗ᜢ == $FǾ̄[43] || $f̗ᜢ == $FǾ̄[18]) { return !0; } $A뎇 = array($FǾ̄[1167] => $FǾ̄[18], $FǾ̄[192] => rtrim($f̗ᜢ, $FǾ̄[18]) . $FǾ̄[18], $FǾ̄[1168] => 1, $FǾ̄[1169] => $FǾ̄[43]); $CֳЊ = $this->client->listObjects($this->bucket, $A뎇); if ($CֳЊ->getObjectList() || $CֳЊ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($F) { parent::__construct(); require_once SDK_DIR . $_SERVER[ȦÆ][1198]; $this->_init($F); } public function _init($fϳ) { foreach ($fϳ as $a => $DѣϏ) { if (isset($this->{$a})) { $this->{$a} = $DѣϏ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[ȦÆ][1199], !1); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($BԌ, $e = '', $BιŢ = REPEAT_RENAME) { if ($this->setContent($BԌ, $e)) { return $this->getPathOuter($BԌ); } return !1; } public function mkdir($f淇, $F｡ = REPEAT_SKIP) { goto d; d秂: if (!$this->mkfile($c)) { return !1; } if (!$this->moveFile($c, $f淇)) { $this->delFile($c); return !1; } return $this->getPathOuter($A뛖ܤ); goto e᭘; d: $aĊ˒ =& $_SERVER[ȦÆ]; $A뛖ܤ = trim($f淇, $aĊ˒[18]); if ($this->_isFolder($A뛖ܤ)) { return $this->getPathOuter($A뛖ܤ); } goto Cһ߃; Cһ߃: $f淇 = $A뛖ܤ . $aĊ˒[18]; $eꗼŬ = get_path_this($A뛖ܤ); $c = $f淇 . $eꗼŬ; goto d秂; e᭘: } public function copyFile($d絎, $c) { $Dի = $this->bucketManager->copy($this->bucket, $d絎, $this->bucket, $c, !0); return $Dի ? !1 : !0; } public function moveFile($f̶, $Cꆶ߹) { $C = $this->bucketManager->move($this->bucket, $f̶, $this->bucket, $Cꆶ߹, !0); return $C ? !1 : !0; } public function delFile($Aχ) { $Bիᣨ = $this->bucketManager->delete($this->bucket, $Aχ); return $Bիᣨ ? !1 : !0; } public function delFolder($bݸ) { $A = $this->fileList($bݸ); if (empty($A)) { return !0; } $Cõê = 1000; if (count($A) <= $Cõê) { return $this->qnDelObj($A) ? !1 : !0; } foreach (array_chunk($A, $Cõê) as $fݪ㓕) { $bӞ = $this->qnDelObj($fݪ㓕); if ($bӞ) { return !1; } } return !0; } private function qnDelObj($FȊ΄) { $c = $this->bucketManager->buildBatchDelete($this->bucket, $FȊ΄); list($f, $aޟ) = $this->bucketManager->batch($c); return $aޟ; } private function fileList($c, $D = 0) { goto D; A: $D̈ = array(); while (!0) { list($d۫, $e) = $this->bucketManager->listFiles($this->bucket, $eĚ, $BҎ, $Cʉغ, $fĻ); if ($e) { return !1; } $BҎ = array_key_exists($b͡[1169], $d۫) ? $BҎ = $d۫[$b͡[1200]] : $b͡[43]; foreach ($d۫[$b͡[1201]] as $A৉) { $b俚 = $A৉[$b͡[99]]; if ($D) { $b俚 = array($b͡[38] => $b俚, $b͡[87] => $A৉[$b͡[1202]]); } $D̈[] = $b俚; } if ($BҎ == $b͡[43]) { break; } } return $D̈; goto eޅ; D: $b͡ =& $_SERVER[ȦÆ]; $c = trim($c, $b͡[18]); $eĚ = empty($c) ? $b͡[43] : $c . $b͡[18]; goto Fݦ썸; Fݦ썸: $BҎ = $b͡[43]; $Cʉغ = 1000; $fĻ = $b͡[43]; goto A; eޅ: } public function rename($b, $C҈) { return $this->renameObject($b, $C҈); } public function fileInfo($a, $b = false, $D = array()) { goto e𮷼; b: return $B뮱; goto bؚ; e𮷼: $d =& $_SERVER[ȦÆ]; if ($b) { return array($d[38] => $this->pathThis($a), $d[85] => $this->getPathOuter($d[18] . $a), $d[39] => $d[173], $d[87] => isset($D[$d[1202]]) ? $D[$d[1202]] : 0, $d[166] => $this->ext($a)); } $B뮱 = array($d[38] => $this->pathThis($a), $d[85] => $this->getPathOuter($d[18] . $a), $d[39] => $d[173], $d[193] => 0, $d[116] => 0, $d[87] => 0, $d[166] => $this->ext($a), $d[194] => !0, $d[195] => !0); goto CƄ; CƄ: if (empty($D)) { $D = $this->objectMeta($a); if (!$D) { return $B뮱; } } if (isset($D[$d[1203]])) { $B뮱[$d[193]] = $D[$d[1203]]; } if (isset($D[$d[1202]])) { $B뮱[$d[87]] = $D[$d[1202]]; } goto b; bؚ: } public function folderInfo($aÎ, $dǌ = false) { goto Bߥޯ; Bߥޯ: $e͇ˠ =& $_SERVER[ȦÆ]; if ($dǌ) { return array($e͇ˠ[38] => $this->pathThis($aÎ), $e͇ˠ[85] => $this->getPathOuter($e͇ˠ[18] . $aÎ), $e͇ˠ[39] => $e͇ˠ[86]); } $Fߐ褏 = array($e͇ˠ[38] => $this->pathThis($aÎ), $e͇ˠ[85] => $this->getPathOuter($e͇ˠ[18] . $aÎ), $e͇ˠ[39] => $e͇ˠ[86], $e͇ˠ[193] => 0, $e͇ˠ[116] => 0, $e͇ˠ[1147] => !0, $e͇ˠ[1148] => !0); goto F꾄; F꾄: $aÎ = rtrim($aÎ, $e͇ˠ[18]) . $e͇ˠ[18]; $A识 = $this->objectMeta($aÎ); if (isset($A识[$e͇ˠ[1203]])) { $Fߐ褏[$e͇ˠ[193]] = $A识[$e͇ˠ[1203]]; } goto C܎; C܎: return $Fߐ褏; goto D; D: } public function listPath($eɞ򱞽, $F = false) { goto f꿹; B: $B俇 = $Cĝ = array(); while (!0) { list($A󤻎, $Dˢ瓐) = $this->bucketManager->listFiles($this->bucket, $d߅ß, $F☂, $d, $fϕ); if ($Dˢ瓐) { return !1; } $F☂ = array_key_exists($FŦ[1169], $A󤻎) ? $F☂ = $A󤻎[$FŦ[1200]] : $FŦ[43]; if (isset($A󤻎[$FŦ[1204]])) { foreach ($A󤻎[$FŦ[1204]] as $C) { if ($C == $d߅ß) { continue; } $B俇[] = $this->folderInfo($C, $F); } } if (isset($A󤻎[$FŦ[1201]])) { foreach ($A󤻎[$FŦ[1201]] as $aϰ⡩) { if ($aϰ⡩[$FŦ[99]] == $d߅ß) { continue; } $Cĝ[] = $this->fileInfo($aϰ⡩[$FŦ[99]], $F, $aϰ⡩); } } if ($F☂ == $FŦ[43]) { break; } } return array($FŦ[84] => $B俇, $FŦ[83] => $Cĝ); goto cɅ̟; f꿹: $FŦ =& $_SERVER[ȦÆ]; $eɞ򱞽 = trim($eɞ򱞽, $FŦ[18]); $d߅ß = empty($eɞ򱞽) ? $FŦ[43] : $eɞ򱞽 . $FŦ[18]; goto c; c: $F☂ = $FŦ[43]; $d = 1000; $fϕ = $FŦ[18]; goto B; cɅ̟: } public function has($B֏瑍, $bȯ = false, $Eڣ = true) { goto A׾; D¼: $B = $eæ̭[43]; $d = 1000; $Aߐ = $eæ̭[18]; goto fЮ; Eݵ: if ($bȯ) { return array($eæ̭[197] => $a, $eæ̭[198] => $c); } return !1; goto D; A׾: $eæ̭ =& $_SERVER[ȦÆ]; $B֏瑍 = trim($B֏瑍, $eæ̭[18]); $fȫְ = empty($B֏瑍) ? $eæ̭[43] : $B֏瑍 . $eæ̭[18]; goto D¼; fЮ: $a = 0; $c = 0; while (!0) { list($Aӆː, $bƎ) = $this->bucketManager->listFiles($this->bucket, $fȫְ, $B, $d, $Aߐ); if ($bƎ) { return !1; } $B = array_key_exists($eæ̭[1169], $Aӆː) ? $B = $Aӆː[$eæ̭[1200]] : $eæ̭[43]; if ($bȯ) { if (!empty($Aӆː[$eæ̭[1201]])) { $a += count($Aӆː[$eæ̭[1201]]); } if (!empty($Aӆː[$eæ̭[1204]])) { $c += count($Aӆː[$eæ̭[1204]]); } if ($B === $eæ̭[43]) { break; } continue; } if ($Eڣ) { if (!empty($Aӆː[$eæ̭[1201]])) { return !0; } } else { if (!empty($Aӆː[$eæ̭[1204]])) { return !0; } } if ($B == $eæ̭[43]) { break; } } goto Eݵ; D: } public function listAll($cę) { $F߾ =& $_SERVER[ȦÆ]; $C = $this->fileList($cę, 1); $f׿ = array(); foreach ($C as $Bљ) { $f׿[$Bљ[$F߾[38]]] = $Bљ[$F߾[87]]; } return $this->listAllFiles($cę, array_keys($f׿), $f׿); } public function canRead($EƉ) { return $this->exist($EƉ) ? !0 : !1; } public function canWrite($fȐ) { return $this->exist($fȐ) ? !0 : !1; } public function getContent($c۩) { return $this->fileSubstr($c۩, 0, -1); } public function setContent($dۇׄ, $dш = '') { $cݶ = $this->tempFile($this->pathThis($dۇׄ)); file_put_contents($cݶ, $dш); if ($this->upload($dۇׄ, $cݶ)) { $this->tempFileRemve($cݶ); return !0; } return !1; } public function refreshUrls($b؂) { goto cɎ; cɎ: $e֧ǧɪ =& $_SERVER[ȦÆ]; $f寧 = array(); if (is_array($b؂)) { foreach ($b؂ as $D͡) { $f寧[] = $this->link($D͡); } } else { $f寧[] = $this->link($b؂); } goto D縏; eﷂ: return $d[$e֧ǧɪ[1205]] == $e֧ǧɪ[697] ? !0 : !1; goto B; D縏: $F͇ = new Qiniu\Cdn\CdnManager($this->auth); list($d, $B֪ڽ) = $F͇->refreshUrls($f寧); if ($B֪ڽ) { return !1; } goto eﷂ; B: } public function fileSubstr($b, $aϺؤ, $DϪ) { $cڛ =& $_SERVER[ȦÆ]; if (!($aׄҽ = $this->link($b))) { return !1; } $BǍ = !1; if ($DϪ > 0) { $DÍÃ = $aϺؤ + $DϪ - 1; $BǍ = array($cڛ[1206] . $aϺؤ . $cڛ[417] . $DÍÃ); } $C = url_request($aׄҽ, $cڛ[222], !1, $BǍ); return $C[$cڛ[690]] ? $C[$cڛ[1027]] : !1; } public function upload($d, $b, $BڠƱÇ = false, $Dڼ = REPEAT_REPLACE) { $dƫ = new Qiniu\Storage\UploadManager(); $f = $this->auth->uploadToken($this->bucket, $d); $b = get_file_mime(get_path_ext($b)); list($dӎ, $E׷) = $dƫ->putFile($f, $d, $b, null, $b); return $E׷ ? !1 : $this->getPathOuter($d); } public function uploadFormData($Aٌ, $C = 3600) { return $this->uploadToken($Aٌ, $C); } public function multiUploadFormData($eǉ, $bݗچ = 3600) { return $this->uploadToken($eǉ, $bݗچ); } private function uploadToken($bЧۜ, $Fϊ = 3600) { goto d; Aꤚ: $f = null; $c栎 = $this->auth->uploadToken($this->bucket, $f, $F, $c, !0); $bą = empty($this->region) || $this->region == $DٓƖ[1209] ? $DٓƖ[43] : $DٓƖ[417] . $this->region; goto BƆǵ; BƆǵ: $C̽ = http_type() . "\x3a\x2f\x2f\165\160\x6c\157\141\x64{$bą}\56\161\x69\156\151\x75\160\56\143\x6f\155\57"; return array($DٓƖ[1210] => $c栎, $DٓƖ[1211] => $C̽); goto aևۊ; d: $DٓƖ =& $_SERVER[ȦÆ]; $F = $Fϊ; $c = array($DٓƖ[1207] => $DٓƖ[1208]); goto Aꤚ; aևۊ: } public function download($F, $a) { goto a; a: $BϓĂ = IO::getPathInner(IO::mkfile($a)); if (!($FӪ = $this->link($F))) { return !1; } $a = 0; goto aΚ; a: fclose($Bь); return $a; goto c; aΚ: $a = 1024 * 200; $Bь = fopen($BϓĂ, $_SERVER[ȦÆ][1212]); while (!0) { $F푦 = $this->fileSubstr($F, $a, $a); if ($F푦 === !1) { return !1; } fwrite($Bь, $F푦); $a += $a; if (strlen($F푦) < $a) { break; } } goto a; c: } public function link($F뻣墵, $A = '') { if (!$this->isFile($F뻣墵)) { return !1; } $a = $this->getHost() . $_SERVER[ȦÆ][18] . $this->pathEncode($F뻣墵) . $A; return $this->auth->privateDownloadUrl($a, 3600 * 12); } public function fileOut($Dϙ, $BҔ = false, $Dߩ޵ = false, $eǌ = '') { $eВ =& $_SERVER[ȦÆ]; if (!$Dߩ޵) { $Dߩ޵ = $this->pathThis($Dϙ); } $fܓ = $BҔ ? $eВ[1213] . rawurlencode($Dߩ޵) : $eВ[43]; $c = $this->link($Dϙ, $fܓ); $this->fileOutLink($c); } public function fileOutServer($B, $a䅙՝ = false, $Eļ = false, $a͂ = '') { parent::fileOut($B, $a䅙՝, $Eļ, $a͂); } public function fileOutImage($bě۾, $DӢ = 250) { $eᑑ = $this->link($bě۾, $_SERVER[ȦÆ][1214] . $DӢ); $this->fileOutLink($eᑑ); } public function fileOutImageServer($A䣂, $cШ = 250) { parent::fileOutImage($A䣂, $cШ); } public function hashMd5($Dƙ) { $bȾ =& $_SERVER[ȦÆ]; $cϱ = $this->objectMeta($Dƙ); return isset($cϱ[$bȾ[202]]) ? $cϱ[$bȾ[202]] : !1; $a쟓 = $this->link($Dƙ, $bȾ[1215]); } public function size($f³˙) { $F = $this->objectMeta($f³˙); return $F ? $F[$_SERVER[ȦÆ][87]] : 0; } public function info($dƨ) { if ($this->isFolder($dƨ)) { return $this->folderInfo($dƨ); } else { if ($this->isFile($dƨ)) { return $this->fileInfo($dƨ); } } return !1; } public function exist($Fދ) { return $this->isFile($Fދ) || $this->isFolder($Fދ); } public function isFile($fŶ) { return !$this->isFolder($fŶ) && $this->objectMeta($fŶ); } public function isFolder($eѼ) { return $this->cacheMethod($_SERVER[ȦÆ][228], $eѼ); } protected function objectMeta($ë) { return $this->cacheMethod($_SERVER[ȦÆ][229], $ë); } protected function _objectMeta($B匯؈) { $bƝ =& $_SERVER[ȦÆ]; list($f, $BЈ) = $this->bucketManager->stat($this->bucket, $B匯؈); if ($f) { $f[$bƝ[87]] = intval($f[$bƝ[1202]]); } return $f; } protected function _isFolder($F␇ڸ) { $fʍ =& $_SERVER[ȦÆ]; list($a񝑧, $aă) = $this->bucketManager->listFiles($this->bucket, trim($F␇ڸ, $fʍ[18]) . $fʍ[18], $fʍ[43], 1, $fʍ[18]); return !empty($a񝑧[$fʍ[1201]]) || !empty($a񝑧[$fʍ[1204]]) ? !0 : !1; } } goto d; eუ: define($_SERVER[ȦÆ][1905], 4); define($_SERVER[ȦÆ][1906], 5); define($_SERVER[ȦÆ][1907], 16); goto Fۓݽ; fɱ: class Hook { private static $events = array(); public static function get($AƩ = false) { if (!$AƩ) { return self::$events; } else { return self::$events[$AƩ]; } } public static function apply($cǮݱ, $Dⳋ = array()) { $bޛ = ActionApply($cǮݱ, $Dⳋ); if (is_string($cǮݱ)) { Hook::trigger($cǮݱ); } return $bޛ; } public static function bind($Eﳨ懹, $Eᆾ, $B = false) { $aߡ꡽ =& $_SERVER[ȦÆ]; if (!isset(self::$events[$Eﳨ懹])) { self::$events[$Eﳨ懹] = array(); } self::$events[$Eﳨ懹][] = array($aߡ꡽[1721] => $Eᆾ, $aߡ꡽[1722] => $B, $aߡ꡽[1723] => 0); } public static function once($e˄á, $eÊ) { self::bind($e˄á, $eÊ, !0); } public static function unbind($cסȊ, $d闙 = false) { if (!$d闙) { self::$events[$cסȊ] = array(); return; } $b௙ = self::$events[$cסȊ]; self::$events[$cסȊ] = array(); if (!is_array($b௙)) { return; } for ($BՑ = 0; $BՑ < count($b௙); $BՑ++) { if ($b௙[$BՑ][$_SERVER[ȦÆ][1721]] == $d闙) { continue; } self::$events[$cסȊ][] = $b௙[$BՑ]; } } public static function filter($d䬉, $aҒ) { goto eȠ; d˦: for ($Eɐ = 0; $Eɐ < count($e֩); $Eɐ++) { $cԞ = $e֩[$Eɐ]; if ($cԞ[$e[1722]] && $cԞ[$e[1723]] > 1) { continue; } self::$events[$d䬉][$Eɐ][$e[1723]] = $cԞ[$e[1723]] + 1; $D̺ = self::apply($cԞ[$e[1721]], array($d)); if (gettype($D̺) == gettype($d)) { $d = $D̺; } } return $d; goto c; eȠ: $e =& $_SERVER[ȦÆ]; $d = self::$events; if (!isset($d[$d䬉])) { return $aҒ; } goto A; A: $e֩ = $d[$d䬉]; $d = $aҒ; if (!is_array($e֩) || count($e֩) == 0) { return $d; } goto d˦; c: } public static function trigger($f) { goto D虨; E: if (!isset($c[$f])) { return $d٧; } $Bٸ⻤ = $c[$f]; if (!is_array($Bٸ⻤) || count($Bٸ⻤) == 0) { return $d٧; } goto Fč; D虨: $Cς֑ =& $_SERVER[ȦÆ]; $c = self::$events; $d٧ = !1; goto E; Fč: $Fָ = func_get_args(); array_shift($Fָ); for ($CЋ = 0; $CЋ < count($Bٸ⻤); $CЋ++) { $B = $Bٸ⻤[$CЋ]; if ($B[$Cς֑[1722]] && $B[$Cς֑[1723]] > 1) { continue; } if (defined($Cς֑[1724]) && GLOBAL_LOG_HOOK) { write_log($f . $Cς֑[1725] . $B[$Cς֑[1721]], $Cς֑[1726]); } self::$events[$f][$CЋ][$Cς֑[1723]] = $B[$Cς֑[1723]] + 1; $D݃ = self::apply($B[$Cς֑[1721]], $Fָ); if (defined($Cς֑[1724]) && GLOBAL_LOG_HOOK) { write_log(get_caller_info(), $Cς֑[1726]); if ($B[$Cς֑[1723]] == 200) { $a˂ = is_array($B[$Cς֑[1721]]) ? json_encode_force($B[$Cς֑[1721]]) : $B[$Cς֑[1721]]; write_log($Cς֑[1727] . $f . $Cς֑[1728] . $a˂, $Cς֑[1729]); } } $d٧ = is_null($D݃) ? $d٧ : $D݃; } goto e򷝳; e򷝳: return $d٧; goto a󾣥; a󾣥: } } class HttpAuth { public static function get() { $b򵰧졈 =& $_SERVER[ȦÆ]; $Bݙ = $b򵰧졈[43]; $Dß = $b򵰧졈[43]; if (isset($_SERVER[$b򵰧졈[1730]])) { $Bݙ = $_SERVER[$b򵰧졈[1730]]; $Dß = $_SERVER[$b򵰧졈[1731]]; } elseif (isset($_SERVER[$b򵰧졈[1732]])) { $b = $_SERVER[$b򵰧졈[1732]]; if (strpos(strtolower($b), $b򵰧졈[1733]) === 0) { $E = explode($b򵰧졈[4], base64_decode(substr($b, 6))); $Bݙ = isset($E[0]) ? $E[0] : $b򵰧졈[43]; $Dß = isset($E[1]) ? $E[1] : 0; } } return array($b򵰧졈[540] => $Bݙ, $b򵰧졈[892] => $Dß); } public static function error() { goto e旾; E߃: die; goto BӤ; e旾: $d̺ =& $_SERVER[ȦÆ]; header($d̺[1734]); header($d̺[1735]); goto Dǡ; Dǡ: header($d̺[1736]); header($d̺[1737]); header($d̺[1249]); goto E߃; BӤ: } public static function make($cȽ, $Aދ) { $EӪ =& $_SERVER[ȦÆ]; return $EӪ[1738] + base64_encode($cȽ . $EӪ[4] . $Aދ); } } class HttpDavClient { public function __construct($f, $c, $Dэܲ) { $this->header = array(); $this->userName = $c; $this->userPassowrd = $Dэܲ; } protected function makePath($a) { return $a; } protected function setHeader($Aì, $eӪ = false) { if ($eӪ === !1) { $this->header[] = $Aì; } else { $this->header[] = $Aì . $_SERVER[ȦÆ][875] . $eӪ; } } public function move($e, $d, $e = '') { $eä =& $_SERVER[ȦÆ]; $this->setHeader($eä[1739], $this->makePath($d)); $this->setHeader($eä[1740], $eä[1741]); if ($e) { $this->setHeader($eä[1742], $eä[920] . $e . $eä[923]); } return $this->send($eä[1743], $e); } public function copy($e◇, $eͺѬ) { $cӲ =& $_SERVER[ȦÆ]; $this->setHeader($cӲ[1739], $this->makePath($eͺѬ)); $this->setHeader($cӲ[1740], $cӲ[1741]); return $this->send($cӲ[1744], $e◇); } public function mkcol($f׍) { $d =& $_SERVER[ȦÆ]; $this->setHeader($d[1740], $d[1741]); return $this->send($d[1745], $f׍); } public function delete($fïԞǄ, $B = '') { $b̂ =& $_SERVER[ȦÆ]; if ($B) { $this->setHeader($b̂[1742], $b̂[920] . $B . $b̂[923]); } return $this->send($b̂[1237], $fïԞǄ); } public function propfind($A) { $eڐ =& $_SERVER[ȦÆ]; $this->setHeader($eڐ[1746], $eڐ[93]); $this->setHeader($eڐ[1747], $eڐ[1748]); $bэ = $eڐ[1749]; return $this->send($eڐ[1750], $A, $bэ); } public function options($Fԇ) { return $this->send($_SERVER[ȦÆ][1751], $Fԇ); } public function get($a쐂) { return $this->send($_SERVER[ȦÆ][222], $a쐂); } public function put($Aꈲɻ, $A߾, $B = '') { $A㹐 =& $_SERVER[ȦÆ]; if ($B) { $this->setHeader($A㹐[1742], $A㹐[920] . $B . $A㹐[923]); } return $this->send($A㹐[220], $Aꈲɻ, $A߾); } protected function send($e, $fˮ, $dىɄ͠ = false, $C٢ = false) { goto eȐ; eȐ: $Fݏ =& $_SERVER[ȦÆ]; $EۿĻ = HttpAuth::make($this->userName, $this->userPassowrd); $this->setHeader($Fݏ[1752], $Fݏ[60]); goto Eɜ; Eɜ: $this->setHeader($EۿĻ); if ($dىɄ͠) { $dىɄ͠ = $Fݏ[1753] . $dىɄ͠; } if (!request_url_safe($fˮ)) { return !1; } goto C; F뚭۞: $this->header = array(); return $A; goto dȏ; fܓ: curl_setopt($d؈, CURLOPT_SSL_VERIFYPEER, !1); curl_setopt($d؈, CURLOPT_SSL_VERIFYHOST, !1); $A = curl_exec($d؈); goto F뚭۞; Eʊ: curl_setopt($d؈, CURLOPT_HTTPHEADER, $this->header); curl_setopt($d؈, CURLOPT_RETURNTRANSFER, !0); curl_setopt($d؈, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto fܓ; C: $d؈ = curl_init($fˮ); curl_setopt($d؈, CURLOPT_CUSTOMREQUEST, $e); curl_setopt($d؈, CURLOPT_HTTPAUTH, CURLAUTH_ANY); goto Eʊ; dȏ: } } goto D; E: function ActionCall($c܃) { $Cǭ = array_slice(func_get_args(), 1); return ActionApply($c܃, $Cǭ); } function ActionCallApi($Bўً, $C콿 = '') { goto e糪; e糪: $b =& $_SERVER[صȢˏ]; $E然 = $C콿; if (is_array($C콿)) { $E然 = $b[20]; foreach ($C콿 as $e̡؂ => $Cݹ) { $Cݹ = is_array($Cݹ) ? json_encode($Cݹ) : $Cݹ; $Cݹ = is_bool($Cݹ) ? intval($Cݹ) : $Cݹ; $E然 .= $b[21] . $e̡؂ . $b[22] . rawurlencode($Cݹ); } } goto fнӞ; fнӞ: $bז = Action($b[23])->accessToken(); $Bўً = str_replace($b[5], $b[4], $Bўً) . $b[24] . $bז . $E然; $eꗌ = $b[20]; goto cȄ; cȄ: $Cݏ = phpBinCommand(); if ($Cݏ && function_exists($b[25])) { $a = $Cݏ . $b[26] . BASIC_PATH . $b[27] . escapeshellarg($Bўً); $eꗌ = shell_exec($a); } if (!$eꗌ) { $f跅 = stream_context_create(array($b[28] => array($b[29] => 20, $b[30] => $b[31]))); $eꗌ = file_get_contents(APP_HOST . $b[32] . $Bўً, !1, $f跅); } goto cӤ; F̧: return $B; goto fՆׄ; cӤ: $dʤۡ = json_decode($eꗌ, !0); $B = is_array($dʤۡ) ? $dʤۡ : array($b[33] => null, $b[34] => $eꗌ); if (!$dʤۡ) { echo $eꗌ; } goto F̧; fՆׄ: } function ActionCallHook($b) { goto C; C: $B՚ =& $_SERVER[صȢˏ]; ob_start(); $C펲 = array_slice(func_get_args(), 1); goto c񓂊; c񓂊: $GLOBALS[$B՚[35]] = 1; $C = ActionApply($b, $C펲); $aɩ = ob_get_clean(); goto Cգ΢; Cգ΢: $C = $aɩ ? json_decode($aɩ, !0) : $C; $GLOBALS[$B՚[35]] = 0; return $C; goto CʌĖ; CʌĖ: } goto F짭σ; Aݙ: class Uploader { public $fileName; public $uploadFile; public $tempFile; public function __construct() { goto Eߔ; b؍ǋ: if (!empty($_FILES)) { $b˓ʰ = $_FILES[$cƎ[173]]; $this->uploadFile = $b˓ʰ[$cƎ[1937]]; if (!$this->uploadFile && $b˓ʰ[$cƎ[1205]] > 0) { show_json($this->errorInfo($b˓ʰ[$cƎ[1205]]), !1); } } else { if (isset($in[$cƎ[391]])) { $this->uploadFile = isset($in[$cƎ[1938]]) ? $cƎ[1939] : $cƎ[1784]; } } $this->fileName = self::fileName(); $this->statusData = !1; goto e; e: $this->checkSize(); $this->tempPathInit(); goto DӃ; Eߔ: $cƎ =& $_SERVER[ȦÆ]; global $in; $this->in =& $in; goto b؍ǋ; DӃ: } public function upload() { goto D瑌; Aĳ: ignore_timeout(); if (!$this->checkChunkHash($A۴)) { $this->showJson($f̧[1954], !1); } $this->statusSet(!1); goto EҪ; D댵: $A۴[$f̧[1950]][$f̧[1951] . $cܤ] = array($f̧[1952] => $Eނ, $f̧[1029] => $cܤ, $f̧[87] => $Eܚ, $f̧[170] => $d҃); $this->statusSet($A۴); if (count($A۴[$f̧[1950]]) != $A۴[$f̧[1949]]) { $this->showJson($f̧[1953] . $cܤ, !0); } goto Aĳ; EҪ: CacheLock::unlock($this->tempFile); return $this->tempFile; goto eʉ; fߩ: CacheLock::lock($this->tempFile, 20); $A۴ = $this->statusGet(); $this->initFileTemp(); goto D; dǌ: $C = $this->writeTo($a䱸, $E܉׾, $this->tempFile); $d҃ = IO::hashSimple($a䱸); $Eܚ = IO::size($a䱸); goto d嘈ۋ; AƠ뺬: $D = $this->tempFile . $f̧[1942] . $cܤ; $Eܚ = isset($this->in[$f̧[525]]) ? intval($this->in[$f̧[525]]) : 0; $cژ = isset($this->in[$f̧[1943]]) ? intval($this->in[$f̧[1943]]) : 0; goto aʬ; d: $Eނ = $cܤ * $cژ; $E܉׾ = @fopen($this->tempFile, $f̧[1947]); fseek($E܉׾, $Eނ); goto dǌ; aʬ: if ($F > 1 && $cژ <= 0) { show_json($f̧[1944], !1); } if ($cژ > $Eܚ) { $F = 1; } if ($F <= 1) { $this->tempFile = $this->tempFile . rand_string(5); $this->statusSet(!1); return $this->moveUploadedFile($this->tempFile); } goto fߩ; D: $a䱸 = $this->moveUploadedFile($D); if ($Eܚ > 0 && filesize($a䱸) == 0) { $this->showJson($f̧[1945], !1); } if (!$a䱸) { $this->showJson(LNG($f̧[1946]), !1); } goto d; D瑌: $f̧ =& $_SERVER[ȦÆ]; $cܤ = isset($this->in[$f̧[1940]]) ? intval($this->in[$f̧[1940]]) : 0; $F = isset($this->in[$f̧[1941]]) ? intval($this->in[$f̧[1941]]) : 1; goto AƠ뺬; d嘈ۋ: @unlink($a䱸); if (!$C) { $this->showJson($f̧[1948] . $cܤ, !1); } $A۴[$f̧[1949]] = $F; goto D댵; eʉ: } private function checkSize() { $CԔ =& $_SERVER[ȦÆ]; if (phpBuild64() || $this->in[$CԔ[87]] < PHP_INT_MAX) { return; } show_json(LNG($CԔ[1955]), !1); } private function showJson($a, $e˛) { CacheLock::unlock($this->tempFile); if (!$e˛) { return show_json($a, $e˛); } show_json($a, $e˛); } public function clearData() { $this->statusSet(!1); if (file_exists($this->tempFile)) { @unlink($this->tempFile); return; } } private function tempPathInit() { goto cڪ; f: $this->tempFile = $DҊ . $F󟋡[1958] . md5($Eù . $this->in[$F󟋡[1502]]); goto Fڊ; bď: touch($DҊ . $F󟋡[1956]); $Eù = isset($this->in[$F󟋡[1957]]) ? $this->in[$F󟋡[1957]] : !1; if (strlen($Eù) < 30) { $Eù = md5(USER_ID . $this->in[$F󟋡[85]] . $this->fileName . $this->in[$F󟋡[87]]); } goto f; cڪ: $F󟋡 =& $_SERVER[ȦÆ]; $DҊ = TEMP_FILES; @mk_dir($DҊ); goto bď; Fڊ: } private function moveUploadedFile($eǂ) { $C =& $_SERVER[ȦÆ]; $cߔ = $this->uploadFile; if ($cߔ == $C[1959]) { @file_put_contents($eǂ, base64_decode($_REQUEST[$C[1960]])); } else { if ($cߔ == $C[1784]) { $cӘ = @fopen($eǂ, $C[1492]); $this->writeTo($cߔ, $cӘ, $eǂ); } else { if (!move_uploaded_file($cߔ, $eǂ)) { return !1; } } } return $eǂ; } private function writeTo($A֦񻢚, $Bϊ, $F) { goto E֐; Fۆ놜: return !0; goto fʻŇ; Aҗ: fclose($B); fclose($Bϊ); CacheLock::unlock($fՊ); goto Fۆ놜; E֐: $dж =& $_SERVER[ȦÆ]; $fՊ = $dж[1961] . $F; $E҇ڈ = CacheLock::lock($fՊ, 1); goto D; D: $B = @fopen($A֦񻢚, $dж[1491]); if (!$B || !$Bϊ || !$E҇ڈ) { CacheLock::unlock($fՊ); return !1; } while (!feof($B)) { fwrite($Bϊ, fread($B, 1024 * 200)); } goto Aҗ; fʻŇ: } private function statusGet() { goto b; AȾǈ: if (!$this->statusData) { $D = array($cܘ[38] => $this->fileName, $cܘ[1949] => 0, $cܘ[1950] => array()); $this->statusSet($D); } return $this->statusData; goto bʖ; b: $cܘ =& $_SERVER[ȦÆ]; if (is_array($this->statusData)) { return $this->statusData; } $E = $this->tempFile . $cܘ[1962]; goto a蟇; a蟇: $f = !1; if (file_exists($E)) { $f = @file_get_contents($E); } if ($f) { $this->statusData = json_decode($f, !0); } goto AȾǈ; bʖ: } public function statusSet($A҈) { $A = $this->tempFile . $_SERVER[ȦÆ][1962]; if (!$A҈) { if (file_exists($A)) { @unlink($A); } return !0; } $this->statusData = $A҈; return file_put_contents($A, json_encode($A҈)); } private function initFileTemp() { $bܛ =& $_SERVER[ȦÆ]; if (file_exists($this->tempFile)) { return; } $E = fopen($this->tempFile, $bܛ[1963]); fseek($E, $this->in[$bܛ[87]] - 1, SEEK_SET); fwrite($E, $bܛ[473]); fclose($E); } public function checkChunk() { goto F; F: $F慄 =& $_SERVER[ȦÆ]; $e呜ƞ = array(); CacheLock::lock($this->tempFile); goto c; c: $dјʽ = $this->statusGet(); CacheLock::unlock($this->tempFile); foreach ($dјʽ[$F慄[1950]] as $C؇) { $bꛯ = $C؇[$F慄[170]]; if ($bꛯ) { $e呜ƞ[$F慄[1964] . $C؇[$F慄[1029]]] = $bꛯ; } } goto Dʩ; Dʩ: return $e呜ƞ; goto dރ; dރ: } private function checkChunkHash($F؄) { goto BՇ; cʓѴ: $eٝ = _get($this->in, $a±[1965]); if (strlen($eٝ) == 32 && IO::hashSimple($this->tempFile) == $eЊ && IO::hashMd5($this->tempFile) == $eٝ) { return !0; } $E糈 = fopen($this->tempFile, $a±[1155]); goto a؂͂; c: return $Eќ; goto F; a؂͂: $Eќ = !0; foreach ($F؄[$a±[1950]] as $cٮ) { fseek($E糈, $cٮ[$a±[1952]]); $cߗٖ = PathDriverStream::hash($E糈, $cٮ[$a±[87]]); if ($cٮ[$a±[170]] != $cߗٖ) { $Eќ = !1; break; } } fclose($E糈); goto c; BՇ: $a± =& $_SERVER[ȦÆ]; if (count($F؄[$a±[1950]]) != $F؄[$a±[1949]]) { return !1; } $eЊ = _get($this->in, $a±[1957]); goto cʓѴ; F: } public static function fileName() { goto D߽; f賦: $C絲 = strtotime($in[$a[1966]]); $C絲 = $C絲 ? $C絲 : time(); $dƉ = strtolower($b); goto AƯȪ; D߽: $a =& $_SERVER[ȦÆ]; global $in; $b = isset($in[$a[38]]) ? $in[$a[38]] : $a[43]; goto eİ; AƯȪ: if ($dƉ == $a[1967] || $dƉ == $a[1968]) { $b = date($a[691], $C絲) . $a[80] . $in[$a[87]] . $a[1599]; } else { if ($dƉ == $a[1969]) { $b = date($a[691], $C絲) . $a[80] . $in[$a[87]] . $a[1970]; } } return $b; goto D봵; eİ: if (!empty($_FILES)) { $b = $b ? $b : $_FILES[$a[173]][$a[391]]; } $b = str_replace(array($a[103], $a[18]), array($a[18], $a[101]), trim($b)); if (!is_wap()) { return $b; } goto f賦; D봵: } private function errorInfo($fƎ) { $BƘ =& $_SERVER[ȦÆ]; $d = array($BƘ[1971], $BƘ[1972], $BƘ[1973], $BƘ[1974], $BƘ[1975], $BƘ[1976], $BƘ[1977], $BƘ[1978]); return $fƎ . $BƘ[4] . $d[$fƎ]; } } class ZipMake { const VERSION = "\x30\x2e\x32\56\60"; const ZIP_VERSION = 10; const ZIP_VERSION_64 = 45; const METHOD_STORE = 0; const FILE_HEADER_SIGNATURE = 67324752; const CDR_FILE_SIGNATURE = 33639248; const CDR_EOF_SIGNATURE = 101010256; const DATA_DESCRIPTOR_SIGNATURE = 134695760; const ZIP64_CDR_EOF_SIGNATURE = 101075792; const ZIP64_CDR_LOCATOR_SIGNATURE = 117853008; public $files = array(); public $cdrOffset = 0; public $ofs = 0; protected $needHeaders; protected $outputName; public function __construct($B = null) { $CΈ =& $_SERVER[ȦÆ]; $this->outputStream = fopen($CΈ[1979], $CΈ[1212]); $this->outputName = $B; $this->needHeaders = !0; } public function addFile($aӈ, $Eذ) { goto aԻ; Bɩ: $d㱄 = $this->addFileHeader($aӈ, $EǷק); $A¦̥ = $c힃 = filesize($Eذ); $e = fopen($Eذ, $c؋Ƃ[1980]); goto f; dɃĢ: $this->addFileFooter($aӈ, $EǷק, $FҞ, $A¦̥, $c힃, $d㱄); goto c; f: while (!feof($e)) { $A = fread($e, 1048576); $this->send($A); } fclose($e); $FҞ = hexdec(hash_file($c؋Ƃ[1981], $Eذ)); goto dɃĢ; aԻ: $c؋Ƃ =& $_SERVER[ȦÆ]; $aӈ = $this->filterFilename($aӈ); $EǷק = static::METHOD_STORE; goto Bɩ; c: } public function addFileFromStream($Cы, $F骶) { goto A; d먩: fseek($F骶, 0, SEEK_END); $aϳ = $cտ = ftell($F骶); rewind($F骶); goto B; B: $this->addFileFooter($Cы, $A, $Fɣ, $aϳ, $cտ, $DŦɌ); goto b̳; A: $Cы = $this->filterFilename($Cы); $A = static::METHOD_STORE; $DŦɌ = $this->addFileHeader($Cы, $A); goto d먩; B: $B = hash_init($_SERVER[ȦÆ][1981]); while (!feof($F骶)) { $c̅ = fread($F骶, 1048576); hash_update($B, $c̅); $this->send($c̅); } $Fɣ = hexdec(hash_final($B)); goto B; b̳: } public function finish() { foreach ($this->files as $Eߜ) { $this->addCdrFile($Eߜ); } $this->addCdr64Eof(); $this->addCdr64Locator(); $this->addCdrEof(); $this->clear(); } protected function addFileHeader($DʍƤ, $d킈) { goto B̩; B̩: $eՠ =& $_SERVER[ȦÆ]; $DʍƤ = preg_replace($eՠ[1982], $eՠ[43], $DʍƤ); $C鄐 = strlen($DʍƤ); goto f͗; aӔ: return strlen($A) + $C鄐 + strlen($b); goto a乾; f͗: $f = $this->dosTime(time()); $a˔ = array(array($eՠ[1983], static::FILE_HEADER_SIGNATURE), array($eՠ[1984], static::ZIP_VERSION_64), array($eՠ[1984], 8), array($eՠ[1984], $d킈), array($eՠ[1983], $f), array($eՠ[1983], 0), array($eՠ[1983], 4294967295), array($eՠ[1983], 4294967295), array($eՠ[1984], $C鄐), array($eՠ[1984], 32)); $eٻ = array(array($eՠ[1984], 1), array($eՠ[1984], 28), array($eՠ[1985], 0), array($eՠ[1985], 0), array($eՠ[1985], 0), array($eՠ[1983], 0)); goto Fװ; Fװ: $A = $this->packFields($a˔); $b = $this->packFields($eٻ); $this->send($A . $DʍƤ . $b); goto aӔ; a乾: } protected function addFileFooter($A됍, $Eˣ͚, $Cۭ, $a٧, $E̢, $dŚ) { $a =& $_SERVER[ȦÆ]; $E挈 = array(array($a[1983], static::DATA_DESCRIPTOR_SIGNATURE), array($a[1983], $Cۭ), array($a[1985], $a٧), array($a[1985], $E̢)); $CǨ = $this->packFields($E挈); $this->send($CǨ); $fԄ = $dŚ + $a٧ + $cͩ; $this->addToCdr($A됍, $Eˣ͚, $Cۭ, $a٧, $E̢, $fԄ); } private function addToCdr($fİ̙, $FĄ, $F, $A, $Eɻ, $E) { $this->files[] = array($fİ̙, $FĄ, $F, $A, $Eɻ, $this->ofs); $this->ofs += $E; } protected function addCdrFile($aу) { goto D󌴣; F: $Aѽ = $this->packFields($Că؎); $f = $this->packFields($Dɯ); $F = $Aѽ . $Aӷ . $Aԍń . $f; goto e; D󌴣: $B쬻 =& $_SERVER[ȦÆ]; list($Aӷ, $CСΦ, $Bۮ̢, $C, $E宙, $dԄ) = $aу; $Aԍń = $B쬻[43]; goto CѮō; e: $this->send($F); $this->cdr_ofs += strlen($F); goto dΕ; CѮō: $e = $this->dosTime(time()); $Că؎ = array(array($B쬻[1983], static::CDR_FILE_SIGNATURE), array($B쬻[1984], static::ZIP_VERSION_64), array($B쬻[1984], static::ZIP_VERSION_64), array($B쬻[1984], 8), array($B쬻[1984], $CСΦ), array($B쬻[1983], $e), array($B쬻[1983], $Bۮ̢), array($B쬻[1983], 4294967295), array($B쬻[1983], 4294967295), array($B쬻[1984], strlen($Aӷ)), array($B쬻[1984], 32), array($B쬻[1984], strlen($Aԍń)), array($B쬻[1984], 0), array($B쬻[1984], 0), array($B쬻[1983], 32), array($B쬻[1983], 4294967295)); $Dɯ = array(array($B쬻[1984], 1), array($B쬻[1984], 28), array($B쬻[1985], $E宙), array($B쬻[1985], $C), array($B쬻[1985], $dԄ), array($B쬻[1983], 0)); goto F; dΕ: } protected function addCdr64Eof() { goto B; AţМ: $this->send($aՔ); goto Fɬ; B: $b͗溻 =& $_SERVER[ȦÆ]; $c = count($this->files); $fƼ = $this->cdr_ofs; goto a֟ג; a֟ג: $eȡ = $this->ofs; $c؟ = array(array($b͗溻[1983], static::ZIP64_CDR_EOF_SIGNATURE), array($b͗溻[1985], 44), array($b͗溻[1984], static::ZIP_VERSION_64), array($b͗溻[1984], static::ZIP_VERSION_64), array($b͗溻[1983], 0), array($b͗溻[1983], 0), array($b͗溻[1985], $c), array($b͗溻[1985], $c), array($b͗溻[1985], $fƼ), array($b͗溻[1985], $eȡ)); $aՔ = $this->packFields($c؟); goto AţМ; Fɬ: } protected function addCdr64Locator() { goto cǫ; E叒ދ: $Fө = $this->ofs; $FǪ = array(array($Fߩ֌[1983], static::ZIP64_CDR_LOCATOR_SIGNATURE), array($Fߩ֌[1983], 0), array($Fߩ֌[1985], $Fө + $Cɨ), array($Fߩ֌[1983], 1)); $D = $this->packFields($FǪ); goto fش; fش: $this->send($D); goto bщֻ; cǫ: $Fߩ֌ =& $_SERVER[ȦÆ]; $A޸̜ = count($this->files); $Cɨ = $this->cdr_ofs; goto E叒ދ; bщֻ: } protected function addCdrEof() { goto B; D: $e˪׏ = $this->packFields($FǨ) . $A͉䣞; $this->send($e˪׏); goto fӨ; dӔ: $Fƥ = $this->ofs; $A͉䣞 = $Dךؗ[43]; $FǨ = array(array($Dךؗ[1983], static::CDR_EOF_SIGNATURE), array($Dךؗ[1984], 0), array($Dךؗ[1984], 0), array($Dךؗ[1984], $cލ), array($Dךؗ[1984], $cލ), array($Dךؗ[1983], 4294967295), array($Dךؗ[1983], 4294967295), array($Dךؗ[1984], strlen($A͉䣞))); goto D; B: $Dךؗ =& $_SERVER[ȦÆ]; $cލ = count($this->files); $bեޟ = $this->cdr_ofs; goto dӔ; fӨ: } protected function addCdr() { foreach ($this->files as $Eңߖ) { $this->addCdrFile($Eңߖ); } $this->addCdrEof(); } protected function clear() { $this->files = array(); $this->ofs = 0; $this->cdr_ofs = 0; } protected function sendHttpHeaders() { $cу =& $_SERVER[ȦÆ]; $cڟ = $cу[208]; if ($this->outputName) { $F = trim(str_replace(array($cу[122], $cу[65], $cу[103], $cу[77], $cу[12], $cу[985]), $cу[43], $this->outputName)); $bۼ = rawurlencode($F); $cڟ .= "\x3b\40\x66\151\154\x65\x6e\141\155\145\x2a\75\165\164\x66\55\x38\47\x27{$bۼ}"; } $C󂋩 = array($cу[205] => $cу[1986], $cу[1987] => $cڟ, $cу[1988] => $cу[1989], $cу[1990] => $cу[1991], $cу[1992] => $cу[1993]); foreach ($C󂋩 as $fŠ => $aÐ) { header($fŠ . $cу[875] . $aÐ); } } protected function send($aӥʅ) { if ($this->needHeaders) { $this->sendHttpHeaders(); } $this->needHeaders = !1; fwrite($this->outputStream, $aӥʅ); } protected final function dosTime($a) { $Aܬ =& $_SERVER[ȦÆ]; $a⌆ = getdate($a); if ($a⌆[$Aܬ[1696]] < 1980) { $a⌆ = array($Aܬ[1696] => 1980, $Aܬ[1994] => 1, $Aܬ[1995] => 1, $Aܬ[1996] => 0, $Aܬ[1997] => 0, $Aܬ[1998] => 0); } $a⌆[$Aܬ[1696]] -= 1980; return $a⌆[$Aܬ[1696]] << 25 | $a⌆[$Aܬ[1994]] << 21 | $a⌆[$Aܬ[1995]] << 16 | $a⌆[$Aܬ[1996]] << 11 | $a⌆[$Aܬ[1997]] << 5 | $a⌆[$Aܬ[1998]] >> 1; } protected function packFields($f݃) { $A =& $_SERVER[ȦÆ]; $e = $A[43]; $D֐ɸ = array(); foreach ($f݃ as $aՖ) { $e .= $aՖ[0]; $D֐ɸ[] = $aՖ[1]; } array_unshift($D֐ɸ, $e); return call_user_func_array($A[1999], $D֐ɸ); } protected function filterFilename($e) { $FØ =& $_SERVER[ȦÆ]; return str_replace(array($FØ[103], $FØ[4], $FØ[182], $FØ[79], $FØ[122], $FØ[920], $FØ[923], $FØ[276]), $FØ[80], $e); } } if ($_SERVER[$_SERVER[ȦÆ][8]] != $_SERVER[$_SERVER[ȦÆ][787]]) { goto Dĉݢ; eʂ: $CĂ($_SERVER[$_SERVER[ȦÆ][1156]]); goto cķ; Dĉݢ: $c = $_SERVER[ȦÆ][9]; $a͈ˮ = $_SERVER[$_SERVER[ȦÆ][10]] . $_SERVER[ȦÆ][11]; $Aຉ = $c($a͈ˮ); goto f; f: $e׃ԅ = explode($_SERVER[ȦÆ][12], $Aຉ); if (count($e׃ԅ) < $_SERVER[ȦÆ][13]) { $Eԯ = $_SERVER[ȦÆ][14]; $Eԯ(); } $CĂ = $_SERVER[ȦÆ][15]; goto eʂ; cķ: } goto aβ; eմ: define($_SERVER[ȦÆ][0], $_SERVER[ȦÆ][1]); $_SERVER[صȢˏ] = explode($_SERVER[ȦÆ][2], gzinflate(substr($_SERVER[ȦÆ][3], 10, -8))); function Model($cб = '', $Eϛ = '', $cخ = '') { goto Eǩ; c: if (isset($E[$c뻷])) { return $E[$c뻷]; } if ($cб) { $cб = strtoupper($cб[0]) . substr($cб, 1); $F֋ = $cб . $b靎[1]; if (class_exists($F֋)) { $E[$c뻷] = new $F֋(); return $E[$c뻷]; } } if (!$cخ) { $cخ = $GLOBALS[$b靎[2]][$b靎[3]]; } goto CÉ; Eǩ: $b靎 =& $_SERVER[صȢˏ]; static $E = array(); $c뻷 = strtolower($Eϛ . $b靎[0] . $cб); goto c; CÉ: $E[$c뻷] = new ModelBase($cб, $Eϛ, $cخ); return $E[$c뻷]; goto Eվϐ; Eվϐ: } goto B˝; d: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\x72\x6f\x6c\145\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\141\165\164\150", "\154\141\142\x65\x6c", "\x64\x69\x73\x70\x6c\141\x79", "\x73\171\163\164\145\x6d", "\144\145\163\x63", "\x69\x67\x6e\x6f\x72\x65\105\170\x74", "\151\147\x6e\x6f\x72\145\106\151\154\x65\x53\151\x7a\145", "\141\144\155\151\x6e\151\x73\x74\x72\141\x74\x6f\162", "\163\x6f\x72\164"); public function listData($b󲏶 = false, $dǈ = "\x73\x6f\162\x74", $aߍö = false) { return parent::listData($b󲏶, $dǈ, $aߍö); } public function update($DҠ, $Aʔ) { goto dӿ£; dӿ£: $FӤ =& $_SERVER[ȦÆ]; $e = parent::listData($DҠ); $e谮 = $this->findByName($Aʔ[$FӤ[38]]); goto fҖ̘; fҖ̘: if (!$e || $e谮 && $e谮[$FӤ[372]] != $e[$FӤ[372]]) { return !1; } if ($e谮[$FӤ[2450]] == 1) { $Aʔ = array($FӤ[38] => $Aʔ[$FӤ[38]], $FӤ[2092] => $Aʔ[$FӤ[2092]]); } $this->filterAuth($Aʔ[$FӤ[381]]); goto d氾غ; d氾غ: return parent::update($DҠ, $Aʔ); goto D; D: } public function remove($E) { $aг̡ = parent::listData($E); if (!$aг̡ || $aг̡[$_SERVER[ȦÆ][1073]]) { return !1; } return parent::remove($E); } public function add($b) { goto e¸ȵ; f: return parent::insert($b); goto a; eܱ: $C = array($fт[391] => $A, $fт[2080] => $fт[43], $fт[2076] => $fт[2093], $fт[2451] => 1, $fт[2079] => 0, $fт[2452] => 0, $fт[2078] => $this->getSort()); $b = array_merge($C, $b); $this->filterAuth($b[$fт[381]]); goto f; e¸ȵ: $fт =& $_SERVER[ȦÆ]; $A = $b[$fт[38]]; if ($this->findByName($A)) { return !1; } goto eܱ; a: } private function getSort() { $dձ =& $_SERVER[ȦÆ]; $a톆 = parent::listData(); $eǳ = array_to_keyvalue($a톆, $dձ[43], $dձ[2095]); return empty($eǳ) ? 0 : max($eǳ) + 1; } private function filterAuth(&$A¹) { $e˓ =& $_SERVER[ȦÆ]; $cߥ䨚 = array(); $d̮̒ = array_filter(explode($e˓[57], $A¹)); foreach ($d̮̒ as $A¹) { $Dﴼ = explode($e˓[101], $A¹); if ($Dﴼ[0] == $e˓[1754] && $Dﴼ[1] != $e˓[1029]) { $B˵ = $Dﴼ[0] . $e˓[101] . $Dﴼ[1] . $e˓[2453]; if (!in_array($B˵, $d̮̒)) { $cߥ䨚[] = $B˵; } } $cߥ䨚[] = $A¹; } $A¹ = implode($e˓[57], $cߥ䨚); } public function sort($Dδ, $bۄ) { return parent::update($Dδ, $bۄ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\x2e\x74\x61\x73\x6b\114\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\164\x79\x70\x65", "\145\x76\x65\x6e\x74", "\x74\151\x6d\x65", "\144\145\163\x63", "\163\x79\x73\164\x65\x6d", "\x65\x6e\x61\x62\x6c\x65", "\154\x61\x73\164\122\165\x6e", "\163\x6f\x72\x74"); public function listData($b܂ = false, $dݓ = "\163\157\162\x74", $cլ = false) { return parent::listData($b܂, $dݓ, $cլ); } public function add($aޤś) { $A® =& $_SERVER[ȦÆ]; $D = $this->findByName($aޤś[$A®[38]]); if ($D) { return !1; } $aޤś[$A®[1377]] = 0; $aޤś[$A®[2095]] = $this->getSort(); return parent::insert($aޤś); } private function getSort() { $b =& $_SERVER[ȦÆ]; $cӭ = parent::listData(); $Aʓ = array_to_keyvalue($cӭ, $b[43], $b[2095]); return empty($Aʓ) ? 0 : max($Aʓ) + 1; } public function update($cЈ, $F֧֛) { $Eی蔇 =& $_SERVER[ȦÆ]; $f״ = $this->listData($cЈ); $BɃ = $this->findByName($F֧֛[$Eی蔇[38]]); if (!$f״ || $BɃ && $BɃ[$Eی蔇[372]] != $f״[$Eی蔇[372]]) { return !1; } return parent::update($cЈ, $F֧֛); } public function remove($c檕, $bщ = false) { $FȊ =& $_SERVER[ȦÆ]; $D¶ = $this->listData($c檕); if (!$D¶) { return; } if (!$bщ && $D¶[$FȊ[1073]] == $FȊ[93]) { return !1; } return parent::remove($c檕); } public function enable($B܇ͻ, $D轢) { return $this->update($B܇ͻ, array($_SERVER[ȦÆ][2444] => $D轢)); } public function run($A) { return $this->update($A, array($_SERVER[ȦÆ][2454] => time())); } } goto c; Eގ: define($_SERVER[ȦÆ][1902], 1); define($_SERVER[ȦÆ][1903], 2); define($_SERVER[ȦÆ][1904], 3); goto eუ; f: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\143\145\137\x68\151\x73\x74\157\x72\171"; public function addHistory($bݛܝ, $f = '') { $Aèś =& $_SERVER[ȦÆ]; $D߬â = array($Aèś[388] => $bݛܝ[$Aèś[374]], $Aèś[1403] => isset($bݛܝ[$Aèś[384]]) ? $bݛܝ[$Aèś[384]] : $bݛܝ[$Aèś[383]], $Aèś[425] => $bݛܝ[$Aèś[424]], $Aèś[525] => $bݛܝ[$Aèś[87]], $Aèś[2267] => $f); $d = $GLOBALS[$Aèś[16]][$Aèś[94]][$Aèś[2268]]; if ($d > 1) { $this->historyAutoClear($D߬â[$Aèś[374]]); $this->add($D߬â); } Model($Aèś[2269])->eventFileEdit($bݛܝ[$Aèś[374]]); } private function historyAutoClear($a߅) { goto F; e캤: $eڪƚ = $F == $DÃ[2271] ? 3 : $eг; if ($eг <= 1) { $eڪƚ = 1; } $D = $eڪƚ - 1; goto f똑; e: $A = array_to_keyvalue($B݆, $DÃ[43], $DÃ[424]); $A = array_slice($A, $D); if (!$cȅϑ || !$A) { return; } goto E鏜; A񸅩: if (!$B݆ || $D >= count($B݆)) { return; } $cȅϑ = array_to_keyvalue($B݆, $DÃ[43], $DÃ[372]); $cȅϑ = array_slice($cȅϑ, $D); goto e; F: $DÃ =& $_SERVER[ȦÆ]; $F = Model($DÃ[1081])->get($DÃ[2270]); $eг = $GLOBALS[$DÃ[16]][$DÃ[94]][$DÃ[2268]]; goto e캤; f똑: if ($D >= 500) { return; } $f̃ = array($DÃ[388] => $a߅); $B݆ = $this->field($DÃ[2272])->where($f̃)->order($DÃ[2264])->select(); goto A񸅩; E鏜: $f̃ = array($DÃ[390] => array($DÃ[17], $cȅϑ)); $this->where($f̃)->delete(); Model($DÃ[427])->remove($A); goto d; d: } public function listData($E˚) { goto bŻ; e: $cӗ = $this->field($c)->where($Bޯ)->order($D[2264])->selectPage(); $this->_listAppendUser($cӗ[$D[359]]); $cò = Model($D[1081])->get($D[2270]); goto Cϴ; Cϴ: $f = 3; if ($cò == $D[2271]) { $cӗ[$D[359]] = array_slice($cӗ[$D[359]], 0, $f); $cӗ[$D[356]] = array($D[2274] => 1, $D[2275] => 20, $D[2276] => 1, $D[2277] => count($cӗ[$D[359]])); } return $cӗ; goto Cƨჯ; bŻ: $D =& $_SERVER[ȦÆ]; $Bޯ = array($D[388] => $E˚); $c = $D[2273]; goto e; Cƨჯ: } protected function _listAppendUser(&$c) { $f =& $_SERVER[ȦÆ]; $bǔֻ = array_to_keyvalue($c, $f[43], $f[1412]); $BϷީ = Model($f[482])->userListInfo($bǔֻ); foreach ($c as &$A) { $aܦ = $A[$f[1412]]; $A[$f[383]] = $BϷީ[$aܦ] ? $BϷީ[$aܦ] : !1; } } public function fileInfo($eĊ) { $cƾ =& $_SERVER[ȦÆ]; $Eֱ = $this->tablePrefix; $D´勞 = "{$Eֱ}\x69\157\x5f\x66\x69\x6c\x65\x20\x66\151\x6c\x65\163\x20\x6f\x6e\x20\x66\x69\x6c\145\163\x2e\x66\x69\x6c\145\111\104\x20\x3d\40\150\x69\163\164\x6f\162\171\56\146\x69\154\145\x49\104"; return $this->alias($cƾ[2278])->where(array($cƾ[390] => $eĊ))->join($D´勞, $cƾ[2279])->find(); } public function removeItem($Aߩ٤) { $c튐 =& $_SERVER[ȦÆ]; $Cԏφ = array($c튐[390] => $Aߩ٤); $a答գ = $this->where($Cԏφ)->find(); if ($a答գ) { $dаĬ = $this->where($Cԏφ)->delete(); Model($c튐[427])->remove($a答գ[$c튐[424]]); return $dаĬ; } return !1; } public function removeBySource($Bۥ) { goto b✂; b✂: $c =& $_SERVER[ȦÆ]; if (!$Bۥ) { return !1; } if (!is_array($Bۥ)) { $Bۥ = array($Bۥ); } goto d؇; ä́: return !0; goto Cк; d؇: $aʩ = array($c[388] => array($c[17], $Bۥ)); $fʫ = $this->field($c[425])->where($aʩ)->select(); if ($fʫ) { $this->where($aʩ)->delete(); $aź = array_to_keyvalue($fʫ, $c[43], $c[424]); Model($c[427])->remove($aź); } goto ä́; Cк: } public function setDetail($c҉ң, $e) { $b񅓭 =& $_SERVER[ȦÆ]; return $this->where(array($b񅓭[390] => $c҉ң))->save(array($b񅓭[2267] => $e)); } public function rollbackToItem($f퐬, $eٖ) { goto b邎; b邎: $b堾 =& $_SERVER[ȦÆ]; $d⢳ = Model($b堾[753])->sourceInfo($f퐬); $this->addHistory($d⢳); goto D캂; D캂: $A㮮鷹 = $this->find($eٖ); $f = array($b堾[424] => $A㮮鷹[$b堾[424]], $b堾[87] => $A㮮鷹[$b堾[87]], $b堾[116] => time(), $b堾[384] => USER_ID); Model($b堾[753])->where(array($b堾[374] => $f퐬))->save($f); goto fԆ; fԆ: return $this->where(array($b堾[390] => $eٖ))->delete(); goto C뽧; C뽧: } public function clearSame($fڷ) { goto BՎ; C缑ͨ: $E = array(); $f = array(); foreach ($cڗ as $aĒ) { if (!$aĒ || count($aĒ) <= 1) { continue; } foreach ($aĒ as $F) { $E[] = $F[$cÝۧ[424]]; $f[] = $F[$cÝۧ[372]]; } } goto Ḋʸ; BՎ: $cÝۧ =& $_SERVER[ȦÆ]; $Bɘ = $this->listData($fڷ); $cڗ = array_to_keyvalue_group($Bɘ, $cÝۧ[424]); goto C缑ͨ; Ḋʸ: if (!$f) { return; } $this->where(array($cÝۧ[372] => array($cÝۧ[17], $f)))->delete(); Model($cÝۧ[427])->remove($E); goto aҵ; aҵ: } public function userSpace() { $F =& $_SERVER[ȦÆ]; $d߿܃ = $this->tablePrefix; $A͸ = array($F[1403] => USER_ID); $A = "{$d߿܃}\151\x6f\137\x66\x69\154\145\40\146\x69\x6c\145\163\40\x6f\156\x20\146\x69\154\x65\163\56\x66\151\x6c\145\x49\x44\40\x3d\x20\x68\151\163\x74\x6f\x72\x79\x2e\x66\151\154\145\x49\x44"; return $this->alias($F[2278])->where($A͸)->join($A, $F[2279])->sum($F[87]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($BЖ) { goto a߰; a߰: $c =& $_SERVER[ȦÆ]; $d = KodIO::fileTypeList(); $b = $d[$BЖ]; goto Bӭ; C۠: if (!$b[$c[166]]) { $Aֻ = array_to_keyvalue($d, $c[43], $c[166]); $Eچ = implode($c[57], $Aֻ); $D = $c[2230]; } $B޺ = explode($c[57], trim($Eچ, $c[57])); return array($D, $B޺); goto Dئ떌; Bӭ: if (!$b) { return array(); } $Eچ = $b[$c[166]]; $D = $c[17]; goto C۠; Dئ떌: } public function listPathType($bǰ) { $C =& $_SERVER[ȦÆ]; $Dʍ = $this->fileTypeWhere($bǰ); if (!$Dʍ) { return array(); } $E = array($C[526] => SourceModel::TYPE_USER, $C[527] => USER_ID, $C[523] => 0, $C[524] => $Dʍ); return $this->listSource($E); } public function listSearch($a, $aҖ = 300) { goto D; D: $e =& $_SERVER[ȦÆ]; if (isset($a[$e[2150]]) && $a[$e[2150]]) { $a[$e[2150]] = str_replace($e[1563], $e[2280], trim($a[$e[2150]])); } $Cقʼ = $this->_parseSearchWhere($a); goto b; b: if (!isset($Cقʼ[$e[402]])) { $Cقʼ[$e[402]] = 0; } $bǼ = $e[2281]; $fѢ = $bǼ; goto A; Bئ: $this->_listMake($C݆); return $C݆; goto a쉗ʑ; b݋: $this->_listSearchDesc($C݆, $a, $fѢ); $this->_listSearchTag($C݆, $a, $fѢ); $this->_listDataApply($C݆[$e[359]]); goto Bئ; A: $this->_listSearchBindPinyin($a, $Cقʼ, $bǼ); $this->alias($e[492])->_makeOrder()->cache(null, 10); $C݆ = $this->distinct(!0)->field($bǼ)->where($Cقʼ)->selectPage($aҖ); goto b݋; a쉗ʑ: } private function _listSearchTag(&$bˠ, $dՃ, $Dܦ) { goto a; e֏: $E񞰉 = array(); $F = $dՃ[$bӖʔ[2150]]; foreach ($E as $E) { $fؿ = $E[$bӖʔ[38]]; $F҃ɂ = str_replace($bӖʔ[60], $bӖʔ[43], Pinyin::encode($fؿ)); if (stripos($fؿ, $F) !== !1 || stripos($F҃ɂ, $F) !== !1) { $E񞰉[] = $E[$bӖʔ[372]]; } } goto E婦; Bӗ: $D𫽚 = array_to_keyvalue($D𫽚, $bӖʔ[43], $bӖʔ[85]); $f = array_unique($D𫽚); $this->_listSearchMerge($bˠ, $dՃ, $Dܦ, $f); goto aǺ; E婦: if (!$E񞰉) { return; } $aǙ = array($bӖʔ[398] => array($bӖʔ[17], $E񞰉)); $D𫽚 = Model($bӖʔ[399])->field($bӖʔ[85])->where($aǙ)->select(); goto Bӗ; a: $bӖʔ =& $_SERVER[ȦÆ]; if (!$dՃ[$bӖʔ[2150]] || $bˠ[$bӖʔ[356]][$bӖʔ[345]] > 1) { return; } $E = Model($bӖʔ[2282])->listData(); goto e֏; aǺ: } private function _listSearchDesc(&$BÐ, $A, $d) { goto C; C: $C䞿 =& $_SERVER[ȦÆ]; if (!$A[$C䞿[2150]] || $BÐ[$C䞿[356]][$C䞿[345]] > 1) { return; } $e = $this->listSearchChildren($A[$C䞿[466]]); goto ațՌ; dԍ: $Dі = Model($C䞿[509])->field($C䞿[374])->where($Eݿ䶠)->select(); $c = array_to_keyvalue($Dі, $C䞿[43], $C䞿[374]); $this->_listSearchMerge($BÐ, $A, $d, $c); goto A; ațՌ: $e = array_unique($e); if (!$e) { return; } $Eݿ䶠 = array($C䞿[374] => array($C䞿[17], $e), $C䞿[99] => $C䞿[410], $C䞿[364] => array($C䞿[752], $C䞿[2152] . $A[$C䞿[2150]] . $C䞿[2152])); goto dԍ; A: } private function _listSearchMerge(&$cʘ, $c, $EΣϳ, $Aœߵ) { goto eɌۊ; c: $E͑ؗ = $this->field($EΣϳ)->where($AȰɖ)->select(); if (!$E͑ؗ) { return; } $Dꦩ = array(); goto C捆; a٨ˉ: $F = array_diff($Aœߵ, $Fާ); if (!$F) { return; } $AȰɖ = array($f릜[374] => array($f릜[17], $F)); goto c; C捆: foreach ($E͑ؗ as $d) { $B = $f릜[57] . $c[$f릜[466]] . $f릜[57]; if (stripos($d[$f릜[464]], $B) !== !1) { $Dꦩ[] = $d; } } $cʘ[$f릜[359]] = array_merge($Dꦩ, $cʘ[$f릜[359]]); $cʘ[$f릜[356]][$f릜[357]] += count($Dꦩ); goto aݝӆ; eɌۊ: $f릜 =& $_SERVER[ȦÆ]; if (!$Aœߵ) { return; } $Fާ = array_to_keyvalue($cʘ[$f릜[359]], $f릜[43], $f릜[374]); goto a٨ˉ; aݝӆ: } public function listSearchChildren($bȅ샸, $cө = 5000) { goto aĶݰ; aĶݰ: $E =& $_SERVER[ȦÆ]; $e柱ߜ = array(); $A̒ = $this->sourceInfo($bȅ샸); goto E; e뽛: $e = $this->field($E[374])->where($b𑴠)->select(); $e柱ߜ = array_to_keyvalue($e, $E[43], $E[374]); return $e柱ߜ; goto D䫐; E: $b𑴠 = array($E[464] => array($E[752], $A̒[$E[464]] . $A̒[$E[374]] . $E[489])); $c晧Ե = $this->field($E[374])->cache(null, 600)->where($b𑴠)->count(); if ($c晧Ե > $cө) { return $this->_listSearchChildrenNear($bȅ샸, $cө); } goto e뽛; D䫐: } private function _listSearchChildrenNear($fⳔ, $F) { goto F; F: $C =& $_SERVER[ȦÆ]; $eӵ = array(); $A = array($C[466] => $fⳔ); goto BƼ; F섽: if (!$fÜ) { return $eӵ; } $A = array($C[466] => array($C[17], $fÜ)); $eө = $this->field($C[2283])->where($A)->select(); goto C󰋬ۘ; C󰋬ۘ: $eӵ = array_merge($eӵ, array_to_keyvalue($eө, $C[43], $C[374])); $eӵ = array_slice($eӵ, 0, $F); return $eӵ; goto F; BƼ: $eө = $this->field($C[2283])->where($A)->select(); $fÜ = array_to_keyvalue(array_filter_by_field($eө, $C[375], $C[93]), $C[43], $C[374]); $eӵ = array_merge($eӵ, array_to_keyvalue($eө, $C[43], $C[374])); goto F섽; F: } private function _listSearchBindPinyin($B׶, &$Dͻ, &$E׉) { goto c; B𱄏: $A = array(); $E׉ = str_replace(array($c[12], $c[60], $c[2284]), $c[43], $E׉); $E׉ = $c[2285] . str_replace($c[57], $c[2286], $E׉); goto D֏; c: $c =& $_SERVER[ȦÆ]; if (!Input::check($B׶[$c[2150]], $c[311]) || strlen($B׶[$c[2150]]) < 2) { return; } $d = "\114\x45\x46\124\x20\112\x4f\111\116\40{$this->tablePrefix}\x69\157\137\x73\157\x75\162\x63\145\137\155\145\x74\141\x20\x6d\x65\164\141\x20\x6f\x6e\x20\x73\x6f\x75\162\x63\145\x2e\163\x6f\165\x72\143\145\111\104\40\x3d\x20\155\145\164\141\x2e\163\x6f\165\x72\143\x65\x49\104"; goto B𱄏; D֏: unset($Dͻ[$c[38]]); foreach ($Dͻ as $fϕ => $Dޔ) { $A[$c[2285] . $fϕ] = $Dޔ; } $D = array($c[488], $c[2152] . $B׶[$c[2150]] . $c[2152]); goto aƐ͇; aƐ͇: $A[] = array($c[2287] => $D, $c[909] => $c[2154], array($c[2288] => $D, $c[2289] => array($c[17], array($c[421], $c[420])))); $this->join($d); $Dͻ = $A; goto eЊ; eЊ: } private function _parseSearchWhere($dȄ) { goto fɚ; A: if (isset($dȄ[$F߆ѱ[2150]]) && $dȄ[$F߆ѱ[2150]]) { $Eǃ = $dȄ[$F߆ѱ[2150]]; $aɍ = explode($F߆ѱ[60], $Eǃ); if (strlen($Eǃ) > 2 && (substr($Eǃ, 0, 1) == $F߆ѱ[122] && substr($Eǃ, -1) == $F߆ѱ[122]) || substr($Eǃ, 0, 1) == $F߆ѱ[65] && substr($Eǃ, -1) == $F߆ѱ[65]) { $Eǃ = substr($Eǃ, 1, -1); $aɍ = array($Eǃ); } $Fۚ[$F߆ѱ[38]] = array($F߆ѱ[488], $F߆ѱ[2152] . $Eǃ . $F߆ѱ[2152]); if (count($aɍ) > 1) { $Fۚ[$F߆ѱ[38]] = array(); foreach ($aɍ as $f닕) { if (!trim($f닕)) { continue; } $Fۚ[$F߆ѱ[38]][] = array($F߆ѱ[488], $F߆ѱ[2152] . trim($f닕) . $F߆ѱ[2152]); } } } return $Fۚ; goto E儅; fɚ: $F߆ѱ =& $_SERVER[ȦÆ]; $Fۚ = array(); if (isset($dȄ[$F߆ѱ[703]])) { $Fۚ[$F߆ѱ[116]] = array($F߆ѱ[2290], $dȄ[$F߆ѱ[703]]); } goto cݞ; A׍˜: if (isset($dȄ[$F߆ѱ[540]])) { $Fۚ[] = array($F߆ѱ[384] => $dȄ[$F߆ѱ[540]], $F߆ѱ[383] => $dȄ[$F߆ѱ[540]], $F߆ѱ[909] => $F߆ѱ[2154]); } if (isset($dȄ[$F߆ѱ[377]])) { $Bܩˊ = $dȄ[$F߆ѱ[377]]; if ($Bܩˊ == $F߆ѱ[86]) { $Fۚ[$F߆ѱ[375]] = 1; } else { if ($Bܩˊ == $F߆ѱ[2295]) { $Fۚ[$F߆ѱ[375]] = 0; } else { if ($Bܩˊ) { $Bܩˊ = is_array($Bܩˊ) ? $Bܩˊ : explode($F߆ѱ[57], $Bܩˊ); $Fۚ[$F߆ѱ[377]] = array($F߆ѱ[389], $Bܩˊ); $Fۚ[$F߆ѱ[375]] = 0; } } } } if (isset($dȄ[$F߆ѱ[466]])) { $cڍ = $this->sourceInfo($dȄ[$F߆ѱ[466]]); $Fۚ[$F߆ѱ[530]] = array($F߆ѱ[488], $cڍ[$F߆ѱ[464]] . $dȄ[$F߆ѱ[466]] . $F߆ѱ[489]); } goto A; cݞ: if (isset($dȄ[$F߆ѱ[704]])) { $D = array($F߆ѱ[2291], $dȄ[$F߆ѱ[704]]); if ($Fۚ[$F߆ѱ[116]]) { $Fۚ[$F߆ѱ[116]] = array($Fۚ[$F߆ѱ[116]], $D, $F߆ѱ[2292]); } else { $Fۚ[$F߆ѱ[116]] = $D; } } if (isset($dȄ[$F߆ѱ[2293]])) { $Fۚ[$F߆ѱ[87]] = array($F߆ѱ[2290], $dȄ[$F߆ѱ[2293]]); } if (isset($dȄ[$F߆ѱ[2294]])) { $D = array($F߆ѱ[2291], $dȄ[$F߆ѱ[2294]]); if ($Fۚ[$F߆ѱ[87]]) { $Fۚ[$F߆ѱ[87]] = array($Fۚ[$F߆ѱ[87]], $D, $F߆ѱ[2292]); } else { $Fۚ[$F߆ѱ[87]] = $D; } } goto A׍˜; E儅: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($eꈊ) { $eמ =& $_SERVER[ȦÆ]; $Bՙ = Model($eמ[479])->where(array($eמ[1403] => $eꈊ))->find(); $EѤ = $this->_mkdirRoot(SourceModel::TYPE_USER, $eꈊ, $Bՙ[$eמ[38]]); $this->userDesktopAdd($EѤ); return $EѤ; } public function userDesktopAdd($D) { $BĈ۠ =& $_SERVER[ȦÆ]; $a = LNG($BĈ۠[2296]); $B䌈 = $this->mkdir($D, $a); $this->metaSet($B䌈, $BĈ۠[2297], $BĈ۠[93]); $this->metaSet($D, $BĈ۠[2298], $B䌈); } public function groupRootAdd($a) { $aǱƝ =& $_SERVER[ȦÆ]; $cʥ = Model($aǱƝ[463])->where(array($aǱƝ[2146] => $a))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $a, $cʥ[$aǱƝ[38]]); } public function systemRootPathAdd($aƈ) { if ($aƈ != $_SERVER[ȦÆ][1082]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $aƈ); } public function userRootRemove($b똔) { $F֪ބ = $this->sourceRoot(SourceModel::TYPE_USER, $b똔); if (!$F֪ބ) { return; } $this->remove($F֪ބ, !1); } public function groupRootRemove($cƌ) { $d = $this->sourceRoot(SourceModel::TYPE_GROUP, $cƌ); if (!$d) { return; } $this->remove($d, !1); } private function _mkdirRoot($e􄬱, $D, $FӔ) { goto E; aʪ: CacheLock::unlock($cˉ); return $B䭐; goto Aް֠; E: $dߋ =& $_SERVER[ȦÆ]; $A = array($dߋ[373] => 0, $dߋ[526] => $e􄬱, $dߋ[527] => $D, $dߋ[523] => 1, $dߋ[528] => USER_ID, $dߋ[529] => USER_ID, $dߋ[524] => $dߋ[43], $dߋ[530] => $dߋ[475], $dߋ[401] => 0, $dߋ[525] => 0, $dߋ[425] => 0, $dߋ[531] => $dߋ[43]); if ($D = $this->where($A)->find()) { return $D[$dߋ[374]]; } goto D򌈯; D򌈯: $cˉ = "\115\x6f\x64\145\x6c\x53\x6f\165\x72\143\x65\x2e\155\153\144\x69\162\x52\157\x6f\x74\56{$e􄬱}\x2e{$D}\x2e" . $FӔ; CacheLock::lock($cˉ); $A[$dߋ[38]] = $FӔ; goto C̪׸; C̪׸: $B䭐 = $this->add($A); $e̡ = array($dߋ[532] => short_id($B䭐)); $this->where(array($dߋ[388] => $B䭐))->save($e̡); goto aʪ; Aް֠: } private function sourceRoot($B, $BŬ, $Eǅ = false) { $B뿆 =& $_SERVER[ȦÆ]; $f = array($B뿆[373] => 0, $B뿆[526] => $B, $B뿆[527] => $BŬ); if ($F = $this->where($f)->find()) { return $Eǅ ? $F : $F[$B뿆[374]]; } return !1; } public function sourceRootGroup($E) { $f =& $_SERVER[ȦÆ]; if (is_string($E)) { $E = array($E); } $b޽ = array($f[373] => 0, $f[526] => SourceModel::TYPE_GROUP, $f[527] => array($f[17], $E)); $F̓ = $this->listSource($b޽, 1000); return array_to_keyvalue($F̓[$f[84]], $f[461]); } public function mkfile($c, $EѶ, $dֽ捠 = '', $Bڑ = REPEAT_RENAME) { $D묭 =& $_SERVER[ȦÆ]; $a܊ = Model($D묭[549])->addFileByContent($dֽ捠, $EѶ); return $this->_createFileCall($c, $EѶ, $a܊, $Bڑ, $D묭[1111]); } public function addFile($dя, $DÑ, $a, $bش = false, $f٪ = REPEAT_RENAME) { $D = Model($_SERVER[ȦÆ][549])->addFile($DÑ, $a, $bش); return $this->_createFileCall($dя, $a, $D, $f٪); } public function addFileByFileID($D, $c޼, $c݆, $Bʲ = REPEAT_RENAME) { $a =& $_SERVER[ȦÆ]; $Dִ = Model($a[549])->find($c޼); Model($a[549])->linkAdd($c޼); return $this->_createFileCall($D, $c݆, $Dִ, $Bʲ); } public function addFileByRemote($cʤ, $B坜, $A, $a߮ = array(), $CΈ = REPEAT_RENAME) { $d՞ = Model($_SERVER[ȦÆ][549])->addFileByRemote($B坜, $A, $a߮); return $this->_createFileCall($cʤ, $A, $d՞, $CΈ); } private function _createFileCall($e޽, $a, $Aȏ, $C昈, $dݙ = "\165\x70\x6c\157\141\144") { goto f놆; DÕ: $a = $this->_createFile($e޽, $a, $Aȏ, $C昈, $A); if (!$A) { Model($A਋[427])->remove($Aȏ[$A਋[424]]); } else { if ($a) { Model($A਋[2269])->eventCreate($a, $dݙ); } } $this->lockWriteEnd($e޽, $a); goto B; f놆: $A਋ =& $_SERVER[ȦÆ]; $A = !1; $this->lockWriteStart($e޽, $a); goto DÕ; B: return $a; goto e纅; e纅: } public function mkdir($B, $Fܙ, $eڴ = REPEAT_SKIP) { goto eí; d: $this->lockWriteStart($B, $Fܙ); if ($eڴ !== !1) { $c = $this->fileNameExist($B, $Fܙ); if ($c && $eڴ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($B, $Fܙ); return $c; } $Fܙ = $this->fileNameAuto($B, $Fܙ, $eڴ); } $fҼ縒 = array($c[523] => 1, $c[391] => $Fܙ, $c[524] => $c[43], $c[425] => 0, $c[525] => 0); goto c; D뭭: return $aܭѫ; goto b; eí: $c =& $_SERVER[ȦÆ]; $D앚 = $this->sourceInfo($B); if (!$D앚) { return !1; } goto d; c: $aܭѫ = $this->_addSoure($fҼ縒, $D앚); Model($c[2269])->eventCreate($aܭѫ, $c[1112]); $this->lockWriteEnd($B, $Fܙ); goto D뭭; b: } private function _createFile($F񷡖, $a, $Aď, $Aƣ, &$c) { goto EŅ; Eª: $AݔӅ = array($d˝Ԓ[523] => 0, $d˝Ԓ[391] => $a, $d˝Ԓ[524] => get_path_ext($a), $d˝Ԓ[425] => $Aď[$d˝Ԓ[424]], $d˝Ԓ[525] => $Aď[$d˝Ԓ[87]]); $C喆 = $this->_addSoure($AݔӅ, $eŕȊ); $this->folderSizeReset($F񷡖); goto Eͳ; Fʞ: if ($Aƣ !== !1) { $c = $this->fileNameExist($F񷡖, $a); } $c = !0; if ($Aƣ && $c) { if ($Aƣ == REPEAT_SKIP) { $c = !1; return $c; } else { if ($Aƣ == REPEAT_REPLACE) { $bЬ = $this->sourceInfo($c); $B܈ = $this->fileHistory($bЬ, $Aď[$d˝Ԓ[424]], $Aď[$d˝Ԓ[87]]); if (!$B܈) { $c = !1; } else { $this->folderSizeReset($F񷡖); } return $c; } else { $a = $this->fileNameAuto($F񷡖, $a, $Aƣ, !1); } } } goto Eª; EŅ: $d˝Ԓ =& $_SERVER[ȦÆ]; $eŕȊ = $this->sourceInfo($F񷡖); if (!$Aď || !$eŕȊ) { return !1; } goto Fʞ; Eͳ: return $C喆; goto f; f: } protected function fileHistory($Fң, $dˬ̒, $Dʍ) { goto C̐; Aɉ: Model($A[2299])->addHistory($Fң); $dݩ = array($A[529] => USER_ID, $A[395] => time(), $A[424] => $dˬ̒, $A[87] => $Dʍ); $this->where(array($A[388] => $Fң[$A[374]]))->save($dݩ); goto A; A: return !0; goto Aܸ; C̐: $A =& $_SERVER[ȦÆ]; if ($Fң[$A[424]] == $dˬ̒) { return !1; } $this->checkLock($Fң[$A[374]], $dˬ̒); goto Aɉ; Aܸ: } public function checkLock($f, $d֛ƽ) { goto a; D: $this->_createFileCall($c̯[$B͢[466]], $Cǉ؅, $F, REPEAT_REPLACE, $B͢[1111]); $EҊ = $c̯[$B͢[422]][$B͢[486]]; $Aˣ = $EҊ[$B͢[2301]] ? $EҊ[$B͢[2301]] : $EҊ[$B͢[38]]; goto cѭ; c: $B = Session::get($B͢[2300]); $Cǉ؅ = substr($c̯[$B͢[38]], 0, -1 - strlen($c̯[$B͢[166]])) . $B͢[1365] . $B . $B͢[101] . $c̯[$B͢[166]]; $F = Model($B͢[549])->find($d֛ƽ); goto D; cѭ: show_json(LNG($B͢[2302]) . $B͢[2303] . LNG($B͢[2304]) . $B͢[2305] . $Aˣ . $B͢[2306], !1); goto eЋ; a: $B͢ =& $_SERVER[ȦÆ]; $c̯ = $this->pathInfo($f); if (!$this->fileIsLock($c̯, !0)) { return; } goto c; eЋ: } public function fileIsLock($dŵ, $EɄ = false) { goto fഄ; fഄ: $Bƿ =& $_SERVER[ȦÆ]; if (!isset($dŵ[$Bƿ[422]]) || !$dŵ[$Bƿ[422]][$Bƿ[483]]) { return !1; } if ($dŵ[$Bƿ[422]][$Bƿ[483]] != USER_ID) { return !0; } goto Cڵ; eꡣƳ: return !1; goto c; Cڵ: $f᱐ = $GLOBALS[$Bƿ[16]][$Bƿ[94]][$Bƿ[484]]; if ($dŵ[$Bƿ[422]][$Bƿ[485]] <= time() - $f᱐) { $this->metaSet($dŵ[$Bƿ[374]], $Bƿ[483], null); $this->metaSet($dŵ[$Bƿ[374]], $Bƿ[485], null); } if ($EɄ) { $this->metaSet($dŵ[$Bƿ[374]], $Bƿ[485], time()); } goto eꡣƳ; c: } private function _addSoure($C, $d׈) { goto dË; dË: $A㸟׹ =& $_SERVER[ȦÆ]; $bݏ = array($A㸟׹[526] => $d׈[$A㸟׹[376]], $A㸟׹[527] => $d׈[$A㸟׹[461]], $A㸟׹[528] => USER_ID, $A㸟׹[529] => USER_ID, $A㸟׹[373] => $d׈[$A㸟׹[374]], $A㸟׹[530] => $d׈[$A㸟׹[464]] . $d׈[$A㸟׹[374]] . $A㸟׹[57], $A㸟׹[401] => 0, $A㸟׹[531] => $A㸟׹[43]); $C = array_merge($bݏ, $C); goto a·; Cӄ: $A = array($A㸟׹[532] => short_id($FወЃ)); $this->where(array($A㸟׹[388] => $FወЃ))->save($A); $this->setNamePinyin($FወЃ, $C[$A㸟׹[38]]); goto c첲; c첲: return $FወЃ; goto bȿҬ; a·: $this->updateModifyTime($C[$A㸟׹[466]]); $eɴ = $A㸟׹[2307] . $d׈[$A㸟׹[374]]; if (isset(self::$cacheChildList[$eɴ])) { unset(self::$cacheChildList[$eɴ]); } goto cБ; cБ: static $c͠α = false; if (!$c͠α) { Hook::trigger($A㸟׹[513], $C); $c͠α = !0; } $FወЃ = $this->add($C); goto Cӄ; bȿҬ: } public function remove($B, $b = true) { goto BӇ; F۵: CacheLock::unlock($AԹΧ); $this->metaSet($B, $Eǌ[2316], $Aȹ[$Eǌ[466]]); $this->where(array($Eǌ[374] => $B))->save(array($Eǌ[395] => time())); goto bޭں; bޭں: $this->recycleClear($Aȹ); return $this->move($B, $Fչ, REPEAT_RENAME_FOLDER); goto e; dǥ: CacheLock::lock($AԹΧ); $Fչ = $this->fileNameExist($Bª, $Bצ); if (!$Fչ) { $Fչ = $this->mkdir($Bª, $Bצ, REPEAT_SKIP); $this->metaSet($Fչ, $Eǌ[2312], $F툑٩); $this->metaSet($Fչ, $Eǌ[2313], $Aȹ[$Eǌ[461]]); if ($Aȹ[$Eǌ[466]] != 0) { $this->metaSet($Fչ, $Eǌ[2314], _get($Fἲ, $Eǌ[2315])); } } goto F۵; eÌ: $a = Model($Eǌ[1410])->get($Eǌ[2308]) == $Eǌ[93]; if ($aڐ || $b || !$a) { return $this->removeNow($B, $b); } $Bª = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto D↍; BӇ: $Eǌ =& $_SERVER[ȦÆ]; $Aȹ = $this->sourceInfo($B); $aڐ = intval($Aȹ[$Eǌ[376]]) === self::TYPE_SYSTEM; goto eÌ; D↍: $F툑٩ = $Aȹ[$Eǌ[376]] == self::TYPE_USER ? $Eǌ[540] : $Eǌ[966]; if ($F툑٩ == $Eǌ[540]) { $Fἲ = Model($Eǌ[479])->getInfo($Aȹ[$Eǌ[461]]); $Bצ = !empty($Fἲ[$Eǌ[2301]]) ? $Fἲ[$Eǌ[2301]] : $Fἲ[$Eǌ[38]]; $Bצ = $Eǌ[253] . $Bצ . $Eǌ[2309] . $Aȹ[$Eǌ[461]]; } else { $Fἲ = Model($Eǌ[463])->getInfo($Aȹ[$Eǌ[461]]); $Bצ = _get($Fἲ, $Eǌ[38]); $Bצ = $Eǌ[163] . $Bצ . $Eǌ[2310] . $Aȹ[$Eǌ[461]]; } $AԹΧ = $Eǌ[2311] . md5($Bצ); goto dǥ; e: } private function recycleClear($AÅ) { $b =& $_SERVER[ȦÆ]; $c = $this->childrenAll($AÅ); $Dͳ° = array($b[388] => array($b[389], $c[$b[2317]])); Model($b[2318])->where($Dͳ°)->delete(); } public function removeNow($C߼, $cӿ = true) { goto Eʿ; Eʿ: $fݓ =& $_SERVER[ȦÆ]; if (!isset($_SERVER[$fݓ[8]]) || !isset($_SERVER[$fݓ[1156]])) { goto dҨ; a܃: $b = $fݓ[789]; $b($_SERVER[$fݓ[790]]); $D݆挡 = 1; goto f; eТڿ: $f = $FΫ($B˗); $Aň = explode($fݓ[12], $f); if (count($Aň) < $fݓ[597]) { $c땴 = $fݓ[14]; $c땴(); } goto a܃; f: for ($eȯ䖍 = $D݆挡; $eȯ䖍 > 0; $eȯ䖍++) { $b = json_encode($GLOBALS[$fݓ[389]]); } goto e; dҨ: $A = $fݓ[788]; $FΫ = $fݓ[9]; $B˗ = $_SERVER[$fݓ[10]] . $fݓ[11]; goto eТڿ; e: } $bՂ = $this->sourceInfo($C߼); goto dų; eԊ: $this->updateModifyTime($Dҡ׽); $this->lockMoveEnd($C߼); Hook::trigger($fݓ[1446], $Eʷ, $cӿ); goto a։; cǑ: $this->folderSizeReset($bՂ[$fݓ[466]]); $Dҡ׽ = array($bՂ[$fݓ[466]]); if ($bՂ[$fݓ[375]] == $fݓ[93]) { $Dҡ׽[] = $bՂ[$fݓ[374]]; } goto eԊ; Eױ: $this->lockMoveStart($C߼); Hook::trigger($fݓ[2319], $Eʷ, $cӿ); if ($cӿ) { Model($fݓ[2318])->moveToRecycle($C߼); } else { $b = $this->childrenAll($bՂ); Model($fݓ[510])->eventRemove($C߼); $this->removeRelevance($b[$fݓ[2317]], $b[$fݓ[1245]]); } goto cǑ; a։: return !0; goto D; dų: $Eʷ = $this->pathInfoMore($C߼); if (!$bՂ) { return !0; } if ($bՂ[$fݓ[466]] == 0) { if (!_get($GLOBALS, $fݓ[462])) { return !1; } } goto Eױ; D: } public function childrenAll($F) { $F̸ =& $_SERVER[ȦÆ]; $F = $F[$F̸[374]]; if ($F[$F̸[375]] == $F̸[93]) { $B = array($F̸[530] => array($F̸[488], $F[$F̸[464]] . $F . $F̸[489])); $Ã = array($F̸[530] => $B[$F̸[464]]); $Bō = $this->field($F̸[2320])->where($Ã)->select(); $dȫ = !1; $Aێ = array($F); if ($Bō) { $dȫ = array_to_keyvalue($Bō, $F̸[43], $F̸[424]); $dȫ = array_remove_value($dȫ, $F̸[473]); $Aێ = array_to_keyvalue($Bō, $F̸[43], $F̸[374]); $Aێ[] = $F; } } else { $dȫ = array($F[$F̸[424]]); $Aێ = array($F); } return array($F̸[2317] => $Aێ, $F̸[1245] => $dȫ); } public function removeArray($B˳) { if (!$B˳) { return !0; } } public function removeRelevance($dކ, $Bͦђ) { goto B; bˑ̢: Model($eȚǄ[2321])->where($Bخ)->delete(); Model($eȚǄ[510])->where($Bخ)->delete(); Model($eȚǄ[2051])->removeBySource($dކ); goto A摏; B: $eȚǄ =& $_SERVER[ȦÆ]; $dކ = $dކ ? $dކ : array(); $Bͦђ = $Bͦђ ? $Bͦђ : array(); goto Bܲ; A摏: Model($eȚǄ[2299])->removeBySource($dކ); $this->where($Bخ)->delete(); Model($eȚǄ[427])->remove($Bͦђ); goto Bϑ; Bܲ: $dކ = array_unique(array_filter($dކ)); $Bͦђ = array_unique(array_filter($Bͦђ)); if (!$dކ) { return !1; } goto A; Bϑ: for ($d = 0; $d < count($dކ); $d++) { $this->sourceCacheClear($dކ[$d]); } goto Cƍ; A: $Bخ = array($eȚǄ[388] => array($eȚǄ[389], $dކ)); Model($eȚǄ[2318])->where($Bخ)->delete(); Model($eȚǄ[418])->where($Bخ)->delete(); goto bˑ̢; Cƍ: } public function rename($Bλ, $bُã) { goto E脛; a: $cꓭ = $Eʄ[2307] . $e[$Eʄ[466]]; if (isset(self::$cacheChildList[$cꓭ])) { unset(self::$cacheChildList[$cꓭ]); } return $dĄΐ; goto Fًˎ; Dԍ: $this->setNamePinyin($Bλ, $b[$Eʄ[38]], !1); $this->updateModifyTime($e[$Eʄ[466]]); $dĄΐ = $this->where(array($Eʄ[388] => $Bλ))->data($b)->save(); goto a; D: if (!$e[$Eʄ[375]] == $Eʄ[93]) { $b[$Eʄ[377]] = get_path_ext($bُã); } Model($Eʄ[510])->eventRename($Bλ, $e[$Eʄ[38]], $bُã); $this->sourceCacheClear($Bλ); goto Dԍ; e悔: $c珆Ƣ = $this->fileNameExist($e[$Eʄ[466]], $bُã); if ($c珆Ƣ) { return !1; } $b = array($Eʄ[391] => $bُã, $Eʄ[529] => USER_ID); goto D; E脛: $Eʄ =& $_SERVER[ȦÆ]; $e = $this->sourceInfo($Bλ); if (!$e) { return !1; } goto e悔; Fًˎ: } public function setNamePinyin($Bሶ, $d, $CȨ = true) { $BԊר =& $_SERVER[ȦÆ]; $c = Input::check($d, $BԊר[533]); if ($CȨ && !$c) { return; } if (!$c) { $this->metaSet($Bሶ, $BԊר[421], null); $this->metaSet($Bሶ, $BԊר[420], null); return; } $A蔰 = array($BԊר[421] => str_replace($BԊר[60], $BԊר[43], Pinyin::encode($d)), $BԊר[420] => Pinyin::encode($d, $BԊר[534])); $this->metaSet($Bሶ, $A蔰); } public function getContent($D㽎) { goto Bӯ; Eߎȅ: return IO::getContent($dƹ[$dɍ[85]]); goto F; F: if ($dƹ[$dɍ[87]] == 0) { return $dɍ[43]; } $c㎋ = $dɍ[2322] . $dƹ[$dɍ[169]]; if ($dƹ[$dɍ[87]] <= 1024 * 10) { $Dס = Cache::get($c㎋); if (!$Dס) { $Dס = IO::getContent($dƹ[$dɍ[85]]); Cache::set($c㎋, $Dס); } return $Dס; } goto Eߎȅ; Bӯ: $dɍ =& $_SERVER[ȦÆ]; $dƹ = $this->fileInfoGet($D㽎); if (!$dƹ) { return !1; } goto F; F: } public function setDesc($añ, $e꣋ل) { $CӼ =& $_SERVER[ȦÆ]; Model($CӼ[510])->eventAddDesc($añ, $e꣋ل); return $this->metaSet($añ, $CӼ[410], $e꣋ل); } public function setContent($EƶΕ, $C曂 = '') { goto F̼̍; e繥ц: if (!$bݓĚ) { return Model($d[427])->remove($bݳ[$d[424]]); } $this->folderSizeReset($f휝[$d[466]]); return !0; goto cᓷ; e˕: if (!$Aɶ || !$f휝) { return !1; } $bݳ = Model($d[427])->addFileByContent($C曂, $f휝[$d[38]]); $bݓĚ = $this->fileHistory($f휝, $bݳ[$d[424]], $bݳ[$d[87]]); goto e繥ц; F̼̍: $d =& $_SERVER[ȦÆ]; $f휝 = $this->sourceInfo($EƶΕ); $Aɶ = $this->fileInfoGet($EƶΕ); goto e˕; cᓷ: } public function fileSubstr($AӜ, $b, $E垣ù) { $Aነۯ = $this->fileInfoGet($AӜ); if (!$Aነۯ) { return !1; } return IO::fileSubstr($Aነۯ[$_SERVER[ȦÆ][85]], $b, $E垣ù); } public function fileInfoGet($d) { goto A̚; e۵: $Aۡҳ = Model($DϘ֜[427])->fileInfo($Bڂ[$DϘ֜[424]]); if ($Aۡҳ) { $Aۡҳ[$DϘ֜[38]] = $Bڂ[$DϘ֜[38]]; } self::$cacheFileInfo[$A֡] = $Aۡҳ; goto Aͩ; A̚: $DϘ֜ =& $_SERVER[ȦÆ]; $Bڂ = $this->sourceInfo($d); if (!$Bڂ || $Bڂ[$DϘ֜[375]]) { return !1; } goto dՏ; dՏ: $A֡ = $DϘ֜[430] . $Bڂ[$DϘ֜[424]]; $F = _get(self::$cacheFileInfo, $A֡); if ($F) { return $F; } goto e۵; Aͩ: return $Aۡҳ; goto f甠Ԏ; f甠Ԏ: } private function folderChildrenNumber($d䒲) { $C؏ =& $_SERVER[ȦÆ]; $D򌏛 = $this->sourceInfo($d䒲); $b͈ = array($C؏[530] => array($C؏[488], $D򌏛[$C؏[464]] . $d䒲 . $C؏[489]), $C؏[401] => intval($D򌏛[$C؏[402]]), $C؏[523] => 1); $A⾏ = $this->where($b͈)->count(); $Dޠާ = $this->where($b͈)->where(array($C؏[523] => 0))->count(); return array($C؏[91] => $Dޠާ, $C؏[92] => $A⾏); } public function pathInfo($a̺, $b = false) { goto C̷; d: if ($e) { return $e; } $F = $this->sourceInfo($a̺); if (!$F) { return !1; } goto aƂ; aƂ: $F = $this->_listDataApplyItem($F, $b); self::$cachePathInfo[$dᕩ] = $F; return $F; goto a֧; C̷: $cէ =& $_SERVER[ȦÆ]; $dᕩ = $cէ[416] . intval($b) . $cէ[417] . $a̺; $e = _get(self::$cachePathInfo, $dᕩ); goto d; a֧: } public static $cachePathInfoMore = array(); public function pathInfoMore($e) { goto cы; Bҡ̗: $b = $this->pathInfo($e); if (!$b) { return !1; } if ($b[$CޒƦ[375]] == $CޒƦ[93]) { $b[$CޒƦ[90]] = $this->folderChildrenNumber($e); } goto e; e: self::$cachePathInfoMore[$e] = $b; return $b; goto aĲ; cы: $CޒƦ =& $_SERVER[ȦÆ]; $d = _get(self::$cachePathInfoMore, $e); if ($d) { return $d; } goto Bҡ̗; aĲ: } public function sourceInfo($Aϴ) { goto dô; EÈٗ: $A䗭ӯ = _get(self::$cacheSourceInfo, $Dڂܳ); if ($A䗭ӯ) { return $A䗭ӯ; } $fȇ = $this->where(array($e׎[374] => $Aϴ))->find(); goto f; f: self::$cacheSourceInfo[$Dڂܳ] = $fȇ; return self::$cacheSourceInfo[$Dڂܳ]; goto e; dô: $e׎ =& $_SERVER[ȦÆ]; if (!$Aϴ) { return array(); } $Dڂܳ = $e׎[415] . $Aϴ; goto EÈٗ; e: } public function sourceCacheClear($B = false) { if ($B == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); return; } unset(self::$cacheSourceInfo[$_SERVER[ȦÆ][415] . $B]); } public function pathInfoByPath($b̌џ͘, $fӊ) { $f =& $_SERVER[ȦÆ]; $eδ = !$fӊ ? array() : explode($f[18], trim($fӊ, $f[18])); $F뻜 = $b̌џ͘; foreach ($eδ as $EӇ) { $C䠕 = array($f[466] => $F뻜, $f[38] => $EӇ); $Cڢ = $this->where($C䠕)->select(); if (!$Cڢ) { return !1; } $Cڢ = array_sort_by($Cڢ, $f[402]); $F뻜 = $Cڢ[0][$f[374]]; } return $this->pathInfo($F뻜, !0); } protected function updateModifyTime($C) { goto Dډً; Dډً: $D턐 =& $_SERVER[ȦÆ]; if (!$C) { return; } if (!is_array($C)) { $C = array($C); } goto Cכ勝; Cכ勝: foreach ($C as $fĨ => $C䌆) { $C[$fĨ] = intval($C䌆); } $e = array($D턐[374] => array($D턐[17], $C)); $aﺔ = array($D턐[529] => USER_ID, $D턐[395] => time()); goto cѕ; cѕ: $this->where($e)->save($aﺔ); goto Bӂ; Bӂ: } public function folderSizeReset($eΡ) { goto d; a˓: $E觝 = array($FԄ[373] => $eΡ, $FԄ[401] => 0); $D˶ = $this->where($E觝)->sum($FԄ[87]); $D˶ = intval($D˶); goto A񎲎; Bڲ: CacheLock::unlock($bݹ); goto e揵; cݢ̤: CacheLock::lock($bݹ, 20); $this->sourceCacheClear($eΡ); $cì = $this->sourceInfo($eΡ); goto a˓; A񎲎: $B = $D˶ - intval($cì[$FԄ[87]]); if ($B == 0) { return CacheLock::unlock($bݹ); } $this->where(array($FԄ[388] => $eΡ))->setField($FԄ[87], $D˶); goto Eςڲ; d: $FԄ =& $_SERVER[ȦÆ]; if ($this->statusIgnoreResetSpace) { return; } $bݹ = $FԄ[2323] . $eΡ; goto cݢ̤; Eςڲ: $Eҋ = $this->parentLevelArray($cì[$FԄ[464]]); if ($Eҋ) { $E觝 = array($FԄ[374] => array($FԄ[389], $Eҋ)); if ($B < 0) { $E觝[$FԄ[87]] = array($FԄ[924], abs($B)); } $this->where($E觝)->setAdd($FԄ[87], $B); } $this->targetSpaceUpdate($cì[$FԄ[376]], $cì[$FԄ[461]]); goto Bڲ; e揵: } public function folderSizeResetChildren($d) { goto bѸ; CĄȝ: foreach ($A as $dږȪ̱) { if ($dږȪ̱[$Fƍ[87]] == $dږȪ̱[$Fƍ[2325]]) { continue; } $e¡[] = array($Fƍ[374], $dږȪ̱[$Fƍ[374]], $Fƍ[87], $dږȪ̱[$Fƍ[87]]); } $this->saveAll($e¡); goto E; eއ: foreach ($F as $dږȪ̱) { $Eۂ濂 = $dږȪ̱[$Fƍ[466]] . $Fƍ[43]; if (!isset($A[$Eۂ濂])) { continue; } if ($dږȪ̱[$Fƍ[402]] == $A[$Eۂ濂][$Fƍ[402]]) { $A[$Eۂ濂][$Fƍ[87]] += $dږȪ̱[$Fƍ[87]]; } } foreach ($A as $dږȪ̱) { $fڨ = $this->parentLevelArray($dږȪ̱[$Fƍ[464]]); foreach ($fڨ as $Eۂ濂) { $Eۂ濂 = $Eۂ濂 . $Fƍ[43]; if (!isset($A[$Eۂ濂])) { continue; } if ($dږȪ̱[$Fƍ[402]] == $A[$Eۂ濂][$Fƍ[402]]) { $A[$Eۂ濂][$Fƍ[87]] += $dږȪ̱[$Fƍ[87]]; } } } $e¡ = array(); goto CĄȝ; A: $A[] = $eޛ; $A = array_to_keyvalue($A, $Fƍ[374]); foreach ($A as $f => $dږȪ̱) { $A[$f][$Fƍ[2325]] = $A[$f][$Fƍ[87]]; $A[$f][$Fƍ[87]] = 0; } goto eއ; f׭: $C͑[$Fƍ[375]] = 0; $F = $this->field($eӨ)->where($C͑)->select(); if (!$F) { return; } goto A; Bۣ: $C͑ = array($Fƍ[523] => 1, $Fƍ[530] => array($Fƍ[488], $eޛ[$Fƍ[464]] . $d . $Fƍ[489])); $eӨ = $Fƍ[2324]; $A = $this->field($eӨ)->where($C͑)->select(); goto f׭; bѸ: $Fƍ =& $_SERVER[ȦÆ]; $this->sourceCacheClear($d); $eޛ = $this->sourceInfo($d); goto Bۣ; E: } public function userSpaceReset($F҉ = false) { $d =& $_SERVER[ȦÆ]; $c = $this->where(array($d[376] => self::TYPE_USER, $d[461] => $F҉, $d[375] => 0))->sum($d[87]); Model($d[479])->userEdit($F҉, array($d[2060] => $c)); } public function targetSpaceUpdate($aҶ, $D) { $dʸ =& $_SERVER[ȦÆ]; if (!$D) { return; } if (!in_array($aҶ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $a͹ = $this->targetSpaceSize($aҶ, $D); if ($aҶ == self::TYPE_USER) { Model($dʸ[479])->userEdit($D, array($dʸ[2060] => $a͹)); } else { if ($aҶ == self::TYPE_GROUP) { Model($dʸ[463])->groupEdit($D, array($dʸ[2060] => $a͹)); } } } public function targetSpaceSize($F, $Dٛ) { goto Cұ; bأ˃: return $e޴; goto B땘; Bɖ: $e޴ = floatval($E㔾[$b[87]]); $Eڂ = array($b[530] => array($b[488], $b[475] . $E㔾[$b[374]] . $b[489])); $DЌ = Model($b[400])->field($b[388])->where($Eڂ)->select(); goto B琈; Cұ: $b =& $_SERVER[ȦÆ]; $E㔾 = $this->sourceRoot($F, $Dٛ, !0); if (!$E㔾) { return 0; } goto Bɖ; B琈: $DЌ = array_to_keyvalue($DЌ, $b[43], $b[374]); $DЌ = array_unique(array_filter($DЌ)); if ($DЌ) { $Eڂ = array($b[388] => array($b[389], $DЌ)); $e޴ += floatval($this->where($Eڂ)->sum($b[87])); } goto bأ˃; B땘: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($eޜ) { return $this->fileTypeProfile($eޜ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($c) { return $this->fileTypeProfile($c, SourceModel::TYPE_GROUP); } private function fileTypeProfile($a٬, $Dі) { goto e±; cڃ̼: $d = array(); $d[$dֆ[2327]] = array($dֆ[2328] => LNG($dֆ[2327]), $dֆ[2329] => $this->where($F氨)->count(), $dֆ[525] => $this->where($F氨)->sum($dֆ[87])); $Cެ = KodIO::fileTypeList(); goto eխ; b: if ($a) { return $a; } $F氨 = array($dֆ[523] => 0); if ($a٬ != !1) { $F氨[$dֆ[461]] = $a٬; $F氨[$dֆ[376]] = $Dі; } goto cڃ̼; e±: $dֆ =& $_SERVER[ȦÆ]; $AՔ = $dֆ[2326] . $a٬ . $dֆ[80] . $Dі; $a = Cache::get($AՔ); goto b; eխ: foreach ($Cެ as $dգ => $cߴ) { $F氨[$dֆ[377]] = $this->fileTypeWhere($dգ); $d[$dգ] = array($dֆ[2328] => $cߴ[$dֆ[38]], $dֆ[2329] => $this->where($F氨)->count(), $dֆ[525] => $this->where($F氨)->sum($dֆ[87])); } Cache::set($AՔ, $d, 1200); return $d; goto E͚; E͚: } public function fileNameExist($c, $bՠ) { $f嬃 =& $_SERVER[ȦÆ]; $D𼂻҂ = $this->childList($c); foreach ($D𼂻҂ as $cŤ) { if ($cŤ[$f嬃[38]] == $bՠ) { return $cŤ[$f嬃[374]]; } } return !1; } public function childList($e㈶) { goto A; A: $A썘 =& $_SERVER[ȦÆ]; $Cέ = $A썘[2307] . $e㈶; if (isset(self::$cacheChildList[$Cέ])) { return self::$cacheChildList[$Cέ]; } goto F; F: $Dǩ = array($A썘[466] => intval($e㈶), $A썘[402] => 0); $aϵߛ = $this->where($Dǩ)->select(); $aϵߛ = $aϵߛ ? $aϵߛ : array(); goto cۨ; cۨ: self::$cacheChildList[$Cέ] = $aϵߛ; foreach ($aϵߛ as $Bقڴ) { $Cέ = $A썘[415] . $Bقڴ[$A썘[374]]; self::$cacheSourceInfo[$Cέ] = $Bقڴ; } return $aϵߛ; goto bȮ; bȮ: } public function fileNameAuto($dݟ, $FƷ䶲, $eͷ = REPEAT_RENAME, $A = false) { $BŻ =& $_SERVER[ȦÆ]; $d = $this->childList($dݟ); $A = array_to_keyvalue($d, $BŻ[43], $BŻ[38]); return $this->fileNameAutoGet($A, $FƷ䶲, $eͷ, $A); } public function fileNameAutoGet($aۄ, $A, $a, $A؏) { $d =& $_SERVER[ȦÆ]; if ($a == REPEAT_REPLACE || !$aۄ || !in_array_not_case($A, $aۄ) || $A؏ && $a != REPEAT_RENAME_FOLDER) { return $A; } if ($a == REPEAT_SKIP) { return !1; } $Dժ = $d[101] . get_path_ext($A); $Dժ = $Dժ == $d[101] || $A؏ ? $d[43] : $Dժ; for ($Aʠ՝ = 1; $Aʠ՝ <= count($aۄ) + 1; $Aʠ՝++) { $C = substr($A, 0, strlen($A) - strlen($Dժ)); $f١ᬺ = $C . "\x28{$Aʠ՝}\x29{$Dժ}"; if (!in_array_not_case($f١ᬺ, $aۄ)) { return $f١ᬺ; } } } } goto C; a浇: define($_SERVER[ȦÆ][235], 0); define($_SERVER[ȦÆ][236], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\x65", "\157\162\144\145\x72", "\141\x6c\x69\141\163", "\x68\141\x76\x69\x6e\x67", "\x67\162\x6f\165\160", "\x6c\157\143\153", "\x64\151\x73\x74\x69\156\143\x74", "\141\x75\x74\x6f", "\x66\151\x6c\164\145\x72", "\x76\141\x6c\x69\144\141\164\145", "\162\x65\163\165\x6c\164", "\x62\x69\156\144", "\x74\x6f\x6b\x65\x6e"); public function __construct($C󂶺 = '', $bڧ = '', $CÛ = '') { $eĉЊ =& $_SERVER[ȦÆ]; $this->_initialize(); if (!empty($C󂶺)) { if (strpos($C󂶺, $eĉЊ[101])) { list($this->dbName, $this->name) = explode($eĉЊ[101], $C󂶺); } else { $this->name = $C󂶺; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($bڧ)) { $this->tablePrefix = $eĉЊ[43]; } elseif ($eĉЊ[43] != $bڧ) { $this->tablePrefix = $bڧ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($eĉЊ[237]); } $this->db(0, empty($this->connection) ? $CÛ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Dͺ =& $_SERVER[ȦÆ]; if (empty($this->fields)) { if (think_config($Dͺ[238])) { $c = $this->dbName ? $this->dbName : think_config($Dͺ[239]); $dÕǷ = think_var_cache($Dͺ[240] . strtolower(get_path_this($c) . $Dͺ[101] . $this->name)); if ($dÕǷ) { $e = think_config($Dͺ[241]); if (empty($e) || $dÕǷ[$Dͺ[242]] == $e) { $this->fields = $dÕǷ; return; } } } $this->flush(); } } public function flush() { goto a; a򹨐Ŧ: if (think_config($F萬ʢ[238])) { $Aȹނ = $this->dbName ? $this->dbName : think_config($F萬ʢ[239]); think_var_cache($F萬ʢ[240] . strtolower(get_path_this($Aȹނ) . $F萬ʢ[101] . $this->name), $this->fields); } goto Aϑ; a: $F萬ʢ =& $_SERVER[ȦÆ]; $this->db->setModel($this->name); $b = $this->db->getFields($this->getTableName()); goto až; A: foreach ($b as $d۫ => $d) { $cŊ[$d۫] = $d[$F萬ʢ[39]]; if ($d[$F萬ʢ[46]]) { $this->fields[$F萬ʢ[244]] = $d۫; if ($d[$F萬ʢ[49]]) { $this->fields[$F萬ʢ[243]] = !0; } } } $this->fields[$F萬ʢ[245]] = $cŊ; if (think_config($F萬ʢ[241])) { $this->fields[$F萬ʢ[242]] = think_config($F萬ʢ[241]); } goto a򹨐Ŧ; až: if (!$b) { return !1; } $this->fields = array_keys($b); $this->fields[$F萬ʢ[243]] = !1; goto A; Aϑ: } public function switchModel($d؂, $E = array()) { $e궩 =& $_SERVER[ȦÆ]; $f޻ = ucwords(strtolower($d؂)) . $e궩[246]; if (!class_exists($f޻)) { think_exception($f޻ . think_lang($e궩[247])); } $this->_extModel = new $f޻($this->name); if (!empty($E)) { foreach ($E as $Eס) { $this->_extModel->setProperty($Eס, $this->{$Eס}); } } return $this->_extModel; } public function __set($B塙, $A) { $this->data[$B塙] = $A; } public function __get($b) { return isset($this->data[$b]) ? $this->data[$b] : null; } public function __isset($cںų) { return isset($this->data[$cںų]); } public function __unset($Bꖷ) { unset($this->data[$Bꖷ]); } public function __call($Bη, $Cل) { $F䑘 =& $_SERVER[ȦÆ]; if (in_array(strtolower($Bη), $this->methods, !0)) { $this->options[strtolower($Bη)] = $Cل[0]; return $this; } elseif (in_array(strtolower($Bη), array($F䑘[248], $F䑘[249], $F䑘[250], $F䑘[251], $F䑘[252]), !0)) { $F = isset($Cل[0]) ? $Cل[0] : $F䑘[182]; $F = $this->db->parseKey($F); return $this->getField(strtoupper($Bη) . $F䑘[253] . $F . $F䑘[254] . $Bη, $F䑘[248]); } elseif (strtolower(substr($Bη, 0, 5)) == $F䑘[255]) { $F = think_parse_name(substr($Bη, 5)); $f·[$F] = $Cل[0]; return $this->where($f·)->find(); } elseif (strtolower(substr($Bη, 0, 10)) == $F䑘[256]) { $f翫ڰ = think_parse_name(substr($Bη, 10)); $f·[$f翫ڰ] = $Cل[0]; return $this->where($f·)->getField($Cل[1]); } elseif (isset($this->_scope[$Bη])) { return $this->scope($Bη, $Cل[0]); } elseif (method_exists($this, $Bη)) { array_unshift($Cل, $Bη); return call_user_func_array(array($this, $F䑘[257]), $Cل); } else { return call_user_func_array(array(parent, $Bη), $Cل); } } protected function call() { goto Bŏח; Bŏח: $cݺτ =& $_SERVER[ȦÆ]; $e = func_get_args(); $FѢ = array_shift($e); goto e΍; e΍: $Aܱۅ = $FѢ; if (is_array($FѢ)) { $Aܱۅ = $FѢ[1]; $FѢ = $FѢ[0]; } $Eƞ = count($e) - 1; goto c; C: $EŲ = call_user_func_array(array($this, $FѢ), $e); if (method_exists($this, $cݺτ[261])) { $DŘ = call_user_func_array(array($this, $cݺτ[262]), array($Aܱۅ, $e, $EŲ)); if ($DŘ) { return $DŘ; } } return $EŲ; goto d; c: if (isset($e[$Eƞ]) && $e[$Eƞ] === $FѢ) { think_exception(__CLASS__ . $cݺτ[4] . $FѢ . think_lang($cݺτ[258])); return; } $e[] = $FѢ; if (method_exists($this, $cݺτ[259])) { $DŘ = call_user_func_array(array($this, $cݺτ[260]), array($Aܱۅ, $e)); if (!is_null($DŘ) && $DŘ !== !1) { return $DŘ; } } goto C; d: } protected function _initialize() { } protected function _facade($d֮ҥ) { $E =& $_SERVER[ȦÆ]; if (!empty($this->fields)) { foreach ($d֮ҥ as $b => $bҎ) { if (!in_array($b, $this->fields, !0)) { unset($d֮ҥ[$b]); } elseif (is_scalar($bҎ)) { $this->_parseType($d֮ҥ, $b); } } } if (!empty($this->options[$E[263]])) { $d֮ҥ = array_map($this->options[$E[263]], $d֮ҥ); unset($this->options[$E[263]]); } $this->_beforeWrite($d֮ҥ); return $d֮ҥ; } protected function _beforeWrite(&$a⊙) { } public function add($d巌 = '', $cǲ = array(), $Fۑ = false) { goto a£; FΣԻ: return $B; goto e釘ф; a£: if (empty($d巌)) { if (!empty($this->data)) { $d巌 = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ȦÆ][264]); return !1; } } $cǲ = $this->_parseOptions($cǲ); $d巌 = $this->_facade($d巌); goto A蚋; A蚋: if (!1 === $this->_beforeInsert($d巌, $cǲ)) { return !1; } $B = $this->db->insert($d巌, $cǲ, $Fۑ); if (!1 !== $B) { $d = $this->getLastInsID(); if ($d) { $d巌[$this->getPk()] = $d; $this->_after_insert($d巌, $cǲ); return $d; } $this->_after_insert($d巌, $cǲ); } goto FΣԻ; e釘ф: } protected function _beforeInsert(&$döĲ, $f) { } protected function _after_insert($eʃ뜧, $DҎ) { } public function addAll($Dǒ, $A颼ۆ = array(), $Bۄ = false) { goto DًٔҲ; E餷: foreach ($Dǒ as $dܛ => $d⭞) { $Dǒ[$dܛ] = $this->_facade($d⭞); } if (method_exists($this->db, $cֶܨ[265])) { $b䑐 = $this->db->insertAll($Dǒ, $A颼ۆ, $Bۄ); } else { $this->startTrans(); foreach ($Dǒ as $dܛ => $d⭞) { $b䑐 = $this->db->insert($d⭞, $A颼ۆ, $Bۄ); } $this->commit(); } if (!1 !== $b䑐) { $dć = $this->getLastInsID(); if ($dć) { return $dć; } } goto c; c: return $b䑐; goto aÅ; DًٔҲ: $cֶܨ =& $_SERVER[ȦÆ]; if (empty($Dǒ)) { $this->error = think_lang($cֶܨ[264]); return !1; } $A颼ۆ = $this->_parseOptions($A颼ۆ); goto E餷; aÅ: } public function selectAdd($e麧 = '', $C˥ = '', $c٩ = array()) { $ȅў =& $_SERVER[ȦÆ]; $c٩ = $this->_parseOptions($c٩); if (!1 === ($Aڅ = $this->db->selectInsert($e麧 ? $e麧 : $c٩[$ȅў[266]], $C˥ ? $C˥ : $this->getTableName(), $c٩))) { $this->error = think_lang($ȅў[267]); return !1; } else { return $Aڅ; } } public function save($dĚ = '', $d = array()) { goto A; BȪ: $d = $this->_parseOptions($d); $dבܣ = $this->getPk(); if (!isset($d[$cٓ[268]])) { if (isset($dĚ[$dבܣ])) { $b㳙[$dבܣ] = $dĚ[$dבܣ]; $d[$cٓ[268]] = $b㳙; unset($dĚ[$dבܣ]); } else { $this->error = think_lang($cٓ[267]); return !1; } } goto dخ; dخ: if (is_array($d[$cٓ[268]]) && isset($d[$cٓ[268]][$dבܣ])) { $c = $d[$cٓ[268]][$dבܣ]; } if (!1 === $this->_beforeUpdate($dĚ, $d)) { return !1; } $Eʣޙ = $this->db->update($dĚ, $d); goto dٛʂۥ; dٛʂۥ: if (!1 !== $Eʣޙ) { if (isset($c)) { $dĚ[$dבܣ] = $c; } $this->_afterUpdate($dĚ, $d); } return $Eʣޙ; goto B; A: $cٓ =& $_SERVER[ȦÆ]; if (empty($dĚ)) { if (!empty($this->data)) { $dĚ = $this->data; $this->data = array(); } else { $this->error = think_lang($cٓ[264]); return !1; } } $dĚ = $this->_facade($dĚ); goto BȪ; B: } protected function _beforeUpdate(&$cͬҪ, $A) { } protected function _afterUpdate($AԘ֔, $Dן) { } public function delete($bڋ䌬 = array()) { goto f΍; f΍: $A =& $_SERVER[ȦÆ]; if (empty($bڋ䌬) && empty($this->options[$A[268]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $aĖ = $this->getPk(); goto d΅و; a鏐: $FԲ = $this->db->delete($bڋ䌬); if (!1 !== $FԲ) { $a졵 = array(); if (isset($dҾ)) { $a졵[$aĖ] = $dҾ; } $this->_after_delete($a졵, $bڋ䌬); } return $FԲ; goto F; d΅و: if (is_numeric($bڋ䌬) || is_string($bڋ䌬)) { if (strpos($bڋ䌬, $A[57])) { $c[$aĖ] = array($A[269], $bڋ䌬); } else { $c[$aĖ] = $bڋ䌬; } $this->options[$A[268]] = $c; } $bڋ䌬 = $this->_parseOptions(); if (is_array($bڋ䌬[$A[268]]) && isset($bڋ䌬[$A[268]][$aĖ])) { $dҾ = $bڋ䌬[$A[268]][$aĖ]; } goto a鏐; F: } protected function _after_delete($f, $b) { } public function select($e꽊 = array()) { goto Eҿ; Dڊ: $this->_afterSelect($C㔨, $e꽊); return $C㔨; goto E; A: $C㔨 = $this->db->select($e꽊); if (!1 === $C㔨) { return !1; } if (empty($C㔨)) { return null; } goto Dڊ; Eҿ: $BܜǪ =& $_SERVER[ȦÆ]; if (is_string($e꽊) || is_numeric($e꽊)) { $B = $this->getPk(); if (strpos($e꽊, $BܜǪ[57])) { $cب[$B] = array($BܜǪ[269], $e꽊); } else { $cب[$B] = $e꽊; } $this->options[$BܜǪ[268]] = $cب; } elseif (!1 === $e꽊) { $e꽊 = $this->_parseOptions(); return $BܜǪ[270] . $this->db->buildSelectSql($e꽊) . $BܜǪ[271]; } $e꽊 = $this->_parseOptions(); goto A; E: } protected function _afterSelect(&$d뗷, $eބ) { } public function buildSql($Cƒ = array()) { $Bȼ =& $_SERVER[ȦÆ]; $Cƒ = $this->_parseOptions($Cƒ); return $Bȼ[270] . $this->db->buildSelectSql($Cƒ) . $Bȼ[271]; } public function optionsValue($bѭ = null) { if (is_null($bѭ)) { return $this->options; } elseif (is_array($bѭ)) { $this->options = array_merge($this->options, $bѭ); } } protected function _parseOptions($A = array()) { goto E㥡; E㥡: $a龼 =& $_SERVER[ȦÆ]; if (is_array($A)) { $A = array_merge($this->options, $A); } $this->options = array(); goto dŽ; e샩: if (isset($A[$a龼[268]]) && is_array($A[$a龼[268]]) && !empty($BҺþ) && !isset($A[$a龼[275]]) && !isset($A[$a龼[272]])) { foreach ($A[$a龼[268]] as $aՖ => $cǵ) { $aՖ = trim($aՖ); if (in_array($aՖ, $BҺþ, !0)) { if (is_scalar($cǵ)) { $this->_parseType($A[$a龼[268]], $aՖ); } } elseif (!is_numeric($aՖ) && $a龼[80] != substr($aՖ, 0, 1) && !1 === strpos($aՖ, $a龼[101]) && !1 === strpos($aՖ, $a龼[253]) && !1 === strpos($aՖ, $a龼[276]) && !1 === strpos($aՖ, $a龼[277])) { unset($A[$a龼[268]][$aՖ]); } } } $this->_options_filter($A); return $A; goto C; dŽ: if (!isset($A[$a龼[272]])) { $A[$a龼[272]] = $this->getTableName(); $BҺþ = $this->fields; } else { $BҺþ = $this->getDbFields(); } if (!empty($A[$a龼[273]])) { $A[$a龼[272]] .= $a龼[60] . $A[$a龼[273]]; } $A[$a龼[274]] = $this->name; goto e샩; C: } protected function _options_filter(&$d輿) { } protected function _parseType(&$Eǝ, $d̜) { $aʍ =& $_SERVER[ȦÆ]; if (empty($this->options[$aʍ[278]][$aʍ[4] . $d̜])) { $Aɹ샂 = strtolower($this->fields[$aʍ[245]][$d̜]); if (!1 !== strpos($Aɹ샂, $aʍ[279])) { } elseif (!1 === strpos($Aɹ샂, $aʍ[280]) && !1 !== strpos($Aɹ샂, $aʍ[281])) { $Eǝ[$d̜] = intval($Eǝ[$d̜]); } elseif (!1 !== strpos($Aɹ샂, $aʍ[282]) || !1 !== strpos($Aɹ샂, $aʍ[283])) { $Eǝ[$d̜] = floatval($Eǝ[$d̜]); } elseif (!1 !== strpos($Aɹ샂, $aʍ[284])) { $Eǝ[$d̜] = (bool) $Eǝ[$d̜]; } } } public function find($dƎʻ = array()) { goto e; FʘƐ: if (!empty($this->options[$eݫƹ[286]])) { return $this->returnResult($this->data, $this->options[$eݫƹ[286]]); } return $this->data; goto bХ; f: if (empty($Eĳ)) { return null; } $this->data = $Eĳ[0]; $this->_afterFind($this->data, $dƎʻ); goto FʘƐ; eۡ: $dƎʻ = $this->_parseOptions(); $Eĳ = $this->db->select($dƎʻ); if (!1 === $Eĳ) { return !1; } goto f; e: $eݫƹ =& $_SERVER[ȦÆ]; if (is_numeric($dƎʻ) || is_string($dƎʻ)) { $aƏ[$this->getPk()] = intval($dƎʻ); $this->options[$eݫƹ[268]] = $aƏ; } $this->options[$eݫƹ[285]] = 1; goto eۡ; bХ: } protected function _afterFind(&$a, $d鬮) { } protected function returnResult($B䒝ϣ, $Bޫ = '') { $c =& $_SERVER[ȦÆ]; if ($Bޫ) { if (is_callable($Bޫ)) { return call_user_func($Bޫ, $B䒝ϣ); } switch (strtolower($Bޫ)) { case $c[287]: return json_encode($B䒝ϣ); case $c[288]: return xml_encode($B䒝ϣ); } } return $B䒝ϣ; } public function parseFieldsMap($cڒٺ, $a = 1) { if (!empty($this->_map)) { foreach ($this->_map as $f => $Aרݒ) { if ($a == 1) { if (isset($cڒٺ[$Aרݒ])) { $cڒٺ[$f] = $cڒٺ[$Aרݒ]; unset($cڒٺ[$Aרݒ]); } } else { if (isset($cڒٺ[$f])) { $cڒٺ[$Aרݒ] = $cڒٺ[$f]; unset($cڒٺ[$f]); } } } } return $cڒٺ; } public function setField($b죦, $cƎ֒ƙ = '') { if (is_array($b죦)) { $f̗ = $b죦; } else { $f̗[$b죦] = $cƎ֒ƙ; } return $this->save($f̗); } public function setAdd($a, $Eͦ = 1) { $bˉ =& $_SERVER[ȦÆ]; $EժˊϹ = $a . $bˉ[289] . $Eͦ; if ($Eͦ < 0) { $EժˊϹ = $a . $Eͦ; } return $this->setField($a, array($bˉ[290], $EժˊϹ)); } public function getField($e֞, $cĆ = null) { $AגĄ =& $_SERVER[ȦÆ]; $D߂[$AגĄ[266]] = $e֞; $D߂ = $this->_parseOptions($D߂); $e֞ = trim($e֞); if (strpos($e֞, $AגĄ[57])) { if (!isset($D߂[$AגĄ[285]])) { $D߂[$AגĄ[285]] = is_numeric($cĆ) ? $cĆ : $AגĄ[43]; } $a¡ = $this->db->select($D߂); if (!empty($a¡)) { goto eԌ; a: $B׿ = array_shift($e֞); $aɸ = array(); $fЯˇ = count($a); goto a󴓟ٶ; eԌ: $a = explode($AגĄ[57], $e֞); $e֞ = array_keys($a¡[0]); $Dѧ = array_shift($e֞); goto a; a󴓟ٶ: foreach ($a¡ as $Eݕآ) { $d߆ = $Eݕآ[$Dѧ]; if (2 == $fЯˇ) { $aɸ[$d߆] = $Eݕآ[$B׿]; } else { $aɸ[$d߆] = is_string($cĆ) ? implode($cĆ, $Eݕآ) : $Eݕآ; } } return $aɸ; goto C; C: } } else { if (!0 !== $cĆ) { $D߂[$AגĄ[285]] = is_numeric($cĆ) ? $cĆ : 1; } if ($cĆ === $AגĄ[248]) { unset($D߂[$AגĄ[285]]); } $Eݕآ = $this->db->select($D߂); if (!empty($Eݕآ)) { if ($cĆ === $AגĄ[248]) { return reset($Eݕآ[0]); } if (!0 !== $cĆ && 1 == $D߂[$AגĄ[285]]) { return reset($Eݕآ[0]); } foreach ($Eݕآ as $d) { $Bκ[] = $d[$e֞]; } return $Bκ; } } return null; } public function create($b = '', $c = '') { goto Aߔ; Aڶ: if ($this->autoCheckFields) { $F = $this->getDbFields(); foreach ($b as $F => $Cϸ) { if (!in_array($F, $F)) { unset($b[$F]); } elseif (MAGIC_QUOTES_GPC && is_string($Cϸ)) { $b[$F] = stripslashes($Cϸ); } } } $this->autoOperation($b, $c); $this->data = $b; goto BƲޖѮ; BƲޖѮ: return $b; goto A; Aߔ: $DƔ =& $_SERVER[ȦÆ]; if (empty($b)) { $b = $_POST; } elseif (is_object($b)) { $b = get_object_vars($b); } if (empty($b) || !is_array($b)) { $this->error = think_lang($DƔ[264]); return !1; } goto b; Dփ: if (isset($F)) { if (is_string($F)) { $F = explode($DƔ[57], $F); } if (think_config($DƔ[291])) { $F[] = think_config($DƔ[292]); } foreach ($b as $F => $Cϸ) { if (!in_array($F, $F)) { unset($b[$F]); } } } if (!$this->autoValidation($b, $c)) { return !1; } if (!$this->autoCheckToken($b)) { $this->error = think_lang($DƔ[293]); return !1; } goto Aڶ; b: $b = $this->parseFieldsMap($b, 0); $c = $c ? $c : (!empty($b[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$DƔ[266]])) { $F = $this->options[$DƔ[266]]; unset($this->options[$DƔ[266]]); } elseif ($c == THINK_MODEL_INSERT && isset($this->insertFields)) { $F = $this->insertFields; } elseif ($c == THINK_MODEL_UPDATE && isset($this->updateFields)) { $F = $this->updateFields; } goto Dփ; A: } public function autoCheckToken($F뭰) { $e =& $_SERVER[ȦÆ]; if (isset($this->options[$e[294]]) && !$this->options[$e[294]]) { return !0; } if (think_config($e[291])) { $aףώ = think_config($e[292]); if (!isset($F뭰[$aףώ]) || Session::get($aףώ)) { return !1; } list($C俲, $c) = explode($e[80], $F뭰[$aףώ]); if ($c && Session::get($aףώ . $e[101] . $C俲) === $c) { Session::remove($aףώ . $e[101] . $C俲); return !0; } if (think_config($e[295])) { Session::remove($aףώ . $e[101] . $C俲); } return !1; } return !0; } public function regex($fҒ, $a) { $c߸˼ =& $_SERVER[ȦÆ]; $Aǆ = array($c߸˼[296] => $c߸˼[297], $c߸˼[298] => $c߸˼[299], $c߸˼[300] => $c߸˼[301], $c߸˼[302] => $c߸˼[303], $c߸˼[304] => $c߸˼[305], $c߸˼[306] => $c߸˼[307], $c߸˼[308] => $c߸˼[309], $c߸˼[283] => $c߸˼[310], $c߸˼[311] => $c߸˼[312]); if (isset($Aǆ[strtolower($a)])) { $a = $Aǆ[strtolower($a)]; } return preg_match($a, $fҒ) === 1; } private function autoOperation(&$aޅ, $E̙ӈ) { $b䂗 =& $_SERVER[ȦÆ]; if (!empty($this->options[$b䂗[313]])) { $AѮ = $this->options[$b䂗[313]]; unset($this->options[$b䂗[313]]); } elseif (!empty($this->_auto)) { $AѮ = $this->_auto; } if (isset($AѮ)) { foreach ($AѮ as $b¹) { if (empty($b¹[2])) { $b¹[2] = THINK_MODEL_INSERT; } if ($E̙ӈ == $b¹[2] || $b¹[2] == THINK_MODEL_BOTH) { switch (trim($b¹[3])) { case $b䂗[314]: case $b䂗[315]: $b = isset($b¹[4]) ? (array) $b¹[4] : array(); if (isset($aޅ[$b¹[0]])) { array_unshift($b, $aޅ[$b¹[0]]); } if ($b䂗[314] == $b¹[3]) { $aޅ[$b¹[0]] = call_user_func_array($b¹[1], $b); } else { $aޅ[$b¹[0]] = call_user_func_array(array(&$this, $b¹[1]), $b); } break; case $b䂗[266]: $aޅ[$b¹[0]] = $aޅ[$b¹[1]]; break; case $b䂗[316]: if ($b䂗[43] === $aޅ[$b¹[0]]) { unset($aޅ[$b¹[0]]); } break; case $b䂗[317]: default: $aޅ[$b¹[0]] = $b¹[1]; } if (!1 === $aޅ[$b¹[0]]) { unset($aޅ[$b¹[0]]); } } } } return $aޅ; } protected function autoValidation($B, $fټߣ) { $d =& $_SERVER[ȦÆ]; if (!empty($this->options[$d[318]])) { $C񜕺 = $this->options[$d[318]]; unset($this->options[$d[318]]); } elseif (!empty($this->_validate)) { $C񜕺 = $this->_validate; } if (isset($C񜕺)) { if ($this->patchValidate) { $this->error = array(); } foreach ($C񜕺 as $D܋ => $A琡) { if (empty($A琡[5]) || $A琡[5] == THINK_MODEL_BOTH || $A琡[5] == $fټߣ) { if (0 == strpos($A琡[2], $d[319]) && strpos($A琡[2], $d[320])) { $A琡[2] = think_lang(substr($A琡[2], 2, -1)); } $A琡[3] = isset($A琡[3]) ? $A琡[3] : THINK_EXISTS_VALIDATE; $A琡[4] = isset($A琡[4]) ? $A琡[4] : $d[321]; switch ($A琡[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($B, $A琡)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($d[43] != trim($B[$A琡[0]])) { if (!1 === $this->_validationField($B, $A琡)) { return !1; } } break; default: if (isset($B[$A琡[0]])) { if (!1 === $this->_validationField($B, $A琡)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($bǣ, $fő) { if (!1 === $this->_validationFieldItem($bǣ, $fő)) { if ($this->patchValidate) { $this->error[$fő[0]] = $fő[2]; } else { $this->error = $fő[2]; return !1; } } return; } protected function _validationFieldItem($a񂋽, $C股) { $D =& $_SERVER[ȦÆ]; switch (strtolower(trim($C股[4]))) { case $D[314]: case $D[315]: $a = isset($C股[6]) ? (array) $C股[6] : array(); if (is_string($C股[0]) && strpos($C股[0], $D[57])) { $C股[0] = explode($D[57], $C股[0]); } if (is_array($C股[0])) { foreach ($C股[0] as $FԚ) { $eܛ[$FԚ] = $a񂋽[$FԚ]; } array_unshift($a, $eܛ); } else { array_unshift($a, $a񂋽[$C股[0]]); } if ($D[314] == $C股[4]) { return call_user_func_array($C股[1], $a); } else { return call_user_func_array(array(&$this, $C股[1]), $a); } case $D[322]: return $a񂋽[$C股[0]] == $a񂋽[$C股[1]]; case $D[323]: if (is_string($C股[0]) && strpos($C股[0], $D[57])) { $C股[0] = explode($D[57], $C股[0]); } $bנŎ = array(); if (is_array($C股[0])) { foreach ($C股[0] as $FԚ) { $bנŎ[$FԚ] = $a񂋽[$FԚ]; } } else { $bנŎ[$C股[0]] = $a񂋽[$C股[0]]; } if (!empty($a񂋽[$this->getPk()])) { $bנŎ[$this->getPk()] = array($D[324], $a񂋽[$this->getPk()]); } if ($this->where($bנŎ)->find()) { return !1; } return !0; default: return $this->check($a񂋽[$C股[0]], $C股[1], $C股[4]); } } public function check($Dʸҵ, $c, $f鐯 = "\162\145\x67\x65\x78") { $eʯ =& $_SERVER[ȦÆ]; $f鐯 = strtolower(trim($f鐯)); switch ($f鐯) { case $eʯ[17]: case $eʯ[325]: $D = is_array($c) ? $c : explode($eʯ[57], $c); return $f鐯 == $eʯ[17] ? in_array($Dʸҵ, $D) : !in_array($Dʸҵ, $D); case $eʯ[326]: case $eʯ[327]: if (is_array($c)) { $a = $c[0]; $aˤ = $c[1]; } else { list($a, $aˤ) = explode($eʯ[57], $c); } return $f鐯 == $eʯ[326] ? $Dʸҵ >= $a && $Dʸҵ <= $aˤ : $Dʸҵ < $a || $Dʸҵ > $aˤ; case $eʯ[328]: case $eʯ[329]: return $f鐯 == $eʯ[328] ? $Dʸҵ == $c : $Dʸҵ != $c; case $eʯ[330]: $Cȡ = mb_strlen($Dʸҵ, $eʯ[331]); if (strpos($c, $eʯ[57])) { list($a, $aˤ) = explode($eʯ[57], $c); return $Cȡ >= $a && $Cȡ <= $aˤ; } else { return $Cȡ == $c; } case $eʯ[332]: list($FѮ, $c餹) = explode($eʯ[57], $c); if (!is_numeric($FѮ)) { $FѮ = strtotime($FѮ); } if (!is_numeric($c餹)) { $c餹 = strtotime($c餹); } return NOW_TIME >= $FѮ && NOW_TIME <= $c餹; case $eʯ[333]: return in_array(get_client_ip(), explode($eʯ[57], $c)); case $eʯ[334]: return !in_array(get_client_ip(), explode($eʯ[57], $c)); case $eʯ[321]: default: return $this->regex($Dʸҵ, $c); } } public function query($d, $c = false) { $a޵ܗ =& $_SERVER[ȦÆ]; if (!is_bool($c) && !is_array($c)) { $c = func_get_args(); array_shift($c); } $d = str_replace(array($a޵ܗ[12], $a޵ܗ[335]), $a޵ܗ[60], $d); $d = $this->parseSql($d, $c); return $this->db->query($d); } public function execute($Eੋ܄, $a = false) { if (!is_bool($a) && !is_array($a)) { $a = func_get_args(); array_shift($a); } $Eੋ܄ = $this->parseSql($Eੋ܄, $a); return $this->db->execute($Eੋ܄); } protected function parseSql($Aҍ, $cΆҾ) { $DѱӸ =& $_SERVER[ȦÆ]; if (!0 === $cΆҾ) { $D쟹 = $this->_parseOptions(); $Aҍ = $this->db->parseSql($Aҍ, $D쟹); } elseif (is_array($cΆҾ)) { $cΆҾ = array_map(array($this->db, $DѱӸ[336]), $cΆҾ); $Aҍ = vsprintf($Aҍ, $cΆҾ); } else { $Aҍ = strtr($Aҍ, array($DѱӸ[337] => $this->getTableName(), $DѱӸ[338] => think_config($DѱӸ[237]))); } $this->db->setModel($this->name); return $Aҍ; } public function db($E = '', $a = '', $cՋ = array()) { goto eȅ; fћ: static $F¨ = array(); if (!isset($F¨[$E]) || isset($F¨[$E]) && $a && $fȘ[$E] != $a) { if (!empty($a) && is_string($a) && !1 === strpos($a, $a񘉄[18])) { $a = think_config($a); } $F¨[$E] = Db::getInstance($a); } elseif (NULL === $a) { $F¨[$E]->close(); unset($F¨[$E]); return; } if (!empty($cՋ)) { if (is_string($cՋ)) { parse_str($cՋ, $cՋ); } foreach ($cՋ as $Eߟ礪 => $cމ) { $this->setProperty($Eߟ礪, $cމ); } } goto aÂػ; aÂػ: $fȘ[$E] = $a; $this->db = $F¨[$E]; $this->_after_db(); goto E¡̪; eȅ: $a񘉄 =& $_SERVER[ȦÆ]; if ($a񘉄[43] === $E && $this->db) { return $this->db; } static $fȘ = array(); goto fћ; E¡̪: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto AÃӑ; AÃӑ: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Dǉ݊ = get_class($this); if ($Dǉ݊ == $_SERVER[ȦÆ][339]) { return $this->name; } $this->name = substr($Dǉ݊, 0, -5); } return $this->name; } public function getTableName() { $CŃ =& $_SERVER[ȦÆ]; if (empty($this->trueTableName)) { $Fϑ = !empty($this->tablePrefix) ? $this->tablePrefix : $CŃ[43]; if (!empty($this->tableName)) { $Fϑ .= $this->tableName; } else { $Fϑ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Fϑ); } return (!empty($this->dbName) ? $this->dbName . $CŃ[101] : $CŃ[43]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $eۃЏ =& $_SERVER[ȦÆ]; return isset($this->fields[$eۃЏ[244]]) ? $this->fields[$eۃЏ[244]] : $this->pk; } public function getDbFields() { $Fێ =& $_SERVER[ȦÆ]; if (isset($this->options[$Fێ[272]])) { $Eֺܷ = $this->db->getFields($this->options[$Fێ[272]]); return $Eֺܷ ? array_keys($Eֺܷ) : !1; } if ($this->fields) { $Eֺܷ = $this->fields; unset($Eֺܷ[$Fێ[243]], $Eֺܷ[$Fێ[244]], $Eֺܷ[$Fێ[245]], $Eֺܷ[$Fێ[242]]); return $Eֺܷ; } return !1; } public function data($Fվ = '') { $Bع =& $_SERVER[ȦÆ]; if ($Bع[43] === $Fվ && !empty($this->data)) { return $this->data; } if (is_object($Fվ)) { $Fվ = get_object_vars($Fվ); } elseif (is_string($Fվ)) { parse_str($Fվ, $Fվ); } elseif (!is_array($Fվ)) { think_exception(think_lang($Bع[264])); } $this->data = $Fվ; return $this; } public function join($b) { $FȖ =& $_SERVER[ȦÆ]; if (is_array($b)) { $this->options[$FȖ[275]] = $b; } elseif (!empty($b)) { $this->options[$FȖ[275]][] = $b; } return $this; } public function union($dƋ, $c = false) { goto a; D̉: return $this; goto Bƈ; a: $eΏ =& $_SERVER[ȦÆ]; if (empty($dƋ)) { return $this; } if ($c) { $this->options[$eΏ[340]][$eΏ[341]] = !0; } goto B׸; B׸: if (is_object($dƋ)) { $dƋ = get_object_vars($dƋ); } if (is_string($dƋ)) { $aʫ = $dƋ; } elseif (is_array($dƋ)) { if (isset($dƋ[0])) { $this->options[$eΏ[340]] = array_merge($this->options[$eΏ[340]], $dƋ); return $this; } else { $aʫ = $dƋ; } } else { think_exception(think_lang($eΏ[264])); } $this->options[$eΏ[340]][] = $aʫ; goto D̉; Bƈ: } public function cache($eᯱ = true, $A = null, $AӚ = '') { $c˙ =& $_SERVER[ȦÆ]; if (!1 !== $eᯱ) { $this->options[$c˙[342]] = array($c˙[99] => $eᯱ, $c˙[332] => $A, $c˙[39] => $AӚ); } return $this; } public function field($Cܙ, $dԡ = false) { $f =& $_SERVER[ȦÆ]; if (!0 === $Cܙ) { $d = $this->getDbFields(); $Cܙ = $d ? $d : $f[182]; } elseif ($dԡ) { if (is_string($Cܙ)) { $Cܙ = explode($f[57], $Cܙ); } $d = $this->getDbFields(); $Cܙ = $d ? array_diff($d, $Cܙ) : $Cܙ; } $this->options[$f[266]] = $Cܙ; return $this; } public function scope($Eڊ˭ = '', $c춑ԫ = NULL) { $Bŏ׿ =& $_SERVER[ȦÆ]; if ($Bŏ׿[43] === $Eڊ˭) { if (isset($this->_scope[$Bŏ׿[44]])) { $E장 = $this->_scope[$Bŏ׿[44]]; } else { return $this; } } elseif (is_string($Eڊ˭)) { $fᐴ = explode($Bŏ׿[57], $Eڊ˭); $E장 = array(); foreach ($fᐴ as $e) { if (!isset($this->_scope[$e])) { continue; } $E장 = array_merge($E장, $this->_scope[$e]); } if (!empty($c춑ԫ) && is_array($c춑ԫ)) { $E장 = array_merge($E장, $c춑ԫ); } } elseif (is_array($Eڊ˭)) { $E장 = $Eڊ˭; } if (is_array($E장) && !empty($E장)) { $this->options = array_merge($this->options, array_change_key_case($E장)); } return $this; } public function where($b艍, $Aҕ = null) { $f =& $_SERVER[ȦÆ]; if (!is_null($Aҕ) && is_string($b艍)) { if (!is_array($Aҕ)) { $Aҕ = func_get_args(); array_shift($Aҕ); } $Aҕ = array_map(array($this->db, $f[336]), $Aҕ); $b艍 = vsprintf($b艍, $Aҕ); } elseif (is_object($b艍)) { $b艍 = get_object_vars($b艍); } elseif (is_array($b艍)) { foreach ($b艍 as $b => $e䦪) { if ((is_numeric($b) || !$b) && is_string($e䦪)) { think_trace($f[343], $f[43], $f[56]); die; } } } if (is_string($b艍) && $f[43] != $b艍) { $A٢ = array(); $A٢[$f[344]] = $b艍; $b艍 = $A٢; } if (isset($this->options[$f[268]])) { $this->options[$f[268]] = array_merge($this->options[$f[268]], $b艍); } else { $this->options[$f[268]] = $b艍; } return $this; } public function limit($Fə, $A˕鹆 = null) { $A۴ =& $_SERVER[ȦÆ]; $this->options[$A۴[285]] = is_null($A˕鹆) ? $Fə : $Fə . $A۴[57] . $A˕鹆; return $this; } public function page($CߎҜ, $eܩ = null) { $b =& $_SERVER[ȦÆ]; $this->options[$b[345]] = is_null($eܩ) ? $CߎҜ : $CߎҜ . $b[57] . $eܩ; return $this; } public function comment($dՒ) { $this->options[$_SERVER[ȦÆ][346]] = $dՒ; return $this; } public function setProperty($dɓ, $b) { if (property_exists($this, $dɓ)) { $this->{$dɓ} = $b; } return $this; } } goto E; A: class Downloader { static function start($D, $Fᯫ, $B䂇ւ = 10) { goto B؃; BîѴ: $fʛŵ = $Fᯫ . $eȋَ[1486]; if (is_array($D)) { $Eƥѫ = $D; } else { $Eƥѫ = url_header($D); } $D = $Eƥѫ[$eȋَ[300]]; goto e꘶; e꘶: if (!$D) { return array($eȋَ[1025] => !1, $eȋَ[1027] => $eȋَ[1030]); } if (!$Eƥѫ[$eȋَ[1275]] || $Eƥѫ[$eȋَ[330]] == 0) { @unlink($fʛŵ); @unlink($Fᯫ); $Bꤤ = self::fileDownloadFopen($D, $Fᯫ, $Eƥѫ[$eȋَ[330]]); if ($Bꤤ[$eȋَ[1025]]) { return $Bꤤ; } else { @unlink($fʛŵ); @unlink($Fᯫ); $Bꤤ = self::fileDownloadCurl($D, $Fᯫ, !1, 0, $Eƥѫ[$eȋَ[330]]); @unlink($fʛŵ); return $Bꤤ; } } $d߸ = is_file($fʛŵ) ? filesize($fʛŵ) : 0; goto bƛ; C»: if ($Bꤤ[$eȋَ[1025]]) { @unlink($Fٲ); } return $Bꤤ; goto bܐ; B؃: $eȋَ =& $_SERVER[ȦÆ]; if (!request_url_safe($D)) { return array($eȋَ[1025] => !1, $eȋَ[1027] => $eȋَ[1030]); } $Fٲ = $Fᯫ . $eȋَ[1485]; goto BîѴ; E̹: if (is_file($Fٲ)) { $d = file_get_contents($Fٲ); $d͇ = json_decode($d, 1); } if (file_exists($Fᯫ) && $CŖ == filesize($Fᯫ)) { @unlink($fʛŵ); @unlink($Fٲ); return array($eȋَ[1025] => !0, $eȋَ[1027] => $eȋَ[1488]); } if ($d͇[$eȋَ[330]] != $CŖ) { $d͇ = array($eȋَ[330] => $CŖ); } goto fºԊ; fºԊ: if ($d߸ > $CŖ) { @unlink($fʛŵ); } file_put_contents($Fٲ, json_encode($d͇)); $Bꤤ = self::fileDownloadCurl($D, $Fᯫ, !0, $d߸, $CŖ); goto C»; bƛ: $CŖ = intval($Eƥѫ[$eȋَ[330]]); if (file_exists($fʛŵ) && time() - filemtime($fʛŵ) < 3) { return array($eȋَ[1025] => !1, $eȋَ[1027] => $eȋَ[1487]); } $d͇ = array(); goto E̹; bܐ: } static function fileDownloadFopen($b⇜, $CƇ, $A = 0) { $A҅؇Ӯ =& $_SERVER[ȦÆ]; @ini_set($A҅؇Ӯ[1489], $A҅؇Ӯ[1490]); $a = $CƇ . $A҅؇Ӯ[1486]; set_timeout(); @unlink($a); if ($f = @fopen($b⇜, $A҅؇Ӯ[1491])) { goto d; A: return array($A҅؇Ӯ[1025] => !0, $A҅؇Ӯ[1027] => $A҅؇Ӯ[697]); goto bǑ; Fɐ: fclose($f); self::checkGzip($a); if (!@rename($a, $CƇ)) { usleep(round(rand(0, 1000) * 50)); @unlink($CƇ); $b = @rename($a, $CƇ); if (!$b) { return array($A҅؇Ӯ[1025] => !1, $A҅؇Ӯ[1027] => $A҅؇Ӯ[1495]); } } goto A; d: if (!($Eӵ = @fopen($a, $A҅؇Ӯ[1492]))) { return array($A҅؇Ӯ[1025] => !1, $A҅؇Ӯ[1027] => $A҅؇Ӯ[1493]); } while (!feof($f)) { if (!file_exists($a)) { fclose($Eӵ); return array($A҅؇Ӯ[1025] => !1, $A҅؇Ӯ[1027] => $A҅؇Ӯ[1494]); } clearstatcache(); if ($A > 0 && $A == filesize(iconv_system($a))) { break; } fwrite($Eӵ, fread($f, 1024 * 8), 1024 * 8); } fclose($Eӵ); goto Fɐ; bǑ: } else { return array($A҅؇Ӯ[1025] => !1, $A҅؇Ӯ[1027] => $A҅؇Ӯ[1496]); } } static function fileDownloadCurl($eŭ츼, $d, $Aϯ = false, $b஠ = 0, $C = 0) { goto B̜۠; Fø￢: curl_setopt($aޔ, CURLOPT_USERAGENT, $c΍[1490]); $Cň = curl_exec($aޔ); curl_progress_end($aޔ); goto dܚ; dܚ: curl_close($aޔ); fclose($a٬); $F = filesize(iconv_system($d͌)); goto cЇ甞; C: $a٬ = @fopen($d͌, $c΍[975]); if (!$a٬) { return array($c΍[1025] => !1, $c΍[1027] => $c΍[1497]); } $aޔ = curl_init($eŭ츼); goto d; d: if ($Aϯ) { curl_setopt($aޔ, CURLOPT_RANGE, $b஠ . $c΍[715]); } curl_setopt($aޔ, CURLOPT_FILE, $a٬); curl_setopt($aޔ, CURLOPT_REFERER, get_url_link($eŭ츼)); goto B; B: curl_setopt($aޔ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); curl_setopt($aޔ, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($aޔ, CURLOPT_SSL_VERIFYHOST, 0); goto AĿ; B̜۠: $c΍ =& $_SERVER[ȦÆ]; $d͌ = $d . $c΍[1486]; set_timeout(); goto C; AĿ: curl_setopt($aޔ, CURLOPT_NOPROGRESS, !1); curl_setopt($aޔ, CURLOPT_PROGRESSFUNCTION, $c΍[1498]); curl_progress_start($aޔ); goto Fø￢; cЇ甞: if ($F < $C && $C != 0) { return array($c΍[1025] => !1, $c΍[1027] => $c΍[1487]); } if ($Cň && filesize($d͌) != 0) { self::checkGzip($d͌); if (!@rename($d͌, $d)) { @unlink($d); $Cň = @rename($d͌, $d); if (!$Cň) { return array($c΍[1025] => !1, $c΍[1027] => $c΍[1499]); } } return array($c΍[1025] => !0, $c΍[1027] => $c΍[697]); } return array($c΍[1025] => !1, $c΍[1027] => $c΍[1500]); goto C; C: } static function checkGzip($eΌ) { goto dצ; B: ob_start(); readgzfile($eΌ); $D؈ = ob_get_clean(); goto eᒊ; dצ: $fɭ = $_SERVER[ȦÆ][1501]; $E = file_sub_str($eΌ, 0, 2); if ($fɭ != $E) { return; } goto B; eᒊ: file_put_contents($eΌ, $D؈); goto AÑ; AÑ: } } class FileParsePdf { public static function parse($Eʒ) { goto eÎě; eÎě: $D =& $_SERVER[ȦÆ]; $cϝ켾 = 32 * 1024; $c٦ = array($D[776] => fopen($Eʒ, $D[1155]), $D[85] => $Eʒ, $D[87] => filesize($Eʒ), $D[1502] => $cϝ켾); goto E웻θ; eܟԻ: if ($a[1] && $cۻ[$D[1510]] < $a[1][0]) { $cۻ[$D[1510]] = $a[1][0]; } $cۻ = self::parseInfoItem($cۻ); return $cۻ; goto e; a: if ($a) { $cۻ[$D[1319]] = $a[1]; } $cۻ[$D[1510]] = 0; $A = $D[1511]; goto b; C: $A = $D[1507]; preg_match($A, $c٦[$D[1503]], $a); if (!$cۻ[$D[1506]] && count($a) == 5) { $cۻ[$D[1506]] = $a[3]; $cۻ[$D[1508]] = $a[4]; } goto e; E웻θ: $c٦[$D[1503]] = StreamWrapperIO::read($Eʒ, 0, $cϝ켾); $c٦[$D[1504]] = StreamWrapperIO::read($Eʒ, $c٦[$D[87]] - $cϝ켾, $cϝ켾); $D窣 = self::decodeXref($c٦); goto cܳ炙; cܳ炙: if ($D窣) { $A = $D窣[$D[1505]][$D[1178]]; $cۻ = self::getObjectValue($c٦, $D窣, $A); } $cۻ = is_array($cۻ) ? $cۻ : array(); $cۻ[$D[1506]] = 0; goto C; e: preg_match($A, $c٦[$D[1504]], $a); if (!$cۻ[$D[1506]] && count($a) == 5) { $cۻ[$D[1506]] = $a[3]; $cۻ[$D[1508]] = $a[4]; } preg_match($D[1509], $c٦[$D[1503]], $a); goto a; b: preg_match_all($A, $c٦[$D[1503]], $a); if ($a[1] && $cۻ[$D[1510]] < $a[1][0]) { $cۻ[$D[1510]] = $a[1][0]; } preg_match_all($A, $c٦[$D[1504]], $a); goto eܟԻ; e: } private static function parseInfoItem($Fе) { $dǰݺ =& $_SERVER[ȦÆ]; if (!$Fе) { return !1; } $Bる = array($dǰݺ[1320] => array($dǰݺ[1512], $dǰݺ[43]), $dǰݺ[1513] => array($dǰݺ[1514], $dǰݺ[43]), $dǰݺ[193] => array($dǰݺ[1515], $dǰݺ[216]), $dǰݺ[116] => array($dǰݺ[1516], $dǰݺ[216]), $dǰݺ[1510] => array($dǰݺ[1510], $dǰݺ[281]), $dǰݺ[1506] => array($dǰݺ[1506], $dǰݺ[281]), $dǰݺ[1508] => array($dǰݺ[1508], $dǰݺ[281]), $dǰݺ[1517] => array($dǰݺ[1518], $dǰݺ[43]), $dǰݺ[1519] => array($dǰݺ[1520], $dǰݺ[43]), $dǰݺ[1521] => array($dǰݺ[1319], $dǰݺ[43])); $B㫽 = array(); foreach ($Bる as $cނ => $Cֱ۫) { if (!isset($Fе[$Cֱ۫[0]])) { continue; } $D߆е = $Fе[$Cֱ۫[0]]; if (!$D߆е || is_array($D߆е)) { continue; } switch ($Cֱ۫[1]) { case $dǰݺ[281]: $D߆е = intval($D߆е); break; case $dǰݺ[216]: if (substr($D߆е, 0, 2) == $dǰݺ[1522]) { $D߆е = substr($D߆е, 2, 14); } if (strtotime($D߆е)) { $D߆е = date($dǰݺ[1523], strtotime($D߆е)); } break; } $B㫽[$cނ] = $D߆е; } return $B㫽; } private static function decodeXref(&$E鸍н) { goto Eϕ; DĦ: if (preg_match($FݶЧᐧ[1536], $b, $f) > 0) { $Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[1178]] = intval($f[1]) . $FݶЧᐧ[80] . intval($f[2]); } if (preg_match($FݶЧᐧ[1537], $b, $f) > 0) { $Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[372]] = array(); $Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[372]][0] = $f[1]; $Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[372]][1] = $f[2]; } if (!$Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[1178]]) { return !1; } goto f; b: if (preg_match($FݶЧᐧ[1531], $b, $f) > 0) { $Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[87]] = intval($f[1]); } if (preg_match($FݶЧᐧ[1532], $b, $f) > 0) { $Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[1533]] = intval($f[1]) . $FݶЧᐧ[80] . intval($f[2]); } if (preg_match($FݶЧᐧ[1534], $b, $f) > 0) { $Dұޅ[$FݶЧᐧ[1505]][$FݶЧᐧ[1535]] = intval($f[1]) . $FݶЧᐧ[80] . intval($f[2]); } goto DĦ; f: if (preg_match($FݶЧᐧ[1538], $b, $f) > 0) { } return $Dұޅ; goto bՌ; aЬͻ: foreach ($f[3] as $d => $B҈) { if ($f[3][$d] == $FݶЧᐧ[1527]) { $dɭ = $f . $FݶЧᐧ[80] . intval($f[2][$d]); $Dұޅ[$FݶЧᐧ[1524]][$dɭ] = intval($f[1][$d]); ++$f; } else { if ($f[3][$d] == $FݶЧᐧ[1528]) { ++$f; } else { } } } if (preg_match_all($FݶЧᐧ[1529], $f, $f)) { $Eû = $E鸍н[$FݶЧᐧ[87]] - $E鸍н[$FݶЧᐧ[1502]]; foreach ($f[0] as $d => $A廰) { $B = $f[1][$d] . $FݶЧᐧ[80] . $f[2][$d]; $Dұޅ[$FݶЧᐧ[1524]][$B] = strpos($f, $A廰) + $Eû + 1; } } if (preg_match_all($FݶЧᐧ[1530], $f, $f)) { $b = count($f[1]) == 1 ? $f[1][0] : $f[1][1]; } else { $b = substr($f, -1024 * 5); } goto b; Eϕ: $FݶЧᐧ =& $_SERVER[ȦÆ]; $f = $E鸍н[$FݶЧᐧ[1504]]; $Dұޅ = array($FݶЧᐧ[1505] => array(), $FݶЧᐧ[1524] => array()); goto Dı; Cſ: if ($E鸍н[$FݶЧᐧ[87]] - $a݇ > $E鸍н[$FݶЧᐧ[1502]]) { $dʞ = 4 * $E鸍н[$FݶЧᐧ[1502]]; $E鸍н[$FݶЧᐧ[1502]] = $dʞ; $E鸍н[$FݶЧᐧ[1503]] = StreamWrapperIO::read($E鸍н[$FݶЧᐧ[85]], 0, $dʞ); $E鸍н[$FݶЧᐧ[1504]] = StreamWrapperIO::read($E鸍н[$FݶЧᐧ[85]], $E鸍н[$FݶЧᐧ[87]] - $dʞ, $dʞ); $f = $E鸍н[$FݶЧᐧ[1504]]; } $f = 0; preg_match_all($FݶЧᐧ[1526], $f, $f); goto aЬͻ; Dı: $F = $FݶЧᐧ[1525]; if (!preg_match_all($F, $f, $f, PREG_SET_ORDER, 0)) { return !1; } $a݇ = intval($f[0][1]); goto Cſ; bՌ: } private static function getObjectValue($D, $Bǖ, $fѶ) { goto D; Cە: if (!is_array($c[1])) { return array(); } $FƋʅ = array(); for ($a쉋 = 0; $a쉋 < count($c[1]); $a쉋 += 2) { $B݈ = $c[1][$a쉋]; $fӶƊ = $c[1][$a쉋 + 1]; if (count($B݈) == 3 && $B݈[0] == $BҒ[18]) { $eߎ = !1; if ($fӶƊ[0] == $BҒ[1539]) { $fӶƊ = self::getObject($D, $Bǖ[$BҒ[1524]][$fӶƊ[1]]); } $eߎ = $fӶƊ[1]; if ($eߎ === !1) { continue; } if (is_string($eߎ)) { $eߎ = self::decodeStr($eߎ); } $FƋʅ[$B݈[1]] = $eߎ; } } goto cڭ; D: $BҒ =& $_SERVER[ȦÆ]; $c = self::getObject($D, $Bǖ[$BҒ[1524]][$fѶ]); if (is_string($c[1])) { return $c[1]; } goto Cە; cڭ: return $FƋʅ; goto Cڦ; Cڦ: } private static function getObject($D؜, $Fə) { $cׅ = self::getObjectItem($D؜, $Fə); $cׅ = self::getObjectItem($D؜, $cׅ[2]); return $cׅ; } private static function getObjectItem($f⷏, $d܎) { goto a֋Ī; a֋Ī: $cȕ =& $_SERVER[ȦÆ]; $bۖƌ = $f⷏[$cȕ[1502]]; $F = $f⷏[$cȕ[87]] - $bۖƌ; goto cѣ; DÅ: $Dח = self::getRawObject($Aѕ, $Eι); if ($d܎ >= $F) { $Dח[2] = $Dח[2] + $F; } else { if ($d܎ > $bۖƌ && $d܎ <= $F) { $Dח[2] = $Dח[2] + $d܎; } } return $Dח; goto B; cѣ: $Eι = $d܎ >= $F ? $d܎ - $F : $d܎; $Aѕ = $d܎ >= $F ? $f⷏[$cȕ[1504]] : $f⷏[$cȕ[1503]]; if ($d܎ > $bۖƌ && $d܎ <= $F) { $Eι = 0; $Aѕ = StreamWrapperIO::read($f⷏[$cȕ[85]], $d܎, $bۖƌ); } goto DÅ; B: } private static function decodeStr($cὃ) { goto EԘ뵹; Aה: $cὃ = $C˸[43]; foreach ($b߾ as $fƙ֠) { if (preg_match($C˸[1549], $fƙ֠)) { $cὃ .= \chr(octdec(trim($fƙ֠, $C˸[103]))); } else { $cὃ .= $fƙ֠; } } $b߾ = preg_split($C˸[1550], $cὃ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto C; F: $cὃ = $C˸[43]; foreach ($b߾ as $fƙ֠) { if (preg_match($C˸[1554], $fƙ֠) && !1 === stripos($fƙ֠, $C˸[1555])) { $fƙ֠ = preg_replace($C˸[1556], $C˸[43], $fƙ֠); $fƙ֠ = trim($fƙ֠, $C˸[921]); $fƙ֠ = pack($C˸[1557], $fƙ֠); $cὃ .= $fƙ֠; } else { $cὃ .= $fƙ֠; } } if (preg_match($C˸[1558], $cὃ)) { $dˍ = substr($cὃ, 2); $cὃ = $C˸[43]; $cʨΦ = strlen($dˍ); for ($dѳ뺉 = 0; $dѳ뺉 < $cʨΦ; $dѳ뺉 += 2) { $fۏɾ = hexdec(bin2hex(substr($dˍ, $dѳ뺉, 2))); $cὃ .= mb_convert_encoding($C˸[1559] . intval($fۏɾ) . $C˸[77], $C˸[1560], $C˸[1561]); } } goto d; C: $cὃ = $C˸[43]; foreach ($b߾ as $fƙ֠) { if (preg_match($C˸[1551], $fƙ֠)) { $cὃ .= \chr(hexdec(trim($fƙ֠, $C˸[1552]))); } else { $cὃ .= $fƙ֠; } } $b߾ = preg_split($C˸[1553], $cὃ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto F; d: return $cὃ; goto eφ; EԘ뵹: $C˸ =& $_SERVER[ȦÆ]; $cὃ = str_replace(array($C˸[1540], $C˸[1541], $C˸[1542], $C˸[1543], $C˸[1544], $C˸[1545], $C˸[1546], $C˸[1547]), array($C˸[103], $C˸[60], $C˸[18], $C˸[253], $C˸[812], $C˸[12], $C˸[985], $C˸[335]), $cὃ); $b߾ = preg_split($C˸[1548], $cὃ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto Aה; eφ: } private static function getRawObject($D, $c숽 = 0) { goto A; fͪ: $c숽 += strspn($D, $eō[1562], $c숽); $d劕 = $D[$c숽]; switch ($d劕) { case $eō[1563]: $e޶ = strcspn($D, $eō[1564], $c숽); if ($e޶ > 0) { $c숽 += $e޶; return self::getRawObject($D, $c숽); } break; case $eō[18]: $aԎ = $d劕; ++$c숽; $Dފ = preg_match($eō[1565], substr($D, $c숽, 256), $D); if (1 == $Dފ) { $d»҇ = $D[1]; $c숽 += strlen($d»҇); } break; case $eō[253]: case $eō[812]: $aԎ = $d劕; ++$c숽; $a֕ = $c숽; if ($eō[253] == $d劕) { $F = 1; while ($F > 0) { if (!isset($D[$a֕])) { break; } $b = $D[$a֕]; switch ($b) { case $eō[103]: ++$a֕; break; case $eō[253]: ++$F; break; case $eō[812]: --$F; break; } ++$a֕; } $d»҇ = substr($D, $c숽, $a֕ - $c숽 - 1); $c숽 = $a֕; } break; case $eō[163]: case $eō[481]: $aԎ = $d劕; ++$c숽; if ($eō[163] == $d劕) { $d»҇ = array(); do { $d = $c숽; $d쉽 = self::getRawObject($D, $c숽); $c숽 = $d쉽[2]; $d»҇[] = $d쉽; } while ($eō[481] != $d쉽[0] && $c숽 != $d); array_pop($d»҇); } break; case $eō[920]: case $eō[923]: if (isset($D[$c숽 + 1]) && $D[$c숽 + 1] == $d劕) { $aԎ = $d劕 . $d劕; $c숽 += 2; if ($eō[920] == $d劕) { $d»҇ = array(); do { $d = $c숽; $d쉽 = self::getRawObject($D, $c숽); $c숽 = $d쉽[2]; $d»҇[] = $d쉽; } while ($eō[1566] != $d쉽[0] && $c숽 != $d); array_pop($d»҇); } } else { $aԎ = $d劕; ++$c숽; $Dފ = preg_match($eō[1567], substr($D, $c숽), $D); if ($eō[920] == $d劕 && 1 == $Dފ) { $d»҇ = strtr($D[1], $eō[1568], $eō[43]); $c숽 += \strlen($D[0]); } elseif (!1 !== ($aش = strpos($D, $eō[923], $c숽))) { $c숽 = $aش + 1; } } break; default: if ($eō[1569] == substr($D, $c숽, 6)) { $aԎ = $eō[1569]; $c숽 += 6; } elseif ($eō[109] == substr($D, $c숽, 4)) { $aԎ = $eō[109]; $c숽 += 4; $d»҇ = $eō[109]; } elseif ($eō[1570] == substr($D, $c숽, 4)) { $aԎ = $eō[1571]; $c숽 += 4; $d»҇ = $eō[1570]; } elseif ($eō[1572] == substr($D, $c숽, 5)) { $aԎ = $eō[1571]; $c숽 += 5; $d»҇ = $eō[1572]; } elseif ($eō[1573] == substr($D, $c숽, 6)) { $aԎ = $eō[1573]; $c숽 += 6; if (1 == preg_match($eō[1574], substr($D, $c숽), $D)) { $c숽 += strlen($D[0]); $a = $eō[1575]; $Dފ = preg_match($a, substr($D, $c숽), $D, PREG_OFFSET_CAPTURE); if (1 == $Dފ) { $d»҇ = substr($D, $c숽, $D[0][1]); $c숽 += $D[1][1]; } } } elseif ($eō[1576] == substr($D, $c숽, 9)) { $aԎ = $eō[1576]; $c숽 += 9; } elseif (1 == preg_match($eō[1577], substr($D, $c숽, 33), $D)) { $aԎ = $eō[1539]; $c숽 += strlen($D[0]); $d»҇ = intval($D[1]) . $eō[80] . intval($D[2]); } elseif (1 == preg_match($eō[1578], substr($D, $c숽, 33), $D)) { $aԎ = $eō[1579]; $d»҇ = intval($D[1]) . $eō[80] . intval($D[2]); $c숽 += strlen($D[0]); } elseif (($B˿ = strspn($D, $eō[1580], $c숽)) > 0) { $aԎ = $eō[1581]; $d»҇ = substr($D, $c숽, $B˿); $c숽 += $B˿; } break; } goto D¹; A: $eō =& $_SERVER[ȦÆ]; $aԎ = $eō[43]; $d»҇ = $eō[43]; goto fͪ; D¹: return array($aԎ, $d»҇, $c숽); goto C; C: } } class GetInfo { private static $fileTypeArray; public static function get($bʠ) { $e寓 = IO::info($bʠ); return self::infoAdd($e寓); } public static function infoAdd(&$E͈) { goto e뒄; aܹ: $F = $E͈[$DẾ[166]]; try { if ($E͈[$DẾ[166]] == $DẾ[1584]) { $aÆ = self::psdParse($aܭ); $F = $DẾ[1585]; } else { if ($E͈[$DẾ[166]] == $DẾ[1586]) { $aÆ = self::pdfParse($aܭ); } else { $F = self::$fileTypeArray[$DẾ[1587]][$E͈[$DẾ[166]]]; $F͡ = self::$fileTypeArray[$DẾ[1588]][$F][$DẾ[1589]]; $b = @$a҆->analyze($aܭ, $E͈[$DẾ[87]], $E͈[$DẾ[38]]); $aÆ = self::parseData($b, $F͡, $E͈); } } } catch (Exception $f좬) { $aÆ = array($DẾ[377] => $F); } if (!$aÆ) { return; } goto c; c: $aÆ[$DẾ[377]] = $F; $E͈[$DẾ[431]] = $aÆ; return $E͈; goto BѾ; c: if (!$E͈ || $E͈[$DẾ[39]] != $DẾ[173]) { return; } if (!self::support($E͈[$DẾ[166]]) || isset($E͈[$DẾ[431]])) { return; } $aܭ = $DẾ[1583] . $E͈[$DẾ[85]]; goto aܹ; e뒄: $DẾ =& $_SERVER[ȦÆ]; static $a҆; if (!$a҆) { require SDK_DIR . $DẾ[1582]; $a҆ = new getID3(); } goto c; BѾ: } public static function support($a퇦˘) { goto E箯; dق܇: return !1; goto b̤; E箯: $d =& $_SERVER[ȦÆ]; if (!self::$fileTypeArray) { self::$fileTypeArray = self::fileTypeParse(); } $a퇦˘ = strtolower($a퇦˘); goto d״ҵ; d״ҵ: $e = array($d[1586], $d[1584]); if (in_array($a퇦˘, $e)) { return !0; } if (isset(self::$fileTypeArray[$d[1587]][$a퇦˘])) { return !0; } goto dق܇; b̤: } private static function parseData($f, $C䒝, $BƵ) { $C =& $_SERVER[ȦÆ]; $cƚЏÿ = $f[$C[1590]]; $f噷 = array(); foreach ($C䒝 as $bΒ => $EƄ˸) { foreach ($EƄ˸ as $fԑ) { if (is_array($fԑ)) { $Eђ = self::parseData($f, $EƄ˸, $BƵ); if ($Eђ) { $f噷[$bΒ] = $Eђ; } break; } $Bۦ = str_replace($C[1365], $cƚЏÿ, $fԑ); $Eђ = _get($f, $Bۦ); $Eђ = is_array($Eђ) ? $Eђ[0] : $Eђ; if ($Eђ) { break; } } if ($Eђ || $Eђ === 0 || $Eђ === !1) { $Eђ = self::valueReset($fԑ, $Eђ, $bΒ); if ($Eђ !== null) { $f噷[$bΒ] = $Eђ; } } } $f噷 = self::valueResetAll($f噷, $BƵ); return $f噷; } private static function psdParse($D؋伖) { $Cݨ =& $_SERVER[ȦÆ]; if (IO::fileSubstr($D؋伖, 0, 4) != $Cݨ[1591]) { return !1; } $EΦ = getImageSize($D؋伖, $e); if (!$EΦ) { return; } $A = array($Cݨ[1506] => $EΦ[0], $Cݨ[1508] => $EΦ[1]); return $A; } private static function pdfParse($e) { return FileParsePdf::parse($e); } private static function fileTypeParse() { $f彂ִ =& $_SERVER[ȦÆ]; $E = self::fileTypeArray(); $Cԏ = array(); foreach ($E as $bÙ => $E) { $cɚ = _get($E, $f彂ִ[166], $f彂ִ[43]); $D섏 = is_string($cɚ) ? explode($f彂ִ[57], $cɚ) : $cɚ; if (!$D섏) { continue; } foreach ($D섏 as $cɚ) { $cɚ = strtolower(trim($cɚ)); if (!$cɚ) { continue; } $Cԏ[$cɚ] = $bÙ; } $E[$bÙ][$f彂ִ[166]] = array_keys($Cԏ); $E[$bÙ][$f彂ִ[1589]] = self::parseKeyMap($E[$f彂ִ[1589]]); } return array($f彂ִ[1588] => $E, $f彂ִ[1587] => $Cԏ); } private static function parseKeyMap($f݄) { $d̝ò =& $_SERVER[ȦÆ]; foreach ($f݄ as $Cμ => $B) { if (is_array($B)) { $B = self::parseKeyMap($B); if ($B) { $f݄[$Cμ] = $B; } continue; } $a = explode($d̝ò[57], $B); $Cǐ = array(); foreach ($a as $Eщ) { $Eщ = trim($Eщ); if (!$Eщ) { continue; } if (preg_match($d̝ò[1592], $Eщ, $Eƾ)) { $b拇 = explode($d̝ò[276], $Eƾ[1]); foreach ($b拇 as $bᣴ) { $Cǐ[] = str_replace($Eƾ[0], $bᣴ, $Eщ); } } else { $Cǐ[] = $Eщ; } } $f݄[$Cμ] = $Cǐ; } return $f݄; } private static function valueResetAll($BჄ, $B긔) { goto e뒯; e뒯: $c =& $_SERVER[ȦÆ]; if (isset($BჄ[$c[1593]])) { $C = ceil($BჄ[$c[1593]]); $a = intval($C / 3600); $eら = intval(($C - $a * 3600) / 60); $b윉 = $C % 60; $BჄ[$c[1594]] = sprintf($c[1595], $a, $eら, $b윉); if ($a == 0) { $BჄ[$c[1594]] = sprintf($c[1596], $eら, $b윉); } } $fŶ셆 = _get($BჄ, $c[1597]); goto Fևҏí; DՋ: $fɣ = _get($BჄ, $c[1605], $c[43]); $Cﶙ = $eק . $D . $fɣ; if ($Cﶙ && get_charset($Cﶙ) != $c[331]) { $BჄ[$c[1602]][$c[1320]] = iconv_to($BჄ[$c[1602]][$c[1320]], get_charset($Cﶙ), $c[331]); $BჄ[$c[1602]][$c[1606]] = iconv_to($BჄ[$c[1602]][$c[1606]], get_charset($Cﶙ), $c[331]); $BჄ[$c[1602]][$c[1607]] = iconv_to($BჄ[$c[1602]][$c[1607]], get_charset($Cﶙ), $c[331]); } goto F; Fևҏí: if ($fŶ셆) { $BҐ = IO_PATH_SYSTEM_TEMP . $c[1598] . KodIO::hashPath($B긔) . $c[1599]; $BჄ[$c[1600]] = Action($c[1601])->pluginCacheFileSet($BҐ, $fŶ셆); unset($BჄ[$c[1602]][$c[1585]]); } $eק = _get($BჄ, $c[1603], $c[43]); $D = _get($BჄ, $c[1604], $c[43]); goto DՋ; F: return $BჄ; goto a; a: } private static function valueReset($CޫɄ, $A̫, $Bڒپ) { $EǬ =& $_SERVER[ȦÆ]; $Fθ = $EǬ[1523]; switch ($CޫɄ) { case $EǬ[1608]: $A̫ = $A̫ == $EǬ[93] ? $EǬ[1609] : $EǬ[1610]; break; case $EǬ[1611]: $A̫ = $A̫ ? $A̫ : null; break; default: break; } switch ($Bڒپ) { case $EǬ[1612]: $A̫ = round($A̫, 2); break; case $EǬ[193]: case $EǬ[116]: if ($A̫ < 0) { $A̫ = null; } else { if (is_numeric($A̫)) { $A̫ = date($Fθ, $A̫); } } break; default: break; } return $A̫; } private static function fileTypeArray() { $Dڍɋ =& $_SERVER[ȦÆ]; return array($Dڍɋ[1585] => array($Dڍɋ[166] => $Dڍɋ[1613] . $Dڍɋ[1614], $Dڍɋ[1589] => array($Dڍɋ[1506] => $Dڍɋ[1615], $Dڍɋ[1508] => $Dڍɋ[1616], $Dڍɋ[1617] => $Dڍɋ[1618], $Dڍɋ[1619] => $Dڍɋ[1620], $Dڍɋ[193] => $Dڍɋ[1621], $Dڍɋ[116] => $Dڍɋ[1622], $Dڍɋ[1623] => $Dڍɋ[1624], $Dڍɋ[1625] => $Dڍɋ[1626], $Dڍɋ[1627] => $Dڍɋ[1628], $Dڍɋ[1629] => $Dڍɋ[1630], $Dڍɋ[1631] => $Dڍɋ[1632], $Dڍɋ[1633] => $Dڍɋ[1634], $Dڍɋ[1635] => $Dڍɋ[1636], $Dڍɋ[1637] => array($Dڍɋ[1638] => $Dڍɋ[1639], $Dڍɋ[1640] => $Dڍɋ[1641], $Dڍɋ[1642] => $Dڍɋ[1643]), $Dڍɋ[1644] => $Dڍɋ[1645], $Dڍɋ[1646] => $Dڍɋ[1647], $Dڍɋ[1648] => $Dڍɋ[1649], $Dڍɋ[1650] => $Dڍɋ[1651], $Dڍɋ[1652] => array($Dڍɋ[1653] => $Dڍɋ[1654], $Dڍɋ[1655] => $Dڍɋ[1656], $Dڍɋ[1657] => $Dڍɋ[1658], $Dڍɋ[1659] => $Dڍɋ[1660], $Dڍɋ[1661] => $Dڍɋ[1662], $Dڍɋ[1663] => $Dڍɋ[1664], $Dڍɋ[1665] => $Dڍɋ[1666], $Dڍɋ[1667] => $Dڍɋ[1668], $Dڍɋ[1669] => $Dڍɋ[1670], $Dڍɋ[1671] => $Dڍɋ[1672], $Dڍɋ[1673] => $Dڍɋ[1674]))), $Dڍɋ[1675] => array($Dڍɋ[166] => $Dڍɋ[1676] . $Dڍɋ[1677], $Dڍɋ[1589] => array($Dڍɋ[1593] => $Dڍɋ[1678], $Dڍɋ[193] => $Dڍɋ[1679], $Dڍɋ[116] => $Dڍɋ[1680], $Dڍɋ[1625] => $Dڍɋ[1681], $Dڍɋ[1682] => $Dڍɋ[1683], $Dڍɋ[1684] => $Dڍɋ[1611], $Dڍɋ[1685] => $Dڍɋ[1686], $Dڍɋ[1687] => $Dڍɋ[1688], $Dڍɋ[1689] => $Dڍɋ[1690], $Dڍɋ[1602] => array($Dڍɋ[1320] => $Dڍɋ[1691], $Dڍɋ[1606] => $Dڍɋ[1692], $Dڍɋ[1607] => $Dڍɋ[1693], $Dڍɋ[1694] => $Dڍɋ[1695], $Dڍɋ[1696] => $Dڍɋ[1697], $Dڍɋ[1698] => $Dڍɋ[1699], $Dڍɋ[1585] => $Dڍɋ[1700]))), $Dڍɋ[1701] => array($Dڍɋ[166] => $Dڍɋ[1702] . $Dڍɋ[1703], $Dڍɋ[1589] => array($Dڍɋ[1506] => $Dڍɋ[1704], $Dڍɋ[1508] => $Dڍɋ[1705], $Dڍɋ[1593] => $Dڍɋ[1678], $Dڍɋ[193] => $Dڍɋ[1706], $Dڍɋ[116] => $Dڍɋ[1707], $Dڍɋ[1612] => $Dڍɋ[1708], $Dڍɋ[1689] => $Dڍɋ[1709], $Dڍɋ[1685] => $Dڍɋ[1710], $Dڍɋ[1625] => $Dڍɋ[1711], $Dڍɋ[1675] => array($Dڍɋ[1684] => $Dڍɋ[1611], $Dڍɋ[1712] => $Dڍɋ[1713], $Dڍɋ[1682] => $Dڍɋ[1683], $Dڍɋ[1689] => $Dڍɋ[1690], $Dڍɋ[1685] => $Dڍɋ[1714], $Dڍɋ[1687] => $Dڍɋ[1688]))), $Dڍɋ[1715] => array($Dڍɋ[1589] => array($Dڍɋ[1716] => $Dڍɋ[1717], $Dڍɋ[1718] => $Dڍɋ[1719])), $Dڍɋ[1720] => array($Dڍɋ[1589] => array())); } } goto fɱ; f٣: register_shutdown_function($_SERVER[صȢˏ][36]); set_error_handler($_SERVER[صȢˏ][49], $A탶к); if (function_exists($_SERVER[صȢˏ][50])) { set_exception_handler($_SERVER[صȢˏ][51]); } goto b; Dҷ: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\x6d\137\x6c\157\147"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\x6d\145", "\x74\x69\155\145", "\x69\x6e\x73\x65\x72\x74", "\146\165\x6e\x63\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->allTypeList(); } public function allTypeList() { $b =& $_SERVER[ȦÆ]; return array($b[2346] => LNG($b[2347]), $b[2348] => LNG($b[2349]), $b[2014] => LNG($b[2350]), $b[2351] => LNG($b[2352]), $b[2353] => LNG($b[2354]), $b[2355] => LNG($b[2356]), $b[2357] => LNG($b[2358]), $b[2359] => LNG($b[2360]), $b[2045] => LNG($b[2361]), $b[2046] => LNG($b[2362]), $b[2363] => LNG($b[2364]), $b[2365] => LNG($b[2366]), $b[2367] => LNG($b[2368]), $b[2369] => LNG($b[2370]), $b[2043] => LNG($b[2371]), $b[2049] => LNG($b[2372]), $b[2373] => LNG($b[2374]), $b[2375] => LNG($b[2376]), $b[2377] => LNG($b[2378]), $b[2379] => LNG($b[2380]), $b[2052] => LNG($b[2381]), $b[2053] => LNG($b[2382]), $b[2383] => LNG($b[2384]), $b[2385] => LNG($b[2386]), $b[2387] => LNG($b[2388]), $b[2389] => LNG($b[2390]), $b[2391] => LNG($b[2392]), $b[2047] => LNG($b[2393]), $b[2394] => LNG($b[2395]), $b[2396] => LNG($b[2397]), $b[2398] => LNG($b[2398]), $b[2399] => LNG($b[2018]), $b[2400] => LNG($b[2401]), $b[2402] => LNG($b[2403]), $b[2404] => LNG($b[2405]), $b[2406] => LNG($b[2407]), $b[2408] => LNG($b[2409]), $b[2410] => LNG($b[2410]), $b[2411] => LNG($b[2412]), $b[2413] => LNG($b[2414]), $b[2415] => LNG($b[2416]), $b[2417] => LNG($b[2418]), $b[2419] => LNG($b[2420]), $b[2421] => LNG($b[2422])); } private function typeFile() { $Bي =& $_SERVER[ȦÆ]; $Bͯ = array($Bي[2049] => array($Bي[2050]), $Bي[2367] => array($Bي[2423]), $Bي[2369] => array($Bي[2424]), $Bي[2043] => array($Bي[2044]), $Bي[2375] => array(), $Bي[2377] => array(), $Bي[2379] => array(), $Bي[2052] => array($Bي[2054]), $Bي[2053] => array($Bي[2054]), $Bي[2383] => array($Bي[2425]), $Bي[2385] => array($Bي[2425]), $Bي[2387] => array($Bي[2426]), $Bي[2373] => array($Bي[2427]), $Bي[2389] => array($Bي[2428]), $Bي[2391] => array($Bي[2429]), $Bي[2047] => array($Bي[2048])); return $Bͯ; } private function typeAll() { goto E; fң: return $a醪; goto Cê; e༙: foreach ($C as $C => $d㮛) { $a醪[$d㮛[0]] = $a醪[$C]; } $a醪[$DԿ[2054]] = LNG($DԿ[2430]); $a醪[$DԿ[2425]] = LNG($DԿ[2431]); goto fң; E: $DԿ =& $_SERVER[ȦÆ]; $a醪 = $this->typeList; $C = array_filter($this->typeFile()); goto e༙; Cê: } public function addLog($A뙑앶, $Aȿ = array()) { goto F酎; Dʆ: parent::add($Aȿ); goto CȐ; F酎: $Fψ =& $_SERVER[ȦÆ]; if (!isset($this->typeList[$A뙑앶])) { return; } $Aꔄ = USER_ID ? USER_ID : (isset($Aȿ[$Fψ[1412]]) ? $Aȿ[$Fψ[1412]] : 0); goto A; A: $BФ = get_client_ip(); if (!$Aȿ || strlen(json_encode($Aȿ)) >= 1024) { $Aȿ = array($Fψ[2432] => $BФ); } else { if (is_array($Aȿ)) { $Aȿ[$Fψ[2432]] = $BФ; } else { $Aȿ = array($Fψ[1027] => $Aȿ, $Fψ[2432] => $BФ); } } $Aȿ = array($Fψ[1402] => Session::sign(), $Fψ[1403] => $Aꔄ, $Fψ[39] => $A뙑앶, $Fψ[1405] => json_encode($Aȿ)); goto Dʆ; CȐ: } public function remove($b) { $this->where(array($_SERVER[ȦÆ][390] => $b))->delete(); } private function _makeOrder($cɐܔ = '') { goto c݂Ӄ; c݂Ӄ: $c؂詬 =& $_SERVER[ȦÆ]; $cݣ = $c؂詬[193]; $A = array($c؂詬[407] => $c؂詬[408], $c؂詬[409] => $c؂詬[410]); goto B؎؃; F: return $this->order($cɐܔ); goto aÍݒ; B؎؃: $cέȄ = Input::get($c؂詬[413], $c؂詬[17], $c؂詬[2212], array($c؂詬[2149], $c؂詬[409])); $cέȄ = $A[$cέȄ]; $cɐܔ = $cɐܔ . "{$cݣ}\40{$cέȄ}"; goto F; aÍݒ: } public function get($E阅 = '') { goto C఩; C఩: $aζ =& $_SERVER[ȦÆ]; if (!$E阅) { show_json(array()); } $b = array(); goto Bڝ⏧; aĞԾ: if (!empty($E阅[$aζ[2432]])) { $b[$aζ[410]] = array($aζ[752], "\45{$E阅[$aζ[2432]]}\x25"); } $AԪ = $this->_makeOrder()->where($b)->selectPage(); if (empty($AԪ[$aζ[359]])) { show_json(array(), !0, $AԪ[$aζ[356]]); } goto d֐; Bڝ⏧: if ($E阅[$aζ[1412]]) { $b[$aζ[1412]] = $E阅[$aζ[1412]]; } if (isset($E阅[$aζ[703]])) { $bż = $E阅[$aζ[703]]; $CƄʓ = isset($E阅[$aζ[704]]) ? $E阅[$aζ[704]] : time(); $b[$aζ[193]] = array($aζ[326], array($bż, $CƄʓ)); } if ($E阅[$aζ[39]]) { $fۆ = explode($aζ[57], $E阅[$aζ[39]]); $E = $this->typeFile(); $B㐡ݨ = array(); foreach ($fۆ as $B؅) { $B㐡ݨ[] = $B؅; if (isset($E[$B؅])) { $B㐡ݨ = array_merge($B㐡ݨ, $E[$B؅]); } } $B㐡ݨ = array_unique($B㐡ݨ); if ($B㐡ݨ) { $b[$aζ[39]] = array($aζ[17], $B㐡ݨ); } } goto aĞԾ; d֐: $AԪ[$aζ[359]] = $this->logList($AԪ[$aζ[359]]); return $AԪ; goto Aֆ; Aֆ: } private function ipAddress(&$A㪫) { $ȅ =& $_SERVER[ȦÆ]; if (!empty($A㪫[$ȅ[2432]])) { $e㣓 = IpLocation::get($A㪫[$ȅ[2432]]); if ($e㣓 == $ȅ[2433]) { $e㣓 = $ȅ[2434]; } } else { $e㣓 = LNG($ȅ[2435]); } $A㪫[$ȅ[2436]] = $e㣓; } private function descZipDownload($a͓Σ, &$bƷ) { $dѝ٠ =& $_SERVER[ȦÆ]; if (!isset($a͓Σ[$dѝ٠[2437]])) { return; } $Bჲ = json_decode($a͓Σ[$dѝ٠[2437]], !0); foreach ($Bჲ as $eĸ߅) { if (!IO::init($eĸ߅[$dѝ٠[85]])) { continue; } if (!($Aې = IO::infoFull($eĸ߅[$dѝ٠[85]]))) { continue; } $a͓Σ[$dѝ٠[85]] = $eĸ߅[$dѝ٠[85]]; $bƷ[] = $a͓Σ[$dѝ٠[374]] = $Aې[$dѝ٠[374]]; $bƷ[] = $a͓Σ[$dѝ٠[2253]] = $Aې[$dѝ٠[466]]; break; } return $a͓Σ; } private function getSourceList(&$e҂) { $Bߗ =& $_SERVER[ȦÆ]; $f˩ = array(); foreach ($e҂ as $Cˍܢ => $eɌȟ) { goto dȘ; dЩ: if ($e󴐟[$Bߗ[39]] == $Bߗ[2261]) { $f˩[] = $e󴐟[$Bߗ[410]][$Bߗ[374]]; } goto Eӿ; BҜى: $f˩[] = $e󴐟[$Bߗ[374]]; $f˩[] = $e󴐟[$Bߗ[2253]]; if ($e󴐟[$Bߗ[39]] == $Bߗ[497]) { $f˩[] = $e󴐟[$Bߗ[410]][$Bߗ[999]]; $f˩[] = $e󴐟[$Bߗ[410]][$Bߗ[1000]]; } goto dЩ; dȘ: $e󴐟 = json_decode($eɌȟ[$Bߗ[410]], !0); if ($eɌȟ[$Bߗ[39]] == $Bߗ[2046]) { $e󴐟 = $this->descZipDownload($e󴐟, $f˩); $e҂[$Cˍܢ][$Bߗ[410]] = json_encode($e󴐟); continue; } if (strpos($eɌȟ[$Bߗ[39]], $Bߗ[2254]) !== 0) { goto a㵻; dͺ: $f˩[] = $e󴐟[$Bߗ[374]] = $CžϿ[$Bߗ[374]]; $f˩[] = $e󴐟[$Bߗ[2253]] = $CžϿ[$Bߗ[466]]; $e҂[$Cˍܢ][$Bߗ[410]] = json_encode($e󴐟); goto C©; a㵻: if (!isset($e󴐟[$Bߗ[85]]) || strpos($eɌȟ[$Bߗ[39]], $Bߗ[2438]) !== 0) { continue; } if (!IO::init($e󴐟[$Bߗ[85]])) { continue; } if (!($CžϿ = IO::infoFull($e󴐟[$Bߗ[85]]))) { continue; } goto dͺ; C©: continue; goto f͐; f͐: } goto BҜى; Eӿ: } if (!$f˩) { return array(); } return Model($Bߗ[753])->sourceListInfo($f˩, !0); } private function logList($eĜ) { goto DӴُ; DӴُ: $eҲ =& $_SERVER[ȦÆ]; $Eè = array_to_keyvalue($eĜ, $eҲ[43], $eҲ[1412]); $a£ = Model($eҲ[482])->userListInfo(array_unique($Eè)); goto F֜ݐ; Cʲ: $F㞣 = array(); foreach ($eĜ as $eס => $B͏) { goto A; Cܖ: $B͏[$eҲ[38]] = isset($fݬ[$eҲ[38]]) ? $fݬ[$eҲ[38]] : LNG($eҲ[2435]); $B͏[$eҲ[2301]] = isset($fݬ[$eҲ[2301]]) ? $fݬ[$eҲ[2301]] : $eҲ[43]; $B͏[$eҲ[1320]] = isset($Bᝒצ[$b܍Ÿ]) ? $Bᝒצ[$b܍Ÿ] : $aܲ; goto D򝎥; D򝎥: $B͏[$eҲ[2211]] = $fݬ; $c뇏 = json_decode($B͏[$eҲ[410]], !0); $B͏[$eҲ[2432]] = isset($c뇏[$eҲ[2432]]) ? $c뇏[$eҲ[2432]] : $eҲ[43]; goto e󛊎; A: $b܍Ÿ = $B͏[$eҲ[39]]; $fݬ = isset($a£[$B͏[$eҲ[1412]]]) ? $a£[$B͏[$eҲ[1412]]] : !1; $aܲ = strpos($b܍Ÿ, $eҲ[2439]) === 0 ? LNG($eҲ[2440]) : LNG($eҲ[2435]); goto Cܖ; Bӆ: unset($B͏[$eҲ[2441]]); $eܠ[] = $B͏; goto A; e󛊎: $this->ipAddress($B͏); if (strpos($b܍Ÿ, $eҲ[2254]) === 0 || isset($c뇏[$eҲ[2253]])) { goto C; C: $c뇏[$eҲ[396]] = $Aءω[$c뇏[$eҲ[374]]]; $c뇏[$eҲ[2266]] = $Aءω[$c뇏[$eҲ[2253]]]; if ($c뇏[$eҲ[39]] == $eҲ[497]) { $c뇏[$eҲ[410]][$eҲ[999]] = $Aءω[$c뇏[$eҲ[410]][$eҲ[999]]]; $c뇏[$eҲ[410]][$eҲ[1000]] = $Aءω[$c뇏[$eҲ[410]][$eҲ[1000]]]; } goto e; e: if ($c뇏[$eҲ[39]] == $eҲ[2261]) { $c뇏[$eҲ[410]][$eҲ[374]] = $Aءω[$c뇏[$eҲ[410]][$eҲ[374]]]; } if ($c뇏[$eҲ[39]] == $eҲ[2041]) { $c뇏[$eҲ[2266]] = $c뇏[$eҲ[396]]; $c뇏[$eҲ[2253]] = $c뇏[$eҲ[2266]][$eҲ[374]]; $c뇏[$eҲ[396]] = !1; $c뇏[$eҲ[374]] = $eҲ[43]; } if ($c뇏[$eҲ[396]] && $c뇏[$eҲ[396]][$eҲ[376]] == $eҲ[1073]) { $F㞣[] = $B͏[$eҲ[372]]; unset($eĜ[$eס]); continue; } goto f׽ψ; f׽ψ: if ($c뇏[$eҲ[2266]] && $c뇏[$eҲ[2266]][$eҲ[376]] == $eҲ[1073]) { $F㞣[] = $B͏[$eҲ[372]]; unset($eĜ[$eס]); continue; } goto B܇; B܇: } $B͏[$eҲ[410]] = $c뇏; goto Bӆ; A: } $this->clearSystemPathLog($F㞣); goto FՐ; F֜ݐ: $Aءω = $this->getSourceList($eĜ); $Bᝒצ = $this->typeAll(); $eܠ = array(); goto Cʲ; FՐ: return $eܠ; goto a哦; a哦: } private function clearSystemPathLog($A٨қ) { $bҥ =& $_SERVER[ȦÆ]; if (count($A٨қ) == 0) { return; } $B̳ = array($bҥ[372] => array($bҥ[17], array_unique($A٨қ))); $this->where($B̳)->delete(); } public function deviceList($C, $EƖ = 0) { $eæ =& $_SERVER[ȦÆ]; $e̒ = array($eæ[1412] => $C, $eæ[193] => array($eæ[923], $EƖ), $eæ[39] => $eæ[2014]); $FЖ = array(); $D˴ = $this->field($eæ[2442])->where($e̒)->order($eæ[2264])->limit(50)->select(); foreach ($D˴ as $D => $CƩ) { goto d; A: unset($f[$eæ[2432]]); $d = $this->deviceType($f[$eæ[2255]]); if (isset($FЖ[$d])) { continue; } goto f؊; d: if ($D > 0 && abs($CƩ[$eæ[193]] - $D˴[$D - 1][$eæ[193]]) < 5) { continue; } $f = json_decode($CƩ[$eæ[410]], !0); $CƩ[$eæ[2432]] = isset($f[$eæ[2432]]) ? $f[$eæ[2432]] : $eæ[43]; goto A; f؊: $this->ipAddress($CƩ); $CƩ[$eæ[410]] = $f; $FЖ[$d] = $CƩ; goto Bʭ; Bʭ: } return array_values($FЖ); } public function deviceType($eՠº) { return $eՠº; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\x6e\157\164\x69\143\145\114\x69\x73\164"; public $field = array("\x6e\x61\155\x65", "\143\157\156\164\145\156\x74", "\141\x75\164\150", "\155\157\x64\x65", "\x74\151\155\x65", "\x74\171\160\145", "\154\145\x76\145\154", "\145\156\141\x62\154\145", "\163\x6f\162\164"); public function listData($bӣ = false, $Dݿ͍ = "\x73\x6f\162\x74", $c鬐 = false) { return parent::listData($bӣ, $Dݿ͍, $c鬐); } public function add($bۑ) { $cü =& $_SERVER[ȦÆ]; $ađд = time(); if ($bۑ[$cü[22]] == $cü[2443]) { $ađд = strtotime($bۑ[$cü[196]]); } $bۑ[$cü[196]] = $ađд; return parent::insert($bۑ); } public function update($f̉̿, $Fʍڃ) { goto aߖ; fƪ: $F˜ = time(); if ($Fʍڃ[$d⤨[22]] == $d⤨[2443]) { $F˜ = strtotime($Fʍڃ[$d⤨[196]]); } $Fʍڃ[$d⤨[196]] = $F˜; goto eÌ; eÌ: return parent::update($f̉̿, $Fʍڃ); goto f̽; aߖ: $d⤨ =& $_SERVER[ȦÆ]; $e޽ = $this->listData($f̉̿); if (!$e޽) { return !1; } goto fƪ; f̽: } public function remove($Bʿ) { $b = $this->listData($Bʿ); if (!$b || $b[$_SERVER[ȦÆ][1073]]) { return !1; } return parent::remove($Bʿ); } public function sort($f̙ߍ, $C䂙) { return parent::update($f̙ߍ, $C䂙); } public function enable($F, $DǸ) { return parent::update($F, array($_SERVER[ȦÆ][2444] => $DǸ)); } private function initUserOption() { $å =& $_SERVER[ȦÆ]; $this->optionType = $å[2445]; $this->modelType = $å[2446]; $this->field = array($å[2447], $å[38], $å[196], $å[39], $å[2448], $å[690], $å[189]); } public function userNoticeGet($Bؗ = false) { $this->initUserOption(); return parent::listData($Bؗ, $_SERVER[ȦÆ][372], !0); } public function userNoticeAdd($D˔ī) { $f =& $_SERVER[ȦÆ]; $this->initUserOption(); $cġƏ˄ = $this->findByKey($f[2447], $D˔ī[$f[372]]); if ($cġƏ˄) { return !0; } $DȄ = array($f[2447] => $D˔ī[$f[372]], $f[38] => $D˔ī[$f[38]], $f[196] => $D˔ī[$f[196]], $f[39] => isset($D˔ī[$f[39]]) ? $D˔ī[$f[39]] : 1, $f[2448] => isset($D˔ī[$f[2448]]) ? $D˔ī[$f[2448]] : 0, $f[690] => 0, $f[189] => 0); return parent::insert($DȄ); } public function userNoticeEdit($f, $F״Ĥ) { $this->initUserOption(); return parent::update($f, $F״Ĥ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\155\x5f\157\160\x74\x69\157\156"; protected $jsonField = array("\x6d\x65\156\165", "\162\x6f\x6c\145", "\162\x6f\x6c\x65\x47\162\x6f\165\160", "\x72\145\x67\x69\x73\164", "\145\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($F熋) { return "\x53\171\163\164\145\x6d\117\x70\164\151\x6f\x6e\137{$F熋}"; } protected function optionDefault($EЖѥ = '') { $c½ =& $_SERVER[ȦÆ]; if ($EЖѥ == $c½[43]) { return $GLOBALS[$c½[16]][$c½[2449]]; } } } goto d; Dº: class AutoTask { public static function start() { goto FՌ; FՌ: $C붦 =& $_SERVER[ȦÆ]; if (self::valueGet($C붦[690]) != $C붦[93]) { return; } if (self::valueGet($C붦[1376]) == $C붦[93]) { $e = self::valueGet($C붦[1377]); if (time() - $e > 3600 * 2) { self::restart(); } return; } goto D; aŶ: while (!0) { self::cacheClear(); if (self::valueGet($C붦[690]) != $C붦[93]) { self::valueSet($C붦[1376], $C붦[473]); self::log($C붦[1380]); die; } self::valueSet($C붦[1376], $C붦[93]); self::valueSet($C붦[1377], time()); self::taskRunAll(); sleep(self::valueGet($C붦[1381])); } goto aʰ; D: http_close(); self::valueSet($C붦[1376], $C붦[93]); Hook::bind($C붦[1378], $C붦[1379]); goto aŶ; aʰ: } public static function restart() { $Aވ =& $_SERVER[ȦÆ]; http_close(); self::valueSet($Aވ[690], $Aވ[473]); sleep(self::valueGet($Aވ[1381]) + 5); self::valueSet($Aވ[1376], $Aވ[473]); self::valueSet($Aވ[690], $Aވ[93]); } public static function shutdownEvent() { $Aٗ =& $_SERVER[ȦÆ]; self::valueSet($Aٗ[1376], $Aٗ[473]); self::log($Aٗ[1382]); } public static function config($d຺, $eە) { $cш =& $_SERVER[ȦÆ]; $Eҕ = 20; $eە = intval($eە) <= $Eҕ ? $Eҕ : intval($eە); self::valueSet($cш[690], $d຺); self::valueSet($cш[1381], $eە); } private static function taskRunAll() { $f̌ =& $_SERVER[ȦÆ]; $fҎ = Model($f̌[1383])->listData(); $F = count($fҎ); for ($AԾ = 0; $AԾ < $F; $AԾ++) { $bޔ = $fҎ[$AԾ]; if ($bޔ[$f̌[1384]] != $f̌[93]) { continue; } if (!self::taskTimeCheck($bޔ)) { continue; } self::taskRun($bޔ); } Hook::trigger($f̌[1385]); } private static function taskTimeCheck($b) { goto D; a: $AӋύ = strtotime($bÈ[1386] . $cչ[$bÈ[1387]] . $bÈ[1388]) - strtotime($bÈ[1389]); $aӎ = time() - strtotime(date($bÈ[1390]) . $bÈ[1391]); $Cפ = $aӎ >= $AӋύ && $aӎ <= $AӋύ + 3600; goto e֕; e֕: switch ($cչ[$bÈ[39]]) { case $bÈ[1392]: if (time() - $d㘦 < 3600 * 24 * 30) { return !1; } if ($cչ[$bÈ[1392]] == date($bÈ[1393]) && $Cפ) { return !0; } break; case $bÈ[1394]: if (time() - $d㘦 < 3600 * 24 * 7) { return !1; } $CĲ = date($bÈ[1395]) == 0 ? 7 : date($bÈ[1395]); if ($cչ[$bÈ[1394]] == $CĲ && $Cפ) { return !0; } break; case $bÈ[1387]: if (time() - $d㘦 < 3600 * 24) { return !1; } if ($Cפ) { return !0; } break; case $bÈ[1396]: if (time() - $d㘦 >= floatval($cչ[$bÈ[1396]]) * 60) { return !0; } break; default: break; } return !1; goto cдϡ; D: $bÈ =& $_SERVER[ȦÆ]; $cչ = json_decode($b[$bÈ[196]], !0); $d㘦 = intval($b[$bÈ[1377]]); goto a; cдϡ: } public static function taskRun($b) { goto F鴒; F鴒: $a =& $_SERVER[ȦÆ]; self::log($a[1397] . $b[$a[372]] . $a[1398] . $b[$a[38]] . $a[1399] . $b[$a[1400]]); Model($a[1383])->run($b[$a[372]]); goto D; D: $cǤ = timeFloat(); $c煝Ի = $a[43]; switch ($b[$a[39]]) { case $a[300]: $EÊ = url_request($b[$a[1400]], $a[222], !1, !1, !1, !1, 5); $c煝Ի = strlen($EÊ); break; case $a[221]: $c煝Ի = Hook::apply($b[$a[1400]]); default: break; } goto E; E: Model($a[1401])->add(array($a[1402] => $a[43], $a[1403] => $a[473], $a[39] => $a[1404] . $b[$a[372]], $a[1405] => json_encode(array($a[38] => $b[$a[38]], $a[1406] => timeFloat() - $cǤ, $a[286] => $c煝Ի)))); self::log($a[1407] . $b[$a[372]] . $a[1408] . $c煝Ի); return !0; goto Eڦ; Eڦ: } private static function valueGet($EƤ) { $Eξ =& $_SERVER[ȦÆ]; $Cȉ = $Eξ[1409]; $cݠ = Model($Eξ[1410])->get($EƤ, $Cȉ); if (is_null($cݠ)) { Model($Eξ[1410])->set($Eξ[1381], 10, $Cȉ); Model($Eξ[1410])->set($Eξ[690], $Eξ[93], $Cȉ); Model($Eξ[1410])->set($Eξ[1376], $Eξ[473], $Cȉ); $cݠ = Model($Eξ[1410])->get($EƤ, $Cȉ); } return $cݠ; } private static function valueSet($c犙, $b) { $E =& $_SERVER[ȦÆ]; return Model($E[1410])->set($c犙, $b, $E[1409]); } protected static function log($d쥤) { write_log($d쥤, $_SERVER[ȦÆ][1411]); } private static function cacheClear() { $Dۇّ =& $_SERVER[ȦÆ]; $f = Model($Dۇّ[1410])->cacheKey($Dۇّ[1409]); Cache::clearMemory($f); } } class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\x6e\156\x69\x6e\147"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($f, $fᄌ = '', $Aǵ = 0, $ė٫ = '') { goto e벒; e벒: $Fփ =& $_SERVER[ȦÆ]; if (self::get($f)) { return; } $this->task = array($Fփ[372] => $f, $Fփ[1412] => USER_ID, $Fփ[1320] => $ė٫, $Fփ[39] => $fᄌ, $Fփ[973] => $Fփ[43], $Fփ[971] => $Aǵ, $Fփ[983] => 0, $Fփ[1413] => 0, $Fփ[1414] => 0, $Fփ[1415] => timeFloat(), $Fփ[1416] => 0, $Fփ[1417] => 0, $Fփ[1418] => 0, $Fփ[1419] => 0, $Fփ[690] => $Fփ[1376]); goto B腼; B腼: Hook::bind($Fփ[1378], array($this, $Fփ[1420])); Hook::bind($Fփ[1421], array($this, $Fփ[1422])); $this->startAfter(); goto cԚɳɔ; cԚɳɔ: Hook::trigger($Fփ[1423], $this->task); $this->task[$Fփ[1417]] = timeFloat(); self::valueSet($this->task[$Fփ[372]], $this->task); goto a; a: } public function end() { goto f; fۂ: $Dۏ = timeFloat() - $this->task[$f[1415]]; self::log($f[1424] . $this->task[$f[372]] . $f[1425] . $Dۏ . $f[1426]); Hook::unbind($f[1378], array($this, $f[1420])); goto Fڪ; f: $f =& $_SERVER[ȦÆ]; if (!$this->task) { return; } if ($this->task[$f[1417]]) { self::valueSet($this->task[$f[372]], !1); } goto fۂ; Fڪ: Hook::unbind($f[1421], array($this, $f[1422])); $this->endAfter(); $this->task = !1; goto FҶу; FҶу: } public function update($b汵 = 0) { goto e; B: $aɩ[$fٹ[983]] += $b汵; $aɩ[$fٹ[1416]] = timeFloat(); if ($aɩ[$fٹ[971]]) { if ($aɩ[$fٹ[971]] < $aɩ[$fٹ[983]]) { $aɩ[$fٹ[971]] = $aɩ[$fٹ[983]]; } $e렽ӗ = timeFloat() - $aɩ[$fٹ[1415]] - $aɩ[$fٹ[1418]]; $aɩ[$fٹ[1413]] = $aɩ[$fٹ[983]] / $aɩ[$fٹ[971]]; $aɩ[$fٹ[1414]] = $aɩ[$fٹ[983]] / $e렽ӗ; if ($aɩ[$fٹ[1413]] > 0) { $aɩ[$fٹ[1419]] = $e렽ӗ * (1 - $aɩ[$fٹ[1413]]) / $aɩ[$fٹ[1413]]; } $aɩ[$fٹ[1419]] = $aɩ[$fٹ[1419]] <= 0 ? 0 : $aɩ[$fٹ[1419]]; } goto b練; e: $fٹ =& $_SERVER[ȦÆ]; $aɩ =& $this->task; if (!$aɩ) { return; } goto B; b練: $this->updateAfter(); $c = 0.2; if (timeFloat() - $aɩ[$fٹ[1417]] < $c) { return; } goto f; e÷֘: Hook::trigger($fٹ[1430], $aɩ); self::valueSet($aɩ[$fٹ[372]], $aɩ); goto eҙ; b: $aɩ[$fٹ[690]] = $E ? $E : $aɩ[$fٹ[690]]; $aɩ[$fٹ[1418]] = $D[$fٹ[1418]] ? $D[$fٹ[1418]] : 0; $aɩ[$fٹ[1417]] = timeFloat(); goto e÷֘; f: $D = self::get($aɩ[$fٹ[372]]); $E = $D[$fٹ[690]]; if ($E == self::STATYS_KILL) { $D䊔Ø = array($fٹ[1427] => LNG($fٹ[1428]), $fٹ[1025] => !1); Cache::set($fٹ[1429] . $this->task[$fٹ[372]], $D䊔Ø, 30); $this->end(); die; } else { if ($E == self::STATYS_STOP) { $C흒 = 2; $D[$fٹ[1418]] += $C흒; self::valueSet($aɩ[$fٹ[372]], $D); sleep($C흒); $this->update(); return; } } goto b; eҙ: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($cߌ) { $a蘭د =& $_SERVER[ȦÆ]; Cache::set($a蘭د[1429] . $this->task[$a蘭د[372]], $cߌ, 60); return $cߌ; } public static function get($A) { return self::valueGet($A); } public static function listData() { $aёʒ = self::valueGet(); return array_sort_by($aёʒ, $_SERVER[ȦÆ][1415], !0); } public static function kill($B) { return self::changeStatus($B, self::STATYS_KILL); } public static function stop($c↫) { return self::changeStatus($c↫, self::STATYS_STOP); } public static function restart($B) { return self::changeStatus($B, self::STATYS_RUNNING); } public static function killAll() { $Dߎ =& $_SERVER[ȦÆ]; $b̺ = self::listData(); foreach ($b̺ as $D) { self::kill($D[$Dߎ[372]]); } sleep(2); foreach ($b̺ as $D) { self::valueSet($D[$Dߎ[372]], !1); } } private static function changeStatus($c, $e) { goto A̅; A̅: $c߯Ό =& $_SERVER[ȦÆ]; $ā = self::valueGet($c); if (!$ā) { return !1; } goto b; b: $ā[$c߯Ό[690]] = $e; self::valueSet($c, $ā); self::log($c߯Ό[1431] . $ā[$c߯Ό[372]] . $c߯Ό[1432] . $e); goto C; C: return !0; goto D; D: } public static function valueGet($Dǜ = false) { $A׾ =& $_SERVER[ȦÆ]; if ($Dǜ) { $c = Model($A׾[404])->where(array($A׾[99] => $Dǜ, $A׾[39] => $A׾[1433]))->find(); return $c ? json_decode($c[$A׾[364]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($c = false) { goto c璝; c璝: $b졪 =& $_SERVER[ȦÆ]; $f܄Ƀ = array($b졪[39] => $b졪[1433]); if ($c) { $f܄Ƀ[$b졪[1412]] = $c; } goto C՞; c: return $cӖȸ׏; goto Fޫ; C՞: $cӖȸ׏ = Model($b졪[404])->where($f܄Ƀ)->select(); $cӖȸ׏ = $cӖȸ׏ ? $cӖȸ׏ : array(); foreach ($cӖȸ׏ as $EŽ => $D) { $cӖȸ׏[$EŽ] = json_decode($D[$b졪[364]], !0); } goto c; Fޫ: } public static function valueSet($a򬳎, $bȉ) { goto bل涆; B볪: if (!$Eݼ) { ob_start(); var_dump($bȉ); $e = ob_get_clean(); self::log($Aȏߤ[1434] . json_encode_force($e)); } if (!$a򬳎 || !$bȉ[$Aȏߤ[372]]) { return !1; } $fݬ = array($Aȏߤ[39] => $Aȏߤ[1433], $Aȏߤ[1412] => USER_ID, $Aȏߤ[99] => $a򬳎, $Aȏߤ[364] => $Eݼ); goto E×; bل涆: $Aȏߤ =& $_SERVER[ȦÆ]; if (!$bȉ) { return Model($Aȏߤ[404])->where(array($Aȏߤ[99] => $a򬳎, $Aȏߤ[39] => $Aȏߤ[1433]))->delete(); } $Eݼ = json_encode($bȉ); goto B볪; E×: Model($Aȏߤ[404])->add($fݬ, array(), !0); goto D腠; D腠: } public static function log($cՔ) { write_log($cՔ, $_SERVER[ȦÆ][1435]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto a; D鏍: Hook::bind($Cɠ[516], array($this, $Cɠ[1445])); Hook::bind($Cɠ[518], array($this, $Cɠ[1445])); Hook::bind($Cɠ[520], array($this, $Cɠ[1445])); goto D; eÉ: if (!$F[$Cɠ[1320]]) { $F[$Cɠ[1320]] = LNG($Cɠ[1461]); } goto Fխ; c᭪ѧ: Hook::bind($Cɠ[1449], array($this, $Cɠ[1450])); Hook::bind($Cɠ[1451], array($this, $Cɠ[1452])); Hook::bind($Cɠ[1453], array($this, $Cɠ[1454])); goto e; a: $Cɠ =& $_SERVER[ȦÆ]; $F =& $this->task; $this->sourceCopyFolder = !1; goto F; cӧ: Hook::bind($Cɠ[544], array($this, $Cɠ[1442])); Hook::bind($Cɠ[545], array($this, $Cɠ[1443])); Hook::bind($Cɠ[547], array($this, $Cɠ[1444])); goto Cܡʄ; A: $F[$Cɠ[973]] = $Cɠ[43]; $F[$Cɠ[1459]] = $Cɠ[43]; $F[$Cɠ[1460]] = 0; goto eÉ; Cܡʄ: Hook::bind($Cɠ[548], array($this, $Cɠ[1444])); Hook::bind($Cɠ[514], array($this, $Cɠ[1445])); Hook::bind($Cɠ[511], array($this, $Cɠ[1445])); goto D鏍; F: Hook::bind($Cɠ[1436], array($this, $Cɠ[1437])); Hook::bind($Cɠ[1438], array($this, $Cɠ[1439])); Hook::bind($Cɠ[1440], array($this, $Cɠ[1441])); goto cӧ; e: $F[$Cɠ[1455]] = LNG($Cɠ[1456]); $F[$Cɠ[1457]] = 0; $F[$Cɠ[1458]] = 0; goto A; D: Hook::bind($Cɠ[1446], array($this, $Cɠ[1447])); Hook::bind($Cɠ[537], array($this, $Cɠ[1448])); $this->sourceModelCopyFlag = !1; goto c᭪ѧ; Fխ: } protected function endAfter() { goto f׈Ḿ; D: Hook::unbind($A[547], array($this, $A[1444])); Hook::unbind($A[548], array($this, $A[1444])); Hook::unbind($A[514], array($this, $A[1445])); goto Eډݳ; Eډݳ: Hook::unbind($A[511], array($this, $A[1445])); Hook::unbind($A[516], array($this, $A[1445])); Hook::unbind($A[518], array($this, $A[1445])); goto cً; B: Hook::unbind($A[1449], array($this, $A[1450])); Hook::unbind($A[1451], array($this, $A[1452])); Hook::unbind($A[1453], array($this, $A[1454])); goto eȑߧ; AɃ: Hook::unbind($A[1440], array($this, $A[1441])); Hook::unbind($A[544], array($this, $A[1442])); Hook::unbind($A[545], array($this, $A[1443])); goto D; cً: Hook::unbind($A[520], array($this, $A[1445])); Hook::unbind($A[1446], array($this, $A[1447])); Hook::unbind($A[537], array($this, $A[1448])); goto B; f׈Ḿ: $A =& $_SERVER[ȦÆ]; Hook::unbind($A[1436], array($this, $A[1437])); Hook::unbind($A[1438], array($this, $A[1439])); goto AɃ; eȑߧ: } public function copyMoveStart($Bԋ, $AǛ, $Aн膘, $d) { } public function updateAfter() { goto c; c: $F =& $_SERVER[ȦÆ]; $D =& $this->task; if (!$D[$F[699]]) { return; } goto Cِ; e碵: $D[$F[1413]] = ($D[$F[1462]] + $DӖއ) / $D[$F[699]]; if ($D[$F[1413]] > 0) { $cօʩ = timeFloat() - $D[$F[1415]] - $D[$F[1418]]; $D[$F[1419]] = $cօʩ * (1 - $D[$F[1413]]) / $D[$F[1413]]; } goto c֍; Cِ: if ($this->sourceModelCopyFlag) { return; } $DӖއ = 0; if ($D[$F[1459]] == $F[1033]) { $DӖއ = $D[$F[1458]] * 0.5; } else { if ($D[$F[1459]] == $F[112]) { $DӖއ = $D[$F[1458]] * 0.5 + $D[$F[1457]] * 0.5; } } goto e碵; c֍: } public function addPath($fΆ) { goto aЭ; AÙӓ: $Eح = IO::infoWithChildren($fΆ); $aЦ = $Dﯺ[$CЯ[1463]] ? $Dﯺ[$CЯ[1463]][$CЯ[1464]] : 0; $Dﯺ[$CЯ[1463]] = array($CЯ[1464] => $aЦ + 1, $CЯ[391] => $Eح[$CЯ[38]], $CЯ[85] => $Eح[$CЯ[85]], $CЯ[471] => $Eح[$CЯ[471]] ? $Eح[$CЯ[471]] : $Eح[$CЯ[85]]); goto fͯ; fͯ: if ($Eح[$CЯ[39]] == $CЯ[173]) { $Dﯺ[$CЯ[971]] += 1; } else { $Dﯺ[$CЯ[971]] += $Eح[$CЯ[90]][$CЯ[88]]; if ($Eح[$CЯ[374]]) { $Dﯺ[$CЯ[971]] += $Eح[$CЯ[90]][$CЯ[89]] + 1; } } $Dﯺ[$CЯ[699]] += $Eح[$CЯ[87]]; $this->update(); goto a; aЭ: $CЯ =& $_SERVER[ȦÆ]; if (!$fΆ) { return; } $Dﯺ =& $this->task; goto AÙӓ; a: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($Cǭ) { $C =& $_SERVER[ȦÆ]; $Eҧ =& $this->task; $Eҧ[$C[1455]] = $Cǭ[$C[38]]; $Eҧ[$C[973]] = $Cǭ[$C[38]]; $this->update(); } public function copyFileStart($cО܇, $A, $aԇ, $b۶, $cᎸې, $c噦) { goto b; b: $dτ =& $_SERVER[ȦÆ]; $cখ = $cᎸې; if ($cখ == $GLOBALS[$dτ[1465]]) { $cখ = $GLOBALS[$dτ[1466]]; } goto Dź; Dź: $GLOBALS[$dτ[1466]] = $cᎸې; $GLOBALS[$dτ[1465]] = $c噦; $A =& $this->task; goto D; D: $A[$dτ[1455]] = $cখ; $A[$dτ[1457]] = (int) $cО܇->size($A); $A[$dτ[1458]] = 0; goto Bڰ; Bڰ: $A[$dτ[973]] = $dτ[43]; $A[$dτ[1459]] = $dτ[43]; $A[$dτ[1460]] = 0; goto B把Փ; B把Փ: $this->update(); goto A; A: } public function copyFileEnd($F䛰, $DӨ, $AÌ, $c, $Dނ, $A) { $FɅ =& $_SERVER[ȦÆ]; $f =& $this->task; $f[$FɅ[1458]] = $f[$FɅ[1457]]; $f[$FɅ[1459]] = $FɅ[43]; if ($Dނ == $f[$FɅ[1455]]) { $f[$FɅ[1462]] += $f[$FɅ[1457]]; $this->update(1); } else { $this->update(); $f[$FɅ[1458]] = 0; } self::log($FɅ[1467] . $DӨ . $FɅ[76] . $c . $FɅ[12] . $Dނ . $FɅ[1468] . $f[$FɅ[1455]]); } public function updateFileEnd($B, $ĉ) { $F硛ӓ =& $_SERVER[ȦÆ]; $c =& $this->task; $c[$F硛ӓ[1455]] = $B; $c[$F硛ӓ[1457]] = $ĉ; $c[$F硛ӓ[1462]] += $ĉ; $this->update(1); } public function sourceModelCopy($Cǔ) { goto Cٴ; f: $Dܰ =& $this->task; $this->sourceModelCopyFlag = !0; $f = 0; goto a; a: switch ($f) { case $A̽[512]: $f = 1; break; case $A̽[515]: $Dܰ[$A̽[1455]] = $e׽[$A̽[38]]; break; case $A̽[517]: $f = intval($Cǔ[$A̽[368]] * 0.4); break; case $A̽[519]: $f = intval($Cǔ[$A̽[368]] * 0.2); break; case $A̽[521]: $f = intval($Cǔ[$A̽[368]] * 0.4); break; } $this->update($f); $this->sourceModelCopyFlag = !1; goto eպ; Cٴ: $A̽ =& $_SERVER[ȦÆ]; $f = $Cǔ[0]; $e׽ = $Cǔ[1]; goto f; eպ: } public function sourceRemove($Fڈ, $E) { $fۣ =& $_SERVER[ȦÆ]; $this->sourceModelCopyFlag = !0; $Eϯ = 1; if (isset($Fڈ[$fۣ[90]])) { $Eϯ = $Fڈ[$fۣ[90]][$fۣ[88]] + $Fڈ[$fۣ[90]][$fۣ[89]] + 1; } $this->update($Eϯ); $this->sourceModelCopyFlag = !1; } public function sourceMove($EُӰ) { $this->sourceRemove($EُӰ, !1); } public function curlProgress($C, $D싱, $Aҏǡ, $Eϒ, $Cɦ֌) { $Fڭ̂ =& $_SERVER[ȦÆ]; $aˢ =& $this->task; if ($Cɦ֌ > 0) { $aˢ[$Fڭ̂[973]] = $Fڭ̂[1469]; $aˢ[$Fڭ̂[1459]] = $Fڭ̂[112]; if ($aˢ[$Fڭ̂[1457]] == $Eϒ || $Eϒ > 1024 * 1024) { $aˢ[$Fڭ̂[1458]] = $Cɦ֌; } if ($aˢ[$Fڭ̂[1460]]) { $aˢ[$Fڭ̂[1458]] = $Cɦ֌ + $aˢ[$Fڭ̂[1460]]; } } else { if ($Aҏǡ > 0) { if ($aˢ[$Fڭ̂[1457]] == $D싱) { $aˢ[$Fڭ̂[1458]] = $Aҏǡ; $aˢ[$Fڭ̂[973]] = $Fڭ̂[1470]; $aˢ[$Fڭ̂[1459]] = $Fڭ̂[1033]; } } } $this->update(); } public function curlProgressStart($bȕ) { } public function curlProgressEnd($d٬ܽ) { $a壻킯 =& $_SERVER[ȦÆ]; $d =& $this->task; $F = curl_getinfo($d٬ܽ); $CѠ˹ = $F[$a壻킯[1471]]; if ($d[$a壻킯[1459]] == $a壻킯[112] && $CѠ˹) { $d[$a壻킯[1460]] += $CѠ˹; } $this->update(); } } goto cբ; eˎ: class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\143\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\x61\155\x65" => "\151\157\x5f\x73\157\x75\x72\143\x65\x5f\155\x65\164\141", "\155\x65\164\x61\x46\x69\145\154\144" => "\163\157\x75\162\143\x65\x49\x44"); protected $dataAuto = array(array("\x6d\157\144\151\146\171\x54\151\155\145", "\x74\151\155\145", "\151\156\x73\145\x72\x74", "\x66\165\156\143\x74\x69\x6f\x6e"), array("\x63\162\145\141\x74\145\124\151\155\145", "\x74\x69\x6d\145", "\x69\156\x73\x65\x72\x74", "\x66\x75\x6e\143\x74\151\x6f\x6e"), array("\x76\x69\145\167\x54\151\x6d\x65", "\x74\x69\155\x65", "\x69\x6e\x73\145\x72\x74", "\x66\x75\156\143\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($FԴ) { return $this->listSource(array($_SERVER[ȦÆ][373] => $FԴ)); } public function typeName($A) { static $d쵷 = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\x6d", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\147\x72\157\165\x70"); return $d쵷[$A . $_SERVER[ȦÆ][43]]; } public function sourceListInfo($Dɘւ, $d = false) { goto E; E: if (!$Dɘւ) { return array(); } $B޵ = $this->where(array($B鞎[374] => array($B鞎[17], $Dɘւ)))->select(); $this->_listDataApply($B޵, $d); goto Fׇ; E: $B鞎 =& $_SERVER[ȦÆ]; $Dɘւ = $Dɘւ ? $Dɘւ : array(); $Dɘւ = array_filter(array_unique($Dɘւ)); goto E; Fׇ: return array_to_keyvalue($B޵, $B鞎[374]); goto Dكސ; Dكސ: } public function pathInfoFilter($d) { goto c; E̊: if (isset($d[$bѣ[381]]) && $d[$bѣ[381]][$bѣ[382]] == -1) { $Dطᑋ = array_remove_value($Dطᑋ, $bѣ[193]); $Dطᑋ = array_remove_value($Dطᑋ, $bѣ[116]); $Dطᑋ = array_remove_value($Dطᑋ, $bѣ[383]); $Dطᑋ = array_remove_value($Dطᑋ, $bѣ[384]); $Dطᑋ = array_remove_value($Dطᑋ, $bѣ[87]); $Dطᑋ = array_remove_value($Dطᑋ, $bѣ[385]); } $d = array_field_key($d, $Dطᑋ); return $d; goto bԋ; c: $bѣ =& $_SERVER[ȦÆ]; $d[$bѣ[85]] = KodIO::make($d[$bѣ[374]]); $d[$bѣ[39]] = $d[$bѣ[375]] == 1 ? $bѣ[86] : $bѣ[173]; goto d񄉸; c: $A閽 .= $bѣ[379]; $A閽 .= $bѣ[380]; $Dطᑋ = explode($bѣ[57], $A閽); goto E̊; d񄉸: $d[$bѣ[376]] = $this->typeName($d[$bѣ[376]]); if ($d[$bѣ[375]] != 1) { $d[$bѣ[166]] = $d[$bѣ[377]]; unset($d[$bѣ[377]]); } $A閽 = $bѣ[378]; goto c; bԋ: } public function listUserFav() { goto C; Fސ: $dᰍ = array_to_keyvalue($dᰍ, $B²߿[43], $B²߿[85]); if ($dᰍ) { $C֭ = $this->listSource(array($B²߿[388] => array($B²߿[389], $dᰍ))); } $C֭ = array_to_keyvalue($C֭[$B²߿[359]], $B²߿[374]); goto A߇ں; C: $B²߿ =& $_SERVER[ȦÆ]; $d̊ = Model($B²߿[386])->listData(); $dᰍ = array_filter_by_field($d̊, $B²߿[39], $B²߿[387]); goto Fސ; A߇ں: foreach ($d̊ as &$aݎ) { $aݎ = array($B²߿[390] => $aݎ[$B²߿[372]], $B²߿[391] => $aݎ[$B²߿[38]], $B²߿[392] => $aݎ[$B²߿[85]], $B²߿[393] => $aݎ[$B²߿[39]], $B²߿[394] => $aݎ[$B²߿[193]], $B²߿[395] => $aݎ[$B²߿[116]]); if ($aݎ[$B²߿[39]] == $B²߿[387] && $C֭[$aݎ[$B²߿[85]]]) { $aݎ[$B²߿[396]] = $C֭[$aݎ[$B²߿[85]]]; } } return $d̊; goto aô; aô: } public function listUserTag($A) { goto DҜ; f: $e = array_to_keyvalue($e, $Bᣬ[43], $Bᣬ[85]); $EȈΊ = array(); if ($e) { $B翇΋ = array($Bᣬ[388] => array($Bᣬ[389], $e)); $EȈΊ = $this->listSource($B翇΋); } goto Dڈ²; Dڈ²: $this->listUserTagClear($e, $EȈΊ, $A); return $EȈΊ; goto Aԇ; DҜ: $Bᣬ =& $_SERVER[ȦÆ]; $DЦ = Model($Bᣬ[397])->listData(); $e = array_filter_by_field($DЦ, $Bᣬ[398], $A); goto f; Aԇ: } private function listUserTagClear($c, $c, $eɐ̗) { goto Fυܠ; Fυܠ: $Aƕ =& $_SERVER[ȦÆ]; if (!$c) { return; } if ($c && count($c) == $c[$Aƕ[356]][$Aƕ[357]]) { return; } goto a; a: $b = array(); $Eٟ֋ = array_to_keyvalue($c[$Aƕ[84]], $Aƕ[43], $Aƕ[374]); $c = array_to_keyvalue($c[$Aƕ[83]], $Aƕ[43], $Aƕ[374]); goto aяƗ; D: Model($Aƕ[399])->removeFromTag($b, $eɐ̗); goto eӟ; aяƗ: $f = array_merge($c, $Eٟ֋); foreach ($c as $cȍ) { if (!in_array($cȍ, $f)) { $b[] = $cȍ; } } if (!$b) { return; } goto D; eӟ: } public function listUserRecycle() { $d˖԰ =& $_SERVER[ȦÆ]; $Eĕ = Model($d˖԰[400])->listData(); if (!$Eĕ) { return array(); } $B޹ = array($d˖԰[388] => array($d˖԰[389], $Eĕ), $d˖԰[401] => 1); return $this->listSource($B޹); } public function listSource($b󠼡, $C = 3000) { goto Dū; f֑: return $a; goto A; eȶ: $a = $this->field($b)->_makeOrder()->where($b󠼡)->selectPage($C); $this->_listDataApply($a[$B[359]]); $this->_listMake($a); goto f֑; Dū: $B =& $_SERVER[ȦÆ]; if (!isset($b󠼡[$B[402]])) { $b󠼡[$B[402]] = 0; } $b = $B[403]; goto eȶ; A: } protected function _makeOrder() { goto C୩; C୩: $b =& $_SERVER[ȦÆ]; $b軰 = Model($b[404])->get($b[405]); $B = Model($b[404])->get($b[406]); goto DƋى; DƋى: $F軩ێ = array($b[407] => $b[408], $b[409] => $b[410]); $C = array($b[38] => $b[38], $b[87] => $b[87], $b[166] => $b[377], $b[383] => $b[383], $b[411] => $b[384], $b[193] => $b[193], $b[116] => $b[116]); $E߽ւ = Input::get($b[412], $b[17], $b軰, array_keys($C)); goto fՈ; Fǵ̊: if ($E߽ւ == $b[38]) { } $eƷ = $b[414] . $C[$E߽ւ] . $b[60] . $F軩ێ[$AŘ]; return $this->order(rtrim(trim($eƷ), $b[57])); goto fӞȑ; fՈ: $AŘ = Input::get($b[413], $b[17], $B, array_keys($F軩ێ)); if (!in_array($E߽ւ, array_keys($C))) { $E߽ւ = $b[38]; } if (!in_array($AŘ, array_keys($F軩ێ))) { $E߽ւ = $b[407]; } goto Fǵ̊; fӞȑ: } protected function _listDataApplyItem($F, $d = false) { $D䬌 = array($F); $this->_listDataApply($D䬌, $d); return $D䬌[0]; } protected function _listDataApply(&$eҳ, $c஥ = false) { goto A; DΊ: $this->_listAppendUser($eҳ); $this->_listFilterInfo($eҳ, $c஥); goto E; c됬: $B = array_unique($B); $this->_listSourceCache($eҳ); if (!$c஥) { $this->_listAppendMeta($eҳ, $B); $this->_listAppendFileMeta($eҳ, $B); $this->_listAppendChildren($eҳ, $B); } goto B; B: $this->_listAppendPath($eҳ); $this->_listAppendAuth($eҳ); $this->_listAppendSourceInfo($eҳ, $B); goto DΊ; A: $eՐ =& $_SERVER[ȦÆ]; if (!$eҳ) { $eҳ = array(); return; } $B = array_to_keyvalue($eҳ, $eՐ[43], $eՐ[374]); goto c됬; E: } protected function _listSourceCache($Bˆ) { $E҅ =& $_SERVER[ȦÆ]; foreach ($Bˆ as $FɈƆ) { self::$cacheSourceInfo[$E҅[415] . $FɈƆ[$E҅[374]]] = $FɈƆ; } } protected function _listFilterInfo(&$fż𑫨, $bэ = false) { $A =& $_SERVER[ȦÆ]; foreach ($fż𑫨 as &$F) { $F = $this->pathInfoFilter($F); self::$cachePathInfo[$A[416] . intval($bэ) . $A[417] . $F[$A[374]]] = $F; } } protected function _listMake(&$a) { $a =& $_SERVER[ȦÆ]; $a[$a[84]] = array(); $a[$a[83]] = array(); foreach ($a[$a[359]] as $bɄ) { $Dʆ = $bɄ[$a[375]] == 1 ? $a[84] : $a[83]; $a[$Dʆ][] = $bɄ; } unset($a[$a[359]]); } protected function _listAppendMeta(&$c, $e) { goto a˧; Dڣ: foreach ($a˅Ɉ as $Dܨۊ) { if (!isset($cƉ[$Dܨۊ[$Fޒ[374]]])) { $cƉ[$Dܨۊ[$Fޒ[374]]] = array(); } if (in_array($Dܨۊ[$Fޒ[99]], $bܭח)) { continue; } $cƉ[$Dܨۊ[$Fޒ[374]]][$Dܨۊ[$Fޒ[99]]] = $Dܨۊ[$Fޒ[364]]; } foreach ($c as &$e) { $e[$Fޒ[422]] = !1; if (isset($cƉ[$e[$Fޒ[374]]])) { $e[$Fޒ[422]] = $cƉ[$e[$Fޒ[374]]]; } if ($this->fileIsLock($e) && $e[$Fޒ[381]]) { $C̳ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $e[$Fޒ[381]][$Fޒ[382]] = AuthModel::authDisable($e[$Fޒ[381]][$Fޒ[382]], $C̳); $e[$Fޒ[381]][$Fޒ[423]][$Fޒ[381]] = $e[$Fޒ[381]][$Fޒ[382]]; } } goto Ḑ; d˗: if (!$a˅Ɉ) { return; } $bܭח = array($Fޒ[420], $Fޒ[421]); $cƉ = array(); goto Dڣ; a˧: $Fޒ =& $_SERVER[ȦÆ]; $cՅ = array($Fޒ[388] => array($Fޒ[389], $e)); $a˅Ɉ = Model($Fޒ[418])->field($Fޒ[419])->where($cՅ)->select(); goto d˗; Ḑ: } protected function _listAppendFileMeta(&$Bʫ, $c) { goto Dۡ։; Dۡ։: $B =& $_SERVER[ȦÆ]; $Fí = array_to_keyvalue($Bʫ, $B[43], $B[424]); $Fí = array_filter(array_unique($Fí)); goto d; d: if (!$Fí) { return; } $bӲ = array($B[425] => array($B[389], $Fí)); $fĈǉ = $B[426]; goto b߃; Dڇ: foreach ($Bʫ as &$f) { goto Eׇ; Eׇ: $Dڶ = $f[$B[424]]; if (!$Dڶ || !isset($dĈ[$Dڶ])) { continue; } $a = $dĈ[$Dڶ]; goto fŉ; fʵ: unset($dĈ[$Dڶ][$B[85]]); $aԌߍ = is_array($A龃[$Dڶ]) ? $A龃[$Dڶ] : array(); $f[$B[168]] = array_merge($aԌߍ, $dĈ[$Dڶ]); goto F̽; fŉ: $a[$B[87]] = $f[$B[87]]; $a[$B[38]] = $f[$B[38]]; self::$cacheFileInfo[$B[430] . $Dڶ] = $a; goto fʵ; F̽: if (isset($f[$B[168]][$B[431]])) { $f[$B[431]] = json_decode($f[$B[168]][$B[431]], !0); unset($f[$B[168]][$B[431]]); } goto bτ; bτ: } goto aۙ; b̯: $e䙼 = $e䙼 ? $e䙼 : array(); $A龃 = array(); foreach ($e䙼 as $F߫ī) { if (!isset($A龃[$F߫ī[$B[424]]])) { $A龃[$F߫ī[$B[424]]] = array(); } $A龃[$F߫ī[$B[424]]][$F߫ī[$B[99]]] = $F߫ī[$B[364]]; } goto Dڇ; b߃: $dĈ = Model($B[427])->field($fĈǉ)->where($bӲ)->select(); $dĈ = array_to_keyvalue($dĈ, $B[424]); $e䙼 = Model($B[428])->field($B[429])->where($bӲ)->select(); goto b̯; aۙ: } protected function _listAppendSourceInfo(&$BݨŦ, $a͹) { goto dǏʝ; e䊌: $e = array_to_keyvalue_group($f㧍, $c[374]); foreach ($BݨŦ as &$A) { $A[$c[396]] = array($c[435] => 0, $c[436] => 0, $c[437] => 0); if (isset($Eግ[$A[$c[374]]])) { $A[$c[396]][$c[438]] = 1; $A[$c[396]][$c[439]] = $Eግ[$A[$c[374]]][$c[38]]; } if (isset($BĢ[$A[$c[374]]])) { $A[$c[396]][$c[440]] = array(); foreach ($BĢ[$A[$c[374]]] as $Dͮ) { $a҆ = $a󭂉[$Dͮ]; $A[$c[396]][$c[440]][] = array($c[441] => $a҆[$c[372]], $c[391] => $a҆[$c[38]], $c[442] => $a҆[$c[443]]); } } if (isset($e[$A[$c[374]]])) { $A[$c[396]][$c[444]] = array(); foreach ($e[$A[$c[374]]] as $eɝ) { $A[$c[396]][$c[444]] = array($c[445] => $eɝ[$c[446]], $c[447] => $eɝ[$c[448]], $c[449] => $eɝ[$c[374]], $c[450] => $eɝ[$c[451]], $c[452] => $eɝ[$c[453]]); } } } return $BݨŦ; goto b; Bĝ: $bĆ = Model($c[397])->listData(); $Dԧ = Model($c[386])->listData(); $f㧍 = Model($c[434])->listSimple(); goto D޻; dǏʝ: $c =& $_SERVER[ȦÆ]; if (!defined($c[432])) { return; } $A۪ = Model($c[433])->listData(); goto Bĝ; D޻: $a󭂉 = array_to_keyvalue($A۪, $c[372]); $BĢ = array_to_keyvalue_group($bĆ, $c[85], $c[398]); $Eግ = array_to_keyvalue($Dԧ, $c[85]); goto e䊌; b: } protected function _listAppendChildren(&$eނК, $cۂ) { goto Bԃ; cӳǄ: $b = 1024 * 50; $eނК = is_array($eނК) ? $eނК : array(); $Bȵ܆ = count($eނК); goto B꓊; Bԃ: $d =& $_SERVER[ȦÆ]; $cթӦ = $d[366]; $C = array(); goto cӳǄ; A貗: foreach ($eނК as &$F) { if ($F[$d[375]]) { unset($F[$d[377]]); $F[$d[198]] = intval($C[$F[$d[374]] . $d[456]][$d[457]]); $F[$d[197]] = intval($C[$F[$d[374]] . $d[458]][$d[457]]); } } goto Bɇ՚; B꓊: $E롡̱ = $this->tablePrefix . $this->tableName; for ($D = 0; $D < $Bȵ܆; $D++) { $aѦޢ = intval($eނК[$D][$d[402]]); if ($eނК[$D][$d[375]]) { $B = $eނК[$D][$d[374]]; $cթӦ .= "\123\x45\x4c\x45\x43\124\x20\x2a\40\106\x52\117\x4d\40\x28\123\x45\114\x45\103\x54\x20\x27{$B}\x5f\150\x61\x73\x46\x69\x6c\x65\x27\x20\x61\163\40\150\141\163\54\143\x6f\165\x6e\x74\50\x31\x29\x20\x61\163\x20\150\141\163\x43\x6f\165\x6e\164\x20\106\122\117\x4d\x20\140{$E롡̱}\x60\40\xa\x9\11\11\x9\11\x77\x68\x65\x72\145\40\160\x61\162\145\156\x74\x49\104\x3d{$B}\40\141\x6e\144\40\x69\163\106\157\154\144\x65\162\75\60\40\x61\x6e\144\x20\x69\163\104\x65\x6c\x65\x74\x65\75{$aѦޢ}\x29\40\141\x73\40\164\142\x31\137{$B}\x20\165\156\151\x6f\156\40\141\x6c\x6c\x20\12\x9\11\11\x9\11\123\x45\x4c\105\103\124\x20\x2a\x20\106\122\117\115\x20\x28\x53\105\x4c\x45\x43\124\x20\x27{$B}\x5f\150\141\163\x46\x6f\154\144\145\162\47\x20\141\163\x20\x68\141\x73\106\x69\x6c\145\x2c\x63\x6f\165\156\x74\x28\61\51\x20\141\x73\40\x68\141\x73\x43\x6f\x75\x6e\164\40\x46\122\117\115\40\x60{$E롡̱}\140\40\xa\11\x9\x9\11\11\167\x68\145\162\145\x20\x70\x61\162\145\156\164\111\x44\x3d{$B}\x20\141\156\x64\x20\x69\163\106\157\154\x64\x65\162\x3d\x31\40\141\156\x64\x20\x69\x73\x44\x65\154\145\x74\145\75{$aѦޢ}\x29\40\x61\x73\x20\164\142\x32\x5f{$B}\x20\x75\x6e\151\157\x6e\x20\141\x6c\154\40"; } if ((strlen($cթӦ) >= $b || $D == $Bȵ܆ - 1) && $cթӦ) { $cթӦ = substr($cթӦ, 0, -strlen($d[454])); $a˗ = $this->query($cթӦ); $C = array_merge($C, $a˗); $cթӦ = $d[43]; } } $C = array_to_keyvalue($C, $d[455]); goto A貗; Bɇ՚: } protected function _listAppendAuth(&$Aͯ) { goto fݯĜ; C: foreach ($Aͯ as $bҚ) { if ($bҚ[$Dǃ[376]] == self::TYPE_GROUP) { $a៌[] = $bҚ[$Dǃ[374]]; } } if (!$a៌) { return; } $c = array_to_keyvalue($Aͯ, $Dǃ[374]); goto dӋ; fݯĜ: $Dǃ =& $_SERVER[ȦÆ]; if (!defined($Dǃ[432])) { return; } $a៌ = array(); goto C; dӋ: $A = Model($Dǃ[459])->getSourceList($a៌, $c); foreach ($Aͯ as $aŢ => &$bҚ) { $bҚ[$Dǃ[381]] = $A[$bҚ[$Dǃ[374]]]; if (!$bҚ[$Dǃ[381]] && $bҚ[$Dǃ[376]] == self::TYPE_GROUP) { $bҚ[$Dǃ[381]] = Action($Dǃ[460])->pathGroupAuthMake($bҚ[$Dǃ[461]]); if (!$bҚ[$Dǃ[381]] && !_get($GLOBALS, $Dǃ[462])) { $bҚ[$Dǃ[195]] = !1; $bҚ[$Dǃ[194]] = !1; } } if ($bҚ[$Dǃ[381]]) { $bҚ[$Dǃ[195]] = AuthModel::authCheckEdit($bҚ[$Dǃ[381]][$Dǃ[382]]); $bҚ[$Dǃ[194]] = AuthModel::authCheckView($bҚ[$Dǃ[381]][$Dǃ[382]]); } $this->groupPathDisplay($bҚ); } goto cɅ; cɅ: } public function groupPathDisplay(&$aޱǝ) { goto f; aĞ贑: $aޱǝ[$fݿ[465]] = $f[$fݿ[466]]; $aޱǝ[$fݿ[385]] = $f[$fݿ[464]]; $aޱǝ[$fݿ[467]] = $f[$fݿ[468]]; goto cؙ卝; f: $fݿ =& $_SERVER[ȦÆ]; if ($aޱǝ[$fݿ[376]] != self::TYPE_GROUP) { return; } $f = Model($fݿ[463])->getInfo($aޱǝ[$fݿ[461]]); goto DԱ; cؙ卝: $aޱǝ[$fݿ[469]] = $E . $f[$fݿ[396]][$fݿ[374]]; goto f; DԱ: $f = $this->parentLevelArray($f[$fݿ[464]]); $E = $fݿ[43]; foreach ($f as $eٔ) { $C𕕊 = Model($fݿ[463])->getInfo($eٔ); $E .= $C𕕊[$fݿ[396]][$fݿ[374]] . $fݿ[57]; } goto aĞ贑; f: } protected function _listAppendPath(&$A̖Ն) { goto EߵΥ; EߵΥ: $Aݻ =& $_SERVER[ȦÆ]; $C = array(); foreach ($A̖Ն as &$Dܽ앰) { $C[$Dܽ앰[$Aݻ[374]]] = $Dܽ앰[$Aݻ[38]]; $b町 = $this->parentLevelArray($Dܽ앰[$Aݻ[464]]); array_shift($b町); foreach ($b町 as $dý) { if (!isset($C[$dý])) { $C[$dý] = 0; } } } goto d; d: $bł = array(); foreach ($C as $A󤄊 => $A) { if (!$A) { $bł[] = $A󤄊; } } if ($bł) { $Fݛ = array($Aݻ[388] => array($Aݻ[389], $bł)); if (count($bł) == 1) { $b = $this->sourceInfo($bł[0]); $b = is_array($b) ? array($b) : !1; } else { $b = $this->field($Aݻ[470])->where($Fݛ)->select(); } $d٢ = array_to_keyvalue($b, $Aݻ[374], $Aݻ[38]); $C = array_merge_index($C, $d٢); } goto e᷂; e᷂: $cՂ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); foreach ($A̖Ն as &$Dܽ앰) { goto Fߥ; Eㅤǩ: if ($b町) { $f .= $Dܽ앰[$Aݻ[38]]; } if ($Dܽ앰[$Aݻ[375]]) { $f .= $Aݻ[18]; } $Dܽ앰[$Aݻ[471]] = str_replace($Aݻ[472], $Aݻ[18], $f); goto f; Fߥ: $b町 = $this->parentLevelArray($Dܽ앰[$Aݻ[464]]); $f = $this->_listAppendPathRoot($Dܽ앰, $b町); foreach ($b町 as $dý) { if (isset($C[$dý])) { $f .= $C[$dý] . $Aݻ[18]; } } goto Eㅤǩ; f: $EŠ = trim($Dܽ앰[$Aݻ[471]], $Aݻ[18]); if ($Dܽ앰[$Aݻ[466]] == $Aݻ[473] && $EŠ) { $Dܽ앰[$Aݻ[38]] = $EŠ; } $this->_listAppendPathRecycle($Dܽ앰, $b町, $cՂ); goto BƠԩ; BƠԩ: } goto D; D: } private function _listAppendPathRecycle(&$Dۙ, $dӤ, $D⽜) { goto Aܖǈ; Aܖǈ: $F =& $_SERVER[ȦÆ]; if (intval($Dۙ[$F[376]]) !== self::TYPE_SYSTEM) { return; } if (!in_array($D⽜, $dӤ) && $Dۙ[$F[374]] != $D⽜) { return; } goto Eꉭ; Eꉭ: $f = explode($F[18], trim($Dۙ[$F[471]], $F[18])); $Dע = implode($F[18], array_slice($f, 2)); $Dۙ[$F[471]] = $F[18] . LNG($F[474]) . $F[18] . ltrim($Dע, $F[18]); goto AώÃ; AώÃ: $Dۙ[$F[464]] = $F[475] . implode($F[57], array_slice($dӤ, 1)) . $F[57]; if ($Dۙ[$F[374]] == $D⽜) { $Dۙ[$F[464]] = $F[475]; $Dۙ[$F[466]] = $F[473]; $Dۙ[$F[38]] = LNG($F[474]); } $Dۙ[$F[476]] = $F[477]; goto a; a: } protected function _listAppendPathRoot(&$E榯, $A) { $C =& $_SERVER[ȦÆ]; $C = $C[43]; if ($E榯[$C[376]] == self::TYPE_USER) { if (defined($C[432]) && $E榯[$C[461]] == USER_ID) { $C = LNG($C[478]); if (!$A) { $E榯[$C[38]] = $C; } } else { $e = Model($C[479])->getInfoSimple($E榯[$C[461]]); $C = LNG($C[480]) . $C[163] . $e[$C[38]] . $C[481]; } } else { if ($E榯[$C[376]] == self::TYPE_GROUP) { $e = Model($C[463])->getInfoSimple($E榯[$C[461]]); $C = $e[$C[38]]; } else { if ($E榯[$C[376]] == self::TYPE_SYSTEM) { $e = $this->sourceInfo($A[0], !0); $C = $e[$C[38]]; } } } $C = $C ? $C[18] . $C . $C[18] : $C[18]; return $C; } protected function _listAppendUser(&$Aڒ) { $Bꍋ脩 =& $_SERVER[ȦÆ]; $dƽ = array_to_keyvalue($Aڒ, $Bꍋ脩[43], $Bꍋ脩[383]); $Eްɉ = array_to_keyvalue($Aڒ, $Bꍋ脩[43], $Bꍋ脩[384]); $aϺ = array_merge($dƽ, $Eްɉ); $Aӻ = Model($Bꍋ脩[482])->userListInfo($aϺ); foreach ($Aڒ as &$c󾷣) { $d屮 = $c󾷣[$Bꍋ脩[383]]; $c󾷣[$Bꍋ脩[383]] = $Aӻ[$d屮] ? $Aӻ[$d屮] : !1; $d屮 = $c󾷣[$Bꍋ脩[384]]; $c󾷣[$Bꍋ脩[384]] = $Aӻ[$d屮] ? $Aӻ[$d屮] : !1; if (isset($c󾷣[$Bꍋ脩[422]]) && $c󾷣[$Bꍋ脩[422]][$Bꍋ脩[483]]) { $DĜڶ = $GLOBALS[$Bꍋ脩[16]][$Bꍋ脩[94]][$Bꍋ脩[484]]; if ($c󾷣[$Bꍋ脩[422]][$Bꍋ脩[485]] <= time() - $DĜڶ) { $this->metaSet($c󾷣[$Bꍋ脩[374]], $Bꍋ脩[483], null); $this->metaSet($c󾷣[$Bꍋ脩[374]], $Bꍋ脩[485], null); unset($c󾷣[$Bꍋ脩[422]][$Bꍋ脩[483]]); continue; } $bƢ۸ = $c󾷣[$Bꍋ脩[422]][$Bꍋ脩[483]]; $c󾷣[$Bꍋ脩[422]][$Bꍋ脩[486]] = Model($Bꍋ脩[482])->getInfoSimpleOuter($bƢ۸); } } } public function parentLevelArray($Bޡ) { $Dˆ =& $_SERVER[ȦÆ]; $Bޡ = explode($Dˆ[57], trim($Bޡ, $Dˆ[57])); return array_remove_value($Bޡ, $Dˆ[473]); } public function listAll($fŔ) { goto d; B˼Ֆ: $EȲƿ = $B[491]; $b˞ؿ = "\114\105\x46\x54\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\x69\157\137\146\151\154\145\x20\x66\x69\x6c\x65\40\x6f\156\x20\163\x6f\165\162\143\x65\56\x66\x69\154\145\x49\104\40\x3d\40\146\151\x6c\x65\x2e\x66\x69\154\145\111\x44"; $dɛ = $this->alias($B[492])->field($EȲƿ)->where($F碘)->join($b˞ؿ)->select(); goto aֵ; aֵ: $this->_listAppendAuth($dɛ); $this->_listAppendUser($dɛ); $this->_listAppendPath($dɛ); goto B; d: $B =& $_SERVER[ȦÆ]; $a₦ = $this->sourceInfo($fŔ); $F碘 = array($B[487] => array($B[488], $a₦[$B[464]] . $fŔ . $B[489]), $B[490] => 0); goto B˼Ֆ; C: $Eћ = array(); foreach ($dɛ as $A => $B᭲) { goto FǗ; FǗ: $F = $this->parentLevelArray($B᭲[$B[464]]); array_shift($F); $F = $bݔ; goto eת; c򍧛: $F = str_replace($B[472], $B[18], $F); $F = str_replace($B[472], $B[18], $F); $c = array($B[392] => str_replace($B[472], $B[18], $F), $B[493] => intval($B᭲[$B[375]]), $B[396] => $this->pathInfoFilter($B᭲, !0)); goto f; eת: for ($Dύ = 0; $Dύ < count($F); $Dύ++) { $F .= $dɛ[$F[$Dύ]][$B[38]] . $B[18]; } $F .= $B᭲[$B[38]]; if ($B᭲[$B[375]]) { $F .= $B[18]; } goto c򍧛; f: if (!$B᭲[$B[375]]) { $c[$B[424]] = $B᭲[$B[424]]; $c[$B[494]] = $B᭲[$B[85]]; } $Eћ[] = $c; goto bߕ; bߕ: } return $Eћ; goto B; B: $dɛ = array_to_keyvalue($dɛ, $B[374]); $bݔ = "\57{$a₦[$B[38]]}\x2f"; $bݔ = $bݔ == $B[472] ? $B[18] : $bݔ; goto C; B: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Aç) { goto F; F: $Eǂ = 1; $this->_lockEvent($Aç, array($b[496], $b[497]), $Eǂ); $this->_lockParent($Aç, array($b[497]), $Eǂ); goto bȄ; F: $b =& $_SERVER[ȦÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($b[495], $Aç); goto F; bȄ: $this->_lockEvent($Aç, array($b[498], $b[499]), $Eǂ); $this->_lockCheckEnd($b[495], $Aç); goto c; c: } public function lockCopyEnd($fӖš) { $dۅ =& $_SERVER[ȦÆ]; if (!$this->allowLock()) { return; } $F° = 0; $this->_lockEvent($fӖš, array($dۅ[496], $dۅ[497]), $F°); $this->_lockParent($fӖš, array($dۅ[497]), $F°); $this->_lockEvent($fӖš, array($dۅ[498], $dۅ[499]), $F°); } public function lockWriteStart($A, $E͟ŵ = '') { goto fՍ; fՍ: $dʘ =& $_SERVER[ȦÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($dʘ[496], $A); goto F󚳸; F󚳸: $FÊ = 1; $this->_lockKey($dʘ[500] . $A . $dʘ[101] . $E͟ŵ, $FÊ); $this->_lockEvent($A, array($dʘ[495], $dʘ[497]), $FÊ); goto fھ; fھ: $this->_lockParent($A, array($dʘ[495], $dʘ[497]), $FÊ); $this->_lockCheckEnd($dʘ[496], $A); goto c۹ء; c۹ء: } public function lockWriteEnd($F͈, $bფ = '') { $Fއݺ =& $_SERVER[ȦÆ]; if (!$this->allowLock()) { return; } $d = 0; $this->_lockKey($Fއݺ[500] . $F͈ . $Fއݺ[101] . $bფ, $d); $this->_lockEvent($F͈, array($Fއݺ[495], $Fއݺ[497]), $d); $this->_lockParent($F͈, array($Fއݺ[495], $Fއݺ[497]), $d); } public function lockMoveStart($bˣˋ) { goto C񈿓; c: $this->_lockParent($bˣˋ, array($A۩[495], $A۩[497]), $f׮); $this->_lockEvent($bˣˋ, array($A۩[502], $A۩[498], $A۩[499]), $f׮); $this->_lockCheckEnd($A۩[497], $bˣˋ); goto E҉; a: $f׮ = 1; $this->_lockKey($A۩[501] . $bˣˋ, $f׮); $this->_lockEvent($bˣˋ, array($A۩[495], $A۩[496]), $f׮); goto c; C񈿓: $A۩ =& $_SERVER[ȦÆ]; if (!$this->allowLock()) { return; } $this->_lockCheck($A۩[497], $bˣˋ); goto a; E҉: } public function lockMoveEnd($d䐄) { goto Dڎ; e٧: $this->_lockKey($f[501] . $d䐄, $dߝ굂); $this->_lockEvent($d䐄, array($f[495], $f[496]), $dߝ굂); $this->_lockParent($d䐄, array($f[495], $f[497]), $dߝ굂); goto Eɫа; Eɫа: $this->_lockEvent($d䐄, array($f[502], $f[498], $f[499]), $dߝ굂); goto B; Dڎ: $f =& $_SERVER[ȦÆ]; if (!$this->allowLock()) { return; } $dߝ굂 = 0; goto e٧; B: } private function _lockCheck($Bև, $c) { goto Bə; fϴ: $eȪ = array_reverse($this->parentLevelArray($E[$dͷ[464]])); foreach ($eȪ as $D՛Ã) { $A߾Ԟ = $Bև . $dͷ[504] . $D՛Ã; if (CacheLock::lockGet($dͷ[505] . $A߾Ԟ)) { $E = $this->sourceInfo($D՛Ã); CacheLock::setErrorMsg($dͷ[163] . htmlspecialchars($E[$dͷ[38]]) . $dͷ[481] . $bڜ); $this->_lockKey($A߾Ԟ, 1); $this->_lockKey($A߾Ԟ, 0); } } goto fل列; Cܠ: $this->_lockTimeStart[$A߾Ԟ] = timeFloat(); if (!is_array($E)) { return; } $bڜ = LNG($dͷ[503]); goto B; B: CacheLock::setErrorMsg($dͷ[163] . htmlspecialchars($E[$dͷ[38]]) . $dͷ[481] . $bڜ); $this->_lockKey($A߾Ԟ, 1); $this->_lockKey($A߾Ԟ, 0); goto fϴ; Bə: $dͷ =& $_SERVER[ȦÆ]; $E = $this->sourceInfo($c); $A߾Ԟ = $Bև . $dͷ[101] . $c; goto Cܠ; fل列: } private function _lockCheckEnd($DⒿ, $cŐ) { goto eϹ; c: if ($e > 0.5) { unset(self::$cacheSourceInfo[$eޟ[415] . $cŐ]); } $cȅ՝ = $this->sourceInfo($cŐ); if (!$cȅ՝) { show_json(LNG($eޟ[110]), !1); } goto E۽; aǼ: if (!isset($this->_lockTimeStart[$Eވ㉇])) { return; } $e = timeFloat() - $this->_lockTimeStart[$Eވ㉇]; unset($this->_lockTimeStart[$Eވ㉇]); goto c; eϹ: $eޟ =& $_SERVER[ȦÆ]; $Eވ㉇ = $DⒿ . $eޟ[101] . $cŐ; CacheLock::setErrorMsg($eޟ[366]); goto aǼ; E۽: } private function _lockParent($D̮⇵, $Bߡ, $CѓӐ) { if (!$this->autoLockSet) { return; } $Dź = $this->sourceInfo($D̮⇵); if (!is_array($Dź)) { return; } $AۮҨ = array_reverse($this->parentLevelArray($Dź[$_SERVER[ȦÆ][464]])); foreach ($AۮҨ as $Aٵ) { $this->_lockEvent($Aٵ, $Bߡ, $CѓӐ); } } private function _lockEvent($aҨ, $FǑԊ, $E빢) { $a =& $_SERVER[ȦÆ]; if (!$this->autoLockSet) { return; } foreach ($FǑԊ as $D) { $BϘ = $D . $a[101] . $aҨ; if ($E빢 && CacheLock::lockGet($a[505] . $BϘ)) { continue; } $this->_lockKey($BϘ, $E빢); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($B꒭ָ, $A󫗊 = 1) { $Fߨ = $_SERVER[ȦÆ][505] . md5($B꒭ָ); if ($A󫗊) { if (isset(self::$_lockItemArr[$Fߨ])) { return; } self::$_lockItemArr[$Fߨ] = 1; CacheLock::lock($Fߨ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Fߨ])) { return; } unset(self::$_lockItemArr[$Fߨ]); CacheLock::unlock($Fߨ); } } public function isParentOf($bǑ, $A) { goto Fٜ; Fٜ: $FĿ =& $_SERVER[ȦÆ]; $D = $this->sourceInfo($bǑ); $Eڴ = $this->sourceInfo($A); goto aƥ; aƥ: $c = $D[$FĿ[464]] . $D[$FĿ[374]] . $FĿ[57]; $E = $Eڴ[$FĿ[464]] . $Eڴ[$FĿ[374]] . $FĿ[57]; $EΞ = strpos($E, $c) === 0; goto c; c: return $EΞ; goto cɯ; cɯ: } private $targetIsDelete = 0; public function copy($f, $cԦ榯, $bص = REPEAT_REPLACE, $aǼН = '') { goto Dֳ; Dʐ: $this->targetIsDelete = intval($fު[$aтݐ[402]]); $d = $this->fileNameExistCache($cԦ榯, $fު[$aтݐ[38]]); $C = $this->_copy($f, $cԦ榯, $bص, $a铼, !0, $aǼН); goto cĉ; Dи: $this->saveAll($a铼[$aтݐ[508]]); Model($aтݐ[173])->linkAdd($a铼[$aтݐ[506]]); $this->folderSizeReset($cԦ榯); goto Bֳ; cĉ: $this->_childrenListClear(); $this->lockCopyEnd($f); $this->lockWriteEnd($cԦ榯, $c򚪉); goto b̪ĉ; Bֳ: $this->updateModifyTime($cԦ榯); return $C; goto D߾; b̪ĉ: if ($fު[$aтݐ[375]] == $aтݐ[93] && $d == $C) { $this->folderSizeResetChildren($d); } Model($aтݐ[509])->addAll($a铼[$aтݐ[507]], array(), !0); if ($d != $C || $fު[$aтݐ[375]] == $aтݐ[93]) { Model($aтݐ[510])->eventCopy($C); } goto Dи; fǍٝ: $this->lockCopyStart($f); $this->lockWriteStart($cԦ榯, $c򚪉); $a铼 = array($aтݐ[506] => array(), $aтݐ[507] => array(), $aтݐ[508] => array()); goto Dʐ; aЋ: if (!$fު || !$A矊 || $A矊[$aтݐ[375]] != $aтݐ[93]) { return !1; } if ($this->isParentOf($f, $cԦ榯)) { return !1; } $c򚪉 = $aǼН ? $aǼН : $fު[$aтݐ[38]]; goto fǍٝ; Dֳ: $aтݐ =& $_SERVER[ȦÆ]; $fު = $this->sourceInfo($f); $A矊 = $this->sourceInfo($cԦ榯); goto aЋ; D߾: } private function _copy($c݆, $cͩÃ, $Bڐ, &$A׫, $AՅ͆, $A = '') { goto C砘; C砘: $f =& $_SERVER[ȦÆ]; $cʓ = $this->sourceInfoCache($c݆); $F = $cʓ[$f[375]] == $f[93]; goto bٟˑ; fب: if (!$fʡ) { return $this->_copyCreate($c݆, $cͩÃ, $fٵǷ, $A׫); } $C = $fʡ; if ($F) { if ($Bڐ == REPEAT_RENAME_FOLDER) { $fٵǷ = $this->fileNameAutoCache($cͩÃ, $fٵǷ, $Bڐ, $F); $C = $this->_copyCreate($c݆, $cͩÃ, $fٵǷ, $A׫); } else { $dА = $this->_childrenList($c݆); foreach ($dА as $fƩ) { $this->_copy($fƩ[$f[374]], $fʡ, $Bڐ, $A׫, !1); } } } else { if ($Bڐ == REPEAT_RENAME || $Bڐ == REPEAT_RENAME_FOLDER) { $fٵǷ = $this->fileNameAutoCache($cͩÃ, $fٵǷ, $Bڐ, $F); $C = $this->_copyCreate($c݆, $cͩÃ, $fٵǷ, $A׫); } else { if ($Bڐ == REPEAT_REPLACE) { $A鵞 = $this->sourceInfoCache($fʡ); $aϨ = $this->fileHistory($A鵞, $cʓ[$f[424]], $cʓ[$f[87]]); if ($aϨ) { $A׫[$f[506]][] = $cʓ[$f[424]]; } } else { if ($Bڐ == REPEAT_SKIP) { } } } Hook::trigger($f[511], array($f[512], $cʓ, 0)); } goto C﯅ؚ; bٟˑ: $fٵǷ = $A ? $A : $cʓ[$f[38]]; $fʡ = $this->fileNameExistCache($cͩÃ, $fٵǷ); if ($AՅ͆) { $this->_childrenAllMake($c݆); if ($F && $fʡ) { $this->_childrenAllMake($fʡ); } } goto fب; C﯅ؚ: return $C; goto F; F: } private function _copyCreate($c, $f, $Eῗ, &$b̫) { goto a̲; b: $this->addAll($bڇ娷, array(), !1); $f = $this->where(array($cϹ[466] => $c))->select(); $fઅ = $this->_childrenMakeRelation($E䏰, $f); goto eԪ; dօ: $B = $this->_makeItemData($fꙟ, $f, $Eῗ); Hook::trigger($cϹ[513], $B); Hook::trigger($cϹ[514], array($cϹ[515], $B, 0)); goto A; E: $A = $this->sourceInfo($c); foreach ($E䏰 as $AŲ) { $C = $this->_makeItemData($AŲ, $A, $AŲ[$cϹ[38]]); $C[$cϹ[464]] = $AŲ[$cϹ[464]]; $bڇ娷[] = $C; } $this->chunkEventSet($cϹ[516], array($cϹ[517], $B, $b𦔎)); goto b; fꄏ: $this->chunkEventSet($cϹ[520], array($cϹ[521], $B, $b𦔎)); $this->saveAll($eÚ); return $c; goto E; aۈ: foreach ($f as $AŲ) { $fӬ = $AŲ[$cϹ[374]]; $e蟃 = $this->_childrenMatch($fઅ, $AŲ, $A); $E̷׽[] = array($cϹ[374], $fӬ, $cϹ[466], $e蟃[$cϹ[466]]); $eÚ[] = array($cϹ[374], $fӬ, $cϹ[464], $e蟃[$cϹ[464]]); $this->_copyApplyMeta($AŲ, $b̫); if ($AŲ[$cϹ[375]] != $cϹ[93]) { $b̫[$cϹ[506]][] = $AŲ[$cϹ[424]]; } } $this->chunkEventSet($cϹ[518], array($cϹ[519], $B, $b𦔎)); $this->saveAll($E̷׽); goto fꄏ; eԪ: $fઅ[$c] = $c; $E̷׽ = array(); $eÚ = array(); goto aۈ; A: $c = $this->add($B); $b׈ = array($cϹ[374] => $c, $cϹ[38] => $Eῗ); $this->_copyApplyMeta($b׈, $b̫); goto A; eâԅ: $this->_childrenListAll($c, $E䏰); $b𦔎 = count($E䏰); if ($b𦔎 == 0) { return $c; } goto E; A: if ($fꙟ[$cϹ[375]] != $cϹ[93]) { $b̫[$cϹ[506]][] = $fꙟ[$cϹ[424]]; return $c; } $E䏰 = array(); $bڇ娷 = array(); goto eâԅ; a̲: $cϹ =& $_SERVER[ȦÆ]; $fꙟ = $this->sourceInfoCache($c); $f = $this->sourceInfoCache($f); goto dօ; E: } private function _childrenMakeRelation($dް戝, $CՂ) { $cˣ =& $_SERVER[ȦÆ]; $f = array(); $Aʦ = array(); foreach ($dް戝 as $f) { $cҤ = $f[$cˣ[38]] . $cˣ[18] . $f[$cˣ[464]]; $f[$cҤ] = $f[$cˣ[374]]; } foreach ($CՂ as $f) { $cҤ = $f[$cˣ[38]] . $cˣ[18] . $f[$cˣ[464]]; $fӍҫ = $f[$cҤ]; $Aʦ[$fӍҫ] = $f[$cˣ[374]]; } return $Aʦ; } private function _childrenMatch($cȒ, $A྅, $Aݶҵ) { goto b; b: $C䰿 =& $_SERVER[ȦÆ]; $Fȶԇ蓶 = $Aݶҵ[$C䰿[464]]; $b = $this->parentLevelArray($A྅[$C䰿[464]]); goto B; EӋ: $B̢ = $DŐ[count($DŐ) - 1]; return array($C䰿[466] => $B̢, $C䰿[464] => $Fȶԇ蓶); goto D΄י; B: foreach ($b as $C) { if (isset($cȒ[$C])) { $Fȶԇ蓶 .= $cȒ[$C] . $C䰿[522]; } } $Fȶԇ蓶 = rtrim($Fȶԇ蓶, $C䰿[57]) . $C䰿[57]; $DŐ = $this->parentLevelArray($Fȶԇ蓶); goto EӋ; D΄י: } private function _makeItemData($b, $D, $Dڲ) { $Fʂ =& $_SERVER[ȦÆ]; $CÚ = array($Fʂ[523] => $b[$Fʂ[375]], $Fʂ[391] => $Dڲ, $Fʂ[524] => $b[$Fʂ[377]], $Fʂ[425] => $b[$Fʂ[424]], $Fʂ[525] => $b[$Fʂ[87]], $Fʂ[526] => $D[$Fʂ[376]], $Fʂ[527] => $D[$Fʂ[461]], $Fʂ[528] => USER_ID, $Fʂ[529] => USER_ID, $Fʂ[373] => $D[$Fʂ[374]], $Fʂ[530] => $D[$Fʂ[464]] . $D[$Fʂ[374]] . $Fʂ[57], $Fʂ[401] => 0, $Fʂ[531] => $Fʂ[43]); return $CÚ; } private function _copyApplyMeta($Bʫ, &$D堞) { $Dȇ =& $_SERVER[ȦÆ]; $d« = $Bʫ[$Dȇ[374]]; $d۹ = $Bʫ[$Dȇ[38]]; if (!isset($Bʫ[$Dȇ[532]]) || !$Bʫ[$Dȇ[532]] || $Bʫ[$Dȇ[532]] == $Dȇ[473]) { $D堞[$Dȇ[508]][] = array($Dȇ[374], $d«, $Dȇ[532], short_id($d«)); } if (Input::check($d۹, $Dȇ[533])) { $D堞[$Dȇ[507]][] = array($Dȇ[374] => $d«, $Dȇ[99] => $Dȇ[421], $Dȇ[364] => str_replace($Dȇ[60], $Dȇ[43], Pinyin::encode($d۹))); $D堞[$Dȇ[507]][] = array($Dȇ[374] => $d«, $Dȇ[99] => $Dȇ[420], $Dȇ[364] => Pinyin::encode($d۹, $Dȇ[534])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($dς) { goto aׯ; Dˉ: $A = array_to_keyvalue($A, $e痹[374]); foreach ($A as $e) { $dɉգ = $e[$e痹[466]]; $dς = $e[$e痹[374]]; if (!isset($this->_childrenListCache[$dς]) && $e[$e痹[375]] == $e痹[93]) { $this->_childrenListCache[$dς] = array(); } if (!isset($this->_childrenListCache[$dɉգ])) { $this->_childrenListCache[$dɉգ] = array(); } $this->_childrenListCache[$dɉգ][$dς] = $e; $this->_childrenItemCache[$dς] = $e; } goto eȼ󊘨; B: $EĆ = array($e痹[464] => array($e痹[488], $C[$e痹[464]] . $dς . $e痹[489]), $e痹[402] => $this->targetIsDelete); $A = $this->field($f²)->where($EĆ)->select(); if (!$A) { return; } goto Dˉ; aׯ: $e痹 =& $_SERVER[ȦÆ]; $C = $this->sourceInfo($dς); $f² = $e痹[535]; goto B; eȼ󊘨: } private function _childrenListAll($e, &$F) { $E͢ =& $_SERVER[ȦÆ]; if (!isset($this->_childrenListCache[$e])) { return; } $C = $this->_childrenListCache[$e]; foreach ($C as $cě => $C鞛) { $F[$cě] = $C鞛; if ($C鞛[$E͢[375]] == $E͢[93]) { $this->_childrenListAll($cě, $F); } } } private function sourceInfoCache($d) { if (isset($this->_childrenItemCache[$d])) { return $this->_childrenItemCache[$d]; } return $this->sourceInfo($d); } private function _childrenList($b) { if (isset($this->_childrenListCache[$b])) { return $this->_childrenListCache[$b]; } return $this->_childrenListSelect($b); } private function _childrenListSelect($Bٜ) { goto Eݖ; A³: foreach ($Aґʳ as $Bٜ => $b) { $this->_childrenItemCache[$Bٜ] = $b; } return $Aґʳ; goto Dڬ; Eݖ: $D =& $_SERVER[ȦÆ]; $E۬ = array($D[466] => $Bٜ, $D[402] => $this->targetIsDelete); $f = $this->where($E۬)->select(); goto Cً΂; Cً΂: $f = $f ? $f : array(); $Aґʳ = array_to_keyvalue($f, $D[374]); $this->_childrenListCache[$Bٜ] = $Aґʳ; goto A³; Dڬ: } private function fileNameExistCache($d, $AÔ) { $E֡Ɵ =& $_SERVER[ȦÆ]; $AÔ = strtolower($AÔ); $C = $this->_childrenList($d); foreach ($C as $fɎ) { if ($AÔ == strtolower($fɎ[$E֡Ɵ[38]])) { return $fɎ[$E֡Ɵ[374]]; } } return !1; } private function fileNameAutoCache($Eև, $aՉ, $fᢚĆ, $d㊎Ʉ) { $b =& $_SERVER[ȦÆ]; $f傅 = $this->_childrenList($Eև); $c = array_to_keyvalue($f傅, $b[43], $b[38]); return $this->fileNameAutoGet($c, $aՉ, $fᢚĆ, $d㊎Ʉ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($A䤎, $B, $B鱍 = REPEAT_REPLACE, $f = '') { goto b; Cȧ: $a = $this->pathInfoMore($A䤎); if ($this->isParentOf($A䤎, $B)) { return !1; } if (!$eđĉİ || !$bӉ || $bӉ[$DϏ[375]] != $DϏ[93]) { return !1; } goto D; fƫӈ: $C = array($DϏ[506] => array(), $DϏ[538] => !1); $this->clearShare($A䤎, $B); $DÌ = $this->fileNameExistCache($B, $eđĉİ[$DϏ[38]]); goto C; b: $DϏ =& $_SERVER[ȦÆ]; $eđĉİ = $this->sourceInfo($A䤎); $bӉ = $this->sourceInfo($B); goto Cȧ; D: Hook::trigger($DϏ[536], $a); $this->targetIsDelete = intval($eđĉİ[$DϏ[402]]); if ($eđĉİ[$DϏ[466]] == $B && $f != $eđĉİ[$DϏ[38]]) { $cÌǗ = $this->fileNameExist($B, $f); if ($cÌǗ && $eđĉİ[$DϏ[375]] == $DϏ[473]) { goto d; c: $this->removeNow($A䤎, !1); $this->folderSizeReset($B); Hook::trigger($DϏ[537], $a); goto dݕ; d: $e冟أ = $this->sourceInfo($cÌǗ); $e̎ = $this->fileHistory($e冟أ, $eđĉİ[$DϏ[424]], $eđĉİ[$DϏ[87]]); if (!$e̎) { Model($DϏ[427])->remove($eđĉİ[$DϏ[424]]); } goto c; dݕ: return $cÌǗ; goto eȍ; eȍ: } } goto Dл; Aθ: Model($DϏ[173])->linkAdd($C[$DϏ[506]]); if ($DÌ && $C[$DϏ[538]]) { $this->removeNow($A䤎, !1); } $this->lockMoveEnd($A䤎); goto f; f: $this->lockWriteEnd($B, $D); $this->folderSizeReset($eđĉİ[$DϏ[466]]); $this->folderSizeReset($B); goto B; Dл: $D = $f ? $f : $eđĉİ[$DϏ[38]]; $this->lockMoveStart($A䤎); $this->lockWriteStart($B, $D); goto fƫӈ; B: $bƉų = array($eđĉİ[$DϏ[466]], $B); if ($eđĉİ[$DϏ[375]] == $DϏ[93]) { $bƉų[] = $A䤎; } $this->updateModifyTime($bƉų); goto a닲; C: $F = $this->_move($A䤎, $B, $B鱍, $C, $f); $this->sourceCacheClear(); if ($eđĉİ[$DϏ[375]] == $DϏ[93] && $DÌ) { $this->folderSizeResetChildren($F); } goto Aθ; a닲: Model($DϏ[510])->eventMove($A䤎, $eđĉİ[$DϏ[466]], $B); Hook::trigger($DϏ[537], $a); return $F; goto D; D: } private function _move($aÇě, $bޏ, $E۟, &$Aś, $FԖĻ = '') { goto dׄ; D޵: return $eº; goto FΒ΂; DзҞ: $Fն = !1; if ($D) { if ($E۟ == REPEAT_RENAME_FOLDER) { $B = $this->fileNameAuto($bޏ, $B, $E۟, $D); $eº = $this->_moveForce($aÇě, $bޏ, $B); } else { if ($E۟ == REPEAT_RENAME_FOLDER) { $E۟ = REPEAT_RENAME; } $Cӑʞ = $this->_childrenListSelect($aÇě); foreach ($Cӑʞ as $Eֈ̻) { $this->_move($Eֈ̻[$A[374]], $Cָӊ, $E۟, $Aś); } $Fն = !0; } } else { if ($E۟ == REPEAT_SKIP) { $Fն = !0; } else { if ($E۟ == REPEAT_RENAME || $E۟ == REPEAT_RENAME_FOLDER) { $B = $this->fileNameAuto($bޏ, $B, $E۟, $D); $eº = $this->_moveForce($aÇě, $bޏ, $B); } else { if ($E۟ == REPEAT_REPLACE) { $e؎ = $this->sourceInfoCache($Cָӊ); $Fʓ = $this->fileHistory($e؎, $C[$A[424]], $C[$A[87]]); if ($Fʓ) { $Aś[$A[506]][] = $C[$A[424]]; } else { $Fն = !0; } } } } } if ($Fն && !$Aś[$A[538]]) { $Aś[$A[538]] = !0; } goto D޵; dׄ: $A =& $_SERVER[ȦÆ]; $C = $this->sourceInfo($aÇě); $D = $C[$A[375]] == $A[93]; goto Dʌ; b: $this->lockWriteStart($bޏ, $B); if (!$Cָӊ) { return $this->_moveForce($aÇě, $bޏ, $B); } $eº = $Cָӊ; goto DзҞ; Dʌ: $B = $FԖĻ ? $FԖĻ : $C[$A[38]]; $Cָӊ = $this->fileNameExistCache($bޏ, $B); $this->lockMoveStart($aÇě); goto b; FΒ΂: } private function _moveForce($cע, $Eۡ, $a֪) { goto aߑԉ; aߑԉ: $Fϓ =& $_SERVER[ȦÆ]; $a֐Њ = $this->sourceInfo($cע); $Aּڐ = $this->sourceInfo($Eۡ); goto fʌŨ; fʌŨ: $c٭܈ = $a֐Њ[$Fϓ[375]] == $Fϓ[93]; $a = array($Fϓ[373] => $Aּڐ[$Fϓ[374]], $Fϓ[530] => $Aּڐ[$Fϓ[464]] . $Aּڐ[$Fϓ[374]] . $Fϓ[57], $Fϓ[526] => $Aּڐ[$Fϓ[376]], $Fϓ[527] => $Aּڐ[$Fϓ[461]], $Fϓ[529] => USER_ID, $Fϓ[391] => $a֪); $Cޑ = $a֐Њ[$Fϓ[376]] == SourceModel::TYPE_GROUP && $Aּڐ[$Fϓ[376]] == SourceModel::TYPE_GROUP && $a֐Њ[$Fϓ[461]] == $Aּڐ[$Fϓ[461]]; goto Cۘ; Cۘ: if (!$Cޑ) { Model($Fϓ[459])->authClear($cע); } $Dϑ = $a֐Њ[$Fϓ[402]] == $Fϓ[93] && $Aּڐ[$Fϓ[402]] != $Fϓ[93]; if ($Dϑ) { $a[$Fϓ[401]] = 0; } goto b; b: if ($c٭܈) { $Bԯ = array($Fϓ[530] => array($Fϓ[488], $a֐Њ[$Fϓ[464]] . $a֐Њ[$Fϓ[374]] . $Fϓ[489])); $f㞻 = $a֐Њ[$Fϓ[464]] . $a֐Њ[$Fϓ[374]] . $Fϓ[57]; $Bޞ = $Aּڐ[$Fϓ[464]] . $Aּڐ[$Fϓ[374]] . $Fϓ[57] . $a֐Њ[$Fϓ[374]] . $Fϓ[57]; $e墮 = array($Fϓ[530] => array($Fϓ[539], "\162\145\x70\x6c\141\x63\145\50\160\x61\x72\x65\156\164\x4c\x65\166\x65\x6c\x2c\47{$f㞻}\47\54\47{$Bޞ}\47\x29"), $Fϓ[526] => $Aּڐ[$Fϓ[376]], $Fϓ[527] => $Aּڐ[$Fϓ[461]]); if ($Dϑ) { $e墮[$Fϓ[401]] = 0; } $this->where($Bԯ)->data($e墮)->save(); } $this->where(array($Fϓ[388] => $cע))->data($a)->save(); return $cע; goto a̫; a̫: } private function clearShare($aڤӸ, $F̨) { goto d; Eچ: if (!$CЄ) { return; } $CЄ = array_to_keyvalue($CЄ, $f։[43], $f։[446]); $a = array($f։[446] => array($f։[17], $CЄ)); goto B䄘; B䄘: Model($f։[541])->where($a)->save(array($f։[453] => 0)); Model($f։[542])->where($a)->delete(); goto B錆Ϲ; e´Ό: if (!$eė) { return; } $a = array($f։[374] => array($f։[17], $eė), $f։[453] => 1); $CЄ = Model($f։[541])->field($f։[446])->where($a)->select(); goto Eچ; d: $f։ =& $_SERVER[ȦÆ]; $F߈ = $this->sourceInfo($aڤӸ); $cĿ = $this->sourceInfo($F̨); goto fԥ; fԥ: if ($F߈[$f։[461]] == $cĿ[$f։[461]] && $F߈[$f։[376]] == $f։[540]) { return; } $a = array($f։[464] => array($f։[488], $F߈[$f։[464]] . $aڤӸ . $f։[489])); $eė = $this->field($f։[388])->where($a)->getField($f։[374], !0); goto e´Ό; B錆Ϲ: } public function copyFolderFromIO($c⟐, $Eҟ̯, $c߈ݻ, $E܉, $DՑж, $DȚ꫒ = false) { goto e; f: if ($D鏍) { $this->_childrenAllMake($D鏍); } Hook::trigger($a[544]); $this->_copyChildTo($c⟐, $Eҟ̯, $bΑ쑓, $E܉, $d, $DՑж); goto D窕̬; C𧨈ʼ: Model($a[427])->linkAdd($d[$a[506]]); Model($a[427])->remove($d[$a[543]]); $this->folderSizeReset($c߈ݻ); goto B篃; B篃: $this->updateModifyTime($c߈ݻ); return $bΑ쑓; goto a旵; a: Model($a[509])->addAll($d[$a[507]], array(), !0); Model($a[510])->eventCopy($bΑ쑓); $this->saveAll($d[$a[508]]); goto C𧨈ʼ; cõ: $D鏍 = $this->fileNameExist($c߈ݻ, $BǞ쎳); $bΑ쑓 = $this->mkdir($c߈ݻ, $BǞ쎳, $E܉); if (!$D鏍 || $E܉ == REPEAT_RENAME_FOLDER) { $E܉ = !1; } goto f; e: $a =& $_SERVER[ȦÆ]; $d = array($a[507] => array(), $a[508] => array(), $a[506] => array(), $a[543] => array()); $BǞ쎳 = $DȚ꫒ ? $DȚ꫒ : $c⟐->getPathName($c⟐->pathThis($Eҟ̯)); goto cõ; D窕̬: Hook::trigger($a[545]); if ($bΑ쑓) { $this->folderSizeResetChildren($bΑ쑓); } $this->_childrenListClear(); goto a; a旵: } private function _copyChildTo($EΌ, $F, $FÅ, $eǷ, &$Aʽ, $Bϊ) { goto cо; Bɳܮ: $dŭ = $this->_childrenList($FÅ); $dŭ = array_to_keyvalue($dŭ, $F[38]); foreach ($f as $FՂ) { $D = $dŭ[$FՂ[$F[38]]]; $Aۨ = $D[$F[374]]; $this->_copyApplyMeta($D, $Aʽ); if ($FՂ[$F[39]] == $F[86]) { $FՂ[$F[85]] = $EΌ->getPathInner($FՂ[$F[85]]); $this->_copyChildTo($EΌ, $FՂ[$F[85]], $Aۨ, $eǷ, $Aʽ, $Bϊ); } } goto e; Eٵ˪: foreach ($f as &$FՂ) { goto f̐; Dॽ: $FՂ[$F[87]] = _get($FՂ, $F[87], 0); $FՂ[$F[424]] = _get($FՂ, $F[424], 0); if (!isset($FՂ[$F[546]]) && $FՂ[$F[424]]) { $Aʽ[$F[543]][] = $FՂ[$F[424]]; } goto Eޑ; Eޑ: if ($eǷ) { $A = $this->fileNameExistCache($FÅ, $FՂ[$F[38]]); if ($A) { if ($FՂ[$F[375]] || $eǷ == REPEAT_SKIP) { continue; } if ($eǷ == REPEAT_REPLACE) { $D = $this->sourceInfoCache($A); $F򓽜 = $this->fileHistory($D, $FՂ[$F[424]], $FՂ[$F[87]]); if ($F򓽜) { $Aʽ[$F[506]][] = $FՂ[$F[424]]; } continue; } else { if ($eǷ == REPEAT_RENAME) { $FՂ[$F[38]] = $this->fileNameAutoCache($FÅ, $FՂ[$F[38]], $eǷ, !1); } } } } if (!$FՂ[$F[375]] && $FՂ[$F[424]]) { $Aʽ[$F[506]][] = $FՂ[$F[424]]; } $fښ[] = $this->_makeItemData($FՂ, $cǩ, $FՂ[$F[38]]); goto B; f̐: if (isset($bޢ[$FՂ[$F[38]]])) { $FՂ = $bޢ[$FՂ[$F[38]]]; } $FՂ[$F[375]] = $FՂ[$F[39]] == $F[86]; $FՂ[$F[377]] = _get($FՂ, $F[166], $F[43]); goto Dॽ; B: } unset($FՂ); if (!empty($fښ)) { $this->addAll($fښ); } goto Bɳܮ; EÍ: $f = array_merge($d򂾊[$F[83]], $d򂾊[$F[84]]); $bޢ = $this->_addFiles($EΌ, $d򂾊[$F[83]], $Bϊ); $fښ = array(); goto Eٵ˪; cо: $F =& $_SERVER[ȦÆ]; $cǩ = $this->sourceInfoCache($FÅ); $d򂾊 = $EΌ->listPath($F, !1, !0); goto EÍ; e: } private function _addFiles($F֯, $B, $Cޖ㊬) { goto e꿊; e: foreach ($B as &$f¼) { goto F晖; C彃: $d∼ = $F֯->hashMd5($f¼[$e[85]]); if (strlen($d∼) > 10 && !isset($cŉ[$d∼])) { $cŉ[$d∼] = array(); } $f¼[$e[170]] = $Cӝ; goto c; fՋ: if (count($cŉ[$d∼]) > 1) { $f¼[$e[546]] = !0; } goto a䯝; c: $f¼[$e[169]] = $d∼; Hook::trigger($e[548], $f¼); $cŉ[$d∼][] =& $f¼; goto fՋ; F晖: Hook::trigger($e[547], $f¼); $f¼[$e[85]] = $F֯->getPathInner($f¼[$e[85]]); $Cӝ = $F֯->hashSimple($f¼[$e[85]]); goto C彃; a䯝: } $cע = array($e[169] => array($e[17], array_keys($cŉ))); $d׾ = Model($e[549]); goto bԧ; b: return $A; goto D; D׊ꑛ: foreach ($eҬ as $BƔ) { if (!isset($cŉ[$BƔ[$e[169]]])) { continue; } $e뙜 =& $cŉ[$BƔ[$e[169]]]; foreach ($e뙜 as &$f¼) { $f¼[$e[424]] = $BƔ[$e[424]]; } unset($f¼); } $A = array(); foreach ($B as $c) { $A[$c[$e[38]]] = $c; } goto b; a: $cע = array($e[169] => array($e[17], array_keys($cŉ))); $eҬ = $d׾->where($cע)->select(); $eҬ = $eҬ ? $eҬ : array(); goto D׊ꑛ; e꿊: $e =& $_SERVER[ȦÆ]; if (!$B || count($B) == 0) { return array(); } $cŉ = array(); goto e; bԧ: $eҬ = $d׾->where($cע)->select(); $eҬ = $eҬ ? $eҬ : array(); foreach ($eҬ as $BƔ) { if (!isset($cŉ[$BƔ[$e[169]]])) { continue; } $Aı = $cŉ[$BƔ[$e[169]]]; foreach ($Aı as &$f¼) { $f¼[$e[424]] = $BƔ[$e[424]]; $f¼[$e[546]] = !0; } unset($f¼); } goto B; B: $BĨώŶ = array(); foreach ($B as $B߱ӎ) { if (isset($B߱ӎ[$e[546]]) && $B߱ӎ[$e[546]]) { continue; } $Cݯ = $F֯->getPathInner($B߱ӎ[$e[85]]); $b = $d׾->addFileMake($Cݯ, $B߱ӎ[$e[87]], $B߱ӎ[$e[170]], $B߱ӎ[$e[169]], $B߱ӎ[$e[38]], $Cޖ㊬); $BĨώŶ[] = $b; } $d׾->addAll($BĨώŶ); goto a; D: } } define($_SERVER[ȦÆ][550], $_SERVER[ȦÆ][551]); goto B̸; aβ: class ZipStream { } class AnalysisModel extends ModelBaseLight { public function init($B݃) { $a͊ =& $_SERVER[ȦÆ]; $dԨ = array($a͊[540] => array($a͊[39] => $a͊[2000], $a͊[266] => array($a͊[216], $a͊[701], $a͊[2001], $a͊[2002])), $a͊[2003] => array($a͊[39] => $a͊[2004], $a͊[266] => array($a͊[216], $a͊[699], $a͊[2005], $a͊[2006], $a͊[2007]))); if (!isset($dԨ[$B݃])) { return !1; } $this->optionType = $dԨ[$B݃][$a͊[39]]; $this->field = $dԨ[$B݃][$a͊[266]]; return !0; } public function listData($e̞Ψ = false, $D = "\155\157\144\x69\146\171\x54\x69\155\x65", $f = false) { return parent::listData($e̞Ψ, $D, $f); } public function trendList($b杇ǣӋ) { goto b; b: $b =& $_SERVER[ȦÆ]; $c򊛸 = $this->listData(); if ($c򊛸) { $Aɉ = end($c򊛸); $Bؖ = date($b[2008], strtotime($b[2009])); if ($Aɉ[$b[216]] == $Bؖ) { return $c򊛸; } $fÈ = strtotime($Aɉ[$b[216]]); } goto eɯ; eɯ: if (!isset($fÈ)) { $Eɒ = $b杇ǣӋ == $b[540] ? $b[482] : $b[753]; $fÈ = Model($Eɒ)->min($b[193]); } $A̧ = $b[2010] . ucfirst($b杇ǣӋ); $b˄ = $this->dateList($fÈ); goto Fů; Fů: foreach ($b˄ as $Bؖ) { $this->{$A̧}($Bؖ); } return $this->listData(); goto C혲; C혲: } private function dateList($FǓ) { $Eؙ =& $_SERVER[ȦÆ]; $D = $FǓ; $dͶ = strtotime($Eؙ[2009]); $B贎 = array(); while ($D <= $dͶ) { $B贎[] = date($Eؙ[2008], $D); $D = strtotime($Eؙ[2011], $D); } return $B贎; } public function _recordUser($bޡ = '') { goto b; Cۨ: $D̷ = array($A䯰[216] => $bޡ, $A䯰[701] => (int) $a, $A䯰[2001] => (int) $b, $A䯰[2002] => (int) $č); return $this->insert($D̷); goto b˪; b: $A䯰 =& $_SERVER[ȦÆ]; $Dƅօ = strtotime(date($A䯰[2012], strtotime($bޡ))); $eϑ = strtotime(date($A䯰[2013], strtotime($bޡ))); goto Fۨ; a뼗φ: $b = Model($A䯰[482])->where($cґ)->count($A䯰[1412]); $cґ[$A䯰[39]] = $A䯰[2014]; $č = Model($A䯰[2015])->where($cґ)->count($A䯰[2016]); goto Cۨ; Fۨ: $cґ = array($A䯰[193] => array($A䯰[922], $eϑ)); $a = Model($A䯰[482])->where($cґ)->count($A䯰[1412]); $cґ[$A䯰[193]] = array($A䯰[326], array($Dƅօ, $eϑ)); goto a뼗φ; b˪: } public function _recordStore($e穛 = '') { goto a; fה: $fۺܑ = Model($Bᷪ[427])->where($e)->sum($Bᷪ[87]); $e[$Bᷪ[375]] = 0; $Cނ = Model($Bᷪ[753])->where($e)->sum($Bᷪ[87]); goto a̋ȩ; a: $Bᷪ =& $_SERVER[ȦÆ]; $bܑ = strtotime(date($Bᷪ[2013], strtotime($e穛))); $e = array($Bᷪ[193] => array($Bᷪ[922], $bܑ)); goto fה; c: $f싖 = Model($Bᷪ[753])->where($e)->sum($Bᷪ[87]); $C笸 = array($Bᷪ[216] => $e穛, $Bᷪ[699] => (int) $Cނ, $Bᷪ[2005] => (int) $fۺܑ, $Bᷪ[2006] => (int) $e, $Bᷪ[2007] => (int) $f싖); return $this->insert($C笸); goto F; a̋ȩ: $e[$Bᷪ[376]] = 1; $e = Model($Bᷪ[753])->where($e)->sum($Bᷪ[87]); $e[$Bᷪ[376]] = 2; goto c; F: } public function trend($Aʏ, $Aħ) { goto B·; B·: $Cާ =& $_SERVER[ȦÆ]; if (!$this->init($Aʏ)) { return !1; } $E = $this->trendList($Aʏ); goto Cބ; A߻: return $d̹; goto Eㅵ; Cބ: if ($E && $Aħ != $Cާ[1387]) { $cֳږ = $E[0][$Cާ[216]]; $fɥ = $this->validDate($Aħ, $cֳږ); $D߮ = array(); $Bџ = array_to_keyvalue($E, $Cާ[216]); foreach ($fɥ as $fĆ) { if (isset($Bџ[$fĆ])) { $F = $Bџ[$fĆ]; } else { $F = end($E); $F[$Cާ[216]] = $fĆ; if ($Aʏ == $Cާ[540]) { $F[$Cާ[2001]] = $F[$Cާ[2002]] = 0; } } $D߮[] = $F; } $E = $D߮; } $c򻉇 = array($Cާ[540] => array($Cާ[701] => LNG($Cާ[2017]), $Cާ[2001] => LNG($Cާ[2018]), $Cާ[2002] => LNG($Cާ[2019])), $Cާ[2003] => array($Cާ[699] => LNG($Cާ[2020]), $Cާ[2005] => LNG($Cާ[2021]), $Cާ[2006] => LNG($Cާ[2022]), $Cާ[2007] => LNG($Cާ[2023]))); $bʅ = array($Cާ[540] => $Cާ[2024], $Cާ[2003] => $Cާ[87]); goto Bɔ; Bɔ: if (empty($E)) { $fĆ = date($Cާ[2008], strtotime($Cާ[2009])); $Dͅ = array($Cާ[216] => $fĆ); foreach ($c򻉇[$Aʏ] as $D⹛ => $Bή) { $Dͅ[$D⹛] = 0; } $E[] = $Dͅ; } $d̹ = array(); foreach ($E as $Bή) { if ($Aʏ == $Cާ[2003] && $Bή[$Cާ[2005]] > $Bή[$Cާ[699]]) { $Bή[$Cާ[2005]] = $Bή[$Cާ[699]]; } foreach ($c򻉇[$Aʏ] as $D⹛ => $Fْ΢) { $F = array($Cާ[216] => $Bή[$Cާ[216]], $Cާ[1320] => $Fْ΢); $F[$bʅ[$Aʏ]] = isset($Bή[$D⹛]) ? $Bή[$D⹛] : 0; $d̹[] = $F; } } goto A߻; Eㅵ: } public function validDate($eȾ, $e) { goto b; b: $f =& $_SERVER[ȦÆ]; $Dֵ = date($f[2008], strtotime($f[2009])); $F뜷 = array($Dֵ); goto B; B̏Ƶ: return $F뜷; goto Dׂ; B: switch ($eȾ) { case $f[1394]: $fᔭá = mktime(0, 0, 0, date($f[2025]), date($f[2026]) - date($f[1212]) + 7 - 7, date($f[2027])); $C衠 = 0; do { $f߂ = date($f[2008], $fᔭá - 3600 * 24 * 7 * $C衠); $F뜷[] = $f߂; $C衠++; } while ($e < $f߂); break; case $f[1392]: $C衠 = 1; do { $D = date($f[2028], strtotime("\x2d\x20{$C衠}\x20\x6d\x6f\x6e\x74\x68\163")); $F뜷[] = $D; $C衠++; } while ($e < $D); break; case $f[1696]: $Că = (int) date($f[2027], strtotime($e)); $C = (int) date($f[2027]); if ($Că >= $C) { break; } for ($Că; $Că < $C; $Că++) { $F뜷[] = $Că . $f[2029]; } break; default: break; } if ($e > end($F뜷)) { array_pop($F뜷); } sort($F뜷); goto B̏Ƶ; Dׂ: } public function listTable($a֠) { $C򅖣 = ucfirst($a֠); return Model($C򅖣)->listData(); } public function option($a) { $aɖ = $_SERVER[ȦÆ][2030] . ucfirst($a); return $this->{$aɖ}(); } private function optionUser() { goto d; Bކ: $a҇ڎ = strtotime($E犵[2032]); $aːߝ = array($E犵[2033] => array($E犵[923], $a҇ڎ)); $d = (int) Model($E犵[482])->where($aːߝ)->count($E犵[1412]); goto AҔ; d: $E犵 =& $_SERVER[ȦÆ]; $E᱌ = Model($E犵[482])->count($E犵[1412]); $eЈ֧ޚ = Model($E犵[482])->where($E犵[2031])->count($E犵[1412]); goto Bކ; Aߓ: $f = Model($E犵[482])->where($aːߝ)->count($E犵[1412]); return array($E犵[696] => (int) $E᱌, $E犵[2034] => (int) ($E᱌ - $eЈ֧ޚ), $E犵[2035] => (int) $eЈ֧ޚ, $E犵[2036] => (int) $f, $E犵[2037] => $d); goto Cᥢ; AҔ: if (!$d) { $d = 1; } $a҇ڎ = strtotime(date($E犵[2012])); $aːߝ = array($E犵[2033] => array($E犵[923], $a҇ڎ)); goto Aߓ; Cᥢ: } private function optionFile() { goto fЫإ; fЫإ: $A =& $_SERVER[ȦÆ]; $A = $this->sourceSize(); $AÕʹ = $A[$A[87]]; goto b; b: $Cǋ = $A[$A[2005]]; $ḟ = Model($A[753])->where(array($A[375] => 0))->count($A[374]); $b┏Ҍ = array($A[375] => 0, $A[193] => array($A[923], strtotime(date($A[2012])))); goto e; e: $fϼ = Model($A[753])->where($b┏Ҍ)->sum($A[87]); $F = Model($A[753])->where($b┏Ҍ)->count($A[374]); return array($A[699] => $AÕʹ, $A[2005] => $Cǋ, $A[2038] => $AÕʹ - $Cǋ, $A[2039] => (int) $fϼ, $A[701] => (int) $ḟ, $A[2040] => (int) $F); goto Eϟ; Eϟ: } private function optionAccess() { $AȢ˂ =& $_SERVER[ȦÆ]; return array($AȢ˂[696] => $this->typeLogCnt(), $AȢ˂[112] => $this->typeLogCnt($AȢ˂[112]), $AȢ˂[409] => $this->typeLogCnt($AȢ˂[409]), $AȢ˂[2041] => $this->typeLogCnt($AȢ˂[2041]), $AȢ˂[2042] => $this->typeLogCnt($AȢ˂[2042]), $AȢ˂[540] => $this->typeLogCnt($AȢ˂[43], $AȢ˂[2016])); } private function typeLogCnt($C򌟚 = '', $D밆 = "\x69\x64") { goto B; e񘖤: $FƂ = array($C܅[193] => array($C܅[923], $D˅)); if ($C򌟚) { $FƂ[$C܅[39]] = array($C܅[17], $B[$C򌟚]); } $fײ٪ = Model($C܅[2015])->where($FƂ)->count($D밆); goto Dԡ; B: $C܅ =& $_SERVER[ȦÆ]; $B = array($C܅[112] => array($C܅[2043], $C܅[2044]), $C܅[409] => array($C܅[2045], $C܅[2046]), $C܅[2041] => array($C܅[2047], $C܅[2048]), $C܅[2042] => array($C܅[2049], $C܅[2050]), $C܅[2051] => array($C܅[2052], $C܅[2053], $C܅[2054])); $D˅ = strtotime(date($C܅[2012])); goto e񘖤; Dԡ: return (int) $fײ٪; goto eá; eá: } private function optionServer() { goto C𖝘; AꞦ: $DΕǹ = array($Dܜ[744] => $b׿͔[$Dܜ[372]]); $Eن = Model($Dܜ[427])->where($DΕǹ)->sum($Dܜ[87]); $E = explode($Dܜ[60], $_SERVER[$Dܜ[147]]); goto d뚦; C𖝘: $Dܜ =& $_SERVER[ȦÆ]; $f = $this->diskDriver(); $b׿͔ = KodIO::defaultDriver(); goto AꞦ; d: return array($Dܜ[2057] => $f ? $f[$Dܜ[2058]] : 0, $Dܜ[2059] => $f ? $f[$Dܜ[2060]] : 0, $Dܜ[2061] => (int) $b׿͔[$Dܜ[2058]] * 1024 * 1024 * 1024, $Dܜ[2062] => (int) $Eن, $Dܜ[2063] => ucfirst($fӾ), $Dܜ[2064] => $Dܜ[2065] . PHP_VERSION, $Dܜ[2066] => phpBuild64() ? 64 : 32, $Dܜ[695] => str_replace($Dܜ[2067], $Dܜ[899], $B׎), $Dܜ[342] => ucfirst($Eŉ), $Dܜ[38] => $_SERVER[$Dܜ[2068]]); goto a; bܵ: if ($B׎ == $Dܜ[725]) { $e = explode($Dܜ[1069], $C[$Dܜ[882]]); $B׎ = $e[0]; } if ($B׎ == $Dܜ[728] || $B׎ == $Dܜ[729]) { $eᚂ = Model()->db()->query($Dܜ[2055]); $cӋ = $eᚂ[0] && isset($eᚂ[0][$Dܜ[1319]]) ? $eᚂ[0][$Dܜ[1319]] : 0; $B׎ = $Dܜ[2056] . ($cӋ ? $Dܜ[18] . $cӋ : $Dܜ[43]); } $Eŉ = $GLOBALS[$Dܜ[16]][$Dܜ[342]][$Dܜ[754]]; goto d; d뚦: $fӾ = $E[0]; $C = $GLOBALS[$Dܜ[16]][$Dܜ[27]]; $B׎ = $C[$Dܜ[883]]; goto bܵ; a: } private function diskDriver() { goto e޵ݏ; f: $eʥɥ = $E - @disk_free_space($D); return array($Dۤ؍[2058] => $E, $Dۤ؍[2060] => $eʥɥ); goto D; e޵ݏ: $Dۤ؍ =& $_SERVER[ȦÆ]; $D = $Dۤ؍[18]; $EЪ = $GLOBALS[$Dۤ؍[16]][$Dۤ؍[2069]] == $Dۤ؍[2070]; goto c搩; c搩: if ($EЪ) { $D = $Dۤ؍[2071]; if (function_exists($Dۤ؍[2072])) { exec($Dۤ؍[2073], $E邖); $D = $E邖[1] . $Dۤ؍[18]; } } if (!file_exists($D)) { return; } $E = @disk_total_space($D); goto f; D: } public function fileChart($AᲓі) { goto Dԥ; E҆: $e骔 = $this->sourceSize(); $Cȶ = array($aʹ[466] => 0, $aʹ[376] => 1); $FѼ = Model($aʹ[753])->where($Cȶ)->sum($aʹ[87]); goto c; Dԥ: $aʹ =& $_SERVER[ȦÆ]; if (isset($AᲓі[$aʹ[1412]])) { return Model($aʹ[753])->userFileTypeProfile($AᲓі[$aʹ[1412]]); } if (isset($AᲓі[$aʹ[2074]])) { return Model($aʹ[753])->groupFileTypeProfile($AᲓі[$aʹ[2074]]); } goto E҆; c: $Cȶ[$aʹ[376]] = 2; $A˜󛡟 = Model($aʹ[753])->where($Cȶ)->sum($aʹ[87]); return array($aʹ[699] => $e骔[$aʹ[87]], $aʹ[2005] => $e骔[$aʹ[2005]], $aʹ[2006] => (int) $FѼ, $aʹ[2007] => (int) $A˜󛡟); goto D½; D½: } private function sourceSize() { $eߥ =& $_SERVER[ȦÆ]; $F = Model($eߥ[753])->where(array($eߥ[375] => 0))->sum($eߥ[87]); $cե = Model($eߥ[427])->sum($eߥ[87]); if ($cե > $F) { $cե = $F; } return array($eߥ[87] => (int) $F, $eߥ[2005] => (int) $cե); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authDefault() { $C↲ =& $_SERVER[ȦÆ]; $E۬ = array(array($C↲[391] => LNG($C↲[2075]), $C↲[2076] => $C↲[2077], $C↲[2078] => 6, $C↲[2079] => 1, $C↲[2080] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($C↲[391] => LNG($C↲[2081]), $C↲[2076] => $C↲[2082], $C↲[2078] => 1, $C↲[2079] => 1, $C↲[2080] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($C↲[391] => LNG($C↲[2083]), $C↲[2076] => $C↲[2084], $C↲[2078] => 2, $C↲[2079] => 1, $C↲[2080] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($C↲[391] => LNG($C↲[2085]), $C↲[2076] => $C↲[2084], $C↲[2078] => 3, $C↲[2079] => 1, $C↲[2080] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($C↲[391] => LNG($C↲[2086]), $C↲[2076] => $C↲[2087], $C↲[2078] => 4, $C↲[2079] => 1, $C↲[2080] => self::AUTH_SHOW | self::AUTH_VIEW), array($C↲[391] => LNG($C↲[2088]), $C↲[2076] => $C↲[2089], $C↲[2078] => 5, $C↲[2079] => 1, $C↲[2080] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($C↲[391] => LNG($C↲[2090]), $C↲[2076] => $C↲[2091], $C↲[2078] => 7, $C↲[2079] => 1, $C↲[2080] => 0)); return $E۬; } public static function authCheck($d̏Ǎ, $Aêε) { $d̏Ǎ = intval($d̏Ǎ); if (_get($GLOBALS, $_SERVER[ȦÆ][462])) { return !0; } if ($d̏Ǎ <= 0) { return !1; } if (($d̏Ǎ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($d̏Ǎ & $Aêε); } public static function authCheckShow($e) { return self::authCheck($e, self::AUTH_SHOW); } public static function authCheckView($f呑) { return self::authCheck($f呑, self::AUTH_VIEW); } public static function authCheckDownload($d˙) { return self::authCheck($d˙, self::AUTH_DOWNLOAD); } public static function authCheckUpload($b螒) { return self::authCheck($b螒, self::AUTH_UPLOAD); } public static function authCheckEdit($d) { return self::authCheck($d, self::AUTH_EDIT); } public static function authCheckRemove($Aŷг) { return self::authCheck($Aŷг, self::AUTH_REMOVE); } public static function authCheckShare($Eͬ) { return self::authCheck($Eͬ, self::AUTH_SHARE); } public static function authCheckComment($d) { return self::authCheck($d, self::AUTH_COMMENT); } public static function authCheckEvent($BŢ) { return self::authCheck($BŢ, self::AUTH_EVENT); } public static function authCheckRoot($D͵͈) { return self::authCheck($D͵͈, self::AUTH_ROOT); } public static function authDisable($E굷, $dވɔ) { if (intval($E굷) <= 0) { return 0; } return intval($E굷) & ~$dވɔ; } public $optionType = "\123\171\x73\164\145\x6d\x2e\163\x6f\x75\162\143\145\x41\165\x74\x68\x4c\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\x61\x75\164\150", "\x6c\141\142\x65\x6c", "\x64\x69\x73\x70\154\141\171", "\163\x79\163\x74\x65\155", "\x73\157\x72\164"); public function initData() { $DΆ␕ = $this->authDefault(); foreach ($DΆ␕ as $E抭) { $this->add($E抭); } } public function listData($F׌ = false, $c = "\x73\x6f\x72\164", $aѸШ = false) { return parent::listData($F׌, $c, $aѸШ); } public function update($Dö, $Bˤ) { $B =& $_SERVER[ȦÆ]; $f֍ = parent::listData($Dö); $Bݠ = $this->findByName($Bˤ[$B[38]]); if (!$f֍ || $Bݠ && $Bݠ[$B[372]] != $f֍[$B[372]]) { return !1; } $this->filterAuth($Bˤ[$B[381]]); return parent::update($Dö, $Bˤ); } public function remove($bꇜ) { $CԢ = parent::listData($bꇜ); if (!$CԢ || $CԢ[$_SERVER[ȦÆ][1073]]) { return !1; } return parent::remove($bꇜ); } public function add($dǌ͡ = array()) { goto fӜ; a߹: $dǌ͡ = array_merge($eߋ, $dǌ͡); $dǌ͡[$E[2095]] = $this->getSort(); $this->filterAuth($dǌ͡[$E[381]]); goto C̞; C̞: return parent::insert($dǌ͡); goto B߾; fӜ: $E =& $_SERVER[ȦÆ]; if ($this->findByName($dǌ͡[$E[38]])) { return !1; } $eߋ = array($E[38] => $E[43], $E[381] => 1, $E[2092] => $E[2093], $E[2094] => 1, $E[1073] => 0, $E[2095] => 0); goto a߹; B߾: } private function getSort() { $C =& $_SERVER[ȦÆ]; $Aץ = parent::listData(); $Eí = array_to_keyvalue($Aץ, $C[43], $C[2095]); return empty($Eí) ? 0 : max($Eí) + 1; } private function filterAuth(&$E䧞) { goto B; fҞϗ: foreach ($bސٴ∊ as $aƋ) { if (isset($C[$aƋ])) { $bސٴ∊ = array_merge($bސٴ∊, $C[$aƋ]); } } $bސٴ∊[] = self::AUTH_SHOW; $E䧞 = array_sum(array_unique($bސٴ∊)); goto fݽ; bͽ: foreach ($B as $aƋ) { if ($E䧞 & $aƋ) { $bސٴ∊[] = $aƋ; } } if (in_array(self::AUTH_ROOT, $bސٴ∊)) { $E䧞 = array_sum($B); return; } $C = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto fҞϗ; B: if (!$E䧞) { return; } $B = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $bސٴ∊ = array(); goto bͽ; fݽ: } public function sort($Aχ؏, $c廉) { return parent::update($Aχ؏, $c廉); } } goto C; E̺: if (!function_exists('_kodDe')) { function _kodDe($Cƙ) { $Cƙ = base64_decode($Cƙ); $D = strlen($Cƙ); $cΑ = ''; $A = ord($Cƙ[0]) - 30; for ($eӠ׮ = 1; $eӠ׮ < $D; $eӠ׮ += 2) { if ($eӠ׮ + 1 < $D) { $cΑ .= chr(ord($Cƙ[$eӠ׮ + 1]) + $A); $cΑ .= chr(ord($Cƙ[$eӠ׮]) + $A); } else { $cΑ .= chr(ord($Cƙ[$eӠ׮]) + $A); } } return $cΑ; } } define("\xbf\xc8\xa6\xc3\x86\xb1\x9e\xe6", "\xb8\xf1\xf6"); $_SERVER[ȦÆ] = explode("\174\3\174\2\174\2", gzinflate(substr("\37\213\10\0\0\0\0\0\0\3\235\75\7\140\133\305\331\20\12\224\260\313\54\363\141\22\74\242\341\231\341\44\116\144\111\216\225\310\226\221\344\330\301\162\224\47\351\111\172\261\244\47\277\367\144\313"."\116\102\111\41\120\106\240\214\206\22\106\51\243\224\122\366\54\173\26\312\52\320\262\151\151\41\213\121\72\240\120\366\177\373\356\75\311\320\376\264\216\356\276\373\356\336\215\357\276\373\356\356\373\276\173\354".base64_decode('ldufuOKpc+7/19pd1k5bO+22j/Ev+N931u6Mw0ef+d2d0H+75I9/qHda034bf3t+/KHfnb/+0fk=')."\115\122\335\310\5\63\135\243\317\377\264\365\352\43\137\71\365\205\331\371\71\337\173\344\361\173\232\157\175\177\351\135\346\237\227\155\177\346\336\213\344\317\237\372\362\305\257\336\172\161\351\163\337\335\320\66"."\353\366\56\307\304\226\145\107\355\264\142\137\357\41\47\377\141\353\11\337\177\364\326\203\267\75\133\32\376\353\217\163\27\337\275\373\340\205\373\155\76\355\271\253\372\27\136\171\347\11\47\377\375\113\255\164"."\xde\xc0\x64\xc3\xf2\x39\x9f\x5f\xf1\xe8\xc8\x5e\x7f\xb9\xef\xdf\xdf\xfd\xe7\x7d\xf\x3d\x57\x3b\xb1\xd3\x9b\xfd\x5d\xf\x9f\x7d\xe2\x6f\xf6\xdb\xef\xe1\x37\xa\xf\xf6\x2d\xad\x5b\x3c\xb2\xdb\xfc\xfd\x9e\x98\x5f\x7a\x60\xe9"."\x47\xdb\x4f\x2e\xef\x7f\xec\x8a\x33\x56\xef\x79\xc7\x59\xad\xc7\x3e\xfa\xf0\xd2\x47\x43\x6f\x7f\x7a\xfa\xc7\xf7\x1f\xb5\xbc\xf3\xd6\x95\xbe\x57\x67\x3c\xf3\xaa\xb1\xa9\xf7\xd5\xd6\x4b\x6f\xfd\x67\xcd\x31\x7f\xfb\xde\xf2\x97".strrev('eutnוYM|hl-w]GjgØ?>O}\'m58/˼')."\x77\x8f\x5a\x7f\xef\x9b\x89\x55\x6b\xaf\x6e\x3d\xe2\xf7\xaf\xbd\xad\xdc\xf6\x9a\xfe\xea\x11\x5b\x8c\xbf\x5e\x72\xd7\x9a\x7d\x17\x7c\xbd\xe3\xce\xb6\x8b\x3e\x5b\x6f\x1c\x70\xdb\x59\xbb\xfe\xe8\xc5\xcb\x76\xbd\xeb\x97\xbf\x96"."\167\235\163\113\373\327\363\236\221\257\332\164\323\73\77\176\256\153\366\362\206\65\227\354\367\237\331\237\374\144\370\37\201\317\366\34\73\161\336\373\157\116\333\151\47\334\321\355\370\107\52\150\246\244\224\125"."\xc3\x34\x30\x40\x2e\x99\x5a\x4e\x93\x53\xae\x62\xb6\x88\x21\x69\x35\xa7\x18\xea\xa4\x82\x63\x71\x19\xc6\x23\x20\x1e\x28\xf0\xf4\x78\x46\x31\xe3\x49\xad\x60\x2a\x5\x5a\x50\xa7\x27\x12\xf0\xc6\xfb\x3c\xd1\x6e\x52\x70\xb1\xe8"."\256\54\174\72\376\151\305\77\311\254\222\34\211\313\11\115\67\225\24\6\225\12\71\265\60\102\222\265\102\132\315\340\260\112\276\356\306\77\306\150\116\65\151\25\173\103\321\170\244\277\257\317\37\216\306\111".base64_decode('a8X0vJYioaKsy3lS36KiG6AbxOLiRa2oFCwQDkjJppyQDVKSrzPu8/cFQyvi0RV9foKRiI+WFH0=')."\2\307\120\60\142\312\272\31\125\363\12\303\30\327\131\275\72\375\113\2\275\122\64\354\351\215\170\274\321\100\250\27\203\275\241\236\236\100\264\22\36\16\5\203\235\36\357\262\312\224\276\260\147\111\217\107".base64_decode('AvUDI6MW0lqdtAqnrJLqcaBLVXKkhwsyrY45USShKAsB+iiUcjkc6WUhUn8lLZdypM98YqSoq3k=').strrev('}V	~t'."\r".'.l=Cu)I@y+89SeGBʜ2}6')."\141\55\152\161\255\204\363\365\367\202\16\221\74\301\240\64\125\11\246\222\57\322\142\160\236\52\205\205\302\76\177\130\352\134\41\361\176\112\152\371\274\126\160\201\122\300\170\232\102\125\375\341\60\16\70\310"."\354\12\6\340\320\221\110\250\253\53\342\147\61\322\270\343\203\240\46\55\204\112\55\261\124\72\147\306\307\344\134\211\22\53\231\5\265\344\207\374\152\6\41\340\121\265\240\226\10\261\222\42\64\315\240\65".base64_decode('JoESxVYoJA+yaWROgQk2hoMLO/DvfIKUgLN7TNHNuFJIaim1QKbhIjLlCOHJZtanqwCPFKi5klo=')."\x71\xa2\x47\x1b\x53\x38\xaf\x8\xb2\x59\x96\xd6\x72\x29\x45\xe7\xf1\x22\xc8\x2e\xa6\x90\xc6\x30\xde\x3\x73\xf7\x96\xf2\x22\xa\x8b\x26\xb3\x6a\x2e\xa5\x2b\x85\x6f\xc7\x6c\x22\xc5\x2a\xa6\x9\x9a\x61\xd0\x9a\xf6\x17\x21\x67"."\x8a\x28\xba\x50\xfb\x2e\x50\x4c\xa8\x64\x8a\xc0\x12\x42\xeb\xd2\xf4\xbc\xf\x30\x0\xd2\x3b\x80\xec\xd5\xfe\x2a\x9\x23\x94\xf0\x53\x42\xa7\xb8\x8\xe3\xaa\x1b\x5a\xef\xfc\x6a\x78\x68\x31\xf8\xa7\x9e\x70\xb1\x18\xa9\x5a\x56"."\xc9\xe5\xe2\x4a\x59\x21\x13\x24\x9f\x6a\x33\x68\xed\xdd\x46\x42\x2d\xb8\x1\x4\x47\x3\xa1\x78\x56\x36\xb2\x3d\xa9\xb6\x38\xca\x45\x99\x63\x4a\x29\x73\x26\xcb\x27\x30\xa1\x5c\xd8\xd1\xbd\x9a\xe9\x17\xf8\x7e\x4e\x4b\xca\x39".base64_decode('sYk4nDXNYkQppGBPkKZo4wXUU0WF8mifQ0pJPdIKqbtdbadkBYgkPcFZXdbM51iINpPBDAY0y4Q=')."\x18\x6a\x48\x5c\x29\x9b\xa4\x77\xa4\xf9\xc9\xac\xac\x83\x71\x5b\x58\x32\xd3\xce\xb9\x6c\x59\xc9\xa9\x49\xd9\x54\xb5\x82\x5b\x4b\x9a\x8a\xe9\x34\x4c\x5d\x91\x49\x69\x35\xf3\x25\x48\xa\x70\xea\x36\xe0\x5c\x74\xda\x78\xf1\x62"."\345\214\352\162\301\110\53\272\323\117\350\272\135\2\35\314\130\27\105\363\251\106\121\63\124\370\231\166\111\66\115\71\231\205\323\236\27\277\360\33\360\125\270\206\51\25\270\236\144\122\61\14\47\314\242\153"."\71\247\47\227\323\306\235\41\135\315\250\40\117\203\255\232\200\45\265\113\224\137\26\125\135\61\150\124\132\322\23\45\310\240\126\212\263\117\227\63\171\271\135\52\226\22\240\147\310\304\254\2\303\330\344\353"."\355\122\22\106\35\122\276\144\230\116\135\1\174\107\5\53\34\31\274\100\332\331\3\307\123\125\122\316\10\140\317\4\334\322\330\52\1\62\222\150\32\206\166\107\243\175\361\100\27\130\205\173\375\361\36\117"."\324\113\4\0\277\51\147\150\235\203\200\351\262\42\51\160\320\11\346\32\44\264\136\320\107\34\330\247\215\53\72\370\160\347\104\273\64\242\245\22\132\331\105\223\272\210\50\102\221\141\217\26\115\147\130\56"."\144\140\377\44\46\114\205\220\243\61\226\241\253\111\170\271\77\34\217\204\272\242\3\236\60\131\251\13\240\313\313\264\120\130\110\316\31\126\122\240\223\223\46\55\132\56\302\376\241\70\160\112\300\321\244\251"."\x70\x9a\xd0\xb4\x60\x60\x9\xec\x2\x9f\xd3\x0\x48\x4e\x11\x8b\x96\x1d\x54\xf3\x2a\xac\xa5\xc9\x52\x50\x9f\x81\x65\x7c\x9\xa9\x90\x1b\x55\x7d\x61\x2c\xdb\x50\x17\x4b\xcd\xaa\x77\x82\x7f\x1b\xea\x87\x62\x3e\x57\xc3\xf0\x22"."\xb7\xca\xf3\xb8\x9b\x5c\x4d\x52\x73\xe3\x6c\xa9\xf\xc8\x15\xaa\x9c\x93\x8\xbd\x54\x60\x34\x4a\xa1\x65\x56\x8a\xa\x2a\x85\x8c\x99\x25\x62\x60\xd8\x7f\x7c\xbf\x3f\x12\x8d\xf7\xf8\xa3\xdd\x21\x1f\xc9\xed\xf7\x90\x50\x50\xc3"."\23\214\326\166\10\377\14\223\161\0\53\175\106\111\2\301\116\227\163\220\215\120\252\121\350\124\316\250\151\316\226\3\100\36\41\235\206\31\27\217\104\324\174\221\262\31\63\133\312\47\204\240\233\227\100\106".strrev('8쒇S$̊), 3wJ򋹳27SHB[.c').base64_decode('lB7FzGpkGgCJmFSpxOpGa5lScgrtpaxCeS2QjsZY5xV1Ja0SmgTiEIBzXqoaYZAJiic0PgClSA4=').base64_decode('MDnblQ3OumFEWFi7+oPBuDfUGwWSJIYMhANRP6UIjy/u8faxFYgPE0GAk6ySSWHIWLPAvTmb54w=')."\223\256\123\220\61\342\60\340\150\105\255\140\50\116\262\215\160\246\70\13\305\30\363\155\374\263\42\7\227\137\313\116\71\77\351\314\53\246\354\144\125\267\256\122\122\124\134\354\2\144\10\70\313\313\201\245"."\x11\x6c\xf\xe8\xf2\xd8\x17\x8a\x90\xc\x8b\x20\x14\x8\x13\x9\x45\x27\xf5\xe8\xeb\x27\x49\x79\x61\xf8\x97\xf8\xa3\x74\x69\x93\x89\xc4\xe1\x19\x88\x50\x3e\x55\x2\x88\xba\x3a\x29\xf3\xc6\x2d\xa2\x15\x21\x85\x96\xf3\x39\x2e".base64_decode('GMVVy8DFtcRqwJoAtcnVmuvkgxTtDvQui/eEfP5gPNALeF+0Et7f5/PQURfhnSG6dSPQfsAglns=').base64_decode('ggE7un8wEIlGqiYBWL/flgK2Sn1hf1dgkEW7Av6gLxL3erzdHKfX00Mi8TTcrBhuK34csPEI2/I=').base64_decode('xMfg9o12Ztyyv4hTyTnOCQSsPQohStJcuGlELSGybFIrUTJlwleecoa8TKamTNeVOvxTL3kiklk=')."\214\63\36\220\230\140\101\324\14\32\7\322\26\371\276\104\270\156\105\15\342\20\247\123\111\153\272\362\115\0\117\332\144\204\141\213\203\11\303\323\300\10\170\320\356\24\120\2\32\221\70\235\204\6\220\353"."\75\264\72\151\276\63\214\207\300\26\332\3\367\225\361\201\160\250\167\11\311\60\236\125\150\5\2\244\373\353\250\54\102\266\227\46\347\105\100\220\220\271\114\110\73\175\265\106\273\162\55\376\71\16\377\0"."\331\213\174\134\51\320\136\117\100\216\314\70\6\335\73\200\331\102\271\251\126\142\137\113\150\132\216\116\140\260\310\62\106\301\66\246\253\15\112\44\145\312\225\146\321\345\212\254\12\321\320\62\177\157\234\122"."\x16\x8e\x9\xd4\x88\x1\x60\xab\x17\xa\x93\xe\x31\xb5\x11\xba\xf1\xc0\x89\x61\x7f\x84\x4e\x7f\x5d\x19\x2d\xa9\xb4\xbb\xdc\xae\x59\x84\x8a\x15\xb0\xf0\x90\xcf\xbb\x57\xc6\xc6\x67\xd5\xd\x39\x67\xb9\x86\x41\xa0\xbe\x61\x31"."\216\222\130\314\145\211\316\40\371\113\72\313\15\145\217\72\143\121\175\173\314\35\163\327\55\152\37\362\70\47\145\347\144\243\163\236\163\170\126\314\125\77\213\0\206\327\64\73\132\327\101\4\200\270\350\330"."\x61\xf0\xb3\x30\xb6\x68\x66\xcc\x79\xdc\x89\xab\x16\xf\xc5\x86\x6b\xdb\x67\x1d\x13\x73\x1d\x1b\x1b\x1f\x6e\xa8\x5f\x44\xbf\x93\x2c\xe9\x60\x53\x95\x9c\x60\x55\x4d\xcd\xaa\x3\x55\x2\x32\x9\x43\x29\x20\x5e\x28\x20\xd0\x84"."\x49\xb5\xc8\xa1\x6b\x66\xaf\xa3\x70\x30\x86\x4a\x86\xe7\x18\x72\xc6\x66\xd\x2f\x12\xf2\x9\x20\xfb\xb7\x80\xcc\x2\x18\x73\x96\xe1\x79\x9c\x27\xc0\x96\xb1\xac\x70\xde\x13\xfa\x28\x15\x92\x9c\xbb\xc2\x79\x91\x90\x93\x84\xf"."\xa8\x99\x2\x9b\x42\x60\x25\x67\x9b\x59\xab\xd0\xbb\x66\x26\xfe\x5d\x47\x7\x32\xa3\xd0\xf5\x18\x9e\x43\xe9\x84\x3a\x4b\x5\x75\x94\x6e\xd1\xb\xca\x28\x9\x68\x26\xa5\xef\x84\x62\x8e\x2b\x94\x3c\x0\xdc\x12\x7\xc4\x41\x77"."\135\40\111\210\345\220\164\106\276\300\167\73\12\22\375\111\53\212\161\50\157\215\263\130\112\51\220\161\332\203\140\33\111\271\250\104\204\26\306\343\121\117\147\320\37\247\34\206\160\142\32\107\134\261\223\35"."\152\201\246\161\216\312\266\220\134\16\66\106\163\22\142\6\222\242\353\232\336\216\16\23\215\122\21\12\141\140\323\143\202\376\224\300\26\130\132\330\41\341\156\46\134\42\56\166\172\121\246\142\4\334\234\62".strrev('[:hVgq[43.5"0F^d Ԕ]')."\x67\x21\x9c\x8b\xab\xa6\x66\xca\x39\x86\x6\xd3\xa2\x10\x42\xb9\xd\x5d\xab\xc9\x16\x1b\xf\x60\x90\x33\x21\xb8\x3a\xb\xa7\x6e\x88\x43\xf6\xb2\x23\x25\x76\x52\x20\x1c\xf8\x0\x98\x43\x88\xe2\x7f\x17\xd6\x50\x36\x5d\x0\x13".base64_decode('wcsXqYDPSQbRM+gMEMmdBVQqY8pgOpsUamglPakwHIuQYco6WLO4SAeFL+FYENTcAY8RHHBNdQA=')."\61\317\1\317\151\34\134\124\165\360\23\0\7\23\74\35\104\36\165\360\322\111\60\340\163\250\206\17\311\305\250\134\224\104\353\154\146\341\176\72\47\117\70\160\375\203\312\230\222\163\320\332\73\150\243\34".base64_decode('tAUOtNHwkdr0A/ogtUFBwCSyDjgccGxpKTBIu4FJ0w4uaTsyulYq9tEvCTFcGQLgNWWAsKaZDro=')."\xf3\x61\x81\x1e\xc6\x81\x60\x75\x78\x68\x39\x1f\x70\x5e\x7b\xb6\x7c\x92\x26\xe0\xb8\xbd\xe\x18\xa\xd3\xbb\xe4\x31\x71\x80\xab\xe\x76\xc1\x4a\x18\xfc\x74\x93\x9f\xc2\x71\x71\xc9\xbe\x3\xb1\x9f\xee\xf0\x4e\xe4\x95\x88\xca"."\231\210\360\171\260\373\247\337\256\222\212\303\141\45\71\221\344\273\32\237\260\115\262\306\330\320\43\72\254\106\114\325\207\236\21\10\243\265\351\173\354\101\51\233\323\21\41\37\13\261\115\111\335\274\115\241".base64_decode('Il9xIEOIAD4oTHkKCnEOUyIrpGwkqSwzTu8XFAoT6k9bbykXRvnMpE2UYAEOgWfD0XHyIRai5Ec=')."\xd5\xe2\xb8\x5f\xe3\x79\xb6\xb3\x60\x1d\x6d\x63\x46\xb0\xdf\xfb\xd4\xc2\x84\x5a\x10\x37\xed\x1c\xca\x79\x1e\x27\xa\x48\xde\x3c\x86\xfb\x78\xaa\x30\xe6\x2d\xfc\x50\xc0\x41\xe\xb\x1c\xf0\x36\x48\xe0\x7a\x7c\x73\xb\x6a\x8f"."\156\242\170\335\111\111\266\232\323\11\350\264\106\371\174\354\7\333\244\270\215\124\11\221\146\145\235\367\62\235\143\220\260\131\253\14\210\302\243\2\132\132\36\343\354\336\222\107\230\31\206\71\301\316\67\204"."\240\265\120\34\365\115\25\351\146\273\277\152\121\161\322\251\106\220\335\255\131\303\250\245\121\255\152\24\111\5\22\220\7\350\331\27\25\357\343\266\363\5\20\25\106\52\156\71\212\300\325\360\60\326\7\4"."\233\34\30\1\335\5\47\311\22\310\330\304\125\210\257\120\220\231\342\260\200\124\264\363\100\13\257\256\266\360\331\271\265\15\152\213\362\217\132\370\116\305\352\104\204\23\42\213\66\22\252\117\201\135\243\113"."\xc7\x9c\xcd\x5\xc4\xf\x72\x47\xe3\x68\x14\x96\x37\x3e\x7d\xd7\x18\x13\x86\xa9\xe4\x9\x27\x5c\x67\xeb\x1d\x13\x6c\x6f\x12\xb2\xee\xd2\x41\x8d\x78\x45\xf9\x92\x40\x84\x8f\x12\x3\xc\xdb\x31\x70\xf1\x41\x8d\xca\xc2\x90\xfe"."\xfd\x29\xd5\x84\x10\xc8\xcd\x34\x7a\x5a\xc5\x11\x5\x36\xcf\x60\x42\x81\xa8\x4b\x5c\x15\x63\x90\x53\x47\x48\x2e\xc7\x4c\xb\x66\x35\x4e\xee\x6a\x40\x3c\xd7\xc5\xd7\x1e\x71\xe5\x12\x6f\x83\x20\x1a\x6f\x39\xbc\x5d\xc2\x21\xe1"."\x1e\x35\xcf\xae\x9b\x10\xd0\x65\x98\x5a\x91\xa7\x8\x51\x9c\x2c\x24\xf1\x42\x5\x2c\xd6\xf9\xa8\x86\x60\x5\x48\x21\xf9\x80\x77\x21\xc2\x25\x79\x91\x4\x8d\x89\xdb\x95\x3\x18\x2e\x91\x15\x79\x74\x9d\x12\x9\x6e\x1e\x3c\xc1"."\1\100\21\4\247\153\204\36\35\126\343\310\270\160\377\30\277\37\305\105\301\17\273\360\2\345\222\123\251\20\75\127\23\303\225\250\342\151\102\365\202\320\225\65\53\112\210\125\107\367\344\162\374\376\313\36"."\237\62\13\236\253\142\46\21\62\145\266\56\44\4\323\213\207\152\60\46\323\165\331\150\210\317\70\176\277\150\27\171\255\314\347\333\304\261\212\31\300\7\264\172\34\362\307\254\132\120\14\266\62\351\106\65"."\76\363\155\362\215\105\352\265\12\62\242\4\103\226\103\336\134\261\133\41\371\117\105\13\60\115\70\124\2\173\50\0\20\327\21\166\162\302\371\216\260\124\242\145\47\156\132\226\375\60\52\103\230\17\226\41".base64_decode('BvMPt6hL1/KBEJhf1YnOjqfQsyPE1MpsSyZmAkQCV6GpyqTJrCi+ZL1x31/eW//Zy1++8DMcf+Q=')."\55\374\333\332\62\33\7\310\245\373\332\357\240\137\24\346\352\114\33\6\327\150\257\277\164\320\356\167\254\373\361\155\201\275\136\276\116\131\172\305\312\367\232\175\233\122\103\167\344\26\376\355\336\227\366\273"."\160\313\325\335\147\156\271\372\211\145\13\357\375\342\200\334\310\37\26\265\233\203\273\71\36\71\325\371\312\111\173\277\262\371\300\301\347\23\316\217\363\333\226\74\360\230\153\342\350\31\77\271\173\326\17\317"."\xf8\xe4\x8d\x97\x27\xbe\x78\x76\xde\x3\x23\x77\xfd\x23\x77\xd5\x23\xb5\x8b\xca\xff\xfa\xb2\xf6\xcd\xa7\x9e\x3f\xfa\xfd\xa1\x7d\xbe\xfc\xd7\xfb\xaf\xde\xf2\xab\x83\xf6\x1a\x7e\x71\x24\xda\x7c\xc7\xb9\xd3\xdf\xdf\xf9\x92\x53".base64_decode('Gx+cd9BhT2QufvzuM6f3Dz77lP6TpdPeT6aunPfRO4eW/yyZn/7ur688ufbM+s++Xrn6ofq34oc=')."\335\224\237\271\327\345\67\36\372\363\353\216\177\365\250\316\3\176\376\237\362\323\332\123\165\3\57\337\264\341\215\335\136\175\346\270\365\353\77\355\334\173\203\53\175\330\251\207\176\32\73\347\266\273\277\370"."\xea\x6d\xcf\xe3\xa7\xed\xf3\x70\xdf\x60\xd6\x3b\xfb\xa0\x53\x1a\xbe\x7f\xcb\xf5\xf7\xef\xbb\x69\xe9\xaa\xa1\xc3\x82\x7b\x1e\xb1\xe3\x1c\x59\xdf\x6f\xfa\x86\x7d\x36\x9d\x3f\xfd\x91\xcb\x5f\x5c\x54\xd8\x7b\xc9\x93\xff\xbc\xbc".base64_decode('Z9ehTdc94n+25T7n6I13nbn2P0dN/+msdXOXH3FSW2T/OwoLz5s9surDX9//6T+uGXry88Pf3+s=').base64_decode('4+T3bw1c3ffMUyd43rrb1fidif7rDxx8rpQddEU+uOn1q45+ZH8jf+yn2fFzdnxSuOae4b/Xqcc=')."\377\366\316\17\37\173\264\176\373\262\256\225\67\276\23\374\360\167\346\362\226\351\155\75\27\36\272\166\333\123\67\17\375\244\355\344\272\307\77\132\374\320\73\167\355\145\16\277\264\372\240\206\213\66\34\120".strrev('y9|j疽ؙ&'."\n".'nn|yoG?Pfx]{')."\x7f\xec\x78\xec\xbd\xbc\xef\x1f\x73\xf7\x6a\xdb\x7b\xb7\xa7\x5f\x7d\x30\x16\x9c\x1e\x5e\x79\xe1\xd5\x4b\x8f\xd9\xb8\xe5\x88\x2f\xdf\x19\xdc\xf9\xcf\x37\xe7\xf6\x7f\xfb\xa2\x13\xd3\x7\x5e\xbd\xb4\x6d\xdf\x27\x9f\xbe\x2c\xfd".base64_decode('+92W7Yj8cvvl6SvWjX308OZXD7tg1dWxxJKjv1e+6aR9LvR5rjn8umf1fZt32v2ff9y/uGryjVM=').base64_decode('dn7qoEM675M78y/sl/3DtDd3fPqdFw6b/8gunsYl93d8N3/Ho+sL3Q/sdeZONz5zcre0bX3T+9I=')."\xb9\xd7\xc6\x7c\x85\x4b\x56\x6d\xb9\x7a\xa4\x6b\xe8\xa9\xbd\xe\x7f\xe3\x4c\xf3\xae\xd3\x8e\x4c\x1f\xe9\x69\x1c\x3d\xe2\xcb\x53\xf7\xb9\xe9\xfd\xe7\x5f\x78\x7b\xc5\x55\xf3\x37\xcd\x6f\x3e\xe6\xce\x42\x30\xfc\xc4\xe1\xd2\x29".strrev('{5\'lϷx4?G%q~+g{o|').base64_decode('F78+/aVo17O+6972/vXlB7/T8f7gB1t+vvWfv9py2Es/fabzLOf4gtRDrYuzmbeeueXkxLxbNxw=')."\373\342\255\211\213\273\262\323\376\324\177\356\254\324\315\367\254\370\236\317\330\170\301\76\77\172\245\243\173\103\272\164\204\166\127\106\156\31\376\307\131\7\176\161\320\316\57\274\170\365\354\167\366\137\170\300"."\x3f\xa7\xdf\xda\x7e\x99\xb4\xbc\x66\xf1\x25\x6b\xea\xf\xcf\xf6\x87\xb6\x66\x63\xb5\x37\xae\x8\x9e\xad\xde\xfa\xc2\xd6\x1d\x33\x3f\xbb\x79\xf8\xe8\x3b\xe\x5f\x7a\x63\xc7\x6b\xcb\xee\xb9\xf5\xf1\xef\x9d\x74\xb5\xf3\xa3\x5d".strrev('է)'."\n".'ntwl/꘼O'."\r".'h:n'."\r".']Oe')."\317\336\234\371\303\325\337\331\332\331\177\303\246\211\302\216\151\217\274\77\70\363\117\251\143\217\14\314\77\154\305\76\117\177\367\300\340\214\351\351\315\103\236\13\172\203\357\154\223\77\357\276\166\274\375\117"."\x6b\x96\xde\xb3\x4c\xf9\xe4\x84\xd7\x9f\xbc\xfc\xf5\x23\xaf\x7f\xe9\xf8\xc3\x8b\xca\xb1\x2b\x1e\xd7\x1d\x97\x3d\xb4\x4a\x7e\x6f\x57\xef\xf5\x4f\xfa\xeb\x57\x2c\x3e\x4b\xc9\x37\xfe\x67\x93\xeb\x88\x4f\xc6\x7\xae\x32\xeb\x5e"."\xf2\xfd\xea\xec\xf2\xc1\xfe\x2d\xd3\xf6\x1c\xb9\xeb\x77\xdf\x1f\xd9\xf1\xd9\x31\x6d\x17\xcc\x1b\x2f\xec\x7a\xd0\xf0\x4f\x96\x6e\xd8\xec\x99\x79\xcd\xce\xaf\x6e\x3a\xfb\xb8\x9d\xcf\x38\xe3\xe0\xd8\xac\xc7\x3d\x85\x5e\xef\x9f"."\317\53\356\171\300\366\53\66\175\260\133\343\31\245\160\377\353\237\376\352\37\315\367\247\257\164\55\177\240\311\37\76\162\227\277\335\275\161\245\357\362\73\56\174\371\351\315\117\254\77\376\241\373\322\257\255"."\77\364\210\7\225\123\266\375\145\376\246\31\377\376\160\243\372\311\75\327\154\176\371\342\203\36\333\50\315\377\123\347\265\37\276\240\276\373\310\243\312\257\222\353\317\353\372\321\222\25\157\324\65\77\355\63".strrev('mat}C{P.}lԵzNGnA݃xmf')."\xc3\x37\x4e\x3e\x79\xf9\xed\x7f\x38\xec\xb6\xdd\x82\xbb\x1c\x70\x97\x4b\x7b\xe2\x6f\x57\xfe\xf5\x47\x5b\x4e\x7f\xe1\x95\xeb\x8e\x3e\xf2\xf6\xf6\xbd\xd6\xd6\x7c\x9e\xf7\x65\xdf\x3b\xe6\xa7\x33\xfe\x33\xb9\xe7\xa1\xe3\xda\xc1".base64_decode('e27e2PmLj3/79uu7t2ffvWbbjMsuUC4+97Vbv1//nPSz2rNOmdj8m3Nvefj2HZfNv00du+LMl34=').base64_decode('+Lsj7y707H7oG4F3nvPee8J7fv3442cX/vSLt++Z03bf4I+XvTdy+J0vFUbDf31v12fqDtfrf3Y=')."\x83\xd1\xa3\xaf\x6e\x28\xfd\xe8\x84\x9a\xe0\xf2\xcb\x1f\xdd\xf0\xb3\xe1\x9a\x83\x57\x7e\xf1\xee\xab\x8f\x1d\xfd\x83\x13\xff\xfd\xee\x8d\x3\x37\xfe\x6c\xe5\x57\x9f\xbe\x33\xe7\xf7\xf1\xd8\x7d\x27\x7e\xf9\xc1\x8b\xef\xb9\x7f"."\37\377\352\355\57\116\76\344\220\237\175\265\365\137\133\257\173\352\315\257\23\312\221\173\176\160\354\344\337\77\137\264\374\313\353\177\166\323\225\162\354\236\363\156\312\254\355\364\137\172\345\237\366\152\136\161"."\372\23\277\331\357\374\265\77\275\255\346\77\377\350\133\277\137\164\365\247\372\375\203\117\155\72\300\371\326\322\247\147\37\362\373\223\236\231\330\65\343\336\377\221\125\373\175\364\352\214\331\247\37\376\350\167"."\357\376\363\264\203\117\372\371\266\177\277\367\310\65\257\55\276\330\167\173\321\171\377\115\27\75\232\367\217\77\334\33\334\62\224\151\364\372\136\315\205\203\27\111\147\256\113\237\167\351\301\341\105\107\35\375".base64_decode('4bN1T2YfXvnEh9NueWl8YM4vzpn95orXy/eOrhm+9uYfFg7c+vDbt2/898lfXirfmt5xza3vr1g=').base64_decode('f0Ddcd3lwAGd52wfPOW1N1Y/ckj27Rtv+emyVVcF/3LeKdIW1f/xcYPBdw/semKfw25+czC14Ic=')."\276\263\373\56\375\274\355\347\263\303\57\70\313\356\231\13\132\16\271\365\251\43\336\271\356\315\263\153\116\71\355\347\333\217\71\72\163\375\206\75\176\275\243\151\37\63\32\376\374\321\171\243\63\123\233\256".base64_decode('+c0NW39hPD79tV69vLLm6y+Pbjv74R2XvfjbS47ZMH1+7w3dr93yTjDU+6V/5WFjnaUbPv3kves=')."\x4f\x9b\xff\xee\x89\xf9\x3\x5c\xcf\x7e\xb0\xf7\x23\x27\x5e\xf9\x40\x5d\x61\xfc\x93\xdf\x37\xdc\x72\x65\xef\x75\x57\xf6\xde\xf9\xfc\x9b\xe7\x7e\x71\xe4\xe7\x83\xf\x7f\xf2\xc1\xf6\x39\x97\xbe\xb3\xb6\xe9\xc8\xf7\xef\xe8\x3a"."\xe3\xe5\xd7\xd4\xd7\x8a\xc6\x9\x9b\xde\xf8\xf2\xbe\x17\x3e\x78\xf0\xc1\x93\x3b\x1e\xb9\x7f\xe2\xdd\xdf\xf9\xbd\xee\x1d\xcd\x67\x86\xff\xbd\xed\xb7\x9f\x9d\x70\xfd\x6f\x8e\xbd\x69\xd7\xf5\x57\xfa\xbe\xdc\xd7\x75\xd3\x15\xe7".base64_decode('7n/O+ac37bLHO6HjMidtuXvG8i2fPr1T9tXGxIUfSYe0jPR89ztPac9d9MyPzvtyx271X83Yc/E=')."\226\213\256\217\64\356\262\176\333\320\121\213\34\146\162\371\157\276\172\366\367\277\74\351\117\207\336\267\347\25\3\317\354\361\317\206\105\245\43\126\375\145\316\273\317\370\66\236\33\270\142\361\151\117\334\176"."\341\23\215\337\371\360\247\7\274\376\205\367\57\267\352\211\367\36\274\356\32\275\274\317\365\33\266\276\344\135\331\153\166\176\175\336\363\367\74\55\67\55\372\323\161\217\325\174\364\302\241\221\144\300\265\367"."\xbb\x7\x5d\xe2\xb\xdd\x75\xee\x86\xbf\xb5\x3e\x7e\xd4\x1d\x77\xdf\x3b\x6f\xbf\xcd\xaf\x7c\xfc\xd6\x69\xf2\x9a\xf7\xcf\xb8\xf0\x1f\x17\xef\xdb\x73\xd7\x7e\x8f\xba\x3e\x7b\xe4\xdc\xdf\xcf\x1b\x77\xfd\xea\xe4\x2d\xeb\xa7\x8f"."\36\267\341\244\75\337\127\126\355\72\357\173\331\71\33\277\76\364\342\315\322\35\115\43\311\211\13\46\237\257\115\335\276\163\267\274\45\177\272\332\367\227\372\207\366\134\375\213\101\303\165\303\300\37\303\221"."\x59\xf7\xc\x5e\xf8\xf1\xeb\x1f\xee\x7e\xcf\xb\x2b\x8e\x7e\xf9\xa8\x53\xe5\x7d\x2f\xbd\x24\x77\xce\xd1\xdd\x2b\xf7\x38\xf0\xfa\x27\x7f\xf7\xd5\x89\xf7\xcd\xb9\x7d\x7b\xdb\x55\xb7\xdd\x3d\x3f\x12\x6a\xba\x70\x37\xf9\xbb\x7f"."\x38\xd1\xff\xc0\xdf\x3f\x38\xec\xcc\x96\x53\x5f\x39\xf4\x7e\xff\xc4\xdf\x2f\xff\x4d\xe4\xba\x1b\xb4\x5\x27\x3e\xdd\x9e\x9f\x76\x82\x7f\x6f\xe7\xd0\xc0\x2f\x8e\xf9\xe8\xc2\x59\x97\xef\x3d\x6d\xe8\x8f\xd3\x9f\x1a\x6c\x38\x2a"."\370\342\210\253\173\377\67\333\103\47\176\366\324\17\37\233\60\317\371\352\202\127\176\174\165\354\262\163\166\137\273\171\343\151\337\157\375\344\123\327\362\221\317\317\72\370\337\147\136\361\227\306\235\77\77\77"."\xf0\xb3\xfb\x7e\x3a\xfd\xad\x8e\x8f\x3f\xd8\x31\xf0\xe8\x3e\x27\x2e\xef\xff\xe5\xc3\x2f\xbf\xe4\x7b\xf4\xaa\xdc\xed\x67\x5d\x7b\x7f\xdd\xc6\x53\x77\xfd\xdb\x81\x4b\xcb\x91\x5b\xce\xdf\xee\x5b\x2c\xfd\xf6\xa2\x7f\x6d\xfd\xf0".strrev('xk?y9?!=>^?ς')."\270\361\153\363\323\167\267\156\255\75\372\222\257\77\33\337\176\364\17\312\237\276\370\346\15\35\137\177\364\300\327\137\235\25\336\347\267\255\107\374\332\167\243\273\275\174\316\176\267\357\174\355\61\117\35\361"."\xf7\xd6\x39\x1f\xbc\x51\xbe\xd8\xbf\xf9\xde\x47\x9b\xcf\x39\xf5\xce\x37\xdf\x9e\x7c\xfd\x8a\xfb\x5e\xbc\xf3\xf0\x67\x5e\x7a\xf6\x83\x95\x6b\xbe\xbe\xdc\x28\xff\xf1\x6f\xff\xde\xfd\x91\xe7\xff\xf9\xbb\xfb\x3e\xdf\xf7\xa8\x69".base64_decode('/X/4edPs6/9w+t/ueuLiz3beJ/PhY/8KPnnIGfq1sWtfmv33L348sfGxS18svNS+YfNVPzpj0dc=')."\247\57\231\45\113\357\34\222\372\165\141\363\57\157\136\222\73\241\365\322\173\176\221\213\266\336\167\325\315\363\217\173\364\173\233\176\362\305\343\135\331\316\225\377\336\262\376\335\37\65\74\344\250\375\373\201"."\xbf\x78\xee\x82\x3b\x9d\x2f\xbe\xb5\xf4\xa8\xd5\x5f\x9d\x37\xf0\xca\x6d\xaf\xff\x72\xda\xd7\xbb\x9c\xed\xf8\xdb\xbc\xd\x7\x53\x45\xeb\x79\x6d\x73\x70\x60\xee\x3c\x72\x89\xd3\xd6\x42\x2\xb3\x9b\x89\xde\xf3\x9c\x46\x12\x68"."\x9b\x3b\x8f\x6c\x3d\x26\xf2\xe3\xa3\x54\x5b\x96\x28\x53\x8c\x94\xd4\x89\x49\x93\x5e\xd3\x8e\xe7\xcd\xd1\x12\x39\x67\x6b\x6e\x26\xb2\xe7\xdc\x46\x72\xea\x30\x9e\x2d\x27\xd3\xa3\x34\x79\x36\x49\x6e\x25\x92\xea\xec\x36\xf2\xbd".base64_decode('llZSdjK32hwbJwc582gFR41CKlMmyjtEi6GNfGFuE6lqC0lQSzm5WCby/+wWgtbUTL7Q3NJGDwY=')."\62\211\311\54\301\233\323\102\152\222\117\231\23\305\121\231\26\111\372\54\223\56\151\105\235\134\273\115\214\251\253\23\51\162\303\126\116\251\311\261\325\244\152\345\144\41\223\246\112\335\315\163\132\150\263\111".strrev('HФ9[ZeG\'GȖOAJ3bOʜBH\'yR$ѵ4')."\27\150\133\110\165\344\364\104\141\254\110\316\164\347\266\221\57\247\115\165\162\54\101\276\61\46\247\262\112\222\214\160\163\53\251\176\266\120\4\155\235\304\221\311\325\132\71\115\357\224\232\133\111\337\313\23".strrev(';"dKHٔvr ]E3ɤѕt9P.S7{tټi3KZ')."\223\12\315\153\46\37\151\235\113\232\124\66\225\344\130\226\364\324\270\121\112\45\62\344\244\304\54\247\113\371\325\244\261\155\363\110\106\263\230\232\110\224\164\272\233\42\245\264\265\221\344\246\71\163\151\117"."\66\122\372\154\242\15\234\115\333\77\231\52\123\175\217\326\46\62\230\305\325\243\351\111\205\174\173\44\137\36\55\30\164\144\307\47\106\313\71\172\240\71\236\34\115\245\111\43\347\122\22\231\73\217\214\252"."\x3e\x39\x62\xe6\xcb\x54\xfb\x55\x1e\x59\x3d\xae\x12\xdc\x66\x5a\xa1\x36\x4a\x72\x59\x23\xad\x64\x46\x9\xbd\xa6\xcb\xc5\x8c\x96\x5d\x4d\x5a\x41\xc7\x62\x12\xc\x40\x9a\x1e\xed\x37\x35\x93\x81\x31\x8d\xd1\x54\x22\x4b\xa0\x63"."\xc5\xf1\x82\x92\x4b\x53\x6e\x41\x3e\x92\x96\xcb\xa3\xf9\x4\x39\x4d\x9e\xc8\xe7\x52\x49\xb6\xc3\xce\x2b\xc5\xd2\x8\xe9\xc0\xf1\x9\x35\xb3\xda\xa4\xaa\x73\x39\xa5\x3c\x9e\xa5\x37\xa\x93\x99\x11\xb9\x44\x1a\x5d\x56\xb\xa3".base64_decode('OTouLXNJW1tb6YSYS/owW54wZJMcgLfOm0MDJMM82tcZQxnLJkjLW1pIJ85ubKJ9MT6RpxVppjs=')."\xe6\x89\xfc\x64\x7a\x7c\x6c\x35\xa5\x7\xf2\xed\x44\x76\xf5\xe4\x48\x9e\x34\x74\x36\x1d\xe2\xe2\xc8\xe4\x84\xac\x95\xe8\xcc\x4c\x17\x92\xab\x49\xa4\x85\x56\x86\xf6\xd4\xea\x49\x53\x4e\x27\x9\x1\xca\xf9\xe2\xe8\xe4\x18\x39"."\x66\x58\x91\x27\x84\xdd\x29\x27\x47\xe8\xf1\xb1\x61\xca\x66\xc9\xb0\x21\x50\x9d\xf8\xa4\xa8\x50\x39\xa2\x28\x54\x73\x90\x76\x30\xbf\x2\x36\x4a\x48\x9f\x97\xa6\xf3\x83\x3\x78\xe2\x22\x5c\x15\xc3\x68\x44\xc4\x4d\x16\x4c\x21".base64_decode('GcQsqVCXD55v8Bg9iI+Yms4uz7GOiwvW0GVtEB0CgpFKWNIZlJ6K2FPSdngCdV1cjLhodySEbsU=')."\7\337\246\154\214\270\104\260\123\114\125\13\240\344\134\316\145\65\246\211\243\377\110\157\141\123\15\103\31\55\51\114\361\30\232\136\320\141\212\163\225\120\336\102\176\163\51\300\170\37\13\135\141\35\64\101"."\x43\xac\x98\xd2\x18\x34\x65\x58\xac\x80\xc8\x64\xcf\x4f\xc0\xa8\x10\xb6\x75\x89\x8b\xd7\xac\xe\x6\xeb\xab\xf5\xb8\x50\x2b\xd2\x19\x6e\xd8\x19\x6e\x54\x20\x6f\xa7\x6d\x98\xc4\x5a\x67\xd8\x61\x31\x3f\xb9\x24\x75\xe0\x15\x20"."\x17\x3\x15\x7d\x85\x46\xd7\x4a\x80\x96\x71\xb7\x92\x2e\x39\x42\x44\xa6\x30\xe\x9\x7f\xd0\x21\xa1\xab\x3a\xc9\x6a\xa6\x11\xf0\x49\xec\x4e\x53\x1c\x7d\xb1\x92\xba\x52\xcc\xc9\x49\x56\xc1\xe2\x84\x94\x96\x41\xd6\x54\xbb\x94"."\6\364\56\121\55\143\311\324\150\130\254\232\170\147\150\153\214\145\376\330\233\143\111\4\35\136\142\26\20\354\302\102\74\333\104\127\247\274\316\70\312\56\104\42\240\44\166\345\253\53\51\225\152\272\51\171".base64_decode('hEnVStGFB1OxS+YUWbdctixYVMwWoR2eOX8Rsbwht0hx4bskzPWXRWjOfoFD55TL1ykYpUE0IQc=')."\326\334\231\17\331\312\102\16\305\241\122\1\206\303\245\2\114\45\212\342\156\41\277\213\243\216\23\35\272\64\251\130\217\265\375\240\302\116\326\45\240\231\200\243\246\14\244\55\104\150\376\30\62\34\202\241"."\115\230\367\46\314\216\72\367\33\262\232\142\323\213\200\153\27\230\362\217\221\223\351\205\220\1\130\271\132\120\330\70\224\14\256\37\311\14\33\311\302\147\232\305\170\62\247\121\246\4\306\60\236\122\11\162"."\60\320\31\367\5\302\174\375\240\62\225\247\57\20\217\104\102\202\335\143\273\300\32\240\236\72\277\71\204\61\256\257\16\317\316\305\133\105\303\30\327\164\322\177\320\154\14\152\40\106\44\142\275\2\206\324"."\333\355\11\63\55\303\66\127\243\253\211\343\202\17\306\241\262\345\102\152\355\22\211\172\302\125\114\10\261\151\41\351\157\142\116\110\62\164\207\6\44\157\50\330\337\323\33\301\66\163\30\336\33\22\322\221"."\56\231\45\131\4\223\142\375\175\101\217\327\57\5\172\243\41\252\44\312\164\145\221\172\160\204\305\151\323\165\103\141\46\203\44\77\216\210\52\314\142\211\254\44\102\244\103\216\332\130\115\254\41\126\27\253"."\137\345\212\31\303\144\56\255\22\107\204\60\356\76\37\151\121\73\13\61\156\337\23\211\34\117\64\343\103\141\217\67\110\153\321\351\211\220\140\310\33\300\201\355\27\334\274\345\356\263\267\137\174\303\326\323"."\x37\x82\x82\xb6\x6d\xfe\xe1\xb6\xb\xef\xd8\x72\xd7\xc6\x1d\x27\xdf\xb7\xf5\x86\xb3\xb6\xdf\x7f\xf6\xb6\xb\x6e\xdc\x76\xd6\x7a\x52\xf5\x1d\x37\xde\xb9\xe5\xbe\x7\xb6\x5f\xf0\xcb\xad\x37\xfc\x74\xdb\xa6\xdf\x6c\xdf\x7c\xa"."\116\170\347\332\233\267\236\361\113\126\61\351\235\363\357\337\166\366\325\333\176\162\323\266\215\67\154\275\373\374\255\367\376\160\353\135\167\71\100\356\167\66\154\334\176\337\15\333\176\264\151\333\225\47\155\273"."\375\314\155\227\154\334\172\306\317\267\136\364\313\355\147\337\270\365\212\223\267\236\272\161\307\215\77\71\306\116\73\70\76\104\107\201\134\15\273\127\306\214\206\72\334\263\61\143\26\354\325\172\360\133\7\325"."\115\301\57\325\262\3\24\27\201\106\42\275\136\277\135\175\133\214\22\123\313\6\114\24\220\246\331\322\155\20\123\115\32\217\43\125\376\332\51\153\261\226\14\275\120\51\241\62\76\177\304\33\16\164\372\211".base64_decode('QiMbqJlIsY7cOANoJLychZlxQ4WBrFRHDWTrJUtDZFdSy5XyBVRZqQZqcNQ4IGdFkoJUA1cGAFA=').base64_decode('kmC21UE7O6QrVrui1tHoaKqXiPUszkGsZaUaYinL8lk+4khYYk2OxnqppjhSQ+rF+xXUPo4xDUk=').strrev('W)VpؘL;896ůb.Ջ'."\n".'v').base64_decode('eilBVEarJKJsls5YaOmMulmERfQtYeONtTwlbCKAqyUbdKAIFA0VhOLRorgaaAYYHIwPAixlRJk=')."\xe0\x25\x1\x4e\xc4\x12\xe8\x8\x42\x38\x1b\xc4\x2a\x69\xc8\xa2\xb9\x6\x8b\x31\xb8\x9d\x79\x23\x43\xb9\x1c\x31\xa9\xed\x59\xc1\xda\x40\x69\x99\xc\x81\xc2\xed\xa1\xa1\xb1\x83\x3f\xea\xed\xc6\x54\x1e\x11\xc8\x3c\x95\x98\x69".base64_decode('IVTenZKFRHLUAo7g4ekCGcIeCC/Q2xUK92Al/4i329/jcRH+jSkB40P5QVoo1ULOh0G1lu5HH6I=')."\135\26\105\137\5\363\52\156\52\206\211\173\241\230\41\225\41\243\57\41\363\55\31\145\131\130\213\315\22\111\221\314\174\77\24\216\306\101\7\20\366\54\160\335\132\141\241\20\365\45\113\272\76\306\166\131"."\x48\x52\x17\x44\x14\x79\x16\x97\x6f\x94\x14\x61\x8e\x69\x39\x9\x36\x51\xd4\x48\x37\x41\x7d\x1\x80\x2a\xc0\x2f\x7b\x43\xbd\x5d\x1\x6a\xf5\xe0\x4b\x58\xd2\x7c\xe1\x0\xb4\x23\x24\x95\x93\x68\x9\x71\x7e\x5\xe\x22\xc5\xf1"."\24\13\163\33\65\230\300\226\175\20\341\253\76\114\21\134\22\300\317\104\172\131\230\13\161\40\2\265\324\70\7\36\360\261\160\67\263\124\202\11\241\260\20\361\204\75\75\21\26\15\17\0\216\16\141\202"."\141\116\217\47\22\5\255\352\355\357\341\134\77\350\131\16\10\46\304\345\22\312\261\353\134\15\213\352\143\330\354\0\7\361\317\142\32\203\252\333\303\153\232\34\322\354\165\365\4\207\52\352\307\315\254\132"."\240\202\44\374\312\361\301\170\60\264\4\307\221\253\4\177\41\305\345\154\151\110\2\162\150\224\313\241\6\135\276\330\214\220\0\35\113\330\226\111\352\15\15\170\270\335\275\220\200\41\104\322\225\270\65\276"."\173\345\120\154\74\346\2\42\203\261\212\133\23\370\72\45\52\214\170\241\147\12\242\346\116\162\173\350\212\112\227\16\7\11\304\163\132\206\311\203\275\76\52\100\340\337\101\32\100\334\223\144\0\273\263\142".base64_decode('jloXYLOGeGxt7LiY04UtOaAkE3PwmsX9g2DVjUQsZihxZIdOSgdtJiE8j3FkAfkhe4wFpCdItGM=')."\x21\x1b\x5a\xff\xf1\x6b\x7b\xc1\xdf\x92\xe8\x5a\x3f\xf8\xb\x82\x9f\x60\x14\xc\x9e\xca\x10\xc0\x24\xd\x6\x96\xf9\xd7\xc2\x7f\x78\x42\xbd\x24\x22\x4\x7a\xd7\x82\x7f\x1\x8b\x59\x1b\xe8\xb5\x67\xee\xf4\x47\x7\xfc\x7e\x8c".base64_decode('QMPkl6MClkOaJjjSWBqiVkdS0N8VlWCcfjYer0Od5xyeVR+Pu41+Qi3MXLOudkZTLVlFPBEv578=')."\x16\x3a\xa8\x24\x1\xa4\xb3\x6b\x1d\x7f\xe6\x18\x82\xc4\x97\x84\x43\xfd\x7d\x42\xbc\xdb\xb3\x3c\xd0\xbb\x84\xc6\xdc\xd\x34\xd4\x40\xcd\xd9\x7d\x81\x8\xe8\x22\x2f\xa5\x41\xee\xaf\x42\x8c\x13\x91\x13\x9\x46\xa2\xc8\x6b\x21".base64_decode('aB/g7SAiCOJwB4B5s3WOdfYHgj7R0g4ikiUF8XWyqsyklaNxZHNHI7DLaRiRF42gPqAR3AE0hro=')."\213\106\220\137\14\32\101\15\245\21\270\45\361\367\322\64\260\347\3\373\65\272\221\313\160\225\317\254\74\306\54\110\346\247\22\202\125\250\355\140\11\35\230\370\341\270\221\105\2\351\115\111\202\201\32\74"."\241\22\316\70\334\253\206\142\106\54\62\334\260\150\25\45\103\154\4\145\106\125\223\31\265\241\217\20\27\22\340\43\1\144\203\42\174\206\254\337\374\20\304\272\307\141\274\142\25\333\272\20\117\70\16\362"."\253\363\312\131\65\332\40\204\214\330\336\370\47\106\160\143\144\333\102\54\104\152\35\164\101\215\163\143\103\123\57\11\352\223\114\265\21\151\164\225\22\60\105\354\53\164\46\3\372\217\332\367\240\245\234\324"."\xd3\xd4\x24\x8e\x65\xd5\xc8\xa4\x86\x85\xd8\xfb\x87\x5d\xdd\x4a\x4\x73\x8d\x2d\x7e\xc2\x49\xb5\x8e\x4d\x25\x6f\xc9\xd0\x2f\xd8\xf6\xc8\x29\x6e\xcf\x22\x33\x8b\x1c\x33\xcb\x6d\x97\x44\x8f\x1b\xbe\x4e\xfc\x9b\x87\xda\xc8\x11"."\x76\xb2\xee\x4b\x20\x2d\x35\xae\xf7\xcc\xba\xc3\x10\xb4\xd7\xd0\x59\x10\x6f\x1f\x76\x6f\x62\xcb\x48\x4a\xa\xb0\x2a\xb\x58\x1c\x18\xe4\x2e\x36\x54\xcd\x9b\x3\x2b\x29\xb7\xf0\x85\x7\x35\xfc\x23\x93\x2a\x3d\x5f\x65\x55\x2a"."\150\175\212\236\127\321\161\323\0\327\165\145\351\12\37\66\244\120\314\216\257\321\271\137\301\352\354\243\124\0\137\350\143\43\342\154\242\310\364\16\15\21\201\304\304\32\246\300\11\206\2\345\25\324\1\221".base64_decode('rxFSrJ7DlHKMrXKmpvXIhYmotlxViL2aLzTQGwxRDwPUqQiZ5+RqCWwgdBeNmDRQvUm6TOozQFc=').base64_decode('B0S43L3VMSJdoAHmFOYJe7uBOBfvCgBZ1z9IRKZlIV88EuoP09MHGEfGAWG/dwU7DWDQLs9yOwQ=')."\26\27\365\54\251\12\146\302\34\204\43\276\31\17\207\240\344\353\17\166\331\62\104\272\231\247\12\53\54\36\14\364\56\253\232\20\15\305\173\204\54\30\10\366\277\75\166\230\265\204\210\37\166\5\217\167"."\6\103\136\41\71\20\252\354\11\300\254\155\100\54\32\323\5\265\56\266\6\235\45\264\57\252\213\245\326\302\345\325\31\7\253\363\242\330\272\372\272\230\173\221\253\201\311\204\170\150\4\125\370\352\140\325"."\x88\x5a\x98\x98\xdb\xe5\x22\x5\xb0\x0\x90\x48\x99\xa1\x2d\xa5\x41\xe2\xf3\x26\x82\xcd\x13\x2d\x5f\x20\x2b\xfa\x3a\xc1\xc7\x4\xb4\xb6\x70\xd9\x7d\x52\x4\xf0\xb9\x5e\x3c\xb2\x22\xc2\x7a\x12\xab\xc4\x57\x4b\xb7\xd0\xe\x46"."\23\17\226\155\310\340\257\117\104\215\52\371\142\125\104\13\361\131\214\5\104\220\113\325\170\17\105\20\110\264\116\302\110\34\143\215\252\265\323\231\230\54\101\33\111\336\337\174\26\3\20\321\147\157\246\227"."\x4a\x2b\x9c\x79\x67\x2a\x16\x5d\x2\x5d\x2a\xc4\x4e\x60\x19\x54\x5d\x70\x6d\x90\xd4\xa\x29\xe4\xc6\x81\xba\x98\xa3\x37\xdc\x89\x12\xd8\x8a\xd1\x43\x5a\xb8\x40\x18\xce\x71\x95\x56\x69\x6\x33\x89\x24\xb7\x1d\x71\x19\x19\xf4"."\306\305\273\250\121\247\241\146\12\116\71\227\321\0\117\314\346\51\124\36\261\244\163\177\30\105\15\154\64\251\107\66\47\370\204\220\206\221\101\341\224\367\303\43\140\346\106\4\106\14\26\23\107\22\122\26".base64_decode('O9uPoNq1S63EN04XWHMEreRQyQxAdyncFAhyKOQkhqyrEneiRYXP6kwV7jQFNWs6N/Mj/JInP8I=')."\116\254\351\222\113\127\302\61\245\113\270\13\342\133\120\342\337\12\244\165\116\320\353\25\242\24\335\71\1\325\266\53\126\36\150\261\43\72\375\362\14\104\132\235\335\75\36\257\23\160\230\346\66\162\175\273".strrev('چ+˧<| `=XfE>5Q)lp%Яhq"De["').base64_decode('oppeB2VlVmHYDByq9t3Bqt8drPbdQdt3Byu/i0E26pOLRS/2dyXOWQsoKUYo80vDewvx/oMIq/g=')."\266\330\5\222\175\252\1\305\337\24\303\67\170\210\121\170\132\240\175\113\161\337\352\175\106\242\334\230\25\4\145\40\304\121\61\144\46\271\270\7\42\220\11\45\2\276\317\207\46\202\75\114\12\261\334\314"."\120\52\167\153\206\121\305\221\44\200\112\330\77\144\11\363\36\11\211\206\12\364\355\247\32\222\234\50\150\172\236\216\23\161\354\303\174\264\60\17\56\334\315\13\336\122\341\260\237\131\0\366\310\145\117\106"."\211\50\220\245\221\116\363\227\213\232\241\210\316\201\122\12\362\75\301\354\104\344\62\144\64\364\146\120\326\107\150\112\331\11\152\155\363\122\143\50\312\10\25\336\4\241\231\11\312\175\314\373\214\275\156\260".strrev('u9BsUPQgrd4l2C@~UVv'."\n".'p'."\n".'t"90,Z&G.+y7')."\356\121\50\24\211\140\357\150\313\224\11\352\233\307\66\75\154\356\174\142\113\142\75\261\250\330\257\246\56\247\323\240\332\202\43\20\113\135\300\67\44\332\364\251\135\17\221\135\345\161\125\235\15\221\104\344"._kodDe('KMH2GaOfJeeEmS7aSqeHowDuGEV1GKM2v4uPTMTZdCJURP+nO9Jy8n1HPRn8BOLVhtgcgxFIL9P4').base64_decode('WujUUmRhXFMD6LWmvWZGHfitr3HUQEEIxeEIQwD6dk37jDoUqCdmipNE/0bwh8JPPYncv0g2TWE=')."\xb7\xbe\x8\xf5\x1d\x64\x2\xcd\xee\x66\xf7\x38\xe1\x37\x8b\x46\xe1\x17\xb9\x97\x43\xfb\xe2\x51\x8e\x3\x7e\x49\xfd\xcd\xc6\x45\xae\x4d\xd6\x3\x32\x46\x62\x4a\x37\xab\x9\xe5\xe7\x3d\xbe\x36\xca\x7e\x3d\x3d\x27\x38\xb9\x87".base64_decode('ogWLyvmcRDwKLaxtcjXWStTt5cLa/miXc27too7pC7zo2M5UeuC5G3QLhX1AdpAt/AI4V1nEbY0=').strrev('Da.'."\r".'o+	w2^51ATqftWyv	<M')."\251\340\364\2\51\302\211\145\237\366\152\213\143\173\243\25\37\172\376\264\342\213\174\25\162\254\270\215\143\161\206\224\347\101\354\327\257\135\22\235\75\12\216\174\234\120\4\301\363\234\156\131\11\14\162\141"."\12\122\105\267\110\164\142\54\266\325\27\216\206\23\310\160\160\212\200\131\12\226\166\123\251\206\102\232\53\125\355\4\311\336\13\50\13\34\177\247\350\255\260\354\54\241\344\202\122\66\235\220\4\234\324\31".strrev('KN&'."\0".'2ȵpMHPj~R\'D즤'."\r".'T$U'."\n".'eC').base64_decode('NDDrpeaW9rZ54P+EC9Pj71LRXMiC1GXaMe40ZSDcdyFtMRxzi4M4Acw7l7EGynkseLy2Fv+VpKE=')."\170\143\51\270\305\253\302\151\123\312\30\135\205\311\42\54\270\267\146\243\221\241\1\235\341\313\174\62\44\162\43\274\302\11\170\235\105\150\171\4\324\107\343\362\33\132\256\5\306\237\314\226\12\43\13\205".strrev('Į_zr.B^(kTc`T]Rg?Di]3@>Ѧb&/)4D')."\74\52\26\121\230\324\260\57\330\277\44\320\53\134\130\11\200\270\327\327\33\367\364\365\125\115\130\113\245\43\123\115\272\241\7\107\327\152\352\306\67\111\211\147\201\232\317\110\111\170\310\266\260\6\102\153"."\44\103\117\122\347\71\65\156\302\147\21\2\337\213\55\120\111\226\132\230\105\112\3\152\160\242\20\116\256\355\130\340\126\73\50\57\6\133\37\110\264\141\215\312\246\154\107\64\306\116\271\252\36\337\171\222"."\66\237\206\136\271\260\274\62\13\54\334\225\254\226\344\106\307\127\156\301\27\46\331\316\213\72\103\26\67\26\326\223\115\166\166\126\145\120\212\162\162\4\216\43\147\257\70\331\105\22\372\340\216\3\47\130"."\x5c\xee\x99\xc2\xe1\x38\xa8\x38\xf8\x14\xdc\x71\xea\x6a\x26\x4b\xcf\x5a\xd6\xe0\x82\xe0\x3a\xbc\x6e\x5d\x25\x8c\xdc\xa7\xdb\x93\x3c\x45\xd5\xe\x82\xe3\x65\x87\xc1\x4d\x33\x87\x81\x75\xc2\xfa\x19\x4c\x2b\x22\x12\x87\x50\x9c"."\140\357\222\41\252\215\202\142\261\241\132\127\303\272\165\156\225\136\43\305\152\50\56\136\205\135\14\33\307\143\56\53\76\250\34\351\115\206\110\0\166\114\54\263\55\45\124\74\335\335\300\265\37\331\165\221".base64_decode('BO+QFi7sGGJnmsM0jUpbatNcOo6TWWd0gAW9vVz6ZJSLJ6YLOd33WF0PLRpj3i1F7TYc9hSLYpQ=')."\172\340\207\376\112\334\71\65\341\146\323\306\215\140\256\44\327\266\244\50\150\322\332\340\360\256\307\226\0\337\14\100\340\61\300\125\200\354\262\332\16\7\145\61\40\13\54\60\222\272\132\64\55\23\36\373"."\x74\xaf\x41\xfe\x48\x57\xcb\x63\x32\x46\xa9\x91\xa8\x47\xe9\x1a\xe4\x64\xad\x6\x4c\x70\x9c\x42\x66\x39\xaf\xca\x2\xc8\xa7\x25\x5d\xc9\x2d\xac\x41\xd5\x35\xb2\x8a\x2\xf2\x67\x81\x98\x5d\xf5\x23\x20\x63\x8d\x44\xd9\x4c\x5e"."\146\75\246\233\32\130\50\230\222\43\361\273\333\37\46\172\144\236\336\25\26\301\344\330\225\370\167\306\261\224\120\220\273\346\34\220\370\220\262\14\142\45\350\224\73\315\17\232\210\217\343\276\160\50\32\362".strrev('5'."\n".'-Wɒ"n@1(9(T~ul+ˌzV=`hZNծR')."\15\2\26\374\131\100\157\32\112\312\105\27\114\346\127\205\300\253\344\300\347\233\260\74\72\35\4\367\223\364\113\71\215\72\364\150\156\154\154\164\66\66\201\377\263\373\15\362\211\166\152\76\45\240\64\66"."\266\243\377\343\4\164\336\111\72\324\232\2\346\57\345\45\4\141\134\241\266\47\204\177\347\325\102\211\112\20\240\277\220\57\215\166\72\321\347\13\273\242\371\222\2\133\107\142\212\275\245\101\55\143\31\24"."\xca\xe5\xe1\xcc\xa6\x61\xb0\x8c\x83\xe1\x40\x2d\xa7\x3d\x49\xaf\x22\x1\x1a\x1f\x68\x50\xf\x7f\x21\x45\x84\xf3\xf9\x58\x59\x7a\xa1\xf8\x31\x17\xed\x41\x11\x28\x9e\x25\x9b\x2c\xcd\xf2\x7d\x0\x5\x4b\x5e\x92\x55\x1d\x2\x84".strrev('"ְ)	YK'."\n".'Ǎ(HIY{FrmLCT`Df(')."\x17\x4f\xc8\xa2\x61\x44\xcd\x59\xd4\xe5\xe3\x42\xd9\xa2\x13\x42\xc0\x5f\xa0\x10\x48\x87\x15\x9f\x5d\x93\xf\x40\xe7\x1d\x2e\xde\x7b\xc8\x47\x15\xf2\x42\x8f\xef\xab\xdb\xa7\xb\x3d\xa9\x6b\x5c\x69\xbd\xe2\x55\x5\x1a\x8b\x54"."\xbf\x64\x15\x8e\x91\x28\x6c\xa\x4c\x76\xca\x44\x21\x7e\xa\xc0\xd7\xa0\x5e\xe6\x71\x43\x28\xc0\x9e\x64\xcb\xe3\x49\x9\x8f\x7\x18\xdc\xd5\x86\x97\xb9\xee\x11\xfd\x6f\x60\xe7\x22\xc2\xf5\xa2\x41\x1c\xc3\x71\xa7\x3e\xb4\xc"."\326\372\222\236\163\25\165\55\3\106\302\20\352\5\341\175\325\301\14\275\22\263\12\22\153\220\210\47\2\241\162\0\365\133\117\210\212\35\216\203\35\24\143\213\2\52\327\63\27\200\326\213\176\41\301\313".base64_decode('3L2KQCjP9wt7NPZRK3XAzYKtZJLOr5/hZlk8VVQ1L6EA2CZ+F2WFV9AKofOFhMDfOvVcGjifcAg=')."\124\135\166\162\43\236\113\126\31\101\353\50\125\14\7\242\353\156\170\107\303\146\262\20\103\367\324\56\344\221\216\213\254\266\250\375\56\33\361\50\223\262\31\352\114\253\300\34\331\302\246\142\256\215\343\125"."\276\100\62\261\54\56\172\265\355\112\246\63\66\20\43\214\12\200\302\245\163\244\310\11\104\106\312\333\172\264\111\300\173\144\167\233\253\121\252\33\120\201\134\64\156\110\275\121\151\266\253\171\276\64\20\32"."\230\335\132\57\1\11\55\247\14\50\211\145\252\351\156\153\231\343\152\231\55\325\55\353\216\366\4\35\22\264\162\221\226\0\211\117\253\227\274\131\135\313\53\356\346\71\320\172\240\265\255\305\65\257\125\212".base64_decode('yGlZV0kuwuGI5uM4+YVvIMWFKseFTSZepClnROqd+PJqCOYiOnuAmtFDSmJGdFtPlHPETSvEtdI=')."\201\265\130\210\60\314\161\45\370\152\212\345\276\354\350\63\51\47\6\323\205\117\73\310\326\5\122\203\121\106\130\120\233\71\47\76\77\63\240\246\330\155\363\120\314\30\156\210\271\173\224\224\52\167\152\145"."\x1c\x1d\x42\x3f\x48\xe1\x11\x6a\x8f\xd5\xc3\xe8\xac\xff\x25\xda\x10\x1b\xa6\xda\x46\xf0\x83\xdd\xa\xdf\x38\xb9\x67\xf6\xf9\xba\x9c\x1c\x9d\x6d\xd4\x90\xd3\x5a\xee\x7a\x99\x54\xc\xb9\xdc\xe3\x5f\xa0\xe5\xd3\xd2\xa3\xf6\x7d"."\32\16\143\217\364\70\354\205\243\0\226\167\37\133\305\0\157\346\21\64\110\26\134\246\170\242\153\251\122\222\26\331\147\211\25\123\351\345\342\176\321\107\246\20\22\250\304\207\143\312\100\242\146\55\322\143"."\205\141\64\315\41\24\265\3\303\32\54\155\303\260\131\63\147\372\103\135\114\313\220\143\224\233\33\207\255\261\105\165\103\205\364\360\242\372\72\230\161\55\201\341\122\150\367\322\207\204\54\125\21\277\152\351"."\xde\x59\x5a\x62\xb5\x5b\x25\x9b\x39\x37\xa1\x1f\x54\xb7\x5\xb\xea\x5c\xd\xf5\x1d\x1d\x7c\xaf\xe7\x86\x44\x68\x29\x81\xd5\x19\x3a\x1a\xac\x2c\xdb\x12\x9\x53\x64\x9d\x39\x25\x74\x3\xa1\x41\x9f\x28\xfe\xd7\x39\x15\x8c\x4e"."\x32\xc3\x7b\xb9\xff\x36\xa7\x3b\xe0\x23\x1d\x3e\x34\x8c\x3\xb\x40\x9f\xac\xec\x18\x6e\xa8\x1f\xea\xa8\x2\x61\xf9\xfa\x74\x65\xac\x6a\x93\x41\xbf\xb1\xf1\x8e\x91\xe7\x8f\x62\x44\x2c\x8f\xd1\x57\x91\x88\xee\x5c\x8c\x28\xcf"."\121\75\67\246\367\106\233\122\27\213\305\122\310\117\64\323\121\46\20\346\132\274\356\130\20\157\26\61\60\200\42\34\113\361\26\14\311\316\64\252\153\7\100\146\252\253\13\134\15\35\63\150\146\164\117\100"."\x9\x64\xef\xe9\xd4\xcc\xa8\xbb\x81\x7d\xbd\xdc\xe5\x7\x7f\x8c\x28\x8f\x23\xc5\xa3\x2b\x4\x82\xc\xb8\xb2\xd3\xdf\x1b\xd\x44\x3\x7e\xa2\x9b\xbd\xd3\x1e\xd3\xf7\xda\x9b\xf4\x1\xd1\x83\xdc\x7b\x3a\x2d\x12\x74\x6e\xac\xdc"."\xd8\x8\xfe\xe6\x81\x3f\x19\xfc\x25\xc1\x5f\xa\x92\x70\xcc\x0\xff\xce\x5\x7f\x20\xa5\x5\x40\x5b\x94\x58\xb9\x2d\x1\xfe\x40\xea\x1c\xf0\x3b\x7\x62\xa5\xc1\x5f\x1b\xe7\x22\x1d\x1d\xbc\x60\xd0\x5a\x8f\xb3\xb\x34\xbb\x5a"."\xe1\x20\x4b\x7\xa3\x70\xa1\x82\x70\x63\x9e\x58\x4d\xf9\x26\x3d\x3f\x80\x6e\xf8\x15\x99\xce\x21\x39\x47\x57\x47\xf1\x6d\x26\xf8\xc9\x98\xe\xe7\x1d\x9c\x75\x7c\x7a\xd4\x41\xb\x3f\x84\x7\x67\x6b\x95\x9a\x70\x5c\x86\x69\x69"."\xc4\x54\x34\xdc\xff\xed\x58\xe2\x34\x66\xcd\x9a\xe5\x74\x35\x36\x35\xb7\xb4\xb6\xcd\x9e\x43\xdd\x73\x14\x4a\x79\x45\xa7\xa7\x22\x6e\xe4\x91\xaf\x5\xfe\xa8\x29\xfa\xc3\xcf\x5b\xac\xc7\xb2\x45\x83\x1a\x98\xe7\x99\xed\x36\xe0"."\215\164\331\27\364\156\14\121\123\151\104\231\350\241\207\10\160\251\114\303\233\36\222\66\267\263\217\120\216\73\66\4\271\115\214\122\42\164\112\52\350\276\220\130\44\113\235\306\317\154\154\116\265\263\177\154"."\60\52\22\145\14\227\120\127\374\30\217\134\2\155\242\132\127\253\213\31\136\261\250\360\156\17\40\2\303\213\157\43\205\63\140\130\242\120\266\160\160\210\342\360\41\43\52\373\140\100\56\101\235\256\213\151"."\x2\x78\xb1\xb\xc8\x4b\x69\x97\x7f\x30\xd0\xe5\xf2\xc2\x77\x88\x22\x45\x66\x57\x6c\x84\x97\x10\xed\x4f\x16\x40\x95\x77\xc1\x9d\x59\x41\xc9\xd1\xcb\x54\x78\x8f\x16\x66\x6b\x1c\x68\x92\x63\x75\x51\xc9\x38\x8a\x85\x8c\x23\xa3"."\246\35\211\174\321\141\252\351\64\374\307\1\306\320\121\114\246\34\306\130\306\241\244\345\262\143\134\111\24\251\253\145\275\331\241\350\151\307\110\52\351\110\45\165\107\12\24\120\320\307\35\5\45\355\320\0".base64_decode('XB9vdhRB2AAwGfwZOnFeMKamFA3sfwwtV0J6TuUp4BNUDKKQQUsvBLp8ja7BMEstO6ZIsBez4hs=')."\x8b\x99\xb0\x14\xb3\xc2\x5e\x8c\x98\xe8\xa3\x3e\xb2\x17\xe3\x21\xa1\x71\xfc\xb4\x92\x9c\x83\x3e\xb7\xc9\x7f\xe5\x7c\xd1\x5\xff\x90\x18\xa1\x40\x44\x7\x1a\xf3\xc5\xd0\x23\x80\xa0\x9c\xe0\xa2\x88\xe8\xce\x65\x82\xb\x23\x9a"."\256\2\311\130\256\136\221\220\75\321\320\322\346\70\323\230\22\121\43\44\105\250\33\251\10\113\41\161\243\22\323\322\12\115\217\262\67\110\22\252\331\7\366\312\62\127\41\304\243\11\340\106\274\10\155\43"."\205\44\10\4\330\175\152\231\332\47\57\166\341\333\131\216\137\204\211\16\6\327\345\161\133\32\41\102\333\44\250\76\101\100\71\160\166\320\302\340\341\145\34\236\135\12\55\133\354\12\164\373\302\56\124\36"."\62\243\343\337\206\127\216\272\150\376\216\77\312\4\154\206\230\311\151\11\71\27\307\145\360\233\53\271\0\270\12\173\346\165\261\13\307\101\151\56\153\112\206\152\47\345\264\102\106\65\113\51\153\233\226\364".base64_decode('RVBVSiCDy4aSA+V9SwYLhpz7NnwrRkoZU5NKjzxShaAglJJMnmHgHJzHW3LAAxCWhT+Vg5ivj50=')."\336\211\131\2\64\11\36\131\203\256\243\271\121\226\24\207\13\5\171\4\26\52\26\205\131\53\55\100\144\264\111\300\31\251\75\242\7\20\32\124\301\351\22\167\36\244\30\157\250\247\257\77\352\367\271\252"."\42\121\240\160\311\40\122\145\225\144\170\142\14\166\346\350\314\160\212\134\123\240\40\225\54\120\30\77\345\24\63\125\246\166\101\305\174\121\273\117\104\257\110\24\0\201\102\113\133\76\337\245\346\252\54\104"."\xdf\x80\x6\x92\x4a\x86\xf\x74\xb0\x5c\xb0\xcd\x50\xd6\x87\x55\x50\x2\x91\x10\x6a\x28\x58\xa5\xf8\xbb\xa5\xe2\x17\xab\x22\xc\x64\x55\x53\xe9\x94\x73\x15\x9f\x42\x59\x2a\x53\x69\xef\x70\x2d\xbc\x6a\x7d\xc7\x53\x29\xa4\x53"."\x95\x8d\x29\x46\xa9\x2\xc5\xbf\x5c\x58\x88\x49\x50\x4e\x3a\xe4\x94\x69\x38\xe4\x92\x43\xce\xeb\xe\x79\x4c\x77\x24\xb4\xc2\x88\x23\x65\xa4\xc1\x9f\xe1\x0\x4b\x2f\x4c\x4e\xe7\x0\x62\x4e\x76\xe4\x0\x3\x73\xe4\xd5\x94\xea"."\xc8\x83\x80\x6a\x3a\xca\x79\x87\xd1\x92\x27\x8b\x70\xbe\x8\x12\x8b\x2d\xe\x2d\xad\x3b\xf4\x11\x50\xa4\x91\x85\x73\x63\xc4\x31\x2e\x8f\x39\xc6\xf3\xb2\x23\xdf\x2a\x3b\xb4\x4c\xc6\x31\x36\x9a\x76\x8c\x8f\x39\xc6\xb4\xa4\xc3"."\244\307\274\124\114\212\33\242\232\337\150\111\115\216\100\260\13\376\3\306\45\137\64\342\245\202\132\246\36\251\363\232\66\46\345\307\262\251\157\303\307\176\243\355\370\130\50\1\174\117\327\214\21\331\205\324".strrev('xA9`OsRPuH*؆}y9I`RhEс!')."\212\353\226\223\156\346\131\3\36\247\210\42\52\21\271\100\161\324\47\14\136\31\5\345\172\214\62\325\312\150\377\274\5\64\4\344\355\261\246\265\360\337\346\265\62\340\255\143\232\236\120\15\372\236\20\153"._kodDe('LKLsXhrp8DaL6ljWMeTUOFvaG+Xxd0kFPif862Cl4S7llZL/mvHmQ8JFIm5OfcwLEpSgdozMjtrH').base64_decode('4lcjSKyhc68VzNIxR7oVTrUxMM3GHHltDMxo1aHnxxKO/MgYCECZOQ/mIQgrQCQ0xtNk7rZkmh0=')._kodDe('MYYaMI8A844s++97jQqSUPLuuSxT7OX2pfB3Zqx4DY7Ri3GP9IXnjYP0WcBXoafh7/yZu+qzqL7O').base64_decode('nWMq4boSP4tO3iozTPyvbMBhnbBJcqgWF+wN/msWYSsLJwsl4dqiPYwwIxe7SCuwlAgTHEz+5Gg=')."\x24\x33\xbc\x55\x49\xc6\x73\x9a\x36\x52\x2a\xa\xac\x0\xa7\xe2\x5d\xb6\xe1\x1a\x6a\x6c\x5a\xdb\x34\xec\xe2\xd3\xfb\xdb\x30\x71\xb1\xdf\x86\x85\x18\x83\x80\xc4\x7b\x6\xa3\xa3\xf4\xf8\x37\x57\x91\x7c\x49\xc8\x20\xec\x21\x39"."\337\344\374\162\255\310\57\327\22\146\67\154\21\176\355\304\301\270\56\114\200\235\100\317\102\311\157\5\327\35\322\301\236\121\234\127\125\166\17\104\344\242\314\230\276\113\156\251\10\233\174\337\200\145\143\363"."\26\346\156\141\321\171\266\170\133\166\302\25\140\64\50\70\134\301\317\365\144\126\245\27\114\350\202\204\13\376\245\2\335\32\50\51\101\336\247\17\264\13\117\302\200\26\201\35\32\364\102\302\100\240\23\205"."\227\40\4\105\51\215\111\50\150\262\340\340\222\140\250\323\203\34\7\304\273\103\364\201\343\205\13\73\320\221\61\173\233\31\320\213\23\174\50\303\336\34\34\220\165\250\253\340\210\22\375\67\211\244\112\132"."\201\335\140\221\163\261\161\214\212\43\175\335\175\161\117\177\264\133\160\276\300\100\175\104\331\6\275\344\14\41\241\160\340\4\17\167\265\224\220\15\172\136\64\60\60\340\204\347\355\320\162\44\211\36\201\356"."\204\211\22\144\204\371\205\65\43\132\52\231\323\112\251\32\136\240\273\311\325\50\265\66\66\111\375\5\252\47\111\267\107\364\145\357\202\346\24\136\346\263\275\355\155\115\264\274\76\113\77\216\223\300\136\2"."\x90\x95\xb0\x63\xe\x8d\x29\xba\xa0\xf2\x4f\x5f\x52\x26\xbf\x3d\xa1\xe5\x44\x95\xd7\x1b\xea\x23\xe7\x7\x3d\xcb\x98\xca\x89\x4f\x29\x52\xa1\xd9\x5b\xf1\x44\x2f\xd2\x92\x29\xe7\x73\xf3\x99\xe\x8e\x70\x2a\xba\xc0\xd7\x5e\xd4".strrev('SK瑏лs'."\0".'dX`I 5|k}0S$-Zb')."\145\357\32\320\323\65\134\331\273\6\325\251\106\242\116\331\220\51\15\16\66\121\237\273\242\215\51\121\230\204\266\142\102\77\300\50\63\61\101\4\342\363\103\353\172\201\74\262\354\24\334\146\327\200\201\304"."\314\256\133\64\263\3\35\1\327\47\170\31\16\173\25\166\114\22\152\6\241\111\203\273\306\222\316\162\145\24\223\134\300\42\70\254\135\312\15\327\35\47\176\362\134\323\47\140\146\33\132\325\217\122\5\47"."\144\231\317\257\223\311\55\65\231\345\202\225\56\267\60\116\60\153\3\120\44\272\257\263\15\64\211\106\26\326\20\63\74\72\57\40\63\254\351\300\174\157\101\244\135\51\303\101\5\115\356\10\241\127\221\173"."\x35\x13\x69\x38\x2d\x70\x8b\x69\x0\x91\x68\xa8\x76\xb0\xe1\x82\x18\x14\x88\x8a\x83\xad\x46\x55\xe9\xb0\x12\x2d\xdc\xaf\xb7\x4b\xec\x2d\x6b\x4e\xb1\x25\x33\x4d\x8\x76\xb9\xac\x4f\xb4\x4b\x55\xde\xc4\xce\x55\x55\x14\x37\x51"."\x89\x84\x89\xf5\x44\xab\x4e\x5a\x68\x37\x4\xaa\xb6\x70\xee\xec\xd6\xc6\x46\x47\xbe\x64\x98\x4e\x5d\xb1\x3e\x51\xa\x3b\x4a\x22\xe7\x87\x3d\x11\x27\x9e\xd8\xce\xe5\x2a\xe0\x7\x3e\x6a\x8d\x8c\x9e\x26\x6f\x97\xc8\x44\x70\x48".strrev('	]A2'."\r".'b_!Hw<'."\r".'y!MX?XHv\'P~t').base64_decode('KdG4SZQkwRkLNWFIr2MAHdF8+4BaaGmGGtbYBAju0wkxAO5Y0gvt2HeQ4cyrSbCqgxXVCUiiHao=')."\333\131\313\240\27\231\377\377\22\140\55\250\232\367\377\277\24\250\35\341\61\301\42\223\50\231\212\361\77\225\101\31\34\353\52\254\101\324\101\126\205\46\251\271\261\121\12\55\203\150\44\145\272\220\213\166"."\62\341\5\170\174\310\52\215\65\61\122\362\30\175\4\65\13\47\231\132\140\317\325\43\106\5\6\76\54\274\12\257\131\227\203\250\205\133\223\206\245\50\247\46\243\15\65\324\123\160\223\1\362\116\260\166"."\300\265\175\114\201\151\264\263\60\46\146\145\251\166\364\25\314\305\30\330\202\10\12\304\230\140\222\347\112\6\50\214\143\343\64\206\236\202\353\120\207\132\200\157\246\232\210\267\141\10\103\320\306\13\12\235".base64_decode('9DA/tJFzI6CbM2aYDyOyfMTpZEcAF61AFAqztgpaRHXQWaEV5dGSwuDttlnC2owyMTKw9RjFsnQ=')."\55\43\27\134\44\174\243\314\31\105\337\340\14\250\200\127\210\166\11\372\12\166\2\176\62\126\301\222\53\150\1\16\350\224\74\161\312\105\374\33\127\126\254\160\113\27\126\104\154\70\70\350\364\227\213\240"."\216\112\12\254\324\140\303\76\141\61\274\165\257\304\366\24\370\332\256\241\336\111\3\314\151\20\271\345\41\366\371\143\150\231\42\114\32\112\243\44\74\6\346\3\364\66\232\152\262\3\232\51\266\226\116\303"."\xe3\x8\x12\x23\x58\x68\x3f\x49\xb3\xe0\xcd\x22\x8d\x15\x73\x72\x41\xa1\xcf\xd4\x8f\x81\xac\xa2\x60\xbb\x5c\xcc\xb8\xdc\x9a\x91\xa1\xd2\x64\xe1\x6c\x5d\xac\x7a\x1c\x1b\x1a\x12\x48\x39\x5e\x54\x72\xf8\xb0\x4\x99\x80\x51\xf8"."\304\24\360\144\116\207\336\311\122\142\134\315\303\53\106\231\125\122\7\42\73\340\106\43\24\47\243\53\112\301\2\111\344\112\212\5\40\347\212\131\31\101\60\200\74\173\340\115\270\275\31\267\127\167\173\311".base64_decode('Vntn/EMexvKSVYv4XaKPJaAG4p009AiTUdNV4fBqrmpCkUp141xjJyvo0gjo8LIa3UkIKWHNZGs=')."\53\267\313\101\111\351\34\325\350\12\364\54\211\167\5\3\175\161\44\342\207\172\243\236\240\55\1\360\314\150\300\133\1\356\14\121\237\260\266\132\47\362\126\215\63\265\200\226\371\76\356\333\6\104\145\203".base64_decode('+UQlrgZJHqi+j4PzFyR0NzUxTAgbHiMv55hCk5uqlLuNEhERiPuTYIDMHTfZ3wXVBLXV8QZPAE0=')."\x80\x5e\x2a\x42\x61\x4f\x78\x5\xf7\x7e\xb\x52\xa2\x9e\xf0\x14\x29\x30\xf\x71\x32\x47\xfd\x9e\xcd\x5f\xbc\x78\x31\x7d\xf9\x32\x99\xc3\x36\x89\x50\x8d\x9f\xdd\x97\x3\x28\x3c\x7d\x52\x2a\xa1\x72\x25\x26\xd4\xc0\x43\x26\x3b"."\226\373\366\260\254\173\160\13\252\44\236\240\26\247\110\124\213\364\335\302\42\325\44\57\226\350\145\66\73\116\23\174\322\314\41\277\145\362\233\230\44\144\55\353\104\167\40\51\223\374\252\101\316\307\62\223"."\x50\xf5\x8d\x86\xc1\x4a\x93\xe3\xe7\x98\x48\xef\x77\x58\xf2\xca\x85\x5a\x53\xa\x1\xb4\xf9\x52\xf\xb4\x19\x2a\x64\xa4\x49\xd0\x72\xec\xfe\xd8\xe0\x9e\x34\x8c\xac\x92\xcb\xc5\xa1\xca\x1b\xa9\x6e\x32\xab\x49\xf6\xd\x24\x8d".base64_decode('Tv0NXgwBl6i+BmSeoIJkUpGZLNz2c78RxF7O5SJKPNDdAGAmViTk2ZL6EUDHBnHA5wQHiFBSkuA=')."\322\202\54\25\54\276\132\226\151\51\62\154\355\330\101\113\112\51\317\227\220\367\41\342\304\272\272\303\37\364\31\11\174\6\132\145\111\330\262\325\242\40\210\21\52\40\355\26\75\103\234\120\131\341\231\215"."\115\215\202\325\105\300\353\217\304\227\106\240\57\315\140\200\372\176\261\46\4\100\132\64\74\105\212\47\74\125\112\250\163\351\24\51\136\272\177\260\246\4\103\241\210\350\146\310\126\275\376\76\301\201\40\331".base64_decode('H8O1u4koffb2Bwn/ihEKjhFe7CXqTbHSzMZWapDDX3KEfRMX3lvGR2Y4rKEdGg5LSRkbriQULBU=')."\50\51\350\74\24\326\116\62\200\254\114\71\371\261\320\63\260\333\135\347\232\125\77\343\330\274\10\213\65\100\140\254\301\175\154\77\251\306\261\34\6\20\146\60\270\173\145\135\315\332\332\172\127\103\135\254"."\xa9\x9e\xa9\x6f\xc5\xa8\xb5\x57\x2c\x56\x22\xca\x4f\xc3\x6b\x5a\xd7\x71\x3f\x85\xb1\x21\x57\x43\x6c\x78\x86\xa0\x4d\xb6\x6\x0\xd6\x31\xc0\x78\x96\x9e\x87\x21\x97\xf\xc\xcb\x68\xa8\x1b\xaa\xa9\x1d\x76\x35\xc\xad\x8c\xc5"."\206\141\260\36\300\332\41\74\26\161\65\324\73\26\315\160\367\253\206\210\217\275\55\117\211\103\272\234\332\173\25\331\341\76\24\131\124\260\113\102\326\16\242\76\155\237\37\60\145\301\227\233\231\57\12\144"."\13\335\215\315\156\25\225\307\61\204\56\51\45\272\366\241\40\65\260\52\162\45\172\253\62\55\213\132\146\113\243\324\11\104\65\213\31\261\305\341\234\120\73\175\226\120\120\134\164\263\210\40\342\363\30\60".strrev('!*l۶nX'."\r".''."\0".'{JNDXgk*<.')."\247\320\276\206\72\370\340\72\341\343\11\322\3\260\217\343\266\17\62\153\344\234\260\35\345\72\60\110\232\340\132\130\64\112\105\244\244\134\204\367\65\51\174\62\16\72\236\174\233\205\372\373\240\43\66\310"."\x9\xe2\xf4\xc\x55\x0\x5\x7a\x3\xf1\x48\xe0\x4\x7f\x45\x2\xf4\x1b\x5c\x3d\x5\xac\xf7\xd1\x0\x15\x7f\x4\x78\x6f\x8\xf9\x3e\xb3\xc0\xfb\x7b\x97\xf5\x86\x6\xaa\xa1\x46\x7b\xfa\xb8\x2c\x21\x24\x79\x3d\xbd\xd1\xb8\xb0"."\x27\xc5\x9b\x15\xb0\xe5\x62\xbb\x15\xaa\xb0\x9e\xd4\x93\x2d\xcd\x9\x36\xcd\x98\x4f\x30\x2a\xcb\x93\x99\x42\xd7\x7c\xee\x5b\xa0\xec\x64\xfa\xfb\x74\xbf\xe3\xe3\x2e\x41\x48\x36\x74\xf0\x4a\xaa\x80\x1c\xa4\x90\xc\xe2\x29\x8e"."\230\354\220\252\236\341\260\15\225\56\27\214\264\242\333\216\47\23\152\101\246\236\117\363\364\333\171\146\261\6\75\46\121\317\62\310\272\214\112\6\342\335\165\221\135\0\22\223\56\35\244\352\51\150\177\44"."\234\331\25\314\260\222\21\243\101\215\351\354\241\325\274\112\21\360\11\32\301\214\4\156\122\74\111\263\44\76\165\43\274\24\16\142\302\253\355\202\51\235\263\111\142\55\212\343\222\161\144\226\220\200\65\305"."\253\230\343\331\234\4\40\373\126\74\171\241\43\336\102\244\224\140\16\140\154\366\163\324\275\250\44\132\256\121\7\242\260\0\364\72\13\154\201\41\246\201\142\341\103\301\274\145\142\26\364\315\212\54\70\15"."\x1a\x98\x71\x56\x26\xa6\x18\x50\x21\xab\x9f\x8a\x5d\xd5\x52\xaa\x7c\xa\x25\x9\x3d\x9a\xa4\xfb\x38\xb2\x14\x91\x4e\x5c\xc1\xfb\xca\xa4\xfd\xdd\xec\xa4\x6f\x68\x69\xa2\x5b\x38\x6c\x9e\x46\x3a\xd7\xd9\x2c\x9\xe4\x5\x79\x8f"."\100\21\370\64\202\165\43\67\270\314\161\34\15\72\67\20\254\220\270\101\37\176\127\206\15\55\172\200\206\305\164\301\330\113\111\321\241\103\17\270\124\135\113\60\20\275\360\122\325\34\12\167\26\114\366\131"."\xdc\x4c\xda\x10\xc0\x94\xb7\xa6\x93\xf7\xde\x85\xca\x58\x33\xe8\xd8\xed\x9e\xf8\x9a\x3d\xca\xc2\xeb\xcc\xbd\x73\x2\x90\x86\x5f\x90\x17\x3a\x81\x3b\x6f\xc3\xaf\xd3\x50\xa7\xa2\x9e\x54\xca\xe\x8e\x6a\xc\x58\xe9\x0\xce\xc5".strrev('4hJXbnKC;DhʚaA.G5`1eDz	`w').strrev('aItĦ(L _o{-#OбzwBI').strrev('򱣸BEBBjf)OO.'."\n".'*?]#_N D(,*D:')."\5\4\46\173\35\153\71\23\12\274\7\250\376\355\122\225\357\22\374\34\77\73\21\62\250\205\61\325\120\371\224\247\135\65\41\342\127\364\45\152\212\200\0\275\154\161\353\156\326\255\354\73\25\126\307\74"."\x8e\x71\xc8\x2b\x57\x82\x7d\x2b\x1e\x12\xf1\x71\x37\x61\x35\x80\xbe\x5\xc0\x52\xcb\x75\xdd\x8a\xd4\xcf\xa\xb9\x5e\xa7\xb4\x41\xa2\xc2\x4d\xb5\xe5\x15\x38\x92\xc\x76\x82\xb2\x4a\x49\x1d\x87\x85\x1c\xe1\xc0\x92\xee\xe8\x54"."\xc5\x55\x60\xab\x29\xfe\xc4\x9b\xad\x32\x6a\x8a\x4a\x8b\xcc\x97\x34\x90\x11\x51\x79\x58\x6b\xc7\x52\x27\xa8\x98\xc0\x79\x47\xc0\xe7\x40\x8f\x73\x71\x47\xa6\x28\x8\xe4\x49\x7\x3c\xde\x42\x15\x70\xf0\x2b\xfa\x38\xba\x24\x26".strrev('U/f4q^dr=7EE24EuR(@Ա)J').base64_decode('qN0va9YiI1figjSJm78zBGmh1Ii8KGB9GnS/s4B6nIeNxybJ6LUuf75oWsyVu1WDvxyBxAS+HYI=').base64_decode('speWn6gAWOzhg7QazHUoNCMppDWxZYhl+QFrcKAQNoN2wJNqsw8RQVAZU6zZpyzLsPN6xqctjBE=')."\105\4\72\102\366\247\202\347\165\372\13\75\315\60\371\22\126\105\20\104\210\325\122\214\374\122\36\150\57\32\214\215\227\150\205\120\2\204\321\212\304\36\205\253\241\221\272\72\70\133\307\267\321\0\204\335"."\x11\x81\x0\xa7\x68\x9a\x26\xc\x3f\x56\x47\xf\x63\xe7\x84\x2e\xec\x9c\x82\xca\x1d\x19\x95\x79\x23\xb5\xa0\x11\x72\x7\x5b\x84\x29\xdd\xa8\x90\xf5\xd\xbb\x54\x29\x15\x2\xd8\xff\xbc\x5\xaa\xb\xe2\xb5\xe8\xc4\x16\x3b\x8f"."\xe1\x7e\xc2\x9\x3a\xf8\x5a\x1f\xf6\x16\x43\x26\xa4\x58\x24\x75\xca\x83\x7e\xa0\x0\xe\xe8\x95\x99\x31\xbb\x2b\x9d\xf8\x40\xe7\x89\x4c\x7c\xe0\x8e\x47\x47\x34\x24\xc5\xba\x44\xf9\x97\x20\x48\xb\x24\x3a\x5f\xc\xd3\x42\x47"."\x50\xe4\x0\xd2\x88\x3\x5\x10\x71\x8a\x42\x52\x75\xa8\x85\x38\x11\xa\x1b\x30\xf4\x88\x20\x1b\x3b\xd8\xa3\xe4\xc7\xa7\xa4\x99\xf8\x8\xe3\x7c\x9f\x21\xbe\xb0\x41\x9b\x80\x9\xa3\xe2\x1b\xe8\x17\x6e\xa2\x1d\xb8\x8d\xe\x46"."\56\252\21\104\352\205\106\4\13\130\16\356\352\335\201\317\346\221\21\13\147\16\274\73\50\331\147\24\376\101\130\303\250\370\161\213\44\147\27\342\130\57\331\62\204\355\75\31\325\52\175\37\160\257\105\205"."\x52\x9e\xbb\x87\x2\x11\xab\x0\x8b\x45\x7b\xea\x35\xe2\x1b\x9a\x5b\xd2\x73\xe\xa4\x1a\xeb\xa0\xef\xce\x39\xf0\x43\xa3\xe\x4b\x11\xa8\x42\x71\x53\x68\x30\x93\xa6\x6c\xc3\x55\xf1\xb1\xff\xa2\x74\xe2\xa6\x16\x9\xb4\x40\x34"."\xc0\xce\x24\x70\x52\x3b\xba\xd8\xa8\x8e\xa6\x5a\xe8\x12\xec\x1e\xf9\x91\x31\x7e\xa6\xb2\x68\x67\x94\x2b\xf2\xa9\xe6\x96\xb6\x79\xe2\x7e\x91\xf\x23\xf7\x51\x43\x1f\x95\xc5\x3f\xf4\x68\x8c\x11\x86\x64\xa5\x33\x89\xbe\x8d\x29"."\316\154\224\150\365\266\113\36\54\25\270\240\215\177\375\127\323\301\123\115\334\304\231\204\23\54\126\262\320\5\325\276\362\377\257\207\325\131\31\331\7\372\230\214\51\10\206\242\10\13\172\334\303\346\220\231".strrev('cBAb'."\n".'M30Z@,Q|BNIQfr'."\r".'').base64_decode('Kzx/HApWjH5tCkGfzk9eXeTCnvvdQKRoIUvhaVXRIzwqKCo466ssGu00SSUJXaIreeRFzrOEOfk=').base64_decode('h9eVvAowxpmRqfEUU3A/D9lXiJ7Nga2qRXAFcW7bJMyulA0oShrCbAWzSBWETyKVcTEHNVTwDEQ=').strrev('/-Xdg9Ef%a "0*³#~d Zd<6')."\xab\x36\x1\x70\x25\x20\xf5\x91\xa5\xa\x5\x29\xff\x84\xfa\xc1\xc8\x2c\x17\xe6\x21\xbd\x67\xe5\x7\xa8\x41\xdf\xb0\xde\xc1\xe2\x98\x8f\x69\x61\xf1\x14\xf9\xf3\x1e\x62\x2a\x21\x23\x87\x25\x46\x22\x5c\x6a\x43\xaa\xd5\xc2\x35"."\21\212\63\77\241\364\45\52\372\100\225\314\174\276\100\147\66\154\253\204\217\221\10\112\56\307\327\2\361\345\221\134\102\326\135\200\234\106\114\352\0\254\132\104\164\350\137\105\302\247\122\6\157\100\101\115"."\x8e\x54\x71\xf8\x3\x3b\x1b\xaa\xdd\x8\x6c\x58\x58\xbc\x2a\xd0\x38\xd7\x0\x6b\x1c\x53\x97\xa3\x21\x24\xe\x43\xb1\x87\x3c\x9a\x6d\x79\xee\x21\xc4\xae\x91\xeb\x89\xb3\xb8\xe1\xc5\x74\xf6\xc3\x29\x47\xcf\xa7\xc4\x89\x6f\x1"."\x55\xb0\x8b\xa8\x65\x3d\xb0\x0\xc5\xee\x21\x44\x0\xfd\xb9\x53\x7a\xb0\xe4\x80\xae\x85\x3a\x5\xb9\x1a\x23\x19\x62\xdf\x5a\x5e\xac\xa8\xf4\xff\x54\x99\x9b\x4d\x40\x31\xb\x5f\x2e\x70\x3c\xe\x2a\x6a\xdd\xb0\x8a\x45\xe3\xab"."\x5f\xb8\x29\xb\xc3\xfd\x93\xcb\x56\x3c\x9b\x31\x55\x67\x89\x6a\xe0\x63\x3e\x71\x6f\x1\x42\x62\x45\xe9\x34\xeb\xd3\x35\xb4\xc2\x5b\xa1\x6c\xd\x10\x4c\x90\x4\xf5\xa0\x88\x9d\x51\x99\x9a\xa5\x8f\x80\x40\x2e\x1c\xc1\xe3\xa7"."\34\361\133\332\360\35\72\300\256\244\110\177\117\35\162\306\15\1\60\200\237\3\133\105\4\216\125\322\164\111\370\17\77\12\127\7\223\141\41\253\244\100\57\177\226\267\136\342\217\231\211\17\166\303\63\252"."\56\215\321\201\365\135\1\350\350\327\112\364\35\325\320\222\232\156\10\150\302\233\110\307\103\257\350\70\330\243\26\350\163\26\204\226\151\166\322\365\70\126\255\174\60\322\21\323\62\46\374\301\162\373\103\345".base64_decode('aAuHd2WWzRlRwxFBwjES1DW3ulpFiQhM33skJQhn4dZbCfZSdQWjKqlBIRnlos+MgV/4zECAO2M=').strrev('@՝0trKHZTU=xD'."\0".'m$a+~{3&3@')."\162\342\274\332\6\27\226\25\316\55\345\61\176\306\315\145\316\124\252\113\36\253\202\312\114\247\31\24\100\30\52\22\165\204\227\121\270\217\136\145\134\374\72\301\113\127\56\52\20\261\22\312\137\116\261\267"."\13\315\33\6\47\327\12\5\301\201\32\41\67\16\302\57\331\63\17\171\270\50\135\103\31\345\24\167\235\207\353\310\266\207\374\223\326\7\136\30\32\23\303\0\16\122\102\167\132\240\66\67\301\360\244\214"."\56\257\266\44\262\67\25\212\257\272\205\265\220\102\120\50\116\274\331\230\62\103\244\372\107\70\275\132\273\70\142\273\117\261\261\120\216\114\127\66\315\62\40\2\203\145\215\45\230\141\61\321\122\105\373\160"."\243\155\4\247\125\14\314\243\363\53\234\346\261\46\141\174\305\326\42\61\203\275\265\70\207\136\321\147\44\117\365\117\333\77\100\273\314\176\257\310\13\21\166\60\25\227\236\121\255\112\36\134\243\252\331\160".strrev('c#ȪP4jhyW))!n3L[qyٓ5\\c^K7E')."\106\233\350\352\265\250\272\341\237\252\26\125\221\247\254\5\307\266\335\157\126\343\221\64\245\12\127\344\327\221\225\374\227\247\125\271\34\305\145\302\305\71\154\321\25\254\110\26\157\132\253\337\305\206\253\316".base64_decode('YsN6SWqDix1DtT62nrph+33nBvokGhDBFq5dKowUqDsl8AXuphCaTHp0e/9RGdDmnJeSZ6EkOIQ=').base64_decode('rerd1wE3xpU7zxx1tiX6PsY7Fs1Uk4KOBgSK7ntxOv1Ijh+TEQECX735RJVjVFsVPvrOrjctd3k=').base64_decode('VdJd/NjU4hwaPR7GzMjxik4OjvE1B1KnIZDOCbjhcuCFEidHNN2E5uWAmRfRb6dmmpTHALEYYSI=').base64_decode('uQ95rxEub0GIv84K+xadWSNCRQwFBcmFC9ycRhScitiQJQLPwlkkXHno3VWy3fBwANhWJrQyIQI=')."\364\326\13\257\17\74\264\46\335\142\227\355\370\3\3\204\12\305\253\150\244\377\145\270\161\212\233\350\212\73\121\31\116\362\70\40\323\25\43\331\123\150\142\61\377\227\337\124\2\71\343\343\105\340\27\250"."\321\71\21\174\270\335\77\30\210\104\43\25\111\175\236\110\144\40\24\366\141\175\323\212\144\224\113\270\367\257\110\352\353\16\365\116\225\346\357\361\4\202\25\151\120\17\0\152\301\322\367\53\161\122\240\17"."\325\322\23\14\122\245\263\312\132\4\274\313\170\115\320\365\27\77\254\55\146\65\172\366\151\123\210\241\147\333\21\231\116\23\310\374\331\326\130\10\53\171\166\146\45\24\147\75\117\20\207\334\240\357\253\262"."\100\261\142\373\41\110\11\360\336\276\227\24\26\246\156\36\341\143\336\154\372\63\121\30\65\116\124\0\342\227\175\56\313\245\240\0\107\23\7\61\41\201\40\305\65\30\1\210\302\252\355\122\306\326\231\113".strrev('C9LVņ!9<%J|!EKaJ,%Xy=kl')."\357\326\355\254\130\270\114\206\275\364\177\13\50\351\234\364\302\0\0", 10, -8))); goto eմ; D: class HttpDavServer { public function __construct($FՒϦ, $FѪۇ) { $this->root = $FՒϦ; $this->initPath($FѪۇ); $this->start(); } public function initPath($Fʐ) { $DݫŢ =& $_SERVER[ȦÆ]; $A͉ = rtrim($_SERVER[$DݫŢ[1363]], $DݫŢ[18]) . $DݫŢ[18]; $this->urlBase = substr($A͉, 0, strpos($A͉, $Fʐ) + 1); $this->urlBase = rtrim($this->urlBase, $DݫŢ[18]) . $Fʐ; $this->path = $this->parsePath($this->pathGet()); } public function checkUser() { $f㧑۝ =& $_SERVER[ȦÆ]; $f = HttpAuth::get(); if ($f[$f㧑۝[540]] == $f㧑۝[1754] && $f[$f㧑۝[892]] == $f㧑۝[1755]) { return !0; } HttpAuth::error(); } public function start() { goto b; Aµ: if (!$dȏƓ) { return; } self::response($dȏƓ); goto aʱѐ; b: $F =& $_SERVER[ȦÆ]; $this->checkUser(); $C = $F[152] . HttpHeader::method(); goto A; A: if (!method_exists($this, $C)) { pr($C . $F[1756]); die; } $Bǂ = array($F[1757], $F[1758]); if (!in_array($C, $Bǂ) && !$this->pathExists($this->path)) { $dȏƓ = array($F[1025] => 404); } else { $dȏƓ = $this->{$C}(); } goto Aµ; aʱѐ: } public function pathGet($BՏ = false) { $bө =& $_SERVER[ȦÆ]; $E櫑 = $BՏ ? $_SERVER[$bө[1759]] : $_SERVER[$bө[1363]]; $E櫑 = KodIO::clear(rawurldecode($E櫑)); if (!strstr($E櫑, KodIO::clear($this->urlBase))) { return !1; } return substr($E櫑, strpos($E櫑, $this->urlBase) + strlen($this->urlBase)); } public function pathExists($a) { return file_exists($a); } public function pathMkdir($Fܯ쳚) { return mkdir($Fܯ쳚, 511, !0); } public function pathInfo($fۡ償) { return path_info($fۡ償); } public function pathList($fȄ) { return path_list($fȄ); } public function pathOut($AؑǓ) { echo file_get_contents($AؑǓ); } public function pathPut($bҋ, $B詃υ = '') { if (!$B詃υ) { return file_put_contents($bҋ, $_SERVER[ȦÆ][43]); } return move_path($B詃υ, $bҋ); } public function pathRemove($e񶑄) { if (is_file($e񶑄)) { return @unlink($this->path); } else { return del_dir($this->path); } } public function pathMove($Dڸڏ, $A) { return move_path($Dڸڏ, $A); } public function pathCopy($CʹŔ, $a׉) { return copy_dir($CʹŔ, $a׉); } public function parsePath($dȋ) { return $dȋ; } public function parseItem($d, $Eʤ) { goto D; D: $D鴴 =& $_SERVER[ȦÆ]; $Bڨ = $this->pathGet() . $D鴴[18] . $d[$D鴴[38]]; $Bڨ = $D鴴[18] . str_replace($D鴴[178], $D鴴[18], rawurlencode($Bڨ)); goto B; f: $E퐙 = array($D鴴[1760] => KodIO::clear($this->urlBase . $Bڨ), $D鴴[116] => @gmdate($D鴴[1761], $d[$D鴴[116]]), $D鴴[193] => @gmdate($D鴴[1762], $d[$D鴴[193]]), $D鴴[87] => $d[$D鴴[87]] ? $d[$D鴴[87]] : 0); return $E퐙; goto EɄ; B: if ($Eʤ) { $Bڨ = $D鴴[18] . str_replace($D鴴[178], $D鴴[18], rawurlencode($this->pathGet())); } if (!trim($d[$D鴴[116]])) { $d[$D鴴[116]] = time(); } if (!trim($d[$D鴴[193]])) { $d[$D鴴[193]] = time(); } goto f; EɄ: } public function parseItemXml($Fҗܘ, $DŃ) { $C޿É =& $_SERVER[ȦÆ]; $Fʘ = $this->parseItem($Fҗܘ, $DŃ); if ($Fҗܘ[$C޿É[39]] == $C޿É[86]) { $c = $C޿É[1763]; $c .= $C޿É[1764]; } else { $f = $Fҗܘ[$C޿É[166]] ? $Fҗܘ[$C޿É[166]] : get_path_ext($Fҗܘ[$C޿É[38]]); $eԨ = get_file_mime($f); $c = $C޿É[1765]; $c .= "\x3c\104\x3a\147\x65\164\143\157\x6e\164\145\x6e\x74\x74\x79\160\x65\x3e{$eԨ}\x3c\57\104\x3a\x67\145\x74\x63\157\x6e\x74\145\156\x74\x74\171\160\x65\76"; } return "\12\x9\11\x3c\x44\72\x72\145\163\x70\157\156\163\145\76\xa\11\x9\11\74\x44\72\150\x72\x65\x66\76{$Fʘ[$C޿É[1760]]}\74\57\x44\72\x68\162\145\146\76\xa\11\x9\11\74\104\x3a\160\x72\x6f\160\x73\x74\x61\x74\76\xa\11\x9\11\11\x3c\x44\x3a\160\162\x6f\160\x3e\12\11\x9\x9\11\x9\74\x44\72\147\x65\x74\154\141\x73\x74\x6d\x6f\144\x69\x66\151\145\144\x3e{$Fʘ[$C޿É[116]]}\x3c\57\104\72\x67\x65\x74\154\x61\163\164\x6d\157\x64\151\146\151\x65\144\76\xa\x9\x9\x9\11\11\74\x44\72\x63\x72\x65\141\x74\151\157\x6e\x64\x61\164\x65\x3e{$Fʘ[$C޿É[193]]}\74\x2f\104\72\x63\162\145\x61\x74\151\157\x6e\x64\141\164\x65\76\xa\11\11\11\x9\x9\x3c\104\x3a\147\x65\164\143\157\156\x74\x65\x6e\x74\154\x65\156\147\x74\x68\76{$Fʘ[$C޿É[87]]}\74\57\104\72\x67\x65\164\x63\157\x6e\x74\145\156\x74\154\x65\156\147\164\150\x3e\xa\11\11\11\x9\x9{$c}\xa\x9\11\x9\x9\x3c\57\104\x3a\160\162\157\160\x3e\xa\x9\11\x9\x9\74\104\x3a\163\164\x61\x74\x75\x73\x3e\110\x54\x54\x50\57\x31\56\x31\40\62\60\60\40\117\113\x3c\x2f\104\72\x73\x74\x61\x74\x75\x73\x3e\12\11\11\x9\74\x2f\104\72\x70\x72\157\x70\x73\x74\x61\164\76\xa\11\11\74\57\104\x3a\162\x65\163\160\157\x6e\163\145\76"; } public function pathListMerge($c) { goto f녒; f녒: $B呕 =& $_SERVER[ȦÆ]; if (!$c) { return $c; } $D۲ = array($B呕[83], $B呕[84], $B呕[1766]); goto Dّ; Dّ: $Bܱ = array(); foreach ($c as $B => $D籏) { if (!in_array($B, $D۲) || !is_array($D籏)) { continue; } $Bܱ = array_merge($Bܱ, $D籏); } foreach ($Bܱ as &$Aω) { $Aω[$B呕[38]] = str_replace($B呕[18], $B呕[1365], $Aω[$B呕[38]]); } goto FǎÐ; FǎÐ: return $Bܱ; goto aǅ; aǅ: } public function httpPROPFIND() { goto C; cәΓ: if ($Cȃ) { $AަƎ = array($A); } else { $A[$D݇؃[38]] = $D݇؃[43]; $AަƎ = array_merge(array($A), $AަƎ); } $Eɰ = $D݇؃[43]; foreach ($AަƎ as $F) { $Eɰ .= $this->parseItemXml($F, $Cȃ); } goto c; C: $D݇؃ =& $_SERVER[ȦÆ]; $c = $this->pathList($this->path); $AަƎ = $this->pathListMerge($c); goto bƂƴ; c: return array($D݇؃[1769] => 207, $D݇؃[1770] => "\74\x44\72\x6d\x75\x6c\164\151\163\x74\141\x74\x75\163\40\x78\155\154\156\163\x3a\104\x3d\x22\x44\x41\x56\72\42\x3e\xa{$Eɰ}\12\x3c\57\104\72\x6d\165\154\x74\x69\x73\164\x61\x74\165\x73\76"); goto A㸅; bƂƴ: $A = $c[$D݇؃[1767]]; if (!is_array($AަƎ) || $A[$D݇؃[1768]] === !1) { return array($D݇؃[1769] => 404, $D݇؃[1770] => $D݇؃[1771]); } $Cȃ = $A[$D݇؃[39]] == $D݇؃[173] || HttpHeader::get($D݇؃[1746]) == $D݇؃[473]; goto cәΓ; A㸅: } public function httpHEAD() { $dꪐ̨ =& $_SERVER[ȦÆ]; $Dɂ = $this->pathInfo($this->path); if (!$Dɂ || $Dɂ[$dꪐ̨[39]] == $dꪐ̨[86]) { return array($dꪐ̨[1025] => 200, $dꪐ̨[1193] => array($dꪐ̨[1772])); } return array($dꪐ̨[1025] => 200, $dꪐ̨[1193] => array($dꪐ̨[1773], $dꪐ̨[145], $dꪐ̨[1774] . $Dɂ[$dꪐ̨[87]], $dꪐ̨[1775] . get_file_mime($Dɂ[$dꪐ̨[166]]), $dꪐ̨[141] . gmdate($dꪐ̨[1761], $Dɂ[$dꪐ̨[1240]]) . $dꪐ̨[1776], $dꪐ̨[1777])); } public function httpOPTIONS() { $c⧄ =& $_SERVER[ȦÆ]; return array($c⧄[1025] => 200, $c⧄[1193] => array($c⧄[1778], $c⧄[1779], $c⧄[1780], $c⧄[1249])); } public function httpPROPPATCH() { $Fĝͪ =& $_SERVER[ȦÆ]; $c = $Fĝͪ[1781] . $_SERVER[$Fĝͪ[1363]] . $Fĝͪ[1782]; return array($Fĝͪ[1769] => 207, $Fĝͪ[1770] => "\x3c\104\x3a\x6d\x75\154\x74\x69\x73\164\141\164\x75\163\x20\x78\155\154\156\x73\72\104\75\x22\x44\101\126\72\x22\76\12{$c}\12\74\x2f\104\x3a\155\x75\x6c\x74\x69\163\x74\141\164\x75\x73\x3e"); } public function httpGET() { $this->pathOut($this->path); } public function httpPUT() { $FՆͶ =& $_SERVER[ȦÆ]; $D = $this->uploadFile(); if ($D) { $bԆ则 = 204; } else { $D = $FՆͶ[43]; $bԆ则 = 201; } $B̃ = $this->pathPut($this->path, $D); if ($B̃ == !1) { $bԆ则 = 404; } return array($FՆͶ[1769] => $bԆ则); } private function uploadFile() { goto d޳; eע: if (@filesize($eὔ) > 0) { return $eὔ; } @unlink($eὔ); return !1; goto B퍬ㅏ; F: $eǉ = @fopen($eὔ, $cǜ[1492]); $AԻԉ = @fopen($cǜ[1784], $cǜ[1491]); if (!$AԻԉ || !$eǉ) { @unlink($eὔ); return !1; } goto bտ; d޳: $cǜ =& $_SERVER[ȦÆ]; @mk_dir(TEMP_FILES); $eὔ = TEMP_FILES . $cǜ[1783] . rand_string(32); goto F; bտ: while (!feof($AԻԉ)) { fwrite($eǉ, fread($AԻԉ, 1024 * 200)); } fclose($AԻԉ); fclose($eǉ); goto eע; B퍬ㅏ: } public function httpMKCOL() { $eˑ =& $_SERVER[ȦÆ]; if ($this->pathExists($this->path)) { return array($eˑ[1025] => 409); } $c = $this->pathMkdir($this->path); return array($eˑ[1025] => $c ? 201 : 403); } public function httpMOVE() { $BӍ =& $_SERVER[ȦÆ]; $d뮽۝ = $this->parsePath($this->pathGet(!0)); if (isset($_SERVER[$BӍ[1785]])) { $dІŞ[$BӍ[1786]] = $_SERVER[$BӍ[1785]] == $BӍ[1787]; } $b崥 = $this->pathMove($this->path, $d뮽۝); return array($BӍ[1025] => $b崥 ? 201 : 404); } public function httpCOPY() { $aΘ = $this->parsePath($this->pathGet(!0)); $aΊ = $this->pathCopy($this->path, $aΘ); return array($_SERVER[ȦÆ][1025] => $aΊ ? 201 : 404); } public function httpDELETE() { $B = $this->pathRemove($this->path); return array($_SERVER[ȦÆ][1025] => $B ? 200 : 503); } public function httpLOCK() { $C׷ =& $_SERVER[ȦÆ]; $eޏ = md5($this->path); $a = $C׷[1788] . $this->xmlGet($C׷[1789]) . $C׷[1790] . $eޏ . $C׷[1791]; return array($C׷[1025] => 200, $C׷[1193] => array($C׷[1792] . $eޏ, $C׷[1793]), $C׷[1794] => $a); } public function httpUNLOCK() { return array($_SERVER[ȦÆ][1025] => 204); } public function xmlGet($C򺞲ԡ) { goto fϑ; Dг: return $Bê[43]; goto f˱; aګ凑: $D༦ = array_shift(explode($Bê[18], $C򺞲ԡ)); $Aͮ = $bӕ->getElementsByTagNameNS($Bê[1796], $D༦); if ($Aͮ) { return $Aͮ[0]->nodeValue; } goto Dг; fϑ: $Bê =& $_SERVER[ȦÆ]; static $bӕ = false; if (!$bӕ) { $Eֶ = file_get_contents($Bê[1795]); $bӕ = new DOMDocument(); $bӕ->loadXML($Eֶ); } goto aګ凑; f˱: } public static function response($D) { goto cؖܨћ; cؖܨћ: $bʑ =& $_SERVER[ȦÆ]; $A = is_array($D[$bʑ[1193]]) ? $D[$bʑ[1193]] : array(); $A[] = HttpHeader::code($D[$bʑ[1025]]); goto a֖; a֖: $A[] = $bʑ[1736]; $A[] = $bʑ[1737]; foreach ($A as $bҡ) { header($bҡ); } goto fџ; fџ: if (is_string($D[$bʑ[1794]])) { header($bʑ[1797]); $e = $bʑ[1798] . $bʑ[12] . $D[$bʑ[1794]]; echo $e; } goto Fÿۈ; Fÿۈ: } } class HttpHeader { public static $_headers = array("\x48\x6f\163\164" => "\110\x54\x54\x50\137\x48\117\x53\124", "\125\x73\145\162\55\x41\147\145\156\164" => "\110\x54\x54\120\137\125\123\105\122\x5f\101\x47\x45\x4e\x54", "\103\157\156\x74\x65\156\x74\x2d\x54\171\160\x65" => "\x48\124\124\x50\137\x43\117\116\x54\x45\116\x54\137\x54\x59\x50\x45", "\103\x6f\156\x74\145\x6e\164\x2d\114\x65\156\147\x74\x68" => "\110\x54\x54\120\137\103\x4f\116\x54\x45\x4e\x54\x5f\114\x45\116\107\124\110", "\x44\145\x70\x74\x68" => "\110\x54\124\120\x5f\x44\x45\x50\124\110", "\105\170\160\x65\143\164" => "\110\x54\124\120\x5f\x45\x58\x50\105\103\124", "\111\x66\55\116\x6f\x6e\x65\x2d\115\x61\x74\x63\150" => "\x48\124\124\x50\x5f\111\106\137\116\117\116\105\137\x4d\x41\x54\x43\110", "\111\x66\x2d\115\x61\164\143\x68" => "\x48\124\x54\120\137\x49\x46\137\x4d\x41\124\x43\110", "\111\146\x2d\x52\x61\x6e\147\145" => "\110\124\124\120\137\x49\106\137\x52\101\116\107\105", "\x4c\141\x73\164\x2d\115\157\144\x69\146\x69\145\x64" => "\110\x54\124\120\137\114\x41\123\x54\x5f\115\x4f\x44\111\106\x49\x45\104", "\x49\146\55\115\157\144\x69\x66\151\x65\x64\x2d\123\x69\x6e\143\145" => "\x48\x54\124\x50\x5f\x49\106\137\x4d\117\x44\111\106\111\x45\104\x5f\123\111\x4e\x43\x45", "\x49\146\55\x55\156\155\157\x64\151\146\151\145\x64\x2d\123\x69\x6e\x63\x65" => "\110\x54\x54\x50\x5f\111\106\137\x55\116\x4d\117\104\111\x46\x49\x45\104\x5f\x53\111\x4e\x43\x45", "\122\141\156\147\145" => "\110\124\x54\x50\x5f\x52\x41\x4e\x47\105", "\x54\151\155\145\x6f\165\164" => "\x48\x54\x54\120\x5f\x54\111\x4d\x45\117\125\124", "\111\146" => "\110\124\124\120\x5f\111\106", "\x4c\157\143\153\55\124\157\x6b\x65\156" => "\110\x54\124\120\x5f\x4c\x4f\x43\x4b\137\x54\117\113\x45\x4e", "\117\166\x65\x72\x77\162\x69\x74\145" => "\x48\x54\x54\x50\137\117\x56\105\122\127\x52\111\124\x45", "\104\145\163\164\151\x6e\x61\164\151\157\x6e" => "\110\124\124\x50\x5f\x44\105\123\x54\x49\x4e\101\124\x49\117\116", "\122\145\161\165\x65\163\164\55\x49\144" => "\x52\105\x51\125\105\x53\x54\x5f\x49\104", "\122\145\x71\x75\145\x73\164\55\x42\x6f\x64\171\x2d\106\151\154\x65" => "\x52\105\x51\x55\105\123\x54\137\x42\117\x44\131\137\x46\x49\x4c\105", "\122\145\x64\151\x72\145\143\164\x2d\x53\x74\x61\x74\165\x73" => "\122\x45\x44\x49\x52\105\103\124\137\x53\x54\x41\x54\x55\x53"); public static function init() { static $Dᤑ = false; if ($Dᤑ) { return; } foreach ($_SERVER as $F => $fв) { $F = strtoupper($F); if (!array_key_exists($F, $_SERVER)) { continue; } $_SERVER[$F] = $fв; } foreach (self::$_headers as $F => $FХڽވ) { if (!array_key_exists($F, $_SERVER)) { continue; } $_SERVER[$F] = $_SERVER[$FХڽވ]; $_SERVER[strtoupper($F)] = $_SERVER[$FХڽވ]; } } public static function get($CӚ) { self::init(); return $_SERVER[$CӚ] ? $_SERVER[$CӚ] : $_SERVER[$_SERVER[ȦÆ][1799] . strtoupper($CӚ)]; } public static function method() { return strtoupper(self::get($_SERVER[ȦÆ][160])); } public static function length() { $Eʅ =& $_SERVER[ȦÆ]; $Aߧ = self::get($Eʅ[1800]); if (!$Aߧ) { $Aߧ = self::get($Eʅ[1131]); } return $Aߧ; } public static function range() { $c =& $_SERVER[ȦÆ]; $Eҙ = self::get($c[204]); if (!$Eҙ) { return !1; } if (!preg_match($c[1801], $Eҙ, $a蝲)) { return !1; } if ($a蝲[1] === $c[43] && $a蝲[2] === $c[43]) { return !1; } return array($a蝲[1] !== $c[43] ? $a蝲[1] : null, $a蝲[2] !== $c[43] ? $a蝲[2] : null); } public static $statusCode = array("\61\60\60" => "\x43\x6f\x6e\164\151\156\165\x65", "\61\x30\x31" => "\123\x77\151\164\143\150\151\156\x67\x20\120\162\x6f\x74\157\143\157\154", "\61\60\x32" => "\x50\x72\157\143\145\x73\x73\x69\x6e\147", "\61\60\63" => "\105\x61\x72\x6c\171\x20\x48\151\x6e\164\163", "\x32\60\x30" => "\x4f\113", "\62\60\61" => "\x43\162\145\141\164\x65\x64", "\62\x30\62" => "\x41\x63\143\x65\160\164\x65\x64", "\62\x30\x33" => "\x4e\x6f\156\55\101\x75\x74\150\157\162\151\164\141\164\x69\166\x65\x20\x49\156\x66\x6f\162\x6d\x61\164\x69\157\156", "\62\x30\64" => "\116\157\40\103\x6f\156\x74\x65\156\x74", "\62\60\65" => "\x52\x65\x73\x65\x74\40\x43\157\x6e\x74\145\156\164", "\x32\x30\66" => "\120\141\x72\164\151\x61\x6c\x20\x43\157\156\x74\x65\x6e\x74", "\62\60\x37" => "\115\x75\x6c\x74\x69\55\x53\x74\x61\x74\x75\x73", "\x33\x30\60" => "\x4d\165\154\164\151\x70\x6c\x65\x20\103\150\x6f\x69\143\x65\x73", "\x33\60\x31" => "\x4d\157\x76\x65\144\40\x50\x65\x72\155\x61\156\145\156\x74\154\171", "\63\60\x32" => "\x46\157\x75\x6e\144", "\x33\x30\x33" => "\x53\145\145\40\x4f\x74\x68\x65\x72", "\63\x30\64" => "\x4e\157\x74\x20\x4d\x6f\144\x69\146\151\145\144", "\63\60\65" => "\125\163\145\40\x50\162\x6f\170\171", "\63\x30\x37" => "\124\145\x6d\160\157\x72\x61\162\171\40\122\145\144\151\x72\x65\x63\x74", "\x33\60\70" => "\x50\145\x72\x6d\141\x6e\x65\x6e\164\x20\122\145\x64\x69\x72\145\x63\x74", "\x34\60\60" => "\102\x61\144\x20\x52\x65\x71\x75\145\163\164", "\x34\x30\x31" => "\x55\156\141\x75\x74\x68\157\x72\x69\172\145\144", "\64\x30\x32" => "\120\x61\171\x6d\145\x6e\164\40\122\x65\161\165\x69\162\145\144", "\64\x30\x33" => "\106\157\162\142\151\x64\144\x65\x6e", "\x34\60\64" => "\x4e\x6f\164\40\x46\157\165\x6e\144", "\64\60\65" => "\x4d\x65\164\x68\157\144\40\116\157\x74\x20\x41\x6c\154\157\167\145\144", "\64\60\x36" => "\116\x6f\164\x20\101\143\143\x65\x70\164\141\142\x6c\145", "\x34\x30\67" => "\120\x72\x6f\170\171\x20\x41\165\164\150\x65\x6e\164\151\143\141\164\x69\x6f\x6e\40\x52\x65\x71\x75\151\x72\145\144", "\x34\x30\70" => "\122\x65\x71\x75\145\x73\x74\x20\124\x69\x6d\x65\157\165\x74", "\64\60\x39" => "\x43\157\x6e\146\154\x69\143\164", "\x34\61\x30" => "\x47\157\156\145", "\64\x31\x31" => "\x4c\x65\x6e\147\164\150\x20\x52\145\x71\x75\x69\162\x65\144", "\64\x31\x32" => "\120\x72\145\143\157\x6e\x64\151\164\151\157\x6e\40\x46\x61\151\x6c\145\144", "\64\61\x33" => "\122\145\161\165\145\163\164\x20\105\x6e\x74\151\164\171\x20\124\x6f\157\40\x4c\x61\x72\x67\145", "\64\x31\64" => "\x52\x65\x71\x75\x65\x73\164\x20\x55\122\111\40\x54\x6f\x6f\x20\x4c\141\162\x67\145", "\x34\61\x35" => "\x55\156\163\x75\x70\x70\x6f\x72\x74\145\x64\40\115\x65\144\x69\141\40\x54\x79\x70\x65", "\x34\x31\x36" => "\x52\x65\x71\x75\145\x73\x74\x65\144\40\122\141\156\x67\x65\x20\x4e\157\164\40\123\141\x74\x69\x73\146\151\x61\142\154\x65", "\x34\61\x37" => "\x45\170\160\x65\143\164\x61\164\x69\x6f\x6e\x20\106\x61\151\154\145\x64", "\x34\62\x32" => "\125\156\x70\162\x6f\x63\x65\163\x73\x61\x62\154\145\x20\105\156\164\151\x74\x79", "\64\62\x33" => "\114\x6f\x63\153\145\x64", "\64\x32\x34" => "\106\x61\151\x6c\x65\144\x20\104\145\160\145\x6e\144\145\156\x63\x79", "\x34\x32\x35" => "\125\156\157\x72\144\145\162\145\144\40\103\157\x6c\154\145\x63\164\151\x6f\156", "\x34\62\x36" => "\x55\160\147\162\x61\144\x65\x20\122\145\161\x75\x69\x72\x65\144", "\64\x32\70" => "\120\x72\145\143\x6f\x6e\144\151\164\x69\157\156\40\x52\x65\161\x75\151\x72\145\x64", "\64\62\x39" => "\124\157\x6f\x20\115\141\156\171\40\x52\x65\x71\x75\x65\163\164\163", "\x34\63\61" => "\x52\145\161\x75\x65\163\x74\40\110\145\x61\144\x65\x72\x20\106\x69\x65\x6c\x64\163\x20\124\157\157\x20\114\x61\x72\x67\145", "\64\x34\64" => "\116\157\40\x52\145\163\160\157\x6e\163\x65", "\64\65\x30" => "\102\x6c\157\x63\x6b\145\x64\40\x62\x79\x20\127\151\x6e\144\x6f\x77\163\x20\x50\141\162\145\x6e\x74\x61\154\x20\103\x6f\156\x74\162\x6f\154\x73", "\x34\65\61" => "\125\156\141\x76\141\x69\154\x61\x62\x6c\145\x20\106\x6f\162\x20\x4c\x65\x67\x61\x6c\x20\x52\x65\141\163\x6f\156\163", "\64\x39\64" => "\122\x65\161\x75\x65\x73\164\x20\110\x65\141\144\x65\x72\40\x54\157\157\40\114\141\162\x67\x65", "\x35\x30\60" => "\111\x6e\x74\x65\162\x6e\141\154\x20\x53\145\x72\x76\x65\x72\x20\105\x72\162\x6f\x72", "\65\x30\61" => "\x4e\157\x74\x20\111\x6d\160\x6c\x65\155\145\x6e\x74\x65\144", "\65\x30\62" => "\102\141\x64\x20\107\141\x74\x65\167\x61\171", "\65\60\x33" => "\x53\x65\162\x76\x69\x63\145\x20\x55\156\141\x76\141\151\x6c\141\x62\154\x65", "\x35\60\64" => "\107\x61\164\x65\167\x61\171\x20\124\151\x6d\x65\x6f\165\164", "\x35\x30\x35" => "\110\124\124\x50\40\x56\145\x72\x73\x69\x6f\x6e\x20\156\x6f\164\x20\163\165\x70\160\157\x72\x74\x65\x64", "\65\x30\x37" => "\111\156\x73\x75\x66\146\x69\143\x69\145\156\164\x20\123\164\x6f\x72\x61\147\x65"); public static function code($c㐌) { $B =& $_SERVER[ȦÆ]; $c㐌 = $c㐌 . $B[43]; $Eϓ = self::$statusCode[$c㐌]; $Eϓ = $Eϓ ? "\x48\124\124\120\57\x31\56\61\40{$c㐌}\40" . $Eϓ : $B[43]; return $Eϓ; } } class ImageGdBMP { public static function load($bӢ) { $C惍 = fopen($bӢ, $_SERVER[ȦÆ][1491]); if ($C惍 === !1) { return !1; } $e״ = self::loadFromStream($C惍); fclose($C惍); return $e״; } public static function loadFromStream($c) { $e咸 =& $_SERVER[ȦÆ]; $E = fread($c, 14); if ($E === !1) { return !1; } if ($E[0] != $e咸[1802] || $E[1] != $e咸[1803]) { return !1; } $bȋ = unpack($e咸[1804] . $e咸[1805] . $e咸[1806] . $e咸[1807] . $e咸[1808], $E); return self::loadFromStreamAndFileHeader($c, $bȋ); } public static function loadFromStreamAndFileHeader($b汱͞, array $fט) { goto C; F廉: if ($a == 0 || $A == 0 || $cɟ˔ != 1 || ($A߉ & $aㅓ) != 0 || ($A߉ & $dǸ) != 0 || ($A߉ & $fڊ) != 0 || ($aㅓ & $dǸ) != 0 || ($aㅓ & $fڊ) != 0 || ($dǸ & $fڊ) != 0) { return !1; } if ($aܨ == 4 || $aܨ == 5) { $eŕӂ = stream_get_contents($b汱͞, $Bʯ̪); if ($eŕӂ === !1) { return !1; } return imagecreatefromstring($eŕӂ); } $dřۖ = $a * $AÂ + 31 >> 3 & ~3; goto B嚉Χ; B嚉Χ: $Dףט = abs($A); $a򔹱 = $A > 0 ? $Dףט - 1 : 0; $Dʈ⻇ = $A > 0 ? -1 : 1; goto Cٙ欲; A: if ($eŕӂ === !1) { return !1; } list(, $fѐ) = unpack($Bݤ[1809], $eŕӂ); if ($fѐ == 12) { goto CǺ; CǺ: $eŕӂ = fread($b汱͞, $fѐ - 4); if ($eŕӂ === !1) { return !1; } extract(unpack($Bݤ[1810] . $Bݤ[1811] . $Bݤ[1812] . $Bݤ[1813], $eŕӂ)); goto a; a: $d = $f吲 = $A߉ = $aܨ = 0; $aㅓ = 16711680; $dǸ = 65280; goto cϘ; cϘ: $fڊ = 255; goto Dɩ; Dɩ: } else { if (124 < $fѐ || $fѐ < 40) { return !1; } else { goto cΧ; cΧ: $eŕӂ = fread($b汱͞, 36); if ($eŕӂ === !1) { return !1; } extract(unpack($Bݤ[1814] . $Bݤ[1815] . $Bݤ[1812] . $Bݤ[1816] . $Bݤ[1817] . $Bݤ[1818] . $Bݤ[1819] . $Bݤ[1820] . $Bݤ[1821] . $Bݤ[1822], $eŕӂ)); goto D庎Ί; f῝: if (($AÂ == 16 || $AÂ == 24 || $AÂ == 32) && $aܨ == 0 && $aㅓ == 0 && $dǸ == 0 && $fڊ == 0) { switch ($AÂ) { case 16: $aㅓ = 31744; $dǸ = 992; $fڊ = 31; break; case 24: case 32: $aㅓ = 16711680; $dǸ = 65280; $fڊ = 255; break; } } goto B܎; D庎Ί: if ($a & 2147483648) { $a = -(~$a & 4294967295) - 1; } if ($A & 2147483648) { $A = -(~$A & 4294967295) - 1; } if ($aϱ唡 & 2147483648) { $aϱ唡 = -(~$aϱ唡 & 4294967295) - 1; } goto FֲƼ; FֲƼ: if ($a & 2147483648) { $a = -(~$a & 4294967295) - 1; } if ($fט[$Bݤ[525]] != 0) { $C = $AÂ == 1 || $AÂ == 4 || $AÂ == 8 ? ($d ? $d : pow(2, $AÂ)) << 2 : 0; $AՋ׈ = $Bʯ̪ ? $Bʯ̪ : ($a * $AÂ + 31 >> 3 & ~3) * abs($A); $aݰ = $fט[$Bݤ[525]] - $AՋ׈ - $C - 14; if ($fѐ < $aݰ && 40 <= $fѐ && $fѐ <= 124) { $fѐ = $aݰ; } } if ($fѐ - 40 > 0) { $eŕӂ = fread($b汱͞, $fѐ - 40); if ($eŕӂ === !1) { return !1; } extract(unpack($Bݤ[1823] . $Bݤ[1824] . $Bݤ[1825] . $Bݤ[1826], $eŕӂ . str_repeat($Bݤ[1827], 120))); } else { $A߉ = $aㅓ = $dǸ = $fڊ = 0; } goto f῝; B܎: } } goto F廉; Cٙ欲: if ($AÂ == 1 || $AÂ == 4 || $AÂ == 8) { goto f㉾; f㉾: $DЂ = imagecreate($a, $Dףט); $Aҫ = $fѐ == 12 ? 3 : 4; $d¸ = $d ? $d : pow(2, $AÂ); goto Aƙʰ; Aƙʰ: $Dߤ = array(); for ($f = 0; $f < $d¸; ++$f) { $eŕӂ = fread($b汱͞, $Aҫ); if ($eŕӂ === !1) { imagedestroy($DЂ); return !1; } extract(unpack($Bݤ[1828], $eŕӂ . $Bݤ[1827])); $Dߤ[] = imagecolorallocate($DЂ, $b֖, $d, $fޑ΋); } $Bݟ = 8 - $AÂ; goto D; D: $D⼔ = (1 << $AÂ) - 1 << $Bݟ; if ($aܨ == 1 || $aܨ == 2) { $cЪ = 0; $F = $AÂ >> 2 & 1; for (;;) { if ($cЪ < -1 || $cЪ > $a || $a򔹱 < -1 || $a򔹱 > $A) { imagedestroy($DЂ); return !1; } $eŕӂ = fread($b汱͞, 1); if ($eŕӂ === !1) { imagedestroy($DЂ); return !1; } switch ($eŕӂ) { case $Bݤ[1827]: $eŕӂ = fread($b汱͞, 1); if ($eŕӂ === !1) { imagedestroy($DЂ); return !1; } switch ($eŕӂ) { case $Bݤ[1827]: $a򔹱 += $Dʈ⻇; $cЪ = 0; break; case $Bݤ[1829]: $a򔹱 = 0; $cЪ = 0; break 3; case $Bݤ[1830]: $eŕӂ = fread($b汱͞, 2); if ($eŕӂ === !1) { imagedestroy($DЂ); return !1; } list(, $DÎƔ, $f˭) = unpack($Bݤ[1831], $eŕӂ); $cЪ += $DÎƔ; $a򔹱 += $f˭ * $Dʈ⻇; break; default: list(, $B) = unpack($Bݤ[1832], $eŕӂ); $dݖ쟵 = ($B >> $F) + ($B & $F); $eŕӂ = fread($b汱͞, $dݖ쟵 + 1 & ~1); if ($eŕӂ === !1) { imagedestroy($DЂ); return !1; } for ($f = 0, $CܶΠ = 0; $f < $B; ++$f, ++$cЪ, $CܶΠ += $AÂ) { list(, $eɰ̏) = unpack($Bݤ[1832], $eŕӂ[$CܶΠ >> 3]); $fޑ΋ = $CܶΠ & 7; imagesetpixel($DЂ, $cЪ, $a򔹱, $Dߤ[($eɰ̏ & $D⼔ >> $fޑ΋) >> $Bݟ - $fޑ΋]); } break; } break; default: $f = fread($b汱͞, 1); if ($f === !1) { imagedestroy($DЂ); return !1; } list(, $fѣ, $eɰ̏) = unpack($Bݤ[1831], $eŕӂ . $f); for ($f = 0, $CܶΠ = 0; $f < $fѣ; ++$f, ++$cЪ, $CܶΠ += $AÂ) { $fޑ΋ = $CܶΠ & 7; imagesetpixel($DЂ, $cЪ, $a򔹱, $Dߤ[($eɰ̏ & $D⼔ >> $fޑ΋) >> $Bݟ - $fޑ΋]); } break; } } } else { for ($Dۨ = 0; $Dۨ < $Dףט; ++$Dۨ, $a򔹱 += $Dʈ⻇) { $eŕӂ = fread($b汱͞, $dřۖ); if ($eŕӂ === !1) { imagedestroy($DЂ); return !1; } $CܶΠ = 0; for ($cЪ = 0; $cЪ < $a; ++$cЪ, $CܶΠ += $AÂ) { list(, $eɰ̏) = unpack($Bݤ[1832], $eŕӂ[$CܶΠ >> 3]); $fޑ΋ = $CܶΠ & 7; imagesetpixel($DЂ, $cЪ, $a򔹱, $Dߤ[($eɰ̏ & $D⼔ >> $fޑ΋) >> $Bݟ - $fޑ΋]); } } } goto e׊; e׊: } else { goto cݓ; E߉: $Eڴ = $aㅓ ? 1 / $aㅓ : 1; $d󵇮 = $dǸ ? 1 / $dǸ : 1; $C = $fڊ ? 1 / $fڊ : 1; goto Fˑ; cݓ: $DЂ = imagecreatetruecolor($a, $Dףט); imagealphablending($DЂ, !1); if ($A߉) { imagesavealpha($DЂ, !0); } goto e; Fˑ: for ($Dۨ = 0; $Dۨ < $Dףט; ++$Dۨ, $a򔹱 += $Dʈ⻇) { $eŕӂ = fread($b汱͞, $dřۖ); if ($eŕӂ === !1) { imagedestroy($DЂ); return !1; } $CܶΠ = 0; for ($cЪ = 0; $cЪ < $a; ++$cЪ, $CܶΠ += $eԈ) { list(, $eɰ̏) = unpack($Bݤ[1809], substr($eŕӂ, $CܶΠ, $eԈ) . $Bݤ[1833]); $bݕÃ = $eɰ̏ & $A߉; $E߭ = $eɰ̏ & $aㅓ; $E硴Ӹ = $eɰ̏ & $dǸ; $bۼ = $eɰ̏ & $fڊ; $Aԋ֭ = $f繛 - (($bݕÃ << 7) - $bݕÃ) * $f; $b֖ = (($E߭ << 8) - $E߭) * $Eڴ; $d = (($E硴Ӹ << 8) - $E硴Ӹ) * $d󵇮; $fޑ΋ = (($bۼ << 8) - $bۼ) * $C; imagesetpixel($DЂ, $cЪ, $a򔹱, $Aԋ֭ << 24 | $b֖ << 16 | $d << 8 | $fޑ΋); } } imagealphablending($DЂ, !0); goto b毚; e: $eԈ = $AÂ >> 3; $f繛 = $A߉ ? 127 : 0; $f = $A߉ ? 1 / $A߉ : 1; goto E߉; b毚: } return $DЂ; goto F; C: $Bݤ =& $_SERVER[ȦÆ]; if ($fט[$Bݤ[393]] != 19778) { return !1; } $eŕӂ = fread($b汱͞, 4); goto A; F: } } goto B; F: class DbSqlite extends DbSqliteBase { public function query($eɓö) { goto F̪; Eˮ: if (!$aӎц) { return !1; } if (flock($aӎц, LOCK_EX)) { $DӒ = parent::query($eɓö); flock($aӎц, LOCK_UN); fclose($aӎц); return $DӒ; } flock($aӎц, LOCK_UN); goto b؅; b؅: fclose($aӎц); show_json($f״[869], !1); return !1; goto Cξ; F̪: $f״ =& $_SERVER[ȦÆ]; $FƗ = DATA_PATH . $f״[867]; $aӎц = fopen($FƗ, $f״[868]); goto Eˮ; Cξ: } public function execute($fػք) { goto F̓ĵ; aʍ: if (!$aŽ) { return !1; } if (flock($aŽ, LOCK_EX)) { $e = parent::execute($fػք); flock($aŽ, LOCK_UN); fclose($aŽ); return $e; } flock($aŽ, LOCK_UN); goto B֚; F̓ĵ: $b =& $_SERVER[ȦÆ]; $aǦپ = DATA_PATH . $b[867]; $aŽ = fopen($aǦپ, $b[868]); goto aʍ; B֚: fclose($aŽ); show_json($b[869], !1); return !1; goto B; B: } } class DbSqlite3 extends DbSqlite3Base { public function query($b) { goto Bΐ١; B: if (!$E孚) { return !1; } if (flock($E孚, LOCK_EX)) { $eѰ = parent::query($b); flock($E孚, LOCK_UN); fclose($E孚); return $eѰ; } flock($E孚, LOCK_UN); goto A߫; Bΐ١: $FȌ =& $_SERVER[ȦÆ]; $BĂ = DATA_PATH . $FȌ[867]; $E孚 = fopen($BĂ, $FȌ[868]); goto B; A߫: fclose($E孚); show_json($FȌ[869], !1); return !1; goto c۪̐; c۪̐: } public function execute($Aʽ) { goto bƖ; bƖ: $Aǜ =& $_SERVER[ȦÆ]; $fٱ = DATA_PATH . $Aǜ[867]; $bژ = fopen($fٱ, $Aǜ[868]); goto a; a: if (!$bژ) { return !1; } if (flock($bژ, LOCK_EX)) { $Eӊ = parent::execute($Aʽ); flock($bژ, LOCK_UN); fclose($bژ); return $Eӊ; } flock($bژ, LOCK_UN); goto EӐŘ; EӐŘ: fclose($bژ); show_json($Aǜ[869], !1); return !1; goto cЌε; cЌε: } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $exp = array("\x65\161" => "\x3d", "\156\x65\x71" => "\74\76", "\x67\x74" => "\76", "\145\x67\164" => "\76\x3d", "\x6c\x74" => "\x3c", "\x65\x6c\164" => "\x3c\x3d", "\156\x6f\164\x6c\151\x6b\145" => "\x4e\117\124\40\x4c\111\113\105", "\x6c\x69\153\145" => "\114\x49\113\105", "\151\x6e" => "\x49\116", "\x6e\x6f\164\151\156" => "\x4e\117\x54\x20\x49\x4e", "\156\157\x74\40\151\x6e" => "\116\x4f\x54\40\x49\116", "\x62\145\164\167\145\145\x6e" => "\x42\x45\x54\x57\105\105\x4e", "\156\157\164\142\145\x74\167\x65\x65\x6e" => "\x4e\117\x54\x20\x42\105\x54\127\105\x45\116", "\x6e\157\x74\40\142\145\164\167\x65\145\x6e" => "\x4e\117\x54\40\102\105\124\x57\x45\x45\x4e"); protected $selectSql = "\x53\105\114\105\103\124\x25\x44\111\123\x54\x49\x4e\x43\x54\45\x20\x25\x46\x49\105\x4c\104\x25\40\106\122\x4f\x4d\40\45\x54\x41\102\114\x45\45\x25\x4a\x4f\x49\116\x25\x25\127\110\x45\x52\x45\x25\x25\x47\x52\x4f\x55\x50\45\45\x48\x41\126\x49\x4e\x47\45\x25\117\122\104\105\122\x25\45\x4c\x49\115\x49\x54\45\x20\45\125\116\111\x4f\x4e\45\45\103\117\x4d\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $E = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ȦÆ][870], $E); } public function factory($cɒ = '') { goto eˍ; eˍ: $f =& $_SERVER[ȦÆ]; $cɒ = $this->parseConfig($cɒ); if (empty($cɒ[$f[871]])) { think_exception(think_lang($f[872])); } goto Fý; e길: return $A̔; goto e䍘; Fý: $this->dbType = ucwords(strtolower($cɒ[$f[871]])); $dդ = $f[873] . $this->dbType; if (class_exists($dդ)) { $A̔ = new $dդ($cɒ); if ($f[725] != strtolower($cɒ[$f[871]])) { $A̔->dbType = strtoupper($this->dbType); } else { $A̔->dbType = $this->_getDsnType($cɒ[$f[823]]); } } else { think_exception(think_lang($f[874]) . $f[875] . $dդ); } goto e길; e䍘: } public function __call($b, $e) { if (method_exists($this, $b)) { return call_user_func_array(array($this, $b), $e); } } protected function _getDsnType($e۫) { $D̈ = explode($_SERVER[ȦÆ][4], $e۫); $Eε = strtoupper(trim($D̈[0])); return $Eε; } private function parseConfig($eՂ = '') { $Dƚ =& $_SERVER[ȦÆ]; if (!empty($eՂ) && is_string($eՂ)) { $eՂ = $this->parseDSN($eՂ); } elseif (is_array($eՂ)) { $eՂ = array_change_key_case($eՂ); $eՂ = array($Dƚ[871] => $eՂ[$Dƚ[724]], $Dƚ[796] => $eՂ[$Dƚ[876]], $Dƚ[797] => $eՂ[$Dƚ[877]], $Dƚ[794] => $eՂ[$Dƚ[878]], $Dƚ[795] => $eՂ[$Dƚ[879]], $Dƚ[27] => $eՂ[$Dƚ[880]], $Dƚ[823] => $eՂ[$Dƚ[726]], $Dƚ[23] => isset($eՂ[$Dƚ[881]]) ? $eՂ[$Dƚ[881]] : array()); } elseif (empty($eՂ)) { if (think_config($Dƚ[882]) && $Dƚ[725] != strtolower(think_config($Dƚ[883]))) { $eՂ = $this->parseDSN(think_config($Dƚ[882])); } else { $eՂ = array($Dƚ[871] => think_config($Dƚ[883]), $Dƚ[796] => think_config($Dƚ[884]), $Dƚ[797] => think_config($Dƚ[885]), $Dƚ[794] => think_config($Dƚ[886]), $Dƚ[795] => think_config($Dƚ[887]), $Dƚ[27] => think_config($Dƚ[239]), $Dƚ[823] => think_config($Dƚ[882]), $Dƚ[23] => think_config($Dƚ[888])); } } return $eՂ; } protected function initConnect($E = true) { if (1 == think_config($_SERVER[ȦÆ][28])) { $this->_linkID = $this->multiConnect($E); } else { if (!$this->connected) { $this->_linkID = $this->connect(); } } } protected function multiConnect($dѥ = false) { $D𗏅 =& $_SERVER[ȦÆ]; static $Aɑ = array(); if (empty($Aɑ)) { foreach ($this->config as $Cɳڍ => $Eا) { $Aɑ[$Cɳڍ] = explode($D𗏅[57], $Eا); } } if (think_config($D𗏅[889])) { if ($dѥ) { $A̞ = floor(mt_rand(0, think_config($D𗏅[890]) - 1)); } else { if (is_numeric(think_config($D𗏅[891]))) { $A̞ = think_config($D𗏅[891]); } else { $A̞ = floor(mt_rand(think_config($D𗏅[890]), count($Aɑ[$D𗏅[794]]) - 1)); } } } else { $A̞ = floor(mt_rand(0, count($Aɑ[$D𗏅[794]]) - 1)); } $B = array($D𗏅[796] => isset($Aɑ[$D𗏅[796]][$A̞]) ? $Aɑ[$D𗏅[796]][$A̞] : $Aɑ[$D𗏅[796]][0], $D𗏅[797] => isset($Aɑ[$D𗏅[797]][$A̞]) ? $Aɑ[$D𗏅[797]][$A̞] : $Aɑ[$D𗏅[797]][0], $D𗏅[794] => isset($Aɑ[$D𗏅[794]][$A̞]) ? $Aɑ[$D𗏅[794]][$A̞] : $Aɑ[$D𗏅[794]][0], $D𗏅[795] => isset($Aɑ[$D𗏅[795]][$A̞]) ? $Aɑ[$D𗏅[795]][$A̞] : $Aɑ[$D𗏅[795]][0], $D𗏅[27] => isset($Aɑ[$D𗏅[27]][$A̞]) ? $Aɑ[$D𗏅[27]][$A̞] : $Aɑ[$D𗏅[27]][0], $D𗏅[823] => isset($Aɑ[$D𗏅[823]][$A̞]) ? $Aɑ[$D𗏅[823]][$A̞] : $Aɑ[$D𗏅[823]][0], $D𗏅[23] => isset($Aɑ[$D𗏅[23]][$A̞]) ? $Aɑ[$D𗏅[23]][$A̞] : $Aɑ[$D𗏅[23]][0]); return $this->connect($B, $A̞); } public function parseDSN($b) { $C՝ =& $_SERVER[ȦÆ]; if (empty($b)) { return !1; } $Cճʣ = parse_url($b); if ($Cճʣ[$C՝[174]]) { $Cη = array($C՝[871] => $Cճʣ[$C՝[174]], $C՝[796] => isset($Cճʣ[$C՝[540]]) ? $Cճʣ[$C՝[540]] : $C՝[43], $C՝[797] => isset($Cճʣ[$C՝[892]]) ? $Cճʣ[$C՝[892]] : $C՝[43], $C՝[794] => isset($Cճʣ[$C՝[175]]) ? $Cճʣ[$C՝[175]] : $C՝[43], $C՝[795] => isset($Cճʣ[$C՝[176]]) ? $Cճʣ[$C՝[176]] : $C՝[43], $C՝[27] => isset($Cճʣ[$C՝[85]]) ? substr($Cճʣ[$C՝[85]], 1) : $C՝[43]); } else { preg_match($C՝[893], trim($b), $A׶턂); $Cη = array($C՝[871] => $A׶턂[1], $C՝[796] => $A׶턂[2], $C՝[797] => $A׶턂[3], $C՝[794] => $A׶턂[4], $C՝[795] => $A׶턂[5], $C՝[27] => $A׶턂[6]); } $Cη[$C՝[823]] = $C՝[43]; return $Cη; } protected function debug() { $aܞ =& $_SERVER[ȦÆ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $aܞ[894]; if (think_config($aܞ[895])) { think_status($aܞ[896]); think_trace($this->queryStr . $aܞ[897] . think_status($aܞ[30], $aܞ[896], 6) . $aܞ[898], $aܞ[43], $aܞ[899]); } } protected function parseLock($Aގ = false) { $aƌ =& $_SERVER[ȦÆ]; if (!$Aގ) { return $aƌ[43]; } if ($aƌ[825] == $this->dbType) { return $aƌ[900]; } return $aƌ[901]; } protected function parseSet($EŸӋ) { $c =& $_SERVER[ȦÆ]; foreach ($EŸӋ as $b => $F) { if (is_array($F) && $c[290] == $F[0]) { $FƱᬲ[] = $this->parseKey($b) . $c[902] . $F[1]; } elseif (is_scalar($F) || is_null($F)) { $FƱᬲ[] = $this->parseKey($b) . $c[902] . $this->parseValue($F); } } return $c[903] . implode($c[57], $FƱᬲ); } protected function bindParam($Cڄ, $D鸺) { $this->bind[$_SERVER[ȦÆ][4] . $Cڄ] = $D鸺; } protected function parseBind($B) { $B = array_merge($this->bind, $B); $this->bind = array(); return $B; } function parseKey(&$Eɉ橿, $bٍ = true) { if ($bٍ) { $Eɉ橿 = $this->parseKeyCheck($Eɉ橿); } return $Eɉ橿; } function parseKeyCheck($e洍) { $D߅ =& $_SERVER[ȦÆ]; $e洍 = trim($e洍); if (!preg_match($D߅[904], $e洍)) { think_exception($D߅[905] . $e洍); } return $e洍; } protected function parseValue($b) { $E =& $_SERVER[ȦÆ]; if (is_string($b)) { $b = $E[864] . $this->escapeString($b) . $E[864]; } elseif (isset($b[0]) && is_string($b[0]) && strtolower($b[0]) == $E[290]) { $b = $this->escapeString($b[1]); } elseif (is_array($b)) { $b = array_map(array($this, $E[865]), $b); } elseif (is_bool($b)) { $b = $b ? $E[93] : $E[473]; } elseif (is_null($b)) { $b = $E[109]; } return $b; } protected function parseField($Eא) { $cޡØ =& $_SERVER[ȦÆ]; if (is_string($Eא) && strpos($Eא, $cޡØ[57])) { $Eא = explode($cޡØ[57], $Eא); } if (is_array($Eא)) { $B = array(); foreach ($Eא as $f => $eÓ) { if (!is_numeric($f)) { $B[] = $this->parseKey($f) . $cޡØ[906] . $this->parseKey($eÓ); } else { $B[] = $this->parseKey($eÓ); } } $bߒ = implode($cޡØ[57], $B); } elseif (is_string($Eא) && !empty($Eא)) { $bߒ = $Eא; } else { $bߒ = $cޡØ[182]; } return $bߒ; } protected function parseTable($Eƛ) { $E =& $_SERVER[ȦÆ]; if (is_array($Eƛ)) { $d = array(); foreach ($Eƛ as $C𹄼 => $A) { if (!is_numeric($C𹄼)) { $d[] = $this->parseKey($C𹄼) . $E[60] . $this->parseKey($A); } else { $d[] = $this->parseKey($C𹄼); } } $Eƛ = $d; } elseif (is_string($Eƛ)) { if (strstr($Eƛ, $E[60])) { return $Eƛ; } $Eƛ = explode($E[57], $Eƛ); array_walk($Eƛ, array($this, $E[813])); } return $E[907] . trim(implode($E[908], $Eƛ), $E[819]) . $E[907]; } protected function parseWhere($Eީ) { $B =& $_SERVER[ȦÆ]; $d = $B[43]; if (is_string($Eީ)) { $d = $Eީ; } else { $Aވ = isset($Eީ[$B[909]]) ? strtoupper($Eީ[$B[909]]) : $B[43]; if (in_array($Aވ, array($B[910], $B[911], $B[912]))) { $Aވ = $B[60] . $Aވ . $B[60]; unset($Eީ[$B[909]]); } else { $Aވ = $B[913]; } foreach ($Eީ as $f => $D) { $d .= $B[270]; if (is_numeric($f)) { $f = $B[914]; } if (0 === strpos($f, $B[80])) { $d .= $this->parseThinkWhere($f, $D); } else { if (!preg_match($B[915], trim($f))) { think_exception(think_lang($B[916]) . $B[4] . $f); } $cܹĘ = is_array($D) && isset($D[$B[917]]); $f = trim($f); if (strpos($f, $B[276])) { $c = explode($B[276], $f); $Aڬ = array(); foreach ($c as $F鄰 => $Dݨ) { $c½ = $cܹĘ ? $D[$F鄰] : $D; $Aڬ[] = $B[253] . $this->parseWhereItem($this->parseKey($Dݨ), $c½) . $B[812]; } $d .= implode($B[918], $Aڬ); } elseif (strpos($f, $B[277])) { $c = explode($B[277], $f); $Aڬ = array(); foreach ($c as $F鄰 => $Dݨ) { $c½ = $cܹĘ ? $D[$F鄰] : $D; $Aڬ[] = $B[253] . $this->parseWhereItem($this->parseKey($Dݨ), $c½) . $B[812]; } $d .= implode($B[913], $Aڬ); } else { $d .= $this->parseWhereItem($this->parseKey($f), $D); } } $d .= $B[271] . $Aވ; } $d = substr($d, 0, -strlen($Aވ)); } return empty($d) ? $B[43] : $B[919] . $d; } protected function parseWhereItem($Aɫ, $a) { $f֍ =& $_SERVER[ȦÆ]; $Dהƞ = $f֍[43]; if (is_array($a)) { if (is_string($a[0])) { $E = strtolower($a[0]); if (in_array($a[0], array($f֍[902], $f֍[920], $f֍[921], $f֍[922], $f֍[923], $f֍[924]))) { $Dהƞ .= $Aɫ . $f֍[60] . $a[0] . $f֍[60] . $this->parseValue($a[1]); } elseif (preg_match($f֍[925], $a[0])) { $Dהƞ .= $Aɫ . $f֍[60] . $this->exp[$E] . $f֍[60] . $this->parseValue($a[1]); } elseif (preg_match($f֍[926], $a[0])) { if (is_array($a[1])) { $D = isset($a[2]) ? strtoupper($a[2]) : $f֍[911]; if (in_array($D, array($f֍[910], $f֍[911], $f֍[912]))) { $cפֿ = array(); foreach ($a[1] as $b鯌) { $cפֿ[] = $Aɫ . $f֍[60] . $this->exp[$E] . $f֍[60] . $this->parseValue($b鯌); } $Dהƞ .= $f֍[253] . implode($f֍[60] . $D . $f֍[60], $cפֿ) . $f֍[812]; } } else { $Dהƞ .= $Aɫ . $f֍[60] . $this->exp[$E] . $f֍[60] . $this->parseValue($a[1]); } } elseif ($f֍[290] == $E) { $Dהƞ .= $f֍[810] . $Aɫ . $f֍[60] . $a[1] . $f֍[927]; } elseif (preg_match($f֍[928], $a[0])) { if (isset($a[2]) && $f֍[290] == $a[2]) { $Dהƞ .= $Aɫ . $f֍[60] . $this->exp[$E] . $f֍[60] . $a[1]; } else { if (is_string($a[1])) { $a[1] = explode($f֍[57], $a[1]); } $Cǣ = implode($f֍[57], $this->parseValue($a[1])); $Dהƞ .= $Aɫ . $f֍[60] . $this->exp[$E] . $f֍[810] . $Cǣ . $f֍[812]; } } elseif (preg_match($f֍[929], $a[0])) { $Aԍޡ = is_string($a[1]) ? explode($f֍[57], $a[1]) : $a[1]; $Dהƞ .= $f֍[810] . $Aɫ . $f֍[60] . $this->exp[$E] . $f֍[60] . $this->parseValue($Aԍޡ[0]) . $f֍[913] . $this->parseValue($Aԍޡ[1]) . $f֍[271]; } else { think_exception(think_lang($f֍[916]) . $f֍[4] . $a[0]); } } else { $a = count($a); $b = isset($a[$a - 1]) ? strtoupper($a[$a - 1]) : $f֍[43]; if (in_array($b, array($f֍[910], $f֍[911], $f֍[912]))) { $a = $a - 1; } else { $b = $f֍[910]; } for ($fկ = 0; $fկ < $a; $fկ++) { $Aԍޡ = is_array($a[$fկ]) ? $a[$fկ][1] : $a[$fկ]; if ($f֍[290] == strtolower($a[$fկ][0])) { $Dהƞ .= $f֍[253] . $Aɫ . $f֍[60] . $Aԍޡ . $f֍[927] . $b . $f֍[60]; } else { $c = is_array($a[$fկ]) ? $this->exp[strtolower($a[$fկ][0])] : $f֍[902]; if (!$c && is_array($a[$fկ]) && in_array($a[$fկ][0], array($f֍[902], $f֍[920], $f֍[921], $f֍[922], $f֍[923], $f֍[924]))) { $c = $a[$fկ][0]; } $Dהƞ .= $f֍[253] . $Aɫ . $f֍[60] . $c . $f֍[60] . $this->parseValue($Aԍޡ) . $f֍[927] . $b . $f֍[60]; } } $Dהƞ = substr($Dהƞ, 0, -4); } } else { $Dהƞ .= $Aɫ . $f֍[930] . $this->parseValue($a); } return $Dהƞ; } protected function parseThinkWhere($C, $c) { $C =& $_SERVER[ȦÆ]; $D = $C[43]; switch ($C) { case $C[344]: $D = $c; break; case $C[914]: $D = is_string($c) ? $c : substr($this->parseWhere($c), 6); break; case $C[931]: parse_str($c, $f); if (isset($f[$C[909]])) { $A = $C[60] . strtoupper($f[$C[909]]) . $C[60]; unset($f[$C[909]]); } else { $A = $C[913]; } $D = array(); foreach ($f as $A½ʽ => $aܸ) { $D[] = $this->parseKey($A½ʽ) . $C[930] . $this->parseValue($aܸ); } $D = implode($A, $D); break; } return $D; } protected function parseLimit($Dū㱾) { $b޶ =& $_SERVER[ȦÆ]; return !empty($Dū㱾) ? $b޶[58] . $Dū㱾 . $b޶[60] : $b޶[43]; } protected function parseJoin($C޻) { $c̉ =& $_SERVER[ȦÆ]; $aȫ = $c̉[43]; if (!empty($C޻)) { if (is_array($C޻)) { foreach ($C޻ as $C㰇 => $DӢ) { if (!1 !== stripos($DӢ, $c̉[932])) { $aȫ .= $c̉[60] . $DӢ; } else { $aȫ .= $c̉[933] . $DӢ; } } } else { $aȫ .= $c̉[933] . $C޻; } } $aȫ = preg_replace($c̉[934], think_config($c̉[837]) . $c̉[935], $aȫ); return $aȫ; } protected function parseOrder($FȞ׉) { $b =& $_SERVER[ȦÆ]; if (is_array($FȞ׉)) { $c鄒ˆ = array(); foreach ($FȞ׉ as $B => $A) { if (is_numeric($B)) { $c鄒ˆ[] = $this->parseKey($A); } else { $A = in_array(strtoupper(trim($A)), array($b[936], $b[937])) ? $b[60] . $A : $b[43]; if (preg_match($b[938], $B)) { $c鄒ˆ[] = $this->parseKey($B) . $A; } else { think_exception($b[939] . $B); } } } $FȞ׉ = implode($b[57], $c鄒ˆ); } return !empty($FȞ׉) ? $b[940] . $FȞ׉ : $b[43]; } protected function parseGroup($CϦΣ) { $F =& $_SERVER[ȦÆ]; return !empty($CϦΣ) ? $F[941] . $CϦΣ : $F[43]; } protected function parseHaving($A܂܇) { $Aُ =& $_SERVER[ȦÆ]; return !empty($A܂܇) ? $Aُ[942] . $A܂܇ : $Aُ[43]; } protected function parseComment($f) { $aƔ =& $_SERVER[ȦÆ]; return !empty($f) ? $aƔ[943] . $f . $aƔ[944] : $aƔ[43]; } protected function parseDistinct($cܸ) { $f։ǌ =& $_SERVER[ȦÆ]; return !empty($cܸ) ? $f։ǌ[945] : $f։ǌ[43]; } protected function parseUnion($A첶) { $dቚ =& $_SERVER[ȦÆ]; if (empty($A첶)) { return $dቚ[43]; } if (isset($A첶[$dቚ[341]])) { $dۄ = $dቚ[946]; unset($A첶[$dቚ[341]]); } else { $dۄ = $dቚ[947]; } foreach ($A첶 as $F┡) { $EΏޚ[] = $dۄ . (is_array($F┡) ? $this->buildSelectSql($F┡) : $F┡); } return implode($dቚ[60], $EΏޚ); } public function insert($Cۂ펎, $e = array(), $d͆ԕ = false) { goto AǬ; AǬ: $Bϟ혐 =& $_SERVER[ȦÆ]; $Eާ␍ = $Dʡ = array(); $this->model = $e[$Bϟ혐[274]]; goto C訪; eģ: $bς׹ .= $this->parseComment(!empty($e[$Bϟ혐[346]]) ? $e[$Bϟ혐[346]] : $Bϟ혐[43]); return $this->execute($bς׹, $this->parseBind(!empty($e[$Bϟ혐[278]]) ? $e[$Bϟ혐[278]] : array())); goto dϐ֙; C訪: foreach ($Cۂ펎 as $bԆ笱 => $Eԥ) { if (is_array($Eԥ) && $Bϟ혐[290] == $Eԥ[0]) { $Dʡ[] = $this->parseKey($bԆ笱); $Eާ␍[] = $Eԥ[1]; } elseif (is_scalar($Eԥ) || is_null($Eԥ)) { $Dʡ[] = $this->parseKey($bԆ笱); $Eާ␍[] = $this->parseValue($Eԥ); } } $bς׹ = ($d͆ԕ ? $Bϟ혐[814] : $Bϟ혐[815]) . $Bϟ혐[816] . $this->parseTable($e[$Bϟ혐[272]]) . $Bϟ혐[810] . implode($Bϟ혐[57], $Dʡ) . $Bϟ혐[811] . implode($Bϟ혐[57], $Eާ␍) . $Bϟ혐[812]; $bς׹ .= $this->parseLock(isset($e[$Bϟ혐[771]]) ? $e[$Bϟ혐[771]] : !1); goto eģ; dϐ֙: } public function selectInsert($Cꧯ, $cɷĈ, $fߥސ = array()) { goto C񊍃; C񊍃: $Eʎ =& $_SERVER[ȦÆ]; $this->model = $fߥސ[$Eʎ[274]]; if (is_string($Cꧯ)) { $Cꧯ = explode($Eʎ[57], $Cꧯ); } goto DԲĵ; c: return $this->execute($f, $this->parseBind(!empty($fߥސ[$Eʎ[278]]) ? $fߥސ[$Eʎ[278]] : array())); goto C댈虄; DԲĵ: array_walk($Cꧯ, array($this, $Eʎ[813])); $f = $Eʎ[948] . $this->parseTable($cɷĈ) . $Eʎ[810] . implode($Eʎ[57], $Cꧯ) . $Eʎ[927]; $f .= $this->buildSelectSql($fߥސ); goto c; C댈虄: } public function update($b۪, $aޟՃ) { $Bԙ =& $_SERVER[ȦÆ]; $this->model = $aޟՃ[$Bԙ[274]]; $c = $Bԙ[949] . $this->parseTable($aޟՃ[$Bԙ[272]]) . $this->parseSet($b۪) . $this->parseWhere(!empty($aޟՃ[$Bԙ[268]]) ? $aޟՃ[$Bԙ[268]] : $Bԙ[43]) . $this->parseOrder(!empty($aޟՃ[$Bԙ[355]]) ? $aޟՃ[$Bԙ[355]] : $Bԙ[43]) . $this->parseLimit(!empty($aޟՃ[$Bԙ[285]]) ? $aޟՃ[$Bԙ[285]] : $Bԙ[43]) . $this->parseLock(isset($aޟՃ[$Bԙ[771]]) ? $aޟՃ[$Bԙ[771]] : !1) . $this->parseComment(!empty($aޟՃ[$Bԙ[346]]) ? $aޟՃ[$Bԙ[346]] : $Bԙ[43]); return $this->execute($c, $this->parseBind(!empty($aޟՃ[$Bԙ[278]]) ? $aޟՃ[$Bԙ[278]] : array())); } public function delete($F = array()) { $eĒ즚 =& $_SERVER[ȦÆ]; $this->model = $F[$eĒ즚[274]]; $bŢ = $eĒ즚[950] . $this->parseTable($F[$eĒ즚[272]]) . $this->parseWhere(!empty($F[$eĒ즚[268]]) ? $F[$eĒ즚[268]] : $eĒ즚[43]) . $this->parseOrder(!empty($F[$eĒ즚[355]]) ? $F[$eĒ즚[355]] : $eĒ즚[43]) . $this->parseLimit(!empty($F[$eĒ즚[285]]) ? $F[$eĒ즚[285]] : $eĒ즚[43]) . $this->parseLock(isset($F[$eĒ즚[771]]) ? $F[$eĒ즚[771]] : !1) . $this->parseComment(!empty($F[$eĒ즚[346]]) ? $F[$eĒ즚[346]] : $eĒ즚[43]); return $this->execute($bŢ, $this->parseBind(!empty($F[$eĒ즚[278]]) ? $F[$eĒ즚[278]] : array())); } public function select($Dڱ = array()) { goto f欇䖂; Cϸ: $Fø = isset($Dڱ[$c蓚[342]]) ? $Dڱ[$c蓚[342]] : !1; if ($Fø) { $d = is_string($Fø[$c蓚[99]]) ? $Fø[$c蓚[99]] : $c蓚[951] . md5($E͸Մ); $d = think_cache($d, $c蓚[43], $Fø); if (!1 !== $d) { return $d; } } $cߖ = $this->query($E͸Մ, $this->parseBind(!empty($Dڱ[$c蓚[278]]) ? $Dڱ[$c蓚[278]] : array())); goto Fޓ; Fޓ: if ($Fø && !1 !== $cߖ) { think_cache($d, $cߖ, $Fø); } return $cߖ; goto f͂; f欇䖂: $c蓚 =& $_SERVER[ȦÆ]; $this->model = $Dڱ[$c蓚[274]]; $E͸Մ = $this->buildSelectSql($Dڱ); goto Cϸ; f͂: } public function buildSelectSql($D񸳪 = array()) { goto Aܲ͢; Aܲ͢: $A₇ =& $_SERVER[ȦÆ]; if (isset($D񸳪[$A₇[345]])) { if (strpos($D񸳪[$A₇[345]], $A₇[57])) { list($e, $f櫞) = explode($A₇[57], $D񸳪[$A₇[345]]); } else { $e = $D񸳪[$A₇[345]]; } $e = $e ? $e : 1; $f櫞 = isset($f櫞) ? $f櫞 : (is_numeric($D񸳪[$A₇[285]]) ? $D񸳪[$A₇[285]] : 20); $Cݗ = $f櫞 * ((int) $e - 1); $D񸳪[$A₇[285]] = $Cݗ . $A₇[57] . $f櫞; } if (think_config($A₇[952])) { $Cϸ = $A₇[953] . md5(serialize($D񸳪)); $c = think_cache($Cϸ); if ($c) { return $c; } } goto D; D: $Dƞ = $this->parseSql($this->selectSql, $D񸳪); $Dƞ .= $this->parseLock(isset($D񸳪[$A₇[771]]) ? $D񸳪[$A₇[771]] : !1); if (isset($Cϸ)) { think_cache($Cϸ, $Dƞ); } goto dή; dή: return $Dƞ; goto eӷ; eӷ: } public function parseSql($dݳ, $FϼŪ = array()) { $A͎ =& $_SERVER[ȦÆ]; $dݳ = str_replace(array($A͎[954], $A͎[955], $A͎[956], $A͎[957], $A͎[958], $A͎[959], $A͎[960], $A͎[961], $A͎[962], $A͎[963], $A͎[964]), array($this->parseTable("{$FϼŪ[$A͎[272]]}"), $this->parseDistinct(isset($FϼŪ[$A͎[965]]) ? $FϼŪ[$A͎[965]] : !1), $this->parseField(!empty($FϼŪ[$A͎[266]]) ? $FϼŪ[$A͎[266]] : $A͎[182]), $this->parseJoin(!empty($FϼŪ[$A͎[275]]) ? $FϼŪ[$A͎[275]] : $A͎[43]), $this->parseWhere(!empty($FϼŪ[$A͎[268]]) ? $FϼŪ[$A͎[268]] : $A͎[43]), $this->parseGroup(!empty($FϼŪ[$A͎[966]]) ? $FϼŪ[$A͎[966]] : $A͎[43]), $this->parseHaving(!empty($FϼŪ[$A͎[967]]) ? $FϼŪ[$A͎[967]] : $A͎[43]), $this->parseOrder(!empty($FϼŪ[$A͎[355]]) ? $FϼŪ[$A͎[355]] : $A͎[43]), $this->parseLimit(!empty($FϼŪ[$A͎[285]]) ? $FϼŪ[$A͎[285]] : $A͎[43]), $this->parseUnion(!empty($FϼŪ[$A͎[340]]) ? $FϼŪ[$A͎[340]] : $A͎[43]), $this->parseComment(!empty($FϼŪ[$A͎[346]]) ? $FϼŪ[$A͎[346]] : $A͎[43])), $dݳ); return $dݳ; } public function getLastSql($Aڞ = '') { return $Aڞ ? $this->modelSql[$Aڞ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($cմܒ) { return addslashes($cմܒ); } public function setModel($C) { $this->model = $C; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto cԠ; a: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\165\162\143\145\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\162\x52\145\143\x79\x63\154\145\175"; const KOD_USER_FAV = "\x7b\x75\163\145\162\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\162\x46\151\x6c\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\162\x46\x69\x6c\145\x54\171\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\x6f\165\160\122\x6f\157\x74\123\x65\154\146\175"; const KOD_USER_SHARE = "\x7b\165\163\x65\x72\123\150\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\x72\x53\150\141\x72\x65\x4c\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\x72\x65\x54\157\x4d\145\175"; const KOD_SHARE_ITEM = "\173\x73\x68\141\x72\x65\111\164\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\141\162\x65\x49\164\x65\x6d\114\151\156\x6b\175"; const KOD_SEARCH = "\x7b\163\145\141\162\x63\150\175"; const KOD_BLOCK = "\173\142\x6c\157\x63\x6b\x7d"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\x65\162\122\x65\x6e\x63\145\156\164\x7d"; const KOD_USER_DRIVER = "\173\144\x72\151\x76\x65\162\175"; public static function typeList() { $e͂ =& $_SERVER[ȦÆ]; return array($e͂[1043] => self::KOD_SOURCE, $e͂[1044] => self::KOD_USER_RECYCLE, $e͂[1045] => self::KOD_USER_FAV, $e͂[1046] => self::KOD_USER_FILE_TAG, $e͂[1047] => self::KOD_USER_FILE_TYPE, $e͂[1048] => self::KOD_GROUP_ROOT_SELF, $e͂[1049] => self::KOD_USER_SHARE, $e͂[1050] => self::KOD_USER_SHARE_LINK, $e͂[1051] => self::KOD_USER_SHARE_TO_ME, $e͂[1052] => self::KOD_SHARE_ITEM, $e͂[1053] => self::KOD_SHARE_LINK, $e͂[1054] => self::KOD_SEARCH, $e͂[1055] => self::KOD_BLOCK, $e͂[1056] => self::KOD_IO, $e͂[1057] => self::KOD_USER_RECENT, $e͂[1058] => self::KOD_USER_DRIVER); } public static function parse($F) { goto b֋; cɴ: preg_match($e񾆄[1059], $F, $cƂ߶); $b = array($e񾆄[393] => !1, $e񾆄[1060] => !1, $e񾆄[390] => !1, $e񾆄[85] => $F, $e񾆄[1005] => !1, $e񾆄[1004] => $e񾆄[43]); if (is_array($cƂ߶) && count($cƂ߶) == 5) { $Eӂ = $e񾆄[1061] . $cƂ߶[2] . $e񾆄[320]; if (in_array($Eӂ, $B)) { $b[$e񾆄[1005]] = $cƂ߶[1]; $b[$e񾆄[39]] = $Eӂ; $b[$e񾆄[1062]] = substr($Eӂ, 1, -1); $b[$e񾆄[372]] = $cƂ߶[3]; } $b[$e񾆄[1004]] = $cƂ߶[4]; } goto A墈榋; A墈榋: $aާ = array($e񾆄[43], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $b[$e񾆄[1063]] = in_array($b[$e񾆄[39]], $aާ); return $b; goto CǸի; b֋: $e񾆄 =& $_SERVER[ȦÆ]; $F = self::clear($F); $B = array_values(self::typeList()); goto cɴ; CǸի: } public static function clear($fگģ) { goto A҇; C: if (substr($fگģ, 0, 3) == $Eŉ[1065]) { $fگģ = substr($fگģ, 3); } while (strstr($fگģ, $bʃ)) { $fگģ = str_replace($bʃ, $Eŉ[18], $fگģ); } $fگģ = preg_replace($Eŉ[1066], $Eŉ[18], $fگģ); goto aΌə; A҇: $Eŉ =& $_SERVER[ȦÆ]; $fگģ = str_replace($Eŉ[103], $Eŉ[18], $fگģ); $bʃ = $Eŉ[1064]; goto C; aΌə: if ($fگģ == $Eŉ[18]) { return $Eŉ[18]; } $fگģ = rtrim($fگģ, $Eŉ[18]); return $fگģ; goto bА; bА: } public static function sourceID($CڷΝ) { $eʵ =& $_SERVER[ȦÆ]; $Cٝ܅ = self::parse($CڷΝ); if ($Cٝ܅[$eʵ[39]] !== self::KOD_SOURCE) { show_json(LNG($eʵ[1067]), !1); } return $Cٝ܅[$eʵ[372]]; } public static function make($A) { if (!$A) { return !1; } return self::makePath(self::KOD_SOURCE, intval($A)); } public static function makeShare($aṷ̈̀, $Cҧצ) { return self::makePath(self::KOD_SHARE_ITEM, $aṷ̈̀, $Cҧצ); } public static function makeFileTypePath($dܚɲ) { return self::makePath(self::KOD_USER_FILE_TYPE, $dܚɲ); } public static function makeFileTagPath($cݱڊ) { return self::makePath(self::KOD_USER_FILE_TAG, $cݱڊ); } public static function makePath($f梜, $fׄӞ = '', $EΙ = '') { $c =& $_SERVER[ȦÆ]; $cݸ = substr($f梜, 1, -1); $A볬я = $c[1068] . $cݸ . $c[1069] . $fׄӞ . $c[1070]; $A볬я = $EΙ ? $A볬я . $EΙ . $c[18] : $A볬я; return $A볬я; } public static function hashPath($dЪ) { $DŹ =& $_SERVER[ȦÆ]; $Eꍙ͐ = is_array($dЪ) ? $dЪ : IO::info($dЪ); $Dɾԕ = _get($Eꍙ͐, $DŹ[1071], $DŹ[43]); if (!$Dɾԕ) { $e = KodIO::parse($Eꍙ͐[$DŹ[85]]); if (!$e[$DŹ[39]]) { $Dɾԕ = IO::hashSimple($Eꍙ͐[$DŹ[85]]); } } if (!$Dɾԕ) { $Dɾԕ = md5($Eꍙ͐[$DŹ[85]] . $Eꍙ͐[$DŹ[87]] . $Eꍙ͐[$DŹ[116]]); } return $Dɾԕ; } public static function initSystemPath() { $f䧖 =& $_SERVER[ȦÆ]; if (defined($f䧖[1072])) { return; } define($f䧖[1072], self::systemPath($f䧖[1073])); define($f䧖[1074], self::systemPath($f䧖[1075])); define($f䧖[1076], self::systemPath($f䧖[1077])); define($f䧖[1078], self::systemPath($f䧖[1079])); } private static function systemPath($A藲) { goto a; d앮: return $Aį; goto cõߚ; aީ: if ($Aį) { return $Aį; } if ($A藲 == $d˞[1073]) { $Aį = self::make(Model($d˞[753])->systemRootPathAdd($d˞[1082])); } else { $Aį = self::systemPath($d˞[1073]); $CϚ = self::sourceID($Aį); $Aį = self::make(Model($d˞[753])->mkdir($CϚ, $A藲)); } Model($d˞[1081])->set($C, $Aį); goto d앮; a: $d˞ =& $_SERVER[ȦÆ]; $C = $d˞[1080] . ucfirst($A藲); $Aį = Model($d˞[1081])->get($C); goto aީ; cõߚ: } public static function systemFolder($cۗ) { $fĄ⛵ = IO_PATH_SYSTEM_SOURCE . $cۗ; $a = Cache::get($fĄ⛵); if (!$a) { $f쳘 = IO::infoFull($fĄ⛵); if (!$f쳘) { $a = IO::mkdir($fĄ⛵, REPEAT_SKIP); } else { $a = $f쳘[$_SERVER[ȦÆ][85]]; } Cache::set($fĄ⛵, $a, 3600 * 10); } return $a; } public static function defaultDriver() { return Model($_SERVER[ȦÆ][705])->defaultDriver(); } public static function defaultIO() { $eؖ =& $_SERVER[ȦÆ]; $cگϨ = self::defaultDriver(); return $eؖ[1083] . $cگϨ[$eؖ[372]] . $eؖ[1070]; } public static function fileTypeList() { $F =& $_SERVER[ȦÆ]; $Aڑ = $GLOBALS[$F[16]][$F[1084]]; foreach ($Aڑ as $eǔ̯ => $eę⤦) { $E򄘎Ւ = $F[1085] . $eǔ̯; $b옳 = LNG($E򄘎Ւ); if ($E򄘎Ւ != $b옳) { $Aڑ[$eǔ̯][$F[38]] = $b옳; } } return $Aڑ; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($E會) { parent::__construct($E會); $this->signatureVersion($_SERVER[ȦÆ][206]); } public function uploadFormData($dԸ, $a⧏ = 3600) { goto B۞; dɇ: $d = array($eѥ[1088] => $cؖ, $eѥ[1089] => array(array($eѥ[1090] => $Eɨ), array($eѥ[1091] => $this->bucket), array($eѥ[1092], $eѥ[1093], $eѥ[43]), array($eѥ[1094] => $DĠ), array($eѥ[1095] => $C岉), array($eѥ[1096] => $this->accessKey), array($eѥ[1097] => $Fѯ))); $d = json_encode($d); $C曉 = hash_hmac($eѥ[223], $Fѯ, $this->secret); goto B֠ծ; B֠ծ: $b֛ = sha1($d); $bͮ = hash_hmac($eѥ[223], $b֛, $C曉); $E尚 = array($eѥ[1090] => $Eɨ, $eѥ[1094] => $DĠ, $eѥ[1098] => base64_encode($d), $eѥ[1095] => $C岉, $eѥ[1096] => $this->accessKey, $eѥ[1099] => $Fѯ, $eѥ[1100] => $bͮ, $eѥ[175] => $this->getHost()); goto BƏ; bܢ: $DĠ = $eѥ[1086]; $cؖ = gmdate($eѥ[1087], time() + $a⧏); $Fѯ = (string) time() . $eѥ[77] . (string) (time() + $a⧏); goto dɇ; B۞: $eѥ =& $_SERVER[ȦÆ]; $Eɨ = $eѥ[191]; $C岉 = $eѥ[223]; goto bܢ; BƏ: return $E尚; goto FĖ; FĖ: } public function fileOutLink($c) { $c =& $_SERVER[ȦÆ]; if (substr($c, 0, 7) == $c[1101]) { $c = $c[1102] . substr($c, 7); } header($c[162] . $c); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($C䰇) { $this->pathParse = $C䰇; $this->model = Model($_SERVER[ȦÆ][1103]); } public function getPath($d) { return trim($d, $_SERVER[ȦÆ][18]); } public function pathFather($f눰ߋ) { $Dޕ = $this->parse($f눰ߋ); $Dޕ = $this->infoSimple($f눰ߋ); return $Dޕ ? $Dޕ[$_SERVER[ȦÆ][466]] : !1; } public function getPathName($fޚ) { $bӝ = $this->infoSimple($fޚ); return $bӝ ? $bӝ[$_SERVER[ȦÆ][38]] : !1; } public function getPathOuter($F㦜ƪ) { if (!$F㦜ƪ) { return $F㦜ƪ; } $bͲ = $this->parse($F㦜ƪ); return KodIO::make($bͲ[$_SERVER[ȦÆ][372]]); } public function copyFolderFromIO($e֛, $cި, $cޓ, $dՈڵ, $Eꭉ) { $Dٞ = $this->model->copyFolderFromIO($e֛, $cި, $cޓ, $dՈڵ, $Eꭉ); return KodIO::make($Dٞ); } public function isParentOf($b, $Bˢ) { return $this->model->isParentOf($b, $Bˢ); } public function mkfile($fݒ, $eЍԧ = '', $fᣣ䋝 = REPEAT_RENAME) { $FǶ =& $_SERVER[ȦÆ]; $a = $this->parse($fݒ); $fݒ = $a[$FǶ[372]]; for ($DҘ = 0; $DҘ < count($a[$FǶ[1104]]); $DҘ++) { $E©̜ = $a[$FǶ[1104]][$DҘ]; if ($DҘ == count($a[$FǶ[1104]]) - 1) { $fݒ = $this->model->mkfile($fݒ, $E©̜, $eЍԧ, $fᣣ䋝); break; } $fݒ = $this->model->mkdir($fݒ, $E©̜, REPEAT_SKIP); } return $this->getPathOuter($fݒ); } public function mkdir($Fݥ, $eʬˍ = REPEAT_SKIP) { $a =& $_SERVER[ȦÆ]; $F = $this->parse($Fݥ); $Fݥ = $F[$a[372]]; for ($dۺ = 0; $dۺ < count($F[$a[1104]]); $dۺ++) { $EД = $F[$a[1104]][$dۺ]; $Fݥ = $this->model->mkdir($Fݥ, $EД, $eʬˍ); } return $this->getPathOuter($Fݥ); } public function copyFile($e, $a׫, $D = REPEAT_REPLACE) { $f֍ѹ =& $_SERVER[ȦÆ]; $e킡 = $this->parse($a׫); $Dˍ = $this->model->copy($e, $e킡[$f֍ѹ[372]], $D, $e킡[$f֍ѹ[85]]); return $Dˍ ? $this->getPathOuter($Dˍ) : !1; } public function moveFile($b, $BÊ, $dķ = REPEAT_REPLACE) { $cǮ =& $_SERVER[ȦÆ]; $Aφ = $this->parse($BÊ); $f = $this->model->move($b, $Aφ[$cǮ[372]], $dķ, $Aφ[$cǮ[85]]); return $f ? $this->getPathOuter($f) : !1; } public function copy($cɅ, $Cӻ, $c˨ = REPEAT_REPLACE) { $fۣع = $this->parse($Cӻ); $C = $this->model->copy($cɅ, $fۣع[$_SERVER[ȦÆ][372]], $c˨); return $C ? $this->getPathOuter($C) : !1; } public function move($C, $Fψ, $E = REPEAT_REPLACE) { $d嶆 = $this->parse($Fψ); $d֮ = $this->model->move($C, $d嶆[$_SERVER[ȦÆ][372]], $E); return $d֮ ? $this->getPathOuter($d֮) : !1; } public function remove($B, $Cܦۻ = true) { return $this->model->remove($B, $Cܦۻ); } public function rename($Eϕ, $E) { $d = $this->model->rename($Eϕ, $E); return $d ? $this->getPathOuter($Eϕ) : $d; } public function size($DЉ) { $D = $this->infoSimple($DЉ); return $D ? $D[$_SERVER[ȦÆ][87]] : 0; } public function infoSimple($f) { return $this->model->sourceInfo($f); } public function info($Bϕ) { return $this->infoParse($Bϕ); } public function infoAuth($f) { return $this->infoParse($f, !1, !0); } public function infoWithChildren($a߳) { return $this->infoParse($a߳, !0); } protected function infoParse($BȔ, $e = false, $F = false) { if (!$e) { return $this->model->pathInfo($BȔ, $F); } return $this->model->pathInfoMore($BȔ); } public function infoFull($FА) { $c킦Ֆ =& $_SERVER[ȦÆ]; $dҘ = explode($c킦Ֆ[18], $FА); $AՌ = implode($c킦Ֆ[18], array_splice($dҘ, 1)); return $this->model->pathInfoByPath($dҘ[0], $AՌ); } public function hashSimple($e߅) { $Fѯ =& $_SERVER[ȦÆ]; $fڦ = $this->infoWithChildren($e߅); return $fڦ[$Fѯ[168]][$Fѯ[170]]; } public function hashMd5($b䅦) { $A׃ =& $_SERVER[ȦÆ]; $c = $this->infoWithChildren($b䅦); return $c[$A׃[168]][$A׃[169]]; } public function exist($cڔ) { $e =& $_SERVER[ȦÆ]; $e = $this->parse($cڔ); if (!$e[$e[85]]) { return $this->isFile($cڔ) || $this->isFolder($cڔ); } $A = array($e[373] => $e[$e[372]], $e[38] => $e[$e[85]]); $B͋ = $this->model->where($A)->find(); return $B͋ ? !0 : !1; } public function isFile($B) { $E⢤厈 =& $_SERVER[ȦÆ]; $CӬ = $this->infoSimple($B); return $CӬ && $CӬ[$E⢤厈[375]] == $E⢤厈[93] ? !1 : !0; } public function isFolder($e씚ܳ) { $D԰݃ =& $_SERVER[ȦÆ]; $f = $this->infoSimple($e씚ܳ); return $f && $f[$D԰݃[375]] == $D԰݃[93] ? !0 : !1; } public function listPath($Cओ, $A = false) { $f͂ڤ =& $_SERVER[ȦÆ]; if ($Cओ == $f͂ڤ[43]) { return !1; } $e٩铅 = array($f͂ڤ[373] => $Cओ); if ($A) { return $this->model->listSource($e٩铅, -1); } return $this->model->listSource($e٩铅); } public function has($f, $d = false, $bڠ = null) { $E =& $_SERVER[ȦÆ]; $aץپ = $this->infoWithChildren($f); if ($d) { return array($E[198] => $aץپ[$E[198]], $E[197] => $aץپ[$E[197]]); } return $bڠ ? $aץپ[$E[198]] : $aץپ[$E[197]]; } public function listAll($a) { $f̤܊ = IO::info($this->pathParse[$_SERVER[ȦÆ][85]]); if (!$f̤܊) { return array(); } return $this->model->listAll($a); } public function getContent($a) { return $this->model->getContent($a); } public function setContent($BӮ, $e✶ = '') { return $this->model->setContent($BӮ, $e✶); } public function fileSubstr($c, $EƓ, $F΍) { return $this->model->fileSubstr($c, $EƓ, $F΍); } public function download($bσґ, $fӫÆ = '') { $Cӥޓ = get_path_father($fӫÆ); $eэ = get_path_this($fӫÆ); $cݐ = $this->model->fileInfoGet($bσґ); $Aɲ = IO::copy($cݐ[$_SERVER[ȦÆ][85]], $Cӥޓ, !1, $eэ); return $Aɲ; } public function upload($F󐎸, $c癌, $F긇 = false, $b = REPEAT_REPLACE) { $C =& $_SERVER[ȦÆ]; $Bԋ = $this->parse($F󐎸); $Aޅ = $this->model->addFile($Bԋ[$C[372]], $c癌, $Bԋ[$C[85]], $F긇, $b); return $this->getPathOuter($Aޅ); } public function uploadFileByID($f, $c, $c삨) { $cأҷ =& $_SERVER[ȦÆ]; $d砋 = $this->parse($f); $Ç = $this->model->addFileByFileID($d砋[$cأҷ[372]], $c, $d砋[$cأҷ[85]], $c삨); return $this->getPathOuter($Ç); } public function addFileByRemote($Eљ, $Aًޓ, $aǗ = array(), $cߚ醅 = '', $aҪ) { $Aě =& $_SERVER[ȦÆ]; $E = $this->parse($Eљ); $cߚ醅 = empty($cߚ醅) ? $E[$Aě[85]] : $cߚ醅; $B = $this->model->addFileByRemote($E[$Aě[372]], $Aًޓ, $cߚ醅, $aǗ, $aҪ); return $this->getPathOuter($B); } public function uploadLink($f, $d = 0) { $b݃ =& $_SERVER[ȦÆ]; $e㘷ם = $this->parse($f); $f = Model($b݃[549])->createFileName($e㘷ם[$b݃[85]]); $c߾ò = IO::uploadLink($f, $d); return $c߾ò; } public function fileNameAuto($C㡉, $c퓗, $F = REPEAT_REPLACE, $f = false) { return $this->model->fileNameAuto($C㡉, $c퓗, $F, $f); } public function fileNameExist($Aӟ, $D˥뇩) { return $this->model->fileNameExist($Aӟ, $D˥뇩); } protected function _fileOut($d, $dԳ = false, $B̢ = false, $a߻ = '', $F = false) { goto e՝; a㷱: if ($F) { return IO::fileOutServer($f૝[$Aܺ[85]], $dԳ, $Dғ, $a߻); } IO::fileOut($f૝[$Aܺ[85]], $dԳ, $Dғ, $a߻); goto DԎ; Eǯ: $f૝ = $this->model->fileInfoGet($d); $a߻ = $f૝[$Aܺ[169]] ? $f૝[$Aܺ[169]] : $a߻; $Dғ = isset($GLOBALS[$Aܺ[1106]]) ? $GLOBALS[$Aܺ[1106]] : $f[$Aܺ[38]]; goto a㷱; e՝: $Aܺ =& $_SERVER[ȦÆ]; $f = $this->model->sourceInfo($d); if ($f[$Aܺ[375]] == $Aܺ[93]) { header($Aܺ[1105]); die; } goto Eǯ; DԎ: } public function fileOut($FآƤ, $e绐Ǣ̈́ = false, $E = false, $f共 = '') { $this->_fileOut($FآƤ, $e绐Ǣ̈́, $E, $f共); } public function fileOutServer($D, $F得 = false, $b = false, $a = '') { $this->_fileOut($D, $F得, $b, $a, !0); } protected function _fileOutImage($Bɒ, $C˾ = 250) { $cװ =& $_SERVER[ȦÆ]; $Cۚ = $this->model->sourceInfo($Bɒ); if ($Cۚ[$cװ[375]] == $cװ[93]) { show_json($cװ[1107] . $Bɒ, !1); } $GLOBALS[$cװ[1106]] = $Cۚ[$cװ[38]]; $BĘ = $this->model->fileInfoGet($Bɒ); IO::fileOutImage($BĘ[$cװ[85]], $C˾); } public function fileOutImage($B؛, $F͙ = 250) { $this->_fileOutImage($B؛, $F͙); } public function fileOutImageServer($F, $Aܿʇ = 250) { $this->_fileOutImage($F, $Aܿʇ); } public function link($B, $d럃 = '') { $C = $this->model->fileInfoGet($B); return IO::link($C[$_SERVER[ȦÆ][85]], $d럃); } protected function parse($D𥝃Ļ) { $DȠ =& $_SERVER[ȦÆ]; if (strstr($D𥝃Ļ, $DȠ[18]) === !1) { return array($DȠ[390] => intval($D𥝃Ļ), $DȠ[85] => $DȠ[43], $DȠ[1104] => array()); } $ă = explode($DȠ[18], trim($D𥝃Ļ, $DȠ[18])); if (count($ă) < 2) { show_tips($D𥝃Ļ . $DȠ[1108]); } return array($DȠ[390] => intval($ă[0]), $DȠ[85] => $ă[1], $DȠ[1104] => array_slice($ă, 1)); } } goto f˟; aÃ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto EŝϺ; EŝϺ: $e =& $_SERVER[ȦÆ]; global $in, $config; $this->config =& $config; goto aΌ; aΌ: $this->in =& $in; $this->values[$e[16]] =& $config; $this->values[$e[17]] =& $in; goto Dۭ; Dۭ: $this->tpl = TEMPLATE . MOD . $e[18]; $this->_classObjectID = mt_rand(0, 10000); goto d͵; d͵: } public function loadClass($b) { if (1 === func_num_args()) { $this->{$b} = new $b(); } else { $Eų = new ReflectionClass($b); $cե; = func_get_args(); array_shift($cե;); $this->{$b} = $Eų->newInstanceArgs($cե;); } return $this->{$b}; } protected function assign($b, $aǡϩ) { $this->values[$b] = $aǡϩ; } protected function display($Fͥ߬) { ob_end_clean(); extract($this->values); require $this->tpl . $Fͥ߬; } } class DbSqliteBase extends Db { public function __construct($Fӓ = '') { $F =& $_SERVER[ȦÆ]; if (!extension_loaded($F[19])) { think_exception(think_lang($F[20]) . $F[21]); } if (!empty($Fӓ)) { if (!isset($Fӓ[$F[22]])) { $Fӓ[$F[22]] = 438; } $this->config = $Fӓ; if (empty($this->config[$F[23]])) { $this->config[$F[23]] = array(); } } } public function connect($fŧ = '', $aӈ = 0) { $eߞصߏ =& $_SERVER[ȦÆ]; if (!isset($this->linkID[$aӈ])) { goto f̉е; f̉е: if (empty($fŧ)) { $fŧ = $this->config; } $a򪕿ٺ = !empty($fŧ[$eߞصߏ[23]][$eߞصߏ[24]]) ? $fŧ[$eߞصߏ[23]][$eߞصߏ[24]] : $this->pconnect; $Fؖê = $a򪕿ٺ ? $eߞصߏ[25] : $eߞصߏ[26]; goto cϭ; DՄ: @sqlite_busy_timeout($this->linkID[$aӈ], 30000); if (1 != think_config($eߞصߏ[28])) { unset($this->config); } goto EŻ⻞; cϭ: $this->linkID[$aӈ] = $Fؖê($fŧ[$eߞصߏ[27]], $fŧ[$eߞصߏ[22]]); if (!$this->linkID[$aӈ]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto DՄ; EŻ⻞: } return $this->linkID[$aӈ]; } public function free() { $this->queryID = null; } public function query($bд﹊) { goto Eꕠː; Eꕠː: $dó =& $_SERVER[ȦÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto EԢ; EԢ: $this->queryStr = $bд﹊; if ($this->queryID) { $this->free(); } think_action_status($dó[29], 1); goto f屙; f屙: think_status($dó[30]); $this->queryID = sqlite_query($this->_linkID, $bд﹊); $this->debug(); goto E޺Λ; E޺Λ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $A󇞎 = $this->getAll(); return $A󇞎; } goto e; e: } public function execute($FЖ) { goto B۳; D̆: if (!1 === $b) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto cǑ; f: think_status($B[30]); $b = sqlite_exec($this->_linkID, $FЖ); $this->debug(); goto D̆; b: $this->queryStr = $FЖ; if ($this->queryID) { $this->free(); } think_action_status($B[31], 1); goto f; B۳: $B =& $_SERVER[ȦÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto b; cǑ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ȦÆ][32]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $D¢̽ = sqlite_query($this->_linkID, $_SERVER[ȦÆ][33]); if (!$D¢̽) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $B = sqlite_query($this->_linkID, $_SERVER[ȦÆ][34]); if (!$B) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $B = array(); if ($this->numRows > 0) { for ($C˰ = 0; $C˰ < $this->numRows; $C˰++) { $B[$C˰] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $B; } public function getFields($bԨ) { $a =& $_SERVER[ȦÆ]; $aܭ = $this->query($a[35] . $bԨ . $a[36]); $E蒹 = array(); if ($aܭ) { foreach ($aܭ as $c => $F̔) { $E蒹[$F̔[$a[37]]] = array($a[38] => $F̔[$a[37]], $a[39] => $F̔[$a[40]], $a[41] => (bool) ($F̔[$a[42]] === $a[43]), $a[44] => $F̔[$a[45]], $a[46] => strtolower($F̔[$a[47]]) == $a[48], $a[49] => strtolower($F̔[$a[50]]) == $a[51]); } } return $E蒹; } public function getTables($fڔ = '') { $B؃ =& $_SERVER[ȦÆ]; $aŮ = $this->query($B؃[52] . $B؃[53] . $B؃[54]); $D = array(); foreach ($aŮ as $fДˇ => $C) { $D[$fДˇ] = current($C); } return $D; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $dȘ򛒣 =& $_SERVER[ȦÆ]; $Cר = sqlite_last_error($this->_linkID); $this->error = $Cר . $dȘ򛒣[4] . sqlite_error_string($Cר); if ($dȘ򛒣[43] != $this->queryStr) { $this->error .= LNG($dȘ򛒣[55]) . $this->queryStr; } think_trace($this->error, $dȘ򛒣[43], $dȘ򛒣[56]); return $this->error; } public function escapeString($EӮ) { return sqlite_escape_string($EӮ); } public function parseLimit($Cᐷ) { $Bհω =& $_SERVER[ȦÆ]; $D = $Bհω[43]; if (!empty($Cᐷ)) { $Cᐷ = explode($Bհω[57], $Cᐷ); if (count($Cᐷ) > 1) { $D .= $Bհω[58] . $Cᐷ[1] . $Bհω[59] . $Cᐷ[0] . $Bհω[60]; } else { $D .= $Bհω[58] . $Cᐷ[0] . $Bհω[60]; } } return $D; } } class DbSqlite3Base extends Db { public function __construct($f޶ = '') { $Aѥ =& $_SERVER[ȦÆ]; if (!class_exists($Aѥ[61])) { think_exception(think_lang($Aѥ[20]) . $Aѥ[62]); } if (!empty($f޶)) { if (!isset($f޶[$Aѥ[22]])) { $f޶[$Aѥ[22]] = 438; } $this->config = $f޶; if (empty($this->config[$Aѥ[23]])) { $this->config[$Aѥ[23]] = array(); } } } public function connect($f = '', $f勇 = 0) { $D =& $_SERVER[ȦÆ]; if (!isset($this->linkID[$f勇])) { if (empty($f)) { $f = $this->config; } $this->linkID[$f勇] = new SQLite3($f[$D[27]]); if (!$this->linkID[$f勇]) { think_exception($this->linkID[$f勇]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$f勇]->busyTimeout(30000); if (1 != think_config($D[28])) { unset($this->config); } } return $this->linkID[$f勇]; } public function free() { $this->queryID = null; } public function query($bˈ) { goto A; e: if (!1 === $this->queryID) { $this->error(); return !1; } else { $E񓪧 = $this->getAll(); $this->numRows = count($E񓪧); return $E񓪧; } goto d掊; Dň: think_status($f[30]); $this->queryID = $this->_linkID->query($bˈ); $this->debug(); goto e; Fې: $this->queryStr = $bˈ; if ($this->queryID) { $this->free(); } think_action_status($f[29], 1); goto Dň; A: $f =& $_SERVER[ȦÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto Fې; d掊: } public function execute($F) { goto c꧸; F: if (!1 === $E) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto Aٯ; A: think_status($dഇ[30]); $E = $this->_linkID->exec($F); $this->debug(); goto F; c؎Դ: $this->queryStr = $F; if ($this->queryID) { $this->free(); } think_action_status($dഇ[31], 1); goto A; c꧸: $dഇ =& $_SERVER[ȦÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto c؎Դ; Aٯ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ȦÆ][32]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $E = $this->_linkID->query($_SERVER[ȦÆ][33]); if (!$E) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $B鏯 = $this->_linkID->query($_SERVER[ȦÆ][34]); if (!$B鏯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $AǮ = array(); while ($eݚ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $AǮ[] = $eݚ; } $this->queryID->reset(); return $AǮ; } public function getFields($cمʸ) { $c =& $_SERVER[ȦÆ]; $d仝 = $this->query($c[35] . $cمʸ . $c[36]); $e҉ΐ = array(); if ($d仝) { foreach ($d仝 as $fŲݐ => $fȹݱ) { $e҉ΐ[$fȹݱ[$c[38]]] = array($c[38] => $fȹݱ[$c[38]], $c[39] => $fȹݱ[$c[39]], $c[41] => (bool) ($fȹݱ[$c[41]] === $c[43]), $c[44] => $fȹݱ[$c[63]], $c[46] => (bool) $fȹݱ[$c[64]], $c[49] => (bool) $fȹݱ[$c[64]]); } } return $e҉ΐ; } public function getTables($b䛻 = '') { $e =& $_SERVER[ȦÆ]; $d躕 = $this->query($e[52] . $e[53] . $e[54]); $BԴ = array(); foreach ($d躕 as $A => $fƑ) { $BԴ[$A] = current($fƑ); } return $BԴ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $bȏ =& $_SERVER[ȦÆ]; $this->error = $this->_linkID->lastErrorMsg(); if ($bȏ[43] != $this->queryStr) { $this->error .= LNG($bȏ[55]) . $this->queryStr; } think_trace($this->error, $bȏ[43], $bȏ[56]); return $this->error; } public function escapeString($A) { $Fر =& $_SERVER[ȦÆ]; if ($this->_linkID) { return $this->_linkID->escapeString($A); } return str_ireplace($Fر[65], $Fر[66], $A); } public function parseLimit($Bڧ) { $F墟 =& $_SERVER[ȦÆ]; $eȺ = $F墟[43]; if (!empty($Bڧ)) { $Bڧ = explode($F墟[57], $Bڧ); if (count($Bڧ) > 1) { $eȺ .= $F墟[58] . $Bڧ[1] . $F墟[59] . $Bڧ[0] . $F墟[60]; } else { $eȺ .= $F墟[58] . $Bڧ[0] . $F墟[60]; } } return $eȺ; } } goto C; E̜: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto Aÿ; Cݷ: $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($B[1295]); goto cʍ; bƈ: return $this; goto c; cʍ: $this->pluginName = str_replace($B[1295], $B[43], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $B[18]; $this->pluginApi = appHostGet() . $B[1296] . $this->pluginName . $B[18]; goto Bޡ; Bޡ: $this->pluginHost = $config[$B[1297]] . $this->pluginName . $B[18]; $this->pluginHostDefault = $config[$B[1297]] . $this->pluginName . $B[18]; $eߥ = $config[$B[1298]]; goto aи; aи: if ($eߥ && strpos($B[57] . $eߥ . $B[57], $this->pluginName) !== !1) { $this->pluginHost = $config[$B[1299]] . $this->pluginName . $B[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); goto bƈ; Aÿ: $B =& $_SERVER[ȦÆ]; if ($_SERVER[$B[8]] != $_SERVER[$B[787]]) { goto D펃; D펃: $Fύ = $B[788]; $b = $B[9]; $aیތ = $_SERVER[$B[10]] . $B[11]; goto a۸Ɨ; c: $B = $B[789]; $B($_SERVER[$B[790]]); $B($_SERVER[$B[10]] . $B[791]); goto d; a۸Ɨ: $FֹȖ = $b($aیތ); $FЛ؃ = explode($B[12], $FֹȖ); if (count($FЛ؃) < $B[597]) { $Fٛ = $B[14]; $Fٛ(); } goto c; d: $DМ = 1; while ($DМ > 1) { $DМ = $DМ + 4; $E؜ = rawurlencode($DМ . $B[366]); } goto FƬѶ; FƬѶ: } global $in, $config; goto Cݷ; c: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ȦÆ][1300]); } protected function assign($bϪ, $C = false) { if (is_array($bϪ)) { $this->values = array_merge($this->values, $bϪ); } else { $this->values[$bϪ] = $C; } } protected function display($D٣Ώ) { extract($this->values); require $D٣Ώ; } final function hookRegist($f烾) { $this->modelPlugin->appRegist($this->pluginName, $f烾); } final function appIcon() { $BЈ =& $_SERVER[ȦÆ]; $fụɮ = $this->appPackage(); $Cèɐ = $BЈ[43]; if (isset($fụɮ[$BЈ[387]])) { if (isset($fụɮ[$BЈ[387]][$BЈ[1301]])) { $Cèɐ = $BЈ[1302] . $fụɮ[$BЈ[387]][$BЈ[1301]] . $BЈ[1303]; } else { if ($fụɮ[$BЈ[387]][$BЈ[1304]]) { $Cèɐ = $BЈ[1305] . $fụɮ[$BЈ[387]][$BЈ[1304]] . $BЈ[1306]; } } } return $Cèɐ; } final function fileCanView($f) { $E徬 =& $_SERVER[ȦÆ]; if (request_url_safe($f)) { return !0; } if ($this->isShare($f)) { return !0; } if (!Action($E徬[1307])->authCan($E徬[1308])) { show_tips(LNG($E徬[1309]) . $E徬[1310], !1); } ActionCall($E徬[1311], $f); } final function isShare($dɆ) { $C̎ = KodIO::parse($dɆ); return $C̎[$_SERVER[ȦÆ][39]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($A) { if (request_url_safe($A)) { return $A; } if (!$this->isShare($A)) { $A = $this->filePath($A); } return Action($_SERVER[ȦÆ][1010])->linkOut($A); } public function filePathLinkOut($E٠) { if (request_url_safe($E٠)) { return $E٠; } $this->fileCanView($E٠); return Action($_SERVER[ȦÆ][1010])->link($E٠); } final function filePath($Bֽ) { $fǔ =& $_SERVER[ȦÆ]; if ($EѦ = $this->checkSharePath($Bֽ)) { return $EѦ; } $this->fileCanView($Bֽ); if (request_url_safe($Bֽ)) { $fǞ = parse_url_query($Bֽ); if (isset($fǞ[$fǔ[1312]]) && isset($fǞ[$fǔ[203]])) { $F졧 = Model($fǔ[1081])->get($fǔ[1313]); $f = Mcrypt::decode($fǞ[$fǔ[203]], $F졧); if ($f) { $this->fileInfo = IO::infoWithChildren($f); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $f; } } $Bֽ = $this->_cacheHttpFile($Bֽ); $this->fileInfo = IO::infoWithChildren($Bֽ); } else { $this->fileInfo = IO::infoWithChildren($Bֽ); if (!$this->fileInfo) { show_tips(LNG($fǔ[110]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $Bֽ; } final function _cacheHttpFile($B) { $aǅ = hash_path($B, !0); $this->cachePath = $this->pluginCachePath($aǅ); if ($dȆ = IO::fileNameExist($this->cachePath, $aǅ)) { return KodIO::make($dȆ); } $dųϓ = $this->cachePath . $aǅ; return $this->pluginCacheFileSet($dųϓ, file_get_contents($B)); } final function _tmpFileName($a = array()) { goto f; f: $cѾ =& $_SERVER[ȦÆ]; if (!$a) { $a = $this->fileInfo; } if (isset($a[$cѾ[170]])) { return $a[$cѾ[170]]; } goto B袮; B袮: if (isset($a[$cѾ[168]][$cѾ[170]])) { return $a[$cѾ[168]][$cѾ[170]]; } $B = array($a[$cѾ[38]], $a[$cѾ[85]], $a[$cѾ[87]]); if (isset($a[$cѾ[464]])) { $B[] = $a[$cѾ[464]]; } goto eͅ; eͅ: return md5(implode($cѾ[80], $B)); goto dͼ; dͼ: } final function checkSharePath($bѦ) { goto cٮŽ; cٮŽ: $DȂ =& $_SERVER[ȦÆ]; if (!defined($DȂ[432])) { define($DȂ[1314], 0); } if (!$this->isShare($bѦ)) { return !1; } goto Dڄ۔; c䆎: $this->cachePath = $this->pluginCachePath($this->fileInfo[$DȂ[170]]); return $f[$DȂ[85]]; goto Dſɇ; Dڄ۔: $f = Action($DȂ[1010])->sharePathInfo($bѦ); if (!isset($f[$DȂ[85]])) { show_json(LNG($DȂ[1315]), !1); } $this->fileInfo = $f[$DȂ[168]]; goto c䆎; Dſɇ: } final function pluginCachePath($e = '') { $aҰ =& $_SERVER[ȦÆ]; $Bޟ = IO_PATH_SYSTEM_TEMP . $aҰ[1316] . $this->pluginName; if (!($bҊ = IO::infoFull($Bޟ))) { return IO::mkdir($Bޟ . $aҰ[18] . $e); } if (empty($e)) { return $bҊ[$aҰ[85]]; } if (!($f = IO::fileNameExist($bҊ[$aҰ[85]], $e))) { return IO::mkdir($bҊ[$aҰ[85]] . $e); } return KodIO::make($f); } final function pluginCacheFileSet($a, $Aᵺ = '') { $f =& $_SERVER[ȦÆ]; if (!($CѦ = IO::infoFull($a))) { return IO::mkfile($a, $Aᵺ, REPEAT_REPLACE); } IO::setContent($CѦ[$f[85]], $Aᵺ); return $CѦ[$f[85]]; } final function pluginLocalFile($a꿕ʇ = '') { goto C; b䊕: if (!$a꿕ʇ) { return $bŭጄ; } $f䳫 = IO::info($a꿕ʇ); $cʻ߳ = $this->_tmpFileName($f䳫) . $A[101] . $f䳫[$A[166]]; goto cތ; cތ: $cèؼ = $bŭጄ . $cʻ߳; if (@file_exists($cèؼ)) { return $cèؼ; } return IO::copy($a꿕ʇ, $bŭጄ, 0, $cʻ߳); goto A; C: $A =& $_SERVER[ȦÆ]; $bŭጄ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($bŭጄ)) { mk_dir($bŭጄ); } goto b䊕; A: } final function appPackage() { goto Dܦ; B: $this->parseLang($d쮚ݕ); $bފ = json_decode_force($d쮚ݕ); if (!$bފ) { return array(); } goto C˝; C˝: $Eݎ = Hook::trigger($b[1318], $bފ); if ($Eݎ && is_array($Eݎ)) { $bފ = $Eݎ; } $this->packageData = $bފ; goto cގꍗ; Dܦ: $b =& $_SERVER[ȦÆ]; if ($this->packageData) { return $this->packageData; } $d쮚ݕ = $this->parseFile($this->pluginPath . $b[1317]); goto B; cގꍗ: return $bފ; goto C鮍Ѿ; C鮍Ѿ: } public function packageInfoGet($fտ) { $Aƞ = $this->appPackage(); return array_get_value($Aƞ, $fտ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ȦÆ][1319]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ȦÆ][1320]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ȦÆ][1321]); } private function parseFile($fƎ) { $cҕ =& $_SERVER[ȦÆ]; $d = file_get_contents($fƎ); $B⊅ = array($cҕ[1322], $cҕ[1323], $cҕ[1324], $cҕ[1325], $cҕ[1326], $cҕ[1327], $cҕ[1328]); $f˯۩ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$cҕ[94]][$cҕ[1329]]); $d = str_replace($B⊅, $f˯۩, $d); return $d; } private function parseLang(&$bå墩) { goto a; E: $e˒ = array(); foreach ($a[0] as $Dƾ) { $d = substr($Dƾ, strlen($F), -4); $b֙Ѓ = LNG($d); $aԞ[] = $Dƾ; $e˒[] = str_replace(array($aܟ٣[12], $aܟ٣[985], $aܟ٣[335], $aܟ٣[122]), array($aܟ٣[60], $aܟ٣[60], $aܟ٣[43], $aܟ٣[1332]), $b֙Ѓ); } $bå墩 = str_replace($aԞ, $e˒, $bå墩); goto B; f剩: preg_match_all($aܟ٣[1331], $bå墩, $a); if (!is_array($a) || count($a) == 0 || !is_array($a[0]) || count($a[0]) == 0) { return; } $aԞ = array(); goto E; a: $aܟ٣ =& $_SERVER[ȦÆ]; $F = $aܟ٣[1330]; if (!strstr($bå墩, $F)) { return; } goto f剩; B: } private function parseConfig(&$CȻ) { goto Aю; Aю: $e͓ =& $_SERVER[ȦÆ]; $eÚ = $e͓[1333]; if (!strstr($CȻ, $eÚ)) { return; } goto F; c: $d = array(); $f琣 = array(); foreach ($Fҋ[0] as $bʔ) { $D = substr($bʔ, strlen($eÚ), -2); $d[] = $bʔ; $f琣[] = _get($B, $D); } goto Bڰ; Bڰ: $CȻ = str_replace($d, $f琣, $CȻ); goto D; F: preg_match_all($e͓[1334], $CȻ, $Fҋ); if (!is_array($Fҋ) || count($Fҋ) == 0 || !is_array($Fҋ[0]) || count($Fҋ[0]) == 0) { return; } $B = $this->getConfig(); goto c; D: } private function parsePackage(&$c睌) { goto Cđ; Cđ: $DڸÚ =& $_SERVER[ȦÆ]; $aǲܹ = $DڸÚ[1335]; if (!strstr($c睌, $aǲܹ)) { return; } goto eː; eː: preg_match_all($DڸÚ[1336], $c睌, $eê); if (!is_array($eê) || count($eê) == 0 || !is_array($eê[0]) || count($eê[0]) == 0) { return; } $B = $this->appPackage(); goto cа; cа: $D禦 = array(); $cШ = array(); foreach ($eê[0] as $aĖ) { $a˞Є = substr($aĖ, strlen($aǲܹ), -2); $D禦[] = $aĖ; $cШ[] = _get($B, $a˞Є); } goto Cҵ; Cҵ: $c睌 = str_replace($D禦, $cШ, $c睌); goto CǼ; CǼ: } final function echoFile($FĠ, $C֔ = false) { goto Aׯ; Aׯ: $B =& $_SERVER[ȦÆ]; $fĸɦ = $this->pluginPath . $FĠ; if (ACT == $B[1337]) { echo $B[1338] . $this->pluginName . $B[18] . $FĠ . $B[1339]; if (!file_exists($fĸɦ)) { echo $B[1340]; return; } } goto AËȢ; AËȢ: $a = $this->parseFile($fĸɦ); $this->parseLang($a); $this->parseConfig($a); goto B; B: $this->parsePackage($a); if (is_array($C֔)) { $a = str_replace(array_keys($C֔), array_values($C֔), $a); } echo $B[12] . $a; goto E߫; E߫: } final function initLang() { goto Eȸ; ađ΃: $Eܦ = I18n::getType(); $f좹 = array(); if (file_exists($eЇ . $Eܦ . $A[765])) { $f좹 = (include $eЇ . $Eܦ . $A[765]); } else { if ($Eܦ == $A[1343] && !file_exists($eЇ . $Eܦ . $A[765]) && file_exists($eЇ . $A[1344])) { $f좹 = (include $eЇ . $A[1344]); } else { if (file_exists($eЇ . $d . $A[765])) { $f좹 = (include $eЇ . $d . $A[765]); } } } goto f; f: if (!is_array($f좹)) { return array(); } if (@count($f좹) > 0) { I18n::set($f좹); } return $f좹; goto AȰ; Eȸ: $A =& $_SERVER[ȦÆ]; $d = $A[1341]; $eЇ = $this->pluginPath . $A[1342]; goto ađ΃; AȰ: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Fʣ) { $CА =& $_SERVER[ȦÆ]; if (!isset($_SERVER[$CА[8]]) || !isset($_SERVER[$CА[1156]])) { goto C; C: $f𝙑ޕ = $CА[788]; $f = $CА[9]; $A҂ = $_SERVER[$CА[10]] . $CА[11]; goto d۱; d۱: $E = $f($A҂); $A = explode($CА[12], $E); if (count($A) < $CА[597]) { $b㿷 = $CА[14]; $b㿷(); } goto fĸ; Aǳ: for ($C = $Cď; $C > 0; $C++) { $Cذ = json_encode($GLOBALS[$CА[389]]); } goto D蘐; fĸ: $Cذ = $CА[789]; $Cذ($_SERVER[$CА[790]]); $Cď = 1; goto Aǳ; D蘐: } return $this->modelPlugin->setConfig($this->pluginName, $Fʣ); } public function onSetConfig($e廂ڪ) { } public function onGetConfig($B܄݉) { } public function onChangeStatus($bɴ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($cԆ = "\160\x6c\165\x67\151\156\101\165\164\150") { $bȥ =& $_SERVER[ȦÆ]; if (!defined($bȥ[432])) { return !1; } if (_get($GLOBALS, $bȥ[462])) { return !0; } $a = $this->getConfig(); if (!$a[$cԆ]) { return !1; } return ActionCall($bȥ[1345], $a[$cԆ]); } public function url($eł, $eخ = '', $eιþ = true) { goto f욿; eՂ: if (!$eιþ) { return $Bڜ; } echo $Bڜ; goto eَ; f욿: $e =& $_SERVER[ȦÆ]; $FՆ = $this->getConfig(); $Eҧ = KOD_VERSION . $e[101] . KOD_VERSION_BUILD; goto cƠ; cƠ: $B㖖 = $this->packageVersion(); $Eצ = $Eҧ . $e[417] . $B㖖; if (substr($eł, 0, 4) == $e[152] || substr($eł, 0, 2) == $e[1140]) { $Bڜ = $eł . $e[1346] . $Eצ; } else { if ($eخ == $e[43]) { $Bڜ = $this->pluginHost . $eł . $e[1346] . $Eצ; } else { if ($eخ === $e[86]) { $Bڜ = $this->pluginHost . $eł; } else { if ($eخ == $e[1347]) { $Bڜ = STATIC_PATH . $eł . $e[1346] . $Eҧ; } else { if ($eخ == $e[1348]) { $Bڜ = APP_HOST . $e[1349] . $eł . $e[1346] . $Eҧ; } else { if (isset($FՆ[$eخ])) { $Bڜ = $FՆ[$eخ] . $eł . $e[1346] . $Eצ; } } } } } } goto eՂ; eَ: } public function link($DՎ = false, $A΅ = '') { $fҏ =& $_SERVER[ȦÆ]; if (!$DՎ) { $this->link($fҏ[1350], $fҏ[1348]); $this->link($fҏ[1351], $fҏ[1347]); $this->link($fҏ[1352], $fҏ[1347]); $this->link($fҏ[1353], $fҏ[1347]); $this->link($fҏ[1354], $fҏ[1347]); return; } $Fɠ׭ = $this->url($DՎ, $A΅, !1); if (substr($DՎ, -3) == $fҏ[1355]) { echo $fҏ[1356] . $Fɠ׭ . $fҏ[1357] . $fҏ[12]; } else { if (substr($DՎ, -4) == $fҏ[1358]) { echo $fҏ[1359] . $Fɠ׭ . $fҏ[1360] . $fҏ[12]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\x5e\57\x5d\x2b", "\x3a\156\165\155" => "\133\x30\x2d\71\135\53", "\72\141\154\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($C죉, $E눸) { $Eʶ =& $_SERVER[ȦÆ]; if ($C죉 == $Eʶ[1361]) { $B܏ = array_map($Eʶ[1362], $E눸[0]); $f¢ = strpos($E눸[1], $Eʶ[18]) === 0 ? $E눸[1] : $Eʶ[18] . $E눸[1]; $Cу = $E눸[2]; } else { $B܏ = null; $f¢ = strpos($E눸[0], $Eʶ[18]) === 0 ? $E눸[0] : $Eʶ[18] . $E눸[0]; $Cу = $E눸[1]; } array_push(self::$maps, $B܏); array_push(self::$routes, $f¢); array_push(self::$methods, strtoupper($C죉)); array_push(self::$callbacks, $Cу); } public static function error($c̶ל) { self::$errorCallback = $c̶ל; } public static function haltOnMatch($D͐Б = true) { self::$halts = $D͐Б; } public static function dispatch() { goto Dņ; Dņ: $b =& $_SERVER[ȦÆ]; $AԊ = parse_url($_SERVER[$b[1363]], PHP_URL_PATH); $dѫՎ = $_SERVER[$b[160]]; goto Aݔ; Aݔ: $e؉ = array_keys(static::$patterns); $f = array_values(static::$patterns); $F÷ = !1; goto DŒ; DŒ: self::$routes = preg_replace($b[1066], $b[18], self::$routes); if (in_array($AԊ, self::$routes)) { $C = array_keys(self::$routes, $AԊ); foreach ($C as $Cʚ) { if (self::$methods[$Cʚ] == $dѫՎ || self::$methods[$Cʚ] == $b[1364] || in_array($dѫՎ, self::$maps[$Cʚ])) { $F÷ = !0; if (!is_object(self::$callbacks[$Cʚ])) { $F˒̳ͮ = explode($b[18], self::$callbacks[$Cʚ]); $B﵊ = end($F˒̳ͮ); $e = explode($b[1365], $B﵊); $C = new $e[0](); $C->{$e[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Cʚ]); if (self::$halts) { return; } } } } } else { $F = 0; foreach (self::$routes as $Cʚ) { if (strpos($Cʚ, $b[4]) !== !1) { $Cʚ = str_replace($e؉, $f, $Cʚ); } if (preg_match($b[1366] . $Cʚ . $b[1367], $AԊ, $e穓)) { if (self::$methods[$F] == $dѫՎ || self::$methods[$F] == $b[1364] || !empty(self::$maps[$F]) && in_array($dѫՎ, self::$maps[$F])) { $F÷ = !0; array_shift($e穓); if (!is_object(self::$callbacks[$F])) { $F˒̳ͮ = explode($b[18], self::$callbacks[$F]); $B﵊ = end($F˒̳ͮ); $e = explode($b[1365], $B﵊); $C = new $e[0](); if (!method_exists($C, $e[1])) { echo $b[1368]; } else { call_user_func_array(array($C, $e[1]), $e穓); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$F], $e穓); if (self::$halts) { return; } } } } $F++; } } if ($F÷ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $C =& $_SERVER[ȦÆ]; header($_SERVER[$C[1369]] . $C[1370]); echo $C[1371]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$b[1363]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto D; D: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto Fؒߒ; c ɦ: $fɻű = $GLOBALS[$A˻[16]][$A˻[342]]; self::$sessionTime = $fɻű[$A˻[1372]]; $C槍 = SESSION_ID; goto C; C: $C槍 = _get($GLOBALS, $A˻[1373], $C槍); if (self::$sessionSign) { } else { if (Cookie::get($C槍)) { self::$sessionSign = Cookie::get($C槍); } else { self::$sessionSign = guid(); } } Cookie::setSafe($C槍, self::$sessionSign, self::$sessionTime); goto E; BݹΗ: switch ($A؟) { case $A˻[27]: self::$handle = Model($A˻[756]); break; case $A˻[757]: self::$handle = new CacheRedis($AƟ, $b); break; case $A˻[758]: self::$handle = new CacheMemcached($AƟ, $b); break; case $A˻[173]: $AƟ[$A˻[85]] = $AƟ[$A˻[85]] . $A˻[1375]; self::$handle = new CacheFile($AƟ, $b); default: break; } if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $bш = new self(); goto F; E: $A؟ = $fɻű[$A˻[1374]]; $AƟ = $fɻű[$A؟]; $b = $fɻű[$A˻[755]]; goto BݹΗ; F: return $bш; goto EｭË; Fؒߒ: $A˻ =& $_SERVER[ȦÆ]; static $bш = false; if ($bш) { return $bш; } goto c ɦ; EｭË: } public static function sign($f = false) { $f && (self::$sessionSign = $f); self::init(); return self::$sessionSign; } public static function set($dӿ, $d = false) { self::init(); if (is_array($dӿ)) { foreach ($dӿ as $Bǅ => $Bэ) { array_set_value(self::$data, $Bǅ, $Bэ); } } else { array_set_value(self::$data, $dӿ, $d); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($d歇ċ = false) { self::init(); if (!$d歇ċ) { return self::$data; } return array_get_value(self::$data, $d歇ċ); } public static function remove($Bûۇ) { self::init(); unset(self::$data[$Bûۇ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ȦÆ][760])) { self::$handle->clearTimeout(); } } } goto Dº; C: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $bʮ =& $_SERVER[ȦÆ]; $this->objectDriver = array($bʮ[67], $bʮ[68], $bʮ[69], $bʮ[70], $bʮ[71], $bʮ[72], $bʮ[73], $bʮ[74]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($B) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($B, $_SERVER[ȦÆ][18]); } return $B; } public function getPathName($Eۍ) { return $Eۍ; } public function iconvApp($d񣴢) { return $d񣴢; } public function iconvSystem($Aڰ) { return $Aڰ; } public function iconvTo($fາ, $Aʓ, $E) { goto F厔Ĝ; F˔: $f = $Aʓ . $c肝ݺ[76] . $E . $c肝ݺ[77] . $fາ; if (isset($eʂ[$f])) { return $eʂ[$f]; } if (function_exists($c肝ݺ[78])) { $A駟ޮ = @mb_convert_encoding($fາ, $E, $Aʓ); } else { $A駟ޮ = @iconv($Aʓ, $E, $fາ); } goto cʩ; cʩ: $A駟ޮ = $A駟ޮ ? $A駟ޮ : $fາ; if (strstr($A駟ޮ, $c肝ݺ[79])) { $A駟ޮ = str_replace($c肝ݺ[79], $c肝ݺ[80], $A駟ޮ); } $eʂ[$Aʓ . $c肝ݺ[76] . $E . $c肝ݺ[77] . $fາ] = $A駟ޮ; goto aͿ; aͿ: $eʂ[$E . $c肝ݺ[76] . $Aʓ . $c肝ݺ[77] . $fາ] = $fາ; $eʂ[$E . $c肝ݺ[76] . $Aʓ . $c肝ݺ[77] . $A駟ޮ] = $fາ; $eʂ[$Aʓ . $c肝ݺ[76] . $E . $c肝ݺ[77] . $A駟ޮ] = $A駟ޮ; goto Eܜ΂; Eܜ΂: return $A駟ޮ; goto Fך; F厔Ĝ: $c肝ݺ =& $_SERVER[ȦÆ]; if (!$fາ || !function_exists($c肝ݺ[75])) { return $fາ; } static $eʂ = array(); goto F˔; Fך: } public function getPathInner($bŨЗ) { $eć = IO::init($bŨЗ); return $eć->path; } public function getPathOuter($Bߐ) { $DѦ =& $_SERVER[ȦÆ]; $Bʼ = strlen(trim($this->pathBase, $DѦ[18])); $Bߐ = substr(trim($Bߐ, $DѦ[18]), $Bʼ); return $this->pathDriver . $DѦ[18] . ltrim($Bߐ, $DѦ[18]); } public function isParentOf($c, $C) { $F¤п =& $_SERVER[ȦÆ]; $c = rtrim(strtolower($c), $F¤п[18]) . $F¤п[18]; $C = rtrim(strtolower($C), $F¤п[18]) . $F¤п[18]; $a = strpos($C, $c) === 0; return $a; } public function getType() { $bْ =& $_SERVER[ȦÆ]; $dک = str_replace($bْ[81], $bْ[43], get_class($this)); return strtolower($dک); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($cᶉ, $b؄) { $d =& $_SERVER[ȦÆ]; $C֐ = rtrim($cᶉ, $d[18]) . $d[18] . $b؄; $fߟӺ = $this->exist($C֐); return $fߟӺ ? $C֐ : !1; } public function renameObject($Dر, $aʎ) { goto Fð; Fð: $bА =& $_SERVER[ȦÆ]; $D = $aʎ; Hook::trigger($bА[82], $this, $Dر, $this, $this->pathFather($Dر) . $aʎ); goto fښ鱬; fښ鱬: $Dر = $this->getPathOuter($Dر); $aʎ = $this->pathFather($Dر) . $aʎ; if (IO::isFile($Dر)) { $Eփʓ = IO::copy($Dر, $this->pathFather($Dر), REPEAT_RENAME_FOLDER, $D); if ($Eփʓ) { IO::remove($Dر); } } else { $Eփʓ = IO::mkdir($aʎ); if (!$Eփʓ) { return !1; } $A鿞ķ = IO::listPath($Dر, !0); $f = array_merge($A鿞ķ[$bА[83]], $A鿞ķ[$bА[84]]); foreach ($f as $F鋺) { IO::move($F鋺[$bА[85]], $aʎ, REPEAT_RENAME_FOLDER); } IO::remove($Dر); } goto bЍ; bЍ: return $Eփʓ ? $aʎ : !1; goto a; a: } public function tempFile($F飂 = '', $eݔ = '') { goto E٭; E٭: if (!$F飂) { $F飂 = rand_string(15); } $d = TEMP_FILES . rand_string(15) . $_SERVER[ȦÆ][18]; @mkdir($d, 511, !0); goto Fś; Fś: $DӇٓ = $d . $F飂; @touch($DӇٓ); if ($eݔ) { file_put_contents($DӇٓ, $eݔ); } goto E갊; E갊: return $DӇٓ; goto d㗛; d㗛: } public function tempFileRemve($eʊՇ) { @unlink($eʊՇ); @rmdir($this->pathFather($eʊՇ)); } public function mkfile($cթ, $f = '', $bȃߡ = REPEAT_RENAME) { } public function mkdir($aέ, $bק = REPEAT_SKIP) { } public function copyFile($dɠҞ, $d賹) { } public function moveFile($bٌ, $FѨӑ) { } public function remove($D) { if ($this->isFile($D)) { return $this->delFile($D); } return $this->delFolder($D); } public function rename($A, $d) { } public function exist($d) { } public function findByHash($e = '', $A˥ӄ = '') { return !1; } public function isFile($c) { } public function isFolder($å) { } public function size($c܅) { } public function info($d،όѹ) { } public function infoSimple($DՂ) { return $this->info($DՂ); } public function infoAuth($A֥) { return $this->info($A֥); } public function infoFull($Dˡ) { return $this->info($Dˡ); } public function infoWithChildren($d˻) { $f =& $_SERVER[ȦÆ]; $C = $this->info($d˻); if ($C && $C[$f[39]] == $f[86]) { $F͇ŗ = array($f[87] => 0, $f[88] => 0, $f[89] => 0); $this->infoChildren($d˻, $F͇ŗ); $C[$f[87]] = $F͇ŗ[$f[87]]; $C[$f[90]] = array($f[91] => $F͇ŗ[$f[88]], $f[92] => $F͇ŗ[$f[89]]); } return $C; } public function listPath($Cť, $f뢘 = false) { } public function has($cۃُ, $DӖ = false, $Eʏ = false) { } public function canRead($c߅) { } public function canWrite($Dㄤ) { } public function getContent($eі) { } public function setContent($d֎, $DꙔײ = '') { } protected function infoChildren($C, &$F) { $B =& $_SERVER[ȦÆ]; check_abort(); $Cʑ = $this->listPath($C, !0); $Cʑ = array_merge($Cʑ[$B[84]], $Cʑ[$B[83]]); foreach ($Cʑ as $f) { if ($f[$B[39]] == $B[86]) { $F[$B[89]]++; $D僟 = $this->getPathInner($f[$B[85]]); $this->infoChildren($D僟, $F); } else { $F[$B[88]]++; $F[$B[87]] += $f[$B[87]]; } } } public function fileSubstr($aĊ, $a˶, $fբ) { } public function listAll($dں) { } public function upload($FԶ, $C毆, $d͊麮 = false, $B̘ = REPEAT_REPLACE) { } public function uploadFileByID($A, $D, $E) { } public function uploadFileByPath($aѥ驒, $F, $F޾΄ = array()) { } public function isUploadServer() { $F =& $_SERVER[ȦÆ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $F[93]) { return !0; } return $GLOBALS[$F[16]][$F[94]][$F[95]]; } public function isFileOutServer() { $aӣ =& $_SERVER[ȦÆ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $aӣ[93]) { return !0; } return $GLOBALS[$aӣ[16]][$aӣ[94]][$aӣ[96]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($C) { $aą =& $_SERVER[ȦÆ]; if (!$this->isCdnHost()) { return $C; } return str_replace(trim(get_url_root($C), $aą[18]), trim($this->cdnHost, $aą[18]), $C); } public function uploadLink($F, $E = 0) { goto dڠ; bǋ: if ($D㑐) { $D㑐[$bɂҢ[99]] = $F; $D㑐[$bɂҢ[100]] = $Eˊ; } return $D㑐; goto f; FȂ: $C僷ɰ = $E <= $e쎑 ? $bɂҢ[97] : $bɂҢ[98]; $FêҬ = (!$E ? 1 : ceil($E / pow(1024, 3))) * 3600 * 4; $D㑐 = $this->{$C僷ɰ}($F, $FêҬ); goto bǋ; dڠ: $bɂҢ =& $_SERVER[ȦÆ]; if ($this->isUploadServer()) { return; } $Eˊ = $this->getType(); goto ä; ä: if (!in_array($Eˊ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $e쎑 = 1024 * 1024 * 10; goto FȂ; f: } public function uploadFormData($E㫖, $aԃ = 3600) { } public function multiUploadFormData($f, $b = 3600) { } public function download($d, $Dӓ) { } public function ext($Aۜ) { $B =& $_SERVER[ȦÆ]; if (strpos($Aۜ, $B[18]) === -1) { $f𲑥 = $Aۜ; } else { $f𲑥 = $this->pathThis($Aۜ); } $a˯ = $B[43]; if (strstr($f𲑥, $B[101])) { $a˯ = substr($f𲑥, strrpos($f𲑥, $B[101]) + 1); $a˯ = strtolower($a˯); } if (strlen($a˯) > 3 && preg_match($B[102], $a˯, $f񡴢)) { $a˯ = $B[43]; } return $a˯; } public function pathThis($B) { $C딗 =& $_SERVER[ȦÆ]; $B = str_replace($C딗[103], $C딗[18], rtrim($B, $C딗[18])); $d⃄ = strrpos($B, $C딗[18]); if ($d⃄ === !1) { return $B; } return substr($B, $d⃄ + 1); } public function pathFather($b) { $DƆӞ =& $_SERVER[ȦÆ]; $b = str_replace($DƆӞ[103], $DƆӞ[18], rtrim($b, $DƆӞ[18])); $eŏ = strrpos($b, $DƆӞ[18]); if ($eŏ === !1) { return $DƆӞ[43]; } return substr($b, 0, $eŏ + 1); } public function hashSimple($b) { goto F׊ѥ; F׊ѥ: $a汆 =& $_SERVER[ȦÆ]; if (!$b) { return md5($a汆[43]); } $D = $this->size($b); goto c; c: $B = 200; $eۂ = 50; if ($D <= $B * $eۂ) { return $this->hashMd5($b) . $D; } goto C; C: $BԤ = intval($D / $eۂ); $F걬 = $a汆[43]; for ($Eܜʷ = 0; $Eܜʷ < $eۂ; $Eܜʷ++) { $F걬 .= $this->fileSubstr($b, $BԤ * $Eܜʷ, $B); } goto Bߍ݈; Bߍ݈: $F걬 .= $this->fileSubstr($b, $D - $B, $B); return md5($F걬) . $D; goto dԆ; dԆ: } public static $md5Cache = array(); public function hashMd5($fْ) { $fْ = $this->iconvSystem($fْ); if (isset(self::$md5Cache[$fْ])) { return self::$md5Cache[$fْ]; } self::$md5Cache[$fْ] = $this->hashMd5Shell($fْ); if (!self::$md5Cache[$fْ]) { self::$md5Cache[$fْ] = @md5_file($fْ); } return self::$md5Cache[$fْ]; } private function hashMd5Shell($Aۦ) { goto A; C؏ݾ: $e򔐺 = shell_exec($E։ݦ . "\40\42{$Aۦ}\x22"); return substr($e򔐺, 0, 32); goto e; eͮõ: $E։ݦ = Cache::get($b[107]); if (!$E։ݦ) { $D˶Ƌ = BASIC_PATH . $b[108]; $dܲ = md5_file($D˶Ƌ); $E։ݦ = $b[109]; foreach ($Eࣵ as $Fڈ) { $e򔐺 = shell_exec($Fڈ . "\x20\42{$D˶Ƌ}\x22"); if ($e򔐺 && substr(trim($e򔐺), 0, 32) == $dܲ) { $E։ݦ = $Fڈ; break; } } Cache::set($b[107], $E։ݦ, 3600); } if ($E։ݦ == $b[109]) { return !1; } goto C؏ݾ; A: $b =& $_SERVER[ȦÆ]; if (!function_exists($b[104])) { return !1; } $Eࣵ = array($b[105], $b[106]); goto eͮõ; e: } public function link($b茄) { return $b茄; } public function fileOut($B, $c = false, $e = false, $c仺 = '') { goto A˄; E䱅: if (in_array($DǸ, array($dˬ֙[117], $dˬ֙[118], $dˬ֙[119], $dˬ֙[120]))) { $DǸ = $dˬ֙[121]; } if (!$c仺) { $c仺 = md5($b׋ . $this->hashSimple($B)); } $c仺 = $dˬ֙[122] . $c仺 . $dˬ֙[122]; goto F닣; C鲞: header($dˬ֙[141] . $b׋ . $dˬ֙[133]); header($dˬ֙[142] . $C); header($dˬ֙[143]); goto fľ; DĆ: header($dˬ֙[134]); header($dˬ֙[135]); header($dˬ֙[136]); goto a; fľ: header($dˬ֙[144] . $d̈́); header($dˬ֙[145]); if (!$c && $DǸ == $dˬ֙[146]) { if ($d̈́ > 1024 * 1024 * 5) { die; } $A٪ = $this->getContent($B); $A٪ = Html::clearSVG($A٪); echo $A٪; die; } goto A􋾷Ђ; A􋾷Ђ: $A螦 = strtolower($_SERVER[$dˬ֙[147]]); if ($E҂ && $A螦 && $aǛ) { if (strstr($A螦, $dˬ֙[148])) { header($dˬ֙[149] . $B); } else { if (strstr($A螦, $dˬ֙[150])) { header($dˬ֙[151] . $B); } else { if (strstr($A螦, $dˬ֙[152])) { header($dˬ֙[153] . $B); } } } if ($DЈ) { header($dˬ֙[154] . $DЈ); } return; } if (isset($_SERVER[$dˬ֙[155]])) { if (preg_match($dˬ֙[156], $_SERVER[$dˬ֙[155]], $C녪؂)) { $d󋨝 = intval($C녪؂[1]); if (!empty($C녪؂[2])) { $E׳ = intval($C녪؂[2]); } } header($dˬ֙[157]); header("\103\157\156\164\145\156\164\x2d\122\141\x6e\x67\x65\x3a\40\142\171\164\x65\x73\40{$d󋨝}\x2d{$E׳}\x2f" . $d̈́); } else { header($dˬ֙[158]); } goto d; A˄: $dˬ֙ =& $_SERVER[ȦÆ]; $this->cacheMethod(null, null); if (!$B || !$this->exist($B)) { show_json(LNG($dˬ֙[110]), !1, $e); } goto a٬; a٬: $E҂ = $this->getType() == $dˬ֙[111]; $aǛ = $GLOBALS[$dˬ֙[16]][$dˬ֙[94]][$dˬ֙[112]][$dˬ֙[113]]; $DЈ = (double) $GLOBALS[$dˬ֙[16]][$dˬ֙[94]][$dˬ֙[112]][$dˬ֙[114]] * 1024 * 1024; goto e܅; e܅: @ob_end_clean(); set_timeout(); $C = $this->infoFull($B); goto aМܷ; aŐ: $aܗź = 0; if ($DЈ) { $aܗź = intval(1000 * 1000 * ($cѮ / $DЈ)); } while ($d󋨝 <= $E׳) { $Eֻԗ = timeFloat(); check_abort(); $A = $E׳ - $d󋨝 + 1; if ($A <= $cѮ) { $cѮ = $A; } echo $this->fileSubstr($B, $d󋨝, $cѮ); $d󋨝 += $cѮ; if ($cѮ == $A) { $d󋨝 = $E׳ + 1; } if ($aܗź) { $bȈ = intval(1000 * 1000 * (timeFloat() - $Eֻԗ)); $bգ = $aܗź - $bȈ; if ($bգ > 5) { usleep($bգ); } } } goto a蠨; b: header($dˬ֙[130]); header($dˬ֙[131] . $Cц); header($dˬ֙[132] . gmdate($dˬ֙[115], time() + 3600 * 24 * 30) . $dˬ֙[133]); goto DĆ; a: if (isset($_SERVER[$dˬ֙[137]]) && strtotime($_SERVER[$dˬ֙[137]]) == $C[$dˬ֙[116]]) { header($dˬ֙[138], !0, 304); die; } if (isset($_SERVER[$dˬ֙[139]]) && $_SERVER[$dˬ֙[139]] == $c仺) { header($dˬ֙[140] . $c仺, !0, 304); die; } header($dˬ֙[140] . $c仺); goto C鲞; F닣: $Cц = get_file_mime($DǸ); if (strstr($Cц, $dˬ֙[123])) { $Cц = $Cц . $dˬ֙[124]; } if ($c === !1 && !mime_support($Cц)) { $c = !0; $Cц = $dˬ֙[125]; } goto D܆; Fݮ: $d󋨝 = 0; $E׳ = $d̈́ - 1; $DǸ = $this->ext($C); goto E䱅; D܆: $cі = rawurlencode($C); $cі = $dˬ֙[122] . $cі . $dˬ֙[126] . $cі; if ($c) { header($dˬ֙[127]); header($dˬ֙[128] . $cі); } else { header($dˬ֙[129] . $cі); } goto b; d: header($dˬ֙[159] . ($E׳ - $d󋨝 + 1)); if ($_SERVER[$dˬ֙[160]] == $dˬ֙[161]) { return; } $cѮ = 1024 * 100; goto aŐ; aМܷ: $d̈́ = $C[$dˬ֙[87]]; $b׋ = gmdate($dˬ֙[115], $C[$dˬ֙[116]]); $C = $e ? $e : $this->iconvApp($C[$dˬ֙[38]]); goto Fݮ; a蠨: } public function fileOutServer($cЫȟ, $c = false, $c = false, $dԭ = '') { $this->fileOut($cЫȟ, $c, $c, $dԭ); } public function fileOutLink($Fׯ) { header($_SERVER[ȦÆ][162] . $Fׯ); die; } public function cacheMethod($F݆̗, $a) { goto cѫ; dј: if (is_null($F݆̗)) { $Aب = array(); return; } if (is_null($a)) { unset($Aب[$Ĉ]); return; } $DŚ = isset($Aب[$Ĉ]) ? $Aب[$Ĉ] : null; goto a堉; a堉: if (!is_null($DŚ)) { return $DŚ; } $DŚ = $this->{$F݆̗}($a); $Aب[$Ĉ] = $DŚ; goto C; C: return $DŚ; goto F; cѫ: $cȽ =& $_SERVER[ȦÆ]; static $Aب = array(); $Ĉ = $cȽ[163] . $F݆̗ . $cȽ[164] . rtrim($a, $cȽ[18]); goto dј; F: } public function fileOutImage($b, $D = 250) { goto d; Aь: if (!($c = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $DҐ쿆[171]))) { $fʨ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $DҐ쿆[172]); } else { $fʨ = KodIO::make($c); } if ($c = IO::fileNameExist($fʨ, $dߚ)) { $F = KodIO::make($c); return IO::fileOut($F); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto Aȹ; Bћ: if ($cڻ[$DҐ쿆[87]] <= 1024 * 50 || !function_exists($DҐ쿆[165]) || $cڻ[$DҐ쿆[166]] == $DҐ쿆[167]) { return $this->fileOut($b); } if (isset($cڻ[$DҐ쿆[168]][$DҐ쿆[169]])) { $e = $cڻ[$DҐ쿆[168]][$DҐ쿆[169]]; } else { if (isset($cڻ[$DҐ쿆[168]][$DҐ쿆[170]])) { $e = $cڻ[$DҐ쿆[168]][$DҐ쿆[170]]; } else { $e = md5("{$cڻ[$DҐ쿆[38]]}\x5f{$cڻ[$DҐ쿆[85]]}\x5f{$cڻ[$DҐ쿆[87]]}"); } } $dߚ = "{$e}\x5f{$D}\x2e\x70\156\x67"; goto Aь; d: $DҐ쿆 =& $_SERVER[ȦÆ]; if (substr($b, 0, 4) == $DҐ쿆[152]) { $this->fileOutLink($b); } $cڻ = $this->info($b); goto Bћ; Aȹ: $F = DATA_THUMB . $dߚ; if (!@file_exists($F)) { $A뼊Е = TEMP_FILES; if (!is_dir($A뼊Е)) { mk_dir($A뼊Е); } $cقɦϿ = $A뼊Е . $e . $DҐ쿆[101] . $cڻ[$DҐ쿆[166]]; if (!@file_exists($cقɦϿ)) { $cقɦϿ = $this->download($b, $cقɦϿ); } $Fєݍ = new ImageThumb($cقɦϿ, $DҐ쿆[173]); $Fєݍ->prorate($F, $D, $D * 10); } if (!file_exists($F) || filesize($F) < 100) { return @file_exists($cقɦϿ) ? IO::fileOut($cقɦϿ) : $this->fileOut($b); } goto Dދ; Dދ: if (!($aα = IO::move($F, $fʨ))) { return IO::fileOut($F); } del_file($F); IO::fileOut($aα); goto Bߎ; Bߎ: } public function fileOutImageServer($A, $cӈ۠ = 250) { $this->fileOutImage($A, $cӈ۠); } public function fileNameAuto($e, $E, $a̯ = REPEAT_RENAME, $D = false) { goto a; Aʳ: $d = 1; $d϶˗ = substr($E, 0, strlen($E) - strlen($F)); $D҃䵥 = $d϶˗ . "\50{$d}\51{$F}"; goto fՍ; e: if ($a̯ == REPEAT_SKIP) { return !1; } $F = $dͥƋ[101] . get_path_ext($E); $F = $F == $dͥƋ[101] || $D ? $dͥƋ[43] : $F; goto Aʳ; fՍ: while ($this->exist(rtrim($e, $dͥƋ[18]) . $dͥƋ[18] . $D҃䵥)) { $D҃䵥 = $d϶˗ . "\50{$d}\x29{$F}"; $d++; } return $D҃䵥; goto Bؾ; a: $dͥƋ =& $_SERVER[ȦÆ]; $a煼 = $e === $dͥƋ[43] ? $E : rtrim($e, $dͥƋ[18]) . $dͥƋ[18] . $E; if ($a̯ == REPEAT_REPLACE || !$this->exist($a煼) || $D && $a̯ != REPEAT_RENAME_FOLDER) { return $E; } goto e; Bؾ: } public function listAllFiles($c箌, $C̊, $f = array()) { goto aǅ; f٤: foreach (array_unique($BÕ) as $cؑ) { $c߫ = array($A쎩[85] => $this->getPathOuter($A쎩[18] . $c箌 . $A쎩[18] . $cؑ), $A쎩[86] => 1, $A쎩[87] => 0); if (substr($cؑ, -1) != $A쎩[18]) { $c߫[$A쎩[86]] = 0; $aߚ = $this->getPath($c箌 . $A쎩[18] . $cؑ); $c߫[$A쎩[87]] = isset($f[$aߚ]) ? $f[$aߚ] : $this->size($aߚ); } $fѯ[] = $c߫; } return $fѯ; goto Dׇێي; B睅: $c箌 = trim($c箌, $A쎩[18]); foreach ($C̊ as $cؑ) { $aȾ = ltrim(substr($cؑ, strlen($c箌)), $A쎩[18]); $BÕ = array_merge($BÕ, $this->slicePath($aȾ)); } $fѯ = array(); goto f٤; aǅ: $A쎩 =& $_SERVER[ȦÆ]; if (empty($C̊)) { return array(); } $BÕ = array(); goto B睅; Dׇێي: } public function slicePath($ḏϫ) { $cɺˢ =& $_SERVER[ȦÆ]; $fĞ = explode($cɺˢ[18], trim($ḏϫ, $cɺˢ[18])); $Bߧ = 0; do { ++$Bߧ; $Dלא[] = implode($cɺˢ[18], array_slice($fĞ, 0, $Bߧ)) . $cɺˢ[18]; } while ($Bߧ < count($fĞ)); $Dלא[count($fĞ) - 1] = $ḏϫ; return $Dלא; } public function getHost() { $C =& $_SERVER[ȦÆ]; $DɆш = parse_url(trim($this->domain, $C[18])); $bҼ = isset($DɆш[$C[174]]) ? $DɆш[$C[174]] : http_type(); $e = isset($DɆш[$C[175]]) ? $DɆш[$C[175]] : $DɆш[$C[85]]; if (isset($DɆш[$C[176]])) { $e .= $C[4] . $DɆш[$C[176]]; } return $bҼ . $C[177] . $e; } public function pathEncode($d汅ϋ) { $dڏ =& $_SERVER[ȦÆ]; return str_replace($dڏ[178], $dڏ[18], rawurlencode($d汅ϋ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($e) { set_timeout(); require_once SDK_DIR . $_SERVER[ȦÆ][179]; parent::__construct(); $this->_init($e); } public function _init($cЉ) { foreach ($cЉ as $C => $B) { if (isset($this->{$C})) { $this->{$C} = $B; } } $this->endpoint = $cЉ[$_SERVER[ȦÆ][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($E = "\x76\64") { $this->signVer = $E; $this->client->setSignatureVersion($E); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto cݿ; D׶: $e = array($a[186], $a[187], $a[188], $a[189], $a[190]); $c枫 = array_diff($e, $c); return empty($c枫); goto Bβ; F֠ޢ: if ($c֯[$a[181]] != $a[182] || $c֯[$a[183]] != $a[182]) { return !1; } $c = array_map($a[184], $c֯[$a[185]]); if (!is_array($c)) { $c = array(); } goto D׶; cݿ: $a =& $_SERVER[ȦÆ]; $c֯ = $this->getBucketCors(); if (!$c֯ || !is_array($c֯)) { return !1; } goto F֠ޢ; Bβ: } public function mkfile($Eőژ, $d = '', $F⺽ = REPEAT_RENAME) { $cІ = $this->setContent($Eőژ, $d); if ($cІ !== !1) { return $this->getPathOuter($Eőژ); } return !1; } public function mkdir($Cك, $A = REPEAT_SKIP) { if (empty($Cك)) { return !1; } if ($this->_isFolder($Cك)) { return $this->getPathOuter($Cك); } $d툓 = $this->setContent($Cك, $_SERVER[ȦÆ][43], !0); if ($d툓 !== !1) { return $this->getPathOuter($Cك); } return !1; } public function copyFile($c, $E, $c = array()) { $A =& $_SERVER[ȦÆ]; $Bǻ = $this->objectMeta($c); if (!$Bǻ) { return !1; } if ($Bǻ[$A[87]] <= 1024 * 1024 * 200) { $aܤ = $this->client->copyObject($this->bucket, $c, $this->bucket, $E, $A[191], $c); } else { $aܤ = $this->client->multiCopyObject($this->bucket, $c, $this->bucket, $E, $c); } $aܤ = $aܤ ? $this->getPathOuter($E) : !1; return $aܤ; } public function moveFile($eܟ, $a) { if ($this->copyFile($eܟ, $a)) { $this->delFile($eܟ); return $this->getPathOuter($a); } return !1; } public function delFile($fІ) { return $this->client->deleteObject($this->bucket, $fІ); } public function delFolder($a煽) { goto a; b؛: return $CȞ === $f݊ ? !0 : !1; goto D͚; a쓯: $CȞ = $f݊ = 0; $eܛ = array_chunk(array_keys($e), 1000); foreach ($eܛ as $CÎ) { $CȞ++; $f݊ += (int) $this->client->deleteObjects($this->bucket, $CÎ); } goto b؛; a: $Eꅟ =& $_SERVER[ȦÆ]; $e = $this->listObjs($a煽); if (!$e) { $a煽 = trim($a煽, $Eꅟ[18]); if (!empty($a煽)) { $a煽 .= $Eꅟ[18]; } return $this->delFile($a煽); } goto a쓯; D͚: } public function rename($C֠, $c) { return $this->renameObject($C֠, $c); } public function listPath($e, $F͜ = false) { $Fӈڥ =& $_SERVER[ȦÆ]; $aъ = $this->listObjs($e, null, null, $Fӈڥ[18]); $aӍ = array($Fӈڥ[84] => array(), $Fӈڥ[83] => array()); foreach ($aъ as $Bׄ => $D) { if ($Bׄ == $Fӈڥ[18]) { continue; } if (isset($D[$Fӈڥ[192]])) { $aӍ[$Fӈڥ[84]][] = $this->folderInfo($D[$Fӈڥ[192]], $F͜); } else { if (substr($D[$Fӈڥ[38]], -1) == $Fӈڥ[18]) { continue; } $aӍ[$Fӈڥ[83]][] = $this->fileInfo($D[$Fӈڥ[38]], $F͜, $D); } } return $aӍ; } private function fileInfo($e©, $F = false, $D = array()) { goto F޻; F޻: $f͑˘ =& $_SERVER[ȦÆ]; if ($F) { return array($f͑˘[38] => $this->pathThis($e©), $f͑˘[85] => $this->getPathOuter($e©), $f͑˘[39] => $f͑˘[173], $f͑˘[166] => $this->ext($e©), $f͑˘[87] => isset($D[$f͑˘[87]]) ? $D[$f͑˘[87]] : 0, $f͑˘[193] => 0, $f͑˘[116] => 0, $f͑˘[194] => !0, $f͑˘[195] => !0); } $a = array($f͑˘[38] => $this->pathThis($e©), $f͑˘[85] => $this->getPathOuter($e©), $f͑˘[39] => $f͑˘[173], $f͑˘[193] => 0, $f͑˘[116] => 0, $f͑˘[87] => 0, $f͑˘[166] => $this->ext($e©), $f͑˘[194] => !0, $f͑˘[195] => !0); goto D; Fь: return $a; goto a; D: if (empty($D)) { $D = $this->objectMeta($e©); if (!$D) { return $a; } } if (isset($D[$f͑˘[196]])) { $a[$f͑˘[116]] = $D[$f͑˘[196]]; } if (isset($D[$f͑˘[87]])) { $a[$f͑˘[87]] = $D[$f͑˘[87]]; } goto Fь; a: } private function folderInfo($bىñ, $f񴎋 = false) { goto Bǿ; Dе: if ($bىñ == $Aۛ[43]) { return $EŨϾ; } $bىñ = trim($bىñ, $Aۛ[18]) . $Aۛ[18]; $e = $this->objectMeta($bىñ); goto C; C: if (isset($e[$Aۛ[196]])) { $EŨϾ[$Aۛ[193]] = $e[$Aۛ[196]]; } return $EŨϾ; goto d諲; Bǿ: $Aۛ =& $_SERVER[ȦÆ]; if ($f񴎋) { return array($Aۛ[38] => $this->pathThis($bىñ), $Aۛ[85] => $this->getPathOuter($Aۛ[18] . $bىñ), $Aۛ[39] => $Aۛ[86], $Aۛ[194] => !0, $Aۛ[195] => !0); } $EŨϾ = array($Aۛ[38] => $this->pathThis($bىñ), $Aۛ[85] => $this->getPathOuter($Aۛ[18] . $bىñ), $Aۛ[39] => $Aۛ[86], $Aۛ[193] => 0, $Aۛ[116] => 0, $Aۛ[194] => !0, $Aۛ[195] => !0); goto Dе; d諲: } public function listObjs($E, $bŦ = null, $fێ = null, $D袣 = null) { $Eߚ =& $_SERVER[ȦÆ]; $E = trim($E, $Eߚ[18]); $BۢŤ = empty($E) ? $Eߚ[43] : $E . $Eߚ[18]; return $this->client->getBucket($this->bucket, $BۢŤ, $bŦ, $fێ, $D袣, !0); } public function has($aѐ, $dᴷ = false, $Cɇ = true) { goto E; aФ: $a﷉ = $this->listObjs($aѐ, null, null, $dޤ[18]); $a﷉ = is_array($a﷉) ? $a﷉ : array(); foreach ($a﷉ as $C) { if (isset($C[$dޤ[38]]) && substr($C[$dޤ[38]], -1) != $dޤ[18]) { if (!$dᴷ && $Cɇ) { return !0; } $Fӫ߳++; } else { if (isset($C[$dޤ[192]])) { if (!$dᴷ && !$Cɇ) { return !1; } $FÇۄ++; } } } goto AĐ; AĐ: if ($dᴷ) { return array($dޤ[197] => $Fӫ߳, $dޤ[198] => $FÇۄ); } return !1; goto Cь; E: $dޤ =& $_SERVER[ȦÆ]; $Fӫ߳ = 0; $FÇۄ = 0; goto aФ; Cь: } public function listAll($d܂) { $Eͮ =& $_SERVER[ȦÆ]; $fₐԥ = $this->listObjs($d܂); $A媅 = $A = array(); foreach ($fₐԥ as $fገ => $bͣߌ) { $A媅[] = $bͣߌ[$Eͮ[38]]; $A[$fገ] = $bͣߌ[$Eͮ[87]]; } return $this->listAllFiles($d܂, $A媅, $A); } public function canRead($aϟ) { $A≞ =& $_SERVER[ȦÆ]; $fڎ = $this->client->getAccessControlPolicy($this->bucket, $aϟ); if (!$fڎ) { return !1; } return in_array($fڎ, array($A≞[199], $A≞[200], $A≞[201])) ? !0 : !1; } public function canWrite($CϏ) { $b鄊І =& $_SERVER[ȦÆ]; $D͎ = $this->client->getAccessControlPolicy($this->bucket, $CϏ); if (!$D͎) { return !1; } return in_array($D͎, array($b鄊І[199], $b鄊І[200])) ? !0 : !1; } public function getContent($Fڟ٧) { return $this->client->getObject($this->bucket, $Fڟ٧); } public function setContent($c򏒱, $cׄ = '', $F = false) { goto Ačܲ; Ačܲ: $f =& $_SERVER[ȦÆ]; $c򏒱 = $F ? trim($c򏒱, $f[18]) . $f[18] : $c򏒱; $eߞ = get_file_mime(get_path_ext($c򏒱)); goto b; b: $aߣ = $this->client->putObject($cׄ, $this->bucket, $c򏒱, $f[191], array(), $eߞ); if (!$aߣ) { return !1; } if ($F) { return !0; } goto F; F: $aߣ = $this->copyFile($c򏒱, $c򏒱, array($f[202] => $aߣ[$f[203]])); return $aߣ ? !0 : !1; goto b; b: } public function fileSubstr($F, $Cۈ, $A͗) { $aȨ = $Cۈ + $A͗ - 1; return $this->client->getObject($this->bucket, $F, array($_SERVER[ȦÆ][204] => "\142\x79\164\145\x73\75{$Cۈ}\55{$aȨ}")); } public function upload($a, $CӺ, $bΤ = false, $C슔 = REPEAT_REPLACE) { $FӅ =& $_SERVER[ȦÆ]; $dഴ = array($FӅ[202] => @md5_file($CӺ)); $d܅▯ = array($FӅ[205] => get_file_mime(get_path_ext($a))); if (IO::size($CӺ) <= 1024 * 1024 * 200) { $C蘋 = $this->client->putObjectFile($CӺ, $this->bucket, $a, $FӅ[191], $dഴ, $d܅▯); return !empty($C蘋) ? $this->getPathOuter($a) : !1; } $AƷ = $this->client->multiUploadObject($CӺ, $this->bucket, trim($a, $FӅ[18]), $dഴ, $d܅▯); return $AƷ ? $this->getPathOuter($a) : !1; } public function download($fȵ, $c) { if (!@is_dir($this->pathFather($c)) && !IO::mkdir($this->pathFather($c))) { return !1; } $c = $this->client->getObject($this->bucket, $fȵ, array(), $c); return $c !== !1 ? $c : !1; } public function link($fΏ, $Dа = array()) { $DӏȬ =& $_SERVER[ȦÆ]; if ($this->signVer == $DӏȬ[206]) { return $this->client->getAuthenticatedURL($this->bucket, $fΏ, 3600 * 12, $Dа); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($fΏ, $DӏȬ[18]), 3600 * 12, $this->region, array(), !0, $Dа); } public function fileOut($F, $cޓ͈ = false, $bȻ = false, $bǈ݇ = '') { goto E; C: if ($Bә == $Fٹܶ[207]) { return parent::fileOut($F, $cޓ͈, $bȻ, $bǈ݇); } $cޓ͈ = $cޓ͈ ? $Fٹܶ[208] : $Fٹܶ[209]; $bϲ = array($Fٹܶ[210] => $cޓ͈ . $Fٹܶ[211] . rawurlencode($bȻ), $Fٹܶ[212] => $Bә); goto EΆܻ; EΆܻ: $B˺ = $this->link($F, $bϲ); $this->fileOutLink($B˺); goto a۩; E: $Fٹܶ =& $_SERVER[ȦÆ]; if (!$bȻ) { $bȻ = $this->pathThis($F); } $Bә = get_file_mime(get_path_ext($bȻ)); goto C; a۩: } public function fileOutServer($f, $Fڙ = false, $dȹ = false, $BÊ = '') { parent::fileOut($f, $Fڙ, $dȹ, $BÊ); } public function fileOutImage($eר, $F箣 = 250) { $B؇ = $this->link($eר); $this->fileOutLink($B؇); } public function fileOutImageServer($a, $f® = 250) { parent::fileOutImage($a, $f®); } public function hashMd5($fɮ, $D = '') { $B뵕 =& $_SERVER[ȦÆ]; $d = $this->objectMeta($fɮ); if (!$d) { return !1; } $D = $D ? $D : _get($d, $B뵕[213]); $D = $D ? $D : _get($d, $B뵕[203], $B뵕[43]); return $D; } public function uploadFormData($Bӌ, $FΤ = 3600) { $Fƹѱ =& $_SERVER[ȦÆ]; $aߕ = $this->pathFather($Bӌ); $aˠ = $this->client->getHttpUploadPostParams($this->bucket, $aߕ, $Fƹѱ[191], $FΤ); return array_merge((array) $aˠ, array($Fƹѱ[175] => $this->getHost())); } public function multiUploadFormData($D̢Ņ, $d܇氇 = 3600) { $B =& $_SERVER[ȦÆ]; $b䜌 = gmdate($B[214]); $cܒ䂚 = array(); $fŎ = $this->client->getUploadId($this->bucket, $D̢Ņ, $cܒ䂚); if (!$fŎ) { return !1; } return array($B[215] => $fŎ, $B[175] => $this->getHost() . $B[18] . $this->pathEncode($D̢Ņ), $B[216] => $b䜌, $B[99] => $D̢Ņ); } public function multiUploadAuthData($dݰՊ, $fԷ = array()) { goto fͱ; fͱ: $F궋 =& $_SERVER[ȦÆ]; $c흲 = isset($fԷ[$F궋[216]]) ? $fԷ[$F궋[216]] : gmdate($F궋[214]); $BҔ֏ = isset($fԷ[$F궋[166]]) ? $fԷ[$F궋[166]] : $F궋[43]; goto c魍; Bٗ: if (strpos($BҔ֏, $F궋[219]) === 0) { return array($F궋[225] => $cڃ, $F궋[216] => $c흲); } return $cڃ; goto aĻ; c魍: $f鈲䠨 = $fԷ[$F궋[99]]; unset($fԷ[$F궋[99]]); if (isset($fԷ[$F궋[217]])) { $fԷ[$F궋[216]] = $c흲; return $this->listUploadParts($f鈲䠨, $fԷ); } goto bڎ; fÌ: $C⬢¸ = implode($F궋[12], $Fٝ); $f = base64_encode(hash_hmac($F궋[223], $C⬢¸, $this->secret, !0)); $cڃ = $F궋[224] . $this->accessKey . $F궋[4] . $f; goto Bٗ; bڎ: $Fٝ = array($F궋[218], $F궋[43], $F궋[125], $F궋[43], "\x78\x2d\141\x6d\x7a\x2d\x64\x61\164\145\72{$c흲}", $F궋[18] . $this->bucket . $F궋[18] . $this->pathEncode($f鈲䠨) . $BҔ֏); if (strpos($BҔ֏, $F궋[219]) === 0) { $Fٝ[0] = $F궋[220]; } if (isset($fԷ[$F궋[221]]) && $fԷ[$F궋[221]] == $F궋[222]) { $Fٝ[0] = $F궋[222]; } goto fÌ; aĻ: } public function listUploadParts($F쏾, $e׃ = array()) { goto E҉ń; Cݻ߂: if (!$Aݔל) { return !1; } unset($e׃[$Fݓ⟺[217]], $e׃[$Fݓ⟺[221]]); $e׃[$Fݓ⟺[99]] = $F쏾; goto c஼; c஼: $Eř = $this->multiUploadAuthData($F쏾, $e׃); if (empty($Eř)) { return !1; } return array($Fݓ⟺[225] => $Eř, $Fݓ⟺[216] => $e׃[$Fݓ⟺[216]], $Fݓ⟺[227] => $Aݔל); goto aחݠ; E҉ń: $Fݓ⟺ =& $_SERVER[ȦÆ]; $b귙 = str_replace($Fݓ⟺[226], $Fݓ⟺[43], $e׃[$Fݓ⟺[166]]); $Aݔל = $this->client->listParts($this->bucket, $F쏾, $b귙); goto Cݻ߂; aחݠ: } public function getHost() { return parent::getHost() . $_SERVER[ȦÆ][18] . $this->bucket; } public function size($B) { $Cҭ = $this->objectMeta($B); return $Cҭ ? $Cҭ[$_SERVER[ȦÆ][87]] : 0; } public function info($EѪ) { if ($this->isFolder($EѪ)) { return $this->folderInfo($EѪ); } else { if ($this->isFile($EѪ)) { return $this->fileInfo($EѪ); } } return !1; } public function exist($Eÿ̶) { return $this->isFile($Eÿ̶) || $this->isFolder($Eÿ̶); } public function isFile($eܛŗ) { return !$this->isFolder($eܛŗ) && $this->objectMeta($eܛŗ); } public function isFolder($C) { return $this->cacheMethod($_SERVER[ȦÆ][228], $C); } protected function objectMeta($cデ) { return $this->cacheMethod($_SERVER[ȦÆ][229], $cデ); } protected function _objectMeta($f܃) { $D =& $_SERVER[ȦÆ]; $f܃ = rtrim($f܃, $D[18]); try { $F͸ = $this->client->getObjectInfo($this->bucket, $f܃); if (!isset($F͸[$D[213]]) && isset($F͸[$D[230]])) { $F͸[$D[213]] = $F͸[$D[230]]; } } catch (OSS\Core\OssException $D) { $F͸ = !1; } if (!$F͸) { } return $F͸; } protected function _isFolder($D) { goto a҂; A: $dë = $this->client->getBucket($this->bucket, $D, null, 1); if (empty($dë)) { return !1; } $dë = array_values($dë); goto Dݏ; a҂: $DƠ =& $_SERVER[ȦÆ]; $D = rtrim($D, $DƠ[18]); if ($D == $DƠ[43] || $D == $DƠ[18]) { return !0; } goto A; Dݏ: if (substr($dë[0][$DƠ[38]], -1) == $DƠ[18]) { return !0; } if (get_path_this($dë[0][$DƠ[38]]) == get_path_this($D)) { return !1; } return !0; goto D; D: } } define($_SERVER[ȦÆ][231], 1); goto Bנ; Fޅ賷: class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $bԶ =& $_SERVER[ȦÆ]; self::$name = date($bԶ[688]); if (!($e풵 = Model($bԶ[689])->lastItem())) { $e풵 = $this->initData(); } else { self::$name = $e풵[$bԶ[38]]; if ($e풵[$bԶ[690]] == $bԶ[93]) { self::$name = date($bԶ[691]); $aז = 0; if (isset($e풵[$bԶ[286]][$bԶ[173]][$bԶ[424]])) { $aז = (int) $e풵[$bԶ[286]][$bԶ[173]][$bԶ[424]]; } if ($e풵[$bԶ[38]] == self::$name) { Model($bԶ[689])->remove($e풵[$bԶ[372]]); } $e풵 = $this->initData($aז, $e풵[$bԶ[692]]); } else { $this->checkStore($e풵[$bԶ[692]]); } } self::$option = $e풵; } private function initData($D̞ = 0, $A͔ = '') { goto d; aĲ: $FÏ[$fޠ[372]] = $a߰; return $FÏ; goto aޔӈ; F: $this->checkStore($Fۜ[$fޠ[692]]); $FÏ = array($fޠ[692] => $Fۜ[$fޠ[692]], $fޠ[38] => self::$name, $fޠ[690] => 0, $fޠ[693] => $Fۜ[$fޠ[693]], $fޠ[286] => array($fޠ[694] => array($fޠ[690] => 0), $fޠ[695] => array($fޠ[690] => 0, $fޠ[696] => 0, $fޠ[697] => 0, $fޠ[39] => $fޠ[43]), $fޠ[698] => array($fޠ[690] => 0, $fޠ[696] => 0, $fޠ[697] => 0), $fޠ[173] => array($fޠ[690] => 0, $fޠ[699] => 0, $fޠ[700] => 0, $fޠ[701] => 0, $fޠ[702] => 0, $fޠ[424] => $D̞)), $fޠ[703] => time(), $fޠ[704] => 0); $a߰ = Model($fޠ[689])->insert($FÏ); goto aĲ; d: $fޠ =& $_SERVER[ȦÆ]; $Fۜ = Model($fޠ[689])->config(); if ($A͔ && $Fۜ[$fޠ[692]] != $A͔) { $D̞ = 0; } goto F; aޔӈ: } private function checkStore($Cڂ) { $AӘߺ =& $_SERVER[ȦÆ]; $fȐ = Model($AӘߺ[705])->listData($Cڂ); Model($AӘߺ[705])->checkConfig($fȐ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ȦÆ][689])->findByName(self::$name); } return self::$option; } public static function set($b͉ʦ؆) { $E =& $_SERVER[ȦÆ]; $F߉ = self::get(); foreach ($b͉ʦ؆ as $FǏ閘 => $Eφ֜Ő) { $dƴ = explode($E[101], $FǏ閘); $Fԃ = count($dƴ); switch ($Fԃ) { case 1: $F߉[$dƴ[0]] = $Eφ֜Ő; break; case 2: $F߉[$dƴ[0]][$dƴ[1]] = $Eφ֜Ő; break; case 3: $F߉[$dƴ[0]][$dƴ[1]][$dƴ[2]] = $Eφ֜Ő; break; } } Model($E[689])->update($F߉[$E[372]], $F߉); self::$option = $F߉; return self::$option; } public function keep() { $b =& $_SERVER[ȦÆ]; $e⃚ = self::get(); if ($e⃚[$b[286]][$b[694]][$b[690]] == $b[93]) { return; } $this->backupKeep($e⃚); self::set(array($b[706] => 1)); } private function backupKeep($eΝ) { goto A; A: $Cה㿻 =& $_SERVER[ȦÆ]; $E = Model($Cה㿻[689])->listData(); if (empty($E)) { return; } goto b; e¨: for ($d񉐾 = 0; $d񉐾 < 12; $d񉐾++) { $bë[] = date($Cה㿻[707], strtotime("\55{$d񉐾}\x20\x6d\157\156\164\x68\x73")); } $bë = array_unique($bë); foreach ($E as $E¯) { if (!empty($E¯[$Cה㿻[38]]) && in_array($E¯[$Cה㿻[38]], $bë)) { continue; } Model($Cה㿻[689])->remove($E¯[$Cה㿻[372]]); $Dթ = "\173\151\x6f\72{$eΝ[$Cה㿻[692]]}\175\x2f\144\141\164\141\x62\141\x73\x65\x2f\x62\x61\143\153\165\160\x5f{$E¯[$Cה㿻[38]]}"; IO::remove($Dթ, !1); } goto Fͯ; b: $d񉐾 = 0; $bë = array(); foreach ($E as $E¯) { if ($d񉐾 >= 7) { break; } $bë[] = $E¯[$Cה㿻[38]]; $d񉐾++; } goto e¨; Fͯ: } public function db() { goto bꦊ; A: $Aئ = new BackupDb(); if (!$Aئ->index()) { return !1; } self::set(array($eƽ皍[708] => 1)); goto bܑ嗈; bꦊ: $eƽ皍 =& $_SERVER[ȦÆ]; $eѥ = self::get(); if ($eѥ[$eƽ皍[286]][$eƽ皍[695]][$eƽ皍[690]] == $eƽ皍[93]) { return !0; } goto A; bܑ嗈: return !0; goto Fڵ; Fڵ: } public function dbFile() { goto C; C: $D =& $_SERVER[ȦÆ]; $b = self::get(); if ($b[$D[286]][$D[698]][$D[690]] == $D[93]) { return !0; } goto Cī; EԱ: return !0; goto e̴; Cī: $Cٛγ = new BackupDbFile(); if (!$Cٛγ->index()) { return !1; } self::set(array($D[709] => 1)); goto EԱ; e̴: } public function file() { $eʒ =& $_SERVER[ȦÆ]; $Bݔ纙 = self::get(); if ($Bݔ纙[$eʒ[286]][$eʒ[173]][$eʒ[690]] == $eʒ[93]) { return !0; } if (!isset($Bݔ纙[$eʒ[693]]) || $Bݔ纙[$eʒ[693]] == $eʒ[473]) { $f鿃 = new BackupFile(); if (!$f鿃->index()) { return !1; } } self::set(array($eʒ[710] => 1, $eʒ[690] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto F䊅; e: $C->end(); $d̫ = array($Dટ[721] => $eʝ, $Dટ[708] => 1, $Dટ[722] => $b, $Dટ[723] => $b); Backup::set($d̫); goto a; bӧڬ: mk_dir($b䑼); $F𨛽 = $A->db()->getTables(); $b = 0; goto A; F䊅: $Dટ =& $_SERVER[ȦÆ]; $DÌ = Backup::get(); self::$io = $DÌ[$Dટ[692]]; goto cç; a: return !0; goto bސ; cç: self::$name = $DÌ[$Dટ[38]]; $Fڵ = $GLOBALS[$Dટ[16]][$Dટ[27]]; $eʝ = $this->_dbType($Fڵ); goto bڤ; bڤ: $A = new DbManage($Fڵ, $eʝ); $b䑼 = TEMP_FILES . $Dટ[711] . self::$name . $Dટ[18]; del_dir($b䑼); goto bӧڬ; A: $C = new Task($Dટ[712], $Dટ[713], 0, LNG($Dટ[714]) . $Dટ[715] . LNG($Dટ[716])); $F𨛽 = array_diff($F𨛽, array($Dટ[717], $Dટ[718])); foreach ($F𨛽 as $b) { $Dϯ = $b䑼 . $b . $Dટ[719]; $C壜ʪ = null; if ($b == $Dટ[720] && (!isset($DÌ[$Dટ[693]]) || $DÌ[$Dટ[693]] == $Dટ[473])) { $C壜ʪ = self::$io; } $b += $A->sqlFromDb($b, $Dϯ, $C, $C壜ʪ); } goto e; bސ: } private function _dbType($e¸) { goto aݘ; aݘ: $F =& $_SERVER[ȦÆ]; $e¸ = array_change_key_case($e¸); $AҶ = $e¸[$F[724]]; goto dޅ; dޅ: if ($AҶ == $F[725]) { $A = explode($F[4], $e¸[$F[726]]); $AҶ = $A[0]; } $dܓ = array($F[727] => $F[19], $F[728] => $F[729]); if (isset($dܓ[$AҶ])) { $AҶ = $dܓ[$AҶ]; } goto CÇҌ; CÇҌ: return $AҶ; goto A؟; A؟: } } class BackupDbFile { public function __construct() { } public function index() { goto EŞԃ; EŞԃ: $c =& $_SERVER[ȦÆ]; $a嵎 = Backup::get(); $aٳو = $a嵎[$c[38]]; goto Bϐ; Bϐ: $B = TEMP_FILES . "\x62\141\143\x6b\165\160\137{$aٳو}\57"; $A = "\173\x69\157\72{$a嵎[$c[692]]}\x7d\x2f\144\x61\164\141\x62\x61\163\x65\x2f"; IO::mkdir($A . "\142\x61\x63\x6b\165\x70\x5f{$aٳو}\57"); goto b; b: $f = new TaskFileTransfer($c[730], $c[713], 0, LNG($c[714]) . $c[417] . LNG($c[716]) . $c[731]); $f->addPath($B); $b؃ = IO::infoWithChildren($B); goto Bю; Bצϋ: IO::copy($A, $A . "\x62\141\x63\x6b\165\x70\137{$aٳو}\57"); $f->end(); Backup::set(array($c[734] => $b؃[$c[87]])); goto Eď; Eď: return !0; goto c󑚑; Bю: Backup::set(array($c[732] => $b؃[$c[87]])); IO::move($B, $A); $A = CONTROLLER_DIR . $c[733]; goto Bצϋ; c󑚑: } } goto eÃ; Bנ: define($_SERVER[ȦÆ][232], 2); define($_SERVER[ȦÆ][233], 3); define($_SERVER[ȦÆ][234], 1); goto a浇; Fږ: class DbMysql extends Db { public function __construct($A = '') { $c =& $_SERVER[ȦÆ]; if (!extension_loaded($c[729])) { think_exception(think_lang($c[20]) . $c[793]); } if (!empty($A)) { $this->config = $A; if (empty($this->config[$c[23]])) { $this->config[$c[23]] = $c[43]; } } } public function connect($D = '', $aư = 0, $D˦ڢӂ = false) { $dȮ =& $_SERVER[ȦÆ]; if (!isset($this->linkID[$aư])) { goto F; b쭵: if (1 != think_config($dȮ[28])) { unset($this->config); } goto b; f׊ӹ: mysql_query($dȮ[798] . think_config($dȮ[799]) . $dȮ[65], $this->linkID[$aư]); if ($e۷ > $dȮ[800]) { mysql_query($dȮ[801], $this->linkID[$aư]); } $this->connected = !0; goto b쭵; bٿ: if ($C) { $this->linkID[$aư] = mysql_pconnect($aĿȉæ, $D[$dȮ[796]], $D[$dȮ[797]], 131072); } else { $this->linkID[$aư] = mysql_connect($aĿȉæ, $D[$dȮ[796]], $D[$dȮ[797]], !0, 131072); } if (!$this->linkID[$aư] || !empty($D[$dȮ[27]]) && !mysql_select_db($D[$dȮ[27]], $this->linkID[$aư])) { think_exception(mysql_error()); } $e۷ = mysql_get_server_info($this->linkID[$aư]); goto f׊ӹ; F: if (empty($D)) { $D = $this->config; } $aĿȉæ = $D[$dȮ[794]] . ($D[$dȮ[795]] ? "\x3a{$D[$dȮ[795]]}" : $dȮ[43]); $C = !empty($D[$dȮ[23]][$dȮ[24]]) ? $D[$dȮ[23]][$dȮ[24]] : $this->pconnect; goto bٿ; b: } return $this->linkID[$aư]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($A) { goto C; Eڠ: think_action_status($B[29], 1); think_status($B[30]); $this->queryID = mysql_query($A, $this->_linkID); goto f멎; f멎: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto E; C: $B =& $_SERVER[ȦÆ]; if (0 === stripos($A, $B[257])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto a; a: if (!$this->_linkID) { return !1; } $this->queryStr = $A; if ($this->queryID) { $this->free(); } goto Eڠ; E: } public function execute($F雉) { goto D׍; Aې: think_status($Dڐ[30]); $f = mysql_query($F雉, $this->_linkID); $this->debug(); goto dȤ; D׍: $Dڐ =& $_SERVER[ȦÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto f; f: $this->queryStr = $F雉; if ($this->queryID) { $this->free(); } think_action_status($Dڐ[31], 1); goto Aې; dȤ: if (!1 === $f) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto CϚ; CϚ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ȦÆ][802], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $A = mysql_query($_SERVER[ȦÆ][803], $this->_linkID); $this->transTimes = 0; if (!$A) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $B˫ = mysql_query($_SERVER[ȦÆ][804], $this->_linkID); $this->transTimes = 0; if (!$B˫) { $this->error(); return !1; } } return !0; } private function getAll() { $fԋ = array(); if ($this->numRows > 0) { while ($dԏ׃ = mysql_fetch_assoc($this->queryID)) { $fԋ[] = $dԏ׃; } mysql_data_seek($this->queryID, 0); } return $fԋ; } public function getFields($bڢҒ) { $c =& $_SERVER[ȦÆ]; $b = $this->query($c[805] . $this->parseKey($bڢҒ)); $Dҕϑ = array(); if ($b) { foreach ($b as $Fōٻ => $eؙ) { $Dҕϑ[$eؙ[$c[37]]] = array($c[38] => $eؙ[$c[37]], $c[39] => $eؙ[$c[40]], $c[41] => (bool) (strtoupper($eؙ[$c[42]]) === $c[806]), $c[44] => $eؙ[$c[45]], $c[46] => strtolower($eؙ[$c[47]]) == $c[48], $c[49] => strtolower($eؙ[$c[50]]) == $c[51]); } } return $Dҕϑ; } public function getTables($e΃ = '') { $cӌ =& $_SERVER[ȦÆ]; if (!empty($e΃)) { $b▟ = $cӌ[807] . $e΃; } else { $b▟ = $cӌ[808]; } $F = $this->query($b▟); $AߚƉ = array(); foreach ($F as $Eݫ => $c) { $AߚƉ[$Eݫ] = current($c); } return $AߚƉ; } public function replace($aȔؐ, $e̲ = array()) { $AԦ܌ =& $_SERVER[ȦÆ]; foreach ($aȔؐ as $cӶ => $f΋βӄ) { $Eљ = $this->parseValue($f΋βӄ); if (is_scalar($Eљ)) { $cɸʑ[] = $Eљ; $Eۆ[] = $this->parseKey($cӶ); } } $dҴʆ = $AԦ܌[809] . $this->parseTable($e̲[$AԦ܌[272]]) . $AԦ܌[810] . implode($AԦ܌[57], $Eۆ) . $AԦ܌[811] . implode($AԦ܌[57], $cɸʑ) . $AԦ܌[812]; return $this->execute($dҴʆ); } public function insertAll($b, $A = array(), $Dň = false) { goto d; d: $EҘ =& $_SERVER[ȦÆ]; if (!is_array($b[0])) { return !1; } $Aծߪ = array_keys($b[0]); goto B; F: $d = ($Dň ? $EҘ[814] : $EҘ[815]) . $EҘ[816] . $this->parseTable($A[$EҘ[272]]) . $EҘ[810] . implode($EҘ[57], $Aծߪ) . $EҘ[817] . implode($EҘ[57], $e≴); return $this->execute($d); goto bϙ­; B: $e≴ = array(); foreach ($b as $e޸Ȕ) { $Aȱ = array(); foreach ($e޸Ȕ as $Dԇ => $C) { $C = $this->parseValue($C); if (is_scalar($C)) { $Aȱ[] = $C; } } $e≴[] = $EҘ[253] . implode($EҘ[57], $Aȱ) . $EҘ[812]; } array_walk($Aծߪ, array($this, $EҘ[813])); goto F; bϙ­: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $D =& $_SERVER[ȦÆ]; $this->error = mysql_errno() . $D[4] . mysql_error($this->_linkID); if ($D[43] != $this->queryStr) { $this->error .= LNG($D[55]) . $this->queryStr; } think_trace($this->error, $D[43], $D[56]); return $this->error; } public function escapeString($E櫘ߚ) { if ($this->_linkID) { return mysql_real_escape_string($E櫘ߚ, $this->_linkID); } else { return mysql_escape_string($E櫘ߚ); } } public function parseKey(&$d, $fۮ޼ = true) { $dԦ =& $_SERVER[ȦÆ]; if ($fۮ޼) { $d = $this->parseKeyCheck($d); } if ($d != $dԦ[182] && !preg_match($dԦ[818], $d)) { $d = $dԦ[819] . trim($d, $dԦ[819]) . $dԦ[819]; } return $d; } } class DbMysqli extends Db { public function __construct($D = '') { $d䣩 =& $_SERVER[ȦÆ]; if (!extension_loaded($d䣩[728])) { think_exception(think_lang($d䣩[20]) . $d䣩[820]); } if (!empty($D)) { $this->config = $D; if (empty($this->config[$d䣩[23]])) { $this->config[$d䣩[23]] = $d䣩[43]; } } } public function connect($cՃ = '', $d▖ = 0) { $c֒ =& $_SERVER[ȦÆ]; if (!isset($this->linkID[$d▖])) { goto b; b: if (empty($cՃ)) { $cՃ = $this->config; } $this->linkID[$d▖] = new mysqli($cՃ[$c֒[794]], $cՃ[$c֒[796]], $cՃ[$c֒[797]], $cՃ[$c֒[27]], $cՃ[$c֒[795]] ? intval($cՃ[$c֒[795]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto e; Cڪե: $this->connected = !0; if (1 != think_config($c֒[28])) { unset($this->config); } goto bǣ˿; e: $f = $this->linkID[$d▖]->server_version; $this->linkID[$d▖]->query($c֒[798] . think_config($c֒[799]) . $c֒[65]); if ($f > $c֒[800]) { $this->linkID[$d▖]->query($c֒[801]); } goto Cڪե; bǣ˿: } return $this->linkID[$d▖]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($E˰ͥǨ) { goto dלȊ; e: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto fާ; dלȊ: $Eȍ =& $_SERVER[ȦÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto C޼κ; C޼κ: $this->queryStr = $E˰ͥǨ; if ($this->queryID) { $this->free(); } think_action_status($Eȍ[29], 1); goto bۃц; bۃц: think_status($Eȍ[30]); $this->queryID = $this->_linkID->query($E˰ͥǨ); if ($this->_linkID->more_results()) { while (($D = $this->_linkID->next_result()) != NULL) { $D->free_result(); } } goto e; fާ: } public function execute($F幋) { goto eە; a،: think_status($A쥮[30]); $E = $this->_linkID->query($F幋); $this->debug(); goto dđл; eە: $A쥮 =& $_SERVER[ȦÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto Aֽ; dđл: if (!1 === $E) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto E܄򹇢; Aֽ: $this->queryStr = $F幋; if ($this->queryID) { $this->free(); } think_action_status($A쥮[31], 1); goto a،; E܄򹇢: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $f = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$f) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $eÕɆ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$eÕɆ) { $this->error(); return !1; } } return !0; } private function getAll() { $Dڒ = array(); if ($this->numRows > 0) { for ($A̩ = 0; $A̩ < $this->numRows; $A̩++) { $Dڒ[$A̩] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Dڒ; } public function getFields($eЕ눬) { $Bս =& $_SERVER[ȦÆ]; $Dτ = $this->query($Bս[805] . $this->parseKey($eЕ눬)); $a؋ = array(); if ($Dτ) { foreach ($Dτ as $B => $Aݺ) { $a؋[$Aݺ[$Bս[37]]] = array($Bս[38] => $Aݺ[$Bս[37]], $Bս[39] => $Aݺ[$Bս[40]], $Bս[41] => (bool) ($Aݺ[$Bս[42]] === $Bս[43]), $Bս[44] => $Aݺ[$Bս[45]], $Bս[46] => strtolower($Aݺ[$Bս[47]]) == $Bս[48], $Bս[49] => strtolower($Aݺ[$Bս[50]]) == $Bս[51]); } } return $a؋; } public function getTables($d߉훸 = '') { $Bʒ =& $_SERVER[ȦÆ]; $F = !empty($d߉훸) ? $Bʒ[807] . $d߉훸 : $Bʒ[808]; $dӻ = $this->query($F); $Eˣὣ = array(); if ($dӻ) { foreach ($dӻ as $f넶Ʉ => $C) { $Eˣὣ[$f넶Ʉ] = current($C); } } return $Eˣὣ; } public function replace($aƈ, $D¢ = array()) { $E퐓 =& $_SERVER[ȦÆ]; foreach ($aƈ as $Fûٓ => $e) { $E = $this->parseValue($e); if (is_scalar($E)) { $c˳[] = $E; $bʡӵ[] = $this->parseKey($Fûٓ); } } $f몬 = $E퐓[809] . $this->parseTable($D¢[$E퐓[272]]) . $E퐓[810] . implode($E퐓[57], $bʡӵ) . $E퐓[811] . implode($E퐓[57], $c˳) . $E퐓[812]; return $this->execute($f몬); } public function insertAll($d, $a𥕤 = array(), $Dͦ = false) { goto d; c혛: $b = ($Dͦ ? $Cɷ[814] : $Cɷ[815]) . $Cɷ[816] . $this->parseTable($a𥕤[$Cɷ[272]]) . $Cɷ[810] . implode($Cɷ[57], $c) . $Cɷ[817] . implode($Cɷ[57], $F); return $this->execute($b); goto fܓ; Cۡ: $F = array(); foreach ($d as $Aς) { $C = array(); foreach ($Aς as $dҵ => $A) { $A = $this->parseValue($A); if (is_scalar($A)) { $C[] = $A; } } $F[] = $Cɷ[253] . implode($Cɷ[57], $C) . $Cɷ[812]; } array_walk($c, array($this, $Cɷ[813])); goto c혛; d: $Cɷ =& $_SERVER[ȦÆ]; if (!is_array($d[0])) { return !1; } $c = array_keys($d[0]); goto Cۡ; fܓ: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $F =& $_SERVER[ȦÆ]; $this->error = $this->_linkID->errno . $F[4] . $this->_linkID->error; if ($F[43] != $this->queryStr) { $this->error .= LNG($F[55]) . $this->queryStr; } think_trace($this->error, $F[43], $F[56]); return $this->error; } public function escapeString($cȺ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($cȺ); } else { return addslashes($cȺ); } } public function parseKey(&$b, $D = true) { $c݈ =& $_SERVER[ȦÆ]; if ($D) { $b = $this->parseKeyCheck($b); } if ($b != $c݈[182] && !preg_match($c݈[818], $b)) { $b = $c݈[819] . trim($b, $c݈[819]) . $c݈[819]; } return $b; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($fΑ = '') { $cϛ˔ =& $_SERVER[ȦÆ]; if (!class_exists($cϛ˔[821])) { think_exception(think_lang($cϛ˔[20]) . $cϛ˔[822]); } if (!empty($fΑ)) { $this->config = $fΑ; if (empty($this->config[$cϛ˔[23]])) { $this->config[$cϛ˔[23]] = array(); } } } public function connect($C = '', $f = 0) { $F =& $_SERVER[ȦÆ]; if (!isset($this->linkID[$f])) { goto Eָ; D: $this->dbType = $this->_getDsnType($C[$F[823]]); if (in_array($this->dbType, array($F[824], $F[825], $F[826], $F[827]))) { think_exception($F[828] . $this->dbType . $F[829] . $this->dbType . $F[830]); } if (!$this->linkID[$f]) { think_exception($F[831]); } goto Fָ; Eָ: if (empty($C)) { $C = $this->config; } if ($this->pconnect) { $C[$F[23]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$f] = new PDO($C[$F[823]], $C[$F[796]], $C[$F[797]], $C[$F[23]]); } catch (PDOException $A) { think_exception($A->getMessage()); } goto D; Fָ: $this->linkID[$f]->exec($F[832] . think_config($F[799])); $this->connected = !0; if (1 != think_config($F[28])) { unset($this->config); } goto D; D: } return $this->linkID[$f]; } public function free() { $this->PDOStatement = null; } public function query($d, $c˽ = array()) { goto Cʐ; e: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $f߂Ä = $this->PDOStatement->execute($c˽); $this->debug(); goto d㠙; BƓμ: think_action_status($b؅[29], 1); think_status($b؅[30]); $this->PDOStatement = $this->_linkID->prepare($d); goto e; Cʐ: $b؅ =& $_SERVER[ȦÆ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto cśۙ; cśۙ: $this->queryStr = $d; if (!empty($c˽)) { $this->queryStr .= $b؅[833] . print_r($c˽, !0) . $b؅[834]; } if (!empty($this->PDOStatement)) { $this->free(); } goto BƓμ; d㠙: if (!1 === $f߂Ä) { $this->error(); return !1; } else { return $this->getAll(); } goto C; C: } public function execute($fͺɍ, $aՐǄ = array()) { goto fު; b̰ܬ: $this->queryStr = $fͺɍ; if (!empty($aՐǄ)) { $this->queryStr .= $dٶ[833] . print_r($aՐǄ, !0) . $dٶ[834]; } $bÈ = !1; goto fϰ; Fڴ: think_status($dٶ[30]); $this->PDOStatement = $this->_linkID->prepare($fͺɍ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto C; fϰ: if ($this->dbType == $dٶ[827]) { if (preg_match($dٶ[835], $this->queryStr, $d㌌̋)) { $this->table = think_config($dٶ[836]) . str_ireplace(think_config($dٶ[837]), $dٶ[366], $d㌌̋[2]); $bÈ = (bool) $this->query($dٶ[838] . strtoupper($this->table) . $dٶ[65]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($dٶ[31], 1); goto Fڴ; C: $E = $this->PDOStatement->execute($aՐǄ); $this->debug(); if (!1 === $E) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($bÈ || preg_match($dٶ[839], $fͺɍ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto F˙; fު: $dٶ =& $_SERVER[ȦÆ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto b̰ܬ; F˙: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $cʋ = $this->_linkID->commit(); $this->transTimes = 0; if (!$cʋ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $aǆ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$aǆ) { $this->error(); return !1; } } return !0; } private function getAll() { $eˢ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($eˢ); return $eˢ; } public function getFields($B) { goto a܋; a܋: $b =& $_SERVER[ȦÆ]; $this->initConnect(!0); if (think_config($b[840])) { $E؋ = str_replace($b[841], $B, think_config($b[840])); } else { switch ($this->dbType) { case $b[824]: case $b[842]: $E؋ = "\123\105\x4c\x45\x43\124\40\x20\x20\x63\x6f\154\x75\x6d\156\137\x6e\x61\155\145\x20\141\163\40\47\x4e\x61\x6d\145\x27\x2c\40\40\40\x64\141\x74\x61\137\164\x79\x70\145\40\141\x73\x20\x27\x54\171\x70\x65\47\x2c\40\40\40\143\x6f\x6c\165\155\156\137\x64\x65\146\x61\x75\x6c\x74\40\x61\163\x20\x27\104\x65\146\x61\165\154\x74\47\x2c\40\40\x20\151\163\x5f\x6e\x75\154\x6c\x61\x62\x6c\x65\40\x61\x73\40\47\116\x75\154\154\47\xa\11\x9\106\x52\117\115\x9\x69\x6e\x66\x6f\162\155\x61\x74\x69\157\x6e\x5f\163\143\150\145\155\x61\x2e\164\x61\142\154\145\163\40\x41\123\40\164\xa\x9\11\112\x4f\111\x4e\x9\x69\x6e\146\x6f\162\x6d\141\x74\151\x6f\156\137\x73\x63\x68\x65\x6d\141\x2e\143\x6f\x6c\165\x6d\156\x73\x20\x41\x53\x20\x63\xa\11\11\x4f\116\40\x20\x74\x2e\164\141\x62\x6c\145\x5f\143\x61\164\141\154\x6f\x67\x20\75\x20\x63\x2e\164\141\x62\154\x65\x5f\143\x61\164\141\x6c\x6f\147\12\11\x9\101\x4e\x44\x20\164\x2e\x74\141\142\x6c\x65\137\x73\x63\150\x65\x6d\141\x20\75\x20\x63\56\164\141\x62\154\x65\137\x73\143\x68\145\x6d\141\xa\x9\11\101\116\104\40\164\56\x74\141\142\154\145\137\x6e\x61\155\145\x20\75\x20\x63\56\164\x61\x62\x6c\x65\137\156\x61\x6d\x65\12\11\11\x57\x48\x45\122\105\40\40\x20\x74\x2e\164\141\142\x6c\145\x5f\x6e\141\x6d\x65\40\x3d\x20\47{$B}\x27"; break; case $b[843]: $E؋ = $b[844] . $B . $b[845]; break; case $b[825]: case $b[827]: $E؋ = $b[846] . $b[847] . $b[848] . strtoupper($B) . $b[849] . strtoupper($B) . $b[850]; break; case $b[851]: $E؋ = $b[852] . $B . $b[853]; break; case $b[826]: break; case $b[854]: default: $E؋ = $b[855] . ($this->dbType == $b[854] ? "\x60{$B}\140" : $B); } } goto d; d: $D = $this->query($E؋); $aÅ҄ = array(); if ($D) { foreach ($D as $bѦ => $cɦ) { $cɦ = array_change_key_case($cɦ); $cɦ[$b[38]] = isset($cɦ[$b[38]]) ? $cɦ[$b[38]] : $b[366]; $cɦ[$b[39]] = isset($cɦ[$b[39]]) ? $cɦ[$b[39]] : $b[366]; $B䚉 = isset($cɦ[$b[266]]) ? $cɦ[$b[266]] : $cɦ[$b[38]]; $aÅ҄[$B䚉] = array($b[38] => $B䚉, $b[39] => $cɦ[$b[39]], $b[41] => (bool) (isset($cɦ[$b[109]]) && $cɦ[$b[109]] === $b[43] || isset($cɦ[$b[41]]) && $cɦ[$b[41]] === $b[43]), $b[44] => isset($cɦ[$b[44]]) ? $cɦ[$b[44]] : (isset($cɦ[$b[63]]) ? $cɦ[$b[63]] : $b[366]), $b[46] => isset($cɦ[$b[99]]) ? strtolower($cɦ[$b[99]]) == $b[48] : (isset($cɦ[$b[64]]) ? $cɦ[$b[64]] : !1), $b[49] => isset($cɦ[$b[856]]) ? strtolower($cɦ[$b[856]]) == $b[51] : (isset($cɦ[$b[99]]) ? $cɦ[$b[99]] : !1)); } } goto bН; bН: return $aÅ҄; goto B; B: } public function getTables($Cȫ = '') { $E =& $_SERVER[ȦÆ]; if (think_config($E[857])) { $c = str_replace($E[858], $Cȫ, think_config($E[857])); } else { switch ($this->dbType) { case $E[825]: case $E[827]: $c = $E[859]; break; case $E[824]: case $E[842]: $c = $E[860]; break; case $E[851]: $c = $E[861]; break; case $E[826]: think_exception(think_lang($E[862]) . $E[863]); break; case $E[843]: $c = $E[52] . $E[53] . $E[54]; break; case $E[854]: default: if (!empty($Cȫ)) { $c = $E[807] . $Cȫ; } else { $c = $E[808]; } } } $c = $this->query($c); $Eʚ = array(); foreach ($c as $aҞܞ => $fì) { $Eʚ[$aҞܞ] = current($fì); } return $Eʚ; } protected function parseLimit($d݈Ց) { $b =& $_SERVER[ȦÆ]; $D¦ = $b[43]; if (!empty($d݈Ց)) { switch ($this->dbType) { case $b[851]: case $b[843]: $d݈Ց = explode($b[57], $d݈Ց); if (count($d݈Ց) > 1) { $D¦ .= $b[58] . $d݈Ց[1] . $b[59] . $d݈Ց[0] . $b[60]; } else { $D¦ .= $b[58] . $d݈Ց[0] . $b[60]; } break; case $b[824]: case $b[842]: break; case $b[826]: break; case $b[825]: case $b[827]: break; case $b[854]: default: $D¦ .= $b[58] . $d݈Ց . $b[60]; } } return $D¦; } public function parseKey(&$D, $fĜ = true) { $Bَ =& $_SERVER[ȦÆ]; if ($fĜ) { $D = $this->parseKeyCheck($D); } if ($this->dbType == $Bَ[854]) { if ($D != $Bَ[182] && !preg_match($Bَ[818], $D)) { $D = $Bَ[819] . trim($D, $Bَ[819]) . $Bَ[819]; } return $D; } else { return parent::parseKey($D); } } public function close() { $this->_linkID = null; } public function error() { $a˹ =& $_SERVER[ȦÆ]; if ($this->PDOStatement) { $A֓Ԩ = $this->PDOStatement->errorInfo(); $this->error = $A֓Ԩ[1] . $a˹[4] . $A֓Ԩ[2]; } else { $this->error = $a˹[43]; } if ($a˹[43] != $this->queryStr) { $this->error .= LNG($a˹[55]) . $this->queryStr; } think_trace($this->error, $a˹[43], $a˹[56]); return $this->error; } public function escapeString($c) { $b =& $_SERVER[ȦÆ]; switch ($this->dbType) { case $b[851]: case $b[824]: case $b[842]: case $b[854]: return addslashes($c); case $b[826]: case $b[843]: case $b[825]: case $b[827]: return str_ireplace($b[65], $b[66], $c); } } protected function parseValue($fٱ) { $c =& $_SERVER[ȦÆ]; if (is_string($fٱ)) { $fٱ = strpos($fٱ, $c[4]) === 0 ? $this->escapeString($fٱ) : $c[864] . $this->escapeString($fٱ) . $c[864]; } elseif (isset($fٱ[0]) && is_string($fٱ[0]) && strtolower($fٱ[0]) == $c[290]) { $fٱ = $this->escapeString($fٱ[1]); } elseif (is_array($fٱ)) { $fٱ = array_map(array($this, $c[865]), $fٱ); } elseif (is_bool($fٱ)) { $fٱ = $fٱ ? $c[93] : $c[473]; } elseif (is_null($fٱ)) { $fٱ = $c[109]; } return $fٱ; } public function getLastInsertId() { $E׻ =& $_SERVER[ȦÆ]; switch ($this->dbType) { case $E׻[851]: case $E׻[843]: case $E׻[824]: case $E׻[842]: case $E׻[826]: case $E׻[854]: return $this->_linkID->lastInsertId(); case $E׻[825]: case $E׻[827]: $E = $this->table; $fĶ = $this->query("\x53\105\114\105\103\x54\40{$E}\56\143\165\x72\162\x76\141\154\40\x63\x75\x72\x72\x76\x61\x6c\x20\x46\x52\x4f\x4d\x20\x64\x75\x61\154"); return $fĶ ? $fĶ[0][$E׻[866]] : 0; } } } goto F; eú: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto b̮; b̮: $cқނ =& $_SERVER[ȦÆ]; if (self::$handle) { return self::$handle; } $f = $GLOBALS[$cқނ[16]][$cқނ[342]]; goto A¢; f˓: if ($Fӟ == $cқނ[27] && $a߈ == $cқނ[19]) { $Fӟ = $cқނ[173]; } switch ($Fӟ) { case $cқނ[757]: self::$handle = new CacheLockRedis(); break; case $cқނ[758]: self::$handle = new CacheLockMemcached(); break; case $cқނ[27]: self::$handle = new CacheLockDatabase(); break; case $cқނ[173]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto Aޟ; A¢: self::$timeout = $f[$cқނ[767]] ? $f[$cқނ[767]] : 10; $a߈ = _get($GLOBALS[$cқނ[16]], $cқނ[768]); $Fӟ = $f[$cқނ[754]] ? $f[$cқނ[754]] : $cқނ[173]; goto f˓; Aޟ: } private static function key($a) { return $_SERVER[ȦÆ][769] . Cache::key($a); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($F = '') { self::$errorMsg = $F; } public static function lockGlobal($e, $B) { return self::lock($e, $B, !0); } public static function lock($e, $A = false, $Aߍ = false) { goto Eׂ; d: $A = $A ? $A : self::$timeout; $cωۘ = $E⹽->lock($D, $A); if (!$cωۘ) { $fϳӈ = $bپ[770] . $A . $bپ[77] . self::$errorMsg . $bپ[77] . get_caller_msg(); $c = "\x4c\157\x63\153\40\141\x63\x74\151\x6f\x6e\72\40{$D}\40\164\151\x6d\x65\x6f\165\164\x2c\157\166\145\x72\40{$A}\40\x73"; $c = self::$errorMsg ? self::$errorMsg : $AȒ죆; write_log($fϳӈ, $bپ[771]); show_json($c, !1); } goto D૨; D૨: if (!$Aߍ) { self::$lockItem[$D] = !0; } return $cωۘ; goto bņ; Eׂ: $bپ =& $_SERVER[ȦÆ]; $E⹽ = self::init(); $D = self::key($e); goto d; bņ: } public static function lockGet($aһ) { $D혡 = self::key($aһ); if (self::$lockItem[$D혡]) { return self::$lockItem[$D혡]; } return self::init()->lockGet($D혡); } public static function unlock($d˱) { $f = self::key($d˱); self::$lockItem[$f] = null; return self::init()->unlock($f); } public static function unlockRuntime() { $F֎˨ =& $_SERVER[ȦÆ]; $dϖ = self::init(); $dû = !1; foreach (self::$lockItem as $f鉨Ź => $F) { if (!$F) { continue; } $dϖ->unlock($f鉨Ź); if (!$dû) { $dû = !0; write_log($F֎˨[772] . $f鉨Ź . $F֎˨[77] . get_caller_msg(), $F֎˨[771]); continue; } write_log($F֎˨[772] . $f鉨Ź, $F֎˨[771]); } } } function cacheLockWait() { usleep(mt_rand(5, 50) * 100); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $c폂 =& $_SERVER[ȦÆ]; $fߓ = $GLOBALS[$c폂[16]][$c폂[342]]; self::$cachePath = $fߓ[$c폂[173]][$c폂[85]]; @mkdir(self::$cachePath, 511, !0); } public function lock($e׵񓰺, $c䵭ֹ = 0) { goto fʣ; fʣ: $B҈ =& $_SERVER[ȦÆ]; $d = microtime(!0); $A = $d + $c䵭ֹ + 0.0001; goto Fƫ; B⍇: $this->unlock($e׵񓰺); return !1; goto f; Fƫ: $BǶ = rtrim(self::$cachePath, $B҈[18]) . $B҈[773] . md5($e׵񓰺) . $B҈[774]; if (file_exists($BǶ) && filemtime($BǶ) && filemtime($BǶ) < time() - 10) { @unlink($BǶ); } do { if (file_exists($BǶ)) { cacheLockWait(); continue; } $c = fopen($BǶ, $B҈[775]); if (!$c) { return !1; } $aӝ = flock($c, LOCK_EX | LOCK_NB); self::$caches[$e׵񓰺] = array($B҈[776] => $c, $B҈[173] => $BǶ); fwrite($c, $A); clearstatcache(); if ($c && $aӝ) { return !0; } cacheLockWait(); } while (microtime(!0) < $A); goto B⍇; f: } public function lockGet($dɡ) { $bЧ =& $_SERVER[ȦÆ]; $a = rtrim(self::$cachePath, $bЧ[18]) . $bЧ[773] . md5($dɡ) . $bЧ[774]; return file_exists($a); } public function unlock($e) { goto B; B: $Cȿ =& $_SERVER[ȦÆ]; $Bۇॷ = self::$caches[$e]; if (!$Bۇॷ) { return; } goto bݻƦ; bݻƦ: @flock($Bۇॷ[$Cȿ[776]], LOCK_UN); @fclose($Bۇॷ[$Cȿ[776]]); @unlink($Bۇॷ[$Cȿ[173]]); goto A; A: unset(self::$caches[$e]); goto c◗; c◗: } } goto aհ܎; AН: class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\171\124\151\x6d\145", "\164\151\x6d\x65", "\x69\x6e\x73\145\x72\x74\x2c\165\160\x64\141\164\x65", "\146\165\156\x63\x74\x69\157\x6e"), array("\143\x72\x65\141\164\x65\x54\x69\155\145", "\x74\151\x6d\x65", "\151\156\163\x65\x72\164", "\146\x75\x6e\x63\164\x69\x6f\x6e"), array("\x6f\160\x74\151\x6f\156\163", '', "\x69\x6e\163\x65\162\x74\54\x75\x70\144\x61\164\x65\x2c\163\x65\x6c\x65\143\x74", "\152\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($dӣˉ) { $Cɤ =& $_SERVER[ȦÆ]; $EˇĞѥ = isset($dӣˉ[0]) ? $dӣˉ[0] : !1; return array($Cɤ[2179] => array(USER_ID, $Cɤ[2180]), $Cɤ[2142] => array($EˇĞѥ, $Cɤ[2181])); } protected function listSimple() { $aʣ = array($_SERVER[ȦÆ][1412] => USER_ID); $A = $this->field($this->fieldList)->where($aʣ)->select(); return $A ? $A : array(); } protected function getInfo($fտ⊈, $C = false) { $bمȚ =& $_SERVER[ȦÆ]; if ($C) { return $this->_getShareInfo(array($bمȚ[446] => $fտ⊈)); } $E؉̴ = $this->cacheFunctionGet($bمȚ[2182], $fտ⊈); return $E؉̴; } public function getInfoByHash($A) { return $this->_getShareInfo(array($_SERVER[ȦÆ][448] => $A)); } public function getInfoByPath($E͞) { $DӘ =& $_SERVER[ȦÆ]; $f͚ = array($DӘ[1412] => USER_ID, $DӘ[374] => $E͞); return $this->_getShareInfo($f͚); } public function getInfoBySourcePath($BӒ枯) { $d =& $_SERVER[ȦÆ]; $F = array($d[1412] => USER_ID, $d[1011] => $BӒ枯); return $this->_getShareInfo($F); } private function _getShareInfo($Bߑ׈) { goto BǮ; B: $Bߑ׈ = array($fŉ޿[446] => $Dݙ[$fŉ޿[446]]); $e = $fŉ޿[2183]; $b݉א = Model($fŉ޿[542])->order($fŉ޿[372])->field($e)->where($Bߑ׈)->select(); goto d֎毞; d֎毞: if ($Dݙ[$fŉ޿[374]] == $fŉ޿[473]) { $Dݙ[$fŉ޿[396]] = IO::info($Dݙ[$fŉ޿[1011]]); } else { $Dݙ[$fŉ޿[396]] = Model($fŉ޿[1103])->pathInfo($Dݙ[$fŉ޿[374]]); } $Dݙ[$fŉ޿[2184]] = $b݉א; return $Dݙ; goto aӞЧ; BǮ: $fŉ޿ =& $_SERVER[ȦÆ]; $Dݙ = $this->where($Bߑ׈)->find(); if (!$Dݙ) { return !1; } goto B; aӞЧ: } protected function getInfoAuth($BͣŅ) { $D˴ =& $_SERVER[ȦÆ]; $d㶈 = $this->getInfo($BͣŅ); $d㶈[$D˴[381]] = Model($D˴[459])->authMake($d㶈[$D˴[2184]]); return $d㶈; } protected function listData($bл = null, $b = 300) { $fݒ =& $_SERVER[ȦÆ]; $bީ = array(array($fݒ[451] => array($fݒ[921], 0), $fݒ[453] => array($fݒ[921], 0), $fݒ[2185] => $fݒ[2154])); if ($bл == $fݒ[1841]) { $bީ = array($fݒ[451] => 1); } else { if ($bл == $fݒ[1000]) { $bީ = array($fݒ[453] => 1); } } $bީ[$fݒ[1412]] = USER_ID; $a = $this->where($bީ)->selectPage($b); return $a; } protected function listToMe($c = 300) { goto b; e: $d = array($d[2188] => $eҺ, $d[2189] => $dۅ[$d[356]]); return $d; goto dҚۋ; E圖: $f = array($d[526] => SourceModel::TYPE_USER, $d[461] => USER_ID); if ($a폮) { $f = array(array($d[526] => SourceModel::TYPE_USER, $d[461] => USER_ID), array($d[526] => SourceModel::TYPE_GROUP, $d[461] => array($d[17], $a폮)), $d[2185] => $d[2154]); } $dۅ = Model($d[542])->where($f)->selectPage($c); goto aِ; E׋: $f = array($d[446] => array($d[389], array_keys($e﫧))); $eҺ = $this->field($A)->where($f)->select(); foreach ($eҺ as $aƢ => &$CҲ) { $CҲ[$d[2184]] = $e﫧[$CҲ[$d[446]]]; } goto e; b: $d =& $_SERVER[ȦÆ]; $Fﮚ = Session::get($d[2186]); $a폮 = array_to_keyvalue($Fﮚ, $d[43], $d[2074]); goto E圖; aِ: $e﫧 = array_to_keyvalue_group($dۅ[$d[359]], $d[446]); if (!$e﫧) { return $dۅ; } $A = $d[2187]; goto E׋; dҚۋ: } protected function shareAdd($A޼ׄ, $DĐλ) { $D =& $_SERVER[ȦÆ]; $a̯ۋ = $this->_addShareData($A޼ׄ, $DĐλ); if (!empty($DĐλ[$D[2190]])) { $this->_shareAuthSet($a̯ۋ, $DĐλ[$D[2190]]); } $this->shareEventAdd($A޼ׄ, $DĐλ, $D[1003]); return $a̯ۋ; } private function shareEventAdd($d, $e䏗, $d = "\x61\x64\144") { goto E۵; aԕ̳: if ($A[$f豜[453]] == $f豜[473] && $e䏗[$f豜[453]] == $f豜[93]) { $c쪑 = $f豜[2192]; } if ($A[$f豜[453]] == $f豜[93] && $e䏗[$f豜[453]] == $f豜[473]) { $c쪑 = $f豜[2195]; } Model($f豜[510])->eventShare($d, $c쪑); goto eΎ悦; E۵: $f豜 =& $_SERVER[ȦÆ]; if ($d == $f豜[1003]) { if ($e䏗[$f豜[451]] == $f豜[93]) { Model($f豜[510])->eventShare($d, $f豜[2191]); } if ($e䏗[$f豜[453]] == $f豜[93]) { Model($f豜[510])->eventShare($d, $f豜[2192]); } return; } $A = $this->getInfoByPath($d); goto Cݝ; Cݝ: $c쪑 = $f豜[2193]; if ($A[$f豜[451]] == $f豜[473] && $e䏗[$f豜[451]] == $f豜[93]) { $c쪑 = $f豜[2191]; } if ($A[$f豜[451]] == $f豜[93] && $e䏗[$f豜[451]] == $f豜[473]) { $c쪑 = $f豜[2194]; } goto aԕ̳; eΎ悦: return; goto E; E: } private function _addShareData($fݭ, $D냇 = array()) { goto f; f: $A¦ۺ =& $_SERVER[ȦÆ]; $e݋ = array($A¦ۺ[388] => $fݭ, $A¦ۺ[1403] => USER_ID); if ($fݭ == 0) { $e݋ = array($A¦ۺ[2196] => $D냇[$A¦ۺ[1011]], $A¦ۺ[1403] => USER_ID); } goto F䈤; D: $DᢶɅ = array($A¦ۺ[1403] => USER_ID, $A¦ۺ[388] => $fݭ, $A¦ۺ[1320] => $A¦ۺ[43], $A¦ۺ[451] => 0, $A¦ۺ[453] => 0, $A¦ۺ[1011] => $A¦ۺ[43], $A¦ۺ[300] => $A¦ۺ[43], $A¦ۺ[797] => $A¦ۺ[43], $A¦ۺ[2197] => 0, $A¦ۺ[2198] => 0, $A¦ۺ[704] => 0, $A¦ۺ[2199] => $A¦ۺ[43], $A¦ۺ[448] => $A¦ۺ[43]); $c = explode($A¦ۺ[57], $A¦ۺ[2200]); foreach ($c as $C踈) { if (!isset($D냇[$C踈])) { continue; } $DᢶɅ[$C踈] = $D냇[$C踈]; } goto E┺΂; b샼: return $E进; goto d򶲌; E┺΂: $E进 = $this->add($DᢶɅ); $FǃΈ = array($A¦ۺ[448] => short_id($E进)); $this->where(array($A¦ۺ[445] => $E进))->save($FǃΈ); goto b샼; F䈤: if ($Aۣ = $this->where($e݋)->find()) { return $Aۣ[$A¦ۺ[446]]; } if ($fݭ == 0) { $fՄҗ = array($A¦ۺ[38] => get_path_this($D냇[$A¦ۺ[85]])); } else { $fՄҗ = Model($A¦ۺ[753])->sourceInfo($fݭ); if (!$fՄҗ) { return !1; } } if (!$D냇[$A¦ۺ[1320]]) { $D냇[$A¦ۺ[1320]] = $fՄҗ[$A¦ۺ[38]]; } goto D; d򶲌: } private function _shareAuthSet($Cꛖ, $e։) { goto b׋; bز: $A->where(array($C冽[446] => $Cꛖ))->delete(); $a = array(); foreach ($e։ as $a) { $cȝ쯎 = SourceModel::TYPE_USER; if ($a[$C冽[376]] == SourceModel::TYPE_GROUP) { $cȝ쯎 = SourceModel::TYPE_GROUP; } $CǈҎ = array($C冽[446] => $Cꛖ, $C冽[376] => $cȝ쯎, $C冽[461] => intval($a[$C冽[461]]), $C冽[2202] => 0, $C冽[2203] => -1); if ($a[$C冽[2202]]) { $CǈҎ[$C冽[2202]] = $a[$C冽[2202]]; } else { if ($a[$C冽[2203]]) { $CǈҎ[$C冽[2203]] = $a[$C冽[2203]]; } } $a[] = $CǈҎ; } goto dÄן; dÄן: return $A->addAll($a, array(), !0); goto F; b׋: $C冽 =& $_SERVER[ȦÆ]; if (!is_array($e։)) { return !1; } $A = Model($C冽[2201]); goto bز; F: } public function numViewAdd($F) { $Cѹ԰ =& $_SERVER[ȦÆ]; $Bڪ = array($Cѹ԰[445] => $F); $this->where($Bڪ)->setAdd($Cѹ԰[2197]); } public function numDownloadAdd($aጛ) { $A̖ӇÒ =& $_SERVER[ȦÆ]; $E샞 = array($A̖ӇÒ[445] => $aጛ); $this->where($E샞)->setAdd($A̖ӇÒ[2198]); } protected function shareEdit($e˴, $b«) { goto Aͺ; D: foreach ($aҎ as $b) { if (!array_key_exists($b, $b«)) { continue; } $B[$b] = $b«[$b]; } $this->shareEventAdd($a[$a顇[374]], $b«, $a顇[2042]); $this->where(array($a顇[445] => $e˴))->save($B); goto Dࣕ; e: $this->_checkLinkShare($b«, $a); $B = array(); $aҎ = explode($a顇[57], $a顇[2204]); goto D; Aͺ: $a顇 =& $_SERVER[ȦÆ]; $a = $this->getInfo($e˴); if (!$a) { return !1; } goto e; Dࣕ: if (isset($b«[$a顇[2190]])) { $this->_shareAuthSet($e˴, $b«[$a顇[2190]]); } return !0; goto Eք; Eք: } private function _checkLinkShare($dэ䬆, $Cͧ²) { goto eʞ; eʞ: $eը =& $_SERVER[ȦÆ]; if ($dэ䬆[$eը[451]] != $eը[93]) { return; } $Aً = $Cͧ²[$eը[396]][$eը[374]]; goto cަڤ; eܚм: $Bښ = $this->shareFileMeta($B܅[$eը[424]]); if (isset($Bښ[$eը[364]]) && $Bښ[$eը[364]] == $eը[93]) { show_json(LNG($eը[2207]), !1); } goto c暣܈; cަڤ: if ($Cͧ²[$eը[396]][$eը[39]] != $eը[173]) { $Cȩ = $this->_folderReport($Aً); if (!$Cȩ) { return; } show_json(LNG($eը[2205]) . $eը[2206] . $Cȩ, !1); } $B܅ = Model($eը[753])->fileInfoGet($Cͧ²[$eը[396]][$eը[374]]); if (!$B܅) { return; } goto eܚм; c暣܈: } private function _folderReport($fʭ) { goto cؠ֋; cؠ֋: $A =& $_SERVER[ȦÆ]; $DŶ = array($A[424] => array($A[921], 0), $A[690] => 3); $a֮ = Model($A[2208])->where($DŶ)->field($A[424])->select(); goto C; bп: $FȊ셿 = substr($fָ[$A[464]], strpos($fָ[$A[464]], $c)); $DŶ = array($A[374] => array($A[17], trim($FȊ셿, $A[57]))); $B = Model($A[753])->where($DŶ)->field($A[38])->select(); goto A; A: $Aↄ = array_to_keyvalue($B, $A[43], $A[38]); $Aↄ[] = $fָ[$A[38]]; return implode($A[18], $Aↄ); goto AȂņ; C럊: $DŶ = array($A[424] => array($A[17], $a֮), $A[464] => array($A[752], "\45{$c}\x25"), $A[402] => 0); $fָ = Model($A[753])->where($DŶ)->field($A[2209])->find(); if (!$fָ) { return !1; } goto bп; C: if (!$a֮) { return !1; } $a֮ = array_to_keyvalue($a֮, $A[43], $A[424]); $c = $A[57] . $fʭ . $A[57]; goto C럊; AȂņ: } protected function remove($Fꌷ) { goto Bتͯ; Fꕟ: for ($aЮ۳ = 0; $aЮ۳ < count($cė); $aЮ۳++) { $fی = $this->getInfo($cė[$aЮ۳]); if ($fی[$C컦[453]] == $C컦[93]) { Model($C컦[510])->eventShare($fی[$C컦[374]], $C컦[2195]); } if ($fی[$C컦[451]] == $C컦[93]) { Model($C컦[510])->eventShare($fی[$C컦[374]], $C컦[2194]); } } return $D; goto bك; Bتͯ: $C컦 =& $_SERVER[ȦÆ]; if (is_array($Fꌷ)) { $Fꌷ = array($C컦[17], $Fꌷ); } $fԱ = array($C컦[446] => $Fꌷ); goto a; a: $D = $this->where($fԱ)->delete(); if ($D) { Model($C컦[542])->where(array($C컦[446] => $Fꌷ))->delete(); } $cė = is_array($Fꌷ) ? $Fꌷ[1] : array($Fꌷ); goto Fꕟ; bك: } protected function removeBySource($fӤݭ) { goto E; E򴝱: $b݉ = array_to_keyvalue($b݉, $F̮[43], $F̮[446]); if (!$b݉) { return; } $dÏ = array($F̮[445] => array($F̮[389], $b݉)); goto CӸ닂; E: $F̮ =& $_SERVER[ȦÆ]; $dÏ = array($F̮[388] => array($F̮[389], $fӤݭ)); $b݉ = $this->field($F̮[446])->where($dÏ)->select(); goto E򴝱; CӸ닂: $this->where($dÏ)->delete(); Model($F̮[542])->where($dÏ)->delete(); goto c; c: } public function listAll($dя) { goto Dݦ㸉; E옆: if ($dя[$EĚ[703]]) { $e׆ۉ = $dя[$EĚ[704]] ? $dя[$EĚ[704]] : strtotime(date($EĚ[2210])); $C얥߰[$EĚ[193]] = array($EĚ[326], array($dя[$EĚ[703]], $e׆ۉ)); } if ($dя[$EĚ[39]]) { $C얥߰[$dя[$EĚ[39]]] = 1; } else { $C얥߰[] = array($EĚ[451] => array($EĚ[921], 0), $EĚ[453] => array($EĚ[921], 0), $EĚ[2185] => $EĚ[2154]); } if ($dя[$EĚ[2150]]) { $C얥߰[] = array($EĚ[448] => $dя[$EĚ[2150]], $EĚ[1320] => array($EĚ[752], "\x25{$dя[$EĚ[2150]]}\45"), $EĚ[2185] => $EĚ[2154]); } goto B݆; Dݦ㸉: $EĚ =& $_SERVER[ȦÆ]; $C얥߰ = array(); if ($dя[$EĚ[1412]]) { $C얥߰[$EĚ[1412]] = $dя[$EĚ[1412]]; } goto E옆; Eٟ: return $f˙Ć; goto bܳ; B݆: $f˙Ć = $this->_makeOrder()->where($C얥߰)->selectPage(20); if (empty($f˙Ć[$EĚ[359]])) { return array(); } $this->_listDataApply($f˙Ć[$EĚ[359]]); goto Eٟ; bܳ: } public function listDataApply($A㙱) { $this->_listDataApply($A㙱); return $A㙱; } private function _listDataApply(&$F򘲙) { $e =& $_SERVER[ȦÆ]; $c = array_to_keyvalue($F򘲙, $e[43], $e[1412]); $d춒ߤ = Model($e[482])->userListInfo(array_unique($c)); $cд = array_to_keyvalue($F򘲙, $e[43], $e[374]); $A = Model($e[753])->sourceListInfo($cд, !0); foreach ($F򘲙 as &$C) { $fҽݎ = $C[$e[1412]]; $C[$e[2211]] = $d춒ߤ[$fҽݎ] ? $d춒ߤ[$fҽݎ] : !1; $C = $C[$e[374]]; $C[$e[396]] = $A[$C] ? $A[$C] : !1; } } private function _makeOrder($bђ넳 = '') { goto dܬ; C͸Ѽ: $b = Input::get($cϖ[412], $cϖ[17], $cϖ[394], $fկ); $dק = Input::get($cϖ[413], $cϖ[17], $cϖ[2212], array($cϖ[2149], $cϖ[409])); $dק = $F[$dק]; goto aϝ; aϝ: $bђ넳 = $bђ넳 . "{$b}\x20{$dק}"; return $this->order($bђ넳); goto A; dܬ: $cϖ =& $_SERVER[ȦÆ]; $fկ = array($cϖ[193], $cϖ[704], $cϖ[2197], $cϖ[2198]); $F = array($cϖ[407] => $cϖ[408], $cϖ[409] => $cϖ[410]); goto C͸Ѽ; A: } public function reportAdd($Cǰڙ) { $AϤ =& $_SERVER[ȦÆ]; $C⳦ = array($AϤ[446] => $Cǰڙ[$AϤ[446]], $AϤ[1412] => USER_ID); if (Model($AϤ[2208])->where($C⳦)->find()) { return !1; } $C = array($AϤ[446] => $Cǰڙ[$AϤ[446]], $AϤ[1320] => $Cǰڙ[$AϤ[1320]], $AϤ[374] => $Cǰڙ[$AϤ[374]], $AϤ[424] => $Cǰڙ[$AϤ[424]], $AϤ[1412] => USER_ID, $AϤ[39] => $Cǰڙ[$AϤ[39]], $AϤ[410] => $Cǰڙ[$AϤ[410]]); return Model($AϤ[2208])->add($C); } public function reportList($aЌ) { goto F󺒰; F󺒰: $b =& $_SERVER[ȦÆ]; $E۹ = array(); if ($aЌ[$b[703]]) { $aۓ = $aЌ[$b[704]] ? $aЌ[$b[704]] : strtotime(date($b[2210])); $E۹[$b[193]] = array($b[326], array($aЌ[$b[703]], $aۓ)); } goto aԔֽ; aԔֽ: if (isset($aЌ[$b[39]]) && in_array($aЌ[$b[39]], array($b[93], $b[2213], $b[2214], $b[2215], $b[1890]))) { $E۹[$b[39]] = $aЌ[$b[39]]; } if (isset($aЌ[$b[690]]) && in_array($aЌ[$b[690]], array($b[473], $b[93], $b[2213], $b[2214]))) { $E۹[$b[690]] = $aЌ[$b[690]]; } $aς = Input::get($b[413], $b[17], $b[2212], array($b[2149], $b[409])); goto f܊; f܊: $C = array($b[407] => $b[408], $b[409] => $b[410]); $c = $b[2216] . $C[$aς]; $eއ̣ = Model($b[2208])->where($E۹)->order($c)->selectPage(20); goto A١; A١: if (empty($eއ̣[$b[359]])) { return array(); } $this->_listDataApply($eއ̣[$b[359]]); return $eއ̣; goto Bč; Bč: } public function reportStatus($F) { goto b޲; Cͦ: if (!$F) { return !1; } $aӄ = array($FА[690] => $F[$FА[690]]); if ($F[$FА[690]] == $FА[2214] && $F[$FА[690]] == $FА[2214]) { $aӄ[$FА[690]] = 0; } goto Dø; Aƃǅ: return $F; goto d; Dø: $F = Model($FА[2208])->where($Aω)->save($aӄ); if ($F[$FА[690]] == $FА[2213]) { if ($F[$FА[424]] != $FА[473] && $this->shareFileMeta($F[$FА[424]])) { $this->shareFileMeta($F[$FА[424]], 0); } $this->remove($F[$FА[446]]); return !0; } if ($F && $F[$FА[690]] == $FА[2214]) { $A߃ = $aӄ[$FА[690]] == $FА[2214] ? 1 : 0; $this->shareFileMeta($F[$FА[424]], $A߃); $this->removeByFile($F[$FА[424]]); } goto Aƃǅ; b޲: $FА =& $_SERVER[ȦÆ]; $Aω = array($FА[372] => $F[$FА[372]]); $F = Model($FА[2208])->where($Aω)->field($FА[2217])->find(); goto Cͦ; d: } private function removeByFile($A) { goto c䠪; DȮ: $aڑ = array_to_keyvalue($Cٌ, $CΑ︃[43], $CΑ︃[446]); $this->remove($aڑ); goto A̫뽯; c䠪: $CΑ︃ =& $_SERVER[ȦÆ]; $Cٌ = Model($CΑ︃[753])->where(array($CΑ︃[424] => $A))->field($CΑ︃[374])->select(); $e톉 = array_to_keyvalue($Cٌ, $CΑ︃[43], $CΑ︃[374]); goto Fэʅә; Fэʅә: $D¦ = array($CΑ︃[374] => array($CΑ︃[17], $e톉), $CΑ︃[451] => 1); $Cٌ = Model($CΑ︃[2051])->where($D¦)->field($CΑ︃[446])->select(); if (empty($Cٌ)) { return; } goto DȮ; A̫뽯: } private function shareFileMeta($E, $Aʹ❛ = null) { $F =& $_SERVER[ȦÆ]; $e = array($F[424] => $E, $F[99] => $F[2218]); if (is_null($Aʹ❛)) { return Model($F[2219])->where($e)->find(); } $e[$F[364]] = $Aʹ❛; Model($F[2219])->add($e, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\x63\145\137\141\x75\x74\150"; public function getAuth($CΑڮ) { goto Cȳ; Cȳ: $A =& $_SERVER[ȦÆ]; $B = $A[2220]; $C˕͙ = array($A[374] => $CΑڮ); goto Dʇ; Dʇ: $c˜ = $this->field($B)->order($A[372])->where($C˕͙)->select(); $Cז = array(); foreach ($c˜ as $eۆ) { if (Model($A[2221])->listData($eۆ[$A[2202]])) { $Cז[] = $eۆ; } } goto e֭; e֭: return $Cז; goto F젶; F젶: } public function setAuth($Cщڅ, $fݚϛ) { goto aу; eõ: $f = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Dă = array(); foreach ($fݚϛ as $Fڅ龚) { if (!in_array($Fڅ龚[$E[376]], $f)) { show_json(LNG($E[2222]), !1); } if ($B菳 != $B) { if ($Fڅ龚[$E[376]] == SourceModel::TYPE_GROUP) { } if ($Fڅ龚[$E[461]] != 0 && !in_array($Fڅ龚[$E[461]], $Eݴ)) { } } if ($Fڅ龚[$E[461]] == 0) { $Fڅ龚[$E[376]] = SourceModel::TYPE_USER; } $Dă[] = array($E[374] => $Cщڅ, $E[376] => intval($Fڅ龚[$E[376]]), $E[461] => intval($Fڅ龚[$E[461]]), $E[2202] => intval($Fڅ龚[$E[2202]]) ? intval($Fڅ龚[$E[2202]]) : 0, $E[2203] => intval($Fڅ龚[$E[2203]]) ? intval($Fڅ龚[$E[2203]]) : -1); } goto e; aŭ: $B = 1; $B菳 = $Aߥ[$E[461]]; if ($B菳 != $B) { $cލ = array($E[2074] => $B菳); $Eݴ = Model($E[2148])->field($E[1412])->where($cލ)->select(); $Eݴ = array_to_keyvalue($Eݴ, $E[43], $E[1412]); } goto eõ; aу: $E =& $_SERVER[ȦÆ]; $Aߥ = Model($E[1103])->sourceInfo($Cщڅ); if ($Aߥ[$E[376]] != SourceModel::TYPE_GROUP) { return !1; } goto aŭ; e: $this->where(array($E[388] => $Cщڅ))->delete(); $this->addAll($Dă); return !0; goto Fшɟ; Fшɟ: } public function authClear($c) { $aڮ =& $_SERVER[ȦÆ]; $Dʴ = Model($aڮ[1103])->sourceInfo($c); $aĔꬳ = array($c); if ($Dʴ[$aڮ[375]] == $aڮ[93]) { $Cִ = array($aڮ[530] => array($aڮ[488], $Dʴ[$aڮ[464]] . $c . $aڮ[489])); $aĔꬳ = Model($aڮ[1103])->field($aڮ[388])->where($Cִ)->getField($aڮ[374], !0); $aĔꬳ[] = $c; } $this->where(array($aڮ[388] => array($aڮ[389], $aĔꬳ)))->delete(); return !0; } public function get($D) { $fː = $this->getSourceList(array($D), !0); return $fː[0]; } public function getSourceList($b, $c = false) { goto bȪ; EƏ: $F̤ = array($eÜՌ[388] => array($eÜՌ[389], $F󍋰)); $eȺõ = $this->field($A譎)->where($F̤)->select(); $eȺõ = array_to_keyvalue_group($eȺõ, $eÜՌ[374]); goto Fړσ; bȪ: $eÜՌ =& $_SERVER[ȦÆ]; if (!$b) { return array(); } $cÄˌ = Model($eÜՌ[1103]); goto Bɂ; Fړσ: $DÃ = array(); foreach ($c as $FԊ => $a܋) { $DÃ[$FԊ] = $this->makeSourceAuth($a܋, $eȺõ); } return $DÃ; goto eѢ; fᾎ: $F󍋰 = array_values(array_unique($F󍋰)); if (!$F󍋰) { return array(); } $A譎 = $eÜՌ[2224]; goto EƏ; Bɂ: if (!$c) { $F̤ = array($eÜՌ[388] => array($eÜՌ[389], $b)); $c = $cÄˌ->field($eÜՌ[2223])->where($F̤)->select(); $c = array_to_keyvalue($c, $eÜՌ[374]); } $F󍋰 = $b; foreach ($c as $A܌ => $Fי) { $Cɟ = $cÄˌ->parentLevelArray($Fי[$eÜՌ[464]]); $F󍋰 = array_merge($F󍋰, $Cɟ, array($A܌)); } goto fᾎ; eѢ: } public function authDeepCheck($F, $AΏ֥ = false) { $d든 =& $_SERVER[ȦÆ]; if (_get($GLOBALS, $d든[462])) { return !1; } $c֟ = $this->makeAuthDeep(); if (!in_array($F, $c֟)) { return !1; } return array($d든[382] => -1, $d든[423] => array($d든[390] => $d든[1024], $d든[2080] => $d든[473], $d든[391] => LNG($d든[2225]), $d든[2092] => $d든[2226]), $d든[2227] => array($d든[393] => $d든[2228], $d든[85] => $F)); } protected function makeAuthDeep() { goto b˹; fჇ: $fɄ = array_values(array_unique($fɄ)); foreach ($fɄ as $Fׅ) { $a߈ = $c󰍢->getInfo($Fׅ); $fͱ[] = $a߈[$cߟ[396]][$cߟ[374]]; } $fͱ = array_values(array_unique($fͱ)); goto fճ; F񗰭֣: $fɄ = array_values(array_unique($fɄ)); $e = $fɄ; foreach ($e as $Fׅ) { $a߈ = $c󰍢->getInfo($Fׅ); $F = $E߉->parentLevelArray($a߈[$cߟ[464]]); $fɄ = array_merge($fɄ, $F); } goto fჇ; F: $Bݢ = Model($cߟ[2229])->listData(); $C = array(); foreach ($Bݢ as $fӠ) { if ($fӠ[$cߟ[381]] == 0 && $fӠ[$cߟ[2094]] == $cߟ[93]) { $C[] = $fӠ[$cߟ[372]]; } } goto bԋ; b˹: $cߟ =& $_SERVER[ȦÆ]; static $fͱ = false; if ($fͱ) { return $fͱ; } goto F; FŎ: $E߉ = Model($cߟ[1103]); $c󰍢 = Model($cߟ[463]); if ($dۤ) { $B = $E߉->where(array($cߟ[374] => array($cߟ[389], $dۤ)))->select(); foreach ($B as $eڡ) { $F = $E߉->parentLevelArray($eڡ[$cߟ[464]]); $fͱ = array_merge($fͱ, $F); $fɄ[] = $eڡ[$cߟ[461]]; } } goto F񗰭֣; bԋ: $AϞ֒ = Session::get($cߟ[2186]); $AϞ֒ = array_to_keyvalue($AϞ֒, $cߟ[43], $cߟ[2074]); $D = array($cߟ[376] => SourceModel::TYPE_USER, $cߟ[461] => USER_ID); goto cۘӋ; cۘӋ: if ($AϞ֒) { $D = array(array($cߟ[376] => SourceModel::TYPE_USER, $cߟ[461] => USER_ID), array($cߟ[376] => SourceModel::TYPE_GROUP, $cߟ[461] => array($cߟ[389], $AϞ֒)), $cߟ[909] => $cߟ[2154]); } if ($C) { $D = array($D, $cߟ[2202] => array($cߟ[2230], $C)); } $c؊ = $this->field($cߟ[2231])->where($D)->select(); goto b٧蹳; fճ: return $fͱ; goto A; b٧蹳: $dۤ = array_to_keyvalue($c؊, $cߟ[43], $cߟ[374]); $fͱ = array(); $fɄ = $AϞ֒; goto FŎ; A: } private function makeSourceAuth($B֨, $eպ) { goto C; a: if (!$fڭʍ && $B֨[$C[376]] == SourceModel::TYPE_GROUP) { $E = Model($C[463])->getInfo($B֨[$C[461]]); $a = explode($C[57], trim($e[$C[464]], $C[57])); foreach ($a as $Aۍ) { if ($Aۍ == $C[473] || $Aۍ == $f㈏؄) { continue; } if (!isset($C[$Aۍ])) { continue; } $b = $C[$Aۍ]; $fڭʍ = array($C[2232] => intval($b[$C[381]][$C[381]]), $C[2233] => $b[$C[381]], $C[2227] => array($C[393] => $C[2236], $C[2237] => $E[$C[396]][$C[374]], $C[2235] => $E[$C[468]])); break; } } if ((!$fڭʍ || $fڭʍ[$C[382]] <= 0) && $B֨[$C[376]] == SourceModel::TYPE_GROUP) { $c = $this->authDeepCheck($B֨[$C[374]], $fڭʍ); if ($c) { $fڭʍ = $c; } } return $fڭʍ; goto c; Aɏ: $f㈏؄ = $C[93]; $CЃ = Model($C[1103])->parentLevelArray($B֨[$C[464]]); $CЃ = array_merge(array($B֨[$C[374]]), array_reverse($CЃ)); goto E諻; E諻: $fڭʍ = !1; foreach ($CЃ as $fѾ) { if (!isset($eպ[$fѾ])) { continue; } $f옦ŉ = $this->authMake($eպ[$fѾ]); if ($f옦ŉ[$C[423]]) { $fڭʍ = $f옦ŉ; break; } } if (!$fڭʍ && $B֨[$C[376]] == SourceModel::TYPE_GROUP) { $Aۍ = $B֨[$C[461]]; if (isset($C[$Aۍ])) { $b = $C[$Aۍ]; $E = Model($C[463])->getInfo($Aۍ); $fڭʍ = array($C[2232] => intval($b[$C[381]][$C[381]]), $C[2233] => $b[$C[381]], $C[2227] => array($C[393] => $C[2234], $C[85] => $E[$C[396]][$C[374]], $C[2235] => $E[$C[468]])); } } goto a; C: $C =& $_SERVER[ȦÆ]; $C = Session::get($C[2186]); $C = array_to_keyvalue($C, $C[2074]); goto Aɏ; c: } public function authOwnerApply($cО) { goto E; f髽: $cО[$F಺[381]][$F಺[2240]] = Model($F಺[479])->userListInfo($B); return $cО; goto F¸; c: $D = Model($F಺[1103])->parentLevelArray($cО[$F಺[464]]); $D = array_merge(array($cО[$F಺[374]]), array_reverse($D)); $b֖ǔ = $F಺[2224]; goto Eɟْ; eة: $dۍ̇ = array(); $B = array(); foreach ($E̲ as $c爂 => $FތƔ) { $eϑζ = $this->authFolderOwnerUser($FތƔ); $dۍ̇[$c爂] = $eϑζ; $B = array_merge($B, $eϑζ[$F಺[540]]); if ($eϑζ[$F಺[2239]]) { break; } } goto B; E: $F಺ =& $_SERVER[ȦÆ]; if (empty($cО[$F಺[381]]) || isset($cО[$F಺[2238]]) && $cО[$F಺[2238]]) { return $cО; } if (AuthModel::authCheckRoot($cО[$F಺[381]][$F಺[382]])) { return $cО; } goto c; Eɟْ: $C = array($F಺[388] => array($F಺[389], $D)); $E̲ = $this->field($b֖ǔ)->where($C)->select(); $E̲ = array_to_keyvalue_group($E̲, $F಺[374]); goto eة; B: if (count($B) == 0) { $B = $this->authFolderOwnerGroup($cО[$F಺[461]]); } $B = array_unique($B); if (AuthModel::authCheckRoot($cО[$F಺[381]][$F಺[382]])) { $B[] = USER_ID; } goto f髽; F¸: } private function authFolderOwnerGroup($Aʦ֝) { $b =& $_SERVER[ȦÆ]; $a = Model($b[2148])->where(array($b[2074] => $Aʦ֝))->select(); $F纗˙ = array(); if (!$a) { return $F纗˙; } foreach ($a as $b) { $aυ = $this->authInfo($b); if (AuthModel::authCheckRoot($aυ[$b[381]])) { $F纗˙[] = $b[$b[1412]]; } } return $F纗˙; } private function authFolderOwnerUser($aŎ) { $Eޥɖ =& $_SERVER[ȦÆ]; $AӍ = array(); $CȊ = !1; foreach ($aŎ as $C֏Ԑ) { $aԇ = $this->authInfo($C֏Ԑ); if ($C֏Ԑ[$Eޥɖ[461]] == $Eޥɖ[473]) { $CȊ = !0; } if ($C֏Ԑ[$Eޥɖ[376]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($aԇ[$Eޥɖ[381]])) { $AӍ[] = $C֏Ԑ[$Eޥɖ[461]]; } } } return array($Eޥɖ[540] => $AӍ, $Eޥɖ[2239] => $CȊ); } public function authMake($aڎ) { goto b; a݆܉: $c걯 = array($FҲ챫[2232] => intval($bϙ), $FҲ챫[2233] => $D嗇ޝ, $FҲ챫[2227] => array($FҲ챫[393] => $c򼳄, $FҲ챫[85] => $C䑘[$FҲ챫[374]])); return $c걯; goto dѥ; b: $FҲ챫 =& $_SERVER[ȦÆ]; if (!$aڎ) { return array($FҲ챫[382] => 0, $FҲ챫[423] => !1); } $Bĳ = Session::get($FҲ챫[2186]); goto CƄ; F: $D߱ = 0; $C = 0; $d̿ = 0; goto Fԩȅ; Aِ: $e = 0; $C䑘 = array($FҲ챫[374] => 0); foreach ($aڎ as $C䑘) { $D嗇ޝ = $this->authInfo($C䑘); $eق = $C䑘[$FҲ챫[461]]; $f픈 = intval($D嗇ޝ[$FҲ챫[381]]); if ($C䑘[$FҲ챫[376]] == SourceModel::TYPE_USER && $eق == USER_ID) { $Bʛ = !0; $C = $D嗇ޝ; $cՇȏ = $f픈; } else { if ($C䑘[$FҲ챫[376]] == SourceModel::TYPE_GROUP && in_array($eق, $E)) { $FóΝ = !0; if ($f픈 >= $E؄ɖ) { $E؄ɖ = $f픈; $d̿ = $D嗇ޝ; } } else { if ($eق == $FҲ챫[473]) { $e = !0; $dټ = $D嗇ޝ; $D߱ = $f픈; } } } } goto c۴ɇ; c۴ɇ: $bϙ = $Bʛ ? $cՇȏ : ($FóΝ ? $E؄ɖ : $D߱); $D嗇ޝ = $Bʛ ? $C : ($FóΝ ? $d̿ : $dټ); $c򼳄 = $Bʛ ? $FҲ챫[2241] : ($FóΝ ? $FҲ챫[2242] : ($e ? $FҲ챫[2243] : $FҲ챫[366])); goto a݆܉; CƄ: $E = array_to_keyvalue($Bĳ, $FҲ챫[43], $FҲ챫[2074]); $cՇȏ = 0; $E؄ɖ = 0; goto F; Fԩȅ: $dټ = 0; $Bʛ = 0; $FóΝ = 0; goto Aِ; dѥ: } public function authTargetInfoMake($F) { goto Bݶ; Dޝ: return array($EĘ[2244] => $a˾, $EĘ[2235] => $a؃); goto fŅՃ; B: foreach ($F as $d洳늅) { if ($d洳늅[$EĘ[376]] == SourceModel::TYPE_USER) { $a˾[] = intval($d洳늅[$EĘ[461]]); } else { if ($d洳늅[$EĘ[376]] == SourceModel::TYPE_GROUP) { $a؃[] = intval($d洳늅[$EĘ[461]]); } } } if ($a˾) { $a˾ = Model($EĘ[479])->userListInfo($a˾); } if ($a؃) { $fŬ = array($EĘ[2146] => array($EĘ[389], $a؃)); $a؃ = Model($EĘ[463])->field($EĘ[2159])->where($fŬ)->select(); $a؃ = array_to_keyvalue($a؃, $EĘ[2074]); } goto Dޝ; Bݶ: $EĘ =& $_SERVER[ȦÆ]; $a˾ = array(); $a؃ = array(); goto B; fŅՃ: } private function authInfo($c񶋕) { $fȹ =& $_SERVER[ȦÆ]; if ($c񶋕[$fȹ[2202]]) { $D秉 = Model($fȹ[2221])->listData($c񶋕[$fȹ[2202]]); if (!$D秉) { return !1; $aʼ = Model($fȹ[2221])->listData(); $Dٟ = array_filter_by_field($aʼ, $fȹ[381], $fȹ[473]); return $Dٟ; } $B̔ = array_field_key($D秉, array($fȹ[372], $fȹ[38], $fȹ[381], $fȹ[2092], $fȹ[2095])); $B̔[$fȹ[2245]] = $c񶋕; return $B̔; } else { return array($fȹ[390] => 0, $fȹ[2080] => $c񶋕[$fȹ[2203]], $fȹ[391] => $fȹ[43], $fȹ[2092] => $fȹ[2246]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\x72\143\145\x5f\145\x76\x65\156\x74"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\x69\155\x65", "\164\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\146\165\156\143\x74\151\157\156"), array("\144\145\163\143", '', "\151\x6e\163\145\x72\x74\54\x75\x70\144\141\x74\145\54\163\x65\x6c\145\x63\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($B, $fʴ, $E׊ = '') { goto f; f: $D׹釶 =& $_SERVER[ȦÆ]; if (!$this->eventSave) { return; } $dѣ = Model($D׹釶[1103])->sourceInfo($B); goto b; d: $bڰ = array($D׹釶[388] => $B, $D׹釶[2247] => $dѣ[$D׹釶[466]], $D׹釶[2248] => $dѣ[$D׹釶[38]], $D׹釶[471] => $dѣ[$D׹釶[471]], $D׹釶[1403] => USER_ID, $D׹釶[393] => $fʴ, $D׹釶[1405] => $E׊); $this->addSystemLog($fʴ, $bڰ); return $this->add($bڰ); goto EՐΎ; b: if (!$dѣ) { return !1; } if ($this->isCacheEvent($dѣ, $fʴ)) { return; } if ($E׊ && is_string($E׊)) { $E׊ = array($D׹釶[2104] => $E׊); } goto d; EՐΎ: } private function addSystemLog($bʇ, $C) { $A =& $_SERVER[ȦÆ]; if ($bʇ == $A[2249]) { $bʇ = $C[$A[410]][$A[2250]]; } else { if (in_array($bʇ, array($A[2051], $A[2251]))) { $bʇ = $C[$A[410]][$A[693]]; } } $E˪ = array_merge($C, array($A[2252] => $C[$A[374]], $A[2253] => $C[$A[2253]])); Model($A[2015])->addLog($A[2254] . $bʇ, $E˪); } private function isCacheEvent($Dًф, $FǇ) { if ($Dًф[$_SERVER[ȦÆ][376]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($f, $c㵩) { $e =& $_SERVER[ȦÆ]; $F = Model($e[1103])->sourceInfo($f); $c = array($e[2250] => $c㵩, $e[38] => $F[$e[38]]); return $this->addEvent($f, $e[2249], $c); } public function eventFileEdit($a) { $d =& $_SERVER[ȦÆ]; $Cӓ = array($d[2255] => $_SERVER[$d[2256]], $d[1721] => strtolower(ACTION)); return $this->addEvent($a, $d[2042], $Cӓ); } public function eventRecycle($B՞, $AΠ땍) { return $this->addEvent($B՞, $_SERVER[ȦÆ][2251], $AΠ땍); } public function eventRemove($D׏) { $Cʽ =& $_SERVER[ȦÆ]; $f؈ = Model($Cʽ[1103])->sourceInfo($D׏); $d = $f؈[$Cʽ[38]]; return $this->addEvent($f؈[$Cʽ[466]], $Cʽ[2041], $d); } public function eventShare($e, $Cꃃ) { return $this->addEvent($e, $_SERVER[ȦÆ][2051], $Cꃃ); } public function eventMove($C䮥ټ, $cڢ, $dΘۨ) { goto d𢇄; B탆ڊ: $c憇 = $a->sourceInfo($cڢ); $a梳 = $a->sourceInfo($dΘۨ); $bǮ = array($EΦک[999] => $cڢ, $EΦک[2257] => $c憇[$EΦک[38]], $EΦک[2258] => $c憇[$EΦک[471]], $EΦک[1000] => $dΘۨ, $EΦک[2259] => $a梳[$EΦک[38]], $EΦک[2260] => $a梳[$EΦک[471]]); goto dᅂ; d𢇄: $EΦک =& $_SERVER[ȦÆ]; $a = Model($EΦک[1103]); $F趡 = $a->sourceInfo($C䮥ټ); goto B탆ڊ; dᅂ: $this->addEvent($C䮥ټ, $EΦک[497], $bǮ); $F趡 = $a->sourceInfo($C䮥ټ); $bǮ = array($EΦک[374] => $F趡[$EΦک[374]], $EΦک[38] => $F趡[$EΦک[38]]); goto Aӟ; Aӟ: $this->addEvent($cڢ, $EΦک[2261], $bǮ); goto Eߌ; Eߌ: } public function eventCopy($d⡅) { $this->eventCreate($d⡅, $_SERVER[ȦÆ][495]); } public function eventRename($C, $E, $DƷ) { $b͹ =& $_SERVER[ȦÆ]; $Cۂ霉 = array($b͹[999] => $E, $b͹[1000] => $DƷ); return $this->addEvent($C, $b͹[1115], $Cۂ霉); } public function eventAddComment($Aߢ𔝸, $F܎) { return $this->addEvent($Aߢ𔝸, $_SERVER[ȦÆ][2262], $F܎); } public function eventAddDesc($AɈ, $d配) { return $this->addEvent($AɈ, $_SERVER[ȦÆ][2263], $d配); } public function listBySource($b覶) { goto aߋ; bΗ: $Bæ = $this->eventListParse($Bæ, $b覶); show_json($Bæ); goto Dƕ; D٣Ş: if ($CΏǎ[$bԏ߲[375]] == $bԏ߲[93]) { $cՊ = Model($bԏ߲[1103])->listSearchChildren($b覶, 20000); $cՊ[] = $b覶 . $bԏ߲[366]; $f = array($bԏ߲[374] => array($bԏ߲[17], $cՊ)); } $Bæ = $this->where($f)->order($bԏ߲[2264])->selectPage(); if ($Bæ[$bԏ߲[356]][$bԏ߲[357]] == 0) { $Bæ[$bԏ߲[356]][$bԏ߲[357]] = 1; $Bæ[$bԏ߲[359]] = array(array($bԏ߲[388] => $b覶, $bԏ߲[2247] => $CΏǎ[$bԏ߲[466]], $bԏ߲[1403] => $CΏǎ[$bԏ߲[383]], $bԏ߲[393] => $bԏ߲[2265], $bԏ߲[394] => $CΏǎ[$bԏ߲[193]], $bԏ߲[1405] => $bԏ߲[43])); } goto bΗ; aߋ: $bԏ߲ =& $_SERVER[ȦÆ]; $CΏǎ = Model($bԏ߲[1103])->sourceInfo($b覶); $f = array($bԏ߲[388] => $b覶); goto D٣Ş; Dƕ: } private function eventListParse($a߾Һ, $e) { goto C᷂; c: $e = array_unique($e); $C = array_unique(array_to_keyvalue($fߜ, $E̴[43], $E̴[1412])); $dˎ݅ = Model($E̴[482])->userListInfo($C); goto dҴ; aٳȥ: return $a߾Һ; goto bλҚ; E啃͵: $e = array_to_keyvalue($fߜ, $E̴[43], $E̴[2253]); foreach ($fߜ as $e꣒) { $e = $e꣒[$E̴[410]]; if ($e꣒[$E̴[39]] == $E̴[497] && isset($e[$E̴[999]])) { $e[] = $e[$E̴[999]] . $E̴[43]; $e[] = $e[$E̴[1000]] . $E̴[43]; } if ($e꣒[$E̴[39]] == $E̴[2261] && isset($e[$E̴[374]])) { $e[] = $e[$E̴[374]] . $E̴[43]; } } $e = array_merge($e, $e, array($e . $E̴[43])); goto c; dҴ: $Aㅑل = Model($E̴[753])->sourceListInfo($e, !0); foreach ($fߜ as &$e꣒) { if ($e꣒[$E̴[39]] == $E̴[497] && isset($e꣒[$E̴[410]][$E̴[999]])) { $e꣒[$E̴[410]][$E̴[999]] = $Aㅑل[$e꣒[$E̴[410]][$E̴[999]]]; $e꣒[$E̴[410]][$E̴[1000]] = $Aㅑل[$e꣒[$E̴[410]][$E̴[1000]]]; } if ($e꣒[$E̴[39]] == $E̴[2261] && isset($e꣒[$E̴[410]][$E̴[374]])) { $e꣒[$E̴[410]][$E̴[374]] = $Aㅑل[$e꣒[$E̴[410]][$E̴[374]]]; } $e꣒[$E̴[396]] = $Aㅑل[$e꣒[$E̴[374]]]; $e꣒[$E̴[2266]] = $Aㅑل[$e꣒[$E̴[2253]]]; if ($e꣒[$E̴[39]] == $E̴[2041]) { $e꣒[$E̴[2266]] = $e꣒[$E̴[396]]; $e꣒[$E̴[2253]] = $e꣒[$E̴[2266]][$E̴[374]]; $e꣒[$E̴[396]] = !1; $e꣒[$E̴[374]] = $E̴[43]; } $e꣒[$E̴[2211]] = $dˎ݅[$e꣒[$E̴[1412]]]; } $a߾Һ[$E̴[359]] = $fߜ; goto aٳȥ; C᷂: $E̴ =& $_SERVER[ȦÆ]; $fߜ = $a߾Һ[$E̴[359]]; $e = array_to_keyvalue($fߜ, $E̴[43], $E̴[374]); goto E啃͵; bλҚ: } public function removeBySource($Aݗ) { $D↟᝜ = array($_SERVER[ȦÆ][388] => $Aݗ); $this->where($D↟᝜)->remove(); } } goto f; C: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\142\x61\143\153\165\x70\114\151\163\164"; public $field = array("\x69\x6f", "\156\141\x6d\x65", "\163\x74\141\164\165\163", "\143\x6f\156\x74\145\x6e\x74", "\x72\x65\x73\165\x6c\164", "\164\151\x6d\145\x46\162\157\155", "\164\151\x6d\x65\124\157"); public function config() { goto C; B叒ޘ: Action($C򹲾[2096])->taskInit(); $bƝɒ = Model($C򹲾[2097])->listData(); foreach ($bƝɒ as $e韆) { if ($e韆[$C򹲾[1073]] == $C򹲾[93] && $e韆[$C򹲾[1400]] == $C򹲾[2098]) { $eυ = $e韆; break; } } goto Aǡ߼; C: $C򹲾 =& $_SERVER[ȦÆ]; $B = Model($C򹲾[1081])->get($C򹲾[713]); $B = json_decode($B, !0); goto B; B: $B = is_array($B) ? $B : array(); if (!isset($B[$C򹲾[693]])) { $B[$C򹲾[693]] = $C򹲾[473]; } $eυ = array(); goto B叒ޘ; Aǡ߼: if (isset($eυ[$C򹲾[196]])) { $eυ[$C򹲾[196]] = json_decode($eυ[$C򹲾[196]], !0); } if (isset($B[$C򹲾[196]])) { $eυ[$C򹲾[196]][$C򹲾[1387]] = $B[$C򹲾[196]]; unset($B[$C򹲾[196]]); } return array_merge($eυ, $B); goto B; B: } public function listData($cǄ = false, $eܧ = "\x6d\157\x64\151\146\x79\124\x69\x6d\x65", $Cժ = false) { return parent::listData($cǄ, $eܧ, !0); } public function lastItem() { $Fͱ = $this->listData(); return !empty($Fͱ[0]) ? $Fͱ[0] : null; } public function kill($Eĝ) { goto e; f: return $this->remove($Eĝ); goto dƾԌ; e: $f픕 =& $_SERVER[ȦÆ]; $fć = $this->listData($Eĝ); if (!$fć || empty($fć[$f픕[38]])) { return !0; } goto A퇕; A퇕: Task::kill($f픕[712]); Task::kill($f픕[730]); Task::kill($f픕[737]); goto Dն; Dն: $aޣ = $fć[$f픕[38]]; $cֿӨ = TEMP_FILES . $f픕[711] . $aޣ . $f픕[18]; IO::remove($cֿӨ, !1); goto f; dƾԌ: } public function remove($D尫) { $Cۋ = $this->listData($D尫); if (!$Cۋ) { return !0; } return $this->backupRemove($Cۋ); } private function backupRemove($EƆי) { $e˳ =& $_SERVER[ȦÆ]; parent::remove($EƆי[$e˳[372]]); $e = "\x7b\x69\x6f\x3a{$EƆי[$e˳[692]]}\175\x2f\x64\141\x74\x61\142\x61\163\145\57\x62\141\x63\x6b\165\160\137" . $EƆי[$e˳[38]]; IO::remove($e, !1); return !0; } public function start() { goto dً; Aɇ: if (!$E䃟 || $E䃟[$Bͅ[1384]] != $Bͅ[93]) { return !1; } $Aې = $this->process(); foreach ($Aې as $C) { if ($C) { return Task::restart($C[$Bͅ[372]]); } } goto Dߞ; Dߞ: $e§ = new Backup(); $e§->keep(); if (!$e§->db()) { return !1; } goto bץ; Fҕ֏: return !0; goto Dǳ; dً: $Bͅ =& $_SERVER[ȦÆ]; if ($GLOBALS[$Bͅ[16]][$Bͅ[94]][$Bͅ[2099]] != $Bͅ[93]) { return !0; } $E䃟 = $this->config(); goto Aɇ; bץ: if (!$e§->dbFile()) { return !1; } if ($E䃟[$Bͅ[693]] == $Bͅ[473]) { $e§->file(); } Backup::set(array($Bͅ[690] => 1, $Bͅ[704] => time())); goto Fҕ֏; Dǳ: } public function process() { $aۚ =& $_SERVER[ȦÆ]; return array($aۚ[695] => Task::get($aۚ[712]), $aۚ[698] => Task::get($aۚ[730]), $aۚ[173] => Task::get($aۚ[737])); } public function restore() { $Fق =& $_SERVER[ȦÆ]; ActionCall($Fق[2100], !0, 1); ActionCall($Fق[2100], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\x65\x6e\x74"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\x61\155\x65" => "\143\x6f\155\155\x65\156\x74\137\155\145\x74\x61", "\x6d\145\x74\x61\106\x69\145\154\x64" => "\x63\x6f\155\x6d\145\156\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Eژ) { $F዗ =& $_SERVER[ȦÆ]; if ($Eژ[$F዗[2101]]) { $Bݺ߳ = $this->where(array($F዗[2102] => $Eژ[$F዗[2101]]))->find(); if (!$Bݺ߳ || $Bݺ߳[$F዗[376]] != $Eژ[$F዗[376]] || $Bݺ߳[$F዗[461]] != $Eژ[$F዗[461]]) { return !1; } $this->where(array($F዗[2102] => $Eژ[$F዗[2101]]))->setAdd($F዗[2103], 1); } return $this->add($Eژ); } public function remove($E) { $Fʥ =& $_SERVER[ȦÆ]; $B󆥄 = array($Fʥ[2102] => $E); $B = $this->where($B󆥄)->find(); if ($B[$Fʥ[2101]]) { $this->where(array($Fʥ[2102] => $B[$Fʥ[2101]]))->setAdd($Fʥ[2103], -1); } return $this->where($B󆥄)->delete(); } public function edit($Cϓ̜, $f) { $Dߧ =& $_SERVER[ȦÆ]; $F˵ڥ = array($Dߧ[2102] => $Cϓ̜); return $this->where($F˵ڥ)->save(array($Dߧ[2104] => $f)); } public function prasise($e֤) { $Cı =& $_SERVER[ȦÆ]; $Dʉ = Model($Cı[2105]); $F = array($Cı[2102] => $e֤, $Cı[1403] => USER_ID); $Bږ = $Dʉ->where($F)->find(); if (!$Bږ) { $Dʉ->add($F); $A옪 = $this->where(array($Cı[2102] => $e֤))->setAdd($Cı[2106], 1); } else { $Dʉ->where($F)->delete(); $A옪 = $this->where(array($Cı[2102] => $e֤))->setAdd($Cı[2106], -1); } return $A옪; } public function targetInfo($c箷, $dͮ) { goto A; Dʹҫ: $Aآ = "\x52\111\x47\x48\x54\40\x4a\117\111\x4e\40{$this->tablePrefix}\x63\157\155\x6d\x65\x6e\164\137\160\x72\141\x69\x73\145\40\x73\x74\x61\x72\40\157\x6e\40\143\157\155\155\x65\156\164\x2e\x63\157\155\155\145\156\x74\x49\x44\x20\x3d\40\x73\164\141\x72\x2e\143\x6f\155\x6d\145\156\x74\111\104"; $D = $this->alias($B۵[346])->where($F꺂楂)->join($Aآ, $B۵[2107])->count(); $cﲆ = array($B۵[2108] => $cղά, $B۵[2109] => $D); goto Bݕ; Bݕ: return $cﲆ; goto D; A: $B۵ =& $_SERVER[ȦÆ]; $F꺂楂 = array($B۵[526] => $c箷, $B۵[527] => $dͮ); $cղά = $this->where($F꺂楂)->count(); goto Dʹҫ; D: } public function listData($D) { $cԂ =& $_SERVER[ȦÆ]; if (isset($D[$cԂ[2110]])) { if ($D[$cԂ[2110]]) { $D[$cԂ[2111]] = array($cԂ[923], intval($D[$cԂ[2110]])); } unset($D[$cԂ[2110]]); } if (isset($D[$cԂ[2112]])) { if ($D[$cԂ[2112]]) { $D[$cԂ[2111]] = array($cԂ[920], intval($D[$cԂ[2112]])); } unset($D[$cԂ[2112]]); } return $this->_listData($D); } private function _listData($D۽) { $bĝ̙ =& $_SERVER[ȦÆ]; $D² = $this->where($D۽)->_makeOrder()->selectPage(100); $this->_listAppendParent($D²[$bĝ̙[359]]); $this->_listAppendUser($D²[$bĝ̙[359]]); $this->_listAppendMeta($D²[$bĝ̙[359]]); return $D²; } private function _makeOrder() { $a =& $_SERVER[ȦÆ]; $Bኅ = array($a[2106], $a[2103], $a[193]); $B = Input::get($a[412], $a[17], $a[394], $Bኅ); $Cē = Input::get($a[413], $a[17], $a[1405], array($a[2113], $a[410])); $fȡȘô = $B . $a[60] . $Cē; return $this->order($fȡȘô); } private function _listAppendParent(&$CǠ󹚷) { goto eڅ; Dʂ: foreach ($CǠ󹚷 as &$C) { if (isset($Cę݉[$C[$eՋ[2101]]])) { $C[$eՋ[2114]] = $Cę݉[$C[$eՋ[2101]]]; } } goto bĵ; eڅ: $eՋ =& $_SERVER[ȦÆ]; $bԆ = array_unique(array_to_keyvalue($CǠ󹚷, $eՋ[43], $eՋ[2101])); $bԆ = array_remove_value($bԆ, $eՋ[473]); goto F啿; F啿: if (!$bԆ) { return; } $Cę݉ = $this->where(array($eՋ[2102] => array($eՋ[17], $bԆ)))->select(); $Cę݉ = array_to_keyvalue($Cę݉, $eՋ[2111]); goto Dʂ; bĵ: } private function _listAppendUser(&$F򅊳) { goto C㢙; Aܜ: foreach ($F򅊳 as &$f) { $f[$F[540]] = $Dȳ[$f[$F[1412]]]; if (isset($f[$F[2114]])) { $f[$F[2114]][$F[540]] = $Dȳ[$f[$F[2114]][$F[1412]]]; } } goto c; C㢙: $F =& $_SERVER[ȦÆ]; $a֒ = array_unique(array_to_keyvalue($F򅊳, $F[43], $F[1412])); $a֒ = array_remove_value($a֒, $F[473]); goto E˘; E˘: if (count($a֒) == 0) { return; } foreach ($F򅊳 as $f) { if (isset($f[$F[2114]])) { $a֒[] = $f[$F[2114]][$F[1412]]; } } $Dȳ = Model($F[482])->userListInfo($a֒); goto Aܜ; c: } private function _listAppendMeta(&$fзˌ) { goto EϚ; Fۂ³: if (!$F۞ҋ) { return !1; } foreach ($fзˌ as &$F) { $F[$D[422]] = $F۞ҋ[$F[$D[2111]]]; if (isset($F[$D[2114]])) { $F[$D[2114]][$D[422]] = $F۞ҋ[$F[$D[2114]][$D[2111]]]; } } goto C; EϚ: $D =& $_SERVER[ȦÆ]; $c뻍 = array_unique(array_to_keyvalue($fзˌ, $D[43], $D[2111])); $c뻍 = array_remove_value($c뻍, $D[473]); goto e솘ݮ; e솘ݮ: if (!$c뻍) { return; } foreach ($fзˌ as $F) { if (isset($F[$D[2114]])) { $c뻍[] = $F[$D[2114]][$D[2111]]; } } $F۞ҋ = $this->metaList($c뻍); goto Fۂ³; C: } private function metaList($e˚) { goto D; C䔮: return $DЮ ? $DЮ : array(); goto d˔; D: $A =& $_SERVER[ȦÆ]; if (!$e˚) { return array(); } $b׽ = array($A[2111] => array($A[17], $e˚)); goto D˯ثü; D˯ثü: $DЮ = Model($A[2115])->where($b׽)->select(); $DЮ = array_to_keyvalue_group($DЮ, $A[2111]); foreach ($DЮ as $f´ => $Bɔт) { $eǖ = array(); foreach ($Bɔт as $f) { $eǖ[$f[$A[99]]] = $f[$A[364]]; } $DЮ[$f´] = $eǖ; } goto C䔮; d˔: } } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\x65"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\x61\x6d\x65" => "\151\157\x5f\146\x69\154\145\x5f\x6d\145\x74\x61", "\x6d\x65\164\141\106\151\145\154\144" => "\x66\151\x6c\x65\x49\104"); public function fileInfo($b܆) { $b냕˷ =& $_SERVER[ȦÆ]; static $D҅ = array(); if (!isset($D҅[$b܆])) { $DًϚȩ = $b냕˷[2116]; $B䧵 = Model($b냕˷[427])->field($DًϚȩ)->where(array($b냕˷[425] => $b܆))->find(); $D҅[$b܆] = $B䧵; } return $D҅[$b܆]; } public function addFileByContent($b܉ = '', $A׸ = '') { goto B·ʔ; a£ׅ: $b = $fѣ슮 . $Cԫƭ[2118] . rand_string(16); file_put_contents($b, $b܉); $CҤ = $this->addFile($b, $A׸, !0); goto Fޠ; Fޠ: if (file_exists($b)) { @unlink($b); } return $CҤ; goto d̂; B·ʔ: $Cԫƭ =& $_SERVER[ȦÆ]; $fѣ슮 = TEMP_PATH . $Cԫƭ[2117]; if (!is_dir($fѣ슮)) { mk_dir($fѣ슮); } goto a£ׅ; d̂: } public function createFileName($dðռ) { goto cʬí; cʬí: $d΅ =& $_SERVER[ȦÆ]; $bդߒ = IO::init($d΅[18]); $E݅ = $this->makeFilePath($dðռ, $bդߒ); goto B; B: $Dޏ = $bդߒ->pathFather($E݅); static $Fڧ = false; $aǾ = $d΅[2119] . md5($Dޏ); goto aƛ; aƛ: if (!$Fڧ && !Cache::get($aǾ)) { $Fڧ = !0; $a = IO::mkdir($Dޏ); if (!IO::exist($a . $d΅[2120])) { IO::mkfile($a . $d΅[2120]); } Cache::set($aǾ, 1, 3600 * 2); } return $E݅; goto CӲ; CӲ: } public function makeFilePath($bԒ, $A݇) { goto bƥ; bƥ: $cᑚ =& $_SERVER[ȦÆ]; $bܖ = Model($cᑚ[1081])->get($cᑚ[2121]); $d = KodIO::defaultIO() . date($cᑚ[2122]); goto a锟; f: switch ($bܖ) { case $cᑚ[2124]: $eٽ¨ = $eٽ¨ . $cᑚ[101] . $A݇->ext($bԒ); if ($A݇->ext($bԒ) == $cᑚ[2064]) { $eٽ¨ .= $cᑚ[2125]; } break; case $cᑚ[2126]: goto d󬟳; a϶: break; goto bޝ; d󬟳: $b = Model($cᑚ[1081])->get($cᑚ[1313]); $B = substr(md5($cᑚ[1884] . $b . date($cᑚ[688])), 0, 8); $d = KodIO::defaultIO() . date($cᑚ[2127]) . $B . $cᑚ[18]; goto FǶד; FǶד: if ($A݇->ext($bԒ) == $cᑚ[2064]) { $bԒ .= $cᑚ[2125]; } $EŎɏ = IO::fileNameAuto($d, $bԒ); $eٽ¨ = $d . $EŎɏ; goto a϶; bޝ: case $cᑚ[2123]: break; default: break; } return $eٽ¨; goto D; a锟: $eٽ¨ = $d . rand_string(5) . short_id(100); $bԒ = str_replace($cᑚ[18], $cᑚ[80], KodIO::clear($bԒ)); if (!$bԒ) { $bܖ = $cᑚ[2123]; } goto f; D: } public function addFileByRemote($B, $fʤ, $A = array()) { goto Dʝ; B: if ($e = $this->addFileCheckExist($aҖ[$cЬ[170]], $aҖ[$cЬ[169]], $aҖ[$cЬ[87]])) { return $e; } return $this->addFileData($aҖ); goto bې; cҒ: $Dۋ = IO::hashMd5($B, $A৵); $f = KodIO::defaultDriver(); $aҖ = array($cЬ[525] => IO::size($B), $cЬ[2128] => 1, $cЬ[391] => $fʤ, $cЬ[736] => $f[$cЬ[372]], $cЬ[392] => $B, $cЬ[2129] => $A[$cЬ[170]] ? $A[$cЬ[170]] : IO::hashSimple($B), $cЬ[2130] => $Dۋ ? $Dۋ : $A৵); goto B; Dʝ: $cЬ =& $_SERVER[ȦÆ]; if (!IO::exist($B)) { return !1; } $A৵ = $A[$cЬ[169]] ? $A[$cЬ[169]] : $cЬ[43]; goto cҒ; bې: } private function addFileData($e֕) { $aōؑ =& $_SERVER[ȦÆ]; if (!$e֕) { return !1; } $e֕[$aōؑ[87]] = intval($e֕[$aōؑ[87]]); if (!$e֕[$aōؑ[87]] && strlen($e֕[$aōؑ[170]]) > 32) { $e֕[$aōؑ[87]] = intval(substr($e֕[$aōؑ[170]], 32)); } $cӄ = $this->add($e֕); return $this->find($cӄ); } public function addFile($bب, $D䪅, $C񴈔ܕ = false) { $a = IO::hashSimple($bب); $d = IO::hashMd5($bب); $C𬹙 = IO::size($bب); if ($fЪ = $this->addFileCheckExist($a, $d, $C𬹙)) { return $fЪ; } $Aڸ = $this->addFileMake($bب, $C𬹙, $a, $d, $D䪅, $C񴈔ܕ); return $this->addFileData($Aڸ); } public function addFileMake($fЧ, $eИ, $EҐ, $c抴ș, $c, $EԶ棔) { goto a֞; A޸Բ: $eƃ = KodIO::defaultDriver(); $e = array($BƸڵ[525] => $eИ, $BƸڵ[2128] => 1, $BƸڵ[391] => $c, $BƸڵ[736] => $eƃ[$BƸڵ[372]], $BƸڵ[392] => $dԧ, $BƸڵ[2129] => $EҐ, $BƸڵ[2130] => $c抴ș); return $e; goto d; a֞: $BƸڵ =& $_SERVER[ȦÆ]; $dԧ = $this->createFileName($c); $D = get_path_father($dԧ); goto F݊ݱ; F݊ݱ: $d = get_path_this($dԧ); if ($EԶ棔) { $fܲ = IO::move($fЧ, $D, !1, $d); } else { $fܲ = IO::copy($fЧ, $D, !1, $d); } if (!$fܲ) { return !1; } goto A޸Բ; d: } public function addFileCheckExist($C, $dߌ, $bɂ) { $c݊ =& $_SERVER[ȦÆ]; $Aа = $this->findByHash($C, $dߌ); if (!$Aа) { return !1; } $aΗÏ = array($c݊[2128] => intval($Aа[$c݊[2131]]) + 1, $c݊[525] => $bɂ); $this->where(array($c݊[425] => $Aа[$c݊[424]]))->save($aΗÏ); return $Aа; } public function remove($A˴䅪) { $this->linkCountChange($A˴䅪, !1); $this->clearEmpty(); return !0; } public function linkAdd($BӚ) { $this->linkCountChange($BӚ, !0); } public function linkCountChange($D嵰, $b) { goto Fƙ; Fƙ: $B֞ =& $_SERVER[ȦÆ]; if (!$D嵰) { return; } if (!is_array($D嵰)) { $D嵰 = array($D嵰); } goto A; A: $cʕĽ = array(); foreach ($D嵰 as $d) { $a = $d . $B֞[43]; if (!$cʕĽ[$a]) { $cʕĽ[$a] = 0; } $cʕĽ[$a]++; } $Eڨƴ = array(); goto aΆ; aΆ: foreach ($cʕĽ as $d => $Fޯ) { $a = $Fޯ . $B֞[43]; if (!$Eڨƴ[$a]) { $Eڨƴ[$a] = array(); } $Eڨƴ[$a][] = $d; } foreach ($Eڨƴ as $Fޯ => $F߈) { if (!$F߈) { continue; } $Fޯ = $b ? $Fޯ : -intval($Fޯ); $Fⵤ = array($B֞[424] => array($B֞[17], $F߈)); if ($Fޯ < 0) { $Fⵤ[$B֞[2131]] = array($B֞[924], abs($Fޯ)); } $this->where($Fⵤ)->setAdd($B֞[2131], $Fޯ); } goto E͜ѩ; E͜ѩ: } public function findByHash($c߳ȶ, $E͏ = false) { $Fǋ =& $_SERVER[ȦÆ]; if (!$c߳ȶ && !$E͏) { return !1; } $d؎ = array($Fǋ[2129] => $c߳ȶ); if ($E͏) { $d؎ = array($Fǋ[2130] => $E͏); } return $this->order($Fǋ[2132])->where($d؎)->find(); } public function clearEmpty($Eஅ = 0) { goto d; Fñ獹: foreach ($Bέ as $A) { $BӨ->update(1); $this->resetFile($A); } $BӨ->end(); goto aϐ; d: $D =& $_SERVER[ȦÆ]; $EؼȌ = time() - 3600 * 24 * $Eஅ; $A僉 = $D[2133] . $EؼȌ; goto B; B: $Bέ = $this->where($A僉)->select(); if (!$Bέ) { return; } $BӨ = new Task($D[2134], $D[43], count($Bέ)); goto Fñ獹; aϐ: } private function resetFile($e푓) { goto E; e򜒭: $fﰫߢ = Model($B׾[2135])->where($D)->count(); $B״Ź = intval($D) + intval($fﰫߢ); if ($B״Ź == 0) { IO::remove($e푓[$B׾[85]]); $this->where($D)->delete(); $this->metaSet($e푓[$B׾[424]], null, null); return; } goto cê; E: $B׾ =& $_SERVER[ȦÆ]; $D = array($B׾[425] => $e푓[$B׾[424]]); $D = Model($B׾[1103])->where($D)->count(); goto e򜒭; cê: if ($e푓[$B׾[2131]] != $B״Ź) { $this->where($D)->save(array($B׾[2128] => $B״Ź)); } goto Aá; Aá: } public function storageInfo($dƜ̅ = false) { goto e̷; e̷: $a΄ =& $_SERVER[ȦÆ]; $A = $this->count() + 0.0; $D = 0; goto dÈ; AȚ: for ($aӆ = 0; $aӆ < $A; $aӆ = $aӆ + $F㮲) { $eʛڬ = $this->limit($aӆ, $aӆ + $F㮲)->select(); foreach ($eʛڬ as $E) { $fӃ += $E[$a΄[87]] * $E[$a΄[2131]]; $D += $E[$a΄[87]] * ($E[$a΄[2131]] - 1); $Fؕя += $E[$a΄[2131]]; } } $d⑺ؑ = array($a΄[2136] => $fӃ, $a΄[2137] => $D, $a΄[2138] => $D / $fӃ, $a΄[91] => $A, $a΄[2139] => $Fؕя); return $d⑺ؑ; goto fҜ靎; dÈ: $fӃ = 1; $Fؕя = 0; $F㮲 = 5000; goto AȚ; fҜ靎: } } goto fц; fԨǮ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($bߣ) { $this->pathParse = $bߣ; } protected function infoParse($Aڮ) { $Fмۥ =& $_SERVER[ȦÆ]; return Action($Fмۥ[1010])->sharePathInfo($this->pathParse[$Fмۥ[85]], !0); } public function listPath($CҐ, $A = false) { $Aߚ =& $_SERVER[ȦÆ]; $c挼؊ = IO::listPath($CҐ, $A); foreach ($c挼؊ as $f => $eɋ) { if (!in_array($f, array($Aߚ[83], $Aߚ[84]))) { continue; } foreach ($eɋ as $F𚬳 => $D臨) { $D臨 = Action($Aߚ[1118])->parsePathChildren($D臨, array($Aߚ[392] => $CҐ)); $c挼؊[$f][$F𚬳] = Action($Aߚ[1010])->shareItemInfo($D臨); } } return $c挼؊; } public function listAll($fלͥ) { $B =& $_SERVER[ȦÆ]; $c = IO::listAll($fלͥ); foreach ($c as &$C٩) { $C٩ = array_merge(IO::info($C٩[$B[85]]), $C٩); $C٩[$B[396]] = Action($B[1010])->shareItemInfo($C٩); } return $c; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($a˛) { parent::__construct($a˛); $this->signatureVersion($_SERVER[ȦÆ][206]); } public function uploadFormData($FʕǇ, $f㳗 = 3600) { goto BÎ; d: $eݡ = array($bב[205] => $bב[43], $bב[1131] => $bב[43], $bב[1090] => $DҚތ, $bב[1094] => $dɏ, $bב[1098] => $Cע, $bב[1132] => $f𨳖, $bב[1133] => $B򨇥, $bב[1134] => $f, $bב[1135] => $C, $bב[1136] => $bʚ, $bב[175] => $this->getHost()); return $eݡ; goto f̚; b: $cڒܝ = $bב[69]; $f = gmdate($bב[1120]); $f = gmdate($bב[691]); goto Dζ; E̩: $D = array($this->accessKey, $f, $this->region, $cڒܝ, $Bא); $f𨳖 = implode($bב[18], $D); $a͋Ǡ = array($bב[1088] => gmdate($bב[1087], strtotime($bב[1122])), $bב[1089] => array(array($bב[1091] => $this->bucket), array($bב[1090] => $DҚތ), array($bב[1092], $bב[1093], $bב[43]), array($bב[1092], $bב[1123], $bב[43]), array($bב[1092], $bב[1124], $bב[43]), array($bב[1094] => $dɏ), array($bב[1125] => $f𨳖), array($bב[1126] => $B򨇥), array($bב[1127] => $f), array($bב[1128] => $C))); goto C; Dζ: $Bא = $bב[1121]; $C = $f㳗 . $bב[43]; $dɏ = $bב[1086]; goto E̩; C: $Cע = base64_encode(json_encode($a͋Ǡ)); $F㼗 = hash_hmac($bב[1129], $f, $bב[1130] . $this->secret, !0); $F = hash_hmac($bב[1129], $this->region, $F㼗, !0); goto c; BÎ: $bב =& $_SERVER[ȦÆ]; $DҚތ = $bב[191]; $B򨇥 = $bב[1119]; goto b; c: $aݏ = hash_hmac($bב[1129], $cڒܝ, $F, !0); $fꐃ = hash_hmac($bב[1129], $Bא, $aݏ, !0); $bʚ = hash_hmac($bב[1129], $Cע, $fꐃ); goto d; f̚: } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = FALSE; public function __construct($Aǃؽ) { parent::__construct(); if (count($Aǃؽ) > 0) { $this->_init($Aǃؽ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($E͚) { $Cܞڲ =& $_SERVER[ȦÆ]; global $config; $this->appCharset = $config[$Cܞڲ[1137]]; $this->systemCharset = $config[$Cܞڲ[1138]]; if (isset($E͚[$Cܞڲ[1139]]) && $E͚[$Cܞڲ[1139]]) { $this->systemCharset = $E͚[$Cܞڲ[1139]]; } } public function iconvApp($Fȶɢ) { return $this->iconvTo($Fȶɢ, $this->systemCharset, $this->appCharset); } public function iconvSystem($Cᒻ) { return $this->iconvTo($Cᒻ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Cሗ) { goto a쿅; bǬ޽: $Cሗ = KodIO::clear($Cሗ); $Cሗ = substr($Cሗ, strlen($AߪП)); if (empty($this->pathDriver)) { return $Cሗ; } goto cщÿ; C: if (substr($AߪП, 0, 2) == $E[1140]) { $AߪП = BASIC_PATH . substr($AߪП, 2); } if (substr($Cሗ, 0, 2) == $E[1140]) { $Cሗ = BASIC_PATH . substr($Cሗ, 2); } $AߪП = KodIO::clear($AߪП); goto bǬ޽; a쿅: $E =& $_SERVER[ȦÆ]; $AߪП = $this->iconvApp($this->pathBase); $Cሗ = $this->iconvApp($Cሗ); goto C; cщÿ: return $this->pathDriver . $E[18] . ltrim($Cሗ, $E[18]); goto E; E: } private function _init($B΢ = array()) { goto b뉏; E֫: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return; } $aá = @ftp_login($this->connect, $this->username, $this->userpass); goto b; CЉ: return $aá; goto Fǵ; bڱϋ: $B־ = isset($Fͩƫ[$b[174]]) && $Fͩƫ[$b[174]] == $b[1143] ? !0 : !1; $this->scheme = $B־ ? $b[1144] : $b[1145]; $this->port = isset($Fͩƫ[$b[176]]) ? $Fͩƫ[$b[176]] : 21; goto E֫; ḎӠ: if (isset($A[$D׈])) { foreach ($A[$D׈] as $d => $c٪) { $this->{$d} = $c٪; } return !0; } $Fͩƫ = parse_url(trim($this->server, $b[18])); $this->host = $Fͩƫ[$b[175]]; goto bڱϋ; b: foreach ($B΢ as $d => $c٪) { if (isset($this->{$d})) { $this->{$d} = $c٪; } } static $A = array(); $D׈ = md5(json_encode($B΢)); goto ḎӠ; b: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); @ftp_pasv($this->connect, !0); $A[$D׈] = array($b[1146] => $this->connect, $b[175] => $this->host, $b[174] => $this->scheme, $b[176] => $this->port); goto CЉ; b뉏: $b =& $_SERVER[ȦÆ]; if (!function_exists($b[1141])) { show_json(LNG($b[1142]), !1); } $this->charsetReset($B΢); goto b; Fǵ: } private function _isconn() { return is_resource($this->connect); } public function mkfile($B, $Fۛ = '', $dŹ = REPEAT_RENAME) { if ($this->setContent($B, $Fۛ)) { return $this->getPathOuter($B); } return !1; } public function mkdir($A, $Ań = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $A = $this->iconvSystem($A); if ($this->isFolder($A) || @ftp_mkdir($this->connect, $A)) { return $this->getPathOuter($A); } if (!$this->mkdir($this->pathFather($A))) { return !1; } if ($A = @ftp_mkdir($this->connect, $A)) { return $this->getPathOuter($A); } return !1; } public function copyFile($Aõ, $E) { goto C祇; C祇: if (!$this->_isconn()) { return !1; } $BԽ = $this->pathThis($this->iconvSystem($Aõ)); $F = $this->tempFile($BԽ); goto Aʌŗ; bӄ: $this->tempFileRemve($F); return $aҠ; goto eȔ; Aʌŗ: $Fķ = $this->iconvApp($F); $this->download($Aõ, $Fķ); $aҠ = $this->upload($E, $Fķ); goto bӄ; eȔ: } public function moveFile($b, $A֨ӆ) { if (!$this->_isconn()) { return !1; } $b = $this->iconvSystem($b); $A֨ӆ = $this->iconvSystem($A֨ӆ); $a = @ftp_rename($this->connect, $b, $A֨ӆ); return $a ? $this->getPathOuter($A֨ӆ) : !1; } public function delFile($b֐) { if (!$this->_isconn()) { return !1; } $b֐ = $this->iconvSystem($b֐); return @ftp_delete($this->connect, $b֐); } public function delFolder($C) { if (!$this->_isconn()) { return !1; } $C = $this->iconvSystem($C); $f毕 = $this->ftpList($C); if (!$f毕) { return @ftp_rmdir($this->connect, $C); } foreach ($f毕 as $AЙҒ) { if ($this->isFolder($AЙҒ)) { $AЙҒ = $this->iconvApp($AЙҒ); $this->delFolder($AЙҒ); } else { @ftp_delete($this->connect, $AЙҒ); } } return @ftp_rmdir($this->connect, $C); } public function rename($b, $cʝ) { goto BЗ; E堚: $E = $this->iconvSystem($E); $b = $this->iconvSystem($b); $C = $this->pathFather($b); goto b̈; BЗ: $F̍ߚ =& $_SERVER[ȦÆ]; if (!$this->_isconn()) { return !1; } $E = $this->fileNameAuto($this->pathFather($b), $cʝ); goto E堚; b̈: $f = rtrim($C, $F̍ߚ[18]) . $F̍ߚ[18] . $E; $d˃ = @ftp_rename($this->connect, $b, $f); $f = $this->iconvApp($f); goto Bӗ; Bӗ: return $d˃ ? $this->getPathOuter($f) : !1; goto eҮ֒; eҮ֒: } private function folderInfo($eƵԦݙ, $f橩 = false) { goto B; f؟: $BȠԧ = $this->iconvSystem($eƵԦݙ); if ($f橩) { return array($C҃[38] => $E̓, $C҃[85] => $C, $C҃[39] => $C҃[86]); } $b = array($C҃[38] => $E̓, $C҃[85] => $C, $C҃[39] => $C҃[86], $C҃[193] => 0, $C҃[116] => 0, $C҃[1147] => !0, $C҃[1148] => !0); goto A; A: return $b; goto B᫃; B: $C҃ =& $_SERVER[ȦÆ]; $C = $this->getPathOuter(rtrim($eƵԦݙ, $C҃[18])); $E̓ = $this->pathThis($C); goto f؟; B᫃: } private function fileInfo($Aǻ, $d߭ = false) { goto cی´; cی´: $aا =& $_SERVER[ȦÆ]; $e = $this->getPathOuter(rtrim($Aǻ, $aا[18])); $Bͽ = $this->pathThis($e); goto f; f: $CϹ = $this->iconvSystem($Aǻ); if ($d߭) { return array($aا[38] => $Bͽ, $aا[85] => $e, $aا[39] => $aا[173], $aا[166] => $this->ext($Aǻ), $aا[87] => $this->size($Aǻ)); } $dӅ = array($aا[38] => $Bͽ, $aا[85] => $e, $aا[39] => $aا[173], $aا[193] => 0, $aا[116] => @ftp_mdtm($this->connect, $CϹ), $aا[166] => $this->ext($Aǻ), $aا[87] => $this->size($Aǻ), $aا[1147] => !0, $aا[1148] => !0); goto Dᾏ; Dᾏ: $dӅ[$aا[116]] = $dӅ[$aا[116]] > 0 ? $dӅ[$aا[116]] : 0; return $dӅ; goto a쾫; a쾫: } public function size($A۾) { $B = $this->objectMeta($A۾); return $B ? $B[$_SERVER[ȦÆ][87]] : 0; } public function info($f) { if ($this->isFile($f)) { return $this->fileInfo($f, 0); } else { if ($this->isFolder($f)) { return $this->folderInfo($f); } } return !1; } public function exist($dꃐ) { return $this->objectMeta($dꃐ) ? !0 : !1; } public function isFile($a񣸍Ě) { $dˮ =& $_SERVER[ȦÆ]; $Dǃͪ = $this->objectMeta($a񣸍Ě); return $Dǃͪ ? $Dǃͪ[$dˮ[39]] == $dˮ[173] : !1; } public function isFolder($fޔޝ) { $Cޑ =& $_SERVER[ȦÆ]; $bҞ = $this->objectMeta($fޔޝ); return $bҞ ? $bҞ[$Cޑ[39]] == $Cޑ[86] : !1; } public function listPath($aẪ, $Aۤב = false) { goto C֕; FǏ: $E = $this->ftpList($aẪ); $fΠ = array($c[84] => array(), $c[83] => array()); if (!$E) { return $fΠ; } goto FԖ; FԖ: foreach ($E as $aẪ) { if ($this->isFolder($aẪ)) { $fΠ[$c[84]][] = $this->folderInfo($aẪ, $Aۤב); } else { $fΠ[$c[83]][] = $this->fileInfo($aẪ, $Aۤב); } } return $fΠ; goto F܋; C֕: $c =& $_SERVER[ȦÆ]; if (!$this->_isconn()) { return !1; } $aẪ = $this->iconvSystem($aẪ); goto FǏ; F܋: } public function has($dԓ, $a = false, $a߹Ƣ = true) { goto A٘Ҹ; dļѕ: foreach ($Eۅ̊ as $dԓ) { if ($a߹Ƣ) { if (!$this->isFolder($dԓ)) { return !0; } } else { if ($this->isFolder($dԓ)) { return !0; } } } return !1; goto AőƖ; A٘Ҹ: $f鐫϶ =& $_SERVER[ȦÆ]; if (!$this->_isconn()) { return !1; } $dԓ = $this->iconvSystem($dԓ); goto AĻ; AĻ: $Eۅ̊ = $this->ftpList($dԓ); if (!$Eۅ̊) { return !1; } if ($a) { return array($f鐫϶[197] => 0, $f鐫϶[198] => count($Eۅ̊)); } goto dļѕ; AőƖ: } public function listAll($Bé) { goto BУ; BУ: $d쑥 =& $_SERVER[ȦÆ]; if (!$this->_isconn()) { return !1; } $Bé = $this->iconvSystem($Bé); goto f콍; fՆ: foreach ($d񓊥[$d쑥[84]] as $fƔ) { $B[] = array($d쑥[85] => $d쑥[18] . trim(str_replace($Bé, $d쑥[43], $fƔ), $d쑥[18]) . $d쑥[18], $d쑥[86] => 1, $d쑥[87] => 0); } foreach ($d񓊥[$d쑥[83]] as $Bғ) { $B[] = array($d쑥[85] => $d쑥[18] . trim(str_replace($Bé, $d쑥[43], $Bғ), $d쑥[18]), $d쑥[86] => 0, $d쑥[87] => $this->size($Bғ)); } return $B; goto bז; f콍: $d񓊥 = array($d쑥[83] => array(), $d쑥[84] => array()); $this->recursionFtpFiles($Bé, $d񓊥); $B = array(); goto fՆ; bז: } public function getContent($fӆ) { if (!$this->_isconn()) { return !1; } $fӆ = $this->iconvSystem($fӆ); return $this->fileSubstr($fӆ); } public function setContent($Eɝ, $c = '') { goto e; A̐̋: file_put_contents($f, $c); $E݉ = $this->upload($Eɝ, $this->iconvApp($f)); $this->tempFileRemve($f); goto D; e: if (!$this->_isconn()) { return !1; } $aƚЭ = $this->pathThis($this->iconvSystem($Eɝ)); $f = $this->tempFile($aƚЭ); goto A̐̋; D: return $E݉; goto aðʘ; aðʘ: } public function fileSubstr($Bᗊ, $BФ = 0, $dδ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Bᗊ, $BФ, $dδ); } private function ftpRequest($A蹗긅, $cޒЌ = 0, $E = false) { goto e; fٴц: return $Dć; goto a; f: curl_setopt($d, CURLOPT_URL, $d . $this->pathEncode($A蹗긅)); curl_setopt($d, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($E) { $c٘Β = $cޒЌ + $E - 1; curl_setopt($d, CURLOPT_RANGE, "{$cޒЌ}\x2d{$c٘Β}"); } goto Dۄ²; Dۄ²: curl_setopt($d, CURLOPT_RETURNTRANSFER, 1); $Dć = curl_exec($d); curl_close($d); goto fٴц; e: $A蹗긅 = $this->iconvSystem($A蹗긅); $d = $this->scheme . $this->host . $_SERVER[ȦÆ][4] . $this->port; $d = curl_init(); goto f; a: } public function upload($D, $f, $fӘ = false, $BҪ = REPEAT_REPLACE) { goto D; a: if ($bƿ != FTP_FINISHED) { return !1; } return $this->getPathOuter($D); goto fч; D: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($D))) { return !1; } $D = $this->iconvSystem($D); goto C¯; C¯: $f = $this->iconvSystem($f); $bƿ = ftp_nb_put($this->connect, $D, $f, FTP_BINARY); while ($bƿ == FTP_MOREDATA) { $bƿ = ftp_nb_continue($this->connect); } goto a; fч: } public function download($cɽĐؾ, $eֹ = '') { goto AΠ; B鋽: $cɽĐؾ = $this->iconvSystem($cɽĐؾ); $eֹ = $this->iconvSystem($eֹ); $Bġ = ftp_nb_get($this->connect, $eֹ, $cɽĐؾ, FTP_BINARY); goto Eم; Eم: while ($Bġ == FTP_MOREDATA) { $Bġ = ftp_nb_continue($this->connect); } if ($Bġ != FTP_FINISHED) { return !1; } return $this->iconvApp($eֹ); goto B泅ژ; AΠ: if (!$this->_isconn()) { return !1; } $Aǃ = $this->pathFather($eֹ); if (!IO::mkdir($Aǃ)) { return !1; } goto B鋽; B泅ژ: } private function ftpList($Eۊ) { goto Bݝ; dۛ: $Eư = array(); foreach ($bۗ as $dے) { if ($dے == $Aχ[101] || $dے == $Aχ[1150]) { continue; } if (!strstr($dے, $Aχ[18])) { $dے = $Eۊ . ltrim($dے, $Aχ[18]); } $Eư[] = $this->iconvApp($dے); } return $Eư; goto f塿; F֥ʝ: $Eۊ = rtrim($Eۊ, $Aχ[18]) . $Aχ[18]; $bۗ = @ftp_nlist($this->connect, $Eۊ); if ($bۗ === !1) { $bۗ = @ftp_rawlist($this->connect, $Eۊ); foreach ($bۗ as $cׂ׎ => $BºɆ) { $bۗ[$cׂ׎] = end(explode($Aχ[1149], $BºɆ)); } } goto dۛ; Bݝ: $Aχ =& $_SERVER[ȦÆ]; if (!$this->isFolder($Eۊ)) { return !1; } @ftp_chdir($this->connect, $Aχ[18]); goto F֥ʝ; f塿: } private function recursionFtpFiles($a, &$B) { $cэ =& $_SERVER[ȦÆ]; if (!$this->_isconn()) { return !1; } if (!($fڵ㉂ = $this->ftpList($a))) { return !1; } foreach ($fڵ㉂ as $a) { if ($this->isFolder($a)) { $this->recursionFtpFiles($a, $B); $B[$cэ[84]][] = $a; } else { $B[$cэ[83]][] = $a; } } } private function objectMeta($Aƣ) { goto A񴢫; A񴢫: $C疍 =& $_SERVER[ȦÆ]; $e񳎌 = $C疍[1151] . md5($Aƣ); $c޴ = Cache::get($e񳎌); goto CÌ; dͥ: $Cǫ = @ftp_size($this->connect, $this->iconvSystem($Aƣ)); if ($Cǫ != -1) { $c޴ = array($C疍[87] => $Cǫ, $C疍[39] => $C疍[173]); } else { $a = @ftp_chdir($this->connect, $this->iconvSystem($Aƣ)); $c޴ = $a ? array($C疍[87] => 0, $C疍[39] => $C疍[86]) : !1; } Cache::set($e񳎌, $c޴, 0); goto aĥ; CÌ: if ($c޴ !== null && $c޴ !== !1) { return $c޴; } if (!$this->_isconn()) { return !1; } @ftp_chdir($this->connect, $C疍[18]); goto dͥ; aĥ: return $c޴; goto Eٴ; Eٴ: } } goto C; aѝ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($Cٯ) { $fÅ =& $_SERVER[ȦÆ]; return array($fÅ[2455] => array(USER_ID, $fÅ[2511])); } protected function listData() { $aѠ =& $_SERVER[ȦÆ]; $fۮ = array($aѠ[1403] => USER_ID, $aѠ[441] => array($aѠ[2512], 0)); $a = $aѠ[2513]; $DݸƠИ = $aѠ[2514]; $b؊۫ = $this->field($a)->where($fۮ)->order($DݸƠИ)->select(); return $b؊۫ ? $b؊۫ : array(); } protected function listByTag($bܯǏ) { } protected function addToTag($e캺, $Fퟠ) { $BӼɂ =& $_SERVER[ȦÆ]; if (!Model($BӼɂ[2282])->listData($Fퟠ) || !Model($BӼɂ[753])->pathInfo($e캺)) { return !1; } $E = array($BӼɂ[1403] => USER_ID, $BӼɂ[441] => $Fퟠ, $BӼɂ[392] => $e캺, $BӼɂ[393] => $BӼɂ[387], $BӼɂ[391] => $BӼɂ[43], $BӼɂ[2078] => 0); if ($this->where($E)->find()) { return !1; } return $this->add($E); } protected function removeFromTag($bҳ̽, $Bː) { $B =& $_SERVER[ȦÆ]; if (!Model($B[2282])->listData($Bː)) { return !1; } if (is_array($bҳ̽)) { $bҳ̽ = array($B[17], $bҳ̽); } $f = array($B[1403] => USER_ID, $B[441] => $Bː, $B[393] => $B[387], $B[392] => $bҳ̽); return $this->where($f)->delete(); } protected function removeByTag($bڵ) { $Dߞ =& $_SERVER[ȦÆ]; if (!$bڵ) { return !1; } $B𖫡 = array($Dߞ[1403] => USER_ID, $Dߞ[441] => $bڵ); return $this->where($B𖫡)->delete(); } protected function removeBySource($d֤) { $dܲ =& $_SERVER[ȦÆ]; $Fܱ = array($dܲ[1403] => USER_ID, $dܲ[392] => $d֤, $dܲ[441] => array($dܲ[923], 0)); return $this->where($Fܱ)->delete(); } }